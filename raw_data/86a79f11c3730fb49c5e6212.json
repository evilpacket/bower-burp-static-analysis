{
    "url": "http://localhost:9999/aurigadl/WebODF/programs/editor/collabeditor.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location</b> and written to <b>location</b> via the following statements:<ul><li>location = location + '#' + sessionId;</li><li>location = location.substr(0, pos);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/aurigadl/WebODF/programs/editor/collabeditor.js",
                "path": "/aurigadl/WebODF/programs/editor/collabeditor.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hdXJpZ2FkbC9XZWJPREYvcHJvZ3JhbXMvZWRpdG9yL2NvbGxhYmVkaXRvci5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTI1NzMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFN1biwgMDkgTm92IDIwMTQgMDI6NDE6MDIgR01UDQpMYXN0LU1vZGlmaWVkOiBTdW4sIDA5IE5vdiAyMDE0IDAyOjQwOjM1IEdNVA0KDQovKioKICogQ29weXJpZ2h0IChDKSAyMDEzIEtPIEdtYkggPGNvcHlyaWdodEBrb2dtYmguY29tPgogKgogKiBAbGljc3RhcnQKICogVGhlIEphdmFTY3JpcHQgY29kZSBpbiB0aGlzIHBhZ2UgaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQKICogYW5kL29yIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogKiAoR05VIEFHUEwpIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mCiAqIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLiAgVGhlIGNvZGUgaXMgZGlzdHJpYnV0ZWQKICogV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IKICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVSBBR1BMIGZvciBtb3JlIGRldGFpbHMuCiAqCiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogKiBhbG9uZyB3aXRoIHRoaXMgY29kZS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICoKICogQXMgYWRkaXRpb25hbCBwZXJtaXNzaW9uIHVuZGVyIEdOVSBBR1BMIHZlcnNpb24gMyBzZWN0aW9uIDcsIHlvdQogKiBtYXkgZGlzdHJpYnV0ZSBub24tc291cmNlIChlLmcuLCBtaW5pbWl6ZWQgb3IgY29tcGFjdGVkKSBmb3JtcyBvZgogKiB0aGF0IGNvZGUgd2l0aG91dCB0aGUgY29weSBvZiB0aGUgR05VIEdQTCBub3JtYWxseSByZXF1aXJlZCBieQogKiBzZWN0aW9uIDQsIHByb3ZpZGVkIHlvdSBpbmNsdWRlIHRoaXMgbGljZW5zZSBub3RpY2UgYW5kIGEgVVJMCiAqIHRocm91Z2ggd2hpY2ggcmVjaXBpZW50cyBjYW4gYWNjZXNzIHRoZSBDb3JyZXNwb25kaW5nIFNvdXJjZS4KICoKICogQXMgYSBzcGVjaWFsIGV4Y2VwdGlvbiB0byB0aGUgQUdQTCwgYW55IEhUTUwgZmlsZSB3aGljaCBtZXJlbHkgbWFrZXMgZnVuY3Rpb24KICogY2FsbHMgdG8gdGhpcyBjb2RlLCBhbmQgZm9yIHRoYXQgcHVycG9zZSBpbmNsdWRlcyBpdCBieSByZWZlcmVuY2Ugc2hhbGwgYmUKICogZGVlbWVkIGEgc2VwYXJhdGUgd29yayBmb3IgY29weXJpZ2h0IGxhdyBwdXJwb3Nlcy4gSW4gYWRkaXRpb24sIHRoZSBjb3B5cmlnaHQKICogaG9sZGVycyBvZiB0aGlzIGNvZGUgZ2l2ZSB5b3UgcGVybWlzc2lvbiB0byBjb21iaW5lIHRoaXMgY29kZSB3aXRoIGZyZWUKICogc29mdHdhcmUgbGlicmFyaWVzIHRoYXQgYXJlIHJlbGVhc2VkIHVuZGVyIHRoZSBHTlUgTEdQTC4gWW91IG1heSBjb3B5IGFuZAogKiBkaXN0cmlidXRlIHN1Y2ggYSBzeXN0ZW0gZm9sbG93aW5nIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFHUEwgZm9yIHRoaXMgY29kZQogKiBhbmQgdGhlIExHUEwgZm9yIHRoZSBsaWJyYXJpZXMuIElmIHlvdSBtb2RpZnkgdGhpcyBjb2RlLCB5b3UgbWF5IGV4dGVuZCB0aGlzCiAqIGV4Y2VwdGlvbiB0byB5b3VyIHZlcnNpb24gb2YgdGhlIGNvZGUsIGJ1dCB5b3UgYXJlIG5vdCBvYmxpZ2F0ZWQgdG8gZG8gc28uCiAqIElmIHlvdSBkbyBub3Qgd2lzaCB0byBkbyBzbywgZGVsZXRlIHRoaXMgZXhjZXB0aW9uIHN0YXRlbWVudCBmcm9tIHlvdXIKICogdmVyc2lvbi4KICoKICogVGhpcyBsaWNlbnNlIGFwcGxpZXMgdG8gdGhpcyBlbnRpcmUgY29tcGlsYXRpb24uCiAqIEBsaWNlbmQKICogQHNvdXJjZTogaHR0cDovL3d3dy53ZWJvZGYub3JnLwogKiBAc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20va29nbWJoL1dlYk9ERi8KICovCgovKgogKiBib290c3RyYXAgdGhlIGVkaXRvciBmb3Igc2VydmVyLWJhc2VkIGNvbGxhYm9yYXRpdmUgZWRpdGluZwogKiB0aGlzIGZpbGUgaXMgbWVhbnQgdG8gYmUgaW5jbHVkZWQgZnJvbSBIVE1MIGFuZCB1c2VkCiAqIGJ5IHVzZXJzIHdobyBkbyBub3Qgd2FudCB0byBrbm93IG11Y2ggYWJvdXQgdGhlIGlubmVyCiAqIGNvbXBsZXhpdHkuCiAqIHNvIHdlIG5lZWQgdG8gbWFrZSBpdCByZWFsbHkgZWFzeS4KICoKICogaW5jbHVkaW5nIHRoaXMgZmlsZSB3aWxsIHJlc3VsdCBpbiB0aGUgbmFtZXNwYWNlL29iamVjdAogKiAid2Vib2RmRWRpdG9yIiB0byBiZSBhdmFpbGFibGUgZnJvbSB0aGUgSFRNTCBzaWRlLgogKiBjYWxsaW5nIHdlYm9kZkVkaXRvci5ib290KCkgd2lsbCBzdGFydCB0aGUgZWRpdG9yLgogKiB0aGUgbWV0aG9kIGNhbiBhbHNvIHRha2Ugc29tZSBwYXJhbWV0ZXJzIHRvIHNwZWNpZnkKICogYmVoYXZpb3VyLiBzZWUgZG9jdW1lbnRhdGlvbiBvZiB0aGF0IG1ldGhvZC4KICoKICovCgovKmdsb2JhbCBydW50aW1lLCByZXF1aXJlLCBkb2N1bWVudCwgYWxlcnQsIGd1aSwgd2luZG93ICovCgovLyBkZWZpbmUgdGhlIG5hbWVzcGFjZS9vYmplY3Qgd2Ugd2FudCB0byBwcm92aWRlCi8vIHRoaXMgaXMgdGhlIGZpcnN0IGxpbmUgb2YgQVBJLCB0aGUgdXNlciBnZXRzLgp2YXIgd2Vib2RmRWRpdG9yID0gKGZ1bmN0aW9uICgpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBydW50aW1lLmN1cnJlbnREaXJlY3RvcnkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICIuLi8uLi93ZWJvZGYvbGliIjsKICAgIH07CiAgICBydW50aW1lLmxpYnJhcnlQYXRocyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gWyBydW50aW1lLmN1cnJlbnREaXJlY3RvcnkoKSBdOwogICAgfTsKCiAgICB2YXIgZWRpdG9ySW5zdGFuY2UgPSBudWxsLAogICAgICAgIHNlcnZlckZhY3RvcnkgPSBudWxsLAogICAgICAgIHNlcnZlciA9IG51bGwsCiAgICAgICAgZWRpdG9yT3B0aW9ucyA9IHt9LAogICAgICAgIGN1cnJlbnRQYWdlSWQgPSBudWxsLAogICAgICAgIHNhdmluZ092ZXJsYXksIGRpc2Nvbm5lY3RlZE92ZXJsYXksIGhhc0xvY2FsVW5zeW5jZWRPcHNPdmVybGF5LAogICAgICAgIHNlc3Npb25MaXN0LAogICAgICAgIHVzZXJJZCwgdG9rZW4sCiAgICAgICAgY3VycmVudFNlc3Npb25JZCwgY3VycmVudE1lbWJlcklkLAogICAgICAgIGJvb3RpbmcgPSBmYWxzZTsKCiAgICAvLyBUT0RPOiBqdXN0IHNvbWUgcXVpY2sgaGFjayBkb25lIGZvciB0ZXN0aW5nLCBtYWtlIG5pY2UgKGUuZy4gdGhlIHBvc2l0aW9uIGNhbGN1bGF0aW9uIGlzIGZyYWdpbGUpCiAgICBmdW5jdGlvbiBhZGRTdGF0dXNPdmVybGF5KHBhcmVudEVsZW1lbnRJZCwgc3ltYm9sRmlsZU5hbWUsIHBvc2l0aW9uKSB7CiAgICAgICAgdmFyIGh0bWxucyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5uYW1lc3BhY2VVUkksCiAgICAgICAgICAgIHBhcmVudEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwYXJlbnRFbGVtZW50SWQpLAogICAgICAgICAgICBpbWFnZUVsZW1lbnQsIG92ZXJsYXk7CgogICAgICAgIHJ1bnRpbWUuYXNzZXJ0KHBhcmVudEVsZW1lbnQsICJoZXlhLCBubyBzdWNoIGVsZW1lbnQgd2l0aCBpZCAiK3BhcmVudEVsZW1lbnRJZCk7CgogICAgICAgIG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoaHRtbG5zLCAiZGl2Iik7CiAgICAgICAgaW1hZ2VFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKGh0bWxucywgImltZyIpOwogICAgICAgIGltYWdlRWxlbWVudC5zcmMgPSBzeW1ib2xGaWxlTmFtZTsKICAgICAgICBvdmVybGF5LmFwcGVuZENoaWxkKGltYWdlRWxlbWVudCk7CiAgICAgICAgb3ZlcmxheS5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CiAgICAgICAgb3ZlcmxheS5zdHlsZS50b3AgPSAyNCpwb3NpdGlvbiArICJweCI7CiAgICAgICAgb3ZlcmxheS5zdHlsZS5vcGFjaXR5ID0gIjAuOCI7CiAgICAgICAgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIHBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQob3ZlcmxheSk7CiAgICAgICAgcmV0dXJuIG92ZXJsYXk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTd2l0Y2hlcyB0aGUgcGFnZXMgYnkgaGlkaW5nIHRoZSBvbGQgb25lIGFuZCB1bmhpZGluZyB0aGUgbmV3CiAgICAgKiBAcGFyYW0geyFzdHJpbmd9IHBhZ2VJZAogICAgICogQHJldHVybnMge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gc3dpdGNoVG9QYWdlKHBhZ2VJZCkgewogICAgICAgIGlmIChjdXJyZW50UGFnZUlkKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN1cnJlbnRQYWdlSWQpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgfQogICAgICAgIGN1cnJlbnRQYWdlSWQgPSBwYWdlSWQ7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocGFnZUlkKS5zdHlsZS5kaXNwbGF5ID0gIiI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0geyFzdHJpbmd9CiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUxvY2F0aW9uV2l0aFNlc3Npb25JZChzZXNzaW9uSWQpIHsKICAgICAgICB2YXIgbG9jYXRpb24gPSBTdHJpbmcoZG9jdW1lbnQubG9jYXRpb24pLAogICAgICAgICAgICBwb3MgPSBsb2NhdGlvbi5pbmRleE9mKCcjJyk7CiAgICAgICAgaWYgKHBvcyAhPSAtMSkgewogICAgICAgICAgICBsb2NhdGlvbiA9IGxvY2F0aW9uLnN1YnN0cigwLCBwb3MpOwogICAgICAgIH0KICAgICAgICBpZiAoc2Vzc2lvbklkKSB7CiAgICAgICAgICAgIGxvY2F0aW9uID0gbG9jYXRpb24gKyAnIycgKyBzZXNzaW9uSWQ7CiAgICAgICAgfQogICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKCB7fSwgIiIsIGxvY2F0aW9uKTsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRFZGl0aW5nKCkgewogICAgICAgIGVkaXRvckluc3RhbmNlLnN0YXJ0RWRpdGluZygpOwogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIHshYm9vbGVhbj19IGlnbm9yZUVycm9yCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsb3NlRWRpdGluZyhpZ25vcmVFcnJvcikgewogICAgICAgIGVkaXRvckluc3RhbmNlLmVuZEVkaXRpbmcoKTsKICAgICAgICBlZGl0b3JJbnN0YW5jZS5jbG9zZVNlc3Npb24oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHNlcnZlci5sZWF2ZVNlc3Npb24oY3VycmVudFNlc3Npb25JZCwgY3VycmVudE1lbWJlcklkLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHNob3dTZXNzaW9ucygpOwogICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmIChpZ25vcmVFcnJvcikgewogICAgICAgICAgICAgICAgICAgIHNob3dTZXNzaW9ucygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gVE9ETzogZWxzZSByZXBvcnQgcHJvYmxlbQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gaGFuZGxlRWRpdGluZ0Vycm9yKGVycm9yKSB7CiAgICAgICAgYWxlcnQoIlNvbWV0aGluZyB3ZW50IHdyb25nOlxuIitlcnJvcik7CiAgICAgICAgY2xvc2VFZGl0aW5nKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQHJldHVybnMge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gc2hvd1Nlc3Npb25zKCkgewogICAgICAgIHN3aXRjaFRvUGFnZSgic2Vzc2lvbkxpc3RDb250YWluZXIiKTsKCiAgICAgICAgc2Vzc2lvbkxpc3Quc2V0VXBkYXRlc0VuYWJsZWQodHJ1ZSk7CgogICAgICAgIHVwZGF0ZUxvY2F0aW9uV2l0aFNlc3Npb25JZCgiIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0geyFzdHJpbmd9IHNlc3Npb25JZAogICAgICogQHJldHVybnMge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gZW50ZXJTZXNzaW9uKHNlc3Npb25JZCkgewogICAgICAgIHN3aXRjaFRvUGFnZSgibWFpbkNvbnRhaW5lciIpOwoKICAgICAgICBzZXNzaW9uTGlzdC5zZXRVcGRhdGVzRW5hYmxlZChmYWxzZSk7CgogICAgICAgIHVwZGF0ZUxvY2F0aW9uV2l0aFNlc3Npb25JZChzZXNzaW9uSWQpOwoKICAgICAgICBjdXJyZW50U2Vzc2lvbklkID0gc2Vzc2lvbklkOwogICAgICAgIHNlcnZlci5qb2luU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZCwgZnVuY3Rpb24obWVtYmVySWQpIHsKICAgICAgICAgICAgY3VycmVudE1lbWJlcklkID0gbWVtYmVySWQ7CgogICAgICAgICAgICBpZiAoIWVkaXRvckluc3RhbmNlKSB7CiAgICAgICAgICAgICAgICByZXF1aXJlKHsgfSwgWwogICAgICAgICAgICAgICAgIndlYm9kZi9lZGl0b3IvVHJhbnNsYXRvciIsCiAgICAgICAgICAgICAgICAid2Vib2RmL2VkaXRvci9FZGl0b3IiXSwKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoVHJhbnNsYXRvciwgRWRpdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsb2NhbGUgPSBuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgImVuLVVTIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBuZXcgVHJhbnNsYXRvcihsb2NhbGUsIGZ1bmN0aW9uIChlZGl0b3JUcmFuc2xhdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVudGltZS5zZXRUcmFuc2xhdG9yKGVkaXRvclRyYW5zbGF0b3IudHJhbnNsYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZpbmdPdmVybGF5ID0gYWRkU3RhdHVzT3ZlcmxheSgiZWRpdG9yIiwgImRvY3VtZW50LXNhdmUucG5nIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzTG9jYWxVbnN5bmNlZE9wc092ZXJsYXkgPSBhZGRTdGF0dXNPdmVybGF5KCJlZGl0b3IiLCAidmNzLWxvY2FsbHktbW9kaWZpZWQucG5nIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY29ubmVjdGVkT3ZlcmxheSA9IGFkZFN0YXR1c092ZXJsYXkoImVkaXRvciIsICJuZXR3b3JrLWRpc2Nvbm5lY3QucG5nIiwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvck9wdGlvbnMgPSBlZGl0b3JPcHRpb25zIHx8IHt9OyAvLyBUT0RPOiBjbGVhbnVwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yT3B0aW9ucy5uZXR3b3JrU2VjdXJpdHlUb2tlbiA9IHRva2VuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvck9wdGlvbnMuY2xvc2VDYWxsYmFjayA9IGNsb3NlRWRpdGluZzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9ySW5zdGFuY2UgPSBuZXcgRWRpdG9yKGVkaXRvck9wdGlvbnMsIHNlcnZlciwgc2VydmVyRmFjdG9yeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9ySW5zdGFuY2UuYWRkRXZlbnRMaXN0ZW5lcihFZGl0b3IuRVZFTlRfQkVGT1JFU0FWRVRPRklMRSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmluZ092ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvckluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXIoRWRpdG9yLkVWRU5UX1NBVkVEVE9GSUxFLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2aW5nT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvckluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXIoRWRpdG9yLkVWRU5UX0hBU0xPQ0FMVU5TWU5DRURPUEVSQVRJT05TQ0hBTkdFRCwgZnVuY3Rpb24oaGFzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc0xvY2FsVW5zeW5jZWRPcHNPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSBoYXMgPyAiIiA6ICJub25lIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyKEVkaXRvci5FVkVOVF9IQVNTRVNTSU9OSE9TVENPTk5FQ1RJT05DSEFOR0VELCBmdW5jdGlvbihoYXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY29ubmVjdGVkT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gaGFzID8gIm5vbmUiIDogIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9ySW5zdGFuY2UuYWRkRXZlbnRMaXN0ZW5lcihFZGl0b3IuRVZFTlRfRVJST1IsIGhhbmRsZUVkaXRpbmdFcnJvcik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvYWQgdGhlIGRvY3VtZW50IGFuZCBnZXQgY2FsbGVkIGJhY2sgd2hlbiBpdCdzIGxpdmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JJbnN0YW5jZS5vcGVuU2Vzc2lvbihzZXNzaW9uSWQsIG1lbWJlcklkLCBzdGFydEVkaXRpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVkaXRvckluc3RhbmNlLm9wZW5TZXNzaW9uKHNlc3Npb25JZCwgbWVtYmVySWQsIHN0YXJ0RWRpdGluZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy8gVE9ETzogaGFuZGxlIGVycm9yCiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBleHRyYWN0IHNlc3Npb24gaWQgZnJvbSB0aGUgdXJsLWZyYWdtZW50CiAgICAgKgogICAgICogQHJldHVybiB7P3N0cmluZ30KICAgICAqLwogICAgZnVuY3Rpb24gZXh0cmFjdFNlc3Npb25JZCgpIHsKICAgICAgICB2YXIgc2Vzc2lvbklkID0gU3RyaW5nKGRvY3VtZW50LmxvY2F0aW9uKSwKICAgICAgICAgICAgcG9zID0gc2Vzc2lvbklkLmluZGV4T2YoJyMnKTsKICAgICAgICByZXR1cm4gKHBvcyAhPT0gLTEpID8gc2Vzc2lvbklkLnN1YnN0cihwb3MgKyAxKSA6IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBzdGFydCB0aGUgbG9naW4gcHJvY2VzcyBieSBvZmZlcmluZyBhIGxvZ2luL3Bhc3N3b3JkIHByb21wdC4KICAgICAqIG9uIHN1Y2Nlc3MgYSBsaXN0IG9mIHNlc3Npb25zIGlzIG9mZmVyZWQuCiAgICAgKiB3aGVuIHRoZSB1c2VyIHNlbGVjdHMgYSBzZXNzaW9uIHRoZSBjYWxsYmFjayBpcyBjYWxsZWQKICAgICAqIHdpdGggdGhlIHNlc3Npb25JZCBhcyBwYXJhbWV0ZXIKICAgICAqCiAgICAgKiBAcGFyYW0geyFmdW5jdGlvbighc3RyaW5nLCAhc3RyaW5nLCA/c3RyaW5nKX0gY2FsbGJhY2sKICAgICAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0YXJ0TG9naW5Qcm9jZXNzKGNhbGxiYWNrKSB7CiAgICAgICAgYm9vdGluZyA9IHRydWU7CgogICAgICAgIHJ1bnRpbWUuYXNzZXJ0KGVkaXRvckluc3RhbmNlID09PSBudWxsLCAiY2Fubm90IGJvb3Qgd2l0aCBpbnN0YW5jaWF0ZWQgZWRpdG9yIik7CgogICAgICAgIGZ1bmN0aW9uIGxvZ2luU3VjY2Vzcyh1c2VyRGF0YSkgewogICAgICAgICAgICByZXF1aXJlKHsgfSwgWyJ3ZWJvZGYvZWRpdG9yL1Nlc3Npb25MaXN0VmlldyJdLAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKFNlc3Npb25MaXN0VmlldykgewogICAgICAgICAgICAgICAgICAgIHZhciBzZXNzaW9uTGlzdERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZXNzaW9uTGlzdCIpLAogICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSWQgPSBleHRyYWN0U2Vzc2lvbklkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25MaXN0VmlldzsKCiAgICAgICAgICAgICAgICAgICAgcnVudGltZS5sb2coImNvbm5lY3RlZDoiICsgdXNlckRhdGEuZnVsbF9uYW1lKTsKICAgICAgICAgICAgICAgICAgICB1c2VySWQgPSB1c2VyRGF0YS51aWQ7CiAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB1c2VyRGF0YS5zZWN1cml0eVRva2VuIHx8IG51bGw7CgogICAgICAgICAgICAgICAgICAgIC8vIGFkZCBzZXNzaW9uIGxpc3RpbmcKICAgICAgICAgICAgICAgICAgICBzZXNzaW9uTGlzdCA9IG5ldyBzZXJ2ZXJGYWN0b3J5LmNyZWF0ZVNlc3Npb25MaXN0KHNlcnZlcik7CiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkxpc3RWaWV3ID0gbmV3IFNlc3Npb25MaXN0VmlldyhzZXNzaW9uTGlzdCwgc2Vzc2lvbkxpc3REaXYsIGVudGVyU2Vzc2lvbik7CgogICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogY2hlY2sgaWYgc2Vzc2lvbiBleGlzdHMKICAgICAgICAgICAgICAgICAgICAgICAgZW50ZXJTZXNzaW9uKHNlc3Npb25JZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoVG9QYWdlKCJzZXNzaW9uTGlzdENvbnRhaW5lciIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxvZ2luRmFpbChyZXN1bHQpIHsKICAgICAgICAgICAgYWxlcnQoIkxvZ2luIGZhaWxlZDogIiArIHJlc3VsdCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJucyB7IWJvb2xlYW59CiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gb25Mb2dpblN1Ym1pdCgpIHsKICAgICAgICAgICAgc2VydmVyLmxvZ2luKGRvY3VtZW50LmxvZ2luRm9ybS5sb2dpbi52YWx1ZSwgZG9jdW1lbnQubG9naW5Gb3JtLnBhc3N3b3JkLnZhbHVlLCBsb2dpblN1Y2Nlc3MsIGxvZ2luRmFpbCk7CgogICAgICAgICAgICAvLyBibG9jayB0aGUgc3VibWl0IGJ1dHRvbiwgd2UgYWxyZWFkeSBkZWFsdCB3aXRoIHRoZSBpbnB1dAogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBicmluZyB1cCB0aGUgbG9naW4gZm9ybQogICAgICAgIGRvY3VtZW50LmxvZ2luRm9ybS5TdWJtaXQub25jbGljayA9IG9uTG9naW5TdWJtaXQ7CiAgICAgICAgc3dpdGNoVG9QYWdlKCJsb2dpbkNvbnRhaW5lciIpOwogICAgICAgIGRvY3VtZW50LmxvZ2luRm9ybS5sb2dpbi5mb2N1cygpOwogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIHshT2JqZWN0fSBhcmdzCiAgICAgKgogICAgICogYXJnczoKICAgICAqCiAgICAgKiBiYWNrZW5kOiAgIG5hbWUgb2YgdGhlIHNlcnZlciB0byB1c2UKICAgICAqCiAgICAgKiBjYWxsYmFjazogIGNhbGxiYWNrIHRvIGJlIGNhbGxlZCBhcyBzb29uIGFzIHRoZSBkb2N1bWVudCBpcyBsb2FkZWQKICAgICAqCiAgICAgKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiBib290KGFyZ3MpIHsKICAgICAgICBydW50aW1lLmFzc2VydCghYm9vdGluZywgImVkaXRvciBjcmVhdGlvbiBhbHJlYWR5IGluIHByb2dyZXNzIik7CgogICAgICAgIGlmIChhcmdzLnNhdmVDYWxsYmFjaykgewogICAgICAgICAgICBlZGl0b3JPcHRpb25zLnNhdmVDYWxsYmFjayA9IGFyZ3Muc2F2ZUNhbGxiYWNrOwogICAgICAgIH0KCiAgICAgICAgLy8gc3RhcnQgdGhlIGVkaXRvciB3aXRoIG5ldHdvcmsKICAgICAgICBydW50aW1lLmxvZygic3RhcnRpbmcgY29sbGFib3JhdGl2ZSBlZGl0b3IgZm9yIFsiK2FyZ3MuYmFja2VuZCsiXS4iKTsKICAgICAgICByZXF1aXJlKHsgfSwgWyJ3ZWJvZGYvZWRpdG9yL3NlcnZlci8iK2FyZ3MuYmFja2VuZCsiL1NlcnZlckZhY3RvcnkiXSwgZnVuY3Rpb24gKFNlcnZlckZhY3RvcnkpIHsKICAgICAgICAgICAgc2VydmVyRmFjdG9yeSA9IG5ldyBTZXJ2ZXJGYWN0b3J5KCk7CiAgICAgICAgICAgIHNlcnZlciA9IHNlcnZlckZhY3RvcnkuY3JlYXRlU2VydmVyKCk7CiAgICAgICAgICAgIC8vIHdhaXQgZm9yIGEgbmV0d29yayBjb25uZWN0aW9uIHRvIGVzdGFibGlzaC4KICAgICAgICAgICAgLy8gY2FsbCB0aGUgY2FsbGJhY2sgd2hlbiBkb25lLCB3aGVuIGZpbmFsbHkgZmFpbGVkLCBvcgogICAgICAgICAgICAvLyB3aGVuIGEgdGltZW91dCByZWFjaGVkLgogICAgICAgICAgICAvLyB0aGUgcGFyYW1ldGVyIHRvIHRoZSBjYWxsYmFjayBpcyBhIHN0cmluZyB3aXRoIHRoZSBwb3NzaWJsZQogICAgICAgICAgICAvLyB2YWx1ZXM6ICJ1bmF2YWlsYWJsZSIsICJ0aW1lb3V0IiwgInJlYWR5IgogICAgICAgICAgICBzZXJ2ZXIuY29ubmVjdCg4MDAwLCBmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gInJlYWR5IikgewogICAgICAgICAgICAgICAgICAgIHN0YXJ0TG9naW5Qcm9jZXNzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIGV4cG9zZWQgQVBJCiAgICByZXR1cm4geyBib290OiBib290IH07Cn0oKSk7Cgo=",
                "body": "LyoqCiAqIENvcHlyaWdodCAoQykgMjAxMyBLTyBHbWJIIDxjb3B5cmlnaHRAa29nbWJoLmNvbT4KICoKICogQGxpY3N0YXJ0CiAqIFRoZSBKYXZhU2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0CiAqIGFuZC9vciBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICogKEdOVSBBR1BMKSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZgogKiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4gIFRoZSBjb2RlIGlzIGRpc3RyaWJ1dGVkCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUgQUdQTCBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICogYWxvbmcgd2l0aCB0aGlzIGNvZGUuICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiAqCiAqIEFzIGFkZGl0aW9uYWwgcGVybWlzc2lvbiB1bmRlciBHTlUgQUdQTCB2ZXJzaW9uIDMgc2VjdGlvbiA3LCB5b3UKICogbWF5IGRpc3RyaWJ1dGUgbm9uLXNvdXJjZSAoZS5nLiwgbWluaW1pemVkIG9yIGNvbXBhY3RlZCkgZm9ybXMgb2YKICogdGhhdCBjb2RlIHdpdGhvdXQgdGhlIGNvcHkgb2YgdGhlIEdOVSBHUEwgbm9ybWFsbHkgcmVxdWlyZWQgYnkKICogc2VjdGlvbiA0LCBwcm92aWRlZCB5b3UgaW5jbHVkZSB0aGlzIGxpY2Vuc2Ugbm90aWNlIGFuZCBhIFVSTAogKiB0aHJvdWdoIHdoaWNoIHJlY2lwaWVudHMgY2FuIGFjY2VzcyB0aGUgQ29ycmVzcG9uZGluZyBTb3VyY2UuCiAqCiAqIEFzIGEgc3BlY2lhbCBleGNlcHRpb24gdG8gdGhlIEFHUEwsIGFueSBIVE1MIGZpbGUgd2hpY2ggbWVyZWx5IG1ha2VzIGZ1bmN0aW9uCiAqIGNhbGxzIHRvIHRoaXMgY29kZSwgYW5kIGZvciB0aGF0IHB1cnBvc2UgaW5jbHVkZXMgaXQgYnkgcmVmZXJlbmNlIHNoYWxsIGJlCiAqIGRlZW1lZCBhIHNlcGFyYXRlIHdvcmsgZm9yIGNvcHlyaWdodCBsYXcgcHVycG9zZXMuIEluIGFkZGl0aW9uLCB0aGUgY29weXJpZ2h0CiAqIGhvbGRlcnMgb2YgdGhpcyBjb2RlIGdpdmUgeW91IHBlcm1pc3Npb24gdG8gY29tYmluZSB0aGlzIGNvZGUgd2l0aCBmcmVlCiAqIHNvZnR3YXJlIGxpYnJhcmllcyB0aGF0IGFyZSByZWxlYXNlZCB1bmRlciB0aGUgR05VIExHUEwuIFlvdSBtYXkgY29weSBhbmQKICogZGlzdHJpYnV0ZSBzdWNoIGEgc3lzdGVtIGZvbGxvd2luZyB0aGUgdGVybXMgb2YgdGhlIEdOVSBBR1BMIGZvciB0aGlzIGNvZGUKICogYW5kIHRoZSBMR1BMIGZvciB0aGUgbGlicmFyaWVzLiBJZiB5b3UgbW9kaWZ5IHRoaXMgY29kZSwgeW91IG1heSBleHRlbmQgdGhpcwogKiBleGNlcHRpb24gdG8geW91ciB2ZXJzaW9uIG9mIHRoZSBjb2RlLCBidXQgeW91IGFyZSBub3Qgb2JsaWdhdGVkIHRvIGRvIHNvLgogKiBJZiB5b3UgZG8gbm90IHdpc2ggdG8gZG8gc28sIGRlbGV0ZSB0aGlzIGV4Y2VwdGlvbiBzdGF0ZW1lbnQgZnJvbSB5b3VyCiAqIHZlcnNpb24uCiAqCiAqIFRoaXMgbGljZW5zZSBhcHBsaWVzIHRvIHRoaXMgZW50aXJlIGNvbXBpbGF0aW9uLgogKiBAbGljZW5kCiAqIEBzb3VyY2U6IGh0dHA6Ly93d3cud2Vib2RmLm9yZy8KICogQHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2tvZ21iaC9XZWJPREYvCiAqLwoKLyoKICogYm9vdHN0cmFwIHRoZSBlZGl0b3IgZm9yIHNlcnZlci1iYXNlZCBjb2xsYWJvcmF0aXZlIGVkaXRpbmcKICogdGhpcyBmaWxlIGlzIG1lYW50IHRvIGJlIGluY2x1ZGVkIGZyb20gSFRNTCBhbmQgdXNlZAogKiBieSB1c2VycyB3aG8gZG8gbm90IHdhbnQgdG8ga25vdyBtdWNoIGFib3V0IHRoZSBpbm5lcgogKiBjb21wbGV4aXR5LgogKiBzbyB3ZSBuZWVkIHRvIG1ha2UgaXQgcmVhbGx5IGVhc3kuCiAqCiAqIGluY2x1ZGluZyB0aGlzIGZpbGUgd2lsbCByZXN1bHQgaW4gdGhlIG5hbWVzcGFjZS9vYmplY3QKICogIndlYm9kZkVkaXRvciIgdG8gYmUgYXZhaWxhYmxlIGZyb20gdGhlIEhUTUwgc2lkZS4KICogY2FsbGluZyB3ZWJvZGZFZGl0b3IuYm9vdCgpIHdpbGwgc3RhcnQgdGhlIGVkaXRvci4KICogdGhlIG1ldGhvZCBjYW4gYWxzbyB0YWtlIHNvbWUgcGFyYW1ldGVycyB0byBzcGVjaWZ5CiAqIGJlaGF2aW91ci4gc2VlIGRvY3VtZW50YXRpb24gb2YgdGhhdCBtZXRob2QuCiAqCiAqLwoKLypnbG9iYWwgcnVudGltZSwgcmVxdWlyZSwgZG9jdW1lbnQsIGFsZXJ0LCBndWksIHdpbmRvdyAqLwoKLy8gZGVmaW5lIHRoZSBuYW1lc3BhY2Uvb2JqZWN0IHdlIHdhbnQgdG8gcHJvdmlkZQovLyB0aGlzIGlzIHRoZSBmaXJzdCBsaW5lIG9mIEFQSSwgdGhlIHVzZXIgZ2V0cy4KdmFyIHdlYm9kZkVkaXRvciA9IChmdW5jdGlvbiAoKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgcnVudGltZS5jdXJyZW50RGlyZWN0b3J5ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAiLi4vLi4vd2Vib2RmL2xpYiI7CiAgICB9OwogICAgcnVudGltZS5saWJyYXJ5UGF0aHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIFsgcnVudGltZS5jdXJyZW50RGlyZWN0b3J5KCkgXTsKICAgIH07CgogICAgdmFyIGVkaXRvckluc3RhbmNlID0gbnVsbCwKICAgICAgICBzZXJ2ZXJGYWN0b3J5ID0gbnVsbCwKICAgICAgICBzZXJ2ZXIgPSBudWxsLAogICAgICAgIGVkaXRvck9wdGlvbnMgPSB7fSwKICAgICAgICBjdXJyZW50UGFnZUlkID0gbnVsbCwKICAgICAgICBzYXZpbmdPdmVybGF5LCBkaXNjb25uZWN0ZWRPdmVybGF5LCBoYXNMb2NhbFVuc3luY2VkT3BzT3ZlcmxheSwKICAgICAgICBzZXNzaW9uTGlzdCwKICAgICAgICB1c2VySWQsIHRva2VuLAogICAgICAgIGN1cnJlbnRTZXNzaW9uSWQsIGN1cnJlbnRNZW1iZXJJZCwKICAgICAgICBib290aW5nID0gZmFsc2U7CgogICAgLy8gVE9ETzoganVzdCBzb21lIHF1aWNrIGhhY2sgZG9uZSBmb3IgdGVzdGluZywgbWFrZSBuaWNlIChlLmcuIHRoZSBwb3NpdGlvbiBjYWxjdWxhdGlvbiBpcyBmcmFnaWxlKQogICAgZnVuY3Rpb24gYWRkU3RhdHVzT3ZlcmxheShwYXJlbnRFbGVtZW50SWQsIHN5bWJvbEZpbGVOYW1lLCBwb3NpdGlvbikgewogICAgICAgIHZhciBodG1sbnMgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubmFtZXNwYWNlVVJJLAogICAgICAgICAgICBwYXJlbnRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocGFyZW50RWxlbWVudElkKSwKICAgICAgICAgICAgaW1hZ2VFbGVtZW50LCBvdmVybGF5OwoKICAgICAgICBydW50aW1lLmFzc2VydChwYXJlbnRFbGVtZW50LCAiaGV5YSwgbm8gc3VjaCBlbGVtZW50IHdpdGggaWQgIitwYXJlbnRFbGVtZW50SWQpOwoKICAgICAgICBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKGh0bWxucywgImRpdiIpOwogICAgICAgIGltYWdlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhodG1sbnMsICJpbWciKTsKICAgICAgICBpbWFnZUVsZW1lbnQuc3JjID0gc3ltYm9sRmlsZU5hbWU7CiAgICAgICAgb3ZlcmxheS5hcHBlbmRDaGlsZChpbWFnZUVsZW1lbnQpOwogICAgICAgIG92ZXJsYXkuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwogICAgICAgIG92ZXJsYXkuc3R5bGUudG9wID0gMjQqcG9zaXRpb24gKyAicHgiOwogICAgICAgIG92ZXJsYXkuc3R5bGUub3BhY2l0eSA9ICIwLjgiOwogICAgICAgIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICBwYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKG92ZXJsYXkpOwogICAgICAgIHJldHVybiBvdmVybGF5OwogICAgfQoKICAgIC8qKgogICAgICogU3dpdGNoZXMgdGhlIHBhZ2VzIGJ5IGhpZGluZyB0aGUgb2xkIG9uZSBhbmQgdW5oaWRpbmcgdGhlIG5ldwogICAgICogQHBhcmFtIHshc3RyaW5nfSBwYWdlSWQKICAgICAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIHN3aXRjaFRvUGFnZShwYWdlSWQpIHsKICAgICAgICBpZiAoY3VycmVudFBhZ2VJZCkgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjdXJyZW50UGFnZUlkKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIH0KICAgICAgICBjdXJyZW50UGFnZUlkID0gcGFnZUlkOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHBhZ2VJZCkuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIHshc3RyaW5nfQogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVMb2NhdGlvbldpdGhTZXNzaW9uSWQoc2Vzc2lvbklkKSB7CiAgICAgICAgdmFyIGxvY2F0aW9uID0gU3RyaW5nKGRvY3VtZW50LmxvY2F0aW9uKSwKICAgICAgICAgICAgcG9zID0gbG9jYXRpb24uaW5kZXhPZignIycpOwogICAgICAgIGlmIChwb3MgIT0gLTEpIHsKICAgICAgICAgICAgbG9jYXRpb24gPSBsb2NhdGlvbi5zdWJzdHIoMCwgcG9zKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlc3Npb25JZCkgewogICAgICAgICAgICBsb2NhdGlvbiA9IGxvY2F0aW9uICsgJyMnICsgc2Vzc2lvbklkOwogICAgICAgIH0KICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSgge30sICIiLCBsb2NhdGlvbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0YXJ0RWRpdGluZygpIHsKICAgICAgICBlZGl0b3JJbnN0YW5jZS5zdGFydEVkaXRpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBwYXJhbSB7IWJvb2xlYW49fSBpZ25vcmVFcnJvcgogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiBjbG9zZUVkaXRpbmcoaWdub3JlRXJyb3IpIHsKICAgICAgICBlZGl0b3JJbnN0YW5jZS5lbmRFZGl0aW5nKCk7CiAgICAgICAgZWRpdG9ySW5zdGFuY2UuY2xvc2VTZXNzaW9uKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBzZXJ2ZXIubGVhdmVTZXNzaW9uKGN1cnJlbnRTZXNzaW9uSWQsIGN1cnJlbnRNZW1iZXJJZCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzaG93U2Vzc2lvbnMoKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoaWdub3JlRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBzaG93U2Vzc2lvbnMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIFRPRE86IGVsc2UgcmVwb3J0IHByb2JsZW0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGhhbmRsZUVkaXRpbmdFcnJvcihlcnJvcikgewogICAgICAgIGFsZXJ0KCJTb21ldGhpbmcgd2VudCB3cm9uZzpcbiIrZXJyb3IpOwogICAgICAgIGNsb3NlRWRpdGluZyh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIHNob3dTZXNzaW9ucygpIHsKICAgICAgICBzd2l0Y2hUb1BhZ2UoInNlc3Npb25MaXN0Q29udGFpbmVyIik7CgogICAgICAgIHNlc3Npb25MaXN0LnNldFVwZGF0ZXNFbmFibGVkKHRydWUpOwoKICAgICAgICB1cGRhdGVMb2NhdGlvbldpdGhTZXNzaW9uSWQoIiIpOwogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIHshc3RyaW5nfSBzZXNzaW9uSWQKICAgICAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGVudGVyU2Vzc2lvbihzZXNzaW9uSWQpIHsKICAgICAgICBzd2l0Y2hUb1BhZ2UoIm1haW5Db250YWluZXIiKTsKCiAgICAgICAgc2Vzc2lvbkxpc3Quc2V0VXBkYXRlc0VuYWJsZWQoZmFsc2UpOwoKICAgICAgICB1cGRhdGVMb2NhdGlvbldpdGhTZXNzaW9uSWQoc2Vzc2lvbklkKTsKCiAgICAgICAgY3VycmVudFNlc3Npb25JZCA9IHNlc3Npb25JZDsKICAgICAgICBzZXJ2ZXIuam9pblNlc3Npb24odXNlcklkLCBzZXNzaW9uSWQsIGZ1bmN0aW9uKG1lbWJlcklkKSB7CiAgICAgICAgICAgIGN1cnJlbnRNZW1iZXJJZCA9IG1lbWJlcklkOwoKICAgICAgICAgICAgaWYgKCFlZGl0b3JJbnN0YW5jZSkgewogICAgICAgICAgICAgICAgcmVxdWlyZSh7IH0sIFsKICAgICAgICAgICAgICAgICJ3ZWJvZGYvZWRpdG9yL1RyYW5zbGF0b3IiLAogICAgICAgICAgICAgICAgIndlYm9kZi9lZGl0b3IvRWRpdG9yIl0sCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKFRyYW5zbGF0b3IsIEVkaXRvcikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxlID0gbmF2aWdhdG9yLmxhbmd1YWdlIHx8ICJlbi1VUyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0gbmV3IFRyYW5zbGF0b3IobG9jYWxlLCBmdW5jdGlvbiAoZWRpdG9yVHJhbnNsYXRvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bnRpbWUuc2V0VHJhbnNsYXRvcihlZGl0b3JUcmFuc2xhdG9yLnRyYW5zbGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2aW5nT3ZlcmxheSA9IGFkZFN0YXR1c092ZXJsYXkoImVkaXRvciIsICJkb2N1bWVudC1zYXZlLnBuZyIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc0xvY2FsVW5zeW5jZWRPcHNPdmVybGF5ID0gYWRkU3RhdHVzT3ZlcmxheSgiZWRpdG9yIiwgInZjcy1sb2NhbGx5LW1vZGlmaWVkLnBuZyIsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2Nvbm5lY3RlZE92ZXJsYXkgPSBhZGRTdGF0dXNPdmVybGF5KCJlZGl0b3IiLCAibmV0d29yay1kaXNjb25uZWN0LnBuZyIsIDEpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JPcHRpb25zID0gZWRpdG9yT3B0aW9ucyB8fCB7fTsgLy8gVE9ETzogY2xlYW51cAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvck9wdGlvbnMubmV0d29ya1NlY3VyaXR5VG9rZW4gPSB0b2tlbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JPcHRpb25zLmNsb3NlQ2FsbGJhY2sgPSBjbG9zZUVkaXRpbmc7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvckluc3RhbmNlID0gbmV3IEVkaXRvcihlZGl0b3JPcHRpb25zLCBzZXJ2ZXIsIHNlcnZlckZhY3RvcnkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvckluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXIoRWRpdG9yLkVWRU5UX0JFRk9SRVNBVkVUT0ZJTEUsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyKEVkaXRvci5FVkVOVF9TQVZFRFRPRklMRSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmluZ092ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3JJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyKEVkaXRvci5FVkVOVF9IQVNMT0NBTFVOU1lOQ0VET1BFUkFUSU9OU0NIQU5HRUQsIGZ1bmN0aW9uKGhhcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNMb2NhbFVuc3luY2VkT3BzT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gaGFzID8gIiIgOiAibm9uZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9ySW5zdGFuY2UuYWRkRXZlbnRMaXN0ZW5lcihFZGl0b3IuRVZFTlRfSEFTU0VTU0lPTkhPU1RDT05ORUNUSU9OQ0hBTkdFRCwgZnVuY3Rpb24oaGFzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2Nvbm5lY3RlZE92ZXJsYXkuc3R5bGUuZGlzcGxheSA9IGhhcyA/ICJub25lIiA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvckluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXIoRWRpdG9yLkVWRU5UX0VSUk9SLCBoYW5kbGVFZGl0aW5nRXJyb3IpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2FkIHRoZSBkb2N1bWVudCBhbmQgZ2V0IGNhbGxlZCBiYWNrIHdoZW4gaXQncyBsaXZlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9ySW5zdGFuY2Uub3BlblNlc3Npb24oc2Vzc2lvbklkLCBtZW1iZXJJZCwgc3RhcnRFZGl0aW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlZGl0b3JJbnN0YW5jZS5vcGVuU2Vzc2lvbihzZXNzaW9uSWQsIG1lbWJlcklkLCBzdGFydEVkaXRpbmcpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIC8vIFRPRE86IGhhbmRsZSBlcnJvcgogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogZXh0cmFjdCBzZXNzaW9uIGlkIGZyb20gdGhlIHVybC1mcmFnbWVudAogICAgICoKICAgICAqIEByZXR1cm4gez9zdHJpbmd9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGV4dHJhY3RTZXNzaW9uSWQoKSB7CiAgICAgICAgdmFyIHNlc3Npb25JZCA9IFN0cmluZyhkb2N1bWVudC5sb2NhdGlvbiksCiAgICAgICAgICAgIHBvcyA9IHNlc3Npb25JZC5pbmRleE9mKCcjJyk7CiAgICAgICAgcmV0dXJuIChwb3MgIT09IC0xKSA/IHNlc3Npb25JZC5zdWJzdHIocG9zICsgMSkgOiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogc3RhcnQgdGhlIGxvZ2luIHByb2Nlc3MgYnkgb2ZmZXJpbmcgYSBsb2dpbi9wYXNzd29yZCBwcm9tcHQuCiAgICAgKiBvbiBzdWNjZXNzIGEgbGlzdCBvZiBzZXNzaW9ucyBpcyBvZmZlcmVkLgogICAgICogd2hlbiB0aGUgdXNlciBzZWxlY3RzIGEgc2Vzc2lvbiB0aGUgY2FsbGJhY2sgaXMgY2FsbGVkCiAgICAgKiB3aXRoIHRoZSBzZXNzaW9uSWQgYXMgcGFyYW1ldGVyCiAgICAgKgogICAgICogQHBhcmFtIHshZnVuY3Rpb24oIXN0cmluZywgIXN0cmluZywgP3N0cmluZyl9IGNhbGxiYWNrCiAgICAgKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiBzdGFydExvZ2luUHJvY2VzcyhjYWxsYmFjaykgewogICAgICAgIGJvb3RpbmcgPSB0cnVlOwoKICAgICAgICBydW50aW1lLmFzc2VydChlZGl0b3JJbnN0YW5jZSA9PT0gbnVsbCwgImNhbm5vdCBib290IHdpdGggaW5zdGFuY2lhdGVkIGVkaXRvciIpOwoKICAgICAgICBmdW5jdGlvbiBsb2dpblN1Y2Nlc3ModXNlckRhdGEpIHsKICAgICAgICAgICAgcmVxdWlyZSh7IH0sIFsid2Vib2RmL2VkaXRvci9TZXNzaW9uTGlzdFZpZXciXSwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChTZXNzaW9uTGlzdFZpZXcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc2Vzc2lvbkxpc3REaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2Vzc2lvbkxpc3QiKSwKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbklkID0gZXh0cmFjdFNlc3Npb25JZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uTGlzdFZpZXc7CgogICAgICAgICAgICAgICAgICAgIHJ1bnRpbWUubG9nKCJjb25uZWN0ZWQ6IiArIHVzZXJEYXRhLmZ1bGxfbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgdXNlcklkID0gdXNlckRhdGEudWlkOwogICAgICAgICAgICAgICAgICAgIHRva2VuID0gdXNlckRhdGEuc2VjdXJpdHlUb2tlbiB8fCBudWxsOwoKICAgICAgICAgICAgICAgICAgICAvLyBhZGQgc2Vzc2lvbiBsaXN0aW5nCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkxpc3QgPSBuZXcgc2VydmVyRmFjdG9yeS5jcmVhdGVTZXNzaW9uTGlzdChzZXJ2ZXIpOwogICAgICAgICAgICAgICAgICAgIHNlc3Npb25MaXN0VmlldyA9IG5ldyBTZXNzaW9uTGlzdFZpZXcoc2Vzc2lvbkxpc3QsIHNlc3Npb25MaXN0RGl2LCBlbnRlclNlc3Npb24pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbklkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGNoZWNrIGlmIHNlc3Npb24gZXhpc3RzCiAgICAgICAgICAgICAgICAgICAgICAgIGVudGVyU2Vzc2lvbihzZXNzaW9uSWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaFRvUGFnZSgic2Vzc2lvbkxpc3RDb250YWluZXIiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsb2dpbkZhaWwocmVzdWx0KSB7CiAgICAgICAgICAgIGFsZXJ0KCJMb2dpbiBmYWlsZWQ6ICIgKyByZXN1bHQpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybnMgeyFib29sZWFufQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIG9uTG9naW5TdWJtaXQoKSB7CiAgICAgICAgICAgIHNlcnZlci5sb2dpbihkb2N1bWVudC5sb2dpbkZvcm0ubG9naW4udmFsdWUsIGRvY3VtZW50LmxvZ2luRm9ybS5wYXNzd29yZC52YWx1ZSwgbG9naW5TdWNjZXNzLCBsb2dpbkZhaWwpOwoKICAgICAgICAgICAgLy8gYmxvY2sgdGhlIHN1Ym1pdCBidXR0b24sIHdlIGFscmVhZHkgZGVhbHQgd2l0aCB0aGUgaW5wdXQKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gYnJpbmcgdXAgdGhlIGxvZ2luIGZvcm0KICAgICAgICBkb2N1bWVudC5sb2dpbkZvcm0uU3VibWl0Lm9uY2xpY2sgPSBvbkxvZ2luU3VibWl0OwogICAgICAgIHN3aXRjaFRvUGFnZSgibG9naW5Db250YWluZXIiKTsKICAgICAgICBkb2N1bWVudC5sb2dpbkZvcm0ubG9naW4uZm9jdXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBwYXJhbSB7IU9iamVjdH0gYXJncwogICAgICoKICAgICAqIGFyZ3M6CiAgICAgKgogICAgICogYmFja2VuZDogICBuYW1lIG9mIHRoZSBzZXJ2ZXIgdG8gdXNlCiAgICAgKgogICAgICogY2FsbGJhY2s6ICBjYWxsYmFjayB0byBiZSBjYWxsZWQgYXMgc29vbiBhcyB0aGUgZG9jdW1lbnQgaXMgbG9hZGVkCiAgICAgKgogICAgICogQHJldHVybnMge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gYm9vdChhcmdzKSB7CiAgICAgICAgcnVudGltZS5hc3NlcnQoIWJvb3RpbmcsICJlZGl0b3IgY3JlYXRpb24gYWxyZWFkeSBpbiBwcm9ncmVzcyIpOwoKICAgICAgICBpZiAoYXJncy5zYXZlQ2FsbGJhY2spIHsKICAgICAgICAgICAgZWRpdG9yT3B0aW9ucy5zYXZlQ2FsbGJhY2sgPSBhcmdzLnNhdmVDYWxsYmFjazsKICAgICAgICB9CgogICAgICAgIC8vIHN0YXJ0IHRoZSBlZGl0b3Igd2l0aCBuZXR3b3JrCiAgICAgICAgcnVudGltZS5sb2coInN0YXJ0aW5nIGNvbGxhYm9yYXRpdmUgZWRpdG9yIGZvciBbIithcmdzLmJhY2tlbmQrIl0uIik7CiAgICAgICAgcmVxdWlyZSh7IH0sIFsid2Vib2RmL2VkaXRvci9zZXJ2ZXIvIithcmdzLmJhY2tlbmQrIi9TZXJ2ZXJGYWN0b3J5Il0sIGZ1bmN0aW9uIChTZXJ2ZXJGYWN0b3J5KSB7CiAgICAgICAgICAgIHNlcnZlckZhY3RvcnkgPSBuZXcgU2VydmVyRmFjdG9yeSgpOwogICAgICAgICAgICBzZXJ2ZXIgPSBzZXJ2ZXJGYWN0b3J5LmNyZWF0ZVNlcnZlcigpOwogICAgICAgICAgICAvLyB3YWl0IGZvciBhIG5ldHdvcmsgY29ubmVjdGlvbiB0byBlc3RhYmxpc2guCiAgICAgICAgICAgIC8vIGNhbGwgdGhlIGNhbGxiYWNrIHdoZW4gZG9uZSwgd2hlbiBmaW5hbGx5IGZhaWxlZCwgb3IKICAgICAgICAgICAgLy8gd2hlbiBhIHRpbWVvdXQgcmVhY2hlZC4KICAgICAgICAgICAgLy8gdGhlIHBhcmFtZXRlciB0byB0aGUgY2FsbGJhY2sgaXMgYSBzdHJpbmcgd2l0aCB0aGUgcG9zc2libGUKICAgICAgICAgICAgLy8gdmFsdWVzOiAidW5hdmFpbGFibGUiLCAidGltZW91dCIsICJyZWFkeSIKICAgICAgICAgICAgc2VydmVyLmNvbm5lY3QoODAwMCwgZnVuY3Rpb24gKHN0YXRlKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09ICJyZWFkeSIpIHsKICAgICAgICAgICAgICAgICAgICBzdGFydExvZ2luUHJvY2VzcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBleHBvc2VkIEFQSQogICAgcmV0dXJuIHsgYm9vdDogYm9vdCB9Owp9KCkpOwoK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 02:40:35 GMT",
                    "Content-Length": "12573",
                    "Date": "Sun, 09 Nov 2014 02:41:02 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}