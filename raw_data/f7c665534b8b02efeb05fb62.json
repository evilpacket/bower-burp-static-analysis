{
    "url": "http://localhost:9999/MinnPost/minnpost-styles/bower_components/datatables/media/js/jquery.dataTables.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cookie manipulation (DOM-based)",
    "issueType": 5245696,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based cookie manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the value of a cookie in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will set an arbitrary value in the user's cookie.<br><br>The potential impact of the vulnerability depends on the role that the cookie plays within the application. If the cookie is used to control the behavior that results from certain user actions (for example, a 'production' versus 'demo' mode setting), then the attacker may be able to cause the user to perform unintended actions by manipulating the cookie's value. If the cookie is used to track the user's session, then the attacker may be able to perform a session fixation attack, in which they set the cookie's value to a valid token that they have obtained from the application, and then hijack the session during the victim user's subsequent interaction with the application.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cookie manipulation vulnerabilities is not to dynamically write to cookies using data that originated from any untrusted source. This behavior should never be implemented for cookies that have any role in controlling privileged actions or user sessions within the application.",
    "issueDetail": "The application may be vulnerable to DOM-based cookie manipulation. Data is read from <b>window.location.pathname</b> and written to <b>document.cookie</b> via the following statements:<ul><li>var aParts = window.location.pathname.split('/');</li><li>document.cookie = old.name+\"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=\"+       aParts.join('/') + \"/\";</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/MinnPost/minnpost-styles/bower_components/datatables/media/js/jquery.dataTables.js",
                "path": "/MinnPost/minnpost-styles/bower_components/datatables/media/js/jquery.dataTables.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9NaW5uUG9zdC9taW5ucG9zdC1zdHlsZXMvYm93ZXJfY29tcG9uZW50cy9kYXRhdGFibGVzL21lZGlhL2pzL2pxdWVyeS5kYXRhVGFibGVzLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMzc3NTA4DQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBGcmksIDA3IE5vdiAyMDE0IDE2OjA5OjQ4IEdNVA0KTGFzdC1Nb2RpZmllZDogRnJpLCAwNyBOb3YgMjAxNCAxNjowOTo0NiBHTVQNCg0KLyoqCiAqIEBzdW1tYXJ5ICAgICBEYXRhVGFibGVzCiAqIEBkZXNjcmlwdGlvbiBQYWdpbmF0ZSwgc2VhcmNoIGFuZCBzb3J0IEhUTUwgdGFibGVzCiAqIEB2ZXJzaW9uICAgICAxLjkuNAogKiBAZmlsZSAgICAgICAganF1ZXJ5LmRhdGFUYWJsZXMuanMKICogQGF1dGhvciAgICAgIEFsbGFuIEphcmRpbmUgKHd3dy5zcHJ5bWVkaWEuY28udWspCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QKICoKICogQGNvcHlyaWdodCBDb3B5cmlnaHQgMjAwOC0yMDEyIEFsbGFuIEphcmRpbmUsIGFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZnJlZSBzb2Z0d2FyZSwgdW5kZXIgZWl0aGVyIHRoZSBHUEwgdjIgbGljZW5zZSBvciBhCiAqIEJTRCBzdHlsZSBsaWNlbnNlLCBhdmFpbGFibGUgYXQ6CiAqICAgaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2VfZ3BsMgogKiAgIGh0dHA6Ly9kYXRhdGFibGVzLm5ldC9saWNlbnNlX2JzZAogKiAKICogVGhpcyBzb3VyY2UgZmlsZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIAogKiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLgogKiAKICogRm9yIGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvOiBodHRwOi8vd3d3LmRhdGF0YWJsZXMubmV0CiAqLwoKLypqc2xpbnQgZXZpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIGJyb3dzZXI6IHRydWUgKi8KLypnbG9iYWxzICQsIGpRdWVyeSxkZWZpbmUsX2ZuRXh0ZXJuQXBpRnVuYyxfZm5Jbml0aWFsaXNlLF9mbkluaXRDb21wbGV0ZSxfZm5MYW5ndWFnZUNvbXBhdCxfZm5BZGRDb2x1bW4sX2ZuQ29sdW1uT3B0aW9ucyxfZm5BZGREYXRhLF9mbkNyZWF0ZVRyLF9mbkdhdGhlckRhdGEsX2ZuQnVpbGRIZWFkLF9mbkRyYXdIZWFkLF9mbkRyYXcsX2ZuUmVEcmF3LF9mbkFqYXhVcGRhdGUsX2ZuQWpheFBhcmFtZXRlcnMsX2ZuQWpheFVwZGF0ZURyYXcsX2ZuU2VydmVyUGFyYW1zLF9mbkFkZE9wdGlvbnNIdG1sLF9mbkZlYXR1cmVIdG1sVGFibGUsX2ZuU2Nyb2xsRHJhdyxfZm5BZGp1c3RDb2x1bW5TaXppbmcsX2ZuRmVhdHVyZUh0bWxGaWx0ZXIsX2ZuRmlsdGVyQ29tcGxldGUsX2ZuRmlsdGVyQ3VzdG9tLF9mbkZpbHRlckNvbHVtbixfZm5GaWx0ZXIsX2ZuQnVpbGRTZWFyY2hBcnJheSxfZm5CdWlsZFNlYXJjaFJvdyxfZm5GaWx0ZXJDcmVhdGVTZWFyY2gsX2ZuRGF0YVRvU2VhcmNoLF9mblNvcnQsX2ZuU29ydEF0dGFjaExpc3RlbmVyLF9mblNvcnRpbmdDbGFzc2VzLF9mbkZlYXR1cmVIdG1sUGFnaW5hdGUsX2ZuUGFnZUNoYW5nZSxfZm5GZWF0dXJlSHRtbEluZm8sX2ZuVXBkYXRlSW5mbyxfZm5GZWF0dXJlSHRtbExlbmd0aCxfZm5GZWF0dXJlSHRtbFByb2Nlc3NpbmcsX2ZuUHJvY2Vzc2luZ0Rpc3BsYXksX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgsX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUsX2ZuTm9kZVRvRGF0YUluZGV4LF9mblZpc2JsZUNvbHVtbnMsX2ZuQ2FsY3VsYXRlRW5kLF9mbkNvbnZlcnRUb1dpZHRoLF9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyxfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCxfZm5HZXRXaWRlc3ROb2RlLF9mbkdldE1heExlblN0cmluZyxfZm5TdHJpbmdUb0NzcyxfZm5EZXRlY3RUeXBlLF9mblNldHRpbmdzRnJvbU5vZGUsX2ZuR2V0RGF0YU1hc3RlcixfZm5HZXRUck5vZGVzLF9mbkdldFRkTm9kZXMsX2ZuRXNjYXBlUmVnZXgsX2ZuRGVsZXRlSW5kZXgsX2ZuUmVPcmRlckluZGV4LF9mbkNvbHVtbk9yZGVyaW5nLF9mbkxvZyxfZm5DbGVhclRhYmxlLF9mblNhdmVTdGF0ZSxfZm5Mb2FkU3RhdGUsX2ZuQ3JlYXRlQ29va2llLF9mblJlYWRDb29raWUsX2ZuRGV0ZWN0SGVhZGVyLF9mbkdldFVuaXF1ZVRocyxfZm5TY3JvbGxCYXJXaWR0aCxfZm5BcHBseVRvQ2hpbGRyZW4sX2ZuTWFwLF9mbkdldFJvd0RhdGEsX2ZuR2V0Q2VsbERhdGEsX2ZuU2V0Q2VsbERhdGEsX2ZuR2V0T2JqZWN0RGF0YUZuLF9mblNldE9iamVjdERhdGFGbixfZm5BcHBseUNvbHVtbkRlZnMsX2ZuQmluZEFjdGlvbixfZm5DYWxsYmFja1JlZyxfZm5DYWxsYmFja0ZpcmUsX2ZuSnNvblN0cmluZyxfZm5SZW5kZXIsX2ZuTm9kZVRvQ29sdW1uSW5kZXgsX2ZuSW5mb01hY3JvcyxfZm5Ccm93c2VyRGV0ZWN0LF9mbkdldENvbHVtbnMqLwoKKC8qKiBAbGVuZHMgPGdsb2JhbD4gKi9mdW5jdGlvbiggd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkICkgewoKKGZ1bmN0aW9uKCBmYWN0b3J5ICkgewoJInVzZSBzdHJpY3QiOwoKCS8vIERlZmluZSBhcyBhbiBBTUQgbW9kdWxlIGlmIHBvc3NpYmxlCglpZiAoIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCApCgl7CgkJZGVmaW5lKCBbJ2pxdWVyeSddLCBmYWN0b3J5ICk7Cgl9CgkvKiBEZWZpbmUgdXNpbmcgYnJvd3NlciBnbG9iYWxzIG90aGVyd2lzZQoJICogUHJldmVudCBtdWx0aXBsZSBpbnN0YW50aWF0aW9ucyBpZiB0aGUgc2NyaXB0IGlzIGxvYWRlZCB0d2ljZQoJICovCgllbHNlIGlmICggalF1ZXJ5ICYmICFqUXVlcnkuZm4uZGF0YVRhYmxlICkKCXsKCQlmYWN0b3J5KCBqUXVlcnkgKTsKCX0KfQooLyoqIEBsZW5kcyA8Z2xvYmFsPiAqL2Z1bmN0aW9uKCAkICkgewoJInVzZSBzdHJpY3QiOwoJLyoqIAoJICogRGF0YVRhYmxlcyBpcyBhIHBsdWctaW4gZm9yIHRoZSBqUXVlcnkgSmF2YXNjcmlwdCBsaWJyYXJ5LiBJdCBpcyBhIAoJICogaGlnaGx5IGZsZXhpYmxlIHRvb2wsIGJhc2VkIHVwb24gdGhlIGZvdW5kYXRpb25zIG9mIHByb2dyZXNzaXZlIAoJICogZW5oYW5jZW1lbnQsIHdoaWNoIHdpbGwgYWRkIGFkdmFuY2VkIGludGVyYWN0aW9uIGNvbnRyb2xzIHRvIGFueSAKCSAqIEhUTUwgdGFibGUuIEZvciBhIGZ1bGwgbGlzdCBvZiBmZWF0dXJlcyBwbGVhc2UgcmVmZXIgdG8KCSAqIDxhIGhyZWY9Imh0dHA6Ly9kYXRhdGFibGVzLm5ldCI+RGF0YVRhYmxlcy5uZXQ8L2E+LgoJICoKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlPC9pPiBvYmplY3QgaXMgbm90IGEgZ2xvYmFsIHZhcmlhYmxlIGJ1dCBpcwoJICogYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uRGF0YVRhYmxlPC9pPiBhbmQgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZTwvaT4gdGhyb3VnaCB3aGljaCAKCSAqIGl0IG1heSBiZSAgYWNjZXNzZWQuCgkgKgoJICogIEBjbGFzcwoJICogIEBwYXJhbSB7b2JqZWN0fSBbb0luaXQ9e31dIENvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciBEYXRhVGFibGVzLiBPcHRpb25zCgkgKiAgICBhcmUgZGVmaW5lZCBieSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfQoJICogIEByZXF1aXJlcyBqUXVlcnkgMS4zKwoJICogCgkgKiAgQGV4YW1wbGUKCSAqICAgIC8vIEJhc2ljIGluaXRpYWxpc2F0aW9uCgkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gewoJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJICogICAgfSApOwoJICogIAoJICogIEBleGFtcGxlCgkgKiAgICAvLyBJbml0aWFsaXNhdGlvbiB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyAtIGluIHRoaXMgY2FzZSwgZGlzYWJsZQoJICogICAgLy8gcGFnaW5hdGlvbiBhbmQgc29ydGluZy4KCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiB7CgkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlLAoJICogICAgICAgICJiU29ydCI6IGZhbHNlIAoJICogICAgICB9ICk7CgkgKiAgICB9ICk7CgkgKi8KCXZhciBEYXRhVGFibGUgPSBmdW5jdGlvbiggb0luaXQgKQoJewoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhIGNvbHVtbiB0byB0aGUgbGlzdCB1c2VkIGZvciB0aGUgdGFibGUgd2l0aCBkZWZhdWx0IHZhbHVlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gblRoIFRoZSB0aCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncywgblRoICkKCQl7CgkJCXZhciBvRGVmYXVsdHMgPSBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uczsKCQkJdmFyIGlDb2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9Db2wgPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiwgb0RlZmF1bHRzLCB7CgkJCQkic1NvcnRpbmdDbGFzcyI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQkic1NvcnRpbmdDbGFzc0pVSSI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSSwKCQkJCSJuVGgiOiBuVGggPyBuVGggOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpLAoJCQkJInNUaXRsZSI6ICAgIG9EZWZhdWx0cy5zVGl0bGUgICAgPyBvRGVmYXVsdHMuc1RpdGxlICAgIDogblRoID8gblRoLmlubmVySFRNTCA6ICcnLAoJCQkJImFEYXRhU29ydCI6IG9EZWZhdWx0cy5hRGF0YVNvcnQgPyBvRGVmYXVsdHMuYURhdGFTb3J0IDogW2lDb2xdLAoJCQkJIm1EYXRhIjogb0RlZmF1bHRzLm1EYXRhID8gb0RlZmF1bHRzLm9EZWZhdWx0cyA6IGlDb2wKCQkJfSApOwoJCQlvU2V0dGluZ3MuYW9Db2x1bW5zLnB1c2goIG9Db2wgKTsKCQkJCgkJCS8qIEFkZCBhIGNvbHVtbiBzcGVjaWZpYyBmaWx0ZXIgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPT09IHVuZGVmaW5lZCB8fCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPT09IG51bGwgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJdmFyIG9QcmUgPSBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF07CgkJCQkKCQkJCS8qIERvbid0IHJlcXVpcmUgdGhhdCB0aGUgdXNlciBtdXN0IHNwZWNpZnkgYlJlZ2V4LCBiU21hcnQgb3IgYkNhc2VJbnNlbnNpdGl2ZSAqLwoJCQkJaWYgKCBvUHJlLmJSZWdleCA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJSZWdleCA9IHRydWU7CgkJCQl9CgkJCQkKCQkJCWlmICggb1ByZS5iU21hcnQgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1ByZS5iU21hcnQgPSB0cnVlOwoJCQkJfQoJCQkJCgkJCQlpZiAoIG9QcmUuYkNhc2VJbnNlbnNpdGl2ZSA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJDYXNlSW5zZW5zaXRpdmUgPSB0cnVlOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBVc2UgdGhlIGNvbHVtbiBvcHRpb25zIGZ1bmN0aW9uIHRvIGluaXRpYWxpc2UgY2xhc3NlcyBldGMgKi8KCQkJX2ZuQ29sdW1uT3B0aW9ucyggb1NldHRpbmdzLCBpQ29sLCBudWxsICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFwcGx5IG9wdGlvbnMgZm9yIGEgY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgY29sdW1uIGluZGV4IHRvIGNvbnNpZGVyCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvT3B0aW9ucyBvYmplY3Qgd2l0aCBzVHlwZSwgYlZpc2libGUgYW5kIGJTZWFyY2hhYmxlIGV0YwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG9PcHRpb25zICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbCBdOwoJCQkKCQkJLyogVXNlciBzcGVjaWZpZWQgY29sdW1uIG9wdGlvbnMgKi8KCQkJaWYgKCBvT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIG9PcHRpb25zICE9PSBudWxsICkKCQkJewoJCQkJLyogQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZm9yIG1EYXRhUHJvcCAqLwoJCQkJaWYgKCBvT3B0aW9ucy5tRGF0YVByb3AgJiYgIW9PcHRpb25zLm1EYXRhICkKCQkJCXsKCQkJCQlvT3B0aW9ucy5tRGF0YSA9IG9PcHRpb25zLm1EYXRhUHJvcDsKCQkJCX0KCQkKCQkJCWlmICggb09wdGlvbnMuc1R5cGUgIT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb0NvbC5zVHlwZSA9IG9PcHRpb25zLnNUeXBlOwoJCQkJCW9Db2wuX2JBdXRvVHlwZSA9IGZhbHNlOwoJCQkJfQoJCQkJCgkJCQkkLmV4dGVuZCggb0NvbCwgb09wdGlvbnMgKTsKCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJzV2lkdGgiLCAic1dpZHRoT3JpZyIgKTsKCQkKCQkJCS8qIGlEYXRhU29ydCB0byBiZSBhcHBsaWVkIChiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSksIGJ1dCBhRGF0YVNvcnQgd2lsbCB0YWtlCgkJCQkgKiBwcmlvcml0eSBpZiBkZWZpbmVkCgkJCQkgKi8KCQkJCWlmICggb09wdGlvbnMuaURhdGFTb3J0ICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9Db2wuYURhdGFTb3J0ID0gWyBvT3B0aW9ucy5pRGF0YVNvcnQgXTsKCQkJCX0KCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJhRGF0YVNvcnQiICk7CgkJCX0KCQkKCQkJLyogQ2FjaGUgdGhlIGRhdGEgZ2V0IGFuZCBzZXQgZnVuY3Rpb25zIGZvciBzcGVlZCAqLwoJCQl2YXIgbVJlbmRlciA9IG9Db2wubVJlbmRlciA/IF9mbkdldE9iamVjdERhdGFGbiggb0NvbC5tUmVuZGVyICkgOiBudWxsOwoJCQl2YXIgbURhdGEgPSBfZm5HZXRPYmplY3REYXRhRm4oIG9Db2wubURhdGEgKTsKCQkKCQkJb0NvbC5mbkdldERhdGEgPSBmdW5jdGlvbiAob0RhdGEsIHNTcGVjaWZpYykgewoJCQkJdmFyIGlubmVyRGF0YSA9IG1EYXRhKCBvRGF0YSwgc1NwZWNpZmljICk7CgkJCgkJCQlpZiAoIG9Db2wubVJlbmRlciAmJiAoc1NwZWNpZmljICYmIHNTcGVjaWZpYyAhPT0gJycpICkKCQkJCXsKCQkJCQlyZXR1cm4gbVJlbmRlciggaW5uZXJEYXRhLCBzU3BlY2lmaWMsIG9EYXRhICk7CgkJCQl9CgkJCQlyZXR1cm4gaW5uZXJEYXRhOwoJCQl9OwoJCQlvQ29sLmZuU2V0RGF0YSA9IF9mblNldE9iamVjdERhdGFGbiggb0NvbC5tRGF0YSApOwoJCQkKCQkJLyogRmVhdHVyZSBzb3J0aW5nIG92ZXJyaWRlcyBjb2x1bW4gc3BlY2lmaWMgd2hlbiBvZmYgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCW9Db2wuYlNvcnRhYmxlID0gZmFsc2U7CgkJCX0KCQkJCgkJCS8qIENoZWNrIHRoYXQgdGhlIGNsYXNzIGFzc2lnbm1lbnQgaXMgY29ycmVjdCBmb3Igc29ydGluZyAqLwoJCQlpZiAoICFvQ29sLmJTb3J0YWJsZSB8fAoJCQkJICgkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEpICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZU5vbmU7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSAiIjsKCQkJfQoJCQllbHNlIGlmICggJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZTsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSTsKCQkJfQoJCQllbHNlIGlmICggJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgIT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZUFzYzsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSUFzY0FsbG93ZWQ7CgkJCX0KCQkJZWxzZSBpZiAoICQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSAhPSAtMSApCgkJCXsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVEZXNjOwoJCQkJb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQ7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQWRqdXN0IHRoZSB0YWJsZSBjb2x1bW4gd2lkdGhzIGZvciBuZXcgZGF0YS4gTm90ZTogeW91IHdvdWxkIHByb2JhYmx5IHdhbnQgdG8gCgkJICogZG8gYSByZWRyYXcgYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uIQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkanVzdENvbHVtblNpemluZyAoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBOb3QgaW50ZXJlc3RlZCBpbiBkb2luZyBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaWYgYXV0by13aWR0aCBpcyBkaXNhYmxlZCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCA9PT0gZmFsc2UgKQoJCQl7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJCgkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCWZvciAoIHZhciBpPTAgLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGguc3R5bGUud2lkdGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDb3ZlcnQgdGhlIGluZGV4IG9mIGEgdmlzaWJsZSBjb2x1bW4gdG8gdGhlIGluZGV4IGluIHRoZSBkYXRhIGFycmF5ICh0YWtlIGFjY291bnQKCQkgKiBvZiBoaWRkZW4gY29sdW1ucykKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaU1hdGNoIFZpc2libGUgY29sdW1uIGluZGV4IHRvIGxvb2t1cAoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBkYXRhIGluZGV4CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblZpc2libGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlNYXRjaCApCgkJewoJCQl2YXIgYWlWaXMgPSBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiVmlzaWJsZScgKTsKCQkKCQkJcmV0dXJuIHR5cGVvZiBhaVZpc1tpTWF0Y2hdID09PSAnbnVtYmVyJyA/CgkJCQlhaVZpc1tpTWF0Y2hdIDoKCQkJCW51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvdmVydCB0aGUgaW5kZXggb2YgYW4gaW5kZXggaW4gdGhlIGRhdGEgYXJyYXkgYW5kIGNvbnZlcnQgaXQgdG8gdGhlIHZpc2libGUKCQkgKiAgIGNvbHVtbiBpbmRleCAodGFrZSBhY2NvdW50IG9mIGhpZGRlbiBjb2x1bW5zKQoJCSAqICBAcGFyYW0ge2ludH0gaU1hdGNoIENvbHVtbiBpbmRleCB0byBsb29rdXAKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBkYXRhIGluZGV4CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKCBvU2V0dGluZ3MsIGlNYXRjaCApCgkJewoJCQl2YXIgYWlWaXMgPSBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiVmlzaWJsZScgKTsKCQkJdmFyIGlQb3MgPSAkLmluQXJyYXkoIGlNYXRjaCwgYWlWaXMgKTsKCQkKCQkJcmV0dXJuIGlQb3MgIT09IC0xID8gaVBvcyA6IG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbnVtYmVyIG9mIHZpc2libGUgY29sdW1ucwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIG51bWJlciBvZiB2aXNpYmxlIGNvbHVtbnMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICkKCQl7CgkJCXJldHVybiBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiVmlzaWJsZScgKS5sZW5ndGg7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiBjb2x1bW4gaW5kZXhlcyB0aGF0IG1hdGNoIGEgZ2l2ZW4gcHJvcGVydHkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1BhcmFtIFBhcmFtZXRlciBpbiBhb0NvbHVtbnMgdG8gbG9vayBmb3IgLSB0eXBpY2FsbHkgCgkJICogICAgYlZpc2libGUgb3IgYlNlYXJjaGFibGUKCQkgKiAgQHJldHVybnMge2FycmF5fSBBcnJheSBvZiBpbmRleGVzIHdpdGggbWF0Y2hlZCBwcm9wZXJ0aWVzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgc1BhcmFtICkKCQl7CgkJCXZhciBhID0gW107CgkJCgkJCSQubWFwKCBvU2V0dGluZ3MuYW9Db2x1bW5zLCBmdW5jdGlvbih2YWwsIGkpIHsKCQkJCWlmICggdmFsW3NQYXJhbV0gKSB7CgkJCQkJYS5wdXNoKCBpICk7CgkJCQl9CgkJCX0gKTsKCQkKCQkJcmV0dXJuIGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgc29ydCB0eXBlIGJhc2VkIG9uIGFuIGlucHV0IHN0cmluZwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0RhdGEgZGF0YSB3ZSB3aXNoIHRvIGtub3cgdGhlIHR5cGUgb2YKCQkgKiAgQHJldHVybnMge3N0cmluZ30gdHlwZSAoZGVmYXVsdHMgdG8gJ3N0cmluZycgaWYgbm8gdHlwZSBjYW4gYmUgZGV0ZWN0ZWQpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRldGVjdFR5cGUoIHNEYXRhICkKCQl7CgkJCXZhciBhVHlwZXMgPSBEYXRhVGFibGUuZXh0LmFUeXBlczsKCQkJdmFyIGlMZW4gPSBhVHlwZXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXZhciBzVHlwZSA9IGFUeXBlc1tpXSggc0RhdGEgKTsKCQkJCWlmICggc1R5cGUgIT09IG51bGwgKQoJCQkJewoJCQkJCXJldHVybiBzVHlwZTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuICdzdHJpbmcnOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWd1cmUgb3V0IGhvdyB0byByZW9yZGVyIGEgZGlzcGxheSBsaXN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMgYXJyYXkge2ludH0gYWlSZXR1cm4gaW5kZXggbGlzdCBmb3IgcmVvcmRlcmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZU9yZGVySW5kZXggKCBvU2V0dGluZ3MsIHNDb2x1bW5zICkKCQl7CgkJCXZhciBhQ29sdW1ucyA9IHNDb2x1bW5zLnNwbGl0KCcsJyk7CgkJCXZhciBhaVJldHVybiA9IFtdOwoJCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAgOyBqPGlMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zTmFtZSA9PSBhQ29sdW1uc1tqXSApCgkJCQkJewoJCQkJCQlhaVJldHVybi5wdXNoKCBqICk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFpUmV0dXJuOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGNvbHVtbiBvcmRlcmluZyB0aGF0IERhdGFUYWJsZXMgZXhwZWN0cwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIG5hbWVzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbHVtbk9yZGVyaW5nICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBzTmFtZXMgPSAnJzsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXNOYW1lcyArPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNOYW1lKycsJzsKCQkJfQoJCQlpZiAoIHNOYW1lcy5sZW5ndGggPT0gaUxlbiApCgkJCXsKCQkJCXJldHVybiAiIjsKCQkJfQoJCQlyZXR1cm4gc05hbWVzLnNsaWNlKDAsIC0xKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSB0aGUgY29sdW1uIGRlZmluaXRpb25zIGFuZCBzdGF0aWMgY29sdW1ucyBhcnJheXMgYW5kIGNhbGN1bGF0ZSBob3cKCQkgKiB0aGV5IHJlbGF0ZSB0byBjb2x1bW4gaW5kZXhlcy4gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgdGhlbiBhcHBseSB0aGUKCQkgKiBkZWZpbml0aW9uIGZvdW5kIGZvciBhIGNvbHVtbiB0byBhIHN1aXRhYmxlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7YXJyYXl9IGFvQ29sRGVmcyBUaGUgYW9Db2x1bW5EZWZzIGFycmF5IHRoYXQgaXMgdG8gYmUgYXBwbGllZAoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0NvbHMgVGhlIGFvQ29sdW1ucyBhcnJheSB0aGF0IGRlZmluZXMgY29sdW1ucyBpbmRpdmlkdWFsbHkKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gQ2FsbGJhY2sgZnVuY3Rpb24gLSB0YWtlcyB0d28gcGFyYW1ldGVycywgdGhlIGNhbGN1bGF0ZWQKCQkgKiAgICBjb2x1bW4gaW5kZXggYW5kIHRoZSBkZWZpbml0aW9uIGZvciB0aGF0IGNvbHVtbi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQXBwbHlDb2x1bW5EZWZzKCBvU2V0dGluZ3MsIGFvQ29sRGVmcywgYW9Db2xzLCBmbiApCgkJewoJCQl2YXIgaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbjsKCQkKCQkJLy8gQ29sdW1uIGRlZmluaXRpb25zIHdpdGggYVRhcmdldHMKCQkJaWYgKCBhb0NvbERlZnMgKQoJCQl7CgkJCQkvKiBMb29wIG92ZXIgdGhlIGRlZmluaXRpb25zIGFycmF5IC0gbG9vcCBpbiByZXZlcnNlIHNvIGZpcnN0IGluc3RhbmNlIGhhcyBwcmlvcml0eSAqLwoJCQkJZm9yICggaT1hb0NvbERlZnMubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJCXsKCQkJCQkvKiBFYWNoIGRlZmluaXRpb24gY2FuIHRhcmdldCBtdWx0aXBsZSBjb2x1bW5zLCBhcyBpdCBpcyBhbiBhcnJheSAqLwoJCQkJCXZhciBhVGFyZ2V0cyA9IGFvQ29sRGVmc1tpXS5hVGFyZ2V0czsKCQkJCQlpZiAoICEkLmlzQXJyYXkoIGFUYXJnZXRzICkgKQoJCQkJCXsKCQkJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDEsICdhVGFyZ2V0cyBtdXN0IGJlIGFuIGFycmF5IG9mIHRhcmdldHMsIG5vdCBhICcrKHR5cGVvZiBhVGFyZ2V0cykgKTsKCQkJCQl9CgkJCgkJCQkJZm9yICggaj0wLCBqTGVuPWFUYXJnZXRzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIHR5cGVvZiBhVGFyZ2V0c1tqXSA9PT0gJ251bWJlcicgJiYgYVRhcmdldHNbal0gPj0gMCApCgkJCQkJCXsKCQkJCQkJCS8qIEFkZCBjb2x1bW5zIHRoYXQgd2UgZG9uJ3QgeWV0IGtub3cgYWJvdXQgKi8KCQkJCQkJCXdoaWxlKCBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA8PSBhVGFyZ2V0c1tqXSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuQWRkQ29sdW1uKCBvU2V0dGluZ3MgKTsKCQkJCQkJCX0KCQkKCQkJCQkJCS8qIEludGVnZXIsIGJhc2ljIGluZGV4ICovCgkJCQkJCQlmbiggYVRhcmdldHNbal0sIGFvQ29sRGVmc1tpXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdudW1iZXInICYmIGFUYXJnZXRzW2pdIDwgMCApCgkJCQkJCXsKCQkJCQkJCS8qIE5lZ2F0aXZlIGludGVnZXIsIHJpZ2h0IHRvIGxlZnQgY29sdW1uIGNvdW50aW5nICovCgkJCQkJCQlmbiggb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGgrYVRhcmdldHNbal0sIGFvQ29sRGVmc1tpXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdzdHJpbmcnICkKCQkJCQkJewoJCQkJCQkJLyogQ2xhc3MgbmFtZSBtYXRjaGluZyBvbiBUSCBlbGVtZW50ICovCgkJCQkJCQlmb3IgKCBrPTAsIGtMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQkJewoJCQkJCQkJCWlmICggYVRhcmdldHNbal0gPT0gIl9hbGwiIHx8CgkJCQkJCQkJICAgICAkKG9TZXR0aW5ncy5hb0NvbHVtbnNba10ublRoKS5oYXNDbGFzcyggYVRhcmdldHNbal0gKSApCgkJCQkJCQkJewoJCQkJCQkJCQlmbiggaywgYW9Db2xEZWZzW2ldICk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8vIFN0YXRpY2FsbHkgZGVmaW5lZCBjb2x1bW5zIGFycmF5CgkJCWlmICggYW9Db2xzICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFvQ29scy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWZuKCBpLCBhb0NvbHNbaV0gKTsKCQkJCX0KCQkJfQoJCX0KCQkKCQkvKioKCQkgKiBBZGQgYSBkYXRhIGFycmF5IHRvIHRoZSB0YWJsZSwgY3JlYXRpbmcgRE9NIG5vZGUgZXRjLiBUaGlzIGlzIHRoZSBwYXJhbGxlbCB0byAKCQkgKiBfZm5HYXRoZXJEYXRhLCBidXQgZm9yIGFkZGluZyByb3dzIGZyb20gYSBKYXZhc2NyaXB0IHNvdXJjZSwgcmF0aGVyIHRoYW4gYQoJCSAqIERPTSBzb3VyY2UuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgZGF0YSBhcnJheSB0byBiZSBhZGRlZAoJCSAqICBAcmV0dXJucyB7aW50fSA+PTAgaWYgc3VjY2Vzc2Z1bCAoaW5kZXggb2YgbmV3IGFvRGF0YSBlbnRyeSksIC0xIGlmIGZhaWxlZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGREYXRhICggb1NldHRpbmdzLCBhRGF0YVN1cHBsaWVkICkKCQl7CgkJCXZhciBvQ29sOwoJCQkKCQkJLyogVGFrZSBhbiBpbmRlcGVuZGVudCBjb3B5IG9mIHRoZSBkYXRhIHNvdXJjZSBzbyB3ZSBjYW4gYmFzaCBpdCBhYm91dCBhcyB3ZSB3aXNoICovCgkJCXZhciBhRGF0YUluID0gKCQuaXNBcnJheShhRGF0YVN1cHBsaWVkKSkgPwoJCQkJYURhdGFTdXBwbGllZC5zbGljZSgpIDoKCQkJCSQuZXh0ZW5kKCB0cnVlLCB7fSwgYURhdGFTdXBwbGllZCApOwoJCQkKCQkJLyogQ3JlYXRlIHRoZSBvYmplY3QgZm9yIHN0b3JpbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyBuZXcgcm93ICovCgkJCXZhciBpUm93ID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCXZhciBvRGF0YSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vUm93ICk7CgkJCW9EYXRhLl9hRGF0YSA9IGFEYXRhSW47CgkJCW9TZXR0aW5ncy5hb0RhdGEucHVzaCggb0RhdGEgKTsKCQkKCQkJLyogQ3JlYXRlIHRoZSBjZWxscyAqLwoJCQl2YXIgblRkLCBzVGhpc1R5cGU7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkKCQkJCS8qIFVzZSByZW5kZXJlZCBkYXRhIGZvciBmaWx0ZXJpbmcgLyBzb3J0aW5nICovCgkJCQlpZiAoIHR5cGVvZiBvQ29sLmZuUmVuZGVyID09PSAnZnVuY3Rpb24nICYmIG9Db2wuYlVzZVJlbmRlcmVkICYmIG9Db2wubURhdGEgIT09IG51bGwgKQoJCQkJewoJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksIF9mblJlbmRlcihvU2V0dGluZ3MsIGlSb3csIGkpICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSApICk7CgkJCQl9CgkJCQkKCQkJCS8qIFNlZSBpZiB3ZSBzaG91bGQgYXV0by1kZXRlY3QgdGhlIGNvbHVtbiB0eXBlICovCgkJCQlpZiAoIG9Db2wuX2JBdXRvVHlwZSAmJiBvQ29sLnNUeXBlICE9ICdzdHJpbmcnICkKCQkJCXsKCQkJCQkvKiBBdHRlbXB0IHRvIGF1dG8gZGV0ZWN0IHRoZSB0eXBlIC0gc2FtZSBhcyBfZm5HYXRoZXJEYXRhKCkgKi8KCQkJCQl2YXIgc1ZhclR5cGUgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAndHlwZScgKTsKCQkJCQlpZiAoIHNWYXJUeXBlICE9PSBudWxsICYmIHNWYXJUeXBlICE9PSAnJyApCgkJCQkJewoJCQkJCQlzVGhpc1R5cGUgPSBfZm5EZXRlY3RUeXBlKCBzVmFyVHlwZSApOwoJCQkJCQlpZiAoIG9Db2wuc1R5cGUgPT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQlvQ29sLnNUeXBlID0gc1RoaXNUeXBlOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBvQ29sLnNUeXBlICE9IHNUaGlzVHlwZSAmJiBvQ29sLnNUeXBlICE9ICJodG1sIiApCgkJCQkJCXsKCQkJCQkJCS8qIFN0cmluZyBpcyBhbHdheXMgdGhlICdmYWxsYmFjaycgb3B0aW9uICovCgkJCQkJCQlvQ29sLnNUeXBlID0gJ3N0cmluZyc7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEFkZCB0byB0aGUgZGlzcGxheSBhcnJheSAqLwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnB1c2goIGlSb3cgKTsKCQkKCQkJLyogQ3JlYXRlIHRoZSBET00gaW5mb3JtYXRpb24gKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQl7CgkJCQlfZm5DcmVhdGVUciggb1NldHRpbmdzLCBpUm93ICk7CgkJCX0KCQkKCQkJcmV0dXJuIGlSb3c7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlYWQgaW4gdGhlIGRhdGEgZnJvbSB0aGUgdGFyZ2V0IHRhYmxlIGZyb20gdGhlIERPTQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdhdGhlckRhdGEoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaUxvb3AsIGksIGlMZW4sIGosIGpMZW4sIGpJbm5lciwKCQkJIAluVGRzLCBuVHJzLCBuVGQsIG5UciwgYUxvY2FsRGF0YSwgaVRoaXNJbmRleCwKCQkJCWlSb3csIGlSb3dzLCBpQ29sdW1uLCBpQ29sdW1ucywgc05vZGVOYW1lLAoJCQkJb0NvbCwgb0RhdGE7CgkJCQoJCQkvKgoJCQkgKiBQcm9jZXNzIGJ5IHJvdyBmaXJzdAoJCQkgKiBBZGQgdGhlIGRhdGEgb2JqZWN0IGZvciB0aGUgd2hvbGUgdGFibGUgLSBzdG9yaW5nIHRoZSB0ciBub2RlLiBOb3RlIC0gbm8gcG9pbnQgaW4gZ2V0dGluZwoJCQkgKiBET00gYmFzZWQgZGF0YSBpZiB3ZSBhcmUgZ29pbmcgdG8gZ28gYW5kIHJlcGxhY2UgaXQgd2l0aCBBamF4IHNvdXJjZSBkYXRhLgoJCQkgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyB8fCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UgPT09IG51bGwgKQoJCQl7CgkJCQluVHIgPSBvU2V0dGluZ3MublRCb2R5LmZpcnN0Q2hpbGQ7CgkJCQl3aGlsZSAoIG5UciApCgkJCQl7CgkJCQkJaWYgKCBuVHIubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVFIiICkKCQkJCQl7CgkJCQkJCWlUaGlzSW5kZXggPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJCQkJblRyLl9EVF9Sb3dJbmRleCA9IGlUaGlzSW5kZXg7CgkJCQkJCW9TZXR0aW5ncy5hb0RhdGEucHVzaCggJC5leHRlbmQoIHRydWUsIHt9LCBEYXRhVGFibGUubW9kZWxzLm9Sb3csIHsKCQkJCQkJCSJuVHIiOiBuVHIKCQkJCQkJfSApICk7CgkJCgkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVRoaXNJbmRleCApOwoJCQkJCQluVGQgPSBuVHIuZmlyc3RDaGlsZDsKCQkJCQkJaklubmVyID0gMDsKCQkJCQkJd2hpbGUgKCBuVGQgKQoJCQkJCQl7CgkJCQkJCQlzTm9kZU5hbWUgPSBuVGQubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQkJCWlmICggc05vZGVOYW1lID09ICJURCIgfHwgc05vZGVOYW1lID09ICJUSCIgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlUaGlzSW5kZXgsIGpJbm5lciwgJC50cmltKG5UZC5pbm5lckhUTUwpICk7CgkJCQkJCQkJaklubmVyKys7CgkJCQkJCQl9CgkJCQkJCQluVGQgPSBuVGQubmV4dFNpYmxpbmc7CgkJCQkJCX0KCQkJCQl9CgkJCQkJblRyID0gblRyLm5leHRTaWJsaW5nOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBHYXRoZXIgaW4gdGhlIFREIGVsZW1lbnRzIG9mIHRoZSBUYWJsZSAtIG5vdGUgdGhhdCB0aGlzIGlzIGJhc2ljYWxseSB0aGUgc2FtZSBhcwoJCQkgKiBmbkdldFRkTm9kZXMsIGJ1dCB0aGF0IGZ1bmN0aW9uIHRha2VzIGFjY291bnQgb2YgaGlkZGVuIGNvbHVtbnMsIHdoaWNoIHdlIGhhdmVuJ3QgeWV0CgkJCSAqIHNldHVwIQoJCQkgKi8KCQkJblRycyA9IF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCQluVGRzID0gW107CgkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW5UZCA9IG5UcnNbaV0uZmlyc3RDaGlsZDsKCQkJCXdoaWxlICggblRkICkKCQkJCXsKCQkJCQlzTm9kZU5hbWUgPSBuVGQubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVEQiIHx8IHNOb2RlTmFtZSA9PSAiVEgiICkKCQkJCQl7CgkJCQkJCW5UZHMucHVzaCggblRkICk7CgkJCQkJfQoJCQkJCW5UZCA9IG5UZC5uZXh0U2libGluZzsKCQkJCX0KCQkJfQoJCQkKCQkJLyogTm93IHByb2Nlc3MgYnkgY29sdW1uICovCgkJCWZvciAoIGlDb2x1bW49MCwgaUNvbHVtbnM9b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpQ29sdW1uPGlDb2x1bW5zIDsgaUNvbHVtbisrICkKCQkJewoJCQkJb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl07CgkJCgkJCQkvKiBHZXQgdGhlIHRpdGxlIG9mIHRoZSBjb2x1bW4gLSB1bmxlc3MgdGhlcmUgaXMgYSB1c2VyIHNldCBvbmUgKi8KCQkJCWlmICggb0NvbC5zVGl0bGUgPT09IG51bGwgKQoJCQkJewoJCQkJCW9Db2wuc1RpdGxlID0gb0NvbC5uVGguaW5uZXJIVE1MOwoJCQkJfQoJCQkJCgkJCQl2YXIKCQkJCQliQXV0b1R5cGUgPSBvQ29sLl9iQXV0b1R5cGUsCgkJCQkJYlJlbmRlciA9IHR5cGVvZiBvQ29sLmZuUmVuZGVyID09PSAnZnVuY3Rpb24nLAoJCQkJCWJDbGFzcyA9IG9Db2wuc0NsYXNzICE9PSBudWxsLAoJCQkJCWJWaXNpYmxlID0gb0NvbC5iVmlzaWJsZSwKCQkJCQluQ2VsbCwgc1RoaXNUeXBlLCBzUmVuZGVyZWQsIHNWYWxUeXBlOwoJCQkJCgkJCQkvKiBBIHNpbmdsZSBsb29wIHRvIHJ1bGUgdGhlbSBhbGwgKGFuZCBiZSBtb3JlIGVmZmljaWVudCkgKi8KCQkJCWlmICggYkF1dG9UeXBlIHx8IGJSZW5kZXIgfHwgYkNsYXNzIHx8ICFiVmlzaWJsZSApCgkJCQl7CgkJCQkJZm9yICggaVJvdz0wLCBpUm93cz1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGlSb3c8aVJvd3MgOyBpUm93KysgKQoJCQkJCXsKCQkJCQkJb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQkJCQluQ2VsbCA9IG5UZHNbIChpUm93KmlDb2x1bW5zKSArIGlDb2x1bW4gXTsKCQkJCQkJCgkJCQkJCS8qIFR5cGUgZGV0ZWN0aW9uICovCgkJCQkJCWlmICggYkF1dG9UeXBlICYmIG9Db2wuc1R5cGUgIT0gJ3N0cmluZycgKQoJCQkJCQl7CgkJCQkJCQlzVmFsVHlwZSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICd0eXBlJyApOwoJCQkJCQkJaWYgKCBzVmFsVHlwZSAhPT0gJycgKQoJCQkJCQkJewoJCQkJCQkJCXNUaGlzVHlwZSA9IF9mbkRldGVjdFR5cGUoIHNWYWxUeXBlICk7CgkJCQkJCQkJaWYgKCBvQ29sLnNUeXBlID09PSBudWxsICkKCQkJCQkJCQl7CgkJCQkJCQkJCW9Db2wuc1R5cGUgPSBzVGhpc1R5cGU7CgkJCQkJCQkJfQoJCQkJCQkJCWVsc2UgaWYgKCBvQ29sLnNUeXBlICE9IHNUaGlzVHlwZSAmJiAKCQkJCQkJCQkgICAgICAgICAgb0NvbC5zVHlwZSAhPSAiaHRtbCIgKQoJCQkJCQkJCXsKCQkJCQkJCQkJLyogU3RyaW5nIGlzIGFsd2F5cyB0aGUgJ2ZhbGxiYWNrJyBvcHRpb24gKi8KCQkJCQkJCQkJb0NvbC5zVHlwZSA9ICdzdHJpbmcnOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQoJCQkJCQlpZiAoIG9Db2wubVJlbmRlciApCgkJCQkJCXsKCQkJCQkJCS8vIG1SZW5kZXIgaGFzIGJlZW4gZGVmaW5lZCwgc28gd2UgbmVlZCB0byBnZXQgdGhlIHZhbHVlIGFuZCBzZXQgaXQKCQkJCQkJCW5DZWxsLmlubmVySFRNTCA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICdkaXNwbGF5JyApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBvQ29sLm1EYXRhICE9PSBpQ29sdW1uICkKCQkJCQkJewoJCQkJCQkJLy8gSWYgbURhdGEgaXMgbm90IHRoZSBzYW1lIGFzIHRoZSBjb2x1bW4gbnVtYmVyLCB0aGVuIHdlIG5lZWQgdG8KCQkJCQkJCS8vIGdldCB0aGUgZGV2IHNldCB2YWx1ZS4gSWYgaXQgaXMgdGhlIGNvbHVtbiwgbm8gcG9pbnQgaW4gd2FzdGluZwoJCQkJCQkJLy8gdGltZSBzZXR0aW5nIHRoZSB2YWx1ZSB0aGF0IGlzIGFscmVhZHkgdGhlcmUhCgkJCQkJCQluQ2VsbC5pbm5lckhUTUwgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKTsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogUmVuZGVyaW5nICovCgkJCQkJCWlmICggYlJlbmRlciApCgkJCQkJCXsKCQkJCQkJCXNSZW5kZXJlZCA9IF9mblJlbmRlciggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uICk7CgkJCQkJCQluQ2VsbC5pbm5lckhUTUwgPSBzUmVuZGVyZWQ7CgkJCQkJCQlpZiAoIG9Db2wuYlVzZVJlbmRlcmVkICkKCQkJCQkJCXsKCQkJCQkJCQkvKiBVc2UgdGhlIHJlbmRlcmVkIGRhdGEgZm9yIGZpbHRlcmluZyAvIHNvcnRpbmcgKi8KCQkJCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCBzUmVuZGVyZWQgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogQ2xhc3NlcyAqLwoJCQkJCQlpZiAoIGJDbGFzcyApCgkJCQkJCXsKCQkJCQkJCW5DZWxsLmNsYXNzTmFtZSArPSAnICcrb0NvbC5zQ2xhc3M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIENvbHVtbiB2aXNpYmlsaXR5ICovCgkJCQkJCWlmICggIWJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbkNlbGw7CgkJCQkJCQluQ2VsbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuQ2VsbCApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbnVsbDsKCQkJCQkJfQoJCQoJCQkJCQlpZiAoIG9Db2wuZm5DcmVhdGVkQ2VsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJCW5DZWxsLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpQ29sdW1uCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8qIFJvdyBjcmVhdGVkIGNhbGxiYWNrcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5hb1Jvd0NyZWF0ZWRDYWxsYmFjay5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpXTsKCQkJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUm93Q3JlYXRlZENhbGxiYWNrJywgbnVsbCwgW29EYXRhLm5Uciwgb0RhdGEuX2FEYXRhLCBpXSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFRha2UgYSBUUiBlbGVtZW50IGFuZCBjb252ZXJ0IGl0IHRvIGFuIGluZGV4IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0aGUgVFIgZWxlbWVudCB0byBmaW5kCgkJICogIEByZXR1cm5zIHtpbnR9IGluZGV4IGlmIHRoZSBub2RlIGlzIGZvdW5kLCBudWxsIGlmIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ob2RlVG9EYXRhSW5kZXgoIG9TZXR0aW5ncywgbiApCgkJewoJCQlyZXR1cm4gKG4uX0RUX1Jvd0luZGV4IT09dW5kZWZpbmVkKSA/IG4uX0RUX1Jvd0luZGV4IDogbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSBhIFREIGVsZW1lbnQgYW5kIGNvbnZlcnQgaXQgaW50byBhIGNvbHVtbiBkYXRhIGluZGV4IChub3QgdGhlIHZpc2libGUgaW5kZXgpCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBudW1iZXIgdGhlIFREL1RIIGNhbiBiZSBmb3VuZCBpbgoJCSAqICBAcGFyYW0ge25vZGV9IG4gVGhlIFREL1RIIGVsZW1lbnQgdG8gZmluZAoJCSAqICBAcmV0dXJucyB7aW50fSBpbmRleCBpZiB0aGUgbm9kZSBpcyBmb3VuZCwgLTEgaWYgbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk5vZGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlSb3csIG4gKQoJCXsKCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5DZWxsc1tpXSA9PT0gbiApCgkJCQl7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIC0xOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgZGF0YSBmb3IgYSBnaXZlbiByb3cgZnJvbSB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgndHlwZScgJ2ZpbHRlcicgJ3NvcnQnKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhaUNvbHVtbnMgQXJyYXkgb2YgY29sdW1uIGluZGV4ZXMgdG8gZ2V0IGRhdGEgZnJvbQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpUm93LCBzU3BlY2lmaWMsIGFpQ29sdW1ucyApCgkJewoJCQl2YXIgb3V0ID0gW107CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YWlDb2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW91dC5wdXNoKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBhaUNvbHVtbnNbaV0sIHNTcGVjaWZpYyApICk7CgkJCX0KCQkJcmV0dXJuIG91dDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBkYXRhIGZvciBhIGdpdmVuIGNlbGwgZnJvbSB0aGUgaW50ZXJuYWwgY2FjaGUsIHRha2luZyBpbnRvIGFjY291bnQgZGF0YSBtYXBwaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIHJvdyBpZAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBDb2x1bW4gaW5kZXgKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgnZGlzcGxheScsICd0eXBlJyAnZmlsdGVyJyAnc29ydCcpCgkJICogIEByZXR1cm5zIHsqfSBDZWxsIGRhdGEKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgc1NwZWNpZmljICkKCQl7CgkJCXZhciBzRGF0YTsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJaWYgKCAoc0RhdGE9b0NvbC5mbkdldERhdGEoIG9EYXRhLCBzU3BlY2lmaWMgKSkgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmlEcmF3RXJyb3IgIT0gb1NldHRpbmdzLmlEcmF3ICYmIG9Db2wuc0RlZmF1bHRDb250ZW50ID09PSBudWxsICkKCQkJCXsKCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJlcXVlc3RlZCB1bmtub3duIHBhcmFtZXRlciAiKwoJCQkJCQkodHlwZW9mIG9Db2wubURhdGE9PSdmdW5jdGlvbicgPyAne21EYXRhIGZ1bmN0aW9ufScgOiAiJyIrb0NvbC5tRGF0YSsiJyIpKwoJCQkJCQkiIGZyb20gdGhlIGRhdGEgc291cmNlIGZvciByb3cgIitpUm93ICk7CgkJCQkJb1NldHRpbmdzLmlEcmF3RXJyb3IgPSBvU2V0dGluZ3MuaURyYXc7CgkJCQl9CgkJCQlyZXR1cm4gb0NvbC5zRGVmYXVsdENvbnRlbnQ7CgkJCX0KCQkKCQkJLyogV2hlbiB0aGUgZGF0YSBzb3VyY2UgaXMgbnVsbCwgd2UgY2FuIHVzZSBkZWZhdWx0IGNvbHVtbiBkYXRhICovCgkJCWlmICggc0RhdGEgPT09IG51bGwgJiYgb0NvbC5zRGVmYXVsdENvbnRlbnQgIT09IG51bGwgKQoJCQl7CgkJCQlzRGF0YSA9IG9Db2wuc0RlZmF1bHRDb250ZW50OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICdmdW5jdGlvbicgKQoJCQl7CgkJCQkvKiBJZiB0aGUgZGF0YSBzb3VyY2UgaXMgYSBmdW5jdGlvbiwgdGhlbiB3ZSBydW4gaXQgYW5kIHVzZSB0aGUgcmV0dXJuICovCgkJCQlyZXR1cm4gc0RhdGEoKTsKCQkJfQoJCQoJCQlpZiAoIHNTcGVjaWZpYyA9PSAnZGlzcGxheScgJiYgc0RhdGEgPT09IG51bGwgKQoJCQl7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQkJcmV0dXJuIHNEYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZXQgdGhlIHZhbHVlIGZvciBhIHNwZWNpZmljIGNlbGwsIGludG8gdGhlIGludGVybmFsIGRhdGEgY2FjaGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgcm93IGlkCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIENvbHVtbiBpbmRleAoJCSAqICBAcGFyYW0geyp9IHZhbCBWYWx1ZSB0byBzZXQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgdmFsICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sXTsKCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGE7CgkJCgkJCW9Db2wuZm5TZXREYXRhKCBvRGF0YSwgdmFsICk7CgkJfQoJCQoJCQoJCS8vIFByaXZhdGUgdmFyaWFibGUgdGhhdCBpcyB1c2VkIHRvIG1hdGNoIGFycmF5IHN5bnRheCBpbiB0aGUgZGF0YSBwcm9wZXJ0eSBvYmplY3QKCQl2YXIgX19yZUFycmF5ID0gL1xbLio/XF0kLzsKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGdldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIGdldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogR2l2ZSBhbiBlbXB0eSBzdHJpbmcgZm9yIHJlbmRlcmluZyAvIHNvcnRpbmcgZXRjICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHR5cGUpIHsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX07CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBleHRyYSkgewoJCQkJCXJldHVybiBtU291cmNlKCBkYXRhLCB0eXBlLCBleHRyYSApOwoJCQkJfTsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIG1Tb3VyY2UgPT09ICdzdHJpbmcnICYmIChtU291cmNlLmluZGV4T2YoJy4nKSAhPT0gLTEgfHwgbVNvdXJjZS5pbmRleE9mKCdbJykgIT09IC0xKSApCgkJCXsKCQkJCS8qIElmIHRoZXJlIGlzIGEgLiBpbiB0aGUgc291cmNlIHN0cmluZyB0aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBpbiBhIAoJCQkJICogbmVzdGVkIG9iamVjdCBzbyB3ZSBsb29wIG92ZXIgdGhlIGRhdGEgZm9yIGVhY2ggbGV2ZWwgdG8gZ2V0IHRoZSBuZXh0CgkJCQkgKiBsZXZlbCBkb3duLiBPbiBlYWNoIGxvb3Agd2UgdGVzdCBmb3IgdW5kZWZpbmVkLCBhbmQgaWYgZm91bmQgaW1tZWRpYXRlbHkKCQkJCSAqIHJldHVybi4gVGhpcyBhbGxvd3MgZW50aXJlIG9iamVjdHMgdG8gYmUgbWlzc2luZyBhbmQgc0RlZmF1bHRDb250ZW50IHRvCgkJCQkgKiBiZSB1c2VkIGlmIGRlZmluZWQsIHJhdGhlciB0aGFuIHRocm93aW5nIGFuIGVycm9yCgkJCQkgKi8KCQkJCXZhciBmZXRjaERhdGEgPSBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgc3JjKSB7CgkJCQkJdmFyIGEgPSBzcmMuc3BsaXQoJy4nKTsKCQkJCQl2YXIgYXJyYXlOb3RhdGlvbiwgb3V0LCBpbm5lclNyYzsKCQkKCQkJCQlpZiAoIHNyYyAhPT0gIiIgKQoJCQkJCXsKCQkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCS8vIENoZWNrIGlmIHdlIGFyZSBkZWFsaW5nIHdpdGggYW4gYXJyYXkgbm90YXRpb24gcmVxdWVzdAoJCQkJCQkJYXJyYXlOb3RhdGlvbiA9IGFbaV0ubWF0Y2goX19yZUFycmF5KTsKCQkKCQkJCQkJCWlmICggYXJyYXlOb3RhdGlvbiApIHsKCQkJCQkJCQlhW2ldID0gYVtpXS5yZXBsYWNlKF9fcmVBcnJheSwgJycpOwoJCQoJCQkJCQkJCS8vIENvbmRpdGlvbiBhbGxvd3Mgc2ltcGx5IFtdIHRvIGJlIHBhc3NlZCBpbgoJCQkJCQkJCWlmICggYVtpXSAhPT0gIiIgKSB7CgkJCQkJCQkJCWRhdGEgPSBkYXRhWyBhW2ldIF07CgkJCQkJCQkJfQoJCQkJCQkJCW91dCA9IFtdOwoJCQkJCQkJCQoJCQkJCQkJCS8vIEdldCB0aGUgcmVtYWluZGVyIG9mIHRoZSBuZXN0ZWQgb2JqZWN0IHRvIGdldAoJCQkJCQkJCWEuc3BsaWNlKCAwLCBpKzEgKTsKCQkJCQkJCQlpbm5lclNyYyA9IGEuam9pbignLicpOwoJCQoJCQkJCQkJCS8vIFRyYXZlcnNlIGVhY2ggZW50cnkgaW4gdGhlIGFycmF5IGdldHRpbmcgdGhlIHByb3BlcnRpZXMgcmVxdWVzdGVkCgkJCQkJCQkJZm9yICggdmFyIGo9MCwgakxlbj1kYXRhLmxlbmd0aCA7IGo8akxlbiA7IGorKyApIHsKCQkJCQkJCQkJb3V0LnB1c2goIGZldGNoRGF0YSggZGF0YVtqXSwgdHlwZSwgaW5uZXJTcmMgKSApOwoJCQkJCQkJCX0KCQkKCQkJCQkJCQkvLyBJZiBhIHN0cmluZyBpcyBnaXZlbiBpbiBiZXR3ZWVuIHRoZSBhcnJheSBub3RhdGlvbiBpbmRpY2F0b3JzLCB0aGF0CgkJCQkJCQkJLy8gaXMgdXNlZCB0byBqb2luIHRoZSBzdHJpbmdzIHRvZ2V0aGVyLCBvdGhlcndpc2UgYW4gYXJyYXkgaXMgcmV0dXJuZWQKCQkJCQkJCQl2YXIgam9pbiA9IGFycmF5Tm90YXRpb25bMF0uc3Vic3RyaW5nKDEsIGFycmF5Tm90YXRpb25bMF0ubGVuZ3RoLTEpOwoJCQkJCQkJCWRhdGEgPSAoam9pbj09PSIiKSA/IG91dCA6IG91dC5qb2luKGpvaW4pOwoJCQoJCQkJCQkJCS8vIFRoZSBpbm5lciBjYWxsIHRvIGZldGNoRGF0YSBoYXMgYWxyZWFkeSB0cmF2ZXJzZWQgdGhyb3VnaCB0aGUgcmVtYWluZGVyCgkJCQkJCQkJLy8gb2YgdGhlIHNvdXJjZSByZXF1ZXN0ZWQsIHNvIHdlIGV4aXQgZnJvbSB0aGUgbG9vcAoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQoJCQkJCQkJaWYgKCBkYXRhID09PSBudWxsIHx8IGRhdGFbIGFbaV0gXSA9PT0gdW5kZWZpbmVkICkKCQkJCQkJCXsKCQkJCQkJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCQkJCQkJfQoJCQkJCQkJZGF0YSA9IGRhdGFbIGFbaV0gXTsKCQkJCQkJfQoJCQkJCX0KCQkKCQkJCQlyZXR1cm4gZGF0YTsKCQkJCX07CgkJCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHR5cGUpIHsKCQkJCQlyZXR1cm4gZmV0Y2hEYXRhKCBkYXRhLCB0eXBlLCBtU291cmNlICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIGRhdGFbbVNvdXJjZV07CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHNldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIHNldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogTm90aGluZyB0byBkbyB3aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkge307CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQltU291cmNlKCBkYXRhLCAnc2V0JywgdmFsICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgKG1Tb3VyY2UuaW5kZXhPZignLicpICE9PSAtMSB8fCBtU291cmNlLmluZGV4T2YoJ1snKSAhPT0gLTEpICkKCQkJewoJCQkJLyogTGlrZSB0aGUgZ2V0LCB3ZSBuZWVkIHRvIGdldCBkYXRhIGZyb20gYSBuZXN0ZWQgb2JqZWN0ICovCgkJCQl2YXIgc2V0RGF0YSA9IGZ1bmN0aW9uIChkYXRhLCB2YWwsIHNyYykgewoJCQkJCXZhciBhID0gc3JjLnNwbGl0KCcuJyksIGI7CgkJCQkJdmFyIGFycmF5Tm90YXRpb24sIG8sIGlubmVyU3JjOwoJCQoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGgtMSA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQkvLyBDaGVjayBpZiB3ZSBhcmUgZGVhbGluZyB3aXRoIGFuIGFycmF5IG5vdGF0aW9uIHJlcXVlc3QKCQkJCQkJYXJyYXlOb3RhdGlvbiA9IGFbaV0ubWF0Y2goX19yZUFycmF5KTsKCQkKCQkJCQkJaWYgKCBhcnJheU5vdGF0aW9uICkKCQkJCQkJewoJCQkJCQkJYVtpXSA9IGFbaV0ucmVwbGFjZShfX3JlQXJyYXksICcnKTsKCQkJCQkJCWRhdGFbIGFbaV0gXSA9IFtdOwoJCQkJCQkJCgkJCQkJCQkvLyBHZXQgdGhlIHJlbWFpbmRlciBvZiB0aGUgbmVzdGVkIG9iamVjdCB0byBzZXQgc28gd2UgY2FuIHJlY3Vyc2UKCQkJCQkJCWIgPSBhLnNsaWNlKCk7CgkJCQkJCQliLnNwbGljZSggMCwgaSsxICk7CgkJCQkJCQlpbm5lclNyYyA9IGIuam9pbignLicpOwoJCQoJCQkJCQkJLy8gVHJhdmVyc2UgZWFjaCBlbnRyeSBpbiB0aGUgYXJyYXkgc2V0dGluZyB0aGUgcHJvcGVydGllcyByZXF1ZXN0ZWQKCQkJCQkJCWZvciAoIHZhciBqPTAsIGpMZW49dmFsLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJbyA9IHt9OwoJCQkJCQkJCXNldERhdGEoIG8sIHZhbFtqXSwgaW5uZXJTcmMgKTsKCQkJCQkJCQlkYXRhWyBhW2ldIF0ucHVzaCggbyApOwoJCQkJCQkJfQoJCQoJCQkJCQkJLy8gVGhlIGlubmVyIGNhbGwgdG8gc2V0RGF0YSBoYXMgYWxyZWFkeSB0cmF2ZXJzZWQgdGhyb3VnaCB0aGUgcmVtYWluZGVyCgkJCQkJCQkvLyBvZiB0aGUgc291cmNlIGFuZCBoYXMgc2V0IHRoZSBkYXRhLCB0aHVzIHdlIGNhbiBleGl0IGhlcmUKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQoJCQkJCQkvLyBJZiB0aGUgbmVzdGVkIG9iamVjdCBkb2Vzbid0IGN1cnJlbnRseSBleGlzdCAtIHNpbmNlIHdlIGFyZQoJCQkJCQkvLyB0cnlpbmcgdG8gc2V0IHRoZSB2YWx1ZSAtIGNyZWF0ZSBpdAoJCQkJCQlpZiAoIGRhdGFbIGFbaV0gXSA9PT0gbnVsbCB8fCBkYXRhWyBhW2ldIF0gPT09IHVuZGVmaW5lZCApCgkJCQkJCXsKCQkJCQkJCWRhdGFbIGFbaV0gXSA9IHt9OwoJCQkJCQl9CgkJCQkJCWRhdGEgPSBkYXRhWyBhW2ldIF07CgkJCQkJfQoJCQoJCQkJCS8vIElmIGFycmF5IG5vdGF0aW9uIGlzIHVzZWQsIHdlIGp1c3Qgd2FudCB0byBzdHJpcCBpdCBhbmQgdXNlIHRoZSBwcm9wZXJ0eSBuYW1lCgkJCQkJLy8gYW5kIGFzc2lnbiB0aGUgdmFsdWUuIElmIGl0IGlzbid0IHVzZWQsIHRoZW4gd2UgZ2V0IHRoZSByZXN1bHQgd2Ugd2FudCBhbnl3YXkKCQkJCQlkYXRhWyBhW2EubGVuZ3RoLTFdLnJlcGxhY2UoX19yZUFycmF5LCAnJykgXSA9IHZhbDsKCQkJCX07CgkJCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCXJldHVybiBzZXREYXRhKCBkYXRhLCB2YWwsIG1Tb3VyY2UgKTsKCQkJCX07CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBBcnJheSBvciBmbGF0IG9iamVjdCBtYXBwaW5nICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCWRhdGFbbVNvdXJjZV0gPSB2YWw7CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gYXJyYXkgd2l0aCB0aGUgZnVsbCB0YWJsZSBkYXRhCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMgYXJyYXkge2FycmF5fSBhRGF0YSBNYXN0ZXIgZGF0YSBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXREYXRhTWFzdGVyICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhRGF0YSA9IFtdOwoJCQl2YXIgaUxlbiA9IG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxpTGVuOyBpKysgKQoJCQl7CgkJCQlhRGF0YS5wdXNoKCBvU2V0dGluZ3MuYW9EYXRhW2ldLl9hRGF0YSApOwoJCQl9CgkJCXJldHVybiBhRGF0YTsKCQl9CgkJCgkJCgkJLyoqCgkJICogTnVrZSB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKQoJCXsKCQkJb1NldHRpbmdzLmFvRGF0YS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoICk7CgkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCApOwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggMCwgb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggKTsKCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQl9CgkJCgkJCgkJIC8qKgoJCSAqIFRha2UgYW4gYXJyYXkgb2YgaW50ZWdlcnMgKGluZGV4IGFycmF5KSBhbmQgcmVtb3ZlIGEgdGFyZ2V0IGludGVnZXIgKHZhbHVlIC0gbm90IAoJCSAqIHRoZSBrZXkhKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhIEluZGV4IGFycmF5IHRvIHRhcmdldAoJCSAqICBAcGFyYW0ge2ludH0gaVRhcmdldCB2YWx1ZSB0byBmaW5kCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRlbGV0ZUluZGV4KCBhLCBpVGFyZ2V0ICkKCQl7CgkJCXZhciBpVGFyZ2V0SW5kZXggPSAtMTsKCQkJCgkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGFbaV0gPT0gaVRhcmdldCApCgkJCQl7CgkJCQkJaVRhcmdldEluZGV4ID0gaTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBhW2ldID4gaVRhcmdldCApCgkJCQl7CgkJCQkJYVtpXS0tOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIGlUYXJnZXRJbmRleCAhPSAtMSApCgkJCXsKCQkJCWEuc3BsaWNlKCBpVGFyZ2V0SW5kZXgsIDEgKTsKCQkJfQoJCX0KCQkKCQkKCQkgLyoqCgkJICogQ2FsbCB0aGUgZGV2ZWxvcGVyIGRlZmluZWQgZm5SZW5kZXIgZnVuY3Rpb24gZm9yIGEgZ2l2ZW4gY2VsbCAocm93L2NvbHVtbikgd2l0aAoJCSAqIHRoZSByZXF1aXJlZCBwYXJhbWV0ZXJzIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgaW5kZXggZm9yIHRoZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgYW9Db2x1bW5zIGluZGV4IGZvciB0aGUgY29sdW1uCgkJICogIEByZXR1cm5zIHsqfSBSZXR1cm4gb2YgdGhlIGRldmVsb3BlcidzIGZuUmVuZGVyIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlbmRlciggb1NldHRpbmdzLCBpUm93LCBpQ29sICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sXTsKCQkKCQkJcmV0dXJuIG9Db2wuZm5SZW5kZXIoIHsKCQkJCSJpRGF0YVJvdyI6ICAgIGlSb3csCgkJCQkiaURhdGFDb2x1bW4iOiBpQ29sLAoJCQkJIm9TZXR0aW5ncyI6ICAgb1NldHRpbmdzLAoJCQkJImFEYXRhIjogICAgICAgb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEsCgkJCQkibURhdGFQcm9wIjogICBvQ29sLm1EYXRhCgkJCX0sIF9mbkdldENlbGxEYXRhKG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJ2Rpc3BsYXknKSApOwoJCX0KCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgVFIgZWxlbWVudCAoYW5kIGl0J3MgVEQgY2hpbGRyZW4pIGZvciBhIHJvdwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFJvdyB0byBjb25zaWRlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVUciAoIG9TZXR0aW5ncywgaVJvdyApCgkJewoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQl2YXIgblRkOwoJCQoJCQlpZiAoIG9EYXRhLm5UciA9PT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhLm5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CgkJCgkJCQkvKiBVc2UgYSBwcml2YXRlIHByb3BlcnR5IG9uIHRoZSBub2RlIHRvIGFsbG93IHJlc2VydmUgbWFwcGluZyBmcm9tIHRoZSBub2RlCgkJCQkgKiB0byB0aGUgYW9EYXRhIGFycmF5IGZvciBmYXN0IGxvb2sgdXAKCQkJCSAqLwoJCQkJb0RhdGEublRyLl9EVF9Sb3dJbmRleCA9IGlSb3c7CgkJCgkJCQkvKiBTcGVjaWFsIHBhcmFtZXRlcnMgY2FuIGJlIGdpdmVuIGJ5IHRoZSBkYXRhIHNvdXJjZSB0byBiZSB1c2VkIG9uIHRoZSByb3cgKi8KCQkJCWlmICggb0RhdGEuX2FEYXRhLkRUX1Jvd0lkICkKCQkJCXsKCQkJCQlvRGF0YS5uVHIuaWQgPSBvRGF0YS5fYURhdGEuRFRfUm93SWQ7CgkJCQl9CgkJCgkJCQlpZiAoIG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzcyApCgkJCQl7CgkJCQkJb0RhdGEublRyLmNsYXNzTmFtZSA9IG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzczsKCQkJCX0KCQkKCQkJCS8qIFByb2Nlc3MgZWFjaCBjb2x1bW4gKi8KCQkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkJCQluVGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBvQ29sLnNDZWxsVHlwZSApOwoJCQoJCQkJCS8qIFJlbmRlciBpZiBuZWVkZWQgLSBpZiBiVXNlUmVuZGVyZWQgaXMgdHJ1ZSB0aGVuIHdlIGFscmVhZHkgaGF2ZSB0aGUgcmVuZGVyZWQKCQkJCQkgKiB2YWx1ZSBpbiB0aGUgZGF0YSBzb3VyY2UgLSBzbyBjYW4ganVzdCB1c2UgdGhhdAoJCQkJCSAqLwoJCQkJCW5UZC5pbm5lckhUTUwgPSAodHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgKCFvQ29sLmJVc2VSZW5kZXJlZCB8fCBvQ29sLm1EYXRhID09PSBudWxsKSkgPwoJCQkJCQlfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaSApIDoKCQkJCQkJX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCQkvKiBBZGQgdXNlciBkZWZpbmVkIGNsYXNzICovCgkJCQkJaWYgKCBvQ29sLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQuY2xhc3NOYW1lID0gb0NvbC5zQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggb0NvbC5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlvRGF0YS5uVHIuYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBudWxsOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBuVGQ7CgkJCQkJfQoJCQoJCQkJCWlmICggb0NvbC5mbkNyZWF0ZWRDZWxsICkKCQkJCQl7CgkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJblRkLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpCgkJCQkJCSk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG51bGwsIFtvRGF0YS5uVHIsIG9EYXRhLl9hRGF0YSwgaVJvd10gKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgdGhlIEhUTUwgaGVhZGVyIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZEhlYWQoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaSwgblRoLCBpTGVuLCBqLCBqTGVuOwoJCQl2YXIgaVRocyA9ICQoJ3RoLCB0ZCcsIG9TZXR0aW5ncy5uVEhlYWQpLmxlbmd0aDsKCQkJdmFyIGlDb3JyZWN0b3IgPSAwOwoJCQl2YXIganFDaGlsZHJlbjsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGEgaGVhZGVyIGluIHBsYWNlIC0gdGhlbiB1c2UgaXQgLSBvdGhlcndpc2UgaXQncyBnb2luZyB0byBnZXQgbnVrZWQuLi4gKi8KCQkJaWYgKCBpVGhzICE9PSAwICkKCQkJewoJCQkJLyogV2UndmUgZ290IGEgdGhlYWQgZnJvbSB0aGUgRE9NLCBzbyByZW1vdmUgaGlkZGVuIGNvbHVtbnMgYW5kIGFwcGx5IHdpZHRoIHRvIHZpcyBjb2xzICovCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5UaCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoOwoJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnY29sdW1uaGVhZGVyJyk7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQkJewoJCQkJCQluVGguc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIG9TZXR0aW5ncy5pVGFiSW5kZXgpOwoJCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCQl9CgkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQkkKG5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICk7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFNldCB0aGUgdGl0bGUgb2YgdGhlIGNvbHVtbiBpZiBpdCBpcyB1c2VyIGRlZmluZWQgKG5vdCB3aGF0IHdhcyBhdXRvIGRldGVjdGVkKSAqLwoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGUgIT0gblRoLmlubmVySFRNTCApCgkJCQkJewoJCQkJCQluVGguaW5uZXJIVE1MID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogV2UgZG9uJ3QgaGF2ZSBhIGhlYWRlciBpbiB0aGUgRE9NIC0gc28gd2UgYXJlIGdvaW5nIHRvIGhhdmUgdG8gY3JlYXRlIG9uZSAqLwoJCQkJdmFyIG5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJ0ciIgKTsKCQkJCQoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluVGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaDsKCQkJCQluVGguaW5uZXJIVE1MID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGU7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJJChuVGgpLmFkZENsYXNzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyApOwoJCQkJCX0KCQkJCQkKCQkJCQluVHIuYXBwZW5kQ2hpbGQoIG5UaCApOwoJCQkJfQoJCQkJJChvU2V0dGluZ3MublRIZWFkKS5odG1sKCAnJyApWzBdLmFwcGVuZENoaWxkKCBuVHIgKTsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvSGVhZGVyLCBvU2V0dGluZ3MublRIZWFkICk7CgkJCX0KCQkJCgkJCS8qIEFSSUEgcm9sZSBmb3IgdGhlIHJvd3MgKi8JCgkJCSQob1NldHRpbmdzLm5USGVhZCkuY2hpbGRyZW4oJ3RyJykuYXR0cigncm9sZScsICdyb3cnKTsKCQkJCgkJCS8qIEFkZCB0aGUgZXh0cmEgbWFya3VwIG5lZWRlZCBieSBqUXVlcnkgVUkncyB0aGVtZXMgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkpVSSApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJblRoID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGg7CgkJCQkJCgkJCQkJdmFyIG5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJCQluRGl2LmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSVdyYXBwZXI7CgkJCQkJJChuVGgpLmNvbnRlbnRzKCkuYXBwZW5kVG8obkRpdik7CgkJCQkJCgkJCQkJdmFyIG5TcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwoJCQkJCW5TcGFuLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb247CgkJCQkJbkRpdi5hcHBlbmRDaGlsZCggblNwYW4gKTsKCQkJCQluVGguYXBwZW5kQ2hpbGQoIG5EaXYgKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSAhPT0gZmFsc2UgKQoJCQkJCXsKCQkJCQkJX2ZuU29ydEF0dGFjaExpc3RlbmVyKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLCBpICk7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZSApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogRGVhbCB3aXRoIHRoZSBmb290ZXIgLSBhZGQgY2xhc3NlcyBpZiByZXF1aXJlZCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vQ2xhc3Nlcy5zRm9vdGVyVEggIT09ICIiICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRGb290KS5jaGlsZHJlbigndHInKS5jaGlsZHJlbigndGgnKS5hZGRDbGFzcyggb1NldHRpbmdzLm9DbGFzc2VzLnNGb290ZXJUSCApOwoJCQl9CgkJCQoJCQkvKiBDYWNoZSB0aGUgZm9vdGVyIGVsZW1lbnRzICovCgkJCWlmICggb1NldHRpbmdzLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCXZhciBhbkNlbGxzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsIG51bGwsIG9TZXR0aW5ncy5hb0Zvb3RlciApOwoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFuQ2VsbHNbaV0gKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGYgPSBhbkNlbGxzW2ldOwoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICkKCQkJCQkJewoJCQkJCQkJJChhbkNlbGxzW2ldKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBEcmF3IHRoZSBoZWFkZXIgKG9yIGZvb3RlcikgZWxlbWVudCBiYXNlZCBvbiB0aGUgY29sdW1uIHZpc2liaWxpdHkgc3RhdGVzLiBUaGUKCQkgKiBtZXRob2RvbG9neSBoZXJlIGlzIHRvIHVzZSB0aGUgbGF5b3V0IGFycmF5IGZyb20gX2ZuRGV0ZWN0SGVhZGVyLCBtb2RpZmllZCBmb3IKCQkgKiB0aGUgaW5zdGFudGFuZW91cyBjb2x1bW4gdmlzaWJpbGl0eSwgdG8gY29uc3RydWN0IHRoZSBuZXcgbGF5b3V0LiBUaGUgZ3JpZCBpcwoJCSAqIHRyYXZlcnNlZCBvdmVyIGNlbGwgYXQgYSB0aW1lIGluIGEgcm93cyB4IGNvbHVtbnMgZ3JpZCBmYXNoaW9uLCBhbHRob3VnaCBlYWNoIAoJCSAqIGNlbGwgaW5zZXJ0IGNhbiBjb3ZlciBtdWx0aXBsZSBlbGVtZW50cyBpbiB0aGUgZ3JpZCAtIHdoaWNoIGlzIHRyYWNrcyB1c2luZyB0aGUKCQkgKiBhQXBwbGllZCBhcnJheS4gQ2VsbCBpbnNlcnRzIGluIHRoZSBncmlkIHdpbGwgb25seSBvY2N1ciB3aGVyZSB0aGVyZSBpc24ndAoJCSAqIGFscmVhZHkgYSBjZWxsIGluIHRoYXQgcG9zaXRpb24uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3RzfSBhb1NvdXJjZSBMYXlvdXQgYXJyYXkgZnJvbSBfZm5EZXRlY3RIZWFkZXIKCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYkluY2x1ZGVIaWRkZW49ZmFsc2VdIElmIHRydWUgdGhlbiBpbmNsdWRlIHRoZSBoaWRkZW4gY29sdW1ucyBpbiB0aGUgY2FsYywgCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIGFvU291cmNlLCBiSW5jbHVkZUhpZGRlbiApCgkJewoJCQl2YXIgaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbiwgbiwgbkxvY2FsVHI7CgkJCXZhciBhb0xvY2FsID0gW107CgkJCXZhciBhQXBwbGllZCA9IFtdOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGlSb3dzcGFuLCBpQ29sc3BhbjsKCQkKCQkJaWYgKCAgYkluY2x1ZGVIaWRkZW4gPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWJJbmNsdWRlSGlkZGVuID0gZmFsc2U7CgkJCX0KCQkKCQkJLyogTWFrZSBhIGNvcHkgb2YgdGhlIG1hc3RlciBsYXlvdXQgYXJyYXksIGJ1dCB3aXRob3V0IHRoZSB2aXNpYmxlIGNvbHVtbnMgaW4gaXQgKi8KCQkJZm9yICggaT0wLCBpTGVuPWFvU291cmNlLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWFvTG9jYWxbaV0gPSBhb1NvdXJjZVtpXS5zbGljZSgpOwoJCQkJYW9Mb2NhbFtpXS5uVHIgPSBhb1NvdXJjZVtpXS5uVHI7CgkJCgkJCQkvKiBSZW1vdmUgYW55IGNvbHVtbnMgd2hpY2ggYXJlIGN1cnJlbnRseSBoaWRkZW4gKi8KCQkJCWZvciAoIGo9aUNvbHVtbnMtMSA7IGo+PTAgOyBqLS0gKQoJCQkJewoJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbal0uYlZpc2libGUgJiYgIWJJbmNsdWRlSGlkZGVuICkKCQkJCQl7CgkJCQkJCWFvTG9jYWxbaV0uc3BsaWNlKCBqLCAxICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJLyogUHJlcCB0aGUgYXBwbGllZCBhcnJheSAtIGl0IG5lZWRzIGFuIGVsZW1lbnQgZm9yIGVhY2ggcm93ICovCgkJCQlhQXBwbGllZC5wdXNoKCBbXSApOwoJCQl9CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1hb0xvY2FsLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW5Mb2NhbFRyID0gYW9Mb2NhbFtpXS5uVHI7CgkJCQkKCQkJCS8qIEFsbCBjZWxscyBhcmUgZ29pbmcgdG8gYmUgcmVwbGFjZWQsIHNvIGVtcHR5IG91dCB0aGUgcm93ICovCgkJCQlpZiAoIG5Mb2NhbFRyICkKCQkJCXsKCQkJCQl3aGlsZSggKG4gPSBuTG9jYWxUci5maXJzdENoaWxkKSApCgkJCQkJewoJCQkJCQluTG9jYWxUci5yZW1vdmVDaGlsZCggbiApOwoJCQkJCX0KCQkJCX0KCQkKCQkJCWZvciAoIGo9MCwgakxlbj1hb0xvY2FsW2ldLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaVJvd3NwYW4gPSAxOwoJCQkJCWlDb2xzcGFuID0gMTsKCQkKCQkJCQkvKiBDaGVjayB0byBzZWUgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIGNlbGwgKHJvdy9jb2xzcGFuKSBjb3ZlcmluZyBvdXIgdGFyZ2V0CgkJCQkJICogaW5zZXJ0IHBvaW50LiBJZiB0aGVyZSBpcywgdGhlbiB0aGVyZSBpcyBub3RoaW5nIHRvIGRvLgoJCQkJCSAqLwoJCQkJCWlmICggYUFwcGxpZWRbaV1bal0gPT09IHVuZGVmaW5lZCApCgkJCQkJewoJCQkJCQluTG9jYWxUci5hcHBlbmRDaGlsZCggYW9Mb2NhbFtpXVtqXS5jZWxsICk7CgkJCQkJCWFBcHBsaWVkW2ldW2pdID0gMTsKCQkKCQkJCQkJLyogRXhwYW5kIHRoZSBjZWxsIHRvIGNvdmVyIGFzIG1hbnkgcm93cyBhcyBuZWVkZWQgKi8KCQkJCQkJd2hpbGUgKCBhb0xvY2FsW2kraVJvd3NwYW5dICE9PSB1bmRlZmluZWQgJiYKCQkJCQkJICAgICAgICBhb0xvY2FsW2ldW2pdLmNlbGwgPT0gYW9Mb2NhbFtpK2lSb3dzcGFuXVtqXS5jZWxsICkKCQkJCQkJewoJCQkJCQkJYUFwcGxpZWRbaStpUm93c3Bhbl1bal0gPSAxOwoJCQkJCQkJaVJvd3NwYW4rKzsKCQkJCQkJfQoJCQoJCQkJCQkvKiBFeHBhbmQgdGhlIGNlbGwgdG8gY292ZXIgYXMgbWFueSBjb2x1bW5zIGFzIG5lZWRlZCAqLwoJCQkJCQl3aGlsZSAoIGFvTG9jYWxbaV1baitpQ29sc3Bhbl0gIT09IHVuZGVmaW5lZCAmJgoJCQkJCQkgICAgICAgIGFvTG9jYWxbaV1bal0uY2VsbCA9PSBhb0xvY2FsW2ldW2oraUNvbHNwYW5dLmNlbGwgKQoJCQkJCQl7CgkJCQkJCQkvKiBNdXN0IHVwZGF0ZSB0aGUgYXBwbGllZCBhcnJheSBvdmVyIHRoZSByb3dzIGZvciB0aGUgY29sdW1ucyAqLwoJCQkJCQkJZm9yICggaz0wIDsgazxpUm93c3BhbiA7IGsrKyApCgkJCQkJCQl7CgkJCQkJCQkJYUFwcGxpZWRbaStrXVtqK2lDb2xzcGFuXSA9IDE7CgkJCQkJCQl9CgkJCQkJCQlpQ29sc3BhbisrOwoJCQkJCQl9CgkJCgkJCQkJCS8qIERvIHRoZSBhY3R1YWwgZXhwYW5zaW9uIGluIHRoZSBET00gKi8KCQkJCQkJYW9Mb2NhbFtpXVtqXS5jZWxsLnJvd1NwYW4gPSBpUm93c3BhbjsKCQkJCQkJYW9Mb2NhbFtpXVtqXS5jZWxsLmNvbFNwYW4gPSBpQ29sc3BhbjsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogSW5zZXJ0IHRoZSByZXF1aXJlZCBUUiBub2RlcyBpbnRvIHRoZSB0YWJsZSBmb3IgZGlzcGxheQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRyYXcoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBQcm92aWRlIGEgcHJlLWNhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGNhbmNlbCB0aGUgZHJhdyBpcyBmYWxzZSBpcyByZXR1cm5lZCAqLwoJCQl2YXIgYVByZURyYXcgPSBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUHJlRHJhd0NhbGxiYWNrJywgJ3ByZURyYXcnLCBbb1NldHRpbmdzXSApOwoJCQlpZiAoICQuaW5BcnJheSggZmFsc2UsIGFQcmVEcmF3ICkgIT09IC0xICkKCQkJewoJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJdmFyIGksIGlMZW4sIG47CgkJCXZhciBhblJvd3MgPSBbXTsKCQkJdmFyIGlSb3dDb3VudCA9IDA7CgkJCXZhciBpU3RyaXBlcyA9IG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMubGVuZ3RoOwoJCQl2YXIgaU9wZW5Sb3dzID0gb1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoOwoJCQkKCQkJb1NldHRpbmdzLmJEcmF3aW5nID0gdHJ1ZTsKCQkJCgkJCS8qIENoZWNrIGFuZCBzZWUgaWYgd2UgaGF2ZSBhbiBpbml0aWFsIGRyYXcgcG9zaXRpb24gZnJvbSBzdGF0ZSBzYXZpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgIT09IHVuZGVmaW5lZCAmJiBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgIT0gLTEgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAob1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID49IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkpID8KCQkJCQkJMCA6IG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCX0KCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IC0xOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyBkcmF3IGludGVyY2VwdCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nICkKCQkJewoJCQkJb1NldHRpbmdzLmJEZWZlckxvYWRpbmcgPSBmYWxzZTsKCQkJCW9TZXR0aW5ncy5pRHJhdysrOwoJCQl9CgkJCWVsc2UgaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5pRHJhdysrOwoJCQl9CgkJCWVsc2UgaWYgKCAhb1NldHRpbmdzLmJEZXN0cm95aW5nICYmICFfZm5BamF4VXBkYXRlKCBvU2V0dGluZ3MgKSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCXZhciBpU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQl2YXIgaUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlFbmQ7CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJaVN0YXJ0ID0gMDsKCQkJCQlpRW5kID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCQl9CgkJCQkKCQkJCWZvciAoIHZhciBqPWlTdGFydCA7IGo8aUVuZCA7IGorKyApCgkJCQl7CgkJCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbIG9TZXR0aW5ncy5haURpc3BsYXlbal0gXTsKCQkJCQlpZiAoIGFvRGF0YS5uVHIgPT09IG51bGwgKQoJCQkJCXsKCQkJCQkJX2ZuQ3JlYXRlVHIoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtqXSApOwoJCQkJCX0KCQkKCQkJCQl2YXIgblJvdyA9IGFvRGF0YS5uVHI7CgkJCQkJCgkJCQkJLyogUmVtb3ZlIHRoZSBvbGQgc3RyaXBpbmcgY2xhc3NlcyBhbmQgdGhlbiBhZGQgdGhlIG5ldyBvbmUgKi8KCQkJCQlpZiAoIGlTdHJpcGVzICE9PSAwICkKCQkJCQl7CgkJCQkJCXZhciBzU3RyaXBlID0gb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1sgaVJvd0NvdW50ICUgaVN0cmlwZXMgXTsKCQkJCQkJaWYgKCBhb0RhdGEuX3NSb3dTdHJpcGUgIT0gc1N0cmlwZSApCgkJCQkJCXsKCQkJCQkJCSQoblJvdykucmVtb3ZlQ2xhc3MoIGFvRGF0YS5fc1Jvd1N0cmlwZSApLmFkZENsYXNzKCBzU3RyaXBlICk7CgkJCQkJCQlhb0RhdGEuX3NSb3dTdHJpcGUgPSBzU3RyaXBlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFJvdyBjYWxsYmFjayBmdW5jdGlvbnMgLSBtaWdodCB3YW50IHRvIG1hbmlwdWxhdGUgdGhlIHJvdyAqLwoJCQkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9Sb3dDYWxsYmFjaycsIG51bGwsIAoJCQkJCQlbblJvdywgb1NldHRpbmdzLmFvRGF0YVsgb1NldHRpbmdzLmFpRGlzcGxheVtqXSBdLl9hRGF0YSwgaVJvd0NvdW50LCBqXSApOwoJCQkJCQoJCQkJCWFuUm93cy5wdXNoKCBuUm93ICk7CgkJCQkJaVJvd0NvdW50Kys7CgkJCQkJCgkJCQkJLyogSWYgdGhlcmUgaXMgYW4gb3BlbiByb3cgLSBhbmQgaXQgaXMgYXR0YWNoZWQgdG8gdGhpcyBwYXJlbnQgLSBhdHRhY2ggaXQgb24gcmVkcmF3ICovCgkJCQkJaWYgKCBpT3BlblJvd3MgIT09IDAgKQoJCQkJCXsKCQkJCQkJZm9yICggdmFyIGs9MCA7IGs8aU9wZW5Sb3dzIDsgaysrICkKCQkJCQkJewoJCQkJCQkJaWYgKCBuUm93ID09IG9TZXR0aW5ncy5hb09wZW5Sb3dzW2tdLm5QYXJlbnQgKQoJCQkJCQkJewoJCQkJCQkJCWFuUm93cy5wdXNoKCBvU2V0dGluZ3MuYW9PcGVuUm93c1trXS5uVHIgKTsKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFRhYmxlIGlzIGVtcHR5IC0gY3JlYXRlIGEgcm93IHdpdGggYW4gZW1wdHkgbWVzc2FnZSBpbiBpdCAqLwoJCQkJYW5Sb3dzWyAwIF0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndHInICk7CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1swXSApCgkJCQl7CgkJCQkJYW5Sb3dzWyAwIF0uY2xhc3NOYW1lID0gb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1swXTsKCQkJCX0KCQkKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2U7CgkJCQl2YXIgc1plcm8gPSBvTGFuZy5zWmVyb1JlY29yZHM7CgkJCQlpZiAoIG9TZXR0aW5ncy5pRHJhdyA9PSAxICYmIG9TZXR0aW5ncy5zQWpheFNvdXJjZSAhPT0gbnVsbCAmJiAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJc1plcm8gPSBvTGFuZy5zTG9hZGluZ1JlY29yZHM7CgkJCQl9CgkJCQllbHNlIGlmICggb0xhbmcuc0VtcHR5VGFibGUgJiYgb1NldHRpbmdzLmZuUmVjb3Jkc1RvdGFsKCkgPT09IDAgKQoJCQkJewoJCQkJCXNaZXJvID0gb0xhbmcuc0VtcHR5VGFibGU7CgkJCQl9CgkJCgkJCQl2YXIgblRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RkJyApOwoJCQkJblRkLnNldEF0dHJpYnV0ZSggJ3ZhbGlnbicsICJ0b3AiICk7CgkJCQluVGQuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQkJblRkLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUm93RW1wdHk7CgkJCQluVGQuaW5uZXJIVE1MID0gX2ZuSW5mb01hY3Jvcyggb1NldHRpbmdzLCBzWmVybyApOwoJCQkJCgkJCQlhblJvd3NbIGlSb3dDb3VudCBdLmFwcGVuZENoaWxkKCBuVGQgKTsKCQkJfQoJCQkKCQkJLyogSGVhZGVyIGFuZCBmb290ZXIgY2FsbGJhY2tzICovCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9IZWFkZXJDYWxsYmFjaycsICdoZWFkZXInLCBbICQob1NldHRpbmdzLm5USGVhZCkuY2hpbGRyZW4oJ3RyJylbMF0sIAoJCQkJX2ZuR2V0RGF0YU1hc3Rlciggb1NldHRpbmdzICksIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCwgb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpLCBvU2V0dGluZ3MuYWlEaXNwbGF5IF0gKTsKCQkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9Gb290ZXJDYWxsYmFjaycsICdmb290ZXInLCBbICQob1NldHRpbmdzLm5URm9vdCkuY2hpbGRyZW4oJ3RyJylbMF0sIAoJCQkJX2ZuR2V0RGF0YU1hc3Rlciggb1NldHRpbmdzICksIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCwgb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpLCBvU2V0dGluZ3MuYWlEaXNwbGF5IF0gKTsKCQkJCgkJCS8qIAoJCQkgKiBOZWVkIHRvIHJlbW92ZSBhbnkgb2xkIHJvdyBmcm9tIHRoZSBkaXNwbGF5IC0gbm90ZSB3ZSBjYW4ndCBqdXN0IGVtcHR5IHRoZSB0Ym9keSB1c2luZwoJCQkgKiAkKCkuaHRtbCgnJykgc2luY2UgdGhpcyB3aWxsIHVuYmluZCB0aGUgalF1ZXJ5IGV2ZW50IGhhbmRsZXJzIChldmVuIGFsdGhvdWdoIHRoZSBub2RlIAoJCQkgKiBzdGlsbCBleGlzdHMhKSAtIGVxdWFsbHkgd2UgY2FuJ3QgdXNlIGlubmVySFRNTCwgc2luY2UgSUUgdGhyb3dzIGFuIGV4Y2VwdGlvbi4KCQkJICovCgkJCXZhcgoJCQkJbkFkZEZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCgkJCQluUmVtb3ZlRnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKCQkJCW5Cb2R5UGFyLCBuVHJzOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3MublRCb2R5ICkKCQkJewoJCQkJbkJvZHlQYXIgPSBvU2V0dGluZ3MublRCb2R5LnBhcmVudE5vZGU7CgkJCQluUmVtb3ZlRnJhZy5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UQm9keSApOwoJCQkJCgkJCQkvKiBXaGVuIGRvaW5nIGluZmluaXRlIHNjcm9sbGluZywgb25seSByZW1vdmUgY2hpbGQgcm93cyB3aGVuIHNvcnRpbmcsIGZpbHRlcmluZyBvciBzdGFydAoJCQkJICogdXAuIFdoZW4gbm90IGluZmluaXRlIHNjcm9sbCwgYWx3YXlzIGRvIGl0LgoJCQkJICovCgkJCQlpZiAoICFvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgfHwgIW9TZXR0aW5ncy5fYkluaXRDb21wbGV0ZSB8fAoJCQkJIAlvU2V0dGluZ3MuYlNvcnRlZCB8fCBvU2V0dGluZ3MuYkZpbHRlcmVkICkKCQkJCXsKCQkJCQl3aGlsZSggKG4gPSBvU2V0dGluZ3MublRCb2R5LmZpcnN0Q2hpbGQpICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5uVEJvZHkucmVtb3ZlQ2hpbGQoIG4gKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIFB1dCB0aGUgZHJhdyB0YWJsZSBpbnRvIHRoZSBkb20gKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1hblJvd3MubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluQWRkRnJhZy5hcHBlbmRDaGlsZCggYW5Sb3dzW2ldICk7CgkJCQl9CgkJCQkKCQkJCW9TZXR0aW5ncy5uVEJvZHkuYXBwZW5kQ2hpbGQoIG5BZGRGcmFnICk7CgkJCQlpZiAoIG5Cb2R5UGFyICE9PSBudWxsICkKCQkJCXsKCQkJCQluQm9keVBhci5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UQm9keSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBDYWxsIGFsbCByZXF1aXJlZCBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHRoZSBlbmQgb2YgYSBkcmF3ICovCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9EcmF3Q2FsbGJhY2snLCAnZHJhdycsIFtvU2V0dGluZ3NdICk7CgkJCQoJCQkvKiBEcmF3IGlzIGNvbXBsZXRlLCBzb3J0aW5nIGFuZCBmaWx0ZXJpbmcgbXVzdCBiZSBhcyB3ZWxsICovCgkJCW9TZXR0aW5ncy5iU29ydGVkID0gZmFsc2U7CgkJCW9TZXR0aW5ncy5iRmlsdGVyZWQgPSBmYWxzZTsKCQkJb1NldHRpbmdzLmJEcmF3aW5nID0gZmFsc2U7CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJaWYgKCAhb1NldHRpbmdzLl9iSW5pdENvbXBsZXRlICkKCQkJCXsKCQkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncyApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlZHJhdyB0aGUgdGFibGUgLSB0YWtpbmcgYWNjb3VudCBvZiB0aGUgdmFyaW91cyBmZWF0dXJlcyB3aGljaCBhcmUgZW5hYmxlZAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlRHJhdyggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCS8qIFNvcnRpbmcgd2lsbCByZWZpbHRlciBhbmQgZHJhdyBmb3IgdXMgKi8KCQkJCV9mblNvcnQoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQkvKiBGaWx0ZXJpbmcgd2lsbCByZWRyYXcgZm9yIHVzICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQWRkIHRoZSBvcHRpb25zIHRvIHRoZSBwYWdlIEhUTUwgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkZE9wdGlvbnNIdG1sICggb1NldHRpbmdzICkKCQl7CgkJCS8qCgkJCSAqIENyZWF0ZSBhIHRlbXBvcmFyeSwgZW1wdHksIGRpdiB3aGljaCB3ZSBjYW4gbGF0ZXIgb24gcmVwbGFjZSB3aXRoIHdoYXQgd2UgaGF2ZSBnZW5lcmF0ZWQKCQkJICogd2UgZG8gaXQgdGhpcyB3YXkgdG8gcmVuZGVyaW5nIHRoZSAnb3B0aW9ucycgaHRtbCBvZmZsaW5lIC0gc3BlZWQgOi0pCgkJCSAqLwoJCQl2YXIgbkhvbGRpbmcgPSAkKCc8ZGl2PjwvZGl2PicpWzBdOwoJCQlvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBuSG9sZGluZywgb1NldHRpbmdzLm5UYWJsZSApOwoJCQkKCQkJLyogCgkJCSAqIEFsbCBEYXRhVGFibGVzIGFyZSB3cmFwcGVkIGluIGEgZGl2CgkJCSAqLwoJCQlvU2V0dGluZ3MublRhYmxlV3JhcHBlciA9ICQoJzxkaXYgaWQ9Iicrb1NldHRpbmdzLnNUYWJsZUlkKydfd3JhcHBlciIgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNXcmFwcGVyKyciIHJvbGU9ImdyaWQiPjwvZGl2PicpWzBdOwoJCQlvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgPSBvU2V0dGluZ3MublRhYmxlLm5leHRTaWJsaW5nOwoJCQoJCQkvKiBUcmFjayB3aGVyZSB3ZSB3YW50IHRvIGluc2VydCB0aGUgb3B0aW9uICovCgkJCXZhciBuSW5zZXJ0Tm9kZSA9IG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyOwoJCQkKCQkJLyogTG9vcCBvdmVyIHRoZSB1c2VyIHNldCBwb3NpdGlvbmluZyBhbmQgcGxhY2UgdGhlIGVsZW1lbnRzIGFzIG5lZWRlZCAqLwoJCQl2YXIgYURvbSA9IG9TZXR0aW5ncy5zRG9tLnNwbGl0KCcnKTsKCQkJdmFyIG5UbXAsIGlQdXNoRmVhdHVyZSwgY09wdGlvbiwgbk5ld05vZGUsIGNOZXh0LCBzQXR0ciwgajsKCQkJZm9yICggdmFyIGk9MCA7IGk8YURvbS5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpUHVzaEZlYXR1cmUgPSAwOwoJCQkJY09wdGlvbiA9IGFEb21baV07CgkJCQkKCQkJCWlmICggY09wdGlvbiA9PSAnPCcgKQoJCQkJewoJCQkJCS8qIE5ldyBjb250YWluZXIgZGl2ICovCgkJCQkJbk5ld05vZGUgPSAkKCc8ZGl2PjwvZGl2PicpWzBdOwoJCQkJCQoJCQkJCS8qIENoZWNrIHRvIHNlZSBpZiB3ZSBzaG91bGQgYXBwZW5kIGFuIGlkIGFuZC9vciBhIGNsYXNzIG5hbWUgdG8gdGhlIGNvbnRhaW5lciAqLwoJCQkJCWNOZXh0ID0gYURvbVtpKzFdOwoJCQkJCWlmICggY05leHQgPT0gIiciIHx8IGNOZXh0ID09ICciJyApCgkJCQkJewoJCQkJCQlzQXR0ciA9ICIiOwoJCQkJCQlqID0gMjsKCQkJCQkJd2hpbGUgKCBhRG9tW2kral0gIT0gY05leHQgKQoJCQkJCQl7CgkJCQkJCQlzQXR0ciArPSBhRG9tW2kral07CgkJCQkJCQlqKys7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIFJlcGxhY2UgalF1ZXJ5IFVJIGNvbnN0YW50cyAqLwoJCQkJCQlpZiAoIHNBdHRyID09ICJIIiApCgkJCQkJCXsKCQkJCQkJCXNBdHRyID0gb1NldHRpbmdzLm9DbGFzc2VzLnNKVUlIZWFkZXI7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHNBdHRyID09ICJGIiApCgkJCQkJCXsKCQkJCQkJCXNBdHRyID0gb1NldHRpbmdzLm9DbGFzc2VzLnNKVUlGb290ZXI7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIFRoZSBhdHRyaWJ1dGUgY2FuIGJlIGluIHRoZSBmb3JtYXQgb2YgIiNpZC5jbGFzcyIsICIjaWQiIG9yICJjbGFzcyIgVGhpcyBsb2dpYwoJCQkJCQkgKiBicmVha3MgdGhlIHN0cmluZyBpbnRvIHBhcnRzIGFuZCBhcHBsaWVzIHRoZW0gYXMgbmVlZGVkCgkJCQkJCSAqLwoJCQkJCQlpZiAoIHNBdHRyLmluZGV4T2YoJy4nKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCXZhciBhU3BsaXQgPSBzQXR0ci5zcGxpdCgnLicpOwoJCQkJCQkJbk5ld05vZGUuaWQgPSBhU3BsaXRbMF0uc3Vic3RyKDEsIGFTcGxpdFswXS5sZW5ndGgtMSk7CgkJCQkJCQluTmV3Tm9kZS5jbGFzc05hbWUgPSBhU3BsaXRbMV07CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHNBdHRyLmNoYXJBdCgwKSA9PSAiIyIgKQoJCQkJCQl7CgkJCQkJCQluTmV3Tm9kZS5pZCA9IHNBdHRyLnN1YnN0cigxLCBzQXR0ci5sZW5ndGgtMSk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQluTmV3Tm9kZS5jbGFzc05hbWUgPSBzQXR0cjsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJaSArPSBqOyAvKiBNb3ZlIGFsb25nIHRoZSBwb3NpdGlvbiBhcnJheSAqLwoJCQkJCX0KCQkJCQkKCQkJCQluSW5zZXJ0Tm9kZS5hcHBlbmRDaGlsZCggbk5ld05vZGUgKTsKCQkJCQluSW5zZXJ0Tm9kZSA9IG5OZXdOb2RlOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJz4nICkKCQkJCXsKCQkJCQkvKiBFbmQgY29udGFpbmVyIGRpdiAqLwoJCQkJCW5JbnNlcnROb2RlID0gbkluc2VydE5vZGUucGFyZW50Tm9kZTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdsJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJMZW5ndGhDaGFuZ2UgKQoJCQkJewoJCQkJCS8qIExlbmd0aCAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbExlbmd0aCggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdmJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQkJewoJCQkJCS8qIEZpbHRlciAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbEZpbHRlciggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdyJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQcm9jZXNzaW5nICkKCQkJCXsKCQkJCQkvKiBwUm9jZXNzaW5nICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICd0JyApCgkJCQl7CgkJCQkJLyogVGFibGUgKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxUYWJsZSggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICAnaScgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iSW5mbyApCgkJCQl7CgkJCQkJLyogSW5mbyAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbEluZm8oIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAncCcgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgKQoJCQkJewoJCQkJCS8qIFBhZ2luYXRpb24gKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBEYXRhVGFibGUuZXh0LmFvRmVhdHVyZXMubGVuZ3RoICE9PSAwICkKCQkJCXsKCQkJCQkvKiBQbHVnLWluIGZlYXR1cmVzICovCgkJCQkJdmFyIGFvRmVhdHVyZXMgPSBEYXRhVGFibGUuZXh0LmFvRmVhdHVyZXM7CgkJCQkJZm9yICggdmFyIGs9MCwga0xlbj1hb0ZlYXR1cmVzLmxlbmd0aCA7IGs8a0xlbiA7IGsrKyApCgkJCQkJewoJCQkJCQlpZiAoIGNPcHRpb24gPT0gYW9GZWF0dXJlc1trXS5jRmVhdHVyZSApCgkJCQkJCXsKCQkJCQkJCW5UbXAgPSBhb0ZlYXR1cmVzW2tdLmZuSW5pdCggb1NldHRpbmdzICk7CgkJCQkJCQlpZiAoIG5UbXAgKQoJCQkJCQkJewoJCQkJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQWRkIHRvIHRoZSAyRCBmZWF0dXJlcyBhcnJheSAqLwoJCQkJaWYgKCBpUHVzaEZlYXR1cmUgPT0gMSAmJiBuVG1wICE9PSBudWxsICkKCQkJCXsKCQkJCQlpZiAoIHR5cGVvZiBvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0gIT09ICdvYmplY3QnICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hYW5GZWF0dXJlc1tjT3B0aW9uXSA9IFtdOwoJCQkJCX0KCQkJCQlvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0ucHVzaCggblRtcCApOwoJCQkJCW5JbnNlcnROb2RlLmFwcGVuZENoaWxkKCBuVG1wICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEJ1aWx0IG91ciBET00gc3RydWN0dXJlIC0gcmVwbGFjZSB0aGUgaG9sZGluZyBkaXYgd2l0aCB3aGF0IHdlIHdhbnQgKi8KCQkJbkhvbGRpbmcucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoIG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyLCBuSG9sZGluZyApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVc2UgdGhlIERPTSBzb3VyY2UgdG8gY3JlYXRlIHVwIGFuIGFycmF5IG9mIGhlYWRlciBjZWxscy4gVGhlIGlkZWEgaGVyZSBpcyB0bwoJCSAqIGNyZWF0ZSBhIGxheW91dCBncmlkIChhcnJheSkgb2Ygcm93cyB4IGNvbHVtbnMsIHdoaWNoIGNvbnRhaW5zIGEgcmVmZXJlbmNlCgkJICogdG8gdGhlIGNlbGwgdGhhdCB0aGF0IHBvaW50IGluIHRoZSBncmlkIChyZWdhcmRsZXNzIG9mIGNvbC9yb3dzcGFuKSwgc3VjaCB0aGF0CgkJICogYW55IGNvbHVtbiAvIHJvdyBjb3VsZCBiZSByZW1vdmVkIGFuZCB0aGUgbmV3IGdyaWQgY29uc3RydWN0ZWQKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3R9IGFMYXlvdXQgQXJyYXkgdG8gc3RvcmUgdGhlIGNhbGN1bGF0ZWQgbGF5b3V0IGluCgkJICogIEBwYXJhbSB7bm9kZX0gblRoZWFkIFRoZSBoZWFkZXIvZm9vdGVyIGVsZW1lbnQgZm9yIHRoZSB0YWJsZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EZXRlY3RIZWFkZXIgKCBhTGF5b3V0LCBuVGhlYWQgKQoJCXsKCQkJdmFyIG5UcnMgPSAkKG5UaGVhZCkuY2hpbGRyZW4oJ3RyJyk7CgkJCXZhciBuVHIsIG5DZWxsOwoJCQl2YXIgaSwgaywgbCwgaUxlbiwgakxlbiwgaUNvbFNoaWZ0ZWQsIGlDb2x1bW4sIGlDb2xzcGFuLCBpUm93c3BhbjsKCQkJdmFyIGJVbmlxdWU7CgkJCXZhciBmblNoaWZ0Q29sID0gZnVuY3Rpb24gKCBhLCBpLCBqICkgewoJCQkJdmFyIGsgPSBhW2ldOwoJCSAgICAgICAgICAgICAgICB3aGlsZSAoIGtbal0gKSB7CgkJCQkJaisrOwoJCQkJfQoJCQkJcmV0dXJuIGo7CgkJCX07CgkJCgkJCWFMYXlvdXQuc3BsaWNlKCAwLCBhTGF5b3V0Lmxlbmd0aCApOwoJCQkKCQkJLyogV2Uga25vdyBob3cgbWFueSByb3dzIHRoZXJlIGFyZSBpbiB0aGUgbGF5b3V0IC0gc28gcHJlcCBpdCAqLwoJCQlmb3IgKCBpPTAsIGlMZW49blRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlhTGF5b3V0LnB1c2goIFtdICk7CgkJCX0KCQkJCgkJCS8qIENhbGN1bGF0ZSBhIGxheW91dCBhcnJheSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49blRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQluVHIgPSBuVHJzW2ldOwoJCQkJaUNvbHVtbiA9IDA7CgkJCQkKCQkJCS8qIEZvciBldmVyeSBjZWxsIGluIHRoZSByb3cuLi4gKi8KCQkJCW5DZWxsID0gblRyLmZpcnN0Q2hpbGQ7CgkJCQl3aGlsZSAoIG5DZWxsICkgewoJCQkJCWlmICggbkNlbGwubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVEQiIHx8CgkJCQkJICAgICBuQ2VsbC5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09ICJUSCIgKQoJCQkJCXsKCQkJCQkJLyogR2V0IHRoZSBjb2wgYW5kIHJvd3NwYW4gYXR0cmlidXRlcyBmcm9tIHRoZSBET00gYW5kIHNhbml0aXNlIHRoZW0gKi8KCQkJCQkJaUNvbHNwYW4gPSBuQ2VsbC5nZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nKSAqIDE7CgkJCQkJCWlSb3dzcGFuID0gbkNlbGwuZ2V0QXR0cmlidXRlKCdyb3dzcGFuJykgKiAxOwoJCQkJCQlpQ29sc3BhbiA9ICghaUNvbHNwYW4gfHwgaUNvbHNwYW49PT0wIHx8IGlDb2xzcGFuPT09MSkgPyAxIDogaUNvbHNwYW47CgkJCQkJCWlSb3dzcGFuID0gKCFpUm93c3BhbiB8fCBpUm93c3Bhbj09PTAgfHwgaVJvd3NwYW49PT0xKSA/IDEgOiBpUm93c3BhbjsKCQkKCQkJCQkJLyogVGhlcmUgbWlnaHQgYmUgY29sc3BhbiBjZWxscyBhbHJlYWR5IGluIHRoaXMgcm93LCBzbyBzaGlmdCBvdXIgdGFyZ2V0IAoJCQkJCQkgKiBhY2NvcmRpbmdseQoJCQkJCQkgKi8KCQkJCQkJaUNvbFNoaWZ0ZWQgPSBmblNoaWZ0Q29sKCBhTGF5b3V0LCBpLCBpQ29sdW1uICk7CgkJCQkJCQoJCQkJCQkvKiBDYWNoZSBjYWxjdWxhdGlvbiBmb3IgdW5pcXVlIGNvbHVtbnMgKi8KCQkJCQkJYlVuaXF1ZSA9IGlDb2xzcGFuID09PSAxID8gdHJ1ZSA6IGZhbHNlOwoJCQkJCQkKCQkJCQkJLyogSWYgdGhlcmUgaXMgY29sIC8gcm93c3BhbiwgY29weSB0aGUgaW5mb3JtYXRpb24gaW50byB0aGUgbGF5b3V0IGdyaWQgKi8KCQkJCQkJZm9yICggbD0wIDsgbDxpQ29sc3BhbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGs9MCA7IGs8aVJvd3NwYW4gOyBrKysgKQoJCQkJCQkJewoJCQkJCQkJCWFMYXlvdXRbaStrXVtpQ29sU2hpZnRlZCtsXSA9IHsKCQkJCQkJCQkJImNlbGwiOiBuQ2VsbCwKCQkJCQkJCQkJInVuaXF1ZSI6IGJVbmlxdWUKCQkJCQkJCQl9OwoJCQkJCQkJCWFMYXlvdXRbaStrXS5uVHIgPSBuVHI7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJbkNlbGwgPSBuQ2VsbC5uZXh0U2libGluZzsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgdW5pcXVlIHRoIGVsZW1lbnRzLCBvbmUgZm9yIGVhY2ggY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZGVyIGF1dG9tYXRpY2FsbHkgZGV0ZWN0IHRoZSBsYXlvdXQgZnJvbSB0aGlzIG5vZGUgLSBvcHRpb25hbAoJCSAqICBAcGFyYW0ge2FycmF5fSBhTGF5b3V0IHRoZWFkL3Rmb290IGxheW91dCBmcm9tIF9mbkRldGVjdEhlYWRlciAtIG9wdGlvbmFsCgkJICogIEByZXR1cm5zIGFycmF5IHtub2RlfSBhUmV0dXJuIGxpc3Qgb2YgdW5pcXVlIHRoJ3MKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0VW5pcXVlVGhzICggb1NldHRpbmdzLCBuSGVhZGVyLCBhTGF5b3V0ICkKCQl7CgkJCXZhciBhUmV0dXJuID0gW107CgkJCWlmICggIWFMYXlvdXQgKQoJCQl7CgkJCQlhTGF5b3V0ID0gb1NldHRpbmdzLmFvSGVhZGVyOwoJCQkJaWYgKCBuSGVhZGVyICkKCQkJCXsKCQkJCQlhTGF5b3V0ID0gW107CgkJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBhTGF5b3V0LCBuSGVhZGVyICk7CgkJCQl9CgkJCX0KCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hTGF5b3V0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAsIGpMZW49YUxheW91dFtpXS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggYUxheW91dFtpXVtqXS51bmlxdWUgJiYgCgkJCQkJCSAoIWFSZXR1cm5bal0gfHwgIW9TZXR0aW5ncy5iU29ydENlbGxzVG9wKSApCgkJCQkJewoJCQkJCQlhUmV0dXJuW2pdID0gYUxheW91dFtpXVtqXS5jZWxsOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFSZXR1cm47CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSB0aGUgdGFibGUgdXNpbmcgYW4gQWpheCBjYWxsCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IEJsb2NrIHRoZSB0YWJsZSBkcmF3aW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BamF4VXBkYXRlKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ICkKCQkJewoJCQkJb1NldHRpbmdzLmlEcmF3Kys7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJCXZhciBhb0RhdGEgPSBfZm5BamF4UGFyYW1ldGVycyggb1NldHRpbmdzICk7CgkJCQlfZm5TZXJ2ZXJQYXJhbXMoIG9TZXR0aW5ncywgYW9EYXRhICk7CgkJCQkKCQkJCW9TZXR0aW5ncy5mblNlcnZlckRhdGEuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLnNBamF4U291cmNlLCBhb0RhdGEsCgkJCQkJZnVuY3Rpb24oanNvbikgewoJCQkJCQlfZm5BamF4VXBkYXRlRHJhdyggb1NldHRpbmdzLCBqc29uICk7CgkJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBCdWlsZCB1cCB0aGUgcGFyYW1ldGVycyBpbiBhbiBvYmplY3QgbmVlZGVkIGZvciBhIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgcmVxdWVzdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sfSBibG9jayB0aGUgdGFibGUgZHJhd2luZyBvciBub3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWpheFBhcmFtZXRlcnMoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGFvRGF0YSA9IFtdLCBtRGF0YVByb3AsIGFhU29ydCwgYURhdGFTb3J0OwoJCQl2YXIgaSwgajsKCQkJCgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNFY2hvIiwgICAgICAgICAgInZhbHVlIjogb1NldHRpbmdzLmlEcmF3IH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaUNvbHVtbnMiLCAgICAgICAidmFsdWUiOiBpQ29sdW1ucyB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNDb2x1bW5zIiwgICAgICAgInZhbHVlIjogX2ZuQ29sdW1uT3JkZXJpbmcob1NldHRpbmdzKSB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlEaXNwbGF5U3RhcnQiLCAgInZhbHVlIjogb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaURpc3BsYXlMZW5ndGgiLCAidmFsdWUiOiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSAhPT0gZmFsc2UgPwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA6IC0xIH0gKTsKCQkJCQoJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bW5zIDsgaSsrICkKCQkJewoJCQkgIG1EYXRhUHJvcCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ubURhdGE7CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJtRGF0YVByb3BfIitpLCAidmFsdWUiOiB0eXBlb2YobURhdGFQcm9wKT09PSJmdW5jdGlvbiIgPyAnZnVuY3Rpb24nIDogbURhdGFQcm9wIH0gKTsKCQkJfQoJCQkKCQkJLyogRmlsdGVyaW5nICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICE9PSBmYWxzZSApCgkJCXsKCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNTZWFyY2giLCAidmFsdWUiOiBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLnNTZWFyY2ggfSApOwoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiYlJlZ2V4IiwgICJ2YWx1ZSI6IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2guYlJlZ2V4IH0gKTsKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJewoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNTZWFyY2hfIitpLCAgICAgInZhbHVlIjogb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1tpXS5zU2VhcmNoIH0gKTsKCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiUmVnZXhfIitpLCAgICAgICJ2YWx1ZSI6IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbaV0uYlJlZ2V4IH0gKTsKCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiU2VhcmNoYWJsZV8iK2ksICJ2YWx1ZSI6IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNlYXJjaGFibGUgfSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBTb3J0aW5nICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCAhPT0gZmFsc2UgKQoJCQl7CgkJCQl2YXIgaUNvdW50ZXIgPSAwOwoJCQoJCQkJYWFTb3J0ID0gKCBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwgKSA/CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkLmNvbmNhdCggb1NldHRpbmdzLmFhU29ydGluZyApIDoKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCQkKCQkJCWZvciAoIGk9MCA7IGk8YWFTb3J0Lmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJYURhdGFTb3J0ID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgYWFTb3J0W2ldWzBdIF0uYURhdGFTb3J0OwoJCQkJCQoJCQkJCWZvciAoIGo9MCA7IGo8YURhdGFTb3J0Lmxlbmd0aCA7IGorKyApCgkJCQkJewoJCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpU29ydENvbF8iK2lDb3VudGVyLCAgInZhbHVlIjogYURhdGFTb3J0W2pdIH0gKTsKCQkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NvcnREaXJfIitpQ291bnRlciwgICJ2YWx1ZSI6IGFhU29ydFtpXVsxXSB9ICk7CgkJCQkJCWlDb3VudGVyKys7CgkJCQkJfQoJCQkJfQoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaVNvcnRpbmdDb2xzIiwgICAidmFsdWUiOiBpQ291bnRlciB9ICk7CgkJCQkKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJewoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJTb3J0YWJsZV8iK2ksICAidmFsdWUiOiBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSB9ICk7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBhb0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBBamF4IHBhcmFtZXRlcnMgZnJvbSBwbHVnLWlucwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSBhcnJheSB7b2JqZWN0c30gYW9EYXRhIG5hbWUvdmFsdWUgcGFpcnMgdG8gc2VuZCB0byB0aGUgc2VydmVyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKQoJCXsKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1NlcnZlclBhcmFtcycsICdzZXJ2ZXJQYXJhbXMnLCBbYW9EYXRhXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBEYXRhIHRoZSBkYXRhIGZyb20gdGhlIHNlcnZlciAobnVraW5nIHRoZSBvbGQpIGFuZCByZWRyYXcgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24ganNvbiBkYXRhIHJldHVybiBmcm9tIHRoZSBzZXJ2ZXIuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBqc29uLnNFY2hvIFRyYWNraW5nIGZsYWcgZm9yIERhdGFUYWJsZXMgdG8gbWF0Y2ggcmVxdWVzdHMKCQkgKiAgQHBhcmFtIHtpbnR9IGpzb24uaVRvdGFsUmVjb3JkcyBOdW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgZGF0YSBzZXQsIG5vdCBhY2NvdW50aW5nIGZvciBmaWx0ZXJpbmcKCQkgKiAgQHBhcmFtIHtpbnR9IGpzb24uaVRvdGFsRGlzcGxheVJlY29yZHMgTnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGRhdGEgc2V0LCBhY2NvdW50aW5nIGZvciBmaWx0ZXJpbmcKCQkgKiAgQHBhcmFtIHthcnJheX0ganNvbi5hYURhdGEgVGhlIGRhdGEgdG8gZGlzcGxheSBvbiB0aGlzIHBhZ2UKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtqc29uLnNDb2x1bW5zXSBDb2x1bW4gb3JkZXJpbmcgKHNOYW1lLCBjb21tYSBzZXBhcmF0ZWQpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFqYXhVcGRhdGVEcmF3ICggb1NldHRpbmdzLCBqc29uICkKCQl7CgkJCWlmICgganNvbi5zRWNobyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJLyogUHJvdGVjdCBhZ2FpbnN0IG9sZCByZXR1cm5zIG92ZXItd3JpdGluZyBhIG5ldyBvbmUuIFBvc3NpYmxlIHdoZW4geW91IGdldAoJCQkJICogdmVyeSBmYXN0IGludGVyYWN0aW9uLCBhbmQgbGF0ZXIgcXVlcmllcyBhcmUgY29tcGxldGVkIG11Y2ggZmFzdGVyCgkJCQkgKi8KCQkJCWlmICgganNvbi5zRWNobyoxIDwgb1NldHRpbmdzLmlEcmF3ICkKCQkJCXsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLmlEcmF3ID0ganNvbi5zRWNobyAqIDE7CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggIW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSB8fAoJCQkJICAgKG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSAmJiAob1NldHRpbmdzLmJTb3J0ZWQgfHwgb1NldHRpbmdzLmJGaWx0ZXJlZCkpICkKCQkJewoJCQkJX2ZuQ2xlYXJUYWJsZSggb1NldHRpbmdzICk7CgkJCX0KCQkJb1NldHRpbmdzLl9pUmVjb3Jkc1RvdGFsID0gcGFyc2VJbnQoanNvbi5pVG90YWxSZWNvcmRzLCAxMCk7CgkJCW9TZXR0aW5ncy5faVJlY29yZHNEaXNwbGF5ID0gcGFyc2VJbnQoanNvbi5pVG90YWxEaXNwbGF5UmVjb3JkcywgMTApOwoJCQkKCQkJLyogRGV0ZXJtaW5lIGlmIHJlb3JkZXJpbmcgaXMgcmVxdWlyZWQgKi8KCQkJdmFyIHNPcmRlcmluZyA9IF9mbkNvbHVtbk9yZGVyaW5nKG9TZXR0aW5ncyk7CgkJCXZhciBiUmVPcmRlciA9IChqc29uLnNDb2x1bW5zICE9PSB1bmRlZmluZWQgJiYgc09yZGVyaW5nICE9PSAiIiAmJiBqc29uLnNDb2x1bW5zICE9IHNPcmRlcmluZyApOwoJCQl2YXIgYWlJbmRleDsKCQkJaWYgKCBiUmVPcmRlciApCgkJCXsKCQkJCWFpSW5kZXggPSBfZm5SZU9yZGVySW5kZXgoIG9TZXR0aW5ncywganNvbi5zQ29sdW1ucyApOwoJCQl9CgkJCQoJCQl2YXIgYURhdGEgPSBfZm5HZXRPYmplY3REYXRhRm4oIG9TZXR0aW5ncy5zQWpheERhdGFQcm9wICkoIGpzb24gKTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGJSZU9yZGVyICkKCQkJCXsKCQkJCQkvKiBJZiB3ZSBuZWVkIHRvIHJlLW9yZGVyLCB0aGVuIGNyZWF0ZSBhIG5ldyBhcnJheSB3aXRoIHRoZSBjb3JyZWN0IG9yZGVyIGFuZCBhZGQgaXQgKi8KCQkJCQl2YXIgYURhdGFTb3J0ZWQgPSBbXTsKCQkJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydGVkLnB1c2goIGFEYXRhW2ldWyBhaUluZGV4W2pdIF0gKTsKCQkJCQl9CgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBhRGF0YVNvcnRlZCApOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIE5vIHJlLW9yZGVyIHJlcXVpcmVkLCBzZXZlciBnb3QgaXQgInJpZ2h0IiAtIGp1c3Qgc3RyYWlnaHQgYWRkICovCgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBhRGF0YVtpXSApOwoJCQkJfQoJCQl9CgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQlvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ID0gZmFsc2U7CgkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQlvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ID0gdHJ1ZTsKCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIGZpbHRlcmluZyB0ZXh0CgkJICogIEByZXR1cm5zIHtub2RlfSBGaWx0ZXIgY29udHJvbCBlbGVtZW50CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxGaWx0ZXIgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIG9QcmV2aW91c1NlYXJjaCA9IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2g7CgkJCQoJCQl2YXIgc1NlYXJjaFN0ciA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1NlYXJjaDsKCQkJc1NlYXJjaFN0ciA9IChzU2VhcmNoU3RyLmluZGV4T2YoJ19JTlBVVF8nKSAhPT0gLTEpID8KCQkJICBzU2VhcmNoU3RyLnJlcGxhY2UoJ19JTlBVVF8nLCAnPGlucHV0IHR5cGU9InRleHQiIC8+JykgOgoJCQkgIHNTZWFyY2hTdHI9PT0iIiA/ICc8aW5wdXQgdHlwZT0idGV4dCIgLz4nIDogc1NlYXJjaFN0cisnIDxpbnB1dCB0eXBlPSJ0ZXh0IiAvPic7CgkJCQoJCQl2YXIgbkZpbHRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCW5GaWx0ZXIuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNGaWx0ZXI7CgkJCW5GaWx0ZXIuaW5uZXJIVE1MID0gJzxsYWJlbD4nK3NTZWFyY2hTdHIrJzwvbGFiZWw+JzsKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmYgKQoJCQl7CgkJCQluRmlsdGVyLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfZmlsdGVyJzsKCQkJfQoJCQkKCQkJdmFyIGpxRmlsdGVyID0gJCgnaW5wdXRbdHlwZT0idGV4dCJdJywgbkZpbHRlcik7CgkJCgkJCS8vIFN0b3JlIGEgcmVmZXJlbmNlIHRvIHRoZSBpbnB1dCBlbGVtZW50LCBzbyBvdGhlciBpbnB1dCBlbGVtZW50cyBjb3VsZCBiZQoJCQkvLyBhZGRlZCB0byB0aGUgZmlsdGVyIHdyYXBwZXIgaWYgbmVlZGVkIChzdWJtaXQgYnV0dG9uIGZvciBleGFtcGxlKQoJCQluRmlsdGVyLl9EVF9JbnB1dCA9IGpxRmlsdGVyWzBdOwoJCQoJCQlqcUZpbHRlci52YWwoIG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoLnJlcGxhY2UoJyInLCcmcXVvdDsnKSApOwoJCQlqcUZpbHRlci5iaW5kKCAna2V5dXAuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGZpbHRlciBpbnB1dCBlbGVtZW50cyBmb3IgdGhlIG5ldyBkaXNwbGF5ICovCgkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJdmFyIHZhbCA9IHRoaXMudmFsdWU9PT0iIiA/ICIiIDogdGhpcy52YWx1ZTsgLy8gbWVudGFsIElFOCBmaXggOi0oCgkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG5baV0gIT0gJCh0aGlzKS5wYXJlbnRzKCdkaXYuZGF0YVRhYmxlc19maWx0ZXInKVswXSApCgkJCQkJewoJCQkJCQkkKG5baV0uX0RUX0lucHV0KS52YWwoIHZhbCApOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogTm93IGRvIHRoZSBmaWx0ZXIgKi8KCQkJCWlmICggdmFsICE9IG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoICkKCQkJCXsKCQkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCB7IAoJCQkJCQkic1NlYXJjaCI6IHZhbCwgCgkJCQkJCSJiUmVnZXgiOiBvUHJldmlvdXNTZWFyY2guYlJlZ2V4LAoJCQkJCQkiYlNtYXJ0Ijogb1ByZXZpb3VzU2VhcmNoLmJTbWFydCAsCgkJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogb1ByZXZpb3VzU2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgCgkJCQkJfSApOwoJCQkJfQoJCQl9ICk7CgkJCgkJCWpxRmlsdGVyCgkJCQkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkJLyogUHJldmVudCBmb3JtIHN1Ym1pc3Npb24gKi8KCQkJCQlpZiAoIGUua2V5Q29kZSA9PSAxMyApCgkJCQkJewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQkpOwoJCQkKCQkJcmV0dXJuIG5GaWx0ZXI7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgdGFibGUgdXNpbmcgYm90aCB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgY29sdW1uIGJhc2VkIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2VhcmNoIHNlYXJjaCBpbmZvcm1hdGlvbgoJCSAqICBAcGFyYW0ge2ludH0gW2lGb3JjZV0gZm9yY2UgYSByZXNlYXJjaCBvZiB0aGUgbWFzdGVyIGFycmF5ICgxKSBvciBub3QgKHVuZGVmaW5lZCBvciAwKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb21wbGV0ZSAoIG9TZXR0aW5ncywgb0lucHV0LCBpRm9yY2UgKQoJCXsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJdmFyIGFvUHJldlNlYXJjaCA9IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHM7CgkJCXZhciBmblNhdmVGaWx0ZXIgPSBmdW5jdGlvbiAoIG9GaWx0ZXIgKSB7CgkJCQkvKiBTYXZlIHRoZSBmaWx0ZXJpbmcgdmFsdWVzICovCgkJCQlvUHJldlNlYXJjaC5zU2VhcmNoID0gb0ZpbHRlci5zU2VhcmNoOwoJCQkJb1ByZXZTZWFyY2guYlJlZ2V4ID0gb0ZpbHRlci5iUmVnZXg7CgkJCQlvUHJldlNlYXJjaC5iU21hcnQgPSBvRmlsdGVyLmJTbWFydDsKCQkJCW9QcmV2U2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgPSBvRmlsdGVyLmJDYXNlSW5zZW5zaXRpdmU7CgkJCX07CgkJCgkJCS8qIEluIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgYWxsIGZpbHRlcmluZyBpcyBkb25lIGJ5IHRoZSBzZXJ2ZXIsIHNvIG5vIHBvaW50IGhhbmdpbmcgYXJvdW5kIGhlcmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCS8qIEdsb2JhbCBmaWx0ZXIgKi8KCQkJCV9mbkZpbHRlciggb1NldHRpbmdzLCBvSW5wdXQuc1NlYXJjaCwgaUZvcmNlLCBvSW5wdXQuYlJlZ2V4LCBvSW5wdXQuYlNtYXJ0LCBvSW5wdXQuYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQkJZm5TYXZlRmlsdGVyKCBvSW5wdXQgKTsKCQkKCQkJCS8qIE5vdyBkbyB0aGUgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVyICovCgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJX2ZuRmlsdGVyQ29sdW1uKCBvU2V0dGluZ3MsIGFvUHJldlNlYXJjaFtpXS5zU2VhcmNoLCBpLCBhb1ByZXZTZWFyY2hbaV0uYlJlZ2V4LCAKCQkJCQkJYW9QcmV2U2VhcmNoW2ldLmJTbWFydCwgYW9QcmV2U2VhcmNoW2ldLmJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJCX0KCQkJCQoJCQkJLyogQ3VzdG9tIGZpbHRlcmluZyAqLwoJCQkJX2ZuRmlsdGVyQ3VzdG9tKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWZuU2F2ZUZpbHRlciggb0lucHV0ICk7CgkJCX0KCQkJCgkJCS8qIFRlbGwgdGhlIGRyYXcgZnVuY3Rpb24gd2UgaGF2ZSBiZWVuIGZpbHRlcmluZyAqLwoJCQlvU2V0dGluZ3MuYkZpbHRlcmVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdmaWx0ZXInLCBvU2V0dGluZ3MpOwoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8qIFJlYnVpbGQgc2VhcmNoIGFycmF5ICdvZmZsaW5lJyAqLwoJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDAgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgY3VzdG9tIGZpbHRlcmluZyBmdW5jdGlvbnMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDdXN0b20oIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYWZuRmlsdGVycyA9IERhdGFUYWJsZS5leHQuYWZuRmlsdGVyaW5nOwoJCQl2YXIgYWlGaWx0ZXJDb2x1bW5zID0gX2ZuR2V0Q29sdW1ucyggb1NldHRpbmdzLCAnYlNlYXJjaGFibGUnICk7CgkJCgkJCWZvciAoIHZhciBpPTAsIGlMZW49YWZuRmlsdGVycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgaUNvcnJlY3RvciA9IDA7CgkJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQl2YXIgaURpc0luZGV4ID0gb1NldHRpbmdzLmFpRGlzcGxheVtqLWlDb3JyZWN0b3JdOwoJCQkJCXZhciBiVGVzdCA9IGFmbkZpbHRlcnNbaV0oCgkJCQkJCW9TZXR0aW5ncywKCQkJCQkJX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpRGlzSW5kZXgsICdmaWx0ZXInLCBhaUZpbHRlckNvbHVtbnMgKSwKCQkJCQkJaURpc0luZGV4CgkJCQkJKTsKCQkJCQkKCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgdXNlIHRoaXMgcm93IGJhc2VkIG9uIHRoZSBmaWx0ZXJpbmcgZnVuY3Rpb24gKi8KCQkJCQlpZiAoICFiVGVzdCApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggai1pQ29ycmVjdG9yLCAxICk7CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSB0YWJsZSBvbiBhIHBlci1jb2x1bW4gYmFzaXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2x1bW4gY29sdW1uIHRvIGZpbHRlcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBzZWFyY2ggc3RyaW5nIGFzIGEgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTbWFydCB1c2Ugc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb2x1bW4gKCBvU2V0dGluZ3MsIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJaWYgKCBzSW5wdXQgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJdmFyIHJwU2VhcmNoID0gX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoKCBzSW5wdXQsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICk7CgkJCQoJCQlmb3IgKCB2YXIgaT1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCXZhciBzRGF0YSA9IF9mbkRhdGFUb1NlYXJjaCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtpXSwgaUNvbHVtbiwgJ2ZpbHRlcicgKSwKCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLnNUeXBlICk7CgkJCQlpZiAoICEgcnBTZWFyY2gudGVzdCggc0RhdGEgKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIGksIDEgKTsKCQkJCQlpSW5kZXhDb3JyZWN0b3IrKzsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIGRhdGEgdGFibGUgYmFzZWQgb24gdXNlciBpbnB1dCBhbmQgZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlGb3JjZSBvcHRpb25hbCAtIGZvcmNlIGEgcmVzZWFyY2ggb2YgdGhlIG1hc3RlciBhcnJheSAoMSkgb3Igbm90ICh1bmRlZmluZWQgb3IgMCkKCQkgKiAgQHBhcmFtIHtib29sfSBiUmVnZXggdHJlYXQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNtYXJ0IHBlcmZvcm0gc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXIoIG9TZXR0aW5ncywgc0lucHV0LCBpRm9yY2UsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBpOwoJCQl2YXIgcnBTZWFyY2ggPSBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNJbnB1dCwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIGFyZSBmb3JjaW5nIG9yIG5vdCAtIG9wdGlvbmFsIHBhcmFtZXRlciAqLwoJCQlpZiAoICFpRm9yY2UgKQoJCQl7CgkJCQlpRm9yY2UgPSAwOwoJCQl9CgkJCQoJCQkvKiBOZWVkIHRvIHRha2UgYWNjb3VudCBvZiBjdXN0b20gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIGFsd2F5cyBmaWx0ZXIgKi8KCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmbkZpbHRlcmluZy5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlpRm9yY2UgPSAxOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBJZiB0aGUgaW5wdXQgaXMgYmxhbmsgLSB3ZSB3YW50IHRoZSBmdWxsIGRhdGEgc2V0CgkJCSAqLwoJCQlpZiAoIHNJbnB1dC5sZW5ndGggPD0gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyoKCQkJCSAqIFdlIGFyZSBzdGFydGluZyBhIG5ldyBzZWFyY2ggb3IgdGhlIG5ldyBzZWFyY2ggc3RyaW5nIGlzIHNtYWxsZXIgCgkJCQkgKiB0aGVuIHRoZSBvbGQgb25lIChpLmUuIGRlbGV0ZSkuIFNlYXJjaCBmcm9tIHRoZSBtYXN0ZXIgYXJyYXkKCQkJIAkgKi8KCQkJCWlmICggb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggPT0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggfHwKCQkJCQkgICBvUHJldlNlYXJjaC5zU2VhcmNoLmxlbmd0aCA+IHNJbnB1dC5sZW5ndGggfHwgaUZvcmNlID09IDEgfHwKCQkJCQkgICBzSW5wdXQuaW5kZXhPZihvUHJldlNlYXJjaC5zU2VhcmNoKSAhPT0gMCApCgkJCQl7CgkJCQkJLyogTnVrZSB0aGUgb2xkIGRpc3BsYXkgYXJyYXkgLSB3ZSBhcmUgZ29pbmcgdG8gcmVidWlsZCBpdCAqLwoJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQkJCgkJCQkJLyogRm9yY2UgYSByZWJ1aWxkIG9mIHRoZSBzZWFyY2ggYXJyYXkgKi8KCQkJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDEgKTsKCQkJCQkKCQkJCQkvKiBTZWFyY2ggdGhyb3VnaCBhbGwgcmVjb3JkcyB0byBwb3B1bGF0ZSB0aGUgc2VhcmNoIGFycmF5CgkJCQkJICogVGhlIHRoZSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyIGFuZCBhc0RhdGFTZWFyY2ggYXJyYXlzIGhhdmUgMSB0byAxIAoJCQkJCSAqIG1hcHBpbmcKCQkJCQkgKi8KCQkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggcnBTZWFyY2gudGVzdChvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2ldKSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkucHVzaCggb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcltpXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkgIH0KCQkJICBlbHNlCgkJCQl7CgkJCSAgCS8qIFVzaW5nIG9sZCBzZWFyY2ggYXJyYXkgLSByZWZpbmUgaXQgLSBkbyBpdCB0aGlzIHdheSBmb3Igc3BlZWQKCQkJICAJICogRG9uJ3QgaGF2ZSB0byBzZWFyY2ggdGhlIHdob2xlIG1hc3RlciBhcnJheSBhZ2FpbgoJCQkJCSAqLwoJCQkgIAl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJICAJCgkJCSAgCS8qIFNlYXJjaCB0aGUgY3VycmVudCByZXN1bHRzICovCgkJCSAgCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJICAJCWlmICggISBycFNlYXJjaC50ZXN0KG9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0pICkKCQkJCQkJewoJCQkgIAkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCBpLWlJbmRleENvcnJlY3RvciwgMSApOwoJCQkgIAkJCWlJbmRleENvcnJlY3RvcisrOwoJCQkgIAkJfQoJCQkgIAl9CgkJCSAgfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhbiBhcnJheSB3aGljaCBjYW4gYmUgcXVpY2tseSBzZWFyY2ggdGhyb3VnaAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWFzdGVyIHVzZSB0aGUgbWFzdGVyIGRhdGEgYXJyYXkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaEFycmF5ICggb1NldHRpbmdzLCBpTWFzdGVyICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQkvKiBDbGVhciBvdXQgdGhlIG9sZCBkYXRhICovCgkJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoID0gW107CgkJCgkJCQl2YXIgYWlGaWx0ZXJDb2x1bW5zID0gX2ZuR2V0Q29sdW1ucyggb1NldHRpbmdzLCAnYlNlYXJjaGFibGUnICk7CgkJCQl2YXIgYWlJbmRleCA9IChpTWFzdGVyPT09MSkgPwoJCQkJIAlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyIDoKCQkJCSAJb1NldHRpbmdzLmFpRGlzcGxheTsKCQkJCQoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1haUluZGV4Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGF0YVNlYXJjaFtpXSA9IF9mbkJ1aWxkU2VhcmNoUm93KAoJCQkJCQlvU2V0dGluZ3MsCgkJCQkJCV9mbkdldFJvd0RhdGEoIG9TZXR0aW5ncywgYWlJbmRleFtpXSwgJ2ZpbHRlcicsIGFpRmlsdGVyQ29sdW1ucyApCgkJCQkJKTsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBzZWFyY2hhYmxlIHN0cmluZyBmcm9tIGEgc2luZ2xlIGRhdGEgcm93CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgUm93IGRhdGEgYXJyYXkgdG8gdXNlIGZvciB0aGUgZGF0YSB0byBzZWFyY2gKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQnVpbGRTZWFyY2hSb3coIG9TZXR0aW5ncywgYURhdGEgKQoJCXsKCQkJdmFyIHNTZWFyY2ggPSBhRGF0YS5qb2luKCcgICcpOwoJCQkKCQkJLyogSWYgaXQgbG9va3MgbGlrZSB0aGVyZSBpcyBhbiBIVE1MIGVudGl0eSBpbiB0aGUgc3RyaW5nLCBhdHRlbXB0IHRvIGRlY29kZSBpdCAqLwoJCQlpZiAoIHNTZWFyY2guaW5kZXhPZignJicpICE9PSAtMSApCgkJCXsKCQkJCXNTZWFyY2ggPSAkKCc8ZGl2PicpLmh0bWwoc1NlYXJjaCkudGV4dCgpOwoJCQl9CgkJCQoJCQkvLyBTdHJpcCBuZXdsaW5lIGNoYXJhY3RlcnMKCQkJcmV0dXJuIHNTZWFyY2gucmVwbGFjZSggL1tcblxyXS9nLCAiICIgKTsKCQl9CgkJCgkJLyoqCgkJICogQnVpbGQgYSByZWd1bGFyIGV4cHJlc3Npb24gb2JqZWN0IHN1aXRhYmxlIGZvciBzZWFyY2hpbmcgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NlYXJjaCBzdHJpbmcgdG8gc2VhcmNoIGZvcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU21hcnQgcGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc2l0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAcmV0dXJucyB7UmVnRXhwfSBjb25zdHJ1Y3RlZCBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoKCBzU2VhcmNoLCBiUmVnZXgsIGJTbWFydCwgYkNhc2VJbnNlbnNpdGl2ZSApCgkJewoJCQl2YXIgYXNTZWFyY2gsIHNSZWdFeHBTdHJpbmc7CgkJCQoJCQlpZiAoIGJTbWFydCApCgkJCXsKCQkJCS8qIEdlbmVyYXRlIHRoZSByZWd1bGFyIGV4cHJlc3Npb24gdG8gdXNlLiBTb21ldGhpbmcgYWxvbmcgdGhlIGxpbmVzIG9mOgoJCQkJICogXig/PS4qP1xib25lXGIpKD89Lio/XGJ0d29cYikoPz0uKj9cYnRocmVlXGIpLiokCgkJCQkgKi8KCQkJCWFzU2VhcmNoID0gYlJlZ2V4ID8gc1NlYXJjaC5zcGxpdCggJyAnICkgOiBfZm5Fc2NhcGVSZWdleCggc1NlYXJjaCApLnNwbGl0KCAnICcgKTsKCQkJCXNSZWdFeHBTdHJpbmcgPSAnXig/PS4qPycrYXNTZWFyY2guam9pbiggJykoPz0uKj8nICkrJykuKiQnOwoJCQkJcmV0dXJuIG5ldyBSZWdFeHAoIHNSZWdFeHBTdHJpbmcsIGJDYXNlSW5zZW5zaXRpdmUgPyAiaSIgOiAiIiApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJc1NlYXJjaCA9IGJSZWdleCA/IHNTZWFyY2ggOiBfZm5Fc2NhcGVSZWdleCggc1NlYXJjaCApOwoJCQkJcmV0dXJuIG5ldyBSZWdFeHAoIHNTZWFyY2gsIGJDYXNlSW5zZW5zaXRpdmUgPyAiaSIgOiAiIiApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvbnZlcnQgcmF3IGRhdGEgaW50byBzb21ldGhpbmcgdGhhdCB0aGUgdXNlciBjYW4gc2VhcmNoIG9uCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRGF0YSBkYXRhIHRvIGJlIG1vZGlmaWVkCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVHlwZSBkYXRhIHR5cGUKCQkgKiAgQHJldHVybnMge3N0cmluZ30gc2VhcmNoIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EYXRhVG9TZWFyY2ggKCBzRGF0YSwgc1R5cGUgKQoJCXsKCQkJaWYgKCB0eXBlb2YgRGF0YVRhYmxlLmV4dC5vZm5TZWFyY2hbc1R5cGVdID09PSAiZnVuY3Rpb24iICkKCQkJewoJCQkJcmV0dXJuIERhdGFUYWJsZS5leHQub2ZuU2VhcmNoW3NUeXBlXSggc0RhdGEgKTsKCQkJfQoJCQllbHNlIGlmICggc0RhdGEgPT09IG51bGwgKQoJCQl7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQkJZWxzZSBpZiAoIHNUeXBlID09ICJodG1sIiApCgkJCXsKCQkJCXJldHVybiBzRGF0YS5yZXBsYWNlKC9bXHJcbl0vZywiICIpLnJlcGxhY2UoIC88Lio/Pi9nLCAiIiApOwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICJzdHJpbmciICkKCQkJewoJCQkJcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1tcclxuXS9nLCIgIik7CgkJCX0KCQkJcmV0dXJuIHNEYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBzY2FwZSBhIHN0cmluZyBzdWNoIHRoYXQgaXQgY2FuIGJlIHVzZWQgaW4gYSByZWd1bGFyIGV4cHJlc3Npb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWYWwgc3RyaW5nIHRvIGVzY2FwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBlc2NhcGVkIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Fc2NhcGVSZWdleCAoIHNWYWwgKQoJCXsKCQkJdmFyIGFjRXNjYXBlID0gWyAnLycsICcuJywgJyonLCAnKycsICc/JywgJ3wnLCAnKCcsICcpJywgJ1snLCAnXScsICd7JywgJ30nLCAnXFwnLCAnJCcsICdeJywgJy0nIF07CgkJCXZhciByZVJlcGxhY2UgPSBuZXcgUmVnRXhwKCAnKFxcJyArIGFjRXNjYXBlLmpvaW4oJ3xcXCcpICsgJyknLCAnZycgKTsKCQkJcmV0dXJuIHNWYWwucmVwbGFjZShyZVJlcGxhY2UsICdcXCQxJyk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciB0aGUgaW5mbyBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge25vZGV9IEluZm9ybWF0aW9uIGVsZW1lbnQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxJbmZvICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBuSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCW5JbmZvLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zSW5mbzsKCQkJCgkJCS8qIEFjdGlvbnMgdGhhdCBhcmUgdG8gYmUgdGFrZW4gb25jZSBvbmx5IGZvciB0aGlzIGZlYXR1cmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmkgKQoJCQl7CgkJCQkvKiBBZGQgZHJhdyBjYWxsYmFjayAqLwoJCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCQkiZm4iOiBfZm5VcGRhdGVJbmZvLAoJCQkJCSJzTmFtZSI6ICJpbmZvcm1hdGlvbiIKCQkJCX0gKTsKCQkJCQoJCQkJLyogQWRkIGlkICovCgkJCQluSW5mby5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX2luZm8nOwoJCQl9CgkJCW9TZXR0aW5ncy5uVGFibGUuc2V0QXR0cmlidXRlKCAnYXJpYS1kZXNjcmliZWRieScsIG9TZXR0aW5ncy5zVGFibGVJZCsnX2luZm8nICk7CgkJCQoJCQlyZXR1cm4gbkluZm87CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSB0aGUgaW5mb3JtYXRpb24gZWxlbWVudHMgaW4gdGhlIGRpc3BsYXkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5VcGRhdGVJbmZvICggb1NldHRpbmdzICkKCQl7CgkJCS8qIFNob3cgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHRhYmxlICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYkluZm8gfHwgb1NldHRpbmdzLmFhbkZlYXR1cmVzLmkubGVuZ3RoID09PSAwICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIKCQkJCW9MYW5nID0gb1NldHRpbmdzLm9MYW5ndWFnZSwKCQkJCWlTdGFydCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCsxLAoJCQkJaUVuZCA9IG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwKCQkJCWlNYXggPSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSwKCQkJCWlUb3RhbCA9IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCksCgkJCQlzT3V0OwoJCQkKCQkJaWYgKCBpVG90YWwgPT09IDAgKQoJCQl7CgkJCQkvKiBFbXB0eSByZWNvcmQgc2V0ICovCgkJCQlzT3V0ID0gb0xhbmcuc0luZm9FbXB0eTsKCQkJfQoJCQllbHNlIHsKCQkJCS8qIE5vcm1hbCByZWNvcmQgc2V0ICovCgkJCQlzT3V0ID0gb0xhbmcuc0luZm87CgkJCX0KCQkKCQkJaWYgKCBpVG90YWwgIT0gaU1heCApCgkJCXsKCQkJCS8qIFJlY29yZCBzZXQgYWZ0ZXIgZmlsdGVyaW5nICovCgkJCQlzT3V0ICs9ICcgJyArIG9MYW5nLnNJbmZvRmlsdGVyZWQ7CgkJCX0KCQkKCQkJLy8gQ29udmVydCB0aGUgbWFjcm9zCgkJCXNPdXQgKz0gb0xhbmcuc0luZm9Qb3N0Rml4OwoJCQlzT3V0ID0gX2ZuSW5mb01hY3Jvcyggb1NldHRpbmdzLCBzT3V0ICk7CgkJCQoJCQlpZiAoIG9MYW5nLmZuSW5mb0NhbGxiYWNrICE9PSBudWxsICkKCQkJewoJCQkJc091dCA9IG9MYW5nLmZuSW5mb0NhbGxiYWNrLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIAoJCQkJCW9TZXR0aW5ncywgaVN0YXJ0LCBpRW5kLCBpTWF4LCBpVG90YWwsIHNPdXQgKTsKCQkJfQoJCQkKCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuaTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCSQobltpXSkuaHRtbCggc091dCApOwoJCQl9CgkJfQoJCQoJCQoJCWZ1bmN0aW9uIF9mbkluZm9NYWNyb3MgKCBvU2V0dGluZ3MsIHN0ciApCgkJewoJCQl2YXIKCQkJCWlTdGFydCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCsxLAoJCQkJc1N0YXJ0ID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpU3RhcnQgKSwKCQkJCWlFbmQgPSBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksCgkJCQlzRW5kID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpRW5kICksCgkJCQlpVG90YWwgPSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpLAoJCQkJc1RvdGFsID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpVG90YWwgKSwKCQkJCWlNYXggPSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSwKCQkJCXNNYXggPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlNYXggKTsKCQkKCQkJLy8gV2hlbiBpbmZpbml0ZSBzY3JvbGxpbmcsIHdlIGFyZSBhbHdheXMgc3RhcnRpbmcgYXQgMS4gX2lEaXNwbGF5U3RhcnQgaXMgdXNlZCBvbmx5CgkJCS8vIGludGVybmFsbHkKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQlzU3RhcnQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIDEgKTsKCQkJfQoJCQoJCQlyZXR1cm4gc3RyLgoJCQkJcmVwbGFjZSgvX1NUQVJUXy9nLCBzU3RhcnQpLgoJCQkJcmVwbGFjZSgvX0VORF8vZywgICBzRW5kKS4KCQkJCXJlcGxhY2UoL19UT1RBTF8vZywgc1RvdGFsKS4KCQkJCXJlcGxhY2UoL19NQVhfL2csICAgc01heCk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRpYWxpc2UgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGlBamF4U3RhcnQ9b1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkKCQkJLyogRW5zdXJlIHRoYXQgdGhlIHRhYmxlIGRhdGEgaXMgZnVsbHkgaW5pdGlhbGlzZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkluaXRpYWxpc2VkID09PSBmYWxzZSApCgkJCXsKCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7IF9mbkluaXRpYWxpc2UoIG9TZXR0aW5ncyApOyB9LCAyMDAgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgZGlzcGxheSBIVE1MIG9wdGlvbnMgKi8KCQkJX2ZuQWRkT3B0aW9uc0h0bWwoIG9TZXR0aW5ncyApOwoJCQkKCQkJLyogQnVpbGQgYW5kIGRyYXcgdGhlIGhlYWRlciAvIGZvb3RlciBmb3IgdGhlIHRhYmxlICovCgkJCV9mbkJ1aWxkSGVhZCggb1NldHRpbmdzICk7CgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQoJCQkvKiBPa2F5IHRvIHNob3cgdGhhdCBzb21ldGhpbmcgaXMgZ29pbmcgb24gbm93ICovCgkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCgkJCS8qIENhbGN1bGF0ZSBzaXplcyBmb3IgY29sdW1ucyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggIT09IG51bGwgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIElmIHRoZXJlIGlzIGRlZmF1bHQgc29ydGluZyByZXF1aXJlZCAtIGxldCdzIGRvIGl0LiBUaGUgc29ydCBmdW5jdGlvbiB3aWxsIGRvIHRoZQoJCQkgKiBkcmF3aW5nIGZvciB1cy4gT3RoZXJ3aXNlIHdlIGRyYXcgdGhlIHRhYmxlIHJlZ2FyZGxlc3Mgb2YgdGhlIEFqYXggc291cmNlIC0gdGhpcyBhbGxvd3MKCQkJICogdGhlIHRhYmxlIHRvIGxvb2sgaW5pdGlhbGlzZWQgZm9yIEFqYXggc291cmNpbmcgZGF0YSAoc2hvdyAnbG9hZGluZycgbWVzc2FnZSBwb3NzaWJseSkKCQkJICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBpZiB0aGVyZSBpcyBhbiBhamF4IHNvdXJjZSBsb2FkIHRoZSBkYXRhICovCgkJCWlmICggb1NldHRpbmdzLnNBamF4U291cmNlICE9PSBudWxsICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJdmFyIGFvRGF0YSA9IFtdOwoJCQkJX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApOwoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwgZnVuY3Rpb24oanNvbikgewoJCQkJCXZhciBhRGF0YSA9IChvU2V0dGluZ3Muc0FqYXhEYXRhUHJvcCAhPT0gIiIpID8KCQkJCQkgCV9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKShqc29uKSA6IGpzb247CgkJCgkJCQkJLyogR290IHRoZSBkYXRhIC0gYWRkIGl0IHRvIHRoZSB0YWJsZSAqLwoJCQkJCWZvciAoIGk9MCA7IGk8YURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCV9mbkFkZERhdGEoIG9TZXR0aW5ncywgYURhdGFbaV0gKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogUmVzZXQgdGhlIGluaXQgZGlzcGxheSBmb3IgY29va2llIHNhdmluZy4gV2UndmUgYWxyZWFkeSBkb25lIGEgZmlsdGVyLCBhbmQKCQkJCQkgKiB0aGVyZWZvcmUgY2xlYXJlZCBpdCBiZWZvcmUuIFNvIHdlIG5lZWQgdG8gbWFrZSBpdCBhcHBlYXIgJ2ZyZXNoJwoJCQkJCSAqLwoJCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IGlBamF4U3RhcnQ7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJCQl7CgkJCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncywganNvbiApOwoJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgaW5pdGlhbGlzYXRpb24gY29tcGxldGUgaXMgZG9uZSBhdCB0aGUgZW5kIG9mIF9mbkRyYXcgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBbanNvbl0gSlNPTiBmcm9tIHRoZSBzZXJ2ZXIgdGhhdCBjb21wbGV0ZWQgdGhlIHRhYmxlLCBpZiB1c2luZyBBamF4IHNvdXJjZQoJCSAqICAgIHdpdGggY2xpZW50LXNpZGUgcHJvY2Vzc2luZyAob3B0aW9uYWwpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRDb21wbGV0ZSAoIG9TZXR0aW5ncywganNvbiApCgkJewoJCQlvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgPSB0cnVlOwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvSW5pdENvbXBsZXRlJywgJ2luaXQnLCBbb1NldHRpbmdzLCBqc29uXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBjb21wYXRpYmlsaXR5IC0gd2hlbiBjZXJ0YWluIG9wdGlvbnMgYXJlIGdpdmVuLCBhbmQgb3RoZXJzIGFyZW4ndCwgd2UKCQkgKiBuZWVkIHRvIGR1cGxpY2F0ZSB0aGUgdmFsdWVzIG92ZXIsIGluIG9yZGVyIHRvIHByb3ZpZGUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCQkgKiB3aXRoIG9sZGVyIGxhbmd1YWdlIGZpbGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxhbmd1YWdlQ29tcGF0KCBvTGFuZ3VhZ2UgKQoJCXsKCQkJdmFyIG9EZWZhdWx0cyA9IERhdGFUYWJsZS5kZWZhdWx0cy5vTGFuZ3VhZ2U7CgkJCgkJCS8qIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IC0gaWYgdGhlcmUgaXMgbm8gc0VtcHR5VGFibGUgZ2l2ZW4sIHRoZW4gdXNlIHRoZSBzYW1lIGFzCgkJCSAqIHNaZXJvUmVjb3JkcyAtIGFzc3VtaW5nIHRoYXQgaXMgZ2l2ZW4uCgkJCSAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0VtcHR5VGFibGUgJiYgb0xhbmd1YWdlLnNaZXJvUmVjb3JkcyAmJgoJCQkJb0RlZmF1bHRzLnNFbXB0eVRhYmxlID09PSAiTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGUiICkKCQkJewoJCQkJX2ZuTWFwKCBvTGFuZ3VhZ2UsIG9MYW5ndWFnZSwgJ3NaZXJvUmVjb3JkcycsICdzRW1wdHlUYWJsZScgKTsKCQkJfQoJCQoJCQkvKiBMaWtld2lzZSB3aXRoIGxvYWRpbmcgcmVjb3JkcyAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0xvYWRpbmdSZWNvcmRzICYmIG9MYW5ndWFnZS5zWmVyb1JlY29yZHMgJiYKCQkJCW9EZWZhdWx0cy5zTG9hZGluZ1JlY29yZHMgPT09ICJMb2FkaW5nLi4uIiApCgkJCXsKCQkJCV9mbk1hcCggb0xhbmd1YWdlLCBvTGFuZ3VhZ2UsICdzWmVyb1JlY29yZHMnLCAnc0xvYWRpbmdSZWNvcmRzJyApOwoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciB1c2VyIGRpc3BsYXkgbGVuZ3RoIGNoYW5naW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge25vZGV9IERpc3BsYXkgbGVuZ3RoIGZlYXR1cmUgbm9kZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbExlbmd0aCAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQkvKiBUaGlzIGNhbiBiZSBvdmVycnVsZWQgYnkgbm90IHVzaW5nIHRoZSBfTUVOVV8gdmFyL21hY3JvIGluIHRoZSBsYW5ndWFnZSB2YXJpYWJsZSAqLwoJCQl2YXIgc05hbWUgPSAnbmFtZT0iJytvU2V0dGluZ3Muc1RhYmxlSWQrJ19sZW5ndGgiJzsKCQkJdmFyIHNTdGRNZW51ID0gJzxzZWxlY3Qgc2l6ZT0iMSIgJytzTmFtZSsnPic7CgkJCXZhciBpLCBpTGVuOwoJCQl2YXIgYUxlbmd0aE1lbnUgPSBvU2V0dGluZ3MuYUxlbmd0aE1lbnU7CgkJCQoJCQlpZiAoIGFMZW5ndGhNZW51Lmxlbmd0aCA9PSAyICYmIHR5cGVvZiBhTGVuZ3RoTWVudVswXSA9PT0gJ29iamVjdCcgJiYgCgkJCQkJdHlwZW9mIGFMZW5ndGhNZW51WzFdID09PSAnb2JqZWN0JyApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hTGVuZ3RoTWVudVswXS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXNTdGRNZW51ICs9ICc8b3B0aW9uIHZhbHVlPSInK2FMZW5ndGhNZW51WzBdW2ldKyciPicrYUxlbmd0aE1lbnVbMV1baV0rJzwvb3B0aW9uPic7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YUxlbmd0aE1lbnUubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlzU3RkTWVudSArPSAnPG9wdGlvbiB2YWx1ZT0iJythTGVuZ3RoTWVudVtpXSsnIj4nK2FMZW5ndGhNZW51W2ldKyc8L29wdGlvbj4nOwoJCQkJfQoJCQl9CgkJCXNTdGRNZW51ICs9ICc8L3NlbGVjdD4nOwoJCQkKCQkJdmFyIG5MZW5ndGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMubCApCgkJCXsKCQkJCW5MZW5ndGguaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19sZW5ndGgnOwoJCQl9CgkJCW5MZW5ndGguY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNMZW5ndGg7CgkJCW5MZW5ndGguaW5uZXJIVE1MID0gJzxsYWJlbD4nK29TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0xlbmd0aE1lbnUucmVwbGFjZSggJ19NRU5VXycsIHNTdGRNZW51ICkrJzwvbGFiZWw+JzsKCQkJCgkJCS8qCgkJCSAqIFNldCB0aGUgbGVuZ3RoIHRvIHRoZSBjdXJyZW50IGRpc3BsYXkgbGVuZ3RoIC0gdGhhbmtzIHRvIEFuZHJlYSBQYXZsb3ZpYyBmb3IgdGhpcyBmaXgsCgkJCSAqIGFuZCBTdGVmYW4gU2tvcG5payBmb3IgZml4aW5nIHRoZSBmaXghCgkJCSAqLwoJCQkkKCdzZWxlY3Qgb3B0aW9uW3ZhbHVlPSInK29TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgrJyJdJywgbkxlbmd0aCkuYXR0cigic2VsZWN0ZWQiLCB0cnVlKTsKCQkJCgkJCSQoJ3NlbGVjdCcsIG5MZW5ndGgpLmJpbmQoICdjaGFuZ2UuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQl2YXIgaVZhbCA9ICQodGhpcykudmFsKCk7CgkJCQkKCQkJCS8qIFVwZGF0ZSBhbGwgb3RoZXIgbGVuZ3RoIG9wdGlvbnMgZm9yIHRoZSBuZXcgZGlzcGxheSAqLwoJCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMubDsKCQkJCWZvciAoIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBuW2ldICE9IHRoaXMucGFyZW50Tm9kZSApCgkJCQkJewoJCQkJCQkkKCdzZWxlY3QnLCBuW2ldKS52YWwoIGlWYWwgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIFJlZHJhdyB0aGUgdGFibGUgKi8KCQkJCW9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPSBwYXJzZUludChpVmFsLCAxMCk7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCgkJCQkvKiBJZiB3ZSBoYXZlIHNwYWNlIHRvIHNob3cgZXh0cmEgcm93cyAoYmFja2luZyB1cCBmcm9tIHRoZSBlbmQgcG9pbnQgLSB0aGVuIGRvIHNvICovCgkJCQlpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQkJCgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfSApOwoJCQoJCQoJCQkkKCdzZWxlY3QnLCBuTGVuZ3RoKS5hdHRyKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCgkJCXJldHVybiBuTGVuZ3RoOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWNhbGN1bGF0ZSB0aGUgZW5kIHBvaW50IGJhc2VkIG9uIHRoZSBzdGFydCBwb2ludAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2V0IHRoZSBlbmQgcG9pbnQgb2YgdGhlIGRpc3BsYXkgLSBiYXNlZCBvbiBob3cgbWFueSBlbGVtZW50cyB0aGVyZSBhcmUKCQkJCSAqIHN0aWxsIHRvIGRpc3BsYXkKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID4gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggfHwKCQkJCQkgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kID0gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCArIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCQkgKiBOb3RlIHRoYXQgbW9zdCBvZiB0aGUgcGFnaW5nIGxvZ2ljIGlzIGRvbmUgaW4gCgkJICogRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciBkZWZhdWx0IHBhZ2luYXRpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUGFnaW5hdGlvbiBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgblBhZ2luYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJblBhZ2luYXRlLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnaW5nK29TZXR0aW5ncy5zUGFnaW5hdGlvblR5cGU7CgkJCQoJCQlEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uWyBvU2V0dGluZ3Muc1BhZ2luYXRpb25UeXBlIF0uZm5Jbml0KCBvU2V0dGluZ3MsIG5QYWdpbmF0ZSwgCgkJCQlmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQl9CgkJCSk7CgkJCQoJCQkvKiBBZGQgYSBkcmF3IGNhbGxiYWNrIGZvciB0aGUgcGFnaW5hdGlvbiBvbiBmaXJzdCBpbnN0YW5jZSwgdG8gdXBkYXRlIHRoZSBwYWdpbmcgZGlzcGxheSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkJCQkJRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvblsgb1NldHRpbmdzLnNQYWdpbmF0aW9uVHlwZSBdLmZuVXBkYXRlKCBvU2V0dGluZ3MsIGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCX0gKTsKCQkJCQl9LAoJCQkJCSJzTmFtZSI6ICJwYWdpbmF0aW9uIgoJCQkJfSApOwoJCQl9CgkJCXJldHVybiBuUGFnaW5hdGU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFsdGVyIHRoZSBkaXNwbGF5IHNldHRpbmdzIHRvIGNoYW5nZSB0aGUgcGFnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKQoJCSAqICBAcmV0dXJucyB7Ym9vbH0gdHJ1ZSBwYWdlIGhhcyBjaGFuZ2VkLCBmYWxzZSAtIG5vIGNoYW5nZSAobm8gZWZmZWN0KSBlZyAnZmlyc3QnIG9uIHBhZ2UgMQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5QYWdlQ2hhbmdlICggb1NldHRpbmdzLCBtQWN0aW9uICkKCQl7CgkJCXZhciBpT2xkU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQoJCQlpZiAoIHR5cGVvZiBtQWN0aW9uID09PSAibnVtYmVyIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG1BY3Rpb24gKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPiBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJmaXJzdCIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJwcmV2aW91cyIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoPj0wID8KCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDoKCQkJCQkwOwoJCQkJCgkJCQkvKiBDb3JyZWN0IGZvciB1bmRlci1ydW4gKi8KCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQl7CgkJCQkgIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG1BY3Rpb24gPT0gIm5leHQiICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID49IDAgKQoJCQkJewoJCQkJCS8qIE1ha2Ugc3VyZSB3ZSBhcmUgbm90IG92ZXIgcnVubmluZyB0aGUgZGlzcGxheSBhcnJheSAqLwoJCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICsgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA8IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICs9IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG1BY3Rpb24gPT0gImxhc3QiICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID49IDAgKQoJCQkJewoJCQkJCXZhciBpUGFnZXMgPSBwYXJzZUludCggKG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCktMSkgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoLCAxMCApICsgMTsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAoaVBhZ2VzLTEpICogb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDAsICJVbmtub3duIHBhZ2luZyBhY3Rpb246ICIrbUFjdGlvbiApOwoJCQl9CgkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigncGFnZScsIG9TZXR0aW5ncyk7CgkJCQoJCQlyZXR1cm4gaU9sZFN0YXJ0ICE9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydDsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIHRoZSBwcm9jZXNzaW5nIG5vZGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUHJvY2Vzc2luZyBlbGVtZW50CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgblByb2Nlc3NpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnIgKQoJCQl7CgkJCQluUHJvY2Vzc2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3Byb2Nlc3NpbmcnOwoJCQl9CgkJCW5Qcm9jZXNzaW5nLmlubmVySFRNTCA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1Byb2Nlc3Npbmc7CgkJCW5Qcm9jZXNzaW5nLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUHJvY2Vzc2luZzsKCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggblByb2Nlc3NpbmcsIG9TZXR0aW5ncy5uVGFibGUgKTsKCQkJCgkJCXJldHVybiBuUHJvY2Vzc2luZzsKCQl9CgkJCgkJCgkJLyoqCgkJICogRGlzcGxheSBvciBoaWRlIHRoZSBwcm9jZXNzaW5nIGluZGljYXRvcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNob3cgU2hvdyB0aGUgcHJvY2Vzc2luZyBpbmRpY2F0b3IgKHRydWUpIG9yIG5vdCAoZmFsc2UpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblByb2Nlc3NpbmdEaXNwbGF5ICggb1NldHRpbmdzLCBiU2hvdyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlByb2Nlc3NpbmcgKQoJCQl7CgkJCQl2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucjsKCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhbltpXS5zdHlsZS52aXNpYmlsaXR5ID0gYlNob3cgPyAidmlzaWJsZSIgOiAiaGlkZGVuIjsKCQkJCX0KCQkJfQoJCQoJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoJ3Byb2Nlc3NpbmcnLCBbb1NldHRpbmdzLCBiU2hvd10pOwoJCX0KCQkKCQkvKioKCQkgKiBBZGQgYW55IGNvbnRyb2wgZWxlbWVudHMgZm9yIHRoZSB0YWJsZSAtIHNwZWNpZmljYWxseSBzY3JvbGxpbmcKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gTm9kZSB0byBhZGQgdG8gdGhlIERPTQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbFRhYmxlICggb1NldHRpbmdzICkKCQl7CgkJCS8qIENoZWNrIGlmIHNjcm9sbGluZyBpcyBlbmFibGVkIG9yIG5vdCAtIGlmIG5vdCB0aGVuIGxlYXZlIHRoZSBET00gdW5hbHRlcmVkICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZID09PSAiIiApCgkJCXsKCQkJCXJldHVybiBvU2V0dGluZ3MublRhYmxlOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBUaGUgSFRNTCBzdHJ1Y3R1cmUgdGhhdCB3ZSB3YW50IHRvIGdlbmVyYXRlIGluIHRoaXMgZnVuY3Rpb24gaXM6CgkJCSAqICBkaXYgLSBuU2Nyb2xsZXIKCQkJICogICAgZGl2IC0gblNjcm9sbEhlYWQKCQkJICogICAgICBkaXYgLSBuU2Nyb2xsSGVhZElubmVyCgkJCSAqICAgICAgICB0YWJsZSAtIG5TY3JvbGxIZWFkVGFibGUKCQkJICogICAgICAgICAgdGhlYWQgLSBuVGhlYWQKCQkJICogICAgZGl2IC0gblNjcm9sbEJvZHkKCQkJICogICAgICB0YWJsZSAtIG9TZXR0aW5ncy5uVGFibGUKCQkJICogICAgICAgIHRoZWFkIC0gblRoZWFkU2l6ZQoJCQkgKiAgICAgICAgdGJvZHkgLSBuVGJvZHkKCQkJICogICAgZGl2IC0gblNjcm9sbEZvb3QKCQkJICogICAgICBkaXYgLSBuU2Nyb2xsRm9vdElubmVyCgkJCSAqICAgICAgICB0YWJsZSAtIG5TY3JvbGxGb290VGFibGUKCQkJICogICAgICAgICAgdGZvb3QgLSBuVGZvb3QKCQkJICovCgkJCXZhcgoJCQkgCW5TY3JvbGxlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxIZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWRJbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxCb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEZvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsRm9vdElubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWRUYWJsZSA9IG9TZXR0aW5ncy5uVGFibGUuY2xvbmVOb2RlKGZhbHNlKSwKCQkJIAluU2Nyb2xsRm9vdFRhYmxlID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoZmFsc2UpLAoJCQkJblRoZWFkID0gb1NldHRpbmdzLm5UYWJsZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGhlYWQnKVswXSwKCQkJIAluVGZvb3QgPSBvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Zm9vdCcpLmxlbmd0aCA9PT0gMCA/IG51bGwgOiAKCQkJCQlvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Zm9vdCcpWzBdLAoJCQkJb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQoJCQluU2Nyb2xsSGVhZC5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWRJbm5lciApOwoJCQluU2Nyb2xsRm9vdC5hcHBlbmRDaGlsZCggblNjcm9sbEZvb3RJbm5lciApOwoJCQluU2Nyb2xsQm9keS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQluU2Nyb2xsZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxIZWFkICk7CgkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEJvZHkgKTsKCQkJblNjcm9sbEhlYWRJbm5lci5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWRUYWJsZSApOwoJCQluU2Nyb2xsSGVhZFRhYmxlLmFwcGVuZENoaWxkKCBuVGhlYWQgKTsKCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQluU2Nyb2xsZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxGb290ICk7CgkJCQluU2Nyb2xsRm9vdElubmVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsRm9vdFRhYmxlICk7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLmFwcGVuZENoaWxkKCBuVGZvb3QgKTsKCQkJfQoJCQkKCQkJblNjcm9sbGVyLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxXcmFwcGVyOwoJCQluU2Nyb2xsSGVhZC5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsSGVhZDsKCQkJblNjcm9sbEhlYWRJbm5lci5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsSGVhZElubmVyOwoJCQluU2Nyb2xsQm9keS5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsQm9keTsKCQkJblNjcm9sbEZvb3QuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbEZvb3Q7CgkJCW5TY3JvbGxGb290SW5uZXIuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbEZvb3RJbm5lcjsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuYkF1dG9Dc3MgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQkJblNjcm9sbEhlYWQuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwoJCQkJblNjcm9sbEZvb3Quc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLm92ZXJmbG93ID0gImF1dG8iOwoJCQl9CgkJCQoJCQluU2Nyb2xsSGVhZC5zdHlsZS5ib3JkZXIgPSAiMCI7CgkJCW5TY3JvbGxIZWFkLnN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQluU2Nyb2xsRm9vdC5zdHlsZS5ib3JkZXIgPSAiMCI7CgkJCW5TY3JvbGxIZWFkSW5uZXIuc3R5bGUud2lkdGggPSBvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyICE9PSAiIiA/CgkJCQlvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyIDogIjEwMCUiOyAvKiB3aWxsIGJlIG92ZXJ3cml0dGVuICovCgkJCQoJCQkvKiBNb2RpZnkgYXR0cmlidXRlcyB0byByZXNwZWN0IHRoZSBjbG9uZXMgKi8KCQkJblNjcm9sbEhlYWRUYWJsZS5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7CgkJCW5TY3JvbGxIZWFkVGFibGUuc3R5bGUubWFyZ2luTGVmdCA9ICIwIjsKCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5TY3JvbGxGb290VGFibGUucmVtb3ZlQXR0cmlidXRlKCdpZCcpOwoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQl9CgkJCQoJCQkvKiBNb3ZlIGNhcHRpb24gZWxlbWVudHMgZnJvbSB0aGUgYm9keSB0byB0aGUgaGVhZGVyLCBmb290ZXIgb3IgbGVhdmUgd2hlcmUgaXQgaXMKCQkJICogZGVwZW5kaW5nIG9uIHRoZSBjb25maWd1cmF0aW9uLiBOb3RlIHRoYXQgdGhlIERURCBzYXlzIHRoZXJlIGNhbiBiZSBvbmx5IG9uZSBjYXB0aW9uICovCgkJCXZhciBuQ2FwdGlvbiA9ICQob1NldHRpbmdzLm5UYWJsZSkuY2hpbGRyZW4oJ2NhcHRpb24nKTsKCQkJaWYgKCBuQ2FwdGlvbi5sZW5ndGggPiAwICkKCQkJewoJCQkJbkNhcHRpb24gPSBuQ2FwdGlvblswXTsKCQkJCWlmICggbkNhcHRpb24uX2NhcHRpb25TaWRlID09PSAidG9wIiApCgkJCQl7CgkJCQkJblNjcm9sbEhlYWRUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb24gKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBuQ2FwdGlvbi5fY2FwdGlvblNpZGUgPT09ICJib3R0b20iICYmIG5UZm9vdCApCgkJCQl7CgkJCQkJblNjcm9sbEZvb3RUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb24gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyoKCQkJICogU2l6aW5nCgkJCSAqLwoJCQkvKiBXaGVuIHgtc2Nyb2xsaW5nIGFkZCB0aGUgd2lkdGggYW5kIGEgc2Nyb2xsZXIgdG8gbW92ZSB0aGUgaGVhZGVyIHdpdGggdGhlIGJvZHkgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCApOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb1NldHRpbmdzLm9TY3JvbGwuc1ggKTsKCQkJCQoJCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICk7CQoJCQkJfQoJCQkJCgkJCQkvKiBXaGVuIHRoZSBib2R5IGlzIHNjcm9sbGVkLCB0aGVuIHdlIGFsc28gd2FudCB0byBzY3JvbGwgdGhlIGhlYWRlcnMgKi8KCQkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCggZnVuY3Rpb24gKGUpIHsKCQkJCQluU2Nyb2xsSGVhZC5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0OwoJCQkJCQoJCQkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW5TY3JvbGxGb290LnNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBXaGVuIHlzY3JvbGxpbmcsIGFkZCB0aGUgaGVpZ2h0ICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICk7CgkJCX0KCQkJCgkJCS8qIFJlZHJhdyAtIGFsaWduIGNvbHVtbnMgYWNyb3NzIHRoZSB0YWJsZXMgKi8KCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCSJmbiI6IF9mblNjcm9sbERyYXcsCgkJCQkic05hbWUiOiAic2Nyb2xsaW5nIgoJCQl9ICk7CgkJCQoJCQkvKiBJbmZpbml0ZSBzY3JvbGxpbmcgZXZlbnQgaGFuZGxlcnMgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoIGZ1bmN0aW9uKCkgewoJCQkJCS8qIFVzZSBhIGJsb2NrZXIgdG8gc3RvcCBzY3JvbGxpbmcgZnJvbSBsb2FkaW5nIG1vcmUgZGF0YSB3aGlsZSBvdGhlciBkYXRhIGlzIHN0aWxsIGxvYWRpbmcgKi8KCQkJCQlpZiAoICFvU2V0dGluZ3MuYkRyYXdpbmcgJiYgJCh0aGlzKS5zY3JvbGxUb3AoKSAhPT0gMCApCgkJCQkJewoJCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgbG9hZCB0aGUgbmV4dCBkYXRhIHNldCAqLwoJCQkJCQlpZiAoICQodGhpcykuc2Nyb2xsVG9wKCkgKyAkKHRoaXMpLmhlaWdodCgpID4gCgkJCQkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmhlaWdodCgpIC0gb1NldHRpbmdzLm9TY3JvbGwuaUxvYWRHYXAgKQoJCQkJCQl7CgkJCQkJCQkvKiBPbmx5IGRvIHRoZSByZWRyYXcgaWYgd2UgaGF2ZSB0byAtIHdlIG1pZ2h0IGJlIGF0IHRoZSBlbmQgb2YgdGhlIGRhdGEgKi8KCQkJCQkJCWlmICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAnbmV4dCcgKTsKCQkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MublNjcm9sbEhlYWQgPSBuU2Nyb2xsSGVhZDsKCQkJb1NldHRpbmdzLm5TY3JvbGxGb290ID0gblNjcm9sbEZvb3Q7CgkJCQoJCQlyZXR1cm4gblNjcm9sbGVyOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgdGhlIHZhcmlvdXMgdGFibGVzIGZvciByZXNpemluZy4gSXQncyBhIGJpdCBvZiBhIHBpZyB0aGlzIGZ1bmN0aW9uLCBidXQKCQkgKiBiYXNpY2FsbHkgdGhlIGlkZWEgdG86CgkJICogICAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCSAqICAgMi4gVGFrZSBsaXZlIG1lYXN1cmVtZW50cyBmcm9tIHRoZSBET00KCQkgKiAgIDMuIEFwcGx5IHRoZSBtZWFzdXJlbWVudHMKCQkgKiAgIDQuIENsZWFuIHVwCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbERyYXcgKCBvICkKCQl7CgkJCXZhcgoJCQkJblNjcm9sbEhlYWRJbm5lciA9IG8ublNjcm9sbEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdLAoJCQkJblNjcm9sbEhlYWRUYWJsZSA9IG5TY3JvbGxIZWFkSW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0sCgkJCQluU2Nyb2xsQm9keSA9IG8ublRhYmxlLnBhcmVudE5vZGUsCgkJCQlpLCBpTGVuLCBqLCBqTGVuLCBhbkhlYWRUb1NpemUsIGFuSGVhZFNpemVycywgYW5Gb290U2l6ZXJzLCBhbkZvb3RUb1NpemUsIG9TdHlsZSwgaVZpcywKCQkJCW5UaGVhZFNpemUsIG5UZm9vdFNpemUsCgkJCQlpV2lkdGgsIGFBcHBsaWVkPVtdLCBhQXBwbGllZEZvb3Rlcj1bXSwgaVNhbml0eVdpZHRoLAoJCQkJblNjcm9sbEZvb3RJbm5lciA9IChvLm5URm9vdCAhPT0gbnVsbCkgPyBvLm5TY3JvbGxGb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKVswXSA6IG51bGwsCgkJCQluU2Nyb2xsRm9vdFRhYmxlID0gKG8ublRGb290ICE9PSBudWxsKSA/IG5TY3JvbGxGb290SW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0gOiBudWxsLAoJCQkJaWU2NyA9IG8ub0Jyb3dzZXIuYlNjcm9sbE92ZXJzaXplLAoJCQkJemVyb091dCA9IGZ1bmN0aW9uKG5TaXplcikgewoJCQkJCW9TdHlsZSA9IG5TaXplci5zdHlsZTsKCQkJCQlvU3R5bGUucGFkZGluZ1RvcCA9ICIwIjsKCQkJCQlvU3R5bGUucGFkZGluZ0JvdHRvbSA9ICIwIjsKCQkJCQlvU3R5bGUuYm9yZGVyVG9wV2lkdGggPSAiMCI7CgkJCQkJb1N0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gIjAiOwoJCQkJCW9TdHlsZS5oZWlnaHQgPSAwOwoJCQkJfTsKCQkJCgkJCS8qCgkJCSAqIDEuIFJlLWNyZWF0ZSB0aGUgdGFibGUgaW5zaWRlIHRoZSBzY3JvbGxpbmcgZGl2CgkJCSAqLwoJCQkKCQkJLyogUmVtb3ZlIHRoZSBvbGQgbWluaW1pc2VkIHRoZWFkIGFuZCB0Zm9vdCBlbGVtZW50cyBpbiB0aGUgaW5uZXIgdGFibGUgKi8KCQkJJChvLm5UYWJsZSkuY2hpbGRyZW4oJ3RoZWFkLCB0Zm9vdCcpLnJlbW92ZSgpOwoJCQoJCQkvKiBDbG9uZSB0aGUgY3VycmVudCBoZWFkZXIgYW5kIGZvb3RlciBlbGVtZW50cyBhbmQgdGhlbiBwbGFjZSBpdCBpbnRvIHRoZSBpbm5lciB0YWJsZSAqLwoJCQluVGhlYWRTaXplID0gJChvLm5USGVhZCkuY2xvbmUoKVswXTsKCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGhlYWRTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzBdICk7CgkJCWFuSGVhZFRvU2l6ZSA9IG8ublRIZWFkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQlhbkhlYWRTaXplcnMgPSBuVGhlYWRTaXplLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5UZm9vdFNpemUgPSAkKG8ublRGb290KS5jbG9uZSgpWzBdOwoJCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGZvb3RTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzFdICk7CgkJCQlhbkZvb3RUb1NpemUgPSBvLm5URm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJCWFuRm9vdFNpemVycyA9IG5UZm9vdFNpemUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIDIuIFRha2UgbGl2ZSBtZWFzdXJlbWVudHMgZnJvbSB0aGUgRE9NIC0gZG8gbm90IGFsdGVyIHRoZSBET00gaXRzZWxmIQoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSBvbGQgc2l6aW5nIGFuZCBhcHBseSB0aGUgY2FsY3VsYXRlZCBjb2x1bW4gd2lkdGhzCgkJCSAqIEdldCB0aGUgdW5pcXVlIGNvbHVtbiBoZWFkZXJzIGluIHRoZSBuZXdseSBjcmVhdGVkIChjbG9uZWQpIGhlYWRlci4gV2Ugd2FudCB0byBhcHBseSB0aGUKCQkJICogY2FsY3VsYXRlZCBzaXplcyB0byB0aGlzIGhlYWRlcgoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCX0KCQkJCgkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvLCBuVGhlYWRTaXplICk7CgkJCWZvciAoIGk9MCwgaUxlbj1uVGhzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlWaXMgPSBfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCggbywgaSApOwoJCQkJblRoc1tpXS5zdHlsZS53aWR0aCA9IG8uYW9Db2x1bW5zW2lWaXNdLnNXaWR0aDsKCQkJfQoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24obikgewoJCQkJCW4uc3R5bGUud2lkdGggPSAiIjsKCQkJCX0sIGFuRm9vdFNpemVycyApOwoJCQl9CgkJCgkJCS8vIElmIHNjcm9sbCBjb2xsYXBzZSBpcyBlbmFibGVkLCB3aGVuIHdlIHB1dCB0aGUgaGVhZGVycyBiYWNrIGludG8gdGhlIGJvZHkgZm9yIHNpemluZywgd2UKCQkJLy8gd2lsbCBlbmQgdXAgZm9yY2luZyB0aGUgc2Nyb2xsYmFyIHRvIGFwcGVhciwgbWFraW5nIG91ciBtZWFzdXJlbWVudHMgd3JvbmcgZm9yIHdoZW4gd2UKCQkJLy8gdGhlbiBoaWRlIGl0IChlbmQgb2YgdGhpcyBmdW5jdGlvbiksIHNvIGFkZCB0aGUgaGVhZGVyIGhlaWdodCB0byB0aGUgYm9keSBzY3JvbGxlci4KCQkJaWYgKCBvLm9TY3JvbGwuYkNvbGxhcHNlICYmIG8ub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSAoblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0ICsgby5uVEhlYWQub2Zmc2V0SGVpZ2h0KSsicHgiOwoJCQl9CgkJCQoJCQkvKiBTaXplIHRoZSB0YWJsZSBhcyBhIHdob2xlICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJLyogTm8geCBzY3JvbGxpbmcgKi8KCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQkJCgkJCQkvKiBJIGtub3cgdGhpcyBpcyBydWJiaXNoIC0gYnV0IElFNyB3aWxsIG1ha2UgdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSB3aGVuIDEwMCUgaW5jbHVkZQoJCQkJICogdGhlIHNjcm9sbGJhciAtIHdoaWNoIGlzIHNob3VsZG4ndC4gV2hlbiB0aGVyZSBpcyBhIHNjcm9sbGJhciB3ZSBuZWVkIHRvIHRha2UgdGhpcwoJCQkJICogaW50byBhY2NvdW50LgoJCQkJICovCgkJCQlpZiAoIGllNjcgJiYgKCQoJ3Rib2R5JywgblNjcm9sbEJvZHkpLmhlaWdodCgpID4gblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8IAoJCQkJCSQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSAtIG8ub1Njcm9sbC5pQmFyV2lkdGgpOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaWYgKCBvLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCS8qIHggc2Nyb2xsIGlubmVyIGhhcyBiZWVuIGdpdmVuIC0gdXNlIGl0ICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvLm9TY3JvbGwuc1hJbm5lcik7CgkJCQl9CgkJCQllbHNlIGlmICggaVNhbml0eVdpZHRoID09ICQoblNjcm9sbEJvZHkpLndpZHRoKCkgJiYKCQkJCSAgICQoblNjcm9sbEJvZHkpLmhlaWdodCgpIDwgJChvLm5UYWJsZSkuaGVpZ2h0KCkgKQoJCQkJewoJCQkJCS8qIFRoZXJlIGlzIHktc2Nyb2xsaW5nIC0gdHJ5IHRvIHRha2UgYWNjb3VudCBvZiB0aGUgeSBzY3JvbGwgYmFyICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCQlpZiAoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSA+IGlTYW5pdHlXaWR0aC1vLm9TY3JvbGwuaUJhcldpZHRoICkKCQkJCQl7CgkJCQkJCS8qIE5vdCBwb3NzaWJsZSB0byB0YWtlIGFjY291bnQgb2YgaXQgKi8KCQkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIEFsbCBlbHNlIGZhaWxzICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlY2FsY3VsYXRlIHRoZSBzYW5pdHkgd2lkdGggLSBub3cgdGhhdCB3ZSd2ZSBhcHBsaWVkIHRoZSByZXF1aXJlZCB3aWR0aCwgYmVmb3JlIGl0IHdhcwoJCQkgKiBhIHRlbXBvcmFyeSB2YXJpYWJsZS4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIHRoZSBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaXMgZG9uZQoJCQkgKiBiZWZvcmUgdGhpcyB0YWJsZSBET00gaXMgY3JlYXRlZC4KCQkJICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJCgkJCS8qIFdlIHdhbnQgdGhlIGhpZGRlbiBoZWFkZXIgdG8gaGF2ZSB6ZXJvIGhlaWdodCwgc28gcmVtb3ZlIHBhZGRpbmcgYW5kIGJvcmRlcnMuIFRoZW4KCQkJICogc2V0IHRoZSB3aWR0aCBiYXNlZCBvbiB0aGUgcmVhbCBoZWFkZXJzCgkJCSAqLwoJCQkKCQkJLy8gQXBwbHkgYWxsIHN0eWxlcyBpbiBvbmUgcGFzcy4gSW52YWxpZGF0ZXMgbGF5b3V0IG9ubHkgb25jZSBiZWNhdXNlIHdlIGRvbid0IHJlYWQgYW55IAoJCQkvLyBET00gcHJvcGVydGllcy4KCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCB6ZXJvT3V0LCBhbkhlYWRTaXplcnMgKTsKCQkJIAoJCQkvLyBSZWFkIGFsbCB3aWR0aHMgaW4gbmV4dCBwYXNzLiBGb3JjZXMgbGF5b3V0IG9ubHkgb25jZSBiZWNhdXNlIHdlIGRvIG5vdCBjaGFuZ2UgCgkJCS8vIGFueSBET00gcHJvcGVydGllcy4KCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuU2l6ZXIpIHsKCQkJCWFBcHBsaWVkLnB1c2goIF9mblN0cmluZ1RvQ3NzKCAkKG5TaXplcikud2lkdGgoKSApICk7CgkJCX0sIGFuSGVhZFNpemVycyApOwoJCQkgCgkJCS8vIEFwcGx5IGFsbCB3aWR0aHMgaW4gZmluYWwgcGFzcy4gSW52YWxpZGF0ZXMgbGF5b3V0IG9ubHkgb25jZSBiZWNhdXNlIHdlIGRvIG5vdAoJCQkvLyByZWFkIGFueSBET00gcHJvcGVydGllcy4KCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuVG9TaXplLCBpKSB7CgkJCQluVG9TaXplLnN0eWxlLndpZHRoID0gYUFwcGxpZWRbaV07CgkJCX0sIGFuSGVhZFRvU2l6ZSApOwoJCQoJCQkkKGFuSGVhZFNpemVycykuaGVpZ2h0KDApOwoJCQkKCQkJLyogU2FtZSBhZ2FpbiB3aXRoIHRoZSBmb290ZXIgaWYgd2UgaGF2ZSBvbmUgKi8KCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggemVyb091dCwgYW5Gb290U2l6ZXJzICk7CgkJCQkgCgkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplcikgewoJCQkJCWFBcHBsaWVkRm9vdGVyLnB1c2goIF9mblN0cmluZ1RvQ3NzKCAkKG5TaXplcikud2lkdGgoKSApICk7CgkJCQl9LCBhbkZvb3RTaXplcnMgKTsKCQkJCSAKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblRvU2l6ZSwgaSkgewoJCQkJCW5Ub1NpemUuc3R5bGUud2lkdGggPSBhQXBwbGllZEZvb3RlcltpXTsKCQkJCX0sIGFuRm9vdFRvU2l6ZSApOwoJCQoJCQkJJChhbkZvb3RTaXplcnMpLmhlaWdodCgwKTsKCQkJfQoJCQkKCQkJLyoKCQkJICogMy4gQXBwbHkgdGhlIG1lYXN1cmVtZW50cwoJCQkgKi8KCQkJCgkJCS8qICJIaWRlIiB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdGhhdCB3ZSB1c2VkIGZvciB0aGUgc2l6aW5nLiBXZSB3YW50IHRvIGFsc28gZml4IHRoZWlyIHdpZHRoCgkJCSAqIHRvIHdoYXQgdGhleSBjdXJyZW50bHkgYXJlCgkJCSAqLwoJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplciwgaSkgewoJCQkJblNpemVyLmlubmVySFRNTCA9ICIiOwoJCQkJblNpemVyLnN0eWxlLndpZHRoID0gYUFwcGxpZWRbaV07CgkJCX0sIGFuSGVhZFNpemVycyApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBpKSB7CgkJCQkJblNpemVyLmlubmVySFRNTCA9ICIiOwoJCQkJCW5TaXplci5zdHlsZS53aWR0aCA9IGFBcHBsaWVkRm9vdGVyW2ldOwoJCQkJfSwgYW5Gb290U2l6ZXJzICk7CgkJCX0KCQkJCgkJCS8qIFNhbml0eSBjaGVjayB0aGF0IHRoZSB0YWJsZSBpcyBvZiBhIHNlbnNpYmxlIHdpZHRoLiBJZiBub3QgdGhlbiB3ZSBhcmUgZ29pbmcgdG8gZ2V0CgkJCSAqIG1pc2FsaWdubWVudCAtIHRyeSB0byBwcmV2ZW50IHRoaXMgYnkgbm90IGFsbG93aW5nIHRoZSB0YWJsZSB0byBzaHJpbmsgYmVsb3cgaXRzIG1pbiB3aWR0aAoJCQkgKi8KCQkJaWYgKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgPCBpU2FuaXR5V2lkdGggKQoJCQl7CgkJCQkvKiBUaGUgbWluIHdpZHRoIGRlcGVuZHMgdXBvbiBpZiB3ZSBoYXZlIGEgdmVydGljYWwgc2Nyb2xsYmFyIHZpc2libGUgb3Igbm90ICovCgkJCQl2YXIgaUNvcnJlY3Rpb24gPSAoKG5TY3JvbGxCb2R5LnNjcm9sbEhlaWdodCA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikpID8KCQkJCQkJaVNhbml0eVdpZHRoK28ub1Njcm9sbC5pQmFyV2lkdGggOiBpU2FuaXR5V2lkdGg7CgkJCQkKCQkJCS8qIElFNi83IGFyZSBhIGxhdyB1bnRvIHRoZW1zZWx2ZXMuLi4gKi8KCQkJCWlmICggaWU2NyAmJiAoblNjcm9sbEJvZHkuc2Nyb2xsSGVpZ2h0ID4gCgkJCQkJblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8ICQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJCQoJCQkJLyogQXBwbHkgdGhlIGNhbGN1bGF0ZWQgbWluaW11bSB3aWR0aCB0byB0aGUgdGFibGUgd3JhcHBlcnMgKi8KCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQlvLm5TY3JvbGxIZWFkLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW8ublNjcm9sbEZvb3Quc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaUNvcnJlY3Rpb24gKTsKCQkJCX0KCQkJCQoJCQkJLyogQW5kIGdpdmUgdGhlIHVzZXIgYSB3YXJuaW5nIHRoYXQgd2UndmUgc3RvcHBlZCB0aGUgdGFibGUgZ2V0dGluZyB0b28gc21hbGwgKi8KCQkJCWlmICggby5vU2Nyb2xsLnNYID09PSAiIiApCgkJCQl7CgkJCQkJX2ZuTG9nKCBvLCAxLCAiVGhlIHRhYmxlIGNhbm5vdCBmaXQgaW50byB0aGUgY3VycmVudCBlbGVtZW50IHdoaWNoIHdpbGwgY2F1c2UgY29sdW1uIisKCQkJCQkJIiBtaXNhbGlnbm1lbnQuIFRoZSB0YWJsZSBoYXMgYmVlbiBkcmF3biBhdCBpdHMgbWluaW11bSBwb3NzaWJsZSB3aWR0aC4iICk7CgkJCQl9CgkJCQllbHNlIGlmICggby5vU2Nyb2xsLnNYSW5uZXIgIT09ICIiICkKCQkJCXsKCQkJCQlfZm5Mb2coIG8sIDEsICJUaGUgdGFibGUgY2Fubm90IGZpdCBpbnRvIHRoZSBjdXJyZW50IGVsZW1lbnQgd2hpY2ggd2lsbCBjYXVzZSBjb2x1bW4iKwoJCQkJCQkiIG1pc2FsaWdubWVudC4gSW5jcmVhc2UgdGhlIHNTY3JvbGxYSW5uZXIgdmFsdWUgb3IgcmVtb3ZlIGl0IHRvIGFsbG93IGF1dG9tYXRpYyIrCgkJCQkJCSIgY2FsY3VsYXRpb24iICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAnMTAwJScgKTsKCQkJCW8ublNjcm9sbEhlYWQuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW8ublNjcm9sbEZvb3Quc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQl9CgkJCX0KCQkJCgkJCQoJCQkvKgoJCQkgKiA0LiBDbGVhbiB1cAoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJLyogSUU3PCBwdXRzIGEgdmVydGljYWwgc2Nyb2xsYmFyIGluIHBsYWNlICh3aGVuIGl0IHNob3VsZG4ndCBiZSkgZHVlIHRvIHN1YnRyYWN0aW5nCgkJCQkgKiB0aGUgc2Nyb2xsYmFyIGhlaWdodCBmcm9tIHRoZSB2aXNpYmxlIGRpc3BsYXksIHJhdGhlciB0aGFuIGFkZGluZyBpdCBvbi4gV2UgbmVlZCB0bwoJCQkJICogc2V0IHRoZSBoZWlnaHQgaW4gb3JkZXIgdG8gc29ydCB0aGlzLiBEb24ndCB3YW50IHRvIGRvIGl0IGluIGFueSBvdGhlciBicm93c2Vycy4KCQkJCSAqLwoJCQkJaWYgKCBpZTY3ICkKCQkJCXsKCQkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSBfZm5TdHJpbmdUb0Nzcyggby5uVGFibGUub2Zmc2V0SGVpZ2h0K28ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvLm9TY3JvbGwuc1kgIT09ICIiICYmIG8ub1Njcm9sbC5iQ29sbGFwc2UgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSBfZm5TdHJpbmdUb0Nzcyggby5vU2Nyb2xsLnNZICk7CgkJCQkKCQkJCXZhciBpRXh0cmEgPSAoby5vU2Nyb2xsLnNYICE9PSAiIiAmJiBvLm5UYWJsZS5vZmZzZXRXaWR0aCA+IG5TY3JvbGxCb2R5Lm9mZnNldFdpZHRoKSA/CgkJCQkgCW8ub1Njcm9sbC5pQmFyV2lkdGggOiAwOwoJCQkJaWYgKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQgPCBuU2Nyb2xsQm9keS5vZmZzZXRIZWlnaHQgKQoJCQkJewoJCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQraUV4dHJhICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEZpbmFsbHkgc2V0IHRoZSB3aWR0aCdzIG9mIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0YWJsZXMgKi8KCQkJdmFyIGlPdXRlcldpZHRoID0gJChvLm5UYWJsZSkub3V0ZXJXaWR0aCgpOwoJCQluU2Nyb2xsSGVhZFRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCW5TY3JvbGxIZWFkSW5uZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaU91dGVyV2lkdGggKTsKCQkKCQkJLy8gRmlndXJlIG91dCBpZiB0aGVyZSBhcmUgc2Nyb2xsYmFyIHByZXNlbnQgLSBpZiBzbyB0aGVuIHdlIG5lZWQgYSB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdG8KCQkJLy8gcHJvdmlkZSBhIGJpdCBtb3JlIHNwYWNlIHRvIGFsbG93ICJvdmVyZmxvdyIgc2Nyb2xsaW5nIChpLmUuIHBhc3QgdGhlIHNjcm9sbGJhcikKCQkJdmFyIGJTY3JvbGxpbmcgPSAkKG8ublRhYmxlKS5oZWlnaHQoKSA+IG5TY3JvbGxCb2R5LmNsaWVudEhlaWdodCB8fCAkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIjsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS5wYWRkaW5nUmlnaHQgPSBiU2Nyb2xsaW5nID8gby5vU2Nyb2xsLmlCYXJXaWR0aCsicHgiIDogIjBweCI7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS5wYWRkaW5nUmlnaHQgPSBiU2Nyb2xsaW5nID8gby5vU2Nyb2xsLmlCYXJXaWR0aCsicHgiIDogIjBweCI7CgkJCX0KCQkKCQkJLyogQWRqdXN0IHRoZSBwb3NpdGlvbiBvZiB0aGUgaGVhZGVyIGluIGNhc2Ugd2UgbG9vc2UgdGhlIHktc2Nyb2xsYmFyICovCgkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCgpOwoJCQkKCQkJLyogSWYgc29ydGluZyBvciBmaWx0ZXJpbmcgaGFzIG9jY3VycmVkLCBqdW1wIHRoZSBzY3JvbGxpbmcgYmFjayB0byB0aGUgdG9wICovCgkJCWlmICggby5iU29ydGVkIHx8IG8uYkZpbHRlcmVkICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc2Nyb2xsVG9wID0gMDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBseSBhIGdpdmVuIGZ1bmN0aW9uIHRvIHRoZSBkaXNwbGF5IGNoaWxkIG5vZGVzIG9mIGFuIGVsZW1lbnQgYXJyYXkgKHR5cGljYWxseQoJCSAqIFREIGNoaWxkcmVuIG9mIFRSIHJvd3MKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gTWV0aG9kIHRvIGFwcGx5IHRvIHRoZSBvYmplY3RzCgkJICogIEBwYXJhbSBhcnJheSB7bm9kZXN9IGFuMSBMaXN0IG9mIGVsZW1lbnRzIHRvIGxvb2sgdGhyb3VnaCBmb3IgZGlzcGxheSBjaGlsZHJlbgoJCSAqICBAcGFyYW0gYXJyYXkge25vZGVzfSBhbjIgQW5vdGhlciBsaXN0IChpZGVudGljYWwgc3RydWN0dXJlIHRvIHRoZSBmaXJzdCkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BcHBseVRvQ2hpbGRyZW4oIGZuLCBhbjEsIGFuMiApCgkJewoJCQl2YXIgaW5kZXg9MCwgaT0wLCBpTGVuPWFuMS5sZW5ndGg7CgkJCXZhciBuTm9kZTEsIG5Ob2RlMjsKCQkKCQkJd2hpbGUgKCBpIDwgaUxlbiApCgkJCXsKCQkJCW5Ob2RlMSA9IGFuMVtpXS5maXJzdENoaWxkOwoJCQkJbk5vZGUyID0gYW4yID8gYW4yW2ldLmZpcnN0Q2hpbGQgOiBudWxsOwoJCQkJd2hpbGUgKCBuTm9kZTEgKQoJCQkJewoJCQkJCWlmICggbk5vZGUxLm5vZGVUeXBlID09PSAxICkKCQkJCQl7CgkJCQkJCWlmICggYW4yICkKCQkJCQkJewoJCQkJCQkJZm4oIG5Ob2RlMSwgbk5vZGUyLCBpbmRleCApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJZm4oIG5Ob2RlMSwgaW5kZXggKTsKCQkJCQkJfQoJCQkJCQlpbmRleCsrOwoJCQkJCX0KCQkJCQluTm9kZTEgPSBuTm9kZTEubmV4dFNpYmxpbmc7CgkJCQkJbk5vZGUyID0gYW4yID8gbk5vZGUyLm5leHRTaWJsaW5nIDogbnVsbDsKCQkJCX0KCQkJCWkrKzsKCQkJfQoJCX0KCQkKCQkvKioKCQkgKiBDb252ZXJ0IGEgQ1NTIHVuaXQgd2lkdGggdG8gcGl4ZWxzIChlLmcuIDJlbSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNXaWR0aCB3aWR0aCB0byBiZSBjb252ZXJ0ZWQKCQkgKiAgQHBhcmFtIHtub2RlfSBuUGFyZW50IHBhcmVudCB0byBnZXQgdGhlIHdpdGggZm9yIChyZXF1aXJlZCBmb3IgcmVsYXRpdmUgd2lkdGhzKSAtIG9wdGlvbmFsCgkJICogIEByZXR1cm5zIHtpbnR9IGlXaWR0aCB3aWR0aCBpbiBwaXhlbHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29udmVydFRvV2lkdGggKCBzV2lkdGgsIG5QYXJlbnQgKQoJCXsKCQkJaWYgKCAhc1dpZHRoIHx8IHNXaWR0aCA9PT0gbnVsbCB8fCBzV2lkdGggPT09ICcnICkKCQkJewoJCQkJcmV0dXJuIDA7CgkJCX0KCQkJCgkJCWlmICggIW5QYXJlbnQgKQoJCQl7CgkJCQluUGFyZW50ID0gZG9jdW1lbnQuYm9keTsKCQkJfQoJCQkKCQkJdmFyIGlXaWR0aDsKCQkJdmFyIG5UbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoJCQluVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHNXaWR0aCApOwoJCQkKCQkJblBhcmVudC5hcHBlbmRDaGlsZCggblRtcCApOwoJCQlpV2lkdGggPSBuVG1wLm9mZnNldFdpZHRoOwoJCQluUGFyZW50LnJlbW92ZUNoaWxkKCBuVG1wICk7CgkJCQoJCQlyZXR1cm4gKCBpV2lkdGggKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQ2FsY3VsYXRlIHRoZSB3aWR0aCBvZiBjb2x1bW5zIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DYWxjdWxhdGVDb2x1bW5XaWR0aHMgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGlUYWJsZVdpZHRoID0gb1NldHRpbmdzLm5UYWJsZS5vZmZzZXRXaWR0aDsKCQkJdmFyIGlVc2VySW5wdXRzID0gMDsKCQkJdmFyIGlUbXBXaWR0aDsKCQkJdmFyIGlWaXNpYmxlQ29sdW1ucyA9IDA7CgkJCXZhciBpQ29sdW1zID0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGg7CgkJCXZhciBpLCBpSW5kZXgsIGlDb3JyZWN0b3IsIGlXaWR0aDsKCQkJdmFyIG9IZWFkZXJzID0gJCgndGgnLCBvU2V0dGluZ3MublRIZWFkKTsKCQkJdmFyIHdpZHRoQXR0ciA9IG9TZXR0aW5ncy5uVGFibGUuZ2V0QXR0cmlidXRlKCd3aWR0aCcpOwoJCQl2YXIgbldyYXBwZXIgPSBvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGU7CgkJCQoJCQkvKiBDb252ZXJ0IGFueSB1c2VyIGlucHV0IHNpemVzIGludG8gcGl4ZWwgc2l6ZXMgKi8KCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCXsKCQkJCQlpVmlzaWJsZUNvbHVtbnMrKzsKCQkJCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCWlUbXBXaWR0aCA9IF9mbkNvbnZlcnRUb1dpZHRoKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aE9yaWcsIAoJCQkJCQkJbldyYXBwZXIgKTsKCQkJCQkJaWYgKCBpVG1wV2lkdGggIT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG1wV2lkdGggKTsKCQkJCQkJfQoJCQkJCQkJCgkJCQkJCWlVc2VySW5wdXRzKys7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIERPTSBlcXVhbHMgdGhlIG51bWJlciB0aGF0IHdlIGhhdmUgdG8gcHJvY2VzcyBpbiAKCQkJICogRGF0YVRhYmxlcywgdGhlbiB3ZSBjYW4gdXNlIHRoZSBvZmZzZXRzIHRoYXQgYXJlIGNyZWF0ZWQgYnkgdGhlIHdlYi1icm93c2VyLiBObyBjdXN0b20gCgkJCSAqIHNpemVzIGNhbiBiZSBzZXQgaW4gb3JkZXIgZm9yIHRoaXMgdG8gaGFwcGVuLCBub3Igc2Nyb2xsaW5nIHVzZWQKCQkJICovCgkJCWlmICggaUNvbHVtcyA9PSBvSGVhZGVycy5sZW5ndGggJiYgaVVzZXJJbnB1dHMgPT09IDAgJiYgaVZpc2libGVDb2x1bW5zID09IGlDb2x1bXMgJiYKCQkJCW9TZXR0aW5ncy5vU2Nyb2xsLnNYID09PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWSA9PT0gIiIgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVG1wV2lkdGggPSAkKG9IZWFkZXJzW2ldKS53aWR0aCgpOwoJCQkJCWlmICggaVRtcFdpZHRoICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUbXBXaWR0aCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIE90aGVyd2lzZSB3ZSBhcmUgZ29pbmcgdG8gaGF2ZSB0byBkbyBzb21lIGNhbGN1bGF0aW9ucyB0byBnZXQgdGhlIHdpZHRoIG9mIGVhY2ggY29sdW1uLgoJCQkJICogQ29uc3RydWN0IGEgMSByb3cgdGFibGUgd2l0aCB0aGUgd2lkZXN0IG5vZGUgaW4gdGhlIGRhdGEsIGFuZCBhbnkgdXNlciBkZWZpbmVkIHdpZHRocywKCQkJCSAqIHRoZW4gaW5zZXJ0IGl0IGludG8gdGhlIERPTSBhbmQgYWxsb3cgdGhlIGJyb3dzZXIgdG8gZG8gYWxsIHRoZSBoYXJkIHdvcmsgb2YKCQkJCSAqIGNhbGN1bGF0aW5nIHRhYmxlIHdpZHRocy4KCQkJCSAqLwoJCQkJdmFyCgkJCQkJbkNhbGNUbXAgPSBvU2V0dGluZ3MublRhYmxlLmNsb25lTm9kZSggZmFsc2UgKSwKCQkJCQluVGhlYWRDbG9uZSA9IG9TZXR0aW5ncy5uVEhlYWQuY2xvbmVOb2RlKHRydWUpLAoJCQkJCW5Cb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3Rib2R5JyApLAoJCQkJCW5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0cicgKSwKCQkJCQluRGl2U2l6aW5nOwoJCQkJCgkJCQluQ2FsY1RtcC5yZW1vdmVBdHRyaWJ1dGUoICJpZCIgKTsKCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBuVGhlYWRDbG9uZSApOwoJCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICE9PSBudWxsICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5URm9vdC5jbG9uZU5vZGUodHJ1ZSkgKTsKCQkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG4pIHsKCQkJCQkJbi5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCX0sIG5DYWxjVG1wLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpICk7CgkJCQl9CgkJCQkKCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBuQm9keSApOwoJCQkJbkJvZHkuYXBwZW5kQ2hpbGQoIG5UciApOwoJCQkJCgkJCQkvKiBSZW1vdmUgYW55IHNpemluZyB0aGF0IHdhcyBwcmV2aW91c2x5IGFwcGxpZWQgYnkgdGhlIHN0eWxlcyAqLwoJCQkJdmFyIGpxQ29sU2l6aW5nID0gJCgndGhlYWQgdGgnLCBuQ2FsY1RtcCk7CgkJCQlpZiAoIGpxQ29sU2l6aW5nLmxlbmd0aCA9PT0gMCApCgkJCQl7CgkJCQkJanFDb2xTaXppbmcgPSAkKCd0Ym9keSB0cjplcSgwKT50ZCcsIG5DYWxjVG1wKTsKCQkJCX0KCQkKCQkJCS8qIEFwcGx5IGN1c3RvbSBzaXppbmcgdG8gdGhlIGNsb25lZCBoZWFkZXIgKi8KCQkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsIG5UaGVhZENsb25lICk7CgkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtcyA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIG9Db2x1bW4gPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldOwoJCQkJCWlmICggb0NvbHVtbi5iVmlzaWJsZSAmJiBvQ29sdW1uLnNXaWR0aE9yaWcgIT09IG51bGwgJiYgb0NvbHVtbi5zV2lkdGhPcmlnICE9PSAiIiApCgkJCQkJewoJCQkJCQluVGhzW2ktaUNvcnJlY3Rvcl0uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb0NvbHVtbi5zV2lkdGhPcmlnICk7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKCBvQ29sdW1uLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCW5UaHNbaS1pQ29ycmVjdG9yXS5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJfQoJCQkJfQoJCQoJCQkJLyogRmluZCB0aGUgYmlnZ2VzdCB0ZCBmb3IgZWFjaCBjb2x1bW4gYW5kIHB1dCBpdCBpbnRvIHRoZSB0YWJsZSAqLwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJdmFyIG5UZCA9IF9mbkdldFdpZGVzdE5vZGUoIG9TZXR0aW5ncywgaSApOwoJCQkJCQlpZiAoIG5UZCAhPT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW5UZCA9IG5UZC5jbG9uZU5vZGUodHJ1ZSk7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NvbnRlbnRQYWRkaW5nICE9PSAiIiApCgkJCQkJCQl7CgkJCQkJCQkJblRkLmlubmVySFRNTCArPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDb250ZW50UGFkZGluZzsKCQkJCQkJCX0KCQkJCQkJCW5Uci5hcHBlbmRDaGlsZCggblRkICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSB0YWJsZSBhbmQgJ2Rpc3BsYXknIGl0ICovCgkJCQluV3JhcHBlci5hcHBlbmRDaGlsZCggbkNhbGNUbXAgKTsKCQkJCQoJCQkJLyogV2hlbiBzY3JvbGxpbmcgKFggb3IgWSkgd2Ugd2FudCB0byBzZXQgdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSBhcyBhcHByb3ByaWF0ZS4gSG93ZXZlciwKCQkJCSAqIHdoZW4gbm90IHNjcm9sbGluZyBsZWF2ZSB0aGUgdGFibGUgd2lkdGggYXMgaXQgaXMuIFRoaXMgcmVzdWx0cyBpbiBzbGlnaHRseSBkaWZmZXJlbnQsCgkJCQkgKiBidXQgSSB0aGluayBjb3JyZWN0IGJlaGF2aW91cgoJCQkJICovCgkJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyICE9PSAiIiApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gIiI7CgkJCQkJaWYgKCAkKG5DYWxjVG1wKS53aWR0aCgpIDwgbldyYXBwZXIub2Zmc2V0V2lkdGggKQoJCQkJCXsKCQkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggbldyYXBwZXIub2Zmc2V0V2lkdGggKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBuV3JhcHBlci5vZmZzZXRXaWR0aCApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIHdpZHRoQXR0ciApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggd2lkdGhBdHRyICk7CgkJCQl9CgkJCQluQ2FsY1RtcC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CgkJCQkKCQkJCS8qIFNjcm9sbGluZyBjb25zaWRlcmF0aW9ucyAqLwoJCQkJX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QoIG9TZXR0aW5ncywgbkNhbGNUbXAgKTsKCQkJCQoJCQkJLyogUmVhZCB0aGUgd2lkdGgncyBjYWxjdWxhdGVkIGJ5IHRoZSBicm93c2VyIGFuZCBzdG9yZSB0aGVtIGZvciB1c2UgYnkgdGhlIGNhbGxlci4gV2UKCQkJCSAqIGZpcnN0IG9mIGFsbCB0cnkgdG8gdXNlIHRoZSBlbGVtZW50cyBpbiB0aGUgYm9keSwgYnV0IGl0IGlzIHBvc3NpYmxlIHRoYXQgdGhlcmUgYXJlCgkJCQkgKiBubyBlbGVtZW50cyB0aGVyZSwgdW5kZXIgd2hpY2ggY2lyY3Vtc3RhbmNlcyB3ZSB1c2UgdGhlIGhlYWRlciBlbGVtZW50cwoJCQkJICovCgkJCQl2YXIgb05vZGVzID0gJCgidGJvZHkgdHI6ZXEoMCkiLCBuQ2FsY1RtcCkuY2hpbGRyZW4oKTsKCQkJCWlmICggb05vZGVzLmxlbmd0aCA9PT0gMCApCgkJCQl7CgkJCQkJb05vZGVzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsICQoJ3RoZWFkJywgbkNhbGNUbXApWzBdICk7CgkJCQl9CgkJCgkJCQkvKiBCcm93c2VycyBuZWVkIGEgYml0IG9mIGEgaGFuZCB3aGVuIGEgd2lkdGggaXMgYXNzaWduZWQgdG8gYW55IGNvbHVtbnMgd2hlbiAKCQkJCSAqIHgtc2Nyb2xsaW5nIGFzIHRoZXkgdGVuZCB0byBjb2xsYXBzZSB0aGUgdGFibGUgdG8gdGhlIG1pbi13aWR0aCwgZXZlbiBpZgoJCQkJICogd2Ugc2VudCB0aGUgY29sdW1uIHdpZHRocy4gU28gd2UgbmVlZCB0byBrZWVwIHRyYWNrIG9mIHdoYXQgdGhlIHRhYmxlIHdpZHRoCgkJCQkgKiBzaG91bGQgYmUgYnkgc3VtbWluZyB0aGUgdXNlciBnaXZlbiB2YWx1ZXMsIGFuZCB0aGUgYXV0b21hdGljIHZhbHVlcwoJCQkJICovCgkJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCQl7CgkJCQkJdmFyIGlUb3RhbCA9IDA7CgkJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoT3JpZyA9PT0gbnVsbCApCgkJCQkJCQl7CgkJCQkJCQkJaVRvdGFsICs9ICQob05vZGVzW2lDb3JyZWN0b3JdKS5vdXRlcldpZHRoKCk7CgkJCQkJCQl9CgkJCQkJCQllbHNlCgkJCQkJCQl7CgkJCQkJCQkJaVRvdGFsICs9IHBhcnNlSW50KG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoLnJlcGxhY2UoJ3B4JywnJyksIDEwKSArCgkJCQkJCQkJCSgkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkub3V0ZXJXaWR0aCgpIC0gJChvTm9kZXNbaUNvcnJlY3Rvcl0pLndpZHRoKCkpOwoJCQkJCQkJfQoJCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUb3RhbCApOwoJCQkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRvdGFsICk7CgkJCQl9CgkJCgkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlpV2lkdGggPSAkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkud2lkdGgoKTsKCQkJCQkJaWYgKCBpV2lkdGggIT09IG51bGwgJiYgaVdpZHRoID4gMCApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlXaWR0aCApOwoJCQkJCQl9CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCgkJCQl2YXIgY3NzV2lkdGggPSAkKG5DYWxjVG1wKS5jc3MoJ3dpZHRoJyk7CgkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gKGNzc1dpZHRoLmluZGV4T2YoJyUnKSAhPT0gLTEpID8KCQkJCSAgICBjc3NXaWR0aCA6IF9mblN0cmluZ1RvQ3NzKCAkKG5DYWxjVG1wKS5vdXRlcldpZHRoKCkgKTsKCQkJCW5DYWxjVG1wLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5DYWxjVG1wICk7CgkJCX0KCQkKCQkJaWYgKCB3aWR0aEF0dHIgKQoJCQl7CgkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHdpZHRoQXR0ciApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkanVzdCBhIHRhYmxlJ3Mgd2lkdGggdG8gdGFrZSBhY2NvdW50IG9mIHNjcm9sbGluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0YWJsZSBub2RlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0ICggb1NldHRpbmdzLCBuICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCS8qIFdoZW4geS1zY3JvbGxpbmcgb25seSwgd2Ugd2FudCB0byByZW1vdmUgdGhlIHdpZHRoIG9mIHRoZSBzY3JvbGwgYmFyIHNvIHRoZSB0YWJsZQoJCQkJICogKyBzY3JvbGwgYmFyIHdpbGwgZml0IGludG8gdGhlIGFyZWEgYXZhaWFsYmxlLgoJCQkJICovCgkJCQl2YXIgaU9yaWdXaWR0aCA9ICQobikud2lkdGgoKTsKCQkJCW4uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJChuKS5vdXRlcldpZHRoKCktb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCXsKCQkJCS8qIFdoZW4geC1zY3JvbGxpbmcgYm90aCB3YXlzLCBmaXggdGhlIHRhYmxlIGF0IGl0J3MgY3VycmVudCBzaXplLCB3aXRob3V0IGFkanVzdGluZyAqLwoJCQkJbi5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG4pLm91dGVyV2lkdGgoKSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgd2lkZXN0IG5vZGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gb2YgaW50ZXJlc3QKCQkgKiAgQHJldHVybnMge25vZGV9IHdpZGVzdCB0YWJsZSBub2RlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFdpZGVzdE5vZGUoIG9TZXR0aW5ncywgaUNvbCApCgkJewoJCQl2YXIgaU1heEluZGV4ID0gX2ZuR2V0TWF4TGVuU3RyaW5nKCBvU2V0dGluZ3MsIGlDb2wgKTsKCQkJaWYgKCBpTWF4SW5kZXggPCAwICkKCQkJewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCQkKCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2lNYXhJbmRleF0ublRyID09PSBudWxsICkKCQkJewoJCQkJdmFyIG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwoJCQkJbi5pbm5lckhUTUwgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpTWF4SW5kZXgsIGlDb2wsICcnICk7CgkJCQlyZXR1cm4gbjsKCQkJfQoJCQlyZXR1cm4gX2ZuR2V0VGROb2RlcyhvU2V0dGluZ3MsIGlNYXhJbmRleClbaUNvbF07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbWF4aW11bSBzdHJsZW4gZm9yIGVhY2ggZGF0YSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gb2YgaW50ZXJlc3QKCQkgKiAgQHJldHVybnMge3N0cmluZ30gbWF4IHN0cmluZyBsZW5ndGggZm9yIGVhY2ggY29sdW1uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldE1heExlblN0cmluZyggb1NldHRpbmdzLCBpQ29sICkKCQl7CgkJCXZhciBpTWF4ID0gLTE7CgkJCXZhciBpTWF4SW5kZXggPSAtMTsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJdmFyIHMgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBpQ29sLCAnZGlzcGxheScgKSsiIjsKCQkJCXMgPSBzLnJlcGxhY2UoIC88Lio/Pi9nLCAiIiApOwoJCQkJaWYgKCBzLmxlbmd0aCA+IGlNYXggKQoJCQkJewoJCQkJCWlNYXggPSBzLmxlbmd0aDsKCQkJCQlpTWF4SW5kZXggPSBpOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gaU1heEluZGV4OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBlbmQgYSBDU1MgdW5pdCAob25seSBpZiByZXF1aXJlZCkgdG8gYSBzdHJpbmcKCQkgKiAgQHBhcmFtIHthcnJheX0gYUFycmF5MSBmaXJzdCBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJyYXkyIHNlY29uZCBhcnJheQoJCSAqICBAcmV0dXJucyB7aW50fSAwIGlmIG1hdGNoLCAxIGlmIGxlbmd0aCBpcyBkaWZmZXJlbnQsIDIgaWYgbm8gbWF0Y2gKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU3RyaW5nVG9Dc3MoIHMgKQoJCXsKCQkJaWYgKCBzID09PSBudWxsICkKCQkJewoJCQkJcmV0dXJuICIwcHgiOwoJCQl9CgkJCQoJCQlpZiAoIHR5cGVvZiBzID09ICdudW1iZXInICkKCQkJewoJCQkJaWYgKCBzIDwgMCApCgkJCQl7CgkJCQkJcmV0dXJuICIwcHgiOwoJCQkJfQoJCQkJcmV0dXJuIHMrInB4IjsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgaWYgdGhlIGxhc3QgY2hhcmFjdGVyIGlzIG5vdCAwLTkgKi8KCQkJdmFyIGMgPSBzLmNoYXJDb2RlQXQoIHMubGVuZ3RoLTEgKTsKCQkJaWYgKGMgPCAweDMwIHx8IGMgPiAweDM5KQoJCQl7CgkJCQlyZXR1cm4gczsKCQkJfQoJCQlyZXR1cm4gcysicHgiOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHdpZHRoIG9mIGEgc2Nyb2xsIGJhciBpbiB0aGlzIGJyb3dzZXIgYmVpbmcgdXNlZAoJCSAqICBAcmV0dXJucyB7aW50fSB3aWR0aCBpbiBwaXhlbHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2Nyb2xsQmFyV2lkdGggKCkKCQl7ICAKCQkJdmFyIGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOwoJCQl2YXIgc3R5bGUgPSBpbm5lci5zdHlsZTsKCQkJc3R5bGUud2lkdGggPSAiMTAwJSI7CgkJCXN0eWxlLmhlaWdodCA9ICIyMDBweCI7CgkJCXN0eWxlLnBhZGRpbmcgPSAiMHB4IjsKCQkJCgkJCXZhciBvdXRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlzdHlsZSA9IG91dGVyLnN0eWxlOwoJCQlzdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CgkJCXN0eWxlLnRvcCA9ICIwcHgiOwoJCQlzdHlsZS5sZWZ0ID0gIjBweCI7CgkJCXN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKCQkJc3R5bGUud2lkdGggPSAiMjAwcHgiOwoJCQlzdHlsZS5oZWlnaHQgPSAiMTUwcHgiOwoJCQlzdHlsZS5wYWRkaW5nID0gIjBweCI7CgkJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJCW91dGVyLmFwcGVuZENoaWxkKGlubmVyKTsKCQkJCgkJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3V0ZXIpOwoJCQl2YXIgdzEgPSBpbm5lci5vZmZzZXRXaWR0aDsKCQkJb3V0ZXIuc3R5bGUub3ZlcmZsb3cgPSAnc2Nyb2xsJzsKCQkJdmFyIHcyID0gaW5uZXIub2Zmc2V0V2lkdGg7CgkJCWlmICggdzEgPT0gdzIgKQoJCQl7CgkJCQl3MiA9IG91dGVyLmNsaWVudFdpZHRoOwoJCQl9CgkJCQoJCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG91dGVyKTsKCQkJcmV0dXJuICh3MSAtIHcyKTsgIAoJCX0KCQkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIG9yZGVyIG9mIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7Ym9vbH0gYkFwcGx5Q2xhc3NlcyBvcHRpb25hbCAtIHNob3VsZCB3ZSBhcHBseSBjbGFzc2VzIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Tb3J0ICggb1NldHRpbmdzLCBiQXBwbHlDbGFzc2VzICkKCQl7CgkJCXZhcgoJCQkJaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbiwKCQkJCXNEYXRhVHlwZSwgblRoLAoJCQkJYWFTb3J0ID0gW10sCgkJCSAJYWlPcmlnID0gW10sCgkJCQlvU29ydCA9IERhdGFUYWJsZS5leHQub1NvcnQsCgkJCQlhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhLAoJCQkJYW9Db2x1bW5zID0gb1NldHRpbmdzLmFvQ29sdW1ucywKCQkJCW9BcmlhID0gb1NldHRpbmdzLm9MYW5ndWFnZS5vQXJpYTsKCQkJCgkJCS8qIE5vIHNvcnRpbmcgcmVxdWlyZWQgaWYgc2VydmVyLXNpZGUgb3Igbm8gc29ydGluZyBhcnJheSAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICYmIAoJCQkJKG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoICE9PSAwIHx8IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCkgKQoJCQl7CgkJCQlhYVNvcnQgPSAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApID8KCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICkgOgoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJCQoJCQkJLyogSWYgdGhlcmUgaXMgYSBzb3J0aW5nIGRhdGEgdHlwZSwgYW5kIGEgZnVuY3Rpb24gYmVsb25naW5nIHRvIGl0LCB0aGVuIHdlIG5lZWQgdG8KCQkJCSAqIGdldCB0aGUgZGF0YSBmcm9tIHRoZSBkZXZlbG9wZXIncyBmdW5jdGlvbiBhbmQgYXBwbHkgaXQgZm9yIHRoaXMgY29sdW1uCgkJCQkgKi8KCQkJCWZvciAoIGk9MCA7IGk8YWFTb3J0Lmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIGlDb2x1bW4gPSBhYVNvcnRbaV1bMF07CgkJCQkJdmFyIGlWaXNDb2x1bW4gPSBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSggb1NldHRpbmdzLCBpQ29sdW1uICk7CgkJCQkJc0RhdGFUeXBlID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbHVtbiBdLnNTb3J0RGF0YVR5cGU7CgkJCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmblNvcnREYXRhW3NEYXRhVHlwZV0gKQoJCQkJCXsKCQkJCQkJdmFyIGFEYXRhID0gRGF0YVRhYmxlLmV4dC5hZm5Tb3J0RGF0YVtzRGF0YVR5cGVdLmNhbGwoIAoJCQkJCQkJb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLCBpQ29sdW1uLCBpVmlzQ29sdW1uCgkJCQkJCSk7CgkJCQkJCWlmICggYURhdGEubGVuZ3RoID09PSBhb0RhdGEubGVuZ3RoICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPWFvRGF0YS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGosIGlDb2x1bW4sIGFEYXRhW2pdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJldHVybmVkIGRhdGEgc29ydCBhcnJheSAoY29sICIraUNvbHVtbisiKSBpcyB0aGUgd3JvbmcgbGVuZ3RoIiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBDcmVhdGUgYSB2YWx1ZSAtIGtleSBhcnJheSBvZiB0aGUgY3VycmVudCByb3cgcG9zaXRpb25zIHN1Y2ggdGhhdCB3ZSBjYW4gdXNlIHRoZWlyCgkJCQkgKiBjdXJyZW50IHBvc2l0aW9uIGR1cmluZyB0aGUgc29ydCwgaWYgdmFsdWVzIG1hdGNoLCBpbiBvcmRlciB0byBwZXJmb3JtIHN0YWJsZSBzb3J0aW5nCgkJCQkgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYWlPcmlnWyBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyW2ldIF0gPSBpOwoJCQkJfQoJCQoJCQkJLyogQnVpbGQgYW4gaW50ZXJuYWwgZGF0YSBhcnJheSB3aGljaCBpcyBzcGVjaWZpYyB0byB0aGUgc29ydCwgc28gd2UgY2FuIGdldCBhbmQgcHJlcAoJCQkJICogdGhlIGRhdGEgdG8gYmUgc29ydGVkIG9ubHkgb25jZSwgcmF0aGVyIHRoYW4gbmVlZGluZyB0byBkbyBpdCBldmVyeSB0aW1lIHRoZSBzb3J0aW5nCgkJCQkgKiBmdW5jdGlvbiBydW5zLiBUaGlzIG1ha2UgdGhlIHNvcnRpbmcgZnVuY3Rpb24gYSB2ZXJ5IHNpbXBsZSBjb21wYXJpc29uCgkJCQkgKi8KCQkJCXZhciBpU29ydExlbiA9IGFhU29ydC5sZW5ndGg7CgkJCQl2YXIgZm5Tb3J0Rm9ybWF0LCBhRGF0YVNvcnQ7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJZm9yICggaj0wIDsgajxpU29ydExlbiA7IGorKyApCgkJCQkJewoJCQkJCQlhRGF0YVNvcnQgPSBhb0NvbHVtbnNbIGFhU29ydFtqXVswXSBdLmFEYXRhU29ydDsKCQkKCQkJCQkJZm9yICggaz0wLCBrTGVuPWFEYXRhU29ydC5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlzRGF0YVR5cGUgPSBhb0NvbHVtbnNbIGFEYXRhU29ydFtrXSBdLnNUeXBlOwoJCQkJCQkJZm5Tb3J0Rm9ybWF0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi1wcmUiIF07CgkJCQkJCQkKCQkJCQkJCWFvRGF0YVtpXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRba10gXSA9IGZuU29ydEZvcm1hdCA/CgkJCQkJCQkJZm5Tb3J0Rm9ybWF0KCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBhRGF0YVNvcnRba10sICdzb3J0JyApICkgOgoJCQkJCQkJCV9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGksIGFEYXRhU29ydFtrXSwgJ3NvcnQnICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIERvIHRoZSBzb3J0IC0gaGVyZSB3ZSB3YW50IG11bHRpLWNvbHVtbiBzb3J0aW5nIGJhc2VkIG9uIGEgZ2l2ZW4gZGF0YSBzb3VyY2UgKGNvbHVtbikKCQkJCSAqIGFuZCBzb3J0aW5nIGZ1bmN0aW9uIChmcm9tIG9Tb3J0KSBpbiBhIGNlcnRhaW4gZGlyZWN0aW9uLiBJdCdzIHJlYXNvbmFibHkgY29tcGxleCB0bwoJCQkJICogZm9sbG93IG9uIGl0J3Mgb3duLCBidXQgdGhpcyBpcyB3aGF0IHdlIHdhbnQgKGV4YW1wbGUgdHdvIGNvbHVtbiBzb3J0aW5nKToKCQkJCSAqICBmbkxvY2FsU29ydGluZyA9IGZ1bmN0aW9uKGEsYil7CgkJCQkgKiAgCXZhciBpVGVzdDsKCQkJCSAqICAJaVRlc3QgPSBvU29ydFsnc3RyaW5nLWFzYyddKCdkYXRhMTEnLCAnZGF0YTEyJyk7CgkJCQkgKiAgCWlmIChpVGVzdCAhPT0gMCkKCQkJCSAqICAJCXJldHVybiBpVGVzdDsKCQkJCSAqICAgIGlUZXN0ID0gb1NvcnRbJ251bWVyaWMtZGVzYyddKCdkYXRhMjEnLCAnZGF0YTIyJyk7CgkJCQkgKiAgICBpZiAoaVRlc3QgIT09IDApCgkJCQkgKiAgCQlyZXR1cm4gaVRlc3Q7CgkJCQkgKiAgCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCSAqICB9CgkJCQkgKiBCYXNpY2FsbHkgd2UgaGF2ZSBhIHRlc3QgZm9yIGVhY2ggc29ydGluZyBjb2x1bW4sIGlmIHRoZSBkYXRhIGluIHRoYXQgY29sdW1uIGlzIGVxdWFsLAoJCQkJICogdGVzdCB0aGUgbmV4dCBjb2x1bW4uIElmIGFsbCBjb2x1bW5zIG1hdGNoLCB0aGVuIHdlIHVzZSBhIG51bWVyaWMgc29ydCBvbiB0aGUgcm93IAoJCQkJICogcG9zaXRpb25zIGluIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5IHRvIHByb3ZpZGUgYSBzdGFibGUgc29ydC4KCQkJCSAqLwoJCQkJb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zb3J0KCBmdW5jdGlvbiAoIGEsIGIgKSB7CgkJCQkJdmFyIGssIGwsIGxMZW4sIGlUZXN0LCBhRGF0YVNvcnQsIHNEYXRhVHlwZTsKCQkJCQlmb3IgKCBrPTAgOyBrPGlTb3J0TGVuIDsgaysrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydCA9IGFvQ29sdW1uc1sgYWFTb3J0W2tdWzBdIF0uYURhdGFTb3J0OwoJCQoJCQkJCQlmb3IgKCBsPTAsIGxMZW49YURhdGFTb3J0Lmxlbmd0aCA7IGw8bExlbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCXNEYXRhVHlwZSA9IGFvQ29sdW1uc1sgYURhdGFTb3J0W2xdIF0uc1R5cGU7CgkJCQkJCQkKCQkJCQkJCWlUZXN0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi0iK2FhU29ydFtrXVsxXSBdKAoJCQkJCQkJCWFvRGF0YVthXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRbbF0gXSwKCQkJCQkJCQlhb0RhdGFbYl0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2xdIF0KCQkJCQkJCSk7CgkJCQkJCQoJCQkJCQkJaWYgKCBpVGVzdCAhPT0gMCApCgkJCQkJCQl7CgkJCQkJCQkJcmV0dXJuIGlUZXN0OwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWx0ZXIgdGhlIHNvcnRpbmcgY2xhc3NlcyB0byB0YWtlIGFjY291bnQgb2YgdGhlIGNoYW5nZXMgKi8KCQkJaWYgKCAoYkFwcGx5Q2xhc3NlcyA9PT0gdW5kZWZpbmVkIHx8IGJBcHBseUNsYXNzZXMpICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgc1RpdGxlID0gYW9Db2x1bW5zW2ldLnNUaXRsZS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJCW5UaCA9IGFvQ29sdW1uc1tpXS5uVGg7CgkJCQluVGgucmVtb3ZlQXR0cmlidXRlKCdhcmlhLXNvcnQnKTsKCQkJCW5UaC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKTsKCQkJCQoJCQkJLyogSW4gQVJJQSBvbmx5IHRoZSBmaXJzdCBzb3J0aW5nIGNvbHVtbiBjYW4gYmUgbWFya2VkIGFzIHNvcnRpbmcgLSBubyBtdWx0aS1zb3J0IG9wdGlvbiAqLwoJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCXsKCQkJCQlpZiAoIGFhU29ydC5sZW5ndGggPiAwICYmIGFhU29ydFswXVswXSA9PSBpICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc29ydCcsIGFhU29ydFswXVsxXT09ImFzYyIgPyAiYXNjZW5kaW5nIiA6ICJkZXNjZW5kaW5nIiApOwoJCQkJCQkKCQkJCQkJdmFyIG5leHRTb3J0ID0gKGFvQ29sdW1uc1tpXS5hc1NvcnRpbmdbIGFhU29ydFswXVsyXSsxIF0pID8gCgkJCQkJCQlhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWyBhYVNvcnRbMF1bMl0rMSBdIDogYW9Db2x1bW5zW2ldLmFzU29ydGluZ1swXTsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShuZXh0U29ydD09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWzBdPT0iYXNjIiA/IG9BcmlhLnNTb3J0QXNjZW5kaW5nIDogb0FyaWEuc1NvcnREZXNjZW5kaW5nKSApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgc1RpdGxlKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogVGVsbCB0aGUgZHJhdyBmdW5jdGlvbiB0aGF0IHdlIGhhdmUgc29ydGVkIHRoZSBkYXRhICovCgkJCW9TZXR0aW5ncy5iU29ydGVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdzb3J0Jywgb1NldHRpbmdzKTsKCQkJCgkJCS8qIENvcHkgdGhlIG1hc3RlciBkYXRhIGludG8gdGhlIGRyYXcgYXJyYXkgYW5kIHJlLWRyYXcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQkvKiBfZm5GaWx0ZXIoKSB3aWxsIHJlZHJhdyB0aGUgdGFibGUgZm9yIHVzICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsgLyogcmVzZXQgZGlzcGxheSBiYWNrIHRvIHBhZ2UgMCAqLwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGFjaCBhIHNvcnQgaGFuZGxlciAoY2xpY2spIHRvIGEgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgbm9kZSB0byBhdHRhY2ggdGhlIGhhbmRsZXIgdG8KCQkgKiAgQHBhcmFtIHtpbnR9IGlEYXRhSW5kZXggY29sdW1uIHNvcnRpbmcgaW5kZXgKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRBdHRhY2hMaXN0ZW5lciAoIG9TZXR0aW5ncywgbk5vZGUsIGlEYXRhSW5kZXgsIGZuQ2FsbGJhY2sgKQoJCXsKCQkJX2ZuQmluZEFjdGlvbiggbk5vZGUsIHt9LCBmdW5jdGlvbiAoZSkgewoJCQkJLyogSWYgdGhlIGNvbHVtbiBpcyBub3Qgc29ydGFibGUgLSBkb24ndCB0byBhbnl0aGluZyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmJTb3J0YWJsZSA9PT0gZmFsc2UgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJLyoKCQkJCSAqIFRoaXMgaXMgYSBsaXR0bGUgYml0IG9kZCBJIGFkbWl0Li4uIEkgZGVjbGFyZSBhIHRlbXBvcmFyeSBmdW5jdGlvbiBpbnNpZGUgdGhlIHNjb3BlIG9mCgkJCQkgKiBfZm5CdWlsZEhlYWQgYW5kIHRoZSBjbGljayBoYW5kbGVyIGluIG9yZGVyIHRoYXQgdGhlIGNvZGUgcHJlc2VudGVkIGhlcmUgY2FuIGJlIHVzZWQgCgkJCQkgKiB0d2ljZSAtIG9uY2UgZm9yIHdoZW4gYlByb2Nlc3NpbmcgaXMgZW5hYmxlZCwgYW5kIGFub3RoZXIgdGltZSBmb3Igd2hlbiBpdCBpcyAKCQkJCSAqIGRpc2FibGVkLCBhcyB3ZSBuZWVkIHRvIHBlcmZvcm0gc2xpZ2h0bHkgZGlmZmVyZW50IGFjdGlvbnMuCgkJCQkgKiAgIEJhc2ljYWxseSB0aGUgaXNzdWUgaGVyZSBpcyB0aGF0IHRoZSBKYXZhc2NyaXB0IGVuZ2luZSBpbiBtb2Rlcm4gYnJvd3NlcnMgZG9uJ3QgCgkJCQkgKiBhcHBlYXIgdG8gYWxsb3cgdGhlIHJlbmRlcmluZyBlbmdpbmUgdG8gdXBkYXRlIHRoZSBkaXNwbGF5IHdoaWxlIGl0IGlzIHN0aWxsIGV4ZWN1dGluZwoJCQkJICogaXQncyB0aHJlYWQgKHdlbGwgLSBpdCBkb2VzIGJ1dCBvbmx5IGFmdGVyIGxvbmcgaW50ZXJ2YWxzKS4gVGhpcyBtZWFucyB0aGF0IHRoZSAKCQkJCSAqICdwcm9jZXNzaW5nJyBkaXNwbGF5IGRvZXNuJ3QgYXBwZWFyIGZvciBhIHRhYmxlIHNvcnQuIFRvIGJyZWFrIHRoZSBqcyB0aHJlYWQgdXAgYSBiaXQKCQkJCSAqIEkgZm9yY2UgYW4gZXhlY3V0aW9uIGJyZWFrIGJ5IHVzaW5nIHNldFRpbWVvdXQgLSBidXQgdGhpcyBicmVha3MgdGhlIGV4cGVjdGVkIAoJCQkJICogdGhyZWFkIGNvbnRpbnVhdGlvbiBmb3IgdGhlIGVuZC1kZXZlbG9wZXIncyBwb2ludCBvZiB2aWV3ICh0aGVpciBjb2RlIHdvdWxkIGV4ZWN1dGUKCQkJCSAqIHRvbyBlYXJseSksIHNvIHdlIG9ubHkgZG8gaXQgd2hlbiB3ZSBhYnNvbHV0ZWx5IGhhdmUgdG8uCgkJCQkgKi8KCQkJCXZhciBmbklubmVyU29ydGluZyA9IGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIgaUNvbHVtbiwgaU5leHRTb3J0OwoJCQkJCQoJCQkJCS8qIElmIHRoZSBzaGlmdCBrZXkgaXMgcHJlc3NlZCB0aGVuIHdlIGFyZSBtdWx0aXBsZSBjb2x1bW4gc29ydGluZyAqLwoJCQkJCWlmICggZS5zaGlmdEtleSApCgkJCQkJewoJCQkJCQkvKiBBcmUgd2UgYWxyZWFkeSBkb2luZyBzb21lIGtpbmQgb2Ygc29ydCBvbiB0aGlzIGNvbHVtbj8gKi8KCQkJCQkJdmFyIGJGb3VuZCA9IGZhbHNlOwoJCQkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA9PSBpRGF0YUluZGV4ICkKCQkJCQkJCXsKCQkJCQkJCQliRm91bmQgPSB0cnVlOwoJCQkJCQkJCWlDb2x1bW4gPSBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdOwoJCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0rMTsKCQkJCQkJCQkKCQkJCQkJCQlpZiAoICFvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmFzU29ydGluZ1tpTmV4dFNvcnRdICkKCQkJCQkJCQl7CgkJCQkJCQkJCS8qIFJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgc29ydGluZyBvcHRpb25zLCByZW1vdmUgZnJvbSBtdWx0aS1jb2wgc29ydCAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggaSwgMSApOwoJCQkJCQkJCX0KCQkJCQkJCQllbHNlCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBNb3ZlIG9udG8gbmV4dCBzb3J0aW5nIGRpcmVjdGlvbiAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGlOZXh0U29ydDsKCQkJCQkJCQl9CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIE5vIHNvcnQgeWV0IC0gYWRkIGl0IGluICovCgkJCQkJCWlmICggYkZvdW5kID09PSBmYWxzZSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJLyogSWYgbm8gc2hpZnQga2V5IHRoZW4gc2luZ2xlIGNvbHVtbiBzb3J0ICovCgkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggPT0gMSAmJiBvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzBdID09IGlEYXRhSW5kZXggKQoJCQkJCQl7CgkJCQkJCQlpQ29sdW1uID0gb1NldHRpbmdzLmFhU29ydGluZ1swXVswXTsKCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0rMTsKCQkJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF0gKQoJCQkJCQkJewoJCQkJCQkJCWlOZXh0U29ydCA9IDA7CgkJCQkJCQl9CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0gPSBpTmV4dFNvcnQ7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggMCwgb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggKTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJLyogUnVuIHRoZSBzb3J0ICovCgkJCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJCQl9OyAvKiAvZm5Jbm5lclNvcnRpbmcgKi8KCQkJCQoJCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCQl7CgkJCQkJZm5Jbm5lclNvcnRpbmcoKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQkJc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJCWZuSW5uZXJTb3J0aW5nKCk7CgkJCQkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJCQl7CgkJCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJCQl9CgkJCQkJfSwgMCApOwoJCQkJfQoJCQkJCgkJCQkvKiBDYWxsIHRoZSB1c2VyIHNwZWNpZmllZCBjYWxsYmFjayBmdW5jdGlvbiAtIHVzZWQgZm9yIGFzeW5jIHVzZXIgaW50ZXJhY3Rpb24gKi8KCQkJCWlmICggdHlwZW9mIGZuQ2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJyApCgkJCQl7CgkJCQkJZm5DYWxsYmFjayggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogU2V0IHRoZSBzb3J0aW5nIGNsYXNzZXMgb24gdGhlIGhlYWRlciwgTm90ZTogaXQgaXMgc2FmZSB0byBjYWxsIHRoaXMgZnVuY3Rpb24gCgkJICogd2hlbiBiU29ydCBhbmQgYlNvcnRDbGFzc2VzIGFyZSBmYWxzZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGosIGpMZW4sIGlGb3VuZDsKCQkJdmFyIGFhU29ydCwgc0NsYXNzOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkKCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zU29ydEFzYyArIiAiKyBvQ2xhc3Nlcy5zU29ydERlc2MgKwoJCQkJCQkiICIrIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzcyApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZC5jb25jYXQoIG9TZXR0aW5ncy5hYVNvcnRpbmcgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJfQoJCQkKCQkJLyogQXBwbHkgdGhlIHJlcXVpcmVkIGNsYXNzZXMgdG8gdGhlIGhlYWRlciAqLwoJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQl7CgkJCQkJc0NsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzOwoJCQkJCWlGb3VuZCA9IC0xOwoJCQkJCWZvciAoIGo9MCA7IGo8YWFTb3J0Lmxlbmd0aCA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIGFhU29ydFtqXVswXSA9PSBpICkKCQkJCQkJewoJCQkJCQkJc0NsYXNzID0gKCBhYVNvcnRbal1bMV0gPT0gImFzYyIgKSA/CgkJCQkJCQkJb0NsYXNzZXMuc1NvcnRBc2MgOiBvQ2xhc3Nlcy5zU29ydERlc2M7CgkJCQkJCQlpRm91bmQgPSBqOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIHNDbGFzcyApOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQkJCXsKCQkJCQkJLyogalF1ZXJ5IFVJIHVzZXMgZXh0cmEgbWFya3VwICovCgkJCQkJCXZhciBqcVNwYW4gPSAkKCJzcGFuLiIrb0NsYXNzZXMuc1NvcnRJY29uLCAgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpOwoJCQkJCQlqcVNwYW4ucmVtb3ZlQ2xhc3Mob0NsYXNzZXMuc1NvcnRKVUlBc2MgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlEZXNjICsiICIrIAoJCQkJCQkJb0NsYXNzZXMuc1NvcnRKVUkgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlBc2NBbGxvd2VkICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQgKTsKCQkJCQkJCgkJCQkJCXZhciBzU3BhbkNsYXNzOwoJCQkJCQlpZiAoIGlGb3VuZCA9PSAtMSApCgkJCQkJCXsKCQkJCQkJIAlzU3BhbkNsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzSlVJOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBhYVNvcnRbaUZvdW5kXVsxXSA9PSAiYXNjIiApCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSUFzYzsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSURlc2M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCWpxU3Bhbi5hZGRDbGFzcyggc1NwYW5DbGFzcyApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQkvKiBObyBzb3J0aW5nIG9uIHRoaXMgY29sdW1uLCBzbyBhZGQgdGhlIGJhc2UgY2xhc3MuIFRoaXMgd2lsbCBoYXZlIGJlZW4gYXNzaWduZWQgYnkKCQkJCQkgKiBfZm5BZGRDb2x1bW4KCQkJCQkgKi8KCQkJCQkkKG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIAoJCQkgKiBBcHBseSB0aGUgcmVxdWlyZWQgY2xhc3NlcyB0byB0aGUgdGFibGUgYm9keQoJCQkgKiBOb3RlIHRoYXQgdGhpcyBpcyBnaXZlbiBhcyBhIGZlYXR1cmUgc3dpdGNoIHNpbmNlIGl0IGNhbiBzaWduaWZpY2FudGx5IHNsb3cgZG93biBhIHNvcnQKCQkJICogb24gbGFyZ2UgZGF0YSBzZXRzIChhZGRpbmcgYW5kIHJlbW92aW5nIG9mIGNsYXNzZXMgaXMgYWx3YXlzIHNsb3cgYXQgdGhlIGJlc3Qgb2YgdGltZXMuLikKCQkJICogRnVydGhlciB0byB0aGlzLCBub3RlIHRoYXQgdGhpcyBjb2RlIGlzIGFkbWl0dGVkbHkgZmFpcmx5IHVnbHkuIEl0IGNvdWxkIGJlIG1hZGUgYSBsb3QgCgkJCSAqIHNpbXBsZXIgdXNpbmcgalF1ZXJ5IHNlbGVjdG9ycyBhbmQgYWRkL3JlbW92ZUNsYXNzLCBidXQgdGhhdCBpcyBzaWduaWZpY2FudGx5IHNsb3dlcgoJCQkgKiAob24gdGhlIG9yZGVyIG9mIDUgdGltZXMgc2xvd2VyKSAtIGhlbmNlIHRoZSBkaXJlY3QgRE9NIG1hbmlwdWxhdGlvbiBoZXJlLgoJCQkgKiBOb3RlIHRoYXQgZm9yIGRlZmVycmVkIGRyYXdpbmcgd2UgZG8gdXNlIGpRdWVyeSAtIHRoZSByZWFzb24gYmVpbmcgdGhhdCB0YWtpbmcgdGhlIGZpcnN0CgkJCSAqIHJvdyBmb3VuZCB0byBzZWUgaWYgdGhlIHdob2xlIGNvbHVtbiBuZWVkcyBwcm9jZXNzZWQgY2FuIG1pc3MgY2xhc3NlcyBzaW5jZSB0aGUgZmlyc3QKCQkJICogY29sdW1uIG1pZ2h0IGJlIG5ldy4KCQkJICovCgkJCXNDbGFzcyA9IG9DbGFzc2VzLnNTb3J0Q29sdW1uOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnRDbGFzc2VzICkKCQkJewoJCQkJdmFyIG5UZHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MgKTsKCQkJCQoJCQkJLyogRGV0ZXJtaW5lIHdoYXQgdGhlIHNvcnRpbmcgY2xhc3MgZm9yIGVhY2ggY29sdW1uIHNob3VsZCBiZSAqLwoJCQkJdmFyIGlDbGFzcywgaVRhcmdldENvbDsKCQkJCXZhciBhc0NsYXNzZXMgPSBbXTsKCQkJCWZvciAoaSA9IDA7IGkgPCBpQ29sdW1uczsgaSsrKQoJCQkJewoJCQkJCWFzQ2xhc3Nlcy5wdXNoKCIiKTsKCQkJCX0KCQkJCWZvciAoaSA9IDAsIGlDbGFzcyA9IDE7IGkgPCBhYVNvcnQubGVuZ3RoOyBpKyspCgkJCQl7CgkJCQkJaVRhcmdldENvbCA9IHBhcnNlSW50KCBhYVNvcnRbaV1bMF0sIDEwICk7CgkJCQkJYXNDbGFzc2VzW2lUYXJnZXRDb2xdID0gc0NsYXNzICsgaUNsYXNzOwoJCQkJCQoJCQkJCWlmICggaUNsYXNzIDwgMyApCgkJCQkJewoJCQkJCQlpQ2xhc3MrKzsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIE1ha2UgY2hhbmdlcyB0byB0aGUgY2xhc3NlcyBmb3IgZWFjaCBjZWxsIGFzIG5lZWRlZCAqLwoJCQkJdmFyIHJlQ2xhc3MgPSBuZXcgUmVnRXhwKHNDbGFzcyArICJbMTIzXSIpOwoJCQkJdmFyIHNUbXBDbGFzcywgc0N1cnJlbnRDbGFzcywgc05ld0NsYXNzOwoJCQkJZm9yICggaT0wLCBpTGVuPW5UZHMubGVuZ3RoOyBpPGlMZW47IGkrKyApCgkJCQl7CgkJCQkJLyogRGV0ZXJtaW5lIHdoaWNoIGNvbHVtbiB3ZSdyZSBsb29raW5nIGF0ICovCgkJCQkJaVRhcmdldENvbCA9IGkgJSBpQ29sdW1uczsKCQkJCQkKCQkJCQkvKiBXaGF0IGlzIHRoZSBmdWxsIGxpc3Qgb2YgY2xhc3NlcyBub3cgKi8KCQkJCQlzQ3VycmVudENsYXNzID0gblRkc1tpXS5jbGFzc05hbWU7CgkJCQkJLyogV2hhdCBzb3J0aW5nIGNsYXNzIHNob3VsZCBiZSBhcHBsaWVkPyAqLwoJCQkJCXNOZXdDbGFzcyA9IGFzQ2xhc3Nlc1tpVGFyZ2V0Q29sXTsKCQkJCQkvKiBXaGF0IHdvdWxkIHRoZSBuZXcgZnVsbCBsaXN0IGJlIGlmIHdlIGRpZCBhIHJlcGxhY2VtZW50PyAqLwoJCQkJCXNUbXBDbGFzcyA9IHNDdXJyZW50Q2xhc3MucmVwbGFjZShyZUNsYXNzLCBzTmV3Q2xhc3MpOwoJCQkJCQoJCQkJCWlmICggc1RtcENsYXNzICE9IHNDdXJyZW50Q2xhc3MgKQoJCQkJCXsKCQkJCQkJLyogV2UgY2hhbmdlZCBzb21ldGhpbmcgKi8KCQkJCQkJblRkc1tpXS5jbGFzc05hbWUgPSAkLnRyaW0oIHNUbXBDbGFzcyApOwoJCQkJCX0KCQkJCQllbHNlIGlmICggc05ld0NsYXNzLmxlbmd0aCA+IDAgJiYgc0N1cnJlbnRDbGFzcy5pbmRleE9mKHNOZXdDbGFzcykgPT0gLTEgKQoJCQkJCXsKCQkJCQkJLyogV2UgbmVlZCB0byBhZGQgYSBjbGFzcyAqLwoJCQkJCQluVGRzW2ldLmNsYXNzTmFtZSA9IHNDdXJyZW50Q2xhc3MgKyAiICIgKyBzTmV3Q2xhc3M7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIFNhdmUgdGhlIHN0YXRlIG9mIGEgdGFibGUgaW4gYSBjb29raWUgc3VjaCB0aGF0IHRoZSBwYWdlIGNhbiBiZSByZWxvYWRlZAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNhdmVTdGF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTdGF0ZVNhdmUgfHwgb1NldHRpbmdzLmJEZXN0cm95aW5nICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCgkJCS8qIFN0b3JlIHRoZSBpbnRlcmVzdGluZyB2YXJpYWJsZXMgKi8KCQkJdmFyIGksIGlMZW4sIGJJbmZpbml0ZT1vU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGU7CgkJCXZhciBvU3RhdGUgPSB7CgkJCQkiaUNyZWF0ZSI6ICAgICAgbmV3IERhdGUoKS5nZXRUaW1lKCksCgkJCQkiaVN0YXJ0IjogICAgICAgKGJJbmZpbml0ZSA/IDAgOiBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQpLAoJCQkJImlFbmQiOiAgICAgICAgIChiSW5maW5pdGUgPyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDogb1NldHRpbmdzLl9pRGlzcGxheUVuZCksCgkJCQkiaUxlbmd0aCI6ICAgICAgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCwKCQkJCSJhYVNvcnRpbmciOiAgICAkLmV4dGVuZCggdHJ1ZSwgW10sIG9TZXR0aW5ncy5hYVNvcnRpbmcgKSwKCQkJCSJvU2VhcmNoIjogICAgICAkLmV4dGVuZCggdHJ1ZSwge30sIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2ggKSwKCQkJCSJhb1NlYXJjaENvbHMiOiAkLmV4dGVuZCggdHJ1ZSwgW10sIG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHMgKSwKCQkJCSJhYlZpc0NvbHMiOiAgICBbXQoJCQl9OwoJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvU3RhdGUuYWJWaXNDb2xzLnB1c2goIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKTsKCQkJfQoJCQoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgImFvU3RhdGVTYXZlUGFyYW1zIiwgJ3N0YXRlU2F2ZVBhcmFtcycsIFtvU2V0dGluZ3MsIG9TdGF0ZV0gKTsKCQkJCgkJCW9TZXR0aW5ncy5mblN0YXRlU2F2ZS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3MsIG9TdGF0ZSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBdHRlbXB0IHRvIGxvYWQgYSBzYXZlZCB0YWJsZSBzdGF0ZSBmcm9tIGEgY29va2llCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9Jbml0IERhdGFUYWJsZXMgaW5pdCBvYmplY3Qgc28gd2UgY2FuIG92ZXJyaWRlIHNldHRpbmdzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxvYWRTdGF0ZSAoIG9TZXR0aW5ncywgb0luaXQgKQoJCXsKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU3RhdGVTYXZlICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCgkJCXZhciBvRGF0YSA9IG9TZXR0aW5ncy5mblN0YXRlTG9hZC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3MgKTsKCQkJaWYgKCAhb0RhdGEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIEFsbG93IGN1c3RvbSBhbmQgcGx1Zy1pbiBtYW5pcHVsYXRpb24gZnVuY3Rpb25zIHRvIGFsdGVyIHRoZSBzYXZlZCBkYXRhIHNldCBhbmQKCQkJICogY2FuY2VsbGluZyBvZiBsb2FkaW5nIGJ5IHJldHVybmluZyBmYWxzZQoJCQkgKi8KCQkJdmFyIGFiU3RhdGVMb2FkID0gX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZFBhcmFtcycsICdzdGF0ZUxvYWRQYXJhbXMnLCBbb1NldHRpbmdzLCBvRGF0YV0gKTsKCQkJaWYgKCAkLmluQXJyYXkoIGZhbHNlLCBhYlN0YXRlTG9hZCApICE9PSAtMSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU3RvcmUgdGhlIHNhdmVkIHN0YXRlIHNvIGl0IG1pZ2h0IGJlIGFjY2Vzc2VkIGF0IGFueSB0aW1lICovCgkJCW9TZXR0aW5ncy5vTG9hZGVkU3RhdGUgPSAkLmV4dGVuZCggdHJ1ZSwge30sIG9EYXRhICk7CgkJCQoJCQkvKiBSZXN0b3JlIGtleSBmZWF0dXJlcyAqLwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgICAgPSBvRGF0YS5pU3RhcnQ7CgkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IG9EYXRhLmlTdGFydDsKCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCAgICAgID0gb0RhdGEuaUVuZDsKCQkJb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCAgID0gb0RhdGEuaUxlbmd0aDsKCQkJb1NldHRpbmdzLmFhU29ydGluZyAgICAgICAgID0gb0RhdGEuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCW9TZXR0aW5ncy5zYXZlZF9hYVNvcnRpbmcgICA9IG9EYXRhLmFhU29ydGluZy5zbGljZSgpOwoJCQkKCQkJLyogU2VhcmNoIGZpbHRlcmluZyAgKi8KCQkJJC5leHRlbmQoIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2gsIG9EYXRhLm9TZWFyY2ggKTsKCQkJJC5leHRlbmQoIHRydWUsIG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHMsIG9EYXRhLmFvU2VhcmNoQ29scyApOwoJCQkKCQkJLyogQ29sdW1uIHZpc2liaWxpdHkgc3RhdGUKCQkJICogUGFzcyBiYWNrIHZpc2liaWxpdHkgc2V0dGluZ3MgdG8gdGhlIGluaXQgaGFuZGxlciwgYnV0IHRvIGRvIG5vdCBoZXJlIG92ZXJyaWRlCgkJCSAqIHRoZSBpbml0IG9iamVjdCB0aGF0IHRoZSB1c2VyIG1pZ2h0IGhhdmUgcGFzc2VkIGluCgkJCSAqLwoJCQlvSW5pdC5zYXZlZF9hb0NvbHVtbnMgPSBbXTsKCQkJZm9yICggdmFyIGk9MCA7IGk8b0RhdGEuYWJWaXNDb2xzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCW9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXSA9IHt9OwoJCQkJb0luaXQuc2F2ZWRfYW9Db2x1bW5zW2ldLmJWaXNpYmxlID0gb0RhdGEuYWJWaXNDb2xzW2ldOwoJCQl9CgkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICdzdGF0ZUxvYWRlZCcsIFtvU2V0dGluZ3MsIG9EYXRhXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgY29va2llIHdpdGggYSB2YWx1ZSB0byBzdG9yZSB0aGUgc3RhdGUgb2YgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgbmFtZSBvZiB0aGUgY29va2llIHRvIGNyZWF0ZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZhbHVlIHRoZSB2YWx1ZSB0aGUgY29va2llIHNob3VsZCB0YWtlCgkJICogIEBwYXJhbSB7aW50fSBpU2VjcyBkdXJhdGlvbiBvZiB0aGUgY29va2llCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzQmFzZU5hbWUgc05hbWUgaXMgbWFkZSB1cCBvZiB0aGUgYmFzZSArIGZpbGUgbmFtZSAtIHRoaXMgaXMgdGhlIGJhc2UKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm5DYWxsYmFjayBVc2VyIGRlZmluYWJsZSBmdW5jdGlvbiB0byBtb2RpZnkgdGhlIGNvb2tpZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVDb29raWUgKCBzTmFtZSwgc1ZhbHVlLCBpU2Vjcywgc0Jhc2VOYW1lLCBmbkNhbGxiYWNrICkKCQl7CgkJCXZhciBkYXRlID0gbmV3IERhdGUoKTsKCQkJZGF0ZS5zZXRUaW1lKCBkYXRlLmdldFRpbWUoKSsoaVNlY3MqMTAwMCkgKTsKCQkJCgkJCS8qIAoJCQkgKiBTaG9ja2luZyBidXQgdHJ1ZSAtIGl0IHdvdWxkIGFwcGVhciBJRSBoYXMgbWFqb3IgaXNzdWVzIHdpdGggaGF2aW5nIHRoZSBwYXRoIG5vdCBoYXZpbmcKCQkJICogYSB0cmFpbGluZyBzbGFzaCBvbiBpdC4gV2UgbmVlZCB0aGUgY29va2llIHRvIGJlIGF2YWlsYWJsZSBiYXNlZCBvbiB0aGUgcGF0aCwgc28gd2UKCQkJICogaGF2ZSB0byBhcHBlbmQgdGhlIGZpbGUgbmFtZSB0byB0aGUgY29va2llIG5hbWUuIEFwcGFsbGluZy4gVGhhbmtzIHRvIHZleCBmb3IgYWRkaW5nIHRoZQoJCQkgKiBwYXRjaCB0byB1c2UgYXQgbGVhc3Qgc29tZSBvZiB0aGUgcGF0aAoJCQkgKi8KCQkJdmFyIGFQYXJ0cyA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpOwoJCQl2YXIgc05hbWVGaWxlID0gc05hbWUgKyAnXycgKyBhUGFydHMucG9wKCkucmVwbGFjZSgvW1wvOl0vZywiIikudG9Mb3dlckNhc2UoKTsKCQkJdmFyIHNGdWxsQ29va2llLCBvRGF0YTsKCQkJCgkJCWlmICggZm5DYWxsYmFjayAhPT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhID0gKHR5cGVvZiAkLnBhcnNlSlNPTiA9PT0gJ2Z1bmN0aW9uJykgPyAKCQkJCQkkLnBhcnNlSlNPTiggc1ZhbHVlICkgOiBldmFsKCAnKCcrc1ZhbHVlKycpJyApOwoJCQkJc0Z1bGxDb29raWUgPSBmbkNhbGxiYWNrKCBzTmFtZUZpbGUsIG9EYXRhLCBkYXRlLnRvR01UU3RyaW5nKCksCgkJCQkJYVBhcnRzLmpvaW4oJy8nKSsiLyIgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXNGdWxsQ29va2llID0gc05hbWVGaWxlICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHNWYWx1ZSkgKwoJCQkJCSI7IGV4cGlyZXM9IiArIGRhdGUudG9HTVRTdHJpbmcoKSArIjsgcGF0aD0iICsgYVBhcnRzLmpvaW4oJy8nKSsiLyI7CgkJCX0KCQkJCgkJCS8qIEFyZSB3ZSBnb2luZyB0byBnbyBvdmVyIHRoZSBjb29raWUgbGltaXQgb2YgNEtpQj8gSWYgc28sIHRyeSB0byBkZWxldGUgYSBjb29raWVzCgkJCSAqIGJlbG9uZ2luZyB0byBEYXRhVGFibGVzLgoJCQkgKi8KCQkJdmFyCgkJCQlhQ29va2llcyA9ZG9jdW1lbnQuY29va2llLnNwbGl0KCc7JyksCgkJCQlpTmV3Q29va2llTGVuID0gc0Z1bGxDb29raWUuc3BsaXQoJzsnKVswXS5sZW5ndGgsCgkJCQlhT2xkQ29va2llcyA9IFtdOwoJCQkKCQkJaWYgKCBpTmV3Q29va2llTGVuK2RvY3VtZW50LmNvb2tpZS5sZW5ndGgrMTAgPiA0MDk2ICkgLyogTWFnaWMgMTAgZm9yIHBhZGRpbmcgKi8KCQkJewoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hQ29va2llcy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYUNvb2tpZXNbaV0uaW5kZXhPZiggc0Jhc2VOYW1lICkgIT0gLTEgKQoJCQkJCXsKCQkJCQkJLyogSXQncyBhIERhdGFUYWJsZXMgY29va2llLCBzbyBldmFsIGl0IGFuZCBjaGVjayB0aGUgdGltZSBzdGFtcCAqLwoJCQkJCQl2YXIgYVNwbGl0Q29va2llID0gYUNvb2tpZXNbaV0uc3BsaXQoJz0nKTsKCQkJCQkJdHJ5IHsKCQkJCQkJCW9EYXRhID0gZXZhbCggJygnK2RlY29kZVVSSUNvbXBvbmVudChhU3BsaXRDb29raWVbMV0pKycpJyApOwoJCQoJCQkJCQkJaWYgKCBvRGF0YSAmJiBvRGF0YS5pQ3JlYXRlICkKCQkJCQkJCXsKCQkJCQkJCQlhT2xkQ29va2llcy5wdXNoKCB7CgkJCQkJCQkJCSJuYW1lIjogYVNwbGl0Q29va2llWzBdLAoJCQkJCQkJCQkidGltZSI6IG9EYXRhLmlDcmVhdGUKCQkJCQkJCQl9ICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJY2F0Y2goIGUgKSB7fQoJCQkJCX0KCQkJCX0KCQkKCQkJCS8vIE1ha2Ugc3VyZSB3ZSBkZWxldGUgdGhlIG9sZGVzdCBvbmVzIGZpcnN0CgkJCQlhT2xkQ29va2llcy5zb3J0KCBmdW5jdGlvbiAoYSwgYikgewoJCQkJCXJldHVybiBiLnRpbWUgLSBhLnRpbWU7CgkJCQl9ICk7CgkJCgkJCQkvLyBFbGltaW5hdGUgYXMgbWFueSBvbGQgRGF0YVRhYmxlcyBjb29raWVzIGFzIHdlIG5lZWQgdG8KCQkJCXdoaWxlICggaU5ld0Nvb2tpZUxlbiArIGRvY3VtZW50LmNvb2tpZS5sZW5ndGggKyAxMCA+IDQwOTYgKSB7CgkJCQkJaWYgKCBhT2xkQ29va2llcy5sZW5ndGggPT09IDAgKSB7CgkJCQkJCS8vIERlbGV0ZWQgYWxsIERUIGNvb2tpZXMgYW5kIHN0aWxsIG5vdCBlbm91Z2ggc3BhY2UuIENhbid0IHN0YXRlIHNhdmUKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCQkKCQkJCQl2YXIgb2xkID0gYU9sZENvb2tpZXMucG9wKCk7CgkJCQkJZG9jdW1lbnQuY29va2llID0gb2xkLm5hbWUrIj07IGV4cGlyZXM9VGh1LCAwMS1KYW4tMTk3MCAwMDowMDowMSBHTVQ7IHBhdGg9IisKCQkJCQkJYVBhcnRzLmpvaW4oJy8nKSArICIvIjsKCQkJCX0KCQkJfQoJCQkKCQkJZG9jdW1lbnQuY29va2llID0gc0Z1bGxDb29raWU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlYWQgYW4gb2xkIGNvb2tpZSB0byBnZXQgYSBjb29raWUgd2l0aCBhbiBvbGQgdGFibGUgc3RhdGUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNOYW1lIG5hbWUgb2YgdGhlIGNvb2tpZSB0byByZWFkCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGNvbnRlbnRzIG9mIHRoZSBjb29raWUgLSBvciBudWxsIGlmIG5vIGNvb2tpZSB3aXRoIHRoYXQgbmFtZSBmb3VuZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZWFkQ29va2llICggc05hbWUgKQoJCXsKCQkJdmFyCgkJCQlhUGFydHMgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKSwKCQkJCXNOYW1lRVEgPSBzTmFtZSArICdfJyArIGFQYXJ0c1thUGFydHMubGVuZ3RoLTFdLnJlcGxhY2UoL1tcLzpdL2csIiIpLnRvTG93ZXJDYXNlKCkgKyAnPScsCgkJCSAJc0Nvb2tpZUNvbnRlbnRzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7CgkJCQoJCQlmb3IoIHZhciBpPTAgOyBpPHNDb29raWVDb250ZW50cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQl2YXIgYyA9IHNDb29raWVDb250ZW50c1tpXTsKCQkJCQoJCQkJd2hpbGUgKGMuY2hhckF0KDApPT0nICcpCgkJCQl7CgkJCQkJYyA9IGMuc3Vic3RyaW5nKDEsYy5sZW5ndGgpOwoJCQkJfQoJCQkJCgkJCQlpZiAoYy5pbmRleE9mKHNOYW1lRVEpID09PSAwKQoJCQkJewoJCQkJCXJldHVybiBkZWNvZGVVUklDb21wb25lbnQoIGMuc3Vic3RyaW5nKHNOYW1lRVEubGVuZ3RoLGMubGVuZ3RoKSApOwoJCQkJfQoJCQl9CgkJCXJldHVybiBudWxsOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gdGhlIHNldHRpbmdzIG9iamVjdCBmb3IgYSBwYXJ0aWN1bGFyIHRhYmxlCgkJICogIEBwYXJhbSB7bm9kZX0gblRhYmxlIHRhYmxlIHdlIGFyZSB1c2luZyBhcyBhIGRhdGFUYWJsZQoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBTZXR0aW5ncyBvYmplY3QgLSBvciBudWxsIGlmIG5vdCBmb3VuZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXR0aW5nc0Zyb21Ob2RlICggblRhYmxlICkKCQl7CgkJCWZvciAoIHZhciBpPTAgOyBpPERhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5uVGFibGUgPT09IG5UYWJsZSApCgkJCQl7CgkJCQkJcmV0dXJuIERhdGFUYWJsZS5zZXR0aW5nc1tpXTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiBhbiBhcnJheSB3aXRoIHRoZSBUUiBub2RlcyBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBUUiBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRUck5vZGVzICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhTm9kZXMgPSBbXTsKCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGE7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJYU5vZGVzLnB1c2goIGFvRGF0YVtpXS5uVHIgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gYU5vZGVzOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gZmxhdCBhcnJheSB3aXRoIGFsbCBURCBub2RlcyBmb3IgdGhlIHRhYmxlLCBvciByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gW2lJbmRpdmlkdWFsUm93XSBhb0RhdGEgaW5kZXggdG8gZ2V0IHRoZSBub2RlcyBmb3IgLSBvcHRpb25hbCAKCQkgKiAgICBpZiBub3QgZ2l2ZW4gdGhlbiB0aGUgcmV0dXJuIGFycmF5IHdpbGwgY29udGFpbiBhbGwgbm9kZXMgZm9yIHRoZSB0YWJsZQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IFREIGFycmF5CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFRkTm9kZXMgKCBvU2V0dGluZ3MsIGlJbmRpdmlkdWFsUm93ICkKCQl7CgkJCXZhciBhblJldHVybiA9IFtdOwoJCQl2YXIgaUNvcnJlY3RvcjsKCQkJdmFyIGFuVGRzLCBuVGQ7CgkJCXZhciBpUm93LCBpUm93cz1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCwKCQkJCWlDb2x1bW4sIGlDb2x1bW5zLCBvRGF0YSwgc05vZGVOYW1lLCBpU3RhcnQ9MCwgaUVuZD1pUm93czsKCQkJCgkJCS8qIEFsbG93IHRoZSBjb2xsZWN0aW9uIHRvIGJlIGxpbWl0ZWQgdG8ganVzdCBvbmUgcm93ICovCgkJCWlmICggaUluZGl2aWR1YWxSb3cgIT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlTdGFydCA9IGlJbmRpdmlkdWFsUm93OwoJCQkJaUVuZCA9IGlJbmRpdmlkdWFsUm93KzE7CgkJCX0KCQkKCQkJZm9yICggaVJvdz1pU3RhcnQgOyBpUm93PGlFbmQgOyBpUm93KysgKQoJCQl7CgkJCQlvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCQlpZiAoIG9EYXRhLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJLyogZ2V0IHRoZSBURCBjaGlsZCBub2RlcyAtIHRha2luZyBpbnRvIGFjY291bnQgdGV4dCBldGMgbm9kZXMgKi8KCQkJCQlhblRkcyA9IFtdOwoJCQkJCW5UZCA9IG9EYXRhLm5Uci5maXJzdENoaWxkOwoJCQkJCXdoaWxlICggblRkICkKCQkJCQl7CgkJCQkJCXNOb2RlTmFtZSA9IG5UZC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAndGQnIHx8IHNOb2RlTmFtZSA9PSAndGgnICkKCQkJCQkJewoJCQkJCQkJYW5UZHMucHVzaCggblRkICk7CgkJCQkJCX0KCQkJCQkJblRkID0gblRkLm5leHRTaWJsaW5nOwoJCQkJCX0KCQkKCQkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCQlmb3IgKCBpQ29sdW1uPTAsIGlDb2x1bW5zPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaUNvbHVtbjxpQ29sdW1ucyA7IGlDb2x1bW4rKyApCgkJCQkJewoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlhblJldHVybi5wdXNoKCBhblRkc1tpQ29sdW1uLWlDb3JyZWN0b3JdICk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlhblJldHVybi5wdXNoKCBvRGF0YS5fYW5IaWRkZW5baUNvbHVtbl0gKTsKCQkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQlyZXR1cm4gYW5SZXR1cm47CgkJfQoJCQoJCQoJCS8qKgoJCSAqIExvZyBhbiBlcnJvciBtZXNzYWdlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlMZXZlbCBsb2cgZXJyb3IgbWVzc2FnZXMsIG9yIGRpc3BsYXkgdGhlbSB0byB0aGUgdXNlcgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc01lc2cgZXJyb3IgbWVzc2FnZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Mb2coIG9TZXR0aW5ncywgaUxldmVsLCBzTWVzZyApCgkJewoJCQl2YXIgc0FsZXJ0ID0gKG9TZXR0aW5ncz09PW51bGwpID8KCQkJCSJEYXRhVGFibGVzIHdhcm5pbmc6ICIrc01lc2cgOgoJCQkJIkRhdGFUYWJsZXMgd2FybmluZyAodGFibGUgaWQgPSAnIitvU2V0dGluZ3Muc1RhYmxlSWQrIicpOiAiK3NNZXNnOwoJCQkKCQkJaWYgKCBpTGV2ZWwgPT09IDAgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5leHQuc0Vyck1vZGUgPT0gJ2FsZXJ0JyApCgkJCQl7CgkJCQkJYWxlcnQoIHNBbGVydCApOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCXRocm93IG5ldyBFcnJvcihzQWxlcnQpOwoJCQkJfQoJCQkJcmV0dXJuOwoJCQl9CgkJCWVsc2UgaWYgKCB3aW5kb3cuY29uc29sZSAmJiBjb25zb2xlLmxvZyApCgkJCXsKCQkJCWNvbnNvbGUubG9nKCBzQWxlcnQgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZWUgaWYgYSBwcm9wZXJ0eSBpcyBkZWZpbmVkIG9uIG9uZSBvYmplY3QsIGlmIHNvIGFzc2lnbiBpdCB0byB0aGUgb3RoZXIgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvUmV0IHRhcmdldCBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TcmMgc291cmNlIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgcHJvcGVydHkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtzTWFwcGVkTmFtZV0gbmFtZSB0byBtYXAgdG9vIC0gb3B0aW9uYWwsIHNOYW1lIHVzZWQgaWYgbm90IGdpdmVuCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk1hcCggb1JldCwgb1NyYywgc05hbWUsIHNNYXBwZWROYW1lICkKCQl7CgkJCWlmICggc01hcHBlZE5hbWUgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXNNYXBwZWROYW1lID0gc05hbWU7CgkJCX0KCQkJaWYgKCBvU3JjW3NOYW1lXSAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJb1JldFtzTWFwcGVkTmFtZV0gPSBvU3JjW3NOYW1lXTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBFeHRlbmQgb2JqZWN0cyAtIHZlcnkgc2ltaWxhciB0byBqUXVlcnkuZXh0ZW5kLCBidXQgZGVlcCBjb3B5IG9iamVjdHMsIGFuZCBzaGFsbG93CgkJICogY29weSBhcnJheXMuIFRoZSByZWFzb24gd2UgbmVlZCB0byBkbyB0aGlzLCBpcyB0aGF0IHdlIGRvbid0IHdhbnQgdG8gZGVlcCBjb3B5IGFycmF5CgkJICogaW5pdCB2YWx1ZXMgKHN1Y2ggYXMgYWFTb3J0aW5nKSBzaW5jZSB0aGUgZGV2IHdvdWxkbid0IGJlIGFibGUgdG8gb3ZlcnJpZGUgdGhlbSwgYnV0CgkJICogd2UgZG8gd2FudCB0byBkZWVwIGNvcHkgYXJyYXlzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb091dCBPYmplY3QgdG8gZXh0ZW5kCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRXh0ZW5kZXIgT2JqZWN0IGZyb20gd2hpY2ggdGhlIHByb3BlcnRpZXMgd2lsbCBiZSBhcHBsaWVkIHRvIG9PdXQKCQkgKiAgQHJldHVybnMge29iamVjdH0gb091dCBSZWZlcmVuY2UsIGp1c3QgZm9yIGNvbnZlbmllbmNlIC0gb091dCA9PT0gdGhlIHJldHVybi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICogIEB0b2RvIFRoaXMgZG9lc24ndCB0YWtlIGFjY291bnQgb2YgYXJyYXlzIGluc2lkZSB0aGUgZGVlcCBjb3BpZWQgb2JqZWN0cy4KCQkgKi8KCQlmdW5jdGlvbiBfZm5FeHRlbmQoIG9PdXQsIG9FeHRlbmRlciApCgkJewoJCQl2YXIgdmFsOwoJCQkKCQkJZm9yICggdmFyIHByb3AgaW4gb0V4dGVuZGVyICkKCQkJewoJCQkJaWYgKCBvRXh0ZW5kZXIuaGFzT3duUHJvcGVydHkocHJvcCkgKQoJCQkJewoJCQkJCXZhbCA9IG9FeHRlbmRlcltwcm9wXTsKCQkKCQkJCQlpZiAoIHR5cGVvZiBvSW5pdFtwcm9wXSA9PT0gJ29iamVjdCcgJiYgdmFsICE9PSBudWxsICYmICQuaXNBcnJheSh2YWwpID09PSBmYWxzZSApCgkJCQkJewoJCQkJCQkkLmV4dGVuZCggdHJ1ZSwgb091dFtwcm9wXSwgdmFsICk7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCW9PdXRbcHJvcF0gPSB2YWw7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCXJldHVybiBvT3V0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBCaW5kIGFuIGV2ZW50IGhhbmRlcnMgdG8gYWxsb3cgYSBjbGljayBvciByZXR1cm4ga2V5IHRvIGFjdGl2YXRlIHRoZSBjYWxsYmFjay4KCQkgKiBUaGlzIGlzIGdvb2QgZm9yIGFjY2Vzc2liaWxpdHkgc2luY2UgYSByZXR1cm4gb24gdGhlIGtleWJvYXJkIHdpbGwgaGF2ZSB0aGUKCQkgKiBzYW1lIGVmZmVjdCBhcyBhIGNsaWNrLCBpZiB0aGUgZWxlbWVudCBoYXMgZm9jdXMuCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gbiBFbGVtZW50IHRvIGJpbmQgdGhlIGFjdGlvbiB0bwoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgRGF0YSBvYmplY3QgdG8gcGFzcyB0byB0aGUgdHJpZ2dlcmVkIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIENhbGxiYWNrIGZ1bmN0aW9uIGZvciB3aGVuIHRoZSBldmVudCBpcyB0cmlnZ2VyZWQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQmluZEFjdGlvbiggbiwgb0RhdGEsIGZuICkKCQl7CgkJCSQobikKCQkJCS5iaW5kKCAnY2xpY2suRFQnLCBvRGF0YSwgZnVuY3Rpb24gKGUpIHsKCQkJCQkJbi5ibHVyKCk7IC8vIFJlbW92ZSBmb2N1cyBvdXRsaW5lIGZvciBtb3VzZSB1c2VycwoJCQkJCQlmbihlKTsKCQkJCQl9ICkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBvRGF0YSwgZnVuY3Rpb24gKGUpewoJCQkJCWlmICggZS53aGljaCA9PT0gMTMgKSB7CgkJCQkJCWZuKGUpOwoJCQkJCX0gfSApCgkJCQkuYmluZCggJ3NlbGVjdHN0YXJ0LkRUJywgZnVuY3Rpb24gKCkgewoJCQkJCS8qIFRha2UgdGhlIGJydXRhbCBhcHByb2FjaCB0byBjYW5jZWxsaW5nIHRleHQgc2VsZWN0aW9uICovCgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVnaXN0ZXIgYSBjYWxsYmFjayBmdW5jdGlvbi4gRWFzaWx5IGFsbG93cyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGFkZGVkIHRvCgkJICogYW4gYXJyYXkgc3RvcmUgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIHRoYXQgY2FuIHRoZW4gYWxsIGJlIGNhbGxlZCB0b2dldGhlci4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1N0b3JlIE5hbWUgb2YgdGhlIGFycmF5IHN0b3JhZ2UgZm9yIHRoZSBjYWxsYmFja3MgaW4gb1NldHRpbmdzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiYWNrCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBJZGVudGlmeWluZyBuYW1lIGZvciB0aGUgY2FsbGJhY2sgKGkuZS4gYSBsYWJlbCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgc1N0b3JlLCBmbiwgc05hbWUgKQoJCXsKCQkJaWYgKCBmbiApCgkJCXsKCQkJCW9TZXR0aW5nc1tzU3RvcmVdLnB1c2goIHsKCQkJCQkiZm4iOiBmbiwKCQkJCQkic05hbWUiOiBzTmFtZQoJCQkJfSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpcmUgY2FsbGJhY2sgZnVuY3Rpb25zIGFuZCB0cmlnZ2VyIGV2ZW50cy4gTm90ZSB0aGF0IHRoZSBsb29wIG92ZXIgdGhlIGNhbGxiYWNrCgkJICogYXJyYXkgc3RvcmUgaXMgZG9uZSBiYWNrd2FyZHMhIEZ1cnRoZXIgbm90ZSB0aGF0IHlvdSBkbyBub3Qgd2FudCB0byBmaXJlIG9mZiB0cmlnZ2VycwoJCSAqIGluIHRpbWUgc2Vuc2l0aXZlIGFwcGxpY2F0aW9ucyAoZm9yIGV4YW1wbGUgY2VsbCBjcmVhdGlvbikgYXMgaXRzIHNsb3cuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTdG9yZSBOYW1lIG9mIHRoZSBhcnJheSBzdG9yYWdlIGZvciB0aGUgY2FsbGJhY2tzIGluIG9TZXR0aW5ncwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1RyaWdnZXIgTmFtZSBvZiB0aGUgalF1ZXJ5IGN1c3RvbSBldmVudCB0byB0cmlnZ2VyLiBJZiBudWxsIG5vIHRyaWdnZXIKCQkgKiAgICBpcyBmaXJlZAoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJncyBBcnJheSBvZiBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gLyB0cmlnZ2VyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCBzU3RvcmUsIHNUcmlnZ2VyLCBhQXJncyApCgkJewoJCQl2YXIgYW9TdG9yZSA9IG9TZXR0aW5nc1tzU3RvcmVdOwoJCQl2YXIgYVJldCA9W107CgkJCgkJCWZvciAoIHZhciBpPWFvU3RvcmUubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJewoJCQkJYVJldC5wdXNoKCBhb1N0b3JlW2ldLmZuLmFwcGx5KCBvU2V0dGluZ3Mub0luc3RhbmNlLCBhQXJncyApICk7CgkJCX0KCQkKCQkJaWYgKCBzVHJpZ2dlciAhPT0gbnVsbCApCgkJCXsKCQkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcihzVHJpZ2dlciwgYUFyZ3MpOwoJCQl9CgkJCgkJCXJldHVybiBhUmV0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBKU09OIHN0cmluZ2lmeS4gSWYgSlNPTi5zdHJpbmdpZnkgaXQgcHJvdmlkZWQgYnkgdGhlIGJyb3dzZXIsIGpzb24yLmpzIG9yIGFueSBvdGhlcgoJCSAqIGxpYnJhcnksIHRoZW4gd2UgdXNlIHRoYXQgYXMgaXQgaXMgZmFzdCwgc2FmZSBhbmQgYWNjdXJhdGUuIElmIHRoZSBmdW5jdGlvbiBpc24ndCAKCQkgKiBhdmFpbGFibGUgdGhlbiB3ZSBuZWVkIHRvIGJ1aWx0IGl0IG91cnNlbHZlcyAtIHRoZSBpbnNwaXJhdGlvbiBmb3IgdGhpcyBmdW5jdGlvbiBjb21lcwoJCSAqIGZyb20gQ3JhaWcgQnVja2xlciAoIGh0dHA6Ly93d3cuc2l0ZXBvaW50LmNvbS9qYXZhc2NyaXB0LWpzb24tc2VyaWFsaXphdGlvbi8gKS4gSXQgaXMKCQkgKiBub3QgcGVyZmVjdCBhbmQgYWJzb2x1dGVseSBzaG91bGQgbm90IGJlIHVzZWQgYXMgYSByZXBsYWNlbWVudCB0byBqc29uMi5qcyAtIGJ1dCBpdCBkb2VzCgkJICogZG8gd2hhdCB3ZSBuZWVkLCB3aXRob3V0IHJlcXVpcmluZyBhIGRlcGVuZGVuY3kgZm9yIERhdGFUYWJsZXMuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIEpTT04gb2JqZWN0IHRvIGJlIGNvbnZlcnRlZAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBKU09OIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQl2YXIgX2ZuSnNvblN0cmluZyA9ICh3aW5kb3cuSlNPTikgPyBKU09OLnN0cmluZ2lmeSA6IGZ1bmN0aW9uKCBvICkKCQl7CgkJCS8qIE5vdCBhbiBvYmplY3Qgb3IgYXJyYXkgKi8KCQkJdmFyIHNUeXBlID0gdHlwZW9mIG87CgkJCWlmIChzVHlwZSAhPT0gIm9iamVjdCIgfHwgbyA9PT0gbnVsbCkKCQkJewoJCQkJLy8gc2ltcGxlIGRhdGEgdHlwZQoJCQkJaWYgKHNUeXBlID09PSAic3RyaW5nIikKCQkJCXsKCQkJCQlvID0gJyInK28rJyInOwoJCQkJfQoJCQkJcmV0dXJuIG8rIiI7CgkJCX0KCQkKCQkJLyogSWYgb2JqZWN0IG9yIGFycmF5LCBuZWVkIHRvIHJlY3Vyc2Ugb3ZlciBpdCAqLwoJCQl2YXIKCQkJCXNQcm9wLCBtVmFsdWUsCgkJCQlqc29uID0gW10sCgkJCQliQXJyID0gJC5pc0FycmF5KG8pOwoJCQkKCQkJZm9yIChzUHJvcCBpbiBvKQoJCQl7CgkJCQltVmFsdWUgPSBvW3NQcm9wXTsKCQkJCXNUeXBlID0gdHlwZW9mIG1WYWx1ZTsKCQkKCQkJCWlmIChzVHlwZSA9PT0gInN0cmluZyIpCgkJCQl7CgkJCQkJbVZhbHVlID0gJyInK21WYWx1ZSsnIic7CgkJCQl9CgkJCQllbHNlIGlmIChzVHlwZSA9PT0gIm9iamVjdCIgJiYgbVZhbHVlICE9PSBudWxsKQoJCQkJewoJCQkJCW1WYWx1ZSA9IF9mbkpzb25TdHJpbmcobVZhbHVlKTsKCQkJCX0KCQkKCQkJCWpzb24ucHVzaCgoYkFyciA/ICIiIDogJyInK3NQcm9wKyciOicpICsgbVZhbHVlKTsKCQkJfQoJCQoJCQlyZXR1cm4gKGJBcnIgPyAiWyIgOiAieyIpICsganNvbiArIChiQXJyID8gIl0iIDogIn0iKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEZyb20gc29tZSBicm93c2VycyAoc3BlY2lmaWNhbGx5IElFNi83KSB3ZSBuZWVkIHNwZWNpYWwgaGFuZGxpbmcgdG8gd29yayBhcm91bmQgYnJvd3NlcgoJCSAqIGJ1Z3MgLSB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZGV0ZWN0IHdoZW4gdGhlc2Ugd29ya2Fyb3VuZHMgYXJlIG5lZWRlZC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ccm93c2VyRGV0ZWN0KCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogSUU2Lzcgd2lsbCBvdmVyc2l6ZSBhIHdpZHRoIDEwMCUgZWxlbWVudCBpbnNpZGUgYSBzY3JvbGxpbmcgZWxlbWVudCwgdG8gaW5jbHVkZSB0aGUKCQkJICogd2lkdGggb2YgdGhlIHNjcm9sbGJhciwgd2hpbGUgb3RoZXIgYnJvd3NlcnMgZW5zdXJlIHRoZSBpbm5lciBlbGVtZW50IGlzIGNvbnRhaW5lZAoJCQkgKiB3aXRob3V0IGZvcmNpbmcgc2Nyb2xsaW5nCgkJCSAqLwoJCQl2YXIgbiA9ICQoCgkJCQknPGRpdiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7IHRvcDowOyBsZWZ0OjA7IGhlaWdodDoxcHg7IHdpZHRoOjFweDsgb3ZlcmZsb3c6aGlkZGVuIj4nKwoJCQkJCSc8ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjFweDsgbGVmdDoxcHg7IHdpZHRoOjEwMHB4OyBvdmVyZmxvdzpzY3JvbGw7Ij4nKwoJCQkJCQknPGRpdiBpZD0iRFRfQnJvd3NlclRlc3QiIHN0eWxlPSJ3aWR0aDoxMDAlOyBoZWlnaHQ6MTBweDsiPjwvZGl2PicrCgkJCQkJJzwvZGl2PicrCgkJCQknPC9kaXY+JylbMF07CgkJCgkJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIG4gKTsKCQkJb1NldHRpbmdzLm9Ccm93c2VyLmJTY3JvbGxPdmVyc2l6ZSA9ICQoJyNEVF9Ccm93c2VyVGVzdCcsIG4pWzBdLm9mZnNldFdpZHRoID09PSAxMDAgPyB0cnVlIDogZmFsc2U7CgkJCWRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoIG4gKTsKCQl9CgkJCgoJCS8qKgoJCSAqIFBlcmZvcm0gYSBqUXVlcnkgc2VsZWN0b3IgYWN0aW9uIG9uIHRoZSB0YWJsZSdzIFRSIGVsZW1lbnRzIChmcm9tIHRoZSB0Ym9keSkgYW5kCgkJICogcmV0dXJuIHRoZSByZXN1bHRpbmcgalF1ZXJ5IG9iamVjdC4KCQkgKiAgQHBhcmFtIHtzdHJpbmd8bm9kZXxqUXVlcnl9IHNTZWxlY3RvciBqUXVlcnkgc2VsZWN0b3Igb3Igbm9kZSBjb2xsZWN0aW9uIHRvIGFjdCBvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gW29PcHRzXSBPcHRpb25hbCBwYXJhbWV0ZXJzIGZvciBtb2RpZnlpbmcgdGhlIHJvd3MgdG8gYmUgaW5jbHVkZWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5maWx0ZXI9bm9uZV0gU2VsZWN0IFRSIGVsZW1lbnRzIHRoYXQgbWVldCB0aGUgY3VycmVudCBmaWx0ZXIKCQkgKiAgICBjcml0ZXJpb24gKCJhcHBsaWVkIikgb3IgYWxsIFRSIGVsZW1lbnRzIChpLmUuIG5vIGZpbHRlcikuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMub3JkZXI9Y3VycmVudF0gT3JkZXIgb2YgdGhlIFRSIGVsZW1lbnRzIGluIHRoZSBwcm9jZXNzZWQgYXJyYXkuCgkJICogICAgQ2FuIGJlIGVpdGhlciAnY3VycmVudCcsIHdoZXJlYnkgdGhlIGN1cnJlbnQgc29ydGluZyBvZiB0aGUgdGFibGUgaXMgdXNlZCwgb3IKCQkgKiAgICAnb3JpZ2luYWwnIHdoZXJlYnkgdGhlIG9yaWdpbmFsIG9yZGVyIHRoZSBkYXRhIHdhcyByZWFkIGludG8gdGhlIHRhYmxlIGlzIHVzZWQuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMucGFnZT1hbGxdIExpbWl0IHRoZSBzZWxlY3Rpb24gdG8gdGhlIGN1cnJlbnRseSBkaXNwbGF5ZWQgcGFnZQoJCSAqICAgICgiY3VycmVudCIpIG9yIG5vdCAoImFsbCIpLiBJZiAnY3VycmVudCcgaXMgZ2l2ZW4sIHRoZW4gb3JkZXIgaXMgYXNzdW1lZCB0byBiZSAKCQkgKiAgICAnY3VycmVudCcgYW5kIGZpbHRlciBpcyAnYXBwbGllZCcsIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB0aGV5IG1pZ2h0IGJlIGdpdmVuIGFzLgoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBqUXVlcnkgb2JqZWN0LCBmaWx0ZXJlZCBieSB0aGUgZ2l2ZW4gc2VsZWN0b3IuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIC8vIEhpZ2hsaWdodCBldmVyeSBzZWNvbmQgcm93CgkJICogICAgICBvVGFibGUuJCgndHI6b2RkJykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnYmx1ZScpOwoJCSAqICAgIH0gKTsKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIC8vIEZpbHRlciB0byByb3dzIHdpdGggJ1dlYmtpdCcgaW4gdGhlbSwgYWRkIGEgYmFja2dyb3VuZCBjb2xvdXIgYW5kIHRoZW4KCQkgKiAgICAgIC8vIHJlbW92ZSB0aGUgZmlsdGVyLCB0aHVzIGhpZ2hsaWdodGluZyB0aGUgJ1dlYmtpdCcgcm93cyBvbmx5LgoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCdXZWJraXQnKTsKCQkgKiAgICAgIG9UYWJsZS4kKCd0cicsIHsiZmlsdGVyIjogImFwcGxpZWQifSkuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnYmx1ZScpOwoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCcnKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy4kID0gZnVuY3Rpb24gKCBzU2VsZWN0b3IsIG9PcHRzICkKCQl7CgkJCXZhciBpLCBpTGVuLCBhID0gW10sIHRyOwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGE7CgkJCXZhciBhaURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5OwoJCQl2YXIgYWlEaXNwbGF5TWFzdGVyID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcjsKCQkKCQkJaWYgKCAhb09wdHMgKQoJCQl7CgkJCQlvT3B0cyA9IHt9OwoJCQl9CgkJCgkJCW9PcHRzID0gJC5leHRlbmQoIHt9LCB7CgkJCQkiZmlsdGVyIjogIm5vbmUiLCAvLyBhcHBsaWVkCgkJCQkib3JkZXIiOiAiY3VycmVudCIsIC8vICJvcmlnaW5hbCIKCQkJCSJwYWdlIjogImFsbCIgLy8gY3VycmVudAoJCQl9LCBvT3B0cyApOwoJCQoJCQkvLyBDdXJyZW50IHBhZ2UgaW1wbGllcyB0aGF0IG9yZGVyPWN1cnJlbnQgYW5kIGZpdGxlcj1hcHBsaWVkLCBzaW5jZSBpdCBpcyBmYWlybHkKCQkJLy8gc2Vuc2VsZXNzIG90aGVyd2lzZQoJCQlpZiAoIG9PcHRzLnBhZ2UgPT0gJ2N1cnJlbnQnICkKCQkJewoJCQkJZm9yICggaT1vU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQsIGlMZW49b1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgYWlEaXNwbGF5W2ldIF0ublRyOwoJCQkJCWlmICggdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gImN1cnJlbnQiICYmIG9PcHRzLmZpbHRlciA9PSAibm9uZSIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YWlEaXNwbGF5TWFzdGVyLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGFpRGlzcGxheU1hc3RlcltpXSBdLm5UcjsKCQkJCQlpZiAoIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJjdXJyZW50IiAmJiBvT3B0cy5maWx0ZXIgPT0gImFwcGxpZWQiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFpRGlzcGxheS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBhaURpc3BsYXlbaV0gXS5uVHI7CgkJCQkJaWYgKCB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAib3JpZ2luYWwiICYmIG9PcHRzLmZpbHRlciA9PSAibm9uZSIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGkgXS5uVHIgOwoJCQkJCWlmICggdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gIm9yaWdpbmFsIiAmJiBvT3B0cy5maWx0ZXIgPT0gImFwcGxpZWQiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBpIF0ublRyOwoJCQkJCWlmICggJC5pbkFycmF5KCBpLCBhaURpc3BsYXkgKSAhPT0gLTEgJiYgdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mbkxvZyggb1NldHRpbmdzLCAxLCAiVW5rbm93biBzZWxlY3Rpb24gb3B0aW9ucyIgKTsKCQkJfQoJCQoJCQkvKiBXZSBuZWVkIHRvIGZpbHRlciBvbiB0aGUgVFIgZWxlbWVudHMgYW5kIGFsc28gJ2ZpbmQnIGluIHRoZWlyIGRlc2NlbmRhbnRzCgkJCSAqIHRvIG1ha2UgdGhlIHNlbGVjdG9yIGFjdCBsaWtlIGl0IHdvdWxkIGluIGEgZnVsbCB0YWJsZSAtIHNvIHdlIG5lZWQKCQkJICogdG8gYnVpbGQgYm90aCByZXN1bHRzIGFuZCB0aGVuIGNvbWJpbmUgdGhlbSB0b2dldGhlcgoJCQkgKi8KCQkJdmFyIGpxQSA9ICQoYSk7CgkJCXZhciBqcVRScyA9IGpxQS5maWx0ZXIoIHNTZWxlY3RvciApOwoJCQl2YXIganFEZXNjZW5kYW50cyA9IGpxQS5maW5kKCBzU2VsZWN0b3IgKTsKCQkKCQkJcmV0dXJuICQoIFtdLmNvbmNhdCgkLm1ha2VBcnJheShqcVRScyksICQubWFrZUFycmF5KGpxRGVzY2VuZGFudHMpKSApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQWxtb3N0IGlkZW50aWNhbCB0byAkIGluIG9wZXJhdGlvbiwgYnV0IGluIHRoaXMgY2FzZSByZXR1cm5zIHRoZSBkYXRhIGZvciB0aGUgbWF0Y2hlZAoJCSAqIHJvd3MgLSBhcyBzdWNoLCB0aGUgalF1ZXJ5IHNlbGVjdG9yIHVzZWQgc2hvdWxkIG1hdGNoIFRSIHJvdyBub2RlcyBvciBURC9USCBjZWxsIG5vZGVzCgkJICogcmF0aGVyIHRoYW4gYW55IGRlc2NlbmRhbnRzLCBzbyB0aGUgZGF0YSBjYW4gYmUgb2J0YWluZWQgZm9yIHRoZSByb3cvY2VsbC4gSWYgbWF0Y2hpbmcKCQkgKiByb3dzIGFyZSBmb3VuZCwgdGhlIGRhdGEgcmV0dXJuZWQgaXMgdGhlIG9yaWdpbmFsIGRhdGEgYXJyYXkvb2JqZWN0IHRoYXQgd2FzIHVzZWQgdG8gIAoJCSAqIGNyZWF0ZSB0aGUgcm93IChvciBhIGdlbmVyYXRlZCBhcnJheSBpZiBmcm9tIGEgRE9NIHNvdXJjZSkuCgkJICoKCQkgKiBUaGlzIG1ldGhvZCBpcyBvZnRlbiB1c2VmdWwgaW4tY29tYmluYXRpb24gd2l0aCAkIHdoZXJlIGJvdGggZnVuY3Rpb25zIGFyZSBnaXZlbiB0aGUKCQkgKiBzYW1lIHBhcmFtZXRlcnMgYW5kIHRoZSBhcnJheSBpbmRleGVzIHdpbGwgbWF0Y2ggaWRlbnRpY2FsbHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfG5vZGV8alF1ZXJ5fSBzU2VsZWN0b3IgalF1ZXJ5IHNlbGVjdG9yIG9yIG5vZGUgY29sbGVjdGlvbiB0byBhY3Qgb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IFtvT3B0c10gT3B0aW9uYWwgcGFyYW1ldGVycyBmb3IgbW9kaWZ5aW5nIHRoZSByb3dzIHRvIGJlIGluY2x1ZGVkCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMuZmlsdGVyPW5vbmVdIFNlbGVjdCBlbGVtZW50cyB0aGF0IG1lZXQgdGhlIGN1cnJlbnQgZmlsdGVyCgkJICogICAgY3JpdGVyaW9uICgiYXBwbGllZCIpIG9yIGFsbCBlbGVtZW50cyAoaS5lLiBubyBmaWx0ZXIpLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLm9yZGVyPWN1cnJlbnRdIE9yZGVyIG9mIHRoZSBkYXRhIGluIHRoZSBwcm9jZXNzZWQgYXJyYXkuCgkJICogICAgQ2FuIGJlIGVpdGhlciAnY3VycmVudCcsIHdoZXJlYnkgdGhlIGN1cnJlbnQgc29ydGluZyBvZiB0aGUgdGFibGUgaXMgdXNlZCwgb3IKCQkgKiAgICAnb3JpZ2luYWwnIHdoZXJlYnkgdGhlIG9yaWdpbmFsIG9yZGVyIHRoZSBkYXRhIHdhcyByZWFkIGludG8gdGhlIHRhYmxlIGlzIHVzZWQuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMucGFnZT1hbGxdIExpbWl0IHRoZSBzZWxlY3Rpb24gdG8gdGhlIGN1cnJlbnRseSBkaXNwbGF5ZWQgcGFnZQoJCSAqICAgICgiY3VycmVudCIpIG9yIG5vdCAoImFsbCIpLiBJZiAnY3VycmVudCcgaXMgZ2l2ZW4sIHRoZW4gb3JkZXIgaXMgYXNzdW1lZCB0byBiZSAKCQkgKiAgICAnY3VycmVudCcgYW5kIGZpbHRlciBpcyAnYXBwbGllZCcsIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB0aGV5IG1pZ2h0IGJlIGdpdmVuIGFzLgoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgZm9yIHRoZSBtYXRjaGVkIGVsZW1lbnRzLiBJZiBhbnkgZWxlbWVudHMsIGFzIGEgcmVzdWx0IG9mIHRoZQoJCSAqICAgIHNlbGVjdG9yLCB3ZXJlIG5vdCBUUiwgVEQgb3IgVEggZWxlbWVudHMgaW4gdGhlIERhdGFUYWJsZSwgdGhleSB3aWxsIGhhdmUgYSBudWxsIAoJCSAqICAgIGVudHJ5IGluIHRoZSBhcnJheS4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gR2V0IHRoZSBkYXRhIGZyb20gdGhlIGZpcnN0IHJvdyBpbiB0aGUgdGFibGUKCQkgKiAgICAgIHZhciBkYXRhID0gb1RhYmxlLl8oJ3RyOmZpcnN0Jyk7CgkJICoKCQkgKiAgICAgIC8vIERvIHNvbWV0aGluZyB1c2VmdWwgd2l0aCB0aGUgZGF0YQoJCSAqICAgICAgYWxlcnQoICJGaXJzdCBjZWxsIGlzOiAiK2RhdGFbMF0gKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICAvLyBGaWx0ZXIgdG8gJ1dlYmtpdCcgYW5kIGdldCBhbGwgZGF0YSBmb3IgCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJ1dlYmtpdCcpOwoJCSAqICAgICAgdmFyIGRhdGEgPSBvVGFibGUuXygndHInLCB7ImZpbHRlciI6ICJhcHBsaWVkIn0pOwoJCSAqICAgICAgCgkJICogICAgICAvLyBEbyBzb21ldGhpbmcgd2l0aCB0aGUgZGF0YQoJCSAqICAgICAgYWxlcnQoIGRhdGEubGVuZ3RoKyIgcm93cyBtYXRjaGVkIHRoZSBmaWx0ZXIiICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuXyA9IGZ1bmN0aW9uICggc1NlbGVjdG9yLCBvT3B0cyApCgkJewoJCQl2YXIgYU91dCA9IFtdOwoJCQl2YXIgaSwgaUxlbiwgaUluZGV4OwoJCQl2YXIgYVRycyA9IHRoaXMuJCggc1NlbGVjdG9yLCBvT3B0cyApOwoJCQoJCQlmb3IgKCBpPTAsIGlMZW49YVRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlhT3V0LnB1c2goIHRoaXMuZm5HZXREYXRhKGFUcnNbaV0pICk7CgkJCX0KCQkKCQkJcmV0dXJuIGFPdXQ7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBZGQgYSBzaW5nbGUgbmV3IHJvdyBvciBtdWx0aXBsZSByb3dzIG9mIGRhdGEgdG8gdGhlIHRhYmxlLiBQbGVhc2Ugbm90ZQoJCSAqIHRoYXQgdGhpcyBpcyBzdWl0YWJsZSBmb3IgY2xpZW50LXNpZGUgcHJvY2Vzc2luZyBvbmx5IC0gaWYgeW91IGFyZSB1c2luZyAKCQkgKiBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIChpLmUuICJiU2VydmVyU2lkZSI6IHRydWUpLCB0aGVuIHRvIGFkZCBkYXRhLCB5b3UKCQkgKiBtdXN0IGFkZCBpdCB0byB0aGUgZGF0YSBzb3VyY2UsIGkuZS4gdGhlIHNlcnZlci1zaWRlLCB0aHJvdWdoIGFuIEFqYXggY2FsbC4KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG1EYXRhIFRoZSBkYXRhIHRvIGJlIGFkZGVkIHRvIHRoZSB0YWJsZS4gVGhpcyBjYW4gYmU6CgkJICogICAgPHVsPgoJCSAqICAgICAgPGxpPjFEIGFycmF5IG9mIGRhdGEgLSBhZGQgYSBzaW5nbGUgcm93IHdpdGggdGhlIGRhdGEgcHJvdmlkZWQ8L2xpPgoJCSAqICAgICAgPGxpPjJEIGFycmF5IG9mIGFycmF5cyAtIGFkZCBtdWx0aXBsZSByb3dzIGluIGEgc2luZ2xlIGNhbGw8L2xpPgoJCSAqICAgICAgPGxpPm9iamVjdCAtIGRhdGEgb2JqZWN0IHdoZW4gdXNpbmcgPGk+bURhdGE8L2k+PC9saT4KCQkgKiAgICAgIDxsaT5hcnJheSBvZiBvYmplY3RzIC0gbXVsdGlwbGUgZGF0YSBvYmplY3RzIHdoZW4gdXNpbmcgPGk+bURhdGE8L2k+PC9saT4KCQkgKiAgICA8L3VsPgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIHJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEByZXR1cm5zIHthcnJheX0gQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlcHJlc2VudGluZyB0aGUgbGlzdCBvZiBpbmRleGVzIGluIAoJCSAqICAgIDxpPmFvRGF0YTwvaT4gKHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30pIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIAoJCSAqICAgIHRoZSB0YWJsZS4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2xvYmFsIHZhciBmb3IgY291bnRlcgoJCSAqICAgIHZhciBnaUNvdW50ID0gMjsKCQkgKiAgICAKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIGZuQ2xpY2tBZGRSb3coKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpLmZuQWRkRGF0YSggWwoJCSAqICAgICAgICBnaUNvdW50KyIuMSIsCgkJICogICAgICAgIGdpQ291bnQrIi4yIiwKCQkgKiAgICAgICAgZ2lDb3VudCsiLjMiLAoJCSAqICAgICAgICBnaUNvdW50KyIuNCIgXQoJCSAqICAgICAgKTsKCQkgKiAgICAgICAgCgkJICogICAgICBnaUNvdW50Kys7CgkJICogICAgfQoJCSAqLwoJCXRoaXMuZm5BZGREYXRhID0gZnVuY3Rpb24oIG1EYXRhLCBiUmVkcmF3ICkKCQl7CgkJCWlmICggbURhdGEubGVuZ3RoID09PSAwICkKCQkJewoJCQkJcmV0dXJuIFtdOwoJCQl9CgkJCQoJCQl2YXIgYWlSZXR1cm4gPSBbXTsKCQkJdmFyIGlUZXN0OwoJCQkKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQkvKiBDaGVjayBpZiB3ZSB3YW50IHRvIGFkZCBtdWx0aXBsZSByb3dzIG9yIG5vdCAqLwoJCQlpZiAoIHR5cGVvZiBtRGF0YVswXSA9PT0gIm9iamVjdCIgJiYgbURhdGFbMF0gIT09IG51bGwgKQoJCQl7CgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxtRGF0YS5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlUZXN0ID0gX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBtRGF0YVtpXSApOwoJCQkJCWlmICggaVRlc3QgPT0gLTEgKQoJCQkJCXsKCQkJCQkJcmV0dXJuIGFpUmV0dXJuOwoJCQkJCX0KCQkJCQlhaVJldHVybi5wdXNoKCBpVGVzdCApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaVRlc3QgPSBfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG1EYXRhICk7CgkJCQlpZiAoIGlUZXN0ID09IC0xICkKCQkJCXsKCQkJCQlyZXR1cm4gYWlSZXR1cm47CgkJCQl9CgkJCQlhaVJldHVybi5wdXNoKCBpVGVzdCApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mblJlRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJcmV0dXJuIGFpUmV0dXJuOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiB3aWxsIG1ha2UgRGF0YVRhYmxlcyByZWNhbGN1bGF0ZSB0aGUgY29sdW1uIHNpemVzLCBiYXNlZCBvbiB0aGUgZGF0YSAKCQkgKiBjb250YWluZWQgaW4gdGhlIHRhYmxlIGFuZCB0aGUgc2l6ZXMgYXBwbGllZCB0byB0aGUgY29sdW1ucyAoaW4gdGhlIERPTSwgQ1NTIG9yIAoJCSAqIHRocm91Z2ggdGhlIHNXaWR0aCBwYXJhbWV0ZXIpLiBUaGlzIGNhbiBiZSB1c2VmdWwgd2hlbiB0aGUgd2lkdGggb2YgdGhlIHRhYmxlJ3MgCgkJICogcGFyZW50IGVsZW1lbnQgY2hhbmdlcyAoZm9yIGV4YW1wbGUgYSB3aW5kb3cgcmVzaXplKS4KCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdCwgeW91IHdpbGwgdHlwaWNhbGx5IHdhbnQgdG8KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIG9UYWJsZS5mbkFkanVzdENvbHVtblNpemluZygpOwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuQWRqdXN0Q29sdW1uU2l6aW5nID0gZnVuY3Rpb24gKCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdKTsKCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQl0aGlzLmZuRHJhdyggZmFsc2UgKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiIHx8IG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCS8qIElmIG5vdCByZWRyYXdpbmcsIGJ1dCBzY3JvbGxpbmcsIHdlIHdhbnQgdG8gYXBwbHkgdGhlIG5ldyBjb2x1bW4gc2l6ZXMgYW55d2F5ICovCgkJCQl0aGlzLm9BcGkuX2ZuU2Nyb2xsRHJhdyhvU2V0dGluZ3MpOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBRdWlja2x5IGFuZCBzaW1wbHkgY2xlYXIgYSB0YWJsZQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIHJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEltbWVkaWF0ZWx5ICdudWtlJyB0aGUgY3VycmVudCByb3dzIChwZXJoYXBzIHdhaXRpbmcgZm9yIGFuIEFqYXggY2FsbGJhY2suLi4pCgkJICogICAgICBvVGFibGUuZm5DbGVhclRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5DbGVhclRhYmxlID0gZnVuY3Rpb24oIGJSZWRyYXcgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCV9mbkNsZWFyVGFibGUoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGUgZXhhY3Qgb3Bwb3NpdGUgb2YgJ29wZW5pbmcnIGEgcm93LCB0aGlzIGZ1bmN0aW9uIHdpbGwgY2xvc2UgYW55IHJvd3Mgd2hpY2ggCgkJICogYXJlIGN1cnJlbnRseSAnb3BlbicuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIHRoZSB0YWJsZSByb3cgdG8gJ2Nsb3NlJwoJCSAqICBAcmV0dXJucyB7aW50fSAwIG9uIHN1Y2Nlc3MsIG9yIDEgaWYgZmFpbGVkIChjYW4ndCBmaW5kIHRoZSByb3cpCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkNsb3NlID0gZnVuY3Rpb24oIG5UciApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublBhcmVudCA9PSBuVHIgKQoJCQkJewoJCQkJCXZhciBuVHJQYXJlbnQgPSBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIucGFyZW50Tm9kZTsKCQkJCQlpZiAoIG5UclBhcmVudCApCgkJCQkJewoJCQkJCQkvKiBSZW1vdmUgaXQgaWYgaXQgaXMgY3VycmVudGx5IG9uIGRpc3BsYXkgKi8KCQkJCQkJblRyUGFyZW50LnJlbW92ZUNoaWxkKCBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIgKTsKCQkJCQl9CgkJCQkJb1NldHRpbmdzLmFvT3BlblJvd3Muc3BsaWNlKCBpLCAxICk7CgkJCQkJcmV0dXJuIDA7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIDE7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBSZW1vdmUgYSByb3cgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge21peGVkfSBtVGFyZ2V0IFRoZSBpbmRleCBvZiB0aGUgcm93IGZyb20gYW9EYXRhIHRvIGJlIGRlbGV0ZWQsIG9yCgkJICogICAgdGhlIFRSIGVsZW1lbnQgeW91IHdhbnQgdG8gZGVsZXRlCgkJICogIEBwYXJhbSB7ZnVuY3Rpb258bnVsbH0gW2ZuQ2FsbEJhY2tdIENhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBUaGUgcm93IHRoYXQgd2FzIGRlbGV0ZWQKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSW1tZWRpYXRlbHkgcmVtb3ZlIHRoZSBmaXJzdCByb3cKCQkgKiAgICAgIG9UYWJsZS5mbkRlbGV0ZVJvdyggMCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRGVsZXRlUm93ID0gZnVuY3Rpb24oIG1UYXJnZXQsIGZuQ2FsbEJhY2ssIGJSZWRyYXcgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuLCBpQU9EYXRhSW5kZXg7CgkJCQoJCQlpQU9EYXRhSW5kZXggPSAodHlwZW9mIG1UYXJnZXQgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVRhcmdldCkgOiBtVGFyZ2V0OwoJCQkKCQkJLyogUmV0dXJuIHRoZSBkYXRhIGFycmF5IGZyb20gdGhpcyByb3cgKi8KCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmFvRGF0YS5zcGxpY2UoIGlBT0RhdGFJbmRleCwgMSApOwoJCQoJCQkvKiBVcGRhdGUgdGhlIF9EVF9Sb3dJbmRleCBwYXJhbWV0ZXIgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIuX0RUX1Jvd0luZGV4ID0gaTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSB0YXJnZXQgcm93IGZyb20gdGhlIHNlYXJjaCBhcnJheSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaUFPRGF0YUluZGV4LCBvU2V0dGluZ3MuYWlEaXNwbGF5ICk7CgkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2guc3BsaWNlKCBpRGlzcGxheUluZGV4LCAxICk7CgkJCQoJCQkvKiBEZWxldGUgZnJvbSB0aGUgZGlzcGxheSBhcnJheXMgKi8KCQkJX2ZuRGVsZXRlSW5kZXgoIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIsIGlBT0RhdGFJbmRleCApOwoJCQlfZm5EZWxldGVJbmRleCggb1NldHRpbmdzLmFpRGlzcGxheSwgaUFPRGF0YUluZGV4ICk7CgkJCQoJCQkvKiBJZiB0aGVyZSBpcyBhIHVzZXIgY2FsbGJhY2sgZnVuY3Rpb24gLSBjYWxsIGl0ICovCgkJCWlmICggdHlwZW9mIGZuQ2FsbEJhY2sgPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlmbkNhbGxCYWNrLmNhbGwoIHRoaXMsIG9TZXR0aW5ncywgb0RhdGEgKTsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgZm9yIGFuICdvdmVyZmxvdycgdGhleSBjYXNlIGZvciBkaXNwbGF5aW5nIHRoZSB0YWJsZSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA+PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IC09IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA8IDAgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCXJldHVybiBvRGF0YTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFJlc3RvcmUgdGhlIHRhYmxlIHRvIGl0J3Mgb3JpZ2luYWwgc3RhdGUgaW4gdGhlIERPTSBieSByZW1vdmluZyBhbGwgb2YgRGF0YVRhYmxlcyAKCQkgKiBlbmhhbmNlbWVudHMsIGFsdGVyYXRpb25zIHRvIHRoZSBET00gc3RydWN0dXJlIG9mIHRoZSB0YWJsZSBhbmQgZXZlbnQgbGlzdGVuZXJzLgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiUmVtb3ZlPWZhbHNlXSBDb21wbGV0ZWx5IHJlbW92ZSB0aGUgdGFibGUgZnJvbSB0aGUgRE9NCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgLy8gVGhpcyBleGFtcGxlIGlzIGZhaXJseSBwb2ludGxlc3MgaW4gcmVhbGl0eSwgYnV0IHNob3dzIGhvdyBmbkRlc3Ryb3kgY2FuIGJlIHVzZWQKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuRGVzdHJveSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRGVzdHJveSA9IGZ1bmN0aW9uICggYlJlbW92ZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIG5PcmlnID0gb1NldHRpbmdzLm5UYWJsZVdyYXBwZXIucGFyZW50Tm9kZTsKCQkJdmFyIG5Cb2R5ID0gb1NldHRpbmdzLm5UQm9keTsKCQkJdmFyIGksIGlMZW47CgkJCgkJCWJSZW1vdmUgPSAoYlJlbW92ZT09PXVuZGVmaW5lZCkgPyBmYWxzZSA6IGJSZW1vdmU7CgkJCQoJCQkvKiBGbGFnIHRvIG5vdGUgdGhhdCB0aGUgdGFibGUgaXMgY3VycmVudGx5IGJlaW5nIGRlc3Ryb3llZCAtIG5vIGFjdGlvbiBzaG91bGQgYmUgdGFrZW4gKi8KCQkJb1NldHRpbmdzLmJEZXN0cm95aW5nID0gdHJ1ZTsKCQkJCgkJCS8qIEZpcmUgb2ZmIHRoZSBkZXN0cm95IGNhbGxiYWNrcyBmb3IgcGx1Zy1pbnMgZXRjICovCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAiYW9EZXN0cm95Q2FsbGJhY2siLCAiZGVzdHJveSIsIFtvU2V0dGluZ3NdICk7CgkJCgkJCS8qIElmIHRoZSB0YWJsZSBpcyBub3QgYmVpbmcgcmVtb3ZlZCwgcmVzdG9yZSB0aGUgaGlkZGVuIGNvbHVtbnMgKi8KCQkJaWYgKCAhYlJlbW92ZSApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSBmYWxzZSApCgkJCQkJewoJCQkJCQl0aGlzLmZuU2V0Q29sdW1uVmlzKCBpLCB0cnVlICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBCbGl0eiBhbGwgRFQgZXZlbnRzICovCgkJCSQob1NldHRpbmdzLm5UYWJsZVdyYXBwZXIpLmZpbmQoJyonKS5hbmRTZWxmKCkudW5iaW5kKCcuRFQnKTsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGFuICdlbXB0eScgaW5kaWNhdG9yIHJvdywgcmVtb3ZlIGl0ICovCgkJCSQoJ3Rib2R5PnRyPnRkLicrb1NldHRpbmdzLm9DbGFzc2VzLnNSb3dFbXB0eSwgb1NldHRpbmdzLm5UYWJsZSkucGFyZW50KCkucmVtb3ZlKCk7CgkJCQoJCQkvKiBXaGVuIHNjcm9sbGluZyB3ZSBoYWQgdG8gYnJlYWsgdGhlIHRhYmxlIHVwIC0gcmVzdG9yZSBpdCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5uVGFibGUgIT0gb1NldHRpbmdzLm5USGVhZC5wYXJlbnROb2RlICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbigndGhlYWQnKS5yZW1vdmUoKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEhlYWQgKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICYmIG9TZXR0aW5ncy5uVGFibGUgIT0gb1NldHRpbmdzLm5URm9vdC5wYXJlbnROb2RlICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbigndGZvb3QnKS5yZW1vdmUoKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEZvb3QgKTsKCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSBEYXRhVGFibGVzIGdlbmVyYXRlZCBub2RlcywgZXZlbnRzIGFuZCBjbGFzc2VzICovCgkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQkkKG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyKS5yZW1vdmUoKTsKCQkJCgkJCW9TZXR0aW5ncy5hYVNvcnRpbmcgPSBbXTsKCQkJb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkID0gW107CgkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJCgkJCSQoX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICkpLnJlbW92ZUNsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmpvaW4oJyAnKSApOwoJCQkKCQkJJCgndGgsIHRkJywgb1NldHRpbmdzLm5USGVhZCkucmVtb3ZlQ2xhc3MoIFsKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlQXNjLAoJCQkJb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZURlc2MsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZSBdLmpvaW4oJyAnKQoJCQkpOwoJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJewoJCQkJJCgndGggc3Bhbi4nK29TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb24KCQkJCQkrICcsIHRkIHNwYW4uJytvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRJY29uLCBvU2V0dGluZ3MublRIZWFkKS5yZW1vdmUoKTsKCQkKCQkJCSQoJ3RoLCB0ZCcsIG9TZXR0aW5ncy5uVEhlYWQpLmVhY2goIGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIganFXcmFwcGVyID0gJCgnZGl2Licrb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJV3JhcHBlciwgdGhpcyk7CgkJCQkJdmFyIGtpZHMgPSBqcVdyYXBwZXIuY29udGVudHMoKTsKCQkJCQkkKHRoaXMpLmFwcGVuZCgga2lkcyApOwoJCQkJCWpxV3JhcHBlci5yZW1vdmUoKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWRkIHRoZSBUUiBlbGVtZW50cyBiYWNrIGludG8gdGhlIHRhYmxlIGluIHRoZWlyIG9yaWdpbmFsIG9yZGVyICovCgkJCWlmICggIWJSZW1vdmUgJiYgb1NldHRpbmdzLm5UYWJsZVJlaW5zZXJ0QmVmb3JlICkKCQkJewoJCQkJbk9yaWcuaW5zZXJ0QmVmb3JlKCBvU2V0dGluZ3MublRhYmxlLCBvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgKTsKCQkJfQoJCQllbHNlIGlmICggIWJSZW1vdmUgKQoJCQl7CgkJCQluT3JpZy5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQl9CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCW5Cb2R5LmFwcGVuZENoaWxkKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBSZXN0b3JlIHRoZSB3aWR0aCBvZiB0aGUgb3JpZ2luYWwgdGFibGUgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJBdXRvV2lkdGggPT09IHRydWUgKQoJCQl7CgkJCSAgb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKG9TZXR0aW5ncy5zRGVzdHJveVdpZHRoKTsKCQkJfQoJCQkKCQkJLyogSWYgdGhlIHdlcmUgb3JpZ2luYWxseSBzdHJpcGUgY2xhc3NlcyAtIHRoZW4gd2UgYWRkIHRoZW0gYmFjayBoZXJlLiBOb3RlCgkJCSAqIHRoaXMgaXMgbm90IGZvb2wgcHJvb2YgKGZvciBleGFtcGxlIGlmIG5vdCBhbGwgcm93cyBoYWQgc3RyaXBlIGNsYXNzZXMgLSBidXQKCQkJICogaXQncyBhIGdvb2QgZWZmb3J0IHdpdGhvdXQgZ2V0dGluZyBjYXJyaWVkIGF3YXkKCQkJICovCgkJCWlMZW4gPSBvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlcy5sZW5ndGg7CgkJCWlmIChpTGVuKQoJCQl7CgkJCQl2YXIgYW5Sb3dzID0gJChuQm9keSkuY2hpbGRyZW4oJ3RyJyk7CgkJCQlmb3IgKCBpPTAgOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFuUm93cy5maWx0ZXIoJzpudGgtY2hpbGQoJyArIGlMZW4gKyAnbiArICcgKyBpICsgJyknKS5hZGRDbGFzcyggb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbaV0gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSBzZXR0aW5ncyBvYmplY3QgZnJvbSB0aGUgc2V0dGluZ3MgYXJyYXkgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXSA9PSBvU2V0dGluZ3MgKQoJCQkJewoJCQkJCURhdGFUYWJsZS5zZXR0aW5ncy5zcGxpY2UoIGksIDEgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRW5kIGl0IGFsbCAqLwoJCQlvU2V0dGluZ3MgPSBudWxsOwoJCQlvSW5pdCA9IG51bGw7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBSZWRyYXcgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JDb21wbGV0ZT10cnVlXSBSZS1maWx0ZXIgYW5kIHJlc29ydCAoaWYgZW5hYmxlZCkgdGhlIHRhYmxlIGJlZm9yZSB0aGUgZHJhdy4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gUmUtZHJhdyB0aGUgdGFibGUgLSB5b3Ugd291bGRuJ3Qgd2FudCB0byBkbyBpdCBoZXJlLCBidXQgaXQncyBhbiBleGFtcGxlIDotKQoJCSAqICAgICAgb1RhYmxlLmZuRHJhdygpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRHJhdyA9IGZ1bmN0aW9uKCBiQ29tcGxldGUgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCWlmICggYkNvbXBsZXRlID09PSBmYWxzZSApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mblJlRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgaW5wdXQgYmFzZWQgb24gZGF0YQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IFN0cmluZyB0byBmaWx0ZXIgdGhlIHRhYmxlIG9uCgkJICogIEBwYXJhbSB7aW50fG51bGx9IFtpQ29sdW1uXSBDb2x1bW4gdG8gbGltaXQgZmlsdGVyaW5nIHRvCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWdleD1mYWxzZV0gVHJlYXQgYXMgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiU21hcnQ9dHJ1ZV0gUGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JTaG93R2xvYmFsPXRydWVdIFNob3cgdGhlIGlucHV0IGdsb2JhbCBmaWx0ZXIgaW4gaXQncyBpbnB1dCBib3goZXMpCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JDYXNlSW5zZW5zaXRpdmU9dHJ1ZV0gRG8gY2FzZS1pbnNlbnNpdGl2ZSBtYXRjaGluZyAodHJ1ZSkgb3Igbm90IChmYWxzZSkKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29tZXRpbWUgbGF0ZXIgLSBmaWx0ZXIuLi4KCQkgKiAgICAgIG9UYWJsZS5mbkZpbHRlciggJ3Rlc3Qgc3RyaW5nJyApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRmlsdGVyID0gZnVuY3Rpb24oIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJTaG93R2xvYmFsLCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQlpZiAoIGJSZWdleCA9PT0gdW5kZWZpbmVkIHx8IGJSZWdleCA9PT0gbnVsbCApCgkJCXsKCQkJCWJSZWdleCA9IGZhbHNlOwoJCQl9CgkJCQoJCQlpZiAoIGJTbWFydCA9PT0gdW5kZWZpbmVkIHx8IGJTbWFydCA9PT0gbnVsbCApCgkJCXsKCQkJCWJTbWFydCA9IHRydWU7CgkJCX0KCQkJCgkJCWlmICggYlNob3dHbG9iYWwgPT09IHVuZGVmaW5lZCB8fCBiU2hvd0dsb2JhbCA9PT0gbnVsbCApCgkJCXsKCQkJCWJTaG93R2xvYmFsID0gdHJ1ZTsKCQkJfQoJCQkKCQkJaWYgKCBiQ2FzZUluc2Vuc2l0aXZlID09PSB1bmRlZmluZWQgfHwgYkNhc2VJbnNlbnNpdGl2ZSA9PT0gbnVsbCApCgkJCXsKCQkJCWJDYXNlSW5zZW5zaXRpdmUgPSB0cnVlOwoJCQl9CgkJCQoJCQlpZiAoIGlDb2x1bW4gPT09IHVuZGVmaW5lZCB8fCBpQ29sdW1uID09PSBudWxsICkKCQkJewoJCQkJLyogR2xvYmFsIGZpbHRlciAqLwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgewoJCQkJCSJzU2VhcmNoIjpzSW5wdXQrIiIsCgkJCQkJImJSZWdleCI6IGJSZWdleCwKCQkJCQkiYlNtYXJ0IjogYlNtYXJ0LAoJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogYkNhc2VJbnNlbnNpdGl2ZQoJCQkJfSwgMSApOwoJCQkJCgkJCQlpZiAoIGJTaG93R2xvYmFsICYmIG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mICkKCQkJCXsKCQkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJCXsKCQkJCQkJLy8gSUU5IHRocm93cyBhbiAndW5rbm93biBlcnJvcicgaWYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpcyB1c2VkCgkJCQkJCS8vIGluc2lkZSBhbiBpZnJhbWUgb3IgZnJhbWUuLi4KCQkJCQkJdHJ5IHsKCQkJCQkJCWlmICggbltpXS5fRFRfSW5wdXQgIT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCApCgkJCQkJCQl7CgkJCQkJCQkJJChuW2ldLl9EVF9JbnB1dCkudmFsKCBzSW5wdXQgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljYXRjaCAoIGUgKSB7CgkJCQkJCQkkKG5baV0uX0RUX0lucHV0KS52YWwoIHNJbnB1dCApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2luZ2xlIGNvbHVtbiBmaWx0ZXIgKi8KCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sdW1uIF0sIHsKCQkJCQkic1NlYXJjaCI6IHNJbnB1dCsiIiwKCQkJCQkiYlJlZ2V4IjogYlJlZ2V4LAoJCQkJCSJiU21hcnQiOiBiU21hcnQsCgkJCQkJImJDYXNlSW5zZW5zaXRpdmUiOiBiQ2FzZUluc2Vuc2l0aXZlCgkJCQl9ICk7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgZGF0YSBmb3IgdGhlIHdob2xlIHRhYmxlLCBhbiBpbmRpdmlkdWFsIHJvdyBvciBhbiBpbmRpdmlkdWFsIGNlbGwgYmFzZWQgb24gdGhlIAoJCSAqIHByb3ZpZGVkIHBhcmFtZXRlcnMuCgkJICogIEBwYXJhbSB7aW50fG5vZGV9IFttUm93XSBBIFRSIHJvdyBub2RlLCBURC9USCBjZWxsIG5vZGUgb3IgYW4gaW50ZWdlci4gSWYgZ2l2ZW4gYXMKCQkgKiAgICBhIFRSIG5vZGUgdGhlbiB0aGUgZGF0YSBzb3VyY2UgZm9yIHRoZSB3aG9sZSByb3cgd2lsbCBiZSByZXR1cm5lZC4gSWYgZ2l2ZW4gYXMgYQoJCSAqICAgIFREL1RIIGNlbGwgbm9kZSB0aGVuIGlDb2wgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQgYW5kIHRoZSBkYXRhIGZvciB0aGUKCQkgKiAgICBjZWxsIHJldHVybmVkLiBJZiBnaXZlbiBhcyBhbiBpbnRlZ2VyLCB0aGVuIHRoaXMgaXMgdHJlYXRlZCBhcyB0aGUgYW9EYXRhIGludGVybmFsCgkJICogICAgZGF0YSBpbmRleCBmb3IgdGhlIHJvdyAoc2VlIGZuR2V0UG9zaXRpb24pIGFuZCB0aGUgZGF0YSBmb3IgdGhhdCByb3cgdXNlZC4KCQkgKiAgQHBhcmFtIHtpbnR9IFtpQ29sXSBPcHRpb25hbCBjb2x1bW4gaW5kZXggdGhhdCB5b3Ugd2FudCB0aGUgZGF0YSBvZi4KCQkgKiAgQHJldHVybnMge2FycmF5fG9iamVjdHxzdHJpbmd9IElmIG1Sb3cgaXMgdW5kZWZpbmVkLCB0aGVuIHRoZSBkYXRhIGZvciBhbGwgcm93cyBpcwoJCSAqICAgIHJldHVybmVkLiBJZiBtUm93IGlzIGRlZmluZWQsIGp1c3QgZGF0YSBmb3IgdGhhdCByb3csIGFuZCBpcyBpQ29sIGlzCgkJICogICAgZGVmaW5lZCwgb25seSBkYXRhIGZvciB0aGUgZGVzaWduYXRlZCBjZWxsIGlzIHJldHVybmVkLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSb3cgZGF0YQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgb1RhYmxlLiQoJ3RyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgdmFyIGRhdGEgPSBvVGFibGUuZm5HZXREYXRhKCB0aGlzICk7CgkJICogICAgICAgIC8vIC4uLiBkbyBzb21ldGhpbmcgd2l0aCB0aGUgYXJyYXkgLyBvYmplY3Qgb2YgZGF0YSBmb3IgdGhlIHJvdwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEluZGl2aWR1YWwgY2VsbCBkYXRhCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICBvVGFibGUuJCgndGQnKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICB2YXIgc0RhdGEgPSBvVGFibGUuZm5HZXREYXRhKCB0aGlzICk7CgkJICogICAgICAgIGFsZXJ0KCAnVGhlIGNlbGwgY2xpY2tlZCBvbiBoYWQgdGhlIHZhbHVlIG9mICcrc0RhdGEgKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkdldERhdGEgPSBmdW5jdGlvbiggbVJvdywgaUNvbCApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggbVJvdyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJdmFyIGlSb3cgPSBtUm93OwoJCQkJaWYgKCB0eXBlb2YgbVJvdyA9PT0gJ29iamVjdCcgKQoJCQkJewoJCQkJCXZhciBzTm9kZSA9IG1Sb3cubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJCQlpZiAoc05vZGUgPT09ICJ0ciIgKQoJCQkJCXsKCQkJCQkJaVJvdyA9IF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1Sb3cpOwoJCQkJCX0KCQkJCQllbHNlIGlmICggc05vZGUgPT09ICJ0ZCIgKQoJCQkJCXsKCQkJCQkJaVJvdyA9IF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1Sb3cucGFyZW50Tm9kZSk7CgkJCQkJCWlDb2wgPSBfZm5Ob2RlVG9Db2x1bW5JbmRleCggb1NldHRpbmdzLCBpUm93LCBtUm93ICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJaWYgKCBpQ29sICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCXJldHVybiBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCAnJyApOwoJCQkJfQoJCQkJcmV0dXJuIChvU2V0dGluZ3MuYW9EYXRhW2lSb3ddIT09dW5kZWZpbmVkKSA/CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgOiBudWxsOwoJCQl9CgkJCXJldHVybiBfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiB0aGUgVFIgbm9kZXMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUncyBib2R5LiBOb3RlIHRoYXQgeW91IHdpbGwgCgkJICogdHlwaWNhbGx5IHdhbnQgdG8gdXNlIHRoZSAnJCcgQVBJIG1ldGhvZCBpbiBwcmVmZXJlbmNlIHRvIHRoaXMgYXMgaXQgaXMgbW9yZSAKCQkgKiBmbGV4aWJsZS4KCQkgKiAgQHBhcmFtIHtpbnR9IFtpUm93XSBPcHRpb25hbCByb3cgaW5kZXggZm9yIHRoZSBUUiBlbGVtZW50IHlvdSB3YW50CgkJICogIEByZXR1cm5zIHthcnJheXxub2RlfSBJZiBpUm93IGlzIHVuZGVmaW5lZCwgcmV0dXJucyBhbiBhcnJheSBvZiBhbGwgVFIgZWxlbWVudHMKCQkgKiAgICBpbiB0aGUgdGFibGUncyBib2R5LCBvciBpUm93IGlzIGRlZmluZWQsIGp1c3QgdGhlIFRSIGVsZW1lbnQgcmVxdWVzdGVkLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBHZXQgdGhlIG5vZGVzIGZyb20gdGhlIHRhYmxlCgkJICogICAgICB2YXIgbk5vZGVzID0gb1RhYmxlLmZuR2V0Tm9kZXMoICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXROb2RlcyA9IGZ1bmN0aW9uKCBpUm93ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJaWYgKCBpUm93ICE9PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gKG9TZXR0aW5ncy5hb0RhdGFbaVJvd10hPT11bmRlZmluZWQpID8KCQkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLm5UciA6IG51bGw7CgkJCX0KCQkJcmV0dXJuIF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBhcnJheSBpbmRleGVzIG9mIGEgcGFydGljdWxhciBjZWxsIGZyb20gaXQncyBET00gZWxlbWVudAoJCSAqIGFuZCBjb2x1bW4gaW5kZXggaW5jbHVkaW5nIGhpZGRlbiBjb2x1bW5zCgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgdGhpcyBjYW4gZWl0aGVyIGJlIGEgVFIsIFREIG9yIFRIIGluIHRoZSB0YWJsZSdzIGJvZHkKCQkgKiAgQHJldHVybnMge2ludH0gSWYgbk5vZGUgaXMgZ2l2ZW4gYXMgYSBUUiwgdGhlbiBhIHNpbmdsZSBpbmRleCBpcyByZXR1cm5lZCwgb3IKCQkgKiAgICBpZiBnaXZlbiBhcyBhIGNlbGwsIGFuIGFycmF5IG9mIFtyb3cgaW5kZXgsIGNvbHVtbiBpbmRleCAodmlzaWJsZSksIAoJCSAqICAgIGNvbHVtbiBpbmRleCAoYWxsKV0gaXMgZ2l2ZW4uCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdGQnKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICAvLyBHZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBjdXJyZW50IGRhdGEgZnJvbSB0aGUgbm9kZQoJCSAqICAgICAgICB2YXIgYVBvcyA9IG9UYWJsZS5mbkdldFBvc2l0aW9uKCB0aGlzICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBHZXQgdGhlIGRhdGEgYXJyYXkgZm9yIHRoaXMgcm93CgkJICogICAgICAgIHZhciBhRGF0YSA9IG9UYWJsZS5mbkdldERhdGEoIGFQb3NbMF0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIFVwZGF0ZSB0aGUgZGF0YSBhcnJheSBhbmQgcmV0dXJuIHRoZSB2YWx1ZQoJCSAqICAgICAgICBhRGF0YVsgYVBvc1sxXSBdID0gJ2NsaWNrZWQnOwoJCSAqICAgICAgICB0aGlzLmlubmVySFRNTCA9ICdjbGlja2VkJzsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSW5pdCBEYXRhVGFibGVzCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuR2V0UG9zaXRpb24gPSBmdW5jdGlvbiggbk5vZGUgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBzTm9kZU5hbWUgPSBuTm9kZS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpOwoJCQkKCQkJaWYgKCBzTm9kZU5hbWUgPT0gIlRSIiApCgkJCXsKCQkJCXJldHVybiBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBuTm9kZSk7CgkJCX0KCQkJZWxzZSBpZiAoIHNOb2RlTmFtZSA9PSAiVEQiIHx8IHNOb2RlTmFtZSA9PSAiVEgiICkKCQkJewoJCQkJdmFyIGlEYXRhSW5kZXggPSBfZm5Ob2RlVG9EYXRhSW5kZXgoIG9TZXR0aW5ncywgbk5vZGUucGFyZW50Tm9kZSApOwoJCQkJdmFyIGlDb2x1bW5JbmRleCA9IF9mbk5vZGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlEYXRhSW5kZXgsIG5Ob2RlICk7CgkJCQlyZXR1cm4gWyBpRGF0YUluZGV4LCBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZShvU2V0dGluZ3MsIGlDb2x1bW5JbmRleCApLCBpQ29sdW1uSW5kZXggXTsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIENoZWNrIHRvIHNlZSBpZiBhIHJvdyBpcyAnb3Blbicgb3Igbm90LgoJCSAqICBAcGFyYW0ge25vZGV9IG5UciB0aGUgdGFibGUgcm93IHRvIGNoZWNrCgkJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoZSByb3cgaXMgY3VycmVudGx5IG9wZW4sIGZhbHNlIG90aGVyd2lzZQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGU7CgkJICogICAgICAKCQkgKiAgICAgIC8vICdvcGVuJyBhbiBpbmZvcm1hdGlvbiByb3cgd2hlbiBhIHJvdyBpcyBjbGlja2VkIG9uCgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGlmICggb1RhYmxlLmZuSXNPcGVuKHRoaXMpICkgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbkNsb3NlKCB0aGlzICk7CgkJICogICAgICAgIH0gZWxzZSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuT3BlbiggdGhpcywgIlRlbXBvcmFyeSByb3cgb3BlbmVkIiwgImluZm9fcm93IiApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5Jc09wZW4gPSBmdW5jdGlvbiggblRyICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgYW9PcGVuUm93cyA9IG9TZXR0aW5ncy5hb09wZW5Sb3dzOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uUGFyZW50ID09IG5UciApCgkJCQl7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIGZhbHNlOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiB3aWxsIHBsYWNlIGEgbmV3IHJvdyBkaXJlY3RseSBhZnRlciBhIHJvdyB3aGljaCBpcyBjdXJyZW50bHkgCgkJICogb24gZGlzcGxheSBvbiB0aGUgcGFnZSwgd2l0aCB0aGUgSFRNTCBjb250ZW50cyB0aGF0IGlzIHBhc3NlZCBpbnRvIHRoZSAKCQkgKiBmdW5jdGlvbi4gVGhpcyBjYW4gYmUgdXNlZCwgZm9yIGV4YW1wbGUsIHRvIGFzayBmb3IgY29uZmlybWF0aW9uIHRoYXQgYSAKCQkgKiBwYXJ0aWN1bGFyIHJlY29yZCBzaG91bGQgYmUgZGVsZXRlZC4KCQkgKiAgQHBhcmFtIHtub2RlfSBuVHIgVGhlIHRhYmxlIHJvdyB0byAnb3BlbicKCQkgKiAgQHBhcmFtIHtzdHJpbmd8bm9kZXxqUXVlcnl9IG1IdG1sIFRoZSBIVE1MIHRvIHB1dCBpbnRvIHRoZSByb3cKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNDbGFzcyBDbGFzcyB0byBnaXZlIHRoZSBuZXcgVEQgY2VsbAoJCSAqICBAcmV0dXJucyB7bm9kZX0gVGhlIHJvdyBvcGVuZWQuIE5vdGUgdGhhdCBpZiB0aGUgdGFibGUgcm93IHBhc3NlZCBpbiBhcyB0aGUKCQkgKiAgICBmaXJzdCBwYXJhbWV0ZXIsIGlzIG5vdCBmb3VuZCBpbiB0aGUgdGFibGUsIHRoaXMgbWV0aG9kIHdpbGwgc2lsZW50bHkKCQkgKiAgICByZXR1cm4uCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbk9wZW4gPSBmdW5jdGlvbiggblRyLCBtSHRtbCwgc0NsYXNzICkKCQl7CgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQoJCQkvKiBDaGVjayB0aGF0IHRoZSByb3cgZ2l2ZW4gaXMgaW4gdGhlIHRhYmxlICovCgkJCXZhciBuVGFibGVSb3dzID0gX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICk7CgkJCWlmICggJC5pbkFycmF5KG5UciwgblRhYmxlUm93cykgPT09IC0xICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiB0aGUgb2xkIG9wZW4gb25lIGlmIHRoZXJlIGlzIG9uZSAqLwoJCQl0aGlzLmZuQ2xvc2UoIG5UciApOwoJCQkKCQkJdmFyIG5OZXdSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ciIpOwoJCQl2YXIgbk5ld0NlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOwoJCQluTmV3Um93LmFwcGVuZENoaWxkKCBuTmV3Q2VsbCApOwoJCQluTmV3Q2VsbC5jbGFzc05hbWUgPSBzQ2xhc3M7CgkJCW5OZXdDZWxsLmNvbFNwYW4gPSBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKTsKCQkKCQkJaWYgKHR5cGVvZiBtSHRtbCA9PT0gInN0cmluZyIpCgkJCXsKCQkJCW5OZXdDZWxsLmlubmVySFRNTCA9IG1IdG1sOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJJChuTmV3Q2VsbCkuaHRtbCggbUh0bWwgKTsKCQkJfQoJCQoJCQkvKiBJZiB0aGUgblRyIGlzbid0IG9uIHRoZSBwYWdlIGF0IHRoZSBtb21lbnQgLSB0aGVuIHdlIGRvbid0IGluc2VydCBhdCB0aGUgbW9tZW50ICovCgkJCXZhciBuVHJzID0gJCgndHInLCBvU2V0dGluZ3MublRCb2R5KTsKCQkJaWYgKCAkLmluQXJyYXkoblRyLCBuVHJzKSAhPSAtMSAgKQoJCQl7CgkJCQkkKG5OZXdSb3cpLmluc2VydEFmdGVyKG5Ucik7CgkJCX0KCQkJCgkJCW9TZXR0aW5ncy5hb09wZW5Sb3dzLnB1c2goIHsKCQkJCSJuVHIiOiBuTmV3Um93LAoJCQkJIm5QYXJlbnQiOiBuVHIKCQkJfSApOwoJCQkKCQkJcmV0dXJuIG5OZXdSb3c7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIHBhZ2luYXRpb24gLSBwcm92aWRlcyB0aGUgaW50ZXJuYWwgbG9naWMgZm9yIHBhZ2luYXRpb24gaW4gYSBzaW1wbGUgQVBJIAoJCSAqIGZ1bmN0aW9uLiBXaXRoIHRoaXMgZnVuY3Rpb24geW91IGNhbiBoYXZlIGEgRGF0YVRhYmxlcyB0YWJsZSBnbyB0byB0aGUgbmV4dCwgCgkJICogcHJldmlvdXMsIGZpcnN0IG9yIGxhc3QgcGFnZXMuCgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKSwgbm90ZSB0aGF0IHBhZ2UgMCBpcyB0aGUgZmlyc3QgcGFnZS4KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuUGFnZUNoYW5nZSggJ25leHQnICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5QYWdlQ2hhbmdlID0gZnVuY3Rpb24gKCBtQWN0aW9uLCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlfZm5QYWdlQ2hhbmdlKCBvU2V0dGluZ3MsIG1BY3Rpb24gKTsKCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX07CgkJCgkJCgkJLyoqCgkJICogU2hvdyBhIHBhcnRpY3VsYXIgY29sdW1uCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIFRoZSBjb2x1bW4gd2hvc2UgZGlzcGxheSBzaG91bGQgYmUgY2hhbmdlZAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTaG93IFNob3cgKHRydWUpIG9yIGhpZGUgKGZhbHNlKSB0aGUgY29sdW1uCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSGlkZSB0aGUgc2Vjb25kIGNvbHVtbiBhZnRlciBpbml0aWFsaXNhdGlvbgoJCSAqICAgICAgb1RhYmxlLmZuU2V0Q29sdW1uVmlzKCAxLCBmYWxzZSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU2V0Q29sdW1uVmlzID0gZnVuY3Rpb24gKCBpQ29sLCBiU2hvdywgYlJlZHJhdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGksIGlMZW47CgkJCXZhciBhb0NvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zOwoJCQl2YXIgYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YTsKCQkJdmFyIG5UZCwgYkFwcGVuZCwgaUJlZm9yZTsKCQkJCgkJCS8qIE5vIHBvaW50IGluIGRvaW5nIGFueXRoaW5nIGlmIHdlIGFyZSByZXF1ZXN0aW5nIHdoYXQgaXMgYWxyZWFkeSB0cnVlICovCgkJCWlmICggYW9Db2x1bW5zW2lDb2xdLmJWaXNpYmxlID09IGJTaG93ICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBTaG93IHRoZSBjb2x1bW4gKi8KCQkJaWYgKCBiU2hvdyApCgkJCXsKCQkJCXZhciBpSW5zZXJ0ID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8aUNvbCA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJaUluc2VydCsrOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogTmVlZCB0byBkZWNpZGUgaWYgd2Ugc2hvdWxkIHVzZSBhcHBlbmRDaGlsZCBvciBpbnNlcnRCZWZvcmUgKi8KCQkJCWJBcHBlbmQgPSAoaUluc2VydCA+PSBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKSk7CgkJCgkJCQkvKiBXaGljaCBjb2xvdW1uIHNob3VsZCB3ZSBiZSBpbnNlcnRpbmcgYmVmb3JlPyAqLwoJCQkJaWYgKCAhYkFwcGVuZCApCgkJCQl7CgkJCQkJZm9yICggaT1pQ29sIDsgaTxhb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJaUJlZm9yZSA9IGk7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkKCQkJCWZvciAoIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJaWYgKCBiQXBwZW5kICkKCQkJCQkJewoJCQkJCQkJYW9EYXRhW2ldLm5Uci5hcHBlbmRDaGlsZCggCgkJCQkJCQkJYW9EYXRhW2ldLl9hbkhpZGRlbltpQ29sXQoJCQkJCQkJKTsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCWFvRGF0YVtpXS5uVHIuaW5zZXJ0QmVmb3JlKAoJCQkJCQkJCWFvRGF0YVtpXS5fYW5IaWRkZW5baUNvbF0sIAoJCQkJCQkJCV9mbkdldFRkTm9kZXMoIG9TZXR0aW5ncywgaSApW2lCZWZvcmVdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBSZW1vdmUgYSBjb2x1bW4gZnJvbSBkaXNwbGF5ICovCgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW5UZCA9IF9mbkdldFRkTm9kZXMoIG9TZXR0aW5ncywgaSApW2lDb2xdOwoJCQkJCQlhb0RhdGFbaV0uX2FuSGlkZGVuW2lDb2xdID0gblRkOwoJCQkJCQluVGQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggblRkICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8qIENsZWFyIHRvIHNldCB0aGUgdmlzaWJsZSBmbGFnICovCgkJCWFvQ29sdW1uc1tpQ29sXS5iVmlzaWJsZSA9IGJTaG93OwoJCQoJCQkvKiBSZWRyYXcgdGhlIGhlYWRlciBhbmQgZm9vdGVyIGJhc2VkIG9uIHRoZSBuZXcgY29sdW1uIHZpc2liaWxpdHkgKi8KCQkJX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvSGVhZGVyICk7CgkJCWlmICggb1NldHRpbmdzLm5URm9vdCApCgkJCXsKCQkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0Zvb3RlciApOwoJCQl9CgkJCQoJCQkvKiBJZiB0aGVyZSBhcmUgYW55ICdvcGVuJyByb3dzLCB0aGVuIHdlIG5lZWQgdG8gYWx0ZXIgdGhlIGNvbHNwYW4gZm9yIHRoaXMgY29sIGNoYW5nZSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublRyLmNvbFNwYW4gPSBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogRG8gYSByZWRyYXcgaW5jYXNlIGFueXRoaW5nIGRlcGVuZGluZyBvbiB0aGUgdGFibGUgY29sdW1ucyBuZWVkcyBpdCAKCQkJICogKGJ1aWx0LWluOiBzY3JvbGxpbmcpIAoJCQkgKi8KCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkFkanVzdENvbHVtblNpemluZyggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJX2ZuU2F2ZVN0YXRlKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgc2V0dGluZ3MgZm9yIGEgcGFydGljdWxhciB0YWJsZSBmb3IgZXh0ZXJuYWwgbWFuaXB1bGF0aW9uCgkJICogIEByZXR1cm5zIHtvYmplY3R9IERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0LiBTZWUgCgkJICogICAge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgdmFyIG9TZXR0aW5ncyA9IG9UYWJsZS5mblNldHRpbmdzKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFNob3cgYW4gZXhhbXBsZSBwYXJhbWV0ZXIgZnJvbSB0aGUgc2V0dGluZ3MKCQkgKiAgICAgIGFsZXJ0KCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblNldHRpbmdzID0gZnVuY3Rpb24oKQoJCXsKCQkJcmV0dXJuIF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBTb3J0IHRoZSB0YWJsZSBieSBhIHBhcnRpY3VsYXIgY29sdW1uCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIHRoZSBkYXRhIGluZGV4IHRvIHNvcnQgb24uIE5vdGUgdGhhdCB0aGlzIHdpbGwgbm90IG1hdGNoIHRoZSAKCQkgKiAgICAnZGlzcGxheSBpbmRleCcgaWYgeW91IGhhdmUgaGlkZGVuIGRhdGEgZW50cmllcwoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb3J0IGltbWVkaWF0ZWx5IHdpdGggY29sdW1ucyAwIGFuZCAxCgkJICogICAgICBvVGFibGUuZm5Tb3J0KCBbIFswLCdhc2MnXSwgWzEsJ2FzYyddIF0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblNvcnQgPSBmdW5jdGlvbiggYWFTb3J0ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nID0gYWFTb3J0OwoJCQlfZm5Tb3J0KCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEF0dGFjaCBhIHNvcnQgbGlzdGVuZXIgdG8gYW4gZWxlbWVudCBmb3IgYSBnaXZlbiBjb2x1bW4KCQkgKiAgQHBhcmFtIHtub2RlfSBuTm9kZSB0aGUgZWxlbWVudCB0byBhdHRhY2ggdGhlIHNvcnQgbGlzdGVuZXIgdG8KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2x1bW4gdGhlIGNvbHVtbiB0aGF0IGEgY2xpY2sgb24gdGhpcyBub2RlIHdpbGwgc29ydCBvbgoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBbZm5DYWxsYmFja10gY2FsbGJhY2sgZnVuY3Rpb24gd2hlbiBzb3J0IGlzIHJ1bgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb3J0IG9uIGNvbHVtbiAxLCB3aGVuICdzb3J0ZXInIGlzIGNsaWNrZWQgb24KCQkgKiAgICAgIG9UYWJsZS5mblNvcnRMaXN0ZW5lciggZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvcnRlcicpLCAxICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5Tb3J0TGlzdGVuZXIgPSBmdW5jdGlvbiggbk5vZGUsIGlDb2x1bW4sIGZuQ2FsbGJhY2sgKQoJCXsKCQkJX2ZuU29ydEF0dGFjaExpc3RlbmVyKCBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApLCBuTm9kZSwgaUNvbHVtbiwKCQkJIAlmbkNhbGxiYWNrICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgYSB0YWJsZSBjZWxsIG9yIHJvdyAtIHRoaXMgbWV0aG9kIHdpbGwgYWNjZXB0IGVpdGhlciBhIHNpbmdsZSB2YWx1ZSB0bwoJCSAqIHVwZGF0ZSB0aGUgY2VsbCB3aXRoLCBhbiBhcnJheSBvZiB2YWx1ZXMgd2l0aCBvbmUgZWxlbWVudCBmb3IgZWFjaCBjb2x1bW4gb3IKCQkgKiBhbiBvYmplY3QgaW4gdGhlIHNhbWUgZm9ybWF0IGFzIHRoZSBvcmlnaW5hbCBkYXRhIHNvdXJjZS4gVGhlIGZ1bmN0aW9uIGlzCgkJICogc2VsZi1yZWZlcmVuY2luZyBpbiBvcmRlciB0byBtYWtlIHRoZSBtdWx0aSBjb2x1bW4gdXBkYXRlcyBlYXNpZXIuCgkJICogIEBwYXJhbSB7b2JqZWN0fGFycmF5fHN0cmluZ30gbURhdGEgRGF0YSB0byB1cGRhdGUgdGhlIGNlbGwvcm93IHdpdGgKCQkgKiAgQHBhcmFtIHtub2RlfGludH0gbVJvdyBUUiBlbGVtZW50IHlvdSB3YW50IHRvIHVwZGF0ZSBvciB0aGUgYW9EYXRhIGluZGV4CgkJICogIEBwYXJhbSB7aW50fSBbaUNvbHVtbl0gVGhlIGNvbHVtbiB0byB1cGRhdGUgKG5vdCB1c2VkIG9mIG1EYXRhIGlzIGFuIGFycmF5IG9yIG9iamVjdCkKCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiQWN0aW9uPXRydWVdIFBlcmZvcm0gcHJlLWRyYXcgYWN0aW9ucyBvciBub3QKCQkgKiAgQHJldHVybnMge2ludH0gMCBvbiBzdWNjZXNzLCAxIG9uIGVycm9yCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5VcGRhdGUoICdFeGFtcGxlIHVwZGF0ZScsIDAsIDAgKTsgLy8gU2luZ2xlIGNlbGwKCQkgKiAgICAgIG9UYWJsZS5mblVwZGF0ZSggWydhJywgJ2InLCAnYycsICdkJywgJ2UnXSwgMSwgMCApOyAvLyBSb3cKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblVwZGF0ZSA9IGZ1bmN0aW9uKCBtRGF0YSwgbVJvdywgaUNvbHVtbiwgYlJlZHJhdywgYkFjdGlvbiApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGksIGlMZW4sIHNEaXNwbGF5OwoJCQl2YXIgaVJvdyA9ICh0eXBlb2YgbVJvdyA9PT0gJ29iamVjdCcpID8gCgkJCQlfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93KSA6IG1Sb3c7CgkJCQoJCQlpZiAoICQuaXNBcnJheShtRGF0YSkgJiYgaUNvbHVtbiA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJLyogQXJyYXkgdXBkYXRlIC0gdXBkYXRlIHRoZSB3aG9sZSByb3cgKi8KCQkJCW9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhID0gbURhdGEuc2xpY2UoKTsKCQkJCQoJCQkJLyogRmxhZyB0byB0aGUgZnVuY3Rpb24gdGhhdCB3ZSBhcmUgcmVjdXJzaW5nICovCgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCAkLmlzUGxhaW5PYmplY3QobURhdGEpICYmIGlDb2x1bW4gPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIE9iamVjdCB1cGRhdGUgLSB1cGRhdGUgdGhlIHdob2xlIHJvdyAtIGFzc3VtZSB0aGUgZGV2ZWxvcGVyIGdldHMgdGhlIG9iamVjdCByaWdodCAqLwoJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgPSAkLmV4dGVuZCggdHJ1ZSwge30sIG1EYXRhICk7CgkJCgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogSW5kaXZpZHVhbCBjZWxsIHVwZGF0ZSAqLwoJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgbURhdGEgKTsKCQkJCXNEaXNwbGF5ID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkJCWlmICggb0NvbC5mblJlbmRlciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJc0Rpc3BsYXkgPSBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiApOwoJCQkJCWlmICggb0NvbC5iVXNlUmVuZGVyZWQgKQoJCQkJCXsKCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgc0Rpc3BsYXkgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCS8qIERvIHRoZSBhY3R1YWwgSFRNTCB1cGRhdGUgKi8KCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKVtpQ29sdW1uXS5pbm5lckhUTUwgPSBzRGlzcGxheTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogTW9kaWZ5IHRoZSBzZWFyY2ggaW5kZXggZm9yIHRoaXMgcm93IChzdHJpY3RseSB0aGlzIGlzIGxpa2VseSBub3QgbmVlZGVkLCBzaW5jZSBmblJlRHJhdwoJCQkgKiB3aWxsIHJlYnVpbGQgdGhlIHNlYXJjaCBhcnJheSAtIGhvd2V2ZXIsIHRoZSByZWRyYXcgbWlnaHQgYmUgZGlzYWJsZWQgYnkgdGhlIHVzZXIpCgkJCSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaVJvdywgb1NldHRpbmdzLmFpRGlzcGxheSApOwoJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2lEaXNwbGF5SW5kZXhdID0gX2ZuQnVpbGRTZWFyY2hSb3coCgkJCQlvU2V0dGluZ3MsIAoJCQkJX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpUm93LCAnZmlsdGVyJywgX2ZuR2V0Q29sdW1ucyggb1NldHRpbmdzLCAnYlNlYXJjaGFibGUnICkgKQoJCQkpOwoJCQkKCQkJLyogUGVyZm9ybSBwcmUtZHJhdyBhY3Rpb25zICovCgkJCWlmICggYkFjdGlvbiA9PT0gdW5kZWZpbmVkIHx8IGJBY3Rpb24gKQoJCQl7CgkJCQlfZm5BZGp1c3RDb2x1bW5TaXppbmcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBSZWRyYXcgdGhlIHRhYmxlICovCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5SZURyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCXJldHVybiAwOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUHJvdmlkZSBhIGNvbW1vbiBtZXRob2QgZm9yIHBsdWctaW5zIHRvIGNoZWNrIHRoZSB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgYmVpbmcgdXNlZCwgaW4gb3JkZXIKCQkgKiB0byBlbnN1cmUgY29tcGF0aWJpbGl0eS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWZXJzaW9uIFZlcnNpb24gc3RyaW5nIHRvIGNoZWNrIGZvciwgaW4gdGhlIGZvcm1hdCAiWC5ZLloiLiBOb3RlIHRoYXQgdGhlCgkJICogICAgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIHJlcXVpcmVkCgkJICogICAgdmVyc2lvbiwgb3IgZmFsc2UgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWxlcyBpcyBub3Qgc3VpdGFibGUKCQkgKiAgQG1ldGhvZAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgYWxlcnQoIG9UYWJsZS5mblZlcnNpb25DaGVjayggJzEuOS4wJyApICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5WZXJzaW9uQ2hlY2sgPSBEYXRhVGFibGUuZXh0LmZuVmVyc2lvbkNoZWNrOwoJCQoJCQoJCS8qCgkJICogVGhpcyBpcyByZWFsbHkgYSBnb29kIGJpdCBydWJiaXNoIHRoaXMgbWV0aG9kIG9mIGV4cG9zaW5nIHRoZSBpbnRlcm5hbCBtZXRob2RzCgkJICogcHVibGljbHkuLi4gLSBUbyBiZSBmaXhlZCBpbiAyLjAgdXNpbmcgbWV0aG9kcyBvbiB0aGUgcHJvdG90eXBlCgkJICovCgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGEgd3JhcHBlciBmdW5jdGlvbiBmb3IgZXhwb3J0aW5nIGFuIGludGVybmFsIGZ1bmN0aW9ucyB0byBhbiBleHRlcm5hbCBBUEkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRnVuYyBBUEkgZnVuY3Rpb24gbmFtZQoJCSAqICBAcmV0dXJucyB7ZnVuY3Rpb259IHdyYXBwZWQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRXh0ZXJuQXBpRnVuYyAoc0Z1bmMpCgkJewoJCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCQl2YXIgYUFyZ3MgPSBbX2ZuU2V0dGluZ3NGcm9tTm9kZSh0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSldLmNvbmNhdCggCgkJCQkJQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSApOwoJCQkJcmV0dXJuIERhdGFUYWJsZS5leHQub0FwaVtzRnVuY10uYXBwbHkoIHRoaXMsIGFBcmdzICk7CgkJCX07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlZmVyZW5jZSB0byBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIHVzZSBieSBwbHVnLWluIGRldmVsb3BlcnMuIE5vdGUgdGhhdCB0aGVzZQoJCSAqIG1ldGhvZHMgYXJlIHJlZmVyZW5jZXMgdG8gaW50ZXJuYWwgZnVuY3Rpb25zIGFuZCBhcmUgY29uc2lkZXJlZCB0byBiZSBwcml2YXRlLgoJCSAqIElmIHlvdSB1c2UgdGhlc2UgbWV0aG9kcywgYmUgYXdhcmUgdGhhdCB0aGV5IGFyZSBsaWFibGUgdG8gY2hhbmdlIGJldHdlZW4gdmVyc2lvbnMKCQkgKiAoY2hlY2sgdGhlIHVwZ3JhZGUgbm90ZXMpLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJdGhpcy5vQXBpID0gewoJCQkiX2ZuRXh0ZXJuQXBpRnVuYyI6IF9mbkV4dGVybkFwaUZ1bmMsCgkJCSJfZm5Jbml0aWFsaXNlIjogX2ZuSW5pdGlhbGlzZSwKCQkJIl9mbkluaXRDb21wbGV0ZSI6IF9mbkluaXRDb21wbGV0ZSwKCQkJIl9mbkxhbmd1YWdlQ29tcGF0IjogX2ZuTGFuZ3VhZ2VDb21wYXQsCgkJCSJfZm5BZGRDb2x1bW4iOiBfZm5BZGRDb2x1bW4sCgkJCSJfZm5Db2x1bW5PcHRpb25zIjogX2ZuQ29sdW1uT3B0aW9ucywKCQkJIl9mbkFkZERhdGEiOiBfZm5BZGREYXRhLAoJCQkiX2ZuQ3JlYXRlVHIiOiBfZm5DcmVhdGVUciwKCQkJIl9mbkdhdGhlckRhdGEiOiBfZm5HYXRoZXJEYXRhLAoJCQkiX2ZuQnVpbGRIZWFkIjogX2ZuQnVpbGRIZWFkLAoJCQkiX2ZuRHJhd0hlYWQiOiBfZm5EcmF3SGVhZCwKCQkJIl9mbkRyYXciOiBfZm5EcmF3LAoJCQkiX2ZuUmVEcmF3IjogX2ZuUmVEcmF3LAoJCQkiX2ZuQWpheFVwZGF0ZSI6IF9mbkFqYXhVcGRhdGUsCgkJCSJfZm5BamF4UGFyYW1ldGVycyI6IF9mbkFqYXhQYXJhbWV0ZXJzLAoJCQkiX2ZuQWpheFVwZGF0ZURyYXciOiBfZm5BamF4VXBkYXRlRHJhdywKCQkJIl9mblNlcnZlclBhcmFtcyI6IF9mblNlcnZlclBhcmFtcywKCQkJIl9mbkFkZE9wdGlvbnNIdG1sIjogX2ZuQWRkT3B0aW9uc0h0bWwsCgkJCSJfZm5GZWF0dXJlSHRtbFRhYmxlIjogX2ZuRmVhdHVyZUh0bWxUYWJsZSwKCQkJIl9mblNjcm9sbERyYXciOiBfZm5TY3JvbGxEcmF3LAoJCQkiX2ZuQWRqdXN0Q29sdW1uU2l6aW5nIjogX2ZuQWRqdXN0Q29sdW1uU2l6aW5nLAoJCQkiX2ZuRmVhdHVyZUh0bWxGaWx0ZXIiOiBfZm5GZWF0dXJlSHRtbEZpbHRlciwKCQkJIl9mbkZpbHRlckNvbXBsZXRlIjogX2ZuRmlsdGVyQ29tcGxldGUsCgkJCSJfZm5GaWx0ZXJDdXN0b20iOiBfZm5GaWx0ZXJDdXN0b20sCgkJCSJfZm5GaWx0ZXJDb2x1bW4iOiBfZm5GaWx0ZXJDb2x1bW4sCgkJCSJfZm5GaWx0ZXIiOiBfZm5GaWx0ZXIsCgkJCSJfZm5CdWlsZFNlYXJjaEFycmF5IjogX2ZuQnVpbGRTZWFyY2hBcnJheSwKCQkJIl9mbkJ1aWxkU2VhcmNoUm93IjogX2ZuQnVpbGRTZWFyY2hSb3csCgkJCSJfZm5GaWx0ZXJDcmVhdGVTZWFyY2giOiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2gsCgkJCSJfZm5EYXRhVG9TZWFyY2giOiBfZm5EYXRhVG9TZWFyY2gsCgkJCSJfZm5Tb3J0IjogX2ZuU29ydCwKCQkJIl9mblNvcnRBdHRhY2hMaXN0ZW5lciI6IF9mblNvcnRBdHRhY2hMaXN0ZW5lciwKCQkJIl9mblNvcnRpbmdDbGFzc2VzIjogX2ZuU29ydGluZ0NsYXNzZXMsCgkJCSJfZm5GZWF0dXJlSHRtbFBhZ2luYXRlIjogX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSwKCQkJIl9mblBhZ2VDaGFuZ2UiOiBfZm5QYWdlQ2hhbmdlLAoJCQkiX2ZuRmVhdHVyZUh0bWxJbmZvIjogX2ZuRmVhdHVyZUh0bWxJbmZvLAoJCQkiX2ZuVXBkYXRlSW5mbyI6IF9mblVwZGF0ZUluZm8sCgkJCSJfZm5GZWF0dXJlSHRtbExlbmd0aCI6IF9mbkZlYXR1cmVIdG1sTGVuZ3RoLAoJCQkiX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nIjogX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nLAoJCQkiX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkiOiBfZm5Qcm9jZXNzaW5nRGlzcGxheSwKCQkJIl9mblZpc2libGVUb0NvbHVtbkluZGV4IjogX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSI6IF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlLAoJCQkiX2ZuTm9kZVRvRGF0YUluZGV4IjogX2ZuTm9kZVRvRGF0YUluZGV4LAoJCQkiX2ZuVmlzYmxlQ29sdW1ucyI6IF9mblZpc2JsZUNvbHVtbnMsCgkJCSJfZm5DYWxjdWxhdGVFbmQiOiBfZm5DYWxjdWxhdGVFbmQsCgkJCSJfZm5Db252ZXJ0VG9XaWR0aCI6IF9mbkNvbnZlcnRUb1dpZHRoLAoJCQkiX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzIjogX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLAoJCQkiX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QiOiBfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCwKCQkJIl9mbkdldFdpZGVzdE5vZGUiOiBfZm5HZXRXaWRlc3ROb2RlLAoJCQkiX2ZuR2V0TWF4TGVuU3RyaW5nIjogX2ZuR2V0TWF4TGVuU3RyaW5nLAoJCQkiX2ZuU3RyaW5nVG9Dc3MiOiBfZm5TdHJpbmdUb0NzcywKCQkJIl9mbkRldGVjdFR5cGUiOiBfZm5EZXRlY3RUeXBlLAoJCQkiX2ZuU2V0dGluZ3NGcm9tTm9kZSI6IF9mblNldHRpbmdzRnJvbU5vZGUsCgkJCSJfZm5HZXREYXRhTWFzdGVyIjogX2ZuR2V0RGF0YU1hc3RlciwKCQkJIl9mbkdldFRyTm9kZXMiOiBfZm5HZXRUck5vZGVzLAoJCQkiX2ZuR2V0VGROb2RlcyI6IF9mbkdldFRkTm9kZXMsCgkJCSJfZm5Fc2NhcGVSZWdleCI6IF9mbkVzY2FwZVJlZ2V4LAoJCQkiX2ZuRGVsZXRlSW5kZXgiOiBfZm5EZWxldGVJbmRleCwKCQkJIl9mblJlT3JkZXJJbmRleCI6IF9mblJlT3JkZXJJbmRleCwKCQkJIl9mbkNvbHVtbk9yZGVyaW5nIjogX2ZuQ29sdW1uT3JkZXJpbmcsCgkJCSJfZm5Mb2ciOiBfZm5Mb2csCgkJCSJfZm5DbGVhclRhYmxlIjogX2ZuQ2xlYXJUYWJsZSwKCQkJIl9mblNhdmVTdGF0ZSI6IF9mblNhdmVTdGF0ZSwKCQkJIl9mbkxvYWRTdGF0ZSI6IF9mbkxvYWRTdGF0ZSwKCQkJIl9mbkNyZWF0ZUNvb2tpZSI6IF9mbkNyZWF0ZUNvb2tpZSwKCQkJIl9mblJlYWRDb29raWUiOiBfZm5SZWFkQ29va2llLAoJCQkiX2ZuRGV0ZWN0SGVhZGVyIjogX2ZuRGV0ZWN0SGVhZGVyLAoJCQkiX2ZuR2V0VW5pcXVlVGhzIjogX2ZuR2V0VW5pcXVlVGhzLAoJCQkiX2ZuU2Nyb2xsQmFyV2lkdGgiOiBfZm5TY3JvbGxCYXJXaWR0aCwKCQkJIl9mbkFwcGx5VG9DaGlsZHJlbiI6IF9mbkFwcGx5VG9DaGlsZHJlbiwKCQkJIl9mbk1hcCI6IF9mbk1hcCwKCQkJIl9mbkdldFJvd0RhdGEiOiBfZm5HZXRSb3dEYXRhLAoJCQkiX2ZuR2V0Q2VsbERhdGEiOiBfZm5HZXRDZWxsRGF0YSwKCQkJIl9mblNldENlbGxEYXRhIjogX2ZuU2V0Q2VsbERhdGEsCgkJCSJfZm5HZXRPYmplY3REYXRhRm4iOiBfZm5HZXRPYmplY3REYXRhRm4sCgkJCSJfZm5TZXRPYmplY3REYXRhRm4iOiBfZm5TZXRPYmplY3REYXRhRm4sCgkJCSJfZm5BcHBseUNvbHVtbkRlZnMiOiBfZm5BcHBseUNvbHVtbkRlZnMsCgkJCSJfZm5CaW5kQWN0aW9uIjogX2ZuQmluZEFjdGlvbiwKCQkJIl9mbkV4dGVuZCI6IF9mbkV4dGVuZCwKCQkJIl9mbkNhbGxiYWNrUmVnIjogX2ZuQ2FsbGJhY2tSZWcsCgkJCSJfZm5DYWxsYmFja0ZpcmUiOiBfZm5DYWxsYmFja0ZpcmUsCgkJCSJfZm5Kc29uU3RyaW5nIjogX2ZuSnNvblN0cmluZywKCQkJIl9mblJlbmRlciI6IF9mblJlbmRlciwKCQkJIl9mbk5vZGVUb0NvbHVtbkluZGV4IjogX2ZuTm9kZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5JbmZvTWFjcm9zIjogX2ZuSW5mb01hY3JvcywKCQkJIl9mbkJyb3dzZXJEZXRlY3QiOiBfZm5Ccm93c2VyRGV0ZWN0LAoJCQkiX2ZuR2V0Q29sdW1ucyI6IF9mbkdldENvbHVtbnMKCQl9OwoJCQoJCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9BcGksIHRoaXMub0FwaSApOwoJCQoJCWZvciAoIHZhciBzRnVuYyBpbiBEYXRhVGFibGUuZXh0Lm9BcGkgKQoJCXsKCQkJaWYgKCBzRnVuYyApCgkJCXsKCQkJCXRoaXNbc0Z1bmNdID0gX2ZuRXh0ZXJuQXBpRnVuYyhzRnVuYyk7CgkJCX0KCQl9CgkJCgkJCgkJdmFyIF90aGF0ID0gdGhpczsKCQl0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBpPTAsIGlMZW4sIGosIGpMZW4sIGssIGtMZW47CgkJCXZhciBzSWQgPSB0aGlzLmdldEF0dHJpYnV0ZSggJ2lkJyApOwoJCQl2YXIgYkluaXRIYW5kZWRPZmYgPSBmYWxzZTsKCQkJdmFyIGJVc2VQYXNzZWREYXRhID0gZmFsc2U7CgkJCQoJCQkKCQkJLyogU2FuaXR5IGNoZWNrICovCgkJCWlmICggdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9ICd0YWJsZScgKQoJCQl7CgkJCQlfZm5Mb2coIG51bGwsIDAsICJBdHRlbXB0ZWQgdG8gaW5pdGlhbGlzZSBEYXRhVGFibGVzIG9uIGEgbm9kZSB3aGljaCBpcyBub3QgYSAiKwoJCQkJCSJ0YWJsZTogIit0aGlzLm5vZGVOYW1lICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIENoZWNrIHRvIHNlZSBpZiB3ZSBhcmUgcmUtaW5pdGlhbGlzaW5nIGEgdGFibGUgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkvKiBCYXNlIGNoZWNrIG9uIHRhYmxlIG5vZGUgKi8KCQkJCWlmICggRGF0YVRhYmxlLnNldHRpbmdzW2ldLm5UYWJsZSA9PSB0aGlzICkKCQkJCXsKCQkJCQlpZiAoIG9Jbml0ID09PSB1bmRlZmluZWQgfHwgb0luaXQuYlJldHJpZXZlICkKCQkJCQl7CgkJCQkJCXJldHVybiBEYXRhVGFibGUuc2V0dGluZ3NbaV0ub0luc3RhbmNlOwoJCQkJCX0KCQkJCQllbHNlIGlmICggb0luaXQuYkRlc3Ryb3kgKQoJCQkJCXsKCQkJCQkJRGF0YVRhYmxlLnNldHRpbmdzW2ldLm9JbnN0YW5jZS5mbkRlc3Ryb3koKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCV9mbkxvZyggRGF0YVRhYmxlLnNldHRpbmdzW2ldLCAwLCAiQ2Fubm90IHJlaW5pdGlhbGlzZSBEYXRhVGFibGUuXG5cbiIrCgkJCQkJCQkiVG8gcmV0cmlldmUgdGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGlzIHRhYmxlLCBwYXNzIG5vIGFyZ3VtZW50cyBvciBzZWUgIisKCQkJCQkJCSJ0aGUgZG9jcyBmb3IgYlJldHJpZXZlIGFuZCBiRGVzdHJveSIgKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogSWYgdGhlIGVsZW1lbnQgd2UgYXJlIGluaXRpYWxpc2luZyBoYXMgdGhlIHNhbWUgSUQgYXMgYSB0YWJsZSB3aGljaCB3YXMgcHJldmlvdXNseQoJCQkJICogaW5pdGlhbGlzZWQsIGJ1dCB0aGUgdGFibGUgbm9kZXMgZG9uJ3QgbWF0Y2ggKGZyb20gYmVmb3JlKSB0aGVuIHdlIGRlc3Ryb3kgdGhlIG9sZAoJCQkJICogaW5zdGFuY2UgYnkgc2ltcGx5IGRlbGV0aW5nIGl0LiBUaGlzIGlzIHVuZGVyIHRoZSBhc3N1bXB0aW9uIHRoYXQgdGhlIHRhYmxlIGhhcyBiZWVuCgkJCQkgKiBkZXN0cm95ZWQgYnkgb3RoZXIgbWV0aG9kcy4gQW55b25lIHVzaW5nIG5vbi1pZCBzZWxlY3RvcnMgd2lsbCBuZWVkIHRvIGRvIHRoaXMgbWFudWFsbHkKCQkJCSAqLwoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0uc1RhYmxlSWQgPT0gdGhpcy5pZCApCgkJCQl7CgkJCQkJRGF0YVRhYmxlLnNldHRpbmdzLnNwbGljZSggaSwgMSApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBFbnN1cmUgdGhlIHRhYmxlIGhhcyBhbiBJRCAtIHJlcXVpcmVkIGZvciBhY2Nlc3NpYmlsaXR5ICovCgkJCWlmICggc0lkID09PSBudWxsIHx8IHNJZCA9PT0gIiIgKQoJCQl7CgkJCQlzSWQgPSAiRGF0YVRhYmxlc19UYWJsZV8iKyhEYXRhVGFibGUuZXh0Ll9vRXh0ZXJuQ29uZmlnLmlOZXh0VW5pcXVlKyspOwoJCQkJdGhpcy5pZCA9IHNJZDsKCQkJfQoJCQkKCQkJLyogQ3JlYXRlIHRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgdGFibGUgYW5kIHNldCBzb21lIG9mIHRoZSBkZWZhdWx0IHBhcmFtZXRlcnMgKi8KCQkJdmFyIG9TZXR0aW5ncyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MsIHsKCQkJCSJuVGFibGUiOiAgICAgICAgdGhpcywKCQkJCSJvQXBpIjogICAgICAgICAgX3RoYXQub0FwaSwKCQkJCSJvSW5pdCI6ICAgICAgICAgb0luaXQsCgkJCQkic0Rlc3Ryb3lXaWR0aCI6ICQodGhpcykud2lkdGgoKSwKCQkJCSJzSW5zdGFuY2UiOiAgICAgc0lkLAoJCQkJInNUYWJsZUlkIjogICAgICBzSWQKCQkJfSApOwoJCQlEYXRhVGFibGUuc2V0dGluZ3MucHVzaCggb1NldHRpbmdzICk7CgkJCQoJCQkvLyBOZWVkIHRvIGFkZCB0aGUgaW5zdGFuY2UgYWZ0ZXIgdGhlIGluc3RhbmNlIGFmdGVyIHRoZSBzZXR0aW5ncyBvYmplY3QgaGFzIGJlZW4gYWRkZWQKCQkJLy8gdG8gdGhlIHNldHRpbmdzIGFycmF5LCBzbyB3ZSBjYW4gc2VsZiByZWZlcmVuY2UgdGhlIHRhYmxlIGluc3RhbmNlIGlmIG1vcmUgdGhhbiBvbmUKCQkJb1NldHRpbmdzLm9JbnN0YW5jZSA9IChfdGhhdC5sZW5ndGg9PT0xKSA/IF90aGF0IDogJCh0aGlzKS5kYXRhVGFibGUoKTsKCQkJCgkJCS8qIFNldHRpbmcgdXAgdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdCAqLwoJCQlpZiAoICFvSW5pdCApCgkJCXsKCQkJCW9Jbml0ID0ge307CgkJCX0KCQkJCgkJCS8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBiZWZvcmUgd2UgYXBwbHkgYWxsIHRoZSBkZWZhdWx0cwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZSApCgkJCXsKCQkJCV9mbkxhbmd1YWdlQ29tcGF0KCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJb0luaXQgPSBfZm5FeHRlbmQoICQuZXh0ZW5kKHRydWUsIHt9LCBEYXRhVGFibGUuZGVmYXVsdHMpLCBvSW5pdCApOwoJCQkKCQkJLy8gTWFwIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zIG9udG8gdGhlIHNldHRpbmdzIG9iamVjdAoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlBhZ2luYXRlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkxlbmd0aENoYW5nZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJGaWx0ZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiU29ydCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJJbmZvIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlByb2Nlc3NpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiQXV0b1dpZHRoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNvcnRDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNlcnZlclNpZGUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiRGVmZXJSZW5kZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFgiLCAic1giICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFhJbm5lciIsICJzWElubmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxZIiwgInNZIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgImJTY3JvbGxDb2xsYXBzZSIsICJiQ29sbGFwc2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiYlNjcm9sbEluZmluaXRlIiwgImJJbmZpbml0ZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJpU2Nyb2xsTG9hZEdhcCIsICJpTG9hZEdhcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJiU2Nyb2xsQXV0b0NzcyIsICJiQXV0b0NzcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcGVDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhc1N0cmlwQ2xhc3NlcyIsICJhc1N0cmlwZUNsYXNzZXMiICk7IC8vIGxlZ2FjeQoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblNlcnZlckRhdGEiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImZuRm9ybWF0TnVtYmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzU2VydmVyTWV0aG9kIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhYVNvcnRpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImFhU29ydGluZ0ZpeGVkIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhTGVuZ3RoTWVudSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic1BhZ2luYXRpb25UeXBlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQWpheFNvdXJjZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0FqYXhEYXRhUHJvcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaUNvb2tpZUR1cmF0aW9uIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQ29va2llUHJlZml4IiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzRG9tIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJiU29ydENlbGxzVG9wIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpVGFiSW5kZXgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgIm9TZWFyY2giLCAib1ByZXZpb3VzU2VhcmNoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhb1NlYXJjaENvbHMiLCAiYW9QcmVTZWFyY2hDb2xzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpRGlzcGxheUxlbmd0aCIsICJfaURpc3BsYXlMZW5ndGgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImJKUXVlcnlVSSIsICJiSlVJIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmbkNvb2tpZUNhbGxiYWNrIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblN0YXRlTG9hZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TdGF0ZVNhdmUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQsICJmbkluZm9DYWxsYmFjayIgKTsKCQkJCgkJCS8qIENhbGxiYWNrIGZ1bmN0aW9ucyB3aGljaCBhcmUgYXJyYXkgZHJpdmVuICovCgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICAgICAgIG9Jbml0LmZuRHJhd0NhbGxiYWNrLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TZXJ2ZXJQYXJhbXMnLCAgICAgICBvSW5pdC5mblNlcnZlclBhcmFtcywgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU3RhdGVTYXZlUGFyYW1zJywgICAgb0luaXQuZm5TdGF0ZVNhdmVQYXJhbXMsICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZFBhcmFtcycsICAgIG9Jbml0LmZuU3RhdGVMb2FkUGFyYW1zLCAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICAgICAgICBvSW5pdC5mblN0YXRlTG9hZGVkLCAgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvUm93Q2FsbGJhY2snLCAgICAgICAgb0luaXQuZm5Sb3dDYWxsYmFjaywgICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG9Jbml0LmZuQ3JlYXRlZFJvdywgICAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9IZWFkZXJDYWxsYmFjaycsICAgICBvSW5pdC5mbkhlYWRlckNhbGxiYWNrLCAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRm9vdGVyQ2FsbGJhY2snLCAgICAgb0luaXQuZm5Gb290ZXJDYWxsYmFjaywgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0luaXRDb21wbGV0ZScsICAgICAgIG9Jbml0LmZuSW5pdENvbXBsZXRlLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAgICBvSW5pdC5mblByZURyYXdDYWxsYmFjaywgICAndXNlcicgKTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmCgkJCQkgICBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0Q2xhc3NlcyApCgkJCXsKCQkJCS8qIEVuYWJsZSBzb3J0IGNsYXNzZXMgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIFNhZmUgdG8gZG8gaXQgaGVyZSwgc2luY2Ugc2VydmVyLXNpZGUKCQkJCSAqIHByb2Nlc3NpbmcgbXVzdCBiZSBlbmFibGVkIGJ5IHRoZSBkZXZlbG9wZXIKCQkJCSAqLwoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdzZXJ2ZXJfc2lkZV9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkRlZmVyUmVuZGVyICkKCQkJewoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdkZWZlcl9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYkpRdWVyeVVJICkKCQkJewoJCQkJLyogVXNlIHRoZSBKVUkgY2xhc3NlcyBvYmplY3QgZm9yIGRpc3BsYXkuIFlvdSBjb3VsZCBjbG9uZSB0aGUgb1N0ZENsYXNzZXMgb2JqZWN0IGlmIAoJCQkJICogeW91IHdhbnQgdG8gaGF2ZSBtdWx0aXBsZSB0YWJsZXMgd2l0aCBtdWx0aXBsZSBpbmRlcGVuZGVudCBjbGFzc2VzIAoJCQkJICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9DbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9KVUlDbGFzc2VzICk7CgkJCQkKCQkJCWlmICggb0luaXQuc0RvbSA9PT0gRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gJiYgRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gPT09ICJsZnJ0aXAiICkKCQkJCXsKCQkJCQkvKiBTZXQgdGhlIERPTSB0byB1c2UgYSBsYXlvdXQgc3VpdGFibGUgZm9yIGpRdWVyeSBVSSdzIHRoZW1pbmcgKi8KCQkJCQlvU2V0dGluZ3Muc0RvbSA9ICc8IkgibGZyPnQ8IkYiaXA+JzsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3Mub0NsYXNzZXMsIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMgKTsKCQkJfQoJCQkkKHRoaXMpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1RhYmxlICk7CgkJCQoJCQkvKiBDYWxjdWxhdGUgdGhlIHNjcm9sbCBiYXIgd2lkdGggYW5kIGNhY2hlIGl0IGZvciB1c2UgbGF0ZXIgb24gKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoID0gX2ZuU2Nyb2xsQmFyV2lkdGgoKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIERpc3BsYXkgc3RhcnQgcG9pbnQsIHRha2luZyBpbnRvIGFjY291bnQgdGhlIHNhdmUgc2F2aW5nICovCgkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBvSW5pdC5pRGlzcGxheVN0YXJ0OwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb0luaXQuaURpc3BsYXlTdGFydDsKCQkJfQoJCQkKCQkJLyogTXVzdCBiZSBkb25lIGFmdGVyIGV2ZXJ5dGhpbmcgd2hpY2ggY2FuIGJlIG92ZXJyaWRkZW4gYnkgYSBjb29raWUhICovCgkJCWlmICggb0luaXQuYlN0YXRlU2F2ZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSA9IHRydWU7CgkJCQlfZm5Mb2FkU3RhdGUoIG9TZXR0aW5ncywgb0luaXQgKTsKCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNhdmVTdGF0ZSwgJ3N0YXRlX3NhdmUnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuaURlZmVyTG9hZGluZyAhPT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nID0gdHJ1ZTsKCQkJCXZhciB0bXAgPSAkLmlzQXJyYXkoIG9Jbml0LmlEZWZlckxvYWRpbmcgKTsKCQkJCW9TZXR0aW5ncy5faVJlY29yZHNEaXNwbGF5ID0gdG1wID8gb0luaXQuaURlZmVyTG9hZGluZ1swXSA6IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCQlvU2V0dGluZ3MuX2lSZWNvcmRzVG90YWwgPSB0bXAgPyBvSW5pdC5pRGVmZXJMb2FkaW5nWzFdIDogb0luaXQuaURlZmVyTG9hZGluZzsKCQkJfQoJCQkKCQkJaWYgKCBvSW5pdC5hYURhdGEgIT09IG51bGwgKQoJCQl7CgkJCQliVXNlUGFzc2VkRGF0YSA9IHRydWU7CgkJCX0KCQkJCgkJCS8qIExhbmd1YWdlIGRlZmluaXRpb25zICovCgkJCWlmICggb0luaXQub0xhbmd1YWdlLnNVcmwgIT09ICIiICkKCQkJewoJCQkJLyogR2V0IHRoZSBsYW5ndWFnZSBkZWZpbml0aW9ucyBmcm9tIGEgZmlsZSAtIGJlY2F1c2UgdGhpcyBBamF4IGNhbGwgbWFrZXMgdGhlIGxhbmd1YWdlCgkJCQkgKiBnZXQgYXN5bmMgdG8gdGhlIHJlbWFpbmRlciBvZiB0aGlzIGZ1bmN0aW9uIHdlIHVzZSBiSW5pdEhhbmRlZE9mZiB0byBpbmRpY2F0ZSB0aGF0IAoJCQkJICogX2ZuSW5pdGlhbGlzZSB3aWxsIGJlIGZpcmVkIGJ5IHRoZSByZXR1cm5lZCBBamF4IGhhbmRsZXIsIHJhdGhlciB0aGFuIHRoZSBjb25zdHJ1Y3RvcgoJCQkJICovCgkJCQlvU2V0dGluZ3Mub0xhbmd1YWdlLnNVcmwgPSBvSW5pdC5vTGFuZ3VhZ2Uuc1VybDsKCQkJCSQuZ2V0SlNPTiggb1NldHRpbmdzLm9MYW5ndWFnZS5zVXJsLCBudWxsLCBmdW5jdGlvbigganNvbiApIHsKCQkJCQlfZm5MYW5ndWFnZUNvbXBhdCgganNvbiApOwoJCQkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3Mub0xhbmd1YWdlLCBvSW5pdC5vTGFuZ3VhZ2UsIGpzb24gKTsKCQkJCQlfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsKCQkJCX0gKTsKCQkJCWJJbml0SGFuZGVkT2ZmID0gdHJ1ZTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3Mub0xhbmd1YWdlLCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIFN0cmlwZXMKCQkJICovCgkJCWlmICggb0luaXQuYXNTdHJpcGVDbGFzc2VzID09PSBudWxsICkKCQkJewoJCQkJb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3NlcyA9WwoJCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkLAoJCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlRXZlbgoJCQkJXTsKCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHJvdyBzdHJpcGUgY2xhc3NlcyBpZiB0aGV5IGFyZSBhbHJlYWR5IG9uIHRoZSB0YWJsZSByb3cgKi8KCQkJaUxlbj1vU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmxlbmd0aDsKCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXMgPSBbXTsKCQkJaWYgKGlMZW4pCgkJCXsKCQkJCXZhciBiU3RyaXBlUmVtb3ZlID0gZmFsc2U7CgkJCQl2YXIgYW5Sb3dzID0gJCh0aGlzKS5jaGlsZHJlbigndGJvZHknKS5jaGlsZHJlbigndHI6bHQoJyArIGlMZW4gKyAnKScpOwoJCQkJZm9yICggaT0wIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFuUm93cy5oYXNDbGFzcyggb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1tpXSApICkKCQkJCQl7CgkJCQkJCWJTdHJpcGVSZW1vdmUgPSB0cnVlOwoJCQkJCQkKCQkJCQkJLyogU3RvcmUgdGhlIGNsYXNzZXMgd2hpY2ggd2UgYXJlIGFib3V0IHRvIHJlbW92ZSBzbyB0aGV5IGNhbiBiZSByZS1hZGRlZCBvbiBkZXN0cm95ICovCgkJCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzLnB1c2goIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbaV0gKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggYlN0cmlwZVJlbW92ZSApCgkJCQl7CgkJCQkJYW5Sb3dzLnJlbW92ZUNsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmpvaW4oJyAnKSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKgoJCQkgKiBDb2x1bW5zCgkJCSAqIFNlZSBpZiB3ZSBzaG91bGQgbG9hZCBjb2x1bW5zIGF1dG9tYXRpY2FsbHkgb3IgdXNlIGRlZmluZWQgb25lcwoJCQkgKi8KCQkJdmFyIGFuVGhzID0gW107CgkJCXZhciBhb0NvbHVtbnNJbml0OwoJCQl2YXIgblRoZWFkID0gdGhpcy5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGhlYWQnKTsKCQkJaWYgKCBuVGhlYWQubGVuZ3RoICE9PSAwICkKCQkJewoJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBvU2V0dGluZ3MuYW9IZWFkZXIsIG5UaGVhZFswXSApOwoJCQkJYW5UaHMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBJZiBub3QgZ2l2ZW4gYSBjb2x1bW4gYXJyYXksIGdlbmVyYXRlIG9uZSB3aXRoIG51bGxzICovCgkJCWlmICggb0luaXQuYW9Db2x1bW5zID09PSBudWxsICkKCQkJewoJCQkJYW9Db2x1bW5zSW5pdCA9IFtdOwoJCQkJZm9yICggaT0wLCBpTGVuPWFuVGhzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYW9Db2x1bW5zSW5pdC5wdXNoKCBudWxsICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlhb0NvbHVtbnNJbml0ID0gb0luaXQuYW9Db2x1bW5zOwoJCQl9CgkJCQoJCQkvKiBBZGQgdGhlIGNvbHVtbnMgKi8KCQkJZm9yICggaT0wLCBpTGVuPWFvQ29sdW1uc0luaXQubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJLyogU2hvcnQgY3V0IC0gdXNlIHRoZSBsb29wIHRvIGNoZWNrIGlmIHdlIGhhdmUgY29sdW1uIHZpc2liaWxpdHkgc3RhdGUgdG8gcmVzdG9yZSAqLwoJCQkJaWYgKCBvSW5pdC5zYXZlZF9hb0NvbHVtbnMgIT09IHVuZGVmaW5lZCAmJiBvSW5pdC5zYXZlZF9hb0NvbHVtbnMubGVuZ3RoID09IGlMZW4gKQoJCQkJewoJCQkJCWlmICggYW9Db2x1bW5zSW5pdFtpXSA9PT0gbnVsbCApCgkJCQkJewoJCQkJCQlhb0NvbHVtbnNJbml0W2ldID0ge307CgkJCQkJfQoJCQkJCWFvQ29sdW1uc0luaXRbaV0uYlZpc2libGUgPSBvSW5pdC5zYXZlZF9hb0NvbHVtbnNbaV0uYlZpc2libGU7CgkJCQl9CgkJCQkKCQkJCV9mbkFkZENvbHVtbiggb1NldHRpbmdzLCBhblRocyA/IGFuVGhzW2ldIDogbnVsbCApOwoJCQl9CgkJCQoJCQkvKiBBcHBseSB0aGUgY29sdW1uIGRlZmluaXRpb25zICovCgkJCV9mbkFwcGx5Q29sdW1uRGVmcyggb1NldHRpbmdzLCBvSW5pdC5hb0NvbHVtbkRlZnMsIGFvQ29sdW1uc0luaXQsIGZ1bmN0aW9uIChpQ29sLCBvRGVmKSB7CgkJCQlfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG9EZWYgKTsKCQkJfSApOwoJCQkKCQkJCgkJCS8qCgkJCSAqIFNvcnRpbmcKCQkJICogQ2hlY2sgdGhlIGFhU29ydGluZyBhcnJheQoJCQkgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdID49IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdID0gMDsKCQkJCX0KCQkJCXZhciBvQ29sdW1uID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSBdOwoJCQkJCgkJCQkvKiBBZGQgYSBkZWZhdWx0IHNvcnRpbmcgaW5kZXggKi8KCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdID0gMDsKCQkJCX0KCQkJCQoJCQkJLyogSWYgYWFTb3J0aW5nIGlzIG5vdCBkZWZpbmVkLCB0aGVuIHdlIHVzZSB0aGUgZmlyc3QgaW5kaWNhdG9yIGluIGFzU29ydGluZyAqLwoJCQkJaWYgKCBvSW5pdC5hYVNvcnRpbmcgPT09IHVuZGVmaW5lZCAmJiBvU2V0dGluZ3Muc2F2ZWRfYWFTb3J0aW5nID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMV0gPSBvQ29sdW1uLmFzU29ydGluZ1swXTsKCQkJCX0KCQkJCQoJCQkJLyogU2V0IHRoZSBjdXJyZW50IHNvcnRpbmcgaW5kZXggYmFzZWQgb24gYW9Db2x1bW5zLmFzU29ydGluZyAqLwoJCQkJZm9yICggaj0wLCBqTGVuPW9Db2x1bW4uYXNTb3J0aW5nLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID09IG9Db2x1bW4uYXNTb3J0aW5nW2pdICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPSBqOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJCQoJCQkvKiBEbyBhIGZpcnN0IHBhc3Mgb24gdGhlIHNvcnRpbmcgY2xhc3NlcyAoYWxsb3dzIGFueSBzaXplIGNoYW5nZXMgdG8gYmUgdGFrZW4gaW50bwoJCQkgKiBhY2NvdW50LCBhbmQgYWxzbyB3aWxsIGFwcGx5IHNvcnRpbmcgZGlzYWJsZWQgY2xhc3NlcyBpZiBkaXNhYmxlZAoJCQkgKi8KCQkJX2ZuU29ydGluZ0NsYXNzZXMoIG9TZXR0aW5ncyApOwoJCQkKCQkJCgkJCS8qCgkJCSAqIEZpbmFsIGluaXQKCQkJICogQ2FjaGUgdGhlIGhlYWRlciwgYm9keSBhbmQgZm9vdGVyIGFzIHJlcXVpcmVkLCBjcmVhdGluZyB0aGVtIGlmIG5lZWRlZAoJCQkgKi8KCQkJCgkJCS8qIEJyb3dzZXIgc3VwcG9ydCBkZXRlY3Rpb24gKi8KCQkJX2ZuQnJvd3NlckRldGVjdCggb1NldHRpbmdzICk7CgkJCQoJCQkvLyBXb3JrIGFyb3VuZCBmb3IgV2Via2l0IGJ1ZyA4Mzg2NyAtIHN0b3JlIHRoZSBjYXB0aW9uLXNpZGUgYmVmb3JlIHJlbW92aW5nIGZyb20gZG9jCgkJCXZhciBjYXB0aW9ucyA9ICQodGhpcykuY2hpbGRyZW4oJ2NhcHRpb24nKS5lYWNoKCBmdW5jdGlvbiAoKSB7CgkJCQl0aGlzLl9jYXB0aW9uU2lkZSA9ICQodGhpcykuY3NzKCdjYXB0aW9uLXNpZGUnKTsKCQkJfSApOwoJCQkKCQkJdmFyIHRoZWFkID0gJCh0aGlzKS5jaGlsZHJlbigndGhlYWQnKTsKCQkJaWYgKCB0aGVhZC5sZW5ndGggPT09IDAgKQoJCQl7CgkJCQl0aGVhZCA9IFsgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RoZWFkJyApIF07CgkJCQl0aGlzLmFwcGVuZENoaWxkKCB0aGVhZFswXSApOwoJCQl9CgkJCW9TZXR0aW5ncy5uVEhlYWQgPSB0aGVhZFswXTsKCQkJCgkJCXZhciB0Ym9keSA9ICQodGhpcykuY2hpbGRyZW4oJ3Rib2R5Jyk7CgkJCWlmICggdGJvZHkubGVuZ3RoID09PSAwICkKCQkJewoJCQkJdGJvZHkgPSBbIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0Ym9keScgKSBdOwoJCQkJdGhpcy5hcHBlbmRDaGlsZCggdGJvZHlbMF0gKTsKCQkJfQoJCQlvU2V0dGluZ3MublRCb2R5ID0gdGJvZHlbMF07CgkJCW9TZXR0aW5ncy5uVEJvZHkuc2V0QXR0cmlidXRlKCAicm9sZSIsICJhbGVydCIgKTsKCQkJb1NldHRpbmdzLm5UQm9keS5zZXRBdHRyaWJ1dGUoICJhcmlhLWxpdmUiLCAicG9saXRlIiApOwoJCQlvU2V0dGluZ3MublRCb2R5LnNldEF0dHJpYnV0ZSggImFyaWEtcmVsZXZhbnQiLCAiYWxsIiApOwoJCQkKCQkJdmFyIHRmb290ID0gJCh0aGlzKS5jaGlsZHJlbigndGZvb3QnKTsKCQkJaWYgKCB0Zm9vdC5sZW5ndGggPT09IDAgJiYgY2FwdGlvbnMubGVuZ3RoID4gMCAmJiAob1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiIHx8IG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIikgKQoJCQl7CgkJCQkvLyBJZiB3ZSBhcmUgYSBzY3JvbGxpbmcgdGFibGUsIGFuZCBubyBmb290ZXIgaGFzIGJlZW4gZ2l2ZW4sIHRoZW4gd2UgbmVlZCB0byBjcmVhdGUKCQkJCS8vIGEgdGZvb3QgZWxlbWVudCBmb3IgdGhlIGNhcHRpb24gZWxlbWVudCB0byBiZSBhcHBlbmRlZCB0bwoJCQkJdGZvb3QgPSBbIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0Zm9vdCcgKSBdOwoJCQkJdGhpcy5hcHBlbmRDaGlsZCggdGZvb3RbMF0gKTsKCQkJfQoJCQkKCQkJaWYgKCB0Zm9vdC5sZW5ndGggPiAwICkKCQkJewoJCQkJb1NldHRpbmdzLm5URm9vdCA9IHRmb290WzBdOwoJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBvU2V0dGluZ3MuYW9Gb290ZXIsIG9TZXR0aW5ncy5uVEZvb3QgKTsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgaWYgdGhlcmUgaXMgZGF0YSBwYXNzaW5nIGludG8gdGhlIGNvbnN0cnVjdG9yICovCgkJCWlmICggYlVzZVBhc3NlZERhdGEgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9Jbml0LmFhRGF0YS5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCV9mbkFkZERhdGEoIG9TZXR0aW5ncywgb0luaXQuYWFEYXRhWyBpIF0gKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIEdyYWIgdGhlIGRhdGEgZnJvbSB0aGUgcGFnZSAqLwoJCQkJX2ZuR2F0aGVyRGF0YSggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIENvcHkgdGhlIGRhdGEgaW5kZXggYXJyYXkgKi8KCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCgkJCS8qIEluaXRpYWxpc2F0aW9uIGNvbXBsZXRlIC0gdGFibGUgY2FuIGJlIGRyYXduICovCgkJCW9TZXR0aW5ncy5iSW5pdGlhbGlzZWQgPSB0cnVlOwoJCQkKCQkJLyogQ2hlY2sgaWYgd2UgbmVlZCB0byBpbml0aWFsaXNlIHRoZSB0YWJsZSAoaXQgbWlnaHQgbm90IGhhdmUgYmVlbiBoYW5kZWQgb2ZmIHRvIHRoZQoJCQkgKiBsYW5ndWFnZSBwcm9jZXNzb3IpCgkJCSAqLwoJCQlpZiAoIGJJbml0SGFuZGVkT2ZmID09PSBmYWxzZSApCgkJCXsKCQkJCV9mbkluaXRpYWxpc2UoIG9TZXR0aW5ncyApOwoJCQl9CgkJfSApOwoJCV90aGF0ID0gbnVsbDsKCQlyZXR1cm4gdGhpczsKCX07CgoJCgkKCS8qKgoJICogUHJvdmlkZSBhIGNvbW1vbiBtZXRob2QgZm9yIHBsdWctaW5zIHRvIGNoZWNrIHRoZSB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgYmVpbmcgdXNlZCwgaW4gb3JkZXIKCSAqIHRvIGVuc3VyZSBjb21wYXRpYmlsaXR5LgoJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJICogICAgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgcmVxdWlyZWQKCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICBhbGVydCggJC5mbi5kYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJICovCglEYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2sgPSBmdW5jdGlvbiggc1ZlcnNpb24gKQoJewoJCS8qIFRoaXMgaXMgY2hlYXAsIGJ1dCBlZmZlY3RpdmUgKi8KCQl2YXIgZm5aUGFkID0gZnVuY3Rpb24gKFpwYWQsIGNvdW50KQoJCXsKCQkJd2hpbGUoWnBhZC5sZW5ndGggPCBjb3VudCkgewoJCQkJWnBhZCArPSAnMCc7CgkJCX0KCQkJcmV0dXJuIFpwYWQ7CgkJfTsKCQl2YXIgYVRoaXMgPSBEYXRhVGFibGUuZXh0LnNWZXJzaW9uLnNwbGl0KCcuJyk7CgkJdmFyIGFUaGF0ID0gc1ZlcnNpb24uc3BsaXQoJy4nKTsKCQl2YXIgc1RoaXMgPSAnJywgc1RoYXQgPSAnJzsKCQkKCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFUaGF0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJewoJCQlzVGhpcyArPSBmblpQYWQoIGFUaGlzW2ldLCAzICk7CgkJCXNUaGF0ICs9IGZuWlBhZCggYVRoYXRbaV0sIDMgKTsKCQl9CgkJCgkJcmV0dXJuIHBhcnNlSW50KHNUaGlzLCAxMCkgPj0gcGFyc2VJbnQoc1RoYXQsIDEwKTsKCX07CgkKCQoJLyoqCgkgKiBDaGVjayBpZiBhIFRBQkxFIG5vZGUgaXMgYSBEYXRhVGFibGUgdGFibGUgYWxyZWFkeSBvciBub3QuCgkgKiAgQHBhcmFtIHtub2RlfSBuVGFibGUgVGhlIFRBQkxFIG5vZGUgdG8gY2hlY2sgaWYgaXQgaXMgYSBEYXRhVGFibGUgb3Igbm90IChub3RlIHRoYXQgb3RoZXIKCSAqICAgIG5vZGUgdHlwZXMgY2FuIGJlIHBhc3NlZCBpbiwgYnV0IHdpbGwgYWx3YXlzIHJldHVybiBmYWxzZSkuCgkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgdGhlIHRhYmxlIGdpdmVuIGlzIGEgRGF0YVRhYmxlLCBvciBmYWxzZSBvdGhlcndpc2UKCSAqICBAc3RhdGljCgkgKiAgQGR0b3B0IEFQSS1TdGF0aWMKCSAqCgkgKiAgQGV4YW1wbGUKCSAqICAgIHZhciBleCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGFtcGxlJyk7CgkgKiAgICBpZiAoICEgJC5mbi5EYXRhVGFibGUuZm5Jc0RhdGFUYWJsZSggZXggKSApIHsKCSAqICAgICAgJChleCkuZGF0YVRhYmxlKCk7CgkgKiAgICB9CgkgKi8KCURhdGFUYWJsZS5mbklzRGF0YVRhYmxlID0gZnVuY3Rpb24gKCBuVGFibGUgKQoJewoJCXZhciBvID0gRGF0YVRhYmxlLnNldHRpbmdzOwoJCgkJZm9yICggdmFyIGk9MCA7IGk8by5sZW5ndGggOyBpKysgKQoJCXsKCQkJaWYgKCBvW2ldLm5UYWJsZSA9PT0gblRhYmxlIHx8IG9baV0ublNjcm9sbEhlYWQgPT09IG5UYWJsZSB8fCBvW2ldLm5TY3JvbGxGb290ID09PSBuVGFibGUgKQoJCQl7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCQoJCXJldHVybiBmYWxzZTsKCX07CgkKCQoJLyoqCgkgKiBHZXQgYWxsIERhdGFUYWJsZSB0YWJsZXMgdGhhdCBoYXZlIGJlZW4gaW5pdGlhbGlzZWQgLSBvcHRpb25hbGx5IHlvdSBjYW4gc2VsZWN0IHRvCgkgKiBnZXQgb25seSBjdXJyZW50bHkgdmlzaWJsZSB0YWJsZXMuCgkgKiAgQHBhcmFtIHtib29sZWFufSBbYlZpc2libGU9ZmFsc2VdIEZsYWcgdG8gaW5kaWNhdGUgaWYgeW91IHdhbnQgYWxsIChkZWZhdWx0KSBvciAKCSAqICAgIHZpc2libGUgdGFibGVzIG9ubHkuCgkgKiAgQHJldHVybnMge2FycmF5fSBBcnJheSBvZiBUQUJMRSBub2RlcyAobm90IERhdGFUYWJsZSBpbnN0YW5jZXMpIHdoaWNoIGFyZSBEYXRhVGFibGVzCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICB2YXIgdGFibGUgPSAkLmZuLmRhdGFUYWJsZS5mblRhYmxlcyh0cnVlKTsKCSAqICAgIGlmICggdGFibGUubGVuZ3RoID4gMCApIHsKCSAqICAgICAgJCh0YWJsZSkuZGF0YVRhYmxlKCkuZm5BZGp1c3RDb2x1bW5TaXppbmcoKTsKCSAqICAgIH0KCSAqLwoJRGF0YVRhYmxlLmZuVGFibGVzID0gZnVuY3Rpb24gKCBiVmlzaWJsZSApCgl7CgkJdmFyIG91dCA9IFtdOwoJCgkJalF1ZXJ5LmVhY2goIERhdGFUYWJsZS5zZXR0aW5ncywgZnVuY3Rpb24gKGksIG8pIHsKCQkJaWYgKCAhYlZpc2libGUgfHwgKGJWaXNpYmxlID09PSB0cnVlICYmICQoby5uVGFibGUpLmlzKCc6dmlzaWJsZScpKSApCgkJCXsKCQkJCW91dC5wdXNoKCBvLm5UYWJsZSApOwoJCQl9CgkJfSApOwoJCgkJcmV0dXJuIG91dDsKCX07CgkKCgkvKioKCSAqIFZlcnNpb24gc3RyaW5nIGZvciBwbHVnLWlucyB0byBjaGVjayBjb21wYXRpYmlsaXR5LiBBbGxvd2VkIGZvcm1hdCBpcwoJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJICogZSBhcmUgb3B0aW9uYWwKCSAqICBAbWVtYmVyCgkgKiAgQHR5cGUgc3RyaW5nCgkgKiAgQGRlZmF1bHQgVmVyc2lvbiBudW1iZXIKCSAqLwoJRGF0YVRhYmxlLnZlcnNpb24gPSAiMS45LjQiOwoKCS8qKgoJICogUHJpdmF0ZSBkYXRhIHN0b3JlLCBjb250YWluaW5nIGFsbCBvZiB0aGUgc2V0dGluZ3Mgb2JqZWN0cyB0aGF0IGFyZSBjcmVhdGVkIGZvciB0aGUKCSAqIHRhYmxlcyBvbiBhIGdpdmVuIHBhZ2UuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlLnNldHRpbmdzPC9pPiBvYmplY3QgaXMgYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlRXh0PC9pPiAKCSAqIHRocm91Z2ggd2hpY2ggaXQgbWF5IGJlIGFjY2Vzc2VkIGFuZCBtYW5pcHVsYXRlZCwgb3IgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZS5zZXR0aW5nczwvaT4uCgkgKiAgQG1lbWJlcgoJICogIEB0eXBlIGFycmF5CgkgKiAgQGRlZmF1bHQgW10KCSAqICBAcHJpdmF0ZQoJICovCglEYXRhVGFibGUuc2V0dGluZ3MgPSBbXTsKCgkvKioKCSAqIE9iamVjdCBtb2RlbHMgY29udGFpbmVyLCBmb3IgdGhlIHZhcmlvdXMgbW9kZWxzIHRoYXQgRGF0YVRhYmxlcyBoYXMgYXZhaWxhYmxlCgkgKiB0byBpdC4gVGhlc2UgbW9kZWxzIGRlZmluZSB0aGUgb2JqZWN0cyB0aGF0IGFyZSB1c2VkIHRvIGhvbGQgdGhlIGFjdGl2ZSBzdGF0ZSAKCSAqIGFuZCBjb25maWd1cmF0aW9uIG9mIHRoZSB0YWJsZS4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMgPSB7fTsKCQoJCgkvKioKCSAqIERhdGFUYWJsZXMgZXh0ZW5zaW9uIG9wdGlvbnMgYW5kIHBsdWctaW5zLiBUaGlzIG5hbWVzcGFjZSBhY3RzIGFzIGEgY29sbGVjdGlvbiAiYXJlYSIKCSAqIGZvciBwbHVnLWlucyB0aGF0IGNhbiBiZSB1c2VkIHRvIGV4dGVuZCB0aGUgZGVmYXVsdCBEYXRhVGFibGVzIGJlaGF2aW91ciAtIGluZGVlZCBtYW55CgkgKiBvZiB0aGUgYnVpbGQgaW4gbWV0aG9kcyB1c2UgdGhpcyBtZXRob2QgdG8gcHJvdmlkZSB0aGVpciBvd24gY2FwYWJpbGl0aWVzIChzb3J0aW5nIG1ldGhvZHMKCSAqIGZvciBleGFtcGxlKS4KCSAqIAoJICogTm90ZSB0aGF0IHRoaXMgbmFtZXNwYWNlIGlzIGFsaWFzZWQgdG8galF1ZXJ5LmZuLmRhdGFUYWJsZUV4dCBzbyBpdCBjYW4gYmUgcmVhZGlseSBhY2Nlc3NlZAoJICogYW5kIG1vZGlmaWVkIGJ5IHBsdWctaW5zLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5leHQgPSB7CgkJLyoqCgkJICogUGx1Zy1pbiBmaWx0ZXJpbmcgZnVuY3Rpb25zIC0gdGhpcyBtZXRob2Qgb2YgZmlsdGVyaW5nIGlzIGNvbXBsaW1lbnRhcnkgdG8gdGhlIGRlZmF1bHQKCQkgKiB0eXBlIGJhc2VkIGZpbHRlcmluZywgYW5kIGEgbG90IG1vcmUgY29tcHJlaGVuc2l2ZSBhcyBpdCBhbGxvd3MgeW91IGNvbXBsZXRlIGNvbnRyb2wKCQkgKiBvdmVyIHRoZSBmaWx0ZXJpbmcgbG9naWMuIEVhY2ggZWxlbWVudCBpbiB0aGlzIGFycmF5IGlzIGEgZnVuY3Rpb24gKHBhcmFtZXRlcnMKCQkgKiBkZXNjcmliZWQgYmVsb3cpIHRoYXQgaXMgY2FsbGVkIGZvciBldmVyeSByb3cgaW4gdGhlIHRhYmxlLCBhbmQgeW91ciBsb2dpYyBkZWNpZGVzIGlmCgkJICogaXQgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBmaWx0ZXJlZCBkYXRhIHNldCBvciBub3QuCgkJICogICA8dWw+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBEYXRhIGZvciB0aGUgcm93IHRvIGJlIHByb2Nlc3NlZCAoc2FtZSBhcyB0aGUgb3JpZ2luYWwgZm9ybWF0CgkJICogICAgICAgICAgIHRoYXQgd2FzIHBhc3NlZCBpbiBhcyB0aGUgZGF0YSBzb3VyY2UsIG9yIGFuIGFycmF5IGZyb20gYSBET00gZGF0YSBzb3VyY2U8L2xpPgoJCSAqICAgICAgICAgPGxpPntpbnR9IFJvdyBpbmRleCBpbiBhb0RhdGEgKHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5ncy5hb0RhdGF9KSwgd2hpY2ggY2FuCgkJICogICAgICAgICAgIGJlIHVzZWZ1bCB0byByZXRyaWV2ZSB0aGUgVFIgZWxlbWVudCBpZiB5b3UgbmVlZCBET00gaW50ZXJhY3Rpb24uPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Ym9vbGVhbn0gSW5jbHVkZSB0aGUgcm93IGluIHRoZSBmaWx0ZXJlZCByZXN1bHQgc2V0ICh0cnVlKSBvciBub3QgKGZhbHNlKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBUaGUgZm9sbG93aW5nIGV4YW1wbGUgc2hvd3MgY3VzdG9tIGZpbHRlcmluZyBiZWluZyBhcHBsaWVkIHRvIHRoZSBmb3VydGggY29sdW1uIChpLmUuCgkJICogICAgLy8gdGhlIGFEYXRhWzNdIGluZGV4KSBiYXNlZCBvbiB0d28gaW5wdXQgdmFsdWVzIGZyb20gdGhlIGVuZC11c2VyLCBtYXRjaGluZyB0aGUgZGF0YSBpbiAKCQkgKiAgICAvLyBhIGNlcnRhaW4gcmFuZ2UuCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQuYWZuRmlsdGVyaW5nLnB1c2goCgkJICogICAgICBmdW5jdGlvbiggb1NldHRpbmdzLCBhRGF0YSwgaURhdGFJbmRleCApIHsKCQkgKiAgICAgICAgdmFyIGlNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWluJykudmFsdWUgKiAxOwoJCSAqICAgICAgICB2YXIgaU1heCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXgnKS52YWx1ZSAqIDE7CgkJICogICAgICAgIHZhciBpVmVyc2lvbiA9IGFEYXRhWzNdID09ICItIiA/IDAgOiBhRGF0YVszXSoxOwoJCSAqICAgICAgICBpZiAoIGlNaW4gPT0gIiIgJiYgaU1heCA9PSAiIiApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICBlbHNlIGlmICggaU1pbiA9PSAiIiAmJiBpVmVyc2lvbiA8IGlNYXggKSB7CgkJICogICAgICAgICAgcmV0dXJuIHRydWU7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgZWxzZSBpZiAoIGlNaW4gPCBpVmVyc2lvbiAmJiAiIiA9PSBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIGVsc2UgaWYgKCBpTWluIDwgaVZlcnNpb24gJiYgaVZlcnNpb24gPCBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgIH0KCQkgKiAgICApOwoJCSAqLwoJCSJhZm5GaWx0ZXJpbmciOiBbXSwKCQoJCgkJLyoqCgkJICogUGx1Zy1pbiBzb3J0aW5nIGZ1bmN0aW9ucyAtIHRoaXMgbWV0aG9kIG9mIHNvcnRpbmcgaXMgY29tcGxpbWVudGFyeSB0byB0aGUgZGVmYXVsdCB0eXBlCgkJICogYmFzZWQgc29ydGluZyB0aGF0IERhdGFUYWJsZXMgZG9lcyBhdXRvbWF0aWNhbGx5LCBhbGxvd2luZyBtdWNoIGdyZWF0ZXIgY29udHJvbCBvdmVyIHRoZQoJCSAqIHRoZSBkYXRhIHRoYXQgaXMgYmVpbmcgdXNlZCB0byBzb3J0IGEgY29sdW1uLiBUaGlzIGlzIHVzZWZ1bCBpZiB5b3Ugd2FudCB0byBkbyBzb3J0aW5nCgkJICogYmFzZWQgb24gbGl2ZSBkYXRhIChmb3IgZXhhbXBsZSB0aGUgY29udGVudHMgb2YgYW4gJ2lucHV0JyBlbGVtZW50KSByYXRoZXIgdGhhbiBqdXN0IHRoZQoJCSAqIHN0YXRpYyBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGtub3dzIG9mLiBUaGUgd2F5IHRoZXNlIHBsdWctaW5zIHdvcmsgaXMgdGhhdCB5b3UgY3JlYXRlCgkJICogYW4gYXJyYXkgb2YgdGhlIHZhbHVlcyB5b3Ugd2lzaCB0byBiZSBzb3J0ZWQgZm9yIHRoZSBjb2x1bW4gaW4gcXVlc3Rpb24gYW5kIHRoZW4gcmV0dXJuCgkJICogdGhhdCBhcnJheS4gV2hpY2ggcHJlLXNvcnRpbmcgZnVuY3Rpb24gaXMgcnVuIGhlcmUgZGVwZW5kcyBvbiB0aGUgc1NvcnREYXRhVHlwZSBwYXJhbWV0ZXIKCQkgKiB0aGF0IGlzIHVzZWQgZm9yIHRoZSBjb2x1bW4gKGlmIGFueSkuIFRoaXMgaXMgdGhlIGNvcm9sbGFyeSBvZiA8aT5vZm5TZWFyY2g8L2k+IGZvciBzb3J0IAoJCSAqIGRhdGEuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCSAgICAgKiAgICAgICAgIDxsaT57aW50fSBUYXJnZXQgY29sdW1uIGluZGV4PC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl9IERhdGEgZm9yIHRoZSBjb2x1bW4gdG8gYmUgc29ydGVkIHVwb248L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICAKCQkgKiBOb3RlIHRoYXQgYXMgb2YgdjEuOSwgaXQgaXMgdHlwaWNhbGx5IHByZWZlcmFibGUgdG8gdXNlIDxpPm1EYXRhPC9pPiB0byBwcmVwYXJlIGRhdGEgZm9yCgkJICogdGhlIGRpZmZlcmVudCB1c2VzIHRoYXQgRGF0YVRhYmxlcyBjYW4gcHV0IHRoZSBkYXRhIHRvLiBTcGVjaWZpY2FsbHkgPGk+bURhdGE8L2k+IHdoZW4KCQkgKiB1c2VkIGFzIGEgZnVuY3Rpb24gd2lsbCBnaXZlIHlvdSBhICd0eXBlJyAoc29ydGluZywgZmlsdGVyaW5nIGV0YykgdGhhdCB5b3UgY2FuIHVzZSB0byAKCQkgKiBwcmVwYXJlIHRoZSBkYXRhIGFzIHJlcXVpcmVkIGZvciB0aGUgZGlmZmVyZW50IHR5cGVzLiBBcyBzdWNoLCB0aGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXBkYXRpbmcgdGhlIGNhY2hlZCBzb3J0aW5nIGluZm9ybWF0aW9uIHdpdGggdXNlciBlbnRlcmVkIHZhbHVlcyBpbiBIVE1MIGlucHV0IGVsZW1lbnRzCgkJICogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5hZm5Tb3J0RGF0YVsnZG9tLXRleHQnXSA9IGZ1bmN0aW9uICggb1NldHRpbmdzLCBpQ29sdW1uICkKCQkgKiAgICB7CgkJICogICAgICB2YXIgYURhdGEgPSBbXTsKCQkgKiAgICAgICQoICd0ZDplcSgnK2lDb2x1bW4rJykgaW5wdXQnLCBvU2V0dGluZ3Mub0FwaS5fZm5HZXRUck5vZGVzKG9TZXR0aW5ncykgKS5lYWNoKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGFEYXRhLnB1c2goIHRoaXMudmFsdWUgKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIHJldHVybiBhRGF0YTsKCQkgKiAgICB9CgkJICovCgkJImFmblNvcnREYXRhIjogW10sCgkKCQoJCS8qKgoJCSAqIEZlYXR1cmUgcGx1Zy1pbnMgLSBUaGlzIGlzIGFuIGFycmF5IG9mIG9iamVjdHMgd2hpY2ggZGVzY3JpYmUgdGhlIGZlYXR1cmUgcGx1Zy1pbnMgdGhhdCBhcmUKCQkgKiBhdmFpbGFibGUgdG8gRGF0YVRhYmxlcy4gVGhlc2UgZmVhdHVyZSBwbHVnLWlucyBhcmUgYWNjZXNzaWJsZSB0aHJvdWdoIHRoZSBzRG9tIGluaXRpYWxpc2F0aW9uCgkJICogb3B0aW9uLiBBcyBzdWNoLCBlYWNoIGZlYXR1cmUgcGx1Zy1pbiBtdXN0IGRlc2NyaWJlIGEgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIHRvIGluaXRpYWxpc2UKCQkgKiBpdHNlbGYgKGZuSW5pdCksIGEgY2hhcmFjdGVyIHNvIHRoZSBmZWF0dXJlIGNhbiBiZSBlbmFibGVkIGJ5IHNEb20gKGNGZWF0dXJlKSBhbmQgdGhlIG5hbWUKCQkgKiBvZiB0aGUgZmVhdHVyZSAoc0ZlYXR1cmUpLiBUaHVzIHRoZSBvYmplY3RzIGF0dGFjaGVkIHRvIHRoaXMgbWV0aG9kIG11c3QgcHJvdmlkZToKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPntmdW5jdGlvbn0gZm5Jbml0IEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwbHVnLWluCgkJICogICAgICAgPHVsPgoJICAgICAqICAgICAgICAgPGxpPgoJICAgICAqICAgICAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntvYmplY3R9IERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0OiBzZWUge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfS48L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntub2RlfG51bGx9IFRoZSBlbGVtZW50IHdoaWNoIGNvbnRhaW5zIHlvdXIgZmVhdHVyZS4gTm90ZSB0aGF0IHRoZSByZXR1cm4KCQkgKiAgICAgICAgICAgICAgICBtYXkgYWxzbyBiZSB2b2lkIGlmIHlvdXIgcGx1Zy1pbiBkb2VzIG5vdCByZXF1aXJlIHRvIGluamVjdCBhbnkgRE9NIGVsZW1lbnRzIAoJCSAqICAgICAgICAgICAgICAgIGludG8gRGF0YVRhYmxlcyBjb250cm9sIChzRG9tKSAtIGZvciBleGFtcGxlIHRoaXMgbWlnaHQgYmUgdXNlZnVsIHdoZW4gCgkJICogICAgICAgICAgICAgICAgZGV2ZWxvcGluZyBhIHBsdWctaW4gd2hpY2ggYWxsb3dzIHRhYmxlIGNvbnRyb2wgdmlhIGtleWJvYXJkIGVudHJ5LjwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvbGk+CgkJICogICAgIDxsaT57Y2hhcmFjdGVyfSBjRmVhdHVyZSBDaGFyYWN0ZXIgdGhhdCB3aWxsIGJlIG1hdGNoZWQgaW4gc0RvbSAtIGNhc2Ugc2Vuc2l0aXZlPC9saT4KCQkgKiAgICAgPGxpPntzdHJpbmd9IHNGZWF0dXJlIEZlYXR1cmUgbmFtZTwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEhvdyBUYWJsZVRvb2xzIGluaXRpYWxpc2VzIGl0c2VsZi4KCQkgKiAgICAkLmZuLmRhdGFUYWJsZUV4dC5hb0ZlYXR1cmVzLnB1c2goIHsKCQkgKiAgICAgICJmbkluaXQiOiBmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCSAqICAgICAgICByZXR1cm4gbmV3IFRhYmxlVG9vbHMoIHsgIm9EVFNldHRpbmdzIjogb1NldHRpbmdzIH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAiY0ZlYXR1cmUiOiAiVCIsCgkJICogICAgICAic0ZlYXR1cmUiOiAiVGFibGVUb29scyIKCQkgKiAgICB9ICk7CgkJICovCgkJImFvRmVhdHVyZXMiOiBbXSwKCQoJCgkJLyoqCgkJICogVHlwZSBkZXRlY3Rpb24gcGx1Zy1pbiBmdW5jdGlvbnMgLSBEYXRhVGFibGVzIHV0aWxpc2VzIHR5cGVzIHRvIGRlZmluZSBob3cgc29ydGluZyBhbmQKCQkgKiBmaWx0ZXJpbmcgYmVoYXZlLCBhbmQgdHlwZXMgY2FuIGJlIGVpdGhlciAgYmUgZGVmaW5lZCBieSB0aGUgZGV2ZWxvcGVyIChzVHlwZSBmb3IgdGhlCgkJICogY29sdW1uKSBvciB0aGV5IGNhbiBiZSBhdXRvbWF0aWNhbGx5IGRldGVjdGVkIGJ5IHRoZSBtZXRob2RzIGluIHRoaXMgYXJyYXkuIFRoZSBmdW5jdGlvbnMKCQkgKiBkZWZpbmVkIGluIHRoZSBhcnJheSBhcmUgcXVpdGUgc2ltcGxlLCB0YWtpbmcgYSBzaW5nbGUgcGFyYW1ldGVyICh0aGUgZGF0YSB0byBhbmFseXNlKSAKCQkgKiBhbmQgcmV0dXJuaW5nIHRoZSB0eXBlIGlmIGl0IGlzIGEga25vd24gdHlwZSwgb3IgbnVsbCBvdGhlcndpc2UuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSBmcm9tIHRoZSBjb2x1bW4gY2VsbCB0byBiZSBhbmFseXNlZDwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e3N0cmluZ3xudWxsfSBEYXRhIHR5cGUgZGV0ZWN0ZWQsIG9yIG51bGwgaWYgdW5rbm93biAoYW5kIHRodXMgcGFzcyBpdAoJCSAqICAgICAgICAgICBvbiB0byB0aGUgb3RoZXIgdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEN1cnJlbmN5IHR5cGUgZGV0ZWN0aW9uIHBsdWctaW46CgkJICogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5hVHlwZXMucHVzaCgKCQkgKiAgICAgIGZ1bmN0aW9uICggc0RhdGEgKSB7CgkJICogICAgICAgIHZhciBzVmFsaWRDaGFycyA9ICIwMTIzNDU2Nzg5Li0iOwoJCSAqICAgICAgICB2YXIgQ2hhcjsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIENoZWNrIHRoZSBudW1lcmljIHBhcnQKCQkgKiAgICAgICAgZm9yICggaT0xIDsgaTxzRGF0YS5sZW5ndGggOyBpKysgKSB7CgkJICogICAgICAgICAgQ2hhciA9IHNEYXRhLmNoYXJBdChpKTsgCgkJICogICAgICAgICAgaWYgKHNWYWxpZENoYXJzLmluZGV4T2YoQ2hhcikgPT0gLTEpIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBudWxsOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gQ2hlY2sgcHJlZml4ZWQgYnkgY3VycmVuY3kKCQkgKiAgICAgICAgaWYgKCBzRGF0YS5jaGFyQXQoMCkgPT0gJyQnIHx8IHNEYXRhLmNoYXJBdCgwKSA9PSAnJnBvdW5kOycgKSB7CgkJICogICAgICAgICAgcmV0dXJuICdjdXJyZW5jeSc7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgcmV0dXJuIG51bGw7CgkJICogICAgICB9CgkJICogICAgKTsKCQkgKi8KCQkiYVR5cGVzIjogW10sCgkKCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIAoJCSAqIGluIG9yZGVyIHRvIGVuc3VyZSBjb21wYXRpYmlsaXR5LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZlcnNpb24gVmVyc2lvbiBzdHJpbmcgdG8gY2hlY2sgZm9yLCBpbiB0aGUgZm9ybWF0ICJYLlkuWiIuIE5vdGUgCgkJICogICAgdGhhdCB0aGUgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIAoJCSAqICAgIHJlcXVpcmVkIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgYWxlcnQoIG9UYWJsZS5mblZlcnNpb25DaGVjayggJzEuOS4wJyApICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblZlcnNpb25DaGVjayI6IERhdGFUYWJsZS5mblZlcnNpb25DaGVjaywKCQoJCgkJLyoqCgkJICogSW5kZXggZm9yIHdoYXQgJ3RoaXMnIGluZGV4IEFQSSBmdW5jdGlvbnMgc2hvdWxkIHVzZQoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJpQXBpSW5kZXgiOiAwLAoJCgkKCQkvKioKCQkgKiBQcmUtcHJvY2Vzc2luZyBvZiBmaWx0ZXJpbmcgZGF0YSBwbHVnLWlucyAtIFdoZW4geW91IGFzc2lnbiB0aGUgc1R5cGUgZm9yIGEgY29sdW1uCgkJICogKG9yIGhhdmUgaXQgYXV0b21hdGljYWxseSBkZXRlY3RlZCBmb3IgeW91IGJ5IERhdGFUYWJsZXMgb3IgYSB0eXBlIGRldGVjdGlvbiBwbHVnLWluKSwgCgkJICogeW91IHdpbGwgdHlwaWNhbGx5IGJlIHVzaW5nIHRoaXMgZm9yIGN1c3RvbSBzb3J0aW5nLCBidXQgaXQgY2FuIGFsc28gYmUgdXNlZCB0byBwcm92aWRlIAoJCSAqIGN1c3RvbSBmaWx0ZXJpbmcgYnkgYWxsb3dpbmcgeW91IHRvIHByZS1wcm9jZXNzaW5nIHRoZSBkYXRhIGFuZCByZXR1cm5pbmcgdGhlIGRhdGEgaW4KCQkgKiB0aGUgZm9ybWF0IHRoYXQgc2hvdWxkIGJlIGZpbHRlcmVkIHVwb24uIFRoaXMgaXMgZG9uZSBieSBhZGRpbmcgZnVuY3Rpb25zIHRoaXMgb2JqZWN0IAoJCSAqIHdpdGggYSBwYXJhbWV0ZXIgbmFtZSB3aGljaCBtYXRjaGVzIHRoZSBzVHlwZSBmb3IgdGhhdCB0YXJnZXQgY29sdW1uLiBUaGlzIGlzIHRoZQoJCSAqIGNvcm9sbGFyeSBvZiA8aT5hZm5Tb3J0RGF0YTwvaT4gZm9yIGZpbHRlcmluZyBkYXRhLgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+eyp9IERhdGEgZnJvbSB0aGUgY29sdW1uIGNlbGwgdG8gYmUgcHJlcGFyZWQgZm9yIGZpbHRlcmluZzwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e3N0cmluZ3xudWxsfSBGb3JtYXR0ZWQgc3RyaW5nIHRoYXQgd2lsbCBiZSB1c2VkIGZvciB0aGUgZmlsdGVyaW5nLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogCgkJICogTm90ZSB0aGF0IGFzIG9mIHYxLjksIGl0IGlzIHR5cGljYWxseSBwcmVmZXJhYmxlIHRvIHVzZSA8aT5tRGF0YTwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhPC9pPiB3aGVuCgkJICogdXNlZCBhcyBhIGZ1bmN0aW9uIHdpbGwgZ2l2ZSB5b3UgYSAndHlwZScgKHNvcnRpbmcsIGZpbHRlcmluZyBldGMpIHRoYXQgeW91IGNhbiB1c2UgdG8gCgkJICogcHJlcGFyZSB0aGUgZGF0YSBhcyByZXF1aXJlZCBmb3IgdGhlIGRpZmZlcmVudCB0eXBlcy4gQXMgc3VjaCwgdGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZC4KCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICogIEBkZXByZWNhdGVkCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkLmZuLmRhdGFUYWJsZUV4dC5vZm5TZWFyY2hbJ3RpdGxlLW51bWVyaWMnXSA9IGZ1bmN0aW9uICggc0RhdGEgKSB7CgkJICogICAgICByZXR1cm4gc0RhdGEucmVwbGFjZSgvXG4vZywiICIpLnJlcGxhY2UoIC88Lio/Pi9nLCAiIiApOwoJCSAqICAgIH0KCQkgKi8KCQkib2ZuU2VhcmNoIjoge30sCgkKCQoJCS8qKgoJCSAqIENvbnRhaW5lciBmb3IgYWxsIHByaXZhdGUgZnVuY3Rpb25zIGluIERhdGFUYWJsZXMgc28gdGhleSBjYW4gYmUgZXhwb3NlZCBleHRlcm5hbGx5CgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvQXBpIjoge30sCgkKCQoJCS8qKgoJCSAqIFN0b3JhZ2UgZm9yIHRoZSB2YXJpb3VzIGNsYXNzZXMgdGhhdCBEYXRhVGFibGVzIHVzZXMKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICovCgkJIm9TdGRDbGFzc2VzIjoge30sCgkJCgkKCQkvKioKCQkgKiBTdG9yYWdlIGZvciB0aGUgdmFyaW91cyBjbGFzc2VzIHRoYXQgRGF0YVRhYmxlcyB1c2VzIC0galF1ZXJ5IFVJIHN1aXRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvSlVJQ2xhc3NlcyI6IHt9LAoJCgkKCQkvKioKCQkgKiBQYWdpbmF0aW9uIHBsdWctaW4gbWV0aG9kcyAtIFRoZSBzdHlsZSBhbmQgY29udHJvbHMgb2YgdGhlIHBhZ2luYXRpb24gY2FuIHNpZ25pZmljYW50bHkgCgkJICogaW1wYWN0IG9uIGhvdyB0aGUgZW5kIHVzZXIgaW50ZXJhY3RzIHdpdGggdGhlIGRhdGEgaW4geW91ciB0YWJsZSwgYW5kIERhdGFUYWJsZXMgYWxsb3dzIAoJCSAqIHRoZSBhZGRpdGlvbiBvZiBwYWdpbmF0aW9uIGNvbnRyb2xzIGJ5IGV4dGVuZGluZyB0aGlzIG9iamVjdCwgd2hpY2ggY2FuIHRoZW4gYmUgZW5hYmxlZAoJCSAqIHRocm91Z2ggdGhlIDxpPnNQYWdpbmF0aW9uVHlwZTwvaT4gaW5pdGlhbGlzYXRpb24gcGFyYW1ldGVyLiBFYWNoIHBhZ2luYXRpb24gdHlwZSB0aGF0CgkJICogaXMgYWRkZWQgaXMgYW4gb2JqZWN0ICh0aGUgcHJvcGVydHkgbmFtZSBvZiB3aGljaCBpcyB3aGF0IDxpPnNQYWdpbmF0aW9uVHlwZTwvaT4gcmVmZXJzCgkJICogdG8pIHRoYXQgaGFzIHR3byBwcm9wZXJ0aWVzLCBib3RoIG1ldGhvZHMgdGhhdCBhcmUgdXNlZCBieSBEYXRhVGFibGVzIHRvIHVwZGF0ZSB0aGUKCQkgKiBjb250cm9sJ3Mgc3RhdGUuCgkJICogICA8dWw+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBmbkluaXQgLSAgSW5pdGlhbGlzYXRpb24gb2YgdGhlIHBhZ2luZyBjb250cm9scy4gQ2FsbGVkIG9ubHkgZHVyaW5nIGluaXRpYWxpc2F0aW9uIAoJCSAqICAgICAgICAgb2YgdGhlIHRhYmxlLiBJdCBpcyBleHBlY3RlZCB0aGF0IHRoaXMgZnVuY3Rpb24gd2lsbCBhZGQgdGhlIHJlcXVpcmVkIERPTSBlbGVtZW50cyAKCQkgKiAgICAgICAgIHRvIHRoZSBwYWdlIGZvciB0aGUgcGFnaW5nIGNvbnRyb2xzIHRvIHdvcmsuIFRoZSBlbGVtZW50IHBvaW50ZXIgCgkJICogICAgICAgICAnb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAnIGFycmF5IGlzIHByb3ZpZGVkIGJ5IERhdGFUYWJsZXMgdG8gY29udGFpbiB0aGUgcGFnaW5nIAoJCSAqICAgICAgICAgY29udHJvbHMgKG5vdGUgdGhhdCB0aGlzIGlzIGEgMkQgYXJyYXkgdG8gYWxsb3cgZm9yIG11bHRpcGxlIGluc3RhbmNlcyBvZiBlYWNoIAoJCSAqICAgICAgICAgRGF0YVRhYmxlcyBET00gZWxlbWVudCkuIEl0IGlzIHN1Z2dlc3RlZCB0aGF0IHlvdSBhZGQgdGhlIGNvbnRyb2xzIHRvIHRoaXMgZWxlbWVudCAKCQkgKiAgICAgICAgIGFzIGNoaWxkcmVuCgkJICogICAgICAgPHVsPgoJICAgICAqICAgICAgICAgPGxpPgoJICAgICAqICAgICAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntvYmplY3R9IERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0OiBzZWUge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfS48L2xpPgoJCSAqICAgICAgICAgICAgIDxsaT57bm9kZX0gQ29udGFpbmVyIGludG8gd2hpY2ggdGhlIHBhZ2luYXRpb24gY29udHJvbHMgbXVzdCBiZSBpbnNlcnRlZDwvbGk+CgkJICogICAgICAgICAgICAgPGxpPntmdW5jdGlvbn0gRHJhdyBjYWxsYmFjayBmdW5jdGlvbiAtIHdoZW5ldmVyIHRoZSBjb250cm9scyBjYXVzZSBhIHBhZ2UKCQkgKiAgICAgICAgICAgICAgIGNoYW5nZSwgdGhpcyBtZXRob2QgbXVzdCBiZSBjYWxsZWQgdG8gcmVkcmF3IHRoZSB0YWJsZS48L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPk5vIHJldHVybiByZXF1aXJlZDwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBmbkluaXQgLSAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIgdGhlIHBhZ2luZyBzdGF0dXMgb2YgdGhlIHRhYmxlIGNoYW5nZXMgYW5kIGlzCgkJICogICAgICAgICB0eXBpY2FsbHkgdXNlZCB0byB1cGRhdGUgY2xhc3NlcyBhbmQvb3IgdGV4dCBvZiB0aGUgcGFnaW5nIGNvbnRyb2xzIHRvIHJlZmxleCB0aGUgbmV3IAoJCSAqICAgICAgICAgc3RhdHVzLgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgICAgICA8bGk+e2Z1bmN0aW9ufSBEcmF3IGNhbGxiYWNrIGZ1bmN0aW9uIC0gaW4gY2FzZSB5b3UgbmVlZCB0byByZWRyYXcgdGhlIHRhYmxlIGFnYWluCgkJICogICAgICAgICAgICAgICBvciBhdHRhY2ggbmV3IGV2ZW50IGxpc3RlbmVyczwvbGk+CgkgICAgICogICAgICAgICAgIDwvdWw+CgkgICAgICogICAgICAgICA8L2xpPgoJCSAqICAgICAgICAgPGxpPgoJCSAqICAgICAgICAgICBGdW5jdGlvbiByZXR1cm46CgkJICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+Tm8gcmV0dXJuIHJlcXVpcmVkPC9saT4KCQkgKiAgICAgICAgICAgPC91bD4KCQkgKiAgICAgICAgIDwvaWw+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24uZm91cl9idXR0b24gPSB7CgkJICogICAgICAiZm5Jbml0IjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIG5QYWdpbmcsIGZuQ2FsbGJhY2tEcmF3ICkgewoJCSAqICAgICAgICBuRmlyc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnc3BhbicgKTsKCQkgKiAgICAgICAgblByZXZpb3VzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5OZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5MYXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICBuRmlyc3QuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zRmlyc3QgKSApOwoJCSAqICAgICAgICBuUHJldmlvdXMuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zUHJldmlvdXMgKSApOwoJCSAqICAgICAgICBuTmV4dC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlLnNOZXh0ICkgKTsKCQkgKiAgICAgICAgbkxhc3QuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zTGFzdCApICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICBuRmlyc3QuY2xhc3NOYW1lID0gInBhZ2luYXRlX2J1dHRvbiBmaXJzdCI7CgkJICogICAgICAgIG5QcmV2aW91cy5jbGFzc05hbWUgPSAicGFnaW5hdGVfYnV0dG9uIHByZXZpb3VzIjsKCQkgKiAgICAgICAgbk5leHQuY2xhc3NOYW1lPSJwYWdpbmF0ZV9idXR0b24gbmV4dCI7CgkJICogICAgICAgIG5MYXN0LmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9idXR0b24gbGFzdCI7CgkJICogICAgICAgIAoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuRmlyc3QgKTsKCQkgKiAgICAgICAgblBhZ2luZy5hcHBlbmRDaGlsZCggblByZXZpb3VzICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5OZXh0ICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5MYXN0ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5GaXJzdCkuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgICBvU2V0dGluZ3Mub0FwaS5fZm5QYWdlQ2hhbmdlKCBvU2V0dGluZ3MsICJmaXJzdCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQoblByZXZpb3VzKS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAicHJldmlvdXMiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5OZXh0KS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAibmV4dCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQobkxhc3QpLmNsaWNrKCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICAgICBvU2V0dGluZ3Mub0FwaS5fZm5QYWdlQ2hhbmdlKCBvU2V0dGluZ3MsICJsYXN0IiApOwoJCSAqICAgICAgICAgIGZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkgKiAgICAgICAgfSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuRmlyc3QpLmJpbmQoICdzZWxlY3RzdGFydCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZhbHNlOyB9ICk7CgkJICogICAgICAgICQoblByZXZpb3VzKS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5OZXh0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5MYXN0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgfSwKCQkgKiAgICAgIAoJCSAqICAgICAgImZuVXBkYXRlIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGZuQ2FsbGJhY2tEcmF3ICkgewoJCSAqICAgICAgICBpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApIHsKCQkgKiAgICAgICAgICByZXR1cm47CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlcgoJCSAqICAgICAgICB2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucDsKCQkgKiAgICAgICAgZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKSB7CgkJICogICAgICAgICAgdmFyIGJ1dHRvbnMgPSBhbltpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3BhbicpOwoJCSAqICAgICAgICAgIGlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID09PSAwICkgewoJCSAqICAgICAgICAgICAgYnV0dG9uc1swXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1sxXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICBlbHNlIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMF0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1sxXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZW5hYmxlZF9wcmV2aW91cyI7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICAgIAoJCSAqICAgICAgICAgIGlmICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpID09IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKSB7CgkJICogICAgICAgICAgICBidXR0b25zWzJdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbM10uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX25leHQiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICBlbHNlIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMl0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfbmV4dCI7CgkJICogICAgICAgICAgICBidXR0b25zWzNdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgfQoJCSAqICAgIH07CgkJICovCgkJIm9QYWdpbmF0aW9uIjoge30sCgkKCQoJCS8qKgoJCSAqIFNvcnRpbmcgcGx1Zy1pbiBtZXRob2RzIC0gU29ydGluZyBpbiBEYXRhVGFibGVzIGlzIGJhc2VkIG9uIHRoZSBkZXRlY3RlZCB0eXBlIG9mIHRoZQoJCSAqIGRhdGEgY29sdW1uICh5b3UgY2FuIGFkZCB5b3VyIG93biB0eXBlIGRldGVjdGlvbiBmdW5jdGlvbnMsIG9yIG92ZXJyaWRlIGF1dG9tYXRpYyAKCQkgKiBkZXRlY3Rpb24gdXNpbmcgc1R5cGUpLiBXaXRoIHRoaXMgc3BlY2lmaWMgdHlwZSBnaXZlbiB0byB0aGUgY29sdW1uLCBEYXRhVGFibGVzIHdpbGwgCgkJICogYXBwbHkgdGhlIHJlcXVpcmVkIHNvcnQgZnJvbSB0aGUgZnVuY3Rpb25zIGluIHRoZSBvYmplY3QuIEVhY2ggc29ydCB0eXBlIG11c3QgcHJvdmlkZQoJCSAqIHR3byBtYW5kYXRvcnkgbWV0aG9kcywgb25lIGVhY2ggZm9yIGFzY2VuZGluZyBhbmQgZGVzY2VuZGluZyBzb3J0aW5nLCBhbmQgY2FuIG9wdGlvbmFsbHkKCQkgKiBwcm92aWRlIGEgcHJlLWZvcm1hdHRpbmcgbWV0aG9kIHRoYXQgd2lsbCBoZWxwIHNwZWVkIHVwIHNvcnRpbmcgYnkgYWxsb3dpbmcgRGF0YVRhYmxlcwoJCSAqIHRvIHByZS1mb3JtYXQgdGhlIHNvcnQgZGF0YSBvbmx5IG9uY2UgKHJhdGhlciB0aGFuIGV2ZXJ5IHRpbWUgdGhlIGFjdHVhbCBzb3J0IGZ1bmN0aW9ucwoJCSAqIGFyZSBydW4pLiBUaGUgdHdvIHNvcnRpbmcgZnVuY3Rpb25zIGFyZSB0eXBpY2FsIEphdmFzY3JpcHQgc29ydCBtZXRob2RzOgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+eyp9IERhdGEgdG8gY29tcGFyZSB0byB0aGUgc2Vjb25kIHBhcmFtZXRlcjwvbGk+CgkJICogICAgICAgICA8bGk+eyp9IERhdGEgdG8gY29tcGFyZSB0byB0aGUgZmlyc3QgcGFyYW1ldGVyPC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57aW50fSBTb3J0aW5nIG1hdGNoOiA8MCBpZiBmaXJzdCBwYXJhbWV0ZXIgc2hvdWxkIGJlIHNvcnRlZCBsb3dlciB0aGFuCgkJICogICAgICAgICAgIHRoZSBzZWNvbmQgcGFyYW1ldGVyLCA9PT0wIGlmIHRoZSB0d28gcGFyYW1ldGVycyBhcmUgZXF1YWwgYW5kID4wIGlmCgkJICogICAgICAgICAgIHRoZSBmaXJzdCBwYXJhbWV0ZXIgc2hvdWxkIGJlIHNvcnRlZCBoZWlnaHQgdGhhbiB0aGUgc2Vjb25kIHBhcmFtZXRlci48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIENhc2Utc2Vuc2l0aXZlIHN0cmluZyBzb3J0aW5nLCB3aXRoIG5vIHByZS1mb3JtYXR0aW5nIG1ldGhvZAoJCSAqICAgICQuZXh0ZW5kKCAkLmZuLmRhdGFUYWJsZUV4dC5vU29ydCwgewoJCSAqICAgICAgInN0cmluZy1jYXNlLWFzYyI6IGZ1bmN0aW9uKHgseSkgewoJCSAqICAgICAgICByZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAic3RyaW5nLWNhc2UtZGVzYyI6IGZ1bmN0aW9uKHgseSkgewoJCSAqICAgICAgICByZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQkgKiAgICAgIH0KCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDYXNlLWluc2Vuc2l0aXZlIHN0cmluZyBzb3J0aW5nLCB3aXRoIHByZS1mb3JtYXR0aW5nCgkJICogICAgJC5leHRlbmQoICQuZm4uZGF0YVRhYmxlRXh0Lm9Tb3J0LCB7CgkJICogICAgICAic3RyaW5nLXByZSI6IGZ1bmN0aW9uKHgpIHsKCQkgKiAgICAgICAgcmV0dXJuIHgudG9Mb3dlckNhc2UoKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAic3RyaW5nLWFzYyI6IGZ1bmN0aW9uKHgseSkgewoJCSAqICAgICAgICByZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAic3RyaW5nLWRlc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJICogICAgICB9CgkJICogICAgfSApOwoJCSAqLwoJCSJvU29ydCI6IHt9LAoJCgkKCQkvKioKCQkgKiBWZXJzaW9uIHN0cmluZyBmb3IgcGx1Zy1pbnMgdG8gY2hlY2sgY29tcGF0aWJpbGl0eS4gQWxsb3dlZCBmb3JtYXQgaXMKCQkgKiBhLmIuYy5kLmUgd2hlcmU6IGE6aW50LCBiOmludCwgYzppbnQsIGQ6c3RyaW5nKGRldnxiZXRhKSwgZTppbnQuIGQgYW5kCgkJICogZSBhcmUgb3B0aW9uYWwKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IFZlcnNpb24gbnVtYmVyCgkJICovCgkJInNWZXJzaW9uIjogRGF0YVRhYmxlLnZlcnNpb24sCgkKCQoJCS8qKgoJCSAqIEhvdyBzaG91bGQgRGF0YVRhYmxlcyByZXBvcnQgYW4gZXJyb3IuIENhbiB0YWtlIHRoZSB2YWx1ZSAnYWxlcnQnIG9yICd0aHJvdycKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGFsZXJ0CgkJICovCgkJInNFcnJNb2RlIjogImFsZXJ0IiwKCQoJCgkJLyoqCgkJICogU3RvcmUgaW5mb3JtYXRpb24gZm9yIERhdGFUYWJsZXMgdG8gYWNjZXNzIGdsb2JhbGx5IGFib3V0IG90aGVyIGluc3RhbmNlcwoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9vRXh0ZXJuQ29uZmlnIjogewoJCQkvKiBpbnQ6aU5leHRVbmlxdWUgLSBuZXh0IHVuaXF1ZSBudW1iZXIgZm9yIGFuIGluc3RhbmNlICovCgkJCSJpTmV4dFVuaXF1ZSI6IDAKCQl9Cgl9OwoJCgkKCQoJCgkvKioKCSAqIFRlbXBsYXRlIG9iamVjdCBmb3IgdGhlIHdheSBpbiB3aGljaCBEYXRhVGFibGVzIGhvbGRzIGluZm9ybWF0aW9uIGFib3V0CgkgKiBzZWFyY2ggaW5mb3JtYXRpb24gZm9yIHRoZSBnbG9iYWwgZmlsdGVyIGFuZCBpbmRpdmlkdWFsIGNvbHVtbiBmaWx0ZXJzLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoID0gewoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgdGhlIGZpbHRlcmluZyBzaG91bGQgYmUgY2FzZSBpbnNlbnNpdGl2ZSBvciBub3QKCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICovCgkJImJDYXNlSW5zZW5zaXRpdmUiOiB0cnVlLAoJCgkJLyoqCgkJICogQXBwbGllZCBzZWFyY2ggdGVybQoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqLwoJCSJzU2VhcmNoIjogIiIsCgkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBzZWFyY2ggdGVybSBzaG91bGQgYmUgaW50ZXJwcmV0ZWQgYXMgYQoJCSAqIHJlZ3VsYXIgZXhwcmVzc2lvbiAodHJ1ZSkgb3Igbm90IChmYWxzZSkgYW5kIHRoZXJlZm9yZSBhbmQgc3BlY2lhbAoJCSAqIHJlZ2V4IGNoYXJhY3RlcnMgZXNjYXBlZC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCSJiUmVnZXgiOiBmYWxzZSwKCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgRGF0YVRhYmxlcyBpcyB0byB1c2UgaXRzIHNtYXJ0IGZpbHRlcmluZyBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiU21hcnQiOiB0cnVlCgl9OwoJCgkKCQoJCgkvKioKCSAqIFRlbXBsYXRlIG9iamVjdCBmb3IgdGhlIHdheSBpbiB3aGljaCBEYXRhVGFibGVzIGhvbGRzIGluZm9ybWF0aW9uIGFib3V0CgkgKiBlYWNoIGluZGl2aWR1YWwgcm93LiBUaGlzIGlzIHRoZSBvYmplY3QgZm9ybWF0IHVzZWQgZm9yIHRoZSBzZXR0aW5ncyAKCSAqIGFvRGF0YSBhcnJheS4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1JvdyA9IHsKCQkvKioKCQkgKiBUUiBlbGVtZW50IGZvciB0aGUgcm93CgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVHIiOiBudWxsLAoJCgkJLyoqCgkJICogRGF0YSBvYmplY3QgZnJvbSB0aGUgb3JpZ2luYWwgZGF0YSBzb3VyY2UgZm9yIHRoZSByb3cuIFRoaXMgaXMgZWl0aGVyCgkJICogYW4gYXJyYXkgaWYgdXNpbmcgdGhlIHRyYWRpdGlvbmFsIGZvcm0gb2YgRGF0YVRhYmxlcywgb3IgYW4gb2JqZWN0IGlmCgkJICogdXNpbmcgbURhdGEgb3B0aW9ucy4gVGhlIGV4YWN0IHR5cGUgd2lsbCBkZXBlbmQgb24gdGhlIHBhc3NlZCBpbgoJCSAqIGRhdGEgZnJvbSB0aGUgZGF0YSBzb3VyY2UsIG9yIHdpbGwgYmUgYW4gYXJyYXkgaWYgdXNpbmcgRE9NIGEgZGF0YSAKCQkgKiBzb3VyY2UuCgkJICogIEB0eXBlIGFycmF5fG9iamVjdAoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJfYURhdGEiOiBbXSwKCQoJCS8qKgoJCSAqIFNvcnRpbmcgZGF0YSBjYWNoZSAtIHRoaXMgYXJyYXkgaXMgb3N0ZW5zaWJseSB0aGUgc2FtZSBsZW5ndGggYXMgdGhlCgkJICogbnVtYmVyIG9mIGNvbHVtbnMgKGFsdGhvdWdoIGVhY2ggaW5kZXggaXMgZ2VuZXJhdGVkIG9ubHkgYXMgaXQgaXMgCgkJICogbmVlZGVkKSwgYW5kIGhvbGRzIHRoZSBkYXRhIHRoYXQgaXMgdXNlZCBmb3Igc29ydGluZyBlYWNoIGNvbHVtbiBpbiB0aGUKCQkgKiByb3cuIFdlIGRvIHRoaXMgY2FjaGUgZ2VuZXJhdGlvbiBhdCB0aGUgc3RhcnQgb2YgdGhlIHNvcnQgaW4gb3JkZXIgdGhhdAoJCSAqIHRoZSBmb3JtYXR0aW5nIG9mIHRoZSBzb3J0IGRhdGEgbmVlZCBiZSBkb25lIG9ubHkgb25jZSBmb3IgZWFjaCBjZWxsCgkJICogcGVyIHNvcnQuIFRoaXMgYXJyYXkgc2hvdWxkIG5vdCBiZSByZWFkIGZyb20gb3Igd3JpdHRlbiB0byBieSBhbnl0aGluZwoJCSAqIG90aGVyIHRoYW4gdGhlIG1hc3RlciBzb3J0aW5nIG1ldGhvZHMuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9hU29ydERhdGEiOiBbXSwKCQoJCS8qKgoJCSAqIEFycmF5IG9mIFREIGVsZW1lbnRzIHRoYXQgYXJlIGNhY2hlZCBmb3IgaGlkZGVuIHJvd3MsIHNvIHRoZXkgY2FuIGJlCgkJICogcmVpbnNlcnRlZCBpbnRvIHRoZSB0YWJsZSBpZiBhIGNvbHVtbiBpcyBtYWRlIHZpc2libGUgYWdhaW4gKG9yIHRvIGFjdAoJCSAqIGFzIGEgc3RvcmUgaWYgYSBjb2x1bW4gaXMgbWFkZSBoaWRkZW4pLiBPbmx5IGhpZGRlbiBjb2x1bW5zIGhhdmUgYSAKCQkgKiByZWZlcmVuY2UgaW4gdGhlIGFycmF5LiBGb3Igbm9uLWhpZGRlbiBjb2x1bW5zIHRoZSB2YWx1ZSBpcyBlaXRoZXIKCQkgKiB1bmRlZmluZWQgb3IgbnVsbC4KCQkgKiAgQHR5cGUgYXJyYXkgbm9kZXMKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2FuSGlkZGVuIjogW10sCgkKCQkvKioKCQkgKiBDYWNoZSBvZiB0aGUgY2xhc3MgbmFtZSB0aGF0IERhdGFUYWJsZXMgaGFzIGFwcGxpZWQgdG8gdGhlIHJvdywgc28gd2UKCQkgKiBjYW4gcXVpY2tseSBsb29rIGF0IHRoaXMgdmFyaWFibGUgcmF0aGVyIHRoYW4gbmVlZGluZyB0byBkbyBhIERPTSBjaGVjawoJCSAqIG9uIGNsYXNzTmFtZSBmb3IgdGhlIG5UciBwcm9wZXJ0eS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX3NSb3dTdHJpcGUiOiAiIgoJfTsKCQoJCgkKCS8qKgoJICogVGVtcGxhdGUgb2JqZWN0IGZvciB0aGUgY29sdW1uIGluZm9ybWF0aW9uIG9iamVjdCBpbiBEYXRhVGFibGVzLiBUaGlzIG9iamVjdAoJICogaXMgaGVsZCBpbiB0aGUgc2V0dGluZ3MgYW9Db2x1bW5zIGFycmF5IGFuZCBjb250YWlucyBhbGwgdGhlIGluZm9ybWF0aW9uIHRoYXQKCSAqIERhdGFUYWJsZXMgbmVlZHMgYWJvdXQgZWFjaCBpbmRpdmlkdWFsIGNvbHVtbi4KCSAqIAoJICogTm90ZSB0aGF0IHRoaXMgb2JqZWN0IGlzIHJlbGF0ZWQgdG8ge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zfSAKCSAqIGJ1dCB0aGlzIG9uZSBpcyB0aGUgaW50ZXJuYWwgZGF0YSBzdG9yZSBmb3IgRGF0YVRhYmxlcydzIGNhY2hlIG9mIGNvbHVtbnMuCgkgKiBJdCBzaG91bGQgTk9UIGJlIG1hbmlwdWxhdGVkIG91dHNpZGUgb2YgRGF0YVRhYmxlcy4gQW55IGNvbmZpZ3VyYXRpb24gc2hvdWxkCgkgKiBiZSBkb25lIHRocm91Z2ggdGhlIGluaXRpYWxpc2F0aW9uIG9wdGlvbnMuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzLm9Db2x1bW4gPSB7CgkJLyoqCgkJICogQSBsaXN0IG9mIHRoZSBjb2x1bW5zIHRoYXQgc29ydGluZyBzaG91bGQgb2NjdXIgb24gd2hlbiB0aGlzIGNvbHVtbgoJCSAqIGlzIHNvcnRlZC4gVGhhdCB0aGlzIHByb3BlcnR5IGlzIGFuIGFycmF5IGFsbG93cyBtdWx0aS1jb2x1bW4gc29ydGluZwoJCSAqIHRvIGJlIGRlZmluZWQgZm9yIGEgY29sdW1uIChmb3IgZXhhbXBsZSBmaXJzdCBuYW1lIC8gbGFzdCBuYW1lIGNvbHVtbnMKCQkgKiB3b3VsZCBiZW5lZml0IGZyb20gdGhpcykuIFRoZSB2YWx1ZXMgYXJlIGludGVnZXJzIHBvaW50aW5nIHRvIHRoZQoJCSAqIGNvbHVtbnMgdG8gYmUgc29ydGVkIG9uICh0eXBpY2FsbHkgaXQgd2lsbCBiZSBhIHNpbmdsZSBpbnRlZ2VyIHBvaW50aW5nCgkJICogYXQgaXRzZWxmLCBidXQgdGhhdCBkb2Vzbid0IG5lZWQgdG8gYmUgdGhlIGNhc2UpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqLwoJCSJhRGF0YVNvcnQiOiBudWxsLAoJCgkJLyoqCgkJICogRGVmaW5lIHRoZSBzb3J0aW5nIGRpcmVjdGlvbnMgdGhhdCBhcmUgYXBwbGllZCB0byB0aGUgY29sdW1uLCBpbiBzZXF1ZW5jZQoJCSAqIGFzIHRoZSBjb2x1bW4gaXMgcmVwZWF0ZWRseSBzb3J0ZWQgdXBvbiAtIGkuZS4gdGhlIGZpcnN0IHZhbHVlIGlzIHVzZWQKCQkgKiBhcyB0aGUgc29ydGluZyBkaXJlY3Rpb24gd2hlbiB0aGUgY29sdW1uIGlmIGZpcnN0IHNvcnRlZCAoY2xpY2tlZCBvbikuCgkJICogU29ydCBpdCBhZ2FpbiAoY2xpY2sgYWdhaW4pIGFuZCBpdCB3aWxsIG1vdmUgb24gdG8gdGhlIG5leHQgaW5kZXguCgkJICogUmVwZWF0IHVudGlsIGxvb3AuCgkJICogIEB0eXBlIGFycmF5CgkJICovCgkJImFzU29ydGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgY29sdW1uIGlzIHNlYXJjaGFibGUsIGFuZCB0aHVzIHNob3VsZCBiZSBpbmNsdWRlZAoJCSAqIGluIHRoZSBmaWx0ZXJpbmcgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJTZWFyY2hhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgc29ydGFibGUgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJTb3J0YWJsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogPGNvZGU+RGVwcmVjYXRlZDwvY29kZT4gV2hlbiB1c2luZyBmblJlbmRlciwgeW91IGhhdmUgdHdvIG9wdGlvbnMgZm9yIHdoYXQgCgkJICogdG8gZG8gd2l0aCB0aGUgZGF0YSwgYW5kIHRoaXMgcHJvcGVydHkgc2VydmVzIGFzIHRoZSBzd2l0Y2guIEZpcnN0bHksIHlvdSAKCQkgKiBjYW4gaGF2ZSB0aGUgc29ydGluZyBhbmQgZmlsdGVyaW5nIHVzZSB0aGUgcmVuZGVyZWQgdmFsdWUgKHRydWUgLSBkZWZhdWx0KSwgCgkJICogb3IgeW91IGNhbiBoYXZlIHRoZSBzb3J0aW5nIGFuZCBmaWx0ZXJpbmcgdXMgdGhlIG9yaWdpbmFsIHZhbHVlIChmYWxzZSkuCgkJICoKCQkgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgb3B0aW9uIGhhcyBub3cgYmVlbiBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQKCQkgKiBpbiB0aGUgbmV4dCB2ZXJzaW9uIG9mIERhdGFUYWJsZXMuIFBsZWFzZSB1c2UgbVJlbmRlciAvIG1EYXRhIHJhdGhlciB0aGFuCgkJICogZm5SZW5kZXIuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgY3VycmVudGx5IHZpc2libGUgaW4gdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJWaXNpYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIHRvIHRoZSB0eXBlIGRldGVjdGlvbiBtZXRob2QgaWYgdGhlIGF1dG9tYXRpYyB0eXBlCgkJICogZGV0ZWN0aW9uIHNob3VsZCBiZSB1c2VkLCBvciBpZiBhIGNvbHVtbiB0eXBlIChzVHlwZSkgaGFzIGJlZW4gc3BlY2lmaWVkCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYkF1dG9UeXBlIjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBtUmVuZGVyCgkJICogYWxsb3dpbmcgeW91IHRvIG1vZGlmeSB0aGUgRE9NIGVsZW1lbnQgKGFkZCBiYWNrZ3JvdW5kIGNvbG91ciBmb3IgZXhhbXBsZSkgd2hlbiB0aGUKCQkgKiBlbGVtZW50IGlzIGF2YWlsYWJsZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtlbGVtZW50fSBuVGQgVGhlIFREIG5vZGUgdGhhdCBoYXMgYmVlbiBjcmVhdGVkCgkJICogIEBwYXJhbSB7Kn0gc0RhdGEgVGhlIERhdGEgZm9yIHRoZSBjZWxsCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBmb3IgdGhlIHdob2xlIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBUaGUgcm93IGluZGV4IGZvciB0aGUgYW9EYXRhIGRhdGEgc3RvcmUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkNyZWF0ZWRDZWxsIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGdW5jdGlvbiB0byBnZXQgZGF0YSBmcm9tIGEgY2VsbCBpbiBhIGNvbHVtbi4gWW91IHNob3VsZCA8Yj5uZXZlcjwvYj4KCQkgKiBhY2Nlc3MgZGF0YSBkaXJlY3RseSB0aHJvdWdoIF9hRGF0YSBpbnRlcm5hbGx5IGluIERhdGFUYWJsZXMgLSBhbHdheXMgdXNlCgkJICogdGhlIG1ldGhvZCBhdHRhY2hlZCB0byB0aGlzIHByb3BlcnR5LiBJdCBhbGxvd3MgbURhdGEgdG8gZnVuY3Rpb24gYXMKCQkgKiByZXF1aXJlZC4gVGhpcyBmdW5jdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGFzc2lnbmVkIGJ5IHRoZSBjb2x1bW4gCgkJICogaW5pdGlhbGlzYXRpb24gbWV0aG9kCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBhcnJheS9vYmplY3QgZm9yIHRoZSBhcnJheSAKCQkgKiAgICAoaS5lLiBhb0RhdGFbXS5fYURhdGEpCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU3BlY2lmaWMgVGhlIHNwZWNpZmljIGRhdGEgdHlwZSB5b3Ugd2FudCB0byBnZXQgLSAKCQkgKiAgICAnZGlzcGxheScsICd0eXBlJyAnZmlsdGVyJyAnc29ydCcKCQkgKiAgQHJldHVybnMgeyp9IFRoZSBkYXRhIGZvciB0aGUgY2VsbCBmcm9tIHRoZSBnaXZlbiByb3cncyBkYXRhCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5HZXREYXRhIjogbnVsbCwKCQkKCQkvKioKCQkgKiA8Y29kZT5EZXByZWNhdGVkPC9jb2RlPiBDdXN0b20gZGlzcGxheSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIGZvciB0aGUgCgkJICogZGlzcGxheSBvZiBlYWNoIGNlbGwgaW4gdGhpcyBjb2x1bW4uCgkJICoKCQkgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgb3B0aW9uIGhhcyBub3cgYmVlbiBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQKCQkgKiBpbiB0aGUgbmV4dCB2ZXJzaW9uIG9mIERhdGFUYWJsZXMuIFBsZWFzZSB1c2UgbVJlbmRlciAvIG1EYXRhIHJhdGhlciB0aGFuCgkJICogZm5SZW5kZXIuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIE9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKCQkgKiAgQHBhcmFtIHtpbnR9ICAgIG8uaURhdGFSb3cgVGhlIHJvdyBpbiBhb0RhdGEKCQkgKiAgQHBhcmFtIHtpbnR9ICAgIG8uaURhdGFDb2x1bW4gVGhlIGNvbHVtbiBpbiBxdWVzdGlvbgoJCSAqICBAcGFyYW0ge2FycmF5fSAgby5hRGF0YSBUaGUgZGF0YSBmb3IgdGhlIHJvdyBpbiBxdWVzdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gby5vU2V0dGluZ3MgVGhlIHNldHRpbmdzIG9iamVjdCBmb3IgdGhpcyBEYXRhVGFibGVzIGluc3RhbmNlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImZuUmVuZGVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGdW5jdGlvbiB0byBzZXQgZGF0YSBmb3IgYSBjZWxsIGluIHRoZSBjb2x1bW4uIFlvdSBzaG91bGQgPGI+bmV2ZXI8L2I+IAoJCSAqIHNldCB0aGUgZGF0YSBkaXJlY3RseSB0byBfYURhdGEgaW50ZXJuYWxseSBpbiBEYXRhVGFibGVzIC0gYWx3YXlzIHVzZQoJCSAqIHRoaXMgbWV0aG9kLiBJdCBhbGxvd3MgbURhdGEgdG8gZnVuY3Rpb24gYXMgcmVxdWlyZWQuIFRoaXMgZnVuY3Rpb24KCQkgKiBpcyBhdXRvbWF0aWNhbGx5IGFzc2lnbmVkIGJ5IHRoZSBjb2x1bW4gaW5pdGlhbGlzYXRpb24gbWV0aG9kCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBhcnJheS9vYmplY3QgZm9yIHRoZSBhcnJheSAKCQkgKiAgICAoaS5lLiBhb0RhdGFbXS5fYURhdGEpCgkJICogIEBwYXJhbSB7Kn0gc1ZhbHVlIFZhbHVlIHRvIHNldAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuU2V0RGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogUHJvcGVydHkgdG8gcmVhZCB0aGUgdmFsdWUgZm9yIHRoZSBjZWxscyBpbiB0aGUgY29sdW1uIGZyb20gdGhlIGRhdGEgCgkJICogc291cmNlIGFycmF5IC8gb2JqZWN0LiBJZiBudWxsLCB0aGVuIHRoZSBkZWZhdWx0IGNvbnRlbnQgaXMgdXNlZCwgaWYgYQoJCSAqIGZ1bmN0aW9uIGlzIGdpdmVuIHRoZW4gdGhlIHJldHVybiBmcm9tIHRoZSBmdW5jdGlvbiBpcyB1c2VkLgoJCSAqICBAdHlwZSBmdW5jdGlvbnxpbnR8c3RyaW5nfG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJtRGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogUGFydG5lciBwcm9wZXJ0eSB0byBtRGF0YSB3aGljaCBpcyB1c2VkIChvbmx5IHdoZW4gZGVmaW5lZCkgdG8gZ2V0CgkJICogdGhlIGRhdGEgLSBpLmUuIGl0IGlzIGJhc2ljYWxseSB0aGUgc2FtZSBhcyBtRGF0YSwgYnV0IHdpdGhvdXQgdGhlCgkJICogJ3NldCcgb3B0aW9uLCBhbmQgYWxzbyB0aGUgZGF0YSBmZWQgdG8gaXQgaXMgdGhlIHJlc3VsdCBmcm9tIG1EYXRhLgoJCSAqIFRoaXMgaXMgdGhlIHJlbmRlcmluZyBtZXRob2QgdG8gbWF0Y2ggdGhlIGRhdGEgbWV0aG9kIG9mIG1EYXRhLgoJCSAqICBAdHlwZSBmdW5jdGlvbnxpbnR8c3RyaW5nfG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJtUmVuZGVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBVbmlxdWUgaGVhZGVyIFRIL1REIGVsZW1lbnQgZm9yIHRoaXMgY29sdW1uIC0gdGhpcyBpcyB3aGF0IHRoZSBzb3J0aW5nCgkJICogbGlzdGVuZXIgaXMgYXR0YWNoZWQgdG8gKGlmIHNvcnRpbmcgaXMgZW5hYmxlZC4pCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVGgiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBmb290ZXIgVEgvVEQgZWxlbWVudCBmb3IgdGhpcyBjb2x1bW4gKGlmIHRoZXJlIGlzIG9uZSkuIE5vdCB1c2VkIAoJCSAqIGluIERhdGFUYWJsZXMgYXMgc3VjaCwgYnV0IGNhbiBiZSB1c2VkIGZvciBwbHVnLWlucyB0byByZWZlcmVuY2UgdGhlIAoJCSAqIGZvb3RlciBmb3IgZWFjaCBjb2x1bW4uCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVGYiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFRoZSBjbGFzcyB0byBhcHBseSB0byBhbGwgVEQgZWxlbWVudHMgaW4gdGhlIHRhYmxlJ3MgVEJPRFkgZm9yIHRoZSBjb2x1bW4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0NsYXNzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGVuIERhdGFUYWJsZXMgY2FsY3VsYXRlcyB0aGUgY29sdW1uIHdpZHRocyB0byBhc3NpZ24gdG8gZWFjaCBjb2x1bW4sCgkJICogaXQgZmluZHMgdGhlIGxvbmdlc3Qgc3RyaW5nIGluIGVhY2ggY29sdW1uIGFuZCB0aGVuIGNvbnN0cnVjdHMgYQoJCSAqIHRlbXBvcmFyeSB0YWJsZSBhbmQgcmVhZHMgdGhlIHdpZHRocyBmcm9tIHRoYXQuIFRoZSBwcm9ibGVtIHdpdGggdGhpcwoJCSAqIGlzIHRoYXQgIm1tbSIgaXMgbXVjaCB3aWRlciB0aGVuICJpaWlpIiwgYnV0IHRoZSBsYXR0ZXIgaXMgYSBsb25nZXIgCgkJICogc3RyaW5nIC0gdGh1cyB0aGUgY2FsY3VsYXRpb24gY2FuIGdvIHdyb25nIChkb2luZyBpdCBwcm9wZXJseSBhbmQgcHV0dGluZwoJCSAqIGl0IGludG8gYW4gRE9NIG9iamVjdCBhbmQgbWVhc3VyaW5nIHRoYXQgaXMgaG9ycmlibHkoISkgc2xvdykuIFRodXMgYXMKCQkgKiBhICJ3b3JrIGFyb3VuZCIgd2UgcHJvdmlkZSB0aGlzIG9wdGlvbi4gSXQgd2lsbCBhcHBlbmQgaXRzIHZhbHVlIHRvIHRoZQoJCSAqIHRleHQgdGhhdCBpcyBmb3VuZCB0byBiZSB0aGUgbG9uZ2VzdCBzdHJpbmcgZm9yIHRoZSBjb2x1bW4gLSBpLmUuIHBhZGRpbmcuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzQ29udGVudFBhZGRpbmciOiBudWxsLAoJCQoJCS8qKgoJCSAqIEFsbG93cyBhIGRlZmF1bHQgdmFsdWUgdG8gYmUgZ2l2ZW4gZm9yIGEgY29sdW1uJ3MgZGF0YSwgYW5kIHdpbGwgYmUgdXNlZAoJCSAqIHdoZW5ldmVyIGEgbnVsbCBkYXRhIHNvdXJjZSBpcyBlbmNvdW50ZXJlZCAodGhpcyBjYW4gYmUgYmVjYXVzZSBtRGF0YQoJCSAqIGlzIHNldCB0byBudWxsLCBvciBiZWNhdXNlIHRoZSBkYXRhIHNvdXJjZSBpdHNlbGYgaXMgbnVsbCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNEZWZhdWx0Q29udGVudCI6IG51bGwsCgkJCgkJLyoqCgkJICogTmFtZSBmb3IgdGhlIGNvbHVtbiwgYWxsb3dpbmcgcmVmZXJlbmNlIHRvIHRoZSBjb2x1bW4gYnkgbmFtZSBhcyB3ZWxsIGFzCgkJICogYnkgaW5kZXggKG5lZWRzIGEgbG9va3VwIHRvIHdvcmsgYnkgbmFtZSkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzTmFtZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ3VzdG9tIHNvcnRpbmcgZGF0YSB0eXBlIC0gZGVmaW5lcyB3aGljaCBvZiB0aGUgYXZhaWxhYmxlIHBsdWctaW5zIGluCgkJICogYWZuU29ydERhdGEgdGhlIGN1c3RvbSBzb3J0aW5nIHdpbGwgdXNlIC0gaWYgYW55IGlzIGRlZmluZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKi8KCQkic1NvcnREYXRhVHlwZSI6ICdzdGQnLAoJCQoJCS8qKgoJCSAqIENsYXNzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGhlYWRlciBlbGVtZW50IHdoZW4gc29ydGluZyBvbiB0aGlzIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzU29ydGluZ0NsYXNzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzcyB0byBiZSBhcHBsaWVkIHRvIHRoZSBoZWFkZXIgZWxlbWVudCB3aGVuIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4gLQoJCSAqIHdoZW4galF1ZXJ5IFVJIHRoZW1pbmcgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1NvcnRpbmdDbGFzc0pVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGl0bGUgb2YgdGhlIGNvbHVtbiAtIHdoYXQgaXMgc2VlbiBpbiB0aGUgVEggZWxlbWVudCAoblRoKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ29sdW1uIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB0eXBlCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNUeXBlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaWR0aCBvZiB0aGUgY29sdW1uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aCI6IG51bGwsCgkJCgkJLyoqCgkJICogV2lkdGggb2YgdGhlIGNvbHVtbiB3aGVuIGl0IHdhcyBmaXJzdCAiZW5jb3VudGVyZWQiCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aE9yaWciOiBudWxsCgl9OwoJCgkKCQoJLyoqCgkgKiBJbml0aWFsaXNhdGlvbiBvcHRpb25zIHRoYXQgY2FuIGJlIGdpdmVuIHRvIERhdGFUYWJsZXMgYXQgaW5pdGlhbGlzYXRpb24gCgkgKiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzID0gewoJCS8qKgoJCSAqIEFuIGFycmF5IG9mIGRhdGEgdG8gdXNlIGZvciB0aGUgdGFibGUsIHBhc3NlZCBpbiBhdCBpbml0aWFsaXNhdGlvbiB3aGljaCAKCQkgKiB3aWxsIGJlIHVzZWQgaW4gcHJlZmVyZW5jZSB0byBhbnkgZGF0YSB3aGljaCBpcyBhbHJlYWR5IGluIHRoZSBET00uIFRoaXMgaXMKCQkgKiBwYXJ0aWN1bGFybHkgdXNlZnVsIGZvciBjb25zdHJ1Y3RpbmcgdGFibGVzIHB1cmVseSBpbiBKYXZhc2NyaXB0LCBmb3IKCQkgKiBleGFtcGxlIHdpdGggYSBjdXN0b20gQWpheCBjYWxsLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhIDJEIGFycmF5IGRhdGEgc291cmNlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYURhdGEiOiBbCgkJICogICAgICAgICAgWydUcmlkZW50JywgJ0ludGVybmV0IEV4cGxvcmVyIDQuMCcsICdXaW4gOTUrJywgNCwgJ1gnXSwKCQkgKiAgICAgICAgICBbJ1RyaWRlbnQnLCAnSW50ZXJuZXQgRXhwbG9yZXIgNS4wJywgJ1dpbiA5NSsnLCA1LCAnQyddLAoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJHcmFkZSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFuIGFycmF5IG9mIG9iamVjdHMgYXMgYSBkYXRhIHNvdXJjZSAobURhdGEpCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYURhdGEiOiBbCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImVuZ2luZSI6ICAgIlRyaWRlbnQiLAoJCSAqICAgICAgICAgICAgImJyb3dzZXIiOiAgIkludGVybmV0IEV4cGxvcmVyIDQuMCIsCgkJICogICAgICAgICAgICAicGxhdGZvcm0iOiAiV2luIDk1KyIsCgkJICogICAgICAgICAgICAidmVyc2lvbiI6ICA0LAoJCSAqICAgICAgICAgICAgImdyYWRlIjogICAgIlgiCgkJICogICAgICAgICAgfSwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAiZW5naW5lIjogICAiVHJpZGVudCIsCgkJICogICAgICAgICAgICAiYnJvd3NlciI6ICAiSW50ZXJuZXQgRXhwbG9yZXIgNS4wIiwKCQkgKiAgICAgICAgICAgICJwbGF0Zm9ybSI6ICJXaW4gOTUrIiwKCQkgKiAgICAgICAgICAgICJ2ZXJzaW9uIjogIDUsCgkJICogICAgICAgICAgICAiZ3JhZGUiOiAgICAiQyIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0sCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkVuZ2luZSIsICAgIm1EYXRhIjogImVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiQnJvd3NlciIsICAibURhdGEiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiUGxhdGZvcm0iLCAibURhdGEiOiAicGxhdGZvcm0iIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlZlcnNpb24iLCAgIm1EYXRhIjogInZlcnNpb24iIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkdyYWRlIiwgICAgIm1EYXRhIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhRGF0YSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElmIHNvcnRpbmcgaXMgZW5hYmxlZCwgdGhlbiBEYXRhVGFibGVzIHdpbGwgcGVyZm9ybSBhIGZpcnN0IHBhc3Mgc29ydCBvbiAKCQkgKiBpbml0aWFsaXNhdGlvbi4gWW91IGNhbiBkZWZpbmUgd2hpY2ggY29sdW1uKHMpIHRoZSBzb3J0IGlzIHBlcmZvcm1lZCB1cG9uLCAKCQkgKiBhbmQgdGhlIHNvcnRpbmcgZGlyZWN0aW9uLCB3aXRoIHRoaXMgdmFyaWFibGUuIFRoZSBhYVNvcnRpbmcgYXJyYXkgc2hvdWxkIAoJCSAqIGNvbnRhaW4gYW4gYXJyYXkgZm9yIGVhY2ggY29sdW1uIHRvIGJlIHNvcnRlZCBpbml0aWFsbHkgY29udGFpbmluZyB0aGUgCgkJICogY29sdW1uJ3MgaW5kZXggYW5kIGEgZGlyZWN0aW9uIHN0cmluZyAoJ2FzYycgb3IgJ2Rlc2MnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW1swLCdhc2MnXV0KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNvcnQgYnkgM3JkIGNvbHVtbiBmaXJzdCwgYW5kIHRoZW4gNHRoIGNvbHVtbgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmciOiBbWzIsJ2FzYyddLCBbMywnZGVzYyddXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICAvLyBObyBpbml0aWFsIHNvcnRpbmcKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFTb3J0aW5nIjogW10KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhU29ydGluZyI6IFtbMCwnYXNjJ11dLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBpcyBiYXNpY2FsbHkgaWRlbnRpY2FsIHRvIHRoZSBhYVNvcnRpbmcgcGFyYW1ldGVyLCBidXQgCgkJICogY2Fubm90IGJlIG92ZXJyaWRkZW4gYnkgdXNlciBpbnRlcmFjdGlvbiB3aXRoIHRoZSB0YWJsZS4gV2hhdCB0aGlzIG1lYW5zIAoJCSAqIGlzIHRoYXQgeW91IGNvdWxkIGhhdmUgYSBjb2x1bW4gKHZpc2libGUgb3IgaGlkZGVuKSB3aGljaCB0aGUgc29ydGluZyB3aWxsIAoJCSAqIGFsd2F5cyBiZSBmb3JjZWQgb24gZmlyc3QgLSBhbnkgc29ydGluZyBhZnRlciB0aGF0IChmcm9tIHRoZSB1c2VyKSB3aWxsIAoJCSAqIHRoZW4gYmUgcGVyZm9ybWVkIGFzIHJlcXVpcmVkLiBUaGlzIGNhbiBiZSB1c2VmdWwgZm9yIGdyb3VwaW5nIHJvd3MgCgkJICogdG9nZXRoZXIuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmdGaXhlZCI6IFtbMCwnYXNjJ11dCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byByZWFkaWx5IHNwZWNpZnkgdGhlIGVudHJpZXMgaW4gdGhlIGxlbmd0aCBkcm9wCgkJICogZG93biBtZW51IHRoYXQgRGF0YVRhYmxlcyBzaG93cyB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4gSXQgY2FuIGJlIAoJCSAqIGVpdGhlciBhIDFEIGFycmF5IG9mIG9wdGlvbnMgd2hpY2ggd2lsbCBiZSB1c2VkIGZvciBib3RoIHRoZSBkaXNwbGF5ZWQgCgkJICogb3B0aW9uIGFuZCB0aGUgdmFsdWUsIG9yIGEgMkQgYXJyYXkgd2hpY2ggd2lsbCB1c2UgdGhlIGFycmF5IGluIHRoZSBmaXJzdCAKCQkgKiBwb3NpdGlvbiBhcyB0aGUgdmFsdWUsIGFuZCB0aGUgYXJyYXkgaW4gdGhlIHNlY29uZCBwb3NpdGlvbiBhcyB0aGUgCgkJICogZGlzcGxheWVkIG9wdGlvbnMgKHVzZWZ1bCBmb3IgbGFuZ3VhZ2Ugc3RyaW5ncyBzdWNoIGFzICdBbGwnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgWyAxMCwgMjUsIDUwLCAxMDAgXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFMZW5ndGhNZW51IjogW1sxMCwgMjUsIDUwLCAtMV0sIFsxMCwgMjUsIDUwLCAiQWxsIl1dCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBTZXR0aW5nIHRoZSBkZWZhdWx0IGRpc3BsYXkgbGVuZ3RoIGFzIHdlbGwgYXMgbGVuZ3RoIG1lbnUKCQkgKiAgICAvLyBUaGlzIGlzIGxpa2VseSB0byBiZSB3YW50ZWQgaWYgeW91IHJlbW92ZSB0aGUgJzEwJyBvcHRpb24gd2hpY2gKCQkgKiAgICAvLyBpcyB0aGUgaURpc3BsYXlMZW5ndGggZGVmYXVsdC4KCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiaURpc3BsYXlMZW5ndGgiOiAyNSwKCQkgKiAgICAgICAgImFMZW5ndGhNZW51IjogW1syNSwgNTAsIDEwMCwgLTFdLCBbMjUsIDUwLCAxMDAsICJBbGwiXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFMZW5ndGhNZW51IjogWyAxMCwgMjUsIDUwLCAxMDAgXSwKCQoJCgkJLyoqCgkJICogVGhlIGFvQ29sdW1ucyBvcHRpb24gaW4gdGhlIGluaXRpYWxpc2F0aW9uIHBhcmFtZXRlciBhbGxvd3MgeW91IHRvIGRlZmluZQoJCSAqIGRldGFpbHMgYWJvdXQgdGhlIHdheSBpbmRpdmlkdWFsIGNvbHVtbnMgYmVoYXZlLiBGb3IgYSBmdWxsIGxpc3Qgb2YKCQkgKiBjb2x1bW4gb3B0aW9ucyB0aGF0IGNhbiBiZSBzZXQsIHBsZWFzZSBzZWUgCgkJICoge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zfS4gTm90ZSB0aGF0IGlmIHlvdSB1c2UgYW9Db2x1bW5zIHRvCgkJICogZGVmaW5lIHlvdXIgY29sdW1ucywgeW91IG11c3QgaGF2ZSBhbiBlbnRyeSBpbiB0aGUgYXJyYXkgZm9yIGV2ZXJ5IHNpbmdsZQoJCSAqIGNvbHVtbiB0aGF0IHlvdSBoYXZlIGluIHlvdXIgdGFibGUgKHRoZXNlIGNhbiBiZSBudWxsIGlmIHlvdSBkb24ndCB3aGljaAoJCSAqIHRvIHNwZWNpZnkgYW55IG9wdGlvbnMpLgoJCSAqICBAbWVtYmVyCgkJICovCgkJImFvQ29sdW1ucyI6IG51bGwsCgkKCQkvKioKCQkgKiBWZXJ5IHNpbWlsYXIgdG8gYW9Db2x1bW5zLCBhb0NvbHVtbkRlZnMgYWxsb3dzIHlvdSB0byB0YXJnZXQgYSBzcGVjaWZpYyAKCQkgKiBjb2x1bW4sIG11bHRpcGxlIGNvbHVtbnMsIG9yIGFsbCBjb2x1bW5zLCB1c2luZyB0aGUgYVRhcmdldHMgcHJvcGVydHkgb2YgCgkJICogZWFjaCBvYmplY3QgaW4gdGhlIGFycmF5LiBUaGlzIGFsbG93cyBncmVhdCBmbGV4aWJpbGl0eSB3aGVuIGNyZWF0aW5nIAoJCSAqIHRhYmxlcywgYXMgdGhlIGFvQ29sdW1uRGVmcyBhcnJheXMgY2FuIGJlIG9mIGFueSBsZW5ndGgsIHRhcmdldGluZyB0aGUgCgkJICogY29sdW1ucyB5b3Ugc3BlY2lmaWNhbGx5IHdhbnQuIGFvQ29sdW1uRGVmcyBtYXkgdXNlIGFueSBvZiB0aGUgY29sdW1uIAoJCSAqIG9wdGlvbnMgYXZhaWxhYmxlOiB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnN9LCBidXQgaXQgX211c3RfCgkJICogaGF2ZSBhVGFyZ2V0cyBkZWZpbmVkIGluIGVhY2ggb2JqZWN0IGluIHRoZSBhcnJheS4gVmFsdWVzIGluIHRoZSBhVGFyZ2V0cwoJCSAqIGFycmF5IG1heSBiZToKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmEgc3RyaW5nIC0gY2xhc3MgbmFtZSB3aWxsIGJlIG1hdGNoZWQgb24gdGhlIFRIIGZvciB0aGUgY29sdW1uPC9saT4KCQkgKiAgICAgPGxpPjAgb3IgYSBwb3NpdGl2ZSBpbnRlZ2VyIC0gY29sdW1uIGluZGV4IGNvdW50aW5nIGZyb20gdGhlIGxlZnQ8L2xpPgoJCSAqICAgICA8bGk+YSBuZWdhdGl2ZSBpbnRlZ2VyIC0gY29sdW1uIGluZGV4IGNvdW50aW5nIGZyb20gdGhlIHJpZ2h0PC9saT4KCQkgKiAgICAgPGxpPnRoZSBzdHJpbmcgIl9hbGwiIC0gYWxsIGNvbHVtbnMgKGkuZS4gYXNzaWduIGEgZGVmYXVsdCk8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQG1lbWJlcgoJCSAqLwoJCSJhb0NvbHVtbkRlZnMiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBCYXNpY2FsbHkgdGhlIHNhbWUgYXMgb1NlYXJjaCwgdGhpcyBwYXJhbWV0ZXIgZGVmaW5lcyB0aGUgaW5kaXZpZHVhbCBjb2x1bW4KCQkgKiBmaWx0ZXJpbmcgc3RhdGUgYXQgaW5pdGlhbGlzYXRpb24gdGltZS4gVGhlIGFycmF5IG11c3QgYmUgb2YgdGhlIHNhbWUgc2l6ZSAKCQkgKiBhcyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMsIGFuZCBlYWNoIGVsZW1lbnQgYmUgYW4gb2JqZWN0IHdpdGggdGhlIHBhcmFtZXRlcnMKCQkgKiAic1NlYXJjaCIgYW5kICJiRXNjYXBlUmVnZXgiICh0aGUgbGF0dGVyIGlzIG9wdGlvbmFsKS4gJ251bGwnIGlzIGFsc28KCQkgKiBhY2NlcHRlZCBhbmQgdGhlIGRlZmF1bHQgd2lsbCBiZSB1c2VkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvU2VhcmNoQ29scyI6IFsKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTZWFyY2giOiAiTXkgZmlsdGVyIiB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgeyAic1NlYXJjaCI6ICJeWzAtOV0iLCAiYkVzY2FwZVJlZ2V4IjogZmFsc2UgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFvU2VhcmNoQ29scyI6IFtdLAoJCgkKCQkvKioKCQkgKiBBbiBhcnJheSBvZiBDU1MgY2xhc3NlcyB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGRpc3BsYXllZCByb3dzLiBUaGlzIAoJCSAqIGFycmF5IG1heSBiZSBvZiBhbnkgbGVuZ3RoLCBhbmQgRGF0YVRhYmxlcyB3aWxsIGFwcGx5IGVhY2ggY2xhc3MgCgkJICogc2VxdWVudGlhbGx5LCBsb29waW5nIHdoZW4gcmVxdWlyZWQuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwgPGk+V2lsbCB0YWtlIHRoZSB2YWx1ZXMgZGV0ZXJtaW5lZCBieSB0aGUgb0NsYXNzZXMuc1N0cmlwZSoKCQkgKiAgICBvcHRpb25zPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFzU3RyaXBlQ2xhc3NlcyI6IFsgJ3N0cmlwMScsICdzdHJpcDInLCAnc3RyaXAzJyBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFzU3RyaXBlQ2xhc3NlcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIGF1dG9tYXRpYyBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24uIFRoaXMgY2FuIGJlIGRpc2FibGVkCgkJICogYXMgYW4gb3B0aW1pc2F0aW9uIChpdCB0YWtlcyBzb21lIHRpbWUgdG8gY2FsY3VsYXRlIHRoZSB3aWR0aHMpIGlmIHRoZQoJCSAqIHRhYmxlcyB3aWR0aHMgYXJlIHBhc3NlZCBpbiB1c2luZyBhb0NvbHVtbnMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJBdXRvV2lkdGgiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkF1dG9XaWR0aCI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIERlZmVycmVkIHJlbmRlcmluZyBjYW4gcHJvdmlkZSBEYXRhVGFibGVzIHdpdGggYSBodWdlIHNwZWVkIGJvb3N0IHdoZW4geW91CgkJICogYXJlIHVzaW5nIGFuIEFqYXggb3IgSlMgZGF0YSBzb3VyY2UgZm9yIHRoZSB0YWJsZS4gVGhpcyBvcHRpb24sIHdoZW4gc2V0IHRvCgkJICogdHJ1ZSwgd2lsbCBjYXVzZSBEYXRhVGFibGVzIHRvIGRlZmVyIHRoZSBjcmVhdGlvbiBvZiB0aGUgdGFibGUgZWxlbWVudHMgZm9yCgkJICogZWFjaCByb3cgdW50aWwgdGhleSBhcmUgbmVlZGVkIGZvciBhIGRyYXcgLSBzYXZpbmcgYSBzaWduaWZpY2FudCBhbW91bnQgb2YKCQkgKiB0aW1lLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9hcnJheXMudHh0IiwKCQkgKiAgICAgICAgImJEZWZlclJlbmRlciI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJEZWZlclJlbmRlciI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBSZXBsYWNlIGEgRGF0YVRhYmxlIHdoaWNoIG1hdGNoZXMgdGhlIGdpdmVuIHNlbGVjdG9yIGFuZCByZXBsYWNlIGl0IHdpdGggCgkJICogb25lIHdoaWNoIGhhcyB0aGUgcHJvcGVydGllcyBvZiB0aGUgbmV3IGluaXRpYWxpc2F0aW9uIG9iamVjdCBwYXNzZWQuIElmIG5vCgkJICogdGFibGUgbWF0Y2hlcyB0aGUgc2VsZWN0b3IsIHRoZW4gdGhlIG5ldyBEYXRhVGFibGUgd2lsbCBiZSBjb25zdHJ1Y3RlZCBhcwoJCSAqIHBlciBub3JtYWwuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29tZSB0aW1lIGxhdGVyLi4uLgoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJGaWx0ZXIiOiBmYWxzZSwKCQkgKiAgICAgICAgImJEZXN0cm95IjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkRlc3Ryb3kiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9mIGRhdGEuIEZpbHRlcmluZyBpbiBEYXRhVGFibGVzIGlzICJzbWFydCIgaW4KCQkgKiB0aGF0IGl0IGFsbG93cyB0aGUgZW5kIHVzZXIgdG8gaW5wdXQgbXVsdGlwbGUgd29yZHMgKHNwYWNlIHNlcGFyYXRlZCkgYW5kCgkJICogd2lsbCBtYXRjaCBhIHJvdyBjb250YWluaW5nIHRob3NlIHdvcmRzLCBldmVuIGlmIG5vdCBpbiB0aGUgb3JkZXIgdGhhdCB3YXMKCQkgKiBzcGVjaWZpZWQgKHRoaXMgYWxsb3cgbWF0Y2hpbmcgYWNyb3NzIG11bHRpcGxlIGNvbHVtbnMpLiBOb3RlIHRoYXQgaWYgeW91CgkJICogd2lzaCB0byB1c2UgZmlsdGVyaW5nIGluIERhdGFUYWJsZXMgdGhpcyBtdXN0IHJlbWFpbiAndHJ1ZScgLSB0byByZW1vdmUgdGhlCgkJICogZGVmYXVsdCBmaWx0ZXJpbmcgaW5wdXQgYm94IGFuZCByZXRhaW4gZmlsdGVyaW5nIGFiaWxpdGllcywgcGxlYXNlIHVzZQoJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuc0RvbX0uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJGaWx0ZXIiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkZpbHRlciI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSB0YWJsZSBpbmZvcm1hdGlvbiBkaXNwbGF5LiBUaGlzIHNob3dzIGluZm9ybWF0aW9uIAoJCSAqIGFib3V0IHRoZSBkYXRhIHRoYXQgaXMgY3VycmVudGx5IHZpc2libGUgb24gdGhlIHBhZ2UsIGluY2x1ZGluZyBpbmZvcm1hdGlvbgoJCSAqIGFib3V0IGZpbHRlcmVkIGRhdGEgaWYgdGhhdCBhY3Rpb24gaXMgYmVpbmcgcGVyZm9ybWVkLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiSW5mbyI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiSW5mbyI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBqUXVlcnkgVUkgVGhlbWVSb2xsZXIgc3VwcG9ydCAocmVxdWlyZWQgYXMgVGhlbWVSb2xsZXIgcmVxdWlyZXMgc29tZQoJCSAqIHNsaWdodGx5IGRpZmZlcmVudCBhbmQgYWRkaXRpb25hbCBtYXJrLXVwIGZyb20gd2hhdCBEYXRhVGFibGVzIGhhcwoJCSAqIHRyYWRpdGlvbmFsbHkgdXNlZCkuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJKUXVlcnlVSSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJKUXVlcnlVSSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgdGhlIGVuZCB1c2VyIHRvIHNlbGVjdCB0aGUgc2l6ZSBvZiBhIGZvcm1hdHRlZCBwYWdlIGZyb20gYSBzZWxlY3QKCQkgKiBtZW51IChzaXplcyBhcmUgMTAsIDI1LCA1MCBhbmQgMTAwKS4gUmVxdWlyZXMgcGFnaW5hdGlvbiAoYlBhZ2luYXRlKS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkxlbmd0aENoYW5nZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiTGVuZ3RoQ2hhbmdlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgcGFnaW5hdGlvbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJQYWdpbmF0ZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBkaXNwbGF5IG9mIGEgJ3Byb2Nlc3NpbmcnIGluZGljYXRvciB3aGVuIHRoZSB0YWJsZSBpcwoJCSAqIGJlaW5nIHByb2Nlc3NlZCAoZS5nLiBhIHNvcnQpLiBUaGlzIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgZm9yIHRhYmxlcyB3aXRoCgkJICogbGFyZ2UgYW1vdW50cyBvZiBkYXRhIHdoZXJlIGl0IGNhbiB0YWtlIGEgbm90aWNlYWJsZSBhbW91bnQgb2YgdGltZSB0byBzb3J0CgkJICogdGhlIGVudHJpZXMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiUHJvY2Vzc2luZyI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJQcm9jZXNzaW5nIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIFJldHJpZXZlIHRoZSBEYXRhVGFibGVzIG9iamVjdCBmb3IgdGhlIGdpdmVuIHNlbGVjdG9yLiBOb3RlIHRoYXQgaWYgdGhlCgkJICogdGFibGUgaGFzIGFscmVhZHkgYmVlbiBpbml0aWFsaXNlZCwgdGhpcyBwYXJhbWV0ZXIgd2lsbCBjYXVzZSBEYXRhVGFibGVzCgkJICogdG8gc2ltcGx5IHJldHVybiB0aGUgb2JqZWN0IHRoYXQgaGFzIGFscmVhZHkgYmVlbiBzZXQgdXAgLSBpdCB3aWxsIG5vdCB0YWtlCgkJICogYWNjb3VudCBvZiBhbnkgY2hhbmdlcyB5b3UgbWlnaHQgaGF2ZSBtYWRlIHRvIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QKCQkgKiBwYXNzZWQgdG8gRGF0YVRhYmxlcyAoc2V0dGluZyB0aGlzIHBhcmFtZXRlciB0byB0cnVlIGlzIGFuIGFja25vd2xlZGdlbWVudAoJCSAqIHRoYXQgeW91IHVuZGVyc3RhbmQgdGhpcykuIGJEZXN0cm95IGNhbiBiZSB1c2VkIHRvIHJlaW5pdGlhbGlzZSBhIHRhYmxlIGlmCgkJICogeW91IG5lZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICBpbml0VGFibGUoKTsKCQkgKiAgICAgIHRhYmxlQWN0aW9ucygpOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICBmdW5jdGlvbiBpbml0VGFibGUgKCkKCQkgKiAgICB7CgkJICogICAgICByZXR1cm4gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlLAoJCSAqICAgICAgICAiYlJldHJpZXZlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0KCQkgKiAgICAKCQkgKiAgICBmdW5jdGlvbiB0YWJsZUFjdGlvbnMgKCkKCQkgKiAgICB7CgkJICogICAgICB2YXIgb1RhYmxlID0gaW5pdFRhYmxlKCk7CgkJICogICAgICAvLyBwZXJmb3JtIEFQSSBvcGVyYXRpb25zIHdpdGggb1RhYmxlIAoJCSAqICAgIH0KCQkgKi8KCQkiYlJldHJpZXZlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIERhdGFUYWJsZXMgc2hvdWxkIGJlIGFsbG93ZWQgdG8gc2V0IHRoZSBwYWRkaW5nIC8gbWFyZ2luCgkJICogZXRjIGZvciB0aGUgc2Nyb2xsaW5nIGhlYWRlciBlbGVtZW50cyBvciBub3QuIFR5cGljYWxseSB5b3Ugd2lsbCB3YW50CgkJICogdGhpcy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTY3JvbGxBdXRvQ3NzIjogZmFsc2UsCgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxBdXRvQ3NzIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB2ZXJ0aWNhbCAoeSkgc2Nyb2xsaW5nIGlzIGVuYWJsZWQsIERhdGFUYWJsZXMgd2lsbCBmb3JjZSB0aGUgaGVpZ2h0IG9mCgkJICogdGhlIHRhYmxlJ3Mgdmlld3BvcnQgdG8gdGhlIGdpdmVuIGhlaWdodCBhdCBhbGwgdGltZXMgKHVzZWZ1bCBmb3IgbGF5b3V0KS4KCQkgKiBIb3dldmVyLCB0aGlzIGNhbiBsb29rIG9kZCB3aGVuIGZpbHRlcmluZyBkYXRhIGRvd24gdG8gYSBzbWFsbCBkYXRhIHNldCwKCQkgKiBhbmQgdGhlIGZvb3RlciBpcyBsZWZ0ICJmbG9hdGluZyIgZnVydGhlciBkb3duLiBUaGlzIHBhcmFtZXRlciAod2hlbgoJCSAqIGVuYWJsZWQpIHdpbGwgY2F1c2UgRGF0YVRhYmxlcyB0byBjb2xsYXBzZSB0aGUgdGFibGUncyB2aWV3cG9ydCBkb3duIHdoZW4KCQkgKiB0aGUgcmVzdWx0IHNldCB3aWxsIGZpdCB3aXRoaW4gdGhlIGdpdmVuIFkgaGVpZ2h0LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMCIsCgkJICogICAgICAgICJiU2Nyb2xsQ29sbGFwc2UiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2Nyb2xsQ29sbGFwc2UiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGluZmluaXRlIHNjcm9sbGluZyBmb3IgRGF0YVRhYmxlcyAodG8gYmUgdXNlZCBpbiBjb21iaW5hdGlvbiB3aXRoCgkJICogc1Njcm9sbFkpLiBJbmZpbml0ZSBzY3JvbGxpbmcgbWVhbnMgdGhhdCBEYXRhVGFibGVzIHdpbGwgY29udGludWFsbHkgbG9hZAoJCSAqIGRhdGEgYXMgYSB1c2VyIHNjcm9sbHMgdGhyb3VnaCBhIHRhYmxlLCB3aGljaCBpcyB2ZXJ5IHVzZWZ1bCBmb3IgbGFyZ2UKCQkgKiBkYXRhc2V0LiBUaGlzIGNhbm5vdCBiZSB1c2VkIHdpdGggcGFnaW5hdGlvbiwgd2hpY2ggaXMgYXV0b21hdGljYWxseQoJCSAqIGRpc2FibGVkLiBOb3RlIC0gdGhlIFNjcm9sbGVyIGV4dHJhIGZvciBEYXRhVGFibGVzIGlzIHJlY29tbWVuZGVkIGluCgkJICogaW4gcHJlZmVyZW5jZSB0byB0aGlzIG9wdGlvbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNjcm9sbEluZmluaXRlIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUsCgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxJbmZpbml0ZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBDb25maWd1cmUgRGF0YVRhYmxlcyB0byB1c2Ugc2VydmVyLXNpZGUgcHJvY2Vzc2luZy4gTm90ZSB0aGF0IHRoZQoJCSAqIHNBamF4U291cmNlIHBhcmFtZXRlciBtdXN0IGFsc28gYmUgZ2l2ZW4gaW4gb3JkZXIgdG8gZ2l2ZSBEYXRhVGFibGVzIGEKCQkgKiBzb3VyY2UgdG8gb2J0YWluIHRoZSByZXF1aXJlZCBkYXRhIGZvciBlYWNoIGRyYXcuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogIEBkdG9wdCBTZXJ2ZXItc2lkZQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAieGhyLnBocCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTZXJ2ZXJTaWRlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHNvcnRpbmcgb2YgY29sdW1ucy4gU29ydGluZyBvZiBpbmRpdmlkdWFsIGNvbHVtbnMgY2FuIGJlCgkJICogZGlzYWJsZWQgYnkgdGhlICJiU29ydGFibGUiIG9wdGlvbiBmb3IgZWFjaCBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTb3J0IjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTb3J0IjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogQWxsb3dzIGNvbnRyb2wgb3ZlciB3aGV0aGVyIERhdGFUYWJsZXMgc2hvdWxkIHVzZSB0aGUgdG9wICh0cnVlKSB1bmlxdWUKCQkgKiBjZWxsIHRoYXQgaXMgZm91bmQgZm9yIGEgc2luZ2xlIGNvbHVtbiwgb3IgdGhlIGJvdHRvbSAoZmFsc2UgLSBkZWZhdWx0KS4KCQkgKiBUaGlzIGlzIHVzZWZ1bCB3aGVuIHVzaW5nIGNvbXBsZXggaGVhZGVycy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU29ydENlbGxzVG9wIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRDZWxsc1RvcCI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSB0aGUgYWRkaXRpb24gb2YgdGhlIGNsYXNzZXMgJ3NvcnRpbmdfMScsICdzb3J0aW5nXzInIGFuZAoJCSAqICdzb3J0aW5nXzMnIHRvIHRoZSBjb2x1bW5zIHdoaWNoIGFyZSBjdXJyZW50bHkgYmVpbmcgc29ydGVkIG9uLiBUaGlzIGlzCgkJICogcHJlc2VudGVkIGFzIGEgZmVhdHVyZSBzd2l0Y2ggYXMgaXQgY2FuIGluY3JlYXNlIHByb2Nlc3NpbmcgdGltZSAod2hpbGUKCQkgKiBjbGFzc2VzIGFyZSByZW1vdmVkIGFuZCBhZGRlZCkgc28gZm9yIGxhcmdlIGRhdGEgc2V0cyB5b3UgbWlnaHQgd2FudCB0bwoJCSAqIHR1cm4gdGhpcyBvZmYuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTb3J0Q2xhc3NlcyI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU29ydENsYXNzZXMiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBzdGF0ZSBzYXZpbmcuIFdoZW4gZW5hYmxlZCBhIGNvb2tpZSB3aWxsIGJlIHVzZWQgdG8gc2F2ZQoJCSAqIHRhYmxlIGRpc3BsYXkgaW5mb3JtYXRpb24gc3VjaCBhcyBwYWdpbmF0aW9uIGluZm9ybWF0aW9uLCBkaXNwbGF5IGxlbmd0aCwKCQkgKiBmaWx0ZXJpbmcgYW5kIHNvcnRpbmcuIEFzIHN1Y2ggd2hlbiB0aGUgZW5kIHVzZXIgcmVsb2FkcyB0aGUgcGFnZSB0aGUKCQkgKiBkaXNwbGF5IGRpc3BsYXkgd2lsbCBtYXRjaCB3aGF0IHRoeSBoYWQgcHJldmlvdXNseSBzZXQgdXAuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlN0YXRlU2F2ZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBDdXN0b21pc2UgdGhlIGNvb2tpZSBhbmQgLyBvciB0aGUgcGFyYW1ldGVycyBiZWluZyBzdG9yZWQgd2hlbiB1c2luZwoJCSAqIERhdGFUYWJsZXMgd2l0aCBzdGF0ZSBzYXZpbmcgZW5hYmxlZC4gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIKCQkgKiB0aGUgY29va2llIGlzIG1vZGlmaWVkLCBhbmQgaXQgZXhwZWN0cyBhIGZ1bGx5IGZvcm1lZCBjb29raWUgc3RyaW5nIHRvIGJlCgkJICogcmV0dXJuZWQuIE5vdGUgdGhhdCB0aGUgZGF0YSBvYmplY3QgcGFzc2VkIGluIGlzIGEgSmF2YXNjcmlwdCBvYmplY3Qgd2hpY2gKCQkgKiBtdXN0IGJlIGNvbnZlcnRlZCB0byBhIHN0cmluZyAoSlNPTi5zdHJpbmdpZnkgZm9yIGV4YW1wbGUpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgTmFtZSBvZiB0aGUgY29va2llIGRlZmluZWQgYnkgRGF0YVRhYmxlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgRGF0YSB0byBiZSBzdG9yZWQgaW4gdGhlIGNvb2tpZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0V4cGlyZXMgQ29va2llIGV4cGlyZXMgc3RyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUGF0aCBQYXRoIG9mIHRoZSBjb29raWUgdG8gc2V0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IENvb2tpZSBmb3JtYXR0ZWQgc3RyaW5nICh3aGljaCBzaG91bGQgYmUgZW5jb2RlZCBieQoJCSAqICAgIHVzaW5nIGVuY29kZVVSSUNvbXBvbmVudCgpKQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkNvb2tpZUNhbGxiYWNrIjogZnVuY3Rpb24gKHNOYW1lLCBvRGF0YSwgc0V4cGlyZXMsIHNQYXRoKSB7CgkJICogICAgICAgICAgLy8gQ3VzdG9taXNlIG9EYXRhIG9yIHNOYW1lIG9yIHdoYXRldmVyIGVsc2UgaGVyZQoJCSAqICAgICAgICAgIHJldHVybiBzTmFtZSArICI9IitKU09OLnN0cmluZ2lmeShvRGF0YSkrIjsgZXhwaXJlcz0iICsgc0V4cGlyZXMgKyI7IHBhdGg9IiArIHNQYXRoOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNvb2tpZUNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiBhIFRSIGVsZW1lbnQgaXMgY3JlYXRlZCAoYW5kIGFsbCBURCBjaGlsZAoJCSAqIGVsZW1lbnRzIGhhdmUgYmVlbiBpbnNlcnRlZCksIG9yIHJlZ2lzdGVyZWQgaWYgdXNpbmcgYSBET00gc291cmNlLCBhbGxvd2luZwoJCSAqIG1hbmlwdWxhdGlvbiBvZiB0aGUgVFIgZWxlbWVudCAoYWRkaW5nIGNsYXNzZXMgZXRjKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURhdGFJbmRleCBUaGUgaW5kZXggb2YgdGhpcyByb3cgaW4gYW9EYXRhCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5DcmVhdGVkUm93IjogZnVuY3Rpb24oIG5Sb3csIGFEYXRhLCBpRGF0YUluZGV4ICkgewoJCSAqICAgICAgICAgIC8vIEJvbGQgdGhlIGdyYWRlIGZvciBhbGwgJ0EnIGdyYWRlIGJyb3dzZXJzCgkJICogICAgICAgICAgaWYgKCBhRGF0YVs0XSA9PSAiQSIgKQoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICQoJ3RkOmVxKDQpJywgblJvdykuaHRtbCggJzxiPkE8L2I+JyApOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkUm93IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgb24gZXZlcnkgJ2RyYXcnIGV2ZW50LCBhbmQgYWxsb3dzIHlvdSB0bwoJCSAqIGR5bmFtaWNhbGx5IG1vZGlmeSBhbnkgYXNwZWN0IHlvdSB3YW50IGFib3V0IHRoZSBjcmVhdGVkIERPTS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBhbGVydCggJ0RhdGFUYWJsZXMgaGFzIHJlZHJhd24gdGhlIHRhYmxlJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkRyYXdDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElkZW50aWNhbCB0byBmbkhlYWRlckNhbGxiYWNrKCkgYnV0IGZvciB0aGUgdGFibGUgZm9vdGVyIHRoaXMgZnVuY3Rpb24KCQkgKiBhbGxvd3MgeW91IHRvIG1vZGlmeSB0aGUgdGFibGUgZm9vdGVyIG9uIGV2ZXJ5ICdkcmF3JyBldmVuLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Gb290ICJUUiIgZWxlbWVudCBmb3IgdGhlIGZvb3RlcgoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBGdWxsIHRhYmxlIGRhdGEgKGFzIGRlcml2ZWQgZnJvbSB0aGUgb3JpZ2luYWwgSFRNTCkKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBzdGFydGluZyBwb2ludCBpbiB0aGUgCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlIAoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheSBpbnR9IGFpRGlzcGxheSBJbmRleCBhcnJheSB0byB0cmFuc2xhdGUgdGhlIHZpc3VhbCBwb3NpdGlvbgoJCSAqICAgIHRvIHRoZSBmdWxsIGRhdGEgYXJyYXkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkZvb3RlckNhbGxiYWNrIjogZnVuY3Rpb24oIG5Gb290LCBhRGF0YSwgaVN0YXJ0LCBpRW5kLCBhaURpc3BsYXkgKSB7CgkJICogICAgICAgICAgbkZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJylbMF0uaW5uZXJIVE1MID0gIlN0YXJ0aW5nIGluZGV4IGlzICIraVN0YXJ0OwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuRm9vdGVyQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBXaGVuIHJlbmRlcmluZyBsYXJnZSBudW1iZXJzIGluIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGZvciB0aGUgdGFibGUKCQkgKiAoaS5lLiAiU2hvd2luZyAxIHRvIDEwIG9mIDU3IGVudHJpZXMiKSBEYXRhVGFibGVzIHdpbGwgcmVuZGVyIGxhcmdlIG51bWJlcnMKCQkgKiB0byBoYXZlIGEgY29tbWEgc2VwYXJhdG9yIGZvciB0aGUgJ3Rob3VzYW5kcycgdW5pdHMgKGUuZy4gMSBtaWxsaW9uIGlzCgkJICogcmVuZGVyZWQgYXMgIjEsMDAwLDAwMCIpIHRvIGhlbHAgcmVhZGFiaWxpdHkgZm9yIHRoZSBlbmQgdXNlci4gVGhpcwoJCSAqIGZ1bmN0aW9uIHdpbGwgb3ZlcnJpZGUgdGhlIGRlZmF1bHQgbWV0aG9kIERhdGFUYWJsZXMgdXNlcy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge2ludH0gaUluIG51bWJlciB0byBiZSBmb3JtYXR0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gZm9ybWF0dGVkIHN0cmluZyBmb3IgRGF0YVRhYmxlcyB0byBzaG93IHRoZSBudW1iZXIKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkZvcm1hdE51bWJlciI6IGZ1bmN0aW9uICggaUluICkgewoJCSAqICAgICAgICAgIGlmICggaUluICZsdDsgMTAwMCApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBpSW47CgkJICogICAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICAgIHZhciAKCQkgKiAgICAgICAgICAgICAgcz0oaUluKyIiKSwgCgkJICogICAgICAgICAgICAgIGE9cy5zcGxpdCgiIiksIG91dD0iIiwgCgkJICogICAgICAgICAgICAgIGlMZW49cy5sZW5ndGg7CgkJICogICAgICAgICAgICAKCQkgKiAgICAgICAgICAgIGZvciAoIHZhciBpPTAgOyBpJmx0O2lMZW4gOyBpKysgKSB7CgkJICogICAgICAgICAgICAgIGlmICggaSUzID09PSAwICZhbXA7JmFtcDsgaSAhPT0gMCApIHsKCQkgKiAgICAgICAgICAgICAgICBvdXQgPSAiJyIrb3V0OwoJCSAqICAgICAgICAgICAgICB9CgkJICogICAgICAgICAgICAgIG91dCA9IGFbaUxlbi1pLTFdK291dDsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgcmV0dXJuIG91dDsKCQkgKiAgICAgICAgfTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuRm9ybWF0TnVtYmVyIjogZnVuY3Rpb24gKCBpSW4gKSB7CgkJCWlmICggaUluIDwgMTAwMCApCgkJCXsKCQkJCS8vIEEgc21hbGwgb3B0aW1pc2F0aW9uIGZvciB3aGF0IGlzIGxpa2VseSB0byBiZSB0aGUgbWFqb3JpdHkgb2YgdXNlIGNhc2VzCgkJCQlyZXR1cm4gaUluOwoJCQl9CgkKCQkJdmFyIHM9KGlJbisiIiksIGE9cy5zcGxpdCgiIiksIG91dD0iIiwgaUxlbj1zLmxlbmd0aDsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGklMyA9PT0gMCAmJiBpICE9PSAwICkKCQkJCXsKCQkJCQlvdXQgPSB0aGlzLm9MYW5ndWFnZS5zSW5mb1Rob3VzYW5kcytvdXQ7CgkJCQl9CgkJCQlvdXQgPSBhW2lMZW4taS0xXStvdXQ7CgkJCX0KCQkJcmV0dXJuIG91dDsKCQl9LAoJCgkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBldmVyeSAnZHJhdycgZXZlbnQsIGFuZCBhbGxvd3MgeW91IHRvCgkJICogZHluYW1pY2FsbHkgbW9kaWZ5IHRoZSBoZWFkZXIgcm93LiBUaGlzIGNhbiBiZSB1c2VkIHRvIGNhbGN1bGF0ZSBhbmQKCQkgKiBkaXNwbGF5IHVzZWZ1bCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGFibGUuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7bm9kZX0gbkhlYWQgIlRSIiBlbGVtZW50IGZvciB0aGUgaGVhZGVyCgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIEZ1bGwgdGFibGUgZGF0YSAoYXMgZGVyaXZlZCBmcm9tIHRoZSBvcmlnaW5hbCBIVE1MKQoJCSAqICBAcGFyYW0ge2ludH0gaVN0YXJ0IEluZGV4IGZvciB0aGUgY3VycmVudCBkaXNwbGF5IHN0YXJ0aW5nIHBvaW50IGluIHRoZQoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHtpbnR9IGlFbmQgSW5kZXggZm9yIHRoZSBjdXJyZW50IGRpc3BsYXkgZW5kaW5nIHBvaW50IGluIHRoZQoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheSBpbnR9IGFpRGlzcGxheSBJbmRleCBhcnJheSB0byB0cmFuc2xhdGUgdGhlIHZpc3VhbCBwb3NpdGlvbgoJCSAqICAgIHRvIHRoZSBmdWxsIGRhdGEgYXJyYXkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkhlYWRlckNhbGxiYWNrIjogZnVuY3Rpb24oIG5IZWFkLCBhRGF0YSwgaVN0YXJ0LCBpRW5kLCBhaURpc3BsYXkgKSB7CgkJICogICAgICAgICAgbkhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJylbMF0uaW5uZXJIVE1MID0gIkRpc3BsYXlpbmcgIisoaUVuZC1pU3RhcnQpKyIgcmVjb3JkcyI7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiZm5IZWFkZXJDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGNhbiBiZSB1c2VkIHRvIGNvbnZleSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgY3VycmVudAoJCSAqIHN0YXRlIG9mIHRoZSB0YWJsZS4gQWx0aG91Z2ggdGhlIGludGVybmF0aW9uYWxpc2F0aW9uIG9wdGlvbnMgcHJlc2VudGVkIGJ5CgkJICogRGF0YVRhYmxlcyBhcmUgcXVpdGUgY2FwYWJsZSBvZiBkZWFsaW5nIHdpdGggbW9zdCBjdXN0b21pc2F0aW9ucywgdGhlcmUgbWF5CgkJICogYmUgdGltZXMgd2hlcmUgeW91IHdpc2ggdG8gY3VzdG9taXNlIHRoZSBzdHJpbmcgZnVydGhlci4gVGhpcyBjYWxsYmFjawoJCSAqIGFsbG93cyB5b3UgdG8gZG8gZXhhY3RseSB0aGF0LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpU3RhcnQgU3RhcnRpbmcgcG9zaXRpb24gaW4gZGF0YSBmb3IgdGhlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlFbmQgRW5kIHBvc2l0aW9uIGluIGRhdGEgZm9yIHRoZSBkcmF3CgkJICogIEBwYXJhbSB7aW50fSBpTWF4IFRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSB0YWJsZSAocmVnYXJkbGVzcyBvZgoJCSAqICAgIGZpbHRlcmluZykKCQkgKiAgQHBhcmFtIHtpbnR9IGlUb3RhbCBUb3RhbCBudW1iZXIgb2Ygcm93cyBpbiB0aGUgZGF0YSBzZXQsIGFmdGVyIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ByZSBUaGUgc3RyaW5nIHRoYXQgRGF0YVRhYmxlcyBoYXMgZm9ybWF0dGVkIHVzaW5nIGl0J3MKCQkgKiAgICBvd24gcnVsZXMKCQkgKiAgQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGluZm9ybWF0aW9uIGVsZW1lbnQuCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgImZuSW5mb0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncywgaVN0YXJ0LCBpRW5kLCBpTWF4LCBpVG90YWwsIHNQcmUgKSB7CgkJICogICAgICAgIHJldHVybiBpU3RhcnQgKyIgdG8gIisgaUVuZDsKCQkgKiAgICAgIH0KCQkgKiAgICB9ICk7CgkJICovCgkJImZuSW5mb0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGVkIHdoZW4gdGhlIHRhYmxlIGhhcyBiZWVuIGluaXRpYWxpc2VkLiBOb3JtYWxseSBEYXRhVGFibGVzIHdpbGwKCQkgKiBpbml0aWFsaXNlIHNlcXVlbnRpYWxseSBhbmQgdGhlcmUgd2lsbCBiZSBubyBuZWVkIGZvciB0aGlzIGZ1bmN0aW9uLAoJCSAqIGhvd2V2ZXIsIHRoaXMgZG9lcyBub3QgaG9sZCB0cnVlIHdoZW4gdXNpbmcgZXh0ZXJuYWwgbGFuZ3VhZ2UgaW5mb3JtYXRpb24KCQkgKiBzaW5jZSB0aGF0IGlzIG9idGFpbmVkIHVzaW5nIGFuIGFzeW5jIFhIUiBjYWxsLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBKU09OIG9iamVjdCByZXF1ZXN0IGZyb20gdGhlIHNlcnZlciAtIG9ubHkKCQkgKiAgICBwcmVzZW50IGlmIGNsaWVudC1zaWRlIEFqYXggc291cmNlZCBkYXRhIGlzIHVzZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkluaXRDb21wbGV0ZSI6IGZ1bmN0aW9uKG9TZXR0aW5ncywganNvbikgewoJCSAqICAgICAgICAgIGFsZXJ0KCAnRGF0YVRhYmxlcyBoYXMgZmluaXNoZWQgaXRzIGluaXRpYWxpc2F0aW9uLicgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJmbkluaXRDb21wbGV0ZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIENhbGxlZCBhdCB0aGUgdmVyeSBzdGFydCBvZiBlYWNoIHRhYmxlIGRyYXcgYW5kIGNhbiBiZSB1c2VkIHRvIGNhbmNlbCB0aGUKCQkgKiBkcmF3IGJ5IHJldHVybmluZyBmYWxzZSwgYW55IG90aGVyIHJldHVybiAoaW5jbHVkaW5nIHVuZGVmaW5lZCkgcmVzdWx0cyBpbgoJCSAqIHRoZSBmdWxsIGRyYXcgb2NjdXJyaW5nKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gRmFsc2Ugd2lsbCBjYW5jZWwgdGhlIGRyYXcsIGFueXRoaW5nIGVsc2UgKGluY2x1ZGluZyBubwoJCSAqICAgIHJldHVybikgd2lsbCBhbGxvdyBpdCB0byBjb21wbGV0ZS4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmblByZURyYXdDYWxsYmFjayI6IGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJICogICAgICAgICAgaWYgKCAkKCcjdGVzdCcpLnZhbCgpID09IDEgKSB7CgkJICogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblByZURyYXdDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHlvdSB0byAncG9zdCBwcm9jZXNzJyBlYWNoIHJvdyBhZnRlciBpdCBoYXZlIGJlZW4KCQkgKiBnZW5lcmF0ZWQgZm9yIGVhY2ggdGFibGUgZHJhdywgYnV0IGJlZm9yZSBpdCBpcyByZW5kZXJlZCBvbiBzY3JlZW4uIFRoaXMKCQkgKiBmdW5jdGlvbiBtaWdodCBiZSB1c2VkIGZvciBzZXR0aW5nIHRoZSByb3cgY2xhc3MgbmFtZSBldGMuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7bm9kZX0gblJvdyAiVFIiIGVsZW1lbnQgZm9yIHRoZSBjdXJyZW50IHJvdwoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSYXcgZGF0YSBhcnJheSBmb3IgdGhpcyByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlEaXNwbGF5SW5kZXggVGhlIGRpc3BsYXkgaW5kZXggZm9yIHRoZSBjdXJyZW50IHRhYmxlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlEaXNwbGF5SW5kZXhGdWxsIFRoZSBpbmRleCBvZiB0aGUgZGF0YSBpbiB0aGUgZnVsbCBsaXN0IG9mCgkJICogICAgcm93cyAoYWZ0ZXIgZmlsdGVyaW5nKQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuUm93Q2FsbGJhY2siOiBmdW5jdGlvbiggblJvdywgYURhdGEsIGlEaXNwbGF5SW5kZXgsIGlEaXNwbGF5SW5kZXhGdWxsICkgewoJCSAqICAgICAgICAgIC8vIEJvbGQgdGhlIGdyYWRlIGZvciBhbGwgJ0EnIGdyYWRlIGJyb3dzZXJzCgkJICogICAgICAgICAgaWYgKCBhRGF0YVs0XSA9PSAiQSIgKQoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICQoJ3RkOmVxKDQpJywgblJvdykuaHRtbCggJzxiPkE8L2I+JyApOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Sb3dDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgZnVuY3Rpb24gd2hpY2ggb2J0YWlucwoJCSAqIHRoZSBkYXRhIGZyb20gdGhlIHNlcnZlciAoJC5nZXRKU09OKSBzbyBzb21ldGhpbmcgbW9yZSBzdWl0YWJsZSBmb3IgeW91cgoJCSAqIGFwcGxpY2F0aW9uLiBGb3IgZXhhbXBsZSB5b3UgY291bGQgdXNlIFBPU1QgZGF0YSwgb3IgcHVsbCBpbmZvcm1hdGlvbiBmcm9tCgkJICogYSBHZWFycyBvciBBSVIgZGF0YWJhc2UuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBtZW1iZXIKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTb3VyY2UgSFRUUCBzb3VyY2UgdG8gb2J0YWluIHRoZSBkYXRhIGZyb20gKHNBamF4U291cmNlKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0RhdGEgQSBrZXkvdmFsdWUgcGFpciBvYmplY3QgY29udGFpbmluZyB0aGUgZGF0YSB0byBzZW5kCgkJICogICAgdG8gdGhlIHNlcnZlcgoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBmbkNhbGxiYWNrIHRvIGJlIGNhbGxlZCBvbiBjb21wbGV0aW9uIG9mIHRoZSBkYXRhIGdldAoJCSAqICAgIHByb2Nlc3MgdGhhdCB3aWxsIGRyYXcgdGhlIGRhdGEgb24gdGhlIHBhZ2UuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBQT1NUIGRhdGEgdG8gc2VydmVyCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInhoci5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJEYXRhIjogZnVuY3Rpb24gKCBzU291cmNlLCBhb0RhdGEsIGZuQ2FsbGJhY2ssIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBvU2V0dGluZ3MuanFYSFIgPSAkLmFqYXgoIHsKCQkgKiAgICAgICAgICAgICJkYXRhVHlwZSI6ICdqc29uJywgCgkJICogICAgICAgICAgICAidHlwZSI6ICJQT1NUIiwgCgkJICogICAgICAgICAgICAidXJsIjogc1NvdXJjZSwgCgkJICogICAgICAgICAgICAiZGF0YSI6IGFvRGF0YSwgCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZuQ2FsbGJhY2sKCQkgKiAgICAgICAgICB9ICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU2VydmVyRGF0YSI6IGZ1bmN0aW9uICggc1VybCwgYW9EYXRhLCBmbkNhbGxiYWNrLCBvU2V0dGluZ3MgKSB7CgkJCW9TZXR0aW5ncy5qcVhIUiA9ICQuYWpheCggewoJCQkJInVybCI6ICBzVXJsLAoJCQkJImRhdGEiOiBhb0RhdGEsCgkJCQkic3VjY2VzcyI6IGZ1bmN0aW9uIChqc29uKSB7CgkJCQkJaWYgKCBqc29uLnNFcnJvciApIHsKCQkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuTG9nKCBvU2V0dGluZ3MsIDAsIGpzb24uc0Vycm9yICk7CgkJCQkJfQoJCQkJCQoJCQkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigneGhyJywgW29TZXR0aW5ncywganNvbl0pOwoJCQkJCWZuQ2FsbGJhY2soIGpzb24gKTsKCQkJCX0sCgkJCQkiZGF0YVR5cGUiOiAianNvbiIsCgkJCQkiY2FjaGUiOiBmYWxzZSwKCQkJCSJ0eXBlIjogb1NldHRpbmdzLnNTZXJ2ZXJNZXRob2QsCgkJCQkiZXJyb3IiOiBmdW5jdGlvbiAoeGhyLCBlcnJvciwgdGhyb3duKSB7CgkJCQkJaWYgKCBlcnJvciA9PSAicGFyc2VyZXJyb3IiICkgewoJCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5Mb2coIG9TZXR0aW5ncywgMCwgIkRhdGFUYWJsZXMgd2FybmluZzogSlNPTiBkYXRhIGZyb20gIisKCQkJCQkJCSJzZXJ2ZXIgY291bGQgbm90IGJlIHBhcnNlZC4gVGhpcyBpcyBjYXVzZWQgYnkgYSBKU09OIGZvcm1hdHRpbmcgZXJyb3IuIiApOwoJCQkJCX0KCQkJCX0KCQkJfSApOwoJCX0sCgkKCQoJCS8qKgoJCSAqIEl0IGlzIG9mdGVuIHVzZWZ1bCB0byBzZW5kIGV4dHJhIGRhdGEgdG8gdGhlIHNlcnZlciB3aGVuIG1ha2luZyBhbiBBamF4CgkJICogcmVxdWVzdCAtIGZvciBleGFtcGxlIGN1c3RvbSBmaWx0ZXJpbmcgaW5mb3JtYXRpb24sIGFuZCB0aGlzIGNhbGxiYWNrCgkJICogZnVuY3Rpb24gbWFrZXMgaXQgdHJpdmlhbCB0byBzZW5kIGV4dHJhIGluZm9ybWF0aW9uIHRvIHRoZSBzZXJ2ZXIuIFRoZQoJCSAqIHBhc3NlZCBpbiBwYXJhbWV0ZXIgaXMgdGhlIGRhdGEgc2V0IHRoYXQgaGFzIGJlZW4gY29uc3RydWN0ZWQgYnkKCQkgKiBEYXRhVGFibGVzLCBhbmQgeW91IGNhbiBhZGQgdG8gdGhpcyBvciBtb2RpZnkgaXQgYXMgeW91IHJlcXVpcmUuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl9IGFvRGF0YSBEYXRhIGFycmF5IChhcnJheSBvZiBvYmplY3RzIHdoaWNoIGFyZSBuYW1lL3ZhbHVlCgkJICogICAgcGFpcnMpIHRoYXQgaGFzIGJlZW4gY29uc3RydWN0ZWQgYnkgRGF0YVRhYmxlcyBhbmQgd2lsbCBiZSBzZW50IHRvIHRoZQoJCSAqICAgIHNlcnZlci4gSW4gdGhlIGNhc2Ugb2YgQWpheCBzb3VyY2VkIGRhdGEgd2l0aCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nCgkJICogICAgdGhpcyB3aWxsIGJlIGFuIGVtcHR5IGFycmF5LCBmb3Igc2VydmVyLXNpZGUgcHJvY2Vzc2luZyB0aGVyZSB3aWxsIGJlIGEKCQkgKiAgICBzaWduaWZpY2FudCBudW1iZXIgb2YgcGFyYW1ldGVycyEKCQkgKiAgQHJldHVybnMge3VuZGVmaW5lZH0gRW5zdXJlIHRoYXQgeW91IG1vZGlmeSB0aGUgYW9EYXRhIGFycmF5IHBhc3NlZCBpbiwKCQkgKiAgICBhcyB0aGlzIGlzIHBhc3NlZCBieSByZWZlcmVuY2UuCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNjcmlwdHMvc2VydmVyX3Byb2Nlc3NpbmcucGhwIiwKCQkgKiAgICAgICAgImZuU2VydmVyUGFyYW1zIjogZnVuY3Rpb24gKCBhb0RhdGEgKSB7CgkJICogICAgICAgICAgYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAibW9yZV9kYXRhIiwgInZhbHVlIjogIm15X3ZhbHVlIiB9ICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU2VydmVyUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogTG9hZCB0aGUgdGFibGUgc3RhdGUuIFdpdGggdGhpcyBmdW5jdGlvbiB5b3UgY2FuIGRlZmluZSBmcm9tIHdoZXJlLCBhbmQgaG93LCB0aGUKCQkgKiBzdGF0ZSBvZiBhIHRhYmxlIGlzIGxvYWRlZC4gQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9hZCBmcm9tIGl0cyBzdGF0ZSBzYXZpbmcKCQkgKiBjb29raWUsIGJ1dCB5b3UgbWlnaHQgd2lzaCB0byB1c2UgbG9jYWwgc3RvcmFnZSAoSFRNTDUpIG9yIGEgc2VydmVyLXNpZGUgZGF0YWJhc2UuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBtZW1iZXIKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJuIHtvYmplY3R9IFRoZSBEYXRhVGFibGVzIHN0YXRlIG9iamVjdCB0byBiZSBsb2FkZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkIjogZnVuY3Rpb24gKG9TZXR0aW5ncykgewoJCSAqICAgICAgICAgIHZhciBvOwoJCSAqICAgICAgICAgIAoJCSAqICAgICAgICAgIC8vIFNlbmQgYW4gQWpheCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgdG8gZ2V0IHRoZSBkYXRhLiBOb3RlIHRoYXQKCQkgKiAgICAgICAgICAvLyB0aGlzIGlzIGEgc3luY2hyb25vdXMgcmVxdWVzdC4KCQkgKiAgICAgICAgICAkLmFqYXgoIHsKCQkgKiAgICAgICAgICAgICJ1cmwiOiAiL3N0YXRlX2xvYWQiLAoJCSAqICAgICAgICAgICAgImFzeW5jIjogZmFsc2UsCgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAianNvbiIsCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZ1bmN0aW9uIChqc29uKSB7CgkJICogICAgICAgICAgICAgIG8gPSBqc29uOwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICByZXR1cm4gbzsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZUxvYWQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncyApIHsKCQkJdmFyIHNEYXRhID0gdGhpcy5vQXBpLl9mblJlYWRDb29raWUoIG9TZXR0aW5ncy5zQ29va2llUHJlZml4K29TZXR0aW5ncy5zSW5zdGFuY2UgKTsKCQkJdmFyIG9EYXRhOwoJCgkJCXRyeSB7CgkJCQlvRGF0YSA9ICh0eXBlb2YgJC5wYXJzZUpTT04gPT09ICdmdW5jdGlvbicpID8gCgkJCQkJJC5wYXJzZUpTT04oc0RhdGEpIDogZXZhbCggJygnK3NEYXRhKycpJyApOwoJCQl9IGNhdGNoIChlKSB7CgkJCQlvRGF0YSA9IG51bGw7CgkJCX0KCQoJCQlyZXR1cm4gb0RhdGE7CgkJfSwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgd2hpY2ggYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc2F2ZWQgc3RhdGUgcHJpb3IgdG8gbG9hZGluZyB0aGF0IHN0YXRlLgoJCSAqIFRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gdGhlIHRhYmxlIGlzIGxvYWRpbmcgc3RhdGUgZnJvbSB0aGUgc3RvcmVkIGRhdGEsIGJ1dAoJCSAqIHByaW9yIHRvIHRoZSBzZXR0aW5ncyBvYmplY3QgYmVpbmcgbW9kaWZpZWQgYnkgdGhlIHNhdmVkIHN0YXRlLiBOb3RlIHRoYXQgZm9yIAoJCSAqIHBsdWctaW4gYXV0aG9ycywgeW91IHNob3VsZCB1c2UgdGhlICdzdGF0ZUxvYWRQYXJhbXMnIGV2ZW50IHRvIGxvYWQgcGFyYW1ldGVycyBmb3IgCgkJICogYSBwbHVnLWluLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRoYXQgaXMgdG8gYmUgbG9hZGVkCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSZW1vdmUgYSBzYXZlZCBmaWx0ZXIsIHNvIGZpbHRlcmluZyBpcyBuZXZlciBsb2FkZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZFBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgb0RhdGEub1NlYXJjaC5zU2VhcmNoID0gIiI7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gRGlzYWxsb3cgc3RhdGUgbG9hZGluZyBieSByZXR1cm5pbmcgZmFsc2UKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZFBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlTG9hZFBhcmFtcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHRoYXQgaXMgY2FsbGVkIHdoZW4gdGhlIHN0YXRlIGhhcyBiZWVuIGxvYWRlZCBmcm9tIHRoZSBzdGF0ZSBzYXZpbmcgbWV0aG9kCgkJICogYW5kIHRoZSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCBoYXMgYmVlbiBtb2RpZmllZCBhcyBhIHJlc3VsdCBvZiB0aGUgbG9hZGVkIHN0YXRlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRoYXQgd2FzIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gU2hvdyBhbiBhbGVydCB3aXRoIHRoZSBmaWx0ZXJpbmcgdmFsdWUgdGhhdCB3YXMgc2F2ZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZGVkIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBhbGVydCggJ1NhdmVkIGZpbHRlciB3YXM6ICcrb0RhdGEub1NlYXJjaC5zU2VhcmNoICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVMb2FkZWQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBTYXZlIHRoZSB0YWJsZSBzdGF0ZS4gVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvIGRlZmluZSB3aGVyZSBhbmQgaG93IHRoZSBzdGF0ZQoJCSAqIGluZm9ybWF0aW9uIGZvciB0aGUgdGFibGUgaXMgc3RvcmVkIC0gYnkgZGVmYXVsdCBpdCB3aWxsIHVzZSBhIGNvb2tpZSwgYnV0IHlvdQoJCSAqIG1pZ2h0IHdhbnQgdG8gdXNlIGxvY2FsIHN0b3JhZ2UgKEhUTUw1KSBvciBhIHNlcnZlci1zaWRlIGRhdGFiYXNlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdG8gYmUgc2F2ZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVTYXZlIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICAvLyBTZW5kIGFuIEFqYXggcmVxdWVzdCB0byB0aGUgc2VydmVyIHdpdGggdGhlIHN0YXRlIG9iamVjdAoJCSAqICAgICAgICAgICQuYWpheCggewoJCSAqICAgICAgICAgICAgInVybCI6ICIvc3RhdGVfc2F2ZSIsCgkJICogICAgICAgICAgICAiZGF0YSI6IG9EYXRhLAoJCSAqICAgICAgICAgICAgImRhdGFUeXBlIjogImpzb24iLAoJCSAqICAgICAgICAgICAgIm1ldGhvZCI6ICJQT1NUIgoJCSAqICAgICAgICAgICAgInN1Y2Nlc3MiOiBmdW5jdGlvbiAoKSB7fQoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgb0RhdGEgKSB7CgkJCXRoaXMub0FwaS5fZm5DcmVhdGVDb29raWUoIAoJCQkJb1NldHRpbmdzLnNDb29raWVQcmVmaXgrb1NldHRpbmdzLnNJbnN0YW5jZSwgCgkJCQl0aGlzLm9BcGkuX2ZuSnNvblN0cmluZyhvRGF0YSksIAoJCQkJb1NldHRpbmdzLmlDb29raWVEdXJhdGlvbiwgCgkJCQlvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCwgCgkJCQlvU2V0dGluZ3MuZm5Db29raWVDYWxsYmFjawoJCQkpOwoJCX0sCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHdoaWNoIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHN0YXRlIHRvIGJlIHNhdmVkLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgCgkJICogaGFzIGNoYW5nZWQgc3RhdGUgYSBuZXcgc3RhdGUgc2F2ZSBpcyByZXF1aXJlZC4gVGhpcyBtZXRob2QgYWxsb3dzIG1vZGlmaWNhdGlvbiBvZgoJCSAqIHRoZSBzdGF0ZSBzYXZpbmcgb2JqZWN0IHByaW9yIHRvIGFjdHVhbGx5IGRvaW5nIHRoZSBzYXZlLCBpbmNsdWRpbmcgYWRkaXRpb24gb3IgCgkJICogb3RoZXIgc3RhdGUgcHJvcGVydGllcyBvciBtb2RpZmljYXRpb24uIE5vdGUgdGhhdCBmb3IgcGx1Zy1pbiBhdXRob3JzLCB5b3Ugc2hvdWxkIAoJCSAqIHVzZSB0aGUgJ3N0YXRlU2F2ZVBhcmFtcycgZXZlbnQgdG8gc2F2ZSBwYXJhbWV0ZXJzIGZvciBhIHBsdWctaW4uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdG8gYmUgc2F2ZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFJlbW92ZSBhIHNhdmVkIGZpbHRlciwgc28gZmlsdGVyaW5nIGlzIG5ldmVyIHNhdmVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZVNhdmVQYXJhbXMiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIG9EYXRhLm9TZWFyY2guc1NlYXJjaCA9ICIiOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlU2F2ZVBhcmFtcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIER1cmF0aW9uIG9mIHRoZSBjb29raWUgd2hpY2ggaXMgdXNlZCBmb3Igc3RvcmluZyBzZXNzaW9uIGluZm9ybWF0aW9uLiBUaGlzCgkJICogdmFsdWUgaXMgZ2l2ZW4gaW4gc2Vjb25kcy4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDcyMDAgPGk+KDIgaG91cnMpPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpQ29va2llRHVyYXRpb24iOiA2MCo2MCoyNDsgLy8gMSBkYXkKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaUNvb2tpZUR1cmF0aW9uIjogNzIwMCwKCQoJCgkJLyoqCgkJICogV2hlbiBlbmFibGVkIERhdGFUYWJsZXMgd2lsbCBub3QgbWFrZSBhIHJlcXVlc3QgdG8gdGhlIHNlcnZlciBmb3IgdGhlIGZpcnN0CgkJICogcGFnZSBkcmF3IC0gcmF0aGVyIGl0IHdpbGwgdXNlIHRoZSBkYXRhIGFscmVhZHkgb24gdGhlIHBhZ2UgKG5vIHNvcnRpbmcgZXRjCgkJICogd2lsbCBiZSBhcHBsaWVkIHRvIGl0KSwgdGh1cyBzYXZpbmcgb24gYW4gWEhSIGF0IGxvYWQgdGltZS4gaURlZmVyTG9hZGluZwoJCSAqIGlzIHVzZWQgdG8gaW5kaWNhdGUgdGhhdCBkZWZlcnJlZCBsb2FkaW5nIGlzIHJlcXVpcmVkLCBidXQgaXQgaXMgYWxzbyB1c2VkCgkJICogdG8gdGVsbCBEYXRhVGFibGVzIGhvdyBtYW55IHJlY29yZHMgdGhlcmUgYXJlIGluIHRoZSBmdWxsIHRhYmxlIChhbGxvd2luZwoJCSAqIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGFuZCBwYWdpbmF0aW9uIHRvIGJlIGRpc3BsYXllZCBjb3JyZWN0bHkpLiBJbiB0aGUgY2FzZQoJCSAqIHdoZXJlIGEgZmlsdGVyaW5nIGlzIGFwcGxpZWQgdG8gdGhlIHRhYmxlIG9uIGluaXRpYWwgbG9hZCwgdGhpcyBjYW4gYmUKCQkgKiBpbmRpY2F0ZWQgYnkgZ2l2aW5nIHRoZSBwYXJhbWV0ZXIgYXMgYW4gYXJyYXksIHdoZXJlIHRoZSBmaXJzdCBlbGVtZW50IGlzCgkJICogdGhlIG51bWJlciBvZiByZWNvcmRzIGF2YWlsYWJsZSBhZnRlciBmaWx0ZXJpbmcgYW5kIHRoZSBzZWNvbmQgZWxlbWVudCBpcyB0aGUKCQkgKiBudW1iZXIgb2YgcmVjb3JkcyB3aXRob3V0IGZpbHRlcmluZyAoYWxsb3dpbmcgdGhlIHRhYmxlIGluZm9ybWF0aW9uIGVsZW1lbnQKCQkgKiB0byBiZSBzaG93biBjb3JyZWN0bHkpLgoJCSAqICBAdHlwZSBpbnQgfCBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gNTcgcmVjb3JkcyBhdmFpbGFibGUgaW4gdGhlIHRhYmxlLCBubyBmaWx0ZXJpbmcgYXBwbGllZAoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3NlcnZlcl9wcm9jZXNzaW5nLnBocCIsCgkJICogICAgICAgICJpRGVmZXJMb2FkaW5nIjogNTcKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gNTcgcmVjb3JkcyBhZnRlciBmaWx0ZXJpbmcsIDEwMCB3aXRob3V0IGZpbHRlcmluZyAoYW4gaW5pdGlhbCBmaWx0ZXIgYXBwbGllZCkKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiaURlZmVyTG9hZGluZyI6IFsgNTcsIDEwMCBdLAoJCSAqICAgICAgICAib1NlYXJjaCI6IHsKCQkgKiAgICAgICAgICAic1NlYXJjaCI6ICJteV9maWx0ZXIiCgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlEZWZlckxvYWRpbmciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBOdW1iZXIgb2Ygcm93cyB0byBkaXNwbGF5IG9uIGEgc2luZ2xlIHBhZ2Ugd2hlbiB1c2luZyBwYWdpbmF0aW9uLiBJZgoJCSAqIGZlYXR1cmUgZW5hYmxlZCAoYkxlbmd0aENoYW5nZSkgdGhlbiB0aGUgZW5kIHVzZXIgd2lsbCBiZSBhYmxlIHRvIG92ZXJyaWRlCgkJICogdGhpcyB0byBhIGN1c3RvbSBzZXR0aW5nIHVzaW5nIGEgcG9wLXVwIG1lbnUuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUwCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImlEaXNwbGF5TGVuZ3RoIjogMTAsCgkKCQoJCS8qKgoJCSAqIERlZmluZSB0aGUgc3RhcnRpbmcgcG9pbnQgZm9yIGRhdGEgZGlzcGxheSB3aGVuIHVzaW5nIERhdGFUYWJsZXMgd2l0aAoJCSAqIHBhZ2luYXRpb24uIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciBpcyB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJhdGhlciB0aGFuCgkJICogdGhlIHBhZ2UgbnVtYmVyLCBzbyBpZiB5b3UgaGF2ZSAxMCByZWNvcmRzIHBlciBwYWdlIGFuZCB3YW50IHRvIHN0YXJ0IG9uCgkJICogdGhlIHRoaXJkIHBhZ2UsIGl0IHNob3VsZCBiZSAiMjAiLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheVN0YXJ0IjogMjAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaURpc3BsYXlTdGFydCI6IDAsCgkKCQoJCS8qKgoJCSAqIFRoZSBzY3JvbGwgZ2FwIGlzIHRoZSBhbW91bnQgb2Ygc2Nyb2xsaW5nIHRoYXQgaXMgbGVmdCB0byBnbyBiZWZvcmUKCQkgKiBEYXRhVGFibGVzIHdpbGwgbG9hZCB0aGUgbmV4dCAncGFnZScgb2YgZGF0YSBhdXRvbWF0aWNhbGx5LiBZb3UgdHlwaWNhbGx5CgkJICogd2FudCBhIGdhcCB3aGljaCBpcyBiaWcgZW5vdWdoIHRoYXQgdGhlIHNjcm9sbGluZyB3aWxsIGJlIHNtb290aCBmb3IgdGhlCgkJICogdXNlciwgd2hpbGUgbm90IHNvIGxhcmdlIHRoYXQgaXQgd2lsbCBsb2FkIG1vcmUgZGF0YSB0aGFuIG5lZWQuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNjcm9sbEluZmluaXRlIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUsCgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJpU2Nyb2xsTG9hZEdhcCI6IDUwCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpU2Nyb2xsTG9hZEdhcCI6IDEwMCwKCQoJCgkJLyoqCgkJICogQnkgZGVmYXVsdCBEYXRhVGFibGVzIGFsbG93cyBrZXlib2FyZCBuYXZpZ2F0aW9uIG9mIHRoZSB0YWJsZSAoc29ydGluZywgcGFnaW5nLAoJCSAqIGFuZCBmaWx0ZXJpbmcpIGJ5IGFkZGluZyBhIHRhYmluZGV4IGF0dHJpYnV0ZSB0byB0aGUgcmVxdWlyZWQgZWxlbWVudHMuIFRoaXMKCQkgKiBhbGxvd3MgeW91IHRvIHRhYiB0aHJvdWdoIHRoZSBjb250cm9scyBhbmQgcHJlc3MgdGhlIGVudGVyIGtleSB0byBhY3RpdmF0ZSB0aGVtLgoJCSAqIFRoZSB0YWJpbmRleCBpcyBkZWZhdWx0IDAsIG1lYW5pbmcgdGhhdCB0aGUgdGFiIGZvbGxvd3MgdGhlIGZsb3cgb2YgdGhlIGRvY3VtZW50LgoJCSAqIFlvdSBjYW4gb3ZlcnJ1bGUgdGhpcyB1c2luZyB0aGlzIHBhcmFtZXRlciBpZiB5b3Ugd2lzaC4gVXNlIGEgdmFsdWUgb2YgLTEgdG8KCQkgKiBkaXNhYmxlIGJ1aWx0LWluIGtleWJvYXJkIG5hdmlnYXRpb24uCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlUYWJJbmRleCI6IDEKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlUYWJJbmRleCI6IDAsCgkKCQoJCS8qKgoJCSAqIEFsbCBzdHJpbmdzIHRoYXQgRGF0YVRhYmxlcyB1c2VzIGluIHRoZSB1c2VyIGludGVyZmFjZSB0aGF0IGl0IGNyZWF0ZXMKCQkgKiBhcmUgZGVmaW5lZCBpbiB0aGlzIG9iamVjdCwgYWxsb3dpbmcgeW91IHRvIG1vZGlmaWVkIHRoZW0gaW5kaXZpZHVhbGx5IG9yCgkJICogY29tcGxldGVseSByZXBsYWNlIHRoZW0gYWxsIGFzIHJlcXVpcmVkLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJIm9MYW5ndWFnZSI6IHsKCQkJLyoqCgkJCSAqIFN0cmluZ3MgdGhhdCBhcmUgdXNlZCBmb3IgV0FJLUFSSUEgbGFiZWxzIGFuZCBjb250cm9scyBvbmx5ICh0aGVzZSBhcmUgbm90CgkJCSAqIGFjdHVhbGx5IHZpc2libGUgb24gdGhlIHBhZ2UsIGJ1dCB3aWxsIGJlIHJlYWQgYnkgc2NyZWVucmVhZGVycywgYW5kIHRodXMKCQkJICogbXVzdCBiZSBpbnRlcm5hdGlvbmFsaXNlZCBhcyB3ZWxsKS4KCQkJICogIEBuYW1lc3BhY2UKCQkJICovCgkJCSJvQXJpYSI6IHsKCQkJCS8qKgoJCQkJICogQVJJQSBsYWJlbCB0aGF0IGlzIGFkZGVkIHRvIHRoZSB0YWJsZSBoZWFkZXJzIHdoZW4gdGhlIGNvbHVtbiBtYXkgYmUKCQkJCSAqIHNvcnRlZCBhc2NlbmRpbmcgYnkgYWN0aXZpbmcgdGhlIGNvbHVtbiAoY2xpY2sgb3IgcmV0dXJuIHdoZW4gZm9jdXNlZCkuCgkJCQkgKiBOb3RlIHRoYXQgdGhlIGNvbHVtbiBoZWFkZXIgaXMgcHJlZml4ZWQgdG8gdGhpcyBzdHJpbmcuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmcKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvQXJpYSI6IHsKCQkJCSAqICAgICAgICAgICAgInNTb3J0QXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGFzY2VuZGluZyIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNTb3J0QXNjZW5kaW5nIjogIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nIiwKCQoJCQkJLyoqCgkJCQkgKiBBUklBIGxhYmVsIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHRhYmxlIGhlYWRlcnMgd2hlbiB0aGUgY29sdW1uIG1heSBiZQoJCQkJICogc29ydGVkIGRlc2NlbmRpbmcgYnkgYWN0aXZpbmcgdGhlIGNvbHVtbiAoY2xpY2sgb3IgcmV0dXJuIHdoZW4gZm9jdXNlZCkuCgkJCQkgKiBOb3RlIHRoYXQgdGhlIGNvbHVtbiBoZWFkZXIgaXMgcHJlZml4ZWQgdG8gdGhpcyBzdHJpbmcuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmcKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvQXJpYSI6IHsKCQkJCSAqICAgICAgICAgICAgInNTb3J0RGVzY2VuZGluZyI6ICIgLSBjbGljay9yZXR1cm4gdG8gc29ydCBkZXNjZW5kaW5nIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic1NvcnREZXNjZW5kaW5nIjogIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gZGVzY2VuZGluZyIKCQkJfSwKCQoJCQkvKioKCQkJICogUGFnaW5hdGlvbiBzdHJpbmcgdXNlZCBieSBEYXRhVGFibGVzIGZvciB0aGUgdHdvIGJ1aWx0LWluIHBhZ2luYXRpb24KCQkJICogY29udHJvbCB0eXBlcyAoInR3b19idXR0b24iIGFuZCAiZnVsbF9udW1iZXJzIikKCQkJICogIEBuYW1lc3BhY2UKCQkJICovCgkJCSJvUGFnaW5hdGUiOiB7CgkJCQkvKioKCQkJCSAqIFRleHQgdG8gdXNlIHdoZW4gdXNpbmcgdGhlICdmdWxsX251bWJlcnMnIHR5cGUgb2YgcGFnaW5hdGlvbiBmb3IgdGhlCgkJCQkgKiBidXR0b24gdG8gdGFrZSB0aGUgdXNlciB0byB0aGUgZmlyc3QgcGFnZS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBGaXJzdAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9QYWdpbmF0ZSI6IHsKCQkJCSAqICAgICAgICAgICAgInNGaXJzdCI6ICJGaXJzdCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic0ZpcnN0IjogIkZpcnN0IiwKCQkJCgkJCQoJCQkJLyoqCgkJCQkgKiBUZXh0IHRvIHVzZSB3aGVuIHVzaW5nIHRoZSAnZnVsbF9udW1iZXJzJyB0eXBlIG9mIHBhZ2luYXRpb24gZm9yIHRoZQoJCQkJICogYnV0dG9uIHRvIHRha2UgdGhlIHVzZXIgdG8gdGhlIGxhc3QgcGFnZS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBMYXN0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic0xhc3QiOiAiTGFzdCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic0xhc3QiOiAiTGFzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2UgZm9yIHRoZSAnbmV4dCcgcGFnaW5hdGlvbiBidXR0b24gKHRvIHRha2UgdGhlIHVzZXIgdG8gdGhlIAoJCQkJICogbmV4dCBwYWdlKS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBOZXh0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic05leHQiOiAiTmV4dCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic05leHQiOiAiTmV4dCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2UgZm9yIHRoZSAncHJldmlvdXMnIHBhZ2luYXRpb24gYnV0dG9uICh0byB0YWtlIHRoZSB1c2VyIHRvICAKCQkJCSAqIHRoZSBwcmV2aW91cyBwYWdlKS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBQcmV2aW91cwoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9QYWdpbmF0ZSI6IHsKCQkJCSAqICAgICAgICAgICAgInNQcmV2aW91cyI6ICJQcmV2aW91cyBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic1ByZXZpb3VzIjogIlByZXZpb3VzIgoJCQl9LAoJCQoJCQkvKioKCQkJICogVGhpcyBzdHJpbmcgaXMgc2hvd24gaW4gcHJlZmVyZW5jZSB0byBzWmVyb1JlY29yZHMgd2hlbiB0aGUgdGFibGUgaXMKCQkJICogZW1wdHkgb2YgZGF0YSAocmVnYXJkbGVzcyBvZiBmaWx0ZXJpbmcpLiBOb3RlIHRoYXQgdGhpcyBpcyBhbiBvcHRpb25hbAoJCQkgKiBwYXJhbWV0ZXIgLSBpZiBpdCBpcyBub3QgZ2l2ZW4sIHRoZSB2YWx1ZSBvZiBzWmVyb1JlY29yZHMgd2lsbCBiZSB1c2VkCgkJCSAqIGluc3RlYWQgKGVpdGhlciB0aGUgZGVmYXVsdCBvciBnaXZlbiB2YWx1ZSkuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IE5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBUaGlzIHN0cmluZyBnaXZlcyBpbmZvcm1hdGlvbiB0byB0aGUgZW5kIHVzZXIgYWJvdXQgdGhlIGluZm9ybWF0aW9uIHRoYXQgCgkJCSAqIGlzIGN1cnJlbnQgb24gZGlzcGxheSBvbiB0aGUgcGFnZS4gVGhlIF9TVEFSVF8sIF9FTkRfIGFuZCBfVE9UQUxfIAoJCQkgKiB2YXJpYWJsZXMgYXJlIGFsbCBkeW5hbWljYWxseSByZXBsYWNlZCBhcyB0aGUgdGFibGUgZGlzcGxheSB1cGRhdGVzLCBhbmQgCgkJCSAqIGNhbiBiZSBmcmVlbHkgbW92ZWQgb3IgcmVtb3ZlZCBhcyB0aGUgbGFuZ3VhZ2UgcmVxdWlyZW1lbnRzIGNoYW5nZS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0luZm8iOiAiR290IGEgdG90YWwgb2YgX1RPVEFMXyBlbnRyaWVzIHRvIHNob3cgKF9TVEFSVF8gdG8gX0VORF8pIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNJbmZvIjogIlNob3dpbmcgX1NUQVJUXyB0byBfRU5EXyBvZiBfVE9UQUxfIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogRGlzcGxheSBpbmZvcm1hdGlvbiBzdHJpbmcgZm9yIHdoZW4gdGhlIHRhYmxlIGlzIGVtcHR5LiBUeXBpY2FsbHkgdGhlIAoJCQkgKiBmb3JtYXQgb2YgdGhpcyBzdHJpbmcgc2hvdWxkIG1hdGNoIHNJbmZvLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBTaG93aW5nIDAgdG8gMCBvZiAwIGVudHJpZXMKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNJbmZvRW1wdHkiOiAiTm8gZW50cmllcyB0byBzaG93IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNJbmZvRW1wdHkiOiAiU2hvd2luZyAwIHRvIDAgb2YgMCBlbnRyaWVzIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFdoZW4gYSB1c2VyIGZpbHRlcnMgdGhlIGluZm9ybWF0aW9uIGluIGEgdGFibGUsIHRoaXMgc3RyaW5nIGlzIGFwcGVuZGVkIAoJCQkgKiB0byB0aGUgaW5mb3JtYXRpb24gKHNJbmZvKSB0byBnaXZlIGFuIGlkZWEgb2YgaG93IHN0cm9uZyB0aGUgZmlsdGVyaW5nIAoJCQkgKiBpcy4gVGhlIHZhcmlhYmxlIF9NQVhfIGlzIGR5bmFtaWNhbGx5IHVwZGF0ZWQuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IChmaWx0ZXJlZCBmcm9tIF9NQVhfIHRvdGFsIGVudHJpZXMpCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0ZpbHRlcmVkIjogIiAtIGZpbHRlcmluZyBmcm9tIF9NQVhfIHJlY29yZHMiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9GaWx0ZXJlZCI6ICIoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBJZiBjYW4gYmUgdXNlZnVsIHRvIGFwcGVuZCBleHRyYSBpbmZvcm1hdGlvbiB0byB0aGUgaW5mbyBzdHJpbmcgYXQgdGltZXMsCgkJCSAqIGFuZCB0aGlzIHZhcmlhYmxlIGRvZXMgZXhhY3RseSB0aGF0LiBUaGlzIGluZm9ybWF0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8KCQkJICogdGhlIHNJbmZvIChzSW5mb0VtcHR5IGFuZCBzSW5mb0ZpbHRlcmVkIGluIHdoYXRldmVyIGNvbWJpbmF0aW9uIHRoZXkgYXJlCgkJCSAqIGJlaW5nIHVzZWQpIGF0IGFsbCB0aW1lcy4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0luZm9Qb3N0Rml4IjogIkFsbCByZWNvcmRzIHNob3duIGFyZSBkZXJpdmVkIGZyb20gcmVhbCBpbmZvcm1hdGlvbi4iCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9Qb3N0Rml4IjogIiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEYXRhVGFibGVzIGhhcyBhIGJ1aWxkIGluIG51bWJlciBmb3JtYXR0ZXIgKGZuRm9ybWF0TnVtYmVyKSB3aGljaCBpcyB1c2VkCgkJCSAqIHRvIGZvcm1hdCBsYXJnZSBudW1iZXJzIHRoYXQgYXJlIHVzZWQgaW4gdGhlIHRhYmxlIGluZm9ybWF0aW9uLiBCeQoJCQkgKiBkZWZhdWx0IGEgY29tbWEgaXMgdXNlZCwgYnV0IHRoaXMgY2FuIGJlIHRyaXZpYWxseSBjaGFuZ2VkIHRvIGFueQoJCQkgKiBjaGFyYWN0ZXIgeW91IHdpc2ggd2l0aCB0aGlzIHBhcmFtZXRlci4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgLAoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0luZm9UaG91c2FuZHMiOiAiJyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb1Rob3VzYW5kcyI6ICIsIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERldGFpbCB0aGUgYWN0aW9uIHRoYXQgd2lsbCBiZSB0YWtlbiB3aGVuIHRoZSBkcm9wIGRvd24gbWVudSBmb3IgdGhlCgkJCSAqIHBhZ2luYXRpb24gbGVuZ3RoIG9wdGlvbiBpcyBjaGFuZ2VkLiBUaGUgJ19NRU5VXycgdmFyaWFibGUgaXMgcmVwbGFjZWQKCQkJICogd2l0aCBhIGRlZmF1bHQgc2VsZWN0IGxpc3Qgb2YgMTAsIDI1LCA1MCBhbmQgMTAwLCBhbmQgY2FuIGJlIHJlcGxhY2VkCgkJCSAqIHdpdGggYSBjdXN0b20gc2VsZWN0IGJveCBpZiByZXF1aXJlZC4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2hvdyBfTUVOVV8gZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgLy8gTGFuZ3VhZ2UgY2hhbmdlIG9ubHkKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0xlbmd0aE1lbnUiOiAiRGlzcGxheSBfTUVOVV8gcmVjb3JkcyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBMYW5ndWFnZSBhbmQgb3B0aW9ucyBjaGFuZ2UKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0xlbmd0aE1lbnUiOiAnRGlzcGxheSA8c2VsZWN0PicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjEwIj4xMDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjIwIj4yMDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjMwIj4zMDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjQwIj40MDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjUwIj41MDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9Ii0xIj5BbGw8L29wdGlvbj4nKwoJCQkgKiAgICAgICAgICAgICc8L3NlbGVjdD4gcmVjb3JkcycKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzTGVuZ3RoTWVudSI6ICJTaG93IF9NRU5VXyBlbnRyaWVzIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFdoZW4gdXNpbmcgQWpheCBzb3VyY2VkIGRhdGEgYW5kIGR1cmluZyB0aGUgZmlyc3QgZHJhdyB3aGVuIERhdGFUYWJsZXMgaXMKCQkJICogZ2F0aGVyaW5nIHRoZSBkYXRhLCB0aGlzIG1lc3NhZ2UgaXMgc2hvd24gaW4gYW4gZW1wdHkgcm93IGluIHRoZSB0YWJsZSB0bwoJCQkgKiBpbmRpY2F0ZSB0byB0aGUgZW5kIHVzZXIgdGhlIHRoZSBkYXRhIGlzIGJlaW5nIGxvYWRlZC4gTm90ZSB0aGF0IHRoaXMKCQkJICogcGFyYW1ldGVyIGlzIG5vdCB1c2VkIHdoZW4gbG9hZGluZyBkYXRhIGJ5IHNlcnZlci1zaWRlIHByb2Nlc3NpbmcsIGp1c3QKCQkJICogQWpheCBzb3VyY2VkIGRhdGEgd2l0aCBjbGllbnQtc2lkZSBwcm9jZXNzaW5nLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBMb2FkaW5nLi4uCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTG9hZGluZ1JlY29yZHMiOiAiUGxlYXNlIHdhaXQgLSBsb2FkaW5nLi4uIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNMb2FkaW5nUmVjb3JkcyI6ICJMb2FkaW5nLi4uIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFRleHQgd2hpY2ggaXMgZGlzcGxheWVkIHdoZW4gdGhlIHRhYmxlIGlzIHByb2Nlc3NpbmcgYSB1c2VyIGFjdGlvbgoJCQkgKiAodXN1YWxseSBhIHNvcnQgY29tbWFuZCBvciBzaW1pbGFyKS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgUHJvY2Vzc2luZy4uLgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic1Byb2Nlc3NpbmciOiAiRGF0YVRhYmxlcyBpcyBjdXJyZW50bHkgYnVzeSIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzUHJvY2Vzc2luZyI6ICJQcm9jZXNzaW5nLi4uIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERldGFpbHMgdGhlIGFjdGlvbnMgdGhhdCB3aWxsIGJlIHRha2VuIHdoZW4gdGhlIHVzZXIgdHlwZXMgaW50byB0aGUKCQkJICogZmlsdGVyaW5nIGlucHV0IHRleHQgYm94LiBUaGUgdmFyaWFibGUgIl9JTlBVVF8iLCBpZiB1c2VkIGluIHRoZSBzdHJpbmcsCgkJCSAqIGlzIHJlcGxhY2VkIHdpdGggdGhlIEhUTUwgdGV4dCBib3ggZm9yIHRoZSBmaWx0ZXJpbmcgaW5wdXQgYWxsb3dpbmcKCQkJICogY29udHJvbCBvdmVyIHdoZXJlIGl0IGFwcGVhcnMgaW4gdGhlIHN0cmluZy4gSWYgIl9JTlBVVF8iIGlzIG5vdCBnaXZlbgoJCQkgKiB0aGVuIHRoZSBpbnB1dCBib3ggaXMgYXBwZW5kZWQgdG8gdGhlIHN0cmluZyBhdXRvbWF0aWNhbGx5LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBTZWFyY2g6CgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBJbnB1dCB0ZXh0IGJveCB3aWxsIGJlIGFwcGVuZGVkIGF0IHRoZSBlbmQgYXV0b21hdGljYWxseQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzU2VhcmNoIjogIkZpbHRlciByZWNvcmRzOiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBTcGVjaWZ5IHdoZXJlIHRoZSBmaWx0ZXIgc2hvdWxkIGFwcGVhcgoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzU2VhcmNoIjogIkFwcGx5IGZpbHRlciBfSU5QVVRfIHRvIHRhYmxlIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNTZWFyY2giOiAiU2VhcmNoOiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBBbGwgb2YgdGhlIGxhbmd1YWdlIGluZm9ybWF0aW9uIGNhbiBiZSBzdG9yZWQgaW4gYSBmaWxlIG9uIHRoZQoJCQkgKiBzZXJ2ZXItc2lkZSwgd2hpY2ggRGF0YVRhYmxlcyB3aWxsIGxvb2sgdXAgaWYgdGhpcyBwYXJhbWV0ZXIgaXMgcGFzc2VkLgoJCQkgKiBJdCBtdXN0IHN0b3JlIHRoZSBVUkwgb2YgdGhlIGxhbmd1YWdlIGZpbGUsIHdoaWNoIGlzIGluIGEgSlNPTiBmb3JtYXQsCgkJCSAqIGFuZCB0aGUgb2JqZWN0IGhhcyB0aGUgc2FtZSBwcm9wZXJ0aWVzIGFzIHRoZSBvTGFuZ3VhZ2Ugb2JqZWN0IGluIHRoZQoJCQkgKiBpbml0aWFsaXNlciBvYmplY3QgKGkuZS4gdGhlIGFib3ZlIHBhcmFtZXRlcnMpLiBQbGVhc2UgcmVmZXIgdG8gb25lIG9mCgkJCSAqIHRoZSBleGFtcGxlIGxhbmd1YWdlIGZpbGVzIHRvIHNlZSBob3cgdGhpcyB3b3JrcyBpbiBhY3Rpb24uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzVXJsIjogImh0dHA6Ly93d3cuc3ByeW1lZGlhLmNvLnVrL2RhdGFUYWJsZXMvbGFuZy50eHQiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1VybCI6ICIiLAoJCQoJCQoJCQkvKioKCQkJICogVGV4dCBzaG93biBpbnNpZGUgdGhlIHRhYmxlIHJlY29yZHMgd2hlbiB0aGUgaXMgbm8gaW5mb3JtYXRpb24gdG8gYmUKCQkJICogZGlzcGxheWVkIGFmdGVyIGZpbHRlcmluZy4gc0VtcHR5VGFibGUgaXMgc2hvd24gd2hlbiB0aGVyZSBpcyBzaW1wbHkgbm8KCQkJICogaW5mb3JtYXRpb24gaW4gdGhlIHRhYmxlIGF0IGFsbCAocmVnYXJkbGVzcyBvZiBmaWx0ZXJpbmcpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBObyBtYXRjaGluZyByZWNvcmRzIGZvdW5kCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzWmVyb1JlY29yZHMiOiAiTm8gcmVjb3JkcyB0byBkaXNwbGF5IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNaZXJvUmVjb3JkcyI6ICJObyBtYXRjaGluZyByZWNvcmRzIGZvdW5kIgoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gaGF2ZSBkZWZpbmUgdGhlIGdsb2JhbCBmaWx0ZXJpbmcgc3RhdGUgYXQKCQkgKiBpbml0aWFsaXNhdGlvbiB0aW1lLiBBcyBhbiBvYmplY3QgdGhlICJzU2VhcmNoIiBwYXJhbWV0ZXIgbXVzdCBiZQoJCSAqIGRlZmluZWQsIGJ1dCBhbGwgb3RoZXIgcGFyYW1ldGVycyBhcmUgb3B0aW9uYWwuIFdoZW4gImJSZWdleCIgaXMgdHJ1ZSwKCQkgKiB0aGUgc2VhcmNoIHN0cmluZyB3aWxsIGJlIHRyZWF0ZWQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24sIHdoZW4gZmFsc2UKCQkgKiAoZGVmYXVsdCkgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgc3RyYWlnaHQgc3RyaW5nLiBXaGVuICJiU21hcnQiCgkJICogRGF0YVRhYmxlcyB3aWxsIHVzZSBpdCdzIHNtYXJ0IGZpbHRlcmluZyBtZXRob2RzICh0byB3b3JkIG1hdGNoIGF0CgkJICogYW55IHBvaW50IGluIHRoZSBkYXRhKSwgd2hlbiBmYWxzZSB0aGlzIHdpbGwgbm90IGJlIGRvbmUuCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgIm9TZWFyY2giOiB7InNTZWFyY2giOiAiSW5pdGlhbCBzZWFyY2gifQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJvU2VhcmNoIjogJC5leHRlbmQoIHt9LCBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2ggKSwKCQoJCgkJLyoqCgkJICogQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9vayBmb3IgdGhlIHByb3BlcnR5ICdhYURhdGEnIHdoZW4gb2J0YWluaW5nCgkJICogZGF0YSBmcm9tIGFuIEFqYXggc291cmNlIG9yIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gdGhpcyBwYXJhbWV0ZXIKCQkgKiBhbGxvd3MgdGhhdCBwcm9wZXJ0eSB0byBiZSBjaGFuZ2VkLiBZb3UgY2FuIHVzZSBKYXZhc2NyaXB0IGRvdHRlZCBvYmplY3QKCQkgKiBub3RhdGlvbiB0byBnZXQgYSBkYXRhIHNvdXJjZSBmb3IgbXVsdGlwbGUgbGV2ZWxzIG9mIG5lc3RpbmcuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhYURhdGEKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogWy4uLl0gfQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kYXRhLnR4dCIsCgkJICogICAgICAgICJzQWpheERhdGFQcm9wIjogImRhdGEiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEdldCBkYXRhIGZyb20geyAiZGF0YSI6IHsgImlubmVyIjogWy4uLl0gfSB9CgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RhdGEudHh0IiwKCQkgKiAgICAgICAgInNBamF4RGF0YVByb3AiOiAiZGF0YS5pbm5lciIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNBamF4RGF0YVByb3AiOiAiYWFEYXRhIiwKCQoJCgkJLyoqCgkJICogWW91IGNhbiBpbnN0cnVjdCBEYXRhVGFibGVzIHRvIGxvYWQgZGF0YSBmcm9tIGFuIGV4dGVybmFsIHNvdXJjZSB1c2luZyB0aGlzCgkJICogcGFyYW1ldGVyICh1c2UgYURhdGEgaWYgeW91IHdhbnQgdG8gcGFzcyBkYXRhIGluIHlvdSBhbHJlYWR5IGhhdmUpLiBTaW1wbHkKCQkgKiBwcm92aWRlIGEgdXJsIGEgSlNPTiBvYmplY3QgY2FuIGJlIG9idGFpbmVkIGZyb20uIFRoaXMgb2JqZWN0IG11c3QgaW5jbHVkZQoJCSAqIHRoZSBwYXJhbWV0ZXIgJ2FhRGF0YScgd2hpY2ggaXMgdGhlIGRhdGEgc291cmNlIGZvciB0aGUgdGFibGUuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogIEBkdG9wdCBTZXJ2ZXItc2lkZQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJodHRwOi8vd3d3LnNwcnltZWRpYS5jby51ay9kYXRhVGFibGVzL2pzb24ucGhwIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJzQWpheFNvdXJjZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGNhbiBiZSB1c2VkIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHByZWZpeCB0aGF0IERhdGFUYWJsZXMKCQkgKiBhc3NpZ25zIHRvIGEgY29va2llIHdoZW4gc3RhdGUgc2F2aW5nIGlzIGVuYWJsZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBTcHJ5TWVkaWFfRGF0YVRhYmxlc18KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0Nvb2tpZVByZWZpeCI6ICJteV9kYXRhdGFibGVfIiwKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb29raWVQcmVmaXgiOiAiU3ByeU1lZGlhX0RhdGFUYWJsZXNfIiwKCQoJCgkJLyoqCgkJICogVGhpcyBpbml0aWFsaXNhdGlvbiB2YXJpYWJsZSBhbGxvd3MgeW91IHRvIHNwZWNpZnkgZXhhY3RseSB3aGVyZSBpbiB0aGUKCQkgKiBET00geW91IHdhbnQgRGF0YVRhYmxlcyB0byBpbmplY3QgdGhlIHZhcmlvdXMgY29udHJvbHMgaXQgYWRkcyB0byB0aGUgcGFnZQoJCSAqIChmb3IgZXhhbXBsZSB5b3UgbWlnaHQgd2FudCB0aGUgcGFnaW5hdGlvbiBjb250cm9scyBhdCB0aGUgdG9wIG9mIHRoZQoJCSAqIHRhYmxlKS4gRElWIGVsZW1lbnRzICh3aXRoIG9yIHdpdGhvdXQgYSBjdXN0b20gY2xhc3MpIGNhbiBhbHNvIGJlIGFkZGVkIHRvCgkJICogYWlkIHN0eWxpbmcuIFRoZSBmb2xsb3cgc3ludGF4IGlzIHVzZWQ6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5UaGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIGFsbG93ZWQ6CQoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nbCcgLSBMZW5ndGggY2hhbmdpbmc8L2xpCgkJICogICAgICAgICA8bGk+J2YnIC0gRmlsdGVyaW5nIGlucHV0PC9saT4KCQkgKiAgICAgICAgIDxsaT4ndCcgLSBUaGUgdGFibGUhPC9saT4KCQkgKiAgICAgICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3AnIC0gUGFnaW5hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3InIC0gcFJvY2Vzc2luZzwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgY29uc3RhbnRzIGFyZSBhbGxvd2VkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nSCcgLSBqUXVlcnlVSSB0aGVtZSAiaGVhZGVyIiBjbGFzc2VzICgnZmctdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci10bCB1aS1jb3JuZXItdHIgdWktaGVscGVyLWNsZWFyZml4Jyk8L2xpPgoJCSAqICAgICAgICAgPGxpPidGJyAtIGpRdWVyeVVJIHRoZW1lICJmb290ZXIiIGNsYXNzZXMgKCdmZy10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWJsIHVpLWNvcm5lci1iciB1aS1oZWxwZXItY2xlYXJmaXgnKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgc3ludGF4IGlzIGV4cGVjdGVkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OycgYW5kICcmZ3Q7JyAtIGRpdiBlbGVtZW50czwvbGk+CgkJICogICAgICAgICA8bGk+JyZsdDsiY2xhc3MiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhIGNsYXNzPC9saT4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyIjaWQiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhbiBJRDwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPkV4YW1wbGVzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyJ3cmFwcGVyImZsaXB0Jmd0Oyc8L2xpPgoJCSAqICAgICAgICAgPGxpPicmbHQ7bGYmbHQ7dCZndDtpcCZndDsnPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGxmcnRpcCA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgZmFsc2UpPC9pPiA8Yj5vcjwvYj4gCgkJICogICAgPCJIImxmcj50PCJGImlwPiA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgdHJ1ZSk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNEb20iOiAnJmx0OyJ0b3AiaSZndDtydCZsdDsiYm90dG9tImZscCZndDsmbHQ7ImNsZWFyIiZndDsnCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzRG9tIjogImxmcnRpcCIsCgkKCQoJCS8qKgoJCSAqIERhdGFUYWJsZXMgZmVhdHVyZXMgdHdvIGRpZmZlcmVudCBidWlsdC1pbiBwYWdpbmF0aW9uIGludGVyYWN0aW9uIG1ldGhvZHMKCQkgKiAoJ3R3b19idXR0b24nIG9yICdmdWxsX251bWJlcnMnKSB3aGljaCBwcmVzZW50IGRpZmZlcmVudCBwYWdlIGNvbnRyb2xzIHRvCgkJICogdGhlIGVuZCB1c2VyLiBGdXJ0aGVyIG1ldGhvZHMgY2FuIGJlIGFkZGVkIHVzaW5nIHRoZSBBUEkgKHNlZSBiZWxvdykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCB0d29fYnV0dG9uCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNQYWdpbmF0aW9uVHlwZSI6ICJmdWxsX251bWJlcnMiCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJInNQYWdpbmF0aW9uVHlwZSI6ICJ0d29fYnV0dG9uIiwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGhvcml6b250YWwgc2Nyb2xsaW5nLiBXaGVuIGEgdGFibGUgaXMgdG9vIHdpZGUgdG8gZml0IGludG8gYSBjZXJ0YWluCgkJICogbGF5b3V0LCBvciB5b3UgaGF2ZSBhIGxhcmdlIG51bWJlciBvZiBjb2x1bW5zIGluIHRoZSB0YWJsZSwgeW91IGNhbiBlbmFibGUKCQkgKiB4LXNjcm9sbGluZyB0byBzaG93IHRoZSB0YWJsZSBpbiBhIHZpZXdwb3J0LCB3aGljaCBjYW4gYmUgc2Nyb2xsZWQuIFRoaXMKCQkgKiBwcm9wZXJ0eSBjYW4gYmUgYW55IENTUyB1bml0LCBvciBhIG51bWJlciAoaW4gd2hpY2ggY2FzZSBpdCB3aWxsIGJlIHRyZWF0ZWQKCQkgKiBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWCI6ICIxMDAlIiwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTY3JvbGxYIjogIiIsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcHJvcGVydHkgY2FuIGJlIHVzZWQgdG8gZm9yY2UgYSBEYXRhVGFibGUgdG8gdXNlIG1vcmUgd2lkdGggdGhhbiBpdAoJCSAqIG1pZ2h0IG90aGVyd2lzZSBkbyB3aGVuIHgtc2Nyb2xsaW5nIGlzIGVuYWJsZWQuIEZvciBleGFtcGxlIGlmIHlvdSBoYXZlIGEKCQkgKiB0YWJsZSB3aGljaCByZXF1aXJlcyB0byBiZSB3ZWxsIHNwYWNlZCwgdGhpcyBwYXJhbWV0ZXIgaXMgdXNlZnVsIGZvcgoJCSAqICJvdmVyLXNpemluZyIgdGhlIHRhYmxlLCBhbmQgdGh1cyBmb3JjaW5nIHNjcm9sbGluZy4gVGhpcyBwcm9wZXJ0eSBjYW4gYnkKCQkgKiBhbnkgQ1NTIHVuaXQsIG9yIGEgbnVtYmVyIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHBpeGVsCgkJICogbWVhc3VyZW1lbnQpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+Ymxhbmsgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFgiOiAiMTAwJSIsCgkJICogICAgICAgICJzU2Nyb2xsWElubmVyIjogIjExMCUiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWElubmVyIjogIiIsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSB2ZXJ0aWNhbCBzY3JvbGxpbmcuIFZlcnRpY2FsIHNjcm9sbGluZyB3aWxsIGNvbnN0cmFpbiB0aGUgRGF0YVRhYmxlCgkJICogdG8gdGhlIGdpdmVuIGhlaWdodCwgYW5kIGVuYWJsZSBzY3JvbGxpbmcgZm9yIGFueSBkYXRhIHdoaWNoIG92ZXJmbG93cyB0aGUKCQkgKiBjdXJyZW50IHZpZXdwb3J0LiBUaGlzIGNhbiBiZSB1c2VkIGFzIGFuIGFsdGVybmF0aXZlIHRvIHBhZ2luZyB0byBkaXNwbGF5CgkJICogYSBsb3Qgb2YgZGF0YSBpbiBhIHNtYWxsIGFyZWEgKGFsdGhvdWdoIHBhZ2luZyBhbmQgc2Nyb2xsaW5nIGNhbiBib3RoIGJlCgkJICogZW5hYmxlZCBhdCB0aGUgc2FtZSB0aW1lKS4gVGhpcyBwcm9wZXJ0eSBjYW4gYmUgYW55IENTUyB1bml0LCBvciBhIG51bWJlcgoJCSAqIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1Njcm9sbFkiOiAiIiwKCQoJCgkJLyoqCgkJICogU2V0IHRoZSBIVFRQIG1ldGhvZCB0aGF0IGlzIHVzZWQgdG8gbWFrZSB0aGUgQWpheCBjYWxsIGZvciBzZXJ2ZXItc2lkZQoJCSAqIHByb2Nlc3Npbmcgb3IgQWpheCBzb3VyY2VkIGRhdGEuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBHRVQKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNjcmlwdHMvcG9zdC5waHAiLAoJCSAqICAgICAgICAic1NlcnZlck1ldGhvZCI6ICJQT1NUIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1NlcnZlck1ldGhvZCI6ICJHRVQiCgl9OwoJCgkKCQoJLyoqCgkgKiBDb2x1bW4gb3B0aW9ucyB0aGF0IGNhbiBiZSBnaXZlbiB0byBEYXRhVGFibGVzIGF0IGluaXRpYWxpc2F0aW9uIHRpbWUuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1ucyA9IHsKCQkvKioKCQkgKiBBbGxvd3MgYSBjb2x1bW4ncyBzb3J0aW5nIHRvIHRha2UgbXVsdGlwbGUgY29sdW1ucyBpbnRvIGFjY291bnQgd2hlbiAKCQkgKiBkb2luZyBhIHNvcnQuIEZvciBleGFtcGxlIGZpcnN0IG5hbWUgLyBsYXN0IG5hbWUgY29sdW1ucyBtYWtlIHNlbnNlIHRvIAoJCSAqIGRvIGEgbXVsdGktY29sdW1uIHNvcnQgb3ZlciB0aGUgdHdvIGNvbHVtbnMuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwgPGk+VGFrZXMgdGhlIHZhbHVlIG9mIHRoZSBjb2x1bW4gaW5kZXggYXV0b21hdGljYWxseTwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdLCAiYVRhcmdldHMiOiBbIDAgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMSwgMCBdLCAiYVRhcmdldHMiOiBbIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMiwgMywgNCBdLCAiYVRhcmdldHMiOiBbIDIgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICB7ICJhRGF0YVNvcnQiOiBbIDAsIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMSwgMCBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAyLCAzLCA0IF0gfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYURhdGFTb3J0IjogbnVsbCwKCQoJCgkJLyoqCgkJICogWW91IGNhbiBjb250cm9sIHRoZSBkZWZhdWx0IHNvcnRpbmcgZGlyZWN0aW9uLCBhbmQgZXZlbiBhbHRlciB0aGUgYmVoYXZpb3VyCgkJICogb2YgdGhlIHNvcnQgaGFuZGxlciAoaS5lLiBvbmx5IGFsbG93IGFzY2VuZGluZyBzb3J0aW5nIGV0YykgdXNpbmcgdGhpcwoJCSAqIHBhcmFtZXRlci4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgWyAnYXNjJywgJ2Rlc2MnIF0KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImFzYyIgXSwgImFUYXJnZXRzIjogWyAxIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiwgImFzYyIsICJhc2MiIF0sICJhVGFyZ2V0cyI6IFsgMiBdIH0sCgkJICogICAgICAgICAgeyAiYXNTb3J0aW5nIjogWyAiZGVzYyIgXSwgImFUYXJnZXRzIjogWyAzIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiwgImFzYyIsICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiBdIH0sCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhc1NvcnRpbmciOiBbICdhc2MnLCAnZGVzYycgXSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9uIHRoZSBkYXRhIGluIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJiU2VhcmNoYWJsZSI6IGZhbHNlLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJiU2VhcmNoYWJsZSI6IGZhbHNlIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTZWFyY2hhYmxlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgc29ydGluZyBvbiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTb3J0YWJsZSI6IGZhbHNlIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTb3J0YWJsZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIDxjb2RlPkRlcHJlY2F0ZWQ8L2NvZGU+IFdoZW4gdXNpbmcgZm5SZW5kZXIoKSBmb3IgYSBjb2x1bW4sIHlvdSBtYXkgd2lzaCAKCQkgKiB0byB1c2UgdGhlIG9yaWdpbmFsIGRhdGEgKGJlZm9yZSByZW5kZXJpbmcpIGZvciBzb3J0aW5nIGFuZCBmaWx0ZXJpbmcgCgkJICogKHRoZSBkZWZhdWx0IGlzIHRvIHVzZWQgdGhlIHJlbmRlcmVkIGRhdGEgdGhhdCB0aGUgdXNlciBjYW4gc2VlKS4gVGhpcyAKCQkgKiBtYXkgYmUgdXNlZnVsIGZvciBkYXRlcyBldGMuCgkJICogCgkJICogUGxlYXNlIG5vdGUgdGhhdCB0aGlzIG9wdGlvbiBoYXMgbm93IGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkCgkJICogaW4gdGhlIG5leHQgdmVyc2lvbiBvZiBEYXRhVGFibGVzLiBQbGVhc2UgdXNlIG1SZW5kZXIgLyBtRGF0YSByYXRoZXIgdGhhbgoJCSAqIGZuUmVuZGVyLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJWaXNpYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJWaXNpYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlZpc2libGUiOiB0cnVlLAoJCQoJCQoJCS8qKgoJCSAqIERldmVsb3BlciBkZWZpbmFibGUgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbmV2ZXIgYSBjZWxsIGlzIGNyZWF0ZWQgKEFqYXggc291cmNlLAoJCSAqIGV0Yykgb3IgcHJvY2Vzc2VkIGZvciBpbnB1dCAoRE9NIHNvdXJjZSkuIFRoaXMgY2FuIGJlIHVzZWQgYXMgYSBjb21wbGltZW50IHRvIG1SZW5kZXIKCQkgKiBhbGxvd2luZyB5b3UgdG8gbW9kaWZ5IHRoZSBET00gZWxlbWVudCAoYWRkIGJhY2tncm91bmQgY29sb3VyIGZvciBleGFtcGxlKSB3aGVuIHRoZQoJCSAqIGVsZW1lbnQgaXMgYXZhaWxhYmxlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge2VsZW1lbnR9IG5UZCBUaGUgVEQgbm9kZSB0aGF0IGhhcyBiZWVuIGNyZWF0ZWQKCQkgKiAgQHBhcmFtIHsqfSBzRGF0YSBUaGUgRGF0YSBmb3IgdGhlIGNlbGwKCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGZvciB0aGUgd2hvbGUgcm93CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFRoZSByb3cgaW5kZXggZm9yIHRoZSBhb0RhdGEgZGF0YSBzdG9yZQoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBUaGUgY29sdW1uIGluZGV4IGZvciBhb0NvbHVtbnMKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWzNdLAoJCSAqICAgICAgICAgICJmbkNyZWF0ZWRDZWxsIjogZnVuY3Rpb24gKG5UZCwgc0RhdGEsIG9EYXRhLCBpUm93LCBpQ29sKSB7CgkJICogICAgICAgICAgICBpZiAoIHNEYXRhID09ICIxLjciICkgewoJCSAqICAgICAgICAgICAgICAkKG5UZCkuY3NzKCdjb2xvcicsICdibHVlJykKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0gXQoJCSAqICAgICAgfSk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNyZWF0ZWRDZWxsIjogbnVsbCwKCQoJCgkJLyoqCgkJICogPGNvZGU+RGVwcmVjYXRlZDwvY29kZT4gQ3VzdG9tIGRpc3BsYXkgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCBmb3IgdGhlIAoJCSAqIGRpc3BsYXkgb2YgZWFjaCBjZWxsIGluIHRoaXMgY29sdW1uLgoJCSAqCgkJICogUGxlYXNlIG5vdGUgdGhhdCB0aGlzIG9wdGlvbiBoYXMgbm93IGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkCgkJICogaW4gdGhlIG5leHQgdmVyc2lvbiBvZiBEYXRhVGFibGVzLiBQbGVhc2UgdXNlIG1SZW5kZXIgLyBtRGF0YSByYXRoZXIgdGhhbgoJCSAqIGZuUmVuZGVyLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBPYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhUm93IFRoZSByb3cgaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhQ29sdW1uIFRoZSBjb2x1bW4gaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gIG8uYURhdGEgVGhlIGRhdGEgZm9yIHRoZSByb3cgaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8ub1NldHRpbmdzIFRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgRGF0YVRhYmxlcyBpbnN0YW5jZQoJCSAqICBAcGFyYW0ge29iamVjdH0gby5tRGF0YVByb3AgVGhlIGRhdGEgcHJvcGVydHkgdXNlZCBmb3IgdGhpcyBjb2x1bW4KCQkgKiAgQHBhcmFtIHsqfSAgICAgIHZhbCBUaGUgY3VycmVudCBjZWxsIHZhbHVlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqICBAZGVwcmVjYXRlZAoJCSAqLwoJCSJmblJlbmRlciI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSBjb2x1bW4gaW5kZXggKHN0YXJ0aW5nIGZyb20gMCEpIHRoYXQgeW91IHdpc2ggYSBzb3J0IHRvIGJlIHBlcmZvcm1lZAoJCSAqIHVwb24gd2hlbiB0aGlzIGNvbHVtbiBpcyBzZWxlY3RlZCBmb3Igc29ydGluZy4gVGhpcyBjYW4gYmUgdXNlZCBmb3Igc29ydGluZwoJCSAqIG9uIGhpZGRlbiBjb2x1bW5zIGZvciBleGFtcGxlLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgLTEgPGk+VXNlIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZCBjb2x1bW4gaW5kZXg8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiaURhdGFTb3J0IjogMSwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImlEYXRhU29ydCI6IDEgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlEYXRhU29ydCI6IC0xLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBoYXMgYmVlbiByZXBsYWNlZCBieSBtRGF0YSBpbiBEYXRhVGFibGVzIHRvIGVuc3VyZSBuYW1pbmcKCQkgKiBjb25zaXN0ZW5jeS4gbURhdGFQcm9wIGNhbiBzdGlsbCBiZSB1c2VkLCBhcyB0aGVyZSBpcyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQoJCSAqIGluIERhdGFUYWJsZXMgZm9yIHRoaXMgb3B0aW9uLCBidXQgaXQgaXMgc3Ryb25nbHkgcmVjb21tZW5kZWQgdGhhdCB5b3UgdXNlCgkJICogbURhdGEgaW4gcHJlZmVyZW5jZSB0byBtRGF0YVByb3AuCgkJICogIEBuYW1lIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zLm1EYXRhUHJvcAoJCSAqLwoJCgkKCQkvKioKCQkgKiBUaGlzIHByb3BlcnR5IGNhbiBiZSB1c2VkIHRvIHJlYWQgZGF0YSBmcm9tIGFueSBKU09OIGRhdGEgc291cmNlIHByb3BlcnR5LAoJCSAqIGluY2x1ZGluZyBkZWVwbHkgbmVzdGVkIG9iamVjdHMgLyBwcm9wZXJ0aWVzLiBtRGF0YSBjYW4gYmUgZ2l2ZW4gaW4gYQoJCSAqIG51bWJlciBvZiBkaWZmZXJlbnQgd2F5cyB3aGljaCBlZmZlY3QgaXRzIGJlaGF2aW91cjoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmludGVnZXIgLSB0cmVhdGVkIGFzIGFuIGFycmF5IGluZGV4IGZvciB0aGUgZGF0YSBzb3VyY2UuIFRoaXMgaXMgdGhlCgkJICogICAgICAgZGVmYXVsdCB0aGF0IERhdGFUYWJsZXMgdXNlcyAoaW5jcmVtZW50YWxseSBpbmNyZWFzZWQgZm9yIGVhY2ggY29sdW1uKS48L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nIC0gcmVhZCBhbiBvYmplY3QgcHJvcGVydHkgZnJvbSB0aGUgZGF0YSBzb3VyY2UuIE5vdGUgdGhhdCB5b3UgY2FuCgkJICogICAgICAgdXNlIEphdmFzY3JpcHQgZG90dGVkIG5vdGF0aW9uIHRvIHJlYWQgZGVlcCBwcm9wZXJ0aWVzIC8gYXJyYXlzIGZyb20gdGhlCgkJICogICAgICAgZGF0YSBzb3VyY2UuPC9saT4KCQkgKiAgICAgPGxpPm51bGwgLSB0aGUgc0RlZmF1bHRDb250ZW50IG9wdGlvbiB3aWxsIGJlIHVzZWQgZm9yIHRoZSBjZWxsIChudWxsCgkJICogICAgICAgYnkgZGVmYXVsdCwgc28geW91IHdpbGwgbmVlZCB0byBzcGVjaWZ5IHRoZSBkZWZhdWx0IGNvbnRlbnQgeW91IHdhbnQgLQoJCSAqICAgICAgIHR5cGljYWxseSBhbiBlbXB0eSBzdHJpbmcpLiBUaGlzIGNhbiBiZSB1c2VmdWwgb24gZ2VuZXJhdGVkIGNvbHVtbnMgc3VjaCAKCQkgKiAgICAgICBhcyBlZGl0IC8gZGVsZXRlIGFjdGlvbiBjb2x1bW5zLjwvbGk+CgkJICogICAgIDxsaT5mdW5jdGlvbiAtIHRoZSBmdW5jdGlvbiBnaXZlbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW5ldmVyIERhdGFUYWJsZXMgCgkJICogICAgICAgbmVlZHMgdG8gc2V0IG9yIGdldCB0aGUgZGF0YSBmb3IgYSBjZWxsIGluIHRoZSBjb2x1bW4uIFRoZSBmdW5jdGlvbiAKCQkgKiAgICAgICB0YWtlcyB0aHJlZSBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSByb3c8L2xpPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd9IFRoZSB0eXBlIGNhbGwgZGF0YSByZXF1ZXN0ZWQgLSB0aGlzIHdpbGwgYmUgJ3NldCcgd2hlbgoJCSAqICAgICAgICAgICBzZXR0aW5nIGRhdGEgb3IgJ2ZpbHRlcicsICdkaXNwbGF5JywgJ3R5cGUnLCAnc29ydCcgb3IgdW5kZWZpbmVkIHdoZW4gCgkJICogICAgICAgICAgIGdhdGhlcmluZyBkYXRhLiBOb3RlIHRoYXQgd2hlbiA8aT51bmRlZmluZWQ8L2k+IGlzIGdpdmVuIGZvciB0aGUgdHlwZQoJCSAqICAgICAgICAgICBEYXRhVGFibGVzIGV4cGVjdHMgdG8gZ2V0IHRoZSByYXcgZGF0YSBmb3IgdGhlIG9iamVjdCBiYWNrPC9saT4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSB0byBzZXQgd2hlbiB0aGUgc2Vjb25kIHBhcmFtZXRlciBpcyAnc2V0Jy48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgICAgVGhlIHJldHVybiB2YWx1ZSBmcm9tIHRoZSBmdW5jdGlvbiBpcyBub3QgcmVxdWlyZWQgd2hlbiAnc2V0JyBpcyB0aGUgdHlwZQoJCSAqICAgICAgIG9mIGNhbGwsIGJ1dCBvdGhlcndpc2UgdGhlIHJldHVybiBpcyB3aGF0IHdpbGwgYmUgdXNlZCBmb3IgdGhlIGRhdGEKCQkgKiAgICAgICByZXF1ZXN0ZWQuPC9saT4KCQkgKiAgICA8L3VsPgoJCSAqCgkJICogTm90ZSB0aGF0IHByaW9yIHRvIERhdGFUYWJsZXMgMS45LjIgbURhdGEgd2FzIGNhbGxlZCBtRGF0YVByb3AuIFRoZSBuYW1lIGNoYW5nZQoJCSAqIHJlZmxlY3RzIHRoZSBmbGV4aWJpbGl0eSBvZiB0aGlzIHByb3BlcnR5IGFuZCBpcyBjb25zaXN0ZW50IHdpdGggdGhlIG5hbWluZyBvZgoJCSAqIG1SZW5kZXIuIElmICdtRGF0YVByb3AnIGlzIGdpdmVuLCB0aGVuIGl0IHdpbGwgc3RpbGwgYmUgdXNlZCBieSBEYXRhVGFibGVzLCBhcwoJCSAqIGl0IGF1dG9tYXRpY2FsbHkgbWFwcyB0aGUgb2xkIG5hbWUgdG8gdGhlIG5ldyBpZiByZXF1aXJlZC4KCQkgKiAgQHR5cGUgc3RyaW5nfGludHxmdW5jdGlvbnxudWxsCgkJICogIEBkZWZhdWx0IG51bGwgPGk+VXNlIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZCBjb2x1bW4gaW5kZXg8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUmVhZCB0YWJsZSBkYXRhIGZyb20gb2JqZWN0cwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kZWVwLnR4dCIsCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAibURhdGEiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgIm1EYXRhIjogImJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAibURhdGEiOiAicGxhdGZvcm0uaW5uZXIiIH0sCgkJICogICAgICAgICAgeyAibURhdGEiOiAicGxhdGZvcm0uZGV0YWlscy4wIiB9LAoJCSAqICAgICAgICAgIHsgIm1EYXRhIjogInBsYXRmb3JtLmRldGFpbHMuMSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIG1EYXRhIGFzIGEgZnVuY3Rpb24gdG8gcHJvdmlkZSBkaWZmZXJlbnQgaW5mb3JtYXRpb24gZm9yCgkJICogICAgLy8gc29ydGluZywgZmlsdGVyaW5nIGFuZCBkaXNwbGF5LiBJbiB0aGlzIGNhc2UsIGN1cnJlbmN5IChwcmljZSkKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdLAoJCSAqICAgICAgICAgICJtRGF0YSI6IGZ1bmN0aW9uICggc291cmNlLCB0eXBlLCB2YWwgKSB7CgkJICogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3NldCcpIHsKCQkgKiAgICAgICAgICAgICAgc291cmNlLnByaWNlID0gdmFsOwoJCSAqICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgY29tcHV0ZWQgZGlzbGF5IGFuZCBmaWx0ZXIgdmFsdWVzIGZvciBlZmZpY2llbmN5CgkJICogICAgICAgICAgICAgIHNvdXJjZS5wcmljZV9kaXNwbGF5ID0gdmFsPT0iIiA/ICIiIDogIiQiK251bWJlckZvcm1hdCh2YWwpOwoJCSAqICAgICAgICAgICAgICBzb3VyY2UucHJpY2VfZmlsdGVyICA9IHZhbD09IiIgPyAiIiA6ICIkIitudW1iZXJGb3JtYXQodmFsKSsiICIrdmFsOwoJCSAqICAgICAgICAgICAgICByZXR1cm47CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnZGlzcGxheScpIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZV9kaXNwbGF5OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2ZpbHRlcicpIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZV9maWx0ZXI7CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICAvLyAnc29ydCcsICd0eXBlJyBhbmQgdW5kZWZpbmVkIGFsbCBqdXN0IHVzZSB0aGUgaW50ZWdlcgoJCSAqICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0gXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkibURhdGEiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHByb3BlcnR5IGlzIHRoZSByZW5kZXJpbmcgcGFydG5lciB0byBtRGF0YSBhbmQgaXQgaXMgc3VnZ2VzdGVkIHRoYXQKCQkgKiB3aGVuIHlvdSB3YW50IHRvIG1hbmlwdWxhdGUgZGF0YSBmb3IgZGlzcGxheSAoaW5jbHVkaW5nIGZpbHRlcmluZywgc29ydGluZyBldGMpCgkJICogYnV0IG5vdCBhbHRlcmluZyB0aGUgdW5kZXJseWluZyBkYXRhIGZvciB0aGUgdGFibGUsIHVzZSB0aGlzIHByb3BlcnR5LiBtRGF0YQoJCSAqIGNhbiBhY3R1YWxseSBkbyBldmVyeXRoaW5nIHRoaXMgcHJvcGVydHkgY2FuIGFuZCBtb3JlLCBidXQgdGhpcyBwYXJhbWV0ZXIgaXMKCQkgKiBlYXNpZXIgdG8gdXNlIHNpbmNlIHRoZXJlIGlzIG5vICdzZXQnIG9wdGlvbi4gTGlrZSBtRGF0YSBpcyBjYW4gYmUgZ2l2ZW4KCQkgKiBpbiBhIG51bWJlciBvZiBkaWZmZXJlbnQgd2F5cyB0byBlZmZlY3QgaXRzIGJlaGF2aW91ciwgd2l0aCB0aGUgYWRkaXRpb24gb2YgCgkJICogc3VwcG9ydGluZyBhcnJheSBzeW50YXggZm9yIGVhc3kgb3V0cHV0dGluZyBvZiBhcnJheXMgKGluY2x1ZGluZyBhcnJheXMgb2YKCQkgKiBvYmplY3RzKToKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmludGVnZXIgLSB0cmVhdGVkIGFzIGFuIGFycmF5IGluZGV4IGZvciB0aGUgZGF0YSBzb3VyY2UuIFRoaXMgaXMgdGhlCgkJICogICAgICAgZGVmYXVsdCB0aGF0IERhdGFUYWJsZXMgdXNlcyAoaW5jcmVtZW50YWxseSBpbmNyZWFzZWQgZm9yIGVhY2ggY29sdW1uKS48L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nIC0gcmVhZCBhbiBvYmplY3QgcHJvcGVydHkgZnJvbSB0aGUgZGF0YSBzb3VyY2UuIE5vdGUgdGhhdCB5b3UgY2FuCgkJICogICAgICAgdXNlIEphdmFzY3JpcHQgZG90dGVkIG5vdGF0aW9uIHRvIHJlYWQgZGVlcCBwcm9wZXJ0aWVzIC8gYXJyYXlzIGZyb20gdGhlCgkJICogICAgICAgZGF0YSBzb3VyY2UgYW5kIGFsc28gYXJyYXkgYnJhY2tldHMgdG8gaW5kaWNhdGUgdGhhdCB0aGUgZGF0YSByZWFkZXIgc2hvdWxkCgkJICogICAgICAgbG9vcCBvdmVyIHRoZSBkYXRhIHNvdXJjZSBhcnJheS4gV2hlbiBjaGFyYWN0ZXJzIGFyZSBnaXZlbiBiZXR3ZWVuIHRoZSBhcnJheQoJCSAqICAgICAgIGJyYWNrZXRzLCB0aGVzZSBjaGFyYWN0ZXJzIGFyZSB1c2VkIHRvIGpvaW4gdGhlIGRhdGEgc291cmNlIGFycmF5IHRvZ2V0aGVyLgoJCSAqICAgICAgIEZvciBleGFtcGxlOiAiYWNjb3VudHNbLCBdLm5hbWUiIHdvdWxkIHJlc3VsdCBpbiBhIGNvbW1hIHNlcGFyYXRlZCBsaXN0IHdpdGgKCQkgKiAgICAgICB0aGUgJ25hbWUnIHZhbHVlIGZyb20gdGhlICdhY2NvdW50cycgYXJyYXkgb2Ygb2JqZWN0cy48L2xpPgoJCSAqICAgICA8bGk+ZnVuY3Rpb24gLSB0aGUgZnVuY3Rpb24gZ2l2ZW4gd2lsbCBiZSBleGVjdXRlZCB3aGVuZXZlciBEYXRhVGFibGVzIAoJCSAqICAgICAgIG5lZWRzIHRvIHNldCBvciBnZXQgdGhlIGRhdGEgZm9yIGEgY2VsbCBpbiB0aGUgY29sdW1uLiBUaGUgZnVuY3Rpb24gCgkJICogICAgICAgdGFrZXMgdGhyZWUgcGFyYW1ldGVyczoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2FycmF5fG9iamVjdH0gVGhlIGRhdGEgc291cmNlIGZvciB0aGUgcm93IChiYXNlZCBvbiBtRGF0YSk8L2xpPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd9IFRoZSB0eXBlIGNhbGwgZGF0YSByZXF1ZXN0ZWQgLSB0aGlzIHdpbGwgYmUgJ2ZpbHRlcicsICdkaXNwbGF5JywgCgkJICogICAgICAgICAgICd0eXBlJyBvciAnc29ydCcuPC9saT4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBUaGUgZnVsbCBkYXRhIHNvdXJjZSBmb3IgdGhlIHJvdyAobm90IGJhc2VkIG9uIG1EYXRhKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgICBUaGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uIGlzIHdoYXQgd2lsbCBiZSB1c2VkIGZvciB0aGUgZGF0YQoJCSAqICAgICAgIHJlcXVlc3RlZC48L2xpPgoJCSAqICAgIDwvdWw+CgkJICogIEB0eXBlIHN0cmluZ3xpbnR8ZnVuY3Rpb258bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsIDxpPlVzZSBtRGF0YTwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDcmVhdGUgYSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBmcm9tIGFuIGFycmF5IG9mIG9iamVjdHMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNvdXJjZXMvZGVlcC50eHQiLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgIm1EYXRhIjogImVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YSI6ICJicm93c2VyIiB9LAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YSI6ICJwbGF0Zm9ybSIsCgkJICogICAgICAgICAgICAibVJlbmRlciI6ICJbLCBdLm5hbWUiCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzZSBhcyBhIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGxpbmsgZnJvbSB0aGUgZGF0YSBzb3VyY2UKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsKCQkgKiAgICAgICAgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdLAoJCSAqICAgICAgICAgICJtRGF0YSI6ICJkb3dubG9hZF9saW5rIiwKCQkgKiAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uICggZGF0YSwgdHlwZSwgZnVsbCApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJytkYXRhKyciPkRvd25sb2FkPC9hPic7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJtUmVuZGVyIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2hhbmdlIHRoZSBjZWxsIHR5cGUgY3JlYXRlZCBmb3IgdGhlIGNvbHVtbiAtIGVpdGhlciBURCBjZWxscyBvciBUSCBjZWxscy4gVGhpcwoJCSAqIGNhbiBiZSB1c2VmdWwgYXMgVEggY2VsbHMgaGF2ZSBzZW1hbnRpYyBtZWFuaW5nIGluIHRoZSB0YWJsZSBib2R5LCBhbGxvd2luZyB0aGVtCgkJICogdG8gYWN0IGFzIGEgaGVhZGVyIGZvciBhIHJvdyAoeW91IG1heSB3aXNoIHRvIGFkZCBzY29wZT0ncm93JyB0byB0aGUgVEggZWxlbWVudHMpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgdGQKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBNYWtlIHRoZSBmaXJzdCBjb2x1bW4gdXNlIFRIIGNlbGxzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIHsKCQkgKiAgICAgICAgICAiYVRhcmdldHMiOiBbIDAgXSwKCQkgKiAgICAgICAgICAic0NlbGxUeXBlIjogInRoIgoJCSAqICAgICAgICB9IF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDZWxsVHlwZSI6ICJ0ZCIsCgkKCQoJCS8qKgoJCSAqIENsYXNzIHRvIGdpdmUgdG8gZWFjaCBjZWxsIGluIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNDbGFzcyI6ICJteV9jbGFzcyIsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQ2xhc3MiOiAiIiwKCQkKCQkvKioKCQkgKiBXaGVuIERhdGFUYWJsZXMgY2FsY3VsYXRlcyB0aGUgY29sdW1uIHdpZHRocyB0byBhc3NpZ24gdG8gZWFjaCBjb2x1bW4sCgkJICogaXQgZmluZHMgdGhlIGxvbmdlc3Qgc3RyaW5nIGluIGVhY2ggY29sdW1uIGFuZCB0aGVuIGNvbnN0cnVjdHMgYQoJCSAqIHRlbXBvcmFyeSB0YWJsZSBhbmQgcmVhZHMgdGhlIHdpZHRocyBmcm9tIHRoYXQuIFRoZSBwcm9ibGVtIHdpdGggdGhpcwoJCSAqIGlzIHRoYXQgIm1tbSIgaXMgbXVjaCB3aWRlciB0aGVuICJpaWlpIiwgYnV0IHRoZSBsYXR0ZXIgaXMgYSBsb25nZXIgCgkJICogc3RyaW5nIC0gdGh1cyB0aGUgY2FsY3VsYXRpb24gY2FuIGdvIHdyb25nIChkb2luZyBpdCBwcm9wZXJseSBhbmQgcHV0dGluZwoJCSAqIGl0IGludG8gYW4gRE9NIG9iamVjdCBhbmQgbWVhc3VyaW5nIHRoYXQgaXMgaG9ycmlibHkoISkgc2xvdykuIFRodXMgYXMKCQkgKiBhICJ3b3JrIGFyb3VuZCIgd2UgcHJvdmlkZSB0aGlzIG9wdGlvbi4gSXQgd2lsbCBhcHBlbmQgaXRzIHZhbHVlIHRvIHRoZQoJCSAqIHRleHQgdGhhdCBpcyBmb3VuZCB0byBiZSB0aGUgbG9uZ2VzdCBzdHJpbmcgZm9yIHRoZSBjb2x1bW4gLSBpLmUuIHBhZGRpbmcuCgkJICogR2VuZXJhbGx5IHlvdSBzaG91bGRuJ3QgbmVlZCB0aGlzLCBhbmQgaXQgaXMgbm90IGRvY3VtZW50ZWQgb24gdGhlIAoJCSAqIGdlbmVyYWwgRGF0YVRhYmxlcy5uZXQgZG9jdW1lbnRhdGlvbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPGk+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgInNDb250ZW50UGFkZGluZyI6ICJtbW0iCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQ29udGVudFBhZGRpbmciOiAiIiwKCQoJCgkJLyoqCgkJICogQWxsb3dzIGEgZGVmYXVsdCB2YWx1ZSB0byBiZSBnaXZlbiBmb3IgYSBjb2x1bW4ncyBkYXRhLCBhbmQgd2lsbCBiZSB1c2VkCgkJICogd2hlbmV2ZXIgYSBudWxsIGRhdGEgc291cmNlIGlzIGVuY291bnRlcmVkICh0aGlzIGNhbiBiZSBiZWNhdXNlIG1EYXRhCgkJICogaXMgc2V0IHRvIG51bGwsIG9yIGJlY2F1c2UgdGhlIGRhdGEgc291cmNlIGl0c2VsZiBpcyBudWxsKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAibURhdGEiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IiwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgLTEgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAibURhdGEiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IgoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0RlZmF1bHRDb250ZW50IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgaXMgb25seSB1c2VkIGluIERhdGFUYWJsZXMnIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIEl0IGNhbgoJCSAqIGJlIGV4Y2VwdGlvbmFsbHkgdXNlZnVsIHRvIGtub3cgd2hhdCBjb2x1bW5zIGFyZSBiZWluZyBkaXNwbGF5ZWQgb24gdGhlCgkJICogY2xpZW50IHNpZGUsIGFuZCB0byBtYXAgdGhlc2UgdG8gZGF0YWJhc2UgZmllbGRzLiBXaGVuIGRlZmluZWQsIHRoZSBuYW1lcwoJCSAqIGFsc28gYWxsb3cgRGF0YVRhYmxlcyB0byByZW9yZGVyIGluZm9ybWF0aW9uIGZyb20gdGhlIHNlcnZlciBpZiBpdCBjb21lcwoJCSAqIGJhY2sgaW4gYW4gdW5leHBlY3RlZCBvcmRlciAoaS5lLiBpZiB5b3Ugc3dpdGNoIHlvdXIgY29sdW1ucyBhcm91bmQgb24gdGhlCgkJICogY2xpZW50LXNpZGUsIHlvdXIgc2VydmVyLXNpZGUgY29kZSBkb2VzIG5vdCBhbHNvIG5lZWQgdXBkYXRpbmcpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImVuZ2luZSIsICJhVGFyZ2V0cyI6IFsgMCBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiYnJvd3NlciIsICJhVGFyZ2V0cyI6IFsgMSBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAicGxhdGZvcm0iLCAiYVRhcmdldHMiOiBbIDIgXSB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogInZlcnNpb24iLCAiYVRhcmdldHMiOiBbIDMgXSB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImdyYWRlIiwgImFUYXJnZXRzIjogWyA0IF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJicm93c2VyIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogInBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogInZlcnNpb24iIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZ3JhZGUiIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic05hbWUiOiAiIiwKCQoJCgkJLyoqCgkJICogRGVmaW5lcyBhIGRhdGEgc291cmNlIHR5cGUgZm9yIHRoZSBzb3J0aW5nIHdoaWNoIGNhbiBiZSB1c2VkIHRvIHJlYWQKCQkgKiByZWFsLXRpbWUgaW5mb3JtYXRpb24gZnJvbSB0aGUgdGFibGUgKHVwZGF0aW5nIHRoZSBpbnRlcm5hbGx5IGNhY2hlZAoJCSAqIHZlcnNpb24pIHByaW9yIHRvIHNvcnRpbmcuIFRoaXMgYWxsb3dzIHNvcnRpbmcgdG8gb2NjdXIgb24gdXNlciBlZGl0YWJsZQoJCSAqIGVsZW1lbnRzIHN1Y2ggYXMgZm9ybSBpbnB1dHMuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXRleHQiLCAiYVRhcmdldHMiOiBbIDIsIDMgXSB9LAoJCSAqICAgICAgICAgIHsgInNUeXBlIjogIm51bWVyaWMiLCAiYVRhcmdldHMiOiBbIDMgXSB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXNlbGVjdCIsICJhVGFyZ2V0cyI6IFsgNCBdIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tY2hlY2tib3giLCAiYVRhcmdldHMiOiBbIDUgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIgfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS10ZXh0IiwgInNUeXBlIjogIm51bWVyaWMiIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tc2VsZWN0IiB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLWNoZWNrYm94IiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTb3J0RGF0YVR5cGUiOiAic3RkIiwKCQoJCgkJLyoqCgkJICogVGhlIHRpdGxlIG9mIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5EZXJpdmVkIGZyb20gdGhlICdUSCcgdmFsdWUgZm9yIHRoaXMgY29sdW1uIGluIHRoZSAKCQkgKiAgICBvcmlnaW5hbCBIVE1MIHRhYmxlLjwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiTXkgY29sdW1uIHRpdGxlIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJNeSBjb2x1bW4gdGl0bGUiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzVGl0bGUiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGUgdHlwZSBhbGxvd3MgeW91IHRvIHNwZWNpZnkgaG93IHRoZSBkYXRhIGZvciB0aGlzIGNvbHVtbiB3aWxsIGJlIHNvcnRlZC4KCQkgKiBGb3VyIHR5cGVzIChzdHJpbmcsIG51bWVyaWMsIGRhdGUgYW5kIGh0bWwgKHdoaWNoIHdpbGwgc3RyaXAgSFRNTCB0YWdzCgkJICogYmVmb3JlIHNvcnRpbmcpKSBhcmUgY3VycmVudGx5IGF2YWlsYWJsZS4gTm90ZSB0aGF0IG9ubHkgZGF0ZSBmb3JtYXRzCgkJICogdW5kZXJzdG9vZCBieSBKYXZhc2NyaXB0J3MgRGF0ZSgpIG9iamVjdCB3aWxsIGJlIGFjY2VwdGVkIGFzIHR5cGUgZGF0ZS4gRm9yCgkJICogZXhhbXBsZTogIk1hciAyNiwgMjAwOCA1OjAzIFBNIi4gTWF5IHRha2UgdGhlIHZhbHVlczogJ3N0cmluZycsICdudW1lcmljJywKCQkgKiAnZGF0ZScgb3IgJ2h0bWwnIChieSBkZWZhdWx0KS4gRnVydGhlciB0eXBlcyBjYW4gYmUgYWRkaW5nIHRocm91Z2gKCQkgKiBwbHVnLWlucy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwgPGk+QXV0by1kZXRlY3RlZCBmcm9tIHJhdyBkYXRhPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNUeXBlIjogImh0bWwiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1R5cGUiOiAiaHRtbCIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUeXBlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRGVmaW5pbmcgdGhlIHdpZHRoIG9mIHRoZSBjb2x1bW4sIHRoaXMgcGFyYW1ldGVyIG1heSB0YWtlIGFueSBDU1MgdmFsdWUKCQkgKiAoM2VtLCAyMHB4IGV0YykuIERhdGFUYWJsZXMgYXBwbGVzICdzbWFydCcgd2lkdGhzIHRvIGNvbHVtbnMgd2hpY2ggaGF2ZSBub3QKCQkgKiBiZWVuIGdpdmVuIGEgc3BlY2lmaWMgd2lkdGggdGhyb3VnaCB0aGlzIGludGVyZmFjZSBlbnN1cmluZyB0aGF0IHRoZSB0YWJsZQoJCSAqIHJlbWFpbnMgcmVhZGFibGUuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsIDxpPkF1dG9tYXRpYzwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzV2lkdGgiOiAiMjAlIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNXaWR0aCI6ICIyMCUiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzV2lkdGgiOiBudWxsCgl9OwoJCgkKCQoJLyoqCgkgKiBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCAtIHRoaXMgaG9sZHMgYWxsIHRoZSBpbmZvcm1hdGlvbiBuZWVkZWQgZm9yIGEKCSAqIGdpdmVuIHRhYmxlLCBpbmNsdWRpbmcgY29uZmlndXJhdGlvbiwgZGF0YSBhbmQgY3VycmVudCBhcHBsaWNhdGlvbiBvZiB0aGUKCSAqIHRhYmxlIG9wdGlvbnMuIERhdGFUYWJsZXMgZG9lcyBub3QgaGF2ZSBhIHNpbmdsZSBpbnN0YW5jZSBmb3IgZWFjaCBEYXRhVGFibGUKCSAqIHdpdGggdGhlIHNldHRpbmdzIGF0dGFjaGVkIHRvIHRoYXQgaW5zdGFuY2UsIGJ1dCByYXRoZXIgaW5zdGFuY2VzIG9mIHRoZQoJICogRGF0YVRhYmxlICJjbGFzcyIgYXJlIGNyZWF0ZWQgb24tdGhlLWZseSBhcyBuZWVkZWQgKHR5cGljYWxseSBieSBhIAoJICogJCgpLmRhdGFUYWJsZSgpIGNhbGwpIGFuZCB0aGUgc2V0dGluZ3Mgb2JqZWN0IGlzIHRoZW4gYXBwbGllZCB0byB0aGF0CgkgKiBpbnN0YW5jZS4KCSAqIAoJICogTm90ZSB0aGF0IHRoaXMgb2JqZWN0IGlzIHJlbGF0ZWQgdG8ge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30gYnV0IHRoaXMgCgkgKiBvbmUgaXMgdGhlIGludGVybmFsIGRhdGEgc3RvcmUgZm9yIERhdGFUYWJsZXMncyBjYWNoZSBvZiBjb2x1bW5zLiBJdCBzaG91bGQKCSAqIE5PVCBiZSBtYW5pcHVsYXRlZCBvdXRzaWRlIG9mIERhdGFUYWJsZXMuIEFueSBjb25maWd1cmF0aW9uIHNob3VsZCBiZSBkb25lCgkgKiB0aHJvdWdoIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zLgoJICogIEBuYW1lc3BhY2UKCSAqICBAdG9kbyBSZWFsbHkgc2hvdWxkIGF0dGFjaCB0aGUgc2V0dGluZ3Mgb2JqZWN0IHRvIGluZGl2aWR1YWwgaW5zdGFuY2VzIHNvIHdlCgkgKiAgICBkb24ndCBuZWVkIHRvIGNyZWF0ZSBuZXcgaW5zdGFuY2VzIG9uIGVhY2ggJCgpLmRhdGFUYWJsZSgpIGNhbGwgKGlmIHRoZQoJICogICAgdGFibGUgYWxyZWFkeSBleGlzdHMpLiBJdCB3b3VsZCBhbHNvIHNhdmUgcGFzc2luZyBvU2V0dGluZ3MgYXJvdW5kIGFuZAoJICogICAgaW50byBldmVyeSBzaW5nbGUgZnVuY3Rpb24uIEhvd2V2ZXIsIHRoaXMgaXMgYSB2ZXJ5IHNpZ25pZmljYW50IAoJICogICAgYXJjaGl0ZWN0dXJlIGNoYW5nZSBmb3IgRGF0YVRhYmxlcyBhbmQgd2lsbCBhbG1vc3QgY2VydGFpbmx5IGJyZWFrCgkgKiAgICBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoIG9sZGVyIGluc3RhbGxhdGlvbnMuIFRoaXMgaXMgc29tZXRoaW5nIHRoYXQKCSAqICAgIHdpbGwgYmUgZG9uZSBpbiAyLjAuCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzID0gewoJCS8qKgoJCSAqIFByaW1hcnkgZmVhdHVyZXMgb2YgRGF0YVRhYmxlcyBhbmQgdGhlaXIgZW5hYmxlbWVudCBzdGF0ZS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvRmVhdHVyZXMiOiB7CgkJCQoJCQkvKioKCQkJICogRmxhZyB0byBzYXkgaWYgRGF0YVRhYmxlcyBzaG91bGQgYXV0b21hdGljYWxseSB0cnkgdG8gY2FsY3VsYXRlIHRoZQoJCQkgKiBvcHRpbXVtIHRhYmxlIGFuZCBjb2x1bW5zIHdpZHRocyAodHJ1ZSkgb3Igbm90IChmYWxzZSkuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkF1dG9XaWR0aCI6IG51bGwsCgkKCQkJLyoqCgkJCSAqIERlbGF5IHRoZSBjcmVhdGlvbiBvZiBUUiBhbmQgVEQgZWxlbWVudHMgdW50aWwgdGhleSBhcmUgYWN0dWFsbHkKCQkJICogbmVlZGVkIGJ5IGEgZHJpdmVuIHBhZ2UgZHJhdy4gVGhpcyBjYW4gZ2l2ZSBhIHNpZ25pZmljYW50IHNwZWVkCgkJCSAqIGluY3JlYXNlIGZvciBBamF4IHNvdXJjZSBhbmQgSmF2YXNjcmlwdCBzb3VyY2UgZGF0YSwgYnV0IG1ha2VzIG5vCgkJCSAqIGRpZmZlcmVuY2UgYXQgYWxsIGZybyBET00gYW5kIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgdGFibGVzLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJEZWZlclJlbmRlciI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogRW5hYmxlIGZpbHRlcmluZyBvbiB0aGUgdGFibGUgb3Igbm90LiBOb3RlIHRoYXQgaWYgdGhpcyBpcyBkaXNhYmxlZAoJCQkgKiB0aGVuIHRoZXJlIGlzIG5vIGZpbHRlcmluZyBhdCBhbGwgb24gdGhlIHRhYmxlLCBpbmNsdWRpbmcgZm5GaWx0ZXIuCgkJCSAqIFRvIGp1c3QgcmVtb3ZlIHRoZSBmaWx0ZXJpbmcgaW5wdXQgdXNlIHNEb20gYW5kIHJlbW92ZSB0aGUgJ2YnIG9wdGlvbi4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiRmlsdGVyIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBUYWJsZSBpbmZvcm1hdGlvbiBlbGVtZW50ICh0aGUgJ1Nob3dpbmcgeCBvZiB5IHJlY29yZHMnIGRpdikgZW5hYmxlCgkJCSAqIGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkluZm8iOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFByZXNlbnQgYSB1c2VyIGNvbnRyb2wgYWxsb3dpbmcgdGhlIGVuZCB1c2VyIHRvIGNoYW5nZSB0aGUgcGFnZSBzaXplCgkJCSAqIHdoZW4gcGFnaW5hdGlvbiBpcyBlbmFibGVkLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJMZW5ndGhDaGFuZ2UiOiBudWxsLAoJCgkJCS8qKgoJCQkgKiBQYWdpbmF0aW9uIGVuYWJsZWQgb3Igbm90LiBOb3RlIHRoYXQgaWYgdGhpcyBpcyBkaXNhYmxlZCB0aGVuIGxlbmd0aAoJCQkgKiBjaGFuZ2luZyBtdXN0IGFsc28gYmUgZGlzYWJsZWQuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlBhZ2luYXRlIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBQcm9jZXNzaW5nIGluZGljYXRvciBlbmFibGUgZmxhZyB3aGVuZXZlciBEYXRhVGFibGVzIGlzIGVuYWN0aW5nIGEKCQkJICogdXNlciByZXF1ZXN0IC0gdHlwaWNhbGx5IGFuIEFqYXggcmVxdWVzdCBmb3Igc2VydmVyLXNpZGUgcHJvY2Vzc2luZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiUHJvY2Vzc2luZyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyBlbmFibGVkIGZsYWcgLSB3aGVuIGVuYWJsZWQgRGF0YVRhYmxlcyB3aWxsCgkJCSAqIGdldCBhbGwgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIgZm9yIGV2ZXJ5IGRyYXcgLSB0aGVyZSBpcyBubyBmaWx0ZXJpbmcsCgkJCSAqIHNvcnRpbmcgb3IgcGFnaW5nIGRvbmUgb24gdGhlIGNsaWVudC1zaWRlLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJTZXJ2ZXJTaWRlIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBTb3J0aW5nIGVuYWJsZW1lbnQgZmxhZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU29ydCI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogQXBwbHkgYSBjbGFzcyB0byB0aGUgY29sdW1ucyB3aGljaCBhcmUgYmVpbmcgc29ydGVkIHRvIHByb3ZpZGUgYQoJCQkgKiB2aXN1YWwgaGlnaGxpZ2h0IG9yIG5vdC4gVGhpcyBjYW4gc2xvdyB0aGluZ3MgZG93biB3aGVuIGVuYWJsZWQgc2luY2UKCQkJICogdGhlcmUgaXMgYSBsb3Qgb2YgRE9NIGludGVyYWN0aW9uLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJTb3J0Q2xhc3NlcyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogU3RhdGUgc2F2aW5nIGVuYWJsZW1lbnQgZmxhZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU3RhdGVTYXZlIjogbnVsbAoJCX0sCgkJCgkKCQkvKioKCQkgKiBTY3JvbGxpbmcgc2V0dGluZ3MgZm9yIGEgdGFibGUuCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib1Njcm9sbCI6IHsKCQkJLyoqCgkJCSAqIEluZGljYXRlIGlmIERhdGFUYWJsZXMgc2hvdWxkIGJlIGFsbG93ZWQgdG8gc2V0IHRoZSBwYWRkaW5nIC8gbWFyZ2luCgkJCSAqIGV0YyBmb3IgdGhlIHNjcm9sbGluZyBoZWFkZXIgZWxlbWVudHMgb3Igbm90LiBUeXBpY2FsbHkgeW91IHdpbGwgd2FudAoJCQkgKiB0aGlzLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJBdXRvQ3NzIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBXaGVuIHRoZSB0YWJsZSBpcyBzaG9ydGVyIGluIGhlaWdodCB0aGFuIHNTY3JvbGxZLCBjb2xsYXBzZSB0aGUKCQkJICogdGFibGUgY29udGFpbmVyIGRvd24gdG8gdGhlIGhlaWdodCBvZiB0aGUgdGFibGUgKHdoZW4gdHJ1ZSkuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkNvbGxhcHNlIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBJbmZpbml0ZSBzY3JvbGxpbmcgZW5hYmxlbWVudCBmbGFnLiBOb3cgZGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YKCQkJICogdXNpbmcgdGhlIFNjcm9sbGVyIHBsdWctaW4uCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkluZmluaXRlIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBXaWR0aCBvZiB0aGUgc2Nyb2xsYmFyIGZvciB0aGUgd2ViLWJyb3dzZXIncyBwbGF0Zm9ybS4gQ2FsY3VsYXRlZAoJCQkgKiBkdXJpbmcgdGFibGUgaW5pdGlhbGlzYXRpb24uCgkJCSAqICBAdHlwZSBpbnQKCQkJICogIEBkZWZhdWx0IDAKCQkJICovCgkJCSJpQmFyV2lkdGgiOiAwLAoJCQkKCQkJLyoqCgkJCSAqIFNwYWNlIChpbiBwaXhlbHMpIGJldHdlZW4gdGhlIGJvdHRvbSBvZiB0aGUgc2Nyb2xsaW5nIGNvbnRhaW5lciBhbmQgCgkJCSAqIHRoZSBib3R0b20gb2YgdGhlIHNjcm9sbGluZyB2aWV3cG9ydCBiZWZvcmUgdGhlIG5leHQgcGFnZSBpcyBsb2FkZWQKCQkJICogd2hlbiB1c2luZyBpbmZpbml0ZSBzY3JvbGxpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBpbnQKCQkJICovCgkJCSJpTG9hZEdhcCI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogVmlld3BvcnQgd2lkdGggZm9yIGhvcml6b250YWwgc2Nyb2xsaW5nLiBIb3Jpem9udGFsIHNjcm9sbGluZyBpcyAKCQkJICogZGlzYWJsZWQgaWYgYW4gZW1wdHkgc3RyaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqLwoJCQkic1giOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFdpZHRoIHRvIGV4cGFuZCB0aGUgdGFibGUgdG8gd2hlbiB1c2luZyB4LXNjcm9sbGluZy4gVHlwaWNhbGx5IHlvdQoJCQkgKiBzaG91bGQgbm90IG5lZWQgdG8gdXNlIHRoaXMuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZXByZWNhdGVkCgkJCSAqLwoJCQkic1hJbm5lciI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogVmlld3BvcnQgaGVpZ2h0IGZvciB2ZXJ0aWNhbCBzY3JvbGxpbmcuIFZlcnRpY2FsIHNjcm9sbGluZyBpcyBkaXNhYmxlZAoJCQkgKiBpZiBhbiBlbXB0eSBzdHJpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICovCgkJCSJzWSI6IG51bGwKCQl9LAoJCQoJCS8qKgoJCSAqIExhbmd1YWdlIGluZm9ybWF0aW9uIGZvciB0aGUgdGFibGUuCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLmRlZmF1bHRzLm9MYW5ndWFnZQoJCSAqLwoJCSJvTGFuZ3VhZ2UiOiB7CgkJCS8qKgoJCQkgKiBJbmZvcm1hdGlvbiBjYWxsYmFjayBmdW5jdGlvbi4gU2VlIAoJCQkgKiB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmZuSW5mb0NhbGxiYWNrfQoJCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkJICogIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCSJmbkluZm9DYWxsYmFjayI6IG51bGwKCQl9LAoJCQoJCS8qKgoJCSAqIEJyb3dzZXIgc3VwcG9ydCBwYXJhbWV0ZXJzCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib0Jyb3dzZXIiOiB7CgkJCS8qKgoJCQkgKiBJbmRpY2F0ZSBpZiB0aGUgYnJvd3NlciBpbmNvcnJlY3RseSBjYWxjdWxhdGVzIHdpZHRoOjEwMCUgaW5zaWRlIGEKCQkJICogc2Nyb2xsaW5nIGVsZW1lbnQgKElFNi83KQoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCSJiU2Nyb2xsT3ZlcnNpemUiOiBmYWxzZQoJCX0sCgkJCgkJLyoqCgkJICogQXJyYXkgcmVmZXJlbmNpbmcgdGhlIG5vZGVzIHdoaWNoIGFyZSB1c2VkIGZvciB0aGUgZmVhdHVyZXMuIFRoZSAKCQkgKiBwYXJhbWV0ZXJzIG9mIHRoaXMgb2JqZWN0IG1hdGNoIHdoYXQgaXMgYWxsb3dlZCBieSBzRG9tIC0gaS5lLgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+J2wnIC0gTGVuZ3RoIGNoYW5naW5nPC9saT4KCQkgKiAgICAgPGxpPidmJyAtIEZpbHRlcmluZyBpbnB1dDwvbGk+CgkJICogICAgIDxsaT4ndCcgLSBUaGUgdGFibGUhPC9saT4KCQkgKiAgICAgPGxpPidpJyAtIEluZm9ybWF0aW9uPC9saT4KCQkgKiAgICAgPGxpPidwJyAtIFBhZ2luYXRpb248L2xpPgoJCSAqICAgICA8bGk+J3InIC0gcFJvY2Vzc2luZzwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhYW5GZWF0dXJlcyI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGRhdGEgaW5mb3JtYXRpb24gLSBzZWUge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1Jvd30gZm9yIGRldGFpbGVkCgkJICogaW5mb3JtYXRpb24uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRGF0YSI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGluZGV4ZXMgd2hpY2ggYXJlIGluIHRoZSBjdXJyZW50IGRpc3BsYXkgKGFmdGVyIGZpbHRlcmluZyBldGMpCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFpRGlzcGxheSI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGluZGV4ZXMgZm9yIGRpc3BsYXkgLSBubyBmaWx0ZXJpbmcKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYWlEaXNwbGF5TWFzdGVyIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgaW5mb3JtYXRpb24gYWJvdXQgZWFjaCBjb2x1bW4gdGhhdCBpcyBpbiB1c2UKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Db2x1bW5zIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHRhYmxlJ3MgaGVhZGVyCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvSGVhZGVyIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHRhYmxlJ3MgZm9vdGVyCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRm9vdGVyIjogW10sCgkJCgkJLyoqCgkJICogU2VhcmNoIGRhdGEgYXJyYXkgZm9yIHJlZ3VsYXIgZXhwcmVzc2lvbiBzZWFyY2hpbmcKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYXNEYXRhU2VhcmNoIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgdGhlIGFwcGxpZWQgZ2xvYmFsIHNlYXJjaCBpbmZvcm1hdGlvbiBpbiBjYXNlIHdlIHdhbnQgdG8gZm9yY2UgYSAKCQkgKiByZXNlYXJjaCBvciBjb21wYXJlIHRoZSBvbGQgc2VhcmNoIHRvIGEgbmV3IG9uZS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoCgkJICovCgkJIm9QcmV2aW91c1NlYXJjaCI6IHt9LAoJCQoJCS8qKgoJCSAqIFN0b3JlIHRoZSBhcHBsaWVkIHNlYXJjaCBmb3IgZWFjaCBjb2x1bW4gLSBzZWUgCgkJICoge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaH0gZm9yIHRoZSBmb3JtYXQgdGhhdCBpcyB1c2VkIGZvciB0aGUKCQkgKiBmaWx0ZXJpbmcgaW5mb3JtYXRpb24gZm9yIGVhY2ggY29sdW1uLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1ByZVNlYXJjaENvbHMiOiBbXSwKCQkKCQkvKioKCQkgKiBTb3J0aW5nIHRoYXQgaXMgYXBwbGllZCB0byB0aGUgdGFibGUuIE5vdGUgdGhhdCB0aGUgaW5uZXIgYXJyYXlzIGFyZQoJCSAqIHVzZWQgaW4gdGhlIGZvbGxvd2luZyBtYW5uZXI6CgkJICogPHVsPgoJCSAqICAgPGxpPkluZGV4IDAgLSBjb2x1bW4gbnVtYmVyPC9saT4KCQkgKiAgIDxsaT5JbmRleCAxIC0gY3VycmVudCBzb3J0aW5nIGRpcmVjdGlvbjwvbGk+CgkJICogICA8bGk+SW5kZXggMiAtIGluZGV4IG9mIGFzU29ydGluZyBmb3IgdGhpcyBjb2x1bW48L2xpPgoJCSAqIDwvdWw+CgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAdG9kbyBUaGVzZSBpbm5lciBhcnJheXMgc2hvdWxkIHJlYWxseSBiZSBvYmplY3RzCgkJICovCgkJImFhU29ydGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogU29ydGluZyB0aGF0IGlzIGFsd2F5cyBhcHBsaWVkIHRvIHRoZSB0YWJsZSAoaS5lLiBwcmVmaXhlZCBpbiBmcm9udCBvZgoJCSAqIGFhU29ydGluZykuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheXxudWxsCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiYWFTb3J0aW5nRml4ZWQiOiBudWxsLAoJCQoJCS8qKgoJCSAqIENsYXNzZXMgdG8gdXNlIGZvciB0aGUgc3RyaXBpbmcgb2YgYSB0YWJsZS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFzU3RyaXBlQ2xhc3NlcyI6IG51bGwsCgkJCgkJLyoqCgkJICogSWYgcmVzdG9yaW5nIGEgdGFibGUgLSB3ZSBzaG91bGQgcmVzdG9yZSBpdHMgc3RyaXBpbmcgY2xhc3NlcyBhcyB3ZWxsCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFzRGVzdHJveVN0cmlwZXMiOiBbXSwKCQkKCQkvKioKCQkgKiBJZiByZXN0b3JpbmcgYSB0YWJsZSAtIHdlIHNob3VsZCByZXN0b3JlIGl0cyB3aWR0aCAKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkic0Rlc3Ryb3lXaWR0aCI6IDAsCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGFycmF5IGZvciBldmVyeSB0aW1lIGEgcm93IGlzIGluc2VydGVkIChpLmUuIG9uIGEgZHJhdykuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUm93Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgZm9yIHRoZSBoZWFkZXIgb24gZWFjaCBkcmF3LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0hlYWRlckNhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHRoZSBmb290ZXIgb24gZWFjaCBkcmF3LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Zvb3RlckNhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciBkcmF3IGNhbGxiYWNrIGZ1bmN0aW9ucwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0RyYXdDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igcm93IGNyZWF0ZWQgZnVuY3Rpb24KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Sb3dDcmVhdGVkQ2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgZm9yIGp1c3QgYmVmb3JlIHRoZSB0YWJsZSBpcyByZWRyYXduLiBBIHJldHVybiBvZiAKCQkgKiBmYWxzZSB3aWxsIGJlIHVzZWQgdG8gY2FuY2VsIHRoZSBkcmF3LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1ByZURyYXdDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igd2hlbiB0aGUgdGFibGUgaGFzIGJlZW4gaW5pdGlhbGlzZWQuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvSW5pdENvbXBsZXRlIjogW10sCgkKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG1vZGlmeWluZyB0aGUgc2V0dGluZ3MgdG8gYmUgc3RvcmVkIGZvciBzdGF0ZSBzYXZpbmcsIHByaW9yIHRvCgkJICogc2F2aW5nIHN0YXRlLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlU2F2ZVBhcmFtcyI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrcyBmb3IgbW9kaWZ5aW5nIHRoZSBzZXR0aW5ncyB0aGF0IGhhdmUgYmVlbiBzdG9yZWQgZm9yIHN0YXRlIHNhdmluZwoJCSAqIHByaW9yIHRvIHVzaW5nIHRoZSBzdG9yZWQgdmFsdWVzIHRvIHJlc3RvcmUgdGhlIHN0YXRlLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlTG9hZFBhcmFtcyI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrcyBmb3Igb3BlcmF0aW5nIG9uIHRoZSBzZXR0aW5ncyBvYmplY3Qgb25jZSB0aGUgc2F2ZWQgc3RhdGUgaGFzIGJlZW4KCQkgKiBsb2FkZWQKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZUxvYWRlZCI6IFtdLAoJCQoJCS8qKgoJCSAqIENhY2hlIHRoZSB0YWJsZSBJRCBmb3IgcXVpY2sgYWNjZXNzCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICovCgkJInNUYWJsZUlkIjogIiIsCgkJCgkJLyoqCgkJICogVGhlIFRBQkxFIG5vZGUgZm9yIHRoZSBtYWluIHRhYmxlCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVGFibGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFBlcm1hbmVudCByZWYgdG8gdGhlIHRoZWFkIGVsZW1lbnQKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5USGVhZCI6IG51bGwsCgkJCgkJLyoqCgkJICogUGVybWFuZW50IHJlZiB0byB0aGUgdGZvb3QgZWxlbWVudCAtIGlmIGl0IGV4aXN0cwoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRGb290IjogbnVsbCwKCQkKCQkvKioKCQkgKiBQZXJtYW5lbnQgcmVmIHRvIHRoZSB0Ym9keSBlbGVtZW50CgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVEJvZHkiOiBudWxsLAoJCQoJCS8qKgoJCSAqIENhY2hlIHRoZSB3cmFwcGVyIG5vZGUgKGNvbnRhaW5zIGFsbCBEYXRhVGFibGVzIGNvbnRyb2xsZWQgZWxlbWVudHMpCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVGFibGVXcmFwcGVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiB3aGVuIHVzaW5nIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgdGhlIGxvYWRpbmcgb2YgZGF0YSAKCQkgKiBzaG91bGQgYmUgZGVmZXJyZWQgdW50aWwgdGhlIHNlY29uZCBkcmF3LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCSJiRGVmZXJMb2FkaW5nIjogZmFsc2UsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgYWxsIHJlcXVpcmVkIGluZm9ybWF0aW9uIGhhcyBiZWVuIHJlYWQgaW4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCSJiSW5pdGlhbGlzZWQiOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBJbmZvcm1hdGlvbiBhYm91dCBvcGVuIHJvd3MuIEVhY2ggb2JqZWN0IGluIHRoZSBhcnJheSBoYXMgdGhlIHBhcmFtZXRlcnMKCQkgKiAnblRyJyBhbmQgJ25QYXJlbnQnCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvT3BlblJvd3MiOiBbXSwKCQkKCQkvKioKCQkgKiBEaWN0YXRlIHRoZSBwb3NpdGlvbmluZyBvZiBEYXRhVGFibGVzJyBjb250cm9sIGVsZW1lbnRzIC0gc2VlCgkJICoge0BsaW5rIERhdGFUYWJsZS5tb2RlbC5vSW5pdC5zRG9tfS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNEb20iOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoaWNoIHR5cGUgb2YgcGFnaW5hdGlvbiBzaG91bGQgYmUgdXNlZC4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZyAKCQkgKiAgQGRlZmF1bHQgdHdvX2J1dHRvbgoJCSAqLwoJCSJzUGFnaW5hdGlvblR5cGUiOiAidHdvX2J1dHRvbiIsCgkJCgkJLyoqCgkJICogVGhlIGNvb2tpZSBkdXJhdGlvbiAoZm9yIGJTdGF0ZVNhdmUpIGluIHNlY29uZHMuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJpQ29va2llRHVyYXRpb24iOiAwLAoJCQoJCS8qKgoJCSAqIFRoZSBjb29raWUgbmFtZSBwcmVmaXguCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqLwoJCSJzQ29va2llUHJlZml4IjogIiIsCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIGNvb2tpZSBjcmVhdGlvbi4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5Db29raWVDYWxsYmFjayI6IG51bGwsCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciBzdGF0ZSBzYXZpbmcuIEVhY2ggYXJyYXkgZWxlbWVudCBpcyBhbiAKCQkgKiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5mdW5jdGlvbjpmbiAtIGZ1bmN0aW9uIHRvIGNhbGwuIFRha2VzIHR3byBwYXJhbWV0ZXJzLCBvU2V0dGluZ3MKCQkgKiAgICAgICBhbmQgdGhlIEpTT04gc3RyaW5nIHRvIHNhdmUgdGhhdCBoYXMgYmVlbiB0aHVzIGZhciBjcmVhdGVkLiBSZXR1cm5zCgkJICogICAgICAgYSBKU09OIHN0cmluZyB0byBiZSBpbnNlcnRlZCBpbnRvIGEganNvbiBvYmplY3QgCgkJICogICAgICAgKGkuZS4gJyJwYXJhbSI6IFsgMCwgMSwgMl0nKTwvbGk+CgkJICogICAgIDxsaT5zdHJpbmc6c05hbWUgLSBuYW1lIG9mIGNhbGxiYWNrPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVTYXZlIjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciBzdGF0ZSBsb2FkaW5nLiBFYWNoIGFycmF5IGVsZW1lbnQgaXMgYW4gCgkJICogb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+ZnVuY3Rpb246Zm4gLSBmdW5jdGlvbiB0byBjYWxsLiBUYWtlcyB0d28gcGFyYW1ldGVycywgb1NldHRpbmdzIAoJCSAqICAgICAgIGFuZCB0aGUgb2JqZWN0IHN0b3JlZC4gTWF5IHJldHVybiBmYWxzZSB0byBjYW5jZWwgc3RhdGUgbG9hZGluZzwvbGk+CgkJICogICAgIDxsaT5zdHJpbmc6c05hbWUgLSBuYW1lIG9mIGNhbGxiYWNrPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVMb2FkIjogW10sCgkJCgkJLyoqCgkJICogU3RhdGUgdGhhdCB3YXMgbG9hZGVkIGZyb20gdGhlIGNvb2tpZS4gVXNlZnVsIGZvciBiYWNrIHJlZmVyZW5jZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJvTG9hZGVkU3RhdGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFNvdXJjZSB1cmwgZm9yIEFKQVggZGF0YSBmb3IgdGhlIHRhYmxlLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0FqYXhTb3VyY2UiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFByb3BlcnR5IGZyb20gYSBnaXZlbiBvYmplY3QgZnJvbSB3aGljaCB0byByZWFkIHRoZSB0YWJsZSBkYXRhIGZyb20uIFRoaXMKCQkgKiBjYW4gYmUgYW4gZW1wdHkgc3RyaW5nICh3aGVuIG5vdCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nKSwgaW4gd2hpY2ggY2FzZSAKCQkgKiBpdCBpcyAgYXNzdW1lZCBhbiBhbiBhcnJheSBpcyBnaXZlbiBkaXJlY3RseS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzQWpheERhdGFQcm9wIjogbnVsbCwKCQkKCQkvKioKCQkgKiBOb3RlIGlmIGRyYXcgc2hvdWxkIGJlIGJsb2NrZWQgd2hpbGUgZ2V0dGluZyBkYXRhCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiQWpheERhdGFHZXQiOiB0cnVlLAoJCQoJCS8qKgoJCSAqIFRoZSBsYXN0IGpRdWVyeSBYSFIgb2JqZWN0IHRoYXQgd2FzIHVzZWQgZm9yIHNlcnZlci1zaWRlIGRhdGEgZ2F0aGVyaW5nLiAKCQkgKiBUaGlzIGNhbiBiZSB1c2VkIGZvciB3b3JraW5nIHdpdGggdGhlIFhIUiBpbmZvcm1hdGlvbiBpbiBvbmUgb2YgdGhlIAoJCSAqIGNhbGxiYWNrcwoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJqcVhIUiI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb24gdG8gZ2V0IHRoZSBzZXJ2ZXItc2lkZSBkYXRhLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5TZXJ2ZXJEYXRhIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGdW5jdGlvbnMgd2hpY2ggYXJlIGNhbGxlZCBwcmlvciB0byBzZW5kaW5nIGFuIEFqYXggcmVxdWVzdCBzbyBleHRyYSAKCQkgKiBwYXJhbWV0ZXJzIGNhbiBlYXNpbHkgYmUgc2VudCB0byB0aGUgc2VydmVyCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU2VydmVyUGFyYW1zIjogW10sCgkJCgkJLyoqCgkJICogU2VuZCB0aGUgWEhSIEhUVFAgbWV0aG9kIC0gR0VUIG9yIFBPU1QgKGNvdWxkIGJlIFBVVCBvciBERUxFVEUgaWYgCgkJICogcmVxdWlyZWQpLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNTZXJ2ZXJNZXRob2QiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZvcm1hdCBudW1iZXJzIGZvciBkaXNwbGF5LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5Gb3JtYXROdW1iZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIExpc3Qgb2Ygb3B0aW9ucyB0aGF0IGNhbiBiZSB1c2VkIGZvciB0aGUgdXNlciBzZWxlY3RhYmxlIGxlbmd0aCBtZW51LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYUxlbmd0aE1lbnUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIENvdW50ZXIgZm9yIHRoZSBkcmF3cyB0aGF0IHRoZSB0YWJsZSBkb2VzLiBBbHNvIHVzZWQgYXMgYSB0cmFja2VyIGZvcgoJCSAqIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiaURyYXciOiAwLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIGEgcmVkcmF3IGlzIGJlaW5nIGRvbmUgLSB1c2VmdWwgZm9yIEFqYXgKCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCSJiRHJhd2luZyI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIERyYXcgaW5kZXggKGlEcmF3KSBvZiB0aGUgbGFzdCBlcnJvciB3aGVuIHBhcnNpbmcgdGhlIHJldHVybmVkIGRhdGEKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IC0xCgkJICovCgkJImlEcmF3RXJyb3IiOiAtMSwKCQkKCQkvKioKCQkgKiBQYWdpbmcgZGlzcGxheSBsZW5ndGgKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDEwCgkJICovCgkJIl9pRGlzcGxheUxlbmd0aCI6IDEwLAoJCgkJLyoqCgkJICogUGFnaW5nIHN0YXJ0IHBvaW50IC0gYWlEaXNwbGF5IGluZGV4CgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJIl9pRGlzcGxheVN0YXJ0IjogMCwKCQoJCS8qKgoJCSAqIFBhZ2luZyBlbmQgcG9pbnQgLSBhaURpc3BsYXkgaW5kZXguIFVzZSBmbkRpc3BsYXlFbmQgcmF0aGVyIHRoYW4KCQkgKiB0aGlzIHByb3BlcnR5IHRvIGdldCB0aGUgZW5kIHBvaW50CgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfaURpc3BsYXlFbmQiOiAxMCwKCQkKCQkvKioKCQkgKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIHJlc3VsdCBzZXQKCQkgKiAoaS5lLiBiZWZvcmUgZmlsdGVyaW5nKSwgVXNlIGZuUmVjb3Jkc1RvdGFsIHJhdGhlciB0aGFuCgkJICogdGhpcyBwcm9wZXJ0eSB0byBnZXQgdGhlIHZhbHVlIG9mIHRoZSBudW1iZXIgb2YgcmVjb3JkcywgcmVnYXJkbGVzcyBvZgoJCSAqIHRoZSBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHNldHRpbmcuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9pUmVjb3Jkc1RvdGFsIjogMCwKCQoJCS8qKgoJCSAqIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgLSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCBkaXNwbGF5IHNldAoJCSAqIChpLmUuIGFmdGVyIGZpbHRlcmluZykuIFVzZSBmblJlY29yZHNEaXNwbGF5IHJhdGhlciB0aGFuCgkJICogdGhpcyBwcm9wZXJ0eSB0byBnZXQgdGhlIHZhbHVlIG9mIHRoZSBudW1iZXIgb2YgcmVjb3JkcywgcmVnYXJkbGVzcyBvZgoJCSAqIHRoZSBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHNldHRpbmcuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfaVJlY29yZHNEaXNwbGF5IjogMCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIGpRdWVyeSBVSSBtYXJraW5nIGFuZCBjbGFzc2VzIHNob3VsZCBiZSB1c2VkLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiSlVJIjogbnVsbCwKCQkKCQkvKioKCQkgKiBUaGUgY2xhc3NlcyB0byB1c2UgZm9yIHRoZSB0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0NsYXNzZXMiOiB7fSwKCQkKCQkvKioKCQkgKiBGbGFnIGF0dGFjaGVkIHRvIHRoZSBzZXR0aW5ncyBvYmplY3Qgc28geW91IGNhbiBjaGVjayBpbiB0aGUgZHJhdyAKCQkgKiBjYWxsYmFjayBpZiBmaWx0ZXJpbmcgaGFzIGJlZW4gZG9uZSBpbiB0aGUgZHJhdy4gRGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YKCQkgKiBldmVudHMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYkZpbHRlcmVkIjogZmFsc2UsCgkJCgkJLyoqCgkJICogRmxhZyBhdHRhY2hlZCB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IHNvIHlvdSBjYW4gY2hlY2sgaW4gdGhlIGRyYXcgCgkJICogY2FsbGJhY2sgaWYgc29ydGluZyBoYXMgYmVlbiBkb25lIGluIHRoZSBkcmF3LiBEZXByZWNhdGVkIGluIGZhdm91ciBvZgoJCSAqIGV2ZW50cy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqLwoJCSJiU29ydGVkIjogZmFsc2UsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgdGhhdCBpZiBtdWx0aXBsZSByb3dzIGFyZSBpbiB0aGUgaGVhZGVyIGFuZCB0aGVyZSBpcyBtb3JlIHRoYW4gCgkJICogb25lIHVuaXF1ZSBjZWxsIHBlciBjb2x1bW4sIGlmIHRoZSB0b3Agb25lICh0cnVlKSBvciBib3R0b20gb25lIChmYWxzZSkgCgkJICogc2hvdWxkIGJlIHVzZWQgZm9yIHNvcnRpbmcgLyB0aXRsZSBieSBEYXRhVGFibGVzLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiU29ydENlbGxzVG9wIjogbnVsbCwKCQkKCQkvKioKCQkgKiBJbml0aWFsaXNhdGlvbiBvYmplY3QgdGhhdCBpcyB1c2VkIGZvciB0aGUgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0luaXQiOiBudWxsLAoJCQoJCS8qKgoJCSAqIERlc3Ryb3kgY2FsbGJhY2sgZnVuY3Rpb25zIC0gZm9yIHBsdWctaW5zIHRvIGF0dGFjaCB0aGVtc2VsdmVzIHRvIHRoZQoJCSAqIGRlc3Ryb3kgc28gdGhleSBjYW4gY2xlYW4gdXAgbWFya3VwIGFuZCBldmVudHMuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRGVzdHJveUNhbGxiYWNrIjogW10sCgkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSBjdXJyZW50IHJlY29yZCBzZXQsIGJlZm9yZSBmaWx0ZXJpbmcKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5SZWNvcmRzVG90YWwiOiBmdW5jdGlvbiAoKQoJCXsKCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApIHsKCQkJCXJldHVybiBwYXJzZUludCh0aGlzLl9pUmVjb3Jkc1RvdGFsLCAxMCk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gdGhpcy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoOwoJCQl9CgkJfSwKCQkKCQkvKioKCQkgKiBHZXQgdGhlIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSBjdXJyZW50IHJlY29yZCBzZXQsIGFmdGVyIGZpbHRlcmluZwoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqLwoJCSJmblJlY29yZHNEaXNwbGF5IjogZnVuY3Rpb24gKCkKCQl7CgkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKSB7CgkJCQlyZXR1cm4gcGFyc2VJbnQodGhpcy5faVJlY29yZHNEaXNwbGF5LCAxMCk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gdGhpcy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJfSwKCQkKCQkvKioKCQkgKiBTZXQgdGhlIGRpc3BsYXkgZW5kIHBvaW50IC0gYWlEaXNwbGF5IGluZGV4CgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEB0b2RvIFNob3VsZCBkbyBhd2F5IHdpdGggX2lEaXNwbGF5RW5kIGFuZCBjYWxjdWxhdGUgaXQgb24tdGhlLWZseSBoZXJlCgkJICovCgkJImZuRGlzcGxheUVuZCI6IGZ1bmN0aW9uICgpCgkJewoJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkgewoJCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlIHx8IHRoaXMuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkgewoJCQkJCXJldHVybiB0aGlzLl9pRGlzcGxheVN0YXJ0K3RoaXMuYWlEaXNwbGF5Lmxlbmd0aDsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuIE1hdGgubWluKCB0aGlzLl9pRGlzcGxheVN0YXJ0K3RoaXMuX2lEaXNwbGF5TGVuZ3RoLCAKCQkJCQkJdGhpcy5faVJlY29yZHNEaXNwbGF5ICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gdGhpcy5faURpc3BsYXlFbmQ7CgkJCX0KCQl9LAoJCQoJCS8qKgoJCSAqIFRoZSBEYXRhVGFibGVzIG9iamVjdCBmb3IgdGhpcyB0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJvSW5zdGFuY2UiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBpZGVudGlmaWVyIGZvciBlYWNoIGluc3RhbmNlIG9mIHRoZSBEYXRhVGFibGVzIG9iamVjdC4gSWYgdGhlcmUKCQkgKiBpcyBhbiBJRCBvbiB0aGUgdGFibGUgbm9kZSwgdGhlbiBpdCB0YWtlcyB0aGF0IHZhbHVlLCBvdGhlcndpc2UgYW4KCQkgKiBpbmNyZW1lbnRpbmcgaW50ZXJuYWwgY291bnRlciBpcyB1c2VkLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzSW5zdGFuY2UiOiBudWxsLAoJCgkJLyoqCgkJICogdGFiaW5kZXggYXR0cmlidXRlIHZhbHVlIHRoYXQgaXMgYWRkZWQgdG8gRGF0YVRhYmxlcyBjb250cm9sIGVsZW1lbnRzLCBhbGxvd2luZwoJCSAqIGtleWJvYXJkIG5hdmlnYXRpb24gb2YgdGhlIHRhYmxlIGFuZCBpdHMgY29udHJvbHMuCgkJICovCgkJImlUYWJJbmRleCI6IDAsCgkKCQkvKioKCQkgKiBESVYgY29udGFpbmVyIGZvciB0aGUgZm9vdGVyIHNjcm9sbGluZyB0YWJsZSBpZiBzY3JvbGxpbmcKCQkgKi8KCQkiblNjcm9sbEhlYWQiOiBudWxsLAoJCgkJLyoqCgkJICogRElWIGNvbnRhaW5lciBmb3IgdGhlIGZvb3RlciBzY3JvbGxpbmcgdGFibGUgaWYgc2Nyb2xsaW5nCgkJICovCgkJIm5TY3JvbGxGb290IjogbnVsbAoJfTsKCgkvKioKCSAqIEV4dGVuc2lvbiBvYmplY3QgZm9yIERhdGFUYWJsZXMgdGhhdCBpcyB1c2VkIHRvIHByb3ZpZGUgYWxsIGV4dGVuc2lvbiBvcHRpb25zLgoJICogCgkgKiBOb3RlIHRoYXQgdGhlIDxpPkRhdGFUYWJsZS5leHQ8L2k+IG9iamVjdCBpcyBhdmFpbGFibGUgdGhyb3VnaAoJICogPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZS5leHQ8L2k+IHdoZXJlIGl0IG1heSBiZSBhY2Nlc3NlZCBhbmQgbWFuaXB1bGF0ZWQuIEl0IGlzCgkgKiBhbHNvIGFsaWFzZWQgdG8gPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZUV4dDwvaT4gZm9yIGhpc3RvcmljIHJlYXNvbnMuCgkgKiAgQG5hbWVzcGFjZQoJICogIEBleHRlbmRzIERhdGFUYWJsZS5tb2RlbHMuZXh0CgkgKi8KCURhdGFUYWJsZS5leHQgPSAkLmV4dGVuZCggdHJ1ZSwge30sIERhdGFUYWJsZS5tb2RlbHMuZXh0ICk7CgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9TdGRDbGFzc2VzLCB7CgkJInNUYWJsZSI6ICJkYXRhVGFibGUiLAoJCgkJLyogVHdvIGJ1dHRvbnMgYnV0dG9ucyAqLwoJCSJzUGFnZVByZXZFbmFibGVkIjogInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiLAoJCSJzUGFnZVByZXZEaXNhYmxlZCI6ICJwYWdpbmF0ZV9kaXNhYmxlZF9wcmV2aW91cyIsCgkJInNQYWdlTmV4dEVuYWJsZWQiOiAicGFnaW5hdGVfZW5hYmxlZF9uZXh0IiwKCQkic1BhZ2VOZXh0RGlzYWJsZWQiOiAicGFnaW5hdGVfZGlzYWJsZWRfbmV4dCIsCgkJInNQYWdlSlVJTmV4dCI6ICIiLAoJCSJzUGFnZUpVSVByZXYiOiAiIiwKCQkKCQkvKiBGdWxsIG51bWJlcnMgcGFnaW5nIGJ1dHRvbnMgKi8KCQkic1BhZ2VCdXR0b24iOiAicGFnaW5hdGVfYnV0dG9uIiwKCQkic1BhZ2VCdXR0b25BY3RpdmUiOiAicGFnaW5hdGVfYWN0aXZlIiwKCQkic1BhZ2VCdXR0b25TdGF0aWNEaXNhYmxlZCI6ICJwYWdpbmF0ZV9idXR0b24gcGFnaW5hdGVfYnV0dG9uX2Rpc2FibGVkIiwKCQkic1BhZ2VGaXJzdCI6ICJmaXJzdCIsCgkJInNQYWdlUHJldmlvdXMiOiAicHJldmlvdXMiLAoJCSJzUGFnZU5leHQiOiAibmV4dCIsCgkJInNQYWdlTGFzdCI6ICJsYXN0IiwKCQkKCQkvKiBTdHJpcGluZyBjbGFzc2VzICovCgkJInNTdHJpcGVPZGQiOiAib2RkIiwKCQkic1N0cmlwZUV2ZW4iOiAiZXZlbiIsCgkJCgkJLyogRW1wdHkgcm93ICovCgkJInNSb3dFbXB0eSI6ICJkYXRhVGFibGVzX2VtcHR5IiwKCQkKCQkvKiBGZWF0dXJlcyAqLwoJCSJzV3JhcHBlciI6ICJkYXRhVGFibGVzX3dyYXBwZXIiLAoJCSJzRmlsdGVyIjogImRhdGFUYWJsZXNfZmlsdGVyIiwKCQkic0luZm8iOiAiZGF0YVRhYmxlc19pbmZvIiwKCQkic1BhZ2luZyI6ICJkYXRhVGFibGVzX3BhZ2luYXRlIHBhZ2luZ18iLCAvKiBOb3RlIHRoYXQgdGhlIHR5cGUgaXMgcG9zdGZpeGVkICovCgkJInNMZW5ndGgiOiAiZGF0YVRhYmxlc19sZW5ndGgiLAoJCSJzUHJvY2Vzc2luZyI6ICJkYXRhVGFibGVzX3Byb2Nlc3NpbmciLAoJCQoJCS8qIFNvcnRpbmcgKi8KCQkic1NvcnRBc2MiOiAic29ydGluZ19hc2MiLAoJCSJzU29ydERlc2MiOiAic29ydGluZ19kZXNjIiwKCQkic1NvcnRhYmxlIjogInNvcnRpbmciLCAvKiBTb3J0YWJsZSBpbiBib3RoIGRpcmVjdGlvbnMgKi8KCQkic1NvcnRhYmxlQXNjIjogInNvcnRpbmdfYXNjX2Rpc2FibGVkIiwKCQkic1NvcnRhYmxlRGVzYyI6ICJzb3J0aW5nX2Rlc2NfZGlzYWJsZWQiLAoJCSJzU29ydGFibGVOb25lIjogInNvcnRpbmdfZGlzYWJsZWQiLAoJCSJzU29ydENvbHVtbiI6ICJzb3J0aW5nXyIsIC8qIE5vdGUgdGhhdCBhbiBpbnQgaXMgcG9zdGZpeGVkIGZvciB0aGUgc29ydGluZyBvcmRlciAqLwoJCSJzU29ydEpVSUFzYyI6ICIiLAoJCSJzU29ydEpVSURlc2MiOiAiIiwKCQkic1NvcnRKVUkiOiAiIiwKCQkic1NvcnRKVUlBc2NBbGxvd2VkIjogIiIsCgkJInNTb3J0SlVJRGVzY0FsbG93ZWQiOiAiIiwKCQkic1NvcnRKVUlXcmFwcGVyIjogIiIsCgkJInNTb3J0SWNvbiI6ICIiLAoJCQoJCS8qIFNjcm9sbGluZyAqLwoJCSJzU2Nyb2xsV3JhcHBlciI6ICJkYXRhVGFibGVzX3Njcm9sbCIsCgkJInNTY3JvbGxIZWFkIjogImRhdGFUYWJsZXNfc2Nyb2xsSGVhZCIsCgkJInNTY3JvbGxIZWFkSW5uZXIiOiAiZGF0YVRhYmxlc19zY3JvbGxIZWFkSW5uZXIiLAoJCSJzU2Nyb2xsQm9keSI6ICJkYXRhVGFibGVzX3Njcm9sbEJvZHkiLAoJCSJzU2Nyb2xsRm9vdCI6ICJkYXRhVGFibGVzX3Njcm9sbEZvb3QiLAoJCSJzU2Nyb2xsRm9vdElubmVyIjogImRhdGFUYWJsZXNfc2Nyb2xsRm9vdElubmVyIiwKCQkKCQkvKiBNaXNjICovCgkJInNGb290ZXJUSCI6ICIiLAoJCSJzSlVJSGVhZGVyIjogIiIsCgkJInNKVUlGb290ZXIiOiAiIgoJfSApOwoJCgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9KVUlDbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9TdGRDbGFzc2VzLCB7CgkJLyogVHdvIGJ1dHRvbnMgYnV0dG9ucyAqLwoJCSJzUGFnZVByZXZFbmFibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItbGVmdCIsCgkJInNQYWdlUHJldkRpc2FibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItbGVmdCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlTmV4dEVuYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1yaWdodCIsCgkJInNQYWdlTmV4dERpc2FibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItcmlnaHQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZUpVSU5leHQiOiAidWktaWNvbiB1aS1pY29uLWNpcmNsZS1hcnJvdy1lIiwKCQkic1BhZ2VKVUlQcmV2IjogInVpLWljb24gdWktaWNvbi1jaXJjbGUtYXJyb3ctdyIsCgkJCgkJLyogRnVsbCBudW1iZXJzIHBhZ2luZyBidXR0b25zICovCgkJInNQYWdlQnV0dG9uIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCIsCgkJInNQYWdlQnV0dG9uQWN0aXZlIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VGaXJzdCI6ICJmaXJzdCB1aS1jb3JuZXItdGwgdWktY29ybmVyLWJsIiwKCQkic1BhZ2VMYXN0IjogImxhc3QgdWktY29ybmVyLXRyIHVpLWNvcm5lci1iciIsCgkJCgkJLyogRmVhdHVyZXMgKi8KCQkic1BhZ2luZyI6ICJkYXRhVGFibGVzX3BhZ2luYXRlIGZnLWJ1dHRvbnNldCB1aS1idXR0b25zZXQgZmctYnV0dG9uc2V0LW11bHRpICIrCgkJCSJ1aS1idXR0b25zZXQtbXVsdGkgcGFnaW5nXyIsIC8qIE5vdGUgdGhhdCB0aGUgdHlwZSBpcyBwb3N0Zml4ZWQgKi8KCQkKCQkvKiBTb3J0aW5nICovCgkJInNTb3J0QXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydERlc2MiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZSI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlQXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGVEZXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGVOb25lIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydEpVSUFzYyI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLXRyaWFuZ2xlLTEtbiIsCgkJInNTb3J0SlVJRGVzYyI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLXRyaWFuZ2xlLTEtcyIsCgkJInNTb3J0SlVJIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tY2FyYXQtMi1uLXMiLAoJCSJzU29ydEpVSUFzY0FsbG93ZWQiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi1jYXJhdC0xLW4iLAoJCSJzU29ydEpVSURlc2NBbGxvd2VkIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tY2FyYXQtMS1zIiwKCQkic1NvcnRKVUlXcmFwcGVyIjogIkRhdGFUYWJsZXNfc29ydF93cmFwcGVyIiwKCQkic1NvcnRJY29uIjogIkRhdGFUYWJsZXNfc29ydF9pY29uIiwKCQkKCQkvKiBTY3JvbGxpbmcgKi8KCQkic1Njcm9sbEhlYWQiOiAiZGF0YVRhYmxlc19zY3JvbGxIZWFkIHVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU2Nyb2xsRm9vdCI6ICJkYXRhVGFibGVzX3Njcm9sbEZvb3QgdWktc3RhdGUtZGVmYXVsdCIsCgkJCgkJLyogTWlzYyAqLwoJCSJzRm9vdGVyVEgiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNKVUlIZWFkZXIiOiAiZmctdG9vbGJhciB1aS10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLXRsIHVpLWNvcm5lci10ciB1aS1oZWxwZXItY2xlYXJmaXgiLAoJCSJzSlVJRm9vdGVyIjogImZnLXRvb2xiYXIgdWktdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1ibCB1aS1jb3JuZXItYnIgdWktaGVscGVyLWNsZWFyZml4IgoJfSApOwoJCgkvKgoJICogVmFyaWFibGU6IG9QYWdpbmF0aW9uCgkgKiBQdXJwb3NlOiAgCgkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dAoJICovCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbiwgewoJCS8qCgkJICogVmFyaWFibGU6IHR3b19idXR0b24KCQkgKiBQdXJwb3NlOiAgU3RhbmRhcmQgdHdvIGJ1dHRvbiAoZm9yd2FyZC9iYWNrKSBwYWdpbmF0aW9uCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkidHdvX2J1dHRvbiI6IHsKCQkJLyoKCQkJICogRnVuY3Rpb246IG9QYWdpbmF0aW9uLnR3b19idXR0b24uZm5Jbml0CgkJCSAqIFB1cnBvc2U6ICBJbml0aWFsaXNlIGRvbSBlbGVtZW50cyByZXF1aXJlZCBmb3IgcGFnaW5hdGlvbiB3aXRoIGZvcndhcmQvYmFjayBidXR0b25zIG9ubHkKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgbm9kZTpuUGFnaW5nIC0gdGhlIERJViB3aGljaCBjb250YWlucyB0aGlzIHBhZ2luYXRpb24gY29udHJvbAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIG9uIHVwZGF0ZQoJCQkgKi8KCQkJImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGZuQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKCBlICkgewoJCQkJCWlmICggb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEuYWN0aW9uICkgKQoJCQkJCXsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCX07CgkKCQkJCXZhciBzQXBwZW5kID0gKCFvU2V0dGluZ3MuYkpVSSkgPwoJCQkJCSc8YSBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VQcmV2RGlzYWJsZWQrJyIgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiByb2xlPSJidXR0b24iPicrb0xhbmcuc1ByZXZpb3VzKyc8L2E+JysKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj4nK29MYW5nLnNOZXh0Kyc8L2E+JwoJCQkJCToKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj48c3BhbiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VKVUlQcmV2KyciPjwvc3Bhbj48L2E+JysKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj48c3BhbiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VKVUlOZXh0KyciPjwvc3Bhbj48L2E+JzsKCQkJCSQoblBhZ2luZykuYXBwZW5kKCBzQXBwZW5kICk7CgkJCQkKCQkJCXZhciBlbHMgPSAkKCdhJywgblBhZ2luZyk7CgkJCQl2YXIgblByZXZpb3VzID0gZWxzWzBdLAoJCQkJCW5OZXh0ID0gZWxzWzFdOwoJCQkJCgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuUHJldmlvdXMsIHthY3Rpb246ICJwcmV2aW91cyJ9LCBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbk5leHQsICAgICB7YWN0aW9uOiAibmV4dCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCQoJCQkJLyogSUQgdGhlIGZpcnN0IGVsZW1lbnRzIG9ubHkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wICkKCQkJCXsKCQkJCQluUGFnaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcGFnaW5hdGUnOwoJCQkJCW5QcmV2aW91cy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3ByZXZpb3VzJzsKCQkJCQluTmV4dC5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX25leHQnOwoJCgkJCQkJblByZXZpb3VzLnNldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQkJbk5leHQuc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCX0KCQkJfSwKCQkJCgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi50d29fYnV0dG9uLmZuVXBkYXRlCgkJCSAqIFB1cnBvc2U6ICBVcGRhdGUgdGhlIHR3byBidXR0b24gcGFnaW5hdGlvbiBhdCB0aGUgZW5kIG9mIHRoZSBkcmF3CgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB0byBjYWxsIG9uIHBhZ2UgY2hhbmdlCgkJCSAqLwoJCQkiZm5VcGRhdGUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucDsKCQkJCXZhciBuTm9kZTsKCQoJCQkJLyogTG9vcCBvdmVyIGVhY2ggaW5zdGFuY2Ugb2YgdGhlIHBhZ2VyICovCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJbk5vZGUgPSBhbltpXS5maXJzdENoaWxkOwoJCQkJCWlmICggbk5vZGUgKQoJCQkJCXsKCQkJCQkJLyogUHJldmlvdXMgcGFnZSAqLwoJCQkJCQluTm9kZS5jbGFzc05hbWUgPSAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApID8KCQkJCQkJICAgIG9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkIDogb0NsYXNzZXMuc1BhZ2VQcmV2RW5hYmxlZDsKCQkJCQkJICAgIAoJCQkJCQkvKiBOZXh0IHBhZ2UgKi8KCQkJCQkJbk5vZGUgPSBuTm9kZS5uZXh0U2libGluZzsKCQkJCQkJbk5vZGUuY2xhc3NOYW1lID0gKCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgPT0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApID8KCQkJCQkJICAgIG9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkIDogb0NsYXNzZXMuc1BhZ2VOZXh0RW5hYmxlZDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9LAoJCQoJCQoJCS8qCgkJICogVmFyaWFibGU6IGlGdWxsTnVtYmVyc1Nob3dQYWdlcwoJCSAqIFB1cnBvc2U6ICBDaGFuZ2UgdGhlIG51bWJlciBvZiBwYWdlcyB3aGljaCBjYW4gYmUgc2VlbgoJCSAqIFNjb3BlOiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uCgkJICovCgkJImlGdWxsTnVtYmVyc1Nob3dQYWdlcyI6IDUsCgkJCgkJLyoKCQkgKiBWYXJpYWJsZTogZnVsbF9udW1iZXJzCgkJICogUHVycG9zZTogIEZ1bGwgbnVtYmVycyBwYWdpbmF0aW9uCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkiZnVsbF9udW1iZXJzIjogewoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24uZnVsbF9udW1iZXJzLmZuSW5pdAoJCQkgKiBQdXJwb3NlOiAgSW5pdGlhbGlzZSBkb20gZWxlbWVudHMgcmVxdWlyZWQgZm9yIHBhZ2luYXRpb24gd2l0aCBhIGxpc3Qgb2YgdGhlIHBhZ2VzCgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIG5vZGU6blBhZ2luZyAtIHRoZSBESVYgd2hpY2ggY29udGFpbnMgdGhpcyBwYWdpbmF0aW9uIGNvbnRyb2wKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB3aGljaCBtdXN0IGJlIGNhbGxlZCBvbiB1cGRhdGUKCQkJICovCgkJCSJmbkluaXQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgblBhZ2luZywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQl2YXIgb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZTsKCQkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCXZhciBmbkNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICggZSApIHsKCQkJCQlpZiAoIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLmFjdGlvbiApICkKCQkJCQl7CgkJCQkJCWZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQl9OwoJCgkJCQkkKG5QYWdpbmcpLmFwcGVuZCgKCQkJCQknPGEgIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlRmlyc3QrJyI+JytvTGFuZy5zRmlyc3QrJzwvYT4nKwoJCQkJCSc8YSAgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VQcmV2aW91cysnIj4nK29MYW5nLnNQcmV2aW91cysnPC9hPicrCgkJCQkJJzxzcGFuPjwvc3Bhbj4nKwoJCQkJCSc8YSB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZU5leHQrJyI+JytvTGFuZy5zTmV4dCsnPC9hPicrCgkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlTGFzdCsnIj4nK29MYW5nLnNMYXN0Kyc8L2E+JwoJCQkJKTsKCQkJCXZhciBlbHMgPSAkKCdhJywgblBhZ2luZyk7CgkJCQl2YXIgbkZpcnN0ID0gZWxzWzBdLAoJCQkJCW5QcmV2ID0gZWxzWzFdLAoJCQkJCW5OZXh0ID0gZWxzWzJdLAoJCQkJCW5MYXN0ID0gZWxzWzNdOwoJCQkJCgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuRmlyc3QsIHthY3Rpb246ICJmaXJzdCJ9LCAgICBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggblByZXYsICB7YWN0aW9uOiAicHJldmlvdXMifSwgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5OZXh0LCAge2FjdGlvbjogIm5leHQifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuTGFzdCwgIHthY3Rpb246ICJsYXN0In0sICAgICBmbkNsaWNrSGFuZGxlciApOwoJCQkJCgkJCQkvKiBJRCB0aGUgZmlyc3QgZWxlbWVudHMgb25seSAqLwoJCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKQoJCQkJewoJCQkJCW5QYWdpbmcuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19wYWdpbmF0ZSc7CgkJCQkJbkZpcnN0LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19maXJzdCc7CgkJCQkJblByZXYuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX3ByZXZpb3VzJzsKCQkJCQluTmV4dC5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfbmV4dCc7CgkJCQkJbkxhc3QuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX2xhc3QnOwoJCQkJfQoJCQl9LAoJCQkKCQkJLyoKCQkJICogRnVuY3Rpb246IG9QYWdpbmF0aW9uLmZ1bGxfbnVtYmVycy5mblVwZGF0ZQoJCQkgKiBQdXJwb3NlOiAgVXBkYXRlIHRoZSBsaXN0IG9mIHBhZ2UgYnV0dG9ucyBzaG93cwoJCQkgKiBSZXR1cm5zOiAgLQoJCQkgKiBJbnB1dHM6ICAgb2JqZWN0Om9TZXR0aW5ncyAtIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJCSAqICAgICAgICAgICBmdW5jdGlvbjpmbkNhbGxiYWNrRHJhdyAtIGRyYXcgZnVuY3Rpb24gdG8gY2FsbCBvbiBwYWdlIGNoYW5nZQoJCQkgKi8KCQkJImZuVXBkYXRlIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGZuQ2FsbGJhY2tEcmF3ICkKCQkJewoJCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJdmFyIGlQYWdlQ291bnQgPSBEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uLmlGdWxsTnVtYmVyc1Nob3dQYWdlczsKCQkJCXZhciBpUGFnZUNvdW50SGFsZiA9IE1hdGguZmxvb3IoaVBhZ2VDb3VudCAvIDIpOwoJCQkJdmFyIGlQYWdlcyA9IE1hdGguY2VpbCgob1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSkgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKTsKCQkJCXZhciBpQ3VycmVudFBhZ2UgPSBNYXRoLmNlaWwob1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IC8gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCkgKyAxOwoJCQkJdmFyIHNMaXN0ID0gIiI7CgkJCQl2YXIgaVN0YXJ0QnV0dG9uLCBpRW5kQnV0dG9uLCBpLCBpTGVuOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGFuQnV0dG9ucywgYW5TdGF0aWMsIG5QYWdpbmF0ZUxpc3QsIG5Ob2RlOwoJCQkJdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJCQl2YXIgZm5CaW5kID0gZnVuY3Rpb24gKGopIHsKCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCB0aGlzLCB7InBhZ2UiOiBqK2lTdGFydEJ1dHRvbi0xfSwgZnVuY3Rpb24oZSkgewoJCQkJCQkvKiBVc2UgdGhlIGluZm9ybWF0aW9uIGluIHRoZSBlbGVtZW50IHRvIGp1bXAgdG8gdGhlIHJlcXVpcmVkIHBhZ2UgKi8KCQkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEucGFnZSApOwoJCQkJCQlmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQl9ICk7CgkJCQl9OwoJCQkJCgkJCQkvKiBQYWdlcyBjYWxjdWxhdGlvbiAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09PSAtMSApCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gMTsKCQkJCQlpQ3VycmVudFBhZ2UgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoaVBhZ2VzIDwgaVBhZ2VDb3VudCkKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZXM7CgkJCQl9CgkJCQllbHNlIGlmIChpQ3VycmVudFBhZ2UgPD0gaVBhZ2VDb3VudEhhbGYpCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gaVBhZ2VDb3VudDsKCQkJCX0KCQkJCWVsc2UgaWYgKGlDdXJyZW50UGFnZSA+PSAoaVBhZ2VzIC0gaVBhZ2VDb3VudEhhbGYpKQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IGlQYWdlcyAtIGlQYWdlQ291bnQgKyAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZXM7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gaUN1cnJlbnRQYWdlIC0gTWF0aC5jZWlsKGlQYWdlQ291bnQgLyAyKSArIDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlTdGFydEJ1dHRvbiArIGlQYWdlQ291bnQgLSAxOwoJCQkJfQoJCgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSBkeW5hbWljIGxpc3QgKi8KCQkJCWZvciAoIGk9aVN0YXJ0QnV0dG9uIDsgaTw9aUVuZEJ1dHRvbiA7IGkrKyApCgkJCQl7CgkJCQkJc0xpc3QgKz0gKGlDdXJyZW50UGFnZSAhPT0gaSkgPwoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPicgOgoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbkFjdGl2ZSsnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPic7CgkJCQl9CgkJCQkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJbk5vZGUgPSBhbltpXTsKCQkJCQlpZiAoICFuTm9kZS5oYXNDaGlsZE5vZGVzKCkgKQoJCQkJCXsKCQkJCQkJY29udGludWU7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIEJ1aWxkIHVwIHRoZSBkeW5hbWljIGxpc3QgZmlyc3QgLSBodG1sIGFuZCBsaXN0ZW5lcnMgKi8KCQkJCQkkKCdzcGFuOmVxKDApJywgbk5vZGUpCgkJCQkJCS5odG1sKCBzTGlzdCApCgkJCQkJCS5jaGlsZHJlbignYScpLmVhY2goIGZuQmluZCApOwoJCQkJCQoJCQkJCS8qIFVwZGF0ZSB0aGUgcGVybWFuZW50IGJ1dHRvbidzIGNsYXNzZXMgKi8KCQkJCQlhbkJ1dHRvbnMgPSBuTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpOwoJCQkJCWFuU3RhdGljID0gWwoJCQkJCQlhbkJ1dHRvbnNbMF0sIGFuQnV0dG9uc1sxXSwgCgkJCQkJCWFuQnV0dG9uc1thbkJ1dHRvbnMubGVuZ3RoLTJdLCBhbkJ1dHRvbnNbYW5CdXR0b25zLmxlbmd0aC0xXQoJCQkJCV07CgkKCQkJCQkkKGFuU3RhdGljKS5yZW1vdmVDbGFzcyggb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlQnV0dG9uQWN0aXZlKyIgIitvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkICk7CgkJCQkJJChbYW5TdGF0aWNbMF0sIGFuU3RhdGljWzFdXSkuYWRkQ2xhc3MoIAoJCQkJCQkoaUN1cnJlbnRQYWdlPT0xKSA/CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIDoKCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uCgkJCQkJKTsKCQkJCQkkKFthblN0YXRpY1syXSwgYW5TdGF0aWNbM11dKS5hZGRDbGFzcygKCQkJCQkJKGlQYWdlcz09PTAgfHwgaUN1cnJlbnRQYWdlPT09aVBhZ2VzIHx8IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg9PT0tMSkgPwoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VCdXR0b25TdGF0aWNEaXNhYmxlZCA6CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvbgoJCQkJCSk7CgkJCQl9CgkJCX0KCQl9Cgl9ICk7CgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9Tb3J0LCB7CgkJLyoKCQkgKiB0ZXh0IHNvcnRpbmcKCQkgKi8KCQkic3RyaW5nLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQlpZiAoIHR5cGVvZiBhICE9ICdzdHJpbmcnICkgewoJCQkJYSA9IChhICE9PSBudWxsICYmIGEudG9TdHJpbmcpID8gYS50b1N0cmluZygpIDogJyc7CgkJCX0KCQkJcmV0dXJuIGEudG9Mb3dlckNhc2UoKTsKCQl9LAoJCgkJInN0cmluZy1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJfSwKCQkKCQkic3RyaW5nLWRlc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIGh0bWwgc29ydGluZyAoaWdub3JlIGh0bWwgdGFncykKCQkgKi8KCQkiaHRtbC1wcmUiOiBmdW5jdGlvbiAoIGEgKQoJCXsKCQkJcmV0dXJuIGEucmVwbGFjZSggLzwuKj8+L2csICIiICkudG9Mb3dlckNhc2UoKTsKCQl9LAoJCQoJCSJodG1sLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQl9LAoJCQoJCSJodG1sLWRlc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIGRhdGUgc29ydGluZwoJCSAqLwoJCSJkYXRlLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQl2YXIgeCA9IERhdGUucGFyc2UoIGEgKTsKCQkJCgkJCWlmICggaXNOYU4oeCkgfHwgeD09PSIiICkKCQkJewoJCQkJeCA9IERhdGUucGFyc2UoICIwMS8wMS8xOTcwIDAwOjAwOjAwIiApOwoJCQl9CgkJCXJldHVybiB4OwoJCX0sCgkKCQkiZGF0ZS1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuIHggLSB5OwoJCX0sCgkJCgkJImRhdGUtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geSAtIHg7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIG51bWVyaWNhbCBzb3J0aW5nCgkJICovCgkJIm51bWVyaWMtcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCXJldHVybiAoYT09Ii0iIHx8IGE9PT0iIikgPyAwIDogYSoxOwoJCX0sCgkKCQkibnVtZXJpYy1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuIHggLSB5OwoJCX0sCgkJCgkJIm51bWVyaWMtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geSAtIHg7CgkJfQoJfSApOwoJCgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0LmFUeXBlcywgWwoJCS8qCgkJICogRnVuY3Rpb246IC0KCQkgKiBQdXJwb3NlOiAgQ2hlY2sgdG8gc2VlIGlmIGEgc3RyaW5nIGlzIG51bWVyaWMKCQkgKiBSZXR1cm5zOiAgc3RyaW5nOidudW1lcmljJyBvciBudWxsCgkJICogSW5wdXRzOiAgIG1peGVkOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQkvKiBBbGxvdyB6ZXJvIGxlbmd0aCBzdHJpbmdzIGFzIGEgbnVtYmVyICovCgkJCWlmICggdHlwZW9mIHNEYXRhID09PSAnbnVtYmVyJyApCgkJCXsKCQkJCXJldHVybiAnbnVtZXJpYyc7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSAhPT0gJ3N0cmluZycgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJdmFyIHNWYWxpZEZpcnN0Q2hhcnMgPSAiMDEyMzQ1Njc4OS0iOwoJCQl2YXIgc1ZhbGlkQ2hhcnMgPSAiMDEyMzQ1Njc4OS4iOwoJCQl2YXIgQ2hhcjsKCQkJdmFyIGJEZWNpbWFsID0gZmFsc2U7CgkJCQoJCQkvKiBDaGVjayBmb3IgYSB2YWxpZCBmaXJzdCBjaGFyIChubyBwZXJpb2QgYW5kIGFsbG93IG5lZ2F0aXZlcykgKi8KCQkJQ2hhciA9IHNEYXRhLmNoYXJBdCgwKTsgCgkJCWlmIChzVmFsaWRGaXJzdENoYXJzLmluZGV4T2YoQ2hhcikgPT0gLTEpIAoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgYWxsIHRoZSBvdGhlciBjaGFyYWN0ZXJzIGFyZSB2YWxpZCAqLwoJCQlmb3IgKCB2YXIgaT0xIDsgaTxzRGF0YS5sZW5ndGggOyBpKysgKSAKCQkJewoJCQkJQ2hhciA9IHNEYXRhLmNoYXJBdChpKTsgCgkJCQlpZiAoc1ZhbGlkQ2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgCgkJCQl7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgkJCQkKCQkJCS8qIE9ubHkgYWxsb3dlZCBvbmUgZGVjaW1hbCBwbGFjZS4uLiAqLwoJCQkJaWYgKCBDaGFyID09ICIuIiApCgkJCQl7CgkJCQkJaWYgKCBiRGVjaW1hbCApCgkJCQkJewoJCQkJCQlyZXR1cm4gbnVsbDsKCQkJCQl9CgkJCQkJYkRlY2ltYWwgPSB0cnVlOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gJ251bWVyaWMnOwoJCX0sCgkJCgkJLyoKCQkgKiBGdW5jdGlvbjogLQoJCSAqIFB1cnBvc2U6ICBDaGVjayB0byBzZWUgaWYgYSBzdHJpbmcgaXMgYWN0dWFsbHkgYSBmb3JtYXR0ZWQgZGF0ZQoJCSAqIFJldHVybnM6ICBzdHJpbmc6J2RhdGUnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgc3RyaW5nOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQl2YXIgaVBhcnNlID0gRGF0ZS5wYXJzZShzRGF0YSk7CgkJCWlmICggKGlQYXJzZSAhPT0gbnVsbCAmJiAhaXNOYU4oaVBhcnNlKSkgfHwgKHR5cGVvZiBzRGF0YSA9PT0gJ3N0cmluZycgJiYgc0RhdGEubGVuZ3RoID09PSAwKSApCgkJCXsKCQkJCXJldHVybiAnZGF0ZSc7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfSwKCQkKCQkvKgoJCSAqIEZ1bmN0aW9uOiAtCgkJICogUHVycG9zZTogIENoZWNrIHRvIHNlZSBpZiBhIHN0cmluZyBzaG91bGQgYmUgdHJlYXRlZCBhcyBhbiBIVE1MIHN0cmluZwoJCSAqIFJldHVybnM6ICBzdHJpbmc6J2h0bWwnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgc3RyaW5nOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQlpZiAoIHR5cGVvZiBzRGF0YSA9PT0gJ3N0cmluZycgJiYgc0RhdGEuaW5kZXhPZignPCcpICE9IC0xICYmIHNEYXRhLmluZGV4T2YoJz4nKSAhPSAtMSApCgkJCXsKCQkJCXJldHVybiAnaHRtbCc7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoJXSApOwoJCgoJLy8galF1ZXJ5IGFsaWFzZXMKCSQuZm4uRGF0YVRhYmxlID0gRGF0YVRhYmxlOwoJJC5mbi5kYXRhVGFibGUgPSBEYXRhVGFibGU7CgkkLmZuLmRhdGFUYWJsZVNldHRpbmdzID0gRGF0YVRhYmxlLnNldHRpbmdzOwoJJC5mbi5kYXRhVGFibGVFeHQgPSBEYXRhVGFibGUuZXh0OwoKCgkvLyBJbmZvcm1hdGlvbiBhYm91dCBldmVudHMgZmlyZWQgYnkgRGF0YVRhYmxlcyAtIGZvciBkb2N1bWVudGF0aW9uLgoJLyoqCgkgKiBEcmF3IGV2ZW50LCBmaXJlZCB3aGVuZXZlciB0aGUgdGFibGUgaXMgcmVkcmF3biBvbiB0aGUgcGFnZSwgYXQgdGhlIHNhbWUgcG9pbnQgYXMKCSAqIGZuRHJhd0NhbGxiYWNrLiBUaGlzIG1heSBiZSB1c2VmdWwgZm9yIGJpbmRpbmcgZXZlbnRzIG9yIHBlcmZvcm1pbmcgY2FsY3VsYXRpb25zIHdoZW4KCSAqIHRoZSB0YWJsZSBpcyBhbHRlcmVkIGF0IGFsbC4KCSAqICBAbmFtZSBEYXRhVGFibGUjZHJhdwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogRmlsdGVyIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSBmaWx0ZXJpbmcgYXBwbGllZCB0byB0aGUgdGFibGUgKHVzaW5nIHRoZSBidWlsZCBpbiBnbG9iYWwKCSAqIGdsb2JhbCBmaWx0ZXIsIG9yIGNvbHVtbiBmaWx0ZXJzKSBpcyBhbHRlcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNmaWx0ZXIKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIFBhZ2UgY2hhbmdlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSBwYWdpbmcgb2YgdGhlIHRhYmxlIGlzIGFsdGVyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3BhZ2UKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIFNvcnQgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHNvcnRpbmcgYXBwbGllZCB0byB0aGUgdGFibGUgaXMgYWx0ZXJlZC4KCSAqICBAbmFtZSBEYXRhVGFibGUjc29ydAoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogRGF0YVRhYmxlcyBpbml0aWFsaXNhdGlvbiBjb21wbGV0ZSBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaXMgZnVsbHkgZHJhd24sCgkgKiBpbmNsdWRpbmcgQWpheCBkYXRhIGxvYWRlZCwgaWYgQWpheCBkYXRhIGlzIHJlcXVpcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNpbml0CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBKU09OIG9iamVjdCByZXF1ZXN0IGZyb20gdGhlIHNlcnZlciAtIG9ubHkKCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZDwvbGk+PC9vbD4KCSAqLwoKCS8qKgoJICogU3RhdGUgc2F2ZSBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaGFzIGNoYW5nZWQgc3RhdGUgYSBuZXcgc3RhdGUgc2F2ZSBpcyByZXF1aXJlZC4KCSAqIFRoaXMgbWV0aG9kIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHN0YXRlIHNhdmluZyBvYmplY3QgcHJpb3IgdG8gYWN0dWFsbHkgZG9pbmcgdGhlCgkgKiBzYXZlLCBpbmNsdWRpbmcgYWRkaXRpb24gb3Igb3RoZXIgc3RhdGUgcHJvcGVydGllcyAoZm9yIHBsdWctaW5zKSBvciBtb2RpZmljYXRpb24KCSAqIG9mIGEgRGF0YVRhYmxlcyBjb3JlIHByb3BlcnR5LgoJICogIEBuYW1lIERhdGFUYWJsZSNzdGF0ZVNhdmVQYXJhbXMKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIHN0YXRlIGluZm9ybWF0aW9uIHRvIGJlIHNhdmVkCgkgKi8KCgkvKioKCSAqIFN0YXRlIGxvYWQgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHRhYmxlIGlzIGxvYWRpbmcgc3RhdGUgZnJvbSB0aGUgc3RvcmVkIGRhdGEsIGJ1dAoJICogcHJpb3IgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBiZWluZyBtb2RpZmllZCBieSB0aGUgc2F2ZWQgc3RhdGUgLSBhbGxvd2luZyBtb2RpZmljYXRpb24KCSAqIG9mIHRoZSBzYXZlZCBzdGF0ZSBpcyByZXF1aXJlZCBvciBsb2FkaW5nIG9mIHN0YXRlIGZvciBhIHBsdWctaW4uCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlTG9hZFBhcmFtcwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBUaGUgc2F2ZWQgc3RhdGUgaW5mb3JtYXRpb24KCSAqLwoKCS8qKgoJICogU3RhdGUgbG9hZGVkIGV2ZW50LCBmaXJlZCB3aGVuIHN0YXRlIGhhcyBiZWVuIGxvYWRlZCBmcm9tIHN0b3JlZCBkYXRhIGFuZCB0aGUgc2V0dGluZ3MKCSAqIG9iamVjdCBoYXMgYmVlbiBtb2RpZmllZCBieSB0aGUgbG9hZGVkIGRhdGEuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlTG9hZGVkCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBzYXZlZCBzdGF0ZSBpbmZvcm1hdGlvbgoJICovCgoJLyoqCgkgKiBQcm9jZXNzaW5nIGV2ZW50LCBmaXJlZCB3aGVuIERhdGFUYWJsZXMgaXMgZG9pbmcgc29tZSBraW5kIG9mIHByb2Nlc3NpbmcgKGJlIGl0LAoJICogc29ydCwgZmlsdGVyIG9yIGFueXRoaW5nIGVsc2UpLiBDYW4gYmUgdXNlZCB0byBpbmRpY2F0ZSB0byB0aGUgZW5kIHVzZXIgdGhhdAoJICogdGhlcmUgaXMgc29tZXRoaW5nIGhhcHBlbmluZywgb3IgdGhhdCBzb21ldGhpbmcgaGFzIGZpbmlzaGVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNwcm9jZXNzaW5nCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7Ym9vbGVhbn0gYlNob3cgRmxhZyBmb3IgaWYgRGF0YVRhYmxlcyBpcyBkb2luZyBwcm9jZXNzaW5nIG9yIG5vdAoJICovCgoJLyoqCgkgKiBBamF4IChYSFIpIGV2ZW50LCBmaXJlZCB3aGVuZXZlciBhbiBBamF4IHJlcXVlc3QgaXMgY29tcGxldGVkIGZyb20gYSByZXF1ZXN0IHRvIAoJICogbWFkZSB0byB0aGUgc2VydmVyIGZvciBuZXcgZGF0YSAobm90ZSB0aGF0IHRoaXMgdHJpZ2dlciBpcyBjYWxsZWQgaW4gZm5TZXJ2ZXJEYXRhLAoJICogaWYgeW91IG92ZXJyaWRlIGZuU2VydmVyRGF0YSBhbmQgd2hpY2ggdG8gdXNlIHRoaXMgZXZlbnQsIHlvdSBuZWVkIHRvIHRyaWdnZXIgaXQgaW4KCSAqIHlvdSBzdWNjZXNzIGZ1bmN0aW9uKS4KCSAqICBAbmFtZSBEYXRhVGFibGUjeGhyCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIEpTT04gcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyCgkgKi8KCgkvKioKCSAqIERlc3Ryb3kgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIERhdGFUYWJsZSBpcyBkZXN0cm95ZWQgYnkgY2FsbGluZyBmbkRlc3Ryb3kgb3IgcGFzc2luZwoJICogdGhlIGJEZXN0cm95OnRydWUgcGFyYW1ldGVyIGluIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QuIFRoaXMgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlCgkgKiBib3VuZCBldmVudHMsIGFkZGVkIERPTSBub2RlcywgZXRjLgoJICogIEBuYW1lIERhdGFUYWJsZSNkZXN0cm95CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCn0pKTsKCn0od2luZG93LCBkb2N1bWVudCkpOwoK",
                "body": "LyoqCiAqIEBzdW1tYXJ5ICAgICBEYXRhVGFibGVzCiAqIEBkZXNjcmlwdGlvbiBQYWdpbmF0ZSwgc2VhcmNoIGFuZCBzb3J0IEhUTUwgdGFibGVzCiAqIEB2ZXJzaW9uICAgICAxLjkuNAogKiBAZmlsZSAgICAgICAganF1ZXJ5LmRhdGFUYWJsZXMuanMKICogQGF1dGhvciAgICAgIEFsbGFuIEphcmRpbmUgKHd3dy5zcHJ5bWVkaWEuY28udWspCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QKICoKICogQGNvcHlyaWdodCBDb3B5cmlnaHQgMjAwOC0yMDEyIEFsbGFuIEphcmRpbmUsIGFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZnJlZSBzb2Z0d2FyZSwgdW5kZXIgZWl0aGVyIHRoZSBHUEwgdjIgbGljZW5zZSBvciBhCiAqIEJTRCBzdHlsZSBsaWNlbnNlLCBhdmFpbGFibGUgYXQ6CiAqICAgaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2VfZ3BsMgogKiAgIGh0dHA6Ly9kYXRhdGFibGVzLm5ldC9saWNlbnNlX2JzZAogKiAKICogVGhpcyBzb3VyY2UgZmlsZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIAogKiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLgogKiAKICogRm9yIGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvOiBodHRwOi8vd3d3LmRhdGF0YWJsZXMubmV0CiAqLwoKLypqc2xpbnQgZXZpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIGJyb3dzZXI6IHRydWUgKi8KLypnbG9iYWxzICQsIGpRdWVyeSxkZWZpbmUsX2ZuRXh0ZXJuQXBpRnVuYyxfZm5Jbml0aWFsaXNlLF9mbkluaXRDb21wbGV0ZSxfZm5MYW5ndWFnZUNvbXBhdCxfZm5BZGRDb2x1bW4sX2ZuQ29sdW1uT3B0aW9ucyxfZm5BZGREYXRhLF9mbkNyZWF0ZVRyLF9mbkdhdGhlckRhdGEsX2ZuQnVpbGRIZWFkLF9mbkRyYXdIZWFkLF9mbkRyYXcsX2ZuUmVEcmF3LF9mbkFqYXhVcGRhdGUsX2ZuQWpheFBhcmFtZXRlcnMsX2ZuQWpheFVwZGF0ZURyYXcsX2ZuU2VydmVyUGFyYW1zLF9mbkFkZE9wdGlvbnNIdG1sLF9mbkZlYXR1cmVIdG1sVGFibGUsX2ZuU2Nyb2xsRHJhdyxfZm5BZGp1c3RDb2x1bW5TaXppbmcsX2ZuRmVhdHVyZUh0bWxGaWx0ZXIsX2ZuRmlsdGVyQ29tcGxldGUsX2ZuRmlsdGVyQ3VzdG9tLF9mbkZpbHRlckNvbHVtbixfZm5GaWx0ZXIsX2ZuQnVpbGRTZWFyY2hBcnJheSxfZm5CdWlsZFNlYXJjaFJvdyxfZm5GaWx0ZXJDcmVhdGVTZWFyY2gsX2ZuRGF0YVRvU2VhcmNoLF9mblNvcnQsX2ZuU29ydEF0dGFjaExpc3RlbmVyLF9mblNvcnRpbmdDbGFzc2VzLF9mbkZlYXR1cmVIdG1sUGFnaW5hdGUsX2ZuUGFnZUNoYW5nZSxfZm5GZWF0dXJlSHRtbEluZm8sX2ZuVXBkYXRlSW5mbyxfZm5GZWF0dXJlSHRtbExlbmd0aCxfZm5GZWF0dXJlSHRtbFByb2Nlc3NpbmcsX2ZuUHJvY2Vzc2luZ0Rpc3BsYXksX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgsX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUsX2ZuTm9kZVRvRGF0YUluZGV4LF9mblZpc2JsZUNvbHVtbnMsX2ZuQ2FsY3VsYXRlRW5kLF9mbkNvbnZlcnRUb1dpZHRoLF9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyxfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCxfZm5HZXRXaWRlc3ROb2RlLF9mbkdldE1heExlblN0cmluZyxfZm5TdHJpbmdUb0NzcyxfZm5EZXRlY3RUeXBlLF9mblNldHRpbmdzRnJvbU5vZGUsX2ZuR2V0RGF0YU1hc3RlcixfZm5HZXRUck5vZGVzLF9mbkdldFRkTm9kZXMsX2ZuRXNjYXBlUmVnZXgsX2ZuRGVsZXRlSW5kZXgsX2ZuUmVPcmRlckluZGV4LF9mbkNvbHVtbk9yZGVyaW5nLF9mbkxvZyxfZm5DbGVhclRhYmxlLF9mblNhdmVTdGF0ZSxfZm5Mb2FkU3RhdGUsX2ZuQ3JlYXRlQ29va2llLF9mblJlYWRDb29raWUsX2ZuRGV0ZWN0SGVhZGVyLF9mbkdldFVuaXF1ZVRocyxfZm5TY3JvbGxCYXJXaWR0aCxfZm5BcHBseVRvQ2hpbGRyZW4sX2ZuTWFwLF9mbkdldFJvd0RhdGEsX2ZuR2V0Q2VsbERhdGEsX2ZuU2V0Q2VsbERhdGEsX2ZuR2V0T2JqZWN0RGF0YUZuLF9mblNldE9iamVjdERhdGFGbixfZm5BcHBseUNvbHVtbkRlZnMsX2ZuQmluZEFjdGlvbixfZm5DYWxsYmFja1JlZyxfZm5DYWxsYmFja0ZpcmUsX2ZuSnNvblN0cmluZyxfZm5SZW5kZXIsX2ZuTm9kZVRvQ29sdW1uSW5kZXgsX2ZuSW5mb01hY3JvcyxfZm5Ccm93c2VyRGV0ZWN0LF9mbkdldENvbHVtbnMqLwoKKC8qKiBAbGVuZHMgPGdsb2JhbD4gKi9mdW5jdGlvbiggd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkICkgewoKKGZ1bmN0aW9uKCBmYWN0b3J5ICkgewoJInVzZSBzdHJpY3QiOwoKCS8vIERlZmluZSBhcyBhbiBBTUQgbW9kdWxlIGlmIHBvc3NpYmxlCglpZiAoIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCApCgl7CgkJZGVmaW5lKCBbJ2pxdWVyeSddLCBmYWN0b3J5ICk7Cgl9CgkvKiBEZWZpbmUgdXNpbmcgYnJvd3NlciBnbG9iYWxzIG90aGVyd2lzZQoJICogUHJldmVudCBtdWx0aXBsZSBpbnN0YW50aWF0aW9ucyBpZiB0aGUgc2NyaXB0IGlzIGxvYWRlZCB0d2ljZQoJICovCgllbHNlIGlmICggalF1ZXJ5ICYmICFqUXVlcnkuZm4uZGF0YVRhYmxlICkKCXsKCQlmYWN0b3J5KCBqUXVlcnkgKTsKCX0KfQooLyoqIEBsZW5kcyA8Z2xvYmFsPiAqL2Z1bmN0aW9uKCAkICkgewoJInVzZSBzdHJpY3QiOwoJLyoqIAoJICogRGF0YVRhYmxlcyBpcyBhIHBsdWctaW4gZm9yIHRoZSBqUXVlcnkgSmF2YXNjcmlwdCBsaWJyYXJ5LiBJdCBpcyBhIAoJICogaGlnaGx5IGZsZXhpYmxlIHRvb2wsIGJhc2VkIHVwb24gdGhlIGZvdW5kYXRpb25zIG9mIHByb2dyZXNzaXZlIAoJICogZW5oYW5jZW1lbnQsIHdoaWNoIHdpbGwgYWRkIGFkdmFuY2VkIGludGVyYWN0aW9uIGNvbnRyb2xzIHRvIGFueSAKCSAqIEhUTUwgdGFibGUuIEZvciBhIGZ1bGwgbGlzdCBvZiBmZWF0dXJlcyBwbGVhc2UgcmVmZXIgdG8KCSAqIDxhIGhyZWY9Imh0dHA6Ly9kYXRhdGFibGVzLm5ldCI+RGF0YVRhYmxlcy5uZXQ8L2E+LgoJICoKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlPC9pPiBvYmplY3QgaXMgbm90IGEgZ2xvYmFsIHZhcmlhYmxlIGJ1dCBpcwoJICogYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uRGF0YVRhYmxlPC9pPiBhbmQgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZTwvaT4gdGhyb3VnaCB3aGljaCAKCSAqIGl0IG1heSBiZSAgYWNjZXNzZWQuCgkgKgoJICogIEBjbGFzcwoJICogIEBwYXJhbSB7b2JqZWN0fSBbb0luaXQ9e31dIENvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciBEYXRhVGFibGVzLiBPcHRpb25zCgkgKiAgICBhcmUgZGVmaW5lZCBieSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfQoJICogIEByZXF1aXJlcyBqUXVlcnkgMS4zKwoJICogCgkgKiAgQGV4YW1wbGUKCSAqICAgIC8vIEJhc2ljIGluaXRpYWxpc2F0aW9uCgkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gewoJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJICogICAgfSApOwoJICogIAoJICogIEBleGFtcGxlCgkgKiAgICAvLyBJbml0aWFsaXNhdGlvbiB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyAtIGluIHRoaXMgY2FzZSwgZGlzYWJsZQoJICogICAgLy8gcGFnaW5hdGlvbiBhbmQgc29ydGluZy4KCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiB7CgkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlLAoJICogICAgICAgICJiU29ydCI6IGZhbHNlIAoJICogICAgICB9ICk7CgkgKiAgICB9ICk7CgkgKi8KCXZhciBEYXRhVGFibGUgPSBmdW5jdGlvbiggb0luaXQgKQoJewoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhIGNvbHVtbiB0byB0aGUgbGlzdCB1c2VkIGZvciB0aGUgdGFibGUgd2l0aCBkZWZhdWx0IHZhbHVlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gblRoIFRoZSB0aCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncywgblRoICkKCQl7CgkJCXZhciBvRGVmYXVsdHMgPSBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uczsKCQkJdmFyIGlDb2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9Db2wgPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiwgb0RlZmF1bHRzLCB7CgkJCQkic1NvcnRpbmdDbGFzcyI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQkic1NvcnRpbmdDbGFzc0pVSSI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSSwKCQkJCSJuVGgiOiBuVGggPyBuVGggOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpLAoJCQkJInNUaXRsZSI6ICAgIG9EZWZhdWx0cy5zVGl0bGUgICAgPyBvRGVmYXVsdHMuc1RpdGxlICAgIDogblRoID8gblRoLmlubmVySFRNTCA6ICcnLAoJCQkJImFEYXRhU29ydCI6IG9EZWZhdWx0cy5hRGF0YVNvcnQgPyBvRGVmYXVsdHMuYURhdGFTb3J0IDogW2lDb2xdLAoJCQkJIm1EYXRhIjogb0RlZmF1bHRzLm1EYXRhID8gb0RlZmF1bHRzLm9EZWZhdWx0cyA6IGlDb2wKCQkJfSApOwoJCQlvU2V0dGluZ3MuYW9Db2x1bW5zLnB1c2goIG9Db2wgKTsKCQkJCgkJCS8qIEFkZCBhIGNvbHVtbiBzcGVjaWZpYyBmaWx0ZXIgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPT09IHVuZGVmaW5lZCB8fCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPT09IG51bGwgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJdmFyIG9QcmUgPSBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF07CgkJCQkKCQkJCS8qIERvbid0IHJlcXVpcmUgdGhhdCB0aGUgdXNlciBtdXN0IHNwZWNpZnkgYlJlZ2V4LCBiU21hcnQgb3IgYkNhc2VJbnNlbnNpdGl2ZSAqLwoJCQkJaWYgKCBvUHJlLmJSZWdleCA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJSZWdleCA9IHRydWU7CgkJCQl9CgkJCQkKCQkJCWlmICggb1ByZS5iU21hcnQgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1ByZS5iU21hcnQgPSB0cnVlOwoJCQkJfQoJCQkJCgkJCQlpZiAoIG9QcmUuYkNhc2VJbnNlbnNpdGl2ZSA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJDYXNlSW5zZW5zaXRpdmUgPSB0cnVlOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBVc2UgdGhlIGNvbHVtbiBvcHRpb25zIGZ1bmN0aW9uIHRvIGluaXRpYWxpc2UgY2xhc3NlcyBldGMgKi8KCQkJX2ZuQ29sdW1uT3B0aW9ucyggb1NldHRpbmdzLCBpQ29sLCBudWxsICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFwcGx5IG9wdGlvbnMgZm9yIGEgY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgY29sdW1uIGluZGV4IHRvIGNvbnNpZGVyCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvT3B0aW9ucyBvYmplY3Qgd2l0aCBzVHlwZSwgYlZpc2libGUgYW5kIGJTZWFyY2hhYmxlIGV0YwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG9PcHRpb25zICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbCBdOwoJCQkKCQkJLyogVXNlciBzcGVjaWZpZWQgY29sdW1uIG9wdGlvbnMgKi8KCQkJaWYgKCBvT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIG9PcHRpb25zICE9PSBudWxsICkKCQkJewoJCQkJLyogQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZm9yIG1EYXRhUHJvcCAqLwoJCQkJaWYgKCBvT3B0aW9ucy5tRGF0YVByb3AgJiYgIW9PcHRpb25zLm1EYXRhICkKCQkJCXsKCQkJCQlvT3B0aW9ucy5tRGF0YSA9IG9PcHRpb25zLm1EYXRhUHJvcDsKCQkJCX0KCQkKCQkJCWlmICggb09wdGlvbnMuc1R5cGUgIT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb0NvbC5zVHlwZSA9IG9PcHRpb25zLnNUeXBlOwoJCQkJCW9Db2wuX2JBdXRvVHlwZSA9IGZhbHNlOwoJCQkJfQoJCQkJCgkJCQkkLmV4dGVuZCggb0NvbCwgb09wdGlvbnMgKTsKCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJzV2lkdGgiLCAic1dpZHRoT3JpZyIgKTsKCQkKCQkJCS8qIGlEYXRhU29ydCB0byBiZSBhcHBsaWVkIChiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSksIGJ1dCBhRGF0YVNvcnQgd2lsbCB0YWtlCgkJCQkgKiBwcmlvcml0eSBpZiBkZWZpbmVkCgkJCQkgKi8KCQkJCWlmICggb09wdGlvbnMuaURhdGFTb3J0ICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9Db2wuYURhdGFTb3J0ID0gWyBvT3B0aW9ucy5pRGF0YVNvcnQgXTsKCQkJCX0KCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJhRGF0YVNvcnQiICk7CgkJCX0KCQkKCQkJLyogQ2FjaGUgdGhlIGRhdGEgZ2V0IGFuZCBzZXQgZnVuY3Rpb25zIGZvciBzcGVlZCAqLwoJCQl2YXIgbVJlbmRlciA9IG9Db2wubVJlbmRlciA/IF9mbkdldE9iamVjdERhdGFGbiggb0NvbC5tUmVuZGVyICkgOiBudWxsOwoJCQl2YXIgbURhdGEgPSBfZm5HZXRPYmplY3REYXRhRm4oIG9Db2wubURhdGEgKTsKCQkKCQkJb0NvbC5mbkdldERhdGEgPSBmdW5jdGlvbiAob0RhdGEsIHNTcGVjaWZpYykgewoJCQkJdmFyIGlubmVyRGF0YSA9IG1EYXRhKCBvRGF0YSwgc1NwZWNpZmljICk7CgkJCgkJCQlpZiAoIG9Db2wubVJlbmRlciAmJiAoc1NwZWNpZmljICYmIHNTcGVjaWZpYyAhPT0gJycpICkKCQkJCXsKCQkJCQlyZXR1cm4gbVJlbmRlciggaW5uZXJEYXRhLCBzU3BlY2lmaWMsIG9EYXRhICk7CgkJCQl9CgkJCQlyZXR1cm4gaW5uZXJEYXRhOwoJCQl9OwoJCQlvQ29sLmZuU2V0RGF0YSA9IF9mblNldE9iamVjdERhdGFGbiggb0NvbC5tRGF0YSApOwoJCQkKCQkJLyogRmVhdHVyZSBzb3J0aW5nIG92ZXJyaWRlcyBjb2x1bW4gc3BlY2lmaWMgd2hlbiBvZmYgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCW9Db2wuYlNvcnRhYmxlID0gZmFsc2U7CgkJCX0KCQkJCgkJCS8qIENoZWNrIHRoYXQgdGhlIGNsYXNzIGFzc2lnbm1lbnQgaXMgY29ycmVjdCBmb3Igc29ydGluZyAqLwoJCQlpZiAoICFvQ29sLmJTb3J0YWJsZSB8fAoJCQkJICgkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEpICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZU5vbmU7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSAiIjsKCQkJfQoJCQllbHNlIGlmICggJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZTsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSTsKCQkJfQoJCQllbHNlIGlmICggJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgIT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZUFzYzsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSUFzY0FsbG93ZWQ7CgkJCX0KCQkJZWxzZSBpZiAoICQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSAhPSAtMSApCgkJCXsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVEZXNjOwoJCQkJb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQ7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQWRqdXN0IHRoZSB0YWJsZSBjb2x1bW4gd2lkdGhzIGZvciBuZXcgZGF0YS4gTm90ZTogeW91IHdvdWxkIHByb2JhYmx5IHdhbnQgdG8gCgkJICogZG8gYSByZWRyYXcgYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uIQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkanVzdENvbHVtblNpemluZyAoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBOb3QgaW50ZXJlc3RlZCBpbiBkb2luZyBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaWYgYXV0by13aWR0aCBpcyBkaXNhYmxlZCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCA9PT0gZmFsc2UgKQoJCQl7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJCgkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCWZvciAoIHZhciBpPTAgLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGguc3R5bGUud2lkdGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDb3ZlcnQgdGhlIGluZGV4IG9mIGEgdmlzaWJsZSBjb2x1bW4gdG8gdGhlIGluZGV4IGluIHRoZSBkYXRhIGFycmF5ICh0YWtlIGFjY291bnQKCQkgKiBvZiBoaWRkZW4gY29sdW1ucykKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaU1hdGNoIFZpc2libGUgY29sdW1uIGluZGV4IHRvIGxvb2t1cAoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBkYXRhIGluZGV4CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblZpc2libGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlNYXRjaCApCgkJewoJCQl2YXIgYWlWaXMgPSBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiVmlzaWJsZScgKTsKCQkKCQkJcmV0dXJuIHR5cGVvZiBhaVZpc1tpTWF0Y2hdID09PSAnbnVtYmVyJyA/CgkJCQlhaVZpc1tpTWF0Y2hdIDoKCQkJCW51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvdmVydCB0aGUgaW5kZXggb2YgYW4gaW5kZXggaW4gdGhlIGRhdGEgYXJyYXkgYW5kIGNvbnZlcnQgaXQgdG8gdGhlIHZpc2libGUKCQkgKiAgIGNvbHVtbiBpbmRleCAodGFrZSBhY2NvdW50IG9mIGhpZGRlbiBjb2x1bW5zKQoJCSAqICBAcGFyYW0ge2ludH0gaU1hdGNoIENvbHVtbiBpbmRleCB0byBsb29rdXAKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBkYXRhIGluZGV4CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKCBvU2V0dGluZ3MsIGlNYXRjaCApCgkJewoJCQl2YXIgYWlWaXMgPSBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiVmlzaWJsZScgKTsKCQkJdmFyIGlQb3MgPSAkLmluQXJyYXkoIGlNYXRjaCwgYWlWaXMgKTsKCQkKCQkJcmV0dXJuIGlQb3MgIT09IC0xID8gaVBvcyA6IG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbnVtYmVyIG9mIHZpc2libGUgY29sdW1ucwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIG51bWJlciBvZiB2aXNpYmxlIGNvbHVtbnMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICkKCQl7CgkJCXJldHVybiBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiVmlzaWJsZScgKS5sZW5ndGg7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiBjb2x1bW4gaW5kZXhlcyB0aGF0IG1hdGNoIGEgZ2l2ZW4gcHJvcGVydHkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1BhcmFtIFBhcmFtZXRlciBpbiBhb0NvbHVtbnMgdG8gbG9vayBmb3IgLSB0eXBpY2FsbHkgCgkJICogICAgYlZpc2libGUgb3IgYlNlYXJjaGFibGUKCQkgKiAgQHJldHVybnMge2FycmF5fSBBcnJheSBvZiBpbmRleGVzIHdpdGggbWF0Y2hlZCBwcm9wZXJ0aWVzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgc1BhcmFtICkKCQl7CgkJCXZhciBhID0gW107CgkJCgkJCSQubWFwKCBvU2V0dGluZ3MuYW9Db2x1bW5zLCBmdW5jdGlvbih2YWwsIGkpIHsKCQkJCWlmICggdmFsW3NQYXJhbV0gKSB7CgkJCQkJYS5wdXNoKCBpICk7CgkJCQl9CgkJCX0gKTsKCQkKCQkJcmV0dXJuIGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgc29ydCB0eXBlIGJhc2VkIG9uIGFuIGlucHV0IHN0cmluZwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0RhdGEgZGF0YSB3ZSB3aXNoIHRvIGtub3cgdGhlIHR5cGUgb2YKCQkgKiAgQHJldHVybnMge3N0cmluZ30gdHlwZSAoZGVmYXVsdHMgdG8gJ3N0cmluZycgaWYgbm8gdHlwZSBjYW4gYmUgZGV0ZWN0ZWQpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRldGVjdFR5cGUoIHNEYXRhICkKCQl7CgkJCXZhciBhVHlwZXMgPSBEYXRhVGFibGUuZXh0LmFUeXBlczsKCQkJdmFyIGlMZW4gPSBhVHlwZXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXZhciBzVHlwZSA9IGFUeXBlc1tpXSggc0RhdGEgKTsKCQkJCWlmICggc1R5cGUgIT09IG51bGwgKQoJCQkJewoJCQkJCXJldHVybiBzVHlwZTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuICdzdHJpbmcnOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWd1cmUgb3V0IGhvdyB0byByZW9yZGVyIGEgZGlzcGxheSBsaXN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMgYXJyYXkge2ludH0gYWlSZXR1cm4gaW5kZXggbGlzdCBmb3IgcmVvcmRlcmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZU9yZGVySW5kZXggKCBvU2V0dGluZ3MsIHNDb2x1bW5zICkKCQl7CgkJCXZhciBhQ29sdW1ucyA9IHNDb2x1bW5zLnNwbGl0KCcsJyk7CgkJCXZhciBhaVJldHVybiA9IFtdOwoJCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAgOyBqPGlMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zTmFtZSA9PSBhQ29sdW1uc1tqXSApCgkJCQkJewoJCQkJCQlhaVJldHVybi5wdXNoKCBqICk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFpUmV0dXJuOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGNvbHVtbiBvcmRlcmluZyB0aGF0IERhdGFUYWJsZXMgZXhwZWN0cwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIG5hbWVzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbHVtbk9yZGVyaW5nICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBzTmFtZXMgPSAnJzsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXNOYW1lcyArPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNOYW1lKycsJzsKCQkJfQoJCQlpZiAoIHNOYW1lcy5sZW5ndGggPT0gaUxlbiApCgkJCXsKCQkJCXJldHVybiAiIjsKCQkJfQoJCQlyZXR1cm4gc05hbWVzLnNsaWNlKDAsIC0xKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSB0aGUgY29sdW1uIGRlZmluaXRpb25zIGFuZCBzdGF0aWMgY29sdW1ucyBhcnJheXMgYW5kIGNhbGN1bGF0ZSBob3cKCQkgKiB0aGV5IHJlbGF0ZSB0byBjb2x1bW4gaW5kZXhlcy4gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgdGhlbiBhcHBseSB0aGUKCQkgKiBkZWZpbml0aW9uIGZvdW5kIGZvciBhIGNvbHVtbiB0byBhIHN1aXRhYmxlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7YXJyYXl9IGFvQ29sRGVmcyBUaGUgYW9Db2x1bW5EZWZzIGFycmF5IHRoYXQgaXMgdG8gYmUgYXBwbGllZAoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0NvbHMgVGhlIGFvQ29sdW1ucyBhcnJheSB0aGF0IGRlZmluZXMgY29sdW1ucyBpbmRpdmlkdWFsbHkKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gQ2FsbGJhY2sgZnVuY3Rpb24gLSB0YWtlcyB0d28gcGFyYW1ldGVycywgdGhlIGNhbGN1bGF0ZWQKCQkgKiAgICBjb2x1bW4gaW5kZXggYW5kIHRoZSBkZWZpbml0aW9uIGZvciB0aGF0IGNvbHVtbi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQXBwbHlDb2x1bW5EZWZzKCBvU2V0dGluZ3MsIGFvQ29sRGVmcywgYW9Db2xzLCBmbiApCgkJewoJCQl2YXIgaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbjsKCQkKCQkJLy8gQ29sdW1uIGRlZmluaXRpb25zIHdpdGggYVRhcmdldHMKCQkJaWYgKCBhb0NvbERlZnMgKQoJCQl7CgkJCQkvKiBMb29wIG92ZXIgdGhlIGRlZmluaXRpb25zIGFycmF5IC0gbG9vcCBpbiByZXZlcnNlIHNvIGZpcnN0IGluc3RhbmNlIGhhcyBwcmlvcml0eSAqLwoJCQkJZm9yICggaT1hb0NvbERlZnMubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJCXsKCQkJCQkvKiBFYWNoIGRlZmluaXRpb24gY2FuIHRhcmdldCBtdWx0aXBsZSBjb2x1bW5zLCBhcyBpdCBpcyBhbiBhcnJheSAqLwoJCQkJCXZhciBhVGFyZ2V0cyA9IGFvQ29sRGVmc1tpXS5hVGFyZ2V0czsKCQkJCQlpZiAoICEkLmlzQXJyYXkoIGFUYXJnZXRzICkgKQoJCQkJCXsKCQkJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDEsICdhVGFyZ2V0cyBtdXN0IGJlIGFuIGFycmF5IG9mIHRhcmdldHMsIG5vdCBhICcrKHR5cGVvZiBhVGFyZ2V0cykgKTsKCQkJCQl9CgkJCgkJCQkJZm9yICggaj0wLCBqTGVuPWFUYXJnZXRzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIHR5cGVvZiBhVGFyZ2V0c1tqXSA9PT0gJ251bWJlcicgJiYgYVRhcmdldHNbal0gPj0gMCApCgkJCQkJCXsKCQkJCQkJCS8qIEFkZCBjb2x1bW5zIHRoYXQgd2UgZG9uJ3QgeWV0IGtub3cgYWJvdXQgKi8KCQkJCQkJCXdoaWxlKCBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA8PSBhVGFyZ2V0c1tqXSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuQWRkQ29sdW1uKCBvU2V0dGluZ3MgKTsKCQkJCQkJCX0KCQkKCQkJCQkJCS8qIEludGVnZXIsIGJhc2ljIGluZGV4ICovCgkJCQkJCQlmbiggYVRhcmdldHNbal0sIGFvQ29sRGVmc1tpXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdudW1iZXInICYmIGFUYXJnZXRzW2pdIDwgMCApCgkJCQkJCXsKCQkJCQkJCS8qIE5lZ2F0aXZlIGludGVnZXIsIHJpZ2h0IHRvIGxlZnQgY29sdW1uIGNvdW50aW5nICovCgkJCQkJCQlmbiggb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGgrYVRhcmdldHNbal0sIGFvQ29sRGVmc1tpXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdzdHJpbmcnICkKCQkJCQkJewoJCQkJCQkJLyogQ2xhc3MgbmFtZSBtYXRjaGluZyBvbiBUSCBlbGVtZW50ICovCgkJCQkJCQlmb3IgKCBrPTAsIGtMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQkJewoJCQkJCQkJCWlmICggYVRhcmdldHNbal0gPT0gIl9hbGwiIHx8CgkJCQkJCQkJICAgICAkKG9TZXR0aW5ncy5hb0NvbHVtbnNba10ublRoKS5oYXNDbGFzcyggYVRhcmdldHNbal0gKSApCgkJCQkJCQkJewoJCQkJCQkJCQlmbiggaywgYW9Db2xEZWZzW2ldICk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8vIFN0YXRpY2FsbHkgZGVmaW5lZCBjb2x1bW5zIGFycmF5CgkJCWlmICggYW9Db2xzICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFvQ29scy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWZuKCBpLCBhb0NvbHNbaV0gKTsKCQkJCX0KCQkJfQoJCX0KCQkKCQkvKioKCQkgKiBBZGQgYSBkYXRhIGFycmF5IHRvIHRoZSB0YWJsZSwgY3JlYXRpbmcgRE9NIG5vZGUgZXRjLiBUaGlzIGlzIHRoZSBwYXJhbGxlbCB0byAKCQkgKiBfZm5HYXRoZXJEYXRhLCBidXQgZm9yIGFkZGluZyByb3dzIGZyb20gYSBKYXZhc2NyaXB0IHNvdXJjZSwgcmF0aGVyIHRoYW4gYQoJCSAqIERPTSBzb3VyY2UuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgZGF0YSBhcnJheSB0byBiZSBhZGRlZAoJCSAqICBAcmV0dXJucyB7aW50fSA+PTAgaWYgc3VjY2Vzc2Z1bCAoaW5kZXggb2YgbmV3IGFvRGF0YSBlbnRyeSksIC0xIGlmIGZhaWxlZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGREYXRhICggb1NldHRpbmdzLCBhRGF0YVN1cHBsaWVkICkKCQl7CgkJCXZhciBvQ29sOwoJCQkKCQkJLyogVGFrZSBhbiBpbmRlcGVuZGVudCBjb3B5IG9mIHRoZSBkYXRhIHNvdXJjZSBzbyB3ZSBjYW4gYmFzaCBpdCBhYm91dCBhcyB3ZSB3aXNoICovCgkJCXZhciBhRGF0YUluID0gKCQuaXNBcnJheShhRGF0YVN1cHBsaWVkKSkgPwoJCQkJYURhdGFTdXBwbGllZC5zbGljZSgpIDoKCQkJCSQuZXh0ZW5kKCB0cnVlLCB7fSwgYURhdGFTdXBwbGllZCApOwoJCQkKCQkJLyogQ3JlYXRlIHRoZSBvYmplY3QgZm9yIHN0b3JpbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyBuZXcgcm93ICovCgkJCXZhciBpUm93ID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCXZhciBvRGF0YSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vUm93ICk7CgkJCW9EYXRhLl9hRGF0YSA9IGFEYXRhSW47CgkJCW9TZXR0aW5ncy5hb0RhdGEucHVzaCggb0RhdGEgKTsKCQkKCQkJLyogQ3JlYXRlIHRoZSBjZWxscyAqLwoJCQl2YXIgblRkLCBzVGhpc1R5cGU7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkKCQkJCS8qIFVzZSByZW5kZXJlZCBkYXRhIGZvciBmaWx0ZXJpbmcgLyBzb3J0aW5nICovCgkJCQlpZiAoIHR5cGVvZiBvQ29sLmZuUmVuZGVyID09PSAnZnVuY3Rpb24nICYmIG9Db2wuYlVzZVJlbmRlcmVkICYmIG9Db2wubURhdGEgIT09IG51bGwgKQoJCQkJewoJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksIF9mblJlbmRlcihvU2V0dGluZ3MsIGlSb3csIGkpICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSApICk7CgkJCQl9CgkJCQkKCQkJCS8qIFNlZSBpZiB3ZSBzaG91bGQgYXV0by1kZXRlY3QgdGhlIGNvbHVtbiB0eXBlICovCgkJCQlpZiAoIG9Db2wuX2JBdXRvVHlwZSAmJiBvQ29sLnNUeXBlICE9ICdzdHJpbmcnICkKCQkJCXsKCQkJCQkvKiBBdHRlbXB0IHRvIGF1dG8gZGV0ZWN0IHRoZSB0eXBlIC0gc2FtZSBhcyBfZm5HYXRoZXJEYXRhKCkgKi8KCQkJCQl2YXIgc1ZhclR5cGUgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAndHlwZScgKTsKCQkJCQlpZiAoIHNWYXJUeXBlICE9PSBudWxsICYmIHNWYXJUeXBlICE9PSAnJyApCgkJCQkJewoJCQkJCQlzVGhpc1R5cGUgPSBfZm5EZXRlY3RUeXBlKCBzVmFyVHlwZSApOwoJCQkJCQlpZiAoIG9Db2wuc1R5cGUgPT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQlvQ29sLnNUeXBlID0gc1RoaXNUeXBlOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBvQ29sLnNUeXBlICE9IHNUaGlzVHlwZSAmJiBvQ29sLnNUeXBlICE9ICJodG1sIiApCgkJCQkJCXsKCQkJCQkJCS8qIFN0cmluZyBpcyBhbHdheXMgdGhlICdmYWxsYmFjaycgb3B0aW9uICovCgkJCQkJCQlvQ29sLnNUeXBlID0gJ3N0cmluZyc7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEFkZCB0byB0aGUgZGlzcGxheSBhcnJheSAqLwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnB1c2goIGlSb3cgKTsKCQkKCQkJLyogQ3JlYXRlIHRoZSBET00gaW5mb3JtYXRpb24gKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQl7CgkJCQlfZm5DcmVhdGVUciggb1NldHRpbmdzLCBpUm93ICk7CgkJCX0KCQkKCQkJcmV0dXJuIGlSb3c7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlYWQgaW4gdGhlIGRhdGEgZnJvbSB0aGUgdGFyZ2V0IHRhYmxlIGZyb20gdGhlIERPTQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdhdGhlckRhdGEoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaUxvb3AsIGksIGlMZW4sIGosIGpMZW4sIGpJbm5lciwKCQkJIAluVGRzLCBuVHJzLCBuVGQsIG5UciwgYUxvY2FsRGF0YSwgaVRoaXNJbmRleCwKCQkJCWlSb3csIGlSb3dzLCBpQ29sdW1uLCBpQ29sdW1ucywgc05vZGVOYW1lLAoJCQkJb0NvbCwgb0RhdGE7CgkJCQoJCQkvKgoJCQkgKiBQcm9jZXNzIGJ5IHJvdyBmaXJzdAoJCQkgKiBBZGQgdGhlIGRhdGEgb2JqZWN0IGZvciB0aGUgd2hvbGUgdGFibGUgLSBzdG9yaW5nIHRoZSB0ciBub2RlLiBOb3RlIC0gbm8gcG9pbnQgaW4gZ2V0dGluZwoJCQkgKiBET00gYmFzZWQgZGF0YSBpZiB3ZSBhcmUgZ29pbmcgdG8gZ28gYW5kIHJlcGxhY2UgaXQgd2l0aCBBamF4IHNvdXJjZSBkYXRhLgoJCQkgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyB8fCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UgPT09IG51bGwgKQoJCQl7CgkJCQluVHIgPSBvU2V0dGluZ3MublRCb2R5LmZpcnN0Q2hpbGQ7CgkJCQl3aGlsZSAoIG5UciApCgkJCQl7CgkJCQkJaWYgKCBuVHIubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVFIiICkKCQkJCQl7CgkJCQkJCWlUaGlzSW5kZXggPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJCQkJblRyLl9EVF9Sb3dJbmRleCA9IGlUaGlzSW5kZXg7CgkJCQkJCW9TZXR0aW5ncy5hb0RhdGEucHVzaCggJC5leHRlbmQoIHRydWUsIHt9LCBEYXRhVGFibGUubW9kZWxzLm9Sb3csIHsKCQkJCQkJCSJuVHIiOiBuVHIKCQkJCQkJfSApICk7CgkJCgkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVRoaXNJbmRleCApOwoJCQkJCQluVGQgPSBuVHIuZmlyc3RDaGlsZDsKCQkJCQkJaklubmVyID0gMDsKCQkJCQkJd2hpbGUgKCBuVGQgKQoJCQkJCQl7CgkJCQkJCQlzTm9kZU5hbWUgPSBuVGQubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQkJCWlmICggc05vZGVOYW1lID09ICJURCIgfHwgc05vZGVOYW1lID09ICJUSCIgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlUaGlzSW5kZXgsIGpJbm5lciwgJC50cmltKG5UZC5pbm5lckhUTUwpICk7CgkJCQkJCQkJaklubmVyKys7CgkJCQkJCQl9CgkJCQkJCQluVGQgPSBuVGQubmV4dFNpYmxpbmc7CgkJCQkJCX0KCQkJCQl9CgkJCQkJblRyID0gblRyLm5leHRTaWJsaW5nOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBHYXRoZXIgaW4gdGhlIFREIGVsZW1lbnRzIG9mIHRoZSBUYWJsZSAtIG5vdGUgdGhhdCB0aGlzIGlzIGJhc2ljYWxseSB0aGUgc2FtZSBhcwoJCQkgKiBmbkdldFRkTm9kZXMsIGJ1dCB0aGF0IGZ1bmN0aW9uIHRha2VzIGFjY291bnQgb2YgaGlkZGVuIGNvbHVtbnMsIHdoaWNoIHdlIGhhdmVuJ3QgeWV0CgkJCSAqIHNldHVwIQoJCQkgKi8KCQkJblRycyA9IF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCQluVGRzID0gW107CgkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW5UZCA9IG5UcnNbaV0uZmlyc3RDaGlsZDsKCQkJCXdoaWxlICggblRkICkKCQkJCXsKCQkJCQlzTm9kZU5hbWUgPSBuVGQubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVEQiIHx8IHNOb2RlTmFtZSA9PSAiVEgiICkKCQkJCQl7CgkJCQkJCW5UZHMucHVzaCggblRkICk7CgkJCQkJfQoJCQkJCW5UZCA9IG5UZC5uZXh0U2libGluZzsKCQkJCX0KCQkJfQoJCQkKCQkJLyogTm93IHByb2Nlc3MgYnkgY29sdW1uICovCgkJCWZvciAoIGlDb2x1bW49MCwgaUNvbHVtbnM9b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpQ29sdW1uPGlDb2x1bW5zIDsgaUNvbHVtbisrICkKCQkJewoJCQkJb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl07CgkJCgkJCQkvKiBHZXQgdGhlIHRpdGxlIG9mIHRoZSBjb2x1bW4gLSB1bmxlc3MgdGhlcmUgaXMgYSB1c2VyIHNldCBvbmUgKi8KCQkJCWlmICggb0NvbC5zVGl0bGUgPT09IG51bGwgKQoJCQkJewoJCQkJCW9Db2wuc1RpdGxlID0gb0NvbC5uVGguaW5uZXJIVE1MOwoJCQkJfQoJCQkJCgkJCQl2YXIKCQkJCQliQXV0b1R5cGUgPSBvQ29sLl9iQXV0b1R5cGUsCgkJCQkJYlJlbmRlciA9IHR5cGVvZiBvQ29sLmZuUmVuZGVyID09PSAnZnVuY3Rpb24nLAoJCQkJCWJDbGFzcyA9IG9Db2wuc0NsYXNzICE9PSBudWxsLAoJCQkJCWJWaXNpYmxlID0gb0NvbC5iVmlzaWJsZSwKCQkJCQluQ2VsbCwgc1RoaXNUeXBlLCBzUmVuZGVyZWQsIHNWYWxUeXBlOwoJCQkJCgkJCQkvKiBBIHNpbmdsZSBsb29wIHRvIHJ1bGUgdGhlbSBhbGwgKGFuZCBiZSBtb3JlIGVmZmljaWVudCkgKi8KCQkJCWlmICggYkF1dG9UeXBlIHx8IGJSZW5kZXIgfHwgYkNsYXNzIHx8ICFiVmlzaWJsZSApCgkJCQl7CgkJCQkJZm9yICggaVJvdz0wLCBpUm93cz1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGlSb3c8aVJvd3MgOyBpUm93KysgKQoJCQkJCXsKCQkJCQkJb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQkJCQluQ2VsbCA9IG5UZHNbIChpUm93KmlDb2x1bW5zKSArIGlDb2x1bW4gXTsKCQkJCQkJCgkJCQkJCS8qIFR5cGUgZGV0ZWN0aW9uICovCgkJCQkJCWlmICggYkF1dG9UeXBlICYmIG9Db2wuc1R5cGUgIT0gJ3N0cmluZycgKQoJCQkJCQl7CgkJCQkJCQlzVmFsVHlwZSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICd0eXBlJyApOwoJCQkJCQkJaWYgKCBzVmFsVHlwZSAhPT0gJycgKQoJCQkJCQkJewoJCQkJCQkJCXNUaGlzVHlwZSA9IF9mbkRldGVjdFR5cGUoIHNWYWxUeXBlICk7CgkJCQkJCQkJaWYgKCBvQ29sLnNUeXBlID09PSBudWxsICkKCQkJCQkJCQl7CgkJCQkJCQkJCW9Db2wuc1R5cGUgPSBzVGhpc1R5cGU7CgkJCQkJCQkJfQoJCQkJCQkJCWVsc2UgaWYgKCBvQ29sLnNUeXBlICE9IHNUaGlzVHlwZSAmJiAKCQkJCQkJCQkgICAgICAgICAgb0NvbC5zVHlwZSAhPSAiaHRtbCIgKQoJCQkJCQkJCXsKCQkJCQkJCQkJLyogU3RyaW5nIGlzIGFsd2F5cyB0aGUgJ2ZhbGxiYWNrJyBvcHRpb24gKi8KCQkJCQkJCQkJb0NvbC5zVHlwZSA9ICdzdHJpbmcnOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQoJCQkJCQlpZiAoIG9Db2wubVJlbmRlciApCgkJCQkJCXsKCQkJCQkJCS8vIG1SZW5kZXIgaGFzIGJlZW4gZGVmaW5lZCwgc28gd2UgbmVlZCB0byBnZXQgdGhlIHZhbHVlIGFuZCBzZXQgaXQKCQkJCQkJCW5DZWxsLmlubmVySFRNTCA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICdkaXNwbGF5JyApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBvQ29sLm1EYXRhICE9PSBpQ29sdW1uICkKCQkJCQkJewoJCQkJCQkJLy8gSWYgbURhdGEgaXMgbm90IHRoZSBzYW1lIGFzIHRoZSBjb2x1bW4gbnVtYmVyLCB0aGVuIHdlIG5lZWQgdG8KCQkJCQkJCS8vIGdldCB0aGUgZGV2IHNldCB2YWx1ZS4gSWYgaXQgaXMgdGhlIGNvbHVtbiwgbm8gcG9pbnQgaW4gd2FzdGluZwoJCQkJCQkJLy8gdGltZSBzZXR0aW5nIHRoZSB2YWx1ZSB0aGF0IGlzIGFscmVhZHkgdGhlcmUhCgkJCQkJCQluQ2VsbC5pbm5lckhUTUwgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKTsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogUmVuZGVyaW5nICovCgkJCQkJCWlmICggYlJlbmRlciApCgkJCQkJCXsKCQkJCQkJCXNSZW5kZXJlZCA9IF9mblJlbmRlciggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uICk7CgkJCQkJCQluQ2VsbC5pbm5lckhUTUwgPSBzUmVuZGVyZWQ7CgkJCQkJCQlpZiAoIG9Db2wuYlVzZVJlbmRlcmVkICkKCQkJCQkJCXsKCQkJCQkJCQkvKiBVc2UgdGhlIHJlbmRlcmVkIGRhdGEgZm9yIGZpbHRlcmluZyAvIHNvcnRpbmcgKi8KCQkJCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCBzUmVuZGVyZWQgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogQ2xhc3NlcyAqLwoJCQkJCQlpZiAoIGJDbGFzcyApCgkJCQkJCXsKCQkJCQkJCW5DZWxsLmNsYXNzTmFtZSArPSAnICcrb0NvbC5zQ2xhc3M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIENvbHVtbiB2aXNpYmlsaXR5ICovCgkJCQkJCWlmICggIWJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbkNlbGw7CgkJCQkJCQluQ2VsbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuQ2VsbCApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbnVsbDsKCQkJCQkJfQoJCQoJCQkJCQlpZiAoIG9Db2wuZm5DcmVhdGVkQ2VsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJCW5DZWxsLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpQ29sdW1uCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8qIFJvdyBjcmVhdGVkIGNhbGxiYWNrcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5hb1Jvd0NyZWF0ZWRDYWxsYmFjay5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpXTsKCQkJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUm93Q3JlYXRlZENhbGxiYWNrJywgbnVsbCwgW29EYXRhLm5Uciwgb0RhdGEuX2FEYXRhLCBpXSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFRha2UgYSBUUiBlbGVtZW50IGFuZCBjb252ZXJ0IGl0IHRvIGFuIGluZGV4IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0aGUgVFIgZWxlbWVudCB0byBmaW5kCgkJICogIEByZXR1cm5zIHtpbnR9IGluZGV4IGlmIHRoZSBub2RlIGlzIGZvdW5kLCBudWxsIGlmIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ob2RlVG9EYXRhSW5kZXgoIG9TZXR0aW5ncywgbiApCgkJewoJCQlyZXR1cm4gKG4uX0RUX1Jvd0luZGV4IT09dW5kZWZpbmVkKSA/IG4uX0RUX1Jvd0luZGV4IDogbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSBhIFREIGVsZW1lbnQgYW5kIGNvbnZlcnQgaXQgaW50byBhIGNvbHVtbiBkYXRhIGluZGV4IChub3QgdGhlIHZpc2libGUgaW5kZXgpCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBudW1iZXIgdGhlIFREL1RIIGNhbiBiZSBmb3VuZCBpbgoJCSAqICBAcGFyYW0ge25vZGV9IG4gVGhlIFREL1RIIGVsZW1lbnQgdG8gZmluZAoJCSAqICBAcmV0dXJucyB7aW50fSBpbmRleCBpZiB0aGUgbm9kZSBpcyBmb3VuZCwgLTEgaWYgbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk5vZGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlSb3csIG4gKQoJCXsKCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5DZWxsc1tpXSA9PT0gbiApCgkJCQl7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIC0xOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgZGF0YSBmb3IgYSBnaXZlbiByb3cgZnJvbSB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgndHlwZScgJ2ZpbHRlcicgJ3NvcnQnKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhaUNvbHVtbnMgQXJyYXkgb2YgY29sdW1uIGluZGV4ZXMgdG8gZ2V0IGRhdGEgZnJvbQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpUm93LCBzU3BlY2lmaWMsIGFpQ29sdW1ucyApCgkJewoJCQl2YXIgb3V0ID0gW107CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YWlDb2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW91dC5wdXNoKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBhaUNvbHVtbnNbaV0sIHNTcGVjaWZpYyApICk7CgkJCX0KCQkJcmV0dXJuIG91dDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBkYXRhIGZvciBhIGdpdmVuIGNlbGwgZnJvbSB0aGUgaW50ZXJuYWwgY2FjaGUsIHRha2luZyBpbnRvIGFjY291bnQgZGF0YSBtYXBwaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIHJvdyBpZAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBDb2x1bW4gaW5kZXgKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgnZGlzcGxheScsICd0eXBlJyAnZmlsdGVyJyAnc29ydCcpCgkJICogIEByZXR1cm5zIHsqfSBDZWxsIGRhdGEKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgc1NwZWNpZmljICkKCQl7CgkJCXZhciBzRGF0YTsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJaWYgKCAoc0RhdGE9b0NvbC5mbkdldERhdGEoIG9EYXRhLCBzU3BlY2lmaWMgKSkgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmlEcmF3RXJyb3IgIT0gb1NldHRpbmdzLmlEcmF3ICYmIG9Db2wuc0RlZmF1bHRDb250ZW50ID09PSBudWxsICkKCQkJCXsKCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJlcXVlc3RlZCB1bmtub3duIHBhcmFtZXRlciAiKwoJCQkJCQkodHlwZW9mIG9Db2wubURhdGE9PSdmdW5jdGlvbicgPyAne21EYXRhIGZ1bmN0aW9ufScgOiAiJyIrb0NvbC5tRGF0YSsiJyIpKwoJCQkJCQkiIGZyb20gdGhlIGRhdGEgc291cmNlIGZvciByb3cgIitpUm93ICk7CgkJCQkJb1NldHRpbmdzLmlEcmF3RXJyb3IgPSBvU2V0dGluZ3MuaURyYXc7CgkJCQl9CgkJCQlyZXR1cm4gb0NvbC5zRGVmYXVsdENvbnRlbnQ7CgkJCX0KCQkKCQkJLyogV2hlbiB0aGUgZGF0YSBzb3VyY2UgaXMgbnVsbCwgd2UgY2FuIHVzZSBkZWZhdWx0IGNvbHVtbiBkYXRhICovCgkJCWlmICggc0RhdGEgPT09IG51bGwgJiYgb0NvbC5zRGVmYXVsdENvbnRlbnQgIT09IG51bGwgKQoJCQl7CgkJCQlzRGF0YSA9IG9Db2wuc0RlZmF1bHRDb250ZW50OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICdmdW5jdGlvbicgKQoJCQl7CgkJCQkvKiBJZiB0aGUgZGF0YSBzb3VyY2UgaXMgYSBmdW5jdGlvbiwgdGhlbiB3ZSBydW4gaXQgYW5kIHVzZSB0aGUgcmV0dXJuICovCgkJCQlyZXR1cm4gc0RhdGEoKTsKCQkJfQoJCQoJCQlpZiAoIHNTcGVjaWZpYyA9PSAnZGlzcGxheScgJiYgc0RhdGEgPT09IG51bGwgKQoJCQl7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQkJcmV0dXJuIHNEYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZXQgdGhlIHZhbHVlIGZvciBhIHNwZWNpZmljIGNlbGwsIGludG8gdGhlIGludGVybmFsIGRhdGEgY2FjaGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgcm93IGlkCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIENvbHVtbiBpbmRleAoJCSAqICBAcGFyYW0geyp9IHZhbCBWYWx1ZSB0byBzZXQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgdmFsICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sXTsKCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGE7CgkJCgkJCW9Db2wuZm5TZXREYXRhKCBvRGF0YSwgdmFsICk7CgkJfQoJCQoJCQoJCS8vIFByaXZhdGUgdmFyaWFibGUgdGhhdCBpcyB1c2VkIHRvIG1hdGNoIGFycmF5IHN5bnRheCBpbiB0aGUgZGF0YSBwcm9wZXJ0eSBvYmplY3QKCQl2YXIgX19yZUFycmF5ID0gL1xbLio/XF0kLzsKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGdldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIGdldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogR2l2ZSBhbiBlbXB0eSBzdHJpbmcgZm9yIHJlbmRlcmluZyAvIHNvcnRpbmcgZXRjICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHR5cGUpIHsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX07CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBleHRyYSkgewoJCQkJCXJldHVybiBtU291cmNlKCBkYXRhLCB0eXBlLCBleHRyYSApOwoJCQkJfTsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIG1Tb3VyY2UgPT09ICdzdHJpbmcnICYmIChtU291cmNlLmluZGV4T2YoJy4nKSAhPT0gLTEgfHwgbVNvdXJjZS5pbmRleE9mKCdbJykgIT09IC0xKSApCgkJCXsKCQkJCS8qIElmIHRoZXJlIGlzIGEgLiBpbiB0aGUgc291cmNlIHN0cmluZyB0aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBpbiBhIAoJCQkJICogbmVzdGVkIG9iamVjdCBzbyB3ZSBsb29wIG92ZXIgdGhlIGRhdGEgZm9yIGVhY2ggbGV2ZWwgdG8gZ2V0IHRoZSBuZXh0CgkJCQkgKiBsZXZlbCBkb3duLiBPbiBlYWNoIGxvb3Agd2UgdGVzdCBmb3IgdW5kZWZpbmVkLCBhbmQgaWYgZm91bmQgaW1tZWRpYXRlbHkKCQkJCSAqIHJldHVybi4gVGhpcyBhbGxvd3MgZW50aXJlIG9iamVjdHMgdG8gYmUgbWlzc2luZyBhbmQgc0RlZmF1bHRDb250ZW50IHRvCgkJCQkgKiBiZSB1c2VkIGlmIGRlZmluZWQsIHJhdGhlciB0aGFuIHRocm93aW5nIGFuIGVycm9yCgkJCQkgKi8KCQkJCXZhciBmZXRjaERhdGEgPSBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgc3JjKSB7CgkJCQkJdmFyIGEgPSBzcmMuc3BsaXQoJy4nKTsKCQkJCQl2YXIgYXJyYXlOb3RhdGlvbiwgb3V0LCBpbm5lclNyYzsKCQkKCQkJCQlpZiAoIHNyYyAhPT0gIiIgKQoJCQkJCXsKCQkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCS8vIENoZWNrIGlmIHdlIGFyZSBkZWFsaW5nIHdpdGggYW4gYXJyYXkgbm90YXRpb24gcmVxdWVzdAoJCQkJCQkJYXJyYXlOb3RhdGlvbiA9IGFbaV0ubWF0Y2goX19yZUFycmF5KTsKCQkKCQkJCQkJCWlmICggYXJyYXlOb3RhdGlvbiApIHsKCQkJCQkJCQlhW2ldID0gYVtpXS5yZXBsYWNlKF9fcmVBcnJheSwgJycpOwoJCQoJCQkJCQkJCS8vIENvbmRpdGlvbiBhbGxvd3Mgc2ltcGx5IFtdIHRvIGJlIHBhc3NlZCBpbgoJCQkJCQkJCWlmICggYVtpXSAhPT0gIiIgKSB7CgkJCQkJCQkJCWRhdGEgPSBkYXRhWyBhW2ldIF07CgkJCQkJCQkJfQoJCQkJCQkJCW91dCA9IFtdOwoJCQkJCQkJCQoJCQkJCQkJCS8vIEdldCB0aGUgcmVtYWluZGVyIG9mIHRoZSBuZXN0ZWQgb2JqZWN0IHRvIGdldAoJCQkJCQkJCWEuc3BsaWNlKCAwLCBpKzEgKTsKCQkJCQkJCQlpbm5lclNyYyA9IGEuam9pbignLicpOwoJCQoJCQkJCQkJCS8vIFRyYXZlcnNlIGVhY2ggZW50cnkgaW4gdGhlIGFycmF5IGdldHRpbmcgdGhlIHByb3BlcnRpZXMgcmVxdWVzdGVkCgkJCQkJCQkJZm9yICggdmFyIGo9MCwgakxlbj1kYXRhLmxlbmd0aCA7IGo8akxlbiA7IGorKyApIHsKCQkJCQkJCQkJb3V0LnB1c2goIGZldGNoRGF0YSggZGF0YVtqXSwgdHlwZSwgaW5uZXJTcmMgKSApOwoJCQkJCQkJCX0KCQkKCQkJCQkJCQkvLyBJZiBhIHN0cmluZyBpcyBnaXZlbiBpbiBiZXR3ZWVuIHRoZSBhcnJheSBub3RhdGlvbiBpbmRpY2F0b3JzLCB0aGF0CgkJCQkJCQkJLy8gaXMgdXNlZCB0byBqb2luIHRoZSBzdHJpbmdzIHRvZ2V0aGVyLCBvdGhlcndpc2UgYW4gYXJyYXkgaXMgcmV0dXJuZWQKCQkJCQkJCQl2YXIgam9pbiA9IGFycmF5Tm90YXRpb25bMF0uc3Vic3RyaW5nKDEsIGFycmF5Tm90YXRpb25bMF0ubGVuZ3RoLTEpOwoJCQkJCQkJCWRhdGEgPSAoam9pbj09PSIiKSA/IG91dCA6IG91dC5qb2luKGpvaW4pOwoJCQoJCQkJCQkJCS8vIFRoZSBpbm5lciBjYWxsIHRvIGZldGNoRGF0YSBoYXMgYWxyZWFkeSB0cmF2ZXJzZWQgdGhyb3VnaCB0aGUgcmVtYWluZGVyCgkJCQkJCQkJLy8gb2YgdGhlIHNvdXJjZSByZXF1ZXN0ZWQsIHNvIHdlIGV4aXQgZnJvbSB0aGUgbG9vcAoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQoJCQkJCQkJaWYgKCBkYXRhID09PSBudWxsIHx8IGRhdGFbIGFbaV0gXSA9PT0gdW5kZWZpbmVkICkKCQkJCQkJCXsKCQkJCQkJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCQkJCQkJfQoJCQkJCQkJZGF0YSA9IGRhdGFbIGFbaV0gXTsKCQkJCQkJfQoJCQkJCX0KCQkKCQkJCQlyZXR1cm4gZGF0YTsKCQkJCX07CgkJCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHR5cGUpIHsKCQkJCQlyZXR1cm4gZmV0Y2hEYXRhKCBkYXRhLCB0eXBlLCBtU291cmNlICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIGRhdGFbbVNvdXJjZV07CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHNldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIHNldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogTm90aGluZyB0byBkbyB3aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkge307CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQltU291cmNlKCBkYXRhLCAnc2V0JywgdmFsICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgKG1Tb3VyY2UuaW5kZXhPZignLicpICE9PSAtMSB8fCBtU291cmNlLmluZGV4T2YoJ1snKSAhPT0gLTEpICkKCQkJewoJCQkJLyogTGlrZSB0aGUgZ2V0LCB3ZSBuZWVkIHRvIGdldCBkYXRhIGZyb20gYSBuZXN0ZWQgb2JqZWN0ICovCgkJCQl2YXIgc2V0RGF0YSA9IGZ1bmN0aW9uIChkYXRhLCB2YWwsIHNyYykgewoJCQkJCXZhciBhID0gc3JjLnNwbGl0KCcuJyksIGI7CgkJCQkJdmFyIGFycmF5Tm90YXRpb24sIG8sIGlubmVyU3JjOwoJCQoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGgtMSA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQkvLyBDaGVjayBpZiB3ZSBhcmUgZGVhbGluZyB3aXRoIGFuIGFycmF5IG5vdGF0aW9uIHJlcXVlc3QKCQkJCQkJYXJyYXlOb3RhdGlvbiA9IGFbaV0ubWF0Y2goX19yZUFycmF5KTsKCQkKCQkJCQkJaWYgKCBhcnJheU5vdGF0aW9uICkKCQkJCQkJewoJCQkJCQkJYVtpXSA9IGFbaV0ucmVwbGFjZShfX3JlQXJyYXksICcnKTsKCQkJCQkJCWRhdGFbIGFbaV0gXSA9IFtdOwoJCQkJCQkJCgkJCQkJCQkvLyBHZXQgdGhlIHJlbWFpbmRlciBvZiB0aGUgbmVzdGVkIG9iamVjdCB0byBzZXQgc28gd2UgY2FuIHJlY3Vyc2UKCQkJCQkJCWIgPSBhLnNsaWNlKCk7CgkJCQkJCQliLnNwbGljZSggMCwgaSsxICk7CgkJCQkJCQlpbm5lclNyYyA9IGIuam9pbignLicpOwoJCQoJCQkJCQkJLy8gVHJhdmVyc2UgZWFjaCBlbnRyeSBpbiB0aGUgYXJyYXkgc2V0dGluZyB0aGUgcHJvcGVydGllcyByZXF1ZXN0ZWQKCQkJCQkJCWZvciAoIHZhciBqPTAsIGpMZW49dmFsLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJbyA9IHt9OwoJCQkJCQkJCXNldERhdGEoIG8sIHZhbFtqXSwgaW5uZXJTcmMgKTsKCQkJCQkJCQlkYXRhWyBhW2ldIF0ucHVzaCggbyApOwoJCQkJCQkJfQoJCQoJCQkJCQkJLy8gVGhlIGlubmVyIGNhbGwgdG8gc2V0RGF0YSBoYXMgYWxyZWFkeSB0cmF2ZXJzZWQgdGhyb3VnaCB0aGUgcmVtYWluZGVyCgkJCQkJCQkvLyBvZiB0aGUgc291cmNlIGFuZCBoYXMgc2V0IHRoZSBkYXRhLCB0aHVzIHdlIGNhbiBleGl0IGhlcmUKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQoJCQkJCQkvLyBJZiB0aGUgbmVzdGVkIG9iamVjdCBkb2Vzbid0IGN1cnJlbnRseSBleGlzdCAtIHNpbmNlIHdlIGFyZQoJCQkJCQkvLyB0cnlpbmcgdG8gc2V0IHRoZSB2YWx1ZSAtIGNyZWF0ZSBpdAoJCQkJCQlpZiAoIGRhdGFbIGFbaV0gXSA9PT0gbnVsbCB8fCBkYXRhWyBhW2ldIF0gPT09IHVuZGVmaW5lZCApCgkJCQkJCXsKCQkJCQkJCWRhdGFbIGFbaV0gXSA9IHt9OwoJCQkJCQl9CgkJCQkJCWRhdGEgPSBkYXRhWyBhW2ldIF07CgkJCQkJfQoJCQoJCQkJCS8vIElmIGFycmF5IG5vdGF0aW9uIGlzIHVzZWQsIHdlIGp1c3Qgd2FudCB0byBzdHJpcCBpdCBhbmQgdXNlIHRoZSBwcm9wZXJ0eSBuYW1lCgkJCQkJLy8gYW5kIGFzc2lnbiB0aGUgdmFsdWUuIElmIGl0IGlzbid0IHVzZWQsIHRoZW4gd2UgZ2V0IHRoZSByZXN1bHQgd2Ugd2FudCBhbnl3YXkKCQkJCQlkYXRhWyBhW2EubGVuZ3RoLTFdLnJlcGxhY2UoX19yZUFycmF5LCAnJykgXSA9IHZhbDsKCQkJCX07CgkJCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCXJldHVybiBzZXREYXRhKCBkYXRhLCB2YWwsIG1Tb3VyY2UgKTsKCQkJCX07CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBBcnJheSBvciBmbGF0IG9iamVjdCBtYXBwaW5nICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCWRhdGFbbVNvdXJjZV0gPSB2YWw7CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gYXJyYXkgd2l0aCB0aGUgZnVsbCB0YWJsZSBkYXRhCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMgYXJyYXkge2FycmF5fSBhRGF0YSBNYXN0ZXIgZGF0YSBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXREYXRhTWFzdGVyICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhRGF0YSA9IFtdOwoJCQl2YXIgaUxlbiA9IG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxpTGVuOyBpKysgKQoJCQl7CgkJCQlhRGF0YS5wdXNoKCBvU2V0dGluZ3MuYW9EYXRhW2ldLl9hRGF0YSApOwoJCQl9CgkJCXJldHVybiBhRGF0YTsKCQl9CgkJCgkJCgkJLyoqCgkJICogTnVrZSB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKQoJCXsKCQkJb1NldHRpbmdzLmFvRGF0YS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoICk7CgkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCApOwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggMCwgb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggKTsKCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQl9CgkJCgkJCgkJIC8qKgoJCSAqIFRha2UgYW4gYXJyYXkgb2YgaW50ZWdlcnMgKGluZGV4IGFycmF5KSBhbmQgcmVtb3ZlIGEgdGFyZ2V0IGludGVnZXIgKHZhbHVlIC0gbm90IAoJCSAqIHRoZSBrZXkhKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhIEluZGV4IGFycmF5IHRvIHRhcmdldAoJCSAqICBAcGFyYW0ge2ludH0gaVRhcmdldCB2YWx1ZSB0byBmaW5kCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRlbGV0ZUluZGV4KCBhLCBpVGFyZ2V0ICkKCQl7CgkJCXZhciBpVGFyZ2V0SW5kZXggPSAtMTsKCQkJCgkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGFbaV0gPT0gaVRhcmdldCApCgkJCQl7CgkJCQkJaVRhcmdldEluZGV4ID0gaTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBhW2ldID4gaVRhcmdldCApCgkJCQl7CgkJCQkJYVtpXS0tOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIGlUYXJnZXRJbmRleCAhPSAtMSApCgkJCXsKCQkJCWEuc3BsaWNlKCBpVGFyZ2V0SW5kZXgsIDEgKTsKCQkJfQoJCX0KCQkKCQkKCQkgLyoqCgkJICogQ2FsbCB0aGUgZGV2ZWxvcGVyIGRlZmluZWQgZm5SZW5kZXIgZnVuY3Rpb24gZm9yIGEgZ2l2ZW4gY2VsbCAocm93L2NvbHVtbikgd2l0aAoJCSAqIHRoZSByZXF1aXJlZCBwYXJhbWV0ZXJzIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgaW5kZXggZm9yIHRoZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgYW9Db2x1bW5zIGluZGV4IGZvciB0aGUgY29sdW1uCgkJICogIEByZXR1cm5zIHsqfSBSZXR1cm4gb2YgdGhlIGRldmVsb3BlcidzIGZuUmVuZGVyIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlbmRlciggb1NldHRpbmdzLCBpUm93LCBpQ29sICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sXTsKCQkKCQkJcmV0dXJuIG9Db2wuZm5SZW5kZXIoIHsKCQkJCSJpRGF0YVJvdyI6ICAgIGlSb3csCgkJCQkiaURhdGFDb2x1bW4iOiBpQ29sLAoJCQkJIm9TZXR0aW5ncyI6ICAgb1NldHRpbmdzLAoJCQkJImFEYXRhIjogICAgICAgb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEsCgkJCQkibURhdGFQcm9wIjogICBvQ29sLm1EYXRhCgkJCX0sIF9mbkdldENlbGxEYXRhKG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJ2Rpc3BsYXknKSApOwoJCX0KCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgVFIgZWxlbWVudCAoYW5kIGl0J3MgVEQgY2hpbGRyZW4pIGZvciBhIHJvdwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFJvdyB0byBjb25zaWRlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVUciAoIG9TZXR0aW5ncywgaVJvdyApCgkJewoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQl2YXIgblRkOwoJCQoJCQlpZiAoIG9EYXRhLm5UciA9PT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhLm5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CgkJCgkJCQkvKiBVc2UgYSBwcml2YXRlIHByb3BlcnR5IG9uIHRoZSBub2RlIHRvIGFsbG93IHJlc2VydmUgbWFwcGluZyBmcm9tIHRoZSBub2RlCgkJCQkgKiB0byB0aGUgYW9EYXRhIGFycmF5IGZvciBmYXN0IGxvb2sgdXAKCQkJCSAqLwoJCQkJb0RhdGEublRyLl9EVF9Sb3dJbmRleCA9IGlSb3c7CgkJCgkJCQkvKiBTcGVjaWFsIHBhcmFtZXRlcnMgY2FuIGJlIGdpdmVuIGJ5IHRoZSBkYXRhIHNvdXJjZSB0byBiZSB1c2VkIG9uIHRoZSByb3cgKi8KCQkJCWlmICggb0RhdGEuX2FEYXRhLkRUX1Jvd0lkICkKCQkJCXsKCQkJCQlvRGF0YS5uVHIuaWQgPSBvRGF0YS5fYURhdGEuRFRfUm93SWQ7CgkJCQl9CgkJCgkJCQlpZiAoIG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzcyApCgkJCQl7CgkJCQkJb0RhdGEublRyLmNsYXNzTmFtZSA9IG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzczsKCQkJCX0KCQkKCQkJCS8qIFByb2Nlc3MgZWFjaCBjb2x1bW4gKi8KCQkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkJCQluVGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBvQ29sLnNDZWxsVHlwZSApOwoJCQoJCQkJCS8qIFJlbmRlciBpZiBuZWVkZWQgLSBpZiBiVXNlUmVuZGVyZWQgaXMgdHJ1ZSB0aGVuIHdlIGFscmVhZHkgaGF2ZSB0aGUgcmVuZGVyZWQKCQkJCQkgKiB2YWx1ZSBpbiB0aGUgZGF0YSBzb3VyY2UgLSBzbyBjYW4ganVzdCB1c2UgdGhhdAoJCQkJCSAqLwoJCQkJCW5UZC5pbm5lckhUTUwgPSAodHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgKCFvQ29sLmJVc2VSZW5kZXJlZCB8fCBvQ29sLm1EYXRhID09PSBudWxsKSkgPwoJCQkJCQlfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaSApIDoKCQkJCQkJX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCQkvKiBBZGQgdXNlciBkZWZpbmVkIGNsYXNzICovCgkJCQkJaWYgKCBvQ29sLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQuY2xhc3NOYW1lID0gb0NvbC5zQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggb0NvbC5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlvRGF0YS5uVHIuYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBudWxsOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBuVGQ7CgkJCQkJfQoJCQoJCQkJCWlmICggb0NvbC5mbkNyZWF0ZWRDZWxsICkKCQkJCQl7CgkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJblRkLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpCgkJCQkJCSk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG51bGwsIFtvRGF0YS5uVHIsIG9EYXRhLl9hRGF0YSwgaVJvd10gKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgdGhlIEhUTUwgaGVhZGVyIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZEhlYWQoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaSwgblRoLCBpTGVuLCBqLCBqTGVuOwoJCQl2YXIgaVRocyA9ICQoJ3RoLCB0ZCcsIG9TZXR0aW5ncy5uVEhlYWQpLmxlbmd0aDsKCQkJdmFyIGlDb3JyZWN0b3IgPSAwOwoJCQl2YXIganFDaGlsZHJlbjsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGEgaGVhZGVyIGluIHBsYWNlIC0gdGhlbiB1c2UgaXQgLSBvdGhlcndpc2UgaXQncyBnb2luZyB0byBnZXQgbnVrZWQuLi4gKi8KCQkJaWYgKCBpVGhzICE9PSAwICkKCQkJewoJCQkJLyogV2UndmUgZ290IGEgdGhlYWQgZnJvbSB0aGUgRE9NLCBzbyByZW1vdmUgaGlkZGVuIGNvbHVtbnMgYW5kIGFwcGx5IHdpZHRoIHRvIHZpcyBjb2xzICovCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5UaCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoOwoJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnY29sdW1uaGVhZGVyJyk7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQkJewoJCQkJCQluVGguc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIG9TZXR0aW5ncy5pVGFiSW5kZXgpOwoJCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCQl9CgkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQkkKG5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICk7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFNldCB0aGUgdGl0bGUgb2YgdGhlIGNvbHVtbiBpZiBpdCBpcyB1c2VyIGRlZmluZWQgKG5vdCB3aGF0IHdhcyBhdXRvIGRldGVjdGVkKSAqLwoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGUgIT0gblRoLmlubmVySFRNTCApCgkJCQkJewoJCQkJCQluVGguaW5uZXJIVE1MID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogV2UgZG9uJ3QgaGF2ZSBhIGhlYWRlciBpbiB0aGUgRE9NIC0gc28gd2UgYXJlIGdvaW5nIHRvIGhhdmUgdG8gY3JlYXRlIG9uZSAqLwoJCQkJdmFyIG5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJ0ciIgKTsKCQkJCQoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluVGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaDsKCQkJCQluVGguaW5uZXJIVE1MID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGU7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJJChuVGgpLmFkZENsYXNzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyApOwoJCQkJCX0KCQkJCQkKCQkJCQluVHIuYXBwZW5kQ2hpbGQoIG5UaCApOwoJCQkJfQoJCQkJJChvU2V0dGluZ3MublRIZWFkKS5odG1sKCAnJyApWzBdLmFwcGVuZENoaWxkKCBuVHIgKTsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvSGVhZGVyLCBvU2V0dGluZ3MublRIZWFkICk7CgkJCX0KCQkJCgkJCS8qIEFSSUEgcm9sZSBmb3IgdGhlIHJvd3MgKi8JCgkJCSQob1NldHRpbmdzLm5USGVhZCkuY2hpbGRyZW4oJ3RyJykuYXR0cigncm9sZScsICdyb3cnKTsKCQkJCgkJCS8qIEFkZCB0aGUgZXh0cmEgbWFya3VwIG5lZWRlZCBieSBqUXVlcnkgVUkncyB0aGVtZXMgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkpVSSApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJblRoID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGg7CgkJCQkJCgkJCQkJdmFyIG5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJCQluRGl2LmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSVdyYXBwZXI7CgkJCQkJJChuVGgpLmNvbnRlbnRzKCkuYXBwZW5kVG8obkRpdik7CgkJCQkJCgkJCQkJdmFyIG5TcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwoJCQkJCW5TcGFuLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb247CgkJCQkJbkRpdi5hcHBlbmRDaGlsZCggblNwYW4gKTsKCQkJCQluVGguYXBwZW5kQ2hpbGQoIG5EaXYgKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSAhPT0gZmFsc2UgKQoJCQkJCXsKCQkJCQkJX2ZuU29ydEF0dGFjaExpc3RlbmVyKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLCBpICk7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZSApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogRGVhbCB3aXRoIHRoZSBmb290ZXIgLSBhZGQgY2xhc3NlcyBpZiByZXF1aXJlZCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vQ2xhc3Nlcy5zRm9vdGVyVEggIT09ICIiICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRGb290KS5jaGlsZHJlbigndHInKS5jaGlsZHJlbigndGgnKS5hZGRDbGFzcyggb1NldHRpbmdzLm9DbGFzc2VzLnNGb290ZXJUSCApOwoJCQl9CgkJCQoJCQkvKiBDYWNoZSB0aGUgZm9vdGVyIGVsZW1lbnRzICovCgkJCWlmICggb1NldHRpbmdzLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCXZhciBhbkNlbGxzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsIG51bGwsIG9TZXR0aW5ncy5hb0Zvb3RlciApOwoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFuQ2VsbHNbaV0gKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGYgPSBhbkNlbGxzW2ldOwoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICkKCQkJCQkJewoJCQkJCQkJJChhbkNlbGxzW2ldKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBEcmF3IHRoZSBoZWFkZXIgKG9yIGZvb3RlcikgZWxlbWVudCBiYXNlZCBvbiB0aGUgY29sdW1uIHZpc2liaWxpdHkgc3RhdGVzLiBUaGUKCQkgKiBtZXRob2RvbG9neSBoZXJlIGlzIHRvIHVzZSB0aGUgbGF5b3V0IGFycmF5IGZyb20gX2ZuRGV0ZWN0SGVhZGVyLCBtb2RpZmllZCBmb3IKCQkgKiB0aGUgaW5zdGFudGFuZW91cyBjb2x1bW4gdmlzaWJpbGl0eSwgdG8gY29uc3RydWN0IHRoZSBuZXcgbGF5b3V0LiBUaGUgZ3JpZCBpcwoJCSAqIHRyYXZlcnNlZCBvdmVyIGNlbGwgYXQgYSB0aW1lIGluIGEgcm93cyB4IGNvbHVtbnMgZ3JpZCBmYXNoaW9uLCBhbHRob3VnaCBlYWNoIAoJCSAqIGNlbGwgaW5zZXJ0IGNhbiBjb3ZlciBtdWx0aXBsZSBlbGVtZW50cyBpbiB0aGUgZ3JpZCAtIHdoaWNoIGlzIHRyYWNrcyB1c2luZyB0aGUKCQkgKiBhQXBwbGllZCBhcnJheS4gQ2VsbCBpbnNlcnRzIGluIHRoZSBncmlkIHdpbGwgb25seSBvY2N1ciB3aGVyZSB0aGVyZSBpc24ndAoJCSAqIGFscmVhZHkgYSBjZWxsIGluIHRoYXQgcG9zaXRpb24uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3RzfSBhb1NvdXJjZSBMYXlvdXQgYXJyYXkgZnJvbSBfZm5EZXRlY3RIZWFkZXIKCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYkluY2x1ZGVIaWRkZW49ZmFsc2VdIElmIHRydWUgdGhlbiBpbmNsdWRlIHRoZSBoaWRkZW4gY29sdW1ucyBpbiB0aGUgY2FsYywgCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIGFvU291cmNlLCBiSW5jbHVkZUhpZGRlbiApCgkJewoJCQl2YXIgaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbiwgbiwgbkxvY2FsVHI7CgkJCXZhciBhb0xvY2FsID0gW107CgkJCXZhciBhQXBwbGllZCA9IFtdOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGlSb3dzcGFuLCBpQ29sc3BhbjsKCQkKCQkJaWYgKCAgYkluY2x1ZGVIaWRkZW4gPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWJJbmNsdWRlSGlkZGVuID0gZmFsc2U7CgkJCX0KCQkKCQkJLyogTWFrZSBhIGNvcHkgb2YgdGhlIG1hc3RlciBsYXlvdXQgYXJyYXksIGJ1dCB3aXRob3V0IHRoZSB2aXNpYmxlIGNvbHVtbnMgaW4gaXQgKi8KCQkJZm9yICggaT0wLCBpTGVuPWFvU291cmNlLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWFvTG9jYWxbaV0gPSBhb1NvdXJjZVtpXS5zbGljZSgpOwoJCQkJYW9Mb2NhbFtpXS5uVHIgPSBhb1NvdXJjZVtpXS5uVHI7CgkJCgkJCQkvKiBSZW1vdmUgYW55IGNvbHVtbnMgd2hpY2ggYXJlIGN1cnJlbnRseSBoaWRkZW4gKi8KCQkJCWZvciAoIGo9aUNvbHVtbnMtMSA7IGo+PTAgOyBqLS0gKQoJCQkJewoJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbal0uYlZpc2libGUgJiYgIWJJbmNsdWRlSGlkZGVuICkKCQkJCQl7CgkJCQkJCWFvTG9jYWxbaV0uc3BsaWNlKCBqLCAxICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJLyogUHJlcCB0aGUgYXBwbGllZCBhcnJheSAtIGl0IG5lZWRzIGFuIGVsZW1lbnQgZm9yIGVhY2ggcm93ICovCgkJCQlhQXBwbGllZC5wdXNoKCBbXSApOwoJCQl9CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1hb0xvY2FsLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW5Mb2NhbFRyID0gYW9Mb2NhbFtpXS5uVHI7CgkJCQkKCQkJCS8qIEFsbCBjZWxscyBhcmUgZ29pbmcgdG8gYmUgcmVwbGFjZWQsIHNvIGVtcHR5IG91dCB0aGUgcm93ICovCgkJCQlpZiAoIG5Mb2NhbFRyICkKCQkJCXsKCQkJCQl3aGlsZSggKG4gPSBuTG9jYWxUci5maXJzdENoaWxkKSApCgkJCQkJewoJCQkJCQluTG9jYWxUci5yZW1vdmVDaGlsZCggbiApOwoJCQkJCX0KCQkJCX0KCQkKCQkJCWZvciAoIGo9MCwgakxlbj1hb0xvY2FsW2ldLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaVJvd3NwYW4gPSAxOwoJCQkJCWlDb2xzcGFuID0gMTsKCQkKCQkJCQkvKiBDaGVjayB0byBzZWUgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIGNlbGwgKHJvdy9jb2xzcGFuKSBjb3ZlcmluZyBvdXIgdGFyZ2V0CgkJCQkJICogaW5zZXJ0IHBvaW50LiBJZiB0aGVyZSBpcywgdGhlbiB0aGVyZSBpcyBub3RoaW5nIHRvIGRvLgoJCQkJCSAqLwoJCQkJCWlmICggYUFwcGxpZWRbaV1bal0gPT09IHVuZGVmaW5lZCApCgkJCQkJewoJCQkJCQluTG9jYWxUci5hcHBlbmRDaGlsZCggYW9Mb2NhbFtpXVtqXS5jZWxsICk7CgkJCQkJCWFBcHBsaWVkW2ldW2pdID0gMTsKCQkKCQkJCQkJLyogRXhwYW5kIHRoZSBjZWxsIHRvIGNvdmVyIGFzIG1hbnkgcm93cyBhcyBuZWVkZWQgKi8KCQkJCQkJd2hpbGUgKCBhb0xvY2FsW2kraVJvd3NwYW5dICE9PSB1bmRlZmluZWQgJiYKCQkJCQkJICAgICAgICBhb0xvY2FsW2ldW2pdLmNlbGwgPT0gYW9Mb2NhbFtpK2lSb3dzcGFuXVtqXS5jZWxsICkKCQkJCQkJewoJCQkJCQkJYUFwcGxpZWRbaStpUm93c3Bhbl1bal0gPSAxOwoJCQkJCQkJaVJvd3NwYW4rKzsKCQkJCQkJfQoJCQoJCQkJCQkvKiBFeHBhbmQgdGhlIGNlbGwgdG8gY292ZXIgYXMgbWFueSBjb2x1bW5zIGFzIG5lZWRlZCAqLwoJCQkJCQl3aGlsZSAoIGFvTG9jYWxbaV1baitpQ29sc3Bhbl0gIT09IHVuZGVmaW5lZCAmJgoJCQkJCQkgICAgICAgIGFvTG9jYWxbaV1bal0uY2VsbCA9PSBhb0xvY2FsW2ldW2oraUNvbHNwYW5dLmNlbGwgKQoJCQkJCQl7CgkJCQkJCQkvKiBNdXN0IHVwZGF0ZSB0aGUgYXBwbGllZCBhcnJheSBvdmVyIHRoZSByb3dzIGZvciB0aGUgY29sdW1ucyAqLwoJCQkJCQkJZm9yICggaz0wIDsgazxpUm93c3BhbiA7IGsrKyApCgkJCQkJCQl7CgkJCQkJCQkJYUFwcGxpZWRbaStrXVtqK2lDb2xzcGFuXSA9IDE7CgkJCQkJCQl9CgkJCQkJCQlpQ29sc3BhbisrOwoJCQkJCQl9CgkJCgkJCQkJCS8qIERvIHRoZSBhY3R1YWwgZXhwYW5zaW9uIGluIHRoZSBET00gKi8KCQkJCQkJYW9Mb2NhbFtpXVtqXS5jZWxsLnJvd1NwYW4gPSBpUm93c3BhbjsKCQkJCQkJYW9Mb2NhbFtpXVtqXS5jZWxsLmNvbFNwYW4gPSBpQ29sc3BhbjsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogSW5zZXJ0IHRoZSByZXF1aXJlZCBUUiBub2RlcyBpbnRvIHRoZSB0YWJsZSBmb3IgZGlzcGxheQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRyYXcoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBQcm92aWRlIGEgcHJlLWNhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGNhbmNlbCB0aGUgZHJhdyBpcyBmYWxzZSBpcyByZXR1cm5lZCAqLwoJCQl2YXIgYVByZURyYXcgPSBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUHJlRHJhd0NhbGxiYWNrJywgJ3ByZURyYXcnLCBbb1NldHRpbmdzXSApOwoJCQlpZiAoICQuaW5BcnJheSggZmFsc2UsIGFQcmVEcmF3ICkgIT09IC0xICkKCQkJewoJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJdmFyIGksIGlMZW4sIG47CgkJCXZhciBhblJvd3MgPSBbXTsKCQkJdmFyIGlSb3dDb3VudCA9IDA7CgkJCXZhciBpU3RyaXBlcyA9IG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMubGVuZ3RoOwoJCQl2YXIgaU9wZW5Sb3dzID0gb1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoOwoJCQkKCQkJb1NldHRpbmdzLmJEcmF3aW5nID0gdHJ1ZTsKCQkJCgkJCS8qIENoZWNrIGFuZCBzZWUgaWYgd2UgaGF2ZSBhbiBpbml0aWFsIGRyYXcgcG9zaXRpb24gZnJvbSBzdGF0ZSBzYXZpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgIT09IHVuZGVmaW5lZCAmJiBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgIT0gLTEgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAob1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID49IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkpID8KCQkJCQkJMCA6IG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCX0KCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IC0xOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyBkcmF3IGludGVyY2VwdCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nICkKCQkJewoJCQkJb1NldHRpbmdzLmJEZWZlckxvYWRpbmcgPSBmYWxzZTsKCQkJCW9TZXR0aW5ncy5pRHJhdysrOwoJCQl9CgkJCWVsc2UgaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5pRHJhdysrOwoJCQl9CgkJCWVsc2UgaWYgKCAhb1NldHRpbmdzLmJEZXN0cm95aW5nICYmICFfZm5BamF4VXBkYXRlKCBvU2V0dGluZ3MgKSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCXZhciBpU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQl2YXIgaUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlFbmQ7CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJaVN0YXJ0ID0gMDsKCQkJCQlpRW5kID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCQl9CgkJCQkKCQkJCWZvciAoIHZhciBqPWlTdGFydCA7IGo8aUVuZCA7IGorKyApCgkJCQl7CgkJCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbIG9TZXR0aW5ncy5haURpc3BsYXlbal0gXTsKCQkJCQlpZiAoIGFvRGF0YS5uVHIgPT09IG51bGwgKQoJCQkJCXsKCQkJCQkJX2ZuQ3JlYXRlVHIoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtqXSApOwoJCQkJCX0KCQkKCQkJCQl2YXIgblJvdyA9IGFvRGF0YS5uVHI7CgkJCQkJCgkJCQkJLyogUmVtb3ZlIHRoZSBvbGQgc3RyaXBpbmcgY2xhc3NlcyBhbmQgdGhlbiBhZGQgdGhlIG5ldyBvbmUgKi8KCQkJCQlpZiAoIGlTdHJpcGVzICE9PSAwICkKCQkJCQl7CgkJCQkJCXZhciBzU3RyaXBlID0gb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1sgaVJvd0NvdW50ICUgaVN0cmlwZXMgXTsKCQkJCQkJaWYgKCBhb0RhdGEuX3NSb3dTdHJpcGUgIT0gc1N0cmlwZSApCgkJCQkJCXsKCQkJCQkJCSQoblJvdykucmVtb3ZlQ2xhc3MoIGFvRGF0YS5fc1Jvd1N0cmlwZSApLmFkZENsYXNzKCBzU3RyaXBlICk7CgkJCQkJCQlhb0RhdGEuX3NSb3dTdHJpcGUgPSBzU3RyaXBlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFJvdyBjYWxsYmFjayBmdW5jdGlvbnMgLSBtaWdodCB3YW50IHRvIG1hbmlwdWxhdGUgdGhlIHJvdyAqLwoJCQkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9Sb3dDYWxsYmFjaycsIG51bGwsIAoJCQkJCQlbblJvdywgb1NldHRpbmdzLmFvRGF0YVsgb1NldHRpbmdzLmFpRGlzcGxheVtqXSBdLl9hRGF0YSwgaVJvd0NvdW50LCBqXSApOwoJCQkJCQoJCQkJCWFuUm93cy5wdXNoKCBuUm93ICk7CgkJCQkJaVJvd0NvdW50Kys7CgkJCQkJCgkJCQkJLyogSWYgdGhlcmUgaXMgYW4gb3BlbiByb3cgLSBhbmQgaXQgaXMgYXR0YWNoZWQgdG8gdGhpcyBwYXJlbnQgLSBhdHRhY2ggaXQgb24gcmVkcmF3ICovCgkJCQkJaWYgKCBpT3BlblJvd3MgIT09IDAgKQoJCQkJCXsKCQkJCQkJZm9yICggdmFyIGs9MCA7IGs8aU9wZW5Sb3dzIDsgaysrICkKCQkJCQkJewoJCQkJCQkJaWYgKCBuUm93ID09IG9TZXR0aW5ncy5hb09wZW5Sb3dzW2tdLm5QYXJlbnQgKQoJCQkJCQkJewoJCQkJCQkJCWFuUm93cy5wdXNoKCBvU2V0dGluZ3MuYW9PcGVuUm93c1trXS5uVHIgKTsKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFRhYmxlIGlzIGVtcHR5IC0gY3JlYXRlIGEgcm93IHdpdGggYW4gZW1wdHkgbWVzc2FnZSBpbiBpdCAqLwoJCQkJYW5Sb3dzWyAwIF0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndHInICk7CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1swXSApCgkJCQl7CgkJCQkJYW5Sb3dzWyAwIF0uY2xhc3NOYW1lID0gb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1swXTsKCQkJCX0KCQkKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2U7CgkJCQl2YXIgc1plcm8gPSBvTGFuZy5zWmVyb1JlY29yZHM7CgkJCQlpZiAoIG9TZXR0aW5ncy5pRHJhdyA9PSAxICYmIG9TZXR0aW5ncy5zQWpheFNvdXJjZSAhPT0gbnVsbCAmJiAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJc1plcm8gPSBvTGFuZy5zTG9hZGluZ1JlY29yZHM7CgkJCQl9CgkJCQllbHNlIGlmICggb0xhbmcuc0VtcHR5VGFibGUgJiYgb1NldHRpbmdzLmZuUmVjb3Jkc1RvdGFsKCkgPT09IDAgKQoJCQkJewoJCQkJCXNaZXJvID0gb0xhbmcuc0VtcHR5VGFibGU7CgkJCQl9CgkJCgkJCQl2YXIgblRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RkJyApOwoJCQkJblRkLnNldEF0dHJpYnV0ZSggJ3ZhbGlnbicsICJ0b3AiICk7CgkJCQluVGQuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQkJblRkLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUm93RW1wdHk7CgkJCQluVGQuaW5uZXJIVE1MID0gX2ZuSW5mb01hY3Jvcyggb1NldHRpbmdzLCBzWmVybyApOwoJCQkJCgkJCQlhblJvd3NbIGlSb3dDb3VudCBdLmFwcGVuZENoaWxkKCBuVGQgKTsKCQkJfQoJCQkKCQkJLyogSGVhZGVyIGFuZCBmb290ZXIgY2FsbGJhY2tzICovCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9IZWFkZXJDYWxsYmFjaycsICdoZWFkZXInLCBbICQob1NldHRpbmdzLm5USGVhZCkuY2hpbGRyZW4oJ3RyJylbMF0sIAoJCQkJX2ZuR2V0RGF0YU1hc3Rlciggb1NldHRpbmdzICksIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCwgb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpLCBvU2V0dGluZ3MuYWlEaXNwbGF5IF0gKTsKCQkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9Gb290ZXJDYWxsYmFjaycsICdmb290ZXInLCBbICQob1NldHRpbmdzLm5URm9vdCkuY2hpbGRyZW4oJ3RyJylbMF0sIAoJCQkJX2ZuR2V0RGF0YU1hc3Rlciggb1NldHRpbmdzICksIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCwgb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpLCBvU2V0dGluZ3MuYWlEaXNwbGF5IF0gKTsKCQkJCgkJCS8qIAoJCQkgKiBOZWVkIHRvIHJlbW92ZSBhbnkgb2xkIHJvdyBmcm9tIHRoZSBkaXNwbGF5IC0gbm90ZSB3ZSBjYW4ndCBqdXN0IGVtcHR5IHRoZSB0Ym9keSB1c2luZwoJCQkgKiAkKCkuaHRtbCgnJykgc2luY2UgdGhpcyB3aWxsIHVuYmluZCB0aGUgalF1ZXJ5IGV2ZW50IGhhbmRsZXJzIChldmVuIGFsdGhvdWdoIHRoZSBub2RlIAoJCQkgKiBzdGlsbCBleGlzdHMhKSAtIGVxdWFsbHkgd2UgY2FuJ3QgdXNlIGlubmVySFRNTCwgc2luY2UgSUUgdGhyb3dzIGFuIGV4Y2VwdGlvbi4KCQkJICovCgkJCXZhcgoJCQkJbkFkZEZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCgkJCQluUmVtb3ZlRnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKCQkJCW5Cb2R5UGFyLCBuVHJzOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3MublRCb2R5ICkKCQkJewoJCQkJbkJvZHlQYXIgPSBvU2V0dGluZ3MublRCb2R5LnBhcmVudE5vZGU7CgkJCQluUmVtb3ZlRnJhZy5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UQm9keSApOwoJCQkJCgkJCQkvKiBXaGVuIGRvaW5nIGluZmluaXRlIHNjcm9sbGluZywgb25seSByZW1vdmUgY2hpbGQgcm93cyB3aGVuIHNvcnRpbmcsIGZpbHRlcmluZyBvciBzdGFydAoJCQkJICogdXAuIFdoZW4gbm90IGluZmluaXRlIHNjcm9sbCwgYWx3YXlzIGRvIGl0LgoJCQkJICovCgkJCQlpZiAoICFvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgfHwgIW9TZXR0aW5ncy5fYkluaXRDb21wbGV0ZSB8fAoJCQkJIAlvU2V0dGluZ3MuYlNvcnRlZCB8fCBvU2V0dGluZ3MuYkZpbHRlcmVkICkKCQkJCXsKCQkJCQl3aGlsZSggKG4gPSBvU2V0dGluZ3MublRCb2R5LmZpcnN0Q2hpbGQpICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5uVEJvZHkucmVtb3ZlQ2hpbGQoIG4gKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIFB1dCB0aGUgZHJhdyB0YWJsZSBpbnRvIHRoZSBkb20gKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1hblJvd3MubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluQWRkRnJhZy5hcHBlbmRDaGlsZCggYW5Sb3dzW2ldICk7CgkJCQl9CgkJCQkKCQkJCW9TZXR0aW5ncy5uVEJvZHkuYXBwZW5kQ2hpbGQoIG5BZGRGcmFnICk7CgkJCQlpZiAoIG5Cb2R5UGFyICE9PSBudWxsICkKCQkJCXsKCQkJCQluQm9keVBhci5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UQm9keSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBDYWxsIGFsbCByZXF1aXJlZCBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHRoZSBlbmQgb2YgYSBkcmF3ICovCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9EcmF3Q2FsbGJhY2snLCAnZHJhdycsIFtvU2V0dGluZ3NdICk7CgkJCQoJCQkvKiBEcmF3IGlzIGNvbXBsZXRlLCBzb3J0aW5nIGFuZCBmaWx0ZXJpbmcgbXVzdCBiZSBhcyB3ZWxsICovCgkJCW9TZXR0aW5ncy5iU29ydGVkID0gZmFsc2U7CgkJCW9TZXR0aW5ncy5iRmlsdGVyZWQgPSBmYWxzZTsKCQkJb1NldHRpbmdzLmJEcmF3aW5nID0gZmFsc2U7CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJaWYgKCAhb1NldHRpbmdzLl9iSW5pdENvbXBsZXRlICkKCQkJCXsKCQkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncyApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlZHJhdyB0aGUgdGFibGUgLSB0YWtpbmcgYWNjb3VudCBvZiB0aGUgdmFyaW91cyBmZWF0dXJlcyB3aGljaCBhcmUgZW5hYmxlZAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlRHJhdyggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCS8qIFNvcnRpbmcgd2lsbCByZWZpbHRlciBhbmQgZHJhdyBmb3IgdXMgKi8KCQkJCV9mblNvcnQoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQkvKiBGaWx0ZXJpbmcgd2lsbCByZWRyYXcgZm9yIHVzICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQWRkIHRoZSBvcHRpb25zIHRvIHRoZSBwYWdlIEhUTUwgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkZE9wdGlvbnNIdG1sICggb1NldHRpbmdzICkKCQl7CgkJCS8qCgkJCSAqIENyZWF0ZSBhIHRlbXBvcmFyeSwgZW1wdHksIGRpdiB3aGljaCB3ZSBjYW4gbGF0ZXIgb24gcmVwbGFjZSB3aXRoIHdoYXQgd2UgaGF2ZSBnZW5lcmF0ZWQKCQkJICogd2UgZG8gaXQgdGhpcyB3YXkgdG8gcmVuZGVyaW5nIHRoZSAnb3B0aW9ucycgaHRtbCBvZmZsaW5lIC0gc3BlZWQgOi0pCgkJCSAqLwoJCQl2YXIgbkhvbGRpbmcgPSAkKCc8ZGl2PjwvZGl2PicpWzBdOwoJCQlvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBuSG9sZGluZywgb1NldHRpbmdzLm5UYWJsZSApOwoJCQkKCQkJLyogCgkJCSAqIEFsbCBEYXRhVGFibGVzIGFyZSB3cmFwcGVkIGluIGEgZGl2CgkJCSAqLwoJCQlvU2V0dGluZ3MublRhYmxlV3JhcHBlciA9ICQoJzxkaXYgaWQ9Iicrb1NldHRpbmdzLnNUYWJsZUlkKydfd3JhcHBlciIgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNXcmFwcGVyKyciIHJvbGU9ImdyaWQiPjwvZGl2PicpWzBdOwoJCQlvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgPSBvU2V0dGluZ3MublRhYmxlLm5leHRTaWJsaW5nOwoJCQoJCQkvKiBUcmFjayB3aGVyZSB3ZSB3YW50IHRvIGluc2VydCB0aGUgb3B0aW9uICovCgkJCXZhciBuSW5zZXJ0Tm9kZSA9IG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyOwoJCQkKCQkJLyogTG9vcCBvdmVyIHRoZSB1c2VyIHNldCBwb3NpdGlvbmluZyBhbmQgcGxhY2UgdGhlIGVsZW1lbnRzIGFzIG5lZWRlZCAqLwoJCQl2YXIgYURvbSA9IG9TZXR0aW5ncy5zRG9tLnNwbGl0KCcnKTsKCQkJdmFyIG5UbXAsIGlQdXNoRmVhdHVyZSwgY09wdGlvbiwgbk5ld05vZGUsIGNOZXh0LCBzQXR0ciwgajsKCQkJZm9yICggdmFyIGk9MCA7IGk8YURvbS5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpUHVzaEZlYXR1cmUgPSAwOwoJCQkJY09wdGlvbiA9IGFEb21baV07CgkJCQkKCQkJCWlmICggY09wdGlvbiA9PSAnPCcgKQoJCQkJewoJCQkJCS8qIE5ldyBjb250YWluZXIgZGl2ICovCgkJCQkJbk5ld05vZGUgPSAkKCc8ZGl2PjwvZGl2PicpWzBdOwoJCQkJCQoJCQkJCS8qIENoZWNrIHRvIHNlZSBpZiB3ZSBzaG91bGQgYXBwZW5kIGFuIGlkIGFuZC9vciBhIGNsYXNzIG5hbWUgdG8gdGhlIGNvbnRhaW5lciAqLwoJCQkJCWNOZXh0ID0gYURvbVtpKzFdOwoJCQkJCWlmICggY05leHQgPT0gIiciIHx8IGNOZXh0ID09ICciJyApCgkJCQkJewoJCQkJCQlzQXR0ciA9ICIiOwoJCQkJCQlqID0gMjsKCQkJCQkJd2hpbGUgKCBhRG9tW2kral0gIT0gY05leHQgKQoJCQkJCQl7CgkJCQkJCQlzQXR0ciArPSBhRG9tW2kral07CgkJCQkJCQlqKys7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIFJlcGxhY2UgalF1ZXJ5IFVJIGNvbnN0YW50cyAqLwoJCQkJCQlpZiAoIHNBdHRyID09ICJIIiApCgkJCQkJCXsKCQkJCQkJCXNBdHRyID0gb1NldHRpbmdzLm9DbGFzc2VzLnNKVUlIZWFkZXI7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHNBdHRyID09ICJGIiApCgkJCQkJCXsKCQkJCQkJCXNBdHRyID0gb1NldHRpbmdzLm9DbGFzc2VzLnNKVUlGb290ZXI7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIFRoZSBhdHRyaWJ1dGUgY2FuIGJlIGluIHRoZSBmb3JtYXQgb2YgIiNpZC5jbGFzcyIsICIjaWQiIG9yICJjbGFzcyIgVGhpcyBsb2dpYwoJCQkJCQkgKiBicmVha3MgdGhlIHN0cmluZyBpbnRvIHBhcnRzIGFuZCBhcHBsaWVzIHRoZW0gYXMgbmVlZGVkCgkJCQkJCSAqLwoJCQkJCQlpZiAoIHNBdHRyLmluZGV4T2YoJy4nKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCXZhciBhU3BsaXQgPSBzQXR0ci5zcGxpdCgnLicpOwoJCQkJCQkJbk5ld05vZGUuaWQgPSBhU3BsaXRbMF0uc3Vic3RyKDEsIGFTcGxpdFswXS5sZW5ndGgtMSk7CgkJCQkJCQluTmV3Tm9kZS5jbGFzc05hbWUgPSBhU3BsaXRbMV07CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHNBdHRyLmNoYXJBdCgwKSA9PSAiIyIgKQoJCQkJCQl7CgkJCQkJCQluTmV3Tm9kZS5pZCA9IHNBdHRyLnN1YnN0cigxLCBzQXR0ci5sZW5ndGgtMSk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQluTmV3Tm9kZS5jbGFzc05hbWUgPSBzQXR0cjsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJaSArPSBqOyAvKiBNb3ZlIGFsb25nIHRoZSBwb3NpdGlvbiBhcnJheSAqLwoJCQkJCX0KCQkJCQkKCQkJCQluSW5zZXJ0Tm9kZS5hcHBlbmRDaGlsZCggbk5ld05vZGUgKTsKCQkJCQluSW5zZXJ0Tm9kZSA9IG5OZXdOb2RlOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJz4nICkKCQkJCXsKCQkJCQkvKiBFbmQgY29udGFpbmVyIGRpdiAqLwoJCQkJCW5JbnNlcnROb2RlID0gbkluc2VydE5vZGUucGFyZW50Tm9kZTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdsJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJMZW5ndGhDaGFuZ2UgKQoJCQkJewoJCQkJCS8qIExlbmd0aCAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbExlbmd0aCggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdmJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQkJewoJCQkJCS8qIEZpbHRlciAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbEZpbHRlciggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdyJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQcm9jZXNzaW5nICkKCQkJCXsKCQkJCQkvKiBwUm9jZXNzaW5nICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICd0JyApCgkJCQl7CgkJCQkJLyogVGFibGUgKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxUYWJsZSggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICAnaScgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iSW5mbyApCgkJCQl7CgkJCQkJLyogSW5mbyAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbEluZm8oIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAncCcgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgKQoJCQkJewoJCQkJCS8qIFBhZ2luYXRpb24gKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBEYXRhVGFibGUuZXh0LmFvRmVhdHVyZXMubGVuZ3RoICE9PSAwICkKCQkJCXsKCQkJCQkvKiBQbHVnLWluIGZlYXR1cmVzICovCgkJCQkJdmFyIGFvRmVhdHVyZXMgPSBEYXRhVGFibGUuZXh0LmFvRmVhdHVyZXM7CgkJCQkJZm9yICggdmFyIGs9MCwga0xlbj1hb0ZlYXR1cmVzLmxlbmd0aCA7IGs8a0xlbiA7IGsrKyApCgkJCQkJewoJCQkJCQlpZiAoIGNPcHRpb24gPT0gYW9GZWF0dXJlc1trXS5jRmVhdHVyZSApCgkJCQkJCXsKCQkJCQkJCW5UbXAgPSBhb0ZlYXR1cmVzW2tdLmZuSW5pdCggb1NldHRpbmdzICk7CgkJCQkJCQlpZiAoIG5UbXAgKQoJCQkJCQkJewoJCQkJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQWRkIHRvIHRoZSAyRCBmZWF0dXJlcyBhcnJheSAqLwoJCQkJaWYgKCBpUHVzaEZlYXR1cmUgPT0gMSAmJiBuVG1wICE9PSBudWxsICkKCQkJCXsKCQkJCQlpZiAoIHR5cGVvZiBvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0gIT09ICdvYmplY3QnICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hYW5GZWF0dXJlc1tjT3B0aW9uXSA9IFtdOwoJCQkJCX0KCQkJCQlvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0ucHVzaCggblRtcCApOwoJCQkJCW5JbnNlcnROb2RlLmFwcGVuZENoaWxkKCBuVG1wICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEJ1aWx0IG91ciBET00gc3RydWN0dXJlIC0gcmVwbGFjZSB0aGUgaG9sZGluZyBkaXYgd2l0aCB3aGF0IHdlIHdhbnQgKi8KCQkJbkhvbGRpbmcucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoIG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyLCBuSG9sZGluZyApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVc2UgdGhlIERPTSBzb3VyY2UgdG8gY3JlYXRlIHVwIGFuIGFycmF5IG9mIGhlYWRlciBjZWxscy4gVGhlIGlkZWEgaGVyZSBpcyB0bwoJCSAqIGNyZWF0ZSBhIGxheW91dCBncmlkIChhcnJheSkgb2Ygcm93cyB4IGNvbHVtbnMsIHdoaWNoIGNvbnRhaW5zIGEgcmVmZXJlbmNlCgkJICogdG8gdGhlIGNlbGwgdGhhdCB0aGF0IHBvaW50IGluIHRoZSBncmlkIChyZWdhcmRsZXNzIG9mIGNvbC9yb3dzcGFuKSwgc3VjaCB0aGF0CgkJICogYW55IGNvbHVtbiAvIHJvdyBjb3VsZCBiZSByZW1vdmVkIGFuZCB0aGUgbmV3IGdyaWQgY29uc3RydWN0ZWQKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3R9IGFMYXlvdXQgQXJyYXkgdG8gc3RvcmUgdGhlIGNhbGN1bGF0ZWQgbGF5b3V0IGluCgkJICogIEBwYXJhbSB7bm9kZX0gblRoZWFkIFRoZSBoZWFkZXIvZm9vdGVyIGVsZW1lbnQgZm9yIHRoZSB0YWJsZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EZXRlY3RIZWFkZXIgKCBhTGF5b3V0LCBuVGhlYWQgKQoJCXsKCQkJdmFyIG5UcnMgPSAkKG5UaGVhZCkuY2hpbGRyZW4oJ3RyJyk7CgkJCXZhciBuVHIsIG5DZWxsOwoJCQl2YXIgaSwgaywgbCwgaUxlbiwgakxlbiwgaUNvbFNoaWZ0ZWQsIGlDb2x1bW4sIGlDb2xzcGFuLCBpUm93c3BhbjsKCQkJdmFyIGJVbmlxdWU7CgkJCXZhciBmblNoaWZ0Q29sID0gZnVuY3Rpb24gKCBhLCBpLCBqICkgewoJCQkJdmFyIGsgPSBhW2ldOwoJCSAgICAgICAgICAgICAgICB3aGlsZSAoIGtbal0gKSB7CgkJCQkJaisrOwoJCQkJfQoJCQkJcmV0dXJuIGo7CgkJCX07CgkJCgkJCWFMYXlvdXQuc3BsaWNlKCAwLCBhTGF5b3V0Lmxlbmd0aCApOwoJCQkKCQkJLyogV2Uga25vdyBob3cgbWFueSByb3dzIHRoZXJlIGFyZSBpbiB0aGUgbGF5b3V0IC0gc28gcHJlcCBpdCAqLwoJCQlmb3IgKCBpPTAsIGlMZW49blRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlhTGF5b3V0LnB1c2goIFtdICk7CgkJCX0KCQkJCgkJCS8qIENhbGN1bGF0ZSBhIGxheW91dCBhcnJheSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49blRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQluVHIgPSBuVHJzW2ldOwoJCQkJaUNvbHVtbiA9IDA7CgkJCQkKCQkJCS8qIEZvciBldmVyeSBjZWxsIGluIHRoZSByb3cuLi4gKi8KCQkJCW5DZWxsID0gblRyLmZpcnN0Q2hpbGQ7CgkJCQl3aGlsZSAoIG5DZWxsICkgewoJCQkJCWlmICggbkNlbGwubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVEQiIHx8CgkJCQkJICAgICBuQ2VsbC5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09ICJUSCIgKQoJCQkJCXsKCQkJCQkJLyogR2V0IHRoZSBjb2wgYW5kIHJvd3NwYW4gYXR0cmlidXRlcyBmcm9tIHRoZSBET00gYW5kIHNhbml0aXNlIHRoZW0gKi8KCQkJCQkJaUNvbHNwYW4gPSBuQ2VsbC5nZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nKSAqIDE7CgkJCQkJCWlSb3dzcGFuID0gbkNlbGwuZ2V0QXR0cmlidXRlKCdyb3dzcGFuJykgKiAxOwoJCQkJCQlpQ29sc3BhbiA9ICghaUNvbHNwYW4gfHwgaUNvbHNwYW49PT0wIHx8IGlDb2xzcGFuPT09MSkgPyAxIDogaUNvbHNwYW47CgkJCQkJCWlSb3dzcGFuID0gKCFpUm93c3BhbiB8fCBpUm93c3Bhbj09PTAgfHwgaVJvd3NwYW49PT0xKSA/IDEgOiBpUm93c3BhbjsKCQkKCQkJCQkJLyogVGhlcmUgbWlnaHQgYmUgY29sc3BhbiBjZWxscyBhbHJlYWR5IGluIHRoaXMgcm93LCBzbyBzaGlmdCBvdXIgdGFyZ2V0IAoJCQkJCQkgKiBhY2NvcmRpbmdseQoJCQkJCQkgKi8KCQkJCQkJaUNvbFNoaWZ0ZWQgPSBmblNoaWZ0Q29sKCBhTGF5b3V0LCBpLCBpQ29sdW1uICk7CgkJCQkJCQoJCQkJCQkvKiBDYWNoZSBjYWxjdWxhdGlvbiBmb3IgdW5pcXVlIGNvbHVtbnMgKi8KCQkJCQkJYlVuaXF1ZSA9IGlDb2xzcGFuID09PSAxID8gdHJ1ZSA6IGZhbHNlOwoJCQkJCQkKCQkJCQkJLyogSWYgdGhlcmUgaXMgY29sIC8gcm93c3BhbiwgY29weSB0aGUgaW5mb3JtYXRpb24gaW50byB0aGUgbGF5b3V0IGdyaWQgKi8KCQkJCQkJZm9yICggbD0wIDsgbDxpQ29sc3BhbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGs9MCA7IGs8aVJvd3NwYW4gOyBrKysgKQoJCQkJCQkJewoJCQkJCQkJCWFMYXlvdXRbaStrXVtpQ29sU2hpZnRlZCtsXSA9IHsKCQkJCQkJCQkJImNlbGwiOiBuQ2VsbCwKCQkJCQkJCQkJInVuaXF1ZSI6IGJVbmlxdWUKCQkJCQkJCQl9OwoJCQkJCQkJCWFMYXlvdXRbaStrXS5uVHIgPSBuVHI7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJbkNlbGwgPSBuQ2VsbC5uZXh0U2libGluZzsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgdW5pcXVlIHRoIGVsZW1lbnRzLCBvbmUgZm9yIGVhY2ggY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZGVyIGF1dG9tYXRpY2FsbHkgZGV0ZWN0IHRoZSBsYXlvdXQgZnJvbSB0aGlzIG5vZGUgLSBvcHRpb25hbAoJCSAqICBAcGFyYW0ge2FycmF5fSBhTGF5b3V0IHRoZWFkL3Rmb290IGxheW91dCBmcm9tIF9mbkRldGVjdEhlYWRlciAtIG9wdGlvbmFsCgkJICogIEByZXR1cm5zIGFycmF5IHtub2RlfSBhUmV0dXJuIGxpc3Qgb2YgdW5pcXVlIHRoJ3MKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0VW5pcXVlVGhzICggb1NldHRpbmdzLCBuSGVhZGVyLCBhTGF5b3V0ICkKCQl7CgkJCXZhciBhUmV0dXJuID0gW107CgkJCWlmICggIWFMYXlvdXQgKQoJCQl7CgkJCQlhTGF5b3V0ID0gb1NldHRpbmdzLmFvSGVhZGVyOwoJCQkJaWYgKCBuSGVhZGVyICkKCQkJCXsKCQkJCQlhTGF5b3V0ID0gW107CgkJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBhTGF5b3V0LCBuSGVhZGVyICk7CgkJCQl9CgkJCX0KCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hTGF5b3V0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAsIGpMZW49YUxheW91dFtpXS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggYUxheW91dFtpXVtqXS51bmlxdWUgJiYgCgkJCQkJCSAoIWFSZXR1cm5bal0gfHwgIW9TZXR0aW5ncy5iU29ydENlbGxzVG9wKSApCgkJCQkJewoJCQkJCQlhUmV0dXJuW2pdID0gYUxheW91dFtpXVtqXS5jZWxsOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFSZXR1cm47CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSB0aGUgdGFibGUgdXNpbmcgYW4gQWpheCBjYWxsCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IEJsb2NrIHRoZSB0YWJsZSBkcmF3aW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BamF4VXBkYXRlKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ICkKCQkJewoJCQkJb1NldHRpbmdzLmlEcmF3Kys7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJCXZhciBhb0RhdGEgPSBfZm5BamF4UGFyYW1ldGVycyggb1NldHRpbmdzICk7CgkJCQlfZm5TZXJ2ZXJQYXJhbXMoIG9TZXR0aW5ncywgYW9EYXRhICk7CgkJCQkKCQkJCW9TZXR0aW5ncy5mblNlcnZlckRhdGEuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLnNBamF4U291cmNlLCBhb0RhdGEsCgkJCQkJZnVuY3Rpb24oanNvbikgewoJCQkJCQlfZm5BamF4VXBkYXRlRHJhdyggb1NldHRpbmdzLCBqc29uICk7CgkJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBCdWlsZCB1cCB0aGUgcGFyYW1ldGVycyBpbiBhbiBvYmplY3QgbmVlZGVkIGZvciBhIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgcmVxdWVzdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sfSBibG9jayB0aGUgdGFibGUgZHJhd2luZyBvciBub3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWpheFBhcmFtZXRlcnMoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGFvRGF0YSA9IFtdLCBtRGF0YVByb3AsIGFhU29ydCwgYURhdGFTb3J0OwoJCQl2YXIgaSwgajsKCQkJCgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNFY2hvIiwgICAgICAgICAgInZhbHVlIjogb1NldHRpbmdzLmlEcmF3IH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaUNvbHVtbnMiLCAgICAgICAidmFsdWUiOiBpQ29sdW1ucyB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNDb2x1bW5zIiwgICAgICAgInZhbHVlIjogX2ZuQ29sdW1uT3JkZXJpbmcob1NldHRpbmdzKSB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlEaXNwbGF5U3RhcnQiLCAgInZhbHVlIjogb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaURpc3BsYXlMZW5ndGgiLCAidmFsdWUiOiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSAhPT0gZmFsc2UgPwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA6IC0xIH0gKTsKCQkJCQoJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bW5zIDsgaSsrICkKCQkJewoJCQkgIG1EYXRhUHJvcCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ubURhdGE7CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJtRGF0YVByb3BfIitpLCAidmFsdWUiOiB0eXBlb2YobURhdGFQcm9wKT09PSJmdW5jdGlvbiIgPyAnZnVuY3Rpb24nIDogbURhdGFQcm9wIH0gKTsKCQkJfQoJCQkKCQkJLyogRmlsdGVyaW5nICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICE9PSBmYWxzZSApCgkJCXsKCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNTZWFyY2giLCAidmFsdWUiOiBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLnNTZWFyY2ggfSApOwoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiYlJlZ2V4IiwgICJ2YWx1ZSI6IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2guYlJlZ2V4IH0gKTsKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJewoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNTZWFyY2hfIitpLCAgICAgInZhbHVlIjogb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1tpXS5zU2VhcmNoIH0gKTsKCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiUmVnZXhfIitpLCAgICAgICJ2YWx1ZSI6IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbaV0uYlJlZ2V4IH0gKTsKCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiU2VhcmNoYWJsZV8iK2ksICJ2YWx1ZSI6IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNlYXJjaGFibGUgfSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBTb3J0aW5nICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCAhPT0gZmFsc2UgKQoJCQl7CgkJCQl2YXIgaUNvdW50ZXIgPSAwOwoJCQoJCQkJYWFTb3J0ID0gKCBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwgKSA/CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkLmNvbmNhdCggb1NldHRpbmdzLmFhU29ydGluZyApIDoKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCQkKCQkJCWZvciAoIGk9MCA7IGk8YWFTb3J0Lmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJYURhdGFTb3J0ID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgYWFTb3J0W2ldWzBdIF0uYURhdGFTb3J0OwoJCQkJCQoJCQkJCWZvciAoIGo9MCA7IGo8YURhdGFTb3J0Lmxlbmd0aCA7IGorKyApCgkJCQkJewoJCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpU29ydENvbF8iK2lDb3VudGVyLCAgInZhbHVlIjogYURhdGFTb3J0W2pdIH0gKTsKCQkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NvcnREaXJfIitpQ291bnRlciwgICJ2YWx1ZSI6IGFhU29ydFtpXVsxXSB9ICk7CgkJCQkJCWlDb3VudGVyKys7CgkJCQkJfQoJCQkJfQoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaVNvcnRpbmdDb2xzIiwgICAidmFsdWUiOiBpQ291bnRlciB9ICk7CgkJCQkKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJewoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJTb3J0YWJsZV8iK2ksICAidmFsdWUiOiBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSB9ICk7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBhb0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBBamF4IHBhcmFtZXRlcnMgZnJvbSBwbHVnLWlucwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSBhcnJheSB7b2JqZWN0c30gYW9EYXRhIG5hbWUvdmFsdWUgcGFpcnMgdG8gc2VuZCB0byB0aGUgc2VydmVyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKQoJCXsKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1NlcnZlclBhcmFtcycsICdzZXJ2ZXJQYXJhbXMnLCBbYW9EYXRhXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBEYXRhIHRoZSBkYXRhIGZyb20gdGhlIHNlcnZlciAobnVraW5nIHRoZSBvbGQpIGFuZCByZWRyYXcgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24ganNvbiBkYXRhIHJldHVybiBmcm9tIHRoZSBzZXJ2ZXIuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBqc29uLnNFY2hvIFRyYWNraW5nIGZsYWcgZm9yIERhdGFUYWJsZXMgdG8gbWF0Y2ggcmVxdWVzdHMKCQkgKiAgQHBhcmFtIHtpbnR9IGpzb24uaVRvdGFsUmVjb3JkcyBOdW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgZGF0YSBzZXQsIG5vdCBhY2NvdW50aW5nIGZvciBmaWx0ZXJpbmcKCQkgKiAgQHBhcmFtIHtpbnR9IGpzb24uaVRvdGFsRGlzcGxheVJlY29yZHMgTnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGRhdGEgc2V0LCBhY2NvdW50aW5nIGZvciBmaWx0ZXJpbmcKCQkgKiAgQHBhcmFtIHthcnJheX0ganNvbi5hYURhdGEgVGhlIGRhdGEgdG8gZGlzcGxheSBvbiB0aGlzIHBhZ2UKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtqc29uLnNDb2x1bW5zXSBDb2x1bW4gb3JkZXJpbmcgKHNOYW1lLCBjb21tYSBzZXBhcmF0ZWQpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFqYXhVcGRhdGVEcmF3ICggb1NldHRpbmdzLCBqc29uICkKCQl7CgkJCWlmICgganNvbi5zRWNobyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJLyogUHJvdGVjdCBhZ2FpbnN0IG9sZCByZXR1cm5zIG92ZXItd3JpdGluZyBhIG5ldyBvbmUuIFBvc3NpYmxlIHdoZW4geW91IGdldAoJCQkJICogdmVyeSBmYXN0IGludGVyYWN0aW9uLCBhbmQgbGF0ZXIgcXVlcmllcyBhcmUgY29tcGxldGVkIG11Y2ggZmFzdGVyCgkJCQkgKi8KCQkJCWlmICgganNvbi5zRWNobyoxIDwgb1NldHRpbmdzLmlEcmF3ICkKCQkJCXsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLmlEcmF3ID0ganNvbi5zRWNobyAqIDE7CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggIW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSB8fAoJCQkJICAgKG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSAmJiAob1NldHRpbmdzLmJTb3J0ZWQgfHwgb1NldHRpbmdzLmJGaWx0ZXJlZCkpICkKCQkJewoJCQkJX2ZuQ2xlYXJUYWJsZSggb1NldHRpbmdzICk7CgkJCX0KCQkJb1NldHRpbmdzLl9pUmVjb3Jkc1RvdGFsID0gcGFyc2VJbnQoanNvbi5pVG90YWxSZWNvcmRzLCAxMCk7CgkJCW9TZXR0aW5ncy5faVJlY29yZHNEaXNwbGF5ID0gcGFyc2VJbnQoanNvbi5pVG90YWxEaXNwbGF5UmVjb3JkcywgMTApOwoJCQkKCQkJLyogRGV0ZXJtaW5lIGlmIHJlb3JkZXJpbmcgaXMgcmVxdWlyZWQgKi8KCQkJdmFyIHNPcmRlcmluZyA9IF9mbkNvbHVtbk9yZGVyaW5nKG9TZXR0aW5ncyk7CgkJCXZhciBiUmVPcmRlciA9IChqc29uLnNDb2x1bW5zICE9PSB1bmRlZmluZWQgJiYgc09yZGVyaW5nICE9PSAiIiAmJiBqc29uLnNDb2x1bW5zICE9IHNPcmRlcmluZyApOwoJCQl2YXIgYWlJbmRleDsKCQkJaWYgKCBiUmVPcmRlciApCgkJCXsKCQkJCWFpSW5kZXggPSBfZm5SZU9yZGVySW5kZXgoIG9TZXR0aW5ncywganNvbi5zQ29sdW1ucyApOwoJCQl9CgkJCQoJCQl2YXIgYURhdGEgPSBfZm5HZXRPYmplY3REYXRhRm4oIG9TZXR0aW5ncy5zQWpheERhdGFQcm9wICkoIGpzb24gKTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGJSZU9yZGVyICkKCQkJCXsKCQkJCQkvKiBJZiB3ZSBuZWVkIHRvIHJlLW9yZGVyLCB0aGVuIGNyZWF0ZSBhIG5ldyBhcnJheSB3aXRoIHRoZSBjb3JyZWN0IG9yZGVyIGFuZCBhZGQgaXQgKi8KCQkJCQl2YXIgYURhdGFTb3J0ZWQgPSBbXTsKCQkJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydGVkLnB1c2goIGFEYXRhW2ldWyBhaUluZGV4W2pdIF0gKTsKCQkJCQl9CgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBhRGF0YVNvcnRlZCApOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIE5vIHJlLW9yZGVyIHJlcXVpcmVkLCBzZXZlciBnb3QgaXQgInJpZ2h0IiAtIGp1c3Qgc3RyYWlnaHQgYWRkICovCgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBhRGF0YVtpXSApOwoJCQkJfQoJCQl9CgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQlvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ID0gZmFsc2U7CgkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQlvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ID0gdHJ1ZTsKCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIGZpbHRlcmluZyB0ZXh0CgkJICogIEByZXR1cm5zIHtub2RlfSBGaWx0ZXIgY29udHJvbCBlbGVtZW50CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxGaWx0ZXIgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIG9QcmV2aW91c1NlYXJjaCA9IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2g7CgkJCQoJCQl2YXIgc1NlYXJjaFN0ciA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1NlYXJjaDsKCQkJc1NlYXJjaFN0ciA9IChzU2VhcmNoU3RyLmluZGV4T2YoJ19JTlBVVF8nKSAhPT0gLTEpID8KCQkJICBzU2VhcmNoU3RyLnJlcGxhY2UoJ19JTlBVVF8nLCAnPGlucHV0IHR5cGU9InRleHQiIC8+JykgOgoJCQkgIHNTZWFyY2hTdHI9PT0iIiA/ICc8aW5wdXQgdHlwZT0idGV4dCIgLz4nIDogc1NlYXJjaFN0cisnIDxpbnB1dCB0eXBlPSJ0ZXh0IiAvPic7CgkJCQoJCQl2YXIgbkZpbHRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCW5GaWx0ZXIuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNGaWx0ZXI7CgkJCW5GaWx0ZXIuaW5uZXJIVE1MID0gJzxsYWJlbD4nK3NTZWFyY2hTdHIrJzwvbGFiZWw+JzsKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmYgKQoJCQl7CgkJCQluRmlsdGVyLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfZmlsdGVyJzsKCQkJfQoJCQkKCQkJdmFyIGpxRmlsdGVyID0gJCgnaW5wdXRbdHlwZT0idGV4dCJdJywgbkZpbHRlcik7CgkJCgkJCS8vIFN0b3JlIGEgcmVmZXJlbmNlIHRvIHRoZSBpbnB1dCBlbGVtZW50LCBzbyBvdGhlciBpbnB1dCBlbGVtZW50cyBjb3VsZCBiZQoJCQkvLyBhZGRlZCB0byB0aGUgZmlsdGVyIHdyYXBwZXIgaWYgbmVlZGVkIChzdWJtaXQgYnV0dG9uIGZvciBleGFtcGxlKQoJCQluRmlsdGVyLl9EVF9JbnB1dCA9IGpxRmlsdGVyWzBdOwoJCQoJCQlqcUZpbHRlci52YWwoIG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoLnJlcGxhY2UoJyInLCcmcXVvdDsnKSApOwoJCQlqcUZpbHRlci5iaW5kKCAna2V5dXAuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGZpbHRlciBpbnB1dCBlbGVtZW50cyBmb3IgdGhlIG5ldyBkaXNwbGF5ICovCgkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJdmFyIHZhbCA9IHRoaXMudmFsdWU9PT0iIiA/ICIiIDogdGhpcy52YWx1ZTsgLy8gbWVudGFsIElFOCBmaXggOi0oCgkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG5baV0gIT0gJCh0aGlzKS5wYXJlbnRzKCdkaXYuZGF0YVRhYmxlc19maWx0ZXInKVswXSApCgkJCQkJewoJCQkJCQkkKG5baV0uX0RUX0lucHV0KS52YWwoIHZhbCApOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogTm93IGRvIHRoZSBmaWx0ZXIgKi8KCQkJCWlmICggdmFsICE9IG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoICkKCQkJCXsKCQkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCB7IAoJCQkJCQkic1NlYXJjaCI6IHZhbCwgCgkJCQkJCSJiUmVnZXgiOiBvUHJldmlvdXNTZWFyY2guYlJlZ2V4LAoJCQkJCQkiYlNtYXJ0Ijogb1ByZXZpb3VzU2VhcmNoLmJTbWFydCAsCgkJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogb1ByZXZpb3VzU2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgCgkJCQkJfSApOwoJCQkJfQoJCQl9ICk7CgkJCgkJCWpxRmlsdGVyCgkJCQkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkJLyogUHJldmVudCBmb3JtIHN1Ym1pc3Npb24gKi8KCQkJCQlpZiAoIGUua2V5Q29kZSA9PSAxMyApCgkJCQkJewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQkpOwoJCQkKCQkJcmV0dXJuIG5GaWx0ZXI7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgdGFibGUgdXNpbmcgYm90aCB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgY29sdW1uIGJhc2VkIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2VhcmNoIHNlYXJjaCBpbmZvcm1hdGlvbgoJCSAqICBAcGFyYW0ge2ludH0gW2lGb3JjZV0gZm9yY2UgYSByZXNlYXJjaCBvZiB0aGUgbWFzdGVyIGFycmF5ICgxKSBvciBub3QgKHVuZGVmaW5lZCBvciAwKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb21wbGV0ZSAoIG9TZXR0aW5ncywgb0lucHV0LCBpRm9yY2UgKQoJCXsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJdmFyIGFvUHJldlNlYXJjaCA9IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHM7CgkJCXZhciBmblNhdmVGaWx0ZXIgPSBmdW5jdGlvbiAoIG9GaWx0ZXIgKSB7CgkJCQkvKiBTYXZlIHRoZSBmaWx0ZXJpbmcgdmFsdWVzICovCgkJCQlvUHJldlNlYXJjaC5zU2VhcmNoID0gb0ZpbHRlci5zU2VhcmNoOwoJCQkJb1ByZXZTZWFyY2guYlJlZ2V4ID0gb0ZpbHRlci5iUmVnZXg7CgkJCQlvUHJldlNlYXJjaC5iU21hcnQgPSBvRmlsdGVyLmJTbWFydDsKCQkJCW9QcmV2U2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgPSBvRmlsdGVyLmJDYXNlSW5zZW5zaXRpdmU7CgkJCX07CgkJCgkJCS8qIEluIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgYWxsIGZpbHRlcmluZyBpcyBkb25lIGJ5IHRoZSBzZXJ2ZXIsIHNvIG5vIHBvaW50IGhhbmdpbmcgYXJvdW5kIGhlcmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCS8qIEdsb2JhbCBmaWx0ZXIgKi8KCQkJCV9mbkZpbHRlciggb1NldHRpbmdzLCBvSW5wdXQuc1NlYXJjaCwgaUZvcmNlLCBvSW5wdXQuYlJlZ2V4LCBvSW5wdXQuYlNtYXJ0LCBvSW5wdXQuYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQkJZm5TYXZlRmlsdGVyKCBvSW5wdXQgKTsKCQkKCQkJCS8qIE5vdyBkbyB0aGUgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVyICovCgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJX2ZuRmlsdGVyQ29sdW1uKCBvU2V0dGluZ3MsIGFvUHJldlNlYXJjaFtpXS5zU2VhcmNoLCBpLCBhb1ByZXZTZWFyY2hbaV0uYlJlZ2V4LCAKCQkJCQkJYW9QcmV2U2VhcmNoW2ldLmJTbWFydCwgYW9QcmV2U2VhcmNoW2ldLmJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJCX0KCQkJCQoJCQkJLyogQ3VzdG9tIGZpbHRlcmluZyAqLwoJCQkJX2ZuRmlsdGVyQ3VzdG9tKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWZuU2F2ZUZpbHRlciggb0lucHV0ICk7CgkJCX0KCQkJCgkJCS8qIFRlbGwgdGhlIGRyYXcgZnVuY3Rpb24gd2UgaGF2ZSBiZWVuIGZpbHRlcmluZyAqLwoJCQlvU2V0dGluZ3MuYkZpbHRlcmVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdmaWx0ZXInLCBvU2V0dGluZ3MpOwoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8qIFJlYnVpbGQgc2VhcmNoIGFycmF5ICdvZmZsaW5lJyAqLwoJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDAgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgY3VzdG9tIGZpbHRlcmluZyBmdW5jdGlvbnMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDdXN0b20oIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYWZuRmlsdGVycyA9IERhdGFUYWJsZS5leHQuYWZuRmlsdGVyaW5nOwoJCQl2YXIgYWlGaWx0ZXJDb2x1bW5zID0gX2ZuR2V0Q29sdW1ucyggb1NldHRpbmdzLCAnYlNlYXJjaGFibGUnICk7CgkJCgkJCWZvciAoIHZhciBpPTAsIGlMZW49YWZuRmlsdGVycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgaUNvcnJlY3RvciA9IDA7CgkJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQl2YXIgaURpc0luZGV4ID0gb1NldHRpbmdzLmFpRGlzcGxheVtqLWlDb3JyZWN0b3JdOwoJCQkJCXZhciBiVGVzdCA9IGFmbkZpbHRlcnNbaV0oCgkJCQkJCW9TZXR0aW5ncywKCQkJCQkJX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpRGlzSW5kZXgsICdmaWx0ZXInLCBhaUZpbHRlckNvbHVtbnMgKSwKCQkJCQkJaURpc0luZGV4CgkJCQkJKTsKCQkJCQkKCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgdXNlIHRoaXMgcm93IGJhc2VkIG9uIHRoZSBmaWx0ZXJpbmcgZnVuY3Rpb24gKi8KCQkJCQlpZiAoICFiVGVzdCApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggai1pQ29ycmVjdG9yLCAxICk7CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSB0YWJsZSBvbiBhIHBlci1jb2x1bW4gYmFzaXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2x1bW4gY29sdW1uIHRvIGZpbHRlcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBzZWFyY2ggc3RyaW5nIGFzIGEgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTbWFydCB1c2Ugc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb2x1bW4gKCBvU2V0dGluZ3MsIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJaWYgKCBzSW5wdXQgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJdmFyIHJwU2VhcmNoID0gX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoKCBzSW5wdXQsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICk7CgkJCQoJCQlmb3IgKCB2YXIgaT1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCXZhciBzRGF0YSA9IF9mbkRhdGFUb1NlYXJjaCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtpXSwgaUNvbHVtbiwgJ2ZpbHRlcicgKSwKCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLnNUeXBlICk7CgkJCQlpZiAoICEgcnBTZWFyY2gudGVzdCggc0RhdGEgKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIGksIDEgKTsKCQkJCQlpSW5kZXhDb3JyZWN0b3IrKzsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIGRhdGEgdGFibGUgYmFzZWQgb24gdXNlciBpbnB1dCBhbmQgZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlGb3JjZSBvcHRpb25hbCAtIGZvcmNlIGEgcmVzZWFyY2ggb2YgdGhlIG1hc3RlciBhcnJheSAoMSkgb3Igbm90ICh1bmRlZmluZWQgb3IgMCkKCQkgKiAgQHBhcmFtIHtib29sfSBiUmVnZXggdHJlYXQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNtYXJ0IHBlcmZvcm0gc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXIoIG9TZXR0aW5ncywgc0lucHV0LCBpRm9yY2UsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBpOwoJCQl2YXIgcnBTZWFyY2ggPSBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNJbnB1dCwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIGFyZSBmb3JjaW5nIG9yIG5vdCAtIG9wdGlvbmFsIHBhcmFtZXRlciAqLwoJCQlpZiAoICFpRm9yY2UgKQoJCQl7CgkJCQlpRm9yY2UgPSAwOwoJCQl9CgkJCQoJCQkvKiBOZWVkIHRvIHRha2UgYWNjb3VudCBvZiBjdXN0b20gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIGFsd2F5cyBmaWx0ZXIgKi8KCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmbkZpbHRlcmluZy5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlpRm9yY2UgPSAxOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBJZiB0aGUgaW5wdXQgaXMgYmxhbmsgLSB3ZSB3YW50IHRoZSBmdWxsIGRhdGEgc2V0CgkJCSAqLwoJCQlpZiAoIHNJbnB1dC5sZW5ndGggPD0gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyoKCQkJCSAqIFdlIGFyZSBzdGFydGluZyBhIG5ldyBzZWFyY2ggb3IgdGhlIG5ldyBzZWFyY2ggc3RyaW5nIGlzIHNtYWxsZXIgCgkJCQkgKiB0aGVuIHRoZSBvbGQgb25lIChpLmUuIGRlbGV0ZSkuIFNlYXJjaCBmcm9tIHRoZSBtYXN0ZXIgYXJyYXkKCQkJIAkgKi8KCQkJCWlmICggb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggPT0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggfHwKCQkJCQkgICBvUHJldlNlYXJjaC5zU2VhcmNoLmxlbmd0aCA+IHNJbnB1dC5sZW5ndGggfHwgaUZvcmNlID09IDEgfHwKCQkJCQkgICBzSW5wdXQuaW5kZXhPZihvUHJldlNlYXJjaC5zU2VhcmNoKSAhPT0gMCApCgkJCQl7CgkJCQkJLyogTnVrZSB0aGUgb2xkIGRpc3BsYXkgYXJyYXkgLSB3ZSBhcmUgZ29pbmcgdG8gcmVidWlsZCBpdCAqLwoJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQkJCgkJCQkJLyogRm9yY2UgYSByZWJ1aWxkIG9mIHRoZSBzZWFyY2ggYXJyYXkgKi8KCQkJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDEgKTsKCQkJCQkKCQkJCQkvKiBTZWFyY2ggdGhyb3VnaCBhbGwgcmVjb3JkcyB0byBwb3B1bGF0ZSB0aGUgc2VhcmNoIGFycmF5CgkJCQkJICogVGhlIHRoZSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyIGFuZCBhc0RhdGFTZWFyY2ggYXJyYXlzIGhhdmUgMSB0byAxIAoJCQkJCSAqIG1hcHBpbmcKCQkJCQkgKi8KCQkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggcnBTZWFyY2gudGVzdChvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2ldKSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkucHVzaCggb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcltpXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkgIH0KCQkJICBlbHNlCgkJCQl7CgkJCSAgCS8qIFVzaW5nIG9sZCBzZWFyY2ggYXJyYXkgLSByZWZpbmUgaXQgLSBkbyBpdCB0aGlzIHdheSBmb3Igc3BlZWQKCQkJICAJICogRG9uJ3QgaGF2ZSB0byBzZWFyY2ggdGhlIHdob2xlIG1hc3RlciBhcnJheSBhZ2FpbgoJCQkJCSAqLwoJCQkgIAl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJICAJCgkJCSAgCS8qIFNlYXJjaCB0aGUgY3VycmVudCByZXN1bHRzICovCgkJCSAgCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJICAJCWlmICggISBycFNlYXJjaC50ZXN0KG9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0pICkKCQkJCQkJewoJCQkgIAkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCBpLWlJbmRleENvcnJlY3RvciwgMSApOwoJCQkgIAkJCWlJbmRleENvcnJlY3RvcisrOwoJCQkgIAkJfQoJCQkgIAl9CgkJCSAgfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhbiBhcnJheSB3aGljaCBjYW4gYmUgcXVpY2tseSBzZWFyY2ggdGhyb3VnaAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWFzdGVyIHVzZSB0aGUgbWFzdGVyIGRhdGEgYXJyYXkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaEFycmF5ICggb1NldHRpbmdzLCBpTWFzdGVyICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQkvKiBDbGVhciBvdXQgdGhlIG9sZCBkYXRhICovCgkJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoID0gW107CgkJCgkJCQl2YXIgYWlGaWx0ZXJDb2x1bW5zID0gX2ZuR2V0Q29sdW1ucyggb1NldHRpbmdzLCAnYlNlYXJjaGFibGUnICk7CgkJCQl2YXIgYWlJbmRleCA9IChpTWFzdGVyPT09MSkgPwoJCQkJIAlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyIDoKCQkJCSAJb1NldHRpbmdzLmFpRGlzcGxheTsKCQkJCQoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1haUluZGV4Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGF0YVNlYXJjaFtpXSA9IF9mbkJ1aWxkU2VhcmNoUm93KAoJCQkJCQlvU2V0dGluZ3MsCgkJCQkJCV9mbkdldFJvd0RhdGEoIG9TZXR0aW5ncywgYWlJbmRleFtpXSwgJ2ZpbHRlcicsIGFpRmlsdGVyQ29sdW1ucyApCgkJCQkJKTsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBzZWFyY2hhYmxlIHN0cmluZyBmcm9tIGEgc2luZ2xlIGRhdGEgcm93CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgUm93IGRhdGEgYXJyYXkgdG8gdXNlIGZvciB0aGUgZGF0YSB0byBzZWFyY2gKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQnVpbGRTZWFyY2hSb3coIG9TZXR0aW5ncywgYURhdGEgKQoJCXsKCQkJdmFyIHNTZWFyY2ggPSBhRGF0YS5qb2luKCcgICcpOwoJCQkKCQkJLyogSWYgaXQgbG9va3MgbGlrZSB0aGVyZSBpcyBhbiBIVE1MIGVudGl0eSBpbiB0aGUgc3RyaW5nLCBhdHRlbXB0IHRvIGRlY29kZSBpdCAqLwoJCQlpZiAoIHNTZWFyY2guaW5kZXhPZignJicpICE9PSAtMSApCgkJCXsKCQkJCXNTZWFyY2ggPSAkKCc8ZGl2PicpLmh0bWwoc1NlYXJjaCkudGV4dCgpOwoJCQl9CgkJCQoJCQkvLyBTdHJpcCBuZXdsaW5lIGNoYXJhY3RlcnMKCQkJcmV0dXJuIHNTZWFyY2gucmVwbGFjZSggL1tcblxyXS9nLCAiICIgKTsKCQl9CgkJCgkJLyoqCgkJICogQnVpbGQgYSByZWd1bGFyIGV4cHJlc3Npb24gb2JqZWN0IHN1aXRhYmxlIGZvciBzZWFyY2hpbmcgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NlYXJjaCBzdHJpbmcgdG8gc2VhcmNoIGZvcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU21hcnQgcGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc2l0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAcmV0dXJucyB7UmVnRXhwfSBjb25zdHJ1Y3RlZCBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoKCBzU2VhcmNoLCBiUmVnZXgsIGJTbWFydCwgYkNhc2VJbnNlbnNpdGl2ZSApCgkJewoJCQl2YXIgYXNTZWFyY2gsIHNSZWdFeHBTdHJpbmc7CgkJCQoJCQlpZiAoIGJTbWFydCApCgkJCXsKCQkJCS8qIEdlbmVyYXRlIHRoZSByZWd1bGFyIGV4cHJlc3Npb24gdG8gdXNlLiBTb21ldGhpbmcgYWxvbmcgdGhlIGxpbmVzIG9mOgoJCQkJICogXig/PS4qP1xib25lXGIpKD89Lio/XGJ0d29cYikoPz0uKj9cYnRocmVlXGIpLiokCgkJCQkgKi8KCQkJCWFzU2VhcmNoID0gYlJlZ2V4ID8gc1NlYXJjaC5zcGxpdCggJyAnICkgOiBfZm5Fc2NhcGVSZWdleCggc1NlYXJjaCApLnNwbGl0KCAnICcgKTsKCQkJCXNSZWdFeHBTdHJpbmcgPSAnXig/PS4qPycrYXNTZWFyY2guam9pbiggJykoPz0uKj8nICkrJykuKiQnOwoJCQkJcmV0dXJuIG5ldyBSZWdFeHAoIHNSZWdFeHBTdHJpbmcsIGJDYXNlSW5zZW5zaXRpdmUgPyAiaSIgOiAiIiApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJc1NlYXJjaCA9IGJSZWdleCA/IHNTZWFyY2ggOiBfZm5Fc2NhcGVSZWdleCggc1NlYXJjaCApOwoJCQkJcmV0dXJuIG5ldyBSZWdFeHAoIHNTZWFyY2gsIGJDYXNlSW5zZW5zaXRpdmUgPyAiaSIgOiAiIiApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvbnZlcnQgcmF3IGRhdGEgaW50byBzb21ldGhpbmcgdGhhdCB0aGUgdXNlciBjYW4gc2VhcmNoIG9uCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRGF0YSBkYXRhIHRvIGJlIG1vZGlmaWVkCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVHlwZSBkYXRhIHR5cGUKCQkgKiAgQHJldHVybnMge3N0cmluZ30gc2VhcmNoIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EYXRhVG9TZWFyY2ggKCBzRGF0YSwgc1R5cGUgKQoJCXsKCQkJaWYgKCB0eXBlb2YgRGF0YVRhYmxlLmV4dC5vZm5TZWFyY2hbc1R5cGVdID09PSAiZnVuY3Rpb24iICkKCQkJewoJCQkJcmV0dXJuIERhdGFUYWJsZS5leHQub2ZuU2VhcmNoW3NUeXBlXSggc0RhdGEgKTsKCQkJfQoJCQllbHNlIGlmICggc0RhdGEgPT09IG51bGwgKQoJCQl7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQkJZWxzZSBpZiAoIHNUeXBlID09ICJodG1sIiApCgkJCXsKCQkJCXJldHVybiBzRGF0YS5yZXBsYWNlKC9bXHJcbl0vZywiICIpLnJlcGxhY2UoIC88Lio/Pi9nLCAiIiApOwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICJzdHJpbmciICkKCQkJewoJCQkJcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1tcclxuXS9nLCIgIik7CgkJCX0KCQkJcmV0dXJuIHNEYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBzY2FwZSBhIHN0cmluZyBzdWNoIHRoYXQgaXQgY2FuIGJlIHVzZWQgaW4gYSByZWd1bGFyIGV4cHJlc3Npb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWYWwgc3RyaW5nIHRvIGVzY2FwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBlc2NhcGVkIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Fc2NhcGVSZWdleCAoIHNWYWwgKQoJCXsKCQkJdmFyIGFjRXNjYXBlID0gWyAnLycsICcuJywgJyonLCAnKycsICc/JywgJ3wnLCAnKCcsICcpJywgJ1snLCAnXScsICd7JywgJ30nLCAnXFwnLCAnJCcsICdeJywgJy0nIF07CgkJCXZhciByZVJlcGxhY2UgPSBuZXcgUmVnRXhwKCAnKFxcJyArIGFjRXNjYXBlLmpvaW4oJ3xcXCcpICsgJyknLCAnZycgKTsKCQkJcmV0dXJuIHNWYWwucmVwbGFjZShyZVJlcGxhY2UsICdcXCQxJyk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciB0aGUgaW5mbyBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge25vZGV9IEluZm9ybWF0aW9uIGVsZW1lbnQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxJbmZvICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBuSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCW5JbmZvLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zSW5mbzsKCQkJCgkJCS8qIEFjdGlvbnMgdGhhdCBhcmUgdG8gYmUgdGFrZW4gb25jZSBvbmx5IGZvciB0aGlzIGZlYXR1cmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmkgKQoJCQl7CgkJCQkvKiBBZGQgZHJhdyBjYWxsYmFjayAqLwoJCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCQkiZm4iOiBfZm5VcGRhdGVJbmZvLAoJCQkJCSJzTmFtZSI6ICJpbmZvcm1hdGlvbiIKCQkJCX0gKTsKCQkJCQoJCQkJLyogQWRkIGlkICovCgkJCQluSW5mby5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX2luZm8nOwoJCQl9CgkJCW9TZXR0aW5ncy5uVGFibGUuc2V0QXR0cmlidXRlKCAnYXJpYS1kZXNjcmliZWRieScsIG9TZXR0aW5ncy5zVGFibGVJZCsnX2luZm8nICk7CgkJCQoJCQlyZXR1cm4gbkluZm87CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSB0aGUgaW5mb3JtYXRpb24gZWxlbWVudHMgaW4gdGhlIGRpc3BsYXkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5VcGRhdGVJbmZvICggb1NldHRpbmdzICkKCQl7CgkJCS8qIFNob3cgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHRhYmxlICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYkluZm8gfHwgb1NldHRpbmdzLmFhbkZlYXR1cmVzLmkubGVuZ3RoID09PSAwICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIKCQkJCW9MYW5nID0gb1NldHRpbmdzLm9MYW5ndWFnZSwKCQkJCWlTdGFydCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCsxLAoJCQkJaUVuZCA9IG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwKCQkJCWlNYXggPSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSwKCQkJCWlUb3RhbCA9IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCksCgkJCQlzT3V0OwoJCQkKCQkJaWYgKCBpVG90YWwgPT09IDAgKQoJCQl7CgkJCQkvKiBFbXB0eSByZWNvcmQgc2V0ICovCgkJCQlzT3V0ID0gb0xhbmcuc0luZm9FbXB0eTsKCQkJfQoJCQllbHNlIHsKCQkJCS8qIE5vcm1hbCByZWNvcmQgc2V0ICovCgkJCQlzT3V0ID0gb0xhbmcuc0luZm87CgkJCX0KCQkKCQkJaWYgKCBpVG90YWwgIT0gaU1heCApCgkJCXsKCQkJCS8qIFJlY29yZCBzZXQgYWZ0ZXIgZmlsdGVyaW5nICovCgkJCQlzT3V0ICs9ICcgJyArIG9MYW5nLnNJbmZvRmlsdGVyZWQ7CgkJCX0KCQkKCQkJLy8gQ29udmVydCB0aGUgbWFjcm9zCgkJCXNPdXQgKz0gb0xhbmcuc0luZm9Qb3N0Rml4OwoJCQlzT3V0ID0gX2ZuSW5mb01hY3Jvcyggb1NldHRpbmdzLCBzT3V0ICk7CgkJCQoJCQlpZiAoIG9MYW5nLmZuSW5mb0NhbGxiYWNrICE9PSBudWxsICkKCQkJewoJCQkJc091dCA9IG9MYW5nLmZuSW5mb0NhbGxiYWNrLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIAoJCQkJCW9TZXR0aW5ncywgaVN0YXJ0LCBpRW5kLCBpTWF4LCBpVG90YWwsIHNPdXQgKTsKCQkJfQoJCQkKCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuaTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCSQobltpXSkuaHRtbCggc091dCApOwoJCQl9CgkJfQoJCQoJCQoJCWZ1bmN0aW9uIF9mbkluZm9NYWNyb3MgKCBvU2V0dGluZ3MsIHN0ciApCgkJewoJCQl2YXIKCQkJCWlTdGFydCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCsxLAoJCQkJc1N0YXJ0ID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpU3RhcnQgKSwKCQkJCWlFbmQgPSBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksCgkJCQlzRW5kID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpRW5kICksCgkJCQlpVG90YWwgPSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpLAoJCQkJc1RvdGFsID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpVG90YWwgKSwKCQkJCWlNYXggPSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSwKCQkJCXNNYXggPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlNYXggKTsKCQkKCQkJLy8gV2hlbiBpbmZpbml0ZSBzY3JvbGxpbmcsIHdlIGFyZSBhbHdheXMgc3RhcnRpbmcgYXQgMS4gX2lEaXNwbGF5U3RhcnQgaXMgdXNlZCBvbmx5CgkJCS8vIGludGVybmFsbHkKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQlzU3RhcnQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIDEgKTsKCQkJfQoJCQoJCQlyZXR1cm4gc3RyLgoJCQkJcmVwbGFjZSgvX1NUQVJUXy9nLCBzU3RhcnQpLgoJCQkJcmVwbGFjZSgvX0VORF8vZywgICBzRW5kKS4KCQkJCXJlcGxhY2UoL19UT1RBTF8vZywgc1RvdGFsKS4KCQkJCXJlcGxhY2UoL19NQVhfL2csICAgc01heCk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRpYWxpc2UgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGlBamF4U3RhcnQ9b1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkKCQkJLyogRW5zdXJlIHRoYXQgdGhlIHRhYmxlIGRhdGEgaXMgZnVsbHkgaW5pdGlhbGlzZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkluaXRpYWxpc2VkID09PSBmYWxzZSApCgkJCXsKCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7IF9mbkluaXRpYWxpc2UoIG9TZXR0aW5ncyApOyB9LCAyMDAgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgZGlzcGxheSBIVE1MIG9wdGlvbnMgKi8KCQkJX2ZuQWRkT3B0aW9uc0h0bWwoIG9TZXR0aW5ncyApOwoJCQkKCQkJLyogQnVpbGQgYW5kIGRyYXcgdGhlIGhlYWRlciAvIGZvb3RlciBmb3IgdGhlIHRhYmxlICovCgkJCV9mbkJ1aWxkSGVhZCggb1NldHRpbmdzICk7CgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQoJCQkvKiBPa2F5IHRvIHNob3cgdGhhdCBzb21ldGhpbmcgaXMgZ29pbmcgb24gbm93ICovCgkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCgkJCS8qIENhbGN1bGF0ZSBzaXplcyBmb3IgY29sdW1ucyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggIT09IG51bGwgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIElmIHRoZXJlIGlzIGRlZmF1bHQgc29ydGluZyByZXF1aXJlZCAtIGxldCdzIGRvIGl0LiBUaGUgc29ydCBmdW5jdGlvbiB3aWxsIGRvIHRoZQoJCQkgKiBkcmF3aW5nIGZvciB1cy4gT3RoZXJ3aXNlIHdlIGRyYXcgdGhlIHRhYmxlIHJlZ2FyZGxlc3Mgb2YgdGhlIEFqYXggc291cmNlIC0gdGhpcyBhbGxvd3MKCQkJICogdGhlIHRhYmxlIHRvIGxvb2sgaW5pdGlhbGlzZWQgZm9yIEFqYXggc291cmNpbmcgZGF0YSAoc2hvdyAnbG9hZGluZycgbWVzc2FnZSBwb3NzaWJseSkKCQkJICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBpZiB0aGVyZSBpcyBhbiBhamF4IHNvdXJjZSBsb2FkIHRoZSBkYXRhICovCgkJCWlmICggb1NldHRpbmdzLnNBamF4U291cmNlICE9PSBudWxsICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJdmFyIGFvRGF0YSA9IFtdOwoJCQkJX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApOwoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwgZnVuY3Rpb24oanNvbikgewoJCQkJCXZhciBhRGF0YSA9IChvU2V0dGluZ3Muc0FqYXhEYXRhUHJvcCAhPT0gIiIpID8KCQkJCQkgCV9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKShqc29uKSA6IGpzb247CgkJCgkJCQkJLyogR290IHRoZSBkYXRhIC0gYWRkIGl0IHRvIHRoZSB0YWJsZSAqLwoJCQkJCWZvciAoIGk9MCA7IGk8YURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCV9mbkFkZERhdGEoIG9TZXR0aW5ncywgYURhdGFbaV0gKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogUmVzZXQgdGhlIGluaXQgZGlzcGxheSBmb3IgY29va2llIHNhdmluZy4gV2UndmUgYWxyZWFkeSBkb25lIGEgZmlsdGVyLCBhbmQKCQkJCQkgKiB0aGVyZWZvcmUgY2xlYXJlZCBpdCBiZWZvcmUuIFNvIHdlIG5lZWQgdG8gbWFrZSBpdCBhcHBlYXIgJ2ZyZXNoJwoJCQkJCSAqLwoJCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IGlBamF4U3RhcnQ7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJCQl7CgkJCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncywganNvbiApOwoJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgaW5pdGlhbGlzYXRpb24gY29tcGxldGUgaXMgZG9uZSBhdCB0aGUgZW5kIG9mIF9mbkRyYXcgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBbanNvbl0gSlNPTiBmcm9tIHRoZSBzZXJ2ZXIgdGhhdCBjb21wbGV0ZWQgdGhlIHRhYmxlLCBpZiB1c2luZyBBamF4IHNvdXJjZQoJCSAqICAgIHdpdGggY2xpZW50LXNpZGUgcHJvY2Vzc2luZyAob3B0aW9uYWwpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRDb21wbGV0ZSAoIG9TZXR0aW5ncywganNvbiApCgkJewoJCQlvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgPSB0cnVlOwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvSW5pdENvbXBsZXRlJywgJ2luaXQnLCBbb1NldHRpbmdzLCBqc29uXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBjb21wYXRpYmlsaXR5IC0gd2hlbiBjZXJ0YWluIG9wdGlvbnMgYXJlIGdpdmVuLCBhbmQgb3RoZXJzIGFyZW4ndCwgd2UKCQkgKiBuZWVkIHRvIGR1cGxpY2F0ZSB0aGUgdmFsdWVzIG92ZXIsIGluIG9yZGVyIHRvIHByb3ZpZGUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCQkgKiB3aXRoIG9sZGVyIGxhbmd1YWdlIGZpbGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxhbmd1YWdlQ29tcGF0KCBvTGFuZ3VhZ2UgKQoJCXsKCQkJdmFyIG9EZWZhdWx0cyA9IERhdGFUYWJsZS5kZWZhdWx0cy5vTGFuZ3VhZ2U7CgkJCgkJCS8qIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IC0gaWYgdGhlcmUgaXMgbm8gc0VtcHR5VGFibGUgZ2l2ZW4sIHRoZW4gdXNlIHRoZSBzYW1lIGFzCgkJCSAqIHNaZXJvUmVjb3JkcyAtIGFzc3VtaW5nIHRoYXQgaXMgZ2l2ZW4uCgkJCSAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0VtcHR5VGFibGUgJiYgb0xhbmd1YWdlLnNaZXJvUmVjb3JkcyAmJgoJCQkJb0RlZmF1bHRzLnNFbXB0eVRhYmxlID09PSAiTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGUiICkKCQkJewoJCQkJX2ZuTWFwKCBvTGFuZ3VhZ2UsIG9MYW5ndWFnZSwgJ3NaZXJvUmVjb3JkcycsICdzRW1wdHlUYWJsZScgKTsKCQkJfQoJCQoJCQkvKiBMaWtld2lzZSB3aXRoIGxvYWRpbmcgcmVjb3JkcyAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0xvYWRpbmdSZWNvcmRzICYmIG9MYW5ndWFnZS5zWmVyb1JlY29yZHMgJiYKCQkJCW9EZWZhdWx0cy5zTG9hZGluZ1JlY29yZHMgPT09ICJMb2FkaW5nLi4uIiApCgkJCXsKCQkJCV9mbk1hcCggb0xhbmd1YWdlLCBvTGFuZ3VhZ2UsICdzWmVyb1JlY29yZHMnLCAnc0xvYWRpbmdSZWNvcmRzJyApOwoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciB1c2VyIGRpc3BsYXkgbGVuZ3RoIGNoYW5naW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge25vZGV9IERpc3BsYXkgbGVuZ3RoIGZlYXR1cmUgbm9kZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbExlbmd0aCAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQkvKiBUaGlzIGNhbiBiZSBvdmVycnVsZWQgYnkgbm90IHVzaW5nIHRoZSBfTUVOVV8gdmFyL21hY3JvIGluIHRoZSBsYW5ndWFnZSB2YXJpYWJsZSAqLwoJCQl2YXIgc05hbWUgPSAnbmFtZT0iJytvU2V0dGluZ3Muc1RhYmxlSWQrJ19sZW5ndGgiJzsKCQkJdmFyIHNTdGRNZW51ID0gJzxzZWxlY3Qgc2l6ZT0iMSIgJytzTmFtZSsnPic7CgkJCXZhciBpLCBpTGVuOwoJCQl2YXIgYUxlbmd0aE1lbnUgPSBvU2V0dGluZ3MuYUxlbmd0aE1lbnU7CgkJCQoJCQlpZiAoIGFMZW5ndGhNZW51Lmxlbmd0aCA9PSAyICYmIHR5cGVvZiBhTGVuZ3RoTWVudVswXSA9PT0gJ29iamVjdCcgJiYgCgkJCQkJdHlwZW9mIGFMZW5ndGhNZW51WzFdID09PSAnb2JqZWN0JyApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hTGVuZ3RoTWVudVswXS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXNTdGRNZW51ICs9ICc8b3B0aW9uIHZhbHVlPSInK2FMZW5ndGhNZW51WzBdW2ldKyciPicrYUxlbmd0aE1lbnVbMV1baV0rJzwvb3B0aW9uPic7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YUxlbmd0aE1lbnUubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlzU3RkTWVudSArPSAnPG9wdGlvbiB2YWx1ZT0iJythTGVuZ3RoTWVudVtpXSsnIj4nK2FMZW5ndGhNZW51W2ldKyc8L29wdGlvbj4nOwoJCQkJfQoJCQl9CgkJCXNTdGRNZW51ICs9ICc8L3NlbGVjdD4nOwoJCQkKCQkJdmFyIG5MZW5ndGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMubCApCgkJCXsKCQkJCW5MZW5ndGguaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19sZW5ndGgnOwoJCQl9CgkJCW5MZW5ndGguY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNMZW5ndGg7CgkJCW5MZW5ndGguaW5uZXJIVE1MID0gJzxsYWJlbD4nK29TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0xlbmd0aE1lbnUucmVwbGFjZSggJ19NRU5VXycsIHNTdGRNZW51ICkrJzwvbGFiZWw+JzsKCQkJCgkJCS8qCgkJCSAqIFNldCB0aGUgbGVuZ3RoIHRvIHRoZSBjdXJyZW50IGRpc3BsYXkgbGVuZ3RoIC0gdGhhbmtzIHRvIEFuZHJlYSBQYXZsb3ZpYyBmb3IgdGhpcyBmaXgsCgkJCSAqIGFuZCBTdGVmYW4gU2tvcG5payBmb3IgZml4aW5nIHRoZSBmaXghCgkJCSAqLwoJCQkkKCdzZWxlY3Qgb3B0aW9uW3ZhbHVlPSInK29TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgrJyJdJywgbkxlbmd0aCkuYXR0cigic2VsZWN0ZWQiLCB0cnVlKTsKCQkJCgkJCSQoJ3NlbGVjdCcsIG5MZW5ndGgpLmJpbmQoICdjaGFuZ2UuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQl2YXIgaVZhbCA9ICQodGhpcykudmFsKCk7CgkJCQkKCQkJCS8qIFVwZGF0ZSBhbGwgb3RoZXIgbGVuZ3RoIG9wdGlvbnMgZm9yIHRoZSBuZXcgZGlzcGxheSAqLwoJCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMubDsKCQkJCWZvciAoIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBuW2ldICE9IHRoaXMucGFyZW50Tm9kZSApCgkJCQkJewoJCQkJCQkkKCdzZWxlY3QnLCBuW2ldKS52YWwoIGlWYWwgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIFJlZHJhdyB0aGUgdGFibGUgKi8KCQkJCW9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPSBwYXJzZUludChpVmFsLCAxMCk7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCgkJCQkvKiBJZiB3ZSBoYXZlIHNwYWNlIHRvIHNob3cgZXh0cmEgcm93cyAoYmFja2luZyB1cCBmcm9tIHRoZSBlbmQgcG9pbnQgLSB0aGVuIGRvIHNvICovCgkJCQlpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQkJCgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfSApOwoJCQoJCQoJCQkkKCdzZWxlY3QnLCBuTGVuZ3RoKS5hdHRyKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCgkJCXJldHVybiBuTGVuZ3RoOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWNhbGN1bGF0ZSB0aGUgZW5kIHBvaW50IGJhc2VkIG9uIHRoZSBzdGFydCBwb2ludAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2V0IHRoZSBlbmQgcG9pbnQgb2YgdGhlIGRpc3BsYXkgLSBiYXNlZCBvbiBob3cgbWFueSBlbGVtZW50cyB0aGVyZSBhcmUKCQkJCSAqIHN0aWxsIHRvIGRpc3BsYXkKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID4gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggfHwKCQkJCQkgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kID0gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCArIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCQkgKiBOb3RlIHRoYXQgbW9zdCBvZiB0aGUgcGFnaW5nIGxvZ2ljIGlzIGRvbmUgaW4gCgkJICogRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciBkZWZhdWx0IHBhZ2luYXRpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUGFnaW5hdGlvbiBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgblBhZ2luYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJblBhZ2luYXRlLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnaW5nK29TZXR0aW5ncy5zUGFnaW5hdGlvblR5cGU7CgkJCQoJCQlEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uWyBvU2V0dGluZ3Muc1BhZ2luYXRpb25UeXBlIF0uZm5Jbml0KCBvU2V0dGluZ3MsIG5QYWdpbmF0ZSwgCgkJCQlmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQl9CgkJCSk7CgkJCQoJCQkvKiBBZGQgYSBkcmF3IGNhbGxiYWNrIGZvciB0aGUgcGFnaW5hdGlvbiBvbiBmaXJzdCBpbnN0YW5jZSwgdG8gdXBkYXRlIHRoZSBwYWdpbmcgZGlzcGxheSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkJCQkJRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvblsgb1NldHRpbmdzLnNQYWdpbmF0aW9uVHlwZSBdLmZuVXBkYXRlKCBvU2V0dGluZ3MsIGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCX0gKTsKCQkJCQl9LAoJCQkJCSJzTmFtZSI6ICJwYWdpbmF0aW9uIgoJCQkJfSApOwoJCQl9CgkJCXJldHVybiBuUGFnaW5hdGU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFsdGVyIHRoZSBkaXNwbGF5IHNldHRpbmdzIHRvIGNoYW5nZSB0aGUgcGFnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKQoJCSAqICBAcmV0dXJucyB7Ym9vbH0gdHJ1ZSBwYWdlIGhhcyBjaGFuZ2VkLCBmYWxzZSAtIG5vIGNoYW5nZSAobm8gZWZmZWN0KSBlZyAnZmlyc3QnIG9uIHBhZ2UgMQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5QYWdlQ2hhbmdlICggb1NldHRpbmdzLCBtQWN0aW9uICkKCQl7CgkJCXZhciBpT2xkU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQoJCQlpZiAoIHR5cGVvZiBtQWN0aW9uID09PSAibnVtYmVyIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG1BY3Rpb24gKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPiBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJmaXJzdCIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJwcmV2aW91cyIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoPj0wID8KCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDoKCQkJCQkwOwoJCQkJCgkJCQkvKiBDb3JyZWN0IGZvciB1bmRlci1ydW4gKi8KCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQl7CgkJCQkgIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG1BY3Rpb24gPT0gIm5leHQiICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID49IDAgKQoJCQkJewoJCQkJCS8qIE1ha2Ugc3VyZSB3ZSBhcmUgbm90IG92ZXIgcnVubmluZyB0aGUgZGlzcGxheSBhcnJheSAqLwoJCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICsgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA8IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICs9IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG1BY3Rpb24gPT0gImxhc3QiICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID49IDAgKQoJCQkJewoJCQkJCXZhciBpUGFnZXMgPSBwYXJzZUludCggKG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCktMSkgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoLCAxMCApICsgMTsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAoaVBhZ2VzLTEpICogb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDAsICJVbmtub3duIHBhZ2luZyBhY3Rpb246ICIrbUFjdGlvbiApOwoJCQl9CgkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigncGFnZScsIG9TZXR0aW5ncyk7CgkJCQoJCQlyZXR1cm4gaU9sZFN0YXJ0ICE9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydDsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIHRoZSBwcm9jZXNzaW5nIG5vZGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUHJvY2Vzc2luZyBlbGVtZW50CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgblByb2Nlc3NpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnIgKQoJCQl7CgkJCQluUHJvY2Vzc2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3Byb2Nlc3NpbmcnOwoJCQl9CgkJCW5Qcm9jZXNzaW5nLmlubmVySFRNTCA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1Byb2Nlc3Npbmc7CgkJCW5Qcm9jZXNzaW5nLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUHJvY2Vzc2luZzsKCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggblByb2Nlc3NpbmcsIG9TZXR0aW5ncy5uVGFibGUgKTsKCQkJCgkJCXJldHVybiBuUHJvY2Vzc2luZzsKCQl9CgkJCgkJCgkJLyoqCgkJICogRGlzcGxheSBvciBoaWRlIHRoZSBwcm9jZXNzaW5nIGluZGljYXRvcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNob3cgU2hvdyB0aGUgcHJvY2Vzc2luZyBpbmRpY2F0b3IgKHRydWUpIG9yIG5vdCAoZmFsc2UpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblByb2Nlc3NpbmdEaXNwbGF5ICggb1NldHRpbmdzLCBiU2hvdyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlByb2Nlc3NpbmcgKQoJCQl7CgkJCQl2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucjsKCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhbltpXS5zdHlsZS52aXNpYmlsaXR5ID0gYlNob3cgPyAidmlzaWJsZSIgOiAiaGlkZGVuIjsKCQkJCX0KCQkJfQoJCQoJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoJ3Byb2Nlc3NpbmcnLCBbb1NldHRpbmdzLCBiU2hvd10pOwoJCX0KCQkKCQkvKioKCQkgKiBBZGQgYW55IGNvbnRyb2wgZWxlbWVudHMgZm9yIHRoZSB0YWJsZSAtIHNwZWNpZmljYWxseSBzY3JvbGxpbmcKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gTm9kZSB0byBhZGQgdG8gdGhlIERPTQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbFRhYmxlICggb1NldHRpbmdzICkKCQl7CgkJCS8qIENoZWNrIGlmIHNjcm9sbGluZyBpcyBlbmFibGVkIG9yIG5vdCAtIGlmIG5vdCB0aGVuIGxlYXZlIHRoZSBET00gdW5hbHRlcmVkICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZID09PSAiIiApCgkJCXsKCQkJCXJldHVybiBvU2V0dGluZ3MublRhYmxlOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBUaGUgSFRNTCBzdHJ1Y3R1cmUgdGhhdCB3ZSB3YW50IHRvIGdlbmVyYXRlIGluIHRoaXMgZnVuY3Rpb24gaXM6CgkJCSAqICBkaXYgLSBuU2Nyb2xsZXIKCQkJICogICAgZGl2IC0gblNjcm9sbEhlYWQKCQkJICogICAgICBkaXYgLSBuU2Nyb2xsSGVhZElubmVyCgkJCSAqICAgICAgICB0YWJsZSAtIG5TY3JvbGxIZWFkVGFibGUKCQkJICogICAgICAgICAgdGhlYWQgLSBuVGhlYWQKCQkJICogICAgZGl2IC0gblNjcm9sbEJvZHkKCQkJICogICAgICB0YWJsZSAtIG9TZXR0aW5ncy5uVGFibGUKCQkJICogICAgICAgIHRoZWFkIC0gblRoZWFkU2l6ZQoJCQkgKiAgICAgICAgdGJvZHkgLSBuVGJvZHkKCQkJICogICAgZGl2IC0gblNjcm9sbEZvb3QKCQkJICogICAgICBkaXYgLSBuU2Nyb2xsRm9vdElubmVyCgkJCSAqICAgICAgICB0YWJsZSAtIG5TY3JvbGxGb290VGFibGUKCQkJICogICAgICAgICAgdGZvb3QgLSBuVGZvb3QKCQkJICovCgkJCXZhcgoJCQkgCW5TY3JvbGxlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxIZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWRJbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxCb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEZvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsRm9vdElubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWRUYWJsZSA9IG9TZXR0aW5ncy5uVGFibGUuY2xvbmVOb2RlKGZhbHNlKSwKCQkJIAluU2Nyb2xsRm9vdFRhYmxlID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoZmFsc2UpLAoJCQkJblRoZWFkID0gb1NldHRpbmdzLm5UYWJsZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGhlYWQnKVswXSwKCQkJIAluVGZvb3QgPSBvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Zm9vdCcpLmxlbmd0aCA9PT0gMCA/IG51bGwgOiAKCQkJCQlvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Zm9vdCcpWzBdLAoJCQkJb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQoJCQluU2Nyb2xsSGVhZC5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWRJbm5lciApOwoJCQluU2Nyb2xsRm9vdC5hcHBlbmRDaGlsZCggblNjcm9sbEZvb3RJbm5lciApOwoJCQluU2Nyb2xsQm9keS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQluU2Nyb2xsZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxIZWFkICk7CgkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEJvZHkgKTsKCQkJblNjcm9sbEhlYWRJbm5lci5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWRUYWJsZSApOwoJCQluU2Nyb2xsSGVhZFRhYmxlLmFwcGVuZENoaWxkKCBuVGhlYWQgKTsKCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQluU2Nyb2xsZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxGb290ICk7CgkJCQluU2Nyb2xsRm9vdElubmVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsRm9vdFRhYmxlICk7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLmFwcGVuZENoaWxkKCBuVGZvb3QgKTsKCQkJfQoJCQkKCQkJblNjcm9sbGVyLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxXcmFwcGVyOwoJCQluU2Nyb2xsSGVhZC5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsSGVhZDsKCQkJblNjcm9sbEhlYWRJbm5lci5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsSGVhZElubmVyOwoJCQluU2Nyb2xsQm9keS5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsQm9keTsKCQkJblNjcm9sbEZvb3QuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbEZvb3Q7CgkJCW5TY3JvbGxGb290SW5uZXIuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbEZvb3RJbm5lcjsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuYkF1dG9Dc3MgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQkJblNjcm9sbEhlYWQuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwoJCQkJblNjcm9sbEZvb3Quc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLm92ZXJmbG93ID0gImF1dG8iOwoJCQl9CgkJCQoJCQluU2Nyb2xsSGVhZC5zdHlsZS5ib3JkZXIgPSAiMCI7CgkJCW5TY3JvbGxIZWFkLnN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQluU2Nyb2xsRm9vdC5zdHlsZS5ib3JkZXIgPSAiMCI7CgkJCW5TY3JvbGxIZWFkSW5uZXIuc3R5bGUud2lkdGggPSBvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyICE9PSAiIiA/CgkJCQlvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyIDogIjEwMCUiOyAvKiB3aWxsIGJlIG92ZXJ3cml0dGVuICovCgkJCQoJCQkvKiBNb2RpZnkgYXR0cmlidXRlcyB0byByZXNwZWN0IHRoZSBjbG9uZXMgKi8KCQkJblNjcm9sbEhlYWRUYWJsZS5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7CgkJCW5TY3JvbGxIZWFkVGFibGUuc3R5bGUubWFyZ2luTGVmdCA9ICIwIjsKCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5TY3JvbGxGb290VGFibGUucmVtb3ZlQXR0cmlidXRlKCdpZCcpOwoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQl9CgkJCQoJCQkvKiBNb3ZlIGNhcHRpb24gZWxlbWVudHMgZnJvbSB0aGUgYm9keSB0byB0aGUgaGVhZGVyLCBmb290ZXIgb3IgbGVhdmUgd2hlcmUgaXQgaXMKCQkJICogZGVwZW5kaW5nIG9uIHRoZSBjb25maWd1cmF0aW9uLiBOb3RlIHRoYXQgdGhlIERURCBzYXlzIHRoZXJlIGNhbiBiZSBvbmx5IG9uZSBjYXB0aW9uICovCgkJCXZhciBuQ2FwdGlvbiA9ICQob1NldHRpbmdzLm5UYWJsZSkuY2hpbGRyZW4oJ2NhcHRpb24nKTsKCQkJaWYgKCBuQ2FwdGlvbi5sZW5ndGggPiAwICkKCQkJewoJCQkJbkNhcHRpb24gPSBuQ2FwdGlvblswXTsKCQkJCWlmICggbkNhcHRpb24uX2NhcHRpb25TaWRlID09PSAidG9wIiApCgkJCQl7CgkJCQkJblNjcm9sbEhlYWRUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb24gKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBuQ2FwdGlvbi5fY2FwdGlvblNpZGUgPT09ICJib3R0b20iICYmIG5UZm9vdCApCgkJCQl7CgkJCQkJblNjcm9sbEZvb3RUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb24gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyoKCQkJICogU2l6aW5nCgkJCSAqLwoJCQkvKiBXaGVuIHgtc2Nyb2xsaW5nIGFkZCB0aGUgd2lkdGggYW5kIGEgc2Nyb2xsZXIgdG8gbW92ZSB0aGUgaGVhZGVyIHdpdGggdGhlIGJvZHkgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCApOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb1NldHRpbmdzLm9TY3JvbGwuc1ggKTsKCQkJCQoJCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICk7CQoJCQkJfQoJCQkJCgkJCQkvKiBXaGVuIHRoZSBib2R5IGlzIHNjcm9sbGVkLCB0aGVuIHdlIGFsc28gd2FudCB0byBzY3JvbGwgdGhlIGhlYWRlcnMgKi8KCQkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCggZnVuY3Rpb24gKGUpIHsKCQkJCQluU2Nyb2xsSGVhZC5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0OwoJCQkJCQoJCQkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW5TY3JvbGxGb290LnNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBXaGVuIHlzY3JvbGxpbmcsIGFkZCB0aGUgaGVpZ2h0ICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICk7CgkJCX0KCQkJCgkJCS8qIFJlZHJhdyAtIGFsaWduIGNvbHVtbnMgYWNyb3NzIHRoZSB0YWJsZXMgKi8KCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCSJmbiI6IF9mblNjcm9sbERyYXcsCgkJCQkic05hbWUiOiAic2Nyb2xsaW5nIgoJCQl9ICk7CgkJCQoJCQkvKiBJbmZpbml0ZSBzY3JvbGxpbmcgZXZlbnQgaGFuZGxlcnMgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoIGZ1bmN0aW9uKCkgewoJCQkJCS8qIFVzZSBhIGJsb2NrZXIgdG8gc3RvcCBzY3JvbGxpbmcgZnJvbSBsb2FkaW5nIG1vcmUgZGF0YSB3aGlsZSBvdGhlciBkYXRhIGlzIHN0aWxsIGxvYWRpbmcgKi8KCQkJCQlpZiAoICFvU2V0dGluZ3MuYkRyYXdpbmcgJiYgJCh0aGlzKS5zY3JvbGxUb3AoKSAhPT0gMCApCgkJCQkJewoJCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgbG9hZCB0aGUgbmV4dCBkYXRhIHNldCAqLwoJCQkJCQlpZiAoICQodGhpcykuc2Nyb2xsVG9wKCkgKyAkKHRoaXMpLmhlaWdodCgpID4gCgkJCQkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmhlaWdodCgpIC0gb1NldHRpbmdzLm9TY3JvbGwuaUxvYWRHYXAgKQoJCQkJCQl7CgkJCQkJCQkvKiBPbmx5IGRvIHRoZSByZWRyYXcgaWYgd2UgaGF2ZSB0byAtIHdlIG1pZ2h0IGJlIGF0IHRoZSBlbmQgb2YgdGhlIGRhdGEgKi8KCQkJCQkJCWlmICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAnbmV4dCcgKTsKCQkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MublNjcm9sbEhlYWQgPSBuU2Nyb2xsSGVhZDsKCQkJb1NldHRpbmdzLm5TY3JvbGxGb290ID0gblNjcm9sbEZvb3Q7CgkJCQoJCQlyZXR1cm4gblNjcm9sbGVyOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgdGhlIHZhcmlvdXMgdGFibGVzIGZvciByZXNpemluZy4gSXQncyBhIGJpdCBvZiBhIHBpZyB0aGlzIGZ1bmN0aW9uLCBidXQKCQkgKiBiYXNpY2FsbHkgdGhlIGlkZWEgdG86CgkJICogICAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCSAqICAgMi4gVGFrZSBsaXZlIG1lYXN1cmVtZW50cyBmcm9tIHRoZSBET00KCQkgKiAgIDMuIEFwcGx5IHRoZSBtZWFzdXJlbWVudHMKCQkgKiAgIDQuIENsZWFuIHVwCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbERyYXcgKCBvICkKCQl7CgkJCXZhcgoJCQkJblNjcm9sbEhlYWRJbm5lciA9IG8ublNjcm9sbEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdLAoJCQkJblNjcm9sbEhlYWRUYWJsZSA9IG5TY3JvbGxIZWFkSW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0sCgkJCQluU2Nyb2xsQm9keSA9IG8ublRhYmxlLnBhcmVudE5vZGUsCgkJCQlpLCBpTGVuLCBqLCBqTGVuLCBhbkhlYWRUb1NpemUsIGFuSGVhZFNpemVycywgYW5Gb290U2l6ZXJzLCBhbkZvb3RUb1NpemUsIG9TdHlsZSwgaVZpcywKCQkJCW5UaGVhZFNpemUsIG5UZm9vdFNpemUsCgkJCQlpV2lkdGgsIGFBcHBsaWVkPVtdLCBhQXBwbGllZEZvb3Rlcj1bXSwgaVNhbml0eVdpZHRoLAoJCQkJblNjcm9sbEZvb3RJbm5lciA9IChvLm5URm9vdCAhPT0gbnVsbCkgPyBvLm5TY3JvbGxGb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKVswXSA6IG51bGwsCgkJCQluU2Nyb2xsRm9vdFRhYmxlID0gKG8ublRGb290ICE9PSBudWxsKSA/IG5TY3JvbGxGb290SW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0gOiBudWxsLAoJCQkJaWU2NyA9IG8ub0Jyb3dzZXIuYlNjcm9sbE92ZXJzaXplLAoJCQkJemVyb091dCA9IGZ1bmN0aW9uKG5TaXplcikgewoJCQkJCW9TdHlsZSA9IG5TaXplci5zdHlsZTsKCQkJCQlvU3R5bGUucGFkZGluZ1RvcCA9ICIwIjsKCQkJCQlvU3R5bGUucGFkZGluZ0JvdHRvbSA9ICIwIjsKCQkJCQlvU3R5bGUuYm9yZGVyVG9wV2lkdGggPSAiMCI7CgkJCQkJb1N0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gIjAiOwoJCQkJCW9TdHlsZS5oZWlnaHQgPSAwOwoJCQkJfTsKCQkJCgkJCS8qCgkJCSAqIDEuIFJlLWNyZWF0ZSB0aGUgdGFibGUgaW5zaWRlIHRoZSBzY3JvbGxpbmcgZGl2CgkJCSAqLwoJCQkKCQkJLyogUmVtb3ZlIHRoZSBvbGQgbWluaW1pc2VkIHRoZWFkIGFuZCB0Zm9vdCBlbGVtZW50cyBpbiB0aGUgaW5uZXIgdGFibGUgKi8KCQkJJChvLm5UYWJsZSkuY2hpbGRyZW4oJ3RoZWFkLCB0Zm9vdCcpLnJlbW92ZSgpOwoJCQoJCQkvKiBDbG9uZSB0aGUgY3VycmVudCBoZWFkZXIgYW5kIGZvb3RlciBlbGVtZW50cyBhbmQgdGhlbiBwbGFjZSBpdCBpbnRvIHRoZSBpbm5lciB0YWJsZSAqLwoJCQluVGhlYWRTaXplID0gJChvLm5USGVhZCkuY2xvbmUoKVswXTsKCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGhlYWRTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzBdICk7CgkJCWFuSGVhZFRvU2l6ZSA9IG8ublRIZWFkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQlhbkhlYWRTaXplcnMgPSBuVGhlYWRTaXplLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5UZm9vdFNpemUgPSAkKG8ublRGb290KS5jbG9uZSgpWzBdOwoJCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGZvb3RTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzFdICk7CgkJCQlhbkZvb3RUb1NpemUgPSBvLm5URm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJCWFuRm9vdFNpemVycyA9IG5UZm9vdFNpemUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIDIuIFRha2UgbGl2ZSBtZWFzdXJlbWVudHMgZnJvbSB0aGUgRE9NIC0gZG8gbm90IGFsdGVyIHRoZSBET00gaXRzZWxmIQoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSBvbGQgc2l6aW5nIGFuZCBhcHBseSB0aGUgY2FsY3VsYXRlZCBjb2x1bW4gd2lkdGhzCgkJCSAqIEdldCB0aGUgdW5pcXVlIGNvbHVtbiBoZWFkZXJzIGluIHRoZSBuZXdseSBjcmVhdGVkIChjbG9uZWQpIGhlYWRlci4gV2Ugd2FudCB0byBhcHBseSB0aGUKCQkJICogY2FsY3VsYXRlZCBzaXplcyB0byB0aGlzIGhlYWRlcgoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCX0KCQkJCgkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvLCBuVGhlYWRTaXplICk7CgkJCWZvciAoIGk9MCwgaUxlbj1uVGhzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlWaXMgPSBfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCggbywgaSApOwoJCQkJblRoc1tpXS5zdHlsZS53aWR0aCA9IG8uYW9Db2x1bW5zW2lWaXNdLnNXaWR0aDsKCQkJfQoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24obikgewoJCQkJCW4uc3R5bGUud2lkdGggPSAiIjsKCQkJCX0sIGFuRm9vdFNpemVycyApOwoJCQl9CgkJCgkJCS8vIElmIHNjcm9sbCBjb2xsYXBzZSBpcyBlbmFibGVkLCB3aGVuIHdlIHB1dCB0aGUgaGVhZGVycyBiYWNrIGludG8gdGhlIGJvZHkgZm9yIHNpemluZywgd2UKCQkJLy8gd2lsbCBlbmQgdXAgZm9yY2luZyB0aGUgc2Nyb2xsYmFyIHRvIGFwcGVhciwgbWFraW5nIG91ciBtZWFzdXJlbWVudHMgd3JvbmcgZm9yIHdoZW4gd2UKCQkJLy8gdGhlbiBoaWRlIGl0IChlbmQgb2YgdGhpcyBmdW5jdGlvbiksIHNvIGFkZCB0aGUgaGVhZGVyIGhlaWdodCB0byB0aGUgYm9keSBzY3JvbGxlci4KCQkJaWYgKCBvLm9TY3JvbGwuYkNvbGxhcHNlICYmIG8ub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSAoblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0ICsgby5uVEhlYWQub2Zmc2V0SGVpZ2h0KSsicHgiOwoJCQl9CgkJCQoJCQkvKiBTaXplIHRoZSB0YWJsZSBhcyBhIHdob2xlICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJLyogTm8geCBzY3JvbGxpbmcgKi8KCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQkJCgkJCQkvKiBJIGtub3cgdGhpcyBpcyBydWJiaXNoIC0gYnV0IElFNyB3aWxsIG1ha2UgdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSB3aGVuIDEwMCUgaW5jbHVkZQoJCQkJICogdGhlIHNjcm9sbGJhciAtIHdoaWNoIGlzIHNob3VsZG4ndC4gV2hlbiB0aGVyZSBpcyBhIHNjcm9sbGJhciB3ZSBuZWVkIHRvIHRha2UgdGhpcwoJCQkJICogaW50byBhY2NvdW50LgoJCQkJICovCgkJCQlpZiAoIGllNjcgJiYgKCQoJ3Rib2R5JywgblNjcm9sbEJvZHkpLmhlaWdodCgpID4gblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8IAoJCQkJCSQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSAtIG8ub1Njcm9sbC5pQmFyV2lkdGgpOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaWYgKCBvLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCS8qIHggc2Nyb2xsIGlubmVyIGhhcyBiZWVuIGdpdmVuIC0gdXNlIGl0ICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvLm9TY3JvbGwuc1hJbm5lcik7CgkJCQl9CgkJCQllbHNlIGlmICggaVNhbml0eVdpZHRoID09ICQoblNjcm9sbEJvZHkpLndpZHRoKCkgJiYKCQkJCSAgICQoblNjcm9sbEJvZHkpLmhlaWdodCgpIDwgJChvLm5UYWJsZSkuaGVpZ2h0KCkgKQoJCQkJewoJCQkJCS8qIFRoZXJlIGlzIHktc2Nyb2xsaW5nIC0gdHJ5IHRvIHRha2UgYWNjb3VudCBvZiB0aGUgeSBzY3JvbGwgYmFyICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCQlpZiAoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSA+IGlTYW5pdHlXaWR0aC1vLm9TY3JvbGwuaUJhcldpZHRoICkKCQkJCQl7CgkJCQkJCS8qIE5vdCBwb3NzaWJsZSB0byB0YWtlIGFjY291bnQgb2YgaXQgKi8KCQkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIEFsbCBlbHNlIGZhaWxzICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlY2FsY3VsYXRlIHRoZSBzYW5pdHkgd2lkdGggLSBub3cgdGhhdCB3ZSd2ZSBhcHBsaWVkIHRoZSByZXF1aXJlZCB3aWR0aCwgYmVmb3JlIGl0IHdhcwoJCQkgKiBhIHRlbXBvcmFyeSB2YXJpYWJsZS4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIHRoZSBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaXMgZG9uZQoJCQkgKiBiZWZvcmUgdGhpcyB0YWJsZSBET00gaXMgY3JlYXRlZC4KCQkJICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJCgkJCS8qIFdlIHdhbnQgdGhlIGhpZGRlbiBoZWFkZXIgdG8gaGF2ZSB6ZXJvIGhlaWdodCwgc28gcmVtb3ZlIHBhZGRpbmcgYW5kIGJvcmRlcnMuIFRoZW4KCQkJICogc2V0IHRoZSB3aWR0aCBiYXNlZCBvbiB0aGUgcmVhbCBoZWFkZXJzCgkJCSAqLwoJCQkKCQkJLy8gQXBwbHkgYWxsIHN0eWxlcyBpbiBvbmUgcGFzcy4gSW52YWxpZGF0ZXMgbGF5b3V0IG9ubHkgb25jZSBiZWNhdXNlIHdlIGRvbid0IHJlYWQgYW55IAoJCQkvLyBET00gcHJvcGVydGllcy4KCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCB6ZXJvT3V0LCBhbkhlYWRTaXplcnMgKTsKCQkJIAoJCQkvLyBSZWFkIGFsbCB3aWR0aHMgaW4gbmV4dCBwYXNzLiBGb3JjZXMgbGF5b3V0IG9ubHkgb25jZSBiZWNhdXNlIHdlIGRvIG5vdCBjaGFuZ2UgCgkJCS8vIGFueSBET00gcHJvcGVydGllcy4KCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuU2l6ZXIpIHsKCQkJCWFBcHBsaWVkLnB1c2goIF9mblN0cmluZ1RvQ3NzKCAkKG5TaXplcikud2lkdGgoKSApICk7CgkJCX0sIGFuSGVhZFNpemVycyApOwoJCQkgCgkJCS8vIEFwcGx5IGFsbCB3aWR0aHMgaW4gZmluYWwgcGFzcy4gSW52YWxpZGF0ZXMgbGF5b3V0IG9ubHkgb25jZSBiZWNhdXNlIHdlIGRvIG5vdAoJCQkvLyByZWFkIGFueSBET00gcHJvcGVydGllcy4KCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuVG9TaXplLCBpKSB7CgkJCQluVG9TaXplLnN0eWxlLndpZHRoID0gYUFwcGxpZWRbaV07CgkJCX0sIGFuSGVhZFRvU2l6ZSApOwoJCQoJCQkkKGFuSGVhZFNpemVycykuaGVpZ2h0KDApOwoJCQkKCQkJLyogU2FtZSBhZ2FpbiB3aXRoIHRoZSBmb290ZXIgaWYgd2UgaGF2ZSBvbmUgKi8KCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggemVyb091dCwgYW5Gb290U2l6ZXJzICk7CgkJCQkgCgkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplcikgewoJCQkJCWFBcHBsaWVkRm9vdGVyLnB1c2goIF9mblN0cmluZ1RvQ3NzKCAkKG5TaXplcikud2lkdGgoKSApICk7CgkJCQl9LCBhbkZvb3RTaXplcnMgKTsKCQkJCSAKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblRvU2l6ZSwgaSkgewoJCQkJCW5Ub1NpemUuc3R5bGUud2lkdGggPSBhQXBwbGllZEZvb3RlcltpXTsKCQkJCX0sIGFuRm9vdFRvU2l6ZSApOwoJCQoJCQkJJChhbkZvb3RTaXplcnMpLmhlaWdodCgwKTsKCQkJfQoJCQkKCQkJLyoKCQkJICogMy4gQXBwbHkgdGhlIG1lYXN1cmVtZW50cwoJCQkgKi8KCQkJCgkJCS8qICJIaWRlIiB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdGhhdCB3ZSB1c2VkIGZvciB0aGUgc2l6aW5nLiBXZSB3YW50IHRvIGFsc28gZml4IHRoZWlyIHdpZHRoCgkJCSAqIHRvIHdoYXQgdGhleSBjdXJyZW50bHkgYXJlCgkJCSAqLwoJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplciwgaSkgewoJCQkJblNpemVyLmlubmVySFRNTCA9ICIiOwoJCQkJblNpemVyLnN0eWxlLndpZHRoID0gYUFwcGxpZWRbaV07CgkJCX0sIGFuSGVhZFNpemVycyApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBpKSB7CgkJCQkJblNpemVyLmlubmVySFRNTCA9ICIiOwoJCQkJCW5TaXplci5zdHlsZS53aWR0aCA9IGFBcHBsaWVkRm9vdGVyW2ldOwoJCQkJfSwgYW5Gb290U2l6ZXJzICk7CgkJCX0KCQkJCgkJCS8qIFNhbml0eSBjaGVjayB0aGF0IHRoZSB0YWJsZSBpcyBvZiBhIHNlbnNpYmxlIHdpZHRoLiBJZiBub3QgdGhlbiB3ZSBhcmUgZ29pbmcgdG8gZ2V0CgkJCSAqIG1pc2FsaWdubWVudCAtIHRyeSB0byBwcmV2ZW50IHRoaXMgYnkgbm90IGFsbG93aW5nIHRoZSB0YWJsZSB0byBzaHJpbmsgYmVsb3cgaXRzIG1pbiB3aWR0aAoJCQkgKi8KCQkJaWYgKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgPCBpU2FuaXR5V2lkdGggKQoJCQl7CgkJCQkvKiBUaGUgbWluIHdpZHRoIGRlcGVuZHMgdXBvbiBpZiB3ZSBoYXZlIGEgdmVydGljYWwgc2Nyb2xsYmFyIHZpc2libGUgb3Igbm90ICovCgkJCQl2YXIgaUNvcnJlY3Rpb24gPSAoKG5TY3JvbGxCb2R5LnNjcm9sbEhlaWdodCA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikpID8KCQkJCQkJaVNhbml0eVdpZHRoK28ub1Njcm9sbC5pQmFyV2lkdGggOiBpU2FuaXR5V2lkdGg7CgkJCQkKCQkJCS8qIElFNi83IGFyZSBhIGxhdyB1bnRvIHRoZW1zZWx2ZXMuLi4gKi8KCQkJCWlmICggaWU2NyAmJiAoblNjcm9sbEJvZHkuc2Nyb2xsSGVpZ2h0ID4gCgkJCQkJblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8ICQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJCQoJCQkJLyogQXBwbHkgdGhlIGNhbGN1bGF0ZWQgbWluaW11bSB3aWR0aCB0byB0aGUgdGFibGUgd3JhcHBlcnMgKi8KCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQlvLm5TY3JvbGxIZWFkLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW8ublNjcm9sbEZvb3Quc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaUNvcnJlY3Rpb24gKTsKCQkJCX0KCQkJCQoJCQkJLyogQW5kIGdpdmUgdGhlIHVzZXIgYSB3YXJuaW5nIHRoYXQgd2UndmUgc3RvcHBlZCB0aGUgdGFibGUgZ2V0dGluZyB0b28gc21hbGwgKi8KCQkJCWlmICggby5vU2Nyb2xsLnNYID09PSAiIiApCgkJCQl7CgkJCQkJX2ZuTG9nKCBvLCAxLCAiVGhlIHRhYmxlIGNhbm5vdCBmaXQgaW50byB0aGUgY3VycmVudCBlbGVtZW50IHdoaWNoIHdpbGwgY2F1c2UgY29sdW1uIisKCQkJCQkJIiBtaXNhbGlnbm1lbnQuIFRoZSB0YWJsZSBoYXMgYmVlbiBkcmF3biBhdCBpdHMgbWluaW11bSBwb3NzaWJsZSB3aWR0aC4iICk7CgkJCQl9CgkJCQllbHNlIGlmICggby5vU2Nyb2xsLnNYSW5uZXIgIT09ICIiICkKCQkJCXsKCQkJCQlfZm5Mb2coIG8sIDEsICJUaGUgdGFibGUgY2Fubm90IGZpdCBpbnRvIHRoZSBjdXJyZW50IGVsZW1lbnQgd2hpY2ggd2lsbCBjYXVzZSBjb2x1bW4iKwoJCQkJCQkiIG1pc2FsaWdubWVudC4gSW5jcmVhc2UgdGhlIHNTY3JvbGxYSW5uZXIgdmFsdWUgb3IgcmVtb3ZlIGl0IHRvIGFsbG93IGF1dG9tYXRpYyIrCgkJCQkJCSIgY2FsY3VsYXRpb24iICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAnMTAwJScgKTsKCQkJCW8ublNjcm9sbEhlYWQuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW8ublNjcm9sbEZvb3Quc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQl9CgkJCX0KCQkJCgkJCQoJCQkvKgoJCQkgKiA0LiBDbGVhbiB1cAoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJLyogSUU3PCBwdXRzIGEgdmVydGljYWwgc2Nyb2xsYmFyIGluIHBsYWNlICh3aGVuIGl0IHNob3VsZG4ndCBiZSkgZHVlIHRvIHN1YnRyYWN0aW5nCgkJCQkgKiB0aGUgc2Nyb2xsYmFyIGhlaWdodCBmcm9tIHRoZSB2aXNpYmxlIGRpc3BsYXksIHJhdGhlciB0aGFuIGFkZGluZyBpdCBvbi4gV2UgbmVlZCB0bwoJCQkJICogc2V0IHRoZSBoZWlnaHQgaW4gb3JkZXIgdG8gc29ydCB0aGlzLiBEb24ndCB3YW50IHRvIGRvIGl0IGluIGFueSBvdGhlciBicm93c2Vycy4KCQkJCSAqLwoJCQkJaWYgKCBpZTY3ICkKCQkJCXsKCQkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSBfZm5TdHJpbmdUb0Nzcyggby5uVGFibGUub2Zmc2V0SGVpZ2h0K28ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvLm9TY3JvbGwuc1kgIT09ICIiICYmIG8ub1Njcm9sbC5iQ29sbGFwc2UgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSBfZm5TdHJpbmdUb0Nzcyggby5vU2Nyb2xsLnNZICk7CgkJCQkKCQkJCXZhciBpRXh0cmEgPSAoby5vU2Nyb2xsLnNYICE9PSAiIiAmJiBvLm5UYWJsZS5vZmZzZXRXaWR0aCA+IG5TY3JvbGxCb2R5Lm9mZnNldFdpZHRoKSA/CgkJCQkgCW8ub1Njcm9sbC5pQmFyV2lkdGggOiAwOwoJCQkJaWYgKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQgPCBuU2Nyb2xsQm9keS5vZmZzZXRIZWlnaHQgKQoJCQkJewoJCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQraUV4dHJhICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEZpbmFsbHkgc2V0IHRoZSB3aWR0aCdzIG9mIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0YWJsZXMgKi8KCQkJdmFyIGlPdXRlcldpZHRoID0gJChvLm5UYWJsZSkub3V0ZXJXaWR0aCgpOwoJCQluU2Nyb2xsSGVhZFRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCW5TY3JvbGxIZWFkSW5uZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaU91dGVyV2lkdGggKTsKCQkKCQkJLy8gRmlndXJlIG91dCBpZiB0aGVyZSBhcmUgc2Nyb2xsYmFyIHByZXNlbnQgLSBpZiBzbyB0aGVuIHdlIG5lZWQgYSB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdG8KCQkJLy8gcHJvdmlkZSBhIGJpdCBtb3JlIHNwYWNlIHRvIGFsbG93ICJvdmVyZmxvdyIgc2Nyb2xsaW5nIChpLmUuIHBhc3QgdGhlIHNjcm9sbGJhcikKCQkJdmFyIGJTY3JvbGxpbmcgPSAkKG8ublRhYmxlKS5oZWlnaHQoKSA+IG5TY3JvbGxCb2R5LmNsaWVudEhlaWdodCB8fCAkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIjsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS5wYWRkaW5nUmlnaHQgPSBiU2Nyb2xsaW5nID8gby5vU2Nyb2xsLmlCYXJXaWR0aCsicHgiIDogIjBweCI7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS5wYWRkaW5nUmlnaHQgPSBiU2Nyb2xsaW5nID8gby5vU2Nyb2xsLmlCYXJXaWR0aCsicHgiIDogIjBweCI7CgkJCX0KCQkKCQkJLyogQWRqdXN0IHRoZSBwb3NpdGlvbiBvZiB0aGUgaGVhZGVyIGluIGNhc2Ugd2UgbG9vc2UgdGhlIHktc2Nyb2xsYmFyICovCgkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCgpOwoJCQkKCQkJLyogSWYgc29ydGluZyBvciBmaWx0ZXJpbmcgaGFzIG9jY3VycmVkLCBqdW1wIHRoZSBzY3JvbGxpbmcgYmFjayB0byB0aGUgdG9wICovCgkJCWlmICggby5iU29ydGVkIHx8IG8uYkZpbHRlcmVkICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc2Nyb2xsVG9wID0gMDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBseSBhIGdpdmVuIGZ1bmN0aW9uIHRvIHRoZSBkaXNwbGF5IGNoaWxkIG5vZGVzIG9mIGFuIGVsZW1lbnQgYXJyYXkgKHR5cGljYWxseQoJCSAqIFREIGNoaWxkcmVuIG9mIFRSIHJvd3MKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gTWV0aG9kIHRvIGFwcGx5IHRvIHRoZSBvYmplY3RzCgkJICogIEBwYXJhbSBhcnJheSB7bm9kZXN9IGFuMSBMaXN0IG9mIGVsZW1lbnRzIHRvIGxvb2sgdGhyb3VnaCBmb3IgZGlzcGxheSBjaGlsZHJlbgoJCSAqICBAcGFyYW0gYXJyYXkge25vZGVzfSBhbjIgQW5vdGhlciBsaXN0IChpZGVudGljYWwgc3RydWN0dXJlIHRvIHRoZSBmaXJzdCkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BcHBseVRvQ2hpbGRyZW4oIGZuLCBhbjEsIGFuMiApCgkJewoJCQl2YXIgaW5kZXg9MCwgaT0wLCBpTGVuPWFuMS5sZW5ndGg7CgkJCXZhciBuTm9kZTEsIG5Ob2RlMjsKCQkKCQkJd2hpbGUgKCBpIDwgaUxlbiApCgkJCXsKCQkJCW5Ob2RlMSA9IGFuMVtpXS5maXJzdENoaWxkOwoJCQkJbk5vZGUyID0gYW4yID8gYW4yW2ldLmZpcnN0Q2hpbGQgOiBudWxsOwoJCQkJd2hpbGUgKCBuTm9kZTEgKQoJCQkJewoJCQkJCWlmICggbk5vZGUxLm5vZGVUeXBlID09PSAxICkKCQkJCQl7CgkJCQkJCWlmICggYW4yICkKCQkJCQkJewoJCQkJCQkJZm4oIG5Ob2RlMSwgbk5vZGUyLCBpbmRleCApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJZm4oIG5Ob2RlMSwgaW5kZXggKTsKCQkJCQkJfQoJCQkJCQlpbmRleCsrOwoJCQkJCX0KCQkJCQluTm9kZTEgPSBuTm9kZTEubmV4dFNpYmxpbmc7CgkJCQkJbk5vZGUyID0gYW4yID8gbk5vZGUyLm5leHRTaWJsaW5nIDogbnVsbDsKCQkJCX0KCQkJCWkrKzsKCQkJfQoJCX0KCQkKCQkvKioKCQkgKiBDb252ZXJ0IGEgQ1NTIHVuaXQgd2lkdGggdG8gcGl4ZWxzIChlLmcuIDJlbSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNXaWR0aCB3aWR0aCB0byBiZSBjb252ZXJ0ZWQKCQkgKiAgQHBhcmFtIHtub2RlfSBuUGFyZW50IHBhcmVudCB0byBnZXQgdGhlIHdpdGggZm9yIChyZXF1aXJlZCBmb3IgcmVsYXRpdmUgd2lkdGhzKSAtIG9wdGlvbmFsCgkJICogIEByZXR1cm5zIHtpbnR9IGlXaWR0aCB3aWR0aCBpbiBwaXhlbHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29udmVydFRvV2lkdGggKCBzV2lkdGgsIG5QYXJlbnQgKQoJCXsKCQkJaWYgKCAhc1dpZHRoIHx8IHNXaWR0aCA9PT0gbnVsbCB8fCBzV2lkdGggPT09ICcnICkKCQkJewoJCQkJcmV0dXJuIDA7CgkJCX0KCQkJCgkJCWlmICggIW5QYXJlbnQgKQoJCQl7CgkJCQluUGFyZW50ID0gZG9jdW1lbnQuYm9keTsKCQkJfQoJCQkKCQkJdmFyIGlXaWR0aDsKCQkJdmFyIG5UbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoJCQluVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHNXaWR0aCApOwoJCQkKCQkJblBhcmVudC5hcHBlbmRDaGlsZCggblRtcCApOwoJCQlpV2lkdGggPSBuVG1wLm9mZnNldFdpZHRoOwoJCQluUGFyZW50LnJlbW92ZUNoaWxkKCBuVG1wICk7CgkJCQoJCQlyZXR1cm4gKCBpV2lkdGggKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQ2FsY3VsYXRlIHRoZSB3aWR0aCBvZiBjb2x1bW5zIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DYWxjdWxhdGVDb2x1bW5XaWR0aHMgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGlUYWJsZVdpZHRoID0gb1NldHRpbmdzLm5UYWJsZS5vZmZzZXRXaWR0aDsKCQkJdmFyIGlVc2VySW5wdXRzID0gMDsKCQkJdmFyIGlUbXBXaWR0aDsKCQkJdmFyIGlWaXNpYmxlQ29sdW1ucyA9IDA7CgkJCXZhciBpQ29sdW1zID0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGg7CgkJCXZhciBpLCBpSW5kZXgsIGlDb3JyZWN0b3IsIGlXaWR0aDsKCQkJdmFyIG9IZWFkZXJzID0gJCgndGgnLCBvU2V0dGluZ3MublRIZWFkKTsKCQkJdmFyIHdpZHRoQXR0ciA9IG9TZXR0aW5ncy5uVGFibGUuZ2V0QXR0cmlidXRlKCd3aWR0aCcpOwoJCQl2YXIgbldyYXBwZXIgPSBvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGU7CgkJCQoJCQkvKiBDb252ZXJ0IGFueSB1c2VyIGlucHV0IHNpemVzIGludG8gcGl4ZWwgc2l6ZXMgKi8KCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCXsKCQkJCQlpVmlzaWJsZUNvbHVtbnMrKzsKCQkJCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCWlUbXBXaWR0aCA9IF9mbkNvbnZlcnRUb1dpZHRoKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aE9yaWcsIAoJCQkJCQkJbldyYXBwZXIgKTsKCQkJCQkJaWYgKCBpVG1wV2lkdGggIT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG1wV2lkdGggKTsKCQkJCQkJfQoJCQkJCQkJCgkJCQkJCWlVc2VySW5wdXRzKys7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIERPTSBlcXVhbHMgdGhlIG51bWJlciB0aGF0IHdlIGhhdmUgdG8gcHJvY2VzcyBpbiAKCQkJICogRGF0YVRhYmxlcywgdGhlbiB3ZSBjYW4gdXNlIHRoZSBvZmZzZXRzIHRoYXQgYXJlIGNyZWF0ZWQgYnkgdGhlIHdlYi1icm93c2VyLiBObyBjdXN0b20gCgkJCSAqIHNpemVzIGNhbiBiZSBzZXQgaW4gb3JkZXIgZm9yIHRoaXMgdG8gaGFwcGVuLCBub3Igc2Nyb2xsaW5nIHVzZWQKCQkJICovCgkJCWlmICggaUNvbHVtcyA9PSBvSGVhZGVycy5sZW5ndGggJiYgaVVzZXJJbnB1dHMgPT09IDAgJiYgaVZpc2libGVDb2x1bW5zID09IGlDb2x1bXMgJiYKCQkJCW9TZXR0aW5ncy5vU2Nyb2xsLnNYID09PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWSA9PT0gIiIgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVG1wV2lkdGggPSAkKG9IZWFkZXJzW2ldKS53aWR0aCgpOwoJCQkJCWlmICggaVRtcFdpZHRoICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUbXBXaWR0aCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIE90aGVyd2lzZSB3ZSBhcmUgZ29pbmcgdG8gaGF2ZSB0byBkbyBzb21lIGNhbGN1bGF0aW9ucyB0byBnZXQgdGhlIHdpZHRoIG9mIGVhY2ggY29sdW1uLgoJCQkJICogQ29uc3RydWN0IGEgMSByb3cgdGFibGUgd2l0aCB0aGUgd2lkZXN0IG5vZGUgaW4gdGhlIGRhdGEsIGFuZCBhbnkgdXNlciBkZWZpbmVkIHdpZHRocywKCQkJCSAqIHRoZW4gaW5zZXJ0IGl0IGludG8gdGhlIERPTSBhbmQgYWxsb3cgdGhlIGJyb3dzZXIgdG8gZG8gYWxsIHRoZSBoYXJkIHdvcmsgb2YKCQkJCSAqIGNhbGN1bGF0aW5nIHRhYmxlIHdpZHRocy4KCQkJCSAqLwoJCQkJdmFyCgkJCQkJbkNhbGNUbXAgPSBvU2V0dGluZ3MublRhYmxlLmNsb25lTm9kZSggZmFsc2UgKSwKCQkJCQluVGhlYWRDbG9uZSA9IG9TZXR0aW5ncy5uVEhlYWQuY2xvbmVOb2RlKHRydWUpLAoJCQkJCW5Cb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3Rib2R5JyApLAoJCQkJCW5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0cicgKSwKCQkJCQluRGl2U2l6aW5nOwoJCQkJCgkJCQluQ2FsY1RtcC5yZW1vdmVBdHRyaWJ1dGUoICJpZCIgKTsKCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBuVGhlYWRDbG9uZSApOwoJCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICE9PSBudWxsICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5URm9vdC5jbG9uZU5vZGUodHJ1ZSkgKTsKCQkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG4pIHsKCQkJCQkJbi5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCX0sIG5DYWxjVG1wLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpICk7CgkJCQl9CgkJCQkKCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBuQm9keSApOwoJCQkJbkJvZHkuYXBwZW5kQ2hpbGQoIG5UciApOwoJCQkJCgkJCQkvKiBSZW1vdmUgYW55IHNpemluZyB0aGF0IHdhcyBwcmV2aW91c2x5IGFwcGxpZWQgYnkgdGhlIHN0eWxlcyAqLwoJCQkJdmFyIGpxQ29sU2l6aW5nID0gJCgndGhlYWQgdGgnLCBuQ2FsY1RtcCk7CgkJCQlpZiAoIGpxQ29sU2l6aW5nLmxlbmd0aCA9PT0gMCApCgkJCQl7CgkJCQkJanFDb2xTaXppbmcgPSAkKCd0Ym9keSB0cjplcSgwKT50ZCcsIG5DYWxjVG1wKTsKCQkJCX0KCQkKCQkJCS8qIEFwcGx5IGN1c3RvbSBzaXppbmcgdG8gdGhlIGNsb25lZCBoZWFkZXIgKi8KCQkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsIG5UaGVhZENsb25lICk7CgkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtcyA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIG9Db2x1bW4gPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldOwoJCQkJCWlmICggb0NvbHVtbi5iVmlzaWJsZSAmJiBvQ29sdW1uLnNXaWR0aE9yaWcgIT09IG51bGwgJiYgb0NvbHVtbi5zV2lkdGhPcmlnICE9PSAiIiApCgkJCQkJewoJCQkJCQluVGhzW2ktaUNvcnJlY3Rvcl0uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb0NvbHVtbi5zV2lkdGhPcmlnICk7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKCBvQ29sdW1uLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCW5UaHNbaS1pQ29ycmVjdG9yXS5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJfQoJCQkJfQoJCQoJCQkJLyogRmluZCB0aGUgYmlnZ2VzdCB0ZCBmb3IgZWFjaCBjb2x1bW4gYW5kIHB1dCBpdCBpbnRvIHRoZSB0YWJsZSAqLwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJdmFyIG5UZCA9IF9mbkdldFdpZGVzdE5vZGUoIG9TZXR0aW5ncywgaSApOwoJCQkJCQlpZiAoIG5UZCAhPT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW5UZCA9IG5UZC5jbG9uZU5vZGUodHJ1ZSk7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NvbnRlbnRQYWRkaW5nICE9PSAiIiApCgkJCQkJCQl7CgkJCQkJCQkJblRkLmlubmVySFRNTCArPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDb250ZW50UGFkZGluZzsKCQkJCQkJCX0KCQkJCQkJCW5Uci5hcHBlbmRDaGlsZCggblRkICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSB0YWJsZSBhbmQgJ2Rpc3BsYXknIGl0ICovCgkJCQluV3JhcHBlci5hcHBlbmRDaGlsZCggbkNhbGNUbXAgKTsKCQkJCQoJCQkJLyogV2hlbiBzY3JvbGxpbmcgKFggb3IgWSkgd2Ugd2FudCB0byBzZXQgdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSBhcyBhcHByb3ByaWF0ZS4gSG93ZXZlciwKCQkJCSAqIHdoZW4gbm90IHNjcm9sbGluZyBsZWF2ZSB0aGUgdGFibGUgd2lkdGggYXMgaXQgaXMuIFRoaXMgcmVzdWx0cyBpbiBzbGlnaHRseSBkaWZmZXJlbnQsCgkJCQkgKiBidXQgSSB0aGluayBjb3JyZWN0IGJlaGF2aW91cgoJCQkJICovCgkJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyICE9PSAiIiApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gIiI7CgkJCQkJaWYgKCAkKG5DYWxjVG1wKS53aWR0aCgpIDwgbldyYXBwZXIub2Zmc2V0V2lkdGggKQoJCQkJCXsKCQkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggbldyYXBwZXIub2Zmc2V0V2lkdGggKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBuV3JhcHBlci5vZmZzZXRXaWR0aCApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIHdpZHRoQXR0ciApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggd2lkdGhBdHRyICk7CgkJCQl9CgkJCQluQ2FsY1RtcC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CgkJCQkKCQkJCS8qIFNjcm9sbGluZyBjb25zaWRlcmF0aW9ucyAqLwoJCQkJX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QoIG9TZXR0aW5ncywgbkNhbGNUbXAgKTsKCQkJCQoJCQkJLyogUmVhZCB0aGUgd2lkdGgncyBjYWxjdWxhdGVkIGJ5IHRoZSBicm93c2VyIGFuZCBzdG9yZSB0aGVtIGZvciB1c2UgYnkgdGhlIGNhbGxlci4gV2UKCQkJCSAqIGZpcnN0IG9mIGFsbCB0cnkgdG8gdXNlIHRoZSBlbGVtZW50cyBpbiB0aGUgYm9keSwgYnV0IGl0IGlzIHBvc3NpYmxlIHRoYXQgdGhlcmUgYXJlCgkJCQkgKiBubyBlbGVtZW50cyB0aGVyZSwgdW5kZXIgd2hpY2ggY2lyY3Vtc3RhbmNlcyB3ZSB1c2UgdGhlIGhlYWRlciBlbGVtZW50cwoJCQkJICovCgkJCQl2YXIgb05vZGVzID0gJCgidGJvZHkgdHI6ZXEoMCkiLCBuQ2FsY1RtcCkuY2hpbGRyZW4oKTsKCQkJCWlmICggb05vZGVzLmxlbmd0aCA9PT0gMCApCgkJCQl7CgkJCQkJb05vZGVzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsICQoJ3RoZWFkJywgbkNhbGNUbXApWzBdICk7CgkJCQl9CgkJCgkJCQkvKiBCcm93c2VycyBuZWVkIGEgYml0IG9mIGEgaGFuZCB3aGVuIGEgd2lkdGggaXMgYXNzaWduZWQgdG8gYW55IGNvbHVtbnMgd2hlbiAKCQkJCSAqIHgtc2Nyb2xsaW5nIGFzIHRoZXkgdGVuZCB0byBjb2xsYXBzZSB0aGUgdGFibGUgdG8gdGhlIG1pbi13aWR0aCwgZXZlbiBpZgoJCQkJICogd2Ugc2VudCB0aGUgY29sdW1uIHdpZHRocy4gU28gd2UgbmVlZCB0byBrZWVwIHRyYWNrIG9mIHdoYXQgdGhlIHRhYmxlIHdpZHRoCgkJCQkgKiBzaG91bGQgYmUgYnkgc3VtbWluZyB0aGUgdXNlciBnaXZlbiB2YWx1ZXMsIGFuZCB0aGUgYXV0b21hdGljIHZhbHVlcwoJCQkJICovCgkJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCQl7CgkJCQkJdmFyIGlUb3RhbCA9IDA7CgkJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoT3JpZyA9PT0gbnVsbCApCgkJCQkJCQl7CgkJCQkJCQkJaVRvdGFsICs9ICQob05vZGVzW2lDb3JyZWN0b3JdKS5vdXRlcldpZHRoKCk7CgkJCQkJCQl9CgkJCQkJCQllbHNlCgkJCQkJCQl7CgkJCQkJCQkJaVRvdGFsICs9IHBhcnNlSW50KG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoLnJlcGxhY2UoJ3B4JywnJyksIDEwKSArCgkJCQkJCQkJCSgkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkub3V0ZXJXaWR0aCgpIC0gJChvTm9kZXNbaUNvcnJlY3Rvcl0pLndpZHRoKCkpOwoJCQkJCQkJfQoJCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUb3RhbCApOwoJCQkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRvdGFsICk7CgkJCQl9CgkJCgkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlpV2lkdGggPSAkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkud2lkdGgoKTsKCQkJCQkJaWYgKCBpV2lkdGggIT09IG51bGwgJiYgaVdpZHRoID4gMCApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlXaWR0aCApOwoJCQkJCQl9CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCgkJCQl2YXIgY3NzV2lkdGggPSAkKG5DYWxjVG1wKS5jc3MoJ3dpZHRoJyk7CgkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gKGNzc1dpZHRoLmluZGV4T2YoJyUnKSAhPT0gLTEpID8KCQkJCSAgICBjc3NXaWR0aCA6IF9mblN0cmluZ1RvQ3NzKCAkKG5DYWxjVG1wKS5vdXRlcldpZHRoKCkgKTsKCQkJCW5DYWxjVG1wLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5DYWxjVG1wICk7CgkJCX0KCQkKCQkJaWYgKCB3aWR0aEF0dHIgKQoJCQl7CgkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHdpZHRoQXR0ciApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkanVzdCBhIHRhYmxlJ3Mgd2lkdGggdG8gdGFrZSBhY2NvdW50IG9mIHNjcm9sbGluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0YWJsZSBub2RlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0ICggb1NldHRpbmdzLCBuICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCS8qIFdoZW4geS1zY3JvbGxpbmcgb25seSwgd2Ugd2FudCB0byByZW1vdmUgdGhlIHdpZHRoIG9mIHRoZSBzY3JvbGwgYmFyIHNvIHRoZSB0YWJsZQoJCQkJICogKyBzY3JvbGwgYmFyIHdpbGwgZml0IGludG8gdGhlIGFyZWEgYXZhaWFsYmxlLgoJCQkJICovCgkJCQl2YXIgaU9yaWdXaWR0aCA9ICQobikud2lkdGgoKTsKCQkJCW4uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJChuKS5vdXRlcldpZHRoKCktb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCXsKCQkJCS8qIFdoZW4geC1zY3JvbGxpbmcgYm90aCB3YXlzLCBmaXggdGhlIHRhYmxlIGF0IGl0J3MgY3VycmVudCBzaXplLCB3aXRob3V0IGFkanVzdGluZyAqLwoJCQkJbi5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG4pLm91dGVyV2lkdGgoKSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgd2lkZXN0IG5vZGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gb2YgaW50ZXJlc3QKCQkgKiAgQHJldHVybnMge25vZGV9IHdpZGVzdCB0YWJsZSBub2RlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFdpZGVzdE5vZGUoIG9TZXR0aW5ncywgaUNvbCApCgkJewoJCQl2YXIgaU1heEluZGV4ID0gX2ZuR2V0TWF4TGVuU3RyaW5nKCBvU2V0dGluZ3MsIGlDb2wgKTsKCQkJaWYgKCBpTWF4SW5kZXggPCAwICkKCQkJewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCQkKCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2lNYXhJbmRleF0ublRyID09PSBudWxsICkKCQkJewoJCQkJdmFyIG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwoJCQkJbi5pbm5lckhUTUwgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpTWF4SW5kZXgsIGlDb2wsICcnICk7CgkJCQlyZXR1cm4gbjsKCQkJfQoJCQlyZXR1cm4gX2ZuR2V0VGROb2RlcyhvU2V0dGluZ3MsIGlNYXhJbmRleClbaUNvbF07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbWF4aW11bSBzdHJsZW4gZm9yIGVhY2ggZGF0YSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gb2YgaW50ZXJlc3QKCQkgKiAgQHJldHVybnMge3N0cmluZ30gbWF4IHN0cmluZyBsZW5ndGggZm9yIGVhY2ggY29sdW1uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldE1heExlblN0cmluZyggb1NldHRpbmdzLCBpQ29sICkKCQl7CgkJCXZhciBpTWF4ID0gLTE7CgkJCXZhciBpTWF4SW5kZXggPSAtMTsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJdmFyIHMgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBpQ29sLCAnZGlzcGxheScgKSsiIjsKCQkJCXMgPSBzLnJlcGxhY2UoIC88Lio/Pi9nLCAiIiApOwoJCQkJaWYgKCBzLmxlbmd0aCA+IGlNYXggKQoJCQkJewoJCQkJCWlNYXggPSBzLmxlbmd0aDsKCQkJCQlpTWF4SW5kZXggPSBpOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gaU1heEluZGV4OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBlbmQgYSBDU1MgdW5pdCAob25seSBpZiByZXF1aXJlZCkgdG8gYSBzdHJpbmcKCQkgKiAgQHBhcmFtIHthcnJheX0gYUFycmF5MSBmaXJzdCBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJyYXkyIHNlY29uZCBhcnJheQoJCSAqICBAcmV0dXJucyB7aW50fSAwIGlmIG1hdGNoLCAxIGlmIGxlbmd0aCBpcyBkaWZmZXJlbnQsIDIgaWYgbm8gbWF0Y2gKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU3RyaW5nVG9Dc3MoIHMgKQoJCXsKCQkJaWYgKCBzID09PSBudWxsICkKCQkJewoJCQkJcmV0dXJuICIwcHgiOwoJCQl9CgkJCQoJCQlpZiAoIHR5cGVvZiBzID09ICdudW1iZXInICkKCQkJewoJCQkJaWYgKCBzIDwgMCApCgkJCQl7CgkJCQkJcmV0dXJuICIwcHgiOwoJCQkJfQoJCQkJcmV0dXJuIHMrInB4IjsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgaWYgdGhlIGxhc3QgY2hhcmFjdGVyIGlzIG5vdCAwLTkgKi8KCQkJdmFyIGMgPSBzLmNoYXJDb2RlQXQoIHMubGVuZ3RoLTEgKTsKCQkJaWYgKGMgPCAweDMwIHx8IGMgPiAweDM5KQoJCQl7CgkJCQlyZXR1cm4gczsKCQkJfQoJCQlyZXR1cm4gcysicHgiOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHdpZHRoIG9mIGEgc2Nyb2xsIGJhciBpbiB0aGlzIGJyb3dzZXIgYmVpbmcgdXNlZAoJCSAqICBAcmV0dXJucyB7aW50fSB3aWR0aCBpbiBwaXhlbHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2Nyb2xsQmFyV2lkdGggKCkKCQl7ICAKCQkJdmFyIGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOwoJCQl2YXIgc3R5bGUgPSBpbm5lci5zdHlsZTsKCQkJc3R5bGUud2lkdGggPSAiMTAwJSI7CgkJCXN0eWxlLmhlaWdodCA9ICIyMDBweCI7CgkJCXN0eWxlLnBhZGRpbmcgPSAiMHB4IjsKCQkJCgkJCXZhciBvdXRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlzdHlsZSA9IG91dGVyLnN0eWxlOwoJCQlzdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CgkJCXN0eWxlLnRvcCA9ICIwcHgiOwoJCQlzdHlsZS5sZWZ0ID0gIjBweCI7CgkJCXN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKCQkJc3R5bGUud2lkdGggPSAiMjAwcHgiOwoJCQlzdHlsZS5oZWlnaHQgPSAiMTUwcHgiOwoJCQlzdHlsZS5wYWRkaW5nID0gIjBweCI7CgkJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJCW91dGVyLmFwcGVuZENoaWxkKGlubmVyKTsKCQkJCgkJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3V0ZXIpOwoJCQl2YXIgdzEgPSBpbm5lci5vZmZzZXRXaWR0aDsKCQkJb3V0ZXIuc3R5bGUub3ZlcmZsb3cgPSAnc2Nyb2xsJzsKCQkJdmFyIHcyID0gaW5uZXIub2Zmc2V0V2lkdGg7CgkJCWlmICggdzEgPT0gdzIgKQoJCQl7CgkJCQl3MiA9IG91dGVyLmNsaWVudFdpZHRoOwoJCQl9CgkJCQoJCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG91dGVyKTsKCQkJcmV0dXJuICh3MSAtIHcyKTsgIAoJCX0KCQkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIG9yZGVyIG9mIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7Ym9vbH0gYkFwcGx5Q2xhc3NlcyBvcHRpb25hbCAtIHNob3VsZCB3ZSBhcHBseSBjbGFzc2VzIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Tb3J0ICggb1NldHRpbmdzLCBiQXBwbHlDbGFzc2VzICkKCQl7CgkJCXZhcgoJCQkJaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbiwKCQkJCXNEYXRhVHlwZSwgblRoLAoJCQkJYWFTb3J0ID0gW10sCgkJCSAJYWlPcmlnID0gW10sCgkJCQlvU29ydCA9IERhdGFUYWJsZS5leHQub1NvcnQsCgkJCQlhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhLAoJCQkJYW9Db2x1bW5zID0gb1NldHRpbmdzLmFvQ29sdW1ucywKCQkJCW9BcmlhID0gb1NldHRpbmdzLm9MYW5ndWFnZS5vQXJpYTsKCQkJCgkJCS8qIE5vIHNvcnRpbmcgcmVxdWlyZWQgaWYgc2VydmVyLXNpZGUgb3Igbm8gc29ydGluZyBhcnJheSAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICYmIAoJCQkJKG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoICE9PSAwIHx8IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCkgKQoJCQl7CgkJCQlhYVNvcnQgPSAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApID8KCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICkgOgoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJCQoJCQkJLyogSWYgdGhlcmUgaXMgYSBzb3J0aW5nIGRhdGEgdHlwZSwgYW5kIGEgZnVuY3Rpb24gYmVsb25naW5nIHRvIGl0LCB0aGVuIHdlIG5lZWQgdG8KCQkJCSAqIGdldCB0aGUgZGF0YSBmcm9tIHRoZSBkZXZlbG9wZXIncyBmdW5jdGlvbiBhbmQgYXBwbHkgaXQgZm9yIHRoaXMgY29sdW1uCgkJCQkgKi8KCQkJCWZvciAoIGk9MCA7IGk8YWFTb3J0Lmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIGlDb2x1bW4gPSBhYVNvcnRbaV1bMF07CgkJCQkJdmFyIGlWaXNDb2x1bW4gPSBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSggb1NldHRpbmdzLCBpQ29sdW1uICk7CgkJCQkJc0RhdGFUeXBlID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbHVtbiBdLnNTb3J0RGF0YVR5cGU7CgkJCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmblNvcnREYXRhW3NEYXRhVHlwZV0gKQoJCQkJCXsKCQkJCQkJdmFyIGFEYXRhID0gRGF0YVRhYmxlLmV4dC5hZm5Tb3J0RGF0YVtzRGF0YVR5cGVdLmNhbGwoIAoJCQkJCQkJb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLCBpQ29sdW1uLCBpVmlzQ29sdW1uCgkJCQkJCSk7CgkJCQkJCWlmICggYURhdGEubGVuZ3RoID09PSBhb0RhdGEubGVuZ3RoICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPWFvRGF0YS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGosIGlDb2x1bW4sIGFEYXRhW2pdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJldHVybmVkIGRhdGEgc29ydCBhcnJheSAoY29sICIraUNvbHVtbisiKSBpcyB0aGUgd3JvbmcgbGVuZ3RoIiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBDcmVhdGUgYSB2YWx1ZSAtIGtleSBhcnJheSBvZiB0aGUgY3VycmVudCByb3cgcG9zaXRpb25zIHN1Y2ggdGhhdCB3ZSBjYW4gdXNlIHRoZWlyCgkJCQkgKiBjdXJyZW50IHBvc2l0aW9uIGR1cmluZyB0aGUgc29ydCwgaWYgdmFsdWVzIG1hdGNoLCBpbiBvcmRlciB0byBwZXJmb3JtIHN0YWJsZSBzb3J0aW5nCgkJCQkgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYWlPcmlnWyBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyW2ldIF0gPSBpOwoJCQkJfQoJCQoJCQkJLyogQnVpbGQgYW4gaW50ZXJuYWwgZGF0YSBhcnJheSB3aGljaCBpcyBzcGVjaWZpYyB0byB0aGUgc29ydCwgc28gd2UgY2FuIGdldCBhbmQgcHJlcAoJCQkJICogdGhlIGRhdGEgdG8gYmUgc29ydGVkIG9ubHkgb25jZSwgcmF0aGVyIHRoYW4gbmVlZGluZyB0byBkbyBpdCBldmVyeSB0aW1lIHRoZSBzb3J0aW5nCgkJCQkgKiBmdW5jdGlvbiBydW5zLiBUaGlzIG1ha2UgdGhlIHNvcnRpbmcgZnVuY3Rpb24gYSB2ZXJ5IHNpbXBsZSBjb21wYXJpc29uCgkJCQkgKi8KCQkJCXZhciBpU29ydExlbiA9IGFhU29ydC5sZW5ndGg7CgkJCQl2YXIgZm5Tb3J0Rm9ybWF0LCBhRGF0YVNvcnQ7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJZm9yICggaj0wIDsgajxpU29ydExlbiA7IGorKyApCgkJCQkJewoJCQkJCQlhRGF0YVNvcnQgPSBhb0NvbHVtbnNbIGFhU29ydFtqXVswXSBdLmFEYXRhU29ydDsKCQkKCQkJCQkJZm9yICggaz0wLCBrTGVuPWFEYXRhU29ydC5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlzRGF0YVR5cGUgPSBhb0NvbHVtbnNbIGFEYXRhU29ydFtrXSBdLnNUeXBlOwoJCQkJCQkJZm5Tb3J0Rm9ybWF0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi1wcmUiIF07CgkJCQkJCQkKCQkJCQkJCWFvRGF0YVtpXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRba10gXSA9IGZuU29ydEZvcm1hdCA/CgkJCQkJCQkJZm5Tb3J0Rm9ybWF0KCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBhRGF0YVNvcnRba10sICdzb3J0JyApICkgOgoJCQkJCQkJCV9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGksIGFEYXRhU29ydFtrXSwgJ3NvcnQnICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIERvIHRoZSBzb3J0IC0gaGVyZSB3ZSB3YW50IG11bHRpLWNvbHVtbiBzb3J0aW5nIGJhc2VkIG9uIGEgZ2l2ZW4gZGF0YSBzb3VyY2UgKGNvbHVtbikKCQkJCSAqIGFuZCBzb3J0aW5nIGZ1bmN0aW9uIChmcm9tIG9Tb3J0KSBpbiBhIGNlcnRhaW4gZGlyZWN0aW9uLiBJdCdzIHJlYXNvbmFibHkgY29tcGxleCB0bwoJCQkJICogZm9sbG93IG9uIGl0J3Mgb3duLCBidXQgdGhpcyBpcyB3aGF0IHdlIHdhbnQgKGV4YW1wbGUgdHdvIGNvbHVtbiBzb3J0aW5nKToKCQkJCSAqICBmbkxvY2FsU29ydGluZyA9IGZ1bmN0aW9uKGEsYil7CgkJCQkgKiAgCXZhciBpVGVzdDsKCQkJCSAqICAJaVRlc3QgPSBvU29ydFsnc3RyaW5nLWFzYyddKCdkYXRhMTEnLCAnZGF0YTEyJyk7CgkJCQkgKiAgCWlmIChpVGVzdCAhPT0gMCkKCQkJCSAqICAJCXJldHVybiBpVGVzdDsKCQkJCSAqICAgIGlUZXN0ID0gb1NvcnRbJ251bWVyaWMtZGVzYyddKCdkYXRhMjEnLCAnZGF0YTIyJyk7CgkJCQkgKiAgICBpZiAoaVRlc3QgIT09IDApCgkJCQkgKiAgCQlyZXR1cm4gaVRlc3Q7CgkJCQkgKiAgCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCSAqICB9CgkJCQkgKiBCYXNpY2FsbHkgd2UgaGF2ZSBhIHRlc3QgZm9yIGVhY2ggc29ydGluZyBjb2x1bW4sIGlmIHRoZSBkYXRhIGluIHRoYXQgY29sdW1uIGlzIGVxdWFsLAoJCQkJICogdGVzdCB0aGUgbmV4dCBjb2x1bW4uIElmIGFsbCBjb2x1bW5zIG1hdGNoLCB0aGVuIHdlIHVzZSBhIG51bWVyaWMgc29ydCBvbiB0aGUgcm93IAoJCQkJICogcG9zaXRpb25zIGluIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5IHRvIHByb3ZpZGUgYSBzdGFibGUgc29ydC4KCQkJCSAqLwoJCQkJb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zb3J0KCBmdW5jdGlvbiAoIGEsIGIgKSB7CgkJCQkJdmFyIGssIGwsIGxMZW4sIGlUZXN0LCBhRGF0YVNvcnQsIHNEYXRhVHlwZTsKCQkJCQlmb3IgKCBrPTAgOyBrPGlTb3J0TGVuIDsgaysrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydCA9IGFvQ29sdW1uc1sgYWFTb3J0W2tdWzBdIF0uYURhdGFTb3J0OwoJCQoJCQkJCQlmb3IgKCBsPTAsIGxMZW49YURhdGFTb3J0Lmxlbmd0aCA7IGw8bExlbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCXNEYXRhVHlwZSA9IGFvQ29sdW1uc1sgYURhdGFTb3J0W2xdIF0uc1R5cGU7CgkJCQkJCQkKCQkJCQkJCWlUZXN0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi0iK2FhU29ydFtrXVsxXSBdKAoJCQkJCQkJCWFvRGF0YVthXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRbbF0gXSwKCQkJCQkJCQlhb0RhdGFbYl0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2xdIF0KCQkJCQkJCSk7CgkJCQkJCQoJCQkJCQkJaWYgKCBpVGVzdCAhPT0gMCApCgkJCQkJCQl7CgkJCQkJCQkJcmV0dXJuIGlUZXN0OwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWx0ZXIgdGhlIHNvcnRpbmcgY2xhc3NlcyB0byB0YWtlIGFjY291bnQgb2YgdGhlIGNoYW5nZXMgKi8KCQkJaWYgKCAoYkFwcGx5Q2xhc3NlcyA9PT0gdW5kZWZpbmVkIHx8IGJBcHBseUNsYXNzZXMpICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgc1RpdGxlID0gYW9Db2x1bW5zW2ldLnNUaXRsZS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJCW5UaCA9IGFvQ29sdW1uc1tpXS5uVGg7CgkJCQluVGgucmVtb3ZlQXR0cmlidXRlKCdhcmlhLXNvcnQnKTsKCQkJCW5UaC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKTsKCQkJCQoJCQkJLyogSW4gQVJJQSBvbmx5IHRoZSBmaXJzdCBzb3J0aW5nIGNvbHVtbiBjYW4gYmUgbWFya2VkIGFzIHNvcnRpbmcgLSBubyBtdWx0aS1zb3J0IG9wdGlvbiAqLwoJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCXsKCQkJCQlpZiAoIGFhU29ydC5sZW5ndGggPiAwICYmIGFhU29ydFswXVswXSA9PSBpICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc29ydCcsIGFhU29ydFswXVsxXT09ImFzYyIgPyAiYXNjZW5kaW5nIiA6ICJkZXNjZW5kaW5nIiApOwoJCQkJCQkKCQkJCQkJdmFyIG5leHRTb3J0ID0gKGFvQ29sdW1uc1tpXS5hc1NvcnRpbmdbIGFhU29ydFswXVsyXSsxIF0pID8gCgkJCQkJCQlhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWyBhYVNvcnRbMF1bMl0rMSBdIDogYW9Db2x1bW5zW2ldLmFzU29ydGluZ1swXTsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShuZXh0U29ydD09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWzBdPT0iYXNjIiA/IG9BcmlhLnNTb3J0QXNjZW5kaW5nIDogb0FyaWEuc1NvcnREZXNjZW5kaW5nKSApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgc1RpdGxlKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogVGVsbCB0aGUgZHJhdyBmdW5jdGlvbiB0aGF0IHdlIGhhdmUgc29ydGVkIHRoZSBkYXRhICovCgkJCW9TZXR0aW5ncy5iU29ydGVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdzb3J0Jywgb1NldHRpbmdzKTsKCQkJCgkJCS8qIENvcHkgdGhlIG1hc3RlciBkYXRhIGludG8gdGhlIGRyYXcgYXJyYXkgYW5kIHJlLWRyYXcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQkvKiBfZm5GaWx0ZXIoKSB3aWxsIHJlZHJhdyB0aGUgdGFibGUgZm9yIHVzICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsgLyogcmVzZXQgZGlzcGxheSBiYWNrIHRvIHBhZ2UgMCAqLwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGFjaCBhIHNvcnQgaGFuZGxlciAoY2xpY2spIHRvIGEgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgbm9kZSB0byBhdHRhY2ggdGhlIGhhbmRsZXIgdG8KCQkgKiAgQHBhcmFtIHtpbnR9IGlEYXRhSW5kZXggY29sdW1uIHNvcnRpbmcgaW5kZXgKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRBdHRhY2hMaXN0ZW5lciAoIG9TZXR0aW5ncywgbk5vZGUsIGlEYXRhSW5kZXgsIGZuQ2FsbGJhY2sgKQoJCXsKCQkJX2ZuQmluZEFjdGlvbiggbk5vZGUsIHt9LCBmdW5jdGlvbiAoZSkgewoJCQkJLyogSWYgdGhlIGNvbHVtbiBpcyBub3Qgc29ydGFibGUgLSBkb24ndCB0byBhbnl0aGluZyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmJTb3J0YWJsZSA9PT0gZmFsc2UgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJLyoKCQkJCSAqIFRoaXMgaXMgYSBsaXR0bGUgYml0IG9kZCBJIGFkbWl0Li4uIEkgZGVjbGFyZSBhIHRlbXBvcmFyeSBmdW5jdGlvbiBpbnNpZGUgdGhlIHNjb3BlIG9mCgkJCQkgKiBfZm5CdWlsZEhlYWQgYW5kIHRoZSBjbGljayBoYW5kbGVyIGluIG9yZGVyIHRoYXQgdGhlIGNvZGUgcHJlc2VudGVkIGhlcmUgY2FuIGJlIHVzZWQgCgkJCQkgKiB0d2ljZSAtIG9uY2UgZm9yIHdoZW4gYlByb2Nlc3NpbmcgaXMgZW5hYmxlZCwgYW5kIGFub3RoZXIgdGltZSBmb3Igd2hlbiBpdCBpcyAKCQkJCSAqIGRpc2FibGVkLCBhcyB3ZSBuZWVkIHRvIHBlcmZvcm0gc2xpZ2h0bHkgZGlmZmVyZW50IGFjdGlvbnMuCgkJCQkgKiAgIEJhc2ljYWxseSB0aGUgaXNzdWUgaGVyZSBpcyB0aGF0IHRoZSBKYXZhc2NyaXB0IGVuZ2luZSBpbiBtb2Rlcm4gYnJvd3NlcnMgZG9uJ3QgCgkJCQkgKiBhcHBlYXIgdG8gYWxsb3cgdGhlIHJlbmRlcmluZyBlbmdpbmUgdG8gdXBkYXRlIHRoZSBkaXNwbGF5IHdoaWxlIGl0IGlzIHN0aWxsIGV4ZWN1dGluZwoJCQkJICogaXQncyB0aHJlYWQgKHdlbGwgLSBpdCBkb2VzIGJ1dCBvbmx5IGFmdGVyIGxvbmcgaW50ZXJ2YWxzKS4gVGhpcyBtZWFucyB0aGF0IHRoZSAKCQkJCSAqICdwcm9jZXNzaW5nJyBkaXNwbGF5IGRvZXNuJ3QgYXBwZWFyIGZvciBhIHRhYmxlIHNvcnQuIFRvIGJyZWFrIHRoZSBqcyB0aHJlYWQgdXAgYSBiaXQKCQkJCSAqIEkgZm9yY2UgYW4gZXhlY3V0aW9uIGJyZWFrIGJ5IHVzaW5nIHNldFRpbWVvdXQgLSBidXQgdGhpcyBicmVha3MgdGhlIGV4cGVjdGVkIAoJCQkJICogdGhyZWFkIGNvbnRpbnVhdGlvbiBmb3IgdGhlIGVuZC1kZXZlbG9wZXIncyBwb2ludCBvZiB2aWV3ICh0aGVpciBjb2RlIHdvdWxkIGV4ZWN1dGUKCQkJCSAqIHRvbyBlYXJseSksIHNvIHdlIG9ubHkgZG8gaXQgd2hlbiB3ZSBhYnNvbHV0ZWx5IGhhdmUgdG8uCgkJCQkgKi8KCQkJCXZhciBmbklubmVyU29ydGluZyA9IGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIgaUNvbHVtbiwgaU5leHRTb3J0OwoJCQkJCQoJCQkJCS8qIElmIHRoZSBzaGlmdCBrZXkgaXMgcHJlc3NlZCB0aGVuIHdlIGFyZSBtdWx0aXBsZSBjb2x1bW4gc29ydGluZyAqLwoJCQkJCWlmICggZS5zaGlmdEtleSApCgkJCQkJewoJCQkJCQkvKiBBcmUgd2UgYWxyZWFkeSBkb2luZyBzb21lIGtpbmQgb2Ygc29ydCBvbiB0aGlzIGNvbHVtbj8gKi8KCQkJCQkJdmFyIGJGb3VuZCA9IGZhbHNlOwoJCQkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA9PSBpRGF0YUluZGV4ICkKCQkJCQkJCXsKCQkJCQkJCQliRm91bmQgPSB0cnVlOwoJCQkJCQkJCWlDb2x1bW4gPSBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdOwoJCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0rMTsKCQkJCQkJCQkKCQkJCQkJCQlpZiAoICFvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmFzU29ydGluZ1tpTmV4dFNvcnRdICkKCQkJCQkJCQl7CgkJCQkJCQkJCS8qIFJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgc29ydGluZyBvcHRpb25zLCByZW1vdmUgZnJvbSBtdWx0aS1jb2wgc29ydCAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggaSwgMSApOwoJCQkJCQkJCX0KCQkJCQkJCQllbHNlCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBNb3ZlIG9udG8gbmV4dCBzb3J0aW5nIGRpcmVjdGlvbiAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGlOZXh0U29ydDsKCQkJCQkJCQl9CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIE5vIHNvcnQgeWV0IC0gYWRkIGl0IGluICovCgkJCQkJCWlmICggYkZvdW5kID09PSBmYWxzZSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJLyogSWYgbm8gc2hpZnQga2V5IHRoZW4gc2luZ2xlIGNvbHVtbiBzb3J0ICovCgkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggPT0gMSAmJiBvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzBdID09IGlEYXRhSW5kZXggKQoJCQkJCQl7CgkJCQkJCQlpQ29sdW1uID0gb1NldHRpbmdzLmFhU29ydGluZ1swXVswXTsKCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0rMTsKCQkJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF0gKQoJCQkJCQkJewoJCQkJCQkJCWlOZXh0U29ydCA9IDA7CgkJCQkJCQl9CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0gPSBpTmV4dFNvcnQ7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggMCwgb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggKTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJLyogUnVuIHRoZSBzb3J0ICovCgkJCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJCQl9OyAvKiAvZm5Jbm5lclNvcnRpbmcgKi8KCQkJCQoJCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCQl7CgkJCQkJZm5Jbm5lclNvcnRpbmcoKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQkJc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJCWZuSW5uZXJTb3J0aW5nKCk7CgkJCQkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJCQl7CgkJCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJCQl9CgkJCQkJfSwgMCApOwoJCQkJfQoJCQkJCgkJCQkvKiBDYWxsIHRoZSB1c2VyIHNwZWNpZmllZCBjYWxsYmFjayBmdW5jdGlvbiAtIHVzZWQgZm9yIGFzeW5jIHVzZXIgaW50ZXJhY3Rpb24gKi8KCQkJCWlmICggdHlwZW9mIGZuQ2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJyApCgkJCQl7CgkJCQkJZm5DYWxsYmFjayggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogU2V0IHRoZSBzb3J0aW5nIGNsYXNzZXMgb24gdGhlIGhlYWRlciwgTm90ZTogaXQgaXMgc2FmZSB0byBjYWxsIHRoaXMgZnVuY3Rpb24gCgkJICogd2hlbiBiU29ydCBhbmQgYlNvcnRDbGFzc2VzIGFyZSBmYWxzZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGosIGpMZW4sIGlGb3VuZDsKCQkJdmFyIGFhU29ydCwgc0NsYXNzOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkKCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zU29ydEFzYyArIiAiKyBvQ2xhc3Nlcy5zU29ydERlc2MgKwoJCQkJCQkiICIrIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzcyApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZC5jb25jYXQoIG9TZXR0aW5ncy5hYVNvcnRpbmcgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJfQoJCQkKCQkJLyogQXBwbHkgdGhlIHJlcXVpcmVkIGNsYXNzZXMgdG8gdGhlIGhlYWRlciAqLwoJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQl7CgkJCQkJc0NsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzOwoJCQkJCWlGb3VuZCA9IC0xOwoJCQkJCWZvciAoIGo9MCA7IGo8YWFTb3J0Lmxlbmd0aCA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIGFhU29ydFtqXVswXSA9PSBpICkKCQkJCQkJewoJCQkJCQkJc0NsYXNzID0gKCBhYVNvcnRbal1bMV0gPT0gImFzYyIgKSA/CgkJCQkJCQkJb0NsYXNzZXMuc1NvcnRBc2MgOiBvQ2xhc3Nlcy5zU29ydERlc2M7CgkJCQkJCQlpRm91bmQgPSBqOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIHNDbGFzcyApOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQkJCXsKCQkJCQkJLyogalF1ZXJ5IFVJIHVzZXMgZXh0cmEgbWFya3VwICovCgkJCQkJCXZhciBqcVNwYW4gPSAkKCJzcGFuLiIrb0NsYXNzZXMuc1NvcnRJY29uLCAgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpOwoJCQkJCQlqcVNwYW4ucmVtb3ZlQ2xhc3Mob0NsYXNzZXMuc1NvcnRKVUlBc2MgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlEZXNjICsiICIrIAoJCQkJCQkJb0NsYXNzZXMuc1NvcnRKVUkgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlBc2NBbGxvd2VkICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQgKTsKCQkJCQkJCgkJCQkJCXZhciBzU3BhbkNsYXNzOwoJCQkJCQlpZiAoIGlGb3VuZCA9PSAtMSApCgkJCQkJCXsKCQkJCQkJIAlzU3BhbkNsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzSlVJOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBhYVNvcnRbaUZvdW5kXVsxXSA9PSAiYXNjIiApCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSUFzYzsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSURlc2M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCWpxU3Bhbi5hZGRDbGFzcyggc1NwYW5DbGFzcyApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQkvKiBObyBzb3J0aW5nIG9uIHRoaXMgY29sdW1uLCBzbyBhZGQgdGhlIGJhc2UgY2xhc3MuIFRoaXMgd2lsbCBoYXZlIGJlZW4gYXNzaWduZWQgYnkKCQkJCQkgKiBfZm5BZGRDb2x1bW4KCQkJCQkgKi8KCQkJCQkkKG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIAoJCQkgKiBBcHBseSB0aGUgcmVxdWlyZWQgY2xhc3NlcyB0byB0aGUgdGFibGUgYm9keQoJCQkgKiBOb3RlIHRoYXQgdGhpcyBpcyBnaXZlbiBhcyBhIGZlYXR1cmUgc3dpdGNoIHNpbmNlIGl0IGNhbiBzaWduaWZpY2FudGx5IHNsb3cgZG93biBhIHNvcnQKCQkJICogb24gbGFyZ2UgZGF0YSBzZXRzIChhZGRpbmcgYW5kIHJlbW92aW5nIG9mIGNsYXNzZXMgaXMgYWx3YXlzIHNsb3cgYXQgdGhlIGJlc3Qgb2YgdGltZXMuLikKCQkJICogRnVydGhlciB0byB0aGlzLCBub3RlIHRoYXQgdGhpcyBjb2RlIGlzIGFkbWl0dGVkbHkgZmFpcmx5IHVnbHkuIEl0IGNvdWxkIGJlIG1hZGUgYSBsb3QgCgkJCSAqIHNpbXBsZXIgdXNpbmcgalF1ZXJ5IHNlbGVjdG9ycyBhbmQgYWRkL3JlbW92ZUNsYXNzLCBidXQgdGhhdCBpcyBzaWduaWZpY2FudGx5IHNsb3dlcgoJCQkgKiAob24gdGhlIG9yZGVyIG9mIDUgdGltZXMgc2xvd2VyKSAtIGhlbmNlIHRoZSBkaXJlY3QgRE9NIG1hbmlwdWxhdGlvbiBoZXJlLgoJCQkgKiBOb3RlIHRoYXQgZm9yIGRlZmVycmVkIGRyYXdpbmcgd2UgZG8gdXNlIGpRdWVyeSAtIHRoZSByZWFzb24gYmVpbmcgdGhhdCB0YWtpbmcgdGhlIGZpcnN0CgkJCSAqIHJvdyBmb3VuZCB0byBzZWUgaWYgdGhlIHdob2xlIGNvbHVtbiBuZWVkcyBwcm9jZXNzZWQgY2FuIG1pc3MgY2xhc3NlcyBzaW5jZSB0aGUgZmlyc3QKCQkJICogY29sdW1uIG1pZ2h0IGJlIG5ldy4KCQkJICovCgkJCXNDbGFzcyA9IG9DbGFzc2VzLnNTb3J0Q29sdW1uOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnRDbGFzc2VzICkKCQkJewoJCQkJdmFyIG5UZHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MgKTsKCQkJCQoJCQkJLyogRGV0ZXJtaW5lIHdoYXQgdGhlIHNvcnRpbmcgY2xhc3MgZm9yIGVhY2ggY29sdW1uIHNob3VsZCBiZSAqLwoJCQkJdmFyIGlDbGFzcywgaVRhcmdldENvbDsKCQkJCXZhciBhc0NsYXNzZXMgPSBbXTsKCQkJCWZvciAoaSA9IDA7IGkgPCBpQ29sdW1uczsgaSsrKQoJCQkJewoJCQkJCWFzQ2xhc3Nlcy5wdXNoKCIiKTsKCQkJCX0KCQkJCWZvciAoaSA9IDAsIGlDbGFzcyA9IDE7IGkgPCBhYVNvcnQubGVuZ3RoOyBpKyspCgkJCQl7CgkJCQkJaVRhcmdldENvbCA9IHBhcnNlSW50KCBhYVNvcnRbaV1bMF0sIDEwICk7CgkJCQkJYXNDbGFzc2VzW2lUYXJnZXRDb2xdID0gc0NsYXNzICsgaUNsYXNzOwoJCQkJCQoJCQkJCWlmICggaUNsYXNzIDwgMyApCgkJCQkJewoJCQkJCQlpQ2xhc3MrKzsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIE1ha2UgY2hhbmdlcyB0byB0aGUgY2xhc3NlcyBmb3IgZWFjaCBjZWxsIGFzIG5lZWRlZCAqLwoJCQkJdmFyIHJlQ2xhc3MgPSBuZXcgUmVnRXhwKHNDbGFzcyArICJbMTIzXSIpOwoJCQkJdmFyIHNUbXBDbGFzcywgc0N1cnJlbnRDbGFzcywgc05ld0NsYXNzOwoJCQkJZm9yICggaT0wLCBpTGVuPW5UZHMubGVuZ3RoOyBpPGlMZW47IGkrKyApCgkJCQl7CgkJCQkJLyogRGV0ZXJtaW5lIHdoaWNoIGNvbHVtbiB3ZSdyZSBsb29raW5nIGF0ICovCgkJCQkJaVRhcmdldENvbCA9IGkgJSBpQ29sdW1uczsKCQkJCQkKCQkJCQkvKiBXaGF0IGlzIHRoZSBmdWxsIGxpc3Qgb2YgY2xhc3NlcyBub3cgKi8KCQkJCQlzQ3VycmVudENsYXNzID0gblRkc1tpXS5jbGFzc05hbWU7CgkJCQkJLyogV2hhdCBzb3J0aW5nIGNsYXNzIHNob3VsZCBiZSBhcHBsaWVkPyAqLwoJCQkJCXNOZXdDbGFzcyA9IGFzQ2xhc3Nlc1tpVGFyZ2V0Q29sXTsKCQkJCQkvKiBXaGF0IHdvdWxkIHRoZSBuZXcgZnVsbCBsaXN0IGJlIGlmIHdlIGRpZCBhIHJlcGxhY2VtZW50PyAqLwoJCQkJCXNUbXBDbGFzcyA9IHNDdXJyZW50Q2xhc3MucmVwbGFjZShyZUNsYXNzLCBzTmV3Q2xhc3MpOwoJCQkJCQoJCQkJCWlmICggc1RtcENsYXNzICE9IHNDdXJyZW50Q2xhc3MgKQoJCQkJCXsKCQkJCQkJLyogV2UgY2hhbmdlZCBzb21ldGhpbmcgKi8KCQkJCQkJblRkc1tpXS5jbGFzc05hbWUgPSAkLnRyaW0oIHNUbXBDbGFzcyApOwoJCQkJCX0KCQkJCQllbHNlIGlmICggc05ld0NsYXNzLmxlbmd0aCA+IDAgJiYgc0N1cnJlbnRDbGFzcy5pbmRleE9mKHNOZXdDbGFzcykgPT0gLTEgKQoJCQkJCXsKCQkJCQkJLyogV2UgbmVlZCB0byBhZGQgYSBjbGFzcyAqLwoJCQkJCQluVGRzW2ldLmNsYXNzTmFtZSA9IHNDdXJyZW50Q2xhc3MgKyAiICIgKyBzTmV3Q2xhc3M7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIFNhdmUgdGhlIHN0YXRlIG9mIGEgdGFibGUgaW4gYSBjb29raWUgc3VjaCB0aGF0IHRoZSBwYWdlIGNhbiBiZSByZWxvYWRlZAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNhdmVTdGF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTdGF0ZVNhdmUgfHwgb1NldHRpbmdzLmJEZXN0cm95aW5nICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCgkJCS8qIFN0b3JlIHRoZSBpbnRlcmVzdGluZyB2YXJpYWJsZXMgKi8KCQkJdmFyIGksIGlMZW4sIGJJbmZpbml0ZT1vU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGU7CgkJCXZhciBvU3RhdGUgPSB7CgkJCQkiaUNyZWF0ZSI6ICAgICAgbmV3IERhdGUoKS5nZXRUaW1lKCksCgkJCQkiaVN0YXJ0IjogICAgICAgKGJJbmZpbml0ZSA/IDAgOiBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQpLAoJCQkJImlFbmQiOiAgICAgICAgIChiSW5maW5pdGUgPyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDogb1NldHRpbmdzLl9pRGlzcGxheUVuZCksCgkJCQkiaUxlbmd0aCI6ICAgICAgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCwKCQkJCSJhYVNvcnRpbmciOiAgICAkLmV4dGVuZCggdHJ1ZSwgW10sIG9TZXR0aW5ncy5hYVNvcnRpbmcgKSwKCQkJCSJvU2VhcmNoIjogICAgICAkLmV4dGVuZCggdHJ1ZSwge30sIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2ggKSwKCQkJCSJhb1NlYXJjaENvbHMiOiAkLmV4dGVuZCggdHJ1ZSwgW10sIG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHMgKSwKCQkJCSJhYlZpc0NvbHMiOiAgICBbXQoJCQl9OwoJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvU3RhdGUuYWJWaXNDb2xzLnB1c2goIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKTsKCQkJfQoJCQoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgImFvU3RhdGVTYXZlUGFyYW1zIiwgJ3N0YXRlU2F2ZVBhcmFtcycsIFtvU2V0dGluZ3MsIG9TdGF0ZV0gKTsKCQkJCgkJCW9TZXR0aW5ncy5mblN0YXRlU2F2ZS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3MsIG9TdGF0ZSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBdHRlbXB0IHRvIGxvYWQgYSBzYXZlZCB0YWJsZSBzdGF0ZSBmcm9tIGEgY29va2llCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9Jbml0IERhdGFUYWJsZXMgaW5pdCBvYmplY3Qgc28gd2UgY2FuIG92ZXJyaWRlIHNldHRpbmdzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxvYWRTdGF0ZSAoIG9TZXR0aW5ncywgb0luaXQgKQoJCXsKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU3RhdGVTYXZlICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCgkJCXZhciBvRGF0YSA9IG9TZXR0aW5ncy5mblN0YXRlTG9hZC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3MgKTsKCQkJaWYgKCAhb0RhdGEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIEFsbG93IGN1c3RvbSBhbmQgcGx1Zy1pbiBtYW5pcHVsYXRpb24gZnVuY3Rpb25zIHRvIGFsdGVyIHRoZSBzYXZlZCBkYXRhIHNldCBhbmQKCQkJICogY2FuY2VsbGluZyBvZiBsb2FkaW5nIGJ5IHJldHVybmluZyBmYWxzZQoJCQkgKi8KCQkJdmFyIGFiU3RhdGVMb2FkID0gX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZFBhcmFtcycsICdzdGF0ZUxvYWRQYXJhbXMnLCBbb1NldHRpbmdzLCBvRGF0YV0gKTsKCQkJaWYgKCAkLmluQXJyYXkoIGZhbHNlLCBhYlN0YXRlTG9hZCApICE9PSAtMSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU3RvcmUgdGhlIHNhdmVkIHN0YXRlIHNvIGl0IG1pZ2h0IGJlIGFjY2Vzc2VkIGF0IGFueSB0aW1lICovCgkJCW9TZXR0aW5ncy5vTG9hZGVkU3RhdGUgPSAkLmV4dGVuZCggdHJ1ZSwge30sIG9EYXRhICk7CgkJCQoJCQkvKiBSZXN0b3JlIGtleSBmZWF0dXJlcyAqLwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgICAgPSBvRGF0YS5pU3RhcnQ7CgkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IG9EYXRhLmlTdGFydDsKCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCAgICAgID0gb0RhdGEuaUVuZDsKCQkJb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCAgID0gb0RhdGEuaUxlbmd0aDsKCQkJb1NldHRpbmdzLmFhU29ydGluZyAgICAgICAgID0gb0RhdGEuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCW9TZXR0aW5ncy5zYXZlZF9hYVNvcnRpbmcgICA9IG9EYXRhLmFhU29ydGluZy5zbGljZSgpOwoJCQkKCQkJLyogU2VhcmNoIGZpbHRlcmluZyAgKi8KCQkJJC5leHRlbmQoIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2gsIG9EYXRhLm9TZWFyY2ggKTsKCQkJJC5leHRlbmQoIHRydWUsIG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHMsIG9EYXRhLmFvU2VhcmNoQ29scyApOwoJCQkKCQkJLyogQ29sdW1uIHZpc2liaWxpdHkgc3RhdGUKCQkJICogUGFzcyBiYWNrIHZpc2liaWxpdHkgc2V0dGluZ3MgdG8gdGhlIGluaXQgaGFuZGxlciwgYnV0IHRvIGRvIG5vdCBoZXJlIG92ZXJyaWRlCgkJCSAqIHRoZSBpbml0IG9iamVjdCB0aGF0IHRoZSB1c2VyIG1pZ2h0IGhhdmUgcGFzc2VkIGluCgkJCSAqLwoJCQlvSW5pdC5zYXZlZF9hb0NvbHVtbnMgPSBbXTsKCQkJZm9yICggdmFyIGk9MCA7IGk8b0RhdGEuYWJWaXNDb2xzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCW9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXSA9IHt9OwoJCQkJb0luaXQuc2F2ZWRfYW9Db2x1bW5zW2ldLmJWaXNpYmxlID0gb0RhdGEuYWJWaXNDb2xzW2ldOwoJCQl9CgkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICdzdGF0ZUxvYWRlZCcsIFtvU2V0dGluZ3MsIG9EYXRhXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgY29va2llIHdpdGggYSB2YWx1ZSB0byBzdG9yZSB0aGUgc3RhdGUgb2YgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgbmFtZSBvZiB0aGUgY29va2llIHRvIGNyZWF0ZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZhbHVlIHRoZSB2YWx1ZSB0aGUgY29va2llIHNob3VsZCB0YWtlCgkJICogIEBwYXJhbSB7aW50fSBpU2VjcyBkdXJhdGlvbiBvZiB0aGUgY29va2llCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzQmFzZU5hbWUgc05hbWUgaXMgbWFkZSB1cCBvZiB0aGUgYmFzZSArIGZpbGUgbmFtZSAtIHRoaXMgaXMgdGhlIGJhc2UKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm5DYWxsYmFjayBVc2VyIGRlZmluYWJsZSBmdW5jdGlvbiB0byBtb2RpZnkgdGhlIGNvb2tpZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVDb29raWUgKCBzTmFtZSwgc1ZhbHVlLCBpU2Vjcywgc0Jhc2VOYW1lLCBmbkNhbGxiYWNrICkKCQl7CgkJCXZhciBkYXRlID0gbmV3IERhdGUoKTsKCQkJZGF0ZS5zZXRUaW1lKCBkYXRlLmdldFRpbWUoKSsoaVNlY3MqMTAwMCkgKTsKCQkJCgkJCS8qIAoJCQkgKiBTaG9ja2luZyBidXQgdHJ1ZSAtIGl0IHdvdWxkIGFwcGVhciBJRSBoYXMgbWFqb3IgaXNzdWVzIHdpdGggaGF2aW5nIHRoZSBwYXRoIG5vdCBoYXZpbmcKCQkJICogYSB0cmFpbGluZyBzbGFzaCBvbiBpdC4gV2UgbmVlZCB0aGUgY29va2llIHRvIGJlIGF2YWlsYWJsZSBiYXNlZCBvbiB0aGUgcGF0aCwgc28gd2UKCQkJICogaGF2ZSB0byBhcHBlbmQgdGhlIGZpbGUgbmFtZSB0byB0aGUgY29va2llIG5hbWUuIEFwcGFsbGluZy4gVGhhbmtzIHRvIHZleCBmb3IgYWRkaW5nIHRoZQoJCQkgKiBwYXRjaCB0byB1c2UgYXQgbGVhc3Qgc29tZSBvZiB0aGUgcGF0aAoJCQkgKi8KCQkJdmFyIGFQYXJ0cyA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpOwoJCQl2YXIgc05hbWVGaWxlID0gc05hbWUgKyAnXycgKyBhUGFydHMucG9wKCkucmVwbGFjZSgvW1wvOl0vZywiIikudG9Mb3dlckNhc2UoKTsKCQkJdmFyIHNGdWxsQ29va2llLCBvRGF0YTsKCQkJCgkJCWlmICggZm5DYWxsYmFjayAhPT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhID0gKHR5cGVvZiAkLnBhcnNlSlNPTiA9PT0gJ2Z1bmN0aW9uJykgPyAKCQkJCQkkLnBhcnNlSlNPTiggc1ZhbHVlICkgOiBldmFsKCAnKCcrc1ZhbHVlKycpJyApOwoJCQkJc0Z1bGxDb29raWUgPSBmbkNhbGxiYWNrKCBzTmFtZUZpbGUsIG9EYXRhLCBkYXRlLnRvR01UU3RyaW5nKCksCgkJCQkJYVBhcnRzLmpvaW4oJy8nKSsiLyIgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXNGdWxsQ29va2llID0gc05hbWVGaWxlICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHNWYWx1ZSkgKwoJCQkJCSI7IGV4cGlyZXM9IiArIGRhdGUudG9HTVRTdHJpbmcoKSArIjsgcGF0aD0iICsgYVBhcnRzLmpvaW4oJy8nKSsiLyI7CgkJCX0KCQkJCgkJCS8qIEFyZSB3ZSBnb2luZyB0byBnbyBvdmVyIHRoZSBjb29raWUgbGltaXQgb2YgNEtpQj8gSWYgc28sIHRyeSB0byBkZWxldGUgYSBjb29raWVzCgkJCSAqIGJlbG9uZ2luZyB0byBEYXRhVGFibGVzLgoJCQkgKi8KCQkJdmFyCgkJCQlhQ29va2llcyA9ZG9jdW1lbnQuY29va2llLnNwbGl0KCc7JyksCgkJCQlpTmV3Q29va2llTGVuID0gc0Z1bGxDb29raWUuc3BsaXQoJzsnKVswXS5sZW5ndGgsCgkJCQlhT2xkQ29va2llcyA9IFtdOwoJCQkKCQkJaWYgKCBpTmV3Q29va2llTGVuK2RvY3VtZW50LmNvb2tpZS5sZW5ndGgrMTAgPiA0MDk2ICkgLyogTWFnaWMgMTAgZm9yIHBhZGRpbmcgKi8KCQkJewoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hQ29va2llcy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYUNvb2tpZXNbaV0uaW5kZXhPZiggc0Jhc2VOYW1lICkgIT0gLTEgKQoJCQkJCXsKCQkJCQkJLyogSXQncyBhIERhdGFUYWJsZXMgY29va2llLCBzbyBldmFsIGl0IGFuZCBjaGVjayB0aGUgdGltZSBzdGFtcCAqLwoJCQkJCQl2YXIgYVNwbGl0Q29va2llID0gYUNvb2tpZXNbaV0uc3BsaXQoJz0nKTsKCQkJCQkJdHJ5IHsKCQkJCQkJCW9EYXRhID0gZXZhbCggJygnK2RlY29kZVVSSUNvbXBvbmVudChhU3BsaXRDb29raWVbMV0pKycpJyApOwoJCQoJCQkJCQkJaWYgKCBvRGF0YSAmJiBvRGF0YS5pQ3JlYXRlICkKCQkJCQkJCXsKCQkJCQkJCQlhT2xkQ29va2llcy5wdXNoKCB7CgkJCQkJCQkJCSJuYW1lIjogYVNwbGl0Q29va2llWzBdLAoJCQkJCQkJCQkidGltZSI6IG9EYXRhLmlDcmVhdGUKCQkJCQkJCQl9ICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJY2F0Y2goIGUgKSB7fQoJCQkJCX0KCQkJCX0KCQkKCQkJCS8vIE1ha2Ugc3VyZSB3ZSBkZWxldGUgdGhlIG9sZGVzdCBvbmVzIGZpcnN0CgkJCQlhT2xkQ29va2llcy5zb3J0KCBmdW5jdGlvbiAoYSwgYikgewoJCQkJCXJldHVybiBiLnRpbWUgLSBhLnRpbWU7CgkJCQl9ICk7CgkJCgkJCQkvLyBFbGltaW5hdGUgYXMgbWFueSBvbGQgRGF0YVRhYmxlcyBjb29raWVzIGFzIHdlIG5lZWQgdG8KCQkJCXdoaWxlICggaU5ld0Nvb2tpZUxlbiArIGRvY3VtZW50LmNvb2tpZS5sZW5ndGggKyAxMCA+IDQwOTYgKSB7CgkJCQkJaWYgKCBhT2xkQ29va2llcy5sZW5ndGggPT09IDAgKSB7CgkJCQkJCS8vIERlbGV0ZWQgYWxsIERUIGNvb2tpZXMgYW5kIHN0aWxsIG5vdCBlbm91Z2ggc3BhY2UuIENhbid0IHN0YXRlIHNhdmUKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCQkKCQkJCQl2YXIgb2xkID0gYU9sZENvb2tpZXMucG9wKCk7CgkJCQkJZG9jdW1lbnQuY29va2llID0gb2xkLm5hbWUrIj07IGV4cGlyZXM9VGh1LCAwMS1KYW4tMTk3MCAwMDowMDowMSBHTVQ7IHBhdGg9IisKCQkJCQkJYVBhcnRzLmpvaW4oJy8nKSArICIvIjsKCQkJCX0KCQkJfQoJCQkKCQkJZG9jdW1lbnQuY29va2llID0gc0Z1bGxDb29raWU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlYWQgYW4gb2xkIGNvb2tpZSB0byBnZXQgYSBjb29raWUgd2l0aCBhbiBvbGQgdGFibGUgc3RhdGUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNOYW1lIG5hbWUgb2YgdGhlIGNvb2tpZSB0byByZWFkCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGNvbnRlbnRzIG9mIHRoZSBjb29raWUgLSBvciBudWxsIGlmIG5vIGNvb2tpZSB3aXRoIHRoYXQgbmFtZSBmb3VuZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZWFkQ29va2llICggc05hbWUgKQoJCXsKCQkJdmFyCgkJCQlhUGFydHMgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKSwKCQkJCXNOYW1lRVEgPSBzTmFtZSArICdfJyArIGFQYXJ0c1thUGFydHMubGVuZ3RoLTFdLnJlcGxhY2UoL1tcLzpdL2csIiIpLnRvTG93ZXJDYXNlKCkgKyAnPScsCgkJCSAJc0Nvb2tpZUNvbnRlbnRzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7CgkJCQoJCQlmb3IoIHZhciBpPTAgOyBpPHNDb29raWVDb250ZW50cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQl2YXIgYyA9IHNDb29raWVDb250ZW50c1tpXTsKCQkJCQoJCQkJd2hpbGUgKGMuY2hhckF0KDApPT0nICcpCgkJCQl7CgkJCQkJYyA9IGMuc3Vic3RyaW5nKDEsYy5sZW5ndGgpOwoJCQkJfQoJCQkJCgkJCQlpZiAoYy5pbmRleE9mKHNOYW1lRVEpID09PSAwKQoJCQkJewoJCQkJCXJldHVybiBkZWNvZGVVUklDb21wb25lbnQoIGMuc3Vic3RyaW5nKHNOYW1lRVEubGVuZ3RoLGMubGVuZ3RoKSApOwoJCQkJfQoJCQl9CgkJCXJldHVybiBudWxsOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gdGhlIHNldHRpbmdzIG9iamVjdCBmb3IgYSBwYXJ0aWN1bGFyIHRhYmxlCgkJICogIEBwYXJhbSB7bm9kZX0gblRhYmxlIHRhYmxlIHdlIGFyZSB1c2luZyBhcyBhIGRhdGFUYWJsZQoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBTZXR0aW5ncyBvYmplY3QgLSBvciBudWxsIGlmIG5vdCBmb3VuZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXR0aW5nc0Zyb21Ob2RlICggblRhYmxlICkKCQl7CgkJCWZvciAoIHZhciBpPTAgOyBpPERhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5uVGFibGUgPT09IG5UYWJsZSApCgkJCQl7CgkJCQkJcmV0dXJuIERhdGFUYWJsZS5zZXR0aW5nc1tpXTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiBhbiBhcnJheSB3aXRoIHRoZSBUUiBub2RlcyBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBUUiBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRUck5vZGVzICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhTm9kZXMgPSBbXTsKCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGE7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJYU5vZGVzLnB1c2goIGFvRGF0YVtpXS5uVHIgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gYU5vZGVzOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gZmxhdCBhcnJheSB3aXRoIGFsbCBURCBub2RlcyBmb3IgdGhlIHRhYmxlLCBvciByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gW2lJbmRpdmlkdWFsUm93XSBhb0RhdGEgaW5kZXggdG8gZ2V0IHRoZSBub2RlcyBmb3IgLSBvcHRpb25hbCAKCQkgKiAgICBpZiBub3QgZ2l2ZW4gdGhlbiB0aGUgcmV0dXJuIGFycmF5IHdpbGwgY29udGFpbiBhbGwgbm9kZXMgZm9yIHRoZSB0YWJsZQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IFREIGFycmF5CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFRkTm9kZXMgKCBvU2V0dGluZ3MsIGlJbmRpdmlkdWFsUm93ICkKCQl7CgkJCXZhciBhblJldHVybiA9IFtdOwoJCQl2YXIgaUNvcnJlY3RvcjsKCQkJdmFyIGFuVGRzLCBuVGQ7CgkJCXZhciBpUm93LCBpUm93cz1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCwKCQkJCWlDb2x1bW4sIGlDb2x1bW5zLCBvRGF0YSwgc05vZGVOYW1lLCBpU3RhcnQ9MCwgaUVuZD1pUm93czsKCQkJCgkJCS8qIEFsbG93IHRoZSBjb2xsZWN0aW9uIHRvIGJlIGxpbWl0ZWQgdG8ganVzdCBvbmUgcm93ICovCgkJCWlmICggaUluZGl2aWR1YWxSb3cgIT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlTdGFydCA9IGlJbmRpdmlkdWFsUm93OwoJCQkJaUVuZCA9IGlJbmRpdmlkdWFsUm93KzE7CgkJCX0KCQkKCQkJZm9yICggaVJvdz1pU3RhcnQgOyBpUm93PGlFbmQgOyBpUm93KysgKQoJCQl7CgkJCQlvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCQlpZiAoIG9EYXRhLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJLyogZ2V0IHRoZSBURCBjaGlsZCBub2RlcyAtIHRha2luZyBpbnRvIGFjY291bnQgdGV4dCBldGMgbm9kZXMgKi8KCQkJCQlhblRkcyA9IFtdOwoJCQkJCW5UZCA9IG9EYXRhLm5Uci5maXJzdENoaWxkOwoJCQkJCXdoaWxlICggblRkICkKCQkJCQl7CgkJCQkJCXNOb2RlTmFtZSA9IG5UZC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAndGQnIHx8IHNOb2RlTmFtZSA9PSAndGgnICkKCQkJCQkJewoJCQkJCQkJYW5UZHMucHVzaCggblRkICk7CgkJCQkJCX0KCQkJCQkJblRkID0gblRkLm5leHRTaWJsaW5nOwoJCQkJCX0KCQkKCQkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCQlmb3IgKCBpQ29sdW1uPTAsIGlDb2x1bW5zPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaUNvbHVtbjxpQ29sdW1ucyA7IGlDb2x1bW4rKyApCgkJCQkJewoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlhblJldHVybi5wdXNoKCBhblRkc1tpQ29sdW1uLWlDb3JyZWN0b3JdICk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlhblJldHVybi5wdXNoKCBvRGF0YS5fYW5IaWRkZW5baUNvbHVtbl0gKTsKCQkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQlyZXR1cm4gYW5SZXR1cm47CgkJfQoJCQoJCQoJCS8qKgoJCSAqIExvZyBhbiBlcnJvciBtZXNzYWdlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlMZXZlbCBsb2cgZXJyb3IgbWVzc2FnZXMsIG9yIGRpc3BsYXkgdGhlbSB0byB0aGUgdXNlcgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc01lc2cgZXJyb3IgbWVzc2FnZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Mb2coIG9TZXR0aW5ncywgaUxldmVsLCBzTWVzZyApCgkJewoJCQl2YXIgc0FsZXJ0ID0gKG9TZXR0aW5ncz09PW51bGwpID8KCQkJCSJEYXRhVGFibGVzIHdhcm5pbmc6ICIrc01lc2cgOgoJCQkJIkRhdGFUYWJsZXMgd2FybmluZyAodGFibGUgaWQgPSAnIitvU2V0dGluZ3Muc1RhYmxlSWQrIicpOiAiK3NNZXNnOwoJCQkKCQkJaWYgKCBpTGV2ZWwgPT09IDAgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5leHQuc0Vyck1vZGUgPT0gJ2FsZXJ0JyApCgkJCQl7CgkJCQkJYWxlcnQoIHNBbGVydCApOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCXRocm93IG5ldyBFcnJvcihzQWxlcnQpOwoJCQkJfQoJCQkJcmV0dXJuOwoJCQl9CgkJCWVsc2UgaWYgKCB3aW5kb3cuY29uc29sZSAmJiBjb25zb2xlLmxvZyApCgkJCXsKCQkJCWNvbnNvbGUubG9nKCBzQWxlcnQgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZWUgaWYgYSBwcm9wZXJ0eSBpcyBkZWZpbmVkIG9uIG9uZSBvYmplY3QsIGlmIHNvIGFzc2lnbiBpdCB0byB0aGUgb3RoZXIgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvUmV0IHRhcmdldCBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TcmMgc291cmNlIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgcHJvcGVydHkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtzTWFwcGVkTmFtZV0gbmFtZSB0byBtYXAgdG9vIC0gb3B0aW9uYWwsIHNOYW1lIHVzZWQgaWYgbm90IGdpdmVuCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk1hcCggb1JldCwgb1NyYywgc05hbWUsIHNNYXBwZWROYW1lICkKCQl7CgkJCWlmICggc01hcHBlZE5hbWUgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXNNYXBwZWROYW1lID0gc05hbWU7CgkJCX0KCQkJaWYgKCBvU3JjW3NOYW1lXSAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJb1JldFtzTWFwcGVkTmFtZV0gPSBvU3JjW3NOYW1lXTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBFeHRlbmQgb2JqZWN0cyAtIHZlcnkgc2ltaWxhciB0byBqUXVlcnkuZXh0ZW5kLCBidXQgZGVlcCBjb3B5IG9iamVjdHMsIGFuZCBzaGFsbG93CgkJICogY29weSBhcnJheXMuIFRoZSByZWFzb24gd2UgbmVlZCB0byBkbyB0aGlzLCBpcyB0aGF0IHdlIGRvbid0IHdhbnQgdG8gZGVlcCBjb3B5IGFycmF5CgkJICogaW5pdCB2YWx1ZXMgKHN1Y2ggYXMgYWFTb3J0aW5nKSBzaW5jZSB0aGUgZGV2IHdvdWxkbid0IGJlIGFibGUgdG8gb3ZlcnJpZGUgdGhlbSwgYnV0CgkJICogd2UgZG8gd2FudCB0byBkZWVwIGNvcHkgYXJyYXlzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb091dCBPYmplY3QgdG8gZXh0ZW5kCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRXh0ZW5kZXIgT2JqZWN0IGZyb20gd2hpY2ggdGhlIHByb3BlcnRpZXMgd2lsbCBiZSBhcHBsaWVkIHRvIG9PdXQKCQkgKiAgQHJldHVybnMge29iamVjdH0gb091dCBSZWZlcmVuY2UsIGp1c3QgZm9yIGNvbnZlbmllbmNlIC0gb091dCA9PT0gdGhlIHJldHVybi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICogIEB0b2RvIFRoaXMgZG9lc24ndCB0YWtlIGFjY291bnQgb2YgYXJyYXlzIGluc2lkZSB0aGUgZGVlcCBjb3BpZWQgb2JqZWN0cy4KCQkgKi8KCQlmdW5jdGlvbiBfZm5FeHRlbmQoIG9PdXQsIG9FeHRlbmRlciApCgkJewoJCQl2YXIgdmFsOwoJCQkKCQkJZm9yICggdmFyIHByb3AgaW4gb0V4dGVuZGVyICkKCQkJewoJCQkJaWYgKCBvRXh0ZW5kZXIuaGFzT3duUHJvcGVydHkocHJvcCkgKQoJCQkJewoJCQkJCXZhbCA9IG9FeHRlbmRlcltwcm9wXTsKCQkKCQkJCQlpZiAoIHR5cGVvZiBvSW5pdFtwcm9wXSA9PT0gJ29iamVjdCcgJiYgdmFsICE9PSBudWxsICYmICQuaXNBcnJheSh2YWwpID09PSBmYWxzZSApCgkJCQkJewoJCQkJCQkkLmV4dGVuZCggdHJ1ZSwgb091dFtwcm9wXSwgdmFsICk7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCW9PdXRbcHJvcF0gPSB2YWw7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCXJldHVybiBvT3V0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBCaW5kIGFuIGV2ZW50IGhhbmRlcnMgdG8gYWxsb3cgYSBjbGljayBvciByZXR1cm4ga2V5IHRvIGFjdGl2YXRlIHRoZSBjYWxsYmFjay4KCQkgKiBUaGlzIGlzIGdvb2QgZm9yIGFjY2Vzc2liaWxpdHkgc2luY2UgYSByZXR1cm4gb24gdGhlIGtleWJvYXJkIHdpbGwgaGF2ZSB0aGUKCQkgKiBzYW1lIGVmZmVjdCBhcyBhIGNsaWNrLCBpZiB0aGUgZWxlbWVudCBoYXMgZm9jdXMuCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gbiBFbGVtZW50IHRvIGJpbmQgdGhlIGFjdGlvbiB0bwoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgRGF0YSBvYmplY3QgdG8gcGFzcyB0byB0aGUgdHJpZ2dlcmVkIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIENhbGxiYWNrIGZ1bmN0aW9uIGZvciB3aGVuIHRoZSBldmVudCBpcyB0cmlnZ2VyZWQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQmluZEFjdGlvbiggbiwgb0RhdGEsIGZuICkKCQl7CgkJCSQobikKCQkJCS5iaW5kKCAnY2xpY2suRFQnLCBvRGF0YSwgZnVuY3Rpb24gKGUpIHsKCQkJCQkJbi5ibHVyKCk7IC8vIFJlbW92ZSBmb2N1cyBvdXRsaW5lIGZvciBtb3VzZSB1c2VycwoJCQkJCQlmbihlKTsKCQkJCQl9ICkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBvRGF0YSwgZnVuY3Rpb24gKGUpewoJCQkJCWlmICggZS53aGljaCA9PT0gMTMgKSB7CgkJCQkJCWZuKGUpOwoJCQkJCX0gfSApCgkJCQkuYmluZCggJ3NlbGVjdHN0YXJ0LkRUJywgZnVuY3Rpb24gKCkgewoJCQkJCS8qIFRha2UgdGhlIGJydXRhbCBhcHByb2FjaCB0byBjYW5jZWxsaW5nIHRleHQgc2VsZWN0aW9uICovCgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVnaXN0ZXIgYSBjYWxsYmFjayBmdW5jdGlvbi4gRWFzaWx5IGFsbG93cyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGFkZGVkIHRvCgkJICogYW4gYXJyYXkgc3RvcmUgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIHRoYXQgY2FuIHRoZW4gYWxsIGJlIGNhbGxlZCB0b2dldGhlci4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1N0b3JlIE5hbWUgb2YgdGhlIGFycmF5IHN0b3JhZ2UgZm9yIHRoZSBjYWxsYmFja3MgaW4gb1NldHRpbmdzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiYWNrCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBJZGVudGlmeWluZyBuYW1lIGZvciB0aGUgY2FsbGJhY2sgKGkuZS4gYSBsYWJlbCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgc1N0b3JlLCBmbiwgc05hbWUgKQoJCXsKCQkJaWYgKCBmbiApCgkJCXsKCQkJCW9TZXR0aW5nc1tzU3RvcmVdLnB1c2goIHsKCQkJCQkiZm4iOiBmbiwKCQkJCQkic05hbWUiOiBzTmFtZQoJCQkJfSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpcmUgY2FsbGJhY2sgZnVuY3Rpb25zIGFuZCB0cmlnZ2VyIGV2ZW50cy4gTm90ZSB0aGF0IHRoZSBsb29wIG92ZXIgdGhlIGNhbGxiYWNrCgkJICogYXJyYXkgc3RvcmUgaXMgZG9uZSBiYWNrd2FyZHMhIEZ1cnRoZXIgbm90ZSB0aGF0IHlvdSBkbyBub3Qgd2FudCB0byBmaXJlIG9mZiB0cmlnZ2VycwoJCSAqIGluIHRpbWUgc2Vuc2l0aXZlIGFwcGxpY2F0aW9ucyAoZm9yIGV4YW1wbGUgY2VsbCBjcmVhdGlvbikgYXMgaXRzIHNsb3cuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTdG9yZSBOYW1lIG9mIHRoZSBhcnJheSBzdG9yYWdlIGZvciB0aGUgY2FsbGJhY2tzIGluIG9TZXR0aW5ncwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1RyaWdnZXIgTmFtZSBvZiB0aGUgalF1ZXJ5IGN1c3RvbSBldmVudCB0byB0cmlnZ2VyLiBJZiBudWxsIG5vIHRyaWdnZXIKCQkgKiAgICBpcyBmaXJlZAoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJncyBBcnJheSBvZiBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gLyB0cmlnZ2VyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCBzU3RvcmUsIHNUcmlnZ2VyLCBhQXJncyApCgkJewoJCQl2YXIgYW9TdG9yZSA9IG9TZXR0aW5nc1tzU3RvcmVdOwoJCQl2YXIgYVJldCA9W107CgkJCgkJCWZvciAoIHZhciBpPWFvU3RvcmUubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJewoJCQkJYVJldC5wdXNoKCBhb1N0b3JlW2ldLmZuLmFwcGx5KCBvU2V0dGluZ3Mub0luc3RhbmNlLCBhQXJncyApICk7CgkJCX0KCQkKCQkJaWYgKCBzVHJpZ2dlciAhPT0gbnVsbCApCgkJCXsKCQkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcihzVHJpZ2dlciwgYUFyZ3MpOwoJCQl9CgkJCgkJCXJldHVybiBhUmV0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBKU09OIHN0cmluZ2lmeS4gSWYgSlNPTi5zdHJpbmdpZnkgaXQgcHJvdmlkZWQgYnkgdGhlIGJyb3dzZXIsIGpzb24yLmpzIG9yIGFueSBvdGhlcgoJCSAqIGxpYnJhcnksIHRoZW4gd2UgdXNlIHRoYXQgYXMgaXQgaXMgZmFzdCwgc2FmZSBhbmQgYWNjdXJhdGUuIElmIHRoZSBmdW5jdGlvbiBpc24ndCAKCQkgKiBhdmFpbGFibGUgdGhlbiB3ZSBuZWVkIHRvIGJ1aWx0IGl0IG91cnNlbHZlcyAtIHRoZSBpbnNwaXJhdGlvbiBmb3IgdGhpcyBmdW5jdGlvbiBjb21lcwoJCSAqIGZyb20gQ3JhaWcgQnVja2xlciAoIGh0dHA6Ly93d3cuc2l0ZXBvaW50LmNvbS9qYXZhc2NyaXB0LWpzb24tc2VyaWFsaXphdGlvbi8gKS4gSXQgaXMKCQkgKiBub3QgcGVyZmVjdCBhbmQgYWJzb2x1dGVseSBzaG91bGQgbm90IGJlIHVzZWQgYXMgYSByZXBsYWNlbWVudCB0byBqc29uMi5qcyAtIGJ1dCBpdCBkb2VzCgkJICogZG8gd2hhdCB3ZSBuZWVkLCB3aXRob3V0IHJlcXVpcmluZyBhIGRlcGVuZGVuY3kgZm9yIERhdGFUYWJsZXMuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIEpTT04gb2JqZWN0IHRvIGJlIGNvbnZlcnRlZAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBKU09OIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQl2YXIgX2ZuSnNvblN0cmluZyA9ICh3aW5kb3cuSlNPTikgPyBKU09OLnN0cmluZ2lmeSA6IGZ1bmN0aW9uKCBvICkKCQl7CgkJCS8qIE5vdCBhbiBvYmplY3Qgb3IgYXJyYXkgKi8KCQkJdmFyIHNUeXBlID0gdHlwZW9mIG87CgkJCWlmIChzVHlwZSAhPT0gIm9iamVjdCIgfHwgbyA9PT0gbnVsbCkKCQkJewoJCQkJLy8gc2ltcGxlIGRhdGEgdHlwZQoJCQkJaWYgKHNUeXBlID09PSAic3RyaW5nIikKCQkJCXsKCQkJCQlvID0gJyInK28rJyInOwoJCQkJfQoJCQkJcmV0dXJuIG8rIiI7CgkJCX0KCQkKCQkJLyogSWYgb2JqZWN0IG9yIGFycmF5LCBuZWVkIHRvIHJlY3Vyc2Ugb3ZlciBpdCAqLwoJCQl2YXIKCQkJCXNQcm9wLCBtVmFsdWUsCgkJCQlqc29uID0gW10sCgkJCQliQXJyID0gJC5pc0FycmF5KG8pOwoJCQkKCQkJZm9yIChzUHJvcCBpbiBvKQoJCQl7CgkJCQltVmFsdWUgPSBvW3NQcm9wXTsKCQkJCXNUeXBlID0gdHlwZW9mIG1WYWx1ZTsKCQkKCQkJCWlmIChzVHlwZSA9PT0gInN0cmluZyIpCgkJCQl7CgkJCQkJbVZhbHVlID0gJyInK21WYWx1ZSsnIic7CgkJCQl9CgkJCQllbHNlIGlmIChzVHlwZSA9PT0gIm9iamVjdCIgJiYgbVZhbHVlICE9PSBudWxsKQoJCQkJewoJCQkJCW1WYWx1ZSA9IF9mbkpzb25TdHJpbmcobVZhbHVlKTsKCQkJCX0KCQkKCQkJCWpzb24ucHVzaCgoYkFyciA/ICIiIDogJyInK3NQcm9wKyciOicpICsgbVZhbHVlKTsKCQkJfQoJCQoJCQlyZXR1cm4gKGJBcnIgPyAiWyIgOiAieyIpICsganNvbiArIChiQXJyID8gIl0iIDogIn0iKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEZyb20gc29tZSBicm93c2VycyAoc3BlY2lmaWNhbGx5IElFNi83KSB3ZSBuZWVkIHNwZWNpYWwgaGFuZGxpbmcgdG8gd29yayBhcm91bmQgYnJvd3NlcgoJCSAqIGJ1Z3MgLSB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZGV0ZWN0IHdoZW4gdGhlc2Ugd29ya2Fyb3VuZHMgYXJlIG5lZWRlZC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ccm93c2VyRGV0ZWN0KCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogSUU2Lzcgd2lsbCBvdmVyc2l6ZSBhIHdpZHRoIDEwMCUgZWxlbWVudCBpbnNpZGUgYSBzY3JvbGxpbmcgZWxlbWVudCwgdG8gaW5jbHVkZSB0aGUKCQkJICogd2lkdGggb2YgdGhlIHNjcm9sbGJhciwgd2hpbGUgb3RoZXIgYnJvd3NlcnMgZW5zdXJlIHRoZSBpbm5lciBlbGVtZW50IGlzIGNvbnRhaW5lZAoJCQkgKiB3aXRob3V0IGZvcmNpbmcgc2Nyb2xsaW5nCgkJCSAqLwoJCQl2YXIgbiA9ICQoCgkJCQknPGRpdiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7IHRvcDowOyBsZWZ0OjA7IGhlaWdodDoxcHg7IHdpZHRoOjFweDsgb3ZlcmZsb3c6aGlkZGVuIj4nKwoJCQkJCSc8ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjFweDsgbGVmdDoxcHg7IHdpZHRoOjEwMHB4OyBvdmVyZmxvdzpzY3JvbGw7Ij4nKwoJCQkJCQknPGRpdiBpZD0iRFRfQnJvd3NlclRlc3QiIHN0eWxlPSJ3aWR0aDoxMDAlOyBoZWlnaHQ6MTBweDsiPjwvZGl2PicrCgkJCQkJJzwvZGl2PicrCgkJCQknPC9kaXY+JylbMF07CgkJCgkJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIG4gKTsKCQkJb1NldHRpbmdzLm9Ccm93c2VyLmJTY3JvbGxPdmVyc2l6ZSA9ICQoJyNEVF9Ccm93c2VyVGVzdCcsIG4pWzBdLm9mZnNldFdpZHRoID09PSAxMDAgPyB0cnVlIDogZmFsc2U7CgkJCWRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoIG4gKTsKCQl9CgkJCgoJCS8qKgoJCSAqIFBlcmZvcm0gYSBqUXVlcnkgc2VsZWN0b3IgYWN0aW9uIG9uIHRoZSB0YWJsZSdzIFRSIGVsZW1lbnRzIChmcm9tIHRoZSB0Ym9keSkgYW5kCgkJICogcmV0dXJuIHRoZSByZXN1bHRpbmcgalF1ZXJ5IG9iamVjdC4KCQkgKiAgQHBhcmFtIHtzdHJpbmd8bm9kZXxqUXVlcnl9IHNTZWxlY3RvciBqUXVlcnkgc2VsZWN0b3Igb3Igbm9kZSBjb2xsZWN0aW9uIHRvIGFjdCBvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gW29PcHRzXSBPcHRpb25hbCBwYXJhbWV0ZXJzIGZvciBtb2RpZnlpbmcgdGhlIHJvd3MgdG8gYmUgaW5jbHVkZWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5maWx0ZXI9bm9uZV0gU2VsZWN0IFRSIGVsZW1lbnRzIHRoYXQgbWVldCB0aGUgY3VycmVudCBmaWx0ZXIKCQkgKiAgICBjcml0ZXJpb24gKCJhcHBsaWVkIikgb3IgYWxsIFRSIGVsZW1lbnRzIChpLmUuIG5vIGZpbHRlcikuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMub3JkZXI9Y3VycmVudF0gT3JkZXIgb2YgdGhlIFRSIGVsZW1lbnRzIGluIHRoZSBwcm9jZXNzZWQgYXJyYXkuCgkJICogICAgQ2FuIGJlIGVpdGhlciAnY3VycmVudCcsIHdoZXJlYnkgdGhlIGN1cnJlbnQgc29ydGluZyBvZiB0aGUgdGFibGUgaXMgdXNlZCwgb3IKCQkgKiAgICAnb3JpZ2luYWwnIHdoZXJlYnkgdGhlIG9yaWdpbmFsIG9yZGVyIHRoZSBkYXRhIHdhcyByZWFkIGludG8gdGhlIHRhYmxlIGlzIHVzZWQuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMucGFnZT1hbGxdIExpbWl0IHRoZSBzZWxlY3Rpb24gdG8gdGhlIGN1cnJlbnRseSBkaXNwbGF5ZWQgcGFnZQoJCSAqICAgICgiY3VycmVudCIpIG9yIG5vdCAoImFsbCIpLiBJZiAnY3VycmVudCcgaXMgZ2l2ZW4sIHRoZW4gb3JkZXIgaXMgYXNzdW1lZCB0byBiZSAKCQkgKiAgICAnY3VycmVudCcgYW5kIGZpbHRlciBpcyAnYXBwbGllZCcsIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB0aGV5IG1pZ2h0IGJlIGdpdmVuIGFzLgoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBqUXVlcnkgb2JqZWN0LCBmaWx0ZXJlZCBieSB0aGUgZ2l2ZW4gc2VsZWN0b3IuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIC8vIEhpZ2hsaWdodCBldmVyeSBzZWNvbmQgcm93CgkJICogICAgICBvVGFibGUuJCgndHI6b2RkJykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnYmx1ZScpOwoJCSAqICAgIH0gKTsKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIC8vIEZpbHRlciB0byByb3dzIHdpdGggJ1dlYmtpdCcgaW4gdGhlbSwgYWRkIGEgYmFja2dyb3VuZCBjb2xvdXIgYW5kIHRoZW4KCQkgKiAgICAgIC8vIHJlbW92ZSB0aGUgZmlsdGVyLCB0aHVzIGhpZ2hsaWdodGluZyB0aGUgJ1dlYmtpdCcgcm93cyBvbmx5LgoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCdXZWJraXQnKTsKCQkgKiAgICAgIG9UYWJsZS4kKCd0cicsIHsiZmlsdGVyIjogImFwcGxpZWQifSkuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnYmx1ZScpOwoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCcnKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy4kID0gZnVuY3Rpb24gKCBzU2VsZWN0b3IsIG9PcHRzICkKCQl7CgkJCXZhciBpLCBpTGVuLCBhID0gW10sIHRyOwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGE7CgkJCXZhciBhaURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5OwoJCQl2YXIgYWlEaXNwbGF5TWFzdGVyID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcjsKCQkKCQkJaWYgKCAhb09wdHMgKQoJCQl7CgkJCQlvT3B0cyA9IHt9OwoJCQl9CgkJCgkJCW9PcHRzID0gJC5leHRlbmQoIHt9LCB7CgkJCQkiZmlsdGVyIjogIm5vbmUiLCAvLyBhcHBsaWVkCgkJCQkib3JkZXIiOiAiY3VycmVudCIsIC8vICJvcmlnaW5hbCIKCQkJCSJwYWdlIjogImFsbCIgLy8gY3VycmVudAoJCQl9LCBvT3B0cyApOwoJCQoJCQkvLyBDdXJyZW50IHBhZ2UgaW1wbGllcyB0aGF0IG9yZGVyPWN1cnJlbnQgYW5kIGZpdGxlcj1hcHBsaWVkLCBzaW5jZSBpdCBpcyBmYWlybHkKCQkJLy8gc2Vuc2VsZXNzIG90aGVyd2lzZQoJCQlpZiAoIG9PcHRzLnBhZ2UgPT0gJ2N1cnJlbnQnICkKCQkJewoJCQkJZm9yICggaT1vU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQsIGlMZW49b1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgYWlEaXNwbGF5W2ldIF0ublRyOwoJCQkJCWlmICggdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gImN1cnJlbnQiICYmIG9PcHRzLmZpbHRlciA9PSAibm9uZSIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YWlEaXNwbGF5TWFzdGVyLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGFpRGlzcGxheU1hc3RlcltpXSBdLm5UcjsKCQkJCQlpZiAoIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJjdXJyZW50IiAmJiBvT3B0cy5maWx0ZXIgPT0gImFwcGxpZWQiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFpRGlzcGxheS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBhaURpc3BsYXlbaV0gXS5uVHI7CgkJCQkJaWYgKCB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAib3JpZ2luYWwiICYmIG9PcHRzLmZpbHRlciA9PSAibm9uZSIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGkgXS5uVHIgOwoJCQkJCWlmICggdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gIm9yaWdpbmFsIiAmJiBvT3B0cy5maWx0ZXIgPT0gImFwcGxpZWQiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBpIF0ublRyOwoJCQkJCWlmICggJC5pbkFycmF5KCBpLCBhaURpc3BsYXkgKSAhPT0gLTEgJiYgdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mbkxvZyggb1NldHRpbmdzLCAxLCAiVW5rbm93biBzZWxlY3Rpb24gb3B0aW9ucyIgKTsKCQkJfQoJCQoJCQkvKiBXZSBuZWVkIHRvIGZpbHRlciBvbiB0aGUgVFIgZWxlbWVudHMgYW5kIGFsc28gJ2ZpbmQnIGluIHRoZWlyIGRlc2NlbmRhbnRzCgkJCSAqIHRvIG1ha2UgdGhlIHNlbGVjdG9yIGFjdCBsaWtlIGl0IHdvdWxkIGluIGEgZnVsbCB0YWJsZSAtIHNvIHdlIG5lZWQKCQkJICogdG8gYnVpbGQgYm90aCByZXN1bHRzIGFuZCB0aGVuIGNvbWJpbmUgdGhlbSB0b2dldGhlcgoJCQkgKi8KCQkJdmFyIGpxQSA9ICQoYSk7CgkJCXZhciBqcVRScyA9IGpxQS5maWx0ZXIoIHNTZWxlY3RvciApOwoJCQl2YXIganFEZXNjZW5kYW50cyA9IGpxQS5maW5kKCBzU2VsZWN0b3IgKTsKCQkKCQkJcmV0dXJuICQoIFtdLmNvbmNhdCgkLm1ha2VBcnJheShqcVRScyksICQubWFrZUFycmF5KGpxRGVzY2VuZGFudHMpKSApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQWxtb3N0IGlkZW50aWNhbCB0byAkIGluIG9wZXJhdGlvbiwgYnV0IGluIHRoaXMgY2FzZSByZXR1cm5zIHRoZSBkYXRhIGZvciB0aGUgbWF0Y2hlZAoJCSAqIHJvd3MgLSBhcyBzdWNoLCB0aGUgalF1ZXJ5IHNlbGVjdG9yIHVzZWQgc2hvdWxkIG1hdGNoIFRSIHJvdyBub2RlcyBvciBURC9USCBjZWxsIG5vZGVzCgkJICogcmF0aGVyIHRoYW4gYW55IGRlc2NlbmRhbnRzLCBzbyB0aGUgZGF0YSBjYW4gYmUgb2J0YWluZWQgZm9yIHRoZSByb3cvY2VsbC4gSWYgbWF0Y2hpbmcKCQkgKiByb3dzIGFyZSBmb3VuZCwgdGhlIGRhdGEgcmV0dXJuZWQgaXMgdGhlIG9yaWdpbmFsIGRhdGEgYXJyYXkvb2JqZWN0IHRoYXQgd2FzIHVzZWQgdG8gIAoJCSAqIGNyZWF0ZSB0aGUgcm93IChvciBhIGdlbmVyYXRlZCBhcnJheSBpZiBmcm9tIGEgRE9NIHNvdXJjZSkuCgkJICoKCQkgKiBUaGlzIG1ldGhvZCBpcyBvZnRlbiB1c2VmdWwgaW4tY29tYmluYXRpb24gd2l0aCAkIHdoZXJlIGJvdGggZnVuY3Rpb25zIGFyZSBnaXZlbiB0aGUKCQkgKiBzYW1lIHBhcmFtZXRlcnMgYW5kIHRoZSBhcnJheSBpbmRleGVzIHdpbGwgbWF0Y2ggaWRlbnRpY2FsbHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfG5vZGV8alF1ZXJ5fSBzU2VsZWN0b3IgalF1ZXJ5IHNlbGVjdG9yIG9yIG5vZGUgY29sbGVjdGlvbiB0byBhY3Qgb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IFtvT3B0c10gT3B0aW9uYWwgcGFyYW1ldGVycyBmb3IgbW9kaWZ5aW5nIHRoZSByb3dzIHRvIGJlIGluY2x1ZGVkCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMuZmlsdGVyPW5vbmVdIFNlbGVjdCBlbGVtZW50cyB0aGF0IG1lZXQgdGhlIGN1cnJlbnQgZmlsdGVyCgkJICogICAgY3JpdGVyaW9uICgiYXBwbGllZCIpIG9yIGFsbCBlbGVtZW50cyAoaS5lLiBubyBmaWx0ZXIpLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLm9yZGVyPWN1cnJlbnRdIE9yZGVyIG9mIHRoZSBkYXRhIGluIHRoZSBwcm9jZXNzZWQgYXJyYXkuCgkJICogICAgQ2FuIGJlIGVpdGhlciAnY3VycmVudCcsIHdoZXJlYnkgdGhlIGN1cnJlbnQgc29ydGluZyBvZiB0aGUgdGFibGUgaXMgdXNlZCwgb3IKCQkgKiAgICAnb3JpZ2luYWwnIHdoZXJlYnkgdGhlIG9yaWdpbmFsIG9yZGVyIHRoZSBkYXRhIHdhcyByZWFkIGludG8gdGhlIHRhYmxlIGlzIHVzZWQuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMucGFnZT1hbGxdIExpbWl0IHRoZSBzZWxlY3Rpb24gdG8gdGhlIGN1cnJlbnRseSBkaXNwbGF5ZWQgcGFnZQoJCSAqICAgICgiY3VycmVudCIpIG9yIG5vdCAoImFsbCIpLiBJZiAnY3VycmVudCcgaXMgZ2l2ZW4sIHRoZW4gb3JkZXIgaXMgYXNzdW1lZCB0byBiZSAKCQkgKiAgICAnY3VycmVudCcgYW5kIGZpbHRlciBpcyAnYXBwbGllZCcsIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB0aGV5IG1pZ2h0IGJlIGdpdmVuIGFzLgoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgZm9yIHRoZSBtYXRjaGVkIGVsZW1lbnRzLiBJZiBhbnkgZWxlbWVudHMsIGFzIGEgcmVzdWx0IG9mIHRoZQoJCSAqICAgIHNlbGVjdG9yLCB3ZXJlIG5vdCBUUiwgVEQgb3IgVEggZWxlbWVudHMgaW4gdGhlIERhdGFUYWJsZSwgdGhleSB3aWxsIGhhdmUgYSBudWxsIAoJCSAqICAgIGVudHJ5IGluIHRoZSBhcnJheS4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gR2V0IHRoZSBkYXRhIGZyb20gdGhlIGZpcnN0IHJvdyBpbiB0aGUgdGFibGUKCQkgKiAgICAgIHZhciBkYXRhID0gb1RhYmxlLl8oJ3RyOmZpcnN0Jyk7CgkJICoKCQkgKiAgICAgIC8vIERvIHNvbWV0aGluZyB1c2VmdWwgd2l0aCB0aGUgZGF0YQoJCSAqICAgICAgYWxlcnQoICJGaXJzdCBjZWxsIGlzOiAiK2RhdGFbMF0gKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICAvLyBGaWx0ZXIgdG8gJ1dlYmtpdCcgYW5kIGdldCBhbGwgZGF0YSBmb3IgCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJ1dlYmtpdCcpOwoJCSAqICAgICAgdmFyIGRhdGEgPSBvVGFibGUuXygndHInLCB7ImZpbHRlciI6ICJhcHBsaWVkIn0pOwoJCSAqICAgICAgCgkJICogICAgICAvLyBEbyBzb21ldGhpbmcgd2l0aCB0aGUgZGF0YQoJCSAqICAgICAgYWxlcnQoIGRhdGEubGVuZ3RoKyIgcm93cyBtYXRjaGVkIHRoZSBmaWx0ZXIiICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuXyA9IGZ1bmN0aW9uICggc1NlbGVjdG9yLCBvT3B0cyApCgkJewoJCQl2YXIgYU91dCA9IFtdOwoJCQl2YXIgaSwgaUxlbiwgaUluZGV4OwoJCQl2YXIgYVRycyA9IHRoaXMuJCggc1NlbGVjdG9yLCBvT3B0cyApOwoJCQoJCQlmb3IgKCBpPTAsIGlMZW49YVRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlhT3V0LnB1c2goIHRoaXMuZm5HZXREYXRhKGFUcnNbaV0pICk7CgkJCX0KCQkKCQkJcmV0dXJuIGFPdXQ7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBZGQgYSBzaW5nbGUgbmV3IHJvdyBvciBtdWx0aXBsZSByb3dzIG9mIGRhdGEgdG8gdGhlIHRhYmxlLiBQbGVhc2Ugbm90ZQoJCSAqIHRoYXQgdGhpcyBpcyBzdWl0YWJsZSBmb3IgY2xpZW50LXNpZGUgcHJvY2Vzc2luZyBvbmx5IC0gaWYgeW91IGFyZSB1c2luZyAKCQkgKiBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIChpLmUuICJiU2VydmVyU2lkZSI6IHRydWUpLCB0aGVuIHRvIGFkZCBkYXRhLCB5b3UKCQkgKiBtdXN0IGFkZCBpdCB0byB0aGUgZGF0YSBzb3VyY2UsIGkuZS4gdGhlIHNlcnZlci1zaWRlLCB0aHJvdWdoIGFuIEFqYXggY2FsbC4KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG1EYXRhIFRoZSBkYXRhIHRvIGJlIGFkZGVkIHRvIHRoZSB0YWJsZS4gVGhpcyBjYW4gYmU6CgkJICogICAgPHVsPgoJCSAqICAgICAgPGxpPjFEIGFycmF5IG9mIGRhdGEgLSBhZGQgYSBzaW5nbGUgcm93IHdpdGggdGhlIGRhdGEgcHJvdmlkZWQ8L2xpPgoJCSAqICAgICAgPGxpPjJEIGFycmF5IG9mIGFycmF5cyAtIGFkZCBtdWx0aXBsZSByb3dzIGluIGEgc2luZ2xlIGNhbGw8L2xpPgoJCSAqICAgICAgPGxpPm9iamVjdCAtIGRhdGEgb2JqZWN0IHdoZW4gdXNpbmcgPGk+bURhdGE8L2k+PC9saT4KCQkgKiAgICAgIDxsaT5hcnJheSBvZiBvYmplY3RzIC0gbXVsdGlwbGUgZGF0YSBvYmplY3RzIHdoZW4gdXNpbmcgPGk+bURhdGE8L2k+PC9saT4KCQkgKiAgICA8L3VsPgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIHJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEByZXR1cm5zIHthcnJheX0gQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlcHJlc2VudGluZyB0aGUgbGlzdCBvZiBpbmRleGVzIGluIAoJCSAqICAgIDxpPmFvRGF0YTwvaT4gKHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30pIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIAoJCSAqICAgIHRoZSB0YWJsZS4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2xvYmFsIHZhciBmb3IgY291bnRlcgoJCSAqICAgIHZhciBnaUNvdW50ID0gMjsKCQkgKiAgICAKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIGZuQ2xpY2tBZGRSb3coKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpLmZuQWRkRGF0YSggWwoJCSAqICAgICAgICBnaUNvdW50KyIuMSIsCgkJICogICAgICAgIGdpQ291bnQrIi4yIiwKCQkgKiAgICAgICAgZ2lDb3VudCsiLjMiLAoJCSAqICAgICAgICBnaUNvdW50KyIuNCIgXQoJCSAqICAgICAgKTsKCQkgKiAgICAgICAgCgkJICogICAgICBnaUNvdW50Kys7CgkJICogICAgfQoJCSAqLwoJCXRoaXMuZm5BZGREYXRhID0gZnVuY3Rpb24oIG1EYXRhLCBiUmVkcmF3ICkKCQl7CgkJCWlmICggbURhdGEubGVuZ3RoID09PSAwICkKCQkJewoJCQkJcmV0dXJuIFtdOwoJCQl9CgkJCQoJCQl2YXIgYWlSZXR1cm4gPSBbXTsKCQkJdmFyIGlUZXN0OwoJCQkKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQkvKiBDaGVjayBpZiB3ZSB3YW50IHRvIGFkZCBtdWx0aXBsZSByb3dzIG9yIG5vdCAqLwoJCQlpZiAoIHR5cGVvZiBtRGF0YVswXSA9PT0gIm9iamVjdCIgJiYgbURhdGFbMF0gIT09IG51bGwgKQoJCQl7CgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxtRGF0YS5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlUZXN0ID0gX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBtRGF0YVtpXSApOwoJCQkJCWlmICggaVRlc3QgPT0gLTEgKQoJCQkJCXsKCQkJCQkJcmV0dXJuIGFpUmV0dXJuOwoJCQkJCX0KCQkJCQlhaVJldHVybi5wdXNoKCBpVGVzdCApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaVRlc3QgPSBfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG1EYXRhICk7CgkJCQlpZiAoIGlUZXN0ID09IC0xICkKCQkJCXsKCQkJCQlyZXR1cm4gYWlSZXR1cm47CgkJCQl9CgkJCQlhaVJldHVybi5wdXNoKCBpVGVzdCApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mblJlRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJcmV0dXJuIGFpUmV0dXJuOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiB3aWxsIG1ha2UgRGF0YVRhYmxlcyByZWNhbGN1bGF0ZSB0aGUgY29sdW1uIHNpemVzLCBiYXNlZCBvbiB0aGUgZGF0YSAKCQkgKiBjb250YWluZWQgaW4gdGhlIHRhYmxlIGFuZCB0aGUgc2l6ZXMgYXBwbGllZCB0byB0aGUgY29sdW1ucyAoaW4gdGhlIERPTSwgQ1NTIG9yIAoJCSAqIHRocm91Z2ggdGhlIHNXaWR0aCBwYXJhbWV0ZXIpLiBUaGlzIGNhbiBiZSB1c2VmdWwgd2hlbiB0aGUgd2lkdGggb2YgdGhlIHRhYmxlJ3MgCgkJICogcGFyZW50IGVsZW1lbnQgY2hhbmdlcyAoZm9yIGV4YW1wbGUgYSB3aW5kb3cgcmVzaXplKS4KCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdCwgeW91IHdpbGwgdHlwaWNhbGx5IHdhbnQgdG8KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIG9UYWJsZS5mbkFkanVzdENvbHVtblNpemluZygpOwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuQWRqdXN0Q29sdW1uU2l6aW5nID0gZnVuY3Rpb24gKCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdKTsKCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQl0aGlzLmZuRHJhdyggZmFsc2UgKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiIHx8IG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCS8qIElmIG5vdCByZWRyYXdpbmcsIGJ1dCBzY3JvbGxpbmcsIHdlIHdhbnQgdG8gYXBwbHkgdGhlIG5ldyBjb2x1bW4gc2l6ZXMgYW55d2F5ICovCgkJCQl0aGlzLm9BcGkuX2ZuU2Nyb2xsRHJhdyhvU2V0dGluZ3MpOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBRdWlja2x5IGFuZCBzaW1wbHkgY2xlYXIgYSB0YWJsZQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIHJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEltbWVkaWF0ZWx5ICdudWtlJyB0aGUgY3VycmVudCByb3dzIChwZXJoYXBzIHdhaXRpbmcgZm9yIGFuIEFqYXggY2FsbGJhY2suLi4pCgkJICogICAgICBvVGFibGUuZm5DbGVhclRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5DbGVhclRhYmxlID0gZnVuY3Rpb24oIGJSZWRyYXcgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCV9mbkNsZWFyVGFibGUoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGUgZXhhY3Qgb3Bwb3NpdGUgb2YgJ29wZW5pbmcnIGEgcm93LCB0aGlzIGZ1bmN0aW9uIHdpbGwgY2xvc2UgYW55IHJvd3Mgd2hpY2ggCgkJICogYXJlIGN1cnJlbnRseSAnb3BlbicuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIHRoZSB0YWJsZSByb3cgdG8gJ2Nsb3NlJwoJCSAqICBAcmV0dXJucyB7aW50fSAwIG9uIHN1Y2Nlc3MsIG9yIDEgaWYgZmFpbGVkIChjYW4ndCBmaW5kIHRoZSByb3cpCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkNsb3NlID0gZnVuY3Rpb24oIG5UciApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublBhcmVudCA9PSBuVHIgKQoJCQkJewoJCQkJCXZhciBuVHJQYXJlbnQgPSBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIucGFyZW50Tm9kZTsKCQkJCQlpZiAoIG5UclBhcmVudCApCgkJCQkJewoJCQkJCQkvKiBSZW1vdmUgaXQgaWYgaXQgaXMgY3VycmVudGx5IG9uIGRpc3BsYXkgKi8KCQkJCQkJblRyUGFyZW50LnJlbW92ZUNoaWxkKCBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIgKTsKCQkJCQl9CgkJCQkJb1NldHRpbmdzLmFvT3BlblJvd3Muc3BsaWNlKCBpLCAxICk7CgkJCQkJcmV0dXJuIDA7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIDE7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBSZW1vdmUgYSByb3cgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge21peGVkfSBtVGFyZ2V0IFRoZSBpbmRleCBvZiB0aGUgcm93IGZyb20gYW9EYXRhIHRvIGJlIGRlbGV0ZWQsIG9yCgkJICogICAgdGhlIFRSIGVsZW1lbnQgeW91IHdhbnQgdG8gZGVsZXRlCgkJICogIEBwYXJhbSB7ZnVuY3Rpb258bnVsbH0gW2ZuQ2FsbEJhY2tdIENhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBUaGUgcm93IHRoYXQgd2FzIGRlbGV0ZWQKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSW1tZWRpYXRlbHkgcmVtb3ZlIHRoZSBmaXJzdCByb3cKCQkgKiAgICAgIG9UYWJsZS5mbkRlbGV0ZVJvdyggMCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRGVsZXRlUm93ID0gZnVuY3Rpb24oIG1UYXJnZXQsIGZuQ2FsbEJhY2ssIGJSZWRyYXcgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuLCBpQU9EYXRhSW5kZXg7CgkJCQoJCQlpQU9EYXRhSW5kZXggPSAodHlwZW9mIG1UYXJnZXQgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVRhcmdldCkgOiBtVGFyZ2V0OwoJCQkKCQkJLyogUmV0dXJuIHRoZSBkYXRhIGFycmF5IGZyb20gdGhpcyByb3cgKi8KCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmFvRGF0YS5zcGxpY2UoIGlBT0RhdGFJbmRleCwgMSApOwoJCQoJCQkvKiBVcGRhdGUgdGhlIF9EVF9Sb3dJbmRleCBwYXJhbWV0ZXIgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIuX0RUX1Jvd0luZGV4ID0gaTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSB0YXJnZXQgcm93IGZyb20gdGhlIHNlYXJjaCBhcnJheSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaUFPRGF0YUluZGV4LCBvU2V0dGluZ3MuYWlEaXNwbGF5ICk7CgkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2guc3BsaWNlKCBpRGlzcGxheUluZGV4LCAxICk7CgkJCQoJCQkvKiBEZWxldGUgZnJvbSB0aGUgZGlzcGxheSBhcnJheXMgKi8KCQkJX2ZuRGVsZXRlSW5kZXgoIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIsIGlBT0RhdGFJbmRleCApOwoJCQlfZm5EZWxldGVJbmRleCggb1NldHRpbmdzLmFpRGlzcGxheSwgaUFPRGF0YUluZGV4ICk7CgkJCQoJCQkvKiBJZiB0aGVyZSBpcyBhIHVzZXIgY2FsbGJhY2sgZnVuY3Rpb24gLSBjYWxsIGl0ICovCgkJCWlmICggdHlwZW9mIGZuQ2FsbEJhY2sgPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlmbkNhbGxCYWNrLmNhbGwoIHRoaXMsIG9TZXR0aW5ncywgb0RhdGEgKTsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgZm9yIGFuICdvdmVyZmxvdycgdGhleSBjYXNlIGZvciBkaXNwbGF5aW5nIHRoZSB0YWJsZSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA+PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IC09IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA8IDAgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCXJldHVybiBvRGF0YTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFJlc3RvcmUgdGhlIHRhYmxlIHRvIGl0J3Mgb3JpZ2luYWwgc3RhdGUgaW4gdGhlIERPTSBieSByZW1vdmluZyBhbGwgb2YgRGF0YVRhYmxlcyAKCQkgKiBlbmhhbmNlbWVudHMsIGFsdGVyYXRpb25zIHRvIHRoZSBET00gc3RydWN0dXJlIG9mIHRoZSB0YWJsZSBhbmQgZXZlbnQgbGlzdGVuZXJzLgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiUmVtb3ZlPWZhbHNlXSBDb21wbGV0ZWx5IHJlbW92ZSB0aGUgdGFibGUgZnJvbSB0aGUgRE9NCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgLy8gVGhpcyBleGFtcGxlIGlzIGZhaXJseSBwb2ludGxlc3MgaW4gcmVhbGl0eSwgYnV0IHNob3dzIGhvdyBmbkRlc3Ryb3kgY2FuIGJlIHVzZWQKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuRGVzdHJveSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRGVzdHJveSA9IGZ1bmN0aW9uICggYlJlbW92ZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIG5PcmlnID0gb1NldHRpbmdzLm5UYWJsZVdyYXBwZXIucGFyZW50Tm9kZTsKCQkJdmFyIG5Cb2R5ID0gb1NldHRpbmdzLm5UQm9keTsKCQkJdmFyIGksIGlMZW47CgkJCgkJCWJSZW1vdmUgPSAoYlJlbW92ZT09PXVuZGVmaW5lZCkgPyBmYWxzZSA6IGJSZW1vdmU7CgkJCQoJCQkvKiBGbGFnIHRvIG5vdGUgdGhhdCB0aGUgdGFibGUgaXMgY3VycmVudGx5IGJlaW5nIGRlc3Ryb3llZCAtIG5vIGFjdGlvbiBzaG91bGQgYmUgdGFrZW4gKi8KCQkJb1NldHRpbmdzLmJEZXN0cm95aW5nID0gdHJ1ZTsKCQkJCgkJCS8qIEZpcmUgb2ZmIHRoZSBkZXN0cm95IGNhbGxiYWNrcyBmb3IgcGx1Zy1pbnMgZXRjICovCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAiYW9EZXN0cm95Q2FsbGJhY2siLCAiZGVzdHJveSIsIFtvU2V0dGluZ3NdICk7CgkJCgkJCS8qIElmIHRoZSB0YWJsZSBpcyBub3QgYmVpbmcgcmVtb3ZlZCwgcmVzdG9yZSB0aGUgaGlkZGVuIGNvbHVtbnMgKi8KCQkJaWYgKCAhYlJlbW92ZSApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSBmYWxzZSApCgkJCQkJewoJCQkJCQl0aGlzLmZuU2V0Q29sdW1uVmlzKCBpLCB0cnVlICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBCbGl0eiBhbGwgRFQgZXZlbnRzICovCgkJCSQob1NldHRpbmdzLm5UYWJsZVdyYXBwZXIpLmZpbmQoJyonKS5hbmRTZWxmKCkudW5iaW5kKCcuRFQnKTsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGFuICdlbXB0eScgaW5kaWNhdG9yIHJvdywgcmVtb3ZlIGl0ICovCgkJCSQoJ3Rib2R5PnRyPnRkLicrb1NldHRpbmdzLm9DbGFzc2VzLnNSb3dFbXB0eSwgb1NldHRpbmdzLm5UYWJsZSkucGFyZW50KCkucmVtb3ZlKCk7CgkJCQoJCQkvKiBXaGVuIHNjcm9sbGluZyB3ZSBoYWQgdG8gYnJlYWsgdGhlIHRhYmxlIHVwIC0gcmVzdG9yZSBpdCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5uVGFibGUgIT0gb1NldHRpbmdzLm5USGVhZC5wYXJlbnROb2RlICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbigndGhlYWQnKS5yZW1vdmUoKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEhlYWQgKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICYmIG9TZXR0aW5ncy5uVGFibGUgIT0gb1NldHRpbmdzLm5URm9vdC5wYXJlbnROb2RlICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbigndGZvb3QnKS5yZW1vdmUoKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEZvb3QgKTsKCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSBEYXRhVGFibGVzIGdlbmVyYXRlZCBub2RlcywgZXZlbnRzIGFuZCBjbGFzc2VzICovCgkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQkkKG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyKS5yZW1vdmUoKTsKCQkJCgkJCW9TZXR0aW5ncy5hYVNvcnRpbmcgPSBbXTsKCQkJb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkID0gW107CgkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJCgkJCSQoX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICkpLnJlbW92ZUNsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmpvaW4oJyAnKSApOwoJCQkKCQkJJCgndGgsIHRkJywgb1NldHRpbmdzLm5USGVhZCkucmVtb3ZlQ2xhc3MoIFsKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlQXNjLAoJCQkJb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZURlc2MsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZSBdLmpvaW4oJyAnKQoJCQkpOwoJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJewoJCQkJJCgndGggc3Bhbi4nK29TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb24KCQkJCQkrICcsIHRkIHNwYW4uJytvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRJY29uLCBvU2V0dGluZ3MublRIZWFkKS5yZW1vdmUoKTsKCQkKCQkJCSQoJ3RoLCB0ZCcsIG9TZXR0aW5ncy5uVEhlYWQpLmVhY2goIGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIganFXcmFwcGVyID0gJCgnZGl2Licrb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJV3JhcHBlciwgdGhpcyk7CgkJCQkJdmFyIGtpZHMgPSBqcVdyYXBwZXIuY29udGVudHMoKTsKCQkJCQkkKHRoaXMpLmFwcGVuZCgga2lkcyApOwoJCQkJCWpxV3JhcHBlci5yZW1vdmUoKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWRkIHRoZSBUUiBlbGVtZW50cyBiYWNrIGludG8gdGhlIHRhYmxlIGluIHRoZWlyIG9yaWdpbmFsIG9yZGVyICovCgkJCWlmICggIWJSZW1vdmUgJiYgb1NldHRpbmdzLm5UYWJsZVJlaW5zZXJ0QmVmb3JlICkKCQkJewoJCQkJbk9yaWcuaW5zZXJ0QmVmb3JlKCBvU2V0dGluZ3MublRhYmxlLCBvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgKTsKCQkJfQoJCQllbHNlIGlmICggIWJSZW1vdmUgKQoJCQl7CgkJCQluT3JpZy5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQl9CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCW5Cb2R5LmFwcGVuZENoaWxkKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBSZXN0b3JlIHRoZSB3aWR0aCBvZiB0aGUgb3JpZ2luYWwgdGFibGUgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJBdXRvV2lkdGggPT09IHRydWUgKQoJCQl7CgkJCSAgb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKG9TZXR0aW5ncy5zRGVzdHJveVdpZHRoKTsKCQkJfQoJCQkKCQkJLyogSWYgdGhlIHdlcmUgb3JpZ2luYWxseSBzdHJpcGUgY2xhc3NlcyAtIHRoZW4gd2UgYWRkIHRoZW0gYmFjayBoZXJlLiBOb3RlCgkJCSAqIHRoaXMgaXMgbm90IGZvb2wgcHJvb2YgKGZvciBleGFtcGxlIGlmIG5vdCBhbGwgcm93cyBoYWQgc3RyaXBlIGNsYXNzZXMgLSBidXQKCQkJICogaXQncyBhIGdvb2QgZWZmb3J0IHdpdGhvdXQgZ2V0dGluZyBjYXJyaWVkIGF3YXkKCQkJICovCgkJCWlMZW4gPSBvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlcy5sZW5ndGg7CgkJCWlmIChpTGVuKQoJCQl7CgkJCQl2YXIgYW5Sb3dzID0gJChuQm9keSkuY2hpbGRyZW4oJ3RyJyk7CgkJCQlmb3IgKCBpPTAgOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFuUm93cy5maWx0ZXIoJzpudGgtY2hpbGQoJyArIGlMZW4gKyAnbiArICcgKyBpICsgJyknKS5hZGRDbGFzcyggb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbaV0gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSBzZXR0aW5ncyBvYmplY3QgZnJvbSB0aGUgc2V0dGluZ3MgYXJyYXkgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXSA9PSBvU2V0dGluZ3MgKQoJCQkJewoJCQkJCURhdGFUYWJsZS5zZXR0aW5ncy5zcGxpY2UoIGksIDEgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRW5kIGl0IGFsbCAqLwoJCQlvU2V0dGluZ3MgPSBudWxsOwoJCQlvSW5pdCA9IG51bGw7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBSZWRyYXcgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JDb21wbGV0ZT10cnVlXSBSZS1maWx0ZXIgYW5kIHJlc29ydCAoaWYgZW5hYmxlZCkgdGhlIHRhYmxlIGJlZm9yZSB0aGUgZHJhdy4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gUmUtZHJhdyB0aGUgdGFibGUgLSB5b3Ugd291bGRuJ3Qgd2FudCB0byBkbyBpdCBoZXJlLCBidXQgaXQncyBhbiBleGFtcGxlIDotKQoJCSAqICAgICAgb1RhYmxlLmZuRHJhdygpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRHJhdyA9IGZ1bmN0aW9uKCBiQ29tcGxldGUgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCWlmICggYkNvbXBsZXRlID09PSBmYWxzZSApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mblJlRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgaW5wdXQgYmFzZWQgb24gZGF0YQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IFN0cmluZyB0byBmaWx0ZXIgdGhlIHRhYmxlIG9uCgkJICogIEBwYXJhbSB7aW50fG51bGx9IFtpQ29sdW1uXSBDb2x1bW4gdG8gbGltaXQgZmlsdGVyaW5nIHRvCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWdleD1mYWxzZV0gVHJlYXQgYXMgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiU21hcnQ9dHJ1ZV0gUGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JTaG93R2xvYmFsPXRydWVdIFNob3cgdGhlIGlucHV0IGdsb2JhbCBmaWx0ZXIgaW4gaXQncyBpbnB1dCBib3goZXMpCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JDYXNlSW5zZW5zaXRpdmU9dHJ1ZV0gRG8gY2FzZS1pbnNlbnNpdGl2ZSBtYXRjaGluZyAodHJ1ZSkgb3Igbm90IChmYWxzZSkKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29tZXRpbWUgbGF0ZXIgLSBmaWx0ZXIuLi4KCQkgKiAgICAgIG9UYWJsZS5mbkZpbHRlciggJ3Rlc3Qgc3RyaW5nJyApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRmlsdGVyID0gZnVuY3Rpb24oIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJTaG93R2xvYmFsLCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQlpZiAoIGJSZWdleCA9PT0gdW5kZWZpbmVkIHx8IGJSZWdleCA9PT0gbnVsbCApCgkJCXsKCQkJCWJSZWdleCA9IGZhbHNlOwoJCQl9CgkJCQoJCQlpZiAoIGJTbWFydCA9PT0gdW5kZWZpbmVkIHx8IGJTbWFydCA9PT0gbnVsbCApCgkJCXsKCQkJCWJTbWFydCA9IHRydWU7CgkJCX0KCQkJCgkJCWlmICggYlNob3dHbG9iYWwgPT09IHVuZGVmaW5lZCB8fCBiU2hvd0dsb2JhbCA9PT0gbnVsbCApCgkJCXsKCQkJCWJTaG93R2xvYmFsID0gdHJ1ZTsKCQkJfQoJCQkKCQkJaWYgKCBiQ2FzZUluc2Vuc2l0aXZlID09PSB1bmRlZmluZWQgfHwgYkNhc2VJbnNlbnNpdGl2ZSA9PT0gbnVsbCApCgkJCXsKCQkJCWJDYXNlSW5zZW5zaXRpdmUgPSB0cnVlOwoJCQl9CgkJCQoJCQlpZiAoIGlDb2x1bW4gPT09IHVuZGVmaW5lZCB8fCBpQ29sdW1uID09PSBudWxsICkKCQkJewoJCQkJLyogR2xvYmFsIGZpbHRlciAqLwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgewoJCQkJCSJzU2VhcmNoIjpzSW5wdXQrIiIsCgkJCQkJImJSZWdleCI6IGJSZWdleCwKCQkJCQkiYlNtYXJ0IjogYlNtYXJ0LAoJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogYkNhc2VJbnNlbnNpdGl2ZQoJCQkJfSwgMSApOwoJCQkJCgkJCQlpZiAoIGJTaG93R2xvYmFsICYmIG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mICkKCQkJCXsKCQkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJCXsKCQkJCQkJLy8gSUU5IHRocm93cyBhbiAndW5rbm93biBlcnJvcicgaWYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpcyB1c2VkCgkJCQkJCS8vIGluc2lkZSBhbiBpZnJhbWUgb3IgZnJhbWUuLi4KCQkJCQkJdHJ5IHsKCQkJCQkJCWlmICggbltpXS5fRFRfSW5wdXQgIT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCApCgkJCQkJCQl7CgkJCQkJCQkJJChuW2ldLl9EVF9JbnB1dCkudmFsKCBzSW5wdXQgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljYXRjaCAoIGUgKSB7CgkJCQkJCQkkKG5baV0uX0RUX0lucHV0KS52YWwoIHNJbnB1dCApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2luZ2xlIGNvbHVtbiBmaWx0ZXIgKi8KCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sdW1uIF0sIHsKCQkJCQkic1NlYXJjaCI6IHNJbnB1dCsiIiwKCQkJCQkiYlJlZ2V4IjogYlJlZ2V4LAoJCQkJCSJiU21hcnQiOiBiU21hcnQsCgkJCQkJImJDYXNlSW5zZW5zaXRpdmUiOiBiQ2FzZUluc2Vuc2l0aXZlCgkJCQl9ICk7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgZGF0YSBmb3IgdGhlIHdob2xlIHRhYmxlLCBhbiBpbmRpdmlkdWFsIHJvdyBvciBhbiBpbmRpdmlkdWFsIGNlbGwgYmFzZWQgb24gdGhlIAoJCSAqIHByb3ZpZGVkIHBhcmFtZXRlcnMuCgkJICogIEBwYXJhbSB7aW50fG5vZGV9IFttUm93XSBBIFRSIHJvdyBub2RlLCBURC9USCBjZWxsIG5vZGUgb3IgYW4gaW50ZWdlci4gSWYgZ2l2ZW4gYXMKCQkgKiAgICBhIFRSIG5vZGUgdGhlbiB0aGUgZGF0YSBzb3VyY2UgZm9yIHRoZSB3aG9sZSByb3cgd2lsbCBiZSByZXR1cm5lZC4gSWYgZ2l2ZW4gYXMgYQoJCSAqICAgIFREL1RIIGNlbGwgbm9kZSB0aGVuIGlDb2wgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQgYW5kIHRoZSBkYXRhIGZvciB0aGUKCQkgKiAgICBjZWxsIHJldHVybmVkLiBJZiBnaXZlbiBhcyBhbiBpbnRlZ2VyLCB0aGVuIHRoaXMgaXMgdHJlYXRlZCBhcyB0aGUgYW9EYXRhIGludGVybmFsCgkJICogICAgZGF0YSBpbmRleCBmb3IgdGhlIHJvdyAoc2VlIGZuR2V0UG9zaXRpb24pIGFuZCB0aGUgZGF0YSBmb3IgdGhhdCByb3cgdXNlZC4KCQkgKiAgQHBhcmFtIHtpbnR9IFtpQ29sXSBPcHRpb25hbCBjb2x1bW4gaW5kZXggdGhhdCB5b3Ugd2FudCB0aGUgZGF0YSBvZi4KCQkgKiAgQHJldHVybnMge2FycmF5fG9iamVjdHxzdHJpbmd9IElmIG1Sb3cgaXMgdW5kZWZpbmVkLCB0aGVuIHRoZSBkYXRhIGZvciBhbGwgcm93cyBpcwoJCSAqICAgIHJldHVybmVkLiBJZiBtUm93IGlzIGRlZmluZWQsIGp1c3QgZGF0YSBmb3IgdGhhdCByb3csIGFuZCBpcyBpQ29sIGlzCgkJICogICAgZGVmaW5lZCwgb25seSBkYXRhIGZvciB0aGUgZGVzaWduYXRlZCBjZWxsIGlzIHJldHVybmVkLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSb3cgZGF0YQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgb1RhYmxlLiQoJ3RyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgdmFyIGRhdGEgPSBvVGFibGUuZm5HZXREYXRhKCB0aGlzICk7CgkJICogICAgICAgIC8vIC4uLiBkbyBzb21ldGhpbmcgd2l0aCB0aGUgYXJyYXkgLyBvYmplY3Qgb2YgZGF0YSBmb3IgdGhlIHJvdwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEluZGl2aWR1YWwgY2VsbCBkYXRhCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICBvVGFibGUuJCgndGQnKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICB2YXIgc0RhdGEgPSBvVGFibGUuZm5HZXREYXRhKCB0aGlzICk7CgkJICogICAgICAgIGFsZXJ0KCAnVGhlIGNlbGwgY2xpY2tlZCBvbiBoYWQgdGhlIHZhbHVlIG9mICcrc0RhdGEgKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkdldERhdGEgPSBmdW5jdGlvbiggbVJvdywgaUNvbCApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggbVJvdyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJdmFyIGlSb3cgPSBtUm93OwoJCQkJaWYgKCB0eXBlb2YgbVJvdyA9PT0gJ29iamVjdCcgKQoJCQkJewoJCQkJCXZhciBzTm9kZSA9IG1Sb3cubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJCQlpZiAoc05vZGUgPT09ICJ0ciIgKQoJCQkJCXsKCQkJCQkJaVJvdyA9IF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1Sb3cpOwoJCQkJCX0KCQkJCQllbHNlIGlmICggc05vZGUgPT09ICJ0ZCIgKQoJCQkJCXsKCQkJCQkJaVJvdyA9IF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1Sb3cucGFyZW50Tm9kZSk7CgkJCQkJCWlDb2wgPSBfZm5Ob2RlVG9Db2x1bW5JbmRleCggb1NldHRpbmdzLCBpUm93LCBtUm93ICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJaWYgKCBpQ29sICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCXJldHVybiBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCAnJyApOwoJCQkJfQoJCQkJcmV0dXJuIChvU2V0dGluZ3MuYW9EYXRhW2lSb3ddIT09dW5kZWZpbmVkKSA/CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgOiBudWxsOwoJCQl9CgkJCXJldHVybiBfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiB0aGUgVFIgbm9kZXMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUncyBib2R5LiBOb3RlIHRoYXQgeW91IHdpbGwgCgkJICogdHlwaWNhbGx5IHdhbnQgdG8gdXNlIHRoZSAnJCcgQVBJIG1ldGhvZCBpbiBwcmVmZXJlbmNlIHRvIHRoaXMgYXMgaXQgaXMgbW9yZSAKCQkgKiBmbGV4aWJsZS4KCQkgKiAgQHBhcmFtIHtpbnR9IFtpUm93XSBPcHRpb25hbCByb3cgaW5kZXggZm9yIHRoZSBUUiBlbGVtZW50IHlvdSB3YW50CgkJICogIEByZXR1cm5zIHthcnJheXxub2RlfSBJZiBpUm93IGlzIHVuZGVmaW5lZCwgcmV0dXJucyBhbiBhcnJheSBvZiBhbGwgVFIgZWxlbWVudHMKCQkgKiAgICBpbiB0aGUgdGFibGUncyBib2R5LCBvciBpUm93IGlzIGRlZmluZWQsIGp1c3QgdGhlIFRSIGVsZW1lbnQgcmVxdWVzdGVkLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBHZXQgdGhlIG5vZGVzIGZyb20gdGhlIHRhYmxlCgkJICogICAgICB2YXIgbk5vZGVzID0gb1RhYmxlLmZuR2V0Tm9kZXMoICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXROb2RlcyA9IGZ1bmN0aW9uKCBpUm93ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJaWYgKCBpUm93ICE9PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gKG9TZXR0aW5ncy5hb0RhdGFbaVJvd10hPT11bmRlZmluZWQpID8KCQkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLm5UciA6IG51bGw7CgkJCX0KCQkJcmV0dXJuIF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBhcnJheSBpbmRleGVzIG9mIGEgcGFydGljdWxhciBjZWxsIGZyb20gaXQncyBET00gZWxlbWVudAoJCSAqIGFuZCBjb2x1bW4gaW5kZXggaW5jbHVkaW5nIGhpZGRlbiBjb2x1bW5zCgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgdGhpcyBjYW4gZWl0aGVyIGJlIGEgVFIsIFREIG9yIFRIIGluIHRoZSB0YWJsZSdzIGJvZHkKCQkgKiAgQHJldHVybnMge2ludH0gSWYgbk5vZGUgaXMgZ2l2ZW4gYXMgYSBUUiwgdGhlbiBhIHNpbmdsZSBpbmRleCBpcyByZXR1cm5lZCwgb3IKCQkgKiAgICBpZiBnaXZlbiBhcyBhIGNlbGwsIGFuIGFycmF5IG9mIFtyb3cgaW5kZXgsIGNvbHVtbiBpbmRleCAodmlzaWJsZSksIAoJCSAqICAgIGNvbHVtbiBpbmRleCAoYWxsKV0gaXMgZ2l2ZW4uCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdGQnKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICAvLyBHZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBjdXJyZW50IGRhdGEgZnJvbSB0aGUgbm9kZQoJCSAqICAgICAgICB2YXIgYVBvcyA9IG9UYWJsZS5mbkdldFBvc2l0aW9uKCB0aGlzICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBHZXQgdGhlIGRhdGEgYXJyYXkgZm9yIHRoaXMgcm93CgkJICogICAgICAgIHZhciBhRGF0YSA9IG9UYWJsZS5mbkdldERhdGEoIGFQb3NbMF0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIFVwZGF0ZSB0aGUgZGF0YSBhcnJheSBhbmQgcmV0dXJuIHRoZSB2YWx1ZQoJCSAqICAgICAgICBhRGF0YVsgYVBvc1sxXSBdID0gJ2NsaWNrZWQnOwoJCSAqICAgICAgICB0aGlzLmlubmVySFRNTCA9ICdjbGlja2VkJzsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSW5pdCBEYXRhVGFibGVzCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuR2V0UG9zaXRpb24gPSBmdW5jdGlvbiggbk5vZGUgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBzTm9kZU5hbWUgPSBuTm9kZS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpOwoJCQkKCQkJaWYgKCBzTm9kZU5hbWUgPT0gIlRSIiApCgkJCXsKCQkJCXJldHVybiBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBuTm9kZSk7CgkJCX0KCQkJZWxzZSBpZiAoIHNOb2RlTmFtZSA9PSAiVEQiIHx8IHNOb2RlTmFtZSA9PSAiVEgiICkKCQkJewoJCQkJdmFyIGlEYXRhSW5kZXggPSBfZm5Ob2RlVG9EYXRhSW5kZXgoIG9TZXR0aW5ncywgbk5vZGUucGFyZW50Tm9kZSApOwoJCQkJdmFyIGlDb2x1bW5JbmRleCA9IF9mbk5vZGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlEYXRhSW5kZXgsIG5Ob2RlICk7CgkJCQlyZXR1cm4gWyBpRGF0YUluZGV4LCBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZShvU2V0dGluZ3MsIGlDb2x1bW5JbmRleCApLCBpQ29sdW1uSW5kZXggXTsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIENoZWNrIHRvIHNlZSBpZiBhIHJvdyBpcyAnb3Blbicgb3Igbm90LgoJCSAqICBAcGFyYW0ge25vZGV9IG5UciB0aGUgdGFibGUgcm93IHRvIGNoZWNrCgkJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoZSByb3cgaXMgY3VycmVudGx5IG9wZW4sIGZhbHNlIG90aGVyd2lzZQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGU7CgkJICogICAgICAKCQkgKiAgICAgIC8vICdvcGVuJyBhbiBpbmZvcm1hdGlvbiByb3cgd2hlbiBhIHJvdyBpcyBjbGlja2VkIG9uCgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGlmICggb1RhYmxlLmZuSXNPcGVuKHRoaXMpICkgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbkNsb3NlKCB0aGlzICk7CgkJICogICAgICAgIH0gZWxzZSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuT3BlbiggdGhpcywgIlRlbXBvcmFyeSByb3cgb3BlbmVkIiwgImluZm9fcm93IiApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5Jc09wZW4gPSBmdW5jdGlvbiggblRyICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgYW9PcGVuUm93cyA9IG9TZXR0aW5ncy5hb09wZW5Sb3dzOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uUGFyZW50ID09IG5UciApCgkJCQl7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIGZhbHNlOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiB3aWxsIHBsYWNlIGEgbmV3IHJvdyBkaXJlY3RseSBhZnRlciBhIHJvdyB3aGljaCBpcyBjdXJyZW50bHkgCgkJICogb24gZGlzcGxheSBvbiB0aGUgcGFnZSwgd2l0aCB0aGUgSFRNTCBjb250ZW50cyB0aGF0IGlzIHBhc3NlZCBpbnRvIHRoZSAKCQkgKiBmdW5jdGlvbi4gVGhpcyBjYW4gYmUgdXNlZCwgZm9yIGV4YW1wbGUsIHRvIGFzayBmb3IgY29uZmlybWF0aW9uIHRoYXQgYSAKCQkgKiBwYXJ0aWN1bGFyIHJlY29yZCBzaG91bGQgYmUgZGVsZXRlZC4KCQkgKiAgQHBhcmFtIHtub2RlfSBuVHIgVGhlIHRhYmxlIHJvdyB0byAnb3BlbicKCQkgKiAgQHBhcmFtIHtzdHJpbmd8bm9kZXxqUXVlcnl9IG1IdG1sIFRoZSBIVE1MIHRvIHB1dCBpbnRvIHRoZSByb3cKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNDbGFzcyBDbGFzcyB0byBnaXZlIHRoZSBuZXcgVEQgY2VsbAoJCSAqICBAcmV0dXJucyB7bm9kZX0gVGhlIHJvdyBvcGVuZWQuIE5vdGUgdGhhdCBpZiB0aGUgdGFibGUgcm93IHBhc3NlZCBpbiBhcyB0aGUKCQkgKiAgICBmaXJzdCBwYXJhbWV0ZXIsIGlzIG5vdCBmb3VuZCBpbiB0aGUgdGFibGUsIHRoaXMgbWV0aG9kIHdpbGwgc2lsZW50bHkKCQkgKiAgICByZXR1cm4uCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbk9wZW4gPSBmdW5jdGlvbiggblRyLCBtSHRtbCwgc0NsYXNzICkKCQl7CgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQoJCQkvKiBDaGVjayB0aGF0IHRoZSByb3cgZ2l2ZW4gaXMgaW4gdGhlIHRhYmxlICovCgkJCXZhciBuVGFibGVSb3dzID0gX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICk7CgkJCWlmICggJC5pbkFycmF5KG5UciwgblRhYmxlUm93cykgPT09IC0xICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiB0aGUgb2xkIG9wZW4gb25lIGlmIHRoZXJlIGlzIG9uZSAqLwoJCQl0aGlzLmZuQ2xvc2UoIG5UciApOwoJCQkKCQkJdmFyIG5OZXdSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ciIpOwoJCQl2YXIgbk5ld0NlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOwoJCQluTmV3Um93LmFwcGVuZENoaWxkKCBuTmV3Q2VsbCApOwoJCQluTmV3Q2VsbC5jbGFzc05hbWUgPSBzQ2xhc3M7CgkJCW5OZXdDZWxsLmNvbFNwYW4gPSBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKTsKCQkKCQkJaWYgKHR5cGVvZiBtSHRtbCA9PT0gInN0cmluZyIpCgkJCXsKCQkJCW5OZXdDZWxsLmlubmVySFRNTCA9IG1IdG1sOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJJChuTmV3Q2VsbCkuaHRtbCggbUh0bWwgKTsKCQkJfQoJCQoJCQkvKiBJZiB0aGUgblRyIGlzbid0IG9uIHRoZSBwYWdlIGF0IHRoZSBtb21lbnQgLSB0aGVuIHdlIGRvbid0IGluc2VydCBhdCB0aGUgbW9tZW50ICovCgkJCXZhciBuVHJzID0gJCgndHInLCBvU2V0dGluZ3MublRCb2R5KTsKCQkJaWYgKCAkLmluQXJyYXkoblRyLCBuVHJzKSAhPSAtMSAgKQoJCQl7CgkJCQkkKG5OZXdSb3cpLmluc2VydEFmdGVyKG5Ucik7CgkJCX0KCQkJCgkJCW9TZXR0aW5ncy5hb09wZW5Sb3dzLnB1c2goIHsKCQkJCSJuVHIiOiBuTmV3Um93LAoJCQkJIm5QYXJlbnQiOiBuVHIKCQkJfSApOwoJCQkKCQkJcmV0dXJuIG5OZXdSb3c7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIHBhZ2luYXRpb24gLSBwcm92aWRlcyB0aGUgaW50ZXJuYWwgbG9naWMgZm9yIHBhZ2luYXRpb24gaW4gYSBzaW1wbGUgQVBJIAoJCSAqIGZ1bmN0aW9uLiBXaXRoIHRoaXMgZnVuY3Rpb24geW91IGNhbiBoYXZlIGEgRGF0YVRhYmxlcyB0YWJsZSBnbyB0byB0aGUgbmV4dCwgCgkJICogcHJldmlvdXMsIGZpcnN0IG9yIGxhc3QgcGFnZXMuCgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKSwgbm90ZSB0aGF0IHBhZ2UgMCBpcyB0aGUgZmlyc3QgcGFnZS4KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuUGFnZUNoYW5nZSggJ25leHQnICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5QYWdlQ2hhbmdlID0gZnVuY3Rpb24gKCBtQWN0aW9uLCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlfZm5QYWdlQ2hhbmdlKCBvU2V0dGluZ3MsIG1BY3Rpb24gKTsKCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX07CgkJCgkJCgkJLyoqCgkJICogU2hvdyBhIHBhcnRpY3VsYXIgY29sdW1uCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIFRoZSBjb2x1bW4gd2hvc2UgZGlzcGxheSBzaG91bGQgYmUgY2hhbmdlZAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTaG93IFNob3cgKHRydWUpIG9yIGhpZGUgKGZhbHNlKSB0aGUgY29sdW1uCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSGlkZSB0aGUgc2Vjb25kIGNvbHVtbiBhZnRlciBpbml0aWFsaXNhdGlvbgoJCSAqICAgICAgb1RhYmxlLmZuU2V0Q29sdW1uVmlzKCAxLCBmYWxzZSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU2V0Q29sdW1uVmlzID0gZnVuY3Rpb24gKCBpQ29sLCBiU2hvdywgYlJlZHJhdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGksIGlMZW47CgkJCXZhciBhb0NvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zOwoJCQl2YXIgYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YTsKCQkJdmFyIG5UZCwgYkFwcGVuZCwgaUJlZm9yZTsKCQkJCgkJCS8qIE5vIHBvaW50IGluIGRvaW5nIGFueXRoaW5nIGlmIHdlIGFyZSByZXF1ZXN0aW5nIHdoYXQgaXMgYWxyZWFkeSB0cnVlICovCgkJCWlmICggYW9Db2x1bW5zW2lDb2xdLmJWaXNpYmxlID09IGJTaG93ICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBTaG93IHRoZSBjb2x1bW4gKi8KCQkJaWYgKCBiU2hvdyApCgkJCXsKCQkJCXZhciBpSW5zZXJ0ID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8aUNvbCA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJaUluc2VydCsrOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogTmVlZCB0byBkZWNpZGUgaWYgd2Ugc2hvdWxkIHVzZSBhcHBlbmRDaGlsZCBvciBpbnNlcnRCZWZvcmUgKi8KCQkJCWJBcHBlbmQgPSAoaUluc2VydCA+PSBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKSk7CgkJCgkJCQkvKiBXaGljaCBjb2xvdW1uIHNob3VsZCB3ZSBiZSBpbnNlcnRpbmcgYmVmb3JlPyAqLwoJCQkJaWYgKCAhYkFwcGVuZCApCgkJCQl7CgkJCQkJZm9yICggaT1pQ29sIDsgaTxhb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJaUJlZm9yZSA9IGk7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkKCQkJCWZvciAoIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJaWYgKCBiQXBwZW5kICkKCQkJCQkJewoJCQkJCQkJYW9EYXRhW2ldLm5Uci5hcHBlbmRDaGlsZCggCgkJCQkJCQkJYW9EYXRhW2ldLl9hbkhpZGRlbltpQ29sXQoJCQkJCQkJKTsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCWFvRGF0YVtpXS5uVHIuaW5zZXJ0QmVmb3JlKAoJCQkJCQkJCWFvRGF0YVtpXS5fYW5IaWRkZW5baUNvbF0sIAoJCQkJCQkJCV9mbkdldFRkTm9kZXMoIG9TZXR0aW5ncywgaSApW2lCZWZvcmVdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBSZW1vdmUgYSBjb2x1bW4gZnJvbSBkaXNwbGF5ICovCgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW5UZCA9IF9mbkdldFRkTm9kZXMoIG9TZXR0aW5ncywgaSApW2lDb2xdOwoJCQkJCQlhb0RhdGFbaV0uX2FuSGlkZGVuW2lDb2xdID0gblRkOwoJCQkJCQluVGQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggblRkICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8qIENsZWFyIHRvIHNldCB0aGUgdmlzaWJsZSBmbGFnICovCgkJCWFvQ29sdW1uc1tpQ29sXS5iVmlzaWJsZSA9IGJTaG93OwoJCQoJCQkvKiBSZWRyYXcgdGhlIGhlYWRlciBhbmQgZm9vdGVyIGJhc2VkIG9uIHRoZSBuZXcgY29sdW1uIHZpc2liaWxpdHkgKi8KCQkJX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvSGVhZGVyICk7CgkJCWlmICggb1NldHRpbmdzLm5URm9vdCApCgkJCXsKCQkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0Zvb3RlciApOwoJCQl9CgkJCQoJCQkvKiBJZiB0aGVyZSBhcmUgYW55ICdvcGVuJyByb3dzLCB0aGVuIHdlIG5lZWQgdG8gYWx0ZXIgdGhlIGNvbHNwYW4gZm9yIHRoaXMgY29sIGNoYW5nZSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublRyLmNvbFNwYW4gPSBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogRG8gYSByZWRyYXcgaW5jYXNlIGFueXRoaW5nIGRlcGVuZGluZyBvbiB0aGUgdGFibGUgY29sdW1ucyBuZWVkcyBpdCAKCQkJICogKGJ1aWx0LWluOiBzY3JvbGxpbmcpIAoJCQkgKi8KCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkFkanVzdENvbHVtblNpemluZyggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJX2ZuU2F2ZVN0YXRlKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgc2V0dGluZ3MgZm9yIGEgcGFydGljdWxhciB0YWJsZSBmb3IgZXh0ZXJuYWwgbWFuaXB1bGF0aW9uCgkJICogIEByZXR1cm5zIHtvYmplY3R9IERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0LiBTZWUgCgkJICogICAge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgdmFyIG9TZXR0aW5ncyA9IG9UYWJsZS5mblNldHRpbmdzKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFNob3cgYW4gZXhhbXBsZSBwYXJhbWV0ZXIgZnJvbSB0aGUgc2V0dGluZ3MKCQkgKiAgICAgIGFsZXJ0KCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblNldHRpbmdzID0gZnVuY3Rpb24oKQoJCXsKCQkJcmV0dXJuIF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBTb3J0IHRoZSB0YWJsZSBieSBhIHBhcnRpY3VsYXIgY29sdW1uCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIHRoZSBkYXRhIGluZGV4IHRvIHNvcnQgb24uIE5vdGUgdGhhdCB0aGlzIHdpbGwgbm90IG1hdGNoIHRoZSAKCQkgKiAgICAnZGlzcGxheSBpbmRleCcgaWYgeW91IGhhdmUgaGlkZGVuIGRhdGEgZW50cmllcwoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb3J0IGltbWVkaWF0ZWx5IHdpdGggY29sdW1ucyAwIGFuZCAxCgkJICogICAgICBvVGFibGUuZm5Tb3J0KCBbIFswLCdhc2MnXSwgWzEsJ2FzYyddIF0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblNvcnQgPSBmdW5jdGlvbiggYWFTb3J0ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nID0gYWFTb3J0OwoJCQlfZm5Tb3J0KCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEF0dGFjaCBhIHNvcnQgbGlzdGVuZXIgdG8gYW4gZWxlbWVudCBmb3IgYSBnaXZlbiBjb2x1bW4KCQkgKiAgQHBhcmFtIHtub2RlfSBuTm9kZSB0aGUgZWxlbWVudCB0byBhdHRhY2ggdGhlIHNvcnQgbGlzdGVuZXIgdG8KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2x1bW4gdGhlIGNvbHVtbiB0aGF0IGEgY2xpY2sgb24gdGhpcyBub2RlIHdpbGwgc29ydCBvbgoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBbZm5DYWxsYmFja10gY2FsbGJhY2sgZnVuY3Rpb24gd2hlbiBzb3J0IGlzIHJ1bgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb3J0IG9uIGNvbHVtbiAxLCB3aGVuICdzb3J0ZXInIGlzIGNsaWNrZWQgb24KCQkgKiAgICAgIG9UYWJsZS5mblNvcnRMaXN0ZW5lciggZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvcnRlcicpLCAxICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5Tb3J0TGlzdGVuZXIgPSBmdW5jdGlvbiggbk5vZGUsIGlDb2x1bW4sIGZuQ2FsbGJhY2sgKQoJCXsKCQkJX2ZuU29ydEF0dGFjaExpc3RlbmVyKCBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApLCBuTm9kZSwgaUNvbHVtbiwKCQkJIAlmbkNhbGxiYWNrICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgYSB0YWJsZSBjZWxsIG9yIHJvdyAtIHRoaXMgbWV0aG9kIHdpbGwgYWNjZXB0IGVpdGhlciBhIHNpbmdsZSB2YWx1ZSB0bwoJCSAqIHVwZGF0ZSB0aGUgY2VsbCB3aXRoLCBhbiBhcnJheSBvZiB2YWx1ZXMgd2l0aCBvbmUgZWxlbWVudCBmb3IgZWFjaCBjb2x1bW4gb3IKCQkgKiBhbiBvYmplY3QgaW4gdGhlIHNhbWUgZm9ybWF0IGFzIHRoZSBvcmlnaW5hbCBkYXRhIHNvdXJjZS4gVGhlIGZ1bmN0aW9uIGlzCgkJICogc2VsZi1yZWZlcmVuY2luZyBpbiBvcmRlciB0byBtYWtlIHRoZSBtdWx0aSBjb2x1bW4gdXBkYXRlcyBlYXNpZXIuCgkJICogIEBwYXJhbSB7b2JqZWN0fGFycmF5fHN0cmluZ30gbURhdGEgRGF0YSB0byB1cGRhdGUgdGhlIGNlbGwvcm93IHdpdGgKCQkgKiAgQHBhcmFtIHtub2RlfGludH0gbVJvdyBUUiBlbGVtZW50IHlvdSB3YW50IHRvIHVwZGF0ZSBvciB0aGUgYW9EYXRhIGluZGV4CgkJICogIEBwYXJhbSB7aW50fSBbaUNvbHVtbl0gVGhlIGNvbHVtbiB0byB1cGRhdGUgKG5vdCB1c2VkIG9mIG1EYXRhIGlzIGFuIGFycmF5IG9yIG9iamVjdCkKCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiQWN0aW9uPXRydWVdIFBlcmZvcm0gcHJlLWRyYXcgYWN0aW9ucyBvciBub3QKCQkgKiAgQHJldHVybnMge2ludH0gMCBvbiBzdWNjZXNzLCAxIG9uIGVycm9yCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5VcGRhdGUoICdFeGFtcGxlIHVwZGF0ZScsIDAsIDAgKTsgLy8gU2luZ2xlIGNlbGwKCQkgKiAgICAgIG9UYWJsZS5mblVwZGF0ZSggWydhJywgJ2InLCAnYycsICdkJywgJ2UnXSwgMSwgMCApOyAvLyBSb3cKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblVwZGF0ZSA9IGZ1bmN0aW9uKCBtRGF0YSwgbVJvdywgaUNvbHVtbiwgYlJlZHJhdywgYkFjdGlvbiApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGksIGlMZW4sIHNEaXNwbGF5OwoJCQl2YXIgaVJvdyA9ICh0eXBlb2YgbVJvdyA9PT0gJ29iamVjdCcpID8gCgkJCQlfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93KSA6IG1Sb3c7CgkJCQoJCQlpZiAoICQuaXNBcnJheShtRGF0YSkgJiYgaUNvbHVtbiA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJLyogQXJyYXkgdXBkYXRlIC0gdXBkYXRlIHRoZSB3aG9sZSByb3cgKi8KCQkJCW9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhID0gbURhdGEuc2xpY2UoKTsKCQkJCQoJCQkJLyogRmxhZyB0byB0aGUgZnVuY3Rpb24gdGhhdCB3ZSBhcmUgcmVjdXJzaW5nICovCgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCAkLmlzUGxhaW5PYmplY3QobURhdGEpICYmIGlDb2x1bW4gPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIE9iamVjdCB1cGRhdGUgLSB1cGRhdGUgdGhlIHdob2xlIHJvdyAtIGFzc3VtZSB0aGUgZGV2ZWxvcGVyIGdldHMgdGhlIG9iamVjdCByaWdodCAqLwoJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgPSAkLmV4dGVuZCggdHJ1ZSwge30sIG1EYXRhICk7CgkJCgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogSW5kaXZpZHVhbCBjZWxsIHVwZGF0ZSAqLwoJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgbURhdGEgKTsKCQkJCXNEaXNwbGF5ID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkJCWlmICggb0NvbC5mblJlbmRlciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJc0Rpc3BsYXkgPSBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiApOwoJCQkJCWlmICggb0NvbC5iVXNlUmVuZGVyZWQgKQoJCQkJCXsKCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgc0Rpc3BsYXkgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCS8qIERvIHRoZSBhY3R1YWwgSFRNTCB1cGRhdGUgKi8KCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKVtpQ29sdW1uXS5pbm5lckhUTUwgPSBzRGlzcGxheTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogTW9kaWZ5IHRoZSBzZWFyY2ggaW5kZXggZm9yIHRoaXMgcm93IChzdHJpY3RseSB0aGlzIGlzIGxpa2VseSBub3QgbmVlZGVkLCBzaW5jZSBmblJlRHJhdwoJCQkgKiB3aWxsIHJlYnVpbGQgdGhlIHNlYXJjaCBhcnJheSAtIGhvd2V2ZXIsIHRoZSByZWRyYXcgbWlnaHQgYmUgZGlzYWJsZWQgYnkgdGhlIHVzZXIpCgkJCSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaVJvdywgb1NldHRpbmdzLmFpRGlzcGxheSApOwoJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2lEaXNwbGF5SW5kZXhdID0gX2ZuQnVpbGRTZWFyY2hSb3coCgkJCQlvU2V0dGluZ3MsIAoJCQkJX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpUm93LCAnZmlsdGVyJywgX2ZuR2V0Q29sdW1ucyggb1NldHRpbmdzLCAnYlNlYXJjaGFibGUnICkgKQoJCQkpOwoJCQkKCQkJLyogUGVyZm9ybSBwcmUtZHJhdyBhY3Rpb25zICovCgkJCWlmICggYkFjdGlvbiA9PT0gdW5kZWZpbmVkIHx8IGJBY3Rpb24gKQoJCQl7CgkJCQlfZm5BZGp1c3RDb2x1bW5TaXppbmcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBSZWRyYXcgdGhlIHRhYmxlICovCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5SZURyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCXJldHVybiAwOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUHJvdmlkZSBhIGNvbW1vbiBtZXRob2QgZm9yIHBsdWctaW5zIHRvIGNoZWNrIHRoZSB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgYmVpbmcgdXNlZCwgaW4gb3JkZXIKCQkgKiB0byBlbnN1cmUgY29tcGF0aWJpbGl0eS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWZXJzaW9uIFZlcnNpb24gc3RyaW5nIHRvIGNoZWNrIGZvciwgaW4gdGhlIGZvcm1hdCAiWC5ZLloiLiBOb3RlIHRoYXQgdGhlCgkJICogICAgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIHJlcXVpcmVkCgkJICogICAgdmVyc2lvbiwgb3IgZmFsc2UgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWxlcyBpcyBub3Qgc3VpdGFibGUKCQkgKiAgQG1ldGhvZAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgYWxlcnQoIG9UYWJsZS5mblZlcnNpb25DaGVjayggJzEuOS4wJyApICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5WZXJzaW9uQ2hlY2sgPSBEYXRhVGFibGUuZXh0LmZuVmVyc2lvbkNoZWNrOwoJCQoJCQoJCS8qCgkJICogVGhpcyBpcyByZWFsbHkgYSBnb29kIGJpdCBydWJiaXNoIHRoaXMgbWV0aG9kIG9mIGV4cG9zaW5nIHRoZSBpbnRlcm5hbCBtZXRob2RzCgkJICogcHVibGljbHkuLi4gLSBUbyBiZSBmaXhlZCBpbiAyLjAgdXNpbmcgbWV0aG9kcyBvbiB0aGUgcHJvdG90eXBlCgkJICovCgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGEgd3JhcHBlciBmdW5jdGlvbiBmb3IgZXhwb3J0aW5nIGFuIGludGVybmFsIGZ1bmN0aW9ucyB0byBhbiBleHRlcm5hbCBBUEkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRnVuYyBBUEkgZnVuY3Rpb24gbmFtZQoJCSAqICBAcmV0dXJucyB7ZnVuY3Rpb259IHdyYXBwZWQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRXh0ZXJuQXBpRnVuYyAoc0Z1bmMpCgkJewoJCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCQl2YXIgYUFyZ3MgPSBbX2ZuU2V0dGluZ3NGcm9tTm9kZSh0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSldLmNvbmNhdCggCgkJCQkJQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSApOwoJCQkJcmV0dXJuIERhdGFUYWJsZS5leHQub0FwaVtzRnVuY10uYXBwbHkoIHRoaXMsIGFBcmdzICk7CgkJCX07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlZmVyZW5jZSB0byBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIHVzZSBieSBwbHVnLWluIGRldmVsb3BlcnMuIE5vdGUgdGhhdCB0aGVzZQoJCSAqIG1ldGhvZHMgYXJlIHJlZmVyZW5jZXMgdG8gaW50ZXJuYWwgZnVuY3Rpb25zIGFuZCBhcmUgY29uc2lkZXJlZCB0byBiZSBwcml2YXRlLgoJCSAqIElmIHlvdSB1c2UgdGhlc2UgbWV0aG9kcywgYmUgYXdhcmUgdGhhdCB0aGV5IGFyZSBsaWFibGUgdG8gY2hhbmdlIGJldHdlZW4gdmVyc2lvbnMKCQkgKiAoY2hlY2sgdGhlIHVwZ3JhZGUgbm90ZXMpLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJdGhpcy5vQXBpID0gewoJCQkiX2ZuRXh0ZXJuQXBpRnVuYyI6IF9mbkV4dGVybkFwaUZ1bmMsCgkJCSJfZm5Jbml0aWFsaXNlIjogX2ZuSW5pdGlhbGlzZSwKCQkJIl9mbkluaXRDb21wbGV0ZSI6IF9mbkluaXRDb21wbGV0ZSwKCQkJIl9mbkxhbmd1YWdlQ29tcGF0IjogX2ZuTGFuZ3VhZ2VDb21wYXQsCgkJCSJfZm5BZGRDb2x1bW4iOiBfZm5BZGRDb2x1bW4sCgkJCSJfZm5Db2x1bW5PcHRpb25zIjogX2ZuQ29sdW1uT3B0aW9ucywKCQkJIl9mbkFkZERhdGEiOiBfZm5BZGREYXRhLAoJCQkiX2ZuQ3JlYXRlVHIiOiBfZm5DcmVhdGVUciwKCQkJIl9mbkdhdGhlckRhdGEiOiBfZm5HYXRoZXJEYXRhLAoJCQkiX2ZuQnVpbGRIZWFkIjogX2ZuQnVpbGRIZWFkLAoJCQkiX2ZuRHJhd0hlYWQiOiBfZm5EcmF3SGVhZCwKCQkJIl9mbkRyYXciOiBfZm5EcmF3LAoJCQkiX2ZuUmVEcmF3IjogX2ZuUmVEcmF3LAoJCQkiX2ZuQWpheFVwZGF0ZSI6IF9mbkFqYXhVcGRhdGUsCgkJCSJfZm5BamF4UGFyYW1ldGVycyI6IF9mbkFqYXhQYXJhbWV0ZXJzLAoJCQkiX2ZuQWpheFVwZGF0ZURyYXciOiBfZm5BamF4VXBkYXRlRHJhdywKCQkJIl9mblNlcnZlclBhcmFtcyI6IF9mblNlcnZlclBhcmFtcywKCQkJIl9mbkFkZE9wdGlvbnNIdG1sIjogX2ZuQWRkT3B0aW9uc0h0bWwsCgkJCSJfZm5GZWF0dXJlSHRtbFRhYmxlIjogX2ZuRmVhdHVyZUh0bWxUYWJsZSwKCQkJIl9mblNjcm9sbERyYXciOiBfZm5TY3JvbGxEcmF3LAoJCQkiX2ZuQWRqdXN0Q29sdW1uU2l6aW5nIjogX2ZuQWRqdXN0Q29sdW1uU2l6aW5nLAoJCQkiX2ZuRmVhdHVyZUh0bWxGaWx0ZXIiOiBfZm5GZWF0dXJlSHRtbEZpbHRlciwKCQkJIl9mbkZpbHRlckNvbXBsZXRlIjogX2ZuRmlsdGVyQ29tcGxldGUsCgkJCSJfZm5GaWx0ZXJDdXN0b20iOiBfZm5GaWx0ZXJDdXN0b20sCgkJCSJfZm5GaWx0ZXJDb2x1bW4iOiBfZm5GaWx0ZXJDb2x1bW4sCgkJCSJfZm5GaWx0ZXIiOiBfZm5GaWx0ZXIsCgkJCSJfZm5CdWlsZFNlYXJjaEFycmF5IjogX2ZuQnVpbGRTZWFyY2hBcnJheSwKCQkJIl9mbkJ1aWxkU2VhcmNoUm93IjogX2ZuQnVpbGRTZWFyY2hSb3csCgkJCSJfZm5GaWx0ZXJDcmVhdGVTZWFyY2giOiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2gsCgkJCSJfZm5EYXRhVG9TZWFyY2giOiBfZm5EYXRhVG9TZWFyY2gsCgkJCSJfZm5Tb3J0IjogX2ZuU29ydCwKCQkJIl9mblNvcnRBdHRhY2hMaXN0ZW5lciI6IF9mblNvcnRBdHRhY2hMaXN0ZW5lciwKCQkJIl9mblNvcnRpbmdDbGFzc2VzIjogX2ZuU29ydGluZ0NsYXNzZXMsCgkJCSJfZm5GZWF0dXJlSHRtbFBhZ2luYXRlIjogX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSwKCQkJIl9mblBhZ2VDaGFuZ2UiOiBfZm5QYWdlQ2hhbmdlLAoJCQkiX2ZuRmVhdHVyZUh0bWxJbmZvIjogX2ZuRmVhdHVyZUh0bWxJbmZvLAoJCQkiX2ZuVXBkYXRlSW5mbyI6IF9mblVwZGF0ZUluZm8sCgkJCSJfZm5GZWF0dXJlSHRtbExlbmd0aCI6IF9mbkZlYXR1cmVIdG1sTGVuZ3RoLAoJCQkiX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nIjogX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nLAoJCQkiX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkiOiBfZm5Qcm9jZXNzaW5nRGlzcGxheSwKCQkJIl9mblZpc2libGVUb0NvbHVtbkluZGV4IjogX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSI6IF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlLAoJCQkiX2ZuTm9kZVRvRGF0YUluZGV4IjogX2ZuTm9kZVRvRGF0YUluZGV4LAoJCQkiX2ZuVmlzYmxlQ29sdW1ucyI6IF9mblZpc2JsZUNvbHVtbnMsCgkJCSJfZm5DYWxjdWxhdGVFbmQiOiBfZm5DYWxjdWxhdGVFbmQsCgkJCSJfZm5Db252ZXJ0VG9XaWR0aCI6IF9mbkNvbnZlcnRUb1dpZHRoLAoJCQkiX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzIjogX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLAoJCQkiX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QiOiBfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCwKCQkJIl9mbkdldFdpZGVzdE5vZGUiOiBfZm5HZXRXaWRlc3ROb2RlLAoJCQkiX2ZuR2V0TWF4TGVuU3RyaW5nIjogX2ZuR2V0TWF4TGVuU3RyaW5nLAoJCQkiX2ZuU3RyaW5nVG9Dc3MiOiBfZm5TdHJpbmdUb0NzcywKCQkJIl9mbkRldGVjdFR5cGUiOiBfZm5EZXRlY3RUeXBlLAoJCQkiX2ZuU2V0dGluZ3NGcm9tTm9kZSI6IF9mblNldHRpbmdzRnJvbU5vZGUsCgkJCSJfZm5HZXREYXRhTWFzdGVyIjogX2ZuR2V0RGF0YU1hc3RlciwKCQkJIl9mbkdldFRyTm9kZXMiOiBfZm5HZXRUck5vZGVzLAoJCQkiX2ZuR2V0VGROb2RlcyI6IF9mbkdldFRkTm9kZXMsCgkJCSJfZm5Fc2NhcGVSZWdleCI6IF9mbkVzY2FwZVJlZ2V4LAoJCQkiX2ZuRGVsZXRlSW5kZXgiOiBfZm5EZWxldGVJbmRleCwKCQkJIl9mblJlT3JkZXJJbmRleCI6IF9mblJlT3JkZXJJbmRleCwKCQkJIl9mbkNvbHVtbk9yZGVyaW5nIjogX2ZuQ29sdW1uT3JkZXJpbmcsCgkJCSJfZm5Mb2ciOiBfZm5Mb2csCgkJCSJfZm5DbGVhclRhYmxlIjogX2ZuQ2xlYXJUYWJsZSwKCQkJIl9mblNhdmVTdGF0ZSI6IF9mblNhdmVTdGF0ZSwKCQkJIl9mbkxvYWRTdGF0ZSI6IF9mbkxvYWRTdGF0ZSwKCQkJIl9mbkNyZWF0ZUNvb2tpZSI6IF9mbkNyZWF0ZUNvb2tpZSwKCQkJIl9mblJlYWRDb29raWUiOiBfZm5SZWFkQ29va2llLAoJCQkiX2ZuRGV0ZWN0SGVhZGVyIjogX2ZuRGV0ZWN0SGVhZGVyLAoJCQkiX2ZuR2V0VW5pcXVlVGhzIjogX2ZuR2V0VW5pcXVlVGhzLAoJCQkiX2ZuU2Nyb2xsQmFyV2lkdGgiOiBfZm5TY3JvbGxCYXJXaWR0aCwKCQkJIl9mbkFwcGx5VG9DaGlsZHJlbiI6IF9mbkFwcGx5VG9DaGlsZHJlbiwKCQkJIl9mbk1hcCI6IF9mbk1hcCwKCQkJIl9mbkdldFJvd0RhdGEiOiBfZm5HZXRSb3dEYXRhLAoJCQkiX2ZuR2V0Q2VsbERhdGEiOiBfZm5HZXRDZWxsRGF0YSwKCQkJIl9mblNldENlbGxEYXRhIjogX2ZuU2V0Q2VsbERhdGEsCgkJCSJfZm5HZXRPYmplY3REYXRhRm4iOiBfZm5HZXRPYmplY3REYXRhRm4sCgkJCSJfZm5TZXRPYmplY3REYXRhRm4iOiBfZm5TZXRPYmplY3REYXRhRm4sCgkJCSJfZm5BcHBseUNvbHVtbkRlZnMiOiBfZm5BcHBseUNvbHVtbkRlZnMsCgkJCSJfZm5CaW5kQWN0aW9uIjogX2ZuQmluZEFjdGlvbiwKCQkJIl9mbkV4dGVuZCI6IF9mbkV4dGVuZCwKCQkJIl9mbkNhbGxiYWNrUmVnIjogX2ZuQ2FsbGJhY2tSZWcsCgkJCSJfZm5DYWxsYmFja0ZpcmUiOiBfZm5DYWxsYmFja0ZpcmUsCgkJCSJfZm5Kc29uU3RyaW5nIjogX2ZuSnNvblN0cmluZywKCQkJIl9mblJlbmRlciI6IF9mblJlbmRlciwKCQkJIl9mbk5vZGVUb0NvbHVtbkluZGV4IjogX2ZuTm9kZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5JbmZvTWFjcm9zIjogX2ZuSW5mb01hY3JvcywKCQkJIl9mbkJyb3dzZXJEZXRlY3QiOiBfZm5Ccm93c2VyRGV0ZWN0LAoJCQkiX2ZuR2V0Q29sdW1ucyI6IF9mbkdldENvbHVtbnMKCQl9OwoJCQoJCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9BcGksIHRoaXMub0FwaSApOwoJCQoJCWZvciAoIHZhciBzRnVuYyBpbiBEYXRhVGFibGUuZXh0Lm9BcGkgKQoJCXsKCQkJaWYgKCBzRnVuYyApCgkJCXsKCQkJCXRoaXNbc0Z1bmNdID0gX2ZuRXh0ZXJuQXBpRnVuYyhzRnVuYyk7CgkJCX0KCQl9CgkJCgkJCgkJdmFyIF90aGF0ID0gdGhpczsKCQl0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBpPTAsIGlMZW4sIGosIGpMZW4sIGssIGtMZW47CgkJCXZhciBzSWQgPSB0aGlzLmdldEF0dHJpYnV0ZSggJ2lkJyApOwoJCQl2YXIgYkluaXRIYW5kZWRPZmYgPSBmYWxzZTsKCQkJdmFyIGJVc2VQYXNzZWREYXRhID0gZmFsc2U7CgkJCQoJCQkKCQkJLyogU2FuaXR5IGNoZWNrICovCgkJCWlmICggdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9ICd0YWJsZScgKQoJCQl7CgkJCQlfZm5Mb2coIG51bGwsIDAsICJBdHRlbXB0ZWQgdG8gaW5pdGlhbGlzZSBEYXRhVGFibGVzIG9uIGEgbm9kZSB3aGljaCBpcyBub3QgYSAiKwoJCQkJCSJ0YWJsZTogIit0aGlzLm5vZGVOYW1lICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIENoZWNrIHRvIHNlZSBpZiB3ZSBhcmUgcmUtaW5pdGlhbGlzaW5nIGEgdGFibGUgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkvKiBCYXNlIGNoZWNrIG9uIHRhYmxlIG5vZGUgKi8KCQkJCWlmICggRGF0YVRhYmxlLnNldHRpbmdzW2ldLm5UYWJsZSA9PSB0aGlzICkKCQkJCXsKCQkJCQlpZiAoIG9Jbml0ID09PSB1bmRlZmluZWQgfHwgb0luaXQuYlJldHJpZXZlICkKCQkJCQl7CgkJCQkJCXJldHVybiBEYXRhVGFibGUuc2V0dGluZ3NbaV0ub0luc3RhbmNlOwoJCQkJCX0KCQkJCQllbHNlIGlmICggb0luaXQuYkRlc3Ryb3kgKQoJCQkJCXsKCQkJCQkJRGF0YVRhYmxlLnNldHRpbmdzW2ldLm9JbnN0YW5jZS5mbkRlc3Ryb3koKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCV9mbkxvZyggRGF0YVRhYmxlLnNldHRpbmdzW2ldLCAwLCAiQ2Fubm90IHJlaW5pdGlhbGlzZSBEYXRhVGFibGUuXG5cbiIrCgkJCQkJCQkiVG8gcmV0cmlldmUgdGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGlzIHRhYmxlLCBwYXNzIG5vIGFyZ3VtZW50cyBvciBzZWUgIisKCQkJCQkJCSJ0aGUgZG9jcyBmb3IgYlJldHJpZXZlIGFuZCBiRGVzdHJveSIgKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogSWYgdGhlIGVsZW1lbnQgd2UgYXJlIGluaXRpYWxpc2luZyBoYXMgdGhlIHNhbWUgSUQgYXMgYSB0YWJsZSB3aGljaCB3YXMgcHJldmlvdXNseQoJCQkJICogaW5pdGlhbGlzZWQsIGJ1dCB0aGUgdGFibGUgbm9kZXMgZG9uJ3QgbWF0Y2ggKGZyb20gYmVmb3JlKSB0aGVuIHdlIGRlc3Ryb3kgdGhlIG9sZAoJCQkJICogaW5zdGFuY2UgYnkgc2ltcGx5IGRlbGV0aW5nIGl0LiBUaGlzIGlzIHVuZGVyIHRoZSBhc3N1bXB0aW9uIHRoYXQgdGhlIHRhYmxlIGhhcyBiZWVuCgkJCQkgKiBkZXN0cm95ZWQgYnkgb3RoZXIgbWV0aG9kcy4gQW55b25lIHVzaW5nIG5vbi1pZCBzZWxlY3RvcnMgd2lsbCBuZWVkIHRvIGRvIHRoaXMgbWFudWFsbHkKCQkJCSAqLwoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0uc1RhYmxlSWQgPT0gdGhpcy5pZCApCgkJCQl7CgkJCQkJRGF0YVRhYmxlLnNldHRpbmdzLnNwbGljZSggaSwgMSApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBFbnN1cmUgdGhlIHRhYmxlIGhhcyBhbiBJRCAtIHJlcXVpcmVkIGZvciBhY2Nlc3NpYmlsaXR5ICovCgkJCWlmICggc0lkID09PSBudWxsIHx8IHNJZCA9PT0gIiIgKQoJCQl7CgkJCQlzSWQgPSAiRGF0YVRhYmxlc19UYWJsZV8iKyhEYXRhVGFibGUuZXh0Ll9vRXh0ZXJuQ29uZmlnLmlOZXh0VW5pcXVlKyspOwoJCQkJdGhpcy5pZCA9IHNJZDsKCQkJfQoJCQkKCQkJLyogQ3JlYXRlIHRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgdGFibGUgYW5kIHNldCBzb21lIG9mIHRoZSBkZWZhdWx0IHBhcmFtZXRlcnMgKi8KCQkJdmFyIG9TZXR0aW5ncyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MsIHsKCQkJCSJuVGFibGUiOiAgICAgICAgdGhpcywKCQkJCSJvQXBpIjogICAgICAgICAgX3RoYXQub0FwaSwKCQkJCSJvSW5pdCI6ICAgICAgICAgb0luaXQsCgkJCQkic0Rlc3Ryb3lXaWR0aCI6ICQodGhpcykud2lkdGgoKSwKCQkJCSJzSW5zdGFuY2UiOiAgICAgc0lkLAoJCQkJInNUYWJsZUlkIjogICAgICBzSWQKCQkJfSApOwoJCQlEYXRhVGFibGUuc2V0dGluZ3MucHVzaCggb1NldHRpbmdzICk7CgkJCQoJCQkvLyBOZWVkIHRvIGFkZCB0aGUgaW5zdGFuY2UgYWZ0ZXIgdGhlIGluc3RhbmNlIGFmdGVyIHRoZSBzZXR0aW5ncyBvYmplY3QgaGFzIGJlZW4gYWRkZWQKCQkJLy8gdG8gdGhlIHNldHRpbmdzIGFycmF5LCBzbyB3ZSBjYW4gc2VsZiByZWZlcmVuY2UgdGhlIHRhYmxlIGluc3RhbmNlIGlmIG1vcmUgdGhhbiBvbmUKCQkJb1NldHRpbmdzLm9JbnN0YW5jZSA9IChfdGhhdC5sZW5ndGg9PT0xKSA/IF90aGF0IDogJCh0aGlzKS5kYXRhVGFibGUoKTsKCQkJCgkJCS8qIFNldHRpbmcgdXAgdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdCAqLwoJCQlpZiAoICFvSW5pdCApCgkJCXsKCQkJCW9Jbml0ID0ge307CgkJCX0KCQkJCgkJCS8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBiZWZvcmUgd2UgYXBwbHkgYWxsIHRoZSBkZWZhdWx0cwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZSApCgkJCXsKCQkJCV9mbkxhbmd1YWdlQ29tcGF0KCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJb0luaXQgPSBfZm5FeHRlbmQoICQuZXh0ZW5kKHRydWUsIHt9LCBEYXRhVGFibGUuZGVmYXVsdHMpLCBvSW5pdCApOwoJCQkKCQkJLy8gTWFwIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zIG9udG8gdGhlIHNldHRpbmdzIG9iamVjdAoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlBhZ2luYXRlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkxlbmd0aENoYW5nZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJGaWx0ZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiU29ydCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJJbmZvIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlByb2Nlc3NpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiQXV0b1dpZHRoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNvcnRDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNlcnZlclNpZGUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiRGVmZXJSZW5kZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFgiLCAic1giICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFhJbm5lciIsICJzWElubmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxZIiwgInNZIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgImJTY3JvbGxDb2xsYXBzZSIsICJiQ29sbGFwc2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiYlNjcm9sbEluZmluaXRlIiwgImJJbmZpbml0ZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJpU2Nyb2xsTG9hZEdhcCIsICJpTG9hZEdhcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJiU2Nyb2xsQXV0b0NzcyIsICJiQXV0b0NzcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcGVDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhc1N0cmlwQ2xhc3NlcyIsICJhc1N0cmlwZUNsYXNzZXMiICk7IC8vIGxlZ2FjeQoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblNlcnZlckRhdGEiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImZuRm9ybWF0TnVtYmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzU2VydmVyTWV0aG9kIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhYVNvcnRpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImFhU29ydGluZ0ZpeGVkIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhTGVuZ3RoTWVudSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic1BhZ2luYXRpb25UeXBlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQWpheFNvdXJjZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0FqYXhEYXRhUHJvcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaUNvb2tpZUR1cmF0aW9uIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQ29va2llUHJlZml4IiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzRG9tIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJiU29ydENlbGxzVG9wIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpVGFiSW5kZXgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgIm9TZWFyY2giLCAib1ByZXZpb3VzU2VhcmNoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhb1NlYXJjaENvbHMiLCAiYW9QcmVTZWFyY2hDb2xzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpRGlzcGxheUxlbmd0aCIsICJfaURpc3BsYXlMZW5ndGgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImJKUXVlcnlVSSIsICJiSlVJIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmbkNvb2tpZUNhbGxiYWNrIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblN0YXRlTG9hZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TdGF0ZVNhdmUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQsICJmbkluZm9DYWxsYmFjayIgKTsKCQkJCgkJCS8qIENhbGxiYWNrIGZ1bmN0aW9ucyB3aGljaCBhcmUgYXJyYXkgZHJpdmVuICovCgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICAgICAgIG9Jbml0LmZuRHJhd0NhbGxiYWNrLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TZXJ2ZXJQYXJhbXMnLCAgICAgICBvSW5pdC5mblNlcnZlclBhcmFtcywgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU3RhdGVTYXZlUGFyYW1zJywgICAgb0luaXQuZm5TdGF0ZVNhdmVQYXJhbXMsICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZFBhcmFtcycsICAgIG9Jbml0LmZuU3RhdGVMb2FkUGFyYW1zLCAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICAgICAgICBvSW5pdC5mblN0YXRlTG9hZGVkLCAgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvUm93Q2FsbGJhY2snLCAgICAgICAgb0luaXQuZm5Sb3dDYWxsYmFjaywgICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG9Jbml0LmZuQ3JlYXRlZFJvdywgICAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9IZWFkZXJDYWxsYmFjaycsICAgICBvSW5pdC5mbkhlYWRlckNhbGxiYWNrLCAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRm9vdGVyQ2FsbGJhY2snLCAgICAgb0luaXQuZm5Gb290ZXJDYWxsYmFjaywgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0luaXRDb21wbGV0ZScsICAgICAgIG9Jbml0LmZuSW5pdENvbXBsZXRlLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAgICBvSW5pdC5mblByZURyYXdDYWxsYmFjaywgICAndXNlcicgKTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmCgkJCQkgICBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0Q2xhc3NlcyApCgkJCXsKCQkJCS8qIEVuYWJsZSBzb3J0IGNsYXNzZXMgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIFNhZmUgdG8gZG8gaXQgaGVyZSwgc2luY2Ugc2VydmVyLXNpZGUKCQkJCSAqIHByb2Nlc3NpbmcgbXVzdCBiZSBlbmFibGVkIGJ5IHRoZSBkZXZlbG9wZXIKCQkJCSAqLwoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdzZXJ2ZXJfc2lkZV9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkRlZmVyUmVuZGVyICkKCQkJewoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdkZWZlcl9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYkpRdWVyeVVJICkKCQkJewoJCQkJLyogVXNlIHRoZSBKVUkgY2xhc3NlcyBvYmplY3QgZm9yIGRpc3BsYXkuIFlvdSBjb3VsZCBjbG9uZSB0aGUgb1N0ZENsYXNzZXMgb2JqZWN0IGlmIAoJCQkJICogeW91IHdhbnQgdG8gaGF2ZSBtdWx0aXBsZSB0YWJsZXMgd2l0aCBtdWx0aXBsZSBpbmRlcGVuZGVudCBjbGFzc2VzIAoJCQkJICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9DbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9KVUlDbGFzc2VzICk7CgkJCQkKCQkJCWlmICggb0luaXQuc0RvbSA9PT0gRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gJiYgRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gPT09ICJsZnJ0aXAiICkKCQkJCXsKCQkJCQkvKiBTZXQgdGhlIERPTSB0byB1c2UgYSBsYXlvdXQgc3VpdGFibGUgZm9yIGpRdWVyeSBVSSdzIHRoZW1pbmcgKi8KCQkJCQlvU2V0dGluZ3Muc0RvbSA9ICc8IkgibGZyPnQ8IkYiaXA+JzsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3Mub0NsYXNzZXMsIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMgKTsKCQkJfQoJCQkkKHRoaXMpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1RhYmxlICk7CgkJCQoJCQkvKiBDYWxjdWxhdGUgdGhlIHNjcm9sbCBiYXIgd2lkdGggYW5kIGNhY2hlIGl0IGZvciB1c2UgbGF0ZXIgb24gKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoID0gX2ZuU2Nyb2xsQmFyV2lkdGgoKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIERpc3BsYXkgc3RhcnQgcG9pbnQsIHRha2luZyBpbnRvIGFjY291bnQgdGhlIHNhdmUgc2F2aW5nICovCgkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBvSW5pdC5pRGlzcGxheVN0YXJ0OwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb0luaXQuaURpc3BsYXlTdGFydDsKCQkJfQoJCQkKCQkJLyogTXVzdCBiZSBkb25lIGFmdGVyIGV2ZXJ5dGhpbmcgd2hpY2ggY2FuIGJlIG92ZXJyaWRkZW4gYnkgYSBjb29raWUhICovCgkJCWlmICggb0luaXQuYlN0YXRlU2F2ZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSA9IHRydWU7CgkJCQlfZm5Mb2FkU3RhdGUoIG9TZXR0aW5ncywgb0luaXQgKTsKCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNhdmVTdGF0ZSwgJ3N0YXRlX3NhdmUnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuaURlZmVyTG9hZGluZyAhPT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nID0gdHJ1ZTsKCQkJCXZhciB0bXAgPSAkLmlzQXJyYXkoIG9Jbml0LmlEZWZlckxvYWRpbmcgKTsKCQkJCW9TZXR0aW5ncy5faVJlY29yZHNEaXNwbGF5ID0gdG1wID8gb0luaXQuaURlZmVyTG9hZGluZ1swXSA6IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCQlvU2V0dGluZ3MuX2lSZWNvcmRzVG90YWwgPSB0bXAgPyBvSW5pdC5pRGVmZXJMb2FkaW5nWzFdIDogb0luaXQuaURlZmVyTG9hZGluZzsKCQkJfQoJCQkKCQkJaWYgKCBvSW5pdC5hYURhdGEgIT09IG51bGwgKQoJCQl7CgkJCQliVXNlUGFzc2VkRGF0YSA9IHRydWU7CgkJCX0KCQkJCgkJCS8qIExhbmd1YWdlIGRlZmluaXRpb25zICovCgkJCWlmICggb0luaXQub0xhbmd1YWdlLnNVcmwgIT09ICIiICkKCQkJewoJCQkJLyogR2V0IHRoZSBsYW5ndWFnZSBkZWZpbml0aW9ucyBmcm9tIGEgZmlsZSAtIGJlY2F1c2UgdGhpcyBBamF4IGNhbGwgbWFrZXMgdGhlIGxhbmd1YWdlCgkJCQkgKiBnZXQgYXN5bmMgdG8gdGhlIHJlbWFpbmRlciBvZiB0aGlzIGZ1bmN0aW9uIHdlIHVzZSBiSW5pdEhhbmRlZE9mZiB0byBpbmRpY2F0ZSB0aGF0IAoJCQkJICogX2ZuSW5pdGlhbGlzZSB3aWxsIGJlIGZpcmVkIGJ5IHRoZSByZXR1cm5lZCBBamF4IGhhbmRsZXIsIHJhdGhlciB0aGFuIHRoZSBjb25zdHJ1Y3RvcgoJCQkJICovCgkJCQlvU2V0dGluZ3Mub0xhbmd1YWdlLnNVcmwgPSBvSW5pdC5vTGFuZ3VhZ2Uuc1VybDsKCQkJCSQuZ2V0SlNPTiggb1NldHRpbmdzLm9MYW5ndWFnZS5zVXJsLCBudWxsLCBmdW5jdGlvbigganNvbiApIHsKCQkJCQlfZm5MYW5ndWFnZUNvbXBhdCgganNvbiApOwoJCQkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3Mub0xhbmd1YWdlLCBvSW5pdC5vTGFuZ3VhZ2UsIGpzb24gKTsKCQkJCQlfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsKCQkJCX0gKTsKCQkJCWJJbml0SGFuZGVkT2ZmID0gdHJ1ZTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3Mub0xhbmd1YWdlLCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIFN0cmlwZXMKCQkJICovCgkJCWlmICggb0luaXQuYXNTdHJpcGVDbGFzc2VzID09PSBudWxsICkKCQkJewoJCQkJb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3NlcyA9WwoJCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkLAoJCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlRXZlbgoJCQkJXTsKCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHJvdyBzdHJpcGUgY2xhc3NlcyBpZiB0aGV5IGFyZSBhbHJlYWR5IG9uIHRoZSB0YWJsZSByb3cgKi8KCQkJaUxlbj1vU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmxlbmd0aDsKCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXMgPSBbXTsKCQkJaWYgKGlMZW4pCgkJCXsKCQkJCXZhciBiU3RyaXBlUmVtb3ZlID0gZmFsc2U7CgkJCQl2YXIgYW5Sb3dzID0gJCh0aGlzKS5jaGlsZHJlbigndGJvZHknKS5jaGlsZHJlbigndHI6bHQoJyArIGlMZW4gKyAnKScpOwoJCQkJZm9yICggaT0wIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFuUm93cy5oYXNDbGFzcyggb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1tpXSApICkKCQkJCQl7CgkJCQkJCWJTdHJpcGVSZW1vdmUgPSB0cnVlOwoJCQkJCQkKCQkJCQkJLyogU3RvcmUgdGhlIGNsYXNzZXMgd2hpY2ggd2UgYXJlIGFib3V0IHRvIHJlbW92ZSBzbyB0aGV5IGNhbiBiZSByZS1hZGRlZCBvbiBkZXN0cm95ICovCgkJCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzLnB1c2goIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbaV0gKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggYlN0cmlwZVJlbW92ZSApCgkJCQl7CgkJCQkJYW5Sb3dzLnJlbW92ZUNsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmpvaW4oJyAnKSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKgoJCQkgKiBDb2x1bW5zCgkJCSAqIFNlZSBpZiB3ZSBzaG91bGQgbG9hZCBjb2x1bW5zIGF1dG9tYXRpY2FsbHkgb3IgdXNlIGRlZmluZWQgb25lcwoJCQkgKi8KCQkJdmFyIGFuVGhzID0gW107CgkJCXZhciBhb0NvbHVtbnNJbml0OwoJCQl2YXIgblRoZWFkID0gdGhpcy5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGhlYWQnKTsKCQkJaWYgKCBuVGhlYWQubGVuZ3RoICE9PSAwICkKCQkJewoJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBvU2V0dGluZ3MuYW9IZWFkZXIsIG5UaGVhZFswXSApOwoJCQkJYW5UaHMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBJZiBub3QgZ2l2ZW4gYSBjb2x1bW4gYXJyYXksIGdlbmVyYXRlIG9uZSB3aXRoIG51bGxzICovCgkJCWlmICggb0luaXQuYW9Db2x1bW5zID09PSBudWxsICkKCQkJewoJCQkJYW9Db2x1bW5zSW5pdCA9IFtdOwoJCQkJZm9yICggaT0wLCBpTGVuPWFuVGhzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYW9Db2x1bW5zSW5pdC5wdXNoKCBudWxsICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlhb0NvbHVtbnNJbml0ID0gb0luaXQuYW9Db2x1bW5zOwoJCQl9CgkJCQoJCQkvKiBBZGQgdGhlIGNvbHVtbnMgKi8KCQkJZm9yICggaT0wLCBpTGVuPWFvQ29sdW1uc0luaXQubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJLyogU2hvcnQgY3V0IC0gdXNlIHRoZSBsb29wIHRvIGNoZWNrIGlmIHdlIGhhdmUgY29sdW1uIHZpc2liaWxpdHkgc3RhdGUgdG8gcmVzdG9yZSAqLwoJCQkJaWYgKCBvSW5pdC5zYXZlZF9hb0NvbHVtbnMgIT09IHVuZGVmaW5lZCAmJiBvSW5pdC5zYXZlZF9hb0NvbHVtbnMubGVuZ3RoID09IGlMZW4gKQoJCQkJewoJCQkJCWlmICggYW9Db2x1bW5zSW5pdFtpXSA9PT0gbnVsbCApCgkJCQkJewoJCQkJCQlhb0NvbHVtbnNJbml0W2ldID0ge307CgkJCQkJfQoJCQkJCWFvQ29sdW1uc0luaXRbaV0uYlZpc2libGUgPSBvSW5pdC5zYXZlZF9hb0NvbHVtbnNbaV0uYlZpc2libGU7CgkJCQl9CgkJCQkKCQkJCV9mbkFkZENvbHVtbiggb1NldHRpbmdzLCBhblRocyA/IGFuVGhzW2ldIDogbnVsbCApOwoJCQl9CgkJCQoJCQkvKiBBcHBseSB0aGUgY29sdW1uIGRlZmluaXRpb25zICovCgkJCV9mbkFwcGx5Q29sdW1uRGVmcyggb1NldHRpbmdzLCBvSW5pdC5hb0NvbHVtbkRlZnMsIGFvQ29sdW1uc0luaXQsIGZ1bmN0aW9uIChpQ29sLCBvRGVmKSB7CgkJCQlfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG9EZWYgKTsKCQkJfSApOwoJCQkKCQkJCgkJCS8qCgkJCSAqIFNvcnRpbmcKCQkJICogQ2hlY2sgdGhlIGFhU29ydGluZyBhcnJheQoJCQkgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdID49IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdID0gMDsKCQkJCX0KCQkJCXZhciBvQ29sdW1uID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSBdOwoJCQkJCgkJCQkvKiBBZGQgYSBkZWZhdWx0IHNvcnRpbmcgaW5kZXggKi8KCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdID0gMDsKCQkJCX0KCQkJCQoJCQkJLyogSWYgYWFTb3J0aW5nIGlzIG5vdCBkZWZpbmVkLCB0aGVuIHdlIHVzZSB0aGUgZmlyc3QgaW5kaWNhdG9yIGluIGFzU29ydGluZyAqLwoJCQkJaWYgKCBvSW5pdC5hYVNvcnRpbmcgPT09IHVuZGVmaW5lZCAmJiBvU2V0dGluZ3Muc2F2ZWRfYWFTb3J0aW5nID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMV0gPSBvQ29sdW1uLmFzU29ydGluZ1swXTsKCQkJCX0KCQkJCQoJCQkJLyogU2V0IHRoZSBjdXJyZW50IHNvcnRpbmcgaW5kZXggYmFzZWQgb24gYW9Db2x1bW5zLmFzU29ydGluZyAqLwoJCQkJZm9yICggaj0wLCBqTGVuPW9Db2x1bW4uYXNTb3J0aW5nLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID09IG9Db2x1bW4uYXNTb3J0aW5nW2pdICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPSBqOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJCQoJCQkvKiBEbyBhIGZpcnN0IHBhc3Mgb24gdGhlIHNvcnRpbmcgY2xhc3NlcyAoYWxsb3dzIGFueSBzaXplIGNoYW5nZXMgdG8gYmUgdGFrZW4gaW50bwoJCQkgKiBhY2NvdW50LCBhbmQgYWxzbyB3aWxsIGFwcGx5IHNvcnRpbmcgZGlzYWJsZWQgY2xhc3NlcyBpZiBkaXNhYmxlZAoJCQkgKi8KCQkJX2ZuU29ydGluZ0NsYXNzZXMoIG9TZXR0aW5ncyApOwoJCQkKCQkJCgkJCS8qCgkJCSAqIEZpbmFsIGluaXQKCQkJICogQ2FjaGUgdGhlIGhlYWRlciwgYm9keSBhbmQgZm9vdGVyIGFzIHJlcXVpcmVkLCBjcmVhdGluZyB0aGVtIGlmIG5lZWRlZAoJCQkgKi8KCQkJCgkJCS8qIEJyb3dzZXIgc3VwcG9ydCBkZXRlY3Rpb24gKi8KCQkJX2ZuQnJvd3NlckRldGVjdCggb1NldHRpbmdzICk7CgkJCQoJCQkvLyBXb3JrIGFyb3VuZCBmb3IgV2Via2l0IGJ1ZyA4Mzg2NyAtIHN0b3JlIHRoZSBjYXB0aW9uLXNpZGUgYmVmb3JlIHJlbW92aW5nIGZyb20gZG9jCgkJCXZhciBjYXB0aW9ucyA9ICQodGhpcykuY2hpbGRyZW4oJ2NhcHRpb24nKS5lYWNoKCBmdW5jdGlvbiAoKSB7CgkJCQl0aGlzLl9jYXB0aW9uU2lkZSA9ICQodGhpcykuY3NzKCdjYXB0aW9uLXNpZGUnKTsKCQkJfSApOwoJCQkKCQkJdmFyIHRoZWFkID0gJCh0aGlzKS5jaGlsZHJlbigndGhlYWQnKTsKCQkJaWYgKCB0aGVhZC5sZW5ndGggPT09IDAgKQoJCQl7CgkJCQl0aGVhZCA9IFsgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RoZWFkJyApIF07CgkJCQl0aGlzLmFwcGVuZENoaWxkKCB0aGVhZFswXSApOwoJCQl9CgkJCW9TZXR0aW5ncy5uVEhlYWQgPSB0aGVhZFswXTsKCQkJCgkJCXZhciB0Ym9keSA9ICQodGhpcykuY2hpbGRyZW4oJ3Rib2R5Jyk7CgkJCWlmICggdGJvZHkubGVuZ3RoID09PSAwICkKCQkJewoJCQkJdGJvZHkgPSBbIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0Ym9keScgKSBdOwoJCQkJdGhpcy5hcHBlbmRDaGlsZCggdGJvZHlbMF0gKTsKCQkJfQoJCQlvU2V0dGluZ3MublRCb2R5ID0gdGJvZHlbMF07CgkJCW9TZXR0aW5ncy5uVEJvZHkuc2V0QXR0cmlidXRlKCAicm9sZSIsICJhbGVydCIgKTsKCQkJb1NldHRpbmdzLm5UQm9keS5zZXRBdHRyaWJ1dGUoICJhcmlhLWxpdmUiLCAicG9saXRlIiApOwoJCQlvU2V0dGluZ3MublRCb2R5LnNldEF0dHJpYnV0ZSggImFyaWEtcmVsZXZhbnQiLCAiYWxsIiApOwoJCQkKCQkJdmFyIHRmb290ID0gJCh0aGlzKS5jaGlsZHJlbigndGZvb3QnKTsKCQkJaWYgKCB0Zm9vdC5sZW5ndGggPT09IDAgJiYgY2FwdGlvbnMubGVuZ3RoID4gMCAmJiAob1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiIHx8IG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIikgKQoJCQl7CgkJCQkvLyBJZiB3ZSBhcmUgYSBzY3JvbGxpbmcgdGFibGUsIGFuZCBubyBmb290ZXIgaGFzIGJlZW4gZ2l2ZW4sIHRoZW4gd2UgbmVlZCB0byBjcmVhdGUKCQkJCS8vIGEgdGZvb3QgZWxlbWVudCBmb3IgdGhlIGNhcHRpb24gZWxlbWVudCB0byBiZSBhcHBlbmRlZCB0bwoJCQkJdGZvb3QgPSBbIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0Zm9vdCcgKSBdOwoJCQkJdGhpcy5hcHBlbmRDaGlsZCggdGZvb3RbMF0gKTsKCQkJfQoJCQkKCQkJaWYgKCB0Zm9vdC5sZW5ndGggPiAwICkKCQkJewoJCQkJb1NldHRpbmdzLm5URm9vdCA9IHRmb290WzBdOwoJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBvU2V0dGluZ3MuYW9Gb290ZXIsIG9TZXR0aW5ncy5uVEZvb3QgKTsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgaWYgdGhlcmUgaXMgZGF0YSBwYXNzaW5nIGludG8gdGhlIGNvbnN0cnVjdG9yICovCgkJCWlmICggYlVzZVBhc3NlZERhdGEgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9Jbml0LmFhRGF0YS5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCV9mbkFkZERhdGEoIG9TZXR0aW5ncywgb0luaXQuYWFEYXRhWyBpIF0gKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIEdyYWIgdGhlIGRhdGEgZnJvbSB0aGUgcGFnZSAqLwoJCQkJX2ZuR2F0aGVyRGF0YSggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIENvcHkgdGhlIGRhdGEgaW5kZXggYXJyYXkgKi8KCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCgkJCS8qIEluaXRpYWxpc2F0aW9uIGNvbXBsZXRlIC0gdGFibGUgY2FuIGJlIGRyYXduICovCgkJCW9TZXR0aW5ncy5iSW5pdGlhbGlzZWQgPSB0cnVlOwoJCQkKCQkJLyogQ2hlY2sgaWYgd2UgbmVlZCB0byBpbml0aWFsaXNlIHRoZSB0YWJsZSAoaXQgbWlnaHQgbm90IGhhdmUgYmVlbiBoYW5kZWQgb2ZmIHRvIHRoZQoJCQkgKiBsYW5ndWFnZSBwcm9jZXNzb3IpCgkJCSAqLwoJCQlpZiAoIGJJbml0SGFuZGVkT2ZmID09PSBmYWxzZSApCgkJCXsKCQkJCV9mbkluaXRpYWxpc2UoIG9TZXR0aW5ncyApOwoJCQl9CgkJfSApOwoJCV90aGF0ID0gbnVsbDsKCQlyZXR1cm4gdGhpczsKCX07CgoJCgkKCS8qKgoJICogUHJvdmlkZSBhIGNvbW1vbiBtZXRob2QgZm9yIHBsdWctaW5zIHRvIGNoZWNrIHRoZSB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgYmVpbmcgdXNlZCwgaW4gb3JkZXIKCSAqIHRvIGVuc3VyZSBjb21wYXRpYmlsaXR5LgoJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJICogICAgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgcmVxdWlyZWQKCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICBhbGVydCggJC5mbi5kYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJICovCglEYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2sgPSBmdW5jdGlvbiggc1ZlcnNpb24gKQoJewoJCS8qIFRoaXMgaXMgY2hlYXAsIGJ1dCBlZmZlY3RpdmUgKi8KCQl2YXIgZm5aUGFkID0gZnVuY3Rpb24gKFpwYWQsIGNvdW50KQoJCXsKCQkJd2hpbGUoWnBhZC5sZW5ndGggPCBjb3VudCkgewoJCQkJWnBhZCArPSAnMCc7CgkJCX0KCQkJcmV0dXJuIFpwYWQ7CgkJfTsKCQl2YXIgYVRoaXMgPSBEYXRhVGFibGUuZXh0LnNWZXJzaW9uLnNwbGl0KCcuJyk7CgkJdmFyIGFUaGF0ID0gc1ZlcnNpb24uc3BsaXQoJy4nKTsKCQl2YXIgc1RoaXMgPSAnJywgc1RoYXQgPSAnJzsKCQkKCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFUaGF0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJewoJCQlzVGhpcyArPSBmblpQYWQoIGFUaGlzW2ldLCAzICk7CgkJCXNUaGF0ICs9IGZuWlBhZCggYVRoYXRbaV0sIDMgKTsKCQl9CgkJCgkJcmV0dXJuIHBhcnNlSW50KHNUaGlzLCAxMCkgPj0gcGFyc2VJbnQoc1RoYXQsIDEwKTsKCX07CgkKCQoJLyoqCgkgKiBDaGVjayBpZiBhIFRBQkxFIG5vZGUgaXMgYSBEYXRhVGFibGUgdGFibGUgYWxyZWFkeSBvciBub3QuCgkgKiAgQHBhcmFtIHtub2RlfSBuVGFibGUgVGhlIFRBQkxFIG5vZGUgdG8gY2hlY2sgaWYgaXQgaXMgYSBEYXRhVGFibGUgb3Igbm90IChub3RlIHRoYXQgb3RoZXIKCSAqICAgIG5vZGUgdHlwZXMgY2FuIGJlIHBhc3NlZCBpbiwgYnV0IHdpbGwgYWx3YXlzIHJldHVybiBmYWxzZSkuCgkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgdGhlIHRhYmxlIGdpdmVuIGlzIGEgRGF0YVRhYmxlLCBvciBmYWxzZSBvdGhlcndpc2UKCSAqICBAc3RhdGljCgkgKiAgQGR0b3B0IEFQSS1TdGF0aWMKCSAqCgkgKiAgQGV4YW1wbGUKCSAqICAgIHZhciBleCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGFtcGxlJyk7CgkgKiAgICBpZiAoICEgJC5mbi5EYXRhVGFibGUuZm5Jc0RhdGFUYWJsZSggZXggKSApIHsKCSAqICAgICAgJChleCkuZGF0YVRhYmxlKCk7CgkgKiAgICB9CgkgKi8KCURhdGFUYWJsZS5mbklzRGF0YVRhYmxlID0gZnVuY3Rpb24gKCBuVGFibGUgKQoJewoJCXZhciBvID0gRGF0YVRhYmxlLnNldHRpbmdzOwoJCgkJZm9yICggdmFyIGk9MCA7IGk8by5sZW5ndGggOyBpKysgKQoJCXsKCQkJaWYgKCBvW2ldLm5UYWJsZSA9PT0gblRhYmxlIHx8IG9baV0ublNjcm9sbEhlYWQgPT09IG5UYWJsZSB8fCBvW2ldLm5TY3JvbGxGb290ID09PSBuVGFibGUgKQoJCQl7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCQoJCXJldHVybiBmYWxzZTsKCX07CgkKCQoJLyoqCgkgKiBHZXQgYWxsIERhdGFUYWJsZSB0YWJsZXMgdGhhdCBoYXZlIGJlZW4gaW5pdGlhbGlzZWQgLSBvcHRpb25hbGx5IHlvdSBjYW4gc2VsZWN0IHRvCgkgKiBnZXQgb25seSBjdXJyZW50bHkgdmlzaWJsZSB0YWJsZXMuCgkgKiAgQHBhcmFtIHtib29sZWFufSBbYlZpc2libGU9ZmFsc2VdIEZsYWcgdG8gaW5kaWNhdGUgaWYgeW91IHdhbnQgYWxsIChkZWZhdWx0KSBvciAKCSAqICAgIHZpc2libGUgdGFibGVzIG9ubHkuCgkgKiAgQHJldHVybnMge2FycmF5fSBBcnJheSBvZiBUQUJMRSBub2RlcyAobm90IERhdGFUYWJsZSBpbnN0YW5jZXMpIHdoaWNoIGFyZSBEYXRhVGFibGVzCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICB2YXIgdGFibGUgPSAkLmZuLmRhdGFUYWJsZS5mblRhYmxlcyh0cnVlKTsKCSAqICAgIGlmICggdGFibGUubGVuZ3RoID4gMCApIHsKCSAqICAgICAgJCh0YWJsZSkuZGF0YVRhYmxlKCkuZm5BZGp1c3RDb2x1bW5TaXppbmcoKTsKCSAqICAgIH0KCSAqLwoJRGF0YVRhYmxlLmZuVGFibGVzID0gZnVuY3Rpb24gKCBiVmlzaWJsZSApCgl7CgkJdmFyIG91dCA9IFtdOwoJCgkJalF1ZXJ5LmVhY2goIERhdGFUYWJsZS5zZXR0aW5ncywgZnVuY3Rpb24gKGksIG8pIHsKCQkJaWYgKCAhYlZpc2libGUgfHwgKGJWaXNpYmxlID09PSB0cnVlICYmICQoby5uVGFibGUpLmlzKCc6dmlzaWJsZScpKSApCgkJCXsKCQkJCW91dC5wdXNoKCBvLm5UYWJsZSApOwoJCQl9CgkJfSApOwoJCgkJcmV0dXJuIG91dDsKCX07CgkKCgkvKioKCSAqIFZlcnNpb24gc3RyaW5nIGZvciBwbHVnLWlucyB0byBjaGVjayBjb21wYXRpYmlsaXR5LiBBbGxvd2VkIGZvcm1hdCBpcwoJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJICogZSBhcmUgb3B0aW9uYWwKCSAqICBAbWVtYmVyCgkgKiAgQHR5cGUgc3RyaW5nCgkgKiAgQGRlZmF1bHQgVmVyc2lvbiBudW1iZXIKCSAqLwoJRGF0YVRhYmxlLnZlcnNpb24gPSAiMS45LjQiOwoKCS8qKgoJICogUHJpdmF0ZSBkYXRhIHN0b3JlLCBjb250YWluaW5nIGFsbCBvZiB0aGUgc2V0dGluZ3Mgb2JqZWN0cyB0aGF0IGFyZSBjcmVhdGVkIGZvciB0aGUKCSAqIHRhYmxlcyBvbiBhIGdpdmVuIHBhZ2UuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlLnNldHRpbmdzPC9pPiBvYmplY3QgaXMgYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlRXh0PC9pPiAKCSAqIHRocm91Z2ggd2hpY2ggaXQgbWF5IGJlIGFjY2Vzc2VkIGFuZCBtYW5pcHVsYXRlZCwgb3IgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZS5zZXR0aW5nczwvaT4uCgkgKiAgQG1lbWJlcgoJICogIEB0eXBlIGFycmF5CgkgKiAgQGRlZmF1bHQgW10KCSAqICBAcHJpdmF0ZQoJICovCglEYXRhVGFibGUuc2V0dGluZ3MgPSBbXTsKCgkvKioKCSAqIE9iamVjdCBtb2RlbHMgY29udGFpbmVyLCBmb3IgdGhlIHZhcmlvdXMgbW9kZWxzIHRoYXQgRGF0YVRhYmxlcyBoYXMgYXZhaWxhYmxlCgkgKiB0byBpdC4gVGhlc2UgbW9kZWxzIGRlZmluZSB0aGUgb2JqZWN0cyB0aGF0IGFyZSB1c2VkIHRvIGhvbGQgdGhlIGFjdGl2ZSBzdGF0ZSAKCSAqIGFuZCBjb25maWd1cmF0aW9uIG9mIHRoZSB0YWJsZS4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMgPSB7fTsKCQoJCgkvKioKCSAqIERhdGFUYWJsZXMgZXh0ZW5zaW9uIG9wdGlvbnMgYW5kIHBsdWctaW5zLiBUaGlzIG5hbWVzcGFjZSBhY3RzIGFzIGEgY29sbGVjdGlvbiAiYXJlYSIKCSAqIGZvciBwbHVnLWlucyB0aGF0IGNhbiBiZSB1c2VkIHRvIGV4dGVuZCB0aGUgZGVmYXVsdCBEYXRhVGFibGVzIGJlaGF2aW91ciAtIGluZGVlZCBtYW55CgkgKiBvZiB0aGUgYnVpbGQgaW4gbWV0aG9kcyB1c2UgdGhpcyBtZXRob2QgdG8gcHJvdmlkZSB0aGVpciBvd24gY2FwYWJpbGl0aWVzIChzb3J0aW5nIG1ldGhvZHMKCSAqIGZvciBleGFtcGxlKS4KCSAqIAoJICogTm90ZSB0aGF0IHRoaXMgbmFtZXNwYWNlIGlzIGFsaWFzZWQgdG8galF1ZXJ5LmZuLmRhdGFUYWJsZUV4dCBzbyBpdCBjYW4gYmUgcmVhZGlseSBhY2Nlc3NlZAoJICogYW5kIG1vZGlmaWVkIGJ5IHBsdWctaW5zLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5leHQgPSB7CgkJLyoqCgkJICogUGx1Zy1pbiBmaWx0ZXJpbmcgZnVuY3Rpb25zIC0gdGhpcyBtZXRob2Qgb2YgZmlsdGVyaW5nIGlzIGNvbXBsaW1lbnRhcnkgdG8gdGhlIGRlZmF1bHQKCQkgKiB0eXBlIGJhc2VkIGZpbHRlcmluZywgYW5kIGEgbG90IG1vcmUgY29tcHJlaGVuc2l2ZSBhcyBpdCBhbGxvd3MgeW91IGNvbXBsZXRlIGNvbnRyb2wKCQkgKiBvdmVyIHRoZSBmaWx0ZXJpbmcgbG9naWMuIEVhY2ggZWxlbWVudCBpbiB0aGlzIGFycmF5IGlzIGEgZnVuY3Rpb24gKHBhcmFtZXRlcnMKCQkgKiBkZXNjcmliZWQgYmVsb3cpIHRoYXQgaXMgY2FsbGVkIGZvciBldmVyeSByb3cgaW4gdGhlIHRhYmxlLCBhbmQgeW91ciBsb2dpYyBkZWNpZGVzIGlmCgkJICogaXQgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBmaWx0ZXJlZCBkYXRhIHNldCBvciBub3QuCgkJICogICA8dWw+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBEYXRhIGZvciB0aGUgcm93IHRvIGJlIHByb2Nlc3NlZCAoc2FtZSBhcyB0aGUgb3JpZ2luYWwgZm9ybWF0CgkJICogICAgICAgICAgIHRoYXQgd2FzIHBhc3NlZCBpbiBhcyB0aGUgZGF0YSBzb3VyY2UsIG9yIGFuIGFycmF5IGZyb20gYSBET00gZGF0YSBzb3VyY2U8L2xpPgoJCSAqICAgICAgICAgPGxpPntpbnR9IFJvdyBpbmRleCBpbiBhb0RhdGEgKHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5ncy5hb0RhdGF9KSwgd2hpY2ggY2FuCgkJICogICAgICAgICAgIGJlIHVzZWZ1bCB0byByZXRyaWV2ZSB0aGUgVFIgZWxlbWVudCBpZiB5b3UgbmVlZCBET00gaW50ZXJhY3Rpb24uPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Ym9vbGVhbn0gSW5jbHVkZSB0aGUgcm93IGluIHRoZSBmaWx0ZXJlZCByZXN1bHQgc2V0ICh0cnVlKSBvciBub3QgKGZhbHNlKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBUaGUgZm9sbG93aW5nIGV4YW1wbGUgc2hvd3MgY3VzdG9tIGZpbHRlcmluZyBiZWluZyBhcHBsaWVkIHRvIHRoZSBmb3VydGggY29sdW1uIChpLmUuCgkJICogICAgLy8gdGhlIGFEYXRhWzNdIGluZGV4KSBiYXNlZCBvbiB0d28gaW5wdXQgdmFsdWVzIGZyb20gdGhlIGVuZC11c2VyLCBtYXRjaGluZyB0aGUgZGF0YSBpbiAKCQkgKiAgICAvLyBhIGNlcnRhaW4gcmFuZ2UuCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQuYWZuRmlsdGVyaW5nLnB1c2goCgkJICogICAgICBmdW5jdGlvbiggb1NldHRpbmdzLCBhRGF0YSwgaURhdGFJbmRleCApIHsKCQkgKiAgICAgICAgdmFyIGlNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWluJykudmFsdWUgKiAxOwoJCSAqICAgICAgICB2YXIgaU1heCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXgnKS52YWx1ZSAqIDE7CgkJICogICAgICAgIHZhciBpVmVyc2lvbiA9IGFEYXRhWzNdID09ICItIiA/IDAgOiBhRGF0YVszXSoxOwoJCSAqICAgICAgICBpZiAoIGlNaW4gPT0gIiIgJiYgaU1heCA9PSAiIiApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICBlbHNlIGlmICggaU1pbiA9PSAiIiAmJiBpVmVyc2lvbiA8IGlNYXggKSB7CgkJICogICAgICAgICAgcmV0dXJuIHRydWU7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgZWxzZSBpZiAoIGlNaW4gPCBpVmVyc2lvbiAmJiAiIiA9PSBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIGVsc2UgaWYgKCBpTWluIDwgaVZlcnNpb24gJiYgaVZlcnNpb24gPCBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgIH0KCQkgKiAgICApOwoJCSAqLwoJCSJhZm5GaWx0ZXJpbmciOiBbXSwKCQoJCgkJLyoqCgkJICogUGx1Zy1pbiBzb3J0aW5nIGZ1bmN0aW9ucyAtIHRoaXMgbWV0aG9kIG9mIHNvcnRpbmcgaXMgY29tcGxpbWVudGFyeSB0byB0aGUgZGVmYXVsdCB0eXBlCgkJICogYmFzZWQgc29ydGluZyB0aGF0IERhdGFUYWJsZXMgZG9lcyBhdXRvbWF0aWNhbGx5LCBhbGxvd2luZyBtdWNoIGdyZWF0ZXIgY29udHJvbCBvdmVyIHRoZQoJCSAqIHRoZSBkYXRhIHRoYXQgaXMgYmVpbmcgdXNlZCB0byBzb3J0IGEgY29sdW1uLiBUaGlzIGlzIHVzZWZ1bCBpZiB5b3Ugd2FudCB0byBkbyBzb3J0aW5nCgkJICogYmFzZWQgb24gbGl2ZSBkYXRhIChmb3IgZXhhbXBsZSB0aGUgY29udGVudHMgb2YgYW4gJ2lucHV0JyBlbGVtZW50KSByYXRoZXIgdGhhbiBqdXN0IHRoZQoJCSAqIHN0YXRpYyBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGtub3dzIG9mLiBUaGUgd2F5IHRoZXNlIHBsdWctaW5zIHdvcmsgaXMgdGhhdCB5b3UgY3JlYXRlCgkJICogYW4gYXJyYXkgb2YgdGhlIHZhbHVlcyB5b3Ugd2lzaCB0byBiZSBzb3J0ZWQgZm9yIHRoZSBjb2x1bW4gaW4gcXVlc3Rpb24gYW5kIHRoZW4gcmV0dXJuCgkJICogdGhhdCBhcnJheS4gV2hpY2ggcHJlLXNvcnRpbmcgZnVuY3Rpb24gaXMgcnVuIGhlcmUgZGVwZW5kcyBvbiB0aGUgc1NvcnREYXRhVHlwZSBwYXJhbWV0ZXIKCQkgKiB0aGF0IGlzIHVzZWQgZm9yIHRoZSBjb2x1bW4gKGlmIGFueSkuIFRoaXMgaXMgdGhlIGNvcm9sbGFyeSBvZiA8aT5vZm5TZWFyY2g8L2k+IGZvciBzb3J0IAoJCSAqIGRhdGEuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCSAgICAgKiAgICAgICAgIDxsaT57aW50fSBUYXJnZXQgY29sdW1uIGluZGV4PC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl9IERhdGEgZm9yIHRoZSBjb2x1bW4gdG8gYmUgc29ydGVkIHVwb248L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICAKCQkgKiBOb3RlIHRoYXQgYXMgb2YgdjEuOSwgaXQgaXMgdHlwaWNhbGx5IHByZWZlcmFibGUgdG8gdXNlIDxpPm1EYXRhPC9pPiB0byBwcmVwYXJlIGRhdGEgZm9yCgkJICogdGhlIGRpZmZlcmVudCB1c2VzIHRoYXQgRGF0YVRhYmxlcyBjYW4gcHV0IHRoZSBkYXRhIHRvLiBTcGVjaWZpY2FsbHkgPGk+bURhdGE8L2k+IHdoZW4KCQkgKiB1c2VkIGFzIGEgZnVuY3Rpb24gd2lsbCBnaXZlIHlvdSBhICd0eXBlJyAoc29ydGluZywgZmlsdGVyaW5nIGV0YykgdGhhdCB5b3UgY2FuIHVzZSB0byAKCQkgKiBwcmVwYXJlIHRoZSBkYXRhIGFzIHJlcXVpcmVkIGZvciB0aGUgZGlmZmVyZW50IHR5cGVzLiBBcyBzdWNoLCB0aGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXBkYXRpbmcgdGhlIGNhY2hlZCBzb3J0aW5nIGluZm9ybWF0aW9uIHdpdGggdXNlciBlbnRlcmVkIHZhbHVlcyBpbiBIVE1MIGlucHV0IGVsZW1lbnRzCgkJICogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5hZm5Tb3J0RGF0YVsnZG9tLXRleHQnXSA9IGZ1bmN0aW9uICggb1NldHRpbmdzLCBpQ29sdW1uICkKCQkgKiAgICB7CgkJICogICAgICB2YXIgYURhdGEgPSBbXTsKCQkgKiAgICAgICQoICd0ZDplcSgnK2lDb2x1bW4rJykgaW5wdXQnLCBvU2V0dGluZ3Mub0FwaS5fZm5HZXRUck5vZGVzKG9TZXR0aW5ncykgKS5lYWNoKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGFEYXRhLnB1c2goIHRoaXMudmFsdWUgKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIHJldHVybiBhRGF0YTsKCQkgKiAgICB9CgkJICovCgkJImFmblNvcnREYXRhIjogW10sCgkKCQoJCS8qKgoJCSAqIEZlYXR1cmUgcGx1Zy1pbnMgLSBUaGlzIGlzIGFuIGFycmF5IG9mIG9iamVjdHMgd2hpY2ggZGVzY3JpYmUgdGhlIGZlYXR1cmUgcGx1Zy1pbnMgdGhhdCBhcmUKCQkgKiBhdmFpbGFibGUgdG8gRGF0YVRhYmxlcy4gVGhlc2UgZmVhdHVyZSBwbHVnLWlucyBhcmUgYWNjZXNzaWJsZSB0aHJvdWdoIHRoZSBzRG9tIGluaXRpYWxpc2F0aW9uCgkJICogb3B0aW9uLiBBcyBzdWNoLCBlYWNoIGZlYXR1cmUgcGx1Zy1pbiBtdXN0IGRlc2NyaWJlIGEgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIHRvIGluaXRpYWxpc2UKCQkgKiBpdHNlbGYgKGZuSW5pdCksIGEgY2hhcmFjdGVyIHNvIHRoZSBmZWF0dXJlIGNhbiBiZSBlbmFibGVkIGJ5IHNEb20gKGNGZWF0dXJlKSBhbmQgdGhlIG5hbWUKCQkgKiBvZiB0aGUgZmVhdHVyZSAoc0ZlYXR1cmUpLiBUaHVzIHRoZSBvYmplY3RzIGF0dGFjaGVkIHRvIHRoaXMgbWV0aG9kIG11c3QgcHJvdmlkZToKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPntmdW5jdGlvbn0gZm5Jbml0IEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwbHVnLWluCgkJICogICAgICAgPHVsPgoJICAgICAqICAgICAgICAgPGxpPgoJICAgICAqICAgICAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntvYmplY3R9IERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0OiBzZWUge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfS48L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntub2RlfG51bGx9IFRoZSBlbGVtZW50IHdoaWNoIGNvbnRhaW5zIHlvdXIgZmVhdHVyZS4gTm90ZSB0aGF0IHRoZSByZXR1cm4KCQkgKiAgICAgICAgICAgICAgICBtYXkgYWxzbyBiZSB2b2lkIGlmIHlvdXIgcGx1Zy1pbiBkb2VzIG5vdCByZXF1aXJlIHRvIGluamVjdCBhbnkgRE9NIGVsZW1lbnRzIAoJCSAqICAgICAgICAgICAgICAgIGludG8gRGF0YVRhYmxlcyBjb250cm9sIChzRG9tKSAtIGZvciBleGFtcGxlIHRoaXMgbWlnaHQgYmUgdXNlZnVsIHdoZW4gCgkJICogICAgICAgICAgICAgICAgZGV2ZWxvcGluZyBhIHBsdWctaW4gd2hpY2ggYWxsb3dzIHRhYmxlIGNvbnRyb2wgdmlhIGtleWJvYXJkIGVudHJ5LjwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvbGk+CgkJICogICAgIDxsaT57Y2hhcmFjdGVyfSBjRmVhdHVyZSBDaGFyYWN0ZXIgdGhhdCB3aWxsIGJlIG1hdGNoZWQgaW4gc0RvbSAtIGNhc2Ugc2Vuc2l0aXZlPC9saT4KCQkgKiAgICAgPGxpPntzdHJpbmd9IHNGZWF0dXJlIEZlYXR1cmUgbmFtZTwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEhvdyBUYWJsZVRvb2xzIGluaXRpYWxpc2VzIGl0c2VsZi4KCQkgKiAgICAkLmZuLmRhdGFUYWJsZUV4dC5hb0ZlYXR1cmVzLnB1c2goIHsKCQkgKiAgICAgICJmbkluaXQiOiBmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCSAqICAgICAgICByZXR1cm4gbmV3IFRhYmxlVG9vbHMoIHsgIm9EVFNldHRpbmdzIjogb1NldHRpbmdzIH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAiY0ZlYXR1cmUiOiAiVCIsCgkJICogICAgICAic0ZlYXR1cmUiOiAiVGFibGVUb29scyIKCQkgKiAgICB9ICk7CgkJICovCgkJImFvRmVhdHVyZXMiOiBbXSwKCQoJCgkJLyoqCgkJICogVHlwZSBkZXRlY3Rpb24gcGx1Zy1pbiBmdW5jdGlvbnMgLSBEYXRhVGFibGVzIHV0aWxpc2VzIHR5cGVzIHRvIGRlZmluZSBob3cgc29ydGluZyBhbmQKCQkgKiBmaWx0ZXJpbmcgYmVoYXZlLCBhbmQgdHlwZXMgY2FuIGJlIGVpdGhlciAgYmUgZGVmaW5lZCBieSB0aGUgZGV2ZWxvcGVyIChzVHlwZSBmb3IgdGhlCgkJICogY29sdW1uKSBvciB0aGV5IGNhbiBiZSBhdXRvbWF0aWNhbGx5IGRldGVjdGVkIGJ5IHRoZSBtZXRob2RzIGluIHRoaXMgYXJyYXkuIFRoZSBmdW5jdGlvbnMKCQkgKiBkZWZpbmVkIGluIHRoZSBhcnJheSBhcmUgcXVpdGUgc2ltcGxlLCB0YWtpbmcgYSBzaW5nbGUgcGFyYW1ldGVyICh0aGUgZGF0YSB0byBhbmFseXNlKSAKCQkgKiBhbmQgcmV0dXJuaW5nIHRoZSB0eXBlIGlmIGl0IGlzIGEga25vd24gdHlwZSwgb3IgbnVsbCBvdGhlcndpc2UuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSBmcm9tIHRoZSBjb2x1bW4gY2VsbCB0byBiZSBhbmFseXNlZDwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e3N0cmluZ3xudWxsfSBEYXRhIHR5cGUgZGV0ZWN0ZWQsIG9yIG51bGwgaWYgdW5rbm93biAoYW5kIHRodXMgcGFzcyBpdAoJCSAqICAgICAgICAgICBvbiB0byB0aGUgb3RoZXIgdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEN1cnJlbmN5IHR5cGUgZGV0ZWN0aW9uIHBsdWctaW46CgkJICogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5hVHlwZXMucHVzaCgKCQkgKiAgICAgIGZ1bmN0aW9uICggc0RhdGEgKSB7CgkJICogICAgICAgIHZhciBzVmFsaWRDaGFycyA9ICIwMTIzNDU2Nzg5Li0iOwoJCSAqICAgICAgICB2YXIgQ2hhcjsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIENoZWNrIHRoZSBudW1lcmljIHBhcnQKCQkgKiAgICAgICAgZm9yICggaT0xIDsgaTxzRGF0YS5sZW5ndGggOyBpKysgKSB7CgkJICogICAgICAgICAgQ2hhciA9IHNEYXRhLmNoYXJBdChpKTsgCgkJICogICAgICAgICAgaWYgKHNWYWxpZENoYXJzLmluZGV4T2YoQ2hhcikgPT0gLTEpIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBudWxsOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gQ2hlY2sgcHJlZml4ZWQgYnkgY3VycmVuY3kKCQkgKiAgICAgICAgaWYgKCBzRGF0YS5jaGFyQXQoMCkgPT0gJyQnIHx8IHNEYXRhLmNoYXJBdCgwKSA9PSAnJnBvdW5kOycgKSB7CgkJICogICAgICAgICAgcmV0dXJuICdjdXJyZW5jeSc7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgcmV0dXJuIG51bGw7CgkJICogICAgICB9CgkJICogICAgKTsKCQkgKi8KCQkiYVR5cGVzIjogW10sCgkKCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIAoJCSAqIGluIG9yZGVyIHRvIGVuc3VyZSBjb21wYXRpYmlsaXR5LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZlcnNpb24gVmVyc2lvbiBzdHJpbmcgdG8gY2hlY2sgZm9yLCBpbiB0aGUgZm9ybWF0ICJYLlkuWiIuIE5vdGUgCgkJICogICAgdGhhdCB0aGUgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIAoJCSAqICAgIHJlcXVpcmVkIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgYWxlcnQoIG9UYWJsZS5mblZlcnNpb25DaGVjayggJzEuOS4wJyApICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblZlcnNpb25DaGVjayI6IERhdGFUYWJsZS5mblZlcnNpb25DaGVjaywKCQoJCgkJLyoqCgkJICogSW5kZXggZm9yIHdoYXQgJ3RoaXMnIGluZGV4IEFQSSBmdW5jdGlvbnMgc2hvdWxkIHVzZQoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJpQXBpSW5kZXgiOiAwLAoJCgkKCQkvKioKCQkgKiBQcmUtcHJvY2Vzc2luZyBvZiBmaWx0ZXJpbmcgZGF0YSBwbHVnLWlucyAtIFdoZW4geW91IGFzc2lnbiB0aGUgc1R5cGUgZm9yIGEgY29sdW1uCgkJICogKG9yIGhhdmUgaXQgYXV0b21hdGljYWxseSBkZXRlY3RlZCBmb3IgeW91IGJ5IERhdGFUYWJsZXMgb3IgYSB0eXBlIGRldGVjdGlvbiBwbHVnLWluKSwgCgkJICogeW91IHdpbGwgdHlwaWNhbGx5IGJlIHVzaW5nIHRoaXMgZm9yIGN1c3RvbSBzb3J0aW5nLCBidXQgaXQgY2FuIGFsc28gYmUgdXNlZCB0byBwcm92aWRlIAoJCSAqIGN1c3RvbSBmaWx0ZXJpbmcgYnkgYWxsb3dpbmcgeW91IHRvIHByZS1wcm9jZXNzaW5nIHRoZSBkYXRhIGFuZCByZXR1cm5pbmcgdGhlIGRhdGEgaW4KCQkgKiB0aGUgZm9ybWF0IHRoYXQgc2hvdWxkIGJlIGZpbHRlcmVkIHVwb24uIFRoaXMgaXMgZG9uZSBieSBhZGRpbmcgZnVuY3Rpb25zIHRoaXMgb2JqZWN0IAoJCSAqIHdpdGggYSBwYXJhbWV0ZXIgbmFtZSB3aGljaCBtYXRjaGVzIHRoZSBzVHlwZSBmb3IgdGhhdCB0YXJnZXQgY29sdW1uLiBUaGlzIGlzIHRoZQoJCSAqIGNvcm9sbGFyeSBvZiA8aT5hZm5Tb3J0RGF0YTwvaT4gZm9yIGZpbHRlcmluZyBkYXRhLgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+eyp9IERhdGEgZnJvbSB0aGUgY29sdW1uIGNlbGwgdG8gYmUgcHJlcGFyZWQgZm9yIGZpbHRlcmluZzwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e3N0cmluZ3xudWxsfSBGb3JtYXR0ZWQgc3RyaW5nIHRoYXQgd2lsbCBiZSB1c2VkIGZvciB0aGUgZmlsdGVyaW5nLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogCgkJICogTm90ZSB0aGF0IGFzIG9mIHYxLjksIGl0IGlzIHR5cGljYWxseSBwcmVmZXJhYmxlIHRvIHVzZSA8aT5tRGF0YTwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhPC9pPiB3aGVuCgkJICogdXNlZCBhcyBhIGZ1bmN0aW9uIHdpbGwgZ2l2ZSB5b3UgYSAndHlwZScgKHNvcnRpbmcsIGZpbHRlcmluZyBldGMpIHRoYXQgeW91IGNhbiB1c2UgdG8gCgkJICogcHJlcGFyZSB0aGUgZGF0YSBhcyByZXF1aXJlZCBmb3IgdGhlIGRpZmZlcmVudCB0eXBlcy4gQXMgc3VjaCwgdGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZC4KCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICogIEBkZXByZWNhdGVkCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkLmZuLmRhdGFUYWJsZUV4dC5vZm5TZWFyY2hbJ3RpdGxlLW51bWVyaWMnXSA9IGZ1bmN0aW9uICggc0RhdGEgKSB7CgkJICogICAgICByZXR1cm4gc0RhdGEucmVwbGFjZSgvXG4vZywiICIpLnJlcGxhY2UoIC88Lio/Pi9nLCAiIiApOwoJCSAqICAgIH0KCQkgKi8KCQkib2ZuU2VhcmNoIjoge30sCgkKCQoJCS8qKgoJCSAqIENvbnRhaW5lciBmb3IgYWxsIHByaXZhdGUgZnVuY3Rpb25zIGluIERhdGFUYWJsZXMgc28gdGhleSBjYW4gYmUgZXhwb3NlZCBleHRlcm5hbGx5CgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvQXBpIjoge30sCgkKCQoJCS8qKgoJCSAqIFN0b3JhZ2UgZm9yIHRoZSB2YXJpb3VzIGNsYXNzZXMgdGhhdCBEYXRhVGFibGVzIHVzZXMKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICovCgkJIm9TdGRDbGFzc2VzIjoge30sCgkJCgkKCQkvKioKCQkgKiBTdG9yYWdlIGZvciB0aGUgdmFyaW91cyBjbGFzc2VzIHRoYXQgRGF0YVRhYmxlcyB1c2VzIC0galF1ZXJ5IFVJIHN1aXRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvSlVJQ2xhc3NlcyI6IHt9LAoJCgkKCQkvKioKCQkgKiBQYWdpbmF0aW9uIHBsdWctaW4gbWV0aG9kcyAtIFRoZSBzdHlsZSBhbmQgY29udHJvbHMgb2YgdGhlIHBhZ2luYXRpb24gY2FuIHNpZ25pZmljYW50bHkgCgkJICogaW1wYWN0IG9uIGhvdyB0aGUgZW5kIHVzZXIgaW50ZXJhY3RzIHdpdGggdGhlIGRhdGEgaW4geW91ciB0YWJsZSwgYW5kIERhdGFUYWJsZXMgYWxsb3dzIAoJCSAqIHRoZSBhZGRpdGlvbiBvZiBwYWdpbmF0aW9uIGNvbnRyb2xzIGJ5IGV4dGVuZGluZyB0aGlzIG9iamVjdCwgd2hpY2ggY2FuIHRoZW4gYmUgZW5hYmxlZAoJCSAqIHRocm91Z2ggdGhlIDxpPnNQYWdpbmF0aW9uVHlwZTwvaT4gaW5pdGlhbGlzYXRpb24gcGFyYW1ldGVyLiBFYWNoIHBhZ2luYXRpb24gdHlwZSB0aGF0CgkJICogaXMgYWRkZWQgaXMgYW4gb2JqZWN0ICh0aGUgcHJvcGVydHkgbmFtZSBvZiB3aGljaCBpcyB3aGF0IDxpPnNQYWdpbmF0aW9uVHlwZTwvaT4gcmVmZXJzCgkJICogdG8pIHRoYXQgaGFzIHR3byBwcm9wZXJ0aWVzLCBib3RoIG1ldGhvZHMgdGhhdCBhcmUgdXNlZCBieSBEYXRhVGFibGVzIHRvIHVwZGF0ZSB0aGUKCQkgKiBjb250cm9sJ3Mgc3RhdGUuCgkJICogICA8dWw+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBmbkluaXQgLSAgSW5pdGlhbGlzYXRpb24gb2YgdGhlIHBhZ2luZyBjb250cm9scy4gQ2FsbGVkIG9ubHkgZHVyaW5nIGluaXRpYWxpc2F0aW9uIAoJCSAqICAgICAgICAgb2YgdGhlIHRhYmxlLiBJdCBpcyBleHBlY3RlZCB0aGF0IHRoaXMgZnVuY3Rpb24gd2lsbCBhZGQgdGhlIHJlcXVpcmVkIERPTSBlbGVtZW50cyAKCQkgKiAgICAgICAgIHRvIHRoZSBwYWdlIGZvciB0aGUgcGFnaW5nIGNvbnRyb2xzIHRvIHdvcmsuIFRoZSBlbGVtZW50IHBvaW50ZXIgCgkJICogICAgICAgICAnb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAnIGFycmF5IGlzIHByb3ZpZGVkIGJ5IERhdGFUYWJsZXMgdG8gY29udGFpbiB0aGUgcGFnaW5nIAoJCSAqICAgICAgICAgY29udHJvbHMgKG5vdGUgdGhhdCB0aGlzIGlzIGEgMkQgYXJyYXkgdG8gYWxsb3cgZm9yIG11bHRpcGxlIGluc3RhbmNlcyBvZiBlYWNoIAoJCSAqICAgICAgICAgRGF0YVRhYmxlcyBET00gZWxlbWVudCkuIEl0IGlzIHN1Z2dlc3RlZCB0aGF0IHlvdSBhZGQgdGhlIGNvbnRyb2xzIHRvIHRoaXMgZWxlbWVudCAKCQkgKiAgICAgICAgIGFzIGNoaWxkcmVuCgkJICogICAgICAgPHVsPgoJICAgICAqICAgICAgICAgPGxpPgoJICAgICAqICAgICAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntvYmplY3R9IERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0OiBzZWUge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfS48L2xpPgoJCSAqICAgICAgICAgICAgIDxsaT57bm9kZX0gQ29udGFpbmVyIGludG8gd2hpY2ggdGhlIHBhZ2luYXRpb24gY29udHJvbHMgbXVzdCBiZSBpbnNlcnRlZDwvbGk+CgkJICogICAgICAgICAgICAgPGxpPntmdW5jdGlvbn0gRHJhdyBjYWxsYmFjayBmdW5jdGlvbiAtIHdoZW5ldmVyIHRoZSBjb250cm9scyBjYXVzZSBhIHBhZ2UKCQkgKiAgICAgICAgICAgICAgIGNoYW5nZSwgdGhpcyBtZXRob2QgbXVzdCBiZSBjYWxsZWQgdG8gcmVkcmF3IHRoZSB0YWJsZS48L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPk5vIHJldHVybiByZXF1aXJlZDwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBmbkluaXQgLSAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIgdGhlIHBhZ2luZyBzdGF0dXMgb2YgdGhlIHRhYmxlIGNoYW5nZXMgYW5kIGlzCgkJICogICAgICAgICB0eXBpY2FsbHkgdXNlZCB0byB1cGRhdGUgY2xhc3NlcyBhbmQvb3IgdGV4dCBvZiB0aGUgcGFnaW5nIGNvbnRyb2xzIHRvIHJlZmxleCB0aGUgbmV3IAoJCSAqICAgICAgICAgc3RhdHVzLgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgICAgICA8bGk+e2Z1bmN0aW9ufSBEcmF3IGNhbGxiYWNrIGZ1bmN0aW9uIC0gaW4gY2FzZSB5b3UgbmVlZCB0byByZWRyYXcgdGhlIHRhYmxlIGFnYWluCgkJICogICAgICAgICAgICAgICBvciBhdHRhY2ggbmV3IGV2ZW50IGxpc3RlbmVyczwvbGk+CgkgICAgICogICAgICAgICAgIDwvdWw+CgkgICAgICogICAgICAgICA8L2xpPgoJCSAqICAgICAgICAgPGxpPgoJCSAqICAgICAgICAgICBGdW5jdGlvbiByZXR1cm46CgkJICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+Tm8gcmV0dXJuIHJlcXVpcmVkPC9saT4KCQkgKiAgICAgICAgICAgPC91bD4KCQkgKiAgICAgICAgIDwvaWw+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24uZm91cl9idXR0b24gPSB7CgkJICogICAgICAiZm5Jbml0IjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIG5QYWdpbmcsIGZuQ2FsbGJhY2tEcmF3ICkgewoJCSAqICAgICAgICBuRmlyc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnc3BhbicgKTsKCQkgKiAgICAgICAgblByZXZpb3VzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5OZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5MYXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICBuRmlyc3QuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zRmlyc3QgKSApOwoJCSAqICAgICAgICBuUHJldmlvdXMuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zUHJldmlvdXMgKSApOwoJCSAqICAgICAgICBuTmV4dC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlLnNOZXh0ICkgKTsKCQkgKiAgICAgICAgbkxhc3QuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zTGFzdCApICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICBuRmlyc3QuY2xhc3NOYW1lID0gInBhZ2luYXRlX2J1dHRvbiBmaXJzdCI7CgkJICogICAgICAgIG5QcmV2aW91cy5jbGFzc05hbWUgPSAicGFnaW5hdGVfYnV0dG9uIHByZXZpb3VzIjsKCQkgKiAgICAgICAgbk5leHQuY2xhc3NOYW1lPSJwYWdpbmF0ZV9idXR0b24gbmV4dCI7CgkJICogICAgICAgIG5MYXN0LmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9idXR0b24gbGFzdCI7CgkJICogICAgICAgIAoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuRmlyc3QgKTsKCQkgKiAgICAgICAgblBhZ2luZy5hcHBlbmRDaGlsZCggblByZXZpb3VzICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5OZXh0ICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5MYXN0ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5GaXJzdCkuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgICBvU2V0dGluZ3Mub0FwaS5fZm5QYWdlQ2hhbmdlKCBvU2V0dGluZ3MsICJmaXJzdCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQoblByZXZpb3VzKS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAicHJldmlvdXMiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5OZXh0KS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAibmV4dCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQobkxhc3QpLmNsaWNrKCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICAgICBvU2V0dGluZ3Mub0FwaS5fZm5QYWdlQ2hhbmdlKCBvU2V0dGluZ3MsICJsYXN0IiApOwoJCSAqICAgICAgICAgIGZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkgKiAgICAgICAgfSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuRmlyc3QpLmJpbmQoICdzZWxlY3RzdGFydCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZhbHNlOyB9ICk7CgkJICogICAgICAgICQoblByZXZpb3VzKS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5OZXh0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5MYXN0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgfSwKCQkgKiAgICAgIAoJCSAqICAgICAgImZuVXBkYXRlIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGZuQ2FsbGJhY2tEcmF3ICkgewoJCSAqICAgICAgICBpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApIHsKCQkgKiAgICAgICAgICByZXR1cm47CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlcgoJCSAqICAgICAgICB2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucDsKCQkgKiAgICAgICAgZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKSB7CgkJICogICAgICAgICAgdmFyIGJ1dHRvbnMgPSBhbltpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3BhbicpOwoJCSAqICAgICAgICAgIGlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID09PSAwICkgewoJCSAqICAgICAgICAgICAgYnV0dG9uc1swXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1sxXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICBlbHNlIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMF0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1sxXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZW5hYmxlZF9wcmV2aW91cyI7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICAgIAoJCSAqICAgICAgICAgIGlmICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpID09IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKSB7CgkJICogICAgICAgICAgICBidXR0b25zWzJdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbM10uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX25leHQiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICBlbHNlIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMl0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfbmV4dCI7CgkJICogICAgICAgICAgICBidXR0b25zWzNdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgfQoJCSAqICAgIH07CgkJICovCgkJIm9QYWdpbmF0aW9uIjoge30sCgkKCQoJCS8qKgoJCSAqIFNvcnRpbmcgcGx1Zy1pbiBtZXRob2RzIC0gU29ydGluZyBpbiBEYXRhVGFibGVzIGlzIGJhc2VkIG9uIHRoZSBkZXRlY3RlZCB0eXBlIG9mIHRoZQoJCSAqIGRhdGEgY29sdW1uICh5b3UgY2FuIGFkZCB5b3VyIG93biB0eXBlIGRldGVjdGlvbiBmdW5jdGlvbnMsIG9yIG92ZXJyaWRlIGF1dG9tYXRpYyAKCQkgKiBkZXRlY3Rpb24gdXNpbmcgc1R5cGUpLiBXaXRoIHRoaXMgc3BlY2lmaWMgdHlwZSBnaXZlbiB0byB0aGUgY29sdW1uLCBEYXRhVGFibGVzIHdpbGwgCgkJICogYXBwbHkgdGhlIHJlcXVpcmVkIHNvcnQgZnJvbSB0aGUgZnVuY3Rpb25zIGluIHRoZSBvYmplY3QuIEVhY2ggc29ydCB0eXBlIG11c3QgcHJvdmlkZQoJCSAqIHR3byBtYW5kYXRvcnkgbWV0aG9kcywgb25lIGVhY2ggZm9yIGFzY2VuZGluZyBhbmQgZGVzY2VuZGluZyBzb3J0aW5nLCBhbmQgY2FuIG9wdGlvbmFsbHkKCQkgKiBwcm92aWRlIGEgcHJlLWZvcm1hdHRpbmcgbWV0aG9kIHRoYXQgd2lsbCBoZWxwIHNwZWVkIHVwIHNvcnRpbmcgYnkgYWxsb3dpbmcgRGF0YVRhYmxlcwoJCSAqIHRvIHByZS1mb3JtYXQgdGhlIHNvcnQgZGF0YSBvbmx5IG9uY2UgKHJhdGhlciB0aGFuIGV2ZXJ5IHRpbWUgdGhlIGFjdHVhbCBzb3J0IGZ1bmN0aW9ucwoJCSAqIGFyZSBydW4pLiBUaGUgdHdvIHNvcnRpbmcgZnVuY3Rpb25zIGFyZSB0eXBpY2FsIEphdmFzY3JpcHQgc29ydCBtZXRob2RzOgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+eyp9IERhdGEgdG8gY29tcGFyZSB0byB0aGUgc2Vjb25kIHBhcmFtZXRlcjwvbGk+CgkJICogICAgICAgICA8bGk+eyp9IERhdGEgdG8gY29tcGFyZSB0byB0aGUgZmlyc3QgcGFyYW1ldGVyPC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57aW50fSBTb3J0aW5nIG1hdGNoOiA8MCBpZiBmaXJzdCBwYXJhbWV0ZXIgc2hvdWxkIGJlIHNvcnRlZCBsb3dlciB0aGFuCgkJICogICAgICAgICAgIHRoZSBzZWNvbmQgcGFyYW1ldGVyLCA9PT0wIGlmIHRoZSB0d28gcGFyYW1ldGVycyBhcmUgZXF1YWwgYW5kID4wIGlmCgkJICogICAgICAgICAgIHRoZSBmaXJzdCBwYXJhbWV0ZXIgc2hvdWxkIGJlIHNvcnRlZCBoZWlnaHQgdGhhbiB0aGUgc2Vjb25kIHBhcmFtZXRlci48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIENhc2Utc2Vuc2l0aXZlIHN0cmluZyBzb3J0aW5nLCB3aXRoIG5vIHByZS1mb3JtYXR0aW5nIG1ldGhvZAoJCSAqICAgICQuZXh0ZW5kKCAkLmZuLmRhdGFUYWJsZUV4dC5vU29ydCwgewoJCSAqICAgICAgInN0cmluZy1jYXNlLWFzYyI6IGZ1bmN0aW9uKHgseSkgewoJCSAqICAgICAgICByZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAic3RyaW5nLWNhc2UtZGVzYyI6IGZ1bmN0aW9uKHgseSkgewoJCSAqICAgICAgICByZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQkgKiAgICAgIH0KCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDYXNlLWluc2Vuc2l0aXZlIHN0cmluZyBzb3J0aW5nLCB3aXRoIHByZS1mb3JtYXR0aW5nCgkJICogICAgJC5leHRlbmQoICQuZm4uZGF0YVRhYmxlRXh0Lm9Tb3J0LCB7CgkJICogICAgICAic3RyaW5nLXByZSI6IGZ1bmN0aW9uKHgpIHsKCQkgKiAgICAgICAgcmV0dXJuIHgudG9Mb3dlckNhc2UoKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAic3RyaW5nLWFzYyI6IGZ1bmN0aW9uKHgseSkgewoJCSAqICAgICAgICByZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAic3RyaW5nLWRlc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJICogICAgICB9CgkJICogICAgfSApOwoJCSAqLwoJCSJvU29ydCI6IHt9LAoJCgkKCQkvKioKCQkgKiBWZXJzaW9uIHN0cmluZyBmb3IgcGx1Zy1pbnMgdG8gY2hlY2sgY29tcGF0aWJpbGl0eS4gQWxsb3dlZCBmb3JtYXQgaXMKCQkgKiBhLmIuYy5kLmUgd2hlcmU6IGE6aW50LCBiOmludCwgYzppbnQsIGQ6c3RyaW5nKGRldnxiZXRhKSwgZTppbnQuIGQgYW5kCgkJICogZSBhcmUgb3B0aW9uYWwKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IFZlcnNpb24gbnVtYmVyCgkJICovCgkJInNWZXJzaW9uIjogRGF0YVRhYmxlLnZlcnNpb24sCgkKCQoJCS8qKgoJCSAqIEhvdyBzaG91bGQgRGF0YVRhYmxlcyByZXBvcnQgYW4gZXJyb3IuIENhbiB0YWtlIHRoZSB2YWx1ZSAnYWxlcnQnIG9yICd0aHJvdycKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGFsZXJ0CgkJICovCgkJInNFcnJNb2RlIjogImFsZXJ0IiwKCQoJCgkJLyoqCgkJICogU3RvcmUgaW5mb3JtYXRpb24gZm9yIERhdGFUYWJsZXMgdG8gYWNjZXNzIGdsb2JhbGx5IGFib3V0IG90aGVyIGluc3RhbmNlcwoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9vRXh0ZXJuQ29uZmlnIjogewoJCQkvKiBpbnQ6aU5leHRVbmlxdWUgLSBuZXh0IHVuaXF1ZSBudW1iZXIgZm9yIGFuIGluc3RhbmNlICovCgkJCSJpTmV4dFVuaXF1ZSI6IDAKCQl9Cgl9OwoJCgkKCQoJCgkvKioKCSAqIFRlbXBsYXRlIG9iamVjdCBmb3IgdGhlIHdheSBpbiB3aGljaCBEYXRhVGFibGVzIGhvbGRzIGluZm9ybWF0aW9uIGFib3V0CgkgKiBzZWFyY2ggaW5mb3JtYXRpb24gZm9yIHRoZSBnbG9iYWwgZmlsdGVyIGFuZCBpbmRpdmlkdWFsIGNvbHVtbiBmaWx0ZXJzLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoID0gewoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgdGhlIGZpbHRlcmluZyBzaG91bGQgYmUgY2FzZSBpbnNlbnNpdGl2ZSBvciBub3QKCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICovCgkJImJDYXNlSW5zZW5zaXRpdmUiOiB0cnVlLAoJCgkJLyoqCgkJICogQXBwbGllZCBzZWFyY2ggdGVybQoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqLwoJCSJzU2VhcmNoIjogIiIsCgkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBzZWFyY2ggdGVybSBzaG91bGQgYmUgaW50ZXJwcmV0ZWQgYXMgYQoJCSAqIHJlZ3VsYXIgZXhwcmVzc2lvbiAodHJ1ZSkgb3Igbm90IChmYWxzZSkgYW5kIHRoZXJlZm9yZSBhbmQgc3BlY2lhbAoJCSAqIHJlZ2V4IGNoYXJhY3RlcnMgZXNjYXBlZC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCSJiUmVnZXgiOiBmYWxzZSwKCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgRGF0YVRhYmxlcyBpcyB0byB1c2UgaXRzIHNtYXJ0IGZpbHRlcmluZyBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiU21hcnQiOiB0cnVlCgl9OwoJCgkKCQoJCgkvKioKCSAqIFRlbXBsYXRlIG9iamVjdCBmb3IgdGhlIHdheSBpbiB3aGljaCBEYXRhVGFibGVzIGhvbGRzIGluZm9ybWF0aW9uIGFib3V0CgkgKiBlYWNoIGluZGl2aWR1YWwgcm93LiBUaGlzIGlzIHRoZSBvYmplY3QgZm9ybWF0IHVzZWQgZm9yIHRoZSBzZXR0aW5ncyAKCSAqIGFvRGF0YSBhcnJheS4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1JvdyA9IHsKCQkvKioKCQkgKiBUUiBlbGVtZW50IGZvciB0aGUgcm93CgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVHIiOiBudWxsLAoJCgkJLyoqCgkJICogRGF0YSBvYmplY3QgZnJvbSB0aGUgb3JpZ2luYWwgZGF0YSBzb3VyY2UgZm9yIHRoZSByb3cuIFRoaXMgaXMgZWl0aGVyCgkJICogYW4gYXJyYXkgaWYgdXNpbmcgdGhlIHRyYWRpdGlvbmFsIGZvcm0gb2YgRGF0YVRhYmxlcywgb3IgYW4gb2JqZWN0IGlmCgkJICogdXNpbmcgbURhdGEgb3B0aW9ucy4gVGhlIGV4YWN0IHR5cGUgd2lsbCBkZXBlbmQgb24gdGhlIHBhc3NlZCBpbgoJCSAqIGRhdGEgZnJvbSB0aGUgZGF0YSBzb3VyY2UsIG9yIHdpbGwgYmUgYW4gYXJyYXkgaWYgdXNpbmcgRE9NIGEgZGF0YSAKCQkgKiBzb3VyY2UuCgkJICogIEB0eXBlIGFycmF5fG9iamVjdAoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJfYURhdGEiOiBbXSwKCQoJCS8qKgoJCSAqIFNvcnRpbmcgZGF0YSBjYWNoZSAtIHRoaXMgYXJyYXkgaXMgb3N0ZW5zaWJseSB0aGUgc2FtZSBsZW5ndGggYXMgdGhlCgkJICogbnVtYmVyIG9mIGNvbHVtbnMgKGFsdGhvdWdoIGVhY2ggaW5kZXggaXMgZ2VuZXJhdGVkIG9ubHkgYXMgaXQgaXMgCgkJICogbmVlZGVkKSwgYW5kIGhvbGRzIHRoZSBkYXRhIHRoYXQgaXMgdXNlZCBmb3Igc29ydGluZyBlYWNoIGNvbHVtbiBpbiB0aGUKCQkgKiByb3cuIFdlIGRvIHRoaXMgY2FjaGUgZ2VuZXJhdGlvbiBhdCB0aGUgc3RhcnQgb2YgdGhlIHNvcnQgaW4gb3JkZXIgdGhhdAoJCSAqIHRoZSBmb3JtYXR0aW5nIG9mIHRoZSBzb3J0IGRhdGEgbmVlZCBiZSBkb25lIG9ubHkgb25jZSBmb3IgZWFjaCBjZWxsCgkJICogcGVyIHNvcnQuIFRoaXMgYXJyYXkgc2hvdWxkIG5vdCBiZSByZWFkIGZyb20gb3Igd3JpdHRlbiB0byBieSBhbnl0aGluZwoJCSAqIG90aGVyIHRoYW4gdGhlIG1hc3RlciBzb3J0aW5nIG1ldGhvZHMuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9hU29ydERhdGEiOiBbXSwKCQoJCS8qKgoJCSAqIEFycmF5IG9mIFREIGVsZW1lbnRzIHRoYXQgYXJlIGNhY2hlZCBmb3IgaGlkZGVuIHJvd3MsIHNvIHRoZXkgY2FuIGJlCgkJICogcmVpbnNlcnRlZCBpbnRvIHRoZSB0YWJsZSBpZiBhIGNvbHVtbiBpcyBtYWRlIHZpc2libGUgYWdhaW4gKG9yIHRvIGFjdAoJCSAqIGFzIGEgc3RvcmUgaWYgYSBjb2x1bW4gaXMgbWFkZSBoaWRkZW4pLiBPbmx5IGhpZGRlbiBjb2x1bW5zIGhhdmUgYSAKCQkgKiByZWZlcmVuY2UgaW4gdGhlIGFycmF5LiBGb3Igbm9uLWhpZGRlbiBjb2x1bW5zIHRoZSB2YWx1ZSBpcyBlaXRoZXIKCQkgKiB1bmRlZmluZWQgb3IgbnVsbC4KCQkgKiAgQHR5cGUgYXJyYXkgbm9kZXMKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2FuSGlkZGVuIjogW10sCgkKCQkvKioKCQkgKiBDYWNoZSBvZiB0aGUgY2xhc3MgbmFtZSB0aGF0IERhdGFUYWJsZXMgaGFzIGFwcGxpZWQgdG8gdGhlIHJvdywgc28gd2UKCQkgKiBjYW4gcXVpY2tseSBsb29rIGF0IHRoaXMgdmFyaWFibGUgcmF0aGVyIHRoYW4gbmVlZGluZyB0byBkbyBhIERPTSBjaGVjawoJCSAqIG9uIGNsYXNzTmFtZSBmb3IgdGhlIG5UciBwcm9wZXJ0eS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX3NSb3dTdHJpcGUiOiAiIgoJfTsKCQoJCgkKCS8qKgoJICogVGVtcGxhdGUgb2JqZWN0IGZvciB0aGUgY29sdW1uIGluZm9ybWF0aW9uIG9iamVjdCBpbiBEYXRhVGFibGVzLiBUaGlzIG9iamVjdAoJICogaXMgaGVsZCBpbiB0aGUgc2V0dGluZ3MgYW9Db2x1bW5zIGFycmF5IGFuZCBjb250YWlucyBhbGwgdGhlIGluZm9ybWF0aW9uIHRoYXQKCSAqIERhdGFUYWJsZXMgbmVlZHMgYWJvdXQgZWFjaCBpbmRpdmlkdWFsIGNvbHVtbi4KCSAqIAoJICogTm90ZSB0aGF0IHRoaXMgb2JqZWN0IGlzIHJlbGF0ZWQgdG8ge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zfSAKCSAqIGJ1dCB0aGlzIG9uZSBpcyB0aGUgaW50ZXJuYWwgZGF0YSBzdG9yZSBmb3IgRGF0YVRhYmxlcydzIGNhY2hlIG9mIGNvbHVtbnMuCgkgKiBJdCBzaG91bGQgTk9UIGJlIG1hbmlwdWxhdGVkIG91dHNpZGUgb2YgRGF0YVRhYmxlcy4gQW55IGNvbmZpZ3VyYXRpb24gc2hvdWxkCgkgKiBiZSBkb25lIHRocm91Z2ggdGhlIGluaXRpYWxpc2F0aW9uIG9wdGlvbnMuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzLm9Db2x1bW4gPSB7CgkJLyoqCgkJICogQSBsaXN0IG9mIHRoZSBjb2x1bW5zIHRoYXQgc29ydGluZyBzaG91bGQgb2NjdXIgb24gd2hlbiB0aGlzIGNvbHVtbgoJCSAqIGlzIHNvcnRlZC4gVGhhdCB0aGlzIHByb3BlcnR5IGlzIGFuIGFycmF5IGFsbG93cyBtdWx0aS1jb2x1bW4gc29ydGluZwoJCSAqIHRvIGJlIGRlZmluZWQgZm9yIGEgY29sdW1uIChmb3IgZXhhbXBsZSBmaXJzdCBuYW1lIC8gbGFzdCBuYW1lIGNvbHVtbnMKCQkgKiB3b3VsZCBiZW5lZml0IGZyb20gdGhpcykuIFRoZSB2YWx1ZXMgYXJlIGludGVnZXJzIHBvaW50aW5nIHRvIHRoZQoJCSAqIGNvbHVtbnMgdG8gYmUgc29ydGVkIG9uICh0eXBpY2FsbHkgaXQgd2lsbCBiZSBhIHNpbmdsZSBpbnRlZ2VyIHBvaW50aW5nCgkJICogYXQgaXRzZWxmLCBidXQgdGhhdCBkb2Vzbid0IG5lZWQgdG8gYmUgdGhlIGNhc2UpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqLwoJCSJhRGF0YVNvcnQiOiBudWxsLAoJCgkJLyoqCgkJICogRGVmaW5lIHRoZSBzb3J0aW5nIGRpcmVjdGlvbnMgdGhhdCBhcmUgYXBwbGllZCB0byB0aGUgY29sdW1uLCBpbiBzZXF1ZW5jZQoJCSAqIGFzIHRoZSBjb2x1bW4gaXMgcmVwZWF0ZWRseSBzb3J0ZWQgdXBvbiAtIGkuZS4gdGhlIGZpcnN0IHZhbHVlIGlzIHVzZWQKCQkgKiBhcyB0aGUgc29ydGluZyBkaXJlY3Rpb24gd2hlbiB0aGUgY29sdW1uIGlmIGZpcnN0IHNvcnRlZCAoY2xpY2tlZCBvbikuCgkJICogU29ydCBpdCBhZ2FpbiAoY2xpY2sgYWdhaW4pIGFuZCBpdCB3aWxsIG1vdmUgb24gdG8gdGhlIG5leHQgaW5kZXguCgkJICogUmVwZWF0IHVudGlsIGxvb3AuCgkJICogIEB0eXBlIGFycmF5CgkJICovCgkJImFzU29ydGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgY29sdW1uIGlzIHNlYXJjaGFibGUsIGFuZCB0aHVzIHNob3VsZCBiZSBpbmNsdWRlZAoJCSAqIGluIHRoZSBmaWx0ZXJpbmcgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJTZWFyY2hhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgc29ydGFibGUgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJTb3J0YWJsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogPGNvZGU+RGVwcmVjYXRlZDwvY29kZT4gV2hlbiB1c2luZyBmblJlbmRlciwgeW91IGhhdmUgdHdvIG9wdGlvbnMgZm9yIHdoYXQgCgkJICogdG8gZG8gd2l0aCB0aGUgZGF0YSwgYW5kIHRoaXMgcHJvcGVydHkgc2VydmVzIGFzIHRoZSBzd2l0Y2guIEZpcnN0bHksIHlvdSAKCQkgKiBjYW4gaGF2ZSB0aGUgc29ydGluZyBhbmQgZmlsdGVyaW5nIHVzZSB0aGUgcmVuZGVyZWQgdmFsdWUgKHRydWUgLSBkZWZhdWx0KSwgCgkJICogb3IgeW91IGNhbiBoYXZlIHRoZSBzb3J0aW5nIGFuZCBmaWx0ZXJpbmcgdXMgdGhlIG9yaWdpbmFsIHZhbHVlIChmYWxzZSkuCgkJICoKCQkgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgb3B0aW9uIGhhcyBub3cgYmVlbiBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQKCQkgKiBpbiB0aGUgbmV4dCB2ZXJzaW9uIG9mIERhdGFUYWJsZXMuIFBsZWFzZSB1c2UgbVJlbmRlciAvIG1EYXRhIHJhdGhlciB0aGFuCgkJICogZm5SZW5kZXIuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgY3VycmVudGx5IHZpc2libGUgaW4gdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJWaXNpYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIHRvIHRoZSB0eXBlIGRldGVjdGlvbiBtZXRob2QgaWYgdGhlIGF1dG9tYXRpYyB0eXBlCgkJICogZGV0ZWN0aW9uIHNob3VsZCBiZSB1c2VkLCBvciBpZiBhIGNvbHVtbiB0eXBlIChzVHlwZSkgaGFzIGJlZW4gc3BlY2lmaWVkCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYkF1dG9UeXBlIjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBtUmVuZGVyCgkJICogYWxsb3dpbmcgeW91IHRvIG1vZGlmeSB0aGUgRE9NIGVsZW1lbnQgKGFkZCBiYWNrZ3JvdW5kIGNvbG91ciBmb3IgZXhhbXBsZSkgd2hlbiB0aGUKCQkgKiBlbGVtZW50IGlzIGF2YWlsYWJsZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtlbGVtZW50fSBuVGQgVGhlIFREIG5vZGUgdGhhdCBoYXMgYmVlbiBjcmVhdGVkCgkJICogIEBwYXJhbSB7Kn0gc0RhdGEgVGhlIERhdGEgZm9yIHRoZSBjZWxsCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBmb3IgdGhlIHdob2xlIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBUaGUgcm93IGluZGV4IGZvciB0aGUgYW9EYXRhIGRhdGEgc3RvcmUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkNyZWF0ZWRDZWxsIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGdW5jdGlvbiB0byBnZXQgZGF0YSBmcm9tIGEgY2VsbCBpbiBhIGNvbHVtbi4gWW91IHNob3VsZCA8Yj5uZXZlcjwvYj4KCQkgKiBhY2Nlc3MgZGF0YSBkaXJlY3RseSB0aHJvdWdoIF9hRGF0YSBpbnRlcm5hbGx5IGluIERhdGFUYWJsZXMgLSBhbHdheXMgdXNlCgkJICogdGhlIG1ldGhvZCBhdHRhY2hlZCB0byB0aGlzIHByb3BlcnR5LiBJdCBhbGxvd3MgbURhdGEgdG8gZnVuY3Rpb24gYXMKCQkgKiByZXF1aXJlZC4gVGhpcyBmdW5jdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGFzc2lnbmVkIGJ5IHRoZSBjb2x1bW4gCgkJICogaW5pdGlhbGlzYXRpb24gbWV0aG9kCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBhcnJheS9vYmplY3QgZm9yIHRoZSBhcnJheSAKCQkgKiAgICAoaS5lLiBhb0RhdGFbXS5fYURhdGEpCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU3BlY2lmaWMgVGhlIHNwZWNpZmljIGRhdGEgdHlwZSB5b3Ugd2FudCB0byBnZXQgLSAKCQkgKiAgICAnZGlzcGxheScsICd0eXBlJyAnZmlsdGVyJyAnc29ydCcKCQkgKiAgQHJldHVybnMgeyp9IFRoZSBkYXRhIGZvciB0aGUgY2VsbCBmcm9tIHRoZSBnaXZlbiByb3cncyBkYXRhCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5HZXREYXRhIjogbnVsbCwKCQkKCQkvKioKCQkgKiA8Y29kZT5EZXByZWNhdGVkPC9jb2RlPiBDdXN0b20gZGlzcGxheSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIGZvciB0aGUgCgkJICogZGlzcGxheSBvZiBlYWNoIGNlbGwgaW4gdGhpcyBjb2x1bW4uCgkJICoKCQkgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgb3B0aW9uIGhhcyBub3cgYmVlbiBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQKCQkgKiBpbiB0aGUgbmV4dCB2ZXJzaW9uIG9mIERhdGFUYWJsZXMuIFBsZWFzZSB1c2UgbVJlbmRlciAvIG1EYXRhIHJhdGhlciB0aGFuCgkJICogZm5SZW5kZXIuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIE9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKCQkgKiAgQHBhcmFtIHtpbnR9ICAgIG8uaURhdGFSb3cgVGhlIHJvdyBpbiBhb0RhdGEKCQkgKiAgQHBhcmFtIHtpbnR9ICAgIG8uaURhdGFDb2x1bW4gVGhlIGNvbHVtbiBpbiBxdWVzdGlvbgoJCSAqICBAcGFyYW0ge2FycmF5fSAgby5hRGF0YSBUaGUgZGF0YSBmb3IgdGhlIHJvdyBpbiBxdWVzdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gby5vU2V0dGluZ3MgVGhlIHNldHRpbmdzIG9iamVjdCBmb3IgdGhpcyBEYXRhVGFibGVzIGluc3RhbmNlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImZuUmVuZGVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGdW5jdGlvbiB0byBzZXQgZGF0YSBmb3IgYSBjZWxsIGluIHRoZSBjb2x1bW4uIFlvdSBzaG91bGQgPGI+bmV2ZXI8L2I+IAoJCSAqIHNldCB0aGUgZGF0YSBkaXJlY3RseSB0byBfYURhdGEgaW50ZXJuYWxseSBpbiBEYXRhVGFibGVzIC0gYWx3YXlzIHVzZQoJCSAqIHRoaXMgbWV0aG9kLiBJdCBhbGxvd3MgbURhdGEgdG8gZnVuY3Rpb24gYXMgcmVxdWlyZWQuIFRoaXMgZnVuY3Rpb24KCQkgKiBpcyBhdXRvbWF0aWNhbGx5IGFzc2lnbmVkIGJ5IHRoZSBjb2x1bW4gaW5pdGlhbGlzYXRpb24gbWV0aG9kCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBhcnJheS9vYmplY3QgZm9yIHRoZSBhcnJheSAKCQkgKiAgICAoaS5lLiBhb0RhdGFbXS5fYURhdGEpCgkJICogIEBwYXJhbSB7Kn0gc1ZhbHVlIFZhbHVlIHRvIHNldAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuU2V0RGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogUHJvcGVydHkgdG8gcmVhZCB0aGUgdmFsdWUgZm9yIHRoZSBjZWxscyBpbiB0aGUgY29sdW1uIGZyb20gdGhlIGRhdGEgCgkJICogc291cmNlIGFycmF5IC8gb2JqZWN0LiBJZiBudWxsLCB0aGVuIHRoZSBkZWZhdWx0IGNvbnRlbnQgaXMgdXNlZCwgaWYgYQoJCSAqIGZ1bmN0aW9uIGlzIGdpdmVuIHRoZW4gdGhlIHJldHVybiBmcm9tIHRoZSBmdW5jdGlvbiBpcyB1c2VkLgoJCSAqICBAdHlwZSBmdW5jdGlvbnxpbnR8c3RyaW5nfG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJtRGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogUGFydG5lciBwcm9wZXJ0eSB0byBtRGF0YSB3aGljaCBpcyB1c2VkIChvbmx5IHdoZW4gZGVmaW5lZCkgdG8gZ2V0CgkJICogdGhlIGRhdGEgLSBpLmUuIGl0IGlzIGJhc2ljYWxseSB0aGUgc2FtZSBhcyBtRGF0YSwgYnV0IHdpdGhvdXQgdGhlCgkJICogJ3NldCcgb3B0aW9uLCBhbmQgYWxzbyB0aGUgZGF0YSBmZWQgdG8gaXQgaXMgdGhlIHJlc3VsdCBmcm9tIG1EYXRhLgoJCSAqIFRoaXMgaXMgdGhlIHJlbmRlcmluZyBtZXRob2QgdG8gbWF0Y2ggdGhlIGRhdGEgbWV0aG9kIG9mIG1EYXRhLgoJCSAqICBAdHlwZSBmdW5jdGlvbnxpbnR8c3RyaW5nfG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJtUmVuZGVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBVbmlxdWUgaGVhZGVyIFRIL1REIGVsZW1lbnQgZm9yIHRoaXMgY29sdW1uIC0gdGhpcyBpcyB3aGF0IHRoZSBzb3J0aW5nCgkJICogbGlzdGVuZXIgaXMgYXR0YWNoZWQgdG8gKGlmIHNvcnRpbmcgaXMgZW5hYmxlZC4pCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVGgiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBmb290ZXIgVEgvVEQgZWxlbWVudCBmb3IgdGhpcyBjb2x1bW4gKGlmIHRoZXJlIGlzIG9uZSkuIE5vdCB1c2VkIAoJCSAqIGluIERhdGFUYWJsZXMgYXMgc3VjaCwgYnV0IGNhbiBiZSB1c2VkIGZvciBwbHVnLWlucyB0byByZWZlcmVuY2UgdGhlIAoJCSAqIGZvb3RlciBmb3IgZWFjaCBjb2x1bW4uCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVGYiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFRoZSBjbGFzcyB0byBhcHBseSB0byBhbGwgVEQgZWxlbWVudHMgaW4gdGhlIHRhYmxlJ3MgVEJPRFkgZm9yIHRoZSBjb2x1bW4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0NsYXNzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGVuIERhdGFUYWJsZXMgY2FsY3VsYXRlcyB0aGUgY29sdW1uIHdpZHRocyB0byBhc3NpZ24gdG8gZWFjaCBjb2x1bW4sCgkJICogaXQgZmluZHMgdGhlIGxvbmdlc3Qgc3RyaW5nIGluIGVhY2ggY29sdW1uIGFuZCB0aGVuIGNvbnN0cnVjdHMgYQoJCSAqIHRlbXBvcmFyeSB0YWJsZSBhbmQgcmVhZHMgdGhlIHdpZHRocyBmcm9tIHRoYXQuIFRoZSBwcm9ibGVtIHdpdGggdGhpcwoJCSAqIGlzIHRoYXQgIm1tbSIgaXMgbXVjaCB3aWRlciB0aGVuICJpaWlpIiwgYnV0IHRoZSBsYXR0ZXIgaXMgYSBsb25nZXIgCgkJICogc3RyaW5nIC0gdGh1cyB0aGUgY2FsY3VsYXRpb24gY2FuIGdvIHdyb25nIChkb2luZyBpdCBwcm9wZXJseSBhbmQgcHV0dGluZwoJCSAqIGl0IGludG8gYW4gRE9NIG9iamVjdCBhbmQgbWVhc3VyaW5nIHRoYXQgaXMgaG9ycmlibHkoISkgc2xvdykuIFRodXMgYXMKCQkgKiBhICJ3b3JrIGFyb3VuZCIgd2UgcHJvdmlkZSB0aGlzIG9wdGlvbi4gSXQgd2lsbCBhcHBlbmQgaXRzIHZhbHVlIHRvIHRoZQoJCSAqIHRleHQgdGhhdCBpcyBmb3VuZCB0byBiZSB0aGUgbG9uZ2VzdCBzdHJpbmcgZm9yIHRoZSBjb2x1bW4gLSBpLmUuIHBhZGRpbmcuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzQ29udGVudFBhZGRpbmciOiBudWxsLAoJCQoJCS8qKgoJCSAqIEFsbG93cyBhIGRlZmF1bHQgdmFsdWUgdG8gYmUgZ2l2ZW4gZm9yIGEgY29sdW1uJ3MgZGF0YSwgYW5kIHdpbGwgYmUgdXNlZAoJCSAqIHdoZW5ldmVyIGEgbnVsbCBkYXRhIHNvdXJjZSBpcyBlbmNvdW50ZXJlZCAodGhpcyBjYW4gYmUgYmVjYXVzZSBtRGF0YQoJCSAqIGlzIHNldCB0byBudWxsLCBvciBiZWNhdXNlIHRoZSBkYXRhIHNvdXJjZSBpdHNlbGYgaXMgbnVsbCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNEZWZhdWx0Q29udGVudCI6IG51bGwsCgkJCgkJLyoqCgkJICogTmFtZSBmb3IgdGhlIGNvbHVtbiwgYWxsb3dpbmcgcmVmZXJlbmNlIHRvIHRoZSBjb2x1bW4gYnkgbmFtZSBhcyB3ZWxsIGFzCgkJICogYnkgaW5kZXggKG5lZWRzIGEgbG9va3VwIHRvIHdvcmsgYnkgbmFtZSkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzTmFtZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ3VzdG9tIHNvcnRpbmcgZGF0YSB0eXBlIC0gZGVmaW5lcyB3aGljaCBvZiB0aGUgYXZhaWxhYmxlIHBsdWctaW5zIGluCgkJICogYWZuU29ydERhdGEgdGhlIGN1c3RvbSBzb3J0aW5nIHdpbGwgdXNlIC0gaWYgYW55IGlzIGRlZmluZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKi8KCQkic1NvcnREYXRhVHlwZSI6ICdzdGQnLAoJCQoJCS8qKgoJCSAqIENsYXNzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGhlYWRlciBlbGVtZW50IHdoZW4gc29ydGluZyBvbiB0aGlzIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzU29ydGluZ0NsYXNzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzcyB0byBiZSBhcHBsaWVkIHRvIHRoZSBoZWFkZXIgZWxlbWVudCB3aGVuIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4gLQoJCSAqIHdoZW4galF1ZXJ5IFVJIHRoZW1pbmcgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1NvcnRpbmdDbGFzc0pVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGl0bGUgb2YgdGhlIGNvbHVtbiAtIHdoYXQgaXMgc2VlbiBpbiB0aGUgVEggZWxlbWVudCAoblRoKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ29sdW1uIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB0eXBlCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNUeXBlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaWR0aCBvZiB0aGUgY29sdW1uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aCI6IG51bGwsCgkJCgkJLyoqCgkJICogV2lkdGggb2YgdGhlIGNvbHVtbiB3aGVuIGl0IHdhcyBmaXJzdCAiZW5jb3VudGVyZWQiCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aE9yaWciOiBudWxsCgl9OwoJCgkKCQoJLyoqCgkgKiBJbml0aWFsaXNhdGlvbiBvcHRpb25zIHRoYXQgY2FuIGJlIGdpdmVuIHRvIERhdGFUYWJsZXMgYXQgaW5pdGlhbGlzYXRpb24gCgkgKiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzID0gewoJCS8qKgoJCSAqIEFuIGFycmF5IG9mIGRhdGEgdG8gdXNlIGZvciB0aGUgdGFibGUsIHBhc3NlZCBpbiBhdCBpbml0aWFsaXNhdGlvbiB3aGljaCAKCQkgKiB3aWxsIGJlIHVzZWQgaW4gcHJlZmVyZW5jZSB0byBhbnkgZGF0YSB3aGljaCBpcyBhbHJlYWR5IGluIHRoZSBET00uIFRoaXMgaXMKCQkgKiBwYXJ0aWN1bGFybHkgdXNlZnVsIGZvciBjb25zdHJ1Y3RpbmcgdGFibGVzIHB1cmVseSBpbiBKYXZhc2NyaXB0LCBmb3IKCQkgKiBleGFtcGxlIHdpdGggYSBjdXN0b20gQWpheCBjYWxsLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhIDJEIGFycmF5IGRhdGEgc291cmNlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYURhdGEiOiBbCgkJICogICAgICAgICAgWydUcmlkZW50JywgJ0ludGVybmV0IEV4cGxvcmVyIDQuMCcsICdXaW4gOTUrJywgNCwgJ1gnXSwKCQkgKiAgICAgICAgICBbJ1RyaWRlbnQnLCAnSW50ZXJuZXQgRXhwbG9yZXIgNS4wJywgJ1dpbiA5NSsnLCA1LCAnQyddLAoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJHcmFkZSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFuIGFycmF5IG9mIG9iamVjdHMgYXMgYSBkYXRhIHNvdXJjZSAobURhdGEpCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYURhdGEiOiBbCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImVuZ2luZSI6ICAgIlRyaWRlbnQiLAoJCSAqICAgICAgICAgICAgImJyb3dzZXIiOiAgIkludGVybmV0IEV4cGxvcmVyIDQuMCIsCgkJICogICAgICAgICAgICAicGxhdGZvcm0iOiAiV2luIDk1KyIsCgkJICogICAgICAgICAgICAidmVyc2lvbiI6ICA0LAoJCSAqICAgICAgICAgICAgImdyYWRlIjogICAgIlgiCgkJICogICAgICAgICAgfSwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAiZW5naW5lIjogICAiVHJpZGVudCIsCgkJICogICAgICAgICAgICAiYnJvd3NlciI6ICAiSW50ZXJuZXQgRXhwbG9yZXIgNS4wIiwKCQkgKiAgICAgICAgICAgICJwbGF0Zm9ybSI6ICJXaW4gOTUrIiwKCQkgKiAgICAgICAgICAgICJ2ZXJzaW9uIjogIDUsCgkJICogICAgICAgICAgICAiZ3JhZGUiOiAgICAiQyIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0sCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkVuZ2luZSIsICAgIm1EYXRhIjogImVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiQnJvd3NlciIsICAibURhdGEiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiUGxhdGZvcm0iLCAibURhdGEiOiAicGxhdGZvcm0iIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlZlcnNpb24iLCAgIm1EYXRhIjogInZlcnNpb24iIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkdyYWRlIiwgICAgIm1EYXRhIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhRGF0YSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElmIHNvcnRpbmcgaXMgZW5hYmxlZCwgdGhlbiBEYXRhVGFibGVzIHdpbGwgcGVyZm9ybSBhIGZpcnN0IHBhc3Mgc29ydCBvbiAKCQkgKiBpbml0aWFsaXNhdGlvbi4gWW91IGNhbiBkZWZpbmUgd2hpY2ggY29sdW1uKHMpIHRoZSBzb3J0IGlzIHBlcmZvcm1lZCB1cG9uLCAKCQkgKiBhbmQgdGhlIHNvcnRpbmcgZGlyZWN0aW9uLCB3aXRoIHRoaXMgdmFyaWFibGUuIFRoZSBhYVNvcnRpbmcgYXJyYXkgc2hvdWxkIAoJCSAqIGNvbnRhaW4gYW4gYXJyYXkgZm9yIGVhY2ggY29sdW1uIHRvIGJlIHNvcnRlZCBpbml0aWFsbHkgY29udGFpbmluZyB0aGUgCgkJICogY29sdW1uJ3MgaW5kZXggYW5kIGEgZGlyZWN0aW9uIHN0cmluZyAoJ2FzYycgb3IgJ2Rlc2MnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW1swLCdhc2MnXV0KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNvcnQgYnkgM3JkIGNvbHVtbiBmaXJzdCwgYW5kIHRoZW4gNHRoIGNvbHVtbgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmciOiBbWzIsJ2FzYyddLCBbMywnZGVzYyddXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICAvLyBObyBpbml0aWFsIHNvcnRpbmcKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFTb3J0aW5nIjogW10KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhU29ydGluZyI6IFtbMCwnYXNjJ11dLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBpcyBiYXNpY2FsbHkgaWRlbnRpY2FsIHRvIHRoZSBhYVNvcnRpbmcgcGFyYW1ldGVyLCBidXQgCgkJICogY2Fubm90IGJlIG92ZXJyaWRkZW4gYnkgdXNlciBpbnRlcmFjdGlvbiB3aXRoIHRoZSB0YWJsZS4gV2hhdCB0aGlzIG1lYW5zIAoJCSAqIGlzIHRoYXQgeW91IGNvdWxkIGhhdmUgYSBjb2x1bW4gKHZpc2libGUgb3IgaGlkZGVuKSB3aGljaCB0aGUgc29ydGluZyB3aWxsIAoJCSAqIGFsd2F5cyBiZSBmb3JjZWQgb24gZmlyc3QgLSBhbnkgc29ydGluZyBhZnRlciB0aGF0IChmcm9tIHRoZSB1c2VyKSB3aWxsIAoJCSAqIHRoZW4gYmUgcGVyZm9ybWVkIGFzIHJlcXVpcmVkLiBUaGlzIGNhbiBiZSB1c2VmdWwgZm9yIGdyb3VwaW5nIHJvd3MgCgkJICogdG9nZXRoZXIuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmdGaXhlZCI6IFtbMCwnYXNjJ11dCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byByZWFkaWx5IHNwZWNpZnkgdGhlIGVudHJpZXMgaW4gdGhlIGxlbmd0aCBkcm9wCgkJICogZG93biBtZW51IHRoYXQgRGF0YVRhYmxlcyBzaG93cyB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4gSXQgY2FuIGJlIAoJCSAqIGVpdGhlciBhIDFEIGFycmF5IG9mIG9wdGlvbnMgd2hpY2ggd2lsbCBiZSB1c2VkIGZvciBib3RoIHRoZSBkaXNwbGF5ZWQgCgkJICogb3B0aW9uIGFuZCB0aGUgdmFsdWUsIG9yIGEgMkQgYXJyYXkgd2hpY2ggd2lsbCB1c2UgdGhlIGFycmF5IGluIHRoZSBmaXJzdCAKCQkgKiBwb3NpdGlvbiBhcyB0aGUgdmFsdWUsIGFuZCB0aGUgYXJyYXkgaW4gdGhlIHNlY29uZCBwb3NpdGlvbiBhcyB0aGUgCgkJICogZGlzcGxheWVkIG9wdGlvbnMgKHVzZWZ1bCBmb3IgbGFuZ3VhZ2Ugc3RyaW5ncyBzdWNoIGFzICdBbGwnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgWyAxMCwgMjUsIDUwLCAxMDAgXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFMZW5ndGhNZW51IjogW1sxMCwgMjUsIDUwLCAtMV0sIFsxMCwgMjUsIDUwLCAiQWxsIl1dCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBTZXR0aW5nIHRoZSBkZWZhdWx0IGRpc3BsYXkgbGVuZ3RoIGFzIHdlbGwgYXMgbGVuZ3RoIG1lbnUKCQkgKiAgICAvLyBUaGlzIGlzIGxpa2VseSB0byBiZSB3YW50ZWQgaWYgeW91IHJlbW92ZSB0aGUgJzEwJyBvcHRpb24gd2hpY2gKCQkgKiAgICAvLyBpcyB0aGUgaURpc3BsYXlMZW5ndGggZGVmYXVsdC4KCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiaURpc3BsYXlMZW5ndGgiOiAyNSwKCQkgKiAgICAgICAgImFMZW5ndGhNZW51IjogW1syNSwgNTAsIDEwMCwgLTFdLCBbMjUsIDUwLCAxMDAsICJBbGwiXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFMZW5ndGhNZW51IjogWyAxMCwgMjUsIDUwLCAxMDAgXSwKCQoJCgkJLyoqCgkJICogVGhlIGFvQ29sdW1ucyBvcHRpb24gaW4gdGhlIGluaXRpYWxpc2F0aW9uIHBhcmFtZXRlciBhbGxvd3MgeW91IHRvIGRlZmluZQoJCSAqIGRldGFpbHMgYWJvdXQgdGhlIHdheSBpbmRpdmlkdWFsIGNvbHVtbnMgYmVoYXZlLiBGb3IgYSBmdWxsIGxpc3Qgb2YKCQkgKiBjb2x1bW4gb3B0aW9ucyB0aGF0IGNhbiBiZSBzZXQsIHBsZWFzZSBzZWUgCgkJICoge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zfS4gTm90ZSB0aGF0IGlmIHlvdSB1c2UgYW9Db2x1bW5zIHRvCgkJICogZGVmaW5lIHlvdXIgY29sdW1ucywgeW91IG11c3QgaGF2ZSBhbiBlbnRyeSBpbiB0aGUgYXJyYXkgZm9yIGV2ZXJ5IHNpbmdsZQoJCSAqIGNvbHVtbiB0aGF0IHlvdSBoYXZlIGluIHlvdXIgdGFibGUgKHRoZXNlIGNhbiBiZSBudWxsIGlmIHlvdSBkb24ndCB3aGljaAoJCSAqIHRvIHNwZWNpZnkgYW55IG9wdGlvbnMpLgoJCSAqICBAbWVtYmVyCgkJICovCgkJImFvQ29sdW1ucyI6IG51bGwsCgkKCQkvKioKCQkgKiBWZXJ5IHNpbWlsYXIgdG8gYW9Db2x1bW5zLCBhb0NvbHVtbkRlZnMgYWxsb3dzIHlvdSB0byB0YXJnZXQgYSBzcGVjaWZpYyAKCQkgKiBjb2x1bW4sIG11bHRpcGxlIGNvbHVtbnMsIG9yIGFsbCBjb2x1bW5zLCB1c2luZyB0aGUgYVRhcmdldHMgcHJvcGVydHkgb2YgCgkJICogZWFjaCBvYmplY3QgaW4gdGhlIGFycmF5LiBUaGlzIGFsbG93cyBncmVhdCBmbGV4aWJpbGl0eSB3aGVuIGNyZWF0aW5nIAoJCSAqIHRhYmxlcywgYXMgdGhlIGFvQ29sdW1uRGVmcyBhcnJheXMgY2FuIGJlIG9mIGFueSBsZW5ndGgsIHRhcmdldGluZyB0aGUgCgkJICogY29sdW1ucyB5b3Ugc3BlY2lmaWNhbGx5IHdhbnQuIGFvQ29sdW1uRGVmcyBtYXkgdXNlIGFueSBvZiB0aGUgY29sdW1uIAoJCSAqIG9wdGlvbnMgYXZhaWxhYmxlOiB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnN9LCBidXQgaXQgX211c3RfCgkJICogaGF2ZSBhVGFyZ2V0cyBkZWZpbmVkIGluIGVhY2ggb2JqZWN0IGluIHRoZSBhcnJheS4gVmFsdWVzIGluIHRoZSBhVGFyZ2V0cwoJCSAqIGFycmF5IG1heSBiZToKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmEgc3RyaW5nIC0gY2xhc3MgbmFtZSB3aWxsIGJlIG1hdGNoZWQgb24gdGhlIFRIIGZvciB0aGUgY29sdW1uPC9saT4KCQkgKiAgICAgPGxpPjAgb3IgYSBwb3NpdGl2ZSBpbnRlZ2VyIC0gY29sdW1uIGluZGV4IGNvdW50aW5nIGZyb20gdGhlIGxlZnQ8L2xpPgoJCSAqICAgICA8bGk+YSBuZWdhdGl2ZSBpbnRlZ2VyIC0gY29sdW1uIGluZGV4IGNvdW50aW5nIGZyb20gdGhlIHJpZ2h0PC9saT4KCQkgKiAgICAgPGxpPnRoZSBzdHJpbmcgIl9hbGwiIC0gYWxsIGNvbHVtbnMgKGkuZS4gYXNzaWduIGEgZGVmYXVsdCk8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQG1lbWJlcgoJCSAqLwoJCSJhb0NvbHVtbkRlZnMiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBCYXNpY2FsbHkgdGhlIHNhbWUgYXMgb1NlYXJjaCwgdGhpcyBwYXJhbWV0ZXIgZGVmaW5lcyB0aGUgaW5kaXZpZHVhbCBjb2x1bW4KCQkgKiBmaWx0ZXJpbmcgc3RhdGUgYXQgaW5pdGlhbGlzYXRpb24gdGltZS4gVGhlIGFycmF5IG11c3QgYmUgb2YgdGhlIHNhbWUgc2l6ZSAKCQkgKiBhcyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMsIGFuZCBlYWNoIGVsZW1lbnQgYmUgYW4gb2JqZWN0IHdpdGggdGhlIHBhcmFtZXRlcnMKCQkgKiAic1NlYXJjaCIgYW5kICJiRXNjYXBlUmVnZXgiICh0aGUgbGF0dGVyIGlzIG9wdGlvbmFsKS4gJ251bGwnIGlzIGFsc28KCQkgKiBhY2NlcHRlZCBhbmQgdGhlIGRlZmF1bHQgd2lsbCBiZSB1c2VkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvU2VhcmNoQ29scyI6IFsKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTZWFyY2giOiAiTXkgZmlsdGVyIiB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgeyAic1NlYXJjaCI6ICJeWzAtOV0iLCAiYkVzY2FwZVJlZ2V4IjogZmFsc2UgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFvU2VhcmNoQ29scyI6IFtdLAoJCgkKCQkvKioKCQkgKiBBbiBhcnJheSBvZiBDU1MgY2xhc3NlcyB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGRpc3BsYXllZCByb3dzLiBUaGlzIAoJCSAqIGFycmF5IG1heSBiZSBvZiBhbnkgbGVuZ3RoLCBhbmQgRGF0YVRhYmxlcyB3aWxsIGFwcGx5IGVhY2ggY2xhc3MgCgkJICogc2VxdWVudGlhbGx5LCBsb29waW5nIHdoZW4gcmVxdWlyZWQuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwgPGk+V2lsbCB0YWtlIHRoZSB2YWx1ZXMgZGV0ZXJtaW5lZCBieSB0aGUgb0NsYXNzZXMuc1N0cmlwZSoKCQkgKiAgICBvcHRpb25zPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFzU3RyaXBlQ2xhc3NlcyI6IFsgJ3N0cmlwMScsICdzdHJpcDInLCAnc3RyaXAzJyBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFzU3RyaXBlQ2xhc3NlcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIGF1dG9tYXRpYyBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24uIFRoaXMgY2FuIGJlIGRpc2FibGVkCgkJICogYXMgYW4gb3B0aW1pc2F0aW9uIChpdCB0YWtlcyBzb21lIHRpbWUgdG8gY2FsY3VsYXRlIHRoZSB3aWR0aHMpIGlmIHRoZQoJCSAqIHRhYmxlcyB3aWR0aHMgYXJlIHBhc3NlZCBpbiB1c2luZyBhb0NvbHVtbnMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJBdXRvV2lkdGgiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkF1dG9XaWR0aCI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIERlZmVycmVkIHJlbmRlcmluZyBjYW4gcHJvdmlkZSBEYXRhVGFibGVzIHdpdGggYSBodWdlIHNwZWVkIGJvb3N0IHdoZW4geW91CgkJICogYXJlIHVzaW5nIGFuIEFqYXggb3IgSlMgZGF0YSBzb3VyY2UgZm9yIHRoZSB0YWJsZS4gVGhpcyBvcHRpb24sIHdoZW4gc2V0IHRvCgkJICogdHJ1ZSwgd2lsbCBjYXVzZSBEYXRhVGFibGVzIHRvIGRlZmVyIHRoZSBjcmVhdGlvbiBvZiB0aGUgdGFibGUgZWxlbWVudHMgZm9yCgkJICogZWFjaCByb3cgdW50aWwgdGhleSBhcmUgbmVlZGVkIGZvciBhIGRyYXcgLSBzYXZpbmcgYSBzaWduaWZpY2FudCBhbW91bnQgb2YKCQkgKiB0aW1lLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9hcnJheXMudHh0IiwKCQkgKiAgICAgICAgImJEZWZlclJlbmRlciI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJEZWZlclJlbmRlciI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBSZXBsYWNlIGEgRGF0YVRhYmxlIHdoaWNoIG1hdGNoZXMgdGhlIGdpdmVuIHNlbGVjdG9yIGFuZCByZXBsYWNlIGl0IHdpdGggCgkJICogb25lIHdoaWNoIGhhcyB0aGUgcHJvcGVydGllcyBvZiB0aGUgbmV3IGluaXRpYWxpc2F0aW9uIG9iamVjdCBwYXNzZWQuIElmIG5vCgkJICogdGFibGUgbWF0Y2hlcyB0aGUgc2VsZWN0b3IsIHRoZW4gdGhlIG5ldyBEYXRhVGFibGUgd2lsbCBiZSBjb25zdHJ1Y3RlZCBhcwoJCSAqIHBlciBub3JtYWwuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29tZSB0aW1lIGxhdGVyLi4uLgoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJGaWx0ZXIiOiBmYWxzZSwKCQkgKiAgICAgICAgImJEZXN0cm95IjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkRlc3Ryb3kiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9mIGRhdGEuIEZpbHRlcmluZyBpbiBEYXRhVGFibGVzIGlzICJzbWFydCIgaW4KCQkgKiB0aGF0IGl0IGFsbG93cyB0aGUgZW5kIHVzZXIgdG8gaW5wdXQgbXVsdGlwbGUgd29yZHMgKHNwYWNlIHNlcGFyYXRlZCkgYW5kCgkJICogd2lsbCBtYXRjaCBhIHJvdyBjb250YWluaW5nIHRob3NlIHdvcmRzLCBldmVuIGlmIG5vdCBpbiB0aGUgb3JkZXIgdGhhdCB3YXMKCQkgKiBzcGVjaWZpZWQgKHRoaXMgYWxsb3cgbWF0Y2hpbmcgYWNyb3NzIG11bHRpcGxlIGNvbHVtbnMpLiBOb3RlIHRoYXQgaWYgeW91CgkJICogd2lzaCB0byB1c2UgZmlsdGVyaW5nIGluIERhdGFUYWJsZXMgdGhpcyBtdXN0IHJlbWFpbiAndHJ1ZScgLSB0byByZW1vdmUgdGhlCgkJICogZGVmYXVsdCBmaWx0ZXJpbmcgaW5wdXQgYm94IGFuZCByZXRhaW4gZmlsdGVyaW5nIGFiaWxpdGllcywgcGxlYXNlIHVzZQoJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuc0RvbX0uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJGaWx0ZXIiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkZpbHRlciI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSB0YWJsZSBpbmZvcm1hdGlvbiBkaXNwbGF5LiBUaGlzIHNob3dzIGluZm9ybWF0aW9uIAoJCSAqIGFib3V0IHRoZSBkYXRhIHRoYXQgaXMgY3VycmVudGx5IHZpc2libGUgb24gdGhlIHBhZ2UsIGluY2x1ZGluZyBpbmZvcm1hdGlvbgoJCSAqIGFib3V0IGZpbHRlcmVkIGRhdGEgaWYgdGhhdCBhY3Rpb24gaXMgYmVpbmcgcGVyZm9ybWVkLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiSW5mbyI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiSW5mbyI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBqUXVlcnkgVUkgVGhlbWVSb2xsZXIgc3VwcG9ydCAocmVxdWlyZWQgYXMgVGhlbWVSb2xsZXIgcmVxdWlyZXMgc29tZQoJCSAqIHNsaWdodGx5IGRpZmZlcmVudCBhbmQgYWRkaXRpb25hbCBtYXJrLXVwIGZyb20gd2hhdCBEYXRhVGFibGVzIGhhcwoJCSAqIHRyYWRpdGlvbmFsbHkgdXNlZCkuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJKUXVlcnlVSSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJKUXVlcnlVSSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgdGhlIGVuZCB1c2VyIHRvIHNlbGVjdCB0aGUgc2l6ZSBvZiBhIGZvcm1hdHRlZCBwYWdlIGZyb20gYSBzZWxlY3QKCQkgKiBtZW51IChzaXplcyBhcmUgMTAsIDI1LCA1MCBhbmQgMTAwKS4gUmVxdWlyZXMgcGFnaW5hdGlvbiAoYlBhZ2luYXRlKS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkxlbmd0aENoYW5nZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiTGVuZ3RoQ2hhbmdlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgcGFnaW5hdGlvbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJQYWdpbmF0ZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBkaXNwbGF5IG9mIGEgJ3Byb2Nlc3NpbmcnIGluZGljYXRvciB3aGVuIHRoZSB0YWJsZSBpcwoJCSAqIGJlaW5nIHByb2Nlc3NlZCAoZS5nLiBhIHNvcnQpLiBUaGlzIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgZm9yIHRhYmxlcyB3aXRoCgkJICogbGFyZ2UgYW1vdW50cyBvZiBkYXRhIHdoZXJlIGl0IGNhbiB0YWtlIGEgbm90aWNlYWJsZSBhbW91bnQgb2YgdGltZSB0byBzb3J0CgkJICogdGhlIGVudHJpZXMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiUHJvY2Vzc2luZyI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJQcm9jZXNzaW5nIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIFJldHJpZXZlIHRoZSBEYXRhVGFibGVzIG9iamVjdCBmb3IgdGhlIGdpdmVuIHNlbGVjdG9yLiBOb3RlIHRoYXQgaWYgdGhlCgkJICogdGFibGUgaGFzIGFscmVhZHkgYmVlbiBpbml0aWFsaXNlZCwgdGhpcyBwYXJhbWV0ZXIgd2lsbCBjYXVzZSBEYXRhVGFibGVzCgkJICogdG8gc2ltcGx5IHJldHVybiB0aGUgb2JqZWN0IHRoYXQgaGFzIGFscmVhZHkgYmVlbiBzZXQgdXAgLSBpdCB3aWxsIG5vdCB0YWtlCgkJICogYWNjb3VudCBvZiBhbnkgY2hhbmdlcyB5b3UgbWlnaHQgaGF2ZSBtYWRlIHRvIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QKCQkgKiBwYXNzZWQgdG8gRGF0YVRhYmxlcyAoc2V0dGluZyB0aGlzIHBhcmFtZXRlciB0byB0cnVlIGlzIGFuIGFja25vd2xlZGdlbWVudAoJCSAqIHRoYXQgeW91IHVuZGVyc3RhbmQgdGhpcykuIGJEZXN0cm95IGNhbiBiZSB1c2VkIHRvIHJlaW5pdGlhbGlzZSBhIHRhYmxlIGlmCgkJICogeW91IG5lZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICBpbml0VGFibGUoKTsKCQkgKiAgICAgIHRhYmxlQWN0aW9ucygpOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICBmdW5jdGlvbiBpbml0VGFibGUgKCkKCQkgKiAgICB7CgkJICogICAgICByZXR1cm4gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlLAoJCSAqICAgICAgICAiYlJldHJpZXZlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0KCQkgKiAgICAKCQkgKiAgICBmdW5jdGlvbiB0YWJsZUFjdGlvbnMgKCkKCQkgKiAgICB7CgkJICogICAgICB2YXIgb1RhYmxlID0gaW5pdFRhYmxlKCk7CgkJICogICAgICAvLyBwZXJmb3JtIEFQSSBvcGVyYXRpb25zIHdpdGggb1RhYmxlIAoJCSAqICAgIH0KCQkgKi8KCQkiYlJldHJpZXZlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIERhdGFUYWJsZXMgc2hvdWxkIGJlIGFsbG93ZWQgdG8gc2V0IHRoZSBwYWRkaW5nIC8gbWFyZ2luCgkJICogZXRjIGZvciB0aGUgc2Nyb2xsaW5nIGhlYWRlciBlbGVtZW50cyBvciBub3QuIFR5cGljYWxseSB5b3Ugd2lsbCB3YW50CgkJICogdGhpcy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTY3JvbGxBdXRvQ3NzIjogZmFsc2UsCgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxBdXRvQ3NzIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB2ZXJ0aWNhbCAoeSkgc2Nyb2xsaW5nIGlzIGVuYWJsZWQsIERhdGFUYWJsZXMgd2lsbCBmb3JjZSB0aGUgaGVpZ2h0IG9mCgkJICogdGhlIHRhYmxlJ3Mgdmlld3BvcnQgdG8gdGhlIGdpdmVuIGhlaWdodCBhdCBhbGwgdGltZXMgKHVzZWZ1bCBmb3IgbGF5b3V0KS4KCQkgKiBIb3dldmVyLCB0aGlzIGNhbiBsb29rIG9kZCB3aGVuIGZpbHRlcmluZyBkYXRhIGRvd24gdG8gYSBzbWFsbCBkYXRhIHNldCwKCQkgKiBhbmQgdGhlIGZvb3RlciBpcyBsZWZ0ICJmbG9hdGluZyIgZnVydGhlciBkb3duLiBUaGlzIHBhcmFtZXRlciAod2hlbgoJCSAqIGVuYWJsZWQpIHdpbGwgY2F1c2UgRGF0YVRhYmxlcyB0byBjb2xsYXBzZSB0aGUgdGFibGUncyB2aWV3cG9ydCBkb3duIHdoZW4KCQkgKiB0aGUgcmVzdWx0IHNldCB3aWxsIGZpdCB3aXRoaW4gdGhlIGdpdmVuIFkgaGVpZ2h0LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMCIsCgkJICogICAgICAgICJiU2Nyb2xsQ29sbGFwc2UiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2Nyb2xsQ29sbGFwc2UiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGluZmluaXRlIHNjcm9sbGluZyBmb3IgRGF0YVRhYmxlcyAodG8gYmUgdXNlZCBpbiBjb21iaW5hdGlvbiB3aXRoCgkJICogc1Njcm9sbFkpLiBJbmZpbml0ZSBzY3JvbGxpbmcgbWVhbnMgdGhhdCBEYXRhVGFibGVzIHdpbGwgY29udGludWFsbHkgbG9hZAoJCSAqIGRhdGEgYXMgYSB1c2VyIHNjcm9sbHMgdGhyb3VnaCBhIHRhYmxlLCB3aGljaCBpcyB2ZXJ5IHVzZWZ1bCBmb3IgbGFyZ2UKCQkgKiBkYXRhc2V0LiBUaGlzIGNhbm5vdCBiZSB1c2VkIHdpdGggcGFnaW5hdGlvbiwgd2hpY2ggaXMgYXV0b21hdGljYWxseQoJCSAqIGRpc2FibGVkLiBOb3RlIC0gdGhlIFNjcm9sbGVyIGV4dHJhIGZvciBEYXRhVGFibGVzIGlzIHJlY29tbWVuZGVkIGluCgkJICogaW4gcHJlZmVyZW5jZSB0byB0aGlzIG9wdGlvbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNjcm9sbEluZmluaXRlIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUsCgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxJbmZpbml0ZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBDb25maWd1cmUgRGF0YVRhYmxlcyB0byB1c2Ugc2VydmVyLXNpZGUgcHJvY2Vzc2luZy4gTm90ZSB0aGF0IHRoZQoJCSAqIHNBamF4U291cmNlIHBhcmFtZXRlciBtdXN0IGFsc28gYmUgZ2l2ZW4gaW4gb3JkZXIgdG8gZ2l2ZSBEYXRhVGFibGVzIGEKCQkgKiBzb3VyY2UgdG8gb2J0YWluIHRoZSByZXF1aXJlZCBkYXRhIGZvciBlYWNoIGRyYXcuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogIEBkdG9wdCBTZXJ2ZXItc2lkZQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAieGhyLnBocCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTZXJ2ZXJTaWRlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHNvcnRpbmcgb2YgY29sdW1ucy4gU29ydGluZyBvZiBpbmRpdmlkdWFsIGNvbHVtbnMgY2FuIGJlCgkJICogZGlzYWJsZWQgYnkgdGhlICJiU29ydGFibGUiIG9wdGlvbiBmb3IgZWFjaCBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTb3J0IjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTb3J0IjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogQWxsb3dzIGNvbnRyb2wgb3ZlciB3aGV0aGVyIERhdGFUYWJsZXMgc2hvdWxkIHVzZSB0aGUgdG9wICh0cnVlKSB1bmlxdWUKCQkgKiBjZWxsIHRoYXQgaXMgZm91bmQgZm9yIGEgc2luZ2xlIGNvbHVtbiwgb3IgdGhlIGJvdHRvbSAoZmFsc2UgLSBkZWZhdWx0KS4KCQkgKiBUaGlzIGlzIHVzZWZ1bCB3aGVuIHVzaW5nIGNvbXBsZXggaGVhZGVycy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU29ydENlbGxzVG9wIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRDZWxsc1RvcCI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSB0aGUgYWRkaXRpb24gb2YgdGhlIGNsYXNzZXMgJ3NvcnRpbmdfMScsICdzb3J0aW5nXzInIGFuZAoJCSAqICdzb3J0aW5nXzMnIHRvIHRoZSBjb2x1bW5zIHdoaWNoIGFyZSBjdXJyZW50bHkgYmVpbmcgc29ydGVkIG9uLiBUaGlzIGlzCgkJICogcHJlc2VudGVkIGFzIGEgZmVhdHVyZSBzd2l0Y2ggYXMgaXQgY2FuIGluY3JlYXNlIHByb2Nlc3NpbmcgdGltZSAod2hpbGUKCQkgKiBjbGFzc2VzIGFyZSByZW1vdmVkIGFuZCBhZGRlZCkgc28gZm9yIGxhcmdlIGRhdGEgc2V0cyB5b3UgbWlnaHQgd2FudCB0bwoJCSAqIHR1cm4gdGhpcyBvZmYuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTb3J0Q2xhc3NlcyI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU29ydENsYXNzZXMiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBzdGF0ZSBzYXZpbmcuIFdoZW4gZW5hYmxlZCBhIGNvb2tpZSB3aWxsIGJlIHVzZWQgdG8gc2F2ZQoJCSAqIHRhYmxlIGRpc3BsYXkgaW5mb3JtYXRpb24gc3VjaCBhcyBwYWdpbmF0aW9uIGluZm9ybWF0aW9uLCBkaXNwbGF5IGxlbmd0aCwKCQkgKiBmaWx0ZXJpbmcgYW5kIHNvcnRpbmcuIEFzIHN1Y2ggd2hlbiB0aGUgZW5kIHVzZXIgcmVsb2FkcyB0aGUgcGFnZSB0aGUKCQkgKiBkaXNwbGF5IGRpc3BsYXkgd2lsbCBtYXRjaCB3aGF0IHRoeSBoYWQgcHJldmlvdXNseSBzZXQgdXAuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlN0YXRlU2F2ZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBDdXN0b21pc2UgdGhlIGNvb2tpZSBhbmQgLyBvciB0aGUgcGFyYW1ldGVycyBiZWluZyBzdG9yZWQgd2hlbiB1c2luZwoJCSAqIERhdGFUYWJsZXMgd2l0aCBzdGF0ZSBzYXZpbmcgZW5hYmxlZC4gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIKCQkgKiB0aGUgY29va2llIGlzIG1vZGlmaWVkLCBhbmQgaXQgZXhwZWN0cyBhIGZ1bGx5IGZvcm1lZCBjb29raWUgc3RyaW5nIHRvIGJlCgkJICogcmV0dXJuZWQuIE5vdGUgdGhhdCB0aGUgZGF0YSBvYmplY3QgcGFzc2VkIGluIGlzIGEgSmF2YXNjcmlwdCBvYmplY3Qgd2hpY2gKCQkgKiBtdXN0IGJlIGNvbnZlcnRlZCB0byBhIHN0cmluZyAoSlNPTi5zdHJpbmdpZnkgZm9yIGV4YW1wbGUpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgTmFtZSBvZiB0aGUgY29va2llIGRlZmluZWQgYnkgRGF0YVRhYmxlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgRGF0YSB0byBiZSBzdG9yZWQgaW4gdGhlIGNvb2tpZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0V4cGlyZXMgQ29va2llIGV4cGlyZXMgc3RyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUGF0aCBQYXRoIG9mIHRoZSBjb29raWUgdG8gc2V0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IENvb2tpZSBmb3JtYXR0ZWQgc3RyaW5nICh3aGljaCBzaG91bGQgYmUgZW5jb2RlZCBieQoJCSAqICAgIHVzaW5nIGVuY29kZVVSSUNvbXBvbmVudCgpKQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkNvb2tpZUNhbGxiYWNrIjogZnVuY3Rpb24gKHNOYW1lLCBvRGF0YSwgc0V4cGlyZXMsIHNQYXRoKSB7CgkJICogICAgICAgICAgLy8gQ3VzdG9taXNlIG9EYXRhIG9yIHNOYW1lIG9yIHdoYXRldmVyIGVsc2UgaGVyZQoJCSAqICAgICAgICAgIHJldHVybiBzTmFtZSArICI9IitKU09OLnN0cmluZ2lmeShvRGF0YSkrIjsgZXhwaXJlcz0iICsgc0V4cGlyZXMgKyI7IHBhdGg9IiArIHNQYXRoOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNvb2tpZUNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiBhIFRSIGVsZW1lbnQgaXMgY3JlYXRlZCAoYW5kIGFsbCBURCBjaGlsZAoJCSAqIGVsZW1lbnRzIGhhdmUgYmVlbiBpbnNlcnRlZCksIG9yIHJlZ2lzdGVyZWQgaWYgdXNpbmcgYSBET00gc291cmNlLCBhbGxvd2luZwoJCSAqIG1hbmlwdWxhdGlvbiBvZiB0aGUgVFIgZWxlbWVudCAoYWRkaW5nIGNsYXNzZXMgZXRjKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURhdGFJbmRleCBUaGUgaW5kZXggb2YgdGhpcyByb3cgaW4gYW9EYXRhCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5DcmVhdGVkUm93IjogZnVuY3Rpb24oIG5Sb3csIGFEYXRhLCBpRGF0YUluZGV4ICkgewoJCSAqICAgICAgICAgIC8vIEJvbGQgdGhlIGdyYWRlIGZvciBhbGwgJ0EnIGdyYWRlIGJyb3dzZXJzCgkJICogICAgICAgICAgaWYgKCBhRGF0YVs0XSA9PSAiQSIgKQoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICQoJ3RkOmVxKDQpJywgblJvdykuaHRtbCggJzxiPkE8L2I+JyApOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkUm93IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgb24gZXZlcnkgJ2RyYXcnIGV2ZW50LCBhbmQgYWxsb3dzIHlvdSB0bwoJCSAqIGR5bmFtaWNhbGx5IG1vZGlmeSBhbnkgYXNwZWN0IHlvdSB3YW50IGFib3V0IHRoZSBjcmVhdGVkIERPTS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBhbGVydCggJ0RhdGFUYWJsZXMgaGFzIHJlZHJhd24gdGhlIHRhYmxlJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkRyYXdDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElkZW50aWNhbCB0byBmbkhlYWRlckNhbGxiYWNrKCkgYnV0IGZvciB0aGUgdGFibGUgZm9vdGVyIHRoaXMgZnVuY3Rpb24KCQkgKiBhbGxvd3MgeW91IHRvIG1vZGlmeSB0aGUgdGFibGUgZm9vdGVyIG9uIGV2ZXJ5ICdkcmF3JyBldmVuLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Gb290ICJUUiIgZWxlbWVudCBmb3IgdGhlIGZvb3RlcgoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBGdWxsIHRhYmxlIGRhdGEgKGFzIGRlcml2ZWQgZnJvbSB0aGUgb3JpZ2luYWwgSFRNTCkKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBzdGFydGluZyBwb2ludCBpbiB0aGUgCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlIAoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheSBpbnR9IGFpRGlzcGxheSBJbmRleCBhcnJheSB0byB0cmFuc2xhdGUgdGhlIHZpc3VhbCBwb3NpdGlvbgoJCSAqICAgIHRvIHRoZSBmdWxsIGRhdGEgYXJyYXkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkZvb3RlckNhbGxiYWNrIjogZnVuY3Rpb24oIG5Gb290LCBhRGF0YSwgaVN0YXJ0LCBpRW5kLCBhaURpc3BsYXkgKSB7CgkJICogICAgICAgICAgbkZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJylbMF0uaW5uZXJIVE1MID0gIlN0YXJ0aW5nIGluZGV4IGlzICIraVN0YXJ0OwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuRm9vdGVyQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBXaGVuIHJlbmRlcmluZyBsYXJnZSBudW1iZXJzIGluIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGZvciB0aGUgdGFibGUKCQkgKiAoaS5lLiAiU2hvd2luZyAxIHRvIDEwIG9mIDU3IGVudHJpZXMiKSBEYXRhVGFibGVzIHdpbGwgcmVuZGVyIGxhcmdlIG51bWJlcnMKCQkgKiB0byBoYXZlIGEgY29tbWEgc2VwYXJhdG9yIGZvciB0aGUgJ3Rob3VzYW5kcycgdW5pdHMgKGUuZy4gMSBtaWxsaW9uIGlzCgkJICogcmVuZGVyZWQgYXMgIjEsMDAwLDAwMCIpIHRvIGhlbHAgcmVhZGFiaWxpdHkgZm9yIHRoZSBlbmQgdXNlci4gVGhpcwoJCSAqIGZ1bmN0aW9uIHdpbGwgb3ZlcnJpZGUgdGhlIGRlZmF1bHQgbWV0aG9kIERhdGFUYWJsZXMgdXNlcy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge2ludH0gaUluIG51bWJlciB0byBiZSBmb3JtYXR0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gZm9ybWF0dGVkIHN0cmluZyBmb3IgRGF0YVRhYmxlcyB0byBzaG93IHRoZSBudW1iZXIKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkZvcm1hdE51bWJlciI6IGZ1bmN0aW9uICggaUluICkgewoJCSAqICAgICAgICAgIGlmICggaUluICZsdDsgMTAwMCApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBpSW47CgkJICogICAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICAgIHZhciAKCQkgKiAgICAgICAgICAgICAgcz0oaUluKyIiKSwgCgkJICogICAgICAgICAgICAgIGE9cy5zcGxpdCgiIiksIG91dD0iIiwgCgkJICogICAgICAgICAgICAgIGlMZW49cy5sZW5ndGg7CgkJICogICAgICAgICAgICAKCQkgKiAgICAgICAgICAgIGZvciAoIHZhciBpPTAgOyBpJmx0O2lMZW4gOyBpKysgKSB7CgkJICogICAgICAgICAgICAgIGlmICggaSUzID09PSAwICZhbXA7JmFtcDsgaSAhPT0gMCApIHsKCQkgKiAgICAgICAgICAgICAgICBvdXQgPSAiJyIrb3V0OwoJCSAqICAgICAgICAgICAgICB9CgkJICogICAgICAgICAgICAgIG91dCA9IGFbaUxlbi1pLTFdK291dDsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgcmV0dXJuIG91dDsKCQkgKiAgICAgICAgfTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuRm9ybWF0TnVtYmVyIjogZnVuY3Rpb24gKCBpSW4gKSB7CgkJCWlmICggaUluIDwgMTAwMCApCgkJCXsKCQkJCS8vIEEgc21hbGwgb3B0aW1pc2F0aW9uIGZvciB3aGF0IGlzIGxpa2VseSB0byBiZSB0aGUgbWFqb3JpdHkgb2YgdXNlIGNhc2VzCgkJCQlyZXR1cm4gaUluOwoJCQl9CgkKCQkJdmFyIHM9KGlJbisiIiksIGE9cy5zcGxpdCgiIiksIG91dD0iIiwgaUxlbj1zLmxlbmd0aDsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGklMyA9PT0gMCAmJiBpICE9PSAwICkKCQkJCXsKCQkJCQlvdXQgPSB0aGlzLm9MYW5ndWFnZS5zSW5mb1Rob3VzYW5kcytvdXQ7CgkJCQl9CgkJCQlvdXQgPSBhW2lMZW4taS0xXStvdXQ7CgkJCX0KCQkJcmV0dXJuIG91dDsKCQl9LAoJCgkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBldmVyeSAnZHJhdycgZXZlbnQsIGFuZCBhbGxvd3MgeW91IHRvCgkJICogZHluYW1pY2FsbHkgbW9kaWZ5IHRoZSBoZWFkZXIgcm93LiBUaGlzIGNhbiBiZSB1c2VkIHRvIGNhbGN1bGF0ZSBhbmQKCQkgKiBkaXNwbGF5IHVzZWZ1bCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGFibGUuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7bm9kZX0gbkhlYWQgIlRSIiBlbGVtZW50IGZvciB0aGUgaGVhZGVyCgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIEZ1bGwgdGFibGUgZGF0YSAoYXMgZGVyaXZlZCBmcm9tIHRoZSBvcmlnaW5hbCBIVE1MKQoJCSAqICBAcGFyYW0ge2ludH0gaVN0YXJ0IEluZGV4IGZvciB0aGUgY3VycmVudCBkaXNwbGF5IHN0YXJ0aW5nIHBvaW50IGluIHRoZQoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHtpbnR9IGlFbmQgSW5kZXggZm9yIHRoZSBjdXJyZW50IGRpc3BsYXkgZW5kaW5nIHBvaW50IGluIHRoZQoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheSBpbnR9IGFpRGlzcGxheSBJbmRleCBhcnJheSB0byB0cmFuc2xhdGUgdGhlIHZpc3VhbCBwb3NpdGlvbgoJCSAqICAgIHRvIHRoZSBmdWxsIGRhdGEgYXJyYXkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkhlYWRlckNhbGxiYWNrIjogZnVuY3Rpb24oIG5IZWFkLCBhRGF0YSwgaVN0YXJ0LCBpRW5kLCBhaURpc3BsYXkgKSB7CgkJICogICAgICAgICAgbkhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJylbMF0uaW5uZXJIVE1MID0gIkRpc3BsYXlpbmcgIisoaUVuZC1pU3RhcnQpKyIgcmVjb3JkcyI7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiZm5IZWFkZXJDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGNhbiBiZSB1c2VkIHRvIGNvbnZleSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgY3VycmVudAoJCSAqIHN0YXRlIG9mIHRoZSB0YWJsZS4gQWx0aG91Z2ggdGhlIGludGVybmF0aW9uYWxpc2F0aW9uIG9wdGlvbnMgcHJlc2VudGVkIGJ5CgkJICogRGF0YVRhYmxlcyBhcmUgcXVpdGUgY2FwYWJsZSBvZiBkZWFsaW5nIHdpdGggbW9zdCBjdXN0b21pc2F0aW9ucywgdGhlcmUgbWF5CgkJICogYmUgdGltZXMgd2hlcmUgeW91IHdpc2ggdG8gY3VzdG9taXNlIHRoZSBzdHJpbmcgZnVydGhlci4gVGhpcyBjYWxsYmFjawoJCSAqIGFsbG93cyB5b3UgdG8gZG8gZXhhY3RseSB0aGF0LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpU3RhcnQgU3RhcnRpbmcgcG9zaXRpb24gaW4gZGF0YSBmb3IgdGhlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlFbmQgRW5kIHBvc2l0aW9uIGluIGRhdGEgZm9yIHRoZSBkcmF3CgkJICogIEBwYXJhbSB7aW50fSBpTWF4IFRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSB0YWJsZSAocmVnYXJkbGVzcyBvZgoJCSAqICAgIGZpbHRlcmluZykKCQkgKiAgQHBhcmFtIHtpbnR9IGlUb3RhbCBUb3RhbCBudW1iZXIgb2Ygcm93cyBpbiB0aGUgZGF0YSBzZXQsIGFmdGVyIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ByZSBUaGUgc3RyaW5nIHRoYXQgRGF0YVRhYmxlcyBoYXMgZm9ybWF0dGVkIHVzaW5nIGl0J3MKCQkgKiAgICBvd24gcnVsZXMKCQkgKiAgQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGluZm9ybWF0aW9uIGVsZW1lbnQuCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgImZuSW5mb0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncywgaVN0YXJ0LCBpRW5kLCBpTWF4LCBpVG90YWwsIHNQcmUgKSB7CgkJICogICAgICAgIHJldHVybiBpU3RhcnQgKyIgdG8gIisgaUVuZDsKCQkgKiAgICAgIH0KCQkgKiAgICB9ICk7CgkJICovCgkJImZuSW5mb0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGVkIHdoZW4gdGhlIHRhYmxlIGhhcyBiZWVuIGluaXRpYWxpc2VkLiBOb3JtYWxseSBEYXRhVGFibGVzIHdpbGwKCQkgKiBpbml0aWFsaXNlIHNlcXVlbnRpYWxseSBhbmQgdGhlcmUgd2lsbCBiZSBubyBuZWVkIGZvciB0aGlzIGZ1bmN0aW9uLAoJCSAqIGhvd2V2ZXIsIHRoaXMgZG9lcyBub3QgaG9sZCB0cnVlIHdoZW4gdXNpbmcgZXh0ZXJuYWwgbGFuZ3VhZ2UgaW5mb3JtYXRpb24KCQkgKiBzaW5jZSB0aGF0IGlzIG9idGFpbmVkIHVzaW5nIGFuIGFzeW5jIFhIUiBjYWxsLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBKU09OIG9iamVjdCByZXF1ZXN0IGZyb20gdGhlIHNlcnZlciAtIG9ubHkKCQkgKiAgICBwcmVzZW50IGlmIGNsaWVudC1zaWRlIEFqYXggc291cmNlZCBkYXRhIGlzIHVzZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkluaXRDb21wbGV0ZSI6IGZ1bmN0aW9uKG9TZXR0aW5ncywganNvbikgewoJCSAqICAgICAgICAgIGFsZXJ0KCAnRGF0YVRhYmxlcyBoYXMgZmluaXNoZWQgaXRzIGluaXRpYWxpc2F0aW9uLicgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJmbkluaXRDb21wbGV0ZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIENhbGxlZCBhdCB0aGUgdmVyeSBzdGFydCBvZiBlYWNoIHRhYmxlIGRyYXcgYW5kIGNhbiBiZSB1c2VkIHRvIGNhbmNlbCB0aGUKCQkgKiBkcmF3IGJ5IHJldHVybmluZyBmYWxzZSwgYW55IG90aGVyIHJldHVybiAoaW5jbHVkaW5nIHVuZGVmaW5lZCkgcmVzdWx0cyBpbgoJCSAqIHRoZSBmdWxsIGRyYXcgb2NjdXJyaW5nKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gRmFsc2Ugd2lsbCBjYW5jZWwgdGhlIGRyYXcsIGFueXRoaW5nIGVsc2UgKGluY2x1ZGluZyBubwoJCSAqICAgIHJldHVybikgd2lsbCBhbGxvdyBpdCB0byBjb21wbGV0ZS4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmblByZURyYXdDYWxsYmFjayI6IGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJICogICAgICAgICAgaWYgKCAkKCcjdGVzdCcpLnZhbCgpID09IDEgKSB7CgkJICogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblByZURyYXdDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHlvdSB0byAncG9zdCBwcm9jZXNzJyBlYWNoIHJvdyBhZnRlciBpdCBoYXZlIGJlZW4KCQkgKiBnZW5lcmF0ZWQgZm9yIGVhY2ggdGFibGUgZHJhdywgYnV0IGJlZm9yZSBpdCBpcyByZW5kZXJlZCBvbiBzY3JlZW4uIFRoaXMKCQkgKiBmdW5jdGlvbiBtaWdodCBiZSB1c2VkIGZvciBzZXR0aW5nIHRoZSByb3cgY2xhc3MgbmFtZSBldGMuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7bm9kZX0gblJvdyAiVFIiIGVsZW1lbnQgZm9yIHRoZSBjdXJyZW50IHJvdwoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSYXcgZGF0YSBhcnJheSBmb3IgdGhpcyByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlEaXNwbGF5SW5kZXggVGhlIGRpc3BsYXkgaW5kZXggZm9yIHRoZSBjdXJyZW50IHRhYmxlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlEaXNwbGF5SW5kZXhGdWxsIFRoZSBpbmRleCBvZiB0aGUgZGF0YSBpbiB0aGUgZnVsbCBsaXN0IG9mCgkJICogICAgcm93cyAoYWZ0ZXIgZmlsdGVyaW5nKQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuUm93Q2FsbGJhY2siOiBmdW5jdGlvbiggblJvdywgYURhdGEsIGlEaXNwbGF5SW5kZXgsIGlEaXNwbGF5SW5kZXhGdWxsICkgewoJCSAqICAgICAgICAgIC8vIEJvbGQgdGhlIGdyYWRlIGZvciBhbGwgJ0EnIGdyYWRlIGJyb3dzZXJzCgkJICogICAgICAgICAgaWYgKCBhRGF0YVs0XSA9PSAiQSIgKQoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICQoJ3RkOmVxKDQpJywgblJvdykuaHRtbCggJzxiPkE8L2I+JyApOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Sb3dDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgZnVuY3Rpb24gd2hpY2ggb2J0YWlucwoJCSAqIHRoZSBkYXRhIGZyb20gdGhlIHNlcnZlciAoJC5nZXRKU09OKSBzbyBzb21ldGhpbmcgbW9yZSBzdWl0YWJsZSBmb3IgeW91cgoJCSAqIGFwcGxpY2F0aW9uLiBGb3IgZXhhbXBsZSB5b3UgY291bGQgdXNlIFBPU1QgZGF0YSwgb3IgcHVsbCBpbmZvcm1hdGlvbiBmcm9tCgkJICogYSBHZWFycyBvciBBSVIgZGF0YWJhc2UuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBtZW1iZXIKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTb3VyY2UgSFRUUCBzb3VyY2UgdG8gb2J0YWluIHRoZSBkYXRhIGZyb20gKHNBamF4U291cmNlKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0RhdGEgQSBrZXkvdmFsdWUgcGFpciBvYmplY3QgY29udGFpbmluZyB0aGUgZGF0YSB0byBzZW5kCgkJICogICAgdG8gdGhlIHNlcnZlcgoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBmbkNhbGxiYWNrIHRvIGJlIGNhbGxlZCBvbiBjb21wbGV0aW9uIG9mIHRoZSBkYXRhIGdldAoJCSAqICAgIHByb2Nlc3MgdGhhdCB3aWxsIGRyYXcgdGhlIGRhdGEgb24gdGhlIHBhZ2UuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBQT1NUIGRhdGEgdG8gc2VydmVyCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInhoci5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJEYXRhIjogZnVuY3Rpb24gKCBzU291cmNlLCBhb0RhdGEsIGZuQ2FsbGJhY2ssIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBvU2V0dGluZ3MuanFYSFIgPSAkLmFqYXgoIHsKCQkgKiAgICAgICAgICAgICJkYXRhVHlwZSI6ICdqc29uJywgCgkJICogICAgICAgICAgICAidHlwZSI6ICJQT1NUIiwgCgkJICogICAgICAgICAgICAidXJsIjogc1NvdXJjZSwgCgkJICogICAgICAgICAgICAiZGF0YSI6IGFvRGF0YSwgCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZuQ2FsbGJhY2sKCQkgKiAgICAgICAgICB9ICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU2VydmVyRGF0YSI6IGZ1bmN0aW9uICggc1VybCwgYW9EYXRhLCBmbkNhbGxiYWNrLCBvU2V0dGluZ3MgKSB7CgkJCW9TZXR0aW5ncy5qcVhIUiA9ICQuYWpheCggewoJCQkJInVybCI6ICBzVXJsLAoJCQkJImRhdGEiOiBhb0RhdGEsCgkJCQkic3VjY2VzcyI6IGZ1bmN0aW9uIChqc29uKSB7CgkJCQkJaWYgKCBqc29uLnNFcnJvciApIHsKCQkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuTG9nKCBvU2V0dGluZ3MsIDAsIGpzb24uc0Vycm9yICk7CgkJCQkJfQoJCQkJCQoJCQkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigneGhyJywgW29TZXR0aW5ncywganNvbl0pOwoJCQkJCWZuQ2FsbGJhY2soIGpzb24gKTsKCQkJCX0sCgkJCQkiZGF0YVR5cGUiOiAianNvbiIsCgkJCQkiY2FjaGUiOiBmYWxzZSwKCQkJCSJ0eXBlIjogb1NldHRpbmdzLnNTZXJ2ZXJNZXRob2QsCgkJCQkiZXJyb3IiOiBmdW5jdGlvbiAoeGhyLCBlcnJvciwgdGhyb3duKSB7CgkJCQkJaWYgKCBlcnJvciA9PSAicGFyc2VyZXJyb3IiICkgewoJCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5Mb2coIG9TZXR0aW5ncywgMCwgIkRhdGFUYWJsZXMgd2FybmluZzogSlNPTiBkYXRhIGZyb20gIisKCQkJCQkJCSJzZXJ2ZXIgY291bGQgbm90IGJlIHBhcnNlZC4gVGhpcyBpcyBjYXVzZWQgYnkgYSBKU09OIGZvcm1hdHRpbmcgZXJyb3IuIiApOwoJCQkJCX0KCQkJCX0KCQkJfSApOwoJCX0sCgkKCQoJCS8qKgoJCSAqIEl0IGlzIG9mdGVuIHVzZWZ1bCB0byBzZW5kIGV4dHJhIGRhdGEgdG8gdGhlIHNlcnZlciB3aGVuIG1ha2luZyBhbiBBamF4CgkJICogcmVxdWVzdCAtIGZvciBleGFtcGxlIGN1c3RvbSBmaWx0ZXJpbmcgaW5mb3JtYXRpb24sIGFuZCB0aGlzIGNhbGxiYWNrCgkJICogZnVuY3Rpb24gbWFrZXMgaXQgdHJpdmlhbCB0byBzZW5kIGV4dHJhIGluZm9ybWF0aW9uIHRvIHRoZSBzZXJ2ZXIuIFRoZQoJCSAqIHBhc3NlZCBpbiBwYXJhbWV0ZXIgaXMgdGhlIGRhdGEgc2V0IHRoYXQgaGFzIGJlZW4gY29uc3RydWN0ZWQgYnkKCQkgKiBEYXRhVGFibGVzLCBhbmQgeW91IGNhbiBhZGQgdG8gdGhpcyBvciBtb2RpZnkgaXQgYXMgeW91IHJlcXVpcmUuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl9IGFvRGF0YSBEYXRhIGFycmF5IChhcnJheSBvZiBvYmplY3RzIHdoaWNoIGFyZSBuYW1lL3ZhbHVlCgkJICogICAgcGFpcnMpIHRoYXQgaGFzIGJlZW4gY29uc3RydWN0ZWQgYnkgRGF0YVRhYmxlcyBhbmQgd2lsbCBiZSBzZW50IHRvIHRoZQoJCSAqICAgIHNlcnZlci4gSW4gdGhlIGNhc2Ugb2YgQWpheCBzb3VyY2VkIGRhdGEgd2l0aCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nCgkJICogICAgdGhpcyB3aWxsIGJlIGFuIGVtcHR5IGFycmF5LCBmb3Igc2VydmVyLXNpZGUgcHJvY2Vzc2luZyB0aGVyZSB3aWxsIGJlIGEKCQkgKiAgICBzaWduaWZpY2FudCBudW1iZXIgb2YgcGFyYW1ldGVycyEKCQkgKiAgQHJldHVybnMge3VuZGVmaW5lZH0gRW5zdXJlIHRoYXQgeW91IG1vZGlmeSB0aGUgYW9EYXRhIGFycmF5IHBhc3NlZCBpbiwKCQkgKiAgICBhcyB0aGlzIGlzIHBhc3NlZCBieSByZWZlcmVuY2UuCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNjcmlwdHMvc2VydmVyX3Byb2Nlc3NpbmcucGhwIiwKCQkgKiAgICAgICAgImZuU2VydmVyUGFyYW1zIjogZnVuY3Rpb24gKCBhb0RhdGEgKSB7CgkJICogICAgICAgICAgYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAibW9yZV9kYXRhIiwgInZhbHVlIjogIm15X3ZhbHVlIiB9ICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU2VydmVyUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogTG9hZCB0aGUgdGFibGUgc3RhdGUuIFdpdGggdGhpcyBmdW5jdGlvbiB5b3UgY2FuIGRlZmluZSBmcm9tIHdoZXJlLCBhbmQgaG93LCB0aGUKCQkgKiBzdGF0ZSBvZiBhIHRhYmxlIGlzIGxvYWRlZC4gQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9hZCBmcm9tIGl0cyBzdGF0ZSBzYXZpbmcKCQkgKiBjb29raWUsIGJ1dCB5b3UgbWlnaHQgd2lzaCB0byB1c2UgbG9jYWwgc3RvcmFnZSAoSFRNTDUpIG9yIGEgc2VydmVyLXNpZGUgZGF0YWJhc2UuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBtZW1iZXIKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJuIHtvYmplY3R9IFRoZSBEYXRhVGFibGVzIHN0YXRlIG9iamVjdCB0byBiZSBsb2FkZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkIjogZnVuY3Rpb24gKG9TZXR0aW5ncykgewoJCSAqICAgICAgICAgIHZhciBvOwoJCSAqICAgICAgICAgIAoJCSAqICAgICAgICAgIC8vIFNlbmQgYW4gQWpheCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgdG8gZ2V0IHRoZSBkYXRhLiBOb3RlIHRoYXQKCQkgKiAgICAgICAgICAvLyB0aGlzIGlzIGEgc3luY2hyb25vdXMgcmVxdWVzdC4KCQkgKiAgICAgICAgICAkLmFqYXgoIHsKCQkgKiAgICAgICAgICAgICJ1cmwiOiAiL3N0YXRlX2xvYWQiLAoJCSAqICAgICAgICAgICAgImFzeW5jIjogZmFsc2UsCgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAianNvbiIsCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZ1bmN0aW9uIChqc29uKSB7CgkJICogICAgICAgICAgICAgIG8gPSBqc29uOwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICByZXR1cm4gbzsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZUxvYWQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncyApIHsKCQkJdmFyIHNEYXRhID0gdGhpcy5vQXBpLl9mblJlYWRDb29raWUoIG9TZXR0aW5ncy5zQ29va2llUHJlZml4K29TZXR0aW5ncy5zSW5zdGFuY2UgKTsKCQkJdmFyIG9EYXRhOwoJCgkJCXRyeSB7CgkJCQlvRGF0YSA9ICh0eXBlb2YgJC5wYXJzZUpTT04gPT09ICdmdW5jdGlvbicpID8gCgkJCQkJJC5wYXJzZUpTT04oc0RhdGEpIDogZXZhbCggJygnK3NEYXRhKycpJyApOwoJCQl9IGNhdGNoIChlKSB7CgkJCQlvRGF0YSA9IG51bGw7CgkJCX0KCQoJCQlyZXR1cm4gb0RhdGE7CgkJfSwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgd2hpY2ggYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc2F2ZWQgc3RhdGUgcHJpb3IgdG8gbG9hZGluZyB0aGF0IHN0YXRlLgoJCSAqIFRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gdGhlIHRhYmxlIGlzIGxvYWRpbmcgc3RhdGUgZnJvbSB0aGUgc3RvcmVkIGRhdGEsIGJ1dAoJCSAqIHByaW9yIHRvIHRoZSBzZXR0aW5ncyBvYmplY3QgYmVpbmcgbW9kaWZpZWQgYnkgdGhlIHNhdmVkIHN0YXRlLiBOb3RlIHRoYXQgZm9yIAoJCSAqIHBsdWctaW4gYXV0aG9ycywgeW91IHNob3VsZCB1c2UgdGhlICdzdGF0ZUxvYWRQYXJhbXMnIGV2ZW50IHRvIGxvYWQgcGFyYW1ldGVycyBmb3IgCgkJICogYSBwbHVnLWluLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRoYXQgaXMgdG8gYmUgbG9hZGVkCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSZW1vdmUgYSBzYXZlZCBmaWx0ZXIsIHNvIGZpbHRlcmluZyBpcyBuZXZlciBsb2FkZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZFBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgb0RhdGEub1NlYXJjaC5zU2VhcmNoID0gIiI7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gRGlzYWxsb3cgc3RhdGUgbG9hZGluZyBieSByZXR1cm5pbmcgZmFsc2UKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZFBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlTG9hZFBhcmFtcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHRoYXQgaXMgY2FsbGVkIHdoZW4gdGhlIHN0YXRlIGhhcyBiZWVuIGxvYWRlZCBmcm9tIHRoZSBzdGF0ZSBzYXZpbmcgbWV0aG9kCgkJICogYW5kIHRoZSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCBoYXMgYmVlbiBtb2RpZmllZCBhcyBhIHJlc3VsdCBvZiB0aGUgbG9hZGVkIHN0YXRlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRoYXQgd2FzIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gU2hvdyBhbiBhbGVydCB3aXRoIHRoZSBmaWx0ZXJpbmcgdmFsdWUgdGhhdCB3YXMgc2F2ZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZGVkIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBhbGVydCggJ1NhdmVkIGZpbHRlciB3YXM6ICcrb0RhdGEub1NlYXJjaC5zU2VhcmNoICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVMb2FkZWQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBTYXZlIHRoZSB0YWJsZSBzdGF0ZS4gVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvIGRlZmluZSB3aGVyZSBhbmQgaG93IHRoZSBzdGF0ZQoJCSAqIGluZm9ybWF0aW9uIGZvciB0aGUgdGFibGUgaXMgc3RvcmVkIC0gYnkgZGVmYXVsdCBpdCB3aWxsIHVzZSBhIGNvb2tpZSwgYnV0IHlvdQoJCSAqIG1pZ2h0IHdhbnQgdG8gdXNlIGxvY2FsIHN0b3JhZ2UgKEhUTUw1KSBvciBhIHNlcnZlci1zaWRlIGRhdGFiYXNlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdG8gYmUgc2F2ZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVTYXZlIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICAvLyBTZW5kIGFuIEFqYXggcmVxdWVzdCB0byB0aGUgc2VydmVyIHdpdGggdGhlIHN0YXRlIG9iamVjdAoJCSAqICAgICAgICAgICQuYWpheCggewoJCSAqICAgICAgICAgICAgInVybCI6ICIvc3RhdGVfc2F2ZSIsCgkJICogICAgICAgICAgICAiZGF0YSI6IG9EYXRhLAoJCSAqICAgICAgICAgICAgImRhdGFUeXBlIjogImpzb24iLAoJCSAqICAgICAgICAgICAgIm1ldGhvZCI6ICJQT1NUIgoJCSAqICAgICAgICAgICAgInN1Y2Nlc3MiOiBmdW5jdGlvbiAoKSB7fQoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgb0RhdGEgKSB7CgkJCXRoaXMub0FwaS5fZm5DcmVhdGVDb29raWUoIAoJCQkJb1NldHRpbmdzLnNDb29raWVQcmVmaXgrb1NldHRpbmdzLnNJbnN0YW5jZSwgCgkJCQl0aGlzLm9BcGkuX2ZuSnNvblN0cmluZyhvRGF0YSksIAoJCQkJb1NldHRpbmdzLmlDb29raWVEdXJhdGlvbiwgCgkJCQlvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCwgCgkJCQlvU2V0dGluZ3MuZm5Db29raWVDYWxsYmFjawoJCQkpOwoJCX0sCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHdoaWNoIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHN0YXRlIHRvIGJlIHNhdmVkLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgCgkJICogaGFzIGNoYW5nZWQgc3RhdGUgYSBuZXcgc3RhdGUgc2F2ZSBpcyByZXF1aXJlZC4gVGhpcyBtZXRob2QgYWxsb3dzIG1vZGlmaWNhdGlvbiBvZgoJCSAqIHRoZSBzdGF0ZSBzYXZpbmcgb2JqZWN0IHByaW9yIHRvIGFjdHVhbGx5IGRvaW5nIHRoZSBzYXZlLCBpbmNsdWRpbmcgYWRkaXRpb24gb3IgCgkJICogb3RoZXIgc3RhdGUgcHJvcGVydGllcyBvciBtb2RpZmljYXRpb24uIE5vdGUgdGhhdCBmb3IgcGx1Zy1pbiBhdXRob3JzLCB5b3Ugc2hvdWxkIAoJCSAqIHVzZSB0aGUgJ3N0YXRlU2F2ZVBhcmFtcycgZXZlbnQgdG8gc2F2ZSBwYXJhbWV0ZXJzIGZvciBhIHBsdWctaW4uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdG8gYmUgc2F2ZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFJlbW92ZSBhIHNhdmVkIGZpbHRlciwgc28gZmlsdGVyaW5nIGlzIG5ldmVyIHNhdmVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZVNhdmVQYXJhbXMiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIG9EYXRhLm9TZWFyY2guc1NlYXJjaCA9ICIiOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlU2F2ZVBhcmFtcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIER1cmF0aW9uIG9mIHRoZSBjb29raWUgd2hpY2ggaXMgdXNlZCBmb3Igc3RvcmluZyBzZXNzaW9uIGluZm9ybWF0aW9uLiBUaGlzCgkJICogdmFsdWUgaXMgZ2l2ZW4gaW4gc2Vjb25kcy4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDcyMDAgPGk+KDIgaG91cnMpPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpQ29va2llRHVyYXRpb24iOiA2MCo2MCoyNDsgLy8gMSBkYXkKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaUNvb2tpZUR1cmF0aW9uIjogNzIwMCwKCQoJCgkJLyoqCgkJICogV2hlbiBlbmFibGVkIERhdGFUYWJsZXMgd2lsbCBub3QgbWFrZSBhIHJlcXVlc3QgdG8gdGhlIHNlcnZlciBmb3IgdGhlIGZpcnN0CgkJICogcGFnZSBkcmF3IC0gcmF0aGVyIGl0IHdpbGwgdXNlIHRoZSBkYXRhIGFscmVhZHkgb24gdGhlIHBhZ2UgKG5vIHNvcnRpbmcgZXRjCgkJICogd2lsbCBiZSBhcHBsaWVkIHRvIGl0KSwgdGh1cyBzYXZpbmcgb24gYW4gWEhSIGF0IGxvYWQgdGltZS4gaURlZmVyTG9hZGluZwoJCSAqIGlzIHVzZWQgdG8gaW5kaWNhdGUgdGhhdCBkZWZlcnJlZCBsb2FkaW5nIGlzIHJlcXVpcmVkLCBidXQgaXQgaXMgYWxzbyB1c2VkCgkJICogdG8gdGVsbCBEYXRhVGFibGVzIGhvdyBtYW55IHJlY29yZHMgdGhlcmUgYXJlIGluIHRoZSBmdWxsIHRhYmxlIChhbGxvd2luZwoJCSAqIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGFuZCBwYWdpbmF0aW9uIHRvIGJlIGRpc3BsYXllZCBjb3JyZWN0bHkpLiBJbiB0aGUgY2FzZQoJCSAqIHdoZXJlIGEgZmlsdGVyaW5nIGlzIGFwcGxpZWQgdG8gdGhlIHRhYmxlIG9uIGluaXRpYWwgbG9hZCwgdGhpcyBjYW4gYmUKCQkgKiBpbmRpY2F0ZWQgYnkgZ2l2aW5nIHRoZSBwYXJhbWV0ZXIgYXMgYW4gYXJyYXksIHdoZXJlIHRoZSBmaXJzdCBlbGVtZW50IGlzCgkJICogdGhlIG51bWJlciBvZiByZWNvcmRzIGF2YWlsYWJsZSBhZnRlciBmaWx0ZXJpbmcgYW5kIHRoZSBzZWNvbmQgZWxlbWVudCBpcyB0aGUKCQkgKiBudW1iZXIgb2YgcmVjb3JkcyB3aXRob3V0IGZpbHRlcmluZyAoYWxsb3dpbmcgdGhlIHRhYmxlIGluZm9ybWF0aW9uIGVsZW1lbnQKCQkgKiB0byBiZSBzaG93biBjb3JyZWN0bHkpLgoJCSAqICBAdHlwZSBpbnQgfCBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gNTcgcmVjb3JkcyBhdmFpbGFibGUgaW4gdGhlIHRhYmxlLCBubyBmaWx0ZXJpbmcgYXBwbGllZAoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3NlcnZlcl9wcm9jZXNzaW5nLnBocCIsCgkJICogICAgICAgICJpRGVmZXJMb2FkaW5nIjogNTcKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gNTcgcmVjb3JkcyBhZnRlciBmaWx0ZXJpbmcsIDEwMCB3aXRob3V0IGZpbHRlcmluZyAoYW4gaW5pdGlhbCBmaWx0ZXIgYXBwbGllZCkKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiaURlZmVyTG9hZGluZyI6IFsgNTcsIDEwMCBdLAoJCSAqICAgICAgICAib1NlYXJjaCI6IHsKCQkgKiAgICAgICAgICAic1NlYXJjaCI6ICJteV9maWx0ZXIiCgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlEZWZlckxvYWRpbmciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBOdW1iZXIgb2Ygcm93cyB0byBkaXNwbGF5IG9uIGEgc2luZ2xlIHBhZ2Ugd2hlbiB1c2luZyBwYWdpbmF0aW9uLiBJZgoJCSAqIGZlYXR1cmUgZW5hYmxlZCAoYkxlbmd0aENoYW5nZSkgdGhlbiB0aGUgZW5kIHVzZXIgd2lsbCBiZSBhYmxlIHRvIG92ZXJyaWRlCgkJICogdGhpcyB0byBhIGN1c3RvbSBzZXR0aW5nIHVzaW5nIGEgcG9wLXVwIG1lbnUuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUwCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImlEaXNwbGF5TGVuZ3RoIjogMTAsCgkKCQoJCS8qKgoJCSAqIERlZmluZSB0aGUgc3RhcnRpbmcgcG9pbnQgZm9yIGRhdGEgZGlzcGxheSB3aGVuIHVzaW5nIERhdGFUYWJsZXMgd2l0aAoJCSAqIHBhZ2luYXRpb24uIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciBpcyB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJhdGhlciB0aGFuCgkJICogdGhlIHBhZ2UgbnVtYmVyLCBzbyBpZiB5b3UgaGF2ZSAxMCByZWNvcmRzIHBlciBwYWdlIGFuZCB3YW50IHRvIHN0YXJ0IG9uCgkJICogdGhlIHRoaXJkIHBhZ2UsIGl0IHNob3VsZCBiZSAiMjAiLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheVN0YXJ0IjogMjAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaURpc3BsYXlTdGFydCI6IDAsCgkKCQoJCS8qKgoJCSAqIFRoZSBzY3JvbGwgZ2FwIGlzIHRoZSBhbW91bnQgb2Ygc2Nyb2xsaW5nIHRoYXQgaXMgbGVmdCB0byBnbyBiZWZvcmUKCQkgKiBEYXRhVGFibGVzIHdpbGwgbG9hZCB0aGUgbmV4dCAncGFnZScgb2YgZGF0YSBhdXRvbWF0aWNhbGx5LiBZb3UgdHlwaWNhbGx5CgkJICogd2FudCBhIGdhcCB3aGljaCBpcyBiaWcgZW5vdWdoIHRoYXQgdGhlIHNjcm9sbGluZyB3aWxsIGJlIHNtb290aCBmb3IgdGhlCgkJICogdXNlciwgd2hpbGUgbm90IHNvIGxhcmdlIHRoYXQgaXQgd2lsbCBsb2FkIG1vcmUgZGF0YSB0aGFuIG5lZWQuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNjcm9sbEluZmluaXRlIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUsCgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJpU2Nyb2xsTG9hZEdhcCI6IDUwCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpU2Nyb2xsTG9hZEdhcCI6IDEwMCwKCQoJCgkJLyoqCgkJICogQnkgZGVmYXVsdCBEYXRhVGFibGVzIGFsbG93cyBrZXlib2FyZCBuYXZpZ2F0aW9uIG9mIHRoZSB0YWJsZSAoc29ydGluZywgcGFnaW5nLAoJCSAqIGFuZCBmaWx0ZXJpbmcpIGJ5IGFkZGluZyBhIHRhYmluZGV4IGF0dHJpYnV0ZSB0byB0aGUgcmVxdWlyZWQgZWxlbWVudHMuIFRoaXMKCQkgKiBhbGxvd3MgeW91IHRvIHRhYiB0aHJvdWdoIHRoZSBjb250cm9scyBhbmQgcHJlc3MgdGhlIGVudGVyIGtleSB0byBhY3RpdmF0ZSB0aGVtLgoJCSAqIFRoZSB0YWJpbmRleCBpcyBkZWZhdWx0IDAsIG1lYW5pbmcgdGhhdCB0aGUgdGFiIGZvbGxvd3MgdGhlIGZsb3cgb2YgdGhlIGRvY3VtZW50LgoJCSAqIFlvdSBjYW4gb3ZlcnJ1bGUgdGhpcyB1c2luZyB0aGlzIHBhcmFtZXRlciBpZiB5b3Ugd2lzaC4gVXNlIGEgdmFsdWUgb2YgLTEgdG8KCQkgKiBkaXNhYmxlIGJ1aWx0LWluIGtleWJvYXJkIG5hdmlnYXRpb24uCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlUYWJJbmRleCI6IDEKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlUYWJJbmRleCI6IDAsCgkKCQoJCS8qKgoJCSAqIEFsbCBzdHJpbmdzIHRoYXQgRGF0YVRhYmxlcyB1c2VzIGluIHRoZSB1c2VyIGludGVyZmFjZSB0aGF0IGl0IGNyZWF0ZXMKCQkgKiBhcmUgZGVmaW5lZCBpbiB0aGlzIG9iamVjdCwgYWxsb3dpbmcgeW91IHRvIG1vZGlmaWVkIHRoZW0gaW5kaXZpZHVhbGx5IG9yCgkJICogY29tcGxldGVseSByZXBsYWNlIHRoZW0gYWxsIGFzIHJlcXVpcmVkLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJIm9MYW5ndWFnZSI6IHsKCQkJLyoqCgkJCSAqIFN0cmluZ3MgdGhhdCBhcmUgdXNlZCBmb3IgV0FJLUFSSUEgbGFiZWxzIGFuZCBjb250cm9scyBvbmx5ICh0aGVzZSBhcmUgbm90CgkJCSAqIGFjdHVhbGx5IHZpc2libGUgb24gdGhlIHBhZ2UsIGJ1dCB3aWxsIGJlIHJlYWQgYnkgc2NyZWVucmVhZGVycywgYW5kIHRodXMKCQkJICogbXVzdCBiZSBpbnRlcm5hdGlvbmFsaXNlZCBhcyB3ZWxsKS4KCQkJICogIEBuYW1lc3BhY2UKCQkJICovCgkJCSJvQXJpYSI6IHsKCQkJCS8qKgoJCQkJICogQVJJQSBsYWJlbCB0aGF0IGlzIGFkZGVkIHRvIHRoZSB0YWJsZSBoZWFkZXJzIHdoZW4gdGhlIGNvbHVtbiBtYXkgYmUKCQkJCSAqIHNvcnRlZCBhc2NlbmRpbmcgYnkgYWN0aXZpbmcgdGhlIGNvbHVtbiAoY2xpY2sgb3IgcmV0dXJuIHdoZW4gZm9jdXNlZCkuCgkJCQkgKiBOb3RlIHRoYXQgdGhlIGNvbHVtbiBoZWFkZXIgaXMgcHJlZml4ZWQgdG8gdGhpcyBzdHJpbmcuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmcKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvQXJpYSI6IHsKCQkJCSAqICAgICAgICAgICAgInNTb3J0QXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGFzY2VuZGluZyIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNTb3J0QXNjZW5kaW5nIjogIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nIiwKCQoJCQkJLyoqCgkJCQkgKiBBUklBIGxhYmVsIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHRhYmxlIGhlYWRlcnMgd2hlbiB0aGUgY29sdW1uIG1heSBiZQoJCQkJICogc29ydGVkIGRlc2NlbmRpbmcgYnkgYWN0aXZpbmcgdGhlIGNvbHVtbiAoY2xpY2sgb3IgcmV0dXJuIHdoZW4gZm9jdXNlZCkuCgkJCQkgKiBOb3RlIHRoYXQgdGhlIGNvbHVtbiBoZWFkZXIgaXMgcHJlZml4ZWQgdG8gdGhpcyBzdHJpbmcuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmcKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvQXJpYSI6IHsKCQkJCSAqICAgICAgICAgICAgInNTb3J0RGVzY2VuZGluZyI6ICIgLSBjbGljay9yZXR1cm4gdG8gc29ydCBkZXNjZW5kaW5nIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic1NvcnREZXNjZW5kaW5nIjogIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gZGVzY2VuZGluZyIKCQkJfSwKCQoJCQkvKioKCQkJICogUGFnaW5hdGlvbiBzdHJpbmcgdXNlZCBieSBEYXRhVGFibGVzIGZvciB0aGUgdHdvIGJ1aWx0LWluIHBhZ2luYXRpb24KCQkJICogY29udHJvbCB0eXBlcyAoInR3b19idXR0b24iIGFuZCAiZnVsbF9udW1iZXJzIikKCQkJICogIEBuYW1lc3BhY2UKCQkJICovCgkJCSJvUGFnaW5hdGUiOiB7CgkJCQkvKioKCQkJCSAqIFRleHQgdG8gdXNlIHdoZW4gdXNpbmcgdGhlICdmdWxsX251bWJlcnMnIHR5cGUgb2YgcGFnaW5hdGlvbiBmb3IgdGhlCgkJCQkgKiBidXR0b24gdG8gdGFrZSB0aGUgdXNlciB0byB0aGUgZmlyc3QgcGFnZS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBGaXJzdAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9QYWdpbmF0ZSI6IHsKCQkJCSAqICAgICAgICAgICAgInNGaXJzdCI6ICJGaXJzdCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic0ZpcnN0IjogIkZpcnN0IiwKCQkJCgkJCQoJCQkJLyoqCgkJCQkgKiBUZXh0IHRvIHVzZSB3aGVuIHVzaW5nIHRoZSAnZnVsbF9udW1iZXJzJyB0eXBlIG9mIHBhZ2luYXRpb24gZm9yIHRoZQoJCQkJICogYnV0dG9uIHRvIHRha2UgdGhlIHVzZXIgdG8gdGhlIGxhc3QgcGFnZS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBMYXN0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic0xhc3QiOiAiTGFzdCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic0xhc3QiOiAiTGFzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2UgZm9yIHRoZSAnbmV4dCcgcGFnaW5hdGlvbiBidXR0b24gKHRvIHRha2UgdGhlIHVzZXIgdG8gdGhlIAoJCQkJICogbmV4dCBwYWdlKS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBOZXh0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic05leHQiOiAiTmV4dCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic05leHQiOiAiTmV4dCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2UgZm9yIHRoZSAncHJldmlvdXMnIHBhZ2luYXRpb24gYnV0dG9uICh0byB0YWtlIHRoZSB1c2VyIHRvICAKCQkJCSAqIHRoZSBwcmV2aW91cyBwYWdlKS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBQcmV2aW91cwoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9QYWdpbmF0ZSI6IHsKCQkJCSAqICAgICAgICAgICAgInNQcmV2aW91cyI6ICJQcmV2aW91cyBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic1ByZXZpb3VzIjogIlByZXZpb3VzIgoJCQl9LAoJCQoJCQkvKioKCQkJICogVGhpcyBzdHJpbmcgaXMgc2hvd24gaW4gcHJlZmVyZW5jZSB0byBzWmVyb1JlY29yZHMgd2hlbiB0aGUgdGFibGUgaXMKCQkJICogZW1wdHkgb2YgZGF0YSAocmVnYXJkbGVzcyBvZiBmaWx0ZXJpbmcpLiBOb3RlIHRoYXQgdGhpcyBpcyBhbiBvcHRpb25hbAoJCQkgKiBwYXJhbWV0ZXIgLSBpZiBpdCBpcyBub3QgZ2l2ZW4sIHRoZSB2YWx1ZSBvZiBzWmVyb1JlY29yZHMgd2lsbCBiZSB1c2VkCgkJCSAqIGluc3RlYWQgKGVpdGhlciB0aGUgZGVmYXVsdCBvciBnaXZlbiB2YWx1ZSkuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IE5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBUaGlzIHN0cmluZyBnaXZlcyBpbmZvcm1hdGlvbiB0byB0aGUgZW5kIHVzZXIgYWJvdXQgdGhlIGluZm9ybWF0aW9uIHRoYXQgCgkJCSAqIGlzIGN1cnJlbnQgb24gZGlzcGxheSBvbiB0aGUgcGFnZS4gVGhlIF9TVEFSVF8sIF9FTkRfIGFuZCBfVE9UQUxfIAoJCQkgKiB2YXJpYWJsZXMgYXJlIGFsbCBkeW5hbWljYWxseSByZXBsYWNlZCBhcyB0aGUgdGFibGUgZGlzcGxheSB1cGRhdGVzLCBhbmQgCgkJCSAqIGNhbiBiZSBmcmVlbHkgbW92ZWQgb3IgcmVtb3ZlZCBhcyB0aGUgbGFuZ3VhZ2UgcmVxdWlyZW1lbnRzIGNoYW5nZS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0luZm8iOiAiR290IGEgdG90YWwgb2YgX1RPVEFMXyBlbnRyaWVzIHRvIHNob3cgKF9TVEFSVF8gdG8gX0VORF8pIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNJbmZvIjogIlNob3dpbmcgX1NUQVJUXyB0byBfRU5EXyBvZiBfVE9UQUxfIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogRGlzcGxheSBpbmZvcm1hdGlvbiBzdHJpbmcgZm9yIHdoZW4gdGhlIHRhYmxlIGlzIGVtcHR5LiBUeXBpY2FsbHkgdGhlIAoJCQkgKiBmb3JtYXQgb2YgdGhpcyBzdHJpbmcgc2hvdWxkIG1hdGNoIHNJbmZvLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBTaG93aW5nIDAgdG8gMCBvZiAwIGVudHJpZXMKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNJbmZvRW1wdHkiOiAiTm8gZW50cmllcyB0byBzaG93IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNJbmZvRW1wdHkiOiAiU2hvd2luZyAwIHRvIDAgb2YgMCBlbnRyaWVzIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFdoZW4gYSB1c2VyIGZpbHRlcnMgdGhlIGluZm9ybWF0aW9uIGluIGEgdGFibGUsIHRoaXMgc3RyaW5nIGlzIGFwcGVuZGVkIAoJCQkgKiB0byB0aGUgaW5mb3JtYXRpb24gKHNJbmZvKSB0byBnaXZlIGFuIGlkZWEgb2YgaG93IHN0cm9uZyB0aGUgZmlsdGVyaW5nIAoJCQkgKiBpcy4gVGhlIHZhcmlhYmxlIF9NQVhfIGlzIGR5bmFtaWNhbGx5IHVwZGF0ZWQuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IChmaWx0ZXJlZCBmcm9tIF9NQVhfIHRvdGFsIGVudHJpZXMpCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0ZpbHRlcmVkIjogIiAtIGZpbHRlcmluZyBmcm9tIF9NQVhfIHJlY29yZHMiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9GaWx0ZXJlZCI6ICIoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBJZiBjYW4gYmUgdXNlZnVsIHRvIGFwcGVuZCBleHRyYSBpbmZvcm1hdGlvbiB0byB0aGUgaW5mbyBzdHJpbmcgYXQgdGltZXMsCgkJCSAqIGFuZCB0aGlzIHZhcmlhYmxlIGRvZXMgZXhhY3RseSB0aGF0LiBUaGlzIGluZm9ybWF0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8KCQkJICogdGhlIHNJbmZvIChzSW5mb0VtcHR5IGFuZCBzSW5mb0ZpbHRlcmVkIGluIHdoYXRldmVyIGNvbWJpbmF0aW9uIHRoZXkgYXJlCgkJCSAqIGJlaW5nIHVzZWQpIGF0IGFsbCB0aW1lcy4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0luZm9Qb3N0Rml4IjogIkFsbCByZWNvcmRzIHNob3duIGFyZSBkZXJpdmVkIGZyb20gcmVhbCBpbmZvcm1hdGlvbi4iCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9Qb3N0Rml4IjogIiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEYXRhVGFibGVzIGhhcyBhIGJ1aWxkIGluIG51bWJlciBmb3JtYXR0ZXIgKGZuRm9ybWF0TnVtYmVyKSB3aGljaCBpcyB1c2VkCgkJCSAqIHRvIGZvcm1hdCBsYXJnZSBudW1iZXJzIHRoYXQgYXJlIHVzZWQgaW4gdGhlIHRhYmxlIGluZm9ybWF0aW9uLiBCeQoJCQkgKiBkZWZhdWx0IGEgY29tbWEgaXMgdXNlZCwgYnV0IHRoaXMgY2FuIGJlIHRyaXZpYWxseSBjaGFuZ2VkIHRvIGFueQoJCQkgKiBjaGFyYWN0ZXIgeW91IHdpc2ggd2l0aCB0aGlzIHBhcmFtZXRlci4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgLAoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0luZm9UaG91c2FuZHMiOiAiJyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb1Rob3VzYW5kcyI6ICIsIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERldGFpbCB0aGUgYWN0aW9uIHRoYXQgd2lsbCBiZSB0YWtlbiB3aGVuIHRoZSBkcm9wIGRvd24gbWVudSBmb3IgdGhlCgkJCSAqIHBhZ2luYXRpb24gbGVuZ3RoIG9wdGlvbiBpcyBjaGFuZ2VkLiBUaGUgJ19NRU5VXycgdmFyaWFibGUgaXMgcmVwbGFjZWQKCQkJICogd2l0aCBhIGRlZmF1bHQgc2VsZWN0IGxpc3Qgb2YgMTAsIDI1LCA1MCBhbmQgMTAwLCBhbmQgY2FuIGJlIHJlcGxhY2VkCgkJCSAqIHdpdGggYSBjdXN0b20gc2VsZWN0IGJveCBpZiByZXF1aXJlZC4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2hvdyBfTUVOVV8gZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgLy8gTGFuZ3VhZ2UgY2hhbmdlIG9ubHkKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0xlbmd0aE1lbnUiOiAiRGlzcGxheSBfTUVOVV8gcmVjb3JkcyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBMYW5ndWFnZSBhbmQgb3B0aW9ucyBjaGFuZ2UKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0xlbmd0aE1lbnUiOiAnRGlzcGxheSA8c2VsZWN0PicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjEwIj4xMDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjIwIj4yMDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjMwIj4zMDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjQwIj40MDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9IjUwIj41MDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9Ii0xIj5BbGw8L29wdGlvbj4nKwoJCQkgKiAgICAgICAgICAgICc8L3NlbGVjdD4gcmVjb3JkcycKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzTGVuZ3RoTWVudSI6ICJTaG93IF9NRU5VXyBlbnRyaWVzIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFdoZW4gdXNpbmcgQWpheCBzb3VyY2VkIGRhdGEgYW5kIGR1cmluZyB0aGUgZmlyc3QgZHJhdyB3aGVuIERhdGFUYWJsZXMgaXMKCQkJICogZ2F0aGVyaW5nIHRoZSBkYXRhLCB0aGlzIG1lc3NhZ2UgaXMgc2hvd24gaW4gYW4gZW1wdHkgcm93IGluIHRoZSB0YWJsZSB0bwoJCQkgKiBpbmRpY2F0ZSB0byB0aGUgZW5kIHVzZXIgdGhlIHRoZSBkYXRhIGlzIGJlaW5nIGxvYWRlZC4gTm90ZSB0aGF0IHRoaXMKCQkJICogcGFyYW1ldGVyIGlzIG5vdCB1c2VkIHdoZW4gbG9hZGluZyBkYXRhIGJ5IHNlcnZlci1zaWRlIHByb2Nlc3NpbmcsIGp1c3QKCQkJICogQWpheCBzb3VyY2VkIGRhdGEgd2l0aCBjbGllbnQtc2lkZSBwcm9jZXNzaW5nLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBMb2FkaW5nLi4uCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTG9hZGluZ1JlY29yZHMiOiAiUGxlYXNlIHdhaXQgLSBsb2FkaW5nLi4uIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNMb2FkaW5nUmVjb3JkcyI6ICJMb2FkaW5nLi4uIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFRleHQgd2hpY2ggaXMgZGlzcGxheWVkIHdoZW4gdGhlIHRhYmxlIGlzIHByb2Nlc3NpbmcgYSB1c2VyIGFjdGlvbgoJCQkgKiAodXN1YWxseSBhIHNvcnQgY29tbWFuZCBvciBzaW1pbGFyKS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgUHJvY2Vzc2luZy4uLgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic1Byb2Nlc3NpbmciOiAiRGF0YVRhYmxlcyBpcyBjdXJyZW50bHkgYnVzeSIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzUHJvY2Vzc2luZyI6ICJQcm9jZXNzaW5nLi4uIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERldGFpbHMgdGhlIGFjdGlvbnMgdGhhdCB3aWxsIGJlIHRha2VuIHdoZW4gdGhlIHVzZXIgdHlwZXMgaW50byB0aGUKCQkJICogZmlsdGVyaW5nIGlucHV0IHRleHQgYm94LiBUaGUgdmFyaWFibGUgIl9JTlBVVF8iLCBpZiB1c2VkIGluIHRoZSBzdHJpbmcsCgkJCSAqIGlzIHJlcGxhY2VkIHdpdGggdGhlIEhUTUwgdGV4dCBib3ggZm9yIHRoZSBmaWx0ZXJpbmcgaW5wdXQgYWxsb3dpbmcKCQkJICogY29udHJvbCBvdmVyIHdoZXJlIGl0IGFwcGVhcnMgaW4gdGhlIHN0cmluZy4gSWYgIl9JTlBVVF8iIGlzIG5vdCBnaXZlbgoJCQkgKiB0aGVuIHRoZSBpbnB1dCBib3ggaXMgYXBwZW5kZWQgdG8gdGhlIHN0cmluZyBhdXRvbWF0aWNhbGx5LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBTZWFyY2g6CgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBJbnB1dCB0ZXh0IGJveCB3aWxsIGJlIGFwcGVuZGVkIGF0IHRoZSBlbmQgYXV0b21hdGljYWxseQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzU2VhcmNoIjogIkZpbHRlciByZWNvcmRzOiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBTcGVjaWZ5IHdoZXJlIHRoZSBmaWx0ZXIgc2hvdWxkIGFwcGVhcgoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzU2VhcmNoIjogIkFwcGx5IGZpbHRlciBfSU5QVVRfIHRvIHRhYmxlIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNTZWFyY2giOiAiU2VhcmNoOiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBBbGwgb2YgdGhlIGxhbmd1YWdlIGluZm9ybWF0aW9uIGNhbiBiZSBzdG9yZWQgaW4gYSBmaWxlIG9uIHRoZQoJCQkgKiBzZXJ2ZXItc2lkZSwgd2hpY2ggRGF0YVRhYmxlcyB3aWxsIGxvb2sgdXAgaWYgdGhpcyBwYXJhbWV0ZXIgaXMgcGFzc2VkLgoJCQkgKiBJdCBtdXN0IHN0b3JlIHRoZSBVUkwgb2YgdGhlIGxhbmd1YWdlIGZpbGUsIHdoaWNoIGlzIGluIGEgSlNPTiBmb3JtYXQsCgkJCSAqIGFuZCB0aGUgb2JqZWN0IGhhcyB0aGUgc2FtZSBwcm9wZXJ0aWVzIGFzIHRoZSBvTGFuZ3VhZ2Ugb2JqZWN0IGluIHRoZQoJCQkgKiBpbml0aWFsaXNlciBvYmplY3QgKGkuZS4gdGhlIGFib3ZlIHBhcmFtZXRlcnMpLiBQbGVhc2UgcmVmZXIgdG8gb25lIG9mCgkJCSAqIHRoZSBleGFtcGxlIGxhbmd1YWdlIGZpbGVzIHRvIHNlZSBob3cgdGhpcyB3b3JrcyBpbiBhY3Rpb24uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzVXJsIjogImh0dHA6Ly93d3cuc3ByeW1lZGlhLmNvLnVrL2RhdGFUYWJsZXMvbGFuZy50eHQiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1VybCI6ICIiLAoJCQoJCQoJCQkvKioKCQkJICogVGV4dCBzaG93biBpbnNpZGUgdGhlIHRhYmxlIHJlY29yZHMgd2hlbiB0aGUgaXMgbm8gaW5mb3JtYXRpb24gdG8gYmUKCQkJICogZGlzcGxheWVkIGFmdGVyIGZpbHRlcmluZy4gc0VtcHR5VGFibGUgaXMgc2hvd24gd2hlbiB0aGVyZSBpcyBzaW1wbHkgbm8KCQkJICogaW5mb3JtYXRpb24gaW4gdGhlIHRhYmxlIGF0IGFsbCAocmVnYXJkbGVzcyBvZiBmaWx0ZXJpbmcpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBObyBtYXRjaGluZyByZWNvcmRzIGZvdW5kCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzWmVyb1JlY29yZHMiOiAiTm8gcmVjb3JkcyB0byBkaXNwbGF5IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNaZXJvUmVjb3JkcyI6ICJObyBtYXRjaGluZyByZWNvcmRzIGZvdW5kIgoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gaGF2ZSBkZWZpbmUgdGhlIGdsb2JhbCBmaWx0ZXJpbmcgc3RhdGUgYXQKCQkgKiBpbml0aWFsaXNhdGlvbiB0aW1lLiBBcyBhbiBvYmplY3QgdGhlICJzU2VhcmNoIiBwYXJhbWV0ZXIgbXVzdCBiZQoJCSAqIGRlZmluZWQsIGJ1dCBhbGwgb3RoZXIgcGFyYW1ldGVycyBhcmUgb3B0aW9uYWwuIFdoZW4gImJSZWdleCIgaXMgdHJ1ZSwKCQkgKiB0aGUgc2VhcmNoIHN0cmluZyB3aWxsIGJlIHRyZWF0ZWQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24sIHdoZW4gZmFsc2UKCQkgKiAoZGVmYXVsdCkgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgc3RyYWlnaHQgc3RyaW5nLiBXaGVuICJiU21hcnQiCgkJICogRGF0YVRhYmxlcyB3aWxsIHVzZSBpdCdzIHNtYXJ0IGZpbHRlcmluZyBtZXRob2RzICh0byB3b3JkIG1hdGNoIGF0CgkJICogYW55IHBvaW50IGluIHRoZSBkYXRhKSwgd2hlbiBmYWxzZSB0aGlzIHdpbGwgbm90IGJlIGRvbmUuCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgIm9TZWFyY2giOiB7InNTZWFyY2giOiAiSW5pdGlhbCBzZWFyY2gifQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJvU2VhcmNoIjogJC5leHRlbmQoIHt9LCBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2ggKSwKCQoJCgkJLyoqCgkJICogQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9vayBmb3IgdGhlIHByb3BlcnR5ICdhYURhdGEnIHdoZW4gb2J0YWluaW5nCgkJICogZGF0YSBmcm9tIGFuIEFqYXggc291cmNlIG9yIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gdGhpcyBwYXJhbWV0ZXIKCQkgKiBhbGxvd3MgdGhhdCBwcm9wZXJ0eSB0byBiZSBjaGFuZ2VkLiBZb3UgY2FuIHVzZSBKYXZhc2NyaXB0IGRvdHRlZCBvYmplY3QKCQkgKiBub3RhdGlvbiB0byBnZXQgYSBkYXRhIHNvdXJjZSBmb3IgbXVsdGlwbGUgbGV2ZWxzIG9mIG5lc3RpbmcuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhYURhdGEKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogWy4uLl0gfQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kYXRhLnR4dCIsCgkJICogICAgICAgICJzQWpheERhdGFQcm9wIjogImRhdGEiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEdldCBkYXRhIGZyb20geyAiZGF0YSI6IHsgImlubmVyIjogWy4uLl0gfSB9CgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RhdGEudHh0IiwKCQkgKiAgICAgICAgInNBamF4RGF0YVByb3AiOiAiZGF0YS5pbm5lciIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNBamF4RGF0YVByb3AiOiAiYWFEYXRhIiwKCQoJCgkJLyoqCgkJICogWW91IGNhbiBpbnN0cnVjdCBEYXRhVGFibGVzIHRvIGxvYWQgZGF0YSBmcm9tIGFuIGV4dGVybmFsIHNvdXJjZSB1c2luZyB0aGlzCgkJICogcGFyYW1ldGVyICh1c2UgYURhdGEgaWYgeW91IHdhbnQgdG8gcGFzcyBkYXRhIGluIHlvdSBhbHJlYWR5IGhhdmUpLiBTaW1wbHkKCQkgKiBwcm92aWRlIGEgdXJsIGEgSlNPTiBvYmplY3QgY2FuIGJlIG9idGFpbmVkIGZyb20uIFRoaXMgb2JqZWN0IG11c3QgaW5jbHVkZQoJCSAqIHRoZSBwYXJhbWV0ZXIgJ2FhRGF0YScgd2hpY2ggaXMgdGhlIGRhdGEgc291cmNlIGZvciB0aGUgdGFibGUuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogIEBkdG9wdCBTZXJ2ZXItc2lkZQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJodHRwOi8vd3d3LnNwcnltZWRpYS5jby51ay9kYXRhVGFibGVzL2pzb24ucGhwIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJzQWpheFNvdXJjZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGNhbiBiZSB1c2VkIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHByZWZpeCB0aGF0IERhdGFUYWJsZXMKCQkgKiBhc3NpZ25zIHRvIGEgY29va2llIHdoZW4gc3RhdGUgc2F2aW5nIGlzIGVuYWJsZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBTcHJ5TWVkaWFfRGF0YVRhYmxlc18KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0Nvb2tpZVByZWZpeCI6ICJteV9kYXRhdGFibGVfIiwKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb29raWVQcmVmaXgiOiAiU3ByeU1lZGlhX0RhdGFUYWJsZXNfIiwKCQoJCgkJLyoqCgkJICogVGhpcyBpbml0aWFsaXNhdGlvbiB2YXJpYWJsZSBhbGxvd3MgeW91IHRvIHNwZWNpZnkgZXhhY3RseSB3aGVyZSBpbiB0aGUKCQkgKiBET00geW91IHdhbnQgRGF0YVRhYmxlcyB0byBpbmplY3QgdGhlIHZhcmlvdXMgY29udHJvbHMgaXQgYWRkcyB0byB0aGUgcGFnZQoJCSAqIChmb3IgZXhhbXBsZSB5b3UgbWlnaHQgd2FudCB0aGUgcGFnaW5hdGlvbiBjb250cm9scyBhdCB0aGUgdG9wIG9mIHRoZQoJCSAqIHRhYmxlKS4gRElWIGVsZW1lbnRzICh3aXRoIG9yIHdpdGhvdXQgYSBjdXN0b20gY2xhc3MpIGNhbiBhbHNvIGJlIGFkZGVkIHRvCgkJICogYWlkIHN0eWxpbmcuIFRoZSBmb2xsb3cgc3ludGF4IGlzIHVzZWQ6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5UaGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIGFsbG93ZWQ6CQoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nbCcgLSBMZW5ndGggY2hhbmdpbmc8L2xpCgkJICogICAgICAgICA8bGk+J2YnIC0gRmlsdGVyaW5nIGlucHV0PC9saT4KCQkgKiAgICAgICAgIDxsaT4ndCcgLSBUaGUgdGFibGUhPC9saT4KCQkgKiAgICAgICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3AnIC0gUGFnaW5hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3InIC0gcFJvY2Vzc2luZzwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgY29uc3RhbnRzIGFyZSBhbGxvd2VkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nSCcgLSBqUXVlcnlVSSB0aGVtZSAiaGVhZGVyIiBjbGFzc2VzICgnZmctdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci10bCB1aS1jb3JuZXItdHIgdWktaGVscGVyLWNsZWFyZml4Jyk8L2xpPgoJCSAqICAgICAgICAgPGxpPidGJyAtIGpRdWVyeVVJIHRoZW1lICJmb290ZXIiIGNsYXNzZXMgKCdmZy10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWJsIHVpLWNvcm5lci1iciB1aS1oZWxwZXItY2xlYXJmaXgnKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgc3ludGF4IGlzIGV4cGVjdGVkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OycgYW5kICcmZ3Q7JyAtIGRpdiBlbGVtZW50czwvbGk+CgkJICogICAgICAgICA8bGk+JyZsdDsiY2xhc3MiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhIGNsYXNzPC9saT4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyIjaWQiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhbiBJRDwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPkV4YW1wbGVzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyJ3cmFwcGVyImZsaXB0Jmd0Oyc8L2xpPgoJCSAqICAgICAgICAgPGxpPicmbHQ7bGYmbHQ7dCZndDtpcCZndDsnPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGxmcnRpcCA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgZmFsc2UpPC9pPiA8Yj5vcjwvYj4gCgkJICogICAgPCJIImxmcj50PCJGImlwPiA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgdHJ1ZSk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNEb20iOiAnJmx0OyJ0b3AiaSZndDtydCZsdDsiYm90dG9tImZscCZndDsmbHQ7ImNsZWFyIiZndDsnCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzRG9tIjogImxmcnRpcCIsCgkKCQoJCS8qKgoJCSAqIERhdGFUYWJsZXMgZmVhdHVyZXMgdHdvIGRpZmZlcmVudCBidWlsdC1pbiBwYWdpbmF0aW9uIGludGVyYWN0aW9uIG1ldGhvZHMKCQkgKiAoJ3R3b19idXR0b24nIG9yICdmdWxsX251bWJlcnMnKSB3aGljaCBwcmVzZW50IGRpZmZlcmVudCBwYWdlIGNvbnRyb2xzIHRvCgkJICogdGhlIGVuZCB1c2VyLiBGdXJ0aGVyIG1ldGhvZHMgY2FuIGJlIGFkZGVkIHVzaW5nIHRoZSBBUEkgKHNlZSBiZWxvdykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCB0d29fYnV0dG9uCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNQYWdpbmF0aW9uVHlwZSI6ICJmdWxsX251bWJlcnMiCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJInNQYWdpbmF0aW9uVHlwZSI6ICJ0d29fYnV0dG9uIiwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGhvcml6b250YWwgc2Nyb2xsaW5nLiBXaGVuIGEgdGFibGUgaXMgdG9vIHdpZGUgdG8gZml0IGludG8gYSBjZXJ0YWluCgkJICogbGF5b3V0LCBvciB5b3UgaGF2ZSBhIGxhcmdlIG51bWJlciBvZiBjb2x1bW5zIGluIHRoZSB0YWJsZSwgeW91IGNhbiBlbmFibGUKCQkgKiB4LXNjcm9sbGluZyB0byBzaG93IHRoZSB0YWJsZSBpbiBhIHZpZXdwb3J0LCB3aGljaCBjYW4gYmUgc2Nyb2xsZWQuIFRoaXMKCQkgKiBwcm9wZXJ0eSBjYW4gYmUgYW55IENTUyB1bml0LCBvciBhIG51bWJlciAoaW4gd2hpY2ggY2FzZSBpdCB3aWxsIGJlIHRyZWF0ZWQKCQkgKiBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWCI6ICIxMDAlIiwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTY3JvbGxYIjogIiIsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcHJvcGVydHkgY2FuIGJlIHVzZWQgdG8gZm9yY2UgYSBEYXRhVGFibGUgdG8gdXNlIG1vcmUgd2lkdGggdGhhbiBpdAoJCSAqIG1pZ2h0IG90aGVyd2lzZSBkbyB3aGVuIHgtc2Nyb2xsaW5nIGlzIGVuYWJsZWQuIEZvciBleGFtcGxlIGlmIHlvdSBoYXZlIGEKCQkgKiB0YWJsZSB3aGljaCByZXF1aXJlcyB0byBiZSB3ZWxsIHNwYWNlZCwgdGhpcyBwYXJhbWV0ZXIgaXMgdXNlZnVsIGZvcgoJCSAqICJvdmVyLXNpemluZyIgdGhlIHRhYmxlLCBhbmQgdGh1cyBmb3JjaW5nIHNjcm9sbGluZy4gVGhpcyBwcm9wZXJ0eSBjYW4gYnkKCQkgKiBhbnkgQ1NTIHVuaXQsIG9yIGEgbnVtYmVyIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHBpeGVsCgkJICogbWVhc3VyZW1lbnQpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+Ymxhbmsgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFgiOiAiMTAwJSIsCgkJICogICAgICAgICJzU2Nyb2xsWElubmVyIjogIjExMCUiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWElubmVyIjogIiIsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSB2ZXJ0aWNhbCBzY3JvbGxpbmcuIFZlcnRpY2FsIHNjcm9sbGluZyB3aWxsIGNvbnN0cmFpbiB0aGUgRGF0YVRhYmxlCgkJICogdG8gdGhlIGdpdmVuIGhlaWdodCwgYW5kIGVuYWJsZSBzY3JvbGxpbmcgZm9yIGFueSBkYXRhIHdoaWNoIG92ZXJmbG93cyB0aGUKCQkgKiBjdXJyZW50IHZpZXdwb3J0LiBUaGlzIGNhbiBiZSB1c2VkIGFzIGFuIGFsdGVybmF0aXZlIHRvIHBhZ2luZyB0byBkaXNwbGF5CgkJICogYSBsb3Qgb2YgZGF0YSBpbiBhIHNtYWxsIGFyZWEgKGFsdGhvdWdoIHBhZ2luZyBhbmQgc2Nyb2xsaW5nIGNhbiBib3RoIGJlCgkJICogZW5hYmxlZCBhdCB0aGUgc2FtZSB0aW1lKS4gVGhpcyBwcm9wZXJ0eSBjYW4gYmUgYW55IENTUyB1bml0LCBvciBhIG51bWJlcgoJCSAqIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1Njcm9sbFkiOiAiIiwKCQoJCgkJLyoqCgkJICogU2V0IHRoZSBIVFRQIG1ldGhvZCB0aGF0IGlzIHVzZWQgdG8gbWFrZSB0aGUgQWpheCBjYWxsIGZvciBzZXJ2ZXItc2lkZQoJCSAqIHByb2Nlc3Npbmcgb3IgQWpheCBzb3VyY2VkIGRhdGEuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBHRVQKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNjcmlwdHMvcG9zdC5waHAiLAoJCSAqICAgICAgICAic1NlcnZlck1ldGhvZCI6ICJQT1NUIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1NlcnZlck1ldGhvZCI6ICJHRVQiCgl9OwoJCgkKCQoJLyoqCgkgKiBDb2x1bW4gb3B0aW9ucyB0aGF0IGNhbiBiZSBnaXZlbiB0byBEYXRhVGFibGVzIGF0IGluaXRpYWxpc2F0aW9uIHRpbWUuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1ucyA9IHsKCQkvKioKCQkgKiBBbGxvd3MgYSBjb2x1bW4ncyBzb3J0aW5nIHRvIHRha2UgbXVsdGlwbGUgY29sdW1ucyBpbnRvIGFjY291bnQgd2hlbiAKCQkgKiBkb2luZyBhIHNvcnQuIEZvciBleGFtcGxlIGZpcnN0IG5hbWUgLyBsYXN0IG5hbWUgY29sdW1ucyBtYWtlIHNlbnNlIHRvIAoJCSAqIGRvIGEgbXVsdGktY29sdW1uIHNvcnQgb3ZlciB0aGUgdHdvIGNvbHVtbnMuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwgPGk+VGFrZXMgdGhlIHZhbHVlIG9mIHRoZSBjb2x1bW4gaW5kZXggYXV0b21hdGljYWxseTwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdLCAiYVRhcmdldHMiOiBbIDAgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMSwgMCBdLCAiYVRhcmdldHMiOiBbIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMiwgMywgNCBdLCAiYVRhcmdldHMiOiBbIDIgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICB7ICJhRGF0YVNvcnQiOiBbIDAsIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMSwgMCBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAyLCAzLCA0IF0gfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYURhdGFTb3J0IjogbnVsbCwKCQoJCgkJLyoqCgkJICogWW91IGNhbiBjb250cm9sIHRoZSBkZWZhdWx0IHNvcnRpbmcgZGlyZWN0aW9uLCBhbmQgZXZlbiBhbHRlciB0aGUgYmVoYXZpb3VyCgkJICogb2YgdGhlIHNvcnQgaGFuZGxlciAoaS5lLiBvbmx5IGFsbG93IGFzY2VuZGluZyBzb3J0aW5nIGV0YykgdXNpbmcgdGhpcwoJCSAqIHBhcmFtZXRlci4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgWyAnYXNjJywgJ2Rlc2MnIF0KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImFzYyIgXSwgImFUYXJnZXRzIjogWyAxIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiwgImFzYyIsICJhc2MiIF0sICJhVGFyZ2V0cyI6IFsgMiBdIH0sCgkJICogICAgICAgICAgeyAiYXNTb3J0aW5nIjogWyAiZGVzYyIgXSwgImFUYXJnZXRzIjogWyAzIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiwgImFzYyIsICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiBdIH0sCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhc1NvcnRpbmciOiBbICdhc2MnLCAnZGVzYycgXSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9uIHRoZSBkYXRhIGluIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJiU2VhcmNoYWJsZSI6IGZhbHNlLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJiU2VhcmNoYWJsZSI6IGZhbHNlIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTZWFyY2hhYmxlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgc29ydGluZyBvbiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTb3J0YWJsZSI6IGZhbHNlIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTb3J0YWJsZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIDxjb2RlPkRlcHJlY2F0ZWQ8L2NvZGU+IFdoZW4gdXNpbmcgZm5SZW5kZXIoKSBmb3IgYSBjb2x1bW4sIHlvdSBtYXkgd2lzaCAKCQkgKiB0byB1c2UgdGhlIG9yaWdpbmFsIGRhdGEgKGJlZm9yZSByZW5kZXJpbmcpIGZvciBzb3J0aW5nIGFuZCBmaWx0ZXJpbmcgCgkJICogKHRoZSBkZWZhdWx0IGlzIHRvIHVzZWQgdGhlIHJlbmRlcmVkIGRhdGEgdGhhdCB0aGUgdXNlciBjYW4gc2VlKS4gVGhpcyAKCQkgKiBtYXkgYmUgdXNlZnVsIGZvciBkYXRlcyBldGMuCgkJICogCgkJICogUGxlYXNlIG5vdGUgdGhhdCB0aGlzIG9wdGlvbiBoYXMgbm93IGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkCgkJICogaW4gdGhlIG5leHQgdmVyc2lvbiBvZiBEYXRhVGFibGVzLiBQbGVhc2UgdXNlIG1SZW5kZXIgLyBtRGF0YSByYXRoZXIgdGhhbgoJCSAqIGZuUmVuZGVyLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJWaXNpYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJWaXNpYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlZpc2libGUiOiB0cnVlLAoJCQoJCQoJCS8qKgoJCSAqIERldmVsb3BlciBkZWZpbmFibGUgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbmV2ZXIgYSBjZWxsIGlzIGNyZWF0ZWQgKEFqYXggc291cmNlLAoJCSAqIGV0Yykgb3IgcHJvY2Vzc2VkIGZvciBpbnB1dCAoRE9NIHNvdXJjZSkuIFRoaXMgY2FuIGJlIHVzZWQgYXMgYSBjb21wbGltZW50IHRvIG1SZW5kZXIKCQkgKiBhbGxvd2luZyB5b3UgdG8gbW9kaWZ5IHRoZSBET00gZWxlbWVudCAoYWRkIGJhY2tncm91bmQgY29sb3VyIGZvciBleGFtcGxlKSB3aGVuIHRoZQoJCSAqIGVsZW1lbnQgaXMgYXZhaWxhYmxlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge2VsZW1lbnR9IG5UZCBUaGUgVEQgbm9kZSB0aGF0IGhhcyBiZWVuIGNyZWF0ZWQKCQkgKiAgQHBhcmFtIHsqfSBzRGF0YSBUaGUgRGF0YSBmb3IgdGhlIGNlbGwKCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGZvciB0aGUgd2hvbGUgcm93CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFRoZSByb3cgaW5kZXggZm9yIHRoZSBhb0RhdGEgZGF0YSBzdG9yZQoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBUaGUgY29sdW1uIGluZGV4IGZvciBhb0NvbHVtbnMKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWzNdLAoJCSAqICAgICAgICAgICJmbkNyZWF0ZWRDZWxsIjogZnVuY3Rpb24gKG5UZCwgc0RhdGEsIG9EYXRhLCBpUm93LCBpQ29sKSB7CgkJICogICAgICAgICAgICBpZiAoIHNEYXRhID09ICIxLjciICkgewoJCSAqICAgICAgICAgICAgICAkKG5UZCkuY3NzKCdjb2xvcicsICdibHVlJykKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0gXQoJCSAqICAgICAgfSk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNyZWF0ZWRDZWxsIjogbnVsbCwKCQoJCgkJLyoqCgkJICogPGNvZGU+RGVwcmVjYXRlZDwvY29kZT4gQ3VzdG9tIGRpc3BsYXkgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCBmb3IgdGhlIAoJCSAqIGRpc3BsYXkgb2YgZWFjaCBjZWxsIGluIHRoaXMgY29sdW1uLgoJCSAqCgkJICogUGxlYXNlIG5vdGUgdGhhdCB0aGlzIG9wdGlvbiBoYXMgbm93IGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkCgkJICogaW4gdGhlIG5leHQgdmVyc2lvbiBvZiBEYXRhVGFibGVzLiBQbGVhc2UgdXNlIG1SZW5kZXIgLyBtRGF0YSByYXRoZXIgdGhhbgoJCSAqIGZuUmVuZGVyLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBPYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhUm93IFRoZSByb3cgaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhQ29sdW1uIFRoZSBjb2x1bW4gaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gIG8uYURhdGEgVGhlIGRhdGEgZm9yIHRoZSByb3cgaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8ub1NldHRpbmdzIFRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgRGF0YVRhYmxlcyBpbnN0YW5jZQoJCSAqICBAcGFyYW0ge29iamVjdH0gby5tRGF0YVByb3AgVGhlIGRhdGEgcHJvcGVydHkgdXNlZCBmb3IgdGhpcyBjb2x1bW4KCQkgKiAgQHBhcmFtIHsqfSAgICAgIHZhbCBUaGUgY3VycmVudCBjZWxsIHZhbHVlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqICBAZGVwcmVjYXRlZAoJCSAqLwoJCSJmblJlbmRlciI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSBjb2x1bW4gaW5kZXggKHN0YXJ0aW5nIGZyb20gMCEpIHRoYXQgeW91IHdpc2ggYSBzb3J0IHRvIGJlIHBlcmZvcm1lZAoJCSAqIHVwb24gd2hlbiB0aGlzIGNvbHVtbiBpcyBzZWxlY3RlZCBmb3Igc29ydGluZy4gVGhpcyBjYW4gYmUgdXNlZCBmb3Igc29ydGluZwoJCSAqIG9uIGhpZGRlbiBjb2x1bW5zIGZvciBleGFtcGxlLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgLTEgPGk+VXNlIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZCBjb2x1bW4gaW5kZXg8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiaURhdGFTb3J0IjogMSwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImlEYXRhU29ydCI6IDEgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlEYXRhU29ydCI6IC0xLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBoYXMgYmVlbiByZXBsYWNlZCBieSBtRGF0YSBpbiBEYXRhVGFibGVzIHRvIGVuc3VyZSBuYW1pbmcKCQkgKiBjb25zaXN0ZW5jeS4gbURhdGFQcm9wIGNhbiBzdGlsbCBiZSB1c2VkLCBhcyB0aGVyZSBpcyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQoJCSAqIGluIERhdGFUYWJsZXMgZm9yIHRoaXMgb3B0aW9uLCBidXQgaXQgaXMgc3Ryb25nbHkgcmVjb21tZW5kZWQgdGhhdCB5b3UgdXNlCgkJICogbURhdGEgaW4gcHJlZmVyZW5jZSB0byBtRGF0YVByb3AuCgkJICogIEBuYW1lIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zLm1EYXRhUHJvcAoJCSAqLwoJCgkKCQkvKioKCQkgKiBUaGlzIHByb3BlcnR5IGNhbiBiZSB1c2VkIHRvIHJlYWQgZGF0YSBmcm9tIGFueSBKU09OIGRhdGEgc291cmNlIHByb3BlcnR5LAoJCSAqIGluY2x1ZGluZyBkZWVwbHkgbmVzdGVkIG9iamVjdHMgLyBwcm9wZXJ0aWVzLiBtRGF0YSBjYW4gYmUgZ2l2ZW4gaW4gYQoJCSAqIG51bWJlciBvZiBkaWZmZXJlbnQgd2F5cyB3aGljaCBlZmZlY3QgaXRzIGJlaGF2aW91cjoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmludGVnZXIgLSB0cmVhdGVkIGFzIGFuIGFycmF5IGluZGV4IGZvciB0aGUgZGF0YSBzb3VyY2UuIFRoaXMgaXMgdGhlCgkJICogICAgICAgZGVmYXVsdCB0aGF0IERhdGFUYWJsZXMgdXNlcyAoaW5jcmVtZW50YWxseSBpbmNyZWFzZWQgZm9yIGVhY2ggY29sdW1uKS48L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nIC0gcmVhZCBhbiBvYmplY3QgcHJvcGVydHkgZnJvbSB0aGUgZGF0YSBzb3VyY2UuIE5vdGUgdGhhdCB5b3UgY2FuCgkJICogICAgICAgdXNlIEphdmFzY3JpcHQgZG90dGVkIG5vdGF0aW9uIHRvIHJlYWQgZGVlcCBwcm9wZXJ0aWVzIC8gYXJyYXlzIGZyb20gdGhlCgkJICogICAgICAgZGF0YSBzb3VyY2UuPC9saT4KCQkgKiAgICAgPGxpPm51bGwgLSB0aGUgc0RlZmF1bHRDb250ZW50IG9wdGlvbiB3aWxsIGJlIHVzZWQgZm9yIHRoZSBjZWxsIChudWxsCgkJICogICAgICAgYnkgZGVmYXVsdCwgc28geW91IHdpbGwgbmVlZCB0byBzcGVjaWZ5IHRoZSBkZWZhdWx0IGNvbnRlbnQgeW91IHdhbnQgLQoJCSAqICAgICAgIHR5cGljYWxseSBhbiBlbXB0eSBzdHJpbmcpLiBUaGlzIGNhbiBiZSB1c2VmdWwgb24gZ2VuZXJhdGVkIGNvbHVtbnMgc3VjaCAKCQkgKiAgICAgICBhcyBlZGl0IC8gZGVsZXRlIGFjdGlvbiBjb2x1bW5zLjwvbGk+CgkJICogICAgIDxsaT5mdW5jdGlvbiAtIHRoZSBmdW5jdGlvbiBnaXZlbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW5ldmVyIERhdGFUYWJsZXMgCgkJICogICAgICAgbmVlZHMgdG8gc2V0IG9yIGdldCB0aGUgZGF0YSBmb3IgYSBjZWxsIGluIHRoZSBjb2x1bW4uIFRoZSBmdW5jdGlvbiAKCQkgKiAgICAgICB0YWtlcyB0aHJlZSBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSByb3c8L2xpPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd9IFRoZSB0eXBlIGNhbGwgZGF0YSByZXF1ZXN0ZWQgLSB0aGlzIHdpbGwgYmUgJ3NldCcgd2hlbgoJCSAqICAgICAgICAgICBzZXR0aW5nIGRhdGEgb3IgJ2ZpbHRlcicsICdkaXNwbGF5JywgJ3R5cGUnLCAnc29ydCcgb3IgdW5kZWZpbmVkIHdoZW4gCgkJICogICAgICAgICAgIGdhdGhlcmluZyBkYXRhLiBOb3RlIHRoYXQgd2hlbiA8aT51bmRlZmluZWQ8L2k+IGlzIGdpdmVuIGZvciB0aGUgdHlwZQoJCSAqICAgICAgICAgICBEYXRhVGFibGVzIGV4cGVjdHMgdG8gZ2V0IHRoZSByYXcgZGF0YSBmb3IgdGhlIG9iamVjdCBiYWNrPC9saT4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSB0byBzZXQgd2hlbiB0aGUgc2Vjb25kIHBhcmFtZXRlciBpcyAnc2V0Jy48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgICAgVGhlIHJldHVybiB2YWx1ZSBmcm9tIHRoZSBmdW5jdGlvbiBpcyBub3QgcmVxdWlyZWQgd2hlbiAnc2V0JyBpcyB0aGUgdHlwZQoJCSAqICAgICAgIG9mIGNhbGwsIGJ1dCBvdGhlcndpc2UgdGhlIHJldHVybiBpcyB3aGF0IHdpbGwgYmUgdXNlZCBmb3IgdGhlIGRhdGEKCQkgKiAgICAgICByZXF1ZXN0ZWQuPC9saT4KCQkgKiAgICA8L3VsPgoJCSAqCgkJICogTm90ZSB0aGF0IHByaW9yIHRvIERhdGFUYWJsZXMgMS45LjIgbURhdGEgd2FzIGNhbGxlZCBtRGF0YVByb3AuIFRoZSBuYW1lIGNoYW5nZQoJCSAqIHJlZmxlY3RzIHRoZSBmbGV4aWJpbGl0eSBvZiB0aGlzIHByb3BlcnR5IGFuZCBpcyBjb25zaXN0ZW50IHdpdGggdGhlIG5hbWluZyBvZgoJCSAqIG1SZW5kZXIuIElmICdtRGF0YVByb3AnIGlzIGdpdmVuLCB0aGVuIGl0IHdpbGwgc3RpbGwgYmUgdXNlZCBieSBEYXRhVGFibGVzLCBhcwoJCSAqIGl0IGF1dG9tYXRpY2FsbHkgbWFwcyB0aGUgb2xkIG5hbWUgdG8gdGhlIG5ldyBpZiByZXF1aXJlZC4KCQkgKiAgQHR5cGUgc3RyaW5nfGludHxmdW5jdGlvbnxudWxsCgkJICogIEBkZWZhdWx0IG51bGwgPGk+VXNlIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZCBjb2x1bW4gaW5kZXg8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUmVhZCB0YWJsZSBkYXRhIGZyb20gb2JqZWN0cwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kZWVwLnR4dCIsCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAibURhdGEiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgIm1EYXRhIjogImJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAibURhdGEiOiAicGxhdGZvcm0uaW5uZXIiIH0sCgkJICogICAgICAgICAgeyAibURhdGEiOiAicGxhdGZvcm0uZGV0YWlscy4wIiB9LAoJCSAqICAgICAgICAgIHsgIm1EYXRhIjogInBsYXRmb3JtLmRldGFpbHMuMSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIG1EYXRhIGFzIGEgZnVuY3Rpb24gdG8gcHJvdmlkZSBkaWZmZXJlbnQgaW5mb3JtYXRpb24gZm9yCgkJICogICAgLy8gc29ydGluZywgZmlsdGVyaW5nIGFuZCBkaXNwbGF5LiBJbiB0aGlzIGNhc2UsIGN1cnJlbmN5IChwcmljZSkKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdLAoJCSAqICAgICAgICAgICJtRGF0YSI6IGZ1bmN0aW9uICggc291cmNlLCB0eXBlLCB2YWwgKSB7CgkJICogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3NldCcpIHsKCQkgKiAgICAgICAgICAgICAgc291cmNlLnByaWNlID0gdmFsOwoJCSAqICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgY29tcHV0ZWQgZGlzbGF5IGFuZCBmaWx0ZXIgdmFsdWVzIGZvciBlZmZpY2llbmN5CgkJICogICAgICAgICAgICAgIHNvdXJjZS5wcmljZV9kaXNwbGF5ID0gdmFsPT0iIiA/ICIiIDogIiQiK251bWJlckZvcm1hdCh2YWwpOwoJCSAqICAgICAgICAgICAgICBzb3VyY2UucHJpY2VfZmlsdGVyICA9IHZhbD09IiIgPyAiIiA6ICIkIitudW1iZXJGb3JtYXQodmFsKSsiICIrdmFsOwoJCSAqICAgICAgICAgICAgICByZXR1cm47CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnZGlzcGxheScpIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZV9kaXNwbGF5OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2ZpbHRlcicpIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZV9maWx0ZXI7CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICAvLyAnc29ydCcsICd0eXBlJyBhbmQgdW5kZWZpbmVkIGFsbCBqdXN0IHVzZSB0aGUgaW50ZWdlcgoJCSAqICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0gXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkibURhdGEiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHByb3BlcnR5IGlzIHRoZSByZW5kZXJpbmcgcGFydG5lciB0byBtRGF0YSBhbmQgaXQgaXMgc3VnZ2VzdGVkIHRoYXQKCQkgKiB3aGVuIHlvdSB3YW50IHRvIG1hbmlwdWxhdGUgZGF0YSBmb3IgZGlzcGxheSAoaW5jbHVkaW5nIGZpbHRlcmluZywgc29ydGluZyBldGMpCgkJICogYnV0IG5vdCBhbHRlcmluZyB0aGUgdW5kZXJseWluZyBkYXRhIGZvciB0aGUgdGFibGUsIHVzZSB0aGlzIHByb3BlcnR5LiBtRGF0YQoJCSAqIGNhbiBhY3R1YWxseSBkbyBldmVyeXRoaW5nIHRoaXMgcHJvcGVydHkgY2FuIGFuZCBtb3JlLCBidXQgdGhpcyBwYXJhbWV0ZXIgaXMKCQkgKiBlYXNpZXIgdG8gdXNlIHNpbmNlIHRoZXJlIGlzIG5vICdzZXQnIG9wdGlvbi4gTGlrZSBtRGF0YSBpcyBjYW4gYmUgZ2l2ZW4KCQkgKiBpbiBhIG51bWJlciBvZiBkaWZmZXJlbnQgd2F5cyB0byBlZmZlY3QgaXRzIGJlaGF2aW91ciwgd2l0aCB0aGUgYWRkaXRpb24gb2YgCgkJICogc3VwcG9ydGluZyBhcnJheSBzeW50YXggZm9yIGVhc3kgb3V0cHV0dGluZyBvZiBhcnJheXMgKGluY2x1ZGluZyBhcnJheXMgb2YKCQkgKiBvYmplY3RzKToKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmludGVnZXIgLSB0cmVhdGVkIGFzIGFuIGFycmF5IGluZGV4IGZvciB0aGUgZGF0YSBzb3VyY2UuIFRoaXMgaXMgdGhlCgkJICogICAgICAgZGVmYXVsdCB0aGF0IERhdGFUYWJsZXMgdXNlcyAoaW5jcmVtZW50YWxseSBpbmNyZWFzZWQgZm9yIGVhY2ggY29sdW1uKS48L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nIC0gcmVhZCBhbiBvYmplY3QgcHJvcGVydHkgZnJvbSB0aGUgZGF0YSBzb3VyY2UuIE5vdGUgdGhhdCB5b3UgY2FuCgkJICogICAgICAgdXNlIEphdmFzY3JpcHQgZG90dGVkIG5vdGF0aW9uIHRvIHJlYWQgZGVlcCBwcm9wZXJ0aWVzIC8gYXJyYXlzIGZyb20gdGhlCgkJICogICAgICAgZGF0YSBzb3VyY2UgYW5kIGFsc28gYXJyYXkgYnJhY2tldHMgdG8gaW5kaWNhdGUgdGhhdCB0aGUgZGF0YSByZWFkZXIgc2hvdWxkCgkJICogICAgICAgbG9vcCBvdmVyIHRoZSBkYXRhIHNvdXJjZSBhcnJheS4gV2hlbiBjaGFyYWN0ZXJzIGFyZSBnaXZlbiBiZXR3ZWVuIHRoZSBhcnJheQoJCSAqICAgICAgIGJyYWNrZXRzLCB0aGVzZSBjaGFyYWN0ZXJzIGFyZSB1c2VkIHRvIGpvaW4gdGhlIGRhdGEgc291cmNlIGFycmF5IHRvZ2V0aGVyLgoJCSAqICAgICAgIEZvciBleGFtcGxlOiAiYWNjb3VudHNbLCBdLm5hbWUiIHdvdWxkIHJlc3VsdCBpbiBhIGNvbW1hIHNlcGFyYXRlZCBsaXN0IHdpdGgKCQkgKiAgICAgICB0aGUgJ25hbWUnIHZhbHVlIGZyb20gdGhlICdhY2NvdW50cycgYXJyYXkgb2Ygb2JqZWN0cy48L2xpPgoJCSAqICAgICA8bGk+ZnVuY3Rpb24gLSB0aGUgZnVuY3Rpb24gZ2l2ZW4gd2lsbCBiZSBleGVjdXRlZCB3aGVuZXZlciBEYXRhVGFibGVzIAoJCSAqICAgICAgIG5lZWRzIHRvIHNldCBvciBnZXQgdGhlIGRhdGEgZm9yIGEgY2VsbCBpbiB0aGUgY29sdW1uLiBUaGUgZnVuY3Rpb24gCgkJICogICAgICAgdGFrZXMgdGhyZWUgcGFyYW1ldGVyczoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2FycmF5fG9iamVjdH0gVGhlIGRhdGEgc291cmNlIGZvciB0aGUgcm93IChiYXNlZCBvbiBtRGF0YSk8L2xpPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd9IFRoZSB0eXBlIGNhbGwgZGF0YSByZXF1ZXN0ZWQgLSB0aGlzIHdpbGwgYmUgJ2ZpbHRlcicsICdkaXNwbGF5JywgCgkJICogICAgICAgICAgICd0eXBlJyBvciAnc29ydCcuPC9saT4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBUaGUgZnVsbCBkYXRhIHNvdXJjZSBmb3IgdGhlIHJvdyAobm90IGJhc2VkIG9uIG1EYXRhKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgICBUaGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uIGlzIHdoYXQgd2lsbCBiZSB1c2VkIGZvciB0aGUgZGF0YQoJCSAqICAgICAgIHJlcXVlc3RlZC48L2xpPgoJCSAqICAgIDwvdWw+CgkJICogIEB0eXBlIHN0cmluZ3xpbnR8ZnVuY3Rpb258bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsIDxpPlVzZSBtRGF0YTwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDcmVhdGUgYSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBmcm9tIGFuIGFycmF5IG9mIG9iamVjdHMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNvdXJjZXMvZGVlcC50eHQiLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgIm1EYXRhIjogImVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YSI6ICJicm93c2VyIiB9LAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YSI6ICJwbGF0Zm9ybSIsCgkJICogICAgICAgICAgICAibVJlbmRlciI6ICJbLCBdLm5hbWUiCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzZSBhcyBhIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGxpbmsgZnJvbSB0aGUgZGF0YSBzb3VyY2UKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsKCQkgKiAgICAgICAgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdLAoJCSAqICAgICAgICAgICJtRGF0YSI6ICJkb3dubG9hZF9saW5rIiwKCQkgKiAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uICggZGF0YSwgdHlwZSwgZnVsbCApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJytkYXRhKyciPkRvd25sb2FkPC9hPic7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJtUmVuZGVyIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2hhbmdlIHRoZSBjZWxsIHR5cGUgY3JlYXRlZCBmb3IgdGhlIGNvbHVtbiAtIGVpdGhlciBURCBjZWxscyBvciBUSCBjZWxscy4gVGhpcwoJCSAqIGNhbiBiZSB1c2VmdWwgYXMgVEggY2VsbHMgaGF2ZSBzZW1hbnRpYyBtZWFuaW5nIGluIHRoZSB0YWJsZSBib2R5LCBhbGxvd2luZyB0aGVtCgkJICogdG8gYWN0IGFzIGEgaGVhZGVyIGZvciBhIHJvdyAoeW91IG1heSB3aXNoIHRvIGFkZCBzY29wZT0ncm93JyB0byB0aGUgVEggZWxlbWVudHMpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgdGQKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBNYWtlIHRoZSBmaXJzdCBjb2x1bW4gdXNlIFRIIGNlbGxzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIHsKCQkgKiAgICAgICAgICAiYVRhcmdldHMiOiBbIDAgXSwKCQkgKiAgICAgICAgICAic0NlbGxUeXBlIjogInRoIgoJCSAqICAgICAgICB9IF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDZWxsVHlwZSI6ICJ0ZCIsCgkKCQoJCS8qKgoJCSAqIENsYXNzIHRvIGdpdmUgdG8gZWFjaCBjZWxsIGluIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNDbGFzcyI6ICJteV9jbGFzcyIsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQ2xhc3MiOiAiIiwKCQkKCQkvKioKCQkgKiBXaGVuIERhdGFUYWJsZXMgY2FsY3VsYXRlcyB0aGUgY29sdW1uIHdpZHRocyB0byBhc3NpZ24gdG8gZWFjaCBjb2x1bW4sCgkJICogaXQgZmluZHMgdGhlIGxvbmdlc3Qgc3RyaW5nIGluIGVhY2ggY29sdW1uIGFuZCB0aGVuIGNvbnN0cnVjdHMgYQoJCSAqIHRlbXBvcmFyeSB0YWJsZSBhbmQgcmVhZHMgdGhlIHdpZHRocyBmcm9tIHRoYXQuIFRoZSBwcm9ibGVtIHdpdGggdGhpcwoJCSAqIGlzIHRoYXQgIm1tbSIgaXMgbXVjaCB3aWRlciB0aGVuICJpaWlpIiwgYnV0IHRoZSBsYXR0ZXIgaXMgYSBsb25nZXIgCgkJICogc3RyaW5nIC0gdGh1cyB0aGUgY2FsY3VsYXRpb24gY2FuIGdvIHdyb25nIChkb2luZyBpdCBwcm9wZXJseSBhbmQgcHV0dGluZwoJCSAqIGl0IGludG8gYW4gRE9NIG9iamVjdCBhbmQgbWVhc3VyaW5nIHRoYXQgaXMgaG9ycmlibHkoISkgc2xvdykuIFRodXMgYXMKCQkgKiBhICJ3b3JrIGFyb3VuZCIgd2UgcHJvdmlkZSB0aGlzIG9wdGlvbi4gSXQgd2lsbCBhcHBlbmQgaXRzIHZhbHVlIHRvIHRoZQoJCSAqIHRleHQgdGhhdCBpcyBmb3VuZCB0byBiZSB0aGUgbG9uZ2VzdCBzdHJpbmcgZm9yIHRoZSBjb2x1bW4gLSBpLmUuIHBhZGRpbmcuCgkJICogR2VuZXJhbGx5IHlvdSBzaG91bGRuJ3QgbmVlZCB0aGlzLCBhbmQgaXQgaXMgbm90IGRvY3VtZW50ZWQgb24gdGhlIAoJCSAqIGdlbmVyYWwgRGF0YVRhYmxlcy5uZXQgZG9jdW1lbnRhdGlvbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPGk+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgInNDb250ZW50UGFkZGluZyI6ICJtbW0iCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQ29udGVudFBhZGRpbmciOiAiIiwKCQoJCgkJLyoqCgkJICogQWxsb3dzIGEgZGVmYXVsdCB2YWx1ZSB0byBiZSBnaXZlbiBmb3IgYSBjb2x1bW4ncyBkYXRhLCBhbmQgd2lsbCBiZSB1c2VkCgkJICogd2hlbmV2ZXIgYSBudWxsIGRhdGEgc291cmNlIGlzIGVuY291bnRlcmVkICh0aGlzIGNhbiBiZSBiZWNhdXNlIG1EYXRhCgkJICogaXMgc2V0IHRvIG51bGwsIG9yIGJlY2F1c2UgdGhlIGRhdGEgc291cmNlIGl0c2VsZiBpcyBudWxsKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAibURhdGEiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IiwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgLTEgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAibURhdGEiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IgoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0RlZmF1bHRDb250ZW50IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgaXMgb25seSB1c2VkIGluIERhdGFUYWJsZXMnIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIEl0IGNhbgoJCSAqIGJlIGV4Y2VwdGlvbmFsbHkgdXNlZnVsIHRvIGtub3cgd2hhdCBjb2x1bW5zIGFyZSBiZWluZyBkaXNwbGF5ZWQgb24gdGhlCgkJICogY2xpZW50IHNpZGUsIGFuZCB0byBtYXAgdGhlc2UgdG8gZGF0YWJhc2UgZmllbGRzLiBXaGVuIGRlZmluZWQsIHRoZSBuYW1lcwoJCSAqIGFsc28gYWxsb3cgRGF0YVRhYmxlcyB0byByZW9yZGVyIGluZm9ybWF0aW9uIGZyb20gdGhlIHNlcnZlciBpZiBpdCBjb21lcwoJCSAqIGJhY2sgaW4gYW4gdW5leHBlY3RlZCBvcmRlciAoaS5lLiBpZiB5b3Ugc3dpdGNoIHlvdXIgY29sdW1ucyBhcm91bmQgb24gdGhlCgkJICogY2xpZW50LXNpZGUsIHlvdXIgc2VydmVyLXNpZGUgY29kZSBkb2VzIG5vdCBhbHNvIG5lZWQgdXBkYXRpbmcpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImVuZ2luZSIsICJhVGFyZ2V0cyI6IFsgMCBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiYnJvd3NlciIsICJhVGFyZ2V0cyI6IFsgMSBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAicGxhdGZvcm0iLCAiYVRhcmdldHMiOiBbIDIgXSB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogInZlcnNpb24iLCAiYVRhcmdldHMiOiBbIDMgXSB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImdyYWRlIiwgImFUYXJnZXRzIjogWyA0IF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJicm93c2VyIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogInBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogInZlcnNpb24iIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZ3JhZGUiIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic05hbWUiOiAiIiwKCQoJCgkJLyoqCgkJICogRGVmaW5lcyBhIGRhdGEgc291cmNlIHR5cGUgZm9yIHRoZSBzb3J0aW5nIHdoaWNoIGNhbiBiZSB1c2VkIHRvIHJlYWQKCQkgKiByZWFsLXRpbWUgaW5mb3JtYXRpb24gZnJvbSB0aGUgdGFibGUgKHVwZGF0aW5nIHRoZSBpbnRlcm5hbGx5IGNhY2hlZAoJCSAqIHZlcnNpb24pIHByaW9yIHRvIHNvcnRpbmcuIFRoaXMgYWxsb3dzIHNvcnRpbmcgdG8gb2NjdXIgb24gdXNlciBlZGl0YWJsZQoJCSAqIGVsZW1lbnRzIHN1Y2ggYXMgZm9ybSBpbnB1dHMuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXRleHQiLCAiYVRhcmdldHMiOiBbIDIsIDMgXSB9LAoJCSAqICAgICAgICAgIHsgInNUeXBlIjogIm51bWVyaWMiLCAiYVRhcmdldHMiOiBbIDMgXSB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXNlbGVjdCIsICJhVGFyZ2V0cyI6IFsgNCBdIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tY2hlY2tib3giLCAiYVRhcmdldHMiOiBbIDUgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIgfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS10ZXh0IiwgInNUeXBlIjogIm51bWVyaWMiIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tc2VsZWN0IiB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLWNoZWNrYm94IiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTb3J0RGF0YVR5cGUiOiAic3RkIiwKCQoJCgkJLyoqCgkJICogVGhlIHRpdGxlIG9mIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5EZXJpdmVkIGZyb20gdGhlICdUSCcgdmFsdWUgZm9yIHRoaXMgY29sdW1uIGluIHRoZSAKCQkgKiAgICBvcmlnaW5hbCBIVE1MIHRhYmxlLjwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiTXkgY29sdW1uIHRpdGxlIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJNeSBjb2x1bW4gdGl0bGUiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzVGl0bGUiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGUgdHlwZSBhbGxvd3MgeW91IHRvIHNwZWNpZnkgaG93IHRoZSBkYXRhIGZvciB0aGlzIGNvbHVtbiB3aWxsIGJlIHNvcnRlZC4KCQkgKiBGb3VyIHR5cGVzIChzdHJpbmcsIG51bWVyaWMsIGRhdGUgYW5kIGh0bWwgKHdoaWNoIHdpbGwgc3RyaXAgSFRNTCB0YWdzCgkJICogYmVmb3JlIHNvcnRpbmcpKSBhcmUgY3VycmVudGx5IGF2YWlsYWJsZS4gTm90ZSB0aGF0IG9ubHkgZGF0ZSBmb3JtYXRzCgkJICogdW5kZXJzdG9vZCBieSBKYXZhc2NyaXB0J3MgRGF0ZSgpIG9iamVjdCB3aWxsIGJlIGFjY2VwdGVkIGFzIHR5cGUgZGF0ZS4gRm9yCgkJICogZXhhbXBsZTogIk1hciAyNiwgMjAwOCA1OjAzIFBNIi4gTWF5IHRha2UgdGhlIHZhbHVlczogJ3N0cmluZycsICdudW1lcmljJywKCQkgKiAnZGF0ZScgb3IgJ2h0bWwnIChieSBkZWZhdWx0KS4gRnVydGhlciB0eXBlcyBjYW4gYmUgYWRkaW5nIHRocm91Z2gKCQkgKiBwbHVnLWlucy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwgPGk+QXV0by1kZXRlY3RlZCBmcm9tIHJhdyBkYXRhPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNUeXBlIjogImh0bWwiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1R5cGUiOiAiaHRtbCIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUeXBlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRGVmaW5pbmcgdGhlIHdpZHRoIG9mIHRoZSBjb2x1bW4sIHRoaXMgcGFyYW1ldGVyIG1heSB0YWtlIGFueSBDU1MgdmFsdWUKCQkgKiAoM2VtLCAyMHB4IGV0YykuIERhdGFUYWJsZXMgYXBwbGVzICdzbWFydCcgd2lkdGhzIHRvIGNvbHVtbnMgd2hpY2ggaGF2ZSBub3QKCQkgKiBiZWVuIGdpdmVuIGEgc3BlY2lmaWMgd2lkdGggdGhyb3VnaCB0aGlzIGludGVyZmFjZSBlbnN1cmluZyB0aGF0IHRoZSB0YWJsZQoJCSAqIHJlbWFpbnMgcmVhZGFibGUuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsIDxpPkF1dG9tYXRpYzwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzV2lkdGgiOiAiMjAlIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNXaWR0aCI6ICIyMCUiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzV2lkdGgiOiBudWxsCgl9OwoJCgkKCQoJLyoqCgkgKiBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCAtIHRoaXMgaG9sZHMgYWxsIHRoZSBpbmZvcm1hdGlvbiBuZWVkZWQgZm9yIGEKCSAqIGdpdmVuIHRhYmxlLCBpbmNsdWRpbmcgY29uZmlndXJhdGlvbiwgZGF0YSBhbmQgY3VycmVudCBhcHBsaWNhdGlvbiBvZiB0aGUKCSAqIHRhYmxlIG9wdGlvbnMuIERhdGFUYWJsZXMgZG9lcyBub3QgaGF2ZSBhIHNpbmdsZSBpbnN0YW5jZSBmb3IgZWFjaCBEYXRhVGFibGUKCSAqIHdpdGggdGhlIHNldHRpbmdzIGF0dGFjaGVkIHRvIHRoYXQgaW5zdGFuY2UsIGJ1dCByYXRoZXIgaW5zdGFuY2VzIG9mIHRoZQoJICogRGF0YVRhYmxlICJjbGFzcyIgYXJlIGNyZWF0ZWQgb24tdGhlLWZseSBhcyBuZWVkZWQgKHR5cGljYWxseSBieSBhIAoJICogJCgpLmRhdGFUYWJsZSgpIGNhbGwpIGFuZCB0aGUgc2V0dGluZ3Mgb2JqZWN0IGlzIHRoZW4gYXBwbGllZCB0byB0aGF0CgkgKiBpbnN0YW5jZS4KCSAqIAoJICogTm90ZSB0aGF0IHRoaXMgb2JqZWN0IGlzIHJlbGF0ZWQgdG8ge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30gYnV0IHRoaXMgCgkgKiBvbmUgaXMgdGhlIGludGVybmFsIGRhdGEgc3RvcmUgZm9yIERhdGFUYWJsZXMncyBjYWNoZSBvZiBjb2x1bW5zLiBJdCBzaG91bGQKCSAqIE5PVCBiZSBtYW5pcHVsYXRlZCBvdXRzaWRlIG9mIERhdGFUYWJsZXMuIEFueSBjb25maWd1cmF0aW9uIHNob3VsZCBiZSBkb25lCgkgKiB0aHJvdWdoIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zLgoJICogIEBuYW1lc3BhY2UKCSAqICBAdG9kbyBSZWFsbHkgc2hvdWxkIGF0dGFjaCB0aGUgc2V0dGluZ3Mgb2JqZWN0IHRvIGluZGl2aWR1YWwgaW5zdGFuY2VzIHNvIHdlCgkgKiAgICBkb24ndCBuZWVkIHRvIGNyZWF0ZSBuZXcgaW5zdGFuY2VzIG9uIGVhY2ggJCgpLmRhdGFUYWJsZSgpIGNhbGwgKGlmIHRoZQoJICogICAgdGFibGUgYWxyZWFkeSBleGlzdHMpLiBJdCB3b3VsZCBhbHNvIHNhdmUgcGFzc2luZyBvU2V0dGluZ3MgYXJvdW5kIGFuZAoJICogICAgaW50byBldmVyeSBzaW5nbGUgZnVuY3Rpb24uIEhvd2V2ZXIsIHRoaXMgaXMgYSB2ZXJ5IHNpZ25pZmljYW50IAoJICogICAgYXJjaGl0ZWN0dXJlIGNoYW5nZSBmb3IgRGF0YVRhYmxlcyBhbmQgd2lsbCBhbG1vc3QgY2VydGFpbmx5IGJyZWFrCgkgKiAgICBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoIG9sZGVyIGluc3RhbGxhdGlvbnMuIFRoaXMgaXMgc29tZXRoaW5nIHRoYXQKCSAqICAgIHdpbGwgYmUgZG9uZSBpbiAyLjAuCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzID0gewoJCS8qKgoJCSAqIFByaW1hcnkgZmVhdHVyZXMgb2YgRGF0YVRhYmxlcyBhbmQgdGhlaXIgZW5hYmxlbWVudCBzdGF0ZS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvRmVhdHVyZXMiOiB7CgkJCQoJCQkvKioKCQkJICogRmxhZyB0byBzYXkgaWYgRGF0YVRhYmxlcyBzaG91bGQgYXV0b21hdGljYWxseSB0cnkgdG8gY2FsY3VsYXRlIHRoZQoJCQkgKiBvcHRpbXVtIHRhYmxlIGFuZCBjb2x1bW5zIHdpZHRocyAodHJ1ZSkgb3Igbm90IChmYWxzZSkuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkF1dG9XaWR0aCI6IG51bGwsCgkKCQkJLyoqCgkJCSAqIERlbGF5IHRoZSBjcmVhdGlvbiBvZiBUUiBhbmQgVEQgZWxlbWVudHMgdW50aWwgdGhleSBhcmUgYWN0dWFsbHkKCQkJICogbmVlZGVkIGJ5IGEgZHJpdmVuIHBhZ2UgZHJhdy4gVGhpcyBjYW4gZ2l2ZSBhIHNpZ25pZmljYW50IHNwZWVkCgkJCSAqIGluY3JlYXNlIGZvciBBamF4IHNvdXJjZSBhbmQgSmF2YXNjcmlwdCBzb3VyY2UgZGF0YSwgYnV0IG1ha2VzIG5vCgkJCSAqIGRpZmZlcmVuY2UgYXQgYWxsIGZybyBET00gYW5kIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgdGFibGVzLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJEZWZlclJlbmRlciI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogRW5hYmxlIGZpbHRlcmluZyBvbiB0aGUgdGFibGUgb3Igbm90LiBOb3RlIHRoYXQgaWYgdGhpcyBpcyBkaXNhYmxlZAoJCQkgKiB0aGVuIHRoZXJlIGlzIG5vIGZpbHRlcmluZyBhdCBhbGwgb24gdGhlIHRhYmxlLCBpbmNsdWRpbmcgZm5GaWx0ZXIuCgkJCSAqIFRvIGp1c3QgcmVtb3ZlIHRoZSBmaWx0ZXJpbmcgaW5wdXQgdXNlIHNEb20gYW5kIHJlbW92ZSB0aGUgJ2YnIG9wdGlvbi4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiRmlsdGVyIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBUYWJsZSBpbmZvcm1hdGlvbiBlbGVtZW50ICh0aGUgJ1Nob3dpbmcgeCBvZiB5IHJlY29yZHMnIGRpdikgZW5hYmxlCgkJCSAqIGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkluZm8iOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFByZXNlbnQgYSB1c2VyIGNvbnRyb2wgYWxsb3dpbmcgdGhlIGVuZCB1c2VyIHRvIGNoYW5nZSB0aGUgcGFnZSBzaXplCgkJCSAqIHdoZW4gcGFnaW5hdGlvbiBpcyBlbmFibGVkLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJMZW5ndGhDaGFuZ2UiOiBudWxsLAoJCgkJCS8qKgoJCQkgKiBQYWdpbmF0aW9uIGVuYWJsZWQgb3Igbm90LiBOb3RlIHRoYXQgaWYgdGhpcyBpcyBkaXNhYmxlZCB0aGVuIGxlbmd0aAoJCQkgKiBjaGFuZ2luZyBtdXN0IGFsc28gYmUgZGlzYWJsZWQuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlBhZ2luYXRlIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBQcm9jZXNzaW5nIGluZGljYXRvciBlbmFibGUgZmxhZyB3aGVuZXZlciBEYXRhVGFibGVzIGlzIGVuYWN0aW5nIGEKCQkJICogdXNlciByZXF1ZXN0IC0gdHlwaWNhbGx5IGFuIEFqYXggcmVxdWVzdCBmb3Igc2VydmVyLXNpZGUgcHJvY2Vzc2luZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiUHJvY2Vzc2luZyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyBlbmFibGVkIGZsYWcgLSB3aGVuIGVuYWJsZWQgRGF0YVRhYmxlcyB3aWxsCgkJCSAqIGdldCBhbGwgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIgZm9yIGV2ZXJ5IGRyYXcgLSB0aGVyZSBpcyBubyBmaWx0ZXJpbmcsCgkJCSAqIHNvcnRpbmcgb3IgcGFnaW5nIGRvbmUgb24gdGhlIGNsaWVudC1zaWRlLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJTZXJ2ZXJTaWRlIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBTb3J0aW5nIGVuYWJsZW1lbnQgZmxhZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU29ydCI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogQXBwbHkgYSBjbGFzcyB0byB0aGUgY29sdW1ucyB3aGljaCBhcmUgYmVpbmcgc29ydGVkIHRvIHByb3ZpZGUgYQoJCQkgKiB2aXN1YWwgaGlnaGxpZ2h0IG9yIG5vdC4gVGhpcyBjYW4gc2xvdyB0aGluZ3MgZG93biB3aGVuIGVuYWJsZWQgc2luY2UKCQkJICogdGhlcmUgaXMgYSBsb3Qgb2YgRE9NIGludGVyYWN0aW9uLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJTb3J0Q2xhc3NlcyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogU3RhdGUgc2F2aW5nIGVuYWJsZW1lbnQgZmxhZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU3RhdGVTYXZlIjogbnVsbAoJCX0sCgkJCgkKCQkvKioKCQkgKiBTY3JvbGxpbmcgc2V0dGluZ3MgZm9yIGEgdGFibGUuCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib1Njcm9sbCI6IHsKCQkJLyoqCgkJCSAqIEluZGljYXRlIGlmIERhdGFUYWJsZXMgc2hvdWxkIGJlIGFsbG93ZWQgdG8gc2V0IHRoZSBwYWRkaW5nIC8gbWFyZ2luCgkJCSAqIGV0YyBmb3IgdGhlIHNjcm9sbGluZyBoZWFkZXIgZWxlbWVudHMgb3Igbm90LiBUeXBpY2FsbHkgeW91IHdpbGwgd2FudAoJCQkgKiB0aGlzLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJBdXRvQ3NzIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBXaGVuIHRoZSB0YWJsZSBpcyBzaG9ydGVyIGluIGhlaWdodCB0aGFuIHNTY3JvbGxZLCBjb2xsYXBzZSB0aGUKCQkJICogdGFibGUgY29udGFpbmVyIGRvd24gdG8gdGhlIGhlaWdodCBvZiB0aGUgdGFibGUgKHdoZW4gdHJ1ZSkuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkNvbGxhcHNlIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBJbmZpbml0ZSBzY3JvbGxpbmcgZW5hYmxlbWVudCBmbGFnLiBOb3cgZGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YKCQkJICogdXNpbmcgdGhlIFNjcm9sbGVyIHBsdWctaW4uCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkluZmluaXRlIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBXaWR0aCBvZiB0aGUgc2Nyb2xsYmFyIGZvciB0aGUgd2ViLWJyb3dzZXIncyBwbGF0Zm9ybS4gQ2FsY3VsYXRlZAoJCQkgKiBkdXJpbmcgdGFibGUgaW5pdGlhbGlzYXRpb24uCgkJCSAqICBAdHlwZSBpbnQKCQkJICogIEBkZWZhdWx0IDAKCQkJICovCgkJCSJpQmFyV2lkdGgiOiAwLAoJCQkKCQkJLyoqCgkJCSAqIFNwYWNlIChpbiBwaXhlbHMpIGJldHdlZW4gdGhlIGJvdHRvbSBvZiB0aGUgc2Nyb2xsaW5nIGNvbnRhaW5lciBhbmQgCgkJCSAqIHRoZSBib3R0b20gb2YgdGhlIHNjcm9sbGluZyB2aWV3cG9ydCBiZWZvcmUgdGhlIG5leHQgcGFnZSBpcyBsb2FkZWQKCQkJICogd2hlbiB1c2luZyBpbmZpbml0ZSBzY3JvbGxpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBpbnQKCQkJICovCgkJCSJpTG9hZEdhcCI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogVmlld3BvcnQgd2lkdGggZm9yIGhvcml6b250YWwgc2Nyb2xsaW5nLiBIb3Jpem9udGFsIHNjcm9sbGluZyBpcyAKCQkJICogZGlzYWJsZWQgaWYgYW4gZW1wdHkgc3RyaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqLwoJCQkic1giOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFdpZHRoIHRvIGV4cGFuZCB0aGUgdGFibGUgdG8gd2hlbiB1c2luZyB4LXNjcm9sbGluZy4gVHlwaWNhbGx5IHlvdQoJCQkgKiBzaG91bGQgbm90IG5lZWQgdG8gdXNlIHRoaXMuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZXByZWNhdGVkCgkJCSAqLwoJCQkic1hJbm5lciI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogVmlld3BvcnQgaGVpZ2h0IGZvciB2ZXJ0aWNhbCBzY3JvbGxpbmcuIFZlcnRpY2FsIHNjcm9sbGluZyBpcyBkaXNhYmxlZAoJCQkgKiBpZiBhbiBlbXB0eSBzdHJpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICovCgkJCSJzWSI6IG51bGwKCQl9LAoJCQoJCS8qKgoJCSAqIExhbmd1YWdlIGluZm9ybWF0aW9uIGZvciB0aGUgdGFibGUuCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLmRlZmF1bHRzLm9MYW5ndWFnZQoJCSAqLwoJCSJvTGFuZ3VhZ2UiOiB7CgkJCS8qKgoJCQkgKiBJbmZvcm1hdGlvbiBjYWxsYmFjayBmdW5jdGlvbi4gU2VlIAoJCQkgKiB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmZuSW5mb0NhbGxiYWNrfQoJCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkJICogIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCSJmbkluZm9DYWxsYmFjayI6IG51bGwKCQl9LAoJCQoJCS8qKgoJCSAqIEJyb3dzZXIgc3VwcG9ydCBwYXJhbWV0ZXJzCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib0Jyb3dzZXIiOiB7CgkJCS8qKgoJCQkgKiBJbmRpY2F0ZSBpZiB0aGUgYnJvd3NlciBpbmNvcnJlY3RseSBjYWxjdWxhdGVzIHdpZHRoOjEwMCUgaW5zaWRlIGEKCQkJICogc2Nyb2xsaW5nIGVsZW1lbnQgKElFNi83KQoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCSJiU2Nyb2xsT3ZlcnNpemUiOiBmYWxzZQoJCX0sCgkJCgkJLyoqCgkJICogQXJyYXkgcmVmZXJlbmNpbmcgdGhlIG5vZGVzIHdoaWNoIGFyZSB1c2VkIGZvciB0aGUgZmVhdHVyZXMuIFRoZSAKCQkgKiBwYXJhbWV0ZXJzIG9mIHRoaXMgb2JqZWN0IG1hdGNoIHdoYXQgaXMgYWxsb3dlZCBieSBzRG9tIC0gaS5lLgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+J2wnIC0gTGVuZ3RoIGNoYW5naW5nPC9saT4KCQkgKiAgICAgPGxpPidmJyAtIEZpbHRlcmluZyBpbnB1dDwvbGk+CgkJICogICAgIDxsaT4ndCcgLSBUaGUgdGFibGUhPC9saT4KCQkgKiAgICAgPGxpPidpJyAtIEluZm9ybWF0aW9uPC9saT4KCQkgKiAgICAgPGxpPidwJyAtIFBhZ2luYXRpb248L2xpPgoJCSAqICAgICA8bGk+J3InIC0gcFJvY2Vzc2luZzwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhYW5GZWF0dXJlcyI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGRhdGEgaW5mb3JtYXRpb24gLSBzZWUge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1Jvd30gZm9yIGRldGFpbGVkCgkJICogaW5mb3JtYXRpb24uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRGF0YSI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGluZGV4ZXMgd2hpY2ggYXJlIGluIHRoZSBjdXJyZW50IGRpc3BsYXkgKGFmdGVyIGZpbHRlcmluZyBldGMpCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFpRGlzcGxheSI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGluZGV4ZXMgZm9yIGRpc3BsYXkgLSBubyBmaWx0ZXJpbmcKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYWlEaXNwbGF5TWFzdGVyIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgaW5mb3JtYXRpb24gYWJvdXQgZWFjaCBjb2x1bW4gdGhhdCBpcyBpbiB1c2UKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Db2x1bW5zIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHRhYmxlJ3MgaGVhZGVyCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvSGVhZGVyIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHRhYmxlJ3MgZm9vdGVyCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRm9vdGVyIjogW10sCgkJCgkJLyoqCgkJICogU2VhcmNoIGRhdGEgYXJyYXkgZm9yIHJlZ3VsYXIgZXhwcmVzc2lvbiBzZWFyY2hpbmcKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYXNEYXRhU2VhcmNoIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgdGhlIGFwcGxpZWQgZ2xvYmFsIHNlYXJjaCBpbmZvcm1hdGlvbiBpbiBjYXNlIHdlIHdhbnQgdG8gZm9yY2UgYSAKCQkgKiByZXNlYXJjaCBvciBjb21wYXJlIHRoZSBvbGQgc2VhcmNoIHRvIGEgbmV3IG9uZS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoCgkJICovCgkJIm9QcmV2aW91c1NlYXJjaCI6IHt9LAoJCQoJCS8qKgoJCSAqIFN0b3JlIHRoZSBhcHBsaWVkIHNlYXJjaCBmb3IgZWFjaCBjb2x1bW4gLSBzZWUgCgkJICoge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaH0gZm9yIHRoZSBmb3JtYXQgdGhhdCBpcyB1c2VkIGZvciB0aGUKCQkgKiBmaWx0ZXJpbmcgaW5mb3JtYXRpb24gZm9yIGVhY2ggY29sdW1uLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1ByZVNlYXJjaENvbHMiOiBbXSwKCQkKCQkvKioKCQkgKiBTb3J0aW5nIHRoYXQgaXMgYXBwbGllZCB0byB0aGUgdGFibGUuIE5vdGUgdGhhdCB0aGUgaW5uZXIgYXJyYXlzIGFyZQoJCSAqIHVzZWQgaW4gdGhlIGZvbGxvd2luZyBtYW5uZXI6CgkJICogPHVsPgoJCSAqICAgPGxpPkluZGV4IDAgLSBjb2x1bW4gbnVtYmVyPC9saT4KCQkgKiAgIDxsaT5JbmRleCAxIC0gY3VycmVudCBzb3J0aW5nIGRpcmVjdGlvbjwvbGk+CgkJICogICA8bGk+SW5kZXggMiAtIGluZGV4IG9mIGFzU29ydGluZyBmb3IgdGhpcyBjb2x1bW48L2xpPgoJCSAqIDwvdWw+CgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAdG9kbyBUaGVzZSBpbm5lciBhcnJheXMgc2hvdWxkIHJlYWxseSBiZSBvYmplY3RzCgkJICovCgkJImFhU29ydGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogU29ydGluZyB0aGF0IGlzIGFsd2F5cyBhcHBsaWVkIHRvIHRoZSB0YWJsZSAoaS5lLiBwcmVmaXhlZCBpbiBmcm9udCBvZgoJCSAqIGFhU29ydGluZykuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheXxudWxsCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiYWFTb3J0aW5nRml4ZWQiOiBudWxsLAoJCQoJCS8qKgoJCSAqIENsYXNzZXMgdG8gdXNlIGZvciB0aGUgc3RyaXBpbmcgb2YgYSB0YWJsZS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFzU3RyaXBlQ2xhc3NlcyI6IG51bGwsCgkJCgkJLyoqCgkJICogSWYgcmVzdG9yaW5nIGEgdGFibGUgLSB3ZSBzaG91bGQgcmVzdG9yZSBpdHMgc3RyaXBpbmcgY2xhc3NlcyBhcyB3ZWxsCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFzRGVzdHJveVN0cmlwZXMiOiBbXSwKCQkKCQkvKioKCQkgKiBJZiByZXN0b3JpbmcgYSB0YWJsZSAtIHdlIHNob3VsZCByZXN0b3JlIGl0cyB3aWR0aCAKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkic0Rlc3Ryb3lXaWR0aCI6IDAsCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGFycmF5IGZvciBldmVyeSB0aW1lIGEgcm93IGlzIGluc2VydGVkIChpLmUuIG9uIGEgZHJhdykuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUm93Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgZm9yIHRoZSBoZWFkZXIgb24gZWFjaCBkcmF3LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0hlYWRlckNhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHRoZSBmb290ZXIgb24gZWFjaCBkcmF3LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Zvb3RlckNhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciBkcmF3IGNhbGxiYWNrIGZ1bmN0aW9ucwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0RyYXdDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igcm93IGNyZWF0ZWQgZnVuY3Rpb24KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Sb3dDcmVhdGVkQ2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgZm9yIGp1c3QgYmVmb3JlIHRoZSB0YWJsZSBpcyByZWRyYXduLiBBIHJldHVybiBvZiAKCQkgKiBmYWxzZSB3aWxsIGJlIHVzZWQgdG8gY2FuY2VsIHRoZSBkcmF3LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1ByZURyYXdDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igd2hlbiB0aGUgdGFibGUgaGFzIGJlZW4gaW5pdGlhbGlzZWQuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvSW5pdENvbXBsZXRlIjogW10sCgkKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG1vZGlmeWluZyB0aGUgc2V0dGluZ3MgdG8gYmUgc3RvcmVkIGZvciBzdGF0ZSBzYXZpbmcsIHByaW9yIHRvCgkJICogc2F2aW5nIHN0YXRlLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlU2F2ZVBhcmFtcyI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrcyBmb3IgbW9kaWZ5aW5nIHRoZSBzZXR0aW5ncyB0aGF0IGhhdmUgYmVlbiBzdG9yZWQgZm9yIHN0YXRlIHNhdmluZwoJCSAqIHByaW9yIHRvIHVzaW5nIHRoZSBzdG9yZWQgdmFsdWVzIHRvIHJlc3RvcmUgdGhlIHN0YXRlLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlTG9hZFBhcmFtcyI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrcyBmb3Igb3BlcmF0aW5nIG9uIHRoZSBzZXR0aW5ncyBvYmplY3Qgb25jZSB0aGUgc2F2ZWQgc3RhdGUgaGFzIGJlZW4KCQkgKiBsb2FkZWQKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZUxvYWRlZCI6IFtdLAoJCQoJCS8qKgoJCSAqIENhY2hlIHRoZSB0YWJsZSBJRCBmb3IgcXVpY2sgYWNjZXNzCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICovCgkJInNUYWJsZUlkIjogIiIsCgkJCgkJLyoqCgkJICogVGhlIFRBQkxFIG5vZGUgZm9yIHRoZSBtYWluIHRhYmxlCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVGFibGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFBlcm1hbmVudCByZWYgdG8gdGhlIHRoZWFkIGVsZW1lbnQKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5USGVhZCI6IG51bGwsCgkJCgkJLyoqCgkJICogUGVybWFuZW50IHJlZiB0byB0aGUgdGZvb3QgZWxlbWVudCAtIGlmIGl0IGV4aXN0cwoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRGb290IjogbnVsbCwKCQkKCQkvKioKCQkgKiBQZXJtYW5lbnQgcmVmIHRvIHRoZSB0Ym9keSBlbGVtZW50CgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVEJvZHkiOiBudWxsLAoJCQoJCS8qKgoJCSAqIENhY2hlIHRoZSB3cmFwcGVyIG5vZGUgKGNvbnRhaW5zIGFsbCBEYXRhVGFibGVzIGNvbnRyb2xsZWQgZWxlbWVudHMpCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVGFibGVXcmFwcGVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiB3aGVuIHVzaW5nIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgdGhlIGxvYWRpbmcgb2YgZGF0YSAKCQkgKiBzaG91bGQgYmUgZGVmZXJyZWQgdW50aWwgdGhlIHNlY29uZCBkcmF3LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCSJiRGVmZXJMb2FkaW5nIjogZmFsc2UsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgYWxsIHJlcXVpcmVkIGluZm9ybWF0aW9uIGhhcyBiZWVuIHJlYWQgaW4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCSJiSW5pdGlhbGlzZWQiOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBJbmZvcm1hdGlvbiBhYm91dCBvcGVuIHJvd3MuIEVhY2ggb2JqZWN0IGluIHRoZSBhcnJheSBoYXMgdGhlIHBhcmFtZXRlcnMKCQkgKiAnblRyJyBhbmQgJ25QYXJlbnQnCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvT3BlblJvd3MiOiBbXSwKCQkKCQkvKioKCQkgKiBEaWN0YXRlIHRoZSBwb3NpdGlvbmluZyBvZiBEYXRhVGFibGVzJyBjb250cm9sIGVsZW1lbnRzIC0gc2VlCgkJICoge0BsaW5rIERhdGFUYWJsZS5tb2RlbC5vSW5pdC5zRG9tfS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNEb20iOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoaWNoIHR5cGUgb2YgcGFnaW5hdGlvbiBzaG91bGQgYmUgdXNlZC4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZyAKCQkgKiAgQGRlZmF1bHQgdHdvX2J1dHRvbgoJCSAqLwoJCSJzUGFnaW5hdGlvblR5cGUiOiAidHdvX2J1dHRvbiIsCgkJCgkJLyoqCgkJICogVGhlIGNvb2tpZSBkdXJhdGlvbiAoZm9yIGJTdGF0ZVNhdmUpIGluIHNlY29uZHMuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJpQ29va2llRHVyYXRpb24iOiAwLAoJCQoJCS8qKgoJCSAqIFRoZSBjb29raWUgbmFtZSBwcmVmaXguCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqLwoJCSJzQ29va2llUHJlZml4IjogIiIsCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIGNvb2tpZSBjcmVhdGlvbi4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5Db29raWVDYWxsYmFjayI6IG51bGwsCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciBzdGF0ZSBzYXZpbmcuIEVhY2ggYXJyYXkgZWxlbWVudCBpcyBhbiAKCQkgKiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5mdW5jdGlvbjpmbiAtIGZ1bmN0aW9uIHRvIGNhbGwuIFRha2VzIHR3byBwYXJhbWV0ZXJzLCBvU2V0dGluZ3MKCQkgKiAgICAgICBhbmQgdGhlIEpTT04gc3RyaW5nIHRvIHNhdmUgdGhhdCBoYXMgYmVlbiB0aHVzIGZhciBjcmVhdGVkLiBSZXR1cm5zCgkJICogICAgICAgYSBKU09OIHN0cmluZyB0byBiZSBpbnNlcnRlZCBpbnRvIGEganNvbiBvYmplY3QgCgkJICogICAgICAgKGkuZS4gJyJwYXJhbSI6IFsgMCwgMSwgMl0nKTwvbGk+CgkJICogICAgIDxsaT5zdHJpbmc6c05hbWUgLSBuYW1lIG9mIGNhbGxiYWNrPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVTYXZlIjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciBzdGF0ZSBsb2FkaW5nLiBFYWNoIGFycmF5IGVsZW1lbnQgaXMgYW4gCgkJICogb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+ZnVuY3Rpb246Zm4gLSBmdW5jdGlvbiB0byBjYWxsLiBUYWtlcyB0d28gcGFyYW1ldGVycywgb1NldHRpbmdzIAoJCSAqICAgICAgIGFuZCB0aGUgb2JqZWN0IHN0b3JlZC4gTWF5IHJldHVybiBmYWxzZSB0byBjYW5jZWwgc3RhdGUgbG9hZGluZzwvbGk+CgkJICogICAgIDxsaT5zdHJpbmc6c05hbWUgLSBuYW1lIG9mIGNhbGxiYWNrPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVMb2FkIjogW10sCgkJCgkJLyoqCgkJICogU3RhdGUgdGhhdCB3YXMgbG9hZGVkIGZyb20gdGhlIGNvb2tpZS4gVXNlZnVsIGZvciBiYWNrIHJlZmVyZW5jZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJvTG9hZGVkU3RhdGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFNvdXJjZSB1cmwgZm9yIEFKQVggZGF0YSBmb3IgdGhlIHRhYmxlLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0FqYXhTb3VyY2UiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFByb3BlcnR5IGZyb20gYSBnaXZlbiBvYmplY3QgZnJvbSB3aGljaCB0byByZWFkIHRoZSB0YWJsZSBkYXRhIGZyb20uIFRoaXMKCQkgKiBjYW4gYmUgYW4gZW1wdHkgc3RyaW5nICh3aGVuIG5vdCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nKSwgaW4gd2hpY2ggY2FzZSAKCQkgKiBpdCBpcyAgYXNzdW1lZCBhbiBhbiBhcnJheSBpcyBnaXZlbiBkaXJlY3RseS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzQWpheERhdGFQcm9wIjogbnVsbCwKCQkKCQkvKioKCQkgKiBOb3RlIGlmIGRyYXcgc2hvdWxkIGJlIGJsb2NrZWQgd2hpbGUgZ2V0dGluZyBkYXRhCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiQWpheERhdGFHZXQiOiB0cnVlLAoJCQoJCS8qKgoJCSAqIFRoZSBsYXN0IGpRdWVyeSBYSFIgb2JqZWN0IHRoYXQgd2FzIHVzZWQgZm9yIHNlcnZlci1zaWRlIGRhdGEgZ2F0aGVyaW5nLiAKCQkgKiBUaGlzIGNhbiBiZSB1c2VkIGZvciB3b3JraW5nIHdpdGggdGhlIFhIUiBpbmZvcm1hdGlvbiBpbiBvbmUgb2YgdGhlIAoJCSAqIGNhbGxiYWNrcwoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJqcVhIUiI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb24gdG8gZ2V0IHRoZSBzZXJ2ZXItc2lkZSBkYXRhLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5TZXJ2ZXJEYXRhIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGdW5jdGlvbnMgd2hpY2ggYXJlIGNhbGxlZCBwcmlvciB0byBzZW5kaW5nIGFuIEFqYXggcmVxdWVzdCBzbyBleHRyYSAKCQkgKiBwYXJhbWV0ZXJzIGNhbiBlYXNpbHkgYmUgc2VudCB0byB0aGUgc2VydmVyCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU2VydmVyUGFyYW1zIjogW10sCgkJCgkJLyoqCgkJICogU2VuZCB0aGUgWEhSIEhUVFAgbWV0aG9kIC0gR0VUIG9yIFBPU1QgKGNvdWxkIGJlIFBVVCBvciBERUxFVEUgaWYgCgkJICogcmVxdWlyZWQpLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNTZXJ2ZXJNZXRob2QiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZvcm1hdCBudW1iZXJzIGZvciBkaXNwbGF5LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5Gb3JtYXROdW1iZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIExpc3Qgb2Ygb3B0aW9ucyB0aGF0IGNhbiBiZSB1c2VkIGZvciB0aGUgdXNlciBzZWxlY3RhYmxlIGxlbmd0aCBtZW51LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYUxlbmd0aE1lbnUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIENvdW50ZXIgZm9yIHRoZSBkcmF3cyB0aGF0IHRoZSB0YWJsZSBkb2VzLiBBbHNvIHVzZWQgYXMgYSB0cmFja2VyIGZvcgoJCSAqIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiaURyYXciOiAwLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIGEgcmVkcmF3IGlzIGJlaW5nIGRvbmUgLSB1c2VmdWwgZm9yIEFqYXgKCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCSJiRHJhd2luZyI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIERyYXcgaW5kZXggKGlEcmF3KSBvZiB0aGUgbGFzdCBlcnJvciB3aGVuIHBhcnNpbmcgdGhlIHJldHVybmVkIGRhdGEKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IC0xCgkJICovCgkJImlEcmF3RXJyb3IiOiAtMSwKCQkKCQkvKioKCQkgKiBQYWdpbmcgZGlzcGxheSBsZW5ndGgKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDEwCgkJICovCgkJIl9pRGlzcGxheUxlbmd0aCI6IDEwLAoJCgkJLyoqCgkJICogUGFnaW5nIHN0YXJ0IHBvaW50IC0gYWlEaXNwbGF5IGluZGV4CgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJIl9pRGlzcGxheVN0YXJ0IjogMCwKCQoJCS8qKgoJCSAqIFBhZ2luZyBlbmQgcG9pbnQgLSBhaURpc3BsYXkgaW5kZXguIFVzZSBmbkRpc3BsYXlFbmQgcmF0aGVyIHRoYW4KCQkgKiB0aGlzIHByb3BlcnR5IHRvIGdldCB0aGUgZW5kIHBvaW50CgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfaURpc3BsYXlFbmQiOiAxMCwKCQkKCQkvKioKCQkgKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIHJlc3VsdCBzZXQKCQkgKiAoaS5lLiBiZWZvcmUgZmlsdGVyaW5nKSwgVXNlIGZuUmVjb3Jkc1RvdGFsIHJhdGhlciB0aGFuCgkJICogdGhpcyBwcm9wZXJ0eSB0byBnZXQgdGhlIHZhbHVlIG9mIHRoZSBudW1iZXIgb2YgcmVjb3JkcywgcmVnYXJkbGVzcyBvZgoJCSAqIHRoZSBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHNldHRpbmcuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9pUmVjb3Jkc1RvdGFsIjogMCwKCQoJCS8qKgoJCSAqIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgLSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCBkaXNwbGF5IHNldAoJCSAqIChpLmUuIGFmdGVyIGZpbHRlcmluZykuIFVzZSBmblJlY29yZHNEaXNwbGF5IHJhdGhlciB0aGFuCgkJICogdGhpcyBwcm9wZXJ0eSB0byBnZXQgdGhlIHZhbHVlIG9mIHRoZSBudW1iZXIgb2YgcmVjb3JkcywgcmVnYXJkbGVzcyBvZgoJCSAqIHRoZSBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHNldHRpbmcuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfaVJlY29yZHNEaXNwbGF5IjogMCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIGpRdWVyeSBVSSBtYXJraW5nIGFuZCBjbGFzc2VzIHNob3VsZCBiZSB1c2VkLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiSlVJIjogbnVsbCwKCQkKCQkvKioKCQkgKiBUaGUgY2xhc3NlcyB0byB1c2UgZm9yIHRoZSB0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0NsYXNzZXMiOiB7fSwKCQkKCQkvKioKCQkgKiBGbGFnIGF0dGFjaGVkIHRvIHRoZSBzZXR0aW5ncyBvYmplY3Qgc28geW91IGNhbiBjaGVjayBpbiB0aGUgZHJhdyAKCQkgKiBjYWxsYmFjayBpZiBmaWx0ZXJpbmcgaGFzIGJlZW4gZG9uZSBpbiB0aGUgZHJhdy4gRGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YKCQkgKiBldmVudHMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYkZpbHRlcmVkIjogZmFsc2UsCgkJCgkJLyoqCgkJICogRmxhZyBhdHRhY2hlZCB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IHNvIHlvdSBjYW4gY2hlY2sgaW4gdGhlIGRyYXcgCgkJICogY2FsbGJhY2sgaWYgc29ydGluZyBoYXMgYmVlbiBkb25lIGluIHRoZSBkcmF3LiBEZXByZWNhdGVkIGluIGZhdm91ciBvZgoJCSAqIGV2ZW50cy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqLwoJCSJiU29ydGVkIjogZmFsc2UsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgdGhhdCBpZiBtdWx0aXBsZSByb3dzIGFyZSBpbiB0aGUgaGVhZGVyIGFuZCB0aGVyZSBpcyBtb3JlIHRoYW4gCgkJICogb25lIHVuaXF1ZSBjZWxsIHBlciBjb2x1bW4sIGlmIHRoZSB0b3Agb25lICh0cnVlKSBvciBib3R0b20gb25lIChmYWxzZSkgCgkJICogc2hvdWxkIGJlIHVzZWQgZm9yIHNvcnRpbmcgLyB0aXRsZSBieSBEYXRhVGFibGVzLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiU29ydENlbGxzVG9wIjogbnVsbCwKCQkKCQkvKioKCQkgKiBJbml0aWFsaXNhdGlvbiBvYmplY3QgdGhhdCBpcyB1c2VkIGZvciB0aGUgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0luaXQiOiBudWxsLAoJCQoJCS8qKgoJCSAqIERlc3Ryb3kgY2FsbGJhY2sgZnVuY3Rpb25zIC0gZm9yIHBsdWctaW5zIHRvIGF0dGFjaCB0aGVtc2VsdmVzIHRvIHRoZQoJCSAqIGRlc3Ryb3kgc28gdGhleSBjYW4gY2xlYW4gdXAgbWFya3VwIGFuZCBldmVudHMuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRGVzdHJveUNhbGxiYWNrIjogW10sCgkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSBjdXJyZW50IHJlY29yZCBzZXQsIGJlZm9yZSBmaWx0ZXJpbmcKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5SZWNvcmRzVG90YWwiOiBmdW5jdGlvbiAoKQoJCXsKCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApIHsKCQkJCXJldHVybiBwYXJzZUludCh0aGlzLl9pUmVjb3Jkc1RvdGFsLCAxMCk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gdGhpcy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoOwoJCQl9CgkJfSwKCQkKCQkvKioKCQkgKiBHZXQgdGhlIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSBjdXJyZW50IHJlY29yZCBzZXQsIGFmdGVyIGZpbHRlcmluZwoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqLwoJCSJmblJlY29yZHNEaXNwbGF5IjogZnVuY3Rpb24gKCkKCQl7CgkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKSB7CgkJCQlyZXR1cm4gcGFyc2VJbnQodGhpcy5faVJlY29yZHNEaXNwbGF5LCAxMCk7CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gdGhpcy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJfSwKCQkKCQkvKioKCQkgKiBTZXQgdGhlIGRpc3BsYXkgZW5kIHBvaW50IC0gYWlEaXNwbGF5IGluZGV4CgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEB0b2RvIFNob3VsZCBkbyBhd2F5IHdpdGggX2lEaXNwbGF5RW5kIGFuZCBjYWxjdWxhdGUgaXQgb24tdGhlLWZseSBoZXJlCgkJICovCgkJImZuRGlzcGxheUVuZCI6IGZ1bmN0aW9uICgpCgkJewoJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkgewoJCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlIHx8IHRoaXMuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkgewoJCQkJCXJldHVybiB0aGlzLl9pRGlzcGxheVN0YXJ0K3RoaXMuYWlEaXNwbGF5Lmxlbmd0aDsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuIE1hdGgubWluKCB0aGlzLl9pRGlzcGxheVN0YXJ0K3RoaXMuX2lEaXNwbGF5TGVuZ3RoLCAKCQkJCQkJdGhpcy5faVJlY29yZHNEaXNwbGF5ICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gdGhpcy5faURpc3BsYXlFbmQ7CgkJCX0KCQl9LAoJCQoJCS8qKgoJCSAqIFRoZSBEYXRhVGFibGVzIG9iamVjdCBmb3IgdGhpcyB0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJvSW5zdGFuY2UiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBpZGVudGlmaWVyIGZvciBlYWNoIGluc3RhbmNlIG9mIHRoZSBEYXRhVGFibGVzIG9iamVjdC4gSWYgdGhlcmUKCQkgKiBpcyBhbiBJRCBvbiB0aGUgdGFibGUgbm9kZSwgdGhlbiBpdCB0YWtlcyB0aGF0IHZhbHVlLCBvdGhlcndpc2UgYW4KCQkgKiBpbmNyZW1lbnRpbmcgaW50ZXJuYWwgY291bnRlciBpcyB1c2VkLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzSW5zdGFuY2UiOiBudWxsLAoJCgkJLyoqCgkJICogdGFiaW5kZXggYXR0cmlidXRlIHZhbHVlIHRoYXQgaXMgYWRkZWQgdG8gRGF0YVRhYmxlcyBjb250cm9sIGVsZW1lbnRzLCBhbGxvd2luZwoJCSAqIGtleWJvYXJkIG5hdmlnYXRpb24gb2YgdGhlIHRhYmxlIGFuZCBpdHMgY29udHJvbHMuCgkJICovCgkJImlUYWJJbmRleCI6IDAsCgkKCQkvKioKCQkgKiBESVYgY29udGFpbmVyIGZvciB0aGUgZm9vdGVyIHNjcm9sbGluZyB0YWJsZSBpZiBzY3JvbGxpbmcKCQkgKi8KCQkiblNjcm9sbEhlYWQiOiBudWxsLAoJCgkJLyoqCgkJICogRElWIGNvbnRhaW5lciBmb3IgdGhlIGZvb3RlciBzY3JvbGxpbmcgdGFibGUgaWYgc2Nyb2xsaW5nCgkJICovCgkJIm5TY3JvbGxGb290IjogbnVsbAoJfTsKCgkvKioKCSAqIEV4dGVuc2lvbiBvYmplY3QgZm9yIERhdGFUYWJsZXMgdGhhdCBpcyB1c2VkIHRvIHByb3ZpZGUgYWxsIGV4dGVuc2lvbiBvcHRpb25zLgoJICogCgkgKiBOb3RlIHRoYXQgdGhlIDxpPkRhdGFUYWJsZS5leHQ8L2k+IG9iamVjdCBpcyBhdmFpbGFibGUgdGhyb3VnaAoJICogPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZS5leHQ8L2k+IHdoZXJlIGl0IG1heSBiZSBhY2Nlc3NlZCBhbmQgbWFuaXB1bGF0ZWQuIEl0IGlzCgkgKiBhbHNvIGFsaWFzZWQgdG8gPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZUV4dDwvaT4gZm9yIGhpc3RvcmljIHJlYXNvbnMuCgkgKiAgQG5hbWVzcGFjZQoJICogIEBleHRlbmRzIERhdGFUYWJsZS5tb2RlbHMuZXh0CgkgKi8KCURhdGFUYWJsZS5leHQgPSAkLmV4dGVuZCggdHJ1ZSwge30sIERhdGFUYWJsZS5tb2RlbHMuZXh0ICk7CgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9TdGRDbGFzc2VzLCB7CgkJInNUYWJsZSI6ICJkYXRhVGFibGUiLAoJCgkJLyogVHdvIGJ1dHRvbnMgYnV0dG9ucyAqLwoJCSJzUGFnZVByZXZFbmFibGVkIjogInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiLAoJCSJzUGFnZVByZXZEaXNhYmxlZCI6ICJwYWdpbmF0ZV9kaXNhYmxlZF9wcmV2aW91cyIsCgkJInNQYWdlTmV4dEVuYWJsZWQiOiAicGFnaW5hdGVfZW5hYmxlZF9uZXh0IiwKCQkic1BhZ2VOZXh0RGlzYWJsZWQiOiAicGFnaW5hdGVfZGlzYWJsZWRfbmV4dCIsCgkJInNQYWdlSlVJTmV4dCI6ICIiLAoJCSJzUGFnZUpVSVByZXYiOiAiIiwKCQkKCQkvKiBGdWxsIG51bWJlcnMgcGFnaW5nIGJ1dHRvbnMgKi8KCQkic1BhZ2VCdXR0b24iOiAicGFnaW5hdGVfYnV0dG9uIiwKCQkic1BhZ2VCdXR0b25BY3RpdmUiOiAicGFnaW5hdGVfYWN0aXZlIiwKCQkic1BhZ2VCdXR0b25TdGF0aWNEaXNhYmxlZCI6ICJwYWdpbmF0ZV9idXR0b24gcGFnaW5hdGVfYnV0dG9uX2Rpc2FibGVkIiwKCQkic1BhZ2VGaXJzdCI6ICJmaXJzdCIsCgkJInNQYWdlUHJldmlvdXMiOiAicHJldmlvdXMiLAoJCSJzUGFnZU5leHQiOiAibmV4dCIsCgkJInNQYWdlTGFzdCI6ICJsYXN0IiwKCQkKCQkvKiBTdHJpcGluZyBjbGFzc2VzICovCgkJInNTdHJpcGVPZGQiOiAib2RkIiwKCQkic1N0cmlwZUV2ZW4iOiAiZXZlbiIsCgkJCgkJLyogRW1wdHkgcm93ICovCgkJInNSb3dFbXB0eSI6ICJkYXRhVGFibGVzX2VtcHR5IiwKCQkKCQkvKiBGZWF0dXJlcyAqLwoJCSJzV3JhcHBlciI6ICJkYXRhVGFibGVzX3dyYXBwZXIiLAoJCSJzRmlsdGVyIjogImRhdGFUYWJsZXNfZmlsdGVyIiwKCQkic0luZm8iOiAiZGF0YVRhYmxlc19pbmZvIiwKCQkic1BhZ2luZyI6ICJkYXRhVGFibGVzX3BhZ2luYXRlIHBhZ2luZ18iLCAvKiBOb3RlIHRoYXQgdGhlIHR5cGUgaXMgcG9zdGZpeGVkICovCgkJInNMZW5ndGgiOiAiZGF0YVRhYmxlc19sZW5ndGgiLAoJCSJzUHJvY2Vzc2luZyI6ICJkYXRhVGFibGVzX3Byb2Nlc3NpbmciLAoJCQoJCS8qIFNvcnRpbmcgKi8KCQkic1NvcnRBc2MiOiAic29ydGluZ19hc2MiLAoJCSJzU29ydERlc2MiOiAic29ydGluZ19kZXNjIiwKCQkic1NvcnRhYmxlIjogInNvcnRpbmciLCAvKiBTb3J0YWJsZSBpbiBib3RoIGRpcmVjdGlvbnMgKi8KCQkic1NvcnRhYmxlQXNjIjogInNvcnRpbmdfYXNjX2Rpc2FibGVkIiwKCQkic1NvcnRhYmxlRGVzYyI6ICJzb3J0aW5nX2Rlc2NfZGlzYWJsZWQiLAoJCSJzU29ydGFibGVOb25lIjogInNvcnRpbmdfZGlzYWJsZWQiLAoJCSJzU29ydENvbHVtbiI6ICJzb3J0aW5nXyIsIC8qIE5vdGUgdGhhdCBhbiBpbnQgaXMgcG9zdGZpeGVkIGZvciB0aGUgc29ydGluZyBvcmRlciAqLwoJCSJzU29ydEpVSUFzYyI6ICIiLAoJCSJzU29ydEpVSURlc2MiOiAiIiwKCQkic1NvcnRKVUkiOiAiIiwKCQkic1NvcnRKVUlBc2NBbGxvd2VkIjogIiIsCgkJInNTb3J0SlVJRGVzY0FsbG93ZWQiOiAiIiwKCQkic1NvcnRKVUlXcmFwcGVyIjogIiIsCgkJInNTb3J0SWNvbiI6ICIiLAoJCQoJCS8qIFNjcm9sbGluZyAqLwoJCSJzU2Nyb2xsV3JhcHBlciI6ICJkYXRhVGFibGVzX3Njcm9sbCIsCgkJInNTY3JvbGxIZWFkIjogImRhdGFUYWJsZXNfc2Nyb2xsSGVhZCIsCgkJInNTY3JvbGxIZWFkSW5uZXIiOiAiZGF0YVRhYmxlc19zY3JvbGxIZWFkSW5uZXIiLAoJCSJzU2Nyb2xsQm9keSI6ICJkYXRhVGFibGVzX3Njcm9sbEJvZHkiLAoJCSJzU2Nyb2xsRm9vdCI6ICJkYXRhVGFibGVzX3Njcm9sbEZvb3QiLAoJCSJzU2Nyb2xsRm9vdElubmVyIjogImRhdGFUYWJsZXNfc2Nyb2xsRm9vdElubmVyIiwKCQkKCQkvKiBNaXNjICovCgkJInNGb290ZXJUSCI6ICIiLAoJCSJzSlVJSGVhZGVyIjogIiIsCgkJInNKVUlGb290ZXIiOiAiIgoJfSApOwoJCgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9KVUlDbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9TdGRDbGFzc2VzLCB7CgkJLyogVHdvIGJ1dHRvbnMgYnV0dG9ucyAqLwoJCSJzUGFnZVByZXZFbmFibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItbGVmdCIsCgkJInNQYWdlUHJldkRpc2FibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItbGVmdCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlTmV4dEVuYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1yaWdodCIsCgkJInNQYWdlTmV4dERpc2FibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItcmlnaHQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZUpVSU5leHQiOiAidWktaWNvbiB1aS1pY29uLWNpcmNsZS1hcnJvdy1lIiwKCQkic1BhZ2VKVUlQcmV2IjogInVpLWljb24gdWktaWNvbi1jaXJjbGUtYXJyb3ctdyIsCgkJCgkJLyogRnVsbCBudW1iZXJzIHBhZ2luZyBidXR0b25zICovCgkJInNQYWdlQnV0dG9uIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCIsCgkJInNQYWdlQnV0dG9uQWN0aXZlIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VGaXJzdCI6ICJmaXJzdCB1aS1jb3JuZXItdGwgdWktY29ybmVyLWJsIiwKCQkic1BhZ2VMYXN0IjogImxhc3QgdWktY29ybmVyLXRyIHVpLWNvcm5lci1iciIsCgkJCgkJLyogRmVhdHVyZXMgKi8KCQkic1BhZ2luZyI6ICJkYXRhVGFibGVzX3BhZ2luYXRlIGZnLWJ1dHRvbnNldCB1aS1idXR0b25zZXQgZmctYnV0dG9uc2V0LW11bHRpICIrCgkJCSJ1aS1idXR0b25zZXQtbXVsdGkgcGFnaW5nXyIsIC8qIE5vdGUgdGhhdCB0aGUgdHlwZSBpcyBwb3N0Zml4ZWQgKi8KCQkKCQkvKiBTb3J0aW5nICovCgkJInNTb3J0QXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydERlc2MiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZSI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlQXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGVEZXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGVOb25lIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydEpVSUFzYyI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLXRyaWFuZ2xlLTEtbiIsCgkJInNTb3J0SlVJRGVzYyI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLXRyaWFuZ2xlLTEtcyIsCgkJInNTb3J0SlVJIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tY2FyYXQtMi1uLXMiLAoJCSJzU29ydEpVSUFzY0FsbG93ZWQiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi1jYXJhdC0xLW4iLAoJCSJzU29ydEpVSURlc2NBbGxvd2VkIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tY2FyYXQtMS1zIiwKCQkic1NvcnRKVUlXcmFwcGVyIjogIkRhdGFUYWJsZXNfc29ydF93cmFwcGVyIiwKCQkic1NvcnRJY29uIjogIkRhdGFUYWJsZXNfc29ydF9pY29uIiwKCQkKCQkvKiBTY3JvbGxpbmcgKi8KCQkic1Njcm9sbEhlYWQiOiAiZGF0YVRhYmxlc19zY3JvbGxIZWFkIHVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU2Nyb2xsRm9vdCI6ICJkYXRhVGFibGVzX3Njcm9sbEZvb3QgdWktc3RhdGUtZGVmYXVsdCIsCgkJCgkJLyogTWlzYyAqLwoJCSJzRm9vdGVyVEgiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNKVUlIZWFkZXIiOiAiZmctdG9vbGJhciB1aS10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLXRsIHVpLWNvcm5lci10ciB1aS1oZWxwZXItY2xlYXJmaXgiLAoJCSJzSlVJRm9vdGVyIjogImZnLXRvb2xiYXIgdWktdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1ibCB1aS1jb3JuZXItYnIgdWktaGVscGVyLWNsZWFyZml4IgoJfSApOwoJCgkvKgoJICogVmFyaWFibGU6IG9QYWdpbmF0aW9uCgkgKiBQdXJwb3NlOiAgCgkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dAoJICovCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbiwgewoJCS8qCgkJICogVmFyaWFibGU6IHR3b19idXR0b24KCQkgKiBQdXJwb3NlOiAgU3RhbmRhcmQgdHdvIGJ1dHRvbiAoZm9yd2FyZC9iYWNrKSBwYWdpbmF0aW9uCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkidHdvX2J1dHRvbiI6IHsKCQkJLyoKCQkJICogRnVuY3Rpb246IG9QYWdpbmF0aW9uLnR3b19idXR0b24uZm5Jbml0CgkJCSAqIFB1cnBvc2U6ICBJbml0aWFsaXNlIGRvbSBlbGVtZW50cyByZXF1aXJlZCBmb3IgcGFnaW5hdGlvbiB3aXRoIGZvcndhcmQvYmFjayBidXR0b25zIG9ubHkKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgbm9kZTpuUGFnaW5nIC0gdGhlIERJViB3aGljaCBjb250YWlucyB0aGlzIHBhZ2luYXRpb24gY29udHJvbAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIG9uIHVwZGF0ZQoJCQkgKi8KCQkJImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGZuQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKCBlICkgewoJCQkJCWlmICggb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEuYWN0aW9uICkgKQoJCQkJCXsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCX07CgkKCQkJCXZhciBzQXBwZW5kID0gKCFvU2V0dGluZ3MuYkpVSSkgPwoJCQkJCSc8YSBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VQcmV2RGlzYWJsZWQrJyIgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiByb2xlPSJidXR0b24iPicrb0xhbmcuc1ByZXZpb3VzKyc8L2E+JysKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj4nK29MYW5nLnNOZXh0Kyc8L2E+JwoJCQkJCToKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj48c3BhbiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VKVUlQcmV2KyciPjwvc3Bhbj48L2E+JysKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj48c3BhbiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VKVUlOZXh0KyciPjwvc3Bhbj48L2E+JzsKCQkJCSQoblBhZ2luZykuYXBwZW5kKCBzQXBwZW5kICk7CgkJCQkKCQkJCXZhciBlbHMgPSAkKCdhJywgblBhZ2luZyk7CgkJCQl2YXIgblByZXZpb3VzID0gZWxzWzBdLAoJCQkJCW5OZXh0ID0gZWxzWzFdOwoJCQkJCgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuUHJldmlvdXMsIHthY3Rpb246ICJwcmV2aW91cyJ9LCBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbk5leHQsICAgICB7YWN0aW9uOiAibmV4dCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCQoJCQkJLyogSUQgdGhlIGZpcnN0IGVsZW1lbnRzIG9ubHkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wICkKCQkJCXsKCQkJCQluUGFnaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcGFnaW5hdGUnOwoJCQkJCW5QcmV2aW91cy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3ByZXZpb3VzJzsKCQkJCQluTmV4dC5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX25leHQnOwoJCgkJCQkJblByZXZpb3VzLnNldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQkJbk5leHQuc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCX0KCQkJfSwKCQkJCgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi50d29fYnV0dG9uLmZuVXBkYXRlCgkJCSAqIFB1cnBvc2U6ICBVcGRhdGUgdGhlIHR3byBidXR0b24gcGFnaW5hdGlvbiBhdCB0aGUgZW5kIG9mIHRoZSBkcmF3CgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB0byBjYWxsIG9uIHBhZ2UgY2hhbmdlCgkJCSAqLwoJCQkiZm5VcGRhdGUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucDsKCQkJCXZhciBuTm9kZTsKCQoJCQkJLyogTG9vcCBvdmVyIGVhY2ggaW5zdGFuY2Ugb2YgdGhlIHBhZ2VyICovCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJbk5vZGUgPSBhbltpXS5maXJzdENoaWxkOwoJCQkJCWlmICggbk5vZGUgKQoJCQkJCXsKCQkJCQkJLyogUHJldmlvdXMgcGFnZSAqLwoJCQkJCQluTm9kZS5jbGFzc05hbWUgPSAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApID8KCQkJCQkJICAgIG9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkIDogb0NsYXNzZXMuc1BhZ2VQcmV2RW5hYmxlZDsKCQkJCQkJICAgIAoJCQkJCQkvKiBOZXh0IHBhZ2UgKi8KCQkJCQkJbk5vZGUgPSBuTm9kZS5uZXh0U2libGluZzsKCQkJCQkJbk5vZGUuY2xhc3NOYW1lID0gKCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgPT0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApID8KCQkJCQkJICAgIG9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkIDogb0NsYXNzZXMuc1BhZ2VOZXh0RW5hYmxlZDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9LAoJCQoJCQoJCS8qCgkJICogVmFyaWFibGU6IGlGdWxsTnVtYmVyc1Nob3dQYWdlcwoJCSAqIFB1cnBvc2U6ICBDaGFuZ2UgdGhlIG51bWJlciBvZiBwYWdlcyB3aGljaCBjYW4gYmUgc2VlbgoJCSAqIFNjb3BlOiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uCgkJICovCgkJImlGdWxsTnVtYmVyc1Nob3dQYWdlcyI6IDUsCgkJCgkJLyoKCQkgKiBWYXJpYWJsZTogZnVsbF9udW1iZXJzCgkJICogUHVycG9zZTogIEZ1bGwgbnVtYmVycyBwYWdpbmF0aW9uCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkiZnVsbF9udW1iZXJzIjogewoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24uZnVsbF9udW1iZXJzLmZuSW5pdAoJCQkgKiBQdXJwb3NlOiAgSW5pdGlhbGlzZSBkb20gZWxlbWVudHMgcmVxdWlyZWQgZm9yIHBhZ2luYXRpb24gd2l0aCBhIGxpc3Qgb2YgdGhlIHBhZ2VzCgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIG5vZGU6blBhZ2luZyAtIHRoZSBESVYgd2hpY2ggY29udGFpbnMgdGhpcyBwYWdpbmF0aW9uIGNvbnRyb2wKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB3aGljaCBtdXN0IGJlIGNhbGxlZCBvbiB1cGRhdGUKCQkJICovCgkJCSJmbkluaXQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgblBhZ2luZywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQl2YXIgb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZTsKCQkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCXZhciBmbkNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICggZSApIHsKCQkJCQlpZiAoIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLmFjdGlvbiApICkKCQkJCQl7CgkJCQkJCWZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQl9OwoJCgkJCQkkKG5QYWdpbmcpLmFwcGVuZCgKCQkJCQknPGEgIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlRmlyc3QrJyI+JytvTGFuZy5zRmlyc3QrJzwvYT4nKwoJCQkJCSc8YSAgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VQcmV2aW91cysnIj4nK29MYW5nLnNQcmV2aW91cysnPC9hPicrCgkJCQkJJzxzcGFuPjwvc3Bhbj4nKwoJCQkJCSc8YSB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZU5leHQrJyI+JytvTGFuZy5zTmV4dCsnPC9hPicrCgkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlTGFzdCsnIj4nK29MYW5nLnNMYXN0Kyc8L2E+JwoJCQkJKTsKCQkJCXZhciBlbHMgPSAkKCdhJywgblBhZ2luZyk7CgkJCQl2YXIgbkZpcnN0ID0gZWxzWzBdLAoJCQkJCW5QcmV2ID0gZWxzWzFdLAoJCQkJCW5OZXh0ID0gZWxzWzJdLAoJCQkJCW5MYXN0ID0gZWxzWzNdOwoJCQkJCgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuRmlyc3QsIHthY3Rpb246ICJmaXJzdCJ9LCAgICBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggblByZXYsICB7YWN0aW9uOiAicHJldmlvdXMifSwgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5OZXh0LCAge2FjdGlvbjogIm5leHQifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuTGFzdCwgIHthY3Rpb246ICJsYXN0In0sICAgICBmbkNsaWNrSGFuZGxlciApOwoJCQkJCgkJCQkvKiBJRCB0aGUgZmlyc3QgZWxlbWVudHMgb25seSAqLwoJCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKQoJCQkJewoJCQkJCW5QYWdpbmcuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19wYWdpbmF0ZSc7CgkJCQkJbkZpcnN0LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19maXJzdCc7CgkJCQkJblByZXYuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX3ByZXZpb3VzJzsKCQkJCQluTmV4dC5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfbmV4dCc7CgkJCQkJbkxhc3QuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX2xhc3QnOwoJCQkJfQoJCQl9LAoJCQkKCQkJLyoKCQkJICogRnVuY3Rpb246IG9QYWdpbmF0aW9uLmZ1bGxfbnVtYmVycy5mblVwZGF0ZQoJCQkgKiBQdXJwb3NlOiAgVXBkYXRlIHRoZSBsaXN0IG9mIHBhZ2UgYnV0dG9ucyBzaG93cwoJCQkgKiBSZXR1cm5zOiAgLQoJCQkgKiBJbnB1dHM6ICAgb2JqZWN0Om9TZXR0aW5ncyAtIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJCSAqICAgICAgICAgICBmdW5jdGlvbjpmbkNhbGxiYWNrRHJhdyAtIGRyYXcgZnVuY3Rpb24gdG8gY2FsbCBvbiBwYWdlIGNoYW5nZQoJCQkgKi8KCQkJImZuVXBkYXRlIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGZuQ2FsbGJhY2tEcmF3ICkKCQkJewoJCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJdmFyIGlQYWdlQ291bnQgPSBEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uLmlGdWxsTnVtYmVyc1Nob3dQYWdlczsKCQkJCXZhciBpUGFnZUNvdW50SGFsZiA9IE1hdGguZmxvb3IoaVBhZ2VDb3VudCAvIDIpOwoJCQkJdmFyIGlQYWdlcyA9IE1hdGguY2VpbCgob1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSkgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKTsKCQkJCXZhciBpQ3VycmVudFBhZ2UgPSBNYXRoLmNlaWwob1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IC8gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCkgKyAxOwoJCQkJdmFyIHNMaXN0ID0gIiI7CgkJCQl2YXIgaVN0YXJ0QnV0dG9uLCBpRW5kQnV0dG9uLCBpLCBpTGVuOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGFuQnV0dG9ucywgYW5TdGF0aWMsIG5QYWdpbmF0ZUxpc3QsIG5Ob2RlOwoJCQkJdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJCQl2YXIgZm5CaW5kID0gZnVuY3Rpb24gKGopIHsKCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCB0aGlzLCB7InBhZ2UiOiBqK2lTdGFydEJ1dHRvbi0xfSwgZnVuY3Rpb24oZSkgewoJCQkJCQkvKiBVc2UgdGhlIGluZm9ybWF0aW9uIGluIHRoZSBlbGVtZW50IHRvIGp1bXAgdG8gdGhlIHJlcXVpcmVkIHBhZ2UgKi8KCQkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEucGFnZSApOwoJCQkJCQlmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQl9ICk7CgkJCQl9OwoJCQkJCgkJCQkvKiBQYWdlcyBjYWxjdWxhdGlvbiAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09PSAtMSApCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gMTsKCQkJCQlpQ3VycmVudFBhZ2UgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoaVBhZ2VzIDwgaVBhZ2VDb3VudCkKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZXM7CgkJCQl9CgkJCQllbHNlIGlmIChpQ3VycmVudFBhZ2UgPD0gaVBhZ2VDb3VudEhhbGYpCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gaVBhZ2VDb3VudDsKCQkJCX0KCQkJCWVsc2UgaWYgKGlDdXJyZW50UGFnZSA+PSAoaVBhZ2VzIC0gaVBhZ2VDb3VudEhhbGYpKQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IGlQYWdlcyAtIGlQYWdlQ291bnQgKyAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZXM7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gaUN1cnJlbnRQYWdlIC0gTWF0aC5jZWlsKGlQYWdlQ291bnQgLyAyKSArIDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlTdGFydEJ1dHRvbiArIGlQYWdlQ291bnQgLSAxOwoJCQkJfQoJCgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSBkeW5hbWljIGxpc3QgKi8KCQkJCWZvciAoIGk9aVN0YXJ0QnV0dG9uIDsgaTw9aUVuZEJ1dHRvbiA7IGkrKyApCgkJCQl7CgkJCQkJc0xpc3QgKz0gKGlDdXJyZW50UGFnZSAhPT0gaSkgPwoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPicgOgoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbkFjdGl2ZSsnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPic7CgkJCQl9CgkJCQkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJbk5vZGUgPSBhbltpXTsKCQkJCQlpZiAoICFuTm9kZS5oYXNDaGlsZE5vZGVzKCkgKQoJCQkJCXsKCQkJCQkJY29udGludWU7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIEJ1aWxkIHVwIHRoZSBkeW5hbWljIGxpc3QgZmlyc3QgLSBodG1sIGFuZCBsaXN0ZW5lcnMgKi8KCQkJCQkkKCdzcGFuOmVxKDApJywgbk5vZGUpCgkJCQkJCS5odG1sKCBzTGlzdCApCgkJCQkJCS5jaGlsZHJlbignYScpLmVhY2goIGZuQmluZCApOwoJCQkJCQoJCQkJCS8qIFVwZGF0ZSB0aGUgcGVybWFuZW50IGJ1dHRvbidzIGNsYXNzZXMgKi8KCQkJCQlhbkJ1dHRvbnMgPSBuTm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpOwoJCQkJCWFuU3RhdGljID0gWwoJCQkJCQlhbkJ1dHRvbnNbMF0sIGFuQnV0dG9uc1sxXSwgCgkJCQkJCWFuQnV0dG9uc1thbkJ1dHRvbnMubGVuZ3RoLTJdLCBhbkJ1dHRvbnNbYW5CdXR0b25zLmxlbmd0aC0xXQoJCQkJCV07CgkKCQkJCQkkKGFuU3RhdGljKS5yZW1vdmVDbGFzcyggb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlQnV0dG9uQWN0aXZlKyIgIitvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkICk7CgkJCQkJJChbYW5TdGF0aWNbMF0sIGFuU3RhdGljWzFdXSkuYWRkQ2xhc3MoIAoJCQkJCQkoaUN1cnJlbnRQYWdlPT0xKSA/CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIDoKCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uCgkJCQkJKTsKCQkJCQkkKFthblN0YXRpY1syXSwgYW5TdGF0aWNbM11dKS5hZGRDbGFzcygKCQkJCQkJKGlQYWdlcz09PTAgfHwgaUN1cnJlbnRQYWdlPT09aVBhZ2VzIHx8IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg9PT0tMSkgPwoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VCdXR0b25TdGF0aWNEaXNhYmxlZCA6CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvbgoJCQkJCSk7CgkJCQl9CgkJCX0KCQl9Cgl9ICk7CgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9Tb3J0LCB7CgkJLyoKCQkgKiB0ZXh0IHNvcnRpbmcKCQkgKi8KCQkic3RyaW5nLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQlpZiAoIHR5cGVvZiBhICE9ICdzdHJpbmcnICkgewoJCQkJYSA9IChhICE9PSBudWxsICYmIGEudG9TdHJpbmcpID8gYS50b1N0cmluZygpIDogJyc7CgkJCX0KCQkJcmV0dXJuIGEudG9Mb3dlckNhc2UoKTsKCQl9LAoJCgkJInN0cmluZy1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJfSwKCQkKCQkic3RyaW5nLWRlc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIGh0bWwgc29ydGluZyAoaWdub3JlIGh0bWwgdGFncykKCQkgKi8KCQkiaHRtbC1wcmUiOiBmdW5jdGlvbiAoIGEgKQoJCXsKCQkJcmV0dXJuIGEucmVwbGFjZSggLzwuKj8+L2csICIiICkudG9Mb3dlckNhc2UoKTsKCQl9LAoJCQoJCSJodG1sLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQl9LAoJCQoJCSJodG1sLWRlc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIGRhdGUgc29ydGluZwoJCSAqLwoJCSJkYXRlLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQl2YXIgeCA9IERhdGUucGFyc2UoIGEgKTsKCQkJCgkJCWlmICggaXNOYU4oeCkgfHwgeD09PSIiICkKCQkJewoJCQkJeCA9IERhdGUucGFyc2UoICIwMS8wMS8xOTcwIDAwOjAwOjAwIiApOwoJCQl9CgkJCXJldHVybiB4OwoJCX0sCgkKCQkiZGF0ZS1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuIHggLSB5OwoJCX0sCgkJCgkJImRhdGUtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geSAtIHg7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIG51bWVyaWNhbCBzb3J0aW5nCgkJICovCgkJIm51bWVyaWMtcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCXJldHVybiAoYT09Ii0iIHx8IGE9PT0iIikgPyAwIDogYSoxOwoJCX0sCgkKCQkibnVtZXJpYy1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuIHggLSB5OwoJCX0sCgkJCgkJIm51bWVyaWMtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geSAtIHg7CgkJfQoJfSApOwoJCgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0LmFUeXBlcywgWwoJCS8qCgkJICogRnVuY3Rpb246IC0KCQkgKiBQdXJwb3NlOiAgQ2hlY2sgdG8gc2VlIGlmIGEgc3RyaW5nIGlzIG51bWVyaWMKCQkgKiBSZXR1cm5zOiAgc3RyaW5nOidudW1lcmljJyBvciBudWxsCgkJICogSW5wdXRzOiAgIG1peGVkOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQkvKiBBbGxvdyB6ZXJvIGxlbmd0aCBzdHJpbmdzIGFzIGEgbnVtYmVyICovCgkJCWlmICggdHlwZW9mIHNEYXRhID09PSAnbnVtYmVyJyApCgkJCXsKCQkJCXJldHVybiAnbnVtZXJpYyc7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSAhPT0gJ3N0cmluZycgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJdmFyIHNWYWxpZEZpcnN0Q2hhcnMgPSAiMDEyMzQ1Njc4OS0iOwoJCQl2YXIgc1ZhbGlkQ2hhcnMgPSAiMDEyMzQ1Njc4OS4iOwoJCQl2YXIgQ2hhcjsKCQkJdmFyIGJEZWNpbWFsID0gZmFsc2U7CgkJCQoJCQkvKiBDaGVjayBmb3IgYSB2YWxpZCBmaXJzdCBjaGFyIChubyBwZXJpb2QgYW5kIGFsbG93IG5lZ2F0aXZlcykgKi8KCQkJQ2hhciA9IHNEYXRhLmNoYXJBdCgwKTsgCgkJCWlmIChzVmFsaWRGaXJzdENoYXJzLmluZGV4T2YoQ2hhcikgPT0gLTEpIAoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgYWxsIHRoZSBvdGhlciBjaGFyYWN0ZXJzIGFyZSB2YWxpZCAqLwoJCQlmb3IgKCB2YXIgaT0xIDsgaTxzRGF0YS5sZW5ndGggOyBpKysgKSAKCQkJewoJCQkJQ2hhciA9IHNEYXRhLmNoYXJBdChpKTsgCgkJCQlpZiAoc1ZhbGlkQ2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgCgkJCQl7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgkJCQkKCQkJCS8qIE9ubHkgYWxsb3dlZCBvbmUgZGVjaW1hbCBwbGFjZS4uLiAqLwoJCQkJaWYgKCBDaGFyID09ICIuIiApCgkJCQl7CgkJCQkJaWYgKCBiRGVjaW1hbCApCgkJCQkJewoJCQkJCQlyZXR1cm4gbnVsbDsKCQkJCQl9CgkJCQkJYkRlY2ltYWwgPSB0cnVlOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gJ251bWVyaWMnOwoJCX0sCgkJCgkJLyoKCQkgKiBGdW5jdGlvbjogLQoJCSAqIFB1cnBvc2U6ICBDaGVjayB0byBzZWUgaWYgYSBzdHJpbmcgaXMgYWN0dWFsbHkgYSBmb3JtYXR0ZWQgZGF0ZQoJCSAqIFJldHVybnM6ICBzdHJpbmc6J2RhdGUnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgc3RyaW5nOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQl2YXIgaVBhcnNlID0gRGF0ZS5wYXJzZShzRGF0YSk7CgkJCWlmICggKGlQYXJzZSAhPT0gbnVsbCAmJiAhaXNOYU4oaVBhcnNlKSkgfHwgKHR5cGVvZiBzRGF0YSA9PT0gJ3N0cmluZycgJiYgc0RhdGEubGVuZ3RoID09PSAwKSApCgkJCXsKCQkJCXJldHVybiAnZGF0ZSc7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfSwKCQkKCQkvKgoJCSAqIEZ1bmN0aW9uOiAtCgkJICogUHVycG9zZTogIENoZWNrIHRvIHNlZSBpZiBhIHN0cmluZyBzaG91bGQgYmUgdHJlYXRlZCBhcyBhbiBIVE1MIHN0cmluZwoJCSAqIFJldHVybnM6ICBzdHJpbmc6J2h0bWwnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgc3RyaW5nOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQlpZiAoIHR5cGVvZiBzRGF0YSA9PT0gJ3N0cmluZycgJiYgc0RhdGEuaW5kZXhPZignPCcpICE9IC0xICYmIHNEYXRhLmluZGV4T2YoJz4nKSAhPSAtMSApCgkJCXsKCQkJCXJldHVybiAnaHRtbCc7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoJXSApOwoJCgoJLy8galF1ZXJ5IGFsaWFzZXMKCSQuZm4uRGF0YVRhYmxlID0gRGF0YVRhYmxlOwoJJC5mbi5kYXRhVGFibGUgPSBEYXRhVGFibGU7CgkkLmZuLmRhdGFUYWJsZVNldHRpbmdzID0gRGF0YVRhYmxlLnNldHRpbmdzOwoJJC5mbi5kYXRhVGFibGVFeHQgPSBEYXRhVGFibGUuZXh0OwoKCgkvLyBJbmZvcm1hdGlvbiBhYm91dCBldmVudHMgZmlyZWQgYnkgRGF0YVRhYmxlcyAtIGZvciBkb2N1bWVudGF0aW9uLgoJLyoqCgkgKiBEcmF3IGV2ZW50LCBmaXJlZCB3aGVuZXZlciB0aGUgdGFibGUgaXMgcmVkcmF3biBvbiB0aGUgcGFnZSwgYXQgdGhlIHNhbWUgcG9pbnQgYXMKCSAqIGZuRHJhd0NhbGxiYWNrLiBUaGlzIG1heSBiZSB1c2VmdWwgZm9yIGJpbmRpbmcgZXZlbnRzIG9yIHBlcmZvcm1pbmcgY2FsY3VsYXRpb25zIHdoZW4KCSAqIHRoZSB0YWJsZSBpcyBhbHRlcmVkIGF0IGFsbC4KCSAqICBAbmFtZSBEYXRhVGFibGUjZHJhdwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogRmlsdGVyIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSBmaWx0ZXJpbmcgYXBwbGllZCB0byB0aGUgdGFibGUgKHVzaW5nIHRoZSBidWlsZCBpbiBnbG9iYWwKCSAqIGdsb2JhbCBmaWx0ZXIsIG9yIGNvbHVtbiBmaWx0ZXJzKSBpcyBhbHRlcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNmaWx0ZXIKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIFBhZ2UgY2hhbmdlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSBwYWdpbmcgb2YgdGhlIHRhYmxlIGlzIGFsdGVyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3BhZ2UKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIFNvcnQgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHNvcnRpbmcgYXBwbGllZCB0byB0aGUgdGFibGUgaXMgYWx0ZXJlZC4KCSAqICBAbmFtZSBEYXRhVGFibGUjc29ydAoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogRGF0YVRhYmxlcyBpbml0aWFsaXNhdGlvbiBjb21wbGV0ZSBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaXMgZnVsbHkgZHJhd24sCgkgKiBpbmNsdWRpbmcgQWpheCBkYXRhIGxvYWRlZCwgaWYgQWpheCBkYXRhIGlzIHJlcXVpcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNpbml0CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBKU09OIG9iamVjdCByZXF1ZXN0IGZyb20gdGhlIHNlcnZlciAtIG9ubHkKCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZDwvbGk+PC9vbD4KCSAqLwoKCS8qKgoJICogU3RhdGUgc2F2ZSBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaGFzIGNoYW5nZWQgc3RhdGUgYSBuZXcgc3RhdGUgc2F2ZSBpcyByZXF1aXJlZC4KCSAqIFRoaXMgbWV0aG9kIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHN0YXRlIHNhdmluZyBvYmplY3QgcHJpb3IgdG8gYWN0dWFsbHkgZG9pbmcgdGhlCgkgKiBzYXZlLCBpbmNsdWRpbmcgYWRkaXRpb24gb3Igb3RoZXIgc3RhdGUgcHJvcGVydGllcyAoZm9yIHBsdWctaW5zKSBvciBtb2RpZmljYXRpb24KCSAqIG9mIGEgRGF0YVRhYmxlcyBjb3JlIHByb3BlcnR5LgoJICogIEBuYW1lIERhdGFUYWJsZSNzdGF0ZVNhdmVQYXJhbXMKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIHN0YXRlIGluZm9ybWF0aW9uIHRvIGJlIHNhdmVkCgkgKi8KCgkvKioKCSAqIFN0YXRlIGxvYWQgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHRhYmxlIGlzIGxvYWRpbmcgc3RhdGUgZnJvbSB0aGUgc3RvcmVkIGRhdGEsIGJ1dAoJICogcHJpb3IgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBiZWluZyBtb2RpZmllZCBieSB0aGUgc2F2ZWQgc3RhdGUgLSBhbGxvd2luZyBtb2RpZmljYXRpb24KCSAqIG9mIHRoZSBzYXZlZCBzdGF0ZSBpcyByZXF1aXJlZCBvciBsb2FkaW5nIG9mIHN0YXRlIGZvciBhIHBsdWctaW4uCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlTG9hZFBhcmFtcwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBUaGUgc2F2ZWQgc3RhdGUgaW5mb3JtYXRpb24KCSAqLwoKCS8qKgoJICogU3RhdGUgbG9hZGVkIGV2ZW50LCBmaXJlZCB3aGVuIHN0YXRlIGhhcyBiZWVuIGxvYWRlZCBmcm9tIHN0b3JlZCBkYXRhIGFuZCB0aGUgc2V0dGluZ3MKCSAqIG9iamVjdCBoYXMgYmVlbiBtb2RpZmllZCBieSB0aGUgbG9hZGVkIGRhdGEuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlTG9hZGVkCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBzYXZlZCBzdGF0ZSBpbmZvcm1hdGlvbgoJICovCgoJLyoqCgkgKiBQcm9jZXNzaW5nIGV2ZW50LCBmaXJlZCB3aGVuIERhdGFUYWJsZXMgaXMgZG9pbmcgc29tZSBraW5kIG9mIHByb2Nlc3NpbmcgKGJlIGl0LAoJICogc29ydCwgZmlsdGVyIG9yIGFueXRoaW5nIGVsc2UpLiBDYW4gYmUgdXNlZCB0byBpbmRpY2F0ZSB0byB0aGUgZW5kIHVzZXIgdGhhdAoJICogdGhlcmUgaXMgc29tZXRoaW5nIGhhcHBlbmluZywgb3IgdGhhdCBzb21ldGhpbmcgaGFzIGZpbmlzaGVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNwcm9jZXNzaW5nCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7Ym9vbGVhbn0gYlNob3cgRmxhZyBmb3IgaWYgRGF0YVRhYmxlcyBpcyBkb2luZyBwcm9jZXNzaW5nIG9yIG5vdAoJICovCgoJLyoqCgkgKiBBamF4IChYSFIpIGV2ZW50LCBmaXJlZCB3aGVuZXZlciBhbiBBamF4IHJlcXVlc3QgaXMgY29tcGxldGVkIGZyb20gYSByZXF1ZXN0IHRvIAoJICogbWFkZSB0byB0aGUgc2VydmVyIGZvciBuZXcgZGF0YSAobm90ZSB0aGF0IHRoaXMgdHJpZ2dlciBpcyBjYWxsZWQgaW4gZm5TZXJ2ZXJEYXRhLAoJICogaWYgeW91IG92ZXJyaWRlIGZuU2VydmVyRGF0YSBhbmQgd2hpY2ggdG8gdXNlIHRoaXMgZXZlbnQsIHlvdSBuZWVkIHRvIHRyaWdnZXIgaXQgaW4KCSAqIHlvdSBzdWNjZXNzIGZ1bmN0aW9uKS4KCSAqICBAbmFtZSBEYXRhVGFibGUjeGhyCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIEpTT04gcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyCgkgKi8KCgkvKioKCSAqIERlc3Ryb3kgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIERhdGFUYWJsZSBpcyBkZXN0cm95ZWQgYnkgY2FsbGluZyBmbkRlc3Ryb3kgb3IgcGFzc2luZwoJICogdGhlIGJEZXN0cm95OnRydWUgcGFyYW1ldGVyIGluIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QuIFRoaXMgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlCgkgKiBib3VuZCBldmVudHMsIGFkZGVkIERPTSBub2RlcywgZXRjLgoJICogIEBuYW1lIERhdGFUYWJsZSNkZXN0cm95CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCn0pKTsKCn0od2luZG93LCBkb2N1bWVudCkpOwoK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 16:09:46 GMT",
                    "Content-Length": "377508",
                    "Date": "Fri, 07 Nov 2014 16:09:48 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}