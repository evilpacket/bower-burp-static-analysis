{
    "url": "http://localhost:9999/terebentina/sco.js/js/sco.valid.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.href</b> and written to <b>window.location.href</b> via the following statement:<ul><li>window.location.href = window.location.href.replace(/#.*$/, '');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/terebentina/sco.js/js/sco.valid.js",
                "path": "/terebentina/sco.js/js/sco.valid.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC90ZXJlYmVudGluYS9zY28uanMvanMvc2NvLnZhbGlkLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTQ3OTkNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFNhdCwgMDggTm92IDIwMTQgMDQ6MDM6MTggR01UDQpMYXN0LU1vZGlmaWVkOiBTYXQsIDA4IE5vdiAyMDE0IDA0OjAzOjE4IEdNVA0KDQovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogKiBzY28udmFsaWQuanMNCiAqIGh0dHA6Ly9naXRodWIuY29tL3RlcmViZW50aW5hL3Njby5qcw0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogQ29weXJpZ2h0IDIwMTMgRGFuIENhcmFnZWEuDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiBodHRwOi8vYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQovKmpzaGludCBsYXhjb21tYTp0cnVlLCBzdWI6dHJ1ZSwgYnJvd3Nlcjp0cnVlLCBqcXVlcnk6dHJ1ZSwgc21hcnR0YWJzOnRydWUgKi8NCg0KOyhmdW5jdGlvbigkLCB1bmRlZmluZWQpIHsNCgkidXNlIHN0cmljdCI7DQoNCgl2YXIgcGx1Z2luTmFtZSA9ICdzY29qc192YWxpZCc7DQoNCglmdW5jdGlvbiBWYWxpZCgkZm9ybSwgb3B0aW9ucykgew0KCQl0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mbltwbHVnaW5OYW1lXS5kZWZhdWx0cywgb3B0aW9ucyk7DQoJCXRoaXMuJGZvcm0gPSAkZm9ybTsNCgkJdGhpcy5hbGxvd2VkX3J1bGVzID0gW107DQoJCXRoaXMuZXJyb3JzID0ge307DQoJCXZhciBzZWxmID0gdGhpczsNCgkJJC5lYWNoKHRoaXMubWV0aG9kcywgZnVuY3Rpb24oaywgdikgew0KCQkJc2VsZi5hbGxvd2VkX3J1bGVzLnB1c2goayk7DQoJCX0pOw0KCX0NCg0KCSQuZXh0ZW5kKFZhbGlkLnByb3RvdHlwZSwgew0KCQkvLyB0aGlzIGlzIHRoZSBtYWluIGZ1bmN0aW9uIC0gaXQgcmV0dXJucyBlaXRoZXIgdHJ1ZSBpZiB0aGUgdmFsaWRhdGlvbiBwYXNzZWQgb3IgZmFsc2UNCgkJdmFsaWRhdGU6IGZ1bmN0aW9uKCkgew0KCQkJdmFyICBzZWxmID0gdGhpcw0KCQkJCSxmb3JtX2ZpZWxkcyA9IHRoaXMuJGZvcm0uc2VyaWFsaXplQXJyYXkoKQ0KCQkJCSxhbGxfZmllbGRzID0gdGhpcy4kZm9ybS5maW5kKCc6aW5wdXRbbmFtZV0nKS5tYXAoZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMubmFtZTt9KS5nZXQoKQ0KCQkJCTsNCg0KCQkJLy8gcmVtb3ZlIGFueSBwb3NzaWJsZSBkaXNwbGF5ZWQgZXJyb3JzIGZyb20gcHJldmlvdXMgcnVucw0KCQkJJC5lYWNoKHRoaXMuZXJyb3JzLCBmdW5jdGlvbihmaWVsZF9uYW1lLCBlcnJvcikgew0KCQkJCXZhciAkaW5wdXQgPSBzZWxmLiRmb3JtLmZpbmQoJ1tuYW1lPSInICsgZmllbGRfbmFtZSArICciXScpOw0KCQkJCSRpbnB1dC5zaWJsaW5ncygnc3Bhbi5tZXNzYWdlJykuaHRtbCgnJyk7DQoJCQkJaWYgKHNlbGYub3B0aW9ucy53cmFwcGVyICE9PSBudWxsKSB7DQoJCQkJCSRpbnB1dC5jbG9zZXN0KHNlbGYub3B0aW9ucy53cmFwcGVyKS5yZW1vdmVDbGFzcygnZXJyb3InKTsNCgkJCQl9DQoJCQl9KTsNCgkJCXRoaXMuZXJyb3JzID0ge307DQoNCgkJCSQuZWFjaChzZWxmLm9wdGlvbnMucnVsZXMsIGZ1bmN0aW9uKGZpZWxkX25hbWUsIHJ1bGVzKSB7DQoJCQkJdmFyICBmaWVsZCA9IG51bGwNCgkJCQkJLG5vcm1hbGl6ZWRfcnVsZXMgPSB7fQ0KCQkJCQk7DQoJCQkJLy8gZmluZCB0aGUgZmllbGQgaW4gdGhlIGZvcm0NCgkJCQkkLmVhY2goZm9ybV9maWVsZHMsIGZ1bmN0aW9uKGssIHYpIHsNCgkJCQkJaWYgKHYubmFtZSA9PT0gZmllbGRfbmFtZSkgew0KCQkJCQkJZmllbGQgPSB2Ow0KCQkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCQl9DQoJCQkJfSk7DQoNCgkJCQkvLyBpZiBmaWVsZCB3YXMgbm90IGZvdW5kLCBpdCBjb3VsZCBtZWFuIDIgdGhpbmdzOiBtaXNwZWxsZWQgZmllbGQgbmFtZSBpbiB0aGUgcnVsZXMgb3IgdGhlIGZpZWxkIGlzIG5vdCBhIHN1Y2Nlc3NmdWwgY29udHJvbA0KCQkJCS8vIGV2ZW4gaWYgaXQncyBub3Qgc3VjY2Vzc2Z1bCB3ZSBoYXZlIHRvIHZhbGlkYXRlIGl0DQoJCQkJaWYgKGZpZWxkID09PSBudWxsKSB7DQoJCQkJCWlmICgkLmluQXJyYXkoZmllbGRfbmFtZSwgYWxsX2ZpZWxkcykgIT09IC0xKSB7DQoJCQkJCQlmaWVsZCA9IHtuYW1lOiBmaWVsZF9uYW1lLCB2YWx1ZTogc2VsZi5nZXRfZmllbGRfdmFsdWUoZmllbGRfbmFtZSl9Ow0KCQkJCQl9DQoJCQkJfQ0KDQoJCQkJLy8gaWYgaXQncyBzdGlsbCBudWxsIHRoZW4gaXQncyBlaXRoZXIgbWlzcGVsbGVkIG9yIGRpc2FibGVkLiBXZSBkb24ndCBjYXJlIGVpdGhlciB3YXkNCgkJCQlpZiAoZmllbGQgIT09IG51bGwpIHsNCgkJCQkJJC5lYWNoKHJ1bGVzLCBmdW5jdGlvbihydWxlX2lkeCwgcnVsZV92YWx1ZSkgew0KCQkJCQkJLy8gZGV0ZXJtaW5lIHRoZSBtZXRob2QgdG8gY2FsbCBhbmQgaXRzIGFyZ3MNCgkJCQkJCS8vIG9ubHkgc3RyaW5nIGFuZCBvYmplY3RzIGFyZSBhbGxvd2VkDQoJCQkJCQlpZiAoJC50eXBlKHJ1bGVfdmFsdWUpID09PSAnc3RyaW5nJykgew0KCQkJCQkJCS8vIG1ha2Ugc3VyZSB0aGUgcmVxdWVzdGVkIG1ldGhvZCBhY3R1YWxseSBleGlzdHMuDQoJCQkJCQkJaWYgKCQuaW5BcnJheShydWxlX3ZhbHVlLCBzZWxmLmFsbG93ZWRfcnVsZXMpICE9PSAtMSkgew0KCQkJCQkJCQlub3JtYWxpemVkX3J1bGVzW3J1bGVfdmFsdWVdID0gbnVsbDsNCgkJCQkJCQl9DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCS8vIGlmIG5vdCBzdHJpbmcgdGhlbiB3ZSBhc3N1bWUgaXQncyBhIHtrZXk6IHZhbH0gb2JqZWN0LiBPbmx5IDEga2V5IGlzIGFsbG93ZWQNCgkJCQkJCQkkLmVhY2gocnVsZV92YWx1ZSwgZnVuY3Rpb24oaywgdikgew0KCQkJCQkJCQkvLyBtYWtlIHN1cmUgdGhlIHJlcXVlc3RlZCBtZXRob2QgYWN0dWFsbHkgZXhpc3RzLg0KCQkJCQkJCQlpZiAoJC5pbkFycmF5KGssIHNlbGYuYWxsb3dlZF9ydWxlcykgIT09IC0xKSB7DQoJCQkJCQkJCQlub3JtYWxpemVkX3J1bGVzW2tdID0gdjsNCgkJCQkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0pOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCg0KCQkJCQkkLmVhY2gobm9ybWFsaXplZF9ydWxlcywgZnVuY3Rpb24oZm5fbmFtZSwgZm5fYXJncykgew0KCQkJCQkJLy8gY2FsbCB0aGUgbWV0aG9kIHdpdGggdGhlIHJlcXVlc3RlZCBhcmdzDQoJCQkJCQlpZiAoc2VsZi5tZXRob2RzW2ZuX25hbWVdLmNhbGwoc2VsZiwgZmllbGQubmFtZSwgZmllbGQudmFsdWUsIGZuX2FyZ3MsIG5vcm1hbGl6ZWRfcnVsZXMpICE9PSB0cnVlKSB7DQoJCQkJCQkJc2VsZi5lcnJvcnNbZmllbGQubmFtZV0gPSBzZWxmLmZvcm1hdC5jYWxsKHNlbGYsIGZpZWxkLm5hbWUsIGZuX25hbWUsIGZuX2FyZ3MpOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJaWYgKCEkLmlzRW1wdHlPYmplY3QodGhpcy5lcnJvcnMpKSB7DQoJCQkJdGhpcy5zaG93KHRoaXMuZXJyb3JzKTsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9IGVsc2Ugew0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KCQl9LA0KDQoNCgkJc2hvdzogZnVuY3Rpb24oZXJyb3JzKSB7DQoJCQl2YXIgc2VsZiA9IHRoaXM7DQoJCQkkLmVhY2goZXJyb3JzLCBmdW5jdGlvbihrLCB2KSB7DQoJCQkJdmFyICRpbnB1dCA9IHNlbGYuJGZvcm0uZmluZCgnW25hbWU9IicgKyBrICsgJyJdJyksDQoJCQkJCSRzcGFuID0gJGlucHV0LnNpYmxpbmdzKCcubWVzc2FnZScpOw0KCQkJCWlmIChzZWxmLm9wdGlvbnMud3JhcHBlciAhPT0gbnVsbCkgew0KCQkJCQkkaW5wdXQuY2xvc2VzdChzZWxmLm9wdGlvbnMud3JhcHBlcikuYWRkQ2xhc3MoJ2Vycm9yJyk7DQoJCQkJfQ0KCQkJCWlmICgkc3Bhbi5sZW5ndGggPT09IDApIHsNCgkJCQkJJHNwYW4gPSAkKCc8c3Bhbi8+JywgeydjbGFzcyc6ICdtZXNzYWdlJ30pOw0KCQkJCQkkaW5wdXQuYWZ0ZXIoJHNwYW4pOw0KCQkJCX0NCgkJCQkkc3Bhbi5odG1sKHYpOw0KCQkJfSk7DQoJCX0sDQoNCg0KCQltZXRob2RzOiB7DQoJCQlub3RfZW1wdHk6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSkgew0KCQkJCXJldHVybiB2YWx1ZSAhPT0gbnVsbCAmJiAkLnRyaW0odmFsdWUpLmxlbmd0aCA+IDA7DQoJCQl9LA0KDQoJCQltaW5fbGVuZ3RoOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUsIG1pbl9sZW4sIGFsbF9ydWxlcykgew0KCQkJCXZhciBsZW5ndGggPSAkLnRyaW0odmFsdWUpLmxlbmd0aA0KCQkJCQkscmVzdWx0ID0gKGxlbmd0aCA+PSBtaW5fbGVuKTsNCgkJCQlpZiAoIWFsbF9ydWxlc1snbm90X2VtcHR5J10pIHsNCgkJCQkJcmVzdWx0ID0gcmVzdWx0IHx8IGxlbmd0aCA9PT0gMDsNCgkJCQl9DQoJCQkJcmV0dXJuIHJlc3VsdDsNCgkJCX0sDQoNCgkJCW1heF9sZW5ndGg6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSwgbWF4X2xlbikgew0KCQkJCXJldHVybiAkLnRyaW0odmFsdWUpLmxlbmd0aCA8PSBtYXhfbGVuOw0KCQkJfSwNCg0KCQkJcmVnZXg6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSwgcmVnZXhwKSB7DQoJCQkJcmV0dXJuIHJlZ2V4cC50ZXN0KHZhbHVlKTsNCgkJCX0sDQoNCgkJCWVtYWlsOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQkvLyBieSBTY290dCBHb256YWxlejogaHR0cDovL3Byb2plY3RzLnNjb3R0c3BsYXlncm91bmQuY29tL2VtYWlsX2FkZHJlc3NfdmFsaWRhdGlvbi8NCgkJCQl2YXIgcmVnZXggPSAvXigoKFthLXpdfFxkfFshI1wkJSYnXCpcK1wtXC89XD9cXl9ge1x8fX5dfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSsoXC4oW2Etel18XGR8WyEjXCQlJidcKlwrXC1cLz1cP1xeX2B7XHx9fl18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKykqKXwoKFx4MjIpKCgoKFx4MjB8XHgwOSkqKFx4MGRceDBhKSk/KFx4MjB8XHgwOSkrKT8oKFtceDAxLVx4MDhceDBiXHgwY1x4MGUtXHgxZlx4N2ZdfFx4MjF8W1x4MjMtXHg1Yl18W1x4NWQtXHg3ZV18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfChcXChbXHgwMS1ceDA5XHgwYlx4MGNceDBkLVx4N2ZdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSkpKSooKChceDIwfFx4MDkpKihceDBkXHgwYSkpPyhceDIwfFx4MDkpKyk/KFx4MjIpKSlAKCgoW2Etel18XGR8W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCgoW2Etel18XGR8W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSooW2Etel18XGR8W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKSlcLikrKChbYS16XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KChbYS16XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkoW2Etel18XGR8LXxcLnxffH58W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKihbYS16XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkpKSQvaTsNCgkJCQlyZXR1cm4gcmVnZXgudGVzdCgkLnRyaW0odmFsdWUpKTsNCgkJCX0sDQoNCgkJCXVybDogZnVuY3Rpb24oZmllbGQsIHZhbHVlKSB7DQoJCQkJLy8gYnkgU2NvdHQgR29uemFsZXo6IGh0dHA6Ly9wcm9qZWN0cy5zY290dHNwbGF5Z3JvdW5kLmNvbS9pcmkvDQoJCQkJdmFyIHJlZ2V4ID0gL14oaHR0cHM/fGZ0cCk6XC9cLygoKChbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KCVbXGRhLWZdezJ9KXxbIVwkJidcKFwpXCpcKyw7PV18OikqQCk/KCgoXGR8WzEtOV1cZHwxXGRcZHwyWzAtNF1cZHwyNVswLTVdKVwuKFxkfFsxLTldXGR8MVxkXGR8MlswLTRdXGR8MjVbMC01XSlcLihcZHxbMS05XVxkfDFcZFxkfDJbMC00XVxkfDI1WzAtNV0pXC4oXGR8WzEtOV1cZHwxXGRcZHwyWzAtNF1cZHwyNVswLTVdKSl8KCgoW2Etel18XGR8W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCgoW2Etel18XGR8W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSooW2Etel18XGR8W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKSlcLikrKChbYS16XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KChbYS16XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkoW2Etel18XGR8LXxcLnxffH58W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKihbYS16XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkpKVwuPykoOlxkKik/KShcLygoKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoJVtcZGEtZl17Mn0pfFshXCQmJ1woXClcKlwrLDs9XXw6fEApKyhcLygoW2Etel18XGR8LXxcLnxffH58W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCglW1xkYS1mXXsyfSl8WyFcJCYnXChcKVwqXCssOz1dfDp8QCkqKSopPyk/KFw/KCgoW2Etel18XGR8LXxcLnxffH58W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCglW1xkYS1mXXsyfSl8WyFcJCYnXChcKVwqXCssOz1dfDp8QCl8W1x1RTAwMC1cdUY4RkZdfFwvfFw/KSopPyhcIygoKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoJVtcZGEtZl17Mn0pfFshXCQmJ1woXClcKlwrLDs9XXw6fEApfFwvfFw/KSopPyQvaTsNCgkJCQlyZXR1cm4gcmVnZXgudGVzdCh2YWx1ZSk7DQoJCQl9LA0KDQoJCQlleGFjdF9sZW5ndGg6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSwgZXhhY3RfbGVuZ3RoLCBhbGxfcnVsZXMpIHsNCgkJCQl2YXIgIGxlbmd0aCA9ICQudHJpbSh2YWx1ZSkubGVuZ3RoDQoJCQkJCSxyZXN1bHQgPSAobGVuZ3RoID09PSBleGFjdF9sZW5ndGgpOw0KCQkJCWlmICghYWxsX3J1bGVzWydub3RfZW1wdHknXSkgew0KCQkJCQlyZXN1bHQgPSByZXN1bHQgfHwgbGVuZ3RoID09PSAwOw0KCQkJCX0NCgkJCQlyZXR1cm4gcmVzdWx0Ow0KCQkJfSwNCg0KCQkJZXF1YWxzOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUsIHRhcmdldCkgew0KCQkJCXJldHVybiB2YWx1ZSA9PT0gdGFyZ2V0Ow0KCQkJfSwNCg0KCQkJaXA6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSkgew0KCQkJCXZhciByZWdleCA9IC9eKCgyNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfXxbMC05XXsxLDJ9KVwuKXszfSgyNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfXxbMC05XXsxLDJ9KSQvaTsNCgkJCQlyZXR1cm4gcmVnZXgudGVzdCgkLnRyaW0odmFsdWUpKTsNCgkJCX0sDQoNCgkJCWNyZWRpdF9jYXJkOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQkvLyBhY2NlcHQgb25seSBzcGFjZXMsIGRpZ2l0cyBhbmQgZGFzaGVzDQoJCQkJaWYgKC9bXjAtOSBcLV0rLy50ZXN0KHZhbHVlKSkgew0KCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJfQ0KCQkJCXZhciAgbkNoZWNrID0gMA0KCQkJCQksbkRpZ2l0ID0gMA0KCQkJCQksYkV2ZW4gPSBmYWxzZTsNCg0KCQkJCXZhbHVlID0gdmFsdWUucmVwbGFjZSgvXEQvZywgIiIpOw0KDQoJCQkJZm9yICh2YXIgbiA9IHZhbHVlLmxlbmd0aCAtIDE7IG4gPj0gMDsgbi0tKSB7DQoJCQkJCXZhciBjRGlnaXQgPSB2YWx1ZS5jaGFyQXQobik7DQoJCQkJCW5EaWdpdCA9IHBhcnNlSW50KGNEaWdpdCwgMTApOw0KCQkJCQlpZiAoYkV2ZW4pIHsNCgkJCQkJCWlmICgobkRpZ2l0ICo9IDIpID4gOSkgew0KCQkJCQkJCW5EaWdpdCAtPSA5Ow0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCW5DaGVjayArPSBuRGlnaXQ7DQoJCQkJCWJFdmVuID0gIWJFdmVuOw0KCQkJCX0NCg0KCQkJCXJldHVybiAobkNoZWNrICUgMTApID09PSAwOw0KCQkJfSwNCg0KCQkJYWxwaGE6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSkgew0KCQkJCXZhciByZWdleCA9IC9eW2Etel0qJC9pOw0KCQkJCXJldHVybiByZWdleC50ZXN0KHZhbHVlKTsNCgkJCX0sDQoNCgkJCWFscGhhX251bWVyaWM6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSkgew0KCQkJCXZhciByZWdleCA9IC9eW2EtejAtOV0qJC9pOw0KCQkJCXJldHVybiByZWdleC50ZXN0KHZhbHVlKTsNCgkJCX0sDQoNCgkJCWFscGhhX2Rhc2g6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSkgew0KCQkJCXZhciByZWdleCA9IC9eW2EtejAtOV9cLV0qJC9pOw0KCQkJCXJldHVybiByZWdleC50ZXN0KHZhbHVlKTsNCgkJCX0sDQoNCgkJCWRpZ2l0OiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQl2YXIgcmVnZXggPSAvXlxkKiQvOw0KCQkJCXJldHVybiByZWdleC50ZXN0KHZhbHVlKTsNCgkJCX0sDQoNCgkJCW51bWVyaWM6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSkgew0KCQkJCXZhciByZWdleCA9IC9eKFtcK1wtXT9bMC05XSsoXC5bMC05XSspPyk/JC87DQoJCQkJcmV0dXJuIHJlZ2V4LnRlc3QodmFsdWUpOw0KCQkJfSwNCg0KCQkJLy8gc2FtZSBhcyBudW1lcmljDQoJCQlkZWNpbWFsOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQl2YXIgcmVnZXggPSAvXihbXCtcLV0/WzAtOV0rKFwuWzAtOV0rKT8pPyQvOw0KCQkJCXJldHVybiByZWdleC50ZXN0KHZhbHVlKTsNCgkJCX0sDQoNCgkJCW1hdGNoZXM6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSwgcGFyYW0pIHsNCgkJCQlyZXR1cm4gdmFsdWUgPT09IHRoaXMuJGZvcm0uZmluZCgnW25hbWU9IicgKyBwYXJhbSArICciXScpLnZhbCgpOw0KCQkJfQ0KCQl9LA0KDQoNCgkJbWVzc2FnZXM6IHsNCgkJCW5vdF9lbXB0eTogJ1RoaXMgZmllbGQgaXMgcmVxdWlyZWQuJw0KCQkJLG1pbl9sZW5ndGg6ICdQbGVhc2UgZW50ZXIgYXQgbGVhc3QgOnZhbHVlIGNoYXJhY3RlcnMuJw0KCQkJLG1heF9sZW5ndGg6ICdQbGVhc2UgZW50ZXIgbm8gbW9yZSB0aGFuIDp2YWx1ZSBjaGFyYWN0ZXJzLicNCgkJCSxyZWdleDogJycNCgkJCSxlbWFpbDogJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MuJw0KCQkJLHVybDogJ1BsZWFzZSBlbnRlciBhIHZhbGlkIFVSTC4nDQoJCQksZXhhY3RfbGVuZ3RoOiAnUGxlYXNlIGVudGVyIGV4YWN0bHkgOnZhbHVlIGNoYXJhY3RlcnMuJw0KCQkJLGVxdWFsczogJycNCgkJCSxpcDogJycNCgkJCSxjcmVkaXRfY2FyZDogJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGNyZWRpdCBjYXJkIG51bWJlci4nDQoJCQksYWxwaGE6ICcnDQoJCQksYWxwaGFfbnVtZXJpYzogJycNCgkJCSxhbHBoYV9kYXNoOiAnJw0KCQkJLGRpZ2l0OiAnUGxlYXNlIGVudGVyIG9ubHkgZGlnaXRzLicNCgkJCSxudW1lcmljOiAnUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLicNCgkJCSxkZWNpbWFsOiAnUGxlYXNlIGVudGVyIGEgZGVjaW1hbCBudW1iZXIuJw0KCQkJLG1hdGNoZXM6ICdNdXN0IG1hdGNoIHRoZSBwcmV2aW91cyB2YWx1ZS4nDQoJCX0sDQoNCg0KCQkvKioNCgkJICogZmluZHMgdGhlIG1vc3Qgc3BlY2lmaWMgZXJyb3IgbWVzc2FnZSBzdHJpbmcgYW5kIHJlcGxhY2VzIGFueSAiOnZhbHVlIiBzdWJzdHJpbmcgd2l0aCB0aGUgYWN0dWFsIHZhbHVlDQoJCSAqLw0KCQlmb3JtYXQ6IGZ1bmN0aW9uKGZpZWxkX25hbWUsIHJ1bGUsIHBhcmFtcykgew0KCQkJdmFyIG1lc3NhZ2U7DQoJCQlpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5tZXNzYWdlc1tmaWVsZF9uYW1lXSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHRoaXMub3B0aW9ucy5tZXNzYWdlc1tmaWVsZF9uYW1lXVtydWxlXSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCQltZXNzYWdlID0gdGhpcy5vcHRpb25zLm1lc3NhZ2VzW2ZpZWxkX25hbWVdW3J1bGVdOw0KCQkJfSBlbHNlIHsNCgkJCQltZXNzYWdlID0gdGhpcy5tZXNzYWdlc1tydWxlXTsNCgkJCX0NCg0KCQkJaWYgKCQudHlwZShwYXJhbXMpICE9PSAndW5kZWZpbmVkJyAmJiBwYXJhbXMgIT09IG51bGwpIHsNCgkJCQlpZiAoJC50eXBlKHBhcmFtcykgPT09ICdib29sZWFuJyB8fCAkLnR5cGUocGFyYW1zKSA9PT0gJ3N0cmluZycgfHwgJC50eXBlKHBhcmFtcykgPT09ICdudW1iZXInKSB7DQoJCQkJCXBhcmFtcyA9IHt2YWx1ZTogcGFyYW1zfTsNCgkJCQl9DQoJCQkJJC5lYWNoKHBhcmFtcywgZnVuY3Rpb24oaywgdikgew0KCQkJCQltZXNzYWdlID0gbWVzc2FnZS5yZXBsYWNlKG5ldyBSZWdFeHAoJzonICsgaywgJ2lnJyksIHYpOw0KCQkJCX0pOw0KCQkJfQ0KCQkJcmV0dXJuIG1lc3NhZ2U7DQoJCX0sDQoNCg0KCQkvKioNCgkJICogZ2V0IGEgbm9ybWFsaXplZCB2YWx1ZSBmb3IgYSBmb3JtIGZpZWxkLg0KCQkgKi8NCgkJZ2V0X2ZpZWxkX3ZhbHVlOiBmdW5jdGlvbihmaWVsZF9uYW1lKSB7DQoJCQl2YXIgJGlucHV0ID0gdGhpcy4kZm9ybS5maW5kKCdbbmFtZT0iJyArIGZpZWxkX25hbWUgKyAnIl0nKTsNCgkJCWlmICgkaW5wdXQuaXMoJ1t0eXBlPSJjaGVja2JveCJdLCBbdHlwZT0icmFkaW8iXScpKSB7DQoJCQkJcmV0dXJuICRpbnB1dC5pcygnOmNoZWNrZWQnKSA/ICRpbnB1dC52YWwoKSA6IG51bGw7DQoJCQl9IGVsc2Ugew0KCQkJCXJldHVybiAkaW5wdXQudmFsKCk7DQoJCQl9DQoJCX0NCgl9KTsNCg0KDQoJLyoqDQoJICogbWFpbiBmdW5jdGlvbiB0byB1c2Ugb24gYSBmb3JtIChsaWtlICQoJyNmb3JtKS5zY29qc192YWxpZCh7Li4ufSkpLiBQZXJmb3JtcyB2YWxpZGF0aW9uIG9mIHRoZSBmb3JtLCBzZXRzIHRoZSBlcnJvciBtZXNzYWdlcyBvbiBmb3JtIGlucHV0cyBhbmQgcmV0dXJucw0KCSAqIHRydWUvZmFsc2UgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIGZvcm0gcGFzc2VkIHZhbGlkYXRpb24gb3Igbm90DQoJICoNCgkgKiBAcGFyYW0ge2hhc2h8c3RyaW5nfSBvcHRpb25zIHRoZSBoYXNoIG9mIHJ1bGVzIGFuZCBtZXNzYWdlcyB0byB2YWxpZGF0ZSB0aGUgZm9ybSBhZ2FpbnN0IChhbmQgbWVzc2FnZXMgdG8gc2hvdyBpZiBmYWlsZWQgdmFsaWRhdGlvbikgb3IgdGhlIHN0cmluZyAib3B0aW9uIg0KCSAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgdGhlIG9wdGlvbiBrZXkgdG8gcmV0cmlldmUgb3Igc2V0LiBJZiB0aGUgdGhpcmQgcGFyYW0gb2YgdGhlIGZ1bmN0aW9uIGlzIGF2YWlsYWJsZSB0aGVuIGFjdCBhcyBhIHNldHRlciwgb3RoZXJ3aXNlIGFzIGEgZ2V0dGVyLg0KCSAqIEBwYXJhbSB7bWl4ZWR9IHZhbHVlIHRoZSB2YWx1ZSB0byBzZXQgb24gdGhlIGtleQ0KCSAqLw0KCSQuZm5bcGx1Z2luTmFtZV0gPSBmdW5jdGlvbihvcHRpb25zLCBrZXksIHZhbHVlKSB7DQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oaWR4LCBmb3JtKSB7DQoJCQl2YXIgJGZvcm0gPSAkKGZvcm0pDQoJCQkJLHZhbGlkYXRvciA9ICRmb3JtLmRhdGEocGx1Z2luTmFtZSkNCgkJCQk7DQoJCQlpZiAoJC50eXBlKG9wdGlvbnMpID09PSAnb2JqZWN0Jykgew0KCQkJCWlmICghdmFsaWRhdG9yKSB7DQoJCQkJCXZhciBvcHRzID0gJC5leHRlbmQoe30sICQuZm5bcGx1Z2luTmFtZV0uZGVmYXVsdHMsIG9wdGlvbnMsICRmb3JtLmRhdGEoKSk7DQoJCQkJCXZhbGlkYXRvciA9IG5ldyBWYWxpZCgkZm9ybSwgb3B0cyk7DQoJCQkJCSRmb3JtLmRhdGEocGx1Z2luTmFtZSwgdmFsaWRhdG9yKS5hdHRyKCdub3ZhbGlkYXRlJywgJ25vdmFsaWRhdGUnKTsNCgkJCQl9DQoJCQkJJGZvcm0uYWpheEZvcm0oew0KCQkJCQliZWZvcmVTZXJpYWxpemU6IGZ1bmN0aW9uKCkgew0KCQkJCQkJaWYgKHR5cGVvZiB2YWxpZGF0b3Iub3B0aW9ucy5vbkJlZm9yZVZhbGlkYXRlID09PSAnZnVuY3Rpb24nKSB7DQoJCQkJCQkJdmFsaWRhdG9yLm9wdGlvbnMub25CZWZvcmVWYWxpZGF0ZS5jYWxsKHZhbGlkYXRvcik7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJLGJlZm9yZVN1Ym1pdDogZnVuY3Rpb24oKSB7DQoJCQkJCQlyZXR1cm4gdmFsaWRhdG9yLnZhbGlkYXRlKCk7DQoJCQkJCX0NCgkJCQkJLGRhdGFUeXBlOiAnanNvbicNCgkJCQkJLHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlLCBzdGF0dXMsIHhociwgJGZvcm0pIHsNCgkJCQkJCWlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdmYWlsJykgew0KCQkJCQkJCWlmICh0eXBlb2Ygb3B0aW9ucy5vbkZhaWwgIT09ICdmdW5jdGlvbicgfHwgb3B0aW9ucy5vbkZhaWwuY2FsbCh0aGlzLCByZXNwb25zZSwgdmFsaWRhdG9yLCAkZm9ybSkgIT09IGZhbHNlKSB7DQoJCQkJCQkJCXZhbGlkYXRvci5zaG93KHJlc3BvbnNlLmRhdGEuZXJyb3JzKTsNCgkJCQkJCQl9DQoJCQkJCQl9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ2Vycm9yJykgew0KCQkJCQkJCWlmICh0eXBlb2Ygb3B0aW9ucy5vbkVycm9yICE9PSAnZnVuY3Rpb24nIHx8IG9wdGlvbnMub25FcnJvci5jYWxsKHRoaXMsIHJlc3BvbnNlLCB2YWxpZGF0b3IsICRmb3JtKSAhPT0gZmFsc2UpIHsNCgkJCQkJCQkJJC5zY29qc19tZXNzYWdlKHJlc3BvbnNlLm1lc3NhZ2UsICQuc2NvanNfbWVzc2FnZS5UWVBFX0VSUk9SKTsNCgkJCQkJCQl9DQoJCQkJCQl9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKSB7DQoJCQkJCQkJaWYgKHR5cGVvZiBvcHRpb25zLm9uU3VjY2VzcyAhPT0gJ2Z1bmN0aW9uJyB8fCBvcHRpb25zLm9uU3VjY2Vzcy5jYWxsKHRoaXMsIHJlc3BvbnNlLCB2YWxpZGF0b3IsICRmb3JtKSAhPT0gZmFsc2UpIHsNCgkJCQkJCQkJaWYgKHJlc3BvbnNlLmRhdGEubmV4dCkgew0KCQkJCQkJCQkJaWYgKHJlc3BvbnNlLmRhdGEubmV4dCA9PT0gJy4nKSB7CQkJLy8gcmVmcmVzaCBjdXJyZW50IHBhZ2UNCgkJCQkJCQkJCQl3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyMuKiQvLCAnJyk7DQoJCQkJCQkJCQl9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEubmV4dCA9PT0gJ3gnKSB7CS8vIGNsb3NlIHRoZSBwYXJlbnQgbW9kYWwNCgkJCQkJCQkJCQkkZm9ybS5jbG9zZXN0KCcubW9kYWwnKS50cmlnZ2VyKCdjbG9zZScpOw0KCQkJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJCQl3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlc3BvbnNlLmRhdGEubmV4dDsNCgkJCQkJCQkJCX0NCgkJCQkJCQkJfQ0KCQkJCQkJCQlpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlKSB7DQoJCQkJCQkJCQkkLnNjb2pzX21lc3NhZ2UocmVzcG9uc2UuZGF0YS5tZXNzYWdlLCAkLnNjb2pzX21lc3NhZ2UuVFlQRV9PSyk7DQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9KTsNCgkJCQkvLyBhbGxvdyBjaGFpbmluZw0KCQkJCXJldHVybiB0aGlzOw0KCQkJfSBlbHNlIGlmIChvcHRpb25zID09PSAnb3B0aW9uJykgew0KCQkJCWlmICgkLnR5cGUodmFsdWUpID09PSAndW5kZWZpbmVkJykgew0KCQkJCQlyZXR1cm4gdmFsaWRhdG9yLm9wdGlvbnNba2V5XTsNCgkJCQl9IGVsc2Ugew0KCQkJCQl2YWxpZGF0b3Iub3B0aW9uc1trZXldID0gdmFsdWU7DQoJCQkJCXJldHVybiB2YWxpZGF0b3I7DQoJCQkJfQ0KCQkJfSBlbHNlIHsNCgkJCQlyZXR1cm4gdmFsaWRhdG9yID8gdmFsaWRhdG9yIDogdGhpczsNCgkJCX0NCgkJfSk7DQoJfTsNCg0KDQoJJFtwbHVnaW5OYW1lXSA9IGZ1bmN0aW9uKGZvcm0sIG9wdGlvbnMpIHsNCgkJaWYgKHR5cGVvZiBmb3JtID09PSAnc3RyaW5nJykgew0KCQkJZm9ybSA9ICQoZm9ybSk7DQoJCX0NCgkJcmV0dXJuIG5ldyBWYWxpZChmb3JtLCBvcHRpb25zKTsNCgl9Ow0KDQoNCgkkLmZuW3BsdWdpbk5hbWVdLmRlZmF1bHRzID0gew0KCQl3cmFwcGVyOiAnbGFiZWwnCS8vIHRoZSBodG1sIHRhZyB0aGF0IHdyYXBzIHRoZSBmaWVsZCBhbmQgd2hpY2ggZGVmaW5lcyBhICJyb3ciIG9mIHRoZSBmb3JtDQoJCSxydWxlczoge30JCQkvLyBhcnJheSBvZiBydWxlcyB0byBjaGVjayB0aGUgZm9ybSBhZ2FpbnN0LiBFYWNoIHZhbHVlIHNob3VsZCBiZSBlaXRoZXIgYSBzdHJpbmcgd2l0aCB0aGUgbmFtZSBvZiB0aGUgbWV0aG9kIHRvIHVzZSBhcyBydWxlIG9yIGEgaGFzaCBsaWtlIHttZXRob2Q6IDxtZXRob2QgcGFyYW1zPn0NCgkJLG1lc3NhZ2VzOiB7fQkJLy8gY3VzdG9tIGVycm9yIG1lc3NhZ2VzIGxpa2Uge3VzZXJuYW1lOiB7bm90X2VtcHR5OiAnaGV5IHlvdSBmb3Jnb3QgdG8gZW50ZXIgeW91ciB1c2VybmFtZScsIG1pbl9sZW5ndGg6ICdjb21lIG9uLCBtb3JlIHRoYW4gMiBjaGFycywgb2s/J30sIHBhc3N3b3JkOiB7Li4uLn19DQoJfTsNCn0pKGpRdWVyeSk7DQo=",
                "body": "LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICogc2NvLnZhbGlkLmpzDQogKiBodHRwOi8vZ2l0aHViLmNvbS90ZXJlYmVudGluYS9zY28uanMNCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAqIENvcHlyaWdodCAyMDEzIERhbiBDYXJhZ2VhLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogaHR0cDovL2FwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KLypqc2hpbnQgbGF4Y29tbWE6dHJ1ZSwgc3ViOnRydWUsIGJyb3dzZXI6dHJ1ZSwganF1ZXJ5OnRydWUsIHNtYXJ0dGFiczp0cnVlICovDQoNCjsoZnVuY3Rpb24oJCwgdW5kZWZpbmVkKSB7DQoJInVzZSBzdHJpY3QiOw0KDQoJdmFyIHBsdWdpbk5hbWUgPSAnc2NvanNfdmFsaWQnOw0KDQoJZnVuY3Rpb24gVmFsaWQoJGZvcm0sIG9wdGlvbnMpIHsNCgkJdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sICQuZm5bcGx1Z2luTmFtZV0uZGVmYXVsdHMsIG9wdGlvbnMpOw0KCQl0aGlzLiRmb3JtID0gJGZvcm07DQoJCXRoaXMuYWxsb3dlZF9ydWxlcyA9IFtdOw0KCQl0aGlzLmVycm9ycyA9IHt9Ow0KCQl2YXIgc2VsZiA9IHRoaXM7DQoJCSQuZWFjaCh0aGlzLm1ldGhvZHMsIGZ1bmN0aW9uKGssIHYpIHsNCgkJCXNlbGYuYWxsb3dlZF9ydWxlcy5wdXNoKGspOw0KCQl9KTsNCgl9DQoNCgkkLmV4dGVuZChWYWxpZC5wcm90b3R5cGUsIHsNCgkJLy8gdGhpcyBpcyB0aGUgbWFpbiBmdW5jdGlvbiAtIGl0IHJldHVybnMgZWl0aGVyIHRydWUgaWYgdGhlIHZhbGlkYXRpb24gcGFzc2VkIG9yIGZhbHNlDQoJCXZhbGlkYXRlOiBmdW5jdGlvbigpIHsNCgkJCXZhciAgc2VsZiA9IHRoaXMNCgkJCQksZm9ybV9maWVsZHMgPSB0aGlzLiRmb3JtLnNlcmlhbGl6ZUFycmF5KCkNCgkJCQksYWxsX2ZpZWxkcyA9IHRoaXMuJGZvcm0uZmluZCgnOmlucHV0W25hbWVdJykubWFwKGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLm5hbWU7fSkuZ2V0KCkNCgkJCQk7DQoNCgkJCS8vIHJlbW92ZSBhbnkgcG9zc2libGUgZGlzcGxheWVkIGVycm9ycyBmcm9tIHByZXZpb3VzIHJ1bnMNCgkJCSQuZWFjaCh0aGlzLmVycm9ycywgZnVuY3Rpb24oZmllbGRfbmFtZSwgZXJyb3IpIHsNCgkJCQl2YXIgJGlucHV0ID0gc2VsZi4kZm9ybS5maW5kKCdbbmFtZT0iJyArIGZpZWxkX25hbWUgKyAnIl0nKTsNCgkJCQkkaW5wdXQuc2libGluZ3MoJ3NwYW4ubWVzc2FnZScpLmh0bWwoJycpOw0KCQkJCWlmIChzZWxmLm9wdGlvbnMud3JhcHBlciAhPT0gbnVsbCkgew0KCQkJCQkkaW5wdXQuY2xvc2VzdChzZWxmLm9wdGlvbnMud3JhcHBlcikucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7DQoJCQkJfQ0KCQkJfSk7DQoJCQl0aGlzLmVycm9ycyA9IHt9Ow0KDQoJCQkkLmVhY2goc2VsZi5vcHRpb25zLnJ1bGVzLCBmdW5jdGlvbihmaWVsZF9uYW1lLCBydWxlcykgew0KCQkJCXZhciAgZmllbGQgPSBudWxsDQoJCQkJCSxub3JtYWxpemVkX3J1bGVzID0ge30NCgkJCQkJOw0KCQkJCS8vIGZpbmQgdGhlIGZpZWxkIGluIHRoZSBmb3JtDQoJCQkJJC5lYWNoKGZvcm1fZmllbGRzLCBmdW5jdGlvbihrLCB2KSB7DQoJCQkJCWlmICh2Lm5hbWUgPT09IGZpZWxkX25hbWUpIHsNCgkJCQkJCWZpZWxkID0gdjsNCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KCQkJCX0pOw0KDQoJCQkJLy8gaWYgZmllbGQgd2FzIG5vdCBmb3VuZCwgaXQgY291bGQgbWVhbiAyIHRoaW5nczogbWlzcGVsbGVkIGZpZWxkIG5hbWUgaW4gdGhlIHJ1bGVzIG9yIHRoZSBmaWVsZCBpcyBub3QgYSBzdWNjZXNzZnVsIGNvbnRyb2wNCgkJCQkvLyBldmVuIGlmIGl0J3Mgbm90IHN1Y2Nlc3NmdWwgd2UgaGF2ZSB0byB2YWxpZGF0ZSBpdA0KCQkJCWlmIChmaWVsZCA9PT0gbnVsbCkgew0KCQkJCQlpZiAoJC5pbkFycmF5KGZpZWxkX25hbWUsIGFsbF9maWVsZHMpICE9PSAtMSkgew0KCQkJCQkJZmllbGQgPSB7bmFtZTogZmllbGRfbmFtZSwgdmFsdWU6IHNlbGYuZ2V0X2ZpZWxkX3ZhbHVlKGZpZWxkX25hbWUpfTsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCS8vIGlmIGl0J3Mgc3RpbGwgbnVsbCB0aGVuIGl0J3MgZWl0aGVyIG1pc3BlbGxlZCBvciBkaXNhYmxlZC4gV2UgZG9uJ3QgY2FyZSBlaXRoZXIgd2F5DQoJCQkJaWYgKGZpZWxkICE9PSBudWxsKSB7DQoJCQkJCSQuZWFjaChydWxlcywgZnVuY3Rpb24ocnVsZV9pZHgsIHJ1bGVfdmFsdWUpIHsNCgkJCQkJCS8vIGRldGVybWluZSB0aGUgbWV0aG9kIHRvIGNhbGwgYW5kIGl0cyBhcmdzDQoJCQkJCQkvLyBvbmx5IHN0cmluZyBhbmQgb2JqZWN0cyBhcmUgYWxsb3dlZA0KCQkJCQkJaWYgKCQudHlwZShydWxlX3ZhbHVlKSA9PT0gJ3N0cmluZycpIHsNCgkJCQkJCQkvLyBtYWtlIHN1cmUgdGhlIHJlcXVlc3RlZCBtZXRob2QgYWN0dWFsbHkgZXhpc3RzLg0KCQkJCQkJCWlmICgkLmluQXJyYXkocnVsZV92YWx1ZSwgc2VsZi5hbGxvd2VkX3J1bGVzKSAhPT0gLTEpIHsNCgkJCQkJCQkJbm9ybWFsaXplZF9ydWxlc1tydWxlX3ZhbHVlXSA9IG51bGw7DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkvLyBpZiBub3Qgc3RyaW5nIHRoZW4gd2UgYXNzdW1lIGl0J3MgYSB7a2V5OiB2YWx9IG9iamVjdC4gT25seSAxIGtleSBpcyBhbGxvd2VkDQoJCQkJCQkJJC5lYWNoKHJ1bGVfdmFsdWUsIGZ1bmN0aW9uKGssIHYpIHsNCgkJCQkJCQkJLy8gbWFrZSBzdXJlIHRoZSByZXF1ZXN0ZWQgbWV0aG9kIGFjdHVhbGx5IGV4aXN0cy4NCgkJCQkJCQkJaWYgKCQuaW5BcnJheShrLCBzZWxmLmFsbG93ZWRfcnVsZXMpICE9PSAtMSkgew0KCQkJCQkJCQkJbm9ybWFsaXplZF9ydWxlc1trXSA9IHY7DQoJCQkJCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJCQkJCX0NCgkJCQkJCQl9KTsNCgkJCQkJCX0NCgkJCQkJfSk7DQoNCgkJCQkJJC5lYWNoKG5vcm1hbGl6ZWRfcnVsZXMsIGZ1bmN0aW9uKGZuX25hbWUsIGZuX2FyZ3MpIHsNCgkJCQkJCS8vIGNhbGwgdGhlIG1ldGhvZCB3aXRoIHRoZSByZXF1ZXN0ZWQgYXJncw0KCQkJCQkJaWYgKHNlbGYubWV0aG9kc1tmbl9uYW1lXS5jYWxsKHNlbGYsIGZpZWxkLm5hbWUsIGZpZWxkLnZhbHVlLCBmbl9hcmdzLCBub3JtYWxpemVkX3J1bGVzKSAhPT0gdHJ1ZSkgew0KCQkJCQkJCXNlbGYuZXJyb3JzW2ZpZWxkLm5hbWVdID0gc2VsZi5mb3JtYXQuY2FsbChzZWxmLCBmaWVsZC5uYW1lLCBmbl9uYW1lLCBmbl9hcmdzKTsNCgkJCQkJCX0NCgkJCQkJfSk7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCWlmICghJC5pc0VtcHR5T2JqZWN0KHRoaXMuZXJyb3JzKSkgew0KCQkJCXRoaXMuc2hvdyh0aGlzLmVycm9ycyk7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfSBlbHNlIHsNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0NCgkJfSwNCg0KDQoJCXNob3c6IGZ1bmN0aW9uKGVycm9ycykgew0KCQkJdmFyIHNlbGYgPSB0aGlzOw0KCQkJJC5lYWNoKGVycm9ycywgZnVuY3Rpb24oaywgdikgew0KCQkJCXZhciAkaW5wdXQgPSBzZWxmLiRmb3JtLmZpbmQoJ1tuYW1lPSInICsgayArICciXScpLA0KCQkJCQkkc3BhbiA9ICRpbnB1dC5zaWJsaW5ncygnLm1lc3NhZ2UnKTsNCgkJCQlpZiAoc2VsZi5vcHRpb25zLndyYXBwZXIgIT09IG51bGwpIHsNCgkJCQkJJGlucHV0LmNsb3Nlc3Qoc2VsZi5vcHRpb25zLndyYXBwZXIpLmFkZENsYXNzKCdlcnJvcicpOw0KCQkJCX0NCgkJCQlpZiAoJHNwYW4ubGVuZ3RoID09PSAwKSB7DQoJCQkJCSRzcGFuID0gJCgnPHNwYW4vPicsIHsnY2xhc3MnOiAnbWVzc2FnZSd9KTsNCgkJCQkJJGlucHV0LmFmdGVyKCRzcGFuKTsNCgkJCQl9DQoJCQkJJHNwYW4uaHRtbCh2KTsNCgkJCX0pOw0KCQl9LA0KDQoNCgkJbWV0aG9kczogew0KCQkJbm90X2VtcHR5OiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQlyZXR1cm4gdmFsdWUgIT09IG51bGwgJiYgJC50cmltKHZhbHVlKS5sZW5ndGggPiAwOw0KCQkJfSwNCg0KCQkJbWluX2xlbmd0aDogZnVuY3Rpb24oZmllbGQsIHZhbHVlLCBtaW5fbGVuLCBhbGxfcnVsZXMpIHsNCgkJCQl2YXIgbGVuZ3RoID0gJC50cmltKHZhbHVlKS5sZW5ndGgNCgkJCQkJLHJlc3VsdCA9IChsZW5ndGggPj0gbWluX2xlbik7DQoJCQkJaWYgKCFhbGxfcnVsZXNbJ25vdF9lbXB0eSddKSB7DQoJCQkJCXJlc3VsdCA9IHJlc3VsdCB8fCBsZW5ndGggPT09IDA7DQoJCQkJfQ0KCQkJCXJldHVybiByZXN1bHQ7DQoJCQl9LA0KDQoJCQltYXhfbGVuZ3RoOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUsIG1heF9sZW4pIHsNCgkJCQlyZXR1cm4gJC50cmltKHZhbHVlKS5sZW5ndGggPD0gbWF4X2xlbjsNCgkJCX0sDQoNCgkJCXJlZ2V4OiBmdW5jdGlvbihmaWVsZCwgdmFsdWUsIHJlZ2V4cCkgew0KCQkJCXJldHVybiByZWdleHAudGVzdCh2YWx1ZSk7DQoJCQl9LA0KDQoJCQllbWFpbDogZnVuY3Rpb24oZmllbGQsIHZhbHVlKSB7DQoJCQkJLy8gYnkgU2NvdHQgR29uemFsZXo6IGh0dHA6Ly9wcm9qZWN0cy5zY290dHNwbGF5Z3JvdW5kLmNvbS9lbWFpbF9hZGRyZXNzX3ZhbGlkYXRpb24vDQoJCQkJdmFyIHJlZ2V4ID0gL14oKChbYS16XXxcZHxbISNcJCUmJ1wqXCtcLVwvPVw/XF5fYHtcfH1+XXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkrKFwuKFthLXpdfFxkfFshI1wkJSYnXCpcK1wtXC89XD9cXl9ge1x8fX5dfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSspKil8KChceDIyKSgoKChceDIwfFx4MDkpKihceDBkXHgwYSkpPyhceDIwfFx4MDkpKyk/KChbXHgwMS1ceDA4XHgwYlx4MGNceDBlLVx4MWZceDdmXXxceDIxfFtceDIzLVx4NWJdfFtceDVkLVx4N2VdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoXFwoW1x4MDEtXHgwOVx4MGJceDBjXHgwZC1ceDdmXXxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkpKSkqKCgoXHgyMHxceDA5KSooXHgwZFx4MGEpKT8oXHgyMHxceDA5KSspPyhceDIyKSkpQCgoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKShbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkqKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSkpXC4pKygoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCgoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSooW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKSkkL2k7DQoJCQkJcmV0dXJuIHJlZ2V4LnRlc3QoJC50cmltKHZhbHVlKSk7DQoJCQl9LA0KDQoJCQl1cmw6IGZ1bmN0aW9uKGZpZWxkLCB2YWx1ZSkgew0KCQkJCS8vIGJ5IFNjb3R0IEdvbnphbGV6OiBodHRwOi8vcHJvamVjdHMuc2NvdHRzcGxheWdyb3VuZC5jb20vaXJpLw0KCQkJCXZhciByZWdleCA9IC9eKGh0dHBzP3xmdHApOlwvXC8oKCgoW2Etel18XGR8LXxcLnxffH58W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCglW1xkYS1mXXsyfSl8WyFcJCYnXChcKVwqXCssOz1dfDopKkApPygoKFxkfFsxLTldXGR8MVxkXGR8MlswLTRdXGR8MjVbMC01XSlcLihcZHxbMS05XVxkfDFcZFxkfDJbMC00XVxkfDI1WzAtNV0pXC4oXGR8WzEtOV1cZHwxXGRcZHwyWzAtNF1cZHwyNVswLTVdKVwuKFxkfFsxLTldXGR8MVxkXGR8MlswLTRdXGR8MjVbMC01XSkpfCgoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKShbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkqKFthLXpdfFxkfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSkpXC4pKygoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCgoW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSooW2Etel18W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKSlcLj8pKDpcZCopPykoXC8oKChbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KCVbXGRhLWZdezJ9KXxbIVwkJidcKFwpXCpcKyw7PV18OnxAKSsoXC8oKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoJVtcZGEtZl17Mn0pfFshXCQmJ1woXClcKlwrLDs9XXw6fEApKikqKT8pPyhcPygoKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoJVtcZGEtZl17Mn0pfFshXCQmJ1woXClcKlwrLDs9XXw6fEApfFtcdUUwMDAtXHVGOEZGXXxcL3xcPykqKT8oXCMoKChbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KCVbXGRhLWZdezJ9KXxbIVwkJidcKFwpXCpcKyw7PV18OnxAKXxcL3xcPykqKT8kL2k7DQoJCQkJcmV0dXJuIHJlZ2V4LnRlc3QodmFsdWUpOw0KCQkJfSwNCg0KCQkJZXhhY3RfbGVuZ3RoOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUsIGV4YWN0X2xlbmd0aCwgYWxsX3J1bGVzKSB7DQoJCQkJdmFyICBsZW5ndGggPSAkLnRyaW0odmFsdWUpLmxlbmd0aA0KCQkJCQkscmVzdWx0ID0gKGxlbmd0aCA9PT0gZXhhY3RfbGVuZ3RoKTsNCgkJCQlpZiAoIWFsbF9ydWxlc1snbm90X2VtcHR5J10pIHsNCgkJCQkJcmVzdWx0ID0gcmVzdWx0IHx8IGxlbmd0aCA9PT0gMDsNCgkJCQl9DQoJCQkJcmV0dXJuIHJlc3VsdDsNCgkJCX0sDQoNCgkJCWVxdWFsczogZnVuY3Rpb24oZmllbGQsIHZhbHVlLCB0YXJnZXQpIHsNCgkJCQlyZXR1cm4gdmFsdWUgPT09IHRhcmdldDsNCgkJCX0sDQoNCgkJCWlwOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQl2YXIgcmVnZXggPSAvXigoMjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn18WzAtOV17MSwyfSlcLil7M30oMjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn18WzAtOV17MSwyfSkkL2k7DQoJCQkJcmV0dXJuIHJlZ2V4LnRlc3QoJC50cmltKHZhbHVlKSk7DQoJCQl9LA0KDQoJCQljcmVkaXRfY2FyZDogZnVuY3Rpb24oZmllbGQsIHZhbHVlKSB7DQoJCQkJLy8gYWNjZXB0IG9ubHkgc3BhY2VzLCBkaWdpdHMgYW5kIGRhc2hlcw0KCQkJCWlmICgvW14wLTkgXC1dKy8udGVzdCh2YWx1ZSkpIHsNCgkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCX0NCgkJCQl2YXIgIG5DaGVjayA9IDANCgkJCQkJLG5EaWdpdCA9IDANCgkJCQkJLGJFdmVuID0gZmFsc2U7DQoNCgkJCQl2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xEL2csICIiKTsNCg0KCQkJCWZvciAodmFyIG4gPSB2YWx1ZS5sZW5ndGggLSAxOyBuID49IDA7IG4tLSkgew0KCQkJCQl2YXIgY0RpZ2l0ID0gdmFsdWUuY2hhckF0KG4pOw0KCQkJCQluRGlnaXQgPSBwYXJzZUludChjRGlnaXQsIDEwKTsNCgkJCQkJaWYgKGJFdmVuKSB7DQoJCQkJCQlpZiAoKG5EaWdpdCAqPSAyKSA+IDkpIHsNCgkJCQkJCQluRGlnaXQgLT0gOTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQluQ2hlY2sgKz0gbkRpZ2l0Ow0KCQkJCQliRXZlbiA9ICFiRXZlbjsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gKG5DaGVjayAlIDEwKSA9PT0gMDsNCgkJCX0sDQoNCgkJCWFscGhhOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQl2YXIgcmVnZXggPSAvXlthLXpdKiQvaTsNCgkJCQlyZXR1cm4gcmVnZXgudGVzdCh2YWx1ZSk7DQoJCQl9LA0KDQoJCQlhbHBoYV9udW1lcmljOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQl2YXIgcmVnZXggPSAvXlthLXowLTldKiQvaTsNCgkJCQlyZXR1cm4gcmVnZXgudGVzdCh2YWx1ZSk7DQoJCQl9LA0KDQoJCQlhbHBoYV9kYXNoOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQl2YXIgcmVnZXggPSAvXlthLXowLTlfXC1dKiQvaTsNCgkJCQlyZXR1cm4gcmVnZXgudGVzdCh2YWx1ZSk7DQoJCQl9LA0KDQoJCQlkaWdpdDogZnVuY3Rpb24oZmllbGQsIHZhbHVlKSB7DQoJCQkJdmFyIHJlZ2V4ID0gL15cZCokLzsNCgkJCQlyZXR1cm4gcmVnZXgudGVzdCh2YWx1ZSk7DQoJCQl9LA0KDQoJCQludW1lcmljOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUpIHsNCgkJCQl2YXIgcmVnZXggPSAvXihbXCtcLV0/WzAtOV0rKFwuWzAtOV0rKT8pPyQvOw0KCQkJCXJldHVybiByZWdleC50ZXN0KHZhbHVlKTsNCgkJCX0sDQoNCgkJCS8vIHNhbWUgYXMgbnVtZXJpYw0KCQkJZGVjaW1hbDogZnVuY3Rpb24oZmllbGQsIHZhbHVlKSB7DQoJCQkJdmFyIHJlZ2V4ID0gL14oW1wrXC1dP1swLTldKyhcLlswLTldKyk/KT8kLzsNCgkJCQlyZXR1cm4gcmVnZXgudGVzdCh2YWx1ZSk7DQoJCQl9LA0KDQoJCQltYXRjaGVzOiBmdW5jdGlvbihmaWVsZCwgdmFsdWUsIHBhcmFtKSB7DQoJCQkJcmV0dXJuIHZhbHVlID09PSB0aGlzLiRmb3JtLmZpbmQoJ1tuYW1lPSInICsgcGFyYW0gKyAnIl0nKS52YWwoKTsNCgkJCX0NCgkJfSwNCg0KDQoJCW1lc3NhZ2VzOiB7DQoJCQlub3RfZW1wdHk6ICdUaGlzIGZpZWxkIGlzIHJlcXVpcmVkLicNCgkJCSxtaW5fbGVuZ3RoOiAnUGxlYXNlIGVudGVyIGF0IGxlYXN0IDp2YWx1ZSBjaGFyYWN0ZXJzLicNCgkJCSxtYXhfbGVuZ3RoOiAnUGxlYXNlIGVudGVyIG5vIG1vcmUgdGhhbiA6dmFsdWUgY2hhcmFjdGVycy4nDQoJCQkscmVnZXg6ICcnDQoJCQksZW1haWw6ICdQbGVhc2UgZW50ZXIgYSB2YWxpZCBlbWFpbCBhZGRyZXNzLicNCgkJCSx1cmw6ICdQbGVhc2UgZW50ZXIgYSB2YWxpZCBVUkwuJw0KCQkJLGV4YWN0X2xlbmd0aDogJ1BsZWFzZSBlbnRlciBleGFjdGx5IDp2YWx1ZSBjaGFyYWN0ZXJzLicNCgkJCSxlcXVhbHM6ICcnDQoJCQksaXA6ICcnDQoJCQksY3JlZGl0X2NhcmQ6ICdQbGVhc2UgZW50ZXIgYSB2YWxpZCBjcmVkaXQgY2FyZCBudW1iZXIuJw0KCQkJLGFscGhhOiAnJw0KCQkJLGFscGhhX251bWVyaWM6ICcnDQoJCQksYWxwaGFfZGFzaDogJycNCgkJCSxkaWdpdDogJ1BsZWFzZSBlbnRlciBvbmx5IGRpZ2l0cy4nDQoJCQksbnVtZXJpYzogJ1BsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4nDQoJCQksZGVjaW1hbDogJ1BsZWFzZSBlbnRlciBhIGRlY2ltYWwgbnVtYmVyLicNCgkJCSxtYXRjaGVzOiAnTXVzdCBtYXRjaCB0aGUgcHJldmlvdXMgdmFsdWUuJw0KCQl9LA0KDQoNCgkJLyoqDQoJCSAqIGZpbmRzIHRoZSBtb3N0IHNwZWNpZmljIGVycm9yIG1lc3NhZ2Ugc3RyaW5nIGFuZCByZXBsYWNlcyBhbnkgIjp2YWx1ZSIgc3Vic3RyaW5nIHdpdGggdGhlIGFjdHVhbCB2YWx1ZQ0KCQkgKi8NCgkJZm9ybWF0OiBmdW5jdGlvbihmaWVsZF9uYW1lLCBydWxlLCBwYXJhbXMpIHsNCgkJCXZhciBtZXNzYWdlOw0KCQkJaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMubWVzc2FnZXNbZmllbGRfbmFtZV0gIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiB0aGlzLm9wdGlvbnMubWVzc2FnZXNbZmllbGRfbmFtZV1bcnVsZV0gIT09ICd1bmRlZmluZWQnKSB7DQoJCQkJbWVzc2FnZSA9IHRoaXMub3B0aW9ucy5tZXNzYWdlc1tmaWVsZF9uYW1lXVtydWxlXTsNCgkJCX0gZWxzZSB7DQoJCQkJbWVzc2FnZSA9IHRoaXMubWVzc2FnZXNbcnVsZV07DQoJCQl9DQoNCgkJCWlmICgkLnR5cGUocGFyYW1zKSAhPT0gJ3VuZGVmaW5lZCcgJiYgcGFyYW1zICE9PSBudWxsKSB7DQoJCQkJaWYgKCQudHlwZShwYXJhbXMpID09PSAnYm9vbGVhbicgfHwgJC50eXBlKHBhcmFtcykgPT09ICdzdHJpbmcnIHx8ICQudHlwZShwYXJhbXMpID09PSAnbnVtYmVyJykgew0KCQkJCQlwYXJhbXMgPSB7dmFsdWU6IHBhcmFtc307DQoJCQkJfQ0KCQkJCSQuZWFjaChwYXJhbXMsIGZ1bmN0aW9uKGssIHYpIHsNCgkJCQkJbWVzc2FnZSA9IG1lc3NhZ2UucmVwbGFjZShuZXcgUmVnRXhwKCc6JyArIGssICdpZycpLCB2KTsNCgkJCQl9KTsNCgkJCX0NCgkJCXJldHVybiBtZXNzYWdlOw0KCQl9LA0KDQoNCgkJLyoqDQoJCSAqIGdldCBhIG5vcm1hbGl6ZWQgdmFsdWUgZm9yIGEgZm9ybSBmaWVsZC4NCgkJICovDQoJCWdldF9maWVsZF92YWx1ZTogZnVuY3Rpb24oZmllbGRfbmFtZSkgew0KCQkJdmFyICRpbnB1dCA9IHRoaXMuJGZvcm0uZmluZCgnW25hbWU9IicgKyBmaWVsZF9uYW1lICsgJyJdJyk7DQoJCQlpZiAoJGlucHV0LmlzKCdbdHlwZT0iY2hlY2tib3giXSwgW3R5cGU9InJhZGlvIl0nKSkgew0KCQkJCXJldHVybiAkaW5wdXQuaXMoJzpjaGVja2VkJykgPyAkaW5wdXQudmFsKCkgOiBudWxsOw0KCQkJfSBlbHNlIHsNCgkJCQlyZXR1cm4gJGlucHV0LnZhbCgpOw0KCQkJfQ0KCQl9DQoJfSk7DQoNCg0KCS8qKg0KCSAqIG1haW4gZnVuY3Rpb24gdG8gdXNlIG9uIGEgZm9ybSAobGlrZSAkKCcjZm9ybSkuc2NvanNfdmFsaWQoey4uLn0pKS4gUGVyZm9ybXMgdmFsaWRhdGlvbiBvZiB0aGUgZm9ybSwgc2V0cyB0aGUgZXJyb3IgbWVzc2FnZXMgb24gZm9ybSBpbnB1dHMgYW5kIHJldHVybnMNCgkgKiB0cnVlL2ZhbHNlIGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSBmb3JtIHBhc3NlZCB2YWxpZGF0aW9uIG9yIG5vdA0KCSAqDQoJICogQHBhcmFtIHtoYXNofHN0cmluZ30gb3B0aW9ucyB0aGUgaGFzaCBvZiBydWxlcyBhbmQgbWVzc2FnZXMgdG8gdmFsaWRhdGUgdGhlIGZvcm0gYWdhaW5zdCAoYW5kIG1lc3NhZ2VzIHRvIHNob3cgaWYgZmFpbGVkIHZhbGlkYXRpb24pIG9yIHRoZSBzdHJpbmcgIm9wdGlvbiINCgkgKiBAcGFyYW0ge3N0cmluZ30ga2V5IHRoZSBvcHRpb24ga2V5IHRvIHJldHJpZXZlIG9yIHNldC4gSWYgdGhlIHRoaXJkIHBhcmFtIG9mIHRoZSBmdW5jdGlvbiBpcyBhdmFpbGFibGUgdGhlbiBhY3QgYXMgYSBzZXR0ZXIsIG90aGVyd2lzZSBhcyBhIGdldHRlci4NCgkgKiBAcGFyYW0ge21peGVkfSB2YWx1ZSB0aGUgdmFsdWUgdG8gc2V0IG9uIHRoZSBrZXkNCgkgKi8NCgkkLmZuW3BsdWdpbk5hbWVdID0gZnVuY3Rpb24ob3B0aW9ucywga2V5LCB2YWx1ZSkgew0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGlkeCwgZm9ybSkgew0KCQkJdmFyICRmb3JtID0gJChmb3JtKQ0KCQkJCSx2YWxpZGF0b3IgPSAkZm9ybS5kYXRhKHBsdWdpbk5hbWUpDQoJCQkJOw0KCQkJaWYgKCQudHlwZShvcHRpb25zKSA9PT0gJ29iamVjdCcpIHsNCgkJCQlpZiAoIXZhbGlkYXRvcikgew0KCQkJCQl2YXIgb3B0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuW3BsdWdpbk5hbWVdLmRlZmF1bHRzLCBvcHRpb25zLCAkZm9ybS5kYXRhKCkpOw0KCQkJCQl2YWxpZGF0b3IgPSBuZXcgVmFsaWQoJGZvcm0sIG9wdHMpOw0KCQkJCQkkZm9ybS5kYXRhKHBsdWdpbk5hbWUsIHZhbGlkYXRvcikuYXR0cignbm92YWxpZGF0ZScsICdub3ZhbGlkYXRlJyk7DQoJCQkJfQ0KCQkJCSRmb3JtLmFqYXhGb3JtKHsNCgkJCQkJYmVmb3JlU2VyaWFsaXplOiBmdW5jdGlvbigpIHsNCgkJCQkJCWlmICh0eXBlb2YgdmFsaWRhdG9yLm9wdGlvbnMub25CZWZvcmVWYWxpZGF0ZSA9PT0gJ2Z1bmN0aW9uJykgew0KCQkJCQkJCXZhbGlkYXRvci5vcHRpb25zLm9uQmVmb3JlVmFsaWRhdGUuY2FsbCh2YWxpZGF0b3IpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCSxiZWZvcmVTdWJtaXQ6IGZ1bmN0aW9uKCkgew0KCQkJCQkJcmV0dXJuIHZhbGlkYXRvci52YWxpZGF0ZSgpOw0KCQkJCQl9DQoJCQkJCSxkYXRhVHlwZTogJ2pzb24nDQoJCQkJCSxzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSwgc3RhdHVzLCB4aHIsICRmb3JtKSB7DQoJCQkJCQlpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnZmFpbCcpIHsNCgkJCQkJCQlpZiAodHlwZW9mIG9wdGlvbnMub25GYWlsICE9PSAnZnVuY3Rpb24nIHx8IG9wdGlvbnMub25GYWlsLmNhbGwodGhpcywgcmVzcG9uc2UsIHZhbGlkYXRvciwgJGZvcm0pICE9PSBmYWxzZSkgew0KCQkJCQkJCQl2YWxpZGF0b3Iuc2hvdyhyZXNwb25zZS5kYXRhLmVycm9ycyk7DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdlcnJvcicpIHsNCgkJCQkJCQlpZiAodHlwZW9mIG9wdGlvbnMub25FcnJvciAhPT0gJ2Z1bmN0aW9uJyB8fCBvcHRpb25zLm9uRXJyb3IuY2FsbCh0aGlzLCByZXNwb25zZSwgdmFsaWRhdG9yLCAkZm9ybSkgIT09IGZhbHNlKSB7DQoJCQkJCQkJCSQuc2NvanNfbWVzc2FnZShyZXNwb25zZS5tZXNzYWdlLCAkLnNjb2pzX21lc3NhZ2UuVFlQRV9FUlJPUik7DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdzdWNjZXNzJykgew0KCQkJCQkJCWlmICh0eXBlb2Ygb3B0aW9ucy5vblN1Y2Nlc3MgIT09ICdmdW5jdGlvbicgfHwgb3B0aW9ucy5vblN1Y2Nlc3MuY2FsbCh0aGlzLCByZXNwb25zZSwgdmFsaWRhdG9yLCAkZm9ybSkgIT09IGZhbHNlKSB7DQoJCQkJCQkJCWlmIChyZXNwb25zZS5kYXRhLm5leHQpIHsNCgkJCQkJCQkJCWlmIChyZXNwb25zZS5kYXRhLm5leHQgPT09ICcuJykgewkJCS8vIHJlZnJlc2ggY3VycmVudCBwYWdlDQoJCQkJCQkJCQkJd2luZG93LmxvY2F0aW9uLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKC8jLiokLywgJycpOw0KCQkJCQkJCQkJfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhLm5leHQgPT09ICd4JykgewkvLyBjbG9zZSB0aGUgcGFyZW50IG1vZGFsDQoJCQkJCQkJCQkJJGZvcm0uY2xvc2VzdCgnLm1vZGFsJykudHJpZ2dlcignY2xvc2UnKTsNCgkJCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCQkJd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXNwb25zZS5kYXRhLm5leHQ7DQoJCQkJCQkJCQl9DQoJCQkJCQkJCX0NCgkJCQkJCQkJaWYgKHJlc3BvbnNlLmRhdGEubWVzc2FnZSkgew0KCQkJCQkJCQkJJC5zY29qc19tZXNzYWdlKHJlc3BvbnNlLmRhdGEubWVzc2FnZSwgJC5zY29qc19tZXNzYWdlLlRZUEVfT0spOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSk7DQoJCQkJLy8gYWxsb3cgY2hhaW5pbmcNCgkJCQlyZXR1cm4gdGhpczsNCgkJCX0gZWxzZSBpZiAob3B0aW9ucyA9PT0gJ29wdGlvbicpIHsNCgkJCQlpZiAoJC50eXBlKHZhbHVlKSA9PT0gJ3VuZGVmaW5lZCcpIHsNCgkJCQkJcmV0dXJuIHZhbGlkYXRvci5vcHRpb25zW2tleV07DQoJCQkJfSBlbHNlIHsNCgkJCQkJdmFsaWRhdG9yLm9wdGlvbnNba2V5XSA9IHZhbHVlOw0KCQkJCQlyZXR1cm4gdmFsaWRhdG9yOw0KCQkJCX0NCgkJCX0gZWxzZSB7DQoJCQkJcmV0dXJuIHZhbGlkYXRvciA/IHZhbGlkYXRvciA6IHRoaXM7DQoJCQl9DQoJCX0pOw0KCX07DQoNCg0KCSRbcGx1Z2luTmFtZV0gPSBmdW5jdGlvbihmb3JtLCBvcHRpb25zKSB7DQoJCWlmICh0eXBlb2YgZm9ybSA9PT0gJ3N0cmluZycpIHsNCgkJCWZvcm0gPSAkKGZvcm0pOw0KCQl9DQoJCXJldHVybiBuZXcgVmFsaWQoZm9ybSwgb3B0aW9ucyk7DQoJfTsNCg0KDQoJJC5mbltwbHVnaW5OYW1lXS5kZWZhdWx0cyA9IHsNCgkJd3JhcHBlcjogJ2xhYmVsJwkvLyB0aGUgaHRtbCB0YWcgdGhhdCB3cmFwcyB0aGUgZmllbGQgYW5kIHdoaWNoIGRlZmluZXMgYSAicm93IiBvZiB0aGUgZm9ybQ0KCQkscnVsZXM6IHt9CQkJLy8gYXJyYXkgb2YgcnVsZXMgdG8gY2hlY2sgdGhlIGZvcm0gYWdhaW5zdC4gRWFjaCB2YWx1ZSBzaG91bGQgYmUgZWl0aGVyIGEgc3RyaW5nIHdpdGggdGhlIG5hbWUgb2YgdGhlIG1ldGhvZCB0byB1c2UgYXMgcnVsZSBvciBhIGhhc2ggbGlrZSB7bWV0aG9kOiA8bWV0aG9kIHBhcmFtcz59DQoJCSxtZXNzYWdlczoge30JCS8vIGN1c3RvbSBlcnJvciBtZXNzYWdlcyBsaWtlIHt1c2VybmFtZToge25vdF9lbXB0eTogJ2hleSB5b3UgZm9yZ290IHRvIGVudGVyIHlvdXIgdXNlcm5hbWUnLCBtaW5fbGVuZ3RoOiAnY29tZSBvbiwgbW9yZSB0aGFuIDIgY2hhcnMsIG9rPyd9LCBwYXNzd29yZDogey4uLi59fQ0KCX07DQp9KShqUXVlcnkpOw0K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 04:03:18 GMT",
                    "Content-Length": "14799",
                    "Date": "Sat, 08 Nov 2014 04:03:18 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}