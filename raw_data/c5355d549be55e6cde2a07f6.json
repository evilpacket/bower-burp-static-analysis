{
    "url": "http://localhost:9999/artema/FlashWarp/docs/flash/asdoc.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.search</b> and written to <b>window.location.replace()</b> via the following statements:<ul><li>localRef += (\"#\" + window.location.search.substring(1));</li><li>window.location.replace(baseRef + \"index.html?\" + localRef);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/artema/FlashWarp/docs/flash/asdoc.js",
                "path": "/artema/FlashWarp/docs/flash/asdoc.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hcnRlbWEvRmxhc2hXYXJwL2RvY3MvZmxhc2gvYXNkb2MuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTQ2ODINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDA6MjQ6MDIgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDAwOjI0OjAyIEdNVA0KDQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLwovLyAgQURPQkUgU1lTVEVNUyBJTkNPUlBPUkFURUQKLy8gIENvcHlyaWdodCAyMDA2LTIwMDggQWRvYmUgU3lzdGVtcyBJbmNvcnBvcmF0ZWQKLy8gIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCi8vCi8vICBOT1RJQ0U6IEFkb2JlIHBlcm1pdHMgeW91IHRvIHVzZSwgbW9kaWZ5LCBhbmQgZGlzdHJpYnV0ZSB0aGlzIGZpbGUKLy8gIGluIGFjY29yZGFuY2Ugd2l0aCB0aGUgdGVybXMgb2YgdGhlIGxpY2Vuc2UgYWdyZWVtZW50IGFjY29tcGFueWluZyBpdC4KLy8KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KdmFyIEVDTElQU0VfRlJBTUVfTkFNRSA9ICJDb250ZW50Vmlld0ZyYW1lIjsKdmFyIGVjbGlwc2VCdWlsZCA9IGZhbHNlOwp2YXIgbGl2ZURvY3NCYXNlVXJsID0gImh0dHA6Ly9saXZlZG9jcy5hZG9iZS5jb20vZmxleC8zIjsKdmFyIGxpdmVEb2NzQm9va05hbWUgPSAibGFuZ3JlZiI7CmZ1bmN0aW9uIGZpbmRPYmplY3Qob2JqSWQpIHsKICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCkKICAgICAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob2JqSWQpOwogICAgaWYgKGRvY3VtZW50LmFsbCkKICAgICAgICByZXR1cm4gZG9jdW1lbnQuYWxsW29iaklkXTsKfQpmdW5jdGlvbiBpc0VjbGlwc2UoKSB7CiAgICByZXR1cm4gZWNsaXBzZUJ1aWxkOwovLyAgcmV0dXJuICh3aW5kb3cubmFtZSA9PSBFQ0xJUFNFX0ZSQU1FX05BTUUpIHx8IChwYXJlbnQubmFtZSA9PSBFQ0xJUFNFX0ZSQU1FX05BTUUpIHx8IChwYXJlbnQucGFyZW50Lm5hbWUgPT0gRUNMSVBTRV9GUkFNRV9OQU1FKTsKfQpmdW5jdGlvbiBjb25maWdQYWdlKCkgewogICAgc2V0Um93Q29sb3JzSW5pdGlhbCh0cnVlLCAiUHJvcGVydHkiKTsKICAgIHNldFJvd0NvbG9yc0luaXRpYWwodHJ1ZSwgIk1ldGhvZCIpOwogICAgc2V0Um93Q29sb3JzSW5pdGlhbCh0cnVlLCAiUHJvdGVjdGVkTWV0aG9kIik7ICAgCiAgICBzZXRSb3dDb2xvcnNJbml0aWFsKHRydWUsICJFdmVudCIpOwogICAgc2V0Um93Q29sb3JzSW5pdGlhbCh0cnVlLCAiU3R5bGUiKTsKICAgIAogICAgc2V0Um93Q29sb3JzSW5pdGlhbCh0cnVlLCAiU2tpblBhcnQiKTsKICAgIHNldFJvd0NvbG9yc0luaXRpYWwodHJ1ZSwgIlNraW5TdGF0ZSIpOwogICAgCiAgICBzZXRSb3dDb2xvcnNJbml0aWFsKHRydWUsICJDb25zdGFudCIpOwogICAgaWYgKGlzRWNsaXBzZSgpKSB7CiAgICAgICAgaWYgKHdpbmRvdy5uYW1lICE9ICJjbGFzc0ZyYW1lIikKICAgICAgICB7CiAgICAgICAgICAgIHZhciBsb2NhbFJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJz8nKSAhPSAtMSA/IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN1YnN0cmluZygwLCB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCc/JykpIDogd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgIGxvY2FsUmVmID0gbG9jYWxSZWYuc3Vic3RyaW5nKGxvY2FsUmVmLmluZGV4T2YoImxhbmdyZWYvIikgKyA4KTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggIT0gIiIpCiAgICAgICAgICAgICAgICBsb2NhbFJlZiArPSAoIiMiICsgd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSkpOwogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZShiYXNlUmVmICsgImluZGV4Lmh0bWw/IiArIGxvY2FsUmVmKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBzZXRTdHlsZSgiLmVjbGlwc2VCb2R5IiwgImRpc3BsYXkiLCAiYmxvY2siKTsKLy8gICAgICAgICAgdmFyIGlzSUUgID0gKG5hdmlnYXRvci5hcHBWZXJzaW9uLmluZGV4T2YoIk1TSUUiKSAhPSAtMSkgPyB0cnVlIDogZmFsc2U7Ci8vICAgICAgICAgIGlmIChpc0lFID09IGZhbHNlICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoICE9ICIiKQogICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2ggIT0gIiIpCiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaD13aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSBpZiAod2luZG93ID09IHRvcCkgeyAvLyBubyBmcmFtZXMKICAgICAgICBmaW5kT2JqZWN0KCJ0aXRsZVRhYmxlIikuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgfQogICAgZWxzZSB7IC8vIGZyYW1lcwogICAgICAgIGZpbmRPYmplY3QoInRpdGxlVGFibGUiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgfQogICAgc2hvd1RpdGxlKGFzZG9jVGl0bGUpOwp9CmZ1bmN0aW9uIGxvYWRGcmFtZXMoY2xhc3NGcmFtZVVSTCwgY2xhc3NMaXN0RnJhbWVVUkwpIHsKICAgIHZhciBjbGFzc0xpc3RGcmFtZSA9IGZpbmRPYmplY3QoImNsYXNzTGlzdEZyYW1lIik7CiAgICBpZihjbGFzc0xpc3RGcmFtZSAhPSBudWxsICYmIGNsYXNzTGlzdEZyYW1lQ29udGVudCE9JycpCiAgICAgICAgY2xhc3NMaXN0RnJhbWUuZG9jdW1lbnQubG9jYXRpb24uaHJlZj1jbGFzc0xpc3RGcmFtZUNvbnRlbnQ7CiAgICBpZiAoaXNFY2xpcHNlKCkpIHsKICAgICAgICB2YXIgY29udGVudFZpZXdGcmFtZSA9IGZpbmRPYmplY3QoRUNMSVBTRV9GUkFNRV9OQU1FKTsKICAgICAgICBpZiAoY29udGVudFZpZXdGcmFtZSAhPSBudWxsICYmIGNsYXNzRnJhbWVVUkwgIT0gJycpCiAgICAgICAgICAgIGNvbnRlbnRWaWV3RnJhbWUuZG9jdW1lbnQubG9jYXRpb24uaHJlZj1jbGFzc0ZyYW1lVVJMOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgdmFyIGNsYXNzRnJhbWUgPSBmaW5kT2JqZWN0KCJjbGFzc0ZyYW1lIik7CiAgICAgICAgaWYoY2xhc3NGcmFtZSAhPSBudWxsICYmIGNsYXNzRnJhbWVDb250ZW50IT0nJykKICAgICAgICAgICAgY2xhc3NGcmFtZS5kb2N1bWVudC5sb2NhdGlvbi5ocmVmPWNsYXNzRnJhbWVDb250ZW50OwogICAgfQp9CmZ1bmN0aW9uIHNob3dUaXRsZSh0aXRsZSkgewogICAgaWYgKCFpc0VjbGlwc2UoKSkKICAgICAgICB0b3AuZG9jdW1lbnQudGl0bGUgPSB0aXRsZTsKfQpmdW5jdGlvbiBsb2FkQ2xhc3NMaXN0RnJhbWUoY2xhc3NMaXN0RnJhbWVVUkwpIHsKICAgIGlmIChwYXJlbnQuZnJhbWVzWyJjbGFzc0xpc3RGcmFtZSJdICE9IG51bGwpIHsKICAgICAgICBwYXJlbnQuZnJhbWVzWyJjbGFzc0xpc3RGcmFtZSJdLmxvY2F0aW9uID0gY2xhc3NMaXN0RnJhbWVVUkw7CiAgICB9CiAgICBlbHNlIGlmIChwYXJlbnQuZnJhbWVzWyJwYWNrYWdlRnJhbWUiXSAhPSBudWxsKSB7CiAgICAgICAgaWYgKHBhcmVudC5mcmFtZXNbInBhY2thZ2VGcmFtZSJdLmZyYW1lc1siY2xhc3NMaXN0RnJhbWUiXSAhPSBudWxsKSB7CiAgICAgICAgICAgIHBhcmVudC5mcmFtZXNbInBhY2thZ2VGcmFtZSJdLmZyYW1lc1siY2xhc3NMaXN0RnJhbWUiXS5sb2NhdGlvbiA9IGNsYXNzTGlzdEZyYW1lVVJMOwogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBnb3RvTGl2ZURvY3MocHJpbWFyeVVSTCwgc2Vjb25kYXJ5VVJMLCBsb2NhbGUpIHsKICAgICAgICBpZiAobG9jYWxlID09ICJlbi11cyIpIHsKICAgICAgICAgICAgIGxvY2FsZSA9ICIiOwogICAgICAgIH0gCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgbG9jYWxlID0gIl8iICsgbG9jYWxlLnN1YnN0cmluZygzKTsKICAgICAgICB9CiAgICB2YXIgdXJsID0gbGl2ZURvY3NCYXNlVXJsICsgbG9jYWxlICsgIi8iICsgbGl2ZURvY3NCb29rTmFtZSArICIvaW5kZXguaHRtbD8iICsgcHJpbWFyeVVSTDsKICAgIGlmIChzZWNvbmRhcnlVUkwgIT0gbnVsbCAmJiBzZWNvbmRhcnlVUkwgIT0gIiIpCiAgICAgICAgdXJsICs9ICgiJiIgKyBzZWNvbmRhcnlVUkwpOwogICAgd2luZG93Lm9wZW4odXJsLCAibW1fbGl2ZWRvY3MiLCAibWVudWJhcj0xLHRvb2xiYXI9MSxzdGF0dXM9MSxzY3JvbGxiYXJzPTEscmVzaXphYmxlPXllcyIpOwp9CmZ1bmN0aW9uIGZpbmRUaXRsZVRhYmxlT2JqZWN0KGlkKQp7CiAgICBpZiAoaXNFY2xpcHNlKCkpCiAgICAgICAgcmV0dXJuIHBhcmVudC50aXRsZWJhci5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICBlbHNlIGlmICh0b3AudGl0bGViYXIpCiAgICAgICAgcmV0dXJuIHRvcC50aXRsZWJhci5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICBlbHNlCiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKfQpmdW5jdGlvbiB0aXRsZUJhcl9zZXRTdWJUaXRsZSh0aXRsZSkKewogICAgaWYgKGlzRWNsaXBzZSgpIHx8IHRvcC50aXRsZWJhcikKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgic3ViVGl0bGUiKS5jaGlsZE5vZGVzLml0ZW0oMCkuZGF0YSA9IHRpdGxlOwp9CmZ1bmN0aW9uIHRpdGxlQmFyX3NldFN1Yk5hdihzaG93Q29uc3RhbnRzLHNob3dQcm9wZXJ0aWVzLHNob3dTdHlsZXMsc2hvd1NraW5QYXJ0LHNob3dTa2luU3RhdGUsc2hvd0VmZmVjdHMsc2hvd0V2ZW50cyxzaG93Q29uc3RydWN0b3Isc2hvd01ldGhvZHMsc2hvd0V4YW1wbGVzLAogICAgICAgICAgICAgICAgc2hvd1BhY2thZ2VDb25zdGFudHMsc2hvd1BhY2thZ2VQcm9wZXJ0aWVzLHNob3dQYWNrYWdlRnVuY3Rpb25zLHNob3dJbnRlcmZhY2VzLHNob3dDbGFzc2VzLHNob3dQYWNrYWdlVXNlKQp7CiAgICBpZiAoaXNFY2xpcHNlKCkgfHwgdG9wLnRpdGxlYmFyKQogICAgewogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJwcm9wZXJ0aWVzTGluayIpLnN0eWxlLmRpc3BsYXkgPSBzaG93UHJvcGVydGllcyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJwcm9wZXJ0aWVzQmFyIikuc3R5bGUuZGlzcGxheSA9IChzaG93UHJvcGVydGllcyAmJiAoc2hvd1BhY2thZ2VQcm9wZXJ0aWVzIHx8IHNob3dDb25zdHJ1Y3RvciB8fCBzaG93TWV0aG9kcyB8fCBzaG93UGFja2FnZUZ1bmN0aW9ucyB8fCBzaG93RXZlbnRzIHx8IHNob3dTdHlsZXMgfHwgc2hvd1NraW5QYXJ0IHx8IHNob3dTa2luU3RhdGUgfHwgc2hvd0VmZmVjdHMgfHwgc2hvd0NvbnN0YW50cyB8fCBzaG93UGFja2FnZUNvbnN0YW50cyB8fCBzaG93SW50ZXJmYWNlcyB8fCBzaG93Q2xhc3NlcyB8fCBzaG93UGFja2FnZVVzZSB8fCBzaG93RXhhbXBsZXMpKSA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJwYWNrYWdlUHJvcGVydGllc0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd1BhY2thZ2VQcm9wZXJ0aWVzID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoInBhY2thZ2VQcm9wZXJ0aWVzQmFyIikuc3R5bGUuZGlzcGxheSA9IChzaG93UGFja2FnZVByb3BlcnRpZXMgJiYgKHNob3dDb25zdHJ1Y3RvciB8fCBzaG93TWV0aG9kcyB8fCBzaG93UGFja2FnZUZ1bmN0aW9ucyB8fCBzaG93RXZlbnRzIHx8IHNob3dTdHlsZXMgfHwgc2hvd1NraW5QYXJ0IHx8IHNob3dTa2luU3RhdGUgfHwgc2hvd0NvbnN0YW50cyB8fCBzaG93RWZmZWN0cyB8fCBzaG93UGFja2FnZUNvbnN0YW50cyB8fCBzaG93SW50ZXJmYWNlcyB8fCBzaG93Q2xhc3NlcyB8fCBzaG93UGFja2FnZVVzZSB8fCBzaG93RXhhbXBsZXMpKSA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJjb25zdHJ1Y3RvckxpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd0NvbnN0cnVjdG9yID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoImNvbnN0cnVjdG9yQmFyIikuc3R5bGUuZGlzcGxheSA9IChzaG93Q29uc3RydWN0b3IgJiYgKHNob3dNZXRob2RzIHx8IHNob3dQYWNrYWdlRnVuY3Rpb25zIHx8IHNob3dFdmVudHMgfHwgc2hvd1N0eWxlcyB8fCBzaG93U2tpblBhcnQgfHwgc2hvd1NraW5TdGF0ZSB8fCBzaG93RWZmZWN0cyB8fCBzaG93Q29uc3RhbnRzIHx8IHNob3dQYWNrYWdlQ29uc3RhbnRzIHx8IHNob3dJbnRlcmZhY2VzIHx8IHNob3dDbGFzc2VzIHx8IHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoIm1ldGhvZHNMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dNZXRob2RzID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoIm1ldGhvZHNCYXIiKS5zdHlsZS5kaXNwbGF5ID0gKHNob3dNZXRob2RzICYmIChzaG93UGFja2FnZUZ1bmN0aW9ucyB8fCBzaG93RXZlbnRzIHx8IHNob3dTdHlsZXMgfHwgc2hvd1NraW5QYXJ0IHx8IHNob3dTa2luU3RhdGUgfHwgc2hvd0VmZmVjdHMgfHwgc2hvd0NvbnN0YW50cyB8fCBzaG93UGFja2FnZUNvbnN0YW50cyB8fCBzaG93SW50ZXJmYWNlcyB8fCBzaG93Q2xhc3NlcyB8fCBzaG93UGFja2FnZVVzZSB8fCBzaG93RXhhbXBsZXMpKSA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJwYWNrYWdlRnVuY3Rpb25zTGluayIpLnN0eWxlLmRpc3BsYXkgPSBzaG93UGFja2FnZUZ1bmN0aW9ucyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJwYWNrYWdlRnVuY3Rpb25zQmFyIikuc3R5bGUuZGlzcGxheSA9IChzaG93UGFja2FnZUZ1bmN0aW9ucyAmJiAoc2hvd0V2ZW50cyB8fCBzaG93U3R5bGVzIHx8IHNob3dTa2luUGFydCB8fCBzaG93U2tpblN0YXRlIHx8IHNob3dFZmZlY3RzIHx8IHNob3dDb25zdGFudHMgfHwgc2hvd1BhY2thZ2VDb25zdGFudHMgfHwgc2hvd0ludGVyZmFjZXMgfHwgc2hvd0NsYXNzZXMgfHwgc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiZXZlbnRzTGluayIpLnN0eWxlLmRpc3BsYXkgPSBzaG93RXZlbnRzID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoImV2ZW50c0JhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd0V2ZW50cyAmJiAoc2hvd1N0eWxlcyB8fCBzaG93U2tpblBhcnQgfHwgc2hvd1NraW5TdGF0ZSB8fCBzaG93RWZmZWN0cyB8fCBzaG93Q29uc3RhbnRzIHx8IHNob3dQYWNrYWdlQ29uc3RhbnRzIHx8IHNob3dJbnRlcmZhY2VzIHx8IHNob3dDbGFzc2VzIHx8IHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoInN0eWxlc0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd1N0eWxlcyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJzdHlsZXNCYXIiKS5zdHlsZS5kaXNwbGF5ID0gKHNob3dTdHlsZXMgJiYgKHNob3dTa2luUGFydCB8fCBzaG93U2tpblN0YXRlIHx8IHNob3dFZmZlY3RzIHx8IHNob3dDb25zdGFudHMgfHwgc2hvd1BhY2thZ2VDb25zdGFudHMgfHwgc2hvd0ludGVyZmFjZXMgfHwgc2hvd0NsYXNzZXMgfHwgc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICAKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiU2tpblBhcnRMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dTa2luUGFydCA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJTa2luUGFydEJhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd1NraW5QYXJ0ICYmIChzaG93U2tpblN0YXRlIHx8IHNob3dFZmZlY3RzIHx8IHNob3dDb25zdGFudHMgfHwgc2hvd1BhY2thZ2VDb25zdGFudHMgfHwgc2hvd0ludGVyZmFjZXMgfHwgc2hvd0NsYXNzZXMgfHwgc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICAKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiU2tpblN0YXRlTGluayIpLnN0eWxlLmRpc3BsYXkgPSBzaG93U2tpblN0YXRlID8gImlubGluZSIgOiAibm9uZSI7CglmaW5kVGl0bGVUYWJsZU9iamVjdCgiU2tpblN0YXRlQmFyIikuc3R5bGUuZGlzcGxheSA9IChzaG93U2tpblN0YXRlICYmIChzaG93RWZmZWN0cyB8fCBzaG93Q29uc3RhbnRzIHx8IHNob3dQYWNrYWdlQ29uc3RhbnRzIHx8IHNob3dJbnRlcmZhY2VzIHx8IHNob3dDbGFzc2VzIHx8IHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgICAgICAgICAKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiZWZmZWN0c0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd0VmZmVjdHMgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiZWZmZWN0c0JhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd0VmZmVjdHMgJiYgKHNob3dDb25zdGFudHMgfHwgc2hvd1BhY2thZ2VDb25zdGFudHMgfHwgc2hvd0ludGVyZmFjZXMgfHwgc2hvd0NsYXNzZXMgfHwgc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiY29uc3RhbnRzTGluayIpLnN0eWxlLmRpc3BsYXkgPSBzaG93Q29uc3RhbnRzID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoImNvbnN0YW50c0JhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd0NvbnN0YW50cyAmJiAoc2hvd1BhY2thZ2VDb25zdGFudHMgfHwgc2hvd0ludGVyZmFjZXMgfHwgc2hvd0NsYXNzZXMgfHwgc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgicGFja2FnZUNvbnN0YW50c0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd1BhY2thZ2VDb25zdGFudHMgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgicGFja2FnZUNvbnN0YW50c0JhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd1BhY2thZ2VDb25zdGFudHMgJiYgKHNob3dJbnRlcmZhY2VzIHx8IHNob3dDbGFzc2VzIHx8IHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoImludGVyZmFjZXNMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dJbnRlcmZhY2VzID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoImludGVyZmFjZXNCYXIiKS5zdHlsZS5kaXNwbGF5ID0gKHNob3dJbnRlcmZhY2VzICYmIChzaG93Q2xhc3NlcyB8fCBzaG93UGFja2FnZVVzZSB8fCBzaG93RXhhbXBsZXMpKSA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJjbGFzc2VzTGluayIpLnN0eWxlLmRpc3BsYXkgPSBzaG93Q2xhc3NlcyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJjbGFzc2VzQmFyIikuc3R5bGUuZGlzcGxheSA9IChzaG93Q2xhc3NlcyAmJiAoc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgicGFja2FnZVVzZUxpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd1BhY2thZ2VVc2UgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgicGFja2FnZVVzZUJhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd1BhY2thZ2VVc2UgJiYgc2hvd0V4YW1wbGVzKSA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJleGFtcGxlc0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd0V4YW1wbGVzID8gImlubGluZSIgOiAibm9uZSI7CiAgICB9Cn0KZnVuY3Rpb24gdGl0bGVCYXJfZ290b0NsYXNzRnJhbWVBbmNob3IoYW5jaG9yKQp7CiAgICBpZiAoaXNFY2xpcHNlKCkpCiAgICAgICAgcGFyZW50LmNsYXNzRnJhbWUubG9jYXRpb24gPSBwYXJlbnQuY2xhc3NGcmFtZS5sb2NhdGlvbi50b1N0cmluZygpLnNwbGl0KCcjJylbMF0gKyAiIyIgKyBhbmNob3I7CiAgICBlbHNlCiAgICAgICAgdG9wLmNsYXNzRnJhbWUubG9jYXRpb24gPSB0b3AuY2xhc3NGcmFtZS5sb2NhdGlvbi50b1N0cmluZygpLnNwbGl0KCcjJylbMF0gKyAiIyIgKyBhbmNob3I7Cn0KZnVuY3Rpb24gc2V0TVhNTE9ubHkoKSAKewogICAgaWYgKGdldENvb2tpZSgic2hvd01YTUwiKSA9PSAiZmFsc2UiKQogICAgewogICAgICAgIHRvZ2dsZU1YTUxPbmx5KCk7CiAgICB9Cn0KZnVuY3Rpb24gdG9nZ2xlTVhNTE9ubHkoKSAKewogICAgdmFyIG14bWxEaXYgPSBmaW5kT2JqZWN0KCJteG1sU3ludGF4Iik7CiAgICB2YXIgbXhtbFNob3dMaW5rID0gZmluZE9iamVjdCgic2hvd014bWxMaW5rIik7CiAgICB2YXIgbXhtbEhpZGVMaW5rID0gZmluZE9iamVjdCgiaGlkZU14bWxMaW5rIik7CiAgICBpZiAobXhtbERpdiAmJiBteG1sU2hvd0xpbmsgJiYgbXhtbEhpZGVMaW5rKQogICAgewogICAgICAgIGlmIChteG1sRGl2LnN0eWxlLmRpc3BsYXkgPT0gIm5vbmUiKQogICAgICAgIHsKICAgICAgICAgICAgbXhtbERpdi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgICAgbXhtbFNob3dMaW5rLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgIG14bWxIaWRlTGluay5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CiAgICAgICAgICAgIHNldENvb2tpZSgic2hvd01YTUwiLCJ0cnVlIiwgbmV3IERhdGUoMzAwMCwxLDEsMSwxKSwgIi8iLCBkb2N1bWVudC5sb2NhdGlvbi5kb21haW4pOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBteG1sRGl2LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICAgIG14bWxTaG93TGluay5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7CiAgICAgICAgICAgIG14bWxIaWRlTGluay5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICBzZXRDb29raWUoInNob3dNWE1MIiwiZmFsc2UiLCBuZXcgRGF0ZSgzMDAwLDEsMSwxLDEpLCAiLyIsIGRvY3VtZW50LmxvY2F0aW9uLmRvbWFpbik7CiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIHNob3dIaWRlSW5oZXJpdGVkKCkKeyAgIAogICAgc2V0SW5oZXJpdGVkVmlzaWJsZShnZXRDb29raWUoInNob3dJbmhlcml0ZWRDb25zdGFudCIpID09ICJ0cnVlIiwgIkNvbnN0YW50Iik7CiAgICBzZXRJbmhlcml0ZWRWaXNpYmxlKGdldENvb2tpZSgic2hvd0luaGVyaXRlZFByb3RlY3RlZENvbnN0YW50IikgPT0gInRydWUiLCAiUHJvdGVjdGVkQ29uc3RhbnQiKTsKICAgIHNldEluaGVyaXRlZFZpc2libGUoZ2V0Q29va2llKCJzaG93SW5oZXJpdGVkUHJvcGVydHkiKSA9PSAidHJ1ZSIsICJQcm9wZXJ0eSIpOwogICAgc2V0SW5oZXJpdGVkVmlzaWJsZShnZXRDb29raWUoInNob3dJbmhlcml0ZWRQcm90ZWN0ZWRQcm9wZXJ0eSIpID09ICJ0cnVlIiwgIlByb3RlY3RlZFByb3BlcnR5Iik7CiAgICBzZXRJbmhlcml0ZWRWaXNpYmxlKGdldENvb2tpZSgic2hvd0luaGVyaXRlZE1ldGhvZCIpID09ICJ0cnVlIiwgIk1ldGhvZCIpOwogICAgc2V0SW5oZXJpdGVkVmlzaWJsZShnZXRDb29raWUoInNob3dJbmhlcml0ZWRQcm90ZWN0ZWRNZXRob2QiKSA9PSAidHJ1ZSIsICJQcm90ZWN0ZWRNZXRob2QiKTsKICAgIHNldEluaGVyaXRlZFZpc2libGUoZ2V0Q29va2llKCJzaG93SW5oZXJpdGVkRXZlbnQiKSA9PSAidHJ1ZSIsICJFdmVudCIpOwogICAgc2V0SW5oZXJpdGVkVmlzaWJsZShnZXRDb29raWUoInNob3dJbmhlcml0ZWRTdHlsZSIpID09ICJ0cnVlIiwgIlN0eWxlIik7CiAgICAKICAgIHNldEluaGVyaXRlZFZpc2libGUoZ2V0Q29va2llKCJzaG93SW5oZXJpdGVkU2tpblBhcnQiKSA9PSAidHJ1ZSIsICJTa2luUGFydCIpOwogICAgc2V0SW5oZXJpdGVkVmlzaWJsZShnZXRDb29raWUoInNob3dJbmhlcml0ZWRTa2luU3RhdGUiKSA9PSAidHJ1ZSIsICJTa2luU3RhdGUiKTsKICAgIAogICAgc2V0SW5oZXJpdGVkVmlzaWJsZShnZXRDb29raWUoInNob3dJbmhlcml0ZWRFZmZlY3QiKSA9PSAidHJ1ZSIsICJFZmZlY3QiKTsKfQpmdW5jdGlvbiBzZXRJbmhlcml0ZWRWaXNpYmxlKHNob3csIHNlbGVjdG9yVGV4dCkKewogICAgaWYgKGRvY3VtZW50LnN0eWxlU2hlZXRzWzBdLmNzc1J1bGVzICE9IHVuZGVmaW5lZCkKICAgIHsKICAgICAgICB2YXIgcnVsZXMgPSBkb2N1bWVudC5zdHlsZVNoZWV0c1swXS5jc3NSdWxlczsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ1bGVzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHJ1bGVzW2ldLnNlbGVjdG9yVGV4dCA9PSAiLmhpZGVJbmhlcml0ZWQiICsgc2VsZWN0b3JUZXh0KQogICAgICAgICAgICAgICAgcnVsZXNbaV0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyAiIiA6ICJub25lIjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocnVsZXNbaV0uc2VsZWN0b3JUZXh0ID09ICIuc2hvd0luaGVyaXRlZCIgKyBzZWxlY3RvclRleHQpCiAgICAgICAgICAgICAgICBydWxlc1tpXS5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/ICJub25lIiA6ICIiOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgICBkb2N1bWVudC5zdHlsZVNoZWV0c1swXS5hZGRSdWxlKCIuaGlkZUluaGVyaXRlZCIgKyBzZWxlY3RvclRleHQsIHNob3cgPyAiZGlzcGxheTppbmxpbmUiIDogImRpc3BsYXk6bm9uZSIpOwogICAgICAgIGRvY3VtZW50LnN0eWxlU2hlZXRzWzBdLmFkZFJ1bGUoIi5zaG93SW5oZXJpdGVkIiArIHNlbGVjdG9yVGV4dCwgc2hvdyA/ICJkaXNwbGF5Om5vbmUiIDogImRpc3BsYXk6aW5saW5lIik7CiAgICB9CiAgICBzZXRDb29raWUoInNob3dJbmhlcml0ZWQiICsgc2VsZWN0b3JUZXh0LCBzaG93ID8gInRydWUiIDogImZhbHNlIiwgbmV3IERhdGUoMzAwMCwxLDEsMSwxKSwgIi8iLCBkb2N1bWVudC5sb2NhdGlvbi5kb21haW4pOwogICAgc2V0Um93Q29sb3JzKHNob3csIHNlbGVjdG9yVGV4dCk7Cn0KZnVuY3Rpb24gc2V0Um93Q29sb3JzKHNob3csIHNlbGVjdG9yVGV4dCkKewogICAgdmFyIHJvd0NvbG9yID0gIiNGMkYyRjIiOwogICAgdmFyIHRhYmxlID0gZmluZE9iamVjdCgic3VtbWFyeVRhYmxlIiArIHNlbGVjdG9yVGV4dCk7CiAgICBpZiAodGFibGUgIT0gbnVsbCkKICAgIHsKICAgICAgICB2YXIgcm93TnVtID0gMDsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRhYmxlLnJvd3MubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAodGFibGUucm93c1tpXS5jbGFzc05hbWUuaW5kZXhPZigiaGlkZUluaGVyaXRlZCIpID09IC0xIHx8IHNob3cpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJvd051bSsrOwogICAgICAgICAgICAgICAgdGFibGUucm93c1tpXS5iZ0NvbG9yID0gKHJvd051bSAlIDIgPT0gMCkgPyByb3dDb2xvciA6ICIjRkZGRkZGIjsKICAgICAgICAgICAgfSAgICAgICAgICAgCiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIHNldFJvd0NvbG9yc0luaXRpYWwoc2hvdywgc2VsZWN0b3JUZXh0KQp7CiAgICB2YXIgcm93Q29sb3IgPSAiI0YyRjJGMiI7CiAgICB2YXIgdGFibGUgPSBmaW5kT2JqZWN0KCJzdW1tYXJ5VGFibGUiICsgc2VsZWN0b3JUZXh0KTsKICAgIGlmICh0YWJsZSAhPSBudWxsKQogICAgewogICAgICAgIHZhciByb3dOdW0gPSAwOwogICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGFibGUucm93cy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmICh0YWJsZS5yb3dzW2ldLmNsYXNzTmFtZS5pbmRleE9mKCJoaWRlSW5oZXJpdGVkIikgPT0gLTEgJiYgc2hvdykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcm93TnVtKys7CiAgICAgICAgICAgICAgICB0YWJsZS5yb3dzW2ldLmJnQ29sb3IgPSAocm93TnVtICUgMiA9PSAwKSA/IHJvd0NvbG9yIDogIiNGRkZGRkYiOwogICAgICAgICAgICB9ICAgICAgICAgICAKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gc2V0U3R5bGUoc2VsZWN0b3JUZXh0LCBzdHlsZU5hbWUsIG5ld1ZhbHVlKQp7CiAgICBpZiAoZG9jdW1lbnQuc3R5bGVTaGVldHNbMF0uY3NzUnVsZXMgIT0gdW5kZWZpbmVkKQogICAgewogICAgICAgIHZhciBydWxlcyA9IGRvY3VtZW50LnN0eWxlU2hlZXRzWzBdLmNzc1J1bGVzOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcnVsZXMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAocnVsZXNbaV0uc2VsZWN0b3JUZXh0ID09IHNlbGVjdG9yVGV4dCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcnVsZXNbaV0uc3R5bGVbc3R5bGVOYW1lXSA9IG5ld1ZhbHVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZG9jdW1lbnQuc3R5bGVTaGVldHNbMF0uYWRkUnVsZShzZWxlY3RvclRleHQsIHN0eWxlTmFtZSArICI6IiArIG5ld1ZhbHVlKTsKICAgIH0KfQo=",
                "body": "Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8KLy8gIEFET0JFIFNZU1RFTVMgSU5DT1JQT1JBVEVECi8vICBDb3B5cmlnaHQgMjAwNi0yMDA4IEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkCi8vICBBbGwgUmlnaHRzIFJlc2VydmVkLgovLwovLyAgTk9USUNFOiBBZG9iZSBwZXJtaXRzIHlvdSB0byB1c2UsIG1vZGlmeSwgYW5kIGRpc3RyaWJ1dGUgdGhpcyBmaWxlCi8vICBpbiBhY2NvcmRhbmNlIHdpdGggdGhlIHRlcm1zIG9mIHRoZSBsaWNlbnNlIGFncmVlbWVudCBhY2NvbXBhbnlpbmcgaXQuCi8vCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCnZhciBFQ0xJUFNFX0ZSQU1FX05BTUUgPSAiQ29udGVudFZpZXdGcmFtZSI7CnZhciBlY2xpcHNlQnVpbGQgPSBmYWxzZTsKdmFyIGxpdmVEb2NzQmFzZVVybCA9ICJodHRwOi8vbGl2ZWRvY3MuYWRvYmUuY29tL2ZsZXgvMyI7CnZhciBsaXZlRG9jc0Jvb2tOYW1lID0gImxhbmdyZWYiOwpmdW5jdGlvbiBmaW5kT2JqZWN0KG9iaklkKSB7CiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQpCiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9iaklkKTsKICAgIGlmIChkb2N1bWVudC5hbGwpCiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmFsbFtvYmpJZF07Cn0KZnVuY3Rpb24gaXNFY2xpcHNlKCkgewogICAgcmV0dXJuIGVjbGlwc2VCdWlsZDsKLy8gIHJldHVybiAod2luZG93Lm5hbWUgPT0gRUNMSVBTRV9GUkFNRV9OQU1FKSB8fCAocGFyZW50Lm5hbWUgPT0gRUNMSVBTRV9GUkFNRV9OQU1FKSB8fCAocGFyZW50LnBhcmVudC5uYW1lID09IEVDTElQU0VfRlJBTUVfTkFNRSk7Cn0KZnVuY3Rpb24gY29uZmlnUGFnZSgpIHsKICAgIHNldFJvd0NvbG9yc0luaXRpYWwodHJ1ZSwgIlByb3BlcnR5Iik7CiAgICBzZXRSb3dDb2xvcnNJbml0aWFsKHRydWUsICJNZXRob2QiKTsKICAgIHNldFJvd0NvbG9yc0luaXRpYWwodHJ1ZSwgIlByb3RlY3RlZE1ldGhvZCIpOyAgIAogICAgc2V0Um93Q29sb3JzSW5pdGlhbCh0cnVlLCAiRXZlbnQiKTsKICAgIHNldFJvd0NvbG9yc0luaXRpYWwodHJ1ZSwgIlN0eWxlIik7CiAgICAKICAgIHNldFJvd0NvbG9yc0luaXRpYWwodHJ1ZSwgIlNraW5QYXJ0Iik7CiAgICBzZXRSb3dDb2xvcnNJbml0aWFsKHRydWUsICJTa2luU3RhdGUiKTsKICAgIAogICAgc2V0Um93Q29sb3JzSW5pdGlhbCh0cnVlLCAiQ29uc3RhbnQiKTsKICAgIGlmIChpc0VjbGlwc2UoKSkgewogICAgICAgIGlmICh3aW5kb3cubmFtZSAhPSAiY2xhc3NGcmFtZSIpCiAgICAgICAgewogICAgICAgICAgICB2YXIgbG9jYWxSZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCc/JykgIT0gLTEgPyB3aW5kb3cubG9jYXRpb24uaHJlZi5zdWJzdHJpbmcoMCwgd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignPycpKSA6IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgICBsb2NhbFJlZiA9IGxvY2FsUmVmLnN1YnN0cmluZyhsb2NhbFJlZi5pbmRleE9mKCJsYW5ncmVmLyIpICsgOCk7CiAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uc2VhcmNoICE9ICIiKQogICAgICAgICAgICAgICAgbG9jYWxSZWYgKz0gKCIjIiArIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpKTsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoYmFzZVJlZiArICJpbmRleC5odG1sPyIgKyBsb2NhbFJlZik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgc2V0U3R5bGUoIi5lY2xpcHNlQm9keSIsICJkaXNwbGF5IiwgImJsb2NrIik7Ci8vICAgICAgICAgIHZhciBpc0lFICA9IChuYXZpZ2F0b3IuYXBwVmVyc2lvbi5pbmRleE9mKCJNU0lFIikgIT0gLTEpID8gdHJ1ZSA6IGZhbHNlOwovLyAgICAgICAgICBpZiAoaXNJRSA9PSBmYWxzZSAmJiB3aW5kb3cubG9jYXRpb24uaGFzaCAhPSAiIikKICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5oYXNoICE9ICIiKQogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2g9d2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyaW5nKDEpOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgaWYgKHdpbmRvdyA9PSB0b3ApIHsgLy8gbm8gZnJhbWVzCiAgICAgICAgZmluZE9iamVjdCgidGl0bGVUYWJsZSIpLnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgIH0KICAgIGVsc2UgeyAvLyBmcmFtZXMKICAgICAgICBmaW5kT2JqZWN0KCJ0aXRsZVRhYmxlIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgIH0KICAgIHNob3dUaXRsZShhc2RvY1RpdGxlKTsKfQpmdW5jdGlvbiBsb2FkRnJhbWVzKGNsYXNzRnJhbWVVUkwsIGNsYXNzTGlzdEZyYW1lVVJMKSB7CiAgICB2YXIgY2xhc3NMaXN0RnJhbWUgPSBmaW5kT2JqZWN0KCJjbGFzc0xpc3RGcmFtZSIpOwogICAgaWYoY2xhc3NMaXN0RnJhbWUgIT0gbnVsbCAmJiBjbGFzc0xpc3RGcmFtZUNvbnRlbnQhPScnKQogICAgICAgIGNsYXNzTGlzdEZyYW1lLmRvY3VtZW50LmxvY2F0aW9uLmhyZWY9Y2xhc3NMaXN0RnJhbWVDb250ZW50OwogICAgaWYgKGlzRWNsaXBzZSgpKSB7CiAgICAgICAgdmFyIGNvbnRlbnRWaWV3RnJhbWUgPSBmaW5kT2JqZWN0KEVDTElQU0VfRlJBTUVfTkFNRSk7CiAgICAgICAgaWYgKGNvbnRlbnRWaWV3RnJhbWUgIT0gbnVsbCAmJiBjbGFzc0ZyYW1lVVJMICE9ICcnKQogICAgICAgICAgICBjb250ZW50Vmlld0ZyYW1lLmRvY3VtZW50LmxvY2F0aW9uLmhyZWY9Y2xhc3NGcmFtZVVSTDsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHZhciBjbGFzc0ZyYW1lID0gZmluZE9iamVjdCgiY2xhc3NGcmFtZSIpOwogICAgICAgIGlmKGNsYXNzRnJhbWUgIT0gbnVsbCAmJiBjbGFzc0ZyYW1lQ29udGVudCE9JycpCiAgICAgICAgICAgIGNsYXNzRnJhbWUuZG9jdW1lbnQubG9jYXRpb24uaHJlZj1jbGFzc0ZyYW1lQ29udGVudDsKICAgIH0KfQpmdW5jdGlvbiBzaG93VGl0bGUodGl0bGUpIHsKICAgIGlmICghaXNFY2xpcHNlKCkpCiAgICAgICAgdG9wLmRvY3VtZW50LnRpdGxlID0gdGl0bGU7Cn0KZnVuY3Rpb24gbG9hZENsYXNzTGlzdEZyYW1lKGNsYXNzTGlzdEZyYW1lVVJMKSB7CiAgICBpZiAocGFyZW50LmZyYW1lc1siY2xhc3NMaXN0RnJhbWUiXSAhPSBudWxsKSB7CiAgICAgICAgcGFyZW50LmZyYW1lc1siY2xhc3NMaXN0RnJhbWUiXS5sb2NhdGlvbiA9IGNsYXNzTGlzdEZyYW1lVVJMOwogICAgfQogICAgZWxzZSBpZiAocGFyZW50LmZyYW1lc1sicGFja2FnZUZyYW1lIl0gIT0gbnVsbCkgewogICAgICAgIGlmIChwYXJlbnQuZnJhbWVzWyJwYWNrYWdlRnJhbWUiXS5mcmFtZXNbImNsYXNzTGlzdEZyYW1lIl0gIT0gbnVsbCkgewogICAgICAgICAgICBwYXJlbnQuZnJhbWVzWyJwYWNrYWdlRnJhbWUiXS5mcmFtZXNbImNsYXNzTGlzdEZyYW1lIl0ubG9jYXRpb24gPSBjbGFzc0xpc3RGcmFtZVVSTDsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gZ290b0xpdmVEb2NzKHByaW1hcnlVUkwsIHNlY29uZGFyeVVSTCwgbG9jYWxlKSB7CiAgICAgICAgaWYgKGxvY2FsZSA9PSAiZW4tdXMiKSB7CiAgICAgICAgICAgICBsb2NhbGUgPSAiIjsKICAgICAgICB9IAogICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGxvY2FsZSA9ICJfIiArIGxvY2FsZS5zdWJzdHJpbmcoMyk7CiAgICAgICAgfQogICAgdmFyIHVybCA9IGxpdmVEb2NzQmFzZVVybCArIGxvY2FsZSArICIvIiArIGxpdmVEb2NzQm9va05hbWUgKyAiL2luZGV4Lmh0bWw/IiArIHByaW1hcnlVUkw7CiAgICBpZiAoc2Vjb25kYXJ5VVJMICE9IG51bGwgJiYgc2Vjb25kYXJ5VVJMICE9ICIiKQogICAgICAgIHVybCArPSAoIiYiICsgc2Vjb25kYXJ5VVJMKTsKICAgIHdpbmRvdy5vcGVuKHVybCwgIm1tX2xpdmVkb2NzIiwgIm1lbnViYXI9MSx0b29sYmFyPTEsc3RhdHVzPTEsc2Nyb2xsYmFycz0xLHJlc2l6YWJsZT15ZXMiKTsKfQpmdW5jdGlvbiBmaW5kVGl0bGVUYWJsZU9iamVjdChpZCkKewogICAgaWYgKGlzRWNsaXBzZSgpKQogICAgICAgIHJldHVybiBwYXJlbnQudGl0bGViYXIuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgZWxzZSBpZiAodG9wLnRpdGxlYmFyKQogICAgICAgIHJldHVybiB0b3AudGl0bGViYXIuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgZWxzZQogICAgICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7Cn0KZnVuY3Rpb24gdGl0bGVCYXJfc2V0U3ViVGl0bGUodGl0bGUpCnsKICAgIGlmIChpc0VjbGlwc2UoKSB8fCB0b3AudGl0bGViYXIpCiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoInN1YlRpdGxlIikuY2hpbGROb2Rlcy5pdGVtKDApLmRhdGEgPSB0aXRsZTsKfQpmdW5jdGlvbiB0aXRsZUJhcl9zZXRTdWJOYXYoc2hvd0NvbnN0YW50cyxzaG93UHJvcGVydGllcyxzaG93U3R5bGVzLHNob3dTa2luUGFydCxzaG93U2tpblN0YXRlLHNob3dFZmZlY3RzLHNob3dFdmVudHMsc2hvd0NvbnN0cnVjdG9yLHNob3dNZXRob2RzLHNob3dFeGFtcGxlcywKICAgICAgICAgICAgICAgIHNob3dQYWNrYWdlQ29uc3RhbnRzLHNob3dQYWNrYWdlUHJvcGVydGllcyxzaG93UGFja2FnZUZ1bmN0aW9ucyxzaG93SW50ZXJmYWNlcyxzaG93Q2xhc3NlcyxzaG93UGFja2FnZVVzZSkKewogICAgaWYgKGlzRWNsaXBzZSgpIHx8IHRvcC50aXRsZWJhcikKICAgIHsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgicHJvcGVydGllc0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd1Byb3BlcnRpZXMgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgicHJvcGVydGllc0JhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd1Byb3BlcnRpZXMgJiYgKHNob3dQYWNrYWdlUHJvcGVydGllcyB8fCBzaG93Q29uc3RydWN0b3IgfHwgc2hvd01ldGhvZHMgfHwgc2hvd1BhY2thZ2VGdW5jdGlvbnMgfHwgc2hvd0V2ZW50cyB8fCBzaG93U3R5bGVzIHx8IHNob3dTa2luUGFydCB8fCBzaG93U2tpblN0YXRlIHx8IHNob3dFZmZlY3RzIHx8IHNob3dDb25zdGFudHMgfHwgc2hvd1BhY2thZ2VDb25zdGFudHMgfHwgc2hvd0ludGVyZmFjZXMgfHwgc2hvd0NsYXNzZXMgfHwgc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgicGFja2FnZVByb3BlcnRpZXNMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dQYWNrYWdlUHJvcGVydGllcyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJwYWNrYWdlUHJvcGVydGllc0JhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd1BhY2thZ2VQcm9wZXJ0aWVzICYmIChzaG93Q29uc3RydWN0b3IgfHwgc2hvd01ldGhvZHMgfHwgc2hvd1BhY2thZ2VGdW5jdGlvbnMgfHwgc2hvd0V2ZW50cyB8fCBzaG93U3R5bGVzIHx8IHNob3dTa2luUGFydCB8fCBzaG93U2tpblN0YXRlIHx8IHNob3dDb25zdGFudHMgfHwgc2hvd0VmZmVjdHMgfHwgc2hvd1BhY2thZ2VDb25zdGFudHMgfHwgc2hvd0ludGVyZmFjZXMgfHwgc2hvd0NsYXNzZXMgfHwgc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiY29uc3RydWN0b3JMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dDb25zdHJ1Y3RvciA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJjb25zdHJ1Y3RvckJhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd0NvbnN0cnVjdG9yICYmIChzaG93TWV0aG9kcyB8fCBzaG93UGFja2FnZUZ1bmN0aW9ucyB8fCBzaG93RXZlbnRzIHx8IHNob3dTdHlsZXMgfHwgc2hvd1NraW5QYXJ0IHx8IHNob3dTa2luU3RhdGUgfHwgc2hvd0VmZmVjdHMgfHwgc2hvd0NvbnN0YW50cyB8fCBzaG93UGFja2FnZUNvbnN0YW50cyB8fCBzaG93SW50ZXJmYWNlcyB8fCBzaG93Q2xhc3NlcyB8fCBzaG93UGFja2FnZVVzZSB8fCBzaG93RXhhbXBsZXMpKSA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJtZXRob2RzTGluayIpLnN0eWxlLmRpc3BsYXkgPSBzaG93TWV0aG9kcyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJtZXRob2RzQmFyIikuc3R5bGUuZGlzcGxheSA9IChzaG93TWV0aG9kcyAmJiAoc2hvd1BhY2thZ2VGdW5jdGlvbnMgfHwgc2hvd0V2ZW50cyB8fCBzaG93U3R5bGVzIHx8IHNob3dTa2luUGFydCB8fCBzaG93U2tpblN0YXRlIHx8IHNob3dFZmZlY3RzIHx8IHNob3dDb25zdGFudHMgfHwgc2hvd1BhY2thZ2VDb25zdGFudHMgfHwgc2hvd0ludGVyZmFjZXMgfHwgc2hvd0NsYXNzZXMgfHwgc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgicGFja2FnZUZ1bmN0aW9uc0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd1BhY2thZ2VGdW5jdGlvbnMgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgicGFja2FnZUZ1bmN0aW9uc0JhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd1BhY2thZ2VGdW5jdGlvbnMgJiYgKHNob3dFdmVudHMgfHwgc2hvd1N0eWxlcyB8fCBzaG93U2tpblBhcnQgfHwgc2hvd1NraW5TdGF0ZSB8fCBzaG93RWZmZWN0cyB8fCBzaG93Q29uc3RhbnRzIHx8IHNob3dQYWNrYWdlQ29uc3RhbnRzIHx8IHNob3dJbnRlcmZhY2VzIHx8IHNob3dDbGFzc2VzIHx8IHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoImV2ZW50c0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd0V2ZW50cyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJldmVudHNCYXIiKS5zdHlsZS5kaXNwbGF5ID0gKHNob3dFdmVudHMgJiYgKHNob3dTdHlsZXMgfHwgc2hvd1NraW5QYXJ0IHx8IHNob3dTa2luU3RhdGUgfHwgc2hvd0VmZmVjdHMgfHwgc2hvd0NvbnN0YW50cyB8fCBzaG93UGFja2FnZUNvbnN0YW50cyB8fCBzaG93SW50ZXJmYWNlcyB8fCBzaG93Q2xhc3NlcyB8fCBzaG93UGFja2FnZVVzZSB8fCBzaG93RXhhbXBsZXMpKSA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJzdHlsZXNMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dTdHlsZXMgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgic3R5bGVzQmFyIikuc3R5bGUuZGlzcGxheSA9IChzaG93U3R5bGVzICYmIChzaG93U2tpblBhcnQgfHwgc2hvd1NraW5TdGF0ZSB8fCBzaG93RWZmZWN0cyB8fCBzaG93Q29uc3RhbnRzIHx8IHNob3dQYWNrYWdlQ29uc3RhbnRzIHx8IHNob3dJbnRlcmZhY2VzIHx8IHNob3dDbGFzc2VzIHx8IHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgCiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoIlNraW5QYXJ0TGluayIpLnN0eWxlLmRpc3BsYXkgPSBzaG93U2tpblBhcnQgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiU2tpblBhcnRCYXIiKS5zdHlsZS5kaXNwbGF5ID0gKHNob3dTa2luUGFydCAmJiAoc2hvd1NraW5TdGF0ZSB8fCBzaG93RWZmZWN0cyB8fCBzaG93Q29uc3RhbnRzIHx8IHNob3dQYWNrYWdlQ29uc3RhbnRzIHx8IHNob3dJbnRlcmZhY2VzIHx8IHNob3dDbGFzc2VzIHx8IHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgCiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoIlNraW5TdGF0ZUxpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd1NraW5TdGF0ZSA/ICJpbmxpbmUiIDogIm5vbmUiOwoJZmluZFRpdGxlVGFibGVPYmplY3QoIlNraW5TdGF0ZUJhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd1NraW5TdGF0ZSAmJiAoc2hvd0VmZmVjdHMgfHwgc2hvd0NvbnN0YW50cyB8fCBzaG93UGFja2FnZUNvbnN0YW50cyB8fCBzaG93SW50ZXJmYWNlcyB8fCBzaG93Q2xhc3NlcyB8fCBzaG93UGFja2FnZVVzZSB8fCBzaG93RXhhbXBsZXMpKSA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgICAgICAgICAgCiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoImVmZmVjdHNMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dFZmZlY3RzID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoImVmZmVjdHNCYXIiKS5zdHlsZS5kaXNwbGF5ID0gKHNob3dFZmZlY3RzICYmIChzaG93Q29uc3RhbnRzIHx8IHNob3dQYWNrYWdlQ29uc3RhbnRzIHx8IHNob3dJbnRlcmZhY2VzIHx8IHNob3dDbGFzc2VzIHx8IHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoImNvbnN0YW50c0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd0NvbnN0YW50cyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJjb25zdGFudHNCYXIiKS5zdHlsZS5kaXNwbGF5ID0gKHNob3dDb25zdGFudHMgJiYgKHNob3dQYWNrYWdlQ29uc3RhbnRzIHx8IHNob3dJbnRlcmZhY2VzIHx8IHNob3dDbGFzc2VzIHx8IHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoInBhY2thZ2VDb25zdGFudHNMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dQYWNrYWdlQ29uc3RhbnRzID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoInBhY2thZ2VDb25zdGFudHNCYXIiKS5zdHlsZS5kaXNwbGF5ID0gKHNob3dQYWNrYWdlQ29uc3RhbnRzICYmIChzaG93SW50ZXJmYWNlcyB8fCBzaG93Q2xhc3NlcyB8fCBzaG93UGFja2FnZVVzZSB8fCBzaG93RXhhbXBsZXMpKSA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJpbnRlcmZhY2VzTGluayIpLnN0eWxlLmRpc3BsYXkgPSBzaG93SW50ZXJmYWNlcyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgICAgIGZpbmRUaXRsZVRhYmxlT2JqZWN0KCJpbnRlcmZhY2VzQmFyIikuc3R5bGUuZGlzcGxheSA9IChzaG93SW50ZXJmYWNlcyAmJiAoc2hvd0NsYXNzZXMgfHwgc2hvd1BhY2thZ2VVc2UgfHwgc2hvd0V4YW1wbGVzKSkgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiY2xhc3Nlc0xpbmsiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd0NsYXNzZXMgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiY2xhc3Nlc0JhciIpLnN0eWxlLmRpc3BsYXkgPSAoc2hvd0NsYXNzZXMgJiYgKHNob3dQYWNrYWdlVXNlIHx8IHNob3dFeGFtcGxlcykpID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoInBhY2thZ2VVc2VMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dQYWNrYWdlVXNlID8gImlubGluZSIgOiAibm9uZSI7CiAgICAgICAgZmluZFRpdGxlVGFibGVPYmplY3QoInBhY2thZ2VVc2VCYXIiKS5zdHlsZS5kaXNwbGF5ID0gKHNob3dQYWNrYWdlVXNlICYmIHNob3dFeGFtcGxlcykgPyAiaW5saW5lIiA6ICJub25lIjsKICAgICAgICBmaW5kVGl0bGVUYWJsZU9iamVjdCgiZXhhbXBsZXNMaW5rIikuc3R5bGUuZGlzcGxheSA9IHNob3dFeGFtcGxlcyA/ICJpbmxpbmUiIDogIm5vbmUiOwogICAgfQp9CmZ1bmN0aW9uIHRpdGxlQmFyX2dvdG9DbGFzc0ZyYW1lQW5jaG9yKGFuY2hvcikKewogICAgaWYgKGlzRWNsaXBzZSgpKQogICAgICAgIHBhcmVudC5jbGFzc0ZyYW1lLmxvY2F0aW9uID0gcGFyZW50LmNsYXNzRnJhbWUubG9jYXRpb24udG9TdHJpbmcoKS5zcGxpdCgnIycpWzBdICsgIiMiICsgYW5jaG9yOwogICAgZWxzZQogICAgICAgIHRvcC5jbGFzc0ZyYW1lLmxvY2F0aW9uID0gdG9wLmNsYXNzRnJhbWUubG9jYXRpb24udG9TdHJpbmcoKS5zcGxpdCgnIycpWzBdICsgIiMiICsgYW5jaG9yOwp9CmZ1bmN0aW9uIHNldE1YTUxPbmx5KCkgCnsKICAgIGlmIChnZXRDb29raWUoInNob3dNWE1MIikgPT0gImZhbHNlIikKICAgIHsKICAgICAgICB0b2dnbGVNWE1MT25seSgpOwogICAgfQp9CmZ1bmN0aW9uIHRvZ2dsZU1YTUxPbmx5KCkgCnsKICAgIHZhciBteG1sRGl2ID0gZmluZE9iamVjdCgibXhtbFN5bnRheCIpOwogICAgdmFyIG14bWxTaG93TGluayA9IGZpbmRPYmplY3QoInNob3dNeG1sTGluayIpOwogICAgdmFyIG14bWxIaWRlTGluayA9IGZpbmRPYmplY3QoImhpZGVNeG1sTGluayIpOwogICAgaWYgKG14bWxEaXYgJiYgbXhtbFNob3dMaW5rICYmIG14bWxIaWRlTGluaykKICAgIHsKICAgICAgICBpZiAobXhtbERpdi5zdHlsZS5kaXNwbGF5ID09ICJub25lIikKICAgICAgICB7CiAgICAgICAgICAgIG14bWxEaXYuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgIG14bWxTaG93TGluay5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICBteG1sSGlkZUxpbmsuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwogICAgICAgICAgICBzZXRDb29raWUoInNob3dNWE1MIiwidHJ1ZSIsIG5ldyBEYXRlKDMwMDAsMSwxLDEsMSksICIvIiwgZG9jdW1lbnQubG9jYXRpb24uZG9tYWluKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgbXhtbERpdi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICBteG1sU2hvd0xpbmsuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOwogICAgICAgICAgICBteG1sSGlkZUxpbmsuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgc2V0Q29va2llKCJzaG93TVhNTCIsImZhbHNlIiwgbmV3IERhdGUoMzAwMCwxLDEsMSwxKSwgIi8iLCBkb2N1bWVudC5sb2NhdGlvbi5kb21haW4pOwogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBzaG93SGlkZUluaGVyaXRlZCgpCnsgICAKICAgIHNldEluaGVyaXRlZFZpc2libGUoZ2V0Q29va2llKCJzaG93SW5oZXJpdGVkQ29uc3RhbnQiKSA9PSAidHJ1ZSIsICJDb25zdGFudCIpOwogICAgc2V0SW5oZXJpdGVkVmlzaWJsZShnZXRDb29raWUoInNob3dJbmhlcml0ZWRQcm90ZWN0ZWRDb25zdGFudCIpID09ICJ0cnVlIiwgIlByb3RlY3RlZENvbnN0YW50Iik7CiAgICBzZXRJbmhlcml0ZWRWaXNpYmxlKGdldENvb2tpZSgic2hvd0luaGVyaXRlZFByb3BlcnR5IikgPT0gInRydWUiLCAiUHJvcGVydHkiKTsKICAgIHNldEluaGVyaXRlZFZpc2libGUoZ2V0Q29va2llKCJzaG93SW5oZXJpdGVkUHJvdGVjdGVkUHJvcGVydHkiKSA9PSAidHJ1ZSIsICJQcm90ZWN0ZWRQcm9wZXJ0eSIpOwogICAgc2V0SW5oZXJpdGVkVmlzaWJsZShnZXRDb29raWUoInNob3dJbmhlcml0ZWRNZXRob2QiKSA9PSAidHJ1ZSIsICJNZXRob2QiKTsKICAgIHNldEluaGVyaXRlZFZpc2libGUoZ2V0Q29va2llKCJzaG93SW5oZXJpdGVkUHJvdGVjdGVkTWV0aG9kIikgPT0gInRydWUiLCAiUHJvdGVjdGVkTWV0aG9kIik7CiAgICBzZXRJbmhlcml0ZWRWaXNpYmxlKGdldENvb2tpZSgic2hvd0luaGVyaXRlZEV2ZW50IikgPT0gInRydWUiLCAiRXZlbnQiKTsKICAgIHNldEluaGVyaXRlZFZpc2libGUoZ2V0Q29va2llKCJzaG93SW5oZXJpdGVkU3R5bGUiKSA9PSAidHJ1ZSIsICJTdHlsZSIpOwogICAgCiAgICBzZXRJbmhlcml0ZWRWaXNpYmxlKGdldENvb2tpZSgic2hvd0luaGVyaXRlZFNraW5QYXJ0IikgPT0gInRydWUiLCAiU2tpblBhcnQiKTsKICAgIHNldEluaGVyaXRlZFZpc2libGUoZ2V0Q29va2llKCJzaG93SW5oZXJpdGVkU2tpblN0YXRlIikgPT0gInRydWUiLCAiU2tpblN0YXRlIik7CiAgICAKICAgIHNldEluaGVyaXRlZFZpc2libGUoZ2V0Q29va2llKCJzaG93SW5oZXJpdGVkRWZmZWN0IikgPT0gInRydWUiLCAiRWZmZWN0Iik7Cn0KZnVuY3Rpb24gc2V0SW5oZXJpdGVkVmlzaWJsZShzaG93LCBzZWxlY3RvclRleHQpCnsKICAgIGlmIChkb2N1bWVudC5zdHlsZVNoZWV0c1swXS5jc3NSdWxlcyAhPSB1bmRlZmluZWQpCiAgICB7CiAgICAgICAgdmFyIHJ1bGVzID0gZG9jdW1lbnQuc3R5bGVTaGVldHNbMF0uY3NzUnVsZXM7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBydWxlcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChydWxlc1tpXS5zZWxlY3RvclRleHQgPT0gIi5oaWRlSW5oZXJpdGVkIiArIHNlbGVjdG9yVGV4dCkKICAgICAgICAgICAgICAgIHJ1bGVzW2ldLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gIiIgOiAibm9uZSI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHJ1bGVzW2ldLnNlbGVjdG9yVGV4dCA9PSAiLnNob3dJbmhlcml0ZWQiICsgc2VsZWN0b3JUZXh0KQogICAgICAgICAgICAgICAgcnVsZXNbaV0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyAibm9uZSIgOiAiIjsKICAgICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgZG9jdW1lbnQuc3R5bGVTaGVldHNbMF0uYWRkUnVsZSgiLmhpZGVJbmhlcml0ZWQiICsgc2VsZWN0b3JUZXh0LCBzaG93ID8gImRpc3BsYXk6aW5saW5lIiA6ICJkaXNwbGF5Om5vbmUiKTsKICAgICAgICBkb2N1bWVudC5zdHlsZVNoZWV0c1swXS5hZGRSdWxlKCIuc2hvd0luaGVyaXRlZCIgKyBzZWxlY3RvclRleHQsIHNob3cgPyAiZGlzcGxheTpub25lIiA6ICJkaXNwbGF5OmlubGluZSIpOwogICAgfQogICAgc2V0Q29va2llKCJzaG93SW5oZXJpdGVkIiArIHNlbGVjdG9yVGV4dCwgc2hvdyA/ICJ0cnVlIiA6ICJmYWxzZSIsIG5ldyBEYXRlKDMwMDAsMSwxLDEsMSksICIvIiwgZG9jdW1lbnQubG9jYXRpb24uZG9tYWluKTsKICAgIHNldFJvd0NvbG9ycyhzaG93LCBzZWxlY3RvclRleHQpOwp9CmZ1bmN0aW9uIHNldFJvd0NvbG9ycyhzaG93LCBzZWxlY3RvclRleHQpCnsKICAgIHZhciByb3dDb2xvciA9ICIjRjJGMkYyIjsKICAgIHZhciB0YWJsZSA9IGZpbmRPYmplY3QoInN1bW1hcnlUYWJsZSIgKyBzZWxlY3RvclRleHQpOwogICAgaWYgKHRhYmxlICE9IG51bGwpCiAgICB7CiAgICAgICAgdmFyIHJvd051bSA9IDA7CiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0YWJsZS5yb3dzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHRhYmxlLnJvd3NbaV0uY2xhc3NOYW1lLmluZGV4T2YoImhpZGVJbmhlcml0ZWQiKSA9PSAtMSB8fCBzaG93KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByb3dOdW0rKzsKICAgICAgICAgICAgICAgIHRhYmxlLnJvd3NbaV0uYmdDb2xvciA9IChyb3dOdW0gJSAyID09IDApID8gcm93Q29sb3IgOiAiI0ZGRkZGRiI7CiAgICAgICAgICAgIH0gICAgICAgICAgIAogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBzZXRSb3dDb2xvcnNJbml0aWFsKHNob3csIHNlbGVjdG9yVGV4dCkKewogICAgdmFyIHJvd0NvbG9yID0gIiNGMkYyRjIiOwogICAgdmFyIHRhYmxlID0gZmluZE9iamVjdCgic3VtbWFyeVRhYmxlIiArIHNlbGVjdG9yVGV4dCk7CiAgICBpZiAodGFibGUgIT0gbnVsbCkKICAgIHsKICAgICAgICB2YXIgcm93TnVtID0gMDsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRhYmxlLnJvd3MubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAodGFibGUucm93c1tpXS5jbGFzc05hbWUuaW5kZXhPZigiaGlkZUluaGVyaXRlZCIpID09IC0xICYmIHNob3cpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJvd051bSsrOwogICAgICAgICAgICAgICAgdGFibGUucm93c1tpXS5iZ0NvbG9yID0gKHJvd051bSAlIDIgPT0gMCkgPyByb3dDb2xvciA6ICIjRkZGRkZGIjsKICAgICAgICAgICAgfSAgICAgICAgICAgCiAgICAgICAgfQogICAgfQp9CmZ1bmN0aW9uIHNldFN0eWxlKHNlbGVjdG9yVGV4dCwgc3R5bGVOYW1lLCBuZXdWYWx1ZSkKewogICAgaWYgKGRvY3VtZW50LnN0eWxlU2hlZXRzWzBdLmNzc1J1bGVzICE9IHVuZGVmaW5lZCkKICAgIHsKICAgICAgICB2YXIgcnVsZXMgPSBkb2N1bWVudC5zdHlsZVNoZWV0c1swXS5jc3NSdWxlczsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ1bGVzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHJ1bGVzW2ldLnNlbGVjdG9yVGV4dCA9PSBzZWxlY3RvclRleHQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJ1bGVzW2ldLnN0eWxlW3N0eWxlTmFtZV0gPSBuZXdWYWx1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAgIGRvY3VtZW50LnN0eWxlU2hlZXRzWzBdLmFkZFJ1bGUoc2VsZWN0b3JUZXh0LCBzdHlsZU5hbWUgKyAiOiIgKyBuZXdWYWx1ZSk7CiAgICB9Cn0K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 00:24:02 GMT",
                    "Content-Length": "14682",
                    "Date": "Fri, 07 Nov 2014 00:24:02 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}