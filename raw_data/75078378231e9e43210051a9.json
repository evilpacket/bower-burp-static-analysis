{
    "url": "http://localhost:9999/naoyeye/fullPage.js/jquery.fullPage.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.hash</b> and written to <b>$()</b> via the following statements:<ul><li>var value =  window.location.hash.replace('#', '').split('/');</li><li>var destiny = value[0];</li><li>var section = $('[data-anchor=\"'+destiny+'\"]');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/naoyeye/fullPage.js/jquery.fullPage.js",
                "path": "/naoyeye/fullPage.js/jquery.fullPage.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9uYW95ZXllL2Z1bGxQYWdlLmpzL2pxdWVyeS5mdWxsUGFnZS5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNDU3MzUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDE6NTk6NDggR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDAxOjU5OjQ4IEdNVA0KDQovKioNCiAqIGZ1bGxQYWdlIDIuMC42DQogKiBodHRwczovL2dpdGh1Yi5jb20vYWx2YXJvdHJpZ28vZnVsbFBhZ2UuanMNCiAqIE1JVCBsaWNlbnNlZA0KICoNCiAqIENvcHlyaWdodCAoQykgMjAxMyBhbHZhcm90cmlnby5jb20gLSBBIHByb2plY3QgYnkgQWx2YXJvIFRyaWdvDQogKi8NCg0KKGZ1bmN0aW9uKCQpIHsNCgkkLmZuLmZ1bGxwYWdlID0gZnVuY3Rpb24ob3B0aW9ucykgew0KCQkvLyBDcmVhdGUgc29tZSBkZWZhdWx0cywgZXh0ZW5kaW5nIHRoZW0gd2l0aCBhbnkgb3B0aW9ucyB0aGF0IHdlcmUgcHJvdmlkZWQNCgkJb3B0aW9ucyA9ICQuZXh0ZW5kKHsNCgkJCSJ2ZXJ0aWNhbENlbnRlcmVkIiA6IHRydWUsDQoJCQkncmVzaXplJyA6IHRydWUsDQoJCQknc2xpZGVzQ29sb3InIDogW10sDQoJCQknYW5jaG9ycyc6W10sDQoJCQknc2Nyb2xsaW5nU3BlZWQnOiA3MDAsDQoJCQknZWFzaW5nJzogJ2Vhc2VJblF1YXJ0JywNCgkJCSdtZW51JzogZmFsc2UsDQoJCQknbmF2aWdhdGlvbic6IGZhbHNlLA0KCQkJJ25hdmlnYXRpb25Qb3NpdGlvbic6ICdyaWdodCcsDQoJCQknbmF2aWdhdGlvbkNvbG9yJzogJyMwMDAnLA0KCQkJJ25hdmlnYXRpb25Ub29sdGlwcyc6IFtdLA0KCQkJJ3NsaWRlc05hdmlnYXRpb24nOiBmYWxzZSwNCgkJCSdzbGlkZXNOYXZQb3NpdGlvbic6ICdib3R0b20nLA0KCQkJJ2NvbnRyb2xBcnJvd0NvbG9yJzogJyNmZmYnLA0KCQkJJ2xvb3BCb3R0b20nOiBmYWxzZSwNCgkJCSdsb29wVG9wJzogZmFsc2UsDQoJCQknbG9vcEhvcml6b250YWwnOiB0cnVlLA0KCQkJJ2F1dG9TY3JvbGxpbmcnOiB0cnVlLA0KCQkJJ3Njcm9sbE92ZXJmbG93JzogZmFsc2UsDQoJCQknY3NzMyc6IGZhbHNlLA0KCQkJJ3BhZGRpbmdUb3AnOiAwLA0KCQkJJ3BhZGRpbmdCb3R0b20nOiAwLA0KCQkJJ2ZpeGVkRWxlbWVudHMnOiBudWxsLA0KCQkJJ25vcm1hbFNjcm9sbEVsZW1lbnRzJzogbnVsbCwgDQoJCQkna2V5Ym9hcmRTY3JvbGxpbmcnOiB0cnVlLA0KCQkJJ3RvdWNoU2Vuc2l0aXZpdHknOiA1LA0KCQkJJ2NvbnRpbnVvdXNWZXJ0aWNhbCc6IGZhbHNlLA0KCQkJJ2FuaW1hdGVBbmNob3InOiB0cnVlLA0KCQkJJ25vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZCc6IDUsDQoNCgkJCS8vZXZlbnRzDQoJCQknYWZ0ZXJMb2FkJzogbnVsbCwNCgkJCSdvbkxlYXZlJzogbnVsbCwNCgkJCSdhZnRlclJlbmRlcic6IG51bGwsDQoJCQknYWZ0ZXJSZXNpemUnOiBudWxsLA0KCQkJJ2FmdGVyU2xpZGVMb2FkJzogbnVsbCwNCgkJCSdvblNsaWRlTGVhdmUnOiBudWxsDQoJCX0sIG9wdGlvbnMpOwkJDQoJCQ0KCSAgICAvLyBEaXNhYmxlIG11dHVhbGx5IGV4Y2x1c2l2ZSBzZXR0aW5ncw0KCQlpZiAob3B0aW9ucy5jb250aW51b3VzVmVydGljYWwgJiYNCgkJCShvcHRpb25zLmxvb3BUb3AgfHwgb3B0aW9ucy5sb29wQm90dG9tKSkgew0KCQkgICAgb3B0aW9ucy5jb250aW51b3VzVmVydGljYWwgPSBmYWxzZTsNCgkJICAgIGNvbnNvbGUgJiYgY29uc29sZS5sb2cgJiYgY29uc29sZS5sb2coIk9wdGlvbiBsb29wVG9wL2xvb3BCb3R0b20gaXMgbXV0dWFsbHkgZXhjbHVzaXZlIHdpdGggY29udGludW91c1ZlcnRpY2FsOyBjb250aW51b3VzVmVydGljYWwgZGlzYWJsZWQiKTsNCgkJfQ0KCQkNCgkJLy9EZWZpbmVzIHRoZSBkZWxheSB0byB0YWtlIHBsYWNlIGJlZm9yZSBiZWluZyBhYmxlIHRvIHNjcm9sbCB0byB0aGUgbmV4dCBzZWN0aW9uDQoJCS8vQkUgQ0FSRUZVTCEgTm90IHJlY29tbWVuZWQgdG8gY2hhbmdlIGl0IHVuZGVyIDQwMCBmb3IgYSBnb29kIGJlaGF2aW9yIGluIGxhcHRvcHMgYW5kIA0KCQkvL0FwcGxlIGRldmljZXMgKGxhcHRvcHMsIG1vdXNlcy4uLikNCgkJdmFyIHNjcm9sbERlbGF5ID0gNjAwOw0KCQkNCgkJJC5mbi5mdWxscGFnZS5zZXRBdXRvU2Nyb2xsaW5nID0gZnVuY3Rpb24odmFsdWUpew0KCQkJb3B0aW9ucy5hdXRvU2Nyb2xsaW5nID0gdmFsdWU7DQoJCQkNCgkJCXZhciBlbGVtZW50ID0gJCgnLnNlY3Rpb24uYWN0aXZlJyk7DQoJCQkJDQoJCQlpZihvcHRpb25zLmF1dG9TY3JvbGxpbmcpew0KCQkJCSQoJ2h0bWwsIGJvZHknKS5jc3Moew0KCQkJCQknb3ZlcmZsb3cnIDogJ2hpZGRlbicsDQoJCQkJCSdoZWlnaHQnIDogJzEwMCUnDQoJCQkJfSk7DQoJCQkJDQoJCQkJaWYoZWxlbWVudC5sZW5ndGgpew0KCQkJCQkvL21vdmluZyB0aGUgY29udGFpbmVyIHVwDQoJCQkJCXNpbGVudFNjcm9sbChlbGVtZW50LnBvc2l0aW9uKCkudG9wKTsNCgkJCQl9DQoJCQkJCQ0KCQkJfWVsc2V7DQoJCQkJJCgnaHRtbCwgYm9keScpLmNzcyh7DQoJCQkJCSdvdmVyZmxvdycgOiAnYXV0bycsDQoJCQkJCSdoZWlnaHQnIDogJ2F1dG8nDQoJCQkJfSk7DQoJCQkJDQoJCQkJc2lsZW50U2Nyb2xsKDApOw0KCQkJCQ0KCQkJCS8vc2Nyb2xsaW5nIHRoZSBwYWdlIHRvIHRoZSBzZWN0aW9uIHdpdGggbm8gYW5pbWF0aW9uDQoJCQkJJCgnaHRtbCwgYm9keScpLnNjcm9sbFRvcChlbGVtZW50LnBvc2l0aW9uKCkudG9wKTsNCgkJCX0NCgkJCQ0KCQl9Ow0KDQoJCS8qKg0KCQkqIERlZmluZXMgdGhlIHNjcm9sbGluZyBzcGVlZCANCgkJKi8NCgkJJC5mbi5mdWxscGFnZS5zZXRTY3JvbGxpbmdTcGVlZCA9IGZ1bmN0aW9uKHZhbHVlKXsNCgkJICAgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCA9IHZhbHVlOw0KCQl9Ow0KCQkNCgkJLyoqDQoJCSogQWRkcyBvciByZW1vdmUgdGhlIHBvc3NpYmxpdHkgb2Ygc2Nyb2xsaW5nIHRocm91Z2ggc2VjdGlvbnMgYnkgdXNpbmcgdGhlIG1vdXNlIHdoZWVsIG9yIHRoZSB0cmFja3BhZC4gDQoJCSovDQoJCSQuZm4uZnVsbHBhZ2Uuc2V0TW91c2VXaGVlbFNjcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQoJCQlpZih2YWx1ZSl7DQoJCQkJYWRkTW91c2VXaGVlbEhhbmRsZXIoKTsNCgkJCX1lbHNlew0KCQkJCXJlbW92ZU1vdXNlV2hlZWxIYW5kbGVyKCk7DQoJCQl9DQoJCX07DQoJCQ0KCQkvKioNCgkJKiBBZGRzIG9yIHJlbW92ZSB0aGUgcG9zc2libGl0eSBvZiBzY3JvbGxpbmcgdGhyb3VnaCBzZWN0aW9ucyBieSB1c2luZyB0aGUgbW91c2Ugd2hlZWwvdHJhY2twYWQgb3IgdG91Y2ggZ2VzdHVyZXMuIA0KCQkqLw0KCQkkLmZuLmZ1bGxwYWdlLnNldEFsbG93U2Nyb2xsaW5nID0gZnVuY3Rpb24gKHZhbHVlKXsNCgkJCWlmKHZhbHVlKXsNCgkJCQkkLmZuLmZ1bGxwYWdlLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcodHJ1ZSk7DQoJCQkJYWRkVG91Y2hIYW5kbGVyKCk7DQoJCQl9ZWxzZXsNCgkJCQkkLmZuLmZ1bGxwYWdlLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcoZmFsc2UpOw0KCQkJCXJlbW92ZVRvdWNoSGFuZGxlcigpOw0KCQkJfQ0KCQl9Ow0KCQkNCgkJLyoqDQoJCSogQWRkcyBvciByZW1vdmUgdGhlIHBvc3NpYmxpdHkgb2Ygc2Nyb2xsaW5nIHRocm91Z2ggc2VjdGlvbnMgYnkgdXNpbmcgdGhlIGtleWJvYXJkIGFycm93IGtleXMNCgkJKi8NCgkJJC5mbi5mdWxscGFnZS5zZXRLZXlib2FyZFNjcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQoJCQlvcHRpb25zLmtleWJvYXJkU2Nyb2xsaW5nID0gdmFsdWU7DQoJCX07DQoJCQkNCgkJLy9mbGFnIHRvIGF2b2lkIHZlcnkgZmFzdCBzbGlkaW5nIGZvciBsYW5kc2NhcGUgc2xpZGVycw0KCQl2YXIgc2xpZGVNb3ZpbmcgPSBmYWxzZTsNCg0KCQl2YXIgaXNUYWJsZXQgPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC8oaVBob25lfGlQb2R8aVBhZHxBbmRyb2lkfEJsYWNrQmVycnl8V2luZG93cyBQaG9uZSkvKTsNCgkJdmFyIGNvbnRhaW5lciA9ICQodGhpcyk7IC8vIGZvciBjb21wYXRpYml0eSByZWFzb25zIGZvciBmdWxscGFnZSA8IHYyLjANCgkJdmFyIHdpbmRvd3NIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7DQoJCXZhciBpc01vdmluZyA9IGZhbHNlOw0KCQl2YXIgaXNSZXNpemluZyA9IGZhbHNlOw0KCQl2YXIgbGFzdFNjcm9sbGVkRGVzdGlueTsNCgkJdmFyIGxhc3RTY3JvbGxlZFNsaWRlOw0KDQoJCSQuZm4uZnVsbHBhZ2Uuc2V0QWxsb3dTY3JvbGxpbmcodHJ1ZSk7DQoJCQ0KCQkvL2lmIGNzczMgaXMgbm90IHN1cHBvcnRlZCwgaXQgd2lsbCB1c2UgalF1ZXJ5IGFuaW1hdGlvbnMNCgkJaWYob3B0aW9ucy5jc3MzKXsNCgkJCW9wdGlvbnMuY3NzMyA9IHN1cHBvcnQzZCgpOw0KCQl9DQoNCgkJaWYoJCh0aGlzKS5sZW5ndGgpew0KCQkJY29udGFpbmVyLmNzcyh7DQoJCQkJJ2hlaWdodCc6ICcxMDAlJywNCgkJCQkncG9zaXRpb24nOiAncmVsYXRpdmUnLA0KCQkJCSctbXMtdG91Y2gtYWN0aW9uJzogJ25vbmUnDQoJCQl9KTsNCgkJfQ0KDQoJCS8vZm9yIGNvbXBhdGliaXR5IHJlYXNvbnMgZm9yIGZ1bGxwYWdlIDwgdjIuMCANCgkJZWxzZXsNCgkJCSQoJ2JvZHknKS53cmFwSW5uZXIoJzxkaXYgaWQ9InN1cGVyQ29udGFpbmVyIiAvPicpOw0KCQkJY29udGFpbmVyID0gJCgnI3N1cGVyQ29udGFpbmVyJyk7DQoJCX0NCg0KCQkvL2NyZWF0aW5nIHRoZSBuYXZpZ2F0aW9uIGRvdHMgDQoJCWlmIChvcHRpb25zLm5hdmlnYXRpb24pIHsNCgkJCSQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9ImZ1bGxQYWdlLW5hdiI+PHVsPjwvdWw+PC9kaXY+Jyk7DQoJCQl2YXIgbmF2ID0gJCgnI2Z1bGxQYWdlLW5hdicpOw0KDQoJCQluYXYuY3NzKCdjb2xvcicsIG9wdGlvbnMubmF2aWdhdGlvbkNvbG9yKTsNCgkJCW5hdi5hZGRDbGFzcyhvcHRpb25zLm5hdmlnYXRpb25Qb3NpdGlvbik7DQoJCX0NCgkJDQoJCSQoJy5zZWN0aW9uJykuZWFjaChmdW5jdGlvbihpbmRleCl7DQoJCQl2YXIgdGhhdCA9ICQodGhpcyk7DQoJCQl2YXIgc2xpZGVzID0gJCh0aGlzKS5maW5kKCcuc2xpZGUnKTsNCgkJCXZhciBudW1TbGlkZXMgPSBzbGlkZXMubGVuZ3RoOw0KCQkJDQoJCQkvL2lmIG5vIGFjdGl2ZSBzZWN0aW9uIGlzIGRlZmluZWQsIHRoZSAxc3Qgb25lIHdpbGwgYmUgdGhlIGRlZmF1bHQgb25lDQoJCQlpZighaW5kZXggJiYgJCgnLnNlY3Rpb24uYWN0aXZlJykubGVuZ3RoID09PSAwKSB7DQoJCQkJJCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQl9DQoNCgkJCSQodGhpcykuY3NzKCdoZWlnaHQnLCB3aW5kb3dzSGVpZ2h0ICsgJ3B4Jyk7DQoJCQkNCgkJCWlmKG9wdGlvbnMucGFkZGluZ1RvcCB8fCBvcHRpb25zLnBhZGRpbmdCb3R0b20pew0KCQkJCSQodGhpcykuY3NzKCdwYWRkaW5nJywgb3B0aW9ucy5wYWRkaW5nVG9wICArICcgMCAnICsgb3B0aW9ucy5wYWRkaW5nQm90dG9tICsgJyAwJyk7DQoJCQl9DQoJCQkNCgkJCWlmICh0eXBlb2Ygb3B0aW9ucy5zbGlkZXNDb2xvcltpbmRleF0gIT09ICAndW5kZWZpbmVkJykgew0KCQkJCSQodGhpcykuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgb3B0aW9ucy5zbGlkZXNDb2xvcltpbmRleF0pOw0KCQkJfQ0KDQoJCQlpZiAodHlwZW9mIG9wdGlvbnMuYW5jaG9yc1tpbmRleF0gIT09ICd1bmRlZmluZWQnKSB7DQoJCQkJJCh0aGlzKS5hdHRyKCdkYXRhLWFuY2hvcicsIG9wdGlvbnMuYW5jaG9yc1tpbmRleF0pOw0KCQkJfQkJCQ0KDQoJCQlpZiAob3B0aW9ucy5uYXZpZ2F0aW9uKSB7DQoJCQkJdmFyIGxpbmsgPSAnJzsNCgkJCQlpZihvcHRpb25zLmFuY2hvcnMubGVuZ3RoKXsNCgkJCQkJbGluayA9IG9wdGlvbnMuYW5jaG9yc1tpbmRleF07DQoJCQkJfQ0KCQkJCXZhciB0b29sdGlwID0gb3B0aW9ucy5uYXZpZ2F0aW9uVG9vbHRpcHNbaW5kZXhdOw0KCQkJCWlmKHR5cGVvZiB0b29sdGlwID09PSAndW5kZWZpbmVkJyl7DQoJCQkJCXRvb2x0aXAgPSAnJzsNCgkJCQl9DQoJCQkJDQoJCQkJbmF2LmZpbmQoJ3VsJykuYXBwZW5kKCc8bGkgZGF0YS10b29sdGlwPSInICsgdG9vbHRpcCArICciPjxhIGhyZWY9IiMnICsgbGluayArICciPjxzcGFuPjwvc3Bhbj48L2E+PC9saT4nKTsNCgkJCX0NCg0KCQkJDQoJCQkvLyBpZiB0aGVyZSdzIGFueSBzbGlkZQ0KCQkJaWYgKG51bVNsaWRlcyA+IDApIHsNCgkJCQl2YXIgc2xpZGVyV2lkdGggPSBudW1TbGlkZXMgKiAxMDA7DQoJCQkJdmFyIHNsaWRlV2lkdGggPSAxMDAgLyBudW1TbGlkZXM7DQoJCQkJDQoJCQkJc2xpZGVzLndyYXBBbGwoJzxkaXYgY2xhc3M9InNsaWRlc0NvbnRhaW5lciIgLz4nKTsNCgkJCQlzbGlkZXMucGFyZW50KCkud3JhcCgnPGRpdiBjbGFzcz0ic2xpZGVzIiAvPicpOw0KDQoJCQkJJCh0aGlzKS5maW5kKCcuc2xpZGVzQ29udGFpbmVyJykuY3NzKCd3aWR0aCcsIHNsaWRlcldpZHRoICsgJyUnKTsNCgkJCQkkKHRoaXMpLmZpbmQoJy5zbGlkZXMnKS5hZnRlcignPGRpdiBjbGFzcz0iY29udHJvbEFycm93IHByZXYiPjwvZGl2PjxkaXYgY2xhc3M9ImNvbnRyb2xBcnJvdyBuZXh0Ij48L2Rpdj4nKTsNCgkJCQkNCgkJCQlpZihvcHRpb25zLmNvbnRyb2xBcnJvd0NvbG9yIT0nI2ZmZicpew0KCQkJCQkkKHRoaXMpLmZpbmQoJy5jb250cm9sQXJyb3cubmV4dCcpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3RyYW5zcGFyZW50IHRyYW5zcGFyZW50IHRyYW5zcGFyZW50ICcrb3B0aW9ucy5jb250cm9sQXJyb3dDb2xvcik7DQoJCQkJCSQodGhpcykuZmluZCgnLmNvbnRyb2xBcnJvdy5wcmV2JykuY3NzKCdib3JkZXItY29sb3InLCAndHJhbnNwYXJlbnQgJysgb3B0aW9ucy5jb250cm9sQXJyb3dDb2xvciArICcgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQnKTsNCgkJCQl9DQoJCQkJDQoJCQkJaWYoIW9wdGlvbnMubG9vcEhvcml6b250YWwpew0KCQkJCQkkKHRoaXMpLmZpbmQoJy5jb250cm9sQXJyb3cucHJldicpLmhpZGUoKTsNCgkJCQl9DQoNCgkJCQkNCgkJCQlpZihvcHRpb25zLnNsaWRlc05hdmlnYXRpb24pew0KCQkJCQlhZGRTbGlkZXNOYXZpZ2F0aW9uKCQodGhpcyksIG51bVNsaWRlcyk7DQoJCQkJfQ0KCQkJCQ0KCQkJCXNsaWRlcy5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7DQoJCQkJCS8vaWYgdGhlIHNsaWRlIHdvbiN0IGJlIGFuIHN0YXJ0aW5nIHBvaW50LCB0aGUgZGVmYXVsdCB3aWxsIGJlIHRoZSBmaXJzdCBvbmUNCgkJCQkJaWYoIWluZGV4ICYmIHRoYXQuZmluZCgnLnNsaWRlLmFjdGl2ZScpLmxlbmd0aCA9PSAwKXsNCgkJCQkJCSQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCQl9DQoJCQkJCQ0KCQkJCQkkKHRoaXMpLmNzcygnd2lkdGgnLCBzbGlkZVdpZHRoICsgJyUnKTsNCgkJCQkJDQoJCQkJCWlmKG9wdGlvbnMudmVydGljYWxDZW50ZXJlZCl7DQoJCQkJCQlhZGRUYWJsZUNsYXNzKCQodGhpcykpOw0KCQkJCQl9DQoJCQkJfSk7DQoJCQl9ZWxzZXsNCgkJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCQlhZGRUYWJsZUNsYXNzKCQodGhpcykpOw0KCQkJCX0NCgkJCX0NCgkJCQ0KCQkNCg0KCQkJDQoJCX0pLnByb21pc2UoKS5kb25lKGZ1bmN0aW9uKCl7CQ0KCQkJJC5mbi5mdWxscGFnZS5zZXRBdXRvU2Nyb2xsaW5nKG9wdGlvbnMuYXV0b1Njcm9sbGluZyk7DQoNCg0KCQkJLy90aGUgc3RhcnRpbmcgcG9pbnQgaXMgYSBzbGlkZT8gDQoJCQl2YXIgYWN0aXZlU2xpZGUgPSAkKCcuc2VjdGlvbi5hY3RpdmUnKS5maW5kKCcuc2xpZGUuYWN0aXZlJyk7DQoJCQlpZiggYWN0aXZlU2xpZGUubGVuZ3RoICYmICAoJCgnLnNlY3Rpb24uYWN0aXZlJykuaW5kZXgoJy5zZWN0aW9uJykgIT0gMCB8fCAoJCgnLnNlY3Rpb24uYWN0aXZlJykuaW5kZXgoJy5zZWN0aW9uJykgPT0gMCAmJiBhY3RpdmVTbGlkZS5pbmRleCgpICE9IDApKSl7DQoJCQkJdmFyIHByZXZTY3JvbGxpbmdTcGVlcGQgPSBvcHRpb25zLnNjcm9sbGluZ1NwZWVkOw0KCQkJCSQuZm4uZnVsbHBhZ2Uuc2V0U2Nyb2xsaW5nU3BlZWQgKDApOw0KCQkJCWxhbmRzY2FwZVNjcm9sbCgkKCcuc2VjdGlvbi5hY3RpdmUnKS5maW5kKCcuc2xpZGVzJyksIGFjdGl2ZVNsaWRlKTsNCgkJCQkkLmZuLmZ1bGxwYWdlLnNldFNjcm9sbGluZ1NwZWVkKHByZXZTY3JvbGxpbmdTcGVlcGQpOw0KCQkJfQ0KCQkJDQoJCQkvL2ZpeGVkIGVsZW1lbnRzIG5lZWQgdG8gYmUgbW92ZWQgb3V0IG9mIHRoZSBwbHVnaW4gY29udGFpbmVyIGR1ZSB0byBwcm9ibGVtcyB3aXRoIENTUzMuDQoJCQlpZihvcHRpb25zLmZpeGVkRWxlbWVudHMgJiYgb3B0aW9ucy5jc3MzKXsNCgkJCQkkKG9wdGlvbnMuZml4ZWRFbGVtZW50cykuYXBwZW5kVG8oJ2JvZHknKTsNCgkJCX0NCgkJCQ0KCQkJLy92ZXJ0aWNhbCBjZW50ZXJlZCBvZiB0aGUgbmF2aWdhdGlvbiArIGZpcnN0IGJ1bGxldCBhY3RpdmUNCgkJCWlmKG9wdGlvbnMubmF2aWdhdGlvbil7DQoJCQkJbmF2LmNzcygnbWFyZ2luLXRvcCcsICctJyArIChuYXYuaGVpZ2h0KCkvMikgKyAncHgnKTsNCgkJCQluYXYuZmluZCgnbGknKS5lcSgkKCcuc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLnNlY3Rpb24nKSkuZmluZCgnYScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCX0NCgkJCQ0KCQkJLy9tb3ZpbmcgdGhlIG1lbnUgb3V0c2lkZSB0aGUgbWFpbiBjb250YWluZXIgKGF2b2lkIHByb2JsZW1zIHdpdGggZml4ZWQgcG9zaXRpb25zIHdoZW4gdXNpbmcgQ1NTMyB0cmFuZm9ybXMpDQoJCQlpZihvcHRpb25zLm1lbnUgJiYgb3B0aW9ucy5jc3MzKXsNCgkJCQkkKG9wdGlvbnMubWVudSkuYXBwZW5kVG8oJ2JvZHknKTsNCgkJCX0NCg0KCQkJaWYob3B0aW9ucy5zY3JvbGxPdmVyZmxvdyl7DQoJCQkJLy9hZnRlciBET00gYW5kIGltYWdlcyBhcmUgbG9hZGVkIA0KCQkJCSQod2luZG93KS5vbignbG9hZCcsIGZ1bmN0aW9uKCkgew0KCQkJCQkNCgkJCQkJJCgnLnNlY3Rpb24nKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJCQl2YXIgc2xpZGVzID0gJCh0aGlzKS5maW5kKCcuc2xpZGUnKTsNCgkJCQkJCQ0KCQkJCQkJaWYoc2xpZGVzLmxlbmd0aCl7DQoJCQkJCQkJc2xpZGVzLmVhY2goZnVuY3Rpb24oKXsNCgkJCQkJCQkJY3JlYXRlU2xpbVNjcm9sbGluZygkKHRoaXMpKTsNCgkJCQkJCQl9KTsNCgkJCQkJCX1lbHNlew0KCQkJCQkJCWNyZWF0ZVNsaW1TY3JvbGxpbmcoJCh0aGlzKSk7DQoJCQkJCQl9DQoJCQkJCQkNCgkJCQkJfSk7DQoJCQkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlclJlbmRlciApICYmIG9wdGlvbnMuYWZ0ZXJSZW5kZXIuY2FsbCggdGhpcyk7DQoJCQkJfSk7DQoJCQl9ZWxzZXsNCgkJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJSZW5kZXIgKSAmJiBvcHRpb25zLmFmdGVyUmVuZGVyLmNhbGwoIHRoaXMpOw0KCQkJfQ0KDQoNCgkJCS8vZ2V0dGluZyB0aGUgYW5jaG9yIGxpbmsgaW4gdGhlIFVSTCBhbmQgZGVsZXRpbmcgdGhlIGAjYA0KCQkJdmFyIHZhbHVlID0gIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCAnJykuc3BsaXQoJy8nKTsNCgkJCXZhciBkZXN0aW55ID0gdmFsdWVbMF07DQoNCgkJCWlmKGRlc3RpbnkubGVuZ3RoKXsNCgkJCQl2YXIgc2VjdGlvbiA9ICQoJ1tkYXRhLWFuY2hvcj0iJytkZXN0aW55KyciXScpOw0KDQoJCQkJaWYoIW9wdGlvbnMuYW5pbWF0ZUFuY2hvciAmJiBzZWN0aW9uLmxlbmd0aCl7IA0KCQkJCQlzaWxlbnRTY3JvbGwoc2VjdGlvbi5wb3NpdGlvbigpLnRvcCk7DQoJCQkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlckxvYWQgKSAmJiBvcHRpb25zLmFmdGVyTG9hZC5jYWxsKCB0aGlzLCBkZXN0aW55LCAoc2VjdGlvbi5pbmRleCgnLnNlY3Rpb24nKSArIDEpKTsNCg0KCQkJCQkvL3VwZGF0aW5nIHRoZSBhY3RpdmUgY2xhc3MNCgkJCQkJc2VjdGlvbi5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQkJfQ0KCQkJfQ0KDQoJDQoJCQkkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbigpIHsNCgkJCQlzY3JvbGxUb0FuY2hvcigpOwkNCgkJCX0pOw0KCQkJDQoJCX0pOw0KCQ0KCQl2YXIgc2Nyb2xsSWQ7DQoJCXZhciBpc1Njcm9sbGluZyA9IGZhbHNlOw0KCQkNCgkJLy93aGVuIHNjcm9sbGluZy4uLg0KCQkkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKGUpew0KDQoJCQlpZighb3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsJCQkJCQ0KCQkJCXZhciBjdXJyZW50U2Nyb2xsID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpOw0KCQkJCQ0KCQkJCXZhciBzY3JvbGxlZFNlY3Rpb25zID0gJCgnLnNlY3Rpb24nKS5tYXAoZnVuY3Rpb24oKXsNCgkJCQkJaWYgKCQodGhpcykub2Zmc2V0KCkudG9wIDwgKGN1cnJlbnRTY3JvbGwgKyAxMDApKXsNCgkJCQkJCXJldHVybiAkKHRoaXMpOw0KCQkJCQl9DQoJCQkJfSk7DQoJCQkJDQoJCQkJLy9nZXRpbmcgdGhlIGxhc3Qgb25lLCB0aGUgY3VycmVudCBvbmUgb24gdGhlIHNjcmVlbg0KCQkJCXZhciBjdXJyZW50U2VjdGlvbiA9IHNjcm9sbGVkU2VjdGlvbnNbc2Nyb2xsZWRTZWN0aW9ucy5sZW5ndGgtMV07DQoJCQkJDQoJCQkJLy9leGVjdXRpbmcgb25seSBvbmNlIHRoZSBmaXJzdCB0aW1lIHdlIHJlYWNoIHRoZSBzZWN0aW9uDQoJCQkJaWYoIWN1cnJlbnRTZWN0aW9uLmhhc0NsYXNzKCdhY3RpdmUnKSl7DQoJCQkJCXZhciBsZWF2aW5nU2VjdGlvbiA9ICQoJy5zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcuc2VjdGlvbicpICsgMTsNCg0KCQkJCQlpc1Njcm9sbGluZyA9IHRydWU7CQ0KCQkJCQkNCgkJCQkJdmFyIHlNb3ZlbWVudCA9IGdldFltb3ZlbWVudChjdXJyZW50U2VjdGlvbik7DQoJCQkJCQ0KCQkJCQljdXJyZW50U2VjdGlvbi5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQkJDQoJCQkJCXZhciBhbmNob3JMaW5rICA9IGN1cnJlbnRTZWN0aW9uLmRhdGEoJ2FuY2hvcicpOw0KCQkJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMub25MZWF2ZSApICYmIG9wdGlvbnMub25MZWF2ZS5jYWxsKCB0aGlzLCBsZWF2aW5nU2VjdGlvbiwgeU1vdmVtZW50KTsNCg0KCQkJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJMb2FkICkgJiYgb3B0aW9ucy5hZnRlckxvYWQuY2FsbCggdGhpcywgYW5jaG9yTGluaywgKGN1cnJlbnRTZWN0aW9uLmluZGV4KCcuc2VjdGlvbicpICsgMSkpOw0KCQkJCQkNCgkJCQkJYWN0aXZhdGVNZW51RWxlbWVudChhbmNob3JMaW5rKTsJDQoJCQkJCWFjdGl2YXRlTmF2RG90cyhhbmNob3JMaW5rLCAwKTsNCgkJCQkJDQoJCQkJDQoJCQkJCWlmKG9wdGlvbnMuYW5jaG9ycy5sZW5ndGggJiYgIWlzTW92aW5nKXsNCgkJCQkJCS8vbmVlZGVkIHRvIGVudGVyIGluIGhhc2hDaGFuZ2UgZXZlbnQgd2hlbiB1c2luZyB0aGUgbWVudSB3aXRoIGFuY2hvciBsaW5rcw0KCQkJCQkJbGFzdFNjcm9sbGVkRGVzdGlueSA9IGFuY2hvckxpbms7DQoJCQkNCgkJCQkJCWxvY2F0aW9uLmhhc2ggPSBhbmNob3JMaW5rOw0KCQkJCQl9DQoJCQkJCQ0KCQkJCQkvL3NtYWxsIHRpbWVvdXQgaW4gb3JkZXIgdG8gYXZvaWQgZW50ZXJpbmcgaW4gaGFzaENoYW5nZSBldmVudCB3aGVuIHNjcm9sbGluZyBpcyBub3QgZmluaXNoZWQgeWV0DQoJCQkJCWNsZWFyVGltZW91dChzY3JvbGxJZCk7DQoJCQkJCXNjcm9sbElkID0gc2V0VGltZW91dChmdW5jdGlvbigpewkJCQkJDQoJCQkJCQlpc1Njcm9sbGluZyA9IGZhbHNlOw0KCQkJCQl9LCAxMDApOw0KCQkJCX0NCgkJCQkNCgkJCX0JCQkJCQ0KCQl9KTsJDQoJDQoNCgkJDQoJDQoJCXZhciB0b3VjaFN0YXJ0WSA9IDA7DQoJCXZhciB0b3VjaFN0YXJ0WCA9IDA7DQoJCXZhciB0b3VjaEVuZFkgPSAwOw0KCQl2YXIgdG91Y2hFbmRYID0gMDsNCgkNCgkJLyogRGV0ZWN0aW5nIHRvdWNoIGV2ZW50cyANCgkJDQoJCSogQXMgd2UgYXJlIGNoYW5naW5nIHRoZSB0b3AgcHJvcGVydHkgb2YgdGhlIHBhZ2Ugb24gc2Nyb2xsaW5nLCB3ZSBjYW4gbm90IHVzZSB0aGUgdHJhZGl0aW9uYWwgd2F5IHRvIGRldGVjdCBpdC4NCgkJKiBUaGlzIHdheSwgdGhlIHRvdWNoc3RhcnQgYW5kIHRoZSB0b3VjaCBtb3ZlcyBzaG93cyBhbiBzbWFsbCBkaWZmZXJlbmNlIGJldHdlZW4gdGhlbSB3aGljaCBpcyB0aGUNCgkJKiB1c2VkIG9uZSB0byBkZXRlcm1pbmUgdGhlIGRpcmVjdGlvbi4NCgkJKi8JCQ0KCQlmdW5jdGlvbiB0b3VjaE1vdmVIYW5kbGVyKGV2ZW50KXsNCgkJCXZhciBlID0gZXZlbnQub3JpZ2luYWxFdmVudDsNCg0KCQkJaWYob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCgkJCQkvL3ByZXZlbnRpbmcgdGhlIGVhc2luZyBvbiBpT1MgZGV2aWNlcyANCgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJfQ0KDQoJCQkvLyBhZGRpdGlvbmFsOiBpZiBvbmUgb2YgdGhlIG5vcm1hbFNjcm9sbEVsZW1lbnRzIGlzbid0IHdpdGhpbiBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZCBob3BzIHVwIHRoZSBET00gY2hhaW4NCgkJCWlmICghY2hlY2tQYXJlbnRGb3JOb3JtYWxTY3JvbGxFbGVtZW50KGV2ZW50LnRhcmdldCkpIHsNCgkJDQoJCQkJdmFyIHRvdWNoTW92ZWQgPSBmYWxzZTsNCgkJCQl2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5zZWN0aW9uLmFjdGl2ZScpOw0KCQkJCXZhciBzY3JvbGxhYmxlOw0KDQoJCQkJaWYgKCFpc01vdmluZyAmJiAhc2xpZGVNb3ZpbmcpIHsgLy9pZiB0aGVyZXMgYW55ICMNCgkJCQkJdmFyIHRvdWNoRXZlbnRzID0gZ2V0RXZlbnRzUGFnZShlKTsNCgkJCQkJdG91Y2hFbmRZID0gdG91Y2hFdmVudHNbJ3knXTsNCgkJCQkJdG91Y2hFbmRYID0gdG91Y2hFdmVudHNbJ3gnXTsNCgkJCQkJCQkJCQkNCgkJCQkJLy9pZiBtb3ZlbWVudCBpbiB0aGUgWCBheHlzIGlzIGdyZWF0ZXIgdGhhbiBpbiB0aGUgWSBhbmQgdGhlIGN1cnJlY3Qgc2VjdGlvbiBoYXMgc2xpZGVzLi4uDQoJCQkJCWlmIChhY3RpdmVTZWN0aW9uLmZpbmQoJy5zbGlkZXMnKS5sZW5ndGggJiYgTWF0aC5hYnModG91Y2hTdGFydFggLSB0b3VjaEVuZFgpID4gKE1hdGguYWJzKHRvdWNoU3RhcnRZIC0gdG91Y2hFbmRZKSkpIHsNCgkJCQkJICAgIA0KCQkJCQkgICAgLy9pcyB0aGUgbW92ZW1lbnQgZ3JlYXRlciB0aGFuIHRoZSBtaW5pbXVtIHJlc2lzdGFuY2UgdG8gc2Nyb2xsPw0KCQkJCQkgICAgaWYgKE1hdGguYWJzKHRvdWNoU3RhcnRYIC0gdG91Y2hFbmRYKSA+ICgkKHdpbmRvdykud2lkdGgoKSAvIDEwMCAqIG9wdGlvbnMudG91Y2hTZW5zaXRpdml0eSkpIHsNCgkJCQkJICAgICAgICBpZiAodG91Y2hTdGFydFggPiB0b3VjaEVuZFgpIHsNCgkJCQkJICAgICAgICAgICAgJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVSaWdodCgpOyAvL25leHQgDQoJCQkJCSAgICAgICAgfSBlbHNlIHsNCgkJCQkJICAgICAgICAgICAgJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVMZWZ0KCk7IC8vcHJldg0KCQkJCQkgICAgICAgIH0NCgkJCQkJICAgIH0NCgkJCQkJfQ0KDQoJCQkJCS8vdmVydGljYWwgc2Nyb2xsaW5nIChvbmx5IHdoZW4gYXV0b1Njcm9sbGluZyBpcyBlbmFibGVkKQ0KCQkJCQllbHNlIGlmKG9wdGlvbnMuYXV0b1Njcm9sbGluZyl7DQoJCQkJCQ0KCQkJCQkJLy9pZiB0aGVyZSBhcmUgbGFuZHNjYXBlIHNsaWRlcywgd2UgY2hlY2sgaWYgdGhlIHNjcm9sbGluZyBiYXIgaXMgaW4gdGhlIGN1cnJlbnQgb25lIG9yIG5vdA0KCQkJCQkJaWYoYWN0aXZlU2VjdGlvbi5maW5kKCcuc2xpZGVzJykubGVuZ3RoKXsNCgkJCQkJCQlzY3JvbGxhYmxlPSBhY3RpdmVTZWN0aW9uLmZpbmQoJy5zbGlkZS5hY3RpdmUnKS5maW5kKCcuc2Nyb2xsYWJsZScpOw0KCQkJCQkJfWVsc2V7DQoJCQkJCQkJc2Nyb2xsYWJsZSA9IGFjdGl2ZVNlY3Rpb24uZmluZCgnLnNjcm9sbGFibGUnKTsNCgkJCQkJCX0NCgkJCQkJCQ0KCQkJCQkJLy9pcyB0aGUgbW92ZW1lbnQgZ3JlYXRlciB0aGFuIHRoZSBtaW5pbXVtIHJlc2lzdGFuY2UgdG8gc2Nyb2xsPw0KCQkJCQkJaWYgKE1hdGguYWJzKHRvdWNoU3RhcnRZIC0gdG91Y2hFbmRZKSA+ICgkKHdpbmRvdykuaGVpZ2h0KCkgLyAxMDAgKiBvcHRpb25zLnRvdWNoU2Vuc2l0aXZpdHkpKSB7DQoJCQkJCQkJaWYgKHRvdWNoU3RhcnRZID4gdG91Y2hFbmRZKSB7DQoJCQkJCQkJCWlmKHNjcm9sbGFibGUubGVuZ3RoID4gMCApew0KCQkJCQkJCQkJLy9pcyB0aGUgc2Nyb2xsYmFyIGF0IHRoZSBlbmQgb2YgdGhlIHNjcm9sbD8NCgkJCQkJCQkJCWlmKGlzU2Nyb2xsZWQoJ2JvdHRvbScsIHNjcm9sbGFibGUpKXsNCgkJCQkJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTZWN0aW9uRG93bigpOw0KCQkJCQkJCQkJfWVsc2V7DQoJCQkJCQkJCQkJcmV0dXJuIHRydWU7DQoJCQkJCQkJCQl9DQoJCQkJCQkJCX1lbHNlew0KCQkJCQkJCQkJLy8gbW92ZWQgZG93bg0KCQkJCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvbkRvd24oKTsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0gZWxzZSBpZiAodG91Y2hFbmRZID4gdG91Y2hTdGFydFkpIHsNCgkJCQkJCQkJDQoJCQkJCQkJCWlmKHNjcm9sbGFibGUubGVuZ3RoID4gMCl7DQoJCQkJCQkJCQkvL2lzIHRoZSBzY3JvbGxiYXIgYXQgdGhlIHN0YXJ0IG9mIHRoZSBzY3JvbGw/DQoJCQkJCQkJCQlpZihpc1Njcm9sbGVkKCd0b3AnLCBzY3JvbGxhYmxlKSl7DQoJCQkJCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvblVwKCk7DQoJCQkJCQkJCQl9DQoJCQkJCQkJCQllbHNlew0KCQkJCQkJCQkJCXJldHVybiB0cnVlOw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9ZWxzZXsNCgkJCQkJCQkJCS8vIG1vdmVkIHVwDQoJCQkJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTZWN0aW9uVXAoKTsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQl9DQoNCgkJLyoqDQoJCSAqIHJlY3Vyc2l2ZSBmdW5jdGlvbiB0byBsb29wIHVwIHRoZSBwYXJlbnQgbm9kZXMgdG8gY2hlY2sgaWYgb25lIG9mIHRoZW0gZXhpc3RzIGluIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMNCgkJICogQ3VycmVudGx5IHdvcmtzIHdlbGwgZm9yIGlPUyAtIEFuZHJvaWQgbWlnaHQgbmVlZCBzb21lIHRlc3RpbmcNCgkJICogQHBhcmFtICB7RWxlbWVudH0gZWwgIHRhcmdldCBlbGVtZW50IC8ganF1ZXJ5IHNlbGVjdG9yIChpbiBzdWJzZXF1ZW50IG5vZGVzKQ0KCQkgKiBAcGFyYW0gIHtpbnR9ICAgICBob3AgY3VycmVudCBob3AgY29tcGFyZWQgdG8gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQgDQoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgdGhlcmUgaXMgYSBtYXRjaCB0byBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzDQoJCSAqLw0KCQlmdW5jdGlvbiBjaGVja1BhcmVudEZvck5vcm1hbFNjcm9sbEVsZW1lbnQgKGVsLCBob3ApIHsNCgkJCWhvcCA9IGhvcCB8fCAwOw0KCQkJdmFyIHBhcmVudCA9ICQoZWwpLnBhcmVudCgpOw0KDQoJCQlpZiAoaG9wIDwgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQgJiYNCgkJCQlwYXJlbnQuaXMob3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cykgKSB7DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9IGVsc2UgaWYgKGhvcCA9PSBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZCkgew0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0gZWxzZSB7DQoJCQkJcmV0dXJuIGNoZWNrUGFyZW50Rm9yTm9ybWFsU2Nyb2xsRWxlbWVudChwYXJlbnQsICsraG9wKTsNCgkJCX0NCgkJfQ0KCQkNCgkJZnVuY3Rpb24gdG91Y2hTdGFydEhhbmRsZXIoZXZlbnQpew0KCQkJdmFyIGUgPSBldmVudC5vcmlnaW5hbEV2ZW50Ow0KCQkJdmFyIHRvdWNoRXZlbnRzID0gZ2V0RXZlbnRzUGFnZShlKTsNCgkJCXRvdWNoU3RhcnRZID0gdG91Y2hFdmVudHNbJ3knXTsNCgkJCXRvdWNoU3RhcnRYID0gdG91Y2hFdmVudHNbJ3gnXTsNCgkJfQ0KCQkNCg0KDQoJCS8qKg0KCQkgKiBEZXRlY3RpbmcgbW91c2V3aGVlbCBzY3JvbGxpbmcNCgkJICogDQoJCSAqIGh0dHA6Ly9ibG9ncy5zaXRlcG9pbnRzdGF0aWMuY29tL2V4YW1wbGVzL3RlY2gvbW91c2Utd2hlZWwvaW5kZXguaHRtbA0KCQkgKiBodHRwOi8vd3d3LnNpdGVwb2ludC5jb20vaHRtbDUtamF2YXNjcmlwdC1tb3VzZS13aGVlbC8NCgkJICovDQoJCWZ1bmN0aW9uIE1vdXNlV2hlZWxIYW5kbGVyKGUpIHsNCgkJCWlmKG9wdGlvbnMuYXV0b1Njcm9sbGluZyl7DQoJCQkJLy8gY3Jvc3MtYnJvd3NlciB3aGVlbCBkZWx0YQ0KCQkJCWUgPSB3aW5kb3cuZXZlbnQgfHwgZTsNCgkJCQl2YXIgZGVsdGEgPSBNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwNCgkJCQkJCShlLndoZWVsRGVsdGEgfHwgLWUuZGVsdGFZIHx8IC1lLmRldGFpbCkpKTsNCgkJCQl2YXIgc2Nyb2xsYWJsZTsNCgkJCQl2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5zZWN0aW9uLmFjdGl2ZScpOw0KCQkJCQ0KCQkJCWlmICghaXNNb3ZpbmcpIHsgLy9pZiB0aGVyZXMgYW55ICMNCgkJCQkNCgkJCQkJLy9pZiB0aGVyZSBhcmUgbGFuZHNjYXBlIHNsaWRlcywgd2UgY2hlY2sgaWYgdGhlIHNjcm9sbGluZyBiYXIgaXMgaW4gdGhlIGN1cnJlbnQgb25lIG9yIG5vdA0KCQkJCQlpZihhY3RpdmVTZWN0aW9uLmZpbmQoJy5zbGlkZXMnKS5sZW5ndGgpew0KCQkJCQkJc2Nyb2xsYWJsZT0gYWN0aXZlU2VjdGlvbi5maW5kKCcuc2xpZGUuYWN0aXZlJykuZmluZCgnLnNjcm9sbGFibGUnKTsNCgkJCQkJfWVsc2V7DQoJCQkJCQlzY3JvbGxhYmxlID0gYWN0aXZlU2VjdGlvbi5maW5kKCcuc2Nyb2xsYWJsZScpOw0KCQkJCQl9DQoJCQkJDQoJCQkJCS8vc2Nyb2xsaW5nIGRvd24/DQoJCQkJCWlmIChkZWx0YSA8IDApIHsNCgkJCQkJCWlmKHNjcm9sbGFibGUubGVuZ3RoID4gMCApew0KCQkJCQkJCS8vaXMgdGhlIHNjcm9sbGJhciBhdCB0aGUgZW5kIG9mIHRoZSBzY3JvbGw/DQoJCQkJCQkJaWYoaXNTY3JvbGxlZCgnYm90dG9tJywgc2Nyb2xsYWJsZSkpew0KCQkJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTZWN0aW9uRG93bigpOw0KCQkJCQkJCX1lbHNlew0KCQkJCQkJCQlyZXR1cm4gdHJ1ZTsgLy9ub3JtYWwgc2Nyb2xsDQoJCQkJCQkJfQ0KCQkJCQkJfWVsc2V7DQoJCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvbkRvd24oKTsNCgkJCQkJCX0NCgkJCQkJfQ0KDQoJCQkJCS8vc2Nyb2xsaW5nIHVwPw0KCQkJCQllbHNlIHsNCgkJCQkJCWlmKHNjcm9sbGFibGUubGVuZ3RoID4gMCl7DQoJCQkJCQkJLy9pcyB0aGUgc2Nyb2xsYmFyIGF0IHRoZSBzdGFydCBvZiB0aGUgc2Nyb2xsPw0KCQkJCQkJCWlmKGlzU2Nyb2xsZWQoJ3RvcCcsIHNjcm9sbGFibGUpKXsNCgkJCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvblVwKCk7DQoJCQkJCQkJfWVsc2V7DQoJCQkJCQkJCXJldHVybiB0cnVlOyAvL25vcm1hbCBzY3JvbGwNCgkJCQkJCQl9DQoJCQkJCQl9ZWxzZXsNCgkJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTZWN0aW9uVXAoKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJfQ0KDQoJCQ0KCQkkLmZuLmZ1bGxwYWdlLm1vdmVTZWN0aW9uVXAgPSBmdW5jdGlvbigpew0KCQkJdmFyIHByZXYgPSAkKCcuc2VjdGlvbi5hY3RpdmUnKS5wcmV2KCcuc2VjdGlvbicpOw0KCQkJDQoJCQkvL2xvb3BpbmcgdG8gdGhlIGJvdHRvbSBpZiB0aGVyZSdzIG5vIG1vcmUgc2VjdGlvbnMgYWJvdmUNCgkJCWlmICghcHJldi5sZW5ndGggJiYgKG9wdGlvbnMubG9vcFRvcCB8fCBvcHRpb25zLmNvbnRpbnVvdXNWZXJ0aWNhbCkpIHsNCgkJCQlwcmV2ID0gJCgnLnNlY3Rpb24nKS5sYXN0KCk7DQoJCQl9DQoNCgkJCWlmIChwcmV2Lmxlbmd0aCkgew0KCQkJCXNjcm9sbFBhZ2UocHJldiwgbnVsbCwgdHJ1ZSk7DQoJCQl9DQoJCX07DQoNCgkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvbkRvd24gPSBmdW5jdGlvbiAoKXsNCgkJCXZhciBuZXh0ID0gJCgnLnNlY3Rpb24uYWN0aXZlJykubmV4dCgnLnNlY3Rpb24nKTsNCg0KCQkJLy9sb29waW5nIHRvIHRoZSB0b3AgaWYgdGhlcmUncyBubyBtb3JlIHNlY3Rpb25zIGJlbG93DQoJCQlpZighbmV4dC5sZW5ndGggJiYNCgkJCQkob3B0aW9ucy5sb29wQm90dG9tIHx8IG9wdGlvbnMuY29udGludW91c1ZlcnRpY2FsKSl7DQoJCQkJbmV4dCA9ICQoJy5zZWN0aW9uJykuZmlyc3QoKTsNCgkJCX0NCg0KCQkJaWYobmV4dC5sZW5ndGggPiAwIHx8DQoJCQkJKCFuZXh0Lmxlbmd0aCAmJg0KCQkJCShvcHRpb25zLmxvb3BCb3R0b20gfHwgb3B0aW9ucy5jb250aW51b3VzVmVydGljYWwpKSl7DQoJCQkJc2Nyb2xsUGFnZShuZXh0LCBudWxsLCBmYWxzZSk7DQoJCQl9DQoJCX07DQoJCQ0KCQkkLmZuLmZ1bGxwYWdlLm1vdmVUbyA9IGZ1bmN0aW9uIChzZWN0aW9uLCBzbGlkZSl7DQoJCQl2YXIgZGVzdGlueSA9ICcnOw0KCQkJDQoJCQlpZihpc05hTihzZWN0aW9uKSl7DQoJCQkJZGVzdGlueSA9ICQoJ1tkYXRhLWFuY2hvcj0iJytzZWN0aW9uKyciXScpOw0KCQkJfWVsc2V7DQoJCQkJZGVzdGlueSA9ICQoJy5zZWN0aW9uJykuZXEoIChzZWN0aW9uIC0xKSApOw0KCQkJfQ0KCQkJDQoJCQlpZiAodHlwZW9mIHNsaWRlICE9PSAndW5kZWZpbmVkJyl7DQoJCQkJc2Nyb2xsUGFnZUFuZFNsaWRlKHNlY3Rpb24sIHNsaWRlKTsNCgkJCX1lbHNlIGlmKGRlc3RpbnkubGVuZ3RoID4gMCl7DQoJCQkJc2Nyb2xsUGFnZShkZXN0aW55KTsNCgkJCX0NCgkJfTsNCg0KCQkkLmZuLmZ1bGxwYWdlLm1vdmVTbGlkZVJpZ2h0ID0gZnVuY3Rpb24oKXsNCgkJCW1vdmVTbGlkZSgnbmV4dCcpOw0KCQl9DQoNCgkJJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVMZWZ0ID0gZnVuY3Rpb24oKXsNCgkJCW1vdmVTbGlkZSgncHJldicpOw0KCQl9DQoNCgkJZnVuY3Rpb24gbW92ZVNsaWRlKGRpcmVjdGlvbil7DQoJCSAgICB2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5zZWN0aW9uLmFjdGl2ZScpOw0KCQkgICAgdmFyIHNsaWRlcyA9IGFjdGl2ZVNlY3Rpb24uZmluZCgnLnNsaWRlcycpOw0KDQoJCSAgICAvLyBtb3JlIHRoYW4gb25lIHNsaWRlIG5lZWRlZCBhbmQgbm90aGluZyBzaG91bGQgYmUgc2xpZGluZw0KCQkJaWYgKCFzbGlkZXMubGVuZ3RoIHx8IHNsaWRlTW92aW5nKSB7DQoJCQkgICAgcmV0dXJuOw0KCQkJfQ0KDQoJCSAgICB2YXIgY3VycmVudFNsaWRlID0gc2xpZGVzLmZpbmQoJy5zbGlkZS5hY3RpdmUnKTsNCgkJICAgIHZhciBkZXN0aW55ID0gbnVsbDsNCg0KCQkgICAgaWYoZGlyZWN0aW9uID09PSAncHJldicpew0KCQkgICAgICAgIGRlc3RpbnkgPSBjdXJyZW50U2xpZGUucHJldignLnNsaWRlJyk7DQoJCSAgICB9ZWxzZXsNCgkJICAgICAgICBkZXN0aW55ID0gY3VycmVudFNsaWRlLm5leHQoJy5zbGlkZScpOw0KCQkgICAgfQ0KDQoJCSAgICAvL2lzbid0IHRoZXJlIGEgbmV4dCBzbGlkZSBpbiB0aGUgc2VjdWVuY2U/DQoJCQlpZighZGVzdGlueS5sZW5ndGgpew0KCQkJCS8vcmVzcGVjdCBsb29wSG9yaXpvbnRhbCBzZXR0aW4NCgkJCQlpZiAoIW9wdGlvbnMubG9vcEhvcml6b250YWwpIHJldHVybjsNCg0KCQkJICAgIGlmKGRpcmVjdGlvbiA9PT0gJ3ByZXYnKXsNCgkJCSAgICAgICAgZGVzdGlueSA9IGN1cnJlbnRTbGlkZS5zaWJsaW5ncygnOmxhc3QnKTsNCgkJCSAgICB9ZWxzZXsNCgkJCSAgICAgICAgZGVzdGlueSA9IGN1cnJlbnRTbGlkZS5zaWJsaW5ncygnOmZpcnN0Jyk7DQoJCQkgICAgfQ0KCQkJfQ0KDQoJCSAgICBzbGlkZU1vdmluZyA9IHRydWU7DQoNCgkJICAgIGxhbmRzY2FwZVNjcm9sbChzbGlkZXMsIGRlc3RpbnkpOw0KCQl9DQoNCgkJZnVuY3Rpb24gc2Nyb2xsUGFnZShlbGVtZW50LCBjYWxsYmFjaywgaXNNb3ZlbWVudFVwKXsNCgkJCXZhciBzY3JvbGxPcHRpb25zID0ge30sIHNjcm9sbGVkRWxlbWVudDsNCgkJCXZhciBkZXN0ID0gZWxlbWVudC5wb3NpdGlvbigpOw0KCQkJaWYodHlwZW9mIGRlc3QgPT09ICJ1bmRlZmluZWQiKXsgcmV0dXJuOyB9IC8vdGhlcmUncyBubyBlbGVtZW50IHRvIHNjcm9sbCwgbGVhdmluZyB0aGUgZnVuY3Rpb24NCgkJCXZhciBkdG9wID0gZGVzdC50b3A7CQkJDQoJCQl2YXIgeU1vdmVtZW50ID0gZ2V0WW1vdmVtZW50KGVsZW1lbnQpOw0KCQkJdmFyIGFuY2hvckxpbmsgID0gZWxlbWVudC5kYXRhKCdhbmNob3InKTsNCgkJCXZhciBzZWN0aW9uSW5kZXggPSBlbGVtZW50LmluZGV4KCcuc2VjdGlvbicpOw0KCQkJdmFyIGFjdGl2ZVNsaWRlID0gZWxlbWVudC5maW5kKCcuc2xpZGUuYWN0aXZlJyk7DQoJCQl2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5zZWN0aW9uLmFjdGl2ZScpOw0KCQkJdmFyIGxlYXZpbmdTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5pbmRleCgnLnNlY3Rpb24nKSArIDE7DQoNCgkJCS8vY2FjaGluZyB0aGUgdmFsdWUgb2YgaXNSZXNpemluZyBhdCB0aGUgbW9tbWVudCB0aGUgZnVuY3Rpb24gaXMgY2FsbGVkIA0KCQkJLy9iZWNhdXNlIGl0IHdpbGwgYmUgY2hlY2tlZCBsYXRlciBpbnNpZGUgYSBzZXRUaW1lb3V0IGFuZCB0aGUgdmFsdWUgbWlnaHQgY2hhbmdlDQoJCQl2YXIgbG9jYWxJc1Jlc2l6aW5nID0gaXNSZXNpemluZzsgDQoNCgkJCWlmKGFjdGl2ZVNsaWRlLmxlbmd0aCl7DQoJCQkJdmFyIHNsaWRlQW5jaG9yTGluayA9IGFjdGl2ZVNsaWRlLmRhdGEoJ2FuY2hvcicpOw0KCQkJCXZhciBzbGlkZUluZGV4ID0gYWN0aXZlU2xpZGUuaW5kZXgoKTsNCgkJCX0NCg0KCQkJLy8gSWYgY29udGludW91c1ZlcnRpY2FsICYmIHdlIG5lZWQgdG8gd3JhcCBhcm91bmQNCgkJCWlmIChvcHRpb25zLmF1dG9TY3JvbGxpbmcgJiYgb3B0aW9ucy5jb250aW51b3VzVmVydGljYWwgJiYgdHlwZW9mIChpc01vdmVtZW50VXApICE9PSAidW5kZWZpbmVkIiAmJg0KCQkJCSgoIWlzTW92ZW1lbnRVcCAmJiB5TW92ZW1lbnQgPT0gJ3VwJykgfHwgLy8gSW50ZW5kaW5nIHRvIHNjcm9sbCBkb3duIGJ1dCBhYm91dCB0byBnbyB1cCBvcg0KCQkJCShpc01vdmVtZW50VXAgJiYgeU1vdmVtZW50ID09ICdkb3duJykpKSB7IC8vIGludGVuZGluZyB0byBzY3JvbGwgdXAgYnV0IGFib3V0IHRvIGdvIGRvd24NCg0KCQkJCS8vIFNjcm9sbGluZyBkb3duDQoJCQkJaWYgKCFpc01vdmVtZW50VXApIHsNCgkJCQkJLy8gTW92ZSBhbGwgcHJldmlvdXMgc2VjdGlvbnMgdG8gYWZ0ZXIgdGhlIGFjdGl2ZSBzZWN0aW9uDQoJCQkJCSQoIi5zZWN0aW9uLmFjdGl2ZSIpLmFmdGVyKGFjdGl2ZVNlY3Rpb24ucHJldkFsbCgiLnNlY3Rpb24iKS5nZXQoKS5yZXZlcnNlKCkpOw0KCQkJCX0NCgkJCQllbHNlIHsgLy8gU2Nyb2xsaW5nIHVwDQoJCQkJCS8vIE1vdmUgYWxsIG5leHQgc2VjdGlvbnMgdG8gYmVmb3JlIHRoZSBhY3RpdmUgc2VjdGlvbg0KCQkJCQkkKCIuc2VjdGlvbi5hY3RpdmUiKS5iZWZvcmUoYWN0aXZlU2VjdGlvbi5uZXh0QWxsKCIuc2VjdGlvbiIpKTsNCgkJCQl9DQoNCgkJCQkvLyBNYWludGFpbiB0aGUgZGlzcGxheWVkIHBvc2l0aW9uIChub3cgdGhhdCB3ZSBjaGFuZ2VkIHRoZSBlbGVtZW50IG9yZGVyKQ0KCQkJCXNpbGVudFNjcm9sbCgkKCcuc2VjdGlvbi5hY3RpdmUnKS5wb3NpdGlvbigpLnRvcCk7DQoNCgkJCQkvLyBzYXZlIGZvciBsYXRlciB0aGUgZWxlbWVudHMgdGhhdCBzdGlsbCBuZWVkIHRvIGJlIHJlb3JkZXJlZA0KCQkJCXZhciB3cmFwQXJvdW5kRWxlbWVudHMgPSBhY3RpdmVTZWN0aW9uOw0KDQoJCQkJLy8gUmVjYWxjdWxhdGUgYW5pbWF0aW9uIHZhcmlhYmxlcw0KCQkJCWRlc3QgPSBlbGVtZW50LnBvc2l0aW9uKCk7DQoJCQkJZHRvcCA9IGRlc3QudG9wOw0KCQkJCXlNb3ZlbWVudCA9IGdldFltb3ZlbWVudChlbGVtZW50KTsNCgkJCX0NCg0KCQkJDQoJCQllbGVtZW50LmFkZENsYXNzKCdhY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCQ0KCQkJLy9wcmV2ZW50aW5nIGZyb20gYWN0aXZhdGluZyB0aGUgTW91c2VXaGVlbEhhbmRsZXIgZXZlbnQNCgkJCS8vbW9yZSB0aGFuIG9uY2UgaWYgdGhlIHBhZ2UgaXMgc2Nyb2xsaW5nDQoJCQlpc01vdmluZyA9IHRydWU7DQoJCQkNCgkJCWlmKHR5cGVvZiBhbmNob3JMaW5rICE9PSAndW5kZWZpbmVkJyl7DQoJCQkJc2V0VVJMSGFzaChzbGlkZUluZGV4LCBzbGlkZUFuY2hvckxpbmssIGFuY2hvckxpbmspOw0KCQkJfQ0KCQkJDQoJCQlpZihvcHRpb25zLmF1dG9TY3JvbGxpbmcpew0KCQkJCXNjcm9sbE9wdGlvbnNbJ3RvcCddID0gLWR0b3A7DQoJCQkJc2Nyb2xsZWRFbGVtZW50ID0gY29udGFpbmVyLnNlbGVjdG9yOw0KCQkJfWVsc2V7DQoJCQkJc2Nyb2xsT3B0aW9uc1snc2Nyb2xsVG9wJ10gPSBkdG9wOw0KCQkJCXNjcm9sbGVkRWxlbWVudCA9ICdodG1sLCBib2R5JzsNCgkJCX0NCg0KCQkJLy8gRml4IHNlY3Rpb24gb3JkZXIgYWZ0ZXIgY29udGludW91c1ZlcnRpY2FsIGNoYW5nZXMgaGF2ZSBiZWVuIGFuaW1hdGVkDQoJCQl2YXIgY29udGludW91c1ZlcnRpY2FsRml4U2VjdGlvbk9yZGVyID0gZnVuY3Rpb24gKCkgew0KCQkJCS8vIElmIGNvbnRpbnVvdXNWZXJ0aWNhbCBpcyBpbiBlZmZlY3QgKGFuZCBhdXRvU2Nyb2xsaW5nIHdvdWxkIGFsc28gYmUgaW4gZWZmZWN0IHRoZW4pLCANCgkJCQkvLyBmaW5pc2ggbW92aW5nIHRoZSBlbGVtZW50cyBhcm91bmQgc28gdGhlIGRpcmVjdCBuYXZpZ2F0aW9uIHdpbGwgZnVuY3Rpb24gbW9yZSBzaW1wbHkNCgkJCQlpZiAoIXdyYXBBcm91bmRFbGVtZW50cyB8fCAhd3JhcEFyb3VuZEVsZW1lbnRzLmxlbmd0aCkgew0KCQkJCQlyZXR1cm47DQoJCQkJfQ0KDQoJCQkJaWYgKGlzTW92ZW1lbnRVcCkgew0KCQkJCQkkKCcuc2VjdGlvbjpmaXJzdCcpLmJlZm9yZSh3cmFwQXJvdW5kRWxlbWVudHMpOw0KCQkJCX0NCgkJCQllbHNlIHsNCgkJCQkJJCgnLnNlY3Rpb246bGFzdCcpLmFmdGVyKHdyYXBBcm91bmRFbGVtZW50cyk7DQoJCQkJfQ0KDQoJCQkJc2lsZW50U2Nyb2xsKCQoJy5zZWN0aW9uLmFjdGl2ZScpLnBvc2l0aW9uKCkudG9wKTsNCgkJCX07DQoNCg0KCQkJLy8gVXNlIENTUzMgdHJhbnNsYXRlIGZ1bmN0aW9uYWxpdHkgb3IuLi4NCgkJCWlmIChvcHRpb25zLmNzczMgJiYgb3B0aW9ucy5hdXRvU2Nyb2xsaW5nKSB7DQoNCgkJCQkvL2NhbGxiYWNrIChvbkxlYXZlKSBpZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KCQkJCSQuaXNGdW5jdGlvbihvcHRpb25zLm9uTGVhdmUpICYmICFsb2NhbElzUmVzaXppbmcgJiYgb3B0aW9ucy5vbkxlYXZlLmNhbGwodGhpcywgbGVhdmluZ1NlY3Rpb24sIHlNb3ZlbWVudCk7DQoJCQkJDQoNCgkJCQl2YXIgdHJhbnNsYXRlM2QgPSAndHJhbnNsYXRlM2QoMHB4LCAtJyArIGR0b3AgKyAncHgsIDBweCknOw0KCQkJCXRyYW5zZm9ybUNvbnRhaW5lcih0cmFuc2xhdGUzZCwgdHJ1ZSk7DQoNCgkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkJLy9maXggc2VjdGlvbiBvcmRlciBmcm9tIGNvbnRpbnVvdXNWZXJ0aWNhbA0KCQkJCQljb250aW51b3VzVmVydGljYWxGaXhTZWN0aW9uT3JkZXIoKTsNCg0KCQkJCQkvL2NhbGxiYWNrIChhZnRlckxvYWQpIAlpZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KCQkJCQkkLmlzRnVuY3Rpb24ob3B0aW9ucy5hZnRlckxvYWQpICYmICFsb2NhbElzUmVzaXppbmcgJiYgb3B0aW9ucy5hZnRlckxvYWQuY2FsbCh0aGlzLCBhbmNob3JMaW5rLCAoc2VjdGlvbkluZGV4ICsgMSkpOw0KDQoJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJCQkJaXNNb3ZpbmcgPSBmYWxzZTsNCgkJCQkJCSQuaXNGdW5jdGlvbihjYWxsYmFjaykgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTsNCgkJCQkJfSwgc2Nyb2xsRGVsYXkpOw0KCQkJCX0sIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQpOw0KCQkJfSBlbHNlIHsgLy8gLi4uIHVzZSBqUXVlcnkgYW5pbWF0ZSANCg0KCQkJCS8vY2FsbGJhY2sgKG9uTGVhdmUpIGlmIHRoZSBzaXRlIGlzIG5vdCBqdXN0IHJlc2l6aW5nIGFuZCByZWFkanVzdGluZyB0aGUgc2xpZGVzDQoJCQkJJC5pc0Z1bmN0aW9uKG9wdGlvbnMub25MZWF2ZSkgJiYgIWxvY2FsSXNSZXNpemluZyAmJiBvcHRpb25zLm9uTGVhdmUuY2FsbCh0aGlzLCBsZWF2aW5nU2VjdGlvbiwgeU1vdmVtZW50KTsNCg0KCQkJCSQoc2Nyb2xsZWRFbGVtZW50KS5hbmltYXRlKA0KCQkJCQlzY3JvbGxPcHRpb25zDQoJCQkJLCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkLCBvcHRpb25zLmVhc2luZywgZnVuY3Rpb24gKCkgew0KCQkJCQkvL2ZpeCBzZWN0aW9uIG9yZGVyIGZyb20gY29udGludW91c1ZlcnRpY2FsDQoJCQkJCWNvbnRpbnVvdXNWZXJ0aWNhbEZpeFNlY3Rpb25PcmRlcigpOw0KDQoJCQkJCS8vY2FsbGJhY2sgKGFmdGVyTG9hZCkgaWYgdGhlIHNpdGUgaXMgbm90IGp1c3QgcmVzaXppbmcgYW5kIHJlYWRqdXN0aW5nIHRoZSBzbGlkZXMNCgkJCQkJJC5pc0Z1bmN0aW9uKG9wdGlvbnMuYWZ0ZXJMb2FkKSAmJiAhbG9jYWxJc1Jlc2l6aW5nICYmIG9wdGlvbnMuYWZ0ZXJMb2FkLmNhbGwodGhpcywgYW5jaG9yTGluaywgKHNlY3Rpb25JbmRleCArIDEpKTsNCg0KCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkJCWlzTW92aW5nID0gZmFsc2U7DQoJCQkJCQkkLmlzRnVuY3Rpb24oY2FsbGJhY2spICYmIGNhbGxiYWNrLmNhbGwodGhpcyk7DQoJCQkJCX0sIHNjcm9sbERlbGF5KTsNCgkJCQl9KTsNCgkJCX0NCg0KCQkJLy9mbGFnIHRvIGF2b2lkIGNhbGxpbmduIGBzY3JvbGxQYWdlKClgIHR3aWNlIGluIGNhc2Ugb2YgdXNpbmcgYW5jaG9yIGxpbmtzDQoJCQlsYXN0U2Nyb2xsZWREZXN0aW55ID0gYW5jaG9yTGluazsNCgkJCQ0KCQkJLy9hdm9pZCBmaXJpbmcgaXQgdHdpY2UgKGFzIGl0IGRvZXMgYWxzbyBvbiBzY3JvbGwpDQoJCQlpZihvcHRpb25zLmF1dG9TY3JvbGxpbmcpew0KCQkJCWFjdGl2YXRlTWVudUVsZW1lbnQoYW5jaG9yTGluayk7DQoJCQkJYWN0aXZhdGVOYXZEb3RzKGFuY2hvckxpbmssIHNlY3Rpb25JbmRleCk7DQoJCQl9DQoJCX0NCgkJDQoJCWZ1bmN0aW9uIHNjcm9sbFRvQW5jaG9yKCl7DQoJCQkvL2dldHRpbmcgdGhlIGFuY2hvciBsaW5rIGluIHRoZSBVUkwgYW5kIGRlbGV0aW5nIHRoZSBgI2ANCgkJCXZhciB2YWx1ZSA9ICB3aW5kb3cubG9jYXRpb24uaGFzaC5yZXBsYWNlKCcjJywgJycpLnNwbGl0KCcvJyk7DQoJCQl2YXIgc2VjdGlvbiA9IHZhbHVlWzBdOw0KCQkJdmFyIHNsaWRlID0gdmFsdWVbMV07DQoNCgkJCWlmKHNlY3Rpb24peyAgLy9pZiB0aGVyZXMgYW55ICMJCQkJDQoJCQkJc2Nyb2xsUGFnZUFuZFNsaWRlKHNlY3Rpb24sIHNsaWRlKTsNCgkJCX0NCgkJfQ0KDQoJCS8vZGV0ZWN0aW5nIGFueSBjaGFuZ2Ugb24gdGhlIFVSTCB0byBzY3JvbGwgdG8gdGhlIGdpdmVuIGFuY2hvciBsaW5rDQoJCS8vKGEgd2F5IHRvIGRldGVjdCBiYWNrIGhpc3RvcnkgYnV0dG9uIGFzIHdlIHBsYXkgd2l0aCB0aGUgaGFzaGVzIG9uIHRoZSBVUkwpDQoJCSQod2luZG93KS5vbignaGFzaGNoYW5nZScsZnVuY3Rpb24oKXsNCgkJCWlmKCFpc1Njcm9sbGluZyl7DQoJCQkJdmFyIHZhbHVlID0gIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCAnJykuc3BsaXQoJy8nKTsNCgkJCQl2YXIgc2VjdGlvbiA9IHZhbHVlWzBdOw0KCQkJCXZhciBzbGlkZSA9IHZhbHVlWzFdOw0KDQoJCQkJLy93aGVuIG1vdmluZyB0byBhIHNsaWRlIGluIHRoZSBmaXJzdCBzZWN0aW9uIGZvciB0aGUgZmlyc3QgdGltZSAoZmlyc3QgdGltZSB0byBhZGQgYW4gYW5jaG9yIHRvIHRoZSBVUkwpDQoJCQkJdmFyIGlzRmlyc3RTbGlkZU1vdmUgPSAgKHR5cGVvZiBsYXN0U2Nyb2xsZWREZXN0aW55ID09PSAndW5kZWZpbmVkJyk7DQoJCQkJdmFyIGlzRmlyc3RTY3JvbGxNb3ZlID0gKHR5cGVvZiBsYXN0U2Nyb2xsZWREZXN0aW55ID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygc2xpZGUgPT09ICd1bmRlZmluZWQnKTsNCg0KCQkJCS8qaW4gb3JkZXIgdG8gY2FsbCBzY3JvbGxwYWdlKCkgb25seSBvbmNlIGZvciBlYWNoIGRlc3RpbmF0aW9uIGF0IGEgdGltZQ0KCQkJCUl0IGlzIGNhbGxlZCB0d2ljZSBmb3IgZWFjaCBzY3JvbGwgb3RoZXJ3aXNlLCBhcyBpbiBjYXNlIG9mIHVzaW5nIGFuY2hvcmxpbmtzIGBoYXNoQ2hhbmdlYCANCgkJCQlldmVudCBpcyBmaXJlZCBvbiBldmVyeSBzY3JvbGwgdG9vLiovDQoJCQkJaWYgKChzZWN0aW9uICYmIHNlY3Rpb24gIT09IGxhc3RTY3JvbGxlZERlc3RpbnkpICYmICFpc0ZpcnN0U2xpZGVNb3ZlIHx8IGlzRmlyc3RTY3JvbGxNb3ZlIHx8ICghc2xpZGVNb3ZpbmcgJiYgbGFzdFNjcm9sbGVkU2xpZGUgIT0gc2xpZGUgKSkgIHsNCgkJCQkJc2Nyb2xsUGFnZUFuZFNsaWRlKHNlY3Rpb24sIHNsaWRlKTsNCgkJCQl9DQoJCQl9DQoJCQkNCgkJfSk7DQoNCg0KCQkvKioNCgkJICogU2xpZGluZyB3aXRoIGFycm93IGtleXMsIGJvdGgsIHZlcnRpY2FsIGFuZCBob3Jpem9udGFsDQoJCSAqLw0KCQkkKGRvY3VtZW50KS5rZXlkb3duKGZ1bmN0aW9uKGUpIHsNCgkJCS8vTW92aW5nIHRoZSBtYWluIHBhZ2Ugd2l0aCB0aGUga2V5Ym9hcmQgYXJyb3dzIGlmIGtleWJvYXJkIHNjcm9sbGluZyBpcyBlbmFibGVkDQoJCQlpZiAob3B0aW9ucy5rZXlib2FyZFNjcm9sbGluZyAmJiAhaXNNb3ZpbmcpIHsNCgkJCQlzd2l0Y2ggKGUud2hpY2gpIHsNCgkJCQkJLy91cA0KCQkJCQljYXNlIDM4Og0KCQkJCQljYXNlIDMzOg0KCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvblVwKCk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQkvL2Rvd24NCgkJCQkJY2FzZSA0MDoNCgkJCQkJY2FzZSAzNDoNCgkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25Eb3duKCk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQkvL2xlZnQNCgkJCQkJY2FzZSAzNzoNCgkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlTGVmdCgpOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJLy9yaWdodA0KCQkJCQljYXNlIDM5Og0KCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVSaWdodCgpOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJZGVmYXVsdDoNCgkJCQkJCXJldHVybjsgLy8gZXhpdCB0aGlzIGhhbmRsZXIgZm9yIG90aGVyIGtleXMNCgkJCQl9DQoJCQl9DQoJCX0pOw0KCQkNCgkJLy9uYXZpZ2F0aW9uIGFjdGlvbiANCgkJJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNmdWxsUGFnZS1uYXYgYScsIGZ1bmN0aW9uKGUpew0KCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJdmFyIGluZGV4ID0gJCh0aGlzKS5wYXJlbnQoKS5pbmRleCgpOw0KCQkJc2Nyb2xsUGFnZSgkKCcuc2VjdGlvbicpLmVxKGluZGV4KSk7DQoJCX0pOw0KCQkNCgkJLy9uYXZpZ2F0aW9uIHRvb2x0aXBzIA0KCQkkKGRvY3VtZW50KS5vbih7DQoJCQltb3VzZWVudGVyOiBmdW5jdGlvbigpew0KCQkJCXZhciB0b29sdGlwID0gJCh0aGlzKS5kYXRhKCd0b29sdGlwJyk7DQoJCQkJJCgnPGRpdiBjbGFzcz0iZnVsbFBhZ2UtdG9vbHRpcCAnICsgb3B0aW9ucy5uYXZpZ2F0aW9uUG9zaXRpb24gKyciPicgKyB0b29sdGlwICsgJzwvZGl2PicpLmhpZGUoKS5hcHBlbmRUbygkKHRoaXMpKS5mYWRlSW4oMjAwKTsNCgkJCX0sDQoJCQltb3VzZWxlYXZlOiBmdW5jdGlvbigpew0KCQkJCSQodGhpcykuZmluZCgnLmZ1bGxQYWdlLXRvb2x0aXAnKS5mYWRlT3V0KCkucmVtb3ZlKCk7DQoJCQl9DQoJCX0sICcjZnVsbFBhZ2UtbmF2IGxpJyk7DQoNCg0KCQlpZihvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzKXsNCgkJCSQoZG9jdW1lbnQpLm9uKCdtb3VzZW92ZXInLCBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzLCBmdW5jdGlvbiAoKSB7DQoJCQkJJC5mbi5mdWxscGFnZS5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nKGZhbHNlKTsNCgkJCX0pOw0KCQkJDQoJCQkkKGRvY3VtZW50KS5vbignbW91c2VvdXQnLCBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzLCBmdW5jdGlvbigpew0KCQkJCSQuZm4uZnVsbHBhZ2Uuc2V0TW91c2VXaGVlbFNjcm9sbGluZyh0cnVlKTsNCgkJCX0pOw0KCQl9DQoJCQ0KCQkvKioNCgkJICogU2Nyb2xsaW5nIGhvcml6b250YWxseSB3aGVuIGNsaWNraW5nIG9uIHRoZSBzbGlkZXIgY29udHJvbHMuDQoJCSAqLw0KCQkkKCcuc2VjdGlvbicpLm9uKCdjbGljaycsICcuY29udHJvbEFycm93JywgZnVuY3Rpb24oKSB7DQoJCQlpZiAoJCh0aGlzKS5oYXNDbGFzcygncHJldicpKSB7DQoJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVMZWZ0KCk7DQoJCQl9IGVsc2Ugew0KCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlUmlnaHQoKTsNCgkJCX0NCgkJfSk7DQoNCgkJDQoJCS8qKg0KCQkgKiBTY3JvbGxpbmcgaG9yaXpvbnRhbGx5IHdoZW4gY2xpY2tpbmcgb24gdGhlIHNsaWRlciBjb250cm9scy4NCgkJICovDQoJCSQoJy5zZWN0aW9uJykub24oJ2NsaWNrJywgJy50b1NsaWRlJywgZnVuY3Rpb24oZSkgew0KCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJDQoJCQl2YXIgc2xpZGVzID0gJCh0aGlzKS5jbG9zZXN0KCcuc2VjdGlvbicpLmZpbmQoJy5zbGlkZXMnKTsNCgkJCXZhciBjdXJyZW50U2xpZGUgPSBzbGlkZXMuZmluZCgnLnNsaWRlLmFjdGl2ZScpOw0KCQkJdmFyIGRlc3RpbnkgPSBudWxsOw0KCQkJDQoJCQlkZXN0aW55ID0gc2xpZGVzLmZpbmQoJy5zbGlkZScpLmVxKCAoJCh0aGlzKS5kYXRhKCdpbmRleCcpIC0xKSApOw0KDQoJCQlpZihkZXN0aW55Lmxlbmd0aCA+IDApew0KCQkJCWxhbmRzY2FwZVNjcm9sbChzbGlkZXMsIGRlc3RpbnkpOw0KCQkJfQ0KCQl9KTsNCgkJDQoJCS8qKg0KCQkqIFNjcm9sbHMgaG9yaXpvbnRhbCBzbGlkZXJzLg0KCQkqLw0KCQlmdW5jdGlvbiBsYW5kc2NhcGVTY3JvbGwoc2xpZGVzLCBkZXN0aW55KXsNCgkJCXZhciBkZXN0aW55UG9zID0gZGVzdGlueS5wb3NpdGlvbigpOw0KCQkJdmFyIHNsaWRlc0NvbnRhaW5lciA9IHNsaWRlcy5maW5kKCcuc2xpZGVzQ29udGFpbmVyJykucGFyZW50KCk7DQoJCQl2YXIgc2xpZGVJbmRleCA9IGRlc3RpbnkuaW5kZXgoKTsNCgkJCXZhciBzZWN0aW9uID0gc2xpZGVzLmNsb3Nlc3QoJy5zZWN0aW9uJyk7DQoJCQl2YXIgc2VjdGlvbkluZGV4ID0gc2VjdGlvbi5pbmRleCgnLnNlY3Rpb24nKTsNCgkJCXZhciBhbmNob3JMaW5rID0gc2VjdGlvbi5kYXRhKCdhbmNob3InKTsNCgkJCXZhciBzbGlkZXNOYXYgPSBzZWN0aW9uLmZpbmQoJy5mdWxsUGFnZS1zbGlkZXNOYXYnKTsNCgkJCXZhciBzbGlkZUFuY2hvciA9IGRlc3RpbnkuZGF0YSgnYW5jaG9yJyk7DQoJDQoJCQkvL2NhY2hpbmcgdGhlIHZhbHVlIG9mIGlzUmVzaXppbmcgYXQgdGhlIG1vbW1lbnQgdGhlIGZ1bmN0aW9uIGlzIGNhbGxlZCANCgkJCS8vYmVjYXVzZSBpdCB3aWxsIGJlIGNoZWNrZWQgbGF0ZXIgaW5zaWRlIGEgc2V0VGltZW91dCBhbmQgdGhlIHZhbHVlIG1pZ2h0IGNoYW5nZQ0KCQkJdmFyIGxvY2FsSXNSZXNpemluZyA9IGlzUmVzaXppbmc7IA0KDQoJCQlpZihvcHRpb25zLm9uU2xpZGVMZWF2ZSl7DQoJCQkJdmFyIHByZXZTbGlkZUluZGV4ID0gc2VjdGlvbi5maW5kKCcuc2xpZGUuYWN0aXZlJykuaW5kZXgoKTsNCgkJCQl2YXIgeE1vdmVtZW50ID0gZ2V0WG1vdmVtZW50KHByZXZTbGlkZUluZGV4LCBzbGlkZUluZGV4KTsNCg0KCQkJCS8vaWYgdGhlIHNpdGUgaXMgbm90IGp1c3QgcmVzaXppbmcgYW5kIHJlYWRqdXN0aW5nIHRoZSBzbGlkZXMNCgkJCQlpZighbG9jYWxJc1Jlc2l6aW5nKXsNCgkJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLm9uU2xpZGVMZWF2ZSApICYmIG9wdGlvbnMub25TbGlkZUxlYXZlLmNhbGwoIHRoaXMsIGFuY2hvckxpbmssIChzZWN0aW9uSW5kZXggKyAxKSwgcHJldlNsaWRlSW5kZXgsIHhNb3ZlbWVudCk7DQoJCQkJfQ0KCQkJfQ0KCQ0KCQkJZGVzdGlueS5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoNCgkJCQ0KCQkJaWYodHlwZW9mIHNsaWRlQW5jaG9yID09PSAndW5kZWZpbmVkJyl7DQoJCQkJc2xpZGVBbmNob3IgPSBzbGlkZUluZGV4Ow0KCQkJfQ0KCQkJDQoJCQkvL29ubHkgY2hhbmdpbmcgdGhlIFVSTCBpZiB0aGUgc2xpZGVzIGFyZSBpbiB0aGUgY3VycmVudCBzZWN0aW9uIChub3QgZm9yIHJlc2l6ZSByZS1hZGp1c3RpbmcpDQoJCQlpZihzZWN0aW9uLmhhc0NsYXNzKCdhY3RpdmUnKSl7DQoJCQkNCgkJCQlpZighb3B0aW9ucy5sb29wSG9yaXpvbnRhbCl7DQoJCQkJCS8vaGlkZGluZyBpdCBmb3IgdGhlIGZpc3Qgc2xpZGUsIHNob3dpbmcgZm9yIHRoZSByZXN0DQoJCQkJCXNlY3Rpb24uZmluZCgnLmNvbnRyb2xBcnJvdy5wcmV2JykudG9nZ2xlKHNsaWRlSW5kZXghPTApOw0KDQoJCQkJCS8vaGlkZGluZyBpdCBmb3IgdGhlIGxhc3Qgc2xpZGUsIHNob3dpbmcgZm9yIHRoZSByZXN0DQoJCQkJCXNlY3Rpb24uZmluZCgnLmNvbnRyb2xBcnJvdy5uZXh0JykudG9nZ2xlKCFkZXN0aW55LmlzKCc6bGFzdC1jaGlsZCcpKTsNCgkJCQl9DQoNCgkJCQlzZXRVUkxIYXNoKHNsaWRlSW5kZXgsIHNsaWRlQW5jaG9yLCBhbmNob3JMaW5rKTsJCQkJDQoJCQl9CQkJDQoNCgkJCWlmKG9wdGlvbnMuY3NzMyl7DQoJCQkJdmFyIHRyYW5zbGF0ZTNkID0gJ3RyYW5zbGF0ZTNkKC0nICsgZGVzdGlueVBvcy5sZWZ0ICsgJ3B4LCAwcHgsIDBweCknOw0KDQoJCQkJc2xpZGVzLmZpbmQoJy5zbGlkZXNDb250YWluZXInKS50b2dnbGVDbGFzcygnZWFzaW5nJywgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZD4wKS5jc3MoZ2V0VHJhbnNmb3Jtcyh0cmFuc2xhdGUzZCkpOw0KDQoJCQkJc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkJCQkvL2lmIHRoZSBzaXRlIGlzIG5vdCBqdXN0IHJlc2l6aW5nIGFuZCByZWFkanVzdGluZyB0aGUgc2xpZGVzDQoJCQkJCWlmKCFsb2NhbElzUmVzaXppbmcpew0KCQkJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyU2xpZGVMb2FkICkgJiYgb3B0aW9ucy5hZnRlclNsaWRlTG9hZC5jYWxsKCB0aGlzLCBhbmNob3JMaW5rLCAoc2VjdGlvbkluZGV4ICsgMSksIHNsaWRlQW5jaG9yLCBzbGlkZUluZGV4ICk7DQoJCQkJCX0NCg0KCQkJCQlzbGlkZU1vdmluZyA9IGZhbHNlOw0KCQkJCX0sIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQsIG9wdGlvbnMuZWFzaW5nKTsNCgkJCX1lbHNlew0KCQkJCXNsaWRlc0NvbnRhaW5lci5hbmltYXRlKHsNCgkJCQkJc2Nyb2xsTGVmdCA6IGRlc3RpbnlQb3MubGVmdA0KCQkJCX0sIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQsIG9wdGlvbnMuZWFzaW5nLCBmdW5jdGlvbigpIHsNCg0KCQkJCQkvL2lmIHRoZSBzaXRlIGlzIG5vdCBqdXN0IHJlc2l6aW5nIGFuZCByZWFkanVzdGluZyB0aGUgc2xpZGVzDQoJCQkJCWlmKCFsb2NhbElzUmVzaXppbmcpew0KCQkJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyU2xpZGVMb2FkICkgJiYgb3B0aW9ucy5hZnRlclNsaWRlTG9hZC5jYWxsKCB0aGlzLCBhbmNob3JMaW5rLCAoc2VjdGlvbkluZGV4ICsgMSksIHNsaWRlQW5jaG9yLCBzbGlkZUluZGV4KTsNCgkJCQkJfQkNCgkJCQkJLy9sZXR0aW5nIHRoZW0gc2xpZGUgYWdhaW4NCgkJCQkJc2xpZGVNb3ZpbmcgPSBmYWxzZTsgDQoJCQkJfSk7DQoJCQl9DQoJCQkNCgkJCXNsaWRlc05hdi5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJc2xpZGVzTmF2LmZpbmQoJ2xpJykuZXEoc2xpZGVJbmRleCkuZmluZCgnYScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJfQ0KCQkNCgkJDQoJCWlmICghaXNUYWJsZXQpIHsNCgkJCXZhciByZXNpemVJZDsNCg0KCQkJLy93aGVuIHJlc2l6aW5nIHRoZSBzaXRlLCB3ZSBhZGp1c3QgdGhlIGhlaWdodHMgb2YgdGhlIHNlY3Rpb25zDQoJCQkkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkgew0KCQkJCS8vaW4gb3JkZXIgdG8gY2FsbCB0aGUgZnVuY3Rpb25zIG9ubHkgd2hlbiB0aGUgcmVzaXplIGlzIGZpbmlzaGVkDQoJCQkJLy9odHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzQyOTg2MTIvanF1ZXJ5LWhvdy10by1jYWxsLXJlc2l6ZS1ldmVudC1vbmx5LW9uY2UtaXRzLWZpbmlzaGVkLXJlc2l6aW5nDQoJCQkJY2xlYXJUaW1lb3V0KHJlc2l6ZUlkKTsNCgkJCQlyZXNpemVJZCA9IHNldFRpbWVvdXQoZG9uZVJlc2l6aW5nLCA1MDApOw0KCQkJfSk7DQoJCQ0KCQl9DQoJCQ0KCQkNCgkJdmFyIHN1cHBvcnRzT3JpZW50YXRpb25DaGFuZ2UgPSAib25vcmllbnRhdGlvbmNoYW5nZSIgaW4gd2luZG93LA0KCQlvcmllbnRhdGlvbkV2ZW50ID0gc3VwcG9ydHNPcmllbnRhdGlvbkNoYW5nZSA/ICJvcmllbnRhdGlvbmNoYW5nZSIgOiAicmVzaXplIjsNCgkJDQoJCSQod2luZG93KS5iaW5kKG9yaWVudGF0aW9uRXZlbnQgLCBmdW5jdGlvbigpIHsNCgkJCWlmKGlzVGFibGV0KXsNCgkJCQlkb25lUmVzaXppbmcoKTsNCgkJCX0NCgkJfSk7DQoJCQ0KDQoJCS8qKg0KCQkgKiBXaGVuIHJlc2l6aW5nIGlzIGZpbmlzaGVkLCB3ZSBhZGp1c3QgdGhlIHNsaWRlcyBzaXplcyBhbmQgcG9zaXRpb25zDQoJCSAqLw0KCQlmdW5jdGlvbiBkb25lUmVzaXppbmcoKSB7DQoJCQlpc1Jlc2l6aW5nID0gdHJ1ZTsNCg0KCQkJdmFyIHdpbmRvd3NXaWR0aCA9ICQod2luZG93KS53aWR0aCgpOw0KCQkJd2luZG93c0hlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKTsNCg0KCQkJLy90ZXh0IGFuZCBpbWFnZXMgcmVzaXppbmcNCgkJCWlmIChvcHRpb25zLnJlc2l6ZSkgew0KCQkJCXJlc2l6ZU1lKHdpbmRvd3NIZWlnaHQsIHdpbmRvd3NXaWR0aCk7DQoJCQl9DQoNCgkJCSQoJy5zZWN0aW9uJykuZWFjaChmdW5jdGlvbigpew0KCQkJCXZhciBzY3JvbGxIZWlnaHQgPSB3aW5kb3dzSGVpZ2h0IC0gcGFyc2VJbnQoJCh0aGlzKS5jc3MoJ3BhZGRpbmctYm90dG9tJykpIC0gcGFyc2VJbnQoJCh0aGlzKS5jc3MoJ3BhZGRpbmctdG9wJykpOw0KCQkJDQoJCQkJLy9hZGp1c3RpbmcgdGhlIGhlaWdodCBvZiB0aGUgdGFibGUtY2VsbCBmb3IgSUUgYW5kIEZpcmVmb3gNCgkJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCQkkKHRoaXMpLmZpbmQoJy50YWJsZUNlbGwnKS5jc3MoJ2hlaWdodCcsIGdldFRhYmxlSGVpZ2h0KCQodGhpcykpICsgJ3B4Jyk7DQoJCQkJfQ0KCQkJCQ0KCQkJCSQodGhpcykuY3NzKCdoZWlnaHQnLCB3aW5kb3dzSGVpZ2h0ICsgJ3B4Jyk7DQoNCgkJCQkvL3Jlc2l6aW5nIHRoZSBzY3JvbGxpbmcgZGl2cw0KCQkJCWlmKG9wdGlvbnMuc2Nyb2xsT3ZlcmZsb3cpew0KCQkJCQl2YXIgc2xpZGVzID0gJCh0aGlzKS5maW5kKCcuc2xpZGUnKTsNCgkJCQkJDQoJCQkJCWlmKHNsaWRlcy5sZW5ndGgpew0KCQkJCQkJc2xpZGVzLmVhY2goZnVuY3Rpb24oKXsNCgkJCQkJCQljcmVhdGVTbGltU2Nyb2xsaW5nKCQodGhpcykpOw0KCQkJCQkJfSk7DQoJCQkJCX1lbHNlew0KCQkJCQkJY3JlYXRlU2xpbVNjcm9sbGluZygkKHRoaXMpKTsNCgkJCQkJfQ0KCQkJCQkNCgkJCQl9DQoJCQkJDQoNCgkJCQkvL2FkanVzdGluZyB0aGUgcG9zaXRpb24gZm8gdGhlIEZVTEwgV0lEVEggc2xpZGVzLi4uDQoJCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuZmluZCgnLnNsaWRlcycpOw0KCQkJCWlmIChzbGlkZXMubGVuZ3RoKSB7DQoJCQkJCWxhbmRzY2FwZVNjcm9sbChzbGlkZXMsIHNsaWRlcy5maW5kKCcuc2xpZGUuYWN0aXZlJykpOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQkvL2FkanVzdGluZyB0aGUgcG9zaXRpb24gZm9yIHRoZSBjdXJyZW50IHNlY3Rpb24NCgkJCXZhciBkZXN0aW55UG9zID0gJCgnLnNlY3Rpb24uYWN0aXZlJykucG9zaXRpb24oKTsNCg0KCQkJdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcuc2VjdGlvbi5hY3RpdmUnKTsNCgkJCQ0KCQkJLy9pc24ndCBpdCB0aGUgZmlyc3Qgc2VjdGlvbj8NCgkJCWlmKGFjdGl2ZVNlY3Rpb24uaW5kZXgoJy5zZWN0aW9uJykpew0KCQkJCXNjcm9sbFBhZ2UoYWN0aXZlU2VjdGlvbik7DQoJCQl9DQoNCgkJCWlzUmVzaXppbmcgPSBmYWxzZTsNCgkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlclJlc2l6ZSApICYmIG9wdGlvbnMuYWZ0ZXJSZXNpemUuY2FsbCggdGhpcyk7DQoJCX0NCg0KCQkvKioNCgkJICogUmVzaXppbmcgb2YgdGhlIGZvbnQgc2l6ZSBkZXBlbmRpbmcgb24gdGhlIHdpbmRvdyBzaXplIGFzIHdlbGwgYXMgc29tZSBvZiB0aGUgaW1hZ2VzIG9uIHRoZSBzaXRlLg0KCQkgKi8NCgkJZnVuY3Rpb24gcmVzaXplTWUoZGlzcGxheUhlaWdodCwgZGlzcGxheVdpZHRoKSB7DQoJCQkvL1N0YW5kYXJkIGhlaWdodCwgZm9yIHdoaWNoIHRoZSBib2R5IGZvbnQgc2l6ZSBpcyBjb3JyZWN0DQoJCQl2YXIgcHJlZmVycmVkSGVpZ2h0ID0gODI1Ow0KCQkJdmFyIHdpbmRvd1NpemUgPSBkaXNwbGF5SGVpZ2h0Ow0KDQoJCQkvKiBQcm9ibGVtIHRvIGJlIHNvbHZlZA0KCQkJDQoJCQlpZiAoZGlzcGxheUhlaWdodCA8IDgyNSkgew0KCQkJCXZhciBwZXJjZW50YWdlID0gKHdpbmRvd1NpemUgKiAxMDApIC8gcHJlZmVycmVkSGVpZ2h0Ow0KCQkJCXZhciBuZXdGb250U2l6ZSA9IHBlcmNlbnRhZ2UudG9GaXhlZCgyKTsNCg0KCQkJCSQoImltZyIpLmVhY2goZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBuZXdXaWR0aCA9ICgoODAgKiBwZXJjZW50YWdlKSAvIDEwMCkudG9GaXhlZCgyKTsNCgkJCQkJJCh0aGlzKS5jc3MoIndpZHRoIiwgbmV3V2lkdGggKyAnJScpOw0KCQkJCX0pOw0KCQkJfSBlbHNlIHsNCgkJCQkkKCJpbWciKS5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQkkKHRoaXMpLmNzcygid2lkdGgiLCAnJyk7DQoJCQkJfSk7DQoJCQl9Ki8NCg0KCQkJaWYgKGRpc3BsYXlIZWlnaHQgPCA4MjUgfHwgZGlzcGxheVdpZHRoIDwgOTAwKSB7DQoJCQkJaWYgKGRpc3BsYXlXaWR0aCA8IDkwMCkgew0KCQkJCQl3aW5kb3dTaXplID0gZGlzcGxheVdpZHRoOw0KCQkJCQlwcmVmZXJyZWRIZWlnaHQgPSA5MDA7DQoJCQkJfQ0KCQkJCXZhciBwZXJjZW50YWdlID0gKHdpbmRvd1NpemUgKiAxMDApIC8gcHJlZmVycmVkSGVpZ2h0Ow0KCQkJCXZhciBuZXdGb250U2l6ZSA9IHBlcmNlbnRhZ2UudG9GaXhlZCgyKTsNCg0KCQkJCSQoImJvZHkiKS5jc3MoImZvbnQtc2l6ZSIsIG5ld0ZvbnRTaXplICsgJyUnKTsNCgkJCX0gZWxzZSB7DQoJCQkJJCgiYm9keSIpLmNzcygiZm9udC1zaXplIiwgJzEwMCUnKTsNCgkJCX0NCgkJfQ0KCQkNCgkJLyoqDQoJCSAqIEFjdGl2YXRpbmcgdGhlIHdlYnNpdGUgbmF2aWdhdGlvbiBkb3RzIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gc2xpZGUgbmFtZS4NCgkJICovDQoJCWZ1bmN0aW9uIGFjdGl2YXRlTmF2RG90cyhuYW1lLCBzZWN0aW9uSW5kZXgpew0KCQkJaWYob3B0aW9ucy5uYXZpZ2F0aW9uKXsNCgkJCQkkKCcjZnVsbFBhZ2UtbmF2JykuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCQlpZihuYW1lKXsgDQoJCQkJCSQoJyNmdWxsUGFnZS1uYXYnKS5maW5kKCdhW2hyZWY9IiMnICsgbmFtZSArICciXScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCQl9ZWxzZXsNCgkJCQkJJCgnI2Z1bGxQYWdlLW5hdicpLmZpbmQoJ2xpJykuZXEoc2VjdGlvbkluZGV4KS5maW5kKCdhJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQkJCQ0KCQkvKioNCgkJICogQWN0aXZhdGluZyB0aGUgd2Vic2l0ZSBtYWluIG1lbnUgZWxlbWVudHMgYWNjb3JkaW5nIHRvIHRoZSBnaXZlbiBzbGlkZSBuYW1lLg0KCQkgKi8NCgkJZnVuY3Rpb24gYWN0aXZhdGVNZW51RWxlbWVudChuYW1lKXsNCgkJCWlmKG9wdGlvbnMubWVudSl7DQoJCQkJJChvcHRpb25zLm1lbnUpLmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQkJJChvcHRpb25zLm1lbnUpLmZpbmQoJ1tkYXRhLW1lbnVhbmNob3I9IicrbmFtZSsnIl0nKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQl9DQoJCX0NCgkJDQoJCS8qKg0KCQkqIFJldHVybiBhIGJvb2xlYW4gZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIHNjcm9sbGFibGUgZWxlbWVudCBpcyBhdCB0aGUgZW5kIG9yIGF0IHRoZSBzdGFydCBvZiB0aGUgc2Nyb2xsaW5nDQoJCSogZGVwZW5kaW5nIG9uIHRoZSBnaXZlbiB0eXBlLg0KCQkqLw0KCQlmdW5jdGlvbiBpc1Njcm9sbGVkKHR5cGUsIHNjcm9sbGFibGUpew0KCQkJaWYodHlwZSA9PT0gJ3RvcCcpew0KCQkJCXJldHVybiAhc2Nyb2xsYWJsZS5zY3JvbGxUb3AoKTsNCgkJCX1lbHNlIGlmKHR5cGUgPT09ICdib3R0b20nKXsNCgkJCQlyZXR1cm4gc2Nyb2xsYWJsZS5zY3JvbGxUb3AoKSArIHNjcm9sbGFibGUuaW5uZXJIZWlnaHQoKSA+PSBzY3JvbGxhYmxlWzBdLnNjcm9sbEhlaWdodDsNCgkJCX0NCgkJfQ0KCQkNCgkJLyoqDQoJCSogUmV0dW5zIGB1cGAgb3IgYGRvd25gIGRlcGVuZGluZyBvbiB0aGUgc2Nyb2xsaW5nIG1vdmVtZW50IHRvIHJlYWNoIGl0cyBkZXN0aW5hdGlvbg0KCQkqIGZyb20gdGhlIGN1cnJlbnQgc2VjdGlvbi4NCgkJKi8NCgkJZnVuY3Rpb24gZ2V0WW1vdmVtZW50KGRlc3Rpbnkpew0KCQkJdmFyIGZyb21JbmRleCA9ICQoJy5zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcuc2VjdGlvbicpOw0KCQkJdmFyIHRvSW5kZXggPSBkZXN0aW55LmluZGV4KCcuc2VjdGlvbicpOw0KCQkJDQoJCQlpZihmcm9tSW5kZXggPiB0b0luZGV4KXsNCgkJCQlyZXR1cm4gJ3VwJzsNCgkJCX0NCgkJCXJldHVybiAnZG93bic7DQoJCX0JDQoNCgkJLyoqDQoJCSogUmV0dW5zIGByaWdodGAgb3IgYGxlZnRgIGRlcGVuZGluZyBvbiB0aGUgc2Nyb2xsaW5nIG1vdmVtZW50IHRvIHJlYWNoIGl0cyBkZXN0aW5hdGlvbg0KCQkqIGZyb20gdGhlIGN1cnJlbnQgc2xpZGUuDQoJCSovDQoJCWZ1bmN0aW9uIGdldFhtb3ZlbWVudChmcm9tSW5kZXgsIHRvSW5kZXgpew0KCQkJaWYoIGZyb21JbmRleCA9PSB0b0luZGV4KXsNCgkJCQlyZXR1cm4gJ25vbmUnDQoJCQl9DQoJCQlpZihmcm9tSW5kZXggPiB0b0luZGV4KXsNCgkJCQlyZXR1cm4gJ2xlZnQnOw0KCQkJfQ0KCQkJcmV0dXJuICdyaWdodCc7DQoJCX0JCQ0KCQkNCgkJDQoJCWZ1bmN0aW9uIGNyZWF0ZVNsaW1TY3JvbGxpbmcoZWxlbWVudCl7DQoJCQkvL25lZWRlZCB0byBtYWtlIGBzY3JvbGxIZWlnaHRgIHdvcmsgdW5kZXIgT3BlcmEgMTINCgkJCWVsZW1lbnQuY3NzKCdvdmVyZmxvdycsICdoaWRkZW4nKTsNCgkJCQ0KCQkJLy9pbiBjYXNlIGVsZW1lbnQgaXMgYSBzbGlkZQ0KCQkJdmFyIHNlY3Rpb24gPSBlbGVtZW50LmNsb3Nlc3QoJy5zZWN0aW9uJyk7DQoJCQl2YXIgc2Nyb2xsYWJsZSA9IGVsZW1lbnQuZmluZCgnLnNjcm9sbGFibGUnKTsNCg0KCQkJLy9pZiB0aGVyZSB3YXMgc2Nyb2xsLCB0aGUgY29udGVudEhlaWdodCB3aWxsIGJlIHRoZSBvbmUgaW4gdGhlIHNjcm9sbGFibGUgc2VjdGlvbg0KCQkJaWYoc2Nyb2xsYWJsZS5sZW5ndGgpew0KCQkJCXZhciBjb250ZW50SGVpZ2h0ID0gZWxlbWVudC5maW5kKCcuc2Nyb2xsYWJsZScpLmdldCgwKS5zY3JvbGxIZWlnaHQ7DQoJCQl9ZWxzZXsNCgkJCQl2YXIgY29udGVudEhlaWdodCA9IGVsZW1lbnQuZ2V0KDApLnNjcm9sbEhlaWdodDsNCgkJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCQljb250ZW50SGVpZ2h0ID0gZWxlbWVudC5maW5kKCcudGFibGVDZWxsJykuZ2V0KDApLnNjcm9sbEhlaWdodDsNCgkJCQl9DQoJCQl9DQoNCgkJCXZhciBzY3JvbGxIZWlnaHQgPSB3aW5kb3dzSGVpZ2h0IC0gcGFyc2VJbnQoc2VjdGlvbi5jc3MoJ3BhZGRpbmctYm90dG9tJykpIC0gcGFyc2VJbnQoc2VjdGlvbi5jc3MoJ3BhZGRpbmctdG9wJykpOw0KDQoJCQkvL25lZWRzIHNjcm9sbD8NCgkJCWlmICggY29udGVudEhlaWdodCA+IHNjcm9sbEhlaWdodCkgew0KCQkJCS8vd2FzIHRoZXJlIGFscmVhZHkgYW4gc2Nyb2xsID8gVXBkYXRpbmcgaXQNCgkJCQlpZihzY3JvbGxhYmxlLmxlbmd0aCl7DQoJCQkJCXNjcm9sbGFibGUuY3NzKCdoZWlnaHQnLCBzY3JvbGxIZWlnaHQgKyAncHgnKS5wYXJlbnQoKS5jc3MoJ2hlaWdodCcsIHNjcm9sbEhlaWdodCArICdweCcpOw0KCQkJCX0NCgkJCQkvL2NyZWF0aW5nIHRoZSBzY3JvbGxpbmcNCgkJCQllbHNlewkJCQkJDQoJCQkJCWlmKG9wdGlvbnMudmVydGljYWxDZW50ZXJlZCl7DQoJCQkJCQllbGVtZW50LmZpbmQoJy50YWJsZUNlbGwnKS53cmFwSW5uZXIoJzxkaXYgY2xhc3M9InNjcm9sbGFibGUiIC8+Jyk7DQoJCQkJCX1lbHNlew0KCQkJCQkJZWxlbWVudC53cmFwSW5uZXIoJzxkaXYgY2xhc3M9InNjcm9sbGFibGUiIC8+Jyk7DQoJCQkJCX0NCgkJCQkJDQoNCgkJCQkJZWxlbWVudC5maW5kKCcuc2Nyb2xsYWJsZScpLnNsaW1TY3JvbGwoew0KCQkJCQkJaGVpZ2h0OiBzY3JvbGxIZWlnaHQgKyAncHgnLA0KCQkJCQkJc2l6ZTogJzEwcHgnLA0KCQkJCQkJYWx3YXlzVmlzaWJsZTogdHJ1ZQ0KCQkJCQl9KTsNCgkJCQl9DQoJCQl9DQoJCQkNCgkJCS8vcmVtb3ZpbmcgdGhlIHNjcm9sbGluZyB3aGVuIGl0IGlzIG5vdCBuZWNlc3NhcnkgYW55bW9yZQ0KCQkJZWxzZXsJCQkJDQoJCQkJZWxlbWVudC5maW5kKCcuc2Nyb2xsYWJsZScpLmNoaWxkcmVuKCkuZmlyc3QoKS51bndyYXAoKS51bndyYXAoKTsNCgkJCQllbGVtZW50LmZpbmQoJy5zbGltU2Nyb2xsQmFyJykucmVtb3ZlKCk7DQoJCQkJZWxlbWVudC5maW5kKCcuc2xpbVNjcm9sbFJhaWwnKS5yZW1vdmUoKTsNCgkJCX0NCgkJCQ0KCQkJLy91bmRvIA0KCQkJZWxlbWVudC5jc3MoJ292ZXJmbG93JywgJycpOw0KCQl9DQoJCQ0KCQlmdW5jdGlvbiBhZGRUYWJsZUNsYXNzKGVsZW1lbnQpew0KCQkJZWxlbWVudC5hZGRDbGFzcygndGFibGUnKS53cmFwSW5uZXIoJzxkaXYgY2xhc3M9InRhYmxlQ2VsbCIgc3R5bGU9ImhlaWdodDonICsgZ2V0VGFibGVIZWlnaHQoZWxlbWVudCkgKyAncHg7IiAvPicpOw0KCQl9DQoJCQ0KCQlmdW5jdGlvbiBnZXRUYWJsZUhlaWdodChlbGVtZW50KXsNCgkJCXZhciBzZWN0aW9uSGVpZ2h0ID0gd2luZG93c0hlaWdodDsNCg0KCQkJaWYob3B0aW9ucy5wYWRkaW5nVG9wIHx8IG9wdGlvbnMucGFkZGluZ0JvdHRvbSl7DQoJCQkJdmFyIHNlY3Rpb24gPSBlbGVtZW50Ow0KCQkJCWlmKCFzZWN0aW9uLmhhc0NsYXNzKCdzZWN0aW9uJykpew0KCQkJCQlzZWN0aW9uID0gZWxlbWVudC5jbG9zZXN0KCcuc2VjdGlvbicpOw0KCQkJCX0NCgkJCQ0KCQkJCXZhciBwYWRkaW5ncyA9IHBhcnNlSW50KHNlY3Rpb24uY3NzKCdwYWRkaW5nLXRvcCcpKSArIHBhcnNlSW50KHNlY3Rpb24uY3NzKCdwYWRkaW5nLWJvdHRvbScpKTsNCgkJCQlzZWN0aW9uSGVpZ2h0ID0gKHdpbmRvd3NIZWlnaHQgLSBwYWRkaW5ncyk7DQoJCQl9DQoNCgkJCXJldHVybiBzZWN0aW9uSGVpZ2h0Ow0KCQl9DQoJCQ0KCQkvKioNCgkJKiBBZGRzIGEgY3NzMyB0cmFuc2Zvcm0gcHJvcGVydHkgdG8gdGhlIGNvbnRhaW5lciBjbGFzcyB3aXRoIG9yIHdpdGhvdXQgYW5pbWF0aW9uIGRlcGVuZGluZyBvbiB0aGUgYW5pbWF0ZWQgcGFyYW0uDQoJCSovDQoJCWZ1bmN0aW9uIHRyYW5zZm9ybUNvbnRhaW5lcih0cmFuc2xhdGUzZCwgYW5pbWF0ZWQpew0KCQkJY29udGFpbmVyLnRvZ2dsZUNsYXNzKCdlYXNpbmcnLCBhbmltYXRlZCk7DQoJCQkNCgkJCWNvbnRhaW5lci5jc3MoZ2V0VHJhbnNmb3Jtcyh0cmFuc2xhdGUzZCkpOw0KCQl9DQoJCQ0KCQkNCgkJLyoqDQoJCSogU2Nyb2xscyB0byB0aGUgZ2l2ZW4gc2VjdGlvbiBhbmQgc2xpZGUgDQoJCSovDQoJCWZ1bmN0aW9uIHNjcm9sbFBhZ2VBbmRTbGlkZShkZXN0aW55LCBzbGlkZSl7DQoJCQlpZiAodHlwZW9mIHNsaWRlID09PSAndW5kZWZpbmVkJykgew0KCQkJICAgIHNsaWRlID0gMDsNCgkJCX0NCg0KCQkJaWYoaXNOYU4oZGVzdGlueSkpew0KCQkJCXZhciBzZWN0aW9uID0gJCgnW2RhdGEtYW5jaG9yPSInK2Rlc3RpbnkrJyJdJyk7DQoJCQl9ZWxzZXsNCgkJCQl2YXIgc2VjdGlvbiA9ICQoJy5zZWN0aW9uJykuZXEoIChkZXN0aW55IC0xKSApOw0KCQkJfQ0KDQoNCgkJCS8vd2UgbmVlZCB0byBzY3JvbGwgdG8gdGhlIHNlY3Rpb24gYW5kIHRoZW4gdG8gdGhlIHNsaWRlDQoJCQlpZiAoZGVzdGlueSAhPT0gbGFzdFNjcm9sbGVkRGVzdGlueSAmJiAhc2VjdGlvbi5oYXNDbGFzcygnYWN0aXZlJykpew0KCQkJCXNjcm9sbFBhZ2Uoc2VjdGlvbiwgZnVuY3Rpb24oKXsNCgkJCQkJc2Nyb2xsU2xpZGVyKHNlY3Rpb24sIHNsaWRlKQ0KCQkJCX0pOw0KCQkJfQ0KCQkJLy9pZiB3ZSB3ZXJlIGFscmVhZHkgaW4gdGhlIHNlY3Rpb24NCgkJCWVsc2V7DQoJCQkJc2Nyb2xsU2xpZGVyKHNlY3Rpb24sIHNsaWRlKTsNCgkJCX0NCgkJCQ0KCQl9DQoJCQ0KCQkvKioNCgkJKiBTY3JvbGxzIHRoZSBzbGlkZXIgdG8gdGhlIGdpdmVuIHNsaWRlIGRlc3RpbmF0aW9uIGZvciB0aGUgZ2l2ZW4gc2VjdGlvbg0KCQkqLw0KCQlmdW5jdGlvbiBzY3JvbGxTbGlkZXIoc2VjdGlvbiwgc2xpZGUpew0KCQkJaWYodHlwZW9mIHNsaWRlICE9ICd1bmRlZmluZWQnKXsNCgkJCQl2YXIgc2xpZGVzID0gc2VjdGlvbi5maW5kKCcuc2xpZGVzJyk7DQoJCQkJdmFyIGRlc3RpbnkgPSAgc2xpZGVzLmZpbmQoJ1tkYXRhLWFuY2hvcj0iJytzbGlkZSsnIl0nKTsNCg0KCQkJCWlmKCFkZXN0aW55Lmxlbmd0aCl7DQoJCQkJCWRlc3RpbnkgPSBzbGlkZXMuZmluZCgnLnNsaWRlJykuZXEoc2xpZGUpOw0KCQkJCX0NCg0KCQkJCWlmKGRlc3RpbnkubGVuZ3RoKXsNCgkJCQkJbGFuZHNjYXBlU2Nyb2xsKHNsaWRlcywgZGVzdGlueSk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCQ0KCQkvKioNCgkJKiBDcmVhdGVzIGEgbGFuZHNjYXBlIG5hdmlnYXRpb24gYmFyIHdpdGggZG90cyBmb3IgaG9yaXpvbnRhbCBzbGlkZXJzLg0KCQkqLw0KCQlmdW5jdGlvbiBhZGRTbGlkZXNOYXZpZ2F0aW9uKHNlY3Rpb24sIG51bVNsaWRlcyl7CQkJCQkJDQoJCQlzZWN0aW9uLmFwcGVuZCgnPGRpdiBjbGFzcz0iZnVsbFBhZ2Utc2xpZGVzTmF2Ij48dWw+PC91bD48L2Rpdj4nKTsNCgkJCXZhciBuYXYgPSBzZWN0aW9uLmZpbmQoJy5mdWxsUGFnZS1zbGlkZXNOYXYnKTsNCg0KCQkJLy90b3Agb3IgYm90dG9tDQoJCQluYXYuYWRkQ2xhc3Mob3B0aW9ucy5zbGlkZXNOYXZQb3NpdGlvbik7DQoNCgkJCWZvcih2YXIgaT0wOyBpPCBudW1TbGlkZXM7IGkrKyl7CQkJDQoJCQkJbmF2LmZpbmQoJ3VsJykuYXBwZW5kKCc8bGk+PGEgaHJlZj0iIyI+PHNwYW4+PC9zcGFuPjwvYT48L2xpPicpOw0KCQkJfQ0KCQkJDQoJCQkvL2NlbnRlcmluZyBpdA0KCQkJbmF2LmNzcygnbWFyZ2luLWxlZnQnLCAnLScgKyAobmF2LndpZHRoKCkvMikgKyAncHgnKTsNCgkJCQ0KCQkJbmF2LmZpbmQoJ2xpJykuZmlyc3QoKS5maW5kKCdhJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQl9DQoJCQ0KDQoJCS8qKg0KCQkqIFNldHMgdGhlIFVSTCBoYXNoIGZvciBhIHNlY3Rpb24gd2l0aCBzbGlkZXMNCgkJKi8NCgkJZnVuY3Rpb24gc2V0VVJMSGFzaChzbGlkZUluZGV4LCBzbGlkZUFuY2hvciwgYW5jaG9yTGluayl7DQoJCQl2YXIgc2VjdGlvbkhhc2ggPSAnJzsNCg0KCQkJaWYob3B0aW9ucy5hbmNob3JzLmxlbmd0aCl7DQoNCgkJCQkvL2lzbid0IGl0IHRoZSBmaXJzdCBzbGlkZT8NCgkJCQlpZihzbGlkZUluZGV4KXsNCgkJCQkJaWYodHlwZW9mIGFuY2hvckxpbmsgIT09ICd1bmRlZmluZWQnKXsNCgkJCQkJCXNlY3Rpb25IYXNoID0gYW5jaG9yTGluazsNCgkJCQkJfQ0KDQoJCQkJCS8vc2xpZGUgd2l0aG91dCBhbmNob3IgbGluaz8gV2UgdGFrZSB0aGUgaW5kZXggaW5zdGVhZC4NCgkJCQkJaWYodHlwZW9mIHNsaWRlQW5jaG9yID09PSAndW5kZWZpbmVkJyl7DQoJCQkJCQlzbGlkZUFuY2hvciA9IHNsaWRlSW5kZXg7DQoJCQkJCX0NCgkJCQkJDQoJCQkJCWxhc3RTY3JvbGxlZFNsaWRlID0gc2xpZGVBbmNob3I7DQoJCQkJCWxvY2F0aW9uLmhhc2ggPSBzZWN0aW9uSGFzaCArICcvJyArIHNsaWRlQW5jaG9yOw0KDQoJCQkJLy9maXJzdCBzbGlkZSB3b24ndCBoYXZlIHNsaWRlIGFuY2hvciwganVzdCB0aGUgc2VjdGlvbiBvbmUNCgkJCQl9ZWxzZSBpZih0eXBlb2Ygc2xpZGVJbmRleCAhPT0gJ3VuZGVmaW5lZCcpew0KCQkJCQlsYXN0U2Nyb2xsZWRTbGlkZSA9IHNsaWRlQW5jaG9yOw0KCQkJCQlsb2NhdGlvbi5oYXNoID0gYW5jaG9yTGluazsNCgkJCQl9DQoNCgkJCQkvL3NlY3Rpb24gd2l0aG91dCBzbGlkZXMNCgkJCQllbHNlew0KCQkJCQlsb2NhdGlvbi5oYXNoID0gYW5jaG9yTGluazsNCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJKiBTY3JvbGxzIHRoZSBzbGlkZXIgdG8gdGhlIGdpdmVuIHNsaWRlIGRlc3RpbmF0aW9uIGZvciB0aGUgZ2l2ZW4gc2VjdGlvbg0KCQkqLw0KCQkkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmZ1bGxQYWdlLXNsaWRlc05hdiBhJywgZnVuY3Rpb24oZSl7DQoJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQl2YXIgc2xpZGVzID0gJCh0aGlzKS5jbG9zZXN0KCcuc2VjdGlvbicpLmZpbmQoJy5zbGlkZXMnKTsJCQ0KCQkJdmFyIGRlc3RpbnkgPSBzbGlkZXMuZmluZCgnLnNsaWRlJykuZXEoJCh0aGlzKS5jbG9zZXN0KCdsaScpLmluZGV4KCkpOw0KCQkJDQoJCQlsYW5kc2NhcGVTY3JvbGwoc2xpZGVzLCBkZXN0aW55KTsNCgkJfSk7DQoJCQ0KCQkNCgkJLyoqDQoJCSogQ2hlY2tzIGZvciB0cmFuc2xhdGUzZCBzdXBwb3J0IA0KCQkqIEByZXR1cm4gYm9vbGVhbg0KCQkqIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTY2MTY3MS9kZXRlY3RpbmctdHJhbnNmb3JtLXRyYW5zbGF0ZTNkLXN1cHBvcnQNCgkJKi8NCgkJZnVuY3Rpb24gc3VwcG9ydDNkKCkgew0KCQkJdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpLCANCgkJCQloYXMzZCwNCgkJCQl0cmFuc2Zvcm1zID0gew0KCQkJCQknd2Via2l0VHJhbnNmb3JtJzonLXdlYmtpdC10cmFuc2Zvcm0nLA0KCQkJCQknT1RyYW5zZm9ybSc6Jy1vLXRyYW5zZm9ybScsDQoJCQkJCSdtc1RyYW5zZm9ybSc6Jy1tcy10cmFuc2Zvcm0nLA0KCQkJCQknTW96VHJhbnNmb3JtJzonLW1vei10cmFuc2Zvcm0nLA0KCQkJCQkndHJhbnNmb3JtJzondHJhbnNmb3JtJw0KCQkJCX07DQoNCgkJCS8vIEFkZCBpdCB0byB0aGUgYm9keSB0byBnZXQgdGhlIGNvbXB1dGVkIHN0eWxlLg0KCQkJZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUoZWwsIG51bGwpOw0KDQoJCQlmb3IgKHZhciB0IGluIHRyYW5zZm9ybXMpIHsNCgkJCQlpZiAoZWwuc3R5bGVbdF0gIT09IHVuZGVmaW5lZCkgew0KCQkJCQllbC5zdHlsZVt0XSA9ICJ0cmFuc2xhdGUzZCgxcHgsMXB4LDFweCkiOw0KCQkJCQloYXMzZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKS5nZXRQcm9wZXJ0eVZhbHVlKHRyYW5zZm9ybXNbdF0pOw0KCQkJCX0NCgkJCX0NCgkJCQ0KCQkJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbCk7DQoNCgkJCXJldHVybiAoaGFzM2QgIT09IHVuZGVmaW5lZCAmJiBoYXMzZC5sZW5ndGggPiAwICYmIGhhczNkICE9PSAibm9uZSIpOw0KCQl9DQoNCg0KDQoJCS8qKg0KCQkqIFJlbW92ZXMgdGhlIGF1dG8gc2Nyb2xsaW5nIGFjdGlvbiBmaXJlZCBieSB0aGUgbW91c2Ugd2hlZWwgYW5kIHRhY2twYWQuDQoJCSogQWZ0ZXIgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQsIHRoZSBtb3VzZXdoZWVsIGFuZCB0cmFja3BhZCBtb3ZlbWVudHMgd29uJ3Qgc2Nyb2xsIHRocm91Z2ggc2VjdGlvbnMuDQoJCSovDQoJCWZ1bmN0aW9uIHJlbW92ZU1vdXNlV2hlZWxIYW5kbGVyKCl7DQoJCQlpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgew0KCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNld2hlZWwnLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0lFOSwgQ2hyb21lLCBTYWZhcmksIE9wZXINCgkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3aGVlbCcsIE1vdXNlV2hlZWxIYW5kbGVyLCBmYWxzZSk7IC8vRmlyZWZveA0KCQkJfSBlbHNlIHsNCgkJCQlkb2N1bWVudC5kZXRhY2hFdmVudCgib25tb3VzZXdoZWVsIiwgTW91c2VXaGVlbEhhbmRsZXIpOyAvL0lFIDYvNy84DQoJCQl9DQoJCX0NCg0KDQoJCS8qKg0KCQkqIEFkZHMgdGhlIGF1dG8gc2Nyb2xsaW5nIGFjdGlvbiBmb3IgdGhlIG1vdXNlIHdoZWVsIGFuZCB0YWNrcGFkLg0KCQkqIEFmdGVyIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkLCB0aGUgbW91c2V3aGVlbCBhbmQgdHJhY2twYWQgbW92ZW1lbnRzIHdpbGwgc2Nyb2xsIHRocm91Z2ggc2VjdGlvbnMNCgkJKi8NCgkJZnVuY3Rpb24gYWRkTW91c2VXaGVlbEhhbmRsZXIoKXsNCgkJCWlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7DQoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyLCBmYWxzZSk7IC8vSUU5LCBDaHJvbWUsIFNhZmFyaSwgT3Blcg0KCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIndoZWVsIiwgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9GaXJlZm94DQoJCQl9IGVsc2Ugew0KCQkJCWRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbm1vdXNld2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlcik7IC8vSUUgNi83LzgNCgkJCX0NCgkJfQ0KCQkNCgkJDQoJCS8qKg0KCQkqIEFkZHMgdGhlIHBvc3NpYmlsaXR5IHRvIGF1dG8gc2Nyb2xsIHRocm91Z2ggc2VjdGlvbnMgb24gdG91Y2ggZGV2aWNlcy4NCgkJKi8NCgkJZnVuY3Rpb24gYWRkVG91Y2hIYW5kbGVyKCl7DQoJCQlpZihpc1RhYmxldCl7DQoJCQkJJChkb2N1bWVudCkub2ZmKCd0b3VjaHN0YXJ0IE1TUG9pbnRlckRvd24nKS5vbigndG91Y2hzdGFydCBNU1BvaW50ZXJEb3duJywgdG91Y2hTdGFydEhhbmRsZXIpOw0KCQkJCSQoZG9jdW1lbnQpLm9mZigndG91Y2htb3ZlIE1TUG9pbnRlck1vdmUnKS5vbigndG91Y2htb3ZlIE1TUG9pbnRlck1vdmUnLCB0b3VjaE1vdmVIYW5kbGVyKTsNCgkJCX0NCgkJfQ0KCQkNCgkJLyoqDQoJCSogUmVtb3ZlcyB0aGUgYXV0byBzY3JvbGxpbmcgZm9yIHRvdWNoIGRldmljZXMuDQoJCSovDQoJCWZ1bmN0aW9uIHJlbW92ZVRvdWNoSGFuZGxlcigpew0KCQkJaWYoaXNUYWJsZXQpew0KCQkJCSQoZG9jdW1lbnQpLm9mZigndG91Y2hzdGFydCBNU1BvaW50ZXJEb3duJyk7DQoJCQkJJChkb2N1bWVudCkub2ZmKCd0b3VjaG1vdmUgTVNQb2ludGVyTW92ZScpOw0KCQkJfQ0KCQl9DQoJCQ0KCQkvKioNCgkJKiBHZXRzIHRoZSBwYWdlWCBhbmQgcGFnZVkgcHJvcGVydGllcyBkZXBlbmRpbmcgb24gdGhlIGJyb3dzZXIuDQoJCSogaHR0cHM6Ly9naXRodWIuY29tL2FsdmFyb3RyaWdvL2Z1bGxQYWdlLmpzL2lzc3Vlcy8xOTQjaXNzdWVjb21tZW50LTM0MDY5ODU0DQoJCSovDQoJCWZ1bmN0aW9uIGdldEV2ZW50c1BhZ2UoZSl7DQoJCQl2YXIgZXZlbnRzID0gbmV3IEFycmF5KCk7DQoJCQlpZiAod2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkKXsNCgkJCQlldmVudHNbJ3knXSA9IGUucGFnZVk7DQoJCQkJZXZlbnRzWyd4J10gPSBlLnBhZ2VYOw0KCQkJfWVsc2V7DQoJCQkJZXZlbnRzWyd5J10gPSBlLnRvdWNoZXNbMF0ucGFnZVk7DQoJCQkJZXZlbnRzWyd4J10gPSAgZS50b3VjaGVzWzBdLnBhZ2VYOw0KCQkJfQ0KDQoJCQlyZXR1cm4gZXZlbnRzOw0KCQl9DQoNCgkJZnVuY3Rpb24gc2lsZW50U2Nyb2xsKHRvcCl7DQoJCQlpZiAob3B0aW9ucy5jc3MzKSB7DQoJCQkJdmFyIHRyYW5zbGF0ZTNkID0gJ3RyYW5zbGF0ZTNkKDBweCwgLScgKyB0b3AgKyAncHgsIDBweCknOw0KCQkJCXRyYW5zZm9ybUNvbnRhaW5lcih0cmFuc2xhdGUzZCwgZmFsc2UpOw0KCQkJfQ0KCQkJZWxzZSB7DQoJCQkJY29udGFpbmVyLmNzcygidG9wIiwgLXRvcCk7DQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBnZXRUcmFuc2Zvcm1zKHRyYW5zbGF0ZTNkKXsNCgkJCXJldHVybiB7DQoJCQkJJy13ZWJraXQtdHJhbnNmb3JtJzogdHJhbnNsYXRlM2QsDQoJCQkJJy1tb3otdHJhbnNmb3JtJzogdHJhbnNsYXRlM2QsDQoJCQkJJy1tcy10cmFuc2Zvcm0nOnRyYW5zbGF0ZTNkLA0KCQkJCSd0cmFuc2Zvcm0nOiB0cmFuc2xhdGUzZA0KCQkJfTsNCgkJfQ0KDQoJfTsNCn0pKGpRdWVyeSk7DQo=",
                "body": "LyoqDQogKiBmdWxsUGFnZSAyLjAuNg0KICogaHR0cHM6Ly9naXRodWIuY29tL2FsdmFyb3RyaWdvL2Z1bGxQYWdlLmpzDQogKiBNSVQgbGljZW5zZWQNCiAqDQogKiBDb3B5cmlnaHQgKEMpIDIwMTMgYWx2YXJvdHJpZ28uY29tIC0gQSBwcm9qZWN0IGJ5IEFsdmFybyBUcmlnbw0KICovDQoNCihmdW5jdGlvbigkKSB7DQoJJC5mbi5mdWxscGFnZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCgkJLy8gQ3JlYXRlIHNvbWUgZGVmYXVsdHMsIGV4dGVuZGluZyB0aGVtIHdpdGggYW55IG9wdGlvbnMgdGhhdCB3ZXJlIHByb3ZpZGVkDQoJCW9wdGlvbnMgPSAkLmV4dGVuZCh7DQoJCQkidmVydGljYWxDZW50ZXJlZCIgOiB0cnVlLA0KCQkJJ3Jlc2l6ZScgOiB0cnVlLA0KCQkJJ3NsaWRlc0NvbG9yJyA6IFtdLA0KCQkJJ2FuY2hvcnMnOltdLA0KCQkJJ3Njcm9sbGluZ1NwZWVkJzogNzAwLA0KCQkJJ2Vhc2luZyc6ICdlYXNlSW5RdWFydCcsDQoJCQknbWVudSc6IGZhbHNlLA0KCQkJJ25hdmlnYXRpb24nOiBmYWxzZSwNCgkJCSduYXZpZ2F0aW9uUG9zaXRpb24nOiAncmlnaHQnLA0KCQkJJ25hdmlnYXRpb25Db2xvcic6ICcjMDAwJywNCgkJCSduYXZpZ2F0aW9uVG9vbHRpcHMnOiBbXSwNCgkJCSdzbGlkZXNOYXZpZ2F0aW9uJzogZmFsc2UsDQoJCQknc2xpZGVzTmF2UG9zaXRpb24nOiAnYm90dG9tJywNCgkJCSdjb250cm9sQXJyb3dDb2xvcic6ICcjZmZmJywNCgkJCSdsb29wQm90dG9tJzogZmFsc2UsDQoJCQknbG9vcFRvcCc6IGZhbHNlLA0KCQkJJ2xvb3BIb3Jpem9udGFsJzogdHJ1ZSwNCgkJCSdhdXRvU2Nyb2xsaW5nJzogdHJ1ZSwNCgkJCSdzY3JvbGxPdmVyZmxvdyc6IGZhbHNlLA0KCQkJJ2NzczMnOiBmYWxzZSwNCgkJCSdwYWRkaW5nVG9wJzogMCwNCgkJCSdwYWRkaW5nQm90dG9tJzogMCwNCgkJCSdmaXhlZEVsZW1lbnRzJzogbnVsbCwNCgkJCSdub3JtYWxTY3JvbGxFbGVtZW50cyc6IG51bGwsIA0KCQkJJ2tleWJvYXJkU2Nyb2xsaW5nJzogdHJ1ZSwNCgkJCSd0b3VjaFNlbnNpdGl2aXR5JzogNSwNCgkJCSdjb250aW51b3VzVmVydGljYWwnOiBmYWxzZSwNCgkJCSdhbmltYXRlQW5jaG9yJzogdHJ1ZSwNCgkJCSdub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQnOiA1LA0KDQoJCQkvL2V2ZW50cw0KCQkJJ2FmdGVyTG9hZCc6IG51bGwsDQoJCQknb25MZWF2ZSc6IG51bGwsDQoJCQknYWZ0ZXJSZW5kZXInOiBudWxsLA0KCQkJJ2FmdGVyUmVzaXplJzogbnVsbCwNCgkJCSdhZnRlclNsaWRlTG9hZCc6IG51bGwsDQoJCQknb25TbGlkZUxlYXZlJzogbnVsbA0KCQl9LCBvcHRpb25zKTsJCQ0KCQkNCgkgICAgLy8gRGlzYWJsZSBtdXR1YWxseSBleGNsdXNpdmUgc2V0dGluZ3MNCgkJaWYgKG9wdGlvbnMuY29udGludW91c1ZlcnRpY2FsICYmDQoJCQkob3B0aW9ucy5sb29wVG9wIHx8IG9wdGlvbnMubG9vcEJvdHRvbSkpIHsNCgkJICAgIG9wdGlvbnMuY29udGludW91c1ZlcnRpY2FsID0gZmFsc2U7DQoJCSAgICBjb25zb2xlICYmIGNvbnNvbGUubG9nICYmIGNvbnNvbGUubG9nKCJPcHRpb24gbG9vcFRvcC9sb29wQm90dG9tIGlzIG11dHVhbGx5IGV4Y2x1c2l2ZSB3aXRoIGNvbnRpbnVvdXNWZXJ0aWNhbDsgY29udGludW91c1ZlcnRpY2FsIGRpc2FibGVkIik7DQoJCX0NCgkJDQoJCS8vRGVmaW5lcyB0aGUgZGVsYXkgdG8gdGFrZSBwbGFjZSBiZWZvcmUgYmVpbmcgYWJsZSB0byBzY3JvbGwgdG8gdGhlIG5leHQgc2VjdGlvbg0KCQkvL0JFIENBUkVGVUwhIE5vdCByZWNvbW1lbmVkIHRvIGNoYW5nZSBpdCB1bmRlciA0MDAgZm9yIGEgZ29vZCBiZWhhdmlvciBpbiBsYXB0b3BzIGFuZCANCgkJLy9BcHBsZSBkZXZpY2VzIChsYXB0b3BzLCBtb3VzZXMuLi4pDQoJCXZhciBzY3JvbGxEZWxheSA9IDYwMDsNCgkJDQoJCSQuZm4uZnVsbHBhZ2Uuc2V0QXV0b1Njcm9sbGluZyA9IGZ1bmN0aW9uKHZhbHVlKXsNCgkJCW9wdGlvbnMuYXV0b1Njcm9sbGluZyA9IHZhbHVlOw0KCQkJDQoJCQl2YXIgZWxlbWVudCA9ICQoJy5zZWN0aW9uLmFjdGl2ZScpOw0KCQkJCQ0KCQkJaWYob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCgkJCQkkKCdodG1sLCBib2R5JykuY3NzKHsNCgkJCQkJJ292ZXJmbG93JyA6ICdoaWRkZW4nLA0KCQkJCQknaGVpZ2h0JyA6ICcxMDAlJw0KCQkJCX0pOw0KCQkJCQ0KCQkJCWlmKGVsZW1lbnQubGVuZ3RoKXsNCgkJCQkJLy9tb3ZpbmcgdGhlIGNvbnRhaW5lciB1cA0KCQkJCQlzaWxlbnRTY3JvbGwoZWxlbWVudC5wb3NpdGlvbigpLnRvcCk7DQoJCQkJfQ0KCQkJCQkNCgkJCX1lbHNlew0KCQkJCSQoJ2h0bWwsIGJvZHknKS5jc3Moew0KCQkJCQknb3ZlcmZsb3cnIDogJ2F1dG8nLA0KCQkJCQknaGVpZ2h0JyA6ICdhdXRvJw0KCQkJCX0pOw0KCQkJCQ0KCQkJCXNpbGVudFNjcm9sbCgwKTsNCgkJCQkNCgkJCQkvL3Njcm9sbGluZyB0aGUgcGFnZSB0byB0aGUgc2VjdGlvbiB3aXRoIG5vIGFuaW1hdGlvbg0KCQkJCSQoJ2h0bWwsIGJvZHknKS5zY3JvbGxUb3AoZWxlbWVudC5wb3NpdGlvbigpLnRvcCk7DQoJCQl9DQoJCQkNCgkJfTsNCg0KCQkvKioNCgkJKiBEZWZpbmVzIHRoZSBzY3JvbGxpbmcgc3BlZWQgDQoJCSovDQoJCSQuZm4uZnVsbHBhZ2Uuc2V0U2Nyb2xsaW5nU3BlZWQgPSBmdW5jdGlvbih2YWx1ZSl7DQoJCSAgIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQgPSB2YWx1ZTsNCgkJfTsNCgkJDQoJCS8qKg0KCQkqIEFkZHMgb3IgcmVtb3ZlIHRoZSBwb3NzaWJsaXR5IG9mIHNjcm9sbGluZyB0aHJvdWdoIHNlY3Rpb25zIGJ5IHVzaW5nIHRoZSBtb3VzZSB3aGVlbCBvciB0aGUgdHJhY2twYWQuIA0KCQkqLw0KCQkkLmZuLmZ1bGxwYWdlLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcgPSBmdW5jdGlvbiAodmFsdWUpew0KCQkJaWYodmFsdWUpew0KCQkJCWFkZE1vdXNlV2hlZWxIYW5kbGVyKCk7DQoJCQl9ZWxzZXsNCgkJCQlyZW1vdmVNb3VzZVdoZWVsSGFuZGxlcigpOw0KCQkJfQ0KCQl9Ow0KCQkNCgkJLyoqDQoJCSogQWRkcyBvciByZW1vdmUgdGhlIHBvc3NpYmxpdHkgb2Ygc2Nyb2xsaW5nIHRocm91Z2ggc2VjdGlvbnMgYnkgdXNpbmcgdGhlIG1vdXNlIHdoZWVsL3RyYWNrcGFkIG9yIHRvdWNoIGdlc3R1cmVzLiANCgkJKi8NCgkJJC5mbi5mdWxscGFnZS5zZXRBbGxvd1Njcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQoJCQlpZih2YWx1ZSl7DQoJCQkJJC5mbi5mdWxscGFnZS5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nKHRydWUpOw0KCQkJCWFkZFRvdWNoSGFuZGxlcigpOw0KCQkJfWVsc2V7DQoJCQkJJC5mbi5mdWxscGFnZS5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nKGZhbHNlKTsNCgkJCQlyZW1vdmVUb3VjaEhhbmRsZXIoKTsNCgkJCX0NCgkJfTsNCgkJDQoJCS8qKg0KCQkqIEFkZHMgb3IgcmVtb3ZlIHRoZSBwb3NzaWJsaXR5IG9mIHNjcm9sbGluZyB0aHJvdWdoIHNlY3Rpb25zIGJ5IHVzaW5nIHRoZSBrZXlib2FyZCBhcnJvdyBrZXlzDQoJCSovDQoJCSQuZm4uZnVsbHBhZ2Uuc2V0S2V5Ym9hcmRTY3JvbGxpbmcgPSBmdW5jdGlvbiAodmFsdWUpew0KCQkJb3B0aW9ucy5rZXlib2FyZFNjcm9sbGluZyA9IHZhbHVlOw0KCQl9Ow0KCQkJDQoJCS8vZmxhZyB0byBhdm9pZCB2ZXJ5IGZhc3Qgc2xpZGluZyBmb3IgbGFuZHNjYXBlIHNsaWRlcnMNCgkJdmFyIHNsaWRlTW92aW5nID0gZmFsc2U7DQoNCgkJdmFyIGlzVGFibGV0ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvKGlQaG9uZXxpUG9kfGlQYWR8QW5kcm9pZHxCbGFja0JlcnJ5fFdpbmRvd3MgUGhvbmUpLyk7DQoJCXZhciBjb250YWluZXIgPSAkKHRoaXMpOyAvLyBmb3IgY29tcGF0aWJpdHkgcmVhc29ucyBmb3IgZnVsbHBhZ2UgPCB2Mi4wDQoJCXZhciB3aW5kb3dzSGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpOw0KCQl2YXIgaXNNb3ZpbmcgPSBmYWxzZTsNCgkJdmFyIGlzUmVzaXppbmcgPSBmYWxzZTsNCgkJdmFyIGxhc3RTY3JvbGxlZERlc3Rpbnk7DQoJCXZhciBsYXN0U2Nyb2xsZWRTbGlkZTsNCg0KCQkkLmZuLmZ1bGxwYWdlLnNldEFsbG93U2Nyb2xsaW5nKHRydWUpOw0KCQkNCgkJLy9pZiBjc3MzIGlzIG5vdCBzdXBwb3J0ZWQsIGl0IHdpbGwgdXNlIGpRdWVyeSBhbmltYXRpb25zDQoJCWlmKG9wdGlvbnMuY3NzMyl7DQoJCQlvcHRpb25zLmNzczMgPSBzdXBwb3J0M2QoKTsNCgkJfQ0KDQoJCWlmKCQodGhpcykubGVuZ3RoKXsNCgkJCWNvbnRhaW5lci5jc3Moew0KCQkJCSdoZWlnaHQnOiAnMTAwJScsDQoJCQkJJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJywNCgkJCQknLW1zLXRvdWNoLWFjdGlvbic6ICdub25lJw0KCQkJfSk7DQoJCX0NCg0KCQkvL2ZvciBjb21wYXRpYml0eSByZWFzb25zIGZvciBmdWxscGFnZSA8IHYyLjAgDQoJCWVsc2V7DQoJCQkkKCdib2R5Jykud3JhcElubmVyKCc8ZGl2IGlkPSJzdXBlckNvbnRhaW5lciIgLz4nKTsNCgkJCWNvbnRhaW5lciA9ICQoJyNzdXBlckNvbnRhaW5lcicpOw0KCQl9DQoNCgkJLy9jcmVhdGluZyB0aGUgbmF2aWdhdGlvbiBkb3RzIA0KCQlpZiAob3B0aW9ucy5uYXZpZ2F0aW9uKSB7DQoJCQkkKCdib2R5JykuYXBwZW5kKCc8ZGl2IGlkPSJmdWxsUGFnZS1uYXYiPjx1bD48L3VsPjwvZGl2PicpOw0KCQkJdmFyIG5hdiA9ICQoJyNmdWxsUGFnZS1uYXYnKTsNCg0KCQkJbmF2LmNzcygnY29sb3InLCBvcHRpb25zLm5hdmlnYXRpb25Db2xvcik7DQoJCQluYXYuYWRkQ2xhc3Mob3B0aW9ucy5uYXZpZ2F0aW9uUG9zaXRpb24pOw0KCQl9DQoJCQ0KCQkkKCcuc2VjdGlvbicpLmVhY2goZnVuY3Rpb24oaW5kZXgpew0KCQkJdmFyIHRoYXQgPSAkKHRoaXMpOw0KCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuZmluZCgnLnNsaWRlJyk7DQoJCQl2YXIgbnVtU2xpZGVzID0gc2xpZGVzLmxlbmd0aDsNCgkJCQ0KCQkJLy9pZiBubyBhY3RpdmUgc2VjdGlvbiBpcyBkZWZpbmVkLCB0aGUgMXN0IG9uZSB3aWxsIGJlIHRoZSBkZWZhdWx0IG9uZQ0KCQkJaWYoIWluZGV4ICYmICQoJy5zZWN0aW9uLmFjdGl2ZScpLmxlbmd0aCA9PT0gMCkgew0KCQkJCSQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJfQ0KDQoJCQkkKHRoaXMpLmNzcygnaGVpZ2h0Jywgd2luZG93c0hlaWdodCArICdweCcpOw0KCQkJDQoJCQlpZihvcHRpb25zLnBhZGRpbmdUb3AgfHwgb3B0aW9ucy5wYWRkaW5nQm90dG9tKXsNCgkJCQkkKHRoaXMpLmNzcygncGFkZGluZycsIG9wdGlvbnMucGFkZGluZ1RvcCAgKyAnIDAgJyArIG9wdGlvbnMucGFkZGluZ0JvdHRvbSArICcgMCcpOw0KCQkJfQ0KCQkJDQoJCQlpZiAodHlwZW9mIG9wdGlvbnMuc2xpZGVzQ29sb3JbaW5kZXhdICE9PSAgJ3VuZGVmaW5lZCcpIHsNCgkJCQkkKHRoaXMpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIG9wdGlvbnMuc2xpZGVzQ29sb3JbaW5kZXhdKTsNCgkJCX0NCg0KCQkJaWYgKHR5cGVvZiBvcHRpb25zLmFuY2hvcnNbaW5kZXhdICE9PSAndW5kZWZpbmVkJykgew0KCQkJCSQodGhpcykuYXR0cignZGF0YS1hbmNob3InLCBvcHRpb25zLmFuY2hvcnNbaW5kZXhdKTsNCgkJCX0JCQkNCg0KCQkJaWYgKG9wdGlvbnMubmF2aWdhdGlvbikgew0KCQkJCXZhciBsaW5rID0gJyc7DQoJCQkJaWYob3B0aW9ucy5hbmNob3JzLmxlbmd0aCl7DQoJCQkJCWxpbmsgPSBvcHRpb25zLmFuY2hvcnNbaW5kZXhdOw0KCQkJCX0NCgkJCQl2YXIgdG9vbHRpcCA9IG9wdGlvbnMubmF2aWdhdGlvblRvb2x0aXBzW2luZGV4XTsNCgkJCQlpZih0eXBlb2YgdG9vbHRpcCA9PT0gJ3VuZGVmaW5lZCcpew0KCQkJCQl0b29sdGlwID0gJyc7DQoJCQkJfQ0KCQkJCQ0KCQkJCW5hdi5maW5kKCd1bCcpLmFwcGVuZCgnPGxpIGRhdGEtdG9vbHRpcD0iJyArIHRvb2x0aXAgKyAnIj48YSBocmVmPSIjJyArIGxpbmsgKyAnIj48c3Bhbj48L3NwYW4+PC9hPjwvbGk+Jyk7DQoJCQl9DQoNCgkJCQ0KCQkJLy8gaWYgdGhlcmUncyBhbnkgc2xpZGUNCgkJCWlmIChudW1TbGlkZXMgPiAwKSB7DQoJCQkJdmFyIHNsaWRlcldpZHRoID0gbnVtU2xpZGVzICogMTAwOw0KCQkJCXZhciBzbGlkZVdpZHRoID0gMTAwIC8gbnVtU2xpZGVzOw0KCQkJCQ0KCQkJCXNsaWRlcy53cmFwQWxsKCc8ZGl2IGNsYXNzPSJzbGlkZXNDb250YWluZXIiIC8+Jyk7DQoJCQkJc2xpZGVzLnBhcmVudCgpLndyYXAoJzxkaXYgY2xhc3M9InNsaWRlcyIgLz4nKTsNCg0KCQkJCSQodGhpcykuZmluZCgnLnNsaWRlc0NvbnRhaW5lcicpLmNzcygnd2lkdGgnLCBzbGlkZXJXaWR0aCArICclJyk7DQoJCQkJJCh0aGlzKS5maW5kKCcuc2xpZGVzJykuYWZ0ZXIoJzxkaXYgY2xhc3M9ImNvbnRyb2xBcnJvdyBwcmV2Ij48L2Rpdj48ZGl2IGNsYXNzPSJjb250cm9sQXJyb3cgbmV4dCI+PC9kaXY+Jyk7DQoJCQkJDQoJCQkJaWYob3B0aW9ucy5jb250cm9sQXJyb3dDb2xvciE9JyNmZmYnKXsNCgkJCQkJJCh0aGlzKS5maW5kKCcuY29udHJvbEFycm93Lm5leHQnKS5jc3MoJ2JvcmRlci1jb2xvcicsICd0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAnK29wdGlvbnMuY29udHJvbEFycm93Q29sb3IpOw0KCQkJCQkkKHRoaXMpLmZpbmQoJy5jb250cm9sQXJyb3cucHJldicpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3RyYW5zcGFyZW50ICcrIG9wdGlvbnMuY29udHJvbEFycm93Q29sb3IgKyAnIHRyYW5zcGFyZW50IHRyYW5zcGFyZW50Jyk7DQoJCQkJfQ0KCQkJCQ0KCQkJCWlmKCFvcHRpb25zLmxvb3BIb3Jpem9udGFsKXsNCgkJCQkJJCh0aGlzKS5maW5kKCcuY29udHJvbEFycm93LnByZXYnKS5oaWRlKCk7DQoJCQkJfQ0KDQoJCQkJDQoJCQkJaWYob3B0aW9ucy5zbGlkZXNOYXZpZ2F0aW9uKXsNCgkJCQkJYWRkU2xpZGVzTmF2aWdhdGlvbigkKHRoaXMpLCBudW1TbGlkZXMpOw0KCQkJCX0NCgkJCQkNCgkJCQlzbGlkZXMuZWFjaChmdW5jdGlvbihpbmRleCkgew0KCQkJCQkvL2lmIHRoZSBzbGlkZSB3b24jdCBiZSBhbiBzdGFydGluZyBwb2ludCwgdGhlIGRlZmF1bHQgd2lsbCBiZSB0aGUgZmlyc3Qgb25lDQoJCQkJCWlmKCFpbmRleCAmJiB0aGF0LmZpbmQoJy5zbGlkZS5hY3RpdmUnKS5sZW5ndGggPT0gMCl7DQoJCQkJCQkkKHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCQkJfQ0KCQkJCQkNCgkJCQkJJCh0aGlzKS5jc3MoJ3dpZHRoJywgc2xpZGVXaWR0aCArICclJyk7DQoJCQkJCQ0KCQkJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCQkJYWRkVGFibGVDbGFzcygkKHRoaXMpKTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfWVsc2V7DQoJCQkJaWYob3B0aW9ucy52ZXJ0aWNhbENlbnRlcmVkKXsNCgkJCQkJYWRkVGFibGVDbGFzcygkKHRoaXMpKTsNCgkJCQl9DQoJCQl9DQoJCQkNCgkJDQoNCgkJCQ0KCQl9KS5wcm9taXNlKCkuZG9uZShmdW5jdGlvbigpewkNCgkJCSQuZm4uZnVsbHBhZ2Uuc2V0QXV0b1Njcm9sbGluZyhvcHRpb25zLmF1dG9TY3JvbGxpbmcpOw0KDQoNCgkJCS8vdGhlIHN0YXJ0aW5nIHBvaW50IGlzIGEgc2xpZGU/IA0KCQkJdmFyIGFjdGl2ZVNsaWRlID0gJCgnLnNlY3Rpb24uYWN0aXZlJykuZmluZCgnLnNsaWRlLmFjdGl2ZScpOw0KCQkJaWYoIGFjdGl2ZVNsaWRlLmxlbmd0aCAmJiAgKCQoJy5zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcuc2VjdGlvbicpICE9IDAgfHwgKCQoJy5zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcuc2VjdGlvbicpID09IDAgJiYgYWN0aXZlU2xpZGUuaW5kZXgoKSAhPSAwKSkpew0KCQkJCXZhciBwcmV2U2Nyb2xsaW5nU3BlZXBkID0gb3B0aW9ucy5zY3JvbGxpbmdTcGVlZDsNCgkJCQkkLmZuLmZ1bGxwYWdlLnNldFNjcm9sbGluZ1NwZWVkICgwKTsNCgkJCQlsYW5kc2NhcGVTY3JvbGwoJCgnLnNlY3Rpb24uYWN0aXZlJykuZmluZCgnLnNsaWRlcycpLCBhY3RpdmVTbGlkZSk7DQoJCQkJJC5mbi5mdWxscGFnZS5zZXRTY3JvbGxpbmdTcGVlZChwcmV2U2Nyb2xsaW5nU3BlZXBkKTsNCgkJCX0NCgkJCQ0KCQkJLy9maXhlZCBlbGVtZW50cyBuZWVkIHRvIGJlIG1vdmVkIG91dCBvZiB0aGUgcGx1Z2luIGNvbnRhaW5lciBkdWUgdG8gcHJvYmxlbXMgd2l0aCBDU1MzLg0KCQkJaWYob3B0aW9ucy5maXhlZEVsZW1lbnRzICYmIG9wdGlvbnMuY3NzMyl7DQoJCQkJJChvcHRpb25zLmZpeGVkRWxlbWVudHMpLmFwcGVuZFRvKCdib2R5Jyk7DQoJCQl9DQoJCQkNCgkJCS8vdmVydGljYWwgY2VudGVyZWQgb2YgdGhlIG5hdmlnYXRpb24gKyBmaXJzdCBidWxsZXQgYWN0aXZlDQoJCQlpZihvcHRpb25zLm5hdmlnYXRpb24pew0KCQkJCW5hdi5jc3MoJ21hcmdpbi10b3AnLCAnLScgKyAobmF2LmhlaWdodCgpLzIpICsgJ3B4Jyk7DQoJCQkJbmF2LmZpbmQoJ2xpJykuZXEoJCgnLnNlY3Rpb24uYWN0aXZlJykuaW5kZXgoJy5zZWN0aW9uJykpLmZpbmQoJ2EnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQl9DQoJCQkNCgkJCS8vbW92aW5nIHRoZSBtZW51IG91dHNpZGUgdGhlIG1haW4gY29udGFpbmVyIChhdm9pZCBwcm9ibGVtcyB3aXRoIGZpeGVkIHBvc2l0aW9ucyB3aGVuIHVzaW5nIENTUzMgdHJhbmZvcm1zKQ0KCQkJaWYob3B0aW9ucy5tZW51ICYmIG9wdGlvbnMuY3NzMyl7DQoJCQkJJChvcHRpb25zLm1lbnUpLmFwcGVuZFRvKCdib2R5Jyk7DQoJCQl9DQoNCgkJCWlmKG9wdGlvbnMuc2Nyb2xsT3ZlcmZsb3cpew0KCQkJCS8vYWZ0ZXIgRE9NIGFuZCBpbWFnZXMgYXJlIGxvYWRlZCANCgkJCQkkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbigpIHsNCgkJCQkJDQoJCQkJCSQoJy5zZWN0aW9uJykuZWFjaChmdW5jdGlvbigpew0KCQkJCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuZmluZCgnLnNsaWRlJyk7DQoJCQkJCQkNCgkJCQkJCWlmKHNsaWRlcy5sZW5ndGgpew0KCQkJCQkJCXNsaWRlcy5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJCQkJCWNyZWF0ZVNsaW1TY3JvbGxpbmcoJCh0aGlzKSk7DQoJCQkJCQkJfSk7DQoJCQkJCQl9ZWxzZXsNCgkJCQkJCQljcmVhdGVTbGltU2Nyb2xsaW5nKCQodGhpcykpOw0KCQkJCQkJfQ0KCQkJCQkJDQoJCQkJCX0pOw0KCQkJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJSZW5kZXIgKSAmJiBvcHRpb25zLmFmdGVyUmVuZGVyLmNhbGwoIHRoaXMpOw0KCQkJCX0pOw0KCQkJfWVsc2V7DQoJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyUmVuZGVyICkgJiYgb3B0aW9ucy5hZnRlclJlbmRlci5jYWxsKCB0aGlzKTsNCgkJCX0NCg0KDQoJCQkvL2dldHRpbmcgdGhlIGFuY2hvciBsaW5rIGluIHRoZSBVUkwgYW5kIGRlbGV0aW5nIHRoZSBgI2ANCgkJCXZhciB2YWx1ZSA9ICB3aW5kb3cubG9jYXRpb24uaGFzaC5yZXBsYWNlKCcjJywgJycpLnNwbGl0KCcvJyk7DQoJCQl2YXIgZGVzdGlueSA9IHZhbHVlWzBdOw0KDQoJCQlpZihkZXN0aW55Lmxlbmd0aCl7DQoJCQkJdmFyIHNlY3Rpb24gPSAkKCdbZGF0YS1hbmNob3I9IicrZGVzdGlueSsnIl0nKTsNCg0KCQkJCWlmKCFvcHRpb25zLmFuaW1hdGVBbmNob3IgJiYgc2VjdGlvbi5sZW5ndGgpeyANCgkJCQkJc2lsZW50U2Nyb2xsKHNlY3Rpb24ucG9zaXRpb24oKS50b3ApOw0KCQkJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJMb2FkICkgJiYgb3B0aW9ucy5hZnRlckxvYWQuY2FsbCggdGhpcywgZGVzdGlueSwgKHNlY3Rpb24uaW5kZXgoJy5zZWN0aW9uJykgKyAxKSk7DQoNCgkJCQkJLy91cGRhdGluZyB0aGUgYWN0aXZlIGNsYXNzDQoJCQkJCXNlY3Rpb24uYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCX0NCgkJCX0NCg0KCQ0KCQkJJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7DQoJCQkJc2Nyb2xsVG9BbmNob3IoKTsJDQoJCQl9KTsNCgkJCQ0KCQl9KTsNCgkNCgkJdmFyIHNjcm9sbElkOw0KCQl2YXIgaXNTY3JvbGxpbmcgPSBmYWxzZTsNCgkJDQoJCS8vd2hlbiBzY3JvbGxpbmcuLi4NCgkJJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbihlKXsNCg0KCQkJaWYoIW9wdGlvbnMuYXV0b1Njcm9sbGluZyl7CQkJCQkNCgkJCQl2YXIgY3VycmVudFNjcm9sbCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTsNCgkJCQkNCgkJCQl2YXIgc2Nyb2xsZWRTZWN0aW9ucyA9ICQoJy5zZWN0aW9uJykubWFwKGZ1bmN0aW9uKCl7DQoJCQkJCWlmICgkKHRoaXMpLm9mZnNldCgpLnRvcCA8IChjdXJyZW50U2Nyb2xsICsgMTAwKSl7DQoJCQkJCQlyZXR1cm4gJCh0aGlzKTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJCQ0KCQkJCS8vZ2V0aW5nIHRoZSBsYXN0IG9uZSwgdGhlIGN1cnJlbnQgb25lIG9uIHRoZSBzY3JlZW4NCgkJCQl2YXIgY3VycmVudFNlY3Rpb24gPSBzY3JvbGxlZFNlY3Rpb25zW3Njcm9sbGVkU2VjdGlvbnMubGVuZ3RoLTFdOw0KCQkJCQ0KCQkJCS8vZXhlY3V0aW5nIG9ubHkgb25jZSB0aGUgZmlyc3QgdGltZSB3ZSByZWFjaCB0aGUgc2VjdGlvbg0KCQkJCWlmKCFjdXJyZW50U2VjdGlvbi5oYXNDbGFzcygnYWN0aXZlJykpew0KCQkJCQl2YXIgbGVhdmluZ1NlY3Rpb24gPSAkKCcuc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLnNlY3Rpb24nKSArIDE7DQoNCgkJCQkJaXNTY3JvbGxpbmcgPSB0cnVlOwkNCgkJCQkJDQoJCQkJCXZhciB5TW92ZW1lbnQgPSBnZXRZbW92ZW1lbnQoY3VycmVudFNlY3Rpb24pOw0KCQkJCQkNCgkJCQkJY3VycmVudFNlY3Rpb24uYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCQ0KCQkJCQl2YXIgYW5jaG9yTGluayAgPSBjdXJyZW50U2VjdGlvbi5kYXRhKCdhbmNob3InKTsNCgkJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLm9uTGVhdmUgKSAmJiBvcHRpb25zLm9uTGVhdmUuY2FsbCggdGhpcywgbGVhdmluZ1NlY3Rpb24sIHlNb3ZlbWVudCk7DQoNCgkJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyTG9hZCApICYmIG9wdGlvbnMuYWZ0ZXJMb2FkLmNhbGwoIHRoaXMsIGFuY2hvckxpbmssIChjdXJyZW50U2VjdGlvbi5pbmRleCgnLnNlY3Rpb24nKSArIDEpKTsNCgkJCQkJDQoJCQkJCWFjdGl2YXRlTWVudUVsZW1lbnQoYW5jaG9yTGluayk7CQ0KCQkJCQlhY3RpdmF0ZU5hdkRvdHMoYW5jaG9yTGluaywgMCk7DQoJCQkJCQ0KCQkJCQ0KCQkJCQlpZihvcHRpb25zLmFuY2hvcnMubGVuZ3RoICYmICFpc01vdmluZyl7DQoJCQkJCQkvL25lZWRlZCB0byBlbnRlciBpbiBoYXNoQ2hhbmdlIGV2ZW50IHdoZW4gdXNpbmcgdGhlIG1lbnUgd2l0aCBhbmNob3IgbGlua3MNCgkJCQkJCWxhc3RTY3JvbGxlZERlc3RpbnkgPSBhbmNob3JMaW5rOw0KCQkJDQoJCQkJCQlsb2NhdGlvbi5oYXNoID0gYW5jaG9yTGluazsNCgkJCQkJfQ0KCQkJCQkNCgkJCQkJLy9zbWFsbCB0aW1lb3V0IGluIG9yZGVyIHRvIGF2b2lkIGVudGVyaW5nIGluIGhhc2hDaGFuZ2UgZXZlbnQgd2hlbiBzY3JvbGxpbmcgaXMgbm90IGZpbmlzaGVkIHlldA0KCQkJCQljbGVhclRpbWVvdXQoc2Nyb2xsSWQpOw0KCQkJCQlzY3JvbGxJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsJCQkJCQ0KCQkJCQkJaXNTY3JvbGxpbmcgPSBmYWxzZTsNCgkJCQkJfSwgMTAwKTsNCgkJCQl9DQoJCQkJDQoJCQl9CQkJCQkNCgkJfSk7CQ0KCQ0KDQoJCQ0KCQ0KCQl2YXIgdG91Y2hTdGFydFkgPSAwOw0KCQl2YXIgdG91Y2hTdGFydFggPSAwOw0KCQl2YXIgdG91Y2hFbmRZID0gMDsNCgkJdmFyIHRvdWNoRW5kWCA9IDA7DQoJDQoJCS8qIERldGVjdGluZyB0b3VjaCBldmVudHMgDQoJCQ0KCQkqIEFzIHdlIGFyZSBjaGFuZ2luZyB0aGUgdG9wIHByb3BlcnR5IG9mIHRoZSBwYWdlIG9uIHNjcm9sbGluZywgd2UgY2FuIG5vdCB1c2UgdGhlIHRyYWRpdGlvbmFsIHdheSB0byBkZXRlY3QgaXQuDQoJCSogVGhpcyB3YXksIHRoZSB0b3VjaHN0YXJ0IGFuZCB0aGUgdG91Y2ggbW92ZXMgc2hvd3MgYW4gc21hbGwgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZW0gd2hpY2ggaXMgdGhlDQoJCSogdXNlZCBvbmUgdG8gZGV0ZXJtaW5lIHRoZSBkaXJlY3Rpb24uDQoJCSovCQkNCgkJZnVuY3Rpb24gdG91Y2hNb3ZlSGFuZGxlcihldmVudCl7DQoJCQl2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7DQoNCgkJCWlmKG9wdGlvbnMuYXV0b1Njcm9sbGluZyl7DQoJCQkJLy9wcmV2ZW50aW5nIHRoZSBlYXNpbmcgb24gaU9TIGRldmljZXMgDQoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsNCgkJCX0NCg0KCQkJLy8gYWRkaXRpb25hbDogaWYgb25lIG9mIHRoZSBub3JtYWxTY3JvbGxFbGVtZW50cyBpc24ndCB3aXRoaW4gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQgaG9wcyB1cCB0aGUgRE9NIGNoYWluDQoJCQlpZiAoIWNoZWNrUGFyZW50Rm9yTm9ybWFsU2Nyb2xsRWxlbWVudChldmVudC50YXJnZXQpKSB7DQoJCQ0KCQkJCXZhciB0b3VjaE1vdmVkID0gZmFsc2U7DQoJCQkJdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcuc2VjdGlvbi5hY3RpdmUnKTsNCgkJCQl2YXIgc2Nyb2xsYWJsZTsNCg0KCQkJCWlmICghaXNNb3ZpbmcgJiYgIXNsaWRlTW92aW5nKSB7IC8vaWYgdGhlcmVzIGFueSAjDQoJCQkJCXZhciB0b3VjaEV2ZW50cyA9IGdldEV2ZW50c1BhZ2UoZSk7DQoJCQkJCXRvdWNoRW5kWSA9IHRvdWNoRXZlbnRzWyd5J107DQoJCQkJCXRvdWNoRW5kWCA9IHRvdWNoRXZlbnRzWyd4J107DQoJCQkJCQkJCQkJDQoJCQkJCS8vaWYgbW92ZW1lbnQgaW4gdGhlIFggYXh5cyBpcyBncmVhdGVyIHRoYW4gaW4gdGhlIFkgYW5kIHRoZSBjdXJyZWN0IHNlY3Rpb24gaGFzIHNsaWRlcy4uLg0KCQkJCQlpZiAoYWN0aXZlU2VjdGlvbi5maW5kKCcuc2xpZGVzJykubGVuZ3RoICYmIE1hdGguYWJzKHRvdWNoU3RhcnRYIC0gdG91Y2hFbmRYKSA+IChNYXRoLmFicyh0b3VjaFN0YXJ0WSAtIHRvdWNoRW5kWSkpKSB7DQoJCQkJCSAgICANCgkJCQkJICAgIC8vaXMgdGhlIG1vdmVtZW50IGdyZWF0ZXIgdGhhbiB0aGUgbWluaW11bSByZXNpc3RhbmNlIHRvIHNjcm9sbD8NCgkJCQkJICAgIGlmIChNYXRoLmFicyh0b3VjaFN0YXJ0WCAtIHRvdWNoRW5kWCkgPiAoJCh3aW5kb3cpLndpZHRoKCkgLyAxMDAgKiBvcHRpb25zLnRvdWNoU2Vuc2l0aXZpdHkpKSB7DQoJCQkJCSAgICAgICAgaWYgKHRvdWNoU3RhcnRYID4gdG91Y2hFbmRYKSB7DQoJCQkJCSAgICAgICAgICAgICQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlUmlnaHQoKTsgLy9uZXh0IA0KCQkJCQkgICAgICAgIH0gZWxzZSB7DQoJCQkJCSAgICAgICAgICAgICQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlTGVmdCgpOyAvL3ByZXYNCgkJCQkJICAgICAgICB9DQoJCQkJCSAgICB9DQoJCQkJCX0NCg0KCQkJCQkvL3ZlcnRpY2FsIHNjcm9sbGluZyAob25seSB3aGVuIGF1dG9TY3JvbGxpbmcgaXMgZW5hYmxlZCkNCgkJCQkJZWxzZSBpZihvcHRpb25zLmF1dG9TY3JvbGxpbmcpew0KCQkJCQkNCgkJCQkJCS8vaWYgdGhlcmUgYXJlIGxhbmRzY2FwZSBzbGlkZXMsIHdlIGNoZWNrIGlmIHRoZSBzY3JvbGxpbmcgYmFyIGlzIGluIHRoZSBjdXJyZW50IG9uZSBvciBub3QNCgkJCQkJCWlmKGFjdGl2ZVNlY3Rpb24uZmluZCgnLnNsaWRlcycpLmxlbmd0aCl7DQoJCQkJCQkJc2Nyb2xsYWJsZT0gYWN0aXZlU2VjdGlvbi5maW5kKCcuc2xpZGUuYWN0aXZlJykuZmluZCgnLnNjcm9sbGFibGUnKTsNCgkJCQkJCX1lbHNlew0KCQkJCQkJCXNjcm9sbGFibGUgPSBhY3RpdmVTZWN0aW9uLmZpbmQoJy5zY3JvbGxhYmxlJyk7DQoJCQkJCQl9DQoJCQkJCQkNCgkJCQkJCS8vaXMgdGhlIG1vdmVtZW50IGdyZWF0ZXIgdGhhbiB0aGUgbWluaW11bSByZXNpc3RhbmNlIHRvIHNjcm9sbD8NCgkJCQkJCWlmIChNYXRoLmFicyh0b3VjaFN0YXJ0WSAtIHRvdWNoRW5kWSkgPiAoJCh3aW5kb3cpLmhlaWdodCgpIC8gMTAwICogb3B0aW9ucy50b3VjaFNlbnNpdGl2aXR5KSkgew0KCQkJCQkJCWlmICh0b3VjaFN0YXJ0WSA+IHRvdWNoRW5kWSkgew0KCQkJCQkJCQlpZihzY3JvbGxhYmxlLmxlbmd0aCA+IDAgKXsNCgkJCQkJCQkJCS8vaXMgdGhlIHNjcm9sbGJhciBhdCB0aGUgZW5kIG9mIHRoZSBzY3JvbGw/DQoJCQkJCQkJCQlpZihpc1Njcm9sbGVkKCdib3R0b20nLCBzY3JvbGxhYmxlKSl7DQoJCQkJCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvbkRvd24oKTsNCgkJCQkJCQkJCX1lbHNlew0KCQkJCQkJCQkJCXJldHVybiB0cnVlOw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9ZWxzZXsNCgkJCQkJCQkJCS8vIG1vdmVkIGRvd24NCgkJCQkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25Eb3duKCk7DQoJCQkJCQkJCX0NCgkJCQkJCQl9IGVsc2UgaWYgKHRvdWNoRW5kWSA+IHRvdWNoU3RhcnRZKSB7DQoJCQkJCQkJCQ0KCQkJCQkJCQlpZihzY3JvbGxhYmxlLmxlbmd0aCA+IDApew0KCQkJCQkJCQkJLy9pcyB0aGUgc2Nyb2xsYmFyIGF0IHRoZSBzdGFydCBvZiB0aGUgc2Nyb2xsPw0KCQkJCQkJCQkJaWYoaXNTY3JvbGxlZCgndG9wJywgc2Nyb2xsYWJsZSkpew0KCQkJCQkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25VcCgpOw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQkJZWxzZXsNCgkJCQkJCQkJCQlyZXR1cm4gdHJ1ZTsNCgkJCQkJCQkJCX0NCgkJCQkJCQkJfWVsc2V7DQoJCQkJCQkJCQkvLyBtb3ZlZCB1cA0KCQkJCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvblVwKCk7DQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJfQ0KDQoJCS8qKg0KCQkgKiByZWN1cnNpdmUgZnVuY3Rpb24gdG8gbG9vcCB1cCB0aGUgcGFyZW50IG5vZGVzIHRvIGNoZWNrIGlmIG9uZSBvZiB0aGVtIGV4aXN0cyBpbiBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzDQoJCSAqIEN1cnJlbnRseSB3b3JrcyB3ZWxsIGZvciBpT1MgLSBBbmRyb2lkIG1pZ2h0IG5lZWQgc29tZSB0ZXN0aW5nDQoJCSAqIEBwYXJhbSAge0VsZW1lbnR9IGVsICB0YXJnZXQgZWxlbWVudCAvIGpxdWVyeSBzZWxlY3RvciAoaW4gc3Vic2VxdWVudCBub2RlcykNCgkJICogQHBhcmFtICB7aW50fSAgICAgaG9wIGN1cnJlbnQgaG9wIGNvbXBhcmVkIHRvIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudFRvdWNoVGhyZXNob2xkIA0KCQkgKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIHRoZXJlIGlzIGEgbWF0Y2ggdG8gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cw0KCQkgKi8NCgkJZnVuY3Rpb24gY2hlY2tQYXJlbnRGb3JOb3JtYWxTY3JvbGxFbGVtZW50IChlbCwgaG9wKSB7DQoJCQlob3AgPSBob3AgfHwgMDsNCgkJCXZhciBwYXJlbnQgPSAkKGVsKS5wYXJlbnQoKTsNCg0KCQkJaWYgKGhvcCA8IG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudFRvdWNoVGhyZXNob2xkICYmDQoJCQkJcGFyZW50LmlzKG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMpICkgew0KCQkJCXJldHVybiB0cnVlOw0KCQkJfSBlbHNlIGlmIChob3AgPT0gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQpIHsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9IGVsc2Ugew0KCQkJCXJldHVybiBjaGVja1BhcmVudEZvck5vcm1hbFNjcm9sbEVsZW1lbnQocGFyZW50LCArK2hvcCk7DQoJCQl9DQoJCX0NCgkJDQoJCWZ1bmN0aW9uIHRvdWNoU3RhcnRIYW5kbGVyKGV2ZW50KXsNCgkJCXZhciBlID0gZXZlbnQub3JpZ2luYWxFdmVudDsNCgkJCXZhciB0b3VjaEV2ZW50cyA9IGdldEV2ZW50c1BhZ2UoZSk7DQoJCQl0b3VjaFN0YXJ0WSA9IHRvdWNoRXZlbnRzWyd5J107DQoJCQl0b3VjaFN0YXJ0WCA9IHRvdWNoRXZlbnRzWyd4J107DQoJCX0NCgkJDQoNCg0KCQkvKioNCgkJICogRGV0ZWN0aW5nIG1vdXNld2hlZWwgc2Nyb2xsaW5nDQoJCSAqIA0KCQkgKiBodHRwOi8vYmxvZ3Muc2l0ZXBvaW50c3RhdGljLmNvbS9leGFtcGxlcy90ZWNoL21vdXNlLXdoZWVsL2luZGV4Lmh0bWwNCgkJICogaHR0cDovL3d3dy5zaXRlcG9pbnQuY29tL2h0bWw1LWphdmFzY3JpcHQtbW91c2Utd2hlZWwvDQoJCSAqLw0KCQlmdW5jdGlvbiBNb3VzZVdoZWVsSGFuZGxlcihlKSB7DQoJCQlpZihvcHRpb25zLmF1dG9TY3JvbGxpbmcpew0KCQkJCS8vIGNyb3NzLWJyb3dzZXIgd2hlZWwgZGVsdGENCgkJCQllID0gd2luZG93LmV2ZW50IHx8IGU7DQoJCQkJdmFyIGRlbHRhID0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsDQoJCQkJCQkoZS53aGVlbERlbHRhIHx8IC1lLmRlbHRhWSB8fCAtZS5kZXRhaWwpKSk7DQoJCQkJdmFyIHNjcm9sbGFibGU7DQoJCQkJdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcuc2VjdGlvbi5hY3RpdmUnKTsNCgkJCQkNCgkJCQlpZiAoIWlzTW92aW5nKSB7IC8vaWYgdGhlcmVzIGFueSAjDQoJCQkJDQoJCQkJCS8vaWYgdGhlcmUgYXJlIGxhbmRzY2FwZSBzbGlkZXMsIHdlIGNoZWNrIGlmIHRoZSBzY3JvbGxpbmcgYmFyIGlzIGluIHRoZSBjdXJyZW50IG9uZSBvciBub3QNCgkJCQkJaWYoYWN0aXZlU2VjdGlvbi5maW5kKCcuc2xpZGVzJykubGVuZ3RoKXsNCgkJCQkJCXNjcm9sbGFibGU9IGFjdGl2ZVNlY3Rpb24uZmluZCgnLnNsaWRlLmFjdGl2ZScpLmZpbmQoJy5zY3JvbGxhYmxlJyk7DQoJCQkJCX1lbHNlew0KCQkJCQkJc2Nyb2xsYWJsZSA9IGFjdGl2ZVNlY3Rpb24uZmluZCgnLnNjcm9sbGFibGUnKTsNCgkJCQkJfQ0KCQkJCQ0KCQkJCQkvL3Njcm9sbGluZyBkb3duPw0KCQkJCQlpZiAoZGVsdGEgPCAwKSB7DQoJCQkJCQlpZihzY3JvbGxhYmxlLmxlbmd0aCA+IDAgKXsNCgkJCQkJCQkvL2lzIHRoZSBzY3JvbGxiYXIgYXQgdGhlIGVuZCBvZiB0aGUgc2Nyb2xsPw0KCQkJCQkJCWlmKGlzU2Nyb2xsZWQoJ2JvdHRvbScsIHNjcm9sbGFibGUpKXsNCgkJCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvbkRvd24oKTsNCgkJCQkJCQl9ZWxzZXsNCgkJCQkJCQkJcmV0dXJuIHRydWU7IC8vbm9ybWFsIHNjcm9sbA0KCQkJCQkJCX0NCgkJCQkJCX1lbHNlew0KCQkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25Eb3duKCk7DQoJCQkJCQl9DQoJCQkJCX0NCg0KCQkJCQkvL3Njcm9sbGluZyB1cD8NCgkJCQkJZWxzZSB7DQoJCQkJCQlpZihzY3JvbGxhYmxlLmxlbmd0aCA+IDApew0KCQkJCQkJCS8vaXMgdGhlIHNjcm9sbGJhciBhdCB0aGUgc3RhcnQgb2YgdGhlIHNjcm9sbD8NCgkJCQkJCQlpZihpc1Njcm9sbGVkKCd0b3AnLCBzY3JvbGxhYmxlKSl7DQoJCQkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25VcCgpOw0KCQkJCQkJCX1lbHNlew0KCQkJCQkJCQlyZXR1cm4gdHJ1ZTsgLy9ub3JtYWwgc2Nyb2xsDQoJCQkJCQkJfQ0KCQkJCQkJfWVsc2V7DQoJCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvblVwKCk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoJCX0NCg0KCQkNCgkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvblVwID0gZnVuY3Rpb24oKXsNCgkJCXZhciBwcmV2ID0gJCgnLnNlY3Rpb24uYWN0aXZlJykucHJldignLnNlY3Rpb24nKTsNCgkJCQ0KCQkJLy9sb29waW5nIHRvIHRoZSBib3R0b20gaWYgdGhlcmUncyBubyBtb3JlIHNlY3Rpb25zIGFib3ZlDQoJCQlpZiAoIXByZXYubGVuZ3RoICYmIChvcHRpb25zLmxvb3BUb3AgfHwgb3B0aW9ucy5jb250aW51b3VzVmVydGljYWwpKSB7DQoJCQkJcHJldiA9ICQoJy5zZWN0aW9uJykubGFzdCgpOw0KCQkJfQ0KDQoJCQlpZiAocHJldi5sZW5ndGgpIHsNCgkJCQlzY3JvbGxQYWdlKHByZXYsIG51bGwsIHRydWUpOw0KCQkJfQ0KCQl9Ow0KDQoJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25Eb3duID0gZnVuY3Rpb24gKCl7DQoJCQl2YXIgbmV4dCA9ICQoJy5zZWN0aW9uLmFjdGl2ZScpLm5leHQoJy5zZWN0aW9uJyk7DQoNCgkJCS8vbG9vcGluZyB0byB0aGUgdG9wIGlmIHRoZXJlJ3Mgbm8gbW9yZSBzZWN0aW9ucyBiZWxvdw0KCQkJaWYoIW5leHQubGVuZ3RoICYmDQoJCQkJKG9wdGlvbnMubG9vcEJvdHRvbSB8fCBvcHRpb25zLmNvbnRpbnVvdXNWZXJ0aWNhbCkpew0KCQkJCW5leHQgPSAkKCcuc2VjdGlvbicpLmZpcnN0KCk7DQoJCQl9DQoNCgkJCWlmKG5leHQubGVuZ3RoID4gMCB8fA0KCQkJCSghbmV4dC5sZW5ndGggJiYNCgkJCQkob3B0aW9ucy5sb29wQm90dG9tIHx8IG9wdGlvbnMuY29udGludW91c1ZlcnRpY2FsKSkpew0KCQkJCXNjcm9sbFBhZ2UobmV4dCwgbnVsbCwgZmFsc2UpOw0KCQkJfQ0KCQl9Ow0KCQkNCgkJJC5mbi5mdWxscGFnZS5tb3ZlVG8gPSBmdW5jdGlvbiAoc2VjdGlvbiwgc2xpZGUpew0KCQkJdmFyIGRlc3RpbnkgPSAnJzsNCgkJCQ0KCQkJaWYoaXNOYU4oc2VjdGlvbikpew0KCQkJCWRlc3RpbnkgPSAkKCdbZGF0YS1hbmNob3I9Iicrc2VjdGlvbisnIl0nKTsNCgkJCX1lbHNlew0KCQkJCWRlc3RpbnkgPSAkKCcuc2VjdGlvbicpLmVxKCAoc2VjdGlvbiAtMSkgKTsNCgkJCX0NCgkJCQ0KCQkJaWYgKHR5cGVvZiBzbGlkZSAhPT0gJ3VuZGVmaW5lZCcpew0KCQkJCXNjcm9sbFBhZ2VBbmRTbGlkZShzZWN0aW9uLCBzbGlkZSk7DQoJCQl9ZWxzZSBpZihkZXN0aW55Lmxlbmd0aCA+IDApew0KCQkJCXNjcm9sbFBhZ2UoZGVzdGlueSk7DQoJCQl9DQoJCX07DQoNCgkJJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVSaWdodCA9IGZ1bmN0aW9uKCl7DQoJCQltb3ZlU2xpZGUoJ25leHQnKTsNCgkJfQ0KDQoJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlTGVmdCA9IGZ1bmN0aW9uKCl7DQoJCQltb3ZlU2xpZGUoJ3ByZXYnKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIG1vdmVTbGlkZShkaXJlY3Rpb24pew0KCQkgICAgdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcuc2VjdGlvbi5hY3RpdmUnKTsNCgkJICAgIHZhciBzbGlkZXMgPSBhY3RpdmVTZWN0aW9uLmZpbmQoJy5zbGlkZXMnKTsNCg0KCQkgICAgLy8gbW9yZSB0aGFuIG9uZSBzbGlkZSBuZWVkZWQgYW5kIG5vdGhpbmcgc2hvdWxkIGJlIHNsaWRpbmcNCgkJCWlmICghc2xpZGVzLmxlbmd0aCB8fCBzbGlkZU1vdmluZykgew0KCQkJICAgIHJldHVybjsNCgkJCX0NCg0KCQkgICAgdmFyIGN1cnJlbnRTbGlkZSA9IHNsaWRlcy5maW5kKCcuc2xpZGUuYWN0aXZlJyk7DQoJCSAgICB2YXIgZGVzdGlueSA9IG51bGw7DQoNCgkJICAgIGlmKGRpcmVjdGlvbiA9PT0gJ3ByZXYnKXsNCgkJICAgICAgICBkZXN0aW55ID0gY3VycmVudFNsaWRlLnByZXYoJy5zbGlkZScpOw0KCQkgICAgfWVsc2V7DQoJCSAgICAgICAgZGVzdGlueSA9IGN1cnJlbnRTbGlkZS5uZXh0KCcuc2xpZGUnKTsNCgkJICAgIH0NCg0KCQkgICAgLy9pc24ndCB0aGVyZSBhIG5leHQgc2xpZGUgaW4gdGhlIHNlY3VlbmNlPw0KCQkJaWYoIWRlc3RpbnkubGVuZ3RoKXsNCgkJCQkvL3Jlc3BlY3QgbG9vcEhvcml6b250YWwgc2V0dGluDQoJCQkJaWYgKCFvcHRpb25zLmxvb3BIb3Jpem9udGFsKSByZXR1cm47DQoNCgkJCSAgICBpZihkaXJlY3Rpb24gPT09ICdwcmV2Jyl7DQoJCQkgICAgICAgIGRlc3RpbnkgPSBjdXJyZW50U2xpZGUuc2libGluZ3MoJzpsYXN0Jyk7DQoJCQkgICAgfWVsc2V7DQoJCQkgICAgICAgIGRlc3RpbnkgPSBjdXJyZW50U2xpZGUuc2libGluZ3MoJzpmaXJzdCcpOw0KCQkJICAgIH0NCgkJCX0NCg0KCQkgICAgc2xpZGVNb3ZpbmcgPSB0cnVlOw0KDQoJCSAgICBsYW5kc2NhcGVTY3JvbGwoc2xpZGVzLCBkZXN0aW55KTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIHNjcm9sbFBhZ2UoZWxlbWVudCwgY2FsbGJhY2ssIGlzTW92ZW1lbnRVcCl7DQoJCQl2YXIgc2Nyb2xsT3B0aW9ucyA9IHt9LCBzY3JvbGxlZEVsZW1lbnQ7DQoJCQl2YXIgZGVzdCA9IGVsZW1lbnQucG9zaXRpb24oKTsNCgkJCWlmKHR5cGVvZiBkZXN0ID09PSAidW5kZWZpbmVkIil7IHJldHVybjsgfSAvL3RoZXJlJ3Mgbm8gZWxlbWVudCB0byBzY3JvbGwsIGxlYXZpbmcgdGhlIGZ1bmN0aW9uDQoJCQl2YXIgZHRvcCA9IGRlc3QudG9wOwkJCQ0KCQkJdmFyIHlNb3ZlbWVudCA9IGdldFltb3ZlbWVudChlbGVtZW50KTsNCgkJCXZhciBhbmNob3JMaW5rICA9IGVsZW1lbnQuZGF0YSgnYW5jaG9yJyk7DQoJCQl2YXIgc2VjdGlvbkluZGV4ID0gZWxlbWVudC5pbmRleCgnLnNlY3Rpb24nKTsNCgkJCXZhciBhY3RpdmVTbGlkZSA9IGVsZW1lbnQuZmluZCgnLnNsaWRlLmFjdGl2ZScpOw0KCQkJdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcuc2VjdGlvbi5hY3RpdmUnKTsNCgkJCXZhciBsZWF2aW5nU2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24uaW5kZXgoJy5zZWN0aW9uJykgKyAxOw0KDQoJCQkvL2NhY2hpbmcgdGhlIHZhbHVlIG9mIGlzUmVzaXppbmcgYXQgdGhlIG1vbW1lbnQgdGhlIGZ1bmN0aW9uIGlzIGNhbGxlZCANCgkJCS8vYmVjYXVzZSBpdCB3aWxsIGJlIGNoZWNrZWQgbGF0ZXIgaW5zaWRlIGEgc2V0VGltZW91dCBhbmQgdGhlIHZhbHVlIG1pZ2h0IGNoYW5nZQ0KCQkJdmFyIGxvY2FsSXNSZXNpemluZyA9IGlzUmVzaXppbmc7IA0KDQoJCQlpZihhY3RpdmVTbGlkZS5sZW5ndGgpew0KCQkJCXZhciBzbGlkZUFuY2hvckxpbmsgPSBhY3RpdmVTbGlkZS5kYXRhKCdhbmNob3InKTsNCgkJCQl2YXIgc2xpZGVJbmRleCA9IGFjdGl2ZVNsaWRlLmluZGV4KCk7DQoJCQl9DQoNCgkJCS8vIElmIGNvbnRpbnVvdXNWZXJ0aWNhbCAmJiB3ZSBuZWVkIHRvIHdyYXAgYXJvdW5kDQoJCQlpZiAob3B0aW9ucy5hdXRvU2Nyb2xsaW5nICYmIG9wdGlvbnMuY29udGludW91c1ZlcnRpY2FsICYmIHR5cGVvZiAoaXNNb3ZlbWVudFVwKSAhPT0gInVuZGVmaW5lZCIgJiYNCgkJCQkoKCFpc01vdmVtZW50VXAgJiYgeU1vdmVtZW50ID09ICd1cCcpIHx8IC8vIEludGVuZGluZyB0byBzY3JvbGwgZG93biBidXQgYWJvdXQgdG8gZ28gdXAgb3INCgkJCQkoaXNNb3ZlbWVudFVwICYmIHlNb3ZlbWVudCA9PSAnZG93bicpKSkgeyAvLyBpbnRlbmRpbmcgdG8gc2Nyb2xsIHVwIGJ1dCBhYm91dCB0byBnbyBkb3duDQoNCgkJCQkvLyBTY3JvbGxpbmcgZG93bg0KCQkJCWlmICghaXNNb3ZlbWVudFVwKSB7DQoJCQkJCS8vIE1vdmUgYWxsIHByZXZpb3VzIHNlY3Rpb25zIHRvIGFmdGVyIHRoZSBhY3RpdmUgc2VjdGlvbg0KCQkJCQkkKCIuc2VjdGlvbi5hY3RpdmUiKS5hZnRlcihhY3RpdmVTZWN0aW9uLnByZXZBbGwoIi5zZWN0aW9uIikuZ2V0KCkucmV2ZXJzZSgpKTsNCgkJCQl9DQoJCQkJZWxzZSB7IC8vIFNjcm9sbGluZyB1cA0KCQkJCQkvLyBNb3ZlIGFsbCBuZXh0IHNlY3Rpb25zIHRvIGJlZm9yZSB0aGUgYWN0aXZlIHNlY3Rpb24NCgkJCQkJJCgiLnNlY3Rpb24uYWN0aXZlIikuYmVmb3JlKGFjdGl2ZVNlY3Rpb24ubmV4dEFsbCgiLnNlY3Rpb24iKSk7DQoJCQkJfQ0KDQoJCQkJLy8gTWFpbnRhaW4gdGhlIGRpc3BsYXllZCBwb3NpdGlvbiAobm93IHRoYXQgd2UgY2hhbmdlZCB0aGUgZWxlbWVudCBvcmRlcikNCgkJCQlzaWxlbnRTY3JvbGwoJCgnLnNlY3Rpb24uYWN0aXZlJykucG9zaXRpb24oKS50b3ApOw0KDQoJCQkJLy8gc2F2ZSBmb3IgbGF0ZXIgdGhlIGVsZW1lbnRzIHRoYXQgc3RpbGwgbmVlZCB0byBiZSByZW9yZGVyZWQNCgkJCQl2YXIgd3JhcEFyb3VuZEVsZW1lbnRzID0gYWN0aXZlU2VjdGlvbjsNCg0KCQkJCS8vIFJlY2FsY3VsYXRlIGFuaW1hdGlvbiB2YXJpYWJsZXMNCgkJCQlkZXN0ID0gZWxlbWVudC5wb3NpdGlvbigpOw0KCQkJCWR0b3AgPSBkZXN0LnRvcDsNCgkJCQl5TW92ZW1lbnQgPSBnZXRZbW92ZW1lbnQoZWxlbWVudCk7DQoJCQl9DQoNCgkJCQ0KCQkJZWxlbWVudC5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQkNCgkJCS8vcHJldmVudGluZyBmcm9tIGFjdGl2YXRpbmcgdGhlIE1vdXNlV2hlZWxIYW5kbGVyIGV2ZW50DQoJCQkvL21vcmUgdGhhbiBvbmNlIGlmIHRoZSBwYWdlIGlzIHNjcm9sbGluZw0KCQkJaXNNb3ZpbmcgPSB0cnVlOw0KCQkJDQoJCQlpZih0eXBlb2YgYW5jaG9yTGluayAhPT0gJ3VuZGVmaW5lZCcpew0KCQkJCXNldFVSTEhhc2goc2xpZGVJbmRleCwgc2xpZGVBbmNob3JMaW5rLCBhbmNob3JMaW5rKTsNCgkJCX0NCgkJCQ0KCQkJaWYob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCgkJCQlzY3JvbGxPcHRpb25zWyd0b3AnXSA9IC1kdG9wOw0KCQkJCXNjcm9sbGVkRWxlbWVudCA9IGNvbnRhaW5lci5zZWxlY3RvcjsNCgkJCX1lbHNlew0KCQkJCXNjcm9sbE9wdGlvbnNbJ3Njcm9sbFRvcCddID0gZHRvcDsNCgkJCQlzY3JvbGxlZEVsZW1lbnQgPSAnaHRtbCwgYm9keSc7DQoJCQl9DQoNCgkJCS8vIEZpeCBzZWN0aW9uIG9yZGVyIGFmdGVyIGNvbnRpbnVvdXNWZXJ0aWNhbCBjaGFuZ2VzIGhhdmUgYmVlbiBhbmltYXRlZA0KCQkJdmFyIGNvbnRpbnVvdXNWZXJ0aWNhbEZpeFNlY3Rpb25PcmRlciA9IGZ1bmN0aW9uICgpIHsNCgkJCQkvLyBJZiBjb250aW51b3VzVmVydGljYWwgaXMgaW4gZWZmZWN0IChhbmQgYXV0b1Njcm9sbGluZyB3b3VsZCBhbHNvIGJlIGluIGVmZmVjdCB0aGVuKSwgDQoJCQkJLy8gZmluaXNoIG1vdmluZyB0aGUgZWxlbWVudHMgYXJvdW5kIHNvIHRoZSBkaXJlY3QgbmF2aWdhdGlvbiB3aWxsIGZ1bmN0aW9uIG1vcmUgc2ltcGx5DQoJCQkJaWYgKCF3cmFwQXJvdW5kRWxlbWVudHMgfHwgIXdyYXBBcm91bmRFbGVtZW50cy5sZW5ndGgpIHsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCg0KCQkJCWlmIChpc01vdmVtZW50VXApIHsNCgkJCQkJJCgnLnNlY3Rpb246Zmlyc3QnKS5iZWZvcmUod3JhcEFyb3VuZEVsZW1lbnRzKTsNCgkJCQl9DQoJCQkJZWxzZSB7DQoJCQkJCSQoJy5zZWN0aW9uOmxhc3QnKS5hZnRlcih3cmFwQXJvdW5kRWxlbWVudHMpOw0KCQkJCX0NCg0KCQkJCXNpbGVudFNjcm9sbCgkKCcuc2VjdGlvbi5hY3RpdmUnKS5wb3NpdGlvbigpLnRvcCk7DQoJCQl9Ow0KDQoNCgkJCS8vIFVzZSBDU1MzIHRyYW5zbGF0ZSBmdW5jdGlvbmFsaXR5IG9yLi4uDQoJCQlpZiAob3B0aW9ucy5jc3MzICYmIG9wdGlvbnMuYXV0b1Njcm9sbGluZykgew0KDQoJCQkJLy9jYWxsYmFjayAob25MZWF2ZSkgaWYgdGhlIHNpdGUgaXMgbm90IGp1c3QgcmVzaXppbmcgYW5kIHJlYWRqdXN0aW5nIHRoZSBzbGlkZXMNCgkJCQkkLmlzRnVuY3Rpb24ob3B0aW9ucy5vbkxlYXZlKSAmJiAhbG9jYWxJc1Jlc2l6aW5nICYmIG9wdGlvbnMub25MZWF2ZS5jYWxsKHRoaXMsIGxlYXZpbmdTZWN0aW9uLCB5TW92ZW1lbnQpOw0KCQkJCQ0KDQoJCQkJdmFyIHRyYW5zbGF0ZTNkID0gJ3RyYW5zbGF0ZTNkKDBweCwgLScgKyBkdG9wICsgJ3B4LCAwcHgpJzsNCgkJCQl0cmFuc2Zvcm1Db250YWluZXIodHJhbnNsYXRlM2QsIHRydWUpOw0KDQoJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJCS8vZml4IHNlY3Rpb24gb3JkZXIgZnJvbSBjb250aW51b3VzVmVydGljYWwNCgkJCQkJY29udGludW91c1ZlcnRpY2FsRml4U2VjdGlvbk9yZGVyKCk7DQoNCgkJCQkJLy9jYWxsYmFjayAoYWZ0ZXJMb2FkKSAJaWYgdGhlIHNpdGUgaXMgbm90IGp1c3QgcmVzaXppbmcgYW5kIHJlYWRqdXN0aW5nIHRoZSBzbGlkZXMNCgkJCQkJJC5pc0Z1bmN0aW9uKG9wdGlvbnMuYWZ0ZXJMb2FkKSAmJiAhbG9jYWxJc1Jlc2l6aW5nICYmIG9wdGlvbnMuYWZ0ZXJMb2FkLmNhbGwodGhpcywgYW5jaG9yTGluaywgKHNlY3Rpb25JbmRleCArIDEpKTsNCg0KCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkJCWlzTW92aW5nID0gZmFsc2U7DQoJCQkJCQkkLmlzRnVuY3Rpb24oY2FsbGJhY2spICYmIGNhbGxiYWNrLmNhbGwodGhpcyk7DQoJCQkJCX0sIHNjcm9sbERlbGF5KTsNCgkJCQl9LCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkKTsNCgkJCX0gZWxzZSB7IC8vIC4uLiB1c2UgalF1ZXJ5IGFuaW1hdGUgDQoNCgkJCQkvL2NhbGxiYWNrIChvbkxlYXZlKSBpZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KCQkJCSQuaXNGdW5jdGlvbihvcHRpb25zLm9uTGVhdmUpICYmICFsb2NhbElzUmVzaXppbmcgJiYgb3B0aW9ucy5vbkxlYXZlLmNhbGwodGhpcywgbGVhdmluZ1NlY3Rpb24sIHlNb3ZlbWVudCk7DQoNCgkJCQkkKHNjcm9sbGVkRWxlbWVudCkuYW5pbWF0ZSgNCgkJCQkJc2Nyb2xsT3B0aW9ucw0KCQkJCSwgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCwgb3B0aW9ucy5lYXNpbmcsIGZ1bmN0aW9uICgpIHsNCgkJCQkJLy9maXggc2VjdGlvbiBvcmRlciBmcm9tIGNvbnRpbnVvdXNWZXJ0aWNhbA0KCQkJCQljb250aW51b3VzVmVydGljYWxGaXhTZWN0aW9uT3JkZXIoKTsNCg0KCQkJCQkvL2NhbGxiYWNrIChhZnRlckxvYWQpIGlmIHRoZSBzaXRlIGlzIG5vdCBqdXN0IHJlc2l6aW5nIGFuZCByZWFkanVzdGluZyB0aGUgc2xpZGVzDQoJCQkJCSQuaXNGdW5jdGlvbihvcHRpb25zLmFmdGVyTG9hZCkgJiYgIWxvY2FsSXNSZXNpemluZyAmJiBvcHRpb25zLmFmdGVyTG9hZC5jYWxsKHRoaXMsIGFuY2hvckxpbmssIChzZWN0aW9uSW5kZXggKyAxKSk7DQoNCgkJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJCQlpc01vdmluZyA9IGZhbHNlOw0KCQkJCQkJJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKSAmJiBjYWxsYmFjay5jYWxsKHRoaXMpOw0KCQkJCQl9LCBzY3JvbGxEZWxheSk7DQoJCQkJfSk7DQoJCQl9DQoNCgkJCS8vZmxhZyB0byBhdm9pZCBjYWxsaW5nbiBgc2Nyb2xsUGFnZSgpYCB0d2ljZSBpbiBjYXNlIG9mIHVzaW5nIGFuY2hvciBsaW5rcw0KCQkJbGFzdFNjcm9sbGVkRGVzdGlueSA9IGFuY2hvckxpbms7DQoJCQkNCgkJCS8vYXZvaWQgZmlyaW5nIGl0IHR3aWNlIChhcyBpdCBkb2VzIGFsc28gb24gc2Nyb2xsKQ0KCQkJaWYob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCgkJCQlhY3RpdmF0ZU1lbnVFbGVtZW50KGFuY2hvckxpbmspOw0KCQkJCWFjdGl2YXRlTmF2RG90cyhhbmNob3JMaW5rLCBzZWN0aW9uSW5kZXgpOw0KCQkJfQ0KCQl9DQoJCQ0KCQlmdW5jdGlvbiBzY3JvbGxUb0FuY2hvcigpew0KCQkJLy9nZXR0aW5nIHRoZSBhbmNob3IgbGluayBpbiB0aGUgVVJMIGFuZCBkZWxldGluZyB0aGUgYCNgDQoJCQl2YXIgdmFsdWUgPSAgd2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsICcnKS5zcGxpdCgnLycpOw0KCQkJdmFyIHNlY3Rpb24gPSB2YWx1ZVswXTsNCgkJCXZhciBzbGlkZSA9IHZhbHVlWzFdOw0KDQoJCQlpZihzZWN0aW9uKXsgIC8vaWYgdGhlcmVzIGFueSAjCQkJCQ0KCQkJCXNjcm9sbFBhZ2VBbmRTbGlkZShzZWN0aW9uLCBzbGlkZSk7DQoJCQl9DQoJCX0NCg0KCQkvL2RldGVjdGluZyBhbnkgY2hhbmdlIG9uIHRoZSBVUkwgdG8gc2Nyb2xsIHRvIHRoZSBnaXZlbiBhbmNob3IgbGluaw0KCQkvLyhhIHdheSB0byBkZXRlY3QgYmFjayBoaXN0b3J5IGJ1dHRvbiBhcyB3ZSBwbGF5IHdpdGggdGhlIGhhc2hlcyBvbiB0aGUgVVJMKQ0KCQkkKHdpbmRvdykub24oJ2hhc2hjaGFuZ2UnLGZ1bmN0aW9uKCl7DQoJCQlpZighaXNTY3JvbGxpbmcpew0KCQkJCXZhciB2YWx1ZSA9ICB3aW5kb3cubG9jYXRpb24uaGFzaC5yZXBsYWNlKCcjJywgJycpLnNwbGl0KCcvJyk7DQoJCQkJdmFyIHNlY3Rpb24gPSB2YWx1ZVswXTsNCgkJCQl2YXIgc2xpZGUgPSB2YWx1ZVsxXTsNCg0KCQkJCS8vd2hlbiBtb3ZpbmcgdG8gYSBzbGlkZSBpbiB0aGUgZmlyc3Qgc2VjdGlvbiBmb3IgdGhlIGZpcnN0IHRpbWUgKGZpcnN0IHRpbWUgdG8gYWRkIGFuIGFuY2hvciB0byB0aGUgVVJMKQ0KCQkJCXZhciBpc0ZpcnN0U2xpZGVNb3ZlID0gICh0eXBlb2YgbGFzdFNjcm9sbGVkRGVzdGlueSA9PT0gJ3VuZGVmaW5lZCcpOw0KCQkJCXZhciBpc0ZpcnN0U2Nyb2xsTW92ZSA9ICh0eXBlb2YgbGFzdFNjcm9sbGVkRGVzdGlueSA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHNsaWRlID09PSAndW5kZWZpbmVkJyk7DQoNCgkJCQkvKmluIG9yZGVyIHRvIGNhbGwgc2Nyb2xscGFnZSgpIG9ubHkgb25jZSBmb3IgZWFjaCBkZXN0aW5hdGlvbiBhdCBhIHRpbWUNCgkJCQlJdCBpcyBjYWxsZWQgdHdpY2UgZm9yIGVhY2ggc2Nyb2xsIG90aGVyd2lzZSwgYXMgaW4gY2FzZSBvZiB1c2luZyBhbmNob3JsaW5rcyBgaGFzaENoYW5nZWAgDQoJCQkJZXZlbnQgaXMgZmlyZWQgb24gZXZlcnkgc2Nyb2xsIHRvby4qLw0KCQkJCWlmICgoc2VjdGlvbiAmJiBzZWN0aW9uICE9PSBsYXN0U2Nyb2xsZWREZXN0aW55KSAmJiAhaXNGaXJzdFNsaWRlTW92ZSB8fCBpc0ZpcnN0U2Nyb2xsTW92ZSB8fCAoIXNsaWRlTW92aW5nICYmIGxhc3RTY3JvbGxlZFNsaWRlICE9IHNsaWRlICkpICB7DQoJCQkJCXNjcm9sbFBhZ2VBbmRTbGlkZShzZWN0aW9uLCBzbGlkZSk7DQoJCQkJfQ0KCQkJfQ0KCQkJDQoJCX0pOw0KDQoNCgkJLyoqDQoJCSAqIFNsaWRpbmcgd2l0aCBhcnJvdyBrZXlzLCBib3RoLCB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbA0KCQkgKi8NCgkJJChkb2N1bWVudCkua2V5ZG93bihmdW5jdGlvbihlKSB7DQoJCQkvL01vdmluZyB0aGUgbWFpbiBwYWdlIHdpdGggdGhlIGtleWJvYXJkIGFycm93cyBpZiBrZXlib2FyZCBzY3JvbGxpbmcgaXMgZW5hYmxlZA0KCQkJaWYgKG9wdGlvbnMua2V5Ym9hcmRTY3JvbGxpbmcgJiYgIWlzTW92aW5nKSB7DQoJCQkJc3dpdGNoIChlLndoaWNoKSB7DQoJCQkJCS8vdXANCgkJCQkJY2FzZSAzODoNCgkJCQkJY2FzZSAzMzoNCgkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25VcCgpOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJLy9kb3duDQoJCQkJCWNhc2UgNDA6DQoJCQkJCWNhc2UgMzQ6DQoJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTZWN0aW9uRG93bigpOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJLy9sZWZ0DQoJCQkJCWNhc2UgMzc6DQoJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTbGlkZUxlZnQoKTsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCS8vcmlnaHQNCgkJCQkJY2FzZSAzOToNCgkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlUmlnaHQoKTsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCWRlZmF1bHQ6DQoJCQkJCQlyZXR1cm47IC8vIGV4aXQgdGhpcyBoYW5kbGVyIGZvciBvdGhlciBrZXlzDQoJCQkJfQ0KCQkJfQ0KCQl9KTsNCgkJDQoJCS8vbmF2aWdhdGlvbiBhY3Rpb24gDQoJCSQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcjZnVsbFBhZ2UtbmF2IGEnLCBmdW5jdGlvbihlKXsNCgkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCXZhciBpbmRleCA9ICQodGhpcykucGFyZW50KCkuaW5kZXgoKTsNCgkJCXNjcm9sbFBhZ2UoJCgnLnNlY3Rpb24nKS5lcShpbmRleCkpOw0KCQl9KTsNCgkJDQoJCS8vbmF2aWdhdGlvbiB0b29sdGlwcyANCgkJJChkb2N1bWVudCkub24oew0KCQkJbW91c2VlbnRlcjogZnVuY3Rpb24oKXsNCgkJCQl2YXIgdG9vbHRpcCA9ICQodGhpcykuZGF0YSgndG9vbHRpcCcpOw0KCQkJCSQoJzxkaXYgY2xhc3M9ImZ1bGxQYWdlLXRvb2x0aXAgJyArIG9wdGlvbnMubmF2aWdhdGlvblBvc2l0aW9uICsnIj4nICsgdG9vbHRpcCArICc8L2Rpdj4nKS5oaWRlKCkuYXBwZW5kVG8oJCh0aGlzKSkuZmFkZUluKDIwMCk7DQoJCQl9LA0KCQkJbW91c2VsZWF2ZTogZnVuY3Rpb24oKXsNCgkJCQkkKHRoaXMpLmZpbmQoJy5mdWxsUGFnZS10b29sdGlwJykuZmFkZU91dCgpLnJlbW92ZSgpOw0KCQkJfQ0KCQl9LCAnI2Z1bGxQYWdlLW5hdiBsaScpOw0KDQoNCgkJaWYob3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cyl7DQoJCQkkKGRvY3VtZW50KS5vbignbW91c2VvdmVyJywgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cywgZnVuY3Rpb24gKCkgew0KCQkJCSQuZm4uZnVsbHBhZ2Uuc2V0TW91c2VXaGVlbFNjcm9sbGluZyhmYWxzZSk7DQoJCQl9KTsNCgkJCQ0KCQkJJChkb2N1bWVudCkub24oJ21vdXNlb3V0Jywgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cywgZnVuY3Rpb24oKXsNCgkJCQkkLmZuLmZ1bGxwYWdlLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcodHJ1ZSk7DQoJCQl9KTsNCgkJfQ0KCQkNCgkJLyoqDQoJCSAqIFNjcm9sbGluZyBob3Jpem9udGFsbHkgd2hlbiBjbGlja2luZyBvbiB0aGUgc2xpZGVyIGNvbnRyb2xzLg0KCQkgKi8NCgkJJCgnLnNlY3Rpb24nKS5vbignY2xpY2snLCAnLmNvbnRyb2xBcnJvdycsIGZ1bmN0aW9uKCkgew0KCQkJaWYgKCQodGhpcykuaGFzQ2xhc3MoJ3ByZXYnKSkgew0KCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlTGVmdCgpOw0KCQkJfSBlbHNlIHsNCgkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTbGlkZVJpZ2h0KCk7DQoJCQl9DQoJCX0pOw0KDQoJCQ0KCQkvKioNCgkJICogU2Nyb2xsaW5nIGhvcml6b250YWxseSB3aGVuIGNsaWNraW5nIG9uIHRoZSBzbGlkZXIgY29udHJvbHMuDQoJCSAqLw0KCQkkKCcuc2VjdGlvbicpLm9uKCdjbGljaycsICcudG9TbGlkZScsIGZ1bmN0aW9uKGUpIHsNCgkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQ0KCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuY2xvc2VzdCgnLnNlY3Rpb24nKS5maW5kKCcuc2xpZGVzJyk7DQoJCQl2YXIgY3VycmVudFNsaWRlID0gc2xpZGVzLmZpbmQoJy5zbGlkZS5hY3RpdmUnKTsNCgkJCXZhciBkZXN0aW55ID0gbnVsbDsNCgkJCQ0KCQkJZGVzdGlueSA9IHNsaWRlcy5maW5kKCcuc2xpZGUnKS5lcSggKCQodGhpcykuZGF0YSgnaW5kZXgnKSAtMSkgKTsNCg0KCQkJaWYoZGVzdGlueS5sZW5ndGggPiAwKXsNCgkJCQlsYW5kc2NhcGVTY3JvbGwoc2xpZGVzLCBkZXN0aW55KTsNCgkJCX0NCgkJfSk7DQoJCQ0KCQkvKioNCgkJKiBTY3JvbGxzIGhvcml6b250YWwgc2xpZGVycy4NCgkJKi8NCgkJZnVuY3Rpb24gbGFuZHNjYXBlU2Nyb2xsKHNsaWRlcywgZGVzdGlueSl7DQoJCQl2YXIgZGVzdGlueVBvcyA9IGRlc3RpbnkucG9zaXRpb24oKTsNCgkJCXZhciBzbGlkZXNDb250YWluZXIgPSBzbGlkZXMuZmluZCgnLnNsaWRlc0NvbnRhaW5lcicpLnBhcmVudCgpOw0KCQkJdmFyIHNsaWRlSW5kZXggPSBkZXN0aW55LmluZGV4KCk7DQoJCQl2YXIgc2VjdGlvbiA9IHNsaWRlcy5jbG9zZXN0KCcuc2VjdGlvbicpOw0KCQkJdmFyIHNlY3Rpb25JbmRleCA9IHNlY3Rpb24uaW5kZXgoJy5zZWN0aW9uJyk7DQoJCQl2YXIgYW5jaG9yTGluayA9IHNlY3Rpb24uZGF0YSgnYW5jaG9yJyk7DQoJCQl2YXIgc2xpZGVzTmF2ID0gc2VjdGlvbi5maW5kKCcuZnVsbFBhZ2Utc2xpZGVzTmF2Jyk7DQoJCQl2YXIgc2xpZGVBbmNob3IgPSBkZXN0aW55LmRhdGEoJ2FuY2hvcicpOw0KCQ0KCQkJLy9jYWNoaW5nIHRoZSB2YWx1ZSBvZiBpc1Jlc2l6aW5nIGF0IHRoZSBtb21tZW50IHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQgDQoJCQkvL2JlY2F1c2UgaXQgd2lsbCBiZSBjaGVja2VkIGxhdGVyIGluc2lkZSBhIHNldFRpbWVvdXQgYW5kIHRoZSB2YWx1ZSBtaWdodCBjaGFuZ2UNCgkJCXZhciBsb2NhbElzUmVzaXppbmcgPSBpc1Jlc2l6aW5nOyANCg0KCQkJaWYob3B0aW9ucy5vblNsaWRlTGVhdmUpew0KCQkJCXZhciBwcmV2U2xpZGVJbmRleCA9IHNlY3Rpb24uZmluZCgnLnNsaWRlLmFjdGl2ZScpLmluZGV4KCk7DQoJCQkJdmFyIHhNb3ZlbWVudCA9IGdldFhtb3ZlbWVudChwcmV2U2xpZGVJbmRleCwgc2xpZGVJbmRleCk7DQoNCgkJCQkvL2lmIHRoZSBzaXRlIGlzIG5vdCBqdXN0IHJlc2l6aW5nIGFuZCByZWFkanVzdGluZyB0aGUgc2xpZGVzDQoJCQkJaWYoIWxvY2FsSXNSZXNpemluZyl7DQoJCQkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5vblNsaWRlTGVhdmUgKSAmJiBvcHRpb25zLm9uU2xpZGVMZWF2ZS5jYWxsKCB0aGlzLCBhbmNob3JMaW5rLCAoc2VjdGlvbkluZGV4ICsgMSksIHByZXZTbGlkZUluZGV4LCB4TW92ZW1lbnQpOw0KCQkJCX0NCgkJCX0NCgkNCgkJCWRlc3RpbnkuYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KDQoJCQkNCgkJCWlmKHR5cGVvZiBzbGlkZUFuY2hvciA9PT0gJ3VuZGVmaW5lZCcpew0KCQkJCXNsaWRlQW5jaG9yID0gc2xpZGVJbmRleDsNCgkJCX0NCgkJCQ0KCQkJLy9vbmx5IGNoYW5naW5nIHRoZSBVUkwgaWYgdGhlIHNsaWRlcyBhcmUgaW4gdGhlIGN1cnJlbnQgc2VjdGlvbiAobm90IGZvciByZXNpemUgcmUtYWRqdXN0aW5nKQ0KCQkJaWYoc2VjdGlvbi5oYXNDbGFzcygnYWN0aXZlJykpew0KCQkJDQoJCQkJaWYoIW9wdGlvbnMubG9vcEhvcml6b250YWwpew0KCQkJCQkvL2hpZGRpbmcgaXQgZm9yIHRoZSBmaXN0IHNsaWRlLCBzaG93aW5nIGZvciB0aGUgcmVzdA0KCQkJCQlzZWN0aW9uLmZpbmQoJy5jb250cm9sQXJyb3cucHJldicpLnRvZ2dsZShzbGlkZUluZGV4IT0wKTsNCg0KCQkJCQkvL2hpZGRpbmcgaXQgZm9yIHRoZSBsYXN0IHNsaWRlLCBzaG93aW5nIGZvciB0aGUgcmVzdA0KCQkJCQlzZWN0aW9uLmZpbmQoJy5jb250cm9sQXJyb3cubmV4dCcpLnRvZ2dsZSghZGVzdGlueS5pcygnOmxhc3QtY2hpbGQnKSk7DQoJCQkJfQ0KDQoJCQkJc2V0VVJMSGFzaChzbGlkZUluZGV4LCBzbGlkZUFuY2hvciwgYW5jaG9yTGluayk7CQkJCQ0KCQkJfQkJCQ0KDQoJCQlpZihvcHRpb25zLmNzczMpew0KCQkJCXZhciB0cmFuc2xhdGUzZCA9ICd0cmFuc2xhdGUzZCgtJyArIGRlc3RpbnlQb3MubGVmdCArICdweCwgMHB4LCAwcHgpJzsNCg0KCQkJCXNsaWRlcy5maW5kKCcuc2xpZGVzQ29udGFpbmVyJykudG9nZ2xlQ2xhc3MoJ2Vhc2luZycsIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQ+MCkuY3NzKGdldFRyYW5zZm9ybXModHJhbnNsYXRlM2QpKTsNCg0KCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCQkJLy9pZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KCQkJCQlpZighbG9jYWxJc1Jlc2l6aW5nKXsNCgkJCQkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlclNsaWRlTG9hZCApICYmIG9wdGlvbnMuYWZ0ZXJTbGlkZUxvYWQuY2FsbCggdGhpcywgYW5jaG9yTGluaywgKHNlY3Rpb25JbmRleCArIDEpLCBzbGlkZUFuY2hvciwgc2xpZGVJbmRleCApOw0KCQkJCQl9DQoNCgkJCQkJc2xpZGVNb3ZpbmcgPSBmYWxzZTsNCgkJCQl9LCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkLCBvcHRpb25zLmVhc2luZyk7DQoJCQl9ZWxzZXsNCgkJCQlzbGlkZXNDb250YWluZXIuYW5pbWF0ZSh7DQoJCQkJCXNjcm9sbExlZnQgOiBkZXN0aW55UG9zLmxlZnQNCgkJCQl9LCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkLCBvcHRpb25zLmVhc2luZywgZnVuY3Rpb24oKSB7DQoNCgkJCQkJLy9pZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KCQkJCQlpZighbG9jYWxJc1Jlc2l6aW5nKXsNCgkJCQkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlclNsaWRlTG9hZCApICYmIG9wdGlvbnMuYWZ0ZXJTbGlkZUxvYWQuY2FsbCggdGhpcywgYW5jaG9yTGluaywgKHNlY3Rpb25JbmRleCArIDEpLCBzbGlkZUFuY2hvciwgc2xpZGVJbmRleCk7DQoJCQkJCX0JDQoJCQkJCS8vbGV0dGluZyB0aGVtIHNsaWRlIGFnYWluDQoJCQkJCXNsaWRlTW92aW5nID0gZmFsc2U7IA0KCQkJCX0pOw0KCQkJfQ0KCQkJDQoJCQlzbGlkZXNOYXYuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCXNsaWRlc05hdi5maW5kKCdsaScpLmVxKHNsaWRlSW5kZXgpLmZpbmQoJ2EnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCX0NCgkJDQoJCQ0KCQlpZiAoIWlzVGFibGV0KSB7DQoJCQl2YXIgcmVzaXplSWQ7DQoNCgkJCS8vd2hlbiByZXNpemluZyB0aGUgc2l0ZSwgd2UgYWRqdXN0IHRoZSBoZWlnaHRzIG9mIHRoZSBzZWN0aW9ucw0KCQkJJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHsNCgkJCQkvL2luIG9yZGVyIHRvIGNhbGwgdGhlIGZ1bmN0aW9ucyBvbmx5IHdoZW4gdGhlIHJlc2l6ZSBpcyBmaW5pc2hlZA0KCQkJCS8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy80Mjk4NjEyL2pxdWVyeS1ob3ctdG8tY2FsbC1yZXNpemUtZXZlbnQtb25seS1vbmNlLWl0cy1maW5pc2hlZC1yZXNpemluZw0KCQkJCWNsZWFyVGltZW91dChyZXNpemVJZCk7DQoJCQkJcmVzaXplSWQgPSBzZXRUaW1lb3V0KGRvbmVSZXNpemluZywgNTAwKTsNCgkJCX0pOw0KCQkNCgkJfQ0KCQkNCgkJDQoJCXZhciBzdXBwb3J0c09yaWVudGF0aW9uQ2hhbmdlID0gIm9ub3JpZW50YXRpb25jaGFuZ2UiIGluIHdpbmRvdywNCgkJb3JpZW50YXRpb25FdmVudCA9IHN1cHBvcnRzT3JpZW50YXRpb25DaGFuZ2UgPyAib3JpZW50YXRpb25jaGFuZ2UiIDogInJlc2l6ZSI7DQoJCQ0KCQkkKHdpbmRvdykuYmluZChvcmllbnRhdGlvbkV2ZW50ICwgZnVuY3Rpb24oKSB7DQoJCQlpZihpc1RhYmxldCl7DQoJCQkJZG9uZVJlc2l6aW5nKCk7DQoJCQl9DQoJCX0pOw0KCQkNCg0KCQkvKioNCgkJICogV2hlbiByZXNpemluZyBpcyBmaW5pc2hlZCwgd2UgYWRqdXN0IHRoZSBzbGlkZXMgc2l6ZXMgYW5kIHBvc2l0aW9ucw0KCQkgKi8NCgkJZnVuY3Rpb24gZG9uZVJlc2l6aW5nKCkgew0KCQkJaXNSZXNpemluZyA9IHRydWU7DQoNCgkJCXZhciB3aW5kb3dzV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTsNCgkJCXdpbmRvd3NIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7DQoNCgkJCS8vdGV4dCBhbmQgaW1hZ2VzIHJlc2l6aW5nDQoJCQlpZiAob3B0aW9ucy5yZXNpemUpIHsNCgkJCQlyZXNpemVNZSh3aW5kb3dzSGVpZ2h0LCB3aW5kb3dzV2lkdGgpOw0KCQkJfQ0KDQoJCQkkKCcuc2VjdGlvbicpLmVhY2goZnVuY3Rpb24oKXsNCgkJCQl2YXIgc2Nyb2xsSGVpZ2h0ID0gd2luZG93c0hlaWdodCAtIHBhcnNlSW50KCQodGhpcykuY3NzKCdwYWRkaW5nLWJvdHRvbScpKSAtIHBhcnNlSW50KCQodGhpcykuY3NzKCdwYWRkaW5nLXRvcCcpKTsNCgkJCQ0KCQkJCS8vYWRqdXN0aW5nIHRoZSBoZWlnaHQgb2YgdGhlIHRhYmxlLWNlbGwgZm9yIElFIGFuZCBGaXJlZm94DQoJCQkJaWYob3B0aW9ucy52ZXJ0aWNhbENlbnRlcmVkKXsNCgkJCQkJJCh0aGlzKS5maW5kKCcudGFibGVDZWxsJykuY3NzKCdoZWlnaHQnLCBnZXRUYWJsZUhlaWdodCgkKHRoaXMpKSArICdweCcpOw0KCQkJCX0NCgkJCQkNCgkJCQkkKHRoaXMpLmNzcygnaGVpZ2h0Jywgd2luZG93c0hlaWdodCArICdweCcpOw0KDQoJCQkJLy9yZXNpemluZyB0aGUgc2Nyb2xsaW5nIGRpdnMNCgkJCQlpZihvcHRpb25zLnNjcm9sbE92ZXJmbG93KXsNCgkJCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuZmluZCgnLnNsaWRlJyk7DQoJCQkJCQ0KCQkJCQlpZihzbGlkZXMubGVuZ3RoKXsNCgkJCQkJCXNsaWRlcy5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJCQkJY3JlYXRlU2xpbVNjcm9sbGluZygkKHRoaXMpKTsNCgkJCQkJCX0pOw0KCQkJCQl9ZWxzZXsNCgkJCQkJCWNyZWF0ZVNsaW1TY3JvbGxpbmcoJCh0aGlzKSk7DQoJCQkJCX0NCgkJCQkJDQoJCQkJfQ0KCQkJCQ0KDQoJCQkJLy9hZGp1c3RpbmcgdGhlIHBvc2l0aW9uIGZvIHRoZSBGVUxMIFdJRFRIIHNsaWRlcy4uLg0KCQkJCXZhciBzbGlkZXMgPSAkKHRoaXMpLmZpbmQoJy5zbGlkZXMnKTsNCgkJCQlpZiAoc2xpZGVzLmxlbmd0aCkgew0KCQkJCQlsYW5kc2NhcGVTY3JvbGwoc2xpZGVzLCBzbGlkZXMuZmluZCgnLnNsaWRlLmFjdGl2ZScpKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJLy9hZGp1c3RpbmcgdGhlIHBvc2l0aW9uIGZvciB0aGUgY3VycmVudCBzZWN0aW9uDQoJCQl2YXIgZGVzdGlueVBvcyA9ICQoJy5zZWN0aW9uLmFjdGl2ZScpLnBvc2l0aW9uKCk7DQoNCgkJCXZhciBhY3RpdmVTZWN0aW9uID0gJCgnLnNlY3Rpb24uYWN0aXZlJyk7DQoJCQkNCgkJCS8vaXNuJ3QgaXQgdGhlIGZpcnN0IHNlY3Rpb24/DQoJCQlpZihhY3RpdmVTZWN0aW9uLmluZGV4KCcuc2VjdGlvbicpKXsNCgkJCQlzY3JvbGxQYWdlKGFjdGl2ZVNlY3Rpb24pOw0KCQkJfQ0KDQoJCQlpc1Jlc2l6aW5nID0gZmFsc2U7DQoJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJSZXNpemUgKSAmJiBvcHRpb25zLmFmdGVyUmVzaXplLmNhbGwoIHRoaXMpOw0KCQl9DQoNCgkJLyoqDQoJCSAqIFJlc2l6aW5nIG9mIHRoZSBmb250IHNpemUgZGVwZW5kaW5nIG9uIHRoZSB3aW5kb3cgc2l6ZSBhcyB3ZWxsIGFzIHNvbWUgb2YgdGhlIGltYWdlcyBvbiB0aGUgc2l0ZS4NCgkJICovDQoJCWZ1bmN0aW9uIHJlc2l6ZU1lKGRpc3BsYXlIZWlnaHQsIGRpc3BsYXlXaWR0aCkgew0KCQkJLy9TdGFuZGFyZCBoZWlnaHQsIGZvciB3aGljaCB0aGUgYm9keSBmb250IHNpemUgaXMgY29ycmVjdA0KCQkJdmFyIHByZWZlcnJlZEhlaWdodCA9IDgyNTsNCgkJCXZhciB3aW5kb3dTaXplID0gZGlzcGxheUhlaWdodDsNCg0KCQkJLyogUHJvYmxlbSB0byBiZSBzb2x2ZWQNCgkJCQ0KCQkJaWYgKGRpc3BsYXlIZWlnaHQgPCA4MjUpIHsNCgkJCQl2YXIgcGVyY2VudGFnZSA9ICh3aW5kb3dTaXplICogMTAwKSAvIHByZWZlcnJlZEhlaWdodDsNCgkJCQl2YXIgbmV3Rm9udFNpemUgPSBwZXJjZW50YWdlLnRvRml4ZWQoMik7DQoNCgkJCQkkKCJpbWciKS5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgbmV3V2lkdGggPSAoKDgwICogcGVyY2VudGFnZSkgLyAxMDApLnRvRml4ZWQoMik7DQoJCQkJCSQodGhpcykuY3NzKCJ3aWR0aCIsIG5ld1dpZHRoICsgJyUnKTsNCgkJCQl9KTsNCgkJCX0gZWxzZSB7DQoJCQkJJCgiaW1nIikuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkJJCh0aGlzKS5jc3MoIndpZHRoIiwgJycpOw0KCQkJCX0pOw0KCQkJfSovDQoNCgkJCWlmIChkaXNwbGF5SGVpZ2h0IDwgODI1IHx8IGRpc3BsYXlXaWR0aCA8IDkwMCkgew0KCQkJCWlmIChkaXNwbGF5V2lkdGggPCA5MDApIHsNCgkJCQkJd2luZG93U2l6ZSA9IGRpc3BsYXlXaWR0aDsNCgkJCQkJcHJlZmVycmVkSGVpZ2h0ID0gOTAwOw0KCQkJCX0NCgkJCQl2YXIgcGVyY2VudGFnZSA9ICh3aW5kb3dTaXplICogMTAwKSAvIHByZWZlcnJlZEhlaWdodDsNCgkJCQl2YXIgbmV3Rm9udFNpemUgPSBwZXJjZW50YWdlLnRvRml4ZWQoMik7DQoNCgkJCQkkKCJib2R5IikuY3NzKCJmb250LXNpemUiLCBuZXdGb250U2l6ZSArICclJyk7DQoJCQl9IGVsc2Ugew0KCQkJCSQoImJvZHkiKS5jc3MoImZvbnQtc2l6ZSIsICcxMDAlJyk7DQoJCQl9DQoJCX0NCgkJDQoJCS8qKg0KCQkgKiBBY3RpdmF0aW5nIHRoZSB3ZWJzaXRlIG5hdmlnYXRpb24gZG90cyBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHNsaWRlIG5hbWUuDQoJCSAqLw0KCQlmdW5jdGlvbiBhY3RpdmF0ZU5hdkRvdHMobmFtZSwgc2VjdGlvbkluZGV4KXsNCgkJCWlmKG9wdGlvbnMubmF2aWdhdGlvbil7DQoJCQkJJCgnI2Z1bGxQYWdlLW5hdicpLmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQkJaWYobmFtZSl7IA0KCQkJCQkkKCcjZnVsbFBhZ2UtbmF2JykuZmluZCgnYVtocmVmPSIjJyArIG5hbWUgKyAnIl0nKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQkJfWVsc2V7DQoJCQkJCSQoJyNmdWxsUGFnZS1uYXYnKS5maW5kKCdsaScpLmVxKHNlY3Rpb25JbmRleCkuZmluZCgnYScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCQl9DQoJCQl9DQoJCX0NCgkJCQkNCgkJLyoqDQoJCSAqIEFjdGl2YXRpbmcgdGhlIHdlYnNpdGUgbWFpbiBtZW51IGVsZW1lbnRzIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gc2xpZGUgbmFtZS4NCgkJICovDQoJCWZ1bmN0aW9uIGFjdGl2YXRlTWVudUVsZW1lbnQobmFtZSl7DQoJCQlpZihvcHRpb25zLm1lbnUpew0KCQkJCSQob3B0aW9ucy5tZW51KS5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCSQob3B0aW9ucy5tZW51KS5maW5kKCdbZGF0YS1tZW51YW5jaG9yPSInK25hbWUrJyJdJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJfQ0KCQl9DQoJCQ0KCQkvKioNCgkJKiBSZXR1cm4gYSBib29sZWFuIGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSBzY3JvbGxhYmxlIGVsZW1lbnQgaXMgYXQgdGhlIGVuZCBvciBhdCB0aGUgc3RhcnQgb2YgdGhlIHNjcm9sbGluZw0KCQkqIGRlcGVuZGluZyBvbiB0aGUgZ2l2ZW4gdHlwZS4NCgkJKi8NCgkJZnVuY3Rpb24gaXNTY3JvbGxlZCh0eXBlLCBzY3JvbGxhYmxlKXsNCgkJCWlmKHR5cGUgPT09ICd0b3AnKXsNCgkJCQlyZXR1cm4gIXNjcm9sbGFibGUuc2Nyb2xsVG9wKCk7DQoJCQl9ZWxzZSBpZih0eXBlID09PSAnYm90dG9tJyl7DQoJCQkJcmV0dXJuIHNjcm9sbGFibGUuc2Nyb2xsVG9wKCkgKyBzY3JvbGxhYmxlLmlubmVySGVpZ2h0KCkgPj0gc2Nyb2xsYWJsZVswXS5zY3JvbGxIZWlnaHQ7DQoJCQl9DQoJCX0NCgkJDQoJCS8qKg0KCQkqIFJldHVucyBgdXBgIG9yIGBkb3duYCBkZXBlbmRpbmcgb24gdGhlIHNjcm9sbGluZyBtb3ZlbWVudCB0byByZWFjaCBpdHMgZGVzdGluYXRpb24NCgkJKiBmcm9tIHRoZSBjdXJyZW50IHNlY3Rpb24uDQoJCSovDQoJCWZ1bmN0aW9uIGdldFltb3ZlbWVudChkZXN0aW55KXsNCgkJCXZhciBmcm9tSW5kZXggPSAkKCcuc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLnNlY3Rpb24nKTsNCgkJCXZhciB0b0luZGV4ID0gZGVzdGlueS5pbmRleCgnLnNlY3Rpb24nKTsNCgkJCQ0KCQkJaWYoZnJvbUluZGV4ID4gdG9JbmRleCl7DQoJCQkJcmV0dXJuICd1cCc7DQoJCQl9DQoJCQlyZXR1cm4gJ2Rvd24nOw0KCQl9CQ0KDQoJCS8qKg0KCQkqIFJldHVucyBgcmlnaHRgIG9yIGBsZWZ0YCBkZXBlbmRpbmcgb24gdGhlIHNjcm9sbGluZyBtb3ZlbWVudCB0byByZWFjaCBpdHMgZGVzdGluYXRpb24NCgkJKiBmcm9tIHRoZSBjdXJyZW50IHNsaWRlLg0KCQkqLw0KCQlmdW5jdGlvbiBnZXRYbW92ZW1lbnQoZnJvbUluZGV4LCB0b0luZGV4KXsNCgkJCWlmKCBmcm9tSW5kZXggPT0gdG9JbmRleCl7DQoJCQkJcmV0dXJuICdub25lJw0KCQkJfQ0KCQkJaWYoZnJvbUluZGV4ID4gdG9JbmRleCl7DQoJCQkJcmV0dXJuICdsZWZ0JzsNCgkJCX0NCgkJCXJldHVybiAncmlnaHQnOw0KCQl9CQkNCgkJDQoJCQ0KCQlmdW5jdGlvbiBjcmVhdGVTbGltU2Nyb2xsaW5nKGVsZW1lbnQpew0KCQkJLy9uZWVkZWQgdG8gbWFrZSBgc2Nyb2xsSGVpZ2h0YCB3b3JrIHVuZGVyIE9wZXJhIDEyDQoJCQllbGVtZW50LmNzcygnb3ZlcmZsb3cnLCAnaGlkZGVuJyk7DQoJCQkNCgkJCS8vaW4gY2FzZSBlbGVtZW50IGlzIGEgc2xpZGUNCgkJCXZhciBzZWN0aW9uID0gZWxlbWVudC5jbG9zZXN0KCcuc2VjdGlvbicpOw0KCQkJdmFyIHNjcm9sbGFibGUgPSBlbGVtZW50LmZpbmQoJy5zY3JvbGxhYmxlJyk7DQoNCgkJCS8vaWYgdGhlcmUgd2FzIHNjcm9sbCwgdGhlIGNvbnRlbnRIZWlnaHQgd2lsbCBiZSB0aGUgb25lIGluIHRoZSBzY3JvbGxhYmxlIHNlY3Rpb24NCgkJCWlmKHNjcm9sbGFibGUubGVuZ3RoKXsNCgkJCQl2YXIgY29udGVudEhlaWdodCA9IGVsZW1lbnQuZmluZCgnLnNjcm9sbGFibGUnKS5nZXQoMCkuc2Nyb2xsSGVpZ2h0Ow0KCQkJfWVsc2V7DQoJCQkJdmFyIGNvbnRlbnRIZWlnaHQgPSBlbGVtZW50LmdldCgwKS5zY3JvbGxIZWlnaHQ7DQoJCQkJaWYob3B0aW9ucy52ZXJ0aWNhbENlbnRlcmVkKXsNCgkJCQkJY29udGVudEhlaWdodCA9IGVsZW1lbnQuZmluZCgnLnRhYmxlQ2VsbCcpLmdldCgwKS5zY3JvbGxIZWlnaHQ7DQoJCQkJfQ0KCQkJfQ0KDQoJCQl2YXIgc2Nyb2xsSGVpZ2h0ID0gd2luZG93c0hlaWdodCAtIHBhcnNlSW50KHNlY3Rpb24uY3NzKCdwYWRkaW5nLWJvdHRvbScpKSAtIHBhcnNlSW50KHNlY3Rpb24uY3NzKCdwYWRkaW5nLXRvcCcpKTsNCg0KCQkJLy9uZWVkcyBzY3JvbGw/DQoJCQlpZiAoIGNvbnRlbnRIZWlnaHQgPiBzY3JvbGxIZWlnaHQpIHsNCgkJCQkvL3dhcyB0aGVyZSBhbHJlYWR5IGFuIHNjcm9sbCA/IFVwZGF0aW5nIGl0DQoJCQkJaWYoc2Nyb2xsYWJsZS5sZW5ndGgpew0KCQkJCQlzY3JvbGxhYmxlLmNzcygnaGVpZ2h0Jywgc2Nyb2xsSGVpZ2h0ICsgJ3B4JykucGFyZW50KCkuY3NzKCdoZWlnaHQnLCBzY3JvbGxIZWlnaHQgKyAncHgnKTsNCgkJCQl9DQoJCQkJLy9jcmVhdGluZyB0aGUgc2Nyb2xsaW5nDQoJCQkJZWxzZXsJCQkJCQ0KCQkJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCQkJZWxlbWVudC5maW5kKCcudGFibGVDZWxsJykud3JhcElubmVyKCc8ZGl2IGNsYXNzPSJzY3JvbGxhYmxlIiAvPicpOw0KCQkJCQl9ZWxzZXsNCgkJCQkJCWVsZW1lbnQud3JhcElubmVyKCc8ZGl2IGNsYXNzPSJzY3JvbGxhYmxlIiAvPicpOw0KCQkJCQl9DQoJCQkJCQ0KDQoJCQkJCWVsZW1lbnQuZmluZCgnLnNjcm9sbGFibGUnKS5zbGltU2Nyb2xsKHsNCgkJCQkJCWhlaWdodDogc2Nyb2xsSGVpZ2h0ICsgJ3B4JywNCgkJCQkJCXNpemU6ICcxMHB4JywNCgkJCQkJCWFsd2F5c1Zpc2libGU6IHRydWUNCgkJCQkJfSk7DQoJCQkJfQ0KCQkJfQ0KCQkJDQoJCQkvL3JlbW92aW5nIHRoZSBzY3JvbGxpbmcgd2hlbiBpdCBpcyBub3QgbmVjZXNzYXJ5IGFueW1vcmUNCgkJCWVsc2V7CQkJCQ0KCQkJCWVsZW1lbnQuZmluZCgnLnNjcm9sbGFibGUnKS5jaGlsZHJlbigpLmZpcnN0KCkudW53cmFwKCkudW53cmFwKCk7DQoJCQkJZWxlbWVudC5maW5kKCcuc2xpbVNjcm9sbEJhcicpLnJlbW92ZSgpOw0KCQkJCWVsZW1lbnQuZmluZCgnLnNsaW1TY3JvbGxSYWlsJykucmVtb3ZlKCk7DQoJCQl9DQoJCQkNCgkJCS8vdW5kbyANCgkJCWVsZW1lbnQuY3NzKCdvdmVyZmxvdycsICcnKTsNCgkJfQ0KCQkNCgkJZnVuY3Rpb24gYWRkVGFibGVDbGFzcyhlbGVtZW50KXsNCgkJCWVsZW1lbnQuYWRkQ2xhc3MoJ3RhYmxlJykud3JhcElubmVyKCc8ZGl2IGNsYXNzPSJ0YWJsZUNlbGwiIHN0eWxlPSJoZWlnaHQ6JyArIGdldFRhYmxlSGVpZ2h0KGVsZW1lbnQpICsgJ3B4OyIgLz4nKTsNCgkJfQ0KCQkNCgkJZnVuY3Rpb24gZ2V0VGFibGVIZWlnaHQoZWxlbWVudCl7DQoJCQl2YXIgc2VjdGlvbkhlaWdodCA9IHdpbmRvd3NIZWlnaHQ7DQoNCgkJCWlmKG9wdGlvbnMucGFkZGluZ1RvcCB8fCBvcHRpb25zLnBhZGRpbmdCb3R0b20pew0KCQkJCXZhciBzZWN0aW9uID0gZWxlbWVudDsNCgkJCQlpZighc2VjdGlvbi5oYXNDbGFzcygnc2VjdGlvbicpKXsNCgkJCQkJc2VjdGlvbiA9IGVsZW1lbnQuY2xvc2VzdCgnLnNlY3Rpb24nKTsNCgkJCQl9DQoJCQkNCgkJCQl2YXIgcGFkZGluZ3MgPSBwYXJzZUludChzZWN0aW9uLmNzcygncGFkZGluZy10b3AnKSkgKyBwYXJzZUludChzZWN0aW9uLmNzcygncGFkZGluZy1ib3R0b20nKSk7DQoJCQkJc2VjdGlvbkhlaWdodCA9ICh3aW5kb3dzSGVpZ2h0IC0gcGFkZGluZ3MpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gc2VjdGlvbkhlaWdodDsNCgkJfQ0KCQkNCgkJLyoqDQoJCSogQWRkcyBhIGNzczMgdHJhbnNmb3JtIHByb3BlcnR5IHRvIHRoZSBjb250YWluZXIgY2xhc3Mgd2l0aCBvciB3aXRob3V0IGFuaW1hdGlvbiBkZXBlbmRpbmcgb24gdGhlIGFuaW1hdGVkIHBhcmFtLg0KCQkqLw0KCQlmdW5jdGlvbiB0cmFuc2Zvcm1Db250YWluZXIodHJhbnNsYXRlM2QsIGFuaW1hdGVkKXsNCgkJCWNvbnRhaW5lci50b2dnbGVDbGFzcygnZWFzaW5nJywgYW5pbWF0ZWQpOw0KCQkJDQoJCQljb250YWluZXIuY3NzKGdldFRyYW5zZm9ybXModHJhbnNsYXRlM2QpKTsNCgkJfQ0KCQkNCgkJDQoJCS8qKg0KCQkqIFNjcm9sbHMgdG8gdGhlIGdpdmVuIHNlY3Rpb24gYW5kIHNsaWRlIA0KCQkqLw0KCQlmdW5jdGlvbiBzY3JvbGxQYWdlQW5kU2xpZGUoZGVzdGlueSwgc2xpZGUpew0KCQkJaWYgKHR5cGVvZiBzbGlkZSA9PT0gJ3VuZGVmaW5lZCcpIHsNCgkJCSAgICBzbGlkZSA9IDA7DQoJCQl9DQoNCgkJCWlmKGlzTmFOKGRlc3RpbnkpKXsNCgkJCQl2YXIgc2VjdGlvbiA9ICQoJ1tkYXRhLWFuY2hvcj0iJytkZXN0aW55KyciXScpOw0KCQkJfWVsc2V7DQoJCQkJdmFyIHNlY3Rpb24gPSAkKCcuc2VjdGlvbicpLmVxKCAoZGVzdGlueSAtMSkgKTsNCgkJCX0NCg0KDQoJCQkvL3dlIG5lZWQgdG8gc2Nyb2xsIHRvIHRoZSBzZWN0aW9uIGFuZCB0aGVuIHRvIHRoZSBzbGlkZQ0KCQkJaWYgKGRlc3RpbnkgIT09IGxhc3RTY3JvbGxlZERlc3RpbnkgJiYgIXNlY3Rpb24uaGFzQ2xhc3MoJ2FjdGl2ZScpKXsNCgkJCQlzY3JvbGxQYWdlKHNlY3Rpb24sIGZ1bmN0aW9uKCl7DQoJCQkJCXNjcm9sbFNsaWRlcihzZWN0aW9uLCBzbGlkZSkNCgkJCQl9KTsNCgkJCX0NCgkJCS8vaWYgd2Ugd2VyZSBhbHJlYWR5IGluIHRoZSBzZWN0aW9uDQoJCQllbHNlew0KCQkJCXNjcm9sbFNsaWRlcihzZWN0aW9uLCBzbGlkZSk7DQoJCQl9DQoJCQkNCgkJfQ0KCQkNCgkJLyoqDQoJCSogU2Nyb2xscyB0aGUgc2xpZGVyIHRvIHRoZSBnaXZlbiBzbGlkZSBkZXN0aW5hdGlvbiBmb3IgdGhlIGdpdmVuIHNlY3Rpb24NCgkJKi8NCgkJZnVuY3Rpb24gc2Nyb2xsU2xpZGVyKHNlY3Rpb24sIHNsaWRlKXsNCgkJCWlmKHR5cGVvZiBzbGlkZSAhPSAndW5kZWZpbmVkJyl7DQoJCQkJdmFyIHNsaWRlcyA9IHNlY3Rpb24uZmluZCgnLnNsaWRlcycpOw0KCQkJCXZhciBkZXN0aW55ID0gIHNsaWRlcy5maW5kKCdbZGF0YS1hbmNob3I9Iicrc2xpZGUrJyJdJyk7DQoNCgkJCQlpZighZGVzdGlueS5sZW5ndGgpew0KCQkJCQlkZXN0aW55ID0gc2xpZGVzLmZpbmQoJy5zbGlkZScpLmVxKHNsaWRlKTsNCgkJCQl9DQoNCgkJCQlpZihkZXN0aW55Lmxlbmd0aCl7DQoJCQkJCWxhbmRzY2FwZVNjcm9sbChzbGlkZXMsIGRlc3RpbnkpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQkNCgkJLyoqDQoJCSogQ3JlYXRlcyBhIGxhbmRzY2FwZSBuYXZpZ2F0aW9uIGJhciB3aXRoIGRvdHMgZm9yIGhvcml6b250YWwgc2xpZGVycy4NCgkJKi8NCgkJZnVuY3Rpb24gYWRkU2xpZGVzTmF2aWdhdGlvbihzZWN0aW9uLCBudW1TbGlkZXMpewkJCQkJCQ0KCQkJc2VjdGlvbi5hcHBlbmQoJzxkaXYgY2xhc3M9ImZ1bGxQYWdlLXNsaWRlc05hdiI+PHVsPjwvdWw+PC9kaXY+Jyk7DQoJCQl2YXIgbmF2ID0gc2VjdGlvbi5maW5kKCcuZnVsbFBhZ2Utc2xpZGVzTmF2Jyk7DQoNCgkJCS8vdG9wIG9yIGJvdHRvbQ0KCQkJbmF2LmFkZENsYXNzKG9wdGlvbnMuc2xpZGVzTmF2UG9zaXRpb24pOw0KDQoJCQlmb3IodmFyIGk9MDsgaTwgbnVtU2xpZGVzOyBpKyspewkJCQ0KCQkJCW5hdi5maW5kKCd1bCcpLmFwcGVuZCgnPGxpPjxhIGhyZWY9IiMiPjxzcGFuPjwvc3Bhbj48L2E+PC9saT4nKTsNCgkJCX0NCgkJCQ0KCQkJLy9jZW50ZXJpbmcgaXQNCgkJCW5hdi5jc3MoJ21hcmdpbi1sZWZ0JywgJy0nICsgKG5hdi53aWR0aCgpLzIpICsgJ3B4Jyk7DQoJCQkNCgkJCW5hdi5maW5kKCdsaScpLmZpcnN0KCkuZmluZCgnYScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJfQ0KCQkNCg0KCQkvKioNCgkJKiBTZXRzIHRoZSBVUkwgaGFzaCBmb3IgYSBzZWN0aW9uIHdpdGggc2xpZGVzDQoJCSovDQoJCWZ1bmN0aW9uIHNldFVSTEhhc2goc2xpZGVJbmRleCwgc2xpZGVBbmNob3IsIGFuY2hvckxpbmspew0KCQkJdmFyIHNlY3Rpb25IYXNoID0gJyc7DQoNCgkJCWlmKG9wdGlvbnMuYW5jaG9ycy5sZW5ndGgpew0KDQoJCQkJLy9pc24ndCBpdCB0aGUgZmlyc3Qgc2xpZGU/DQoJCQkJaWYoc2xpZGVJbmRleCl7DQoJCQkJCWlmKHR5cGVvZiBhbmNob3JMaW5rICE9PSAndW5kZWZpbmVkJyl7DQoJCQkJCQlzZWN0aW9uSGFzaCA9IGFuY2hvckxpbms7DQoJCQkJCX0NCg0KCQkJCQkvL3NsaWRlIHdpdGhvdXQgYW5jaG9yIGxpbms/IFdlIHRha2UgdGhlIGluZGV4IGluc3RlYWQuDQoJCQkJCWlmKHR5cGVvZiBzbGlkZUFuY2hvciA9PT0gJ3VuZGVmaW5lZCcpew0KCQkJCQkJc2xpZGVBbmNob3IgPSBzbGlkZUluZGV4Ow0KCQkJCQl9DQoJCQkJCQ0KCQkJCQlsYXN0U2Nyb2xsZWRTbGlkZSA9IHNsaWRlQW5jaG9yOw0KCQkJCQlsb2NhdGlvbi5oYXNoID0gc2VjdGlvbkhhc2ggKyAnLycgKyBzbGlkZUFuY2hvcjsNCg0KCQkJCS8vZmlyc3Qgc2xpZGUgd29uJ3QgaGF2ZSBzbGlkZSBhbmNob3IsIGp1c3QgdGhlIHNlY3Rpb24gb25lDQoJCQkJfWVsc2UgaWYodHlwZW9mIHNsaWRlSW5kZXggIT09ICd1bmRlZmluZWQnKXsNCgkJCQkJbGFzdFNjcm9sbGVkU2xpZGUgPSBzbGlkZUFuY2hvcjsNCgkJCQkJbG9jYXRpb24uaGFzaCA9IGFuY2hvckxpbms7DQoJCQkJfQ0KDQoJCQkJLy9zZWN0aW9uIHdpdGhvdXQgc2xpZGVzDQoJCQkJZWxzZXsNCgkJCQkJbG9jYXRpb24uaGFzaCA9IGFuY2hvckxpbms7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSogU2Nyb2xscyB0aGUgc2xpZGVyIHRvIHRoZSBnaXZlbiBzbGlkZSBkZXN0aW5hdGlvbiBmb3IgdGhlIGdpdmVuIHNlY3Rpb24NCgkJKi8NCgkJJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5mdWxsUGFnZS1zbGlkZXNOYXYgYScsIGZ1bmN0aW9uKGUpew0KCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuY2xvc2VzdCgnLnNlY3Rpb24nKS5maW5kKCcuc2xpZGVzJyk7CQkNCgkJCXZhciBkZXN0aW55ID0gc2xpZGVzLmZpbmQoJy5zbGlkZScpLmVxKCQodGhpcykuY2xvc2VzdCgnbGknKS5pbmRleCgpKTsNCgkJCQ0KCQkJbGFuZHNjYXBlU2Nyb2xsKHNsaWRlcywgZGVzdGlueSk7DQoJCX0pOw0KCQkNCgkJDQoJCS8qKg0KCQkqIENoZWNrcyBmb3IgdHJhbnNsYXRlM2Qgc3VwcG9ydCANCgkJKiBAcmV0dXJuIGJvb2xlYW4NCgkJKiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzU2NjE2NzEvZGV0ZWN0aW5nLXRyYW5zZm9ybS10cmFuc2xhdGUzZC1zdXBwb3J0DQoJCSovDQoJCWZ1bmN0aW9uIHN1cHBvcnQzZCgpIHsNCgkJCXZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKSwgDQoJCQkJaGFzM2QsDQoJCQkJdHJhbnNmb3JtcyA9IHsNCgkJCQkJJ3dlYmtpdFRyYW5zZm9ybSc6Jy13ZWJraXQtdHJhbnNmb3JtJywNCgkJCQkJJ09UcmFuc2Zvcm0nOictby10cmFuc2Zvcm0nLA0KCQkJCQknbXNUcmFuc2Zvcm0nOictbXMtdHJhbnNmb3JtJywNCgkJCQkJJ01velRyYW5zZm9ybSc6Jy1tb3otdHJhbnNmb3JtJywNCgkJCQkJJ3RyYW5zZm9ybSc6J3RyYW5zZm9ybScNCgkJCQl9Ow0KDQoJCQkvLyBBZGQgaXQgdG8gdGhlIGJvZHkgdG8gZ2V0IHRoZSBjb21wdXRlZCBzdHlsZS4NCgkJCWRvY3VtZW50LmJvZHkuaW5zZXJ0QmVmb3JlKGVsLCBudWxsKTsNCg0KCQkJZm9yICh2YXIgdCBpbiB0cmFuc2Zvcm1zKSB7DQoJCQkJaWYgKGVsLnN0eWxlW3RdICE9PSB1bmRlZmluZWQpIHsNCgkJCQkJZWwuc3R5bGVbdF0gPSAidHJhbnNsYXRlM2QoMXB4LDFweCwxcHgpIjsNCgkJCQkJaGFzM2QgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZSh0cmFuc2Zvcm1zW3RdKTsNCgkJCQl9DQoJCQl9DQoJCQkNCgkJCWRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWwpOw0KDQoJCQlyZXR1cm4gKGhhczNkICE9PSB1bmRlZmluZWQgJiYgaGFzM2QubGVuZ3RoID4gMCAmJiBoYXMzZCAhPT0gIm5vbmUiKTsNCgkJfQ0KDQoNCg0KCQkvKioNCgkJKiBSZW1vdmVzIHRoZSBhdXRvIHNjcm9sbGluZyBhY3Rpb24gZmlyZWQgYnkgdGhlIG1vdXNlIHdoZWVsIGFuZCB0YWNrcGFkLg0KCQkqIEFmdGVyIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkLCB0aGUgbW91c2V3aGVlbCBhbmQgdHJhY2twYWQgbW92ZW1lbnRzIHdvbid0IHNjcm9sbCB0aHJvdWdoIHNlY3Rpb25zLg0KCQkqLw0KCQlmdW5jdGlvbiByZW1vdmVNb3VzZVdoZWVsSGFuZGxlcigpew0KCQkJaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsNCgkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXdoZWVsJywgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9JRTksIENocm9tZSwgU2FmYXJpLCBPcGVyDQoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignd2hlZWwnLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0ZpcmVmb3gNCgkJCX0gZWxzZSB7DQoJCQkJZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ubW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyKTsgLy9JRSA2LzcvOA0KCQkJfQ0KCQl9DQoNCg0KCQkvKioNCgkJKiBBZGRzIHRoZSBhdXRvIHNjcm9sbGluZyBhY3Rpb24gZm9yIHRoZSBtb3VzZSB3aGVlbCBhbmQgdGFja3BhZC4NCgkJKiBBZnRlciB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCwgdGhlIG1vdXNld2hlZWwgYW5kIHRyYWNrcGFkIG1vdmVtZW50cyB3aWxsIHNjcm9sbCB0aHJvdWdoIHNlY3Rpb25zDQoJCSovDQoJCWZ1bmN0aW9uIGFkZE1vdXNlV2hlZWxIYW5kbGVyKCl7DQoJCQlpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgew0KCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNld2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0lFOSwgQ2hyb21lLCBTYWZhcmksIE9wZXINCgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyLCBmYWxzZSk7IC8vRmlyZWZveA0KCQkJfSBlbHNlIHsNCgkJCQlkb2N1bWVudC5hdHRhY2hFdmVudCgib25tb3VzZXdoZWVsIiwgTW91c2VXaGVlbEhhbmRsZXIpOyAvL0lFIDYvNy84DQoJCQl9DQoJCX0NCgkJDQoJCQ0KCQkvKioNCgkJKiBBZGRzIHRoZSBwb3NzaWJpbGl0eSB0byBhdXRvIHNjcm9sbCB0aHJvdWdoIHNlY3Rpb25zIG9uIHRvdWNoIGRldmljZXMuDQoJCSovDQoJCWZ1bmN0aW9uIGFkZFRvdWNoSGFuZGxlcigpew0KCQkJaWYoaXNUYWJsZXQpew0KCQkJCSQoZG9jdW1lbnQpLm9mZigndG91Y2hzdGFydCBNU1BvaW50ZXJEb3duJykub24oJ3RvdWNoc3RhcnQgTVNQb2ludGVyRG93bicsIHRvdWNoU3RhcnRIYW5kbGVyKTsNCgkJCQkkKGRvY3VtZW50KS5vZmYoJ3RvdWNobW92ZSBNU1BvaW50ZXJNb3ZlJykub24oJ3RvdWNobW92ZSBNU1BvaW50ZXJNb3ZlJywgdG91Y2hNb3ZlSGFuZGxlcik7DQoJCQl9DQoJCX0NCgkJDQoJCS8qKg0KCQkqIFJlbW92ZXMgdGhlIGF1dG8gc2Nyb2xsaW5nIGZvciB0b3VjaCBkZXZpY2VzLg0KCQkqLw0KCQlmdW5jdGlvbiByZW1vdmVUb3VjaEhhbmRsZXIoKXsNCgkJCWlmKGlzVGFibGV0KXsNCgkJCQkkKGRvY3VtZW50KS5vZmYoJ3RvdWNoc3RhcnQgTVNQb2ludGVyRG93bicpOw0KCQkJCSQoZG9jdW1lbnQpLm9mZigndG91Y2htb3ZlIE1TUG9pbnRlck1vdmUnKTsNCgkJCX0NCgkJfQ0KCQkNCgkJLyoqDQoJCSogR2V0cyB0aGUgcGFnZVggYW5kIHBhZ2VZIHByb3BlcnRpZXMgZGVwZW5kaW5nIG9uIHRoZSBicm93c2VyLg0KCQkqIGh0dHBzOi8vZ2l0aHViLmNvbS9hbHZhcm90cmlnby9mdWxsUGFnZS5qcy9pc3N1ZXMvMTk0I2lzc3VlY29tbWVudC0zNDA2OTg1NA0KCQkqLw0KCQlmdW5jdGlvbiBnZXRFdmVudHNQYWdlKGUpew0KCQkJdmFyIGV2ZW50cyA9IG5ldyBBcnJheSgpOw0KCQkJaWYgKHdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZCl7DQoJCQkJZXZlbnRzWyd5J10gPSBlLnBhZ2VZOw0KCQkJCWV2ZW50c1sneCddID0gZS5wYWdlWDsNCgkJCX1lbHNlew0KCQkJCWV2ZW50c1sneSddID0gZS50b3VjaGVzWzBdLnBhZ2VZOw0KCQkJCWV2ZW50c1sneCddID0gIGUudG91Y2hlc1swXS5wYWdlWDsNCgkJCX0NCg0KCQkJcmV0dXJuIGV2ZW50czsNCgkJfQ0KDQoJCWZ1bmN0aW9uIHNpbGVudFNjcm9sbCh0b3Apew0KCQkJaWYgKG9wdGlvbnMuY3NzMykgew0KCQkJCXZhciB0cmFuc2xhdGUzZCA9ICd0cmFuc2xhdGUzZCgwcHgsIC0nICsgdG9wICsgJ3B4LCAwcHgpJzsNCgkJCQl0cmFuc2Zvcm1Db250YWluZXIodHJhbnNsYXRlM2QsIGZhbHNlKTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCWNvbnRhaW5lci5jc3MoInRvcCIsIC10b3ApOw0KCQkJfQ0KCQl9DQoNCgkJZnVuY3Rpb24gZ2V0VHJhbnNmb3Jtcyh0cmFuc2xhdGUzZCl7DQoJCQlyZXR1cm4gew0KCQkJCSctd2Via2l0LXRyYW5zZm9ybSc6IHRyYW5zbGF0ZTNkLA0KCQkJCSctbW96LXRyYW5zZm9ybSc6IHRyYW5zbGF0ZTNkLA0KCQkJCSctbXMtdHJhbnNmb3JtJzp0cmFuc2xhdGUzZCwNCgkJCQkndHJhbnNmb3JtJzogdHJhbnNsYXRlM2QNCgkJCX07DQoJCX0NCg0KCX07DQp9KShqUXVlcnkpOw0K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 01:59:48 GMT",
                    "Content-Length": "45735",
                    "Date": "Fri, 07 Nov 2014 01:59:48 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}