{
    "url": "http://localhost:9999/ondras/jsslides/js/slides2.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location.href</b> and written to <b>the 'innerHTML' property of a DOM element</b> via the following statements:<ul><li>var url = location.href;</li><li>url = url.substring(0, hash);</li><li>this ._help.innerHTM ... ) + \" &lt;a href=...\" </li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ondras/jsslides/js/slides2.js",
                "path": "/ondras/jsslides/js/slides2.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9vbmRyYXMvanNzbGlkZXMvanMvc2xpZGVzMi5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTA4MTcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDc6NDg6MTcgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA3OjQ4OjE0IEdNVA0KDQp2YXIgUHJlc2VudGF0aW9uID0gT1ouQ2xhc3MoKTsKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7Cgl0aGlzLl9oZWxwID0gbnVsbDsKCXRoaXMuX3NsaWRlcyA9IFtdOwoJdGhpcy5faW5kZXggPSAtMTsKCXRoaXMuX3Byb2dyZXNzID0gT1ouRE9NLmVsbSgiZGl2Iiwge2lkOiJwcm9ncmVzcyJ9KTsKCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5fcHJvZ3Jlc3MpOwoKCXRoaXMuX3NpemVzID0gWyI5MCUiLCAiMTAwJSIgLCIxMjAlIiwgIjE1MCUiLCAiMjAwJSIsICIyNTAlIiwgIjM1MCUiXTsKCXRoaXMuX3NpemUgPSAtMTsKCgl0aGlzLl9sYW5ndWFnZXMgPSBbXTsKCgl0aGlzLl90aXRsZSA9IGRvY3VtZW50LnRpdGxlOwoJdGhpcy5fb3ZlcnZpZXdBY3RpdmUgPSBmYWxzZTsKCQoJdGhpcy5fYnVpbGQoKTsKCXRoaXMuX2N5Y2xlTGFuZ3VhZ2UoKTsKCXRoaXMuX2ZvbnROb3JtYWwoKTsKCgl0aGlzLl9zY2FsZSA9IDE7Cgl0aGlzLl90b3VjaFN0YXJ0VGltZSA9IDA7Cgl0aGlzLl90b3VjaFggPSAwOwoJCglPWi5FdmVudC5hZGQoZG9jdW1lbnQsICJrZXlkb3duIiwgdGhpcy5fa2V5RG93bi5iaW5kKHRoaXMpKTsKCU9aLkV2ZW50LmFkZCh3aW5kb3csICJoYXNoY2hhbmdlIiwgdGhpcy5faGFzaENoYW5nZS5iaW5kKHRoaXMpKTsKCglPWi5FdmVudC5hZGQoZG9jdW1lbnQsICJnZXN0dXJlY2hhbmdlIiwgdGhpcy5fZ2VzdHVyZUNoYW5nZS5iaW5kKHRoaXMpKTsKCU9aLkV2ZW50LmFkZChkb2N1bWVudCwgImdlc3R1cmVlbmQiLCB0aGlzLl9nZXN0dXJlRW5kLmJpbmQodGhpcykpOwoJT1ouRXZlbnQuYWRkKGRvY3VtZW50LCAidG91Y2hzdGFydCIsIHRoaXMuX3RvdWNoU3RhcnQuYmluZCh0aGlzKSk7CglPWi5FdmVudC5hZGQoZG9jdW1lbnQsICJ0b3VjaGVuZCIsIHRoaXMuX3RvdWNoRW5kLmJpbmQodGhpcykpOwoJT1ouRXZlbnQuYWRkKGRvY3VtZW50LCAidG91Y2htb3ZlIiwgT1ouRXZlbnQucHJldmVudCk7CgoJdGhpcy5fZ29Ubyh0aGlzLl9oYXNoVG9JbmRleCgpKTsKfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5nb1NsaWRlID0gZnVuY3Rpb24oc2xpZGUpIHsKCXRoaXMuX3RvZ2dsZU92ZXJ2aWV3KCk7Cgl2YXIgaW5kZXggPSB0aGlzLl9zbGlkZXMuaW5kZXhPZihzbGlkZSk7Cgl0aGlzLl9nb1RvKGluZGV4KTsKfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5faGFzaFRvSW5kZXggPSBmdW5jdGlvbigpIHsKCXZhciBpbmRleCA9IDA7Cgl2YXIgcmUgPSBsb2NhdGlvbi5oYXNoLm1hdGNoKC8jPyhbMC05XSspJC8pCglpZiAocmUpIHsgaW5kZXggPSBwYXJzZUludChyZVsxXSktMTsgfQoJcmV0dXJuIGluZGV4Owp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl9idWlsZCA9IGZ1bmN0aW9uKCkgewoJdmFyIGFsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIik7Cglmb3IgKHZhciBpPTA7aTxhbGwubGVuZ3RoO2krKykgewoJCXZhciBlbG0gPSBhbGxbaV07CgkJaWYgKGVsbS5sYW5nKSB7CgkJCXZhciBpbmRleCA9IHRoaXMuX2xhbmd1YWdlcy5pbmRleE9mKGVsbS5sYW5nKTsKCQkJaWYgKGluZGV4ID09IC0xKSB7IHRoaXMuX2xhbmd1YWdlcy5wdXNoKGVsbS5sYW5nKTsgfQoJCX0KCQlpZiAoT1ouRE9NLmhhc0NsYXNzKGVsbSwgInNsaWRlIikpIHsgCgkJCXZhciBzbGlkZSA9IG5ldyBTbGlkZSh0aGlzLCBlbG0pOwoJCQl0aGlzLl9zbGlkZXMucHVzaChzbGlkZSk7IAoJCX0KCX0KCQoJdGhpcy5faGVscCA9IE9aLkRPTS5lbG0oImRpdiIsIHtpZDoiaGVscCJ9KTsKCXZhciB1cmwgPSBsb2NhdGlvbi5ocmVmOwoJdmFyIGhhc2ggPSB1cmwubGFzdEluZGV4T2YoIiMiKTsKCWlmIChoYXNoID4gLTEpIHsgdXJsID0gdXJsLnN1YnN0cmluZygwLCBoYXNoKTsgfQoJdGhpcy5faGVscC5pbm5lckhUTUwgPSAiPGgyPiIgKyB1cmwgKyAiPC9oMj4iICsgCgkiPHRhYmxlPjx0Ym9keT4iICsKCSI8dHI+PHRkPlRvZ2dsZSBoZWxwPC90ZD48dGQ+PzwvdGQ+PC90cj4iICsgCgkiPHRyPjx0ZD5DaGFuZ2UgZm9udCBzaXplPC90ZD48dGQ+Qi9TL048L3RkPjwvdHI+IiArIAoJIjx0cj48dGQ+UHJldmlvdXMgc2xpZGU8L3RkPjx0ZD5MZWZ0L1BnVXAvQmFja3NwYWNlPC90ZD48L3RyPiIgKyAKCSI8dHI+PHRkPk5leHQgc2xpZGU8L3RkPjx0ZD5SaWdodC9QZ0Rvd24vU3BhY2U8L3RkPjwvdHI+IiArIAoJIjx0cj48dGQ+Rmlyc3Qgc2xpZGU8L3RkPjx0ZD5Ib21lPC90ZD48L3RyPiIgKyAKCSI8dHI+PHRkPkxhc3Qgc2xpZGU8L3RkPjx0ZD5FbmQ8L3RkPjwvdHI+IiArIAoJIjx0cj48dGQ+VG9nZ2xlIG92ZXJ2aWV3PC90ZD48dGQ+TzwvdGQ+PC90cj4iICsgCgkiPHRyPjx0ZD5DeWNsZSBsYW5ndWFnZTwvdGQ+PHRkPkw8L3RkPjwvdHI+IiArIAoJIjwvdGJvZHk+PC90YWJsZT4iICsgCgkiPHA+VGhpcyBpcyA8YSBocmVmPSdodHRwOi8vb25kcmFzLnphcm92aS5jei9zbGlkZXMvJz5TbGlkZXMgdjI8L2E+LCDCqSAyMDA4Jm5kYXNoOyIgKyAobmV3IERhdGUoKS5nZXRGdWxsWWVhcigpKSArICIgPGEgaHJlZj0naHR0cDovL29uZHJhcy56YXJvdmkuY3ovJz5PbmTFmWVqIMW9w6FyYTwvYT48L3A+IjsKCXRoaXMuX2hlbHAuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5faGVscCk7Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX2dvVG8gPSBmdW5jdGlvbihpbmRleCwgZXhwYW5kQWxsKSB7CglpbmRleCA9IE1hdGgubWF4KGluZGV4LCAwKTsKCWluZGV4ID0gTWF0aC5taW4oaW5kZXgsIHRoaXMuX3NsaWRlcy5sZW5ndGgtMSk7CglpZiAoaW5kZXggPT0gdGhpcy5faW5kZXgpIHsgcmV0dXJuOyB9Cgl0aGlzLl9pbmRleCA9IGluZGV4OwoJCglmb3IgKHZhciBpPTA7aTx0aGlzLl9zbGlkZXMubGVuZ3RoO2krKykgewoJCWlmIChpID09IHRoaXMuX2luZGV4KSB7IGNvbnRpbnVlOyB9CgkJdGhpcy5fc2xpZGVzW2ldLmhpZGUoaSA8IHRoaXMuX2luZGV4ID8gImJlZm9yZSIgOiAiYWZ0ZXIiKTsKCX0KCQoJZG9jdW1lbnQudGl0bGUgPSB0aGlzLl90aXRsZSArICIgIyIrKHRoaXMuX2luZGV4KzEpOyAvKiB1cGRhdGUgdGl0bGUgKi8KCWxvY2F0aW9uLmhhc2ggPSAodGhpcy5faW5kZXggPyAiIyIrKHRoaXMuX2luZGV4KzEpIDogIiIpOyAvKiB1cGRhdGUgdXJsICovCgl0aGlzLl9zbGlkZXNbdGhpcy5faW5kZXhdLnNob3coZXhwYW5kQWxsKTsgLyogc2hvdyBuZXcgKi8KCgl0aGlzLl9wcm9ncmVzcy5zdHlsZS53aWR0aCA9ICgxMDAgKiAodGhpcy5faW5kZXgrMSkgLyB0aGlzLl9zbGlkZXMubGVuZ3RoKSArICIlIjsKfQoKClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX2dvTmV4dCA9IGZ1bmN0aW9uKCkgewoJdmFyIHJlc3VsdCA9IHRoaXMuX3NsaWRlc1t0aGlzLl9pbmRleF0ubmV4dCgpOwoJaWYgKCFyZXN1bHQpIHsgdGhpcy5fZ29Ubyh0aGlzLl9pbmRleCsxLCBmYWxzZSk7IH0KfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5fZ29QcmV2ID0gZnVuY3Rpb24oKSB7Cgl2YXIgcmVzdWx0ID0gdGhpcy5fc2xpZGVzW3RoaXMuX2luZGV4XS5wcmV2KCk7CglpZiAoIXJlc3VsdCkgeyB0aGlzLl9nb1RvKHRoaXMuX2luZGV4LTEsIHRydWUpOyB9Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX3RvZ2dsZUhlbHAgPSBmdW5jdGlvbigpIHsKCXRoaXMuX2hlbHAuc3R5bGUuZGlzcGxheSA9ICh0aGlzLl9oZWxwLnN0eWxlLmRpc3BsYXkgPyAiIiA6ICJub25lIik7Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX2ZvbnROb3JtYWwgPSBmdW5jdGlvbigpIHsKCXZhciBzaXplID0gMTUwOwoJdmFyIHIgPSBsb2NhdGlvbi5zZWFyY2gubWF0Y2goL3NpemU9KFswLTldKykvKTsKCWlmIChyKSB7IHNpemUgPSByWzFdOyB9Cgl0aGlzLl9mb250Q2hhbmdlKHRoaXMuX3NpemVzLmluZGV4T2Yoc2l6ZSsiJSIpKTsKfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5fZm9udENoYW5nZSA9IGZ1bmN0aW9uKGluZGV4KSB7CglpbmRleCA9IE1hdGgubWF4KGluZGV4LCAwKTsKCWluZGV4ID0gTWF0aC5taW4oaW5kZXgsIHRoaXMuX3NpemVzLmxlbmd0aC0xKTsKCWlmIChpbmRleCA9PSB0aGlzLl9zaXplKSB7IHJldHVybjsgfQoJdGhpcy5fc2l6ZSA9IGluZGV4OwoJZG9jdW1lbnQuYm9keS5zdHlsZS5mb250U2l6ZSA9IHRoaXMuX3NpemVzW3RoaXMuX3NpemVdOwp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl9rZXlEb3duID0gZnVuY3Rpb24oZSkgewkKCXN3aXRjaCAoZS5rZXlDb2RlKSB7CgkJY2FzZSA5OiBPWi5FdmVudC5wcmV2ZW50KGUpOyBicmVhazsKCQljYXNlIDg6CgkJY2FzZSAzNzoKCQljYXNlIDMzOiB0aGlzLl9nb1ByZXYoKTsgYnJlYWs7CgkJCgkJY2FzZSAzMjoKCQljYXNlIDM5OgoJCWNhc2UgMzQ6IHRoaXMuX2dvTmV4dCgpOyBicmVhazsKCQkKCQljYXNlIDM2OiB0aGlzLl9nb1RvKDAsIGZhbHNlKTsgYnJlYWs7CgkJY2FzZSAzNTogdGhpcy5fZ29Ubyh0aGlzLl9zbGlkZXMubGVuZ3RoLTEsIGZhbHNlKTsgYnJlYWs7CgkJCgkJY2FzZSAiQiIuY2hhckNvZGVBdCgwKTogdGhpcy5fZm9udENoYW5nZSh0aGlzLl9zaXplKzEpOyBicmVhazsKCQljYXNlICJOIi5jaGFyQ29kZUF0KDApOiB0aGlzLl9mb250Tm9ybWFsKCk7IGJyZWFrOwoJCWNhc2UgIlMiLmNoYXJDb2RlQXQoMCk6IHRoaXMuX2ZvbnRDaGFuZ2UodGhpcy5fc2l6ZS0xKTsgYnJlYWs7CgkJCgkJY2FzZSAiTCIuY2hhckNvZGVBdCgwKTogCgkJCWlmICghZS5jdHJsS2V5KSB7IHRoaXMuX2N5Y2xlTGFuZ3VhZ2UoKTsgfQoJCQlyZXR1cm47IAoJCWJyZWFrOwoKCQljYXNlIDE3MzoKCQljYXNlIDE5MTogdGhpcy5fdG9nZ2xlSGVscCgpOyBicmVhazsKCQkKCQljYXNlICJPIi5jaGFyQ29kZUF0KDApOiB0aGlzLl90b2dnbGVPdmVydmlldygpOyBicmVhazsKICAgICAgCiAgICAJY2FzZSAyNzoKCQkJaWYgKCF0aGlzLl9oZWxwLnN0eWxlLmRpc3BsYXkpIHsKCQkJCXRoaXMuX2hlbHAuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJfSBlbHNlIGlmICh0aGlzLl9vdmVydmlld0FjdGl2ZSkgewoJCQkJdGhpcy5fdG9nZ2xlT3ZlcnZpZXcoKTsKCQkJfQoJCWJyZWFrOwoKCQlkZWZhdWx0OiByZXR1cm47IGJyZWFrOwoJfQoKCU9aLkV2ZW50LnByZXZlbnQoZSk7Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX2N5Y2xlTGFuZ3VhZ2UgPSBmdW5jdGlvbigpIHsKCWlmICh0aGlzLl9sYW5ndWFnZXMubGVuZ3RoIDwgMikgeyByZXR1cm47IH0KCXZhciBsYW5nID0gdGhpcy5fbGFuZ3VhZ2VzLnNoaWZ0KCk7Cgl0aGlzLl9sYW5ndWFnZXMucHVzaChsYW5nKTsKCQoJdmFyIGFsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIik7Cglmb3IgKHZhciBpPTA7aTxhbGwubGVuZ3RoO2krKykgewoJCXZhciBub2RlID0gYWxsW2ldOwoJCWlmICghbm9kZS5sYW5nKSB7IGNvbnRpbnVlOyB9CgkJbm9kZS5zdHlsZS5kaXNwbGF5ID0gKG5vZGUubGFuZyA9PSBsYW5nID8gIiIgOiAibm9uZSIpOwoJfQp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl90b2dnbGVPdmVydmlldyA9IGZ1bmN0aW9uKCkgewoJaWYgKHRoaXMuX292ZXJ2aWV3QWN0aXZlKSB7CgkJdGhpcy5fb3ZlcnZpZXdBY3RpdmUgPSBmYWxzZTsKCQlPWi5ET00ucmVtb3ZlQ2xhc3MoZG9jdW1lbnQuYm9keSwgIm92ZXJ2aWV3Iik7CgkJZm9yICh2YXIgaT0wOyBpPHRoaXMuX3NsaWRlcy5sZW5ndGg7aSsrKSB7CgkJCXRoaXMuX3NsaWRlc1tpXS5lbmRPdmVydmlldygpOwoJCX0KCX0gZWxzZSB7CgkJdGhpcy5fb3ZlcnZpZXdBY3RpdmUgPSB0cnVlOwoJCU9aLkRPTS5hZGRDbGFzcyhkb2N1bWVudC5ib2R5LCAib3ZlcnZpZXciKTsKCQl2YXIgY291bnQgPSBNYXRoLmNlaWwoTWF0aC5zcXJ0KHRoaXMuX3NsaWRlcy5sZW5ndGgpKTsKCQl2YXIgYmxhbmtzID0gY291bnQrMTsKCQl2YXIgcGFkZGluZyA9IDAuMjsKCQl2YXIgYW1vdW50ID0gY291bnQgKyBibGFua3MqcGFkZGluZzsKCQl2YXIgc2NhbGUgPSAxL2Ftb3VudDsKCQkKCQlmb3IgKHZhciBpPTA7IGk8dGhpcy5fc2xpZGVzLmxlbmd0aDtpKyspIHsKCQkJdmFyIHggPSBpICUgY291bnQ7CgkJCXZhciB5ID0gTWF0aC5mbG9vcihpIC8gY291bnQpOwoJCQl4ICs9ICh4KzEpKnBhZGRpbmcgKyAwLjU7CgkJCXkgKz0gKHkrMSkqcGFkZGluZyArIDAuNTsKCQkJdGhpcy5fc2xpZGVzW2ldLmJlZ2luT3ZlcnZpZXcoc2NhbGUsIHgsIHkpOwoJCX0KCX0KCQp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl9oYXNoQ2hhbmdlID0gZnVuY3Rpb24oZSkgewoJdGhpcy5fZ29Ubyh0aGlzLl9oYXNoVG9JbmRleCgpKTsKfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5fZ2VzdHVyZUNoYW5nZSA9IGZ1bmN0aW9uKGUpIHsKCXRoaXMuX3RvdWNoU3RhcnRUaW1lID0gMDsKCXZhciBzID0gZS5zY2FsZTsKCXZhciBkaWZmID0gMC4yOwoJaWYgKHMgPiB0aGlzLl9zY2FsZSArIGRpZmYpIHsKCQl0aGlzLl9zY2FsZSArPSBkaWZmOwoJCXRoaXMuX2ZvbnRDaGFuZ2UodGhpcy5fc2l6ZSsxKTsKCX0gZWxzZSBpZiAocyA8IHRoaXMuX3NjYWxlIC0gZGlmZikgewoJCXRoaXMuX3NjYWxlIC09IGRpZmY7CgkJdGhpcy5fZm9udENoYW5nZSh0aGlzLl9zaXplLTEpOwoJfQp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl9nZXN0dXJlRW5kID0gZnVuY3Rpb24oZSkgewoJdGhpcy5fc2NhbGUgPSAxOwp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl90b3VjaFN0YXJ0ID0gZnVuY3Rpb24oZSkgewoJdGhpcy5fdG91Y2hTdGFydFRpbWUgPSBEYXRlLm5vdygpOwoJdGhpcy5fdG91Y2hYID0gZS50b3VjaGVzWzBdLmNsaWVudFg7Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX3RvdWNoRW5kID0gZnVuY3Rpb24oZSkgewoJdmFyIHQyID0gRGF0ZS5ub3coKTsKCXZhciBkaWZmID0gdDItdGhpcy5fdG91Y2hTdGFydFRpbWU7Cgl0aGlzLl90b3VjaFN0YXJ0VGltZSA9IDA7CglpZiAoZGlmZiA8IDIwMCkgewoJCWlmICh0aGlzLl90b3VjaFggPiBPWi5ET00ud2luKClbMF0vMikgeyAKCQkJdGhpcy5fZ29OZXh0KCk7CgkJfSBlbHNlIHsKCQkJdGhpcy5fZ29QcmV2KCk7CgkJfQoJfQp9Cgp2YXIgU2xpZGUgPSBPWi5DbGFzcygpOwpTbGlkZS5wcm90b3R5cGUuX3ByZWZpeGVzID0gWyIiLCAiTW96IiwgIldlYmtpdCIsICJPIiwgIm1zIl07CgpTbGlkZS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKHByZXNlbnRhdGlvbiwgZWxtKSB7Cgl0aGlzLl9wcmVzZW50YXRpb24gPSBwcmVzZW50YXRpb247Cgl0aGlzLl9lbG0gPSBlbG07Cgl0aGlzLl9oaWRkZW5DbGFzcyA9ICIiOwoKCXRoaXMuX3NlY3Rpb25zID0gW107IC8qIHBvZGNhc3RpICovCgl0aGlzLl9pbmRleCA9IC0xOyAvKiBrb2xpa2F0YSBwb2RjYXN0IGplIGFrdHVhbG5pICovCgkKCXRoaXMuX2ZpbmRTZWN0aW9ucyhlbG0pOwp9CgpTbGlkZS5wcm90b3R5cGUuZ2V0Q29udGFpbmVyID0gZnVuY3Rpb24oKSB7CglyZXR1cm4gdGhpcy5fZWxtOwp9CgpTbGlkZS5wcm90b3R5cGUuX2ZpbmRTZWN0aW9ucyA9IGZ1bmN0aW9uKG5vZGUpIHsKCXZhciBoYXNTZWN0aW9ucyA9IE9aLkRPTS5oYXNDbGFzcyhub2RlLCAic2VjdGlvbnMiKTsKCU9aLkRPTS5yZW1vdmVDbGFzcyhub2RlLCAic2VjdGlvbnMiKTsKCQoJdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZE5vZGVzOwoJdmFyIGNoaWxkRWxlbWVudHMgPSBbXTsKCWZvciAodmFyIGk9MDtpPGNoaWxkcmVuLmxlbmd0aDtpKyspIHsKCQl2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTsKCQlpZiAoY2hpbGQubm9kZVR5cGUgPT0gMSkgeyAKCQkJY2hpbGRFbGVtZW50cy5wdXNoKGNoaWxkKTsKCQkJaWYgKGhhc1NlY3Rpb25zKSB7IE9aLkRPTS5hZGRDbGFzcyhjaGlsZCwgInNlY3Rpb24iKTsgfQoJCX0KCX0KCQoJaWYgKE9aLkRPTS5oYXNDbGFzcyhub2RlLCAic2VjdGlvbiIpKSB7IAoJCXRoaXMuX3NlY3Rpb25zLnB1c2gobm9kZSk7IAoJCU9aLkRPTS5hZGRDbGFzcyhub2RlLCAiYWZ0ZXIiKTsKCX0KCWZvciAodmFyIGk9MDtpPGNoaWxkRWxlbWVudHMubGVuZ3RoO2krKykgewoJCXRoaXMuX2ZpbmRTZWN0aW9ucyhjaGlsZEVsZW1lbnRzW2ldKTsKCX0KfQoKU2xpZGUucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbihjbGFzc05hbWUpIHsKCWlmIChjbGFzc05hbWUgPT0gdGhpcy5faGlkZGVuQ2xhc3MpIHsgcmV0dXJuOyB9CglpZiAodGhpcy5faGlkZGVuQ2xhc3MpIHsgT1ouRE9NLnJlbW92ZUNsYXNzKHRoaXMuX2VsbSwgdGhpcy5faGlkZGVuQ2xhc3MpOyB9CgkKCXRoaXMuX2hpZGRlbkNsYXNzID0gY2xhc3NOYW1lOwoKCU9aLkRPTS5yZW1vdmVDbGFzcyh0aGlzLl9lbG0sICJjdXJyZW50Iik7CglPWi5ET00uYWRkQ2xhc3ModGhpcy5fZWxtLCB0aGlzLl9oaWRkZW5DbGFzcyk7CgoJdGhpcy5kaXNwYXRjaCgic2xpZGUtaGlkZSIpOwp9CgpTbGlkZS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKGV4cGFuZEFsbCkgewoJT1ouRE9NLnJlbW92ZUNsYXNzKHRoaXMuX2VsbSwgdGhpcy5faGlkZGVuQ2xhc3MpOwoJdGhpcy5faGlkZGVuQ2xhc3MgPSAiIjsKCU9aLkRPTS5hZGRDbGFzcyh0aGlzLl9lbG0sICJjdXJyZW50Iik7CgoJdGhpcy5faW5kZXggPSAoZXhwYW5kQWxsID8gdGhpcy5fc2VjdGlvbnMubGVuZ3RoLTEgOiAwKTsKCglmb3IgKHZhciBpPTA7aTx0aGlzLl9zZWN0aW9ucy5sZW5ndGg7aSsrKSB7CgkJdmFyIG5vZGUgPSB0aGlzLl9zZWN0aW9uc1tpXTsKCQlpZiAoaSA9PSB0aGlzLl9pbmRleCkgeyAKCQkJT1ouRE9NLmFkZENsYXNzKG5vZGUsICJjdXJyZW50Iik7IAoJCQlPWi5ET00ucmVtb3ZlQ2xhc3Mobm9kZSwgImFmdGVyIik7IAoJCQlPWi5ET00ucmVtb3ZlQ2xhc3Mobm9kZSwgImJlZm9yZSIpOyAKCQl9IGVsc2UgewoJCQlPWi5ET00ucmVtb3ZlQ2xhc3Mobm9kZSwgImN1cnJlbnQiKTsgCgkJCWlmIChpIDwgdGhpcy5faW5kZXgpIHsKCQkJCU9aLkRPTS5yZW1vdmVDbGFzcyhub2RlLCAiYWZ0ZXIiKTsKCQkJCU9aLkRPTS5hZGRDbGFzcyhub2RlLCAiYmVmb3JlIik7CgkJCX0gZWxzZSB7CgkJCQlPWi5ET00ucmVtb3ZlQ2xhc3Mobm9kZSwgImJlZm9yZSIpOwoJCQkJT1ouRE9NLmFkZENsYXNzKG5vZGUsICJhZnRlciIpOwoJCQl9CgkJfQoJfQoJCgl0aGlzLmRpc3BhdGNoKCJzbGlkZS1zaG93Iik7Cn0KClNsaWRlLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oKSB7CglpZiAodGhpcy5faW5kZXgrMSA+PSB0aGlzLl9zZWN0aW9ucy5sZW5ndGgpIHsgcmV0dXJuIGZhbHNlOyB9CgoJT1ouRE9NLnJlbW92ZUNsYXNzKHRoaXMuX3NlY3Rpb25zW3RoaXMuX2luZGV4XSwgImN1cnJlbnQiKTsKCU9aLkRPTS5hZGRDbGFzcyh0aGlzLl9zZWN0aW9uc1t0aGlzLl9pbmRleF0sICJiZWZvcmUiKTsKCXRoaXMuX2luZGV4Kys7CglPWi5ET00ucmVtb3ZlQ2xhc3ModGhpcy5fc2VjdGlvbnNbdGhpcy5faW5kZXhdLCAiYWZ0ZXIiKTsKCU9aLkRPTS5hZGRDbGFzcyh0aGlzLl9zZWN0aW9uc1t0aGlzLl9pbmRleF0sICJjdXJyZW50Iik7CgkKCXJldHVybiB0cnVlOwp9CgpTbGlkZS5wcm90b3R5cGUucHJldiA9IGZ1bmN0aW9uKCkgewoJaWYgKHRoaXMuX2luZGV4IDw9IDApIHsgcmV0dXJuIGZhbHNlOyB9CgoJT1ouRE9NLnJlbW92ZUNsYXNzKHRoaXMuX3NlY3Rpb25zW3RoaXMuX2luZGV4XSwgImN1cnJlbnQiKTsKCU9aLkRPTS5hZGRDbGFzcyh0aGlzLl9zZWN0aW9uc1t0aGlzLl9pbmRleF0sICJhZnRlciIpOwoJdGhpcy5faW5kZXgtLTsKCU9aLkRPTS5yZW1vdmVDbGFzcyh0aGlzLl9zZWN0aW9uc1t0aGlzLl9pbmRleF0sICJiZWZvcmUiKTsKCU9aLkRPTS5hZGRDbGFzcyh0aGlzLl9zZWN0aW9uc1t0aGlzLl9pbmRleF0sICJjdXJyZW50Iik7CgkKCXJldHVybiB0cnVlOwp9CgpTbGlkZS5wcm90b3R5cGUuYmVnaW5PdmVydmlldyA9IGZ1bmN0aW9uKHNjYWxlLCB4LCB5KSB7Cgl4ID0gTWF0aC5yb3VuZCh4KjEwMCkgKyAiJSI7Cgl5ID0gTWF0aC5yb3VuZCh5KjEwMCkgKyAiJSI7Cgl0aGlzLl9jc3MzcHJvcCgidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgiICsgc2NhbGUgKyAiKSB0cmFuc2xhdGUoIiArIHggKyAiLCAiICsgeSArICIpIik7CgkKCXZhciBib3JkZXIgPSBPWi5TdHlsZS5nZXQodGhpcy5fZWxtLCAiYm9yZGVyTGVmdFdpZHRoIik7Cglib3JkZXIgPSBwYXJzZUludChib3JkZXIpIHx8IDA7Cglib3JkZXIgPSBNYXRoLnJvdW5kKGJvcmRlci9zY2FsZSk7Cgl0aGlzLl9lbG0uc3R5bGUuYm9yZGVyV2lkdGggPSBib3JkZXIrInB4IjsKCQoJdGhpcy5fZXZlbnQgPSBPWi5FdmVudC5hZGQodGhpcy5fZWxtLCAiY2xpY2siLCB0aGlzLl9jbGljay5iaW5kKHRoaXMpKTsKfQoKU2xpZGUucHJvdG90eXBlLmVuZE92ZXJ2aWV3ID0gZnVuY3Rpb24oc2NhbGUsIHgsIHkpIHsKCXRoaXMuX2NzczNwcm9wKCJ0cmFuc2Zvcm0iLCAiIik7Cgl0aGlzLl9lbG0uc3R5bGUuYm9yZGVyV2lkdGggPSAiIjsKCU9aLkV2ZW50LnJlbW92ZSh0aGlzLl9ldmVudCk7Cn0KClNsaWRlLnByb3RvdHlwZS5fY3NzM3Byb3AgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewoJZm9yICh2YXIgaT0wO2k8dGhpcy5fcHJlZml4ZXMubGVuZ3RoO2krKykgewoJCXZhciBuID0gdGhpcy5fcHJlZml4ZXNbaV07CgkJaWYgKG4pIHsKCQkJbiArPSBuYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zdWJzdHJpbmcoMSk7CgkJfSBlbHNlIHsKCQkJbiArPSBuYW1lOwoJCX0KCQl0aGlzLl9lbG0uc3R5bGVbbl0gPSB2YWx1ZTsKCX0KfQoKU2xpZGUucHJvdG90eXBlLl9jbGljayA9IGZ1bmN0aW9uKGUpIHsKCXRoaXMuX3ByZXNlbnRhdGlvbi5nb1NsaWRlKHRoaXMpOwp9Cg==",
                "body": "dmFyIFByZXNlbnRhdGlvbiA9IE9aLkNsYXNzKCk7ClByZXNlbnRhdGlvbi5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkgewoJdGhpcy5faGVscCA9IG51bGw7Cgl0aGlzLl9zbGlkZXMgPSBbXTsKCXRoaXMuX2luZGV4ID0gLTE7Cgl0aGlzLl9wcm9ncmVzcyA9IE9aLkRPTS5lbG0oImRpdiIsIHtpZDoicHJvZ3Jlc3MifSk7Cglkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuX3Byb2dyZXNzKTsKCgl0aGlzLl9zaXplcyA9IFsiOTAlIiwgIjEwMCUiICwiMTIwJSIsICIxNTAlIiwgIjIwMCUiLCAiMjUwJSIsICIzNTAlIl07Cgl0aGlzLl9zaXplID0gLTE7CgoJdGhpcy5fbGFuZ3VhZ2VzID0gW107CgoJdGhpcy5fdGl0bGUgPSBkb2N1bWVudC50aXRsZTsKCXRoaXMuX292ZXJ2aWV3QWN0aXZlID0gZmFsc2U7CgkKCXRoaXMuX2J1aWxkKCk7Cgl0aGlzLl9jeWNsZUxhbmd1YWdlKCk7Cgl0aGlzLl9mb250Tm9ybWFsKCk7CgoJdGhpcy5fc2NhbGUgPSAxOwoJdGhpcy5fdG91Y2hTdGFydFRpbWUgPSAwOwoJdGhpcy5fdG91Y2hYID0gMDsKCQoJT1ouRXZlbnQuYWRkKGRvY3VtZW50LCAia2V5ZG93biIsIHRoaXMuX2tleURvd24uYmluZCh0aGlzKSk7CglPWi5FdmVudC5hZGQod2luZG93LCAiaGFzaGNoYW5nZSIsIHRoaXMuX2hhc2hDaGFuZ2UuYmluZCh0aGlzKSk7CgoJT1ouRXZlbnQuYWRkKGRvY3VtZW50LCAiZ2VzdHVyZWNoYW5nZSIsIHRoaXMuX2dlc3R1cmVDaGFuZ2UuYmluZCh0aGlzKSk7CglPWi5FdmVudC5hZGQoZG9jdW1lbnQsICJnZXN0dXJlZW5kIiwgdGhpcy5fZ2VzdHVyZUVuZC5iaW5kKHRoaXMpKTsKCU9aLkV2ZW50LmFkZChkb2N1bWVudCwgInRvdWNoc3RhcnQiLCB0aGlzLl90b3VjaFN0YXJ0LmJpbmQodGhpcykpOwoJT1ouRXZlbnQuYWRkKGRvY3VtZW50LCAidG91Y2hlbmQiLCB0aGlzLl90b3VjaEVuZC5iaW5kKHRoaXMpKTsKCU9aLkV2ZW50LmFkZChkb2N1bWVudCwgInRvdWNobW92ZSIsIE9aLkV2ZW50LnByZXZlbnQpOwoKCXRoaXMuX2dvVG8odGhpcy5faGFzaFRvSW5kZXgoKSk7Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuZ29TbGlkZSA9IGZ1bmN0aW9uKHNsaWRlKSB7Cgl0aGlzLl90b2dnbGVPdmVydmlldygpOwoJdmFyIGluZGV4ID0gdGhpcy5fc2xpZGVzLmluZGV4T2Yoc2xpZGUpOwoJdGhpcy5fZ29UbyhpbmRleCk7Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX2hhc2hUb0luZGV4ID0gZnVuY3Rpb24oKSB7Cgl2YXIgaW5kZXggPSAwOwoJdmFyIHJlID0gbG9jYXRpb24uaGFzaC5tYXRjaCgvIz8oWzAtOV0rKSQvKQoJaWYgKHJlKSB7IGluZGV4ID0gcGFyc2VJbnQocmVbMV0pLTE7IH0KCXJldHVybiBpbmRleDsKfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5fYnVpbGQgPSBmdW5jdGlvbigpIHsKCXZhciBhbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOwoJZm9yICh2YXIgaT0wO2k8YWxsLmxlbmd0aDtpKyspIHsKCQl2YXIgZWxtID0gYWxsW2ldOwoJCWlmIChlbG0ubGFuZykgewoJCQl2YXIgaW5kZXggPSB0aGlzLl9sYW5ndWFnZXMuaW5kZXhPZihlbG0ubGFuZyk7CgkJCWlmIChpbmRleCA9PSAtMSkgeyB0aGlzLl9sYW5ndWFnZXMucHVzaChlbG0ubGFuZyk7IH0KCQl9CgkJaWYgKE9aLkRPTS5oYXNDbGFzcyhlbG0sICJzbGlkZSIpKSB7IAoJCQl2YXIgc2xpZGUgPSBuZXcgU2xpZGUodGhpcywgZWxtKTsKCQkJdGhpcy5fc2xpZGVzLnB1c2goc2xpZGUpOyAKCQl9Cgl9CgkKCXRoaXMuX2hlbHAgPSBPWi5ET00uZWxtKCJkaXYiLCB7aWQ6ImhlbHAifSk7Cgl2YXIgdXJsID0gbG9jYXRpb24uaHJlZjsKCXZhciBoYXNoID0gdXJsLmxhc3RJbmRleE9mKCIjIik7CglpZiAoaGFzaCA+IC0xKSB7IHVybCA9IHVybC5zdWJzdHJpbmcoMCwgaGFzaCk7IH0KCXRoaXMuX2hlbHAuaW5uZXJIVE1MID0gIjxoMj4iICsgdXJsICsgIjwvaDI+IiArIAoJIjx0YWJsZT48dGJvZHk+IiArCgkiPHRyPjx0ZD5Ub2dnbGUgaGVscDwvdGQ+PHRkPj88L3RkPjwvdHI+IiArIAoJIjx0cj48dGQ+Q2hhbmdlIGZvbnQgc2l6ZTwvdGQ+PHRkPkIvUy9OPC90ZD48L3RyPiIgKyAKCSI8dHI+PHRkPlByZXZpb3VzIHNsaWRlPC90ZD48dGQ+TGVmdC9QZ1VwL0JhY2tzcGFjZTwvdGQ+PC90cj4iICsgCgkiPHRyPjx0ZD5OZXh0IHNsaWRlPC90ZD48dGQ+UmlnaHQvUGdEb3duL1NwYWNlPC90ZD48L3RyPiIgKyAKCSI8dHI+PHRkPkZpcnN0IHNsaWRlPC90ZD48dGQ+SG9tZTwvdGQ+PC90cj4iICsgCgkiPHRyPjx0ZD5MYXN0IHNsaWRlPC90ZD48dGQ+RW5kPC90ZD48L3RyPiIgKyAKCSI8dHI+PHRkPlRvZ2dsZSBvdmVydmlldzwvdGQ+PHRkPk88L3RkPjwvdHI+IiArIAoJIjx0cj48dGQ+Q3ljbGUgbGFuZ3VhZ2U8L3RkPjx0ZD5MPC90ZD48L3RyPiIgKyAKCSI8L3Rib2R5PjwvdGFibGU+IiArIAoJIjxwPlRoaXMgaXMgPGEgaHJlZj0naHR0cDovL29uZHJhcy56YXJvdmkuY3ovc2xpZGVzLyc+U2xpZGVzIHYyPC9hPiwgwqkgMjAwOCZuZGFzaDsiICsgKG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSkgKyAiIDxhIGhyZWY9J2h0dHA6Ly9vbmRyYXMuemFyb3ZpLmN6Lyc+T25kxZllaiDFvcOhcmE8L2E+PC9wPiI7Cgl0aGlzLl9oZWxwLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7Cglkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuX2hlbHApOwp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl9nb1RvID0gZnVuY3Rpb24oaW5kZXgsIGV4cGFuZEFsbCkgewoJaW5kZXggPSBNYXRoLm1heChpbmRleCwgMCk7CglpbmRleCA9IE1hdGgubWluKGluZGV4LCB0aGlzLl9zbGlkZXMubGVuZ3RoLTEpOwoJaWYgKGluZGV4ID09IHRoaXMuX2luZGV4KSB7IHJldHVybjsgfQoJdGhpcy5faW5kZXggPSBpbmRleDsKCQoJZm9yICh2YXIgaT0wO2k8dGhpcy5fc2xpZGVzLmxlbmd0aDtpKyspIHsKCQlpZiAoaSA9PSB0aGlzLl9pbmRleCkgeyBjb250aW51ZTsgfQoJCXRoaXMuX3NsaWRlc1tpXS5oaWRlKGkgPCB0aGlzLl9pbmRleCA/ICJiZWZvcmUiIDogImFmdGVyIik7Cgl9CgkKCWRvY3VtZW50LnRpdGxlID0gdGhpcy5fdGl0bGUgKyAiICMiKyh0aGlzLl9pbmRleCsxKTsgLyogdXBkYXRlIHRpdGxlICovCglsb2NhdGlvbi5oYXNoID0gKHRoaXMuX2luZGV4ID8gIiMiKyh0aGlzLl9pbmRleCsxKSA6ICIiKTsgLyogdXBkYXRlIHVybCAqLwoJdGhpcy5fc2xpZGVzW3RoaXMuX2luZGV4XS5zaG93KGV4cGFuZEFsbCk7IC8qIHNob3cgbmV3ICovCgoJdGhpcy5fcHJvZ3Jlc3Muc3R5bGUud2lkdGggPSAoMTAwICogKHRoaXMuX2luZGV4KzEpIC8gdGhpcy5fc2xpZGVzLmxlbmd0aCkgKyAiJSI7Cn0KCgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl9nb05leHQgPSBmdW5jdGlvbigpIHsKCXZhciByZXN1bHQgPSB0aGlzLl9zbGlkZXNbdGhpcy5faW5kZXhdLm5leHQoKTsKCWlmICghcmVzdWx0KSB7IHRoaXMuX2dvVG8odGhpcy5faW5kZXgrMSwgZmFsc2UpOyB9Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX2dvUHJldiA9IGZ1bmN0aW9uKCkgewoJdmFyIHJlc3VsdCA9IHRoaXMuX3NsaWRlc1t0aGlzLl9pbmRleF0ucHJldigpOwoJaWYgKCFyZXN1bHQpIHsgdGhpcy5fZ29Ubyh0aGlzLl9pbmRleC0xLCB0cnVlKTsgfQp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl90b2dnbGVIZWxwID0gZnVuY3Rpb24oKSB7Cgl0aGlzLl9oZWxwLnN0eWxlLmRpc3BsYXkgPSAodGhpcy5faGVscC5zdHlsZS5kaXNwbGF5ID8gIiIgOiAibm9uZSIpOwp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl9mb250Tm9ybWFsID0gZnVuY3Rpb24oKSB7Cgl2YXIgc2l6ZSA9IDE1MDsKCXZhciByID0gbG9jYXRpb24uc2VhcmNoLm1hdGNoKC9zaXplPShbMC05XSspLyk7CglpZiAocikgeyBzaXplID0gclsxXTsgfQoJdGhpcy5fZm9udENoYW5nZSh0aGlzLl9zaXplcy5pbmRleE9mKHNpemUrIiUiKSk7Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX2ZvbnRDaGFuZ2UgPSBmdW5jdGlvbihpbmRleCkgewoJaW5kZXggPSBNYXRoLm1heChpbmRleCwgMCk7CglpbmRleCA9IE1hdGgubWluKGluZGV4LCB0aGlzLl9zaXplcy5sZW5ndGgtMSk7CglpZiAoaW5kZXggPT0gdGhpcy5fc2l6ZSkgeyByZXR1cm47IH0KCXRoaXMuX3NpemUgPSBpbmRleDsKCWRvY3VtZW50LmJvZHkuc3R5bGUuZm9udFNpemUgPSB0aGlzLl9zaXplc1t0aGlzLl9zaXplXTsKfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5fa2V5RG93biA9IGZ1bmN0aW9uKGUpIHsJCglzd2l0Y2ggKGUua2V5Q29kZSkgewoJCWNhc2UgOTogT1ouRXZlbnQucHJldmVudChlKTsgYnJlYWs7CgkJY2FzZSA4OgoJCWNhc2UgMzc6CgkJY2FzZSAzMzogdGhpcy5fZ29QcmV2KCk7IGJyZWFrOwoJCQoJCWNhc2UgMzI6CgkJY2FzZSAzOToKCQljYXNlIDM0OiB0aGlzLl9nb05leHQoKTsgYnJlYWs7CgkJCgkJY2FzZSAzNjogdGhpcy5fZ29UbygwLCBmYWxzZSk7IGJyZWFrOwoJCWNhc2UgMzU6IHRoaXMuX2dvVG8odGhpcy5fc2xpZGVzLmxlbmd0aC0xLCBmYWxzZSk7IGJyZWFrOwoJCQoJCWNhc2UgIkIiLmNoYXJDb2RlQXQoMCk6IHRoaXMuX2ZvbnRDaGFuZ2UodGhpcy5fc2l6ZSsxKTsgYnJlYWs7CgkJY2FzZSAiTiIuY2hhckNvZGVBdCgwKTogdGhpcy5fZm9udE5vcm1hbCgpOyBicmVhazsKCQljYXNlICJTIi5jaGFyQ29kZUF0KDApOiB0aGlzLl9mb250Q2hhbmdlKHRoaXMuX3NpemUtMSk7IGJyZWFrOwoJCQoJCWNhc2UgIkwiLmNoYXJDb2RlQXQoMCk6IAoJCQlpZiAoIWUuY3RybEtleSkgeyB0aGlzLl9jeWNsZUxhbmd1YWdlKCk7IH0KCQkJcmV0dXJuOyAKCQlicmVhazsKCgkJY2FzZSAxNzM6CgkJY2FzZSAxOTE6IHRoaXMuX3RvZ2dsZUhlbHAoKTsgYnJlYWs7CgkJCgkJY2FzZSAiTyIuY2hhckNvZGVBdCgwKTogdGhpcy5fdG9nZ2xlT3ZlcnZpZXcoKTsgYnJlYWs7CiAgICAgIAogICAgCWNhc2UgMjc6CgkJCWlmICghdGhpcy5faGVscC5zdHlsZS5kaXNwbGF5KSB7CgkJCQl0aGlzLl9oZWxwLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCX0gZWxzZSBpZiAodGhpcy5fb3ZlcnZpZXdBY3RpdmUpIHsKCQkJCXRoaXMuX3RvZ2dsZU92ZXJ2aWV3KCk7CgkJCX0KCQlicmVhazsKCgkJZGVmYXVsdDogcmV0dXJuOyBicmVhazsKCX0KCglPWi5FdmVudC5wcmV2ZW50KGUpOwp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl9jeWNsZUxhbmd1YWdlID0gZnVuY3Rpb24oKSB7CglpZiAodGhpcy5fbGFuZ3VhZ2VzLmxlbmd0aCA8IDIpIHsgcmV0dXJuOyB9Cgl2YXIgbGFuZyA9IHRoaXMuX2xhbmd1YWdlcy5zaGlmdCgpOwoJdGhpcy5fbGFuZ3VhZ2VzLnB1c2gobGFuZyk7CgkKCXZhciBhbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOwoJZm9yICh2YXIgaT0wO2k8YWxsLmxlbmd0aDtpKyspIHsKCQl2YXIgbm9kZSA9IGFsbFtpXTsKCQlpZiAoIW5vZGUubGFuZykgeyBjb250aW51ZTsgfQoJCW5vZGUuc3R5bGUuZGlzcGxheSA9IChub2RlLmxhbmcgPT0gbGFuZyA/ICIiIDogIm5vbmUiKTsKCX0KfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5fdG9nZ2xlT3ZlcnZpZXcgPSBmdW5jdGlvbigpIHsKCWlmICh0aGlzLl9vdmVydmlld0FjdGl2ZSkgewoJCXRoaXMuX292ZXJ2aWV3QWN0aXZlID0gZmFsc2U7CgkJT1ouRE9NLnJlbW92ZUNsYXNzKGRvY3VtZW50LmJvZHksICJvdmVydmlldyIpOwoJCWZvciAodmFyIGk9MDsgaTx0aGlzLl9zbGlkZXMubGVuZ3RoO2krKykgewoJCQl0aGlzLl9zbGlkZXNbaV0uZW5kT3ZlcnZpZXcoKTsKCQl9Cgl9IGVsc2UgewoJCXRoaXMuX292ZXJ2aWV3QWN0aXZlID0gdHJ1ZTsKCQlPWi5ET00uYWRkQ2xhc3MoZG9jdW1lbnQuYm9keSwgIm92ZXJ2aWV3Iik7CgkJdmFyIGNvdW50ID0gTWF0aC5jZWlsKE1hdGguc3FydCh0aGlzLl9zbGlkZXMubGVuZ3RoKSk7CgkJdmFyIGJsYW5rcyA9IGNvdW50KzE7CgkJdmFyIHBhZGRpbmcgPSAwLjI7CgkJdmFyIGFtb3VudCA9IGNvdW50ICsgYmxhbmtzKnBhZGRpbmc7CgkJdmFyIHNjYWxlID0gMS9hbW91bnQ7CgkJCgkJZm9yICh2YXIgaT0wOyBpPHRoaXMuX3NsaWRlcy5sZW5ndGg7aSsrKSB7CgkJCXZhciB4ID0gaSAlIGNvdW50OwoJCQl2YXIgeSA9IE1hdGguZmxvb3IoaSAvIGNvdW50KTsKCQkJeCArPSAoeCsxKSpwYWRkaW5nICsgMC41OwoJCQl5ICs9ICh5KzEpKnBhZGRpbmcgKyAwLjU7CgkJCXRoaXMuX3NsaWRlc1tpXS5iZWdpbk92ZXJ2aWV3KHNjYWxlLCB4LCB5KTsKCQl9Cgl9CgkKfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5faGFzaENoYW5nZSA9IGZ1bmN0aW9uKGUpIHsKCXRoaXMuX2dvVG8odGhpcy5faGFzaFRvSW5kZXgoKSk7Cn0KClByZXNlbnRhdGlvbi5wcm90b3R5cGUuX2dlc3R1cmVDaGFuZ2UgPSBmdW5jdGlvbihlKSB7Cgl0aGlzLl90b3VjaFN0YXJ0VGltZSA9IDA7Cgl2YXIgcyA9IGUuc2NhbGU7Cgl2YXIgZGlmZiA9IDAuMjsKCWlmIChzID4gdGhpcy5fc2NhbGUgKyBkaWZmKSB7CgkJdGhpcy5fc2NhbGUgKz0gZGlmZjsKCQl0aGlzLl9mb250Q2hhbmdlKHRoaXMuX3NpemUrMSk7Cgl9IGVsc2UgaWYgKHMgPCB0aGlzLl9zY2FsZSAtIGRpZmYpIHsKCQl0aGlzLl9zY2FsZSAtPSBkaWZmOwoJCXRoaXMuX2ZvbnRDaGFuZ2UodGhpcy5fc2l6ZS0xKTsKCX0KfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5fZ2VzdHVyZUVuZCA9IGZ1bmN0aW9uKGUpIHsKCXRoaXMuX3NjYWxlID0gMTsKfQoKUHJlc2VudGF0aW9uLnByb3RvdHlwZS5fdG91Y2hTdGFydCA9IGZ1bmN0aW9uKGUpIHsKCXRoaXMuX3RvdWNoU3RhcnRUaW1lID0gRGF0ZS5ub3coKTsKCXRoaXMuX3RvdWNoWCA9IGUudG91Y2hlc1swXS5jbGllbnRYOwp9CgpQcmVzZW50YXRpb24ucHJvdG90eXBlLl90b3VjaEVuZCA9IGZ1bmN0aW9uKGUpIHsKCXZhciB0MiA9IERhdGUubm93KCk7Cgl2YXIgZGlmZiA9IHQyLXRoaXMuX3RvdWNoU3RhcnRUaW1lOwoJdGhpcy5fdG91Y2hTdGFydFRpbWUgPSAwOwoJaWYgKGRpZmYgPCAyMDApIHsKCQlpZiAodGhpcy5fdG91Y2hYID4gT1ouRE9NLndpbigpWzBdLzIpIHsgCgkJCXRoaXMuX2dvTmV4dCgpOwoJCX0gZWxzZSB7CgkJCXRoaXMuX2dvUHJldigpOwoJCX0KCX0KfQoKdmFyIFNsaWRlID0gT1ouQ2xhc3MoKTsKU2xpZGUucHJvdG90eXBlLl9wcmVmaXhlcyA9IFsiIiwgIk1veiIsICJXZWJraXQiLCAiTyIsICJtcyJdOwoKU2xpZGUucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihwcmVzZW50YXRpb24sIGVsbSkgewoJdGhpcy5fcHJlc2VudGF0aW9uID0gcHJlc2VudGF0aW9uOwoJdGhpcy5fZWxtID0gZWxtOwoJdGhpcy5faGlkZGVuQ2xhc3MgPSAiIjsKCgl0aGlzLl9zZWN0aW9ucyA9IFtdOyAvKiBwb2RjYXN0aSAqLwoJdGhpcy5faW5kZXggPSAtMTsgLyoga29saWthdGEgcG9kY2FzdCBqZSBha3R1YWxuaSAqLwoJCgl0aGlzLl9maW5kU2VjdGlvbnMoZWxtKTsKfQoKU2xpZGUucHJvdG90eXBlLmdldENvbnRhaW5lciA9IGZ1bmN0aW9uKCkgewoJcmV0dXJuIHRoaXMuX2VsbTsKfQoKU2xpZGUucHJvdG90eXBlLl9maW5kU2VjdGlvbnMgPSBmdW5jdGlvbihub2RlKSB7Cgl2YXIgaGFzU2VjdGlvbnMgPSBPWi5ET00uaGFzQ2xhc3Mobm9kZSwgInNlY3Rpb25zIik7CglPWi5ET00ucmVtb3ZlQ2xhc3Mobm9kZSwgInNlY3Rpb25zIik7CgkKCXZhciBjaGlsZHJlbiA9IG5vZGUuY2hpbGROb2RlczsKCXZhciBjaGlsZEVsZW1lbnRzID0gW107Cglmb3IgKHZhciBpPTA7aTxjaGlsZHJlbi5sZW5ndGg7aSsrKSB7CgkJdmFyIGNoaWxkID0gY2hpbGRyZW5baV07CgkJaWYgKGNoaWxkLm5vZGVUeXBlID09IDEpIHsgCgkJCWNoaWxkRWxlbWVudHMucHVzaChjaGlsZCk7CgkJCWlmIChoYXNTZWN0aW9ucykgeyBPWi5ET00uYWRkQ2xhc3MoY2hpbGQsICJzZWN0aW9uIik7IH0KCQl9Cgl9CgkKCWlmIChPWi5ET00uaGFzQ2xhc3Mobm9kZSwgInNlY3Rpb24iKSkgeyAKCQl0aGlzLl9zZWN0aW9ucy5wdXNoKG5vZGUpOyAKCQlPWi5ET00uYWRkQ2xhc3Mobm9kZSwgImFmdGVyIik7Cgl9Cglmb3IgKHZhciBpPTA7aTxjaGlsZEVsZW1lbnRzLmxlbmd0aDtpKyspIHsKCQl0aGlzLl9maW5kU2VjdGlvbnMoY2hpbGRFbGVtZW50c1tpXSk7Cgl9Cn0KClNsaWRlLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oY2xhc3NOYW1lKSB7CglpZiAoY2xhc3NOYW1lID09IHRoaXMuX2hpZGRlbkNsYXNzKSB7IHJldHVybjsgfQoJaWYgKHRoaXMuX2hpZGRlbkNsYXNzKSB7IE9aLkRPTS5yZW1vdmVDbGFzcyh0aGlzLl9lbG0sIHRoaXMuX2hpZGRlbkNsYXNzKTsgfQoJCgl0aGlzLl9oaWRkZW5DbGFzcyA9IGNsYXNzTmFtZTsKCglPWi5ET00ucmVtb3ZlQ2xhc3ModGhpcy5fZWxtLCAiY3VycmVudCIpOwoJT1ouRE9NLmFkZENsYXNzKHRoaXMuX2VsbSwgdGhpcy5faGlkZGVuQ2xhc3MpOwoKCXRoaXMuZGlzcGF0Y2goInNsaWRlLWhpZGUiKTsKfQoKU2xpZGUucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbihleHBhbmRBbGwpIHsKCU9aLkRPTS5yZW1vdmVDbGFzcyh0aGlzLl9lbG0sIHRoaXMuX2hpZGRlbkNsYXNzKTsKCXRoaXMuX2hpZGRlbkNsYXNzID0gIiI7CglPWi5ET00uYWRkQ2xhc3ModGhpcy5fZWxtLCAiY3VycmVudCIpOwoKCXRoaXMuX2luZGV4ID0gKGV4cGFuZEFsbCA/IHRoaXMuX3NlY3Rpb25zLmxlbmd0aC0xIDogMCk7CgoJZm9yICh2YXIgaT0wO2k8dGhpcy5fc2VjdGlvbnMubGVuZ3RoO2krKykgewoJCXZhciBub2RlID0gdGhpcy5fc2VjdGlvbnNbaV07CgkJaWYgKGkgPT0gdGhpcy5faW5kZXgpIHsgCgkJCU9aLkRPTS5hZGRDbGFzcyhub2RlLCAiY3VycmVudCIpOyAKCQkJT1ouRE9NLnJlbW92ZUNsYXNzKG5vZGUsICJhZnRlciIpOyAKCQkJT1ouRE9NLnJlbW92ZUNsYXNzKG5vZGUsICJiZWZvcmUiKTsgCgkJfSBlbHNlIHsKCQkJT1ouRE9NLnJlbW92ZUNsYXNzKG5vZGUsICJjdXJyZW50Iik7IAoJCQlpZiAoaSA8IHRoaXMuX2luZGV4KSB7CgkJCQlPWi5ET00ucmVtb3ZlQ2xhc3Mobm9kZSwgImFmdGVyIik7CgkJCQlPWi5ET00uYWRkQ2xhc3Mobm9kZSwgImJlZm9yZSIpOwoJCQl9IGVsc2UgewoJCQkJT1ouRE9NLnJlbW92ZUNsYXNzKG5vZGUsICJiZWZvcmUiKTsKCQkJCU9aLkRPTS5hZGRDbGFzcyhub2RlLCAiYWZ0ZXIiKTsKCQkJfQoJCX0KCX0KCQoJdGhpcy5kaXNwYXRjaCgic2xpZGUtc2hvdyIpOwp9CgpTbGlkZS5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uKCkgewoJaWYgKHRoaXMuX2luZGV4KzEgPj0gdGhpcy5fc2VjdGlvbnMubGVuZ3RoKSB7IHJldHVybiBmYWxzZTsgfQoKCU9aLkRPTS5yZW1vdmVDbGFzcyh0aGlzLl9zZWN0aW9uc1t0aGlzLl9pbmRleF0sICJjdXJyZW50Iik7CglPWi5ET00uYWRkQ2xhc3ModGhpcy5fc2VjdGlvbnNbdGhpcy5faW5kZXhdLCAiYmVmb3JlIik7Cgl0aGlzLl9pbmRleCsrOwoJT1ouRE9NLnJlbW92ZUNsYXNzKHRoaXMuX3NlY3Rpb25zW3RoaXMuX2luZGV4XSwgImFmdGVyIik7CglPWi5ET00uYWRkQ2xhc3ModGhpcy5fc2VjdGlvbnNbdGhpcy5faW5kZXhdLCAiY3VycmVudCIpOwoJCglyZXR1cm4gdHJ1ZTsKfQoKU2xpZGUucHJvdG90eXBlLnByZXYgPSBmdW5jdGlvbigpIHsKCWlmICh0aGlzLl9pbmRleCA8PSAwKSB7IHJldHVybiBmYWxzZTsgfQoKCU9aLkRPTS5yZW1vdmVDbGFzcyh0aGlzLl9zZWN0aW9uc1t0aGlzLl9pbmRleF0sICJjdXJyZW50Iik7CglPWi5ET00uYWRkQ2xhc3ModGhpcy5fc2VjdGlvbnNbdGhpcy5faW5kZXhdLCAiYWZ0ZXIiKTsKCXRoaXMuX2luZGV4LS07CglPWi5ET00ucmVtb3ZlQ2xhc3ModGhpcy5fc2VjdGlvbnNbdGhpcy5faW5kZXhdLCAiYmVmb3JlIik7CglPWi5ET00uYWRkQ2xhc3ModGhpcy5fc2VjdGlvbnNbdGhpcy5faW5kZXhdLCAiY3VycmVudCIpOwoJCglyZXR1cm4gdHJ1ZTsKfQoKU2xpZGUucHJvdG90eXBlLmJlZ2luT3ZlcnZpZXcgPSBmdW5jdGlvbihzY2FsZSwgeCwgeSkgewoJeCA9IE1hdGgucm91bmQoeCoxMDApICsgIiUiOwoJeSA9IE1hdGgucm91bmQoeSoxMDApICsgIiUiOwoJdGhpcy5fY3NzM3Byb3AoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoIiArIHNjYWxlICsgIikgdHJhbnNsYXRlKCIgKyB4ICsgIiwgIiArIHkgKyAiKSIpOwoJCgl2YXIgYm9yZGVyID0gT1ouU3R5bGUuZ2V0KHRoaXMuX2VsbSwgImJvcmRlckxlZnRXaWR0aCIpOwoJYm9yZGVyID0gcGFyc2VJbnQoYm9yZGVyKSB8fCAwOwoJYm9yZGVyID0gTWF0aC5yb3VuZChib3JkZXIvc2NhbGUpOwoJdGhpcy5fZWxtLnN0eWxlLmJvcmRlcldpZHRoID0gYm9yZGVyKyJweCI7CgkKCXRoaXMuX2V2ZW50ID0gT1ouRXZlbnQuYWRkKHRoaXMuX2VsbSwgImNsaWNrIiwgdGhpcy5fY2xpY2suYmluZCh0aGlzKSk7Cn0KClNsaWRlLnByb3RvdHlwZS5lbmRPdmVydmlldyA9IGZ1bmN0aW9uKHNjYWxlLCB4LCB5KSB7Cgl0aGlzLl9jc3MzcHJvcCgidHJhbnNmb3JtIiwgIiIpOwoJdGhpcy5fZWxtLnN0eWxlLmJvcmRlcldpZHRoID0gIiI7CglPWi5FdmVudC5yZW1vdmUodGhpcy5fZXZlbnQpOwp9CgpTbGlkZS5wcm90b3R5cGUuX2NzczNwcm9wID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKCWZvciAodmFyIGk9MDtpPHRoaXMuX3ByZWZpeGVzLmxlbmd0aDtpKyspIHsKCQl2YXIgbiA9IHRoaXMuX3ByZWZpeGVzW2ldOwoJCWlmIChuKSB7CgkJCW4gKz0gbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWUuc3Vic3RyaW5nKDEpOwoJCX0gZWxzZSB7CgkJCW4gKz0gbmFtZTsKCQl9CgkJdGhpcy5fZWxtLnN0eWxlW25dID0gdmFsdWU7Cgl9Cn0KClNsaWRlLnByb3RvdHlwZS5fY2xpY2sgPSBmdW5jdGlvbihlKSB7Cgl0aGlzLl9wcmVzZW50YXRpb24uZ29TbGlkZSh0aGlzKTsKfQo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 07:48:14 GMT",
                    "Content-Length": "10817",
                    "Date": "Fri, 07 Nov 2014 07:48:17 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}