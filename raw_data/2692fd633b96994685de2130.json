{
    "url": "http://localhost:9999/MinnPost/minnpost-styles/bower_components/StoryMapJS/source/embed/",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.search</b> and written to <b>the 'open()' function of an XMLHttpRequest object</b> via the following statements:<ul><li>var qs = window.location.search.replace('?', '');</li><li>var pairs = qs.split('&amp;');</li><li>var p = pairs[i].split('=');</li><li>nvpair[p[0]] = p[1];</li><li>return nvpair;</li><li>var params = parseQuerystring();</li><li>var storymap_url = decodeURIComponent(params['url']);</li><li>xdr.open(\"get\", storymap_url);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/MinnPost/minnpost-styles/bower_components/StoryMapJS/source/embed/",
                "path": "/MinnPost/minnpost-styles/bower_components/StoryMapJS/source/embed/",
                "httpVersion": "HTTP/0.0",
                "method": "GET",
                "headers": {
                    "Referer": "http://localhost:9999/MinnPost/minnpost-styles/bower_components/StoryMapJS/source/embed",
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9NaW5uUG9zdC9taW5ucG9zdC1zdHlsZXMvYm93ZXJfY29tcG9uZW50cy9TdG9yeU1hcEpTL3NvdXJjZS9lbWJlZC8gSFRUUC8wLjANCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQpSZWZlcmVyOiBodHRwOi8vbG9jYWxob3N0Ojk5OTkvTWlublBvc3QvbWlubnBvc3Qtc3R5bGVzL2Jvd2VyX2NvbXBvbmVudHMvU3RvcnlNYXBKUy9zb3VyY2UvZW1iZWQNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNjQ2Mg0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogdGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04DQpEYXRlOiBGcmksIDA3IE5vdiAyMDE0IDE2OjA5OjQ3IEdNVA0KTGFzdC1Nb2RpZmllZDogRnJpLCAwNyBOb3YgMjAxNCAxNjowOTo0NiBHTVQNCg0KPCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+Cjx0aXRsZT5TdG9yeU1hcEpTIEVtYmVkPC90aXRsZT4KPG1ldGEgY2hhcnNldD0idXRmLTgiPgo8bWV0YSBuYW1lPSJkZXNjcmlwdGlvbiIgY29udGVudD0iU3RvcnlNYXBKUyBFbWJlZCI+CjxtZXRhIG5hbWU9ImFwcGxlLW1vYmlsZS13ZWItYXBwLWNhcGFibGUiIGNvbnRlbnQ9InllcyI+CjxtZXRhIG5hbWU9ImFwcGxlLXRvdWNoLWZ1bGxzY3JlZW4iIGNvbnRlbnQ9InllcyI+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCI+CjwhLS0gYnVpbGQ6Y3NzIC4uL2Nzcy9zdG9yeW1hcC5jc3MgLS0+CjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iL2J1aWxkL2Nzcy9zdG9yeW1hcC5jc3MiPgo8IS0tIGVuZGJ1aWxkIC0tPgo8IS0tIGJ1aWxkOmpzIC4uL2pzL3N0b3J5bWFwLW1pbi5qcyAtLT4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iL2J1aWxkL2pzL3N0b3J5bWFwLmpzIj48L3NjcmlwdD4KPCEtLSBlbmRidWlsZCAtLT4KPHN0eWxlPgpodG1sLCBib2R5IHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMDAlOwogICAgcGFkZGluZzogMDsKICAgIG1hcmdpbjogMDsKfQo8L3N0eWxlPgo8IS0tIEhUTUw1IHNoaW0sIGZvciBJRTYtOCBzdXBwb3J0IG9mIEhUTUwgZWxlbWVudHMtLT48IS0tW2lmIGx0IElFIDldPgo8c2NyaXB0IHNyYz0iLy9odG1sNXNoaW0uZ29vZ2xlY29kZS5jb20vc3ZuL3RydW5rL2h0bWw1LmpzIj48L3NjcmlwdD48IVtlbmRpZl0tLT4KPC9oZWFkPgo8Ym9keT4KPGRpdiBpZD0ic3RvcnltYXAtZW1iZWQiPjwvZGl2PgoKPCEtLSBHb29nbGUgQW5hbHl0aWNzOiBkb24ndCBtZXNzIHdpdGggdGhpcyBzdHVmZiAtLT4KPCEtLSBuYW1lZCB0cmFja2VyIG5vdGVzIGZyb20gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYW5hbHl0aWNzL2Rldmd1aWRlcy9jb2xsZWN0aW9uL2dhanMvIC0tPgo8IS0tIG11bHRpLWRvbWFpbiB0cmFja2luZyBub3RlcyBmcm9tIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2FuYWx5dGljcy9kZXZndWlkZXMvY29sbGVjdGlvbi9nYWpzL2dhVHJhY2tpbmdTaXRlIC0tPgo8c2NyaXB0PgogIChmdW5jdGlvbihpLHMsbyxnLHIsYSxtKXtpWydHb29nbGVBbmFseXRpY3NPYmplY3QnXT1yO2lbcl09aVtyXXx8ZnVuY3Rpb24oKXsKICAoaVtyXS5xPWlbcl0ucXx8W10pLnB1c2goYXJndW1lbnRzKX0saVtyXS5sPTEqbmV3IERhdGUoKTthPXMuY3JlYXRlRWxlbWVudChvKSwKICBtPXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUobylbMF07YS5hc3luYz0xO2Euc3JjPWc7bS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLG0pCiAgfSkod2luZG93LGRvY3VtZW50LCdzY3JpcHQnLCcvL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9hbmFseXRpY3MuanMnLCdnYScpOwoKICBnYSgnY3JlYXRlJywgJ1VBLTI3ODI5ODAyLTInLCAna25pZ2h0bGFiLmNvbScpOyAvKiBTdG9yeU1hcCBFbWJlZCBhbmFseXRpY3Mgb25seS4gTm90IEtuaWdodExhYiBicm9hZGx5ICovCiAgZ2EoJ3NlbmQnLCAncGFnZXZpZXcnKTsKICBnYSgnc2VuZCcsICdldmVudCcsICdTdG9yeU1hcEpTJywgJ0VtYmVkZGVkSW4nLCBkb2N1bWVudC5yZWZlcnJlcikKCjwvc2NyaXB0Pgo8IS0tIEVuZCBHb29nbGUgQW5hbHl0aWNzIC0tPgoKPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoKZnVuY3Rpb24gcGFyc2VRdWVyeXN0cmluZygpIHsKICAgIHZhciBudnBhaXIgPSB7fTsKICAgIHZhciBxcyA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gucmVwbGFjZSgnPycsICcnKTsKICAgIHZhciBwYWlycyA9IHFzLnNwbGl0KCcmJyk7CiAgICAKICAgIGZvcih2YXIgaSA9IDA7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBwID0gcGFpcnNbaV0uc3BsaXQoJz0nKTsKICAgICAgICBudnBhaXJbcFswXV0gPSBwWzFdOwogICAgfQogICAgcmV0dXJuIG52cGFpcjsKfQoKZnVuY3Rpb24gZ2V0U2NyaXB0UGF0aChzY3JpcHRuYW1lKSB7CiAgICB2YXIgc2NyaXB0VGFncyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKTsKICAgIAoJZm9yKHZhciBpID0gMDsgaSA8IHNjcmlwdFRhZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZihzY3JpcHRUYWdzW2ldLnNyYy5tYXRjaChzY3JpcHRuYW1lKSkgewogICAgICAgICAgICBzY3JpcHRfcGF0aCA9IHNjcmlwdFRhZ3NbaV0uc3JjOyAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc2NyaXB0X3BhdGguc3BsaXQoJz8nKVswXS5zcGxpdCgnLycpLnNsaWNlKDAsIC0xKS5qb2luKCcvJyk7CiAgICAgICAgfQoJfQoJcmV0dXJuICcnOwp9CgpmdW5jdGlvbiB1cmxfam9pbih1cmwsIGNvbmNhdCkgeyAvLyBzZWUgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yNjc2MTc4L2pvaW5pbmctcmVsYXRpdmUtdXJscwogICAgZnVuY3Rpb24gYnVpbGQocGFydHMsY29udGFpbmVyKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBwYXJ0cy5sZW5ndGg7IGkgPCBsOyBpICsrKSB7CiAgICAgICAgICAgIGlmIChwYXJ0c1tpXSA9PSAnLi4nKSB7CiAgICAgICAgICAgICAgICBjb250YWluZXIucG9wKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydHNbaV0gPT0gJy4nKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5wdXNoKHBhcnRzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHZhciB1cmxfcGFydHMgPSBbIF07CiAgICBidWlsZCh1cmwuc3BsaXQoJy8nKSx1cmxfcGFydHMpOwogICAgYnVpbGQoY29uY2F0LnNwbGl0KCcvJyksdXJsX3BhcnRzKTsKICAgIHJldHVybiB1cmxfcGFydHMuam9pbignLycpOwp9CgoKdmFyIHN0b3J5bWFwID0gbnVsbDsKCnZhciBwYXJhbXMgPSBwYXJzZVF1ZXJ5c3RyaW5nKCk7CnZhciBzdG9yeW1hcF91cmwgPSBkZWNvZGVVUklDb21wb25lbnQocGFyYW1zWyd1cmwnXSk7Cgp2YXIgb3B0aW9ucyA9IHsKICAgIHNjcmlwdF9wYXRoOiBnZXRTY3JpcHRQYXRoKC9zdG9yeW1hcCgtbWluKT9cLmpzLyksCiAgICBzdGFydF9hdF9zbGlkZTogMCwKICAgIHNob3dfbGluZXM6IHRydWUKfTsKCmlmKHBhcmFtcy5oYXNPd25Qcm9wZXJ0eSgnc3RhcnRfYXRfc2xpZGUnKSkgewogICAgb3B0aW9ucy5zdGFydF9hdF9zbGlkZSA9IHBhcnNlSW50KHBhcmFtcy5zdGFydF9hdF9zbGlkZSk7Cn0KCmZ1bmN0aW9uIHN0b3J5bWFwX29ubG9hZChkKSB7CiAgICB0cmFjZSgnZW1iZWQ6IHN0b3J5bWFwIGRhdGEgbG9hZGVkJyk7CgogICAgaWYgKGQgJiYgZC5zdG9yeW1hcCkgewogICAgICAgIGlmKGQuc3RvcnltYXAubWFwX3R5cGUpIHsKICAgICAgICAgICAgb3B0aW9ucy5tYXBfdHlwZSA9IGQuc3RvcnltYXAubWFwX3R5cGU7CiAgICAgICAgfQogICAgICAgIGlmKGQuc3RvcnltYXAubWFwX3N1YmRvbWFpbnMpIHsKICAgICAgICAgICAgb3B0aW9ucy5tYXBfc3ViZG9tYWlucyA9IGQuc3RvcnltYXAubWFwX3N1YmRvbWFpbnM7CiAgICAgICAgfQogICAgICAgIGlmKGQuc3RvcnltYXAubWFwX2FzX2ltYWdlKSB7CiAgICAgICAgICAgIG9wdGlvbnMubWFwX2FzX2ltYWdlID0gZC5zdG9yeW1hcC5tYXBfYXNfaW1hZ2U7ICAgICAgIAogICAgICAgIH0KICAgICAgICBpZihkLnN0b3J5bWFwLm1hcF9iYWNrZ3JvdW5kX2NvbG9yKSB7CiAgICAgICAgICAgIG9wdGlvbnMubWFwX2JhY2tncm91bmRfY29sb3IgPSBkLnN0b3J5bWFwLm1hcF9iYWNrZ3JvdW5kX2NvbG9yOwogICAgICAgIH0KICAgICAgICBpZihkLnN0b3J5bWFwLmxhbmd1YWdlKSB7CiAgICAgICAgICAgIG9wdGlvbnMubGFuZ3VhZ2UgPSBkLnN0b3J5bWFwLmxhbmd1YWdlOwogICAgICAgIH0KICAgICAgICBpZihkLnN0b3J5bWFwLmhhc093blByb3BlcnR5KCdzaG93X2xpbmVzJykpIHsKICAgICAgICAgICAgb3B0aW9ucy5zaG93X2xpbmVzID0gZC5zdG9yeW1hcC5zaG93X2xpbmVzOwogICAgICAgIH0KICAgICAgICBpZihkLnN0b3J5bWFwLnpvb21pZnkpIHsKICAgICAgICAgICAgb3B0aW9ucy56b29taWZ5ID0gZC5zdG9yeW1hcC56b29taWZ5OwogICAgICAgIH0KCiAgICAgICAgdmFyIGZvbnQgPSAic3RvY2s6ZGVmYXVsdCI7CiAgICAgICAgaWYoZC5mb250X2NzcykgewogICAgICAgICAgICBmb250ID0gZC5mb250X2NzczsKICAgICAgICB9CiAgICAgICAgaWYoZm9udC5pbmRleE9mKCJzdG9jazoiKSA9PSAwKSB7CiAgICAgICAgICAgIHZhciBmb250X25hbWUgPSBmb250LnNwbGl0KCc6JylbMV07CiAgICAgICAgICAgIHZhciBiYXNlX3VybCA9IHVybF9qb2luKG9wdGlvbnMuc2NyaXB0X3BhdGgsIi4uL2Nzcy9mb250cyIpOwogICAgICAgICAgICBmb250ID0gdXJsX2pvaW4oYmFzZV91cmwsICJmb250LiIgKyBmb250X25hbWUgKyAiLmNzcyIpOwogICAgICAgIH0gZWxzZSBpZighZm9udC5tYXRjaCgnXihodHRwfGh0dHBzfC8vKScpKSB7CiAgICAgICAgICAgIGZvbnQgPSB1cmxfam9pbihvcHRpb25zLnNjcmlwdF9wYXRoLCBmb250KTsKICAgICAgICB9CiAgICAgICAgVkNPLkxvYWQuY3NzKGZvbnQsZnVuY3Rpb24oKXsgdHJhY2UoJ2ZvbnQgbG9hZGVkOiAnICsgZm9udCk7fSk7CiAgICAgICAgc3RvcnltYXAgPSBuZXcgVkNPLlN0b3J5TWFwKCdzdG9yeW1hcC1lbWJlZCcsIGQsIG9wdGlvbnMpOwogICAgfQp9CgpmdW5jdGlvbiBzdG9yeW1hcF9nZXRqc29uKCkgewogICAgaWYoJ3dpdGhDcmVkZW50aWFscycgaW4gbmV3IFhNTEh0dHBSZXF1ZXN0KCkpIHsKICAgICAgICAvLyBTdXBwb3J0cyBjcm9zcy1kb21haW4gcmVxdWVzdHMKICAgICAgICB0cmFjZSgnZW1iZWQ6IGxvYWRpbmcgZGF0YSB2aWEgWE1MSHR0cFJlcXVlc3QnKTsKICAgICAgICBWQ08uZ2V0SlNPTihzdG9yeW1hcF91cmwsIHN0b3J5bWFwX29ubG9hZCk7CiAgICB9IGVsc2UgaWYodHlwZW9mIFhEb21haW5SZXF1ZXN0ICE9PSAidW5kZWZpbmVkIikgICAgIHsKICAgICAgICAvLyBVc2UgSUUtc3BlY2lmaWMgIkNPUlMiIGNvZGUgd2l0aCBYRFIKICAgICAgICB0cmFjZSgnZW1iZWQ6IGxvYWRpbmcgZGF0YSB2aWEgWERvbWFpblJlcXVlc3QnKTsKICAgICAgICB2YXIgeGRyID0gbmV3IFhEb21haW5SZXF1ZXN0KCk7CiAgICAgICAgeGRyLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBzdG9yeW1hcF9vbmxvYWQoSlNPTi5wYXJzZSh4ZHIucmVzcG9uc2VUZXh0KSk7CiAgICAgICAgfTsKICAgICAgICB4ZHIub25lcnJvciA9IGZ1bmN0aW9uKCkgeyAvKiBkb2l0ICovIH07CiAgICAgICAgeGRyLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbigpIHt9OwogICAgICAgIHhkci5vcGVuKCJnZXQiLCBzdG9yeW1hcF91cmwpOwogICAgICAgIHhkci5zZW5kKCk7CiAgICB9Cn0KCndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgIGlmKHN0b3J5bWFwX3VybC5tYXRjaCgnXFwuanMkJykpIHsgICAgICAgIAogICAgICAgIHRyYWNlKCdlbWJlZDogbG9hZGluZyBkYXRhIHZpYSBzY3JpcHQgaW5qZWN0aW9uJyk7CiAgICAgICAgdmFyIGxvYWRlZCA9IGZhbHNlOyAgCiAgICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgIHNjcmlwdC50eXBlID0gInRleHQvamF2YXNjcmlwdCI7CiAgICAgICAgc2NyaXB0LnNyYyAgPSBzdG9yeW1hcF91cmw7ICAgIAogICAgICAgIHNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmKCFsb2FkZWQgJiYgKCEoZCA9IHRoaXMucmVhZHlTdGF0ZSkgfHwgZCA9PSAibG9hZGVkIiB8fCBkID09ICJjb21wbGV0ZSIpKSB7CiAgICAgICAgICAgICAgICBsb2FkZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RvcnltYXBfb25sb2FkKHN0b3J5bWFwX2pzb24pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgCiAgICAgICAgLy8gZG9jdW1lbnQuaGVhZCBub3Qgc3RhbmRhcmQgYmVmb3JlIEhUTUw1CiAgICAgICAgdmFyIGluc2VydGlvblBvaW50ID0gZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpLml0ZW0oMCkgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXNbMF07CiAgICAgICAgaW5zZXJ0aW9uUG9pbnQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgIH0gZWxzZSB7ICAgIAogICAgICAgIHN0b3J5bWFwX2dldGpzb24oKTsgCiAgICB9Cn0KCndpbmRvdy5vbnJlc2l6ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBpZihzdG9yeW1hcCkgewogICAgICAgIHN0b3J5bWFwLnVwZGF0ZURpc3BsYXkoKTsKICAgIH0KfQo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+",
                "body": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+Cjx0aXRsZT5TdG9yeU1hcEpTIEVtYmVkPC90aXRsZT4KPG1ldGEgY2hhcnNldD0idXRmLTgiPgo8bWV0YSBuYW1lPSJkZXNjcmlwdGlvbiIgY29udGVudD0iU3RvcnlNYXBKUyBFbWJlZCI+CjxtZXRhIG5hbWU9ImFwcGxlLW1vYmlsZS13ZWItYXBwLWNhcGFibGUiIGNvbnRlbnQ9InllcyI+CjxtZXRhIG5hbWU9ImFwcGxlLXRvdWNoLWZ1bGxzY3JlZW4iIGNvbnRlbnQ9InllcyI+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCI+CjwhLS0gYnVpbGQ6Y3NzIC4uL2Nzcy9zdG9yeW1hcC5jc3MgLS0+CjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iL2J1aWxkL2Nzcy9zdG9yeW1hcC5jc3MiPgo8IS0tIGVuZGJ1aWxkIC0tPgo8IS0tIGJ1aWxkOmpzIC4uL2pzL3N0b3J5bWFwLW1pbi5qcyAtLT4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iL2J1aWxkL2pzL3N0b3J5bWFwLmpzIj48L3NjcmlwdD4KPCEtLSBlbmRidWlsZCAtLT4KPHN0eWxlPgpodG1sLCBib2R5IHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMDAlOwogICAgcGFkZGluZzogMDsKICAgIG1hcmdpbjogMDsKfQo8L3N0eWxlPgo8IS0tIEhUTUw1IHNoaW0sIGZvciBJRTYtOCBzdXBwb3J0IG9mIEhUTUwgZWxlbWVudHMtLT48IS0tW2lmIGx0IElFIDldPgo8c2NyaXB0IHNyYz0iLy9odG1sNXNoaW0uZ29vZ2xlY29kZS5jb20vc3ZuL3RydW5rL2h0bWw1LmpzIj48L3NjcmlwdD48IVtlbmRpZl0tLT4KPC9oZWFkPgo8Ym9keT4KPGRpdiBpZD0ic3RvcnltYXAtZW1iZWQiPjwvZGl2PgoKPCEtLSBHb29nbGUgQW5hbHl0aWNzOiBkb24ndCBtZXNzIHdpdGggdGhpcyBzdHVmZiAtLT4KPCEtLSBuYW1lZCB0cmFja2VyIG5vdGVzIGZyb20gaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYW5hbHl0aWNzL2Rldmd1aWRlcy9jb2xsZWN0aW9uL2dhanMvIC0tPgo8IS0tIG11bHRpLWRvbWFpbiB0cmFja2luZyBub3RlcyBmcm9tIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2FuYWx5dGljcy9kZXZndWlkZXMvY29sbGVjdGlvbi9nYWpzL2dhVHJhY2tpbmdTaXRlIC0tPgo8c2NyaXB0PgogIChmdW5jdGlvbihpLHMsbyxnLHIsYSxtKXtpWydHb29nbGVBbmFseXRpY3NPYmplY3QnXT1yO2lbcl09aVtyXXx8ZnVuY3Rpb24oKXsKICAoaVtyXS5xPWlbcl0ucXx8W10pLnB1c2goYXJndW1lbnRzKX0saVtyXS5sPTEqbmV3IERhdGUoKTthPXMuY3JlYXRlRWxlbWVudChvKSwKICBtPXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUobylbMF07YS5hc3luYz0xO2Euc3JjPWc7bS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLG0pCiAgfSkod2luZG93LGRvY3VtZW50LCdzY3JpcHQnLCcvL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9hbmFseXRpY3MuanMnLCdnYScpOwoKICBnYSgnY3JlYXRlJywgJ1VBLTI3ODI5ODAyLTInLCAna25pZ2h0bGFiLmNvbScpOyAvKiBTdG9yeU1hcCBFbWJlZCBhbmFseXRpY3Mgb25seS4gTm90IEtuaWdodExhYiBicm9hZGx5ICovCiAgZ2EoJ3NlbmQnLCAncGFnZXZpZXcnKTsKICBnYSgnc2VuZCcsICdldmVudCcsICdTdG9yeU1hcEpTJywgJ0VtYmVkZGVkSW4nLCBkb2N1bWVudC5yZWZlcnJlcikKCjwvc2NyaXB0Pgo8IS0tIEVuZCBHb29nbGUgQW5hbHl0aWNzIC0tPgoKPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoKZnVuY3Rpb24gcGFyc2VRdWVyeXN0cmluZygpIHsKICAgIHZhciBudnBhaXIgPSB7fTsKICAgIHZhciBxcyA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gucmVwbGFjZSgnPycsICcnKTsKICAgIHZhciBwYWlycyA9IHFzLnNwbGl0KCcmJyk7CiAgICAKICAgIGZvcih2YXIgaSA9IDA7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBwID0gcGFpcnNbaV0uc3BsaXQoJz0nKTsKICAgICAgICBudnBhaXJbcFswXV0gPSBwWzFdOwogICAgfQogICAgcmV0dXJuIG52cGFpcjsKfQoKZnVuY3Rpb24gZ2V0U2NyaXB0UGF0aChzY3JpcHRuYW1lKSB7CiAgICB2YXIgc2NyaXB0VGFncyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKTsKICAgIAoJZm9yKHZhciBpID0gMDsgaSA8IHNjcmlwdFRhZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZihzY3JpcHRUYWdzW2ldLnNyYy5tYXRjaChzY3JpcHRuYW1lKSkgewogICAgICAgICAgICBzY3JpcHRfcGF0aCA9IHNjcmlwdFRhZ3NbaV0uc3JjOyAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc2NyaXB0X3BhdGguc3BsaXQoJz8nKVswXS5zcGxpdCgnLycpLnNsaWNlKDAsIC0xKS5qb2luKCcvJyk7CiAgICAgICAgfQoJfQoJcmV0dXJuICcnOwp9CgpmdW5jdGlvbiB1cmxfam9pbih1cmwsIGNvbmNhdCkgeyAvLyBzZWUgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yNjc2MTc4L2pvaW5pbmctcmVsYXRpdmUtdXJscwogICAgZnVuY3Rpb24gYnVpbGQocGFydHMsY29udGFpbmVyKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBwYXJ0cy5sZW5ndGg7IGkgPCBsOyBpICsrKSB7CiAgICAgICAgICAgIGlmIChwYXJ0c1tpXSA9PSAnLi4nKSB7CiAgICAgICAgICAgICAgICBjb250YWluZXIucG9wKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydHNbaV0gPT0gJy4nKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5wdXNoKHBhcnRzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHZhciB1cmxfcGFydHMgPSBbIF07CiAgICBidWlsZCh1cmwuc3BsaXQoJy8nKSx1cmxfcGFydHMpOwogICAgYnVpbGQoY29uY2F0LnNwbGl0KCcvJyksdXJsX3BhcnRzKTsKICAgIHJldHVybiB1cmxfcGFydHMuam9pbignLycpOwp9CgoKdmFyIHN0b3J5bWFwID0gbnVsbDsKCnZhciBwYXJhbXMgPSBwYXJzZVF1ZXJ5c3RyaW5nKCk7CnZhciBzdG9yeW1hcF91cmwgPSBkZWNvZGVVUklDb21wb25lbnQocGFyYW1zWyd1cmwnXSk7Cgp2YXIgb3B0aW9ucyA9IHsKICAgIHNjcmlwdF9wYXRoOiBnZXRTY3JpcHRQYXRoKC9zdG9yeW1hcCgtbWluKT9cLmpzLyksCiAgICBzdGFydF9hdF9zbGlkZTogMCwKICAgIHNob3dfbGluZXM6IHRydWUKfTsKCmlmKHBhcmFtcy5oYXNPd25Qcm9wZXJ0eSgnc3RhcnRfYXRfc2xpZGUnKSkgewogICAgb3B0aW9ucy5zdGFydF9hdF9zbGlkZSA9IHBhcnNlSW50KHBhcmFtcy5zdGFydF9hdF9zbGlkZSk7Cn0KCmZ1bmN0aW9uIHN0b3J5bWFwX29ubG9hZChkKSB7CiAgICB0cmFjZSgnZW1iZWQ6IHN0b3J5bWFwIGRhdGEgbG9hZGVkJyk7CgogICAgaWYgKGQgJiYgZC5zdG9yeW1hcCkgewogICAgICAgIGlmKGQuc3RvcnltYXAubWFwX3R5cGUpIHsKICAgICAgICAgICAgb3B0aW9ucy5tYXBfdHlwZSA9IGQuc3RvcnltYXAubWFwX3R5cGU7CiAgICAgICAgfQogICAgICAgIGlmKGQuc3RvcnltYXAubWFwX3N1YmRvbWFpbnMpIHsKICAgICAgICAgICAgb3B0aW9ucy5tYXBfc3ViZG9tYWlucyA9IGQuc3RvcnltYXAubWFwX3N1YmRvbWFpbnM7CiAgICAgICAgfQogICAgICAgIGlmKGQuc3RvcnltYXAubWFwX2FzX2ltYWdlKSB7CiAgICAgICAgICAgIG9wdGlvbnMubWFwX2FzX2ltYWdlID0gZC5zdG9yeW1hcC5tYXBfYXNfaW1hZ2U7ICAgICAgIAogICAgICAgIH0KICAgICAgICBpZihkLnN0b3J5bWFwLm1hcF9iYWNrZ3JvdW5kX2NvbG9yKSB7CiAgICAgICAgICAgIG9wdGlvbnMubWFwX2JhY2tncm91bmRfY29sb3IgPSBkLnN0b3J5bWFwLm1hcF9iYWNrZ3JvdW5kX2NvbG9yOwogICAgICAgIH0KICAgICAgICBpZihkLnN0b3J5bWFwLmxhbmd1YWdlKSB7CiAgICAgICAgICAgIG9wdGlvbnMubGFuZ3VhZ2UgPSBkLnN0b3J5bWFwLmxhbmd1YWdlOwogICAgICAgIH0KICAgICAgICBpZihkLnN0b3J5bWFwLmhhc093blByb3BlcnR5KCdzaG93X2xpbmVzJykpIHsKICAgICAgICAgICAgb3B0aW9ucy5zaG93X2xpbmVzID0gZC5zdG9yeW1hcC5zaG93X2xpbmVzOwogICAgICAgIH0KICAgICAgICBpZihkLnN0b3J5bWFwLnpvb21pZnkpIHsKICAgICAgICAgICAgb3B0aW9ucy56b29taWZ5ID0gZC5zdG9yeW1hcC56b29taWZ5OwogICAgICAgIH0KCiAgICAgICAgdmFyIGZvbnQgPSAic3RvY2s6ZGVmYXVsdCI7CiAgICAgICAgaWYoZC5mb250X2NzcykgewogICAgICAgICAgICBmb250ID0gZC5mb250X2NzczsKICAgICAgICB9CiAgICAgICAgaWYoZm9udC5pbmRleE9mKCJzdG9jazoiKSA9PSAwKSB7CiAgICAgICAgICAgIHZhciBmb250X25hbWUgPSBmb250LnNwbGl0KCc6JylbMV07CiAgICAgICAgICAgIHZhciBiYXNlX3VybCA9IHVybF9qb2luKG9wdGlvbnMuc2NyaXB0X3BhdGgsIi4uL2Nzcy9mb250cyIpOwogICAgICAgICAgICBmb250ID0gdXJsX2pvaW4oYmFzZV91cmwsICJmb250LiIgKyBmb250X25hbWUgKyAiLmNzcyIpOwogICAgICAgIH0gZWxzZSBpZighZm9udC5tYXRjaCgnXihodHRwfGh0dHBzfC8vKScpKSB7CiAgICAgICAgICAgIGZvbnQgPSB1cmxfam9pbihvcHRpb25zLnNjcmlwdF9wYXRoLCBmb250KTsKICAgICAgICB9CiAgICAgICAgVkNPLkxvYWQuY3NzKGZvbnQsZnVuY3Rpb24oKXsgdHJhY2UoJ2ZvbnQgbG9hZGVkOiAnICsgZm9udCk7fSk7CiAgICAgICAgc3RvcnltYXAgPSBuZXcgVkNPLlN0b3J5TWFwKCdzdG9yeW1hcC1lbWJlZCcsIGQsIG9wdGlvbnMpOwogICAgfQp9CgpmdW5jdGlvbiBzdG9yeW1hcF9nZXRqc29uKCkgewogICAgaWYoJ3dpdGhDcmVkZW50aWFscycgaW4gbmV3IFhNTEh0dHBSZXF1ZXN0KCkpIHsKICAgICAgICAvLyBTdXBwb3J0cyBjcm9zcy1kb21haW4gcmVxdWVzdHMKICAgICAgICB0cmFjZSgnZW1iZWQ6IGxvYWRpbmcgZGF0YSB2aWEgWE1MSHR0cFJlcXVlc3QnKTsKICAgICAgICBWQ08uZ2V0SlNPTihzdG9yeW1hcF91cmwsIHN0b3J5bWFwX29ubG9hZCk7CiAgICB9IGVsc2UgaWYodHlwZW9mIFhEb21haW5SZXF1ZXN0ICE9PSAidW5kZWZpbmVkIikgICAgIHsKICAgICAgICAvLyBVc2UgSUUtc3BlY2lmaWMgIkNPUlMiIGNvZGUgd2l0aCBYRFIKICAgICAgICB0cmFjZSgnZW1iZWQ6IGxvYWRpbmcgZGF0YSB2aWEgWERvbWFpblJlcXVlc3QnKTsKICAgICAgICB2YXIgeGRyID0gbmV3IFhEb21haW5SZXF1ZXN0KCk7CiAgICAgICAgeGRyLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBzdG9yeW1hcF9vbmxvYWQoSlNPTi5wYXJzZSh4ZHIucmVzcG9uc2VUZXh0KSk7CiAgICAgICAgfTsKICAgICAgICB4ZHIub25lcnJvciA9IGZ1bmN0aW9uKCkgeyAvKiBkb2l0ICovIH07CiAgICAgICAgeGRyLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbigpIHt9OwogICAgICAgIHhkci5vcGVuKCJnZXQiLCBzdG9yeW1hcF91cmwpOwogICAgICAgIHhkci5zZW5kKCk7CiAgICB9Cn0KCndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgIGlmKHN0b3J5bWFwX3VybC5tYXRjaCgnXFwuanMkJykpIHsgICAgICAgIAogICAgICAgIHRyYWNlKCdlbWJlZDogbG9hZGluZyBkYXRhIHZpYSBzY3JpcHQgaW5qZWN0aW9uJyk7CiAgICAgICAgdmFyIGxvYWRlZCA9IGZhbHNlOyAgCiAgICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgIHNjcmlwdC50eXBlID0gInRleHQvamF2YXNjcmlwdCI7CiAgICAgICAgc2NyaXB0LnNyYyAgPSBzdG9yeW1hcF91cmw7ICAgIAogICAgICAgIHNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmKCFsb2FkZWQgJiYgKCEoZCA9IHRoaXMucmVhZHlTdGF0ZSkgfHwgZCA9PSAibG9hZGVkIiB8fCBkID09ICJjb21wbGV0ZSIpKSB7CiAgICAgICAgICAgICAgICBsb2FkZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RvcnltYXBfb25sb2FkKHN0b3J5bWFwX2pzb24pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgCiAgICAgICAgLy8gZG9jdW1lbnQuaGVhZCBub3Qgc3RhbmRhcmQgYmVmb3JlIEhUTUw1CiAgICAgICAgdmFyIGluc2VydGlvblBvaW50ID0gZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpLml0ZW0oMCkgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXNbMF07CiAgICAgICAgaW5zZXJ0aW9uUG9pbnQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgIH0gZWxzZSB7ICAgIAogICAgICAgIHN0b3J5bWFwX2dldGpzb24oKTsgCiAgICB9Cn0KCndpbmRvdy5vbnJlc2l6ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBpZihzdG9yeW1hcCkgewogICAgICAgIHN0b3J5bWFwLnVwZGF0ZURpc3BsYXkoKTsKICAgIH0KfQo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 16:09:46 GMT",
                    "Content-Length": "6462",
                    "Date": "Fri, 07 Nov 2014 16:09:47 GMT",
                    "Content-Type": "text/html; charset=utf-8"
                },
                "cookies": [],
                "mimeType": "HTML",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}