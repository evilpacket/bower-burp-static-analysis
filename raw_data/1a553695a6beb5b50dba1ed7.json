{
    "url": "http://localhost:9999/liuliu/ccv/js/",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>window.location.hash</b> and written to <b>the 'value' property of a DOM element</b> via the following statements:<ul><li>var url = window.location.hash.substr(1);</li><li>document.getElementById(\"url-image\").value = decodeURIComponent(url);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/liuliu/ccv/js/",
                "path": "/liuliu/ccv/js/",
                "httpVersion": "HTTP/0.0",
                "method": "GET",
                "headers": {
                    "Referer": "http://localhost:9999/liuliu/ccv/js",
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9saXVsaXUvY2N2L2pzLyBIVFRQLzAuMA0KSG9zdDogbG9jYWxob3N0Ojk5OTkNClJlZmVyZXI6IGh0dHA6Ly9sb2NhbGhvc3Q6OTk5OS9saXVsaXUvY2N2L2pzDQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTEwNTYNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IHRleHQvaHRtbDsgY2hhcnNldD11dGYtOA0KRGF0ZTogVGh1LCAwNiBOb3YgMjAxNCAxNDo0OTo1NiBHTVQNCkxhc3QtTW9kaWZpZWQ6IFRodSwgMDYgTm92IDIwMTQgMTQ6NDk6NDUgR01UDQoNCjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KPGhlYWQ+CjxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ij4KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgaHJlZj0iYS5jc3MiPgo8dGl0bGU+RmFjZSBEZXRlY3RvcjwvdGl0bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgaWQ9ImNvbnRhaW5lciI+Cgk8ZGl2IGlkPSJoZWFkZXIiPjxkaXYgY2xhc3M9InRpdGxlIj5BIE5vdC1zby1zbG93IEphdmFTY3JpcHQgRmFjZSBEZXRlY3RvcjwvZGl2PjxkaXYgY2xhc3M9InN1YnRpdGxlIj5Gb3IgU291cmNlIENvZGUsIFZpc2l0IDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9saXVsaXUvY2N2L3RyZWUvdW5zdGFibGUvanMiPkdpdGh1YjwvYT47IEZvciBNb3JlIERpc2N1c3Npb25zLCBWaXNpdCA8YSBocmVmPSJodHRwOi8vbGl1bGl1Lm1lIj5saXVsaXUubWU8L2E+OyBPciBQYXN0ZSBZb3VyIFBob3RvIGF0IDxhIGhyZWY9Imh0dHA6Ly9pbWd1ci5jb20iPmltZ3VyLmNvbTwvYT48L2Rpdj48L2Rpdj4KCTxkaXYgaWQ9ImNvbnRlbnQiPgoJCTxkaXYgaWQ9InVybGJveCI+PGRpdiBpZD0iZGV0ZWN0Ij48aW5wdXQgaWQ9InVybC1kZXRlY3QiIHR5cGU9ImJ1dHRvbiIgdmFsdWU9IkRldGVjdCI+PC9kaXY+PGRpdiBjbGFzcz0icGFyYWdyYXBoIj5VUkw6IDwvZGl2PjxkaXYgaWQ9InVybCI+PGRpdiBpZD0idXJsLWhpbnQiPlBhc3RlIGFuIGltYWdlIFVSTCBoZXJlPC9kaXY+PGlucHV0IGNsYXNzPSJuby1ib3JkZXIiIGlkPSJ1cmwtaW1hZ2UiIHR5cGU9InRleHQiPjwvZGl2PjwvZGl2PgoJCTxkaXYgaWQ9InN0YXRzIj5TdGF0czogV2ViIFdvcmtlciAtIDxhIGlkPSJ3ZWJ3b3JrZXItc3dpdGNoIiBocmVmPSIjIj5PZmY8L2E+LCBMb2FkIFRpbWU6IDxzcGFuIGlkPSJsb2FkLXRpbWUiPk5vbmU8L3NwYW4+LCBEZXRlY3Rpb24gVGltZTogPHNwYW4gaWQ9ImRldGVjdGlvbi10aW1lIj5Ob25lPC9zcGFuPiwgPHNwYW4gaWQ9Im51bS1mYWNlcyI+Pzwvc3Bhbj4gRmFjZXMgRm91bmQgYXQgPHNwYW4gaWQ9ImltYWdlLWRpbSI+P3g/PC9zcGFuPjwvZGl2PgoJCTxkaXYgaWQ9InZpZXdwb3J0Ij48ZGl2IGlkPSJ2aWV3LWhpbnQiPkRyYWcgJmFtcDsgRHJvcDxicj5vciA8dT5TZWxlY3Q8L3U+IFRvPC9kaXY+PGRpdiBpZD0idmlldy1ob3J6Ij48L2Rpdj48ZGl2IGlkPSJ2aWV3LXZ0aWMiPjwvZGl2PjxkaXY+PGNhbnZhcyBpZD0ib3V0cHV0Ij48L2NhbnZhcz48aW5wdXQgdHlwZT0iZmlsZSIgaWQ9ImZpbGUtc2VsZWN0b3IiIGFjY2VwdD0iaW1hZ2UvKiI+PC9kaXY+Cgk8L2Rpdj4KCTxkaXYgaWQ9ImZvb3RlciI+PGRpdj48YSBocmVmPSJodHRwOi8vZmFjZWJvb2suY29tL2xpdS5sbCI+TGl1IExpdTwvYT4gQCA8YSBocmVmPSJodHRwOi8vbGl1bGl1Lm1lIj5saXVsaXUubWU8L2E+PC9kaXY+PC9kaXY+CjwvZGl2Pgo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSJjY3YuanMiPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSJmYWNlLmpzIj48L3NjcmlwdD4KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgovKiBNb2Rlcm5penIgMi4wLjYgKEN1c3RvbSBCdWlsZCkgfCBNSVQgJiBCU0QKICogQnVpbGQ6IGh0dHA6Ly93d3cubW9kZXJuaXpyLmNvbS9kb3dubG9hZC8jLWJvcmRlcnJhZGl1cy1vcGFjaXR5LXJnYmEtY2FudmFzLWRyYWdhbmRkcm9wLXdlYndvcmtlcnMtYWRkdGVzdC10ZXN0cHJvcC10ZXN0YWxscHJvcHMtaGFzZXZlbnQtcHJlZml4ZXMtZG9tcHJlZml4ZXMtZmlsZV9hcGkKICovCjt3aW5kb3cuTW9kZXJuaXpyPWZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBCKGEsYil7dmFyIGM9YS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSthLnN1YnN0cigxKSxkPShhKyIgIituLmpvaW4oYysiICIpK2MpLnNwbGl0KCIgIik7cmV0dXJuIEEoZCxiKX1mdW5jdGlvbiBBKGEsYil7Zm9yKHZhciBkIGluIGEpaWYoalthW2RdXSE9PWMpcmV0dXJuIGI9PSJwZngiP2FbZF06ITA7cmV0dXJuITF9ZnVuY3Rpb24geihhLGIpe3JldHVybiEhfigiIithKS5pbmRleE9mKGIpfWZ1bmN0aW9uIHkoYSxiKXtyZXR1cm4gdHlwZW9mIGE9PT1ifWZ1bmN0aW9uIHgoYSxiKXtyZXR1cm4gdyhtLmpvaW4oYSsiOyIpKyhifHwiIikpfWZ1bmN0aW9uIHcoYSl7ai5jc3NUZXh0PWF9dmFyIGQ9IjIuMC42IixlPXt9LGY9Yi5kb2N1bWVudEVsZW1lbnQsZz1iLmhlYWR8fGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXSxoPSJtb2Rlcm5penIiLGk9Yi5jcmVhdGVFbGVtZW50KGgpLGo9aS5zdHlsZSxrLGw9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxtPSIgLXdlYmtpdC0gLW1vei0gLW8tIC1tcy0gLWtodG1sLSAiLnNwbGl0KCIgIiksbj0iV2Via2l0IE1veiBPIG1zIEtodG1sIi5zcGxpdCgiICIpLG89e30scD17fSxxPXt9LHI9W10scz1mdW5jdGlvbigpe2Z1bmN0aW9uIGQoZCxlKXtlPWV8fGIuY3JlYXRlRWxlbWVudChhW2RdfHwiZGl2IiksZD0ib24iK2Q7dmFyIGY9ZCBpbiBlO2Z8fChlLnNldEF0dHJpYnV0ZXx8KGU9Yi5jcmVhdGVFbGVtZW50KCJkaXYiKSksZS5zZXRBdHRyaWJ1dGUmJmUucmVtb3ZlQXR0cmlidXRlJiYoZS5zZXRBdHRyaWJ1dGUoZCwiIiksZj15KGVbZF0sImZ1bmN0aW9uIikseShlW2RdLGMpfHwoZVtkXT1jKSxlLnJlbW92ZUF0dHJpYnV0ZShkKSkpLGU9bnVsbDtyZXR1cm4gZn12YXIgYT17c2VsZWN0OiJpbnB1dCIsY2hhbmdlOiJpbnB1dCIsc3VibWl0OiJmb3JtIixyZXNldDoiZm9ybSIsZXJyb3I6ImltZyIsbG9hZDoiaW1nIixhYm9ydDoiaW1nIn07cmV0dXJuIGR9KCksdCx1PXt9Lmhhc093blByb3BlcnR5LHY7IXkodSxjKSYmIXkodS5jYWxsLGMpP3Y9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdS5jYWxsKGEsYil9OnY9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYiBpbiBhJiZ5KGEuY29uc3RydWN0b3IucHJvdG90eXBlW2JdLGMpfSxvLmNhbnZhcz1mdW5jdGlvbigpe3ZhciBhPWIuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7cmV0dXJuISFhLmdldENvbnRleHQmJiEhYS5nZXRDb250ZXh0KCIyZCIpfSxvLmRyYWdhbmRkcm9wPWZ1bmN0aW9uKCl7cmV0dXJuIHMoImRyYWdzdGFydCIpJiZzKCJkcm9wIil9LG8ucmdiYT1mdW5jdGlvbigpe3coImJhY2tncm91bmQtY29sb3I6cmdiYSgxNTAsMjU1LDE1MCwuNSkiKTtyZXR1cm4geihqLmJhY2tncm91bmRDb2xvciwicmdiYSIpfSxvLmJvcmRlcnJhZGl1cz1mdW5jdGlvbigpe3JldHVybiBCKCJib3JkZXJSYWRpdXMiKX0sby5vcGFjaXR5PWZ1bmN0aW9uKCl7eCgib3BhY2l0eTouNTUiKTtyZXR1cm4vXjAuNTUkLy50ZXN0KGoub3BhY2l0eSl9LG8ud2Vid29ya2Vycz1mdW5jdGlvbigpe3JldHVybiEhYS5Xb3JrZXJ9O2Zvcih2YXIgQyBpbiBvKXYobyxDKSYmKHQ9Qy50b0xvd2VyQ2FzZSgpLGVbdF09b1tDXSgpLHIucHVzaCgoZVt0XT8iIjoibm8tIikrdCkpO2UuYWRkVGVzdD1mdW5jdGlvbihhLGIpe2lmKHR5cGVvZiBhPT0ib2JqZWN0Iilmb3IodmFyIGQgaW4gYSl2KGEsZCkmJmUuYWRkVGVzdChkLGFbZF0pO2Vsc2V7YT1hLnRvTG93ZXJDYXNlKCk7aWYoZVthXSE9PWMpcmV0dXJuO2I9dHlwZW9mIGI9PSJib29sZWFuIj9iOiEhYigpLGYuY2xhc3NOYW1lKz0iICIrKGI/IiI6Im5vLSIpK2EsZVthXT1ifXJldHVybiBlfSx3KCIiKSxpPWs9bnVsbCxlLl92ZXJzaW9uPWQsZS5fcHJlZml4ZXM9bSxlLl9kb21QcmVmaXhlcz1uLGUuaGFzRXZlbnQ9cyxlLnRlc3RQcm9wPWZ1bmN0aW9uKGEpe3JldHVybiBBKFthXSl9LGUudGVzdEFsbFByb3BzPUI7cmV0dXJuIGV9KHRoaXMsdGhpcy5kb2N1bWVudCksTW9kZXJuaXpyLmFkZFRlc3QoImZpbGUiLGZ1bmN0aW9uKCl7cmV0dXJuISEod2luZG93LkZpbGUmJndpbmRvdy5GaWxlTGlzdCYmd2luZG93LkZpbGVSZWFkZXIpfSk7CgphZ2VudCA9IChmdW5jdGlvbiggdWEgKSB7Cgl1YSA9IHVhLnRvTG93ZXJDYXNlKCk7CgoJcndlYmtpdCA9IC8od2Via2l0KVsgXC9dKFtcdy5dKykvOwoJcm9wZXJhID0gLyhvcGVyYSkoPzouKnZlcnNpb24pP1sgXC9dKFtcdy5dKykvOwoJcm1zaWUgPSAvKG1zaWUpIChbXHcuXSspLzsKCXJtb3ppbGxhID0gLyhtb3ppbGxhKSg/Oi4qPyBydjooW1x3Ll0rKSk/LzsKCgl2YXIgbWF0Y2ggPSByd2Via2l0LmV4ZWMoIHVhICkgfHwKCQkJCXJvcGVyYS5leGVjKCB1YSApIHx8CgkJCQlybXNpZS5leGVjKCB1YSApIHx8CgkJCQl1YS5pbmRleE9mKCJjb21wYXRpYmxlIikgPCAwICYmIHJtb3ppbGxhLmV4ZWMoIHVhICkgfHwKCQkJCVtdOwoKCXJldHVybiB7IGJyb3dzZXI6IG1hdGNoWzFdIHx8ICIiLCB2ZXJzaW9uOiBtYXRjaFsyXSB8fCAiMCIgfTsKfSkobmF2aWdhdG9yLnVzZXJBZ2VudCk7Cgp2YXIgYXN5bmMgPSBmYWxzZTsKCmlmIChNb2Rlcm5penIud2Vid29ya2VycykgewoJYXN5bmMgPSAoYWdlbnQuYnJvd3NlciA9PSAibW96aWxsYSIpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndlYndvcmtlci1zd2l0Y2giKS5pbm5lckhUTUwgPSAoYXN5bmMpID8gIk9uIiA6ICJPZmYiOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndlYndvcmtlci1zd2l0Y2giKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChlKSB7CgkJaWYgKGFzeW5jKSB7CgkJCWFzeW5jID0gZmFsc2U7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3ZWJ3b3JrZXItc3dpdGNoIikuaW5uZXJIVE1MID0gIk9mZiI7CgkJfSBlbHNlIHsKCQkJYXN5bmMgPSB0cnVlOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2Vid29ya2VyLXN3aXRjaCIpLmlubmVySFRNTCA9ICJPbiI7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIGdldEltYWdlRGltKGltYWdlKSB7Cgl2YXIgcmVzdWx0ID0ge307Cglkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGltYWdlKTsKCXJlc3VsdFsnd2lkdGgnXSA9IGltYWdlLm9mZnNldFdpZHRoOwoJcmVzdWx0WydoZWlnaHQnXSA9IGltYWdlLm9mZnNldEhlaWdodDsKCWRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoaW1hZ2UpOwoJcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gZGV0ZWN0TmV3SW1hZ2Uoc3JjLCBhc3luYykgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvYWQtdGltZSIpLmlubmVySFRNTCA9ICJNZWFzdXJpbmcgLi4uIjsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXRlY3Rpb24tdGltZSIpLmlubmVySFRNTCA9ICJOb25lIjsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJudW0tZmFjZXMiKS5pbm5lckhUTUwgPSAiPyI7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW1hZ2UtZGltIikuaW5uZXJIVE1MID0gIj94PyI7Cgl2YXIgZWxhcHNlZF90aW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsKCXZhciBpbWFnZSA9IG5ldyBJbWFnZSgpOwoJdmFyIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvdXRwdXQiKTsKCXZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKCWltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKCQkvKiBsb2FkIGltYWdlLCBhbmQgZHJhdyBpdCB0byBjYW52YXMgKi8KCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9hZC10aW1lIikuaW5uZXJIVE1MID0gTWF0aC5yb3VuZCgobmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gZWxhcHNlZF90aW1lKS50b1N0cmluZygpICsgIm1zIjsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGV0ZWN0aW9uLXRpbWUiKS5pbm5lckhUTUwgPSAiTWVhc3VyaW5nIC4uLiI7CgkJdmFyIGRpbSA9IGdldEltYWdlRGltKGltYWdlKTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW1hZ2UtZGltIikuaW5uZXJIVE1MID0gZGltLndpZHRoLnRvU3RyaW5nKCkgKyAieCIgKyBkaW0uaGVpZ2h0LnRvU3RyaW5nKCk7CgkJdmFyIGJvdW5kaW5nV2lkdGggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29udGVudCIpLm9mZnNldFdpZHRoIC0gNDsKCQl2YXIgYm91bmRpbmdIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImhlYWRlciIpLm9mZnNldEhlaWdodCArIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmb290ZXIiKS5vZmZzZXRIZWlnaHQgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXJsYm94Iikub2Zmc2V0SGVpZ2h0ICsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN0YXRzIikub2Zmc2V0SGVpZ2h0KSAtIDEyMDsKCQl2YXIgdmlld3BvcnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld3BvcnQiKTsKCQl2YXIgbmV3V2lkdGggPSBkaW0ud2lkdGgsIG5ld0hlaWdodCA9IGRpbS5oZWlnaHQsIHNjYWxlID0gMTsKCQlpZiAoZGltLndpZHRoICogYm91bmRpbmdIZWlnaHQgPiBib3VuZGluZ1dpZHRoICogZGltLmhlaWdodCkgewoJCQluZXdXaWR0aCA9IGJvdW5kaW5nV2lkdGg7CgkJCW5ld0hlaWdodCA9IGJvdW5kaW5nV2lkdGggKiBkaW0uaGVpZ2h0IC8gZGltLndpZHRoOwoJCQlzY2FsZSA9IG5ld1dpZHRoIC8gZGltLndpZHRoOwoJCX0gZWxzZSB7CgkJCW5ld0hlaWdodCA9IGJvdW5kaW5nSGVpZ2h0OwoJCQluZXdXaWR0aCA9IGJvdW5kaW5nSGVpZ2h0ICogZGltLndpZHRoIC8gZGltLmhlaWdodDsKCQkJc2NhbGUgPSBuZXdIZWlnaHQgLyBkaW0uaGVpZ2h0OwoJCX0KCQl2aWV3cG9ydC5zdHlsZS53aWR0aCA9IG5ld1dpZHRoLnRvU3RyaW5nKCkgKyAicHgiOwoJCXZpZXdwb3J0LnN0eWxlLmhlaWdodCA9IG5ld0hlaWdodC50b1N0cmluZygpICsgInB4IjsKCQljYW52YXMud2lkdGggPSBuZXdXaWR0aDsKCQljYW52YXMuc3R5bGUud2lkdGggPSBuZXdXaWR0aC50b1N0cmluZygpICsgInB4IjsKCQljYW52YXMuaGVpZ2h0ID0gbmV3SGVpZ2h0OwoJCWNhbnZhcy5zdHlsZS5oZWlnaHQgPSBuZXdIZWlnaHQudG9TdHJpbmcoKSArICJweCI7CgkJY3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgbmV3V2lkdGgsIG5ld0hlaWdodCk7CgkJZWxhcHNlZF90aW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsKCQlmdW5jdGlvbiBwb3N0KGNvbXApIHsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm51bS1mYWNlcyIpLmlubmVySFRNTCA9IGNvbXAubGVuZ3RoLnRvU3RyaW5nKCk7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXRlY3Rpb24tdGltZSIpLmlubmVySFRNTCA9IE1hdGgucm91bmQoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtIGVsYXBzZWRfdGltZSkudG9TdHJpbmcoKSArICJtcyI7CgkJCWN0eC5saW5lV2lkdGggPSAyOwoJCQljdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyMzAsODcsMCwwLjgpJzsKCQkJLyogZHJhdyBkZXRlY3RlZCBhcmVhICovCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgY29tcC5sZW5ndGg7IGkrKykgewoJCQkJY3R4LmJlZ2luUGF0aCgpOwoJCQkJY3R4LmFyYygoY29tcFtpXS54ICsgY29tcFtpXS53aWR0aCAqIDAuNSkgKiBzY2FsZSwgKGNvbXBbaV0ueSArIGNvbXBbaV0uaGVpZ2h0ICogMC41KSAqIHNjYWxlLAoJCQkJCQkoY29tcFtpXS53aWR0aCArIGNvbXBbaV0uaGVpZ2h0KSAqIDAuMjUgKiBzY2FsZSAqIDEuMiwgMCwgTWF0aC5QSSAqIDIpOwoJCQkJY3R4LnN0cm9rZSgpOwoJCQl9CgkJfQoJCS8qIGNhbGwgbWFpbiBkZXRlY3Rfb2JqZWN0cyBmdW5jdGlvbiAqLwoJCWlmIChhc3luYykgewoJCQljY3YuZGV0ZWN0X29iamVjdHMoeyAiY2FudmFzIiA6IGNjdi5ncmF5c2NhbGUoY2N2LnByZShpbWFnZSkpLAoJCQkJCQkJCSAiY2FzY2FkZSIgOiBjYXNjYWRlLAoJCQkJCQkJCSAiaW50ZXJ2YWwiIDogNSwKCQkJCQkJCQkgIm1pbl9uZWlnaGJvcnMiIDogMSwKCQkJCQkJCQkgImFzeW5jIiA6IHRydWUsCgkJCQkJCQkJICJ3b3JrZXIiIDogMSB9KShwb3N0KTsKCQl9IGVsc2UgewoJCQl2YXIgY29tcCA9IGNjdi5kZXRlY3Rfb2JqZWN0cyh7ICJjYW52YXMiIDogY2N2LmdyYXlzY2FsZShjY3YucHJlKGltYWdlKSksCgkJCQkJCQkJCQkJImNhc2NhZGUiIDogY2FzY2FkZSwKCQkJCQkJCQkJCQkiaW50ZXJ2YWwiIDogNSwKCQkJCQkJCQkJCQkibWluX25laWdoYm9ycyIgOiAxIH0pOwoJCQlwb3N0KGNvbXApOwoJCX0KCX07CglpbWFnZS5zcmMgPSBzcmM7Cn0KCmZ1bmN0aW9uIGhhbmRsZUxvY2FsRmlsZShmaWxlKSB7CglpZiAoZmlsZS50eXBlLm1hdGNoKC9pbWFnZS4qLykpIHsKCQl2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQlyZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKCQkJZGV0ZWN0TmV3SW1hZ2UoZS50YXJnZXQucmVzdWx0LCBhc3luYyk7CgkJfTsKCQlyZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKCX0KfQoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXdwb3J0IikuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ292ZXIiLCBmdW5jdGlvbiAoZSkgewoJZS5zdG9wUHJvcGFnYXRpb24oKTsKCWUucHJldmVudERlZmF1bHQoKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3LWhpbnQiKS5zdHlsZS56SW5kZXggPSAKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlldy1ob3J6Iikuc3R5bGUuekluZGV4ID0gCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3LXZ0aWMiKS5zdHlsZS56SW5kZXggPSAiMTAwMCI7Cn0sIGZhbHNlKTsKCmlmIChhZ2VudC5icm93c2VyID09ICJtb3ppbGxhIikgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbGUtc2VsZWN0b3IiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbGUtc2VsZWN0b3IiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChlKSB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQllLnByZXZlbnREZWZhdWx0KCk7Cgl9LCBmYWxzZSk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld3BvcnQiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChlKSB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbGUtc2VsZWN0b3IiKS5jbGljaygpOwoJfSwgZmFsc2UpOwp9Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld3BvcnQiKS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLCBmdW5jdGlvbiAoZSkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXctaGludCIpLnN0eWxlLnpJbmRleCA9IAoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3LWhvcnoiKS5zdHlsZS56SW5kZXggPSAKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXctdnRpYyIpLnN0eWxlLnpJbmRleCA9ICIxMDAwIjsKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld3BvcnQiKS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW91dCIsIGZ1bmN0aW9uIChlKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlldy1oaW50Iikuc3R5bGUuekluZGV4ID0gCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXctaG9yeiIpLnN0eWxlLnpJbmRleCA9IAoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlldy12dGljIikuc3R5bGUuekluZGV4ID0gIjAiOwp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaWxlLXNlbGVjdG9yIikuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKCXZhciBmaWxlcyA9IHRoaXMuZmlsZXM7CglpZiAoZmlsZXMubGVuZ3RoKQoJCWhhbmRsZUxvY2FsRmlsZShmaWxlc1swXSk7Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXdwb3J0IikuYWRkRXZlbnRMaXN0ZW5lcigiZHJvcCIsIGZ1bmN0aW9uIChlKSB7CgllLnN0b3BQcm9wYWdhdGlvbigpOwoJZS5wcmV2ZW50RGVmYXVsdCgpOwoKCXZhciBmaWxlcyA9IGUuZGF0YVRyYW5zZmVyLmZpbGVzOwoKCWlmIChmaWxlcy5sZW5ndGgpCgkJaGFuZGxlTG9jYWxGaWxlKGZpbGVzWzBdKTsKCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlldy1oaW50Iikuc3R5bGUuekluZGV4ID0gCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXctaG9yeiIpLnN0eWxlLnpJbmRleCA9IAoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlldy12dGljIikuc3R5bGUuekluZGV4ID0gIjAiOwp9LCBmYWxzZSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXJsLWltYWdlIikuYWRkRXZlbnRMaXN0ZW5lcigiZm9jdXMiLCBmdW5jdGlvbiAoZSkgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVybC1oaW50Iikuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwtaW1hZ2UiKS5hZGRFdmVudExpc3RlbmVyKCJibHVyIiwgZnVuY3Rpb24gKGUpIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXJsLWltYWdlIikudmFsdWUubGVuZ3RoIDw9IDApCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVybC1oaW50Iikuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXJsLWRldGVjdCIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oZSkgewoJdmFyIHVybCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwtaW1hZ2UiKS52YWx1ZTsKCWlmICh1cmwubGVuZ3RoID4gMCkgewoJCXdpbmRvdy5sb2NhdGlvbi5oYXNoID0gIiMiICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCk7CgkJZGV0ZWN0TmV3SW1hZ2UoImxvYWRlci5waHA/c3JjPSIgKyBlbmNvZGVVUklDb21wb25lbnQoKHVybC5zdWJzdHIoMCwgNykudG9Mb3dlckNhc2UoKSA9PSAiaHR0cDovLyIpID8gdXJsIDogImh0dHA6Ly8iICsgdXJsKSwgYXN5bmMpOwoJfQp9KTsKCnZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSk7CmlmICh1cmwubGVuZ3RoID4gNykgewoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVybC1pbWFnZSIpLnZhbHVlID0gZGVjb2RlVVJJQ29tcG9uZW50KHVybCk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXJsLWhpbnQiKS5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7Cn0KCjwvc2NyaXB0Pgo=",
                "body": "PCFET0NUWVBFIGh0bWw+CjxodG1sPgo8aGVhZD4KPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiPgo8bGluayByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiBocmVmPSJhLmNzcyI+Cjx0aXRsZT5GYWNlIERldGVjdG9yPC90aXRsZT4KPC9oZWFkPgo8Ym9keT4KPGRpdiBpZD0iY29udGFpbmVyIj4KCTxkaXYgaWQ9ImhlYWRlciI+PGRpdiBjbGFzcz0idGl0bGUiPkEgTm90LXNvLXNsb3cgSmF2YVNjcmlwdCBGYWNlIERldGVjdG9yPC9kaXY+PGRpdiBjbGFzcz0ic3VidGl0bGUiPkZvciBTb3VyY2UgQ29kZSwgVmlzaXQgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2xpdWxpdS9jY3YvdHJlZS91bnN0YWJsZS9qcyI+R2l0aHViPC9hPjsgRm9yIE1vcmUgRGlzY3Vzc2lvbnMsIFZpc2l0IDxhIGhyZWY9Imh0dHA6Ly9saXVsaXUubWUiPmxpdWxpdS5tZTwvYT47IE9yIFBhc3RlIFlvdXIgUGhvdG8gYXQgPGEgaHJlZj0iaHR0cDovL2ltZ3VyLmNvbSI+aW1ndXIuY29tPC9hPjwvZGl2PjwvZGl2PgoJPGRpdiBpZD0iY29udGVudCI+CgkJPGRpdiBpZD0idXJsYm94Ij48ZGl2IGlkPSJkZXRlY3QiPjxpbnB1dCBpZD0idXJsLWRldGVjdCIgdHlwZT0iYnV0dG9uIiB2YWx1ZT0iRGV0ZWN0Ij48L2Rpdj48ZGl2IGNsYXNzPSJwYXJhZ3JhcGgiPlVSTDogPC9kaXY+PGRpdiBpZD0idXJsIj48ZGl2IGlkPSJ1cmwtaGludCI+UGFzdGUgYW4gaW1hZ2UgVVJMIGhlcmU8L2Rpdj48aW5wdXQgY2xhc3M9Im5vLWJvcmRlciIgaWQ9InVybC1pbWFnZSIgdHlwZT0idGV4dCI+PC9kaXY+PC9kaXY+CgkJPGRpdiBpZD0ic3RhdHMiPlN0YXRzOiBXZWIgV29ya2VyIC0gPGEgaWQ9IndlYndvcmtlci1zd2l0Y2giIGhyZWY9IiMiPk9mZjwvYT4sIExvYWQgVGltZTogPHNwYW4gaWQ9ImxvYWQtdGltZSI+Tm9uZTwvc3Bhbj4sIERldGVjdGlvbiBUaW1lOiA8c3BhbiBpZD0iZGV0ZWN0aW9uLXRpbWUiPk5vbmU8L3NwYW4+LCA8c3BhbiBpZD0ibnVtLWZhY2VzIj4/PC9zcGFuPiBGYWNlcyBGb3VuZCBhdCA8c3BhbiBpZD0iaW1hZ2UtZGltIj4/eD88L3NwYW4+PC9kaXY+CgkJPGRpdiBpZD0idmlld3BvcnQiPjxkaXYgaWQ9InZpZXctaGludCI+RHJhZyAmYW1wOyBEcm9wPGJyPm9yIDx1PlNlbGVjdDwvdT4gVG88L2Rpdj48ZGl2IGlkPSJ2aWV3LWhvcnoiPjwvZGl2PjxkaXYgaWQ9InZpZXctdnRpYyI+PC9kaXY+PGRpdj48Y2FudmFzIGlkPSJvdXRwdXQiPjwvY2FudmFzPjxpbnB1dCB0eXBlPSJmaWxlIiBpZD0iZmlsZS1zZWxlY3RvciIgYWNjZXB0PSJpbWFnZS8qIj48L2Rpdj4KCTwvZGl2PgoJPGRpdiBpZD0iZm9vdGVyIj48ZGl2PjxhIGhyZWY9Imh0dHA6Ly9mYWNlYm9vay5jb20vbGl1LmxsIj5MaXUgTGl1PC9hPiBAIDxhIGhyZWY9Imh0dHA6Ly9saXVsaXUubWUiPmxpdWxpdS5tZTwvYT48L2Rpdj48L2Rpdj4KPC9kaXY+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9ImNjdi5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9ImZhY2UuanMiPjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+Ci8qIE1vZGVybml6ciAyLjAuNiAoQ3VzdG9tIEJ1aWxkKSB8IE1JVCAmIEJTRAogKiBCdWlsZDogaHR0cDovL3d3dy5tb2Rlcm5penIuY29tL2Rvd25sb2FkLyMtYm9yZGVycmFkaXVzLW9wYWNpdHktcmdiYS1jYW52YXMtZHJhZ2FuZGRyb3Atd2Vid29ya2Vycy1hZGR0ZXN0LXRlc3Rwcm9wLXRlc3RhbGxwcm9wcy1oYXNldmVudC1wcmVmaXhlcy1kb21wcmVmaXhlcy1maWxlX2FwaQogKi8KO3dpbmRvdy5Nb2Rlcm5penI9ZnVuY3Rpb24oYSxiLGMpe2Z1bmN0aW9uIEIoYSxiKXt2YXIgYz1hLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpK2Euc3Vic3RyKDEpLGQ9KGErIiAiK24uam9pbihjKyIgIikrYykuc3BsaXQoIiAiKTtyZXR1cm4gQShkLGIpfWZ1bmN0aW9uIEEoYSxiKXtmb3IodmFyIGQgaW4gYSlpZihqW2FbZF1dIT09YylyZXR1cm4gYj09InBmeCI/YVtkXTohMDtyZXR1cm4hMX1mdW5jdGlvbiB6KGEsYil7cmV0dXJuISF+KCIiK2EpLmluZGV4T2YoYil9ZnVuY3Rpb24geShhLGIpe3JldHVybiB0eXBlb2YgYT09PWJ9ZnVuY3Rpb24geChhLGIpe3JldHVybiB3KG0uam9pbihhKyI7IikrKGJ8fCIiKSl9ZnVuY3Rpb24gdyhhKXtqLmNzc1RleHQ9YX12YXIgZD0iMi4wLjYiLGU9e30sZj1iLmRvY3VtZW50RWxlbWVudCxnPWIuaGVhZHx8Yi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdLGg9Im1vZGVybml6ciIsaT1iLmNyZWF0ZUVsZW1lbnQoaCksaj1pLnN0eWxlLGssbD1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLG09IiAtd2Via2l0LSAtbW96LSAtby0gLW1zLSAta2h0bWwtICIuc3BsaXQoIiAiKSxuPSJXZWJraXQgTW96IE8gbXMgS2h0bWwiLnNwbGl0KCIgIiksbz17fSxwPXt9LHE9e30scj1bXSxzPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZChkLGUpe2U9ZXx8Yi5jcmVhdGVFbGVtZW50KGFbZF18fCJkaXYiKSxkPSJvbiIrZDt2YXIgZj1kIGluIGU7Znx8KGUuc2V0QXR0cmlidXRlfHwoZT1iLmNyZWF0ZUVsZW1lbnQoImRpdiIpKSxlLnNldEF0dHJpYnV0ZSYmZS5yZW1vdmVBdHRyaWJ1dGUmJihlLnNldEF0dHJpYnV0ZShkLCIiKSxmPXkoZVtkXSwiZnVuY3Rpb24iKSx5KGVbZF0sYyl8fChlW2RdPWMpLGUucmVtb3ZlQXR0cmlidXRlKGQpKSksZT1udWxsO3JldHVybiBmfXZhciBhPXtzZWxlY3Q6ImlucHV0IixjaGFuZ2U6ImlucHV0IixzdWJtaXQ6ImZvcm0iLHJlc2V0OiJmb3JtIixlcnJvcjoiaW1nIixsb2FkOiJpbWciLGFib3J0OiJpbWcifTtyZXR1cm4gZH0oKSx0LHU9e30uaGFzT3duUHJvcGVydHksdjsheSh1LGMpJiYheSh1LmNhbGwsYyk/dj1mdW5jdGlvbihhLGIpe3JldHVybiB1LmNhbGwoYSxiKX06dj1mdW5jdGlvbihhLGIpe3JldHVybiBiIGluIGEmJnkoYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGVbYl0sYyl9LG8uY2FudmFzPWZ1bmN0aW9uKCl7dmFyIGE9Yi5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTtyZXR1cm4hIWEuZ2V0Q29udGV4dCYmISFhLmdldENvbnRleHQoIjJkIil9LG8uZHJhZ2FuZGRyb3A9ZnVuY3Rpb24oKXtyZXR1cm4gcygiZHJhZ3N0YXJ0IikmJnMoImRyb3AiKX0sby5yZ2JhPWZ1bmN0aW9uKCl7dygiYmFja2dyb3VuZC1jb2xvcjpyZ2JhKDE1MCwyNTUsMTUwLC41KSIpO3JldHVybiB6KGouYmFja2dyb3VuZENvbG9yLCJyZ2JhIil9LG8uYm9yZGVycmFkaXVzPWZ1bmN0aW9uKCl7cmV0dXJuIEIoImJvcmRlclJhZGl1cyIpfSxvLm9wYWNpdHk9ZnVuY3Rpb24oKXt4KCJvcGFjaXR5Oi41NSIpO3JldHVybi9eMC41NSQvLnRlc3Qoai5vcGFjaXR5KX0sby53ZWJ3b3JrZXJzPWZ1bmN0aW9uKCl7cmV0dXJuISFhLldvcmtlcn07Zm9yKHZhciBDIGluIG8pdihvLEMpJiYodD1DLnRvTG93ZXJDYXNlKCksZVt0XT1vW0NdKCksci5wdXNoKChlW3RdPyIiOiJuby0iKSt0KSk7ZS5hZGRUZXN0PWZ1bmN0aW9uKGEsYil7aWYodHlwZW9mIGE9PSJvYmplY3QiKWZvcih2YXIgZCBpbiBhKXYoYSxkKSYmZS5hZGRUZXN0KGQsYVtkXSk7ZWxzZXthPWEudG9Mb3dlckNhc2UoKTtpZihlW2FdIT09YylyZXR1cm47Yj10eXBlb2YgYj09ImJvb2xlYW4iP2I6ISFiKCksZi5jbGFzc05hbWUrPSIgIisoYj8iIjoibm8tIikrYSxlW2FdPWJ9cmV0dXJuIGV9LHcoIiIpLGk9az1udWxsLGUuX3ZlcnNpb249ZCxlLl9wcmVmaXhlcz1tLGUuX2RvbVByZWZpeGVzPW4sZS5oYXNFdmVudD1zLGUudGVzdFByb3A9ZnVuY3Rpb24oYSl7cmV0dXJuIEEoW2FdKX0sZS50ZXN0QWxsUHJvcHM9QjtyZXR1cm4gZX0odGhpcyx0aGlzLmRvY3VtZW50KSxNb2Rlcm5penIuYWRkVGVzdCgiZmlsZSIsZnVuY3Rpb24oKXtyZXR1cm4hISh3aW5kb3cuRmlsZSYmd2luZG93LkZpbGVMaXN0JiZ3aW5kb3cuRmlsZVJlYWRlcil9KTsKCmFnZW50ID0gKGZ1bmN0aW9uKCB1YSApIHsKCXVhID0gdWEudG9Mb3dlckNhc2UoKTsKCglyd2Via2l0ID0gLyh3ZWJraXQpWyBcL10oW1x3Ll0rKS87Cglyb3BlcmEgPSAvKG9wZXJhKSg/Oi4qdmVyc2lvbik/WyBcL10oW1x3Ll0rKS87CglybXNpZSA9IC8obXNpZSkgKFtcdy5dKykvOwoJcm1vemlsbGEgPSAvKG1vemlsbGEpKD86Lio/IHJ2OihbXHcuXSspKT8vOwoKCXZhciBtYXRjaCA9IHJ3ZWJraXQuZXhlYyggdWEgKSB8fAoJCQkJcm9wZXJhLmV4ZWMoIHVhICkgfHwKCQkJCXJtc2llLmV4ZWMoIHVhICkgfHwKCQkJCXVhLmluZGV4T2YoImNvbXBhdGlibGUiKSA8IDAgJiYgcm1vemlsbGEuZXhlYyggdWEgKSB8fAoJCQkJW107CgoJcmV0dXJuIHsgYnJvd3NlcjogbWF0Y2hbMV0gfHwgIiIsIHZlcnNpb246IG1hdGNoWzJdIHx8ICIwIiB9Owp9KShuYXZpZ2F0b3IudXNlckFnZW50KTsKCnZhciBhc3luYyA9IGZhbHNlOwoKaWYgKE1vZGVybml6ci53ZWJ3b3JrZXJzKSB7Cglhc3luYyA9IChhZ2VudC5icm93c2VyID09ICJtb3ppbGxhIik7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2Vid29ya2VyLXN3aXRjaCIpLmlubmVySFRNTCA9IChhc3luYykgPyAiT24iIDogIk9mZiI7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2Vid29ya2VyLXN3aXRjaCIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGUpIHsKCQlpZiAoYXN5bmMpIHsKCQkJYXN5bmMgPSBmYWxzZTsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndlYndvcmtlci1zd2l0Y2giKS5pbm5lckhUTUwgPSAiT2ZmIjsKCQl9IGVsc2UgewoJCQlhc3luYyA9IHRydWU7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3ZWJ3b3JrZXItc3dpdGNoIikuaW5uZXJIVE1MID0gIk9uIjsKCQl9Cgl9KTsKfQoKZnVuY3Rpb24gZ2V0SW1hZ2VEaW0oaW1hZ2UpIHsKCXZhciByZXN1bHQgPSB7fTsKCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW1hZ2UpOwoJcmVzdWx0Wyd3aWR0aCddID0gaW1hZ2Uub2Zmc2V0V2lkdGg7CglyZXN1bHRbJ2hlaWdodCddID0gaW1hZ2Uub2Zmc2V0SGVpZ2h0OwoJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChpbWFnZSk7CglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBkZXRlY3ROZXdJbWFnZShzcmMsIGFzeW5jKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9hZC10aW1lIikuaW5uZXJIVE1MID0gIk1lYXN1cmluZyAuLi4iOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRldGVjdGlvbi10aW1lIikuaW5uZXJIVE1MID0gIk5vbmUiOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm51bS1mYWNlcyIpLmlubmVySFRNTCA9ICI/IjsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbWFnZS1kaW0iKS5pbm5lckhUTUwgPSAiP3g/IjsKCXZhciBlbGFwc2VkX3RpbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOwoJdmFyIGltYWdlID0gbmV3IEltYWdlKCk7Cgl2YXIgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm91dHB1dCIpOwoJdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwoJaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24gKCkgewoJCS8qIGxvYWQgaW1hZ2UsIGFuZCBkcmF3IGl0IHRvIGNhbnZhcyAqLwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2FkLXRpbWUiKS5pbm5lckhUTUwgPSBNYXRoLnJvdW5kKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgLSBlbGFwc2VkX3RpbWUpLnRvU3RyaW5nKCkgKyAibXMiOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXRlY3Rpb24tdGltZSIpLmlubmVySFRNTCA9ICJNZWFzdXJpbmcgLi4uIjsKCQl2YXIgZGltID0gZ2V0SW1hZ2VEaW0oaW1hZ2UpOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbWFnZS1kaW0iKS5pbm5lckhUTUwgPSBkaW0ud2lkdGgudG9TdHJpbmcoKSArICJ4IiArIGRpbS5oZWlnaHQudG9TdHJpbmcoKTsKCQl2YXIgYm91bmRpbmdXaWR0aCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb250ZW50Iikub2Zmc2V0V2lkdGggLSA0OwoJCXZhciBib3VuZGluZ0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaGVhZGVyIikub2Zmc2V0SGVpZ2h0ICsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZvb3RlciIpLm9mZnNldEhlaWdodCArIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmxib3giKS5vZmZzZXRIZWlnaHQgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3RhdHMiKS5vZmZzZXRIZWlnaHQpIC0gMTIwOwoJCXZhciB2aWV3cG9ydCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3cG9ydCIpOwoJCXZhciBuZXdXaWR0aCA9IGRpbS53aWR0aCwgbmV3SGVpZ2h0ID0gZGltLmhlaWdodCwgc2NhbGUgPSAxOwoJCWlmIChkaW0ud2lkdGggKiBib3VuZGluZ0hlaWdodCA+IGJvdW5kaW5nV2lkdGggKiBkaW0uaGVpZ2h0KSB7CgkJCW5ld1dpZHRoID0gYm91bmRpbmdXaWR0aDsKCQkJbmV3SGVpZ2h0ID0gYm91bmRpbmdXaWR0aCAqIGRpbS5oZWlnaHQgLyBkaW0ud2lkdGg7CgkJCXNjYWxlID0gbmV3V2lkdGggLyBkaW0ud2lkdGg7CgkJfSBlbHNlIHsKCQkJbmV3SGVpZ2h0ID0gYm91bmRpbmdIZWlnaHQ7CgkJCW5ld1dpZHRoID0gYm91bmRpbmdIZWlnaHQgKiBkaW0ud2lkdGggLyBkaW0uaGVpZ2h0OwoJCQlzY2FsZSA9IG5ld0hlaWdodCAvIGRpbS5oZWlnaHQ7CgkJfQoJCXZpZXdwb3J0LnN0eWxlLndpZHRoID0gbmV3V2lkdGgudG9TdHJpbmcoKSArICJweCI7CgkJdmlld3BvcnQuc3R5bGUuaGVpZ2h0ID0gbmV3SGVpZ2h0LnRvU3RyaW5nKCkgKyAicHgiOwoJCWNhbnZhcy53aWR0aCA9IG5ld1dpZHRoOwoJCWNhbnZhcy5zdHlsZS53aWR0aCA9IG5ld1dpZHRoLnRvU3RyaW5nKCkgKyAicHgiOwoJCWNhbnZhcy5oZWlnaHQgPSBuZXdIZWlnaHQ7CgkJY2FudmFzLnN0eWxlLmhlaWdodCA9IG5ld0hlaWdodC50b1N0cmluZygpICsgInB4IjsKCQljdHguZHJhd0ltYWdlKGltYWdlLCAwLCAwLCBuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKCQllbGFwc2VkX3RpbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOwoJCWZ1bmN0aW9uIHBvc3QoY29tcCkgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibnVtLWZhY2VzIikuaW5uZXJIVE1MID0gY29tcC5sZW5ndGgudG9TdHJpbmcoKTsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRldGVjdGlvbi10aW1lIikuaW5uZXJIVE1MID0gTWF0aC5yb3VuZCgobmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gZWxhcHNlZF90aW1lKS50b1N0cmluZygpICsgIm1zIjsKCQkJY3R4LmxpbmVXaWR0aCA9IDI7CgkJCWN0eC5zdHJva2VTdHlsZSA9ICdyZ2JhKDIzMCw4NywwLDAuOCknOwoJCQkvKiBkcmF3IGRldGVjdGVkIGFyZWEgKi8KCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjb21wLmxlbmd0aDsgaSsrKSB7CgkJCQljdHguYmVnaW5QYXRoKCk7CgkJCQljdHguYXJjKChjb21wW2ldLnggKyBjb21wW2ldLndpZHRoICogMC41KSAqIHNjYWxlLCAoY29tcFtpXS55ICsgY29tcFtpXS5oZWlnaHQgKiAwLjUpICogc2NhbGUsCgkJCQkJCShjb21wW2ldLndpZHRoICsgY29tcFtpXS5oZWlnaHQpICogMC4yNSAqIHNjYWxlICogMS4yLCAwLCBNYXRoLlBJICogMik7CgkJCQljdHguc3Ryb2tlKCk7CgkJCX0KCQl9CgkJLyogY2FsbCBtYWluIGRldGVjdF9vYmplY3RzIGZ1bmN0aW9uICovCgkJaWYgKGFzeW5jKSB7CgkJCWNjdi5kZXRlY3Rfb2JqZWN0cyh7ICJjYW52YXMiIDogY2N2LmdyYXlzY2FsZShjY3YucHJlKGltYWdlKSksCgkJCQkJCQkJICJjYXNjYWRlIiA6IGNhc2NhZGUsCgkJCQkJCQkJICJpbnRlcnZhbCIgOiA1LAoJCQkJCQkJCSAibWluX25laWdoYm9ycyIgOiAxLAoJCQkJCQkJCSAiYXN5bmMiIDogdHJ1ZSwKCQkJCQkJCQkgIndvcmtlciIgOiAxIH0pKHBvc3QpOwoJCX0gZWxzZSB7CgkJCXZhciBjb21wID0gY2N2LmRldGVjdF9vYmplY3RzKHsgImNhbnZhcyIgOiBjY3YuZ3JheXNjYWxlKGNjdi5wcmUoaW1hZ2UpKSwKCQkJCQkJCQkJCQkiY2FzY2FkZSIgOiBjYXNjYWRlLAoJCQkJCQkJCQkJCSJpbnRlcnZhbCIgOiA1LAoJCQkJCQkJCQkJCSJtaW5fbmVpZ2hib3JzIiA6IDEgfSk7CgkJCXBvc3QoY29tcCk7CgkJfQoJfTsKCWltYWdlLnNyYyA9IHNyYzsKfQoKZnVuY3Rpb24gaGFuZGxlTG9jYWxGaWxlKGZpbGUpIHsKCWlmIChmaWxlLnR5cGUubWF0Y2goL2ltYWdlLiovKSkgewoJCXZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwoJCXJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewoJCQlkZXRlY3ROZXdJbWFnZShlLnRhcmdldC5yZXN1bHQsIGFzeW5jKTsKCQl9OwoJCXJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwoJfQp9Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld3BvcnQiKS5hZGRFdmVudExpc3RlbmVyKCJkcmFnb3ZlciIsIGZ1bmN0aW9uIChlKSB7CgllLnN0b3BQcm9wYWdhdGlvbigpOwoJZS5wcmV2ZW50RGVmYXVsdCgpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXctaGludCIpLnN0eWxlLnpJbmRleCA9IAoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3LWhvcnoiKS5zdHlsZS56SW5kZXggPSAKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXctdnRpYyIpLnN0eWxlLnpJbmRleCA9ICIxMDAwIjsKfSwgZmFsc2UpOwoKaWYgKGFnZW50LmJyb3dzZXIgPT0gIm1vemlsbGEiKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmlsZS1zZWxlY3RvciIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmlsZS1zZWxlY3RvciIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGUpIHsKCQllLnN0b3BQcm9wYWdhdGlvbigpOwoJCWUucHJldmVudERlZmF1bHQoKTsKCX0sIGZhbHNlKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3cG9ydCIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGUpIHsKCQllLnN0b3BQcm9wYWdhdGlvbigpOwoJCWUucHJldmVudERlZmF1bHQoKTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmlsZS1zZWxlY3RvciIpLmNsaWNrKCk7Cgl9LCBmYWxzZSk7Cn0KCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3cG9ydCIpLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3ZlciIsIGZ1bmN0aW9uIChlKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlldy1oaW50Iikuc3R5bGUuekluZGV4ID0gCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpZXctaG9yeiIpLnN0eWxlLnpJbmRleCA9IAoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlldy12dGljIikuc3R5bGUuekluZGV4ID0gIjEwMDAiOwp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3cG9ydCIpLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3V0IiwgZnVuY3Rpb24gKGUpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3LWhpbnQiKS5zdHlsZS56SW5kZXggPSAKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlldy1ob3J6Iikuc3R5bGUuekluZGV4ID0gCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3LXZ0aWMiKS5zdHlsZS56SW5kZXggPSAiMCI7Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZpbGUtc2VsZWN0b3IiKS5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBmdW5jdGlvbiAoZSkgewoJdmFyIGZpbGVzID0gdGhpcy5maWxlczsKCWlmIChmaWxlcy5sZW5ndGgpCgkJaGFuZGxlTG9jYWxGaWxlKGZpbGVzWzBdKTsKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlld3BvcnQiKS5hZGRFdmVudExpc3RlbmVyKCJkcm9wIiwgZnVuY3Rpb24gKGUpIHsKCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgllLnByZXZlbnREZWZhdWx0KCk7CgoJdmFyIGZpbGVzID0gZS5kYXRhVHJhbnNmZXIuZmlsZXM7CgoJaWYgKGZpbGVzLmxlbmd0aCkKCQloYW5kbGVMb2NhbEZpbGUoZmlsZXNbMF0pOwoKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3LWhpbnQiKS5zdHlsZS56SW5kZXggPSAKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlldy1ob3J6Iikuc3R5bGUuekluZGV4ID0gCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2aWV3LXZ0aWMiKS5zdHlsZS56SW5kZXggPSAiMCI7Cn0sIGZhbHNlKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwtaW1hZ2UiKS5hZGRFdmVudExpc3RlbmVyKCJmb2N1cyIsIGZ1bmN0aW9uIChlKSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXJsLWhpbnQiKS5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVybC1pbWFnZSIpLmFkZEV2ZW50TGlzdGVuZXIoImJsdXIiLCBmdW5jdGlvbiAoZSkgewoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwtaW1hZ2UiKS52YWx1ZS5sZW5ndGggPD0gMCkKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXJsLWhpbnQiKS5zdHlsZS52aXNpYmlsaXR5ID0gInZpc2libGUiOwp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwtZGV0ZWN0IikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihlKSB7Cgl2YXIgdXJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVybC1pbWFnZSIpLnZhbHVlOwoJaWYgKHVybC5sZW5ndGggPiAwKSB7CgkJd2luZG93LmxvY2F0aW9uLmhhc2ggPSAiIyIgKyBlbmNvZGVVUklDb21wb25lbnQodXJsKTsKCQlkZXRlY3ROZXdJbWFnZSgibG9hZGVyLnBocD9zcmM9IiArIGVuY29kZVVSSUNvbXBvbmVudCgodXJsLnN1YnN0cigwLCA3KS50b0xvd2VyQ2FzZSgpID09ICJodHRwOi8vIikgPyB1cmwgOiAiaHR0cDovLyIgKyB1cmwpLCBhc3luYyk7Cgl9Cn0pOwoKdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cigxKTsKaWYgKHVybC5sZW5ndGggPiA3KSB7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXJsLWltYWdlIikudmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQodXJsKTsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwtaGludCIpLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKfQoKPC9zY3JpcHQ+Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 14:49:45 GMT",
                    "Content-Length": "11056",
                    "Date": "Thu, 06 Nov 2014 14:49:56 GMT",
                    "Content-Type": "text/html; charset=utf-8"
                },
                "cookies": [],
                "mimeType": "HTML",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}