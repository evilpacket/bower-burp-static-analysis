{
    "url": "http://localhost:9999/kissyteam/router/build/router-debug.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>location.hash</b> and written to <b>history.replaceState()</b> via the following statements:<ul><li>var tmp = location.hash.substring(2);</li><li>tmp = tmp.substring(1);</li><li>history.replaceState({}, '', href = location.protocol + '//' + location.host + location.pathname + tmp);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/kissyteam/router/build/router-debug.js",
                "path": "/kissyteam/router/build/router-debug.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9raXNzeXRlYW0vcm91dGVyL2J1aWxkL3JvdXRlci1kZWJ1Zy5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTUwMDUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMTY6MjI6NDkgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDE2OjIyOjQ5IEdNVA0KDQovKgpDb3B5cmlnaHQgMjAxNCwgbW9kdWxleC1yb3V0ZXJAMS4wLjEKTUlUIExpY2Vuc2VkCmJ1aWxkIHRpbWU6IFRodSwgMTYgT2N0IDIwMTQgMDc6MDI6MTggR01UCiovCm1vZHVsZXguYWRkKCJyb3V0ZXIiLCBbImV2ZW50LWRvbSIsInVybCIsImV2ZW50LWN1c3RvbSIsImZlYXR1cmUiXSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CnZhciBldmVudERvbSA9IHJlcXVpcmUoImV2ZW50LWRvbSIpOwp2YXIgX3VybF8gPSByZXF1aXJlKCJ1cmwiKTsKdmFyIGV2ZW50Q3VzdG9tID0gcmVxdWlyZSgiZXZlbnQtY3VzdG9tIik7CnZhciBmZWF0dXJlID0gcmVxdWlyZSgiZmVhdHVyZSIpOwovKgpjb21iaW5lZCBtb2R1bGVzOgpyb3V0ZXIKcm91dGVyL3V0aWxzCnJvdXRlci9yb3V0ZQpyb3V0ZXIvcmVxdWVzdAoqLwp2YXIgcm91dGVyVXRpbHMsIHJvdXRlclJvdXRlLCByb3V0ZXJSZXF1ZXN0LCByb3V0ZXI7CnJvdXRlclV0aWxzID0gZnVuY3Rpb24gKGV4cG9ydHMpIHsKICAvKioKICAgKiB1dGlscyBmb3Igcm91dGVyCiAgICogQGF1dGhvciB5aW1pbmdoZUBnbWFpbC5jb20KICAgKi8KICB2YXIgdXRpbHM7CiAgdmFyIERvbUV2ZW50ID0gZXZlbnREb207CiAgdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKICBmdW5jdGlvbiByZW1vdmVWaWQoc3RyKSB7CiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL19fa3MtdmlkPS4rJC8sICcnKTsKICB9CiAgZnVuY3Rpb24gZ2V0VmlkRnJvbUhhc2goaGFzaCkgewogICAgdmFyIG07CiAgICBpZiAobSA9IGhhc2gubWF0Y2goL19fa3MtdmlkPSguKykkLykpIHsKICAgICAgcmV0dXJuIHBhcnNlSW50KG1bMV0sIDEwKTsKICAgIH0KICAgIHJldHVybiAwOwogIH0KICBmdW5jdGlvbiBnZXRGcmFnbWVudCh1cmwpIHsKICAgIHZhciBtID0gdXJsLm1hdGNoKC8jKC4rKSQvKTsKICAgIHJldHVybiBtICYmIG1bMV0gfHwgJyc7CiAgfQogIHV0aWxzID0gewogICAgbWl4OiBmdW5jdGlvbiAodCwgcykgewogICAgICBmb3IgKHZhciBwIGluIHMpIHsKICAgICAgICB0W3BdID0gc1twXTsKICAgICAgfQogICAgICByZXR1cm4gdDsKICAgIH0sCiAgICBpc0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIChvYmopIHsKICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJzsKICAgIH0sCiAgICB1cmxEZWNvZGU6IGZ1bmN0aW9uIChzKSB7CiAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocy5yZXBsYWNlKC9cKy9nLCAnICcpKTsKICAgIH0sCiAgICBzdGFydHNXaXRoOiBmdW5jdGlvbiAoc3RyLCBwcmVmaXgpIHsKICAgICAgcmV0dXJuIHN0ci5sYXN0SW5kZXhPZihwcmVmaXgsIDApID09PSAwOwogICAgfSwKICAgIGVuZFdpdGhTbGFzaDogZnVuY3Rpb24gKHN0cikgewogICAgICByZXR1cm4gc3RyLmNoYXJBdChzdHIubGVuZ3RoIC0gMSkgPT09ICcvJzsKICAgIH0sCiAgICBzdGFydFdpdGhTbGFzaDogZnVuY3Rpb24gKHN0cikgewogICAgICByZXR1cm4gc3RyLmNoYXJBdCgwKSA9PT0gJy8nOwogICAgfSwKICAgIHJlbW92ZUVuZFNsYXNoOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgIGlmICh0aGlzLmVuZFdpdGhTbGFzaChzdHIpKSB7CiAgICAgICAgc3RyID0gc3RyLnN1YnN0cmluZygwLCBzdHIubGVuZ3RoIC0gMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHN0cjsKICAgIH0sCiAgICByZW1vdmVTdGFydFNsYXNoOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgIGlmICh0aGlzLnN0YXJ0V2l0aFNsYXNoKHN0cikpIHsKICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKDEpOwogICAgICB9CiAgICAgIHJldHVybiBzdHI7CiAgICB9LAogICAgYWRkRW5kU2xhc2g6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlRW5kU2xhc2goc3RyKSArICcvJzsKICAgIH0sCiAgICBhZGRTdGFydFNsYXNoOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgIGlmIChzdHIpIHsKICAgICAgICByZXR1cm4gJy8nICsgdGhpcy5yZW1vdmVTdGFydFNsYXNoKHN0cik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgfQogICAgfSwKICAgIC8vIGdldCBmdWxsIHBhdGggZnJvbSBmcmFnbWVudCBmb3IgaHRtbCBoaXN0b3J5CiAgICBnZXRGdWxsUGF0aDogZnVuY3Rpb24gKGZyYWdtZW50LCB1cmxSb290KSB7CiAgICAgIHJldHVybiBsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0ICsgdGhpcy5yZW1vdmVFbmRTbGFzaCh1cmxSb290KSArIHRoaXMuYWRkU3RhcnRTbGFzaChmcmFnbWVudCk7CiAgICB9LAogICAgZXF1YWxzSWdub3JlU2xhc2g6IGZ1bmN0aW9uIChzdHIxLCBzdHIyKSB7CiAgICAgIHN0cjEgPSB0aGlzLnJlbW92ZUVuZFNsYXNoKHN0cjEpOwogICAgICBzdHIyID0gdGhpcy5yZW1vdmVFbmRTbGFzaChzdHIyKTsKICAgICAgcmV0dXJuIHN0cjEgPT09IHN0cjI7CiAgICB9LAogICAgZ2V0SGFzaDogZnVuY3Rpb24gKHVybCkgewogICAgICAvLyDkuI3og70gbG9jYXRpb24uaGFzaAogICAgICAvLyAxLgogICAgICAvLyBodHRwOi8veHguY29tLyN5eT96PTEKICAgICAgLy8gaWU2ID0+IGxvY2F0aW9uLmhhc2ggPSAjeXkKICAgICAgLy8g5YW25LuW5rWP6KeI5ZmoID0+IGxvY2F0aW9uLmhhc2ggPSAjeXk/ej0xCiAgICAgIC8vIDIuCiAgICAgIC8vICMhL2hvbWUvcT17JTIydGhlZGF0ZSUyMjolMjIyMDEyMTAxMH4yMDEyMTAxMCUyMn0KICAgICAgLy8gZmlyZWZveCAxNSA9PiAjIS9ob21lL3E9eyJ0aGVkYXRlIjoiMjAxMjEwMTB+MjAxMjEwMTAifQogICAgICAvLyAhISA6KAogICAgICByZXR1cm4gcmVtb3ZlVmlkKGdldEZyYWdtZW50KHVybCkucmVwbGFjZSgvXiEvLCAnJykpLnJlcGxhY2UoRG9tRXZlbnQuUkVQTEFDRV9ISVNUT1JZLCAnJyk7CiAgICB9LAogICAgcmVtb3ZlVmlkOiByZW1vdmVWaWQsCiAgICBoYXNWaWQ6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgcmV0dXJuIHN0ci5pbmRleE9mKCdfX2tzLXZpZD0nKSAhPT0gLTE7CiAgICB9LAogICAgYWRkVmlkOiBmdW5jdGlvbiAoc3RyLCB2aWQpIHsKICAgICAgcmV0dXJuIHN0ciArICdfX2tzLXZpZD0nICsgdmlkOwogICAgfSwKICAgIGdldFZpZEZyb21VcmxXaXRoSGFzaDogZnVuY3Rpb24gKHVybCkgewogICAgICByZXR1cm4gZ2V0VmlkRnJvbUhhc2goZ2V0RnJhZ21lbnQodXJsKSk7CiAgICB9LAogICAgZ2V0VmlkRnJvbUhhc2g6IGdldFZpZEZyb21IYXNoCiAgfTsKICBleHBvcnRzID0gdXRpbHM7CiAgcmV0dXJuIGV4cG9ydHM7Cn0oKTsKcm91dGVyUm91dGUgPSBmdW5jdGlvbiAoZXhwb3J0cykgewogIC8qKgogICAqIFJvdXRlciBkYXRhIHN0cnVjdHVyZQogICAqIEBhdXRob3IgeWltaW5naGVAZ21haWwuY29tCiAgICovCiAgdmFyIHV0aWwgPSByb3V0ZXJVdGlsczsKICAvKgogICB0cmFuc2Zvcm0gcm91dGUgZGVjbGFyYXRpb24gdG8gcm91dGVyIHJlZwogICBAcGFyYW0gc3RyCiAgIC9zZWFyY2gvOnEKICAgL3VzZXIvKnBhdGgKICAgKi8KICBmdW5jdGlvbiBwYXRoUmVnZXhwKHBhdGgsIGtleXMsIHN0cmljdCwgc2Vuc2l0aXZlKSB7CiAgICBpZiAodXRpbC5pc0FycmF5KHBhdGgpKSB7CiAgICAgIHBhdGggPSAnKCcgKyBwYXRoLmpvaW4oJ3wnKSArICcpJzsKICAgIH0KICAgIHBhdGggPSBwYXRoLmNvbmNhdChzdHJpY3QgPyAnJyA6ICcvPycpLnJlcGxhY2UoL1wvXCgvZywgJyg/Oi8nKS5yZXBsYWNlKC8oXC8pPyhcLik/OihcdyspKD86KFwoLio/XCkpKT8oXD8pPyhcKik/L2csIGZ1bmN0aW9uIChfLCBzbGFzaCwgZm9ybWF0LCBrZXksIGNhcHR1cmUsIG9wdGlvbmFsLCBzdGFyKSB7CiAgICAgIGtleXMucHVzaChrZXkpOwogICAgICBzbGFzaCA9IHNsYXNoIHx8ICcnOwogICAgICByZXR1cm4gJycgKyAob3B0aW9uYWwgPyAnJyA6IHNsYXNoKSArICcoPzonICsgKG9wdGlvbmFsID8gc2xhc2ggOiAnJykgKyAoZm9ybWF0IHx8ICcnKSArIChjYXB0dXJlIHx8IChmb3JtYXQgJiYgJyhbXi8uXSs/KScgfHwgJyhbXi9dKz8pJykpICsgJyknICsgKG9wdGlvbmFsIHx8ICcnKSArIChzdGFyID8gJygvKik/JyA6ICcnKTsKICAgIH0pLnJlcGxhY2UoLyhbXC8uXSkvZywgJ1xcJDEnKS5yZXBsYWNlKC9cKi9nLCAnKC4qKScpOwogICAgcmV0dXJuIHsKICAgICAga2V5czoga2V5cywKICAgICAgcmVnZXhwOiBuZXcgUmVnRXhwKCdeJyArIHBhdGggKyAnJCcsIHNlbnNpdGl2ZSA/ICcnIDogJ2knKQogICAgfTsKICB9CiAgZnVuY3Rpb24gUm91dGUocGF0aCwgY2FsbGJhY2tzLCBvcHRpb24pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHNlbGYucGF0aCA9IHBhdGg7CiAgICBzZWxmLmNhbGxiYWNrcyA9IGNhbGxiYWNrczsKICAgIHNlbGYua2V5cyA9IFtdOwogICAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJyB8fCB1dGlsLmlzQXJyYXkocGF0aCkpIHsKICAgICAgdXRpbC5taXgoc2VsZiwgcGF0aFJlZ2V4cChwYXRoLCBzZWxmLmtleXMsIG9wdGlvbi5zdHJpY3QsIG9wdGlvbi5jYXNlU2Vuc2l0aXZlKSk7CiAgICB9IGVsc2UgewogICAgICBzZWxmLnJlZ2V4cCA9IHBhdGg7CiAgICB9CiAgfQogIFJvdXRlLnByb3RvdHlwZSA9IHsKICAgIG1hdGNoOiBmdW5jdGlvbiAocGF0aCkgewogICAgICB2YXIgc2VsZiA9IHRoaXMsIG0gPSBwYXRoLm1hdGNoKHNlbGYucmVnZXhwKTsKICAgICAgaWYgKCFtKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHZhciBrZXlzID0gc2VsZi5rZXlzLCBwYXJhbXMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDEsIGxlbiA9IG0ubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICB2YXIga2V5ID0ga2V5c1tpIC0gMV07CiAgICAgICAgdmFyIHZhbCA9ICdzdHJpbmcnID09PSB0eXBlb2YgbVtpXSA/IHV0aWwudXJsRGVjb2RlKG1baV0pIDogbVtpXTsKICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICBwYXJhbXNba2V5XSA9IHZhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGFyYW1zLnB1c2godmFsKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHBhcmFtczsKICAgIH0sCiAgICByZW1vdmVDYWxsYmFjazogZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICAgIHZhciBjYWxsYmFja3MgPSB0aGlzLmNhbGxiYWNrcyB8fCBbXTsKICAgICAgZm9yICh2YXIgaSA9IGNhbGxiYWNrcy5sZW5ndGggLSAxOyBpID49IDA7IGkrKykgewogICAgICAgIGlmIChjYWxsYmFja3MgPT09IGNhbGxiYWNrKSB7CiAgICAgICAgICBjYWxsYmFja3Muc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CiAgZXhwb3J0cyA9IFJvdXRlOwogIHJldHVybiBleHBvcnRzOwp9KCk7CnJvdXRlclJlcXVlc3QgPSBmdW5jdGlvbiAoZXhwb3J0cykgewogIC8qKgogICAqIHJlcXVlc3QgZGF0YSBzdHJ1Y3R1cmUuIGluc3RhbmNlIHBhc3NlZCB0byByb3V0ZXIgY2FsbGJhY2tzCiAgICogQGF1dGhvciB5aW1pbmdoZUBnbWFpbC5jb20KICAgKi8KICBmdW5jdGlvbiBSZXF1ZXN0KGRhdGEpIHsKICAgIGZvciAodmFyIGQgaW4gZGF0YSkgewogICAgICB0aGlzW2RdID0gZGF0YVtkXTsKICAgIH0KICB9CiAgUmVxdWVzdC5wcm90b3R5cGUgPSB7CiAgICBwYXJhbTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBpZiAobmFtZSBpbiBzZWxmLnBhcmFtcykgewogICAgICAgIHJldHVybiBzZWxmLnBhcmFtc1tuYW1lXTsKICAgICAgfQogICAgICByZXR1cm4gc2VsZi5xdWVyeVtuYW1lXTsKICAgIH0KICB9OwogIGV4cG9ydHMgPSBSZXF1ZXN0OwogIHJldHVybiBleHBvcnRzOwp9KCk7CnJvdXRlciA9IGZ1bmN0aW9uIChleHBvcnRzKSB7CiAgZXhwb3J0cyA9IHt9OwogIHZhciBtaWRkbGV3YXJlcyA9IFtdOwogIHZhciByb3V0ZXMgPSBbXTsKICB2YXIgdXRpbHMgPSByb3V0ZXJVdGlsczsKICB2YXIgUm91dGUgPSByb3V0ZXJSb3V0ZTsKICB2YXIgdXJsID0gX3VybF87CiAgdmFyIFJlcXVlc3QgPSByb3V0ZXJSZXF1ZXN0OwogIHZhciBEb21FdmVudCA9IGV2ZW50RG9tOwogIHZhciBDdXN0b21FdmVudCA9IGV2ZW50Q3VzdG9tOwogIHZhciBnZXRWaWRGcm9tVXJsV2l0aEhhc2ggPSB1dGlscy5nZXRWaWRGcm9tVXJsV2l0aEhhc2g7CiAgdmFyIHdpbiA9IHdpbmRvdzsKICB2YXIgaGlzdG9yeSA9IHdpbi5oaXN0b3J5OwogIHZhciBzdXBwb3J0TmF0aXZlSGFzaENoYW5nZSA9IGZlYXR1cmUuaXNIYXNoQ2hhbmdlU3VwcG9ydGVkKCk7CiAgdmFyIHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlID0gISEoaGlzdG9yeSAmJiBoaXN0b3J5LnB1c2hTdGF0ZSk7CiAgdmFyIEJSRUFUSF9JTlRFUlZBTCA9IDEwMDsKICB2YXIgdmlld1VuaXF1ZUlkID0gMTA7CiAgdmFyIHZpZXdzSGlzdG9yeSA9IFt2aWV3VW5pcXVlSWRdOwogIHZhciBnbG9iYWxDb25maWcgPSB7CiAgICB1cmxSb290OiAnJywKICAgIHVzZUhhc2g6ICFzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZQogIH07CiAgZnVuY3Rpb24gc2V0UGF0aEJ5SGFzaChwYXRoLCByZXBsYWNlKSB7CiAgICB2YXIgaGFzaCA9IHV0aWxzLmFkZFZpZCgnIyEnICsgcGF0aCArIChzdXBwb3J0TmF0aXZlSGFzaENoYW5nZSA/ICcnIDogcmVwbGFjZSA/IERvbUV2ZW50LlJFUExBQ0VfSElTVE9SWSA6ICcnKSwgdmlld1VuaXF1ZUlkKTsKICAgIGlmIChyZXBsYWNlKSB7CiAgICAgIGxvY2F0aW9uLnJlcGxhY2UoaGFzaCk7CiAgICB9IGVsc2UgewogICAgICBsb2NhdGlvbi5oYXNoID0gaGFzaDsKICAgIH0KICB9CiAgZnVuY3Rpb24gZ2V0VXJsRm9yUm91dGVyKHVybFN0cikgewogICAgdXJsU3RyID0gdXJsU3RyIHx8IGxvY2F0aW9uLmhyZWY7CiAgICB2YXIgdXJpID0gdXJsLnBhcnNlKHVybFN0cik7CiAgICBpZiAoIWdsb2JhbENvbmZpZy51c2VIYXNoICYmIHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlKSB7CiAgICAgIHJldHVybiB1cmkucGF0aG5hbWUuc3Vic3RyKGdsb2JhbENvbmZpZy51cmxSb290Lmxlbmd0aCkgKyAodXJpLnNlYXJjaCB8fCAnJyk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gdXRpbHMuZ2V0SGFzaCh1cmxTdHIpOwogICAgfQogIH0KICBmdW5jdGlvbiBmaXJlTWlkZGxlV2FyZShyZXF1ZXN0LCByZXNwb25zZSwgY2IpIHsKICAgIHZhciBpbmRleCA9IC0xOwogICAgdmFyIGxlbiA9IG1pZGRsZXdhcmVzLmxlbmd0aDsKICAgIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgIGluZGV4Kys7CiAgICAgIGlmIChpbmRleCA9PT0gbGVuKSB7CiAgICAgICAgY2IocmVxdWVzdCwgcmVzcG9uc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBtaWRkbGV3YXJlID0gbWlkZGxld2FyZXNbaW5kZXhdOwogICAgICAgIGlmICh1dGlscy5zdGFydHNXaXRoKHJlcXVlc3QucGF0aCArICcvJywgbWlkZGxld2FyZVswXSArICcvJykpIHsKICAgICAgICAgIHZhciBwcmVmaXhMZW4gPSBtaWRkbGV3YXJlWzBdLmxlbmd0aDsKICAgICAgICAgIHJlcXVlc3QudXJsID0gcmVxdWVzdC51cmwuc2xpY2UocHJlZml4TGVuKTsKICAgICAgICAgIHZhciBwYXRoID0gcmVxdWVzdC5wYXRoOwogICAgICAgICAgcmVxdWVzdC5wYXRoID0gcmVxdWVzdC5wYXRoLnNsaWNlKHByZWZpeExlbik7CiAgICAgICAgICBtaWRkbGV3YXJlWzFdKHJlcXVlc3QsIG5leHQpOwogICAgICAgICAgcmVxdWVzdC51cmwgPSByZXF1ZXN0Lm9yaWdpbmFsVXJsOwogICAgICAgICAgcmVxdWVzdC5wYXRoID0gcGF0aDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV4dCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbmV4dCgpOwogIH0KICBmdW5jdGlvbiBmaXJlUm91dGVzKHJlcXVlc3QsIHJlc3BvbnNlKSB7CiAgICB2YXIgaW5kZXggPSAtMTsKICAgIHZhciBsZW4gPSByb3V0ZXMubGVuZ3RoOwogICAgZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgaW5kZXgrKzsKICAgICAgaWYgKGluZGV4ICE9PSBsZW4pIHsKICAgICAgICB2YXIgcm91dGUgPSByb3V0ZXNbaW5kZXhdOwogICAgICAgIGlmIChyZXF1ZXN0LnBhcmFtcyA9IHJvdXRlLm1hdGNoKHJlcXVlc3QucGF0aCkpIHsKICAgICAgICAgIHZhciBjYWxsYmFja0luZGV4ID0gLTE7CiAgICAgICAgICB2YXIgY2FsbGJhY2tzID0gcm91dGUuY2FsbGJhY2tzOwogICAgICAgICAgdmFyIGNhbGxiYWNrc0xlbiA9IGNhbGxiYWNrcy5sZW5ndGg7CiAgICAgICAgICB2YXIgbmV4dENhbGxiYWNrID0gZnVuY3Rpb24gKGNhdXNlKSB7CiAgICAgICAgICAgIGlmIChjYXVzZSA9PT0gJ3JvdXRlJykgewogICAgICAgICAgICAgIG5leHRDYWxsYmFjayA9IG51bGw7CiAgICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNhbGxiYWNrSW5kZXgrKzsKICAgICAgICAgICAgICBpZiAoY2FsbGJhY2tJbmRleCAhPT0gY2FsbGJhY2tzTGVuKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0LnJvdXRlID0gcm91dGU7CiAgICAgICAgICAgICAgICBjYWxsYmFja3NbY2FsbGJhY2tJbmRleF0ocmVxdWVzdCwgcmVzcG9uc2UsIG5leHRDYWxsYmFjayk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgbmV4dENhbGxiYWNrKCcnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV4dCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbmV4dCgpOwogIH0KICBmdW5jdGlvbiBkaXNwYXRjaChiYWNrd2FyZCwgcmVwbGFjZSkgewogICAgdmFyIHVybFN0ciA9IGdldFVybEZvclJvdXRlcigpOwogICAgdmFyIHVyaSA9IHVybC5wYXJzZSh1cmxTdHIsIHRydWUpOwogICAgdmFyIHF1ZXJ5ID0gdXJpLnF1ZXJ5OwogICAgdXJpLnNlYXJjaCA9ICcnOwogICAgdXJpLnF1ZXJ5ID0ge307CiAgICB2YXIgcGF0aCA9IHVybC5zdHJpbmdpZnkodXJpKSB8fCAnLyc7CiAgICB2YXIgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KHsKICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICBiYWNrd2FyZDogYmFja3dhcmQgPT09IHRydWUsCiAgICAgIHJlcGxhY2U6IHJlcGxhY2UgPT09IHRydWUsCiAgICAgIGZvcndhcmQ6IGJhY2t3YXJkID09PSBmYWxzZSAmJiByZXBsYWNlID09PSBmYWxzZSwKICAgICAgcGF0aDogcGF0aCwKICAgICAgdXJsOiB1cmxTdHIsCiAgICAgIG9yaWdpbmFsVXJsOiB1cmxTdHIKICAgIH0pOwogICAgdmFyIHJlc3BvbnNlID0geyByZWRpcmVjdDogZXhwb3J0cy5uYXZpZ2F0ZSB9OwogICAgZXhwb3J0cy5maXJlKCdkaXNwYXRjaCcsIHsKICAgICAgcmVxdWVzdDogcmVxdWVzdCwKICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlCiAgICB9KTsKICAgIGZpcmVNaWRkbGVXYXJlKHJlcXVlc3QsIHJlc3BvbnNlLCBmaXJlUm91dGVzKTsKICB9CiAgdXRpbHMubWl4KGV4cG9ydHMsIEN1c3RvbUV2ZW50LlRhcmdldCk7CiAgZXhwb3J0cy51c2UgPSBmdW5jdGlvbiAocHJlZml4LCBjYWxsYmFjaykgewogICAgaWYgKHR5cGVvZiBwcmVmaXggIT09ICdzdHJpbmcnKSB7CiAgICAgIGNhbGxiYWNrID0gcHJlZml4OwogICAgICBwcmVmaXggPSAnJzsKICAgIH0KICAgIG1pZGRsZXdhcmVzLnB1c2goWwogICAgICBwcmVmaXgsCiAgICAgIGNhbGxiYWNrCiAgICBdKTsKICB9OwogIGV4cG9ydHMubmF2aWdhdGUgPSBmdW5jdGlvbiAocGF0aCwgb3B0cykgewogICAgb3B0cyA9IG9wdHMgfHwge307CiAgICB2YXIgcmVwbGFjZSA9IG9wdHMucmVwbGFjZSB8fCBmYWxzZTsKICAgIHZhciB1cmxTdHIgPSBnZXRVcmxGb3JSb3V0ZXIoKTsKICAgIHZhciB1cmkgPSB1cmwucGFyc2UodXJsU3RyKTsKICAgIGlmIChwYXRoLmNoYXJBdCgwKSA9PT0gJz8nKSB7CiAgICAgIHVyaS5zZWFyY2ggPSBwYXRoOwogICAgICBwYXRoID0gdXJsLnN0cmluZ2lmeSh1cmkpOwogICAgfQogICAgaWYgKHVybFN0ciAhPT0gcGF0aCkgewogICAgICBpZiAoIXJlcGxhY2UpIHsKICAgICAgICB2aWV3VW5pcXVlSWQrKzsKICAgICAgICB2aWV3c0hpc3RvcnkucHVzaCh2aWV3VW5pcXVlSWQpOwogICAgICB9CiAgICAgIGlmICghZ2xvYmFsQ29uZmlnLnVzZUhhc2ggJiYgc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUpIHsKICAgICAgICBoaXN0b3J5W3JlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7IHZpZDogdmlld1VuaXF1ZUlkIH0sICcnLCB1dGlscy5nZXRGdWxsUGF0aChwYXRoLCBnbG9iYWxDb25maWcudXJsUm9vdCkpOwogICAgICAgIGRpc3BhdGNoKGZhbHNlLCByZXBsYWNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUpIHsKICAgICAgICAgIGhpc3RvcnlbcmVwbGFjZSA/ICdyZXBsYWNlU3RhdGUnIDogJ3B1c2hTdGF0ZSddKHsgdmlkOiB2aWV3VW5pcXVlSWQgfSwgJycsICcjIScgKyBwYXRoKTsKICAgICAgICAgIGRpc3BhdGNoKGZhbHNlLCByZXBsYWNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2V0UGF0aEJ5SGFzaChwYXRoLCByZXBsYWNlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAob3B0cyAmJiBvcHRzLnRyaWdnZXJSb3V0ZSkgewogICAgICBkaXNwYXRjaChmYWxzZSwgdHJ1ZSk7CiAgICB9CiAgfTsKICBleHBvcnRzLmdldCA9IGZ1bmN0aW9uIChyb3V0ZVBhdGgpIHsKICAgIHZhciBjYWxsYmFja3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICByb3V0ZXMucHVzaChuZXcgUm91dGUocm91dGVQYXRoLCBjYWxsYmFja3MsIGdsb2JhbENvbmZpZykpOwogIH07CiAgZXhwb3J0cy5tYXRjaFJvdXRlID0gZnVuY3Rpb24gKHBhdGgpIHsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcm91dGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBpZiAocm91dGVzW2ldLm1hdGNoKHBhdGgpKSB7CiAgICAgICAgcmV0dXJuIHJvdXRlc1tpXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH07CiAgZXhwb3J0cy5yZW1vdmVSb3V0ZSA9IGZ1bmN0aW9uIChyb3V0ZVBhdGgsIGNhbGxiYWNrKSB7CiAgICBmb3IgKHZhciBpID0gcm91dGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgIHZhciByID0gcm91dGVzW2ldOwogICAgICBpZiAoci5wYXRoID09PSByb3V0ZVBhdGgpIHsKICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgIHIucmVtb3ZlQ2FsbGJhY2soY2FsbGJhY2spOwogICAgICAgICAgaWYgKCFyLmNhbGxiYWNrcy5sZW5ndGgpIHsKICAgICAgICAgICAgcm91dGVzLnNwbGljZShpLCAxKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcm91dGVzLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwogIGV4cG9ydHMuY2xlYXJSb3V0ZXMgPSBmdW5jdGlvbiAoKSB7CiAgICBtaWRkbGV3YXJlcyA9IFtdOwogICAgcm91dGVzID0gW107CiAgfTsKICBleHBvcnRzLmhhc1JvdXRlID0gZnVuY3Rpb24gKHJvdXRlUGF0aCkgewogICAgZm9yICh2YXIgaSA9IDAsIGwgPSByb3V0ZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIGlmIChyb3V0ZXNbaV0ucGF0aCA9PT0gcm91dGVQYXRoKSB7CiAgICAgICAgcmV0dXJuIHJvdXRlc1tpXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH07CiAgZnVuY3Rpb24gZGlzcGF0Y2hCeVZpZCh2aWQpIHsKICAgIHZhciBiYWNrd2FyZCA9IGZhbHNlOwogICAgdmFyIHJlcGxhY2UgPSBmYWxzZTsKICAgIGlmICh2aWQgPT09IHZpZXdzSGlzdG9yeVt2aWV3c0hpc3RvcnkubGVuZ3RoIC0gMl0pIHsKICAgICAgYmFja3dhcmQgPSB0cnVlOwogICAgICB2aWV3c0hpc3RvcnkucG9wKCk7CiAgICB9IGVsc2UgaWYgKHZpZCAhPT0gdmlld3NIaXN0b3J5W3ZpZXdzSGlzdG9yeS5sZW5ndGggLSAxXSkgewogICAgICB2aWV3c0hpc3RvcnkucHVzaCh2aWQpOwogICAgfSBlbHNlIHsKICAgICAgcmVwbGFjZSA9IHRydWU7CiAgICB9CiAgICBkaXNwYXRjaChiYWNrd2FyZCwgcmVwbGFjZSk7CiAgfQogIGZ1bmN0aW9uIG9uUG9wU3RhdGUoZSkgewogICAgdmFyIHN0YXRlID0gZS5vcmlnaW5hbEV2ZW50LnN0YXRlOwogICAgaWYgKCFzdGF0ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBkaXNwYXRjaEJ5VmlkKHN0YXRlLnZpZCk7CiAgfQogIGZ1bmN0aW9uIG9uSGFzaENoYW5nZShlKSB7CiAgICB2YXIgbmV3VVJMID0gZS5uZXdVUkwgfHwgbG9jYXRpb24uaHJlZjsKICAgIHZhciB2aWQgPSBnZXRWaWRGcm9tVXJsV2l0aEhhc2gobmV3VVJMKTsKICAgIGlmICghdmlkKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGRpc3BhdGNoQnlWaWQodmlkKTsKICB9CiAgZXhwb3J0cy5jb25maWcgPSBmdW5jdGlvbiAob3B0cykgewogICAgaWYgKG9wdHMudXJsUm9vdCkgewogICAgICBvcHRzLnVybFJvb3QgPSBvcHRzLnVybFJvb3QucmVwbGFjZSgvXC8kLywgJycpOwogICAgfQogICAgdXRpbHMubWl4KGdsb2JhbENvbmZpZywgb3B0cyk7CiAgfTsKICB2YXIgc3RhcnRlZDsKICBleHBvcnRzLnN0YXJ0ID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICBpZiAoc3RhcnRlZCkgewogICAgICByZXR1cm4gY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbChleHBvcnRzKTsKICAgIH0KICAgIHZhciB1c2VIYXNoID0gZ2xvYmFsQ29uZmlnLnVzZUhhc2gsIHVybFJvb3QgPSBnbG9iYWxDb25maWcudXJsUm9vdCwgdHJpZ2dlclJvdXRlID0gZ2xvYmFsQ29uZmlnLnRyaWdnZXJSb3V0ZSwgbG9jUGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lLCBocmVmID0gbG9jYXRpb24uaHJlZiwgaGFzaCA9IGdldFVybEZvclJvdXRlcigpLCBoYXNoSXNWYWxpZCA9IGxvY2F0aW9uLmhhc2gubWF0Y2goLyMhLisvKTsKICAgIGlmICghdXNlSGFzaCkgewogICAgICBpZiAoc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUpIHsKICAgICAgICBpZiAoaGFzaElzVmFsaWQpIHsKICAgICAgICAgIGlmICghdXJsUm9vdCkgewogICAgICAgICAgICB2YXIgdG1wID0gbG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMik7CiAgICAgICAgICAgIGlmICh0bXBbMF0gPT09ICcvJykgewogICAgICAgICAgICAgIHRtcCA9IHRtcC5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sICcnLCBocmVmID0gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdCArIGxvY2F0aW9uLnBhdGhuYW1lICsgdG1wKTsKICAgICAgICAgICAgdHJpZ2dlclJvdXRlID0gMTsKICAgICAgICAgIH0gZWxzZSBpZiAodXRpbHMuZXF1YWxzSWdub3JlU2xhc2gobG9jUGF0aCwgdXJsUm9vdCkpIHsKICAgICAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sICcnLCBocmVmID0gdXRpbHMuZ2V0RnVsbFBhdGgoaGFzaCwgdXJsUm9vdCkpOwogICAgICAgICAgICB0cmlnZ2VyUm91dGUgPSAxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigncm91dGVyOiBsb2NhdGlvbiBwYXRoIG11c3QgYmUgc2FtZSB3aXRoIHVybFJvb3QhJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCF1dGlscy5lcXVhbHNJZ25vcmVTbGFzaChsb2NQYXRoLCB1cmxSb290KSkgewogICAgICAgIGxvY2F0aW9uLnJlcGxhY2UodXRpbHMuYWRkRW5kU2xhc2godXJsUm9vdCkgKyAnIyEnICsgaGFzaCk7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfSBlbHNlIHsKICAgICAgICB1c2VIYXNoID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBuZWVkUmVwbGFjZUhpc3RvcnkgPSBzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZTsKICAgICAgaWYgKHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlKSB7CiAgICAgICAgRG9tRXZlbnQub24od2luLCAncG9wc3RhdGUnLCBvblBvcFN0YXRlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBEb21FdmVudC5vbih3aW4sICdoYXNoY2hhbmdlJywgb25IYXNoQ2hhbmdlKTsKICAgICAgICB0cmlnZ2VyUm91dGUgPSAxOwogICAgICB9CiAgICAgIGlmICh1c2VIYXNoKSB7CiAgICAgICAgaWYgKCFnZXRVcmxGb3JSb3V0ZXIoKSkgewogICAgICAgICAgZXhwb3J0cy5uYXZpZ2F0ZSgnLycsIHsgcmVwbGFjZTogdHJ1ZSB9KTsKICAgICAgICAgIHRyaWdnZXJSb3V0ZSA9IDA7CiAgICAgICAgICBuZWVkUmVwbGFjZUhpc3RvcnkgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKCFzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSAmJiBnZXRWaWRGcm9tVXJsV2l0aEhhc2goaHJlZikgIT09IHZpZXdVbmlxdWVJZCkgewogICAgICAgICAgc2V0UGF0aEJ5SGFzaCh1dGlscy5nZXRIYXNoKGhyZWYpLCB0cnVlKTsKICAgICAgICAgIHRyaWdnZXJSb3V0ZSA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSAmJiB1dGlscy5oYXNWaWQoaHJlZikpIHsKICAgICAgICAgIGxvY2F0aW9uLnJlcGxhY2UoaHJlZiA9IHV0aWxzLnJlbW92ZVZpZChocmVmKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChuZWVkUmVwbGFjZUhpc3RvcnkpIHsKICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSh7IHZpZDogdmlld1VuaXF1ZUlkIH0sICcnLCBocmVmKTsKICAgICAgfQogICAgICBpZiAodHJpZ2dlclJvdXRlKSB7CiAgICAgICAgZGlzcGF0Y2goZmFsc2UsIHRydWUpOwogICAgICB9CiAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgIGNhbGxiYWNrKGV4cG9ydHMpOwogICAgICB9CiAgICB9LCBCUkVBVEhfSU5URVJWQUwpOwogICAgc3RhcnRlZCA9IHRydWU7CiAgICByZXR1cm4gZXhwb3J0czsKICB9OwogIGV4cG9ydHMuVXRpbHMgPSB1dGlsczsKICBleHBvcnRzLnZlcnNpb24gPSAnMS4wLjEnOwogIGV4cG9ydHMuc3RvcCA9IGZ1bmN0aW9uICgpIHsKICAgIHN0YXJ0ZWQgPSBmYWxzZTsKICAgIERvbUV2ZW50LmRldGFjaCh3aW4sICdoYXNoY2hhbmdlJywgb25IYXNoQ2hhbmdlKTsKICAgIERvbUV2ZW50LmRldGFjaCh3aW4sICdwb3BzdGF0ZScsIG9uUG9wU3RhdGUpOwogIH07CiAgcmV0dXJuIGV4cG9ydHM7Cn0oKTsKbW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Cn0pOw==",
                "body": "LyoKQ29weXJpZ2h0IDIwMTQsIG1vZHVsZXgtcm91dGVyQDEuMC4xCk1JVCBMaWNlbnNlZApidWlsZCB0aW1lOiBUaHUsIDE2IE9jdCAyMDE0IDA3OjAyOjE4IEdNVAoqLwptb2R1bGV4LmFkZCgicm91dGVyIiwgWyJldmVudC1kb20iLCJ1cmwiLCJldmVudC1jdXN0b20iLCJmZWF0dXJlIl0sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewp2YXIgZXZlbnREb20gPSByZXF1aXJlKCJldmVudC1kb20iKTsKdmFyIF91cmxfID0gcmVxdWlyZSgidXJsIik7CnZhciBldmVudEN1c3RvbSA9IHJlcXVpcmUoImV2ZW50LWN1c3RvbSIpOwp2YXIgZmVhdHVyZSA9IHJlcXVpcmUoImZlYXR1cmUiKTsKLyoKY29tYmluZWQgbW9kdWxlczoKcm91dGVyCnJvdXRlci91dGlscwpyb3V0ZXIvcm91dGUKcm91dGVyL3JlcXVlc3QKKi8KdmFyIHJvdXRlclV0aWxzLCByb3V0ZXJSb3V0ZSwgcm91dGVyUmVxdWVzdCwgcm91dGVyOwpyb3V0ZXJVdGlscyA9IGZ1bmN0aW9uIChleHBvcnRzKSB7CiAgLyoqCiAgICogdXRpbHMgZm9yIHJvdXRlcgogICAqIEBhdXRob3IgeWltaW5naGVAZ21haWwuY29tCiAgICovCiAgdmFyIHV0aWxzOwogIHZhciBEb21FdmVudCA9IGV2ZW50RG9tOwogIHZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CiAgZnVuY3Rpb24gcmVtb3ZlVmlkKHN0cikgewogICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9fX2tzLXZpZD0uKyQvLCAnJyk7CiAgfQogIGZ1bmN0aW9uIGdldFZpZEZyb21IYXNoKGhhc2gpIHsKICAgIHZhciBtOwogICAgaWYgKG0gPSBoYXNoLm1hdGNoKC9fX2tzLXZpZD0oLispJC8pKSB7CiAgICAgIHJldHVybiBwYXJzZUludChtWzFdLCAxMCk7CiAgICB9CiAgICByZXR1cm4gMDsKICB9CiAgZnVuY3Rpb24gZ2V0RnJhZ21lbnQodXJsKSB7CiAgICB2YXIgbSA9IHVybC5tYXRjaCgvIyguKykkLyk7CiAgICByZXR1cm4gbSAmJiBtWzFdIHx8ICcnOwogIH0KICB1dGlscyA9IHsKICAgIG1peDogZnVuY3Rpb24gKHQsIHMpIHsKICAgICAgZm9yICh2YXIgcCBpbiBzKSB7CiAgICAgICAgdFtwXSA9IHNbcF07CiAgICAgIH0KICAgICAgcmV0dXJuIHQ7CiAgICB9LAogICAgaXNBcnJheTogQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAob2JqKSB7CiAgICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgICB9LAogICAgdXJsRGVjb2RlOiBmdW5jdGlvbiAocykgewogICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHMucmVwbGFjZSgvXCsvZywgJyAnKSk7CiAgICB9LAogICAgc3RhcnRzV2l0aDogZnVuY3Rpb24gKHN0ciwgcHJlZml4KSB7CiAgICAgIHJldHVybiBzdHIubGFzdEluZGV4T2YocHJlZml4LCAwKSA9PT0gMDsKICAgIH0sCiAgICBlbmRXaXRoU2xhc2g6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgcmV0dXJuIHN0ci5jaGFyQXQoc3RyLmxlbmd0aCAtIDEpID09PSAnLyc7CiAgICB9LAogICAgc3RhcnRXaXRoU2xhc2g6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgcmV0dXJuIHN0ci5jaGFyQXQoMCkgPT09ICcvJzsKICAgIH0sCiAgICByZW1vdmVFbmRTbGFzaDogZnVuY3Rpb24gKHN0cikgewogICAgICBpZiAodGhpcy5lbmRXaXRoU2xhc2goc3RyKSkgewogICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCAtIDEpOwogICAgICB9CiAgICAgIHJldHVybiBzdHI7CiAgICB9LAogICAgcmVtb3ZlU3RhcnRTbGFzaDogZnVuY3Rpb24gKHN0cikgewogICAgICBpZiAodGhpcy5zdGFydFdpdGhTbGFzaChzdHIpKSB7CiAgICAgICAgc3RyID0gc3RyLnN1YnN0cmluZygxKTsKICAgICAgfQogICAgICByZXR1cm4gc3RyOwogICAgfSwKICAgIGFkZEVuZFNsYXNoOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgIHJldHVybiB0aGlzLnJlbW92ZUVuZFNsYXNoKHN0cikgKyAnLyc7CiAgICB9LAogICAgYWRkU3RhcnRTbGFzaDogZnVuY3Rpb24gKHN0cikgewogICAgICBpZiAoc3RyKSB7CiAgICAgICAgcmV0dXJuICcvJyArIHRoaXMucmVtb3ZlU3RhcnRTbGFzaChzdHIpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBzdHI7CiAgICAgIH0KICAgIH0sCiAgICAvLyBnZXQgZnVsbCBwYXRoIGZyb20gZnJhZ21lbnQgZm9yIGh0bWwgaGlzdG9yeQogICAgZ2V0RnVsbFBhdGg6IGZ1bmN0aW9uIChmcmFnbWVudCwgdXJsUm9vdCkgewogICAgICByZXR1cm4gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdCArIHRoaXMucmVtb3ZlRW5kU2xhc2godXJsUm9vdCkgKyB0aGlzLmFkZFN0YXJ0U2xhc2goZnJhZ21lbnQpOwogICAgfSwKICAgIGVxdWFsc0lnbm9yZVNsYXNoOiBmdW5jdGlvbiAoc3RyMSwgc3RyMikgewogICAgICBzdHIxID0gdGhpcy5yZW1vdmVFbmRTbGFzaChzdHIxKTsKICAgICAgc3RyMiA9IHRoaXMucmVtb3ZlRW5kU2xhc2goc3RyMik7CiAgICAgIHJldHVybiBzdHIxID09PSBzdHIyOwogICAgfSwKICAgIGdldEhhc2g6IGZ1bmN0aW9uICh1cmwpIHsKICAgICAgLy8g5LiN6IO9IGxvY2F0aW9uLmhhc2gKICAgICAgLy8gMS4KICAgICAgLy8gaHR0cDovL3h4LmNvbS8jeXk/ej0xCiAgICAgIC8vIGllNiA9PiBsb2NhdGlvbi5oYXNoID0gI3l5CiAgICAgIC8vIOWFtuS7lua1j+iniOWZqCA9PiBsb2NhdGlvbi5oYXNoID0gI3l5P3o9MQogICAgICAvLyAyLgogICAgICAvLyAjIS9ob21lL3E9eyUyMnRoZWRhdGUlMjI6JTIyMjAxMjEwMTB+MjAxMjEwMTAlMjJ9CiAgICAgIC8vIGZpcmVmb3ggMTUgPT4gIyEvaG9tZS9xPXsidGhlZGF0ZSI6IjIwMTIxMDEwfjIwMTIxMDEwIn0KICAgICAgLy8gISEgOigKICAgICAgcmV0dXJuIHJlbW92ZVZpZChnZXRGcmFnbWVudCh1cmwpLnJlcGxhY2UoL14hLywgJycpKS5yZXBsYWNlKERvbUV2ZW50LlJFUExBQ0VfSElTVE9SWSwgJycpOwogICAgfSwKICAgIHJlbW92ZVZpZDogcmVtb3ZlVmlkLAogICAgaGFzVmlkOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgIHJldHVybiBzdHIuaW5kZXhPZignX19rcy12aWQ9JykgIT09IC0xOwogICAgfSwKICAgIGFkZFZpZDogZnVuY3Rpb24gKHN0ciwgdmlkKSB7CiAgICAgIHJldHVybiBzdHIgKyAnX19rcy12aWQ9JyArIHZpZDsKICAgIH0sCiAgICBnZXRWaWRGcm9tVXJsV2l0aEhhc2g6IGZ1bmN0aW9uICh1cmwpIHsKICAgICAgcmV0dXJuIGdldFZpZEZyb21IYXNoKGdldEZyYWdtZW50KHVybCkpOwogICAgfSwKICAgIGdldFZpZEZyb21IYXNoOiBnZXRWaWRGcm9tSGFzaAogIH07CiAgZXhwb3J0cyA9IHV0aWxzOwogIHJldHVybiBleHBvcnRzOwp9KCk7CnJvdXRlclJvdXRlID0gZnVuY3Rpb24gKGV4cG9ydHMpIHsKICAvKioKICAgKiBSb3V0ZXIgZGF0YSBzdHJ1Y3R1cmUKICAgKiBAYXV0aG9yIHlpbWluZ2hlQGdtYWlsLmNvbQogICAqLwogIHZhciB1dGlsID0gcm91dGVyVXRpbHM7CiAgLyoKICAgdHJhbnNmb3JtIHJvdXRlIGRlY2xhcmF0aW9uIHRvIHJvdXRlciByZWcKICAgQHBhcmFtIHN0cgogICAvc2VhcmNoLzpxCiAgIC91c2VyLypwYXRoCiAgICovCiAgZnVuY3Rpb24gcGF0aFJlZ2V4cChwYXRoLCBrZXlzLCBzdHJpY3QsIHNlbnNpdGl2ZSkgewogICAgaWYgKHV0aWwuaXNBcnJheShwYXRoKSkgewogICAgICBwYXRoID0gJygnICsgcGF0aC5qb2luKCd8JykgKyAnKSc7CiAgICB9CiAgICBwYXRoID0gcGF0aC5jb25jYXQoc3RyaWN0ID8gJycgOiAnLz8nKS5yZXBsYWNlKC9cL1woL2csICcoPzovJykucmVwbGFjZSgvKFwvKT8oXC4pPzooXHcrKSg/OihcKC4qP1wpKSk/KFw/KT8oXCopPy9nLCBmdW5jdGlvbiAoXywgc2xhc2gsIGZvcm1hdCwga2V5LCBjYXB0dXJlLCBvcHRpb25hbCwgc3RhcikgewogICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAgc2xhc2ggPSBzbGFzaCB8fCAnJzsKICAgICAgcmV0dXJuICcnICsgKG9wdGlvbmFsID8gJycgOiBzbGFzaCkgKyAnKD86JyArIChvcHRpb25hbCA/IHNsYXNoIDogJycpICsgKGZvcm1hdCB8fCAnJykgKyAoY2FwdHVyZSB8fCAoZm9ybWF0ICYmICcoW14vLl0rPyknIHx8ICcoW14vXSs/KScpKSArICcpJyArIChvcHRpb25hbCB8fCAnJykgKyAoc3RhciA/ICcoLyopPycgOiAnJyk7CiAgICB9KS5yZXBsYWNlKC8oW1wvLl0pL2csICdcXCQxJykucmVwbGFjZSgvXCovZywgJyguKiknKTsKICAgIHJldHVybiB7CiAgICAgIGtleXM6IGtleXMsCiAgICAgIHJlZ2V4cDogbmV3IFJlZ0V4cCgnXicgKyBwYXRoICsgJyQnLCBzZW5zaXRpdmUgPyAnJyA6ICdpJykKICAgIH07CiAgfQogIGZ1bmN0aW9uIFJvdXRlKHBhdGgsIGNhbGxiYWNrcywgb3B0aW9uKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLnBhdGggPSBwYXRoOwogICAgc2VsZi5jYWxsYmFja3MgPSBjYWxsYmFja3M7CiAgICBzZWxmLmtleXMgPSBbXTsKICAgIGlmICh0eXBlb2YgcGF0aCA9PT0gJ3N0cmluZycgfHwgdXRpbC5pc0FycmF5KHBhdGgpKSB7CiAgICAgIHV0aWwubWl4KHNlbGYsIHBhdGhSZWdleHAocGF0aCwgc2VsZi5rZXlzLCBvcHRpb24uc3RyaWN0LCBvcHRpb24uY2FzZVNlbnNpdGl2ZSkpOwogICAgfSBlbHNlIHsKICAgICAgc2VsZi5yZWdleHAgPSBwYXRoOwogICAgfQogIH0KICBSb3V0ZS5wcm90b3R5cGUgPSB7CiAgICBtYXRjaDogZnVuY3Rpb24gKHBhdGgpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzLCBtID0gcGF0aC5tYXRjaChzZWxmLnJlZ2V4cCk7CiAgICAgIGlmICghbSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB2YXIga2V5cyA9IHNlbGYua2V5cywgcGFyYW1zID0gW107CiAgICAgIGZvciAodmFyIGkgPSAxLCBsZW4gPSBtLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgdmFyIGtleSA9IGtleXNbaSAtIDFdOwogICAgICAgIHZhciB2YWwgPSAnc3RyaW5nJyA9PT0gdHlwZW9mIG1baV0gPyB1dGlsLnVybERlY29kZShtW2ldKSA6IG1baV07CiAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgcGFyYW1zW2tleV0gPSB2YWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhcmFtcy5wdXNoKHZhbCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBwYXJhbXM7CiAgICB9LAogICAgcmVtb3ZlQ2FsbGJhY2s6IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICB2YXIgY2FsbGJhY2tzID0gdGhpcy5jYWxsYmFja3MgfHwgW107CiAgICAgIGZvciAodmFyIGkgPSBjYWxsYmFja3MubGVuZ3RoIC0gMTsgaSA+PSAwOyBpKyspIHsKICAgICAgICBpZiAoY2FsbGJhY2tzID09PSBjYWxsYmFjaykgewogICAgICAgICAgY2FsbGJhY2tzLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwogIGV4cG9ydHMgPSBSb3V0ZTsKICByZXR1cm4gZXhwb3J0czsKfSgpOwpyb3V0ZXJSZXF1ZXN0ID0gZnVuY3Rpb24gKGV4cG9ydHMpIHsKICAvKioKICAgKiByZXF1ZXN0IGRhdGEgc3RydWN0dXJlLiBpbnN0YW5jZSBwYXNzZWQgdG8gcm91dGVyIGNhbGxiYWNrcwogICAqIEBhdXRob3IgeWltaW5naGVAZ21haWwuY29tCiAgICovCiAgZnVuY3Rpb24gUmVxdWVzdChkYXRhKSB7CiAgICBmb3IgKHZhciBkIGluIGRhdGEpIHsKICAgICAgdGhpc1tkXSA9IGRhdGFbZF07CiAgICB9CiAgfQogIFJlcXVlc3QucHJvdG90eXBlID0gewogICAgcGFyYW06IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgaWYgKG5hbWUgaW4gc2VsZi5wYXJhbXMpIHsKICAgICAgICByZXR1cm4gc2VsZi5wYXJhbXNbbmFtZV07CiAgICAgIH0KICAgICAgcmV0dXJuIHNlbGYucXVlcnlbbmFtZV07CiAgICB9CiAgfTsKICBleHBvcnRzID0gUmVxdWVzdDsKICByZXR1cm4gZXhwb3J0czsKfSgpOwpyb3V0ZXIgPSBmdW5jdGlvbiAoZXhwb3J0cykgewogIGV4cG9ydHMgPSB7fTsKICB2YXIgbWlkZGxld2FyZXMgPSBbXTsKICB2YXIgcm91dGVzID0gW107CiAgdmFyIHV0aWxzID0gcm91dGVyVXRpbHM7CiAgdmFyIFJvdXRlID0gcm91dGVyUm91dGU7CiAgdmFyIHVybCA9IF91cmxfOwogIHZhciBSZXF1ZXN0ID0gcm91dGVyUmVxdWVzdDsKICB2YXIgRG9tRXZlbnQgPSBldmVudERvbTsKICB2YXIgQ3VzdG9tRXZlbnQgPSBldmVudEN1c3RvbTsKICB2YXIgZ2V0VmlkRnJvbVVybFdpdGhIYXNoID0gdXRpbHMuZ2V0VmlkRnJvbVVybFdpdGhIYXNoOwogIHZhciB3aW4gPSB3aW5kb3c7CiAgdmFyIGhpc3RvcnkgPSB3aW4uaGlzdG9yeTsKICB2YXIgc3VwcG9ydE5hdGl2ZUhhc2hDaGFuZ2UgPSBmZWF0dXJlLmlzSGFzaENoYW5nZVN1cHBvcnRlZCgpOwogIHZhciBzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSA9ICEhKGhpc3RvcnkgJiYgaGlzdG9yeS5wdXNoU3RhdGUpOwogIHZhciBCUkVBVEhfSU5URVJWQUwgPSAxMDA7CiAgdmFyIHZpZXdVbmlxdWVJZCA9IDEwOwogIHZhciB2aWV3c0hpc3RvcnkgPSBbdmlld1VuaXF1ZUlkXTsKICB2YXIgZ2xvYmFsQ29uZmlnID0gewogICAgdXJsUm9vdDogJycsCiAgICB1c2VIYXNoOiAhc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUKICB9OwogIGZ1bmN0aW9uIHNldFBhdGhCeUhhc2gocGF0aCwgcmVwbGFjZSkgewogICAgdmFyIGhhc2ggPSB1dGlscy5hZGRWaWQoJyMhJyArIHBhdGggKyAoc3VwcG9ydE5hdGl2ZUhhc2hDaGFuZ2UgPyAnJyA6IHJlcGxhY2UgPyBEb21FdmVudC5SRVBMQUNFX0hJU1RPUlkgOiAnJyksIHZpZXdVbmlxdWVJZCk7CiAgICBpZiAocmVwbGFjZSkgewogICAgICBsb2NhdGlvbi5yZXBsYWNlKGhhc2gpOwogICAgfSBlbHNlIHsKICAgICAgbG9jYXRpb24uaGFzaCA9IGhhc2g7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGdldFVybEZvclJvdXRlcih1cmxTdHIpIHsKICAgIHVybFN0ciA9IHVybFN0ciB8fCBsb2NhdGlvbi5ocmVmOwogICAgdmFyIHVyaSA9IHVybC5wYXJzZSh1cmxTdHIpOwogICAgaWYgKCFnbG9iYWxDb25maWcudXNlSGFzaCAmJiBzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSkgewogICAgICByZXR1cm4gdXJpLnBhdGhuYW1lLnN1YnN0cihnbG9iYWxDb25maWcudXJsUm9vdC5sZW5ndGgpICsgKHVyaS5zZWFyY2ggfHwgJycpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHV0aWxzLmdldEhhc2godXJsU3RyKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gZmlyZU1pZGRsZVdhcmUocmVxdWVzdCwgcmVzcG9uc2UsIGNiKSB7CiAgICB2YXIgaW5kZXggPSAtMTsKICAgIHZhciBsZW4gPSBtaWRkbGV3YXJlcy5sZW5ndGg7CiAgICBmdW5jdGlvbiBuZXh0KCkgewogICAgICBpbmRleCsrOwogICAgICBpZiAoaW5kZXggPT09IGxlbikgewogICAgICAgIGNiKHJlcXVlc3QsIHJlc3BvbnNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgbWlkZGxld2FyZSA9IG1pZGRsZXdhcmVzW2luZGV4XTsKICAgICAgICBpZiAodXRpbHMuc3RhcnRzV2l0aChyZXF1ZXN0LnBhdGggKyAnLycsIG1pZGRsZXdhcmVbMF0gKyAnLycpKSB7CiAgICAgICAgICB2YXIgcHJlZml4TGVuID0gbWlkZGxld2FyZVswXS5sZW5ndGg7CiAgICAgICAgICByZXF1ZXN0LnVybCA9IHJlcXVlc3QudXJsLnNsaWNlKHByZWZpeExlbik7CiAgICAgICAgICB2YXIgcGF0aCA9IHJlcXVlc3QucGF0aDsKICAgICAgICAgIHJlcXVlc3QucGF0aCA9IHJlcXVlc3QucGF0aC5zbGljZShwcmVmaXhMZW4pOwogICAgICAgICAgbWlkZGxld2FyZVsxXShyZXF1ZXN0LCBuZXh0KTsKICAgICAgICAgIHJlcXVlc3QudXJsID0gcmVxdWVzdC5vcmlnaW5hbFVybDsKICAgICAgICAgIHJlcXVlc3QucGF0aCA9IHBhdGg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5leHQoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIG5leHQoKTsKICB9CiAgZnVuY3Rpb24gZmlyZVJvdXRlcyhyZXF1ZXN0LCByZXNwb25zZSkgewogICAgdmFyIGluZGV4ID0gLTE7CiAgICB2YXIgbGVuID0gcm91dGVzLmxlbmd0aDsKICAgIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgIGluZGV4Kys7CiAgICAgIGlmIChpbmRleCAhPT0gbGVuKSB7CiAgICAgICAgdmFyIHJvdXRlID0gcm91dGVzW2luZGV4XTsKICAgICAgICBpZiAocmVxdWVzdC5wYXJhbXMgPSByb3V0ZS5tYXRjaChyZXF1ZXN0LnBhdGgpKSB7CiAgICAgICAgICB2YXIgY2FsbGJhY2tJbmRleCA9IC0xOwogICAgICAgICAgdmFyIGNhbGxiYWNrcyA9IHJvdXRlLmNhbGxiYWNrczsKICAgICAgICAgIHZhciBjYWxsYmFja3NMZW4gPSBjYWxsYmFja3MubGVuZ3RoOwogICAgICAgICAgdmFyIG5leHRDYWxsYmFjayA9IGZ1bmN0aW9uIChjYXVzZSkgewogICAgICAgICAgICBpZiAoY2F1c2UgPT09ICdyb3V0ZScpIHsKICAgICAgICAgICAgICBuZXh0Q2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjYWxsYmFja0luZGV4Kys7CiAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrSW5kZXggIT09IGNhbGxiYWNrc0xlbikgewogICAgICAgICAgICAgICAgcmVxdWVzdC5yb3V0ZSA9IHJvdXRlOwogICAgICAgICAgICAgICAgY2FsbGJhY2tzW2NhbGxiYWNrSW5kZXhdKHJlcXVlc3QsIHJlc3BvbnNlLCBuZXh0Q2FsbGJhY2spOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIG5leHRDYWxsYmFjaygnJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5leHQoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIG5leHQoKTsKICB9CiAgZnVuY3Rpb24gZGlzcGF0Y2goYmFja3dhcmQsIHJlcGxhY2UpIHsKICAgIHZhciB1cmxTdHIgPSBnZXRVcmxGb3JSb3V0ZXIoKTsKICAgIHZhciB1cmkgPSB1cmwucGFyc2UodXJsU3RyLCB0cnVlKTsKICAgIHZhciBxdWVyeSA9IHVyaS5xdWVyeTsKICAgIHVyaS5zZWFyY2ggPSAnJzsKICAgIHVyaS5xdWVyeSA9IHt9OwogICAgdmFyIHBhdGggPSB1cmwuc3RyaW5naWZ5KHVyaSkgfHwgJy8nOwogICAgdmFyIHJlcXVlc3QgPSBuZXcgUmVxdWVzdCh7CiAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgYmFja3dhcmQ6IGJhY2t3YXJkID09PSB0cnVlLAogICAgICByZXBsYWNlOiByZXBsYWNlID09PSB0cnVlLAogICAgICBmb3J3YXJkOiBiYWNrd2FyZCA9PT0gZmFsc2UgJiYgcmVwbGFjZSA9PT0gZmFsc2UsCiAgICAgIHBhdGg6IHBhdGgsCiAgICAgIHVybDogdXJsU3RyLAogICAgICBvcmlnaW5hbFVybDogdXJsU3RyCiAgICB9KTsKICAgIHZhciByZXNwb25zZSA9IHsgcmVkaXJlY3Q6IGV4cG9ydHMubmF2aWdhdGUgfTsKICAgIGV4cG9ydHMuZmlyZSgnZGlzcGF0Y2gnLCB7CiAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsCiAgICAgIHJlc3BvbnNlOiByZXNwb25zZQogICAgfSk7CiAgICBmaXJlTWlkZGxlV2FyZShyZXF1ZXN0LCByZXNwb25zZSwgZmlyZVJvdXRlcyk7CiAgfQogIHV0aWxzLm1peChleHBvcnRzLCBDdXN0b21FdmVudC5UYXJnZXQpOwogIGV4cG9ydHMudXNlID0gZnVuY3Rpb24gKHByZWZpeCwgY2FsbGJhY2spIHsKICAgIGlmICh0eXBlb2YgcHJlZml4ICE9PSAnc3RyaW5nJykgewogICAgICBjYWxsYmFjayA9IHByZWZpeDsKICAgICAgcHJlZml4ID0gJyc7CiAgICB9CiAgICBtaWRkbGV3YXJlcy5wdXNoKFsKICAgICAgcHJlZml4LAogICAgICBjYWxsYmFjawogICAgXSk7CiAgfTsKICBleHBvcnRzLm5hdmlnYXRlID0gZnVuY3Rpb24gKHBhdGgsIG9wdHMpIHsKICAgIG9wdHMgPSBvcHRzIHx8IHt9OwogICAgdmFyIHJlcGxhY2UgPSBvcHRzLnJlcGxhY2UgfHwgZmFsc2U7CiAgICB2YXIgdXJsU3RyID0gZ2V0VXJsRm9yUm91dGVyKCk7CiAgICB2YXIgdXJpID0gdXJsLnBhcnNlKHVybFN0cik7CiAgICBpZiAocGF0aC5jaGFyQXQoMCkgPT09ICc/JykgewogICAgICB1cmkuc2VhcmNoID0gcGF0aDsKICAgICAgcGF0aCA9IHVybC5zdHJpbmdpZnkodXJpKTsKICAgIH0KICAgIGlmICh1cmxTdHIgIT09IHBhdGgpIHsKICAgICAgaWYgKCFyZXBsYWNlKSB7CiAgICAgICAgdmlld1VuaXF1ZUlkKys7CiAgICAgICAgdmlld3NIaXN0b3J5LnB1c2godmlld1VuaXF1ZUlkKTsKICAgICAgfQogICAgICBpZiAoIWdsb2JhbENvbmZpZy51c2VIYXNoICYmIHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlKSB7CiAgICAgICAgaGlzdG9yeVtyZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oeyB2aWQ6IHZpZXdVbmlxdWVJZCB9LCAnJywgdXRpbHMuZ2V0RnVsbFBhdGgocGF0aCwgZ2xvYmFsQ29uZmlnLnVybFJvb3QpKTsKICAgICAgICBkaXNwYXRjaChmYWxzZSwgcmVwbGFjZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlKSB7CiAgICAgICAgICBoaXN0b3J5W3JlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7IHZpZDogdmlld1VuaXF1ZUlkIH0sICcnLCAnIyEnICsgcGF0aCk7CiAgICAgICAgICBkaXNwYXRjaChmYWxzZSwgcmVwbGFjZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNldFBhdGhCeUhhc2gocGF0aCwgcmVwbGFjZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKG9wdHMgJiYgb3B0cy50cmlnZ2VyUm91dGUpIHsKICAgICAgZGlzcGF0Y2goZmFsc2UsIHRydWUpOwogICAgfQogIH07CiAgZXhwb3J0cy5nZXQgPSBmdW5jdGlvbiAocm91dGVQYXRoKSB7CiAgICB2YXIgY2FsbGJhY2tzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgcm91dGVzLnB1c2gobmV3IFJvdXRlKHJvdXRlUGF0aCwgY2FsbGJhY2tzLCBnbG9iYWxDb25maWcpKTsKICB9OwogIGV4cG9ydHMubWF0Y2hSb3V0ZSA9IGZ1bmN0aW9uIChwYXRoKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHJvdXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgaWYgKHJvdXRlc1tpXS5tYXRjaChwYXRoKSkgewogICAgICAgIHJldHVybiByb3V0ZXNbaV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9OwogIGV4cG9ydHMucmVtb3ZlUm91dGUgPSBmdW5jdGlvbiAocm91dGVQYXRoLCBjYWxsYmFjaykgewogICAgZm9yICh2YXIgaSA9IHJvdXRlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICB2YXIgciA9IHJvdXRlc1tpXTsKICAgICAgaWYgKHIucGF0aCA9PT0gcm91dGVQYXRoKSB7CiAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICByLnJlbW92ZUNhbGxiYWNrKGNhbGxiYWNrKTsKICAgICAgICAgIGlmICghci5jYWxsYmFja3MubGVuZ3RoKSB7CiAgICAgICAgICAgIHJvdXRlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJvdXRlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKICBleHBvcnRzLmNsZWFyUm91dGVzID0gZnVuY3Rpb24gKCkgewogICAgbWlkZGxld2FyZXMgPSBbXTsKICAgIHJvdXRlcyA9IFtdOwogIH07CiAgZXhwb3J0cy5oYXNSb3V0ZSA9IGZ1bmN0aW9uIChyb3V0ZVBhdGgpIHsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcm91dGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBpZiAocm91dGVzW2ldLnBhdGggPT09IHJvdXRlUGF0aCkgewogICAgICAgIHJldHVybiByb3V0ZXNbaV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9OwogIGZ1bmN0aW9uIGRpc3BhdGNoQnlWaWQodmlkKSB7CiAgICB2YXIgYmFja3dhcmQgPSBmYWxzZTsKICAgIHZhciByZXBsYWNlID0gZmFsc2U7CiAgICBpZiAodmlkID09PSB2aWV3c0hpc3Rvcnlbdmlld3NIaXN0b3J5Lmxlbmd0aCAtIDJdKSB7CiAgICAgIGJhY2t3YXJkID0gdHJ1ZTsKICAgICAgdmlld3NIaXN0b3J5LnBvcCgpOwogICAgfSBlbHNlIGlmICh2aWQgIT09IHZpZXdzSGlzdG9yeVt2aWV3c0hpc3RvcnkubGVuZ3RoIC0gMV0pIHsKICAgICAgdmlld3NIaXN0b3J5LnB1c2godmlkKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlcGxhY2UgPSB0cnVlOwogICAgfQogICAgZGlzcGF0Y2goYmFja3dhcmQsIHJlcGxhY2UpOwogIH0KICBmdW5jdGlvbiBvblBvcFN0YXRlKGUpIHsKICAgIHZhciBzdGF0ZSA9IGUub3JpZ2luYWxFdmVudC5zdGF0ZTsKICAgIGlmICghc3RhdGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZGlzcGF0Y2hCeVZpZChzdGF0ZS52aWQpOwogIH0KICBmdW5jdGlvbiBvbkhhc2hDaGFuZ2UoZSkgewogICAgdmFyIG5ld1VSTCA9IGUubmV3VVJMIHx8IGxvY2F0aW9uLmhyZWY7CiAgICB2YXIgdmlkID0gZ2V0VmlkRnJvbVVybFdpdGhIYXNoKG5ld1VSTCk7CiAgICBpZiAoIXZpZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBkaXNwYXRjaEJ5VmlkKHZpZCk7CiAgfQogIGV4cG9ydHMuY29uZmlnID0gZnVuY3Rpb24gKG9wdHMpIHsKICAgIGlmIChvcHRzLnVybFJvb3QpIHsKICAgICAgb3B0cy51cmxSb290ID0gb3B0cy51cmxSb290LnJlcGxhY2UoL1wvJC8sICcnKTsKICAgIH0KICAgIHV0aWxzLm1peChnbG9iYWxDb25maWcsIG9wdHMpOwogIH07CiAgdmFyIHN0YXJ0ZWQ7CiAgZXhwb3J0cy5zdGFydCA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgaWYgKHN0YXJ0ZWQpIHsKICAgICAgcmV0dXJuIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoZXhwb3J0cyk7CiAgICB9CiAgICB2YXIgdXNlSGFzaCA9IGdsb2JhbENvbmZpZy51c2VIYXNoLCB1cmxSb290ID0gZ2xvYmFsQ29uZmlnLnVybFJvb3QsIHRyaWdnZXJSb3V0ZSA9IGdsb2JhbENvbmZpZy50cmlnZ2VyUm91dGUsIGxvY1BhdGggPSBsb2NhdGlvbi5wYXRobmFtZSwgaHJlZiA9IGxvY2F0aW9uLmhyZWYsIGhhc2ggPSBnZXRVcmxGb3JSb3V0ZXIoKSwgaGFzaElzVmFsaWQgPSBsb2NhdGlvbi5oYXNoLm1hdGNoKC8jIS4rLyk7CiAgICBpZiAoIXVzZUhhc2gpIHsKICAgICAgaWYgKHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlKSB7CiAgICAgICAgaWYgKGhhc2hJc1ZhbGlkKSB7CiAgICAgICAgICBpZiAoIXVybFJvb3QpIHsKICAgICAgICAgICAgdmFyIHRtcCA9IGxvY2F0aW9uLmhhc2guc3Vic3RyaW5nKDIpOwogICAgICAgICAgICBpZiAodG1wWzBdID09PSAnLycpIHsKICAgICAgICAgICAgICB0bXAgPSB0bXAuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCAnJywgaHJlZiA9IGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3QgKyBsb2NhdGlvbi5wYXRobmFtZSArIHRtcCk7CiAgICAgICAgICAgIHRyaWdnZXJSb3V0ZSA9IDE7CiAgICAgICAgICB9IGVsc2UgaWYgKHV0aWxzLmVxdWFsc0lnbm9yZVNsYXNoKGxvY1BhdGgsIHVybFJvb3QpKSB7CiAgICAgICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCAnJywgaHJlZiA9IHV0aWxzLmdldEZ1bGxQYXRoKGhhc2gsIHVybFJvb3QpKTsKICAgICAgICAgICAgdHJpZ2dlclJvdXRlID0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3JvdXRlcjogbG9jYXRpb24gcGF0aCBtdXN0IGJlIHNhbWUgd2l0aCB1cmxSb290IScpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghdXRpbHMuZXF1YWxzSWdub3JlU2xhc2gobG9jUGF0aCwgdXJsUm9vdCkpIHsKICAgICAgICBsb2NhdGlvbi5yZXBsYWNlKHV0aWxzLmFkZEVuZFNsYXNoKHVybFJvb3QpICsgJyMhJyArIGhhc2gpOwogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdXNlSGFzaCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICB2YXIgbmVlZFJlcGxhY2VIaXN0b3J5ID0gc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGU7CiAgICAgIGlmIChzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSkgewogICAgICAgIERvbUV2ZW50Lm9uKHdpbiwgJ3BvcHN0YXRlJywgb25Qb3BTdGF0ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgRG9tRXZlbnQub24od2luLCAnaGFzaGNoYW5nZScsIG9uSGFzaENoYW5nZSk7CiAgICAgICAgdHJpZ2dlclJvdXRlID0gMTsKICAgICAgfQogICAgICBpZiAodXNlSGFzaCkgewogICAgICAgIGlmICghZ2V0VXJsRm9yUm91dGVyKCkpIHsKICAgICAgICAgIGV4cG9ydHMubmF2aWdhdGUoJy8nLCB7IHJlcGxhY2U6IHRydWUgfSk7CiAgICAgICAgICB0cmlnZ2VyUm91dGUgPSAwOwogICAgICAgICAgbmVlZFJlcGxhY2VIaXN0b3J5ID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmICghc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUgJiYgZ2V0VmlkRnJvbVVybFdpdGhIYXNoKGhyZWYpICE9PSB2aWV3VW5pcXVlSWQpIHsKICAgICAgICAgIHNldFBhdGhCeUhhc2godXRpbHMuZ2V0SGFzaChocmVmKSwgdHJ1ZSk7CiAgICAgICAgICB0cmlnZ2VyUm91dGUgPSAwOwogICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUgJiYgdXRpbHMuaGFzVmlkKGhyZWYpKSB7CiAgICAgICAgICBsb2NhdGlvbi5yZXBsYWNlKGhyZWYgPSB1dGlscy5yZW1vdmVWaWQoaHJlZikpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobmVlZFJlcGxhY2VIaXN0b3J5KSB7CiAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoeyB2aWQ6IHZpZXdVbmlxdWVJZCB9LCAnJywgaHJlZik7CiAgICAgIH0KICAgICAgaWYgKHRyaWdnZXJSb3V0ZSkgewogICAgICAgIGRpc3BhdGNoKGZhbHNlLCB0cnVlKTsKICAgICAgfQogICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICBjYWxsYmFjayhleHBvcnRzKTsKICAgICAgfQogICAgfSwgQlJFQVRIX0lOVEVSVkFMKTsKICAgIHN0YXJ0ZWQgPSB0cnVlOwogICAgcmV0dXJuIGV4cG9ydHM7CiAgfTsKICBleHBvcnRzLlV0aWxzID0gdXRpbHM7CiAgZXhwb3J0cy52ZXJzaW9uID0gJzEuMC4xJzsKICBleHBvcnRzLnN0b3AgPSBmdW5jdGlvbiAoKSB7CiAgICBzdGFydGVkID0gZmFsc2U7CiAgICBEb21FdmVudC5kZXRhY2god2luLCAnaGFzaGNoYW5nZScsIG9uSGFzaENoYW5nZSk7CiAgICBEb21FdmVudC5kZXRhY2god2luLCAncG9wc3RhdGUnLCBvblBvcFN0YXRlKTsKICB9OwogIHJldHVybiBleHBvcnRzOwp9KCk7Cm1vZHVsZS5leHBvcnRzID0gcm91dGVyOwp9KTs=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 16:22:49 GMT",
                    "Content-Length": "15005",
                    "Date": "Fri, 07 Nov 2014 16:22:49 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}