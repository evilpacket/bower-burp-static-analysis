{
    "url": "http://localhost:9999/ESTOS/strophe.jingle/examples/muc.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>location.hash</b> and written to <b>the 'text()' function of JQuery</b> via the following statements:<ul><li>setStatus('Joining ' + location.hash);</li><li>$('#status').text(txt);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ESTOS/strophe.jingle/examples/muc.js",
                "path": "/ESTOS/strophe.jingle/examples/muc.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9FU1RPUy9zdHJvcGhlLmppbmdsZS9leGFtcGxlcy9tdWMuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTQ1MzcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFNhdCwgMDggTm92IDIwMTQgMTQ6NTY6NTUgR01UDQpMYXN0LU1vZGlmaWVkOiBTYXQsIDA4IE5vdiAyMDE0IDE0OjU2OjU1IEdNVA0KDQovKiBqc2hpbnQgLVcxMTcgKi8KdmFyIEJPU0hfU0VSVklDRSA9ICcvaHR0cC1iaW5kJywKICAgIERPTUFJTiA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSwKICAgIENPTkZFUkVOQ0VET01BSU4gPSAnY29uZmVyZW5jZS4nICsgRE9NQUlOLAogICAgaWNlX2NvbmZpZyA9IHtpY2VTZXJ2ZXJzOiBbe3VybDogJ3N0dW46c3R1bi5sLmdvb2dsZS5jb206MTkzMDInfV19LAogICAgUlRDID0gbnVsbCwKICAgIFJUQ1BlZXJDb25uZWN0aW9uID0gbnVsbCwKICAgIEFVVE9BQ0NFUFQgPSB0cnVlLAogICAgUFJBTlNXRVIgPSBmYWxzZSwgLy8gdXNlIGVpdGhlciBwcmFuc3dlciBvciBhdXRvYWNjZXB0CiAgICBSQVdMT0dHSU5HID0gdHJ1ZSwKICAgIE1VTFRJUEFSVFkgPSB0cnVlLAogICAgbG9jYWxTdHJlYW0gPSBudWxsLAogICAgY29ubmVjdGlvbiA9IG51bGwsCiAgICBteXJvb21qaWQgPSBudWxsLAogICAgcm9vbWppZCA9IG51bGwsCiAgICBsaXN0X21lbWJlcnMgPSBbXTsKCmZ1bmN0aW9uIHNldFN0YXR1cyh0eHQpIHsKICAgIGNvbnNvbGUubG9nKCdzdGF0dXMnLCB0eHQpOwogICAgJCgnI3N0YXR1cycpLnRleHQodHh0KTsKfQoKZnVuY3Rpb24gb25Db25uZWN0KHN0YXR1cykgewogICAgaWYgKHN0YXR1cyA9PSBTdHJvcGhlLlN0YXR1cy5DT05ORUNUSU5HKSB7CiAgICAgICAgc2V0U3RhdHVzKCdDb25uZWN0aW5nLicpOwogICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwpIHsKICAgICAgICBzZXRTdGF0dXMoJ0Nvbm5lY3RpbmcgZmFpbGVkLicpOwogICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gU3Ryb3BoZS5TdGF0dXMuRElTQ09OTkVDVElORykgewogICAgICAgIHNldFN0YXR1cygnRGlzY29ubmVjdGluZy4nKTsKICAgIH0gZWxzZSBpZiAoc3RhdHVzID09IFN0cm9waGUuU3RhdHVzLkRJU0NPTk5FQ1RFRCkgewogICAgICAgIHNldFN0YXR1cygnRGlzY29ubmVjdGVkLicpOwogICAgICAgIGlmIChsb2NhbFN0cmVhbSkgewogICAgICAgICAgICBsb2NhbFN0cmVhbS5zdG9wKCk7CiAgICAgICAgICAgIGxvY2FsU3RyZWFtID0gbnVsbDsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBTdHJvcGhlLlN0YXR1cy5DT05ORUNURUQpIHsKICAgICAgICBzZXRTdGF0dXMoJ0Nvbm5lY3RlZC4nKTsKICAgICAgICBjb25uZWN0aW9uLmppbmdsZS5nZXRTdHVuQW5kVHVybkNyZWRlbnRpYWxzKCk7CgogICAgICAgIC8vIGRpc2NvIHN0dWZmCiAgICAgICAgaWYgKGNvbm5lY3Rpb24uZGlzY28pIHsKICAgICAgICAgICAgY29ubmVjdGlvbi5kaXNjby5hZGRJZGVudGl0eSgnY2xpZW50JywgJ3dlYicpOwogICAgICAgICAgICBjb25uZWN0aW9uLmRpc2NvLmFkZEZlYXR1cmUoU3Ryb3BoZS5OUy5ESVNDT19JTkZPKTsKICAgICAgICB9CiAgICAgICAgJChkb2N1bWVudCkudHJpZ2dlcignY29ubmVjdGVkJyk7CiAgICB9Cn0KCmZ1bmN0aW9uIG9uSGFzaENoYW5nZSgpIHsKICAgIHNldFN0YXR1cygnaGFzaENoYW5nZTogJyArIHdpbmRvdy5sb2NhdGlvbi5oYXNoKTsKICAgIGlmIChPYmplY3Qua2V5cyhjb25uZWN0aW9uLmppbmdsZS5zZXNzaW9ucykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgfQp9CgpmdW5jdGlvbiBvbkpvaW5Db21wbGV0ZSgpIHsKICAgIHNldFN0YXR1cygnb25Kb2luQ29tcGxldGUnKTsKICAgIGlmIChsaXN0X21lbWJlcnMubGVuZ3RoIDwgMSkgewogICAgICAgIHNldFN0YXR1cygnd2FpdGluZyBmb3IgcGVlcicpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBzZXRTdGF0dXMoJ2luaXRpYXRpbmcgY2FsbCcpOwogICAgdmFyIGksIHNlc3MsIG51bTsKICAgIG51bSA9IE1VTFRJUEFSVFkgPyBsaXN0X21lbWJlcnMubGVuZ3RoIDogMTsKICAgIGZvciAoaSA9IDA7IGkgPCBudW07IGkrKykgewogICAgICAgIGNvbm5lY3Rpb24uamluZ2xlLmluaXRpYXRlKGxpc3RfbWVtYmVyc1tpXSwgbXlyb29tamlkKTsKICAgIH0KfQoKZnVuY3Rpb24gb25QcmVzZW5jZShwcmVzKSB7CiAgICB2YXIgZnJvbSA9IHByZXMuZ2V0QXR0cmlidXRlKCdmcm9tJyksCiAgICAgICAgdHlwZSA9IHByZXMuZ2V0QXR0cmlidXRlKCd0eXBlJyk7CiAgICBpZiAodHlwZSAhPT0gbnVsbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKCQocHJlcykuZmluZCgnPnhbeG1sbnM9Imh0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL211YyN1c2VyIl0+c3RhdHVzW2NvZGU9IjIwMSJdJykubGVuZ3RoKSB7CiAgICAgICAgLy8gaHR0cDovL3htcHAub3JnL2V4dGVuc2lvbnMveGVwLTAwNDUuaHRtbCNjcmVhdGVyb29tLWluc3RhbnQKICAgICAgICB2YXIgY3JlYXRlID0gJGlxKHt0eXBlOiAnc2V0JywgdG86IHJvb21qaWR9KQogICAgICAgICAgICAgICAgLmMoJ3F1ZXJ5Jywge3htbG5zOiAnaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvbXVjI293bmVyJ30pCiAgICAgICAgICAgICAgICAuYygneCcsIHt4bWxuczogJ2phYmJlcjp4OmRhdGEnLCB0eXBlOiAnc3VibWl0J30pOwogICAgICAgIGNvbm5lY3Rpb24uc2VuZChjcmVhdGUpOyAvLyBmaXJlIGF3YXkKICAgIH0KICAgIGlmIChmcm9tID09IG15cm9vbWppZCkgewogICAgICAgIG9uSm9pbkNvbXBsZXRlKCk7CiAgICB9IGVsc2UgeyAvLyBUT0RPOiBwcmV2ZW50IGR1cGxpY2F0ZXMKICAgICAgICBsaXN0X21lbWJlcnMucHVzaChmcm9tKTsKICAgIH0KICAgIHJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBvblByZXNlbmNlVW5hdmFpbGFibGUocHJlcykgewogICAgY29ubmVjdGlvbi5qaW5nbGUudGVybWluYXRlQnlKaWQoJChwcmVzKS5hdHRyKCdmcm9tJykpOwogICAgaWYgKE9iamVjdC5rZXlzKGNvbm5lY3Rpb24uamluZ2xlLnNlc3Npb25zKS5sZW5ndGggPT09IDApIHsKICAgICAgICBzZXRTdGF0dXMoJ2V2ZXJ5b25lIGxlZnQnKTsKICAgIH0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdF9tZW1iZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGxpc3RfbWVtYmVyc1tpXSA9PSAkKHByZXMpLmF0dHIoJ2Zyb20nKSkgewogICAgICAgICAgICBsaXN0X21lbWJlcnMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gb25QcmVzZW5jZUVycm9yKHByZXMpIHsKICAgIHNldFN0YXR1cygnb25QcmVzRXJyb3IgJyArIHByZXMpOwogICAgcmV0dXJuIHRydWU7Cn0KCmZ1bmN0aW9uIGRvSm9pbigpIHsKICAgIHZhciByb29tbm9kZSA9IG51bGwsCiAgICAgICAgcHJlczsKICAgIGlmIChsb2NhdGlvbi5oYXNoLmxlbmd0aCA+IDEpIHsKICAgICAgICByb29tbm9kZSA9IGxvY2F0aW9uLmhhc2guc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgaWYgKHJvb21ub2RlLmluZGV4T2YoJy8nKSAhPSAtMSkgewogICAgICAgICAgICBzZXRTdGF0dXMoJ2ludmFsaWQgbG9jYXRpb24sIG11c3Qgbm90IGNvbnRhaW4gIi8iJyk7CiAgICAgICAgICAgIGNvbm5lY3Rpb24uZGlzY29ubmVjdCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChyb29tbm9kZS5pbmRleE9mKCdAJykgIT0gLTEpIHsgLy8gYWxsb3cgI3Jvb21AaG9zdAogICAgICAgICAgICByb29tamlkID0gcm9vbW5vZGU7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICByb29tbm9kZSA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA4KTsKICAgICAgICBsb2NhdGlvbi5oYXNoID0gcm9vbW5vZGU7CiAgICB9CiAgICBpZiAocm9vbWppZCA9PT0gbnVsbCkgewogICAgICAgIHJvb21qaWQgPSByb29tbm9kZSArICdAJyArIENPTkZFUkVOQ0VET01BSU47CiAgICB9CiAgICBzZXRTdGF0dXMoJ0pvaW5pbmcgJyArIGxvY2F0aW9uLmhhc2gpOwogICAgbXlyb29tamlkID0gcm9vbWppZCArICcvJyArIFN0cm9waGUuZ2V0Tm9kZUZyb21KaWQoY29ubmVjdGlvbi5qaWQpOwogICAgbGlzdF9tZW1iZXJzID0gW107CiAgICBjb25zb2xlLmxvZygnam9pbmluZycsIHJvb21qaWQpOwoKICAgIC8vIG11YyBzdHVmZgogICAgY29ubmVjdGlvbi5hZGRIYW5kbGVyKG9uUHJlc2VuY2UsIG51bGwsICdwcmVzZW5jZScsIG51bGwsIG51bGwsIHJvb21qaWQsIHttYXRjaEJhcmU6IHRydWV9KTsKICAgIGNvbm5lY3Rpb24uYWRkSGFuZGxlcihvblByZXNlbmNlVW5hdmFpbGFibGUsIG51bGwsICdwcmVzZW5jZScsICd1bmF2YWlsYWJsZScsIG51bGwsIHJvb21qaWQsIHttYXRjaEJhcmU6IHRydWV9KTsKICAgIGNvbm5lY3Rpb24uYWRkSGFuZGxlcihvblByZXNlbmNlRXJyb3IsIG51bGwsICdwcmVzZW5jZScsICdlcnJvcicsIG51bGwsIHJvb21qaWQsIHttYXRjaEJhcmU6IHRydWV9KTsKCiAgICBwcmVzID0gJHByZXMoe3RvOiBteXJvb21qaWQgfSkKICAgICAgICAgICAgLmMoJ3gnLCB7eG1sbnM6ICdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9tdWMnfSk7CiAgICBjb25uZWN0aW9uLnNlbmQocHJlcyk7Cn0KCmZ1bmN0aW9uIG9uTWVkaWFSZWFkeShldmVudCwgc3RyZWFtKSB7CiAgICBsb2NhbFN0cmVhbSA9IHN0cmVhbTsKICAgIGNvbm5lY3Rpb24uamluZ2xlLmxvY2FsU3RyZWFtID0gc3RyZWFtOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb2NhbFN0cmVhbS5nZXRBdWRpb1RyYWNrcygpLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgc2V0U3RhdHVzKCd1c2luZyBhdWRpbyBkZXZpY2UgIicgKyBsb2NhbFN0cmVhbS5nZXRBdWRpb1RyYWNrcygpW2ldLmxhYmVsICsgJyInKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBsb2NhbFN0cmVhbS5nZXRWaWRlb1RyYWNrcygpLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgc2V0U3RhdHVzKCd1c2luZyB2aWRlbyBkZXZpY2UgIicgKyBsb2NhbFN0cmVhbS5nZXRWaWRlb1RyYWNrcygpW2ldLmxhYmVsICsgJyInKTsKICAgIH0KICAgIC8vIG11dGUgdmlkZW8gb24gZmlyZWZveCBhbmQgcmVjZW50IGNhbmFyeQogICAgJCgnI21pbml2aWRlbycpWzBdLm11dGVkID0gdHJ1ZTsKICAgICQoJyNtaW5pdmlkZW8nKVswXS52b2x1bWUgPSAwOwoKICAgIFJUQy5hdHRhY2hNZWRpYVN0cmVhbSgkKCcjbWluaXZpZGVvJyksIGxvY2FsU3RyZWFtKTsKCiAgICBkb0Nvbm5lY3QoKTsKCiAgICBpZiAodHlwZW9mIGhhcmsgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IHsgaW50ZXJ2YWw6IDQwMCB9OwogICAgICAgIHZhciBzcGVlY2hFdmVudHMgPSBoYXJrKHN0cmVhbSwgb3B0aW9ucyk7CgogICAgICAgIHNwZWVjaEV2ZW50cy5vbignc3BlYWtpbmcnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzcGVha2luZycpOwogICAgICAgIH0pOwoKICAgICAgICBzcGVlY2hFdmVudHMub24oJ3N0b3BwZWRfc3BlYWtpbmcnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdG9wcGVkX3NwZWFraW5nJyk7CiAgICAgICAgfSk7CiAgICAgICAgc3BlZWNoRXZlbnRzLm9uKCd2b2x1bWVfY2hhbmdlJywgZnVuY3Rpb24gKHZvbHVtZSwgdHJlc2hvbGQpIHsKICAgICAgICAgIC8vY29uc29sZS5sb2coJ3ZvbHVtZScsIHZvbHVtZSwgdHJlc2hvbGQpOwogICAgICAgICAgICBpZiAodm9sdW1lIDwgLTYwKSB7IC8vIHZhcnkgYmV0d2VlbiAtNjAgYW5kIC0zNQogICAgICAgICAgICAgICAgJCgnI293bnZvbHVtZScpLmNzcygnd2lkdGgnLCAwKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2b2x1bWUgPiAtMzUpIHsKICAgICAgICAgICAgICAgICQoJyNvd252b2x1bWUnKS5jc3MoJ3dpZHRoJywgJzEwMCUnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoJyNvd252b2x1bWUnKS5jc3MoJ3dpZHRoJywgKHZvbHVtZSArIDEwMCkgKiAxMDAgLyAyNSAtIDE2MCArICclJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS53YXJuKCd3aXRob3V0IGhhcmssIHlvdSBhcmUgbWlzc2luZyBxdWl0ZSBhIG5pY2UgZmVhdHVyZScpOwogICAgfQp9CgpmdW5jdGlvbiBvbk1lZGlhRmFpbHVyZSgpIHsKICAgIHNldFN0YXR1cygnbWVkaWEgZmFpbHVyZScpOwp9CgpmdW5jdGlvbiBvbkNhbGxJbmNvbWluZyhldmVudCwgc2lkKSB7CiAgICBzZXRTdGF0dXMoJ2luY29taW5nIGNhbGwnICsgc2lkKTsKICAgIHZhciBzZXNzID0gY29ubmVjdGlvbi5qaW5nbGUuc2Vzc2lvbnNbc2lkXTsKICAgIHNlc3Muc2VuZEFuc3dlcigpOwogICAgc2Vzcy5hY2NlcHQoKTsKCiAgICAvLyBhbHRlcm5hdGl2ZWx5Li4uCiAgICAvL3Nlc3MudGVybWluYXRlKGJ1c3kpCiAgICAvL2Nvbm5lY3Rpb24uamluZ2xlLnRlcm1pbmF0ZShzaWQpOwp9CgpmdW5jdGlvbiBhcnJhbmdlVmlkZW9zKHNlbGVjdG9yKSB7CiAgICB2YXIgZmxvb3IgPSBNYXRoLmZsb29yLAogICAgICAgIGVsZW1lbnRzID0gJChzZWxlY3RvciksCiAgICAgICAgaG93TWFueSA9IGVsZW1lbnRzLmxlbmd0aCwKICAgICAgICBhdmFpbGFibGVXaWR0aCA9ICQoc2VsZWN0b3IpLnBhcmVudCgpLmlubmVyV2lkdGgoKSwKICAgICAgICBhdmFpbGFibGVIZWlnaHQgPSAkKHNlbGVjdG9yKS5wYXJlbnQoKS5pbm5lckhlaWdodCgpLAogICAgICAgIHVzZWRXaWR0aCA9IDAsCiAgICAgICAgYXNwZWN0UmF0aW8gPSA0IC8gMzsKICAgIGlmIChhdmFpbGFibGVIZWlnaHQgPCBhdmFpbGFibGVXaWR0aCAvIGFzcGVjdFJhdGlvKSB7CiAgICAgICAgYXZhaWxhYmxlV2lkdGggPSBhdmFpbGFibGVIZWlnaHQgKiBhc3BlY3RSYXRpbzsKICAgIH0KICAgIGVsZW1lbnRzLmhlaWdodChhdmFpbGFibGVIZWlnaHQpOwoKICAgIGVsZW1lbnRzLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgJChlbGVtZW50c1tpbmRleF0pLnJlbW92ZUF0dHIoJ3N0eWxlJyk7CiAgICB9KTsKCiAgICAvLyBoYXJkY29kZWQgbGF5b3V0IGZvciB1cCB0byBmb3VyIHZpZGVvcwogICAgc3dpdGNoIChob3dNYW55KSB7CiAgICBjYXNlIDE6CiAgICAgICAgdXNlZFdpZHRoID0gYXZhaWxhYmxlV2lkdGg7CiAgICAgICAgJChlbGVtZW50c1swXSkuY3NzKCd0b3AnLCAwKTsKICAgICAgICAkKGVsZW1lbnRzWzBdKS5jc3MoJ2xlZnQnLCAoJChzZWxlY3RvcikucGFyZW50KCkuaW5uZXJXaWR0aCgpIC0gYXZhaWxhYmxlV2lkdGgpIC8gMik7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlIDI6CiAgICAgICAgdXNlZFdpZHRoID0gYXZhaWxhYmxlV2lkdGggLyAyOwogICAgICAgICQoZWxlbWVudHNbMF0pLmNzcyh7IGxlZnQ6ICcwcHgnLCB0b3A6ICcwcHgnfSk7CiAgICAgICAgJChlbGVtZW50c1sxXSkuY3NzKHsgcmlnaHQ6ICcwcHgnLCBib3R0b206ICcwcHgnfSk7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlIDM6CiAgICAgICAgdXNlZFdpZHRoID0gYXZhaWxhYmxlV2lkdGggLyAyOwogICAgICAgICQoZWxlbWVudHNbMF0pLmNzcyh7IGxlZnQ6ICcwcHgnLCB0b3A6ICcwcHgnfSk7CiAgICAgICAgJChlbGVtZW50c1sxXSkuY3NzKHsgcmlnaHQ6ICcwcHgnLCB0b3A6ICcwcHgnfSk7CiAgICAgICAgJChlbGVtZW50c1syXSkuY3NzKHsgbGVmdDogKCQoc2VsZWN0b3IpLnBhcmVudCgpLmlubmVyV2lkdGgoKSAtIGF2YWlsYWJsZVdpZHRoICsgdXNlZFdpZHRoKSAvIDIsIGJvdHRvbTogJzBweCcgfSk7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlIDQ6CiAgICAgICAgdXNlZFdpZHRoID0gYXZhaWxhYmxlV2lkdGggLyAyOwogICAgICAgICQoZWxlbWVudHNbMF0pLmNzcyh7IGxlZnQ6ICcwcHgnLCB0b3A6ICcwcHgnfSk7CiAgICAgICAgJChlbGVtZW50c1swXSkuY3NzKCdsZWZ0JywgKCQoc2VsZWN0b3IpLnBhcmVudCgpLmlubmVyV2lkdGgoKSAtIGF2YWlsYWJsZVdpZHRoKSAvIDIpOwogICAgICAgICQoZWxlbWVudHNbMV0pLmNzcyh7IHJpZ2h0OiAnMHB4JywgdG9wOiAnMHB4J30pOwogICAgICAgICQoZWxlbWVudHNbMV0pLmNzcygncmlnaHQnLCAoJChzZWxlY3RvcikucGFyZW50KCkuaW5uZXJXaWR0aCgpIC0gYXZhaWxhYmxlV2lkdGgpIC8gMik7CiAgICAgICAgJChlbGVtZW50c1syXSkuY3NzKHsgbGVmdDogJzBweCcsIGJvdHRvbTogJzBweCd9KTsKICAgICAgICAkKGVsZW1lbnRzWzJdKS5jc3MoJ2xlZnQnLCAoJChzZWxlY3RvcikucGFyZW50KCkuaW5uZXJXaWR0aCgpIC0gYXZhaWxhYmxlV2lkdGgpIC8gMik7CiAgICAgICAgJChlbGVtZW50c1szXSkuY3NzKHsgcmlnaHQ6ICcwcHgnLCBib3R0b206ICcwcHgnfSk7CiAgICAgICAgJChlbGVtZW50c1szXSkuY3NzKCdyaWdodCcsICgkKHNlbGVjdG9yKS5wYXJlbnQoKS5pbm5lcldpZHRoKCkgLSBhdmFpbGFibGVXaWR0aCkgLyAyKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGVsZW1lbnRzLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgJChlbGVtZW50c1tpbmRleF0pLmNzcyh7CiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICB3aWR0aDogdXNlZFdpZHRoLAogICAgICAgICAgICBoZWlnaHQ6IHVzZWRXaWR0aCAvIGFzcGVjdFJhdGlvCiAgICAgICAgfSk7CiAgICAgICAgJChlbGVtZW50c1tpbmRleF0pLnNob3coKTsKICAgIH0pOwp9CgoKZnVuY3Rpb24gb25DYWxsQWN0aXZlKGV2ZW50LCB2aWRlb2VsZW0sIHNpZCkgewogICAgc2V0U3RhdHVzKCdjYWxsIGFjdGl2ZSAnICsgc2lkKTsKICAgICQodmlkZW9lbGVtKS5hcHBlbmRUbygnI2xhcmdldmlkZW9jb250YWluZXInKTsKICAgIGFycmFuZ2VWaWRlb3MoJyNsYXJnZXZpZGVvY29udGFpbmVyID4nKTsKICAgIGNvbm5lY3Rpb24uamluZ2xlLnNlc3Npb25zW3NpZF0uZ2V0U3RhdHMoMTAwMCk7Cn0KCmZ1bmN0aW9uIG9uQ2FsbFRlcm1pbmF0ZWQoZXZlbnQsIHNpZCwgcmVhc29uKSB7CiAgICBzZXRTdGF0dXMoJ2NhbGwgdGVybWluYXRlZCAnICsgc2lkICsgKHJlYXNvbiA/ICgnOiAnICsgcmVhc29uKSA6ICcnKSk7CiAgICBpZiAoT2JqZWN0LmtleXMoY29ubmVjdGlvbi5qaW5nbGUuc2Vzc2lvbnMpLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHNldFN0YXR1cygnYWxsIGNhbGxzIHRlcm1pbmF0ZWQnKTsKICAgIH0KICAgICQoJyNsYXJnZXZpZGVvY29udGFpbmVyICNsYXJnZXZpZGVvXycgKyBzaWQpLnJlbW92ZSgpOwogICAgYXJyYW5nZVZpZGVvcygnI2xhcmdldmlkZW9jb250YWluZXIgPicpOwp9CgpmdW5jdGlvbiB3YWl0Rm9yUmVtb3RlVmlkZW8oc2VsZWN0b3IsIHNpZCkgewogICAgdmFyIHNlc3MgPSBjb25uZWN0aW9uLmppbmdsZS5zZXNzaW9uc1tzaWRdOwogICAgdmlkZW9UcmFja3MgPSBzZXNzLnJlbW90ZVN0cmVhbS5nZXRWaWRlb1RyYWNrcygpOwogICAgaWYgKHZpZGVvVHJhY2tzLmxlbmd0aCA9PT0gMCB8fCBzZWxlY3RvclswXS5jdXJyZW50VGltZSA+IDApIHsKICAgICAgICAkKGRvY3VtZW50KS50cmlnZ2VyKCdjYWxsYWN0aXZlLmppbmdsZScsIFtzZWxlY3Rvciwgc2lkXSk7CiAgICAgICAgUlRDLmF0dGFjaE1lZGlhU3RyZWFtKHNlbGVjdG9yLCBzZXNzLnJlbW90ZVN0cmVhbSk7IC8vIEZJWE1FOiB3aHkgZG8gaSBoYXZlIHRvIGRvIHRoaXMgZm9yIEZGPwogICAgICAgIGNvbnNvbGUubG9nKCd3YWl0Rm9ycmVtb3RldmlkZW8nLCBzZXNzLnBlZXJjb25uZWN0aW9uLmljZUNvbm5lY3Rpb25TdGF0ZSwgc2Vzcy5wZWVyY29ubmVjdGlvbi5zaWduYWxpbmdTdGF0ZSk7CiAgICB9IGVsc2UgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyB3YWl0Rm9yUmVtb3RlVmlkZW8oc2VsZWN0b3IsIHNpZCk7IH0sIDEwMCk7CiAgICB9Cn0KCmZ1bmN0aW9uIG9uUmVtb3RlU3RyZWFtQWRkZWQoZXZlbnQsIGRhdGEsIHNpZCkgewogICAgc2V0U3RhdHVzKCdSZW1vdGUgc3RyZWFtIGZvciBzZXNzaW9uICcgKyBzaWQgKyAnIGFkZGVkLicpOwogICAgaWYgKCQoJyNsYXJnZXZpZGVvXycgKyBzaWQpLmxlbmd0aCAhPT0gMCkgewogICAgICAgIGNvbnNvbGUubG9nKCdpZ25vcmluZyBkdXBsaWNhdGUgb25SZW1vdGVTdHJlYW1BZGRlZC4uLicpOyAvLyBGRiAyMAogICAgICAgIHJldHVybjsKICAgIH0KICAgIC8vIGFmdGVyIHJlbW90ZSBzdHJlYW0gaGFzIGJlZW4gYWRkZWQsIHdhaXQgZm9yIGljZSB0byBiZWNvbWUgY29ubmVjdGVkCiAgICAvLyBvbGQgY29kZSBmb3IgY29tcGF0IHdpdGggRkYyMiBiZXRhCiAgICB2YXIgZWwgPSAkKCI8dmlkZW8gYXV0b3BsYXk9J2F1dG9wbGF5JyBzdHlsZT0nZGlzcGxheTpub25lJy8+IikuYXR0cignaWQnLCAnbGFyZ2V2aWRlb18nICsgc2lkKTsKICAgIFJUQy5hdHRhY2hNZWRpYVN0cmVhbShlbCwgZGF0YS5zdHJlYW0pOwogICAgd2FpdEZvclJlbW90ZVZpZGVvKGVsLCBzaWQpOwogICAgLyogZG9lcyBub3QgeWV0IHdvcmsgZm9yIHJlbW90ZSBzdHJlYW1zIC0tIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3Avd2VicnRjL2lzc3Vlcy9kZXRhaWw/aWQ9ODYxCiAgICB2YXIgb3B0aW9ucyA9IHsgaW50ZXJ2YWw6NTAwIH07CiAgICB2YXIgc3BlZWNoRXZlbnRzID0gaGFyayhkYXRhLnN0cmVhbSwgb3B0aW9ucyk7CgogICAgc3BlZWNoRXZlbnRzLm9uKCd2b2x1bWVfY2hhbmdlJywgZnVuY3Rpb24gKHZvbHVtZSwgdHJlc2hvbGQpIHsKICAgICAgY29uc29sZS5sb2coJ3ZvbHVtZSBmb3IgJyArIHNpZCwgdm9sdW1lLCB0cmVzaG9sZCk7CiAgICB9KTsKICAgICovCn0KCmZ1bmN0aW9uIG9uUmVtb3RlU3RyZWFtUmVtb3ZlZChldmVudCwgZGF0YSwgc2lkKSB7CiAgICBzZXRTdGF0dXMoJ1JlbW90ZSBzdHJlYW0gZm9yIHNlc3Npb24gJyArIHNpZCArICcgcmVtb3ZlZC4nKTsKfQoKZnVuY3Rpb24gb25JY2VDb25uZWN0aW9uU3RhdGVDaGFuZ2VkKGV2ZW50LCBzaWQsIHNlc3MpIHsKICAgIGNvbnNvbGUubG9nKCdpY2Ugc3RhdGUgZm9yJywgc2lkLCBzZXNzLnBlZXJjb25uZWN0aW9uLmljZUNvbm5lY3Rpb25TdGF0ZSk7CiAgICBjb25zb2xlLmxvZygnc2lnIHN0YXRlIGZvcicsIHNpZCwgc2Vzcy5wZWVyY29ubmVjdGlvbi5zaWduYWxpbmdTdGF0ZSk7CiAgICAvLyB3b3JrcyBsaWtlIGNoYXJtLCB1bmZvcnR1bmF0ZWx5IG9ubHkgaW4gY2hyb21lIGFuZCBGRiBuaWdodGx5LCBub3QgRkYyMiBiZXRhCiAgICAvKgogICAgaWYgKHNlc3MucGVlcmNvbm5lY3Rpb24uc2lnbmFsaW5nU3RhdGUgPT0gJ3N0YWJsZScgJiYgc2Vzcy5wZWVyY29ubmVjdGlvbi5pY2VDb25uZWN0aW9uU3RhdGUgPT0gJ2Nvbm5lY3RlZCcpIHsKICAgICAgICB2YXIgZWwgPSAkKCI8dmlkZW8gYXV0b3BsYXk9J2F1dG9wbGF5JyBzdHlsZT0nZGlzcGxheTpub25lJy8+IikuYXR0cignaWQnLCAnbGFyZ2V2aWRlb18nICsgc2lkKTsKICAgICAgICAkKGRvY3VtZW50KS50cmlnZ2VyKCdjYWxsYWN0aXZlLmppbmdsZScsIFtlbCwgc2lkXSk7CiAgICAgICAgUlRDLmF0dGFjaE1lZGlhU3RyZWFtKGVsLCBzZXNzLnJlbW90ZVN0cmVhbSk7IC8vIG1vdmluZyB0aGlzIGJlZm9yZSB0aGUgdHJpZ2dlciBkb2Vzbid0IHdvcmsgaW4gRkY/IQogICAgfQogICAgKi8KfQoKZnVuY3Rpb24gbm9TdHVuQ2FuZGlkYXRlcyhldmVudCkgewogICAgc2V0U3RhdHVzKCd3ZWJydGMgZGlkIG5vdCBlbmNvdW50ZXIgc3R1biBjYW5kaWRhdGVzLCBOQVQgdHJhdmVyc2FsIHdpbGwgbm90IHdvcmsnKTsKICAgIGNvbnNvbGUud2Fybignd2VicnRjIGRpZCBub3QgZW5jb3VudGVyIHN0dW4gY2FuZGlkYXRlcywgTkFUIHRyYXZlcnNhbCB3aWxsIG5vdCB3b3JrJyk7Cn0KCmZ1bmN0aW9uIG9uQ29ubmVjdGVkKGV2ZW50KSB7CiAgICBkb0pvaW4oKTsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICQod2luZG93KS5iaW5kKCdoYXNoY2hhbmdlJywgb25IYXNoQ2hhbmdlKTsKICAgIH0sIDUwMCk7Cn0KCiQod2luZG93KS5iaW5kKCdiZWZvcmV1bmxvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICBpZiAoY29ubmVjdGlvbiAmJiBjb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgIC8vIGVuc3VyZSBzaWdub3V0CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgICAgICB1cmw6ICcvaHR0cC1iaW5kJywKICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICBjYWNoZTogZmFsc2UsCiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24veG1sJywKICAgICAgICAgICAgZGF0YTogIjxib2R5IHJpZD0nIiArIGNvbm5lY3Rpb24ucmlkICsgIicgeG1sbnM9J2h0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL2h0dHBiaW5kJyBzaWQ9JyIgKyBjb25uZWN0aW9uLnNpZCArICInIHR5cGU9J3Rlcm1pbmF0ZSc+PHByZXNlbmNlIHhtbG5zPSdqYWJiZXI6Y2xpZW50JyB0eXBlPSd1bmF2YWlsYWJsZScvPjwvYm9keT4iLAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NpZ25lZCBvdXQnKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0LCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NpZ25vdXQgZXJyb3InLCB0ZXh0U3RhdHVzICsgJyAoJyArIGVycm9yVGhyb3duICsgJyknKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9KTsKCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgIFJUQyA9IHNldHVwUlRDKCk7CiAgICBjb25uZWN0aW9uID0gbmV3IFN0cm9waGUuQ29ubmVjdGlvbihCT1NIX1NFUlZJQ0UpOwogICAgaWYgKFJBV0xPR0dJTkcpIHsKICAgICAgICBjb25uZWN0aW9uLnJhd0lucHV0ID0gZnVuY3Rpb24gKGRhdGEpIHsgY29uc29sZS5sb2coJ1JFQ1Y6ICcgKyBkYXRhKTsgfTsKICAgICAgICBjb25uZWN0aW9uLnJhd091dHB1dCA9IGZ1bmN0aW9uIChkYXRhKSB7IGNvbnNvbGUubG9nKCdTRU5EOiAnICsgZGF0YSk7IH07CiAgICB9CiAgICBjb25uZWN0aW9uLmppbmdsZS5pY2VfY29uZmlnID0gaWNlX2NvbmZpZzsKICAgIGlmIChSVEMpIHsKICAgICAgICBjb25uZWN0aW9uLmppbmdsZS5wY19jb25zdHJhaW50cyA9IFJUQy5wY19jb25zdHJhaW50czsKICAgIH0KCiAgICAkKGRvY3VtZW50KS5iaW5kKCdjb25uZWN0ZWQnLCBvbkNvbm5lY3RlZCk7CiAgICAkKGRvY3VtZW50KS5iaW5kKCdtZWRpYXJlYWR5LmppbmdsZScsIG9uTWVkaWFSZWFkeSk7CiAgICAkKGRvY3VtZW50KS5iaW5kKCdtZWRpYWZhaWx1cmUuamluZ2xlJywgb25NZWRpYUZhaWx1cmUpOwogICAgJChkb2N1bWVudCkuYmluZCgnY2FsbGluY29taW5nLmppbmdsZScsIG9uQ2FsbEluY29taW5nKTsKICAgICQoZG9jdW1lbnQpLmJpbmQoJ2NhbGxhY3RpdmUuamluZ2xlJywgb25DYWxsQWN0aXZlKTsKICAgICQoZG9jdW1lbnQpLmJpbmQoJ2NhbGx0ZXJtaW5hdGVkLmppbmdsZScsIG9uQ2FsbFRlcm1pbmF0ZWQpOwoKICAgICQoZG9jdW1lbnQpLmJpbmQoJ3JlbW90ZXN0cmVhbWFkZGVkLmppbmdsZScsIG9uUmVtb3RlU3RyZWFtQWRkZWQpOwogICAgJChkb2N1bWVudCkuYmluZCgncmVtb3Rlc3RyZWFtcmVtb3ZlZC5qaW5nbGUnLCBvblJlbW90ZVN0cmVhbVJlbW92ZWQpOwogICAgJChkb2N1bWVudCkuYmluZCgnaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlLmppbmdsZScsIG9uSWNlQ29ubmVjdGlvblN0YXRlQ2hhbmdlZCk7CiAgICAkKGRvY3VtZW50KS5iaW5kKCdub3N0dW5jYW5kaWRhdGVzLmppbmdsZScsIG5vU3R1bkNhbmRpZGF0ZXMpOwogICAgJChkb2N1bWVudCkuYmluZCgnYWNrLmppbmdsZScsIGZ1bmN0aW9uIChldmVudCwgc2lkLCBhY2spIHsKICAgICAgICBjb25zb2xlLmxvZygnZ290IHN0YW56YSBhY2sgZm9yICcgKyBzaWQsIGFjayk7CiAgICB9KTsKICAgICQoZG9jdW1lbnQpLmJpbmQoJ2Vycm9yLmppbmdsZScsIGZ1bmN0aW9uIChldmVudCwgc2lkLCBlcnIpIHsKICAgICAgICBjb25zb2xlLmxvZygnZ290IHN0YW56YSBlcnJvciBmb3IgJyArIHNpZCwgZXJyKTsKICAgIH0pOwogICAgJChkb2N1bWVudCkuYmluZCgncGFja2V0bG9zcy5qaW5nbGUnLCBmdW5jdGlvbiAoZXZlbnQsIHNpZCwgbG9zcykgewogICAgICAgIGNvbnNvbGUud2FybigncGFja2V0bG9zcycsIHNpZCwgbG9zcyk7CiAgICB9KTsKICAgIGlmIChSVEMgIT09IG51bGwpIHsKICAgICAgICBSVENQZWVyY29ubmVjdGlvbiA9IFJUQy5wZWVyY29ubmVjdGlvbjsKICAgICAgICBpZiAoUlRDLmJyb3dzZXIgPT0gJ2ZpcmVmb3gnKSB7CiAgICAgICAgICAgIGNvbm5lY3Rpb24uamluZ2xlLm1lZGlhX2NvbnN0cmFpbnRzLm1hbmRhdG9yeS5Nb3pEb250T2ZmZXJEYXRhQ2hhbm5lbCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIC8vc2V0U3RhdHVzKCdwbGVhc2UgYWxsb3cgYWNjZXNzIHRvIG1pY3JvcGhvbmUgYW5kIGNhbWVyYScpOwogICAgICAgIC8vZ2V0VXNlck1lZGlhV2l0aENvbnN0cmFpbnRzKCk7CiAgICB9IGVsc2UgewogICAgICAgIHNldFN0YXR1cygnd2VicnRjIGNhcGFibGUgYnJvd3NlciByZXF1aXJlZCcpOwogICAgfQp9KTsKCg==",
                "body": "LyoganNoaW50IC1XMTE3ICovCnZhciBCT1NIX1NFUlZJQ0UgPSAnL2h0dHAtYmluZCcsCiAgICBET01BSU4gPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUsCiAgICBDT05GRVJFTkNFRE9NQUlOID0gJ2NvbmZlcmVuY2UuJyArIERPTUFJTiwKICAgIGljZV9jb25maWcgPSB7aWNlU2VydmVyczogW3t1cmw6ICdzdHVuOnN0dW4ubC5nb29nbGUuY29tOjE5MzAyJ31dfSwKICAgIFJUQyA9IG51bGwsCiAgICBSVENQZWVyQ29ubmVjdGlvbiA9IG51bGwsCiAgICBBVVRPQUNDRVBUID0gdHJ1ZSwKICAgIFBSQU5TV0VSID0gZmFsc2UsIC8vIHVzZSBlaXRoZXIgcHJhbnN3ZXIgb3IgYXV0b2FjY2VwdAogICAgUkFXTE9HR0lORyA9IHRydWUsCiAgICBNVUxUSVBBUlRZID0gdHJ1ZSwKICAgIGxvY2FsU3RyZWFtID0gbnVsbCwKICAgIGNvbm5lY3Rpb24gPSBudWxsLAogICAgbXlyb29tamlkID0gbnVsbCwKICAgIHJvb21qaWQgPSBudWxsLAogICAgbGlzdF9tZW1iZXJzID0gW107CgpmdW5jdGlvbiBzZXRTdGF0dXModHh0KSB7CiAgICBjb25zb2xlLmxvZygnc3RhdHVzJywgdHh0KTsKICAgICQoJyNzdGF0dXMnKS50ZXh0KHR4dCk7Cn0KCmZ1bmN0aW9uIG9uQ29ubmVjdChzdGF0dXMpIHsKICAgIGlmIChzdGF0dXMgPT0gU3Ryb3BoZS5TdGF0dXMuQ09OTkVDVElORykgewogICAgICAgIHNldFN0YXR1cygnQ29ubmVjdGluZy4nKTsKICAgIH0gZWxzZSBpZiAoc3RhdHVzID09IFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMKSB7CiAgICAgICAgc2V0U3RhdHVzKCdDb25uZWN0aW5nIGZhaWxlZC4nKTsKICAgIH0gZWxzZSBpZiAoc3RhdHVzID09IFN0cm9waGUuU3RhdHVzLkRJU0NPTk5FQ1RJTkcpIHsKICAgICAgICBzZXRTdGF0dXMoJ0Rpc2Nvbm5lY3RpbmcuJyk7CiAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBTdHJvcGhlLlN0YXR1cy5ESVNDT05ORUNURUQpIHsKICAgICAgICBzZXRTdGF0dXMoJ0Rpc2Nvbm5lY3RlZC4nKTsKICAgICAgICBpZiAobG9jYWxTdHJlYW0pIHsKICAgICAgICAgICAgbG9jYWxTdHJlYW0uc3RvcCgpOwogICAgICAgICAgICBsb2NhbFN0cmVhbSA9IG51bGw7CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gU3Ryb3BoZS5TdGF0dXMuQ09OTkVDVEVEKSB7CiAgICAgICAgc2V0U3RhdHVzKCdDb25uZWN0ZWQuJyk7CiAgICAgICAgY29ubmVjdGlvbi5qaW5nbGUuZ2V0U3R1bkFuZFR1cm5DcmVkZW50aWFscygpOwoKICAgICAgICAvLyBkaXNjbyBzdHVmZgogICAgICAgIGlmIChjb25uZWN0aW9uLmRpc2NvKSB7CiAgICAgICAgICAgIGNvbm5lY3Rpb24uZGlzY28uYWRkSWRlbnRpdHkoJ2NsaWVudCcsICd3ZWInKTsKICAgICAgICAgICAgY29ubmVjdGlvbi5kaXNjby5hZGRGZWF0dXJlKFN0cm9waGUuTlMuRElTQ09fSU5GTyk7CiAgICAgICAgfQogICAgICAgICQoZG9jdW1lbnQpLnRyaWdnZXIoJ2Nvbm5lY3RlZCcpOwogICAgfQp9CgpmdW5jdGlvbiBvbkhhc2hDaGFuZ2UoKSB7CiAgICBzZXRTdGF0dXMoJ2hhc2hDaGFuZ2U6ICcgKyB3aW5kb3cubG9jYXRpb24uaGFzaCk7CiAgICBpZiAoT2JqZWN0LmtleXMoY29ubmVjdGlvbi5qaW5nbGUuc2Vzc2lvbnMpLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgIH0KfQoKZnVuY3Rpb24gb25Kb2luQ29tcGxldGUoKSB7CiAgICBzZXRTdGF0dXMoJ29uSm9pbkNvbXBsZXRlJyk7CiAgICBpZiAobGlzdF9tZW1iZXJzLmxlbmd0aCA8IDEpIHsKICAgICAgICBzZXRTdGF0dXMoJ3dhaXRpbmcgZm9yIHBlZXInKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgc2V0U3RhdHVzKCdpbml0aWF0aW5nIGNhbGwnKTsKICAgIHZhciBpLCBzZXNzLCBudW07CiAgICBudW0gPSBNVUxUSVBBUlRZID8gbGlzdF9tZW1iZXJzLmxlbmd0aCA6IDE7CiAgICBmb3IgKGkgPSAwOyBpIDwgbnVtOyBpKyspIHsKICAgICAgICBjb25uZWN0aW9uLmppbmdsZS5pbml0aWF0ZShsaXN0X21lbWJlcnNbaV0sIG15cm9vbWppZCk7CiAgICB9Cn0KCmZ1bmN0aW9uIG9uUHJlc2VuY2UocHJlcykgewogICAgdmFyIGZyb20gPSBwcmVzLmdldEF0dHJpYnV0ZSgnZnJvbScpLAogICAgICAgIHR5cGUgPSBwcmVzLmdldEF0dHJpYnV0ZSgndHlwZScpOwogICAgaWYgKHR5cGUgIT09IG51bGwpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICgkKHByZXMpLmZpbmQoJz54W3htbG5zPSJodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9tdWMjdXNlciJdPnN0YXR1c1tjb2RlPSIyMDEiXScpLmxlbmd0aCkgewogICAgICAgIC8vIGh0dHA6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMDQ1Lmh0bWwjY3JlYXRlcm9vbS1pbnN0YW50CiAgICAgICAgdmFyIGNyZWF0ZSA9ICRpcSh7dHlwZTogJ3NldCcsIHRvOiByb29tamlkfSkKICAgICAgICAgICAgICAgIC5jKCdxdWVyeScsIHt4bWxuczogJ2h0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL211YyNvd25lcid9KQogICAgICAgICAgICAgICAgLmMoJ3gnLCB7eG1sbnM6ICdqYWJiZXI6eDpkYXRhJywgdHlwZTogJ3N1Ym1pdCd9KTsKICAgICAgICBjb25uZWN0aW9uLnNlbmQoY3JlYXRlKTsgLy8gZmlyZSBhd2F5CiAgICB9CiAgICBpZiAoZnJvbSA9PSBteXJvb21qaWQpIHsKICAgICAgICBvbkpvaW5Db21wbGV0ZSgpOwogICAgfSBlbHNlIHsgLy8gVE9ETzogcHJldmVudCBkdXBsaWNhdGVzCiAgICAgICAgbGlzdF9tZW1iZXJzLnB1c2goZnJvbSk7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gb25QcmVzZW5jZVVuYXZhaWxhYmxlKHByZXMpIHsKICAgIGNvbm5lY3Rpb24uamluZ2xlLnRlcm1pbmF0ZUJ5SmlkKCQocHJlcykuYXR0cignZnJvbScpKTsKICAgIGlmIChPYmplY3Qua2V5cyhjb25uZWN0aW9uLmppbmdsZS5zZXNzaW9ucykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgc2V0U3RhdHVzKCdldmVyeW9uZSBsZWZ0Jyk7CiAgICB9CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RfbWVtYmVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChsaXN0X21lbWJlcnNbaV0gPT0gJChwcmVzKS5hdHRyKCdmcm9tJykpIHsKICAgICAgICAgICAgbGlzdF9tZW1iZXJzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7Cn0KCmZ1bmN0aW9uIG9uUHJlc2VuY2VFcnJvcihwcmVzKSB7CiAgICBzZXRTdGF0dXMoJ29uUHJlc0Vycm9yICcgKyBwcmVzKTsKICAgIHJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBkb0pvaW4oKSB7CiAgICB2YXIgcm9vbW5vZGUgPSBudWxsLAogICAgICAgIHByZXM7CiAgICBpZiAobG9jYXRpb24uaGFzaC5sZW5ndGggPiAxKSB7CiAgICAgICAgcm9vbW5vZGUgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cigxKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGlmIChyb29tbm9kZS5pbmRleE9mKCcvJykgIT0gLTEpIHsKICAgICAgICAgICAgc2V0U3RhdHVzKCdpbnZhbGlkIGxvY2F0aW9uLCBtdXN0IG5vdCBjb250YWluICIvIicpOwogICAgICAgICAgICBjb25uZWN0aW9uLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAocm9vbW5vZGUuaW5kZXhPZignQCcpICE9IC0xKSB7IC8vIGFsbG93ICNyb29tQGhvc3QKICAgICAgICAgICAgcm9vbWppZCA9IHJvb21ub2RlOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgcm9vbW5vZGUgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOCk7CiAgICAgICAgbG9jYXRpb24uaGFzaCA9IHJvb21ub2RlOwogICAgfQogICAgaWYgKHJvb21qaWQgPT09IG51bGwpIHsKICAgICAgICByb29tamlkID0gcm9vbW5vZGUgKyAnQCcgKyBDT05GRVJFTkNFRE9NQUlOOwogICAgfQogICAgc2V0U3RhdHVzKCdKb2luaW5nICcgKyBsb2NhdGlvbi5oYXNoKTsKICAgIG15cm9vbWppZCA9IHJvb21qaWQgKyAnLycgKyBTdHJvcGhlLmdldE5vZGVGcm9tSmlkKGNvbm5lY3Rpb24uamlkKTsKICAgIGxpc3RfbWVtYmVycyA9IFtdOwogICAgY29uc29sZS5sb2coJ2pvaW5pbmcnLCByb29tamlkKTsKCiAgICAvLyBtdWMgc3R1ZmYKICAgIGNvbm5lY3Rpb24uYWRkSGFuZGxlcihvblByZXNlbmNlLCBudWxsLCAncHJlc2VuY2UnLCBudWxsLCBudWxsLCByb29tamlkLCB7bWF0Y2hCYXJlOiB0cnVlfSk7CiAgICBjb25uZWN0aW9uLmFkZEhhbmRsZXIob25QcmVzZW5jZVVuYXZhaWxhYmxlLCBudWxsLCAncHJlc2VuY2UnLCAndW5hdmFpbGFibGUnLCBudWxsLCByb29tamlkLCB7bWF0Y2hCYXJlOiB0cnVlfSk7CiAgICBjb25uZWN0aW9uLmFkZEhhbmRsZXIob25QcmVzZW5jZUVycm9yLCBudWxsLCAncHJlc2VuY2UnLCAnZXJyb3InLCBudWxsLCByb29tamlkLCB7bWF0Y2hCYXJlOiB0cnVlfSk7CgogICAgcHJlcyA9ICRwcmVzKHt0bzogbXlyb29tamlkIH0pCiAgICAgICAgICAgIC5jKCd4Jywge3htbG5zOiAnaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvbXVjJ30pOwogICAgY29ubmVjdGlvbi5zZW5kKHByZXMpOwp9CgpmdW5jdGlvbiBvbk1lZGlhUmVhZHkoZXZlbnQsIHN0cmVhbSkgewogICAgbG9jYWxTdHJlYW0gPSBzdHJlYW07CiAgICBjb25uZWN0aW9uLmppbmdsZS5sb2NhbFN0cmVhbSA9IHN0cmVhbTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbG9jYWxTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKS5sZW5ndGg7IGkrKykgewogICAgICAgIHNldFN0YXR1cygndXNpbmcgYXVkaW8gZGV2aWNlICInICsgbG9jYWxTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKVtpXS5sYWJlbCArICciJyk7CiAgICB9CiAgICBmb3IgKGkgPSAwOyBpIDwgbG9jYWxTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKS5sZW5ndGg7IGkrKykgewogICAgICAgIHNldFN0YXR1cygndXNpbmcgdmlkZW8gZGV2aWNlICInICsgbG9jYWxTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKVtpXS5sYWJlbCArICciJyk7CiAgICB9CiAgICAvLyBtdXRlIHZpZGVvIG9uIGZpcmVmb3ggYW5kIHJlY2VudCBjYW5hcnkKICAgICQoJyNtaW5pdmlkZW8nKVswXS5tdXRlZCA9IHRydWU7CiAgICAkKCcjbWluaXZpZGVvJylbMF0udm9sdW1lID0gMDsKCiAgICBSVEMuYXR0YWNoTWVkaWFTdHJlYW0oJCgnI21pbml2aWRlbycpLCBsb2NhbFN0cmVhbSk7CgogICAgZG9Db25uZWN0KCk7CgogICAgaWYgKHR5cGVvZiBoYXJrID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgdmFyIG9wdGlvbnMgPSB7IGludGVydmFsOiA0MDAgfTsKICAgICAgICB2YXIgc3BlZWNoRXZlbnRzID0gaGFyayhzdHJlYW0sIG9wdGlvbnMpOwoKICAgICAgICBzcGVlY2hFdmVudHMub24oJ3NwZWFraW5nJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb25zb2xlLmxvZygnc3BlYWtpbmcnKTsKICAgICAgICB9KTsKCiAgICAgICAgc3BlZWNoRXZlbnRzLm9uKCdzdG9wcGVkX3NwZWFraW5nJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb25zb2xlLmxvZygnc3RvcHBlZF9zcGVha2luZycpOwogICAgICAgIH0pOwogICAgICAgIHNwZWVjaEV2ZW50cy5vbigndm9sdW1lX2NoYW5nZScsIGZ1bmN0aW9uICh2b2x1bWUsIHRyZXNob2xkKSB7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCd2b2x1bWUnLCB2b2x1bWUsIHRyZXNob2xkKTsKICAgICAgICAgICAgaWYgKHZvbHVtZSA8IC02MCkgeyAvLyB2YXJ5IGJldHdlZW4gLTYwIGFuZCAtMzUKICAgICAgICAgICAgICAgICQoJyNvd252b2x1bWUnKS5jc3MoJ3dpZHRoJywgMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodm9sdW1lID4gLTM1KSB7CiAgICAgICAgICAgICAgICAkKCcjb3dudm9sdW1lJykuY3NzKCd3aWR0aCcsICcxMDAlJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCcjb3dudm9sdW1lJykuY3NzKCd3aWR0aCcsICh2b2x1bWUgKyAxMDApICogMTAwIC8gMjUgLSAxNjAgKyAnJScpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUud2Fybignd2l0aG91dCBoYXJrLCB5b3UgYXJlIG1pc3NpbmcgcXVpdGUgYSBuaWNlIGZlYXR1cmUnKTsKICAgIH0KfQoKZnVuY3Rpb24gb25NZWRpYUZhaWx1cmUoKSB7CiAgICBzZXRTdGF0dXMoJ21lZGlhIGZhaWx1cmUnKTsKfQoKZnVuY3Rpb24gb25DYWxsSW5jb21pbmcoZXZlbnQsIHNpZCkgewogICAgc2V0U3RhdHVzKCdpbmNvbWluZyBjYWxsJyArIHNpZCk7CiAgICB2YXIgc2VzcyA9IGNvbm5lY3Rpb24uamluZ2xlLnNlc3Npb25zW3NpZF07CiAgICBzZXNzLnNlbmRBbnN3ZXIoKTsKICAgIHNlc3MuYWNjZXB0KCk7CgogICAgLy8gYWx0ZXJuYXRpdmVseS4uLgogICAgLy9zZXNzLnRlcm1pbmF0ZShidXN5KQogICAgLy9jb25uZWN0aW9uLmppbmdsZS50ZXJtaW5hdGUoc2lkKTsKfQoKZnVuY3Rpb24gYXJyYW5nZVZpZGVvcyhzZWxlY3RvcikgewogICAgdmFyIGZsb29yID0gTWF0aC5mbG9vciwKICAgICAgICBlbGVtZW50cyA9ICQoc2VsZWN0b3IpLAogICAgICAgIGhvd01hbnkgPSBlbGVtZW50cy5sZW5ndGgsCiAgICAgICAgYXZhaWxhYmxlV2lkdGggPSAkKHNlbGVjdG9yKS5wYXJlbnQoKS5pbm5lcldpZHRoKCksCiAgICAgICAgYXZhaWxhYmxlSGVpZ2h0ID0gJChzZWxlY3RvcikucGFyZW50KCkuaW5uZXJIZWlnaHQoKSwKICAgICAgICB1c2VkV2lkdGggPSAwLAogICAgICAgIGFzcGVjdFJhdGlvID0gNCAvIDM7CiAgICBpZiAoYXZhaWxhYmxlSGVpZ2h0IDwgYXZhaWxhYmxlV2lkdGggLyBhc3BlY3RSYXRpbykgewogICAgICAgIGF2YWlsYWJsZVdpZHRoID0gYXZhaWxhYmxlSGVpZ2h0ICogYXNwZWN0UmF0aW87CiAgICB9CiAgICBlbGVtZW50cy5oZWlnaHQoYXZhaWxhYmxlSGVpZ2h0KTsKCiAgICBlbGVtZW50cy5lYWNoKGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICQoZWxlbWVudHNbaW5kZXhdKS5yZW1vdmVBdHRyKCdzdHlsZScpOwogICAgfSk7CgogICAgLy8gaGFyZGNvZGVkIGxheW91dCBmb3IgdXAgdG8gZm91ciB2aWRlb3MKICAgIHN3aXRjaCAoaG93TWFueSkgewogICAgY2FzZSAxOgogICAgICAgIHVzZWRXaWR0aCA9IGF2YWlsYWJsZVdpZHRoOwogICAgICAgICQoZWxlbWVudHNbMF0pLmNzcygndG9wJywgMCk7CiAgICAgICAgJChlbGVtZW50c1swXSkuY3NzKCdsZWZ0JywgKCQoc2VsZWN0b3IpLnBhcmVudCgpLmlubmVyV2lkdGgoKSAtIGF2YWlsYWJsZVdpZHRoKSAvIDIpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAyOgogICAgICAgIHVzZWRXaWR0aCA9IGF2YWlsYWJsZVdpZHRoIC8gMjsKICAgICAgICAkKGVsZW1lbnRzWzBdKS5jc3MoeyBsZWZ0OiAnMHB4JywgdG9wOiAnMHB4J30pOwogICAgICAgICQoZWxlbWVudHNbMV0pLmNzcyh7IHJpZ2h0OiAnMHB4JywgYm90dG9tOiAnMHB4J30pOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAzOgogICAgICAgIHVzZWRXaWR0aCA9IGF2YWlsYWJsZVdpZHRoIC8gMjsKICAgICAgICAkKGVsZW1lbnRzWzBdKS5jc3MoeyBsZWZ0OiAnMHB4JywgdG9wOiAnMHB4J30pOwogICAgICAgICQoZWxlbWVudHNbMV0pLmNzcyh7IHJpZ2h0OiAnMHB4JywgdG9wOiAnMHB4J30pOwogICAgICAgICQoZWxlbWVudHNbMl0pLmNzcyh7IGxlZnQ6ICgkKHNlbGVjdG9yKS5wYXJlbnQoKS5pbm5lcldpZHRoKCkgLSBhdmFpbGFibGVXaWR0aCArIHVzZWRXaWR0aCkgLyAyLCBib3R0b206ICcwcHgnIH0pOwogICAgICAgIGJyZWFrOwogICAgY2FzZSA0OgogICAgICAgIHVzZWRXaWR0aCA9IGF2YWlsYWJsZVdpZHRoIC8gMjsKICAgICAgICAkKGVsZW1lbnRzWzBdKS5jc3MoeyBsZWZ0OiAnMHB4JywgdG9wOiAnMHB4J30pOwogICAgICAgICQoZWxlbWVudHNbMF0pLmNzcygnbGVmdCcsICgkKHNlbGVjdG9yKS5wYXJlbnQoKS5pbm5lcldpZHRoKCkgLSBhdmFpbGFibGVXaWR0aCkgLyAyKTsKICAgICAgICAkKGVsZW1lbnRzWzFdKS5jc3MoeyByaWdodDogJzBweCcsIHRvcDogJzBweCd9KTsKICAgICAgICAkKGVsZW1lbnRzWzFdKS5jc3MoJ3JpZ2h0JywgKCQoc2VsZWN0b3IpLnBhcmVudCgpLmlubmVyV2lkdGgoKSAtIGF2YWlsYWJsZVdpZHRoKSAvIDIpOwogICAgICAgICQoZWxlbWVudHNbMl0pLmNzcyh7IGxlZnQ6ICcwcHgnLCBib3R0b206ICcwcHgnfSk7CiAgICAgICAgJChlbGVtZW50c1syXSkuY3NzKCdsZWZ0JywgKCQoc2VsZWN0b3IpLnBhcmVudCgpLmlubmVyV2lkdGgoKSAtIGF2YWlsYWJsZVdpZHRoKSAvIDIpOwogICAgICAgICQoZWxlbWVudHNbM10pLmNzcyh7IHJpZ2h0OiAnMHB4JywgYm90dG9tOiAnMHB4J30pOwogICAgICAgICQoZWxlbWVudHNbM10pLmNzcygncmlnaHQnLCAoJChzZWxlY3RvcikucGFyZW50KCkuaW5uZXJXaWR0aCgpIC0gYXZhaWxhYmxlV2lkdGgpIC8gMik7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBlbGVtZW50cy5lYWNoKGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICQoZWxlbWVudHNbaW5kZXhdKS5jc3MoewogICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgd2lkdGg6IHVzZWRXaWR0aCwKICAgICAgICAgICAgaGVpZ2h0OiB1c2VkV2lkdGggLyBhc3BlY3RSYXRpbwogICAgICAgIH0pOwogICAgICAgICQoZWxlbWVudHNbaW5kZXhdKS5zaG93KCk7CiAgICB9KTsKfQoKCmZ1bmN0aW9uIG9uQ2FsbEFjdGl2ZShldmVudCwgdmlkZW9lbGVtLCBzaWQpIHsKICAgIHNldFN0YXR1cygnY2FsbCBhY3RpdmUgJyArIHNpZCk7CiAgICAkKHZpZGVvZWxlbSkuYXBwZW5kVG8oJyNsYXJnZXZpZGVvY29udGFpbmVyJyk7CiAgICBhcnJhbmdlVmlkZW9zKCcjbGFyZ2V2aWRlb2NvbnRhaW5lciA+Jyk7CiAgICBjb25uZWN0aW9uLmppbmdsZS5zZXNzaW9uc1tzaWRdLmdldFN0YXRzKDEwMDApOwp9CgpmdW5jdGlvbiBvbkNhbGxUZXJtaW5hdGVkKGV2ZW50LCBzaWQsIHJlYXNvbikgewogICAgc2V0U3RhdHVzKCdjYWxsIHRlcm1pbmF0ZWQgJyArIHNpZCArIChyZWFzb24gPyAoJzogJyArIHJlYXNvbikgOiAnJykpOwogICAgaWYgKE9iamVjdC5rZXlzKGNvbm5lY3Rpb24uamluZ2xlLnNlc3Npb25zKS5sZW5ndGggPT09IDApIHsKICAgICAgICBzZXRTdGF0dXMoJ2FsbCBjYWxscyB0ZXJtaW5hdGVkJyk7CiAgICB9CiAgICAkKCcjbGFyZ2V2aWRlb2NvbnRhaW5lciAjbGFyZ2V2aWRlb18nICsgc2lkKS5yZW1vdmUoKTsKICAgIGFycmFuZ2VWaWRlb3MoJyNsYXJnZXZpZGVvY29udGFpbmVyID4nKTsKfQoKZnVuY3Rpb24gd2FpdEZvclJlbW90ZVZpZGVvKHNlbGVjdG9yLCBzaWQpIHsKICAgIHZhciBzZXNzID0gY29ubmVjdGlvbi5qaW5nbGUuc2Vzc2lvbnNbc2lkXTsKICAgIHZpZGVvVHJhY2tzID0gc2Vzcy5yZW1vdGVTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKTsKICAgIGlmICh2aWRlb1RyYWNrcy5sZW5ndGggPT09IDAgfHwgc2VsZWN0b3JbMF0uY3VycmVudFRpbWUgPiAwKSB7CiAgICAgICAgJChkb2N1bWVudCkudHJpZ2dlcignY2FsbGFjdGl2ZS5qaW5nbGUnLCBbc2VsZWN0b3IsIHNpZF0pOwogICAgICAgIFJUQy5hdHRhY2hNZWRpYVN0cmVhbShzZWxlY3Rvciwgc2Vzcy5yZW1vdGVTdHJlYW0pOyAvLyBGSVhNRTogd2h5IGRvIGkgaGF2ZSB0byBkbyB0aGlzIGZvciBGRj8KICAgICAgICBjb25zb2xlLmxvZygnd2FpdEZvcnJlbW90ZXZpZGVvJywgc2Vzcy5wZWVyY29ubmVjdGlvbi5pY2VDb25uZWN0aW9uU3RhdGUsIHNlc3MucGVlcmNvbm5lY3Rpb24uc2lnbmFsaW5nU3RhdGUpOwogICAgfSBlbHNlIHsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgd2FpdEZvclJlbW90ZVZpZGVvKHNlbGVjdG9yLCBzaWQpOyB9LCAxMDApOwogICAgfQp9CgpmdW5jdGlvbiBvblJlbW90ZVN0cmVhbUFkZGVkKGV2ZW50LCBkYXRhLCBzaWQpIHsKICAgIHNldFN0YXR1cygnUmVtb3RlIHN0cmVhbSBmb3Igc2Vzc2lvbiAnICsgc2lkICsgJyBhZGRlZC4nKTsKICAgIGlmICgkKCcjbGFyZ2V2aWRlb18nICsgc2lkKS5sZW5ndGggIT09IDApIHsKICAgICAgICBjb25zb2xlLmxvZygnaWdub3JpbmcgZHVwbGljYXRlIG9uUmVtb3RlU3RyZWFtQWRkZWQuLi4nKTsgLy8gRkYgMjAKICAgICAgICByZXR1cm47CiAgICB9CiAgICAvLyBhZnRlciByZW1vdGUgc3RyZWFtIGhhcyBiZWVuIGFkZGVkLCB3YWl0IGZvciBpY2UgdG8gYmVjb21lIGNvbm5lY3RlZAogICAgLy8gb2xkIGNvZGUgZm9yIGNvbXBhdCB3aXRoIEZGMjIgYmV0YQogICAgdmFyIGVsID0gJCgiPHZpZGVvIGF1dG9wbGF5PSdhdXRvcGxheScgc3R5bGU9J2Rpc3BsYXk6bm9uZScvPiIpLmF0dHIoJ2lkJywgJ2xhcmdldmlkZW9fJyArIHNpZCk7CiAgICBSVEMuYXR0YWNoTWVkaWFTdHJlYW0oZWwsIGRhdGEuc3RyZWFtKTsKICAgIHdhaXRGb3JSZW1vdGVWaWRlbyhlbCwgc2lkKTsKICAgIC8qIGRvZXMgbm90IHlldCB3b3JrIGZvciByZW1vdGUgc3RyZWFtcyAtLSBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3dlYnJ0Yy9pc3N1ZXMvZGV0YWlsP2lkPTg2MQogICAgdmFyIG9wdGlvbnMgPSB7IGludGVydmFsOjUwMCB9OwogICAgdmFyIHNwZWVjaEV2ZW50cyA9IGhhcmsoZGF0YS5zdHJlYW0sIG9wdGlvbnMpOwoKICAgIHNwZWVjaEV2ZW50cy5vbigndm9sdW1lX2NoYW5nZScsIGZ1bmN0aW9uICh2b2x1bWUsIHRyZXNob2xkKSB7CiAgICAgIGNvbnNvbGUubG9nKCd2b2x1bWUgZm9yICcgKyBzaWQsIHZvbHVtZSwgdHJlc2hvbGQpOwogICAgfSk7CiAgICAqLwp9CgpmdW5jdGlvbiBvblJlbW90ZVN0cmVhbVJlbW92ZWQoZXZlbnQsIGRhdGEsIHNpZCkgewogICAgc2V0U3RhdHVzKCdSZW1vdGUgc3RyZWFtIGZvciBzZXNzaW9uICcgKyBzaWQgKyAnIHJlbW92ZWQuJyk7Cn0KCmZ1bmN0aW9uIG9uSWNlQ29ubmVjdGlvblN0YXRlQ2hhbmdlZChldmVudCwgc2lkLCBzZXNzKSB7CiAgICBjb25zb2xlLmxvZygnaWNlIHN0YXRlIGZvcicsIHNpZCwgc2Vzcy5wZWVyY29ubmVjdGlvbi5pY2VDb25uZWN0aW9uU3RhdGUpOwogICAgY29uc29sZS5sb2coJ3NpZyBzdGF0ZSBmb3InLCBzaWQsIHNlc3MucGVlcmNvbm5lY3Rpb24uc2lnbmFsaW5nU3RhdGUpOwogICAgLy8gd29ya3MgbGlrZSBjaGFybSwgdW5mb3J0dW5hdGVseSBvbmx5IGluIGNocm9tZSBhbmQgRkYgbmlnaHRseSwgbm90IEZGMjIgYmV0YQogICAgLyoKICAgIGlmIChzZXNzLnBlZXJjb25uZWN0aW9uLnNpZ25hbGluZ1N0YXRlID09ICdzdGFibGUnICYmIHNlc3MucGVlcmNvbm5lY3Rpb24uaWNlQ29ubmVjdGlvblN0YXRlID09ICdjb25uZWN0ZWQnKSB7CiAgICAgICAgdmFyIGVsID0gJCgiPHZpZGVvIGF1dG9wbGF5PSdhdXRvcGxheScgc3R5bGU9J2Rpc3BsYXk6bm9uZScvPiIpLmF0dHIoJ2lkJywgJ2xhcmdldmlkZW9fJyArIHNpZCk7CiAgICAgICAgJChkb2N1bWVudCkudHJpZ2dlcignY2FsbGFjdGl2ZS5qaW5nbGUnLCBbZWwsIHNpZF0pOwogICAgICAgIFJUQy5hdHRhY2hNZWRpYVN0cmVhbShlbCwgc2Vzcy5yZW1vdGVTdHJlYW0pOyAvLyBtb3ZpbmcgdGhpcyBiZWZvcmUgdGhlIHRyaWdnZXIgZG9lc24ndCB3b3JrIGluIEZGPyEKICAgIH0KICAgICovCn0KCmZ1bmN0aW9uIG5vU3R1bkNhbmRpZGF0ZXMoZXZlbnQpIHsKICAgIHNldFN0YXR1cygnd2VicnRjIGRpZCBub3QgZW5jb3VudGVyIHN0dW4gY2FuZGlkYXRlcywgTkFUIHRyYXZlcnNhbCB3aWxsIG5vdCB3b3JrJyk7CiAgICBjb25zb2xlLndhcm4oJ3dlYnJ0YyBkaWQgbm90IGVuY291bnRlciBzdHVuIGNhbmRpZGF0ZXMsIE5BVCB0cmF2ZXJzYWwgd2lsbCBub3Qgd29yaycpOwp9CgpmdW5jdGlvbiBvbkNvbm5lY3RlZChldmVudCkgewogICAgZG9Kb2luKCk7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAkKHdpbmRvdykuYmluZCgnaGFzaGNoYW5nZScsIG9uSGFzaENoYW5nZSk7CiAgICB9LCA1MDApOwp9CgokKHdpbmRvdykuYmluZCgnYmVmb3JldW5sb2FkJywgZnVuY3Rpb24gKCkgewogICAgaWYgKGNvbm5lY3Rpb24gJiYgY29ubmVjdGlvbi5jb25uZWN0ZWQpIHsKICAgICAgICAvLyBlbnN1cmUgc2lnbm91dAogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICAgICAgdXJsOiAnL2h0dHAtYmluZCcsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3htbCcsCiAgICAgICAgICAgIGRhdGE6ICI8Ym9keSByaWQ9JyIgKyBjb25uZWN0aW9uLnJpZCArICInIHhtbG5zPSdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9odHRwYmluZCcgc2lkPSciICsgY29ubmVjdGlvbi5zaWQgKyAiJyB0eXBlPSd0ZXJtaW5hdGUnPjxwcmVzZW5jZSB4bWxucz0namFiYmVyOmNsaWVudCcgdHlwZT0ndW5hdmFpbGFibGUnLz48L2JvZHk+IiwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzaWduZWQgb3V0Jyk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChYTUxIdHRwUmVxdWVzdCwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzaWdub3V0IGVycm9yJywgdGV4dFN0YXR1cyArICcgKCcgKyBlcnJvclRocm93biArICcpJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KfSk7CgokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7CiAgICBSVEMgPSBzZXR1cFJUQygpOwogICAgY29ubmVjdGlvbiA9IG5ldyBTdHJvcGhlLkNvbm5lY3Rpb24oQk9TSF9TRVJWSUNFKTsKICAgIGlmIChSQVdMT0dHSU5HKSB7CiAgICAgICAgY29ubmVjdGlvbi5yYXdJbnB1dCA9IGZ1bmN0aW9uIChkYXRhKSB7IGNvbnNvbGUubG9nKCdSRUNWOiAnICsgZGF0YSk7IH07CiAgICAgICAgY29ubmVjdGlvbi5yYXdPdXRwdXQgPSBmdW5jdGlvbiAoZGF0YSkgeyBjb25zb2xlLmxvZygnU0VORDogJyArIGRhdGEpOyB9OwogICAgfQogICAgY29ubmVjdGlvbi5qaW5nbGUuaWNlX2NvbmZpZyA9IGljZV9jb25maWc7CiAgICBpZiAoUlRDKSB7CiAgICAgICAgY29ubmVjdGlvbi5qaW5nbGUucGNfY29uc3RyYWludHMgPSBSVEMucGNfY29uc3RyYWludHM7CiAgICB9CgogICAgJChkb2N1bWVudCkuYmluZCgnY29ubmVjdGVkJywgb25Db25uZWN0ZWQpOwogICAgJChkb2N1bWVudCkuYmluZCgnbWVkaWFyZWFkeS5qaW5nbGUnLCBvbk1lZGlhUmVhZHkpOwogICAgJChkb2N1bWVudCkuYmluZCgnbWVkaWFmYWlsdXJlLmppbmdsZScsIG9uTWVkaWFGYWlsdXJlKTsKICAgICQoZG9jdW1lbnQpLmJpbmQoJ2NhbGxpbmNvbWluZy5qaW5nbGUnLCBvbkNhbGxJbmNvbWluZyk7CiAgICAkKGRvY3VtZW50KS5iaW5kKCdjYWxsYWN0aXZlLmppbmdsZScsIG9uQ2FsbEFjdGl2ZSk7CiAgICAkKGRvY3VtZW50KS5iaW5kKCdjYWxsdGVybWluYXRlZC5qaW5nbGUnLCBvbkNhbGxUZXJtaW5hdGVkKTsKCiAgICAkKGRvY3VtZW50KS5iaW5kKCdyZW1vdGVzdHJlYW1hZGRlZC5qaW5nbGUnLCBvblJlbW90ZVN0cmVhbUFkZGVkKTsKICAgICQoZG9jdW1lbnQpLmJpbmQoJ3JlbW90ZXN0cmVhbXJlbW92ZWQuamluZ2xlJywgb25SZW1vdGVTdHJlYW1SZW1vdmVkKTsKICAgICQoZG9jdW1lbnQpLmJpbmQoJ2ljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZS5qaW5nbGUnLCBvbkljZUNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQpOwogICAgJChkb2N1bWVudCkuYmluZCgnbm9zdHVuY2FuZGlkYXRlcy5qaW5nbGUnLCBub1N0dW5DYW5kaWRhdGVzKTsKICAgICQoZG9jdW1lbnQpLmJpbmQoJ2Fjay5qaW5nbGUnLCBmdW5jdGlvbiAoZXZlbnQsIHNpZCwgYWNrKSB7CiAgICAgICAgY29uc29sZS5sb2coJ2dvdCBzdGFuemEgYWNrIGZvciAnICsgc2lkLCBhY2spOwogICAgfSk7CiAgICAkKGRvY3VtZW50KS5iaW5kKCdlcnJvci5qaW5nbGUnLCBmdW5jdGlvbiAoZXZlbnQsIHNpZCwgZXJyKSB7CiAgICAgICAgY29uc29sZS5sb2coJ2dvdCBzdGFuemEgZXJyb3IgZm9yICcgKyBzaWQsIGVycik7CiAgICB9KTsKICAgICQoZG9jdW1lbnQpLmJpbmQoJ3BhY2tldGxvc3MuamluZ2xlJywgZnVuY3Rpb24gKGV2ZW50LCBzaWQsIGxvc3MpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ3BhY2tldGxvc3MnLCBzaWQsIGxvc3MpOwogICAgfSk7CiAgICBpZiAoUlRDICE9PSBudWxsKSB7CiAgICAgICAgUlRDUGVlcmNvbm5lY3Rpb24gPSBSVEMucGVlcmNvbm5lY3Rpb247CiAgICAgICAgaWYgKFJUQy5icm93c2VyID09ICdmaXJlZm94JykgewogICAgICAgICAgICBjb25uZWN0aW9uLmppbmdsZS5tZWRpYV9jb25zdHJhaW50cy5tYW5kYXRvcnkuTW96RG9udE9mZmVyRGF0YUNoYW5uZWwgPSB0cnVlOwogICAgICAgIH0KICAgICAgICAvL3NldFN0YXR1cygncGxlYXNlIGFsbG93IGFjY2VzcyB0byBtaWNyb3Bob25lIGFuZCBjYW1lcmEnKTsKICAgICAgICAvL2dldFVzZXJNZWRpYVdpdGhDb25zdHJhaW50cygpOwogICAgfSBlbHNlIHsKICAgICAgICBzZXRTdGF0dXMoJ3dlYnJ0YyBjYXBhYmxlIGJyb3dzZXIgcmVxdWlyZWQnKTsKICAgIH0KfSk7Cgo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 14:56:55 GMT",
                    "Content-Length": "14537",
                    "Date": "Sat, 08 Nov 2014 14:56:55 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}