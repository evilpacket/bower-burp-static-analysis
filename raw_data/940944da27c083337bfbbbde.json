{
    "url": "http://localhost:9999/fglmobile/fgl-html5-sdk/fgl.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Client-side JSON injection (DOM-based)",
    "issueType": 2098032,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based JSON injection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and incorporates this into a string that is parsed as a JSON data structure and then processed by the application. An attacker may be able to use this behavior to construct a URL which, if visited by another application user, will cause arbitrary JSON data to be processed. Depending on the purpose for which this data is used, it may be possible to subvert the application's logic, or cause unintended actions on behalf of the user.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based JSON injection vulnerabilities is not to parse as JSON any string containing data that originated from an untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from modifying the JSON structure in inappropriate ways. This may involve strict validation of specific items to ensure they do not contain any characters that may interfere with the structure of the JSON when it is parsed.",
    "issueDetail": "The application may be vulnerable to DOM-based client-side JSON injection. Data is read from <b>window.location.hash</b> and written to <b>JSON.parse()</b> via the following statement:<ul><li>var sdkSettings = JSON.parse(window.location.hash.substr(8));</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/fglmobile/fgl-html5-sdk/fgl.js",
                "path": "/fglmobile/fgl-html5-sdk/fgl.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9mZ2xtb2JpbGUvZmdsLWh0bWw1LXNkay9mZ2wuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjkzMDUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDA6MTM6NDggR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDAwOjEzOjQ4IEdNVA0KDQovKioKICogRkdMIFNESyAtIEltcGxlbWVudCB0aGlzIGludG8geW91ciBnYW1lIQogKgogKiBWZXJzaW9uIDEuNC4yCiAqCiAqIE5PVEU6IFRoaXMgaXMgYW4gaW1wbGVtZW50YXRpb24gdGVzdGluZyB2ZXJzaW9uIG9mIG91ciBTREsuIFdoZW4geW91CiAqIHVwbG9hZCB5b3VyIGdhbWUgdG8gRkdMLmNvbSwgdGhpcyBTREsgd2lsbCBiZSByZXBsYWNlZCB3aXRoIG91ciByZWFsCiAqIHByb2R1Y3Rpb24gU0RLcyAod2hpY2ggY29udGFpbiBwbGF0Zm9ybS1zcGVjaWZpYyBmdW5jdGlvbmFsaXR5KS4gWW91CiAqIG11c3Qgbm90IHNlbGYtcHVibGlzaCB5b3VyIGFwcCB3aXRoIHRoaXMgdmVyc2lvbiBvZiB0aGUgU0RLIGltcGxlbWVudGVkLAogKiBhbmQgeW91IG11c3Qgbm90IGVuY3J5cHQgb3IgbWluaWZ5IHRoaXMgbGlicmFyeSBvciBvdXIgZGVwbG95bWVudCBwcm9jZXNzCiAqIHdpbGwgZmFpbC4KICoKICogRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIHRoZSBJbXBsZW1lbnRhdGlvbiBHdWlkZSBvciBBUEkgZG9jdW1lbnRhdGlvbgogKi8KIAppZigoJ2ZnbCcgaW4gd2luZG93KSA9PSBmYWxzZSkgewogIHdpbmRvdy5mZ2wgPSB3aW5kb3cuRkdMID0gbmV3IEZHTEltcGxlbWVudGF0aW9uVGVzdGluZ1NESygpOwogIGlmKGZnbC5jcmVhdGVkID09IGZhbHNlKSB7CiAgICBmZ2wuY3JlYXRlKCk7CiAgfQp9CgovKioKICogRkdMIFNESyBDbGFzcwogKiBAY29uc3RydWN0b3IKICovCmZ1bmN0aW9uIEZHTEltcGxlbWVudGF0aW9uVGVzdGluZ1NESygpIHsKICAidXNlIHN0cmljdCI7CiAgCiAgdmFyIHNlbGYgPSB0aGlzOwogIHZhciBodG1sU3R5bGVDb250YWluZXIgPSB7IH07ICAgLy9mYW5jeSBodG1sIHN0eWxlIGRlZmluaXRpb25zCiAgdmFyIHNjb3JlT3ZlcmxheSA9IG51bGw7CiAgCiAgc2VsZi5TSVpFXzMwMHgyNTAgPSAxOwogIHNlbGYuU0laRV9PVkVSTEFZID0gMjsKCiAgc2VsZi5vdmVybGF5ID0gbnVsbDsKICBzZWxmLnN0YXJ0ZWQgPSBmYWxzZTsKICBzZWxmLmNyZWF0ZWQgPSBmYWxzZTsKICBzZWxmLnJlYWR5ID0gZmFsc2U7CiAgc2VsZi5yZWFkeUZ1bmN0aW9ucyA9IFsgXTsKCiAgc2VsZi5jcm9zc1Byb21vdGlvbkVuYWJsZWQgPSB0cnVlOwogIHNlbGYudW5sb2NrRW5hYmxlZCA9IHRydWU7CiAgc2VsZi5icmFuZGluZ0VuYWJsZWQgPSB0cnVlOwogIAogIHNlbGYuZ2FtZUlkICA9ICd0ZXN0JzsKICAKICBzZWxmLmh0bWxIZWxwZXJzID0geyB9OwogIAogIHNlbGYuZ2V0TWV0YSA9IGZ1bmN0aW9uKG1ldGEpIHsKICAgIHZhciBtZXRhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdtZXRhJyk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZXRhcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAobWV0YXNbaV0uZ2V0QXR0cmlidXRlKCduYW1lJykgPT0gbWV0YSkgewogICAgICAgIHJldHVybiBtZXRhc1tpXS5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuICcnOwogIH07CgogIHNlbGYubG9hZFNjb3JlcyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHNjb3Jlc1N0ciA9IGxvY2FsU3RvcmFnZVsnbGIuJyArIHNlbGYuZ2FtZUlkXTsKICAgIGlmIChzY29yZXNTdHIgPT0gbnVsbCB8fCBzY29yZXNTdHIgPT0gJycpIHsKICAgICAgcmV0dXJuIFsgXTsKICAgIH0KICAgIHJldHVybiBKU09OLnBhcnNlKHNjb3Jlc1N0cik7CiAgfTsKCiAgc2VsZi5zYXZlU2NvcmVzID0gZnVuY3Rpb24oc2NvcmVzKSB7CiAgICB3aGlsZSAoc2NvcmVzLmxlbmd0aCA+IDIwKSB7CiAgICAgIHNjb3Jlcy5wb3AoKTsKICAgIH0KICAgIGxvY2FsU3RvcmFnZVsnbGIuJyArIHNlbGYuZ2FtZUlkXSA9IEpTT04uc3RyaW5naWZ5KHNjb3Jlcyk7CiAgfTsKCiAgLyoqCiAgICogSW5pdGlhbGlzZXMgdGhlIEFQSS4KICAgKi8KICBzZWxmLmNyZWF0ZSA9IGZ1bmN0aW9uKCkgewogICAgaWYoc2VsZi5jcmVhdGVkID09IHRydWUpIHsgcmV0dXJuOyB9CiAgICAKICAgIGlmKCFkb2N1bWVudC5ib2R5KXsKICAgICAgc2V0VGltZW91dChzZWxmLmNyZWF0ZSwgMTApOwogICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIHZhciBnYW1lSWQgPSBzZWxmLmdldE1ldGEoJ2ZnbC1nYW1laWQnKTsKICAgIGlmICghZ2FtZUlkKSB7CiAgICAgIGdhbWVJZCA9ICd0ZXN0JzsKICAgIH0KICAgIAogICAgc2VsZi5nYW1lSWQgPSBnYW1lSWQ7CiAgICAKICAgIC8vIFNldCB1cCBDU1MgZm9yIEZHTCBvdmVybGF5cwogICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgIGlmIChzdHlsZS5zdHlsZVNoZWV0KSB7CiAgICAgIHN0eWxlLnN0eWxlU2hlZXQuY3NzVGV4dCA9IGh0bWxTdHlsZUNvbnRhaW5lci5nZXRDc3MoKTsKICAgIH0KICAgIGVsc2UgewogICAgICBzdHlsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShodG1sU3R5bGVDb250YWluZXIuZ2V0Q3NzKCkpKTsKICAgIH0KICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpOwogICAgCiAgICAvLyBJcyBvdXIgU0RLIGluICdydW4gbW9kZSc/CiAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyKDAsOCkgPT0gJyNGR0xTREs9JykgewogICAgICAvLyBSdW4hCiAgICAgIHZhciBzZGtTZXR0aW5ncyA9IEpTT04ucGFyc2Uod2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyKDgpKTsKICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnJzsKICAgICAgCiAgICAgIGlmICgnY3Jvc3NQcm9tb3Rpb25FbmFibGVkJyBpbiBzZGtTZXR0aW5ncykKICAgICAgICBzZWxmLmNyb3NzUHJvbW90aW9uRW5hYmxlZCA9IHNka1NldHRpbmdzLmNyb3NzUHJvbW90aW9uRW5hYmxlZDsKICAgICAgICAKICAgICAgaWYgKCd1bmxvY2tFbmFibGVkJyBpbiBzZGtTZXR0aW5ncykKICAgICAgICBzZWxmLnVubG9ja0VuYWJsZWQgPSBzZGtTZXR0aW5ncy51bmxvY2tFbmFibGVkOwogICAgICAgIAogICAgICBpZiAoJ3VubG9ja2VkJyBpbiBzZGtTZXR0aW5ncykKICAgICAgICBzZWxmLmluQXBwLnVubG9ja2VkID0gc2RrU2V0dGluZ3MudW5sb2NrZWQ7CiAgICAgICAgCiAgICAgIGlmICgnYnJhbmRpbmdFbmFibGVkJyBpbiBzZGtTZXR0aW5ncykKICAgICAgICBzZWxmLmJyYW5kaW5nRW5hYmxlZCA9IHNka1NldHRpbmdzLmJyYW5kaW5nRW5hYmxlZDsKICAgICAgCiAgICAgIHNlbGYuYm9vdCgpOwogICAgfQogICAgZWxzZSB7CiAgICAgIAogICAgICAvLyBBZGQgaW50cm8gc2NyZWVuCiAgICAgIHNlbGYuYWRkVGVzdEJvb3RTY3JlZW4oKTsKICAgIH0KICAgIAogICAgc2VsZi5jcmVhdGVkID0gdHJ1ZTsgIC8vIERvbid0IGFsbG93IGNyZWF0ZSB0byBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMKICB9OwoKICBzZWxmLmJvb3QgPSBmdW5jdGlvbigpIHsKICAgIHNlbGYuZG9SZWFkeUV2ZW50cygpOwogIH07CgogIC8qKgogICAqIE5vdCBjdXJyZW50bHkgaW1wbGVtZW50ZWQKICAgKi8KICBzZWxmLnJlcG9ydEdhbWVTdGF0ZSA9IGZ1bmN0aW9uKHN0YXRlKSB7CiAgICAvLyBQbGFjZWhvbGRlcgogIH07CgogIC8qKgogICAqIE5vdCBjdXJyZW50bHkgaW1wbGVtZW50ZWQKICAgKi8KICBzZWxmLnJlcXVlc3RRdWl0ID0gZnVuY3Rpb24oKSB7CiAgICAvLyBQbGFjZWhvbGRlcgogIH07CgogIC8qKgogICAqIEBwcml2YXRlCiAgICovCiAgc2VsZi5kb1JlYWR5RXZlbnRzID0gZnVuY3Rpb24oKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYucmVhZHlGdW5jdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgc2VsZi5yZWFkeUZ1bmN0aW9uc1tpXSgpOwogICAgfQogICAgc2VsZi5yZWFkeSA9IHRydWU7CiAgfTsKCiAgLyoqCiAgICogUGFzcyB5b3VyIGdhbWUncyBpbml0aWFsaXplciBmdW5jdGlvbnMgdG8gdGhpcwogICAqIEBwYXJhbSB7ZnVuY3Rpb259IGYgRnVuY3Rpb24gdG8gY2FsbCB0byBiZWdpbiBnYW1lCiAgICovCiAgc2VsZi5vblJlYWR5ID0gZnVuY3Rpb24oZikgewogICAgaWYgKHNlbGYucmVhZHkpIHsKICAgICAgZigpOwogICAgfQogICAgZWxzZSBzZWxmLnJlYWR5RnVuY3Rpb25zLnB1c2goZik7CiAgfTsKCiAgLyoqCiAgICogRGlzcGxheXMgYW4gYWR2ZXJ0CiAgICovCiAgc2VsZi5zaG93M3JkUGFydHlBZCA9IHNlbGYuc2hvd0FkID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgaWYgKHNlbGYucmVhZHkgPT0gZmFsc2UpIHsgc2VsZi5zaG93Tm90UmVhZHlXYXJuaW5nKCk7IHJldHVybjsgfSAvLyBEbyBub3QgYWxsb3cgZnVuY3Rpb25zIHRvIGJlIGNhbGxlZCBpZiBub3QgcmVhZHkKICAgIGlmIChzZWxmLmluQXBwICYmIHNlbGYuaW5BcHAuaXNVbmxvY2tlZCgpKSByZXR1cm47CiAgICBzZWxmLnNob3dEaXNtaXNzYWJsZUltYWdlT3ZlcmxheSgnaHR0cHM6Ly9yZXBvcnRzLmZnbC5jb20vc2FuZGJveC9hZHMvaHRtbDUvZXhhbXBsZV9hZHZlcnQucG5nJywgNDAwLCAzNTApOwogIH07CgogIC8qKgogICAqIFN1Ym1pdHMgdGhlIGdpdmVuIHNjb3JlIHRvIHRoZSBzcGVjaWZpZWQgbGVhZGVyYm9hcmQuIElmIHlvdXIgZ2FtZQogICAqIG9ubHkgaGFzIG9uZSBsZWFkZXJib2FyZCwgZG8gbm90IHN1cHBseSBhIGxlYWRlcmJvYXJkSUQuCiAgICogQHBhcmFtIHtOdW1iZXJ9IHNjb3JlIFNjb3JlIHRvIHN1Ym1pdAogICAqIEBwYXJhbSB7c3RyaW5nfSBsZWFkZXJib2FyZElEIE5hbWUgb2YgdGhlIGxlYWRlcmJvYXJkIHRvIHNob3cKICAgKi8KICBzZWxmLnN1Ym1pdFNjb3JlID0gZnVuY3Rpb24oc2NvcmUsIGxlYWRlcmJvYXJkSUQsIGV4dHJhKSB7CiAgICB2YXIgc2NvcmVzID0gbnVsbCwgaG9sZGVyID0gbnVsbDsKICAgIHZhciBwbGF5ZXJOYW1lID0gJyc7CiAgICB2YXIgdGltZSA9IDA7CiAgICAKICAgIGlmIChzZWxmLnJlYWR5ID09IGZhbHNlKSB7IHNlbGYuc2hvd05vdFJlYWR5V2FybmluZygpOyByZXR1cm47IH0gLy8gRG8gbm90IGFsbG93IGZ1bmN0aW9ucyB0byBiZSBjYWxsZWQgaWYgbm90IHJlYWR5CiAgICAKICAgIC8vIENhbGxlZCB3aGVuIHRoZSB1c2VyIGNhbmNlbHMgdGhlIHNjb3JlIHN1Ym1pc3Npb246CiAgICB2YXIgb25TY29yZUNhbmNlbEZ1bmN0aW9uID0gZnVuY3Rpb24oZSkgewogICAgICBzZWxmLnN0b3BFdmVudFByb3BhZ2F0aW9uKGUpOwogICAgICAKICAgICAgLy8gUmVtb3ZlIG5hbWUgZW50cnkgb3ZlcmxheQogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGhvbGRlcik7CiAgICAgIHNlbGYub3ZlcmxheSA9IG51bGw7CiAgICB9CiAgICAKICAgIC8vIENhbGxlZCB3aGVuIG5hbWUgZm9ybSBpcyBzdWJtaXR0ZWQKICAgIHZhciBvbk5hbWVTdWJtaXRGdW5jdGlvbiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgc2VsZi5zdG9wRXZlbnRQcm9wYWdhdGlvbihlKTsKICAgICAgCiAgICAgIC8vIEdldCB0aGUgbmFtZSB0aGF0IHdhcyBlbnRlcmVkCiAgICAgIHBsYXllck5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX3Njb3JlbmFtZWlucHV0JykudmFsdWU7CiAgICAgIAogICAgICAvLyBJZiB0aGUgcGxheWVyIG5hbWUgaXMgaW52YWxpZCwgaGlnaGxpZ2h0IHRoZSBpbnB1dCBib3gKICAgICAgaWYgKCFwbGF5ZXJOYW1lKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF9zY29yZW5hbWVpbnB1dCcpLnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgcmVkJzsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgCiAgICAgIC8vIFJlbW92ZSBuYW1lIGVudHJ5IG92ZXJsYXkKICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChob2xkZXIpOwogICAgICBzZWxmLm92ZXJsYXkgPSBudWxsOwogICAgICAKICAgICAgLy8gR2V0IGxlYWRlcmJvYXJkIHNjb3JlcyBzbyB3ZSBjYW4gcHVzaCBzY29yZQogICAgICBsZWFkZXJib2FyZElEID0gbGVhZGVyYm9hcmRJRCB8fCAnZGVmYXVsdCc7CiAgICAgIHNjb3JlcyA9IHNlbGYubG9hZFNjb3JlcygpOwogICAgICB0aW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CgogICAgICAvLyBBZGQgdGhlIHNjb3JlCiAgICAgIHNjb3Jlcy5wdXNoKCB7CiAgICAgICAgc2NvcmU6IHNjb3JlLAogICAgICAgIHBsYXllcjogcGxheWVyTmFtZSwKICAgICAgICB0aW1lOiB0aW1lCiAgICAgIH0gKTsKCiAgICAgIC8vIFNvcnQgdGhlIHNjb3JlcyBsaXN0CiAgICAgIHNjb3Jlcy5zb3J0KCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKGEuc2NvcmUgPT09IGIuc2NvcmUpIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYS5zY29yZSA8IGIuc2NvcmUgPyAxIDogLTE7CiAgICAgIH0gKTsKCiAgICAgIC8vIFNhdmUgYW5kIGRpc3BsYXkgdGhlIG5ld2x5IHVwZGF0ZWQgbGVhZGVyYm9hcmQKICAgICAgc2VsZi5zYXZlU2NvcmVzKHNjb3Jlcyk7CiAgICAgIHNlbGYuZGlzcGxheVNjb3JlYm9hcmQobGVhZGVyYm9hcmRJRCwgdGltZSk7CiAgICB9CiAgICAKICAgIC8vIFVzZWQgdG8gc3VibWl0IG5hbWUgZm9ybSB3aXRoICdlbnRlcicga2V5CiAgICB2YXIgb25OYW1lS2V5UHJlc3MgPSBmdW5jdGlvbihlKSB7CiAgICAgIGlmKGUua2V5Q29kZSA9PT0gMTMpIHsgLy8gRW50ZXIga2V5CiAgICAgICAgb25OYW1lU3VibWl0RnVuY3Rpb24oZSk7IC8vIFN1Ym1pdCB0aGUgZW50ZXJlZCBuYW1lCiAgICAgIH0KICAgIH0KICAgIAogICAgLy8gVXNlZCB0byBhbGxvdyBmb2N1cyBvbiBuYW1lIGlucHV0IGJveAogICAgdmFyIG9uTmFtZVNlbGVjdCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX3Njb3JlbmFtZWlucHV0Jyk7CiAgICAgIGVsZW1lbnQuZm9jdXMoKTsKICAgIH0KICAgIAogICAgLy8gT25seSBhZGQgYW4gb3ZlcmxheSBpZiB0aGVyZSBpcyBub3Qgb25lIGFscmVhZHkKICAgIGlmKHNlbGYub3ZlcmxheSA9PSBudWxsKQogICAgewogICAgICAvLyBBZGQgb3ZlcmxheSBmb3IgbmFtZSBlbnRyeQogICAgICBob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgaG9sZGVyLmlubmVySFRNTCA9IGh0bWxTdHlsZUNvbnRhaW5lci5nZXRTY29yZURpdihzY29yZSk7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaG9sZGVyKTsKICAgICAgc2VsZi5vdmVybGF5ID0gaG9sZGVyOwogICAgICAKICAgICAgLy8gSG9vayB1cCB0aGUgb25OYW1lU3VibWl0RnVuY3Rpb24gdG8gdGhlIHN1Ym1pdCBidXR0b24KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF9zY29yZXN1Ym1pdGJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywKICAgICAgICBvbk5hbWVTdWJtaXRGdW5jdGlvbiwgZmFsc2UpOwogICAgICAKICAgICAgLy8gQ2xvc2UgYnV0dG9uCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfY2xvc2VidXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsCiAgICAgICAgb25TY29yZUNhbmNlbEZ1bmN0aW9uLCBmYWxzZSk7CiAgICAgIAogICAgICAvLyBJbnB1dCBib3ggaGFuZGxlcnMgKGNsaWNrIHRvIGZvY3VzIGFuZCBlbnRlciB0byBzdWJtaXQpCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfc2NvcmVuYW1laW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsCiAgICAgICAgb25OYW1lU2VsZWN0LCBmYWxzZSk7CiAgICAgIAogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX3Njb3JlbmFtZWlucHV0JykuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLAogICAgICAgIG9uTmFtZUtleVByZXNzLCBmYWxzZSk7CiAgICAgIAogICAgICAvLyBNYWtlIHN1cmUgd2UncmUgdmVydGljYWxseSBjZW50ZXJlZDoKICAgICAgc2VsZi5odG1sSGVscGVycy5jaGVja1ZlcnRpY2FsQ2VudGVyaW5nKCk7CiAgICB9CiAgfTsKICAKICAvKioKICAgKiBEaXNwbGF5cyB0aGUgc2NvcmVib2FyZCBVSSBvdmVyIHlvdXIgZ2FtZQogICAqIEBwYXJhbSB7c3RyaW5nfSBsZWFkZXJib2FyZElEIE5hbWUgb2YgdGhlIGxlYWRlcmJvYXJkIHRvIHNob3cKICAgKiBAcGFyYW0ge051bWJlcn0gaGlnaGxpZ2h0U2NvcmUgSW5kZXggb2Ygc2NvcmUgaW4gdGhlIGxpc3QgdG8gaGlnaGxpZ2h0ICgwIGZvciBub25lKQogICAqLwogIHNlbGYuZGlzcGxheVNjb3JlYm9hcmQgPSBmdW5jdGlvbihsZWFkZXJib2FyZElELCBoaWdobGlnaHRTY29yZSkgewogICAgdmFyIHNjb3JlcyA9IG51bGw7CiAgICB2YXIgaHRtbCA9ICcnOwogICAgdmFyIG51bSA9IDE7CiAgICB2YXIgc2NyaXB0ID0gbnVsbDsKICAgIAogICAgaWYgKHNlbGYucmVhZHkgPT0gZmFsc2UpIHsgc2VsZi5zaG93Tm90UmVhZHlXYXJuaW5nKCk7IHJldHVybjsgfSAvLyBEbyBub3QgYWxsb3cgZnVuY3Rpb25zIHRvIGJlIGNhbGxlZCBpZiBub3QgcmVhZHkKICAgIAogICAgbGVhZGVyYm9hcmRJRCA9IGxlYWRlcmJvYXJkSUQgfHwgJ2RlZmF1bHQnOwogICAgaGlnaGxpZ2h0U2NvcmUgPSBoaWdobGlnaHRTY29yZSB8fCAwOwogICAgCiAgICBodG1sID0gJzx0YWJsZSBjbGFzcz0iZmdsLXNjb3JlYm9hcmQiPjx0cj48dGg+IzwvdGg+PHRoPk5hbWU8L3RoPicgKyAKICAgICAgJzx0aD5TY29yZTwvdGg+PHRoPkRhdGU8L3RoPjwvdHI+JzsKCiAgICBzY29yZXMgPSBzZWxmLmxvYWRTY29yZXMoKTsKICAgIGZvciAodmFyIGkgaW4gc2NvcmVzKSB7CiAgICAgIHZhciBzY29yZSA9IHNjb3Jlc1tpXTsKICAgICAgaWYgKHNjb3JlLnRpbWUgPT0gaGlnaGxpZ2h0U2NvcmUpIHsKICAgICAgICBodG1sICs9ICc8dHIgY2xhc3M9ImZnbC1zY29yZS1oaWdobGlnaHQiPic7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgaHRtbCArPSAnPHRyPic7CiAgICAgIH0KCiAgICAgIGh0bWwgKz0gJzx0ZD4nICsgKG51bSsrKSArICc8L3RkPjx0ZD4nICsgc2NvcmUucGxheWVyICsgJzwvdGQ+PHRkPicgKwogICAgICAgIHNjb3JlLnNjb3JlICsgJzwvdGQ+PHRkPicgKyBuZXcgRGF0ZShzY29yZS50aW1lKS50b0xvY2FsZURhdGVTdHJpbmcoKSArCiAgICAgICAgJzwvdGQ+PC90cj4nOwogICAgfQogICAgaHRtbCArPSAnPC90YWJsZT48L2Rpdj4nOwoKICAgIHNjb3JlT3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgIHNjb3JlT3ZlcmxheS5pbm5lckhUTUwgPSBodG1sU3R5bGVDb250YWluZXIuY3JlYXRlUG9wdXAoIkxlYWRlcmJvYXJkIiwgaHRtbCk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjb3JlT3ZlcmxheSk7CiAgICAKICAgIC8vIFNldCB1cCB0aGUgc3RhcnQgZ2FtZSBidXR0b24KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfY2xvc2VidXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsCiAgICAgIHNlbGYuaGlkZVNjb3JlYm9hcmQsIGZhbHNlKTsKICAgIAogICAgLy8gTWFrZSBzdXJlIHdlJ3JlIHZlcnRpY2FsbHkgY2VudGVyZWQ6CiAgICBzZWxmLmh0bWxIZWxwZXJzLmNoZWNrVmVydGljYWxDZW50ZXJpbmcoKTsKICB9OwoKICAvKioKICAgKiBSZW1vdmVzIHRoZSBzY29yZWJvYXJkIFVJIGZyb20geW91ciBnYW1lCiAgICovCiAgc2VsZi5oaWRlU2NvcmVib2FyZCA9IGZ1bmN0aW9uKGUpIHsKICAgIHNlbGYuc3RvcEV2ZW50UHJvcGFnYXRpb24oZSk7CiAgICBpZiAoISBzY29yZU92ZXJsYXkpIHJldHVybjsKICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoc2NvcmVPdmVybGF5KTsKICAgIHNjb3JlT3ZlcmxheSA9IG51bGw7CiAgfTsKCiAgLyoqCiAgICogR3JhbnRzIHRoZSBzcGVjaWZpZWQgYWNoaWV2ZW1lbnQgdG8gdGhlIHBsYXllcgogICAqLwogIHNlbGYuZ3JhbnRBY2hpZXZlbWVudCA9IGZ1bmN0aW9uKGFjaGlldmVtZW50SWQpIHsKICAgIC8vIFBsYWNlaG9sZGVyCiAgfTsKCiAgLyoqCiAgICogU2hvd3MgYSBsaXN0IG9mIGFjaGlldmVtZW50cyB3aXRoIHRoZWlyIGxvY2tlZC91bmxvY2tlZCBzdGF0ZXMKICAgKi8KICBzZWxmLnNob3dBY2hpZXZlbWVudHMgPSBmdW5jdGlvbigpIHsKICAgIC8vIFBsYWNlaG9sZGVyCiAgfTsKCiAgLyoqCiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBwbGF5ZXIgaGFzIHVubG9ja2VkIHRoZSBzcGVjaWZpZWQgYWNoaWV2ZW1lbnQKICAgKi8KICBzZWxmLmhhc0FjaGlldmVtZW50ID0gZnVuY3Rpb24oYWNoaWV2ZW1lbnRJZCkgewogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIC8qKgogICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYXBwIGlzIHJ1bm5pbmcgaW4gcHJlbWl1bSAodW5sb2NrZWQpIG1vZGU6CiAgICovCiAgc2VsZi5pc1ByZW1pdW0gPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBzZWxmLmluQXBwICYmIHNlbGYuaW5BcHAuaXNVbmxvY2tlZCgpOwogIH07CgogIC8qKgogICAqIEdpdmVzIGFjY2VzcyB0byB0aGUgaW4gYXBwIHB1cmNoYXNpbmcgZnVuY3Rpb25zLgogICAqLwogIHNlbGYuaW5BcHAgPSBuZXcgZnVuY3Rpb24oKSB7CiAgICB2YXIgaW5BcHBfc2VsZiA9IHRoaXM7CiAgICB2YXIgdW5sb2NrZWQgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYXBwIGhhcyBiZWVuIHVubG9ja2VkIGJ5IGEgcGF5bWVudC4KICAgICAqLwogICAgaW5BcHBfc2VsZi5pc1VubG9ja2VkID0gZnVuY3Rpb24oaXRlbSkgewogICAgICBpdGVtID0gaXRlbSB8fCAndW5sb2NrJzsKICAgICAgcmV0dXJuIGluQXBwX3NlbGYudW5sb2NrZWQgfHwgZmFsc2U7CiAgICB9OwoKICAgIC8qKgogICAgICogQmVnaW5zIHRoZSBwcm9jZXNzIG9mIHVubG9ja2luZyBhIGdhbWUuCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzRnVuY3Rpb24gRnVuY3Rpb24gdG8gY2FsbCBvbiB1bmxvY2sgc3VjY2VzcwogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZmFpbEZ1bmN0aW9uIEZ1bmN0aW9uIHRvIGNhbGwgb24gdW5sb2NrIGZhaWx1cmUKICAgICAqLwogICAgaW5BcHBfc2VsZi5pbml0aWF0ZVVubG9ja0Z1bmN0aW9uID0gZnVuY3Rpb24oc3VjY2Vzc0Z1bmN0aW9uLCBmYWlsRnVuY3Rpb24pIHsKICAgICAgdmFyIG92ZXJsYXkgPSBudWxsOwogICAgICB2YXIgaHRtbCA9ICcnOwogICAgICAKICAgICAgLy8gRG8gbm90IGFsbG93IGZ1bmN0aW9ucyB0byBiZSBjYWxsZWQgaWYgbm90IHJlYWR5CiAgICAgIGlmIChzZWxmLnJlYWR5ID09IGZhbHNlKSB7IHNlbGYuc2hvd05vdFJlYWR5V2FybmluZygpOyByZXR1cm47IH0KICAgICAgCiAgICAgIC8vIElmIHdlJ3JlIG5vdCBhbGxvd2VkIHRvIHVubG9jaywgZXhpdCBlYXJseToKICAgICAgaWYgKHNlbGYudW5sb2NrRW5hYmxlZCA9PT0gZmFsc2UpIHJldHVybjsKICAgICAgCiAgICAgIC8vIElmIHdlJ3JlIGFscmVhZHkgdW5sb2NrZWQsIGZpcmUgdGhlIHN1Y2Nlc3MgZnVuY3Rpb24gYW5kIGV4aXQ6CiAgICAgIGlmIChpbkFwcF9zZWxmLmlzVW5sb2NrZWQoKSkgewogICAgICAgIHN1Y2Nlc3NGdW5jdGlvbigpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICAKICAgICAgLy8gU2V0dXAgb3VyIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igb3VyIG92ZXJsYXk6CiAgICAgIHZhciBvbkluQXBwT0tDbGljayA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICBzZWxmLnN0b3BFdmVudFByb3BhZ2F0aW9uKGUpOwogICAgICAgIGluQXBwX3NlbGYudW5sb2NrZWQgPSB0cnVlOwogICAgICAgIHRyeSB7CiAgICAgICAgICBzdWNjZXNzRnVuY3Rpb24oKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2goZSkgeyB9CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsKICAgICAgICBzZWxmLm92ZXJsYXkgPSBudWxsOwogICAgICB9CiAgICAgIHZhciBvbkluQXBwQ2FuY2VsQ2xpY2sgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgc2VsZi5zdG9wRXZlbnRQcm9wYWdhdGlvbihlKTsKICAgICAgICBpbkFwcF9zZWxmLnVubG9ja2VkID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZhaWxGdW5jdGlvbigpOwogICAgICAgIH0KICAgICAgICBjYXRjaChlKSB7IH0KICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOwogICAgICAgIHNlbGYub3ZlcmxheSA9IG51bGw7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIE9ubHkgYWRkIGFuIG92ZXJsYXkgaWYgdGhlcmUgaXNuJ3Qgb25lIGFscmVhZHkKICAgICAgaWYoc2VsZi5vdmVybGF5ID09IG51bGwpCiAgICAgIHsKICAgICAgICAvLyBTaG93IHRoZSB1bmxvY2sgb3ZlcmxheToKICAgICAgICBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgIG92ZXJsYXkuaW5uZXJIVE1MID0gaHRtbFN0eWxlQ29udGFpbmVyLmdldElhcERpdigpOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7CiAgICAgICAgc2VsZi5vdmVybGF5ID0gb3ZlcmxheTsKICAgICAgICAKICAgICAgICAvLyBIb29rIHVwIHRoZSBvbk5hbWVTdWJtaXRGdW5jdGlvbiB0byB0aGUgc3VibWl0IGJ1dHRvbgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfaWFwdW5sb2NrYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLAogICAgICAgICAgb25JbkFwcE9LQ2xpY2ssIGZhbHNlKTsKICAgICAgICAKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX2lhcGNhbmNlbGJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywKICAgICAgICAgIG9uSW5BcHBDYW5jZWxDbGljaywgZmFsc2UpOwogICAgICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfY2xvc2VidXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsCiAgICAgICAgICBvbkluQXBwQ2FuY2VsQ2xpY2ssIGZhbHNlKTsKICAgICAgICAKICAgICAgICAvLyBNYWtlIHN1cmUgd2UncmUgdmVydGljYWxseSBjZW50ZXJlZDoKICAgICAgICBzZWxmLmh0bWxIZWxwZXJzLmNoZWNrVmVydGljYWxDZW50ZXJpbmcoKTsKICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIERpc3BsYXlzIHRoZSAiTW9yZSBHYW1lcyIgcGFnZQogICAqLwogIHNlbGYuc2hvd01vcmVHYW1lcyA9IGZ1bmN0aW9uKCkgewogICAgaWYgKHNlbGYucmVhZHkgPT0gZmFsc2UpIHsgc2VsZi5zaG93Tm90UmVhZHlXYXJuaW5nKCk7IHJldHVybjsgfSAvLyBEbyBub3QgYWxsb3cgZnVuY3Rpb25zIHRvIGJlIGNhbGxlZCBpZiBub3QgcmVhZHkKICAgIHNlbGYuc2hvd0Rpc21pc3NhYmxlSW1hZ2VPdmVybGF5KCdodHRwczovL3JlcG9ydHMuZmdsLmNvbS9zYW5kYm94L2Fkcy9odG1sNS9jcm9zc19wcm9tb19jb3Zlci5wbmcnLCA0MDAsIDM1MCk7CiAgfTsKICAKICAvKioKICAgKiBEaXNwbGF5cyBhIGRpc21pc3NhYmxlIGNlbnRlcmVkIGltYWdlIG92ZXJsYXkgLSBpbnRlcm5hbCB1c2Ugb25seQogICAqIEBwcml2YXRlCiAgICovCiAgc2VsZi5zaG93RGlzbWlzc2FibGVJbWFnZU92ZXJsYXkgPSBmdW5jdGlvbihzcmMsIHdpZHRoLCBoZWlnaHQpIHsKICAgIGlmIChzZWxmLnJlYWR5ID09IGZhbHNlKSB7IHNlbGYuc2hvd05vdFJlYWR5V2FybmluZygpOyByZXR1cm47IH0gLy8gRG8gbm90IGFsbG93IGZ1bmN0aW9ucyB0byBiZSBjYWxsZWQgaWYgbm90IHJlYWR5CiAgICBpZihzZWxmLm92ZXJsYXkgPT0gbnVsbCkKICAgIHsKICAgICAgdmFyIG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgIG92ZXJsYXkuaW5uZXJIVE1MID0gaHRtbFN0eWxlQ29udGFpbmVyLmdldEltYWdlT3ZlcmxheShzcmMsIHdpZHRoLCBoZWlnaHQpOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpOwogICAgICBzZWxmLm92ZXJsYXkgPSBvdmVybGF5OwogICAgICAKICAgICAgdmFyIGNsb3NlT3ZlcmxheSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICBzZWxmLnN0b3BFdmVudFByb3BhZ2F0aW9uKGUpOwogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7CiAgICAgICAgc2VsZi5vdmVybGF5ID0gbnVsbDsKICAgICAgfQogICAgICAKICAgICAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsCiAgICAgICAgY2xvc2VPdmVybGF5KTsKICAgICAgCiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSdyZSB2ZXJ0aWNhbGx5IGNlbnRlcmVkOgogICAgICBzZWxmLmh0bWxIZWxwZXJzLmNoZWNrVmVydGljYWxDZW50ZXJpbmcoKTsKICAgIH0KICB9CiAgCiAgLyoqCiAgICogRGlzcGxheXMgYSBkaXNtaXNzYWJsZSBjZW50ZXJlZCBhbGVydCAtIGludGVybmFsIHVzZSBvbmx5CiAgICogQHByaXZhdGUKICAgKi8KICBzZWxmLnNob3dEaXNtaXNzYWJsZUFsZXJ0ID0gZnVuY3Rpb24odGl0bGUsIG1lc3NhZ2UpIHsKICAgIGlmKHNlbGYub3ZlcmxheSA9PSBudWxsKQogICAgewogICAgICB2YXIgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgdmFyIGFsZXJ0SFRNTCA9IAogICAgICAgICc8cD4nICsgbWVzc2FnZSArICc8L3A+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1hY3Rpb25zIj4nICsKICAgICAgICAgICc8YSBjbGFzcz0iZmdsLXBvcHVwLWJ1dHRvbiI+RGlzbWlzczwvYT4nICsKICAgICAgICAnPC9kaXY+JzsKICAgICAgb3ZlcmxheS5pbm5lckhUTUwgPSBodG1sU3R5bGVDb250YWluZXIuY3JlYXRlUG9wdXAodGl0bGUsIGFsZXJ0SFRNTCk7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheSk7CiAgICAgIHNlbGYub3ZlcmxheSA9IG92ZXJsYXk7CiAgICAgIAogICAgICB2YXIgY2xvc2VPdmVybGF5ID0gZnVuY3Rpb24oZSkgewogICAgICAgIHNlbGYuc3RvcEV2ZW50UHJvcGFnYXRpb24oZSk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsKICAgICAgICBzZWxmLm92ZXJsYXkgPSBudWxsOwogICAgICB9CiAgICAgIAogICAgICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywKICAgICAgICBjbG9zZU92ZXJsYXkpOwogICAgICAKICAgICAgLy8gTWFrZSBzdXJlIHdlJ3JlIHZlcnRpY2FsbHkgY2VudGVyZWQ6CiAgICAgIHNlbGYuaHRtbEhlbHBlcnMuY2hlY2tWZXJ0aWNhbENlbnRlcmluZygpOwogICAgfQogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgVVJJIChvciBkYXRhIFVSSSkgb2YgdGhlIGJyYW5kaW5nIGxvZ28KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBVUkkgb3IgZGF0YSBVUkkgb2YgYnJhbmRpbmcgbG9nbwogICAqLwogIHNlbGYuZ2V0QnJhbmRpbmdMb2dvID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gImh0dHBzOi8vc2l0ZXMubXBzdGF0aWMuY29tL2h0bWw1L3Nka3MvZmdsLWJyYW5kaW5nLXBsYWNlaG9sZGVyLnBuZyI7CiAgfTsKCiAgLyoqCiAgICogQ2FsbCB0aGlzIG1ldGhvZCB3aGVuIHRoZSB1c2VyIGNsaWNrcyBvciB0YXBzIG9uIHRoZSBicmFuZGluZyBsb2dvCiAgICovCiAgc2VsZi5oYW5kbGVCcmFuZGluZ0NsaWNrID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoc2VsZi5yZWFkeSA9PSBmYWxzZSkgeyBzZWxmLnNob3dOb3RSZWFkeVdhcm5pbmcoKTsgcmV0dXJuOyB9IC8vIERvIG5vdCBhbGxvdyBmdW5jdGlvbnMgdG8gYmUgY2FsbGVkIGlmIG5vdCByZWFkeQogICAgc2VsZi5zaG93RGlzbWlzc2FibGVBbGVydCgnUHVibGlzaGVyIEJyYW5kaW5nIENsaWNrZWQnLCAKICAgICAgJ0R5bmFtaWMgcHVibGlzaGVyIGJyYW5kaW5nIGlzIG5vdyBpbXBsZW1lbnRlZCBpbiB5b3VyIGdhbWUhJyArCiAgICAgICc8YnIgLz48YnIgLz4nICsKICAgICAgJ05vdGU6IFRoaXMgbWVzc2FnZSBzaG91bGQgb25seSBiZSBkaXNwbGF5ZWQgd2hlbiB5b3UgY2xpY2sgJyArCiAgICAgICd0aGUgPHN0cm9uZz5QdWJsaXNoZXIgQnJhbmRpbmc8L3N0cm9uZz4gcGxhY2Vob2xkZXIuJyk7CiAgfQogIAogIC8qKgogICAqIEFkZHMgdGhlIGJvb3Qgc2NyZWVuIGFuZCBldmVudCBsaXN0ZW5lcnMKICAgKiBAcHJpdmF0ZQogICAqLwogIHNlbGYuYWRkVGVzdEJvb3RTY3JlZW4gPSBmdW5jdGlvbigpIHsKICAgIHZhciBob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICBob2xkZXIuaW5uZXJIVE1MID0gaHRtbFN0eWxlQ29udGFpbmVyLmdldEludHJvRGl2KCk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGhvbGRlcik7CiAgICAKICAgIHZhciBoYW5kbGVTdGFydEdhbWUgPSBmdW5jdGlvbigpIHsKICAgICAgLyogTWFnaWMgdHJpY2ssIHdlIHB1dCBvdXIgc2V0dGluZ3MgaW50byB0aGUgVVJMIGhhc2ggdGhlbiByZWxvYWQgdGhlIHBhZ2UuCiAgICAgICAqIFRoaXMgY2F1c2VzIHRoZSBnYW1lIHRvIGJvb3QgZnJvbSB0aGUgYmVnaW5uaW5nIGFnYWluLCBidXQgaXQgd2lsbCBhbHJlYWR5CiAgICAgICAqIGtub3cgdGhlIHNldHRpbmdzLgogICAgICAgKi8KICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnI0ZHTFNESz0nICsgSlNPTi5zdHJpbmdpZnkoewogICAgICAgIGNyb3NzUHJvbW90aW9uRW5hYmxlZDogIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfaGlkZU1vcmVHYW1lcycpLmNoZWNrZWQsCiAgICAgICAgdW5sb2NrRW5hYmxlZDogICAgICAgICAhZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF9oaWRlVW5sb2NrcycpLmNoZWNrZWQsCiAgICAgICAgdW5sb2NrZWQ6ICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX3VubG9ja0dhbWUnKS5jaGVja2VkLAogICAgICAgIGJyYW5kaW5nRW5hYmxlZDogICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF9zcG9uc29yZWQnKS5jaGVja2VkCiAgICAgIH0pOwogICAgICAKICAgICAgc2VsZi5zdGFydGVkID0gdHJ1ZTsKICAgICAgCiAgICAgIC8vIFJlbG9hZAogICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICB9OwogICAgCiAgICAvLyBTZXQgdXAgdGhlIHN0YXJ0IGdhbWUgYnV0dG9uCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX3N0YXJ0Z2FtZWJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgCiAgICAgIGhhbmRsZVN0YXJ0R2FtZSwgZmFsc2UpOwogICAgCiAgICAvLyBNYWtlIHN1cmUgd2UncmUgdmVydGljYWxseSBjZW50ZXJlZDoKICAgIHNlbGYuaHRtbEhlbHBlcnMuY2hlY2tWZXJ0aWNhbENlbnRlcmluZygpOwogIH07CiAgCiAgc2VsZi5zaG93Tm90UmVhZHlXYXJuaW5nID0gZnVuY3Rpb24oKSB7CiAgICAvL2NvbnNvbGUubG9nKHNlbGYuc3RhcnRlZCArICcsICcgKyBzZWxmLnJlYWR5KTsKICAgIC8qaWYoc2VsZi5zdGFydGVkID09PSB0cnVlKSB7CiAgICAgIHNlbGYuc2hvd0Rpc21pc3NhYmxlQWxlcnQoJ0ZHTCBTREsgbm90IHJlYWR5IScsICdQbGVhc2Ugd2FpdCBmb3Igb25SZWFkeScgKwogICAgICAgICdiZWZvcmUgdXNpbmcgU0RLIGZ1bmN0aW9uYWxpdHkuJyk7CiAgICB9Ki8KICB9CiAgCiAgLyoqCiAgICogRG8gd2UgaGF2ZSBhbiBldmVudCBsaXN0ZW5lciByZWdpc3RlcmVkIHlldD8KICAgKiBAcHJpdmF0ZQogICAqLwogIHNlbGYuaHRtbEhlbHBlcnMuaGFzUmVzaXplTGlzdGVuZXIgPSBmYWxzZTsKICAKICAvKioKICAgKiBVc2VkIHRvIHZlcnRpY2FsbHkgY2VudGVyIHBvcHVwczoKICAgKiBAcHJpdmF0ZQogICAqLwogIHNlbGYuaHRtbEhlbHBlcnMudmVydGljYWxDZW50ZXIgPSBmdW5jdGlvbihlbGVtZW50KSB7CiAgICBpZiAoIWVsZW1lbnQucGFyZW50Tm9kZSkgcmV0dXJuOwogICAgCiAgICB2YXIgdG9wTWFyZ2luID0gKGVsZW1lbnQucGFyZW50Tm9kZS5vZmZzZXRIZWlnaHQgLyAyKSAtCiAgICAgIChlbGVtZW50Lm9mZnNldEhlaWdodCAvIDIpOwogICAgCiAgICBpZiAodG9wTWFyZ2luIDwgMCkgdG9wTWFyZ2luID0gMDsKICAgIGVsZW1lbnQuc3R5bGUubWFyZ2luVG9wID0gdG9wTWFyZ2luICsgJ3B4JzsKICB9CiAgCiAgLyoqCiAgICogQ2hlY2tzIHRoZSB2ZXJ0aWNhbCBjZW50ZXJpbmcgb2YgYWxsIGVsZW1lbnRzIHdoaWNoIHNob3VsZCBiZSB2LWNlbnRlcmVkCiAgICogQHByaXZhdGUKICAgKi8KICBzZWxmLmh0bWxIZWxwZXJzLmNoZWNrVmVydGljYWxDZW50ZXJpbmcgPSBmdW5jdGlvbigpIHsKICAgIHZhciBlbGVtZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2ZnbC12Y2VudGVyJyk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHNlbGYuaHRtbEhlbHBlcnMudmVydGljYWxDZW50ZXIoZWxlbWVudHNbaV0pOwogICAgfQogICAgCiAgICAvLyBFbnN1cmUgd2UgaGF2ZSBhbiBldmVudCBsaXN0ZW5lcjoKICAgIGlmICghc2VsZi5odG1sSGVscGVycy5oYXNSZXNpemVMaXN0ZW5lcikgewogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgCiAgICAgICAgc2VsZi5odG1sSGVscGVycy5jaGVja1ZlcnRpY2FsQ2VudGVyaW5nKTsKICAgICAgICAKICAgICAgc2VsZi5odG1sSGVscGVycy5oYXNSZXNpemVMaXN0ZW5lciA9IHRydWU7CiAgICB9CiAgfQogIAogIHNlbGYuc3RvcEV2ZW50UHJvcGFnYXRpb24gPSBmdW5jdGlvbihlKSB7CiAgICB2YXIgZXYgPSBlIHx8IHdpbmRvdy5ldmVudDsKICAgIGlmKGV2ID09IG51bGwpIHsgcmV0dXJuOyB9CiAgICBpZihldi5zdG9wUHJvcGFnYXRpb24gIT0gbnVsbCkgewogICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0KICAgIGlmKGV2LmNhbmNlbEJ1YmJsZSAhPSBudWxsKSB7CiAgICAgIGV2LmNhbmNlbEJ1YmJsZSA9IHRydWU7CiAgICB9CiAgfQogIAogIC8qKgogICAqIEdldCB0aGUgQ1NTIGZvciB0aGUgb3ZlcmxheXMKICAgKiBAcHJpdmF0ZQogICAqLwogIGh0bWxTdHlsZUNvbnRhaW5lci5nZXRDc3MgPSBmdW5jdGlvbigpIHsKICAgIHZhciBodG1sID0gJy5mZ2wtcG9wdXAgeycgKwogICAgICAncG9zaXRpb246IHJlbGF0aXZlOycgKwoKICAgICAgJ21heC13aWR0aDogNDUwcHg7JyArCiAgICAgICdtYXJnaW46IGF1dG87JyArCiAgICAgICdib3JkZXItcmFkaXVzOiA0cHg7JyArCiAgICAgICdib3JkZXI6IDFweCBzb2xpZCAjRkZGOycgKwogICAgICAnY29sb3I6ICMwMDA7JyArCgogICAgICAnYmFja2dyb3VuZC1jb2xvcjogI0ZGRjsnICsKICAgICd9JyArCiAgICAKICAgICcuZmdsLXBvcHVwIGZpZWxkc2V0IHsnICsKICAgICAgJ3BhZGRpbmc6IDVweDsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtc2NvcmUgeycgKwogICAgICAnd2lkdGg6IDM1MHB4OycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1oZWFkIHsnICsKICAgICAgJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsnICsKICAgICAgJ2JvcmRlci1yYWRpdXM6IDNweCAzcHggMCAwOycgKwoKICAgICAgJ3RvcDogMDsnICsKICAgICAgJ2xlZnQ6IDA7JyArCiAgICAgICdyaWdodDogMDsnICsKICAgICAgJ2hlaWdodDogNDRweDsnICsKICAgICAgJ2xpbmUtaGVpZ2h0OiA0NHB4OycgKwogICAgICAncGFkZGluZy1sZWZ0OiAxMnB4OycgKwoKICAgICAgJ2NvbG9yOiAjRkZGOycgKwogICAgICAnZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOycgKwogICAgICAnZm9udC1zaXplOiAxOHB4OycgKwoKICAgICAgJ2JhY2tncm91bmQ6ICM0OTQ5NDk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtbW96LWxpbmVhci1ncmFkaWVudCh0b3AsICAjNDk0OTQ5IDAlLCAjMzczNzM3IDEwMCUpOycgKwogICAgICAnYmFja2dyb3VuZDogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIGxlZnQgdG9wLCBsZWZ0IGJvdHRvbSwgY29sb3Itc3RvcCgwJSwjNDk0OTQ5KSwgY29sb3Itc3RvcCgxMDAlLCMzNzM3MzcpKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KHRvcCwgICM0OTQ5NDkgMCUsIzM3MzczNyAxMDAlKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IC1vLWxpbmVhci1ncmFkaWVudCh0b3AsICAjNDk0OTQ5IDAlLCMzNzM3MzcgMTAwJSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgICM0OTQ5NDkgMCUsIzM3MzczNyAxMDAlKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICAjNDk0OTQ5IDAlLCMzNzM3MzcgMTAwJSk7JyArCiAgICAgICdmaWx0ZXI6IHByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudCggc3RhcnRDb2xvcnN0cj0iIzQ5NDk0OSIsIGVuZENvbG9yc3RyPSIjMzczNzM3IixHcmFkaWVudFR5cGU9MCApOycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1oZWFkc3BhY2VyIHsnICsKICAgICAgJ21hcmdpbi10b3A6IDU0cHg7JyArCiAgICAnfScgKwoKICAgICcuZmdsLXBvcHVwLXN1YnRpdGxlIHsnICsKICAgICAgJ2ZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsnICsKICAgICAgJ2ZvbnQtc2l6ZTogMTVweDsnICsKICAgICAgJ3RleHQtYWxpZ246IGNlbnRlcjsnICsKICAgICAgJ2NvbG9yOiAjNjY2OycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cCBwIHsnICsKICAgICAgJ2ZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsnICsKICAgICAgJ2ZvbnQtc2l6ZTogMTVweDsnICsKICAgICAgJ21hcmdpbjogMThweDsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtc2NvcmVib3ggeycgKwogICAgICAnZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOycgKwogICAgICAnZm9udC1zaXplOiA0NXB4OycgKwogICAgICAndGV4dC1hbGlnbjogY2VudGVyOycgKwogICAgICAnY29sb3I6ICNBQjQxNDA7JyArCiAgICAgICdmb250LXdlaWdodDogYm9sZDsnICsKICAgICAgJ2JvcmRlcjogMXB4IHNvbGlkICNERkRGREY7JyArCiAgICAgICdtYXJnaW46IDEwcHggMjVweDsnICsKICAgICAgJ292ZXJmbG93OiBhdXRvOycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1wcm9tcHRsYWJlbCB7JyArCiAgICAgICdwYWRkaW5nOiAxNXB4OycgKwogICAgICAnZm9udC1zaXplOiAxNHB4OycgKwogICAgICAnbWFyZ2luLWxlZnQ6IDEwcHg7JyArCiAgICAgICdmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7JyArCiAgICAnfScgKwoKICAgICcuZmdsLXBvcHVwLWZvb3RlciB7JyArCiAgICAgICdwYWRkaW5nOiAxMHB4OycgKwogICAgICAnbWFyZ2luOiAwIDE1cHggMTVweCAxNXB4OycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1iaWdmb290ZXIgeycgKwogICAgICAncGFkZGluZzogMjBweDsnICsKICAgICAgJ21hcmdpbjogMCAxNXB4IDE1cHggMTVweDsnICsKICAgICAgJ3RleHQtYWxpZ246IGNlbnRlcjsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtcHJvbXB0IHsnICsKICAgICAgJ2ZvbnQtc2l6ZTogMTZweDsnICsKICAgICAgJ2hlaWdodDogMzRweDsnICsKICAgICAgJ2xpbmUtaGVpZ2h0OiAzM3B4OycgKwogICAgICAnd2lkdGg6IDIwMHB4OycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1idXR0b24geycgKwogICAgICAncGFkZGluZzogOHB4IDEycHg7JyArCiAgICAgICdtYXJnaW4tbGVmdDogMTBweDsnICsKCiAgICAgICdiYWNrZ3JvdW5kOiAjYWI0MTQwOycgKwogICAgICAnYmFja2dyb3VuZDogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAgI2FiNDE0MCAwJSwgIzk3M2EzOSAxMDAlKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IC13ZWJraXQtZ3JhZGllbnQobGluZWFyLCBsZWZ0IHRvcCwgbGVmdCBib3R0b20sIGNvbG9yLXN0b3AoMCUsI2FiNDE0MCksIGNvbG9yLXN0b3AoMTAwJSwjOTczYTM5KSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCh0b3AsICAjYWI0MTQwIDAlLCM5NzNhMzkgMTAwJSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtby1saW5lYXItZ3JhZGllbnQodG9wLCAgI2FiNDE0MCAwJSwjOTczYTM5IDEwMCUpOycgKwogICAgICAnYmFja2dyb3VuZDogLW1zLWxpbmVhci1ncmFkaWVudCh0b3AsICAjYWI0MTQwIDAlLCM5NzNhMzkgMTAwJSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAgI2FiNDE0MCAwJSwjOTczYTM5IDEwMCUpOycgKwogICAgICAnZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoIHN0YXJ0Q29sb3JzdHI9IiNhYjQxNDAiLCBlbmRDb2xvcnN0cj0iIzk3M2EzOSIsR3JhZGllbnRUeXBlPTAgKTsnICsKCiAgICAgICdjb2xvcjogI0ZGRjsnICsKICAgICAgJ3RleHQtZGVjb3JhdGlvbjogbm9uZTsnICsKICAgICAgJ2ZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsnICsKICAgICAgJ2ZvbnQtd2VpZ2h0OiBib2xkOycgKwogICAgICAnYm9yZGVyLXJhZGl1czogNnB4OycgKwogICAgICAnZm9udC1zaXplOiAxNXB4OycgKwogICAgICAnY3Vyc29yOiBwb2ludGVyOycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1iaWdidXR0b24geycgKwogICAgICAncGFkZGluZzogMTZweCAyNHB4OycgKwogICAgICAnbWFyZ2luOiBhdXRvOycgKwoKICAgICAgJ2JhY2tncm91bmQ6ICNhYjQxNDA7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtbW96LWxpbmVhci1ncmFkaWVudCh0b3AsICAjYWI0MTQwIDAlLCAjOTczYTM5IDEwMCUpOycgKwogICAgICAnYmFja2dyb3VuZDogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIGxlZnQgdG9wLCBsZWZ0IGJvdHRvbSwgY29sb3Itc3RvcCgwJSwjYWI0MTQwKSwgY29sb3Itc3RvcCgxMDAlLCM5NzNhMzkpKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KHRvcCwgICNhYjQxNDAgMCUsIzk3M2EzOSAxMDAlKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IC1vLWxpbmVhci1ncmFkaWVudCh0b3AsICAjYWI0MTQwIDAlLCM5NzNhMzkgMTAwJSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgICNhYjQxNDAgMCUsIzk3M2EzOSAxMDAlKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICAjYWI0MTQwIDAlLCM5NzNhMzkgMTAwJSk7JyArCiAgICAgICdmaWx0ZXI6IHByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudCggc3RhcnRDb2xvcnN0cj0iI2FiNDE0MCIsIGVuZENvbG9yc3RyPSIjOTczYTM5IixHcmFkaWVudFR5cGU9MCApOycgKwoKICAgICAgJ2NvbG9yOiAjRkZGOycgKwogICAgICAndGV4dC1kZWNvcmF0aW9uOiBub25lOycgKwogICAgICAnZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOycgKwogICAgICAnYm9yZGVyLXJhZGl1czogNHB4OycgKwogICAgICAnZm9udC1zaXplOiAyMXB4OycgKwogICAgICAnY3Vyc29yOiBwb2ludGVyOycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1hY3Rpb25zIHsnICsKICAgICAgJ3RleHQtYWxpZ246IHJpZ2h0OyAnICsKICAgICAgJ3BhZGRpbmc6IDAgMTZweCAxNnB4IDE2cHg7JyArCiAgICAgICdtYXJnaW4tcmlnaHQ6IC02cHg7JyArCiAgICAnfScgKwoKICAgICcuZmdsLXBvcHVwIGZpZWxkc2V0IHsnICsKICAgICAgJ21hcmdpbjogMTZweDsnICsKICAgICAgJ2ZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAgZmllbGRzZXQgbGFiZWwgeycgKwogICAgICAnZGlzcGxheTogYmxvY2s7JyArCiAgICAnfScgKwoKICAgICcuZmdsLXBvcHVwLWNsb3NlIHsnICsKICAgICAgJ2Zsb2F0OiByaWdodDsnICsKICAgICAgJ2NvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LDAuNSk7JyArCiAgICAgICd0ZXh0LWRlY29yYXRpb246IG5vbmU7JyArCiAgICAgICdmb250LXNpemU6IDMwcHg7JyArCiAgICAgICdwYWRkaW5nLXJpZ2h0OiAxMHB4OycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1jbG9zZS1odWdlIHsnICsKICAgICAgJ3Bvc2l0aW9uOiBmaXhlZDsnICsKICAgICAgJ3RvcDogMTBweDsnICsKICAgICAgJ3JpZ2h0OiAxMHB4OycgKwogICAgICAnY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC41KTsnICsKICAgICAgJ3RleHQtZGVjb3JhdGlvbjogbm9uZTsnICsKICAgICAgJ2ZvbnQtc2l6ZTogNzBweDsnICsKICAgICAgJ3BhZGRpbmctcmlnaHQ6IDIwcHg7JyArCiAgICAnfScgKwoKICAgICcuZmdsLXBvcHVwLWNsb3NlOmhvdmVyIHsnICsKICAgICAgJ2NvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LDEpOycgKwogICAgJ30nICsKICAgIAogICAgJy5mZ2wtc2NvcmVib2FyZCB7JyArCiAgICAgICdib3JkZXItc3BhY2luZzogMDsnICsKICAgICAgJ2JvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7JyArCiAgICAgICdmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7JyArCiAgICAgICd3aWR0aDogMTAwJTsnICsKICAgICAgJ3RleHQtYWxpZ246IGxlZnQ7JyArCiAgICAnfScgKwogICAgCiAgICAnLmZnbC1zY29yZWJvYXJkIHRoLCAuZmdsLXNjb3JlYm9hcmQgdGQgeycgKwogICAgICAndGV4dC1hbGlnbjogbGVmdDsnICsKICAgICAgJ3BhZGRpbmc6IDJweCAxM3B4OycgKwogICAgJ30nICsKICAgIAogICAgJy5mZ2wtc2NvcmVib2FyZCB0ciB7JyArCiAgICAgICdib3JkZXItYm90dG9tOiAxcHggc29saWQgI0VFRTsnICsKICAgICd9JyArCiAgICAKICAgICcuZmdsLXNjb3JlLWhpZ2hsaWdodCB0ZCB7JyArCiAgICAgICdiYWNrZ3JvdW5kLWNvbG9yOiAjRkZFRTc3OycgKwogICAgJ30nICsKICAgIAogICAgJy5mZ2wtaW1hZ2Utb3ZlcmxheSB7JyArCiAgICAgICdtYXJnaW46IGF1dG87JyArCiAgICAgICdjdXJzb3I6IHBvaW50ZXI7JyArCiAgICAnfSc7CiAgICByZXR1cm4gaHRtbDsKICB9CiAgCiAgaHRtbFN0eWxlQ29udGFpbmVyLmdldEludHJvRGl2ID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaHRtbCA9ICc8ZGl2IHN0eWxlPSJwb3NpdGlvbjogZml4ZWQ7IHRvcDogMDsgbGVmdDogMDsgcmlnaHQ6IDA7IGJvdHRvbTogMDsgYmFja2dyb3VuZC1jb2xvcjogIzAwMDsgei1pbmRleDogMTAwMDA7IiBpZD0iZmdsX292ZXJsYXkiIG9ubW91c2Vkb3duPSJ2YXIgZSA9IGFyZ3VtZW50c1swXSB8fCB3aW5kb3cuZXZlbnQ7IGUuc3RvcFByb3BhZ2F0aW9uKCk7Ij4nICsKICAgICAgJzxkaXYgaWQ9InBvcHVwIiBjbGFzcz0iZmdsLXBvcHVwIGZnbC12Y2VudGVyIj4nICsKICAgICAgICAnPGRpdiBjbGFzcz0iZmdsLXBvcHVwLWhlYWQiPkZHTCBTREsgPHNtYWxsPkdhbWUgVGVzdGluZyBGcmFtZXdvcms8L3NtYWxsPjwvZGl2PicgKwogICAgICAgICc8ZGl2IGNsYXNzPSJmZ2wtcG9wdXAtaGVhZHNwYWNlciI+PC9kaXY+JyArCiAgICAgICAgJzxwPlRoZSBHYW1lIFRlc3RpbmcgRnJhbWV3b3JrIGFsbG93cyB5b3UgdG8gdGVzdCB0aGUgdmFyaW91cyBGR0wgU0RLIGZlYXR1cmVzLjwvcD4nICsKICAgICAgICAnPGZpZWxkc2V0PicgKwogICAgICAgICc8bGVnZW5kPlRlc3QgU2Vzc2lvbiBPcHRpb25zOjwvbGVnZW5kPicgKwogICAgICAgICc8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iZmdsX2hpZGVNb3JlR2FtZXMiPiBEaXNhYmxlIGNyb3NzIHByb21vdGlvbjwvbGFiZWw+JyArCiAgICAgICAgJzxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJmZ2xfaGlkZVVubG9ja3MiPiBEaXNhYmxlIGluIGFwcCB1cGdyYWRlPC9sYWJlbD4nICsKICAgICAgICAnPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImZnbF91bmxvY2tHYW1lIj4gR2FtZSBpcyBwcmVtaXVtIG1vZGU8L2xhYmVsPicgKwogICAgICAgICc8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iZmdsX3Nwb25zb3JlZCI+IFNob3cgc3BvbnNvciBicmFuZGluZzwvbGFiZWw+JyArCiAgICAgICAgJzwvZmllbGRzZXQ+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1iaWdmb290ZXIiPicgKwogICAgICAgICAgJzxhIGNsYXNzPSJmZ2wtcG9wdXAtYmlnYnV0dG9uIiBpZD0iZmdsX3N0YXJ0Z2FtZWJ1dHRvbiI+TGF1bmNoIEdhbWU8L2E+JyArCiAgICAgICAgJzwvZGl2PicgKwogICAgICAnPC9kaXY+JyArCiAgICAgICc8L2Rpdj4nOwogICAgcmV0dXJuIGh0bWw7CiAgfQogIAogIGh0bWxTdHlsZUNvbnRhaW5lci5jcmVhdGVQb3B1cCA9IGZ1bmN0aW9uKHRpdGxlLCBodG1sKSB7CiAgICB2YXIgaHRtbCA9ICc8ZGl2IHN0eWxlPSJwb3NpdGlvbjogZml4ZWQ7IHRvcDogMDsgbGVmdDogMDsgcmlnaHQ6IDA7IGJvdHRvbTogMDsgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLDAsMCwwLjgpOyB6LWluZGV4OiAxMDAwMDsiIGlkPSJmZ2xfb3ZlcmxheSIgb25tb3VzZWRvd249InZhciBlID0gYXJndW1lbnRzWzBdIHx8IHdpbmRvdy5ldmVudDsgZS5zdG9wUHJvcGFnYXRpb24oKTsiPicgKwogICAgICAnPGRpdiBpZD0icG9wdXAiIGNsYXNzPSJmZ2wtcG9wdXAgZmdsLXZjZW50ZXIiPicgKwogICAgICAgICc8ZGl2IGNsYXNzPSJmZ2wtcG9wdXAtaGVhZCI+JyArCiAgICAgICAgdGl0bGUgKwogICAgICAgICc8YSBocmVmPSIjIiBjbGFzcz0iZmdsLXBvcHVwLWNsb3NlIiBpZD0iZmdsX2Nsb3NlYnV0dG9uIj4mdGltZXM7PC9hPjwvZGl2PicgKwogICAgICAgICc8ZGl2IGNsYXNzPSJmZ2wtcG9wdXAtaGVhZHNwYWNlciI+PC9kaXY+JyArCiAgICAgICAgaHRtbCArCiAgICAgICc8L2Rpdj4nICsKICAgICAgJzwvZGl2Pic7CiAgICByZXR1cm4gaHRtbDsKICB9CiAgCiAgaHRtbFN0eWxlQ29udGFpbmVyLmdldElhcERpdiA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGh0bWwgPSAnPGRpdiBzdHlsZT0icG9zaXRpb246IGZpeGVkOyB0b3A6IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyBib3R0b206IDA7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwwLDAsMC44KTsgei1pbmRleDogMTAwMDA7IiBpZD0iZmdsX292ZXJsYXkiIG9ubW91c2Vkb3duPSJ2YXIgZSA9IGFyZ3VtZW50c1swXSB8fCB3aW5kb3cuZXZlbnQ7IGUuc3RvcFByb3BhZ2F0aW9uKCk7Ij4nICsKICAgICAgJzxkaXYgaWQ9InBvcHVwIiBjbGFzcz0iZmdsLXBvcHVwIGZnbC12Y2VudGVyIj4nICsKICAgICAgICAnPGRpdiBjbGFzcz0iZmdsLXBvcHVwLWhlYWQiPkV4YW1wbGUgSW4tQXBwIFB1cmNoYXNlPGEgaHJlZj0iIyIgY2xhc3M9ImZnbC1wb3B1cC1jbG9zZSIgaWQ9ImZnbF9jbG9zZWJ1dHRvbiI+JnRpbWVzOzwvYT48L2Rpdj4nICsKICAgICAgICAnPGRpdiBjbGFzcz0iZmdsLXBvcHVwLWhlYWRzcGFjZXIiPjwvZGl2PicgKwogICAgICAgICc8cD5QcmVzcyBcJ1VubG9ja1wnIHRvIHNpbXVsYXRlIGEgc3VjY2Vzc2Z1bCBpbi1hcHAgcHVyY2hhc2UsIFwnQ2FuY2VsXCcgb3RoZXJ3aXNlLjwvcD4nICsKICAgICAgICAnPGRpdiBjbGFzcz0iZmdsLXBvcHVwLWFjdGlvbnMiPicgKwogICAgICAgICAgJzxhIGNsYXNzPSJmZ2wtcG9wdXAtYnV0dG9uIiBpZD0iZmdsX2lhcHVubG9ja2J1dHRvbiI+VW5sb2NrPC9hPicgKwogICAgICAgICAgJzxhIGNsYXNzPSJmZ2wtcG9wdXAtYnV0dG9uIiBpZD0iZmdsX2lhcGNhbmNlbGJ1dHRvbiI+Q2FuY2VsPC9hPicgKwogICAgICAgICc8L2Rpdj4nICsKICAgICAgJzwvZGl2PicgKwogICAgICAnPC9kaXY+JzsKICAgIHJldHVybiBodG1sOwogIH0KICAKICBodG1sU3R5bGVDb250YWluZXIuZ2V0U2NvcmVEaXYgPSBmdW5jdGlvbihzY29yZSkgewogICAgdmFyIGh0bWwgPSAnPGRpdiBzdHlsZT0icG9zaXRpb246IGZpeGVkOyB0b3A6IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyBib3R0b206IDA7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwwLDAsMC44KTsgei1pbmRleDogMTAwMDA7IiBpZD0iZmdsX292ZXJsYXkiIG9ubW91c2Vkb3duPSJ2YXIgZSA9IGFyZ3VtZW50c1swXSB8fCB3aW5kb3cuZXZlbnQ7IGUuc3RvcFByb3BhZ2F0aW9uKCk7Ij4nICsKICAgICAgJzxkaXYgaWQ9InBvcHVwIiBjbGFzcz0iZmdsLXBvcHVwIGZnbC1wb3B1cC1zY29yZSBmZ2wtdmNlbnRlciI+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1oZWFkIj5TdWJtaXQgWW91ciBTY29yZTxhIGhyZWY9IiMiIGNsYXNzPSJmZ2wtcG9wdXAtY2xvc2UiIGlkPSJmZ2xfY2xvc2VidXR0b24iPiZ0aW1lczs8L2E+PC9kaXY+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1oZWFkc3BhY2VyIj48L2Rpdj4nICsKICAgICAgICAnPGRpdiBjbGFzcz0iZmdsLXBvcHVwLXN1YnRpdGxlIj5Zb3VyIFNjb3JlPC9kaXY+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1zY29yZWJveCI+JyArIHNjb3JlICsgJzwvZGl2PicgKwogICAgICAgICc8bGFiZWwgY2xhc3M9ImZnbC1wb3B1cC1wcm9tcHRsYWJlbCI+RW50ZXIgeW91ciBuYW1lOjwvbGFiZWw+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1mb290ZXIiPicgKwogICAgICAgICAgJzxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZmdsLXBvcHVwLXByb21wdCIgaWQ9ImZnbF9zY29yZW5hbWVpbnB1dCIgbWF4bGVuZ3RoPSIzMCI+JyArCiAgICAgICAgICAnPGEgY2xhc3M9ImZnbC1wb3B1cC1idXR0b24iIGlkPSJmZ2xfc2NvcmVzdWJtaXRidXR0b24iPlN1Ym1pdCAmI3gyNUI4OzwvYT4nICsKICAgICAgICAnPC9kaXY+JyArCiAgICAgICc8L2Rpdj4nICsKICAgICAgJzwvZGl2Pic7CiAgICByZXR1cm4gaHRtbDsKICB9CiAgCiAgaHRtbFN0eWxlQ29udGFpbmVyLmdldEltYWdlT3ZlcmxheSA9IGZ1bmN0aW9uKHNyYywgd2lkdGgsIGhlaWdodCkgewogICAgdmFyIGltZ1RhZ0F0dHJpYnV0ZXMgPSAnJzsKICAgIGlmICh3aWR0aCkgaW1nVGFnQXR0cmlidXRlcyArPSAnIHdpZHRoPSInICsgd2lkdGggKyAnIic7CiAgICBpZiAoaGVpZ2h0KSBpbWdUYWdBdHRyaWJ1dGVzICs9ICcgaGVpZ2h0PSInICsgaGVpZ2h0ICsgJyInOwogICAgdmFyIGh0bWwgPSAnPGRpdiBzdHlsZT0icG9zaXRpb246IGZpeGVkOyB0b3A6IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyBib3R0b206IDA7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwwLDAsMC44KTsgei1pbmRleDogMTAwMDA7IiBpZD0iZmdsX292ZXJsYXkiIG9ubW91c2Vkb3duPSJ2YXIgZSA9IGFyZ3VtZW50c1swXSB8fCB3aW5kb3cuZXZlbnQ7IGUuc3RvcFByb3BhZ2F0aW9uKCk7Ij4nICsKICAgICAgJzxhIGhyZWY9IiMiIGNsYXNzPSJmZ2wtcG9wdXAtY2xvc2UtaHVnZSIgaWQ9ImZnbF9jbG9zZWJ1dHRvbiI+JnRpbWVzOzwvYT4nICsKICAgICAgJzxkaXYgaWQ9ImltYWdlIiBjbGFzcz0iZmdsLXZjZW50ZXIiIHN0eWxlPSJ0ZXh0LWFsaWduOiBjZW50ZXI7Ij4nICsKICAgICAgICAnPGltZyBzcmM9IicgKyBzcmMgKyAnIiBjbGFzcz0iZmdsLWltYWdlLW92ZXJsYXkiIG9ubG9hZD0iZmdsLmh0bWxIZWxwZXJzLmNoZWNrVmVydGljYWxDZW50ZXJpbmcoKTsiJyArIGltZ1RhZ0F0dHJpYnV0ZXMgKyAnIC8+JyArCiAgICAgICc8L2Rpdj4nICsKICAgICAgJzwvZGl2Pic7CiAgICByZXR1cm4gaHRtbDsKICB9Cn07",
                "body": "LyoqCiAqIEZHTCBTREsgLSBJbXBsZW1lbnQgdGhpcyBpbnRvIHlvdXIgZ2FtZSEKICoKICogVmVyc2lvbiAxLjQuMgogKgogKiBOT1RFOiBUaGlzIGlzIGFuIGltcGxlbWVudGF0aW9uIHRlc3RpbmcgdmVyc2lvbiBvZiBvdXIgU0RLLiBXaGVuIHlvdQogKiB1cGxvYWQgeW91ciBnYW1lIHRvIEZHTC5jb20sIHRoaXMgU0RLIHdpbGwgYmUgcmVwbGFjZWQgd2l0aCBvdXIgcmVhbAogKiBwcm9kdWN0aW9uIFNES3MgKHdoaWNoIGNvbnRhaW4gcGxhdGZvcm0tc3BlY2lmaWMgZnVuY3Rpb25hbGl0eSkuIFlvdQogKiBtdXN0IG5vdCBzZWxmLXB1Ymxpc2ggeW91ciBhcHAgd2l0aCB0aGlzIHZlcnNpb24gb2YgdGhlIFNESyBpbXBsZW1lbnRlZCwKICogYW5kIHlvdSBtdXN0IG5vdCBlbmNyeXB0IG9yIG1pbmlmeSB0aGlzIGxpYnJhcnkgb3Igb3VyIGRlcGxveW1lbnQgcHJvY2VzcwogKiB3aWxsIGZhaWwuCiAqCiAqIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSB0aGUgSW1wbGVtZW50YXRpb24gR3VpZGUgb3IgQVBJIGRvY3VtZW50YXRpb24KICovCiAKaWYoKCdmZ2wnIGluIHdpbmRvdykgPT0gZmFsc2UpIHsKICB3aW5kb3cuZmdsID0gd2luZG93LkZHTCA9IG5ldyBGR0xJbXBsZW1lbnRhdGlvblRlc3RpbmdTREsoKTsKICBpZihmZ2wuY3JlYXRlZCA9PSBmYWxzZSkgewogICAgZmdsLmNyZWF0ZSgpOwogIH0KfQoKLyoqCiAqIEZHTCBTREsgQ2xhc3MKICogQGNvbnN0cnVjdG9yCiAqLwpmdW5jdGlvbiBGR0xJbXBsZW1lbnRhdGlvblRlc3RpbmdTREsoKSB7CiAgInVzZSBzdHJpY3QiOwogIAogIHZhciBzZWxmID0gdGhpczsKICB2YXIgaHRtbFN0eWxlQ29udGFpbmVyID0geyB9OyAgIC8vZmFuY3kgaHRtbCBzdHlsZSBkZWZpbml0aW9ucwogIHZhciBzY29yZU92ZXJsYXkgPSBudWxsOwogIAogIHNlbGYuU0laRV8zMDB4MjUwID0gMTsKICBzZWxmLlNJWkVfT1ZFUkxBWSA9IDI7CgogIHNlbGYub3ZlcmxheSA9IG51bGw7CiAgc2VsZi5zdGFydGVkID0gZmFsc2U7CiAgc2VsZi5jcmVhdGVkID0gZmFsc2U7CiAgc2VsZi5yZWFkeSA9IGZhbHNlOwogIHNlbGYucmVhZHlGdW5jdGlvbnMgPSBbIF07CgogIHNlbGYuY3Jvc3NQcm9tb3Rpb25FbmFibGVkID0gdHJ1ZTsKICBzZWxmLnVubG9ja0VuYWJsZWQgPSB0cnVlOwogIHNlbGYuYnJhbmRpbmdFbmFibGVkID0gdHJ1ZTsKICAKICBzZWxmLmdhbWVJZCAgPSAndGVzdCc7CiAgCiAgc2VsZi5odG1sSGVscGVycyA9IHsgfTsKICAKICBzZWxmLmdldE1ldGEgPSBmdW5jdGlvbihtZXRhKSB7CiAgICB2YXIgbWV0YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbWV0YScpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWV0YXMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKG1ldGFzW2ldLmdldEF0dHJpYnV0ZSgnbmFtZScpID09IG1ldGEpIHsKICAgICAgICByZXR1cm4gbWV0YXNbaV0uZ2V0QXR0cmlidXRlKCdjb250ZW50Jyk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAnJzsKICB9OwoKICBzZWxmLmxvYWRTY29yZXMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBzY29yZXNTdHIgPSBsb2NhbFN0b3JhZ2VbJ2xiLicgKyBzZWxmLmdhbWVJZF07CiAgICBpZiAoc2NvcmVzU3RyID09IG51bGwgfHwgc2NvcmVzU3RyID09ICcnKSB7CiAgICAgIHJldHVybiBbIF07CiAgICB9CiAgICByZXR1cm4gSlNPTi5wYXJzZShzY29yZXNTdHIpOwogIH07CgogIHNlbGYuc2F2ZVNjb3JlcyA9IGZ1bmN0aW9uKHNjb3JlcykgewogICAgd2hpbGUgKHNjb3Jlcy5sZW5ndGggPiAyMCkgewogICAgICBzY29yZXMucG9wKCk7CiAgICB9CiAgICBsb2NhbFN0b3JhZ2VbJ2xiLicgKyBzZWxmLmdhbWVJZF0gPSBKU09OLnN0cmluZ2lmeShzY29yZXMpOwogIH07CgogIC8qKgogICAqIEluaXRpYWxpc2VzIHRoZSBBUEkuCiAgICovCiAgc2VsZi5jcmVhdGUgPSBmdW5jdGlvbigpIHsKICAgIGlmKHNlbGYuY3JlYXRlZCA9PSB0cnVlKSB7IHJldHVybjsgfQogICAgCiAgICBpZighZG9jdW1lbnQuYm9keSl7CiAgICAgIHNldFRpbWVvdXQoc2VsZi5jcmVhdGUsIDEwKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgCiAgICB2YXIgZ2FtZUlkID0gc2VsZi5nZXRNZXRhKCdmZ2wtZ2FtZWlkJyk7CiAgICBpZiAoIWdhbWVJZCkgewogICAgICBnYW1lSWQgPSAndGVzdCc7CiAgICB9CiAgICAKICAgIHNlbGYuZ2FtZUlkID0gZ2FtZUlkOwogICAgCiAgICAvLyBTZXQgdXAgQ1NTIGZvciBGR0wgb3ZlcmxheXMKICAgIHZhciBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICBpZiAoc3R5bGUuc3R5bGVTaGVldCkgewogICAgICBzdHlsZS5zdHlsZVNoZWV0LmNzc1RleHQgPSBodG1sU3R5bGVDb250YWluZXIuZ2V0Q3NzKCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaHRtbFN0eWxlQ29udGFpbmVyLmdldENzcygpKSk7CiAgICB9CiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsKICAgIAogICAgLy8gSXMgb3VyIFNESyBpbiAncnVuIG1vZGUnPwogICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cigwLDgpID09ICcjRkdMU0RLPScpIHsKICAgICAgLy8gUnVuIQogICAgICB2YXIgc2RrU2V0dGluZ3MgPSBKU09OLnBhcnNlKHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cig4KSk7CiAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJyc7CiAgICAgIAogICAgICBpZiAoJ2Nyb3NzUHJvbW90aW9uRW5hYmxlZCcgaW4gc2RrU2V0dGluZ3MpCiAgICAgICAgc2VsZi5jcm9zc1Byb21vdGlvbkVuYWJsZWQgPSBzZGtTZXR0aW5ncy5jcm9zc1Byb21vdGlvbkVuYWJsZWQ7CiAgICAgICAgCiAgICAgIGlmICgndW5sb2NrRW5hYmxlZCcgaW4gc2RrU2V0dGluZ3MpCiAgICAgICAgc2VsZi51bmxvY2tFbmFibGVkID0gc2RrU2V0dGluZ3MudW5sb2NrRW5hYmxlZDsKICAgICAgICAKICAgICAgaWYgKCd1bmxvY2tlZCcgaW4gc2RrU2V0dGluZ3MpCiAgICAgICAgc2VsZi5pbkFwcC51bmxvY2tlZCA9IHNka1NldHRpbmdzLnVubG9ja2VkOwogICAgICAgIAogICAgICBpZiAoJ2JyYW5kaW5nRW5hYmxlZCcgaW4gc2RrU2V0dGluZ3MpCiAgICAgICAgc2VsZi5icmFuZGluZ0VuYWJsZWQgPSBzZGtTZXR0aW5ncy5icmFuZGluZ0VuYWJsZWQ7CiAgICAgIAogICAgICBzZWxmLmJvb3QoKTsKICAgIH0KICAgIGVsc2UgewogICAgICAKICAgICAgLy8gQWRkIGludHJvIHNjcmVlbgogICAgICBzZWxmLmFkZFRlc3RCb290U2NyZWVuKCk7CiAgICB9CiAgICAKICAgIHNlbGYuY3JlYXRlZCA9IHRydWU7ICAvLyBEb24ndCBhbGxvdyBjcmVhdGUgdG8gYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzCiAgfTsKCiAgc2VsZi5ib290ID0gZnVuY3Rpb24oKSB7CiAgICBzZWxmLmRvUmVhZHlFdmVudHMoKTsKICB9OwoKICAvKioKICAgKiBOb3QgY3VycmVudGx5IGltcGxlbWVudGVkCiAgICovCiAgc2VsZi5yZXBvcnRHYW1lU3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkgewogICAgLy8gUGxhY2Vob2xkZXIKICB9OwoKICAvKioKICAgKiBOb3QgY3VycmVudGx5IGltcGxlbWVudGVkCiAgICovCiAgc2VsZi5yZXF1ZXN0UXVpdCA9IGZ1bmN0aW9uKCkgewogICAgLy8gUGxhY2Vob2xkZXIKICB9OwoKICAvKioKICAgKiBAcHJpdmF0ZQogICAqLwogIHNlbGYuZG9SZWFkeUV2ZW50cyA9IGZ1bmN0aW9uKCkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLnJlYWR5RnVuY3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgIHNlbGYucmVhZHlGdW5jdGlvbnNbaV0oKTsKICAgIH0KICAgIHNlbGYucmVhZHkgPSB0cnVlOwogIH07CgogIC8qKgogICAqIFBhc3MgeW91ciBnYW1lJ3MgaW5pdGlhbGl6ZXIgZnVuY3Rpb25zIHRvIHRoaXMKICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmIEZ1bmN0aW9uIHRvIGNhbGwgdG8gYmVnaW4gZ2FtZQogICAqLwogIHNlbGYub25SZWFkeSA9IGZ1bmN0aW9uKGYpIHsKICAgIGlmIChzZWxmLnJlYWR5KSB7CiAgICAgIGYoKTsKICAgIH0KICAgIGVsc2Ugc2VsZi5yZWFkeUZ1bmN0aW9ucy5wdXNoKGYpOwogIH07CgogIC8qKgogICAqIERpc3BsYXlzIGFuIGFkdmVydAogICAqLwogIHNlbGYuc2hvdzNyZFBhcnR5QWQgPSBzZWxmLnNob3dBZCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIGlmIChzZWxmLnJlYWR5ID09IGZhbHNlKSB7IHNlbGYuc2hvd05vdFJlYWR5V2FybmluZygpOyByZXR1cm47IH0gLy8gRG8gbm90IGFsbG93IGZ1bmN0aW9ucyB0byBiZSBjYWxsZWQgaWYgbm90IHJlYWR5CiAgICBpZiAoc2VsZi5pbkFwcCAmJiBzZWxmLmluQXBwLmlzVW5sb2NrZWQoKSkgcmV0dXJuOwogICAgc2VsZi5zaG93RGlzbWlzc2FibGVJbWFnZU92ZXJsYXkoJ2h0dHBzOi8vcmVwb3J0cy5mZ2wuY29tL3NhbmRib3gvYWRzL2h0bWw1L2V4YW1wbGVfYWR2ZXJ0LnBuZycsIDQwMCwgMzUwKTsKICB9OwoKICAvKioKICAgKiBTdWJtaXRzIHRoZSBnaXZlbiBzY29yZSB0byB0aGUgc3BlY2lmaWVkIGxlYWRlcmJvYXJkLiBJZiB5b3VyIGdhbWUKICAgKiBvbmx5IGhhcyBvbmUgbGVhZGVyYm9hcmQsIGRvIG5vdCBzdXBwbHkgYSBsZWFkZXJib2FyZElELgogICAqIEBwYXJhbSB7TnVtYmVyfSBzY29yZSBTY29yZSB0byBzdWJtaXQKICAgKiBAcGFyYW0ge3N0cmluZ30gbGVhZGVyYm9hcmRJRCBOYW1lIG9mIHRoZSBsZWFkZXJib2FyZCB0byBzaG93CiAgICovCiAgc2VsZi5zdWJtaXRTY29yZSA9IGZ1bmN0aW9uKHNjb3JlLCBsZWFkZXJib2FyZElELCBleHRyYSkgewogICAgdmFyIHNjb3JlcyA9IG51bGwsIGhvbGRlciA9IG51bGw7CiAgICB2YXIgcGxheWVyTmFtZSA9ICcnOwogICAgdmFyIHRpbWUgPSAwOwogICAgCiAgICBpZiAoc2VsZi5yZWFkeSA9PSBmYWxzZSkgeyBzZWxmLnNob3dOb3RSZWFkeVdhcm5pbmcoKTsgcmV0dXJuOyB9IC8vIERvIG5vdCBhbGxvdyBmdW5jdGlvbnMgdG8gYmUgY2FsbGVkIGlmIG5vdCByZWFkeQogICAgCiAgICAvLyBDYWxsZWQgd2hlbiB0aGUgdXNlciBjYW5jZWxzIHRoZSBzY29yZSBzdWJtaXNzaW9uOgogICAgdmFyIG9uU2NvcmVDYW5jZWxGdW5jdGlvbiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgc2VsZi5zdG9wRXZlbnRQcm9wYWdhdGlvbihlKTsKICAgICAgCiAgICAgIC8vIFJlbW92ZSBuYW1lIGVudHJ5IG92ZXJsYXkKICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChob2xkZXIpOwogICAgICBzZWxmLm92ZXJsYXkgPSBudWxsOwogICAgfQogICAgCiAgICAvLyBDYWxsZWQgd2hlbiBuYW1lIGZvcm0gaXMgc3VibWl0dGVkCiAgICB2YXIgb25OYW1lU3VibWl0RnVuY3Rpb24gPSBmdW5jdGlvbihlKSB7CiAgICAgIHNlbGYuc3RvcEV2ZW50UHJvcGFnYXRpb24oZSk7CiAgICAgIAogICAgICAvLyBHZXQgdGhlIG5hbWUgdGhhdCB3YXMgZW50ZXJlZAogICAgICBwbGF5ZXJOYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF9zY29yZW5hbWVpbnB1dCcpLnZhbHVlOwogICAgICAKICAgICAgLy8gSWYgdGhlIHBsYXllciBuYW1lIGlzIGludmFsaWQsIGhpZ2hsaWdodCB0aGUgaW5wdXQgYm94CiAgICAgIGlmICghcGxheWVyTmFtZSkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfc2NvcmVuYW1laW5wdXQnKS5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkIHJlZCc7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIAogICAgICAvLyBSZW1vdmUgbmFtZSBlbnRyeSBvdmVybGF5CiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoaG9sZGVyKTsKICAgICAgc2VsZi5vdmVybGF5ID0gbnVsbDsKICAgICAgCiAgICAgIC8vIEdldCBsZWFkZXJib2FyZCBzY29yZXMgc28gd2UgY2FuIHB1c2ggc2NvcmUKICAgICAgbGVhZGVyYm9hcmRJRCA9IGxlYWRlcmJvYXJkSUQgfHwgJ2RlZmF1bHQnOwogICAgICBzY29yZXMgPSBzZWxmLmxvYWRTY29yZXMoKTsKICAgICAgdGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoKICAgICAgLy8gQWRkIHRoZSBzY29yZQogICAgICBzY29yZXMucHVzaCggewogICAgICAgIHNjb3JlOiBzY29yZSwKICAgICAgICBwbGF5ZXI6IHBsYXllck5hbWUsCiAgICAgICAgdGltZTogdGltZQogICAgICB9ICk7CgogICAgICAvLyBTb3J0IHRoZSBzY29yZXMgbGlzdAogICAgICBzY29yZXMuc29ydCggZnVuY3Rpb24oYSwgYikgewogICAgICAgIGlmIChhLnNjb3JlID09PSBiLnNjb3JlKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEuc2NvcmUgPCBiLnNjb3JlID8gMSA6IC0xOwogICAgICB9ICk7CgogICAgICAvLyBTYXZlIGFuZCBkaXNwbGF5IHRoZSBuZXdseSB1cGRhdGVkIGxlYWRlcmJvYXJkCiAgICAgIHNlbGYuc2F2ZVNjb3JlcyhzY29yZXMpOwogICAgICBzZWxmLmRpc3BsYXlTY29yZWJvYXJkKGxlYWRlcmJvYXJkSUQsIHRpbWUpOwogICAgfQogICAgCiAgICAvLyBVc2VkIHRvIHN1Ym1pdCBuYW1lIGZvcm0gd2l0aCAnZW50ZXInIGtleQogICAgdmFyIG9uTmFtZUtleVByZXNzID0gZnVuY3Rpb24oZSkgewogICAgICBpZihlLmtleUNvZGUgPT09IDEzKSB7IC8vIEVudGVyIGtleQogICAgICAgIG9uTmFtZVN1Ym1pdEZ1bmN0aW9uKGUpOyAvLyBTdWJtaXQgdGhlIGVudGVyZWQgbmFtZQogICAgICB9CiAgICB9CiAgICAKICAgIC8vIFVzZWQgdG8gYWxsb3cgZm9jdXMgb24gbmFtZSBpbnB1dCBib3gKICAgIHZhciBvbk5hbWVTZWxlY3QgPSBmdW5jdGlvbihlKSB7CiAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF9zY29yZW5hbWVpbnB1dCcpOwogICAgICBlbGVtZW50LmZvY3VzKCk7CiAgICB9CiAgICAKICAgIC8vIE9ubHkgYWRkIGFuIG92ZXJsYXkgaWYgdGhlcmUgaXMgbm90IG9uZSBhbHJlYWR5CiAgICBpZihzZWxmLm92ZXJsYXkgPT0gbnVsbCkKICAgIHsKICAgICAgLy8gQWRkIG92ZXJsYXkgZm9yIG5hbWUgZW50cnkKICAgICAgaG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGhvbGRlci5pbm5lckhUTUwgPSBodG1sU3R5bGVDb250YWluZXIuZ2V0U2NvcmVEaXYoc2NvcmUpOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGhvbGRlcik7CiAgICAgIHNlbGYub3ZlcmxheSA9IGhvbGRlcjsKICAgICAgCiAgICAgIC8vIEhvb2sgdXAgdGhlIG9uTmFtZVN1Ym1pdEZ1bmN0aW9uIHRvIHRoZSBzdWJtaXQgYnV0dG9uCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfc2NvcmVzdWJtaXRidXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsCiAgICAgICAgb25OYW1lU3VibWl0RnVuY3Rpb24sIGZhbHNlKTsKICAgICAgCiAgICAgIC8vIENsb3NlIGJ1dHRvbgogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX2Nsb3NlYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLAogICAgICAgIG9uU2NvcmVDYW5jZWxGdW5jdGlvbiwgZmFsc2UpOwogICAgICAKICAgICAgLy8gSW5wdXQgYm94IGhhbmRsZXJzIChjbGljayB0byBmb2N1cyBhbmQgZW50ZXIgdG8gc3VibWl0KQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX3Njb3JlbmFtZWlucHV0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLAogICAgICAgIG9uTmFtZVNlbGVjdCwgZmFsc2UpOwogICAgICAKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF9zY29yZW5hbWVpbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywKICAgICAgICBvbk5hbWVLZXlQcmVzcywgZmFsc2UpOwogICAgICAKICAgICAgLy8gTWFrZSBzdXJlIHdlJ3JlIHZlcnRpY2FsbHkgY2VudGVyZWQ6CiAgICAgIHNlbGYuaHRtbEhlbHBlcnMuY2hlY2tWZXJ0aWNhbENlbnRlcmluZygpOwogICAgfQogIH07CiAgCiAgLyoqCiAgICogRGlzcGxheXMgdGhlIHNjb3JlYm9hcmQgVUkgb3ZlciB5b3VyIGdhbWUKICAgKiBAcGFyYW0ge3N0cmluZ30gbGVhZGVyYm9hcmRJRCBOYW1lIG9mIHRoZSBsZWFkZXJib2FyZCB0byBzaG93CiAgICogQHBhcmFtIHtOdW1iZXJ9IGhpZ2hsaWdodFNjb3JlIEluZGV4IG9mIHNjb3JlIGluIHRoZSBsaXN0IHRvIGhpZ2hsaWdodCAoMCBmb3Igbm9uZSkKICAgKi8KICBzZWxmLmRpc3BsYXlTY29yZWJvYXJkID0gZnVuY3Rpb24obGVhZGVyYm9hcmRJRCwgaGlnaGxpZ2h0U2NvcmUpIHsKICAgIHZhciBzY29yZXMgPSBudWxsOwogICAgdmFyIGh0bWwgPSAnJzsKICAgIHZhciBudW0gPSAxOwogICAgdmFyIHNjcmlwdCA9IG51bGw7CiAgICAKICAgIGlmIChzZWxmLnJlYWR5ID09IGZhbHNlKSB7IHNlbGYuc2hvd05vdFJlYWR5V2FybmluZygpOyByZXR1cm47IH0gLy8gRG8gbm90IGFsbG93IGZ1bmN0aW9ucyB0byBiZSBjYWxsZWQgaWYgbm90IHJlYWR5CiAgICAKICAgIGxlYWRlcmJvYXJkSUQgPSBsZWFkZXJib2FyZElEIHx8ICdkZWZhdWx0JzsKICAgIGhpZ2hsaWdodFNjb3JlID0gaGlnaGxpZ2h0U2NvcmUgfHwgMDsKICAgIAogICAgaHRtbCA9ICc8dGFibGUgY2xhc3M9ImZnbC1zY29yZWJvYXJkIj48dHI+PHRoPiM8L3RoPjx0aD5OYW1lPC90aD4nICsgCiAgICAgICc8dGg+U2NvcmU8L3RoPjx0aD5EYXRlPC90aD48L3RyPic7CgogICAgc2NvcmVzID0gc2VsZi5sb2FkU2NvcmVzKCk7CiAgICBmb3IgKHZhciBpIGluIHNjb3JlcykgewogICAgICB2YXIgc2NvcmUgPSBzY29yZXNbaV07CiAgICAgIGlmIChzY29yZS50aW1lID09IGhpZ2hsaWdodFNjb3JlKSB7CiAgICAgICAgaHRtbCArPSAnPHRyIGNsYXNzPSJmZ2wtc2NvcmUtaGlnaGxpZ2h0Ij4nOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIGh0bWwgKz0gJzx0cj4nOwogICAgICB9CgogICAgICBodG1sICs9ICc8dGQ+JyArIChudW0rKykgKyAnPC90ZD48dGQ+JyArIHNjb3JlLnBsYXllciArICc8L3RkPjx0ZD4nICsKICAgICAgICBzY29yZS5zY29yZSArICc8L3RkPjx0ZD4nICsgbmV3IERhdGUoc2NvcmUudGltZSkudG9Mb2NhbGVEYXRlU3RyaW5nKCkgKwogICAgICAgICc8L3RkPjwvdHI+JzsKICAgIH0KICAgIGh0bWwgKz0gJzwvdGFibGU+PC9kaXY+JzsKCiAgICBzY29yZU92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICBzY29yZU92ZXJsYXkuaW5uZXJIVE1MID0gaHRtbFN0eWxlQ29udGFpbmVyLmNyZWF0ZVBvcHVwKCJMZWFkZXJib2FyZCIsIGh0bWwpOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY29yZU92ZXJsYXkpOwogICAgCiAgICAvLyBTZXQgdXAgdGhlIHN0YXJ0IGdhbWUgYnV0dG9uCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX2Nsb3NlYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLAogICAgICBzZWxmLmhpZGVTY29yZWJvYXJkLCBmYWxzZSk7CiAgICAKICAgIC8vIE1ha2Ugc3VyZSB3ZSdyZSB2ZXJ0aWNhbGx5IGNlbnRlcmVkOgogICAgc2VsZi5odG1sSGVscGVycy5jaGVja1ZlcnRpY2FsQ2VudGVyaW5nKCk7CiAgfTsKCiAgLyoqCiAgICogUmVtb3ZlcyB0aGUgc2NvcmVib2FyZCBVSSBmcm9tIHlvdXIgZ2FtZQogICAqLwogIHNlbGYuaGlkZVNjb3JlYm9hcmQgPSBmdW5jdGlvbihlKSB7CiAgICBzZWxmLnN0b3BFdmVudFByb3BhZ2F0aW9uKGUpOwogICAgaWYgKCEgc2NvcmVPdmVybGF5KSByZXR1cm47CiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHNjb3JlT3ZlcmxheSk7CiAgICBzY29yZU92ZXJsYXkgPSBudWxsOwogIH07CgogIC8qKgogICAqIEdyYW50cyB0aGUgc3BlY2lmaWVkIGFjaGlldmVtZW50IHRvIHRoZSBwbGF5ZXIKICAgKi8KICBzZWxmLmdyYW50QWNoaWV2ZW1lbnQgPSBmdW5jdGlvbihhY2hpZXZlbWVudElkKSB7CiAgICAvLyBQbGFjZWhvbGRlcgogIH07CgogIC8qKgogICAqIFNob3dzIGEgbGlzdCBvZiBhY2hpZXZlbWVudHMgd2l0aCB0aGVpciBsb2NrZWQvdW5sb2NrZWQgc3RhdGVzCiAgICovCiAgc2VsZi5zaG93QWNoaWV2ZW1lbnRzID0gZnVuY3Rpb24oKSB7CiAgICAvLyBQbGFjZWhvbGRlcgogIH07CgogIC8qKgogICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgcGxheWVyIGhhcyB1bmxvY2tlZCB0aGUgc3BlY2lmaWVkIGFjaGlldmVtZW50CiAgICovCiAgc2VsZi5oYXNBY2hpZXZlbWVudCA9IGZ1bmN0aW9uKGFjaGlldmVtZW50SWQpIHsKICAgIHJldHVybiBmYWxzZTsKICB9OwoKICAvKioKICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGFwcCBpcyBydW5uaW5nIGluIHByZW1pdW0gKHVubG9ja2VkKSBtb2RlOgogICAqLwogIHNlbGYuaXNQcmVtaXVtID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gc2VsZi5pbkFwcCAmJiBzZWxmLmluQXBwLmlzVW5sb2NrZWQoKTsKICB9OwoKICAvKioKICAgKiBHaXZlcyBhY2Nlc3MgdG8gdGhlIGluIGFwcCBwdXJjaGFzaW5nIGZ1bmN0aW9ucy4KICAgKi8KICBzZWxmLmluQXBwID0gbmV3IGZ1bmN0aW9uKCkgewogICAgdmFyIGluQXBwX3NlbGYgPSB0aGlzOwogICAgdmFyIHVubG9ja2VkID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGFwcCBoYXMgYmVlbiB1bmxvY2tlZCBieSBhIHBheW1lbnQuCiAgICAgKi8KICAgIGluQXBwX3NlbGYuaXNVbmxvY2tlZCA9IGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgaXRlbSA9IGl0ZW0gfHwgJ3VubG9jayc7CiAgICAgIHJldHVybiBpbkFwcF9zZWxmLnVubG9ja2VkIHx8IGZhbHNlOwogICAgfTsKCiAgICAvKioKICAgICAqIEJlZ2lucyB0aGUgcHJvY2VzcyBvZiB1bmxvY2tpbmcgYSBnYW1lLgogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2Vzc0Z1bmN0aW9uIEZ1bmN0aW9uIHRvIGNhbGwgb24gdW5sb2NrIHN1Y2Nlc3MKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGZhaWxGdW5jdGlvbiBGdW5jdGlvbiB0byBjYWxsIG9uIHVubG9jayBmYWlsdXJlCiAgICAgKi8KICAgIGluQXBwX3NlbGYuaW5pdGlhdGVVbmxvY2tGdW5jdGlvbiA9IGZ1bmN0aW9uKHN1Y2Nlc3NGdW5jdGlvbiwgZmFpbEZ1bmN0aW9uKSB7CiAgICAgIHZhciBvdmVybGF5ID0gbnVsbDsKICAgICAgdmFyIGh0bWwgPSAnJzsKICAgICAgCiAgICAgIC8vIERvIG5vdCBhbGxvdyBmdW5jdGlvbnMgdG8gYmUgY2FsbGVkIGlmIG5vdCByZWFkeQogICAgICBpZiAoc2VsZi5yZWFkeSA9PSBmYWxzZSkgeyBzZWxmLnNob3dOb3RSZWFkeVdhcm5pbmcoKTsgcmV0dXJuOyB9CiAgICAgIAogICAgICAvLyBJZiB3ZSdyZSBub3QgYWxsb3dlZCB0byB1bmxvY2ssIGV4aXQgZWFybHk6CiAgICAgIGlmIChzZWxmLnVubG9ja0VuYWJsZWQgPT09IGZhbHNlKSByZXR1cm47CiAgICAgIAogICAgICAvLyBJZiB3ZSdyZSBhbHJlYWR5IHVubG9ja2VkLCBmaXJlIHRoZSBzdWNjZXNzIGZ1bmN0aW9uIGFuZCBleGl0OgogICAgICBpZiAoaW5BcHBfc2VsZi5pc1VubG9ja2VkKCkpIHsKICAgICAgICBzdWNjZXNzRnVuY3Rpb24oKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgCiAgICAgIC8vIFNldHVwIG91ciBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIG91ciBvdmVybGF5OgogICAgICB2YXIgb25JbkFwcE9LQ2xpY2sgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgc2VsZi5zdG9wRXZlbnRQcm9wYWdhdGlvbihlKTsKICAgICAgICBpbkFwcF9zZWxmLnVubG9ja2VkID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgc3VjY2Vzc0Z1bmN0aW9uKCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoKGUpIHsgfQogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7CiAgICAgICAgc2VsZi5vdmVybGF5ID0gbnVsbDsKICAgICAgfQogICAgICB2YXIgb25JbkFwcENhbmNlbENsaWNrID0gZnVuY3Rpb24oZSkgewogICAgICAgIHNlbGYuc3RvcEV2ZW50UHJvcGFnYXRpb24oZSk7CiAgICAgICAgaW5BcHBfc2VsZi51bmxvY2tlZCA9IGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAgICAgICBmYWlsRnVuY3Rpb24oKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2goZSkgeyB9CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTsKICAgICAgICBzZWxmLm92ZXJsYXkgPSBudWxsOwogICAgICB9CiAgICAgIAogICAgICAvLyBPbmx5IGFkZCBhbiBvdmVybGF5IGlmIHRoZXJlIGlzbid0IG9uZSBhbHJlYWR5CiAgICAgIGlmKHNlbGYub3ZlcmxheSA9PSBudWxsKQogICAgICB7CiAgICAgICAgLy8gU2hvdyB0aGUgdW5sb2NrIG92ZXJsYXk6CiAgICAgICAgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICBvdmVybGF5LmlubmVySFRNTCA9IGh0bWxTdHlsZUNvbnRhaW5lci5nZXRJYXBEaXYoKTsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpOwogICAgICAgIHNlbGYub3ZlcmxheSA9IG92ZXJsYXk7CiAgICAgICAgCiAgICAgICAgLy8gSG9vayB1cCB0aGUgb25OYW1lU3VibWl0RnVuY3Rpb24gdG8gdGhlIHN1Ym1pdCBidXR0b24KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX2lhcHVubG9ja2J1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywKICAgICAgICAgIG9uSW5BcHBPS0NsaWNrLCBmYWxzZSk7CiAgICAgICAgCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF9pYXBjYW5jZWxidXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsCiAgICAgICAgICBvbkluQXBwQ2FuY2VsQ2xpY2ssIGZhbHNlKTsKICAgICAgICAKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX2Nsb3NlYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLAogICAgICAgICAgb25JbkFwcENhbmNlbENsaWNrLCBmYWxzZSk7CiAgICAgICAgCiAgICAgICAgLy8gTWFrZSBzdXJlIHdlJ3JlIHZlcnRpY2FsbHkgY2VudGVyZWQ6CiAgICAgICAgc2VsZi5odG1sSGVscGVycy5jaGVja1ZlcnRpY2FsQ2VudGVyaW5nKCk7CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBEaXNwbGF5cyB0aGUgIk1vcmUgR2FtZXMiIHBhZ2UKICAgKi8KICBzZWxmLnNob3dNb3JlR2FtZXMgPSBmdW5jdGlvbigpIHsKICAgIGlmIChzZWxmLnJlYWR5ID09IGZhbHNlKSB7IHNlbGYuc2hvd05vdFJlYWR5V2FybmluZygpOyByZXR1cm47IH0gLy8gRG8gbm90IGFsbG93IGZ1bmN0aW9ucyB0byBiZSBjYWxsZWQgaWYgbm90IHJlYWR5CiAgICBzZWxmLnNob3dEaXNtaXNzYWJsZUltYWdlT3ZlcmxheSgnaHR0cHM6Ly9yZXBvcnRzLmZnbC5jb20vc2FuZGJveC9hZHMvaHRtbDUvY3Jvc3NfcHJvbW9fY292ZXIucG5nJywgNDAwLCAzNTApOwogIH07CiAgCiAgLyoqCiAgICogRGlzcGxheXMgYSBkaXNtaXNzYWJsZSBjZW50ZXJlZCBpbWFnZSBvdmVybGF5IC0gaW50ZXJuYWwgdXNlIG9ubHkKICAgKiBAcHJpdmF0ZQogICAqLwogIHNlbGYuc2hvd0Rpc21pc3NhYmxlSW1hZ2VPdmVybGF5ID0gZnVuY3Rpb24oc3JjLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICBpZiAoc2VsZi5yZWFkeSA9PSBmYWxzZSkgeyBzZWxmLnNob3dOb3RSZWFkeVdhcm5pbmcoKTsgcmV0dXJuOyB9IC8vIERvIG5vdCBhbGxvdyBmdW5jdGlvbnMgdG8gYmUgY2FsbGVkIGlmIG5vdCByZWFkeQogICAgaWYoc2VsZi5vdmVybGF5ID09IG51bGwpCiAgICB7CiAgICAgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICBvdmVybGF5LmlubmVySFRNTCA9IGh0bWxTdHlsZUNvbnRhaW5lci5nZXRJbWFnZU92ZXJsYXkoc3JjLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTsKICAgICAgc2VsZi5vdmVybGF5ID0gb3ZlcmxheTsKICAgICAgCiAgICAgIHZhciBjbG9zZU92ZXJsYXkgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgc2VsZi5zdG9wRXZlbnRQcm9wYWdhdGlvbihlKTsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpOwogICAgICAgIHNlbGYub3ZlcmxheSA9IG51bGw7CiAgICAgIH0KICAgICAgCiAgICAgIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLAogICAgICAgIGNsb3NlT3ZlcmxheSk7CiAgICAgIAogICAgICAvLyBNYWtlIHN1cmUgd2UncmUgdmVydGljYWxseSBjZW50ZXJlZDoKICAgICAgc2VsZi5odG1sSGVscGVycy5jaGVja1ZlcnRpY2FsQ2VudGVyaW5nKCk7CiAgICB9CiAgfQogIAogIC8qKgogICAqIERpc3BsYXlzIGEgZGlzbWlzc2FibGUgY2VudGVyZWQgYWxlcnQgLSBpbnRlcm5hbCB1c2Ugb25seQogICAqIEBwcml2YXRlCiAgICovCiAgc2VsZi5zaG93RGlzbWlzc2FibGVBbGVydCA9IGZ1bmN0aW9uKHRpdGxlLCBtZXNzYWdlKSB7CiAgICBpZihzZWxmLm92ZXJsYXkgPT0gbnVsbCkKICAgIHsKICAgICAgdmFyIG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgIHZhciBhbGVydEhUTUwgPSAKICAgICAgICAnPHA+JyArIG1lc3NhZ2UgKyAnPC9wPicgKwogICAgICAgICc8ZGl2IGNsYXNzPSJmZ2wtcG9wdXAtYWN0aW9ucyI+JyArCiAgICAgICAgICAnPGEgY2xhc3M9ImZnbC1wb3B1cC1idXR0b24iPkRpc21pc3M8L2E+JyArCiAgICAgICAgJzwvZGl2Pic7CiAgICAgIG92ZXJsYXkuaW5uZXJIVE1MID0gaHRtbFN0eWxlQ29udGFpbmVyLmNyZWF0ZVBvcHVwKHRpdGxlLCBhbGVydEhUTUwpOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpOwogICAgICBzZWxmLm92ZXJsYXkgPSBvdmVybGF5OwogICAgICAKICAgICAgdmFyIGNsb3NlT3ZlcmxheSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICBzZWxmLnN0b3BFdmVudFByb3BhZ2F0aW9uKGUpOwogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7CiAgICAgICAgc2VsZi5vdmVybGF5ID0gbnVsbDsKICAgICAgfQogICAgICAKICAgICAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsCiAgICAgICAgY2xvc2VPdmVybGF5KTsKICAgICAgCiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSdyZSB2ZXJ0aWNhbGx5IGNlbnRlcmVkOgogICAgICBzZWxmLmh0bWxIZWxwZXJzLmNoZWNrVmVydGljYWxDZW50ZXJpbmcoKTsKICAgIH0KICB9CgogIC8qKgogICAqIEdldHMgdGhlIFVSSSAob3IgZGF0YSBVUkkpIG9mIHRoZSBicmFuZGluZyBsb2dvCiAgICogQHJldHVybnMge3N0cmluZ30gVVJJIG9yIGRhdGEgVVJJIG9mIGJyYW5kaW5nIGxvZ28KICAgKi8KICBzZWxmLmdldEJyYW5kaW5nTG9nbyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICJodHRwczovL3NpdGVzLm1wc3RhdGljLmNvbS9odG1sNS9zZGtzL2ZnbC1icmFuZGluZy1wbGFjZWhvbGRlci5wbmciOwogIH07CgogIC8qKgogICAqIENhbGwgdGhpcyBtZXRob2Qgd2hlbiB0aGUgdXNlciBjbGlja3Mgb3IgdGFwcyBvbiB0aGUgYnJhbmRpbmcgbG9nbwogICAqLwogIHNlbGYuaGFuZGxlQnJhbmRpbmdDbGljayA9IGZ1bmN0aW9uKCkgewogICAgaWYgKHNlbGYucmVhZHkgPT0gZmFsc2UpIHsgc2VsZi5zaG93Tm90UmVhZHlXYXJuaW5nKCk7IHJldHVybjsgfSAvLyBEbyBub3QgYWxsb3cgZnVuY3Rpb25zIHRvIGJlIGNhbGxlZCBpZiBub3QgcmVhZHkKICAgIHNlbGYuc2hvd0Rpc21pc3NhYmxlQWxlcnQoJ1B1Ymxpc2hlciBCcmFuZGluZyBDbGlja2VkJywgCiAgICAgICdEeW5hbWljIHB1Ymxpc2hlciBicmFuZGluZyBpcyBub3cgaW1wbGVtZW50ZWQgaW4geW91ciBnYW1lIScgKwogICAgICAnPGJyIC8+PGJyIC8+JyArCiAgICAgICdOb3RlOiBUaGlzIG1lc3NhZ2Ugc2hvdWxkIG9ubHkgYmUgZGlzcGxheWVkIHdoZW4geW91IGNsaWNrICcgKwogICAgICAndGhlIDxzdHJvbmc+UHVibGlzaGVyIEJyYW5kaW5nPC9zdHJvbmc+IHBsYWNlaG9sZGVyLicpOwogIH0KICAKICAvKioKICAgKiBBZGRzIHRoZSBib290IHNjcmVlbiBhbmQgZXZlbnQgbGlzdGVuZXJzCiAgICogQHByaXZhdGUKICAgKi8KICBzZWxmLmFkZFRlc3RCb290U2NyZWVuID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgaG9sZGVyLmlubmVySFRNTCA9IGh0bWxTdHlsZUNvbnRhaW5lci5nZXRJbnRyb0RpdigpOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChob2xkZXIpOwogICAgCiAgICB2YXIgaGFuZGxlU3RhcnRHYW1lID0gZnVuY3Rpb24oKSB7CiAgICAgIC8qIE1hZ2ljIHRyaWNrLCB3ZSBwdXQgb3VyIHNldHRpbmdzIGludG8gdGhlIFVSTCBoYXNoIHRoZW4gcmVsb2FkIHRoZSBwYWdlLgogICAgICAgKiBUaGlzIGNhdXNlcyB0aGUgZ2FtZSB0byBib290IGZyb20gdGhlIGJlZ2lubmluZyBhZ2FpbiwgYnV0IGl0IHdpbGwgYWxyZWFkeQogICAgICAgKiBrbm93IHRoZSBzZXR0aW5ncy4KICAgICAgICovCiAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJyNGR0xTREs9JyArIEpTT04uc3RyaW5naWZ5KHsKICAgICAgICBjcm9zc1Byb21vdGlvbkVuYWJsZWQ6ICFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmdsX2hpZGVNb3JlR2FtZXMnKS5jaGVja2VkLAogICAgICAgIHVubG9ja0VuYWJsZWQ6ICAgICAgICAgIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfaGlkZVVubG9ja3MnKS5jaGVja2VkLAogICAgICAgIHVubG9ja2VkOiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF91bmxvY2tHYW1lJykuY2hlY2tlZCwKICAgICAgICBicmFuZGluZ0VuYWJsZWQ6ICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZ2xfc3BvbnNvcmVkJykuY2hlY2tlZAogICAgICB9KTsKICAgICAgCiAgICAgIHNlbGYuc3RhcnRlZCA9IHRydWU7CiAgICAgIAogICAgICAvLyBSZWxvYWQKICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgfTsKICAgIAogICAgLy8gU2V0IHVwIHRoZSBzdGFydCBnYW1lIGJ1dHRvbgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZnbF9zdGFydGdhbWVidXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIAogICAgICBoYW5kbGVTdGFydEdhbWUsIGZhbHNlKTsKICAgIAogICAgLy8gTWFrZSBzdXJlIHdlJ3JlIHZlcnRpY2FsbHkgY2VudGVyZWQ6CiAgICBzZWxmLmh0bWxIZWxwZXJzLmNoZWNrVmVydGljYWxDZW50ZXJpbmcoKTsKICB9OwogIAogIHNlbGYuc2hvd05vdFJlYWR5V2FybmluZyA9IGZ1bmN0aW9uKCkgewogICAgLy9jb25zb2xlLmxvZyhzZWxmLnN0YXJ0ZWQgKyAnLCAnICsgc2VsZi5yZWFkeSk7CiAgICAvKmlmKHNlbGYuc3RhcnRlZCA9PT0gdHJ1ZSkgewogICAgICBzZWxmLnNob3dEaXNtaXNzYWJsZUFsZXJ0KCdGR0wgU0RLIG5vdCByZWFkeSEnLCAnUGxlYXNlIHdhaXQgZm9yIG9uUmVhZHknICsKICAgICAgICAnYmVmb3JlIHVzaW5nIFNESyBmdW5jdGlvbmFsaXR5LicpOwogICAgfSovCiAgfQogIAogIC8qKgogICAqIERvIHdlIGhhdmUgYW4gZXZlbnQgbGlzdGVuZXIgcmVnaXN0ZXJlZCB5ZXQ/CiAgICogQHByaXZhdGUKICAgKi8KICBzZWxmLmh0bWxIZWxwZXJzLmhhc1Jlc2l6ZUxpc3RlbmVyID0gZmFsc2U7CiAgCiAgLyoqCiAgICogVXNlZCB0byB2ZXJ0aWNhbGx5IGNlbnRlciBwb3B1cHM6CiAgICogQHByaXZhdGUKICAgKi8KICBzZWxmLmh0bWxIZWxwZXJzLnZlcnRpY2FsQ2VudGVyID0gZnVuY3Rpb24oZWxlbWVudCkgewogICAgaWYgKCFlbGVtZW50LnBhcmVudE5vZGUpIHJldHVybjsKICAgIAogICAgdmFyIHRvcE1hcmdpbiA9IChlbGVtZW50LnBhcmVudE5vZGUub2Zmc2V0SGVpZ2h0IC8gMikgLQogICAgICAoZWxlbWVudC5vZmZzZXRIZWlnaHQgLyAyKTsKICAgIAogICAgaWYgKHRvcE1hcmdpbiA8IDApIHRvcE1hcmdpbiA9IDA7CiAgICBlbGVtZW50LnN0eWxlLm1hcmdpblRvcCA9IHRvcE1hcmdpbiArICdweCc7CiAgfQogIAogIC8qKgogICAqIENoZWNrcyB0aGUgdmVydGljYWwgY2VudGVyaW5nIG9mIGFsbCBlbGVtZW50cyB3aGljaCBzaG91bGQgYmUgdi1jZW50ZXJlZAogICAqIEBwcml2YXRlCiAgICovCiAgc2VsZi5odG1sSGVscGVycy5jaGVja1ZlcnRpY2FsQ2VudGVyaW5nID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdmZ2wtdmNlbnRlcicpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBzZWxmLmh0bWxIZWxwZXJzLnZlcnRpY2FsQ2VudGVyKGVsZW1lbnRzW2ldKTsKICAgIH0KICAgIAogICAgLy8gRW5zdXJlIHdlIGhhdmUgYW4gZXZlbnQgbGlzdGVuZXI6CiAgICBpZiAoIXNlbGYuaHRtbEhlbHBlcnMuaGFzUmVzaXplTGlzdGVuZXIpIHsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIAogICAgICAgIHNlbGYuaHRtbEhlbHBlcnMuY2hlY2tWZXJ0aWNhbENlbnRlcmluZyk7CiAgICAgICAgCiAgICAgIHNlbGYuaHRtbEhlbHBlcnMuaGFzUmVzaXplTGlzdGVuZXIgPSB0cnVlOwogICAgfQogIH0KICAKICBzZWxmLnN0b3BFdmVudFByb3BhZ2F0aW9uID0gZnVuY3Rpb24oZSkgewogICAgdmFyIGV2ID0gZSB8fCB3aW5kb3cuZXZlbnQ7CiAgICBpZihldiA9PSBudWxsKSB7IHJldHVybjsgfQogICAgaWYoZXYuc3RvcFByb3BhZ2F0aW9uICE9IG51bGwpIHsKICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgICBpZihldi5jYW5jZWxCdWJibGUgIT0gbnVsbCkgewogICAgICBldi5jYW5jZWxCdWJibGUgPSB0cnVlOwogICAgfQogIH0KICAKICAvKioKICAgKiBHZXQgdGhlIENTUyBmb3IgdGhlIG92ZXJsYXlzCiAgICogQHByaXZhdGUKICAgKi8KICBodG1sU3R5bGVDb250YWluZXIuZ2V0Q3NzID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaHRtbCA9ICcuZmdsLXBvcHVwIHsnICsKICAgICAgJ3Bvc2l0aW9uOiByZWxhdGl2ZTsnICsKCiAgICAgICdtYXgtd2lkdGg6IDQ1MHB4OycgKwogICAgICAnbWFyZ2luOiBhdXRvOycgKwogICAgICAnYm9yZGVyLXJhZGl1czogNHB4OycgKwogICAgICAnYm9yZGVyOiAxcHggc29saWQgI0ZGRjsnICsKICAgICAgJ2NvbG9yOiAjMDAwOycgKwoKICAgICAgJ2JhY2tncm91bmQtY29sb3I6ICNGRkY7JyArCiAgICAnfScgKwogICAgCiAgICAnLmZnbC1wb3B1cCBmaWVsZHNldCB7JyArCiAgICAgICdwYWRkaW5nOiA1cHg7JyArCiAgICAnfScgKwoKICAgICcuZmdsLXBvcHVwLXNjb3JlIHsnICsKICAgICAgJ3dpZHRoOiAzNTBweDsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtaGVhZCB7JyArCiAgICAgICdwb3NpdGlvbjogYWJzb2x1dGU7JyArCiAgICAgICdib3JkZXItcmFkaXVzOiAzcHggM3B4IDAgMDsnICsKCiAgICAgICd0b3A6IDA7JyArCiAgICAgICdsZWZ0OiAwOycgKwogICAgICAncmlnaHQ6IDA7JyArCiAgICAgICdoZWlnaHQ6IDQ0cHg7JyArCiAgICAgICdsaW5lLWhlaWdodDogNDRweDsnICsKICAgICAgJ3BhZGRpbmctbGVmdDogMTJweDsnICsKCiAgICAgICdjb2xvcjogI0ZGRjsnICsKICAgICAgJ2ZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsnICsKICAgICAgJ2ZvbnQtc2l6ZTogMThweDsnICsKCiAgICAgICdiYWNrZ3JvdW5kOiAjNDk0OTQ5OycgKwogICAgICAnYmFja2dyb3VuZDogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAgIzQ5NDk0OSAwJSwgIzM3MzczNyAxMDAlKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IC13ZWJraXQtZ3JhZGllbnQobGluZWFyLCBsZWZ0IHRvcCwgbGVmdCBib3R0b20sIGNvbG9yLXN0b3AoMCUsIzQ5NDk0OSksIGNvbG9yLXN0b3AoMTAwJSwjMzczNzM3KSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCh0b3AsICAjNDk0OTQ5IDAlLCMzNzM3MzcgMTAwJSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtby1saW5lYXItZ3JhZGllbnQodG9wLCAgIzQ5NDk0OSAwJSwjMzczNzM3IDEwMCUpOycgKwogICAgICAnYmFja2dyb3VuZDogLW1zLWxpbmVhci1ncmFkaWVudCh0b3AsICAjNDk0OTQ5IDAlLCMzNzM3MzcgMTAwJSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAgIzQ5NDk0OSAwJSwjMzczNzM3IDEwMCUpOycgKwogICAgICAnZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoIHN0YXJ0Q29sb3JzdHI9IiM0OTQ5NDkiLCBlbmRDb2xvcnN0cj0iIzM3MzczNyIsR3JhZGllbnRUeXBlPTAgKTsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtaGVhZHNwYWNlciB7JyArCiAgICAgICdtYXJnaW4tdG9wOiA1NHB4OycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1zdWJ0aXRsZSB7JyArCiAgICAgICdmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7JyArCiAgICAgICdmb250LXNpemU6IDE1cHg7JyArCiAgICAgICd0ZXh0LWFsaWduOiBjZW50ZXI7JyArCiAgICAgICdjb2xvcjogIzY2NjsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAgcCB7JyArCiAgICAgICdmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7JyArCiAgICAgICdmb250LXNpemU6IDE1cHg7JyArCiAgICAgICdtYXJnaW46IDE4cHg7JyArCiAgICAnfScgKwoKICAgICcuZmdsLXBvcHVwLXNjb3JlYm94IHsnICsKICAgICAgJ2ZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsnICsKICAgICAgJ2ZvbnQtc2l6ZTogNDVweDsnICsKICAgICAgJ3RleHQtYWxpZ246IGNlbnRlcjsnICsKICAgICAgJ2NvbG9yOiAjQUI0MTQwOycgKwogICAgICAnZm9udC13ZWlnaHQ6IGJvbGQ7JyArCiAgICAgICdib3JkZXI6IDFweCBzb2xpZCAjREZERkRGOycgKwogICAgICAnbWFyZ2luOiAxMHB4IDI1cHg7JyArCiAgICAgICdvdmVyZmxvdzogYXV0bzsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtcHJvbXB0bGFiZWwgeycgKwogICAgICAncGFkZGluZzogMTVweDsnICsKICAgICAgJ2ZvbnQtc2l6ZTogMTRweDsnICsKICAgICAgJ21hcmdpbi1sZWZ0OiAxMHB4OycgKwogICAgICAnZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1mb290ZXIgeycgKwogICAgICAncGFkZGluZzogMTBweDsnICsKICAgICAgJ21hcmdpbjogMCAxNXB4IDE1cHggMTVweDsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtYmlnZm9vdGVyIHsnICsKICAgICAgJ3BhZGRpbmc6IDIwcHg7JyArCiAgICAgICdtYXJnaW46IDAgMTVweCAxNXB4IDE1cHg7JyArCiAgICAgICd0ZXh0LWFsaWduOiBjZW50ZXI7JyArCiAgICAnfScgKwoKICAgICcuZmdsLXBvcHVwLXByb21wdCB7JyArCiAgICAgICdmb250LXNpemU6IDE2cHg7JyArCiAgICAgICdoZWlnaHQ6IDM0cHg7JyArCiAgICAgICdsaW5lLWhlaWdodDogMzNweDsnICsKICAgICAgJ3dpZHRoOiAyMDBweDsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtYnV0dG9uIHsnICsKICAgICAgJ3BhZGRpbmc6IDhweCAxMnB4OycgKwogICAgICAnbWFyZ2luLWxlZnQ6IDEwcHg7JyArCgogICAgICAnYmFja2dyb3VuZDogI2FiNDE0MDsnICsKICAgICAgJ2JhY2tncm91bmQ6IC1tb3otbGluZWFyLWdyYWRpZW50KHRvcCwgICNhYjQxNDAgMCUsICM5NzNhMzkgMTAwJSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtd2Via2l0LWdyYWRpZW50KGxpbmVhciwgbGVmdCB0b3AsIGxlZnQgYm90dG9tLCBjb2xvci1zdG9wKDAlLCNhYjQxNDApLCBjb2xvci1zdG9wKDEwMCUsIzk3M2EzOSkpOycgKwogICAgICAnYmFja2dyb3VuZDogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQodG9wLCAgI2FiNDE0MCAwJSwjOTczYTM5IDEwMCUpOycgKwogICAgICAnYmFja2dyb3VuZDogLW8tbGluZWFyLWdyYWRpZW50KHRvcCwgICNhYjQxNDAgMCUsIzk3M2EzOSAxMDAlKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IC1tcy1saW5lYXItZ3JhZGllbnQodG9wLCAgI2FiNDE0MCAwJSwjOTczYTM5IDEwMCUpOycgKwogICAgICAnYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgICNhYjQxNDAgMCUsIzk3M2EzOSAxMDAlKTsnICsKICAgICAgJ2ZpbHRlcjogcHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LmdyYWRpZW50KCBzdGFydENvbG9yc3RyPSIjYWI0MTQwIiwgZW5kQ29sb3JzdHI9IiM5NzNhMzkiLEdyYWRpZW50VHlwZT0wICk7JyArCgogICAgICAnY29sb3I6ICNGRkY7JyArCiAgICAgICd0ZXh0LWRlY29yYXRpb246IG5vbmU7JyArCiAgICAgICdmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7JyArCiAgICAgICdmb250LXdlaWdodDogYm9sZDsnICsKICAgICAgJ2JvcmRlci1yYWRpdXM6IDZweDsnICsKICAgICAgJ2ZvbnQtc2l6ZTogMTVweDsnICsKICAgICAgJ2N1cnNvcjogcG9pbnRlcjsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtYmlnYnV0dG9uIHsnICsKICAgICAgJ3BhZGRpbmc6IDE2cHggMjRweDsnICsKICAgICAgJ21hcmdpbjogYXV0bzsnICsKCiAgICAgICdiYWNrZ3JvdW5kOiAjYWI0MTQwOycgKwogICAgICAnYmFja2dyb3VuZDogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAgI2FiNDE0MCAwJSwgIzk3M2EzOSAxMDAlKTsnICsKICAgICAgJ2JhY2tncm91bmQ6IC13ZWJraXQtZ3JhZGllbnQobGluZWFyLCBsZWZ0IHRvcCwgbGVmdCBib3R0b20sIGNvbG9yLXN0b3AoMCUsI2FiNDE0MCksIGNvbG9yLXN0b3AoMTAwJSwjOTczYTM5KSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCh0b3AsICAjYWI0MTQwIDAlLCM5NzNhMzkgMTAwJSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiAtby1saW5lYXItZ3JhZGllbnQodG9wLCAgI2FiNDE0MCAwJSwjOTczYTM5IDEwMCUpOycgKwogICAgICAnYmFja2dyb3VuZDogLW1zLWxpbmVhci1ncmFkaWVudCh0b3AsICAjYWI0MTQwIDAlLCM5NzNhMzkgMTAwJSk7JyArCiAgICAgICdiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCAgI2FiNDE0MCAwJSwjOTczYTM5IDEwMCUpOycgKwogICAgICAnZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoIHN0YXJ0Q29sb3JzdHI9IiNhYjQxNDAiLCBlbmRDb2xvcnN0cj0iIzk3M2EzOSIsR3JhZGllbnRUeXBlPTAgKTsnICsKCiAgICAgICdjb2xvcjogI0ZGRjsnICsKICAgICAgJ3RleHQtZGVjb3JhdGlvbjogbm9uZTsnICsKICAgICAgJ2ZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsnICsKICAgICAgJ2JvcmRlci1yYWRpdXM6IDRweDsnICsKICAgICAgJ2ZvbnQtc2l6ZTogMjFweDsnICsKICAgICAgJ2N1cnNvcjogcG9pbnRlcjsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtYWN0aW9ucyB7JyArCiAgICAgICd0ZXh0LWFsaWduOiByaWdodDsgJyArCiAgICAgICdwYWRkaW5nOiAwIDE2cHggMTZweCAxNnB4OycgKwogICAgICAnbWFyZ2luLXJpZ2h0OiAtNnB4OycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cCBmaWVsZHNldCB7JyArCiAgICAgICdtYXJnaW46IDE2cHg7JyArCiAgICAgICdmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7JyArCiAgICAnfScgKwoKICAgICcuZmdsLXBvcHVwIGZpZWxkc2V0IGxhYmVsIHsnICsKICAgICAgJ2Rpc3BsYXk6IGJsb2NrOycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1jbG9zZSB7JyArCiAgICAgICdmbG9hdDogcmlnaHQ7JyArCiAgICAgICdjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwwLjUpOycgKwogICAgICAndGV4dC1kZWNvcmF0aW9uOiBub25lOycgKwogICAgICAnZm9udC1zaXplOiAzMHB4OycgKwogICAgICAncGFkZGluZy1yaWdodDogMTBweDsnICsKICAgICd9JyArCgogICAgJy5mZ2wtcG9wdXAtY2xvc2UtaHVnZSB7JyArCiAgICAgICdwb3NpdGlvbjogZml4ZWQ7JyArCiAgICAgICd0b3A6IDEwcHg7JyArCiAgICAgICdyaWdodDogMTBweDsnICsKICAgICAgJ2NvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LDAuNSk7JyArCiAgICAgICd0ZXh0LWRlY29yYXRpb246IG5vbmU7JyArCiAgICAgICdmb250LXNpemU6IDcwcHg7JyArCiAgICAgICdwYWRkaW5nLXJpZ2h0OiAyMHB4OycgKwogICAgJ30nICsKCiAgICAnLmZnbC1wb3B1cC1jbG9zZTpob3ZlciB7JyArCiAgICAgICdjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwxKTsnICsKICAgICd9JyArCiAgICAKICAgICcuZmdsLXNjb3JlYm9hcmQgeycgKwogICAgICAnYm9yZGVyLXNwYWNpbmc6IDA7JyArCiAgICAgICdib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOycgKwogICAgICAnZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOycgKwogICAgICAnd2lkdGg6IDEwMCU7JyArCiAgICAgICd0ZXh0LWFsaWduOiBsZWZ0OycgKwogICAgJ30nICsKICAgIAogICAgJy5mZ2wtc2NvcmVib2FyZCB0aCwgLmZnbC1zY29yZWJvYXJkIHRkIHsnICsKICAgICAgJ3RleHQtYWxpZ246IGxlZnQ7JyArCiAgICAgICdwYWRkaW5nOiAycHggMTNweDsnICsKICAgICd9JyArCiAgICAKICAgICcuZmdsLXNjb3JlYm9hcmQgdHIgeycgKwogICAgICAnYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNFRUU7JyArCiAgICAnfScgKwogICAgCiAgICAnLmZnbC1zY29yZS1oaWdobGlnaHQgdGQgeycgKwogICAgICAnYmFja2dyb3VuZC1jb2xvcjogI0ZGRUU3NzsnICsKICAgICd9JyArCiAgICAKICAgICcuZmdsLWltYWdlLW92ZXJsYXkgeycgKwogICAgICAnbWFyZ2luOiBhdXRvOycgKwogICAgICAnY3Vyc29yOiBwb2ludGVyOycgKwogICAgJ30nOwogICAgcmV0dXJuIGh0bWw7CiAgfQogIAogIGh0bWxTdHlsZUNvbnRhaW5lci5nZXRJbnRyb0RpdiA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGh0bWwgPSAnPGRpdiBzdHlsZT0icG9zaXRpb246IGZpeGVkOyB0b3A6IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyBib3R0b206IDA7IGJhY2tncm91bmQtY29sb3I6ICMwMDA7IHotaW5kZXg6IDEwMDAwOyIgaWQ9ImZnbF9vdmVybGF5IiBvbm1vdXNlZG93bj0idmFyIGUgPSBhcmd1bWVudHNbMF0gfHwgd2luZG93LmV2ZW50OyBlLnN0b3BQcm9wYWdhdGlvbigpOyI+JyArCiAgICAgICc8ZGl2IGlkPSJwb3B1cCIgY2xhc3M9ImZnbC1wb3B1cCBmZ2wtdmNlbnRlciI+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1oZWFkIj5GR0wgU0RLIDxzbWFsbD5HYW1lIFRlc3RpbmcgRnJhbWV3b3JrPC9zbWFsbD48L2Rpdj4nICsKICAgICAgICAnPGRpdiBjbGFzcz0iZmdsLXBvcHVwLWhlYWRzcGFjZXIiPjwvZGl2PicgKwogICAgICAgICc8cD5UaGUgR2FtZSBUZXN0aW5nIEZyYW1ld29yayBhbGxvd3MgeW91IHRvIHRlc3QgdGhlIHZhcmlvdXMgRkdMIFNESyBmZWF0dXJlcy48L3A+JyArCiAgICAgICAgJzxmaWVsZHNldD4nICsKICAgICAgICAnPGxlZ2VuZD5UZXN0IFNlc3Npb24gT3B0aW9uczo8L2xlZ2VuZD4nICsKICAgICAgICAnPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImZnbF9oaWRlTW9yZUdhbWVzIj4gRGlzYWJsZSBjcm9zcyBwcm9tb3Rpb248L2xhYmVsPicgKwogICAgICAgICc8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iZmdsX2hpZGVVbmxvY2tzIj4gRGlzYWJsZSBpbiBhcHAgdXBncmFkZTwvbGFiZWw+JyArCiAgICAgICAgJzxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJmZ2xfdW5sb2NrR2FtZSI+IEdhbWUgaXMgcHJlbWl1bSBtb2RlPC9sYWJlbD4nICsKICAgICAgICAnPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImZnbF9zcG9uc29yZWQiPiBTaG93IHNwb25zb3IgYnJhbmRpbmc8L2xhYmVsPicgKwogICAgICAgICc8L2ZpZWxkc2V0PicgKwogICAgICAgICc8ZGl2IGNsYXNzPSJmZ2wtcG9wdXAtYmlnZm9vdGVyIj4nICsKICAgICAgICAgICc8YSBjbGFzcz0iZmdsLXBvcHVwLWJpZ2J1dHRvbiIgaWQ9ImZnbF9zdGFydGdhbWVidXR0b24iPkxhdW5jaCBHYW1lPC9hPicgKwogICAgICAgICc8L2Rpdj4nICsKICAgICAgJzwvZGl2PicgKwogICAgICAnPC9kaXY+JzsKICAgIHJldHVybiBodG1sOwogIH0KICAKICBodG1sU3R5bGVDb250YWluZXIuY3JlYXRlUG9wdXAgPSBmdW5jdGlvbih0aXRsZSwgaHRtbCkgewogICAgdmFyIGh0bWwgPSAnPGRpdiBzdHlsZT0icG9zaXRpb246IGZpeGVkOyB0b3A6IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyBib3R0b206IDA7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwwLDAsMC44KTsgei1pbmRleDogMTAwMDA7IiBpZD0iZmdsX292ZXJsYXkiIG9ubW91c2Vkb3duPSJ2YXIgZSA9IGFyZ3VtZW50c1swXSB8fCB3aW5kb3cuZXZlbnQ7IGUuc3RvcFByb3BhZ2F0aW9uKCk7Ij4nICsKICAgICAgJzxkaXYgaWQ9InBvcHVwIiBjbGFzcz0iZmdsLXBvcHVwIGZnbC12Y2VudGVyIj4nICsKICAgICAgICAnPGRpdiBjbGFzcz0iZmdsLXBvcHVwLWhlYWQiPicgKwogICAgICAgIHRpdGxlICsKICAgICAgICAnPGEgaHJlZj0iIyIgY2xhc3M9ImZnbC1wb3B1cC1jbG9zZSIgaWQ9ImZnbF9jbG9zZWJ1dHRvbiI+JnRpbWVzOzwvYT48L2Rpdj4nICsKICAgICAgICAnPGRpdiBjbGFzcz0iZmdsLXBvcHVwLWhlYWRzcGFjZXIiPjwvZGl2PicgKwogICAgICAgIGh0bWwgKwogICAgICAnPC9kaXY+JyArCiAgICAgICc8L2Rpdj4nOwogICAgcmV0dXJuIGh0bWw7CiAgfQogIAogIGh0bWxTdHlsZUNvbnRhaW5lci5nZXRJYXBEaXYgPSBmdW5jdGlvbigpIHsKICAgIHZhciBodG1sID0gJzxkaXYgc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsgdG9wOiAwOyBsZWZ0OiAwOyByaWdodDogMDsgYm90dG9tOiAwOyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLDAuOCk7IHotaW5kZXg6IDEwMDAwOyIgaWQ9ImZnbF9vdmVybGF5IiBvbm1vdXNlZG93bj0idmFyIGUgPSBhcmd1bWVudHNbMF0gfHwgd2luZG93LmV2ZW50OyBlLnN0b3BQcm9wYWdhdGlvbigpOyI+JyArCiAgICAgICc8ZGl2IGlkPSJwb3B1cCIgY2xhc3M9ImZnbC1wb3B1cCBmZ2wtdmNlbnRlciI+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1oZWFkIj5FeGFtcGxlIEluLUFwcCBQdXJjaGFzZTxhIGhyZWY9IiMiIGNsYXNzPSJmZ2wtcG9wdXAtY2xvc2UiIGlkPSJmZ2xfY2xvc2VidXR0b24iPiZ0aW1lczs8L2E+PC9kaXY+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1oZWFkc3BhY2VyIj48L2Rpdj4nICsKICAgICAgICAnPHA+UHJlc3MgXCdVbmxvY2tcJyB0byBzaW11bGF0ZSBhIHN1Y2Nlc3NmdWwgaW4tYXBwIHB1cmNoYXNlLCBcJ0NhbmNlbFwnIG90aGVyd2lzZS48L3A+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1hY3Rpb25zIj4nICsKICAgICAgICAgICc8YSBjbGFzcz0iZmdsLXBvcHVwLWJ1dHRvbiIgaWQ9ImZnbF9pYXB1bmxvY2tidXR0b24iPlVubG9jazwvYT4nICsKICAgICAgICAgICc8YSBjbGFzcz0iZmdsLXBvcHVwLWJ1dHRvbiIgaWQ9ImZnbF9pYXBjYW5jZWxidXR0b24iPkNhbmNlbDwvYT4nICsKICAgICAgICAnPC9kaXY+JyArCiAgICAgICc8L2Rpdj4nICsKICAgICAgJzwvZGl2Pic7CiAgICByZXR1cm4gaHRtbDsKICB9CiAgCiAgaHRtbFN0eWxlQ29udGFpbmVyLmdldFNjb3JlRGl2ID0gZnVuY3Rpb24oc2NvcmUpIHsKICAgIHZhciBodG1sID0gJzxkaXYgc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsgdG9wOiAwOyBsZWZ0OiAwOyByaWdodDogMDsgYm90dG9tOiAwOyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLDAuOCk7IHotaW5kZXg6IDEwMDAwOyIgaWQ9ImZnbF9vdmVybGF5IiBvbm1vdXNlZG93bj0idmFyIGUgPSBhcmd1bWVudHNbMF0gfHwgd2luZG93LmV2ZW50OyBlLnN0b3BQcm9wYWdhdGlvbigpOyI+JyArCiAgICAgICc8ZGl2IGlkPSJwb3B1cCIgY2xhc3M9ImZnbC1wb3B1cCBmZ2wtcG9wdXAtc2NvcmUgZmdsLXZjZW50ZXIiPicgKwogICAgICAgICc8ZGl2IGNsYXNzPSJmZ2wtcG9wdXAtaGVhZCI+U3VibWl0IFlvdXIgU2NvcmU8YSBocmVmPSIjIiBjbGFzcz0iZmdsLXBvcHVwLWNsb3NlIiBpZD0iZmdsX2Nsb3NlYnV0dG9uIj4mdGltZXM7PC9hPjwvZGl2PicgKwogICAgICAgICc8ZGl2IGNsYXNzPSJmZ2wtcG9wdXAtaGVhZHNwYWNlciI+PC9kaXY+JyArCiAgICAgICAgJzxkaXYgY2xhc3M9ImZnbC1wb3B1cC1zdWJ0aXRsZSI+WW91ciBTY29yZTwvZGl2PicgKwogICAgICAgICc8ZGl2IGNsYXNzPSJmZ2wtcG9wdXAtc2NvcmVib3giPicgKyBzY29yZSArICc8L2Rpdj4nICsKICAgICAgICAnPGxhYmVsIGNsYXNzPSJmZ2wtcG9wdXAtcHJvbXB0bGFiZWwiPkVudGVyIHlvdXIgbmFtZTo8L2xhYmVsPicgKwogICAgICAgICc8ZGl2IGNsYXNzPSJmZ2wtcG9wdXAtZm9vdGVyIj4nICsKICAgICAgICAgICc8aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZnbC1wb3B1cC1wcm9tcHQiIGlkPSJmZ2xfc2NvcmVuYW1laW5wdXQiIG1heGxlbmd0aD0iMzAiPicgKwogICAgICAgICAgJzxhIGNsYXNzPSJmZ2wtcG9wdXAtYnV0dG9uIiBpZD0iZmdsX3Njb3Jlc3VibWl0YnV0dG9uIj5TdWJtaXQgJiN4MjVCODs8L2E+JyArCiAgICAgICAgJzwvZGl2PicgKwogICAgICAnPC9kaXY+JyArCiAgICAgICc8L2Rpdj4nOwogICAgcmV0dXJuIGh0bWw7CiAgfQogIAogIGh0bWxTdHlsZUNvbnRhaW5lci5nZXRJbWFnZU92ZXJsYXkgPSBmdW5jdGlvbihzcmMsIHdpZHRoLCBoZWlnaHQpIHsKICAgIHZhciBpbWdUYWdBdHRyaWJ1dGVzID0gJyc7CiAgICBpZiAod2lkdGgpIGltZ1RhZ0F0dHJpYnV0ZXMgKz0gJyB3aWR0aD0iJyArIHdpZHRoICsgJyInOwogICAgaWYgKGhlaWdodCkgaW1nVGFnQXR0cmlidXRlcyArPSAnIGhlaWdodD0iJyArIGhlaWdodCArICciJzsKICAgIHZhciBodG1sID0gJzxkaXYgc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsgdG9wOiAwOyBsZWZ0OiAwOyByaWdodDogMDsgYm90dG9tOiAwOyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLDAuOCk7IHotaW5kZXg6IDEwMDAwOyIgaWQ9ImZnbF9vdmVybGF5IiBvbm1vdXNlZG93bj0idmFyIGUgPSBhcmd1bWVudHNbMF0gfHwgd2luZG93LmV2ZW50OyBlLnN0b3BQcm9wYWdhdGlvbigpOyI+JyArCiAgICAgICc8YSBocmVmPSIjIiBjbGFzcz0iZmdsLXBvcHVwLWNsb3NlLWh1Z2UiIGlkPSJmZ2xfY2xvc2VidXR0b24iPiZ0aW1lczs8L2E+JyArCiAgICAgICc8ZGl2IGlkPSJpbWFnZSIgY2xhc3M9ImZnbC12Y2VudGVyIiBzdHlsZT0idGV4dC1hbGlnbjogY2VudGVyOyI+JyArCiAgICAgICAgJzxpbWcgc3JjPSInICsgc3JjICsgJyIgY2xhc3M9ImZnbC1pbWFnZS1vdmVybGF5IiBvbmxvYWQ9ImZnbC5odG1sSGVscGVycy5jaGVja1ZlcnRpY2FsQ2VudGVyaW5nKCk7IicgKyBpbWdUYWdBdHRyaWJ1dGVzICsgJyAvPicgKwogICAgICAnPC9kaXY+JyArCiAgICAgICc8L2Rpdj4nOwogICAgcmV0dXJuIGh0bWw7CiAgfQp9Ow==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 00:13:48 GMT",
                    "Content-Length": "29305",
                    "Date": "Fri, 07 Nov 2014 00:13:48 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}