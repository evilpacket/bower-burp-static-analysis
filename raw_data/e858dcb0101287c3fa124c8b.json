{
    "url": "http://localhost:9999/avoidwork/keigai/src/utility.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>location.href</b> and written to <b>the 'href' property of a DOM element</b> via the following statements:<ul><li>uri = !server ? location.href : \"\";</li><li>obj.href = uri;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/avoidwork/keigai/src/utility.js",
                "path": "/avoidwork/keigai/src/utility.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hdm9pZHdvcmsva2VpZ2FpL3NyYy91dGlsaXR5LmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjM3MzANCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDc6NTk6MTkgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA3OjU5OjE4IEdNVA0KDQovKioKICogQG5hbWVzcGFjZSB1dGlsaXR5CiAqLwp2YXIgdXRpbGl0eSA9IHsKCS8qKgoJICogQ29sbGVjdGlvbiBvZiB0aW1lcnMKCSAqCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHR5cGUge09iamVjdH0KCSAqIEBwcml2YXRlCgkgKi8KCXRpbWVyIDoge30sCgoJLyoqCgkgKiBDb2xsZWN0aW9uIG9mIHJlcGVhdGluZyBmdW5jdGlvbnMKCSAqCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHR5cGUge09iamVjdH0KCSAqIEBwcml2YXRlCgkgKi8KCXJlcGVhdGluZzoge30sCgoJLyoqCgkgKiBDcmVhdGVzIEVsZW1lbnRzIG9yIFF1ZXJpZXMgdGhlIERPTSB1c2luZyBDU1Mgc2VsZWN0b3JzCgkgKgoJICogQG1ldGhvZCAkCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7TWl4ZWR9IGFyZyBIVE1MLCBvciBDb21tYSBkZWxpbWl0ZWQgc3RyaW5nIG9mIENTUyBzZWxlY3RvcnMKCSAqIEByZXR1cm4ge0FycmF5fSAgICAgQXJyYXkgb2YgbWF0Y2hpbmcgRWxlbWVudHMKCSAqIEBleGFtcGxlCgkgKiB2YXIgJCA9IGtlaWdhaS51dGlsLiQ7CgkgKgoJICogLy8gTG9va2luZyBmb3IgRWxlbWVudHMKCSAqICQoICIuc29tZUNsYXNzIiApLmZvckVhY2goIGZ1bmN0aW9uICggaSApIHsKCSAqICAgLi4uCgkgKiB9ICk7CgkgKgoJICogLy8gQ3JlYXRpbmcgYW4gSDEgRWxlbWVudAoJICogJCggIiZsdDtoMSZndDsiICkuZm9yRWFjaCggZnVuY3Rpb24gKCBpICkgewoJICogICAuLi4KCSAqIH0gKTsKCSAqLwoJJCA6IGZ1bmN0aW9uICggYXJnICkgewoJCXZhciByZXN1bHQ7CgoJCS8vIE5vdGhpbmcKCQlpZiAoICFhcmcgKSB7CgkJfQoJCS8vIEhUTUwKCQllbHNlIGlmICggcmVnZXguaHRtbC50ZXN0KCBhcmcgKSApIHsKCQkJcmVzdWx0ID0gW2VsZW1lbnQuY3JlYXRlKCBhcmcgKV07CgkJfQoJCS8vIENTUyBzZWxlY3RvcihzKQoJCWVsc2UgewoJCQlhcmcgPSBzdHJpbmcudHJpbSggYXJnICk7CgoJCQlpZiAoIGFyZy5pbmRleE9mKCAiLCIgKSA9PT0gLTEgKSB7CgkJCQlyZXN1bHQgPSB1dGlsaXR5LmRvbSggYXJnICk7CgoJCQkJaWYgKCByZXN1bHQgKSB7CgkJCQkJaWYgKCBpc05hTiggcmVzdWx0Lmxlbmd0aCApICkgewoJCQkJCQlyZXN1bHQgPSBbcmVzdWx0XTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlyZXN1bHQgPSBbXTsKCQkJCX0KCQkJfQoJCQllbHNlIHsKCQkJCXJlc3VsdCA9IFtdOwoKCQkJCWFycmF5LmVhY2goIHN0cmluZy5leHBsb2RlKCBhcmcgKSwgZnVuY3Rpb24gKCBxdWVyeSApIHsKCQkJCQl2YXIgb2JqID0gdXRpbGl0eS5kb20oIHF1ZXJ5ICk7CgoJCQkJCWlmICggb2JqIGluc3RhbmNlb2YgQXJyYXkgKSB7CgkJCQkJCXJlc3VsdCA9IHJlc3VsdC5jb25jYXQoIG9iaiApOwoJCQkJCX0KCQkJCQllbHNlIGlmICggb2JqICkgewoJCQkJCQlyZXN1bHQucHVzaCggb2JqICk7CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoJfSwKCgkvKioKCSAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgQmFzZQoJICoKCSAqIEBtZXRob2QgYmFzZQoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge09iamVjdH0gYXJnIFtPcHRpb25hbF0gRGVjb3JhdGl2ZSBPYmplY3QKCSAqIEByZXR1cm4ge09iamVjdH0gICAgIEluc3RhbmNlIG9mIEJhc2UKCSAqLwoJYmFzZSA6IGZ1bmN0aW9uICggYXJnICkgewoJCXZhciBvYmogPSBuZXcgQmFzZSgpOwoKCQlpZiAoIGFyZyBpbnN0YW5jZW9mIE9iamVjdCApIHsKCQkJdXRpbGl0eS5tZXJnZSggb2JqLCBhcmcgKTsKCQl9CgoJCW9iai5vYnNlcnZlciA9IG9ic2VydmFibGUuZmFjdG9yeSgpOwoKCQlyZXR1cm4gb2JqOwoJfSwKCgkvKioKCSAqIEJsb2IgZmFjdG9yeQoJICoKCSAqIEBtZXRob2QgYmxvYgoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge1N0cmluZ30gYXJnIFN0cmluZyB0byBjb252ZXJ0IHRvIGEgQmxvYgoJICogQHJldHVybiB7T2JqZWN0fSAgICAgQmxvYgoJICogQHByaXZhdGUKCSAqLwoJYmxvYiA6IGZ1bmN0aW9uICggYXJnICkgewoJCXZhciBvYmo7CgoJCXRyeSB7CgkJCW9iaiA9IG5ldyBCbG9iKCBbYXJnXSwge3R5cGU6ICJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0In0gKTsKCQl9CgkJY2F0Y2ggKCBlICkgewoJCQlpZiAoICFnbG9iYWwuQmxvYkJ1aWxkZXIgKSB7CgkJCQlnbG9iYWwuQmxvYkJ1aWxkZXIgPSBnbG9iYWwuTVNCbG9iQnVpbGRlciB8fCBnbG9iYWwuV2ViS2l0QmxvYkJ1aWxkZXIgfHwgZ2xvYmFsLk1vekJsb2JCdWlsZGVyOwoJCQl9CgoJCQlvYmogPSBuZXcgZ2xvYmFsLkJsb2JCdWlsZGVyKCkuYXBwZW5kKCBhcmcgKS5nZXRCbG9iKCk7CgkJfQoKCQlyZXR1cm4gb2JqOwoJfSwKCgkvKioKCSAqIENsZWFycyBkZWZlcnJlZCAmIHJlcGVhdGluZyBmdW5jdGlvbnMKCSAqCgkgKiBAbWV0aG9kIGNsZWFyVGltZXJzCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7U3RyaW5nfSBpZCBJRCBvZiB0aW1lciggcyApCgkgKiBAcmV0dXJuIHtVbmRlZmluZWR9IHVuZGVmaW5lZAoJICogQHByaXZhdGUKCSAqLwoJY2xlYXJUaW1lcnMgOiBmdW5jdGlvbiAoIGlkICkgewoJCWlmICggaWQgPT09IHVuZGVmaW5lZCB8fCBzdHJpbmcuaXNFbXB0eSggaWQgKSApIHsKCQkJdGhyb3cgbmV3IEVycm9yKCBsYWJlbC5pbnZhbGlkQXJndW1lbnRzICk7CgkJfQoKCQkvLyBkZWZlcnJlZAoJCWlmICggdXRpbGl0eS50aW1lcltpZF0gKSB7CgkJCWNsZWFyVGltZW91dCggdXRpbGl0eS50aW1lcltpZF0gKTsKCQkJZGVsZXRlIHV0aWxpdHkudGltZXJbaWRdOwoJCX0KCgkJLy8gcmVwZWF0aW5nCgkJaWYgKCB1dGlsaXR5LnJlcGVhdGluZ1tpZF0gKSB7CgkJCWNsZWFyVGltZW91dCggdXRpbGl0eS5yZXBlYXRpbmdbaWRdICk7CgkJCWRlbGV0ZSB1dGlsaXR5LnJlcGVhdGluZ1tpZF07CgkJfQoJfSwKCgkvKioKCSAqIENsb25lcyBhbiBPYmplY3QKCSAqCgkgKiBAbWV0aG9kIGNsb25lCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7T2JqZWN0fSAgb2JqICAgICBPYmplY3QgdG8gY2xvbmUKCSAqIEBwYXJhbSAge0Jvb2xlYW59IHNoYWxsb3cgW09wdGlvbmFsXSBDcmVhdGUgYSBzaGFsbG93IGNsb25lLCB3aGljaCBkb2Vzbid0IG1haW50YWluIHByb3RvdHlwZXMsIGRlZmF1bHQgaXMgYGZhbHNlYAoJICogQHJldHVybiB7T2JqZWN0fSAgICAgICAgICBDbG9uZSBvZiBvYmoKCSAqIEBleGFtcGxlCgkgKiB2YXIgeCA9IHthOiB0cnVlLCBiOiBmYWxzZX0sCgkgKiAgICAgeSA9IGtlaWdhaS51dGlsLmNsb25lKCB4LCB0cnVlICk7CgkgKgoJICogeS5hOyAvLyB0cnVlCgkgKi8KCWNsb25lIDogZnVuY3Rpb24gKCBvYmosIHNoYWxsb3cgKSB7CgkJdmFyIGNsb25lOwoKCQlpZiAoIHNoYWxsb3cgPT09IHRydWUgKSB7CgkJCXJldHVybiBvYmogIT09IHVuZGVmaW5lZCAmJiBvYmogIT09IG51bGwgPyBqc29uLmRlY29kZSgganNvbi5lbmNvZGUoIG9iaiApICkgOiBvYmo7CgkJfQoJCWVsc2UgaWYgKCAhb2JqIHx8IHJlZ2V4LnByaW1pdGl2ZS50ZXN0KCB0eXBlb2Ygb2JqICkgfHwgKCBvYmogaW5zdGFuY2VvZiBSZWdFeHAgKSApIHsKCQkJcmV0dXJuIG9iajsKCQl9CgkJZWxzZSBpZiAoIG9iaiBpbnN0YW5jZW9mIEFycmF5ICkgewoJCQlyZXR1cm4gb2JqLnNsaWNlKCk7CgkJfQoJCWVsc2UgaWYgKCAhc2VydmVyICYmICFjbGllbnQuaWUgJiYgb2JqIGluc3RhbmNlb2YgRG9jdW1lbnQgKSB7CgkJCXJldHVybiB4bWwuZGVjb2RlKCB4bWwuZW5jb2RlKCBvYmogKSApOwoJCX0KCQllbHNlIGlmICggdHlwZW9mIG9iai5fX3Byb3RvX18gIT0gInVuZGVmaW5lZCIgKSB7CgkJCXJldHVybiB1dGlsaXR5LmV4dGVuZCggb2JqLl9fcHJvdG9fXywgb2JqICk7CgkJfQoJCWVsc2UgaWYgKCBvYmogaW5zdGFuY2VvZiBPYmplY3QgKSB7CgkJCS8vIElmIEpTT04gZW5jb2RpbmcgZmFpbHMgZHVlIHRvIHJlY3Vyc2lvbiwgdGhlIG9yaWdpbmFsIE9iamVjdCBpcyByZXR1cm5lZCBiZWNhdXNlIGl0J3MgYXNzdW1lZCB0aGlzIGlzIGZvciBkZWNvcmF0aW9uCgkJCWNsb25lID0ganNvbi5lbmNvZGUoIG9iaiwgdHJ1ZSApOwoKCQkJaWYgKCBjbG9uZSAhPT0gdW5kZWZpbmVkICkgewoJCQkJY2xvbmUgPSBqc29uLmRlY29kZSggY2xvbmUgKTsKCgkJCQkvLyBEZWNvcmF0aW5nIEZ1bmN0aW9ucyB0aGF0IHdvdWxkIGJlIGxvc3Qgd2l0aCBKU09OIGVuY29kaW5nL2RlY29kaW5nCgkJCQl1dGlsaXR5Lml0ZXJhdGUoIG9iaiwgZnVuY3Rpb24gKCB2LCBrICkgewoJCQkJCWlmICggdHlwZW9mIHYgPT0gImZ1bmN0aW9uIiApIHsKCQkJCQkJY2xvbmVba10gPSB2OwoJCQkJCX0KCQkJCX0gKTsKCQkJfQoJCQllbHNlIHsKCQkJCWNsb25lID0gb2JqOwoJCQl9CgoJCQlyZXR1cm4gY2xvbmU7CgkJfQoJCWVsc2UgewoJCQlyZXR1cm4gb2JqOwoJCX0KCX0sCgoJLyoqCgkgKiBDb2VyY2VzIGEgU3RyaW5nIHRvIGEgVHlwZQoJICoKCSAqIEBtZXRob2QgY29lcmNlCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7U3RyaW5nfSB2YWx1ZSBTdHJpbmcgdG8gY29lcmNlCgkgKiBAcmV0dXJuIHtNaXhlZH0gICAgICAgIFByaW1pdGl2ZSB2ZXJzaW9uIG9mIHRoZSBTdHJpbmcKCSAqIEBleGFtcGxlCgkgKiBrZWlnYWkudXRpbC5jb2VyY2UoICIxIiApOyAvLyAxCgkgKi8KCWNvZXJjZSA6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgkJdmFyIHRtcDsKCgkJaWYgKCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkICkgewoJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCX0KCQllbHNlIGlmICggdmFsdWUgPT09ICJ0cnVlIiApIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJCWVsc2UgaWYgKCB2YWx1ZSA9PT0gImZhbHNlIiApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQllbHNlIGlmICggdmFsdWUgPT09ICJudWxsIiApIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoJCWVsc2UgaWYgKCB2YWx1ZSA9PT0gInVuZGVmaW5lZCIgKSB7CgkJCXJldHVybiB1bmRlZmluZWQ7CgkJfQoJCWVsc2UgaWYgKCB2YWx1ZSA9PT0gIiIgKSB7CgkJCXJldHVybiB2YWx1ZTsKCQl9CgkJZWxzZSBpZiAoICFpc05hTiggdG1wID0gTnVtYmVyKCB2YWx1ZSApICkgKSB7CgkJCXJldHVybiB0bXA7CgkJfQoJCWVsc2UgaWYgKCByZWdleC5qc29uX3dyYXAudGVzdCggdmFsdWUgKSApIHsKCQkJcmV0dXJuIGpzb24uZGVjb2RlKCB2YWx1ZSwgdHJ1ZSApIHx8IHZhbHVlOwoJCX0KCQllbHNlIHsKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCX0sCgoJLyoqCgkgKiBSZWNvbXBpbGVzIGEgUmVnRXhwIGJ5IHJlZmVyZW5jZQoJICoKCSAqIFRoaXMgaXMgaWRlYWwgd2hlbiB5b3UgbmVlZCB0byByZWNvbXBpbGUgYSByZWdleCBmb3IgdXNlIHdpdGhpbiBhIGNvbmRpdGlvbmFsIHN0YXRlbWVudAoJICoKCSAqIEBtZXRob2QgY29tcGlsZQoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge09iamVjdH0gcmVnZXggICAgIFJlZ0V4cAoJICogQHBhcmFtICB7U3RyaW5nfSBwYXR0ZXJuICAgUmVndWxhciBleHByZXNzaW9uIHBhdHRlcm4KCSAqIEBwYXJhbSAge1N0cmluZ30gbW9kaWZpZXJzIE1vZGlmaWVycyB0byBhcHBseSB0byB0aGUgcGF0dGVybgoJICogQHJldHVybiB7Qm9vbGVhbn0gICAgICAgICAgdHJ1ZQoJICogQHByaXZhdGUKCSAqLwoJY29tcGlsZSA6IGZ1bmN0aW9uICggcmVnLCBwYXR0ZXJuLCBtb2RpZmllcnMgKSB7CgkJcmVnLmNvbXBpbGUoIHBhdHRlcm4sIG1vZGlmaWVycyApOwoKCQlyZXR1cm4gdHJ1ZTsKCX0sCgoJLyoqCgkgKiBDdXJyaWVzIGEgRnVuY3Rpb24KCSAqCgkgKiBOb3RlOiBGdW5jdGlvbiB0byBjdXJyeSBtdXN0IHJldHVybiBhIEZ1bmN0aW9uCgkgKgoJICogQG1ldGhvZCBjdXJyeQoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEByZXR1cm4ge0Z1bmN0aW9ufSBDdXJyaWVkIEZ1bmN0aW9uCgkgKiBAZXhhbXBsZQoJICogZnVuY3Rpb24gZiAoIGEsIGIgKSB7CgkgKiAgIHJldHVybiBmdW5jdGlvbiAoIG4gKSB7CgkgKiAgICAgcmV0dXJuICggYSArIGIgKSAqIG47CgkgKiAgIH07CgkgKiB9CgkgKgoJICogdmFyIGcgPSBrZWlnYWkudXRpbC5jdXJyeSggZiwgMiwgOCApOwoJICoKCSAqIGcoIDUgKTsgLy8gNTAKCSAqLwoJY3VycnkgOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGFyZ3MgPSBhcnJheS5jYXN0KCBhcmd1bWVudHMgKSwKCQkgICAgZm4gICA9IGFyZ3Muc2hpZnQoKSwKCQkgICAgY2ZuICA9IGZuLmFwcGx5KCBmbiwgYXJncyApOwoKCQlyZXR1cm4gZnVuY3Rpb24gKCkgewoJCQlyZXR1cm4gY2ZuLmFwcGx5KCBjZm4sIGFyZ3VtZW50cyApOwoJCX07Cgl9LAoKCS8qKgoJICogRGVmZXJzIHRoZSBleGVjdXRpb24gb2YgRnVuY3Rpb24gYnkgYXQgbGVhc3QgdGhlIHN1cHBsaWVkIG1pbGxpc2Vjb25kcy4KCSAqIFRpbWluZyBtYXkgdmFyeSB1bmRlciAiaGVhdnkgbG9hZCIgcmVsYXRpdmUgdG8gdGhlIENQVSAmIGNsaWVudCBKYXZhU2NyaXB0IGVuZ2luZS4KCSAqCgkgKiBAbWV0aG9kIGRlZmVyCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7RnVuY3Rpb259IGZuICAgICBGdW5jdGlvbiB0byBkZWZlciBleGVjdXRpb24gb2YKCSAqIEBwYXJhbSAge051bWJlcn0gICBtcyAgICAgTWlsbGlzZWNvbmRzIHRvIGRlZmVyIGV4ZWN1dGlvbgoJICogQHBhcmFtICB7TnVtYmVyfSAgIGlkICAgICBbT3B0aW9uYWxdIElEIG9mIHRoZSBkZWZlcnJlZCBmdW5jdGlvbgoJICogQHBhcmFtICB7Qm9vbGVhbn0gIHJlcGVhdCBbT3B0aW9uYWxdIERlc2NyaWJlcyB0aGUgZXhlY3V0aW9uLCBkZWZhdWx0IGlzIGBmYWxzZWAKCSAqIEByZXR1cm4ge1N0cmluZ30gICAgICAgICAgSUQgb2YgdGhlIHRpbWVyCgkgKiBAcHJpdmF0ZQoJICovCglkZWZlciA6IGZ1bmN0aW9uICggZm4sIG1zLCBpZCwgcmVwZWF0ICkgewoJCXZhciBvcDsKCgkJbXMgICAgID0gbXMgfHwgMDsKCQlyZXBlYXQgPSAoIHJlcGVhdCA9PT0gdHJ1ZSApOwoKCQlpZiAoIGlkICE9PSB1bmRlZmluZWQgKSB7CgkJCXV0aWxpdHkuY2xlYXJUaW1lcnMoIGlkICk7CgkJfQoJCWVsc2UgewoJCQlpZCA9IHV0aWxpdHkudXVpZCggdHJ1ZSApOwoJCX0KCgkJb3AgPSBmdW5jdGlvbiAoKSB7CgkJCXV0aWxpdHkuY2xlYXJUaW1lcnMoIGlkICk7CgkJCWZuKCk7CgkJfTsKCgkJdXRpbGl0eVtyZXBlYXQgPyAicmVwZWF0aW5nIiA6ICJ0aW1lciJdW2lkXSA9IHNldFRpbWVvdXQoIG9wLCBtcyApOwoKCQlyZXR1cm4gaWQ7Cgl9LAoKCS8qKgoJICogQXN5bmMgZGVsYXkgc3RyYXRlZ3kKCSAqCgkgKiBAbWV0aG9kIGRlbGF5CgkgKiBAbWVtYmVyT2YgcHJvbWlzZQoJICogQHJldHVybiB7RnVuY3Rpb259IERlbGF5IG1ldGhvZAoJICogQHByaXZhdGUKCSAqLwoJZGVsYXkgOiBmdW5jdGlvbiAoKSB7CgkJaWYgKCB0eXBlb2Ygc2V0SW1tZWRpYXRlICE9ICJ1bmRlZmluZWQiICkgewoJCQlyZXR1cm4gZnVuY3Rpb24gKCBhcmcgKSB7CgkJCQlzZXRJbW1lZGlhdGUoIGFyZyApOwoJCQl9OwoJCX0KCQllbHNlIGlmICggdHlwZW9mIHByb2Nlc3MgIT0gInVuZGVmaW5lZCIgKSB7CgkJCXJldHVybiBwcm9jZXNzLm5leHRUaWNrOwoJCX0KCQllbHNlIHsKCQkJcmV0dXJuIGZ1bmN0aW9uICggYXJnICkgewoJCQkJc2V0VGltZW91dCggYXJnLCAwICk7CgkJCX07CgkJfQoJfSgpLAoKCS8qKgoJICogUXVlcmllcyBET00gd2l0aCBmYXN0ZXN0IG1ldGhvZAoJICoKCSAqIEBtZXRob2QgZG9tCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7U3RyaW5nfSBhcmcgRE9NIHF1ZXJ5CgkgKiBAcmV0dXJuIHtNaXhlZH0gICAgICB1bmRlZmluZWQsIEVsZW1lbnQsIG9yIEFycmF5IG9mIEVsZW1lbnRzCgkgKiBAcHJpdmF0ZQoJICovCglkb20gOiBmdW5jdGlvbiAoIGFyZyApIHsKCQl2YXIgcmVzdWx0OwoKCQlpZiAoICFyZWdleC5zZWxlY3Rvcl9jb21wbGV4LnRlc3QoIGFyZyApICkgewoJCQlpZiAoIHJlZ2V4Lmhhc2gudGVzdCggYXJnICkgKSB7CgkJCQlyZXN1bHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggYXJnLnJlcGxhY2UoIHJlZ2V4Lmhhc2gsICIiICkgKSB8fCB1bmRlZmluZWQ7CgkJCX0KCQkJZWxzZSBpZiAoIHJlZ2V4LmtsYXNzLnRlc3QoIGFyZyApICkgewoJCQkJcmVzdWx0ID0gYXJyYXkuY2FzdCggZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggYXJnLnJlcGxhY2UoIHJlZ2V4LmtsYXNzLCAiIiApICkgKTsKCQkJfQoJCQllbHNlIGlmICggcmVnZXgud29yZC50ZXN0KCBhcmcgKSApIHsKCQkJCXJlc3VsdCA9IGFycmF5LmNhc3QoIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCBhcmcgKSApOwoJCQl9CgkJCWVsc2UgewoJCQkJcmVzdWx0ID0gYXJyYXkuY2FzdCggZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCggYXJnICkgKTsKCQkJfQoJCX0KCQllbHNlIHsKCQkJcmVzdWx0ID0gYXJyYXkuY2FzdCggZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCggYXJnICkgKTsKCQl9CgoJCXJldHVybiByZXN1bHQ7Cgl9LAoKCS8qKgoJICogRW5jb2RlcyBhIFVVSUQgdG8gYSBET00gZnJpZW5kbHkgSUQKCSAqCgkgKiBAbWV0aG9kIGRvbUlkCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7U3RyaW5nfSBVVUlECgkgKiBAcmV0dXJuIHtTdHJpbmd9IERPTSBmcmllbmRseSBJRAoJICogQHByaXZhdGUKCSAqLwoJZG9tSWQgOiBmdW5jdGlvbiAoIGFyZyApIHsKCQlyZXR1cm4gImEiICsgYXJnLnJlcGxhY2UoIC8tL2csICIiICkuc2xpY2UoIDEgKTsKCX0sCgoJLyoqCgkgKiBFcnJvciBoYW5kbGluZywgd2l0aCBoaXN0b3J5IGluIGBlcnJvci5sb2dgCgkgKgoJICogQG1ldGhvZCBlcnJvcgoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge01peGVkfSAgIGUgICAgICAgRXJyb3Igb2JqZWN0IG9yIG1lc3NhZ2UgdG8gZGlzcGxheQoJICogQHBhcmFtICB7QXJyYXl9ICAgYXJncyAgICBBcnJheSBvZiBhcmd1bWVudHMgZnJvbSB0aGUgY2FsbHN0YWNrCgkgKiBAcGFyYW0gIHtNaXhlZH0gICBzY29wZSAgIEVudGl0eSB0aGF0IHdhcyAidGhpcyIKCSAqIEBwYXJhbSAge0Jvb2xlYW59IHdhcm5pbmcgW09wdGlvbmFsXSBXaWxsIGRpc3BsYXkgYXMgY29uc29sZSB3YXJuaW5nIGlmIHRydWUKCSAqIEByZXR1cm4ge1VuZGVmaW5lZH0gICAgICAgdW5kZWZpbmVkCgkgKiBAcHJpdmF0ZQoJICovCgllcnJvciA6IGZ1bmN0aW9uICggZSwgYXJncywgc2NvcGUsIHdhcm5pbmcgKSB7CgkJdmFyIG8gPSB7CgkJCSJhcmd1bWVudHMiIDogYXJncyA/IGFycmF5LmNhc3QoIGFyZ3MgKSA6IFtdLAoJCQltZXNzYWdlICAgICA6IGUubWVzc2FnZSB8fCBlLAoJCQludW1iZXIgICAgICA6IGUubnVtYmVyID8gKCBlLm51bWJlciAmIDB4RkZGRiApIDogdW5kZWZpbmVkLAoJCQlzY29wZSAgICAgICA6IHNjb3BlLAoJCQlzdGFjayAgICAgICA6IGUuc3RhY2sgfHwgdW5kZWZpbmVkLAoJCQl0aW1lc3RhbXAgICA6IG5ldyBEYXRlKCkudG9VVENTdHJpbmcoKSwKCQkJdHlwZSAgICAgICAgOiBlLnR5cGUgfHwgIlR5cGVFcnJvciIKCQl9OwoKCQl1dGlsaXR5LmxvZyggby5zdGFjayB8fCBvLm1lc3NhZ2UsIHdhcm5pbmcgIT09IHRydWUgPyAiZXJyb3IiIDogIndhcm4iICk7CgoJCXJldHVybiB1bmRlZmluZWQ7Cgl9LAoKCS8qKgoJICogQ3JlYXRlcyBhICJjbGFzcyIgZXh0ZW5kaW5nIE9iamVjdCwgd2l0aCBvcHRpb25hbCBkZWNvcmF0aW9uCgkgKgoJICogQG1ldGhvZCBleHRlbmQKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtPYmplY3R9IG9iaiBPYmplY3QgdG8gZXh0ZW5kCgkgKiBAcGFyYW0gIHtPYmplY3R9IGFyZyBbT3B0aW9uYWxdIE9iamVjdCBmb3IgZGVjb3JhdGlvbgoJICogQHJldHVybiB7T2JqZWN0fSAgICAgRGVjb3JhdGVkIG9iagoJICogQGV4YW1wbGUKCSAqIHZhciBleHRlbmRPYmogPSBrZWlnYWkudXRpbC5leHRlbmQoIHNvbWVPYmosIHtuZXdQcm9wZXJ0eTogdmFsdWV9ICk7CgkgKi8KCWV4dGVuZCA6IGZ1bmN0aW9uICggb2JqLCBhcmcgKSB7CgkJdmFyIG87CgoJCWlmICggb2JqID09PSB1bmRlZmluZWQgKSB7CgkJCXRocm93IG5ldyBFcnJvciggbGFiZWwuaW52YWxpZEFyZ3VtZW50cyApOwoJCX0KCgkJbyA9IE9iamVjdC5jcmVhdGUoIG9iaiApOwoKCQlpZiAoIGFyZyBpbnN0YW5jZW9mIE9iamVjdCApIHsKCQkJdXRpbGl0eS5tZXJnZSggbywgYXJnICk7CgkJfQoKCQlyZXR1cm4gbzsKCX0sCgoJLyoqCgkgKiBHZW5lcmF0ZXMgYW4gSUQgdmFsdWUKCSAqCgkgKiBAbWV0aG9kIGdlbklkCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7TWl4ZWR9ICAgb2JqIFtPcHRpb25hbF0gT2JqZWN0IHRvIHJlY2VpdmUgaWQKCSAqIEBwYXJhbSAge0Jvb2xlYW59IGRvbSBbT3B0aW9uYWxdIFZlcmlmeSB0aGUgSUQgaXMgdW5pcXVlIGluIHRoZSBET00sIGRlZmF1bHQgaXMgZmFsc2UKCSAqIEByZXR1cm4ge01peGVkfSAgICAgICBPYmplY3Qgb3IgaWQKCSAqIEBwcml2YXRlCgkgKi8KCWdlbklkIDogZnVuY3Rpb24gKCBvYmosIGRvbSApIHsKCQlkb20gPSAoIGRvbSA9PT0gdHJ1ZSApOwoJCXZhciBpZDsKCgkJaWYgKCBvYmogJiYgKCBvYmouaWQgfHwgKCBvYmogaW5zdGFuY2VvZiBBcnJheSApIHx8ICggdHlwZW9mIG9iaiA9PSAic3RyaW5nIiB8fCBvYmogaW5zdGFuY2VvZiBTdHJpbmcgKSApICkgewoJCQlyZXR1cm4gb2JqOwoJCX0KCgkJaWYgKCBkb20gKSB7CgkJCWRvIHsKCQkJCWlkID0gdXRpbGl0eS5kb21JZCggdXRpbGl0eS51dWlkKCB0cnVlICkgKTsKCQkJfQoJCQl3aGlsZSAoIHV0aWxpdHkuZG9tKCAiIyIgKyBpZCApICk7CgkJfQoJCWVsc2UgewoJCQlpZCA9IHV0aWxpdHkuZG9tSWQoIHV0aWxpdHkudXVpZCggdHJ1ZSApICk7CgkJfQoKCQlpZiAoIHR5cGVvZiBvYmogPT0gIm9iamVjdCIgKSB7CgkJCW9iai5pZCA9IGlkOwoKCQkJcmV0dXJuIG9iajsKCQl9CgkJZWxzZSB7CgkJCXJldHVybiBpZDsKCQl9Cgl9LAoKCS8qKgoJICogSXRlcmF0ZXMgYW4gT2JqZWN0IGFuZCBleGVjdXRlcyBhIGZ1bmN0aW9uIGFnYWluc3QgdGhlIHByb3BlcnRpZXMuCgkgKiBSZXR1cm5pbmcgYGZhbHNlYCBoYWx0cyBpdGVyYXRpb24uCgkgKgoJICogQG1ldGhvZCBpdGVyYXRlCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7T2JqZWN0fSAgIG9iaiBPYmplY3QgdG8gaXRlcmF0ZQoJICogQHBhcmFtICB7RnVuY3Rpb259IGZuICBGdW5jdGlvbiB0byBleGVjdXRlIGFnYWluc3QgcHJvcGVydGllcwoJICogQHJldHVybiB7T2JqZWN0fSAgICAgICBPYmplY3QKCSAqIEBleGFtcGxlCgkgKiBrZWlnYWkudXRpbC5pdGVyYXRlKCB7Li4ufSwgZnVuY3Rpb24gKCB2YWx1ZSwga2V5ICkgewoJICogICAuLi4KCSAqIH0gKTsKCSAqLwoJaXRlcmF0ZSA6IGZ1bmN0aW9uICggb2JqLCBmbiApIHsKCQlpZiAoIHR5cGVvZiBmbiAhPSAiZnVuY3Rpb24iICkgewoJCQl0aHJvdyBuZXcgRXJyb3IoIGxhYmVsLmludmFsaWRBcmd1bWVudHMgKTsKCQl9CgoJCWFycmF5LmVhY2goIE9iamVjdC5rZXlzKCBvYmogKSwgZnVuY3Rpb24gKCBpICkgewoJCQlyZXR1cm4gZm4uY2FsbCggb2JqLCBvYmpbaV0sIGkgKTsKCQl9ICk7CgoJCXJldHVybiBvYmo7Cgl9LAoKCS8qKgoJICogV3JpdGVzIGFyZ3VtZW50IHRvIHRoZSBjb25zb2xlCgkgKgoJICogQG1ldGhvZCBsb2cKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtTdHJpbmd9IGFyZyAgICBTdHJpbmcgdG8gd3JpdGUgdG8gdGhlIGNvbnNvbGUKCSAqIEBwYXJhbSAge1N0cmluZ30gdGFyZ2V0IFtPcHRpb25hbF0gVGFyZ2V0IGNvbnNvbGUsIGRlZmF1bHQgaXMgImxvZyIKCSAqIEByZXR1cm4ge1VuZGVmaW5lZH0gICAgIHVuZGVmaW5lZAoJICogQGV4YW1wbGUKCSAqIGtlaWdhaS51dGlsLmxvZyggIlNvbWV0aGluZyBiYWQgaGFwcGVuZWQiLCAid2FybiIgKTsKCSAqLwoJbG9nIDogZnVuY3Rpb24gKCBhcmcsIHRhcmdldCApIHsKCQl2YXIgdHMsIG1zZzsKCgkJaWYgKCB0eXBlb2YgY29uc29sZSAhPSAidW5kZWZpbmVkIiApIHsKCQkJdHMgID0gdHlwZW9mIGFyZyAhPSAib2JqZWN0IjsKCQkJbXNnID0gdHMgPyAiWyIgKyBuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygpICsgIl0gIiArIGFyZyA6IGFyZzsKCQkJY29uc29sZVt0YXJnZXQgfHwgImxvZyJdKCBtc2cgKTsKCQl9Cgl9LAoKCS8qKgoJICogTWVyZ2VzIG9iaiB3aXRoIGFyZwoJICoKCSAqIEBtZXRob2QgbWVyZ2UKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtPYmplY3R9IG9iaiBPYmplY3QgdG8gZGVjb3JhdGUKCSAqIEBwYXJhbSAge09iamVjdH0gYXJnIERlY29yYXRpb24KCSAqIEByZXR1cm4ge09iamVjdH0gICAgIERlY29yYXRlZCBPYmplY3QKCSAqIEBleGFtcGxlCgkgKiB2YXIgb2JqID0ge2E6IHRydWV9OwoJICoKCSAqIGtlaWdhaS51dGlsLm1lcmdlKCBvYmosIHtiOiBmYWxzZX0gKQoJICogb2JqLmI7IC8vIGZhbHNlCgkgKi8KCW1lcmdlIDogZnVuY3Rpb24gKCBvYmosIGFyZyApIHsKCQl1dGlsaXR5Lml0ZXJhdGUoIGFyZywgZnVuY3Rpb24gKCB2LCBrICkgewoJCQlpZiAoICggb2JqW2tdIGluc3RhbmNlb2YgQXJyYXkgKSAmJiAoIHYgaW5zdGFuY2VvZiBBcnJheSApICkgewoJCQkJYXJyYXkubWVyZ2UoIG9ialtrXSwgdiApOwoJCQl9CgkJCWVsc2UgaWYgKCAoIG9ialtrXSBpbnN0YW5jZW9mIE9iamVjdCApICYmICggdiBpbnN0YW5jZW9mIE9iamVjdCApICkgewoJCQkJdXRpbGl0eS5pdGVyYXRlKCB2LCBmdW5jdGlvbiAoIHgsIHkgKSB7CgkJCQkJb2JqW2tdW3ldID0gdXRpbGl0eS5jbG9uZSggeCApOwoJCQkJfSApOwoJCQl9CgkJCWVsc2UgewoJCQkJb2JqW2tdID0gdXRpbGl0eS5jbG9uZSggdiApOwoJCQl9CgkJfSApOwoKCQlyZXR1cm4gb2JqOwoJfSwKCgkvKioKCSAqIFBhcnNlcyBhIFVSSSBpbnRvIGFuIE9iamVjdAoJICoKCSAqIEBtZXRob2QgcGFyc2UKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtTdHJpbmd9IHVyaSBVUkkgdG8gcGFyc2UKCSAqIEByZXR1cm4ge09iamVjdH0gICAgIFBhcnNlZCBVUkkKCSAqIEBleGFtcGxlCgkgKiB2YXIgcGFyc2VkID0ga2VpZ2FpLnV0aWwucGFyc2UoIGxvY2F0aW9uLmhyZWYgKTsKCSAqCgkgKiBwYXJzZWQ7CgkgKiB7CgkgKiAgIGF1dGggICAgIDogIiIsCgkgKiAgIGhhc2ggICAgIDogIiIsCgkgKiAgIGhvc3QgICAgIDogIiIsCgkgKiAgIGhvc3RuYW1lIDogIiIsCgkgKiAgIHF1ZXJ5ICAgIDoge30sCgkgKiAgIHBhdGhuYW1lIDogIiIsCgkgKiAgIHBvcnQgICAgIDogbiwKCSAqICAgcHJvdG9jb2wgOiAiIiwKCSAqICAgc2VhcmNoICAgOiAiIiwKCSAqIH0KCSAqLwoJcGFyc2UgOiBmdW5jdGlvbiAoIHVyaSApIHsKCQl2YXIgb2JqICAgID0ge30sCgkJICAgIHBhcnNlZCA9IHt9OwoKCQlpZiAoIHVyaSA9PT0gdW5kZWZpbmVkICkgewoJCQl1cmkgPSAhc2VydmVyID8gbG9jYXRpb24uaHJlZiA6ICIiOwoJCX0KCgkJaWYgKCAhc2VydmVyICkgewoJCQlvYmogPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiYSIgKTsKCQkJb2JqLmhyZWYgPSB1cmk7CgkJfQoJCWVsc2UgewoJCQlvYmogPSB1cmwucGFyc2UoIHVyaSApOwoJCX0KCgkJaWYgKCBzZXJ2ZXIgKSB7CgkJCXV0aWxpdHkuaXRlcmF0ZSggb2JqLCBmdW5jdGlvbiAoIHYsIGsgKSB7CgkJCQlpZiAoIHYgPT09IG51bGwgKSB7CgkJCQkJb2JqW2tdID0gdW5kZWZpbmVkOwoJCQkJfQoJCQl9ICk7CgkJfQoKCQlwYXJzZWQgPSB7CgkJCWF1dGggICAgIDogc2VydmVyID8gbnVsbCA6IHJlZ2V4LmF1dGguZXhlYyggdXJpICksCgkJCXByb3RvY29sIDogb2JqLnByb3RvY29sIHx8ICJodHRwOiIsCgkJCWhvc3RuYW1lIDogb2JqLmhvc3RuYW1lIHx8ICJsb2NhbGhvc3QiLAoJCQlwb3J0ICAgICA6IG9iai5wb3J0ID8gbnVtYmVyLnBhcnNlKCBvYmoucG9ydCwgMTAgKSA6ICIiLAoJCQlwYXRobmFtZSA6IG9iai5wYXRobmFtZSwKCQkJc2VhcmNoICAgOiBvYmouc2VhcmNoICAgfHwgIiIsCgkJCWhhc2ggICAgIDogb2JqLmhhc2ggICAgIHx8ICIiLAoJCQlob3N0ICAgICA6IG9iai5ob3N0ICAgICB8fCAibG9jYWxob3N0IgoJCX07CgoJCS8vICdjYXVzZSBJRSBpcyAuLi4gSUU7IHJlcXVpcmVkIGZvciBkYXRhLmJhdGNoKCkKCQlpZiAoIGNsaWVudC5pZSApIHsKCQkJaWYgKCBwYXJzZWQucHJvdG9jb2wgPT09ICI6IiApIHsKCQkJCXBhcnNlZC5wcm90b2NvbCA9IGxvY2F0aW9uLnByb3RvY29sOwoJCQl9CgoJCQlpZiAoIHN0cmluZy5pc0VtcHR5KCBwYXJzZWQuaG9zdG5hbWUgKSApIHsKCQkJCXBhcnNlZC5ob3N0bmFtZSA9IGxvY2F0aW9uLmhvc3RuYW1lOwoJCQl9CgoJCQlpZiAoIHN0cmluZy5pc0VtcHR5KCBwYXJzZWQuaG9zdCApICkgewoJCQkJcGFyc2VkLmhvc3QgPSBsb2NhdGlvbi5ob3N0OwoJCQl9CgoJCQlpZiAoIHBhcnNlZC5wYXRobmFtZS5jaGFyQXQoIDAgKSAhPT0gIi8iICkgewoJCQkJcGFyc2VkLnBhdGhuYW1lID0gIi8iICsgcGFyc2VkLnBhdGhuYW1lOwoJCQl9CgkJfQoKCQlwYXJzZWQuYXV0aCAgPSBvYmouYXV0aCB8fCAoIHBhcnNlZC5hdXRoID09PSBudWxsID8gIiIgOiBwYXJzZWQuYXV0aFsxXSApOwoJCXBhcnNlZC5ocmVmICA9IG9iai5ocmVmIHx8ICggcGFyc2VkLnByb3RvY29sICsgIi8vIiArICggc3RyaW5nLmlzRW1wdHkoIHBhcnNlZC5hdXRoICkgPyAiIiA6IHBhcnNlZC5hdXRoICsgIkAiICkgKyBwYXJzZWQuaG9zdCArIHBhcnNlZC5wYXRobmFtZSArIHBhcnNlZC5zZWFyY2ggKyBwYXJzZWQuaGFzaCApOwoJCXBhcnNlZC5wYXRoICA9IG9iai5wYXRoIHx8IHBhcnNlZC5wYXRobmFtZSArIHBhcnNlZC5zZWFyY2g7CgkJcGFyc2VkLnF1ZXJ5ID0gdXRpbGl0eS5xdWVyeVN0cmluZyggbnVsbCwgcGFyc2VkLnNlYXJjaCApOwoKCQlyZXR1cm4gcGFyc2VkOwoJfSwKCgkvKioKCSAqIENyZWF0ZXMgYSBwYXJ0aWFsbHkgYXBwbGllZCBGdW5jdGlvbgoJICoKCSAqIEBtZXRob2QgcGFydGlhbAoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEByZXR1cm4ge0Z1bmN0aW9ufSBQYXJ0aWFsIEZ1bmN0aW9uCgkgKiBAZXhhbXBsZQoJICogZnVuY3Rpb24gZiAoIGEsIGIgKSB7CgkgKiAgIHJldHVybiBhICsgYjsKCSAqIH0KCSAqCgkgKiB2YXIgZyA9IGtlaWdhaS51dGlsLnBhcnRpYWwoIGYsIDIgKTsKCSAqCgkgKiBnKCAyICk7IC8vIDQKCSAqLwoJcGFydGlhbCA6IGZ1bmN0aW9uICgpIHsKCQl2YXIgYXJncyA9IGFycmF5LmNhc3QoIGFyZ3VtZW50cyApLAoJCSAgICBmbiAgID0gYXJncy5zaGlmdCgpOwoKCQlyZXR1cm4gZnVuY3Rpb24gKCkgewoJCQlyZXR1cm4gZm4uYXBwbHkoIGZuLCBhcmdzLmNvbmNhdCggYXJyYXkuY2FzdCggYXJndW1lbnRzICkgKSApOwoJCX07Cgl9LAoKCS8qKgoJICogUHJldmVudHMgZGVmYXVsdCBiZWhhdmlvciBvZiBhbiBFdmVudAoJICoKCSAqIEBtZXRob2QgcHJldmVudAoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge09iamVjdH0gZXYgRXZlbnQKCSAqIEByZXR1cm4ge09iamVjdH0gICAgRXZlbnQKCSAqIEBleGFtcGxlCgkgKiBrZWlnYWkudXRpbC5wcmV2ZW50KCBFdmVudCApOwoJICovCglwcmV2ZW50IDogZnVuY3Rpb24gKCBldiApIHsKCQlpZiAoIHR5cGVvZiBldi5wcmV2ZW50RGVmYXVsdCA9PSAiZnVuY3Rpb24iICkgewoJCQlldi5wcmV2ZW50RGVmYXVsdCgpOwoJCX0KCgkJcmV0dXJuIGV2OwoJfSwKCgkvKioKCSAqIFBhcnNlcyBhIHF1ZXJ5IHN0cmluZyAmIGNvZXJjZXMgdmFsdWVzCgkgKgoJICogQG1ldGhvZCBxdWVyeVN0cmluZwoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge1N0cmluZ30gYXJnICAgICBbT3B0aW9uYWxdIEtleSB0byBmaW5kIGluIHRoZSBxdWVyeXN0cmluZwoJICogQHBhcmFtICB7U3RyaW5nfSBxc3RyaW5nIFtPcHRpb25hbF0gUXVlcnkgc3RyaW5nIHRvIHBhcnNlCgkgKiBAcmV0dXJuIHtNaXhlZH0gICAgICAgICAgVmFsdWUgb3IgT2JqZWN0IG9mIGtleTp2YWx1ZSBwYWlycwoJICogQHByaXZhdGUKCSAqLwoJcXVlcnlTdHJpbmcgOiBmdW5jdGlvbiAoIGFyZywgcXN0cmluZyApIHsKCQl2YXIgb2JqICAgID0ge30sCgkJICAgIHJlc3VsdCA9IHFzdHJpbmcgIT09IHVuZGVmaW5lZCA/ICggcXN0cmluZy5pbmRleE9mKCAiPyIgKSA+IC0xID8gcXN0cmluZy5yZXBsYWNlKCAvLipcPy8sICIiICkgOiBudWxsICkgOiAoIHNlcnZlciB8fCBzdHJpbmcuaXNFbXB0eSggbG9jYXRpb24uc2VhcmNoICkgPyBudWxsIDogbG9jYXRpb24uc2VhcmNoLnJlcGxhY2UoICI/IiwgIiIgKSApOwoKCQlpZiAoIHJlc3VsdCAhPT0gbnVsbCAmJiAhc3RyaW5nLmlzRW1wdHkoIHJlc3VsdCApICkgewoJCQlyZXN1bHQgPSByZXN1bHQuc3BsaXQoICImIiApOwoJCQlhcnJheS5lYWNoKCByZXN1bHQsIGZ1bmN0aW9uICggcHJvcCApIHsKCQkJCXZhciBpdGVtID0gcHJvcC5zcGxpdCggIj0iICk7CgoJCQkJaWYgKCBzdHJpbmcuaXNFbXB0eSggaXRlbVswXSApICkgewoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlpZiAoIGl0ZW1bMV0gPT09IHVuZGVmaW5lZCApIHsKCQkJCQlpdGVtWzFdID0gIiI7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlpdGVtWzFdID0gdXRpbGl0eS5jb2VyY2UoIGRlY29kZVVSSUNvbXBvbmVudCggaXRlbVsxXSApICk7CgkJCQl9CgoJCQkJaWYgKCBvYmpbaXRlbVswXV0gPT09IHVuZGVmaW5lZCApIHsKCQkJCQlvYmpbaXRlbVswXV0gPSBpdGVtWzFdOwoJCQkJfQoJCQkJZWxzZSBpZiAoICEoIG9ialtpdGVtWzBdXSBpbnN0YW5jZW9mIEFycmF5ICkgKSB7CgkJCQkJb2JqW2l0ZW1bMF1dID0gW29ialtpdGVtWzBdXV07CgkJCQkJb2JqW2l0ZW1bMF1dLnB1c2goIGl0ZW1bMV0gKTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCW9ialtpdGVtWzBdXS5wdXNoKCBpdGVtWzFdICk7CgkJCQl9CgkJCX0gKTsKCQl9CgoJCWlmICggYXJnICE9PSBudWxsICYmIGFyZyAhPT0gdW5kZWZpbmVkICkgewoJCQlvYmogPSBvYmpbYXJnXTsKCQl9CgoJCXJldHVybiBvYmo7Cgl9LAoKCS8qKgoJICogQWNjZXB0cyBEZWZlcnJlZHMgb3IgUHJvbWlzZXMgYXMgYXJndW1lbnRzLCBvciBhbiBBcnJheSBvZiBlaXRoZXIKCSAqCgkgKiBAbWV0aG9kIHJhY2UKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcmV0dXJuIHtPYmplY3R9IHtAbGluayBrZWlnYWkuRGVmZXJyZWR9CgkgKiBAZXhhbXBsZQoJICogdmFyIGRlZmVycmVkcyA9IFtdLAoJICogICAgIGRlZmVyMSAgICA9IGtlaWdhaS51dGlsLmRlZmVyKCksCgkgKiAgICAgZGVmZXIyICAgID0ga2VpZ2FpLnV0aWwuZGVmZXIoKTsKCSAqCgkgKiBkZWZlcnJlZHMucHVzaCggZGVmZXIxICk7CgkgKiBkZWZlcnJlZHMucHVzaCggZGVmZXIyICk7CgkgKgoJICogLy8gRXhlY3V0ZXMgd2hlbiBvbmUgZGVmZXJyZWQgaXMgcmVzb2x2ZWQgb3IgcmVqZWN0ZWQKCSAqIGtlaWdhaS51dGlsLnJhY2UoIGRlZmVycmVkcyApLnRoZW4oIGZ1bmN0aW9uICggYXJnICkgKSB7CgkgKiAgIC4uLgoJICogfSwgZnVuY3Rpb24gKCBlcnIgKSB7CgkgKiAgIC4uLgoJICogfSApOwoJICoKCSAqIC4uLgoJICoKCSAqIGRlZmVyMS5yZXNvbHZlKCB0cnVlICk7CgkgKiBkZWZlcjIucmVzb2x2ZSggdHJ1ZSApOwoJICovCglyYWNlIDogZnVuY3Rpb24gKCkgewoJCXZhciBkZWZlciA9IGRlZmVycmVkLmZhY3RvcnkoKSwKCQkgICAgYXJncyAgPSBhcnJheS5jYXN0KCBhcmd1bWVudHMgKTsKCgkJLy8gRGlkIHdlIHJlY2VpdmUgYW4gQXJyYXk/IGlmIHNvIGl0IG92ZXJyaWRlcyBhbnkgb3RoZXIgYXJndW1lbnRzCgkJaWYgKCBhcmdzWzBdIGluc3RhbmNlb2YgQXJyYXkgKSB7CgkJCWFyZ3MgPSBhcmdzWzBdOwoJCX0KCgkJLy8gTm9uZSwgZW5kIG9uIG5leHQgdGljawoJCWlmICggYXJncy5sZW5ndGggPT09IDAgKSB7CgkJCWRlZmVyLnJlc29sdmUoIG51bGwgKTsKCQl9CgkJLy8gU2V0dXAgYW5kIHdhaXQKCQllbHNlIHsKCQkJUHJvbWlzZS5yYWNlKCBhcmdzICkudGhlbiggZnVuY3Rpb24gKCByZXN1bHRzICkgewoJCQkJZGVmZXIucmVzb2x2ZSggcmVzdWx0cyApOwoJCQl9LCBmdW5jdGlvbiAoIGUgKSB7CgkJCQlkZWZlci5yZWplY3QoIGUgKTsKCQkJfSApOwoJCX0KCgkJcmV0dXJuIGRlZmVyOwoJfSwKCgkvKioKCSAqIEFzeW5jaHJvbm91cyBET00gcmVuZGVyaW5nIChjYW5ub3QgYmUgY2FuY2VsbGVkLCBzdWdnZXN0ZWQgZm9yIHJlYWN0aXZlIGJlaGF2aW9yKQoJICoKCSAqIEBtZXRob2QgcmVuZGVyCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7RnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgb24gbmV4dCAnZnJhbWUnCgkgKiBAcmV0dXJuIHtPYmplY3R9IHtAbGluayBrZWlnYWkuRGVmZXJyZWR9CgkgKiBAZXhhbXBsZQoJICoga2VpZ2FpLnV0aWwucmVuZGVyKCBmdW5jdGlvbiAoKSB7CgkgKiAgICAgcmV0dXJuIGtlaXRhaS51dGlsLmVsZW1lbnQuaHRtbCggZG9jdW1lbnQucXVlcnlTZWxlY3RvciggIiNpZCIgKSwgIkhlbGxvIFdvcmxkIiApCgkgKiB9ICkudGhlbiggZnVuY3Rpb24gKCBhcmcgKSB7CgkgKiAgICAgLy8gYXJnIGlzIHRoZSByZXR1cm4gdmFsdWUgb2YgeW91ciBmdW5jdGlvbgoJICogfSwgZnVuY3Rpb24gKCBlICkgewoJICogICAgIC8vIEhhbmRsZSBlCgkgKiB9ICk7CgkgKi8KCXJlbmRlciA6IGZ1bmN0aW9uICggZm4gKSB7CgkJdmFyIGRlZmVyID0gZGVmZXJyZWQuZmFjdG9yeSgpOwoKCQlSRU5ERVIoIGZ1bmN0aW9uICggYXJnICkgewoJCQl0cnkgewoJCQkJZGVmZXIucmVzb2x2ZSggZm4oIGFyZyApICk7CgkJCX0KCQkJY2F0Y2ggKCBlICkgewoJCQkJZGVmZXIucmVqZWN0KCBlICk7CgkJCX0KCQl9ICk7CgoJCXJldHVybiBkZWZlcjsKCX0sCgoJLyoqCgkgKiBDcmVhdGVzIGEgcmVjdXJzaXZlIGZ1bmN0aW9uLiBSZXR1cm4gZmFsc2UgZnJvbSB0aGUgZnVuY3Rpb24gdG8gaGFsdCByZWN1cnNpb24uCgkgKgoJICogQG1ldGhvZCByZXBlYXQKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtGdW5jdGlvbn0gZm4gIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgcmVwZWF0ZWRseQoJICogQHBhcmFtICB7TnVtYmVyfSAgIG1zICBNaWxsaXNlY29uZHMgdG8gc3RhZ2dlciB0aGUgZXhlY3V0aW9uCgkgKiBAcGFyYW0gIHtTdHJpbmd9ICAgaWQgIFtPcHRpb25hbF0gVGltZW91dCBJRAoJICogQHBhcmFtICB7Qm9vbGVhbn0gIG5vdyBFeGVjdXRlcyBgZm5gIGFuZCB0aGVuIHNldHVwIHJlcGV0aXRpb24sIGRlZmF1bHQgaXMgYHRydWVgCgkgKiBAcmV0dXJuIHtTdHJpbmd9ICAgICAgIFRpbWVvdXQgSUQKCSAqIEBleGFtcGxlCgkgKiBrZWlnYWkudXRpbC5yZXBlYXQoIGZ1bmN0aW9uICgpIHsKCSAqICAgLi4uCgkgKgoJICogICAvLyBDYW5jZWxsaW5nIHJlcGV0aXRpb24gYXQgc29tZSBwb2ludCBpbiB0aGUgZnV0dXJlCgkgKiAgIGlmICggc29tZUNvbmRpdGlvbiApIHsKCSAqICAgICByZXR1cm4gZmFsc2U7CgkgKiAgIH0KCSAqIH0sIDEwMDAsICJyZXBlYXRpbmciICk7CgkgKi8KCXJlcGVhdCA6IGZ1bmN0aW9uICggZm4sIG1zLCBpZCwgbm93ICkgewoJCW1zICA9IG1zIHx8IDEwOwoJCWlkICA9IGlkIHx8IHV0aWxpdHkudXVpZCggdHJ1ZSApOwoJCW5vdyA9ICggbm93ICE9PSBmYWxzZSApOwoKCQkvLyBDb3VsZCBiZSB2YWxpZCB0byByZXR1cm4gZmFsc2UgZnJvbSBpbml0aWFsIGV4ZWN1dGlvbgoJCWlmICggbm93ICYmIGZuKCkgPT09IGZhbHNlICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBDcmVhdGluZyByZXBlYXRpbmcgZXhlY3V0aW9uCgkJdXRpbGl0eS5kZWZlciggZnVuY3Rpb24gKCkgewoJCQl2YXIgcmVjdXJzaXZlID0gZnVuY3Rpb24gKCBmbiwgbXMsIGlkICkgewoJCQkJdmFyIHJlY3Vyc2l2ZSA9IHRoaXM7CgoJCQkJaWYgKCBmbigpICE9PSBmYWxzZSApIHsKCQkJCQl1dGlsaXR5LnJlcGVhdGluZ1tpZF0gPSBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7CgkJCQkJCXJlY3Vyc2l2ZS5jYWxsKCByZWN1cnNpdmUsIGZuLCBtcywgaWQgKTsKCQkJCQl9LCBtcyApOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJZGVsZXRlIHV0aWxpdHkucmVwZWF0aW5nW2lkXTsKCQkJCX0KCQkJfTsKCgkJCXJlY3Vyc2l2ZS5jYWxsKCByZWN1cnNpdmUsIGZuLCBtcywgaWQgKTsKCQl9LCBtcywgaWQsIHRydWUgKTsKCgkJcmV0dXJuIGlkOwoJfSwKCgkvKioKCSAqIFN0b3BzIGFuIEV2ZW50IGZyb20gYnViYmxpbmcsICYgcHJldmVudHMgZGVmYXVsdCBiZWhhdmlvcgoJICoKCSAqIEBtZXRob2Qgc3RvcAoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge09iamVjdH0gZXYgRXZlbnQKCSAqIEByZXR1cm4ge09iamVjdH0gICAgRXZlbnQKCSAqIEBleGFtcGxlCgkgKiBrZWlnYWkudXRpbC5zdG9wKCBFdmVudCApOwoJICovCglzdG9wIDogZnVuY3Rpb24gKCBldiApIHsKCQlpZiAoIHR5cGVvZiBldi5zdG9wUHJvcGFnYXRpb24gPT0gImZ1bmN0aW9uIiApIHsKCQkJZXYuc3RvcFByb3BhZ2F0aW9uKCk7CgkJfQoKCQl1dGlsaXR5LnByZXZlbnQoIGV2ICk7CgoJCXJldHVybiBldjsKCX0sCgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBFdmVudCB0YXJnZXQKCSAqCgkgKiBAbWV0aG9kIHRhcmdldAoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge09iamVjdH0gZXYgRXZlbnQKCSAqIEByZXR1cm4ge09iamVjdH0gICAgRXZlbnQgdGFyZ2V0CgkgKiBAZXhhbXBsZQoJICogdmFyIHRhcmdldCA9IGtlaWdhaS51dGlsLnRhcmdldCggRXZlbnQgKTsKCSAqLwoJdGFyZ2V0IDogZnVuY3Rpb24gKCBldiApIHsKCQlyZXR1cm4gZXYudGFyZ2V0IHx8IGV2LnNyY0VsZW1lbnQ7Cgl9LAoKCS8qKgoJICogR2VuZXJhdGVzIGEgdmVyc2lvbiA0IFVVSUQKCSAqCgkgKiBAbWV0aG9kIHV1aWQKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtCb29sZWFufSBzdHJpcCBbT3B0aW9uYWxdIFN0cmlwcyAtIGZyb20gVVVJRAoJICogQHJldHVybiB7U3RyaW5nfSAgICAgICAgVVVJRAoJICogQGV4YW1wbGUKCSAqIHZhciB1dWlkNCA9IGtlaWdhaS51dGlsLnV1aWQoKTsKCSAqLwoJdXVpZCA6IGZ1bmN0aW9uICggc3RyaXAgKSB7CgkJdmFyIHMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAoICggKCAxICsgTWF0aC5yYW5kb20oKSApICogMHgxMDAwMCApIHwgMCApLnRvU3RyaW5nKCAxNiApLnN1YnN0cmluZyggMSApOyB9LAoJCSAgICByID0gWzgsIDksICJhIiwgImIiXSwKCQkgICAgbzsKCgkJbyA9ICggcygpICsgcygpICsgIi0iICsgcygpICsgIi00IiArIHMoKS5zdWJzdHIoIDAsIDMgKSArICItIiArIHJbTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqIDQgKV0gKyBzKCkuc3Vic3RyKCAwLCAzICkgKyAiLSIgKyBzKCkgKyBzKCkgKyBzKCkgKTsKCgkJaWYgKCBzdHJpcCA9PT0gdHJ1ZSApIHsKCQkJbyA9IG8ucmVwbGFjZSggLy0vZywgIiIgKTsKCQl9CgoJCXJldHVybiBvOwoJfSwKCgkvKioKCSAqIFdhbGtzIGBvYmpgIGFuZCByZXR1cm5zIGBhcmdgLCBmb3Igd2hlbiB5b3UgY2FuJ3QgZWFzaWx5IGFjY2VzcyBgYXJnYAoJICoKCSAqIEBtZXRob2QgIHdhbGsKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtNaXhlZH0gIG9iaiAgT2JqZWN0IG9yIEFycmF5CgkgKiBAcGFyYW0gIHtTdHJpbmd9IGFyZyAgU3RyaW5nIGRlc2NyaWJpbmcgdGhlIHByb3BlcnR5IHRvIHJldHVybgoJICogQHJldHVybiB7TWl4ZWR9ICAgICAgIFRhcmdldCBvciB1bmRlZmluZWQKCSAqIEBleGFtcGxlCgkgKiB2YXIgb2JqID0ge2E6IFt7YjogdHJ1ZX1dfTsKCSAqCgkgKiBrZWlnYWkudXRpbC53YWxrKCBvYmosICJhWzBdLmIiICk7IC8vIHRydWUKCSAqLwoJd2FsayA6IGZ1bmN0aW9uICggb2JqLCBhcmcgKSB7CgkJdmFyIG91dHB1dCA9IG9iajsKCgkJYXJyYXkuZWFjaCggYXJnLnJlcGxhY2UoIC9cXSQvLCAiIiApLnJlcGxhY2UoIC9cXS9nLCAiLiIgKS5yZXBsYWNlKCAvXC5cLi9nLCAiLiIgKS5zcGxpdCggL1wufFxbLyApLCBmdW5jdGlvbiAoIGkgKSB7CgkJCWlmICggb3V0cHV0W2ldID09PSB1bmRlZmluZWQgfHwgb3V0cHV0W2ldID09PSBudWxsICkgewoJCQkJb3V0cHV0ID0gdW5kZWZpbmVkOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgoJCQlvdXRwdXQgPSBvdXRwdXRbaV07CgkJfSApOwoKCQlyZXR1cm4gb3V0cHV0OwoJfSwKCgkvKioKCSAqIEFjY2VwdHMgRGVmZXJyZWRzIG9yIFByb21pc2VzIGFzIGFyZ3VtZW50cywgb3IgYW4gQXJyYXkgb2YgZWl0aGVyCgkgKgoJICogQG1ldGhvZCB3aGVuCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHJldHVybiB7T2JqZWN0fSB7QGxpbmsga2VpZ2FpLkRlZmVycmVkfQoJICogQGV4YW1wbGUKCSAqIHZhciBkZWZlcnJlZHMgPSBbXSwKCSAqICAgICBkZWZlcjEgICAgPSBrZWlnYWkudXRpbC5kZWZlcigpLAoJICogICAgIGRlZmVyMiAgICA9IGtlaWdhaS51dGlsLmRlZmVyKCk7CgkgKgoJICogZGVmZXJyZWRzLnB1c2goIGRlZmVyMSApOwoJICogZGVmZXJyZWRzLnB1c2goIGRlZmVyMiApOwoJICoKCSAqIC8vIEV4ZWN1dGVzIHdoZW4gYm90aCBkZWZlcnJlZHMgaGF2ZSByZXNvbHZlZCBvciBvbmUgaGFzIHJlamVjdGVkCgkgKiBrZWlnYWkudXRpbC53aGVuKCBkZWZlcnJlZHMgKS50aGVuKCBmdW5jdGlvbiAoIGFyZ3MgKSApIHsKCSAqICAgLi4uCgkgKiB9LCBmdW5jdGlvbiAoIGVyciApIHsKCSAqICAgLi4uCgkgKiB9ICk7CgkgKgoJICogLi4uCgkgKgoJICogZGVmZXIxLnJlc29sdmUoIHRydWUgKTsKCSAqIGRlZmVyMi5yZXNvbHZlKCB0cnVlICk7CgkgKi8KCXdoZW4gOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGRlZmVyID0gZGVmZXJyZWQuZmFjdG9yeSgpLAoJCSAgICBhcmdzICA9IGFycmF5LmNhc3QoIGFyZ3VtZW50cyApOwoKCQkvLyBEaWQgd2UgcmVjZWl2ZSBhbiBBcnJheT8gaWYgc28gaXQgb3ZlcnJpZGVzIGFueSBvdGhlciBhcmd1bWVudHMKCQlpZiAoIGFyZ3NbMF0gaW5zdGFuY2VvZiBBcnJheSApIHsKCQkJYXJncyA9IGFyZ3NbMF07CgkJfQoKCQkvLyBOb25lLCBlbmQgb24gbmV4dCB0aWNrCgkJaWYgKCBhcmdzLmxlbmd0aCA9PT0gMCApIHsKCQkJZGVmZXIucmVzb2x2ZSggbnVsbCApOwoJCX0KCQkvLyBTZXR1cCBhbmQgd2FpdAoJCWVsc2UgewoJCQlQcm9taXNlLmFsbCggYXJncyApLnRoZW4oIGZ1bmN0aW9uICggcmVzdWx0cyApIHsKCQkJCWRlZmVyLnJlc29sdmUoIHJlc3VsdHMgKTsKCQkJfSwgZnVuY3Rpb24gKCBlICkgewoJCQkJZGVmZXIucmVqZWN0KCBlICk7CgkJCX0gKTsKCQl9CgoJCXJldHVybiBkZWZlcjsKCX0sCgoJLyoqCgkgKiBXb3JrZXIgZmFjdG9yeQoJICoKCSAqIEBtZXRob2Qgd29ya2VyCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7T2JqZWN0fSBkZWZlciBEZWZlcnJlZCB0byByZWNlaXZlIG1lc3NhZ2UgZnJvbSBXb3JrZXIKCSAqIEByZXR1cm4ge09iamVjdH0gICAgICAgV29ya2VyCgkgKiBAcHJpdmF0ZQoJICovCgl3b3JrZXIgOiBmdW5jdGlvbiAoIGRlZmVyICkgewoJCXZhciBvYmogPSBuZXcgV29ya2VyKCBXT1JLRVIgKTsKCgkJb2JqLm9uZXJyb3IgPSBmdW5jdGlvbiAoIGVyciApIHsKCQkJZGVmZXIucmVqZWN0KCBlcnIgKTsKCQkJb2JqLnRlcm1pbmF0ZSgpOwoJCX07CgoJCW9iai5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoIGV2ICkgewoJCQlkZWZlci5yZXNvbHZlKCBldi5kYXRhICk7CgkJCW9iai50ZXJtaW5hdGUoKTsKCQl9OwoKCQlyZXR1cm4gb2JqOwoJfQp9Owo=",
                "body": "LyoqCiAqIEBuYW1lc3BhY2UgdXRpbGl0eQogKi8KdmFyIHV0aWxpdHkgPSB7CgkvKioKCSAqIENvbGxlY3Rpb24gb2YgdGltZXJzCgkgKgoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCgl0aW1lciA6IHt9LAoKCS8qKgoJICogQ29sbGVjdGlvbiBvZiByZXBlYXRpbmcgZnVuY3Rpb25zCgkgKgoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglyZXBlYXRpbmc6IHt9LAoKCS8qKgoJICogQ3JlYXRlcyBFbGVtZW50cyBvciBRdWVyaWVzIHRoZSBET00gdXNpbmcgQ1NTIHNlbGVjdG9ycwoJICoKCSAqIEBtZXRob2QgJAoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge01peGVkfSBhcmcgSFRNTCwgb3IgQ29tbWEgZGVsaW1pdGVkIHN0cmluZyBvZiBDU1Mgc2VsZWN0b3JzCgkgKiBAcmV0dXJuIHtBcnJheX0gICAgIEFycmF5IG9mIG1hdGNoaW5nIEVsZW1lbnRzCgkgKiBAZXhhbXBsZQoJICogdmFyICQgPSBrZWlnYWkudXRpbC4kOwoJICoKCSAqIC8vIExvb2tpbmcgZm9yIEVsZW1lbnRzCgkgKiAkKCAiLnNvbWVDbGFzcyIgKS5mb3JFYWNoKCBmdW5jdGlvbiAoIGkgKSB7CgkgKiAgIC4uLgoJICogfSApOwoJICoKCSAqIC8vIENyZWF0aW5nIGFuIEgxIEVsZW1lbnQKCSAqICQoICImbHQ7aDEmZ3Q7IiApLmZvckVhY2goIGZ1bmN0aW9uICggaSApIHsKCSAqICAgLi4uCgkgKiB9ICk7CgkgKi8KCSQgOiBmdW5jdGlvbiAoIGFyZyApIHsKCQl2YXIgcmVzdWx0OwoKCQkvLyBOb3RoaW5nCgkJaWYgKCAhYXJnICkgewoJCX0KCQkvLyBIVE1MCgkJZWxzZSBpZiAoIHJlZ2V4Lmh0bWwudGVzdCggYXJnICkgKSB7CgkJCXJlc3VsdCA9IFtlbGVtZW50LmNyZWF0ZSggYXJnICldOwoJCX0KCQkvLyBDU1Mgc2VsZWN0b3IocykKCQllbHNlIHsKCQkJYXJnID0gc3RyaW5nLnRyaW0oIGFyZyApOwoKCQkJaWYgKCBhcmcuaW5kZXhPZiggIiwiICkgPT09IC0xICkgewoJCQkJcmVzdWx0ID0gdXRpbGl0eS5kb20oIGFyZyApOwoKCQkJCWlmICggcmVzdWx0ICkgewoJCQkJCWlmICggaXNOYU4oIHJlc3VsdC5sZW5ndGggKSApIHsKCQkJCQkJcmVzdWx0ID0gW3Jlc3VsdF07CgkJCQkJfQoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJcmVzdWx0ID0gW107CgkJCQl9CgkJCX0KCQkJZWxzZSB7CgkJCQlyZXN1bHQgPSBbXTsKCgkJCQlhcnJheS5lYWNoKCBzdHJpbmcuZXhwbG9kZSggYXJnICksIGZ1bmN0aW9uICggcXVlcnkgKSB7CgkJCQkJdmFyIG9iaiA9IHV0aWxpdHkuZG9tKCBxdWVyeSApOwoKCQkJCQlpZiAoIG9iaiBpbnN0YW5jZW9mIEFycmF5ICkgewoJCQkJCQlyZXN1bHQgPSByZXN1bHQuY29uY2F0KCBvYmogKTsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIG9iaiApIHsKCQkJCQkJcmVzdWx0LnB1c2goIG9iaiApOwoJCQkJCX0KCQkJCX0gKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJlc3VsdDsKCX0sCgoJLyoqCgkgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIEJhc2UKCSAqCgkgKiBAbWV0aG9kIGJhc2UKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtPYmplY3R9IGFyZyBbT3B0aW9uYWxdIERlY29yYXRpdmUgT2JqZWN0CgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICBJbnN0YW5jZSBvZiBCYXNlCgkgKi8KCWJhc2UgOiBmdW5jdGlvbiAoIGFyZyApIHsKCQl2YXIgb2JqID0gbmV3IEJhc2UoKTsKCgkJaWYgKCBhcmcgaW5zdGFuY2VvZiBPYmplY3QgKSB7CgkJCXV0aWxpdHkubWVyZ2UoIG9iaiwgYXJnICk7CgkJfQoKCQlvYmoub2JzZXJ2ZXIgPSBvYnNlcnZhYmxlLmZhY3RvcnkoKTsKCgkJcmV0dXJuIG9iajsKCX0sCgoJLyoqCgkgKiBCbG9iIGZhY3RvcnkKCSAqCgkgKiBAbWV0aG9kIGJsb2IKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtTdHJpbmd9IGFyZyBTdHJpbmcgdG8gY29udmVydCB0byBhIEJsb2IKCSAqIEByZXR1cm4ge09iamVjdH0gICAgIEJsb2IKCSAqIEBwcml2YXRlCgkgKi8KCWJsb2IgOiBmdW5jdGlvbiAoIGFyZyApIHsKCQl2YXIgb2JqOwoKCQl0cnkgewoJCQlvYmogPSBuZXcgQmxvYiggW2FyZ10sIHt0eXBlOiAiYXBwbGljYXRpb24vamF2YXNjcmlwdCJ9ICk7CgkJfQoJCWNhdGNoICggZSApIHsKCQkJaWYgKCAhZ2xvYmFsLkJsb2JCdWlsZGVyICkgewoJCQkJZ2xvYmFsLkJsb2JCdWlsZGVyID0gZ2xvYmFsLk1TQmxvYkJ1aWxkZXIgfHwgZ2xvYmFsLldlYktpdEJsb2JCdWlsZGVyIHx8IGdsb2JhbC5Nb3pCbG9iQnVpbGRlcjsKCQkJfQoKCQkJb2JqID0gbmV3IGdsb2JhbC5CbG9iQnVpbGRlcigpLmFwcGVuZCggYXJnICkuZ2V0QmxvYigpOwoJCX0KCgkJcmV0dXJuIG9iajsKCX0sCgoJLyoqCgkgKiBDbGVhcnMgZGVmZXJyZWQgJiByZXBlYXRpbmcgZnVuY3Rpb25zCgkgKgoJICogQG1ldGhvZCBjbGVhclRpbWVycwoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge1N0cmluZ30gaWQgSUQgb2YgdGltZXIoIHMgKQoJICogQHJldHVybiB7VW5kZWZpbmVkfSB1bmRlZmluZWQKCSAqIEBwcml2YXRlCgkgKi8KCWNsZWFyVGltZXJzIDogZnVuY3Rpb24gKCBpZCApIHsKCQlpZiAoIGlkID09PSB1bmRlZmluZWQgfHwgc3RyaW5nLmlzRW1wdHkoIGlkICkgKSB7CgkJCXRocm93IG5ldyBFcnJvciggbGFiZWwuaW52YWxpZEFyZ3VtZW50cyApOwoJCX0KCgkJLy8gZGVmZXJyZWQKCQlpZiAoIHV0aWxpdHkudGltZXJbaWRdICkgewoJCQljbGVhclRpbWVvdXQoIHV0aWxpdHkudGltZXJbaWRdICk7CgkJCWRlbGV0ZSB1dGlsaXR5LnRpbWVyW2lkXTsKCQl9CgoJCS8vIHJlcGVhdGluZwoJCWlmICggdXRpbGl0eS5yZXBlYXRpbmdbaWRdICkgewoJCQljbGVhclRpbWVvdXQoIHV0aWxpdHkucmVwZWF0aW5nW2lkXSApOwoJCQlkZWxldGUgdXRpbGl0eS5yZXBlYXRpbmdbaWRdOwoJCX0KCX0sCgoJLyoqCgkgKiBDbG9uZXMgYW4gT2JqZWN0CgkgKgoJICogQG1ldGhvZCBjbG9uZQoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge09iamVjdH0gIG9iaiAgICAgT2JqZWN0IHRvIGNsb25lCgkgKiBAcGFyYW0gIHtCb29sZWFufSBzaGFsbG93IFtPcHRpb25hbF0gQ3JlYXRlIGEgc2hhbGxvdyBjbG9uZSwgd2hpY2ggZG9lc24ndCBtYWludGFpbiBwcm90b3R5cGVzLCBkZWZhdWx0IGlzIGBmYWxzZWAKCSAqIEByZXR1cm4ge09iamVjdH0gICAgICAgICAgQ2xvbmUgb2Ygb2JqCgkgKiBAZXhhbXBsZQoJICogdmFyIHggPSB7YTogdHJ1ZSwgYjogZmFsc2V9LAoJICogICAgIHkgPSBrZWlnYWkudXRpbC5jbG9uZSggeCwgdHJ1ZSApOwoJICoKCSAqIHkuYTsgLy8gdHJ1ZQoJICovCgljbG9uZSA6IGZ1bmN0aW9uICggb2JqLCBzaGFsbG93ICkgewoJCXZhciBjbG9uZTsKCgkJaWYgKCBzaGFsbG93ID09PSB0cnVlICkgewoJCQlyZXR1cm4gb2JqICE9PSB1bmRlZmluZWQgJiYgb2JqICE9PSBudWxsID8ganNvbi5kZWNvZGUoIGpzb24uZW5jb2RlKCBvYmogKSApIDogb2JqOwoJCX0KCQllbHNlIGlmICggIW9iaiB8fCByZWdleC5wcmltaXRpdmUudGVzdCggdHlwZW9mIG9iaiApIHx8ICggb2JqIGluc3RhbmNlb2YgUmVnRXhwICkgKSB7CgkJCXJldHVybiBvYmo7CgkJfQoJCWVsc2UgaWYgKCBvYmogaW5zdGFuY2VvZiBBcnJheSApIHsKCQkJcmV0dXJuIG9iai5zbGljZSgpOwoJCX0KCQllbHNlIGlmICggIXNlcnZlciAmJiAhY2xpZW50LmllICYmIG9iaiBpbnN0YW5jZW9mIERvY3VtZW50ICkgewoJCQlyZXR1cm4geG1sLmRlY29kZSggeG1sLmVuY29kZSggb2JqICkgKTsKCQl9CgkJZWxzZSBpZiAoIHR5cGVvZiBvYmouX19wcm90b19fICE9ICJ1bmRlZmluZWQiICkgewoJCQlyZXR1cm4gdXRpbGl0eS5leHRlbmQoIG9iai5fX3Byb3RvX18sIG9iaiApOwoJCX0KCQllbHNlIGlmICggb2JqIGluc3RhbmNlb2YgT2JqZWN0ICkgewoJCQkvLyBJZiBKU09OIGVuY29kaW5nIGZhaWxzIGR1ZSB0byByZWN1cnNpb24sIHRoZSBvcmlnaW5hbCBPYmplY3QgaXMgcmV0dXJuZWQgYmVjYXVzZSBpdCdzIGFzc3VtZWQgdGhpcyBpcyBmb3IgZGVjb3JhdGlvbgoJCQljbG9uZSA9IGpzb24uZW5jb2RlKCBvYmosIHRydWUgKTsKCgkJCWlmICggY2xvbmUgIT09IHVuZGVmaW5lZCApIHsKCQkJCWNsb25lID0ganNvbi5kZWNvZGUoIGNsb25lICk7CgoJCQkJLy8gRGVjb3JhdGluZyBGdW5jdGlvbnMgdGhhdCB3b3VsZCBiZSBsb3N0IHdpdGggSlNPTiBlbmNvZGluZy9kZWNvZGluZwoJCQkJdXRpbGl0eS5pdGVyYXRlKCBvYmosIGZ1bmN0aW9uICggdiwgayApIHsKCQkJCQlpZiAoIHR5cGVvZiB2ID09ICJmdW5jdGlvbiIgKSB7CgkJCQkJCWNsb25lW2tdID0gdjsKCQkJCQl9CgkJCQl9ICk7CgkJCX0KCQkJZWxzZSB7CgkJCQljbG9uZSA9IG9iajsKCQkJfQoKCQkJcmV0dXJuIGNsb25lOwoJCX0KCQllbHNlIHsKCQkJcmV0dXJuIG9iajsKCQl9Cgl9LAoKCS8qKgoJICogQ29lcmNlcyBhIFN0cmluZyB0byBhIFR5cGUKCSAqCgkgKiBAbWV0aG9kIGNvZXJjZQoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge1N0cmluZ30gdmFsdWUgU3RyaW5nIHRvIGNvZXJjZQoJICogQHJldHVybiB7TWl4ZWR9ICAgICAgICBQcmltaXRpdmUgdmVyc2lvbiBvZiB0aGUgU3RyaW5nCgkgKiBAZXhhbXBsZQoJICoga2VpZ2FpLnV0aWwuY29lcmNlKCAiMSIgKTsgLy8gMQoJICovCgljb2VyY2UgOiBmdW5jdGlvbiAoIHZhbHVlICkgewoJCXZhciB0bXA7CgoJCWlmICggdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCQkJcmV0dXJuIHVuZGVmaW5lZDsKCQl9CgkJZWxzZSBpZiAoIHZhbHVlID09PSAidHJ1ZSIgKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCQllbHNlIGlmICggdmFsdWUgPT09ICJmYWxzZSIgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJZWxzZSBpZiAoIHZhbHVlID09PSAibnVsbCIgKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCQllbHNlIGlmICggdmFsdWUgPT09ICJ1bmRlZmluZWQiICkgewoJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCX0KCQllbHNlIGlmICggdmFsdWUgPT09ICIiICkgewoJCQlyZXR1cm4gdmFsdWU7CgkJfQoJCWVsc2UgaWYgKCAhaXNOYU4oIHRtcCA9IE51bWJlciggdmFsdWUgKSApICkgewoJCQlyZXR1cm4gdG1wOwoJCX0KCQllbHNlIGlmICggcmVnZXguanNvbl93cmFwLnRlc3QoIHZhbHVlICkgKSB7CgkJCXJldHVybiBqc29uLmRlY29kZSggdmFsdWUsIHRydWUgKSB8fCB2YWx1ZTsKCQl9CgkJZWxzZSB7CgkJCXJldHVybiB2YWx1ZTsKCQl9Cgl9LAoKCS8qKgoJICogUmVjb21waWxlcyBhIFJlZ0V4cCBieSByZWZlcmVuY2UKCSAqCgkgKiBUaGlzIGlzIGlkZWFsIHdoZW4geW91IG5lZWQgdG8gcmVjb21waWxlIGEgcmVnZXggZm9yIHVzZSB3aXRoaW4gYSBjb25kaXRpb25hbCBzdGF0ZW1lbnQKCSAqCgkgKiBAbWV0aG9kIGNvbXBpbGUKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtPYmplY3R9IHJlZ2V4ICAgICBSZWdFeHAKCSAqIEBwYXJhbSAge1N0cmluZ30gcGF0dGVybiAgIFJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJuCgkgKiBAcGFyYW0gIHtTdHJpbmd9IG1vZGlmaWVycyBNb2RpZmllcnMgdG8gYXBwbHkgdG8gdGhlIHBhdHRlcm4KCSAqIEByZXR1cm4ge0Jvb2xlYW59ICAgICAgICAgIHRydWUKCSAqIEBwcml2YXRlCgkgKi8KCWNvbXBpbGUgOiBmdW5jdGlvbiAoIHJlZywgcGF0dGVybiwgbW9kaWZpZXJzICkgewoJCXJlZy5jb21waWxlKCBwYXR0ZXJuLCBtb2RpZmllcnMgKTsKCgkJcmV0dXJuIHRydWU7Cgl9LAoKCS8qKgoJICogQ3VycmllcyBhIEZ1bmN0aW9uCgkgKgoJICogTm90ZTogRnVuY3Rpb24gdG8gY3VycnkgbXVzdCByZXR1cm4gYSBGdW5jdGlvbgoJICoKCSAqIEBtZXRob2QgY3VycnkKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcmV0dXJuIHtGdW5jdGlvbn0gQ3VycmllZCBGdW5jdGlvbgoJICogQGV4YW1wbGUKCSAqIGZ1bmN0aW9uIGYgKCBhLCBiICkgewoJICogICByZXR1cm4gZnVuY3Rpb24gKCBuICkgewoJICogICAgIHJldHVybiAoIGEgKyBiICkgKiBuOwoJICogICB9OwoJICogfQoJICoKCSAqIHZhciBnID0ga2VpZ2FpLnV0aWwuY3VycnkoIGYsIDIsIDggKTsKCSAqCgkgKiBnKCA1ICk7IC8vIDUwCgkgKi8KCWN1cnJ5IDogZnVuY3Rpb24gKCkgewoJCXZhciBhcmdzID0gYXJyYXkuY2FzdCggYXJndW1lbnRzICksCgkJICAgIGZuICAgPSBhcmdzLnNoaWZ0KCksCgkJICAgIGNmbiAgPSBmbi5hcHBseSggZm4sIGFyZ3MgKTsKCgkJcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJcmV0dXJuIGNmbi5hcHBseSggY2ZuLCBhcmd1bWVudHMgKTsKCQl9OwoJfSwKCgkvKioKCSAqIERlZmVycyB0aGUgZXhlY3V0aW9uIG9mIEZ1bmN0aW9uIGJ5IGF0IGxlYXN0IHRoZSBzdXBwbGllZCBtaWxsaXNlY29uZHMuCgkgKiBUaW1pbmcgbWF5IHZhcnkgdW5kZXIgImhlYXZ5IGxvYWQiIHJlbGF0aXZlIHRvIHRoZSBDUFUgJiBjbGllbnQgSmF2YVNjcmlwdCBlbmdpbmUuCgkgKgoJICogQG1ldGhvZCBkZWZlcgoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge0Z1bmN0aW9ufSBmbiAgICAgRnVuY3Rpb24gdG8gZGVmZXIgZXhlY3V0aW9uIG9mCgkgKiBAcGFyYW0gIHtOdW1iZXJ9ICAgbXMgICAgIE1pbGxpc2Vjb25kcyB0byBkZWZlciBleGVjdXRpb24KCSAqIEBwYXJhbSAge051bWJlcn0gICBpZCAgICAgW09wdGlvbmFsXSBJRCBvZiB0aGUgZGVmZXJyZWQgZnVuY3Rpb24KCSAqIEBwYXJhbSAge0Jvb2xlYW59ICByZXBlYXQgW09wdGlvbmFsXSBEZXNjcmliZXMgdGhlIGV4ZWN1dGlvbiwgZGVmYXVsdCBpcyBgZmFsc2VgCgkgKiBAcmV0dXJuIHtTdHJpbmd9ICAgICAgICAgIElEIG9mIHRoZSB0aW1lcgoJICogQHByaXZhdGUKCSAqLwoJZGVmZXIgOiBmdW5jdGlvbiAoIGZuLCBtcywgaWQsIHJlcGVhdCApIHsKCQl2YXIgb3A7CgoJCW1zICAgICA9IG1zIHx8IDA7CgkJcmVwZWF0ID0gKCByZXBlYXQgPT09IHRydWUgKTsKCgkJaWYgKCBpZCAhPT0gdW5kZWZpbmVkICkgewoJCQl1dGlsaXR5LmNsZWFyVGltZXJzKCBpZCApOwoJCX0KCQllbHNlIHsKCQkJaWQgPSB1dGlsaXR5LnV1aWQoIHRydWUgKTsKCQl9CgoJCW9wID0gZnVuY3Rpb24gKCkgewoJCQl1dGlsaXR5LmNsZWFyVGltZXJzKCBpZCApOwoJCQlmbigpOwoJCX07CgoJCXV0aWxpdHlbcmVwZWF0ID8gInJlcGVhdGluZyIgOiAidGltZXIiXVtpZF0gPSBzZXRUaW1lb3V0KCBvcCwgbXMgKTsKCgkJcmV0dXJuIGlkOwoJfSwKCgkvKioKCSAqIEFzeW5jIGRlbGF5IHN0cmF0ZWd5CgkgKgoJICogQG1ldGhvZCBkZWxheQoJICogQG1lbWJlck9mIHByb21pc2UKCSAqIEByZXR1cm4ge0Z1bmN0aW9ufSBEZWxheSBtZXRob2QKCSAqIEBwcml2YXRlCgkgKi8KCWRlbGF5IDogZnVuY3Rpb24gKCkgewoJCWlmICggdHlwZW9mIHNldEltbWVkaWF0ZSAhPSAidW5kZWZpbmVkIiApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uICggYXJnICkgewoJCQkJc2V0SW1tZWRpYXRlKCBhcmcgKTsKCQkJfTsKCQl9CgkJZWxzZSBpZiAoIHR5cGVvZiBwcm9jZXNzICE9ICJ1bmRlZmluZWQiICkgewoJCQlyZXR1cm4gcHJvY2Vzcy5uZXh0VGljazsKCQl9CgkJZWxzZSB7CgkJCXJldHVybiBmdW5jdGlvbiAoIGFyZyApIHsKCQkJCXNldFRpbWVvdXQoIGFyZywgMCApOwoJCQl9OwoJCX0KCX0oKSwKCgkvKioKCSAqIFF1ZXJpZXMgRE9NIHdpdGggZmFzdGVzdCBtZXRob2QKCSAqCgkgKiBAbWV0aG9kIGRvbQoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge1N0cmluZ30gYXJnIERPTSBxdWVyeQoJICogQHJldHVybiB7TWl4ZWR9ICAgICAgdW5kZWZpbmVkLCBFbGVtZW50LCBvciBBcnJheSBvZiBFbGVtZW50cwoJICogQHByaXZhdGUKCSAqLwoJZG9tIDogZnVuY3Rpb24gKCBhcmcgKSB7CgkJdmFyIHJlc3VsdDsKCgkJaWYgKCAhcmVnZXguc2VsZWN0b3JfY29tcGxleC50ZXN0KCBhcmcgKSApIHsKCQkJaWYgKCByZWdleC5oYXNoLnRlc3QoIGFyZyApICkgewoJCQkJcmVzdWx0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIGFyZy5yZXBsYWNlKCByZWdleC5oYXNoLCAiIiApICkgfHwgdW5kZWZpbmVkOwoJCQl9CgkJCWVsc2UgaWYgKCByZWdleC5rbGFzcy50ZXN0KCBhcmcgKSApIHsKCQkJCXJlc3VsdCA9IGFycmF5LmNhc3QoIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIGFyZy5yZXBsYWNlKCByZWdleC5rbGFzcywgIiIgKSApICk7CgkJCX0KCQkJZWxzZSBpZiAoIHJlZ2V4LndvcmQudGVzdCggYXJnICkgKSB7CgkJCQlyZXN1bHQgPSBhcnJheS5jYXN0KCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSggYXJnICkgKTsKCQkJfQoJCQllbHNlIHsKCQkJCXJlc3VsdCA9IGFycmF5LmNhc3QoIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIGFyZyApICk7CgkJCX0KCQl9CgkJZWxzZSB7CgkJCXJlc3VsdCA9IGFycmF5LmNhc3QoIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIGFyZyApICk7CgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoJfSwKCgkvKioKCSAqIEVuY29kZXMgYSBVVUlEIHRvIGEgRE9NIGZyaWVuZGx5IElECgkgKgoJICogQG1ldGhvZCBkb21JZAoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge1N0cmluZ30gVVVJRAoJICogQHJldHVybiB7U3RyaW5nfSBET00gZnJpZW5kbHkgSUQKCSAqIEBwcml2YXRlCgkgKi8KCWRvbUlkIDogZnVuY3Rpb24gKCBhcmcgKSB7CgkJcmV0dXJuICJhIiArIGFyZy5yZXBsYWNlKCAvLS9nLCAiIiApLnNsaWNlKCAxICk7Cgl9LAoKCS8qKgoJICogRXJyb3IgaGFuZGxpbmcsIHdpdGggaGlzdG9yeSBpbiBgZXJyb3IubG9nYAoJICoKCSAqIEBtZXRob2QgZXJyb3IKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtNaXhlZH0gICBlICAgICAgIEVycm9yIG9iamVjdCBvciBtZXNzYWdlIHRvIGRpc3BsYXkKCSAqIEBwYXJhbSAge0FycmF5fSAgIGFyZ3MgICAgQXJyYXkgb2YgYXJndW1lbnRzIGZyb20gdGhlIGNhbGxzdGFjawoJICogQHBhcmFtICB7TWl4ZWR9ICAgc2NvcGUgICBFbnRpdHkgdGhhdCB3YXMgInRoaXMiCgkgKiBAcGFyYW0gIHtCb29sZWFufSB3YXJuaW5nIFtPcHRpb25hbF0gV2lsbCBkaXNwbGF5IGFzIGNvbnNvbGUgd2FybmluZyBpZiB0cnVlCgkgKiBAcmV0dXJuIHtVbmRlZmluZWR9ICAgICAgIHVuZGVmaW5lZAoJICogQHByaXZhdGUKCSAqLwoJZXJyb3IgOiBmdW5jdGlvbiAoIGUsIGFyZ3MsIHNjb3BlLCB3YXJuaW5nICkgewoJCXZhciBvID0gewoJCQkiYXJndW1lbnRzIiA6IGFyZ3MgPyBhcnJheS5jYXN0KCBhcmdzICkgOiBbXSwKCQkJbWVzc2FnZSAgICAgOiBlLm1lc3NhZ2UgfHwgZSwKCQkJbnVtYmVyICAgICAgOiBlLm51bWJlciA/ICggZS5udW1iZXIgJiAweEZGRkYgKSA6IHVuZGVmaW5lZCwKCQkJc2NvcGUgICAgICAgOiBzY29wZSwKCQkJc3RhY2sgICAgICAgOiBlLnN0YWNrIHx8IHVuZGVmaW5lZCwKCQkJdGltZXN0YW1wICAgOiBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCksCgkJCXR5cGUgICAgICAgIDogZS50eXBlIHx8ICJUeXBlRXJyb3IiCgkJfTsKCgkJdXRpbGl0eS5sb2coIG8uc3RhY2sgfHwgby5tZXNzYWdlLCB3YXJuaW5nICE9PSB0cnVlID8gImVycm9yIiA6ICJ3YXJuIiApOwoKCQlyZXR1cm4gdW5kZWZpbmVkOwoJfSwKCgkvKioKCSAqIENyZWF0ZXMgYSAiY2xhc3MiIGV4dGVuZGluZyBPYmplY3QsIHdpdGggb3B0aW9uYWwgZGVjb3JhdGlvbgoJICoKCSAqIEBtZXRob2QgZXh0ZW5kCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7T2JqZWN0fSBvYmogT2JqZWN0IHRvIGV4dGVuZAoJICogQHBhcmFtICB7T2JqZWN0fSBhcmcgW09wdGlvbmFsXSBPYmplY3QgZm9yIGRlY29yYXRpb24KCSAqIEByZXR1cm4ge09iamVjdH0gICAgIERlY29yYXRlZCBvYmoKCSAqIEBleGFtcGxlCgkgKiB2YXIgZXh0ZW5kT2JqID0ga2VpZ2FpLnV0aWwuZXh0ZW5kKCBzb21lT2JqLCB7bmV3UHJvcGVydHk6IHZhbHVlfSApOwoJICovCglleHRlbmQgOiBmdW5jdGlvbiAoIG9iaiwgYXJnICkgewoJCXZhciBvOwoKCQlpZiAoIG9iaiA9PT0gdW5kZWZpbmVkICkgewoJCQl0aHJvdyBuZXcgRXJyb3IoIGxhYmVsLmludmFsaWRBcmd1bWVudHMgKTsKCQl9CgoJCW8gPSBPYmplY3QuY3JlYXRlKCBvYmogKTsKCgkJaWYgKCBhcmcgaW5zdGFuY2VvZiBPYmplY3QgKSB7CgkJCXV0aWxpdHkubWVyZ2UoIG8sIGFyZyApOwoJCX0KCgkJcmV0dXJuIG87Cgl9LAoKCS8qKgoJICogR2VuZXJhdGVzIGFuIElEIHZhbHVlCgkgKgoJICogQG1ldGhvZCBnZW5JZAoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge01peGVkfSAgIG9iaiBbT3B0aW9uYWxdIE9iamVjdCB0byByZWNlaXZlIGlkCgkgKiBAcGFyYW0gIHtCb29sZWFufSBkb20gW09wdGlvbmFsXSBWZXJpZnkgdGhlIElEIGlzIHVuaXF1ZSBpbiB0aGUgRE9NLCBkZWZhdWx0IGlzIGZhbHNlCgkgKiBAcmV0dXJuIHtNaXhlZH0gICAgICAgT2JqZWN0IG9yIGlkCgkgKiBAcHJpdmF0ZQoJICovCglnZW5JZCA6IGZ1bmN0aW9uICggb2JqLCBkb20gKSB7CgkJZG9tID0gKCBkb20gPT09IHRydWUgKTsKCQl2YXIgaWQ7CgoJCWlmICggb2JqICYmICggb2JqLmlkIHx8ICggb2JqIGluc3RhbmNlb2YgQXJyYXkgKSB8fCAoIHR5cGVvZiBvYmogPT0gInN0cmluZyIgfHwgb2JqIGluc3RhbmNlb2YgU3RyaW5nICkgKSApIHsKCQkJcmV0dXJuIG9iajsKCQl9CgoJCWlmICggZG9tICkgewoJCQlkbyB7CgkJCQlpZCA9IHV0aWxpdHkuZG9tSWQoIHV0aWxpdHkudXVpZCggdHJ1ZSApICk7CgkJCX0KCQkJd2hpbGUgKCB1dGlsaXR5LmRvbSggIiMiICsgaWQgKSApOwoJCX0KCQllbHNlIHsKCQkJaWQgPSB1dGlsaXR5LmRvbUlkKCB1dGlsaXR5LnV1aWQoIHRydWUgKSApOwoJCX0KCgkJaWYgKCB0eXBlb2Ygb2JqID09ICJvYmplY3QiICkgewoJCQlvYmouaWQgPSBpZDsKCgkJCXJldHVybiBvYmo7CgkJfQoJCWVsc2UgewoJCQlyZXR1cm4gaWQ7CgkJfQoJfSwKCgkvKioKCSAqIEl0ZXJhdGVzIGFuIE9iamVjdCBhbmQgZXhlY3V0ZXMgYSBmdW5jdGlvbiBhZ2FpbnN0IHRoZSBwcm9wZXJ0aWVzLgoJICogUmV0dXJuaW5nIGBmYWxzZWAgaGFsdHMgaXRlcmF0aW9uLgoJICoKCSAqIEBtZXRob2QgaXRlcmF0ZQoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge09iamVjdH0gICBvYmogT2JqZWN0IHRvIGl0ZXJhdGUKCSAqIEBwYXJhbSAge0Z1bmN0aW9ufSBmbiAgRnVuY3Rpb24gdG8gZXhlY3V0ZSBhZ2FpbnN0IHByb3BlcnRpZXMKCSAqIEByZXR1cm4ge09iamVjdH0gICAgICAgT2JqZWN0CgkgKiBAZXhhbXBsZQoJICoga2VpZ2FpLnV0aWwuaXRlcmF0ZSggey4uLn0sIGZ1bmN0aW9uICggdmFsdWUsIGtleSApIHsKCSAqICAgLi4uCgkgKiB9ICk7CgkgKi8KCWl0ZXJhdGUgOiBmdW5jdGlvbiAoIG9iaiwgZm4gKSB7CgkJaWYgKCB0eXBlb2YgZm4gIT0gImZ1bmN0aW9uIiApIHsKCQkJdGhyb3cgbmV3IEVycm9yKCBsYWJlbC5pbnZhbGlkQXJndW1lbnRzICk7CgkJfQoKCQlhcnJheS5lYWNoKCBPYmplY3Qua2V5cyggb2JqICksIGZ1bmN0aW9uICggaSApIHsKCQkJcmV0dXJuIGZuLmNhbGwoIG9iaiwgb2JqW2ldLCBpICk7CgkJfSApOwoKCQlyZXR1cm4gb2JqOwoJfSwKCgkvKioKCSAqIFdyaXRlcyBhcmd1bWVudCB0byB0aGUgY29uc29sZQoJICoKCSAqIEBtZXRob2QgbG9nCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7U3RyaW5nfSBhcmcgICAgU3RyaW5nIHRvIHdyaXRlIHRvIHRoZSBjb25zb2xlCgkgKiBAcGFyYW0gIHtTdHJpbmd9IHRhcmdldCBbT3B0aW9uYWxdIFRhcmdldCBjb25zb2xlLCBkZWZhdWx0IGlzICJsb2ciCgkgKiBAcmV0dXJuIHtVbmRlZmluZWR9ICAgICB1bmRlZmluZWQKCSAqIEBleGFtcGxlCgkgKiBrZWlnYWkudXRpbC5sb2coICJTb21ldGhpbmcgYmFkIGhhcHBlbmVkIiwgIndhcm4iICk7CgkgKi8KCWxvZyA6IGZ1bmN0aW9uICggYXJnLCB0YXJnZXQgKSB7CgkJdmFyIHRzLCBtc2c7CgoJCWlmICggdHlwZW9mIGNvbnNvbGUgIT0gInVuZGVmaW5lZCIgKSB7CgkJCXRzICA9IHR5cGVvZiBhcmcgIT0gIm9iamVjdCI7CgkJCW1zZyA9IHRzID8gIlsiICsgbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKSArICJdICIgKyBhcmcgOiBhcmc7CgkJCWNvbnNvbGVbdGFyZ2V0IHx8ICJsb2ciXSggbXNnICk7CgkJfQoJfSwKCgkvKioKCSAqIE1lcmdlcyBvYmogd2l0aCBhcmcKCSAqCgkgKiBAbWV0aG9kIG1lcmdlCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7T2JqZWN0fSBvYmogT2JqZWN0IHRvIGRlY29yYXRlCgkgKiBAcGFyYW0gIHtPYmplY3R9IGFyZyBEZWNvcmF0aW9uCgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICBEZWNvcmF0ZWQgT2JqZWN0CgkgKiBAZXhhbXBsZQoJICogdmFyIG9iaiA9IHthOiB0cnVlfTsKCSAqCgkgKiBrZWlnYWkudXRpbC5tZXJnZSggb2JqLCB7YjogZmFsc2V9ICkKCSAqIG9iai5iOyAvLyBmYWxzZQoJICovCgltZXJnZSA6IGZ1bmN0aW9uICggb2JqLCBhcmcgKSB7CgkJdXRpbGl0eS5pdGVyYXRlKCBhcmcsIGZ1bmN0aW9uICggdiwgayApIHsKCQkJaWYgKCAoIG9ialtrXSBpbnN0YW5jZW9mIEFycmF5ICkgJiYgKCB2IGluc3RhbmNlb2YgQXJyYXkgKSApIHsKCQkJCWFycmF5Lm1lcmdlKCBvYmpba10sIHYgKTsKCQkJfQoJCQllbHNlIGlmICggKCBvYmpba10gaW5zdGFuY2VvZiBPYmplY3QgKSAmJiAoIHYgaW5zdGFuY2VvZiBPYmplY3QgKSApIHsKCQkJCXV0aWxpdHkuaXRlcmF0ZSggdiwgZnVuY3Rpb24gKCB4LCB5ICkgewoJCQkJCW9ialtrXVt5XSA9IHV0aWxpdHkuY2xvbmUoIHggKTsKCQkJCX0gKTsKCQkJfQoJCQllbHNlIHsKCQkJCW9ialtrXSA9IHV0aWxpdHkuY2xvbmUoIHYgKTsKCQkJfQoJCX0gKTsKCgkJcmV0dXJuIG9iajsKCX0sCgoJLyoqCgkgKiBQYXJzZXMgYSBVUkkgaW50byBhbiBPYmplY3QKCSAqCgkgKiBAbWV0aG9kIHBhcnNlCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7U3RyaW5nfSB1cmkgVVJJIHRvIHBhcnNlCgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICBQYXJzZWQgVVJJCgkgKiBAZXhhbXBsZQoJICogdmFyIHBhcnNlZCA9IGtlaWdhaS51dGlsLnBhcnNlKCBsb2NhdGlvbi5ocmVmICk7CgkgKgoJICogcGFyc2VkOwoJICogewoJICogICBhdXRoICAgICA6ICIiLAoJICogICBoYXNoICAgICA6ICIiLAoJICogICBob3N0ICAgICA6ICIiLAoJICogICBob3N0bmFtZSA6ICIiLAoJICogICBxdWVyeSAgICA6IHt9LAoJICogICBwYXRobmFtZSA6ICIiLAoJICogICBwb3J0ICAgICA6IG4sCgkgKiAgIHByb3RvY29sIDogIiIsCgkgKiAgIHNlYXJjaCAgIDogIiIsCgkgKiB9CgkgKi8KCXBhcnNlIDogZnVuY3Rpb24gKCB1cmkgKSB7CgkJdmFyIG9iaiAgICA9IHt9LAoJCSAgICBwYXJzZWQgPSB7fTsKCgkJaWYgKCB1cmkgPT09IHVuZGVmaW5lZCApIHsKCQkJdXJpID0gIXNlcnZlciA/IGxvY2F0aW9uLmhyZWYgOiAiIjsKCQl9CgoJCWlmICggIXNlcnZlciApIHsKCQkJb2JqID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImEiICk7CgkJCW9iai5ocmVmID0gdXJpOwoJCX0KCQllbHNlIHsKCQkJb2JqID0gdXJsLnBhcnNlKCB1cmkgKTsKCQl9CgoJCWlmICggc2VydmVyICkgewoJCQl1dGlsaXR5Lml0ZXJhdGUoIG9iaiwgZnVuY3Rpb24gKCB2LCBrICkgewoJCQkJaWYgKCB2ID09PSBudWxsICkgewoJCQkJCW9ialtrXSA9IHVuZGVmaW5lZDsKCQkJCX0KCQkJfSApOwoJCX0KCgkJcGFyc2VkID0gewoJCQlhdXRoICAgICA6IHNlcnZlciA/IG51bGwgOiByZWdleC5hdXRoLmV4ZWMoIHVyaSApLAoJCQlwcm90b2NvbCA6IG9iai5wcm90b2NvbCB8fCAiaHR0cDoiLAoJCQlob3N0bmFtZSA6IG9iai5ob3N0bmFtZSB8fCAibG9jYWxob3N0IiwKCQkJcG9ydCAgICAgOiBvYmoucG9ydCA/IG51bWJlci5wYXJzZSggb2JqLnBvcnQsIDEwICkgOiAiIiwKCQkJcGF0aG5hbWUgOiBvYmoucGF0aG5hbWUsCgkJCXNlYXJjaCAgIDogb2JqLnNlYXJjaCAgIHx8ICIiLAoJCQloYXNoICAgICA6IG9iai5oYXNoICAgICB8fCAiIiwKCQkJaG9zdCAgICAgOiBvYmouaG9zdCAgICAgfHwgImxvY2FsaG9zdCIKCQl9OwoKCQkvLyAnY2F1c2UgSUUgaXMgLi4uIElFOyByZXF1aXJlZCBmb3IgZGF0YS5iYXRjaCgpCgkJaWYgKCBjbGllbnQuaWUgKSB7CgkJCWlmICggcGFyc2VkLnByb3RvY29sID09PSAiOiIgKSB7CgkJCQlwYXJzZWQucHJvdG9jb2wgPSBsb2NhdGlvbi5wcm90b2NvbDsKCQkJfQoKCQkJaWYgKCBzdHJpbmcuaXNFbXB0eSggcGFyc2VkLmhvc3RuYW1lICkgKSB7CgkJCQlwYXJzZWQuaG9zdG5hbWUgPSBsb2NhdGlvbi5ob3N0bmFtZTsKCQkJfQoKCQkJaWYgKCBzdHJpbmcuaXNFbXB0eSggcGFyc2VkLmhvc3QgKSApIHsKCQkJCXBhcnNlZC5ob3N0ID0gbG9jYXRpb24uaG9zdDsKCQkJfQoKCQkJaWYgKCBwYXJzZWQucGF0aG5hbWUuY2hhckF0KCAwICkgIT09ICIvIiApIHsKCQkJCXBhcnNlZC5wYXRobmFtZSA9ICIvIiArIHBhcnNlZC5wYXRobmFtZTsKCQkJfQoJCX0KCgkJcGFyc2VkLmF1dGggID0gb2JqLmF1dGggfHwgKCBwYXJzZWQuYXV0aCA9PT0gbnVsbCA/ICIiIDogcGFyc2VkLmF1dGhbMV0gKTsKCQlwYXJzZWQuaHJlZiAgPSBvYmouaHJlZiB8fCAoIHBhcnNlZC5wcm90b2NvbCArICIvLyIgKyAoIHN0cmluZy5pc0VtcHR5KCBwYXJzZWQuYXV0aCApID8gIiIgOiBwYXJzZWQuYXV0aCArICJAIiApICsgcGFyc2VkLmhvc3QgKyBwYXJzZWQucGF0aG5hbWUgKyBwYXJzZWQuc2VhcmNoICsgcGFyc2VkLmhhc2ggKTsKCQlwYXJzZWQucGF0aCAgPSBvYmoucGF0aCB8fCBwYXJzZWQucGF0aG5hbWUgKyBwYXJzZWQuc2VhcmNoOwoJCXBhcnNlZC5xdWVyeSA9IHV0aWxpdHkucXVlcnlTdHJpbmcoIG51bGwsIHBhcnNlZC5zZWFyY2ggKTsKCgkJcmV0dXJuIHBhcnNlZDsKCX0sCgoJLyoqCgkgKiBDcmVhdGVzIGEgcGFydGlhbGx5IGFwcGxpZWQgRnVuY3Rpb24KCSAqCgkgKiBAbWV0aG9kIHBhcnRpYWwKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcmV0dXJuIHtGdW5jdGlvbn0gUGFydGlhbCBGdW5jdGlvbgoJICogQGV4YW1wbGUKCSAqIGZ1bmN0aW9uIGYgKCBhLCBiICkgewoJICogICByZXR1cm4gYSArIGI7CgkgKiB9CgkgKgoJICogdmFyIGcgPSBrZWlnYWkudXRpbC5wYXJ0aWFsKCBmLCAyICk7CgkgKgoJICogZyggMiApOyAvLyA0CgkgKi8KCXBhcnRpYWwgOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGFyZ3MgPSBhcnJheS5jYXN0KCBhcmd1bWVudHMgKSwKCQkgICAgZm4gICA9IGFyZ3Muc2hpZnQoKTsKCgkJcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJcmV0dXJuIGZuLmFwcGx5KCBmbiwgYXJncy5jb25jYXQoIGFycmF5LmNhc3QoIGFyZ3VtZW50cyApICkgKTsKCQl9OwoJfSwKCgkvKioKCSAqIFByZXZlbnRzIGRlZmF1bHQgYmVoYXZpb3Igb2YgYW4gRXZlbnQKCSAqCgkgKiBAbWV0aG9kIHByZXZlbnQKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtPYmplY3R9IGV2IEV2ZW50CgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgIEV2ZW50CgkgKiBAZXhhbXBsZQoJICoga2VpZ2FpLnV0aWwucHJldmVudCggRXZlbnQgKTsKCSAqLwoJcHJldmVudCA6IGZ1bmN0aW9uICggZXYgKSB7CgkJaWYgKCB0eXBlb2YgZXYucHJldmVudERlZmF1bHQgPT0gImZ1bmN0aW9uIiApIHsKCQkJZXYucHJldmVudERlZmF1bHQoKTsKCQl9CgoJCXJldHVybiBldjsKCX0sCgoJLyoqCgkgKiBQYXJzZXMgYSBxdWVyeSBzdHJpbmcgJiBjb2VyY2VzIHZhbHVlcwoJICoKCSAqIEBtZXRob2QgcXVlcnlTdHJpbmcKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtTdHJpbmd9IGFyZyAgICAgW09wdGlvbmFsXSBLZXkgdG8gZmluZCBpbiB0aGUgcXVlcnlzdHJpbmcKCSAqIEBwYXJhbSAge1N0cmluZ30gcXN0cmluZyBbT3B0aW9uYWxdIFF1ZXJ5IHN0cmluZyB0byBwYXJzZQoJICogQHJldHVybiB7TWl4ZWR9ICAgICAgICAgIFZhbHVlIG9yIE9iamVjdCBvZiBrZXk6dmFsdWUgcGFpcnMKCSAqIEBwcml2YXRlCgkgKi8KCXF1ZXJ5U3RyaW5nIDogZnVuY3Rpb24gKCBhcmcsIHFzdHJpbmcgKSB7CgkJdmFyIG9iaiAgICA9IHt9LAoJCSAgICByZXN1bHQgPSBxc3RyaW5nICE9PSB1bmRlZmluZWQgPyAoIHFzdHJpbmcuaW5kZXhPZiggIj8iICkgPiAtMSA/IHFzdHJpbmcucmVwbGFjZSggLy4qXD8vLCAiIiApIDogbnVsbCApIDogKCBzZXJ2ZXIgfHwgc3RyaW5nLmlzRW1wdHkoIGxvY2F0aW9uLnNlYXJjaCApID8gbnVsbCA6IGxvY2F0aW9uLnNlYXJjaC5yZXBsYWNlKCAiPyIsICIiICkgKTsKCgkJaWYgKCByZXN1bHQgIT09IG51bGwgJiYgIXN0cmluZy5pc0VtcHR5KCByZXN1bHQgKSApIHsKCQkJcmVzdWx0ID0gcmVzdWx0LnNwbGl0KCAiJiIgKTsKCQkJYXJyYXkuZWFjaCggcmVzdWx0LCBmdW5jdGlvbiAoIHByb3AgKSB7CgkJCQl2YXIgaXRlbSA9IHByb3Auc3BsaXQoICI9IiApOwoKCQkJCWlmICggc3RyaW5nLmlzRW1wdHkoIGl0ZW1bMF0gKSApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJaWYgKCBpdGVtWzFdID09PSB1bmRlZmluZWQgKSB7CgkJCQkJaXRlbVsxXSA9ICIiOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJaXRlbVsxXSA9IHV0aWxpdHkuY29lcmNlKCBkZWNvZGVVUklDb21wb25lbnQoIGl0ZW1bMV0gKSApOwoJCQkJfQoKCQkJCWlmICggb2JqW2l0ZW1bMF1dID09PSB1bmRlZmluZWQgKSB7CgkJCQkJb2JqW2l0ZW1bMF1dID0gaXRlbVsxXTsKCQkJCX0KCQkJCWVsc2UgaWYgKCAhKCBvYmpbaXRlbVswXV0gaW5zdGFuY2VvZiBBcnJheSApICkgewoJCQkJCW9ialtpdGVtWzBdXSA9IFtvYmpbaXRlbVswXV1dOwoJCQkJCW9ialtpdGVtWzBdXS5wdXNoKCBpdGVtWzFdICk7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlvYmpbaXRlbVswXV0ucHVzaCggaXRlbVsxXSApOwoJCQkJfQoJCQl9ICk7CgkJfQoKCQlpZiAoIGFyZyAhPT0gbnVsbCAmJiBhcmcgIT09IHVuZGVmaW5lZCApIHsKCQkJb2JqID0gb2JqW2FyZ107CgkJfQoKCQlyZXR1cm4gb2JqOwoJfSwKCgkvKioKCSAqIEFjY2VwdHMgRGVmZXJyZWRzIG9yIFByb21pc2VzIGFzIGFyZ3VtZW50cywgb3IgYW4gQXJyYXkgb2YgZWl0aGVyCgkgKgoJICogQG1ldGhvZCByYWNlCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHJldHVybiB7T2JqZWN0fSB7QGxpbmsga2VpZ2FpLkRlZmVycmVkfQoJICogQGV4YW1wbGUKCSAqIHZhciBkZWZlcnJlZHMgPSBbXSwKCSAqICAgICBkZWZlcjEgICAgPSBrZWlnYWkudXRpbC5kZWZlcigpLAoJICogICAgIGRlZmVyMiAgICA9IGtlaWdhaS51dGlsLmRlZmVyKCk7CgkgKgoJICogZGVmZXJyZWRzLnB1c2goIGRlZmVyMSApOwoJICogZGVmZXJyZWRzLnB1c2goIGRlZmVyMiApOwoJICoKCSAqIC8vIEV4ZWN1dGVzIHdoZW4gb25lIGRlZmVycmVkIGlzIHJlc29sdmVkIG9yIHJlamVjdGVkCgkgKiBrZWlnYWkudXRpbC5yYWNlKCBkZWZlcnJlZHMgKS50aGVuKCBmdW5jdGlvbiAoIGFyZyApICkgewoJICogICAuLi4KCSAqIH0sIGZ1bmN0aW9uICggZXJyICkgewoJICogICAuLi4KCSAqIH0gKTsKCSAqCgkgKiAuLi4KCSAqCgkgKiBkZWZlcjEucmVzb2x2ZSggdHJ1ZSApOwoJICogZGVmZXIyLnJlc29sdmUoIHRydWUgKTsKCSAqLwoJcmFjZSA6IGZ1bmN0aW9uICgpIHsKCQl2YXIgZGVmZXIgPSBkZWZlcnJlZC5mYWN0b3J5KCksCgkJICAgIGFyZ3MgID0gYXJyYXkuY2FzdCggYXJndW1lbnRzICk7CgoJCS8vIERpZCB3ZSByZWNlaXZlIGFuIEFycmF5PyBpZiBzbyBpdCBvdmVycmlkZXMgYW55IG90aGVyIGFyZ3VtZW50cwoJCWlmICggYXJnc1swXSBpbnN0YW5jZW9mIEFycmF5ICkgewoJCQlhcmdzID0gYXJnc1swXTsKCQl9CgoJCS8vIE5vbmUsIGVuZCBvbiBuZXh0IHRpY2sKCQlpZiAoIGFyZ3MubGVuZ3RoID09PSAwICkgewoJCQlkZWZlci5yZXNvbHZlKCBudWxsICk7CgkJfQoJCS8vIFNldHVwIGFuZCB3YWl0CgkJZWxzZSB7CgkJCVByb21pc2UucmFjZSggYXJncyApLnRoZW4oIGZ1bmN0aW9uICggcmVzdWx0cyApIHsKCQkJCWRlZmVyLnJlc29sdmUoIHJlc3VsdHMgKTsKCQkJfSwgZnVuY3Rpb24gKCBlICkgewoJCQkJZGVmZXIucmVqZWN0KCBlICk7CgkJCX0gKTsKCQl9CgoJCXJldHVybiBkZWZlcjsKCX0sCgoJLyoqCgkgKiBBc3luY2hyb25vdXMgRE9NIHJlbmRlcmluZyAoY2Fubm90IGJlIGNhbmNlbGxlZCwgc3VnZ2VzdGVkIGZvciByZWFjdGl2ZSBiZWhhdmlvcikKCSAqCgkgKiBAbWV0aG9kIHJlbmRlcgoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge0Z1bmN0aW9ufSBmbiBGdW5jdGlvbiB0byBleGVjdXRlIG9uIG5leHQgJ2ZyYW1lJwoJICogQHJldHVybiB7T2JqZWN0fSB7QGxpbmsga2VpZ2FpLkRlZmVycmVkfQoJICogQGV4YW1wbGUKCSAqIGtlaWdhaS51dGlsLnJlbmRlciggZnVuY3Rpb24gKCkgewoJICogICAgIHJldHVybiBrZWl0YWkudXRpbC5lbGVtZW50Lmh0bWwoIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoICIjaWQiICksICJIZWxsbyBXb3JsZCIgKQoJICogfSApLnRoZW4oIGZ1bmN0aW9uICggYXJnICkgewoJICogICAgIC8vIGFyZyBpcyB0aGUgcmV0dXJuIHZhbHVlIG9mIHlvdXIgZnVuY3Rpb24KCSAqIH0sIGZ1bmN0aW9uICggZSApIHsKCSAqICAgICAvLyBIYW5kbGUgZQoJICogfSApOwoJICovCglyZW5kZXIgOiBmdW5jdGlvbiAoIGZuICkgewoJCXZhciBkZWZlciA9IGRlZmVycmVkLmZhY3RvcnkoKTsKCgkJUkVOREVSKCBmdW5jdGlvbiAoIGFyZyApIHsKCQkJdHJ5IHsKCQkJCWRlZmVyLnJlc29sdmUoIGZuKCBhcmcgKSApOwoJCQl9CgkJCWNhdGNoICggZSApIHsKCQkJCWRlZmVyLnJlamVjdCggZSApOwoJCQl9CgkJfSApOwoKCQlyZXR1cm4gZGVmZXI7Cgl9LAoKCS8qKgoJICogQ3JlYXRlcyBhIHJlY3Vyc2l2ZSBmdW5jdGlvbi4gUmV0dXJuIGZhbHNlIGZyb20gdGhlIGZ1bmN0aW9uIHRvIGhhbHQgcmVjdXJzaW9uLgoJICoKCSAqIEBtZXRob2QgcmVwZWF0CgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7RnVuY3Rpb259IGZuICBGdW5jdGlvbiB0byBleGVjdXRlIHJlcGVhdGVkbHkKCSAqIEBwYXJhbSAge051bWJlcn0gICBtcyAgTWlsbGlzZWNvbmRzIHRvIHN0YWdnZXIgdGhlIGV4ZWN1dGlvbgoJICogQHBhcmFtICB7U3RyaW5nfSAgIGlkICBbT3B0aW9uYWxdIFRpbWVvdXQgSUQKCSAqIEBwYXJhbSAge0Jvb2xlYW59ICBub3cgRXhlY3V0ZXMgYGZuYCBhbmQgdGhlbiBzZXR1cCByZXBldGl0aW9uLCBkZWZhdWx0IGlzIGB0cnVlYAoJICogQHJldHVybiB7U3RyaW5nfSAgICAgICBUaW1lb3V0IElECgkgKiBAZXhhbXBsZQoJICoga2VpZ2FpLnV0aWwucmVwZWF0KCBmdW5jdGlvbiAoKSB7CgkgKiAgIC4uLgoJICoKCSAqICAgLy8gQ2FuY2VsbGluZyByZXBldGl0aW9uIGF0IHNvbWUgcG9pbnQgaW4gdGhlIGZ1dHVyZQoJICogICBpZiAoIHNvbWVDb25kaXRpb24gKSB7CgkgKiAgICAgcmV0dXJuIGZhbHNlOwoJICogICB9CgkgKiB9LCAxMDAwLCAicmVwZWF0aW5nIiApOwoJICovCglyZXBlYXQgOiBmdW5jdGlvbiAoIGZuLCBtcywgaWQsIG5vdyApIHsKCQltcyAgPSBtcyB8fCAxMDsKCQlpZCAgPSBpZCB8fCB1dGlsaXR5LnV1aWQoIHRydWUgKTsKCQlub3cgPSAoIG5vdyAhPT0gZmFsc2UgKTsKCgkJLy8gQ291bGQgYmUgdmFsaWQgdG8gcmV0dXJuIGZhbHNlIGZyb20gaW5pdGlhbCBleGVjdXRpb24KCQlpZiAoIG5vdyAmJiBmbigpID09PSBmYWxzZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gQ3JlYXRpbmcgcmVwZWF0aW5nIGV4ZWN1dGlvbgoJCXV0aWxpdHkuZGVmZXIoIGZ1bmN0aW9uICgpIHsKCQkJdmFyIHJlY3Vyc2l2ZSA9IGZ1bmN0aW9uICggZm4sIG1zLCBpZCApIHsKCQkJCXZhciByZWN1cnNpdmUgPSB0aGlzOwoKCQkJCWlmICggZm4oKSAhPT0gZmFsc2UgKSB7CgkJCQkJdXRpbGl0eS5yZXBlYXRpbmdbaWRdID0gc2V0VGltZW91dCggZnVuY3Rpb24gKCkgewoJCQkJCQlyZWN1cnNpdmUuY2FsbCggcmVjdXJzaXZlLCBmbiwgbXMsIGlkICk7CgkJCQkJfSwgbXMgKTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWRlbGV0ZSB1dGlsaXR5LnJlcGVhdGluZ1tpZF07CgkJCQl9CgkJCX07CgoJCQlyZWN1cnNpdmUuY2FsbCggcmVjdXJzaXZlLCBmbiwgbXMsIGlkICk7CgkJfSwgbXMsIGlkLCB0cnVlICk7CgoJCXJldHVybiBpZDsKCX0sCgoJLyoqCgkgKiBTdG9wcyBhbiBFdmVudCBmcm9tIGJ1YmJsaW5nLCAmIHByZXZlbnRzIGRlZmF1bHQgYmVoYXZpb3IKCSAqCgkgKiBAbWV0aG9kIHN0b3AKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtPYmplY3R9IGV2IEV2ZW50CgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgIEV2ZW50CgkgKiBAZXhhbXBsZQoJICoga2VpZ2FpLnV0aWwuc3RvcCggRXZlbnQgKTsKCSAqLwoJc3RvcCA6IGZ1bmN0aW9uICggZXYgKSB7CgkJaWYgKCB0eXBlb2YgZXYuc3RvcFByb3BhZ2F0aW9uID09ICJmdW5jdGlvbiIgKSB7CgkJCWV2LnN0b3BQcm9wYWdhdGlvbigpOwoJCX0KCgkJdXRpbGl0eS5wcmV2ZW50KCBldiApOwoKCQlyZXR1cm4gZXY7Cgl9LAoKCS8qKgoJICogUmV0dXJucyB0aGUgRXZlbnQgdGFyZ2V0CgkgKgoJICogQG1ldGhvZCB0YXJnZXQKCSAqIEBtZW1iZXJPZiB1dGlsaXR5CgkgKiBAcGFyYW0gIHtPYmplY3R9IGV2IEV2ZW50CgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgIEV2ZW50IHRhcmdldAoJICogQGV4YW1wbGUKCSAqIHZhciB0YXJnZXQgPSBrZWlnYWkudXRpbC50YXJnZXQoIEV2ZW50ICk7CgkgKi8KCXRhcmdldCA6IGZ1bmN0aW9uICggZXYgKSB7CgkJcmV0dXJuIGV2LnRhcmdldCB8fCBldi5zcmNFbGVtZW50OwoJfSwKCgkvKioKCSAqIEdlbmVyYXRlcyBhIHZlcnNpb24gNCBVVUlECgkgKgoJICogQG1ldGhvZCB1dWlkCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7Qm9vbGVhbn0gc3RyaXAgW09wdGlvbmFsXSBTdHJpcHMgLSBmcm9tIFVVSUQKCSAqIEByZXR1cm4ge1N0cmluZ30gICAgICAgIFVVSUQKCSAqIEBleGFtcGxlCgkgKiB2YXIgdXVpZDQgPSBrZWlnYWkudXRpbC51dWlkKCk7CgkgKi8KCXV1aWQgOiBmdW5jdGlvbiAoIHN0cmlwICkgewoJCXZhciBzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gKCAoICggMSArIE1hdGgucmFuZG9tKCkgKSAqIDB4MTAwMDAgKSB8IDAgKS50b1N0cmluZyggMTYgKS5zdWJzdHJpbmcoIDEgKTsgfSwKCQkgICAgciA9IFs4LCA5LCAiYSIsICJiIl0sCgkJICAgIG87CgoJCW8gPSAoIHMoKSArIHMoKSArICItIiArIHMoKSArICItNCIgKyBzKCkuc3Vic3RyKCAwLCAzICkgKyAiLSIgKyByW01hdGguZmxvb3IoIE1hdGgucmFuZG9tKCkgKiA0ICldICsgcygpLnN1YnN0ciggMCwgMyApICsgIi0iICsgcygpICsgcygpICsgcygpICk7CgoJCWlmICggc3RyaXAgPT09IHRydWUgKSB7CgkJCW8gPSBvLnJlcGxhY2UoIC8tL2csICIiICk7CgkJfQoKCQlyZXR1cm4gbzsKCX0sCgoJLyoqCgkgKiBXYWxrcyBgb2JqYCBhbmQgcmV0dXJucyBgYXJnYCwgZm9yIHdoZW4geW91IGNhbid0IGVhc2lseSBhY2Nlc3MgYGFyZ2AKCSAqCgkgKiBAbWV0aG9kICB3YWxrCgkgKiBAbWVtYmVyT2YgdXRpbGl0eQoJICogQHBhcmFtICB7TWl4ZWR9ICBvYmogIE9iamVjdCBvciBBcnJheQoJICogQHBhcmFtICB7U3RyaW5nfSBhcmcgIFN0cmluZyBkZXNjcmliaW5nIHRoZSBwcm9wZXJ0eSB0byByZXR1cm4KCSAqIEByZXR1cm4ge01peGVkfSAgICAgICBUYXJnZXQgb3IgdW5kZWZpbmVkCgkgKiBAZXhhbXBsZQoJICogdmFyIG9iaiA9IHthOiBbe2I6IHRydWV9XX07CgkgKgoJICoga2VpZ2FpLnV0aWwud2Fsayggb2JqLCAiYVswXS5iIiApOyAvLyB0cnVlCgkgKi8KCXdhbGsgOiBmdW5jdGlvbiAoIG9iaiwgYXJnICkgewoJCXZhciBvdXRwdXQgPSBvYmo7CgoJCWFycmF5LmVhY2goIGFyZy5yZXBsYWNlKCAvXF0kLywgIiIgKS5yZXBsYWNlKCAvXF0vZywgIi4iICkucmVwbGFjZSggL1wuXC4vZywgIi4iICkuc3BsaXQoIC9cLnxcWy8gKSwgZnVuY3Rpb24gKCBpICkgewoJCQlpZiAoIG91dHB1dFtpXSA9PT0gdW5kZWZpbmVkIHx8IG91dHB1dFtpXSA9PT0gbnVsbCApIHsKCQkJCW91dHB1dCA9IHVuZGVmaW5lZDsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJb3V0cHV0ID0gb3V0cHV0W2ldOwoJCX0gKTsKCgkJcmV0dXJuIG91dHB1dDsKCX0sCgoJLyoqCgkgKiBBY2NlcHRzIERlZmVycmVkcyBvciBQcm9taXNlcyBhcyBhcmd1bWVudHMsIG9yIGFuIEFycmF5IG9mIGVpdGhlcgoJICoKCSAqIEBtZXRob2Qgd2hlbgoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEByZXR1cm4ge09iamVjdH0ge0BsaW5rIGtlaWdhaS5EZWZlcnJlZH0KCSAqIEBleGFtcGxlCgkgKiB2YXIgZGVmZXJyZWRzID0gW10sCgkgKiAgICAgZGVmZXIxICAgID0ga2VpZ2FpLnV0aWwuZGVmZXIoKSwKCSAqICAgICBkZWZlcjIgICAgPSBrZWlnYWkudXRpbC5kZWZlcigpOwoJICoKCSAqIGRlZmVycmVkcy5wdXNoKCBkZWZlcjEgKTsKCSAqIGRlZmVycmVkcy5wdXNoKCBkZWZlcjIgKTsKCSAqCgkgKiAvLyBFeGVjdXRlcyB3aGVuIGJvdGggZGVmZXJyZWRzIGhhdmUgcmVzb2x2ZWQgb3Igb25lIGhhcyByZWplY3RlZAoJICoga2VpZ2FpLnV0aWwud2hlbiggZGVmZXJyZWRzICkudGhlbiggZnVuY3Rpb24gKCBhcmdzICkgKSB7CgkgKiAgIC4uLgoJICogfSwgZnVuY3Rpb24gKCBlcnIgKSB7CgkgKiAgIC4uLgoJICogfSApOwoJICoKCSAqIC4uLgoJICoKCSAqIGRlZmVyMS5yZXNvbHZlKCB0cnVlICk7CgkgKiBkZWZlcjIucmVzb2x2ZSggdHJ1ZSApOwoJICovCgl3aGVuIDogZnVuY3Rpb24gKCkgewoJCXZhciBkZWZlciA9IGRlZmVycmVkLmZhY3RvcnkoKSwKCQkgICAgYXJncyAgPSBhcnJheS5jYXN0KCBhcmd1bWVudHMgKTsKCgkJLy8gRGlkIHdlIHJlY2VpdmUgYW4gQXJyYXk/IGlmIHNvIGl0IG92ZXJyaWRlcyBhbnkgb3RoZXIgYXJndW1lbnRzCgkJaWYgKCBhcmdzWzBdIGluc3RhbmNlb2YgQXJyYXkgKSB7CgkJCWFyZ3MgPSBhcmdzWzBdOwoJCX0KCgkJLy8gTm9uZSwgZW5kIG9uIG5leHQgdGljawoJCWlmICggYXJncy5sZW5ndGggPT09IDAgKSB7CgkJCWRlZmVyLnJlc29sdmUoIG51bGwgKTsKCQl9CgkJLy8gU2V0dXAgYW5kIHdhaXQKCQllbHNlIHsKCQkJUHJvbWlzZS5hbGwoIGFyZ3MgKS50aGVuKCBmdW5jdGlvbiAoIHJlc3VsdHMgKSB7CgkJCQlkZWZlci5yZXNvbHZlKCByZXN1bHRzICk7CgkJCX0sIGZ1bmN0aW9uICggZSApIHsKCQkJCWRlZmVyLnJlamVjdCggZSApOwoJCQl9ICk7CgkJfQoKCQlyZXR1cm4gZGVmZXI7Cgl9LAoKCS8qKgoJICogV29ya2VyIGZhY3RvcnkKCSAqCgkgKiBAbWV0aG9kIHdvcmtlcgoJICogQG1lbWJlck9mIHV0aWxpdHkKCSAqIEBwYXJhbSAge09iamVjdH0gZGVmZXIgRGVmZXJyZWQgdG8gcmVjZWl2ZSBtZXNzYWdlIGZyb20gV29ya2VyCgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgIFdvcmtlcgoJICogQHByaXZhdGUKCSAqLwoJd29ya2VyIDogZnVuY3Rpb24gKCBkZWZlciApIHsKCQl2YXIgb2JqID0gbmV3IFdvcmtlciggV09SS0VSICk7CgoJCW9iai5vbmVycm9yID0gZnVuY3Rpb24gKCBlcnIgKSB7CgkJCWRlZmVyLnJlamVjdCggZXJyICk7CgkJCW9iai50ZXJtaW5hdGUoKTsKCQl9OwoKCQlvYmoub25tZXNzYWdlID0gZnVuY3Rpb24gKCBldiApIHsKCQkJZGVmZXIucmVzb2x2ZSggZXYuZGF0YSApOwoJCQlvYmoudGVybWluYXRlKCk7CgkJfTsKCgkJcmV0dXJuIG9iajsKCX0KfTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 07:59:18 GMT",
                    "Content-Length": "23730",
                    "Date": "Fri, 07 Nov 2014 07:59:19 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}