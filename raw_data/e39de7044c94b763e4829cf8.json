{
    "url": "http://localhost:9999/FinalAngel/classjs/docs/_build/html/_static/websupport.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>document.location.hash</b> and written to <b>$()</b> via the following statements:<ul><li>var anchor = document.location.hash;</li><li>$('#ao' + anchor.substring(9)).click();</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/FinalAngel/classjs/docs/_build/html/_static/websupport.js",
                "path": "/FinalAngel/classjs/docs/_build/html/_static/websupport.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9GaW5hbEFuZ2VsL2NsYXNzanMvZG9jcy9fYnVpbGQvaHRtbC9fc3RhdGljL3dlYnN1cHBvcnQuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjUyNDYNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMTU6MjQ6NTEgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDE1OjI0OjQ3IEdNVA0KDQovKgogKiB3ZWJzdXBwb3J0LmpzCiAqIH5+fn5+fn5+fn5+fn4KICoKICogc3BoaW54LndlYnN1cHBvcnQgdXRpbHRpZXMgZm9yIGFsbCBkb2N1bWVudGF0aW9uLgogKgogKiA6Y29weXJpZ2h0OiBDb3B5cmlnaHQgMjAwNy0yMDExIGJ5IHRoZSBTcGhpbnggdGVhbSwgc2VlIEFVVEhPUlMuCiAqIDpsaWNlbnNlOiBCU0QsIHNlZSBMSUNFTlNFIGZvciBkZXRhaWxzLgogKgogKi8KCihmdW5jdGlvbigkKSB7CiAgJC5mbi5hdXRvZ3JvdyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgIHZhciB0ZXh0YXJlYSA9IHRoaXM7CgogICAgJC5mbi5hdXRvZ3Jvdy5yZXNpemUodGV4dGFyZWEpOwoKICAgICQodGV4dGFyZWEpCiAgICAgIC5mb2N1cyhmdW5jdGlvbigpIHsKICAgICAgICB0ZXh0YXJlYS5pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgICAgJC5mbi5hdXRvZ3Jvdy5yZXNpemUodGV4dGFyZWEpOwogICAgICAgIH0sIDUwMCk7CiAgICAgIH0pCiAgICAgIC5ibHVyKGZ1bmN0aW9uKCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwodGV4dGFyZWEuaW50ZXJ2YWwpOwogICAgICB9KTsKICAgIH0pOwogIH07CgogICQuZm4uYXV0b2dyb3cucmVzaXplID0gZnVuY3Rpb24odGV4dGFyZWEpIHsKICAgIHZhciBsaW5lSGVpZ2h0ID0gcGFyc2VJbnQoJCh0ZXh0YXJlYSkuY3NzKCdsaW5lLWhlaWdodCcpLCAxMCk7CiAgICB2YXIgbGluZXMgPSB0ZXh0YXJlYS52YWx1ZS5zcGxpdCgnXG4nKTsKICAgIHZhciBjb2x1bW5zID0gdGV4dGFyZWEuY29sczsKICAgIHZhciBsaW5lQ291bnQgPSAwOwogICAgJC5lYWNoKGxpbmVzLCBmdW5jdGlvbigpIHsKICAgICAgbGluZUNvdW50ICs9IE1hdGguY2VpbCh0aGlzLmxlbmd0aCAvIGNvbHVtbnMpIHx8IDE7CiAgICB9KTsKICAgIHZhciBoZWlnaHQgPSBsaW5lSGVpZ2h0ICogKGxpbmVDb3VudCArIDEpOwogICAgJCh0ZXh0YXJlYSkuY3NzKCdoZWlnaHQnLCBoZWlnaHQpOwogIH07Cn0pKGpRdWVyeSk7CgooZnVuY3Rpb24oJCkgewogIHZhciBjb21wLCBieTsKCiAgZnVuY3Rpb24gaW5pdCgpIHsKICAgIGluaXRFdmVudHMoKTsKICAgIGluaXRDb21wYXJhdG9yKCk7CiAgfQoKICBmdW5jdGlvbiBpbml0RXZlbnRzKCkgewogICAgJCgnYS5jb21tZW50LWNsb3NlJykubGl2ZSgiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBoaWRlKCQodGhpcykuYXR0cignaWQnKS5zdWJzdHJpbmcoMikpOwogICAgfSk7CiAgICAkKCdhLnZvdGUnKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGhhbmRsZVZvdGUoJCh0aGlzKSk7CiAgICB9KTsKICAgICQoJ2EucmVwbHknKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIG9wZW5SZXBseSgkKHRoaXMpLmF0dHIoJ2lkJykuc3Vic3RyaW5nKDIpKTsKICAgIH0pOwogICAgJCgnYS5jbG9zZS1yZXBseScpLmxpdmUoImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgY2xvc2VSZXBseSgkKHRoaXMpLmF0dHIoJ2lkJykuc3Vic3RyaW5nKDIpKTsKICAgIH0pOwogICAgJCgnYS5zb3J0LW9wdGlvbicpLmxpdmUoImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgaGFuZGxlUmVTb3J0KCQodGhpcykpOwogICAgfSk7CiAgICAkKCdhLnNob3ctcHJvcG9zYWwnKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHNob3dQcm9wb3NhbCgkKHRoaXMpLmF0dHIoJ2lkJykuc3Vic3RyaW5nKDIpKTsKICAgIH0pOwogICAgJCgnYS5oaWRlLXByb3Bvc2FsJykubGl2ZSgiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBoaWRlUHJvcG9zYWwoJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICB9KTsKICAgICQoJ2Euc2hvdy1wcm9wb3NlLWNoYW5nZScpLmxpdmUoImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgc2hvd1Byb3Bvc2VDaGFuZ2UoJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICB9KTsKICAgICQoJ2EuaGlkZS1wcm9wb3NlLWNoYW5nZScpLmxpdmUoImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgaGlkZVByb3Bvc2VDaGFuZ2UoJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICB9KTsKICAgICQoJ2EuYWNjZXB0LWNvbW1lbnQnKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGFjY2VwdENvbW1lbnQoJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICB9KTsKICAgICQoJ2EuZGVsZXRlLWNvbW1lbnQnKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGRlbGV0ZUNvbW1lbnQoJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICB9KTsKICAgICQoJ2EuY29tbWVudC1tYXJrdXAnKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHRvZ2dsZUNvbW1lbnRNYXJrdXBCb3goJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICB9KTsKICB9CgogIC8qKgogICAqIFNldCBjb21wLCB3aGljaCBpcyBhIGNvbXBhcmF0b3IgZnVuY3Rpb24gdXNlZCBmb3Igc29ydGluZyBhbmQKICAgKiBpbnNlcnRpbmcgY29tbWVudHMgaW50byB0aGUgbGlzdC4KICAgKi8KICBmdW5jdGlvbiBzZXRDb21wYXJhdG9yKCkgewogICAgLy8gSWYgdGhlIGZpcnN0IHRocmVlIGxldHRlcnMgYXJlICJhc2MiLCBzb3J0IGluIGFzY2VuZGluZyBvcmRlcgogICAgLy8gYW5kIHJlbW92ZSB0aGUgcHJlZml4LgogICAgaWYgKGJ5LnN1YnN0cmluZygwLDMpID09ICdhc2MnKSB7CiAgICAgIHZhciBpID0gYnkuc3Vic3RyaW5nKDMpOwogICAgICBjb21wID0gZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gYVtpXSAtIGJbaV07IH07CiAgICB9IGVsc2UgewogICAgICAvLyBPdGhlcndpc2Ugc29ydCBpbiBkZXNjZW5kaW5nIG9yZGVyLgogICAgICBjb21wID0gZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gYltieV0gLSBhW2J5XTsgfTsKICAgIH0KCiAgICAvLyBSZXNldCBsaW5rIHN0eWxlcyBhbmQgZm9ybWF0IHRoZSBzZWxlY3RlZCBzb3J0IG9wdGlvbi4KICAgICQoJ2Euc2VsJykuYXR0cignaHJlZicsICcjJykucmVtb3ZlQ2xhc3MoJ3NlbCcpOwogICAgJCgnYS5ieScgKyBieSkucmVtb3ZlQXR0cignaHJlZicpLmFkZENsYXNzKCdzZWwnKTsKICB9CgogIC8qKgogICAqIENyZWF0ZSBhIGNvbXAgZnVuY3Rpb24uIElmIHRoZSB1c2VyIGhhcyBwcmVmZXJlbmNlcyBzdG9yZWQgaW4KICAgKiB0aGUgc29ydEJ5IGNvb2tpZSwgdXNlIHRob3NlLCBvdGhlcndpc2UgdXNlIHRoZSBkZWZhdWx0LgogICAqLwogIGZ1bmN0aW9uIGluaXRDb21wYXJhdG9yKCkgewogICAgYnkgPSAncmF0aW5nJzsgLy8gRGVmYXVsdCB0byBzb3J0IGJ5IHJhdGluZy4KICAgIC8vIElmIHRoZSBzb3J0QnkgY29va2llIGlzIHNldCwgdXNlIHRoYXQgaW5zdGVhZC4KICAgIGlmIChkb2N1bWVudC5jb29raWUubGVuZ3RoID4gMCkgewogICAgICB2YXIgc3RhcnQgPSBkb2N1bWVudC5jb29raWUuaW5kZXhPZignc29ydEJ5PScpOwogICAgICBpZiAoc3RhcnQgIT0gLTEpIHsKICAgICAgICBzdGFydCA9IHN0YXJ0ICsgNzsKICAgICAgICB2YXIgZW5kID0gZG9jdW1lbnQuY29va2llLmluZGV4T2YoIjsiLCBzdGFydCk7CiAgICAgICAgaWYgKGVuZCA9PSAtMSkgewogICAgICAgICAgZW5kID0gZG9jdW1lbnQuY29va2llLmxlbmd0aDsKICAgICAgICAgIGJ5ID0gdW5lc2NhcGUoZG9jdW1lbnQuY29va2llLnN1YnN0cmluZyhzdGFydCwgZW5kKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBzZXRDb21wYXJhdG9yKCk7CiAgfQoKICAvKioKICAgKiBTaG93IGEgY29tbWVudCBkaXYuCiAgICovCiAgZnVuY3Rpb24gc2hvdyhpZCkgewogICAgJCgnI2FvJyArIGlkKS5oaWRlKCk7CiAgICAkKCcjYWgnICsgaWQpLnNob3coKTsKICAgIHZhciBjb250ZXh0ID0gJC5leHRlbmQoe2lkOiBpZH0sIG9wdHMpOwogICAgdmFyIHBvcHVwID0gJChyZW5kZXJUZW1wbGF0ZShwb3B1cFRlbXBsYXRlLCBjb250ZXh0KSkuaGlkZSgpOwogICAgcG9wdXAuZmluZCgndGV4dGFyZWFbbmFtZT0icHJvcG9zYWwiXScpLmhpZGUoKTsKICAgIHBvcHVwLmZpbmQoJ2EuYnknICsgYnkpLmFkZENsYXNzKCdzZWwnKTsKICAgIHZhciBmb3JtID0gcG9wdXAuZmluZCgnI2NmJyArIGlkKTsKICAgIGZvcm0uc3VibWl0KGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGFkZENvbW1lbnQoZm9ybSk7CiAgICB9KTsKICAgICQoJyNzJyArIGlkKS5hZnRlcihwb3B1cCk7CiAgICBwb3B1cC5zbGlkZURvd24oJ2Zhc3QnLCBmdW5jdGlvbigpIHsKICAgICAgZ2V0Q29tbWVudHMoaWQpOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBIaWRlIGEgY29tbWVudCBkaXYuCiAgICovCiAgZnVuY3Rpb24gaGlkZShpZCkgewogICAgJCgnI2FoJyArIGlkKS5oaWRlKCk7CiAgICAkKCcjYW8nICsgaWQpLnNob3coKTsKICAgIHZhciBkaXYgPSAkKCcjc2MnICsgaWQpOwogICAgZGl2LnNsaWRlVXAoJ2Zhc3QnLCBmdW5jdGlvbigpIHsKICAgICAgZGl2LnJlbW92ZSgpOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBQZXJmb3JtIGFuIGFqYXggcmVxdWVzdCB0byBnZXQgY29tbWVudHMgZm9yIGEgbm9kZQogICAqIGFuZCBpbnNlcnQgdGhlIGNvbW1lbnRzIGludG8gdGhlIGNvbW1lbnRzIHRyZWUuCiAgICovCiAgZnVuY3Rpb24gZ2V0Q29tbWVudHMoaWQpIHsKICAgICQuYWpheCh7CiAgICAgdHlwZTogJ0dFVCcsCiAgICAgdXJsOiBvcHRzLmdldENvbW1lbnRzVVJMLAogICAgIGRhdGE6IHtub2RlOiBpZH0sCiAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgcmVxdWVzdCkgewogICAgICAgdmFyIHVsID0gJCgnI2NsJyArIGlkKTsKICAgICAgIHZhciBzcGVlZCA9IDEwMDsKICAgICAgICQoJyNjZicgKyBpZCkKICAgICAgICAgLmZpbmQoJ3RleHRhcmVhW25hbWU9InByb3Bvc2FsIl0nKQogICAgICAgICAuZGF0YSgnc291cmNlJywgZGF0YS5zb3VyY2UpOwoKICAgICAgIGlmIChkYXRhLmNvbW1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICB1bC5odG1sKCc8bGk+Tm8gY29tbWVudHMgeWV0LjwvbGk+Jyk7CiAgICAgICAgIHVsLmRhdGEoJ2VtcHR5JywgdHJ1ZSk7CiAgICAgICB9IGVsc2UgewogICAgICAgICAvLyBJZiB0aGVyZSBhcmUgY29tbWVudHMsIHNvcnQgdGhlbSBhbmQgcHV0IHRoZW0gaW4gdGhlIGxpc3QuCiAgICAgICAgIHZhciBjb21tZW50cyA9IHNvcnRDb21tZW50cyhkYXRhLmNvbW1lbnRzKTsKICAgICAgICAgc3BlZWQgPSBkYXRhLmNvbW1lbnRzLmxlbmd0aCAqIDEwMDsKICAgICAgICAgYXBwZW5kQ29tbWVudHMoY29tbWVudHMsIHVsKTsKICAgICAgICAgdWwuZGF0YSgnZW1wdHknLCBmYWxzZSk7CiAgICAgICB9CiAgICAgICAkKCcjY24nICsgaWQpLnNsaWRlVXAoc3BlZWQgKyAyMDApOwogICAgICAgdWwuc2xpZGVEb3duKHNwZWVkKTsKICAgICB9LAogICAgIGVycm9yOiBmdW5jdGlvbihyZXF1ZXN0LCB0ZXh0U3RhdHVzLCBlcnJvcikgewogICAgICAgc2hvd0Vycm9yKCdPb3BzLCB0aGVyZSB3YXMgYSBwcm9ibGVtIHJldHJpZXZpbmcgdGhlIGNvbW1lbnRzLicpOwogICAgIH0sCiAgICAgZGF0YVR5cGU6ICdqc29uJwogICAgfSk7CiAgfQoKICAvKioKICAgKiBBZGQgYSBjb21tZW50IHZpYSBhamF4IGFuZCBpbnNlcnQgdGhlIGNvbW1lbnQgaW50byB0aGUgY29tbWVudCB0cmVlLgogICAqLwogIGZ1bmN0aW9uIGFkZENvbW1lbnQoZm9ybSkgewogICAgdmFyIG5vZGVfaWQgPSBmb3JtLmZpbmQoJ2lucHV0W25hbWU9Im5vZGUiXScpLnZhbCgpOwogICAgdmFyIHBhcmVudF9pZCA9IGZvcm0uZmluZCgnaW5wdXRbbmFtZT0icGFyZW50Il0nKS52YWwoKTsKICAgIHZhciB0ZXh0ID0gZm9ybS5maW5kKCd0ZXh0YXJlYVtuYW1lPSJjb21tZW50Il0nKS52YWwoKTsKICAgIHZhciBwcm9wb3NhbCA9IGZvcm0uZmluZCgndGV4dGFyZWFbbmFtZT0icHJvcG9zYWwiXScpLnZhbCgpOwoKICAgIGlmICh0ZXh0ID09ICcnKSB7CiAgICAgIHNob3dFcnJvcignUGxlYXNlIGVudGVyIGEgY29tbWVudC4nKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIERpc2FibGUgdGhlIGZvcm0gdGhhdCBpcyBiZWluZyBzdWJtaXR0ZWQuCiAgICBmb3JtLmZpbmQoJ3RleHRhcmVhLGlucHV0JykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTsKCiAgICAvLyBTZW5kIHRoZSBjb21tZW50IHRvIHRoZSBzZXJ2ZXIuCiAgICAkLmFqYXgoewogICAgICB0eXBlOiAiUE9TVCIsCiAgICAgIHVybDogb3B0cy5hZGRDb21tZW50VVJMLAogICAgICBkYXRhVHlwZTogJ2pzb24nLAogICAgICBkYXRhOiB7CiAgICAgICAgbm9kZTogbm9kZV9pZCwKICAgICAgICBwYXJlbnQ6IHBhcmVudF9pZCwKICAgICAgICB0ZXh0OiB0ZXh0LAogICAgICAgIHByb3Bvc2FsOiBwcm9wb3NhbAogICAgICB9LAogICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCBlcnJvcikgewogICAgICAgIC8vIFJlc2V0IHRoZSBmb3JtLgogICAgICAgIGlmIChub2RlX2lkKSB7CiAgICAgICAgICBoaWRlUHJvcG9zZUNoYW5nZShub2RlX2lkKTsKICAgICAgICB9CiAgICAgICAgZm9ybS5maW5kKCd0ZXh0YXJlYScpCiAgICAgICAgICAudmFsKCcnKQogICAgICAgICAgLmFkZChmb3JtLmZpbmQoJ2lucHV0JykpCiAgICAgICAgICAucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKCXZhciB1bCA9ICQoJyNjbCcgKyAobm9kZV9pZCB8fCBwYXJlbnRfaWQpKTsKICAgICAgICBpZiAodWwuZGF0YSgnZW1wdHknKSkgewogICAgICAgICAgJCh1bCkuZW1wdHkoKTsKICAgICAgICAgIHVsLmRhdGEoJ2VtcHR5JywgZmFsc2UpOwogICAgICAgIH0KICAgICAgICBpbnNlcnRDb21tZW50KGRhdGEuY29tbWVudCk7CiAgICAgICAgdmFyIGFvID0gJCgnI2FvJyArIG5vZGVfaWQpOwogICAgICAgIGFvLmZpbmQoJ2ltZycpLmF0dHIoeydzcmMnOiBvcHRzLmNvbW1lbnRCcmlnaHRJbWFnZX0pOwogICAgICAgIGlmIChub2RlX2lkKSB7CiAgICAgICAgICAvLyBpZiB0aGlzIHdhcyBhICJyb290IiBjb21tZW50LCByZW1vdmUgdGhlIGNvbW1lbnRpbmcgYm94CiAgICAgICAgICAvLyAodGhlIHVzZXIgY2FuIGdldCBpdCBiYWNrIGJ5IHJlb3BlbmluZyB0aGUgY29tbWVudCBwb3B1cCkKICAgICAgICAgICQoJyNjYScgKyBub2RlX2lkKS5zbGlkZVVwKCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBlcnJvcjogZnVuY3Rpb24ocmVxdWVzdCwgdGV4dFN0YXR1cywgZXJyb3IpIHsKICAgICAgICBmb3JtLmZpbmQoJ3RleHRhcmVhLGlucHV0JykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKICAgICAgICBzaG93RXJyb3IoJ09vcHMsIHRoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIHRoZSBjb21tZW50LicpOwogICAgICB9CiAgICB9KTsKICB9CgogIC8qKgogICAqIFJlY3Vyc2l2ZWx5IGFwcGVuZCBjb21tZW50cyB0byB0aGUgbWFpbiBjb21tZW50IGxpc3QgYW5kIGNoaWxkcmVuCiAgICogbGlzdHMsIGNyZWF0aW5nIHRoZSBjb21tZW50IHRyZWUuCiAgICovCiAgZnVuY3Rpb24gYXBwZW5kQ29tbWVudHMoY29tbWVudHMsIHVsKSB7CiAgICAkLmVhY2goY29tbWVudHMsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgZGl2ID0gY3JlYXRlQ29tbWVudERpdih0aGlzKTsKICAgICAgdWwuYXBwZW5kKCQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKSkuaHRtbChkaXYpKTsKICAgICAgYXBwZW5kQ29tbWVudHModGhpcy5jaGlsZHJlbiwgZGl2LmZpbmQoJ3VsLmNvbW1lbnQtY2hpbGRyZW4nKSk7CiAgICAgIC8vIFRvIGF2b2lkIHN0YWduYXRpbmcgZGF0YSwgZG9uJ3Qgc3RvcmUgdGhlIGNvbW1lbnRzIGNoaWxkcmVuIGluIGRhdGEuCiAgICAgIHRoaXMuY2hpbGRyZW4gPSBudWxsOwogICAgICBkaXYuZGF0YSgnY29tbWVudCcsIHRoaXMpOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBBZnRlciBhZGRpbmcgYSBuZXcgY29tbWVudCwgaXQgbXVzdCBiZSBpbnNlcnRlZCBpbiB0aGUgY29ycmVjdAogICAqIGxvY2F0aW9uIGluIHRoZSBjb21tZW50IHRyZWUuCiAgICovCiAgZnVuY3Rpb24gaW5zZXJ0Q29tbWVudChjb21tZW50KSB7CiAgICB2YXIgZGl2ID0gY3JlYXRlQ29tbWVudERpdihjb21tZW50KTsKCiAgICAvLyBUbyBhdm9pZCBzdGFnbmF0aW5nIGRhdGEsIGRvbid0IHN0b3JlIHRoZSBjb21tZW50cyBjaGlsZHJlbiBpbiBkYXRhLgogICAgY29tbWVudC5jaGlsZHJlbiA9IG51bGw7CiAgICBkaXYuZGF0YSgnY29tbWVudCcsIGNvbW1lbnQpOwoKICAgIHZhciB1bCA9ICQoJyNjbCcgKyAoY29tbWVudC5ub2RlIHx8IGNvbW1lbnQucGFyZW50KSk7CiAgICB2YXIgc2libGluZ3MgPSBnZXRDaGlsZHJlbih1bCk7CgogICAgdmFyIGxpID0gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpKTsKICAgIGxpLmhpZGUoKTsKCiAgICAvLyBEZXRlcm1pbmUgd2hlcmUgaW4gdGhlIHBhcmVudHMgY2hpbGRyZW4gbGlzdCB0byBpbnNlcnQgdGhpcyBjb21tZW50LgogICAgZm9yKGk9MDsgaSA8IHNpYmxpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChjb21wKGNvbW1lbnQsIHNpYmxpbmdzW2ldKSA8PSAwKSB7CiAgICAgICAgJCgnI2NkJyArIHNpYmxpbmdzW2ldLmlkKQogICAgICAgICAgLnBhcmVudCgpCiAgICAgICAgICAuYmVmb3JlKGxpLmh0bWwoZGl2KSk7CiAgICAgICAgbGkuc2xpZGVEb3duKCdmYXN0Jyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgLy8gSWYgd2UgZ2V0IGhlcmUsIHRoaXMgY29tbWVudCByYXRlcyBsb3dlciB0aGFuIGFsbCB0aGUgb3RoZXJzLAogICAgLy8gb3IgaXQgaXMgdGhlIG9ubHkgY29tbWVudCBpbiB0aGUgbGlzdC4KICAgIHVsLmFwcGVuZChsaS5odG1sKGRpdikpOwogICAgbGkuc2xpZGVEb3duKCdmYXN0Jyk7CiAgfQoKICBmdW5jdGlvbiBhY2NlcHRDb21tZW50KGlkKSB7CiAgICAkLmFqYXgoewogICAgICB0eXBlOiAnUE9TVCcsCiAgICAgIHVybDogb3B0cy5hY2NlcHRDb21tZW50VVJMLAogICAgICBkYXRhOiB7aWQ6IGlkfSwKICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgcmVxdWVzdCkgewogICAgICAgICQoJyNjbScgKyBpZCkuZmFkZU91dCgnZmFzdCcpOwogICAgICAgICQoJyNjZCcgKyBpZCkucmVtb3ZlQ2xhc3MoJ21vZGVyYXRlJyk7CiAgICAgIH0sCiAgICAgIGVycm9yOiBmdW5jdGlvbihyZXF1ZXN0LCB0ZXh0U3RhdHVzLCBlcnJvcikgewogICAgICAgIHNob3dFcnJvcignT29wcywgdGhlcmUgd2FzIGEgcHJvYmxlbSBhY2NlcHRpbmcgdGhlIGNvbW1lbnQuJyk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZGVsZXRlQ29tbWVudChpZCkgewogICAgJC5hamF4KHsKICAgICAgdHlwZTogJ1BPU1QnLAogICAgICB1cmw6IG9wdHMuZGVsZXRlQ29tbWVudFVSTCwKICAgICAgZGF0YToge2lkOiBpZH0sCiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHJlcXVlc3QpIHsKICAgICAgICB2YXIgZGl2ID0gJCgnI2NkJyArIGlkKTsKICAgICAgICBpZiAoZGF0YSA9PSAnZGVsZXRlJykgewogICAgICAgICAgLy8gTW9kZXJhdG9yIG1vZGU6IHJlbW92ZSB0aGUgY29tbWVudCBhbmQgYWxsIGNoaWxkcmVuIGltbWVkaWF0ZWx5CiAgICAgICAgICBkaXYuc2xpZGVVcCgnZmFzdCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBkaXYucmVtb3ZlKCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8gVXNlciBtb2RlOiBvbmx5IG1hcmsgdGhlIGNvbW1lbnQgYXMgZGVsZXRlZAogICAgICAgIGRpdgogICAgICAgICAgLmZpbmQoJ3NwYW4udXNlci1pZDpmaXJzdCcpCiAgICAgICAgICAudGV4dCgnW2RlbGV0ZWRdJykuZW5kKCkKICAgICAgICAgIC5maW5kKCdkaXYuY29tbWVudC10ZXh0OmZpcnN0JykKICAgICAgICAgIC50ZXh0KCdbZGVsZXRlZF0nKS5lbmQoKQogICAgICAgICAgLmZpbmQoJyNjbScgKyBpZCArICcsICNkYycgKyBpZCArICcsICNhYycgKyBpZCArICcsICNyYycgKyBpZCArCiAgICAgICAgICAgICAgICAnLCAjc3AnICsgaWQgKyAnLCAjaHAnICsgaWQgKyAnLCAjY3InICsgaWQgKyAnLCAjcmwnICsgaWQpCiAgICAgICAgICAucmVtb3ZlKCk7CiAgICAgICAgdmFyIGNvbW1lbnQgPSBkaXYuZGF0YSgnY29tbWVudCcpOwogICAgICAgIGNvbW1lbnQudXNlcm5hbWUgPSAnW2RlbGV0ZWRdJzsKICAgICAgICBjb21tZW50LnRleHQgPSAnW2RlbGV0ZWRdJzsKICAgICAgICBkaXYuZGF0YSgnY29tbWVudCcsIGNvbW1lbnQpOwogICAgICB9LAogICAgICBlcnJvcjogZnVuY3Rpb24ocmVxdWVzdCwgdGV4dFN0YXR1cywgZXJyb3IpIHsKICAgICAgICBzaG93RXJyb3IoJ09vcHMsIHRoZXJlIHdhcyBhIHByb2JsZW0gZGVsZXRpbmcgdGhlIGNvbW1lbnQuJyk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gc2hvd1Byb3Bvc2FsKGlkKSB7CiAgICAkKCcjc3AnICsgaWQpLmhpZGUoKTsKICAgICQoJyNocCcgKyBpZCkuc2hvdygpOwogICAgJCgnI3ByJyArIGlkKS5zbGlkZURvd24oJ2Zhc3QnKTsKICB9CgogIGZ1bmN0aW9uIGhpZGVQcm9wb3NhbChpZCkgewogICAgJCgnI2hwJyArIGlkKS5oaWRlKCk7CiAgICAkKCcjc3AnICsgaWQpLnNob3coKTsKICAgICQoJyNwcicgKyBpZCkuc2xpZGVVcCgnZmFzdCcpOwogIH0KCiAgZnVuY3Rpb24gc2hvd1Byb3Bvc2VDaGFuZ2UoaWQpIHsKICAgICQoJyNwYycgKyBpZCkuaGlkZSgpOwogICAgJCgnI2hjJyArIGlkKS5zaG93KCk7CiAgICB2YXIgdGV4dGFyZWEgPSAkKCcjcHQnICsgaWQpOwogICAgdGV4dGFyZWEudmFsKHRleHRhcmVhLmRhdGEoJ3NvdXJjZScpKTsKICAgICQuZm4uYXV0b2dyb3cucmVzaXplKHRleHRhcmVhWzBdKTsKICAgIHRleHRhcmVhLnNsaWRlRG93bignZmFzdCcpOwogIH0KCiAgZnVuY3Rpb24gaGlkZVByb3Bvc2VDaGFuZ2UoaWQpIHsKICAgICQoJyNoYycgKyBpZCkuaGlkZSgpOwogICAgJCgnI3BjJyArIGlkKS5zaG93KCk7CiAgICB2YXIgdGV4dGFyZWEgPSAkKCcjcHQnICsgaWQpOwogICAgdGV4dGFyZWEudmFsKCcnKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOwogICAgdGV4dGFyZWEuc2xpZGVVcCgnZmFzdCcpOwogIH0KCiAgZnVuY3Rpb24gdG9nZ2xlQ29tbWVudE1hcmt1cEJveChpZCkgewogICAgJCgnI21iJyArIGlkKS50b2dnbGUoKTsKICB9CgogIC8qKiBIYW5kbGUgd2hlbiB0aGUgdXNlciBjbGlja3Mgb24gYSBzb3J0IGJ5IGxpbmsuICovCiAgZnVuY3Rpb24gaGFuZGxlUmVTb3J0KGxpbmspIHsKICAgIHZhciBjbGFzc2VzID0gbGluay5hdHRyKCdjbGFzcycpLnNwbGl0KC9ccysvKTsKICAgIGZvciAodmFyIGk9MDsgaTxjbGFzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChjbGFzc2VzW2ldICE9ICdzb3J0LW9wdGlvbicpIHsKCWJ5ID0gY2xhc3Nlc1tpXS5zdWJzdHJpbmcoMik7CiAgICAgIH0KICAgIH0KICAgIHNldENvbXBhcmF0b3IoKTsKICAgIC8vIFNhdmUvdXBkYXRlIHRoZSBzb3J0QnkgY29va2llLgogICAgdmFyIGV4cGlyYXRpb24gPSBuZXcgRGF0ZSgpOwogICAgZXhwaXJhdGlvbi5zZXREYXRlKGV4cGlyYXRpb24uZ2V0RGF0ZSgpICsgMzY1KTsKICAgIGRvY3VtZW50LmNvb2tpZT0gJ3NvcnRCeT0nICsgZXNjYXBlKGJ5KSArCiAgICAgICAgICAgICAgICAgICAgICc7ZXhwaXJlcz0nICsgZXhwaXJhdGlvbi50b1VUQ1N0cmluZygpOwogICAgJCgndWwuY29tbWVudC11bCcpLmVhY2goZnVuY3Rpb24oaW5kZXgsIHVsKSB7CiAgICAgIHZhciBjb21tZW50cyA9IGdldENoaWxkcmVuKCQodWwpLCB0cnVlKTsKICAgICAgY29tbWVudHMgPSBzb3J0Q29tbWVudHMoY29tbWVudHMpOwogICAgICBhcHBlbmRDb21tZW50cyhjb21tZW50cywgJCh1bCkuZW1wdHkoKSk7CiAgICB9KTsKICB9CgogIC8qKgogICAqIEZ1bmN0aW9uIHRvIHByb2Nlc3MgYSB2b3RlIHdoZW4gYSB1c2VyIGNsaWNrcyBhbiBhcnJvdy4KICAgKi8KICBmdW5jdGlvbiBoYW5kbGVWb3RlKGxpbmspIHsKICAgIGlmICghb3B0cy52b3RpbmcpIHsKICAgICAgc2hvd0Vycm9yKCJZb3UnbGwgbmVlZCB0byBsb2dpbiB0byB2b3RlLiIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGlkID0gbGluay5hdHRyKCdpZCcpOwogICAgaWYgKCFpZCkgewogICAgICAvLyBEaWRuJ3QgY2xpY2sgb24gb25lIG9mIHRoZSB2b3RpbmcgYXJyb3dzLgogICAgICByZXR1cm47CiAgICB9CiAgICAvLyBJZiBpdCBpcyBhbiB1bnZvdGUsIHRoZSBuZXcgdm90ZSB2YWx1ZSBpcyAwLAogICAgLy8gT3RoZXJ3aXNlIGl0J3MgMSBmb3IgYW4gdXB2b3RlLCBvciAtMSBmb3IgYSBkb3dudm90ZS4KICAgIHZhciB2YWx1ZSA9IDA7CiAgICBpZiAoaWQuY2hhckF0KDEpICE9ICd1JykgewogICAgICB2YWx1ZSA9IGlkLmNoYXJBdCgwKSA9PSAndScgPyAxIDogLTE7CiAgICB9CiAgICAvLyBUaGUgZGF0YSB0byBiZSBzZW50IHRvIHRoZSBzZXJ2ZXIuCiAgICB2YXIgZCA9IHsKICAgICAgY29tbWVudF9pZDogaWQuc3Vic3RyaW5nKDIpLAogICAgICB2YWx1ZTogdmFsdWUKICAgIH07CgogICAgLy8gU3dhcCB0aGUgdm90ZSBhbmQgdW52b3RlIGxpbmtzLgogICAgbGluay5oaWRlKCk7CiAgICAkKCcjJyArIGlkLmNoYXJBdCgwKSArIChpZC5jaGFyQXQoMSkgPT0gJ3UnID8gJ3YnIDogJ3UnKSArIGQuY29tbWVudF9pZCkKICAgICAgLnNob3coKTsKCiAgICAvLyBUaGUgZGl2IHRoZSBjb21tZW50IGlzIGRpc3BsYXllZCBpbi4KICAgIHZhciBkaXYgPSAkKCdkaXYjY2QnICsgZC5jb21tZW50X2lkKTsKICAgIHZhciBkYXRhID0gZGl2LmRhdGEoJ2NvbW1lbnQnKTsKCiAgICAvLyBJZiB0aGlzIGlzIG5vdCBhbiB1bnZvdGUsIGFuZCB0aGUgb3RoZXIgdm90ZSBhcnJvdyBoYXMKICAgIC8vIGFscmVhZHkgYmVlbiBwcmVzc2VkLCB1bnByZXNzIGl0LgogICAgaWYgKChkLnZhbHVlICE9PSAwKSAmJiAoZGF0YS52b3RlID09PSBkLnZhbHVlICogLTEpKSB7CiAgICAgICQoJyMnICsgKGQudmFsdWUgPT0gMSA/ICdkJyA6ICd1JykgKyAndScgKyBkLmNvbW1lbnRfaWQpLmhpZGUoKTsKICAgICAgJCgnIycgKyAoZC52YWx1ZSA9PSAxID8gJ2QnIDogJ3UnKSArICd2JyArIGQuY29tbWVudF9pZCkuc2hvdygpOwogICAgfQoKICAgIC8vIFVwZGF0ZSB0aGUgY29tbWVudHMgcmF0aW5nIGluIHRoZSBsb2NhbCBkYXRhLgogICAgZGF0YS5yYXRpbmcgKz0gKGRhdGEudm90ZSA9PT0gMCkgPyBkLnZhbHVlIDogKGQudmFsdWUgLSBkYXRhLnZvdGUpOwogICAgZGF0YS52b3RlID0gZC52YWx1ZTsKICAgIGRpdi5kYXRhKCdjb21tZW50JywgZGF0YSk7CgogICAgLy8gQ2hhbmdlIHRoZSByYXRpbmcgdGV4dC4KICAgIGRpdi5maW5kKCcucmF0aW5nOmZpcnN0JykKICAgICAgLnRleHQoZGF0YS5yYXRpbmcgKyAnIHBvaW50JyArIChkYXRhLnJhdGluZyA9PSAxID8gJycgOiAncycpKTsKCiAgICAvLyBTZW5kIHRoZSB2b3RlIGluZm9ybWF0aW9uIHRvIHRoZSBzZXJ2ZXIuCiAgICAkLmFqYXgoewogICAgICB0eXBlOiAiUE9TVCIsCiAgICAgIHVybDogb3B0cy5wcm9jZXNzVm90ZVVSTCwKICAgICAgZGF0YTogZCwKICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yKSB7CiAgICAgICAgc2hvd0Vycm9yKCdPb3BzLCB0aGVyZSB3YXMgYSBwcm9ibGVtIGNhc3RpbmcgdGhhdCB2b3RlLicpOwogICAgICB9CiAgICB9KTsKICB9CgogIC8qKgogICAqIE9wZW4gYSByZXBseSBmb3JtIHVzZWQgdG8gcmVwbHkgdG8gYW4gZXhpc3RpbmcgY29tbWVudC4KICAgKi8KICBmdW5jdGlvbiBvcGVuUmVwbHkoaWQpIHsKICAgIC8vIFN3YXAgb3V0IHRoZSByZXBseSBsaW5rIGZvciB0aGUgaGlkZSBsaW5rCiAgICAkKCcjcmwnICsgaWQpLmhpZGUoKTsKICAgICQoJyNjcicgKyBpZCkuc2hvdygpOwoKICAgIC8vIEFkZCB0aGUgcmVwbHkgbGkgdG8gdGhlIGNoaWxkcmVuIHVsLgogICAgdmFyIGRpdiA9ICQocmVuZGVyVGVtcGxhdGUocmVwbHlUZW1wbGF0ZSwge2lkOiBpZH0pKS5oaWRlKCk7CiAgICAkKCcjY2wnICsgaWQpCiAgICAgIC5wcmVwZW5kKGRpdikKICAgICAgLy8gU2V0dXAgdGhlIHN1Ym1pdCBoYW5kbGVyIGZvciB0aGUgcmVwbHkgZm9ybS4KICAgICAgLmZpbmQoJyNyZicgKyBpZCkKICAgICAgLnN1Ym1pdChmdW5jdGlvbihldmVudCkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgYWRkQ29tbWVudCgkKCcjcmYnICsgaWQpKTsKICAgICAgICBjbG9zZVJlcGx5KGlkKTsKICAgICAgfSkKICAgICAgLmZpbmQoJ2lucHV0W3R5cGU9YnV0dG9uXScpCiAgICAgIC5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICBjbG9zZVJlcGx5KGlkKTsKICAgICAgfSk7CiAgICBkaXYuc2xpZGVEb3duKCdmYXN0JywgZnVuY3Rpb24oKSB7CiAgICAgICQoJyNyZicgKyBpZCkuZmluZCgndGV4dGFyZWEnKS5mb2N1cygpOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBDbG9zZSB0aGUgcmVwbHkgZm9ybSBvcGVuZWQgd2l0aCBvcGVuUmVwbHkuCiAgICovCiAgZnVuY3Rpb24gY2xvc2VSZXBseShpZCkgewogICAgLy8gUmVtb3ZlIHRoZSByZXBseSBkaXYgZnJvbSB0aGUgRE9NLgogICAgJCgnI3JkJyArIGlkKS5zbGlkZVVwKCdmYXN0JywgZnVuY3Rpb24oKSB7CiAgICAgICQodGhpcykucmVtb3ZlKCk7CiAgICB9KTsKCiAgICAvLyBTd2FwIG91dCB0aGUgaGlkZSBsaW5rIGZvciB0aGUgcmVwbHkgbGluawogICAgJCgnI2NyJyArIGlkKS5oaWRlKCk7CiAgICAkKCcjcmwnICsgaWQpLnNob3coKTsKICB9CgogIC8qKgogICAqIFJlY3Vyc2l2ZWx5IHNvcnQgYSB0cmVlIG9mIGNvbW1lbnRzIHVzaW5nIHRoZSBjb21wIGNvbXBhcmF0b3IuCiAgICovCiAgZnVuY3Rpb24gc29ydENvbW1lbnRzKGNvbW1lbnRzKSB7CiAgICBjb21tZW50cy5zb3J0KGNvbXApOwogICAgJC5lYWNoKGNvbW1lbnRzLCBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5jaGlsZHJlbiA9IHNvcnRDb21tZW50cyh0aGlzLmNoaWxkcmVuKTsKICAgIH0pOwogICAgcmV0dXJuIGNvbW1lbnRzOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBjaGlsZHJlbiBjb21tZW50cyBmcm9tIGEgdWwuIElmIHJlY3Vyc2l2ZSBpcyB0cnVlLAogICAqIHJlY3Vyc2l2ZWx5IGluY2x1ZGUgY2hpbGRyZW5zJyBjaGlsZHJlbi4KICAgKi8KICBmdW5jdGlvbiBnZXRDaGlsZHJlbih1bCwgcmVjdXJzaXZlKSB7CiAgICB2YXIgY2hpbGRyZW4gPSBbXTsKICAgIHVsLmNoaWxkcmVuKCkuY2hpbGRyZW4oIltpZF49J2NkJ10iKQogICAgICAuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgY29tbWVudCA9ICQodGhpcykuZGF0YSgnY29tbWVudCcpOwogICAgICAgIGlmIChyZWN1cnNpdmUpCiAgICAgICAgICBjb21tZW50LmNoaWxkcmVuID0gZ2V0Q2hpbGRyZW4oJCh0aGlzKS5maW5kKCcjY2wnICsgY29tbWVudC5pZCksIHRydWUpOwogICAgICAgIGNoaWxkcmVuLnB1c2goY29tbWVudCk7CiAgICAgIH0pOwogICAgcmV0dXJuIGNoaWxkcmVuOwogIH0KCiAgLyoqIENyZWF0ZSBhIGRpdiB0byBkaXNwbGF5IGEgY29tbWVudCBpbi4gKi8KICBmdW5jdGlvbiBjcmVhdGVDb21tZW50RGl2KGNvbW1lbnQpIHsKICAgIGlmICghY29tbWVudC5kaXNwbGF5ZWQgJiYgIW9wdHMubW9kZXJhdG9yKSB7CiAgICAgIHJldHVybiAkKCc8ZGl2IGNsYXNzPSJtb2RlcmF0ZSI+VGhhbmsgeW91ISAgWW91ciBjb21tZW50IHdpbGwgc2hvdyB1cCAnCiAgICAgICAgICAgICAgICsgJ29uY2UgaXQgaXMgaGFzIGJlZW4gYXBwcm92ZWQgYnkgYSBtb2RlcmF0b3IuPC9kaXY+Jyk7CiAgICB9CiAgICAvLyBQcmV0dGlmeSB0aGUgY29tbWVudCByYXRpbmcuCiAgICBjb21tZW50LnByZXR0eV9yYXRpbmcgPSBjb21tZW50LnJhdGluZyArICcgcG9pbnQnICsKICAgICAgKGNvbW1lbnQucmF0aW5nID09IDEgPyAnJyA6ICdzJyk7CiAgICAvLyBNYWtlIGEgY2xhc3MgKGZvciBkaXNwbGF5aW5nIG5vdCB5ZXQgbW9kZXJhdGVkIGNvbW1lbnRzIGRpZmZlcmVudGx5KQogICAgY29tbWVudC5jc3NfY2xhc3MgPSBjb21tZW50LmRpc3BsYXllZCA/ICcnIDogJyBtb2RlcmF0ZSc7CiAgICAvLyBDcmVhdGUgYSBkaXYgZm9yIHRoaXMgY29tbWVudC4KICAgIHZhciBjb250ZXh0ID0gJC5leHRlbmQoe30sIG9wdHMsIGNvbW1lbnQpOwogICAgdmFyIGRpdiA9ICQocmVuZGVyVGVtcGxhdGUoY29tbWVudFRlbXBsYXRlLCBjb250ZXh0KSk7CgogICAgLy8gSWYgdGhlIHVzZXIgaGFzIHZvdGVkIG9uIHRoaXMgY29tbWVudCwgaGlnaGxpZ2h0IHRoZSBjb3JyZWN0IGFycm93LgogICAgaWYgKGNvbW1lbnQudm90ZSkgewogICAgICB2YXIgZGlyZWN0aW9uID0gKGNvbW1lbnQudm90ZSA9PSAxKSA/ICd1JyA6ICdkJzsKICAgICAgZGl2LmZpbmQoJyMnICsgZGlyZWN0aW9uICsgJ3YnICsgY29tbWVudC5pZCkuaGlkZSgpOwogICAgICBkaXYuZmluZCgnIycgKyBkaXJlY3Rpb24gKyAndScgKyBjb21tZW50LmlkKS5zaG93KCk7CiAgICB9CgogICAgaWYgKG9wdHMubW9kZXJhdG9yIHx8IGNvbW1lbnQudGV4dCAhPSAnW2RlbGV0ZWRdJykgewogICAgICBkaXYuZmluZCgnYS5yZXBseScpLnNob3coKTsKICAgICAgaWYgKGNvbW1lbnQucHJvcG9zYWxfZGlmZikKICAgICAgICBkaXYuZmluZCgnI3NwJyArIGNvbW1lbnQuaWQpLnNob3coKTsKICAgICAgaWYgKG9wdHMubW9kZXJhdG9yICYmICFjb21tZW50LmRpc3BsYXllZCkKICAgICAgICBkaXYuZmluZCgnI2NtJyArIGNvbW1lbnQuaWQpLnNob3coKTsKICAgICAgaWYgKG9wdHMubW9kZXJhdG9yIHx8IChvcHRzLnVzZXJuYW1lID09IGNvbW1lbnQudXNlcm5hbWUpKQogICAgICAgIGRpdi5maW5kKCcjZGMnICsgY29tbWVudC5pZCkuc2hvdygpOwogICAgfQogICAgcmV0dXJuIGRpdjsKICB9CgogIC8qKgogICAqIEEgc2ltcGxlIHRlbXBsYXRlIHJlbmRlcmVyLiBQbGFjZWhvbGRlcnMgc3VjaCBhcyA8JWlkJT4gYXJlIHJlcGxhY2VkCiAgICogYnkgY29udGV4dFsnaWQnXSB3aXRoIGl0ZW1zIGJlaW5nIGVzY2FwZWQuIFBsYWNlaG9sZGVycyBzdWNoIGFzIDwjaWQjPgogICAqIGFyZSBub3QgZXNjYXBlZC4KICAgKi8KICBmdW5jdGlvbiByZW5kZXJUZW1wbGF0ZSh0ZW1wbGF0ZSwgY29udGV4dCkgewogICAgdmFyIGVzYyA9ICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpOwoKICAgIGZ1bmN0aW9uIGhhbmRsZShwaCwgZXNjYXBlKSB7CiAgICAgIHZhciBjdXIgPSBjb250ZXh0OwogICAgICAkLmVhY2gocGguc3BsaXQoJy4nKSwgZnVuY3Rpb24oKSB7CiAgICAgICAgY3VyID0gY3VyW3RoaXNdOwogICAgICB9KTsKICAgICAgcmV0dXJuIGVzY2FwZSA/IGVzYy50ZXh0KGN1ciB8fCAiIikuaHRtbCgpIDogY3VyOwogICAgfQoKICAgIHJldHVybiB0ZW1wbGF0ZS5yZXBsYWNlKC88KFslI10pKFtcd1wuXSopXDE+L2csIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gaGFuZGxlKGFyZ3VtZW50c1syXSwgYXJndW1lbnRzWzFdID09ICclJyA/IHRydWUgOiBmYWxzZSk7CiAgICB9KTsKICB9CgogIC8qKiBGbGFzaCBhbiBlcnJvciBtZXNzYWdlIGJyaWVmbHkuICovCiAgZnVuY3Rpb24gc2hvd0Vycm9yKG1lc3NhZ2UpIHsKICAgICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpLmF0dHIoeydjbGFzcyc6ICdwb3B1cC1lcnJvcid9KQogICAgICAuYXBwZW5kKCQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpCiAgICAgICAgICAgICAgIC5hdHRyKHsnY2xhc3MnOiAnZXJyb3ItbWVzc2FnZSd9KS50ZXh0KG1lc3NhZ2UpKQogICAgICAuYXBwZW5kVG8oJ2JvZHknKQogICAgICAuZmFkZUluKCJzbG93IikKICAgICAgLmRlbGF5KDIwMDApCiAgICAgIC5mYWRlT3V0KCJzbG93Iik7CiAgfQoKICAvKiogQWRkIGEgbGluayB0aGUgdXNlciB1c2VzIHRvIG9wZW4gdGhlIGNvbW1lbnRzIHBvcHVwLiAqLwogICQuZm4uY29tbWVudCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgdmFyIGlkID0gJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygxKTsKICAgICAgdmFyIGNvdW50ID0gQ09NTUVOVF9NRVRBREFUQVtpZF07CiAgICAgIHZhciB0aXRsZSA9IGNvdW50ICsgJyBjb21tZW50JyArIChjb3VudCA9PSAxID8gJycgOiAncycpOwogICAgICB2YXIgaW1hZ2UgPSBjb3VudCA+IDAgPyBvcHRzLmNvbW1lbnRCcmlnaHRJbWFnZSA6IG9wdHMuY29tbWVudEltYWdlOwogICAgICB2YXIgYWRkY2xzID0gY291bnQgPT0gMCA/ICcgbm9jb21tZW50JyA6ICcnOwogICAgICAkKHRoaXMpCiAgICAgICAgLmFwcGVuZCgKICAgICAgICAgICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpKS5hdHRyKHsKICAgICAgICAgICAgaHJlZjogJyMnLAogICAgICAgICAgICAnY2xhc3MnOiAnc3BoaW54LWNvbW1lbnQtb3BlbicgKyBhZGRjbHMsCiAgICAgICAgICAgIGlkOiAnYW8nICsgaWQKICAgICAgICAgIH0pCiAgICAgICAgICAgIC5hcHBlbmQoJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKSkuYXR0cih7CiAgICAgICAgICAgICAgc3JjOiBpbWFnZSwKICAgICAgICAgICAgICBhbHQ6ICdjb21tZW50JywKICAgICAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIC5jbGljayhmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgc2hvdygkKHRoaXMpLmF0dHIoJ2lkJykuc3Vic3RyaW5nKDIpKTsKICAgICAgICAgICAgfSkKICAgICAgICApCiAgICAgICAgLmFwcGVuZCgKICAgICAgICAgICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpKS5hdHRyKHsKICAgICAgICAgICAgaHJlZjogJyMnLAogICAgICAgICAgICAnY2xhc3MnOiAnc3BoaW54LWNvbW1lbnQtY2xvc2UgaGlkZGVuJywKICAgICAgICAgICAgaWQ6ICdhaCcgKyBpZAogICAgICAgICAgfSkKICAgICAgICAgICAgLmFwcGVuZCgkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpKS5hdHRyKHsKICAgICAgICAgICAgICBzcmM6IG9wdHMuY2xvc2VDb21tZW50SW1hZ2UsCiAgICAgICAgICAgICAgYWx0OiAnY2xvc2UnLAogICAgICAgICAgICAgIHRpdGxlOiAnY2xvc2UnCiAgICAgICAgICAgIH0pKQogICAgICAgICAgICAuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIGhpZGUoJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgIH0pOwogIH07CgogIHZhciBvcHRzID0gewogICAgcHJvY2Vzc1ZvdGVVUkw6ICcvX3Byb2Nlc3Nfdm90ZScsCiAgICBhZGRDb21tZW50VVJMOiAnL19hZGRfY29tbWVudCcsCiAgICBnZXRDb21tZW50c1VSTDogJy9fZ2V0X2NvbW1lbnRzJywKICAgIGFjY2VwdENvbW1lbnRVUkw6ICcvX2FjY2VwdF9jb21tZW50JywKICAgIGRlbGV0ZUNvbW1lbnRVUkw6ICcvX2RlbGV0ZV9jb21tZW50JywKICAgIGNvbW1lbnRJbWFnZTogJy9zdGF0aWMvX3N0YXRpYy9jb21tZW50LnBuZycsCiAgICBjbG9zZUNvbW1lbnRJbWFnZTogJy9zdGF0aWMvX3N0YXRpYy9jb21tZW50LWNsb3NlLnBuZycsCiAgICBsb2FkaW5nSW1hZ2U6ICcvc3RhdGljL19zdGF0aWMvYWpheC1sb2FkZXIuZ2lmJywKICAgIGNvbW1lbnRCcmlnaHRJbWFnZTogJy9zdGF0aWMvX3N0YXRpYy9jb21tZW50LWJyaWdodC5wbmcnLAogICAgdXBBcnJvdzogJy9zdGF0aWMvX3N0YXRpYy91cC5wbmcnLAogICAgZG93bkFycm93OiAnL3N0YXRpYy9fc3RhdGljL2Rvd24ucG5nJywKICAgIHVwQXJyb3dQcmVzc2VkOiAnL3N0YXRpYy9fc3RhdGljL3VwLXByZXNzZWQucG5nJywKICAgIGRvd25BcnJvd1ByZXNzZWQ6ICcvc3RhdGljL19zdGF0aWMvZG93bi1wcmVzc2VkLnBuZycsCiAgICB2b3Rpbmc6IGZhbHNlLAogICAgbW9kZXJhdG9yOiBmYWxzZQogIH07CgogIGlmICh0eXBlb2YgQ09NTUVOVF9PUFRJT05TICE9ICJ1bmRlZmluZWQiKSB7CiAgICBvcHRzID0galF1ZXJ5LmV4dGVuZChvcHRzLCBDT01NRU5UX09QVElPTlMpOwogIH0KCiAgdmFyIHBvcHVwVGVtcGxhdGUgPSAnXAogICAgPGRpdiBjbGFzcz0ic3BoaW54LWNvbW1lbnRzIiBpZD0ic2M8JWlkJT4iPlwKICAgICAgPHAgY2xhc3M9InNvcnQtb3B0aW9ucyI+XAogICAgICAgIFNvcnQgYnk6XAogICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJzb3J0LW9wdGlvbiBieXJhdGluZyI+YmVzdCByYXRlZDwvYT5cCiAgICAgICAgPGEgaHJlZj0iIyIgY2xhc3M9InNvcnQtb3B0aW9uIGJ5YXNjYWdlIj5uZXdlc3Q8L2E+XAogICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJzb3J0LW9wdGlvbiBieWFnZSI+b2xkZXN0PC9hPlwKICAgICAgPC9wPlwKICAgICAgPGRpdiBjbGFzcz0iY29tbWVudC1oZWFkZXIiPkNvbW1lbnRzPC9kaXY+XAogICAgICA8ZGl2IGNsYXNzPSJjb21tZW50LWxvYWRpbmciIGlkPSJjbjwlaWQlPiI+XAogICAgICAgIGxvYWRpbmcgY29tbWVudHMuLi4gPGltZyBzcmM9IjwlbG9hZGluZ0ltYWdlJT4iIGFsdD0iIiAvPjwvZGl2PlwKICAgICAgPHVsIGlkPSJjbDwlaWQlPiIgY2xhc3M9ImNvbW1lbnQtdWwiPjwvdWw+XAogICAgICA8ZGl2IGlkPSJjYTwlaWQlPiI+XAogICAgICA8cCBjbGFzcz0iYWRkLWEtY29tbWVudCI+QWRkIGEgY29tbWVudFwKICAgICAgICAoPGEgaHJlZj0iIyIgY2xhc3M9ImNvbW1lbnQtbWFya3VwIiBpZD0iYWI8JWlkJT4iPm1hcmt1cDwvYT4pOjwvcD5cCiAgICAgIDxkaXYgY2xhc3M9ImNvbW1lbnQtbWFya3VwLWJveCIgaWQ9Im1iPCVpZCU+Ij5cCiAgICAgICAgcmVTdHJ1Y3R1cmVkIHRleHQgbWFya3VwOiA8aT4qZW1waCo8L2k+LCA8Yj4qKnN0cm9uZyoqPC9iPiwgXAogICAgICAgIDx0dD5gYGNvZGVgYDwvdHQ+LCBcCiAgICAgICAgY29kZSBibG9ja3M6IDx0dD46OjwvdHQ+IGFuZCBhbiBpbmRlbnRlZCBibG9jayBhZnRlciBibGFuayBsaW5lPC9kaXY+XAogICAgICA8Zm9ybSBtZXRob2Q9InBvc3QiIGlkPSJjZjwlaWQlPiIgY2xhc3M9ImNvbW1lbnQtZm9ybSIgYWN0aW9uPSIiPlwKICAgICAgICA8dGV4dGFyZWEgbmFtZT0iY29tbWVudCIgY29scz0iODAiPjwvdGV4dGFyZWE+XAogICAgICAgIDxwIGNsYXNzPSJwcm9wb3NlLWJ1dHRvbiI+XAogICAgICAgICAgPGEgaHJlZj0iIyIgaWQ9InBjPCVpZCU+IiBjbGFzcz0ic2hvdy1wcm9wb3NlLWNoYW5nZSI+XAogICAgICAgICAgICBQcm9wb3NlIGEgY2hhbmdlICYjOTY1NztcCiAgICAgICAgICA8L2E+XAogICAgICAgICAgPGEgaHJlZj0iIyIgaWQ9ImhjPCVpZCU+IiBjbGFzcz0iaGlkZS1wcm9wb3NlLWNoYW5nZSI+XAogICAgICAgICAgICBQcm9wb3NlIGEgY2hhbmdlICYjOTY2MztcCiAgICAgICAgICA8L2E+XAogICAgICAgIDwvcD5cCiAgICAgICAgPHRleHRhcmVhIG5hbWU9InByb3Bvc2FsIiBpZD0icHQ8JWlkJT4iIGNvbHM9IjgwIlwKICAgICAgICAgICAgICAgICAgc3BlbGxjaGVjaz0iZmFsc2UiPjwvdGV4dGFyZWE+XAogICAgICAgIDxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJBZGQgY29tbWVudCIgLz5cCiAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ibm9kZSIgdmFsdWU9IjwlaWQlPiIgLz5cCiAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0icGFyZW50IiB2YWx1ZT0iIiAvPlwKICAgICAgPC9mb3JtPlwKICAgICAgPC9kaXY+XAogICAgPC9kaXY+JzsKCiAgdmFyIGNvbW1lbnRUZW1wbGF0ZSA9ICdcCiAgICA8ZGl2IGlkPSJjZDwlaWQlPiIgY2xhc3M9InNwaGlueC1jb21tZW50PCVjc3NfY2xhc3MlPiI+XAogICAgICA8ZGl2IGNsYXNzPSJ2b3RlIj5cCiAgICAgICAgPGRpdiBjbGFzcz0iYXJyb3ciPlwKICAgICAgICAgIDxhIGhyZWY9IiMiIGlkPSJ1djwlaWQlPiIgY2xhc3M9InZvdGUiIHRpdGxlPSJ2b3RlIHVwIj5cCiAgICAgICAgICAgIDxpbWcgc3JjPSI8JXVwQXJyb3clPiIgLz5cCiAgICAgICAgICA8L2E+XAogICAgICAgICAgPGEgaHJlZj0iIyIgaWQ9InV1PCVpZCU+IiBjbGFzcz0idW4gdm90ZSIgdGl0bGU9InZvdGUgdXAiPlwKICAgICAgICAgICAgPGltZyBzcmM9IjwldXBBcnJvd1ByZXNzZWQlPiIgLz5cCiAgICAgICAgICA8L2E+XAogICAgICAgIDwvZGl2PlwKICAgICAgICA8ZGl2IGNsYXNzPSJhcnJvdyI+XAogICAgICAgICAgPGEgaHJlZj0iIyIgaWQ9ImR2PCVpZCU+IiBjbGFzcz0idm90ZSIgdGl0bGU9InZvdGUgZG93biI+XAogICAgICAgICAgICA8aW1nIHNyYz0iPCVkb3duQXJyb3clPiIgaWQ9ImRhPCVpZCU+IiAvPlwKICAgICAgICAgIDwvYT5cCiAgICAgICAgICA8YSBocmVmPSIjIiBpZD0iZHU8JWlkJT4iIGNsYXNzPSJ1biB2b3RlIiB0aXRsZT0idm90ZSBkb3duIj5cCiAgICAgICAgICAgIDxpbWcgc3JjPSI8JWRvd25BcnJvd1ByZXNzZWQlPiIgLz5cCiAgICAgICAgICA8L2E+XAogICAgICAgIDwvZGl2PlwKICAgICAgPC9kaXY+XAogICAgICA8ZGl2IGNsYXNzPSJjb21tZW50LWNvbnRlbnQiPlwKICAgICAgICA8cCBjbGFzcz0idGFnbGluZSBjb21tZW50Ij5cCiAgICAgICAgICA8c3BhbiBjbGFzcz0idXNlci1pZCI+PCV1c2VybmFtZSU+PC9zcGFuPlwKICAgICAgICAgIDxzcGFuIGNsYXNzPSJyYXRpbmciPjwlcHJldHR5X3JhdGluZyU+PC9zcGFuPlwKICAgICAgICAgIDxzcGFuIGNsYXNzPSJkZWx0YSI+PCV0aW1lLmRlbHRhJT48L3NwYW4+XAogICAgICAgIDwvcD5cCiAgICAgICAgPGRpdiBjbGFzcz0iY29tbWVudC10ZXh0IGNvbW1lbnQiPjwjdGV4dCM+PC9kaXY+XAogICAgICAgIDxwIGNsYXNzPSJjb21tZW50LW9wdHMgY29tbWVudCI+XAogICAgICAgICAgPGEgaHJlZj0iIyIgY2xhc3M9InJlcGx5IGhpZGRlbiIgaWQ9InJsPCVpZCU+Ij5yZXBseSAmIzk2NTc7PC9hPlwKICAgICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJjbG9zZS1yZXBseSIgaWQ9ImNyPCVpZCU+Ij5yZXBseSAmIzk2NjM7PC9hPlwKICAgICAgICAgIDxhIGhyZWY9IiMiIGlkPSJzcDwlaWQlPiIgY2xhc3M9InNob3ctcHJvcG9zYWwiPnByb3Bvc2FsICYjOTY1Nzs8L2E+XAogICAgICAgICAgPGEgaHJlZj0iIyIgaWQ9ImhwPCVpZCU+IiBjbGFzcz0iaGlkZS1wcm9wb3NhbCI+cHJvcG9zYWwgJiM5NjYzOzwvYT5cCiAgICAgICAgICA8YSBocmVmPSIjIiBpZD0iZGM8JWlkJT4iIGNsYXNzPSJkZWxldGUtY29tbWVudCBoaWRkZW4iPmRlbGV0ZTwvYT5cCiAgICAgICAgICA8c3BhbiBpZD0iY208JWlkJT4iIGNsYXNzPSJtb2RlcmF0aW9uIGhpZGRlbiI+XAogICAgICAgICAgICA8YSBocmVmPSIjIiBpZD0iYWM8JWlkJT4iIGNsYXNzPSJhY2NlcHQtY29tbWVudCI+YWNjZXB0PC9hPlwKICAgICAgICAgIDwvc3Bhbj5cCiAgICAgICAgPC9wPlwKICAgICAgICA8cHJlIGNsYXNzPSJwcm9wb3NhbCIgaWQ9InByPCVpZCU+Ij5cCjwjcHJvcG9zYWxfZGlmZiM+XAogICAgICAgIDwvcHJlPlwKICAgICAgICAgIDx1bCBjbGFzcz0iY29tbWVudC1jaGlsZHJlbiIgaWQ9ImNsPCVpZCU+Ij48L3VsPlwKICAgICAgICA8L2Rpdj5cCiAgICAgICAgPGRpdiBjbGFzcz0iY2xlYXJsZWZ0Ij48L2Rpdj5cCiAgICAgIDwvZGl2PlwKICAgIDwvZGl2Pic7CgogIHZhciByZXBseVRlbXBsYXRlID0gJ1wKICAgIDxsaT5cCiAgICAgIDxkaXYgY2xhc3M9InJlcGx5LWRpdiIgaWQ9InJkPCVpZCU+Ij5cCiAgICAgICAgPGZvcm0gaWQ9InJmPCVpZCU+Ij5cCiAgICAgICAgICA8dGV4dGFyZWEgbmFtZT0iY29tbWVudCIgY29scz0iODAiPjwvdGV4dGFyZWE+XAogICAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkFkZCByZXBseSIgLz5cCiAgICAgICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiB2YWx1ZT0iQ2FuY2VsIiAvPlwKICAgICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InBhcmVudCIgdmFsdWU9IjwlaWQlPiIgLz5cCiAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJub2RlIiB2YWx1ZT0iIiAvPlwKICAgICAgICA8L2Zvcm0+XAogICAgICA8L2Rpdj5cCiAgICA8L2xpPic7CgogICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewogICAgaW5pdCgpOwogIH0pOwp9KShqUXVlcnkpOwoKJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CiAgLy8gYWRkIGNvbW1lbnQgYW5jaG9ycyBmb3IgYWxsIHBhcmFncmFwaHMgdGhhdCBhcmUgY29tbWVudGFibGUKICAkKCcuc3BoaW54LWhhcy1jb21tZW50JykuY29tbWVudCgpOwoKICAvLyBoaWdobGlnaHQgc2VhcmNoIHdvcmRzIGluIHNlYXJjaCByZXN1bHRzCiAgJCgiZGl2LmNvbnRleHQiKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgdmFyIHBhcmFtcyA9ICQuZ2V0UXVlcnlQYXJhbWV0ZXJzKCk7CiAgICB2YXIgdGVybXMgPSAocGFyYW1zLnEpID8gcGFyYW1zLnFbMF0uc3BsaXQoL1xzKy8pIDogW107CiAgICB2YXIgcmVzdWx0ID0gJCh0aGlzKTsKICAgICQuZWFjaCh0ZXJtcywgZnVuY3Rpb24oKSB7CiAgICAgIHJlc3VsdC5oaWdobGlnaHRUZXh0KHRoaXMudG9Mb3dlckNhc2UoKSwgJ2hpZ2hsaWdodGVkJyk7CiAgICB9KTsKICB9KTsKCiAgLy8gZGlyZWN0bHkgb3BlbiBjb21tZW50IHdpbmRvdyBpZiByZXF1ZXN0ZWQKICB2YXIgYW5jaG9yID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaDsKICBpZiAoYW5jaG9yLnN1YnN0cmluZygwLCA5KSA9PSAnI2NvbW1lbnQtJykgewogICAgJCgnI2FvJyArIGFuY2hvci5zdWJzdHJpbmcoOSkpLmNsaWNrKCk7CiAgICBkb2N1bWVudC5sb2NhdGlvbi5oYXNoID0gJyNzJyArIGFuY2hvci5zdWJzdHJpbmcoOSk7CiAgfQp9KTsK",
                "body": "LyoKICogd2Vic3VwcG9ydC5qcwogKiB+fn5+fn5+fn5+fn5+CiAqCiAqIHNwaGlueC53ZWJzdXBwb3J0IHV0aWx0aWVzIGZvciBhbGwgZG9jdW1lbnRhdGlvbi4KICoKICogOmNvcHlyaWdodDogQ29weXJpZ2h0IDIwMDctMjAxMSBieSB0aGUgU3BoaW54IHRlYW0sIHNlZSBBVVRIT1JTLgogKiA6bGljZW5zZTogQlNELCBzZWUgTElDRU5TRSBmb3IgZGV0YWlscy4KICoKICovCgooZnVuY3Rpb24oJCkgewogICQuZm4uYXV0b2dyb3cgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICB2YXIgdGV4dGFyZWEgPSB0aGlzOwoKICAgICQuZm4uYXV0b2dyb3cucmVzaXplKHRleHRhcmVhKTsKCiAgICAkKHRleHRhcmVhKQogICAgICAuZm9jdXMoZnVuY3Rpb24oKSB7CiAgICAgICAgdGV4dGFyZWEuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICAgICQuZm4uYXV0b2dyb3cucmVzaXplKHRleHRhcmVhKTsKICAgICAgICB9LCA1MDApOwogICAgICB9KQogICAgICAuYmx1cihmdW5jdGlvbigpIHsKICAgICAgICBjbGVhckludGVydmFsKHRleHRhcmVhLmludGVydmFsKTsKICAgICAgfSk7CiAgICB9KTsKICB9OwoKICAkLmZuLmF1dG9ncm93LnJlc2l6ZSA9IGZ1bmN0aW9uKHRleHRhcmVhKSB7CiAgICB2YXIgbGluZUhlaWdodCA9IHBhcnNlSW50KCQodGV4dGFyZWEpLmNzcygnbGluZS1oZWlnaHQnKSwgMTApOwogICAgdmFyIGxpbmVzID0gdGV4dGFyZWEudmFsdWUuc3BsaXQoJ1xuJyk7CiAgICB2YXIgY29sdW1ucyA9IHRleHRhcmVhLmNvbHM7CiAgICB2YXIgbGluZUNvdW50ID0gMDsKICAgICQuZWFjaChsaW5lcywgZnVuY3Rpb24oKSB7CiAgICAgIGxpbmVDb3VudCArPSBNYXRoLmNlaWwodGhpcy5sZW5ndGggLyBjb2x1bW5zKSB8fCAxOwogICAgfSk7CiAgICB2YXIgaGVpZ2h0ID0gbGluZUhlaWdodCAqIChsaW5lQ291bnQgKyAxKTsKICAgICQodGV4dGFyZWEpLmNzcygnaGVpZ2h0JywgaGVpZ2h0KTsKICB9Owp9KShqUXVlcnkpOwoKKGZ1bmN0aW9uKCQpIHsKICB2YXIgY29tcCwgYnk7CgogIGZ1bmN0aW9uIGluaXQoKSB7CiAgICBpbml0RXZlbnRzKCk7CiAgICBpbml0Q29tcGFyYXRvcigpOwogIH0KCiAgZnVuY3Rpb24gaW5pdEV2ZW50cygpIHsKICAgICQoJ2EuY29tbWVudC1jbG9zZScpLmxpdmUoImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgaGlkZSgkKHRoaXMpLmF0dHIoJ2lkJykuc3Vic3RyaW5nKDIpKTsKICAgIH0pOwogICAgJCgnYS52b3RlJykubGl2ZSgiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBoYW5kbGVWb3RlKCQodGhpcykpOwogICAgfSk7CiAgICAkKCdhLnJlcGx5JykubGl2ZSgiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBvcGVuUmVwbHkoJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICB9KTsKICAgICQoJ2EuY2xvc2UtcmVwbHknKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGNsb3NlUmVwbHkoJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICB9KTsKICAgICQoJ2Euc29ydC1vcHRpb24nKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGhhbmRsZVJlU29ydCgkKHRoaXMpKTsKICAgIH0pOwogICAgJCgnYS5zaG93LXByb3Bvc2FsJykubGl2ZSgiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBzaG93UHJvcG9zYWwoJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICB9KTsKICAgICQoJ2EuaGlkZS1wcm9wb3NhbCcpLmxpdmUoImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgaGlkZVByb3Bvc2FsKCQodGhpcykuYXR0cignaWQnKS5zdWJzdHJpbmcoMikpOwogICAgfSk7CiAgICAkKCdhLnNob3ctcHJvcG9zZS1jaGFuZ2UnKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHNob3dQcm9wb3NlQ2hhbmdlKCQodGhpcykuYXR0cignaWQnKS5zdWJzdHJpbmcoMikpOwogICAgfSk7CiAgICAkKCdhLmhpZGUtcHJvcG9zZS1jaGFuZ2UnKS5saXZlKCJjbGljayIsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGhpZGVQcm9wb3NlQ2hhbmdlKCQodGhpcykuYXR0cignaWQnKS5zdWJzdHJpbmcoMikpOwogICAgfSk7CiAgICAkKCdhLmFjY2VwdC1jb21tZW50JykubGl2ZSgiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBhY2NlcHRDb21tZW50KCQodGhpcykuYXR0cignaWQnKS5zdWJzdHJpbmcoMikpOwogICAgfSk7CiAgICAkKCdhLmRlbGV0ZS1jb21tZW50JykubGl2ZSgiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBkZWxldGVDb21tZW50KCQodGhpcykuYXR0cignaWQnKS5zdWJzdHJpbmcoMikpOwogICAgfSk7CiAgICAkKCdhLmNvbW1lbnQtbWFya3VwJykubGl2ZSgiY2xpY2siLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB0b2dnbGVDb21tZW50TWFya3VwQm94KCQodGhpcykuYXR0cignaWQnKS5zdWJzdHJpbmcoMikpOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBTZXQgY29tcCwgd2hpY2ggaXMgYSBjb21wYXJhdG9yIGZ1bmN0aW9uIHVzZWQgZm9yIHNvcnRpbmcgYW5kCiAgICogaW5zZXJ0aW5nIGNvbW1lbnRzIGludG8gdGhlIGxpc3QuCiAgICovCiAgZnVuY3Rpb24gc2V0Q29tcGFyYXRvcigpIHsKICAgIC8vIElmIHRoZSBmaXJzdCB0aHJlZSBsZXR0ZXJzIGFyZSAiYXNjIiwgc29ydCBpbiBhc2NlbmRpbmcgb3JkZXIKICAgIC8vIGFuZCByZW1vdmUgdGhlIHByZWZpeC4KICAgIGlmIChieS5zdWJzdHJpbmcoMCwzKSA9PSAnYXNjJykgewogICAgICB2YXIgaSA9IGJ5LnN1YnN0cmluZygzKTsKICAgICAgY29tcCA9IGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGFbaV0gLSBiW2ldOyB9OwogICAgfSBlbHNlIHsKICAgICAgLy8gT3RoZXJ3aXNlIHNvcnQgaW4gZGVzY2VuZGluZyBvcmRlci4KICAgICAgY29tcCA9IGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGJbYnldIC0gYVtieV07IH07CiAgICB9CgogICAgLy8gUmVzZXQgbGluayBzdHlsZXMgYW5kIGZvcm1hdCB0aGUgc2VsZWN0ZWQgc29ydCBvcHRpb24uCiAgICAkKCdhLnNlbCcpLmF0dHIoJ2hyZWYnLCAnIycpLnJlbW92ZUNsYXNzKCdzZWwnKTsKICAgICQoJ2EuYnknICsgYnkpLnJlbW92ZUF0dHIoJ2hyZWYnKS5hZGRDbGFzcygnc2VsJyk7CiAgfQoKICAvKioKICAgKiBDcmVhdGUgYSBjb21wIGZ1bmN0aW9uLiBJZiB0aGUgdXNlciBoYXMgcHJlZmVyZW5jZXMgc3RvcmVkIGluCiAgICogdGhlIHNvcnRCeSBjb29raWUsIHVzZSB0aG9zZSwgb3RoZXJ3aXNlIHVzZSB0aGUgZGVmYXVsdC4KICAgKi8KICBmdW5jdGlvbiBpbml0Q29tcGFyYXRvcigpIHsKICAgIGJ5ID0gJ3JhdGluZyc7IC8vIERlZmF1bHQgdG8gc29ydCBieSByYXRpbmcuCiAgICAvLyBJZiB0aGUgc29ydEJ5IGNvb2tpZSBpcyBzZXQsIHVzZSB0aGF0IGluc3RlYWQuCiAgICBpZiAoZG9jdW1lbnQuY29va2llLmxlbmd0aCA+IDApIHsKICAgICAgdmFyIHN0YXJ0ID0gZG9jdW1lbnQuY29va2llLmluZGV4T2YoJ3NvcnRCeT0nKTsKICAgICAgaWYgKHN0YXJ0ICE9IC0xKSB7CiAgICAgICAgc3RhcnQgPSBzdGFydCArIDc7CiAgICAgICAgdmFyIGVuZCA9IGRvY3VtZW50LmNvb2tpZS5pbmRleE9mKCI7Iiwgc3RhcnQpOwogICAgICAgIGlmIChlbmQgPT0gLTEpIHsKICAgICAgICAgIGVuZCA9IGRvY3VtZW50LmNvb2tpZS5sZW5ndGg7CiAgICAgICAgICBieSA9IHVuZXNjYXBlKGRvY3VtZW50LmNvb2tpZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgc2V0Q29tcGFyYXRvcigpOwogIH0KCiAgLyoqCiAgICogU2hvdyBhIGNvbW1lbnQgZGl2LgogICAqLwogIGZ1bmN0aW9uIHNob3coaWQpIHsKICAgICQoJyNhbycgKyBpZCkuaGlkZSgpOwogICAgJCgnI2FoJyArIGlkKS5zaG93KCk7CiAgICB2YXIgY29udGV4dCA9ICQuZXh0ZW5kKHtpZDogaWR9LCBvcHRzKTsKICAgIHZhciBwb3B1cCA9ICQocmVuZGVyVGVtcGxhdGUocG9wdXBUZW1wbGF0ZSwgY29udGV4dCkpLmhpZGUoKTsKICAgIHBvcHVwLmZpbmQoJ3RleHRhcmVhW25hbWU9InByb3Bvc2FsIl0nKS5oaWRlKCk7CiAgICBwb3B1cC5maW5kKCdhLmJ5JyArIGJ5KS5hZGRDbGFzcygnc2VsJyk7CiAgICB2YXIgZm9ybSA9IHBvcHVwLmZpbmQoJyNjZicgKyBpZCk7CiAgICBmb3JtLnN1Ym1pdChmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBhZGRDb21tZW50KGZvcm0pOwogICAgfSk7CiAgICAkKCcjcycgKyBpZCkuYWZ0ZXIocG9wdXApOwogICAgcG9wdXAuc2xpZGVEb3duKCdmYXN0JywgZnVuY3Rpb24oKSB7CiAgICAgIGdldENvbW1lbnRzKGlkKTsKICAgIH0pOwogIH0KCiAgLyoqCiAgICogSGlkZSBhIGNvbW1lbnQgZGl2LgogICAqLwogIGZ1bmN0aW9uIGhpZGUoaWQpIHsKICAgICQoJyNhaCcgKyBpZCkuaGlkZSgpOwogICAgJCgnI2FvJyArIGlkKS5zaG93KCk7CiAgICB2YXIgZGl2ID0gJCgnI3NjJyArIGlkKTsKICAgIGRpdi5zbGlkZVVwKCdmYXN0JywgZnVuY3Rpb24oKSB7CiAgICAgIGRpdi5yZW1vdmUoKTsKICAgIH0pOwogIH0KCiAgLyoqCiAgICogUGVyZm9ybSBhbiBhamF4IHJlcXVlc3QgdG8gZ2V0IGNvbW1lbnRzIGZvciBhIG5vZGUKICAgKiBhbmQgaW5zZXJ0IHRoZSBjb21tZW50cyBpbnRvIHRoZSBjb21tZW50cyB0cmVlLgogICAqLwogIGZ1bmN0aW9uIGdldENvbW1lbnRzKGlkKSB7CiAgICAkLmFqYXgoewogICAgIHR5cGU6ICdHRVQnLAogICAgIHVybDogb3B0cy5nZXRDb21tZW50c1VSTCwKICAgICBkYXRhOiB7bm9kZTogaWR9LAogICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHJlcXVlc3QpIHsKICAgICAgIHZhciB1bCA9ICQoJyNjbCcgKyBpZCk7CiAgICAgICB2YXIgc3BlZWQgPSAxMDA7CiAgICAgICAkKCcjY2YnICsgaWQpCiAgICAgICAgIC5maW5kKCd0ZXh0YXJlYVtuYW1lPSJwcm9wb3NhbCJdJykKICAgICAgICAgLmRhdGEoJ3NvdXJjZScsIGRhdGEuc291cmNlKTsKCiAgICAgICBpZiAoZGF0YS5jb21tZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgdWwuaHRtbCgnPGxpPk5vIGNvbW1lbnRzIHlldC48L2xpPicpOwogICAgICAgICB1bC5kYXRhKCdlbXB0eScsIHRydWUpOwogICAgICAgfSBlbHNlIHsKICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIGNvbW1lbnRzLCBzb3J0IHRoZW0gYW5kIHB1dCB0aGVtIGluIHRoZSBsaXN0LgogICAgICAgICB2YXIgY29tbWVudHMgPSBzb3J0Q29tbWVudHMoZGF0YS5jb21tZW50cyk7CiAgICAgICAgIHNwZWVkID0gZGF0YS5jb21tZW50cy5sZW5ndGggKiAxMDA7CiAgICAgICAgIGFwcGVuZENvbW1lbnRzKGNvbW1lbnRzLCB1bCk7CiAgICAgICAgIHVsLmRhdGEoJ2VtcHR5JywgZmFsc2UpOwogICAgICAgfQogICAgICAgJCgnI2NuJyArIGlkKS5zbGlkZVVwKHNwZWVkICsgMjAwKTsKICAgICAgIHVsLnNsaWRlRG93bihzcGVlZCk7CiAgICAgfSwKICAgICBlcnJvcjogZnVuY3Rpb24ocmVxdWVzdCwgdGV4dFN0YXR1cywgZXJyb3IpIHsKICAgICAgIHNob3dFcnJvcignT29wcywgdGhlcmUgd2FzIGEgcHJvYmxlbSByZXRyaWV2aW5nIHRoZSBjb21tZW50cy4nKTsKICAgICB9LAogICAgIGRhdGFUeXBlOiAnanNvbicKICAgIH0pOwogIH0KCiAgLyoqCiAgICogQWRkIGEgY29tbWVudCB2aWEgYWpheCBhbmQgaW5zZXJ0IHRoZSBjb21tZW50IGludG8gdGhlIGNvbW1lbnQgdHJlZS4KICAgKi8KICBmdW5jdGlvbiBhZGRDb21tZW50KGZvcm0pIHsKICAgIHZhciBub2RlX2lkID0gZm9ybS5maW5kKCdpbnB1dFtuYW1lPSJub2RlIl0nKS52YWwoKTsKICAgIHZhciBwYXJlbnRfaWQgPSBmb3JtLmZpbmQoJ2lucHV0W25hbWU9InBhcmVudCJdJykudmFsKCk7CiAgICB2YXIgdGV4dCA9IGZvcm0uZmluZCgndGV4dGFyZWFbbmFtZT0iY29tbWVudCJdJykudmFsKCk7CiAgICB2YXIgcHJvcG9zYWwgPSBmb3JtLmZpbmQoJ3RleHRhcmVhW25hbWU9InByb3Bvc2FsIl0nKS52YWwoKTsKCiAgICBpZiAodGV4dCA9PSAnJykgewogICAgICBzaG93RXJyb3IoJ1BsZWFzZSBlbnRlciBhIGNvbW1lbnQuJyk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBEaXNhYmxlIHRoZSBmb3JtIHRoYXQgaXMgYmVpbmcgc3VibWl0dGVkLgogICAgZm9ybS5maW5kKCd0ZXh0YXJlYSxpbnB1dCcpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7CgogICAgLy8gU2VuZCB0aGUgY29tbWVudCB0byB0aGUgc2VydmVyLgogICAgJC5hamF4KHsKICAgICAgdHlwZTogIlBPU1QiLAogICAgICB1cmw6IG9wdHMuYWRkQ29tbWVudFVSTCwKICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgZGF0YTogewogICAgICAgIG5vZGU6IG5vZGVfaWQsCiAgICAgICAgcGFyZW50OiBwYXJlbnRfaWQsCiAgICAgICAgdGV4dDogdGV4dCwKICAgICAgICBwcm9wb3NhbDogcHJvcG9zYWwKICAgICAgfSwKICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgZXJyb3IpIHsKICAgICAgICAvLyBSZXNldCB0aGUgZm9ybS4KICAgICAgICBpZiAobm9kZV9pZCkgewogICAgICAgICAgaGlkZVByb3Bvc2VDaGFuZ2Uobm9kZV9pZCk7CiAgICAgICAgfQogICAgICAgIGZvcm0uZmluZCgndGV4dGFyZWEnKQogICAgICAgICAgLnZhbCgnJykKICAgICAgICAgIC5hZGQoZm9ybS5maW5kKCdpbnB1dCcpKQogICAgICAgICAgLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7Cgl2YXIgdWwgPSAkKCcjY2wnICsgKG5vZGVfaWQgfHwgcGFyZW50X2lkKSk7CiAgICAgICAgaWYgKHVsLmRhdGEoJ2VtcHR5JykpIHsKICAgICAgICAgICQodWwpLmVtcHR5KCk7CiAgICAgICAgICB1bC5kYXRhKCdlbXB0eScsIGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgaW5zZXJ0Q29tbWVudChkYXRhLmNvbW1lbnQpOwogICAgICAgIHZhciBhbyA9ICQoJyNhbycgKyBub2RlX2lkKTsKICAgICAgICBhby5maW5kKCdpbWcnKS5hdHRyKHsnc3JjJzogb3B0cy5jb21tZW50QnJpZ2h0SW1hZ2V9KTsKICAgICAgICBpZiAobm9kZV9pZCkgewogICAgICAgICAgLy8gaWYgdGhpcyB3YXMgYSAicm9vdCIgY29tbWVudCwgcmVtb3ZlIHRoZSBjb21tZW50aW5nIGJveAogICAgICAgICAgLy8gKHRoZSB1c2VyIGNhbiBnZXQgaXQgYmFjayBieSByZW9wZW5pbmcgdGhlIGNvbW1lbnQgcG9wdXApCiAgICAgICAgICAkKCcjY2EnICsgbm9kZV9pZCkuc2xpZGVVcCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yKSB7CiAgICAgICAgZm9ybS5maW5kKCd0ZXh0YXJlYSxpbnB1dCcpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7CiAgICAgICAgc2hvd0Vycm9yKCdPb3BzLCB0aGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyB0aGUgY29tbWVudC4nKTsKICAgICAgfQogICAgfSk7CiAgfQoKICAvKioKICAgKiBSZWN1cnNpdmVseSBhcHBlbmQgY29tbWVudHMgdG8gdGhlIG1haW4gY29tbWVudCBsaXN0IGFuZCBjaGlsZHJlbgogICAqIGxpc3RzLCBjcmVhdGluZyB0aGUgY29tbWVudCB0cmVlLgogICAqLwogIGZ1bmN0aW9uIGFwcGVuZENvbW1lbnRzKGNvbW1lbnRzLCB1bCkgewogICAgJC5lYWNoKGNvbW1lbnRzLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGRpdiA9IGNyZWF0ZUNvbW1lbnREaXYodGhpcyk7CiAgICAgIHVsLmFwcGVuZCgkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJykpLmh0bWwoZGl2KSk7CiAgICAgIGFwcGVuZENvbW1lbnRzKHRoaXMuY2hpbGRyZW4sIGRpdi5maW5kKCd1bC5jb21tZW50LWNoaWxkcmVuJykpOwogICAgICAvLyBUbyBhdm9pZCBzdGFnbmF0aW5nIGRhdGEsIGRvbid0IHN0b3JlIHRoZSBjb21tZW50cyBjaGlsZHJlbiBpbiBkYXRhLgogICAgICB0aGlzLmNoaWxkcmVuID0gbnVsbDsKICAgICAgZGl2LmRhdGEoJ2NvbW1lbnQnLCB0aGlzKTsKICAgIH0pOwogIH0KCiAgLyoqCiAgICogQWZ0ZXIgYWRkaW5nIGEgbmV3IGNvbW1lbnQsIGl0IG11c3QgYmUgaW5zZXJ0ZWQgaW4gdGhlIGNvcnJlY3QKICAgKiBsb2NhdGlvbiBpbiB0aGUgY29tbWVudCB0cmVlLgogICAqLwogIGZ1bmN0aW9uIGluc2VydENvbW1lbnQoY29tbWVudCkgewogICAgdmFyIGRpdiA9IGNyZWF0ZUNvbW1lbnREaXYoY29tbWVudCk7CgogICAgLy8gVG8gYXZvaWQgc3RhZ25hdGluZyBkYXRhLCBkb24ndCBzdG9yZSB0aGUgY29tbWVudHMgY2hpbGRyZW4gaW4gZGF0YS4KICAgIGNvbW1lbnQuY2hpbGRyZW4gPSBudWxsOwogICAgZGl2LmRhdGEoJ2NvbW1lbnQnLCBjb21tZW50KTsKCiAgICB2YXIgdWwgPSAkKCcjY2wnICsgKGNvbW1lbnQubm9kZSB8fCBjb21tZW50LnBhcmVudCkpOwogICAgdmFyIHNpYmxpbmdzID0gZ2V0Q2hpbGRyZW4odWwpOwoKICAgIHZhciBsaSA9ICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKSk7CiAgICBsaS5oaWRlKCk7CgogICAgLy8gRGV0ZXJtaW5lIHdoZXJlIGluIHRoZSBwYXJlbnRzIGNoaWxkcmVuIGxpc3QgdG8gaW5zZXJ0IHRoaXMgY29tbWVudC4KICAgIGZvcihpPTA7IGkgPCBzaWJsaW5ncy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoY29tcChjb21tZW50LCBzaWJsaW5nc1tpXSkgPD0gMCkgewogICAgICAgICQoJyNjZCcgKyBzaWJsaW5nc1tpXS5pZCkKICAgICAgICAgIC5wYXJlbnQoKQogICAgICAgICAgLmJlZm9yZShsaS5odG1sKGRpdikpOwogICAgICAgIGxpLnNsaWRlRG93bignZmFzdCcpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQoKICAgIC8vIElmIHdlIGdldCBoZXJlLCB0aGlzIGNvbW1lbnQgcmF0ZXMgbG93ZXIgdGhhbiBhbGwgdGhlIG90aGVycywKICAgIC8vIG9yIGl0IGlzIHRoZSBvbmx5IGNvbW1lbnQgaW4gdGhlIGxpc3QuCiAgICB1bC5hcHBlbmQobGkuaHRtbChkaXYpKTsKICAgIGxpLnNsaWRlRG93bignZmFzdCcpOwogIH0KCiAgZnVuY3Rpb24gYWNjZXB0Q29tbWVudChpZCkgewogICAgJC5hamF4KHsKICAgICAgdHlwZTogJ1BPU1QnLAogICAgICB1cmw6IG9wdHMuYWNjZXB0Q29tbWVudFVSTCwKICAgICAgZGF0YToge2lkOiBpZH0sCiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHJlcXVlc3QpIHsKICAgICAgICAkKCcjY20nICsgaWQpLmZhZGVPdXQoJ2Zhc3QnKTsKICAgICAgICAkKCcjY2QnICsgaWQpLnJlbW92ZUNsYXNzKCdtb2RlcmF0ZScpOwogICAgICB9LAogICAgICBlcnJvcjogZnVuY3Rpb24ocmVxdWVzdCwgdGV4dFN0YXR1cywgZXJyb3IpIHsKICAgICAgICBzaG93RXJyb3IoJ09vcHMsIHRoZXJlIHdhcyBhIHByb2JsZW0gYWNjZXB0aW5nIHRoZSBjb21tZW50LicpOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQoaWQpIHsKICAgICQuYWpheCh7CiAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgdXJsOiBvcHRzLmRlbGV0ZUNvbW1lbnRVUkwsCiAgICAgIGRhdGE6IHtpZDogaWR9LAogICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCByZXF1ZXN0KSB7CiAgICAgICAgdmFyIGRpdiA9ICQoJyNjZCcgKyBpZCk7CiAgICAgICAgaWYgKGRhdGEgPT0gJ2RlbGV0ZScpIHsKICAgICAgICAgIC8vIE1vZGVyYXRvciBtb2RlOiByZW1vdmUgdGhlIGNvbW1lbnQgYW5kIGFsbCBjaGlsZHJlbiBpbW1lZGlhdGVseQogICAgICAgICAgZGl2LnNsaWRlVXAoJ2Zhc3QnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZGl2LnJlbW92ZSgpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIFVzZXIgbW9kZTogb25seSBtYXJrIHRoZSBjb21tZW50IGFzIGRlbGV0ZWQKICAgICAgICBkaXYKICAgICAgICAgIC5maW5kKCdzcGFuLnVzZXItaWQ6Zmlyc3QnKQogICAgICAgICAgLnRleHQoJ1tkZWxldGVkXScpLmVuZCgpCiAgICAgICAgICAuZmluZCgnZGl2LmNvbW1lbnQtdGV4dDpmaXJzdCcpCiAgICAgICAgICAudGV4dCgnW2RlbGV0ZWRdJykuZW5kKCkKICAgICAgICAgIC5maW5kKCcjY20nICsgaWQgKyAnLCAjZGMnICsgaWQgKyAnLCAjYWMnICsgaWQgKyAnLCAjcmMnICsgaWQgKwogICAgICAgICAgICAgICAgJywgI3NwJyArIGlkICsgJywgI2hwJyArIGlkICsgJywgI2NyJyArIGlkICsgJywgI3JsJyArIGlkKQogICAgICAgICAgLnJlbW92ZSgpOwogICAgICAgIHZhciBjb21tZW50ID0gZGl2LmRhdGEoJ2NvbW1lbnQnKTsKICAgICAgICBjb21tZW50LnVzZXJuYW1lID0gJ1tkZWxldGVkXSc7CiAgICAgICAgY29tbWVudC50ZXh0ID0gJ1tkZWxldGVkXSc7CiAgICAgICAgZGl2LmRhdGEoJ2NvbW1lbnQnLCBjb21tZW50KTsKICAgICAgfSwKICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yKSB7CiAgICAgICAgc2hvd0Vycm9yKCdPb3BzLCB0aGVyZSB3YXMgYSBwcm9ibGVtIGRlbGV0aW5nIHRoZSBjb21tZW50LicpOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHNob3dQcm9wb3NhbChpZCkgewogICAgJCgnI3NwJyArIGlkKS5oaWRlKCk7CiAgICAkKCcjaHAnICsgaWQpLnNob3coKTsKICAgICQoJyNwcicgKyBpZCkuc2xpZGVEb3duKCdmYXN0Jyk7CiAgfQoKICBmdW5jdGlvbiBoaWRlUHJvcG9zYWwoaWQpIHsKICAgICQoJyNocCcgKyBpZCkuaGlkZSgpOwogICAgJCgnI3NwJyArIGlkKS5zaG93KCk7CiAgICAkKCcjcHInICsgaWQpLnNsaWRlVXAoJ2Zhc3QnKTsKICB9CgogIGZ1bmN0aW9uIHNob3dQcm9wb3NlQ2hhbmdlKGlkKSB7CiAgICAkKCcjcGMnICsgaWQpLmhpZGUoKTsKICAgICQoJyNoYycgKyBpZCkuc2hvdygpOwogICAgdmFyIHRleHRhcmVhID0gJCgnI3B0JyArIGlkKTsKICAgIHRleHRhcmVhLnZhbCh0ZXh0YXJlYS5kYXRhKCdzb3VyY2UnKSk7CiAgICAkLmZuLmF1dG9ncm93LnJlc2l6ZSh0ZXh0YXJlYVswXSk7CiAgICB0ZXh0YXJlYS5zbGlkZURvd24oJ2Zhc3QnKTsKICB9CgogIGZ1bmN0aW9uIGhpZGVQcm9wb3NlQ2hhbmdlKGlkKSB7CiAgICAkKCcjaGMnICsgaWQpLmhpZGUoKTsKICAgICQoJyNwYycgKyBpZCkuc2hvdygpOwogICAgdmFyIHRleHRhcmVhID0gJCgnI3B0JyArIGlkKTsKICAgIHRleHRhcmVhLnZhbCgnJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKICAgIHRleHRhcmVhLnNsaWRlVXAoJ2Zhc3QnKTsKICB9CgogIGZ1bmN0aW9uIHRvZ2dsZUNvbW1lbnRNYXJrdXBCb3goaWQpIHsKICAgICQoJyNtYicgKyBpZCkudG9nZ2xlKCk7CiAgfQoKICAvKiogSGFuZGxlIHdoZW4gdGhlIHVzZXIgY2xpY2tzIG9uIGEgc29ydCBieSBsaW5rLiAqLwogIGZ1bmN0aW9uIGhhbmRsZVJlU29ydChsaW5rKSB7CiAgICB2YXIgY2xhc3NlcyA9IGxpbmsuYXR0cignY2xhc3MnKS5zcGxpdCgvXHMrLyk7CiAgICBmb3IgKHZhciBpPTA7IGk8Y2xhc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoY2xhc3Nlc1tpXSAhPSAnc29ydC1vcHRpb24nKSB7CglieSA9IGNsYXNzZXNbaV0uc3Vic3RyaW5nKDIpOwogICAgICB9CiAgICB9CiAgICBzZXRDb21wYXJhdG9yKCk7CiAgICAvLyBTYXZlL3VwZGF0ZSB0aGUgc29ydEJ5IGNvb2tpZS4KICAgIHZhciBleHBpcmF0aW9uID0gbmV3IERhdGUoKTsKICAgIGV4cGlyYXRpb24uc2V0RGF0ZShleHBpcmF0aW9uLmdldERhdGUoKSArIDM2NSk7CiAgICBkb2N1bWVudC5jb29raWU9ICdzb3J0Qnk9JyArIGVzY2FwZShieSkgKwogICAgICAgICAgICAgICAgICAgICAnO2V4cGlyZXM9JyArIGV4cGlyYXRpb24udG9VVENTdHJpbmcoKTsKICAgICQoJ3VsLmNvbW1lbnQtdWwnKS5lYWNoKGZ1bmN0aW9uKGluZGV4LCB1bCkgewogICAgICB2YXIgY29tbWVudHMgPSBnZXRDaGlsZHJlbigkKHVsKSwgdHJ1ZSk7CiAgICAgIGNvbW1lbnRzID0gc29ydENvbW1lbnRzKGNvbW1lbnRzKTsKICAgICAgYXBwZW5kQ29tbWVudHMoY29tbWVudHMsICQodWwpLmVtcHR5KCkpOwogICAgfSk7CiAgfQoKICAvKioKICAgKiBGdW5jdGlvbiB0byBwcm9jZXNzIGEgdm90ZSB3aGVuIGEgdXNlciBjbGlja3MgYW4gYXJyb3cuCiAgICovCiAgZnVuY3Rpb24gaGFuZGxlVm90ZShsaW5rKSB7CiAgICBpZiAoIW9wdHMudm90aW5nKSB7CiAgICAgIHNob3dFcnJvcigiWW91J2xsIG5lZWQgdG8gbG9naW4gdG8gdm90ZS4iKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBpZCA9IGxpbmsuYXR0cignaWQnKTsKICAgIGlmICghaWQpIHsKICAgICAgLy8gRGlkbid0IGNsaWNrIG9uIG9uZSBvZiB0aGUgdm90aW5nIGFycm93cy4KICAgICAgcmV0dXJuOwogICAgfQogICAgLy8gSWYgaXQgaXMgYW4gdW52b3RlLCB0aGUgbmV3IHZvdGUgdmFsdWUgaXMgMCwKICAgIC8vIE90aGVyd2lzZSBpdCdzIDEgZm9yIGFuIHVwdm90ZSwgb3IgLTEgZm9yIGEgZG93bnZvdGUuCiAgICB2YXIgdmFsdWUgPSAwOwogICAgaWYgKGlkLmNoYXJBdCgxKSAhPSAndScpIHsKICAgICAgdmFsdWUgPSBpZC5jaGFyQXQoMCkgPT0gJ3UnID8gMSA6IC0xOwogICAgfQogICAgLy8gVGhlIGRhdGEgdG8gYmUgc2VudCB0byB0aGUgc2VydmVyLgogICAgdmFyIGQgPSB7CiAgICAgIGNvbW1lbnRfaWQ6IGlkLnN1YnN0cmluZygyKSwKICAgICAgdmFsdWU6IHZhbHVlCiAgICB9OwoKICAgIC8vIFN3YXAgdGhlIHZvdGUgYW5kIHVudm90ZSBsaW5rcy4KICAgIGxpbmsuaGlkZSgpOwogICAgJCgnIycgKyBpZC5jaGFyQXQoMCkgKyAoaWQuY2hhckF0KDEpID09ICd1JyA/ICd2JyA6ICd1JykgKyBkLmNvbW1lbnRfaWQpCiAgICAgIC5zaG93KCk7CgogICAgLy8gVGhlIGRpdiB0aGUgY29tbWVudCBpcyBkaXNwbGF5ZWQgaW4uCiAgICB2YXIgZGl2ID0gJCgnZGl2I2NkJyArIGQuY29tbWVudF9pZCk7CiAgICB2YXIgZGF0YSA9IGRpdi5kYXRhKCdjb21tZW50Jyk7CgogICAgLy8gSWYgdGhpcyBpcyBub3QgYW4gdW52b3RlLCBhbmQgdGhlIG90aGVyIHZvdGUgYXJyb3cgaGFzCiAgICAvLyBhbHJlYWR5IGJlZW4gcHJlc3NlZCwgdW5wcmVzcyBpdC4KICAgIGlmICgoZC52YWx1ZSAhPT0gMCkgJiYgKGRhdGEudm90ZSA9PT0gZC52YWx1ZSAqIC0xKSkgewogICAgICAkKCcjJyArIChkLnZhbHVlID09IDEgPyAnZCcgOiAndScpICsgJ3UnICsgZC5jb21tZW50X2lkKS5oaWRlKCk7CiAgICAgICQoJyMnICsgKGQudmFsdWUgPT0gMSA/ICdkJyA6ICd1JykgKyAndicgKyBkLmNvbW1lbnRfaWQpLnNob3coKTsKICAgIH0KCiAgICAvLyBVcGRhdGUgdGhlIGNvbW1lbnRzIHJhdGluZyBpbiB0aGUgbG9jYWwgZGF0YS4KICAgIGRhdGEucmF0aW5nICs9IChkYXRhLnZvdGUgPT09IDApID8gZC52YWx1ZSA6IChkLnZhbHVlIC0gZGF0YS52b3RlKTsKICAgIGRhdGEudm90ZSA9IGQudmFsdWU7CiAgICBkaXYuZGF0YSgnY29tbWVudCcsIGRhdGEpOwoKICAgIC8vIENoYW5nZSB0aGUgcmF0aW5nIHRleHQuCiAgICBkaXYuZmluZCgnLnJhdGluZzpmaXJzdCcpCiAgICAgIC50ZXh0KGRhdGEucmF0aW5nICsgJyBwb2ludCcgKyAoZGF0YS5yYXRpbmcgPT0gMSA/ICcnIDogJ3MnKSk7CgogICAgLy8gU2VuZCB0aGUgdm90ZSBpbmZvcm1hdGlvbiB0byB0aGUgc2VydmVyLgogICAgJC5hamF4KHsKICAgICAgdHlwZTogIlBPU1QiLAogICAgICB1cmw6IG9wdHMucHJvY2Vzc1ZvdGVVUkwsCiAgICAgIGRhdGE6IGQsCiAgICAgIGVycm9yOiBmdW5jdGlvbihyZXF1ZXN0LCB0ZXh0U3RhdHVzLCBlcnJvcikgewogICAgICAgIHNob3dFcnJvcignT29wcywgdGhlcmUgd2FzIGEgcHJvYmxlbSBjYXN0aW5nIHRoYXQgdm90ZS4nKTsKICAgICAgfQogICAgfSk7CiAgfQoKICAvKioKICAgKiBPcGVuIGEgcmVwbHkgZm9ybSB1c2VkIHRvIHJlcGx5IHRvIGFuIGV4aXN0aW5nIGNvbW1lbnQuCiAgICovCiAgZnVuY3Rpb24gb3BlblJlcGx5KGlkKSB7CiAgICAvLyBTd2FwIG91dCB0aGUgcmVwbHkgbGluayBmb3IgdGhlIGhpZGUgbGluawogICAgJCgnI3JsJyArIGlkKS5oaWRlKCk7CiAgICAkKCcjY3InICsgaWQpLnNob3coKTsKCiAgICAvLyBBZGQgdGhlIHJlcGx5IGxpIHRvIHRoZSBjaGlsZHJlbiB1bC4KICAgIHZhciBkaXYgPSAkKHJlbmRlclRlbXBsYXRlKHJlcGx5VGVtcGxhdGUsIHtpZDogaWR9KSkuaGlkZSgpOwogICAgJCgnI2NsJyArIGlkKQogICAgICAucHJlcGVuZChkaXYpCiAgICAgIC8vIFNldHVwIHRoZSBzdWJtaXQgaGFuZGxlciBmb3IgdGhlIHJlcGx5IGZvcm0uCiAgICAgIC5maW5kKCcjcmYnICsgaWQpCiAgICAgIC5zdWJtaXQoZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGFkZENvbW1lbnQoJCgnI3JmJyArIGlkKSk7CiAgICAgICAgY2xvc2VSZXBseShpZCk7CiAgICAgIH0pCiAgICAgIC5maW5kKCdpbnB1dFt0eXBlPWJ1dHRvbl0nKQogICAgICAuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgY2xvc2VSZXBseShpZCk7CiAgICAgIH0pOwogICAgZGl2LnNsaWRlRG93bignZmFzdCcsIGZ1bmN0aW9uKCkgewogICAgICAkKCcjcmYnICsgaWQpLmZpbmQoJ3RleHRhcmVhJykuZm9jdXMoKTsKICAgIH0pOwogIH0KCiAgLyoqCiAgICogQ2xvc2UgdGhlIHJlcGx5IGZvcm0gb3BlbmVkIHdpdGggb3BlblJlcGx5LgogICAqLwogIGZ1bmN0aW9uIGNsb3NlUmVwbHkoaWQpIHsKICAgIC8vIFJlbW92ZSB0aGUgcmVwbHkgZGl2IGZyb20gdGhlIERPTS4KICAgICQoJyNyZCcgKyBpZCkuc2xpZGVVcCgnZmFzdCcsIGZ1bmN0aW9uKCkgewogICAgICAkKHRoaXMpLnJlbW92ZSgpOwogICAgfSk7CgogICAgLy8gU3dhcCBvdXQgdGhlIGhpZGUgbGluayBmb3IgdGhlIHJlcGx5IGxpbmsKICAgICQoJyNjcicgKyBpZCkuaGlkZSgpOwogICAgJCgnI3JsJyArIGlkKS5zaG93KCk7CiAgfQoKICAvKioKICAgKiBSZWN1cnNpdmVseSBzb3J0IGEgdHJlZSBvZiBjb21tZW50cyB1c2luZyB0aGUgY29tcCBjb21wYXJhdG9yLgogICAqLwogIGZ1bmN0aW9uIHNvcnRDb21tZW50cyhjb21tZW50cykgewogICAgY29tbWVudHMuc29ydChjb21wKTsKICAgICQuZWFjaChjb21tZW50cywgZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBzb3J0Q29tbWVudHModGhpcy5jaGlsZHJlbik7CiAgICB9KTsKICAgIHJldHVybiBjb21tZW50czsKICB9CgogIC8qKgogICAqIEdldCB0aGUgY2hpbGRyZW4gY29tbWVudHMgZnJvbSBhIHVsLiBJZiByZWN1cnNpdmUgaXMgdHJ1ZSwKICAgKiByZWN1cnNpdmVseSBpbmNsdWRlIGNoaWxkcmVucycgY2hpbGRyZW4uCiAgICovCiAgZnVuY3Rpb24gZ2V0Q2hpbGRyZW4odWwsIHJlY3Vyc2l2ZSkgewogICAgdmFyIGNoaWxkcmVuID0gW107CiAgICB1bC5jaGlsZHJlbigpLmNoaWxkcmVuKCJbaWRePSdjZCddIikKICAgICAgLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGNvbW1lbnQgPSAkKHRoaXMpLmRhdGEoJ2NvbW1lbnQnKTsKICAgICAgICBpZiAocmVjdXJzaXZlKQogICAgICAgICAgY29tbWVudC5jaGlsZHJlbiA9IGdldENoaWxkcmVuKCQodGhpcykuZmluZCgnI2NsJyArIGNvbW1lbnQuaWQpLCB0cnVlKTsKICAgICAgICBjaGlsZHJlbi5wdXNoKGNvbW1lbnQpOwogICAgICB9KTsKICAgIHJldHVybiBjaGlsZHJlbjsKICB9CgogIC8qKiBDcmVhdGUgYSBkaXYgdG8gZGlzcGxheSBhIGNvbW1lbnQgaW4uICovCiAgZnVuY3Rpb24gY3JlYXRlQ29tbWVudERpdihjb21tZW50KSB7CiAgICBpZiAoIWNvbW1lbnQuZGlzcGxheWVkICYmICFvcHRzLm1vZGVyYXRvcikgewogICAgICByZXR1cm4gJCgnPGRpdiBjbGFzcz0ibW9kZXJhdGUiPlRoYW5rIHlvdSEgIFlvdXIgY29tbWVudCB3aWxsIHNob3cgdXAgJwogICAgICAgICAgICAgICArICdvbmNlIGl0IGlzIGhhcyBiZWVuIGFwcHJvdmVkIGJ5IGEgbW9kZXJhdG9yLjwvZGl2PicpOwogICAgfQogICAgLy8gUHJldHRpZnkgdGhlIGNvbW1lbnQgcmF0aW5nLgogICAgY29tbWVudC5wcmV0dHlfcmF0aW5nID0gY29tbWVudC5yYXRpbmcgKyAnIHBvaW50JyArCiAgICAgIChjb21tZW50LnJhdGluZyA9PSAxID8gJycgOiAncycpOwogICAgLy8gTWFrZSBhIGNsYXNzIChmb3IgZGlzcGxheWluZyBub3QgeWV0IG1vZGVyYXRlZCBjb21tZW50cyBkaWZmZXJlbnRseSkKICAgIGNvbW1lbnQuY3NzX2NsYXNzID0gY29tbWVudC5kaXNwbGF5ZWQgPyAnJyA6ICcgbW9kZXJhdGUnOwogICAgLy8gQ3JlYXRlIGEgZGl2IGZvciB0aGlzIGNvbW1lbnQuCiAgICB2YXIgY29udGV4dCA9ICQuZXh0ZW5kKHt9LCBvcHRzLCBjb21tZW50KTsKICAgIHZhciBkaXYgPSAkKHJlbmRlclRlbXBsYXRlKGNvbW1lbnRUZW1wbGF0ZSwgY29udGV4dCkpOwoKICAgIC8vIElmIHRoZSB1c2VyIGhhcyB2b3RlZCBvbiB0aGlzIGNvbW1lbnQsIGhpZ2hsaWdodCB0aGUgY29ycmVjdCBhcnJvdy4KICAgIGlmIChjb21tZW50LnZvdGUpIHsKICAgICAgdmFyIGRpcmVjdGlvbiA9IChjb21tZW50LnZvdGUgPT0gMSkgPyAndScgOiAnZCc7CiAgICAgIGRpdi5maW5kKCcjJyArIGRpcmVjdGlvbiArICd2JyArIGNvbW1lbnQuaWQpLmhpZGUoKTsKICAgICAgZGl2LmZpbmQoJyMnICsgZGlyZWN0aW9uICsgJ3UnICsgY29tbWVudC5pZCkuc2hvdygpOwogICAgfQoKICAgIGlmIChvcHRzLm1vZGVyYXRvciB8fCBjb21tZW50LnRleHQgIT0gJ1tkZWxldGVkXScpIHsKICAgICAgZGl2LmZpbmQoJ2EucmVwbHknKS5zaG93KCk7CiAgICAgIGlmIChjb21tZW50LnByb3Bvc2FsX2RpZmYpCiAgICAgICAgZGl2LmZpbmQoJyNzcCcgKyBjb21tZW50LmlkKS5zaG93KCk7CiAgICAgIGlmIChvcHRzLm1vZGVyYXRvciAmJiAhY29tbWVudC5kaXNwbGF5ZWQpCiAgICAgICAgZGl2LmZpbmQoJyNjbScgKyBjb21tZW50LmlkKS5zaG93KCk7CiAgICAgIGlmIChvcHRzLm1vZGVyYXRvciB8fCAob3B0cy51c2VybmFtZSA9PSBjb21tZW50LnVzZXJuYW1lKSkKICAgICAgICBkaXYuZmluZCgnI2RjJyArIGNvbW1lbnQuaWQpLnNob3coKTsKICAgIH0KICAgIHJldHVybiBkaXY7CiAgfQoKICAvKioKICAgKiBBIHNpbXBsZSB0ZW1wbGF0ZSByZW5kZXJlci4gUGxhY2Vob2xkZXJzIHN1Y2ggYXMgPCVpZCU+IGFyZSByZXBsYWNlZAogICAqIGJ5IGNvbnRleHRbJ2lkJ10gd2l0aCBpdGVtcyBiZWluZyBlc2NhcGVkLiBQbGFjZWhvbGRlcnMgc3VjaCBhcyA8I2lkIz4KICAgKiBhcmUgbm90IGVzY2FwZWQuCiAgICovCiAgZnVuY3Rpb24gcmVuZGVyVGVtcGxhdGUodGVtcGxhdGUsIGNvbnRleHQpIHsKICAgIHZhciBlc2MgPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTsKCiAgICBmdW5jdGlvbiBoYW5kbGUocGgsIGVzY2FwZSkgewogICAgICB2YXIgY3VyID0gY29udGV4dDsKICAgICAgJC5lYWNoKHBoLnNwbGl0KCcuJyksIGZ1bmN0aW9uKCkgewogICAgICAgIGN1ciA9IGN1clt0aGlzXTsKICAgICAgfSk7CiAgICAgIHJldHVybiBlc2NhcGUgPyBlc2MudGV4dChjdXIgfHwgIiIpLmh0bWwoKSA6IGN1cjsKICAgIH0KCiAgICByZXR1cm4gdGVtcGxhdGUucmVwbGFjZSgvPChbJSNdKShbXHdcLl0qKVwxPi9nLCBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGhhbmRsZShhcmd1bWVudHNbMl0sIGFyZ3VtZW50c1sxXSA9PSAnJScgPyB0cnVlIDogZmFsc2UpOwogICAgfSk7CiAgfQoKICAvKiogRmxhc2ggYW4gZXJyb3IgbWVzc2FnZSBicmllZmx5LiAqLwogIGZ1bmN0aW9uIHNob3dFcnJvcihtZXNzYWdlKSB7CiAgICAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKS5hdHRyKHsnY2xhc3MnOiAncG9wdXAtZXJyb3InfSkKICAgICAgLmFwcGVuZCgkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKQogICAgICAgICAgICAgICAuYXR0cih7J2NsYXNzJzogJ2Vycm9yLW1lc3NhZ2UnfSkudGV4dChtZXNzYWdlKSkKICAgICAgLmFwcGVuZFRvKCdib2R5JykKICAgICAgLmZhZGVJbigic2xvdyIpCiAgICAgIC5kZWxheSgyMDAwKQogICAgICAuZmFkZU91dCgic2xvdyIpOwogIH0KCiAgLyoqIEFkZCBhIGxpbmsgdGhlIHVzZXIgdXNlcyB0byBvcGVuIHRoZSBjb21tZW50cyBwb3B1cC4gKi8KICAkLmZuLmNvbW1lbnQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpZCA9ICQodGhpcykuYXR0cignaWQnKS5zdWJzdHJpbmcoMSk7CiAgICAgIHZhciBjb3VudCA9IENPTU1FTlRfTUVUQURBVEFbaWRdOwogICAgICB2YXIgdGl0bGUgPSBjb3VudCArICcgY29tbWVudCcgKyAoY291bnQgPT0gMSA/ICcnIDogJ3MnKTsKICAgICAgdmFyIGltYWdlID0gY291bnQgPiAwID8gb3B0cy5jb21tZW50QnJpZ2h0SW1hZ2UgOiBvcHRzLmNvbW1lbnRJbWFnZTsKICAgICAgdmFyIGFkZGNscyA9IGNvdW50ID09IDAgPyAnIG5vY29tbWVudCcgOiAnJzsKICAgICAgJCh0aGlzKQogICAgICAgIC5hcHBlbmQoCiAgICAgICAgICAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKSkuYXR0cih7CiAgICAgICAgICAgIGhyZWY6ICcjJywKICAgICAgICAgICAgJ2NsYXNzJzogJ3NwaGlueC1jb21tZW50LW9wZW4nICsgYWRkY2xzLAogICAgICAgICAgICBpZDogJ2FvJyArIGlkCiAgICAgICAgICB9KQogICAgICAgICAgICAuYXBwZW5kKCQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJykpLmF0dHIoewogICAgICAgICAgICAgIHNyYzogaW1hZ2UsCiAgICAgICAgICAgICAgYWx0OiAnY29tbWVudCcsCiAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlCiAgICAgICAgICAgIH0pKQogICAgICAgICAgICAuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIHNob3coJCh0aGlzKS5hdHRyKCdpZCcpLnN1YnN0cmluZygyKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgKQogICAgICAgIC5hcHBlbmQoCiAgICAgICAgICAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKSkuYXR0cih7CiAgICAgICAgICAgIGhyZWY6ICcjJywKICAgICAgICAgICAgJ2NsYXNzJzogJ3NwaGlueC1jb21tZW50LWNsb3NlIGhpZGRlbicsCiAgICAgICAgICAgIGlkOiAnYWgnICsgaWQKICAgICAgICAgIH0pCiAgICAgICAgICAgIC5hcHBlbmQoJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKSkuYXR0cih7CiAgICAgICAgICAgICAgc3JjOiBvcHRzLmNsb3NlQ29tbWVudEltYWdlLAogICAgICAgICAgICAgIGFsdDogJ2Nsb3NlJywKICAgICAgICAgICAgICB0aXRsZTogJ2Nsb3NlJwogICAgICAgICAgICB9KSkKICAgICAgICAgICAgLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICBoaWRlKCQodGhpcykuYXR0cignaWQnKS5zdWJzdHJpbmcoMikpOwogICAgICAgICAgICB9KQogICAgICAgICk7CiAgICB9KTsKICB9OwoKICB2YXIgb3B0cyA9IHsKICAgIHByb2Nlc3NWb3RlVVJMOiAnL19wcm9jZXNzX3ZvdGUnLAogICAgYWRkQ29tbWVudFVSTDogJy9fYWRkX2NvbW1lbnQnLAogICAgZ2V0Q29tbWVudHNVUkw6ICcvX2dldF9jb21tZW50cycsCiAgICBhY2NlcHRDb21tZW50VVJMOiAnL19hY2NlcHRfY29tbWVudCcsCiAgICBkZWxldGVDb21tZW50VVJMOiAnL19kZWxldGVfY29tbWVudCcsCiAgICBjb21tZW50SW1hZ2U6ICcvc3RhdGljL19zdGF0aWMvY29tbWVudC5wbmcnLAogICAgY2xvc2VDb21tZW50SW1hZ2U6ICcvc3RhdGljL19zdGF0aWMvY29tbWVudC1jbG9zZS5wbmcnLAogICAgbG9hZGluZ0ltYWdlOiAnL3N0YXRpYy9fc3RhdGljL2FqYXgtbG9hZGVyLmdpZicsCiAgICBjb21tZW50QnJpZ2h0SW1hZ2U6ICcvc3RhdGljL19zdGF0aWMvY29tbWVudC1icmlnaHQucG5nJywKICAgIHVwQXJyb3c6ICcvc3RhdGljL19zdGF0aWMvdXAucG5nJywKICAgIGRvd25BcnJvdzogJy9zdGF0aWMvX3N0YXRpYy9kb3duLnBuZycsCiAgICB1cEFycm93UHJlc3NlZDogJy9zdGF0aWMvX3N0YXRpYy91cC1wcmVzc2VkLnBuZycsCiAgICBkb3duQXJyb3dQcmVzc2VkOiAnL3N0YXRpYy9fc3RhdGljL2Rvd24tcHJlc3NlZC5wbmcnLAogICAgdm90aW5nOiBmYWxzZSwKICAgIG1vZGVyYXRvcjogZmFsc2UKICB9OwoKICBpZiAodHlwZW9mIENPTU1FTlRfT1BUSU9OUyAhPSAidW5kZWZpbmVkIikgewogICAgb3B0cyA9IGpRdWVyeS5leHRlbmQob3B0cywgQ09NTUVOVF9PUFRJT05TKTsKICB9CgogIHZhciBwb3B1cFRlbXBsYXRlID0gJ1wKICAgIDxkaXYgY2xhc3M9InNwaGlueC1jb21tZW50cyIgaWQ9InNjPCVpZCU+Ij5cCiAgICAgIDxwIGNsYXNzPSJzb3J0LW9wdGlvbnMiPlwKICAgICAgICBTb3J0IGJ5OlwKICAgICAgICA8YSBocmVmPSIjIiBjbGFzcz0ic29ydC1vcHRpb24gYnlyYXRpbmciPmJlc3QgcmF0ZWQ8L2E+XAogICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJzb3J0LW9wdGlvbiBieWFzY2FnZSI+bmV3ZXN0PC9hPlwKICAgICAgICA8YSBocmVmPSIjIiBjbGFzcz0ic29ydC1vcHRpb24gYnlhZ2UiPm9sZGVzdDwvYT5cCiAgICAgIDwvcD5cCiAgICAgIDxkaXYgY2xhc3M9ImNvbW1lbnQtaGVhZGVyIj5Db21tZW50czwvZGl2PlwKICAgICAgPGRpdiBjbGFzcz0iY29tbWVudC1sb2FkaW5nIiBpZD0iY248JWlkJT4iPlwKICAgICAgICBsb2FkaW5nIGNvbW1lbnRzLi4uIDxpbWcgc3JjPSI8JWxvYWRpbmdJbWFnZSU+IiBhbHQ9IiIgLz48L2Rpdj5cCiAgICAgIDx1bCBpZD0iY2w8JWlkJT4iIGNsYXNzPSJjb21tZW50LXVsIj48L3VsPlwKICAgICAgPGRpdiBpZD0iY2E8JWlkJT4iPlwKICAgICAgPHAgY2xhc3M9ImFkZC1hLWNvbW1lbnQiPkFkZCBhIGNvbW1lbnRcCiAgICAgICAgKDxhIGhyZWY9IiMiIGNsYXNzPSJjb21tZW50LW1hcmt1cCIgaWQ9ImFiPCVpZCU+Ij5tYXJrdXA8L2E+KTo8L3A+XAogICAgICA8ZGl2IGNsYXNzPSJjb21tZW50LW1hcmt1cC1ib3giIGlkPSJtYjwlaWQlPiI+XAogICAgICAgIHJlU3RydWN0dXJlZCB0ZXh0IG1hcmt1cDogPGk+KmVtcGgqPC9pPiwgPGI+KipzdHJvbmcqKjwvYj4sIFwKICAgICAgICA8dHQ+YGBjb2RlYGA8L3R0PiwgXAogICAgICAgIGNvZGUgYmxvY2tzOiA8dHQ+Ojo8L3R0PiBhbmQgYW4gaW5kZW50ZWQgYmxvY2sgYWZ0ZXIgYmxhbmsgbGluZTwvZGl2PlwKICAgICAgPGZvcm0gbWV0aG9kPSJwb3N0IiBpZD0iY2Y8JWlkJT4iIGNsYXNzPSJjb21tZW50LWZvcm0iIGFjdGlvbj0iIj5cCiAgICAgICAgPHRleHRhcmVhIG5hbWU9ImNvbW1lbnQiIGNvbHM9IjgwIj48L3RleHRhcmVhPlwKICAgICAgICA8cCBjbGFzcz0icHJvcG9zZS1idXR0b24iPlwKICAgICAgICAgIDxhIGhyZWY9IiMiIGlkPSJwYzwlaWQlPiIgY2xhc3M9InNob3ctcHJvcG9zZS1jaGFuZ2UiPlwKICAgICAgICAgICAgUHJvcG9zZSBhIGNoYW5nZSAmIzk2NTc7XAogICAgICAgICAgPC9hPlwKICAgICAgICAgIDxhIGhyZWY9IiMiIGlkPSJoYzwlaWQlPiIgY2xhc3M9ImhpZGUtcHJvcG9zZS1jaGFuZ2UiPlwKICAgICAgICAgICAgUHJvcG9zZSBhIGNoYW5nZSAmIzk2NjM7XAogICAgICAgICAgPC9hPlwKICAgICAgICA8L3A+XAogICAgICAgIDx0ZXh0YXJlYSBuYW1lPSJwcm9wb3NhbCIgaWQ9InB0PCVpZCU+IiBjb2xzPSI4MCJcCiAgICAgICAgICAgICAgICAgIHNwZWxsY2hlY2s9ImZhbHNlIj48L3RleHRhcmVhPlwKICAgICAgICA8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQWRkIGNvbW1lbnQiIC8+XAogICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9Im5vZGUiIHZhbHVlPSI8JWlkJT4iIC8+XAogICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InBhcmVudCIgdmFsdWU9IiIgLz5cCiAgICAgIDwvZm9ybT5cCiAgICAgIDwvZGl2PlwKICAgIDwvZGl2Pic7CgogIHZhciBjb21tZW50VGVtcGxhdGUgPSAnXAogICAgPGRpdiBpZD0iY2Q8JWlkJT4iIGNsYXNzPSJzcGhpbngtY29tbWVudDwlY3NzX2NsYXNzJT4iPlwKICAgICAgPGRpdiBjbGFzcz0idm90ZSI+XAogICAgICAgIDxkaXYgY2xhc3M9ImFycm93Ij5cCiAgICAgICAgICA8YSBocmVmPSIjIiBpZD0idXY8JWlkJT4iIGNsYXNzPSJ2b3RlIiB0aXRsZT0idm90ZSB1cCI+XAogICAgICAgICAgICA8aW1nIHNyYz0iPCV1cEFycm93JT4iIC8+XAogICAgICAgICAgPC9hPlwKICAgICAgICAgIDxhIGhyZWY9IiMiIGlkPSJ1dTwlaWQlPiIgY2xhc3M9InVuIHZvdGUiIHRpdGxlPSJ2b3RlIHVwIj5cCiAgICAgICAgICAgIDxpbWcgc3JjPSI8JXVwQXJyb3dQcmVzc2VkJT4iIC8+XAogICAgICAgICAgPC9hPlwKICAgICAgICA8L2Rpdj5cCiAgICAgICAgPGRpdiBjbGFzcz0iYXJyb3ciPlwKICAgICAgICAgIDxhIGhyZWY9IiMiIGlkPSJkdjwlaWQlPiIgY2xhc3M9InZvdGUiIHRpdGxlPSJ2b3RlIGRvd24iPlwKICAgICAgICAgICAgPGltZyBzcmM9IjwlZG93bkFycm93JT4iIGlkPSJkYTwlaWQlPiIgLz5cCiAgICAgICAgICA8L2E+XAogICAgICAgICAgPGEgaHJlZj0iIyIgaWQ9ImR1PCVpZCU+IiBjbGFzcz0idW4gdm90ZSIgdGl0bGU9InZvdGUgZG93biI+XAogICAgICAgICAgICA8aW1nIHNyYz0iPCVkb3duQXJyb3dQcmVzc2VkJT4iIC8+XAogICAgICAgICAgPC9hPlwKICAgICAgICA8L2Rpdj5cCiAgICAgIDwvZGl2PlwKICAgICAgPGRpdiBjbGFzcz0iY29tbWVudC1jb250ZW50Ij5cCiAgICAgICAgPHAgY2xhc3M9InRhZ2xpbmUgY29tbWVudCI+XAogICAgICAgICAgPHNwYW4gY2xhc3M9InVzZXItaWQiPjwldXNlcm5hbWUlPjwvc3Bhbj5cCiAgICAgICAgICA8c3BhbiBjbGFzcz0icmF0aW5nIj48JXByZXR0eV9yYXRpbmclPjwvc3Bhbj5cCiAgICAgICAgICA8c3BhbiBjbGFzcz0iZGVsdGEiPjwldGltZS5kZWx0YSU+PC9zcGFuPlwKICAgICAgICA8L3A+XAogICAgICAgIDxkaXYgY2xhc3M9ImNvbW1lbnQtdGV4dCBjb21tZW50Ij48I3RleHQjPjwvZGl2PlwKICAgICAgICA8cCBjbGFzcz0iY29tbWVudC1vcHRzIGNvbW1lbnQiPlwKICAgICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJyZXBseSBoaWRkZW4iIGlkPSJybDwlaWQlPiI+cmVwbHkgJiM5NjU3OzwvYT5cCiAgICAgICAgICA8YSBocmVmPSIjIiBjbGFzcz0iY2xvc2UtcmVwbHkiIGlkPSJjcjwlaWQlPiI+cmVwbHkgJiM5NjYzOzwvYT5cCiAgICAgICAgICA8YSBocmVmPSIjIiBpZD0ic3A8JWlkJT4iIGNsYXNzPSJzaG93LXByb3Bvc2FsIj5wcm9wb3NhbCAmIzk2NTc7PC9hPlwKICAgICAgICAgIDxhIGhyZWY9IiMiIGlkPSJocDwlaWQlPiIgY2xhc3M9ImhpZGUtcHJvcG9zYWwiPnByb3Bvc2FsICYjOTY2Mzs8L2E+XAogICAgICAgICAgPGEgaHJlZj0iIyIgaWQ9ImRjPCVpZCU+IiBjbGFzcz0iZGVsZXRlLWNvbW1lbnQgaGlkZGVuIj5kZWxldGU8L2E+XAogICAgICAgICAgPHNwYW4gaWQ9ImNtPCVpZCU+IiBjbGFzcz0ibW9kZXJhdGlvbiBoaWRkZW4iPlwKICAgICAgICAgICAgPGEgaHJlZj0iIyIgaWQ9ImFjPCVpZCU+IiBjbGFzcz0iYWNjZXB0LWNvbW1lbnQiPmFjY2VwdDwvYT5cCiAgICAgICAgICA8L3NwYW4+XAogICAgICAgIDwvcD5cCiAgICAgICAgPHByZSBjbGFzcz0icHJvcG9zYWwiIGlkPSJwcjwlaWQlPiI+XAo8I3Byb3Bvc2FsX2RpZmYjPlwKICAgICAgICA8L3ByZT5cCiAgICAgICAgICA8dWwgY2xhc3M9ImNvbW1lbnQtY2hpbGRyZW4iIGlkPSJjbDwlaWQlPiI+PC91bD5cCiAgICAgICAgPC9kaXY+XAogICAgICAgIDxkaXYgY2xhc3M9ImNsZWFybGVmdCI+PC9kaXY+XAogICAgICA8L2Rpdj5cCiAgICA8L2Rpdj4nOwoKICB2YXIgcmVwbHlUZW1wbGF0ZSA9ICdcCiAgICA8bGk+XAogICAgICA8ZGl2IGNsYXNzPSJyZXBseS1kaXYiIGlkPSJyZDwlaWQlPiI+XAogICAgICAgIDxmb3JtIGlkPSJyZjwlaWQlPiI+XAogICAgICAgICAgPHRleHRhcmVhIG5hbWU9ImNvbW1lbnQiIGNvbHM9IjgwIj48L3RleHRhcmVhPlwKICAgICAgICAgIDxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJBZGQgcmVwbHkiIC8+XAogICAgICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgdmFsdWU9IkNhbmNlbCIgLz5cCiAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJwYXJlbnQiIHZhbHVlPSI8JWlkJT4iIC8+XAogICAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0ibm9kZSIgdmFsdWU9IiIgLz5cCiAgICAgICAgPC9mb3JtPlwKICAgICAgPC9kaXY+XAogICAgPC9saT4nOwoKICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKICAgIGluaXQoKTsKICB9KTsKfSkoalF1ZXJ5KTsKCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewogIC8vIGFkZCBjb21tZW50IGFuY2hvcnMgZm9yIGFsbCBwYXJhZ3JhcGhzIHRoYXQgYXJlIGNvbW1lbnRhYmxlCiAgJCgnLnNwaGlueC1oYXMtY29tbWVudCcpLmNvbW1lbnQoKTsKCiAgLy8gaGlnaGxpZ2h0IHNlYXJjaCB3b3JkcyBpbiBzZWFyY2ggcmVzdWx0cwogICQoImRpdi5jb250ZXh0IikuZWFjaChmdW5jdGlvbigpIHsKICAgIHZhciBwYXJhbXMgPSAkLmdldFF1ZXJ5UGFyYW1ldGVycygpOwogICAgdmFyIHRlcm1zID0gKHBhcmFtcy5xKSA/IHBhcmFtcy5xWzBdLnNwbGl0KC9ccysvKSA6IFtdOwogICAgdmFyIHJlc3VsdCA9ICQodGhpcyk7CiAgICAkLmVhY2godGVybXMsIGZ1bmN0aW9uKCkgewogICAgICByZXN1bHQuaGlnaGxpZ2h0VGV4dCh0aGlzLnRvTG93ZXJDYXNlKCksICdoaWdobGlnaHRlZCcpOwogICAgfSk7CiAgfSk7CgogIC8vIGRpcmVjdGx5IG9wZW4gY29tbWVudCB3aW5kb3cgaWYgcmVxdWVzdGVkCiAgdmFyIGFuY2hvciA9IGRvY3VtZW50LmxvY2F0aW9uLmhhc2g7CiAgaWYgKGFuY2hvci5zdWJzdHJpbmcoMCwgOSkgPT0gJyNjb21tZW50LScpIHsKICAgICQoJyNhbycgKyBhbmNob3Iuc3Vic3RyaW5nKDkpKS5jbGljaygpOwogICAgZG9jdW1lbnQubG9jYXRpb24uaGFzaCA9ICcjcycgKyBhbmNob3Iuc3Vic3RyaW5nKDkpOwogIH0KfSk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 15:24:47 GMT",
                    "Content-Length": "25246",
                    "Date": "Thu, 06 Nov 2014 15:24:51 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}