{
    "url": "http://localhost:9999/alvarotrigo/fullPage.js/jquery.fullPage.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.hash</b> and written to <b>$()</b> via the following statements:<ul><li>var value =  window.location.hash.replace('#', '').split('/');</li><li>var destiny = value[0];</li><li>var section = $('[data-anchor=\"'+destiny+'\"]');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/alvarotrigo/fullPage.js/jquery.fullPage.js",
                "path": "/alvarotrigo/fullPage.js/jquery.fullPage.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hbHZhcm90cmlnby9mdWxsUGFnZS5qcy9qcXVlcnkuZnVsbFBhZ2UuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNTI0NjMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDE6NTk6MzIgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDAxOjU5OjMxIEdNVA0KDQovKioNCiAqIGZ1bGxQYWdlIDIuNC4zDQogKiBodHRwczovL2dpdGh1Yi5jb20vYWx2YXJvdHJpZ28vZnVsbFBhZ2UuanMNCiAqIE1JVCBsaWNlbnNlZA0KICoNCiAqIENvcHlyaWdodCAoQykgMjAxMyBhbHZhcm90cmlnby5jb20gLSBBIHByb2plY3QgYnkgQWx2YXJvIFRyaWdvDQogKi8NCg0KKGZ1bmN0aW9uKCQpIHsNCgkkLmZuLmZ1bGxwYWdlID0gZnVuY3Rpb24ob3B0aW9ucykgew0KCQkvLyBDcmVhdGUgc29tZSBkZWZhdWx0cywgZXh0ZW5kaW5nIHRoZW0gd2l0aCBhbnkgb3B0aW9ucyB0aGF0IHdlcmUgcHJvdmlkZWQNCgkJb3B0aW9ucyA9ICQuZXh0ZW5kKHsNCgkJCS8vbmF2aWdhdGlvbg0KCQkJJ21lbnUnOiBmYWxzZSwNCgkJCSdhbmNob3JzJzpbXSwNCgkJCSduYXZpZ2F0aW9uJzogZmFsc2UsDQoJCQknbmF2aWdhdGlvblBvc2l0aW9uJzogJ3JpZ2h0JywNCgkJCSduYXZpZ2F0aW9uQ29sb3InOiAnIzAwMCcsDQoJCQknbmF2aWdhdGlvblRvb2x0aXBzJzogW10sDQoJCQknc2xpZGVzTmF2aWdhdGlvbic6IGZhbHNlLA0KCQkJJ3NsaWRlc05hdlBvc2l0aW9uJzogJ2JvdHRvbScsDQoNCgkJCS8vc2Nyb2xsaW5nDQoJCQknY3NzMyc6IGZhbHNlLA0KCQkJJ3Njcm9sbGluZ1NwZWVkJzogNzAwLA0KCQkJJ2F1dG9TY3JvbGxpbmcnOiB0cnVlLA0KCQkJJ2Vhc2luZyc6ICdlYXNlSW5RdWFydCcsDQoJCQknZWFzaW5nY3NzMyc6ICdlYXNlJywNCgkJCSdsb29wQm90dG9tJzogZmFsc2UsDQoJCQknbG9vcFRvcCc6IGZhbHNlLA0KCQkJJ2xvb3BIb3Jpem9udGFsJzogdHJ1ZSwNCgkJCSdjb250aW51b3VzVmVydGljYWwnOiBmYWxzZSwNCgkJCSdmaXRTZWN0aW9uJzogZmFsc2UsDQoJCQknbm9ybWFsU2Nyb2xsRWxlbWVudHMnOiBudWxsLA0KCQkJJ3Njcm9sbE92ZXJmbG93JzogZmFsc2UsDQoJCQkndG91Y2hTZW5zaXRpdml0eSc6IDUsDQoJCQknbm9ybWFsU2Nyb2xsRWxlbWVudFRvdWNoVGhyZXNob2xkJzogNSwNCg0KCQkJLy9BY2Nlc3NpYmlsaXR5DQoJCQkna2V5Ym9hcmRTY3JvbGxpbmcnOiB0cnVlLA0KCQkJJ2FuaW1hdGVBbmNob3InOiB0cnVlLA0KDQoJCQkvL2Rlc2lnbg0KCQkJJ2NvbnRyb2xBcnJvd0NvbG9yJzogJyNmZmYnLA0KCQkJInZlcnRpY2FsQ2VudGVyZWQiOiB0cnVlLA0KCQkJJ3Jlc2l6ZSc6IHRydWUsDQoJCQknc2VjdGlvbnNDb2xvcicgOiBbXSwNCgkJCSdwYWRkaW5nVG9wJzogMCwNCgkJCSdwYWRkaW5nQm90dG9tJzogMCwNCgkJCSdmaXhlZEVsZW1lbnRzJzogbnVsbCwNCgkJCSdyZXNwb25zaXZlJzogMCwNCg0KCQkJLy9DdXN0b20gc2VsZWN0b3JzDQoJCQknc2VjdGlvblNlbGVjdG9yJzogJy5zZWN0aW9uJywNCgkJCSdzbGlkZVNlbGVjdG9yJzogJy5zbGlkZScsDQoNCg0KCQkJLy9ldmVudHMNCgkJCSdhZnRlckxvYWQnOiBudWxsLA0KCQkJJ29uTGVhdmUnOiBudWxsLA0KCQkJJ2FmdGVyUmVuZGVyJzogbnVsbCwNCgkJCSdhZnRlclJlc2l6ZSc6IG51bGwsDQoJCQknYWZ0ZXJSZUJ1aWxkJzogbnVsbCwNCgkJCSdhZnRlclNsaWRlTG9hZCc6IG51bGwsDQoJCQknb25TbGlkZUxlYXZlJzogbnVsbA0KCQl9LCBvcHRpb25zKTsNCg0KCSAgICAvLyBEaXNhYmxlIG11dHVhbGx5IGV4Y2x1c2l2ZSBzZXR0aW5ncw0KCQlpZiAob3B0aW9ucy5jb250aW51b3VzVmVydGljYWwgJiYNCgkJCShvcHRpb25zLmxvb3BUb3AgfHwgb3B0aW9ucy5sb29wQm90dG9tKSkgew0KCQkgICAgb3B0aW9ucy5jb250aW51b3VzVmVydGljYWwgPSBmYWxzZTsNCgkJICAgIGNvbnNvbGUgJiYgY29uc29sZS5sb2cgJiYgY29uc29sZS5sb2coIk9wdGlvbiBsb29wVG9wL2xvb3BCb3R0b20gaXMgbXV0dWFsbHkgZXhjbHVzaXZlIHdpdGggY29udGludW91c1ZlcnRpY2FsOyBjb250aW51b3VzVmVydGljYWwgZGlzYWJsZWQiKTsNCgkJfQ0KDQoJCS8vRGVmaW5lcyB0aGUgZGVsYXkgdG8gdGFrZSBwbGFjZSBiZWZvcmUgYmVpbmcgYWJsZSB0byBzY3JvbGwgdG8gdGhlIG5leHQgc2VjdGlvbg0KCQkvL0JFIENBUkVGVUwhIE5vdCByZWNvbW1lbmVkIHRvIGNoYW5nZSBpdCB1bmRlciA0MDAgZm9yIGEgZ29vZCBiZWhhdmlvciBpbiBsYXB0b3BzIGFuZA0KCQkvL0FwcGxlIGRldmljZXMgKGxhcHRvcHMsIG1vdXNlcy4uLikNCgkJdmFyIHNjcm9sbERlbGF5ID0gNjAwOw0KDQoJCSQuZm4uZnVsbHBhZ2Uuc2V0QXV0b1Njcm9sbGluZyA9IGZ1bmN0aW9uKHZhbHVlKXsNCgkJCW9wdGlvbnMuYXV0b1Njcm9sbGluZyA9IHZhbHVlOw0KDQoJCQl2YXIgZWxlbWVudCA9ICQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpOw0KDQoJCQlpZihvcHRpb25zLmF1dG9TY3JvbGxpbmcpew0KCQkJCSQoJ2h0bWwsIGJvZHknKS5jc3Moew0KCQkJCQknb3ZlcmZsb3cnIDogJ2hpZGRlbicsDQoJCQkJCSdoZWlnaHQnIDogJzEwMCUnDQoJCQkJfSk7DQoNCgkJCQkvL2ZvciBJRSB0b3VjaCBkZXZpY2VzDQoJCQkJY29udGFpbmVyLmNzcyh7DQoJCQkJCSctbXMtdG91Y2gtYWN0aW9uJzogJ25vbmUnLA0KCQkJCQkndG91Y2gtYWN0aW9uJzogJ25vbmUnDQoJCQkJfSk7DQoNCgkJCQlpZihlbGVtZW50Lmxlbmd0aCl7DQoJCQkJCS8vbW92aW5nIHRoZSBjb250YWluZXIgdXANCgkJCQkJc2lsZW50U2Nyb2xsKGVsZW1lbnQucG9zaXRpb24oKS50b3ApOw0KCQkJCX0NCg0KCQkJfWVsc2V7DQoJCQkJJCgnaHRtbCwgYm9keScpLmNzcyh7DQoJCQkJCSdvdmVyZmxvdycgOiAndmlzaWJsZScsDQoJCQkJCSdoZWlnaHQnIDogJ2luaXRpYWwnDQoJCQkJfSk7DQoNCgkJCQkvL2ZvciBJRSB0b3VjaCBkZXZpY2VzDQoJCQkJY29udGFpbmVyLmNzcyh7DQoJCQkJCSctbXMtdG91Y2gtYWN0aW9uJzogJycsDQoJCQkJCSd0b3VjaC1hY3Rpb24nOiAnJw0KCQkJCX0pOw0KDQoJCQkJc2lsZW50U2Nyb2xsKDApOw0KDQoJCQkJLy9zY3JvbGxpbmcgdGhlIHBhZ2UgdG8gdGhlIHNlY3Rpb24gd2l0aCBubyBhbmltYXRpb24NCgkJCQkkKCdodG1sLCBib2R5Jykuc2Nyb2xsVG9wKGVsZW1lbnQucG9zaXRpb24oKS50b3ApOw0KCQkJfQ0KDQoJCX07DQoNCgkJLyoqDQoJCSogRGVmaW5lcyB0aGUgc2Nyb2xsaW5nIHNwZWVkDQoJCSovDQoJCSQuZm4uZnVsbHBhZ2Uuc2V0U2Nyb2xsaW5nU3BlZWQgPSBmdW5jdGlvbih2YWx1ZSl7DQoJCSAgIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQgPSB2YWx1ZTsNCgkJfTsNCg0KCQkvKioNCgkJKiBBZGRzIG9yIHJlbW92ZSB0aGUgcG9zc2libGl0eSBvZiBzY3JvbGxpbmcgdGhyb3VnaCBzZWN0aW9ucyBieSB1c2luZyB0aGUgbW91c2Ugd2hlZWwgb3IgdGhlIHRyYWNrcGFkLg0KCQkqLw0KCQkkLmZuLmZ1bGxwYWdlLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcgPSBmdW5jdGlvbiAodmFsdWUpew0KCQkJaWYodmFsdWUpew0KCQkJCWFkZE1vdXNlV2hlZWxIYW5kbGVyKCk7DQoJCQl9ZWxzZXsNCgkJCQlyZW1vdmVNb3VzZVdoZWVsSGFuZGxlcigpOw0KCQkJfQ0KCQl9Ow0KDQoJCS8qKg0KCQkqIEFkZHMgb3IgcmVtb3ZlIHRoZSBwb3NzaWJsaXR5IG9mIHNjcm9sbGluZyB0aHJvdWdoIHNlY3Rpb25zIGJ5IHVzaW5nIHRoZSBtb3VzZSB3aGVlbC90cmFja3BhZCBvciB0b3VjaCBnZXN0dXJlcy4NCgkJKi8NCgkJJC5mbi5mdWxscGFnZS5zZXRBbGxvd1Njcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQoJCQlpZih2YWx1ZSl7DQoJCQkJJC5mbi5mdWxscGFnZS5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nKHRydWUpOw0KCQkJCWFkZFRvdWNoSGFuZGxlcigpOw0KCQkJfWVsc2V7DQoJCQkJJC5mbi5mdWxscGFnZS5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nKGZhbHNlKTsNCgkJCQlyZW1vdmVUb3VjaEhhbmRsZXIoKTsNCgkJCX0NCgkJfTsNCg0KCQkvKioNCgkJKiBBZGRzIG9yIHJlbW92ZSB0aGUgcG9zc2libGl0eSBvZiBzY3JvbGxpbmcgdGhyb3VnaCBzZWN0aW9ucyBieSB1c2luZyB0aGUga2V5Ym9hcmQgYXJyb3cga2V5cw0KCQkqLw0KCQkkLmZuLmZ1bGxwYWdlLnNldEtleWJvYXJkU2Nyb2xsaW5nID0gZnVuY3Rpb24gKHZhbHVlKXsNCgkJCW9wdGlvbnMua2V5Ym9hcmRTY3JvbGxpbmcgPSB2YWx1ZTsNCgkJfTsNCg0KCQkkLmZuLmZ1bGxwYWdlLm1vdmVTZWN0aW9uVXAgPSBmdW5jdGlvbigpew0KCQkJdmFyIHByZXYgPSAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5wcmV2KCcuZnAtc2VjdGlvbicpOw0KDQoJCQkvL2xvb3BpbmcgdG8gdGhlIGJvdHRvbSBpZiB0aGVyZSdzIG5vIG1vcmUgc2VjdGlvbnMgYWJvdmUNCgkJCWlmICghcHJldi5sZW5ndGggJiYgKG9wdGlvbnMubG9vcFRvcCB8fCBvcHRpb25zLmNvbnRpbnVvdXNWZXJ0aWNhbCkpIHsNCgkJCQlwcmV2ID0gJCgnLmZwLXNlY3Rpb24nKS5sYXN0KCk7DQoJCQl9DQoNCgkJCWlmIChwcmV2Lmxlbmd0aCkgew0KCQkJCXNjcm9sbFBhZ2UocHJldiwgbnVsbCwgdHJ1ZSk7DQoJCQl9DQoJCX07DQoNCgkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvbkRvd24gPSBmdW5jdGlvbiAoKXsNCgkJCXZhciBuZXh0ID0gJCgnLmZwLXNlY3Rpb24uYWN0aXZlJykubmV4dCgnLmZwLXNlY3Rpb24nKTsNCg0KCQkJLy9sb29waW5nIHRvIHRoZSB0b3AgaWYgdGhlcmUncyBubyBtb3JlIHNlY3Rpb25zIGJlbG93DQoJCQlpZighbmV4dC5sZW5ndGggJiYNCgkJCQkob3B0aW9ucy5sb29wQm90dG9tIHx8IG9wdGlvbnMuY29udGludW91c1ZlcnRpY2FsKSl7DQoJCQkJbmV4dCA9ICQoJy5mcC1zZWN0aW9uJykuZmlyc3QoKTsNCgkJCX0NCg0KCQkJaWYobmV4dC5sZW5ndGgpew0KCQkJCXNjcm9sbFBhZ2UobmV4dCwgbnVsbCwgZmFsc2UpOw0KCQkJfQ0KCQl9Ow0KDQoJCSQuZm4uZnVsbHBhZ2UubW92ZVRvID0gZnVuY3Rpb24gKHNlY3Rpb24sIHNsaWRlKXsNCgkJCXZhciBkZXN0aW55ID0gJyc7DQoNCgkJCWlmKGlzTmFOKHNlY3Rpb24pKXsNCgkJCQlkZXN0aW55ID0gJCgnW2RhdGEtYW5jaG9yPSInK3NlY3Rpb24rJyJdJyk7DQoJCQl9ZWxzZXsNCgkJCQlkZXN0aW55ID0gJCgnLmZwLXNlY3Rpb24nKS5lcSggKHNlY3Rpb24gLTEpICk7DQoJCQl9DQoNCgkJCWlmICh0eXBlb2Ygc2xpZGUgIT09ICd1bmRlZmluZWQnKXsNCgkJCQlzY3JvbGxQYWdlQW5kU2xpZGUoc2VjdGlvbiwgc2xpZGUpOw0KCQkJfWVsc2UgaWYoZGVzdGlueS5sZW5ndGggPiAwKXsNCgkJCQlzY3JvbGxQYWdlKGRlc3RpbnkpOw0KCQkJfQ0KCQl9Ow0KDQoJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlUmlnaHQgPSBmdW5jdGlvbigpew0KCQkJbW92ZVNsaWRlKCduZXh0Jyk7DQoJCX07DQoNCgkJJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVMZWZ0ID0gZnVuY3Rpb24oKXsNCgkJCW1vdmVTbGlkZSgncHJldicpOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBXaGVuIHJlc2l6aW5nIGlzIGZpbmlzaGVkLCB3ZSBhZGp1c3QgdGhlIHNsaWRlcyBzaXplcyBhbmQgcG9zaXRpb25zDQoJCSAqLw0KCQkkLmZuLmZ1bGxwYWdlLnJlQnVpbGQgPSBmdW5jdGlvbihyZXNpemluZyl7DQoJCQlpc1Jlc2l6aW5nID0gdHJ1ZTsNCg0KCQkJdmFyIHdpbmRvd3NXaWR0aCA9ICQod2luZG93KS53aWR0aCgpOw0KCQkJd2luZG93c0hlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKTsNCg0KCQkJLy90ZXh0IGFuZCBpbWFnZXMgcmVzaXppbmcNCgkJCWlmIChvcHRpb25zLnJlc2l6ZSkgew0KCQkJCXJlc2l6ZU1lKHdpbmRvd3NIZWlnaHQsIHdpbmRvd3NXaWR0aCk7DQoJCQl9DQoNCgkJCSQoJy5mcC1zZWN0aW9uJykuZWFjaChmdW5jdGlvbigpew0KCQkJCXZhciBzY3JvbGxIZWlnaHQgPSB3aW5kb3dzSGVpZ2h0IC0gcGFyc2VJbnQoJCh0aGlzKS5jc3MoJ3BhZGRpbmctYm90dG9tJykpIC0gcGFyc2VJbnQoJCh0aGlzKS5jc3MoJ3BhZGRpbmctdG9wJykpOw0KDQoJCQkJLy9hZGp1c3RpbmcgdGhlIGhlaWdodCBvZiB0aGUgdGFibGUtY2VsbCBmb3IgSUUgYW5kIEZpcmVmb3gNCgkJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCQkkKHRoaXMpLmZpbmQoJy5mcC10YWJsZUNlbGwnKS5jc3MoJ2hlaWdodCcsIGdldFRhYmxlSGVpZ2h0KCQodGhpcykpICsgJ3B4Jyk7DQoJCQkJfQ0KDQoJCQkJJCh0aGlzKS5jc3MoJ2hlaWdodCcsIHdpbmRvd3NIZWlnaHQgKyAncHgnKTsNCg0KCQkJCS8vcmVzaXppbmcgdGhlIHNjcm9sbGluZyBkaXZzDQoJCQkJaWYob3B0aW9ucy5zY3JvbGxPdmVyZmxvdyl7DQoJCQkJCXZhciBzbGlkZXMgPSAkKHRoaXMpLmZpbmQoJy5mcC1zbGlkZScpOw0KDQoJCQkJCWlmKHNsaWRlcy5sZW5ndGgpew0KCQkJCQkJc2xpZGVzLmVhY2goZnVuY3Rpb24oKXsNCgkJCQkJCQljcmVhdGVTbGltU2Nyb2xsaW5nKCQodGhpcykpOw0KCQkJCQkJfSk7DQoJCQkJCX1lbHNlew0KCQkJCQkJY3JlYXRlU2xpbVNjcm9sbGluZygkKHRoaXMpKTsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCS8vYWRqdXN0aW5nIHRoZSBwb3NpdGlvbiBmbyB0aGUgRlVMTCBXSURUSCBzbGlkZXMuLi4NCgkJCQl2YXIgc2xpZGVzID0gJCh0aGlzKS5maW5kKCcuZnAtc2xpZGVzJyk7DQoJCQkJaWYgKHNsaWRlcy5sZW5ndGgpIHsNCgkJCQkJbGFuZHNjYXBlU2Nyb2xsKHNsaWRlcywgc2xpZGVzLmZpbmQoJy5mcC1zbGlkZS5hY3RpdmUnKSk7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCS8vYWRqdXN0aW5nIHRoZSBwb3NpdGlvbiBmb3IgdGhlIGN1cnJlbnQgc2VjdGlvbg0KCQkJdmFyIGRlc3RpbnlQb3MgPSAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5wb3NpdGlvbigpOw0KDQoJCQl2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpOw0KDQoJCQkvL2lzbid0IGl0IHRoZSBmaXJzdCBzZWN0aW9uPw0KCQkJaWYoYWN0aXZlU2VjdGlvbi5pbmRleCgnLmZwLXNlY3Rpb24nKSl7DQoJCQkJc2Nyb2xsUGFnZShhY3RpdmVTZWN0aW9uKTsNCgkJCX0NCg0KCQkJaXNSZXNpemluZyA9IGZhbHNlOw0KCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyUmVzaXplICkgJiYgcmVzaXppbmcgJiYgb3B0aW9ucy5hZnRlclJlc2l6ZS5jYWxsKCB0aGlzICkNCgkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlclJlQnVpbGQgKSAmJiAhcmVzaXppbmcgJiYgb3B0aW9ucy5hZnRlclJlQnVpbGQuY2FsbCggdGhpcyApOw0KCQl9DQoNCgkJLy9mbGFnIHRvIGF2b2lkIHZlcnkgZmFzdCBzbGlkaW5nIGZvciBsYW5kc2NhcGUgc2xpZGVycw0KCQl2YXIgc2xpZGVNb3ZpbmcgPSBmYWxzZTsNCg0KCQl2YXIgaXNUb3VjaERldmljZSA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLyhpUGhvbmV8aVBvZHxpUGFkfEFuZHJvaWR8QmxhY2tCZXJyeXxCQjEwfFdpbmRvd3MgUGhvbmV8VGl6ZW58QmFkYSkvKTsNCgkJdmFyIGlzVG91Y2ggPSAoKCdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdykgfHwgKG5hdmlnYXRvci5tc01heFRvdWNoUG9pbnRzID4gMCkpOw0KCQl2YXIgY29udGFpbmVyID0gJCh0aGlzKTsNCgkJdmFyIHdpbmRvd3NIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7DQoJCXZhciBpc01vdmluZyA9IGZhbHNlOw0KCQl2YXIgaXNSZXNpemluZyA9IGZhbHNlOw0KCQl2YXIgbGFzdFNjcm9sbGVkRGVzdGlueTsNCgkJdmFyIGxhc3RTY3JvbGxlZFNsaWRlOw0KCQl2YXIgbmF2Ow0KCQl2YXIgd3JhcHBlclNlbGVjdG9yID0gJ2Z1bGxwYWdlLXdyYXBwZXInOw0KDQoJCSQuZm4uZnVsbHBhZ2Uuc2V0QWxsb3dTY3JvbGxpbmcodHJ1ZSk7DQoNCgkJLy9pZiBjc3MzIGlzIG5vdCBzdXBwb3J0ZWQsIGl0IHdpbGwgdXNlIGpRdWVyeSBhbmltYXRpb25zDQoJCWlmKG9wdGlvbnMuY3NzMyl7DQoJCQlvcHRpb25zLmNzczMgPSBzdXBwb3J0M2QoKTsNCgkJfQ0KDQoJCWlmKCQodGhpcykubGVuZ3RoKXsNCgkJCWNvbnRhaW5lci5jc3Moew0KCQkJCSdoZWlnaHQnOiAnMTAwJScsDQoJCQkJJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJw0KCQkJfSk7DQoNCgkJCS8vYWRkaW5nIGEgY2xhc3MgdG8gcmVjb2duaXplIHRoZSBjb250YWluZXIgaW50ZXJuYWxseSBpbiB0aGUgY29kZQ0KCQkJY29udGFpbmVyLmFkZENsYXNzKHdyYXBwZXJTZWxlY3Rvcik7DQoJCX0NCg0KCQkvL3RyeWluZyB0byB1c2UgZnVsbHBhZ2Ugd2l0aG91dCBhIHNlbGVjdG9yPw0KCQllbHNlew0KCQkJY29uc29sZS5lcnJvcigiRXJyb3IhIEZ1bGxwYWdlLmpzIG5lZWRzIHRvIGJlIGluaXRpYWxpemVkIHdpdGggYSBzZWxlY3Rvci4gRm9yIGV4YW1wbGU6ICQoJyNteUNvbnRhaW5lcicpLmZ1bGxwYWdlKCk7Iik7DQoJCX0NCg0KCQkvL2FkZGluZyBpbnRlcm5hbCBjbGFzcyBuYW1lcyB0byB2b2lkIHByb2JsZW0gd2l0aCBjb21tb24gb25lcw0KCQkkKG9wdGlvbnMuc2VjdGlvblNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uKCl7DQogIAkJCSQodGhpcykuYWRkQ2xhc3MoJ2ZwLXNlY3Rpb24nKTsNCgkJfSk7DQoJCSQob3B0aW9ucy5zbGlkZVNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uKCl7DQogIAkJCSQodGhpcykuYWRkQ2xhc3MoJ2ZwLXNsaWRlJyk7DQoJCX0pOw0KDQoJCS8vY3JlYXRpbmcgdGhlIG5hdmlnYXRpb24gZG90cw0KCQlpZiAob3B0aW9ucy5uYXZpZ2F0aW9uKSB7DQoJCQlhZGRWZXJ0aWNhbE5hdmlnYXRpb24oKTsNCgkJfQ0KDQoJCSQoJy5mcC1zZWN0aW9uJykuZWFjaChmdW5jdGlvbihpbmRleCl7DQoJCQl2YXIgdGhhdCA9ICQodGhpcyk7DQoJCQl2YXIgc2xpZGVzID0gJCh0aGlzKS5maW5kKCcuZnAtc2xpZGUnKTsNCgkJCXZhciBudW1TbGlkZXMgPSBzbGlkZXMubGVuZ3RoOw0KDQoJCQkvL2lmIG5vIGFjdGl2ZSBzZWN0aW9uIGlzIGRlZmluZWQsIHRoZSAxc3Qgb25lIHdpbGwgYmUgdGhlIGRlZmF1bHQgb25lDQoJCQlpZighaW5kZXggJiYgJCgnLmZwLXNlY3Rpb24uYWN0aXZlJykubGVuZ3RoID09PSAwKSB7DQoJCQkJJCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQl9DQoNCgkJCSQodGhpcykuY3NzKCdoZWlnaHQnLCB3aW5kb3dzSGVpZ2h0ICsgJ3B4Jyk7DQoNCgkJCWlmKG9wdGlvbnMucGFkZGluZ1RvcCB8fCBvcHRpb25zLnBhZGRpbmdCb3R0b20pew0KCQkJCSQodGhpcykuY3NzKCdwYWRkaW5nJywgb3B0aW9ucy5wYWRkaW5nVG9wICArICcgMCAnICsgb3B0aW9ucy5wYWRkaW5nQm90dG9tICsgJyAwJyk7DQoJCQl9DQoNCgkJCWlmICh0eXBlb2Ygb3B0aW9ucy5zZWN0aW9uc0NvbG9yW2luZGV4XSAhPT0gICd1bmRlZmluZWQnKSB7DQoJCQkJJCh0aGlzKS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBvcHRpb25zLnNlY3Rpb25zQ29sb3JbaW5kZXhdKTsNCgkJCX0NCg0KCQkJaWYgKHR5cGVvZiBvcHRpb25zLmFuY2hvcnNbaW5kZXhdICE9PSAndW5kZWZpbmVkJykgew0KCQkJCSQodGhpcykuYXR0cignZGF0YS1hbmNob3InLCBvcHRpb25zLmFuY2hvcnNbaW5kZXhdKTsNCgkJCX0NCg0KCQkJLy8gaWYgdGhlcmUncyBhbnkgc2xpZGUNCgkJCWlmIChudW1TbGlkZXMgPiAxKSB7DQoJCQkJdmFyIHNsaWRlcldpZHRoID0gbnVtU2xpZGVzICogMTAwOw0KCQkJCXZhciBzbGlkZVdpZHRoID0gMTAwIC8gbnVtU2xpZGVzOw0KDQoJCQkJc2xpZGVzLndyYXBBbGwoJzxkaXYgY2xhc3M9ImZwLXNsaWRlc0NvbnRhaW5lciIgLz4nKTsNCgkJCQlzbGlkZXMucGFyZW50KCkud3JhcCgnPGRpdiBjbGFzcz0iZnAtc2xpZGVzIiAvPicpOw0KDQoJCQkJJCh0aGlzKS5maW5kKCcuZnAtc2xpZGVzQ29udGFpbmVyJykuY3NzKCd3aWR0aCcsIHNsaWRlcldpZHRoICsgJyUnKTsNCgkJCQkkKHRoaXMpLmZpbmQoJy5mcC1zbGlkZXMnKS5hZnRlcignPGRpdiBjbGFzcz0iZnAtY29udHJvbEFycm93IGZwLXByZXYiPjwvZGl2PjxkaXYgY2xhc3M9ImZwLWNvbnRyb2xBcnJvdyBmcC1uZXh0Ij48L2Rpdj4nKTsNCg0KCQkJCWlmKG9wdGlvbnMuY29udHJvbEFycm93Q29sb3IhPScjZmZmJyl7DQoJCQkJCSQodGhpcykuZmluZCgnLmZwLWNvbnRyb2xBcnJvdy5mcC1uZXh0JykuY3NzKCdib3JkZXItY29sb3InLCAndHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgJytvcHRpb25zLmNvbnRyb2xBcnJvd0NvbG9yKTsNCgkJCQkJJCh0aGlzKS5maW5kKCcuZnAtY29udHJvbEFycm93LmZwLXByZXYnKS5jc3MoJ2JvcmRlci1jb2xvcicsICd0cmFuc3BhcmVudCAnKyBvcHRpb25zLmNvbnRyb2xBcnJvd0NvbG9yICsgJyB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCcpOw0KCQkJCX0NCg0KCQkJCWlmKCFvcHRpb25zLmxvb3BIb3Jpem9udGFsKXsNCgkJCQkJJCh0aGlzKS5maW5kKCcuZnAtY29udHJvbEFycm93LmZwLXByZXYnKS5oaWRlKCk7DQoJCQkJfQ0KDQoNCgkJCQlpZihvcHRpb25zLnNsaWRlc05hdmlnYXRpb24pew0KCQkJCQlhZGRTbGlkZXNOYXZpZ2F0aW9uKCQodGhpcyksIG51bVNsaWRlcyk7DQoJCQkJfQ0KDQoJCQkJc2xpZGVzLmVhY2goZnVuY3Rpb24oaW5kZXgpIHsNCgkJCQkJJCh0aGlzKS5jc3MoJ3dpZHRoJywgc2xpZGVXaWR0aCArICclJyk7DQoNCgkJCQkJaWYob3B0aW9ucy52ZXJ0aWNhbENlbnRlcmVkKXsNCgkJCQkJCWFkZFRhYmxlQ2xhc3MoJCh0aGlzKSk7DQoJCQkJCX0NCgkJCQl9KTsNCg0KCQkJCXZhciBzdGFydGluZ1NsaWRlID0gdGhhdC5maW5kKCcuZnAtc2xpZGUuYWN0aXZlJyk7DQoNCgkJCQkvL2lmIHRoZSBzbGlkZSB3b24jdCBiZSBhbiBzdGFydGluZyBwb2ludCwgdGhlIGRlZmF1bHQgd2lsbCBiZSB0aGUgZmlyc3Qgb25lDQoJCQkJaWYoc3RhcnRpbmdTbGlkZS5sZW5ndGggPT0gMCl7DQoJCQkJCXNsaWRlcy5lcSgwKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQkJfQ0KDQoJCQkJLy9pcyB0aGVyZSBhIHN0YXJ0aW5nIHBvaW50IGZvciBhIG5vbi1zdGFydGluZyBzZWN0aW9uPw0KCQkJCWVsc2V7DQoJCQkJCXNpbGVudExhbmRzY2FwZVNjcm9sbChzdGFydGluZ1NsaWRlKTsNCgkJCQl9DQoNCgkJCX1lbHNlew0KCQkJCWlmKG9wdGlvbnMudmVydGljYWxDZW50ZXJlZCl7DQoJCQkJCWFkZFRhYmxlQ2xhc3MoJCh0aGlzKSk7DQoJCQkJfQ0KCQkJfQ0KDQoJCX0pLnByb21pc2UoKS5kb25lKGZ1bmN0aW9uKCl7DQoJCQkkLmZuLmZ1bGxwYWdlLnNldEF1dG9TY3JvbGxpbmcob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKTsNCg0KCQkJLy90aGUgc3RhcnRpbmcgcG9pbnQgaXMgYSBzbGlkZT8NCgkJCXZhciBhY3RpdmVTbGlkZSA9ICQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLmZpbmQoJy5mcC1zbGlkZS5hY3RpdmUnKTsNCg0KCQkJLy90aGUgYWN0aXZlIHNlY3Rpb24gaXNuJ3QgdGhlIGZpcnN0IG9uZT8gSXMgbm90IHRoZSBmaXJzdCBzbGlkZSBvZiB0aGUgZmlyc3Qgc2VjdGlvbj8gVGhlbiB3ZSBsb2FkIHRoYXQgc2VjdGlvbi9zbGlkZSBieSBkZWZhdWx0Lg0KCQkJaWYoIGFjdGl2ZVNsaWRlLmxlbmd0aCAmJiAgKCQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcuZnAtc2VjdGlvbicpICE9IDAgfHwgKCQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcuZnAtc2VjdGlvbicpID09IDAgJiYgYWN0aXZlU2xpZGUuaW5kZXgoKSAhPSAwKSkpew0KCQkJCXNpbGVudExhbmRzY2FwZVNjcm9sbChhY3RpdmVTbGlkZSk7DQoJCQl9DQoNCgkJCS8vZml4ZWQgZWxlbWVudHMgbmVlZCB0byBiZSBtb3ZlZCBvdXQgb2YgdGhlIHBsdWdpbiBjb250YWluZXIgZHVlIHRvIHByb2JsZW1zIHdpdGggQ1NTMy4NCgkJCWlmKG9wdGlvbnMuZml4ZWRFbGVtZW50cyAmJiBvcHRpb25zLmNzczMpew0KCQkJCSQob3B0aW9ucy5maXhlZEVsZW1lbnRzKS5hcHBlbmRUbygnYm9keScpOw0KCQkJfQ0KDQoJCQkvL3ZlcnRpY2FsIGNlbnRlcmVkIG9mIHRoZSBuYXZpZ2F0aW9uICsgZmlyc3QgYnVsbGV0IGFjdGl2ZQ0KCQkJaWYob3B0aW9ucy5uYXZpZ2F0aW9uKXsNCgkJCQluYXYuY3NzKCdtYXJnaW4tdG9wJywgJy0nICsgKG5hdi5oZWlnaHQoKS8yKSArICdweCcpOw0KCQkJCW5hdi5maW5kKCdsaScpLmVxKCQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcuZnAtc2VjdGlvbicpKS5maW5kKCdhJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJfQ0KDQoJCQkvL21vdmluZyB0aGUgbWVudSBvdXRzaWRlIHRoZSBtYWluIGNvbnRhaW5lciBpZiBpdCBpcyBpbnNpZGUgKGF2b2lkIHByb2JsZW1zIHdpdGggZml4ZWQgcG9zaXRpb25zIHdoZW4gdXNpbmcgQ1NTMyB0cmFuZm9ybXMpDQoJCQlpZihvcHRpb25zLm1lbnUgJiYgb3B0aW9ucy5jc3MzICYmICQob3B0aW9ucy5tZW51KS5jbG9zZXN0KCcuZnVsbHBhZ2Utd3JhcHBlcicpLmxlbmd0aCl7DQoJCQkJJChvcHRpb25zLm1lbnUpLmFwcGVuZFRvKCdib2R5Jyk7DQoJCQl9DQoNCgkJCWlmKG9wdGlvbnMuc2Nyb2xsT3ZlcmZsb3cpew0KCQkJCWlmKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIpew0KCQkJCQljcmVhdGVTbGltU2Nyb2xsaW5nSGFuZGxlcigpOw0KCQkJCX0NCgkJCQkvL2FmdGVyIERPTSBhbmQgaW1hZ2VzIGFyZSBsb2FkZWQNCgkJCQkkKHdpbmRvdykub24oJ2xvYWQnLCBjcmVhdGVTbGltU2Nyb2xsaW5nSGFuZGxlcik7DQoJCQl9ZWxzZXsNCgkJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJSZW5kZXIgKSAmJiBvcHRpb25zLmFmdGVyUmVuZGVyLmNhbGwoIHRoaXMpOw0KCQkJfQ0KDQoJCQlyZXNwb25zaXZlKCk7DQoNCgkJCS8vZ2V0dGluZyB0aGUgYW5jaG9yIGxpbmsgaW4gdGhlIFVSTCBhbmQgZGVsZXRpbmcgdGhlIGAjYA0KCQkJdmFyIHZhbHVlID0gIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCAnJykuc3BsaXQoJy8nKTsNCgkJCXZhciBkZXN0aW55ID0gdmFsdWVbMF07DQoNCgkJCWlmKGRlc3RpbnkubGVuZ3RoKXsNCgkJCQl2YXIgc2VjdGlvbiA9ICQoJ1tkYXRhLWFuY2hvcj0iJytkZXN0aW55KyciXScpOw0KDQoJCQkJaWYoIW9wdGlvbnMuYW5pbWF0ZUFuY2hvciAmJiBzZWN0aW9uLmxlbmd0aCl7DQoNCgkJCQkJaWYob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCgkJCQkJCXNpbGVudFNjcm9sbChzZWN0aW9uLnBvc2l0aW9uKCkudG9wKTsNCgkJCQkJfQ0KCQkJCQllbHNlew0KCQkJCQkJc2lsZW50U2Nyb2xsKDApOw0KDQoJCQkJCQkvL3Njcm9sbGluZyB0aGUgcGFnZSB0byB0aGUgc2VjdGlvbiB3aXRoIG5vIGFuaW1hdGlvbg0KCQkJCQkJJCgnaHRtbCwgYm9keScpLnNjcm9sbFRvcChzZWN0aW9uLnBvc2l0aW9uKCkudG9wKTsNCgkJCQkJfQ0KDQoJCQkJCWFjdGl2YXRlTWVudUFuZE5hdihkZXN0aW55LCBudWxsKTsNCg0KCQkJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJMb2FkICkgJiYgb3B0aW9ucy5hZnRlckxvYWQuY2FsbCggdGhpcywgZGVzdGlueSwgKHNlY3Rpb24uaW5kZXgoJy5mcC1zZWN0aW9uJykgKyAxKSk7DQoNCgkJCQkJLy91cGRhdGluZyB0aGUgYWN0aXZlIGNsYXNzDQoJCQkJCXNlY3Rpb24uYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCX0NCgkJCX0NCg0KDQoJCQkkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbigpIHsNCgkJCQlzY3JvbGxUb0FuY2hvcigpOw0KCQkJfSk7DQoNCgkJfSk7DQoNCg0KCQkvKioNCgkJKiBDcmVhdGVzIGEgdmVydGljYWwgbmF2aWdhdGlvbiBiYXIuDQoJCSovDQoJCWZ1bmN0aW9uIGFkZFZlcnRpY2FsTmF2aWdhdGlvbigpew0KCQkJJCgnYm9keScpLmFwcGVuZCgnPGRpdiBpZD0iZnAtbmF2Ij48dWw+PC91bD48L2Rpdj4nKTsNCgkJCW5hdiA9ICQoJyNmcC1uYXYnKTsNCg0KCQkJbmF2LmNzcygnY29sb3InLCBvcHRpb25zLm5hdmlnYXRpb25Db2xvcik7DQoJCQluYXYuYWRkQ2xhc3Mob3B0aW9ucy5uYXZpZ2F0aW9uUG9zaXRpb24pOw0KDQoJCQlmb3IodmFyIGNvbnQgPSAwOyBjb250IDwgJCgnLmZwLXNlY3Rpb24nKS5sZW5ndGg7IGNvbnQrKyl7DQoJCQkJdmFyIGxpbmsgPSAnJzsNCgkJCQlpZihvcHRpb25zLmFuY2hvcnMubGVuZ3RoKXsNCgkJCQkJbGluayA9IG9wdGlvbnMuYW5jaG9yc1tjb250XTsNCgkJCQl9DQoJCQkJdmFyIHRvb2x0aXAgPSBvcHRpb25zLm5hdmlnYXRpb25Ub29sdGlwc1tjb250XTsNCgkJCQlpZih0eXBlb2YgdG9vbHRpcCA9PT0gJ3VuZGVmaW5lZCcpew0KCQkJCQl0b29sdGlwID0gJyc7DQoJCQkJfQ0KDQoJCQkJbmF2LmZpbmQoJ3VsJykuYXBwZW5kKCc8bGkgZGF0YS10b29sdGlwPSInICsgdG9vbHRpcCArICciPjxhIGhyZWY9IiMnICsgbGluayArICciPjxzcGFuPjwvc3Bhbj48L2E+PC9saT4nKTsNCgkJCX0NCgkJfQ0KDQoJCWZ1bmN0aW9uIGNyZWF0ZVNsaW1TY3JvbGxpbmdIYW5kbGVyKCl7DQoJCQkkKCcuZnAtc2VjdGlvbicpLmVhY2goZnVuY3Rpb24oKXsNCgkJCQl2YXIgc2xpZGVzID0gJCh0aGlzKS5maW5kKCcuZnAtc2xpZGUnKTsNCg0KCQkJCWlmKHNsaWRlcy5sZW5ndGgpew0KCQkJCQlzbGlkZXMuZWFjaChmdW5jdGlvbigpew0KCQkJCQkJY3JlYXRlU2xpbVNjcm9sbGluZygkKHRoaXMpKTsNCgkJCQkJfSk7DQoJCQkJfWVsc2V7DQoJCQkJCWNyZWF0ZVNsaW1TY3JvbGxpbmcoJCh0aGlzKSk7DQoJCQkJfQ0KDQoJCQl9KTsNCgkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlclJlbmRlciApICYmIG9wdGlvbnMuYWZ0ZXJSZW5kZXIuY2FsbCggdGhpcyk7DQoJCX0NCg0KCQkvL3N0b3AgYXV0b1Njcm9sbGluZyB3aGVuIHRoZSB1c2VyIHNjcm9sbHMNCgkJJCgiaHRtbCwgYm9keSIpLmJpbmQoInNjcm9sbCBtb3VzZWRvd24gRE9NTW91c2VTY3JvbGwgbW91c2V3aGVlbCBrZXl1cCIsIGZ1bmN0aW9uKCl7DQoJCQlpZighb3B0aW9ucy5hdXRvU2Nyb2xsaW5nICYmIG9wdGlvbnMuZml0U2VjdGlvbil7DQoJCSAgICAJJCgnaHRtbCwgYm9keScpLnN0b3AoKTsNCgkJICAgIAlpc01vdmluZyA9IGZhbHNlOw0KCQkgICAgfQ0KCQl9KTsNCg0KCQl2YXIgc2Nyb2xsSWQ7DQoJCXZhciBzY3JvbGxJZDI7DQoJCXZhciBpc1Njcm9sbGluZyA9IGZhbHNlOw0KDQoJCS8vd2hlbiBzY3JvbGxpbmcuLi4NCgkJJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBzY3JvbGxIYW5kbGVyKTsNCg0KCQlmdW5jdGlvbiBzY3JvbGxIYW5kbGVyKCl7DQoJCQlpZighb3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCgkJCQl2YXIgY3VycmVudFNjcm9sbCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTsNCgkJCQl2YXIgdmlzaWJsZVNlY3Rpb25JbmRleCA9IDA7DQoJCQkJdmFyIGluaXRpYWwgPSBNYXRoLmFicyhjdXJyZW50U2Nyb2xsIC0gJCgnLmZwLXNlY3Rpb24nKS5maXJzdCgpLm9mZnNldCgpLnRvcCk7DQoNCgkJCQkvL3Rha2luZyB0aGUgc2VjdGlvbiB3aGljaCBpcyBzaG93aW5nIG1vcmUgY29udGVudCBpbiB0aGUgdmlld3BvcnQNCgkJCQkkKCcuZnAtc2VjdGlvbicpLmVhY2goZnVuY3Rpb24oaW5kZXgpew0KCQkJCQl2YXIgY3VycmVudCA9IE1hdGguYWJzKGN1cnJlbnRTY3JvbGwgLSAkKHRoaXMpLm9mZnNldCgpLnRvcCk7DQoNCgkJCQkJaWYoY3VycmVudCA8IGluaXRpYWwpew0KCQkJCQkJdmlzaWJsZVNlY3Rpb25JbmRleCA9IGluZGV4Ow0KCQkJCQkJaW5pdGlhbCA9IGN1cnJlbnQ7DQoJCQkJCX0NCgkJCQl9KTsNCg0KCQkJCS8vZ2V0aW5nIHRoZSBsYXN0IG9uZSwgdGhlIGN1cnJlbnQgb25lIG9uIHRoZSBzY3JlZW4NCgkJCQl2YXIgY3VycmVudFNlY3Rpb24gPSAkKCcuZnAtc2VjdGlvbicpLmVxKHZpc2libGVTZWN0aW9uSW5kZXgpOw0KDQoJCQkJLy9leGVjdXRpbmcgb25seSBvbmNlIHRoZSBmaXJzdCB0aW1lIHdlIHJlYWNoIHRoZSBzZWN0aW9uDQoJCQkJaWYoIWN1cnJlbnRTZWN0aW9uLmhhc0NsYXNzKCdhY3RpdmUnKSl7DQoJCQkJCWlzU2Nyb2xsaW5nID0gdHJ1ZTsNCg0KCQkJCQl2YXIgbGVhdmluZ1NlY3Rpb24gPSAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLmZwLXNlY3Rpb24nKSArIDE7DQoJCQkJCXZhciB5TW92ZW1lbnQgPSBnZXRZbW92ZW1lbnQoY3VycmVudFNlY3Rpb24pOw0KCQkJCQl2YXIgYW5jaG9yTGluayAgPSBjdXJyZW50U2VjdGlvbi5kYXRhKCdhbmNob3InKTsNCg0KCQkJCQljdXJyZW50U2VjdGlvbi5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoNCgkJCQkJaWYoIWlzTW92aW5nKXsNCgkJCQkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5vbkxlYXZlICkgJiYgb3B0aW9ucy5vbkxlYXZlLmNhbGwoIHRoaXMsIGxlYXZpbmdTZWN0aW9uLCAoY3VycmVudFNlY3Rpb24uaW5kZXgoJy5mcC1zZWN0aW9uJykgKyAxKSwgeU1vdmVtZW50KTsNCg0KCQkJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyTG9hZCApICYmIG9wdGlvbnMuYWZ0ZXJMb2FkLmNhbGwoIHRoaXMsIGFuY2hvckxpbmssIChjdXJyZW50U2VjdGlvbi5pbmRleCgnLmZwLXNlY3Rpb24nKSArIDEpKTsNCgkJCQkJfQ0KDQoJCQkJCWFjdGl2YXRlTWVudUFuZE5hdihhbmNob3JMaW5rLCAwKTsNCg0KCQkJCQlpZihvcHRpb25zLmFuY2hvcnMubGVuZ3RoICYmICFpc01vdmluZyl7DQoJCQkJCQkvL25lZWRlZCB0byBlbnRlciBpbiBoYXNoQ2hhbmdlIGV2ZW50IHdoZW4gdXNpbmcgdGhlIG1lbnUgd2l0aCBhbmNob3IgbGlua3MNCgkJCQkJCWxhc3RTY3JvbGxlZERlc3RpbnkgPSBhbmNob3JMaW5rOw0KDQoJCQkJCQlsb2NhdGlvbi5oYXNoID0gYW5jaG9yTGluazsNCgkJCQkJfQ0KDQoJCQkJCS8vc21hbGwgdGltZW91dCBpbiBvcmRlciB0byBhdm9pZCBlbnRlcmluZyBpbiBoYXNoQ2hhbmdlIGV2ZW50IHdoZW4gc2Nyb2xsaW5nIGlzIG5vdCBmaW5pc2hlZCB5ZXQNCgkJCQkJY2xlYXJUaW1lb3V0KHNjcm9sbElkKTsNCgkJCQkJc2Nyb2xsSWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJCQkJCQlpc1Njcm9sbGluZyA9IGZhbHNlOw0KCQkJCQl9LCAxMDApOw0KCQkJCX0NCg0KCQkJCWlmKG9wdGlvbnMuZml0U2VjdGlvbil7DQoJCQkJCS8vZm9yIHRoZSBhdXRvIGFkanVzdCBvZiB0aGUgdmlld3BvcnQgdG8gZml0IGEgd2hvbGUgc2VjdGlvbg0KCQkJCQljbGVhclRpbWVvdXQoc2Nyb2xsSWQyKTsNCgkJCQkJc2Nyb2xsSWQyID0gc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkJCQkJaWYoIWlzTW92aW5nKXsNCgkJCQkJCQlzY3JvbGxQYWdlKGN1cnJlbnRTZWN0aW9uKTsNCgkJCQkJCX0NCgkJCQkJfSwgMTAwMCk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCg0KCQkvKioNCgkJKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGFjdGl2ZSBzZWN0aW9uIG9yIHNsaWRlIGlzIHNjcm9sbGFibGUgdGhyb3VnaCBhbmQgc2Nyb2xsaW5nIGJhcg0KCQkqLw0KCQlmdW5jdGlvbiBpc1Njcm9sbGFibGUoYWN0aXZlU2VjdGlvbil7DQoJCQkvL2lmIHRoZXJlIGFyZSBsYW5kc2NhcGUgc2xpZGVzLCB3ZSBjaGVjayBpZiB0aGUgc2Nyb2xsaW5nIGJhciBpcyBpbiB0aGUgY3VycmVudCBvbmUgb3Igbm90DQoJCQlpZihhY3RpdmVTZWN0aW9uLmZpbmQoJy5mcC1zbGlkZXMnKS5sZW5ndGgpew0KCQkJCXNjcm9sbGFibGU9IGFjdGl2ZVNlY3Rpb24uZmluZCgnLmZwLXNsaWRlLmFjdGl2ZScpLmZpbmQoJy5mcC1zY3JvbGxhYmxlJyk7DQoJCQl9ZWxzZXsNCgkJCQlzY3JvbGxhYmxlID0gYWN0aXZlU2VjdGlvbi5maW5kKCcuZnAtc2Nyb2xsYWJsZScpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gc2Nyb2xsYWJsZTsNCgkJfQ0KDQoJCS8qKg0KCQkqIERldGVybWluZXMgdGhlIHdheSBvZiBzY3JvbGxpbmcgdXAgb3IgZG93bjoNCgkJKiBieSAnYXV0b21hdGljYWxseScgc2Nyb2xsaW5nIGEgc2VjdGlvbiBvciBieSB1c2luZyB0aGUgZGVmYXVsdCBhbmQgbm9ybWFsIHNjcm9sbGluZy4NCgkJKi8NCgkJZnVuY3Rpb24gc2Nyb2xsaW5nKHR5cGUsIHNjcm9sbGFibGUpew0KCQkJaWYodHlwZSA9PSAnZG93bicpew0KCQkJCXZhciBjaGVjayA9ICdib3R0b20nOw0KCQkJCXZhciBzY3JvbGxTZWN0aW9uID0gJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvbkRvd247DQoJCQl9ZWxzZXsNCgkJCQl2YXIgY2hlY2sgPSAndG9wJzsNCgkJCQl2YXIgc2Nyb2xsU2VjdGlvbiA9ICQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25VcDsNCgkJCX0NCg0KCQkJaWYoc2Nyb2xsYWJsZS5sZW5ndGggPiAwICl7DQoJCQkJLy9pcyB0aGUgc2Nyb2xsYmFyIGF0IHRoZSBzdGFydC9lbmQgb2YgdGhlIHNjcm9sbD8NCgkJCQlpZihpc1Njcm9sbGVkKGNoZWNrLCBzY3JvbGxhYmxlKSl7DQoJCQkJCXNjcm9sbFNlY3Rpb24oKTsNCgkJCQl9ZWxzZXsNCgkJCQkJcmV0dXJuIHRydWU7DQoJCQkJfQ0KCQkJfWVsc2V7DQoJCQkJLy8gbW92ZWQgdXAvZG93bg0KCQkJCXNjcm9sbFNlY3Rpb24oKTsNCgkJCX0NCgkJfQ0KDQoNCgkJdmFyIHRvdWNoU3RhcnRZID0gMDsNCgkJdmFyIHRvdWNoU3RhcnRYID0gMDsNCgkJdmFyIHRvdWNoRW5kWSA9IDA7DQoJCXZhciB0b3VjaEVuZFggPSAwOw0KDQoJCS8qIERldGVjdGluZyB0b3VjaCBldmVudHMNCg0KCQkqIEFzIHdlIGFyZSBjaGFuZ2luZyB0aGUgdG9wIHByb3BlcnR5IG9mIHRoZSBwYWdlIG9uIHNjcm9sbGluZywgd2UgY2FuIG5vdCB1c2UgdGhlIHRyYWRpdGlvbmFsIHdheSB0byBkZXRlY3QgaXQuDQoJCSogVGhpcyB3YXksIHRoZSB0b3VjaHN0YXJ0IGFuZCB0aGUgdG91Y2ggbW92ZXMgc2hvd3MgYW4gc21hbGwgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZW0gd2hpY2ggaXMgdGhlDQoJCSogdXNlZCBvbmUgdG8gZGV0ZXJtaW5lIHRoZSBkaXJlY3Rpb24uDQoJCSovDQoJCWZ1bmN0aW9uIHRvdWNoTW92ZUhhbmRsZXIoZXZlbnQpew0KCQkJdmFyIGUgPSBldmVudC5vcmlnaW5hbEV2ZW50Ow0KDQoJCQkvLyBhZGRpdGlvbmFsOiBpZiBvbmUgb2YgdGhlIG5vcm1hbFNjcm9sbEVsZW1lbnRzIGlzbid0IHdpdGhpbiBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZCBob3BzIHVwIHRoZSBET00gY2hhaW4NCgkJCWlmICghY2hlY2tQYXJlbnRGb3JOb3JtYWxTY3JvbGxFbGVtZW50KGV2ZW50LnRhcmdldCkpIHsNCg0KCQkJCWlmKG9wdGlvbnMuYXV0b1Njcm9sbGluZyl7DQoJCQkJCS8vcHJldmVudGluZyB0aGUgZWFzaW5nIG9uIGlPUyBkZXZpY2VzDQoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoJCQkJfQ0KDQoJCQkJdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKTsNCgkJCQl2YXIgc2Nyb2xsYWJsZSA9IGlzU2Nyb2xsYWJsZShhY3RpdmVTZWN0aW9uKTsNCg0KCQkJCWlmICghaXNNb3ZpbmcgJiYgIXNsaWRlTW92aW5nKSB7IC8vaWYgdGhlcmVzIGFueSAjDQoJCQkJCXZhciB0b3VjaEV2ZW50cyA9IGdldEV2ZW50c1BhZ2UoZSk7DQoJCQkJCXRvdWNoRW5kWSA9IHRvdWNoRXZlbnRzWyd5J107DQoJCQkJCXRvdWNoRW5kWCA9IHRvdWNoRXZlbnRzWyd4J107DQoNCgkJCQkJLy9pZiBtb3ZlbWVudCBpbiB0aGUgWCBheHlzIGlzIGdyZWF0ZXIgdGhhbiBpbiB0aGUgWSBhbmQgdGhlIGN1cnJlY3Qgc2VjdGlvbiBoYXMgc2xpZGVzLi4uDQoJCQkJCWlmIChhY3RpdmVTZWN0aW9uLmZpbmQoJy5mcC1zbGlkZXMnKS5sZW5ndGggJiYgTWF0aC5hYnModG91Y2hTdGFydFggLSB0b3VjaEVuZFgpID4gKE1hdGguYWJzKHRvdWNoU3RhcnRZIC0gdG91Y2hFbmRZKSkpIHsNCg0KCQkJCQkgICAgLy9pcyB0aGUgbW92ZW1lbnQgZ3JlYXRlciB0aGFuIHRoZSBtaW5pbXVtIHJlc2lzdGFuY2UgdG8gc2Nyb2xsPw0KCQkJCQkgICAgaWYgKE1hdGguYWJzKHRvdWNoU3RhcnRYIC0gdG91Y2hFbmRYKSA+ICgkKHdpbmRvdykud2lkdGgoKSAvIDEwMCAqIG9wdGlvbnMudG91Y2hTZW5zaXRpdml0eSkpIHsNCgkJCQkJICAgICAgICBpZiAodG91Y2hTdGFydFggPiB0b3VjaEVuZFgpIHsNCgkJCQkJICAgICAgICAgICAgJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVSaWdodCgpOyAvL25leHQNCgkJCQkJICAgICAgICB9IGVsc2Ugew0KCQkJCQkgICAgICAgICAgICAkLmZuLmZ1bGxwYWdlLm1vdmVTbGlkZUxlZnQoKTsgLy9wcmV2DQoJCQkJCSAgICAgICAgfQ0KCQkJCQkgICAgfQ0KCQkJCQl9DQoNCgkJCQkJLy92ZXJ0aWNhbCBzY3JvbGxpbmcgKG9ubHkgd2hlbiBhdXRvU2Nyb2xsaW5nIGlzIGVuYWJsZWQpDQoJCQkJCWVsc2UgaWYob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCg0KCQkJCQkJLy9pcyB0aGUgbW92ZW1lbnQgZ3JlYXRlciB0aGFuIHRoZSBtaW5pbXVtIHJlc2lzdGFuY2UgdG8gc2Nyb2xsPw0KCQkJCQkJaWYgKE1hdGguYWJzKHRvdWNoU3RhcnRZIC0gdG91Y2hFbmRZKSA+ICgkKHdpbmRvdykuaGVpZ2h0KCkgLyAxMDAgKiBvcHRpb25zLnRvdWNoU2Vuc2l0aXZpdHkpKSB7DQoJCQkJCQkJaWYgKHRvdWNoU3RhcnRZID4gdG91Y2hFbmRZKSB7DQoJCQkJCQkJCXNjcm9sbGluZygnZG93bicsIHNjcm9sbGFibGUpOw0KCQkJCQkJCX0gZWxzZSBpZiAodG91Y2hFbmRZID4gdG91Y2hTdGFydFkpIHsNCgkJCQkJCQkJc2Nyb2xsaW5nKCd1cCcsIHNjcm9sbGFibGUpOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQl9DQoNCgkJLyoqDQoJCSAqIHJlY3Vyc2l2ZSBmdW5jdGlvbiB0byBsb29wIHVwIHRoZSBwYXJlbnQgbm9kZXMgdG8gY2hlY2sgaWYgb25lIG9mIHRoZW0gZXhpc3RzIGluIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMNCgkJICogQ3VycmVudGx5IHdvcmtzIHdlbGwgZm9yIGlPUyAtIEFuZHJvaWQgbWlnaHQgbmVlZCBzb21lIHRlc3RpbmcNCgkJICogQHBhcmFtICB7RWxlbWVudH0gZWwgIHRhcmdldCBlbGVtZW50IC8ganF1ZXJ5IHNlbGVjdG9yIChpbiBzdWJzZXF1ZW50IG5vZGVzKQ0KCQkgKiBAcGFyYW0gIHtpbnR9ICAgICBob3AgY3VycmVudCBob3AgY29tcGFyZWQgdG8gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQNCgkJICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGVyZSBpcyBhIG1hdGNoIHRvIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMNCgkJICovDQoJCWZ1bmN0aW9uIGNoZWNrUGFyZW50Rm9yTm9ybWFsU2Nyb2xsRWxlbWVudCAoZWwsIGhvcCkgew0KCQkJaG9wID0gaG9wIHx8IDA7DQoJCQl2YXIgcGFyZW50ID0gJChlbCkucGFyZW50KCk7DQoNCgkJCWlmIChob3AgPCBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZCAmJg0KCQkJCXBhcmVudC5pcyhvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzKSApIHsNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0gZWxzZSBpZiAoaG9wID09IG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudFRvdWNoVGhyZXNob2xkKSB7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfSBlbHNlIHsNCgkJCQlyZXR1cm4gY2hlY2tQYXJlbnRGb3JOb3JtYWxTY3JvbGxFbGVtZW50KHBhcmVudCwgKytob3ApOw0KCQkJfQ0KCQl9DQoNCgkJZnVuY3Rpb24gdG91Y2hTdGFydEhhbmRsZXIoZXZlbnQpew0KCQkJdmFyIGUgPSBldmVudC5vcmlnaW5hbEV2ZW50Ow0KCQkJdmFyIHRvdWNoRXZlbnRzID0gZ2V0RXZlbnRzUGFnZShlKTsNCgkJCXRvdWNoU3RhcnRZID0gdG91Y2hFdmVudHNbJ3knXTsNCgkJCXRvdWNoU3RhcnRYID0gdG91Y2hFdmVudHNbJ3gnXTsNCgkJfQ0KDQoNCgkJLyoqDQoJCSAqIERldGVjdGluZyBtb3VzZXdoZWVsIHNjcm9sbGluZw0KCQkgKg0KCQkgKiBodHRwOi8vYmxvZ3Muc2l0ZXBvaW50c3RhdGljLmNvbS9leGFtcGxlcy90ZWNoL21vdXNlLXdoZWVsL2luZGV4Lmh0bWwNCgkJICogaHR0cDovL3d3dy5zaXRlcG9pbnQuY29tL2h0bWw1LWphdmFzY3JpcHQtbW91c2Utd2hlZWwvDQoJCSAqLw0KCQlmdW5jdGlvbiBNb3VzZVdoZWVsSGFuZGxlcihlKSB7DQoJCQlpZihvcHRpb25zLmF1dG9TY3JvbGxpbmcpew0KCQkJCS8vIGNyb3NzLWJyb3dzZXIgd2hlZWwgZGVsdGENCgkJCQllID0gd2luZG93LmV2ZW50IHx8IGU7DQoJCQkJdmFyIGRlbHRhID0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsDQoJCQkJCQkoZS53aGVlbERlbHRhIHx8IC1lLmRlbHRhWSB8fCAtZS5kZXRhaWwpKSk7DQoNCgkJCQl2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpOw0KCQkJCXZhciBzY3JvbGxhYmxlID0gaXNTY3JvbGxhYmxlKGFjdGl2ZVNlY3Rpb24pOw0KDQoJCQkJaWYgKCFpc01vdmluZykgeyAvL2lmIHRoZXJlcyBhbnkgIw0KCQkJCQkvL3Njcm9sbGluZyBkb3duPw0KCQkJCQlpZiAoZGVsdGEgPCAwKSB7DQoJCQkJCQlzY3JvbGxpbmcoJ2Rvd24nLCBzY3JvbGxhYmxlKTsNCg0KCQkJCQkvL3Njcm9sbGluZyB1cD8NCgkJCQkJfWVsc2Ugew0KCQkJCQkJc2Nyb2xsaW5nKCd1cCcsIHNjcm9sbGFibGUpOw0KCQkJCQl9DQoJCQkJfQ0KDQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KCQl9DQoNCgkJZnVuY3Rpb24gbW92ZVNsaWRlKGRpcmVjdGlvbil7DQoJCSAgICB2YXIgYWN0aXZlU2VjdGlvbiA9ICQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpOw0KCQkgICAgdmFyIHNsaWRlcyA9IGFjdGl2ZVNlY3Rpb24uZmluZCgnLmZwLXNsaWRlcycpOw0KDQoJCSAgICAvLyBtb3JlIHRoYW4gb25lIHNsaWRlIG5lZWRlZCBhbmQgbm90aGluZyBzaG91bGQgYmUgc2xpZGluZw0KCQkJaWYgKCFzbGlkZXMubGVuZ3RoIHx8IHNsaWRlTW92aW5nKSB7DQoJCQkgICAgcmV0dXJuOw0KCQkJfQ0KDQoJCSAgICB2YXIgY3VycmVudFNsaWRlID0gc2xpZGVzLmZpbmQoJy5mcC1zbGlkZS5hY3RpdmUnKTsNCgkJICAgIHZhciBkZXN0aW55ID0gbnVsbDsNCg0KCQkgICAgaWYoZGlyZWN0aW9uID09PSAncHJldicpew0KCQkgICAgICAgIGRlc3RpbnkgPSBjdXJyZW50U2xpZGUucHJldignLmZwLXNsaWRlJyk7DQoJCSAgICB9ZWxzZXsNCgkJICAgICAgICBkZXN0aW55ID0gY3VycmVudFNsaWRlLm5leHQoJy5mcC1zbGlkZScpOw0KCQkgICAgfQ0KDQoJCSAgICAvL2lzbid0IHRoZXJlIGEgbmV4dCBzbGlkZSBpbiB0aGUgc2VjdWVuY2U/DQoJCQlpZighZGVzdGlueS5sZW5ndGgpew0KCQkJCS8vcmVzcGVjdCBsb29wSG9yaXpvbnRhbCBzZXR0aW4NCgkJCQlpZiAoIW9wdGlvbnMubG9vcEhvcml6b250YWwpIHJldHVybjsNCg0KCQkJICAgIGlmKGRpcmVjdGlvbiA9PT0gJ3ByZXYnKXsNCgkJCSAgICAgICAgZGVzdGlueSA9IGN1cnJlbnRTbGlkZS5zaWJsaW5ncygnOmxhc3QnKTsNCgkJCSAgICB9ZWxzZXsNCgkJCSAgICAgICAgZGVzdGlueSA9IGN1cnJlbnRTbGlkZS5zaWJsaW5ncygnOmZpcnN0Jyk7DQoJCQkgICAgfQ0KCQkJfQ0KDQoJCSAgICBzbGlkZU1vdmluZyA9IHRydWU7DQoNCgkJICAgIGxhbmRzY2FwZVNjcm9sbChzbGlkZXMsIGRlc3RpbnkpOw0KCQl9DQoNCgkJLyoqDQoJCSogTWFpbnRhaW5zIHRoZSBhY3RpdmUgc2xpZGVzIGluIHRoZSB2aWV3cG9ydA0KCQkqIChCZWNhdXNlIGhlIGBzY3JvbGxgIGFuaW1hdGlvbiBtaWdodCBnZXQgbG9zdCB3aXRoIHNvbWUgYWN0aW9ucywgc3VjaCBhcyB3aGVuIHVzaW5nIGNvbnRpbnVvdXNWZXJ0aWNhbCkNCgkJKi8NCgkJZnVuY3Rpb24ga2VlcFNsaWRlc1Bvc2l0aW9uKCl7DQoJCQkkKCcuZnAtc2xpZGUuYWN0aXZlJykuZWFjaChmdW5jdGlvbigpew0KCQkJCXNpbGVudExhbmRzY2FwZVNjcm9sbCgkKHRoaXMpKTsNCgkJCX0pOw0KCQl9DQoNCgkJLyoqDQoJCSogU2Nyb2xscyB0aGUgc2l0ZSB0byB0aGUgZ2l2ZW4gZWxlbWVudCBhbmQgc2Nyb2xscyB0byB0aGUgc2xpZGUgaWYgYSBjYWxsYmFjayBpcyBnaXZlbi4NCgkJKi8NCgkJZnVuY3Rpb24gc2Nyb2xsUGFnZShlbGVtZW50LCBjYWxsYmFjaywgaXNNb3ZlbWVudFVwKXsNCgkJCXZhciBkZXN0ID0gZWxlbWVudC5wb3NpdGlvbigpOw0KCQkJaWYodHlwZW9mIGRlc3QgPT09ICJ1bmRlZmluZWQiKXsgcmV0dXJuOyB9IC8vdGhlcmUncyBubyBlbGVtZW50IHRvIHNjcm9sbCwgbGVhdmluZyB0aGUgZnVuY3Rpb24NCg0KCQkJLy9sb2NhbCB2YXJpYWJsZXMNCgkJCXZhciB2ID0gew0KCQkJCWVsZW1lbnQ6IGVsZW1lbnQsDQoJCQkJY2FsbGJhY2s6IGNhbGxiYWNrLA0KCQkJCWlzTW92ZW1lbnRVcDogaXNNb3ZlbWVudFVwLA0KCQkJCWRlc3Q6IGRlc3QsDQoJCQkJZHRvcDogZGVzdC50b3AsDQoJCQkJeU1vdmVtZW50OiBnZXRZbW92ZW1lbnQoZWxlbWVudCksDQoJCQkJYW5jaG9yTGluazogZWxlbWVudC5kYXRhKCdhbmNob3InKSwNCgkJCQlzZWN0aW9uSW5kZXg6IGVsZW1lbnQuaW5kZXgoJy5mcC1zZWN0aW9uJyksDQoJCQkJYWN0aXZlU2xpZGU6IGVsZW1lbnQuZmluZCgnLmZwLXNsaWRlLmFjdGl2ZScpLA0KCQkJCWFjdGl2ZVNlY3Rpb246ICQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLA0KCQkJCWxlYXZpbmdTZWN0aW9uOiAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLmZwLXNlY3Rpb24nKSArIDEsDQoNCgkJCQkvL2NhY2hpbmcgdGhlIHZhbHVlIG9mIGlzUmVzaXppbmcgYXQgdGhlIG1vbW1lbnQgdGhlIGZ1bmN0aW9uIGlzIGNhbGxlZA0KCQkJCS8vYmVjYXVzZSBpdCB3aWxsIGJlIGNoZWNrZWQgbGF0ZXIgaW5zaWRlIGEgc2V0VGltZW91dCBhbmQgdGhlIHZhbHVlIG1pZ2h0IGNoYW5nZQ0KCQkJCWxvY2FsSXNSZXNpemluZzogaXNSZXNpemluZw0KCQkJfTsNCg0KCQkJLy9xdWl0aW5nIHdoZW4gYWN0aXZlU2VjdGlvbiBpcyB0aGUgdGFyZ2V0IGVsZW1lbnQNCgkJCWlmKHYuYWN0aXZlU2VjdGlvbi5pcyhlbGVtZW50KSAmJiAhaXNSZXNpemluZyl7IHJldHVybjsgfQ0KDQoJCQlpZih2LmFjdGl2ZVNsaWRlLmxlbmd0aCl7DQoJCQkJdmFyIHNsaWRlQW5jaG9yTGluayA9IHYuYWN0aXZlU2xpZGUuZGF0YSgnYW5jaG9yJyk7DQoJCQkJdmFyIHNsaWRlSW5kZXggPSB2LmFjdGl2ZVNsaWRlLmluZGV4KCk7DQoJCQl9DQoNCgkJCS8vIElmIGNvbnRpbnVvdXNWZXJ0aWNhbCAmJiB3ZSBuZWVkIHRvIHdyYXAgYXJvdW5kDQoJCQlpZiAob3B0aW9ucy5hdXRvU2Nyb2xsaW5nICYmIG9wdGlvbnMuY29udGludW91c1ZlcnRpY2FsICYmIHR5cGVvZiAodi5pc01vdmVtZW50VXApICE9PSAidW5kZWZpbmVkIiAmJg0KCQkJCSgoIXYuaXNNb3ZlbWVudFVwICYmIHYueU1vdmVtZW50ID09ICd1cCcpIHx8IC8vIEludGVuZGluZyB0byBzY3JvbGwgZG93biBidXQgYWJvdXQgdG8gZ28gdXAgb3INCgkJCQkodi5pc01vdmVtZW50VXAgJiYgdi55TW92ZW1lbnQgPT0gJ2Rvd24nKSkpIHsgLy8gaW50ZW5kaW5nIHRvIHNjcm9sbCB1cCBidXQgYWJvdXQgdG8gZ28gZG93bg0KDQoJCQkJdiA9IGNyZWF0ZUluZmluaXRlU2VjdGlvbnModik7DQoJCQl9DQoNCgkJCWVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KDQoJCQkvL3ByZXZlbnRpbmcgZnJvbSBhY3RpdmF0aW5nIHRoZSBNb3VzZVdoZWVsSGFuZGxlciBldmVudA0KCQkJLy9tb3JlIHRoYW4gb25jZSBpZiB0aGUgcGFnZSBpcyBzY3JvbGxpbmcNCgkJCWlzTW92aW5nID0gdHJ1ZTsNCg0KCQkJaWYodHlwZW9mIHYuYW5jaG9yTGluayAhPT0gJ3VuZGVmaW5lZCcpew0KCQkJCXNldFVSTEhhc2goc2xpZGVJbmRleCwgc2xpZGVBbmNob3JMaW5rLCB2LmFuY2hvckxpbmspOw0KCQkJfQ0KDQoJCQkvL2NhbGxiYWNrIChvbkxlYXZlKSBpZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KCQkJJC5pc0Z1bmN0aW9uKG9wdGlvbnMub25MZWF2ZSkgJiYgIXYubG9jYWxJc1Jlc2l6aW5nICYmIG9wdGlvbnMub25MZWF2ZS5jYWxsKHRoaXMsIHYubGVhdmluZ1NlY3Rpb24sICh2LnNlY3Rpb25JbmRleCArIDEpLCB2LnlNb3ZlbWVudCk7DQoNCgkJCXBlcmZvcm1Nb3ZlbWVudCh2KTsNCg0KCQkJLy9mbGFnIHRvIGF2b2lkIGNhbGxpbmduIGBzY3JvbGxQYWdlKClgIHR3aWNlIGluIGNhc2Ugb2YgdXNpbmcgYW5jaG9yIGxpbmtzDQoJCQlsYXN0U2Nyb2xsZWREZXN0aW55ID0gdi5hbmNob3JMaW5rOw0KDQoJCQkvL2F2b2lkIGZpcmluZyBpdCB0d2ljZSAoYXMgaXQgZG9lcyBhbHNvIG9uIHNjcm9sbCkNCgkJCWlmKG9wdGlvbnMuYXV0b1Njcm9sbGluZyl7DQoJCQkJYWN0aXZhdGVNZW51QW5kTmF2KHYuYW5jaG9yTGluaywgdi5zZWN0aW9uSW5kZXgpDQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJKiBQZXJmb3JtcyB0aGUgbW92ZW1lbnQgKGJ5IENTUzMgb3IgYnkgalF1ZXJ5KQ0KCQkqLw0KCQlmdW5jdGlvbiBwZXJmb3JtTW92ZW1lbnQodil7DQoJCQkvLyB1c2luZyBDU1MzIHRyYW5zbGF0ZSBmdW5jdGlvbmFsaXR5DQoJCQlpZiAob3B0aW9ucy5jc3MzICYmIG9wdGlvbnMuYXV0b1Njcm9sbGluZykgew0KDQoJCQkJdmFyIHRyYW5zbGF0ZTNkID0gJ3RyYW5zbGF0ZTNkKDBweCwgLScgKyB2LmR0b3AgKyAncHgsIDBweCknOw0KCQkJCXRyYW5zZm9ybUNvbnRhaW5lcih0cmFuc2xhdGUzZCwgdHJ1ZSk7DQoNCgkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkJYWZ0ZXJTZWN0aW9uTG9hZHModik7DQoJCQkJfSwgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCk7DQoJCQl9DQoNCgkJCS8vIHVzaW5nIGpRdWVyeSBhbmltYXRlDQoJCQllbHNlIHsNCgkJCQl2YXIgc2Nyb2xsU2V0dGluZ3MgPSBnZXRTY3JvbGxTZXR0aW5ncyh2KTsNCg0KCQkJCSQoc2Nyb2xsU2V0dGluZ3MuZWxlbWVudCkuYW5pbWF0ZSgNCgkJCQkJc2Nyb2xsU2V0dGluZ3Mub3B0aW9ucw0KCQkJCSwgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCwgb3B0aW9ucy5lYXNpbmcpLnByb21pc2UoKS5kb25lKGZ1bmN0aW9uICgpIHsgLy9vbmx5IG9uZSBzaW5nbGUgY2FsbGJhY2sgaW4gY2FzZSBvZiBhbmltYXRpbmcgIGBodG1sLCBib2R5YA0KCQkJCQlhZnRlclNlY3Rpb25Mb2Fkcyh2KTsNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkqIEdldHMgdGhlIHNjcm9sbGluZyBzZXR0aW5ncyBkZXBlbmRpbmcgb24gdGhlIHBsdWdpbiBhdXRvU2Nyb2xsaW5nIG9wdGlvbg0KCQkqLw0KCQlmdW5jdGlvbiBnZXRTY3JvbGxTZXR0aW5ncyh2KXsNCgkJCXZhciBzY3JvbGwgPSB7fTsNCg0KCQkJaWYob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCgkJCQlzY3JvbGwub3B0aW9ucyA9IHsgJ3RvcCc6IC12LmR0b3B9Ow0KCQkJCXNjcm9sbC5lbGVtZW50ID0gJy4nK3dyYXBwZXJTZWxlY3RvcjsNCgkJCX1lbHNlew0KCQkJCXNjcm9sbC5vcHRpb25zID0geyAnc2Nyb2xsVG9wJzogdi5kdG9wfTsNCgkJCQlzY3JvbGwuZWxlbWVudCA9ICdodG1sLCBib2R5JzsNCgkJCX0NCg0KCQkJcmV0dXJuIHNjcm9sbDsNCgkJfQ0KDQoJCS8qKg0KCQkqIEFkZHMgc2VjdGlvbnMgYmVmb3JlIG9yIGFmdGVyIHRoZSBjdXJyZW50IG9uZSB0byBjcmVhdGUgdGhlIGluZmluaXRlIGVmZmVjdC4NCgkJKi8NCgkJZnVuY3Rpb24gY3JlYXRlSW5maW5pdGVTZWN0aW9ucyh2KXsNCgkJCS8vIFNjcm9sbGluZyBkb3duDQoJCQlpZiAoIXYuaXNNb3ZlbWVudFVwKSB7DQoJCQkJLy8gTW92ZSBhbGwgcHJldmlvdXMgc2VjdGlvbnMgdG8gYWZ0ZXIgdGhlIGFjdGl2ZSBzZWN0aW9uDQoJCQkJJCgiLmZwLXNlY3Rpb24uYWN0aXZlIikuYWZ0ZXIodi5hY3RpdmVTZWN0aW9uLnByZXZBbGwoIi5mcC1zZWN0aW9uIikuZ2V0KCkucmV2ZXJzZSgpKTsNCgkJCX0NCgkJCWVsc2UgeyAvLyBTY3JvbGxpbmcgdXANCgkJCQkvLyBNb3ZlIGFsbCBuZXh0IHNlY3Rpb25zIHRvIGJlZm9yZSB0aGUgYWN0aXZlIHNlY3Rpb24NCgkJCQkkKCIuZnAtc2VjdGlvbi5hY3RpdmUiKS5iZWZvcmUodi5hY3RpdmVTZWN0aW9uLm5leHRBbGwoIi5mcC1zZWN0aW9uIikpOw0KCQkJfQ0KDQoJCQkvLyBNYWludGFpbiB0aGUgZGlzcGxheWVkIHBvc2l0aW9uIChub3cgdGhhdCB3ZSBjaGFuZ2VkIHRoZSBlbGVtZW50IG9yZGVyKQ0KCQkJc2lsZW50U2Nyb2xsKCQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLnBvc2l0aW9uKCkudG9wKTsNCg0KCQkJLy8gTWFpbnRhaW4gdGhlIGFjdGl2ZSBzbGlkZXMgdmlzaWJsZSBpbiB0aGUgdmlld3BvcnQNCgkJCWtlZXBTbGlkZXNQb3NpdGlvbigpOw0KDQoJCQkvLyBzYXZlIGZvciBsYXRlciB0aGUgZWxlbWVudHMgdGhhdCBzdGlsbCBuZWVkIHRvIGJlIHJlb3JkZXJlZA0KCQkJdi53cmFwQXJvdW5kRWxlbWVudHMgPSB2LmFjdGl2ZVNlY3Rpb247DQoNCgkJCS8vIFJlY2FsY3VsYXRlIGFuaW1hdGlvbiB2YXJpYWJsZXMNCgkJCXYuZGVzdCA9IHYuZWxlbWVudC5wb3NpdGlvbigpOw0KCQkJdi5kdG9wID0gdi5kZXN0LnRvcDsNCgkJCXYueU1vdmVtZW50ID0gZ2V0WW1vdmVtZW50KHYuZWxlbWVudCk7DQoNCgkJCXJldHVybiB2Ow0KCQl9DQoNCgkJLyoqDQoJCSogRml4IHNlY3Rpb24gb3JkZXIgYWZ0ZXIgY29udGludW91c1ZlcnRpY2FsIGNoYW5nZXMgaGF2ZSBiZWVuIGFuaW1hdGVkDQoJCSovDQoJCWZ1bmN0aW9uIGNvbnRpbnVvdXNWZXJ0aWNhbEZpeFNlY3Rpb25PcmRlciAodikgew0KCQkJLy8gSWYgY29udGludW91c1ZlcnRpY2FsIGlzIGluIGVmZmVjdCAoYW5kIGF1dG9TY3JvbGxpbmcgd291bGQgYWxzbyBiZSBpbiBlZmZlY3QgdGhlbiksDQoJCQkvLyBmaW5pc2ggbW92aW5nIHRoZSBlbGVtZW50cyBhcm91bmQgc28gdGhlIGRpcmVjdCBuYXZpZ2F0aW9uIHdpbGwgZnVuY3Rpb24gbW9yZSBzaW1wbHkNCgkJCWlmICghdi53cmFwQXJvdW5kRWxlbWVudHMgfHwgIXYud3JhcEFyb3VuZEVsZW1lbnRzLmxlbmd0aCkgew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJaWYgKHYuaXNNb3ZlbWVudFVwKSB7DQoJCQkJJCgnLmZwLXNlY3Rpb246Zmlyc3QnKS5iZWZvcmUodi53cmFwQXJvdW5kRWxlbWVudHMpOw0KCQkJfQ0KCQkJZWxzZSB7DQoJCQkJJCgnLmZwLXNlY3Rpb246bGFzdCcpLmFmdGVyKHYud3JhcEFyb3VuZEVsZW1lbnRzKTsNCgkJCX0NCg0KCQkJc2lsZW50U2Nyb2xsKCQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLnBvc2l0aW9uKCkudG9wKTsNCg0KCQkJLy8gTWFpbnRhaW4gdGhlIGFjdGl2ZSBzbGlkZXMgdmlzaWJsZSBpbiB0aGUgdmlld3BvcnQNCgkJCWtlZXBTbGlkZXNQb3NpdGlvbigpOw0KCQl9Ow0KDQoNCgkJLyoqDQoJCSogQWN0aW9ucyB0byBkbyBvbmNlIHRoZSBzZWN0aW9uIGlzIGxvYWRlZA0KCQkqLw0KCQlmdW5jdGlvbiBhZnRlclNlY3Rpb25Mb2FkcyAodil7DQoJCQljb250aW51b3VzVmVydGljYWxGaXhTZWN0aW9uT3JkZXIodik7DQoJCQkvL2NhbGxiYWNrIChhZnRlckxvYWQpIGlmIHRoZSBzaXRlIGlzIG5vdCBqdXN0IHJlc2l6aW5nIGFuZCByZWFkanVzdGluZyB0aGUgc2xpZGVzDQoJCQkkLmlzRnVuY3Rpb24ob3B0aW9ucy5hZnRlckxvYWQpICYmICF2LmxvY2FsSXNSZXNpemluZyAmJiBvcHRpb25zLmFmdGVyTG9hZC5jYWxsKHRoaXMsIHYuYW5jaG9yTGluaywgKHYuc2VjdGlvbkluZGV4ICsgMSkpOw0KDQoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQlpc01vdmluZyA9IGZhbHNlOw0KCQkJCSQuaXNGdW5jdGlvbih2LmNhbGxiYWNrKSAmJiB2LmNhbGxiYWNrLmNhbGwodGhpcyk7DQoJCQl9LCBzY3JvbGxEZWxheSk7DQoJCX0NCg0KDQoJCS8qKg0KCQkqIFNjcm9sbHMgdG8gdGhlIGFuY2hvciBpbiB0aGUgVVJMIHdoZW4gbG9hZGluZyB0aGUgc2l0ZQ0KCQkqLw0KCQlmdW5jdGlvbiBzY3JvbGxUb0FuY2hvcigpew0KCQkJLy9nZXR0aW5nIHRoZSBhbmNob3IgbGluayBpbiB0aGUgVVJMIGFuZCBkZWxldGluZyB0aGUgYCNgDQoJCQl2YXIgdmFsdWUgPSAgd2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsICcnKS5zcGxpdCgnLycpOw0KCQkJdmFyIHNlY3Rpb24gPSB2YWx1ZVswXTsNCgkJCXZhciBzbGlkZSA9IHZhbHVlWzFdOw0KDQoJCQlpZihzZWN0aW9uKXsgIC8vaWYgdGhlcmVzIGFueSAjDQoJCQkJc2Nyb2xsUGFnZUFuZFNsaWRlKHNlY3Rpb24sIHNsaWRlKTsNCgkJCX0NCgkJfQ0KDQoJCS8vZGV0ZWN0aW5nIGFueSBjaGFuZ2Ugb24gdGhlIFVSTCB0byBzY3JvbGwgdG8gdGhlIGdpdmVuIGFuY2hvciBsaW5rDQoJCS8vKGEgd2F5IHRvIGRldGVjdCBiYWNrIGhpc3RvcnkgYnV0dG9uIGFzIHdlIHBsYXkgd2l0aCB0aGUgaGFzaGVzIG9uIHRoZSBVUkwpDQoJCSQod2luZG93KS5vbignaGFzaGNoYW5nZScsIGhhc2hDaGFuZ2VIYW5kbGVyKTsNCg0KCQlmdW5jdGlvbiBoYXNoQ2hhbmdlSGFuZGxlcigpew0KCQkJaWYoIWlzU2Nyb2xsaW5nKXsNCgkJCQl2YXIgdmFsdWUgPSAgd2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgnIycsICcnKS5zcGxpdCgnLycpOw0KCQkJCXZhciBzZWN0aW9uID0gdmFsdWVbMF07DQoJCQkJdmFyIHNsaWRlID0gdmFsdWVbMV07DQoNCgkJCQlpZihzZWN0aW9uLmxlbmd0aCl7DQoJCQkJCS8vd2hlbiBtb3ZpbmcgdG8gYSBzbGlkZSBpbiB0aGUgZmlyc3Qgc2VjdGlvbiBmb3IgdGhlIGZpcnN0IHRpbWUgKGZpcnN0IHRpbWUgdG8gYWRkIGFuIGFuY2hvciB0byB0aGUgVVJMKQ0KCQkJCQl2YXIgaXNGaXJzdFNsaWRlTW92ZSA9ICAodHlwZW9mIGxhc3RTY3JvbGxlZERlc3RpbnkgPT09ICd1bmRlZmluZWQnKTsNCgkJCQkJdmFyIGlzRmlyc3RTY3JvbGxNb3ZlID0gKHR5cGVvZiBsYXN0U2Nyb2xsZWREZXN0aW55ID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygc2xpZGUgPT09ICd1bmRlZmluZWQnICYmICFzbGlkZU1vdmluZyk7DQoNCgkJCQkJLyppbiBvcmRlciB0byBjYWxsIHNjcm9sbHBhZ2UoKSBvbmx5IG9uY2UgZm9yIGVhY2ggZGVzdGluYXRpb24gYXQgYSB0aW1lDQoJCQkJCUl0IGlzIGNhbGxlZCB0d2ljZSBmb3IgZWFjaCBzY3JvbGwgb3RoZXJ3aXNlLCBhcyBpbiBjYXNlIG9mIHVzaW5nIGFuY2hvcmxpbmtzIGBoYXNoQ2hhbmdlYA0KCQkJCQlldmVudCBpcyBmaXJlZCBvbiBldmVyeSBzY3JvbGwgdG9vLiovDQoJCQkJCWlmICgoc2VjdGlvbiAmJiBzZWN0aW9uICE9PSBsYXN0U2Nyb2xsZWREZXN0aW55KSAmJiAhaXNGaXJzdFNsaWRlTW92ZSB8fCBpc0ZpcnN0U2Nyb2xsTW92ZSB8fCAoIXNsaWRlTW92aW5nICYmIGxhc3RTY3JvbGxlZFNsaWRlICE9IHNsaWRlICkpICB7DQoJCQkJCQlzY3JvbGxQYWdlQW5kU2xpZGUoc2VjdGlvbiwgc2xpZGUpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCg0KCQkvKioNCgkJICogU2xpZGluZyB3aXRoIGFycm93IGtleXMsIGJvdGgsIHZlcnRpY2FsIGFuZCBob3Jpem9udGFsDQoJCSAqLw0KCQkkKGRvY3VtZW50KS5rZXlkb3duKGZ1bmN0aW9uKGUpIHsNCgkJCS8vTW92aW5nIHRoZSBtYWluIHBhZ2Ugd2l0aCB0aGUga2V5Ym9hcmQgYXJyb3dzIGlmIGtleWJvYXJkIHNjcm9sbGluZyBpcyBlbmFibGVkDQoJCQlpZiAob3B0aW9ucy5rZXlib2FyZFNjcm9sbGluZyAmJiAhaXNNb3ZpbmcpIHsNCgkJCQlzd2l0Y2ggKGUud2hpY2gpIHsNCgkJCQkJLy91cA0KCQkJCQljYXNlIDM4Og0KCQkJCQljYXNlIDMzOg0KCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvblVwKCk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQkvL2Rvd24NCgkJCQkJY2FzZSA0MDoNCgkJCQkJY2FzZSAzNDoNCgkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25Eb3duKCk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQkvL0hvbWUNCgkJCQkJY2FzZSAzNjoNCgkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVRvKDEpOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJLy9FbmQNCgkJCQkJY2FzZSAzNToNCgkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVRvKCAkKCcuZnAtc2VjdGlvbicpLmxlbmd0aCApOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJLy9sZWZ0DQoJCQkJCWNhc2UgMzc6DQoJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTbGlkZUxlZnQoKTsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCS8vcmlnaHQNCgkJCQkJY2FzZSAzOToNCgkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlUmlnaHQoKTsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCWRlZmF1bHQ6DQoJCQkJCQlyZXR1cm47IC8vIGV4aXQgdGhpcyBoYW5kbGVyIGZvciBvdGhlciBrZXlzDQoJCQkJfQ0KCQkJfQ0KCQl9KTsNCg0KCQkvKioNCgkJKiBTY3JvbGxzIHRvIHRoZSBzZWN0aW9uIHdoZW4gY2xpY2tpbmcgdGhlIG5hdmlnYXRpb24gYnVsbGV0DQoJCSovDQoJCSQoZG9jdW1lbnQpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgJyNmcC1uYXYgYScsIGZ1bmN0aW9uKGUpew0KCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJdmFyIGluZGV4ID0gJCh0aGlzKS5wYXJlbnQoKS5pbmRleCgpOw0KCQkJc2Nyb2xsUGFnZSgkKCcuZnAtc2VjdGlvbicpLmVxKGluZGV4KSk7DQoJCX0pOw0KDQoJCS8qKg0KCQkqIFNjcm9sbHMgdGhlIHNsaWRlciB0byB0aGUgZ2l2ZW4gc2xpZGUgZGVzdGluYXRpb24gZm9yIHRoZSBnaXZlbiBzZWN0aW9uDQoJCSovDQoJCSQoZG9jdW1lbnQpLm9uKCdjbGljayB0b3VjaHN0YXJ0JywgJy5mcC1zbGlkZXNOYXYgYScsIGZ1bmN0aW9uKGUpew0KCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuY2xvc2VzdCgnLmZwLXNlY3Rpb24nKS5maW5kKCcuZnAtc2xpZGVzJyk7DQoJCQl2YXIgZGVzdGlueSA9IHNsaWRlcy5maW5kKCcuZnAtc2xpZGUnKS5lcSgkKHRoaXMpLmNsb3Nlc3QoJ2xpJykuaW5kZXgoKSk7DQoNCgkJCWxhbmRzY2FwZVNjcm9sbChzbGlkZXMsIGRlc3RpbnkpOw0KCQl9KTsNCg0KDQoJCS8vbmF2aWdhdGlvbiB0b29sdGlwcw0KCQkkKGRvY3VtZW50KS5vbih7DQoJCQltb3VzZWVudGVyOiBmdW5jdGlvbigpew0KCQkJCXZhciB0b29sdGlwID0gJCh0aGlzKS5kYXRhKCd0b29sdGlwJyk7DQoJCQkJJCgnPGRpdiBjbGFzcz0iZnAtdG9vbHRpcCAnICsgb3B0aW9ucy5uYXZpZ2F0aW9uUG9zaXRpb24gKyciPicgKyB0b29sdGlwICsgJzwvZGl2PicpLmhpZGUoKS5hcHBlbmRUbygkKHRoaXMpKS5mYWRlSW4oMjAwKTsNCgkJCX0sDQoJCQltb3VzZWxlYXZlOiBmdW5jdGlvbigpew0KCQkJCSQodGhpcykuZmluZCgnLmZwLXRvb2x0aXAnKS5mYWRlT3V0KDIwMCwgZnVuY3Rpb24oKSB7DQoJCQkJCSQodGhpcykucmVtb3ZlKCk7DQoJCQkJfSk7DQoJCQl9DQoJCX0sICcjZnAtbmF2IGxpJyk7DQoNCg0KCQlpZihvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzKXsNCgkJCSQoZG9jdW1lbnQpLm9uKCdtb3VzZWVudGVyJywgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cywgZnVuY3Rpb24gKCkgew0KCQkJCSQuZm4uZnVsbHBhZ2Uuc2V0TW91c2VXaGVlbFNjcm9sbGluZyhmYWxzZSk7DQoJCQl9KTsNCg0KCQkJJChkb2N1bWVudCkub24oJ21vdXNlbGVhdmUnLCBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzLCBmdW5jdGlvbigpew0KCQkJCSQuZm4uZnVsbHBhZ2Uuc2V0TW91c2VXaGVlbFNjcm9sbGluZyh0cnVlKTsNCgkJCX0pOw0KCQl9DQoNCgkJLyoqDQoJCSAqIFNjcm9sbGluZyBob3Jpem9udGFsbHkgd2hlbiBjbGlja2luZyBvbiB0aGUgc2xpZGVyIGNvbnRyb2xzLg0KCQkgKi8NCgkJJCgnLmZwLXNlY3Rpb24nKS5vbignY2xpY2sgdG91Y2hzdGFydCcsICcuZnAtY29udHJvbEFycm93JywgZnVuY3Rpb24oKSB7DQoJCQlpZiAoJCh0aGlzKS5oYXNDbGFzcygnZnAtcHJldicpKSB7DQoJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVMZWZ0KCk7DQoJCQl9IGVsc2Ugew0KCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlUmlnaHQoKTsNCgkJCX0NCgkJfSk7DQoNCgkJLyoqDQoJCSogU2Nyb2xscyBob3Jpem9udGFsIHNsaWRlcnMuDQoJCSovDQoJCWZ1bmN0aW9uIGxhbmRzY2FwZVNjcm9sbChzbGlkZXMsIGRlc3Rpbnkpew0KCQkJdmFyIGRlc3RpbnlQb3MgPSBkZXN0aW55LnBvc2l0aW9uKCk7DQoJCQl2YXIgc2xpZGVzQ29udGFpbmVyID0gc2xpZGVzLmZpbmQoJy5mcC1zbGlkZXNDb250YWluZXInKS5wYXJlbnQoKTsNCgkJCXZhciBzbGlkZUluZGV4ID0gZGVzdGlueS5pbmRleCgpOw0KCQkJdmFyIHNlY3Rpb24gPSBzbGlkZXMuY2xvc2VzdCgnLmZwLXNlY3Rpb24nKTsNCgkJCXZhciBzZWN0aW9uSW5kZXggPSBzZWN0aW9uLmluZGV4KCcuZnAtc2VjdGlvbicpOw0KCQkJdmFyIGFuY2hvckxpbmsgPSBzZWN0aW9uLmRhdGEoJ2FuY2hvcicpOw0KCQkJdmFyIHNsaWRlc05hdiA9IHNlY3Rpb24uZmluZCgnLmZwLXNsaWRlc05hdicpOw0KCQkJdmFyIHNsaWRlQW5jaG9yID0gZGVzdGlueS5kYXRhKCdhbmNob3InKTsNCg0KCQkJLy9jYWNoaW5nIHRoZSB2YWx1ZSBvZiBpc1Jlc2l6aW5nIGF0IHRoZSBtb21tZW50IHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQNCgkJCS8vYmVjYXVzZSBpdCB3aWxsIGJlIGNoZWNrZWQgbGF0ZXIgaW5zaWRlIGEgc2V0VGltZW91dCBhbmQgdGhlIHZhbHVlIG1pZ2h0IGNoYW5nZQ0KCQkJdmFyIGxvY2FsSXNSZXNpemluZyA9IGlzUmVzaXppbmc7DQoNCgkJCWlmKG9wdGlvbnMub25TbGlkZUxlYXZlKXsNCgkJCQl2YXIgcHJldlNsaWRlSW5kZXggPSBzZWN0aW9uLmZpbmQoJy5mcC1zbGlkZS5hY3RpdmUnKS5pbmRleCgpOw0KCQkJCXZhciB4TW92ZW1lbnQgPSBnZXRYbW92ZW1lbnQocHJldlNsaWRlSW5kZXgsIHNsaWRlSW5kZXgpOw0KDQoJCQkJLy9pZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KCQkJCWlmKCFsb2NhbElzUmVzaXppbmcgJiYgeE1vdmVtZW50IT09J25vbmUnKXsNCgkJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLm9uU2xpZGVMZWF2ZSApICYmIG9wdGlvbnMub25TbGlkZUxlYXZlLmNhbGwoIHRoaXMsIGFuY2hvckxpbmssIChzZWN0aW9uSW5kZXggKyAxKSwgcHJldlNsaWRlSW5kZXgsIHhNb3ZlbWVudCk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlkZXN0aW55LmFkZENsYXNzKCdhY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCg0KDQoJCQlpZih0eXBlb2Ygc2xpZGVBbmNob3IgPT09ICd1bmRlZmluZWQnKXsNCgkJCQlzbGlkZUFuY2hvciA9IHNsaWRlSW5kZXg7DQoJCQl9DQoNCgkJCWlmKCFvcHRpb25zLmxvb3BIb3Jpem9udGFsKXsNCgkJCQkvL2hpZGRpbmcgaXQgZm9yIHRoZSBmaXN0IHNsaWRlLCBzaG93aW5nIGZvciB0aGUgcmVzdA0KCQkJCXNlY3Rpb24uZmluZCgnLmZwLWNvbnRyb2xBcnJvdy5mcC1wcmV2JykudG9nZ2xlKHNsaWRlSW5kZXghPTApOw0KDQoJCQkJLy9oaWRkaW5nIGl0IGZvciB0aGUgbGFzdCBzbGlkZSwgc2hvd2luZyBmb3IgdGhlIHJlc3QNCgkJCQlzZWN0aW9uLmZpbmQoJy5mcC1jb250cm9sQXJyb3cuZnAtbmV4dCcpLnRvZ2dsZSghZGVzdGlueS5pcygnOmxhc3QtY2hpbGQnKSk7DQoJCQl9DQoNCgkJCS8vb25seSBjaGFuZ2luZyB0aGUgVVJMIGlmIHRoZSBzbGlkZXMgYXJlIGluIHRoZSBjdXJyZW50IHNlY3Rpb24gKG5vdCBmb3IgcmVzaXplIHJlLWFkanVzdGluZykNCgkJCWlmKHNlY3Rpb24uaGFzQ2xhc3MoJ2FjdGl2ZScpKXsNCgkJCQlzZXRVUkxIYXNoKHNsaWRlSW5kZXgsIHNsaWRlQW5jaG9yLCBhbmNob3JMaW5rKTsNCgkJCX0NCg0KCQkJdmFyIGFmdGVyU2xpZGVMb2FkcyA9IGZ1bmN0aW9uKCl7DQoJCQkJLy9pZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KCQkJCWlmKCFsb2NhbElzUmVzaXppbmcpew0KCQkJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJTbGlkZUxvYWQgKSAmJiBvcHRpb25zLmFmdGVyU2xpZGVMb2FkLmNhbGwoIHRoaXMsIGFuY2hvckxpbmssIChzZWN0aW9uSW5kZXggKyAxKSwgc2xpZGVBbmNob3IsIHNsaWRlSW5kZXgpOw0KCQkJCX0NCgkJCQkvL2xldHRpbmcgdGhlbSBzbGlkZSBhZ2Fpbg0KCQkJCXNsaWRlTW92aW5nID0gZmFsc2U7DQoJCQl9Ow0KDQoJCQlpZihvcHRpb25zLmNzczMpew0KCQkJCXZhciB0cmFuc2xhdGUzZCA9ICd0cmFuc2xhdGUzZCgtJyArIGRlc3RpbnlQb3MubGVmdCArICdweCwgMHB4LCAwcHgpJzsNCg0KCQkJCWFkZEFuaW1hdGlvbihzbGlkZXMuZmluZCgnLmZwLXNsaWRlc0NvbnRhaW5lcicpLCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkPjApLmNzcyhnZXRUcmFuc2Zvcm1zKHRyYW5zbGF0ZTNkKSk7DQoNCgkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJCQkJCWFmdGVyU2xpZGVMb2FkcygpOw0KCQkJCX0sIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQsIG9wdGlvbnMuZWFzaW5nKTsNCgkJCX1lbHNlew0KCQkJCXNsaWRlc0NvbnRhaW5lci5hbmltYXRlKHsNCgkJCQkJc2Nyb2xsTGVmdCA6IGRlc3RpbnlQb3MubGVmdA0KCQkJCX0sIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQsIG9wdGlvbnMuZWFzaW5nLCBmdW5jdGlvbigpIHsNCg0KCQkJCQlhZnRlclNsaWRlTG9hZHMoKTsNCgkJCQl9KTsNCgkJCX0NCg0KCQkJc2xpZGVzTmF2LmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQlzbGlkZXNOYXYuZmluZCgnbGknKS5lcShzbGlkZUluZGV4KS5maW5kKCdhJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQl9DQoNCgkgICAgLy93aGVuIHJlc2l6aW5nIHRoZSBzaXRlLCB3ZSBhZGp1c3QgdGhlIGhlaWdodHMgb2YgdGhlIHNlY3Rpb25zLCBzbGltU2Nyb2xsLi4uDQoJICAgICQod2luZG93KS5yZXNpemUocmVzaXplSGFuZGxlcik7DQoNCgkgICAgdmFyIHJlc2l6ZUlkOw0KCSAgICBmdW5jdGlvbiByZXNpemVIYW5kbGVyKCl7DQoJICAgIAkvL2NoZWNraW5nIGlmIGl0IG5lZWRzIHRvIGdldCByZXNwb25zaXZlDQoJICAgIAlyZXNwb25zaXZlKCk7DQoNCgkgICAgCS8vIHJlYnVpbGQgaW1tZWRpYXRlbHkgb24gdG91Y2ggZGV2aWNlcw0KCQkJaWYgKGlzVG91Y2hEZXZpY2UpIHsNCg0KCQkJCS8vaWYgdGhlIGtleWJvYXJkIGlzIHZpc2libGUNCgkJCQlpZiAoJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5hdHRyKCd0eXBlJykgIT09ICd0ZXh0Jykgew0KCQkgICAgICAgIAkkLmZuLmZ1bGxwYWdlLnJlQnVpbGQodHJ1ZSk7DQoJCSAgICAgICAgfQ0KCSAgICAgIAl9ZWxzZXsNCgkgICAgICAJCS8vaW4gb3JkZXIgdG8gY2FsbCB0aGUgZnVuY3Rpb25zIG9ubHkgd2hlbiB0aGUgcmVzaXplIGlzIGZpbmlzaGVkDQoJICAgIAkJLy9odHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzQyOTg2MTIvanF1ZXJ5LWhvdy10by1jYWxsLXJlc2l6ZS1ldmVudC1vbmx5LW9uY2UtaXRzLWZpbmlzaGVkLXJlc2l6aW5nDQoJICAgICAgCQljbGVhclRpbWVvdXQocmVzaXplSWQpOw0KDQoJICAgICAgICAJcmVzaXplSWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQoJICAgICAgICAJCSQuZm4uZnVsbHBhZ2UucmVCdWlsZCh0cnVlKTsNCgkgICAgICAgIAl9LCA1MDApOw0KCSAgICAgIAl9DQoJICAgIH0NCg0KCSAgICAvKioNCgkgICAgKiBDaGVja3MgaWYgdGhlIHNpdGUgbmVlZHMgdG8gZ2V0IHJlc3BvbnNpdmUgYW5kIGRpc2FibGVzIGF1dG9TY3JvbGxpbmcgaWYgc28uDQoJICAgICogQSBjbGFzcyBgZnAtcmVzcG9uc2l2ZWAgaXMgYWRkZWQgdG8gdGhlIHBsdWdpbidzIGNvbnRhaW5lciBpbiBjYXNlIHRoZSB1c2VyIHdhbnRzIHRvIHVzZSBpdCBmb3IgaGlzIG93biByZXNwb25zaXZlIENTUy4NCgkgICAgKi8NCgkgICAgZnVuY3Rpb24gcmVzcG9uc2l2ZSgpew0KCSAgICAJaWYob3B0aW9ucy5yZXNwb25zaXZlKXsNCgkgICAgCQl2YXIgaXNSZXNwb25zaXZlID0gY29udGFpbmVyLmhhc0NsYXNzKCdmcC1yZXNwb25zaXZlJyk7DQoJICAgIAkJaWYgKCQod2luZG93KS53aWR0aCgpIDwgb3B0aW9ucy5yZXNwb25zaXZlICl7DQoJICAgIAkJCWlmKCFpc1Jlc3BvbnNpdmUpew0KCSAgICAJCQkJJC5mbi5mdWxscGFnZS5zZXRBdXRvU2Nyb2xsaW5nKGZhbHNlKTsNCgkgICAgCQkJCSQoJyNmcC1uYXYnKS5oaWRlKCk7DQoJCQkJCQljb250YWluZXIuYWRkQ2xhc3MoJ2ZwLXJlc3BvbnNpdmUnKTsNCgkgICAgCQkJfQ0KCSAgICAJCX1lbHNlIGlmKGlzUmVzcG9uc2l2ZSl7DQoJICAgIAkJCSQuZm4uZnVsbHBhZ2Uuc2V0QXV0b1Njcm9sbGluZyh0cnVlKTsNCgkgICAgCQkJJCgnI2ZwLW5hdicpLnNob3coKTsNCgkJCQkJY29udGFpbmVyLnJlbW92ZUNsYXNzKCdmcC1yZXNwb25zaXZlJyk7DQoJICAgIAkJfQ0KCSAgICAJfQ0KCSAgICB9DQoNCgkgICAgLyoqDQoJCSogVG9vZ2xlcyB0cmFuc2l0aW9uIGFuaW1hdGlvbnMgZm9yIHRoZSBnaXZlbiBlbGVtZW50DQoJCSovDQoJCWZ1bmN0aW9uIGFkZEFuaW1hdGlvbihlbGVtZW50LCBhZGRpbmcpew0KCQkJdmFyIHRyYW5zaXRpb24gPSAnYWxsICcgKyBvcHRpb25zLnNjcm9sbGluZ1NwZWVkICsgJ21zICcgKyBvcHRpb25zLmVhc2luZ2NzczM7DQoNCgkJCWlmKGFkZGluZyl7DQoJCQkJZWxlbWVudC5yZW1vdmVDbGFzcygnZnAtbm90cmFuc2l0aW9uJyk7DQoJCQkJcmV0dXJuIGVsZW1lbnQuY3NzKHsNCgkJCQkJJy13ZWJraXQtdHJhbnNpdGlvbic6IHRyYW5zaXRpb24sDQogICAgICAgICAJCQkndHJhbnNpdGlvbic6IHRyYW5zaXRpb24NCiAgICAgICAgICAgCQl9KTsNCgkJCX0NCg0KCQkJLy9yZW1vdmluZyB0aGUgYW5pbWF0aW9uDQoJCQlyZXR1cm4gcmVtb3ZlQW5pbWF0aW9uKGVsZW1lbnQpOw0KCQl9DQoNCgkJLyoqDQoJCSogUmVtb3ZlIHRyYW5zaXRpb24gYW5pbWF0aW9ucyBmb3IgdGhlIGdpdmVuIGVsZW1lbnQNCgkJKi8NCgkJZnVuY3Rpb24gcmVtb3ZlQW5pbWF0aW9uKGVsZW1lbnQpew0KCQkJcmV0dXJuIGVsZW1lbnQuYWRkQ2xhc3MoJ2ZwLW5vdHJhbnNpdGlvbicpOw0KCQl9DQoNCgkJLyoqDQoJCSAqIFJlc2l6aW5nIG9mIHRoZSBmb250IHNpemUgZGVwZW5kaW5nIG9uIHRoZSB3aW5kb3cgc2l6ZSBhcyB3ZWxsIGFzIHNvbWUgb2YgdGhlIGltYWdlcyBvbiB0aGUgc2l0ZS4NCgkJICovDQoJCWZ1bmN0aW9uIHJlc2l6ZU1lKGRpc3BsYXlIZWlnaHQsIGRpc3BsYXlXaWR0aCkgew0KCQkJLy9TdGFuZGFyZCBkaW1lbnNpb25zLCBmb3Igd2hpY2ggdGhlIGJvZHkgZm9udCBzaXplIGlzIGNvcnJlY3QNCgkJCXZhciBwcmVmZXJyZWRIZWlnaHQgPSA4MjU7DQoJCQl2YXIgcHJlZmVycmVkV2lkdGggPSA5MDA7DQoNCgkJCWlmIChkaXNwbGF5SGVpZ2h0IDwgcHJlZmVycmVkSGVpZ2h0IHx8IGRpc3BsYXlXaWR0aCA8IHByZWZlcnJlZFdpZHRoKSB7DQoJCQkJdmFyIGhlaWdodFBlcmNlbnRhZ2UgPSAoZGlzcGxheUhlaWdodCAqIDEwMCkgLyBwcmVmZXJyZWRIZWlnaHQ7DQoJCQkJdmFyIHdpZHRoUGVyY2VudGFnZSA9IChkaXNwbGF5V2lkdGggKiAxMDApIC8gcHJlZmVycmVkV2lkdGg7DQoJCQkJdmFyIHBlcmNlbnRhZ2UgPSBNYXRoLm1pbihoZWlnaHRQZXJjZW50YWdlLCB3aWR0aFBlcmNlbnRhZ2UpOw0KCQkJCXZhciBuZXdGb250U2l6ZSA9IHBlcmNlbnRhZ2UudG9GaXhlZCgyKTsNCg0KCQkJCSQoImJvZHkiKS5jc3MoImZvbnQtc2l6ZSIsIG5ld0ZvbnRTaXplICsgJyUnKTsNCgkJCX0gZWxzZSB7DQoJCQkJJCgiYm9keSIpLmNzcygiZm9udC1zaXplIiwgJzEwMCUnKTsNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkgKiBBY3RpdmF0aW5nIHRoZSB3ZWJzaXRlIG5hdmlnYXRpb24gZG90cyBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHNsaWRlIG5hbWUuDQoJCSAqLw0KCQlmdW5jdGlvbiBhY3RpdmF0ZU5hdkRvdHMobmFtZSwgc2VjdGlvbkluZGV4KXsNCgkJCWlmKG9wdGlvbnMubmF2aWdhdGlvbil7DQoJCQkJJCgnI2ZwLW5hdicpLmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQkJaWYobmFtZSl7DQoJCQkJCSQoJyNmcC1uYXYnKS5maW5kKCdhW2hyZWY9IiMnICsgbmFtZSArICciXScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCQl9ZWxzZXsNCgkJCQkJJCgnI2ZwLW5hdicpLmZpbmQoJ2xpJykuZXEoc2VjdGlvbkluZGV4KS5maW5kKCdhJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkgKiBBY3RpdmF0aW5nIHRoZSB3ZWJzaXRlIG1haW4gbWVudSBlbGVtZW50cyBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHNsaWRlIG5hbWUuDQoJCSAqLw0KCQlmdW5jdGlvbiBhY3RpdmF0ZU1lbnVFbGVtZW50KG5hbWUpew0KCQkJaWYob3B0aW9ucy5tZW51KXsNCgkJCQkkKG9wdGlvbnMubWVudSkuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCQkkKG9wdGlvbnMubWVudSkuZmluZCgnW2RhdGEtbWVudWFuY2hvcj0iJytuYW1lKyciXScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCX0NCgkJfQ0KDQoJCWZ1bmN0aW9uIGFjdGl2YXRlTWVudUFuZE5hdihhbmNob3IsIGluZGV4KXsNCgkJCWFjdGl2YXRlTWVudUVsZW1lbnQoYW5jaG9yKTsNCgkJCWFjdGl2YXRlTmF2RG90cyhhbmNob3IsIGluZGV4KTsNCgkJfQ0KDQoJCS8qKg0KCQkqIFJldHVybiBhIGJvb2xlYW4gZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIHNjcm9sbGFibGUgZWxlbWVudCBpcyBhdCB0aGUgZW5kIG9yIGF0IHRoZSBzdGFydCBvZiB0aGUgc2Nyb2xsaW5nDQoJCSogZGVwZW5kaW5nIG9uIHRoZSBnaXZlbiB0eXBlLg0KCQkqLw0KCQlmdW5jdGlvbiBpc1Njcm9sbGVkKHR5cGUsIHNjcm9sbGFibGUpew0KCQkJaWYodHlwZSA9PT0gJ3RvcCcpew0KCQkJCXJldHVybiAhc2Nyb2xsYWJsZS5zY3JvbGxUb3AoKTsNCgkJCX1lbHNlIGlmKHR5cGUgPT09ICdib3R0b20nKXsNCgkJCQlyZXR1cm4gc2Nyb2xsYWJsZS5zY3JvbGxUb3AoKSArIDEgKyBzY3JvbGxhYmxlLmlubmVySGVpZ2h0KCkgPj0gc2Nyb2xsYWJsZVswXS5zY3JvbGxIZWlnaHQ7DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJKiBSZXR1bnMgYHVwYCBvciBgZG93bmAgZGVwZW5kaW5nIG9uIHRoZSBzY3JvbGxpbmcgbW92ZW1lbnQgdG8gcmVhY2ggaXRzIGRlc3RpbmF0aW9uDQoJCSogZnJvbSB0aGUgY3VycmVudCBzZWN0aW9uLg0KCQkqLw0KCQlmdW5jdGlvbiBnZXRZbW92ZW1lbnQoZGVzdGlueSl7DQoJCQl2YXIgZnJvbUluZGV4ID0gJCgnLmZwLXNlY3Rpb24uYWN0aXZlJykuaW5kZXgoJy5mcC1zZWN0aW9uJyk7DQoJCQl2YXIgdG9JbmRleCA9IGRlc3RpbnkuaW5kZXgoJy5mcC1zZWN0aW9uJyk7DQoNCgkJCWlmKGZyb21JbmRleCA+IHRvSW5kZXgpew0KCQkJCXJldHVybiAndXAnOw0KCQkJfQ0KCQkJcmV0dXJuICdkb3duJzsNCgkJfQ0KDQoJCS8qKg0KCQkqIFJldHVucyBgcmlnaHRgIG9yIGBsZWZ0YCBkZXBlbmRpbmcgb24gdGhlIHNjcm9sbGluZyBtb3ZlbWVudCB0byByZWFjaCBpdHMgZGVzdGluYXRpb24NCgkJKiBmcm9tIHRoZSBjdXJyZW50IHNsaWRlLg0KCQkqLw0KCQlmdW5jdGlvbiBnZXRYbW92ZW1lbnQoZnJvbUluZGV4LCB0b0luZGV4KXsNCgkJCWlmKCBmcm9tSW5kZXggPT0gdG9JbmRleCl7DQoJCQkJcmV0dXJuICdub25lJw0KCQkJfQ0KCQkJaWYoZnJvbUluZGV4ID4gdG9JbmRleCl7DQoJCQkJcmV0dXJuICdsZWZ0JzsNCgkJCX0NCgkJCXJldHVybiAncmlnaHQnOw0KCQl9DQoNCg0KCQlmdW5jdGlvbiBjcmVhdGVTbGltU2Nyb2xsaW5nKGVsZW1lbnQpew0KCQkJLy9uZWVkZWQgdG8gbWFrZSBgc2Nyb2xsSGVpZ2h0YCB3b3JrIHVuZGVyIE9wZXJhIDEyDQoJCQllbGVtZW50LmNzcygnb3ZlcmZsb3cnLCAnaGlkZGVuJyk7DQoNCgkJCS8vaW4gY2FzZSBlbGVtZW50IGlzIGEgc2xpZGUNCgkJCXZhciBzZWN0aW9uID0gZWxlbWVudC5jbG9zZXN0KCcuZnAtc2VjdGlvbicpOw0KCQkJdmFyIHNjcm9sbGFibGUgPSBlbGVtZW50LmZpbmQoJy5mcC1zY3JvbGxhYmxlJyk7DQoNCgkJCS8vaWYgdGhlcmUgd2FzIHNjcm9sbCwgdGhlIGNvbnRlbnRIZWlnaHQgd2lsbCBiZSB0aGUgb25lIGluIHRoZSBzY3JvbGxhYmxlIHNlY3Rpb24NCgkJCWlmKHNjcm9sbGFibGUubGVuZ3RoKXsNCgkJCQl2YXIgY29udGVudEhlaWdodCA9IHNjcm9sbGFibGUuZ2V0KDApLnNjcm9sbEhlaWdodDsNCgkJCX1lbHNlew0KCQkJCXZhciBjb250ZW50SGVpZ2h0ID0gZWxlbWVudC5nZXQoMCkuc2Nyb2xsSGVpZ2h0Ow0KCQkJCWlmKG9wdGlvbnMudmVydGljYWxDZW50ZXJlZCl7DQoJCQkJCWNvbnRlbnRIZWlnaHQgPSBlbGVtZW50LmZpbmQoJy5mcC10YWJsZUNlbGwnKS5nZXQoMCkuc2Nyb2xsSGVpZ2h0Ow0KCQkJCX0NCgkJCX0NCg0KCQkJdmFyIHNjcm9sbEhlaWdodCA9IHdpbmRvd3NIZWlnaHQgLSBwYXJzZUludChzZWN0aW9uLmNzcygncGFkZGluZy1ib3R0b20nKSkgLSBwYXJzZUludChzZWN0aW9uLmNzcygncGFkZGluZy10b3AnKSk7DQoNCgkJCS8vbmVlZHMgc2Nyb2xsPw0KCQkJaWYgKCBjb250ZW50SGVpZ2h0ID4gc2Nyb2xsSGVpZ2h0KSB7DQoJCQkJLy93YXMgdGhlcmUgYWxyZWFkeSBhbiBzY3JvbGwgPyBVcGRhdGluZyBpdA0KCQkJCWlmKHNjcm9sbGFibGUubGVuZ3RoKXsNCgkJCQkJc2Nyb2xsYWJsZS5jc3MoJ2hlaWdodCcsIHNjcm9sbEhlaWdodCArICdweCcpLnBhcmVudCgpLmNzcygnaGVpZ2h0Jywgc2Nyb2xsSGVpZ2h0ICsgJ3B4Jyk7DQoJCQkJfQ0KCQkJCS8vY3JlYXRpbmcgdGhlIHNjcm9sbGluZw0KCQkJCWVsc2V7DQoJCQkJCWlmKG9wdGlvbnMudmVydGljYWxDZW50ZXJlZCl7DQoJCQkJCQllbGVtZW50LmZpbmQoJy5mcC10YWJsZUNlbGwnKS53cmFwSW5uZXIoJzxkaXYgY2xhc3M9ImZwLXNjcm9sbGFibGUiIC8+Jyk7DQoJCQkJCX1lbHNlew0KCQkJCQkJZWxlbWVudC53cmFwSW5uZXIoJzxkaXYgY2xhc3M9ImZwLXNjcm9sbGFibGUiIC8+Jyk7DQoJCQkJCX0NCg0KCQkJCQllbGVtZW50LmZpbmQoJy5mcC1zY3JvbGxhYmxlJykuc2xpbVNjcm9sbCh7DQoJCQkJCQlhbGxvd1BhZ2VTY3JvbGw6IHRydWUsDQoJCQkJCQloZWlnaHQ6IHNjcm9sbEhlaWdodCArICdweCcsDQoJCQkJCQlzaXplOiAnMTBweCcsDQoJCQkJCQlhbHdheXNWaXNpYmxlOiB0cnVlDQoJCQkJCX0pOw0KCQkJCX0NCgkJCX0NCg0KCQkJLy9yZW1vdmluZyB0aGUgc2Nyb2xsaW5nIHdoZW4gaXQgaXMgbm90IG5lY2Vzc2FyeSBhbnltb3JlDQoJCQllbHNlew0KCQkJCXJlbW92ZVNsaW1TY3JvbGwoZWxlbWVudCk7DQoJCQl9DQoNCgkJCS8vdW5kbw0KCQkJZWxlbWVudC5jc3MoJ292ZXJmbG93JywgJycpOw0KCQl9DQoNCgkJZnVuY3Rpb24gcmVtb3ZlU2xpbVNjcm9sbChlbGVtZW50KXsNCgkJCWVsZW1lbnQuZmluZCgnLmZwLXNjcm9sbGFibGUnKS5jaGlsZHJlbigpLmZpcnN0KCkudW53cmFwKCkudW53cmFwKCk7DQoJCQllbGVtZW50LmZpbmQoJy5zbGltU2Nyb2xsQmFyJykucmVtb3ZlKCk7DQoJCQllbGVtZW50LmZpbmQoJy5zbGltU2Nyb2xsUmFpbCcpLnJlbW92ZSgpOw0KCQl9DQoNCgkJZnVuY3Rpb24gYWRkVGFibGVDbGFzcyhlbGVtZW50KXsNCgkJCWVsZW1lbnQuYWRkQ2xhc3MoJ2ZwLXRhYmxlJykud3JhcElubmVyKCc8ZGl2IGNsYXNzPSJmcC10YWJsZUNlbGwiIHN0eWxlPSJoZWlnaHQ6JyArIGdldFRhYmxlSGVpZ2h0KGVsZW1lbnQpICsgJ3B4OyIgLz4nKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGdldFRhYmxlSGVpZ2h0KGVsZW1lbnQpew0KCQkJdmFyIHNlY3Rpb25IZWlnaHQgPSB3aW5kb3dzSGVpZ2h0Ow0KDQoJCQlpZihvcHRpb25zLnBhZGRpbmdUb3AgfHwgb3B0aW9ucy5wYWRkaW5nQm90dG9tKXsNCgkJCQl2YXIgc2VjdGlvbiA9IGVsZW1lbnQ7DQoJCQkJaWYoIXNlY3Rpb24uaGFzQ2xhc3MoJ2ZwLXNlY3Rpb24nKSl7DQoJCQkJCXNlY3Rpb24gPSBlbGVtZW50LmNsb3Nlc3QoJy5mcC1zZWN0aW9uJyk7DQoJCQkJfQ0KDQoJCQkJdmFyIHBhZGRpbmdzID0gcGFyc2VJbnQoc2VjdGlvbi5jc3MoJ3BhZGRpbmctdG9wJykpICsgcGFyc2VJbnQoc2VjdGlvbi5jc3MoJ3BhZGRpbmctYm90dG9tJykpOw0KCQkJCXNlY3Rpb25IZWlnaHQgPSAod2luZG93c0hlaWdodCAtIHBhZGRpbmdzKTsNCgkJCX0NCg0KCQkJcmV0dXJuIHNlY3Rpb25IZWlnaHQ7DQoJCX0NCg0KCQkvKioNCgkJKiBBZGRzIGEgY3NzMyB0cmFuc2Zvcm0gcHJvcGVydHkgdG8gdGhlIGNvbnRhaW5lciBjbGFzcyB3aXRoIG9yIHdpdGhvdXQgYW5pbWF0aW9uIGRlcGVuZGluZyBvbiB0aGUgYW5pbWF0ZWQgcGFyYW0uDQoJCSovDQoJCWZ1bmN0aW9uIHRyYW5zZm9ybUNvbnRhaW5lcih0cmFuc2xhdGUzZCwgYW5pbWF0ZWQpew0KCQkJYWRkQW5pbWF0aW9uKGNvbnRhaW5lciwgYW5pbWF0ZWQpOw0KDQoJCQljb250YWluZXIuY3NzKGdldFRyYW5zZm9ybXModHJhbnNsYXRlM2QpKTsNCgkJfQ0KDQoNCgkJLyoqDQoJCSogU2Nyb2xscyB0byB0aGUgZ2l2ZW4gc2VjdGlvbiBhbmQgc2xpZGUNCgkJKi8NCgkJZnVuY3Rpb24gc2Nyb2xsUGFnZUFuZFNsaWRlKGRlc3RpbnksIHNsaWRlKXsNCgkJCWlmICh0eXBlb2Ygc2xpZGUgPT09ICd1bmRlZmluZWQnKSB7DQoJCQkgICAgc2xpZGUgPSAwOw0KCQkJfQ0KDQoJCQlpZihpc05hTihkZXN0aW55KSl7DQoJCQkJdmFyIHNlY3Rpb24gPSAkKCdbZGF0YS1hbmNob3I9IicrZGVzdGlueSsnIl0nKTsNCgkJCX1lbHNlew0KCQkJCXZhciBzZWN0aW9uID0gJCgnLmZwLXNlY3Rpb24nKS5lcSggKGRlc3RpbnkgLTEpICk7DQoJCQl9DQoNCg0KCQkJLy93ZSBuZWVkIHRvIHNjcm9sbCB0byB0aGUgc2VjdGlvbiBhbmQgdGhlbiB0byB0aGUgc2xpZGUNCgkJCWlmIChkZXN0aW55ICE9PSBsYXN0U2Nyb2xsZWREZXN0aW55ICYmICFzZWN0aW9uLmhhc0NsYXNzKCdhY3RpdmUnKSl7DQoJCQkJc2Nyb2xsUGFnZShzZWN0aW9uLCBmdW5jdGlvbigpew0KCQkJCQlzY3JvbGxTbGlkZXIoc2VjdGlvbiwgc2xpZGUpDQoJCQkJfSk7DQoJCQl9DQoJCQkvL2lmIHdlIHdlcmUgYWxyZWFkeSBpbiB0aGUgc2VjdGlvbg0KCQkJZWxzZXsNCgkJCQlzY3JvbGxTbGlkZXIoc2VjdGlvbiwgc2xpZGUpOw0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSogU2Nyb2xscyB0aGUgc2xpZGVyIHRvIHRoZSBnaXZlbiBzbGlkZSBkZXN0aW5hdGlvbiBmb3IgdGhlIGdpdmVuIHNlY3Rpb24NCgkJKi8NCgkJZnVuY3Rpb24gc2Nyb2xsU2xpZGVyKHNlY3Rpb24sIHNsaWRlKXsNCgkJCWlmKHR5cGVvZiBzbGlkZSAhPSAndW5kZWZpbmVkJyl7DQoJCQkJdmFyIHNsaWRlcyA9IHNlY3Rpb24uZmluZCgnLmZwLXNsaWRlcycpOw0KCQkJCXZhciBkZXN0aW55ID0gIHNsaWRlcy5maW5kKCdbZGF0YS1hbmNob3I9Iicrc2xpZGUrJyJdJyk7DQoNCgkJCQlpZighZGVzdGlueS5sZW5ndGgpew0KCQkJCQlkZXN0aW55ID0gc2xpZGVzLmZpbmQoJy5mcC1zbGlkZScpLmVxKHNsaWRlKTsNCgkJCQl9DQoNCgkJCQlpZihkZXN0aW55Lmxlbmd0aCl7DQoJCQkJCWxhbmRzY2FwZVNjcm9sbChzbGlkZXMsIGRlc3RpbnkpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkqIENyZWF0ZXMgYSBsYW5kc2NhcGUgbmF2aWdhdGlvbiBiYXIgd2l0aCBkb3RzIGZvciBob3Jpem9udGFsIHNsaWRlcnMuDQoJCSovDQoJCWZ1bmN0aW9uIGFkZFNsaWRlc05hdmlnYXRpb24oc2VjdGlvbiwgbnVtU2xpZGVzKXsNCgkJCXNlY3Rpb24uYXBwZW5kKCc8ZGl2IGNsYXNzPSJmcC1zbGlkZXNOYXYiPjx1bD48L3VsPjwvZGl2PicpOw0KCQkJdmFyIG5hdiA9IHNlY3Rpb24uZmluZCgnLmZwLXNsaWRlc05hdicpOw0KDQoJCQkvL3RvcCBvciBib3R0b20NCgkJCW5hdi5hZGRDbGFzcyhvcHRpb25zLnNsaWRlc05hdlBvc2l0aW9uKTsNCg0KCQkJZm9yKHZhciBpPTA7IGk8IG51bVNsaWRlczsgaSsrKXsNCgkJCQluYXYuZmluZCgndWwnKS5hcHBlbmQoJzxsaT48YSBocmVmPSIjIj48c3Bhbj48L3NwYW4+PC9hPjwvbGk+Jyk7DQoJCQl9DQoNCgkJCS8vY2VudGVyaW5nIGl0DQoJCQluYXYuY3NzKCdtYXJnaW4tbGVmdCcsICctJyArIChuYXYud2lkdGgoKS8yKSArICdweCcpOw0KDQoJCQluYXYuZmluZCgnbGknKS5maXJzdCgpLmZpbmQoJ2EnKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCX0NCg0KDQoJCS8qKg0KCQkqIFNldHMgdGhlIFVSTCBoYXNoIGZvciBhIHNlY3Rpb24gd2l0aCBzbGlkZXMNCgkJKi8NCgkJZnVuY3Rpb24gc2V0VVJMSGFzaChzbGlkZUluZGV4LCBzbGlkZUFuY2hvciwgYW5jaG9yTGluayl7DQoJCQl2YXIgc2VjdGlvbkhhc2ggPSAnJzsNCg0KCQkJaWYob3B0aW9ucy5hbmNob3JzLmxlbmd0aCl7DQoNCgkJCQkvL2lzbid0IGl0IHRoZSBmaXJzdCBzbGlkZT8NCgkJCQlpZihzbGlkZUluZGV4KXsNCgkJCQkJaWYodHlwZW9mIGFuY2hvckxpbmsgIT09ICd1bmRlZmluZWQnKXsNCgkJCQkJCXNlY3Rpb25IYXNoID0gYW5jaG9yTGluazsNCgkJCQkJfQ0KDQoJCQkJCS8vc2xpZGUgd2l0aG91dCBhbmNob3IgbGluaz8gV2UgdGFrZSB0aGUgaW5kZXggaW5zdGVhZC4NCgkJCQkJaWYodHlwZW9mIHNsaWRlQW5jaG9yID09PSAndW5kZWZpbmVkJyl7DQoJCQkJCQlzbGlkZUFuY2hvciA9IHNsaWRlSW5kZXg7DQoJCQkJCX0NCg0KCQkJCQlsYXN0U2Nyb2xsZWRTbGlkZSA9IHNsaWRlQW5jaG9yOw0KCQkJCQlsb2NhdGlvbi5oYXNoID0gc2VjdGlvbkhhc2ggKyAnLycgKyBzbGlkZUFuY2hvcjsNCg0KCQkJCS8vZmlyc3Qgc2xpZGUgd29uJ3QgaGF2ZSBzbGlkZSBhbmNob3IsIGp1c3QgdGhlIHNlY3Rpb24gb25lDQoJCQkJfWVsc2UgaWYodHlwZW9mIHNsaWRlSW5kZXggIT09ICd1bmRlZmluZWQnKXsNCgkJCQkJbGFzdFNjcm9sbGVkU2xpZGUgPSBzbGlkZUFuY2hvcjsNCgkJCQkJbG9jYXRpb24uaGFzaCA9IGFuY2hvckxpbms7DQoJCQkJfQ0KDQoJCQkJLy9zZWN0aW9uIHdpdGhvdXQgc2xpZGVzDQoJCQkJZWxzZXsNCgkJCQkJbG9jYXRpb24uaGFzaCA9IGFuY2hvckxpbms7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSogQ2hlY2tzIGZvciB0cmFuc2xhdGUzZCBzdXBwb3J0DQoJCSogQHJldHVybiBib29sZWFuDQoJCSogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy81NjYxNjcxL2RldGVjdGluZy10cmFuc2Zvcm0tdHJhbnNsYXRlM2Qtc3VwcG9ydA0KCQkqLw0KCQlmdW5jdGlvbiBzdXBwb3J0M2QoKSB7DQoJCQl2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyksDQoJCQkJaGFzM2QsDQoJCQkJdHJhbnNmb3JtcyA9IHsNCgkJCQkJJ3dlYmtpdFRyYW5zZm9ybSc6Jy13ZWJraXQtdHJhbnNmb3JtJywNCgkJCQkJJ09UcmFuc2Zvcm0nOictby10cmFuc2Zvcm0nLA0KCQkJCQknbXNUcmFuc2Zvcm0nOictbXMtdHJhbnNmb3JtJywNCgkJCQkJJ01velRyYW5zZm9ybSc6Jy1tb3otdHJhbnNmb3JtJywNCgkJCQkJJ3RyYW5zZm9ybSc6J3RyYW5zZm9ybScNCgkJCQl9Ow0KDQoJCQkvLyBBZGQgaXQgdG8gdGhlIGJvZHkgdG8gZ2V0IHRoZSBjb21wdXRlZCBzdHlsZS4NCgkJCWRvY3VtZW50LmJvZHkuaW5zZXJ0QmVmb3JlKGVsLCBudWxsKTsNCg0KCQkJZm9yICh2YXIgdCBpbiB0cmFuc2Zvcm1zKSB7DQoJCQkJaWYgKGVsLnN0eWxlW3RdICE9PSB1bmRlZmluZWQpIHsNCgkJCQkJZWwuc3R5bGVbdF0gPSAidHJhbnNsYXRlM2QoMXB4LDFweCwxcHgpIjsNCgkJCQkJaGFzM2QgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZSh0cmFuc2Zvcm1zW3RdKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWwpOw0KDQoJCQlyZXR1cm4gKGhhczNkICE9PSB1bmRlZmluZWQgJiYgaGFzM2QubGVuZ3RoID4gMCAmJiBoYXMzZCAhPT0gIm5vbmUiKTsNCgkJfQ0KDQoNCg0KCQkvKioNCgkJKiBSZW1vdmVzIHRoZSBhdXRvIHNjcm9sbGluZyBhY3Rpb24gZmlyZWQgYnkgdGhlIG1vdXNlIHdoZWVsIGFuZCB0YWNrcGFkLg0KCQkqIEFmdGVyIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkLCB0aGUgbW91c2V3aGVlbCBhbmQgdHJhY2twYWQgbW92ZW1lbnRzIHdvbid0IHNjcm9sbCB0aHJvdWdoIHNlY3Rpb25zLg0KCQkqLw0KCQlmdW5jdGlvbiByZW1vdmVNb3VzZVdoZWVsSGFuZGxlcigpew0KCQkJaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsNCgkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXdoZWVsJywgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9JRTksIENocm9tZSwgU2FmYXJpLCBPcGVyDQoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignd2hlZWwnLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0ZpcmVmb3gNCgkJCX0gZWxzZSB7DQoJCQkJZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ubW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyKTsgLy9JRSA2LzcvOA0KCQkJfQ0KCQl9DQoNCg0KCQkvKioNCgkJKiBBZGRzIHRoZSBhdXRvIHNjcm9sbGluZyBhY3Rpb24gZm9yIHRoZSBtb3VzZSB3aGVlbCBhbmQgdGFja3BhZC4NCgkJKiBBZnRlciB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCwgdGhlIG1vdXNld2hlZWwgYW5kIHRyYWNrcGFkIG1vdmVtZW50cyB3aWxsIHNjcm9sbCB0aHJvdWdoIHNlY3Rpb25zDQoJCSovDQoJCWZ1bmN0aW9uIGFkZE1vdXNlV2hlZWxIYW5kbGVyKCl7DQoJCQlpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgew0KCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNld2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0lFOSwgQ2hyb21lLCBTYWZhcmksIE9wZXINCgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyLCBmYWxzZSk7IC8vRmlyZWZveA0KCQkJfSBlbHNlIHsNCgkJCQlkb2N1bWVudC5hdHRhY2hFdmVudCgib25tb3VzZXdoZWVsIiwgTW91c2VXaGVlbEhhbmRsZXIpOyAvL0lFIDYvNy84DQoJCQl9DQoJCX0NCg0KDQoJCS8qKg0KCQkqIEFkZHMgdGhlIHBvc3NpYmlsaXR5IHRvIGF1dG8gc2Nyb2xsIHRocm91Z2ggc2VjdGlvbnMgb24gdG91Y2ggZGV2aWNlcy4NCgkJKi8NCgkJZnVuY3Rpb24gYWRkVG91Y2hIYW5kbGVyKCl7DQoJCQlpZihpc1RvdWNoRGV2aWNlIHx8IGlzVG91Y2gpew0KCQkJCS8vTWljcm9zb2Z0IHBvaW50ZXJzDQoJCQkJTVNQb2ludGVyID0gZ2V0TVNQb2ludGVyKCk7DQoNCgkJCQkkKGRvY3VtZW50KS5vZmYoJ3RvdWNoc3RhcnQgJyArICBNU1BvaW50ZXIuZG93bikub24oJ3RvdWNoc3RhcnQgJyArIE1TUG9pbnRlci5kb3duLCB0b3VjaFN0YXJ0SGFuZGxlcik7DQoJCQkJJChkb2N1bWVudCkub2ZmKCd0b3VjaG1vdmUgJyArIE1TUG9pbnRlci5tb3ZlKS5vbigndG91Y2htb3ZlICcgKyBNU1BvaW50ZXIubW92ZSwgdG91Y2hNb3ZlSGFuZGxlcik7DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJKiBSZW1vdmVzIHRoZSBhdXRvIHNjcm9sbGluZyBmb3IgdG91Y2ggZGV2aWNlcy4NCgkJKi8NCgkJZnVuY3Rpb24gcmVtb3ZlVG91Y2hIYW5kbGVyKCl7DQoJCQlpZihpc1RvdWNoRGV2aWNlIHx8IGlzVG91Y2gpew0KCQkJCS8vTWljcm9zb2Z0IHBvaW50ZXJzDQoJCQkJTVNQb2ludGVyID0gZ2V0TVNQb2ludGVyKCk7DQoNCgkJCQkkKGRvY3VtZW50KS5vZmYoJ3RvdWNoc3RhcnQgJyArIE1TUG9pbnRlci5kb3duKTsNCgkJCQkkKGRvY3VtZW50KS5vZmYoJ3RvdWNobW92ZSAnICsgTVNQb2ludGVyLm1vdmUpOw0KCQkJfQ0KCQl9DQoNCg0KCQkvKg0KCQkqIFJldHVybnMgYW5kIG9iamVjdCB3aXRoIE1pY3Jvc29mdCBwb2ludGVycyAoZm9yIElFPDExIGFuZCBmb3IgSUUgPj0gMTEpDQoJCSogaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL2RuMzA0ODg2KHY9dnMuODUpLmFzcHgNCgkJKi8NCgkJZnVuY3Rpb24gZ2V0TVNQb2ludGVyKCl7DQoJCQl2YXIgcG9pbnRlcjsNCg0KCQkJLy9JRSA+PSAxMQ0KCQkJaWYod2luZG93LlBvaW50ZXJFdmVudCl7DQoJCQkJcG9pbnRlciA9IHsgZG93bjogInBvaW50ZXJkb3duIiwgbW92ZTogInBvaW50ZXJtb3ZlIn07DQoJCQl9DQoNCgkJCS8vSUUgPCAxMQ0KCQkJZWxzZXsNCgkJCQlwb2ludGVyID0geyBkb3duOiAiTVNQb2ludGVyRG93biIsIG1vdmU6ICJNU1BvaW50ZXJNb3ZlIn07DQoJCQl9DQoNCgkJCXJldHVybiBwb2ludGVyOw0KCQl9DQoJCS8qKg0KCQkqIEdldHMgdGhlIHBhZ2VYIGFuZCBwYWdlWSBwcm9wZXJ0aWVzIGRlcGVuZGluZyBvbiB0aGUgYnJvd3Nlci4NCgkJKiBodHRwczovL2dpdGh1Yi5jb20vYWx2YXJvdHJpZ28vZnVsbFBhZ2UuanMvaXNzdWVzLzE5NCNpc3N1ZWNvbW1lbnQtMzQwNjk4NTQNCgkJKi8NCgkJZnVuY3Rpb24gZ2V0RXZlbnRzUGFnZShlKXsNCgkJCXZhciBldmVudHMgPSBuZXcgQXJyYXkoKTsNCgkJCWlmICh3aW5kb3cubmF2aWdhdG9yLm1zUG9pbnRlckVuYWJsZWQpew0KCQkJCWV2ZW50c1sneSddID0gZS5wYWdlWTsNCgkJCQlldmVudHNbJ3gnXSA9IGUucGFnZVg7DQoJCQl9ZWxzZXsNCgkJCQlldmVudHNbJ3knXSA9IGUudG91Y2hlc1swXS5wYWdlWTsNCgkJCQlldmVudHNbJ3gnXSA9ICBlLnRvdWNoZXNbMF0ucGFnZVg7DQoJCQl9DQoNCgkJCXJldHVybiBldmVudHM7DQoJCX0NCg0KCQlmdW5jdGlvbiBzaWxlbnRMYW5kc2NhcGVTY3JvbGwoYWN0aXZlU2xpZGUpew0KCQkJdmFyIHByZXZTY3JvbGxpbmdTcGVlcGQgPSBvcHRpb25zLnNjcm9sbGluZ1NwZWVkOw0KCQkJJC5mbi5mdWxscGFnZS5zZXRTY3JvbGxpbmdTcGVlZCAoMCk7DQoJCQlsYW5kc2NhcGVTY3JvbGwoYWN0aXZlU2xpZGUuY2xvc2VzdCgnLmZwLXNsaWRlcycpLCBhY3RpdmVTbGlkZSk7DQoJCQkkLmZuLmZ1bGxwYWdlLnNldFNjcm9sbGluZ1NwZWVkKHByZXZTY3JvbGxpbmdTcGVlcGQpOw0KCQl9DQoNCgkJZnVuY3Rpb24gc2lsZW50U2Nyb2xsKHRvcCl7DQoJCQlpZiAob3B0aW9ucy5jc3MzKSB7DQoJCQkJdmFyIHRyYW5zbGF0ZTNkID0gJ3RyYW5zbGF0ZTNkKDBweCwgLScgKyB0b3AgKyAncHgsIDBweCknOw0KCQkJCXRyYW5zZm9ybUNvbnRhaW5lcih0cmFuc2xhdGUzZCwgZmFsc2UpOw0KCQkJfQ0KCQkJZWxzZSB7DQoJCQkJY29udGFpbmVyLmNzcygidG9wIiwgLXRvcCk7DQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBnZXRUcmFuc2Zvcm1zKHRyYW5zbGF0ZTNkKXsNCgkJCXJldHVybiB7DQoJCQkJJy13ZWJraXQtdHJhbnNmb3JtJzogdHJhbnNsYXRlM2QsDQoJCQkJJy1tb3otdHJhbnNmb3JtJzogdHJhbnNsYXRlM2QsDQoJCQkJJy1tcy10cmFuc2Zvcm0nOnRyYW5zbGF0ZTNkLA0KCQkJCSd0cmFuc2Zvcm0nOiB0cmFuc2xhdGUzZA0KCQkJfTsNCgkJfQ0KDQoNCgkJLyoNCgkJKiBEZXN0cm95cyBmdWxscGFnZS5qcyBwbHVnaW4gZXZlbnRzIGFuZCBvcHRpbmFsbHkgaXRzIGh0bWwgbWFya3VwIGFuZCBzdHlsZXMNCgkJKi8NCgkJJC5mbi5mdWxscGFnZS5kZXN0cm95ID0gZnVuY3Rpb24oYWxsKXsNCgkJCSQuZm4uZnVsbHBhZ2Uuc2V0QXV0b1Njcm9sbGluZyhmYWxzZSk7DQogCQkJJC5mbi5mdWxscGFnZS5zZXRBbGxvd1Njcm9sbGluZyhmYWxzZSk7DQogCQkJJC5mbi5mdWxscGFnZS5zZXRLZXlib2FyZFNjcm9sbGluZyhmYWxzZSk7DQoNCg0KIAkJCSQod2luZG93KQ0KCQkJCS5vZmYoJ3Njcm9sbCcsIHNjcm9sbEhhbmRsZXIpDQogIAkJCQkub2ZmKCdoYXNoY2hhbmdlJywgaGFzaENoYW5nZUhhbmRsZXIpDQogIAkJCQkub2ZmKCdyZXNpemUnLCByZXNpemVIYW5kbGVyKTsNCg0KCQkJJChkb2N1bWVudCkNCgkJCQkub2ZmKCdjbGljaycsICcjZnAtbmF2IGEnKQ0KCQkJCS5vZmYoJ21vdXNlZW50ZXInLCAnI2ZwLW5hdiBsaScpDQoJCQkJLm9mZignbW91c2VsZWF2ZScsICcjZnAtbmF2IGxpJykNCgkJCQkub2ZmKCdjbGljaycsICcuZnAtc2xpZGVzTmF2IGEnKQ0KICAJCQkJLm9mZignbW91c2VvdmVyJywgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cykNCiAgCQkJCS5vZmYoJ21vdXNlb3V0Jywgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cyk7DQoNCgkJCSQoJy5mcC1zZWN0aW9uJykNCgkJCQkub2ZmKCdjbGljaycsICcuZnAtY29udHJvbEFycm93Jyk7DQoNCgkJCS8vbGV0cyBtYWtlIGEgbWVzcyENCgkJCWlmKGFsbCl7DQoJCQkJZGVzdHJveVN0cnVjdHVyZSgpOw0KCQkJfQ0KIAkJfTsNCg0KIAkJLyoNCgkJKiBSZW1vdmVzIGlubGluZSBzdHlsZXMgYWRkZWQgYnkgZnVsbHBhZ2UuanMNCgkJKi8NCgkJZnVuY3Rpb24gZGVzdHJveVN0cnVjdHVyZSgpew0KCQkJLy9yZXNldGluZyB0aGUgYHRvcGAgb3IgYHRyYW5zbGF0ZWAgcHJvcGVydGllcyB0byAwDQoJIAkJc2lsZW50U2Nyb2xsKDApOw0KDQoJCQkkKCcjZnAtbmF2LCAuZnAtc2xpZGVzTmF2LCAuZnAtY29udHJvbEFycm93JykucmVtb3ZlKCk7DQoNCgkJCS8vcmVtb3ZpbmcgaW5saW5lIHN0eWxlcw0KCQkJJCgnLmZwLXNlY3Rpb24nKS5jc3MoIHsNCgkJCQknaGVpZ2h0JzogJycsDQoJCQkJJ2JhY2tncm91bmQtY29sb3InIDogJycsDQoJCQkJJ3BhZGRpbmcnOiAnJw0KCQkJfSk7DQoNCgkJCSQoJy5mcC1zbGlkZScpLmNzcyggew0KCQkJCSd3aWR0aCc6ICcnDQoJCQl9KTsNCg0KCQkJY29udGFpbmVyLmNzcyh7DQoJIAkJCSdoZWlnaHQnOiAnJywNCgkgCQkJJ3Bvc2l0aW9uJzogJycsDQoJIAkJCSctbXMtdG91Y2gtYWN0aW9uJzogJycsDQoJIAkJCSd0b3VjaC1hY3Rpb24nOiAnJw0KCSAJCX0pOw0KDQoJCQkvL3JlbW92aW5nIGFkZGVkIGNsYXNzZXMNCgkJCSQoJy5mcC1zZWN0aW9uLCAuZnAtc2xpZGUnKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJcmVtb3ZlU2xpbVNjcm9sbCgkKHRoaXMpKTsNCgkJCQkkKHRoaXMpLnJlbW92ZUNsYXNzKCdmcC10YWJsZSBhY3RpdmUnKTsNCgkJCX0pDQoNCgkJCXJlbW92ZUFuaW1hdGlvbihjb250YWluZXIpOw0KCQkJcmVtb3ZlQW5pbWF0aW9uKGNvbnRhaW5lci5maW5kKCcuZnAtZWFzaW5nJykpOw0KDQoJCQkvL1Vud3JhcHBpbmcgY29udGVudA0KCQkJY29udGFpbmVyLmZpbmQoJy5mcC10YWJsZUNlbGwsIC5mcC1zbGlkZXNDb250YWluZXIsIC5mcC1zbGlkZXMnKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJLy91bndyYXAgbm90IGJlaW5nIHVzZSBpbiBjYXNlIHRoZXJlJ3Mgbm8gY2hpbGQgZWxlbWVudCBpbnNpZGUgYW5kIGl0cyBqdXN0IHRleHQNCgkJCQkkKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyk7DQoJCQl9KTsNCg0KCQkJLy9zY3JvbGxpbmcgdGhlIHBhZ2UgdG8gdGhlIHRvcCB3aXRoIG5vIGFuaW1hdGlvbg0KCQkJJCgnaHRtbCwgYm9keScpLnNjcm9sbFRvcCgwKTsNCgkJfQ0KDQoJfTsNCg0KfSkoalF1ZXJ5KTsNCg==",
                "body": "LyoqDQogKiBmdWxsUGFnZSAyLjQuMw0KICogaHR0cHM6Ly9naXRodWIuY29tL2FsdmFyb3RyaWdvL2Z1bGxQYWdlLmpzDQogKiBNSVQgbGljZW5zZWQNCiAqDQogKiBDb3B5cmlnaHQgKEMpIDIwMTMgYWx2YXJvdHJpZ28uY29tIC0gQSBwcm9qZWN0IGJ5IEFsdmFybyBUcmlnbw0KICovDQoNCihmdW5jdGlvbigkKSB7DQoJJC5mbi5mdWxscGFnZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCgkJLy8gQ3JlYXRlIHNvbWUgZGVmYXVsdHMsIGV4dGVuZGluZyB0aGVtIHdpdGggYW55IG9wdGlvbnMgdGhhdCB3ZXJlIHByb3ZpZGVkDQoJCW9wdGlvbnMgPSAkLmV4dGVuZCh7DQoJCQkvL25hdmlnYXRpb24NCgkJCSdtZW51JzogZmFsc2UsDQoJCQknYW5jaG9ycyc6W10sDQoJCQknbmF2aWdhdGlvbic6IGZhbHNlLA0KCQkJJ25hdmlnYXRpb25Qb3NpdGlvbic6ICdyaWdodCcsDQoJCQknbmF2aWdhdGlvbkNvbG9yJzogJyMwMDAnLA0KCQkJJ25hdmlnYXRpb25Ub29sdGlwcyc6IFtdLA0KCQkJJ3NsaWRlc05hdmlnYXRpb24nOiBmYWxzZSwNCgkJCSdzbGlkZXNOYXZQb3NpdGlvbic6ICdib3R0b20nLA0KDQoJCQkvL3Njcm9sbGluZw0KCQkJJ2NzczMnOiBmYWxzZSwNCgkJCSdzY3JvbGxpbmdTcGVlZCc6IDcwMCwNCgkJCSdhdXRvU2Nyb2xsaW5nJzogdHJ1ZSwNCgkJCSdlYXNpbmcnOiAnZWFzZUluUXVhcnQnLA0KCQkJJ2Vhc2luZ2NzczMnOiAnZWFzZScsDQoJCQknbG9vcEJvdHRvbSc6IGZhbHNlLA0KCQkJJ2xvb3BUb3AnOiBmYWxzZSwNCgkJCSdsb29wSG9yaXpvbnRhbCc6IHRydWUsDQoJCQknY29udGludW91c1ZlcnRpY2FsJzogZmFsc2UsDQoJCQknZml0U2VjdGlvbic6IGZhbHNlLA0KCQkJJ25vcm1hbFNjcm9sbEVsZW1lbnRzJzogbnVsbCwNCgkJCSdzY3JvbGxPdmVyZmxvdyc6IGZhbHNlLA0KCQkJJ3RvdWNoU2Vuc2l0aXZpdHknOiA1LA0KCQkJJ25vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZCc6IDUsDQoNCgkJCS8vQWNjZXNzaWJpbGl0eQ0KCQkJJ2tleWJvYXJkU2Nyb2xsaW5nJzogdHJ1ZSwNCgkJCSdhbmltYXRlQW5jaG9yJzogdHJ1ZSwNCg0KCQkJLy9kZXNpZ24NCgkJCSdjb250cm9sQXJyb3dDb2xvcic6ICcjZmZmJywNCgkJCSJ2ZXJ0aWNhbENlbnRlcmVkIjogdHJ1ZSwNCgkJCSdyZXNpemUnOiB0cnVlLA0KCQkJJ3NlY3Rpb25zQ29sb3InIDogW10sDQoJCQkncGFkZGluZ1RvcCc6IDAsDQoJCQkncGFkZGluZ0JvdHRvbSc6IDAsDQoJCQknZml4ZWRFbGVtZW50cyc6IG51bGwsDQoJCQkncmVzcG9uc2l2ZSc6IDAsDQoNCgkJCS8vQ3VzdG9tIHNlbGVjdG9ycw0KCQkJJ3NlY3Rpb25TZWxlY3Rvcic6ICcuc2VjdGlvbicsDQoJCQknc2xpZGVTZWxlY3Rvcic6ICcuc2xpZGUnLA0KDQoNCgkJCS8vZXZlbnRzDQoJCQknYWZ0ZXJMb2FkJzogbnVsbCwNCgkJCSdvbkxlYXZlJzogbnVsbCwNCgkJCSdhZnRlclJlbmRlcic6IG51bGwsDQoJCQknYWZ0ZXJSZXNpemUnOiBudWxsLA0KCQkJJ2FmdGVyUmVCdWlsZCc6IG51bGwsDQoJCQknYWZ0ZXJTbGlkZUxvYWQnOiBudWxsLA0KCQkJJ29uU2xpZGVMZWF2ZSc6IG51bGwNCgkJfSwgb3B0aW9ucyk7DQoNCgkgICAgLy8gRGlzYWJsZSBtdXR1YWxseSBleGNsdXNpdmUgc2V0dGluZ3MNCgkJaWYgKG9wdGlvbnMuY29udGludW91c1ZlcnRpY2FsICYmDQoJCQkob3B0aW9ucy5sb29wVG9wIHx8IG9wdGlvbnMubG9vcEJvdHRvbSkpIHsNCgkJICAgIG9wdGlvbnMuY29udGludW91c1ZlcnRpY2FsID0gZmFsc2U7DQoJCSAgICBjb25zb2xlICYmIGNvbnNvbGUubG9nICYmIGNvbnNvbGUubG9nKCJPcHRpb24gbG9vcFRvcC9sb29wQm90dG9tIGlzIG11dHVhbGx5IGV4Y2x1c2l2ZSB3aXRoIGNvbnRpbnVvdXNWZXJ0aWNhbDsgY29udGludW91c1ZlcnRpY2FsIGRpc2FibGVkIik7DQoJCX0NCg0KCQkvL0RlZmluZXMgdGhlIGRlbGF5IHRvIHRha2UgcGxhY2UgYmVmb3JlIGJlaW5nIGFibGUgdG8gc2Nyb2xsIHRvIHRoZSBuZXh0IHNlY3Rpb24NCgkJLy9CRSBDQVJFRlVMISBOb3QgcmVjb21tZW5lZCB0byBjaGFuZ2UgaXQgdW5kZXIgNDAwIGZvciBhIGdvb2QgYmVoYXZpb3IgaW4gbGFwdG9wcyBhbmQNCgkJLy9BcHBsZSBkZXZpY2VzIChsYXB0b3BzLCBtb3VzZXMuLi4pDQoJCXZhciBzY3JvbGxEZWxheSA9IDYwMDsNCg0KCQkkLmZuLmZ1bGxwYWdlLnNldEF1dG9TY3JvbGxpbmcgPSBmdW5jdGlvbih2YWx1ZSl7DQoJCQlvcHRpb25zLmF1dG9TY3JvbGxpbmcgPSB2YWx1ZTsNCg0KCQkJdmFyIGVsZW1lbnQgPSAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKTsNCg0KCQkJaWYob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCgkJCQkkKCdodG1sLCBib2R5JykuY3NzKHsNCgkJCQkJJ292ZXJmbG93JyA6ICdoaWRkZW4nLA0KCQkJCQknaGVpZ2h0JyA6ICcxMDAlJw0KCQkJCX0pOw0KDQoJCQkJLy9mb3IgSUUgdG91Y2ggZGV2aWNlcw0KCQkJCWNvbnRhaW5lci5jc3Moew0KCQkJCQknLW1zLXRvdWNoLWFjdGlvbic6ICdub25lJywNCgkJCQkJJ3RvdWNoLWFjdGlvbic6ICdub25lJw0KCQkJCX0pOw0KDQoJCQkJaWYoZWxlbWVudC5sZW5ndGgpew0KCQkJCQkvL21vdmluZyB0aGUgY29udGFpbmVyIHVwDQoJCQkJCXNpbGVudFNjcm9sbChlbGVtZW50LnBvc2l0aW9uKCkudG9wKTsNCgkJCQl9DQoNCgkJCX1lbHNlew0KCQkJCSQoJ2h0bWwsIGJvZHknKS5jc3Moew0KCQkJCQknb3ZlcmZsb3cnIDogJ3Zpc2libGUnLA0KCQkJCQknaGVpZ2h0JyA6ICdpbml0aWFsJw0KCQkJCX0pOw0KDQoJCQkJLy9mb3IgSUUgdG91Y2ggZGV2aWNlcw0KCQkJCWNvbnRhaW5lci5jc3Moew0KCQkJCQknLW1zLXRvdWNoLWFjdGlvbic6ICcnLA0KCQkJCQkndG91Y2gtYWN0aW9uJzogJycNCgkJCQl9KTsNCg0KCQkJCXNpbGVudFNjcm9sbCgwKTsNCg0KCQkJCS8vc2Nyb2xsaW5nIHRoZSBwYWdlIHRvIHRoZSBzZWN0aW9uIHdpdGggbm8gYW5pbWF0aW9uDQoJCQkJJCgnaHRtbCwgYm9keScpLnNjcm9sbFRvcChlbGVtZW50LnBvc2l0aW9uKCkudG9wKTsNCgkJCX0NCg0KCQl9Ow0KDQoJCS8qKg0KCQkqIERlZmluZXMgdGhlIHNjcm9sbGluZyBzcGVlZA0KCQkqLw0KCQkkLmZuLmZ1bGxwYWdlLnNldFNjcm9sbGluZ1NwZWVkID0gZnVuY3Rpb24odmFsdWUpew0KCQkgICBvcHRpb25zLnNjcm9sbGluZ1NwZWVkID0gdmFsdWU7DQoJCX07DQoNCgkJLyoqDQoJCSogQWRkcyBvciByZW1vdmUgdGhlIHBvc3NpYmxpdHkgb2Ygc2Nyb2xsaW5nIHRocm91Z2ggc2VjdGlvbnMgYnkgdXNpbmcgdGhlIG1vdXNlIHdoZWVsIG9yIHRoZSB0cmFja3BhZC4NCgkJKi8NCgkJJC5mbi5mdWxscGFnZS5zZXRNb3VzZVdoZWVsU2Nyb2xsaW5nID0gZnVuY3Rpb24gKHZhbHVlKXsNCgkJCWlmKHZhbHVlKXsNCgkJCQlhZGRNb3VzZVdoZWVsSGFuZGxlcigpOw0KCQkJfWVsc2V7DQoJCQkJcmVtb3ZlTW91c2VXaGVlbEhhbmRsZXIoKTsNCgkJCX0NCgkJfTsNCg0KCQkvKioNCgkJKiBBZGRzIG9yIHJlbW92ZSB0aGUgcG9zc2libGl0eSBvZiBzY3JvbGxpbmcgdGhyb3VnaCBzZWN0aW9ucyBieSB1c2luZyB0aGUgbW91c2Ugd2hlZWwvdHJhY2twYWQgb3IgdG91Y2ggZ2VzdHVyZXMuDQoJCSovDQoJCSQuZm4uZnVsbHBhZ2Uuc2V0QWxsb3dTY3JvbGxpbmcgPSBmdW5jdGlvbiAodmFsdWUpew0KCQkJaWYodmFsdWUpew0KCQkJCSQuZm4uZnVsbHBhZ2Uuc2V0TW91c2VXaGVlbFNjcm9sbGluZyh0cnVlKTsNCgkJCQlhZGRUb3VjaEhhbmRsZXIoKTsNCgkJCX1lbHNlew0KCQkJCSQuZm4uZnVsbHBhZ2Uuc2V0TW91c2VXaGVlbFNjcm9sbGluZyhmYWxzZSk7DQoJCQkJcmVtb3ZlVG91Y2hIYW5kbGVyKCk7DQoJCQl9DQoJCX07DQoNCgkJLyoqDQoJCSogQWRkcyBvciByZW1vdmUgdGhlIHBvc3NpYmxpdHkgb2Ygc2Nyb2xsaW5nIHRocm91Z2ggc2VjdGlvbnMgYnkgdXNpbmcgdGhlIGtleWJvYXJkIGFycm93IGtleXMNCgkJKi8NCgkJJC5mbi5mdWxscGFnZS5zZXRLZXlib2FyZFNjcm9sbGluZyA9IGZ1bmN0aW9uICh2YWx1ZSl7DQoJCQlvcHRpb25zLmtleWJvYXJkU2Nyb2xsaW5nID0gdmFsdWU7DQoJCX07DQoNCgkJJC5mbi5mdWxscGFnZS5tb3ZlU2VjdGlvblVwID0gZnVuY3Rpb24oKXsNCgkJCXZhciBwcmV2ID0gJCgnLmZwLXNlY3Rpb24uYWN0aXZlJykucHJldignLmZwLXNlY3Rpb24nKTsNCg0KCQkJLy9sb29waW5nIHRvIHRoZSBib3R0b20gaWYgdGhlcmUncyBubyBtb3JlIHNlY3Rpb25zIGFib3ZlDQoJCQlpZiAoIXByZXYubGVuZ3RoICYmIChvcHRpb25zLmxvb3BUb3AgfHwgb3B0aW9ucy5jb250aW51b3VzVmVydGljYWwpKSB7DQoJCQkJcHJldiA9ICQoJy5mcC1zZWN0aW9uJykubGFzdCgpOw0KCQkJfQ0KDQoJCQlpZiAocHJldi5sZW5ndGgpIHsNCgkJCQlzY3JvbGxQYWdlKHByZXYsIG51bGwsIHRydWUpOw0KCQkJfQ0KCQl9Ow0KDQoJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25Eb3duID0gZnVuY3Rpb24gKCl7DQoJCQl2YXIgbmV4dCA9ICQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLm5leHQoJy5mcC1zZWN0aW9uJyk7DQoNCgkJCS8vbG9vcGluZyB0byB0aGUgdG9wIGlmIHRoZXJlJ3Mgbm8gbW9yZSBzZWN0aW9ucyBiZWxvdw0KCQkJaWYoIW5leHQubGVuZ3RoICYmDQoJCQkJKG9wdGlvbnMubG9vcEJvdHRvbSB8fCBvcHRpb25zLmNvbnRpbnVvdXNWZXJ0aWNhbCkpew0KCQkJCW5leHQgPSAkKCcuZnAtc2VjdGlvbicpLmZpcnN0KCk7DQoJCQl9DQoNCgkJCWlmKG5leHQubGVuZ3RoKXsNCgkJCQlzY3JvbGxQYWdlKG5leHQsIG51bGwsIGZhbHNlKTsNCgkJCX0NCgkJfTsNCg0KCQkkLmZuLmZ1bGxwYWdlLm1vdmVUbyA9IGZ1bmN0aW9uIChzZWN0aW9uLCBzbGlkZSl7DQoJCQl2YXIgZGVzdGlueSA9ICcnOw0KDQoJCQlpZihpc05hTihzZWN0aW9uKSl7DQoJCQkJZGVzdGlueSA9ICQoJ1tkYXRhLWFuY2hvcj0iJytzZWN0aW9uKyciXScpOw0KCQkJfWVsc2V7DQoJCQkJZGVzdGlueSA9ICQoJy5mcC1zZWN0aW9uJykuZXEoIChzZWN0aW9uIC0xKSApOw0KCQkJfQ0KDQoJCQlpZiAodHlwZW9mIHNsaWRlICE9PSAndW5kZWZpbmVkJyl7DQoJCQkJc2Nyb2xsUGFnZUFuZFNsaWRlKHNlY3Rpb24sIHNsaWRlKTsNCgkJCX1lbHNlIGlmKGRlc3RpbnkubGVuZ3RoID4gMCl7DQoJCQkJc2Nyb2xsUGFnZShkZXN0aW55KTsNCgkJCX0NCgkJfTsNCg0KCQkkLmZuLmZ1bGxwYWdlLm1vdmVTbGlkZVJpZ2h0ID0gZnVuY3Rpb24oKXsNCgkJCW1vdmVTbGlkZSgnbmV4dCcpOw0KCQl9Ow0KDQoJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlTGVmdCA9IGZ1bmN0aW9uKCl7DQoJCQltb3ZlU2xpZGUoJ3ByZXYnKTsNCgkJfTsNCg0KCQkvKioNCgkJICogV2hlbiByZXNpemluZyBpcyBmaW5pc2hlZCwgd2UgYWRqdXN0IHRoZSBzbGlkZXMgc2l6ZXMgYW5kIHBvc2l0aW9ucw0KCQkgKi8NCgkJJC5mbi5mdWxscGFnZS5yZUJ1aWxkID0gZnVuY3Rpb24ocmVzaXppbmcpew0KCQkJaXNSZXNpemluZyA9IHRydWU7DQoNCgkJCXZhciB3aW5kb3dzV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTsNCgkJCXdpbmRvd3NIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7DQoNCgkJCS8vdGV4dCBhbmQgaW1hZ2VzIHJlc2l6aW5nDQoJCQlpZiAob3B0aW9ucy5yZXNpemUpIHsNCgkJCQlyZXNpemVNZSh3aW5kb3dzSGVpZ2h0LCB3aW5kb3dzV2lkdGgpOw0KCQkJfQ0KDQoJCQkkKCcuZnAtc2VjdGlvbicpLmVhY2goZnVuY3Rpb24oKXsNCgkJCQl2YXIgc2Nyb2xsSGVpZ2h0ID0gd2luZG93c0hlaWdodCAtIHBhcnNlSW50KCQodGhpcykuY3NzKCdwYWRkaW5nLWJvdHRvbScpKSAtIHBhcnNlSW50KCQodGhpcykuY3NzKCdwYWRkaW5nLXRvcCcpKTsNCg0KCQkJCS8vYWRqdXN0aW5nIHRoZSBoZWlnaHQgb2YgdGhlIHRhYmxlLWNlbGwgZm9yIElFIGFuZCBGaXJlZm94DQoJCQkJaWYob3B0aW9ucy52ZXJ0aWNhbENlbnRlcmVkKXsNCgkJCQkJJCh0aGlzKS5maW5kKCcuZnAtdGFibGVDZWxsJykuY3NzKCdoZWlnaHQnLCBnZXRUYWJsZUhlaWdodCgkKHRoaXMpKSArICdweCcpOw0KCQkJCX0NCg0KCQkJCSQodGhpcykuY3NzKCdoZWlnaHQnLCB3aW5kb3dzSGVpZ2h0ICsgJ3B4Jyk7DQoNCgkJCQkvL3Jlc2l6aW5nIHRoZSBzY3JvbGxpbmcgZGl2cw0KCQkJCWlmKG9wdGlvbnMuc2Nyb2xsT3ZlcmZsb3cpew0KCQkJCQl2YXIgc2xpZGVzID0gJCh0aGlzKS5maW5kKCcuZnAtc2xpZGUnKTsNCg0KCQkJCQlpZihzbGlkZXMubGVuZ3RoKXsNCgkJCQkJCXNsaWRlcy5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJCQkJY3JlYXRlU2xpbVNjcm9sbGluZygkKHRoaXMpKTsNCgkJCQkJCX0pOw0KCQkJCQl9ZWxzZXsNCgkJCQkJCWNyZWF0ZVNsaW1TY3JvbGxpbmcoJCh0aGlzKSk7DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQkvL2FkanVzdGluZyB0aGUgcG9zaXRpb24gZm8gdGhlIEZVTEwgV0lEVEggc2xpZGVzLi4uDQoJCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuZmluZCgnLmZwLXNsaWRlcycpOw0KCQkJCWlmIChzbGlkZXMubGVuZ3RoKSB7DQoJCQkJCWxhbmRzY2FwZVNjcm9sbChzbGlkZXMsIHNsaWRlcy5maW5kKCcuZnAtc2xpZGUuYWN0aXZlJykpOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQkvL2FkanVzdGluZyB0aGUgcG9zaXRpb24gZm9yIHRoZSBjdXJyZW50IHNlY3Rpb24NCgkJCXZhciBkZXN0aW55UG9zID0gJCgnLmZwLXNlY3Rpb24uYWN0aXZlJykucG9zaXRpb24oKTsNCg0KCQkJdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKTsNCg0KCQkJLy9pc24ndCBpdCB0aGUgZmlyc3Qgc2VjdGlvbj8NCgkJCWlmKGFjdGl2ZVNlY3Rpb24uaW5kZXgoJy5mcC1zZWN0aW9uJykpew0KCQkJCXNjcm9sbFBhZ2UoYWN0aXZlU2VjdGlvbik7DQoJCQl9DQoNCgkJCWlzUmVzaXppbmcgPSBmYWxzZTsNCgkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlclJlc2l6ZSApICYmIHJlc2l6aW5nICYmIG9wdGlvbnMuYWZ0ZXJSZXNpemUuY2FsbCggdGhpcyApDQoJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJSZUJ1aWxkICkgJiYgIXJlc2l6aW5nICYmIG9wdGlvbnMuYWZ0ZXJSZUJ1aWxkLmNhbGwoIHRoaXMgKTsNCgkJfQ0KDQoJCS8vZmxhZyB0byBhdm9pZCB2ZXJ5IGZhc3Qgc2xpZGluZyBmb3IgbGFuZHNjYXBlIHNsaWRlcnMNCgkJdmFyIHNsaWRlTW92aW5nID0gZmFsc2U7DQoNCgkJdmFyIGlzVG91Y2hEZXZpY2UgPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC8oaVBob25lfGlQb2R8aVBhZHxBbmRyb2lkfEJsYWNrQmVycnl8QkIxMHxXaW5kb3dzIFBob25lfFRpemVufEJhZGEpLyk7DQoJCXZhciBpc1RvdWNoID0gKCgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cpIHx8IChuYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cyA+IDApKTsNCgkJdmFyIGNvbnRhaW5lciA9ICQodGhpcyk7DQoJCXZhciB3aW5kb3dzSGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpOw0KCQl2YXIgaXNNb3ZpbmcgPSBmYWxzZTsNCgkJdmFyIGlzUmVzaXppbmcgPSBmYWxzZTsNCgkJdmFyIGxhc3RTY3JvbGxlZERlc3Rpbnk7DQoJCXZhciBsYXN0U2Nyb2xsZWRTbGlkZTsNCgkJdmFyIG5hdjsNCgkJdmFyIHdyYXBwZXJTZWxlY3RvciA9ICdmdWxscGFnZS13cmFwcGVyJzsNCg0KCQkkLmZuLmZ1bGxwYWdlLnNldEFsbG93U2Nyb2xsaW5nKHRydWUpOw0KDQoJCS8vaWYgY3NzMyBpcyBub3Qgc3VwcG9ydGVkLCBpdCB3aWxsIHVzZSBqUXVlcnkgYW5pbWF0aW9ucw0KCQlpZihvcHRpb25zLmNzczMpew0KCQkJb3B0aW9ucy5jc3MzID0gc3VwcG9ydDNkKCk7DQoJCX0NCg0KCQlpZigkKHRoaXMpLmxlbmd0aCl7DQoJCQljb250YWluZXIuY3NzKHsNCgkJCQknaGVpZ2h0JzogJzEwMCUnLA0KCQkJCSdwb3NpdGlvbic6ICdyZWxhdGl2ZScNCgkJCX0pOw0KDQoJCQkvL2FkZGluZyBhIGNsYXNzIHRvIHJlY29nbml6ZSB0aGUgY29udGFpbmVyIGludGVybmFsbHkgaW4gdGhlIGNvZGUNCgkJCWNvbnRhaW5lci5hZGRDbGFzcyh3cmFwcGVyU2VsZWN0b3IpOw0KCQl9DQoNCgkJLy90cnlpbmcgdG8gdXNlIGZ1bGxwYWdlIHdpdGhvdXQgYSBzZWxlY3Rvcj8NCgkJZWxzZXsNCgkJCWNvbnNvbGUuZXJyb3IoIkVycm9yISBGdWxscGFnZS5qcyBuZWVkcyB0byBiZSBpbml0aWFsaXplZCB3aXRoIGEgc2VsZWN0b3IuIEZvciBleGFtcGxlOiAkKCcjbXlDb250YWluZXInKS5mdWxscGFnZSgpOyIpOw0KCQl9DQoNCgkJLy9hZGRpbmcgaW50ZXJuYWwgY2xhc3MgbmFtZXMgdG8gdm9pZCBwcm9ibGVtIHdpdGggY29tbW9uIG9uZXMNCgkJJChvcHRpb25zLnNlY3Rpb25TZWxlY3RvcikuZWFjaChmdW5jdGlvbigpew0KICAJCQkkKHRoaXMpLmFkZENsYXNzKCdmcC1zZWN0aW9uJyk7DQoJCX0pOw0KCQkkKG9wdGlvbnMuc2xpZGVTZWxlY3RvcikuZWFjaChmdW5jdGlvbigpew0KICAJCQkkKHRoaXMpLmFkZENsYXNzKCdmcC1zbGlkZScpOw0KCQl9KTsNCg0KCQkvL2NyZWF0aW5nIHRoZSBuYXZpZ2F0aW9uIGRvdHMNCgkJaWYgKG9wdGlvbnMubmF2aWdhdGlvbikgew0KCQkJYWRkVmVydGljYWxOYXZpZ2F0aW9uKCk7DQoJCX0NCg0KCQkkKCcuZnAtc2VjdGlvbicpLmVhY2goZnVuY3Rpb24oaW5kZXgpew0KCQkJdmFyIHRoYXQgPSAkKHRoaXMpOw0KCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuZmluZCgnLmZwLXNsaWRlJyk7DQoJCQl2YXIgbnVtU2xpZGVzID0gc2xpZGVzLmxlbmd0aDsNCg0KCQkJLy9pZiBubyBhY3RpdmUgc2VjdGlvbiBpcyBkZWZpbmVkLCB0aGUgMXN0IG9uZSB3aWxsIGJlIHRoZSBkZWZhdWx0IG9uZQ0KCQkJaWYoIWluZGV4ICYmICQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLmxlbmd0aCA9PT0gMCkgew0KCQkJCSQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJfQ0KDQoJCQkkKHRoaXMpLmNzcygnaGVpZ2h0Jywgd2luZG93c0hlaWdodCArICdweCcpOw0KDQoJCQlpZihvcHRpb25zLnBhZGRpbmdUb3AgfHwgb3B0aW9ucy5wYWRkaW5nQm90dG9tKXsNCgkJCQkkKHRoaXMpLmNzcygncGFkZGluZycsIG9wdGlvbnMucGFkZGluZ1RvcCAgKyAnIDAgJyArIG9wdGlvbnMucGFkZGluZ0JvdHRvbSArICcgMCcpOw0KCQkJfQ0KDQoJCQlpZiAodHlwZW9mIG9wdGlvbnMuc2VjdGlvbnNDb2xvcltpbmRleF0gIT09ICAndW5kZWZpbmVkJykgew0KCQkJCSQodGhpcykuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgb3B0aW9ucy5zZWN0aW9uc0NvbG9yW2luZGV4XSk7DQoJCQl9DQoNCgkJCWlmICh0eXBlb2Ygb3B0aW9ucy5hbmNob3JzW2luZGV4XSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCQkkKHRoaXMpLmF0dHIoJ2RhdGEtYW5jaG9yJywgb3B0aW9ucy5hbmNob3JzW2luZGV4XSk7DQoJCQl9DQoNCgkJCS8vIGlmIHRoZXJlJ3MgYW55IHNsaWRlDQoJCQlpZiAobnVtU2xpZGVzID4gMSkgew0KCQkJCXZhciBzbGlkZXJXaWR0aCA9IG51bVNsaWRlcyAqIDEwMDsNCgkJCQl2YXIgc2xpZGVXaWR0aCA9IDEwMCAvIG51bVNsaWRlczsNCg0KCQkJCXNsaWRlcy53cmFwQWxsKCc8ZGl2IGNsYXNzPSJmcC1zbGlkZXNDb250YWluZXIiIC8+Jyk7DQoJCQkJc2xpZGVzLnBhcmVudCgpLndyYXAoJzxkaXYgY2xhc3M9ImZwLXNsaWRlcyIgLz4nKTsNCg0KCQkJCSQodGhpcykuZmluZCgnLmZwLXNsaWRlc0NvbnRhaW5lcicpLmNzcygnd2lkdGgnLCBzbGlkZXJXaWR0aCArICclJyk7DQoJCQkJJCh0aGlzKS5maW5kKCcuZnAtc2xpZGVzJykuYWZ0ZXIoJzxkaXYgY2xhc3M9ImZwLWNvbnRyb2xBcnJvdyBmcC1wcmV2Ij48L2Rpdj48ZGl2IGNsYXNzPSJmcC1jb250cm9sQXJyb3cgZnAtbmV4dCI+PC9kaXY+Jyk7DQoNCgkJCQlpZihvcHRpb25zLmNvbnRyb2xBcnJvd0NvbG9yIT0nI2ZmZicpew0KCQkJCQkkKHRoaXMpLmZpbmQoJy5mcC1jb250cm9sQXJyb3cuZnAtbmV4dCcpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3RyYW5zcGFyZW50IHRyYW5zcGFyZW50IHRyYW5zcGFyZW50ICcrb3B0aW9ucy5jb250cm9sQXJyb3dDb2xvcik7DQoJCQkJCSQodGhpcykuZmluZCgnLmZwLWNvbnRyb2xBcnJvdy5mcC1wcmV2JykuY3NzKCdib3JkZXItY29sb3InLCAndHJhbnNwYXJlbnQgJysgb3B0aW9ucy5jb250cm9sQXJyb3dDb2xvciArICcgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQnKTsNCgkJCQl9DQoNCgkJCQlpZighb3B0aW9ucy5sb29wSG9yaXpvbnRhbCl7DQoJCQkJCSQodGhpcykuZmluZCgnLmZwLWNvbnRyb2xBcnJvdy5mcC1wcmV2JykuaGlkZSgpOw0KCQkJCX0NCg0KDQoJCQkJaWYob3B0aW9ucy5zbGlkZXNOYXZpZ2F0aW9uKXsNCgkJCQkJYWRkU2xpZGVzTmF2aWdhdGlvbigkKHRoaXMpLCBudW1TbGlkZXMpOw0KCQkJCX0NCg0KCQkJCXNsaWRlcy5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7DQoJCQkJCSQodGhpcykuY3NzKCd3aWR0aCcsIHNsaWRlV2lkdGggKyAnJScpOw0KDQoJCQkJCWlmKG9wdGlvbnMudmVydGljYWxDZW50ZXJlZCl7DQoJCQkJCQlhZGRUYWJsZUNsYXNzKCQodGhpcykpOw0KCQkJCQl9DQoJCQkJfSk7DQoNCgkJCQl2YXIgc3RhcnRpbmdTbGlkZSA9IHRoYXQuZmluZCgnLmZwLXNsaWRlLmFjdGl2ZScpOw0KDQoJCQkJLy9pZiB0aGUgc2xpZGUgd29uI3QgYmUgYW4gc3RhcnRpbmcgcG9pbnQsIHRoZSBkZWZhdWx0IHdpbGwgYmUgdGhlIGZpcnN0IG9uZQ0KCQkJCWlmKHN0YXJ0aW5nU2xpZGUubGVuZ3RoID09IDApew0KCQkJCQlzbGlkZXMuZXEoMCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCX0NCg0KCQkJCS8vaXMgdGhlcmUgYSBzdGFydGluZyBwb2ludCBmb3IgYSBub24tc3RhcnRpbmcgc2VjdGlvbj8NCgkJCQllbHNlew0KCQkJCQlzaWxlbnRMYW5kc2NhcGVTY3JvbGwoc3RhcnRpbmdTbGlkZSk7DQoJCQkJfQ0KDQoJCQl9ZWxzZXsNCgkJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCQlhZGRUYWJsZUNsYXNzKCQodGhpcykpOw0KCQkJCX0NCgkJCX0NCg0KCQl9KS5wcm9taXNlKCkuZG9uZShmdW5jdGlvbigpew0KCQkJJC5mbi5mdWxscGFnZS5zZXRBdXRvU2Nyb2xsaW5nKG9wdGlvbnMuYXV0b1Njcm9sbGluZyk7DQoNCgkJCS8vdGhlIHN0YXJ0aW5nIHBvaW50IGlzIGEgc2xpZGU/DQoJCQl2YXIgYWN0aXZlU2xpZGUgPSAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5maW5kKCcuZnAtc2xpZGUuYWN0aXZlJyk7DQoNCgkJCS8vdGhlIGFjdGl2ZSBzZWN0aW9uIGlzbid0IHRoZSBmaXJzdCBvbmU/IElzIG5vdCB0aGUgZmlyc3Qgc2xpZGUgb2YgdGhlIGZpcnN0IHNlY3Rpb24/IFRoZW4gd2UgbG9hZCB0aGF0IHNlY3Rpb24vc2xpZGUgYnkgZGVmYXVsdC4NCgkJCWlmKCBhY3RpdmVTbGlkZS5sZW5ndGggJiYgICgkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLmZwLXNlY3Rpb24nKSAhPSAwIHx8ICgkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLmZwLXNlY3Rpb24nKSA9PSAwICYmIGFjdGl2ZVNsaWRlLmluZGV4KCkgIT0gMCkpKXsNCgkJCQlzaWxlbnRMYW5kc2NhcGVTY3JvbGwoYWN0aXZlU2xpZGUpOw0KCQkJfQ0KDQoJCQkvL2ZpeGVkIGVsZW1lbnRzIG5lZWQgdG8gYmUgbW92ZWQgb3V0IG9mIHRoZSBwbHVnaW4gY29udGFpbmVyIGR1ZSB0byBwcm9ibGVtcyB3aXRoIENTUzMuDQoJCQlpZihvcHRpb25zLmZpeGVkRWxlbWVudHMgJiYgb3B0aW9ucy5jc3MzKXsNCgkJCQkkKG9wdGlvbnMuZml4ZWRFbGVtZW50cykuYXBwZW5kVG8oJ2JvZHknKTsNCgkJCX0NCg0KCQkJLy92ZXJ0aWNhbCBjZW50ZXJlZCBvZiB0aGUgbmF2aWdhdGlvbiArIGZpcnN0IGJ1bGxldCBhY3RpdmUNCgkJCWlmKG9wdGlvbnMubmF2aWdhdGlvbil7DQoJCQkJbmF2LmNzcygnbWFyZ2luLXRvcCcsICctJyArIChuYXYuaGVpZ2h0KCkvMikgKyAncHgnKTsNCgkJCQluYXYuZmluZCgnbGknKS5lcSgkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5pbmRleCgnLmZwLXNlY3Rpb24nKSkuZmluZCgnYScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCX0NCg0KCQkJLy9tb3ZpbmcgdGhlIG1lbnUgb3V0c2lkZSB0aGUgbWFpbiBjb250YWluZXIgaWYgaXQgaXMgaW5zaWRlIChhdm9pZCBwcm9ibGVtcyB3aXRoIGZpeGVkIHBvc2l0aW9ucyB3aGVuIHVzaW5nIENTUzMgdHJhbmZvcm1zKQ0KCQkJaWYob3B0aW9ucy5tZW51ICYmIG9wdGlvbnMuY3NzMyAmJiAkKG9wdGlvbnMubWVudSkuY2xvc2VzdCgnLmZ1bGxwYWdlLXdyYXBwZXInKS5sZW5ndGgpew0KCQkJCSQob3B0aW9ucy5tZW51KS5hcHBlbmRUbygnYm9keScpOw0KCQkJfQ0KDQoJCQlpZihvcHRpb25zLnNjcm9sbE92ZXJmbG93KXsNCgkJCQlpZihkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiKXsNCgkJCQkJY3JlYXRlU2xpbVNjcm9sbGluZ0hhbmRsZXIoKTsNCgkJCQl9DQoJCQkJLy9hZnRlciBET00gYW5kIGltYWdlcyBhcmUgbG9hZGVkDQoJCQkJJCh3aW5kb3cpLm9uKCdsb2FkJywgY3JlYXRlU2xpbVNjcm9sbGluZ0hhbmRsZXIpOw0KCQkJfWVsc2V7DQoJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyUmVuZGVyICkgJiYgb3B0aW9ucy5hZnRlclJlbmRlci5jYWxsKCB0aGlzKTsNCgkJCX0NCg0KCQkJcmVzcG9uc2l2ZSgpOw0KDQoJCQkvL2dldHRpbmcgdGhlIGFuY2hvciBsaW5rIGluIHRoZSBVUkwgYW5kIGRlbGV0aW5nIHRoZSBgI2ANCgkJCXZhciB2YWx1ZSA9ICB3aW5kb3cubG9jYXRpb24uaGFzaC5yZXBsYWNlKCcjJywgJycpLnNwbGl0KCcvJyk7DQoJCQl2YXIgZGVzdGlueSA9IHZhbHVlWzBdOw0KDQoJCQlpZihkZXN0aW55Lmxlbmd0aCl7DQoJCQkJdmFyIHNlY3Rpb24gPSAkKCdbZGF0YS1hbmNob3I9IicrZGVzdGlueSsnIl0nKTsNCg0KCQkJCWlmKCFvcHRpb25zLmFuaW1hdGVBbmNob3IgJiYgc2VjdGlvbi5sZW5ndGgpew0KDQoJCQkJCWlmKG9wdGlvbnMuYXV0b1Njcm9sbGluZyl7DQoJCQkJCQlzaWxlbnRTY3JvbGwoc2VjdGlvbi5wb3NpdGlvbigpLnRvcCk7DQoJCQkJCX0NCgkJCQkJZWxzZXsNCgkJCQkJCXNpbGVudFNjcm9sbCgwKTsNCg0KCQkJCQkJLy9zY3JvbGxpbmcgdGhlIHBhZ2UgdG8gdGhlIHNlY3Rpb24gd2l0aCBubyBhbmltYXRpb24NCgkJCQkJCSQoJ2h0bWwsIGJvZHknKS5zY3JvbGxUb3Aoc2VjdGlvbi5wb3NpdGlvbigpLnRvcCk7DQoJCQkJCX0NCg0KCQkJCQlhY3RpdmF0ZU1lbnVBbmROYXYoZGVzdGlueSwgbnVsbCk7DQoNCgkJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyTG9hZCApICYmIG9wdGlvbnMuYWZ0ZXJMb2FkLmNhbGwoIHRoaXMsIGRlc3RpbnksIChzZWN0aW9uLmluZGV4KCcuZnAtc2VjdGlvbicpICsgMSkpOw0KDQoJCQkJCS8vdXBkYXRpbmcgdGhlIGFjdGl2ZSBjbGFzcw0KCQkJCQlzZWN0aW9uLmFkZENsYXNzKCdhY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCQl9DQoJCQl9DQoNCg0KCQkJJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7DQoJCQkJc2Nyb2xsVG9BbmNob3IoKTsNCgkJCX0pOw0KDQoJCX0pOw0KDQoNCgkJLyoqDQoJCSogQ3JlYXRlcyBhIHZlcnRpY2FsIG5hdmlnYXRpb24gYmFyLg0KCQkqLw0KCQlmdW5jdGlvbiBhZGRWZXJ0aWNhbE5hdmlnYXRpb24oKXsNCgkJCSQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9ImZwLW5hdiI+PHVsPjwvdWw+PC9kaXY+Jyk7DQoJCQluYXYgPSAkKCcjZnAtbmF2Jyk7DQoNCgkJCW5hdi5jc3MoJ2NvbG9yJywgb3B0aW9ucy5uYXZpZ2F0aW9uQ29sb3IpOw0KCQkJbmF2LmFkZENsYXNzKG9wdGlvbnMubmF2aWdhdGlvblBvc2l0aW9uKTsNCg0KCQkJZm9yKHZhciBjb250ID0gMDsgY29udCA8ICQoJy5mcC1zZWN0aW9uJykubGVuZ3RoOyBjb250Kyspew0KCQkJCXZhciBsaW5rID0gJyc7DQoJCQkJaWYob3B0aW9ucy5hbmNob3JzLmxlbmd0aCl7DQoJCQkJCWxpbmsgPSBvcHRpb25zLmFuY2hvcnNbY29udF07DQoJCQkJfQ0KCQkJCXZhciB0b29sdGlwID0gb3B0aW9ucy5uYXZpZ2F0aW9uVG9vbHRpcHNbY29udF07DQoJCQkJaWYodHlwZW9mIHRvb2x0aXAgPT09ICd1bmRlZmluZWQnKXsNCgkJCQkJdG9vbHRpcCA9ICcnOw0KCQkJCX0NCg0KCQkJCW5hdi5maW5kKCd1bCcpLmFwcGVuZCgnPGxpIGRhdGEtdG9vbHRpcD0iJyArIHRvb2x0aXAgKyAnIj48YSBocmVmPSIjJyArIGxpbmsgKyAnIj48c3Bhbj48L3NwYW4+PC9hPjwvbGk+Jyk7DQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBjcmVhdGVTbGltU2Nyb2xsaW5nSGFuZGxlcigpew0KCQkJJCgnLmZwLXNlY3Rpb24nKS5lYWNoKGZ1bmN0aW9uKCl7DQoJCQkJdmFyIHNsaWRlcyA9ICQodGhpcykuZmluZCgnLmZwLXNsaWRlJyk7DQoNCgkJCQlpZihzbGlkZXMubGVuZ3RoKXsNCgkJCQkJc2xpZGVzLmVhY2goZnVuY3Rpb24oKXsNCgkJCQkJCWNyZWF0ZVNsaW1TY3JvbGxpbmcoJCh0aGlzKSk7DQoJCQkJCX0pOw0KCQkJCX1lbHNlew0KCQkJCQljcmVhdGVTbGltU2Nyb2xsaW5nKCQodGhpcykpOw0KCQkJCX0NCg0KCQkJfSk7DQoJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMuYWZ0ZXJSZW5kZXIgKSAmJiBvcHRpb25zLmFmdGVyUmVuZGVyLmNhbGwoIHRoaXMpOw0KCQl9DQoNCgkJLy9zdG9wIGF1dG9TY3JvbGxpbmcgd2hlbiB0aGUgdXNlciBzY3JvbGxzDQoJCSQoImh0bWwsIGJvZHkiKS5iaW5kKCJzY3JvbGwgbW91c2Vkb3duIERPTU1vdXNlU2Nyb2xsIG1vdXNld2hlZWwga2V5dXAiLCBmdW5jdGlvbigpew0KCQkJaWYoIW9wdGlvbnMuYXV0b1Njcm9sbGluZyAmJiBvcHRpb25zLmZpdFNlY3Rpb24pew0KCQkgICAgCSQoJ2h0bWwsIGJvZHknKS5zdG9wKCk7DQoJCSAgICAJaXNNb3ZpbmcgPSBmYWxzZTsNCgkJICAgIH0NCgkJfSk7DQoNCgkJdmFyIHNjcm9sbElkOw0KCQl2YXIgc2Nyb2xsSWQyOw0KCQl2YXIgaXNTY3JvbGxpbmcgPSBmYWxzZTsNCg0KCQkvL3doZW4gc2Nyb2xsaW5nLi4uDQoJCSQod2luZG93KS5vbignc2Nyb2xsJywgc2Nyb2xsSGFuZGxlcik7DQoNCgkJZnVuY3Rpb24gc2Nyb2xsSGFuZGxlcigpew0KCQkJaWYoIW9wdGlvbnMuYXV0b1Njcm9sbGluZyl7DQoJCQkJdmFyIGN1cnJlbnRTY3JvbGwgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7DQoJCQkJdmFyIHZpc2libGVTZWN0aW9uSW5kZXggPSAwOw0KCQkJCXZhciBpbml0aWFsID0gTWF0aC5hYnMoY3VycmVudFNjcm9sbCAtICQoJy5mcC1zZWN0aW9uJykuZmlyc3QoKS5vZmZzZXQoKS50b3ApOw0KDQoJCQkJLy90YWtpbmcgdGhlIHNlY3Rpb24gd2hpY2ggaXMgc2hvd2luZyBtb3JlIGNvbnRlbnQgaW4gdGhlIHZpZXdwb3J0DQoJCQkJJCgnLmZwLXNlY3Rpb24nKS5lYWNoKGZ1bmN0aW9uKGluZGV4KXsNCgkJCQkJdmFyIGN1cnJlbnQgPSBNYXRoLmFicyhjdXJyZW50U2Nyb2xsIC0gJCh0aGlzKS5vZmZzZXQoKS50b3ApOw0KDQoJCQkJCWlmKGN1cnJlbnQgPCBpbml0aWFsKXsNCgkJCQkJCXZpc2libGVTZWN0aW9uSW5kZXggPSBpbmRleDsNCgkJCQkJCWluaXRpYWwgPSBjdXJyZW50Ow0KCQkJCQl9DQoJCQkJfSk7DQoNCgkJCQkvL2dldGluZyB0aGUgbGFzdCBvbmUsIHRoZSBjdXJyZW50IG9uZSBvbiB0aGUgc2NyZWVuDQoJCQkJdmFyIGN1cnJlbnRTZWN0aW9uID0gJCgnLmZwLXNlY3Rpb24nKS5lcSh2aXNpYmxlU2VjdGlvbkluZGV4KTsNCg0KCQkJCS8vZXhlY3V0aW5nIG9ubHkgb25jZSB0aGUgZmlyc3QgdGltZSB3ZSByZWFjaCB0aGUgc2VjdGlvbg0KCQkJCWlmKCFjdXJyZW50U2VjdGlvbi5oYXNDbGFzcygnYWN0aXZlJykpew0KCQkJCQlpc1Njcm9sbGluZyA9IHRydWU7DQoNCgkJCQkJdmFyIGxlYXZpbmdTZWN0aW9uID0gJCgnLmZwLXNlY3Rpb24uYWN0aXZlJykuaW5kZXgoJy5mcC1zZWN0aW9uJykgKyAxOw0KCQkJCQl2YXIgeU1vdmVtZW50ID0gZ2V0WW1vdmVtZW50KGN1cnJlbnRTZWN0aW9uKTsNCgkJCQkJdmFyIGFuY2hvckxpbmsgID0gY3VycmVudFNlY3Rpb24uZGF0YSgnYW5jaG9yJyk7DQoNCgkJCQkJY3VycmVudFNlY3Rpb24uYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KDQoJCQkJCWlmKCFpc01vdmluZyl7DQoJCQkJCQkkLmlzRnVuY3Rpb24oIG9wdGlvbnMub25MZWF2ZSApICYmIG9wdGlvbnMub25MZWF2ZS5jYWxsKCB0aGlzLCBsZWF2aW5nU2VjdGlvbiwgKGN1cnJlbnRTZWN0aW9uLmluZGV4KCcuZnAtc2VjdGlvbicpICsgMSksIHlNb3ZlbWVudCk7DQoNCgkJCQkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5hZnRlckxvYWQgKSAmJiBvcHRpb25zLmFmdGVyTG9hZC5jYWxsKCB0aGlzLCBhbmNob3JMaW5rLCAoY3VycmVudFNlY3Rpb24uaW5kZXgoJy5mcC1zZWN0aW9uJykgKyAxKSk7DQoJCQkJCX0NCg0KCQkJCQlhY3RpdmF0ZU1lbnVBbmROYXYoYW5jaG9yTGluaywgMCk7DQoNCgkJCQkJaWYob3B0aW9ucy5hbmNob3JzLmxlbmd0aCAmJiAhaXNNb3Zpbmcpew0KCQkJCQkJLy9uZWVkZWQgdG8gZW50ZXIgaW4gaGFzaENoYW5nZSBldmVudCB3aGVuIHVzaW5nIHRoZSBtZW51IHdpdGggYW5jaG9yIGxpbmtzDQoJCQkJCQlsYXN0U2Nyb2xsZWREZXN0aW55ID0gYW5jaG9yTGluazsNCg0KCQkJCQkJbG9jYXRpb24uaGFzaCA9IGFuY2hvckxpbms7DQoJCQkJCX0NCg0KCQkJCQkvL3NtYWxsIHRpbWVvdXQgaW4gb3JkZXIgdG8gYXZvaWQgZW50ZXJpbmcgaW4gaGFzaENoYW5nZSBldmVudCB3aGVuIHNjcm9sbGluZyBpcyBub3QgZmluaXNoZWQgeWV0DQoJCQkJCWNsZWFyVGltZW91dChzY3JvbGxJZCk7DQoJCQkJCXNjcm9sbElkID0gc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkJCQkJaXNTY3JvbGxpbmcgPSBmYWxzZTsNCgkJCQkJfSwgMTAwKTsNCgkJCQl9DQoNCgkJCQlpZihvcHRpb25zLmZpdFNlY3Rpb24pew0KCQkJCQkvL2ZvciB0aGUgYXV0byBhZGp1c3Qgb2YgdGhlIHZpZXdwb3J0IHRvIGZpdCBhIHdob2xlIHNlY3Rpb24NCgkJCQkJY2xlYXJUaW1lb3V0KHNjcm9sbElkMik7DQoJCQkJCXNjcm9sbElkMiA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCQkJCWlmKCFpc01vdmluZyl7DQoJCQkJCQkJc2Nyb2xsUGFnZShjdXJyZW50U2VjdGlvbik7DQoJCQkJCQl9DQoJCQkJCX0sIDEwMDApOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoNCgkJLyoqDQoJCSogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBhY3RpdmUgc2VjdGlvbiBvciBzbGlkZSBpcyBzY3JvbGxhYmxlIHRocm91Z2ggYW5kIHNjcm9sbGluZyBiYXINCgkJKi8NCgkJZnVuY3Rpb24gaXNTY3JvbGxhYmxlKGFjdGl2ZVNlY3Rpb24pew0KCQkJLy9pZiB0aGVyZSBhcmUgbGFuZHNjYXBlIHNsaWRlcywgd2UgY2hlY2sgaWYgdGhlIHNjcm9sbGluZyBiYXIgaXMgaW4gdGhlIGN1cnJlbnQgb25lIG9yIG5vdA0KCQkJaWYoYWN0aXZlU2VjdGlvbi5maW5kKCcuZnAtc2xpZGVzJykubGVuZ3RoKXsNCgkJCQlzY3JvbGxhYmxlPSBhY3RpdmVTZWN0aW9uLmZpbmQoJy5mcC1zbGlkZS5hY3RpdmUnKS5maW5kKCcuZnAtc2Nyb2xsYWJsZScpOw0KCQkJfWVsc2V7DQoJCQkJc2Nyb2xsYWJsZSA9IGFjdGl2ZVNlY3Rpb24uZmluZCgnLmZwLXNjcm9sbGFibGUnKTsNCgkJCX0NCg0KCQkJcmV0dXJuIHNjcm9sbGFibGU7DQoJCX0NCg0KCQkvKioNCgkJKiBEZXRlcm1pbmVzIHRoZSB3YXkgb2Ygc2Nyb2xsaW5nIHVwIG9yIGRvd246DQoJCSogYnkgJ2F1dG9tYXRpY2FsbHknIHNjcm9sbGluZyBhIHNlY3Rpb24gb3IgYnkgdXNpbmcgdGhlIGRlZmF1bHQgYW5kIG5vcm1hbCBzY3JvbGxpbmcuDQoJCSovDQoJCWZ1bmN0aW9uIHNjcm9sbGluZyh0eXBlLCBzY3JvbGxhYmxlKXsNCgkJCWlmKHR5cGUgPT0gJ2Rvd24nKXsNCgkJCQl2YXIgY2hlY2sgPSAnYm90dG9tJzsNCgkJCQl2YXIgc2Nyb2xsU2VjdGlvbiA9ICQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25Eb3duOw0KCQkJfWVsc2V7DQoJCQkJdmFyIGNoZWNrID0gJ3RvcCc7DQoJCQkJdmFyIHNjcm9sbFNlY3Rpb24gPSAkLmZuLmZ1bGxwYWdlLm1vdmVTZWN0aW9uVXA7DQoJCQl9DQoNCgkJCWlmKHNjcm9sbGFibGUubGVuZ3RoID4gMCApew0KCQkJCS8vaXMgdGhlIHNjcm9sbGJhciBhdCB0aGUgc3RhcnQvZW5kIG9mIHRoZSBzY3JvbGw/DQoJCQkJaWYoaXNTY3JvbGxlZChjaGVjaywgc2Nyb2xsYWJsZSkpew0KCQkJCQlzY3JvbGxTZWN0aW9uKCk7DQoJCQkJfWVsc2V7DQoJCQkJCXJldHVybiB0cnVlOw0KCQkJCX0NCgkJCX1lbHNlew0KCQkJCS8vIG1vdmVkIHVwL2Rvd24NCgkJCQlzY3JvbGxTZWN0aW9uKCk7DQoJCQl9DQoJCX0NCg0KDQoJCXZhciB0b3VjaFN0YXJ0WSA9IDA7DQoJCXZhciB0b3VjaFN0YXJ0WCA9IDA7DQoJCXZhciB0b3VjaEVuZFkgPSAwOw0KCQl2YXIgdG91Y2hFbmRYID0gMDsNCg0KCQkvKiBEZXRlY3RpbmcgdG91Y2ggZXZlbnRzDQoNCgkJKiBBcyB3ZSBhcmUgY2hhbmdpbmcgdGhlIHRvcCBwcm9wZXJ0eSBvZiB0aGUgcGFnZSBvbiBzY3JvbGxpbmcsIHdlIGNhbiBub3QgdXNlIHRoZSB0cmFkaXRpb25hbCB3YXkgdG8gZGV0ZWN0IGl0Lg0KCQkqIFRoaXMgd2F5LCB0aGUgdG91Y2hzdGFydCBhbmQgdGhlIHRvdWNoIG1vdmVzIHNob3dzIGFuIHNtYWxsIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGVtIHdoaWNoIGlzIHRoZQ0KCQkqIHVzZWQgb25lIHRvIGRldGVybWluZSB0aGUgZGlyZWN0aW9uLg0KCQkqLw0KCQlmdW5jdGlvbiB0b3VjaE1vdmVIYW5kbGVyKGV2ZW50KXsNCgkJCXZhciBlID0gZXZlbnQub3JpZ2luYWxFdmVudDsNCg0KCQkJLy8gYWRkaXRpb25hbDogaWYgb25lIG9mIHRoZSBub3JtYWxTY3JvbGxFbGVtZW50cyBpc24ndCB3aXRoaW4gb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQgaG9wcyB1cCB0aGUgRE9NIGNoYWluDQoJCQlpZiAoIWNoZWNrUGFyZW50Rm9yTm9ybWFsU2Nyb2xsRWxlbWVudChldmVudC50YXJnZXQpKSB7DQoNCgkJCQlpZihvcHRpb25zLmF1dG9TY3JvbGxpbmcpew0KCQkJCQkvL3ByZXZlbnRpbmcgdGhlIGVhc2luZyBvbiBpT1MgZGV2aWNlcw0KCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCX0NCg0KCQkJCXZhciBhY3RpdmVTZWN0aW9uID0gJCgnLmZwLXNlY3Rpb24uYWN0aXZlJyk7DQoJCQkJdmFyIHNjcm9sbGFibGUgPSBpc1Njcm9sbGFibGUoYWN0aXZlU2VjdGlvbik7DQoNCgkJCQlpZiAoIWlzTW92aW5nICYmICFzbGlkZU1vdmluZykgeyAvL2lmIHRoZXJlcyBhbnkgIw0KCQkJCQl2YXIgdG91Y2hFdmVudHMgPSBnZXRFdmVudHNQYWdlKGUpOw0KCQkJCQl0b3VjaEVuZFkgPSB0b3VjaEV2ZW50c1sneSddOw0KCQkJCQl0b3VjaEVuZFggPSB0b3VjaEV2ZW50c1sneCddOw0KDQoJCQkJCS8vaWYgbW92ZW1lbnQgaW4gdGhlIFggYXh5cyBpcyBncmVhdGVyIHRoYW4gaW4gdGhlIFkgYW5kIHRoZSBjdXJyZWN0IHNlY3Rpb24gaGFzIHNsaWRlcy4uLg0KCQkJCQlpZiAoYWN0aXZlU2VjdGlvbi5maW5kKCcuZnAtc2xpZGVzJykubGVuZ3RoICYmIE1hdGguYWJzKHRvdWNoU3RhcnRYIC0gdG91Y2hFbmRYKSA+IChNYXRoLmFicyh0b3VjaFN0YXJ0WSAtIHRvdWNoRW5kWSkpKSB7DQoNCgkJCQkJICAgIC8vaXMgdGhlIG1vdmVtZW50IGdyZWF0ZXIgdGhhbiB0aGUgbWluaW11bSByZXNpc3RhbmNlIHRvIHNjcm9sbD8NCgkJCQkJICAgIGlmIChNYXRoLmFicyh0b3VjaFN0YXJ0WCAtIHRvdWNoRW5kWCkgPiAoJCh3aW5kb3cpLndpZHRoKCkgLyAxMDAgKiBvcHRpb25zLnRvdWNoU2Vuc2l0aXZpdHkpKSB7DQoJCQkJCSAgICAgICAgaWYgKHRvdWNoU3RhcnRYID4gdG91Y2hFbmRYKSB7DQoJCQkJCSAgICAgICAgICAgICQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlUmlnaHQoKTsgLy9uZXh0DQoJCQkJCSAgICAgICAgfSBlbHNlIHsNCgkJCQkJICAgICAgICAgICAgJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVMZWZ0KCk7IC8vcHJldg0KCQkJCQkgICAgICAgIH0NCgkJCQkJICAgIH0NCgkJCQkJfQ0KDQoJCQkJCS8vdmVydGljYWwgc2Nyb2xsaW5nIChvbmx5IHdoZW4gYXV0b1Njcm9sbGluZyBpcyBlbmFibGVkKQ0KCQkJCQllbHNlIGlmKG9wdGlvbnMuYXV0b1Njcm9sbGluZyl7DQoNCgkJCQkJCS8vaXMgdGhlIG1vdmVtZW50IGdyZWF0ZXIgdGhhbiB0aGUgbWluaW11bSByZXNpc3RhbmNlIHRvIHNjcm9sbD8NCgkJCQkJCWlmIChNYXRoLmFicyh0b3VjaFN0YXJ0WSAtIHRvdWNoRW5kWSkgPiAoJCh3aW5kb3cpLmhlaWdodCgpIC8gMTAwICogb3B0aW9ucy50b3VjaFNlbnNpdGl2aXR5KSkgew0KCQkJCQkJCWlmICh0b3VjaFN0YXJ0WSA+IHRvdWNoRW5kWSkgew0KCQkJCQkJCQlzY3JvbGxpbmcoJ2Rvd24nLCBzY3JvbGxhYmxlKTsNCgkJCQkJCQl9IGVsc2UgaWYgKHRvdWNoRW5kWSA+IHRvdWNoU3RhcnRZKSB7DQoJCQkJCQkJCXNjcm9sbGluZygndXAnLCBzY3JvbGxhYmxlKTsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJfQ0KDQoJCS8qKg0KCQkgKiByZWN1cnNpdmUgZnVuY3Rpb24gdG8gbG9vcCB1cCB0aGUgcGFyZW50IG5vZGVzIHRvIGNoZWNrIGlmIG9uZSBvZiB0aGVtIGV4aXN0cyBpbiBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzDQoJCSAqIEN1cnJlbnRseSB3b3JrcyB3ZWxsIGZvciBpT1MgLSBBbmRyb2lkIG1pZ2h0IG5lZWQgc29tZSB0ZXN0aW5nDQoJCSAqIEBwYXJhbSAge0VsZW1lbnR9IGVsICB0YXJnZXQgZWxlbWVudCAvIGpxdWVyeSBzZWxlY3RvciAoaW4gc3Vic2VxdWVudCBub2RlcykNCgkJICogQHBhcmFtICB7aW50fSAgICAgaG9wIGN1cnJlbnQgaG9wIGNvbXBhcmVkIHRvIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudFRvdWNoVGhyZXNob2xkDQoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgdGhlcmUgaXMgYSBtYXRjaCB0byBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRzDQoJCSAqLw0KCQlmdW5jdGlvbiBjaGVja1BhcmVudEZvck5vcm1hbFNjcm9sbEVsZW1lbnQgKGVsLCBob3ApIHsNCgkJCWhvcCA9IGhvcCB8fCAwOw0KCQkJdmFyIHBhcmVudCA9ICQoZWwpLnBhcmVudCgpOw0KDQoJCQlpZiAoaG9wIDwgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50VG91Y2hUaHJlc2hvbGQgJiYNCgkJCQlwYXJlbnQuaXMob3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cykgKSB7DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9IGVsc2UgaWYgKGhvcCA9PSBvcHRpb25zLm5vcm1hbFNjcm9sbEVsZW1lbnRUb3VjaFRocmVzaG9sZCkgew0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0gZWxzZSB7DQoJCQkJcmV0dXJuIGNoZWNrUGFyZW50Rm9yTm9ybWFsU2Nyb2xsRWxlbWVudChwYXJlbnQsICsraG9wKTsNCgkJCX0NCgkJfQ0KDQoJCWZ1bmN0aW9uIHRvdWNoU3RhcnRIYW5kbGVyKGV2ZW50KXsNCgkJCXZhciBlID0gZXZlbnQub3JpZ2luYWxFdmVudDsNCgkJCXZhciB0b3VjaEV2ZW50cyA9IGdldEV2ZW50c1BhZ2UoZSk7DQoJCQl0b3VjaFN0YXJ0WSA9IHRvdWNoRXZlbnRzWyd5J107DQoJCQl0b3VjaFN0YXJ0WCA9IHRvdWNoRXZlbnRzWyd4J107DQoJCX0NCg0KDQoJCS8qKg0KCQkgKiBEZXRlY3RpbmcgbW91c2V3aGVlbCBzY3JvbGxpbmcNCgkJICoNCgkJICogaHR0cDovL2Jsb2dzLnNpdGVwb2ludHN0YXRpYy5jb20vZXhhbXBsZXMvdGVjaC9tb3VzZS13aGVlbC9pbmRleC5odG1sDQoJCSAqIGh0dHA6Ly93d3cuc2l0ZXBvaW50LmNvbS9odG1sNS1qYXZhc2NyaXB0LW1vdXNlLXdoZWVsLw0KCQkgKi8NCgkJZnVuY3Rpb24gTW91c2VXaGVlbEhhbmRsZXIoZSkgew0KCQkJaWYob3B0aW9ucy5hdXRvU2Nyb2xsaW5nKXsNCgkJCQkvLyBjcm9zcy1icm93c2VyIHdoZWVsIGRlbHRhDQoJCQkJZSA9IHdpbmRvdy5ldmVudCB8fCBlOw0KCQkJCXZhciBkZWx0YSA9IE1hdGgubWF4KC0xLCBNYXRoLm1pbigxLA0KCQkJCQkJKGUud2hlZWxEZWx0YSB8fCAtZS5kZWx0YVkgfHwgLWUuZGV0YWlsKSkpOw0KDQoJCQkJdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKTsNCgkJCQl2YXIgc2Nyb2xsYWJsZSA9IGlzU2Nyb2xsYWJsZShhY3RpdmVTZWN0aW9uKTsNCg0KCQkJCWlmICghaXNNb3ZpbmcpIHsgLy9pZiB0aGVyZXMgYW55ICMNCgkJCQkJLy9zY3JvbGxpbmcgZG93bj8NCgkJCQkJaWYgKGRlbHRhIDwgMCkgew0KCQkJCQkJc2Nyb2xsaW5nKCdkb3duJywgc2Nyb2xsYWJsZSk7DQoNCgkJCQkJLy9zY3JvbGxpbmcgdXA/DQoJCQkJCX1lbHNlIHsNCgkJCQkJCXNjcm9sbGluZygndXAnLCBzY3JvbGxhYmxlKTsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJfQ0KDQoJCWZ1bmN0aW9uIG1vdmVTbGlkZShkaXJlY3Rpb24pew0KCQkgICAgdmFyIGFjdGl2ZVNlY3Rpb24gPSAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKTsNCgkJICAgIHZhciBzbGlkZXMgPSBhY3RpdmVTZWN0aW9uLmZpbmQoJy5mcC1zbGlkZXMnKTsNCg0KCQkgICAgLy8gbW9yZSB0aGFuIG9uZSBzbGlkZSBuZWVkZWQgYW5kIG5vdGhpbmcgc2hvdWxkIGJlIHNsaWRpbmcNCgkJCWlmICghc2xpZGVzLmxlbmd0aCB8fCBzbGlkZU1vdmluZykgew0KCQkJICAgIHJldHVybjsNCgkJCX0NCg0KCQkgICAgdmFyIGN1cnJlbnRTbGlkZSA9IHNsaWRlcy5maW5kKCcuZnAtc2xpZGUuYWN0aXZlJyk7DQoJCSAgICB2YXIgZGVzdGlueSA9IG51bGw7DQoNCgkJICAgIGlmKGRpcmVjdGlvbiA9PT0gJ3ByZXYnKXsNCgkJICAgICAgICBkZXN0aW55ID0gY3VycmVudFNsaWRlLnByZXYoJy5mcC1zbGlkZScpOw0KCQkgICAgfWVsc2V7DQoJCSAgICAgICAgZGVzdGlueSA9IGN1cnJlbnRTbGlkZS5uZXh0KCcuZnAtc2xpZGUnKTsNCgkJICAgIH0NCg0KCQkgICAgLy9pc24ndCB0aGVyZSBhIG5leHQgc2xpZGUgaW4gdGhlIHNlY3VlbmNlPw0KCQkJaWYoIWRlc3RpbnkubGVuZ3RoKXsNCgkJCQkvL3Jlc3BlY3QgbG9vcEhvcml6b250YWwgc2V0dGluDQoJCQkJaWYgKCFvcHRpb25zLmxvb3BIb3Jpem9udGFsKSByZXR1cm47DQoNCgkJCSAgICBpZihkaXJlY3Rpb24gPT09ICdwcmV2Jyl7DQoJCQkgICAgICAgIGRlc3RpbnkgPSBjdXJyZW50U2xpZGUuc2libGluZ3MoJzpsYXN0Jyk7DQoJCQkgICAgfWVsc2V7DQoJCQkgICAgICAgIGRlc3RpbnkgPSBjdXJyZW50U2xpZGUuc2libGluZ3MoJzpmaXJzdCcpOw0KCQkJICAgIH0NCgkJCX0NCg0KCQkgICAgc2xpZGVNb3ZpbmcgPSB0cnVlOw0KDQoJCSAgICBsYW5kc2NhcGVTY3JvbGwoc2xpZGVzLCBkZXN0aW55KTsNCgkJfQ0KDQoJCS8qKg0KCQkqIE1haW50YWlucyB0aGUgYWN0aXZlIHNsaWRlcyBpbiB0aGUgdmlld3BvcnQNCgkJKiAoQmVjYXVzZSBoZSBgc2Nyb2xsYCBhbmltYXRpb24gbWlnaHQgZ2V0IGxvc3Qgd2l0aCBzb21lIGFjdGlvbnMsIHN1Y2ggYXMgd2hlbiB1c2luZyBjb250aW51b3VzVmVydGljYWwpDQoJCSovDQoJCWZ1bmN0aW9uIGtlZXBTbGlkZXNQb3NpdGlvbigpew0KCQkJJCgnLmZwLXNsaWRlLmFjdGl2ZScpLmVhY2goZnVuY3Rpb24oKXsNCgkJCQlzaWxlbnRMYW5kc2NhcGVTY3JvbGwoJCh0aGlzKSk7DQoJCQl9KTsNCgkJfQ0KDQoJCS8qKg0KCQkqIFNjcm9sbHMgdGhlIHNpdGUgdG8gdGhlIGdpdmVuIGVsZW1lbnQgYW5kIHNjcm9sbHMgdG8gdGhlIHNsaWRlIGlmIGEgY2FsbGJhY2sgaXMgZ2l2ZW4uDQoJCSovDQoJCWZ1bmN0aW9uIHNjcm9sbFBhZ2UoZWxlbWVudCwgY2FsbGJhY2ssIGlzTW92ZW1lbnRVcCl7DQoJCQl2YXIgZGVzdCA9IGVsZW1lbnQucG9zaXRpb24oKTsNCgkJCWlmKHR5cGVvZiBkZXN0ID09PSAidW5kZWZpbmVkIil7IHJldHVybjsgfSAvL3RoZXJlJ3Mgbm8gZWxlbWVudCB0byBzY3JvbGwsIGxlYXZpbmcgdGhlIGZ1bmN0aW9uDQoNCgkJCS8vbG9jYWwgdmFyaWFibGVzDQoJCQl2YXIgdiA9IHsNCgkJCQllbGVtZW50OiBlbGVtZW50LA0KCQkJCWNhbGxiYWNrOiBjYWxsYmFjaywNCgkJCQlpc01vdmVtZW50VXA6IGlzTW92ZW1lbnRVcCwNCgkJCQlkZXN0OiBkZXN0LA0KCQkJCWR0b3A6IGRlc3QudG9wLA0KCQkJCXlNb3ZlbWVudDogZ2V0WW1vdmVtZW50KGVsZW1lbnQpLA0KCQkJCWFuY2hvckxpbms6IGVsZW1lbnQuZGF0YSgnYW5jaG9yJyksDQoJCQkJc2VjdGlvbkluZGV4OiBlbGVtZW50LmluZGV4KCcuZnAtc2VjdGlvbicpLA0KCQkJCWFjdGl2ZVNsaWRlOiBlbGVtZW50LmZpbmQoJy5mcC1zbGlkZS5hY3RpdmUnKSwNCgkJCQlhY3RpdmVTZWN0aW9uOiAkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKSwNCgkJCQlsZWF2aW5nU2VjdGlvbjogJCgnLmZwLXNlY3Rpb24uYWN0aXZlJykuaW5kZXgoJy5mcC1zZWN0aW9uJykgKyAxLA0KDQoJCQkJLy9jYWNoaW5nIHRoZSB2YWx1ZSBvZiBpc1Jlc2l6aW5nIGF0IHRoZSBtb21tZW50IHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQNCgkJCQkvL2JlY2F1c2UgaXQgd2lsbCBiZSBjaGVja2VkIGxhdGVyIGluc2lkZSBhIHNldFRpbWVvdXQgYW5kIHRoZSB2YWx1ZSBtaWdodCBjaGFuZ2UNCgkJCQlsb2NhbElzUmVzaXppbmc6IGlzUmVzaXppbmcNCgkJCX07DQoNCgkJCS8vcXVpdGluZyB3aGVuIGFjdGl2ZVNlY3Rpb24gaXMgdGhlIHRhcmdldCBlbGVtZW50DQoJCQlpZih2LmFjdGl2ZVNlY3Rpb24uaXMoZWxlbWVudCkgJiYgIWlzUmVzaXppbmcpeyByZXR1cm47IH0NCg0KCQkJaWYodi5hY3RpdmVTbGlkZS5sZW5ndGgpew0KCQkJCXZhciBzbGlkZUFuY2hvckxpbmsgPSB2LmFjdGl2ZVNsaWRlLmRhdGEoJ2FuY2hvcicpOw0KCQkJCXZhciBzbGlkZUluZGV4ID0gdi5hY3RpdmVTbGlkZS5pbmRleCgpOw0KCQkJfQ0KDQoJCQkvLyBJZiBjb250aW51b3VzVmVydGljYWwgJiYgd2UgbmVlZCB0byB3cmFwIGFyb3VuZA0KCQkJaWYgKG9wdGlvbnMuYXV0b1Njcm9sbGluZyAmJiBvcHRpb25zLmNvbnRpbnVvdXNWZXJ0aWNhbCAmJiB0eXBlb2YgKHYuaXNNb3ZlbWVudFVwKSAhPT0gInVuZGVmaW5lZCIgJiYNCgkJCQkoKCF2LmlzTW92ZW1lbnRVcCAmJiB2LnlNb3ZlbWVudCA9PSAndXAnKSB8fCAvLyBJbnRlbmRpbmcgdG8gc2Nyb2xsIGRvd24gYnV0IGFib3V0IHRvIGdvIHVwIG9yDQoJCQkJKHYuaXNNb3ZlbWVudFVwICYmIHYueU1vdmVtZW50ID09ICdkb3duJykpKSB7IC8vIGludGVuZGluZyB0byBzY3JvbGwgdXAgYnV0IGFib3V0IHRvIGdvIGRvd24NCg0KCQkJCXYgPSBjcmVhdGVJbmZpbml0ZVNlY3Rpb25zKHYpOw0KCQkJfQ0KDQoJCQllbGVtZW50LmFkZENsYXNzKCdhY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCg0KCQkJLy9wcmV2ZW50aW5nIGZyb20gYWN0aXZhdGluZyB0aGUgTW91c2VXaGVlbEhhbmRsZXIgZXZlbnQNCgkJCS8vbW9yZSB0aGFuIG9uY2UgaWYgdGhlIHBhZ2UgaXMgc2Nyb2xsaW5nDQoJCQlpc01vdmluZyA9IHRydWU7DQoNCgkJCWlmKHR5cGVvZiB2LmFuY2hvckxpbmsgIT09ICd1bmRlZmluZWQnKXsNCgkJCQlzZXRVUkxIYXNoKHNsaWRlSW5kZXgsIHNsaWRlQW5jaG9yTGluaywgdi5hbmNob3JMaW5rKTsNCgkJCX0NCg0KCQkJLy9jYWxsYmFjayAob25MZWF2ZSkgaWYgdGhlIHNpdGUgaXMgbm90IGp1c3QgcmVzaXppbmcgYW5kIHJlYWRqdXN0aW5nIHRoZSBzbGlkZXMNCgkJCSQuaXNGdW5jdGlvbihvcHRpb25zLm9uTGVhdmUpICYmICF2LmxvY2FsSXNSZXNpemluZyAmJiBvcHRpb25zLm9uTGVhdmUuY2FsbCh0aGlzLCB2LmxlYXZpbmdTZWN0aW9uLCAodi5zZWN0aW9uSW5kZXggKyAxKSwgdi55TW92ZW1lbnQpOw0KDQoJCQlwZXJmb3JtTW92ZW1lbnQodik7DQoNCgkJCS8vZmxhZyB0byBhdm9pZCBjYWxsaW5nbiBgc2Nyb2xsUGFnZSgpYCB0d2ljZSBpbiBjYXNlIG9mIHVzaW5nIGFuY2hvciBsaW5rcw0KCQkJbGFzdFNjcm9sbGVkRGVzdGlueSA9IHYuYW5jaG9yTGluazsNCg0KCQkJLy9hdm9pZCBmaXJpbmcgaXQgdHdpY2UgKGFzIGl0IGRvZXMgYWxzbyBvbiBzY3JvbGwpDQoJCQlpZihvcHRpb25zLmF1dG9TY3JvbGxpbmcpew0KCQkJCWFjdGl2YXRlTWVudUFuZE5hdih2LmFuY2hvckxpbmssIHYuc2VjdGlvbkluZGV4KQ0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSogUGVyZm9ybXMgdGhlIG1vdmVtZW50IChieSBDU1MzIG9yIGJ5IGpRdWVyeSkNCgkJKi8NCgkJZnVuY3Rpb24gcGVyZm9ybU1vdmVtZW50KHYpew0KCQkJLy8gdXNpbmcgQ1NTMyB0cmFuc2xhdGUgZnVuY3Rpb25hbGl0eQ0KCQkJaWYgKG9wdGlvbnMuY3NzMyAmJiBvcHRpb25zLmF1dG9TY3JvbGxpbmcpIHsNCg0KCQkJCXZhciB0cmFuc2xhdGUzZCA9ICd0cmFuc2xhdGUzZCgwcHgsIC0nICsgdi5kdG9wICsgJ3B4LCAwcHgpJzsNCgkJCQl0cmFuc2Zvcm1Db250YWluZXIodHJhbnNsYXRlM2QsIHRydWUpOw0KDQoJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJCWFmdGVyU2VjdGlvbkxvYWRzKHYpOw0KCQkJCX0sIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQpOw0KCQkJfQ0KDQoJCQkvLyB1c2luZyBqUXVlcnkgYW5pbWF0ZQ0KCQkJZWxzZSB7DQoJCQkJdmFyIHNjcm9sbFNldHRpbmdzID0gZ2V0U2Nyb2xsU2V0dGluZ3Modik7DQoNCgkJCQkkKHNjcm9sbFNldHRpbmdzLmVsZW1lbnQpLmFuaW1hdGUoDQoJCQkJCXNjcm9sbFNldHRpbmdzLm9wdGlvbnMNCgkJCQksIG9wdGlvbnMuc2Nyb2xsaW5nU3BlZWQsIG9wdGlvbnMuZWFzaW5nKS5wcm9taXNlKCkuZG9uZShmdW5jdGlvbiAoKSB7IC8vb25seSBvbmUgc2luZ2xlIGNhbGxiYWNrIGluIGNhc2Ugb2YgYW5pbWF0aW5nICBgaHRtbCwgYm9keWANCgkJCQkJYWZ0ZXJTZWN0aW9uTG9hZHModik7DQoJCQkJfSk7DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJKiBHZXRzIHRoZSBzY3JvbGxpbmcgc2V0dGluZ3MgZGVwZW5kaW5nIG9uIHRoZSBwbHVnaW4gYXV0b1Njcm9sbGluZyBvcHRpb24NCgkJKi8NCgkJZnVuY3Rpb24gZ2V0U2Nyb2xsU2V0dGluZ3Modil7DQoJCQl2YXIgc2Nyb2xsID0ge307DQoNCgkJCWlmKG9wdGlvbnMuYXV0b1Njcm9sbGluZyl7DQoJCQkJc2Nyb2xsLm9wdGlvbnMgPSB7ICd0b3AnOiAtdi5kdG9wfTsNCgkJCQlzY3JvbGwuZWxlbWVudCA9ICcuJyt3cmFwcGVyU2VsZWN0b3I7DQoJCQl9ZWxzZXsNCgkJCQlzY3JvbGwub3B0aW9ucyA9IHsgJ3Njcm9sbFRvcCc6IHYuZHRvcH07DQoJCQkJc2Nyb2xsLmVsZW1lbnQgPSAnaHRtbCwgYm9keSc7DQoJCQl9DQoNCgkJCXJldHVybiBzY3JvbGw7DQoJCX0NCg0KCQkvKioNCgkJKiBBZGRzIHNlY3Rpb25zIGJlZm9yZSBvciBhZnRlciB0aGUgY3VycmVudCBvbmUgdG8gY3JlYXRlIHRoZSBpbmZpbml0ZSBlZmZlY3QuDQoJCSovDQoJCWZ1bmN0aW9uIGNyZWF0ZUluZmluaXRlU2VjdGlvbnModil7DQoJCQkvLyBTY3JvbGxpbmcgZG93bg0KCQkJaWYgKCF2LmlzTW92ZW1lbnRVcCkgew0KCQkJCS8vIE1vdmUgYWxsIHByZXZpb3VzIHNlY3Rpb25zIHRvIGFmdGVyIHRoZSBhY3RpdmUgc2VjdGlvbg0KCQkJCSQoIi5mcC1zZWN0aW9uLmFjdGl2ZSIpLmFmdGVyKHYuYWN0aXZlU2VjdGlvbi5wcmV2QWxsKCIuZnAtc2VjdGlvbiIpLmdldCgpLnJldmVyc2UoKSk7DQoJCQl9DQoJCQllbHNlIHsgLy8gU2Nyb2xsaW5nIHVwDQoJCQkJLy8gTW92ZSBhbGwgbmV4dCBzZWN0aW9ucyB0byBiZWZvcmUgdGhlIGFjdGl2ZSBzZWN0aW9uDQoJCQkJJCgiLmZwLXNlY3Rpb24uYWN0aXZlIikuYmVmb3JlKHYuYWN0aXZlU2VjdGlvbi5uZXh0QWxsKCIuZnAtc2VjdGlvbiIpKTsNCgkJCX0NCg0KCQkJLy8gTWFpbnRhaW4gdGhlIGRpc3BsYXllZCBwb3NpdGlvbiAobm93IHRoYXQgd2UgY2hhbmdlZCB0aGUgZWxlbWVudCBvcmRlcikNCgkJCXNpbGVudFNjcm9sbCgkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5wb3NpdGlvbigpLnRvcCk7DQoNCgkJCS8vIE1haW50YWluIHRoZSBhY3RpdmUgc2xpZGVzIHZpc2libGUgaW4gdGhlIHZpZXdwb3J0DQoJCQlrZWVwU2xpZGVzUG9zaXRpb24oKTsNCg0KCQkJLy8gc2F2ZSBmb3IgbGF0ZXIgdGhlIGVsZW1lbnRzIHRoYXQgc3RpbGwgbmVlZCB0byBiZSByZW9yZGVyZWQNCgkJCXYud3JhcEFyb3VuZEVsZW1lbnRzID0gdi5hY3RpdmVTZWN0aW9uOw0KDQoJCQkvLyBSZWNhbGN1bGF0ZSBhbmltYXRpb24gdmFyaWFibGVzDQoJCQl2LmRlc3QgPSB2LmVsZW1lbnQucG9zaXRpb24oKTsNCgkJCXYuZHRvcCA9IHYuZGVzdC50b3A7DQoJCQl2LnlNb3ZlbWVudCA9IGdldFltb3ZlbWVudCh2LmVsZW1lbnQpOw0KDQoJCQlyZXR1cm4gdjsNCgkJfQ0KDQoJCS8qKg0KCQkqIEZpeCBzZWN0aW9uIG9yZGVyIGFmdGVyIGNvbnRpbnVvdXNWZXJ0aWNhbCBjaGFuZ2VzIGhhdmUgYmVlbiBhbmltYXRlZA0KCQkqLw0KCQlmdW5jdGlvbiBjb250aW51b3VzVmVydGljYWxGaXhTZWN0aW9uT3JkZXIgKHYpIHsNCgkJCS8vIElmIGNvbnRpbnVvdXNWZXJ0aWNhbCBpcyBpbiBlZmZlY3QgKGFuZCBhdXRvU2Nyb2xsaW5nIHdvdWxkIGFsc28gYmUgaW4gZWZmZWN0IHRoZW4pLA0KCQkJLy8gZmluaXNoIG1vdmluZyB0aGUgZWxlbWVudHMgYXJvdW5kIHNvIHRoZSBkaXJlY3QgbmF2aWdhdGlvbiB3aWxsIGZ1bmN0aW9uIG1vcmUgc2ltcGx5DQoJCQlpZiAoIXYud3JhcEFyb3VuZEVsZW1lbnRzIHx8ICF2LndyYXBBcm91bmRFbGVtZW50cy5sZW5ndGgpIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCWlmICh2LmlzTW92ZW1lbnRVcCkgew0KCQkJCSQoJy5mcC1zZWN0aW9uOmZpcnN0JykuYmVmb3JlKHYud3JhcEFyb3VuZEVsZW1lbnRzKTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCSQoJy5mcC1zZWN0aW9uOmxhc3QnKS5hZnRlcih2LndyYXBBcm91bmRFbGVtZW50cyk7DQoJCQl9DQoNCgkJCXNpbGVudFNjcm9sbCgkKCcuZnAtc2VjdGlvbi5hY3RpdmUnKS5wb3NpdGlvbigpLnRvcCk7DQoNCgkJCS8vIE1haW50YWluIHRoZSBhY3RpdmUgc2xpZGVzIHZpc2libGUgaW4gdGhlIHZpZXdwb3J0DQoJCQlrZWVwU2xpZGVzUG9zaXRpb24oKTsNCgkJfTsNCg0KDQoJCS8qKg0KCQkqIEFjdGlvbnMgdG8gZG8gb25jZSB0aGUgc2VjdGlvbiBpcyBsb2FkZWQNCgkJKi8NCgkJZnVuY3Rpb24gYWZ0ZXJTZWN0aW9uTG9hZHMgKHYpew0KCQkJY29udGludW91c1ZlcnRpY2FsRml4U2VjdGlvbk9yZGVyKHYpOw0KCQkJLy9jYWxsYmFjayAoYWZ0ZXJMb2FkKSBpZiB0aGUgc2l0ZSBpcyBub3QganVzdCByZXNpemluZyBhbmQgcmVhZGp1c3RpbmcgdGhlIHNsaWRlcw0KCQkJJC5pc0Z1bmN0aW9uKG9wdGlvbnMuYWZ0ZXJMb2FkKSAmJiAhdi5sb2NhbElzUmVzaXppbmcgJiYgb3B0aW9ucy5hZnRlckxvYWQuY2FsbCh0aGlzLCB2LmFuY2hvckxpbmssICh2LnNlY3Rpb25JbmRleCArIDEpKTsNCg0KCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJaXNNb3ZpbmcgPSBmYWxzZTsNCgkJCQkkLmlzRnVuY3Rpb24odi5jYWxsYmFjaykgJiYgdi5jYWxsYmFjay5jYWxsKHRoaXMpOw0KCQkJfSwgc2Nyb2xsRGVsYXkpOw0KCQl9DQoNCg0KCQkvKioNCgkJKiBTY3JvbGxzIHRvIHRoZSBhbmNob3IgaW4gdGhlIFVSTCB3aGVuIGxvYWRpbmcgdGhlIHNpdGUNCgkJKi8NCgkJZnVuY3Rpb24gc2Nyb2xsVG9BbmNob3IoKXsNCgkJCS8vZ2V0dGluZyB0aGUgYW5jaG9yIGxpbmsgaW4gdGhlIFVSTCBhbmQgZGVsZXRpbmcgdGhlIGAjYA0KCQkJdmFyIHZhbHVlID0gIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCAnJykuc3BsaXQoJy8nKTsNCgkJCXZhciBzZWN0aW9uID0gdmFsdWVbMF07DQoJCQl2YXIgc2xpZGUgPSB2YWx1ZVsxXTsNCg0KCQkJaWYoc2VjdGlvbil7ICAvL2lmIHRoZXJlcyBhbnkgIw0KCQkJCXNjcm9sbFBhZ2VBbmRTbGlkZShzZWN0aW9uLCBzbGlkZSk7DQoJCQl9DQoJCX0NCg0KCQkvL2RldGVjdGluZyBhbnkgY2hhbmdlIG9uIHRoZSBVUkwgdG8gc2Nyb2xsIHRvIHRoZSBnaXZlbiBhbmNob3IgbGluaw0KCQkvLyhhIHdheSB0byBkZXRlY3QgYmFjayBoaXN0b3J5IGJ1dHRvbiBhcyB3ZSBwbGF5IHdpdGggdGhlIGhhc2hlcyBvbiB0aGUgVVJMKQ0KCQkkKHdpbmRvdykub24oJ2hhc2hjaGFuZ2UnLCBoYXNoQ2hhbmdlSGFuZGxlcik7DQoNCgkJZnVuY3Rpb24gaGFzaENoYW5nZUhhbmRsZXIoKXsNCgkJCWlmKCFpc1Njcm9sbGluZyl7DQoJCQkJdmFyIHZhbHVlID0gIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoJyMnLCAnJykuc3BsaXQoJy8nKTsNCgkJCQl2YXIgc2VjdGlvbiA9IHZhbHVlWzBdOw0KCQkJCXZhciBzbGlkZSA9IHZhbHVlWzFdOw0KDQoJCQkJaWYoc2VjdGlvbi5sZW5ndGgpew0KCQkJCQkvL3doZW4gbW92aW5nIHRvIGEgc2xpZGUgaW4gdGhlIGZpcnN0IHNlY3Rpb24gZm9yIHRoZSBmaXJzdCB0aW1lIChmaXJzdCB0aW1lIHRvIGFkZCBhbiBhbmNob3IgdG8gdGhlIFVSTCkNCgkJCQkJdmFyIGlzRmlyc3RTbGlkZU1vdmUgPSAgKHR5cGVvZiBsYXN0U2Nyb2xsZWREZXN0aW55ID09PSAndW5kZWZpbmVkJyk7DQoJCQkJCXZhciBpc0ZpcnN0U2Nyb2xsTW92ZSA9ICh0eXBlb2YgbGFzdFNjcm9sbGVkRGVzdGlueSA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHNsaWRlID09PSAndW5kZWZpbmVkJyAmJiAhc2xpZGVNb3ZpbmcpOw0KDQoJCQkJCS8qaW4gb3JkZXIgdG8gY2FsbCBzY3JvbGxwYWdlKCkgb25seSBvbmNlIGZvciBlYWNoIGRlc3RpbmF0aW9uIGF0IGEgdGltZQ0KCQkJCQlJdCBpcyBjYWxsZWQgdHdpY2UgZm9yIGVhY2ggc2Nyb2xsIG90aGVyd2lzZSwgYXMgaW4gY2FzZSBvZiB1c2luZyBhbmNob3JsaW5rcyBgaGFzaENoYW5nZWANCgkJCQkJZXZlbnQgaXMgZmlyZWQgb24gZXZlcnkgc2Nyb2xsIHRvby4qLw0KCQkJCQlpZiAoKHNlY3Rpb24gJiYgc2VjdGlvbiAhPT0gbGFzdFNjcm9sbGVkRGVzdGlueSkgJiYgIWlzRmlyc3RTbGlkZU1vdmUgfHwgaXNGaXJzdFNjcm9sbE1vdmUgfHwgKCFzbGlkZU1vdmluZyAmJiBsYXN0U2Nyb2xsZWRTbGlkZSAhPSBzbGlkZSApKSAgew0KCQkJCQkJc2Nyb2xsUGFnZUFuZFNsaWRlKHNlY3Rpb24sIHNsaWRlKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoNCgkJLyoqDQoJCSAqIFNsaWRpbmcgd2l0aCBhcnJvdyBrZXlzLCBib3RoLCB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbA0KCQkgKi8NCgkJJChkb2N1bWVudCkua2V5ZG93bihmdW5jdGlvbihlKSB7DQoJCQkvL01vdmluZyB0aGUgbWFpbiBwYWdlIHdpdGggdGhlIGtleWJvYXJkIGFycm93cyBpZiBrZXlib2FyZCBzY3JvbGxpbmcgaXMgZW5hYmxlZA0KCQkJaWYgKG9wdGlvbnMua2V5Ym9hcmRTY3JvbGxpbmcgJiYgIWlzTW92aW5nKSB7DQoJCQkJc3dpdGNoIChlLndoaWNoKSB7DQoJCQkJCS8vdXANCgkJCQkJY2FzZSAzODoNCgkJCQkJY2FzZSAzMzoNCgkJCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNlY3Rpb25VcCgpOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJLy9kb3duDQoJCQkJCWNhc2UgNDA6DQoJCQkJCWNhc2UgMzQ6DQoJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTZWN0aW9uRG93bigpOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJLy9Ib21lDQoJCQkJCWNhc2UgMzY6DQoJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVUbygxKTsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCS8vRW5kDQoJCQkJCWNhc2UgMzU6DQoJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVUbyggJCgnLmZwLXNlY3Rpb24nKS5sZW5ndGggKTsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCS8vbGVmdA0KCQkJCQljYXNlIDM3Og0KCQkJCQkJJC5mbi5mdWxscGFnZS5tb3ZlU2xpZGVMZWZ0KCk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQkvL3JpZ2h0DQoJCQkJCWNhc2UgMzk6DQoJCQkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTbGlkZVJpZ2h0KCk7DQoJCQkJCQlicmVhazsNCg0KCQkJCQlkZWZhdWx0Og0KCQkJCQkJcmV0dXJuOyAvLyBleGl0IHRoaXMgaGFuZGxlciBmb3Igb3RoZXIga2V5cw0KCQkJCX0NCgkJCX0NCgkJfSk7DQoNCgkJLyoqDQoJCSogU2Nyb2xscyB0byB0aGUgc2VjdGlvbiB3aGVuIGNsaWNraW5nIHRoZSBuYXZpZ2F0aW9uIGJ1bGxldA0KCQkqLw0KCQkkKGRvY3VtZW50KS5vbignY2xpY2sgdG91Y2hzdGFydCcsICcjZnAtbmF2IGEnLCBmdW5jdGlvbihlKXsNCgkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCXZhciBpbmRleCA9ICQodGhpcykucGFyZW50KCkuaW5kZXgoKTsNCgkJCXNjcm9sbFBhZ2UoJCgnLmZwLXNlY3Rpb24nKS5lcShpbmRleCkpOw0KCQl9KTsNCg0KCQkvKioNCgkJKiBTY3JvbGxzIHRoZSBzbGlkZXIgdG8gdGhlIGdpdmVuIHNsaWRlIGRlc3RpbmF0aW9uIGZvciB0aGUgZ2l2ZW4gc2VjdGlvbg0KCQkqLw0KCQkkKGRvY3VtZW50KS5vbignY2xpY2sgdG91Y2hzdGFydCcsICcuZnAtc2xpZGVzTmF2IGEnLCBmdW5jdGlvbihlKXsNCgkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCXZhciBzbGlkZXMgPSAkKHRoaXMpLmNsb3Nlc3QoJy5mcC1zZWN0aW9uJykuZmluZCgnLmZwLXNsaWRlcycpOw0KCQkJdmFyIGRlc3RpbnkgPSBzbGlkZXMuZmluZCgnLmZwLXNsaWRlJykuZXEoJCh0aGlzKS5jbG9zZXN0KCdsaScpLmluZGV4KCkpOw0KDQoJCQlsYW5kc2NhcGVTY3JvbGwoc2xpZGVzLCBkZXN0aW55KTsNCgkJfSk7DQoNCg0KCQkvL25hdmlnYXRpb24gdG9vbHRpcHMNCgkJJChkb2N1bWVudCkub24oew0KCQkJbW91c2VlbnRlcjogZnVuY3Rpb24oKXsNCgkJCQl2YXIgdG9vbHRpcCA9ICQodGhpcykuZGF0YSgndG9vbHRpcCcpOw0KCQkJCSQoJzxkaXYgY2xhc3M9ImZwLXRvb2x0aXAgJyArIG9wdGlvbnMubmF2aWdhdGlvblBvc2l0aW9uICsnIj4nICsgdG9vbHRpcCArICc8L2Rpdj4nKS5oaWRlKCkuYXBwZW5kVG8oJCh0aGlzKSkuZmFkZUluKDIwMCk7DQoJCQl9LA0KCQkJbW91c2VsZWF2ZTogZnVuY3Rpb24oKXsNCgkJCQkkKHRoaXMpLmZpbmQoJy5mcC10b29sdGlwJykuZmFkZU91dCgyMDAsIGZ1bmN0aW9uKCkgew0KCQkJCQkkKHRoaXMpLnJlbW92ZSgpOw0KCQkJCX0pOw0KCQkJfQ0KCQl9LCAnI2ZwLW5hdiBsaScpOw0KDQoNCgkJaWYob3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cyl7DQoJCQkkKGRvY3VtZW50KS5vbignbW91c2VlbnRlcicsIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMsIGZ1bmN0aW9uICgpIHsNCgkJCQkkLmZuLmZ1bGxwYWdlLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcoZmFsc2UpOw0KCQkJfSk7DQoNCgkJCSQoZG9jdW1lbnQpLm9uKCdtb3VzZWxlYXZlJywgb3B0aW9ucy5ub3JtYWxTY3JvbGxFbGVtZW50cywgZnVuY3Rpb24oKXsNCgkJCQkkLmZuLmZ1bGxwYWdlLnNldE1vdXNlV2hlZWxTY3JvbGxpbmcodHJ1ZSk7DQoJCQl9KTsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBTY3JvbGxpbmcgaG9yaXpvbnRhbGx5IHdoZW4gY2xpY2tpbmcgb24gdGhlIHNsaWRlciBjb250cm9scy4NCgkJICovDQoJCSQoJy5mcC1zZWN0aW9uJykub24oJ2NsaWNrIHRvdWNoc3RhcnQnLCAnLmZwLWNvbnRyb2xBcnJvdycsIGZ1bmN0aW9uKCkgew0KCQkJaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2ZwLXByZXYnKSkgew0KCQkJCSQuZm4uZnVsbHBhZ2UubW92ZVNsaWRlTGVmdCgpOw0KCQkJfSBlbHNlIHsNCgkJCQkkLmZuLmZ1bGxwYWdlLm1vdmVTbGlkZVJpZ2h0KCk7DQoJCQl9DQoJCX0pOw0KDQoJCS8qKg0KCQkqIFNjcm9sbHMgaG9yaXpvbnRhbCBzbGlkZXJzLg0KCQkqLw0KCQlmdW5jdGlvbiBsYW5kc2NhcGVTY3JvbGwoc2xpZGVzLCBkZXN0aW55KXsNCgkJCXZhciBkZXN0aW55UG9zID0gZGVzdGlueS5wb3NpdGlvbigpOw0KCQkJdmFyIHNsaWRlc0NvbnRhaW5lciA9IHNsaWRlcy5maW5kKCcuZnAtc2xpZGVzQ29udGFpbmVyJykucGFyZW50KCk7DQoJCQl2YXIgc2xpZGVJbmRleCA9IGRlc3RpbnkuaW5kZXgoKTsNCgkJCXZhciBzZWN0aW9uID0gc2xpZGVzLmNsb3Nlc3QoJy5mcC1zZWN0aW9uJyk7DQoJCQl2YXIgc2VjdGlvbkluZGV4ID0gc2VjdGlvbi5pbmRleCgnLmZwLXNlY3Rpb24nKTsNCgkJCXZhciBhbmNob3JMaW5rID0gc2VjdGlvbi5kYXRhKCdhbmNob3InKTsNCgkJCXZhciBzbGlkZXNOYXYgPSBzZWN0aW9uLmZpbmQoJy5mcC1zbGlkZXNOYXYnKTsNCgkJCXZhciBzbGlkZUFuY2hvciA9IGRlc3RpbnkuZGF0YSgnYW5jaG9yJyk7DQoNCgkJCS8vY2FjaGluZyB0aGUgdmFsdWUgb2YgaXNSZXNpemluZyBhdCB0aGUgbW9tbWVudCB0aGUgZnVuY3Rpb24gaXMgY2FsbGVkDQoJCQkvL2JlY2F1c2UgaXQgd2lsbCBiZSBjaGVja2VkIGxhdGVyIGluc2lkZSBhIHNldFRpbWVvdXQgYW5kIHRoZSB2YWx1ZSBtaWdodCBjaGFuZ2UNCgkJCXZhciBsb2NhbElzUmVzaXppbmcgPSBpc1Jlc2l6aW5nOw0KDQoJCQlpZihvcHRpb25zLm9uU2xpZGVMZWF2ZSl7DQoJCQkJdmFyIHByZXZTbGlkZUluZGV4ID0gc2VjdGlvbi5maW5kKCcuZnAtc2xpZGUuYWN0aXZlJykuaW5kZXgoKTsNCgkJCQl2YXIgeE1vdmVtZW50ID0gZ2V0WG1vdmVtZW50KHByZXZTbGlkZUluZGV4LCBzbGlkZUluZGV4KTsNCg0KCQkJCS8vaWYgdGhlIHNpdGUgaXMgbm90IGp1c3QgcmVzaXppbmcgYW5kIHJlYWRqdXN0aW5nIHRoZSBzbGlkZXMNCgkJCQlpZighbG9jYWxJc1Jlc2l6aW5nICYmIHhNb3ZlbWVudCE9PSdub25lJyl7DQoJCQkJCSQuaXNGdW5jdGlvbiggb3B0aW9ucy5vblNsaWRlTGVhdmUgKSAmJiBvcHRpb25zLm9uU2xpZGVMZWF2ZS5jYWxsKCB0aGlzLCBhbmNob3JMaW5rLCAoc2VjdGlvbkluZGV4ICsgMSksIHByZXZTbGlkZUluZGV4LCB4TW92ZW1lbnQpOw0KCQkJCX0NCgkJCX0NCg0KCQkJZGVzdGlueS5hZGRDbGFzcygnYWN0aXZlJykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoNCg0KCQkJaWYodHlwZW9mIHNsaWRlQW5jaG9yID09PSAndW5kZWZpbmVkJyl7DQoJCQkJc2xpZGVBbmNob3IgPSBzbGlkZUluZGV4Ow0KCQkJfQ0KDQoJCQlpZighb3B0aW9ucy5sb29wSG9yaXpvbnRhbCl7DQoJCQkJLy9oaWRkaW5nIGl0IGZvciB0aGUgZmlzdCBzbGlkZSwgc2hvd2luZyBmb3IgdGhlIHJlc3QNCgkJCQlzZWN0aW9uLmZpbmQoJy5mcC1jb250cm9sQXJyb3cuZnAtcHJldicpLnRvZ2dsZShzbGlkZUluZGV4IT0wKTsNCg0KCQkJCS8vaGlkZGluZyBpdCBmb3IgdGhlIGxhc3Qgc2xpZGUsIHNob3dpbmcgZm9yIHRoZSByZXN0DQoJCQkJc2VjdGlvbi5maW5kKCcuZnAtY29udHJvbEFycm93LmZwLW5leHQnKS50b2dnbGUoIWRlc3RpbnkuaXMoJzpsYXN0LWNoaWxkJykpOw0KCQkJfQ0KDQoJCQkvL29ubHkgY2hhbmdpbmcgdGhlIFVSTCBpZiB0aGUgc2xpZGVzIGFyZSBpbiB0aGUgY3VycmVudCBzZWN0aW9uIChub3QgZm9yIHJlc2l6ZSByZS1hZGp1c3RpbmcpDQoJCQlpZihzZWN0aW9uLmhhc0NsYXNzKCdhY3RpdmUnKSl7DQoJCQkJc2V0VVJMSGFzaChzbGlkZUluZGV4LCBzbGlkZUFuY2hvciwgYW5jaG9yTGluayk7DQoJCQl9DQoNCgkJCXZhciBhZnRlclNsaWRlTG9hZHMgPSBmdW5jdGlvbigpew0KCQkJCS8vaWYgdGhlIHNpdGUgaXMgbm90IGp1c3QgcmVzaXppbmcgYW5kIHJlYWRqdXN0aW5nIHRoZSBzbGlkZXMNCgkJCQlpZighbG9jYWxJc1Jlc2l6aW5nKXsNCgkJCQkJJC5pc0Z1bmN0aW9uKCBvcHRpb25zLmFmdGVyU2xpZGVMb2FkICkgJiYgb3B0aW9ucy5hZnRlclNsaWRlTG9hZC5jYWxsKCB0aGlzLCBhbmNob3JMaW5rLCAoc2VjdGlvbkluZGV4ICsgMSksIHNsaWRlQW5jaG9yLCBzbGlkZUluZGV4KTsNCgkJCQl9DQoJCQkJLy9sZXR0aW5nIHRoZW0gc2xpZGUgYWdhaW4NCgkJCQlzbGlkZU1vdmluZyA9IGZhbHNlOw0KCQkJfTsNCg0KCQkJaWYob3B0aW9ucy5jc3MzKXsNCgkJCQl2YXIgdHJhbnNsYXRlM2QgPSAndHJhbnNsYXRlM2QoLScgKyBkZXN0aW55UG9zLmxlZnQgKyAncHgsIDBweCwgMHB4KSc7DQoNCgkJCQlhZGRBbmltYXRpb24oc2xpZGVzLmZpbmQoJy5mcC1zbGlkZXNDb250YWluZXInKSwgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZD4wKS5jc3MoZ2V0VHJhbnNmb3Jtcyh0cmFuc2xhdGUzZCkpOw0KDQoJCQkJc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkJCQlhZnRlclNsaWRlTG9hZHMoKTsNCgkJCQl9LCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkLCBvcHRpb25zLmVhc2luZyk7DQoJCQl9ZWxzZXsNCgkJCQlzbGlkZXNDb250YWluZXIuYW5pbWF0ZSh7DQoJCQkJCXNjcm9sbExlZnQgOiBkZXN0aW55UG9zLmxlZnQNCgkJCQl9LCBvcHRpb25zLnNjcm9sbGluZ1NwZWVkLCBvcHRpb25zLmVhc2luZywgZnVuY3Rpb24oKSB7DQoNCgkJCQkJYWZ0ZXJTbGlkZUxvYWRzKCk7DQoJCQkJfSk7DQoJCQl9DQoNCgkJCXNsaWRlc05hdi5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJc2xpZGVzTmF2LmZpbmQoJ2xpJykuZXEoc2xpZGVJbmRleCkuZmluZCgnYScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJfQ0KDQoJICAgIC8vd2hlbiByZXNpemluZyB0aGUgc2l0ZSwgd2UgYWRqdXN0IHRoZSBoZWlnaHRzIG9mIHRoZSBzZWN0aW9ucywgc2xpbVNjcm9sbC4uLg0KCSAgICAkKHdpbmRvdykucmVzaXplKHJlc2l6ZUhhbmRsZXIpOw0KDQoJICAgIHZhciByZXNpemVJZDsNCgkgICAgZnVuY3Rpb24gcmVzaXplSGFuZGxlcigpew0KCSAgICAJLy9jaGVja2luZyBpZiBpdCBuZWVkcyB0byBnZXQgcmVzcG9uc2l2ZQ0KCSAgICAJcmVzcG9uc2l2ZSgpOw0KDQoJICAgIAkvLyByZWJ1aWxkIGltbWVkaWF0ZWx5IG9uIHRvdWNoIGRldmljZXMNCgkJCWlmIChpc1RvdWNoRGV2aWNlKSB7DQoNCgkJCQkvL2lmIHRoZSBrZXlib2FyZCBpcyB2aXNpYmxlDQoJCQkJaWYgKCQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkuYXR0cigndHlwZScpICE9PSAndGV4dCcpIHsNCgkJICAgICAgICAJJC5mbi5mdWxscGFnZS5yZUJ1aWxkKHRydWUpOw0KCQkgICAgICAgIH0NCgkgICAgICAJfWVsc2V7DQoJICAgICAgCQkvL2luIG9yZGVyIHRvIGNhbGwgdGhlIGZ1bmN0aW9ucyBvbmx5IHdoZW4gdGhlIHJlc2l6ZSBpcyBmaW5pc2hlZA0KCSAgICAJCS8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy80Mjk4NjEyL2pxdWVyeS1ob3ctdG8tY2FsbC1yZXNpemUtZXZlbnQtb25seS1vbmNlLWl0cy1maW5pc2hlZC1yZXNpemluZw0KCSAgICAgIAkJY2xlYXJUaW1lb3V0KHJlc2l6ZUlkKTsNCg0KCSAgICAgICAgCXJlc2l6ZUlkID0gc2V0VGltZW91dChmdW5jdGlvbigpew0KCSAgICAgICAgCQkkLmZuLmZ1bGxwYWdlLnJlQnVpbGQodHJ1ZSk7DQoJICAgICAgICAJfSwgNTAwKTsNCgkgICAgICAJfQ0KCSAgICB9DQoNCgkgICAgLyoqDQoJICAgICogQ2hlY2tzIGlmIHRoZSBzaXRlIG5lZWRzIHRvIGdldCByZXNwb25zaXZlIGFuZCBkaXNhYmxlcyBhdXRvU2Nyb2xsaW5nIGlmIHNvLg0KCSAgICAqIEEgY2xhc3MgYGZwLXJlc3BvbnNpdmVgIGlzIGFkZGVkIHRvIHRoZSBwbHVnaW4ncyBjb250YWluZXIgaW4gY2FzZSB0aGUgdXNlciB3YW50cyB0byB1c2UgaXQgZm9yIGhpcyBvd24gcmVzcG9uc2l2ZSBDU1MuDQoJICAgICovDQoJICAgIGZ1bmN0aW9uIHJlc3BvbnNpdmUoKXsNCgkgICAgCWlmKG9wdGlvbnMucmVzcG9uc2l2ZSl7DQoJICAgIAkJdmFyIGlzUmVzcG9uc2l2ZSA9IGNvbnRhaW5lci5oYXNDbGFzcygnZnAtcmVzcG9uc2l2ZScpOw0KCSAgICAJCWlmICgkKHdpbmRvdykud2lkdGgoKSA8IG9wdGlvbnMucmVzcG9uc2l2ZSApew0KCSAgICAJCQlpZighaXNSZXNwb25zaXZlKXsNCgkgICAgCQkJCSQuZm4uZnVsbHBhZ2Uuc2V0QXV0b1Njcm9sbGluZyhmYWxzZSk7DQoJICAgIAkJCQkkKCcjZnAtbmF2JykuaGlkZSgpOw0KCQkJCQkJY29udGFpbmVyLmFkZENsYXNzKCdmcC1yZXNwb25zaXZlJyk7DQoJICAgIAkJCX0NCgkgICAgCQl9ZWxzZSBpZihpc1Jlc3BvbnNpdmUpew0KCSAgICAJCQkkLmZuLmZ1bGxwYWdlLnNldEF1dG9TY3JvbGxpbmcodHJ1ZSk7DQoJICAgIAkJCSQoJyNmcC1uYXYnKS5zaG93KCk7DQoJCQkJCWNvbnRhaW5lci5yZW1vdmVDbGFzcygnZnAtcmVzcG9uc2l2ZScpOw0KCSAgICAJCX0NCgkgICAgCX0NCgkgICAgfQ0KDQoJICAgIC8qKg0KCQkqIFRvb2dsZXMgdHJhbnNpdGlvbiBhbmltYXRpb25zIGZvciB0aGUgZ2l2ZW4gZWxlbWVudA0KCQkqLw0KCQlmdW5jdGlvbiBhZGRBbmltYXRpb24oZWxlbWVudCwgYWRkaW5nKXsNCgkJCXZhciB0cmFuc2l0aW9uID0gJ2FsbCAnICsgb3B0aW9ucy5zY3JvbGxpbmdTcGVlZCArICdtcyAnICsgb3B0aW9ucy5lYXNpbmdjc3MzOw0KDQoJCQlpZihhZGRpbmcpew0KCQkJCWVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2ZwLW5vdHJhbnNpdGlvbicpOw0KCQkJCXJldHVybiBlbGVtZW50LmNzcyh7DQoJCQkJCSctd2Via2l0LXRyYW5zaXRpb24nOiB0cmFuc2l0aW9uLA0KICAgICAgICAgCQkJJ3RyYW5zaXRpb24nOiB0cmFuc2l0aW9uDQogICAgICAgICAgIAkJfSk7DQoJCQl9DQoNCgkJCS8vcmVtb3ZpbmcgdGhlIGFuaW1hdGlvbg0KCQkJcmV0dXJuIHJlbW92ZUFuaW1hdGlvbihlbGVtZW50KTsNCgkJfQ0KDQoJCS8qKg0KCQkqIFJlbW92ZSB0cmFuc2l0aW9uIGFuaW1hdGlvbnMgZm9yIHRoZSBnaXZlbiBlbGVtZW50DQoJCSovDQoJCWZ1bmN0aW9uIHJlbW92ZUFuaW1hdGlvbihlbGVtZW50KXsNCgkJCXJldHVybiBlbGVtZW50LmFkZENsYXNzKCdmcC1ub3RyYW5zaXRpb24nKTsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBSZXNpemluZyBvZiB0aGUgZm9udCBzaXplIGRlcGVuZGluZyBvbiB0aGUgd2luZG93IHNpemUgYXMgd2VsbCBhcyBzb21lIG9mIHRoZSBpbWFnZXMgb24gdGhlIHNpdGUuDQoJCSAqLw0KCQlmdW5jdGlvbiByZXNpemVNZShkaXNwbGF5SGVpZ2h0LCBkaXNwbGF5V2lkdGgpIHsNCgkJCS8vU3RhbmRhcmQgZGltZW5zaW9ucywgZm9yIHdoaWNoIHRoZSBib2R5IGZvbnQgc2l6ZSBpcyBjb3JyZWN0DQoJCQl2YXIgcHJlZmVycmVkSGVpZ2h0ID0gODI1Ow0KCQkJdmFyIHByZWZlcnJlZFdpZHRoID0gOTAwOw0KDQoJCQlpZiAoZGlzcGxheUhlaWdodCA8IHByZWZlcnJlZEhlaWdodCB8fCBkaXNwbGF5V2lkdGggPCBwcmVmZXJyZWRXaWR0aCkgew0KCQkJCXZhciBoZWlnaHRQZXJjZW50YWdlID0gKGRpc3BsYXlIZWlnaHQgKiAxMDApIC8gcHJlZmVycmVkSGVpZ2h0Ow0KCQkJCXZhciB3aWR0aFBlcmNlbnRhZ2UgPSAoZGlzcGxheVdpZHRoICogMTAwKSAvIHByZWZlcnJlZFdpZHRoOw0KCQkJCXZhciBwZXJjZW50YWdlID0gTWF0aC5taW4oaGVpZ2h0UGVyY2VudGFnZSwgd2lkdGhQZXJjZW50YWdlKTsNCgkJCQl2YXIgbmV3Rm9udFNpemUgPSBwZXJjZW50YWdlLnRvRml4ZWQoMik7DQoNCgkJCQkkKCJib2R5IikuY3NzKCJmb250LXNpemUiLCBuZXdGb250U2l6ZSArICclJyk7DQoJCQl9IGVsc2Ugew0KCQkJCSQoImJvZHkiKS5jc3MoImZvbnQtc2l6ZSIsICcxMDAlJyk7DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJICogQWN0aXZhdGluZyB0aGUgd2Vic2l0ZSBuYXZpZ2F0aW9uIGRvdHMgYWNjb3JkaW5nIHRvIHRoZSBnaXZlbiBzbGlkZSBuYW1lLg0KCQkgKi8NCgkJZnVuY3Rpb24gYWN0aXZhdGVOYXZEb3RzKG5hbWUsIHNlY3Rpb25JbmRleCl7DQoJCQlpZihvcHRpb25zLm5hdmlnYXRpb24pew0KCQkJCSQoJyNmcC1uYXYnKS5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCWlmKG5hbWUpew0KCQkJCQkkKCcjZnAtbmF2JykuZmluZCgnYVtocmVmPSIjJyArIG5hbWUgKyAnIl0nKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQkJfWVsc2V7DQoJCQkJCSQoJyNmcC1uYXYnKS5maW5kKCdsaScpLmVxKHNlY3Rpb25JbmRleCkuZmluZCgnYScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJICogQWN0aXZhdGluZyB0aGUgd2Vic2l0ZSBtYWluIG1lbnUgZWxlbWVudHMgYWNjb3JkaW5nIHRvIHRoZSBnaXZlbiBzbGlkZSBuYW1lLg0KCQkgKi8NCgkJZnVuY3Rpb24gYWN0aXZhdGVNZW51RWxlbWVudChuYW1lKXsNCgkJCWlmKG9wdGlvbnMubWVudSl7DQoJCQkJJChvcHRpb25zLm1lbnUpLmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQkJJChvcHRpb25zLm1lbnUpLmZpbmQoJ1tkYXRhLW1lbnVhbmNob3I9IicrbmFtZSsnIl0nKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBhY3RpdmF0ZU1lbnVBbmROYXYoYW5jaG9yLCBpbmRleCl7DQoJCQlhY3RpdmF0ZU1lbnVFbGVtZW50KGFuY2hvcik7DQoJCQlhY3RpdmF0ZU5hdkRvdHMoYW5jaG9yLCBpbmRleCk7DQoJCX0NCg0KCQkvKioNCgkJKiBSZXR1cm4gYSBib29sZWFuIGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSBzY3JvbGxhYmxlIGVsZW1lbnQgaXMgYXQgdGhlIGVuZCBvciBhdCB0aGUgc3RhcnQgb2YgdGhlIHNjcm9sbGluZw0KCQkqIGRlcGVuZGluZyBvbiB0aGUgZ2l2ZW4gdHlwZS4NCgkJKi8NCgkJZnVuY3Rpb24gaXNTY3JvbGxlZCh0eXBlLCBzY3JvbGxhYmxlKXsNCgkJCWlmKHR5cGUgPT09ICd0b3AnKXsNCgkJCQlyZXR1cm4gIXNjcm9sbGFibGUuc2Nyb2xsVG9wKCk7DQoJCQl9ZWxzZSBpZih0eXBlID09PSAnYm90dG9tJyl7DQoJCQkJcmV0dXJuIHNjcm9sbGFibGUuc2Nyb2xsVG9wKCkgKyAxICsgc2Nyb2xsYWJsZS5pbm5lckhlaWdodCgpID49IHNjcm9sbGFibGVbMF0uc2Nyb2xsSGVpZ2h0Ow0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSogUmV0dW5zIGB1cGAgb3IgYGRvd25gIGRlcGVuZGluZyBvbiB0aGUgc2Nyb2xsaW5nIG1vdmVtZW50IHRvIHJlYWNoIGl0cyBkZXN0aW5hdGlvbg0KCQkqIGZyb20gdGhlIGN1cnJlbnQgc2VjdGlvbi4NCgkJKi8NCgkJZnVuY3Rpb24gZ2V0WW1vdmVtZW50KGRlc3Rpbnkpew0KCQkJdmFyIGZyb21JbmRleCA9ICQoJy5mcC1zZWN0aW9uLmFjdGl2ZScpLmluZGV4KCcuZnAtc2VjdGlvbicpOw0KCQkJdmFyIHRvSW5kZXggPSBkZXN0aW55LmluZGV4KCcuZnAtc2VjdGlvbicpOw0KDQoJCQlpZihmcm9tSW5kZXggPiB0b0luZGV4KXsNCgkJCQlyZXR1cm4gJ3VwJzsNCgkJCX0NCgkJCXJldHVybiAnZG93bic7DQoJCX0NCg0KCQkvKioNCgkJKiBSZXR1bnMgYHJpZ2h0YCBvciBgbGVmdGAgZGVwZW5kaW5nIG9uIHRoZSBzY3JvbGxpbmcgbW92ZW1lbnQgdG8gcmVhY2ggaXRzIGRlc3RpbmF0aW9uDQoJCSogZnJvbSB0aGUgY3VycmVudCBzbGlkZS4NCgkJKi8NCgkJZnVuY3Rpb24gZ2V0WG1vdmVtZW50KGZyb21JbmRleCwgdG9JbmRleCl7DQoJCQlpZiggZnJvbUluZGV4ID09IHRvSW5kZXgpew0KCQkJCXJldHVybiAnbm9uZScNCgkJCX0NCgkJCWlmKGZyb21JbmRleCA+IHRvSW5kZXgpew0KCQkJCXJldHVybiAnbGVmdCc7DQoJCQl9DQoJCQlyZXR1cm4gJ3JpZ2h0JzsNCgkJfQ0KDQoNCgkJZnVuY3Rpb24gY3JlYXRlU2xpbVNjcm9sbGluZyhlbGVtZW50KXsNCgkJCS8vbmVlZGVkIHRvIG1ha2UgYHNjcm9sbEhlaWdodGAgd29yayB1bmRlciBPcGVyYSAxMg0KCQkJZWxlbWVudC5jc3MoJ292ZXJmbG93JywgJ2hpZGRlbicpOw0KDQoJCQkvL2luIGNhc2UgZWxlbWVudCBpcyBhIHNsaWRlDQoJCQl2YXIgc2VjdGlvbiA9IGVsZW1lbnQuY2xvc2VzdCgnLmZwLXNlY3Rpb24nKTsNCgkJCXZhciBzY3JvbGxhYmxlID0gZWxlbWVudC5maW5kKCcuZnAtc2Nyb2xsYWJsZScpOw0KDQoJCQkvL2lmIHRoZXJlIHdhcyBzY3JvbGwsIHRoZSBjb250ZW50SGVpZ2h0IHdpbGwgYmUgdGhlIG9uZSBpbiB0aGUgc2Nyb2xsYWJsZSBzZWN0aW9uDQoJCQlpZihzY3JvbGxhYmxlLmxlbmd0aCl7DQoJCQkJdmFyIGNvbnRlbnRIZWlnaHQgPSBzY3JvbGxhYmxlLmdldCgwKS5zY3JvbGxIZWlnaHQ7DQoJCQl9ZWxzZXsNCgkJCQl2YXIgY29udGVudEhlaWdodCA9IGVsZW1lbnQuZ2V0KDApLnNjcm9sbEhlaWdodDsNCgkJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCQljb250ZW50SGVpZ2h0ID0gZWxlbWVudC5maW5kKCcuZnAtdGFibGVDZWxsJykuZ2V0KDApLnNjcm9sbEhlaWdodDsNCgkJCQl9DQoJCQl9DQoNCgkJCXZhciBzY3JvbGxIZWlnaHQgPSB3aW5kb3dzSGVpZ2h0IC0gcGFyc2VJbnQoc2VjdGlvbi5jc3MoJ3BhZGRpbmctYm90dG9tJykpIC0gcGFyc2VJbnQoc2VjdGlvbi5jc3MoJ3BhZGRpbmctdG9wJykpOw0KDQoJCQkvL25lZWRzIHNjcm9sbD8NCgkJCWlmICggY29udGVudEhlaWdodCA+IHNjcm9sbEhlaWdodCkgew0KCQkJCS8vd2FzIHRoZXJlIGFscmVhZHkgYW4gc2Nyb2xsID8gVXBkYXRpbmcgaXQNCgkJCQlpZihzY3JvbGxhYmxlLmxlbmd0aCl7DQoJCQkJCXNjcm9sbGFibGUuY3NzKCdoZWlnaHQnLCBzY3JvbGxIZWlnaHQgKyAncHgnKS5wYXJlbnQoKS5jc3MoJ2hlaWdodCcsIHNjcm9sbEhlaWdodCArICdweCcpOw0KCQkJCX0NCgkJCQkvL2NyZWF0aW5nIHRoZSBzY3JvbGxpbmcNCgkJCQllbHNlew0KCQkJCQlpZihvcHRpb25zLnZlcnRpY2FsQ2VudGVyZWQpew0KCQkJCQkJZWxlbWVudC5maW5kKCcuZnAtdGFibGVDZWxsJykud3JhcElubmVyKCc8ZGl2IGNsYXNzPSJmcC1zY3JvbGxhYmxlIiAvPicpOw0KCQkJCQl9ZWxzZXsNCgkJCQkJCWVsZW1lbnQud3JhcElubmVyKCc8ZGl2IGNsYXNzPSJmcC1zY3JvbGxhYmxlIiAvPicpOw0KCQkJCQl9DQoNCgkJCQkJZWxlbWVudC5maW5kKCcuZnAtc2Nyb2xsYWJsZScpLnNsaW1TY3JvbGwoew0KCQkJCQkJYWxsb3dQYWdlU2Nyb2xsOiB0cnVlLA0KCQkJCQkJaGVpZ2h0OiBzY3JvbGxIZWlnaHQgKyAncHgnLA0KCQkJCQkJc2l6ZTogJzEwcHgnLA0KCQkJCQkJYWx3YXlzVmlzaWJsZTogdHJ1ZQ0KCQkJCQl9KTsNCgkJCQl9DQoJCQl9DQoNCgkJCS8vcmVtb3ZpbmcgdGhlIHNjcm9sbGluZyB3aGVuIGl0IGlzIG5vdCBuZWNlc3NhcnkgYW55bW9yZQ0KCQkJZWxzZXsNCgkJCQlyZW1vdmVTbGltU2Nyb2xsKGVsZW1lbnQpOw0KCQkJfQ0KDQoJCQkvL3VuZG8NCgkJCWVsZW1lbnQuY3NzKCdvdmVyZmxvdycsICcnKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIHJlbW92ZVNsaW1TY3JvbGwoZWxlbWVudCl7DQoJCQllbGVtZW50LmZpbmQoJy5mcC1zY3JvbGxhYmxlJykuY2hpbGRyZW4oKS5maXJzdCgpLnVud3JhcCgpLnVud3JhcCgpOw0KCQkJZWxlbWVudC5maW5kKCcuc2xpbVNjcm9sbEJhcicpLnJlbW92ZSgpOw0KCQkJZWxlbWVudC5maW5kKCcuc2xpbVNjcm9sbFJhaWwnKS5yZW1vdmUoKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGFkZFRhYmxlQ2xhc3MoZWxlbWVudCl7DQoJCQllbGVtZW50LmFkZENsYXNzKCdmcC10YWJsZScpLndyYXBJbm5lcignPGRpdiBjbGFzcz0iZnAtdGFibGVDZWxsIiBzdHlsZT0iaGVpZ2h0OicgKyBnZXRUYWJsZUhlaWdodChlbGVtZW50KSArICdweDsiIC8+Jyk7DQoJCX0NCg0KCQlmdW5jdGlvbiBnZXRUYWJsZUhlaWdodChlbGVtZW50KXsNCgkJCXZhciBzZWN0aW9uSGVpZ2h0ID0gd2luZG93c0hlaWdodDsNCg0KCQkJaWYob3B0aW9ucy5wYWRkaW5nVG9wIHx8IG9wdGlvbnMucGFkZGluZ0JvdHRvbSl7DQoJCQkJdmFyIHNlY3Rpb24gPSBlbGVtZW50Ow0KCQkJCWlmKCFzZWN0aW9uLmhhc0NsYXNzKCdmcC1zZWN0aW9uJykpew0KCQkJCQlzZWN0aW9uID0gZWxlbWVudC5jbG9zZXN0KCcuZnAtc2VjdGlvbicpOw0KCQkJCX0NCg0KCQkJCXZhciBwYWRkaW5ncyA9IHBhcnNlSW50KHNlY3Rpb24uY3NzKCdwYWRkaW5nLXRvcCcpKSArIHBhcnNlSW50KHNlY3Rpb24uY3NzKCdwYWRkaW5nLWJvdHRvbScpKTsNCgkJCQlzZWN0aW9uSGVpZ2h0ID0gKHdpbmRvd3NIZWlnaHQgLSBwYWRkaW5ncyk7DQoJCQl9DQoNCgkJCXJldHVybiBzZWN0aW9uSGVpZ2h0Ow0KCQl9DQoNCgkJLyoqDQoJCSogQWRkcyBhIGNzczMgdHJhbnNmb3JtIHByb3BlcnR5IHRvIHRoZSBjb250YWluZXIgY2xhc3Mgd2l0aCBvciB3aXRob3V0IGFuaW1hdGlvbiBkZXBlbmRpbmcgb24gdGhlIGFuaW1hdGVkIHBhcmFtLg0KCQkqLw0KCQlmdW5jdGlvbiB0cmFuc2Zvcm1Db250YWluZXIodHJhbnNsYXRlM2QsIGFuaW1hdGVkKXsNCgkJCWFkZEFuaW1hdGlvbihjb250YWluZXIsIGFuaW1hdGVkKTsNCg0KCQkJY29udGFpbmVyLmNzcyhnZXRUcmFuc2Zvcm1zKHRyYW5zbGF0ZTNkKSk7DQoJCX0NCg0KDQoJCS8qKg0KCQkqIFNjcm9sbHMgdG8gdGhlIGdpdmVuIHNlY3Rpb24gYW5kIHNsaWRlDQoJCSovDQoJCWZ1bmN0aW9uIHNjcm9sbFBhZ2VBbmRTbGlkZShkZXN0aW55LCBzbGlkZSl7DQoJCQlpZiAodHlwZW9mIHNsaWRlID09PSAndW5kZWZpbmVkJykgew0KCQkJICAgIHNsaWRlID0gMDsNCgkJCX0NCg0KCQkJaWYoaXNOYU4oZGVzdGlueSkpew0KCQkJCXZhciBzZWN0aW9uID0gJCgnW2RhdGEtYW5jaG9yPSInK2Rlc3RpbnkrJyJdJyk7DQoJCQl9ZWxzZXsNCgkJCQl2YXIgc2VjdGlvbiA9ICQoJy5mcC1zZWN0aW9uJykuZXEoIChkZXN0aW55IC0xKSApOw0KCQkJfQ0KDQoNCgkJCS8vd2UgbmVlZCB0byBzY3JvbGwgdG8gdGhlIHNlY3Rpb24gYW5kIHRoZW4gdG8gdGhlIHNsaWRlDQoJCQlpZiAoZGVzdGlueSAhPT0gbGFzdFNjcm9sbGVkRGVzdGlueSAmJiAhc2VjdGlvbi5oYXNDbGFzcygnYWN0aXZlJykpew0KCQkJCXNjcm9sbFBhZ2Uoc2VjdGlvbiwgZnVuY3Rpb24oKXsNCgkJCQkJc2Nyb2xsU2xpZGVyKHNlY3Rpb24sIHNsaWRlKQ0KCQkJCX0pOw0KCQkJfQ0KCQkJLy9pZiB3ZSB3ZXJlIGFscmVhZHkgaW4gdGhlIHNlY3Rpb24NCgkJCWVsc2V7DQoJCQkJc2Nyb2xsU2xpZGVyKHNlY3Rpb24sIHNsaWRlKTsNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkqIFNjcm9sbHMgdGhlIHNsaWRlciB0byB0aGUgZ2l2ZW4gc2xpZGUgZGVzdGluYXRpb24gZm9yIHRoZSBnaXZlbiBzZWN0aW9uDQoJCSovDQoJCWZ1bmN0aW9uIHNjcm9sbFNsaWRlcihzZWN0aW9uLCBzbGlkZSl7DQoJCQlpZih0eXBlb2Ygc2xpZGUgIT0gJ3VuZGVmaW5lZCcpew0KCQkJCXZhciBzbGlkZXMgPSBzZWN0aW9uLmZpbmQoJy5mcC1zbGlkZXMnKTsNCgkJCQl2YXIgZGVzdGlueSA9ICBzbGlkZXMuZmluZCgnW2RhdGEtYW5jaG9yPSInK3NsaWRlKyciXScpOw0KDQoJCQkJaWYoIWRlc3RpbnkubGVuZ3RoKXsNCgkJCQkJZGVzdGlueSA9IHNsaWRlcy5maW5kKCcuZnAtc2xpZGUnKS5lcShzbGlkZSk7DQoJCQkJfQ0KDQoJCQkJaWYoZGVzdGlueS5sZW5ndGgpew0KCQkJCQlsYW5kc2NhcGVTY3JvbGwoc2xpZGVzLCBkZXN0aW55KTsNCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJKiBDcmVhdGVzIGEgbGFuZHNjYXBlIG5hdmlnYXRpb24gYmFyIHdpdGggZG90cyBmb3IgaG9yaXpvbnRhbCBzbGlkZXJzLg0KCQkqLw0KCQlmdW5jdGlvbiBhZGRTbGlkZXNOYXZpZ2F0aW9uKHNlY3Rpb24sIG51bVNsaWRlcyl7DQoJCQlzZWN0aW9uLmFwcGVuZCgnPGRpdiBjbGFzcz0iZnAtc2xpZGVzTmF2Ij48dWw+PC91bD48L2Rpdj4nKTsNCgkJCXZhciBuYXYgPSBzZWN0aW9uLmZpbmQoJy5mcC1zbGlkZXNOYXYnKTsNCg0KCQkJLy90b3Agb3IgYm90dG9tDQoJCQluYXYuYWRkQ2xhc3Mob3B0aW9ucy5zbGlkZXNOYXZQb3NpdGlvbik7DQoNCgkJCWZvcih2YXIgaT0wOyBpPCBudW1TbGlkZXM7IGkrKyl7DQoJCQkJbmF2LmZpbmQoJ3VsJykuYXBwZW5kKCc8bGk+PGEgaHJlZj0iIyI+PHNwYW4+PC9zcGFuPjwvYT48L2xpPicpOw0KCQkJfQ0KDQoJCQkvL2NlbnRlcmluZyBpdA0KCQkJbmF2LmNzcygnbWFyZ2luLWxlZnQnLCAnLScgKyAobmF2LndpZHRoKCkvMikgKyAncHgnKTsNCg0KCQkJbmF2LmZpbmQoJ2xpJykuZmlyc3QoKS5maW5kKCdhJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQl9DQoNCg0KCQkvKioNCgkJKiBTZXRzIHRoZSBVUkwgaGFzaCBmb3IgYSBzZWN0aW9uIHdpdGggc2xpZGVzDQoJCSovDQoJCWZ1bmN0aW9uIHNldFVSTEhhc2goc2xpZGVJbmRleCwgc2xpZGVBbmNob3IsIGFuY2hvckxpbmspew0KCQkJdmFyIHNlY3Rpb25IYXNoID0gJyc7DQoNCgkJCWlmKG9wdGlvbnMuYW5jaG9ycy5sZW5ndGgpew0KDQoJCQkJLy9pc24ndCBpdCB0aGUgZmlyc3Qgc2xpZGU/DQoJCQkJaWYoc2xpZGVJbmRleCl7DQoJCQkJCWlmKHR5cGVvZiBhbmNob3JMaW5rICE9PSAndW5kZWZpbmVkJyl7DQoJCQkJCQlzZWN0aW9uSGFzaCA9IGFuY2hvckxpbms7DQoJCQkJCX0NCg0KCQkJCQkvL3NsaWRlIHdpdGhvdXQgYW5jaG9yIGxpbms/IFdlIHRha2UgdGhlIGluZGV4IGluc3RlYWQuDQoJCQkJCWlmKHR5cGVvZiBzbGlkZUFuY2hvciA9PT0gJ3VuZGVmaW5lZCcpew0KCQkJCQkJc2xpZGVBbmNob3IgPSBzbGlkZUluZGV4Ow0KCQkJCQl9DQoNCgkJCQkJbGFzdFNjcm9sbGVkU2xpZGUgPSBzbGlkZUFuY2hvcjsNCgkJCQkJbG9jYXRpb24uaGFzaCA9IHNlY3Rpb25IYXNoICsgJy8nICsgc2xpZGVBbmNob3I7DQoNCgkJCQkvL2ZpcnN0IHNsaWRlIHdvbid0IGhhdmUgc2xpZGUgYW5jaG9yLCBqdXN0IHRoZSBzZWN0aW9uIG9uZQ0KCQkJCX1lbHNlIGlmKHR5cGVvZiBzbGlkZUluZGV4ICE9PSAndW5kZWZpbmVkJyl7DQoJCQkJCWxhc3RTY3JvbGxlZFNsaWRlID0gc2xpZGVBbmNob3I7DQoJCQkJCWxvY2F0aW9uLmhhc2ggPSBhbmNob3JMaW5rOw0KCQkJCX0NCg0KCQkJCS8vc2VjdGlvbiB3aXRob3V0IHNsaWRlcw0KCQkJCWVsc2V7DQoJCQkJCWxvY2F0aW9uLmhhc2ggPSBhbmNob3JMaW5rOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkqIENoZWNrcyBmb3IgdHJhbnNsYXRlM2Qgc3VwcG9ydA0KCQkqIEByZXR1cm4gYm9vbGVhbg0KCQkqIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTY2MTY3MS9kZXRlY3RpbmctdHJhbnNmb3JtLXRyYW5zbGF0ZTNkLXN1cHBvcnQNCgkJKi8NCgkJZnVuY3Rpb24gc3VwcG9ydDNkKCkgew0KCQkJdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpLA0KCQkJCWhhczNkLA0KCQkJCXRyYW5zZm9ybXMgPSB7DQoJCQkJCSd3ZWJraXRUcmFuc2Zvcm0nOictd2Via2l0LXRyYW5zZm9ybScsDQoJCQkJCSdPVHJhbnNmb3JtJzonLW8tdHJhbnNmb3JtJywNCgkJCQkJJ21zVHJhbnNmb3JtJzonLW1zLXRyYW5zZm9ybScsDQoJCQkJCSdNb3pUcmFuc2Zvcm0nOictbW96LXRyYW5zZm9ybScsDQoJCQkJCSd0cmFuc2Zvcm0nOid0cmFuc2Zvcm0nDQoJCQkJfTsNCg0KCQkJLy8gQWRkIGl0IHRvIHRoZSBib2R5IHRvIGdldCB0aGUgY29tcHV0ZWQgc3R5bGUuDQoJCQlkb2N1bWVudC5ib2R5Lmluc2VydEJlZm9yZShlbCwgbnVsbCk7DQoNCgkJCWZvciAodmFyIHQgaW4gdHJhbnNmb3Jtcykgew0KCQkJCWlmIChlbC5zdHlsZVt0XSAhPT0gdW5kZWZpbmVkKSB7DQoJCQkJCWVsLnN0eWxlW3RdID0gInRyYW5zbGF0ZTNkKDFweCwxcHgsMXB4KSI7DQoJCQkJCWhhczNkID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpLmdldFByb3BlcnR5VmFsdWUodHJhbnNmb3Jtc1t0XSk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsKTsNCg0KCQkJcmV0dXJuIChoYXMzZCAhPT0gdW5kZWZpbmVkICYmIGhhczNkLmxlbmd0aCA+IDAgJiYgaGFzM2QgIT09ICJub25lIik7DQoJCX0NCg0KDQoNCgkJLyoqDQoJCSogUmVtb3ZlcyB0aGUgYXV0byBzY3JvbGxpbmcgYWN0aW9uIGZpcmVkIGJ5IHRoZSBtb3VzZSB3aGVlbCBhbmQgdGFja3BhZC4NCgkJKiBBZnRlciB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCwgdGhlIG1vdXNld2hlZWwgYW5kIHRyYWNrcGFkIG1vdmVtZW50cyB3b24ndCBzY3JvbGwgdGhyb3VnaCBzZWN0aW9ucy4NCgkJKi8NCgkJZnVuY3Rpb24gcmVtb3ZlTW91c2VXaGVlbEhhbmRsZXIoKXsNCgkJCWlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7DQoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIE1vdXNlV2hlZWxIYW5kbGVyLCBmYWxzZSk7IC8vSUU5LCBDaHJvbWUsIFNhZmFyaSwgT3Blcg0KCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3doZWVsJywgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9GaXJlZm94DQoJCQl9IGVsc2Ugew0KCQkJCWRvY3VtZW50LmRldGFjaEV2ZW50KCJvbm1vdXNld2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlcik7IC8vSUUgNi83LzgNCgkJCX0NCgkJfQ0KDQoNCgkJLyoqDQoJCSogQWRkcyB0aGUgYXV0byBzY3JvbGxpbmcgYWN0aW9uIGZvciB0aGUgbW91c2Ugd2hlZWwgYW5kIHRhY2twYWQuDQoJCSogQWZ0ZXIgdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQsIHRoZSBtb3VzZXdoZWVsIGFuZCB0cmFja3BhZCBtb3ZlbWVudHMgd2lsbCBzY3JvbGwgdGhyb3VnaCBzZWN0aW9ucw0KCQkqLw0KCQlmdW5jdGlvbiBhZGRNb3VzZVdoZWVsSGFuZGxlcigpew0KCQkJaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsNCgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXdoZWVsIiwgTW91c2VXaGVlbEhhbmRsZXIsIGZhbHNlKTsgLy9JRTksIENocm9tZSwgU2FmYXJpLCBPcGVyDQoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigid2hlZWwiLCBNb3VzZVdoZWVsSGFuZGxlciwgZmFsc2UpOyAvL0ZpcmVmb3gNCgkJCX0gZWxzZSB7DQoJCQkJZG9jdW1lbnQuYXR0YWNoRXZlbnQoIm9ubW91c2V3aGVlbCIsIE1vdXNlV2hlZWxIYW5kbGVyKTsgLy9JRSA2LzcvOA0KCQkJfQ0KCQl9DQoNCg0KCQkvKioNCgkJKiBBZGRzIHRoZSBwb3NzaWJpbGl0eSB0byBhdXRvIHNjcm9sbCB0aHJvdWdoIHNlY3Rpb25zIG9uIHRvdWNoIGRldmljZXMuDQoJCSovDQoJCWZ1bmN0aW9uIGFkZFRvdWNoSGFuZGxlcigpew0KCQkJaWYoaXNUb3VjaERldmljZSB8fCBpc1RvdWNoKXsNCgkJCQkvL01pY3Jvc29mdCBwb2ludGVycw0KCQkJCU1TUG9pbnRlciA9IGdldE1TUG9pbnRlcigpOw0KDQoJCQkJJChkb2N1bWVudCkub2ZmKCd0b3VjaHN0YXJ0ICcgKyAgTVNQb2ludGVyLmRvd24pLm9uKCd0b3VjaHN0YXJ0ICcgKyBNU1BvaW50ZXIuZG93biwgdG91Y2hTdGFydEhhbmRsZXIpOw0KCQkJCSQoZG9jdW1lbnQpLm9mZigndG91Y2htb3ZlICcgKyBNU1BvaW50ZXIubW92ZSkub24oJ3RvdWNobW92ZSAnICsgTVNQb2ludGVyLm1vdmUsIHRvdWNoTW92ZUhhbmRsZXIpOw0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSogUmVtb3ZlcyB0aGUgYXV0byBzY3JvbGxpbmcgZm9yIHRvdWNoIGRldmljZXMuDQoJCSovDQoJCWZ1bmN0aW9uIHJlbW92ZVRvdWNoSGFuZGxlcigpew0KCQkJaWYoaXNUb3VjaERldmljZSB8fCBpc1RvdWNoKXsNCgkJCQkvL01pY3Jvc29mdCBwb2ludGVycw0KCQkJCU1TUG9pbnRlciA9IGdldE1TUG9pbnRlcigpOw0KDQoJCQkJJChkb2N1bWVudCkub2ZmKCd0b3VjaHN0YXJ0ICcgKyBNU1BvaW50ZXIuZG93bik7DQoJCQkJJChkb2N1bWVudCkub2ZmKCd0b3VjaG1vdmUgJyArIE1TUG9pbnRlci5tb3ZlKTsNCgkJCX0NCgkJfQ0KDQoNCgkJLyoNCgkJKiBSZXR1cm5zIGFuZCBvYmplY3Qgd2l0aCBNaWNyb3NvZnQgcG9pbnRlcnMgKGZvciBJRTwxMSBhbmQgZm9yIElFID49IDExKQ0KCQkqIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9pZS9kbjMwNDg4Nih2PXZzLjg1KS5hc3B4DQoJCSovDQoJCWZ1bmN0aW9uIGdldE1TUG9pbnRlcigpew0KCQkJdmFyIHBvaW50ZXI7DQoNCgkJCS8vSUUgPj0gMTENCgkJCWlmKHdpbmRvdy5Qb2ludGVyRXZlbnQpew0KCQkJCXBvaW50ZXIgPSB7IGRvd246ICJwb2ludGVyZG93biIsIG1vdmU6ICJwb2ludGVybW92ZSJ9Ow0KCQkJfQ0KDQoJCQkvL0lFIDwgMTENCgkJCWVsc2V7DQoJCQkJcG9pbnRlciA9IHsgZG93bjogIk1TUG9pbnRlckRvd24iLCBtb3ZlOiAiTVNQb2ludGVyTW92ZSJ9Ow0KCQkJfQ0KDQoJCQlyZXR1cm4gcG9pbnRlcjsNCgkJfQ0KCQkvKioNCgkJKiBHZXRzIHRoZSBwYWdlWCBhbmQgcGFnZVkgcHJvcGVydGllcyBkZXBlbmRpbmcgb24gdGhlIGJyb3dzZXIuDQoJCSogaHR0cHM6Ly9naXRodWIuY29tL2FsdmFyb3RyaWdvL2Z1bGxQYWdlLmpzL2lzc3Vlcy8xOTQjaXNzdWVjb21tZW50LTM0MDY5ODU0DQoJCSovDQoJCWZ1bmN0aW9uIGdldEV2ZW50c1BhZ2UoZSl7DQoJCQl2YXIgZXZlbnRzID0gbmV3IEFycmF5KCk7DQoJCQlpZiAod2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkKXsNCgkJCQlldmVudHNbJ3knXSA9IGUucGFnZVk7DQoJCQkJZXZlbnRzWyd4J10gPSBlLnBhZ2VYOw0KCQkJfWVsc2V7DQoJCQkJZXZlbnRzWyd5J10gPSBlLnRvdWNoZXNbMF0ucGFnZVk7DQoJCQkJZXZlbnRzWyd4J10gPSAgZS50b3VjaGVzWzBdLnBhZ2VYOw0KCQkJfQ0KDQoJCQlyZXR1cm4gZXZlbnRzOw0KCQl9DQoNCgkJZnVuY3Rpb24gc2lsZW50TGFuZHNjYXBlU2Nyb2xsKGFjdGl2ZVNsaWRlKXsNCgkJCXZhciBwcmV2U2Nyb2xsaW5nU3BlZXBkID0gb3B0aW9ucy5zY3JvbGxpbmdTcGVlZDsNCgkJCSQuZm4uZnVsbHBhZ2Uuc2V0U2Nyb2xsaW5nU3BlZWQgKDApOw0KCQkJbGFuZHNjYXBlU2Nyb2xsKGFjdGl2ZVNsaWRlLmNsb3Nlc3QoJy5mcC1zbGlkZXMnKSwgYWN0aXZlU2xpZGUpOw0KCQkJJC5mbi5mdWxscGFnZS5zZXRTY3JvbGxpbmdTcGVlZChwcmV2U2Nyb2xsaW5nU3BlZXBkKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIHNpbGVudFNjcm9sbCh0b3Apew0KCQkJaWYgKG9wdGlvbnMuY3NzMykgew0KCQkJCXZhciB0cmFuc2xhdGUzZCA9ICd0cmFuc2xhdGUzZCgwcHgsIC0nICsgdG9wICsgJ3B4LCAwcHgpJzsNCgkJCQl0cmFuc2Zvcm1Db250YWluZXIodHJhbnNsYXRlM2QsIGZhbHNlKTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCWNvbnRhaW5lci5jc3MoInRvcCIsIC10b3ApOw0KCQkJfQ0KCQl9DQoNCgkJZnVuY3Rpb24gZ2V0VHJhbnNmb3Jtcyh0cmFuc2xhdGUzZCl7DQoJCQlyZXR1cm4gew0KCQkJCSctd2Via2l0LXRyYW5zZm9ybSc6IHRyYW5zbGF0ZTNkLA0KCQkJCSctbW96LXRyYW5zZm9ybSc6IHRyYW5zbGF0ZTNkLA0KCQkJCSctbXMtdHJhbnNmb3JtJzp0cmFuc2xhdGUzZCwNCgkJCQkndHJhbnNmb3JtJzogdHJhbnNsYXRlM2QNCgkJCX07DQoJCX0NCg0KDQoJCS8qDQoJCSogRGVzdHJveXMgZnVsbHBhZ2UuanMgcGx1Z2luIGV2ZW50cyBhbmQgb3B0aW5hbGx5IGl0cyBodG1sIG1hcmt1cCBhbmQgc3R5bGVzDQoJCSovDQoJCSQuZm4uZnVsbHBhZ2UuZGVzdHJveSA9IGZ1bmN0aW9uKGFsbCl7DQoJCQkkLmZuLmZ1bGxwYWdlLnNldEF1dG9TY3JvbGxpbmcoZmFsc2UpOw0KIAkJCSQuZm4uZnVsbHBhZ2Uuc2V0QWxsb3dTY3JvbGxpbmcoZmFsc2UpOw0KIAkJCSQuZm4uZnVsbHBhZ2Uuc2V0S2V5Ym9hcmRTY3JvbGxpbmcoZmFsc2UpOw0KDQoNCiAJCQkkKHdpbmRvdykNCgkJCQkub2ZmKCdzY3JvbGwnLCBzY3JvbGxIYW5kbGVyKQ0KICAJCQkJLm9mZignaGFzaGNoYW5nZScsIGhhc2hDaGFuZ2VIYW5kbGVyKQ0KICAJCQkJLm9mZigncmVzaXplJywgcmVzaXplSGFuZGxlcik7DQoNCgkJCSQoZG9jdW1lbnQpDQoJCQkJLm9mZignY2xpY2snLCAnI2ZwLW5hdiBhJykNCgkJCQkub2ZmKCdtb3VzZWVudGVyJywgJyNmcC1uYXYgbGknKQ0KCQkJCS5vZmYoJ21vdXNlbGVhdmUnLCAnI2ZwLW5hdiBsaScpDQoJCQkJLm9mZignY2xpY2snLCAnLmZwLXNsaWRlc05hdiBhJykNCiAgCQkJCS5vZmYoJ21vdXNlb3ZlcicsIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMpDQogIAkJCQkub2ZmKCdtb3VzZW91dCcsIG9wdGlvbnMubm9ybWFsU2Nyb2xsRWxlbWVudHMpOw0KDQoJCQkkKCcuZnAtc2VjdGlvbicpDQoJCQkJLm9mZignY2xpY2snLCAnLmZwLWNvbnRyb2xBcnJvdycpOw0KDQoJCQkvL2xldHMgbWFrZSBhIG1lc3MhDQoJCQlpZihhbGwpew0KCQkJCWRlc3Ryb3lTdHJ1Y3R1cmUoKTsNCgkJCX0NCiAJCX07DQoNCiAJCS8qDQoJCSogUmVtb3ZlcyBpbmxpbmUgc3R5bGVzIGFkZGVkIGJ5IGZ1bGxwYWdlLmpzDQoJCSovDQoJCWZ1bmN0aW9uIGRlc3Ryb3lTdHJ1Y3R1cmUoKXsNCgkJCS8vcmVzZXRpbmcgdGhlIGB0b3BgIG9yIGB0cmFuc2xhdGVgIHByb3BlcnRpZXMgdG8gMA0KCSAJCXNpbGVudFNjcm9sbCgwKTsNCg0KCQkJJCgnI2ZwLW5hdiwgLmZwLXNsaWRlc05hdiwgLmZwLWNvbnRyb2xBcnJvdycpLnJlbW92ZSgpOw0KDQoJCQkvL3JlbW92aW5nIGlubGluZSBzdHlsZXMNCgkJCSQoJy5mcC1zZWN0aW9uJykuY3NzKCB7DQoJCQkJJ2hlaWdodCc6ICcnLA0KCQkJCSdiYWNrZ3JvdW5kLWNvbG9yJyA6ICcnLA0KCQkJCSdwYWRkaW5nJzogJycNCgkJCX0pOw0KDQoJCQkkKCcuZnAtc2xpZGUnKS5jc3MoIHsNCgkJCQknd2lkdGgnOiAnJw0KCQkJfSk7DQoNCgkJCWNvbnRhaW5lci5jc3Moew0KCSAJCQknaGVpZ2h0JzogJycsDQoJIAkJCSdwb3NpdGlvbic6ICcnLA0KCSAJCQknLW1zLXRvdWNoLWFjdGlvbic6ICcnLA0KCSAJCQkndG91Y2gtYWN0aW9uJzogJycNCgkgCQl9KTsNCg0KCQkJLy9yZW1vdmluZyBhZGRlZCBjbGFzc2VzDQoJCQkkKCcuZnAtc2VjdGlvbiwgLmZwLXNsaWRlJykuZWFjaChmdW5jdGlvbigpew0KCQkJCXJlbW92ZVNsaW1TY3JvbGwoJCh0aGlzKSk7DQoJCQkJJCh0aGlzKS5yZW1vdmVDbGFzcygnZnAtdGFibGUgYWN0aXZlJyk7DQoJCQl9KQ0KDQoJCQlyZW1vdmVBbmltYXRpb24oY29udGFpbmVyKTsNCgkJCXJlbW92ZUFuaW1hdGlvbihjb250YWluZXIuZmluZCgnLmZwLWVhc2luZycpKTsNCg0KCQkJLy9VbndyYXBwaW5nIGNvbnRlbnQNCgkJCWNvbnRhaW5lci5maW5kKCcuZnAtdGFibGVDZWxsLCAuZnAtc2xpZGVzQ29udGFpbmVyLCAuZnAtc2xpZGVzJykuZWFjaChmdW5jdGlvbigpew0KCQkJCS8vdW53cmFwIG5vdCBiZWluZyB1c2UgaW4gY2FzZSB0aGVyZSdzIG5vIGNoaWxkIGVsZW1lbnQgaW5zaWRlIGFuZCBpdHMganVzdCB0ZXh0DQoJCQkJJCh0aGlzKS5yZXBsYWNlV2l0aCh0aGlzLmNoaWxkTm9kZXMpOw0KCQkJfSk7DQoNCgkJCS8vc2Nyb2xsaW5nIHRoZSBwYWdlIHRvIHRoZSB0b3Agd2l0aCBubyBhbmltYXRpb24NCgkJCSQoJ2h0bWwsIGJvZHknKS5zY3JvbGxUb3AoMCk7DQoJCX0NCg0KCX07DQoNCn0pKGpRdWVyeSk7DQo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 01:59:31 GMT",
                    "Content-Length": "52463",
                    "Date": "Fri, 07 Nov 2014 01:59:32 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}