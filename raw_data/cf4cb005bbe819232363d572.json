{
    "url": "http://localhost:9999/synapticism/ajaxinate-wp/dist/ajaxinate-wp.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location.hash</b> and written to <b>$()</b> via the following statement:<ul><li>var $hash = $('[id=\"'+location.hash.substring(1)+'\"]');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/synapticism/ajaxinate-wp/dist/ajaxinate-wp.js",
                "path": "/synapticism/ajaxinate-wp/dist/ajaxinate-wp.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9zeW5hcHRpY2lzbS9hamF4aW5hdGUtd3AvZGlzdC9hamF4aW5hdGUtd3AuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTc2MDENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMDY6NDQ6MjcgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDA2OjQ0OjI2IEdNVA0KDQovLyA9PT09IEFKQVhJTkFURSA9PT09IC8vCgovLyBEb2N1bWVudGF0aW9uOiBodHRwczovL2dpdGh1Yi5jb20vc3luYXB0aWNpc20vYWpheGluYXRlCgovLyBHbG9iYWwgbmFtZXNwYWNlIG9iamVjdAp2YXIgWE44ID0ge307Cgo7KGZ1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCl7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBJbml0aWFsaXplIEhUTUw1LUhpc3RvcnktQVBJIHBvbHlmaWxsIHdpdGggdGhpcyBzaW5nbGUgbGluZQogIHZhciBsb2NhdGlvbiA9IHdpbmRvdy5oaXN0b3J5LmxvY2F0aW9uIHx8IHdpbmRvdy5sb2NhdGlvbjsKCiAgLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIHRoZSBIVE1MNSBoaXN0b3J5IEFQSTsgaWYgbm90LCBmYWlsIGVhcmx5IGFuZCBsZXQgdGhlIHNpdGUgbG9hZCBub3JtYWxseQogIGlmICggISh3aW5kb3cuaGlzdG9yeSAmJiBoaXN0b3J5LnB1c2hTdGF0ZSkgKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLyBDb25zdHJ1Y3RvciBmdW5jdGlvbgogIHZhciBBamF4aW5hdGUgPSB0aGlzLkFqYXhpbmF0ZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdHMpewogICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgIHRoaXMub3B0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmFqYXhpbmF0ZS5kZWZhdWx0cywgb3B0cyk7CiAgICB0aGlzLmluaXQoKTsKICB9OwoKICAvLyBQcm90b3R5cGUgbG9naWMKICBBamF4aW5hdGUucHJvdG90eXBlID0gewogICAgaW5pdDogZnVuY3Rpb24oKXsKCiAgICAgIC8vIEZldGNoIGluaXRpYWwgY29udGVudAogICAgICB0aGlzLmNvbnRlbnQgPSAkKHRoaXMub3B0cy5jb250ZW50U2VsKS5maWx0ZXIoJzpmaXJzdCcpOwoKICAgICAgLy8gRW5zdXJlIGNvbnRlbnQgaXNuJ3QgZW1wdHk7IGlmIGl0IGlzLCB1c2UgdGhlIGN1cnJlbnQgZG9jdW1lbnQgY29udGVudHMKICAgICAgaWYgKCB0aGlzLmNvbnRlbnQubGVuZ3RoID09PSAwICkgewogICAgICAgIHRoaXMuY29udGVudCA9ICQoZG9jdW1lbnQuYm9keSk7CiAgICAgIH0KCiAgICAgIC8vIEluaXRpYWxpemUgaW50ZXJuYWwgbGluayBzZWxlY3RvcgogICAgICB0aGlzLmludGVybmFsU2VsKCk7CgogICAgICAvLyBJbml0aWFsaXplIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgZWxlbWVudChzKSBzcGVjaWZpZWQKICAgICAgdGhpcy5wcmVwKHRoaXMuZWxlbWVudCk7CgogICAgICAvLyBJbml0aWFsaXplIHBvcHN0YXRlIGV2ZW50IGhhbmRsZXIKICAgICAgdGhpcy5wb3BUaGlzKCk7CgogICAgICAvLyBJbml0aWFsaXplIHNwaW5uZXIKICAgICAgdGhpcy5zcGlubmVyKCk7CiAgICB9LAoKCgogICAgLy8gSW50ZXJuYWwgbGluayBzbGVjdG9yCiAgICBpbnRlcm5hbFNlbDogZnVuY3Rpb24oKXsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgLy8gUmVnaXN0ZXIgdGhlIGN1c3RvbSBzZWxlY3RvciB0byBpZGVudGlmeSBpbnRlcm5hbCBsaW5rcwogICAgICAkLmV4cHJbJzonXS5pbnRlcm5hbCA9IGZ1bmN0aW9uKG9iaixpbmRleCxtZXRhLHN0YWNrKXsKICAgICAgICB2YXIKICAgICAgICAgICR0aGlzICAgPSAkKG9iaiksCiAgICAgICAgICB1cmwgICAgID0gJHRoaXMuYXR0cignaHJlZicpIHx8ICcnLAogICAgICAgICAgcm9vdHVybCA9IHNlbGYucm9vdCgpLAogICAgICAgICAgaXNJbnRlcm5hbDsKCiAgICAgICAgLy8gVGVzdCB0aGUgbGluazoKICAgICAgICAvLyAtIENoZWNrIHdoZXRoZXIgdGhlIGRvbWFpbnMgYXJlIHRoZSBzYW1lCiAgICAgICAgLy8gLSBDaGVjayB3aGV0aGVyIHRoZSBsaW5rIGlzIHJlbGF0aXZlIChlLmcuIGRvZXMgbm90IGNvbnRhaW4gaHR0cChzKTovLykKICAgICAgICAvLyAtIENoZWNrIHdoZXRoZXIgdGhlIGxpbmsgYmVnaW5zIHdpdGggYSBoYXNoICgjKQogICAgICAgIC8vIC0gRmlsdGVyIGNlcnRhaW4gZmlsZSBleHRlbnNpb25zIGRlZmluZWQgaW4gdGhlIG9wdGlvbnMgKGUuZy4gaW1hZ2VzLCBhdWRpbyBmaWxlcywgZXRjLikKICAgICAgICBpc0ludGVybmFsID0KICAgICAgICAgIHVybC5zdWJzdHJpbmcoMCxyb290dXJsLmxlbmd0aCkgPT09IHJvb3R1cmwgfHwKICAgICAgICAgIHVybC5pbmRleE9mKCc6JykgPT09IC0xIHx8CiAgICAgICAgICB1cmwuaW5kZXhPZignIycpICE9PSAwIHx8CiAgICAgICAgICAhdXJsLm1hdGNoKHNlbGYub3B0cy5leGNlcHRpb25zKQogICAgICAgIDsKCiAgICAgICAgcmV0dXJuIGlzSW50ZXJuYWw7CiAgICAgIH07CiAgICB9LCAvLyBlbmQgaW50ZXJuYWxTZWwoKQoKCgogICAgLy8gUHJpbWFyeSBldmVudCBiaW5kaW5nIGZ1bmN0aW9uCiAgICBwcmVwOiBmdW5jdGlvbihlbGVtZW50KXsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgLy8gU2VsZWN0IGFsbCBhbmNob3IgdGFncyB3aXRoaW4gdGhlIHRhcmdldCBlbGVtZW50OyB1c2VzIG5hdGl2ZSBKYXZhU2NyaXB0IG1ldGhvZHMgKGZhc3QpCiAgICAgICQoZWxlbWVudCkuZmluZCgnYScpCgogICAgICAvLyBOb3cgZmlsdGVyIHRoZSByZXN1bHRzIHRvIGZpbmQgY2VydGFpbiBpbnRlcm5hbCBsaW5rczsgdXNlcyBjb21wbGV4IGpRdWVyeSBzZWxlY3RvcnMgKHNsb3cpCiAgICAgIC5maWx0ZXIoJzppbnRlcm5hbCcgKyBzZWxmLm9wdHMuZmlsdGVycykKCiAgICAgIC8vIE1hbmFnZSBjbGljayBldmVudAogICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgIHZhcgogICAgICAgICAgJHRoaXMgPSAkKHRoaXMpLAogICAgICAgICAgdXJsICAgPSAkdGhpcy5hdHRyKCdocmVmJyksCiAgICAgICAgICB0aXRsZSA9ICR0aGlzLmF0dHIoJ3RpdGxlJykgfHwgbnVsbDsgLy8gTm90IGh1Z2VseSBpbXBvcnRhbnQgYnV0IHdlJ2xsIHVzZSBhIHRpdGxlIGF0dHJpYnV0ZSBpZiBvbmUgaGFwcGVucyB0byBiZSBwcmVzZW50CgogICAgICAgIC8vIFJldHVybiB0cnVlIChhbmQgYWxsb3cgbm9ybWFsIGJyb3dzZXIgYmVoYXZpb3IpIHVuZGVyIGNlcnRhaW4gY2lyY3Vtc3RhbmNlczoKICAgICAgICAvLyAtIE1pZGRsZSBtb3VzZSBidXR0b24gY2xpY2tzOyByZWZlcmVuY2U6IGh0dHBzOi8vYXBpLmpxdWVyeS5jb20vZXZlbnQud2hpY2gvCiAgICAgICAgLy8gLSBDb21tYW5kIGFuZCBjb250cm9sIGtleSBjbGlja3MgZS5nLiB0byBvcGVuIGluIGEgbmV3IHRhYjsgcmVmZXJlbmNlOiBodHRwczovL2dpdGh1Yi5jb20vYnJvd3NlcnN0YXRlL2FqYXhpZnkvcHVsbC8xNS9maWxlcwogICAgICAgIC8vIC0gU2VlIGFsc286IGV2ZW50LmFsdEtleSwgZXZlbnQuc2hpZnRLZXkgKG5vdCBpbXBsZW1lbnRlZCkKICAgICAgICAvLyAtIFVSTCBub3Qgc2V0IG9yIFVSTCBpcyBvbmx5IGEgaGFzaAogICAgICAgIGlmICgKICAgICAgICAgIGV2ZW50LndoaWNoID09PSAyIHx8CiAgICAgICAgICBldmVudC5tZXRhS2V5IHx8CiAgICAgICAgICBldmVudC5jdHJsS2V5IHx8CiAgICAgICAgICAhdXJsIHx8CiAgICAgICAgICB1cmxbMF0gPT09ICcjJwogICAgICAgICkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBzZWxmLnB1c2hlcih0aXRsZSx1cmwsZXZlbnQpOwogICAgICB9KTsKCiAgICAgIGNvbnNvbGUudGltZUVuZCgicHJlcCIpOwogICAgfSwgLy8gZW5kIHByZXAoKQoKCgogICAgLy8gUHVzaCBzdGF0ZSwgbG9hZCBuZXcgY29udGVudCB2aWEgQUpBWCwgYW5kIHByZXZlbnQgdGhlIGRlZmF1bHQgYWN0aW9uIHdpdGggYHJldHVybiBmYWxzZWAKICAgIHB1c2hlcjogZnVuY3Rpb24odGl0bGUsdXJsLGV2ZW50KXsKCiAgICAgIC8vIFByZXZlbnQgbmF2aWdhdGlvbgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgLy8gUGVyZm9ybSB2YXJpb3VzIHRlc3RzIGhlcmUsIHN0YXJ0aW5nIHdpdGggYSBxdWljayBjaGVjayB0byBzZWUgaWYgdGhlIFVSTCBkaWZmZXJzIGZyb20gd2hhdCBpcyBjdXJyZW50bHkgZGlzcGxheWVkCiAgICAgIGlmICh1cmwgIT09IGxvY2F0aW9uLmhyZWYpIHsKCiAgICAgICAgLy8gU3RvcmUgc3RhdGUgb2JqZWN0OyB3ZSB1c2UgdGhpcyB3aGVuIHJlcXVlc3RpbmcgY29udGVudCBmb3IgYSBwb3BzdGF0ZSBldmVudAogICAgICAgIHZhciBzdGF0ZSA9IHsKICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgLy8gU2Nyb2xsIG9iamVjdCBoYW5kbGluZywgZm9yIGZ1dHVyZSByZWZlcmVuY2U6IGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE2NzMxMjcxL2hpc3RvcnktcHVzaHN0YXRlLWFuZC1zY3JvbGwtcG9zaXRpb24KICAgICAgICAgIC8vc2Nyb2xsVG9wOiAkKHdpbmRvdykuc2Nyb2xsVG9wKCkKICAgICAgICB9OwoKICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZShzdGF0ZSx0aXRsZSx1cmwpOwogICAgICAgIHRoaXMubG9hZCh1cmwpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwgLy8gZW5kIHB1c2hlcigpCgoKCiAgICAvLyBUaGUgcG9wc3RhdGUgZXZlbnQgZmlyZXMgd2hlbiB0aGUgdXNlciBuYXZpZ2F0ZXMgYmFja3dhcmQgb3IgZm9yd2FyZCBpbiB0aGUgYnJvd3NlcgogICAgcG9wVGhpczogZnVuY3Rpb24oKXsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgJCh3aW5kb3cpLm9uKCdwb3BzdGF0ZScsIGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAvLyBUZXN0IGZvciB0aGUgcHJlc2VuY2Ugb2YgYSBoYXNoIGluIHRoZSBVUkwgdG8gYWxsb3cgdXNlcnMgdG8gc2tpcCBiZXR3ZWVuIGFuY2hvcnMgaW4gYSBzaW5nbGUgZG9jdW1lbnQKICAgICAgICAvLyBAVE9ETzogYWxzbyBoYW5kbGUgY2FzZXMgd2hlcmUgdXNlcnMgYXJlIHJldHVybmluZyB0byBhIGxvY2F0aW9uIHdpdGggYSBoYXNoOyBlLmcuIGlmIGxvY2F0aW9uLmhhc2ggYW5kIGxvY2F0aW9uLmhyZWYgIT0gb2xkLmhyZWYKICAgICAgICBpZiAoIWxvY2F0aW9uLmhhc2gpIHsKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBzZWxmLmxvYWQobG9jYXRpb24uaHJlZik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sIC8vIGVuZCBwb3BUaGlzKCkKCgoKICAgIC8vIENvbmRpdGlvbmFsbHkgaW5pdGlhbGl6ZSBzcGlubmVyIGRpdjsgZGVncmFkZXMgZ3JhY2VmdWxseSBpZiBzcGluLmpzIG5vdCBmb3VuZAogICAgc3Bpbm5lcjogZnVuY3Rpb24oKXsKICAgICAgaWYgKCAkLmlzRnVuY3Rpb24od2luZG93LlNwaW5uZXIpICkgewogICAgICAgIHRoaXMuY29udGVudC5iZWZvcmUoJzxkaXYgaWQ9InNwaW5uZXIiIHN0eWxlPSJwb3NpdGlvbjogZml4ZWQ7IGhlaWdodDogMTAwJTsgd2lkdGg6IDEwMCU7Ij48L2Rpdj4nKTsKICAgICAgICAkKCcjc3Bpbm5lcicpLnNwaW4odGhpcy5vcHRzLnNwaW5PcHRzKS5oaWRlKCk7CiAgICAgIH0KICAgIH0sCgoKCiAgICAvLyBUaGlzIGZ1bmN0aW9uIGR5bmFtaWNhbGx5IGxvYWRzIGNvbnRlbnQgZnJvbSB0aGUgcmVxdWVzdGVkIHBhZ2UKICAgIGxvYWQ6IGZ1bmN0aW9uKHVybCl7CiAgICAgIHZhcgogICAgICAgIHNlbGYgICAgICAgPSB0aGlzLAogICAgICAgICRib2R5ICAgICAgPSAkKGRvY3VtZW50LmJvZHkpLAogICAgICAgICRzcGlubmVyICAgPSAkKCcjc3Bpbm5lcicpLAogICAgICAgIGNvbnRlbnRTZWwgPSB0aGlzLm9wdHMuY29udGVudFNlbCwKICAgICAgICBtZW51U2VsICAgID0gdGhpcy5vcHRzLm1lbnVTZWw7CgogICAgICAvLyBKdXN0IGluIGNhc2UgaXQgd2Fzbid0IHNldAogICAgICB1cmwgPSB1cmwgfHwgbG9jYXRpb24uaHJlZjsKCiAgICAgIC8vIEZhZGUgb3V0IGV4aXN0aW5nIGNvbnRlbnQ7IHVzZSBhbmltYXRlIHRvIHByZXNlcnZlIHRoZSBlbGVtZW50J3MgaGVpZ2h0IChhdm9pZHMgc2Nyb2xsYmFyIGZsaWNrZXIpCiAgICAgIHRoaXMuY29udGVudC5hbmltYXRlKHsgb3BhY2l0eTogdGhpcy5vcHRzLm91dE9wYWNpdHkgfSwgdGhpcy5vcHRzLm91dERlbGF5KTsKCiAgICAgIC8vIFNwaW4gc3BpbiBzdWdhcjsgbm8gZGVsYXkgbmVlZGVkIGhlcmUKICAgICAgJHNwaW5uZXIuc2hvdygpOwoKICAgICAgLy8gQUpBWCBwYWdlIHJlcXVlc3Q7IGZldGNoIHRoZSBjb250ZW50IHdlIG5lZWQKICAgICAgJC5hamF4KHsKICAgICAgICB1cmw6IHVybCwKICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhLHRleHRTdGF0dXMsanFYSFIpewogICAgICAgICAgdmFyCiAgICAgICAgICAgICRkYXRhICAgICAgICAgPSAkKHNlbGYuZG9jSGVscChkYXRhKSksCiAgICAgICAgICAgICRkb2NCb2R5ICAgICAgPSAkZGF0YS5maW5kKCcjZG9jLWJvZHk6Zmlyc3QnKSwKICAgICAgICAgICAgJGNvbnRlbnQgICAgICA9ICRkb2NCb2R5LmZpbmQoY29udGVudFNlbCkuZmlsdGVyKCc6Zmlyc3QnKS5odG1sKCkgfHwgJGRhdGEuaHRtbCgpOwoKICAgICAgICAgIC8vIElmIG5vIGNvbnRlbnQgaXMgcmVjZWl2ZWQgZm9yIGFueSByZWFzb24gbGV0J3MgZm9yd2FyZCB0aGUgdXNlciBvbiB0byB0aGUgdGFyZ2V0IFVSTAogICAgICAgICAgaWYgKCEkY29udGVudCkgewogICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gdXJsOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gUXVpY2tseSBmYWRlIGNvbnRlbnQgb3V0IGVudGlyZWx5CiAgICAgICAgICBzZWxmLmNvbnRlbnQuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMjApOwoKICAgICAgICAgIC8vIFN0b3AgYW5pbWF0aW9uIGltbWVkaWF0ZWx5CiAgICAgICAgICBzZWxmLmNvbnRlbnQuc3RvcCh0cnVlLHRydWUpOwoKICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgY29udGVudCBhbmQgcHJlcCBldmVudCBoYW5kbGVycwogICAgICAgICAgc2VsZi5wcmVwKCBzZWxmLmNvbnRlbnQuaHRtbCgkY29udGVudCkgKTsKCiAgICAgICAgICAvLyBTd2FwIHRoZSBtZW51KHMpIGFuZCBwcmVwIGV2ZW50IGhhbmRsZXJzCiAgICAgICAgICBzZWxmLnByZXAoICQobWVudVNlbCkuaHRtbCggJGRvY0JvZHkuZmluZChtZW51U2VsKS5odG1sKCkgKSApOwoKICAgICAgICAgIC8vIEhhcm1vbml6ZSBib2R5IGNsYXNzZXM7IG1ha2VzIFdvcmRQcmVzcyBwYWdlcyByZW5kZXIgc21vb3RobHkgYnV0IGFsc28gZ2VuZXJhbGx5IHVzZWZ1bAogICAgICAgICAgJGJvZHkuYXR0cignY2xhc3MnLCAkZG9jQm9keS5hdHRyKCdjbGFzcycpKTsKCiAgICAgICAgICAvLyBGYWRlIHRoZSBjb250ZW50IGJhY2sgaW4KICAgICAgICAgIHNlbGYuY29udGVudC5hbmltYXRlKHsgb3BhY2l0eTogMSwgdmlzaWJpbGl0eTogInZpc2libGUiIH0sIHNlbGYub3B0cy5pbkRlbGF5KTsKCiAgICAgICAgICAvLyBVcGRhdGUgYm9keSBzY3JpcHRzIG91dHNpZGUgb2YgdGhlIGNvbnRlbnQgYXJlYQogICAgICAgICAgc2VsZi5zY3JpcHRzKCAkZG9jQm9keS5maW5kKCdzY3JpcHQnKS5ub3QoY29udGVudFNlbCsnIHNjcmlwdCcpICk7CgogICAgICAgICAgLy8gVXBkYXRlIGRvY3VtZW50IHRpdGxlCiAgICAgICAgICBzZWxmLnRpdGxlKCAkZGF0YS5maW5kKCcjZG9jLXRpdGxlOmZpcnN0JykudGV4dCgpICk7CiAgICAgICAgfSwKCiAgICAgICAgLy8gRXJyb3IgaGFuZGxpbmc7IGZhbGwgYmFjayBvbiByZWd1bGFyIHBhZ2UgbG9hZCBpZiBhbnl0aGluZyBnb2VzIHdyb25nCiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGpxWEhSLHRleHRTdGF0dXMsZXJyb3JUaHJvd24pewogICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IHVybDsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LCAvLyBlbmQgZXJyb3IgaGFuZGxpbmcKCiAgICAgICAgLy8gQ2xlYW4gdXAgYWZ0ZXIgY29tcGxldGluZyB0aGUgQUpBWCBjYWxsCiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGpxWEhSLHRleHRTdGF0dXMpewoKICAgICAgICAgIC8vIEZhZGUgb3V0IHNwaW5uZXIKICAgICAgICAgICRzcGlubmVyLmZhZGVPdXQoc2VsZi5vcHRzLnNwaW5GYWRlLCBmdW5jdGlvbigpeyAkKHRoaXMpLmhpZGUoKTsgfSk7CgogICAgICAgICAgLy8gU2Nyb2xsIHRvIHRoZSBhcHByb3ByaWF0ZSBsb2NhdGlvbgogICAgICAgICAgc2VsZi5zY3JvbGwoKTsKCiAgICAgICAgICAvLyBVcGRhdGUgYW5hbHl0aWNzCiAgICAgICAgICBzZWxmLmFuYWx5dGljcyh1cmwpOwoKICAgICAgICB9IC8vIGVuZCBjb21wbGV0ZQoKICAgICAgfSk7IC8vIGVuZCAkLmFqYXgKCiAgICB9LCAvLyBlbmQgbG9hZCgpCgoKCiAgICAvLyBVcGRhdGUgc2NyaXB0cwogICAgc2NyaXB0czogZnVuY3Rpb24oJHNjcmlwdHMpewogICAgICB2YXIKICAgICAgICAkYm9keSAgICAgICA9ICQoJ2JvZHknKSwKICAgICAgICBjb250ZW50U2NyICA9IHRoaXMub3B0cy5jb250ZW50U2VsICsgJyBzY3JpcHQnOyAvLyBTZWxlY3RzIGNvbnRlbnQgc2NyaXB0cwoKICAgICAgLy8gRmV0Y2ggYm9keSBzY3JpcHRzIG5vdCBpbiB0aGUgY29udGVudCAod2hpY2ggd2lsbCBiZSByZXBsYWNlZCBhbnlob3cpCiAgICAgIGlmICggJHNjcmlwdHMubGVuZ3RoICkgewogICAgICAgICRzY3JpcHRzLmRldGFjaCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gUXVpdCB3aGlsZSB5b3UncmUgYWhlYWQKICAgICAgfQoKICAgICAgLy8gVXBkYXRlIHRoZSBib2R5IHNjcmlwdHMgb3V0c2lkZSBvZiB0aGUgY29udGVudCBhcmVhOyB3ZSdyZSBhc3N1bWluZyB0aGF0IGhlYWRlciBzY3JpcHRzIGRvbid0IGNoYW5nZQogICAgICAkc2NyaXB0cy5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsKCiAgICAgICAgLy8gSWYgdGhlIGN1cnJlbnQgc2NyaXB0IGlzbid0IGVtcHR5IHdlIGFzc3VtZSBpdCBtdXN0IGJlIGlubGluZQogICAgICAgIGlmICggJycgIT09ICR0aGlzLmh0bWwoKSApIHsKCiAgICAgICAgICAvLyBTYXZlIHRoZSBjdXJyZWN0IHNjcmlwdCBjb250ZW50cyBmb3IgdXNlIGluIHRoZSBsb29wIHRvIGZvbGxvdwogICAgICAgICAgdmFyCiAgICAgICAgICAgIGlubGluZVNjcmlwdCA9ICR0aGlzLmh0bWwoKSwKICAgICAgICAgICAgaXNOZXcgICAgICAgID0gdHJ1ZTsKCiAgICAgICAgICAvLyBDaGVjayBleGlzdGluZyBzY3JpcHRzIHRvIHNlZSBpZiB0aGV5IGNvbnRhaW4gdGhlIHNhbWUgc3R1ZmYKICAgICAgICAgICQuZWFjaCggJGJvZHkuZmluZCgnc2NyaXB0Om5vdCg6ZW1wdHkpJykubm90KGNvbnRlbnRTY3IpLCBmdW5jdGlvbigpewogICAgICAgICAgICBpZiAoICR0aGlzLmh0bWwoKSA9PT0gaW5saW5lU2NyaXB0ICkgewogICAgICAgICAgICAgIGlzTmV3ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIFBhc3RlIG5ldyBzdHVmZiBpbiBpZiBpdCBpc24ndCBmb3VuZCBpbiB0aGUgY3VycmVudCBET007IHRoaXMgaXMgcXVpdGUgYSBrbHVkZ2UKICAgICAgICAgIGlmICggaXNOZXcgPT09IHRydWUgKSB7CiAgICAgICAgICAgICRib2R5LmZpbmQoJ3NjcmlwdDpub3QoOmVtcHR5KScpLm5vdChjb250ZW50U2NyKS5maWx0ZXIoJzpmaXJzdCcpLmJlZm9yZSgnPHNjcmlwdD4nICsgJHRoaXMuaHRtbCgpICsgJzwvc2NyaXB0PicpOwogICAgICAgICAgfQoKICAgICAgICAvLyBGZXRjaCBuZXcgbm9uLWlubGluZSBzY3JpcHRzCiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAvLyBUZXN0IGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFjaCBzY3JpcHQ7IG5vIHNlbnNlIGluIHJlcGVhdGluZyBvdXJzZWx2ZXMgaGVyZQogICAgICAgICAgaWYgKCAhJGJvZHkuZmluZCgnc2NyaXB0W3NyYyo9IicgKyAkdGhpcy5hdHRyKCdzcmMnKSArICciXScpLmxlbmd0aCApIHsKICAgICAgICAgICAgLy8gJC5nZXRTY3JpcHQgZG9lcyBub3QgY2FjaGUgc2NyaXB0cyBieSBkZWZhdWx0IHNvIHdlJ2xsIHNraXAgdGhlIHNob3J0Y3V0IGFuZCBnbyBzdHJhaWdodCB0byB0aGUgc291cmNlCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgdXJsOiAkdGhpcy5hdHRyKCdzcmMnKSwKICAgICAgICAgICAgICBkYXRhVHlwZTogInNjcmlwdCIsCiAgICAgICAgICAgICAgY2FjaGU6IHRydWUsCiAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKCl7IC8vIEluIGNhc2UgY2FjaGluZyBpc24ndCB3b3JraW5nLi4uIGFkZCB0aGUgc2NyaXB0IHRvIHRoZSBET00KICAgICAgICAgICAgICAgIHZhciBuZXdTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICAgICAgICAgIG5ld1NjcmlwdC5zcmMgPSAkdGhpcy5hdHRyKCdzcmMnKTsgLy8gTm8gbmVlZCBmb3IgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBpbiBIVE1MNQogICAgICAgICAgICAgICAgJGJvZHlbMF0uYXBwZW5kQ2hpbGQobmV3U2NyaXB0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOyAvLyBlbmQgJC5hamF4KCkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOyAvLyBlbmQgJHNjcmlwdHMuZWFjaCgpCiAgICB9LCAvLyBlbmQgc2NyaXB0cygpCgoKCiAgICAvLyBVcGRhdGUgZG9jdW1lbnQgdGl0bGUKICAgIHRpdGxlOiBmdW5jdGlvbigkdGl0bGUpewogICAgICBkb2N1bWVudC50aXRsZSA9ICR0aXRsZQogICAgICAgIC5yZXBsYWNlKCc8JywnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoJz4nLCcmZ3Q7JykKICAgICAgICAucmVwbGFjZSgnJicsJyZhbXA7JykKICAgICAgOwogICAgfSwgLy8gZW5kIHRpdGxlKCkKCgoKICAgIC8vIFVwZGF0ZSBzY3JvbGwgcG9zaXRpb24KICAgIHNjcm9sbDogZnVuY3Rpb24oKXsKICAgICAgdmFyCiAgICAgICAgJGJvZHkgICAgICAgPSAkKCdib2R5JyksCiAgICAgICAgJGNvbnRlbnQgICAgPSAkKHRoaXMub3B0cy5jb250ZW50U2VsKSwKICAgICAgICBzY3JvbGxEZWxheSA9IHRoaXMub3B0cy5zY3JvbGxEZWxheTsKCiAgICAgIC8vIFRlc3QgZm9yIHRoZSBwcmVzZW5jZSBvZiBhIGhhc2ggaW4gdGhlIFVSTAogICAgICBpZiAobG9jYXRpb24uaGFzaCAmJiBsb2NhdGlvbi5oYXNoICE9PSAnJykgewoKICAgICAgICAvLyBEZWZpbmUgdGhlIHNlbGVjdG9yCiAgICAgICAgdmFyICRoYXNoID0gJCgnW2lkPSInK2xvY2F0aW9uLmhhc2guc3Vic3RyaW5nKDEpKyciXScpOwoKICAgICAgICAvLyBUZXN0IHdoZXRoZXIgdGhlIHNlbGVjdG9yIGV4aXN0czsgZmFsbCBiYWNrIG9uIHJlZ3VsYXIgc2Nyb2xsIHJvdXRpbmUgaWYgbm90CiAgICAgICAgaWYgKCAkaGFzaC5sZW5ndGggKSB7CiAgICAgICAgICAkYm9keS5hbmltYXRlKHsgc2Nyb2xsVG9wOiAkaGFzaC5vZmZzZXQoKS50b3AgfSwgc2Nyb2xsRGVsYXksICJzd2luZyIpOyAvLyBAVE9ETzogZGVsYXkgc2Nyb2xsIHRvIGFsbG93IGltYWdlcyB0byBsb2FkPwogICAgICAgIH0gZWxzZSBpZiAoICggJCh3aW5kb3cpLnNjcm9sbFRvcCgpID4gJGNvbnRlbnQub2Zmc2V0KCkudG9wICkgKSB7CiAgICAgICAgICAkYm9keS5hbmltYXRlKHsgc2Nyb2xsVG9wOiAkY29udGVudC5vZmZzZXQoKS50b3AgfSwgc2Nyb2xsRGVsYXksICJzd2luZyIpOwogICAgICAgIH0KCiAgICAgIC8vIFNjcm9sbCB0byB0aGUgdG9wIG9mIHRoZSBjb250ZW50IGNvbnRhaW5lciB3aGVuIGJlbG93IHRoZSBmb2xkCiAgICAgIH0gZWxzZSBpZiAoICggJCh3aW5kb3cpLnNjcm9sbFRvcCgpID4gJGNvbnRlbnQub2Zmc2V0KCkudG9wICkgKSB7CiAgICAgICAgJGJvZHkuYW5pbWF0ZSh7IHNjcm9sbFRvcDogJGNvbnRlbnQub2Zmc2V0KCkudG9wIH0sIHNjcm9sbERlbGF5LCAic3dpbmciKTsKICAgICAgfQoKICAgIH0sIC8vIGVuZCBzY3JvbGwoKQoKCgogICAgLy8gVXBkYXRlIEdvb2dsZSBBbmFseXRpY3Mgb24gY29udGVudCBsb2FkCiAgICBhbmFseXRpY3M6IGZ1bmN0aW9uKHVybCl7CiAgICAgIHZhciByZWxhdGl2ZVVybCA9ICcvJyArIHVybC5yZXBsYWNlKHRoaXMucm9vdCgpLCAnJyk7IC8vIFNldCB0aGUgcmVsYXRpdmUgVVJMIHJlcXVpcmVkIGJ5IEdvb2dsZSBBbmFseXRpY3MKCiAgICAgIC8vIEluZm9ybSBHb29nbGUgQW5hbHl0aWNzIG9mIHRoZSBjaGFuZ2U7IGNvbXBhdGlibGUgd2l0aCB0aGUgbmV3IFVuaXZlcnNhbCBBbmFseXRpY3Mgc2NyaXB0CiAgICAgIGlmICggdHlwZW9mIHdpbmRvdy5nYSAhPT0gJ3VuZGVmaW5lZCcgKSB7CiAgICAgICAgd2luZG93LmdhKCdzZW5kJywgJ3BhZ2V2aWV3JywgcmVsYXRpdmVVcmwpOwogICAgICB9IGVsc2UgaWYgKCB0eXBlb2Ygd2luZG93Ll9nYXEgIT09ICd1bmRlZmluZWQnICkgewogICAgICAgIHdpbmRvdy5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldycsIHJlbGF0aXZlVXJsXSk7IC8vIExlZ2FjeSBhbmFseXRpY3M7IHJlZjogaHR0cHM6Ly9naXRodWIuY29tL2Jyb3dzZXJzdGF0ZS9hamF4aWZ5L3B1bGwvMjUKICAgICAgfQogICAgfSwgLy8gZW5kIGFuYWx5dGljcygpCgoKCiAgICAvLyBEb2N1bWVudCBoZWxwZXI7IGJyb3dzZXJzIG9mdGVuIHN0cmlwIG91dCBodG1sLCBoZWFkLCBib2R5LCB0aXRsZSwgYmFzZSwgYW5kIG1ldGEgdGFncyB3aGVuIHVzaW5nIC5pbm5lckhUTUw7IHNlZSBodHRwczovL2FwaS5qcXVlcnkuY29tL2xvYWQvCiAgICAvLyBUaGlzIGZ1bmN0aW9uIGFsbG93cyBhY2Nlc3MgdG8gdGhlc2UgdGFncyBieSB0cmFuc2Zvcm1pbmcgdGhlbSB0byBkaXZzIHdpdGggaWRzIHRoYXQgbWF0Y2ggdGhlIG9yaWdpbmFsIGUuZy4gI2RvYy10aXRsZQogICAgLy8gU2VlIGFsc286IGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2Nvd2JveS83NDI5NTIvCiAgICBkb2NIZWxwOiBmdW5jdGlvbihodG1sKXsKICAgICAgdmFyCiAgICAgICAgcmVzdWx0ID0gU3RyaW5nKGh0bWwpCiAgICAgICAgICAucmVwbGFjZSgvPFwhRE9DVFlQRVtePl0qPi9pLCAnJykKICAgICAgICAgIC5yZXBsYWNlKC88KGh0bWx8aGVhZHxib2R5fHRpdGxlfGJhc2V8bWV0YSkoW1xzXD5dKS9naSwnPGRpdiBpZD0iZG9jLSQxIiQyJykKICAgICAgICAgIC5yZXBsYWNlKC88XC8oaHRtbHxoZWFkfGJvZHl8dGl0bGV8YmFzZXxtZXRhKVw+L2dpLCc8L2Rpdj4nKQogICAgICA7CiAgICAgIHJldHVybiAkLnRyaW0ocmVzdWx0KTsKICAgIH0sIC8vIGVuZCBkb2NIZWxwKCkKCgoKICAgIC8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gZ2V0IHRoZSByb290IFVSTCB3aXRoIHRyYWlsaW5nIHNsYXNoIGUuZy4gaHR0cChzKTovL3lvdXJkb21haW4uY29tLwogICAgcm9vdDogZnVuY3Rpb24oKXsKICAgICAgdmFyCiAgICAgICAgcG9ydCA9IGRvY3VtZW50LmxvY2F0aW9uLnBvcnQgPyAnOicgKyBkb2N1bWVudC5sb2NhdGlvbi5wb3J0IDogJycsCiAgICAgICAgdXJsID0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgKGRvY3VtZW50LmxvY2F0aW9uLmhvc3RuYW1lIHx8IGRvY3VtZW50LmxvY2F0aW9uLmhvc3QpICsgcG9ydCArICcvJzsKICAgICAgcmV0dXJuIHVybDsKICAgIH0gLy8gZW5kIHJvb3QoKQoKICB9OyAvLyBlbmQgQWpheGluYXRlLnByb3RvdHlwZQoKCgogIC8vIEEgbGlnaHR3ZWlnaHQgcGx1Z2luIHdyYXBwZXIgYXJvdW5kIHRoZSBjb25zdHJ1Y3RvciBwcmV2ZW50aW5nIG11bHRpcGxlIGluc3RhbnRpYXRpb25zCiAgJC5mbi5hamF4aW5hdGUgPSBmdW5jdGlvbiAob3B0cyl7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgIGlmICghJC5kYXRhKHRoaXMsICdYTjhfYWpheGluYXRlJykpIHsKICAgICAgICAkLmRhdGEodGhpcywgJ1hOOF9hamF4aW5hdGUnLCBuZXcgQWpheGluYXRlKHRoaXMsIG9wdHMpKTsKICAgICAgfQogICAgfSk7CiAgfTsKCgoKICAvLyBFeHRlbnNpYmxlIGRlZmF1bHQgc2V0dGluZ3MKICAkLmZuLmFqYXhpbmF0ZS5kZWZhdWx0cyA9IHsKICAgIGNvbnRlbnRTZWw6ICAgICcjY29udGVudCcgLy8gVGhlIHNlbGVjdG9yIGZvciBhbGwgcGFnZSBjb250ZW50cwogICwgbWVudVNlbDogICAgICAgJyNtZW51JyAgICAvLyBUaGUgc2VsZWN0b3IgZm9yIHRoZSBlbnRpcmUgbWVudQogICwgb3V0RGVsYXk6ICAgICAgNjAwCiAgLCBvdXRPcGFjaXR5OiAgICAwLjIKICAsIGluRGVsYXk6ICAgICAgIDEyMAogICwgc2Nyb2xsRGVsYXk6ICAgMzAwCiAgLCBzcGluRmFkZTogICAgICAzMDAgICAgICAgIC8vIFNwaW5uZXIgZmFkZSBvdXQgZHVyYXRpb24KICAsIHNwaW5PcHRzOiB7ICAgICAgICAgICAgICAgLy8gc3Bpbi5qcyBvcHRpb25zOyByZWZlcmVuY2U6IGh0dHBzOi8vZmduYXNzLmdpdGh1Yi5pby9zcGluLmpzLwogICAgICBsaW5lczogIDI1CiAgICAsIGxlbmd0aDogMAogICAgLCB3aWR0aDogIDQKICAgICwgcmFkaXVzOiAyNQogICAgLCBzcGVlZDogIDEuNQogICAgLCB0cmFpbDogIDQwCiAgICAsIHRvcDogICAgJzI1JScKICB9CgogIC8vIFdoaXRlbGlzdGVkIGV4dGVuc2lvbnMgKHJlZ2V4cCk7IHRoZXNlIHdpbGwgbmVnYXRlIHRoZSBjdXN0b20gImludGVybmFsIiBzZWxlY3RvcgogICwgZXhjZXB0aW9uczogL1wuKGpwZ3xqcGVnfHBuZ3xnaWZ8Ym1wfHBkZnxtcDN8ZmxhY3x3YXZ8cmFyfHppcCkkL2kKCiAgLy8gQWRkaXRpb25hbCBzZWxlY3RvcnMgdG8gZmlsdGVyIHdoZW4gYmluZGluZyBldmVudHMgKHN0cmluZyk7IHVzZSAiOm5vdChzZWxlY3RvcikiLCBmb3IgZXhhbXBsZSwgdG8gc2tpcCBjZXJ0YWluIHNlbGVjdG9ycyBlLmcuIGA6bm90KFtocmVmKj0idGVzdCJdKWAgZXRjLgogICwgZmlsdGVyczogJycKICB9OwoKfSkuYXBwbHkoWE44LCBbalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50XSk7CgovLyA9PT09IEFKQVhJTkFURSBXT1JEUFJFU1MgRVhURU5TSU9OID09PT0gLy8KCi8vIEF1Z21lbnRzIHRoZSBBamF4aW5hdGUgc2NyaXB0IHRvIGhhbmRsZSBzZXZlcmFsIHNjZW5hcmlvcyB1bmlxdWUgdG8gV29yZFByZXNzCi8vIE11c3QgYmUgY2FsbGVkICphZnRlciogdGhlIG1haW4gQWpheGluYXRlIHNjcmlwdDsgYXNzdW1lcyBYTjggaXMgYWxyZWFkeSBkZWZpbmVkCgo7KGZ1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCl7CiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgUFQgPSBYTjguQWpheGluYXRlLnByb3RvdHlwZTsKCiAgLy8gSG9vayBpbnRvIHByZXAgdG8gYWRkIFdvcmRQcmVzcy1zcGVjaWZpYyBtZXRob2RzCiAgUFQuX3ByZXAgPSBQVC5wcmVwOwogIFBULnByZXAgPSBmdW5jdGlvbihlbGVtZW50KXsKICAgIHRoaXMuX3ByZXAoZWxlbWVudCk7CiAgICB0aGlzLndwQXJjaGl2ZXMoZWxlbWVudCk7CiAgICB0aGlzLndwU2VhcmNoKGVsZW1lbnQpOwogIH07IC8vIGVuZCBwcmVwKCkKCgoKICAvLyBVUkwgZW5jb2RlIGZ1bmN0aW9uIHRvIGVtdWxhdGUgV1AncyBzZWFyY2ggcmV3cml0ZTsgdmlhOiBodHRwOi8vcGhwanMub3JnL2Z1bmN0aW9ucy91cmxlbmNvZGUvCiAgUFQuZW5jb2RlID0gZnVuY3Rpb24oc3RyKXsKICAgIHN0ciA9IChzdHIrJycpLnRvU3RyaW5nKCk7CiAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cikKICAgICAgLnJlcGxhY2UoLyEvZywgJyUyMScpCiAgICAgIC5yZXBsYWNlKC8nL2csICclMjcnKQogICAgICAucmVwbGFjZSgvXCgvZywgJyUyOCcpCiAgICAgIC5yZXBsYWNlKC9cKS9nLCAnJTI5JykKICAgICAgLnJlcGxhY2UoL1wqL2csICclMkEnKQogICAgICAucmVwbGFjZSgvJTIwL2csICcrJyk7CiAgfTsgLy8gZW5kIGVuY29kZSgpCgoKCiAgLy8gV29yZFByZXNzIGFyY2hpdmUgZHJvcGRvd24gaGFuZGxlcjsgZm9yIHVzZSB3aXRoIHRoZSBhcmNoaXZlIHdpZGdldDsgZG9uJ3QgdXNlIHdpdGggdGhlIGNhdGVnb3J5IHdpZGdldCwgdGhlIGNvZGUgaXMgY29tcGxldGVseSBkaWZmZXJlbnQKICBQVC53cEFyY2hpdmVzID0gZnVuY3Rpb24oZWxlbWVudCl7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgJChlbGVtZW50KS5maW5kKCdzZWxlY3RbbmFtZSQ9ImRyb3Bkb3duIl0nKQogICAgLnJlbW92ZUF0dHIoJ29uY2hhbmdlJykgLy8gRGl0Y2ggdGhlIGRlZmF1bHQgSmF2YVNjcmlwdCBldmVudCBoYW5kbGVyCiAgICAub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgdmFyIHVybCAgID0gJCh0aGlzKS52YWwoKSwKICAgICAgICAgIHRpdGxlID0gJCh0aGlzKS5maW5kKCc6c2VsZWN0ZWQnKS50ZXh0KCkudHJpbSgpIHx8IG51bGw7CgogICAgICBzZWxmLnB1c2hlcih0aXRsZSx1cmwsZXZlbnQpOwogICAgfSk7CiAgfTsgLy8gZW5kIHdwRHJvcGRvd24oKQoKCgogIC8vIFdvcmRQcmVzcyBzZWFyY2ggZm9ybTsgeW91IG1heSBuZWVkIHRvIGN1c3RvbWl6ZSB0aGlzIHRvIHN1aXQgeW91ciBvd24gdGhlbWUKICBQVC53cFNlYXJjaCA9IGZ1bmN0aW9uKGVsZW1lbnQpewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICQoZWxlbWVudCkuZmluZChzZWxmLm9wdHMuc2VhcmNoU2VsKQogICAgLm9uKCdzdWJtaXQnLCBmdW5jdGlvbihldmVudCl7CiAgICAgIHZhcgogICAgICAgIHVybCA9ICcnLAogICAgICAgIHMgPSAkKCdpbnB1dFt0eXBlPSJzZWFyY2giXScsIHRoaXMpLnZhbCgpIHx8IG51bGw7CgogICAgICAvLyBJZiB0aGUgZm9ybSB3YXMgc3VibWl0dGVkIHdpdGhvdXQgY29udGVudCBmb2N1cyBvbiB0aGUgc2VhcmNoIGZpZWxkCiAgICAgIGlmIChzID09PSBudWxsKSB7CgogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgJCgnaW5wdXRbdHlwZT0ic2VhcmNoIl0nLCB0aGlzKS5mb2N1cygpOwoKICAgICAgLy8gU2V0dXAgb3VyIHNlYXJjaCBVUkwKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIHNlbGYub3B0cy5zZWFyY2hCYXNlICYmIHNlbGYub3B0cy5zZWFyY2hCYXNlICE9PSAnJyApIHsKICAgICAgICAgIHVybCA9IHNlbGYucm9vdCgpICsgc2VsZi5vcHRzLnNlYXJjaEJhc2UgKyAiLyIgKyBzZWxmLmVuY29kZShzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdXJsID0gc2VsZi5yb290KCkgKyAiP3M9IiArIHM7CiAgICAgICAgfQoKICAgICAgICAvLyBMYXVuY2ggd2l0aG91dCB0aXRsZQogICAgICAgIHNlbGYucHVzaGVyKG51bGwsdXJsLGV2ZW50KTsKICAgICAgfQogICAgfSk7CiAgfTsgLy8gZW5kIHdwU2VhcmNoKCkKCgoKICAvLyBTZWFyY2ggZm9ybSBzZWxlY3RvcgogICQuZm4uYWpheGluYXRlLmRlZmF1bHRzLnNlYXJjaFNlbCAgPSAnLnNlYXJjaC1mb3JtJzsKCiAgLy8gU2VhcmNoIHJld3JpdGUgYmFzZTsgZm9yIHVzZSB3aXRoIHBlcm1hbGlua3MgZm9yIHNlYXJjaCBlLmcuIGh0dHA6Ly95b3Vyc2l0ZS5jb20vc2VhcmNoL3Rlc3RpbmcrdGhpczsKICAkLmZuLmFqYXhpbmF0ZS5kZWZhdWx0cy5zZWFyY2hCYXNlID0gJ3NlYXJjaCc7CgogIC8vIFdvcmRQcmVzcy1zcGVjaWZpYyBleGNlcHRpb25zOyB0aGVyZSBhcmUgbW9yZSBlZmZpY2llbnQgd2F5cyB0byBkbyB0aGlzIHNvcnQgb2YgdGhpbmcgYnV0IHRoaXMgaXMgZWFzaWVyIHRvIGNvbmZpZ3VyZQogICQuZm4uYWpheGluYXRlLmRlZmF1bHRzLmZpbHRlcnMgICAgPSAkLmZuLmFqYXhpbmF0ZS5kZWZhdWx0cy5maWx0ZXJzICsgJzpub3QoW2hyZWYqPSJ3cC1sb2dpbiJdLCBbaHJlZio9IndwLWFkbWluIl0sIFtocmVmKj0icmVwbHl0b2NvbSJdLCBbaWQqPSJjYW5jZWwtY29tbWVudC1yZXBseS1saW5rIl0sIFtocmVmJD0iL2ZlZWQvIl0pJzsKCn0pLmFwcGx5KFhOOCwgW2pRdWVyeSwgd2luZG93LCBkb2N1bWVudF0pOwo=",
                "body": "Ly8gPT09PSBBSkFYSU5BVEUgPT09PSAvLwoKLy8gRG9jdW1lbnRhdGlvbjogaHR0cHM6Ly9naXRodWIuY29tL3N5bmFwdGljaXNtL2FqYXhpbmF0ZQoKLy8gR2xvYmFsIG5hbWVzcGFjZSBvYmplY3QKdmFyIFhOOCA9IHt9OwoKOyhmdW5jdGlvbigkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpewogICd1c2Ugc3RyaWN0JzsKCiAgLy8gSW5pdGlhbGl6ZSBIVE1MNS1IaXN0b3J5LUFQSSBwb2x5ZmlsbCB3aXRoIHRoaXMgc2luZ2xlIGxpbmUKICB2YXIgbG9jYXRpb24gPSB3aW5kb3cuaGlzdG9yeS5sb2NhdGlvbiB8fCB3aW5kb3cubG9jYXRpb247CgogIC8vIENoZWNrIHRvIHNlZSBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyB0aGUgSFRNTDUgaGlzdG9yeSBBUEk7IGlmIG5vdCwgZmFpbCBlYXJseSBhbmQgbGV0IHRoZSBzaXRlIGxvYWQgbm9ybWFsbHkKICBpZiAoICEod2luZG93Lmhpc3RvcnkgJiYgaGlzdG9yeS5wdXNoU3RhdGUpICkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLy8gQ29uc3RydWN0b3IgZnVuY3Rpb24KICB2YXIgQWpheGluYXRlID0gdGhpcy5BamF4aW5hdGUgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRzKXsKICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7CiAgICB0aGlzLm9wdHMgPSAkLmV4dGVuZCh7fSwgJC5mbi5hamF4aW5hdGUuZGVmYXVsdHMsIG9wdHMpOwogICAgdGhpcy5pbml0KCk7CiAgfTsKCiAgLy8gUHJvdG90eXBlIGxvZ2ljCiAgQWpheGluYXRlLnByb3RvdHlwZSA9IHsKICAgIGluaXQ6IGZ1bmN0aW9uKCl7CgogICAgICAvLyBGZXRjaCBpbml0aWFsIGNvbnRlbnQKICAgICAgdGhpcy5jb250ZW50ID0gJCh0aGlzLm9wdHMuY29udGVudFNlbCkuZmlsdGVyKCc6Zmlyc3QnKTsKCiAgICAgIC8vIEVuc3VyZSBjb250ZW50IGlzbid0IGVtcHR5OyBpZiBpdCBpcywgdXNlIHRoZSBjdXJyZW50IGRvY3VtZW50IGNvbnRlbnRzCiAgICAgIGlmICggdGhpcy5jb250ZW50Lmxlbmd0aCA9PT0gMCApIHsKICAgICAgICB0aGlzLmNvbnRlbnQgPSAkKGRvY3VtZW50LmJvZHkpOwogICAgICB9CgogICAgICAvLyBJbml0aWFsaXplIGludGVybmFsIGxpbmsgc2VsZWN0b3IKICAgICAgdGhpcy5pbnRlcm5hbFNlbCgpOwoKICAgICAgLy8gSW5pdGlhbGl6ZSBldmVudCBoYW5kbGVycyBmb3IgdGhlIGVsZW1lbnQocykgc3BlY2lmaWVkCiAgICAgIHRoaXMucHJlcCh0aGlzLmVsZW1lbnQpOwoKICAgICAgLy8gSW5pdGlhbGl6ZSBwb3BzdGF0ZSBldmVudCBoYW5kbGVyCiAgICAgIHRoaXMucG9wVGhpcygpOwoKICAgICAgLy8gSW5pdGlhbGl6ZSBzcGlubmVyCiAgICAgIHRoaXMuc3Bpbm5lcigpOwogICAgfSwKCgoKICAgIC8vIEludGVybmFsIGxpbmsgc2xlY3RvcgogICAgaW50ZXJuYWxTZWw6IGZ1bmN0aW9uKCl7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIC8vIFJlZ2lzdGVyIHRoZSBjdXN0b20gc2VsZWN0b3IgdG8gaWRlbnRpZnkgaW50ZXJuYWwgbGlua3MKICAgICAgJC5leHByWyc6J10uaW50ZXJuYWwgPSBmdW5jdGlvbihvYmosaW5kZXgsbWV0YSxzdGFjayl7CiAgICAgICAgdmFyCiAgICAgICAgICAkdGhpcyAgID0gJChvYmopLAogICAgICAgICAgdXJsICAgICA9ICR0aGlzLmF0dHIoJ2hyZWYnKSB8fCAnJywKICAgICAgICAgIHJvb3R1cmwgPSBzZWxmLnJvb3QoKSwKICAgICAgICAgIGlzSW50ZXJuYWw7CgogICAgICAgIC8vIFRlc3QgdGhlIGxpbms6CiAgICAgICAgLy8gLSBDaGVjayB3aGV0aGVyIHRoZSBkb21haW5zIGFyZSB0aGUgc2FtZQogICAgICAgIC8vIC0gQ2hlY2sgd2hldGhlciB0aGUgbGluayBpcyByZWxhdGl2ZSAoZS5nLiBkb2VzIG5vdCBjb250YWluIGh0dHAocyk6Ly8pCiAgICAgICAgLy8gLSBDaGVjayB3aGV0aGVyIHRoZSBsaW5rIGJlZ2lucyB3aXRoIGEgaGFzaCAoIykKICAgICAgICAvLyAtIEZpbHRlciBjZXJ0YWluIGZpbGUgZXh0ZW5zaW9ucyBkZWZpbmVkIGluIHRoZSBvcHRpb25zIChlLmcuIGltYWdlcywgYXVkaW8gZmlsZXMsIGV0Yy4pCiAgICAgICAgaXNJbnRlcm5hbCA9CiAgICAgICAgICB1cmwuc3Vic3RyaW5nKDAscm9vdHVybC5sZW5ndGgpID09PSByb290dXJsIHx8CiAgICAgICAgICB1cmwuaW5kZXhPZignOicpID09PSAtMSB8fAogICAgICAgICAgdXJsLmluZGV4T2YoJyMnKSAhPT0gMCB8fAogICAgICAgICAgIXVybC5tYXRjaChzZWxmLm9wdHMuZXhjZXB0aW9ucykKICAgICAgICA7CgogICAgICAgIHJldHVybiBpc0ludGVybmFsOwogICAgICB9OwogICAgfSwgLy8gZW5kIGludGVybmFsU2VsKCkKCgoKICAgIC8vIFByaW1hcnkgZXZlbnQgYmluZGluZyBmdW5jdGlvbgogICAgcHJlcDogZnVuY3Rpb24oZWxlbWVudCl7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIC8vIFNlbGVjdCBhbGwgYW5jaG9yIHRhZ3Mgd2l0aGluIHRoZSB0YXJnZXQgZWxlbWVudDsgdXNlcyBuYXRpdmUgSmF2YVNjcmlwdCBtZXRob2RzIChmYXN0KQogICAgICAkKGVsZW1lbnQpLmZpbmQoJ2EnKQoKICAgICAgLy8gTm93IGZpbHRlciB0aGUgcmVzdWx0cyB0byBmaW5kIGNlcnRhaW4gaW50ZXJuYWwgbGlua3M7IHVzZXMgY29tcGxleCBqUXVlcnkgc2VsZWN0b3JzIChzbG93KQogICAgICAuZmlsdGVyKCc6aW50ZXJuYWwnICsgc2VsZi5vcHRzLmZpbHRlcnMpCgogICAgICAvLyBNYW5hZ2UgY2xpY2sgZXZlbnQKICAgICAgLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICB2YXIKICAgICAgICAgICR0aGlzID0gJCh0aGlzKSwKICAgICAgICAgIHVybCAgID0gJHRoaXMuYXR0cignaHJlZicpLAogICAgICAgICAgdGl0bGUgPSAkdGhpcy5hdHRyKCd0aXRsZScpIHx8IG51bGw7IC8vIE5vdCBodWdlbHkgaW1wb3J0YW50IGJ1dCB3ZSdsbCB1c2UgYSB0aXRsZSBhdHRyaWJ1dGUgaWYgb25lIGhhcHBlbnMgdG8gYmUgcHJlc2VudAoKICAgICAgICAvLyBSZXR1cm4gdHJ1ZSAoYW5kIGFsbG93IG5vcm1hbCBicm93c2VyIGJlaGF2aW9yKSB1bmRlciBjZXJ0YWluIGNpcmN1bXN0YW5jZXM6CiAgICAgICAgLy8gLSBNaWRkbGUgbW91c2UgYnV0dG9uIGNsaWNrczsgcmVmZXJlbmNlOiBodHRwczovL2FwaS5qcXVlcnkuY29tL2V2ZW50LndoaWNoLwogICAgICAgIC8vIC0gQ29tbWFuZCBhbmQgY29udHJvbCBrZXkgY2xpY2tzIGUuZy4gdG8gb3BlbiBpbiBhIG5ldyB0YWI7IHJlZmVyZW5jZTogaHR0cHM6Ly9naXRodWIuY29tL2Jyb3dzZXJzdGF0ZS9hamF4aWZ5L3B1bGwvMTUvZmlsZXMKICAgICAgICAvLyAtIFNlZSBhbHNvOiBldmVudC5hbHRLZXksIGV2ZW50LnNoaWZ0S2V5IChub3QgaW1wbGVtZW50ZWQpCiAgICAgICAgLy8gLSBVUkwgbm90IHNldCBvciBVUkwgaXMgb25seSBhIGhhc2gKICAgICAgICBpZiAoCiAgICAgICAgICBldmVudC53aGljaCA9PT0gMiB8fAogICAgICAgICAgZXZlbnQubWV0YUtleSB8fAogICAgICAgICAgZXZlbnQuY3RybEtleSB8fAogICAgICAgICAgIXVybCB8fAogICAgICAgICAgdXJsWzBdID09PSAnIycKICAgICAgICApIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5wdXNoZXIodGl0bGUsdXJsLGV2ZW50KTsKICAgICAgfSk7CgogICAgICBjb25zb2xlLnRpbWVFbmQoInByZXAiKTsKICAgIH0sIC8vIGVuZCBwcmVwKCkKCgoKICAgIC8vIFB1c2ggc3RhdGUsIGxvYWQgbmV3IGNvbnRlbnQgdmlhIEFKQVgsIGFuZCBwcmV2ZW50IHRoZSBkZWZhdWx0IGFjdGlvbiB3aXRoIGByZXR1cm4gZmFsc2VgCiAgICBwdXNoZXI6IGZ1bmN0aW9uKHRpdGxlLHVybCxldmVudCl7CgogICAgICAvLyBQcmV2ZW50IG5hdmlnYXRpb24KICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgIC8vIFBlcmZvcm0gdmFyaW91cyB0ZXN0cyBoZXJlLCBzdGFydGluZyB3aXRoIGEgcXVpY2sgY2hlY2sgdG8gc2VlIGlmIHRoZSBVUkwgZGlmZmVycyBmcm9tIHdoYXQgaXMgY3VycmVudGx5IGRpc3BsYXllZAogICAgICBpZiAodXJsICE9PSBsb2NhdGlvbi5ocmVmKSB7CgogICAgICAgIC8vIFN0b3JlIHN0YXRlIG9iamVjdDsgd2UgdXNlIHRoaXMgd2hlbiByZXF1ZXN0aW5nIGNvbnRlbnQgZm9yIGEgcG9wc3RhdGUgZXZlbnQKICAgICAgICB2YXIgc3RhdGUgPSB7CiAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgIC8vIFNjcm9sbCBvYmplY3QgaGFuZGxpbmcsIGZvciBmdXR1cmUgcmVmZXJlbmNlOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNjczMTI3MS9oaXN0b3J5LXB1c2hzdGF0ZS1hbmQtc2Nyb2xsLXBvc2l0aW9uCiAgICAgICAgICAvL3Njcm9sbFRvcDogJCh3aW5kb3cpLnNjcm9sbFRvcCgpCiAgICAgICAgfTsKCiAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoc3RhdGUsdGl0bGUsdXJsKTsKICAgICAgICB0aGlzLmxvYWQodXJsKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sIC8vIGVuZCBwdXNoZXIoKQoKCgogICAgLy8gVGhlIHBvcHN0YXRlIGV2ZW50IGZpcmVzIHdoZW4gdGhlIHVzZXIgbmF2aWdhdGVzIGJhY2t3YXJkIG9yIGZvcndhcmQgaW4gdGhlIGJyb3dzZXIKICAgIHBvcFRoaXM6IGZ1bmN0aW9uKCl7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICQod2luZG93KS5vbigncG9wc3RhdGUnLCBmdW5jdGlvbihldmVudCl7CiAgICAgICAgLy8gVGVzdCBmb3IgdGhlIHByZXNlbmNlIG9mIGEgaGFzaCBpbiB0aGUgVVJMIHRvIGFsbG93IHVzZXJzIHRvIHNraXAgYmV0d2VlbiBhbmNob3JzIGluIGEgc2luZ2xlIGRvY3VtZW50CiAgICAgICAgLy8gQFRPRE86IGFsc28gaGFuZGxlIGNhc2VzIHdoZXJlIHVzZXJzIGFyZSByZXR1cm5pbmcgdG8gYSBsb2NhdGlvbiB3aXRoIGEgaGFzaDsgZS5nLiBpZiBsb2NhdGlvbi5oYXNoIGFuZCBsb2NhdGlvbi5ocmVmICE9IG9sZC5ocmVmCiAgICAgICAgaWYgKCFsb2NhdGlvbi5oYXNoKSB7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgc2VsZi5sb2FkKGxvY2F0aW9uLmhyZWYpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LCAvLyBlbmQgcG9wVGhpcygpCgoKCiAgICAvLyBDb25kaXRpb25hbGx5IGluaXRpYWxpemUgc3Bpbm5lciBkaXY7IGRlZ3JhZGVzIGdyYWNlZnVsbHkgaWYgc3Bpbi5qcyBub3QgZm91bmQKICAgIHNwaW5uZXI6IGZ1bmN0aW9uKCl7CiAgICAgIGlmICggJC5pc0Z1bmN0aW9uKHdpbmRvdy5TcGlubmVyKSApIHsKICAgICAgICB0aGlzLmNvbnRlbnQuYmVmb3JlKCc8ZGl2IGlkPSJzcGlubmVyIiBzdHlsZT0icG9zaXRpb246IGZpeGVkOyBoZWlnaHQ6IDEwMCU7IHdpZHRoOiAxMDAlOyI+PC9kaXY+Jyk7CiAgICAgICAgJCgnI3NwaW5uZXInKS5zcGluKHRoaXMub3B0cy5zcGluT3B0cykuaGlkZSgpOwogICAgICB9CiAgICB9LAoKCgogICAgLy8gVGhpcyBmdW5jdGlvbiBkeW5hbWljYWxseSBsb2FkcyBjb250ZW50IGZyb20gdGhlIHJlcXVlc3RlZCBwYWdlCiAgICBsb2FkOiBmdW5jdGlvbih1cmwpewogICAgICB2YXIKICAgICAgICBzZWxmICAgICAgID0gdGhpcywKICAgICAgICAkYm9keSAgICAgID0gJChkb2N1bWVudC5ib2R5KSwKICAgICAgICAkc3Bpbm5lciAgID0gJCgnI3NwaW5uZXInKSwKICAgICAgICBjb250ZW50U2VsID0gdGhpcy5vcHRzLmNvbnRlbnRTZWwsCiAgICAgICAgbWVudVNlbCAgICA9IHRoaXMub3B0cy5tZW51U2VsOwoKICAgICAgLy8gSnVzdCBpbiBjYXNlIGl0IHdhc24ndCBzZXQKICAgICAgdXJsID0gdXJsIHx8IGxvY2F0aW9uLmhyZWY7CgogICAgICAvLyBGYWRlIG91dCBleGlzdGluZyBjb250ZW50OyB1c2UgYW5pbWF0ZSB0byBwcmVzZXJ2ZSB0aGUgZWxlbWVudCdzIGhlaWdodCAoYXZvaWRzIHNjcm9sbGJhciBmbGlja2VyKQogICAgICB0aGlzLmNvbnRlbnQuYW5pbWF0ZSh7IG9wYWNpdHk6IHRoaXMub3B0cy5vdXRPcGFjaXR5IH0sIHRoaXMub3B0cy5vdXREZWxheSk7CgogICAgICAvLyBTcGluIHNwaW4gc3VnYXI7IG5vIGRlbGF5IG5lZWRlZCBoZXJlCiAgICAgICRzcGlubmVyLnNob3coKTsKCiAgICAgIC8vIEFKQVggcGFnZSByZXF1ZXN0OyBmZXRjaCB0aGUgY29udGVudCB3ZSBuZWVkCiAgICAgICQuYWpheCh7CiAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSx0ZXh0U3RhdHVzLGpxWEhSKXsKICAgICAgICAgIHZhcgogICAgICAgICAgICAkZGF0YSAgICAgICAgID0gJChzZWxmLmRvY0hlbHAoZGF0YSkpLAogICAgICAgICAgICAkZG9jQm9keSAgICAgID0gJGRhdGEuZmluZCgnI2RvYy1ib2R5OmZpcnN0JyksCiAgICAgICAgICAgICRjb250ZW50ICAgICAgPSAkZG9jQm9keS5maW5kKGNvbnRlbnRTZWwpLmZpbHRlcignOmZpcnN0JykuaHRtbCgpIHx8ICRkYXRhLmh0bWwoKTsKCiAgICAgICAgICAvLyBJZiBubyBjb250ZW50IGlzIHJlY2VpdmVkIGZvciBhbnkgcmVhc29uIGxldCdzIGZvcndhcmQgdGhlIHVzZXIgb24gdG8gdGhlIHRhcmdldCBVUkwKICAgICAgICAgIGlmICghJGNvbnRlbnQpIHsKICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IHVybDsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFF1aWNrbHkgZmFkZSBjb250ZW50IG91dCBlbnRpcmVseQogICAgICAgICAgc2VsZi5jb250ZW50LmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDIwKTsKCiAgICAgICAgICAvLyBTdG9wIGFuaW1hdGlvbiBpbW1lZGlhdGVseQogICAgICAgICAgc2VsZi5jb250ZW50LnN0b3AodHJ1ZSx0cnVlKTsKCiAgICAgICAgICAvLyBVcGRhdGUgdGhlIGNvbnRlbnQgYW5kIHByZXAgZXZlbnQgaGFuZGxlcnMKICAgICAgICAgIHNlbGYucHJlcCggc2VsZi5jb250ZW50Lmh0bWwoJGNvbnRlbnQpICk7CgogICAgICAgICAgLy8gU3dhcCB0aGUgbWVudShzKSBhbmQgcHJlcCBldmVudCBoYW5kbGVycwogICAgICAgICAgc2VsZi5wcmVwKCAkKG1lbnVTZWwpLmh0bWwoICRkb2NCb2R5LmZpbmQobWVudVNlbCkuaHRtbCgpICkgKTsKCiAgICAgICAgICAvLyBIYXJtb25pemUgYm9keSBjbGFzc2VzOyBtYWtlcyBXb3JkUHJlc3MgcGFnZXMgcmVuZGVyIHNtb290aGx5IGJ1dCBhbHNvIGdlbmVyYWxseSB1c2VmdWwKICAgICAgICAgICRib2R5LmF0dHIoJ2NsYXNzJywgJGRvY0JvZHkuYXR0cignY2xhc3MnKSk7CgogICAgICAgICAgLy8gRmFkZSB0aGUgY29udGVudCBiYWNrIGluCiAgICAgICAgICBzZWxmLmNvbnRlbnQuYW5pbWF0ZSh7IG9wYWNpdHk6IDEsIHZpc2liaWxpdHk6ICJ2aXNpYmxlIiB9LCBzZWxmLm9wdHMuaW5EZWxheSk7CgogICAgICAgICAgLy8gVXBkYXRlIGJvZHkgc2NyaXB0cyBvdXRzaWRlIG9mIHRoZSBjb250ZW50IGFyZWEKICAgICAgICAgIHNlbGYuc2NyaXB0cyggJGRvY0JvZHkuZmluZCgnc2NyaXB0Jykubm90KGNvbnRlbnRTZWwrJyBzY3JpcHQnKSApOwoKICAgICAgICAgIC8vIFVwZGF0ZSBkb2N1bWVudCB0aXRsZQogICAgICAgICAgc2VsZi50aXRsZSggJGRhdGEuZmluZCgnI2RvYy10aXRsZTpmaXJzdCcpLnRleHQoKSApOwogICAgICAgIH0sCgogICAgICAgIC8vIEVycm9yIGhhbmRsaW5nOyBmYWxsIGJhY2sgb24gcmVndWxhciBwYWdlIGxvYWQgaWYgYW55dGhpbmcgZ29lcyB3cm9uZwogICAgICAgIGVycm9yOiBmdW5jdGlvbihqcVhIUix0ZXh0U3RhdHVzLGVycm9yVGhyb3duKXsKICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSwgLy8gZW5kIGVycm9yIGhhbmRsaW5nCgogICAgICAgIC8vIENsZWFuIHVwIGFmdGVyIGNvbXBsZXRpbmcgdGhlIEFKQVggY2FsbAogICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihqcVhIUix0ZXh0U3RhdHVzKXsKCiAgICAgICAgICAvLyBGYWRlIG91dCBzcGlubmVyCiAgICAgICAgICAkc3Bpbm5lci5mYWRlT3V0KHNlbGYub3B0cy5zcGluRmFkZSwgZnVuY3Rpb24oKXsgJCh0aGlzKS5oaWRlKCk7IH0pOwoKICAgICAgICAgIC8vIFNjcm9sbCB0byB0aGUgYXBwcm9wcmlhdGUgbG9jYXRpb24KICAgICAgICAgIHNlbGYuc2Nyb2xsKCk7CgogICAgICAgICAgLy8gVXBkYXRlIGFuYWx5dGljcwogICAgICAgICAgc2VsZi5hbmFseXRpY3ModXJsKTsKCiAgICAgICAgfSAvLyBlbmQgY29tcGxldGUKCiAgICAgIH0pOyAvLyBlbmQgJC5hamF4CgogICAgfSwgLy8gZW5kIGxvYWQoKQoKCgogICAgLy8gVXBkYXRlIHNjcmlwdHMKICAgIHNjcmlwdHM6IGZ1bmN0aW9uKCRzY3JpcHRzKXsKICAgICAgdmFyCiAgICAgICAgJGJvZHkgICAgICAgPSAkKCdib2R5JyksCiAgICAgICAgY29udGVudFNjciAgPSB0aGlzLm9wdHMuY29udGVudFNlbCArICcgc2NyaXB0JzsgLy8gU2VsZWN0cyBjb250ZW50IHNjcmlwdHMKCiAgICAgIC8vIEZldGNoIGJvZHkgc2NyaXB0cyBub3QgaW4gdGhlIGNvbnRlbnQgKHdoaWNoIHdpbGwgYmUgcmVwbGFjZWQgYW55aG93KQogICAgICBpZiAoICRzY3JpcHRzLmxlbmd0aCApIHsKICAgICAgICAkc2NyaXB0cy5kZXRhY2goKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFF1aXQgd2hpbGUgeW91J3JlIGFoZWFkCiAgICAgIH0KCiAgICAgIC8vIFVwZGF0ZSB0aGUgYm9keSBzY3JpcHRzIG91dHNpZGUgb2YgdGhlIGNvbnRlbnQgYXJlYTsgd2UncmUgYXNzdW1pbmcgdGhhdCBoZWFkZXIgc2NyaXB0cyBkb24ndCBjaGFuZ2UKICAgICAgJHNjcmlwdHMuZWFjaChmdW5jdGlvbigpewogICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CgogICAgICAgIC8vIElmIHRoZSBjdXJyZW50IHNjcmlwdCBpc24ndCBlbXB0eSB3ZSBhc3N1bWUgaXQgbXVzdCBiZSBpbmxpbmUKICAgICAgICBpZiAoICcnICE9PSAkdGhpcy5odG1sKCkgKSB7CgogICAgICAgICAgLy8gU2F2ZSB0aGUgY3VycmVjdCBzY3JpcHQgY29udGVudHMgZm9yIHVzZSBpbiB0aGUgbG9vcCB0byBmb2xsb3cKICAgICAgICAgIHZhcgogICAgICAgICAgICBpbmxpbmVTY3JpcHQgPSAkdGhpcy5odG1sKCksCiAgICAgICAgICAgIGlzTmV3ICAgICAgICA9IHRydWU7CgogICAgICAgICAgLy8gQ2hlY2sgZXhpc3Rpbmcgc2NyaXB0cyB0byBzZWUgaWYgdGhleSBjb250YWluIHRoZSBzYW1lIHN0dWZmCiAgICAgICAgICAkLmVhY2goICRib2R5LmZpbmQoJ3NjcmlwdDpub3QoOmVtcHR5KScpLm5vdChjb250ZW50U2NyKSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgaWYgKCAkdGhpcy5odG1sKCkgPT09IGlubGluZVNjcmlwdCApIHsKICAgICAgICAgICAgICBpc05ldyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICAvLyBQYXN0ZSBuZXcgc3R1ZmYgaW4gaWYgaXQgaXNuJ3QgZm91bmQgaW4gdGhlIGN1cnJlbnQgRE9NOyB0aGlzIGlzIHF1aXRlIGEga2x1ZGdlCiAgICAgICAgICBpZiAoIGlzTmV3ID09PSB0cnVlICkgewogICAgICAgICAgICAkYm9keS5maW5kKCdzY3JpcHQ6bm90KDplbXB0eSknKS5ub3QoY29udGVudFNjcikuZmlsdGVyKCc6Zmlyc3QnKS5iZWZvcmUoJzxzY3JpcHQ+JyArICR0aGlzLmh0bWwoKSArICc8L3NjcmlwdD4nKTsKICAgICAgICAgIH0KCiAgICAgICAgLy8gRmV0Y2ggbmV3IG5vbi1pbmxpbmUgc2NyaXB0cwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgLy8gVGVzdCBmb3IgdGhlIHByZXNlbmNlIG9mIGVhY2ggc2NyaXB0OyBubyBzZW5zZSBpbiByZXBlYXRpbmcgb3Vyc2VsdmVzIGhlcmUKICAgICAgICAgIGlmICggISRib2R5LmZpbmQoJ3NjcmlwdFtzcmMqPSInICsgJHRoaXMuYXR0cignc3JjJykgKyAnIl0nKS5sZW5ndGggKSB7CiAgICAgICAgICAgIC8vICQuZ2V0U2NyaXB0IGRvZXMgbm90IGNhY2hlIHNjcmlwdHMgYnkgZGVmYXVsdCBzbyB3ZSdsbCBza2lwIHRoZSBzaG9ydGN1dCBhbmQgZ28gc3RyYWlnaHQgdG8gdGhlIHNvdXJjZQogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgIHVybDogJHRoaXMuYXR0cignc3JjJyksCiAgICAgICAgICAgICAgZGF0YVR5cGU6ICJzY3JpcHQiLAogICAgICAgICAgICAgIGNhY2hlOiB0cnVlLAogICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpeyAvLyBJbiBjYXNlIGNhY2hpbmcgaXNuJ3Qgd29ya2luZy4uLiBhZGQgdGhlIHNjcmlwdCB0byB0aGUgRE9NCiAgICAgICAgICAgICAgICB2YXIgbmV3U2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgICAgICAgICAgICBuZXdTY3JpcHQuc3JjID0gJHRoaXMuYXR0cignc3JjJyk7IC8vIE5vIG5lZWQgZm9yIHR5cGU9InRleHQvamF2YXNjcmlwdCIgaW4gSFRNTDUKICAgICAgICAgICAgICAgICRib2R5WzBdLmFwcGVuZENoaWxkKG5ld1NjcmlwdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsgLy8gZW5kICQuYWpheCgpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsgLy8gZW5kICRzY3JpcHRzLmVhY2goKQogICAgfSwgLy8gZW5kIHNjcmlwdHMoKQoKCgogICAgLy8gVXBkYXRlIGRvY3VtZW50IHRpdGxlCiAgICB0aXRsZTogZnVuY3Rpb24oJHRpdGxlKXsKICAgICAgZG9jdW1lbnQudGl0bGUgPSAkdGl0bGUKICAgICAgICAucmVwbGFjZSgnPCcsJyZsdDsnKQogICAgICAgIC5yZXBsYWNlKCc+JywnJmd0OycpCiAgICAgICAgLnJlcGxhY2UoJyYnLCcmYW1wOycpCiAgICAgIDsKICAgIH0sIC8vIGVuZCB0aXRsZSgpCgoKCiAgICAvLyBVcGRhdGUgc2Nyb2xsIHBvc2l0aW9uCiAgICBzY3JvbGw6IGZ1bmN0aW9uKCl7CiAgICAgIHZhcgogICAgICAgICRib2R5ICAgICAgID0gJCgnYm9keScpLAogICAgICAgICRjb250ZW50ICAgID0gJCh0aGlzLm9wdHMuY29udGVudFNlbCksCiAgICAgICAgc2Nyb2xsRGVsYXkgPSB0aGlzLm9wdHMuc2Nyb2xsRGVsYXk7CgogICAgICAvLyBUZXN0IGZvciB0aGUgcHJlc2VuY2Ugb2YgYSBoYXNoIGluIHRoZSBVUkwKICAgICAgaWYgKGxvY2F0aW9uLmhhc2ggJiYgbG9jYXRpb24uaGFzaCAhPT0gJycpIHsKCiAgICAgICAgLy8gRGVmaW5lIHRoZSBzZWxlY3RvcgogICAgICAgIHZhciAkaGFzaCA9ICQoJ1tpZD0iJytsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKSsnIl0nKTsKCiAgICAgICAgLy8gVGVzdCB3aGV0aGVyIHRoZSBzZWxlY3RvciBleGlzdHM7IGZhbGwgYmFjayBvbiByZWd1bGFyIHNjcm9sbCByb3V0aW5lIGlmIG5vdAogICAgICAgIGlmICggJGhhc2gubGVuZ3RoICkgewogICAgICAgICAgJGJvZHkuYW5pbWF0ZSh7IHNjcm9sbFRvcDogJGhhc2gub2Zmc2V0KCkudG9wIH0sIHNjcm9sbERlbGF5LCAic3dpbmciKTsgLy8gQFRPRE86IGRlbGF5IHNjcm9sbCB0byBhbGxvdyBpbWFnZXMgdG8gbG9hZD8KICAgICAgICB9IGVsc2UgaWYgKCAoICQod2luZG93KS5zY3JvbGxUb3AoKSA+ICRjb250ZW50Lm9mZnNldCgpLnRvcCApICkgewogICAgICAgICAgJGJvZHkuYW5pbWF0ZSh7IHNjcm9sbFRvcDogJGNvbnRlbnQub2Zmc2V0KCkudG9wIH0sIHNjcm9sbERlbGF5LCAic3dpbmciKTsKICAgICAgICB9CgogICAgICAvLyBTY3JvbGwgdG8gdGhlIHRvcCBvZiB0aGUgY29udGVudCBjb250YWluZXIgd2hlbiBiZWxvdyB0aGUgZm9sZAogICAgICB9IGVsc2UgaWYgKCAoICQod2luZG93KS5zY3JvbGxUb3AoKSA+ICRjb250ZW50Lm9mZnNldCgpLnRvcCApICkgewogICAgICAgICRib2R5LmFuaW1hdGUoeyBzY3JvbGxUb3A6ICRjb250ZW50Lm9mZnNldCgpLnRvcCB9LCBzY3JvbGxEZWxheSwgInN3aW5nIik7CiAgICAgIH0KCiAgICB9LCAvLyBlbmQgc2Nyb2xsKCkKCgoKICAgIC8vIFVwZGF0ZSBHb29nbGUgQW5hbHl0aWNzIG9uIGNvbnRlbnQgbG9hZAogICAgYW5hbHl0aWNzOiBmdW5jdGlvbih1cmwpewogICAgICB2YXIgcmVsYXRpdmVVcmwgPSAnLycgKyB1cmwucmVwbGFjZSh0aGlzLnJvb3QoKSwgJycpOyAvLyBTZXQgdGhlIHJlbGF0aXZlIFVSTCByZXF1aXJlZCBieSBHb29nbGUgQW5hbHl0aWNzCgogICAgICAvLyBJbmZvcm0gR29vZ2xlIEFuYWx5dGljcyBvZiB0aGUgY2hhbmdlOyBjb21wYXRpYmxlIHdpdGggdGhlIG5ldyBVbml2ZXJzYWwgQW5hbHl0aWNzIHNjcmlwdAogICAgICBpZiAoIHR5cGVvZiB3aW5kb3cuZ2EgIT09ICd1bmRlZmluZWQnICkgewogICAgICAgIHdpbmRvdy5nYSgnc2VuZCcsICdwYWdldmlldycsIHJlbGF0aXZlVXJsKTsKICAgICAgfSBlbHNlIGlmICggdHlwZW9mIHdpbmRvdy5fZ2FxICE9PSAndW5kZWZpbmVkJyApIHsKICAgICAgICB3aW5kb3cuX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnLCByZWxhdGl2ZVVybF0pOyAvLyBMZWdhY3kgYW5hbHl0aWNzOyByZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9icm93c2Vyc3RhdGUvYWpheGlmeS9wdWxsLzI1CiAgICAgIH0KICAgIH0sIC8vIGVuZCBhbmFseXRpY3MoKQoKCgogICAgLy8gRG9jdW1lbnQgaGVscGVyOyBicm93c2VycyBvZnRlbiBzdHJpcCBvdXQgaHRtbCwgaGVhZCwgYm9keSwgdGl0bGUsIGJhc2UsIGFuZCBtZXRhIHRhZ3Mgd2hlbiB1c2luZyAuaW5uZXJIVE1MOyBzZWUgaHR0cHM6Ly9hcGkuanF1ZXJ5LmNvbS9sb2FkLwogICAgLy8gVGhpcyBmdW5jdGlvbiBhbGxvd3MgYWNjZXNzIHRvIHRoZXNlIHRhZ3MgYnkgdHJhbnNmb3JtaW5nIHRoZW0gdG8gZGl2cyB3aXRoIGlkcyB0aGF0IG1hdGNoIHRoZSBvcmlnaW5hbCBlLmcuICNkb2MtdGl0bGUKICAgIC8vIFNlZSBhbHNvOiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9jb3dib3kvNzQyOTUyLwogICAgZG9jSGVscDogZnVuY3Rpb24oaHRtbCl7CiAgICAgIHZhcgogICAgICAgIHJlc3VsdCA9IFN0cmluZyhodG1sKQogICAgICAgICAgLnJlcGxhY2UoLzxcIURPQ1RZUEVbXj5dKj4vaSwgJycpCiAgICAgICAgICAucmVwbGFjZSgvPChodG1sfGhlYWR8Ym9keXx0aXRsZXxiYXNlfG1ldGEpKFtcc1w+XSkvZ2ksJzxkaXYgaWQ9ImRvYy0kMSIkMicpCiAgICAgICAgICAucmVwbGFjZSgvPFwvKGh0bWx8aGVhZHxib2R5fHRpdGxlfGJhc2V8bWV0YSlcPi9naSwnPC9kaXY+JykKICAgICAgOwogICAgICByZXR1cm4gJC50cmltKHJlc3VsdCk7CiAgICB9LCAvLyBlbmQgZG9jSGVscCgpCgoKCiAgICAvLyBVdGlsaXR5IGZ1bmN0aW9uIHRvIGdldCB0aGUgcm9vdCBVUkwgd2l0aCB0cmFpbGluZyBzbGFzaCBlLmcuIGh0dHAocyk6Ly95b3VyZG9tYWluLmNvbS8KICAgIHJvb3Q6IGZ1bmN0aW9uKCl7CiAgICAgIHZhcgogICAgICAgIHBvcnQgPSBkb2N1bWVudC5sb2NhdGlvbi5wb3J0ID8gJzonICsgZG9jdW1lbnQubG9jYXRpb24ucG9ydCA6ICcnLAogICAgICAgIHVybCA9IGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIChkb2N1bWVudC5sb2NhdGlvbi5ob3N0bmFtZSB8fCBkb2N1bWVudC5sb2NhdGlvbi5ob3N0KSArIHBvcnQgKyAnLyc7CiAgICAgIHJldHVybiB1cmw7CiAgICB9IC8vIGVuZCByb290KCkKCiAgfTsgLy8gZW5kIEFqYXhpbmF0ZS5wcm90b3R5cGUKCgoKICAvLyBBIGxpZ2h0d2VpZ2h0IHBsdWdpbiB3cmFwcGVyIGFyb3VuZCB0aGUgY29uc3RydWN0b3IgcHJldmVudGluZyBtdWx0aXBsZSBpbnN0YW50aWF0aW9ucwogICQuZm4uYWpheGluYXRlID0gZnVuY3Rpb24gKG9wdHMpewogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpewogICAgICBpZiAoISQuZGF0YSh0aGlzLCAnWE44X2FqYXhpbmF0ZScpKSB7CiAgICAgICAgJC5kYXRhKHRoaXMsICdYTjhfYWpheGluYXRlJywgbmV3IEFqYXhpbmF0ZSh0aGlzLCBvcHRzKSk7CiAgICAgIH0KICAgIH0pOwogIH07CgoKCiAgLy8gRXh0ZW5zaWJsZSBkZWZhdWx0IHNldHRpbmdzCiAgJC5mbi5hamF4aW5hdGUuZGVmYXVsdHMgPSB7CiAgICBjb250ZW50U2VsOiAgICAnI2NvbnRlbnQnIC8vIFRoZSBzZWxlY3RvciBmb3IgYWxsIHBhZ2UgY29udGVudHMKICAsIG1lbnVTZWw6ICAgICAgICcjbWVudScgICAgLy8gVGhlIHNlbGVjdG9yIGZvciB0aGUgZW50aXJlIG1lbnUKICAsIG91dERlbGF5OiAgICAgIDYwMAogICwgb3V0T3BhY2l0eTogICAgMC4yCiAgLCBpbkRlbGF5OiAgICAgICAxMjAKICAsIHNjcm9sbERlbGF5OiAgIDMwMAogICwgc3BpbkZhZGU6ICAgICAgMzAwICAgICAgICAvLyBTcGlubmVyIGZhZGUgb3V0IGR1cmF0aW9uCiAgLCBzcGluT3B0czogeyAgICAgICAgICAgICAgIC8vIHNwaW4uanMgb3B0aW9uczsgcmVmZXJlbmNlOiBodHRwczovL2ZnbmFzcy5naXRodWIuaW8vc3Bpbi5qcy8KICAgICAgbGluZXM6ICAyNQogICAgLCBsZW5ndGg6IDAKICAgICwgd2lkdGg6ICA0CiAgICAsIHJhZGl1czogMjUKICAgICwgc3BlZWQ6ICAxLjUKICAgICwgdHJhaWw6ICA0MAogICAgLCB0b3A6ICAgICcyNSUnCiAgfQoKICAvLyBXaGl0ZWxpc3RlZCBleHRlbnNpb25zIChyZWdleHApOyB0aGVzZSB3aWxsIG5lZ2F0ZSB0aGUgY3VzdG9tICJpbnRlcm5hbCIgc2VsZWN0b3IKICAsIGV4Y2VwdGlvbnM6IC9cLihqcGd8anBlZ3xwbmd8Z2lmfGJtcHxwZGZ8bXAzfGZsYWN8d2F2fHJhcnx6aXApJC9pCgogIC8vIEFkZGl0aW9uYWwgc2VsZWN0b3JzIHRvIGZpbHRlciB3aGVuIGJpbmRpbmcgZXZlbnRzIChzdHJpbmcpOyB1c2UgIjpub3Qoc2VsZWN0b3IpIiwgZm9yIGV4YW1wbGUsIHRvIHNraXAgY2VydGFpbiBzZWxlY3RvcnMgZS5nLiBgOm5vdChbaHJlZio9InRlc3QiXSlgIGV0Yy4KICAsIGZpbHRlcnM6ICcnCiAgfTsKCn0pLmFwcGx5KFhOOCwgW2pRdWVyeSwgd2luZG93LCBkb2N1bWVudF0pOwoKLy8gPT09PSBBSkFYSU5BVEUgV09SRFBSRVNTIEVYVEVOU0lPTiA9PT09IC8vCgovLyBBdWdtZW50cyB0aGUgQWpheGluYXRlIHNjcmlwdCB0byBoYW5kbGUgc2V2ZXJhbCBzY2VuYXJpb3MgdW5pcXVlIHRvIFdvcmRQcmVzcwovLyBNdXN0IGJlIGNhbGxlZCAqYWZ0ZXIqIHRoZSBtYWluIEFqYXhpbmF0ZSBzY3JpcHQ7IGFzc3VtZXMgWE44IGlzIGFscmVhZHkgZGVmaW5lZAoKOyhmdW5jdGlvbigkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpewogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIFBUID0gWE44LkFqYXhpbmF0ZS5wcm90b3R5cGU7CgogIC8vIEhvb2sgaW50byBwcmVwIHRvIGFkZCBXb3JkUHJlc3Mtc3BlY2lmaWMgbWV0aG9kcwogIFBULl9wcmVwID0gUFQucHJlcDsKICBQVC5wcmVwID0gZnVuY3Rpb24oZWxlbWVudCl7CiAgICB0aGlzLl9wcmVwKGVsZW1lbnQpOwogICAgdGhpcy53cEFyY2hpdmVzKGVsZW1lbnQpOwogICAgdGhpcy53cFNlYXJjaChlbGVtZW50KTsKICB9OyAvLyBlbmQgcHJlcCgpCgoKCiAgLy8gVVJMIGVuY29kZSBmdW5jdGlvbiB0byBlbXVsYXRlIFdQJ3Mgc2VhcmNoIHJld3JpdGU7IHZpYTogaHR0cDovL3BocGpzLm9yZy9mdW5jdGlvbnMvdXJsZW5jb2RlLwogIFBULmVuY29kZSA9IGZ1bmN0aW9uKHN0cil7CiAgICBzdHIgPSAoc3RyKycnKS50b1N0cmluZygpOwogICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChzdHIpCiAgICAgIC5yZXBsYWNlKC8hL2csICclMjEnKQogICAgICAucmVwbGFjZSgvJy9nLCAnJTI3JykKICAgICAgLnJlcGxhY2UoL1woL2csICclMjgnKQogICAgICAucmVwbGFjZSgvXCkvZywgJyUyOScpCiAgICAgIC5yZXBsYWNlKC9cKi9nLCAnJTJBJykKICAgICAgLnJlcGxhY2UoLyUyMC9nLCAnKycpOwogIH07IC8vIGVuZCBlbmNvZGUoKQoKCgogIC8vIFdvcmRQcmVzcyBhcmNoaXZlIGRyb3Bkb3duIGhhbmRsZXI7IGZvciB1c2Ugd2l0aCB0aGUgYXJjaGl2ZSB3aWRnZXQ7IGRvbid0IHVzZSB3aXRoIHRoZSBjYXRlZ29yeSB3aWRnZXQsIHRoZSBjb2RlIGlzIGNvbXBsZXRlbHkgZGlmZmVyZW50CiAgUFQud3BBcmNoaXZlcyA9IGZ1bmN0aW9uKGVsZW1lbnQpewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICQoZWxlbWVudCkuZmluZCgnc2VsZWN0W25hbWUkPSJkcm9wZG93biJdJykKICAgIC5yZW1vdmVBdHRyKCdvbmNoYW5nZScpIC8vIERpdGNoIHRoZSBkZWZhdWx0IEphdmFTY3JpcHQgZXZlbnQgaGFuZGxlcgogICAgLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihldmVudCl7CiAgICAgIHZhciB1cmwgICA9ICQodGhpcykudmFsKCksCiAgICAgICAgICB0aXRsZSA9ICQodGhpcykuZmluZCgnOnNlbGVjdGVkJykudGV4dCgpLnRyaW0oKSB8fCBudWxsOwoKICAgICAgc2VsZi5wdXNoZXIodGl0bGUsdXJsLGV2ZW50KTsKICAgIH0pOwogIH07IC8vIGVuZCB3cERyb3Bkb3duKCkKCgoKICAvLyBXb3JkUHJlc3Mgc2VhcmNoIGZvcm07IHlvdSBtYXkgbmVlZCB0byBjdXN0b21pemUgdGhpcyB0byBzdWl0IHlvdXIgb3duIHRoZW1lCiAgUFQud3BTZWFyY2ggPSBmdW5jdGlvbihlbGVtZW50KXsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAkKGVsZW1lbnQpLmZpbmQoc2VsZi5vcHRzLnNlYXJjaFNlbCkKICAgIC5vbignc3VibWl0JywgZnVuY3Rpb24oZXZlbnQpewogICAgICB2YXIKICAgICAgICB1cmwgPSAnJywKICAgICAgICBzID0gJCgnaW5wdXRbdHlwZT0ic2VhcmNoIl0nLCB0aGlzKS52YWwoKSB8fCBudWxsOwoKICAgICAgLy8gSWYgdGhlIGZvcm0gd2FzIHN1Ym1pdHRlZCB3aXRob3V0IGNvbnRlbnQgZm9jdXMgb24gdGhlIHNlYXJjaCBmaWVsZAogICAgICBpZiAocyA9PT0gbnVsbCkgewoKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICQoJ2lucHV0W3R5cGU9InNlYXJjaCJdJywgdGhpcykuZm9jdXMoKTsKCiAgICAgIC8vIFNldHVwIG91ciBzZWFyY2ggVVJMCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCBzZWxmLm9wdHMuc2VhcmNoQmFzZSAmJiBzZWxmLm9wdHMuc2VhcmNoQmFzZSAhPT0gJycgKSB7CiAgICAgICAgICB1cmwgPSBzZWxmLnJvb3QoKSArIHNlbGYub3B0cy5zZWFyY2hCYXNlICsgIi8iICsgc2VsZi5lbmNvZGUocyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHVybCA9IHNlbGYucm9vdCgpICsgIj9zPSIgKyBzOwogICAgICAgIH0KCiAgICAgICAgLy8gTGF1bmNoIHdpdGhvdXQgdGl0bGUKICAgICAgICBzZWxmLnB1c2hlcihudWxsLHVybCxldmVudCk7CiAgICAgIH0KICAgIH0pOwogIH07IC8vIGVuZCB3cFNlYXJjaCgpCgoKCiAgLy8gU2VhcmNoIGZvcm0gc2VsZWN0b3IKICAkLmZuLmFqYXhpbmF0ZS5kZWZhdWx0cy5zZWFyY2hTZWwgID0gJy5zZWFyY2gtZm9ybSc7CgogIC8vIFNlYXJjaCByZXdyaXRlIGJhc2U7IGZvciB1c2Ugd2l0aCBwZXJtYWxpbmtzIGZvciBzZWFyY2ggZS5nLiBodHRwOi8veW91cnNpdGUuY29tL3NlYXJjaC90ZXN0aW5nK3RoaXM7CiAgJC5mbi5hamF4aW5hdGUuZGVmYXVsdHMuc2VhcmNoQmFzZSA9ICdzZWFyY2gnOwoKICAvLyBXb3JkUHJlc3Mtc3BlY2lmaWMgZXhjZXB0aW9uczsgdGhlcmUgYXJlIG1vcmUgZWZmaWNpZW50IHdheXMgdG8gZG8gdGhpcyBzb3J0IG9mIHRoaW5nIGJ1dCB0aGlzIGlzIGVhc2llciB0byBjb25maWd1cmUKICAkLmZuLmFqYXhpbmF0ZS5kZWZhdWx0cy5maWx0ZXJzICAgID0gJC5mbi5hamF4aW5hdGUuZGVmYXVsdHMuZmlsdGVycyArICc6bm90KFtocmVmKj0id3AtbG9naW4iXSwgW2hyZWYqPSJ3cC1hZG1pbiJdLCBbaHJlZio9InJlcGx5dG9jb20iXSwgW2lkKj0iY2FuY2VsLWNvbW1lbnQtcmVwbHktbGluayJdLCBbaHJlZiQ9Ii9mZWVkLyJdKSc7Cgp9KS5hcHBseShYTjgsIFtqUXVlcnksIHdpbmRvdywgZG9jdW1lbnRdKTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 06:44:26 GMT",
                    "Content-Length": "17601",
                    "Date": "Thu, 06 Nov 2014 06:44:27 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}