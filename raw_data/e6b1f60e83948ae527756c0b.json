{
    "url": "http://localhost:9999/caolvchong/gazira/js/lib/util/bom/history.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.replace()</b> via the following statements:<ul><li>var url = location.href;</li><li>url = url.replace(/#(.+)/, '#' + hash);</li><li>force === true ? location.replace(url) : (location.hash = hash);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/caolvchong/gazira/js/lib/util/bom/history.js",
                "path": "/caolvchong/gazira/js/lib/util/bom/history.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9jYW9sdmNob25nL2dhemlyYS9qcy9saWIvdXRpbC9ib20vaGlzdG9yeS5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNzQ0OQ0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAwMjowODowMyBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMDI6MDg6MDEgR01UDQoNCmRlZmluZShmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKICAgIHZhciAkID0gcmVxdWlyZSgnJCcpOwoKICAgIHZhciB1bmRlZjsKICAgIHZhciBvcHRpb25hbFBhcmFtID0gL1woKC4qPylcKS9nOwogICAgdmFyIG5hbWVkUGFyYW0gPSAvKFwoXD8pPzpcdysvZzsgLy8gOumAmumFjeespgogICAgdmFyIHNwbGF0UGFyYW0gPSAvXCpcdysvZzsgLy8gKuWPt+mAmumFjeespgogICAgdmFyIGVzY2FwZVJlZ0V4cCA9IC9bXC17fVxbXF0rPy4sXFxcXiR8I1xzXS9nOyAvLyDovazkuYnlrZfnrKYKICAgIHZhciBkZWZhdWx0Um91dGVyID0gJ2RlZmF1bHRSb3V0ZXInOyAvLyDpu5jorqRrZXkKICAgIHZhciBkZWZhdWx0SGFzaDsgLy8g6buY6K6k6Kem5Y+R55qEaGFzaO+8jOWPr+S7peaYr+S4gOS4quWtl+espuS4su+8jOaIluiAheaYr+S4gOS4qmZ1bmN0aW9uCgogICAgdmFyIHByZXZVUkwgPSBsb2NhdGlvbi5ocmVmOyAvLyDnvJPlrZjkuIrkuIDmrKHnmoRVUkzvvIzpmLLmraLmn5DkupvmtY/op4jlmajmlK/mjIFoYXNoY2hhbmdl5LqL5Lu277yM5L2G5piv5Y+W5LiN5Yiwb2xkVVJM5ZKMbmV3VVJM55qE5oOF5Ya1CgogICAgdmFyIGhlbHBlciA9IHsKICAgICAgICAvKioKICAgICAgICAgKiDlsIbot6/nlLHovazljJbkuLrmraPliJnooajovr7lvI8KICAgICAgICAgKiBAcGFyYW0gcm91dGUKICAgICAgICAgKi8KICAgICAgICByb3V0ZVRvUmVnOiBmdW5jdGlvbihyb3V0ZSkgewogICAgICAgICAgICByb3V0ZSA9IHJvdXRlLnJlcGxhY2UoZXNjYXBlUmVnRXhwLCAnXFwkJicpLnJlcGxhY2Uob3B0aW9uYWxQYXJhbSwgJyg/OiQxKT8nKS5yZXBsYWNlKG5hbWVkUGFyYW0sZnVuY3Rpb24obWF0Y2gsIG9wdGlvbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9uYWwgPyBtYXRjaCA6ICcoW15cL10rKSc7CiAgICAgICAgICAgIH0pLnJlcGxhY2Uoc3BsYXRQYXJhbSwgJyguKj8pJyk7CiAgICAgICAgICAgIHJldHVybiBuZXcgUmVnRXhwKCdeJyArIHJvdXRlICsgJyQnKTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIOiOt+WPluW9k+WJjeeahGhhc2gKICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICAgICAqLwogICAgICAgIGdldEhhc2g6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbG9jYXRpb24uaGFzaC5yZXBsYWNlKC9eIy8sICcnKTsKICAgICAgICB9LAogICAgICAgIHNldEhhc2g6IGZ1bmN0aW9uKGhhc2gsIGZvcmNlKSB7CiAgICAgICAgICAgIHZhciB1cmwgPSBsb2NhdGlvbi5ocmVmOwogICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgvIyguKykvLCAnIycgKyBoYXNoKTsKICAgICAgICAgICAgZm9yY2UgPT09IHRydWUgPyBsb2NhdGlvbi5yZXBsYWNlKHVybCkgOiAobG9jYXRpb24uaGFzaCA9IGhhc2gpOwogICAgICAgIH0sCiAgICAgICAgc2VhcmNoOiBmdW5jdGlvbihoYXNoLCBjYWNoZSkgewogICAgICAgICAgICB2YXIgbWF0Y2g7CiAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGNhY2hlKSB7CiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGNhY2hlW2tleV07CiAgICAgICAgICAgICAgICBtYXRjaCA9IGhhc2gubWF0Y2goaXRlbS5yZWcpOwogICAgICAgICAgICAgICAgaWYobWF0Y2gpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGl0ZW0uYWN0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6ICQuaXNBcnJheShtYXRjaCkgPyBtYXRjaC5zbGljZSgxKSA6IFtdCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICog6I635Y+W6Lev55Sx5a+55bqU55qE5aSE55CG5Ye95pWwCiAgICAgICAgICogQHBhcmFtIGhhc2gKICAgICAgICAgKiBAcGFyYW0gY2FjaGUKICAgICAgICAgKi8KICAgICAgICBmZXRjaDogZnVuY3Rpb24oaGFzaCwgY2FjaGUpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHsKICAgICAgICAgICAgICAgIGFjdGlvbjogbnVsbCwKICAgICAgICAgICAgICAgIHBhcmFtczogW10KICAgICAgICAgICAgfTsKICAgICAgICAgICAgaGFzaCA9ICQudHJpbShoYXNoKTsKICAgICAgICAgICAgaWYoaGFzaCAmJiBoYXNoICE9PSBkZWZhdWx0Um91dGVyKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBoZWxwZXIuc2VhcmNoKGhhc2gsIGNhY2hlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmKGRlZmF1bHRIYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGRlZmF1bHRIYXNoID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBoZWxwZXIuc2VhcmNoKGhhc2gsIGNhY2hlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYodHlwZW9mIGRlZmF1bHRIYXNoID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5hY3Rpb24gPSBkZWZhdWx0SGFzaDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIOaJvuWIsOWvueW6lGhhc2jnmoTlpITnkIblh73mlbDvvIzlubbmiafooYwKICAgICAgICAgKiBAcGFyYW0gaGFzaAogICAgICAgICAqIEBwYXJhbSBjYWNoZQogICAgICAgICAqLwogICAgICAgIG1hdGNoOiBmdW5jdGlvbihoYXNoLCBjYWNoZSkgewogICAgICAgICAgICB2YXIgZmV0Y2ggPSBoZWxwZXIuZmV0Y2goaGFzaCwgY2FjaGUpOwogICAgICAgICAgICBpZihmZXRjaCkgewogICAgICAgICAgICAgICAgaWYoZmV0Y2guYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgZmV0Y2guYWN0aW9uLmFwcGx5KG51bGwsIGZldGNoLnBhcmFtcyk7CiAgICAgICAgICAgICAgICAgICAgaWYoZmV0Y2guYWN0aW9uLmNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoLmFjdGlvbi5jYWxsYmFjaygpOwogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgZmV0Y2guYWN0aW9uLmNhbGxiYWNrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgdmFyIGlmcmFtZTsKICAgIHZhciBzdXBwb3J0SGFzaCA9ICgnb25oYXNoY2hhbmdlJyBpbiB3aW5kb3cpICYmIChkb2N1bWVudC5kb2N1bWVudE1vZGUgPT09IHVuZGVmIHx8IGRvY3VtZW50LmRvY3VtZW50TW9kZSA9PT0gOCk7CiAgICB2YXIgbGFzdEhhc2ggPSBoZWxwZXIuZ2V0SGFzaCgpOwogICAgdmFyIGNhY2hlID0ge307CgogICAgdmFyIHIgPSB7CiAgICAgICAgLyoqCiAgICAgICAgICog6I635Y+W5b2T5YmN55qEaGFzaAogICAgICAgICAqLwogICAgICAgIGdldDogaGVscGVyLmdldEhhc2gsCiAgICAgICAgLyoqCiAgICAgICAgICog5bCG5b2T5YmN55qEaGFzaOa4heepugogICAgICAgICAqLwogICAgICAgIGVtcHR5OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbG9jYXRpb24uaGFzaCA9ICcnOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICog6Kem5Y+R5p+Q5Liq6Lev55Sx77yM5omn6KGM5Zue6LCD5Ye95pWwCiAgICAgICAgICogQHBhcmFtIGhhc2gKICAgICAgICAgKiBAcGFyYW0gY2FsbGJhY2sg5omn6KGM5a6M6Lev55Sx5ZCO55qE5Zue6LCD5Ye95pWwCiAgICAgICAgICogQHBhcmFtIGZvcmNlIOaYr+WQpuWGmeWFpeWOhuWPsuiusOW9lQogICAgICAgICAqLwogICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uKGhhc2gsIGNhbGxiYWNrLCBmb3JjZSkgewogICAgICAgICAgICBoZWxwZXIuc2V0SGFzaChoYXNoLCBmb3JjZSk7CiAgICAgICAgICAgIGlmKCQuaXNGdW5jdGlvbihjYWxsYmFjaykpIHsKICAgICAgICAgICAgICAgIHZhciBmZXRjaCA9IGhlbHBlci5mZXRjaChoYXNoLCBjYWNoZSk7CiAgICAgICAgICAgICAgICBpZihmZXRjaC5hY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBmZXRjaC5hY3Rpb24uY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICog6K6+5a6a6Lev55Sx55uR5ZCsCiAgICAgICAgICogQHBhcmFtIG9iaiDplK7lgLzlr7nvvIxrZXnmmK/ot6/nlLHooajvvIzlgLzmmK/ot6/nlLHlr7nlupTnmoTliqjkvZzlh73mlbDjgILot6/nlLHooajmlK/mjIHvvJoKICAgICAgICAgKiAgICAgICAgICA66YCa6YWN56ym77yM5L6L5aaC77yaIHVzZXIvOmlkIOWPr+S7peWMuemFjSB1c2VyLzIgICB1c2VyLzMzCiAgICAgICAgICogICAgICAgICAgKumAmumFjeespu+8jOS+i+Wmgu+8miAqcG9zdCDlj6/ku6XljLnphY0gdXNlcnBvc3QgICAgZGVscG9zdAogICAgICAgICAqLwogICAgICAgIGxpc3RlbjogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgIChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGZvcih2YXIga2V5IGluIG9iaikgewogICAgICAgICAgICAgICAgICAgIGlmKGtleSAhPT0gZGVmYXVsdFJvdXRlcikgewogICAgICAgICAgICAgICAgICAgICAgICBpZighY2FjaGVba2V5XSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVba2V5XSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWc6IGhlbHBlci5yb3V0ZVRvUmVnKGtleSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBvYmpba2V5XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRIYXNoID0gb2JqW2tleV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSgpOwoKICAgICAgICAgICAgaWYoc3VwcG9ydEhhc2gpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5vbmhhc2hjaGFuZ2UgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgZSA9IGUgfHwgd2luZG93LmV2ZW50OwogICAgICAgICAgICAgICAgICAgIHZhciBwcmV2ID0gZS5vbGRVUkwgfHwgcHJldlVSTDsKICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gZS5uZXdVUkwgfHwgbG9jYXRpb24uaHJlZjsKICAgICAgICAgICAgICAgICAgICB2YXIgaGFzaCA9IGhlbHBlci5nZXRIYXNoKCk7CiAgICAgICAgICAgICAgICAgICAgaWYocHJldiAhPT0gdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZVUkwgPSB1cmw7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlbHBlci5tYXRjaChoYXNoID8gaGFzaCA6IGRlZmF1bHRIYXNoLCBjYWNoZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmKCFpZnJhbWUpIHsKICAgICAgICAgICAgICAgICAgICAkKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSAkKCc8aWZyYW1lIHRhYmluZGV4PSItMSIgc3R5bGU9ImRpc3BsYXk6bm9uZSIgd2lkaHQ9IjAiIGhlaWdodD0iMCIvPicpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZnJhbWUgPSBlbFswXS5jb250ZW50V2luZG93OwogICAgICAgICAgICAgICAgICAgICAgICBlbC5iaW5kKCdsb2FkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFzaCA9IGhlbHBlci5nZXRIYXNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC51bmJpbmQoJ2xvYWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkb2MgPSBpZnJhbWUuZG9jdW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Mub3BlbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLndyaXRlKCc8IURPQ1RZUEUgaHRtbD48aHRtbD48Ym9keT4nICsgaGFzaCArICc8L2JvZHk+PC9odG1sPicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFzaCA9IGhlbHBlci5nZXRIYXNoKCk7Ly8g5Li756qX5Y+j5Lit55qEaGFzaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoaXN0b3J5SGFzaCA9IGlmcmFtZS5kb2N1bWVudC5ib2R5LmlubmVyVGV4dDsvLyDkuIrkuIDmrKFoYXNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaGFzaCAhPT0gbGFzdEhhc2gpIHsgLy8g5Li756qX5Y+jaGFzaOaUueWPmAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0SGFzaCA9IGhhc2g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGhhc2ggIT09IGhpc3RvcnlIYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Mub3BlbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLndyaXRlKCc8IURPQ1RZUEUgaHRtbD48aHRtbD48Ym9keT4nICsgaGFzaCArICc8L2JvZHk+PC9odG1sPicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVscGVyLm1hdGNoKGhhc2gsIGNhY2hlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoaGlzdG9yeUhhc2ggIT09IGxhc3RIYXNoKSB7Ly8g5Zue6YCAL+WJjei/mwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5oYXNoID0gaGlzdG9yeUhhc2g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgNTApOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaW5pdEhhc2ggPSBoZWxwZXIuZ2V0SGFzaCgpOyAvLyDov5vlhaXpobXpnaLml7blgJnnmoRoYXNoCiAgICAgICAgICAgIGlmKGluaXRIYXNoKSB7CiAgICAgICAgICAgICAgICBoZWxwZXIubWF0Y2goaW5pdEhhc2gsIGNhY2hlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGhlbHBlci5tYXRjaChkZWZhdWx0SGFzaCwgY2FjaGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICBtb2R1bGUuZXhwb3J0cyA9IHI7Cn0pOw==",
                "body": "ZGVmaW5lKGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogICAgdmFyICQgPSByZXF1aXJlKCckJyk7CgogICAgdmFyIHVuZGVmOwogICAgdmFyIG9wdGlvbmFsUGFyYW0gPSAvXCgoLio/KVwpL2c7CiAgICB2YXIgbmFtZWRQYXJhbSA9IC8oXChcPyk/Olx3Ky9nOyAvLyA66YCa6YWN56ymCiAgICB2YXIgc3BsYXRQYXJhbSA9IC9cKlx3Ky9nOyAvLyAq5Y+36YCa6YWN56ymCiAgICB2YXIgZXNjYXBlUmVnRXhwID0gL1tcLXt9XFtcXSs/LixcXFxeJHwjXHNdL2c7IC8vIOi9rOS5ieWtl+espgogICAgdmFyIGRlZmF1bHRSb3V0ZXIgPSAnZGVmYXVsdFJvdXRlcic7IC8vIOm7mOiupGtleQogICAgdmFyIGRlZmF1bHRIYXNoOyAvLyDpu5jorqTop6blj5HnmoRoYXNo77yM5Y+v5Lul5piv5LiA5Liq5a2X56ym5Liy77yM5oiW6ICF5piv5LiA5LiqZnVuY3Rpb24KCiAgICB2YXIgcHJldlVSTCA9IGxvY2F0aW9uLmhyZWY7IC8vIOe8k+WtmOS4iuS4gOasoeeahFVSTO+8jOmYsuatouafkOS6m+a1j+iniOWZqOaUr+aMgWhhc2hjaGFuZ2Xkuovku7bvvIzkvYbmmK/lj5bkuI3liLBvbGRVUkzlkoxuZXdVUkznmoTmg4XlhrUKCiAgICB2YXIgaGVscGVyID0gewogICAgICAgIC8qKgogICAgICAgICAqIOWwhui3r+eUsei9rOWMluS4uuato+WImeihqOi+vuW8jwogICAgICAgICAqIEBwYXJhbSByb3V0ZQogICAgICAgICAqLwogICAgICAgIHJvdXRlVG9SZWc6IGZ1bmN0aW9uKHJvdXRlKSB7CiAgICAgICAgICAgIHJvdXRlID0gcm91dGUucmVwbGFjZShlc2NhcGVSZWdFeHAsICdcXCQmJykucmVwbGFjZShvcHRpb25hbFBhcmFtLCAnKD86JDEpPycpLnJlcGxhY2UobmFtZWRQYXJhbSxmdW5jdGlvbihtYXRjaCwgb3B0aW9uYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25hbCA/IG1hdGNoIDogJyhbXlwvXSspJzsKICAgICAgICAgICAgfSkucmVwbGFjZShzcGxhdFBhcmFtLCAnKC4qPyknKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoJ14nICsgcm91dGUgKyAnJCcpOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICog6I635Y+W5b2T5YmN55qEaGFzaAogICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgICAgICovCiAgICAgICAgZ2V0SGFzaDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBsb2NhdGlvbi5oYXNoLnJlcGxhY2UoL14jLywgJycpOwogICAgICAgIH0sCiAgICAgICAgc2V0SGFzaDogZnVuY3Rpb24oaGFzaCwgZm9yY2UpIHsKICAgICAgICAgICAgdmFyIHVybCA9IGxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKC8jKC4rKS8sICcjJyArIGhhc2gpOwogICAgICAgICAgICBmb3JjZSA9PT0gdHJ1ZSA/IGxvY2F0aW9uLnJlcGxhY2UodXJsKSA6IChsb2NhdGlvbi5oYXNoID0gaGFzaCk7CiAgICAgICAgfSwKICAgICAgICBzZWFyY2g6IGZ1bmN0aW9uKGhhc2gsIGNhY2hlKSB7CiAgICAgICAgICAgIHZhciBtYXRjaDsKICAgICAgICAgICAgZm9yKHZhciBrZXkgaW4gY2FjaGUpIHsKICAgICAgICAgICAgICAgIHZhciBpdGVtID0gY2FjaGVba2V5XTsKICAgICAgICAgICAgICAgIG1hdGNoID0gaGFzaC5tYXRjaChpdGVtLnJlZyk7CiAgICAgICAgICAgICAgICBpZihtYXRjaCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogaXRlbS5hY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogJC5pc0FycmF5KG1hdGNoKSA/IG1hdGNoLnNsaWNlKDEpIDogW10KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiDojrflj5bot6/nlLHlr7nlupTnmoTlpITnkIblh73mlbAKICAgICAgICAgKiBAcGFyYW0gaGFzaAogICAgICAgICAqIEBwYXJhbSBjYWNoZQogICAgICAgICAqLwogICAgICAgIGZldGNoOiBmdW5jdGlvbihoYXNoLCBjYWNoZSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gewogICAgICAgICAgICAgICAgYWN0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgcGFyYW1zOiBbXQogICAgICAgICAgICB9OwogICAgICAgICAgICBoYXNoID0gJC50cmltKGhhc2gpOwogICAgICAgICAgICBpZihoYXNoICYmIGhhc2ggIT09IGRlZmF1bHRSb3V0ZXIpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGhlbHBlci5zZWFyY2goaGFzaCwgY2FjaGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYoZGVmYXVsdEhhc2gpIHsKICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgZGVmYXVsdEhhc2ggPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGhlbHBlci5zZWFyY2goaGFzaCwgY2FjaGUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0eXBlb2YgZGVmYXVsdEhhc2ggPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmFjdGlvbiA9IGRlZmF1bHRIYXNoOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICog5om+5Yiw5a+55bqUaGFzaOeahOWkhOeQhuWHveaVsO+8jOW5tuaJp+ihjAogICAgICAgICAqIEBwYXJhbSBoYXNoCiAgICAgICAgICogQHBhcmFtIGNhY2hlCiAgICAgICAgICovCiAgICAgICAgbWF0Y2g6IGZ1bmN0aW9uKGhhc2gsIGNhY2hlKSB7CiAgICAgICAgICAgIHZhciBmZXRjaCA9IGhlbHBlci5mZXRjaChoYXNoLCBjYWNoZSk7CiAgICAgICAgICAgIGlmKGZldGNoKSB7CiAgICAgICAgICAgICAgICBpZihmZXRjaC5hY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBmZXRjaC5hY3Rpb24uYXBwbHkobnVsbCwgZmV0Y2gucGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICBpZihmZXRjaC5hY3Rpb24uY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2guYWN0aW9uLmNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBmZXRjaC5hY3Rpb24uY2FsbGJhY2s7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgaWZyYW1lOwogICAgdmFyIHN1cHBvcnRIYXNoID0gKCdvbmhhc2hjaGFuZ2UnIGluIHdpbmRvdykgJiYgKGRvY3VtZW50LmRvY3VtZW50TW9kZSA9PT0gdW5kZWYgfHwgZG9jdW1lbnQuZG9jdW1lbnRNb2RlID09PSA4KTsKICAgIHZhciBsYXN0SGFzaCA9IGhlbHBlci5nZXRIYXNoKCk7CiAgICB2YXIgY2FjaGUgPSB7fTsKCiAgICB2YXIgciA9IHsKICAgICAgICAvKioKICAgICAgICAgKiDojrflj5blvZPliY3nmoRoYXNoCiAgICAgICAgICovCiAgICAgICAgZ2V0OiBoZWxwZXIuZ2V0SGFzaCwKICAgICAgICAvKioKICAgICAgICAgKiDlsIblvZPliY3nmoRoYXNo5riF56m6CiAgICAgICAgICovCiAgICAgICAgZW1wdHk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBsb2NhdGlvbi5oYXNoID0gJyc7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiDop6blj5Hmn5DkuKrot6/nlLHvvIzmiafooYzlm57osIPlh73mlbAKICAgICAgICAgKiBAcGFyYW0gaGFzaAogICAgICAgICAqIEBwYXJhbSBjYWxsYmFjayDmiafooYzlrozot6/nlLHlkI7nmoTlm57osIPlh73mlbAKICAgICAgICAgKiBAcGFyYW0gZm9yY2Ug5piv5ZCm5YaZ5YWl5Y6G5Y+y6K6w5b2VCiAgICAgICAgICovCiAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24oaGFzaCwgY2FsbGJhY2ssIGZvcmNlKSB7CiAgICAgICAgICAgIGhlbHBlci5zZXRIYXNoKGhhc2gsIGZvcmNlKTsKICAgICAgICAgICAgaWYoJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgewogICAgICAgICAgICAgICAgdmFyIGZldGNoID0gaGVscGVyLmZldGNoKGhhc2gsIGNhY2hlKTsKICAgICAgICAgICAgICAgIGlmKGZldGNoLmFjdGlvbikgewogICAgICAgICAgICAgICAgICAgIGZldGNoLmFjdGlvbi5jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiDorr7lrprot6/nlLHnm5HlkKwKICAgICAgICAgKiBAcGFyYW0gb2JqIOmUruWAvOWvue+8jGtleeaYr+i3r+eUseihqO+8jOWAvOaYr+i3r+eUseWvueW6lOeahOWKqOS9nOWHveaVsOOAgui3r+eUseihqOaUr+aMge+8mgogICAgICAgICAqICAgICAgICAgIDrpgJrphY3nrKbvvIzkvovlpoLvvJogdXNlci86aWQg5Y+v5Lul5Yy56YWNIHVzZXIvMiAgIHVzZXIvMzMKICAgICAgICAgKiAgICAgICAgICAq6YCa6YWN56ym77yM5L6L5aaC77yaICpwb3N0IOWPr+S7peWMuemFjSB1c2VycG9zdCAgICBkZWxwb3N0CiAgICAgICAgICovCiAgICAgICAgbGlzdGVuOiBmdW5jdGlvbihvYmopIHsKICAgICAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZm9yKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoa2V5ICE9PSBkZWZhdWx0Um91dGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFjYWNoZVtrZXldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZVtrZXldID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZzogaGVscGVyLnJvdXRlVG9SZWcoa2V5KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246IG9ialtrZXldCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdEhhc2ggPSBvYmpba2V5XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKCk7CgogICAgICAgICAgICBpZihzdXBwb3J0SGFzaCkgewogICAgICAgICAgICAgICAgd2luZG93Lm9uaGFzaGNoYW5nZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7CiAgICAgICAgICAgICAgICAgICAgdmFyIHByZXYgPSBlLm9sZFVSTCB8fCBwcmV2VVJMOwogICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSBlLm5ld1VSTCB8fCBsb2NhdGlvbi5ocmVmOwogICAgICAgICAgICAgICAgICAgIHZhciBoYXNoID0gaGVscGVyLmdldEhhc2goKTsKICAgICAgICAgICAgICAgICAgICBpZihwcmV2ICE9PSB1cmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJldlVSTCA9IHVybDsKICAgICAgICAgICAgICAgICAgICAgICAgaGVscGVyLm1hdGNoKGhhc2ggPyBoYXNoIDogZGVmYXVsdEhhc2gsIGNhY2hlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYoIWlmcmFtZSkgewogICAgICAgICAgICAgICAgICAgICQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbCA9ICQoJzxpZnJhbWUgdGFiaW5kZXg9Ii0xIiBzdHlsZT0iZGlzcGxheTpub25lIiB3aWRodD0iMCIgaGVpZ2h0PSIwIi8+JykuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmcmFtZSA9IGVsWzBdLmNvbnRlbnRXaW5kb3c7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmJpbmQoJ2xvYWQnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoYXNoID0gaGVscGVyLmdldEhhc2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLnVuYmluZCgnbG9hZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvYyA9IGlmcmFtZS5kb2N1bWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5vcGVuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Mud3JpdGUoJzwhRE9DVFlQRSBodG1sPjxodG1sPjxib2R5PicgKyBoYXNoICsgJzwvYm9keT48L2h0bWw+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoYXNoID0gaGVscGVyLmdldEhhc2goKTsvLyDkuLvnqpflj6PkuK3nmoRoYXNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhpc3RvcnlIYXNoID0gaWZyYW1lLmRvY3VtZW50LmJvZHkuaW5uZXJUZXh0Oy8vIOS4iuS4gOasoWhhc2gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihoYXNoICE9PSBsYXN0SGFzaCkgeyAvLyDkuLvnqpflj6NoYXNo5pS55Y+YCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RIYXNoID0gaGFzaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaGFzaCAhPT0gaGlzdG9yeUhhc2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy5vcGVuKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Mud3JpdGUoJzwhRE9DVFlQRSBodG1sPjxodG1sPjxib2R5PicgKyBoYXNoICsgJzwvYm9keT48L2h0bWw+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2MuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWxwZXIubWF0Y2goaGFzaCwgY2FjaGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihoaXN0b3J5SGFzaCAhPT0gbGFzdEhhc2gpIHsvLyDlm57pgIAv5YmN6L+bCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhhc2ggPSBoaXN0b3J5SGFzaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBpbml0SGFzaCA9IGhlbHBlci5nZXRIYXNoKCk7IC8vIOi/m+WFpemhtemdouaXtuWAmeeahGhhc2gKICAgICAgICAgICAgaWYoaW5pdEhhc2gpIHsKICAgICAgICAgICAgICAgIGhlbHBlci5tYXRjaChpbml0SGFzaCwgY2FjaGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaGVscGVyLm1hdGNoKGRlZmF1bHRIYXNoLCBjYWNoZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIG1vZHVsZS5leHBvcnRzID0gcjsKfSk7",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 02:08:01 GMT",
                    "Content-Length": "7449",
                    "Date": "Fri, 07 Nov 2014 02:08:03 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}