{
    "url": "http://localhost:9999/OceanInternet/jquery-mobile-build/tests/jquery.testHelper.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.search</b> and written to <b>location.href</b> via the following statements:<ul><li>search = location.search.replace( \"?\", \"\");</li><li>pairs = search.split( \"&amp;\" );</li><li>pairs = pairs.concat( paramPairs ? paramPairs : [] );</li><li>location.href= location.href.toString() .replace(/\\/[^\\/]*\\..., \"/\" + filename) .replace(search, \"\" ) + (pairs.length? \"?\" + pairs.join(\"&amp;\" ) : \"\" ) </li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/OceanInternet/jquery-mobile-build/tests/jquery.testHelper.js",
                "path": "/OceanInternet/jquery-mobile-build/tests/jquery.testHelper.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9PY2VhbkludGVybmV0L2pxdWVyeS1tb2JpbGUtYnVpbGQvdGVzdHMvanF1ZXJ5LnRlc3RIZWxwZXIuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTQ1ODQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDY6NDc6MzMgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA2OjQ3OjI5IEdNVA0KDQovKgogKiBtb2JpbGUgc3VwcG9ydCB1bml0IHRlc3RzCiAqLwoKKGZ1bmN0aW9uKCAkICkgewoJJC50ZXN0SGVscGVyID0gewoJCS8vIFRoaXMgZnVuY3Rpb24gdGFrZXMgc2V0cyBvZiBmaWxlcyB0byBsb2FkIGFzeW5jaHJvbm91c2x5LiBFYWNoIHNldCB3aWxsIGJlIGxvYWRlZCBhZnRlcgoJCS8vIHRoZSBwcmV2aW91cyBzZXQgaGFzIGNvbXBsZXRlZCBsb2FkaW5nLiBUaGF0IGlzLCBlYWNoIHJlcXVpcmUgYW5kIGl0J3MgZGVwZW5kZW5jaWVzIGluIGEKCQkvLyBzZXQgd2lsbCBiZSBsb2FkZWQgYXN5bmNocm9ub3VzbHksIGJ1dCBlYWNoIHNldCB3aWxsIGJlIHJ1biBpbiBzZXJpYWwuCgkJYXN5bmNMb2FkOiBmdW5jdGlvbiggc2VxLCBiYXNlVXJsICkgewoJCQlyZXF1aXJlKHsKCQkJCWJhc2VVcmw6IGJhc2VVcmwgfHwgIi4uLy4uLy4uL2pzIgoJCQl9KTsKCgkJCWZ1bmN0aW9uIGxvYWRTZXEoIHNlcSwgaSApewoJCQkJaWYoICFzZXFbaV0gKXsKCQkJCQkkKCBkb2N1bWVudCApLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJCQkJdmFyICRmaXh0dXJlID0gJCggJyNxdW5pdC1maXh0dXJlJyApOwoJCQkJCQlpZiAoICRmaXh0dXJlLmxlbmd0aCApIHsKCQkJCQkJCVFVbml0LmNvbmZpZy5maXh0dXJlID0gJGZpeHR1cmUuaHRtbCgpOwoJCQkJCQl9CgkJCQkJCVFVbml0LnN0YXJ0KCk7CgkJCQkJfSk7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCXJlcXVpcmUoIHNlcVtpXSwgZnVuY3Rpb24oKSB7CgkJCQkJbG9hZFNlcShzZXEsIGkgKyAxKTsKCQkJCX0pOwoJCQl9CgoJCQkvLyBzdG9wIHF1bml0IGZyb20gcnVubmluZyB0aGUgdGVzdHMgdW50aWwgZXZlcnl0aGluZyBpcyBpbiB0aGUgcGFnZQoJCQlRVW5pdC5jb25maWcuYXV0b3N0YXJ0ID0gZmFsc2U7CgoJCQlsb2FkU2VxKCBzZXEsIDAgKTsKCQl9LAoKCQlleGNsdWRlRmlsZVByb3RvY29sOiBmdW5jdGlvbihjYWxsYmFjayl7CgkJCXZhciBtZXNzYWdlID0gIlRlc3RzIHJlcXVpcmUgc2NyaXB0IHJlbG9hZCBhbmQgY2Fubm90IGJlIHJ1biB2aWEgZmlsZTogcHJvdG9jb2wiOwoKCQkJaWYgKGxvY2F0aW9uLnByb3RvY29sID09ICJmaWxlOiIpIHsKCQkJCXRlc3QobWVzc2FnZSwgZnVuY3Rpb24oKXsKCQkJCQlvayhmYWxzZSwgbWVzc2FnZSk7CgkJCQl9KTsKCQkJfSBlbHNlIHsKCQkJCWNhbGxiYWNrKCk7CgkJCX0KCQl9LAoKCQkvLyBUT0RPIHByZXZlbnQgdGVzdCBzdWl0ZSBsb2FkcyB3aGVuIHRoZSBicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBwdXNoIHN0YXRlCgkJLy8gYW5kIHB1c2gtc3RhdGUgZmFsc2UgaXMgZGVmaW5lZC4KCQlzZXRQdXNoU3RhdGU6IGZ1bmN0aW9uKCkgewoJCQlpZiggJC5zdXBwb3J0LnB1c2hTdGF0ZSAmJiBsb2NhdGlvbi5zZWFyY2guaW5kZXhPZiggInB1c2gtc3RhdGUiICkgPj0gMCApIHsKCQkJCSQuc3VwcG9ydC5wdXNoU3RhdGUgPSBmYWxzZTsKCQkJCSQubW9iaWxlLndpbmRvdy51bmJpbmQoICJwb3BzdGF0ZS5uYXZpZ2F0ZSIgKTsKCQkJCSQubW9iaWxlLndpbmRvdy51bmJpbmQoICJwb3BzdGF0ZS5oYXNoY2hhbmdlIiApOwoJCQkJJC5ldmVudC5zcGVjaWFsLm5hdmlnYXRlLmJvdW5kID0gZmFsc2U7CgkJCQkkLmV2ZW50LnNwZWNpYWwubmF2aWdhdGUuc2V0dXAoKTsKCQkJfQoJCX0sCgoJCXNldFBhZ2VUcmFuc2l0aW9uOiBmdW5jdGlvbigpIHsKCQkJaWYoIGxvY2F0aW9uLnNlYXJjaC5pbmRleE9mKCAidHJhbnNpdGlvbj1ub25lIiApID49IDAgKSB7CgkJCQkkKCBkb2N1bWVudCApLmJpbmQoICdtb2JpbGVpbml0JywgZnVuY3Rpb24oKSB7CgkJCQkJJC5tb2JpbGUuZGVmYXVsdFBhZ2VUcmFuc2l0aW9uID0gIm5vbmUiOwoJCQkJfSk7CgkJCX0KCQl9LAoKCQlyZWRpcmVjdDogZnVuY3Rpb24oIGZpbGVuYW1lLCBwYXJhbVBhaXJzICkgewoJCQl2YXIgc2VhcmNoLCBwYWlycyA9IFtdOwoKCQkJc2VhcmNoID0gbG9jYXRpb24uc2VhcmNoLnJlcGxhY2UoICI/IiwgIiIpOwoKCQkJaWYoIHNlYXJjaCApewoJCQkJcGFpcnMgPSBzZWFyY2guc3BsaXQoICImIiApOwoJCQl9CgoJCQlwYWlycyA9IHBhaXJzLmNvbmNhdCggcGFyYW1QYWlycyA/IHBhcmFtUGFpcnMgOiBbXSApOwoKCQkJbG9jYXRpb24uaHJlZiA9IGxvY2F0aW9uLmhyZWYudG9TdHJpbmcoKQoJCQkJLnJlcGxhY2UoL1wvW15cL10qXD98XC9bXlwvXSokLywgIi8iICsgZmlsZW5hbWUgKQoJCQkJLnJlcGxhY2UoIHNlYXJjaCwgIiIpICsgKHBhaXJzLmxlbmd0aCA/ICI/IiArIHBhaXJzLmpvaW4oICImIiApIDogIiIpOwoJCX0sCgoJCXB1c2hTdGF0ZVJlZGlyZWN0OiBmdW5jdGlvbiggZmlsZW5hbWUgKSB7CgkJCXRoaXMucmVkaXJlY3QoIGZpbGVuYW1lLCBbInB1c2gtc3RhdGU9ZmFsc2UiXSApOwoJCX0sCgoJCXJlbG9hZHM6IHt9LAoKCQlyZWxvYWRNb2R1bGU6IGZ1bmN0aW9uKGxpYk5hbWUpewoJCQl2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7CgoJCQkvLyB3aGVyZSBhIG1vZHVsZSBsb2FkZXIgaXNuJ3QgZGVmaW5lZCB1c2UgdGhlIG9sZCB3YXkKCQkJaWYoICF3aW5kb3cucmVxdWlyZSApIHsKCQkJCXRoaXMucmVsb2FkTGliKCBsaWJOYW1lICk7CgkJCQlkZWZlcnJlZC5yZXNvbHZlKCk7CgkJCQlyZXR1cm4gZGVmZXJyZWQ7CgkJCX0KCgkJCWlmKHRoaXMucmVsb2Fkc1tsaWJOYW1lXSA9PT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLnJlbG9hZHNbbGliTmFtZV0gPSB7CgkJCQkJY291bnQ6IDAKCQkJCX07CgkJCX0KCgkJCS8vQ2xlYXIgaW50ZXJuYWwgY2FjaGUgb2YgbW9kdWxlIGluc2lkZSBvZiByZXF1aXJlCgkJCXJlcXVpcmVqcy51bmRlZiggbGliTmFtZSApOwoKCQkJcmVxdWlyZSgKCQkJCXsKCQkJCQliYXNlVXJsOiAiLi4vLi4vLi4vanMiCgkJCQl9LCBbbGliTmFtZV0sCgkJCQlmdW5jdGlvbigpIHsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlKCk7CgkJCQl9CgkJCSk7CgoJCQlyZXR1cm4gZGVmZXJyZWQ7CgkJfSwKCgkJcmVsb2FkTGliOiBmdW5jdGlvbihsaWJOYW1lKXsKCQkJdmFyIHJlbG9hZDsKCgkJCWlmKHRoaXMucmVsb2Fkc1tsaWJOYW1lXSA9PT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLnJlbG9hZHNbbGliTmFtZV0gPSB7CgkJCQkJbGliOiAkKCAic2NyaXB0W3NyYyQ9JyIgKyBsaWJOYW1lICsgIiddIiApLAoJCQkJCWRhdGFTcmNMaWI6ICQoICJzY3JpcHRbZGF0YS1zcmMkPSciICsgbGliTmFtZSArICInXSIpLAoJCQkJCWNvdW50OiAwCgkJCQl9OwoJCQl9CgoJCQlyZWxvYWQgPSB0aGlzLnJlbG9hZHNbbGliTmFtZV07CgoJCQl2YXIgc3JjID0gcmVsb2FkLmxpYi5hdHRyKCdzcmMnKSB8fCByZWxvYWQuZGF0YVNyY0xpYi5hdHRyKCAiZGF0YS1zcmMiICkgKyAiPyIgKyB0aGlzLnJlbG9hZHNbbGliTmFtZV0uY291bnQrKzsKCQkJJC5hamF4KCB7IHVybDogc3JjLCBkYXRhVHlwZTogInNjcmlwdCIsIGFzeW5jOiBmYWxzZSB9ICk7CgkJfSwKCgkJcmVydW5RdW5pdDogZnVuY3Rpb24oKXsKCQkJdmFyIHNlbGYgPSB0aGlzOwoJCQlRVW5pdC5pbml0KCk7CgkJCSQoInNjcmlwdDpub3QoW3NyYyo9Jy5cLyddKSIpLmVhY2goZnVuY3Rpb24oaSwgZWxlbSl7CgkJCQl2YXIgc3JjID0gZWxlbS5zcmMuc3BsaXQoIi8iKTsKCQkJCXNlbGYucmVsb2FkTGliKHNyY1tzcmMubGVuZ3RoIC0gMV0pOwoJCQl9KTsKCQkJUVVuaXQuc3RhcnQoKTsKCQl9LAoKCQlhbHRlckV4dGVuZDogZnVuY3Rpb24oZXh0cmFFeHRlbnNpb24pewoJCQl2YXIgZXh0ZW5kRm4gPSAkLmV4dGVuZDsKCgkJCSQuZXh0ZW5kID0gZnVuY3Rpb24ob2JqZWN0LCBleHRlbnNpb24pewoJCQkJLy8gTk9URSBleHRlbmQgdGhlIG9iamVjdCBhcyBub3JtYWwKCQkJCXZhciByZXN1bHQgPSBleHRlbmRGbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKCQkJCS8vIE5PVEUgYWRkIGN1c3RvbSBleHRlbnNpb25zCgkJCQlyZXN1bHQgPSBleHRlbmRGbihyZXN1bHQsIGV4dHJhRXh0ZW5zaW9uKTsKCQkJCXJldHVybiByZXN1bHQ7CgkJCX07CgkJfSwKCgkJaGlkZUFjdGl2ZVBhZ2VXaGVuQ29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQlpZiggJCgnI3F1bml0LXRlc3RyZXN1bHQnKS5sZW5ndGggPiAwICkgewoJCQkJJCgnLnVpLXBhZ2UtYWN0aXZlJykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTsKCQkJfSBlbHNlIHsKCQkJCXNldFRpbWVvdXQoJC50ZXN0SGVscGVyLmhpZGVBY3RpdmVQYWdlV2hlbkNvbXBsZXRlLCA1MDApOwoJCQl9CgkJfSwKCgkJb3BlblBhZ2U6IGZ1bmN0aW9uKGhhc2gpewoJCQlsb2NhdGlvbi5oYXNoID0gaGFzaDsKCQl9LAoKCQlzZXF1ZW5jZTogZnVuY3Rpb24oZm5zLCBpbnRlcnZhbCl7CgkJCSQuZWFjaChmbnMsIGZ1bmN0aW9uKGksIGZuKXsKCQkJCXNldFRpbWVvdXQoZm4sIGkgKiBpbnRlcnZhbCk7CgkJCX0pOwoJCX0sCgoJCXBhZ2VTZXF1ZW5jZTogZnVuY3Rpb24oIGZucyApewoJCQl0aGlzLmV2ZW50U2VxdWVuY2UoICJwYWdlY2hhbmdlIiwgZm5zICk7CgkJfSwKCgkJZXZlbnRTZXF1ZW5jZTogZnVuY3Rpb24oIGV2ZW50LCBmbnMsIHRpbWVkT3V0ICl7CgkJCXZhciBzZXEgPSBbXTsKCQkJJC5lYWNoKGZucywgZnVuY3Rpb24oIGksIGZuICkgewoJCQkJc2VxLnB1c2goIGZuICk7CgkJCQlpZiggaSAhPT0gZm5zLmxlbmd0aCAtIDEpIHNlcS5wdXNoKCBldmVudCApOwoJCQl9KTsKCgkJCXRoaXMuZXZlbnRDYXNjYWRlKCBzZXEgKTsKCQl9LAoKCQlldmVudFRhcmdldDogdW5kZWZpbmVkLAoKCQlldmVudENhc2NhZGU6IGZ1bmN0aW9uKCBzZXF1ZW5jZSwgdGltZWRPdXQsIGRhdGEgKSB7CgkJCXZhciBmbiA9IHNlcXVlbmNlLnNoaWZ0KCksCgkJCQlldmVudCA9IHNlcXVlbmNlLnNoaWZ0KCksCgkJCQlzZWxmID0gdGhpczsKCgkJCWlmKCBmbiA9PT0gdW5kZWZpbmVkICkgewoJCQkJc2VsZi5ldmVudENhc2NhZGVUYXJnZXQgPSB1bmRlZmluZWQ7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmKCBldmVudCApewoJCQkJLy8gaWYgYSBwYWdlY2hhbmdlIG9yIGRlZmluZWQgZXZlbnQgaXMgbmV2ZXIgdHJpZ2dlcmVkCgkJCQkvLyBjb250aW51ZSBpbiB0aGUgc2VxdWVuY2UgdG8gYWxlcnQgcG9zc2libGUgZmFpbHVyZXMKCQkJCXZhciB3YXJuVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQkJCXNlbGYuZXZlbnRDYXNjYWRlKCBzZXF1ZW5jZSwgdHJ1ZSApOwoJCQkJfSwgMTAwMDApOwoKCQkJCS8vIGJpbmQgdGhlIHJlY3Vyc2l2ZSBjYWxsIHRvIHRoZSBldmVudAoJCQkJKCBzZWxmLmV2ZW50VGFyZ2V0IHx8ICQubW9iaWxlLnBhZ2VDb250YWluZXIgKS5vbmUoZXZlbnQsIGZ1bmN0aW9uKCBldmVudCwgZGF0YSApIHsKCQkJCQljbGVhclRpbWVvdXQoIHdhcm5UaW1lciApOwoKCQkJCQkvLyBMZXQgdGhlIGN1cnJlbnQgc3RhY2sgdW53aW5kIGJlZm9yZSB3ZSBmaXJlIG9mZiB0aGUgbmV4dCBpdGVtIGluIHRoZSBzZXF1ZW5jZS4KCQkJCQkvLyBUT0RPIHNldFRpbWVvdXQoc2VsZi5wYWdlU2VxdWVuY2UsIDAsIHNlcXVlbmNlKTsKCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IHNlbGYuZXZlbnRDYXNjYWRlKHNlcXVlbmNlLCBmYWxzZSwgZGF0YSApOyB9LCAwKTsKCQkJCX0pOwoJCQl9CgoJCQkvLyBpbnZva2UgdGhlIGZ1bmN0aW9uIHdoaWNoIHNob3VsZCwgaW4gc29tZSBmYXNoaW9uLAoJCQkvLyB0cmlnZ2VyIHRoZSBuZXh0IGV2ZW50CgkJCWZuKCB0aW1lZE91dCwgZGF0YSApOwoJCX0sCgovLyBkZXRhaWxlZEV2ZW50Q2FzY2FkZTogY2FsbCBhIGZ1bmN0aW9uIGFuZCBleHBlY3QgYSBzZXJpZXMgb2YgZXZlbnRzIHRvIGJlIHRyaWdnZXJlZCAob3Igbm90IHRvIGJlIHRyaWdnZXJlZCksIGFuZCBndWFyZAovLyB3aXRoIGEgdGltZW91dCBhZ2FpbnN0IGdldHRpbmcgc3Rvb2QgdXAuIFJlY29yZCB0aGUgcmVzdWx0ICh0aW1lZCBvdXQgLyB3YXMgdHJpZ2dlcmVkKSBmb3IgZWFjaCBldmVudCwgYW5kIHRoZSBvcmRlcgovLyBpbiB3aGljaCB0aGUgZXZlbnQgYXJyaXZlZCB3cnQuIGFueSBvdGhlciBldmVudHMgZXhwZWN0ZWQuCi8vCQlzZXEgOiBbCi8vCQkJZm4ocmVzdWx0KSwKLy8JCQl7IGtleTogewovLwkJCQkJc3JjOiBldmVudCBzb3VyY2UgKGlzIGpRdWVyeSBvYmplY3Qgb3IgZnVuY3Rpb24gcmV0dXJuaW5nIGpRdWVyeSBvYmplY3QpLAovLwkJCQkJICAgICAoTkI6IFlvdSBzaG91bGQgdXNlIGEgZnVuY3Rpb24gcmV0dXJuaW5nIGEgalF1ZXJ5IG9iamVjdCBhcyB0aGUgdmFsdWUgZm9yIHRoaXMgcGFyYW1ldGVyCi8vCQkJCQkgICAgICBpZiB0aGVyZSBpcyBhIGNoYW5jZSB0aGF0IGF0IHRoZSB0aW1lIG9mIGNvbnN0cnVjdGlvbiBvZiB0aGUgalF1ZXJ5IG9iamVjdCAodGhhdCBpcywgd2hlbgovLwkJCQkJICAgICAgdGhlIGNhbGwgdG8gZGV0YWlsZWRFdmVudENhc2NhZGUgaXMgbWFkZSkgdGhlIGVsZW1lbnRzIHNlbGVjdGVkIGJ5IHRoZSBqUXVlcnkgb2JqZWN0IGFyZQovLwkJCQkJICAgICAgbm90IHlldCBwcmVzZW50IGluIHRoZSBET00gLSBzdWNoIGFzLCBmb3IgaW5zdGFuY2UsIHdoZW4gdGhlIGVsZW1lbnRzIGFyZSBwYXJ0IG9mIGEgcGFnZQovLwkJCQkJICAgICAgdGhhdCBnZXRzIEFKQVhlZCBpbiBzdWJzZXF1ZW50bHksIHN1Y2ggYXMgZHVyaW5nIGEgZnVuY3Rpb24gdGhhdCdzIHBhcnQgb2YgdGhlIHNlcXVlbmNlIG9mCi8vCQkJCQkgICAgICBmdW5jdGlvbnMgcGFzc2VkIHRvIGRldGFpbGVkRXZlbnRDYXNjYWRlLikKLy8JCQkJCWxlbmd0aDogdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgZm9yIHRoZSB0aW1lb3V0IC0gb25seSB1c2VkIGlmIHNyYyBpcyBub3Qgc2V0LAovLwkJCQkJZXZlbnQ6IGV2ZW50IG5hbWUgKGlzIHN0cmluZyksIG9ubHkgdXNlZCBpZiBzcmMgaXMgc2V0LAovLwkJCQkJICAgICAgIChOQjogSXQncyBhIGdvb2QgaWRlYSB0byBuYW1lc3BhY2UgeW91ciBldmVudHMsIGJlY2F1c2UgdGhlIGhhbmRsZXIgd2lsbCBiZSByZW1vdmVkCi8vCQkJCQkgICAgICAgIGJhc2VkIG9uIHRoZSBuYW1lIHlvdSBnaXZlIGhlcmUgaWYgYSB0aW1lb3V0IG9jY3VycyBiZWZvcmUgdGhlIGV2ZW50IGZpcmVzLikKLy8KLy8JCQkJCXVzZXJEYXRhMTogdmFsdWUsCi8vCQkJCQkuLi4KLy8JCQkJCXVzZXJEYXRhbjogdmFsdWUKLy8JCQkgIH0sCi8vCQkJCS4uLgovLwkJCV0KLy8JCQkuLi4KLy8JCV0KLy8JCXJlc3VsdDogewovLwkJCWtleTogewovLwkJCQlpZHg6IG9yZGVyIGluIHdoaWNoIHRoZSBldmVudCBmaXJlZAovLwkJCQlzcmM6IGV2ZW50IHNvdXJjZSAoaXMgalF1ZXJ5IG9iamVjdCksCi8vCQkJCWV2ZW50OiBldmVudCBuYW1lIChpcyBzdHJpbmcpCi8vCQkJCXRpbWVkT3V0OiB0aW1lZCBvdXQgKGlzIGJvb2xlYW4pCi8vCQkJCXVzZXJEYXRhMTogdmFsdWUsCi8vCQkJCS4uLgovLwkJCQl1c2VyRGF0YW46IHZhbHVlCi8vCQkJfQovLwkJCS4uLgovLwkJfQoJCWRldGFpbGVkRXZlbnRDYXNjYWRlOiBmdW5jdGlvbiggc2VxLCByZXN1bHQgKSB7CgkJCS8vIGdyYWIgb25lIHN0ZXAgZnJvbSB0aGUgc2VxdWVuY2UKCQkJdmFyIGZuID0gc2VxLnNoaWZ0KCksCgkJCQlldmVudHMgPSBzZXEuc2hpZnQoKSwKCQkJCXNlbGYgPSB0aGlzLAoJCQkJZGVyZWZTcmMgPSBmdW5jdGlvbiggc3JjICkgewoJCQkJCXJldHVybiAoICQuaXNGdW5jdGlvbiggc3JjICkgPyBzcmMoKSA6IHNyYyApOwoJCQkJfTsKCgkJCS8vIHdlJ3JlIGRvbmUKCQkJaWYgKCBmbiA9PT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBBdHRhY2ggaGFuZGxlcnMgdG8gdGhlIHZhcmlvdXMgb2JqZWN0cyB3aGljaCBhcmUgdG8gYmUgY2hlY2tlZCBmb3IgY29ycmVjdCBldmVudCBnZW5lcmF0aW9uCgkJCWlmICggZXZlbnRzICkgewoJCQkJdmFyIG5ld1Jlc3VsdCA9IHt9LAoJCQkJCW5FdmVudHNEb25lID0gMCwKCQkJCQluRXZlbnRzID0gMCwKCQkJCQlyZWNvcmRSZXN1bHQgPSBmdW5jdGlvbigga2V5LCBldmVudCwgcmVzdWx0ICkgewoJCQkJCQkvLyBSZWNvcmQgdGhlIHJlc3VsdAoJCQkJCQluZXdSZXN1bHRbIGtleSBdID0gJC5leHRlbmQoIHt9LCBldmVudCwgcmVzdWx0ICk7CgkJCQkJCS8vIEluY3JlbWVudCB0aGUgbnVtYmVyIG9mIHJlY2VpdmVkIHJlc3BvbnNlcwoJCQkJCQluRXZlbnRzRG9uZSsrOwoJCQkJCQlpZiAoIG5FdmVudHNEb25lID09PSBuRXZlbnRzICkgewoJCQkJCQkJLy8gY2xlYXIgdGhlIHRpbWVvdXQgYW5kIG1vdmUgb24gdG8gdGhlIG5leHQgc3RlcCB3aGVuIGFsbCBldmVudHMgaGF2ZSBiZWVuIHJlY2VpdmVkCgkJCQkJCQlpZiAoIHdhcm5UaW1lciApIHsKCQkJCQkJCQljbGVhclRpbWVvdXQoIHdhcm5UaW1lciApOwoJCQkJCQkJfQoJCQkJCQkJc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJCQkJc2VsZi5kZXRhaWxlZEV2ZW50Q2FzY2FkZSggc2VxLCBuZXdSZXN1bHQgKTsKCQkJCQkJCX0sIDApOwoJCQkJCQl9CgkJCQkJfSwKCQkJCQkvLyBzZXQgYSBmYWlsc2FmZSB0aW1lciBpbiBjYXNlIG9uZSBvZiB0aGUgZXZlbnRzIG5ldmVyIGhhcHBlbnMKCQkJCQl3YXJuVGltZXIgPSBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHsKCQkJCQkJd2FyblRpbWVyID0gMDsKCQkJCQkJJC5lYWNoKCBldmVudHMsIGZ1bmN0aW9uKCBrZXksIGV2ZW50ICkgewoJCQkJCQkJLy8gVGltZW91dHMgYXJlIGxlZnQgb3V0IG9mIHRoaXMsIGJlY2F1c2UgdGhleSB3aWxsIGNvbXBsZXRlIGZvcgoJCQkJCQkJLy8gc3VyZSwgY2FsbGluZyByZWNvcmRSZXN1bHQgd2hlbiB0aGV5IGRvCgkJCQkJCQlpZiAoIG5ld1Jlc3VsdFsga2V5IF0gPT09IHVuZGVmaW5lZCAmJiBldmVudC5zcmMgKSB7CgkJCQkJCQkJLy8gY2xlYW4gdXAgdGhlIHVudXNlZCBoYW5kbGVyCgkJCQkJCQkJZGVyZWZTcmMoIGV2ZW50LnNyYyApLnVuYmluZCggZXZlbnQuZXZlbnQgKTsKCQkJCQkJCQlyZWNvcmRSZXN1bHQoIGtleSwgZXZlbnQsIHsgdGltZWRPdXQ6IHRydWUgfSApOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9LCA1MDAwKTsKCgkJCQkkLmVhY2goIGV2ZW50cywgZnVuY3Rpb24oIGtleSwgZXZlbnQgKSB7CgkJCQkJLy8gQ291bnQgdGhlIGV2ZW50cyBzbyB0aGF0IHdlIG1heSBrbm93IGhvdyBtYW55IHJlc3BvbnNlcyB0byBleHBlY3QKCQkJCQluRXZlbnRzKys7CgkJCQkJLy8gSWYgaXQncyBhbiBldmVudAoJCQkJCWlmICggZXZlbnQuc3JjICkgewoJCQkJCQkvLyBIb29rIHVwIHRvIHRoZSBldmVudAoJCQkJCQlkZXJlZlNyYyggZXZlbnQuc3JjICkub25lKCBldmVudC5ldmVudCwgZnVuY3Rpb24oKSB7CgkJCQkJCQlyZWNvcmRSZXN1bHQoIGtleSwgZXZlbnQsIHsgdGltZWRPdXQ6IGZhbHNlLCBpZHg6IG5FdmVudHNEb25lIH0gKTsKCQkJCQkJfSk7CgkJCQkJfQoJCQkJCS8vIElmIGl0J3MgYSB0aW1lb3V0CgkJCQkJZWxzZSB7CgkJCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCkgewoJCQkJCQkJcmVjb3JkUmVzdWx0KCBrZXksIGV2ZW50LCB7IHRpbWVkT3V0OiB0cnVlLCBpZHg6IC0xIH0gKTsKCQkJCQkJfSwgZXZlbnQubGVuZ3RoICk7CgkJCQkJfQoJCQkJfSk7CgkJCX0KCgkJCS8vIENhbGwgdGhlIGZ1bmN0aW9uIHdpdGggdGhlIHJlc3VsdCBvZiB0aGUgZXZlbnRzCgkJCWZuKCByZXN1bHQgKTsKCQl9LAoKCQlkZWZlcnJlZFNlcXVlbmNlOiBmdW5jdGlvbihmbnMpIHsKCQkJdmFyIGZuID0gZm5zLnNoaWZ0KCksCgkJCQlkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKSwKCQkJCXNlbGYgPSB0aGlzLCByZXM7CgoJCQlpZiAoZm4pIHsKCQkJCXJlcyA9IGZuKCk7CgkJCQlpZiAoIHJlcyAmJiAkLnR5cGUoIHJlcy5kb25lICkgPT09ICJmdW5jdGlvbiIgKSB7CgkJCQkJcmVzLmRvbmUoZnVuY3Rpb24oKSB7CgkJCQkJCXNlbGYuZGVmZXJyZWRTZXF1ZW5jZSggZm5zICkuZG9uZShmdW5jdGlvbigpIHsKCQkJCQkJCWRlZmVycmVkLnJlc29sdmUoKTsKCQkJCQkJfSk7CgkJCQkJfSk7CgkJCQl9IGVsc2UgewoJCQkJCXNlbGYuZGVmZXJyZWRTZXF1ZW5jZSggZm5zICkuZG9uZShmdW5jdGlvbigpIHsKCQkJCQkJZGVmZXJyZWQucmVzb2x2ZSgpOwoJCQkJCX0pOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZGVmZXJyZWQucmVzb2x2ZSgpOwoJCQl9CgkJCXJldHVybiBkZWZlcnJlZDsKCQl9LAoKCQlkZWNvcmF0ZTogZnVuY3Rpb24ob3B0cyl7CgkJCXZhciB0aGlzVmFsID0gb3B0cy5zZWxmIHx8IHdpbmRvdzsKCgkJCWNvbnNvbGUubG9nKCAiZGVjb3JhdGUgY2FsbGVkIiApOwoKCQkJcmV0dXJuIGZ1bmN0aW9uKCl7CgkJCQljb25zb2xlLmxvZyggImRlY29yYXRlZCBmdW5jdGlvbiBjYWxsZWQiICk7CgkJCQl2YXIgcmV0dXJuVmFsOwoJCQkJb3B0cy5iZWZvcmUgJiYgb3B0cy5iZWZvcmUuYXBwbHkodGhpc1ZhbCwgYXJndW1lbnRzKTsKCQkJCXJldHVyblZhbCA9IG9wdHMuZm4uYXBwbHkodGhpc1ZhbCwgYXJndW1lbnRzKTsKCQkJCW9wdHMuYWZ0ZXIgJiYgb3B0cy5hZnRlci5hcHBseSh0aGlzVmFsLCBhcmd1bWVudHMpOwoKCQkJCXJldHVybiByZXR1cm5WYWw7CgkJCX07CgkJfSwKCgkJYXNzZXJ0VXJsTG9jYXRpb246IGZ1bmN0aW9uKCBhcmdzICkgewoJCQl2YXIgcGFydHMgPSAkLm1vYmlsZS5wYXRoLnBhcnNlVXJsKCBsb2NhdGlvbi5ocmVmICksCgkJCQlwYXRobmFtZU9ud2FyZCA9IGxvY2F0aW9uLmhyZWYucmVwbGFjZSggcGFydHMuZG9tYWluLCAiIiApOwoKCQkJaWYoICQuc3VwcG9ydC5wdXNoU3RhdGUgKSB7CgkJCQlkZWVwRXF1YWwoIHBhdGhuYW1lT253YXJkLCBhcmdzLmhhc2hPclB1c2ggfHwgYXJncy5wdXNoLCBhcmdzLnJlcG9ydCApOwoJCQl9IGVsc2UgewoJCQkJZGVlcEVxdWFsKCBwYXJ0cy5oYXNoLCAiIyIgKyAoYXJncy5oYXNoT3JQdXNoIHx8IGFyZ3MuaGFzaCksIGFyZ3MucmVwb3J0ICk7CgkJCX0KCQl9LAoKCQkvLyBDb252ZXJ0IGEgcGFpciBvZiB2ZXJzaW9uIHN0cmluZ3MgaW50byBhIHBhaXIgb2YgaW50ZWdlcnMgYW5kIHBhc3MgdGhlCgkJLy8gcmVzdWx0aW5nIGludGVnZXJzIHRvIGEgY29tcGFyaXNvbiBmdW5jdGlvbgoJCXZlcnNpb25UZXN0OiBmdW5jdGlvbiggbCwgdCwgciApIHsKCQkJdmFyIGxBciA9IGwuc3BsaXQoICIuIiApLCBsTGVuZ3RoID0gbEFyLmxlbmd0aCwKCQkJCXJBciA9IHIuc3BsaXQoICIuIiApLCByTGVuZ3RoID0gckFyLmxlbmd0aCwKCQkJCWxWYWwsIHJWYWwsIGxSZXMgPSAiIiwgclJlcyA9ICIiLCBtaW4sIG1heCwgc3RyLCBpZHgsIGlkeDEsIGRpZmY7CgkJCWZvciAoIGlkeCA9IDAgOyBpZHggPCBsTGVuZ3RoIHx8IGlkeCA8IHJMZW5ndGggOyBpZHgrKyApIHsKCQkJCXN0ciA9IHt9OwoJCQkJbFZhbCA9ICggaWR4IDwgbExlbmd0aCA/IHBhcnNlSW50KCBsQXJbIGlkeCBdICkgOiAwICk7CgkJCQlyVmFsID0gKCBpZHggPCByTGVuZ3RoID8gcGFyc2VJbnQoIHJBclsgaWR4IF0gKSA6IDAgKTsKCgkJCQkvLyBUaGlzIGlnbm9yZXMgdGhpbmdzIGxpa2UgMTBhIHZzLiAxMGIgZm9yIG5vdwoJCQkJc3RyLmwgPSBTdHJpbmcoIGxWYWwgKTsKCQkJCXN0ci5yID0gU3RyaW5nKCByVmFsICk7CgkJCQltaW4gPSAoIHN0ci5sLmxlbmd0aCA8IHN0ci5yLmxlbmd0aCApID8gImwiIDogInIiOwoJCQkJbWF4ID0gKCBzdHIubC5sZW5ndGggPCBzdHIuci5sZW5ndGggKSA/ICJyIiA6ICJsIjsKCQkJCWRpZmYgPSBzdHJbIG1heCBdLmxlbmd0aCAtIHN0clsgbWluIF0ubGVuZ3RoOwoKCQkJCS8vIE1ha2Ugc3VyZSBvcmRlcnMgb2YgbWFnbml0dWRlIGFsaWduCgkJCQlmb3IgKCBpZHgxID0gMDsgaWR4MSA8IGRpZmYgOyBpZHgxKysgKSB7CgkJCQkJc3RyWyBtaW4gXSA9ICIwIiArIHN0clsgbWluIF07CgkJCQl9CgkJCQlsUmVzID0gbFJlcyArIHN0ci5sOwoJCQkJclJlcyA9IHJSZXMgKyBzdHIucjsKCQkJfQoKCQkJLy8gdHJpbSBpbml0aWFsIDBzIGFuZCByZXR1cm4gdGhlIHJlc3VsdCBvZiB0aGUgY29tcGFyaXNvbgoJCQlyZXR1cm4gdCggcGFyc2VJbnQoIGxSZXMucmVwbGFjZSggL14wKi8sICIiICkgKSwgcGFyc2VJbnQoIHJSZXMucmVwbGFjZSggL14wKi8sICIiICkgKSApOwoJCX0sCgoJCW5hdlJlc2V0OiBmdW5jdGlvbiggaGFzaCApIHsKCQkJdmFyIHRpbWVvdXQ7CgoJCQlzdG9wKCk7CgoJCQl0aW1lb3V0ID0gc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQlzdGFydCgpOwoJCQkJdGhyb3cgIm5hdmlnYXRpb24gcmVzZXQgdGltZWQgb3V0IjsKCQkJfSwgNTAwMCk7CgoJCQkkKGRvY3VtZW50KS5vbmUoICJwYWdlY2hhbmdlIiwgZnVuY3Rpb24oKSB7CgkJCQljbGVhclRpbWVvdXQoIHRpbWVvdXQgKTsKCQkJCXN0YXJ0KCk7CgkJCX0pOwoKCQkJbG9jYXRpb24uaGFzaCA9IGxvY2F0aW9uLmhhc2gucmVwbGFjZSgiIyIsICIiKSA9PT0gaGFzaCA/ICIiIDogIiMiICsgaGFzaDsKCQl9LAoKCQkvLyBDaGVjayBpZiB0d28gY2h1bmtzIG9mIERPTSBhcmUgaWRlbnRpY2FsCgkJZG9tRXF1YWw6IGZ1bmN0aW9uKCBsLCByICkgewoJCQl2YXIgaWR4LCBpZHhBdHRyLCBsYXR0ciwgcmF0dHIsCgkJCQkvLyBEZWNpZGUgd2hldGhlciBhbiBhdHRyaWJ1dGUgc2hvdWxkIGJlIGFkZGVkIHRvIHRob3NlIHRoYXQgd2lsbCBiZSBjb21wYXJlZAoJCQkJYWRkQXR0ciA9IGZ1bmN0aW9uKCBlbCwgaWR4ICkgewoJCQkJCS8vIFNwZWNpYWwgY2FzZSBmb3IgZW1wdHkgY2xhc3MgYXR0cmlidXRlCgkJCQkJaWYgKCBlbC5hdHRyaWJ1dGVzWyBpZHggXS5uYW1lID09PSAiY2xhc3MiICYmICFlbC5hdHRyaWJ1dGVzWyBpZHggXS52YWx1ZSApIHsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0sCgkJCQlhdHRyc0hhc2ggPSBmdW5jdGlvbiggZWwgKSB7CgkJCQkJdmFyIGlkeCwgYXR0cnMgPSB7IGxlbmd0aDogMCwgYXR0cnM6IHt9IH07CgoJCQkJCWZvciAoIGlkeCA9IDAgOyBpZHggPCBlbC5hdHRyaWJ1dGVzLmxlbmd0aCA7IGlkeCsrICkgewoJCQkJCQlpZiAoIGFkZEF0dHIoIGVsLCBpZHggKSApIHsKCQkJCQkJCWF0dHJzLmxlbmd0aCsrOwoJCQkJCQkJYXR0cnMuYXR0cnNbIGVsLmF0dHJpYnV0ZXNbIGlkeCBdLm5hbWUgXSA9IGVsLmF0dHJpYnV0ZXNbIGlkeCBdLnZhbHVlOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQlyZXR1cm4gYXR0cnM7CgkJCQl9OwoKCQkJLy8gSWYgdGhlIGxlbmd0aHMgb2YgdGhlIHR3byBqUXVlcnkgb2JqZWN0cyBhcmUgZGlmZmVyZW50LCB0aGUgRE9NCgkJCS8vIG11c3QgYmUgZGlmZmVyZW50IHNvIGRvbid0IGJvdGhlciBjaGVja2luZwoJCQlpZiAoIGwubGVuZ3RoID09PSByLmxlbmd0aCApIHsKCQkJCS8vIE90aGVyd2lzZSwgZXhhbWluZSBlYWNoIGVsZW1lbnQKCQkJCWZvciAoIGlkeCA9IDAgOyBpZHggPCBsLmxlbmd0aCA7IGlkeCsrICkgewoJCQkJCWwgPSBsLmVxKCBpZHggKTsgciA9IHIuZXEoIGlkeCApOwoKCQkJCQkvLyBJZiB0aGUgdGFnTmFtZSBpcyBkaWZmZXJlbnQgdGhlIERPTSBtdXN0IGJlIGRpZmZlcmVudAoJCQkJCWlmICggbFsgMCBdLnRhZ05hbWUgIT09IHJbIDAgXS50YWdOYW1lICl7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgoJCQkJCS8vIE90aGVyd2lzZSwgY2hlY2sgdGhlIGF0dHJpYnV0ZXMsIGJ1dCBmaXJzdCBjb252ZXJ0IHRoZSBhdHRyaWJ1dGVzCgkJCQkJLy8gYXJyYXkgdG8gYSBkaWN0aW9uYXJ5LCBiZWNhdXNlIHRoZSBvcmRlciBvZiB0aGUgYXR0cmlidXRlcyBtYXkgYmUKCQkJCQkvLyBkaWZmZXJlbnQgYmV0d2VlbiBsIGFuZCByCgkJCQkJbGF0dHIgPSBhdHRyc0hhc2goIGxbIDAgXSApOwoJCQkJCXJhdHRyID0gYXR0cnNIYXNoKCByWyAwIF0gKTsKCgkJCQkJLy8gSWYgbCBhbmQgciBoYXZlIGEgZGlmZmVyZW50IG51bWJlciBvZiBhdHRyaWJ1dGVzLCBkb24ndCBjb250aW51ZQoJCQkJCWlmICggbGF0dHIubGVuZ3RoICE9PSByYXR0ci5sZW5ndGggKSB7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgoJCQkJCS8vIENoZWNrIGlmIGVhY2ggYXR0cmlidXRlIGluIGxhdHRyIGhhcyB0aGUgc2FtZSB2YWx1ZSBpbiByYXR0cgoJCQkJCWZvciAoIGlkeEF0dHIgaW4gbGF0dHIuYXR0cnMgKSB7CgkJCQkJCWlmICggcmF0dHIuYXR0cnNbIGlkeEF0dHIgXSAhPT0gbGF0dHIuYXR0cnNbIGlkeEF0dHIgXSApIHsKCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gSWYgc28sIGNvbXBhcmUgdGhlIGNoaWxkcmVuIG9mIGwgYW5kIHIgcmVjdXJzaXZlbHkKCQkJCQlpZiAoICF0aGlzLmRvbUVxdWFsKCAkKCBsWyAwIF0gKS5jaGlsZHJlbigpLCAkKCByWyAwIF0gKS5jaGlsZHJlbigpICkgKSB7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQkJbCA9IGwuZW5kKCk7IHIgPSByLmVuZCgpOwoJCQkJfQoJCQkJaWYgKCBpZHggPT09IGwubGVuZ3RoICkgewoJCQkJCXJldHVybiB0cnVlOwoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gZmFsc2U7CgkJfSwKCgkJZGVsYXlTdGFydDogZnVuY3Rpb24oIG1pbGxpc2Vjb25kcyApIHsKCQkJLy8gc3RvcCBxdW5pdCBmcm9tIHJ1bm5pbmcgdGhlIHRlc3RzIHVudGlsIGV2ZXJ5dGhpbmcgaXMgaW4gdGhlIHBhZ2UKCQkJUVVuaXQuY29uZmlnLmF1dG9zdGFydCA9IGZhbHNlOwoKCQkJc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJCXN0YXJ0KCk7CgkJCX0sIG1pbGxpc2Vjb25kcyB8fCAyMDAwICk7CgkJfQoJfTsKfSkoalF1ZXJ5KTsK",
                "body": "LyoKICogbW9iaWxlIHN1cHBvcnQgdW5pdCB0ZXN0cwogKi8KCihmdW5jdGlvbiggJCApIHsKCSQudGVzdEhlbHBlciA9IHsKCQkvLyBUaGlzIGZ1bmN0aW9uIHRha2VzIHNldHMgb2YgZmlsZXMgdG8gbG9hZCBhc3luY2hyb25vdXNseS4gRWFjaCBzZXQgd2lsbCBiZSBsb2FkZWQgYWZ0ZXIKCQkvLyB0aGUgcHJldmlvdXMgc2V0IGhhcyBjb21wbGV0ZWQgbG9hZGluZy4gVGhhdCBpcywgZWFjaCByZXF1aXJlIGFuZCBpdCdzIGRlcGVuZGVuY2llcyBpbiBhCgkJLy8gc2V0IHdpbGwgYmUgbG9hZGVkIGFzeW5jaHJvbm91c2x5LCBidXQgZWFjaCBzZXQgd2lsbCBiZSBydW4gaW4gc2VyaWFsLgoJCWFzeW5jTG9hZDogZnVuY3Rpb24oIHNlcSwgYmFzZVVybCApIHsKCQkJcmVxdWlyZSh7CgkJCQliYXNlVXJsOiBiYXNlVXJsIHx8ICIuLi8uLi8uLi9qcyIKCQkJfSk7CgoJCQlmdW5jdGlvbiBsb2FkU2VxKCBzZXEsIGkgKXsKCQkJCWlmKCAhc2VxW2ldICl7CgkJCQkJJCggZG9jdW1lbnQgKS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCQkJCXZhciAkZml4dHVyZSA9ICQoICcjcXVuaXQtZml4dHVyZScgKTsKCQkJCQkJaWYgKCAkZml4dHVyZS5sZW5ndGggKSB7CgkJCQkJCQlRVW5pdC5jb25maWcuZml4dHVyZSA9ICRmaXh0dXJlLmh0bWwoKTsKCQkJCQkJfQoJCQkJCQlRVW5pdC5zdGFydCgpOwoJCQkJCX0pOwoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQlyZXF1aXJlKCBzZXFbaV0sIGZ1bmN0aW9uKCkgewoJCQkJCWxvYWRTZXEoc2VxLCBpICsgMSk7CgkJCQl9KTsKCQkJfQoKCQkJLy8gc3RvcCBxdW5pdCBmcm9tIHJ1bm5pbmcgdGhlIHRlc3RzIHVudGlsIGV2ZXJ5dGhpbmcgaXMgaW4gdGhlIHBhZ2UKCQkJUVVuaXQuY29uZmlnLmF1dG9zdGFydCA9IGZhbHNlOwoKCQkJbG9hZFNlcSggc2VxLCAwICk7CgkJfSwKCgkJZXhjbHVkZUZpbGVQcm90b2NvbDogZnVuY3Rpb24oY2FsbGJhY2spewoJCQl2YXIgbWVzc2FnZSA9ICJUZXN0cyByZXF1aXJlIHNjcmlwdCByZWxvYWQgYW5kIGNhbm5vdCBiZSBydW4gdmlhIGZpbGU6IHByb3RvY29sIjsKCgkJCWlmIChsb2NhdGlvbi5wcm90b2NvbCA9PSAiZmlsZToiKSB7CgkJCQl0ZXN0KG1lc3NhZ2UsIGZ1bmN0aW9uKCl7CgkJCQkJb2soZmFsc2UsIG1lc3NhZ2UpOwoJCQkJfSk7CgkJCX0gZWxzZSB7CgkJCQljYWxsYmFjaygpOwoJCQl9CgkJfSwKCgkJLy8gVE9ETyBwcmV2ZW50IHRlc3Qgc3VpdGUgbG9hZHMgd2hlbiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgcHVzaCBzdGF0ZQoJCS8vIGFuZCBwdXNoLXN0YXRlIGZhbHNlIGlzIGRlZmluZWQuCgkJc2V0UHVzaFN0YXRlOiBmdW5jdGlvbigpIHsKCQkJaWYoICQuc3VwcG9ydC5wdXNoU3RhdGUgJiYgbG9jYXRpb24uc2VhcmNoLmluZGV4T2YoICJwdXNoLXN0YXRlIiApID49IDAgKSB7CgkJCQkkLnN1cHBvcnQucHVzaFN0YXRlID0gZmFsc2U7CgkJCQkkLm1vYmlsZS53aW5kb3cudW5iaW5kKCAicG9wc3RhdGUubmF2aWdhdGUiICk7CgkJCQkkLm1vYmlsZS53aW5kb3cudW5iaW5kKCAicG9wc3RhdGUuaGFzaGNoYW5nZSIgKTsKCQkJCSQuZXZlbnQuc3BlY2lhbC5uYXZpZ2F0ZS5ib3VuZCA9IGZhbHNlOwoJCQkJJC5ldmVudC5zcGVjaWFsLm5hdmlnYXRlLnNldHVwKCk7CgkJCX0KCQl9LAoKCQlzZXRQYWdlVHJhbnNpdGlvbjogZnVuY3Rpb24oKSB7CgkJCWlmKCBsb2NhdGlvbi5zZWFyY2guaW5kZXhPZiggInRyYW5zaXRpb249bm9uZSIgKSA+PSAwICkgewoJCQkJJCggZG9jdW1lbnQgKS5iaW5kKCAnbW9iaWxlaW5pdCcsIGZ1bmN0aW9uKCkgewoJCQkJCSQubW9iaWxlLmRlZmF1bHRQYWdlVHJhbnNpdGlvbiA9ICJub25lIjsKCQkJCX0pOwoJCQl9CgkJfSwKCgkJcmVkaXJlY3Q6IGZ1bmN0aW9uKCBmaWxlbmFtZSwgcGFyYW1QYWlycyApIHsKCQkJdmFyIHNlYXJjaCwgcGFpcnMgPSBbXTsKCgkJCXNlYXJjaCA9IGxvY2F0aW9uLnNlYXJjaC5yZXBsYWNlKCAiPyIsICIiKTsKCgkJCWlmKCBzZWFyY2ggKXsKCQkJCXBhaXJzID0gc2VhcmNoLnNwbGl0KCAiJiIgKTsKCQkJfQoKCQkJcGFpcnMgPSBwYWlycy5jb25jYXQoIHBhcmFtUGFpcnMgPyBwYXJhbVBhaXJzIDogW10gKTsKCgkJCWxvY2F0aW9uLmhyZWYgPSBsb2NhdGlvbi5ocmVmLnRvU3RyaW5nKCkKCQkJCS5yZXBsYWNlKC9cL1teXC9dKlw/fFwvW15cL10qJC8sICIvIiArIGZpbGVuYW1lICkKCQkJCS5yZXBsYWNlKCBzZWFyY2gsICIiKSArIChwYWlycy5sZW5ndGggPyAiPyIgKyBwYWlycy5qb2luKCAiJiIgKSA6ICIiKTsKCQl9LAoKCQlwdXNoU3RhdGVSZWRpcmVjdDogZnVuY3Rpb24oIGZpbGVuYW1lICkgewoJCQl0aGlzLnJlZGlyZWN0KCBmaWxlbmFtZSwgWyJwdXNoLXN0YXRlPWZhbHNlIl0gKTsKCQl9LAoKCQlyZWxvYWRzOiB7fSwKCgkJcmVsb2FkTW9kdWxlOiBmdW5jdGlvbihsaWJOYW1lKXsKCQkJdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpOwoKCQkJLy8gd2hlcmUgYSBtb2R1bGUgbG9hZGVyIGlzbid0IGRlZmluZWQgdXNlIHRoZSBvbGQgd2F5CgkJCWlmKCAhd2luZG93LnJlcXVpcmUgKSB7CgkJCQl0aGlzLnJlbG9hZExpYiggbGliTmFtZSApOwoJCQkJZGVmZXJyZWQucmVzb2x2ZSgpOwoJCQkJcmV0dXJuIGRlZmVycmVkOwoJCQl9CgoJCQlpZih0aGlzLnJlbG9hZHNbbGliTmFtZV0gPT09IHVuZGVmaW5lZCkgewoJCQkJdGhpcy5yZWxvYWRzW2xpYk5hbWVdID0gewoJCQkJCWNvdW50OiAwCgkJCQl9OwoJCQl9CgoJCQkvL0NsZWFyIGludGVybmFsIGNhY2hlIG9mIG1vZHVsZSBpbnNpZGUgb2YgcmVxdWlyZQoJCQlyZXF1aXJlanMudW5kZWYoIGxpYk5hbWUgKTsKCgkJCXJlcXVpcmUoCgkJCQl7CgkJCQkJYmFzZVVybDogIi4uLy4uLy4uL2pzIgoJCQkJfSwgW2xpYk5hbWVdLAoJCQkJZnVuY3Rpb24oKSB7CgkJCQkJZGVmZXJyZWQucmVzb2x2ZSgpOwoJCQkJfQoJCQkpOwoKCQkJcmV0dXJuIGRlZmVycmVkOwoJCX0sCgoJCXJlbG9hZExpYjogZnVuY3Rpb24obGliTmFtZSl7CgkJCXZhciByZWxvYWQ7CgoJCQlpZih0aGlzLnJlbG9hZHNbbGliTmFtZV0gPT09IHVuZGVmaW5lZCkgewoJCQkJdGhpcy5yZWxvYWRzW2xpYk5hbWVdID0gewoJCQkJCWxpYjogJCggInNjcmlwdFtzcmMkPSciICsgbGliTmFtZSArICInXSIgKSwKCQkJCQlkYXRhU3JjTGliOiAkKCAic2NyaXB0W2RhdGEtc3JjJD0nIiArIGxpYk5hbWUgKyAiJ10iKSwKCQkJCQljb3VudDogMAoJCQkJfTsKCQkJfQoKCQkJcmVsb2FkID0gdGhpcy5yZWxvYWRzW2xpYk5hbWVdOwoKCQkJdmFyIHNyYyA9IHJlbG9hZC5saWIuYXR0cignc3JjJykgfHwgcmVsb2FkLmRhdGFTcmNMaWIuYXR0ciggImRhdGEtc3JjIiApICsgIj8iICsgdGhpcy5yZWxvYWRzW2xpYk5hbWVdLmNvdW50Kys7CgkJCSQuYWpheCggeyB1cmw6IHNyYywgZGF0YVR5cGU6ICJzY3JpcHQiLCBhc3luYzogZmFsc2UgfSApOwoJCX0sCgoJCXJlcnVuUXVuaXQ6IGZ1bmN0aW9uKCl7CgkJCXZhciBzZWxmID0gdGhpczsKCQkJUVVuaXQuaW5pdCgpOwoJCQkkKCJzY3JpcHQ6bm90KFtzcmMqPScuXC8nXSkiKS5lYWNoKGZ1bmN0aW9uKGksIGVsZW0pewoJCQkJdmFyIHNyYyA9IGVsZW0uc3JjLnNwbGl0KCIvIik7CgkJCQlzZWxmLnJlbG9hZExpYihzcmNbc3JjLmxlbmd0aCAtIDFdKTsKCQkJfSk7CgkJCVFVbml0LnN0YXJ0KCk7CgkJfSwKCgkJYWx0ZXJFeHRlbmQ6IGZ1bmN0aW9uKGV4dHJhRXh0ZW5zaW9uKXsKCQkJdmFyIGV4dGVuZEZuID0gJC5leHRlbmQ7CgoJCQkkLmV4dGVuZCA9IGZ1bmN0aW9uKG9iamVjdCwgZXh0ZW5zaW9uKXsKCQkJCS8vIE5PVEUgZXh0ZW5kIHRoZSBvYmplY3QgYXMgbm9ybWFsCgkJCQl2YXIgcmVzdWx0ID0gZXh0ZW5kRm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCgkJCQkvLyBOT1RFIGFkZCBjdXN0b20gZXh0ZW5zaW9ucwoJCQkJcmVzdWx0ID0gZXh0ZW5kRm4ocmVzdWx0LCBleHRyYUV4dGVuc2lvbik7CgkJCQlyZXR1cm4gcmVzdWx0OwoJCQl9OwoJCX0sCgoJCWhpZGVBY3RpdmVQYWdlV2hlbkNvbXBsZXRlOiBmdW5jdGlvbigpIHsKCQkJaWYoICQoJyNxdW5pdC10ZXN0cmVzdWx0JykubGVuZ3RoID4gMCApIHsKCQkJCSQoJy51aS1wYWdlLWFjdGl2ZScpLmNzcygnZGlzcGxheScsICdub25lJyk7CgkJCX0gZWxzZSB7CgkJCQlzZXRUaW1lb3V0KCQudGVzdEhlbHBlci5oaWRlQWN0aXZlUGFnZVdoZW5Db21wbGV0ZSwgNTAwKTsKCQkJfQoJCX0sCgoJCW9wZW5QYWdlOiBmdW5jdGlvbihoYXNoKXsKCQkJbG9jYXRpb24uaGFzaCA9IGhhc2g7CgkJfSwKCgkJc2VxdWVuY2U6IGZ1bmN0aW9uKGZucywgaW50ZXJ2YWwpewoJCQkkLmVhY2goZm5zLCBmdW5jdGlvbihpLCBmbil7CgkJCQlzZXRUaW1lb3V0KGZuLCBpICogaW50ZXJ2YWwpOwoJCQl9KTsKCQl9LAoKCQlwYWdlU2VxdWVuY2U6IGZ1bmN0aW9uKCBmbnMgKXsKCQkJdGhpcy5ldmVudFNlcXVlbmNlKCAicGFnZWNoYW5nZSIsIGZucyApOwoJCX0sCgoJCWV2ZW50U2VxdWVuY2U6IGZ1bmN0aW9uKCBldmVudCwgZm5zLCB0aW1lZE91dCApewoJCQl2YXIgc2VxID0gW107CgkJCSQuZWFjaChmbnMsIGZ1bmN0aW9uKCBpLCBmbiApIHsKCQkJCXNlcS5wdXNoKCBmbiApOwoJCQkJaWYoIGkgIT09IGZucy5sZW5ndGggLSAxKSBzZXEucHVzaCggZXZlbnQgKTsKCQkJfSk7CgoJCQl0aGlzLmV2ZW50Q2FzY2FkZSggc2VxICk7CgkJfSwKCgkJZXZlbnRUYXJnZXQ6IHVuZGVmaW5lZCwKCgkJZXZlbnRDYXNjYWRlOiBmdW5jdGlvbiggc2VxdWVuY2UsIHRpbWVkT3V0LCBkYXRhICkgewoJCQl2YXIgZm4gPSBzZXF1ZW5jZS5zaGlmdCgpLAoJCQkJZXZlbnQgPSBzZXF1ZW5jZS5zaGlmdCgpLAoJCQkJc2VsZiA9IHRoaXM7CgoJCQlpZiggZm4gPT09IHVuZGVmaW5lZCApIHsKCQkJCXNlbGYuZXZlbnRDYXNjYWRlVGFyZ2V0ID0gdW5kZWZpbmVkOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlpZiggZXZlbnQgKXsKCQkJCS8vIGlmIGEgcGFnZWNoYW5nZSBvciBkZWZpbmVkIGV2ZW50IGlzIG5ldmVyIHRyaWdnZXJlZAoJCQkJLy8gY29udGludWUgaW4gdGhlIHNlcXVlbmNlIHRvIGFsZXJ0IHBvc3NpYmxlIGZhaWx1cmVzCgkJCQl2YXIgd2FyblRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJCQlzZWxmLmV2ZW50Q2FzY2FkZSggc2VxdWVuY2UsIHRydWUgKTsKCQkJCX0sIDEwMDAwKTsKCgkJCQkvLyBiaW5kIHRoZSByZWN1cnNpdmUgY2FsbCB0byB0aGUgZXZlbnQKCQkJCSggc2VsZi5ldmVudFRhcmdldCB8fCAkLm1vYmlsZS5wYWdlQ29udGFpbmVyICkub25lKGV2ZW50LCBmdW5jdGlvbiggZXZlbnQsIGRhdGEgKSB7CgkJCQkJY2xlYXJUaW1lb3V0KCB3YXJuVGltZXIgKTsKCgkJCQkJLy8gTGV0IHRoZSBjdXJyZW50IHN0YWNrIHVud2luZCBiZWZvcmUgd2UgZmlyZSBvZmYgdGhlIG5leHQgaXRlbSBpbiB0aGUgc2VxdWVuY2UuCgkJCQkJLy8gVE9ETyBzZXRUaW1lb3V0KHNlbGYucGFnZVNlcXVlbmNlLCAwLCBzZXF1ZW5jZSk7CgkJCQkJc2V0VGltZW91dChmdW5jdGlvbigpeyBzZWxmLmV2ZW50Q2FzY2FkZShzZXF1ZW5jZSwgZmFsc2UsIGRhdGEgKTsgfSwgMCk7CgkJCQl9KTsKCQkJfQoKCQkJLy8gaW52b2tlIHRoZSBmdW5jdGlvbiB3aGljaCBzaG91bGQsIGluIHNvbWUgZmFzaGlvbiwKCQkJLy8gdHJpZ2dlciB0aGUgbmV4dCBldmVudAoJCQlmbiggdGltZWRPdXQsIGRhdGEgKTsKCQl9LAoKLy8gZGV0YWlsZWRFdmVudENhc2NhZGU6IGNhbGwgYSBmdW5jdGlvbiBhbmQgZXhwZWN0IGEgc2VyaWVzIG9mIGV2ZW50cyB0byBiZSB0cmlnZ2VyZWQgKG9yIG5vdCB0byBiZSB0cmlnZ2VyZWQpLCBhbmQgZ3VhcmQKLy8gd2l0aCBhIHRpbWVvdXQgYWdhaW5zdCBnZXR0aW5nIHN0b29kIHVwLiBSZWNvcmQgdGhlIHJlc3VsdCAodGltZWQgb3V0IC8gd2FzIHRyaWdnZXJlZCkgZm9yIGVhY2ggZXZlbnQsIGFuZCB0aGUgb3JkZXIKLy8gaW4gd2hpY2ggdGhlIGV2ZW50IGFycml2ZWQgd3J0LiBhbnkgb3RoZXIgZXZlbnRzIGV4cGVjdGVkLgovLwkJc2VxIDogWwovLwkJCWZuKHJlc3VsdCksCi8vCQkJeyBrZXk6IHsKLy8JCQkJCXNyYzogZXZlbnQgc291cmNlIChpcyBqUXVlcnkgb2JqZWN0IG9yIGZ1bmN0aW9uIHJldHVybmluZyBqUXVlcnkgb2JqZWN0KSwKLy8JCQkJCSAgICAgKE5COiBZb3Ugc2hvdWxkIHVzZSBhIGZ1bmN0aW9uIHJldHVybmluZyBhIGpRdWVyeSBvYmplY3QgYXMgdGhlIHZhbHVlIGZvciB0aGlzIHBhcmFtZXRlcgovLwkJCQkJICAgICAgaWYgdGhlcmUgaXMgYSBjaGFuY2UgdGhhdCBhdCB0aGUgdGltZSBvZiBjb25zdHJ1Y3Rpb24gb2YgdGhlIGpRdWVyeSBvYmplY3QgKHRoYXQgaXMsIHdoZW4KLy8JCQkJCSAgICAgIHRoZSBjYWxsIHRvIGRldGFpbGVkRXZlbnRDYXNjYWRlIGlzIG1hZGUpIHRoZSBlbGVtZW50cyBzZWxlY3RlZCBieSB0aGUgalF1ZXJ5IG9iamVjdCBhcmUKLy8JCQkJCSAgICAgIG5vdCB5ZXQgcHJlc2VudCBpbiB0aGUgRE9NIC0gc3VjaCBhcywgZm9yIGluc3RhbmNlLCB3aGVuIHRoZSBlbGVtZW50cyBhcmUgcGFydCBvZiBhIHBhZ2UKLy8JCQkJCSAgICAgIHRoYXQgZ2V0cyBBSkFYZWQgaW4gc3Vic2VxdWVudGx5LCBzdWNoIGFzIGR1cmluZyBhIGZ1bmN0aW9uIHRoYXQncyBwYXJ0IG9mIHRoZSBzZXF1ZW5jZSBvZgovLwkJCQkJICAgICAgZnVuY3Rpb25zIHBhc3NlZCB0byBkZXRhaWxlZEV2ZW50Q2FzY2FkZS4pCi8vCQkJCQlsZW5ndGg6IHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGZvciB0aGUgdGltZW91dCAtIG9ubHkgdXNlZCBpZiBzcmMgaXMgbm90IHNldCwKLy8JCQkJCWV2ZW50OiBldmVudCBuYW1lIChpcyBzdHJpbmcpLCBvbmx5IHVzZWQgaWYgc3JjIGlzIHNldCwKLy8JCQkJCSAgICAgICAoTkI6IEl0J3MgYSBnb29kIGlkZWEgdG8gbmFtZXNwYWNlIHlvdXIgZXZlbnRzLCBiZWNhdXNlIHRoZSBoYW5kbGVyIHdpbGwgYmUgcmVtb3ZlZAovLwkJCQkJICAgICAgICBiYXNlZCBvbiB0aGUgbmFtZSB5b3UgZ2l2ZSBoZXJlIGlmIGEgdGltZW91dCBvY2N1cnMgYmVmb3JlIHRoZSBldmVudCBmaXJlcy4pCi8vCi8vCQkJCQl1c2VyRGF0YTE6IHZhbHVlLAovLwkJCQkJLi4uCi8vCQkJCQl1c2VyRGF0YW46IHZhbHVlCi8vCQkJICB9LAovLwkJCQkuLi4KLy8JCQldCi8vCQkJLi4uCi8vCQldCi8vCQlyZXN1bHQ6IHsKLy8JCQlrZXk6IHsKLy8JCQkJaWR4OiBvcmRlciBpbiB3aGljaCB0aGUgZXZlbnQgZmlyZWQKLy8JCQkJc3JjOiBldmVudCBzb3VyY2UgKGlzIGpRdWVyeSBvYmplY3QpLAovLwkJCQlldmVudDogZXZlbnQgbmFtZSAoaXMgc3RyaW5nKQovLwkJCQl0aW1lZE91dDogdGltZWQgb3V0IChpcyBib29sZWFuKQovLwkJCQl1c2VyRGF0YTE6IHZhbHVlLAovLwkJCQkuLi4KLy8JCQkJdXNlckRhdGFuOiB2YWx1ZQovLwkJCX0KLy8JCQkuLi4KLy8JCX0KCQlkZXRhaWxlZEV2ZW50Q2FzY2FkZTogZnVuY3Rpb24oIHNlcSwgcmVzdWx0ICkgewoJCQkvLyBncmFiIG9uZSBzdGVwIGZyb20gdGhlIHNlcXVlbmNlCgkJCXZhciBmbiA9IHNlcS5zaGlmdCgpLAoJCQkJZXZlbnRzID0gc2VxLnNoaWZ0KCksCgkJCQlzZWxmID0gdGhpcywKCQkJCWRlcmVmU3JjID0gZnVuY3Rpb24oIHNyYyApIHsKCQkJCQlyZXR1cm4gKCAkLmlzRnVuY3Rpb24oIHNyYyApID8gc3JjKCkgOiBzcmMgKTsKCQkJCX07CgoJCQkvLyB3ZSdyZSBkb25lCgkJCWlmICggZm4gPT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gQXR0YWNoIGhhbmRsZXJzIHRvIHRoZSB2YXJpb3VzIG9iamVjdHMgd2hpY2ggYXJlIHRvIGJlIGNoZWNrZWQgZm9yIGNvcnJlY3QgZXZlbnQgZ2VuZXJhdGlvbgoJCQlpZiAoIGV2ZW50cyApIHsKCQkJCXZhciBuZXdSZXN1bHQgPSB7fSwKCQkJCQluRXZlbnRzRG9uZSA9IDAsCgkJCQkJbkV2ZW50cyA9IDAsCgkJCQkJcmVjb3JkUmVzdWx0ID0gZnVuY3Rpb24oIGtleSwgZXZlbnQsIHJlc3VsdCApIHsKCQkJCQkJLy8gUmVjb3JkIHRoZSByZXN1bHQKCQkJCQkJbmV3UmVzdWx0WyBrZXkgXSA9ICQuZXh0ZW5kKCB7fSwgZXZlbnQsIHJlc3VsdCApOwoJCQkJCQkvLyBJbmNyZW1lbnQgdGhlIG51bWJlciBvZiByZWNlaXZlZCByZXNwb25zZXMKCQkJCQkJbkV2ZW50c0RvbmUrKzsKCQkJCQkJaWYgKCBuRXZlbnRzRG9uZSA9PT0gbkV2ZW50cyApIHsKCQkJCQkJCS8vIGNsZWFyIHRoZSB0aW1lb3V0IGFuZCBtb3ZlIG9uIHRvIHRoZSBuZXh0IHN0ZXAgd2hlbiBhbGwgZXZlbnRzIGhhdmUgYmVlbiByZWNlaXZlZAoJCQkJCQkJaWYgKCB3YXJuVGltZXIgKSB7CgkJCQkJCQkJY2xlYXJUaW1lb3V0KCB3YXJuVGltZXIgKTsKCQkJCQkJCX0KCQkJCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCkgewoJCQkJCQkJCXNlbGYuZGV0YWlsZWRFdmVudENhc2NhZGUoIHNlcSwgbmV3UmVzdWx0ICk7CgkJCQkJCQl9LCAwKTsKCQkJCQkJfQoJCQkJCX0sCgkJCQkJLy8gc2V0IGEgZmFpbHNhZmUgdGltZXIgaW4gY2FzZSBvbmUgb2YgdGhlIGV2ZW50cyBuZXZlciBoYXBwZW5zCgkJCQkJd2FyblRpbWVyID0gc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJCXdhcm5UaW1lciA9IDA7CgkJCQkJCSQuZWFjaCggZXZlbnRzLCBmdW5jdGlvbigga2V5LCBldmVudCApIHsKCQkJCQkJCS8vIFRpbWVvdXRzIGFyZSBsZWZ0IG91dCBvZiB0aGlzLCBiZWNhdXNlIHRoZXkgd2lsbCBjb21wbGV0ZSBmb3IKCQkJCQkJCS8vIHN1cmUsIGNhbGxpbmcgcmVjb3JkUmVzdWx0IHdoZW4gdGhleSBkbwoJCQkJCQkJaWYgKCBuZXdSZXN1bHRbIGtleSBdID09PSB1bmRlZmluZWQgJiYgZXZlbnQuc3JjICkgewoJCQkJCQkJCS8vIGNsZWFuIHVwIHRoZSB1bnVzZWQgaGFuZGxlcgoJCQkJCQkJCWRlcmVmU3JjKCBldmVudC5zcmMgKS51bmJpbmQoIGV2ZW50LmV2ZW50ICk7CgkJCQkJCQkJcmVjb3JkUmVzdWx0KCBrZXksIGV2ZW50LCB7IHRpbWVkT3V0OiB0cnVlIH0gKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgkJCQkJfSwgNTAwMCk7CgoJCQkJJC5lYWNoKCBldmVudHMsIGZ1bmN0aW9uKCBrZXksIGV2ZW50ICkgewoJCQkJCS8vIENvdW50IHRoZSBldmVudHMgc28gdGhhdCB3ZSBtYXkga25vdyBob3cgbWFueSByZXNwb25zZXMgdG8gZXhwZWN0CgkJCQkJbkV2ZW50cysrOwoJCQkJCS8vIElmIGl0J3MgYW4gZXZlbnQKCQkJCQlpZiAoIGV2ZW50LnNyYyApIHsKCQkJCQkJLy8gSG9vayB1cCB0byB0aGUgZXZlbnQKCQkJCQkJZGVyZWZTcmMoIGV2ZW50LnNyYyApLm9uZSggZXZlbnQuZXZlbnQsIGZ1bmN0aW9uKCkgewoJCQkJCQkJcmVjb3JkUmVzdWx0KCBrZXksIGV2ZW50LCB7IHRpbWVkT3V0OiBmYWxzZSwgaWR4OiBuRXZlbnRzRG9uZSB9ICk7CgkJCQkJCX0pOwoJCQkJCX0KCQkJCQkvLyBJZiBpdCdzIGEgdGltZW91dAoJCQkJCWVsc2UgewoJCQkJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHsKCQkJCQkJCXJlY29yZFJlc3VsdCgga2V5LCBldmVudCwgeyB0aW1lZE91dDogdHJ1ZSwgaWR4OiAtMSB9ICk7CgkJCQkJCX0sIGV2ZW50Lmxlbmd0aCApOwoJCQkJCX0KCQkJCX0pOwoJCQl9CgoJCQkvLyBDYWxsIHRoZSBmdW5jdGlvbiB3aXRoIHRoZSByZXN1bHQgb2YgdGhlIGV2ZW50cwoJCQlmbiggcmVzdWx0ICk7CgkJfSwKCgkJZGVmZXJyZWRTZXF1ZW5jZTogZnVuY3Rpb24oZm5zKSB7CgkJCXZhciBmbiA9IGZucy5zaGlmdCgpLAoJCQkJZGVmZXJyZWQgPSAkLkRlZmVycmVkKCksCgkJCQlzZWxmID0gdGhpcywgcmVzOwoKCQkJaWYgKGZuKSB7CgkJCQlyZXMgPSBmbigpOwoJCQkJaWYgKCByZXMgJiYgJC50eXBlKCByZXMuZG9uZSApID09PSAiZnVuY3Rpb24iICkgewoJCQkJCXJlcy5kb25lKGZ1bmN0aW9uKCkgewoJCQkJCQlzZWxmLmRlZmVycmVkU2VxdWVuY2UoIGZucyApLmRvbmUoZnVuY3Rpb24oKSB7CgkJCQkJCQlkZWZlcnJlZC5yZXNvbHZlKCk7CgkJCQkJCX0pOwoJCQkJCX0pOwoJCQkJfSBlbHNlIHsKCQkJCQlzZWxmLmRlZmVycmVkU2VxdWVuY2UoIGZucyApLmRvbmUoZnVuY3Rpb24oKSB7CgkJCQkJCWRlZmVycmVkLnJlc29sdmUoKTsKCQkJCQl9KTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWRlZmVycmVkLnJlc29sdmUoKTsKCQkJfQoJCQlyZXR1cm4gZGVmZXJyZWQ7CgkJfSwKCgkJZGVjb3JhdGU6IGZ1bmN0aW9uKG9wdHMpewoJCQl2YXIgdGhpc1ZhbCA9IG9wdHMuc2VsZiB8fCB3aW5kb3c7CgoJCQljb25zb2xlLmxvZyggImRlY29yYXRlIGNhbGxlZCIgKTsKCgkJCXJldHVybiBmdW5jdGlvbigpewoJCQkJY29uc29sZS5sb2coICJkZWNvcmF0ZWQgZnVuY3Rpb24gY2FsbGVkIiApOwoJCQkJdmFyIHJldHVyblZhbDsKCQkJCW9wdHMuYmVmb3JlICYmIG9wdHMuYmVmb3JlLmFwcGx5KHRoaXNWYWwsIGFyZ3VtZW50cyk7CgkJCQlyZXR1cm5WYWwgPSBvcHRzLmZuLmFwcGx5KHRoaXNWYWwsIGFyZ3VtZW50cyk7CgkJCQlvcHRzLmFmdGVyICYmIG9wdHMuYWZ0ZXIuYXBwbHkodGhpc1ZhbCwgYXJndW1lbnRzKTsKCgkJCQlyZXR1cm4gcmV0dXJuVmFsOwoJCQl9OwoJCX0sCgoJCWFzc2VydFVybExvY2F0aW9uOiBmdW5jdGlvbiggYXJncyApIHsKCQkJdmFyIHBhcnRzID0gJC5tb2JpbGUucGF0aC5wYXJzZVVybCggbG9jYXRpb24uaHJlZiApLAoJCQkJcGF0aG5hbWVPbndhcmQgPSBsb2NhdGlvbi5ocmVmLnJlcGxhY2UoIHBhcnRzLmRvbWFpbiwgIiIgKTsKCgkJCWlmKCAkLnN1cHBvcnQucHVzaFN0YXRlICkgewoJCQkJZGVlcEVxdWFsKCBwYXRobmFtZU9ud2FyZCwgYXJncy5oYXNoT3JQdXNoIHx8IGFyZ3MucHVzaCwgYXJncy5yZXBvcnQgKTsKCQkJfSBlbHNlIHsKCQkJCWRlZXBFcXVhbCggcGFydHMuaGFzaCwgIiMiICsgKGFyZ3MuaGFzaE9yUHVzaCB8fCBhcmdzLmhhc2gpLCBhcmdzLnJlcG9ydCApOwoJCQl9CgkJfSwKCgkJLy8gQ29udmVydCBhIHBhaXIgb2YgdmVyc2lvbiBzdHJpbmdzIGludG8gYSBwYWlyIG9mIGludGVnZXJzIGFuZCBwYXNzIHRoZQoJCS8vIHJlc3VsdGluZyBpbnRlZ2VycyB0byBhIGNvbXBhcmlzb24gZnVuY3Rpb24KCQl2ZXJzaW9uVGVzdDogZnVuY3Rpb24oIGwsIHQsIHIgKSB7CgkJCXZhciBsQXIgPSBsLnNwbGl0KCAiLiIgKSwgbExlbmd0aCA9IGxBci5sZW5ndGgsCgkJCQlyQXIgPSByLnNwbGl0KCAiLiIgKSwgckxlbmd0aCA9IHJBci5sZW5ndGgsCgkJCQlsVmFsLCByVmFsLCBsUmVzID0gIiIsIHJSZXMgPSAiIiwgbWluLCBtYXgsIHN0ciwgaWR4LCBpZHgxLCBkaWZmOwoJCQlmb3IgKCBpZHggPSAwIDsgaWR4IDwgbExlbmd0aCB8fCBpZHggPCByTGVuZ3RoIDsgaWR4KysgKSB7CgkJCQlzdHIgPSB7fTsKCQkJCWxWYWwgPSAoIGlkeCA8IGxMZW5ndGggPyBwYXJzZUludCggbEFyWyBpZHggXSApIDogMCApOwoJCQkJclZhbCA9ICggaWR4IDwgckxlbmd0aCA/IHBhcnNlSW50KCByQXJbIGlkeCBdICkgOiAwICk7CgoJCQkJLy8gVGhpcyBpZ25vcmVzIHRoaW5ncyBsaWtlIDEwYSB2cy4gMTBiIGZvciBub3cKCQkJCXN0ci5sID0gU3RyaW5nKCBsVmFsICk7CgkJCQlzdHIuciA9IFN0cmluZyggclZhbCApOwoJCQkJbWluID0gKCBzdHIubC5sZW5ndGggPCBzdHIuci5sZW5ndGggKSA/ICJsIiA6ICJyIjsKCQkJCW1heCA9ICggc3RyLmwubGVuZ3RoIDwgc3RyLnIubGVuZ3RoICkgPyAiciIgOiAibCI7CgkJCQlkaWZmID0gc3RyWyBtYXggXS5sZW5ndGggLSBzdHJbIG1pbiBdLmxlbmd0aDsKCgkJCQkvLyBNYWtlIHN1cmUgb3JkZXJzIG9mIG1hZ25pdHVkZSBhbGlnbgoJCQkJZm9yICggaWR4MSA9IDA7IGlkeDEgPCBkaWZmIDsgaWR4MSsrICkgewoJCQkJCXN0clsgbWluIF0gPSAiMCIgKyBzdHJbIG1pbiBdOwoJCQkJfQoJCQkJbFJlcyA9IGxSZXMgKyBzdHIubDsKCQkJCXJSZXMgPSByUmVzICsgc3RyLnI7CgkJCX0KCgkJCS8vIHRyaW0gaW5pdGlhbCAwcyBhbmQgcmV0dXJuIHRoZSByZXN1bHQgb2YgdGhlIGNvbXBhcmlzb24KCQkJcmV0dXJuIHQoIHBhcnNlSW50KCBsUmVzLnJlcGxhY2UoIC9eMCovLCAiIiApICksIHBhcnNlSW50KCByUmVzLnJlcGxhY2UoIC9eMCovLCAiIiApICkgKTsKCQl9LAoKCQluYXZSZXNldDogZnVuY3Rpb24oIGhhc2ggKSB7CgkJCXZhciB0aW1lb3V0OwoKCQkJc3RvcCgpOwoKCQkJdGltZW91dCA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkgewoJCQkJc3RhcnQoKTsKCQkJCXRocm93ICJuYXZpZ2F0aW9uIHJlc2V0IHRpbWVkIG91dCI7CgkJCX0sIDUwMDApOwoKCQkJJChkb2N1bWVudCkub25lKCAicGFnZWNoYW5nZSIsIGZ1bmN0aW9uKCkgewoJCQkJY2xlYXJUaW1lb3V0KCB0aW1lb3V0ICk7CgkJCQlzdGFydCgpOwoJCQl9KTsKCgkJCWxvY2F0aW9uLmhhc2ggPSBsb2NhdGlvbi5oYXNoLnJlcGxhY2UoIiMiLCAiIikgPT09IGhhc2ggPyAiIiA6ICIjIiArIGhhc2g7CgkJfSwKCgkJLy8gQ2hlY2sgaWYgdHdvIGNodW5rcyBvZiBET00gYXJlIGlkZW50aWNhbAoJCWRvbUVxdWFsOiBmdW5jdGlvbiggbCwgciApIHsKCQkJdmFyIGlkeCwgaWR4QXR0ciwgbGF0dHIsIHJhdHRyLAoJCQkJLy8gRGVjaWRlIHdoZXRoZXIgYW4gYXR0cmlidXRlIHNob3VsZCBiZSBhZGRlZCB0byB0aG9zZSB0aGF0IHdpbGwgYmUgY29tcGFyZWQKCQkJCWFkZEF0dHIgPSBmdW5jdGlvbiggZWwsIGlkeCApIHsKCQkJCQkvLyBTcGVjaWFsIGNhc2UgZm9yIGVtcHR5IGNsYXNzIGF0dHJpYnV0ZQoJCQkJCWlmICggZWwuYXR0cmlidXRlc1sgaWR4IF0ubmFtZSA9PT0gImNsYXNzIiAmJiAhZWwuYXR0cmlidXRlc1sgaWR4IF0udmFsdWUgKSB7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9LAoJCQkJYXR0cnNIYXNoID0gZnVuY3Rpb24oIGVsICkgewoJCQkJCXZhciBpZHgsIGF0dHJzID0geyBsZW5ndGg6IDAsIGF0dHJzOiB7fSB9OwoKCQkJCQlmb3IgKCBpZHggPSAwIDsgaWR4IDwgZWwuYXR0cmlidXRlcy5sZW5ndGggOyBpZHgrKyApIHsKCQkJCQkJaWYgKCBhZGRBdHRyKCBlbCwgaWR4ICkgKSB7CgkJCQkJCQlhdHRycy5sZW5ndGgrKzsKCQkJCQkJCWF0dHJzLmF0dHJzWyBlbC5hdHRyaWJ1dGVzWyBpZHggXS5uYW1lIF0gPSBlbC5hdHRyaWJ1dGVzWyBpZHggXS52YWx1ZTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJcmV0dXJuIGF0dHJzOwoJCQkJfTsKCgkJCS8vIElmIHRoZSBsZW5ndGhzIG9mIHRoZSB0d28galF1ZXJ5IG9iamVjdHMgYXJlIGRpZmZlcmVudCwgdGhlIERPTQoJCQkvLyBtdXN0IGJlIGRpZmZlcmVudCBzbyBkb24ndCBib3RoZXIgY2hlY2tpbmcKCQkJaWYgKCBsLmxlbmd0aCA9PT0gci5sZW5ndGggKSB7CgkJCQkvLyBPdGhlcndpc2UsIGV4YW1pbmUgZWFjaCBlbGVtZW50CgkJCQlmb3IgKCBpZHggPSAwIDsgaWR4IDwgbC5sZW5ndGggOyBpZHgrKyApIHsKCQkJCQlsID0gbC5lcSggaWR4ICk7IHIgPSByLmVxKCBpZHggKTsKCgkJCQkJLy8gSWYgdGhlIHRhZ05hbWUgaXMgZGlmZmVyZW50IHRoZSBET00gbXVzdCBiZSBkaWZmZXJlbnQKCQkJCQlpZiAoIGxbIDAgXS50YWdOYW1lICE9PSByWyAwIF0udGFnTmFtZSApewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoKCQkJCQkvLyBPdGhlcndpc2UsIGNoZWNrIHRoZSBhdHRyaWJ1dGVzLCBidXQgZmlyc3QgY29udmVydCB0aGUgYXR0cmlidXRlcwoJCQkJCS8vIGFycmF5IHRvIGEgZGljdGlvbmFyeSwgYmVjYXVzZSB0aGUgb3JkZXIgb2YgdGhlIGF0dHJpYnV0ZXMgbWF5IGJlCgkJCQkJLy8gZGlmZmVyZW50IGJldHdlZW4gbCBhbmQgcgoJCQkJCWxhdHRyID0gYXR0cnNIYXNoKCBsWyAwIF0gKTsKCQkJCQlyYXR0ciA9IGF0dHJzSGFzaCggclsgMCBdICk7CgoJCQkJCS8vIElmIGwgYW5kIHIgaGF2ZSBhIGRpZmZlcmVudCBudW1iZXIgb2YgYXR0cmlidXRlcywgZG9uJ3QgY29udGludWUKCQkJCQlpZiAoIGxhdHRyLmxlbmd0aCAhPT0gcmF0dHIubGVuZ3RoICkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoKCQkJCQkvLyBDaGVjayBpZiBlYWNoIGF0dHJpYnV0ZSBpbiBsYXR0ciBoYXMgdGhlIHNhbWUgdmFsdWUgaW4gcmF0dHIKCQkJCQlmb3IgKCBpZHhBdHRyIGluIGxhdHRyLmF0dHJzICkgewoJCQkJCQlpZiAoIHJhdHRyLmF0dHJzWyBpZHhBdHRyIF0gIT09IGxhdHRyLmF0dHJzWyBpZHhBdHRyIF0gKSB7CgkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIElmIHNvLCBjb21wYXJlIHRoZSBjaGlsZHJlbiBvZiBsIGFuZCByIHJlY3Vyc2l2ZWx5CgkJCQkJaWYgKCAhdGhpcy5kb21FcXVhbCggJCggbFsgMCBdICkuY2hpbGRyZW4oKSwgJCggclsgMCBdICkuY2hpbGRyZW4oKSApICkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJCWwgPSBsLmVuZCgpOyByID0gci5lbmQoKTsKCQkJCX0KCQkJCWlmICggaWR4ID09PSBsLmxlbmd0aCApIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIGZhbHNlOwoJCX0sCgoJCWRlbGF5U3RhcnQ6IGZ1bmN0aW9uKCBtaWxsaXNlY29uZHMgKSB7CgkJCS8vIHN0b3AgcXVuaXQgZnJvbSBydW5uaW5nIHRoZSB0ZXN0cyB1bnRpbCBldmVyeXRoaW5nIGlzIGluIHRoZSBwYWdlCgkJCVFVbml0LmNvbmZpZy5hdXRvc3RhcnQgPSBmYWxzZTsKCgkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQlzdGFydCgpOwoJCQl9LCBtaWxsaXNlY29uZHMgfHwgMjAwMCApOwoJCX0KCX07Cn0pKGpRdWVyeSk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 06:47:29 GMT",
                    "Content-Length": "14584",
                    "Date": "Fri, 07 Nov 2014 06:47:33 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}