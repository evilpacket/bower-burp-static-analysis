{
    "url": "http://localhost:9999/ahomu/x-ahomu/bower_components/web-animations-js/test/test-runner.html",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Denial of service (DOM-based)",
    "issueType": 5246208,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based denial of service vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and passes this data to a problematic platform API in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a denial of service condition on the user's computer when the relevant API is invoked. Depending on the nature of the API, the invocation may cause the user's computer to consume excessive amounts of CPU or disk space.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based denial of service vulnerabilities is not to dynamically pass data into problematic platform APIs that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from causing a denial of service condition. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe.",
    "issueDetail": "The application may be vulnerable to DOM-based denial of service. Data is read from <b>window.location.href</b> and written to <b>the RegExp() constructor</b> via the following statements:<ul><li>var filter = window.location.href.split('?')[1];</li><li>filter = new RegExp(filter);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ahomu/x-ahomu/bower_components/web-animations-js/test/test-runner.html",
                "path": "/ahomu/x-ahomu/bower_components/web-animations-js/test/test-runner.html",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9haG9tdS94LWFob211L2Jvd2VyX2NvbXBvbmVudHMvd2ViLWFuaW1hdGlvbnMtanMvdGVzdC90ZXN0LXJ1bm5lci5odG1sIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjA2NjMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IHRleHQvaHRtbDsgY2hhcnNldD11dGYtOA0KRGF0ZTogU3VuLCAwOSBOb3YgMjAxNCAwMzoyNDozNyBHTVQNCkxhc3QtTW9kaWZpZWQ6IFN1biwgMDkgTm92IDIwMTQgMDM6MjQ6MzYgR01UDQoNCjwhLS0KQ29weXJpZ2h0IDIwMTIgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KCkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwp5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoKICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoKVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQpkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLApXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZApsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KLS0+CjwhRE9DVFlQRSBodG1sPgo8bWV0YSBjaGFyc2V0PSJVVEYtOCI+Cgo8c3R5bGU+Cgojc3RhdHVzLWJveCB7CiAgcG9zaXRpb246IGZpeGVkOwogIGJvdHRvbTogMDsKICByaWdodDogMDsKICBiYWNrZ3JvdW5kOiB3aGl0ZTsKICBib3JkZXI6IDFweCBzb2xpZCBibGFjazsKICBwYWRkaW5nLXJpZ2h0OiA1cHg7Cn0KCmgxIHsKICBkaXNwbGF5OiBpbmxpbmU7Cn0KCnRhYmxlIHsKICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwp9Cgp0ZCB7CiAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7Cn0KCmlmcmFtZSB7CiAgd2lkdGg6IDgwMHB4OwogIGhlaWdodDogNjAwcHg7Cn0KCnRib2R5IHsKICBjb2xvcjogZ3JheTsKfQoKdGQubG9nIHVsIGxpIHsKICB3aGl0ZS1zcGFjZTogcHJlOwogIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7Cn0KCi8qIEZhaWwgc3R5bGVzICovCnRib2R5LmZhaWwgewogIGNvbG9yOiByZWQ7Cn0KCmxpLmZhaWwgewogIGNvbG9yOiByZWQ7Cn0KCnRib2R5LnRpbWVvdXQgewogIGNvbG9yOiB5ZWxsb3c7Cn0KCmxpLnRpbWVvdXQgewogIGNvbG9yOiB5ZWxsb3c7Cn0KCgovKiBQYXNzIHN0eWxlcyAqLwp0Ym9keS5wYXNzIHsKICBjb2xvcjogZ3JlZW47Cn0KCmxpLnBhc3MgewogIGNvbG9yOiBncmVlbjsKfQoKdGJvZHkucGFzcy1leHBlY3RlZC1mYWlsdXJlIHsKICBjb2xvcjogIzAwYWEwMDsKfQoKbGkucGFzcy1leHBlY3RlZC1mYWlsdXJlIHsKICBjb2xvcjogIzAwYWEwMDsKfQoKdGJvZHkuc2tpcHBlZCB7CiAgY29sb3I6ICMwMGFhMDA7Cn0KCmxpLnNraXBwZWQgewogIGNvbG9yOiAjMDBhYTAwOwp9CgovKiBOby10ZXN0IHN0eWxlcyAqLwp0Ym9keS5uby10ZXN0cyB7CiAgY29sb3I6ICNmZjhhMDA7Cn0KCjwvc3R5bGU+CjxzY3JpcHQgc3JjPSJicm93c2VyZGV0ZWN0L2Jvd3Nlci5qcyI+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJ0ZXN0Y2FzZXMuanMiPjwvc2NyaXB0PgoKPGRpdiBpZD1zdGF0dXMtYm94Pgo8aDEgaWQ9c3RhdHVzPlBlbmRpbmc8L2gxPgpUZXN0czogPHNwYW4gaWQ9dGVzdHM+PC9zcGFuPgpMb2FkaW5nOiA8c3BhbiBpZD1sb2FkaW5nPjwvc3Bhbj4gKDxzcGFuIGlkPWxvYWRlZD48L3NwYW4+KQpSdW5uaW5nOiA8c3BhbiBpZD1ydW5uaW5nPjwvc3Bhbj4gKDxzcGFuIGlkPWZpbmlzaGVkPjwvc3Bhbj4pClBvc3Rpbmc6IDxzcGFuIGlkPXBvc3Rpbmc+PC9zcGFuPiAoPHNwYW4gaWQ9cG9zdGVkPjwvc3Bhbj4pCjwvZGl2PgoKPHRhYmxlIGlkPSJyZXN1bHRzIj48L3RhYmxlPgo8ZGl2IGlkPSJzcGFjZXIiPjwvZGl2PgoKPHNjcmlwdD4KJ3VzZSBzdHJpY3QnOwp3aW5kb3cub25lcnJvciA9IGZ1bmN0aW9uKG1zZywgdXJsLCBsaW5lKSB7CiAgLy8gSWdub3JlIGVycm9ycyBjYXVzZWQgYnkgd2ViZHJpdmVyCiAgaWYgKG1zZy5tYXRjaCgvd2ViZHJpdmVyLykpCiAgICByZXR1cm47CgogIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnamF2YXNjcmlwdC1lcnJvcnMnKSA9PSBudWxsKSB7CiAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9ICc8cHJlIGlkPSJqYXZhc2NyaXB0LWVycm9ycyI+SkFWQVNDUklQVCBFUlJPUlNcblxuPC9wcmU+JzsKICB9CgogIHZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2phdmFzY3JpcHQtZXJyb3JzJyk7CiAgdmFyIG1zZyA9ICdKYXZhc2NyaXB0IEVycm9yIGluICcgKyB1cmwgKyAnXG4nICsKICAgICAgJ0xpbmUgJyArIGxpbmUgKyAnOiAnICsgbXNnICsgJ1xuJzsKICBlLmlubmVySFRNTCArPSBtc2c7Cn07Cjwvc2NyaXB0PgoKPHNjcmlwdD4KJ3VzZSBzdHJpY3QnOwoKKGZ1bmN0aW9uKCkgewp3aW5kb3cuZmluaXNoZWQgPSBmYWxzZTsKd2luZG93LmdldFRlc3RSdW5uZXJQcm9ncmVzcyA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICBjb21wbGV0ZWQ6IHRlc3RTdGF0ZXNbJ1BPU1RFRCddLmxlbmd0aCwKICAgIHRvdGFsOiB0ZXN0cy5sZW5ndGgsCiAgfTsKfQoKdmFyIHJlc3VsdHMgPSBbXTsKCmlmICgvY292ZXJhZ2UvLnRlc3Qod2luZG93LmxvY2F0aW9uLmhhc2gpKSB7CiAgLy8gVHJpZ2dlciBjb3ZlcmFnZSBydW5zIGZvciBjaGlsZCB0ZXN0cy4KICB3aW5kb3cuX19jb3ZlcmFnZV9fID0ge307CiAgLy8gU2hhcmUgcmVzb3VyY2VzIGxvYWRlZCBieSBjaGlsZCB0ZXN0cyB0byBhdm9pZCBpbnN0cnVtZW50aW5nIHRoZSBzYW1lCiAgLy8gc291cmNlIGZpbGUgbXVsdGlwbGUgdGltZXMuCiAgd2luZG93Ll9fcmVzb3VyY2VzX18gPSB7b3JpZ2luYWw6IHt9fTsKfQoKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbigpIHsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3BhY2VyJykuc3R5bGUuaGVpZ2h0ID0KICAgICAgZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5JykpLmhlaWdodDsKfSk7CmZ1bmN0aW9uIHRydWVPZmZzZXRUb3AoZWxlbWVudCkgewogIHZhciB0ID0gMDsKICBpZiAoZWxlbWVudC5vZmZzZXRQYXJlbnQpIHsKICAgIGRvIHsKICAgICAgdCArPSBlbGVtZW50Lm9mZnNldFRvcDsKICAgIH0gd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50Lm9mZnNldFBhcmVudCk7CiAgICByZXR1cm4gdDsKICB9Cn0KCi8qKgogKiBHZXQgYSB2YWx1ZSBmb3IgYnVzdGluZyB0aGUgY2FjaGUuCiAqLwp2YXIgY2FjaGVCdXN0ZXIgPSAnJyArIHdpbmRvdy5EYXRlLm5vdygpOwoKLyoqCiAqIEdldCB0aGUgbW9zdCBhY2N1cmF0ZSB2ZXJzaW9uIG9mIHRpbWUgcG9zc2libGUuCiAqCiAqIEByZXR1cm4ge251bWJlcn0gVGltZSBhcyB0aGlzIHZlcnkgbW9tZW50LgogKi8KZnVuY3Rpb24gbm93KCkgewogIHRyeSB7CiAgICByZXR1cm4gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpOwogIH0gY2F0Y2ggKGUpIHsKICAgIHJldHVybiBEYXRlLm5vdygpOwogIH0KfQoKLyoqCiAqIENyZWF0ZXMgSFRNTCBlbGVtZW50cyBpbiBhIHRhYmxlIGZvciBhIHRlc3QuCiAqCiAqICstLS0tLS0tLS0tLSstLS0tLS0rLS0tLS0tLSsKICogfCBUZXN0IE5hbWUgfCBMaW5rIHwgQ291bnQgfAogKiArLS0tLS0tLS0tLS0rLS0tLS0tKy0tLS0tLS0rCiAqIHwgTG9nIG9mIHRlc3QgcnVuLiAgICAgICAgIHwKICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKwogKiB8IGlGcmFtZSBjb250YWluaW5nIHRlc3QgICB8CiAqICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsKICoKICogQHBhcmFtIHtTdHJpbmd9IHRlc3ROYW1lIE5hbWUgb2YgdGhlIHRlc3Qgc3VpdGUgYmVpbmcgcnVuLgogKiBAcGFyYW0ge1N0cmluZ30gdGVzdFVSTCBUaGUgdXJsIG9mIHRoZSB0ZXN0IHN1aXRlLgogKiBAcmV0dXJuIHtFbGVtZW50fSB0Ym9keSBjb250YWluaW5nIG5ld2x5IGNyZWF0ZWQgdGFibGUgcm93cy4KICovCmZ1bmN0aW9uIGNyZWF0ZVRlc3RSb3dzKHRlc3ROYW1lLCB0ZXN0VVJMKSB7CiAgdmFyIHRhYmxlR3JvdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0Ym9keScpOwogIHRhYmxlR3JvdXAuaWQgPSB0ZXN0TmFtZS5yZXBsYWNlKCcuJywgJy0nKTsKCiAgdmFyIGJhc2ljSW5mb1JvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgYmFzaWNJbmZvUm93LmNsYXNzTmFtZSA9ICdpbmZvLXJvdyc7CiAgdGFibGVHcm91cC5hcHBlbmRDaGlsZChiYXNpY0luZm9Sb3cpOwogIHZhciBpZnJhbWVSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOwogIHRhYmxlR3JvdXAuYXBwZW5kQ2hpbGQoaWZyYW1lUm93KTsKICB2YXIgbG9nUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICB0YWJsZUdyb3VwLmFwcGVuZENoaWxkKGxvZ1Jvdyk7CgogIC8vIE5hbWUKICB2YXIgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDEnKTsKICBoZWFkZXIudGV4dENvbnRlbnQgPSB0ZXN0TmFtZTsKCiAgdmFyIGhlYWRlckNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogIGhlYWRlckNlbGwuYXBwZW5kQ2hpbGQoaGVhZGVyKTsKICBiYXNpY0luZm9Sb3cuYXBwZW5kQ2hpbGQoaGVhZGVyQ2VsbCk7CgogIC8vIExpbmsKICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICBsaW5rLnRleHRDb250ZW50ID0gdGVzdE5hbWU7CiAgbGluay5ocmVmID0gdGVzdFVSTDsKCiAgdmFyIGxpbmtDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICBsaW5rQ2VsbC5hcHBlbmRDaGlsZChsaW5rKTsKICBiYXNpY0luZm9Sb3cuYXBwZW5kQ2hpbGQobGlua0NlbGwpOwoKICAvLyBUZXN0IGNvdW50CiAgdmFyIGNvdW50Q2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgY291bnRDZWxsLmNsYXNzTmFtZSA9ICdjb3VudCc7CiAgYmFzaWNJbmZvUm93LmFwcGVuZENoaWxkKGNvdW50Q2VsbCk7CgogIC8vIFRpbWluZyBpbmZvCiAgdmFyIHRpbWluZ0NlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogIHRpbWluZ0NlbGwuY2xhc3NOYW1lID0gJ3RpbWluZyc7CiAgYmFzaWNJbmZvUm93LmFwcGVuZENoaWxkKHRpbWluZ0NlbGwpOwoKICAvLyBpZnJhbWUgY29udGFpbmluZyBhIHByZXZpZXcgb2Ygb2JqZWN0CiAgdmFyIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwogIGlmcmFtZS5zcmMgPSB0ZXN0VVJMICsgJz8nICsgY2FjaGVCdXN0ZXIgKyAnI21lc3NhZ2UnOwoKICB2YXIgaWZyYW1lQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgaWZyYW1lQ2VsbC5jb2xTcGFuID0gJzQnOwogIGlmcmFtZUNlbGwuYXBwZW5kQ2hpbGQoaWZyYW1lKTsKICBpZnJhbWVSb3cuYXBwZW5kQ2hpbGQoaWZyYW1lQ2VsbCk7CgogIC8vIHRhYmxlIHJvdyBjb250YWluaW5nIHRoZSBjb21wbGV0ZSB0ZXN0IGxvZwogIHZhciBsb2dDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICBsb2dDZWxsLmNsYXNzTmFtZSA9ICdsb2cnOwogIGxvZ0NlbGwuY29sU3BhbiA9ICc0JzsKICBsb2dSb3cuYXBwZW5kQ2hpbGQobG9nQ2VsbCk7CgogIC8qKgogICAqIE5vcm1hbGx5IHdlIHdvdWxkIHVzZSAiZGlzcGxheTogbm9uZTsiIGJ1dCB0aGF0IGNhdXNlcyBGaXJlZm94IHRvIHJldHVybgogICAqIG51bGwgZm9yIGdldENvbXB1dGVkU3R5bGUsIHNvIGluc3RlYWQgd2UgaGF2ZSB0byB1c2UgdGhpcyB2aXNpYmlsaXR5IGhhY2suCiAgICovCiAgdGFibGVHcm91cC5zaG93SW5mbyA9IGZ1bmN0aW9uKCkgewogICAgbG9nUm93LnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7CiAgICBsb2dSb3cuc3R5bGUucG9zaXRpb24gPSAnJzsKICAgIGxvZ1Jvdy5zdHlsZS5oZWlnaHQgPSAnYXV0byc7CgogICAgaWZyYW1lUm93LnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7CiAgICBpZnJhbWVSb3cuc3R5bGUucG9zaXRpb24gPSAnJzsKICAgIGlmcmFtZVJvdy5zdHlsZS5oZWlnaHQgPSAnYXV0byc7CiAgfTsKICB0YWJsZUdyb3VwLmhpZGVJbmZvID0gZnVuY3Rpb24oKSB7CiAgICBsb2dSb3cuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwogICAgbG9nUm93LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgIGxvZ1Jvdy5zdHlsZS5oZWlnaHQgPSAnMCc7CgogICAgaWZyYW1lUm93LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsKICAgIGlmcmFtZVJvdy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICBpZnJhbWVSb3cuc3R5bGUuaGVpZ2h0ID0gJzAnOwogIH07CiAgdGFibGVHcm91cC50b2dnbGVJbmZvID0gZnVuY3Rpb24oKSB7CiAgICBpZiAobG9nUm93LnN0eWxlLnZpc2liaWxpdHkgPT0gJ2hpZGRlbicpIHsKICAgICAgdGFibGVHcm91cC5zaG93SW5mbygpOwogICAgfSBlbHNlIHsKICAgICAgdGFibGVHcm91cC5oaWRlSW5mbygpOwogICAgfQogIH07CiAgYmFzaWNJbmZvUm93Lm9uY2xpY2sgPSB0YWJsZUdyb3VwLnRvZ2dsZUluZm87CgogIHRhYmxlR3JvdXAuaGlkZUluZm8oKTsKCiAgcmV0dXJuIHRhYmxlR3JvdXA7Cn0KCi8qIEB0eXBlIHs/bnVtYmVyfSAqLyB2YXIgcnVuVGVzdHNJZCA9IG51bGw7CgovKioKICogQ2hlY2tzIGFsbCB0aGUgdGVzdHMgYXJlIGluIHRoZSBsb2FkZWQgc3RhdGUgYW5kIHRoZW4ga2lja3Mgb2YgcnVubmluZwogKiB0aGUgdGVzdHMuCiAqLwpmdW5jdGlvbiBydW5UZXN0c0lmTG9hZGVkKCkgewogIGlmICh0ZXN0U3RhdGVzWydMT0FESU5HJ10ubGVuZ3RoID4gMCkKICAgIHJldHVybjsKCiAgaWYgKHJ1blRlc3RzSWQgPT0gbnVsbCkgewogICAgcnVuVGVzdHNJZCA9IHdpbmRvdy5zZXRJbnRlcnZhbChydW5UZXN0cywgMTApOwogIH0KfQoKZnVuY3Rpb24gZ2VuZXJhdGVDb3ZlcmFnZVJlcG9ydCgpIHsKICAvLyBUT0RPOiBnZW5lcmF0ZSBhIHByZXR0eSByZXBvcnQsIHByb21wdCB0byBzYXZlIHRoZSBKU09OLCBwb3N0IGl0IHNvbWV3aGVyZQogIGZvciAodmFyIGZpbGUgaW4gd2luZG93Ll9fY292ZXJhZ2VfXykgewogICAgdmFyIHJlc3VsdHMgPSB3aW5kb3cuX19jb3ZlcmFnZV9fW2ZpbGVdOwogICAgdmFyIGhpdHMgPSAwOwogICAgdmFyIHN0YXRlbWVudHMgPSAwOwogICAgZm9yICh2YXIgc3RtdCBpbiByZXN1bHRzLnMpIHsKICAgICAgc3RhdGVtZW50cysrOwogICAgICBpZiAocmVzdWx0cy5zW3N0bXRdID4gMCkgewogICAgICAgIGhpdHMrKzsKICAgICAgfQogICAgfQogICAgdmFyIHBlcmNlbnQgPSAoMTAwICogaGl0cyAvIHN0YXRlbWVudHMpLnRvRml4ZWQoMik7CiAgICBjb25zb2xlLmxvZyhmaWxlICsgJyBzdGF0ZW1lbnQgY292ZXJhZ2UgJyArCiAgICAgICAgcGVyY2VudCArICclICgnICsgaGl0cyArICcvJyArIHN0YXRlbWVudHMgKyAnKScpOwogIH0KfQoKLyoqCiAqIFRoaXMgb2JqZWN0IHRyYWNrcyB3aGljaCBzdGF0ZSBhIHRlc3QgaXMgaW4uIEFuIGluZGl2aWR1YWwgdGVzdCBzaG91bGQgb25seQogKiBldmVyIGJlIGluIG9uZSBvZiB0aGUgbGlzdHMuIFlvdSB1c2UgdGhlIGNoYW5nZVRlc3RTdGF0ZSgpIGZ1bmN0aW9uIHRvIG1vdmUKICogZnJvbSBvbmUgc3RhdGUgdG8gYW5vdGhlci4KICoKICogVGVzdHMgc3RhcnQgb2ZmIGluIHRoZSBsb2FkaW5nIHN0YXRlIGFuZCBtb3ZlIGRvd253YXJkcyB1bnRpbCBlbmRpbmcgdXAgaW4KICogdGhlIGZpbmlzaGVkIHN0YXRlLgogKi8KdmFyIHRlc3RTdGF0ZXMgPSB7fTsKdGVzdFN0YXRlc1snTE9BRElORyddID0gW107ICAvKiBUZXN0IHdoaWNoIGlzIGJlaW5nIGxvYWRlZC4gKi8KdGVzdFN0YXRlc1snTE9BREVEJ10gPSBbXTsgICAvKiBUZXN0IHdoaWNoIGhhdmUgeWV0IHRvIHN0YXJ0LiAqLwp0ZXN0U3RhdGVzWydSVU5OSU5HJ10gPSBbXTsgIC8qIFRlc3QgdGhhdCBpcyBjdXJyZW50bHkgcnVubmluZy4gKi8KdGVzdFN0YXRlc1snRklOSVNIRUQnXSA9IFtdOyAvKiBUZXN0IHRoYXQgYXJlIGZpbmlzaGVkLiAqLwp0ZXN0U3RhdGVzWydQT1NUSU5HJ10gPSBbXTsgIC8qIFRlc3QgdGhhdCBpcyBjdXJyZW50bHkgcG9zdGluZyByZXN1bHRzIHRvIHNlcnZlci4gKi8KdGVzdFN0YXRlc1snUE9TVEVEJ10gPSBbXTsgICAvKiBUZXN0IHdoaWNoIGhhdmUgY29tcGxldGVkIGFuZCBzZW50IHRoZWlyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyB0byB0aGUgc2VydmVyLiAqLwoKLyoqCiAqIFRyYWNrIGlmIHdlIHNob3VsZCBza2lwIHRoZSBQT1NUSU5HIHN0YXRlLCBvY2N1cnMgaWYgcG9zdGluZyByZXR1cm5zIGFuIGVycm9yLgogKi8KLyogQHR5cGUge0Jvb2xlYW59ICovIHZhciBza2lwUG9zdGluZyA9IGZhbHNlOwoKLyoqCiAqIENoYW5nZXMgdGhlIHN0YXRlIG9mIHRoZSBnaXZlbiB0ZXN0IHRvIHRoZSBnaXZlbiBzdGF0ZS4KICogVGhpcyBmdW5jdGlvbiBkb2Vzbid0IGNoZWNrIHRoYXQgdGhlIHN0YXRlIHRyYW5zaXRpb24gYWN0dWFsbHkgbWFrZSBzZW5zZS4KICoKICogQHBhcmFtIHtFbGVtZW50fSB0ZXN0IERPTSBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSB0ZXN0LiBUaGUgaWQgd2lsbCBjb250YWluCiAqICAgICB0aGUgdGVzdCBuYW1lLgogKiBAcGFyYW0ge1N0YXRlc30gVGhlIG5ldyBzdGF0ZSB0byB0cmFuc2l0aW9uIHRvby4KICovCmZ1bmN0aW9uIGNoYW5nZVRlc3RTdGF0ZSh0ZXN0LCBuZXdTdGF0ZSkgewogIHZhciBpID0gbnVsbDsKCiAgaWYgKG5ld1N0YXRlID09ICdQT1NUSU5HJyAmJiBza2lwUG9zdGluZykgewogICAgbmV3U3RhdGUgPSAnUE9TVEVEJzsKICB9CgogIHZhciBvbGRTdGF0ZSA9IHRlc3Quc3RhdGU7CgogIC8vIElmIHdlIGhhdmUgYWxyZWFkeSBwb3N0ZWQsIHdlIHNob3VsZCBuZXZlciBsZWF2ZS4uLgogIGlmIChvbGRTdGF0ZSA9PSAnUE9TVEVEJykgewogICAgdGhyb3cgJ1VuZXhwZWN0ZWQgc3RhdGUgY2hhbmdlISBUcnlpbmcgdG8gbGVhdmUgUE9TVEVEIHN0YXRlIHRvICcgKyBuZXdTdGF0ZTsKICAgIHJldHVybjsKICB9CgogIGlmICh0eXBlb2Ygb2xkU3RhdGUgIT0gJ3VuZGVmaW5lZCcpIHsKICAgIHZhciBpID0gdGVzdFN0YXRlc1tvbGRTdGF0ZV0uaW5kZXhPZih0ZXN0KTsKICAgIHRlc3RTdGF0ZXNbb2xkU3RhdGVdLnNwbGljZShpLCAxKTsKICB9CgogIHRlc3Quc3RhdGUgPSBuZXdTdGF0ZTsKICB0ZXN0U3RhdGVzW3Rlc3Quc3RhdGVdLnVuc2hpZnQodGVzdCk7CgogIGZ1bmN0aW9uIHRlc3RTb3J0KGEsIGIpIHsKICAgIHJldHVybiBhLmlkLmxvY2FsZUNvbXBhcmUoYi5pZCk7CiAgfQogIHRlc3RTdGF0ZXNbdGVzdC5zdGF0ZV0uc29ydCh0ZXN0U29ydCk7CgogIHN3aXRjaChuZXdTdGF0ZSkgewogIGNhc2UgJ0xPQURJTkcnOgogICAgcnVuVGVzdHNJZkxvYWRlZCgpOwogICAgYnJlYWs7CgogIGNhc2UgJ0xPQURFRCc6CiAgICBpZiAob2xkU3RhdGUgIT0gJ0xPQURJTkcnKSB7CiAgICAgIHRocm93ICdVbmV4cGVjdGVkIHN0YXRlIGNoYW5nZSEgJyArIG9sZFN0YXRlICsgJyBjaGFuZ2luZyB0byBMT0FERUQnOwogICAgfQogICAgYnJlYWs7CgogIGNhc2UgJ1JVTk5JTkcnOgogICAgaWYgKG9sZFN0YXRlICE9ICdMT0FERUQnKSB7CiAgICAgIHRocm93ICdVbmV4cGVjdGVkIHN0YXRlIGNoYW5nZSEgJyArIG9sZFN0YXRlICsgJyBjaGFuZ2luZyB0byBSVU5OSU5HJzsKICAgIH0KCiAgICB0ZXN0LnN0YXJ0ID0gbm93KCk7CiAgICB2YXIgdGVzdFdpbmRvdyA9IHRlc3QucXVlcnlTZWxlY3RvcignaWZyYW1lJykuY29udGVudFdpbmRvdzsKICAgIHZhciBtc2cgPSB7dHlwZTogJ3N0YXJ0JywgdXJsOiB0ZXN0V2luZG93LmxvY2F0aW9uLmhyZWYgKyAnJ307CiAgICB0ZXN0V2luZG93LnBvc3RNZXNzYWdlKG1zZywgJyonKTsKICAgIGJyZWFrOwoKICBjYXNlICdGSU5JU0hFRCc6CiAgICAvLyBJZiBhIHRlc3QgZG9lc24ndCB1c2UgYW55IHRpbWluZyBzdHVmZiBpdCBjb3VsZCBjb21lIGZyb20gdGhlIExPQURJTkcgb3IKICAgIC8vIExPQURFRCBzdGF0ZSBpbnRvIHRoZSBGSU5JU0hFRCBzdGF0ZSBieXBhc3NpbmcgdGhlIFJVTk5JTkcgc3RhdGUuCiAgICBpZiAob2xkU3RhdGUgIT0gJ0xPQURJTkcnICYmIG9sZFN0YXRlICE9ICdMT0FERUQnICYmIG9sZFN0YXRlICE9ICdSVU5OSU5HJykgewogICAgICB0aHJvdyAnVW5leHBlY3RlZCBzdGF0ZSBjaGFuZ2UhICcgKyBvbGRTdGF0ZSArICcgY2hhbmdpbmcgdG8gRklOSVNIRUQnOwogICAgfQoKICAgIHZhciB0aW1pbmdJbmZvID0gdGVzdC5xdWVyeVNlbGVjdG9yKCcudGltaW5nJyk7CiAgICBpZiAodGVzdC5zdGFydCkgewogICAgICB0ZXN0LmZpbmlzaGVkID0gbm93KCk7CiAgICAgIHRpbWluZ0luZm8udGV4dENvbnRlbnQgPSAodGVzdC5maW5pc2hlZCAtIHRlc3Quc3RhcnQpLnRvRml4ZWQoMikgKyAnbXMnOwogICAgfSBlbHNlIHsKICAgICAgdGltaW5nSW5mby50ZXh0Q29udGVudCA9ICcoTG9hZCBvbmx5KSc7CiAgICB9CgogICAgdmFyIHRlc3RfaWZyYW1lID0gdGVzdC5xdWVyeVNlbGVjdG9yKCdpZnJhbWUnKTsKICAgIHByb2Nlc3NSZXN1bHRzKHRlc3QsIHRlc3RfaWZyYW1lLmNvbnRlbnRXaW5kb3cuZXhwZWN0ZWRfZmFpbHVyZXMpOwoKICAgIGJyZWFrOwoKICBjYXNlICdQT1NUSU5HJzoKICAgIGlmIChvbGRTdGF0ZSAhPSAnRklOSVNIRUQnKSB7CiAgICAgIHRocm93ICdVbmV4cGVjdGVkIHN0YXRlIGNoYW5nZSEgJyArIG9sZFN0YXRlICsgJyBjaGFuZ2luZyB0byBQT1NUSU5HJzsKICAgIH0KCiAgICBpZiAodGVzdC5jbGFzc05hbWUgPT0gJ2ZhaWwnKSB7CiAgICAgIC8vIE9wZW4gdXAgdGhlIHdpbmRvdyBvZiB0aGUgZmFpbGVkIHJlc3VsdAogICAgICB0ZXN0LnNob3dJbmZvKCk7CiAgICAgIC8vIFNjcm9sbCB0byBpdC4KICAgICAgd2luZG93LnNjcm9sbCgwLCB0cnVlT2Zmc2V0VG9wKHRlc3QpKTsKICAgIH0KCiAgICAvLyBPcGVuIHRoZSBzdGF0dXMgd2luZG93IGZvciB0YWtpbmcgb2Ygc2NyZWVuc2hvdHMKICAgIHZhciBkYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICBkYXRhLmFwcGVuZCgnZGF0YScsIEpTT04uc3RyaW5naWZ5KHRlc3QucmVzdWx0c19wcm9jZXNzZWQpKTsKCiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKGUudGFyZ2V0LnN0YXR1cyA+PSA0MDApIHsKICAgICAgICBza2lwUG9zdGluZyA9IHRydWU7CiAgICAgIH0KICAgICAgLy8gTW92ZSBmcm9tIHJ1bm5pbmcgdG8gZmluaXNoZWQgc3RhdGUKICAgICAgY2hhbmdlVGVzdFN0YXRlKHRoaXMsICdQT1NURUQnKTsKICAgIH0uYmluZCh0ZXN0KTsKICAgIHhoci5vcGVuKCdQT1NUJywgJ3Rlc3QtcmVzdWx0cy1wb3N0Lmh0bWwnLCB0cnVlKTsKICAgIHhoci5zZW5kKGRhdGEpOwoKICAgIGJyZWFrOwoKICBjYXNlICdQT1NURUQnOgogICAgLy8gSWYgd2UgYXJlIHNraXBwaW5nIFBPU1RJTkcsIHRlc3RzIGNhbiB0cmFuc2l0aW9uIHN0cmFpZ2h0IGZyb20gRklOSVNIRUQKICAgIC8vIHN0YXRlIGludG8gdGhlIFBPU1RFRCBzdGF0ZS4KICAgIGlmIChvbGRTdGF0ZSAhPSAnUE9TVElORycgJiYgKCFza2lwUG9zdGluZyB8fCBvbGRTdGF0ZSAhPSAnRklOSVNIRUQnKSkgewogICAgICB0aHJvdyAnVW5leHBlY3RlZCBzdGF0ZSBjaGFuZ2UhICcgKyBvbGRTdGF0ZSArICcgY2hhbmdpbmcgdG8gUE9TVEVEJzsKICAgIH0KICAgIGJyZWFrOwogIH0KfQoKLyoqCiAqIEVsZW1lbnRzIGZvciByZXBvcnRpbmcgdGhlIG92ZXJhbGwgc3RhdHVzLgogKi8KLyogQHR5cGUge0VsZW1lbnR9ICovIHZhciBzdGF0dXNFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3N0YXR1cycpOwoKLyogQHR5cGUge0VsZW1lbnR9ICovIHZhciB0ZXN0RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0ZXN0cycpOwoKLyogQHR5cGUge0VsZW1lbnR9ICovIHZhciBsb2FkaW5nRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsb2FkaW5nJyk7Ci8qIEB0eXBlIHtFbGVtZW50fSAqLyB2YXIgbG9hZGVkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsb2FkZWQnKTsKCi8qIEB0eXBlIHtFbGVtZW50fSAqLyB2YXIgcnVubmluZ0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcnVubmluZycpOwovKiBAdHlwZSB7RWxlbWVudH0gKi8gdmFyIGZpbmlzaGVkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNmaW5pc2hlZCcpOwoKLyogQHR5cGUge0VsZW1lbnR9ICovIHZhciBwb3N0aW5nRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwb3N0aW5nJyk7Ci8qIEB0eXBlIHtFbGVtZW50fSAqLyB2YXIgcG9zdGVkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwb3N0ZWQnKTsKCi8qKgogKiBVcGRhdGUgdGhlIHN0YXR1cyBkaWFsb2cgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgY3VycmVudCBzdGF0dXMuCiAqLwpmdW5jdGlvbiB1cGRhdGVTdGF0dXMoKSB7CiAgdGVzdEVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXN0cy5sZW5ndGg7CgogIGxvYWRpbmdFbGVtZW50LnRleHRDb250ZW50ID0gdGVzdFN0YXRlc1snTE9BRElORyddLmxlbmd0aDsKICBsb2FkZWRFbGVtZW50LnRleHRDb250ZW50ID0gdGVzdFN0YXRlc1snTE9BREVEJ10ubGVuZ3RoOwoKICBydW5uaW5nRWxlbWVudC50ZXh0Q29udGVudCA9IHRlc3RTdGF0ZXNbJ1JVTk5JTkcnXS5sZW5ndGg7CiAgZmluaXNoZWRFbGVtZW50LnRleHRDb250ZW50ID0gdGVzdFN0YXRlc1snRklOSVNIRUQnXS5sZW5ndGg7CgogIHBvc3RpbmdFbGVtZW50LnRleHRDb250ZW50ID0gdGVzdFN0YXRlc1snUE9TVElORyddLmxlbmd0aDsKICBwb3N0ZWRFbGVtZW50LnRleHRDb250ZW50ID0gdGVzdFN0YXRlc1snUE9TVEVEJ10ubGVuZ3RoOwoKICBpZiAodGVzdFN0YXRlc1snTE9BREVEJ10ubGVuZ3RoID4gMCkgewogICAgc3RhdHVzRWxlbWVudC50ZXh0Q29udGVudCA9ICdMb2FkaW5nJzsKICB9IGVsc2UgaWYgKHRlc3RTdGF0ZXNbJ1JVTk5JTkcnXS5sZW5ndGggPiAwKSB7CiAgICBzdGF0dXNFbGVtZW50LnRleHRDb250ZW50ID0gJ1J1bm5pbmcnOwogIH0gZWxzZSBpZiAodGVzdFN0YXRlc1snUE9TVElORyddLmxlbmd0aCA+IDApIHsKICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSAnUG9zdGluZyByZXN1bHRzJzsKICB9IGVsc2UgaWYgKHRlc3RTdGF0ZXNbJ1BPU1RFRCddLmxlbmd0aCA9PSB0ZXN0cy5sZW5ndGgpIHsKICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSAnRmluaXNoZWQnOwoKICAgIHdpbmRvdy5jbGVhckludGVydmFsKHVwZGF0ZVN0YXR1c0lkKTsKICAgIHdpbmRvdy5jbGVhckludGVydmFsKHJ1blRlc3RzSWQpOwogICAgd2luZG93LmZpbmlzaGVkID0gdHJ1ZTsKICAgIGlmICh3aW5kb3cuX19jb3ZlcmFnZV9fKSB7CiAgICAgIGdlbmVyYXRlQ292ZXJhZ2VSZXBvcnQoKTsKICAgIH0KICB9Cn0KCi8qIEB0eXBlIHs/bnVtYmVyfSAqLyB2YXIgdXBkYXRlU3RhdHVzSWQgPSBzZXRJbnRlcnZhbCh1cGRhdGVTdGF0dXMsIDEwMCk7CgoKdmFyIHRlc3RSdW5uZXJzID0gW107CgovKioKICogQ3JlYXRlIHRoZSBpZnJhbWVzIGZvciBlYWNoIHRlc3QuCiAqLwp3aW5kb3cub25sb2FkID0gZnVuY3Rpb24gY3JlYXRlVGVzdFJ1bm5lcnMoKSB7CiAgLy8gRmlsdGVyIHRoZSB0ZXN0cwogIHZhciBmaWx0ZXIgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnPycpWzFdOwogIGlmIChmaWx0ZXIpIHsKICAgIGZpbHRlciA9IG5ldyBSZWdFeHAoZmlsdGVyKTsKICAgIHRlc3RzID0gdGVzdHMuZmlsdGVyKGZ1bmN0aW9uKHYpIHsKICAgICAgICByZXR1cm4gZmlsdGVyLmV4ZWModik7CiAgICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gdGVzdFNvcnQoYSwgYikgewogICAgYSA9IGEucmVwbGFjZSgnLicsICctJyk7CiAgICBiID0gYi5yZXBsYWNlKCcuJywgJy0nKTsKICAgIHJldHVybiBhLmxvY2FsZUNvbXBhcmUoYik7CiAgfQogIHRlc3RzLnNvcnQodGVzdFNvcnQpOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IHRlc3RzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgdGVzdE5hbWUgPSB0ZXN0c1tpXTsKICAgIHZhciB0ZXN0VVJMID0gJ3Rlc3RjYXNlcy8nICsgdGVzdE5hbWU7CgogICAgdmFyIHRlc3QgPSBjcmVhdGVUZXN0Um93cyh0ZXN0TmFtZSwgdGVzdFVSTCk7CiAgICB0ZXN0UnVubmVycy51bnNoaWZ0KHRlc3QpOwoKICAgIGNoYW5nZVRlc3RTdGF0ZSh0ZXN0LCAnTE9BRElORycpOwoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyZXN1bHRzJykuYXBwZW5kQ2hpbGQodGVzdCk7CiAgICB0ZXN0LnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpLmNvbnRlbnRXaW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgIC8vIFlvdSBjYW4gZ2V0IG11bHRpcGxlIG9ubG9hZCBldmVudHMsIG9ubHkgZGVhbCB3aXRoIHRoZSBmaXJzdCBvbmUuCiAgICAgIGlmICh0aGlzLnN0YXRlID09ICdMT0FESU5HJykgewogICAgICAgIGNoYW5nZVRlc3RTdGF0ZSh0aGlzLCAnTE9BREVEJyk7CiAgICAgICAgcnVuVGVzdHNJZkxvYWRlZCgpOwogICAgICB9CiAgICB9LmJpbmQodGVzdCk7CiAgfQoKfTsKCi8qKgogKiBTdGFydCBhcyBtYW55IGxvYWRlZCB0ZXN0cyBhcyBwb3NzaWJsZSwgd2FpdCBmb3IgcmVzdWx0cyBhbmQgdGhlbiBwb3N0CiAqIHRoZW0uCiAqLwpmdW5jdGlvbiBydW5UZXN0cygpIHsKICAvLyBTdGFydCBhIHRlc3QgcnVubmluZwogIGlmICh0ZXN0U3RhdGVzWydMT0FERUQnXS5sZW5ndGggPiAwICYmCiAgICAgICAgdGVzdFN0YXRlc1snUlVOTklORyddLmxlbmd0aCA8IDEpIHsKICAgIGNoYW5nZVRlc3RTdGF0ZSh0ZXN0U3RhdGVzWydMT0FERUQnXVswXSwgJ1JVTk5JTkcnKTsKICB9CgogIC8vIFN0YXJ0IGEgdGVzdCBwb3N0aW5nCiAgaWYgKHRlc3RTdGF0ZXNbJ0ZJTklTSEVEJ10ubGVuZ3RoID4gMCAmJgogICAgICAgIHRlc3RTdGF0ZXNbJ1BPU1RJTkcnXS5sZW5ndGggPCAxKSB7CiAgICBjaGFuZ2VUZXN0U3RhdGUodGVzdFN0YXRlc1snRklOSVNIRUQnXVswXSwgJ1BPU1RJTkcnKTsKICB9CgogIC8vIERlYWwgd2l0aCB0ZXN0cyB3aGljaCBhcmUgdGFraW5nIHRvbyBsb25nLi4uCiAgZm9yICh2YXIgaSBpbiB0ZXN0U3RhdGVzWydSVU5OSU5HJ10pIHsKICAgIHZhciB0ZXN0ID0gdGVzdFN0YXRlc1snUlVOTklORyddW2ldOwogICAgaWYgKG5vdygpIC0gdGVzdC5zdGFydCA+IDMwMGUzKSB7CiAgICAgIC8vIE9ubHkgd2F5IHRvIHN0b3AgYWxsIHRoZSBqYXZhc2NyaXB0IGFuZCBhbnl0aGluZyBlbHNlIHJ1bm5pbmcgaW4gdGhlCiAgICAgIC8vIHRlc3QgaXMgdG8gY2xlYXIgdGhlIGRvY3VtZW50LgogICAgICB2YXIgdGVzdF9pZnJhbWUgPSB0ZXN0LnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpOwogICAgICB0ZXN0X2lmcmFtZS5zcmMgPSAiZGF0YTp0ZXh0L2h0bWw7Y2hhcnNldD11dGYtOCw8IURPQ1RZUEUgaHRtbD48aHRtbD48Ym9keT5USU1FT1VUPC9ib2R5PjwvaHRtbD4iOwoKICAgICAgdGVzdC5yZXN1bHRzX3JhdyA9IFtdOwogICAgICBjaGFuZ2VUZXN0U3RhdGUodGVzdCwgJ0ZJTklTSEVEJyk7CiAgICB9CiAgfQp9CgovKiBAdHlwZSB7T2JqZWN0LjxzdHJpbmcsIE9iamVjdD59ICovIHZhciB0ZXN0UmVzdWx0cyA9IHt9OwovKioKICogQ2FsbGJhY2sgdGhhdCBvY2N1cnMgd2hlbiB0aGUgdGVzdCBoYXMgZmluaXNoZWQgcnVubmluZy4KICovCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKAogICdtZXNzYWdlJywKICBmdW5jdGlvbihldnQpIHsKICAgIC8vIElmIHRoZSB0ZXN0IHRpbWVkIG91dCwgdGhpcyB3aWxsIGZhaWwgd2l0aCBhIGNyb3NzLW9yaWdpbiBlcnJvci4KICAgIHRyeSB7CiAgICAgIHZhciB0ZXN0bmFtZSA9IGV2dC5zb3VyY2UubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKS5wb3AoKS5yZXBsYWNlKCcuJywgJy0nKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciB0ZXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGVzdG5hbWUpOwoKICAgIC8vIFdlIG9ubHkgcmVzcG9uZCB0byBjb21wbGV0ZSBhcyBwb3N0TWVzc2FnZSBkb2Vzbid0IGd1YXJhbnRlZSBvcmRlciBzbwogICAgLy8gcmVzdWx0IG1lc3NhZ2VzIGNhbiBjb21lIGluIGFmdGVyIHRoZSBjb21wbGV0ZSBtZXNzYWdlLgogICAgaWYgKGV2dC5kYXRhWyd0eXBlJ10gIT0gJ2NvbXBsZXRlJykKICAgICAgIHJldHVybjsKCiAgICAvLyBUcnkgY2hhbmdpbmcgdG8gc3RhdGUgRklOSVNIRUQsIGJ1dCB0aGlzIG1lc3NhZ2UgbWF5IGJlIGFmdGVyIHRoZSBhCiAgICAvLyB0aW1lb3V0IG9yIHRyYW5zaXRpb24uCiAgICB0cnkgewogICAgICB0ZXN0LnJlc3VsdHNfcmF3ID0gZXZ0LmRhdGFbJ3Rlc3RzJ107CiAgICAgIGNoYW5nZVRlc3RTdGF0ZSh0ZXN0LCAnRklOSVNIRUQnKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS53YXJuKGUpOwogICAgfQogIH0sCiAgZmFsc2UpOwoKCi8qKgogKiBQcm9jZXNzZXMgdGhlIHRlc3QncyByZXN1bHRzIGFuZCBwdXQgdGhlIGluZm9ybWF0aW9uIGludG8gdGhlIHRlc3Qgb2JqZWN0LgogKgogKiBAcGFyYW0ge0VsZW1lbnR9IHRlc3QgRE9NIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRlc3QuCiAqIEBwYXJhbSB7QXJyYXkuPE9iamVjdD59IHJlc3VsdHMgTGlzdCBvZiB0ZXN0aGFybmVzcy5qcyByZXN1bHQgb2JqZWN0cy4KICovCmZ1bmN0aW9uIHByb2Nlc3NSZXN1bHRzKHRlc3QsIGV4cGVjdGVkX2ZhaWx1cmVzKSB7CiAgdmFyIGJyb3dzZXJfZXhwZWN0ZWRfZmFpbHVyZXMgPSB7fTsKICBmb3IodmFyIHRuYW1lIGluIGV4cGVjdGVkX2ZhaWx1cmVzKSB7CiAgICBmb3IodmFyIGJuYW1lIGluIGJvd3NlcikgewogICAgICB2YXIgZmFpbHMgPSBleHBlY3RlZF9mYWlsdXJlc1t0bmFtZV1bYm5hbWVdOwogICAgICBpZiAoKHR5cGVvZiBmYWlscyAhPSAidW5kZWZpbmVkIikgJiYKICAgICAgICAgICh0eXBlb2YgZmFpbHMgPT0gImJvb2xlYW4iICYmIGZhaWxzKSB8fAogICAgICAgICAgKHR5cGVvZiBmYWlscyA9PSAib2JqZWN0IiAmJiBmYWlscy5pbmRleE9mKGJvd3Nlci52ZXJzaW9uKSAhPSAtMSkpIHsKICAgICAgICBicm93c2VyX2V4cGVjdGVkX2ZhaWx1cmVzW3RuYW1lXSA9IGV4cGVjdGVkX2ZhaWx1cmVzW3RuYW1lXTsKICAgICAgfQogICAgfQogIH0KCiAgdmFyIGNvdW50cyA9IHsKICAgIHBhc3NlZDogMCwKICAgIGZhaWxlZDogMCwKICAgIHNraXBwZWQ6IDAsCiAgICBleHBlY3RlZF9mYWlsZWQ6IDAsIC8vIFRoaXMgY291bnQgaXMgaW5jbHVkZWQgaW4gdGhlIGFib3ZlCiAgICB0b3RhbDogdGVzdC5yZXN1bHRzX3Jhdy5sZW5ndGgKICB9OwogIHZhciByZXN1bHRzID0gW107CiAgdmFyIG5ld1Jlc3VsdHNEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpOwoKICBmb3IodmFyIGkgPSAwOyBpIDwgdGVzdC5yZXN1bHRzX3Jhdy5sZW5ndGg7IGkrKykgewogICAgdmFyIHJlc3VsdCA9IHRlc3QucmVzdWx0c19yYXdbaV07CiAgICByZXN1bHRzW2ldID0gcmVzdWx0OwoKICAgIC8vIEludmVydCBleHBlY3RlZF9mYWlsdXJlcwogICAgdmFyIGV4cGVjdGVkX2ZhaWx1cmUgPSBudWxsOwogICAgZm9yKHZhciB0bmFtZSBpbiBicm93c2VyX2V4cGVjdGVkX2ZhaWx1cmVzKSB7CiAgICAgIHZhciB0b21hdGNoID0gdG5hbWU7CiAgICAgIGlmICh0bmFtZS5jaGFyQXQoMCkgPT0gJy8nICYmIHRuYW1lLmNoYXJBdCh0bmFtZS5sZW5ndGgtMSkgPT0gJy8nKSB7CiAgICAgICAgIHRvbWF0Y2ggPSBuZXcgUmVnRXhwKHRuYW1lLnN1YnN0cigxLCB0bmFtZS5sZW5ndGgtMikpOwogICAgICB9CiAgICAgIGlmIChyZXN1bHRbJ25hbWUnXS5tYXRjaCh0b21hdGNoKSkgewogICAgICAgIGV4cGVjdGVkX2ZhaWx1cmUgPSBicm93c2VyX2V4cGVjdGVkX2ZhaWx1cmVzW3RuYW1lXTsKICAgICAgfQogICAgfQogICAgaWYgKGV4cGVjdGVkX2ZhaWx1cmUgIT09IG51bGwgJiYgcmVzdWx0LnN0YXR1cyAhPSByZXN1bHQuTk9UUlVOKSB7CiAgICAgIGlmIChyZXN1bHQuc3RhdHVzICE9IHJlc3VsdC5GQUlMKSB7CiAgICAgICAgcmVzdWx0Lm1lc3NhZ2UgPSAiRXhwZWN0ZWQgZmFpbHVyZSAoIiArIGV4cGVjdGVkX2ZhaWx1cmUubWVzc2FnZSArICIpLCBhY3R1YWxseSAiICsKICAgICAgICAgIHswOiAnUEFTUycsIDI6ICdUSU1FT1VUJywgMzonTk9UUlVOJ31bcmVzdWx0LnN0YXR1c10gKyAiICIgKwogICAgICAgICAgcmVzdWx0Lm1lc3NhZ2U7CiAgICAgICAgcmVzdWx0LnN0YXR1cyA9IHJlc3VsdC5GQUlMOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdC5zdGF0dXMgPSByZXN1bHQuUEFTUzsKICAgICAgICByZXN1bHQubWVzc2FnZSA9ICJFeHBlY3RlZCBmYWlsdXJlICgiICsgZXhwZWN0ZWRfZmFpbHVyZS5tZXNzYWdlICsgIik6ICIgKyByZXN1bHQubWVzc2FnZTsKICAgICAgfQogICAgICBjb3VudHMuZXhwZWN0ZWRfZmFpbGVkKys7CiAgICB9CgogICAgdmFyIG91dHB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICBvdXRwdXQuaW5uZXJIVE1MICs9IHJlc3VsdC5uYW1lICsgJzogJzsKCiAgICBzd2l0Y2ggKHJlc3VsdC5zdGF0dXMpIHsKICAgIGNhc2UgcmVzdWx0LlBBU1M6CiAgICAgIGlmICghZXhwZWN0ZWRfZmFpbHVyZSkgewogICAgICAgIG91dHB1dC5jbGFzc05hbWUgPSAncGFzcyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3V0cHV0LmNsYXNzTmFtZSA9ICdwYXNzLWV4cGVjdGVkLWZhaWx1cmUnOwogICAgICB9CiAgICAgIGNvdW50cy5wYXNzZWQrKzsKICAgICAgYnJlYWs7CgogICAgY2FzZSByZXN1bHQuVElNRU9VVDoKICAgICAgb3V0cHV0LmNsYXNzTmFtZSA9ICd0aW1lb3V0JzsKICAgICAgY291bnRzLmZhaWxlZCsrOwogICAgICBicmVhazsKCiAgICBjYXNlIHJlc3VsdC5OT1RSVU46CiAgICAgIG91dHB1dC5jbGFzc05hbWUgPSAnc2tpcHBlZCc7CiAgICAgIGNvdW50cy5za2lwcGVkKys7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgcmVzdWx0LkZBSUw6CiAgICBkZWZhdWx0OgogICAgICBvdXRwdXQuY2xhc3NOYW1lID0gJ2ZhaWxlZCc7CiAgICAgIGNvdW50cy5mYWlsZWQrKzsKICAgIH0KCiAgICBvdXRwdXQuaW5uZXJIVE1MICs9IG91dHB1dC5jbGFzc05hbWU7CiAgICBpZiAocmVzdWx0Lm1lc3NhZ2UgIT0gbnVsbCkgewogICAgICBvdXRwdXQuaW5uZXJIVE1MICs9ICcgLSAnICsgcmVzdWx0Lm1lc3NhZ2U7CiAgICB9CiAgICBuZXdSZXN1bHRzRGl2LmFwcGVuZENoaWxkKG91dHB1dCk7CiAgfQogIHRlc3QucXVlcnlTZWxlY3RvcignLmxvZycpLmFwcGVuZENoaWxkKG5ld1Jlc3VsdHNEaXYpOwoKICB2YXIgZGVidWcgPSAnJzsKICB0cnkgewogICAgZGVidWcgPSB0ZXN0LnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpLmNvbnRlbnREb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVidWcnKS5pbm5lclRleHQ7CiAgfSBjYXRjaCAoZSkgewogICAgZGVidWcgPSAnTm8gZGVidWcuLi4gOignOwogIH0KCiAgaWYgKGNvdW50cy50b3RhbCA+IDApIHsKICAgIHRlc3QucmVzdWx0c19wcm9jZXNzZWQgPSB7CiAgICAgIHR5cGU6ICdyZXN1bHQnLAogICAgICB0ZXN0TmFtZTogdGVzdC5pZCwKICAgICAgcmVzdWx0czogcmVzdWx0cywKICAgICAgZGVidWc6IGRlYnVnCiAgICB9OwoKICAgIGlmIChjb3VudHMuZmFpbGVkID09IDApIHsKICAgICAgaWYgKGNvdW50cy5leHBlY3RlZF9mYWlsZWQgPiAwKSB7CiAgICAgICAgdGVzdC5jbGFzc05hbWUgPSAncGFzcy1leHBlY3RlZC1mYWlsdXJlJzsKICAgICAgfSBlbHNlIGlmIChjb3VudHMuc2tpcHBlZCA+IDApIHsKICAgICAgICB0ZXN0LmNsYXNzTmFtZSA9ICdza2lwcGVkJzsKICAgICAgfSBlbHNlIHsKICAgICAgICB0ZXN0LmNsYXNzTmFtZSA9ICdwYXNzJzsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGVzdC5jbGFzc05hbWUgPSAnZmFpbCc7CiAgICB9CgogICAgdmFyIHN1bW1hcnkgPSBjb3VudHMudG90YWwgKyAgJyB0ZXN0czsgJzsKICAgIGlmIChjb3VudHMucGFzc2VkID4gMCkgewogICAgICBzdW1tYXJ5ICs9ICcgJyArIGNvdW50cy5wYXNzZWQgKyAnIHBhc3NlZCc7CiAgICAgIGlmIChjb3VudHMuZXhwZWN0ZWRfZmFpbGVkID4gMCkgewogICAgICAgIHN1bW1hcnkgKz0gJyAod2l0aCAnICsgY291bnRzLmV4cGVjdGVkX2ZhaWxlZCArICcgZXhwZWN0ZWQgZmFpbHVyZXMpJzsKICAgICAgfQogICAgfQogICAgaWYgKGNvdW50cy5mYWlsZWQgPiAwKSB7CiAgICAgIHN1bW1hcnkgKz0gJyAnICsgY291bnRzLmZhaWxlZCArICcgZmFpbGVkJzsKICAgIH0KICAgIGlmIChjb3VudHMuc2tpcHBlZCA+IDApIHsKICAgICAgc3VtbWFyeSArPSAnICcgKyBjb3VudHMuc2tpcHBlZCArICcgc2tpcHBlZCc7CiAgICB9CiAgICB0ZXN0LnF1ZXJ5U2VsZWN0b3IoJy5jb3VudCcpLnRleHRDb250ZW50ID0gc3VtbWFyeTsKICB9IGVsc2UgewogICAgdGVzdC5yZXN1bHRzX3Byb2Nlc3NlZCA9IHsKICAgICAgdHlwZTogJ3Jlc3VsdCcsCiAgICAgIHRlc3ROYW1lOiB0ZXN0LmlkLAogICAgICByZXN1bHRzOiBbXSwKICAgIH07CiAgICB0ZXN0LmNsYXNzTmFtZSA9ICduby10ZXN0cyc7CiAgICB0ZXN0LnF1ZXJ5U2VsZWN0b3IoJy5jb3VudCcpLnRleHRDb250ZW50ID0gJ1RJTUVPVVQnOwogIH0KfQoKfSkoKTsKCgo8L3NjcmlwdD4K",
                "body": "PCEtLQpDb3B5cmlnaHQgMjAxMiBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLgoKTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgogICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgpVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgpTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgotLT4KPCFET0NUWVBFIGh0bWw+CjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KCjxzdHlsZT4KCiNzdGF0dXMtYm94IHsKICBwb3NpdGlvbjogZml4ZWQ7CiAgYm90dG9tOiAwOwogIHJpZ2h0OiAwOwogIGJhY2tncm91bmQ6IHdoaXRlOwogIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOwogIHBhZGRpbmctcmlnaHQ6IDVweDsKfQoKaDEgewogIGRpc3BsYXk6IGlubGluZTsKfQoKdGFibGUgewogIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7Cn0KCnRkIHsKICBib3JkZXI6IDFweCBzb2xpZCBibGFjazsKfQoKaWZyYW1lIHsKICB3aWR0aDogODAwcHg7CiAgaGVpZ2h0OiA2MDBweDsKfQoKdGJvZHkgewogIGNvbG9yOiBncmF5Owp9Cgp0ZC5sb2cgdWwgbGkgewogIHdoaXRlLXNwYWNlOiBwcmU7CiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKfQoKLyogRmFpbCBzdHlsZXMgKi8KdGJvZHkuZmFpbCB7CiAgY29sb3I6IHJlZDsKfQoKbGkuZmFpbCB7CiAgY29sb3I6IHJlZDsKfQoKdGJvZHkudGltZW91dCB7CiAgY29sb3I6IHllbGxvdzsKfQoKbGkudGltZW91dCB7CiAgY29sb3I6IHllbGxvdzsKfQoKCi8qIFBhc3Mgc3R5bGVzICovCnRib2R5LnBhc3MgewogIGNvbG9yOiBncmVlbjsKfQoKbGkucGFzcyB7CiAgY29sb3I6IGdyZWVuOwp9Cgp0Ym9keS5wYXNzLWV4cGVjdGVkLWZhaWx1cmUgewogIGNvbG9yOiAjMDBhYTAwOwp9CgpsaS5wYXNzLWV4cGVjdGVkLWZhaWx1cmUgewogIGNvbG9yOiAjMDBhYTAwOwp9Cgp0Ym9keS5za2lwcGVkIHsKICBjb2xvcjogIzAwYWEwMDsKfQoKbGkuc2tpcHBlZCB7CiAgY29sb3I6ICMwMGFhMDA7Cn0KCi8qIE5vLXRlc3Qgc3R5bGVzICovCnRib2R5Lm5vLXRlc3RzIHsKICBjb2xvcjogI2ZmOGEwMDsKfQoKPC9zdHlsZT4KPHNjcmlwdCBzcmM9ImJyb3dzZXJkZXRlY3QvYm93c2VyLmpzIj48L3NjcmlwdD4KPHNjcmlwdCBzcmM9InRlc3RjYXNlcy5qcyI+PC9zY3JpcHQ+Cgo8ZGl2IGlkPXN0YXR1cy1ib3g+CjxoMSBpZD1zdGF0dXM+UGVuZGluZzwvaDE+ClRlc3RzOiA8c3BhbiBpZD10ZXN0cz48L3NwYW4+CkxvYWRpbmc6IDxzcGFuIGlkPWxvYWRpbmc+PC9zcGFuPiAoPHNwYW4gaWQ9bG9hZGVkPjwvc3Bhbj4pClJ1bm5pbmc6IDxzcGFuIGlkPXJ1bm5pbmc+PC9zcGFuPiAoPHNwYW4gaWQ9ZmluaXNoZWQ+PC9zcGFuPikKUG9zdGluZzogPHNwYW4gaWQ9cG9zdGluZz48L3NwYW4+ICg8c3BhbiBpZD1wb3N0ZWQ+PC9zcGFuPikKPC9kaXY+Cgo8dGFibGUgaWQ9InJlc3VsdHMiPjwvdGFibGU+CjxkaXYgaWQ9InNwYWNlciI+PC9kaXY+Cgo8c2NyaXB0PgondXNlIHN0cmljdCc7CndpbmRvdy5vbmVycm9yID0gZnVuY3Rpb24obXNnLCB1cmwsIGxpbmUpIHsKICAvLyBJZ25vcmUgZXJyb3JzIGNhdXNlZCBieSB3ZWJkcml2ZXIKICBpZiAobXNnLm1hdGNoKC93ZWJkcml2ZXIvKSkKICAgIHJldHVybjsKCiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqYXZhc2NyaXB0LWVycm9ycycpID09IG51bGwpIHsKICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gJzxwcmUgaWQ9ImphdmFzY3JpcHQtZXJyb3JzIj5KQVZBU0NSSVBUIEVSUk9SU1xuXG48L3ByZT4nOwogIH0KCiAgdmFyIGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnamF2YXNjcmlwdC1lcnJvcnMnKTsKICB2YXIgbXNnID0gJ0phdmFzY3JpcHQgRXJyb3IgaW4gJyArIHVybCArICdcbicgKwogICAgICAnTGluZSAnICsgbGluZSArICc6ICcgKyBtc2cgKyAnXG4nOwogIGUuaW5uZXJIVE1MICs9IG1zZzsKfTsKPC9zY3JpcHQ+Cgo8c2NyaXB0PgondXNlIHN0cmljdCc7CgooZnVuY3Rpb24oKSB7CndpbmRvdy5maW5pc2hlZCA9IGZhbHNlOwp3aW5kb3cuZ2V0VGVzdFJ1bm5lclByb2dyZXNzID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHsKICAgIGNvbXBsZXRlZDogdGVzdFN0YXRlc1snUE9TVEVEJ10ubGVuZ3RoLAogICAgdG90YWw6IHRlc3RzLmxlbmd0aCwKICB9Owp9Cgp2YXIgcmVzdWx0cyA9IFtdOwoKaWYgKC9jb3ZlcmFnZS8udGVzdCh3aW5kb3cubG9jYXRpb24uaGFzaCkpIHsKICAvLyBUcmlnZ2VyIGNvdmVyYWdlIHJ1bnMgZm9yIGNoaWxkIHRlc3RzLgogIHdpbmRvdy5fX2NvdmVyYWdlX18gPSB7fTsKICAvLyBTaGFyZSByZXNvdXJjZXMgbG9hZGVkIGJ5IGNoaWxkIHRlc3RzIHRvIGF2b2lkIGluc3RydW1lbnRpbmcgdGhlIHNhbWUKICAvLyBzb3VyY2UgZmlsZSBtdWx0aXBsZSB0aW1lcy4KICB3aW5kb3cuX19yZXNvdXJjZXNfXyA9IHtvcmlnaW5hbDoge319Owp9Cgp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkgewogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzcGFjZXInKS5zdHlsZS5oZWlnaHQgPQogICAgICBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKSkuaGVpZ2h0Owp9KTsKZnVuY3Rpb24gdHJ1ZU9mZnNldFRvcChlbGVtZW50KSB7CiAgdmFyIHQgPSAwOwogIGlmIChlbGVtZW50Lm9mZnNldFBhcmVudCkgewogICAgZG8gewogICAgICB0ICs9IGVsZW1lbnQub2Zmc2V0VG9wOwogICAgfSB3aGlsZSAoZWxlbWVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50KTsKICAgIHJldHVybiB0OwogIH0KfQoKLyoqCiAqIEdldCBhIHZhbHVlIGZvciBidXN0aW5nIHRoZSBjYWNoZS4KICovCnZhciBjYWNoZUJ1c3RlciA9ICcnICsgd2luZG93LkRhdGUubm93KCk7CgovKioKICogR2V0IHRoZSBtb3N0IGFjY3VyYXRlIHZlcnNpb24gb2YgdGltZSBwb3NzaWJsZS4KICoKICogQHJldHVybiB7bnVtYmVyfSBUaW1lIGFzIHRoaXMgdmVyeSBtb21lbnQuCiAqLwpmdW5jdGlvbiBub3coKSB7CiAgdHJ5IHsKICAgIHJldHVybiB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCk7CiAgfSBjYXRjaCAoZSkgewogICAgcmV0dXJuIERhdGUubm93KCk7CiAgfQp9CgovKioKICogQ3JlYXRlcyBIVE1MIGVsZW1lbnRzIGluIGEgdGFibGUgZm9yIGEgdGVzdC4KICoKICogKy0tLS0tLS0tLS0tKy0tLS0tLSstLS0tLS0tKwogKiB8IFRlc3QgTmFtZSB8IExpbmsgfCBDb3VudCB8CiAqICstLS0tLS0tLS0tLSstLS0tLS0rLS0tLS0tLSsKICogfCBMb2cgb2YgdGVzdCBydW4uICAgICAgICAgfAogKiArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCiAqIHwgaUZyYW1lIGNvbnRhaW5pbmcgdGVzdCAgIHwKICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKwogKgogKiBAcGFyYW0ge1N0cmluZ30gdGVzdE5hbWUgTmFtZSBvZiB0aGUgdGVzdCBzdWl0ZSBiZWluZyBydW4uCiAqIEBwYXJhbSB7U3RyaW5nfSB0ZXN0VVJMIFRoZSB1cmwgb2YgdGhlIHRlc3Qgc3VpdGUuCiAqIEByZXR1cm4ge0VsZW1lbnR9IHRib2R5IGNvbnRhaW5pbmcgbmV3bHkgY3JlYXRlZCB0YWJsZSByb3dzLgogKi8KZnVuY3Rpb24gY3JlYXRlVGVzdFJvd3ModGVzdE5hbWUsIHRlc3RVUkwpIHsKICB2YXIgdGFibGVHcm91cCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7CiAgdGFibGVHcm91cC5pZCA9IHRlc3ROYW1lLnJlcGxhY2UoJy4nLCAnLScpOwoKICB2YXIgYmFzaWNJbmZvUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICBiYXNpY0luZm9Sb3cuY2xhc3NOYW1lID0gJ2luZm8tcm93JzsKICB0YWJsZUdyb3VwLmFwcGVuZENoaWxkKGJhc2ljSW5mb1Jvdyk7CiAgdmFyIGlmcmFtZVJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgdGFibGVHcm91cC5hcHBlbmRDaGlsZChpZnJhbWVSb3cpOwogIHZhciBsb2dSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOwogIHRhYmxlR3JvdXAuYXBwZW5kQ2hpbGQobG9nUm93KTsKCiAgLy8gTmFtZQogIHZhciBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpOwogIGhlYWRlci50ZXh0Q29udGVudCA9IHRlc3ROYW1lOwoKICB2YXIgaGVhZGVyQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgaGVhZGVyQ2VsbC5hcHBlbmRDaGlsZChoZWFkZXIpOwogIGJhc2ljSW5mb1Jvdy5hcHBlbmRDaGlsZChoZWFkZXJDZWxsKTsKCiAgLy8gTGluawogIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogIGxpbmsudGV4dENvbnRlbnQgPSB0ZXN0TmFtZTsKICBsaW5rLmhyZWYgPSB0ZXN0VVJMOwoKICB2YXIgbGlua0NlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogIGxpbmtDZWxsLmFwcGVuZENoaWxkKGxpbmspOwogIGJhc2ljSW5mb1Jvdy5hcHBlbmRDaGlsZChsaW5rQ2VsbCk7CgogIC8vIFRlc3QgY291bnQKICB2YXIgY291bnRDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICBjb3VudENlbGwuY2xhc3NOYW1lID0gJ2NvdW50JzsKICBiYXNpY0luZm9Sb3cuYXBwZW5kQ2hpbGQoY291bnRDZWxsKTsKCiAgLy8gVGltaW5nIGluZm8KICB2YXIgdGltaW5nQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgdGltaW5nQ2VsbC5jbGFzc05hbWUgPSAndGltaW5nJzsKICBiYXNpY0luZm9Sb3cuYXBwZW5kQ2hpbGQodGltaW5nQ2VsbCk7CgogIC8vIGlmcmFtZSBjb250YWluaW5nIGEgcHJldmlldyBvZiBvYmplY3QKICB2YXIgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7CiAgaWZyYW1lLnNyYyA9IHRlc3RVUkwgKyAnPycgKyBjYWNoZUJ1c3RlciArICcjbWVzc2FnZSc7CgogIHZhciBpZnJhbWVDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKICBpZnJhbWVDZWxsLmNvbFNwYW4gPSAnNCc7CiAgaWZyYW1lQ2VsbC5hcHBlbmRDaGlsZChpZnJhbWUpOwogIGlmcmFtZVJvdy5hcHBlbmRDaGlsZChpZnJhbWVDZWxsKTsKCiAgLy8gdGFibGUgcm93IGNvbnRhaW5pbmcgdGhlIGNvbXBsZXRlIHRlc3QgbG9nCiAgdmFyIGxvZ0NlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogIGxvZ0NlbGwuY2xhc3NOYW1lID0gJ2xvZyc7CiAgbG9nQ2VsbC5jb2xTcGFuID0gJzQnOwogIGxvZ1Jvdy5hcHBlbmRDaGlsZChsb2dDZWxsKTsKCiAgLyoqCiAgICogTm9ybWFsbHkgd2Ugd291bGQgdXNlICJkaXNwbGF5OiBub25lOyIgYnV0IHRoYXQgY2F1c2VzIEZpcmVmb3ggdG8gcmV0dXJuCiAgICogbnVsbCBmb3IgZ2V0Q29tcHV0ZWRTdHlsZSwgc28gaW5zdGVhZCB3ZSBoYXZlIHRvIHVzZSB0aGlzIHZpc2liaWxpdHkgaGFjay4KICAgKi8KICB0YWJsZUdyb3VwLnNob3dJbmZvID0gZnVuY3Rpb24oKSB7CiAgICBsb2dSb3cuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKICAgIGxvZ1Jvdy5zdHlsZS5wb3NpdGlvbiA9ICcnOwogICAgbG9nUm93LnN0eWxlLmhlaWdodCA9ICdhdXRvJzsKCiAgICBpZnJhbWVSb3cuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKICAgIGlmcmFtZVJvdy5zdHlsZS5wb3NpdGlvbiA9ICcnOwogICAgaWZyYW1lUm93LnN0eWxlLmhlaWdodCA9ICdhdXRvJzsKICB9OwogIHRhYmxlR3JvdXAuaGlkZUluZm8gPSBmdW5jdGlvbigpIHsKICAgIGxvZ1Jvdy5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7CiAgICBsb2dSb3cuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgbG9nUm93LnN0eWxlLmhlaWdodCA9ICcwJzsKCiAgICBpZnJhbWVSb3cuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwogICAgaWZyYW1lUm93LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgIGlmcmFtZVJvdy5zdHlsZS5oZWlnaHQgPSAnMCc7CiAgfTsKICB0YWJsZUdyb3VwLnRvZ2dsZUluZm8gPSBmdW5jdGlvbigpIHsKICAgIGlmIChsb2dSb3cuc3R5bGUudmlzaWJpbGl0eSA9PSAnaGlkZGVuJykgewogICAgICB0YWJsZUdyb3VwLnNob3dJbmZvKCk7CiAgICB9IGVsc2UgewogICAgICB0YWJsZUdyb3VwLmhpZGVJbmZvKCk7CiAgICB9CiAgfTsKICBiYXNpY0luZm9Sb3cub25jbGljayA9IHRhYmxlR3JvdXAudG9nZ2xlSW5mbzsKCiAgdGFibGVHcm91cC5oaWRlSW5mbygpOwoKICByZXR1cm4gdGFibGVHcm91cDsKfQoKLyogQHR5cGUgez9udW1iZXJ9ICovIHZhciBydW5UZXN0c0lkID0gbnVsbDsKCi8qKgogKiBDaGVja3MgYWxsIHRoZSB0ZXN0cyBhcmUgaW4gdGhlIGxvYWRlZCBzdGF0ZSBhbmQgdGhlbiBraWNrcyBvZiBydW5uaW5nCiAqIHRoZSB0ZXN0cy4KICovCmZ1bmN0aW9uIHJ1blRlc3RzSWZMb2FkZWQoKSB7CiAgaWYgKHRlc3RTdGF0ZXNbJ0xPQURJTkcnXS5sZW5ndGggPiAwKQogICAgcmV0dXJuOwoKICBpZiAocnVuVGVzdHNJZCA9PSBudWxsKSB7CiAgICBydW5UZXN0c0lkID0gd2luZG93LnNldEludGVydmFsKHJ1blRlc3RzLCAxMCk7CiAgfQp9CgpmdW5jdGlvbiBnZW5lcmF0ZUNvdmVyYWdlUmVwb3J0KCkgewogIC8vIFRPRE86IGdlbmVyYXRlIGEgcHJldHR5IHJlcG9ydCwgcHJvbXB0IHRvIHNhdmUgdGhlIEpTT04sIHBvc3QgaXQgc29tZXdoZXJlCiAgZm9yICh2YXIgZmlsZSBpbiB3aW5kb3cuX19jb3ZlcmFnZV9fKSB7CiAgICB2YXIgcmVzdWx0cyA9IHdpbmRvdy5fX2NvdmVyYWdlX19bZmlsZV07CiAgICB2YXIgaGl0cyA9IDA7CiAgICB2YXIgc3RhdGVtZW50cyA9IDA7CiAgICBmb3IgKHZhciBzdG10IGluIHJlc3VsdHMucykgewogICAgICBzdGF0ZW1lbnRzKys7CiAgICAgIGlmIChyZXN1bHRzLnNbc3RtdF0gPiAwKSB7CiAgICAgICAgaGl0cysrOwogICAgICB9CiAgICB9CiAgICB2YXIgcGVyY2VudCA9ICgxMDAgKiBoaXRzIC8gc3RhdGVtZW50cykudG9GaXhlZCgyKTsKICAgIGNvbnNvbGUubG9nKGZpbGUgKyAnIHN0YXRlbWVudCBjb3ZlcmFnZSAnICsKICAgICAgICBwZXJjZW50ICsgJyUgKCcgKyBoaXRzICsgJy8nICsgc3RhdGVtZW50cyArICcpJyk7CiAgfQp9CgovKioKICogVGhpcyBvYmplY3QgdHJhY2tzIHdoaWNoIHN0YXRlIGEgdGVzdCBpcyBpbi4gQW4gaW5kaXZpZHVhbCB0ZXN0IHNob3VsZCBvbmx5CiAqIGV2ZXIgYmUgaW4gb25lIG9mIHRoZSBsaXN0cy4gWW91IHVzZSB0aGUgY2hhbmdlVGVzdFN0YXRlKCkgZnVuY3Rpb24gdG8gbW92ZQogKiBmcm9tIG9uZSBzdGF0ZSB0byBhbm90aGVyLgogKgogKiBUZXN0cyBzdGFydCBvZmYgaW4gdGhlIGxvYWRpbmcgc3RhdGUgYW5kIG1vdmUgZG93bndhcmRzIHVudGlsIGVuZGluZyB1cCBpbgogKiB0aGUgZmluaXNoZWQgc3RhdGUuCiAqLwp2YXIgdGVzdFN0YXRlcyA9IHt9Owp0ZXN0U3RhdGVzWydMT0FESU5HJ10gPSBbXTsgIC8qIFRlc3Qgd2hpY2ggaXMgYmVpbmcgbG9hZGVkLiAqLwp0ZXN0U3RhdGVzWydMT0FERUQnXSA9IFtdOyAgIC8qIFRlc3Qgd2hpY2ggaGF2ZSB5ZXQgdG8gc3RhcnQuICovCnRlc3RTdGF0ZXNbJ1JVTk5JTkcnXSA9IFtdOyAgLyogVGVzdCB0aGF0IGlzIGN1cnJlbnRseSBydW5uaW5nLiAqLwp0ZXN0U3RhdGVzWydGSU5JU0hFRCddID0gW107IC8qIFRlc3QgdGhhdCBhcmUgZmluaXNoZWQuICovCnRlc3RTdGF0ZXNbJ1BPU1RJTkcnXSA9IFtdOyAgLyogVGVzdCB0aGF0IGlzIGN1cnJlbnRseSBwb3N0aW5nIHJlc3VsdHMgdG8gc2VydmVyLiAqLwp0ZXN0U3RhdGVzWydQT1NURUQnXSA9IFtdOyAgIC8qIFRlc3Qgd2hpY2ggaGF2ZSBjb21wbGV0ZWQgYW5kIHNlbnQgdGhlaXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzIHRvIHRoZSBzZXJ2ZXIuICovCgovKioKICogVHJhY2sgaWYgd2Ugc2hvdWxkIHNraXAgdGhlIFBPU1RJTkcgc3RhdGUsIG9jY3VycyBpZiBwb3N0aW5nIHJldHVybnMgYW4gZXJyb3IuCiAqLwovKiBAdHlwZSB7Qm9vbGVhbn0gKi8gdmFyIHNraXBQb3N0aW5nID0gZmFsc2U7CgovKioKICogQ2hhbmdlcyB0aGUgc3RhdGUgb2YgdGhlIGdpdmVuIHRlc3QgdG8gdGhlIGdpdmVuIHN0YXRlLgogKiBUaGlzIGZ1bmN0aW9uIGRvZXNuJ3QgY2hlY2sgdGhhdCB0aGUgc3RhdGUgdHJhbnNpdGlvbiBhY3R1YWxseSBtYWtlIHNlbnNlLgogKgogKiBAcGFyYW0ge0VsZW1lbnR9IHRlc3QgRE9NIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHRlc3QuIFRoZSBpZCB3aWxsIGNvbnRhaW4KICogICAgIHRoZSB0ZXN0IG5hbWUuCiAqIEBwYXJhbSB7U3RhdGVzfSBUaGUgbmV3IHN0YXRlIHRvIHRyYW5zaXRpb24gdG9vLgogKi8KZnVuY3Rpb24gY2hhbmdlVGVzdFN0YXRlKHRlc3QsIG5ld1N0YXRlKSB7CiAgdmFyIGkgPSBudWxsOwoKICBpZiAobmV3U3RhdGUgPT0gJ1BPU1RJTkcnICYmIHNraXBQb3N0aW5nKSB7CiAgICBuZXdTdGF0ZSA9ICdQT1NURUQnOwogIH0KCiAgdmFyIG9sZFN0YXRlID0gdGVzdC5zdGF0ZTsKCiAgLy8gSWYgd2UgaGF2ZSBhbHJlYWR5IHBvc3RlZCwgd2Ugc2hvdWxkIG5ldmVyIGxlYXZlLi4uCiAgaWYgKG9sZFN0YXRlID09ICdQT1NURUQnKSB7CiAgICB0aHJvdyAnVW5leHBlY3RlZCBzdGF0ZSBjaGFuZ2UhIFRyeWluZyB0byBsZWF2ZSBQT1NURUQgc3RhdGUgdG8gJyArIG5ld1N0YXRlOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKHR5cGVvZiBvbGRTdGF0ZSAhPSAndW5kZWZpbmVkJykgewogICAgdmFyIGkgPSB0ZXN0U3RhdGVzW29sZFN0YXRlXS5pbmRleE9mKHRlc3QpOwogICAgdGVzdFN0YXRlc1tvbGRTdGF0ZV0uc3BsaWNlKGksIDEpOwogIH0KCiAgdGVzdC5zdGF0ZSA9IG5ld1N0YXRlOwogIHRlc3RTdGF0ZXNbdGVzdC5zdGF0ZV0udW5zaGlmdCh0ZXN0KTsKCiAgZnVuY3Rpb24gdGVzdFNvcnQoYSwgYikgewogICAgcmV0dXJuIGEuaWQubG9jYWxlQ29tcGFyZShiLmlkKTsKICB9CiAgdGVzdFN0YXRlc1t0ZXN0LnN0YXRlXS5zb3J0KHRlc3RTb3J0KTsKCiAgc3dpdGNoKG5ld1N0YXRlKSB7CiAgY2FzZSAnTE9BRElORyc6CiAgICBydW5UZXN0c0lmTG9hZGVkKCk7CiAgICBicmVhazsKCiAgY2FzZSAnTE9BREVEJzoKICAgIGlmIChvbGRTdGF0ZSAhPSAnTE9BRElORycpIHsKICAgICAgdGhyb3cgJ1VuZXhwZWN0ZWQgc3RhdGUgY2hhbmdlISAnICsgb2xkU3RhdGUgKyAnIGNoYW5naW5nIHRvIExPQURFRCc7CiAgICB9CiAgICBicmVhazsKCiAgY2FzZSAnUlVOTklORyc6CiAgICBpZiAob2xkU3RhdGUgIT0gJ0xPQURFRCcpIHsKICAgICAgdGhyb3cgJ1VuZXhwZWN0ZWQgc3RhdGUgY2hhbmdlISAnICsgb2xkU3RhdGUgKyAnIGNoYW5naW5nIHRvIFJVTk5JTkcnOwogICAgfQoKICAgIHRlc3Quc3RhcnQgPSBub3coKTsKICAgIHZhciB0ZXN0V2luZG93ID0gdGVzdC5xdWVyeVNlbGVjdG9yKCdpZnJhbWUnKS5jb250ZW50V2luZG93OwogICAgdmFyIG1zZyA9IHt0eXBlOiAnc3RhcnQnLCB1cmw6IHRlc3RXaW5kb3cubG9jYXRpb24uaHJlZiArICcnfTsKICAgIHRlc3RXaW5kb3cucG9zdE1lc3NhZ2UobXNnLCAnKicpOwogICAgYnJlYWs7CgogIGNhc2UgJ0ZJTklTSEVEJzoKICAgIC8vIElmIGEgdGVzdCBkb2Vzbid0IHVzZSBhbnkgdGltaW5nIHN0dWZmIGl0IGNvdWxkIGNvbWUgZnJvbSB0aGUgTE9BRElORyBvcgogICAgLy8gTE9BREVEIHN0YXRlIGludG8gdGhlIEZJTklTSEVEIHN0YXRlIGJ5cGFzc2luZyB0aGUgUlVOTklORyBzdGF0ZS4KICAgIGlmIChvbGRTdGF0ZSAhPSAnTE9BRElORycgJiYgb2xkU3RhdGUgIT0gJ0xPQURFRCcgJiYgb2xkU3RhdGUgIT0gJ1JVTk5JTkcnKSB7CiAgICAgIHRocm93ICdVbmV4cGVjdGVkIHN0YXRlIGNoYW5nZSEgJyArIG9sZFN0YXRlICsgJyBjaGFuZ2luZyB0byBGSU5JU0hFRCc7CiAgICB9CgogICAgdmFyIHRpbWluZ0luZm8gPSB0ZXN0LnF1ZXJ5U2VsZWN0b3IoJy50aW1pbmcnKTsKICAgIGlmICh0ZXN0LnN0YXJ0KSB7CiAgICAgIHRlc3QuZmluaXNoZWQgPSBub3coKTsKICAgICAgdGltaW5nSW5mby50ZXh0Q29udGVudCA9ICh0ZXN0LmZpbmlzaGVkIC0gdGVzdC5zdGFydCkudG9GaXhlZCgyKSArICdtcyc7CiAgICB9IGVsc2UgewogICAgICB0aW1pbmdJbmZvLnRleHRDb250ZW50ID0gJyhMb2FkIG9ubHkpJzsKICAgIH0KCiAgICB2YXIgdGVzdF9pZnJhbWUgPSB0ZXN0LnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpOwogICAgcHJvY2Vzc1Jlc3VsdHModGVzdCwgdGVzdF9pZnJhbWUuY29udGVudFdpbmRvdy5leHBlY3RlZF9mYWlsdXJlcyk7CgogICAgYnJlYWs7CgogIGNhc2UgJ1BPU1RJTkcnOgogICAgaWYgKG9sZFN0YXRlICE9ICdGSU5JU0hFRCcpIHsKICAgICAgdGhyb3cgJ1VuZXhwZWN0ZWQgc3RhdGUgY2hhbmdlISAnICsgb2xkU3RhdGUgKyAnIGNoYW5naW5nIHRvIFBPU1RJTkcnOwogICAgfQoKICAgIGlmICh0ZXN0LmNsYXNzTmFtZSA9PSAnZmFpbCcpIHsKICAgICAgLy8gT3BlbiB1cCB0aGUgd2luZG93IG9mIHRoZSBmYWlsZWQgcmVzdWx0CiAgICAgIHRlc3Quc2hvd0luZm8oKTsKICAgICAgLy8gU2Nyb2xsIHRvIGl0LgogICAgICB3aW5kb3cuc2Nyb2xsKDAsIHRydWVPZmZzZXRUb3AodGVzdCkpOwogICAgfQoKICAgIC8vIE9wZW4gdGhlIHN0YXR1cyB3aW5kb3cgZm9yIHRha2luZyBvZiBzY3JlZW5zaG90cwogICAgdmFyIGRhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgIGRhdGEuYXBwZW5kKCdkYXRhJywgSlNPTi5zdHJpbmdpZnkodGVzdC5yZXN1bHRzX3Byb2Nlc3NlZCkpOwoKICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICBpZiAoZS50YXJnZXQuc3RhdHVzID49IDQwMCkgewogICAgICAgIHNraXBQb3N0aW5nID0gdHJ1ZTsKICAgICAgfQogICAgICAvLyBNb3ZlIGZyb20gcnVubmluZyB0byBmaW5pc2hlZCBzdGF0ZQogICAgICBjaGFuZ2VUZXN0U3RhdGUodGhpcywgJ1BPU1RFRCcpOwogICAgfS5iaW5kKHRlc3QpOwogICAgeGhyLm9wZW4oJ1BPU1QnLCAndGVzdC1yZXN1bHRzLXBvc3QuaHRtbCcsIHRydWUpOwogICAgeGhyLnNlbmQoZGF0YSk7CgogICAgYnJlYWs7CgogIGNhc2UgJ1BPU1RFRCc6CiAgICAvLyBJZiB3ZSBhcmUgc2tpcHBpbmcgUE9TVElORywgdGVzdHMgY2FuIHRyYW5zaXRpb24gc3RyYWlnaHQgZnJvbSBGSU5JU0hFRAogICAgLy8gc3RhdGUgaW50byB0aGUgUE9TVEVEIHN0YXRlLgogICAgaWYgKG9sZFN0YXRlICE9ICdQT1NUSU5HJyAmJiAoIXNraXBQb3N0aW5nIHx8IG9sZFN0YXRlICE9ICdGSU5JU0hFRCcpKSB7CiAgICAgIHRocm93ICdVbmV4cGVjdGVkIHN0YXRlIGNoYW5nZSEgJyArIG9sZFN0YXRlICsgJyBjaGFuZ2luZyB0byBQT1NURUQnOwogICAgfQogICAgYnJlYWs7CiAgfQp9CgovKioKICogRWxlbWVudHMgZm9yIHJlcG9ydGluZyB0aGUgb3ZlcmFsbCBzdGF0dXMuCiAqLwovKiBAdHlwZSB7RWxlbWVudH0gKi8gdmFyIHN0YXR1c0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3RhdHVzJyk7CgovKiBAdHlwZSB7RWxlbWVudH0gKi8gdmFyIHRlc3RFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Rlc3RzJyk7CgovKiBAdHlwZSB7RWxlbWVudH0gKi8gdmFyIGxvYWRpbmdFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2xvYWRpbmcnKTsKLyogQHR5cGUge0VsZW1lbnR9ICovIHZhciBsb2FkZWRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2xvYWRlZCcpOwoKLyogQHR5cGUge0VsZW1lbnR9ICovIHZhciBydW5uaW5nRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNydW5uaW5nJyk7Ci8qIEB0eXBlIHtFbGVtZW50fSAqLyB2YXIgZmluaXNoZWRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2ZpbmlzaGVkJyk7CgovKiBAdHlwZSB7RWxlbWVudH0gKi8gdmFyIHBvc3RpbmdFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Bvc3RpbmcnKTsKLyogQHR5cGUge0VsZW1lbnR9ICovIHZhciBwb3N0ZWRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Bvc3RlZCcpOwoKLyoqCiAqIFVwZGF0ZSB0aGUgc3RhdHVzIGRpYWxvZyB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50IHN0YXR1cy4KICovCmZ1bmN0aW9uIHVwZGF0ZVN0YXR1cygpIHsKICB0ZXN0RWxlbWVudC50ZXh0Q29udGVudCA9IHRlc3RzLmxlbmd0aDsKCiAgbG9hZGluZ0VsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXN0U3RhdGVzWydMT0FESU5HJ10ubGVuZ3RoOwogIGxvYWRlZEVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXN0U3RhdGVzWydMT0FERUQnXS5sZW5ndGg7CgogIHJ1bm5pbmdFbGVtZW50LnRleHRDb250ZW50ID0gdGVzdFN0YXRlc1snUlVOTklORyddLmxlbmd0aDsKICBmaW5pc2hlZEVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXN0U3RhdGVzWydGSU5JU0hFRCddLmxlbmd0aDsKCiAgcG9zdGluZ0VsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXN0U3RhdGVzWydQT1NUSU5HJ10ubGVuZ3RoOwogIHBvc3RlZEVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXN0U3RhdGVzWydQT1NURUQnXS5sZW5ndGg7CgogIGlmICh0ZXN0U3RhdGVzWydMT0FERUQnXS5sZW5ndGggPiAwKSB7CiAgICBzdGF0dXNFbGVtZW50LnRleHRDb250ZW50ID0gJ0xvYWRpbmcnOwogIH0gZWxzZSBpZiAodGVzdFN0YXRlc1snUlVOTklORyddLmxlbmd0aCA+IDApIHsKICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSAnUnVubmluZyc7CiAgfSBlbHNlIGlmICh0ZXN0U3RhdGVzWydQT1NUSU5HJ10ubGVuZ3RoID4gMCkgewogICAgc3RhdHVzRWxlbWVudC50ZXh0Q29udGVudCA9ICdQb3N0aW5nIHJlc3VsdHMnOwogIH0gZWxzZSBpZiAodGVzdFN0YXRlc1snUE9TVEVEJ10ubGVuZ3RoID09IHRlc3RzLmxlbmd0aCkgewogICAgc3RhdHVzRWxlbWVudC50ZXh0Q29udGVudCA9ICdGaW5pc2hlZCc7CgogICAgd2luZG93LmNsZWFySW50ZXJ2YWwodXBkYXRlU3RhdHVzSWQpOwogICAgd2luZG93LmNsZWFySW50ZXJ2YWwocnVuVGVzdHNJZCk7CiAgICB3aW5kb3cuZmluaXNoZWQgPSB0cnVlOwogICAgaWYgKHdpbmRvdy5fX2NvdmVyYWdlX18pIHsKICAgICAgZ2VuZXJhdGVDb3ZlcmFnZVJlcG9ydCgpOwogICAgfQogIH0KfQoKLyogQHR5cGUgez9udW1iZXJ9ICovIHZhciB1cGRhdGVTdGF0dXNJZCA9IHNldEludGVydmFsKHVwZGF0ZVN0YXR1cywgMTAwKTsKCgp2YXIgdGVzdFJ1bm5lcnMgPSBbXTsKCi8qKgogKiBDcmVhdGUgdGhlIGlmcmFtZXMgZm9yIGVhY2ggdGVzdC4KICovCndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiBjcmVhdGVUZXN0UnVubmVycygpIHsKICAvLyBGaWx0ZXIgdGhlIHRlc3RzCiAgdmFyIGZpbHRlciA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCc/JylbMV07CiAgaWYgKGZpbHRlcikgewogICAgZmlsdGVyID0gbmV3IFJlZ0V4cChmaWx0ZXIpOwogICAgdGVzdHMgPSB0ZXN0cy5maWx0ZXIoZnVuY3Rpb24odikgewogICAgICAgIHJldHVybiBmaWx0ZXIuZXhlYyh2KTsKICAgICAgfSk7CiAgfQoKICBmdW5jdGlvbiB0ZXN0U29ydChhLCBiKSB7CiAgICBhID0gYS5yZXBsYWNlKCcuJywgJy0nKTsKICAgIGIgPSBiLnJlcGxhY2UoJy4nLCAnLScpOwogICAgcmV0dXJuIGEubG9jYWxlQ29tcGFyZShiKTsKICB9CiAgdGVzdHMuc29ydCh0ZXN0U29ydCk7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgdGVzdHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciB0ZXN0TmFtZSA9IHRlc3RzW2ldOwogICAgdmFyIHRlc3RVUkwgPSAndGVzdGNhc2VzLycgKyB0ZXN0TmFtZTsKCiAgICB2YXIgdGVzdCA9IGNyZWF0ZVRlc3RSb3dzKHRlc3ROYW1lLCB0ZXN0VVJMKTsKICAgIHRlc3RSdW5uZXJzLnVuc2hpZnQodGVzdCk7CgogICAgY2hhbmdlVGVzdFN0YXRlKHRlc3QsICdMT0FESU5HJyk7CgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Jlc3VsdHMnKS5hcHBlbmRDaGlsZCh0ZXN0KTsKICAgIHRlc3QucXVlcnlTZWxlY3RvcignaWZyYW1lJykuY29udGVudFdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgLy8gWW91IGNhbiBnZXQgbXVsdGlwbGUgb25sb2FkIGV2ZW50cywgb25seSBkZWFsIHdpdGggdGhlIGZpcnN0IG9uZS4KICAgICAgaWYgKHRoaXMuc3RhdGUgPT0gJ0xPQURJTkcnKSB7CiAgICAgICAgY2hhbmdlVGVzdFN0YXRlKHRoaXMsICdMT0FERUQnKTsKICAgICAgICBydW5UZXN0c0lmTG9hZGVkKCk7CiAgICAgIH0KICAgIH0uYmluZCh0ZXN0KTsKICB9Cgp9OwoKLyoqCiAqIFN0YXJ0IGFzIG1hbnkgbG9hZGVkIHRlc3RzIGFzIHBvc3NpYmxlLCB3YWl0IGZvciByZXN1bHRzIGFuZCB0aGVuIHBvc3QKICogdGhlbS4KICovCmZ1bmN0aW9uIHJ1blRlc3RzKCkgewogIC8vIFN0YXJ0IGEgdGVzdCBydW5uaW5nCiAgaWYgKHRlc3RTdGF0ZXNbJ0xPQURFRCddLmxlbmd0aCA+IDAgJiYKICAgICAgICB0ZXN0U3RhdGVzWydSVU5OSU5HJ10ubGVuZ3RoIDwgMSkgewogICAgY2hhbmdlVGVzdFN0YXRlKHRlc3RTdGF0ZXNbJ0xPQURFRCddWzBdLCAnUlVOTklORycpOwogIH0KCiAgLy8gU3RhcnQgYSB0ZXN0IHBvc3RpbmcKICBpZiAodGVzdFN0YXRlc1snRklOSVNIRUQnXS5sZW5ndGggPiAwICYmCiAgICAgICAgdGVzdFN0YXRlc1snUE9TVElORyddLmxlbmd0aCA8IDEpIHsKICAgIGNoYW5nZVRlc3RTdGF0ZSh0ZXN0U3RhdGVzWydGSU5JU0hFRCddWzBdLCAnUE9TVElORycpOwogIH0KCiAgLy8gRGVhbCB3aXRoIHRlc3RzIHdoaWNoIGFyZSB0YWtpbmcgdG9vIGxvbmcuLi4KICBmb3IgKHZhciBpIGluIHRlc3RTdGF0ZXNbJ1JVTk5JTkcnXSkgewogICAgdmFyIHRlc3QgPSB0ZXN0U3RhdGVzWydSVU5OSU5HJ11baV07CiAgICBpZiAobm93KCkgLSB0ZXN0LnN0YXJ0ID4gMzAwZTMpIHsKICAgICAgLy8gT25seSB3YXkgdG8gc3RvcCBhbGwgdGhlIGphdmFzY3JpcHQgYW5kIGFueXRoaW5nIGVsc2UgcnVubmluZyBpbiB0aGUKICAgICAgLy8gdGVzdCBpcyB0byBjbGVhciB0aGUgZG9jdW1lbnQuCiAgICAgIHZhciB0ZXN0X2lmcmFtZSA9IHRlc3QucXVlcnlTZWxlY3RvcignaWZyYW1lJyk7CiAgICAgIHRlc3RfaWZyYW1lLnNyYyA9ICJkYXRhOnRleHQvaHRtbDtjaGFyc2V0PXV0Zi04LDwhRE9DVFlQRSBodG1sPjxodG1sPjxib2R5PlRJTUVPVVQ8L2JvZHk+PC9odG1sPiI7CgogICAgICB0ZXN0LnJlc3VsdHNfcmF3ID0gW107CiAgICAgIGNoYW5nZVRlc3RTdGF0ZSh0ZXN0LCAnRklOSVNIRUQnKTsKICAgIH0KICB9Cn0KCi8qIEB0eXBlIHtPYmplY3QuPHN0cmluZywgT2JqZWN0Pn0gKi8gdmFyIHRlc3RSZXN1bHRzID0ge307Ci8qKgogKiBDYWxsYmFjayB0aGF0IG9jY3VycyB3aGVuIHRoZSB0ZXN0IGhhcyBmaW5pc2hlZCBydW5uaW5nLgogKi8Kd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoCiAgJ21lc3NhZ2UnLAogIGZ1bmN0aW9uKGV2dCkgewogICAgLy8gSWYgdGhlIHRlc3QgdGltZWQgb3V0LCB0aGlzIHdpbGwgZmFpbCB3aXRoIGEgY3Jvc3Mtb3JpZ2luIGVycm9yLgogICAgdHJ5IHsKICAgICAgdmFyIHRlc3RuYW1lID0gZXZ0LnNvdXJjZS5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpLnBvcCgpLnJlcGxhY2UoJy4nLCAnLScpOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHRlc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0ZXN0bmFtZSk7CgogICAgLy8gV2Ugb25seSByZXNwb25kIHRvIGNvbXBsZXRlIGFzIHBvc3RNZXNzYWdlIGRvZXNuJ3QgZ3VhcmFudGVlIG9yZGVyIHNvCiAgICAvLyByZXN1bHQgbWVzc2FnZXMgY2FuIGNvbWUgaW4gYWZ0ZXIgdGhlIGNvbXBsZXRlIG1lc3NhZ2UuCiAgICBpZiAoZXZ0LmRhdGFbJ3R5cGUnXSAhPSAnY29tcGxldGUnKQogICAgICAgcmV0dXJuOwoKICAgIC8vIFRyeSBjaGFuZ2luZyB0byBzdGF0ZSBGSU5JU0hFRCwgYnV0IHRoaXMgbWVzc2FnZSBtYXkgYmUgYWZ0ZXIgdGhlIGEKICAgIC8vIHRpbWVvdXQgb3IgdHJhbnNpdGlvbi4KICAgIHRyeSB7CiAgICAgIHRlc3QucmVzdWx0c19yYXcgPSBldnQuZGF0YVsndGVzdHMnXTsKICAgICAgY2hhbmdlVGVzdFN0YXRlKHRlc3QsICdGSU5JU0hFRCcpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLndhcm4oZSk7CiAgICB9CiAgfSwKICBmYWxzZSk7CgoKLyoqCiAqIFByb2Nlc3NlcyB0aGUgdGVzdCdzIHJlc3VsdHMgYW5kIHB1dCB0aGUgaW5mb3JtYXRpb24gaW50byB0aGUgdGVzdCBvYmplY3QuCiAqCiAqIEBwYXJhbSB7RWxlbWVudH0gdGVzdCBET00gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgdGVzdC4KICogQHBhcmFtIHtBcnJheS48T2JqZWN0Pn0gcmVzdWx0cyBMaXN0IG9mIHRlc3RoYXJuZXNzLmpzIHJlc3VsdCBvYmplY3RzLgogKi8KZnVuY3Rpb24gcHJvY2Vzc1Jlc3VsdHModGVzdCwgZXhwZWN0ZWRfZmFpbHVyZXMpIHsKICB2YXIgYnJvd3Nlcl9leHBlY3RlZF9mYWlsdXJlcyA9IHt9OwogIGZvcih2YXIgdG5hbWUgaW4gZXhwZWN0ZWRfZmFpbHVyZXMpIHsKICAgIGZvcih2YXIgYm5hbWUgaW4gYm93c2VyKSB7CiAgICAgIHZhciBmYWlscyA9IGV4cGVjdGVkX2ZhaWx1cmVzW3RuYW1lXVtibmFtZV07CiAgICAgIGlmICgodHlwZW9mIGZhaWxzICE9ICJ1bmRlZmluZWQiKSAmJgogICAgICAgICAgKHR5cGVvZiBmYWlscyA9PSAiYm9vbGVhbiIgJiYgZmFpbHMpIHx8CiAgICAgICAgICAodHlwZW9mIGZhaWxzID09ICJvYmplY3QiICYmIGZhaWxzLmluZGV4T2YoYm93c2VyLnZlcnNpb24pICE9IC0xKSkgewogICAgICAgIGJyb3dzZXJfZXhwZWN0ZWRfZmFpbHVyZXNbdG5hbWVdID0gZXhwZWN0ZWRfZmFpbHVyZXNbdG5hbWVdOwogICAgICB9CiAgICB9CiAgfQoKICB2YXIgY291bnRzID0gewogICAgcGFzc2VkOiAwLAogICAgZmFpbGVkOiAwLAogICAgc2tpcHBlZDogMCwKICAgIGV4cGVjdGVkX2ZhaWxlZDogMCwgLy8gVGhpcyBjb3VudCBpcyBpbmNsdWRlZCBpbiB0aGUgYWJvdmUKICAgIHRvdGFsOiB0ZXN0LnJlc3VsdHNfcmF3Lmxlbmd0aAogIH07CiAgdmFyIHJlc3VsdHMgPSBbXTsKICB2YXIgbmV3UmVzdWx0c0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7CgogIGZvcih2YXIgaSA9IDA7IGkgPCB0ZXN0LnJlc3VsdHNfcmF3Lmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgcmVzdWx0ID0gdGVzdC5yZXN1bHRzX3Jhd1tpXTsKICAgIHJlc3VsdHNbaV0gPSByZXN1bHQ7CgogICAgLy8gSW52ZXJ0IGV4cGVjdGVkX2ZhaWx1cmVzCiAgICB2YXIgZXhwZWN0ZWRfZmFpbHVyZSA9IG51bGw7CiAgICBmb3IodmFyIHRuYW1lIGluIGJyb3dzZXJfZXhwZWN0ZWRfZmFpbHVyZXMpIHsKICAgICAgdmFyIHRvbWF0Y2ggPSB0bmFtZTsKICAgICAgaWYgKHRuYW1lLmNoYXJBdCgwKSA9PSAnLycgJiYgdG5hbWUuY2hhckF0KHRuYW1lLmxlbmd0aC0xKSA9PSAnLycpIHsKICAgICAgICAgdG9tYXRjaCA9IG5ldyBSZWdFeHAodG5hbWUuc3Vic3RyKDEsIHRuYW1lLmxlbmd0aC0yKSk7CiAgICAgIH0KICAgICAgaWYgKHJlc3VsdFsnbmFtZSddLm1hdGNoKHRvbWF0Y2gpKSB7CiAgICAgICAgZXhwZWN0ZWRfZmFpbHVyZSA9IGJyb3dzZXJfZXhwZWN0ZWRfZmFpbHVyZXNbdG5hbWVdOwogICAgICB9CiAgICB9CiAgICBpZiAoZXhwZWN0ZWRfZmFpbHVyZSAhPT0gbnVsbCAmJiByZXN1bHQuc3RhdHVzICE9IHJlc3VsdC5OT1RSVU4pIHsKICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgIT0gcmVzdWx0LkZBSUwpIHsKICAgICAgICByZXN1bHQubWVzc2FnZSA9ICJFeHBlY3RlZCBmYWlsdXJlICgiICsgZXhwZWN0ZWRfZmFpbHVyZS5tZXNzYWdlICsgIiksIGFjdHVhbGx5ICIgKwogICAgICAgICAgezA6ICdQQVNTJywgMjogJ1RJTUVPVVQnLCAzOidOT1RSVU4nfVtyZXN1bHQuc3RhdHVzXSArICIgIiArCiAgICAgICAgICByZXN1bHQubWVzc2FnZTsKICAgICAgICByZXN1bHQuc3RhdHVzID0gcmVzdWx0LkZBSUw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0LnN0YXR1cyA9IHJlc3VsdC5QQVNTOwogICAgICAgIHJlc3VsdC5tZXNzYWdlID0gIkV4cGVjdGVkIGZhaWx1cmUgKCIgKyBleHBlY3RlZF9mYWlsdXJlLm1lc3NhZ2UgKyAiKTogIiArIHJlc3VsdC5tZXNzYWdlOwogICAgICB9CiAgICAgIGNvdW50cy5leHBlY3RlZF9mYWlsZWQrKzsKICAgIH0KCiAgICB2YXIgb3V0cHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTsKICAgIG91dHB1dC5pbm5lckhUTUwgKz0gcmVzdWx0Lm5hbWUgKyAnOiAnOwoKICAgIHN3aXRjaCAocmVzdWx0LnN0YXR1cykgewogICAgY2FzZSByZXN1bHQuUEFTUzoKICAgICAgaWYgKCFleHBlY3RlZF9mYWlsdXJlKSB7CiAgICAgICAgb3V0cHV0LmNsYXNzTmFtZSA9ICdwYXNzJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBvdXRwdXQuY2xhc3NOYW1lID0gJ3Bhc3MtZXhwZWN0ZWQtZmFpbHVyZSc7CiAgICAgIH0KICAgICAgY291bnRzLnBhc3NlZCsrOwogICAgICBicmVhazsKCiAgICBjYXNlIHJlc3VsdC5USU1FT1VUOgogICAgICBvdXRwdXQuY2xhc3NOYW1lID0gJ3RpbWVvdXQnOwogICAgICBjb3VudHMuZmFpbGVkKys7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgcmVzdWx0Lk5PVFJVTjoKICAgICAgb3V0cHV0LmNsYXNzTmFtZSA9ICdza2lwcGVkJzsKICAgICAgY291bnRzLnNraXBwZWQrKzsKICAgICAgYnJlYWs7CgogICAgY2FzZSByZXN1bHQuRkFJTDoKICAgIGRlZmF1bHQ6CiAgICAgIG91dHB1dC5jbGFzc05hbWUgPSAnZmFpbGVkJzsKICAgICAgY291bnRzLmZhaWxlZCsrOwogICAgfQoKICAgIG91dHB1dC5pbm5lckhUTUwgKz0gb3V0cHV0LmNsYXNzTmFtZTsKICAgIGlmIChyZXN1bHQubWVzc2FnZSAhPSBudWxsKSB7CiAgICAgIG91dHB1dC5pbm5lckhUTUwgKz0gJyAtICcgKyByZXN1bHQubWVzc2FnZTsKICAgIH0KICAgIG5ld1Jlc3VsdHNEaXYuYXBwZW5kQ2hpbGQob3V0cHV0KTsKICB9CiAgdGVzdC5xdWVyeVNlbGVjdG9yKCcubG9nJykuYXBwZW5kQ2hpbGQobmV3UmVzdWx0c0Rpdik7CgogIHZhciBkZWJ1ZyA9ICcnOwogIHRyeSB7CiAgICBkZWJ1ZyA9IHRlc3QucXVlcnlTZWxlY3RvcignaWZyYW1lJykuY29udGVudERvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWJ1ZycpLmlubmVyVGV4dDsKICB9IGNhdGNoIChlKSB7CiAgICBkZWJ1ZyA9ICdObyBkZWJ1Zy4uLiA6KCc7CiAgfQoKICBpZiAoY291bnRzLnRvdGFsID4gMCkgewogICAgdGVzdC5yZXN1bHRzX3Byb2Nlc3NlZCA9IHsKICAgICAgdHlwZTogJ3Jlc3VsdCcsCiAgICAgIHRlc3ROYW1lOiB0ZXN0LmlkLAogICAgICByZXN1bHRzOiByZXN1bHRzLAogICAgICBkZWJ1ZzogZGVidWcKICAgIH07CgogICAgaWYgKGNvdW50cy5mYWlsZWQgPT0gMCkgewogICAgICBpZiAoY291bnRzLmV4cGVjdGVkX2ZhaWxlZCA+IDApIHsKICAgICAgICB0ZXN0LmNsYXNzTmFtZSA9ICdwYXNzLWV4cGVjdGVkLWZhaWx1cmUnOwogICAgICB9IGVsc2UgaWYgKGNvdW50cy5za2lwcGVkID4gMCkgewogICAgICAgIHRlc3QuY2xhc3NOYW1lID0gJ3NraXBwZWQnOwogICAgICB9IGVsc2UgewogICAgICAgIHRlc3QuY2xhc3NOYW1lID0gJ3Bhc3MnOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0ZXN0LmNsYXNzTmFtZSA9ICdmYWlsJzsKICAgIH0KCiAgICB2YXIgc3VtbWFyeSA9IGNvdW50cy50b3RhbCArICAnIHRlc3RzOyAnOwogICAgaWYgKGNvdW50cy5wYXNzZWQgPiAwKSB7CiAgICAgIHN1bW1hcnkgKz0gJyAnICsgY291bnRzLnBhc3NlZCArICcgcGFzc2VkJzsKICAgICAgaWYgKGNvdW50cy5leHBlY3RlZF9mYWlsZWQgPiAwKSB7CiAgICAgICAgc3VtbWFyeSArPSAnICh3aXRoICcgKyBjb3VudHMuZXhwZWN0ZWRfZmFpbGVkICsgJyBleHBlY3RlZCBmYWlsdXJlcyknOwogICAgICB9CiAgICB9CiAgICBpZiAoY291bnRzLmZhaWxlZCA+IDApIHsKICAgICAgc3VtbWFyeSArPSAnICcgKyBjb3VudHMuZmFpbGVkICsgJyBmYWlsZWQnOwogICAgfQogICAgaWYgKGNvdW50cy5za2lwcGVkID4gMCkgewogICAgICBzdW1tYXJ5ICs9ICcgJyArIGNvdW50cy5za2lwcGVkICsgJyBza2lwcGVkJzsKICAgIH0KICAgIHRlc3QucXVlcnlTZWxlY3RvcignLmNvdW50JykudGV4dENvbnRlbnQgPSBzdW1tYXJ5OwogIH0gZWxzZSB7CiAgICB0ZXN0LnJlc3VsdHNfcHJvY2Vzc2VkID0gewogICAgICB0eXBlOiAncmVzdWx0JywKICAgICAgdGVzdE5hbWU6IHRlc3QuaWQsCiAgICAgIHJlc3VsdHM6IFtdLAogICAgfTsKICAgIHRlc3QuY2xhc3NOYW1lID0gJ25vLXRlc3RzJzsKICAgIHRlc3QucXVlcnlTZWxlY3RvcignLmNvdW50JykudGV4dENvbnRlbnQgPSAnVElNRU9VVCc7CiAgfQp9Cgp9KSgpOwoKCjwvc2NyaXB0Pgo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 03:24:36 GMT",
                    "Content-Length": "20663",
                    "Date": "Sun, 09 Nov 2014 03:24:37 GMT",
                    "Content-Type": "text/html; charset=utf-8"
                },
                "cookies": [],
                "mimeType": "HTML",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}