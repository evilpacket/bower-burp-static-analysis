{
    "url": "http://localhost:9999/Genentech/fishtones-js/howto/lib/fishtones-js-bundle-min.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.replace()</b> via the following statements:<ul><li>var href = location.href.replace(/(javascript:|#).*$/, '');</li><li>location.replace(href + '#' + fragment);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/Genentech/fishtones-js/howto/lib/fishtones-js-bundle-min.js",
                "path": "/Genentech/fishtones-js/howto/lib/fishtones-js-bundle-min.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9HZW5lbnRlY2gvZmlzaHRvbmVzLWpzL2hvd3RvL2xpYi9maXNodG9uZXMtanMtYnVuZGxlLW1pbi5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogODk5MTQ1DQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBGcmksIDA3IE5vdiAyMDE0IDAwOjIxOjI1IEdNVA0KTGFzdC1Nb2RpZmllZDogRnJpLCAwNyBOb3YgMjAxNCAwMDoyMToyNCBHTVQNCg0KLyoqCiAqIHBWaXogYWxsIGJ1bmRsZWQgZmlsZSwgd2l0aCBkZXBlbmRlbmNpZXMKCgogKiBqUXVlcnkgdjEuOC4zIGpxdWVyeS5jb20gfCBqcXVlcnkub3JnL2xpY2Vuc2UKICogYm9vdHN0cmFwIDMuMCBUaGUgTUlUICBMaWNlbnNlIChNSVQpIENvcHlyaWdodCAoYykgMjAxMyBUd2l0dGVyLCBJbmMKICogZDMudjMuanMgQ29weXJpZ2h0IChjKSAyMDEzLCBNaWNoYWVsIEJvc3RvY2sgQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogYmFja2JvbmVqcy5vcmcgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTMgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkCiAqIHVuZGVyc2NvcmUuanMgQ29weXJpZ2h0IChjKSAyMDA5LTIwMTMgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKIAogKiBmaXNodG9uZXMtanMKICogQ29weXJpZ2h0IChjKSAyMDEzLCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAgCiAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3JtcyBhcmUgcGVybWl0dGVkCnByb3ZpZGVkIHRoYXQgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGFyYWdyYXBoIGFyZQkKZHVwbGljYXRlZCBpbiBhbGwgc3VjaCBmb3JtcyBhbmQgdGhhdCBhbnkgZG9jdW1lbnRhdGlvbiwKYWR2ZXJ0aXNpbmcgbWF0ZXJpYWxzLCBhbmQgb3RoZXIgbWF0ZXJpYWxzIHJlbGF0ZWQgdG8gc3VjaApkaXN0cmlidXRpb24gYW5kIHVzZSBhY2tub3dsZWRnZSB0aGF0IHRoZSBzb2Z0d2FyZSB3YXMgZGV2ZWxvcGVkCmJ5IHRoZSBCaW9pbmZvcm1hdGljcyBhbmQgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaCBJbmMuICBUaGUgbmFtZSBvZgpHZW5lbnRlY2ggbWF5IG5vdCBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkCmZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBgYEFTIElTJycgQU5EIFdJVEhPVVQgQU5ZIEVYUFJFU1MgT1IKSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIFdJVEhPVVQgTElNSVRBVElPTiwgVEhFIElNUExJRUQKV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLgoKICovCgoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgIAogICAgICAgIGRlZmluZShmYWN0b3J5KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy9Ccm93c2VyIGdsb2JhbHMgY2FzZS4gSnVzdCBhc3NpZ24gdGhlCiAgICAgICAgLy9yZXN1bHQgdG8gYSBwcm9wZXJ0eSBvbiB0aGUgZ2xvYmFsLgogICAgICAgIHJvb3QuZmlzaHRvbmVzID0gZmFjdG9yeSgpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uICgpIHsKICAgIC8vYWxtb25kLCBhbmQgeW91ciBtb2R1bGVzIHdpbGwgYmUgaW5saW5lZCBoZXJlCiAgICAKLyoqCiAqIGFsbW9uZCAwLjIuNSBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxMiwgVGhlIERvam8gRm91bmRhdGlvbiBBbGwgUmlnaHRzIFJlc2VydmVkLgogKiBBdmFpbGFibGUgdmlhIHRoZSBNSVQgb3IgbmV3IEJTRCBsaWNlbnNlLgogKiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvYWxtb25kIGZvciBkZXRhaWxzCiAqLwovL0dvaW5nIHNsb3BweSB0byBhdm9pZCAndXNlIHN0cmljdCcgc3RyaW5nIGNvc3QsIGJ1dCBzdHJpY3QgcHJhY3RpY2VzIHNob3VsZAovL2JlIGZvbGxvd2VkLgovKmpzbGludCBzbG9wcHk6IHRydWUgKi8KLypnbG9iYWwgc2V0VGltZW91dDogZmFsc2UgKi8KCnZhciByZXF1aXJlanMsIHJlcXVpcmUsIGRlZmluZTsKKGZ1bmN0aW9uICh1bmRlZikgewogICAgdmFyIG1haW4sIHJlcSwgbWFrZU1hcCwgaGFuZGxlcnMsCiAgICAgICAgZGVmaW5lZCA9IHt9LAogICAgICAgIHdhaXRpbmcgPSB7fSwKICAgICAgICBjb25maWcgPSB7fSwKICAgICAgICBkZWZpbmluZyA9IHt9LAogICAgICAgIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksCiAgICAgICAgYXBzID0gW10uc2xpY2U7CgogICAgZnVuY3Rpb24gaGFzUHJvcChvYmosIHByb3ApIHsKICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwob2JqLCBwcm9wKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdpdmVuIGEgcmVsYXRpdmUgbW9kdWxlIG5hbWUsIGxpa2UgLi9zb21ldGhpbmcsIG5vcm1hbGl6ZSBpdCB0bwogICAgICogYSByZWFsIG5hbWUgdGhhdCBjYW4gYmUgbWFwcGVkIHRvIGEgcGF0aC4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIHRoZSByZWxhdGl2ZSBuYW1lCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYmFzZU5hbWUgYSByZWFsIG5hbWUgdGhhdCB0aGUgbmFtZSBhcmcgaXMgcmVsYXRpdmUKICAgICAqIHRvLgogICAgICogQHJldHVybnMge1N0cmluZ30gbm9ybWFsaXplZCBuYW1lCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZShuYW1lLCBiYXNlTmFtZSkgewogICAgICAgIHZhciBuYW1lUGFydHMsIG5hbWVTZWdtZW50LCBtYXBWYWx1ZSwgZm91bmRNYXAsCiAgICAgICAgICAgIGZvdW5kSSwgZm91bmRTdGFyTWFwLCBzdGFySSwgaSwgaiwgcGFydCwKICAgICAgICAgICAgYmFzZVBhcnRzID0gYmFzZU5hbWUgJiYgYmFzZU5hbWUuc3BsaXQoIi8iKSwKICAgICAgICAgICAgbWFwID0gY29uZmlnLm1hcCwKICAgICAgICAgICAgc3Rhck1hcCA9IChtYXAgJiYgbWFwWycqJ10pIHx8IHt9OwoKICAgICAgICAvL0FkanVzdCBhbnkgcmVsYXRpdmUgcGF0aHMuCiAgICAgICAgaWYgKG5hbWUgJiYgbmFtZS5jaGFyQXQoMCkgPT09ICIuIikgewogICAgICAgICAgICAvL0lmIGhhdmUgYSBiYXNlIG5hbWUsIHRyeSB0byBub3JtYWxpemUgYWdhaW5zdCBpdCwKICAgICAgICAgICAgLy9vdGhlcndpc2UsIGFzc3VtZSBpdCBpcyBhIHRvcC1sZXZlbCByZXF1aXJlIHRoYXQgd2lsbAogICAgICAgICAgICAvL2JlIHJlbGF0aXZlIHRvIGJhc2VVcmwgaW4gdGhlIGVuZC4KICAgICAgICAgICAgaWYgKGJhc2VOYW1lKSB7CiAgICAgICAgICAgICAgICAvL0NvbnZlcnQgYmFzZU5hbWUgdG8gYXJyYXksIGFuZCBsb3Agb2ZmIHRoZSBsYXN0IHBhcnQsCiAgICAgICAgICAgICAgICAvL3NvIHRoYXQgLiBtYXRjaGVzIHRoYXQgImRpcmVjdG9yeSIgYW5kIG5vdCBuYW1lIG9mIHRoZSBiYXNlTmFtZSdzCiAgICAgICAgICAgICAgICAvL21vZHVsZS4gRm9yIGluc3RhbmNlLCBiYXNlTmFtZSBvZiAib25lL3R3by90aHJlZSIsIG1hcHMgdG8KICAgICAgICAgICAgICAgIC8vIm9uZS90d28vdGhyZWUuanMiLCBidXQgd2Ugd2FudCB0aGUgZGlyZWN0b3J5LCAib25lL3R3byIgZm9yCiAgICAgICAgICAgICAgICAvL3RoaXMgbm9ybWFsaXphdGlvbi4KICAgICAgICAgICAgICAgIGJhc2VQYXJ0cyA9IGJhc2VQYXJ0cy5zbGljZSgwLCBiYXNlUGFydHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICAgICAgbmFtZSA9IGJhc2VQYXJ0cy5jb25jYXQobmFtZS5zcGxpdCgiLyIpKTsKCiAgICAgICAgICAgICAgICAvL3N0YXJ0IHRyaW1Eb3RzCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbmFtZS5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgICAgIHBhcnQgPSBuYW1lW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0ID09PSAiLiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnQgPT09ICIuLiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDEgJiYgKG5hbWVbMl0gPT09ICcuLicgfHwgbmFtZVswXSA9PT0gJy4uJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRW5kIG9mIHRoZSBsaW5lLiBLZWVwIGF0IGxlYXN0IG9uZSBub24tZG90CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3BhdGggc2VnbWVudCBhdCB0aGUgZnJvbnQgc28gaXQgY2FuIGJlIG1hcHBlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb3JyZWN0bHkgdG8gZGlzay4gT3RoZXJ3aXNlLCB0aGVyZSBpcyBsaWtlbHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbm8gcGF0aCBtYXBwaW5nIGZvciBhIHBhdGggc3RhcnRpbmcgd2l0aCAnLi4nLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9UaGlzIGNhbiBzdGlsbCBmYWlsLCBidXQgY2F0Y2hlcyB0aGUgbW9zdCByZWFzb25hYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VzZXMgb2YgLi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lLnNwbGljZShpIC0gMSwgMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpIC09IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2VuZCB0cmltRG90cwoKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLmpvaW4oIi8iKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluZGV4T2YoJy4vJykgPT09IDApIHsKICAgICAgICAgICAgICAgIC8vIE5vIGJhc2VOYW1lLCBzbyB0aGlzIGlzIElEIGlzIHJlc29sdmVkIHJlbGF0aXZlCiAgICAgICAgICAgICAgICAvLyB0byBiYXNlVXJsLCBwdWxsIG9mZiB0aGUgbGVhZGluZyBkb3QuCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vQXBwbHkgbWFwIGNvbmZpZyBpZiBhdmFpbGFibGUuCiAgICAgICAgaWYgKChiYXNlUGFydHMgfHwgc3Rhck1hcCkgJiYgbWFwKSB7CiAgICAgICAgICAgIG5hbWVQYXJ0cyA9IG5hbWUuc3BsaXQoJy8nKTsKCiAgICAgICAgICAgIGZvciAoaSA9IG5hbWVQYXJ0cy5sZW5ndGg7IGkgPiAwOyBpIC09IDEpIHsKICAgICAgICAgICAgICAgIG5hbWVTZWdtZW50ID0gbmFtZVBhcnRzLnNsaWNlKDAsIGkpLmpvaW4oIi8iKTsKCiAgICAgICAgICAgICAgICBpZiAoYmFzZVBhcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgLy9GaW5kIHRoZSBsb25nZXN0IGJhc2VOYW1lIHNlZ21lbnQgbWF0Y2ggaW4gdGhlIGNvbmZpZy4KICAgICAgICAgICAgICAgICAgICAvL1NvLCBkbyBqb2lucyBvbiB0aGUgYmlnZ2VzdCB0byBzbWFsbGVzdCBsZW5ndGhzIG9mIGJhc2VQYXJ0cy4KICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSBiYXNlUGFydHMubGVuZ3RoOyBqID4gMDsgaiAtPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcFZhbHVlID0gbWFwW2Jhc2VQYXJ0cy5zbGljZSgwLCBqKS5qb2luKCcvJyldOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9iYXNlTmFtZSBzZWdtZW50IGhhcyAgY29uZmlnLCBmaW5kIGlmIGl0IGhhcyBvbmUgZm9yCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcyBuYW1lLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcFZhbHVlID0gbWFwVmFsdWVbbmFtZVNlZ21lbnRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9NYXRjaCwgdXBkYXRlIG5hbWUgdG8gdGhlIG5ldyB2YWx1ZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZE1hcCA9IG1hcFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kSSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGZvdW5kTWFwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9DaGVjayBmb3IgYSBzdGFyIG1hcCBtYXRjaCwgYnV0IGp1c3QgaG9sZCBvbiB0byBpdCwKICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgYSBzaG9ydGVyIHNlZ21lbnQgbWF0Y2ggbGF0ZXIgaW4gYSBtYXRjaGluZwogICAgICAgICAgICAgICAgLy9jb25maWcsIHRoZW4gZmF2b3Igb3ZlciB0aGlzIHN0YXIgbWFwLgogICAgICAgICAgICAgICAgaWYgKCFmb3VuZFN0YXJNYXAgJiYgc3Rhck1hcCAmJiBzdGFyTWFwW25hbWVTZWdtZW50XSkgewogICAgICAgICAgICAgICAgICAgIGZvdW5kU3Rhck1hcCA9IHN0YXJNYXBbbmFtZVNlZ21lbnRdOwogICAgICAgICAgICAgICAgICAgIHN0YXJJID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFmb3VuZE1hcCAmJiBmb3VuZFN0YXJNYXApIHsKICAgICAgICAgICAgICAgIGZvdW5kTWFwID0gZm91bmRTdGFyTWFwOwogICAgICAgICAgICAgICAgZm91bmRJID0gc3Rhckk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmb3VuZE1hcCkgewogICAgICAgICAgICAgICAgbmFtZVBhcnRzLnNwbGljZSgwLCBmb3VuZEksIGZvdW5kTWFwKTsKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lUGFydHMuam9pbignLycpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlUmVxdWlyZShyZWxOYW1lLCBmb3JjZVN5bmMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvL0EgdmVyc2lvbiBvZiBhIHJlcXVpcmUgZnVuY3Rpb24gdGhhdCBwYXNzZXMgYSBtb2R1bGVOYW1lCiAgICAgICAgICAgIC8vdmFsdWUgZm9yIGl0ZW1zIHRoYXQgbWF5IG5lZWQgdG8KICAgICAgICAgICAgLy9sb29rIHVwIHBhdGhzIHJlbGF0aXZlIHRvIHRoZSBtb2R1bGVOYW1lCiAgICAgICAgICAgIHJldHVybiByZXEuYXBwbHkodW5kZWYsIGFwcy5jYWxsKGFyZ3VtZW50cywgMCkuY29uY2F0KFtyZWxOYW1lLCBmb3JjZVN5bmNdKSk7CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlTm9ybWFsaXplKHJlbE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VMb2FkKGRlcE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgIGRlZmluZWRbZGVwTmFtZV0gPSB2YWx1ZTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxEZXAobmFtZSkgewogICAgICAgIGlmIChoYXNQcm9wKHdhaXRpbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHZhciBhcmdzID0gd2FpdGluZ1tuYW1lXTsKICAgICAgICAgICAgZGVsZXRlIHdhaXRpbmdbbmFtZV07CiAgICAgICAgICAgIGRlZmluaW5nW25hbWVdID0gdHJ1ZTsKICAgICAgICAgICAgbWFpbi5hcHBseSh1bmRlZiwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWhhc1Byb3AoZGVmaW5lZCwgbmFtZSkgJiYgIWhhc1Byb3AoZGVmaW5pbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gJyArIG5hbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVmaW5lZFtuYW1lXTsKICAgIH0KCiAgICAvL1R1cm5zIGEgcGx1Z2luIXJlc291cmNlIHRvIFtwbHVnaW4sIHJlc291cmNlXQogICAgLy93aXRoIHRoZSBwbHVnaW4gYmVpbmcgdW5kZWZpbmVkIGlmIHRoZSBuYW1lCiAgICAvL2RpZCBub3QgaGF2ZSBhIHBsdWdpbiBwcmVmaXguCiAgICBmdW5jdGlvbiBzcGxpdFByZWZpeChuYW1lKSB7CiAgICAgICAgdmFyIHByZWZpeCwKICAgICAgICAgICAgaW5kZXggPSBuYW1lID8gbmFtZS5pbmRleE9mKCchJykgOiAtMTsKICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICBwcmVmaXggPSBuYW1lLnN1YnN0cmluZygwLCBpbmRleCk7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhpbmRleCArIDEsIG5hbWUubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFtwcmVmaXgsIG5hbWVdOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZXMgYSBuYW1lIG1hcCwgbm9ybWFsaXppbmcgdGhlIG5hbWUsIGFuZCB1c2luZyBhIHBsdWdpbgogICAgICogZm9yIG5vcm1hbGl6YXRpb24gaWYgbmVjZXNzYXJ5LiBHcmFicyBhIHJlZiB0byBwbHVnaW4KICAgICAqIHRvbywgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICovCiAgICBtYWtlTWFwID0gZnVuY3Rpb24gKG5hbWUsIHJlbE5hbWUpIHsKICAgICAgICB2YXIgcGx1Z2luLAogICAgICAgICAgICBwYXJ0cyA9IHNwbGl0UHJlZml4KG5hbWUpLAogICAgICAgICAgICBwcmVmaXggPSBwYXJ0c1swXTsKCiAgICAgICAgbmFtZSA9IHBhcnRzWzFdOwoKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIHByZWZpeCA9IG5vcm1hbGl6ZShwcmVmaXgsIHJlbE5hbWUpOwogICAgICAgICAgICBwbHVnaW4gPSBjYWxsRGVwKHByZWZpeCk7CiAgICAgICAgfQoKICAgICAgICAvL05vcm1hbGl6ZSBhY2NvcmRpbmcKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIGlmIChwbHVnaW4gJiYgcGx1Z2luLm5vcm1hbGl6ZSkgewogICAgICAgICAgICAgICAgbmFtZSA9IHBsdWdpbi5ub3JtYWxpemUobmFtZSwgbWFrZU5vcm1hbGl6ZShyZWxOYW1lKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplKG5hbWUsIHJlbE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmFtZSA9IG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICAgICAgcGFydHMgPSBzcGxpdFByZWZpeChuYW1lKTsKICAgICAgICAgICAgcHJlZml4ID0gcGFydHNbMF07CiAgICAgICAgICAgIG5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICAgICAgcGx1Z2luID0gY2FsbERlcChwcmVmaXgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1VzaW5nIHJpZGljdWxvdXMgcHJvcGVydHkgbmFtZXMgZm9yIHNwYWNlIHJlYXNvbnMKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmOiBwcmVmaXggPyBwcmVmaXggKyAnIScgKyBuYW1lIDogbmFtZSwgLy9mdWxsTmFtZQogICAgICAgICAgICBuOiBuYW1lLAogICAgICAgICAgICBwcjogcHJlZml4LAogICAgICAgICAgICBwOiBwbHVnaW4KICAgICAgICB9OwogICAgfTsKCiAgICBmdW5jdGlvbiBtYWtlQ29uZmlnKG5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKGNvbmZpZyAmJiBjb25maWcuY29uZmlnICYmIGNvbmZpZy5jb25maWdbbmFtZV0pIHx8IHt9OwogICAgICAgIH07CiAgICB9CgogICAgaGFuZGxlcnMgPSB7CiAgICAgICAgcmVxdWlyZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG1ha2VSZXF1aXJlKG5hbWUpOwogICAgICAgIH0sCiAgICAgICAgZXhwb3J0czogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgdmFyIGUgPSBkZWZpbmVkW25hbWVdOwogICAgICAgICAgICBpZiAodHlwZW9mIGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAoZGVmaW5lZFtuYW1lXSA9IHt9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbW9kdWxlOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IG5hbWUsCiAgICAgICAgICAgICAgICB1cmk6ICcnLAogICAgICAgICAgICAgICAgZXhwb3J0czogZGVmaW5lZFtuYW1lXSwKICAgICAgICAgICAgICAgIGNvbmZpZzogbWFrZUNvbmZpZyhuYW1lKQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH07CgogICAgbWFpbiA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSkgewogICAgICAgIHZhciBjanNNb2R1bGUsIGRlcE5hbWUsIHJldCwgbWFwLCBpLAogICAgICAgICAgICBhcmdzID0gW10sCiAgICAgICAgICAgIHVzaW5nRXhwb3J0czsKCiAgICAgICAgLy9Vc2UgbmFtZSBpZiBubyByZWxOYW1lCiAgICAgICAgcmVsTmFtZSA9IHJlbE5hbWUgfHwgbmFtZTsKCiAgICAgICAgLy9DYWxsIHRoZSBjYWxsYmFjayB0byBkZWZpbmUgdGhlIG1vZHVsZSwgaWYgbmVjZXNzYXJ5LgogICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKCiAgICAgICAgICAgIC8vUHVsbCBvdXQgdGhlIGRlZmluZWQgZGVwZW5kZW5jaWVzIGFuZCBwYXNzIHRoZSBvcmRlcmVkCiAgICAgICAgICAgIC8vdmFsdWVzIHRvIHRoZSBjYWxsYmFjay4KICAgICAgICAgICAgLy9EZWZhdWx0IHRvIFtyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGVdIGlmIG5vIGRlcHMKICAgICAgICAgICAgZGVwcyA9ICFkZXBzLmxlbmd0aCAmJiBjYWxsYmFjay5sZW5ndGggPyBbJ3JlcXVpcmUnLCAnZXhwb3J0cycsICdtb2R1bGUnXSA6IGRlcHM7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBkZXBzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICBtYXAgPSBtYWtlTWFwKGRlcHNbaV0sIHJlbE5hbWUpOwogICAgICAgICAgICAgICAgZGVwTmFtZSA9IG1hcC5mOwoKICAgICAgICAgICAgICAgIC8vRmFzdCBwYXRoIENvbW1vbkpTIHN0YW5kYXJkIGRlcGVuZGVuY2llcy4KICAgICAgICAgICAgICAgIGlmIChkZXBOYW1lID09PSAicmVxdWlyZSIpIHsKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gaGFuZGxlcnMucmVxdWlyZShuYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVwTmFtZSA9PT0gImV4cG9ydHMiKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Db21tb25KUyBtb2R1bGUgc3BlYyAxLjEKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gaGFuZGxlcnMuZXhwb3J0cyhuYW1lKTsKICAgICAgICAgICAgICAgICAgICB1c2luZ0V4cG9ydHMgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXBOYW1lID09PSAibW9kdWxlIikgewogICAgICAgICAgICAgICAgICAgIC8vQ29tbW9uSlMgbW9kdWxlIHNwZWMgMS4xCiAgICAgICAgICAgICAgICAgICAgY2pzTW9kdWxlID0gYXJnc1tpXSA9IGhhbmRsZXJzLm1vZHVsZShuYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzUHJvcChkZWZpbmVkLCBkZXBOYW1lKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNQcm9wKHdhaXRpbmcsIGRlcE5hbWUpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1Byb3AoZGVmaW5pbmcsIGRlcE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGNhbGxEZXAoZGVwTmFtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1hcC5wKSB7CiAgICAgICAgICAgICAgICAgICAgbWFwLnAubG9hZChtYXAubiwgbWFrZVJlcXVpcmUocmVsTmFtZSwgdHJ1ZSksIG1ha2VMb2FkKGRlcE5hbWUpLCB7fSk7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGRlZmluZWRbZGVwTmFtZV07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lICsgJyBtaXNzaW5nICcgKyBkZXBOYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0ID0gY2FsbGJhY2suYXBwbHkoZGVmaW5lZFtuYW1lXSwgYXJncyk7CgogICAgICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgICAgICAgLy9JZiBzZXR0aW5nIGV4cG9ydHMgdmlhICJtb2R1bGUiIGlzIGluIHBsYXksCiAgICAgICAgICAgICAgICAvL2Zhdm9yIHRoYXQgb3ZlciByZXR1cm4gdmFsdWUgYW5kIGV4cG9ydHMuIEFmdGVyIHRoYXQsCiAgICAgICAgICAgICAgICAvL2Zhdm9yIGEgbm9uLXVuZGVmaW5lZCByZXR1cm4gdmFsdWUgb3ZlciBleHBvcnRzIHVzZS4KICAgICAgICAgICAgICAgIGlmIChjanNNb2R1bGUgJiYgY2pzTW9kdWxlLmV4cG9ydHMgIT09IHVuZGVmICYmCiAgICAgICAgICAgICAgICAgICAgICAgIGNqc01vZHVsZS5leHBvcnRzICE9PSBkZWZpbmVkW25hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNqc01vZHVsZS5leHBvcnRzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXQgIT09IHVuZGVmIHx8ICF1c2luZ0V4cG9ydHMpIHsKICAgICAgICAgICAgICAgICAgICAvL1VzZSB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uLgogICAgICAgICAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSByZXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG5hbWUpIHsKICAgICAgICAgICAgLy9NYXkganVzdCBiZSBhbiBvYmplY3QgZGVmaW5pdGlvbiBmb3IgdGhlIG1vZHVsZS4gT25seQogICAgICAgICAgICAvL3dvcnJ5IGFib3V0IGRlZmluaW5nIGlmIGhhdmUgYSBtb2R1bGUgbmFtZS4KICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNhbGxiYWNrOwogICAgICAgIH0KICAgIH07CgogICAgcmVxdWlyZWpzID0gcmVxdWlyZSA9IHJlcSA9IGZ1bmN0aW9uIChkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSwgZm9yY2VTeW5jLCBhbHQpIHsKICAgICAgICBpZiAodHlwZW9mIGRlcHMgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGlmIChoYW5kbGVyc1tkZXBzXSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpbiB0aGlzIGNhc2UgaXMgcmVhbGx5IHJlbE5hbWUKICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyc1tkZXBzXShjYWxsYmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9KdXN0IHJldHVybiB0aGUgbW9kdWxlIHdhbnRlZC4gSW4gdGhpcyBzY2VuYXJpbywgdGhlCiAgICAgICAgICAgIC8vZGVwcyBhcmcgaXMgdGhlIG1vZHVsZSBuYW1lLCBhbmQgc2Vjb25kIGFyZyAoaWYgcGFzc2VkKQogICAgICAgICAgICAvL2lzIGp1c3QgdGhlIHJlbE5hbWUuCiAgICAgICAgICAgIC8vTm9ybWFsaXplIG1vZHVsZSBuYW1lLCBpZiBpdCBjb250YWlucyAuIG9yIC4uCiAgICAgICAgICAgIHJldHVybiBjYWxsRGVwKG1ha2VNYXAoZGVwcywgY2FsbGJhY2spLmYpOwogICAgICAgIH0gZWxzZSBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBhIGNvbmZpZyBvYmplY3QsIG5vdCBhbiBhcnJheS4KICAgICAgICAgICAgY29uZmlnID0gZGVwczsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrLnNwbGljZSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpcyBhbiBhcnJheSwgd2hpY2ggbWVhbnMgaXQgaXMgYSBkZXBlbmRlbmN5IGxpc3QuCiAgICAgICAgICAgICAgICAvL0FkanVzdCBhcmdzIGlmIHRoZXJlIGFyZSBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgICAgIGRlcHMgPSBjYWxsYmFjazsKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gcmVsTmFtZTsKICAgICAgICAgICAgICAgIHJlbE5hbWUgPSBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVwcyA9IHVuZGVmOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1N1cHBvcnQgcmVxdWlyZShbJ2EnXSkKICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9OwoKICAgICAgICAvL0lmIHJlbE5hbWUgaXMgYSBmdW5jdGlvbiwgaXQgaXMgYW4gZXJyYmFjayBoYW5kbGVyLAogICAgICAgIC8vc28gcmVtb3ZlIGl0LgogICAgICAgIGlmICh0eXBlb2YgcmVsTmFtZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICByZWxOYW1lID0gZm9yY2VTeW5jOwogICAgICAgICAgICBmb3JjZVN5bmMgPSBhbHQ7CiAgICAgICAgfQoKICAgICAgICAvL1NpbXVsYXRlIGFzeW5jIGNhbGxiYWNrOwogICAgICAgIGlmIChmb3JjZVN5bmMpIHsKICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNpbmcgYSBub24temVybyB2YWx1ZSBiZWNhdXNlIG9mIGNvbmNlcm4gZm9yIHdoYXQgb2xkIGJyb3dzZXJzCiAgICAgICAgICAgIC8vZG8sIGFuZCBsYXRlc3QgYnJvd3NlcnMgInVwZ3JhZGUiIHRvIDQgaWYgbG93ZXIgdmFsdWUgaXMgdXNlZDoKICAgICAgICAgICAgLy9odHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS90aW1lcnMuaHRtbCNkb20td2luZG93dGltZXJzLXNldHRpbWVvdXQ6CiAgICAgICAgICAgIC8vSWYgd2FudCBhIHZhbHVlIGltbWVkaWF0ZWx5LCB1c2UgcmVxdWlyZSgnaWQnKSBpbnN0ZWFkIC0tIHNvbWV0aGluZwogICAgICAgICAgICAvL3RoYXQgd29ya3MgaW4gYWxtb25kIG9uIHRoZSBnbG9iYWwgbGV2ZWwsIGJ1dCBub3QgZ3VhcmFudGVlZCBhbmQKICAgICAgICAgICAgLy91bmxpa2VseSB0byB3b3JrIGluIG90aGVyIEFNRCBpbXBsZW1lbnRhdGlvbnMuCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgICAgICB9LCA0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIC8qKgogICAgICogSnVzdCBkcm9wcyB0aGUgY29uZmlnIG9uIHRoZSBmbG9vciwgYnV0IHJldHVybnMgcmVxIGluIGNhc2UKICAgICAqIHRoZSBjb25maWcgcmV0dXJuIHZhbHVlIGlzIHVzZWQuCiAgICAgKi8KICAgIHJlcS5jb25maWcgPSBmdW5jdGlvbiAoY2ZnKSB7CiAgICAgICAgY29uZmlnID0gY2ZnOwogICAgICAgIGlmIChjb25maWcuZGVwcykgewogICAgICAgICAgICByZXEoY29uZmlnLmRlcHMsIGNvbmZpZy5jYWxsYmFjayk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIGRlZmluZSA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaykgewoKICAgICAgICAvL1RoaXMgbW9kdWxlIG1heSBub3QgaGF2ZSBkZXBlbmRlbmNpZXMKICAgICAgICBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBub3QgYW4gYXJyYXksIHNvIHByb2JhYmx5IG1lYW5zCiAgICAgICAgICAgIC8vYW4gb2JqZWN0IGxpdGVyYWwgb3IgZmFjdG9yeSBmdW5jdGlvbiBmb3IKICAgICAgICAgICAgLy90aGUgdmFsdWUuIEFkanVzdCBhcmdzLgogICAgICAgICAgICBjYWxsYmFjayA9IGRlcHM7CiAgICAgICAgICAgIGRlcHMgPSBbXTsKICAgICAgICB9CgogICAgICAgIGlmICghaGFzUHJvcChkZWZpbmVkLCBuYW1lKSAmJiAhaGFzUHJvcCh3YWl0aW5nLCBuYW1lKSkgewogICAgICAgICAgICB3YWl0aW5nW25hbWVdID0gW25hbWUsIGRlcHMsIGNhbGxiYWNrXTsKICAgICAgICB9CiAgICB9OwoKICAgIGRlZmluZS5hbWQgPSB7CiAgICAgICAgalF1ZXJ5OiB0cnVlCiAgICB9Owp9KCkpOwpkZWZpbmUoIi4uLy4uL2J1aWxkLXV0aWxzL2FsbW9uZCIsIGZ1bmN0aW9uKCl7fSk7CgovKiEKICogalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS45LjEKICogaHR0cDovL2pxdWVyeS5jb20vCiAqCiAqIEluY2x1ZGVzIFNpenpsZS5qcwogKiBodHRwOi8vc2l6emxlanMuY29tLwogKgogKiBDb3B5cmlnaHQgMjAwNSwgMjAxMiBqUXVlcnkgRm91bmRhdGlvbiwgSW5jLiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIERhdGU6IDIwMTMtMi00CiAqLwooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgewoKLy8gQ2FuJ3QgZG8gdGhpcyBiZWNhdXNlIHNldmVyYWwgYXBwcyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQovLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYKLy8geW91IHRyeSB0byB0cmFjZSB0aHJvdWdoICJ1c2Ugc3RyaWN0IiBjYWxsIGNoYWlucy4gKCMxMzMzNSkKLy8gU3VwcG9ydDogRmlyZWZveCAxOCsKLy8KdmFyCgkvLyBUaGUgZGVmZXJyZWQgdXNlZCBvbiBET00gcmVhZHkKCXJlYWR5TGlzdCwKCgkvLyBBIGNlbnRyYWwgcmVmZXJlbmNlIHRvIHRoZSByb290IGpRdWVyeShkb2N1bWVudCkKCXJvb3RqUXVlcnksCgoJLy8gU3VwcG9ydDogSUU8OQoJLy8gRm9yIGB0eXBlb2Ygbm9kZS5tZXRob2RgIGluc3RlYWQgb2YgYG5vZGUubWV0aG9kICE9PSB1bmRlZmluZWRgCgljb3JlX3N0cnVuZGVmaW5lZCA9IHR5cGVvZiB1bmRlZmluZWQsCgoJLy8gVXNlIHRoZSBjb3JyZWN0IGRvY3VtZW50IGFjY29yZGluZ2x5IHdpdGggd2luZG93IGFyZ3VtZW50IChzYW5kYm94KQoJZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQsCglsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbiwKCgkvLyBNYXAgb3ZlciBqUXVlcnkgaW4gY2FzZSBvZiBvdmVyd3JpdGUKCV9qUXVlcnkgPSB3aW5kb3cualF1ZXJ5LAoKCS8vIE1hcCBvdmVyIHRoZSAkIGluIGNhc2Ugb2Ygb3ZlcndyaXRlCglfJCA9IHdpbmRvdy4kLAoKCS8vIFtbQ2xhc3NdXSAtPiB0eXBlIHBhaXJzCgljbGFzczJ0eXBlID0ge30sCgoJLy8gTGlzdCBvZiBkZWxldGVkIGRhdGEgY2FjaGUgaWRzLCBzbyB3ZSBjYW4gcmV1c2UgdGhlbQoJY29yZV9kZWxldGVkSWRzID0gW10sCgoJY29yZV92ZXJzaW9uID0gIjEuOS4xIiwKCgkvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHNvbWUgY29yZSBtZXRob2RzCgljb3JlX2NvbmNhdCA9IGNvcmVfZGVsZXRlZElkcy5jb25jYXQsCgljb3JlX3B1c2ggPSBjb3JlX2RlbGV0ZWRJZHMucHVzaCwKCWNvcmVfc2xpY2UgPSBjb3JlX2RlbGV0ZWRJZHMuc2xpY2UsCgljb3JlX2luZGV4T2YgPSBjb3JlX2RlbGV0ZWRJZHMuaW5kZXhPZiwKCWNvcmVfdG9TdHJpbmcgPSBjbGFzczJ0eXBlLnRvU3RyaW5nLAoJY29yZV9oYXNPd24gPSBjbGFzczJ0eXBlLmhhc093blByb3BlcnR5LAoJY29yZV90cmltID0gY29yZV92ZXJzaW9uLnRyaW0sCgoJLy8gRGVmaW5lIGEgbG9jYWwgY29weSBvZiBqUXVlcnkKCWpRdWVyeSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQkvLyBUaGUgalF1ZXJ5IG9iamVjdCBpcyBhY3R1YWxseSBqdXN0IHRoZSBpbml0IGNvbnN0cnVjdG9yICdlbmhhbmNlZCcKCQlyZXR1cm4gbmV3IGpRdWVyeS5mbi5pbml0KCBzZWxlY3RvciwgY29udGV4dCwgcm9vdGpRdWVyeSApOwoJfSwKCgkvLyBVc2VkIGZvciBtYXRjaGluZyBudW1iZXJzCgljb3JlX3BudW0gPSAvWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSwKCgkvLyBVc2VkIGZvciBzcGxpdHRpbmcgb24gd2hpdGVzcGFjZQoJY29yZV9ybm90d2hpdGUgPSAvXFMrL2csCgoJLy8gTWFrZSBzdXJlIHdlIHRyaW0gQk9NIGFuZCBOQlNQIChoZXJlJ3MgbG9va2luZyBhdCB5b3UsIFNhZmFyaSA1LjAgYW5kIElFKQoJcnRyaW0gPSAvXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2csCgoJLy8gQSBzaW1wbGUgd2F5IHRvIGNoZWNrIGZvciBIVE1MIHN0cmluZ3MKCS8vIFByaW9yaXRpemUgI2lkIG92ZXIgPHRhZz4gdG8gYXZvaWQgWFNTIHZpYSBsb2NhdGlvbi5oYXNoICgjOTUyMSkKCS8vIFN0cmljdCBIVE1MIHJlY29nbml0aW9uICgjMTEyOTA6IG11c3Qgc3RhcnQgd2l0aCA8KQoJcnF1aWNrRXhwciA9IC9eKD86KDxbXHdcV10rPilbXj5dKnwjKFtcdy1dKikpJC8sCgoJLy8gTWF0Y2ggYSBzdGFuZGFsb25lIHRhZwoJcnNpbmdsZVRhZyA9IC9ePChcdyspXHMqXC8/Pig/OjxcL1wxPnwpJC8sCgoJLy8gSlNPTiBSZWdFeHAKCXJ2YWxpZGNoYXJzID0gL15bXF0sOnt9XHNdKiQvLAoJcnZhbGlkYnJhY2VzID0gLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywKCXJ2YWxpZGVzY2FwZSA9IC9cXCg/OlsiXFxcL2JmbnJ0XXx1W1xkYS1mQS1GXXs0fSkvZywKCXJ2YWxpZHRva2VucyA9IC8iW14iXFxcclxuXSoifHRydWV8ZmFsc2V8bnVsbHwtPyg/OlxkK1wufClcZCsoPzpbZUVdWystXT9cZCt8KS9nLAoKCS8vIE1hdGNoZXMgZGFzaGVkIHN0cmluZyBmb3IgY2FtZWxpemluZwoJcm1zUHJlZml4ID0gL14tbXMtLywKCXJkYXNoQWxwaGEgPSAvLShbXGRhLXpdKS9naSwKCgkvLyBVc2VkIGJ5IGpRdWVyeS5jYW1lbENhc2UgYXMgY2FsbGJhY2sgdG8gcmVwbGFjZSgpCglmY2FtZWxDYXNlID0gZnVuY3Rpb24oIGFsbCwgbGV0dGVyICkgewoJCXJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsKCX0sCgoJLy8gVGhlIHJlYWR5IGV2ZW50IGhhbmRsZXIKCWNvbXBsZXRlZCA9IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJLy8gcmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiBpcyBnb29kIGVub3VnaCBmb3IgdXMgdG8gY2FsbCB0aGUgZG9tIHJlYWR5IGluIG9sZElFCgkJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIHx8IGV2ZW50LnR5cGUgPT09ICJsb2FkIiB8fCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgewoJCQlkZXRhY2goKTsKCQkJalF1ZXJ5LnJlYWR5KCk7CgkJfQoJfSwKCS8vIENsZWFuLXVwIG1ldGhvZCBmb3IgZG9tIHJlYWR5IGV2ZW50cwoJZGV0YWNoID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICkgewoJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAiRE9NQ29udGVudExvYWRlZCIsIGNvbXBsZXRlZCwgZmFsc2UgKTsKCQkJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoKCQl9IGVsc2UgewoJCQlkb2N1bWVudC5kZXRhY2hFdmVudCggIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCApOwoJCQl3aW5kb3cuZGV0YWNoRXZlbnQoICJvbmxvYWQiLCBjb21wbGV0ZWQgKTsKCQl9Cgl9OwoKalF1ZXJ5LmZuID0galF1ZXJ5LnByb3RvdHlwZSA9IHsKCS8vIFRoZSBjdXJyZW50IHZlcnNpb24gb2YgalF1ZXJ5IGJlaW5nIHVzZWQKCWpxdWVyeTogY29yZV92ZXJzaW9uLAoKCWNvbnN0cnVjdG9yOiBqUXVlcnksCglpbml0OiBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHJvb3RqUXVlcnkgKSB7CgkJdmFyIG1hdGNoLCBlbGVtOwoKCQkvLyBIQU5ETEU6ICQoIiIpLCAkKG51bGwpLCAkKHVuZGVmaW5lZCksICQoZmFsc2UpCgkJaWYgKCAhc2VsZWN0b3IgKSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJLy8gSGFuZGxlIEhUTUwgc3RyaW5ncwoJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJaWYgKCBzZWxlY3Rvci5jaGFyQXQoMCkgPT09ICI8IiAmJiBzZWxlY3Rvci5jaGFyQXQoIHNlbGVjdG9yLmxlbmd0aCAtIDEgKSA9PT0gIj4iICYmIHNlbGVjdG9yLmxlbmd0aCA+PSAzICkgewoJCQkJLy8gQXNzdW1lIHRoYXQgc3RyaW5ncyB0aGF0IHN0YXJ0IGFuZCBlbmQgd2l0aCA8PiBhcmUgSFRNTCBhbmQgc2tpcCB0aGUgcmVnZXggY2hlY2sKCQkJCW1hdGNoID0gWyBudWxsLCBzZWxlY3RvciwgbnVsbCBdOwoKCQkJfSBlbHNlIHsKCQkJCW1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApOwoJCQl9CgoJCQkvLyBNYXRjaCBodG1sIG9yIG1ha2Ugc3VyZSBubyBjb250ZXh0IGlzIHNwZWNpZmllZCBmb3IgI2lkCgkJCWlmICggbWF0Y2ggJiYgKG1hdGNoWzFdIHx8ICFjb250ZXh0KSApIHsKCgkJCQkvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKCQkJCWlmICggbWF0Y2hbMV0gKSB7CgkJCQkJY29udGV4dCA9IGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZXh0WzBdIDogY29udGV4dDsKCgkJCQkJLy8gc2NyaXB0cyBpcyB0cnVlIGZvciBiYWNrLWNvbXBhdAoJCQkJCWpRdWVyeS5tZXJnZSggdGhpcywgalF1ZXJ5LnBhcnNlSFRNTCgKCQkJCQkJbWF0Y2hbMV0sCgkJCQkJCWNvbnRleHQgJiYgY29udGV4dC5ub2RlVHlwZSA/IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0IDogZG9jdW1lbnQsCgkJCQkJCXRydWUKCQkJCQkpICk7CgoJCQkJCS8vIEhBTkRMRTogJChodG1sLCBwcm9wcykKCQkJCQlpZiAoIHJzaW5nbGVUYWcudGVzdCggbWF0Y2hbMV0gKSAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdCggY29udGV4dCApICkgewoJCQkJCQlmb3IgKCBtYXRjaCBpbiBjb250ZXh0ICkgewoJCQkJCQkJLy8gUHJvcGVydGllcyBvZiBjb250ZXh0IGFyZSBjYWxsZWQgYXMgbWV0aG9kcyBpZiBwb3NzaWJsZQoJCQkJCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdGhpc1sgbWF0Y2ggXSApICkgewoJCQkJCQkJCXRoaXNbIG1hdGNoIF0oIGNvbnRleHRbIG1hdGNoIF0gKTsKCgkJCQkJCQkvLyAuLi5hbmQgb3RoZXJ3aXNlIHNldCBhcyBhdHRyaWJ1dGVzCgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRoaXMuYXR0ciggbWF0Y2gsIGNvbnRleHRbIG1hdGNoIF0gKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJcmV0dXJuIHRoaXM7CgoJCQkJLy8gSEFORExFOiAkKCNpZCkKCQkJCX0gZWxzZSB7CgkJCQkJZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtYXRjaFsyXSApOwoKCQkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMKCQkJCQlpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCQkvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUgYW5kIE9wZXJhIHJldHVybiBpdGVtcwoJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJaWYgKCBlbGVtLmlkICE9PSBtYXRjaFsyXSApIHsKCQkJCQkJCXJldHVybiByb290alF1ZXJ5LmZpbmQoIHNlbGVjdG9yICk7CgkJCQkJCX0KCgkJCQkJCS8vIE90aGVyd2lzZSwgd2UgaW5qZWN0IHRoZSBlbGVtZW50IGRpcmVjdGx5IGludG8gdGhlIGpRdWVyeSBvYmplY3QKCQkJCQkJdGhpcy5sZW5ndGggPSAxOwoJCQkJCQl0aGlzWzBdID0gZWxlbTsKCQkJCQl9CgoJCQkJCXRoaXMuY29udGV4dCA9IGRvY3VtZW50OwoJCQkJCXRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCgkJCS8vIEhBTkRMRTogJChleHByLCAkKC4uLikpCgkJCX0gZWxzZSBpZiAoICFjb250ZXh0IHx8IGNvbnRleHQuanF1ZXJ5ICkgewoJCQkJcmV0dXJuICggY29udGV4dCB8fCByb290alF1ZXJ5ICkuZmluZCggc2VsZWN0b3IgKTsKCgkJCS8vIEhBTkRMRTogJChleHByLCBjb250ZXh0KQoJCQkvLyAod2hpY2ggaXMganVzdCBlcXVpdmFsZW50IHRvOiAkKGNvbnRleHQpLmZpbmQoZXhwcikKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yKCBjb250ZXh0ICkuZmluZCggc2VsZWN0b3IgKTsKCQkJfQoKCQkvLyBIQU5ETEU6ICQoRE9NRWxlbWVudCkKCQl9IGVsc2UgaWYgKCBzZWxlY3Rvci5ub2RlVHlwZSApIHsKCQkJdGhpcy5jb250ZXh0ID0gdGhpc1swXSA9IHNlbGVjdG9yOwoJCQl0aGlzLmxlbmd0aCA9IDE7CgkJCXJldHVybiB0aGlzOwoKCQkvLyBIQU5ETEU6ICQoZnVuY3Rpb24pCgkJLy8gU2hvcnRjdXQgZm9yIGRvY3VtZW50IHJlYWR5CgkJfSBlbHNlIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHNlbGVjdG9yICkgKSB7CgkJCXJldHVybiByb290alF1ZXJ5LnJlYWR5KCBzZWxlY3RvciApOwoJCX0KCgkJaWYgKCBzZWxlY3Rvci5zZWxlY3RvciAhPT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3Iuc2VsZWN0b3I7CgkJCXRoaXMuY29udGV4dCA9IHNlbGVjdG9yLmNvbnRleHQ7CgkJfQoKCQlyZXR1cm4galF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IsIHRoaXMgKTsKCX0sCgoJLy8gU3RhcnQgd2l0aCBhbiBlbXB0eSBzZWxlY3RvcgoJc2VsZWN0b3I6ICIiLAoKCS8vIFRoZSBkZWZhdWx0IGxlbmd0aCBvZiBhIGpRdWVyeSBvYmplY3QgaXMgMAoJbGVuZ3RoOiAwLAoKCS8vIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgY29udGFpbmVkIGluIHRoZSBtYXRjaGVkIGVsZW1lbnQgc2V0CglzaXplOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5sZW5ndGg7Cgl9LAoKCXRvQXJyYXk6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBjb3JlX3NsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUgoJLy8gR2V0IHRoZSB3aG9sZSBtYXRjaGVkIGVsZW1lbnQgc2V0IGFzIGEgY2xlYW4gYXJyYXkKCWdldDogZnVuY3Rpb24oIG51bSApIHsKCQlyZXR1cm4gbnVtID09IG51bGwgPwoKCQkJLy8gUmV0dXJuIGEgJ2NsZWFuJyBhcnJheQoJCQl0aGlzLnRvQXJyYXkoKSA6CgoJCQkvLyBSZXR1cm4ganVzdCB0aGUgb2JqZWN0CgkJCSggbnVtIDwgMCA/IHRoaXNbIHRoaXMubGVuZ3RoICsgbnVtIF0gOiB0aGlzWyBudW0gXSApOwoJfSwKCgkvLyBUYWtlIGFuIGFycmF5IG9mIGVsZW1lbnRzIGFuZCBwdXNoIGl0IG9udG8gdGhlIHN0YWNrCgkvLyAocmV0dXJuaW5nIHRoZSBuZXcgbWF0Y2hlZCBlbGVtZW50IHNldCkKCXB1c2hTdGFjazogZnVuY3Rpb24oIGVsZW1zICkgewoKCQkvLyBCdWlsZCBhIG5ldyBqUXVlcnkgbWF0Y2hlZCBlbGVtZW50IHNldAoJCXZhciByZXQgPSBqUXVlcnkubWVyZ2UoIHRoaXMuY29uc3RydWN0b3IoKSwgZWxlbXMgKTsKCgkJLy8gQWRkIHRoZSBvbGQgb2JqZWN0IG9udG8gdGhlIHN0YWNrIChhcyBhIHJlZmVyZW5jZSkKCQlyZXQucHJldk9iamVjdCA9IHRoaXM7CgkJcmV0LmNvbnRleHQgPSB0aGlzLmNvbnRleHQ7CgoJCS8vIFJldHVybiB0aGUgbmV3bHktZm9ybWVkIGVsZW1lbnQgc2V0CgkJcmV0dXJuIHJldDsKCX0sCgoJLy8gRXhlY3V0ZSBhIGNhbGxiYWNrIGZvciBldmVyeSBlbGVtZW50IGluIHRoZSBtYXRjaGVkIHNldC4KCS8vIChZb3UgY2FuIHNlZWQgdGhlIGFyZ3VtZW50cyB3aXRoIGFuIGFycmF5IG9mIGFyZ3MsIGJ1dCB0aGlzIGlzCgkvLyBvbmx5IHVzZWQgaW50ZXJuYWxseS4pCgllYWNoOiBmdW5jdGlvbiggY2FsbGJhY2ssIGFyZ3MgKSB7CgkJcmV0dXJuIGpRdWVyeS5lYWNoKCB0aGlzLCBjYWxsYmFjaywgYXJncyApOwoJfSwKCglyZWFkeTogZnVuY3Rpb24oIGZuICkgewoJCS8vIEFkZCB0aGUgY2FsbGJhY2sKCQlqUXVlcnkucmVhZHkucHJvbWlzZSgpLmRvbmUoIGZuICk7CgoJCXJldHVybiB0aGlzOwoJfSwKCglzbGljZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBjb3JlX3NsaWNlLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSApOwoJfSwKCglmaXJzdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZXEoIDAgKTsKCX0sCgoJbGFzdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZXEoIC0xICk7Cgl9LAoKCWVxOiBmdW5jdGlvbiggaSApIHsKCQl2YXIgbGVuID0gdGhpcy5sZW5ndGgsCgkJCWogPSAraSArICggaSA8IDAgPyBsZW4gOiAwICk7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqID49IDAgJiYgaiA8IGxlbiA/IFsgdGhpc1tqXSBdIDogW10gKTsKCX0sCgoJbWFwOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gY2FsbGJhY2suY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCX0pKTsKCX0sCgoJZW5kOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IobnVsbCk7Cgl9LAoKCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCS8vIEJlaGF2ZXMgbGlrZSBhbiBBcnJheSdzIG1ldGhvZCwgbm90IGxpa2UgYSBqUXVlcnkgbWV0aG9kLgoJcHVzaDogY29yZV9wdXNoLAoJc29ydDogW10uc29ydCwKCXNwbGljZTogW10uc3BsaWNlCn07CgovLyBHaXZlIHRoZSBpbml0IGZ1bmN0aW9uIHRoZSBqUXVlcnkgcHJvdG90eXBlIGZvciBsYXRlciBpbnN0YW50aWF0aW9uCmpRdWVyeS5mbi5pbml0LnByb3RvdHlwZSA9IGpRdWVyeS5mbjsKCmpRdWVyeS5leHRlbmQgPSBqUXVlcnkuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7Cgl2YXIgc3JjLCBjb3B5SXNBcnJheSwgY29weSwgbmFtZSwgb3B0aW9ucywgY2xvbmUsCgkJdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAoJCWkgPSAxLAoJCWxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCgkJZGVlcCA9IGZhbHNlOwoKCS8vIEhhbmRsZSBhIGRlZXAgY29weSBzaXR1YXRpb24KCWlmICggdHlwZW9mIHRhcmdldCA9PT0gImJvb2xlYW4iICkgewoJCWRlZXAgPSB0YXJnZXQ7CgkJdGFyZ2V0ID0gYXJndW1lbnRzWzFdIHx8IHt9OwoJCS8vIHNraXAgdGhlIGJvb2xlYW4gYW5kIHRoZSB0YXJnZXQKCQlpID0gMjsKCX0KCgkvLyBIYW5kbGUgY2FzZSB3aGVuIHRhcmdldCBpcyBhIHN0cmluZyBvciBzb21ldGhpbmcgKHBvc3NpYmxlIGluIGRlZXAgY29weSkKCWlmICggdHlwZW9mIHRhcmdldCAhPT0gIm9iamVjdCIgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKHRhcmdldCkgKSB7CgkJdGFyZ2V0ID0ge307Cgl9CgoJLy8gZXh0ZW5kIGpRdWVyeSBpdHNlbGYgaWYgb25seSBvbmUgYXJndW1lbnQgaXMgcGFzc2VkCglpZiAoIGxlbmd0aCA9PT0gaSApIHsKCQl0YXJnZXQgPSB0aGlzOwoJCS0taTsKCX0KCglmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkvLyBPbmx5IGRlYWwgd2l0aCBub24tbnVsbC91bmRlZmluZWQgdmFsdWVzCgkJaWYgKCAob3B0aW9ucyA9IGFyZ3VtZW50c1sgaSBdKSAhPSBudWxsICkgewoJCQkvLyBFeHRlbmQgdGhlIGJhc2Ugb2JqZWN0CgkJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJCXNyYyA9IHRhcmdldFsgbmFtZSBdOwoJCQkJY29weSA9IG9wdGlvbnNbIG5hbWUgXTsKCgkJCQkvLyBQcmV2ZW50IG5ldmVyLWVuZGluZyBsb29wCgkJCQlpZiAoIHRhcmdldCA9PT0gY29weSApIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQkvLyBSZWN1cnNlIGlmIHdlJ3JlIG1lcmdpbmcgcGxhaW4gb2JqZWN0cyBvciBhcnJheXMKCQkJCWlmICggZGVlcCAmJiBjb3B5ICYmICggalF1ZXJ5LmlzUGxhaW5PYmplY3QoY29weSkgfHwgKGNvcHlJc0FycmF5ID0galF1ZXJ5LmlzQXJyYXkoY29weSkpICkgKSB7CgkJCQkJaWYgKCBjb3B5SXNBcnJheSApIHsKCQkJCQkJY29weUlzQXJyYXkgPSBmYWxzZTsKCQkJCQkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzQXJyYXkoc3JjKSA/IHNyYyA6IFtdOwoKCQkJCQl9IGVsc2UgewoJCQkJCQljbG9uZSA9IHNyYyAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdChzcmMpID8gc3JjIDoge307CgkJCQkJfQoKCQkJCQkvLyBOZXZlciBtb3ZlIG9yaWdpbmFsIG9iamVjdHMsIGNsb25lIHRoZW0KCQkJCQl0YXJnZXRbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGRlZXAsIGNsb25lLCBjb3B5ICk7CgoJCQkJLy8gRG9uJ3QgYnJpbmcgaW4gdW5kZWZpbmVkIHZhbHVlcwoJCQkJfSBlbHNlIGlmICggY29weSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXRhcmdldFsgbmFtZSBdID0gY29weTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBSZXR1cm4gdGhlIG1vZGlmaWVkIG9iamVjdAoJcmV0dXJuIHRhcmdldDsKfTsKCmpRdWVyeS5leHRlbmQoewoJbm9Db25mbGljdDogZnVuY3Rpb24oIGRlZXAgKSB7CgkJaWYgKCB3aW5kb3cuJCA9PT0galF1ZXJ5ICkgewoJCQl3aW5kb3cuJCA9IF8kOwoJCX0KCgkJaWYgKCBkZWVwICYmIHdpbmRvdy5qUXVlcnkgPT09IGpRdWVyeSApIHsKCQkJd2luZG93LmpRdWVyeSA9IF9qUXVlcnk7CgkJfQoKCQlyZXR1cm4galF1ZXJ5OwoJfSwKCgkvLyBJcyB0aGUgRE9NIHJlYWR5IHRvIGJlIHVzZWQ/IFNldCB0byB0cnVlIG9uY2UgaXQgb2NjdXJzLgoJaXNSZWFkeTogZmFsc2UsCgoJLy8gQSBjb3VudGVyIHRvIHRyYWNrIGhvdyBtYW55IGl0ZW1zIHRvIHdhaXQgZm9yIGJlZm9yZQoJLy8gdGhlIHJlYWR5IGV2ZW50IGZpcmVzLiBTZWUgIzY3ODEKCXJlYWR5V2FpdDogMSwKCgkvLyBIb2xkIChvciByZWxlYXNlKSB0aGUgcmVhZHkgZXZlbnQKCWhvbGRSZWFkeTogZnVuY3Rpb24oIGhvbGQgKSB7CgkJaWYgKCBob2xkICkgewoJCQlqUXVlcnkucmVhZHlXYWl0Kys7CgkJfSBlbHNlIHsKCQkJalF1ZXJ5LnJlYWR5KCB0cnVlICk7CgkJfQoJfSwKCgkvLyBIYW5kbGUgd2hlbiB0aGUgRE9NIGlzIHJlYWR5CglyZWFkeTogZnVuY3Rpb24oIHdhaXQgKSB7CgoJCS8vIEFib3J0IGlmIHRoZXJlIGFyZSBwZW5kaW5nIGhvbGRzIG9yIHdlJ3JlIGFscmVhZHkgcmVhZHkKCQlpZiAoIHdhaXQgPT09IHRydWUgPyAtLWpRdWVyeS5yZWFkeVdhaXQgOiBqUXVlcnkuaXNSZWFkeSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIGJvZHkgZXhpc3RzLCBhdCBsZWFzdCwgaW4gY2FzZSBJRSBnZXRzIGEgbGl0dGxlIG92ZXJ6ZWFsb3VzICh0aWNrZXQgIzU0NDMpLgoJCWlmICggIWRvY3VtZW50LmJvZHkgKSB7CgkJCXJldHVybiBzZXRUaW1lb3V0KCBqUXVlcnkucmVhZHkgKTsKCQl9CgoJCS8vIFJlbWVtYmVyIHRoYXQgdGhlIERPTSBpcyByZWFkeQoJCWpRdWVyeS5pc1JlYWR5ID0gdHJ1ZTsKCgkJLy8gSWYgYSBub3JtYWwgRE9NIFJlYWR5IGV2ZW50IGZpcmVkLCBkZWNyZW1lbnQsIGFuZCB3YWl0IGlmIG5lZWQgYmUKCQlpZiAoIHdhaXQgIT09IHRydWUgJiYgLS1qUXVlcnkucmVhZHlXYWl0ID4gMCApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gSWYgdGhlcmUgYXJlIGZ1bmN0aW9ucyBib3VuZCwgdG8gZXhlY3V0ZQoJCXJlYWR5TGlzdC5yZXNvbHZlV2l0aCggZG9jdW1lbnQsIFsgalF1ZXJ5IF0gKTsKCgkJLy8gVHJpZ2dlciBhbnkgYm91bmQgcmVhZHkgZXZlbnRzCgkJaWYgKCBqUXVlcnkuZm4udHJpZ2dlciApIHsKCQkJalF1ZXJ5KCBkb2N1bWVudCApLnRyaWdnZXIoInJlYWR5Iikub2ZmKCJyZWFkeSIpOwoJCX0KCX0sCgoJLy8gU2VlIHRlc3QvdW5pdC9jb3JlLmpzIGZvciBkZXRhaWxzIGNvbmNlcm5pbmcgaXNGdW5jdGlvbi4KCS8vIFNpbmNlIHZlcnNpb24gMS4zLCBET00gbWV0aG9kcyBhbmQgZnVuY3Rpb25zIGxpa2UgYWxlcnQKCS8vIGFyZW4ndCBzdXBwb3J0ZWQuIFRoZXkgcmV0dXJuIGZhbHNlIG9uIElFICgjMjk2OCkuCglpc0Z1bmN0aW9uOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiZnVuY3Rpb24iOwoJfSwKCglpc0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKCBvYmogKSB7CgkJcmV0dXJuIGpRdWVyeS50eXBlKG9iaikgPT09ICJhcnJheSI7Cgl9LAoKCWlzV2luZG93OiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT0gb2JqLndpbmRvdzsKCX0sCgoJaXNOdW1lcmljOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiAhaXNOYU4oIHBhcnNlRmxvYXQob2JqKSApICYmIGlzRmluaXRlKCBvYmogKTsKCX0sCgoJdHlwZTogZnVuY3Rpb24oIG9iaiApIHsKCQlpZiAoIG9iaiA9PSBudWxsICkgewoJCQlyZXR1cm4gU3RyaW5nKCBvYmogKTsKCQl9CgkJcmV0dXJuIHR5cGVvZiBvYmogPT09ICJvYmplY3QiIHx8IHR5cGVvZiBvYmogPT09ICJmdW5jdGlvbiIgPwoJCQljbGFzczJ0eXBlWyBjb3JlX3RvU3RyaW5nLmNhbGwob2JqKSBdIHx8ICJvYmplY3QiIDoKCQkJdHlwZW9mIG9iajsKCX0sCgoJaXNQbGFpbk9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBNdXN0IGJlIGFuIE9iamVjdC4KCQkvLyBCZWNhdXNlIG9mIElFLCB3ZSBhbHNvIGhhdmUgdG8gY2hlY2sgdGhlIHByZXNlbmNlIG9mIHRoZSBjb25zdHJ1Y3RvciBwcm9wZXJ0eS4KCQkvLyBNYWtlIHN1cmUgdGhhdCBET00gbm9kZXMgYW5kIHdpbmRvdyBvYmplY3RzIGRvbid0IHBhc3MgdGhyb3VnaCwgYXMgd2VsbAoJCWlmICggIW9iaiB8fCBqUXVlcnkudHlwZShvYmopICE9PSAib2JqZWN0IiB8fCBvYmoubm9kZVR5cGUgfHwgalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJdHJ5IHsKCQkJLy8gTm90IG93biBjb25zdHJ1Y3RvciBwcm9wZXJ0eSBtdXN0IGJlIE9iamVjdAoJCQlpZiAoIG9iai5jb25zdHJ1Y3RvciAmJgoJCQkJIWNvcmVfaGFzT3duLmNhbGwob2JqLCAiY29uc3RydWN0b3IiKSAmJgoJCQkJIWNvcmVfaGFzT3duLmNhbGwob2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgImlzUHJvdG90eXBlT2YiKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0gY2F0Y2ggKCBlICkgewoJCQkvLyBJRTgsOSBXaWxsIHRocm93IGV4Y2VwdGlvbnMgb24gY2VydGFpbiBob3N0IG9iamVjdHMgIzk4OTcKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gT3duIHByb3BlcnRpZXMgYXJlIGVudW1lcmF0ZWQgZmlyc3RseSwgc28gdG8gc3BlZWQgdXAsCgkJLy8gaWYgbGFzdCBvbmUgaXMgb3duLCB0aGVuIGFsbCBwcm9wZXJ0aWVzIGFyZSBvd24uCgoJCXZhciBrZXk7CgkJZm9yICgga2V5IGluIG9iaiApIHt9CgoJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCBjb3JlX2hhc093bi5jYWxsKCBvYmosIGtleSApOwoJfSwKCglpc0VtcHR5T2JqZWN0OiBmdW5jdGlvbiggb2JqICkgewoJCXZhciBuYW1lOwoJCWZvciAoIG5hbWUgaW4gb2JqICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXJldHVybiB0cnVlOwoJfSwKCgllcnJvcjogZnVuY3Rpb24oIG1zZyApIHsKCQl0aHJvdyBuZXcgRXJyb3IoIG1zZyApOwoJfSwKCgkvLyBkYXRhOiBzdHJpbmcgb2YgaHRtbAoJLy8gY29udGV4dCAob3B0aW9uYWwpOiBJZiBzcGVjaWZpZWQsIHRoZSBmcmFnbWVudCB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhpcyBjb250ZXh0LCBkZWZhdWx0cyB0byBkb2N1bWVudAoJLy8ga2VlcFNjcmlwdHMgKG9wdGlvbmFsKTogSWYgdHJ1ZSwgd2lsbCBpbmNsdWRlIHNjcmlwdHMgcGFzc2VkIGluIHRoZSBodG1sIHN0cmluZwoJcGFyc2VIVE1MOiBmdW5jdGlvbiggZGF0YSwgY29udGV4dCwga2VlcFNjcmlwdHMgKSB7CgkJaWYgKCAhZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCQlpZiAoIHR5cGVvZiBjb250ZXh0ID09PSAiYm9vbGVhbiIgKSB7CgkJCWtlZXBTY3JpcHRzID0gY29udGV4dDsKCQkJY29udGV4dCA9IGZhbHNlOwoJCX0KCQljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCgkJdmFyIHBhcnNlZCA9IHJzaW5nbGVUYWcuZXhlYyggZGF0YSApLAoJCQlzY3JpcHRzID0gIWtlZXBTY3JpcHRzICYmIFtdOwoKCQkvLyBTaW5nbGUgdGFnCgkJaWYgKCBwYXJzZWQgKSB7CgkJCXJldHVybiBbIGNvbnRleHQuY3JlYXRlRWxlbWVudCggcGFyc2VkWzFdICkgXTsKCQl9CgoJCXBhcnNlZCA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBbIGRhdGEgXSwgY29udGV4dCwgc2NyaXB0cyApOwoJCWlmICggc2NyaXB0cyApIHsKCQkJalF1ZXJ5KCBzY3JpcHRzICkucmVtb3ZlKCk7CgkJfQoJCXJldHVybiBqUXVlcnkubWVyZ2UoIFtdLCBwYXJzZWQuY2hpbGROb2RlcyApOwoJfSwKCglwYXJzZUpTT046IGZ1bmN0aW9uKCBkYXRhICkgewoJCS8vIEF0dGVtcHQgdG8gcGFyc2UgdXNpbmcgdGhlIG5hdGl2ZSBKU09OIHBhcnNlciBmaXJzdAoJCWlmICggd2luZG93LkpTT04gJiYgd2luZG93LkpTT04ucGFyc2UgKSB7CgkJCXJldHVybiB3aW5kb3cuSlNPTi5wYXJzZSggZGF0YSApOwoJCX0KCgkJaWYgKCBkYXRhID09PSBudWxsICkgewoJCQlyZXR1cm4gZGF0YTsKCQl9CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoKCQkJLy8gTWFrZSBzdXJlIGxlYWRpbmcvdHJhaWxpbmcgd2hpdGVzcGFjZSBpcyByZW1vdmVkIChJRSBjYW4ndCBoYW5kbGUgaXQpCgkJCWRhdGEgPSBqUXVlcnkudHJpbSggZGF0YSApOwoKCQkJaWYgKCBkYXRhICkgewoJCQkJLy8gTWFrZSBzdXJlIHRoZSBpbmNvbWluZyBkYXRhIGlzIGFjdHVhbCBKU09OCgkJCQkvLyBMb2dpYyBib3Jyb3dlZCBmcm9tIGh0dHA6Ly9qc29uLm9yZy9qc29uMi5qcwoJCQkJaWYgKCBydmFsaWRjaGFycy50ZXN0KCBkYXRhLnJlcGxhY2UoIHJ2YWxpZGVzY2FwZSwgIkAiICkKCQkJCQkucmVwbGFjZSggcnZhbGlkdG9rZW5zLCAiXSIgKQoJCQkJCS5yZXBsYWNlKCBydmFsaWRicmFjZXMsICIiKSkgKSB7CgoJCQkJCXJldHVybiAoIG5ldyBGdW5jdGlvbiggInJldHVybiAiICsgZGF0YSApICkoKTsKCQkJCX0KCQkJfQoJCX0KCgkJalF1ZXJ5LmVycm9yKCAiSW52YWxpZCBKU09OOiAiICsgZGF0YSApOwoJfSwKCgkvLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nCglwYXJzZVhNTDogZnVuY3Rpb24oIGRhdGEgKSB7CgkJdmFyIHhtbCwgdG1wOwoJCWlmICggIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJdHJ5IHsKCQkJaWYgKCB3aW5kb3cuRE9NUGFyc2VyICkgeyAvLyBTdGFuZGFyZAoJCQkJdG1wID0gbmV3IERPTVBhcnNlcigpOwoJCQkJeG1sID0gdG1wLnBhcnNlRnJvbVN0cmluZyggZGF0YSAsICJ0ZXh0L3htbCIgKTsKCQkJfSBlbHNlIHsgLy8gSUUKCQkJCXhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCAiTWljcm9zb2Z0LlhNTERPTSIgKTsKCQkJCXhtbC5hc3luYyA9ICJmYWxzZSI7CgkJCQl4bWwubG9hZFhNTCggZGF0YSApOwoJCQl9CgkJfSBjYXRjaCggZSApIHsKCQkJeG1sID0gdW5kZWZpbmVkOwoJCX0KCQlpZiAoICF4bWwgfHwgIXhtbC5kb2N1bWVudEVsZW1lbnQgfHwgeG1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAicGFyc2VyZXJyb3IiICkubGVuZ3RoICkgewoJCQlqUXVlcnkuZXJyb3IoICJJbnZhbGlkIFhNTDogIiArIGRhdGEgKTsKCQl9CgkJcmV0dXJuIHhtbDsKCX0sCgoJbm9vcDogZnVuY3Rpb24oKSB7fSwKCgkvLyBFdmFsdWF0ZXMgYSBzY3JpcHQgaW4gYSBnbG9iYWwgY29udGV4dAoJLy8gV29ya2Fyb3VuZHMgYmFzZWQgb24gZmluZGluZ3MgYnkgSmltIERyaXNjb2xsCgkvLyBodHRwOi8vd2VibG9ncy5qYXZhLm5ldC9ibG9nL2RyaXNjb2xsL2FyY2hpdmUvMjAwOS8wOS8wOC9ldmFsLWphdmFzY3JpcHQtZ2xvYmFsLWNvbnRleHQKCWdsb2JhbEV2YWw6IGZ1bmN0aW9uKCBkYXRhICkgewoJCWlmICggZGF0YSAmJiBqUXVlcnkudHJpbSggZGF0YSApICkgewoJCQkvLyBXZSB1c2UgZXhlY1NjcmlwdCBvbiBJbnRlcm5ldCBFeHBsb3JlcgoJCQkvLyBXZSB1c2UgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHNvIHRoYXQgY29udGV4dCBpcyB3aW5kb3cKCQkJLy8gcmF0aGVyIHRoYW4galF1ZXJ5IGluIEZpcmVmb3gKCQkJKCB3aW5kb3cuZXhlY1NjcmlwdCB8fCBmdW5jdGlvbiggZGF0YSApIHsKCQkJCXdpbmRvd1sgImV2YWwiIF0uY2FsbCggd2luZG93LCBkYXRhICk7CgkJCX0gKSggZGF0YSApOwoJCX0KCX0sCgoJLy8gQ29udmVydCBkYXNoZWQgdG8gY2FtZWxDYXNlOyB1c2VkIGJ5IHRoZSBjc3MgYW5kIGRhdGEgbW9kdWxlcwoJLy8gTWljcm9zb2Z0IGZvcmdvdCB0byBodW1wIHRoZWlyIHZlbmRvciBwcmVmaXggKCM5NTcyKQoJY2FtZWxDYXNlOiBmdW5jdGlvbiggc3RyaW5nICkgewoJCXJldHVybiBzdHJpbmcucmVwbGFjZSggcm1zUHJlZml4LCAibXMtIiApLnJlcGxhY2UoIHJkYXNoQWxwaGEsIGZjYW1lbENhc2UgKTsKCX0sCgoJbm9kZU5hbWU6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCXJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJfSwKCgkvLyBhcmdzIGlzIGZvciBpbnRlcm5hbCB1c2FnZSBvbmx5CgllYWNoOiBmdW5jdGlvbiggb2JqLCBjYWxsYmFjaywgYXJncyApIHsKCQl2YXIgdmFsdWUsCgkJCWkgPSAwLAoJCQlsZW5ndGggPSBvYmoubGVuZ3RoLAoJCQlpc0FycmF5ID0gaXNBcnJheWxpa2UoIG9iaiApOwoKCQlpZiAoIGFyZ3MgKSB7CgkJCWlmICggaXNBcnJheSApIHsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suYXBwbHkoIG9ialsgaSBdLCBhcmdzICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpIGluIG9iaiApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmFwcGx5KCBvYmpbIGkgXSwgYXJncyApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIEEgc3BlY2lhbCwgZmFzdCwgY2FzZSBmb3IgdGhlIG1vc3QgY29tbW9uIHVzZSBvZiBlYWNoCgkJfSBlbHNlIHsKCQkJaWYgKCBpc0FycmF5ICkgewoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQkJdmFsdWUgPSBjYWxsYmFjay5jYWxsKCBvYmpbIGkgXSwgaSwgb2JqWyBpIF0gKTsKCgkJCQkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWZvciAoIGkgaW4gb2JqICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suY2FsbCggb2JqWyBpIF0sIGksIG9ialsgaSBdICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBvYmo7Cgl9LAoKCS8vIFVzZSBuYXRpdmUgU3RyaW5nLnRyaW0gZnVuY3Rpb24gd2hlcmV2ZXIgcG9zc2libGUKCXRyaW06IGNvcmVfdHJpbSAmJiAhY29yZV90cmltLmNhbGwoIlx1RkVGRlx4QTAiKSA/CgkJZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiB0ZXh0ID09IG51bGwgPwoJCQkJIiIgOgoJCQkJY29yZV90cmltLmNhbGwoIHRleHQgKTsKCQl9IDoKCgkJLy8gT3RoZXJ3aXNlIHVzZSBvdXIgb3duIHRyaW1taW5nIGZ1bmN0aW9uYWxpdHkKCQlmdW5jdGlvbiggdGV4dCApIHsKCQkJcmV0dXJuIHRleHQgPT0gbnVsbCA/CgkJCQkiIiA6CgkJCQkoIHRleHQgKyAiIiApLnJlcGxhY2UoIHJ0cmltLCAiIiApOwoJCX0sCgoJLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJbWFrZUFycmF5OiBmdW5jdGlvbiggYXJyLCByZXN1bHRzICkgewoJCXZhciByZXQgPSByZXN1bHRzIHx8IFtdOwoKCQlpZiAoIGFyciAhPSBudWxsICkgewoJCQlpZiAoIGlzQXJyYXlsaWtlKCBPYmplY3QoYXJyKSApICkgewoJCQkJalF1ZXJ5Lm1lcmdlKCByZXQsCgkJCQkJdHlwZW9mIGFyciA9PT0gInN0cmluZyIgPwoJCQkJCVsgYXJyIF0gOiBhcnIKCQkJCSk7CgkJCX0gZWxzZSB7CgkJCQljb3JlX3B1c2guY2FsbCggcmV0LCBhcnIgKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX0sCgoJaW5BcnJheTogZnVuY3Rpb24oIGVsZW0sIGFyciwgaSApIHsKCQl2YXIgbGVuOwoKCQlpZiAoIGFyciApIHsKCQkJaWYgKCBjb3JlX2luZGV4T2YgKSB7CgkJCQlyZXR1cm4gY29yZV9pbmRleE9mLmNhbGwoIGFyciwgZWxlbSwgaSApOwoJCQl9CgoJCQlsZW4gPSBhcnIubGVuZ3RoOwoJCQlpID0gaSA/IGkgPCAwID8gTWF0aC5tYXgoIDAsIGxlbiArIGkgKSA6IGkgOiAwOwoKCQkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCQkvLyBTa2lwIGFjY2Vzc2luZyBpbiBzcGFyc2UgYXJyYXlzCgkJCQlpZiAoIGkgaW4gYXJyICYmIGFyclsgaSBdID09PSBlbGVtICkgewoJCQkJCXJldHVybiBpOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gLTE7Cgl9LAoKCW1lcmdlOiBmdW5jdGlvbiggZmlyc3QsIHNlY29uZCApIHsKCQl2YXIgbCA9IHNlY29uZC5sZW5ndGgsCgkJCWkgPSBmaXJzdC5sZW5ndGgsCgkJCWogPSAwOwoKCQlpZiAoIHR5cGVvZiBsID09PSAibnVtYmVyIiApIHsKCQkJZm9yICggOyBqIDwgbDsgaisrICkgewoJCQkJZmlyc3RbIGkrKyBdID0gc2Vjb25kWyBqIF07CgkJCX0KCQl9IGVsc2UgewoJCQl3aGlsZSAoIHNlY29uZFtqXSAhPT0gdW5kZWZpbmVkICkgewoJCQkJZmlyc3RbIGkrKyBdID0gc2Vjb25kWyBqKysgXTsKCQkJfQoJCX0KCgkJZmlyc3QubGVuZ3RoID0gaTsKCgkJcmV0dXJuIGZpcnN0OwoJfSwKCglncmVwOiBmdW5jdGlvbiggZWxlbXMsIGNhbGxiYWNrLCBpbnYgKSB7CgkJdmFyIHJldFZhbCwKCQkJcmV0ID0gW10sCgkJCWkgPSAwLAoJCQlsZW5ndGggPSBlbGVtcy5sZW5ndGg7CgkJaW52ID0gISFpbnY7CgoJCS8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCBvbmx5IHNhdmluZyB0aGUgaXRlbXMKCQkvLyB0aGF0IHBhc3MgdGhlIHZhbGlkYXRvciBmdW5jdGlvbgoJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQlyZXRWYWwgPSAhIWNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpICk7CgkJCWlmICggaW52ICE9PSByZXRWYWwgKSB7CgkJCQlyZXQucHVzaCggZWxlbXNbIGkgXSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gcmV0OwoJfSwKCgkvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKCW1hcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgYXJnICkgewoJCXZhciB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBlbGVtcyApLAoJCQlyZXQgPSBbXTsKCgkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIHRyYW5zbGF0aW5nIGVhY2ggb2YgdGhlIGl0ZW1zIHRvIHRoZWlyCgkJaWYgKCBpc0FycmF5ICkgewoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgoJCS8vIEdvIHRocm91Z2ggZXZlcnkga2V5IG9uIHRoZSBvYmplY3QsCgkJfSBlbHNlIHsKCQkJZm9yICggaSBpbiBlbGVtcyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCgkJcmV0dXJuIGNvcmVfY29uY2F0LmFwcGx5KCBbXSwgcmV0ICk7Cgl9LAoKCS8vIEEgZ2xvYmFsIEdVSUQgY291bnRlciBmb3Igb2JqZWN0cwoJZ3VpZDogMSwKCgkvLyBCaW5kIGEgZnVuY3Rpb24gdG8gYSBjb250ZXh0LCBvcHRpb25hbGx5IHBhcnRpYWxseSBhcHBseWluZyBhbnkKCS8vIGFyZ3VtZW50cy4KCXByb3h5OiBmdW5jdGlvbiggZm4sIGNvbnRleHQgKSB7CgkJdmFyIGFyZ3MsIHByb3h5LCB0bXA7CgoJCWlmICggdHlwZW9mIGNvbnRleHQgPT09ICJzdHJpbmciICkgewoJCQl0bXAgPSBmblsgY29udGV4dCBdOwoJCQljb250ZXh0ID0gZm47CgkJCWZuID0gdG1wOwoJCX0KCgkJLy8gUXVpY2sgY2hlY2sgdG8gZGV0ZXJtaW5lIGlmIHRhcmdldCBpcyBjYWxsYWJsZSwgaW4gdGhlIHNwZWMKCQkvLyB0aGlzIHRocm93cyBhIFR5cGVFcnJvciwgYnV0IHdlIHdpbGwganVzdCByZXR1cm4gdW5kZWZpbmVkLgoJCWlmICggIWpRdWVyeS5pc0Z1bmN0aW9uKCBmbiApICkgewoJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCX0KCgkJLy8gU2ltdWxhdGVkIGJpbmQKCQlhcmdzID0gY29yZV9zbGljZS5jYWxsKCBhcmd1bWVudHMsIDIgKTsKCQlwcm94eSA9IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gZm4uYXBwbHkoIGNvbnRleHQgfHwgdGhpcywgYXJncy5jb25jYXQoIGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzICkgKSApOwoJCX07CgoJCS8vIFNldCB0aGUgZ3VpZCBvZiB1bmlxdWUgaGFuZGxlciB0byB0aGUgc2FtZSBvZiBvcmlnaW5hbCBoYW5kbGVyLCBzbyBpdCBjYW4gYmUgcmVtb3ZlZAoJCXByb3h5Lmd1aWQgPSBmbi5ndWlkID0gZm4uZ3VpZCB8fCBqUXVlcnkuZ3VpZCsrOwoKCQlyZXR1cm4gcHJveHk7Cgl9LAoKCS8vIE11bHRpZnVuY3Rpb25hbCBtZXRob2QgdG8gZ2V0IGFuZCBzZXQgdmFsdWVzIG9mIGEgY29sbGVjdGlvbgoJLy8gVGhlIHZhbHVlL3MgY2FuIG9wdGlvbmFsbHkgYmUgZXhlY3V0ZWQgaWYgaXQncyBhIGZ1bmN0aW9uCglhY2Nlc3M6IGZ1bmN0aW9uKCBlbGVtcywgZm4sIGtleSwgdmFsdWUsIGNoYWluYWJsZSwgZW1wdHlHZXQsIHJhdyApIHsKCQl2YXIgaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJYnVsayA9IGtleSA9PSBudWxsOwoKCQkvLyBTZXRzIG1hbnkgdmFsdWVzCgkJaWYgKCBqUXVlcnkudHlwZSgga2V5ICkgPT09ICJvYmplY3QiICkgewoJCQljaGFpbmFibGUgPSB0cnVlOwoJCQlmb3IgKCBpIGluIGtleSApIHsKCQkJCWpRdWVyeS5hY2Nlc3MoIGVsZW1zLCBmbiwgaSwga2V5W2ldLCB0cnVlLCBlbXB0eUdldCwgcmF3ICk7CgkJCX0KCgkJLy8gU2V0cyBvbmUgdmFsdWUKCQl9IGVsc2UgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQljaGFpbmFibGUgPSB0cnVlOwoKCQkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCQlyYXcgPSB0cnVlOwoJCQl9CgoJCQlpZiAoIGJ1bGsgKSB7CgkJCQkvLyBCdWxrIG9wZXJhdGlvbnMgcnVuIGFnYWluc3QgdGhlIGVudGlyZSBzZXQKCQkJCWlmICggcmF3ICkgewoJCQkJCWZuLmNhbGwoIGVsZW1zLCB2YWx1ZSApOwoJCQkJCWZuID0gbnVsbDsKCgkJCQkvLyAuLi5leGNlcHQgd2hlbiBleGVjdXRpbmcgZnVuY3Rpb24gdmFsdWVzCgkJCQl9IGVsc2UgewoJCQkJCWJ1bGsgPSBmbjsKCQkJCQlmbiA9IGZ1bmN0aW9uKCBlbGVtLCBrZXksIHZhbHVlICkgewoJCQkJCQlyZXR1cm4gYnVsay5jYWxsKCBqUXVlcnkoIGVsZW0gKSwgdmFsdWUgKTsKCQkJCQl9OwoJCQkJfQoJCQl9CgoJCQlpZiAoIGZuICkgewoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQkJZm4oIGVsZW1zW2ldLCBrZXksIHJhdyA/IHZhbHVlIDogdmFsdWUuY2FsbCggZWxlbXNbaV0sIGksIGZuKCBlbGVtc1tpXSwga2V5ICkgKSApOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gY2hhaW5hYmxlID8KCQkJZWxlbXMgOgoKCQkJLy8gR2V0cwoJCQlidWxrID8KCQkJCWZuLmNhbGwoIGVsZW1zICkgOgoJCQkJbGVuZ3RoID8gZm4oIGVsZW1zWzBdLCBrZXkgKSA6IGVtcHR5R2V0OwoJfSwKCglub3c6IGZ1bmN0aW9uKCkgewoJCXJldHVybiAoIG5ldyBEYXRlKCkgKS5nZXRUaW1lKCk7Cgl9Cn0pOwoKalF1ZXJ5LnJlYWR5LnByb21pc2UgPSBmdW5jdGlvbiggb2JqICkgewoJaWYgKCAhcmVhZHlMaXN0ICkgewoKCQlyZWFkeUxpc3QgPSBqUXVlcnkuRGVmZXJyZWQoKTsKCgkJLy8gQ2F0Y2ggY2FzZXMgd2hlcmUgJChkb2N1bWVudCkucmVhZHkoKSBpcyBjYWxsZWQgYWZ0ZXIgdGhlIGJyb3dzZXIgZXZlbnQgaGFzIGFscmVhZHkgb2NjdXJyZWQuCgkJLy8gd2Ugb25jZSB0cmllZCB0byB1c2UgcmVhZHlTdGF0ZSAiaW50ZXJhY3RpdmUiIGhlcmUsIGJ1dCBpdCBjYXVzZWQgaXNzdWVzIGxpa2UgdGhlIG9uZQoJCS8vIGRpc2NvdmVyZWQgYnkgQ2hyaXNTIGhlcmU6IGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMjgyI2NvbW1lbnQ6MTUKCQlpZiAoIGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgKSB7CgkJCS8vIEhhbmRsZSBpdCBhc3luY2hyb25vdXNseSB0byBhbGxvdyBzY3JpcHRzIHRoZSBvcHBvcnR1bml0eSB0byBkZWxheSByZWFkeQoJCQlzZXRUaW1lb3V0KCBqUXVlcnkucmVhZHkgKTsKCgkJLy8gU3RhbmRhcmRzLWJhc2VkIGJyb3dzZXJzIHN1cHBvcnQgRE9NQ29udGVudExvYWRlZAoJCX0gZWxzZSBpZiAoIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKSB7CgkJCS8vIFVzZSB0aGUgaGFuZHkgZXZlbnQgY2FsbGJhY2sKCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggIkRPTUNvbnRlbnRMb2FkZWQiLCBjb21wbGV0ZWQsIGZhbHNlICk7CgoJCQkvLyBBIGZhbGxiYWNrIHRvIHdpbmRvdy5vbmxvYWQsIHRoYXQgd2lsbCBhbHdheXMgd29yawoJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggImxvYWQiLCBjb21wbGV0ZWQsIGZhbHNlICk7CgoJCS8vIElmIElFIGV2ZW50IG1vZGVsIGlzIHVzZWQKCQl9IGVsc2UgewoJCQkvLyBFbnN1cmUgZmlyaW5nIGJlZm9yZSBvbmxvYWQsIG1heWJlIGxhdGUgYnV0IHNhZmUgYWxzbyBmb3IgaWZyYW1lcwoJCQlkb2N1bWVudC5hdHRhY2hFdmVudCggIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCApOwoKCQkJLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmsKCQkJd2luZG93LmF0dGFjaEV2ZW50KCAib25sb2FkIiwgY29tcGxldGVkICk7CgoJCQkvLyBJZiBJRSBhbmQgbm90IGEgZnJhbWUKCQkJLy8gY29udGludWFsbHkgY2hlY2sgdG8gc2VlIGlmIHRoZSBkb2N1bWVudCBpcyByZWFkeQoJCQl2YXIgdG9wID0gZmFsc2U7CgoJCQl0cnkgewoJCQkJdG9wID0gd2luZG93LmZyYW1lRWxlbWVudCA9PSBudWxsICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCQkJfSBjYXRjaChlKSB7fQoKCQkJaWYgKCB0b3AgJiYgdG9wLmRvU2Nyb2xsICkgewoJCQkJKGZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7CgkJCQkJaWYgKCAhalF1ZXJ5LmlzUmVhZHkgKSB7CgoJCQkJCQl0cnkgewoJCQkJCQkJLy8gVXNlIHRoZSB0cmljayBieSBEaWVnbyBQZXJpbmkKCQkJCQkJCS8vIGh0dHA6Ly9qYXZhc2NyaXB0Lm53Ym94LmNvbS9JRUNvbnRlbnRMb2FkZWQvCgkJCQkJCQl0b3AuZG9TY3JvbGwoImxlZnQiKTsKCQkJCQkJfSBjYXRjaChlKSB7CgkJCQkJCQlyZXR1cm4gc2V0VGltZW91dCggZG9TY3JvbGxDaGVjaywgNTAgKTsKCQkJCQkJfQoKCQkJCQkJLy8gZGV0YWNoIGFsbCBkb20gcmVhZHkgZXZlbnRzCgkJCQkJCWRldGFjaCgpOwoKCQkJCQkJLy8gYW5kIGV4ZWN1dGUgYW55IHdhaXRpbmcgZnVuY3Rpb25zCgkJCQkJCWpRdWVyeS5yZWFkeSgpOwoJCQkJCX0KCQkJCX0pKCk7CgkJCX0KCQl9Cgl9CglyZXR1cm4gcmVhZHlMaXN0LnByb21pc2UoIG9iaiApOwp9OwoKLy8gUG9wdWxhdGUgdGhlIGNsYXNzMnR5cGUgbWFwCmpRdWVyeS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0IEVycm9yIi5zcGxpdCgiICIpLCBmdW5jdGlvbihpLCBuYW1lKSB7CgljbGFzczJ0eXBlWyAiW29iamVjdCAiICsgbmFtZSArICJdIiBdID0gbmFtZS50b0xvd2VyQ2FzZSgpOwp9KTsKCmZ1bmN0aW9uIGlzQXJyYXlsaWtlKCBvYmogKSB7Cgl2YXIgbGVuZ3RoID0gb2JqLmxlbmd0aCwKCQl0eXBlID0galF1ZXJ5LnR5cGUoIG9iaiApOwoKCWlmICggalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJaWYgKCBvYmoubm9kZVR5cGUgPT09IDEgJiYgbGVuZ3RoICkgewoJCXJldHVybiB0cnVlOwoJfQoKCXJldHVybiB0eXBlID09PSAiYXJyYXkiIHx8IHR5cGUgIT09ICJmdW5jdGlvbiIgJiYKCQkoIGxlbmd0aCA9PT0gMCB8fAoJCXR5cGVvZiBsZW5ndGggPT09ICJudW1iZXIiICYmIGxlbmd0aCA+IDAgJiYgKCBsZW5ndGggLSAxICkgaW4gb2JqICk7Cn0KCi8vIEFsbCBqUXVlcnkgb2JqZWN0cyBzaG91bGQgcG9pbnQgYmFjayB0byB0aGVzZQpyb290alF1ZXJ5ID0galF1ZXJ5KGRvY3VtZW50KTsKLy8gU3RyaW5nIHRvIE9iamVjdCBvcHRpb25zIGZvcm1hdCBjYWNoZQp2YXIgb3B0aW9uc0NhY2hlID0ge307CgovLyBDb252ZXJ0IFN0cmluZy1mb3JtYXR0ZWQgb3B0aW9ucyBpbnRvIE9iamVjdC1mb3JtYXR0ZWQgb25lcyBhbmQgc3RvcmUgaW4gY2FjaGUKZnVuY3Rpb24gY3JlYXRlT3B0aW9ucyggb3B0aW9ucyApIHsKCXZhciBvYmplY3QgPSBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSA9IHt9OwoJalF1ZXJ5LmVhY2goIG9wdGlvbnMubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW10sIGZ1bmN0aW9uKCBfLCBmbGFnICkgewoJCW9iamVjdFsgZmxhZyBdID0gdHJ1ZTsKCX0pOwoJcmV0dXJuIG9iamVjdDsKfQoKLyoKICogQ3JlYXRlIGEgY2FsbGJhY2sgbGlzdCB1c2luZyB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CiAqCiAqCW9wdGlvbnM6IGFuIG9wdGlvbmFsIGxpc3Qgb2Ygc3BhY2Utc2VwYXJhdGVkIG9wdGlvbnMgdGhhdCB3aWxsIGNoYW5nZSBob3cKICoJCQl0aGUgY2FsbGJhY2sgbGlzdCBiZWhhdmVzIG9yIGEgbW9yZSB0cmFkaXRpb25hbCBvcHRpb24gb2JqZWN0CiAqCiAqIEJ5IGRlZmF1bHQgYSBjYWxsYmFjayBsaXN0IHdpbGwgYWN0IGxpa2UgYW4gZXZlbnQgY2FsbGJhY2sgbGlzdCBhbmQgY2FuIGJlCiAqICJmaXJlZCIgbXVsdGlwbGUgdGltZXMuCiAqCiAqIFBvc3NpYmxlIG9wdGlvbnM6CiAqCiAqCW9uY2U6CQkJd2lsbCBlbnN1cmUgdGhlIGNhbGxiYWNrIGxpc3QgY2FuIG9ubHkgYmUgZmlyZWQgb25jZSAobGlrZSBhIERlZmVycmVkKQogKgogKgltZW1vcnk6CQkJd2lsbCBrZWVwIHRyYWNrIG9mIHByZXZpb3VzIHZhbHVlcyBhbmQgd2lsbCBjYWxsIGFueSBjYWxsYmFjayBhZGRlZAogKgkJCQkJYWZ0ZXIgdGhlIGxpc3QgaGFzIGJlZW4gZmlyZWQgcmlnaHQgYXdheSB3aXRoIHRoZSBsYXRlc3QgIm1lbW9yaXplZCIKICoJCQkJCXZhbHVlcyAobGlrZSBhIERlZmVycmVkKQogKgogKgl1bmlxdWU6CQkJd2lsbCBlbnN1cmUgYSBjYWxsYmFjayBjYW4gb25seSBiZSBhZGRlZCBvbmNlIChubyBkdXBsaWNhdGUgaW4gdGhlIGxpc3QpCiAqCiAqCXN0b3BPbkZhbHNlOglpbnRlcnJ1cHQgY2FsbGluZ3Mgd2hlbiBhIGNhbGxiYWNrIHJldHVybnMgZmFsc2UKICoKICovCmpRdWVyeS5DYWxsYmFja3MgPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCgkvLyBDb252ZXJ0IG9wdGlvbnMgZnJvbSBTdHJpbmctZm9ybWF0dGVkIHRvIE9iamVjdC1mb3JtYXR0ZWQgaWYgbmVlZGVkCgkvLyAod2UgY2hlY2sgaW4gY2FjaGUgZmlyc3QpCglvcHRpb25zID0gdHlwZW9mIG9wdGlvbnMgPT09ICJzdHJpbmciID8KCQkoIG9wdGlvbnNDYWNoZVsgb3B0aW9ucyBdIHx8IGNyZWF0ZU9wdGlvbnMoIG9wdGlvbnMgKSApIDoKCQlqUXVlcnkuZXh0ZW5kKCB7fSwgb3B0aW9ucyApOwoKCXZhciAvLyBGbGFnIHRvIGtub3cgaWYgbGlzdCBpcyBjdXJyZW50bHkgZmlyaW5nCgkJZmlyaW5nLAoJCS8vIExhc3QgZmlyZSB2YWx1ZSAoZm9yIG5vbi1mb3JnZXR0YWJsZSBsaXN0cykKCQltZW1vcnksCgkJLy8gRmxhZyB0byBrbm93IGlmIGxpc3Qgd2FzIGFscmVhZHkgZmlyZWQKCQlmaXJlZCwKCQkvLyBFbmQgb2YgdGhlIGxvb3Agd2hlbiBmaXJpbmcKCQlmaXJpbmdMZW5ndGgsCgkJLy8gSW5kZXggb2YgY3VycmVudGx5IGZpcmluZyBjYWxsYmFjayAobW9kaWZpZWQgYnkgcmVtb3ZlIGlmIG5lZWRlZCkKCQlmaXJpbmdJbmRleCwKCQkvLyBGaXJzdCBjYWxsYmFjayB0byBmaXJlICh1c2VkIGludGVybmFsbHkgYnkgYWRkIGFuZCBmaXJlV2l0aCkKCQlmaXJpbmdTdGFydCwKCQkvLyBBY3R1YWwgY2FsbGJhY2sgbGlzdAoJCWxpc3QgPSBbXSwKCQkvLyBTdGFjayBvZiBmaXJlIGNhbGxzIGZvciByZXBlYXRhYmxlIGxpc3RzCgkJc3RhY2sgPSAhb3B0aW9ucy5vbmNlICYmIFtdLAoJCS8vIEZpcmUgY2FsbGJhY2tzCgkJZmlyZSA9IGZ1bmN0aW9uKCBkYXRhICkgewoJCQltZW1vcnkgPSBvcHRpb25zLm1lbW9yeSAmJiBkYXRhOwoJCQlmaXJlZCA9IHRydWU7CgkJCWZpcmluZ0luZGV4ID0gZmlyaW5nU3RhcnQgfHwgMDsKCQkJZmlyaW5nU3RhcnQgPSAwOwoJCQlmaXJpbmdMZW5ndGggPSBsaXN0Lmxlbmd0aDsKCQkJZmlyaW5nID0gdHJ1ZTsKCQkJZm9yICggOyBsaXN0ICYmIGZpcmluZ0luZGV4IDwgZmlyaW5nTGVuZ3RoOyBmaXJpbmdJbmRleCsrICkgewoJCQkJaWYgKCBsaXN0WyBmaXJpbmdJbmRleCBdLmFwcGx5KCBkYXRhWyAwIF0sIGRhdGFbIDEgXSApID09PSBmYWxzZSAmJiBvcHRpb25zLnN0b3BPbkZhbHNlICkgewoJCQkJCW1lbW9yeSA9IGZhbHNlOyAvLyBUbyBwcmV2ZW50IGZ1cnRoZXIgY2FsbHMgdXNpbmcgYWRkCgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJZmlyaW5nID0gZmFsc2U7CgkJCWlmICggbGlzdCApIHsKCQkJCWlmICggc3RhY2sgKSB7CgkJCQkJaWYgKCBzdGFjay5sZW5ndGggKSB7CgkJCQkJCWZpcmUoIHN0YWNrLnNoaWZ0KCkgKTsKCQkJCQl9CgkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgKSB7CgkJCQkJbGlzdCA9IFtdOwoJCQkJfSBlbHNlIHsKCQkJCQlzZWxmLmRpc2FibGUoKTsKCQkJCX0KCQkJfQoJCX0sCgkJLy8gQWN0dWFsIENhbGxiYWNrcyBvYmplY3QKCQlzZWxmID0gewoJCQkvLyBBZGQgYSBjYWxsYmFjayBvciBhIGNvbGxlY3Rpb24gb2YgY2FsbGJhY2tzIHRvIHRoZSBsaXN0CgkJCWFkZDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJLy8gRmlyc3QsIHdlIHNhdmUgdGhlIGN1cnJlbnQgbGVuZ3RoCgkJCQkJdmFyIHN0YXJ0ID0gbGlzdC5sZW5ndGg7CgkJCQkJKGZ1bmN0aW9uIGFkZCggYXJncyApIHsKCQkJCQkJalF1ZXJ5LmVhY2goIGFyZ3MsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7CgkJCQkJCQl2YXIgdHlwZSA9IGpRdWVyeS50eXBlKCBhcmcgKTsKCQkJCQkJCWlmICggdHlwZSA9PT0gImZ1bmN0aW9uIiApIHsKCQkJCQkJCQlpZiAoICFvcHRpb25zLnVuaXF1ZSB8fCAhc2VsZi5oYXMoIGFyZyApICkgewoJCQkJCQkJCQlsaXN0LnB1c2goIGFyZyApOwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSBpZiAoIGFyZyAmJiBhcmcubGVuZ3RoICYmIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQkJCQkJCS8vIEluc3BlY3QgcmVjdXJzaXZlbHkKCQkJCQkJCQlhZGQoIGFyZyApOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9KSggYXJndW1lbnRzICk7CgkJCQkJLy8gRG8gd2UgbmVlZCB0byBhZGQgdGhlIGNhbGxiYWNrcyB0byB0aGUKCQkJCQkvLyBjdXJyZW50IGZpcmluZyBiYXRjaD8KCQkJCQlpZiAoIGZpcmluZyApIHsKCQkJCQkJZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCQkJLy8gV2l0aCBtZW1vcnksIGlmIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbgoJCQkJCS8vIHdlIHNob3VsZCBjYWxsIHJpZ2h0IGF3YXkKCQkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgKSB7CgkJCQkJCWZpcmluZ1N0YXJ0ID0gc3RhcnQ7CgkJCQkJCWZpcmUoIG1lbW9yeSApOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBSZW1vdmUgYSBjYWxsYmFjayBmcm9tIHRoZSBsaXN0CgkJCXJlbW92ZTogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJalF1ZXJ5LmVhY2goIGFyZ3VtZW50cywgZnVuY3Rpb24oIF8sIGFyZyApIHsKCQkJCQkJdmFyIGluZGV4OwoJCQkJCQl3aGlsZSggKCBpbmRleCA9IGpRdWVyeS5pbkFycmF5KCBhcmcsIGxpc3QsIGluZGV4ICkgKSA+IC0xICkgewoJCQkJCQkJbGlzdC5zcGxpY2UoIGluZGV4LCAxICk7CgkJCQkJCQkvLyBIYW5kbGUgZmlyaW5nIGluZGV4ZXMKCQkJCQkJCWlmICggZmlyaW5nICkgewoJCQkJCQkJCWlmICggaW5kZXggPD0gZmlyaW5nTGVuZ3RoICkgewoJCQkJCQkJCQlmaXJpbmdMZW5ndGgtLTsKCQkJCQkJCQl9CgkJCQkJCQkJaWYgKCBpbmRleCA8PSBmaXJpbmdJbmRleCApIHsKCQkJCQkJCQkJZmlyaW5nSW5kZXgtLTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBDaGVjayBpZiBhIGdpdmVuIGNhbGxiYWNrIGlzIGluIHRoZSBsaXN0LgoJCQkvLyBJZiBubyBhcmd1bWVudCBpcyBnaXZlbiwgcmV0dXJuIHdoZXRoZXIgb3Igbm90IGxpc3QgaGFzIGNhbGxiYWNrcyBhdHRhY2hlZC4KCQkJaGFzOiBmdW5jdGlvbiggZm4gKSB7CgkJCQlyZXR1cm4gZm4gPyBqUXVlcnkuaW5BcnJheSggZm4sIGxpc3QgKSA+IC0xIDogISEoIGxpc3QgJiYgbGlzdC5sZW5ndGggKTsKCQkJfSwKCQkJLy8gUmVtb3ZlIGFsbCBjYWxsYmFja3MgZnJvbSB0aGUgbGlzdAoJCQllbXB0eTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gW107CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSGF2ZSB0aGUgbGlzdCBkbyBub3RoaW5nIGFueW1vcmUKCQkJZGlzYWJsZTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gc3RhY2sgPSBtZW1vcnkgPSB1bmRlZmluZWQ7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSXMgaXQgZGlzYWJsZWQ/CgkJCWRpc2FibGVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhbGlzdDsKCQkJfSwKCQkJLy8gTG9jayB0aGUgbGlzdCBpbiBpdHMgY3VycmVudCBzdGF0ZQoJCQlsb2NrOiBmdW5jdGlvbigpIHsKCQkJCXN0YWNrID0gdW5kZWZpbmVkOwoJCQkJaWYgKCAhbWVtb3J5ICkgewoJCQkJCXNlbGYuZGlzYWJsZSgpOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIElzIGl0IGxvY2tlZD8KCQkJbG9ja2VkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhc3RhY2s7CgkJCX0sCgkJCS8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKCQkJZmlyZVdpdGg6IGZ1bmN0aW9uKCBjb250ZXh0LCBhcmdzICkgewoJCQkJYXJncyA9IGFyZ3MgfHwgW107CgkJCQlhcmdzID0gWyBjb250ZXh0LCBhcmdzLnNsaWNlID8gYXJncy5zbGljZSgpIDogYXJncyBdOwoJCQkJaWYgKCBsaXN0ICYmICggIWZpcmVkIHx8IHN0YWNrICkgKSB7CgkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCXN0YWNrLnB1c2goIGFyZ3MgKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlmaXJlKCBhcmdzICk7CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIENhbGwgYWxsIHRoZSBjYWxsYmFja3Mgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzCgkJCWZpcmU6IGZ1bmN0aW9uKCkgewoJCQkJc2VsZi5maXJlV2l0aCggdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gVG8ga25vdyBpZiB0aGUgY2FsbGJhY2tzIGhhdmUgYWxyZWFkeSBiZWVuIGNhbGxlZCBhdCBsZWFzdCBvbmNlCgkJCWZpcmVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhIWZpcmVkOwoJCQl9CgkJfTsKCglyZXR1cm4gc2VsZjsKfTsKalF1ZXJ5LmV4dGVuZCh7CgoJRGVmZXJyZWQ6IGZ1bmN0aW9uKCBmdW5jICkgewoJCXZhciB0dXBsZXMgPSBbCgkJCQkvLyBhY3Rpb24sIGFkZCBsaXN0ZW5lciwgbGlzdGVuZXIgbGlzdCwgZmluYWwgc3RhdGUKCQkJCVsgInJlc29sdmUiLCAiZG9uZSIsIGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZXNvbHZlZCIgXSwKCQkJCVsgInJlamVjdCIsICJmYWlsIiwgalF1ZXJ5LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgInJlamVjdGVkIiBdLAoJCQkJWyAibm90aWZ5IiwgInByb2dyZXNzIiwgalF1ZXJ5LkNhbGxiYWNrcygibWVtb3J5IikgXQoJCQldLAoJCQlzdGF0ZSA9ICJwZW5kaW5nIiwKCQkJcHJvbWlzZSA9IHsKCQkJCXN0YXRlOiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gc3RhdGU7CgkJCQl9LAoJCQkJYWx3YXlzOiBmdW5jdGlvbigpIHsKCQkJCQlkZWZlcnJlZC5kb25lKCBhcmd1bWVudHMgKS5mYWlsKCBhcmd1bWVudHMgKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgkJCQl0aGVuOiBmdW5jdGlvbiggLyogZm5Eb25lLCBmbkZhaWwsIGZuUHJvZ3Jlc3MgKi8gKSB7CgkJCQkJdmFyIGZucyA9IGFyZ3VtZW50czsKCQkJCQlyZXR1cm4galF1ZXJ5LkRlZmVycmVkKGZ1bmN0aW9uKCBuZXdEZWZlciApIHsKCQkJCQkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQkJCQkJdmFyIGFjdGlvbiA9IHR1cGxlWyAwIF0sCgkJCQkJCQkJZm4gPSBqUXVlcnkuaXNGdW5jdGlvbiggZm5zWyBpIF0gKSAmJiBmbnNbIGkgXTsKCQkJCQkJCS8vIGRlZmVycmVkWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gZm9yIGZvcndhcmRpbmcgYWN0aW9ucyB0byBuZXdEZWZlcgoJCQkJCQkJZGVmZXJyZWRbIHR1cGxlWzFdIF0oZnVuY3Rpb24oKSB7CgkJCQkJCQkJdmFyIHJldHVybmVkID0gZm4gJiYgZm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJCQkJCWlmICggcmV0dXJuZWQgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIHJldHVybmVkLnByb21pc2UgKSApIHsKCQkJCQkJCQkJcmV0dXJuZWQucHJvbWlzZSgpCgkJCQkJCQkJCQkuZG9uZSggbmV3RGVmZXIucmVzb2x2ZSApCgkJCQkJCQkJCQkuZmFpbCggbmV3RGVmZXIucmVqZWN0ICkKCQkJCQkJCQkJCS5wcm9ncmVzcyggbmV3RGVmZXIubm90aWZ5ICk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJbmV3RGVmZXJbIGFjdGlvbiArICJXaXRoIiBdKCB0aGlzID09PSBwcm9taXNlID8gbmV3RGVmZXIucHJvbWlzZSgpIDogdGhpcywgZm4gPyBbIHJldHVybmVkIF0gOiBhcmd1bWVudHMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfSk7CgkJCQkJCWZucyA9IG51bGw7CgkJCQkJfSkucHJvbWlzZSgpOwoJCQkJfSwKCQkJCS8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKCQkJCS8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKCQkJCXByb21pc2U6IGZ1bmN0aW9uKCBvYmogKSB7CgkJCQkJcmV0dXJuIG9iaiAhPSBudWxsID8galF1ZXJ5LmV4dGVuZCggb2JqLCBwcm9taXNlICkgOiBwcm9taXNlOwoJCQkJfQoJCQl9LAoJCQlkZWZlcnJlZCA9IHt9OwoKCQkvLyBLZWVwIHBpcGUgZm9yIGJhY2stY29tcGF0CgkJcHJvbWlzZS5waXBlID0gcHJvbWlzZS50aGVuOwoKCQkvLyBBZGQgbGlzdC1zcGVjaWZpYyBtZXRob2RzCgkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQl2YXIgbGlzdCA9IHR1cGxlWyAyIF0sCgkJCQlzdGF0ZVN0cmluZyA9IHR1cGxlWyAzIF07CgoJCQkvLyBwcm9taXNlWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gPSBsaXN0LmFkZAoJCQlwcm9taXNlWyB0dXBsZVsxXSBdID0gbGlzdC5hZGQ7CgoJCQkvLyBIYW5kbGUgc3RhdGUKCQkJaWYgKCBzdGF0ZVN0cmluZyApIHsKCQkJCWxpc3QuYWRkKGZ1bmN0aW9uKCkgewoJCQkJCS8vIHN0YXRlID0gWyByZXNvbHZlZCB8IHJlamVjdGVkIF0KCQkJCQlzdGF0ZSA9IHN0YXRlU3RyaW5nOwoKCQkJCS8vIFsgcmVqZWN0X2xpc3QgfCByZXNvbHZlX2xpc3QgXS5kaXNhYmxlOyBwcm9ncmVzc19saXN0LmxvY2sKCQkJCX0sIHR1cGxlc1sgaSBeIDEgXVsgMiBdLmRpc2FibGUsIHR1cGxlc1sgMiBdWyAyIF0ubG9jayApOwoJCQl9CgoJCQkvLyBkZWZlcnJlZFsgcmVzb2x2ZSB8IHJlamVjdCB8IG5vdGlmeSBdCgkJCWRlZmVycmVkWyB0dXBsZVswXSBdID0gZnVuY3Rpb24oKSB7CgkJCQlkZWZlcnJlZFsgdHVwbGVbMF0gKyAiV2l0aCIgXSggdGhpcyA9PT0gZGVmZXJyZWQgPyBwcm9taXNlIDogdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfTsKCQkJZGVmZXJyZWRbIHR1cGxlWzBdICsgIldpdGgiIF0gPSBsaXN0LmZpcmVXaXRoOwoJCX0pOwoKCQkvLyBNYWtlIHRoZSBkZWZlcnJlZCBhIHByb21pc2UKCQlwcm9taXNlLnByb21pc2UoIGRlZmVycmVkICk7CgoJCS8vIENhbGwgZ2l2ZW4gZnVuYyBpZiBhbnkKCQlpZiAoIGZ1bmMgKSB7CgkJCWZ1bmMuY2FsbCggZGVmZXJyZWQsIGRlZmVycmVkICk7CgkJfQoKCQkvLyBBbGwgZG9uZSEKCQlyZXR1cm4gZGVmZXJyZWQ7Cgl9LAoKCS8vIERlZmVycmVkIGhlbHBlcgoJd2hlbjogZnVuY3Rpb24oIHN1Ym9yZGluYXRlIC8qICwgLi4uLCBzdWJvcmRpbmF0ZU4gKi8gKSB7CgkJdmFyIGkgPSAwLAoJCQlyZXNvbHZlVmFsdWVzID0gY29yZV9zbGljZS5jYWxsKCBhcmd1bWVudHMgKSwKCQkJbGVuZ3RoID0gcmVzb2x2ZVZhbHVlcy5sZW5ndGgsCgoJCQkvLyB0aGUgY291bnQgb2YgdW5jb21wbGV0ZWQgc3Vib3JkaW5hdGVzCgkJCXJlbWFpbmluZyA9IGxlbmd0aCAhPT0gMSB8fCAoIHN1Ym9yZGluYXRlICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBzdWJvcmRpbmF0ZS5wcm9taXNlICkgKSA/IGxlbmd0aCA6IDAsCgoJCQkvLyB0aGUgbWFzdGVyIERlZmVycmVkLiBJZiByZXNvbHZlVmFsdWVzIGNvbnNpc3Qgb2Ygb25seSBhIHNpbmdsZSBEZWZlcnJlZCwganVzdCB1c2UgdGhhdC4KCQkJZGVmZXJyZWQgPSByZW1haW5pbmcgPT09IDEgPyBzdWJvcmRpbmF0ZSA6IGpRdWVyeS5EZWZlcnJlZCgpLAoKCQkJLy8gVXBkYXRlIGZ1bmN0aW9uIGZvciBib3RoIHJlc29sdmUgYW5kIHByb2dyZXNzIHZhbHVlcwoJCQl1cGRhdGVGdW5jID0gZnVuY3Rpb24oIGksIGNvbnRleHRzLCB2YWx1ZXMgKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24oIHZhbHVlICkgewoJCQkJCWNvbnRleHRzWyBpIF0gPSB0aGlzOwoJCQkJCXZhbHVlc1sgaSBdID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBjb3JlX3NsaWNlLmNhbGwoIGFyZ3VtZW50cyApIDogdmFsdWU7CgkJCQkJaWYoIHZhbHVlcyA9PT0gcHJvZ3Jlc3NWYWx1ZXMgKSB7CgkJCQkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGNvbnRleHRzLCB2YWx1ZXMgKTsKCQkJCQl9IGVsc2UgaWYgKCAhKCAtLXJlbWFpbmluZyApICkgewoJCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY29udGV4dHMsIHZhbHVlcyApOwoJCQkJCX0KCQkJCX07CgkJCX0sCgoJCQlwcm9ncmVzc1ZhbHVlcywgcHJvZ3Jlc3NDb250ZXh0cywgcmVzb2x2ZUNvbnRleHRzOwoKCQkvLyBhZGQgbGlzdGVuZXJzIHRvIERlZmVycmVkIHN1Ym9yZGluYXRlczsgdHJlYXQgb3RoZXJzIGFzIHJlc29sdmVkCgkJaWYgKCBsZW5ndGggPiAxICkgewoJCQlwcm9ncmVzc1ZhbHVlcyA9IG5ldyBBcnJheSggbGVuZ3RoICk7CgkJCXByb2dyZXNzQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlyZXNvbHZlQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWlmICggcmVzb2x2ZVZhbHVlc1sgaSBdICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCXJlc29sdmVWYWx1ZXNbIGkgXS5wcm9taXNlKCkKCQkJCQkJLmRvbmUoIHVwZGF0ZUZ1bmMoIGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApICkKCQkJCQkJLmZhaWwoIGRlZmVycmVkLnJlamVjdCApCgkJCQkJCS5wcm9ncmVzcyggdXBkYXRlRnVuYyggaSwgcHJvZ3Jlc3NDb250ZXh0cywgcHJvZ3Jlc3NWYWx1ZXMgKSApOwoJCQkJfSBlbHNlIHsKCQkJCQktLXJlbWFpbmluZzsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gaWYgd2UncmUgbm90IHdhaXRpbmcgb24gYW55dGhpbmcsIHJlc29sdmUgdGhlIG1hc3RlcgoJCWlmICggIXJlbWFpbmluZyApIHsKCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApOwoJCX0KCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKCX0KfSk7CmpRdWVyeS5zdXBwb3J0ID0gKGZ1bmN0aW9uKCkgewoKCXZhciBzdXBwb3J0LCBhbGwsIGEsCgkJaW5wdXQsIHNlbGVjdCwgZnJhZ21lbnQsCgkJb3B0LCBldmVudE5hbWUsIGlzU3VwcG9ydGVkLCBpLAoJCWRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKCS8vIFNldHVwCglkaXYuc2V0QXR0cmlidXRlKCAiY2xhc3NOYW1lIiwgInQiICk7CglkaXYuaW5uZXJIVE1MID0gIiAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJz5hPC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPiI7CgoJLy8gU3VwcG9ydCB0ZXN0cyB3b24ndCBydW4gaW4gc29tZSBsaW1pdGVkIG9yIG5vbi1icm93c2VyIGVudmlyb25tZW50cwoJYWxsID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIik7CglhID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJhIilbIDAgXTsKCWlmICggIWFsbCB8fCAhYSB8fCAhYWxsLmxlbmd0aCApIHsKCQlyZXR1cm4ge307Cgl9CgoJLy8gRmlyc3QgYmF0Y2ggb2YgdGVzdHMKCXNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJb3B0ID0gc2VsZWN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSApOwoJaW5wdXQgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IilbIDAgXTsKCglhLnN0eWxlLmNzc1RleHQgPSAidG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjUiOwoJc3VwcG9ydCA9IHsKCQkvLyBUZXN0IHNldEF0dHJpYnV0ZSBvbiBjYW1lbENhc2UgY2xhc3MuIElmIGl0IHdvcmtzLCB3ZSBuZWVkIGF0dHJGaXhlcyB3aGVuIGRvaW5nIGdldC9zZXRBdHRyaWJ1dGUgKGllNi83KQoJCWdldFNldEF0dHJpYnV0ZTogZGl2LmNsYXNzTmFtZSAhPT0gInQiLAoKCQkvLyBJRSBzdHJpcHMgbGVhZGluZyB3aGl0ZXNwYWNlIHdoZW4gLmlubmVySFRNTCBpcyB1c2VkCgkJbGVhZGluZ1doaXRlc3BhY2U6IGRpdi5maXJzdENoaWxkLm5vZGVUeXBlID09PSAzLAoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0Ym9keSBlbGVtZW50cyBhcmVuJ3QgYXV0b21hdGljYWxseSBpbnNlcnRlZAoJCS8vIElFIHdpbGwgaW5zZXJ0IHRoZW0gaW50byBlbXB0eSB0YWJsZXMKCQl0Ym9keTogIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKS5sZW5ndGgsCgoJCS8vIE1ha2Ugc3VyZSB0aGF0IGxpbmsgZWxlbWVudHMgZ2V0IHNlcmlhbGl6ZWQgY29ycmVjdGx5IGJ5IGlubmVySFRNTAoJCS8vIFRoaXMgcmVxdWlyZXMgYSB3cmFwcGVyIGVsZW1lbnQgaW4gSUUKCQlodG1sU2VyaWFsaXplOiAhIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgibGluayIpLmxlbmd0aCwKCgkJLy8gR2V0IHRoZSBzdHlsZSBpbmZvcm1hdGlvbiBmcm9tIGdldEF0dHJpYnV0ZQoJCS8vIChJRSB1c2VzIC5jc3NUZXh0IGluc3RlYWQpCgkJc3R5bGU6IC90b3AvLnRlc3QoIGEuZ2V0QXR0cmlidXRlKCJzdHlsZSIpICksCgoJCS8vIE1ha2Ugc3VyZSB0aGF0IFVSTHMgYXJlbid0IG1hbmlwdWxhdGVkCgkJLy8gKElFIG5vcm1hbGl6ZXMgaXQgYnkgZGVmYXVsdCkKCQlocmVmTm9ybWFsaXplZDogYS5nZXRBdHRyaWJ1dGUoImhyZWYiKSA9PT0gIi9hIiwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgZWxlbWVudCBvcGFjaXR5IGV4aXN0cwoJCS8vIChJRSB1c2VzIGZpbHRlciBpbnN0ZWFkKQoJCS8vIFVzZSBhIHJlZ2V4IHRvIHdvcmsgYXJvdW5kIGEgV2ViS2l0IGlzc3VlLiBTZWUgIzUxNDUKCQlvcGFjaXR5OiAvXjAuNS8udGVzdCggYS5zdHlsZS5vcGFjaXR5ICksCgoJCS8vIFZlcmlmeSBzdHlsZSBmbG9hdCBleGlzdGVuY2UKCQkvLyAoSUUgdXNlcyBzdHlsZUZsb2F0IGluc3RlYWQgb2YgY3NzRmxvYXQpCgkJY3NzRmxvYXQ6ICEhYS5zdHlsZS5jc3NGbG9hdCwKCgkJLy8gQ2hlY2sgdGhlIGRlZmF1bHQgY2hlY2tib3gvcmFkaW8gdmFsdWUgKCIiIG9uIFdlYktpdDsgIm9uIiBlbHNld2hlcmUpCgkJY2hlY2tPbjogISFpbnB1dC52YWx1ZSwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgYSBzZWxlY3RlZC1ieS1kZWZhdWx0IG9wdGlvbiBoYXMgYSB3b3JraW5nIHNlbGVjdGVkIHByb3BlcnR5LgoJCS8vIChXZWJLaXQgZGVmYXVsdHMgdG8gZmFsc2UgaW5zdGVhZCBvZiB0cnVlLCBJRSB0b28sIGlmIGl0J3MgaW4gYW4gb3B0Z3JvdXApCgkJb3B0U2VsZWN0ZWQ6IG9wdC5zZWxlY3RlZCwKCgkJLy8gVGVzdHMgZm9yIGVuY3R5cGUgc3VwcG9ydCBvbiBhIGZvcm0gKCM2NzQzKQoJCWVuY3R5cGU6ICEhZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9ybSIpLmVuY3R5cGUsCgoJCS8vIE1ha2VzIHN1cmUgY2xvbmluZyBhbiBodG1sNSBlbGVtZW50IGRvZXMgbm90IGNhdXNlIHByb2JsZW1zCgkJLy8gV2hlcmUgb3V0ZXJIVE1MIGlzIHVuZGVmaW5lZCwgdGhpcyBzdGlsbCB3b3JrcwoJCWh0bWw1Q2xvbmU6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm5hdiIpLmNsb25lTm9kZSggdHJ1ZSApLm91dGVySFRNTCAhPT0gIjw6bmF2PjwvOm5hdj4iLAoKCQkvLyBqUXVlcnkuc3VwcG9ydC5ib3hNb2RlbCBERVBSRUNBVEVEIGluIDEuOCBzaW5jZSB3ZSBkb24ndCBzdXBwb3J0IFF1aXJrcyBNb2RlCgkJYm94TW9kZWw6IGRvY3VtZW50LmNvbXBhdE1vZGUgPT09ICJDU1MxQ29tcGF0IiwKCgkJLy8gV2lsbCBiZSBkZWZpbmVkIGxhdGVyCgkJZGVsZXRlRXhwYW5kbzogdHJ1ZSwKCQlub0Nsb25lRXZlbnQ6IHRydWUsCgkJaW5saW5lQmxvY2tOZWVkc0xheW91dDogZmFsc2UsCgkJc2hyaW5rV3JhcEJsb2NrczogZmFsc2UsCgkJcmVsaWFibGVNYXJnaW5SaWdodDogdHJ1ZSwKCQlib3hTaXppbmdSZWxpYWJsZTogdHJ1ZSwKCQlwaXhlbFBvc2l0aW9uOiBmYWxzZQoJfTsKCgkvLyBNYWtlIHN1cmUgY2hlY2tlZCBzdGF0dXMgaXMgcHJvcGVybHkgY2xvbmVkCglpbnB1dC5jaGVja2VkID0gdHJ1ZTsKCXN1cHBvcnQubm9DbG9uZUNoZWNrZWQgPSBpbnB1dC5jbG9uZU5vZGUoIHRydWUgKS5jaGVja2VkOwoKCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBvcHRpb25zIGluc2lkZSBkaXNhYmxlZCBzZWxlY3RzIGFyZW4ndCBtYXJrZWQgYXMgZGlzYWJsZWQKCS8vIChXZWJLaXQgbWFya3MgdGhlbSBhcyBkaXNhYmxlZCkKCXNlbGVjdC5kaXNhYmxlZCA9IHRydWU7CglzdXBwb3J0Lm9wdERpc2FibGVkID0gIW9wdC5kaXNhYmxlZDsKCgkvLyBTdXBwb3J0OiBJRTw5Cgl0cnkgewoJCWRlbGV0ZSBkaXYudGVzdDsKCX0gY2F0Y2goIGUgKSB7CgkJc3VwcG9ydC5kZWxldGVFeHBhbmRvID0gZmFsc2U7Cgl9CgoJLy8gQ2hlY2sgaWYgd2UgY2FuIHRydXN0IGdldEF0dHJpYnV0ZSgidmFsdWUiKQoJaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidmFsdWUiLCAiIiApOwoJc3VwcG9ydC5pbnB1dCA9IGlucHV0LmdldEF0dHJpYnV0ZSggInZhbHVlIiApID09PSAiIjsKCgkvLyBDaGVjayBpZiBhbiBpbnB1dCBtYWludGFpbnMgaXRzIHZhbHVlIGFmdGVyIGJlY29taW5nIGEgcmFkaW8KCWlucHV0LnZhbHVlID0gInQiOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidHlwZSIsICJyYWRpbyIgKTsKCXN1cHBvcnQucmFkaW9WYWx1ZSA9IGlucHV0LnZhbHVlID09PSAidCI7CgoJLy8gIzExMjE3IC0gV2ViS2l0IGxvc2VzIGNoZWNrIHdoZW4gdGhlIG5hbWUgaXMgYWZ0ZXIgdGhlIGNoZWNrZWQgYXR0cmlidXRlCglpbnB1dC5zZXRBdHRyaWJ1dGUoICJjaGVja2VkIiwgInQiICk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoICJuYW1lIiwgInQiICk7CgoJZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CglmcmFnbWVudC5hcHBlbmRDaGlsZCggaW5wdXQgKTsKCgkvLyBDaGVjayBpZiBhIGRpc2Nvbm5lY3RlZCBjaGVja2JveCB3aWxsIHJldGFpbiBpdHMgY2hlY2tlZAoJLy8gdmFsdWUgb2YgdHJ1ZSBhZnRlciBhcHBlbmRlZCB0byB0aGUgRE9NIChJRTYvNykKCXN1cHBvcnQuYXBwZW5kQ2hlY2tlZCA9IGlucHV0LmNoZWNrZWQ7CgoJLy8gV2ViS2l0IGRvZXNuJ3QgY2xvbmUgY2hlY2tlZCBzdGF0ZSBjb3JyZWN0bHkgaW4gZnJhZ21lbnRzCglzdXBwb3J0LmNoZWNrQ2xvbmUgPSBmcmFnbWVudC5jbG9uZU5vZGUoIHRydWUgKS5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuY2hlY2tlZDsKCgkvLyBTdXBwb3J0OiBJRTw5CgkvLyBPcGVyYSBkb2VzIG5vdCBjbG9uZSBldmVudHMgKGFuZCB0eXBlb2YgZGl2LmF0dGFjaEV2ZW50ID09PSB1bmRlZmluZWQpLgoJLy8gSUU5LTEwIGNsb25lcyBldmVudHMgYm91bmQgdmlhIGF0dGFjaEV2ZW50LCBidXQgdGhleSBkb24ndCB0cmlnZ2VyIHdpdGggLmNsaWNrKCkKCWlmICggZGl2LmF0dGFjaEV2ZW50ICkgewoJCWRpdi5hdHRhY2hFdmVudCggIm9uY2xpY2siLCBmdW5jdGlvbigpIHsKCQkJc3VwcG9ydC5ub0Nsb25lRXZlbnQgPSBmYWxzZTsKCQl9KTsKCgkJZGl2LmNsb25lTm9kZSggdHJ1ZSApLmNsaWNrKCk7Cgl9CgoJLy8gU3VwcG9ydDogSUU8OSAobGFjayBzdWJtaXQvY2hhbmdlIGJ1YmJsZSksIEZpcmVmb3ggMTcrIChsYWNrIGZvY3VzaW4gZXZlbnQpCgkvLyBCZXdhcmUgb2YgQ1NQIHJlc3RyaWN0aW9ucyAoaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vU2VjdXJpdHkvQ1NQKSwgdGVzdC9jc3AucGhwCglmb3IgKCBpIGluIHsgc3VibWl0OiB0cnVlLCBjaGFuZ2U6IHRydWUsIGZvY3VzaW46IHRydWUgfSkgewoJCWRpdi5zZXRBdHRyaWJ1dGUoIGV2ZW50TmFtZSA9ICJvbiIgKyBpLCAidCIgKTsKCgkJc3VwcG9ydFsgaSArICJCdWJibGVzIiBdID0gZXZlbnROYW1lIGluIHdpbmRvdyB8fCBkaXYuYXR0cmlidXRlc1sgZXZlbnROYW1lIF0uZXhwYW5kbyA9PT0gZmFsc2U7Cgl9CgoJZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID0gImNvbnRlbnQtYm94IjsKCWRpdi5jbG9uZU5vZGUoIHRydWUgKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICIiOwoJc3VwcG9ydC5jbGVhckNsb25lU3R5bGUgPSBkaXYuc3R5bGUuYmFja2dyb3VuZENsaXAgPT09ICJjb250ZW50LWJveCI7CgoJLy8gUnVuIHRlc3RzIHRoYXQgbmVlZCBhIGJvZHkgYXQgZG9jIHJlYWR5CglqUXVlcnkoZnVuY3Rpb24oKSB7CgkJdmFyIGNvbnRhaW5lciwgbWFyZ2luRGl2LCB0ZHMsCgkJCWRpdlJlc2V0ID0gInBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5OmJsb2NrO2JveC1zaXppbmc6Y29udGVudC1ib3g7LW1vei1ib3gtc2l6aW5nOmNvbnRlbnQtYm94Oy13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDsiLAoJCQlib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsKCgkJaWYgKCAhYm9keSApIHsKCQkJLy8gUmV0dXJuIGZvciBmcmFtZXNldCBkb2NzIHRoYXQgZG9uJ3QgaGF2ZSBhIGJvZHkKCQkJcmV0dXJuOwoJCX0KCgkJY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgkJY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAiYm9yZGVyOjA7d2lkdGg6MDtoZWlnaHQ6MDtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0Oi05OTk5cHg7bWFyZ2luLXRvcDoxcHgiOwoKCQlib2R5LmFwcGVuZENoaWxkKCBjb250YWluZXIgKS5hcHBlbmRDaGlsZCggZGl2ICk7CgoJCS8vIFN1cHBvcnQ6IElFOAoJCS8vIENoZWNrIGlmIHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0IHdoZW4gdGhleSBhcmUgc2V0CgkJLy8gdG8gZGlzcGxheTpub25lIGFuZCB0aGVyZSBhcmUgc3RpbGwgb3RoZXIgdmlzaWJsZSB0YWJsZSBjZWxscyBpbiBhCgkJLy8gdGFibGUgcm93OyBpZiBzbywgb2Zmc2V0V2lkdGgvSGVpZ2h0IGFyZSBub3QgcmVsaWFibGUgZm9yIHVzZSB3aGVuCgkJLy8gZGV0ZXJtaW5pbmcgaWYgYW4gZWxlbWVudCBoYXMgYmVlbiBoaWRkZW4gZGlyZWN0bHkgdXNpbmcKCQkvLyBkaXNwbGF5Om5vbmUgKGl0IGlzIHN0aWxsIHNhZmUgdG8gdXNlIG9mZnNldHMgaWYgYSBwYXJlbnQgZWxlbWVudCBpcwoJCS8vIGhpZGRlbjsgZG9uIHNhZmV0eSBnb2dnbGVzIGFuZCBzZWUgYnVnICM0NTEyIGZvciBtb3JlIGluZm9ybWF0aW9uKS4KCQlkaXYuaW5uZXJIVE1MID0gIjx0YWJsZT48dHI+PHRkPjwvdGQ+PHRkPnQ8L3RkPjwvdHI+PC90YWJsZT4iOwoJCXRkcyA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGQiKTsKCQl0ZHNbIDAgXS5zdHlsZS5jc3NUZXh0ID0gInBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5Om5vbmUiOwoJCWlzU3VwcG9ydGVkID0gKCB0ZHNbIDAgXS5vZmZzZXRIZWlnaHQgPT09IDAgKTsKCgkJdGRzWyAwIF0uc3R5bGUuZGlzcGxheSA9ICIiOwoJCXRkc1sgMSBdLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgoJCS8vIFN1cHBvcnQ6IElFOAoJCS8vIENoZWNrIGlmIGVtcHR5IHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0CgkJc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMgPSBpc1N1cHBvcnRlZCAmJiAoIHRkc1sgMCBdLm9mZnNldEhlaWdodCA9PT0gMCApOwoKCQkvLyBDaGVjayBib3gtc2l6aW5nIGFuZCBtYXJnaW4gYmVoYXZpb3IKCQlkaXYuaW5uZXJIVE1MID0gIiI7CgkJZGl2LnN0eWxlLmNzc1RleHQgPSAiYm94LXNpemluZzpib3JkZXItYm94Oy1tb3otYm94LXNpemluZzpib3JkZXItYm94Oy13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94O3BhZGRpbmc6MXB4O2JvcmRlcjoxcHg7ZGlzcGxheTpibG9jazt3aWR0aDo0cHg7bWFyZ2luLXRvcDoxJTtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MSU7IjsKCQlzdXBwb3J0LmJveFNpemluZyA9ICggZGl2Lm9mZnNldFdpZHRoID09PSA0ICk7CgkJc3VwcG9ydC5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldCA9ICggYm9keS5vZmZzZXRUb3AgIT09IDEgKTsKCgkJLy8gVXNlIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlIGJlY2F1c2UganNkb20gb24gbm9kZS5qcyB3aWxsIGJyZWFrIHdpdGhvdXQgaXQuCgkJaWYgKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSApIHsKCQkJc3VwcG9ydC5waXhlbFBvc2l0aW9uID0gKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggZGl2LCBudWxsICkgfHwge30gKS50b3AgIT09ICIxJSI7CgkJCXN1cHBvcnQuYm94U2l6aW5nUmVsaWFibGUgPSAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBkaXYsIG51bGwgKSB8fCB7IHdpZHRoOiAiNHB4IiB9ICkud2lkdGggPT09ICI0cHgiOwoKCQkJLy8gQ2hlY2sgaWYgZGl2IHdpdGggZXhwbGljaXQgd2lkdGggYW5kIG5vIG1hcmdpbi1yaWdodCBpbmNvcnJlY3RseQoJCQkvLyBnZXRzIGNvbXB1dGVkIG1hcmdpbi1yaWdodCBiYXNlZCBvbiB3aWR0aCBvZiBjb250YWluZXIuICgjMzMzMykKCQkJLy8gRmFpbHMgaW4gV2ViS2l0IGJlZm9yZSBGZWIgMjAxMSBuaWdodGxpZXMKCQkJLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CgkJCW1hcmdpbkRpdiA9IGRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikgKTsKCQkJbWFyZ2luRGl2LnN0eWxlLmNzc1RleHQgPSBkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0OwoJCQltYXJnaW5EaXYuc3R5bGUubWFyZ2luUmlnaHQgPSBtYXJnaW5EaXYuc3R5bGUud2lkdGggPSAiMCI7CgkJCWRpdi5zdHlsZS53aWR0aCA9ICIxcHgiOwoKCQkJc3VwcG9ydC5yZWxpYWJsZU1hcmdpblJpZ2h0ID0KCQkJCSFwYXJzZUZsb2F0KCAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBtYXJnaW5EaXYsIG51bGwgKSB8fCB7fSApLm1hcmdpblJpZ2h0ICk7CgkJfQoKCQlpZiAoIHR5cGVvZiBkaXYuc3R5bGUuem9vbSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCS8vIFN1cHBvcnQ6IElFPDgKCQkJLy8gQ2hlY2sgaWYgbmF0aXZlbHkgYmxvY2stbGV2ZWwgZWxlbWVudHMgYWN0IGxpa2UgaW5saW5lLWJsb2NrCgkJCS8vIGVsZW1lbnRzIHdoZW4gc2V0dGluZyB0aGVpciBkaXNwbGF5IHRvICdpbmxpbmUnIGFuZCBnaXZpbmcKCQkJLy8gdGhlbSBsYXlvdXQKCQkJZGl2LmlubmVySFRNTCA9ICIiOwoJCQlkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0ICsgIndpZHRoOjFweDtwYWRkaW5nOjFweDtkaXNwbGF5OmlubGluZTt6b29tOjEiOwoJCQlzdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQgPSAoIGRpdi5vZmZzZXRXaWR0aCA9PT0gMyApOwoKCQkJLy8gU3VwcG9ydDogSUU2CgkJCS8vIENoZWNrIGlmIGVsZW1lbnRzIHdpdGggbGF5b3V0IHNocmluay13cmFwIHRoZWlyIGNoaWxkcmVuCgkJCWRpdi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJZGl2LmlubmVySFRNTCA9ICI8ZGl2PjwvZGl2PiI7CgkJCWRpdi5maXJzdENoaWxkLnN0eWxlLndpZHRoID0gIjVweCI7CgkJCXN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyA9ICggZGl2Lm9mZnNldFdpZHRoICE9PSAzICk7CgoJCQlpZiAoIHN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCApIHsKCQkJCS8vIFByZXZlbnQgSUUgNiBmcm9tIGFmZmVjdGluZyBsYXlvdXQgZm9yIHBvc2l0aW9uZWQgZWxlbWVudHMgIzExMDQ4CgkJCQkvLyBQcmV2ZW50IElFIGZyb20gc2hyaW5raW5nIHRoZSBib2R5IGluIElFIDcgbW9kZSAjMTI4NjkKCQkJCS8vIFN1cHBvcnQ6IElFPDgKCQkJCWJvZHkuc3R5bGUuem9vbSA9IDE7CgkJCX0KCQl9CgoJCWJvZHkucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwoKCQkvLyBOdWxsIGVsZW1lbnRzIHRvIGF2b2lkIGxlYWtzIGluIElFCgkJY29udGFpbmVyID0gZGl2ID0gdGRzID0gbWFyZ2luRGl2ID0gbnVsbDsKCX0pOwoKCS8vIE51bGwgZWxlbWVudHMgdG8gYXZvaWQgbGVha3MgaW4gSUUKCWFsbCA9IHNlbGVjdCA9IGZyYWdtZW50ID0gb3B0ID0gYSA9IGlucHV0ID0gbnVsbDsKCglyZXR1cm4gc3VwcG9ydDsKfSkoKTsKCnZhciByYnJhY2UgPSAvKD86XHtbXHNcU10qXH18XFtbXHNcU10qXF0pJC8sCglybXVsdGlEYXNoID0gLyhbQS1aXSkvZzsKCmZ1bmN0aW9uIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSwgcHZ0IC8qIEludGVybmFsIFVzZSBPbmx5ICovICl7CglpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCXJldHVybjsKCX0KCgl2YXIgdGhpc0NhY2hlLCByZXQsCgkJaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbywKCQlnZXRCeU5hbWUgPSB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIsCgoJCS8vIFdlIGhhdmUgdG8gaGFuZGxlIERPTSBub2RlcyBhbmQgSlMgb2JqZWN0cyBkaWZmZXJlbnRseSBiZWNhdXNlIElFNi03CgkJLy8gY2FuJ3QgR0Mgb2JqZWN0IHJlZmVyZW5jZXMgcHJvcGVybHkgYWNyb3NzIHRoZSBET00tSlMgYm91bmRhcnkKCQlpc05vZGUgPSBlbGVtLm5vZGVUeXBlLAoKCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIHRoZSBnbG9iYWwgalF1ZXJ5IGNhY2hlOyBKUyBvYmplY3QgZGF0YSBpcwoJCS8vIGF0dGFjaGVkIGRpcmVjdGx5IHRvIHRoZSBvYmplY3Qgc28gR0MgY2FuIG9jY3VyIGF1dG9tYXRpY2FsbHkKCQljYWNoZSA9IGlzTm9kZSA/IGpRdWVyeS5jYWNoZSA6IGVsZW0sCgoJCS8vIE9ubHkgZGVmaW5pbmcgYW4gSUQgZm9yIEpTIG9iamVjdHMgaWYgaXRzIGNhY2hlIGFscmVhZHkgZXhpc3RzIGFsbG93cwoJCS8vIHRoZSBjb2RlIHRvIHNob3J0Y3V0IG9uIHRoZSBzYW1lIHBhdGggYXMgYSBET00gbm9kZSB3aXRoIG5vIGNhY2hlCgkJaWQgPSBpc05vZGUgPyBlbGVtWyBpbnRlcm5hbEtleSBdIDogZWxlbVsgaW50ZXJuYWxLZXkgXSAmJiBpbnRlcm5hbEtleTsKCgkvLyBBdm9pZCBkb2luZyBhbnkgbW9yZSB3b3JrIHRoYW4gd2UgbmVlZCB0byB3aGVuIHRyeWluZyB0byBnZXQgZGF0YSBvbiBhbgoJLy8gb2JqZWN0IHRoYXQgaGFzIG5vIGRhdGEgYXQgYWxsCglpZiAoICghaWQgfHwgIWNhY2hlW2lkXSB8fCAoIXB2dCAmJiAhY2FjaGVbaWRdLmRhdGEpKSAmJiBnZXRCeU5hbWUgJiYgZGF0YSA9PT0gdW5kZWZpbmVkICkgewoJCXJldHVybjsKCX0KCglpZiAoICFpZCApIHsKCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIGEgbmV3IHVuaXF1ZSBJRCBmb3IgZWFjaCBlbGVtZW50IHNpbmNlIHRoZWlyIGRhdGEKCQkvLyBlbmRzIHVwIGluIHRoZSBnbG9iYWwgY2FjaGUKCQlpZiAoIGlzTm9kZSApIHsKCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IGlkID0gY29yZV9kZWxldGVkSWRzLnBvcCgpIHx8IGpRdWVyeS5ndWlkKys7CgkJfSBlbHNlIHsKCQkJaWQgPSBpbnRlcm5hbEtleTsKCQl9Cgl9CgoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgkJY2FjaGVbIGlkIF0gPSB7fTsKCgkJLy8gQXZvaWRzIGV4cG9zaW5nIGpRdWVyeSBtZXRhZGF0YSBvbiBwbGFpbiBKUyBvYmplY3RzIHdoZW4gdGhlIG9iamVjdAoJCS8vIGlzIHNlcmlhbGl6ZWQgdXNpbmcgSlNPTi5zdHJpbmdpZnkKCQlpZiAoICFpc05vZGUgKSB7CgkJCWNhY2hlWyBpZCBdLnRvSlNPTiA9IGpRdWVyeS5ub29wOwoJCX0KCX0KCgkvLyBBbiBvYmplY3QgY2FuIGJlIHBhc3NlZCB0byBqUXVlcnkuZGF0YSBpbnN0ZWFkIG9mIGEga2V5L3ZhbHVlIHBhaXI7IHRoaXMgZ2V0cwoJLy8gc2hhbGxvdyBjb3BpZWQgb3ZlciBvbnRvIHRoZSBleGlzdGluZyBjYWNoZQoJaWYgKCB0eXBlb2YgbmFtZSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIG5hbWUgPT09ICJmdW5jdGlvbiIgKSB7CgkJaWYgKCBwdnQgKSB7CgkJCWNhY2hlWyBpZCBdID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0sIG5hbWUgKTsKCQl9IGVsc2UgewoJCQljYWNoZVsgaWQgXS5kYXRhID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0uZGF0YSwgbmFtZSApOwoJCX0KCX0KCgl0aGlzQ2FjaGUgPSBjYWNoZVsgaWQgXTsKCgkvLyBqUXVlcnkgZGF0YSgpIGlzIHN0b3JlZCBpbiBhIHNlcGFyYXRlIG9iamVjdCBpbnNpZGUgdGhlIG9iamVjdCdzIGludGVybmFsIGRhdGEKCS8vIGNhY2hlIGluIG9yZGVyIHRvIGF2b2lkIGtleSBjb2xsaXNpb25zIGJldHdlZW4gaW50ZXJuYWwgZGF0YSBhbmQgdXNlci1kZWZpbmVkCgkvLyBkYXRhLgoJaWYgKCAhcHZ0ICkgewoJCWlmICggIXRoaXNDYWNoZS5kYXRhICkgewoJCQl0aGlzQ2FjaGUuZGF0YSA9IHt9OwoJCX0KCgkJdGhpc0NhY2hlID0gdGhpc0NhY2hlLmRhdGE7Cgl9CgoJaWYgKCBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJdGhpc0NhY2hlWyBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICkgXSA9IGRhdGE7Cgl9CgoJLy8gQ2hlY2sgZm9yIGJvdGggY29udmVydGVkLXRvLWNhbWVsIGFuZCBub24tY29udmVydGVkIGRhdGEgcHJvcGVydHkgbmFtZXMKCS8vIElmIGEgZGF0YSBwcm9wZXJ0eSB3YXMgc3BlY2lmaWVkCglpZiAoIGdldEJ5TmFtZSApIHsKCgkJLy8gRmlyc3QgVHJ5IHRvIGZpbmQgYXMtaXMgcHJvcGVydHkgZGF0YQoJCXJldCA9IHRoaXNDYWNoZVsgbmFtZSBdOwoKCQkvLyBUZXN0IGZvciBudWxsfHVuZGVmaW5lZCBwcm9wZXJ0eSBkYXRhCgkJaWYgKCByZXQgPT0gbnVsbCApIHsKCgkJCS8vIFRyeSB0byBmaW5kIHRoZSBjYW1lbENhc2VkIHByb3BlcnR5CgkJCXJldCA9IHRoaXNDYWNoZVsgalF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApIF07CgkJfQoJfSBlbHNlIHsKCQlyZXQgPSB0aGlzQ2FjaGU7Cgl9CgoJcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lLCBwdnQgKSB7CglpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCXJldHVybjsKCX0KCgl2YXIgaSwgbCwgdGhpc0NhY2hlLAoJCWlzTm9kZSA9IGVsZW0ubm9kZVR5cGUsCgoJCS8vIFNlZSBqUXVlcnkuZGF0YSBmb3IgbW9yZSBpbmZvcm1hdGlvbgoJCWNhY2hlID0gaXNOb2RlID8galF1ZXJ5LmNhY2hlIDogZWxlbSwKCQlpZCA9IGlzTm9kZSA/IGVsZW1bIGpRdWVyeS5leHBhbmRvIF0gOiBqUXVlcnkuZXhwYW5kbzsKCgkvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IG5vIGNhY2hlIGVudHJ5IGZvciB0aGlzIG9iamVjdCwgdGhlcmUgaXMgbm8KCS8vIHB1cnBvc2UgaW4gY29udGludWluZwoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgkJcmV0dXJuOwoJfQoKCWlmICggbmFtZSApIHsKCgkJdGhpc0NhY2hlID0gcHZ0ID8gY2FjaGVbIGlkIF0gOiBjYWNoZVsgaWQgXS5kYXRhOwoKCQlpZiAoIHRoaXNDYWNoZSApIHsKCgkJCS8vIFN1cHBvcnQgYXJyYXkgb3Igc3BhY2Ugc2VwYXJhdGVkIHN0cmluZyBuYW1lcyBmb3IgZGF0YSBrZXlzCgkJCWlmICggIWpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgoJCQkJLy8gdHJ5IHRoZSBzdHJpbmcgYXMgYSBrZXkgYmVmb3JlIGFueSBtYW5pcHVsYXRpb24KCQkJCWlmICggbmFtZSBpbiB0aGlzQ2FjaGUgKSB7CgkJCQkJbmFtZSA9IFsgbmFtZSBdOwoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gc3BsaXQgdGhlIGNhbWVsIGNhc2VkIHZlcnNpb24gYnkgc3BhY2VzIHVubGVzcyBhIGtleSB3aXRoIHRoZSBzcGFjZXMgZXhpc3RzCgkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCQkJCQlpZiAoIG5hbWUgaW4gdGhpc0NhY2hlICkgewoJCQkJCQluYW1lID0gWyBuYW1lIF07CgkJCQkJfSBlbHNlIHsKCQkJCQkJbmFtZSA9IG5hbWUuc3BsaXQoIiAiKTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQkvLyBJZiAibmFtZSIgaXMgYW4gYXJyYXkgb2Yga2V5cy4uLgoJCQkJLy8gV2hlbiBkYXRhIGlzIGluaXRpYWxseSBjcmVhdGVkLCB2aWEgKCJrZXkiLCAidmFsIikgc2lnbmF0dXJlLAoJCQkJLy8ga2V5cyB3aWxsIGJlIGNvbnZlcnRlZCB0byBjYW1lbENhc2UuCgkJCQkvLyBTaW5jZSB0aGVyZSBpcyBubyB3YXkgdG8gdGVsbCBfaG93XyBhIGtleSB3YXMgYWRkZWQsIHJlbW92ZQoJCQkJLy8gYm90aCBwbGFpbiBrZXkgYW5kIGNhbWVsQ2FzZSBrZXkuICMxMjc4NgoJCQkJLy8gVGhpcyB3aWxsIG9ubHkgcGVuYWxpemUgdGhlIGFycmF5IGFyZ3VtZW50IHBhdGguCgkJCQluYW1lID0gbmFtZS5jb25jYXQoIGpRdWVyeS5tYXAoIG5hbWUsIGpRdWVyeS5jYW1lbENhc2UgKSApOwoJCQl9CgoJCQlmb3IgKCBpID0gMCwgbCA9IG5hbWUubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJZGVsZXRlIHRoaXNDYWNoZVsgbmFtZVtpXSBdOwoJCQl9CgoJCQkvLyBJZiB0aGVyZSBpcyBubyBkYXRhIGxlZnQgaW4gdGhlIGNhY2hlLCB3ZSB3YW50IHRvIGNvbnRpbnVlCgkJCS8vIGFuZCBsZXQgdGhlIGNhY2hlIG9iamVjdCBpdHNlbGYgZ2V0IGRlc3Ryb3llZAoJCQlpZiAoICEoIHB2dCA/IGlzRW1wdHlEYXRhT2JqZWN0IDogalF1ZXJ5LmlzRW1wdHlPYmplY3QgKSggdGhpc0NhY2hlICkgKSB7CgkJCQlyZXR1cm47CgkJCX0KCQl9Cgl9CgoJLy8gU2VlIGpRdWVyeS5kYXRhIGZvciBtb3JlIGluZm9ybWF0aW9uCglpZiAoICFwdnQgKSB7CgkJZGVsZXRlIGNhY2hlWyBpZCBdLmRhdGE7CgoJCS8vIERvbid0IGRlc3Ryb3kgdGhlIHBhcmVudCBjYWNoZSB1bmxlc3MgdGhlIGludGVybmFsIGRhdGEgb2JqZWN0CgkJLy8gaGFkIGJlZW4gdGhlIG9ubHkgdGhpbmcgbGVmdCBpbiBpdAoJCWlmICggIWlzRW1wdHlEYXRhT2JqZWN0KCBjYWNoZVsgaWQgXSApICkgewoJCQlyZXR1cm47CgkJfQoJfQoKCS8vIERlc3Ryb3kgdGhlIGNhY2hlCglpZiAoIGlzTm9kZSApIHsKCQlqUXVlcnkuY2xlYW5EYXRhKCBbIGVsZW0gXSwgdHJ1ZSApOwoKCS8vIFVzZSBkZWxldGUgd2hlbiBzdXBwb3J0ZWQgZm9yIGV4cGFuZG9zIG9yIGBjYWNoZWAgaXMgbm90IGEgd2luZG93IHBlciBpc1dpbmRvdyAoIzEwMDgwKQoJfSBlbHNlIGlmICggalF1ZXJ5LnN1cHBvcnQuZGVsZXRlRXhwYW5kbyB8fCBjYWNoZSAhPSBjYWNoZS53aW5kb3cgKSB7CgkJZGVsZXRlIGNhY2hlWyBpZCBdOwoKCS8vIFdoZW4gYWxsIGVsc2UgZmFpbHMsIG51bGwKCX0gZWxzZSB7CgkJY2FjaGVbIGlkIF0gPSBudWxsOwoJfQp9CgpqUXVlcnkuZXh0ZW5kKHsKCWNhY2hlOiB7fSwKCgkvLyBVbmlxdWUgZm9yIGVhY2ggY29weSBvZiBqUXVlcnkgb24gdGhlIHBhZ2UKCS8vIE5vbi1kaWdpdHMgcmVtb3ZlZCB0byBtYXRjaCByaW5saW5lalF1ZXJ5CglleHBhbmRvOiAialF1ZXJ5IiArICggY29yZV92ZXJzaW9uICsgTWF0aC5yYW5kb20oKSApLnJlcGxhY2UoIC9cRC9nLCAiIiApLAoKCS8vIFRoZSBmb2xsb3dpbmcgZWxlbWVudHMgdGhyb3cgdW5jYXRjaGFibGUgZXhjZXB0aW9ucyBpZiB5b3UKCS8vIGF0dGVtcHQgdG8gYWRkIGV4cGFuZG8gcHJvcGVydGllcyB0byB0aGVtLgoJbm9EYXRhOiB7CgkJImVtYmVkIjogdHJ1ZSwKCQkvLyBCYW4gYWxsIG9iamVjdHMgZXhjZXB0IGZvciBGbGFzaCAod2hpY2ggaGFuZGxlIGV4cGFuZG9zKQoJCSJvYmplY3QiOiAiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIiwKCQkiYXBwbGV0IjogdHJ1ZQoJfSwKCgloYXNEYXRhOiBmdW5jdGlvbiggZWxlbSApIHsKCQllbGVtID0gZWxlbS5ub2RlVHlwZSA/IGpRdWVyeS5jYWNoZVsgZWxlbVtqUXVlcnkuZXhwYW5kb10gXSA6IGVsZW1bIGpRdWVyeS5leHBhbmRvIF07CgkJcmV0dXJuICEhZWxlbSAmJiAhaXNFbXB0eURhdGFPYmplY3QoIGVsZW0gKTsKCX0sCgoJZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJcmV0dXJuIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSApOwoJfSwKCglyZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lICk7Cgl9LAoKCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCV9kYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZGF0YSApIHsKCQlyZXR1cm4gaW50ZXJuYWxEYXRhKCBlbGVtLCBuYW1lLCBkYXRhLCB0cnVlICk7Cgl9LAoKCV9yZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lLCB0cnVlICk7Cgl9LAoKCS8vIEEgbWV0aG9kIGZvciBkZXRlcm1pbmluZyBpZiBhIERPTSBub2RlIGNhbiBoYW5kbGUgdGhlIGRhdGEgZXhwYW5kbwoJYWNjZXB0RGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7CgkJLy8gRG8gbm90IHNldCBkYXRhIG9uIG5vbi1lbGVtZW50IGJlY2F1c2UgaXQgd2lsbCBub3QgYmUgY2xlYXJlZCAoIzgzMzUpLgoJCWlmICggZWxlbS5ub2RlVHlwZSAmJiBlbGVtLm5vZGVUeXBlICE9PSAxICYmIGVsZW0ubm9kZVR5cGUgIT09IDkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXZhciBub0RhdGEgPSBlbGVtLm5vZGVOYW1lICYmIGpRdWVyeS5ub0RhdGFbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkvLyBub2RlcyBhY2NlcHQgZGF0YSB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZDsgcmVqZWN0aW9uIGNhbiBiZSBjb25kaXRpb25hbAoJCXJldHVybiAhbm9EYXRhIHx8IG5vRGF0YSAhPT0gdHJ1ZSAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3NpZCIpID09PSBub0RhdGE7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglkYXRhOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgYXR0cnMsIG5hbWUsCgkJCWVsZW0gPSB0aGlzWzBdLAoJCQlpID0gMCwKCQkJZGF0YSA9IG51bGw7CgoJCS8vIEdldHMgYWxsIHZhbHVlcwoJCWlmICgga2V5ID09PSB1bmRlZmluZWQgKSB7CgkJCWlmICggdGhpcy5sZW5ndGggKSB7CgkJCQlkYXRhID0galF1ZXJ5LmRhdGEoIGVsZW0gKTsKCgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgInBhcnNlZEF0dHJzIiApICkgewoJCQkJCWF0dHJzID0gZWxlbS5hdHRyaWJ1dGVzOwoJCQkJCWZvciAoIDsgaSA8IGF0dHJzLmxlbmd0aDsgaSsrICkgewoJCQkJCQluYW1lID0gYXR0cnNbaV0ubmFtZTsKCgkJCQkJCWlmICggIW5hbWUuaW5kZXhPZiggImRhdGEtIiApICkgewoJCQkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUuc2xpY2UoNSkgKTsKCgkJCQkJCQlkYXRhQXR0ciggZWxlbSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJalF1ZXJ5Ll9kYXRhKCBlbGVtLCAicGFyc2VkQXR0cnMiLCB0cnVlICk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiBkYXRhOwoJCX0KCgkJLy8gU2V0cyBtdWx0aXBsZSB2YWx1ZXMKCQlpZiAoIHR5cGVvZiBrZXkgPT09ICJvYmplY3QiICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRhdGEoIHRoaXMsIGtleSApOwoJCQl9KTsKCQl9CgoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgoJCQlpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCQkvLyBUcnkgdG8gZmV0Y2ggYW55IGludGVybmFsbHkgc3RvcmVkIGRhdGEgZmlyc3QKCQkJCXJldHVybiBlbGVtID8gZGF0YUF0dHIoIGVsZW0sIGtleSwgalF1ZXJ5LmRhdGEoIGVsZW0sIGtleSApICkgOiBudWxsOwoJCQl9CgoJCQl0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZGF0YSggdGhpcywga2V5LCB2YWx1ZSApOwoJCQl9KTsKCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsIHRydWUgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkucmVtb3ZlRGF0YSggdGhpcywga2V5ICk7CgkJfSk7Cgl9Cn0pOwoKZnVuY3Rpb24gZGF0YUF0dHIoIGVsZW0sIGtleSwgZGF0YSApIHsKCS8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKCS8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQoJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCgkJdmFyIG5hbWUgPSAiZGF0YS0iICsga2V5LnJlcGxhY2UoIHJtdWx0aURhc2gsICItJDEiICkudG9Mb3dlckNhc2UoKTsKCgkJZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQl0cnkgewoJCQkJZGF0YSA9IGRhdGEgPT09ICJ0cnVlIiA/IHRydWUgOgoJCQkJCWRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6CgkJCQkJZGF0YSA9PT0gIm51bGwiID8gbnVsbCA6CgkJCQkJLy8gT25seSBjb252ZXJ0IHRvIGEgbnVtYmVyIGlmIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSBzdHJpbmcKCQkJCQkrZGF0YSArICIiID09PSBkYXRhID8gK2RhdGEgOgoJCQkJCXJicmFjZS50ZXN0KCBkYXRhICkgPyBqUXVlcnkucGFyc2VKU09OKCBkYXRhICkgOgoJCQkJCQlkYXRhOwoJCQl9IGNhdGNoKCBlICkge30KCgkJCS8vIE1ha2Ugc3VyZSB3ZSBzZXQgdGhlIGRhdGEgc28gaXQgaXNuJ3QgY2hhbmdlZCBsYXRlcgoJCQlqUXVlcnkuZGF0YSggZWxlbSwga2V5LCBkYXRhICk7CgoJCX0gZWxzZSB7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoJfQoKCXJldHVybiBkYXRhOwp9CgovLyBjaGVja3MgYSBjYWNoZSBvYmplY3QgZm9yIGVtcHRpbmVzcwpmdW5jdGlvbiBpc0VtcHR5RGF0YU9iamVjdCggb2JqICkgewoJdmFyIG5hbWU7Cglmb3IgKCBuYW1lIGluIG9iaiApIHsKCgkJLy8gaWYgdGhlIHB1YmxpYyBkYXRhIG9iamVjdCBpcyBlbXB0eSwgdGhlIHByaXZhdGUgaXMgc3RpbGwgZW1wdHkKCQlpZiAoIG5hbWUgPT09ICJkYXRhIiAmJiBqUXVlcnkuaXNFbXB0eU9iamVjdCggb2JqW25hbWVdICkgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlpZiAoIG5hbWUgIT09ICJ0b0pTT04iICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCXJldHVybiB0cnVlOwp9CmpRdWVyeS5leHRlbmQoewoJcXVldWU6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBkYXRhICkgewoJCXZhciBxdWV1ZTsKCgkJaWYgKCBlbGVtICkgewoJCQl0eXBlID0gKCB0eXBlIHx8ICJmeCIgKSArICJxdWV1ZSI7CgkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlICk7CgoJCQkvLyBTcGVlZCB1cCBkZXF1ZXVlIGJ5IGdldHRpbmcgb3V0IHF1aWNrbHkgaWYgdGhpcyBpcyBqdXN0IGEgbG9va3VwCgkJCWlmICggZGF0YSApIHsKCQkJCWlmICggIXF1ZXVlIHx8IGpRdWVyeS5pc0FycmF5KGRhdGEpICkgewoJCQkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KGRhdGEpICk7CgkJCQl9IGVsc2UgewoJCQkJCXF1ZXVlLnB1c2goIGRhdGEgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gcXVldWUgfHwgW107CgkJfQoJfSwKCglkZXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsKCQl0eXBlID0gdHlwZSB8fCAiZngiOwoKCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSwKCQkJc3RhcnRMZW5ndGggPSBxdWV1ZS5sZW5ndGgsCgkJCWZuID0gcXVldWUuc2hpZnQoKSwKCQkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sIHR5cGUgKSwKCQkJbmV4dCA9IGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRlcXVldWUoIGVsZW0sIHR5cGUgKTsKCQkJfTsKCgkJLy8gSWYgdGhlIGZ4IHF1ZXVlIGlzIGRlcXVldWVkLCBhbHdheXMgcmVtb3ZlIHRoZSBwcm9ncmVzcyBzZW50aW5lbAoJCWlmICggZm4gPT09ICJpbnByb2dyZXNzIiApIHsKCQkJZm4gPSBxdWV1ZS5zaGlmdCgpOwoJCQlzdGFydExlbmd0aC0tOwoJCX0KCgkJaG9va3MuY3VyID0gZm47CgkJaWYgKCBmbiApIHsKCgkJCS8vIEFkZCBhIHByb2dyZXNzIHNlbnRpbmVsIHRvIHByZXZlbnQgdGhlIGZ4IHF1ZXVlIGZyb20gYmVpbmcKCQkJLy8gYXV0b21hdGljYWxseSBkZXF1ZXVlZAoJCQlpZiAoIHR5cGUgPT09ICJmeCIgKSB7CgkJCQlxdWV1ZS51bnNoaWZ0KCAiaW5wcm9ncmVzcyIgKTsKCQkJfQoKCQkJLy8gY2xlYXIgdXAgdGhlIGxhc3QgcXVldWUgc3RvcCBmdW5jdGlvbgoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJZm4uY2FsbCggZWxlbSwgbmV4dCwgaG9va3MgKTsKCQl9CgoJCWlmICggIXN0YXJ0TGVuZ3RoICYmIGhvb2tzICkgewoJCQlob29rcy5lbXB0eS5maXJlKCk7CgkJfQoJfSwKCgkvLyBub3QgaW50ZW5kZWQgZm9yIHB1YmxpYyBjb25zdW1wdGlvbiAtIGdlbmVyYXRlcyBhIHF1ZXVlSG9va3Mgb2JqZWN0LCBvciByZXR1cm5zIHRoZSBjdXJyZW50IG9uZQoJX3F1ZXVlSG9va3M6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkgewoJCXZhciBrZXkgPSB0eXBlICsgInF1ZXVlSG9va3MiOwoJCXJldHVybiBqUXVlcnkuX2RhdGEoIGVsZW0sIGtleSApIHx8IGpRdWVyeS5fZGF0YSggZWxlbSwga2V5LCB7CgkJCWVtcHR5OiBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLmFkZChmdW5jdGlvbigpIHsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwgdHlwZSArICJxdWV1ZSIgKTsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwga2V5ICk7CgkJCX0pCgkJfSk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglxdWV1ZTogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJdmFyIHNldHRlciA9IDI7CgoJCWlmICggdHlwZW9mIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQlkYXRhID0gdHlwZTsKCQkJdHlwZSA9ICJmeCI7CgkJCXNldHRlci0tOwoJCX0KCgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoIDwgc2V0dGVyICkgewoJCQlyZXR1cm4galF1ZXJ5LnF1ZXVlKCB0aGlzWzBdLCB0eXBlICk7CgkJfQoKCQlyZXR1cm4gZGF0YSA9PT0gdW5kZWZpbmVkID8KCQkJdGhpcyA6CgkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBxdWV1ZSA9IGpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgZGF0YSApOwoKCQkJCS8vIGVuc3VyZSBhIGhvb2tzIGZvciB0aGlzIHF1ZXVlCgkJCQlqUXVlcnkuX3F1ZXVlSG9va3MoIHRoaXMsIHR5cGUgKTsKCgkJCQlpZiAoIHR5cGUgPT09ICJmeCIgJiYgcXVldWVbMF0gIT09ICJpbnByb2dyZXNzIiApIHsKCQkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQkJfQoJCQl9KTsKCX0sCglkZXF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCX0pOwoJfSwKCS8vIEJhc2VkIG9mZiBvZiB0aGUgcGx1Z2luIGJ5IENsaW50IEhlbGZlcnMsIHdpdGggcGVybWlzc2lvbi4KCS8vIGh0dHA6Ly9ibGluZHNpZ25hbHMuY29tL2luZGV4LnBocC8yMDA5LzA3L2pxdWVyeS1kZWxheS8KCWRlbGF5OiBmdW5jdGlvbiggdGltZSwgdHlwZSApIHsKCQl0aW1lID0galF1ZXJ5LmZ4ID8galF1ZXJ5LmZ4LnNwZWVkc1sgdGltZSBdIHx8IHRpbWUgOiB0aW1lOwoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7CgkJCXZhciB0aW1lb3V0ID0gc2V0VGltZW91dCggbmV4dCwgdGltZSApOwoJCQlob29rcy5zdG9wID0gZnVuY3Rpb24oKSB7CgkJCQljbGVhclRpbWVvdXQoIHRpbWVvdXQgKTsKCQkJfTsKCQl9KTsKCX0sCgljbGVhclF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJfSwKCS8vIEdldCBhIHByb21pc2UgcmVzb2x2ZWQgd2hlbiBxdWV1ZXMgb2YgYSBjZXJ0YWluIHR5cGUKCS8vIGFyZSBlbXB0aWVkIChmeCBpcyB0aGUgdHlwZSBieSBkZWZhdWx0KQoJcHJvbWlzZTogZnVuY3Rpb24oIHR5cGUsIG9iaiApIHsKCQl2YXIgdG1wLAoJCQljb3VudCA9IDEsCgkJCWRlZmVyID0galF1ZXJ5LkRlZmVycmVkKCksCgkJCWVsZW1lbnRzID0gdGhpcywKCQkJaSA9IHRoaXMubGVuZ3RoLAoJCQlyZXNvbHZlID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoICEoIC0tY291bnQgKSApIHsKCQkJCQlkZWZlci5yZXNvbHZlV2l0aCggZWxlbWVudHMsIFsgZWxlbWVudHMgXSApOwoJCQkJfQoJCQl9OwoKCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJb2JqID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJdHlwZSA9IHR5cGUgfHwgImZ4IjsKCgkJd2hpbGUoIGktLSApIHsKCQkJdG1wID0galF1ZXJ5Ll9kYXRhKCBlbGVtZW50c1sgaSBdLCB0eXBlICsgInF1ZXVlSG9va3MiICk7CgkJCWlmICggdG1wICYmIHRtcC5lbXB0eSApIHsKCQkJCWNvdW50Kys7CgkJCQl0bXAuZW1wdHkuYWRkKCByZXNvbHZlICk7CgkJCX0KCQl9CgkJcmVzb2x2ZSgpOwoJCXJldHVybiBkZWZlci5wcm9taXNlKCBvYmogKTsKCX0KfSk7CnZhciBub2RlSG9vaywgYm9vbEhvb2ssCglyY2xhc3MgPSAvW1x0XHJcbl0vZywKCXJyZXR1cm4gPSAvXHIvZywKCXJmb2N1c2FibGUgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvaSwKCXJjbGlja2FibGUgPSAvXig/OmF8YXJlYSkkL2ksCglyYm9vbGVhbiA9IC9eKD86Y2hlY2tlZHxzZWxlY3RlZHxhdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQpJC9pLAoJcnVzZURlZmF1bHQgPSAvXig/OmNoZWNrZWR8c2VsZWN0ZWQpJC9pLAoJZ2V0U2V0QXR0cmlidXRlID0galF1ZXJ5LnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlLAoJZ2V0U2V0SW5wdXQgPSBqUXVlcnkuc3VwcG9ydC5pbnB1dDsKCmpRdWVyeS5mbi5leHRlbmQoewoJYXR0cjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBqUXVlcnkuYXR0ciwgbmFtZSwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxICk7Cgl9LAoKCXJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBuYW1lICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5yZW1vdmVBdHRyKCB0aGlzLCBuYW1lICk7CgkJfSk7Cgl9LAoKCXByb3A6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgalF1ZXJ5LnByb3AsIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOwoJfSwKCglyZW1vdmVQcm9wOiBmdW5jdGlvbiggbmFtZSApIHsKCQluYW1lID0galF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lOwoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCS8vIHRyeS9jYXRjaCBoYW5kbGVzIGNhc2VzIHdoZXJlIElFIGJhbGtzIChzdWNoIGFzIHJlbW92aW5nIGEgcHJvcGVydHkgb24gd2luZG93KQoJCQl0cnkgewoJCQkJdGhpc1sgbmFtZSBdID0gdW5kZWZpbmVkOwoJCQkJZGVsZXRlIHRoaXNbIG5hbWUgXTsKCQkJfSBjYXRjaCggZSApIHt9CgkJfSk7Cgl9LAoKCWFkZENsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzZXMsIGVsZW0sIGN1ciwgY2xhenosIGosCgkJCWkgPSAwLAoJCQlsZW4gPSB0aGlzLmxlbmd0aCwKCQkJcHJvY2VlZCA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgdmFsdWU7CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGogKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS5hZGRDbGFzcyggdmFsdWUuY2FsbCggdGhpcywgaiwgdGhpcy5jbGFzc05hbWUgKSApOwoJCQl9KTsKCQl9CgoJCWlmICggcHJvY2VlZCApIHsKCQkJLy8gVGhlIGRpc2p1bmN0aW9uIGhlcmUgaXMgZm9yIGJldHRlciBjb21wcmVzc2liaWxpdHkgKHNlZSByZW1vdmVDbGFzcykKCQkJY2xhc3NlcyA9ICggdmFsdWUgfHwgIiIgKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbXTsKCgkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJZWxlbSA9IHRoaXNbIGkgXTsKCQkJCWN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgKCBlbGVtLmNsYXNzTmFtZSA/CgkJCQkJKCAiICIgKyBlbGVtLmNsYXNzTmFtZSArICIgIiApLnJlcGxhY2UoIHJjbGFzcywgIiAiICkgOgoJCQkJCSIgIgoJCQkJKTsKCgkJCQlpZiAoIGN1ciApIHsKCQkJCQlqID0gMDsKCQkJCQl3aGlsZSAoIChjbGF6eiA9IGNsYXNzZXNbaisrXSkgKSB7CgkJCQkJCWlmICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPCAwICkgewoJCQkJCQkJY3VyICs9IGNsYXp6ICsgIiAiOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWVsZW0uY2xhc3NOYW1lID0galF1ZXJ5LnRyaW0oIGN1ciApOwoKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzZXMsIGVsZW0sIGN1ciwgY2xhenosIGosCgkJCWkgPSAwLAoJCQlsZW4gPSB0aGlzLmxlbmd0aCwKCQkJcHJvY2VlZCA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZTsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaiApIHsKCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZUNsYXNzKCB2YWx1ZS5jYWxsKCB0aGlzLCBqLCB0aGlzLmNsYXNzTmFtZSApICk7CgkJCX0pOwoJCX0KCQlpZiAoIHByb2NlZWQgKSB7CgkJCWNsYXNzZXMgPSAoIHZhbHVlIHx8ICIiICkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW107CgoJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWVsZW0gPSB0aGlzWyBpIF07CgkJCQkvLyBUaGlzIGV4cHJlc3Npb24gaXMgaGVyZSBmb3IgYmV0dGVyIGNvbXByZXNzaWJpbGl0eSAoc2VlIGFkZENsYXNzKQoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiIKCQkJCSk7CgoJCQkJaWYgKCBjdXIgKSB7CgkJCQkJaiA9IDA7CgkJCQkJd2hpbGUgKCAoY2xhenogPSBjbGFzc2VzW2orK10pICkgewoJCQkJCQkvLyBSZW1vdmUgKmFsbCogaW5zdGFuY2VzCgkJCQkJCXdoaWxlICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPj0gMCApIHsKCQkJCQkJCWN1ciA9IGN1ci5yZXBsYWNlKCAiICIgKyBjbGF6eiArICIgIiwgIiAiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxlbS5jbGFzc05hbWUgPSB2YWx1ZSA/IGpRdWVyeS50cmltKCBjdXIgKSA6ICIiOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJdG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSwgc3RhdGVWYWwgKSB7CgkJdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWUsCgkJCWlzQm9vbCA9IHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkudG9nZ2xlQ2xhc3MoIHZhbHVlLmNhbGwodGhpcywgaSwgdGhpcy5jbGFzc05hbWUsIHN0YXRlVmFsKSwgc3RhdGVWYWwgKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoIHR5cGUgPT09ICJzdHJpbmciICkgewoJCQkJLy8gdG9nZ2xlIGluZGl2aWR1YWwgY2xhc3MgbmFtZXMKCQkJCXZhciBjbGFzc05hbWUsCgkJCQkJaSA9IDAsCgkJCQkJc2VsZiA9IGpRdWVyeSggdGhpcyApLAoJCQkJCXN0YXRlID0gc3RhdGVWYWwsCgkJCQkJY2xhc3NOYW1lcyA9IHZhbHVlLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFtdOwoKCQkJCXdoaWxlICggKGNsYXNzTmFtZSA9IGNsYXNzTmFtZXNbIGkrKyBdKSApIHsKCQkJCQkvLyBjaGVjayBlYWNoIGNsYXNzTmFtZSBnaXZlbiwgc3BhY2Ugc2VwYXJhdGVkIGxpc3QKCQkJCQlzdGF0ZSA9IGlzQm9vbCA/IHN0YXRlIDogIXNlbGYuaGFzQ2xhc3MoIGNsYXNzTmFtZSApOwoJCQkJCXNlbGZbIHN0YXRlID8gImFkZENsYXNzIiA6ICJyZW1vdmVDbGFzcyIgXSggY2xhc3NOYW1lICk7CgkJCQl9CgoJCQkvLyBUb2dnbGUgd2hvbGUgY2xhc3MgbmFtZQoJCQl9IGVsc2UgaWYgKCB0eXBlID09PSBjb3JlX3N0cnVuZGVmaW5lZCB8fCB0eXBlID09PSAiYm9vbGVhbiIgKSB7CgkJCQlpZiAoIHRoaXMuY2xhc3NOYW1lICkgewoJCQkJCS8vIHN0b3JlIGNsYXNzTmFtZSBpZiBzZXQKCQkJCQlqUXVlcnkuX2RhdGEoIHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgdGhpcy5jbGFzc05hbWUgKTsKCQkJCX0KCgkJCQkvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBjbGFzcyBuYW1lIG9yIGlmIHdlJ3JlIHBhc3NlZCAiZmFsc2UiLAoJCQkJLy8gdGhlbiByZW1vdmUgdGhlIHdob2xlIGNsYXNzbmFtZSAoaWYgdGhlcmUgd2FzIG9uZSwgdGhlIGFib3ZlIHNhdmVkIGl0KS4KCQkJCS8vIE90aGVyd2lzZSBicmluZyBiYWNrIHdoYXRldmVyIHdhcyBwcmV2aW91c2x5IHNhdmVkIChpZiBhbnl0aGluZyksCgkJCQkvLyBmYWxsaW5nIGJhY2sgdG8gdGhlIGVtcHR5IHN0cmluZyBpZiBub3RoaW5nIHdhcyBzdG9yZWQuCgkJCQl0aGlzLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/ICIiIDogalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiX19jbGFzc05hbWVfXyIgKSB8fCAiIjsKCQkJfQoJCX0pOwoJfSwKCgloYXNDbGFzczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBjbGFzc05hbWUgPSAiICIgKyBzZWxlY3RvciArICIgIiwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aDsKCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCWlmICggdGhpc1tpXS5ub2RlVHlwZSA9PT0gMSAmJiAoIiAiICsgdGhpc1tpXS5jbGFzc05hbWUgKyAiICIpLnJlcGxhY2UocmNsYXNzLCAiICIpLmluZGV4T2YoIGNsYXNzTmFtZSApID49IDAgKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfSwKCgl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgcmV0LCBob29rcywgaXNGdW5jdGlvbiwKCQkJZWxlbSA9IHRoaXNbMF07CgoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCWlmICggZWxlbSApIHsKCQkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJcmV0ID0gZWxlbS52YWx1ZTsKCgkJCQlyZXR1cm4gdHlwZW9mIHJldCA9PT0gInN0cmluZyIgPwoJCQkJCS8vIGhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQlyZXQucmVwbGFjZShycmV0dXJuLCAiIikgOgoJCQkJCS8vIGhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlcgoJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHZhbCwKCQkJCXNlbGYgPSBqUXVlcnkodGhpcyk7CgoJCQlpZiAoIHRoaXMubm9kZVR5cGUgIT09IDEgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmICggaXNGdW5jdGlvbiApIHsKCQkJCXZhbCA9IHZhbHVlLmNhbGwoIHRoaXMsIGksIHNlbGYudmFsKCkgKTsKCQkJfSBlbHNlIHsKCQkJCXZhbCA9IHZhbHVlOwoJCQl9CgoJCQkvLyBUcmVhdCBudWxsL3VuZGVmaW5lZCBhcyAiIjsgY29udmVydCBudW1iZXJzIHRvIHN0cmluZwoJCQlpZiAoIHZhbCA9PSBudWxsICkgewoJCQkJdmFsID0gIiI7CgkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWwgPT09ICJudW1iZXIiICkgewoJCQkJdmFsICs9ICIiOwoJCQl9IGVsc2UgaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsICkgKSB7CgkJCQl2YWwgPSBqUXVlcnkubWFwKHZhbCwgZnVuY3Rpb24gKCB2YWx1ZSApIHsKCQkJCQlyZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWUgKyAiIjsKCQkJCX0pOwoJCQl9CgoJCQlob29rcyA9IGpRdWVyeS52YWxIb29rc1sgdGhpcy50eXBlIF0gfHwgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTsKCgkJCS8vIElmIHNldCByZXR1cm5zIHVuZGVmaW5lZCwgZmFsbCBiYWNrIHRvIG5vcm1hbCBzZXR0aW5nCgkJCWlmICggIWhvb2tzIHx8ICEoInNldCIgaW4gaG9va3MpIHx8IGhvb2tzLnNldCggdGhpcywgdmFsLCAidmFsdWUiICkgPT09IHVuZGVmaW5lZCApIHsKCQkJCXRoaXMudmFsdWUgPSB2YWw7CgkJCX0KCQl9KTsKCX0KfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCXZhbEhvb2tzOiB7CgkJb3B0aW9uOiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBhdHRyaWJ1dGVzLnZhbHVlIGlzIHVuZGVmaW5lZCBpbiBCbGFja2JlcnJ5IDQuNyBidXQKCQkJCS8vIHVzZXMgLnZhbHVlLiBTZWUgIzY5MzIKCQkJCXZhciB2YWwgPSBlbGVtLmF0dHJpYnV0ZXMudmFsdWU7CgkJCQlyZXR1cm4gIXZhbCB8fCB2YWwuc3BlY2lmaWVkID8gZWxlbS52YWx1ZSA6IGVsZW0udGV4dDsKCQkJfQoJCX0sCgkJc2VsZWN0OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgdmFsdWUsIG9wdGlvbiwKCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLAoJCQkJCWluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LAoJCQkJCW9uZSA9IGVsZW0udHlwZSA9PT0gInNlbGVjdC1vbmUiIHx8IGluZGV4IDwgMCwKCQkJCQl2YWx1ZXMgPSBvbmUgPyBudWxsIDogW10sCgkJCQkJbWF4ID0gb25lID8gaW5kZXggKyAxIDogb3B0aW9ucy5sZW5ndGgsCgkJCQkJaSA9IGluZGV4IDwgMCA/CgkJCQkJCW1heCA6CgkJCQkJCW9uZSA/IGluZGV4IDogMDsKCgkJCQkvLyBMb29wIHRocm91Z2ggYWxsIHRoZSBzZWxlY3RlZCBvcHRpb25zCgkJCQlmb3IgKCA7IGkgPCBtYXg7IGkrKyApIHsKCQkJCQlvcHRpb24gPSBvcHRpb25zWyBpIF07CgoJCQkJCS8vIG9sZElFIGRvZXNuJ3QgdXBkYXRlIHNlbGVjdGVkIGFmdGVyIGZvcm0gcmVzZXQgKCMyNTUxKQoJCQkJCWlmICggKCBvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXggKSAmJgoJCQkJCQkJLy8gRG9uJ3QgcmV0dXJuIG9wdGlvbnMgdGhhdCBhcmUgZGlzYWJsZWQgb3IgaW4gYSBkaXNhYmxlZCBvcHRncm91cAoJCQkJCQkJKCBqUXVlcnkuc3VwcG9ydC5vcHREaXNhYmxlZCA/ICFvcHRpb24uZGlzYWJsZWQgOiBvcHRpb24uZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpID09PSBudWxsICkgJiYKCQkJCQkJCSggIW9wdGlvbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFqUXVlcnkubm9kZU5hbWUoIG9wdGlvbi5wYXJlbnROb2RlLCAib3B0Z3JvdXAiICkgKSApIHsKCgkJCQkJCS8vIEdldCB0aGUgc3BlY2lmaWMgdmFsdWUgZm9yIHRoZSBvcHRpb24KCQkJCQkJdmFsdWUgPSBqUXVlcnkoIG9wdGlvbiApLnZhbCgpOwoKCQkJCQkJLy8gV2UgZG9uJ3QgbmVlZCBhbiBhcnJheSBmb3Igb25lIHNlbGVjdHMKCQkJCQkJaWYgKCBvbmUgKSB7CgkJCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQkJCX0KCgkJCQkJCS8vIE11bHRpLVNlbGVjdHMgcmV0dXJuIGFuIGFycmF5CgkJCQkJCXZhbHVlcy5wdXNoKCB2YWx1ZSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdmFsdWVzOwoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQl2YXIgdmFsdWVzID0galF1ZXJ5Lm1ha2VBcnJheSggdmFsdWUgKTsKCgkJCQlqUXVlcnkoZWxlbSkuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbigpIHsKCQkJCQl0aGlzLnNlbGVjdGVkID0galF1ZXJ5LmluQXJyYXkoIGpRdWVyeSh0aGlzKS52YWwoKSwgdmFsdWVzICkgPj0gMDsKCQkJCX0pOwoKCQkJCWlmICggIXZhbHVlcy5sZW5ndGggKSB7CgkJCQkJZWxlbS5zZWxlY3RlZEluZGV4ID0gLTE7CgkJCQl9CgkJCQlyZXR1cm4gdmFsdWVzOwoJCQl9CgkJfQoJfSwKCglhdHRyOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUgKSB7CgkJdmFyIGhvb2tzLCBub3R4bWwsIHJldCwKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBkb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSA9PT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCXJldHVybiBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSwgdmFsdWUgKTsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJLy8gQWxsIGF0dHJpYnV0ZXMgYXJlIGxvd2VyY2FzZQoJCS8vIEdyYWIgbmVjZXNzYXJ5IGhvb2sgaWYgb25lIGlzIGRlZmluZWQKCQlpZiAoIG5vdHhtbCApIHsKCQkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCQkJaG9va3MgPSBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gfHwgKCByYm9vbGVhbi50ZXN0KCBuYW1lICkgPyBib29sSG9vayA6IG5vZGVIb29rICk7CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIHZhbHVlID09PSBudWxsICkgewoJCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIGVsZW0sIG5hbWUgKTsKCgkJCX0gZWxzZSBpZiAoIGhvb2tzICYmIG5vdHhtbCAmJiAic2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHJldDsKCgkJCX0gZWxzZSB7CgkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgdmFsdWUgKyAiIiApOwoJCQkJcmV0dXJuIHZhbHVlOwoJCQl9CgoJCX0gZWxzZSBpZiAoIGhvb2tzICYmIG5vdHhtbCAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsICkgewoJCQlyZXR1cm4gcmV0OwoKCQl9IGVsc2UgewoKCQkJLy8gSW4gSUU5KywgRmxhc2ggb2JqZWN0cyBkb24ndCBoYXZlIC5nZXRBdHRyaWJ1dGUgKCMxMjk0NSkKCQkJLy8gU3VwcG9ydDogSUU5KwoJCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCQlyZXQgPSAgZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKTsKCQkJfQoKCQkJLy8gTm9uLWV4aXN0ZW50IGF0dHJpYnV0ZXMgcmV0dXJuIG51bGwsIHdlIG5vcm1hbGl6ZSB0byB1bmRlZmluZWQKCQkJcmV0dXJuIHJldCA9PSBudWxsID8KCQkJCXVuZGVmaW5lZCA6CgkJCQlyZXQ7CgkJfQoJfSwKCglyZW1vdmVBdHRyOiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJdmFyIG5hbWUsIHByb3BOYW1lLAoJCQlpID0gMCwKCQkJYXR0ck5hbWVzID0gdmFsdWUgJiYgdmFsdWUubWF0Y2goIGNvcmVfcm5vdHdoaXRlICk7CgoJCWlmICggYXR0ck5hbWVzICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCXdoaWxlICggKG5hbWUgPSBhdHRyTmFtZXNbaSsrXSkgKSB7CgkJCQlwcm9wTmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCgkJCQkvLyBCb29sZWFuIGF0dHJpYnV0ZXMgZ2V0IHNwZWNpYWwgdHJlYXRtZW50ICgjMTA4NzApCgkJCQlpZiAoIHJib29sZWFuLnRlc3QoIG5hbWUgKSApIHsKCQkJCQkvLyBTZXQgY29ycmVzcG9uZGluZyBwcm9wZXJ0eSB0byBmYWxzZSBmb3IgYm9vbGVhbiBhdHRyaWJ1dGVzCgkJCQkJLy8gQWxzbyBjbGVhciBkZWZhdWx0Q2hlY2tlZC9kZWZhdWx0U2VsZWN0ZWQgKGlmIGFwcHJvcHJpYXRlKSBmb3IgSUU8OAoJCQkJCWlmICggIWdldFNldEF0dHJpYnV0ZSAmJiBydXNlRGVmYXVsdC50ZXN0KCBuYW1lICkgKSB7CgkJCQkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9CgkJCQkJCQllbGVtWyBwcm9wTmFtZSBdID0gZmFsc2U7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZWxlbVsgcHJvcE5hbWUgXSA9IGZhbHNlOwoJCQkJCX0KCgkJCQkvLyBTZWUgIzk2OTkgZm9yIGV4cGxhbmF0aW9uIG9mIHRoaXMgYXBwcm9hY2ggKHNldHRpbmcgZmlyc3QsIHRoZW4gcmVtb3ZhbCkKCQkJCX0gZWxzZSB7CgkJCQkJalF1ZXJ5LmF0dHIoIGVsZW0sIG5hbWUsICIiICk7CgkJCQl9CgoJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGdldFNldEF0dHJpYnV0ZSA/IG5hbWUgOiBwcm9wTmFtZSApOwoJCQl9CgkJfQoJfSwKCglhdHRySG9va3M6IHsKCQl0eXBlOiB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQucmFkaW9WYWx1ZSAmJiB2YWx1ZSA9PT0gInJhZGlvIiAmJiBqUXVlcnkubm9kZU5hbWUoZWxlbSwgImlucHV0IikgKSB7CgkJCQkJLy8gU2V0dGluZyB0aGUgdHlwZSBvbiBhIHJhZGlvIGJ1dHRvbiBhZnRlciB0aGUgdmFsdWUgcmVzZXRzIHRoZSB2YWx1ZSBpbiBJRTYtOQoJCQkJCS8vIFJlc2V0IHZhbHVlIHRvIGRlZmF1bHQgaW4gY2FzZSB0eXBlIGlzIHNldCBhZnRlciB2YWx1ZSBkdXJpbmcgY3JlYXRpb24KCQkJCQl2YXIgdmFsID0gZWxlbS52YWx1ZTsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggInR5cGUiLCB2YWx1ZSApOwoJCQkJCWlmICggdmFsICkgewoJCQkJCQllbGVtLnZhbHVlID0gdmFsOwoJCQkJCX0KCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCXByb3BGaXg6IHsKCQl0YWJpbmRleDogInRhYkluZGV4IiwKCQlyZWFkb25seTogInJlYWRPbmx5IiwKCQkiZm9yIjogImh0bWxGb3IiLAoJCSJjbGFzcyI6ICJjbGFzc05hbWUiLAoJCW1heGxlbmd0aDogIm1heExlbmd0aCIsCgkJY2VsbHNwYWNpbmc6ICJjZWxsU3BhY2luZyIsCgkJY2VsbHBhZGRpbmc6ICJjZWxsUGFkZGluZyIsCgkJcm93c3BhbjogInJvd1NwYW4iLAoJCWNvbHNwYW46ICJjb2xTcGFuIiwKCQl1c2VtYXA6ICJ1c2VNYXAiLAoJCWZyYW1lYm9yZGVyOiAiZnJhbWVCb3JkZXIiLAoJCWNvbnRlbnRlZGl0YWJsZTogImNvbnRlbnRFZGl0YWJsZSIKCX0sCgoJcHJvcDogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCXZhciByZXQsIGhvb2tzLCBub3R4bWwsCgkJCW5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJLy8gZG9uJ3QgZ2V0L3NldCBwcm9wZXJ0aWVzIG9uIHRleHQsIGNvbW1lbnQgYW5kIGF0dHJpYnV0ZSBub2RlcwoJCWlmICggIWVsZW0gfHwgblR5cGUgPT09IDMgfHwgblR5cGUgPT09IDggfHwgblR5cGUgPT09IDIgKSB7CgkJCXJldHVybjsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJaWYgKCBub3R4bWwgKSB7CgkJCS8vIEZpeCBuYW1lIGFuZCBhdHRhY2ggaG9va3MKCQkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQkJaG9va3MgPSBqUXVlcnkucHJvcEhvb2tzWyBuYW1lIF07CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCWlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgoJCQl9IGVsc2UgewoJCQkJcmV0dXJuICggZWxlbVsgbmFtZSBdID0gdmFsdWUgKTsKCQkJfQoKCQl9IGVsc2UgewoJCQlpZiAoIGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoIGVsZW0sIG5hbWUgKSkgIT09IG51bGwgKSB7CgkJCQlyZXR1cm4gcmV0OwoKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBlbGVtWyBuYW1lIF07CgkJCX0KCQl9Cgl9LAoKCXByb3BIb29rczogewoJCXRhYkluZGV4OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBlbGVtLnRhYkluZGV4IGRvZXNuJ3QgYWx3YXlzIHJldHVybiB0aGUgY29ycmVjdCB2YWx1ZSB3aGVuIGl0IGhhc24ndCBiZWVuIGV4cGxpY2l0bHkgc2V0CgkJCQkvLyBodHRwOi8vZmx1aWRwcm9qZWN0Lm9yZy9ibG9nLzIwMDgvMDEvMDkvZ2V0dGluZy1zZXR0aW5nLWFuZC1yZW1vdmluZy10YWJpbmRleC12YWx1ZXMtd2l0aC1qYXZhc2NyaXB0LwoJCQkJdmFyIGF0dHJpYnV0ZU5vZGUgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoInRhYmluZGV4Iik7CgoJCQkJcmV0dXJuIGF0dHJpYnV0ZU5vZGUgJiYgYXR0cmlidXRlTm9kZS5zcGVjaWZpZWQgPwoJCQkJCXBhcnNlSW50KCBhdHRyaWJ1dGVOb2RlLnZhbHVlLCAxMCApIDoKCQkJCQlyZm9jdXNhYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSB8fCByY2xpY2thYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSAmJiBlbGVtLmhyZWYgPwoJCQkJCQkwIDoKCQkJCQkJdW5kZWZpbmVkOwoJCQl9CgkJfQoJfQp9KTsKCi8vIEhvb2sgZm9yIGJvb2xlYW4gYXR0cmlidXRlcwpib29sSG9vayA9IHsKCWdldDogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJdmFyCgkJCS8vIFVzZSAucHJvcCB0byBkZXRlcm1pbmUgaWYgdGhpcyBhdHRyaWJ1dGUgaXMgdW5kZXJzdG9vZCBhcyBib29sZWFuCgkJCXByb3AgPSBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSApLAoKCQkJLy8gRmV0Y2ggaXQgYWNjb3JkaW5nbHkKCQkJYXR0ciA9IHR5cGVvZiBwcm9wID09PSAiYm9vbGVhbiIgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSwKCQkJZGV0YWlsID0gdHlwZW9mIHByb3AgPT09ICJib29sZWFuIiA/CgoJCQkJZ2V0U2V0SW5wdXQgJiYgZ2V0U2V0QXR0cmlidXRlID8KCQkJCQlhdHRyICE9IG51bGwgOgoJCQkJCS8vIG9sZElFIGZhYnJpY2F0ZXMgYW4gZW1wdHkgc3RyaW5nIGZvciBtaXNzaW5nIGJvb2xlYW4gYXR0cmlidXRlcwoJCQkJCS8vIGFuZCBjb25mbGF0ZXMgY2hlY2tlZC9zZWxlY3RlZCBpbnRvIGF0dHJvcGVydGllcwoJCQkJCXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSA/CgkJCQkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA6CgkJCQkJCSEhYXR0ciA6CgoJCQkJLy8gZmV0Y2ggYW4gYXR0cmlidXRlIG5vZGUgZm9yIHByb3BlcnRpZXMgbm90IHJlY29nbml6ZWQgYXMgYm9vbGVhbgoJCQkJZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7CgoJCXJldHVybiBkZXRhaWwgJiYgZGV0YWlsLnZhbHVlICE9PSBmYWxzZSA/CgkJCW5hbWUudG9Mb3dlckNhc2UoKSA6CgkJCXVuZGVmaW5lZDsKCX0sCglzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJLy8gUmVtb3ZlIGJvb2xlYW4gYXR0cmlidXRlcyB3aGVuIHNldCB0byBmYWxzZQoJCQlqUXVlcnkucmVtb3ZlQXR0ciggZWxlbSwgbmFtZSApOwoJCX0gZWxzZSBpZiAoIGdldFNldElucHV0ICYmIGdldFNldEF0dHJpYnV0ZSB8fCAhcnVzZURlZmF1bHQudGVzdCggbmFtZSApICkgewoJCQkvLyBJRTw4IG5lZWRzIHRoZSAqcHJvcGVydHkqIG5hbWUKCQkJZWxlbS5zZXRBdHRyaWJ1dGUoICFnZXRTZXRBdHRyaWJ1dGUgJiYgalF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lLCBuYW1lICk7CgoJCS8vIFVzZSBkZWZhdWx0Q2hlY2tlZCBhbmQgZGVmYXVsdFNlbGVjdGVkIGZvciBvbGRJRQoJCX0gZWxzZSB7CgkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9IGVsZW1bIG5hbWUgXSA9IHRydWU7CgkJfQoKCQlyZXR1cm4gbmFtZTsKCX0KfTsKCi8vIGZpeCBvbGRJRSB2YWx1ZSBhdHRyb3BlcnR5CmlmICggIWdldFNldElucHV0IHx8ICFnZXRTZXRBdHRyaWJ1dGUgKSB7CglqUXVlcnkuYXR0ckhvb2tzLnZhbHVlID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJCXZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKTsKCQkJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApID8KCgkJCQkvLyBJZ25vcmUgdGhlIHZhbHVlICpwcm9wZXJ0eSogYnkgdXNpbmcgZGVmYXVsdFZhbHVlCgkJCQllbGVtLmRlZmF1bHRWYWx1ZSA6CgoJCQkJcmV0ICYmIHJldC5zcGVjaWZpZWQgPyByZXQudmFsdWUgOiB1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSApIHsKCQkJCS8vIERvZXMgbm90IHJldHVybiBzbyB0aGF0IHNldEF0dHJpYnV0ZSBpcyBhbHNvIHVzZWQKCQkJCWVsZW0uZGVmYXVsdFZhbHVlID0gdmFsdWU7CgkJCX0gZWxzZSB7CgkJCQkvLyBVc2Ugbm9kZUhvb2sgaWYgZGVmaW5lZCAoIzE5NTQpOyBvdGhlcndpc2Ugc2V0QXR0cmlidXRlIGlzIGZpbmUKCQkJCXJldHVybiBub2RlSG9vayAmJiBub2RlSG9vay5zZXQoIGVsZW0sIHZhbHVlLCBuYW1lICk7CgkJCX0KCQl9Cgl9Owp9CgovLyBJRTYvNyBkbyBub3Qgc3VwcG9ydCBnZXR0aW5nL3NldHRpbmcgc29tZSBhdHRyaWJ1dGVzIHdpdGggZ2V0L3NldEF0dHJpYnV0ZQppZiAoICFnZXRTZXRBdHRyaWJ1dGUgKSB7CgoJLy8gVXNlIHRoaXMgZm9yIGFueSBhdHRyaWJ1dGUgaW4gSUU2LzcKCS8vIFRoaXMgZml4ZXMgYWxtb3N0IGV2ZXJ5IElFNi83IGlzc3VlCglub2RlSG9vayA9IGpRdWVyeS52YWxIb29rcy5idXR0b24gPSB7CgkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOwoJCQlyZXR1cm4gcmV0ICYmICggbmFtZSA9PT0gImlkIiB8fCBuYW1lID09PSAibmFtZSIgfHwgbmFtZSA9PT0gImNvb3JkcyIgPyByZXQudmFsdWUgIT09ICIiIDogcmV0LnNwZWNpZmllZCApID8KCQkJCXJldC52YWx1ZSA6CgkJCQl1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJLy8gU2V0IHRoZSBleGlzdGluZyBvciBjcmVhdGUgYSBuZXcgYXR0cmlidXRlIG5vZGUKCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOwoJCQlpZiAoICFyZXQgKSB7CgkJCQllbGVtLnNldEF0dHJpYnV0ZU5vZGUoCgkJCQkJKHJldCA9IGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoIG5hbWUgKSkKCQkJCSk7CgkJCX0KCgkJCXJldC52YWx1ZSA9IHZhbHVlICs9ICIiOwoKCQkJLy8gQnJlYWsgYXNzb2NpYXRpb24gd2l0aCBjbG9uZWQgZWxlbWVudHMgYnkgYWxzbyB1c2luZyBzZXRBdHRyaWJ1dGUgKCM5NjQ2KQoJCQlyZXR1cm4gbmFtZSA9PT0gInZhbHVlIiB8fCB2YWx1ZSA9PT0gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSA/CgkJCQl2YWx1ZSA6CgkJCQl1bmRlZmluZWQ7CgkJfQoJfTsKCgkvLyBTZXQgY29udGVudGVkaXRhYmxlIHRvIGZhbHNlIG9uIHJlbW92YWxzKCMxMDQyOSkKCS8vIFNldHRpbmcgdG8gZW1wdHkgc3RyaW5nIHRocm93cyBhbiBlcnJvciBhcyBhbiBpbnZhbGlkIHZhbHVlCglqUXVlcnkuYXR0ckhvb2tzLmNvbnRlbnRlZGl0YWJsZSA9IHsKCQlnZXQ6IG5vZGVIb29rLmdldCwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJbm9kZUhvb2suc2V0KCBlbGVtLCB2YWx1ZSA9PT0gIiIgPyBmYWxzZSA6IHZhbHVlLCBuYW1lICk7CgkJfQoJfTsKCgkvLyBTZXQgd2lkdGggYW5kIGhlaWdodCB0byBhdXRvIGluc3RlYWQgb2YgMCBvbiBlbXB0eSBzdHJpbmcoIEJ1ZyAjODE1MCApCgkvLyBUaGlzIGlzIGZvciByZW1vdmFscwoJalF1ZXJ5LmVhY2goWyAid2lkdGgiLCAiaGVpZ2h0IiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCQlqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0sIHsKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQlpZiAoIHZhbHVlID09PSAiIiApIHsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgImF1dG8iICk7CgkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJfQoJCQl9CgkJfSk7Cgl9KTsKfQoKCi8vIFNvbWUgYXR0cmlidXRlcyByZXF1aXJlIGEgc3BlY2lhbCBjYWxsIG9uIElFCi8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczUzNjQyOSUyOFZTLjg1JTI5LmFzcHgKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWQgKSB7CglqUXVlcnkuZWFjaChbICJocmVmIiwgInNyYyIsICJ3aWR0aCIsICJoZWlnaHQiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJCWpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSwgewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCAyICk7CgkJCQlyZXR1cm4gcmV0ID09IG51bGwgPyB1bmRlZmluZWQgOiByZXQ7CgkJCX0KCQl9KTsKCX0pOwoKCS8vIGhyZWYvc3JjIHByb3BlcnR5IHNob3VsZCBnZXQgdGhlIGZ1bGwgbm9ybWFsaXplZCBVUkwgKCMxMDI5OS8jMTI5MTUpCglqUXVlcnkuZWFjaChbICJocmVmIiwgInNyYyIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CgkJalF1ZXJ5LnByb3BIb29rc1sgbmFtZSBdID0gewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCA0ICk7CgkJCX0KCQl9OwoJfSk7Cn0KCmlmICggIWpRdWVyeS5zdXBwb3J0LnN0eWxlICkgewoJalF1ZXJ5LmF0dHJIb29rcy5zdHlsZSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBSZXR1cm4gdW5kZWZpbmVkIGluIHRoZSBjYXNlIG9mIGVtcHR5IHN0cmluZwoJCQkvLyBOb3RlOiBJRSB1cHBlcmNhc2VzIGNzcyBwcm9wZXJ0eSBuYW1lcywgYnV0IGlmIHdlIHdlcmUgdG8gLnRvTG93ZXJDYXNlKCkKCQkJLy8gLmNzc1RleHQsIHRoYXQgd291bGQgZGVzdHJveSBjYXNlIHNlbnN0aXRpdml0eSBpbiBVUkwncywgbGlrZSBpbiAiYmFja2dyb3VuZCIKCQkJcmV0dXJuIGVsZW0uc3R5bGUuY3NzVGV4dCB8fCB1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJcmV0dXJuICggZWxlbS5zdHlsZS5jc3NUZXh0ID0gdmFsdWUgKyAiIiApOwoJCX0KCX07Cn0KCi8vIFNhZmFyaSBtaXMtcmVwb3J0cyB0aGUgZGVmYXVsdCBzZWxlY3RlZCBwcm9wZXJ0eSBvZiBhbiBvcHRpb24KLy8gQWNjZXNzaW5nIHRoZSBwYXJlbnQncyBzZWxlY3RlZEluZGV4IHByb3BlcnR5IGZpeGVzIGl0CmlmICggIWpRdWVyeS5zdXBwb3J0Lm9wdFNlbGVjdGVkICkgewoJalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5wcm9wSG9va3Muc2VsZWN0ZWQsIHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoKCQkJaWYgKCBwYXJlbnQgKSB7CgkJCQlwYXJlbnQuc2VsZWN0ZWRJbmRleDsKCgkJCQkvLyBNYWtlIHN1cmUgdGhhdCBpdCBhbHNvIHdvcmtzIHdpdGggb3B0Z3JvdXBzLCBzZWUgIzU3MDEKCQkJCWlmICggcGFyZW50LnBhcmVudE5vZGUgKSB7CgkJCQkJcGFyZW50LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9Cgl9KTsKfQoKLy8gSUU2LzcgY2FsbCBlbmN0eXBlIGVuY29kaW5nCmlmICggIWpRdWVyeS5zdXBwb3J0LmVuY3R5cGUgKSB7CglqUXVlcnkucHJvcEZpeC5lbmN0eXBlID0gImVuY29kaW5nIjsKfQoKLy8gUmFkaW9zIGFuZCBjaGVja2JveGVzIGdldHRlci9zZXR0ZXIKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuY2hlY2tPbiApIHsKCWpRdWVyeS5lYWNoKFsgInJhZGlvIiwgImNoZWNrYm94IiBdLCBmdW5jdGlvbigpIHsKCQlqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCS8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBpbiBXZWJraXQgIiIgaXMgcmV0dXJuZWQgaW5zdGVhZCBvZiAib24iIGlmIGEgdmFsdWUgaXNuJ3Qgc3BlY2lmaWVkCgkJCQlyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoInZhbHVlIikgPT09IG51bGwgPyAib24iIDogZWxlbS52YWx1ZTsKCQkJfQoJCX07Cgl9KTsKfQpqUXVlcnkuZWFjaChbICJyYWRpbyIsICJjaGVja2JveCIgXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS52YWxIb29rc1sgdGhpcyBdLCB7CgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgkJCQlyZXR1cm4gKCBlbGVtLmNoZWNrZWQgPSBqUXVlcnkuaW5BcnJheSggalF1ZXJ5KGVsZW0pLnZhbCgpLCB2YWx1ZSApID49IDAgKTsKCQkJfQoJCX0KCX0pOwp9KTsKdmFyIHJmb3JtRWxlbXMgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYSkkL2ksCglya2V5RXZlbnQgPSAvXmtleS8sCglybW91c2VFdmVudCA9IC9eKD86bW91c2V8Y29udGV4dG1lbnUpfGNsaWNrLywKCXJmb2N1c01vcnBoID0gL14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLAoJcnR5cGVuYW1lc3BhY2UgPSAvXihbXi5dKikoPzpcLiguKyl8KSQvOwoKZnVuY3Rpb24gcmV0dXJuVHJ1ZSgpIHsKCXJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiByZXR1cm5GYWxzZSgpIHsKCXJldHVybiBmYWxzZTsKfQoKLyoKICogSGVscGVyIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgZXZlbnRzIC0tIG5vdCBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLgogKiBQcm9wcyB0byBEZWFuIEVkd2FyZHMnIGFkZEV2ZW50IGxpYnJhcnkgZm9yIG1hbnkgb2YgdGhlIGlkZWFzLgogKi8KalF1ZXJ5LmV2ZW50ID0gewoKCWdsb2JhbDoge30sCgoJYWRkOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIGRhdGEsIHNlbGVjdG9yICkgewoJCXZhciB0bXAsIGV2ZW50cywgdCwgaGFuZGxlT2JqSW4sCgkJCXNwZWNpYWwsIGV2ZW50SGFuZGxlLCBoYW5kbGVPYmosCgkJCWhhbmRsZXJzLCB0eXBlLCBuYW1lc3BhY2VzLCBvcmlnVHlwZSwKCQkJZWxlbURhdGEgPSBqUXVlcnkuX2RhdGEoIGVsZW0gKTsKCgkJLy8gRG9uJ3QgYXR0YWNoIGV2ZW50cyB0byBub0RhdGEgb3IgdGV4dC9jb21tZW50IG5vZGVzIChidXQgYWxsb3cgcGxhaW4gb2JqZWN0cykKCQlpZiAoICFlbGVtRGF0YSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gQ2FsbGVyIGNhbiBwYXNzIGluIGFuIG9iamVjdCBvZiBjdXN0b20gZGF0YSBpbiBsaWV1IG9mIHRoZSBoYW5kbGVyCgkJaWYgKCBoYW5kbGVyLmhhbmRsZXIgKSB7CgkJCWhhbmRsZU9iakluID0gaGFuZGxlcjsKCQkJaGFuZGxlciA9IGhhbmRsZU9iakluLmhhbmRsZXI7CgkJCXNlbGVjdG9yID0gaGFuZGxlT2JqSW4uc2VsZWN0b3I7CgkJfQoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0aGUgaGFuZGxlciBoYXMgYSB1bmlxdWUgSUQsIHVzZWQgdG8gZmluZC9yZW1vdmUgaXQgbGF0ZXIKCQlpZiAoICFoYW5kbGVyLmd1aWQgKSB7CgkJCWhhbmRsZXIuZ3VpZCA9IGpRdWVyeS5ndWlkKys7CgkJfQoKCQkvLyBJbml0IHRoZSBlbGVtZW50J3MgZXZlbnQgc3RydWN0dXJlIGFuZCBtYWluIGhhbmRsZXIsIGlmIHRoaXMgaXMgdGhlIGZpcnN0CgkJaWYgKCAhKGV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cykgKSB7CgkJCWV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cyA9IHt9OwoJCX0KCQlpZiAoICEoZXZlbnRIYW5kbGUgPSBlbGVtRGF0YS5oYW5kbGUpICkgewoJCQlldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSA9IGZ1bmN0aW9uKCBlICkgewoJCQkJLy8gRGlzY2FyZCB0aGUgc2Vjb25kIGV2ZW50IG9mIGEgalF1ZXJ5LmV2ZW50LnRyaWdnZXIoKSBhbmQKCQkJCS8vIHdoZW4gYW4gZXZlbnQgaXMgY2FsbGVkIGFmdGVyIGEgcGFnZSBoYXMgdW5sb2FkZWQKCQkJCXJldHVybiB0eXBlb2YgalF1ZXJ5ICE9PSBjb3JlX3N0cnVuZGVmaW5lZCAmJiAoIWUgfHwgalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCAhPT0gZS50eXBlKSA/CgkJCQkJalF1ZXJ5LmV2ZW50LmRpc3BhdGNoLmFwcGx5KCBldmVudEhhbmRsZS5lbGVtLCBhcmd1bWVudHMgKSA6CgkJCQkJdW5kZWZpbmVkOwoJCQl9OwoJCQkvLyBBZGQgZWxlbSBhcyBhIHByb3BlcnR5IG9mIHRoZSBoYW5kbGUgZm4gdG8gcHJldmVudCBhIG1lbW9yeSBsZWFrIHdpdGggSUUgbm9uLW5hdGl2ZSBldmVudHMKCQkJZXZlbnRIYW5kbGUuZWxlbSA9IGVsZW07CgkJfQoKCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCgkJLy8galF1ZXJ5KC4uLikuYmluZCgibW91c2VvdmVyIG1vdXNlb3V0IiwgZm4pOwoJCXR5cGVzID0gKCB0eXBlcyB8fCAiIiApLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFsiIl07CgkJdCA9IHR5cGVzLmxlbmd0aDsKCQl3aGlsZSAoIHQtLSApIHsKCQkJdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTsKCQkJdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOwoJCQluYW1lc3BhY2VzID0gKCB0bXBbMl0gfHwgIiIgKS5zcGxpdCggIi4iICkuc29ydCgpOwoKCQkJLy8gSWYgZXZlbnQgY2hhbmdlcyBpdHMgdHlwZSwgdXNlIHRoZSBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgY2hhbmdlZCB0eXBlCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoKCQkJLy8gSWYgc2VsZWN0b3IgZGVmaW5lZCwgZGV0ZXJtaW5lIHNwZWNpYWwgZXZlbnQgYXBpIHR5cGUsIG90aGVyd2lzZSBnaXZlbiB0eXBlCgkJCXR5cGUgPSAoIHNlbGVjdG9yID8gc3BlY2lhbC5kZWxlZ2F0ZVR5cGUgOiBzcGVjaWFsLmJpbmRUeXBlICkgfHwgdHlwZTsKCgkJCS8vIFVwZGF0ZSBzcGVjaWFsIGJhc2VkIG9uIG5ld2x5IHJlc2V0IHR5cGUKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkvLyBoYW5kbGVPYmogaXMgcGFzc2VkIHRvIGFsbCBldmVudCBoYW5kbGVycwoJCQloYW5kbGVPYmogPSBqUXVlcnkuZXh0ZW5kKHsKCQkJCXR5cGU6IHR5cGUsCgkJCQlvcmlnVHlwZTogb3JpZ1R5cGUsCgkJCQlkYXRhOiBkYXRhLAoJCQkJaGFuZGxlcjogaGFuZGxlciwKCQkJCWd1aWQ6IGhhbmRsZXIuZ3VpZCwKCQkJCXNlbGVjdG9yOiBzZWxlY3RvciwKCQkJCW5lZWRzQ29udGV4dDogc2VsZWN0b3IgJiYgalF1ZXJ5LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3QoIHNlbGVjdG9yICksCgkJCQluYW1lc3BhY2U6IG5hbWVzcGFjZXMuam9pbigiLiIpCgkJCX0sIGhhbmRsZU9iakluICk7CgoJCQkvLyBJbml0IHRoZSBldmVudCBoYW5kbGVyIHF1ZXVlIGlmIHdlJ3JlIHRoZSBmaXJzdAoJCQlpZiAoICEoaGFuZGxlcnMgPSBldmVudHNbIHR5cGUgXSkgKSB7CgkJCQloYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdID0gW107CgkJCQloYW5kbGVycy5kZWxlZ2F0ZUNvdW50ID0gMDsKCgkJCQkvLyBPbmx5IHVzZSBhZGRFdmVudExpc3RlbmVyL2F0dGFjaEV2ZW50IGlmIHRoZSBzcGVjaWFsIGV2ZW50cyBoYW5kbGVyIHJldHVybnMgZmFsc2UKCQkJCWlmICggIXNwZWNpYWwuc2V0dXAgfHwgc3BlY2lhbC5zZXR1cC5jYWxsKCBlbGVtLCBkYXRhLCBuYW1lc3BhY2VzLCBldmVudEhhbmRsZSApID09PSBmYWxzZSApIHsKCQkJCQkvLyBCaW5kIHRoZSBnbG9iYWwgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAoJCQkJCWlmICggZWxlbS5hZGRFdmVudExpc3RlbmVyICkgewoJCQkJCQllbGVtLmFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGV2ZW50SGFuZGxlLCBmYWxzZSApOwoKCQkJCQl9IGVsc2UgaWYgKCBlbGVtLmF0dGFjaEV2ZW50ICkgewoJCQkJCQllbGVtLmF0dGFjaEV2ZW50KCAib24iICsgdHlwZSwgZXZlbnRIYW5kbGUgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWlmICggc3BlY2lhbC5hZGQgKSB7CgkJCQlzcGVjaWFsLmFkZC5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsKCgkJCQlpZiAoICFoYW5kbGVPYmouaGFuZGxlci5ndWlkICkgewoJCQkJCWhhbmRsZU9iai5oYW5kbGVyLmd1aWQgPSBoYW5kbGVyLmd1aWQ7CgkJCQl9CgkJCX0KCgkJCS8vIEFkZCB0byB0aGUgZWxlbWVudCdzIGhhbmRsZXIgbGlzdCwgZGVsZWdhdGVzIGluIGZyb250CgkJCWlmICggc2VsZWN0b3IgKSB7CgkJCQloYW5kbGVycy5zcGxpY2UoIGhhbmRsZXJzLmRlbGVnYXRlQ291bnQrKywgMCwgaGFuZGxlT2JqICk7CgkJCX0gZWxzZSB7CgkJCQloYW5kbGVycy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJfQoKCQkJLy8gS2VlcCB0cmFjayBvZiB3aGljaCBldmVudHMgaGF2ZSBldmVyIGJlZW4gdXNlZCwgZm9yIGV2ZW50IG9wdGltaXphdGlvbgoJCQlqUXVlcnkuZXZlbnQuZ2xvYmFsWyB0eXBlIF0gPSB0cnVlOwoJCX0KCgkJLy8gTnVsbGlmeSBlbGVtIHRvIHByZXZlbnQgbWVtb3J5IGxlYWtzIGluIElFCgkJZWxlbSA9IG51bGw7Cgl9LAoKCS8vIERldGFjaCBhbiBldmVudCBvciBzZXQgb2YgZXZlbnRzIGZyb20gYW4gZWxlbWVudAoJcmVtb3ZlOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIHNlbGVjdG9yLCBtYXBwZWRUeXBlcyApIHsKCQl2YXIgaiwgaGFuZGxlT2JqLCB0bXAsCgkJCW9yaWdDb3VudCwgdCwgZXZlbnRzLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwKCQkJbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0galF1ZXJ5Lmhhc0RhdGEoIGVsZW0gKSAmJiBqUXVlcnkuX2RhdGEoIGVsZW0gKTsKCgkJaWYgKCAhZWxlbURhdGEgfHwgIShldmVudHMgPSBlbGVtRGF0YS5ldmVudHMpICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBPbmNlIGZvciBlYWNoIHR5cGUubmFtZXNwYWNlIGluIHR5cGVzOyB0eXBlIG1heSBiZSBvbWl0dGVkCgkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgWyIiXTsKCQl0ID0gdHlwZXMubGVuZ3RoOwoJCXdoaWxlICggdC0tICkgewoJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1t0XSApIHx8IFtdOwoJCQl0eXBlID0gb3JpZ1R5cGUgPSB0bXBbMV07CgkJCW5hbWVzcGFjZXMgPSAoIHRtcFsyXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkvLyBVbmJpbmQgYWxsIGV2ZW50cyAob24gdGhpcyBuYW1lc3BhY2UsIGlmIHByb3ZpZGVkKSBmb3IgdGhlIGVsZW1lbnQKCQkJaWYgKCAhdHlwZSApIHsKCQkJCWZvciAoIHR5cGUgaW4gZXZlbnRzICkgewoJCQkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIGVsZW0sIHR5cGUgKyB0eXBlc1sgdCBdLCBoYW5kbGVyLCBzZWxlY3RvciwgdHJ1ZSApOwoJCQkJfQoJCQkJY29udGludWU7CgkJCX0KCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoJCQl0eXBlID0gKCBzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSApIHx8IHR5cGU7CgkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gfHwgW107CgkJCXRtcCA9IHRtcFsyXSAmJiBuZXcgUmVnRXhwKCAiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIiApOwoKCQkJLy8gUmVtb3ZlIG1hdGNoaW5nIGV2ZW50cwoJCQlvcmlnQ291bnQgPSBqID0gaGFuZGxlcnMubGVuZ3RoOwoJCQl3aGlsZSAoIGotLSApIHsKCQkJCWhhbmRsZU9iaiA9IGhhbmRsZXJzWyBqIF07CgoJCQkJaWYgKCAoIG1hcHBlZFR5cGVzIHx8IG9yaWdUeXBlID09PSBoYW5kbGVPYmoub3JpZ1R5cGUgKSAmJgoJCQkJCSggIWhhbmRsZXIgfHwgaGFuZGxlci5ndWlkID09PSBoYW5kbGVPYmouZ3VpZCApICYmCgkJCQkJKCAhdG1wIHx8IHRtcC50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSAmJgoJCQkJCSggIXNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSBoYW5kbGVPYmouc2VsZWN0b3IgfHwgc2VsZWN0b3IgPT09ICIqKiIgJiYgaGFuZGxlT2JqLnNlbGVjdG9yICkgKSB7CgkJCQkJaGFuZGxlcnMuc3BsaWNlKCBqLCAxICk7CgoJCQkJCWlmICggaGFuZGxlT2JqLnNlbGVjdG9yICkgewoJCQkJCQloYW5kbGVycy5kZWxlZ2F0ZUNvdW50LS07CgkJCQkJfQoJCQkJCWlmICggc3BlY2lhbC5yZW1vdmUgKSB7CgkJCQkJCXNwZWNpYWwucmVtb3ZlLmNhbGwoIGVsZW0sIGhhbmRsZU9iaiApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gUmVtb3ZlIGdlbmVyaWMgZXZlbnQgaGFuZGxlciBpZiB3ZSByZW1vdmVkIHNvbWV0aGluZyBhbmQgbm8gbW9yZSBoYW5kbGVycyBleGlzdAoJCQkvLyAoYXZvaWRzIHBvdGVudGlhbCBmb3IgZW5kbGVzcyByZWN1cnNpb24gZHVyaW5nIHJlbW92YWwgb2Ygc3BlY2lhbCBldmVudCBoYW5kbGVycykKCQkJaWYgKCBvcmlnQ291bnQgJiYgIWhhbmRsZXJzLmxlbmd0aCApIHsKCQkJCWlmICggIXNwZWNpYWwudGVhcmRvd24gfHwgc3BlY2lhbC50ZWFyZG93bi5jYWxsKCBlbGVtLCBuYW1lc3BhY2VzLCBlbGVtRGF0YS5oYW5kbGUgKSA9PT0gZmFsc2UgKSB7CgkJCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBlbGVtLCB0eXBlLCBlbGVtRGF0YS5oYW5kbGUgKTsKCQkJCX0KCgkJCQlkZWxldGUgZXZlbnRzWyB0eXBlIF07CgkJCX0KCQl9CgoJCS8vIFJlbW92ZSB0aGUgZXhwYW5kbyBpZiBpdCdzIG5vIGxvbmdlciB1c2VkCgkJaWYgKCBqUXVlcnkuaXNFbXB0eU9iamVjdCggZXZlbnRzICkgKSB7CgkJCWRlbGV0ZSBlbGVtRGF0YS5oYW5kbGU7CgoJCQkvLyByZW1vdmVEYXRhIGFsc28gY2hlY2tzIGZvciBlbXB0aW5lc3MgYW5kIGNsZWFycyB0aGUgZXhwYW5kbyBpZiBlbXB0eQoJCQkvLyBzbyB1c2UgaXQgaW5zdGVhZCBvZiBkZWxldGUKCQkJalF1ZXJ5Ll9yZW1vdmVEYXRhKCBlbGVtLCAiZXZlbnRzIiApOwoJCX0KCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIGV2ZW50LCBkYXRhLCBlbGVtLCBvbmx5SGFuZGxlcnMgKSB7CgkJdmFyIGhhbmRsZSwgb250eXBlLCBjdXIsCgkJCWJ1YmJsZVR5cGUsIHNwZWNpYWwsIHRtcCwgaSwKCQkJZXZlbnRQYXRoID0gWyBlbGVtIHx8IGRvY3VtZW50IF0sCgkJCXR5cGUgPSBjb3JlX2hhc093bi5jYWxsKCBldmVudCwgInR5cGUiICkgPyBldmVudC50eXBlIDogZXZlbnQsCgkJCW5hbWVzcGFjZXMgPSBjb3JlX2hhc093bi5jYWxsKCBldmVudCwgIm5hbWVzcGFjZSIgKSA/IGV2ZW50Lm5hbWVzcGFjZS5zcGxpdCgiLiIpIDogW107CgoJCWN1ciA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKCQkvLyBEb24ndCBkbyBldmVudHMgb24gdGV4dCBhbmQgY29tbWVudCBub2RlcwoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBmb2N1cy9ibHVyIG1vcnBocyB0byBmb2N1c2luL291dDsgZW5zdXJlIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbSByaWdodCBub3cKCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdHlwZS5pbmRleE9mKCIuIikgPj0gMCApIHsKCQkJLy8gTmFtZXNwYWNlZCB0cmlnZ2VyOyBjcmVhdGUgYSByZWdleHAgdG8gbWF0Y2ggZXZlbnQgdHlwZSBpbiBoYW5kbGUoKQoJCQluYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwoJCQl0eXBlID0gbmFtZXNwYWNlcy5zaGlmdCgpOwoJCQluYW1lc3BhY2VzLnNvcnQoKTsKCQl9CgkJb250eXBlID0gdHlwZS5pbmRleE9mKCI6IikgPCAwICYmICJvbiIgKyB0eXBlOwoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYSBqUXVlcnkuRXZlbnQgb2JqZWN0LCBPYmplY3QsIG9yIGp1c3QgYW4gZXZlbnQgdHlwZSBzdHJpbmcKCQlldmVudCA9IGV2ZW50WyBqUXVlcnkuZXhwYW5kbyBdID8KCQkJZXZlbnQgOgoJCQluZXcgalF1ZXJ5LkV2ZW50KCB0eXBlLCB0eXBlb2YgZXZlbnQgPT09ICJvYmplY3QiICYmIGV2ZW50ICk7CgoJCWV2ZW50LmlzVHJpZ2dlciA9IHRydWU7CgkJZXZlbnQubmFtZXNwYWNlID0gbmFtZXNwYWNlcy5qb2luKCIuIik7CgkJZXZlbnQubmFtZXNwYWNlX3JlID0gZXZlbnQubmFtZXNwYWNlID8KCQkJbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIgKSA6CgkJCW51bGw7CgoJCS8vIENsZWFuIHVwIHRoZSBldmVudCBpbiBjYXNlIGl0IGlzIGJlaW5nIHJldXNlZAoJCWV2ZW50LnJlc3VsdCA9IHVuZGVmaW5lZDsKCQlpZiAoICFldmVudC50YXJnZXQgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGVsZW07CgkJfQoKCQkvLyBDbG9uZSBhbnkgaW5jb21pbmcgZGF0YSBhbmQgcHJlcGVuZCB0aGUgZXZlbnQsIGNyZWF0aW5nIHRoZSBoYW5kbGVyIGFyZyBsaXN0CgkJZGF0YSA9IGRhdGEgPT0gbnVsbCA/CgkJCVsgZXZlbnQgXSA6CgkJCWpRdWVyeS5tYWtlQXJyYXkoIGRhdGEsIFsgZXZlbnQgXSApOwoKCQkvLyBBbGxvdyBzcGVjaWFsIGV2ZW50cyB0byBkcmF3IG91dHNpZGUgdGhlIGxpbmVzCgkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgkJaWYgKCAhb25seUhhbmRsZXJzICYmIHNwZWNpYWwudHJpZ2dlciAmJiBzcGVjaWFsLnRyaWdnZXIuYXBwbHkoIGVsZW0sIGRhdGEgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBldmVudCBwcm9wYWdhdGlvbiBwYXRoIGluIGFkdmFuY2UsIHBlciBXM0MgZXZlbnRzIHNwZWMgKCM5OTUxKQoJCS8vIEJ1YmJsZSB1cCB0byBkb2N1bWVudCwgdGhlbiB0byB3aW5kb3c7IHdhdGNoIGZvciBhIGdsb2JhbCBvd25lckRvY3VtZW50IHZhciAoIzk3MjQpCgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFzcGVjaWFsLm5vQnViYmxlICYmICFqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCgkJCWJ1YmJsZVR5cGUgPSBzcGVjaWFsLmRlbGVnYXRlVHlwZSB8fCB0eXBlOwoJCQlpZiAoICFyZm9jdXNNb3JwaC50ZXN0KCBidWJibGVUeXBlICsgdHlwZSApICkgewoJCQkJY3VyID0gY3VyLnBhcmVudE5vZGU7CgkJCX0KCQkJZm9yICggOyBjdXI7IGN1ciA9IGN1ci5wYXJlbnROb2RlICkgewoJCQkJZXZlbnRQYXRoLnB1c2goIGN1ciApOwoJCQkJdG1wID0gY3VyOwoJCQl9CgoJCQkvLyBPbmx5IGFkZCB3aW5kb3cgaWYgd2UgZ290IHRvIGRvY3VtZW50IChlLmcuLCBub3QgcGxhaW4gb2JqIG9yIGRldGFjaGVkIERPTSkKCQkJaWYgKCB0bXAgPT09IChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpICkgewoJCQkJZXZlbnRQYXRoLnB1c2goIHRtcC5kZWZhdWx0VmlldyB8fCB0bXAucGFyZW50V2luZG93IHx8IHdpbmRvdyApOwoJCQl9CgkJfQoKCQkvLyBGaXJlIGhhbmRsZXJzIG9uIHRoZSBldmVudCBwYXRoCgkJaSA9IDA7CgkJd2hpbGUgKCAoY3VyID0gZXZlbnRQYXRoW2krK10pICYmICFldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJZXZlbnQudHlwZSA9IGkgPiAxID8KCQkJCWJ1YmJsZVR5cGUgOgoJCQkJc3BlY2lhbC5iaW5kVHlwZSB8fCB0eXBlOwoKCQkJLy8galF1ZXJ5IGhhbmRsZXIKCQkJaGFuZGxlID0gKCBqUXVlcnkuX2RhdGEoIGN1ciwgImV2ZW50cyIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gJiYgalF1ZXJ5Ll9kYXRhKCBjdXIsICJoYW5kbGUiICk7CgkJCWlmICggaGFuZGxlICkgewoJCQkJaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKTsKCQkJfQoKCQkJLy8gTmF0aXZlIGhhbmRsZXIKCQkJaGFuZGxlID0gb250eXBlICYmIGN1clsgb250eXBlIF07CgkJCWlmICggaGFuZGxlICYmIGpRdWVyeS5hY2NlcHREYXRhKCBjdXIgKSAmJiBoYW5kbGUuYXBwbHkgJiYgaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKSA9PT0gZmFsc2UgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9CgkJfQoJCWV2ZW50LnR5cGUgPSB0eXBlOwoKCQkvLyBJZiBub2JvZHkgcHJldmVudGVkIHRoZSBkZWZhdWx0IGFjdGlvbiwgZG8gaXQgbm93CgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCgkJCWlmICggKCFzcGVjaWFsLl9kZWZhdWx0IHx8IHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoIGVsZW0ub3duZXJEb2N1bWVudCwgZGF0YSApID09PSBmYWxzZSkgJiYKCQkJCSEodHlwZSA9PT0gImNsaWNrIiAmJiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJhIiApKSAmJiBqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoKCQkJCS8vIENhbGwgYSBuYXRpdmUgRE9NIG1ldGhvZCBvbiB0aGUgdGFyZ2V0IHdpdGggdGhlIHNhbWUgbmFtZSBuYW1lIGFzIHRoZSBldmVudC4KCQkJCS8vIENhbid0IHVzZSBhbiAuaXNGdW5jdGlvbigpIGNoZWNrIGhlcmUgYmVjYXVzZSBJRTYvNyBmYWlscyB0aGF0IHRlc3QuCgkJCQkvLyBEb24ndCBkbyBkZWZhdWx0IGFjdGlvbnMgb24gd2luZG93LCB0aGF0J3Mgd2hlcmUgZ2xvYmFsIHZhcmlhYmxlcyBiZSAoIzYxNzApCgkJCQlpZiAoIG9udHlwZSAmJiBlbGVtWyB0eXBlIF0gJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJCQkvLyBEb24ndCByZS10cmlnZ2VyIGFuIG9uRk9PIGV2ZW50IHdoZW4gd2UgY2FsbCBpdHMgRk9PKCkgbWV0aG9kCgkJCQkJdG1wID0gZWxlbVsgb250eXBlIF07CgoJCQkJCWlmICggdG1wICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IG51bGw7CgkJCQkJfQoKCQkJCQkvLyBQcmV2ZW50IHJlLXRyaWdnZXJpbmcgb2YgdGhlIHNhbWUgZXZlbnQsIHNpbmNlIHdlIGFscmVhZHkgYnViYmxlZCBpdCBhYm92ZQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB0eXBlOwoJCQkJCXRyeSB7CgkJCQkJCWVsZW1bIHR5cGUgXSgpOwoJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkvLyBJRTw5IGRpZXMgb24gZm9jdXMvYmx1ciB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsIzEyNTE4KQoJCQkJCQkvLyBvbmx5IHJlcHJvZHVjaWJsZSBvbiB3aW5YUCBJRTggbmF0aXZlLCBub3QgSUU5IGluIElFOCBtb2RlCgkJCQkJfQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB1bmRlZmluZWQ7CgoJCQkJCWlmICggdG1wICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IHRtcDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWRpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCS8vIE1ha2UgYSB3cml0YWJsZSBqUXVlcnkuRXZlbnQgZnJvbSB0aGUgbmF0aXZlIGV2ZW50IG9iamVjdAoJCWV2ZW50ID0galF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKTsKCgkJdmFyIGksIHJldCwgaGFuZGxlT2JqLCBtYXRjaGVkLCBqLAoJCQloYW5kbGVyUXVldWUgPSBbXSwKCQkJYXJncyA9IGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzICksCgkJCWhhbmRsZXJzID0gKCBqUXVlcnkuX2RhdGEoIHRoaXMsICJldmVudHMiICkgfHwge30gKVsgZXZlbnQudHlwZSBdIHx8IFtdLAoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGV2ZW50LnR5cGUgXSB8fCB7fTsKCgkJLy8gVXNlIHRoZSBmaXgtZWQgalF1ZXJ5LkV2ZW50IHJhdGhlciB0aGFuIHRoZSAocmVhZC1vbmx5KSBuYXRpdmUgZXZlbnQKCQlhcmdzWzBdID0gZXZlbnQ7CgkJZXZlbnQuZGVsZWdhdGVUYXJnZXQgPSB0aGlzOwoKCQkvLyBDYWxsIHRoZSBwcmVEaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUsIGFuZCBsZXQgaXQgYmFpbCBpZiBkZXNpcmVkCgkJaWYgKCBzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBoYW5kbGVycwoJCWhhbmRsZXJRdWV1ZSA9IGpRdWVyeS5ldmVudC5oYW5kbGVycy5jYWxsKCB0aGlzLCBldmVudCwgaGFuZGxlcnMgKTsKCgkJLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXMKCQlpID0gMDsKCQl3aGlsZSAoIChtYXRjaGVkID0gaGFuZGxlclF1ZXVlWyBpKysgXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgkJCWV2ZW50LmN1cnJlbnRUYXJnZXQgPSBtYXRjaGVkLmVsZW07CgoJCQlqID0gMDsKCQkJd2hpbGUgKCAoaGFuZGxlT2JqID0gbWF0Y2hlZC5oYW5kbGVyc1sgaisrIF0pICYmICFldmVudC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJCS8vIFRyaWdnZXJlZCBldmVudCBtdXN0IGVpdGhlciAxKSBoYXZlIG5vIG5hbWVzcGFjZSwgb3IKCQkJCS8vIDIpIGhhdmUgbmFtZXNwYWNlKHMpIGEgc3Vic2V0IG9yIGVxdWFsIHRvIHRob3NlIGluIHRoZSBib3VuZCBldmVudCAoYm90aCBjYW4gaGF2ZSBubyBuYW1lc3BhY2UpLgoJCQkJaWYgKCAhZXZlbnQubmFtZXNwYWNlX3JlIHx8IGV2ZW50Lm5hbWVzcGFjZV9yZS50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSB7CgoJCQkJCWV2ZW50LmhhbmRsZU9iaiA9IGhhbmRsZU9iajsKCQkJCQlldmVudC5kYXRhID0gaGFuZGxlT2JqLmRhdGE7CgoJCQkJCXJldCA9ICggKGpRdWVyeS5ldmVudC5zcGVjaWFsWyBoYW5kbGVPYmoub3JpZ1R5cGUgXSB8fCB7fSkuaGFuZGxlIHx8IGhhbmRsZU9iai5oYW5kbGVyICkKCQkJCQkJCS5hcHBseSggbWF0Y2hlZC5lbGVtLCBhcmdzICk7CgoJCQkJCWlmICggcmV0ICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJCWlmICggKGV2ZW50LnJlc3VsdCA9IHJldCkgPT09IGZhbHNlICkgewoJCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsIHRoZSBwb3N0RGlzcGF0Y2ggaG9vayBmb3IgdGhlIG1hcHBlZCB0eXBlCgkJaWYgKCBzcGVjaWFsLnBvc3REaXNwYXRjaCApIHsKCQkJc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKTsKCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWhhbmRsZXJzOiBmdW5jdGlvbiggZXZlbnQsIGhhbmRsZXJzICkgewoJCXZhciBzZWwsIGhhbmRsZU9iaiwgbWF0Y2hlcywgaSwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWRlbGVnYXRlQ291bnQgPSBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LAoJCQljdXIgPSBldmVudC50YXJnZXQ7CgoJCS8vIEZpbmQgZGVsZWdhdGUgaGFuZGxlcnMKCQkvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAoIzEzMTgwKQoJCS8vIEF2b2lkIG5vbi1sZWZ0LWNsaWNrIGJ1YmJsaW5nIGluIEZpcmVmb3ggKCMzODYxKQoJCWlmICggZGVsZWdhdGVDb3VudCAmJiBjdXIubm9kZVR5cGUgJiYgKCFldmVudC5idXR0b24gfHwgZXZlbnQudHlwZSAhPT0gImNsaWNrIikgKSB7CgoJCQlmb3IgKCA7IGN1ciAhPSB0aGlzOyBjdXIgPSBjdXIucGFyZW50Tm9kZSB8fCB0aGlzICkgewoKCQkJCS8vIERvbid0IGNoZWNrIG5vbi1lbGVtZW50cyAoIzEzMjA4KQoJCQkJLy8gRG9uJ3QgcHJvY2VzcyBjbGlja3Mgb24gZGlzYWJsZWQgZWxlbWVudHMgKCM2OTExLCAjODE2NSwgIzExMzgyLCAjMTE3NjQpCgkJCQlpZiAoIGN1ci5ub2RlVHlwZSA9PT0gMSAmJiAoY3VyLmRpc2FibGVkICE9PSB0cnVlIHx8IGV2ZW50LnR5cGUgIT09ICJjbGljayIpICkgewoJCQkJCW1hdGNoZXMgPSBbXTsKCQkJCQlmb3IgKCBpID0gMDsgaSA8IGRlbGVnYXRlQ291bnQ7IGkrKyApIHsKCQkJCQkJaGFuZGxlT2JqID0gaGFuZGxlcnNbIGkgXTsKCgkJCQkJCS8vIERvbid0IGNvbmZsaWN0IHdpdGggT2JqZWN0LnByb3RvdHlwZSBwcm9wZXJ0aWVzICgjMTMyMDMpCgkJCQkJCXNlbCA9IGhhbmRsZU9iai5zZWxlY3RvciArICIgIjsKCgkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gPT09IHVuZGVmaW5lZCApIHsKCQkJCQkJCW1hdGNoZXNbIHNlbCBdID0gaGFuZGxlT2JqLm5lZWRzQ29udGV4dCA/CgkJCQkJCQkJalF1ZXJ5KCBzZWwsIHRoaXMgKS5pbmRleCggY3VyICkgPj0gMCA6CgkJCQkJCQkJalF1ZXJ5LmZpbmQoIHNlbCwgdGhpcywgbnVsbCwgWyBjdXIgXSApLmxlbmd0aDsKCQkJCQkJfQoJCQkJCQlpZiAoIG1hdGNoZXNbIHNlbCBdICkgewoJCQkJCQkJbWF0Y2hlcy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoIG1hdGNoZXMubGVuZ3RoICkgewoJCQkJCQloYW5kbGVyUXVldWUucHVzaCh7IGVsZW06IGN1ciwgaGFuZGxlcnM6IG1hdGNoZXMgfSk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBBZGQgdGhlIHJlbWFpbmluZyAoZGlyZWN0bHktYm91bmQpIGhhbmRsZXJzCgkJaWYgKCBkZWxlZ2F0ZUNvdW50IDwgaGFuZGxlcnMubGVuZ3RoICkgewoJCQloYW5kbGVyUXVldWUucHVzaCh7IGVsZW06IHRoaXMsIGhhbmRsZXJzOiBoYW5kbGVycy5zbGljZSggZGVsZWdhdGVDb3VudCApIH0pOwoJCX0KCgkJcmV0dXJuIGhhbmRsZXJRdWV1ZTsKCX0sCgoJZml4OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCgkJLy8gQ3JlYXRlIGEgd3JpdGFibGUgY29weSBvZiB0aGUgZXZlbnQgb2JqZWN0IGFuZCBub3JtYWxpemUgc29tZSBwcm9wZXJ0aWVzCgkJdmFyIGksIHByb3AsIGNvcHksCgkJCXR5cGUgPSBldmVudC50eXBlLAoJCQlvcmlnaW5hbEV2ZW50ID0gZXZlbnQsCgkJCWZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzWyB0eXBlIF07CgoJCWlmICggIWZpeEhvb2sgKSB7CgkJCXRoaXMuZml4SG9va3NbIHR5cGUgXSA9IGZpeEhvb2sgPQoJCQkJcm1vdXNlRXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5tb3VzZUhvb2tzIDoKCQkJCXJrZXlFdmVudC50ZXN0KCB0eXBlICkgPyB0aGlzLmtleUhvb2tzIDoKCQkJCXt9OwoJCX0KCQljb3B5ID0gZml4SG9vay5wcm9wcyA/IHRoaXMucHJvcHMuY29uY2F0KCBmaXhIb29rLnByb3BzICkgOiB0aGlzLnByb3BzOwoKCQlldmVudCA9IG5ldyBqUXVlcnkuRXZlbnQoIG9yaWdpbmFsRXZlbnQgKTsKCgkJaSA9IGNvcHkubGVuZ3RoOwoJCXdoaWxlICggaS0tICkgewoJCQlwcm9wID0gY29weVsgaSBdOwoJCQlldmVudFsgcHJvcCBdID0gb3JpZ2luYWxFdmVudFsgcHJvcCBdOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEZpeCB0YXJnZXQgcHJvcGVydHkgKCMxOTI1KQoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gb3JpZ2luYWxFdmVudC5zcmNFbGVtZW50IHx8IGRvY3VtZW50OwoJCX0KCgkJLy8gU3VwcG9ydDogQ2hyb21lIDIzKywgU2FmYXJpPwoJCS8vIFRhcmdldCBzaG91bGQgbm90IGJlIGEgdGV4dCBub2RlICgjNTA0LCAjMTMxNDMpCgkJaWYgKCBldmVudC50YXJnZXQubm9kZVR5cGUgPT09IDMgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEZvciBtb3VzZS9rZXkgZXZlbnRzLCBtZXRhS2V5PT1mYWxzZSBpZiBpdCdzIHVuZGVmaW5lZCAoIzMzNjgsICMxMTMyOCkKCQlldmVudC5tZXRhS2V5ID0gISFldmVudC5tZXRhS2V5OwoKCQlyZXR1cm4gZml4SG9vay5maWx0ZXIgPyBmaXhIb29rLmZpbHRlciggZXZlbnQsIG9yaWdpbmFsRXZlbnQgKSA6IGV2ZW50OwoJfSwKCgkvLyBJbmNsdWRlcyBzb21lIGV2ZW50IHByb3BzIHNoYXJlZCBieSBLZXlFdmVudCBhbmQgTW91c2VFdmVudAoJcHJvcHM6ICJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giLnNwbGl0KCIgIiksCgoJZml4SG9va3M6IHt9LAoKCWtleUhvb2tzOiB7CgkJcHJvcHM6ICJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCgiICIpLAoJCWZpbHRlcjogZnVuY3Rpb24oIGV2ZW50LCBvcmlnaW5hbCApIHsKCgkJCS8vIEFkZCB3aGljaCBmb3Iga2V5IGV2ZW50cwoJCQlpZiAoIGV2ZW50LndoaWNoID09IG51bGwgKSB7CgkJCQlldmVudC53aGljaCA9IG9yaWdpbmFsLmNoYXJDb2RlICE9IG51bGwgPyBvcmlnaW5hbC5jaGFyQ29kZSA6IG9yaWdpbmFsLmtleUNvZGU7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCW1vdXNlSG9va3M6IHsKCQlwcm9wczogImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBmcm9tRWxlbWVudCBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIuc3BsaXQoIiAiKSwKCQlmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7CgkJCXZhciBib2R5LCBldmVudERvYywgZG9jLAoJCQkJYnV0dG9uID0gb3JpZ2luYWwuYnV0dG9uLAoJCQkJZnJvbUVsZW1lbnQgPSBvcmlnaW5hbC5mcm9tRWxlbWVudDsKCgkJCS8vIENhbGN1bGF0ZSBwYWdlWC9ZIGlmIG1pc3NpbmcgYW5kIGNsaWVudFgvWSBhdmFpbGFibGUKCQkJaWYgKCBldmVudC5wYWdlWCA9PSBudWxsICYmIG9yaWdpbmFsLmNsaWVudFggIT0gbnVsbCApIHsKCQkJCWV2ZW50RG9jID0gZXZlbnQudGFyZ2V0Lm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQ7CgkJCQlkb2MgPSBldmVudERvYy5kb2N1bWVudEVsZW1lbnQ7CgkJCQlib2R5ID0gZXZlbnREb2MuYm9keTsKCgkJCQlldmVudC5wYWdlWCA9IG9yaWdpbmFsLmNsaWVudFggKyAoIGRvYyAmJiBkb2Muc2Nyb2xsTGVmdCB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsTGVmdCB8fCAwICkgLSAoIGRvYyAmJiBkb2MuY2xpZW50TGVmdCB8fCBib2R5ICYmIGJvZHkuY2xpZW50TGVmdCB8fCAwICk7CgkJCQlldmVudC5wYWdlWSA9IG9yaWdpbmFsLmNsaWVudFkgKyAoIGRvYyAmJiBkb2Muc2Nyb2xsVG9wICB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsVG9wICB8fCAwICkgLSAoIGRvYyAmJiBkb2MuY2xpZW50VG9wICB8fCBib2R5ICYmIGJvZHkuY2xpZW50VG9wICB8fCAwICk7CgkJCX0KCgkJCS8vIEFkZCByZWxhdGVkVGFyZ2V0LCBpZiBuZWNlc3NhcnkKCQkJaWYgKCAhZXZlbnQucmVsYXRlZFRhcmdldCAmJiBmcm9tRWxlbWVudCApIHsKCQkJCWV2ZW50LnJlbGF0ZWRUYXJnZXQgPSBmcm9tRWxlbWVudCA9PT0gZXZlbnQudGFyZ2V0ID8gb3JpZ2luYWwudG9FbGVtZW50IDogZnJvbUVsZW1lbnQ7CgkJCX0KCgkJCS8vIEFkZCB3aGljaCBmb3IgY2xpY2s6IDEgPT09IGxlZnQ7IDIgPT09IG1pZGRsZTsgMyA9PT0gcmlnaHQKCQkJLy8gTm90ZTogYnV0dG9uIGlzIG5vdCBub3JtYWxpemVkLCBzbyBkb24ndCB1c2UgaXQKCQkJaWYgKCAhZXZlbnQud2hpY2ggJiYgYnV0dG9uICE9PSB1bmRlZmluZWQgKSB7CgkJCQlldmVudC53aGljaCA9ICggYnV0dG9uICYgMSA/IDEgOiAoIGJ1dHRvbiAmIDIgPyAzIDogKCBidXR0b24gJiA0ID8gMiA6IDAgKSApICk7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCXNwZWNpYWw6IHsKCQlsb2FkOiB7CgkJCS8vIFByZXZlbnQgdHJpZ2dlcmVkIGltYWdlLmxvYWQgZXZlbnRzIGZyb20gYnViYmxpbmcgdG8gd2luZG93LmxvYWQKCQkJbm9CdWJibGU6IHRydWUKCQl9LAoJCWNsaWNrOiB7CgkJCS8vIEZvciBjaGVja2JveCwgZmlyZSBuYXRpdmUgZXZlbnQgc28gY2hlY2tlZCBzdGF0ZSB3aWxsIGJlIHJpZ2h0CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJpbnB1dCIgKSAmJiB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgJiYgdGhpcy5jbGljayApIHsKCQkJCQl0aGlzLmNsaWNrKCk7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJfSwKCQlmb2N1czogewoJCQkvLyBGaXJlIG5hdGl2ZSBldmVudCBpZiBwb3NzaWJsZSBzbyBibHVyL2ZvY3VzIHNlcXVlbmNlIGlzIGNvcnJlY3QKCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHRoaXMgIT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgdGhpcy5mb2N1cyApIHsKCQkJCQl0cnkgewoJCQkJCQl0aGlzLmZvY3VzKCk7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9IGNhdGNoICggZSApIHsKCQkJCQkJLy8gU3VwcG9ydDogSUU8OQoJCQkJCQkvLyBJZiB3ZSBlcnJvciBvbiBmb2N1cyB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsICMxMjUxOCksCgkJCQkJCS8vIGxldCAudHJpZ2dlcigpIHJ1biB0aGUgaGFuZGxlcnMKCQkJCQl9CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3VzaW4iCgkJfSwKCQlibHVyOiB7CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIHRoaXMuYmx1ciApIHsKCQkJCQl0aGlzLmJsdXIoKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3Vzb3V0IgoJCX0sCgoJCWJlZm9yZXVubG9hZDogewoJCQlwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJCQkvLyBFdmVuIHdoZW4gcmV0dXJuVmFsdWUgZXF1YWxzIHRvIHVuZGVmaW5lZCBGaXJlZm94IHdpbGwgc3RpbGwgc2hvdyBhbGVydAoJCQkJaWYgKCBldmVudC5yZXN1bHQgIT09IHVuZGVmaW5lZCApIHsKCQkJCQlldmVudC5vcmlnaW5hbEV2ZW50LnJldHVyblZhbHVlID0gZXZlbnQucmVzdWx0OwoJCQkJfQoJCQl9CgkJfQoJfSwKCglzaW11bGF0ZTogZnVuY3Rpb24oIHR5cGUsIGVsZW0sIGV2ZW50LCBidWJibGUgKSB7CgkJLy8gUGlnZ3liYWNrIG9uIGEgZG9ub3IgZXZlbnQgdG8gc2ltdWxhdGUgYSBkaWZmZXJlbnQgb25lLgoJCS8vIEZha2Ugb3JpZ2luYWxFdmVudCB0byBhdm9pZCBkb25vcidzIHN0b3BQcm9wYWdhdGlvbiwgYnV0IGlmIHRoZQoJCS8vIHNpbXVsYXRlZCBldmVudCBwcmV2ZW50cyBkZWZhdWx0IHRoZW4gd2UgZG8gdGhlIHNhbWUgb24gdGhlIGRvbm9yLgoJCXZhciBlID0galF1ZXJ5LmV4dGVuZCgKCQkJbmV3IGpRdWVyeS5FdmVudCgpLAoJCQlldmVudCwKCQkJeyB0eXBlOiB0eXBlLAoJCQkJaXNTaW11bGF0ZWQ6IHRydWUsCgkJCQlvcmlnaW5hbEV2ZW50OiB7fQoJCQl9CgkJKTsKCQlpZiAoIGJ1YmJsZSApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGUsIG51bGwsIGVsZW0gKTsKCQl9IGVsc2UgewoJCQlqUXVlcnkuZXZlbnQuZGlzcGF0Y2guY2FsbCggZWxlbSwgZSApOwoJCX0KCQlpZiAoIGUuaXNEZWZhdWx0UHJldmVudGVkKCkgKSB7CgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJfQoJfQp9OwoKalF1ZXJ5LnJlbW92ZUV2ZW50ID0gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciA/CglmdW5jdGlvbiggZWxlbSwgdHlwZSwgaGFuZGxlICkgewoJCWlmICggZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICkgewoJCQllbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIoIHR5cGUsIGhhbmRsZSwgZmFsc2UgKTsKCQl9Cgl9IDoKCWZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBoYW5kbGUgKSB7CgkJdmFyIG5hbWUgPSAib24iICsgdHlwZTsKCgkJaWYgKCBlbGVtLmRldGFjaEV2ZW50ICkgewoKCQkJLy8gIzg1NDUsICM3MDU0LCBwcmV2ZW50aW5nIG1lbW9yeSBsZWFrcyBmb3IgY3VzdG9tIGV2ZW50cyBpbiBJRTYtOAoJCQkvLyBkZXRhY2hFdmVudCBuZWVkZWQgcHJvcGVydHkgb24gZWxlbWVudCwgYnkgbmFtZSBvZiB0aGF0IGV2ZW50LCB0byBwcm9wZXJseSBleHBvc2UgaXQgdG8gR0MKCQkJaWYgKCB0eXBlb2YgZWxlbVsgbmFtZSBdID09PSBjb3JlX3N0cnVuZGVmaW5lZCApIHsKCQkJCWVsZW1bIG5hbWUgXSA9IG51bGw7CgkJCX0KCgkJCWVsZW0uZGV0YWNoRXZlbnQoIG5hbWUsIGhhbmRsZSApOwoJCX0KCX07CgpqUXVlcnkuRXZlbnQgPSBmdW5jdGlvbiggc3JjLCBwcm9wcyApIHsKCS8vIEFsbG93IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgJ25ldycga2V5d29yZAoJaWYgKCAhKHRoaXMgaW5zdGFuY2VvZiBqUXVlcnkuRXZlbnQpICkgewoJCXJldHVybiBuZXcgalF1ZXJ5LkV2ZW50KCBzcmMsIHByb3BzICk7Cgl9CgoJLy8gRXZlbnQgb2JqZWN0CglpZiAoIHNyYyAmJiBzcmMudHlwZSApIHsKCQl0aGlzLm9yaWdpbmFsRXZlbnQgPSBzcmM7CgkJdGhpcy50eXBlID0gc3JjLnR5cGU7CgoJCS8vIEV2ZW50cyBidWJibGluZyB1cCB0aGUgZG9jdW1lbnQgbWF5IGhhdmUgYmVlbiBtYXJrZWQgYXMgcHJldmVudGVkCgkJLy8gYnkgYSBoYW5kbGVyIGxvd2VyIGRvd24gdGhlIHRyZWU7IHJlZmxlY3QgdGhlIGNvcnJlY3QgdmFsdWUuCgkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSAoIHNyYy5kZWZhdWx0UHJldmVudGVkIHx8IHNyYy5yZXR1cm5WYWx1ZSA9PT0gZmFsc2UgfHwKCQkJc3JjLmdldFByZXZlbnREZWZhdWx0ICYmIHNyYy5nZXRQcmV2ZW50RGVmYXVsdCgpICkgPyByZXR1cm5UcnVlIDogcmV0dXJuRmFsc2U7CgoJLy8gRXZlbnQgdHlwZQoJfSBlbHNlIHsKCQl0aGlzLnR5cGUgPSBzcmM7Cgl9CgoJLy8gUHV0IGV4cGxpY2l0bHkgcHJvdmlkZWQgcHJvcGVydGllcyBvbnRvIHRoZSBldmVudCBvYmplY3QKCWlmICggcHJvcHMgKSB7CgkJalF1ZXJ5LmV4dGVuZCggdGhpcywgcHJvcHMgKTsKCX0KCgkvLyBDcmVhdGUgYSB0aW1lc3RhbXAgaWYgaW5jb21pbmcgZXZlbnQgZG9lc24ndCBoYXZlIG9uZQoJdGhpcy50aW1lU3RhbXAgPSBzcmMgJiYgc3JjLnRpbWVTdGFtcCB8fCBqUXVlcnkubm93KCk7CgoJLy8gTWFyayBpdCBhcyBmaXhlZAoJdGhpc1sgalF1ZXJ5LmV4cGFuZG8gXSA9IHRydWU7Cn07CgovLyBqUXVlcnkuRXZlbnQgaXMgYmFzZWQgb24gRE9NMyBFdmVudHMgYXMgc3BlY2lmaWVkIGJ5IHRoZSBFQ01BU2NyaXB0IExhbmd1YWdlIEJpbmRpbmcKLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMy9XRC1ET00tTGV2ZWwtMy1FdmVudHMtMjAwMzAzMzEvZWNtYS1zY3JpcHQtYmluZGluZy5odG1sCmpRdWVyeS5FdmVudC5wcm90b3R5cGUgPSB7Cglpc0RlZmF1bHRQcmV2ZW50ZWQ6IHJldHVybkZhbHNlLAoJaXNQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoJaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoKCXByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSByZXR1cm5UcnVlOwoJCWlmICggIWUgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIElmIHByZXZlbnREZWZhdWx0IGV4aXN0cywgcnVuIGl0IG9uIHRoZSBvcmlnaW5hbCBldmVudAoJCWlmICggZS5wcmV2ZW50RGVmYXVsdCApIHsKCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoKCQkvLyBTdXBwb3J0OiBJRQoJCS8vIE90aGVyd2lzZSBzZXQgdGhlIHJldHVyblZhbHVlIHByb3BlcnR5IG9mIHRoZSBvcmlnaW5hbCBldmVudCB0byBmYWxzZQoJCX0gZWxzZSB7CgkJCWUucmV0dXJuVmFsdWUgPSBmYWxzZTsKCQl9Cgl9LAoJc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgkJaWYgKCAhZSApIHsKCQkJcmV0dXJuOwoJCX0KCQkvLyBJZiBzdG9wUHJvcGFnYXRpb24gZXhpc3RzLCBydW4gaXQgb24gdGhlIG9yaWdpbmFsIGV2ZW50CgkJaWYgKCBlLnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9CgoJCS8vIFN1cHBvcnQ6IElFCgkJLy8gU2V0IHRoZSBjYW5jZWxCdWJibGUgcHJvcGVydHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IHRvIHRydWUKCQllLmNhbmNlbEJ1YmJsZSA9IHRydWU7Cgl9LAoJc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTsKCQl0aGlzLnN0b3BQcm9wYWdhdGlvbigpOwoJfQp9OwoKLy8gQ3JlYXRlIG1vdXNlZW50ZXIvbGVhdmUgZXZlbnRzIHVzaW5nIG1vdXNlb3Zlci9vdXQgYW5kIGV2ZW50LXRpbWUgY2hlY2tzCmpRdWVyeS5lYWNoKHsKCW1vdXNlZW50ZXI6ICJtb3VzZW92ZXIiLAoJbW91c2VsZWF2ZTogIm1vdXNlb3V0Igp9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoJalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIG9yaWcgXSA9IHsKCQlkZWxlZ2F0ZVR5cGU6IGZpeCwKCQliaW5kVHlwZTogZml4LAoKCQloYW5kbGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIHJldCwKCQkJCXRhcmdldCA9IHRoaXMsCgkJCQlyZWxhdGVkID0gZXZlbnQucmVsYXRlZFRhcmdldCwKCQkJCWhhbmRsZU9iaiA9IGV2ZW50LmhhbmRsZU9iajsKCgkJCS8vIEZvciBtb3VzZW50ZXIvbGVhdmUgY2FsbCB0aGUgaGFuZGxlciBpZiByZWxhdGVkIGlzIG91dHNpZGUgdGhlIHRhcmdldC4KCQkJLy8gTkI6IE5vIHJlbGF0ZWRUYXJnZXQgaWYgdGhlIG1vdXNlIGxlZnQvZW50ZXJlZCB0aGUgYnJvd3NlciB3aW5kb3cKCQkJaWYgKCAhcmVsYXRlZCB8fCAocmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFqUXVlcnkuY29udGFpbnMoIHRhcmdldCwgcmVsYXRlZCApKSApIHsKCQkJCWV2ZW50LnR5cGUgPSBoYW5kbGVPYmoub3JpZ1R5cGU7CgkJCQlyZXQgPSBoYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQlldmVudC50eXBlID0gZml4OwoJCQl9CgkJCXJldHVybiByZXQ7CgkJfQoJfTsKfSk7CgovLyBJRSBzdWJtaXQgZGVsZWdhdGlvbgppZiAoICFqUXVlcnkuc3VwcG9ydC5zdWJtaXRCdWJibGVzICkgewoKCWpRdWVyeS5ldmVudC5zcGVjaWFsLnN1Ym1pdCA9IHsKCQlzZXR1cDogZnVuY3Rpb24oKSB7CgkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiZm9ybSIgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gTGF6eS1hZGQgYSBzdWJtaXQgaGFuZGxlciB3aGVuIGEgZGVzY2VuZGFudCBmb3JtIG1heSBwb3RlbnRpYWxseSBiZSBzdWJtaXR0ZWQKCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgImNsaWNrLl9zdWJtaXQga2V5cHJlc3MuX3N1Ym1pdCIsIGZ1bmN0aW9uKCBlICkgewoJCQkJLy8gTm9kZSBuYW1lIGNoZWNrIGF2b2lkcyBhIFZNTC1yZWxhdGVkIGNyYXNoIGluIElFICgjOTgwNykKCQkJCXZhciBlbGVtID0gZS50YXJnZXQsCgkJCQkJZm9ybSA9IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApIHx8IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImJ1dHRvbiIgKSA/IGVsZW0uZm9ybSA6IHVuZGVmaW5lZDsKCQkJCWlmICggZm9ybSAmJiAhalF1ZXJ5Ll9kYXRhKCBmb3JtLCAic3VibWl0QnViYmxlcyIgKSApIHsKCQkJCQlqUXVlcnkuZXZlbnQuYWRkKCBmb3JtLCAic3VibWl0Ll9zdWJtaXQiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWV2ZW50Ll9zdWJtaXRfYnViYmxlID0gdHJ1ZTsKCQkJCQl9KTsKCQkJCQlqUXVlcnkuX2RhdGEoIGZvcm0sICJzdWJtaXRCdWJibGVzIiwgdHJ1ZSApOwoJCQkJfQoJCQl9KTsKCQkJLy8gcmV0dXJuIHVuZGVmaW5lZCBzaW5jZSB3ZSBkb24ndCBuZWVkIGFuIGV2ZW50IGxpc3RlbmVyCgkJfSwKCgkJcG9zdERpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCS8vIElmIGZvcm0gd2FzIHN1Ym1pdHRlZCBieSB0aGUgdXNlciwgYnViYmxlIHRoZSBldmVudCB1cCB0aGUgdHJlZQoJCQlpZiAoIGV2ZW50Ll9zdWJtaXRfYnViYmxlICkgewoJCQkJZGVsZXRlIGV2ZW50Ll9zdWJtaXRfYnViYmxlOwoJCQkJaWYgKCB0aGlzLnBhcmVudE5vZGUgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQlqUXVlcnkuZXZlbnQuc2ltdWxhdGUoICJzdWJtaXQiLCB0aGlzLnBhcmVudE5vZGUsIGV2ZW50LCB0cnVlICk7CgkJCQl9CgkJCX0KCQl9LAoKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiZm9ybSIgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gUmVtb3ZlIGRlbGVnYXRlZCBoYW5kbGVyczsgY2xlYW5EYXRhIGV2ZW50dWFsbHkgcmVhcHMgc3VibWl0IGhhbmRsZXJzIGF0dGFjaGVkIGFib3ZlCgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX3N1Ym1pdCIgKTsKCQl9Cgl9Owp9CgovLyBJRSBjaGFuZ2UgZGVsZWdhdGlvbiBhbmQgY2hlY2tib3gvcmFkaW8gZml4CmlmICggIWpRdWVyeS5zdXBwb3J0LmNoYW5nZUJ1YmJsZXMgKSB7CgoJalF1ZXJ5LmV2ZW50LnNwZWNpYWwuY2hhbmdlID0gewoKCQlzZXR1cDogZnVuY3Rpb24oKSB7CgoJCQlpZiAoIHJmb3JtRWxlbXMudGVzdCggdGhpcy5ub2RlTmFtZSApICkgewoJCQkJLy8gSUUgZG9lc24ndCBmaXJlIGNoYW5nZSBvbiBhIGNoZWNrL3JhZGlvIHVudGlsIGJsdXI7IHRyaWdnZXIgaXQgb24gY2xpY2sKCQkJCS8vIGFmdGVyIGEgcHJvcGVydHljaGFuZ2UuIEVhdCB0aGUgYmx1ci1jaGFuZ2UgaW4gc3BlY2lhbC5jaGFuZ2UuaGFuZGxlLgoJCQkJLy8gVGhpcyBzdGlsbCBmaXJlcyBvbmNoYW5nZSBhIHNlY29uZCB0aW1lIGZvciBjaGVjay9yYWRpbyBhZnRlciBibHVyLgoJCQkJaWYgKCB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgfHwgdGhpcy50eXBlID09PSAicmFkaW8iICkgewoJCQkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJwcm9wZXJ0eWNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQlpZiAoIGV2ZW50Lm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lID09PSAiY2hlY2tlZCIgKSB7CgkJCQkJCQl0aGlzLl9qdXN0X2NoYW5nZWQgPSB0cnVlOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgImNsaWNrLl9jaGFuZ2UiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWlmICggdGhpcy5fanVzdF9jaGFuZ2VkICYmICFldmVudC5pc1RyaWdnZXIgKSB7CgkJCQkJCQl0aGlzLl9qdXN0X2NoYW5nZWQgPSBmYWxzZTsKCQkJCQkJfQoJCQkJCQkvLyBBbGxvdyB0cmlnZ2VyZWQsIHNpbXVsYXRlZCBjaGFuZ2UgZXZlbnRzICgjMTE1MDApCgkJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggImNoYW5nZSIsIHRoaXMsIGV2ZW50LCB0cnVlICk7CgkJCQkJfSk7CgkJCQl9CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJLy8gRGVsZWdhdGVkIGV2ZW50OyBsYXp5LWFkZCBhIGNoYW5nZSBoYW5kbGVyIG9uIGRlc2NlbmRhbnQgaW5wdXRzCgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGUgKSB7CgkJCQl2YXIgZWxlbSA9IGUudGFyZ2V0OwoKCQkJCWlmICggcmZvcm1FbGVtcy50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZUJ1YmJsZXMiICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggZWxlbSwgImNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSAmJiAhZXZlbnQuaXNTaW11bGF0ZWQgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggImNoYW5nZSIsIHRoaXMucGFyZW50Tm9kZSwgZXZlbnQsIHRydWUgKTsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZUJ1YmJsZXMiLCB0cnVlICk7CgkJCQl9CgkJCX0pOwoJCX0sCgoJCWhhbmRsZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgZWxlbSA9IGV2ZW50LnRhcmdldDsKCgkJCS8vIFN3YWxsb3cgbmF0aXZlIGNoYW5nZSBldmVudHMgZnJvbSBjaGVja2JveC9yYWRpbywgd2UgYWxyZWFkeSB0cmlnZ2VyZWQgdGhlbSBhYm92ZQoJCQlpZiAoIHRoaXMgIT09IGVsZW0gfHwgZXZlbnQuaXNTaW11bGF0ZWQgfHwgZXZlbnQuaXNUcmlnZ2VyIHx8IChlbGVtLnR5cGUgIT09ICJyYWRpbyIgJiYgZWxlbS50eXBlICE9PSAiY2hlY2tib3giKSApIHsKCQkJCXJldHVybiBldmVudC5oYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCX0KCQl9LAoKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX2NoYW5nZSIgKTsKCgkJCXJldHVybiAhcmZvcm1FbGVtcy50ZXN0KCB0aGlzLm5vZGVOYW1lICk7CgkJfQoJfTsKfQoKLy8gQ3JlYXRlICJidWJibGluZyIgZm9jdXMgYW5kIGJsdXIgZXZlbnRzCmlmICggIWpRdWVyeS5zdXBwb3J0LmZvY3VzaW5CdWJibGVzICkgewoJalF1ZXJ5LmVhY2goeyBmb2N1czogImZvY3VzaW4iLCBibHVyOiAiZm9jdXNvdXQiIH0sIGZ1bmN0aW9uKCBvcmlnLCBmaXggKSB7CgoJCS8vIEF0dGFjaCBhIHNpbmdsZSBjYXB0dXJpbmcgaGFuZGxlciB3aGlsZSBzb21lb25lIHdhbnRzIGZvY3VzaW4vZm9jdXNvdXQKCQl2YXIgYXR0YWNoZXMgPSAwLAoJCQloYW5kbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCBmaXgsIGV2ZW50LnRhcmdldCwgalF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKSwgdHJ1ZSApOwoJCQl9OwoKCQlqUXVlcnkuZXZlbnQuc3BlY2lhbFsgZml4IF0gPSB7CgkJCXNldHVwOiBmdW5jdGlvbigpIHsKCQkJCWlmICggYXR0YWNoZXMrKyA9PT0gMCApIHsKCQkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCBvcmlnLCBoYW5kbGVyLCB0cnVlICk7CgkJCQl9CgkJCX0sCgkJCXRlYXJkb3duOiBmdW5jdGlvbigpIHsKCQkJCWlmICggLS1hdHRhY2hlcyA9PT0gMCApIHsKCQkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCBvcmlnLCBoYW5kbGVyLCB0cnVlICk7CgkJCQl9CgkJCX0KCQl9OwoJfSk7Cn0KCmpRdWVyeS5mbi5leHRlbmQoewoKCW9uOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgLypJTlRFUk5BTCovIG9uZSApIHsKCQl2YXIgdHlwZSwgb3JpZ0ZuOwoKCQkvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCQlpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7CgkJCS8vICggdHlwZXMtT2JqZWN0LCBzZWxlY3RvciwgZGF0YSApCgkJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMtT2JqZWN0LCBkYXRhICkKCQkJCWRhdGEgPSBkYXRhIHx8IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub24oIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggZGF0YSA9PSBudWxsICYmIGZuID09IG51bGwgKSB7CgkJCS8vICggdHlwZXMsIGZuICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0gZWxzZSBpZiAoIGZuID09IG51bGwgKSB7CgkJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApCgkJCQlmbiA9IGRhdGE7CgkJCQlkYXRhID0gdW5kZWZpbmVkOwoJCQl9IGVsc2UgewoJCQkJLy8gKCB0eXBlcywgZGF0YSwgZm4gKQoJCQkJZm4gPSBkYXRhOwoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfSBlbHNlIGlmICggIWZuICkgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggb25lID09PSAxICkgewoJCQlvcmlnRm4gPSBmbjsKCQkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkvLyBDYW4gdXNlIGFuIGVtcHR5IHNldCwgc2luY2UgZXZlbnQgY29udGFpbnMgdGhlIGluZm8KCQkJCWpRdWVyeSgpLm9mZiggZXZlbnQgKTsKCQkJCXJldHVybiBvcmlnRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9OwoJCQkvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGbgoJCQlmbi5ndWlkID0gb3JpZ0ZuLmd1aWQgfHwgKCBvcmlnRm4uZ3VpZCA9IGpRdWVyeS5ndWlkKysgKTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsIHR5cGVzLCBmbiwgZGF0YSwgc2VsZWN0b3IgKTsKCQl9KTsKCX0sCglvbmU6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAxICk7Cgl9LAoJb2ZmOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBmbiApIHsKCQl2YXIgaGFuZGxlT2JqLCB0eXBlOwoJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoJCQkvLyAoIGV2ZW50ICkgIGRpc3BhdGNoZWQgalF1ZXJ5LkV2ZW50CgkJCWhhbmRsZU9iaiA9IHR5cGVzLmhhbmRsZU9iajsKCQkJalF1ZXJ5KCB0eXBlcy5kZWxlZ2F0ZVRhcmdldCApLm9mZigKCQkJCWhhbmRsZU9iai5uYW1lc3BhY2UgPyBoYW5kbGVPYmoub3JpZ1R5cGUgKyAiLiIgKyBoYW5kbGVPYmoubmFtZXNwYWNlIDogaGFuZGxlT2JqLm9yaWdUeXBlLAoJCQkJaGFuZGxlT2JqLnNlbGVjdG9yLAoJCQkJaGFuZGxlT2JqLmhhbmRsZXIKCQkJKTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoJCWlmICggdHlwZW9mIHR5cGVzID09PSAib2JqZWN0IiApIHsKCQkJLy8gKCB0eXBlcy1vYmplY3QgWywgc2VsZWN0b3JdICkKCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApOwoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAoIHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIgKSB7CgkJCS8vICggdHlwZXMgWywgZm5dICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggZm4gPT09IGZhbHNlICkgewoJCQlmbiA9IHJldHVybkZhbHNlOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCB0eXBlcywgZm4sIHNlbGVjdG9yICk7CgkJfSk7Cgl9LAoKCWJpbmQ6IGZ1bmN0aW9uKCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGVzLCBudWxsLCBkYXRhLCBmbiApOwoJfSwKCXVuYmluZDogZnVuY3Rpb24oIHR5cGVzLCBmbiApIHsKCQlyZXR1cm4gdGhpcy5vZmYoIHR5cGVzLCBudWxsLCBmbiApOwoJfSwKCglkZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4gKTsKCX0sCgl1bmRlbGVnYXRlOiBmdW5jdGlvbiggc2VsZWN0b3IsIHR5cGVzLCBmbiApIHsKCQkvLyAoIG5hbWVzcGFjZSApIG9yICggc2VsZWN0b3IsIHR5cGVzIFssIGZuXSApCgkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyB0aGlzLm9mZiggc2VsZWN0b3IsICIqKiIgKSA6IHRoaXMub2ZmKCB0eXBlcywgc2VsZWN0b3IgfHwgIioqIiwgZm4gKTsKCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIHR5cGUsIGRhdGEsIHRoaXMgKTsKCQl9KTsKCX0sCgl0cmlnZ2VySGFuZGxlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJdmFyIGVsZW0gPSB0aGlzWzBdOwoJCWlmICggZWxlbSApIHsKCQkJcmV0dXJuIGpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCBlbGVtLCB0cnVlICk7CgkJfQoJfQp9KTsKLyohCiAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lCiAqIENvcHlyaWdodCAyMDEyIGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqIGh0dHA6Ly9zaXp6bGVqcy5jb20vCiAqLwooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgewoKdmFyIGksCgljYWNoZWRydW5zLAoJRXhwciwKCWdldFRleHQsCglpc1hNTCwKCWNvbXBpbGUsCgloYXNEdXBsaWNhdGUsCglvdXRlcm1vc3RDb250ZXh0LAoKCS8vIExvY2FsIGRvY3VtZW50IHZhcnMKCXNldERvY3VtZW50LAoJZG9jdW1lbnQsCglkb2NFbGVtLAoJZG9jdW1lbnRJc1hNTCwKCXJidWdneVFTQSwKCXJidWdneU1hdGNoZXMsCgltYXRjaGVzLAoJY29udGFpbnMsCglzb3J0T3JkZXIsCgoJLy8gSW5zdGFuY2Utc3BlY2lmaWMgZGF0YQoJZXhwYW5kbyA9ICJzaXp6bGUiICsgLShuZXcgRGF0ZSgpKSwKCXByZWZlcnJlZERvYyA9IHdpbmRvdy5kb2N1bWVudCwKCXN1cHBvcnQgPSB7fSwKCWRpcnJ1bnMgPSAwLAoJZG9uZSA9IDAsCgljbGFzc0NhY2hlID0gY3JlYXRlQ2FjaGUoKSwKCXRva2VuQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAoJY29tcGlsZXJDYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgoJLy8gR2VuZXJhbC1wdXJwb3NlIGNvbnN0YW50cwoJc3RydW5kZWZpbmVkID0gdHlwZW9mIHVuZGVmaW5lZCwKCU1BWF9ORUdBVElWRSA9IDEgPDwgMzEsCgoJLy8gQXJyYXkgbWV0aG9kcwoJYXJyID0gW10sCglwb3AgPSBhcnIucG9wLAoJcHVzaCA9IGFyci5wdXNoLAoJc2xpY2UgPSBhcnIuc2xpY2UsCgkvLyBVc2UgYSBzdHJpcHBlZC1kb3duIGluZGV4T2YgaWYgd2UgY2FuJ3QgdXNlIGEgbmF0aXZlIG9uZQoJaW5kZXhPZiA9IGFyci5pbmRleE9mIHx8IGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBpID0gMCwKCQkJbGVuID0gdGhpcy5sZW5ndGg7CgkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCWlmICggdGhpc1tpXSA9PT0gZWxlbSApIHsKCQkJCXJldHVybiBpOwoJCQl9CgkJfQoJCXJldHVybiAtMTsKCX0sCgoKCS8vIFJlZ3VsYXIgZXhwcmVzc2lvbnMKCgkvLyBXaGl0ZXNwYWNlIGNoYXJhY3RlcnMgaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI3doaXRlc3BhY2UKCXdoaXRlc3BhY2UgPSAiW1xceDIwXFx0XFxyXFxuXFxmXSIsCgkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXN5bnRheC8jY2hhcmFjdGVycwoJY2hhcmFjdGVyRW5jb2RpbmcgPSAiKD86XFxcXC58W1xcdy1dfFteXFx4MDAtXFx4YTBdKSsiLAoKCS8vIExvb3NlbHkgbW9kZWxlZCBvbiBDU1MgaWRlbnRpZmllciBjaGFyYWN0ZXJzCgkvLyBBbiB1bnF1b3RlZCB2YWx1ZSBzaG91bGQgYmUgYSBDU1MgaWRlbnRpZmllciBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jYXR0cmlidXRlLXNlbGVjdG9ycwoJLy8gUHJvcGVyIHN5bnRheDogaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI3ZhbHVlLWRlZi1pZGVudGlmaWVyCglpZGVudGlmaWVyID0gY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggInciLCAidyMiICksCgoJLy8gQWNjZXB0YWJsZSBvcGVyYXRvcnMgaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNhdHRyaWJ1dGUtc2VsZWN0b3JzCglvcGVyYXRvcnMgPSAiKFsqXiR8IX5dPz0pIiwKCWF0dHJpYnV0ZXMgPSAiXFxbIiArIHdoaXRlc3BhY2UgKyAiKigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKyB3aGl0ZXNwYWNlICsKCQkiKig/OiIgKyBvcGVyYXRvcnMgKyB3aGl0ZXNwYWNlICsgIiooPzooWydcIl0pKCg/OlxcXFwufFteXFxcXF0pKj8pXFwzfCgiICsgaWRlbnRpZmllciArICIpfCl8KSIgKyB3aGl0ZXNwYWNlICsgIipcXF0iLAoKCS8vIFByZWZlciBhcmd1bWVudHMgcXVvdGVkLAoJLy8gICB0aGVuIG5vdCBjb250YWluaW5nIHBzZXVkb3MvYnJhY2tldHMsCgkvLyAgIHRoZW4gYXR0cmlidXRlIHNlbGVjdG9ycy9ub24tcGFyZW50aGV0aWNhbCBleHByZXNzaW9ucywKCS8vICAgdGhlbiBhbnl0aGluZyBlbHNlCgkvLyBUaGVzZSBwcmVmZXJlbmNlcyBhcmUgaGVyZSB0byByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMKCS8vICAgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgUFNFVURPIHByZUZpbHRlcgoJcHNldWRvcyA9ICI6KCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpKD86XFwoKChbJ1wiXSkoKD86XFxcXC58W15cXFxcXSkqPylcXDN8KCg/OlxcXFwufFteXFxcXCgpW1xcXV18IiArIGF0dHJpYnV0ZXMucmVwbGFjZSggMywgOCApICsgIikqKXwuKilcXCl8KSIsCgoJLy8gTGVhZGluZyBhbmQgbm9uLWVzY2FwZWQgdHJhaWxpbmcgd2hpdGVzcGFjZSwgY2FwdHVyaW5nIHNvbWUgbm9uLXdoaXRlc3BhY2UgY2hhcmFjdGVycyBwcmVjZWRpbmcgdGhlIGxhdHRlcgoJcnRyaW0gPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIit8KCg/Ol58W15cXFxcXSkoPzpcXFxcLikqKSIgKyB3aGl0ZXNwYWNlICsgIiskIiwgImciICksCgoJcmNvbW1hID0gbmV3IFJlZ0V4cCggIl4iICsgd2hpdGVzcGFjZSArICIqLCIgKyB3aGl0ZXNwYWNlICsgIioiICksCglyY29tYmluYXRvcnMgPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIiooW1xceDIwXFx0XFxyXFxuXFxmPit+XSkiICsgd2hpdGVzcGFjZSArICIqIiApLAoJcnBzZXVkbyA9IG5ldyBSZWdFeHAoIHBzZXVkb3MgKSwKCXJpZGVudGlmaWVyID0gbmV3IFJlZ0V4cCggIl4iICsgaWRlbnRpZmllciArICIkIiApLAoKCW1hdGNoRXhwciA9IHsKCQkiSUQiOiBuZXcgUmVnRXhwKCAiXiMoIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiICksCgkJIkNMQVNTIjogbmV3IFJlZ0V4cCggIl5cXC4oIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiICksCgkJIk5BTUUiOiBuZXcgUmVnRXhwKCAiXlxcW25hbWU9WydcIl0/KCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpWydcIl0/XFxdIiApLAoJCSJUQUciOiBuZXcgUmVnRXhwKCAiXigiICsgY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggInciLCAidyoiICkgKyAiKSIgKSwKCQkiQVRUUiI6IG5ldyBSZWdFeHAoICJeIiArIGF0dHJpYnV0ZXMgKSwKCQkiUFNFVURPIjogbmV3IFJlZ0V4cCggIl4iICsgcHNldWRvcyApLAoJCSJDSElMRCI6IG5ldyBSZWdFeHAoICJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXCgiICsgd2hpdGVzcGFjZSArCgkJCSIqKGV2ZW58b2RkfCgoWystXXwpKFxcZCopbnwpIiArIHdoaXRlc3BhY2UgKyAiKig/OihbKy1dfCkiICsgd2hpdGVzcGFjZSArCgkJCSIqKFxcZCspfCkpIiArIHdoaXRlc3BhY2UgKyAiKlxcKXwpIiwgImkiICksCgkJLy8gRm9yIHVzZSBpbiBsaWJyYXJpZXMgaW1wbGVtZW50aW5nIC5pcygpCgkJLy8gV2UgdXNlIHRoaXMgZm9yIFBPUyBtYXRjaGluZyBpbiBgc2VsZWN0YAoJCSJuZWVkc0NvbnRleHQiOiBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIgKwoJCQl3aGl0ZXNwYWNlICsgIiooKD86LVxcZCk/XFxkKikiICsgd2hpdGVzcGFjZSArICIqXFwpfCkoPz1bXi1dfCQpIiwgImkiICkKCX0sCgoJcnNpYmxpbmcgPSAvW1x4MjBcdFxyXG5cZl0qWyt+XS8sCgoJcm5hdGl2ZSA9IC9eW157XStce1xzKlxbbmF0aXZlIGNvZGUvLAoKCS8vIEVhc2lseS1wYXJzZWFibGUvcmV0cmlldmFibGUgSUQgb3IgVEFHIG9yIENMQVNTIHNlbGVjdG9ycwoJcnF1aWNrRXhwciA9IC9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sCgoJcmlucHV0cyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksCglyaGVhZGVyID0gL15oXGQkL2ksCgoJcmVzY2FwZSA9IC8nfFxcL2csCglyYXR0cmlidXRlUXVvdGVzID0gL1w9W1x4MjBcdFxyXG5cZl0qKFteJyJcXV0qKVtceDIwXHRcclxuXGZdKlxdL2csCgoJLy8gQ1NTIGVzY2FwZXMgaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI2VzY2FwZWQtY2hhcmFjdGVycwoJcnVuZXNjYXBlID0gL1xcKFtcZGEtZkEtRl17MSw2fVtceDIwXHRcclxuXGZdP3wuKS9nLAoJZnVuZXNjYXBlID0gZnVuY3Rpb24oIF8sIGVzY2FwZWQgKSB7CgkJdmFyIGhpZ2ggPSAiMHgiICsgZXNjYXBlZCAtIDB4MTAwMDA7CgkJLy8gTmFOIG1lYW5zIG5vbi1jb2RlcG9pbnQKCQlyZXR1cm4gaGlnaCAhPT0gaGlnaCA/CgkJCWVzY2FwZWQgOgoJCQkvLyBCTVAgY29kZXBvaW50CgkJCWhpZ2ggPCAwID8KCQkJCVN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggKyAweDEwMDAwICkgOgoJCQkJLy8gU3VwcGxlbWVudGFsIFBsYW5lIGNvZGVwb2ludCAoc3Vycm9nYXRlIHBhaXIpCgkJCQlTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoID4+IDEwIHwgMHhEODAwLCBoaWdoICYgMHgzRkYgfCAweERDMDAgKTsKCX07CgovLyBVc2UgYSBzdHJpcHBlZC1kb3duIHNsaWNlIGlmIHdlIGNhbid0IHVzZSBhIG5hdGl2ZSBvbmUKdHJ5IHsKCXNsaWNlLmNhbGwoIHByZWZlcnJlZERvYy5kb2N1bWVudEVsZW1lbnQuY2hpbGROb2RlcywgMCApWzBdLm5vZGVUeXBlOwp9IGNhdGNoICggZSApIHsKCXNsaWNlID0gZnVuY3Rpb24oIGkgKSB7CgkJdmFyIGVsZW0sCgkJCXJlc3VsdHMgPSBbXTsKCQl3aGlsZSAoIChlbGVtID0gdGhpc1tpKytdKSApIHsKCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJfQoJCXJldHVybiByZXN1bHRzOwoJfTsKfQoKLyoqCiAqIEZvciBmZWF0dXJlIGRldGVjdGlvbgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gdGVzdCBmb3IgbmF0aXZlIHN1cHBvcnQKICovCmZ1bmN0aW9uIGlzTmF0aXZlKCBmbiApIHsKCXJldHVybiBybmF0aXZlLnRlc3QoIGZuICsgIiIgKTsKfQoKLyoqCiAqIENyZWF0ZSBrZXktdmFsdWUgY2FjaGVzIG9mIGxpbWl0ZWQgc2l6ZQogKiBAcmV0dXJucyB7RnVuY3Rpb24oc3RyaW5nLCBPYmplY3QpfSBSZXR1cm5zIHRoZSBPYmplY3QgZGF0YSBhZnRlciBzdG9yaW5nIGl0IG9uIGl0c2VsZiB3aXRoCiAqCXByb3BlcnR5IG5hbWUgdGhlIChzcGFjZS1zdWZmaXhlZCkgc3RyaW5nIGFuZCAoaWYgdGhlIGNhY2hlIGlzIGxhcmdlciB0aGFuIEV4cHIuY2FjaGVMZW5ndGgpCiAqCWRlbGV0aW5nIHRoZSBvbGRlc3QgZW50cnkKICovCmZ1bmN0aW9uIGNyZWF0ZUNhY2hlKCkgewoJdmFyIGNhY2hlLAoJCWtleXMgPSBbXTsKCglyZXR1cm4gKGNhY2hlID0gZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJLy8gVXNlIChrZXkgKyAiICIpIHRvIGF2b2lkIGNvbGxpc2lvbiB3aXRoIG5hdGl2ZSBwcm90b3R5cGUgcHJvcGVydGllcyAoc2VlIElzc3VlICMxNTcpCgkJaWYgKCBrZXlzLnB1c2goIGtleSArPSAiICIgKSA+IEV4cHIuY2FjaGVMZW5ndGggKSB7CgkJCS8vIE9ubHkga2VlcCB0aGUgbW9zdCByZWNlbnQgZW50cmllcwoJCQlkZWxldGUgY2FjaGVbIGtleXMuc2hpZnQoKSBdOwoJCX0KCQlyZXR1cm4gKGNhY2hlWyBrZXkgXSA9IHZhbHVlKTsKCX0pOwp9CgovKioKICogTWFyayBhIGZ1bmN0aW9uIGZvciBzcGVjaWFsIHVzZSBieSBTaXp6bGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGZ1bmN0aW9uIHRvIG1hcmsKICovCmZ1bmN0aW9uIG1hcmtGdW5jdGlvbiggZm4gKSB7CglmblsgZXhwYW5kbyBdID0gdHJ1ZTsKCXJldHVybiBmbjsKfQoKLyoqCiAqIFN1cHBvcnQgdGVzdGluZyB1c2luZyBhbiBlbGVtZW50CiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFBhc3NlZCB0aGUgY3JlYXRlZCBkaXYgYW5kIGV4cGVjdHMgYSBib29sZWFuIHJlc3VsdAogKi8KZnVuY3Rpb24gYXNzZXJ0KCBmbiApIHsKCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCgl0cnkgewoJCXJldHVybiBmbiggZGl2ICk7Cgl9IGNhdGNoIChlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfSBmaW5hbGx5IHsKCQkvLyByZWxlYXNlIG1lbW9yeSBpbiBJRQoJCWRpdiA9IG51bGw7Cgl9Cn0KCmZ1bmN0aW9uIFNpenpsZSggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7Cgl2YXIgbWF0Y2gsIGVsZW0sIG0sIG5vZGVUeXBlLAoJCS8vIFFTQSB2YXJzCgkJaSwgZ3JvdXBzLCBvbGQsIG5pZCwgbmV3Q29udGV4dCwgbmV3U2VsZWN0b3I7CgoJaWYgKCAoIGNvbnRleHQgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IHByZWZlcnJlZERvYyApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJfQoKCWNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50OwoJcmVzdWx0cyA9IHJlc3VsdHMgfHwgW107CgoJaWYgKCAhc2VsZWN0b3IgfHwgdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQlyZXR1cm4gcmVzdWx0czsKCX0KCglpZiAoIChub2RlVHlwZSA9IGNvbnRleHQubm9kZVR5cGUpICE9PSAxICYmIG5vZGVUeXBlICE9PSA5ICkgewoJCXJldHVybiBbXTsKCX0KCglpZiAoICFkb2N1bWVudElzWE1MICYmICFzZWVkICkgewoKCQkvLyBTaG9ydGN1dHMKCQlpZiAoIChtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyggc2VsZWN0b3IgKSkgKSB7CgkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoIiNJRCIpCgkJCWlmICggKG0gPSBtYXRjaFsxXSkgKSB7CgkJCQlpZiAoIG5vZGVUeXBlID09PSA5ICkgewoJCQkJCWVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBtICk7CgkJCQkJLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnMKCQkJCQkvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzCgkJCQkJaWYgKCBlbGVtICYmIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCQkJLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIElFLCBPcGVyYSwgYW5kIFdlYmtpdCByZXR1cm4gaXRlbXMKCQkJCQkJLy8gYnkgbmFtZSBpbnN0ZWFkIG9mIElECgkJCQkJCWlmICggZWxlbS5pZCA9PT0gbSApIHsKCQkJCQkJCXJlc3VsdHMucHVzaCggZWxlbSApOwoJCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJCX0KCQkJCQl9IGVsc2UgewoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCS8vIENvbnRleHQgaXMgbm90IGEgZG9jdW1lbnQKCQkJCQlpZiAoIGNvbnRleHQub3duZXJEb2N1bWVudCAmJiAoZWxlbSA9IGNvbnRleHQub3duZXJEb2N1bWVudC5nZXRFbGVtZW50QnlJZCggbSApKSAmJgoJCQkJCQljb250YWlucyggY29udGV4dCwgZWxlbSApICYmIGVsZW0uaWQgPT09IG0gKSB7CgkJCQkJCXJlc3VsdHMucHVzaCggZWxlbSApOwoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgkJCQl9CgoJCQkvLyBTcGVlZC11cDogU2l6emxlKCJUQUciKQoJCQl9IGVsc2UgaWYgKCBtYXRjaFsyXSApIHsKCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIHNsaWNlLmNhbGwoY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggc2VsZWN0b3IgKSwgMCkgKTsKCQkJCXJldHVybiByZXN1bHRzOwoKCQkJLy8gU3BlZWQtdXA6IFNpenpsZSgiLkNMQVNTIikKCQkJfSBlbHNlIGlmICggKG0gPSBtYXRjaFszXSkgJiYgc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSAmJiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSB7CgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzbGljZS5jYWxsKGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggbSApLCAwKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCX0KCQl9CgoJCS8vIFFTQSBwYXRoCgkJaWYgKCBzdXBwb3J0LnFzYSAmJiAhcmJ1Z2d5UVNBLnRlc3Qoc2VsZWN0b3IpICkgewoJCQlvbGQgPSB0cnVlOwoJCQluaWQgPSBleHBhbmRvOwoJCQluZXdDb250ZXh0ID0gY29udGV4dDsKCQkJbmV3U2VsZWN0b3IgPSBub2RlVHlwZSA9PT0gOSAmJiBzZWxlY3RvcjsKCgkJCS8vIHFTQSB3b3JrcyBzdHJhbmdlbHkgb24gRWxlbWVudC1yb290ZWQgcXVlcmllcwoJCQkvLyBXZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBzcGVjaWZ5aW5nIGFuIGV4dHJhIElEIG9uIHRoZSByb290CgkJCS8vIGFuZCB3b3JraW5nIHVwIGZyb20gdGhlcmUgKFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGUgdGVjaG5pcXVlKQoJCQkvLyBJRSA4IGRvZXNuJ3Qgd29yayBvbiBvYmplY3QgZWxlbWVudHMKCQkJaWYgKCBub2RlVHlwZSA9PT0gMSAmJiBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiICkgewoJCQkJZ3JvdXBzID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJCQkJaWYgKCAob2xkID0gY29udGV4dC5nZXRBdHRyaWJ1dGUoImlkIikpICkgewoJCQkJCW5pZCA9IG9sZC5yZXBsYWNlKCByZXNjYXBlLCAiXFwkJiIgKTsKCQkJCX0gZWxzZSB7CgkJCQkJY29udGV4dC5zZXRBdHRyaWJ1dGUoICJpZCIsIG5pZCApOwoJCQkJfQoJCQkJbmlkID0gIltpZD0nIiArIG5pZCArICInXSAiOwoKCQkJCWkgPSBncm91cHMubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJZ3JvdXBzW2ldID0gbmlkICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7CgkJCQl9CgkJCQluZXdDb250ZXh0ID0gcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiBjb250ZXh0LnBhcmVudE5vZGUgfHwgY29udGV4dDsKCQkJCW5ld1NlbGVjdG9yID0gZ3JvdXBzLmpvaW4oIiwiKTsKCQkJfQoKCQkJaWYgKCBuZXdTZWxlY3RvciApIHsKCQkJCXRyeSB7CgkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2xpY2UuY2FsbCggbmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKAoJCQkJCQluZXdTZWxlY3RvcgoJCQkJCSksIDAgKSApOwoJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJfSBjYXRjaChxc2FFcnJvcikgewoJCQkJfSBmaW5hbGx5IHsKCQkJCQlpZiAoICFvbGQgKSB7CgkJCQkJCWNvbnRleHQucmVtb3ZlQXR0cmlidXRlKCJpZCIpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBBbGwgb3RoZXJzCglyZXR1cm4gc2VsZWN0KCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICk7Cn0KCi8qKgogKiBEZXRlY3QgeG1sCiAqIEBwYXJhbSB7RWxlbWVudHxPYmplY3R9IGVsZW0gQW4gZWxlbWVudCBvciBhIGRvY3VtZW50CiAqLwppc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJLy8gZG9jdW1lbnRFbGVtZW50IGlzIHZlcmlmaWVkIGZvciBjYXNlcyB3aGVyZSBpdCBkb2Vzbid0IHlldCBleGlzdAoJLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCgl2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDsKCXJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09ICJIVE1MIiA6IGZhbHNlOwp9OwoKLyoqCiAqIFNldHMgZG9jdW1lbnQtcmVsYXRlZCB2YXJpYWJsZXMgb25jZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkb2N1bWVudAogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjdXJyZW50IGRvY3VtZW50CiAqLwpzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkgewoJdmFyIGRvYyA9IG5vZGUgPyBub2RlLm93bmVyRG9jdW1lbnQgfHwgbm9kZSA6IHByZWZlcnJlZERvYzsKCgkvLyBJZiBubyBkb2N1bWVudCBhbmQgZG9jdW1lbnRFbGVtZW50IGlzIGF2YWlsYWJsZSwgcmV0dXJuCglpZiAoIGRvYyA9PT0gZG9jdW1lbnQgfHwgZG9jLm5vZGVUeXBlICE9PSA5IHx8ICFkb2MuZG9jdW1lbnRFbGVtZW50ICkgewoJCXJldHVybiBkb2N1bWVudDsKCX0KCgkvLyBTZXQgb3VyIGRvY3VtZW50Cglkb2N1bWVudCA9IGRvYzsKCWRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50OwoKCS8vIFN1cHBvcnQgdGVzdHMKCWRvY3VtZW50SXNYTUwgPSBpc1hNTCggZG9jICk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSByZXR1cm5zIG9ubHkgZWxlbWVudHMKCXN1cHBvcnQudGFnTmFtZU5vQ29tbWVudHMgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuYXBwZW5kQ2hpbGQoIGRvYy5jcmVhdGVDb21tZW50KCIiKSApOwoJCXJldHVybiAhZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikubGVuZ3RoOwoJfSk7CgoJLy8gQ2hlY2sgaWYgYXR0cmlidXRlcyBzaG91bGQgYmUgcmV0cmlldmVkIGJ5IGF0dHJpYnV0ZSBub2RlcwoJc3VwcG9ydC5hdHRyaWJ1dGVzID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmlubmVySFRNTCA9ICI8c2VsZWN0Pjwvc2VsZWN0PiI7CgkJdmFyIHR5cGUgPSB0eXBlb2YgZGl2Lmxhc3RDaGlsZC5nZXRBdHRyaWJ1dGUoIm11bHRpcGxlIik7CgkJLy8gSUU4IHJldHVybnMgYSBzdHJpbmcgZm9yIHNvbWUgYXR0cmlidXRlcyBldmVuIHdoZW4gbm90IHByZXNlbnQKCQlyZXR1cm4gdHlwZSAhPT0gImJvb2xlYW4iICYmIHR5cGUgIT09ICJzdHJpbmciOwoJfSk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSBjYW4gYmUgdHJ1c3RlZAoJc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCS8vIE9wZXJhIGNhbid0IGZpbmQgYSBzZWNvbmQgY2xhc3NuYW1lIChpbiA5LjYpCgkJZGl2LmlubmVySFRNTCA9ICI8ZGl2IGNsYXNzPSdoaWRkZW4gZSc+PC9kaXY+PGRpdiBjbGFzcz0naGlkZGVuJz48L2Rpdj4iOwoJCWlmICggIWRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lIHx8ICFkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aCApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gU2FmYXJpIDMuMiBjYWNoZXMgY2xhc3MgYXR0cmlidXRlcyBhbmQgZG9lc24ndCBjYXRjaCBjaGFuZ2VzCgkJZGl2Lmxhc3RDaGlsZC5jbGFzc05hbWUgPSAiZSI7CgkJcmV0dXJuIGRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoID09PSAyOwoJfSk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudEJ5SWQgcmV0dXJucyBlbGVtZW50cyBieSBuYW1lCgkvLyBDaGVjayBpZiBnZXRFbGVtZW50c0J5TmFtZSBwcml2aWxlZ2VzIGZvcm0gY29udHJvbHMgb3IgcmV0dXJucyBlbGVtZW50cyBieSBJRAoJc3VwcG9ydC5nZXRCeU5hbWUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkvLyBJbmplY3QgY29udGVudAoJCWRpdi5pZCA9IGV4cGFuZG8gKyAwOwoJCWRpdi5pbm5lckhUTUwgPSAiPGEgbmFtZT0nIiArIGV4cGFuZG8gKyAiJz48L2E+PGRpdiBuYW1lPSciICsgZXhwYW5kbyArICInPjwvZGl2PiI7CgkJZG9jRWxlbS5pbnNlcnRCZWZvcmUoIGRpdiwgZG9jRWxlbS5maXJzdENoaWxkICk7CgoJCS8vIFRlc3QKCQl2YXIgcGFzcyA9IGRvYy5nZXRFbGVtZW50c0J5TmFtZSAmJgoJCQkvLyBidWdneSBicm93c2VycyB3aWxsIHJldHVybiBmZXdlciB0aGFuIHRoZSBjb3JyZWN0IDIKCQkJZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICkubGVuZ3RoID09PSAyICsKCQkJLy8gYnVnZ3kgYnJvd3NlcnMgd2lsbCByZXR1cm4gbW9yZSB0aGFuIHRoZSBjb3JyZWN0IDAKCQkJZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICsgMCApLmxlbmd0aDsKCQlzdXBwb3J0LmdldElkTm90TmFtZSA9ICFkb2MuZ2V0RWxlbWVudEJ5SWQoIGV4cGFuZG8gKTsKCgkJLy8gQ2xlYW51cAoJCWRvY0VsZW0ucmVtb3ZlQ2hpbGQoIGRpdiApOwoKCQlyZXR1cm4gcGFzczsKCX0pOwoKCS8vIElFNi83IHJldHVybiBtb2RpZmllZCBhdHRyaWJ1dGVzCglFeHByLmF0dHJIYW5kbGUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iOwoJCXJldHVybiBkaXYuZmlyc3RDaGlsZCAmJiB0eXBlb2YgZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlICE9PSBzdHJ1bmRlZmluZWQgJiYKCQkJZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIikgPT09ICIjIjsKCX0pID8KCQl7fSA6CgkJewoJCQkiaHJlZiI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCAiaHJlZiIsIDIgKTsKCQkJfSwKCQkJInR5cGUiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpOwoJCQl9CgkJfTsKCgkvLyBJRCBmaW5kIGFuZCBmaWx0ZXIKCWlmICggc3VwcG9ydC5nZXRJZE5vdE5hbWUgKSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIGlkICk7CgkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJLy8gbm9kZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBkb2N1bWVudCAjNjk2MwoJCQkJcmV0dXJuIG0gJiYgbS5wYXJlbnROb2RlID8gW21dIDogW107CgkJCX0KCQl9OwoJCUV4cHIuZmlsdGVyWyJJRCJdID0gZnVuY3Rpb24oIGlkICkgewoJCQl2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCJpZCIpID09PSBhdHRySWQ7CgkJCX07CgkJfTsKCX0gZWxzZSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIGlkICk7CgoJCQkJcmV0dXJuIG0gPwoJCQkJCW0uaWQgPT09IGlkIHx8IHR5cGVvZiBtLmdldEF0dHJpYnV0ZU5vZGUgIT09IHN0cnVuZGVmaW5lZCAmJiBtLmdldEF0dHJpYnV0ZU5vZGUoImlkIikudmFsdWUgPT09IGlkID8KCQkJCQkJW21dIDoKCQkJCQkJdW5kZWZpbmVkIDoKCQkJCQlbXTsKCQkJfQoJCX07CgkJRXhwci5maWx0ZXJbIklEIl0gPSAgZnVuY3Rpb24oIGlkICkgewoJCQl2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIG5vZGUgPSB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSBzdHJ1bmRlZmluZWQgJiYgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOwoJCQkJcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9CgoJLy8gVGFnCglFeHByLmZpbmRbIlRBRyJdID0gc3VwcG9ydC50YWdOYW1lTm9Db21tZW50cyA/CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gc3RydW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApOwoJCQl9CgkJfSA6CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJdmFyIGVsZW0sCgkJCQl0bXAgPSBbXSwKCQkJCWkgPSAwLAoJCQkJcmVzdWx0cyA9IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApOwoKCQkJLy8gRmlsdGVyIG91dCBwb3NzaWJsZSBjb21tZW50cwoJCQlpZiAoIHRhZyA9PT0gIioiICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7CgkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQl0bXAucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdG1wOwoJCQl9CgkJCXJldHVybiByZXN1bHRzOwoJCX07CgoJLy8gTmFtZQoJRXhwci5maW5kWyJOQU1FIl0gPSBzdXBwb3J0LmdldEJ5TmFtZSAmJiBmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkgewoJCWlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUgIT09IHN0cnVuZGVmaW5lZCApIHsKCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUoIG5hbWUgKTsKCQl9Cgl9OwoKCS8vIENsYXNzCglFeHByLmZpbmRbIkNMQVNTIl0gPSBzdXBwb3J0LmdldEJ5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKCBjbGFzc05hbWUsIGNvbnRleHQgKSB7CgkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCXJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIGNsYXNzTmFtZSApOwoJCX0KCX07CgoJLy8gUVNBIGFuZCBtYXRjaGVzU2VsZWN0b3Igc3VwcG9ydAoKCS8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCglyYnVnZ3lNYXRjaGVzID0gW107CgoJLy8gcVNhKDpmb2N1cykgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKENocm9tZSAyMSksCgkvLyBubyBuZWVkIHRvIGFsc28gYWRkIHRvIGJ1Z2d5TWF0Y2hlcyBzaW5jZSBtYXRjaGVzIGNoZWNrcyBidWdneVFTQQoJLy8gQSBzdXBwb3J0IHRlc3Qgd291bGQgcmVxdWlyZSB0b28gbXVjaCBjb2RlICh3b3VsZCBpbmNsdWRlIGRvY3VtZW50IHJlYWR5KQoJcmJ1Z2d5UVNBID0gWyAiOmZvY3VzIiBdOwoKCWlmICggKHN1cHBvcnQucXNhID0gaXNOYXRpdmUoZG9jLnF1ZXJ5U2VsZWN0b3JBbGwpKSApIHsKCQkvLyBCdWlsZCBRU0EgcmVnZXgKCQkvLyBSZWdleCBzdHJhdGVneSBhZG9wdGVkIGZyb20gRGllZ28gUGVyaW5pCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIFNlbGVjdCBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIG9uIHB1cnBvc2UKCQkJLy8gVGhpcyBpcyB0byB0ZXN0IElFJ3MgdHJlYXRtZW50IG9mIG5vdCBleHBsaWN0bHkKCQkJLy8gc2V0dGluZyBhIGJvb2xlYW4gY29udGVudCBhdHRyaWJ1dGUsCgkJCS8vIHNpbmNlIGl0cyBwcmVzZW5jZSBzaG91bGQgYmUgZW5vdWdoCgkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CgkJCWRpdi5pbm5lckhUTUwgPSAiPHNlbGVjdD48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PiI7CgoJCQkvLyBJRTggLSBTb21lIGJvb2xlYW4gYXR0cmlidXRlcyBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICJcXFsiICsgd2hpdGVzcGFjZSArICIqKD86Y2hlY2tlZHxkaXNhYmxlZHxpc21hcHxtdWx0aXBsZXxyZWFkb25seXxzZWxlY3RlZHx2YWx1ZSkiICk7CgkJCX0KCgkJCS8vIFdlYmtpdC9PcGVyYSAtIDpjaGVja2VkIHNob3VsZCByZXR1cm4gc2VsZWN0ZWQgb3B0aW9uIGVsZW1lbnRzCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCS8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzCgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCI6Y2hlY2tlZCIpLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCI6Y2hlY2tlZCIpOwoJCQl9CgkJfSk7CgoJCWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoKCQkJLy8gT3BlcmEgMTAtMTIvSUU4IC0gXj0gJD0gKj0gYW5kIGVtcHR5IHZhbHVlcwoJCQkvLyBTaG91bGQgbm90IHNlbGVjdCBhbnl0aGluZwoJCQlkaXYuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPSdoaWRkZW4nIGk9JycvPiI7CgkJCWlmICggZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIltpXj0nJ10iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIlsqXiRdPSIgKyB3aGl0ZXNwYWNlICsgIiooPzpcIlwifCcnKSIgKTsKCQkJfQoKCQkJLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZCkKCQkJLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiICk7CgkJCX0KCgkJCS8vIE9wZXJhIDEwLTExIGRvZXMgbm90IHRocm93IG9uIHBvc3QtY29tbWEgaW52YWxpZCBwc2V1ZG9zCgkJCWRpdi5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4Iik7CgkJCXJidWdneVFTQS5wdXNoKCIsLio6Iik7CgkJfSk7Cgl9CgoJaWYgKCAoc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgPSBpc05hdGl2ZSggKG1hdGNoZXMgPSBkb2NFbGVtLm1hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ubW96TWF0Y2hlc1NlbGVjdG9yIHx8CgkJZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm9NYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKSApKSApIHsKCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIENoZWNrIHRvIHNlZSBpZiBpdCdzIHBvc3NpYmxlIHRvIGRvIG1hdGNoZXNTZWxlY3RvcgoJCQkvLyBvbiBhIGRpc2Nvbm5lY3RlZCBub2RlIChJRSA5KQoJCQlzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoID0gbWF0Y2hlcy5jYWxsKCBkaXYsICJkaXYiICk7CgoJCQkvLyBUaGlzIHNob3VsZCBmYWlsIHdpdGggYW4gZXhjZXB0aW9uCgkJCS8vIEdlY2tvIGRvZXMgbm90IGVycm9yLCByZXR1cm5zIGZhbHNlIGluc3RlYWQKCQkJbWF0Y2hlcy5jYWxsKCBkaXYsICJbcyE9JyddOngiICk7CgkJCXJidWdneU1hdGNoZXMucHVzaCggIiE9IiwgcHNldWRvcyApOwoJCX0pOwoJfQoKCXJidWdneVFTQSA9IG5ldyBSZWdFeHAoIHJidWdneVFTQS5qb2luKCJ8IikgKTsKCXJidWdneU1hdGNoZXMgPSBuZXcgUmVnRXhwKCByYnVnZ3lNYXRjaGVzLmpvaW4oInwiKSApOwoKCS8vIEVsZW1lbnQgY29udGFpbnMgYW5vdGhlcgoJLy8gUHVycG9zZWZ1bGx5IGRvZXMgbm90IGltcGxlbWVudCBpbmNsdXNpdmUgZGVzY2VuZGVudAoJLy8gQXMgaW4sIGFuIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBpdHNlbGYKCWNvbnRhaW5zID0gaXNOYXRpdmUoZG9jRWxlbS5jb250YWlucykgfHwgZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCXZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCgkJCQlidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKCQkJcmV0dXJuIGEgPT09IGJ1cCB8fCAhISggYnVwICYmIGJ1cC5ub2RlVHlwZSA9PT0gMSAmJiAoCgkJCQlhZG93bi5jb250YWlucyA/CgkJCQkJYWRvd24uY29udGFpbnMoIGJ1cCApIDoKCQkJCQlhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTYKCQkJKSk7CgkJfSA6CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYiApIHsKCQkJCXdoaWxlICggKGIgPSBiLnBhcmVudE5vZGUpICkgewoJCQkJCWlmICggYiA9PT0gYSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoKCS8vIERvY3VtZW50IG9yZGVyIHNvcnRpbmcKCXNvcnRPcmRlciA9IGRvY0VsZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24gPwoJZnVuY3Rpb24oIGEsIGIgKSB7CgkJdmFyIGNvbXBhcmU7CgoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQlpZiAoIChjb21wYXJlID0gYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGIgKSkgKSB7CgkJCWlmICggY29tcGFyZSAmIDEgfHwgYS5wYXJlbnROb2RlICYmIGEucGFyZW50Tm9kZS5ub2RlVHlwZSA9PT0gMTEgKSB7CgkJCQlpZiAoIGEgPT09IGRvYyB8fCBjb250YWlucyggcHJlZmVycmVkRG9jLCBhICkgKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfQoJCQkJaWYgKCBiID09PSBkb2MgfHwgY29udGFpbnMoIHByZWZlcnJlZERvYywgYiApICkgewoJCQkJCXJldHVybiAxOwoJCQkJfQoJCQkJcmV0dXJuIDA7CgkJCX0KCQkJcmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxOwoJCX0KCgkJcmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPyAtMSA6IDE7Cgl9IDoKCWZ1bmN0aW9uKCBhLCBiICkgewoJCXZhciBjdXIsCgkJCWkgPSAwLAoJCQlhdXAgPSBhLnBhcmVudE5vZGUsCgkJCWJ1cCA9IGIucGFyZW50Tm9kZSwKCQkJYXAgPSBbIGEgXSwKCQkJYnAgPSBbIGIgXTsKCgkJLy8gRXhpdCBlYXJseSBpZiB0aGUgbm9kZXMgYXJlIGlkZW50aWNhbAoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgoJCS8vIFBhcmVudGxlc3Mgbm9kZXMgYXJlIGVpdGhlciBkb2N1bWVudHMgb3IgZGlzY29ubmVjdGVkCgkJfSBlbHNlIGlmICggIWF1cCB8fCAhYnVwICkgewoJCQlyZXR1cm4gYSA9PT0gZG9jID8gLTEgOgoJCQkJYiA9PT0gZG9jID8gMSA6CgkJCQlhdXAgPyAtMSA6CgkJCQlidXAgPyAxIDoKCQkJCTA7CgoJCS8vIElmIHRoZSBub2RlcyBhcmUgc2libGluZ3MsIHdlIGNhbiBkbyBhIHF1aWNrIGNoZWNrCgkJfSBlbHNlIGlmICggYXVwID09PSBidXAgKSB7CgkJCXJldHVybiBzaWJsaW5nQ2hlY2soIGEsIGIgKTsKCQl9CgoJCS8vIE90aGVyd2lzZSB3ZSBuZWVkIGZ1bGwgbGlzdHMgb2YgdGhlaXIgYW5jZXN0b3JzIGZvciBjb21wYXJpc29uCgkJY3VyID0gYTsKCQl3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7CgkJCWFwLnVuc2hpZnQoIGN1ciApOwoJCX0KCQljdXIgPSBiOwoJCXdoaWxlICggKGN1ciA9IGN1ci5wYXJlbnROb2RlKSApIHsKCQkJYnAudW5zaGlmdCggY3VyICk7CgkJfQoKCQkvLyBXYWxrIGRvd24gdGhlIHRyZWUgbG9va2luZyBmb3IgYSBkaXNjcmVwYW5jeQoJCXdoaWxlICggYXBbaV0gPT09IGJwW2ldICkgewoJCQlpKys7CgkJfQoKCQlyZXR1cm4gaSA/CgkJCS8vIERvIGEgc2libGluZyBjaGVjayBpZiB0aGUgbm9kZXMgaGF2ZSBhIGNvbW1vbiBhbmNlc3RvcgoJCQlzaWJsaW5nQ2hlY2soIGFwW2ldLCBicFtpXSApIDoKCgkJCS8vIE90aGVyd2lzZSBub2RlcyBpbiBvdXIgZG9jdW1lbnQgc29ydCBmaXJzdAoJCQlhcFtpXSA9PT0gcHJlZmVycmVkRG9jID8gLTEgOgoJCQlicFtpXSA9PT0gcHJlZmVycmVkRG9jID8gMSA6CgkJCTA7Cgl9OwoKCS8vIEFsd2F5cyBhc3N1bWUgdGhlIHByZXNlbmNlIG9mIGR1cGxpY2F0ZXMgaWYgc29ydCBkb2Vzbid0CgkvLyBwYXNzIHRoZW0gdG8gb3VyIGNvbXBhcmlzb24gZnVuY3Rpb24gKGFzIGluIEdvb2dsZSBDaHJvbWUpLgoJaGFzRHVwbGljYXRlID0gZmFsc2U7CglbMCwgMF0uc29ydCggc29ydE9yZGVyICk7CglzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXMgPSBoYXNEdXBsaWNhdGU7CgoJcmV0dXJuIGRvY3VtZW50Owp9OwoKU2l6emxlLm1hdGNoZXMgPSBmdW5jdGlvbiggZXhwciwgZWxlbWVudHMgKSB7CglyZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBlbGVtZW50cyApOwp9OwoKU2l6emxlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKCBlbGVtLCBleHByICkgewoJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCglpZiAoICggZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0gKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGVsZW0gKTsKCX0KCgkvLyBNYWtlIHN1cmUgdGhhdCBhdHRyaWJ1dGUgc2VsZWN0b3JzIGFyZSBxdW90ZWQKCWV4cHIgPSBleHByLnJlcGxhY2UoIHJhdHRyaWJ1dGVRdW90ZXMsICI9JyQxJ10iICk7CgoJLy8gcmJ1Z2d5UVNBIGFsd2F5cyBjb250YWlucyA6Zm9jdXMsIHNvIG5vIG5lZWQgZm9yIGFuIGV4aXN0ZW5jZSBjaGVjawoJaWYgKCBzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciAmJiAhZG9jdW1lbnRJc1hNTCAmJiAoIXJidWdneU1hdGNoZXMgfHwgIXJidWdneU1hdGNoZXMudGVzdChleHByKSkgJiYgIXJidWdneVFTQS50ZXN0KGV4cHIpICkgewoJCXRyeSB7CgkJCXZhciByZXQgPSBtYXRjaGVzLmNhbGwoIGVsZW0sIGV4cHIgKTsKCgkJCS8vIElFIDkncyBtYXRjaGVzU2VsZWN0b3IgcmV0dXJucyBmYWxzZSBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKCQkJaWYgKCByZXQgfHwgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCB8fAoJCQkJCS8vIEFzIHdlbGwsIGRpc2Nvbm5lY3RlZCBub2RlcyBhcmUgc2FpZCB0byBiZSBpbiBhIGRvY3VtZW50CgkJCQkJLy8gZnJhZ21lbnQgaW4gSUUgOQoJCQkJCWVsZW0uZG9jdW1lbnQgJiYgZWxlbS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgkJfSBjYXRjaChlKSB7fQoJfQoKCXJldHVybiBTaXp6bGUoIGV4cHIsIGRvY3VtZW50LCBudWxsLCBbZWxlbV0gKS5sZW5ndGggPiAwOwp9OwoKU2l6emxlLmNvbnRhaW5zID0gZnVuY3Rpb24oIGNvbnRleHQsIGVsZW0gKSB7CgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJfQoJcmV0dXJuIGNvbnRhaW5zKCBjb250ZXh0LCBlbGVtICk7Cn07CgpTaXp6bGUuYXR0ciA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJdmFyIHZhbDsKCgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggZWxlbSApOwoJfQoKCWlmICggIWRvY3VtZW50SXNYTUwgKSB7CgkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCX0KCWlmICggKHZhbCA9IEV4cHIuYXR0ckhhbmRsZVsgbmFtZSBdKSApIHsKCQlyZXR1cm4gdmFsKCBlbGVtICk7Cgl9CglpZiAoIGRvY3VtZW50SXNYTUwgfHwgc3VwcG9ydC5hdHRyaWJ1dGVzICkgewoJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApOwoJfQoJcmV0dXJuICggKHZhbCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApKSB8fCBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApICkgJiYgZWxlbVsgbmFtZSBdID09PSB0cnVlID8KCQluYW1lIDoKCQl2YWwgJiYgdmFsLnNwZWNpZmllZCA/IHZhbC52YWx1ZSA6IG51bGw7Cn07CgpTaXp6bGUuZXJyb3IgPSBmdW5jdGlvbiggbXNnICkgewoJdGhyb3cgbmV3IEVycm9yKCAiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIiArIG1zZyApOwp9OwoKLy8gRG9jdW1lbnQgc29ydGluZyBhbmQgcmVtb3ZpbmcgZHVwbGljYXRlcwpTaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkgewoJdmFyIGVsZW0sCgkJZHVwbGljYXRlcyA9IFtdLAoJCWkgPSAxLAoJCWogPSAwOwoKCS8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKCWhhc0R1cGxpY2F0ZSA9ICFzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXM7CglyZXN1bHRzLnNvcnQoIHNvcnRPcmRlciApOwoKCWlmICggaGFzRHVwbGljYXRlICkgewoJCWZvciAoIDsgKGVsZW0gPSByZXN1bHRzW2ldKTsgaSsrICkgewoJCQlpZiAoIGVsZW0gPT09IHJlc3VsdHNbIGkgLSAxIF0gKSB7CgkJCQlqID0gZHVwbGljYXRlcy5wdXNoKCBpICk7CgkJCX0KCQl9CgkJd2hpbGUgKCBqLS0gKSB7CgkJCXJlc3VsdHMuc3BsaWNlKCBkdXBsaWNhdGVzWyBqIF0sIDEgKTsKCQl9Cgl9CgoJcmV0dXJuIHJlc3VsdHM7Cn07CgpmdW5jdGlvbiBzaWJsaW5nQ2hlY2soIGEsIGIgKSB7Cgl2YXIgY3VyID0gYiAmJiBhLAoJCWRpZmYgPSBjdXIgJiYgKCB+Yi5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKSAtICggfmEuc291cmNlSW5kZXggfHwgTUFYX05FR0FUSVZFICk7CgoJLy8gVXNlIElFIHNvdXJjZUluZGV4IGlmIGF2YWlsYWJsZSBvbiBib3RoIG5vZGVzCglpZiAoIGRpZmYgKSB7CgkJcmV0dXJuIGRpZmY7Cgl9CgoJLy8gQ2hlY2sgaWYgYiBmb2xsb3dzIGEKCWlmICggY3VyICkgewoJCXdoaWxlICggKGN1ciA9IGN1ci5uZXh0U2libGluZykgKSB7CgkJCWlmICggY3VyID09PSBiICkgewoJCQkJcmV0dXJuIC0xOwoJCQl9CgkJfQoJfQoKCXJldHVybiBhID8gMSA6IC0xOwp9CgovLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGlucHV0IHR5cGVzCmZ1bmN0aW9uIGNyZWF0ZUlucHV0UHNldWRvKCB0eXBlICkgewoJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCXJldHVybiBuYW1lID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gdHlwZTsKCX07Cn0KCi8vIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgYnV0dG9ucwpmdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7CglyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJcmV0dXJuIChuYW1lID09PSAiaW5wdXQiIHx8IG5hbWUgPT09ICJidXR0b24iKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIHBvc2l0aW9uYWxzCmZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oIGZuICkgewoJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggYXJndW1lbnQgKSB7CgkJYXJndW1lbnQgPSArYXJndW1lbnQ7CgkJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcyApIHsKCQkJdmFyIGosCgkJCQltYXRjaEluZGV4ZXMgPSBmbiggW10sIHNlZWQubGVuZ3RoLCBhcmd1bWVudCApLAoJCQkJaSA9IG1hdGNoSW5kZXhlcy5sZW5ndGg7CgoJCQkvLyBNYXRjaCBlbGVtZW50cyBmb3VuZCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4ZXMKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoIHNlZWRbIChqID0gbWF0Y2hJbmRleGVzW2ldKSBdICkgewoJCQkJCXNlZWRbal0gPSAhKG1hdGNoZXNbal0gPSBzZWVkW2pdKTsKCQkJCX0KCQkJfQoJCX0pOwoJfSk7Cn0KCi8qKgogKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIHRoZSB0ZXh0IHZhbHVlIG9mIGFuIGFycmF5IG9mIERPTSBub2RlcwogKiBAcGFyYW0ge0FycmF5fEVsZW1lbnR9IGVsZW0KICovCmdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJdmFyIG5vZGUsCgkJcmV0ID0gIiIsCgkJaSA9IDAsCgkJbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCWlmICggIW5vZGVUeXBlICkgewoJCS8vIElmIG5vIG5vZGVUeXBlLCB0aGlzIGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5CgkJZm9yICggOyAobm9kZSA9IGVsZW1baV0pOyBpKysgKSB7CgkJCS8vIERvIG5vdCB0cmF2ZXJzZSBjb21tZW50IG5vZGVzCgkJCXJldCArPSBnZXRUZXh0KCBub2RlICk7CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDkgfHwgbm9kZVR5cGUgPT09IDExICkgewoJCS8vIFVzZSB0ZXh0Q29udGVudCBmb3IgZWxlbWVudHMKCQkvLyBpbm5lclRleHQgdXNhZ2UgcmVtb3ZlZCBmb3IgY29uc2lzdGVuY3kgb2YgbmV3IGxpbmVzIChzZWUgIzExMTUzKQoJCWlmICggdHlwZW9mIGVsZW0udGV4dENvbnRlbnQgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gZWxlbS50ZXh0Q29udGVudDsKCQl9IGVsc2UgewoJCQkvLyBUcmF2ZXJzZSBpdHMgY2hpbGRyZW4KCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQlyZXQgKz0gZ2V0VGV4dCggZWxlbSApOwoJCQl9CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQgKSB7CgkJcmV0dXJuIGVsZW0ubm9kZVZhbHVlOwoJfQoJLy8gRG8gbm90IGluY2x1ZGUgY29tbWVudCBvciBwcm9jZXNzaW5nIGluc3RydWN0aW9uIG5vZGVzCgoJcmV0dXJuIHJldDsKfTsKCkV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzID0gewoKCS8vIENhbiBiZSBhZGp1c3RlZCBieSB0aGUgdXNlcgoJY2FjaGVMZW5ndGg6IDUwLAoKCWNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLAoKCW1hdGNoOiBtYXRjaEV4cHIsCgoJZmluZDoge30sCgoJcmVsYXRpdmU6IHsKCQkiPiI6IHsgZGlyOiAicGFyZW50Tm9kZSIsIGZpcnN0OiB0cnVlIH0sCgkJIiAiOiB7IGRpcjogInBhcmVudE5vZGUiIH0sCgkJIisiOiB7IGRpcjogInByZXZpb3VzU2libGluZyIsIGZpcnN0OiB0cnVlIH0sCgkJIn4iOiB7IGRpcjogInByZXZpb3VzU2libGluZyIgfQoJfSwKCglwcmVGaWx0ZXI6IHsKCQkiQVRUUiI6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJbWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApOwoKCQkJLy8gTW92ZSB0aGUgZ2l2ZW4gdmFsdWUgdG8gbWF0Y2hbM10gd2hldGhlciBxdW90ZWQgb3IgdW5xdW90ZWQKCQkJbWF0Y2hbM10gPSAoIG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8ICIiICkucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCWlmICggbWF0Y2hbMl0gPT09ICJ+PSIgKSB7CgkJCQltYXRjaFszXSA9ICIgIiArIG1hdGNoWzNdICsgIiAiOwoJCQl9CgoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDQgKTsKCQl9LAoKCQkiQ0hJTEQiOiBmdW5jdGlvbiggbWF0Y2ggKSB7CgkJCS8qIG1hdGNoZXMgZnJvbSBtYXRjaEV4cHJbIkNISUxEIl0KCQkJCTEgdHlwZSAob25seXxudGh8Li4uKQoJCQkJMiB3aGF0IChjaGlsZHxvZi10eXBlKQoJCQkJMyBhcmd1bWVudCAoZXZlbnxvZGR8XGQqfFxkKm4oWystXVxkKyk/fC4uLikKCQkJCTQgeG4tY29tcG9uZW50IG9mIHhuK3kgYXJndW1lbnQgKFsrLV0/XGQqbnwpCgkJCQk1IHNpZ24gb2YgeG4tY29tcG9uZW50CgkJCQk2IHggb2YgeG4tY29tcG9uZW50CgkJCQk3IHNpZ24gb2YgeS1jb21wb25lbnQKCQkJCTggeSBvZiB5LWNvbXBvbmVudAoJCQkqLwoJCQltYXRjaFsxXSA9IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCk7CgoJCQlpZiAoIG1hdGNoWzFdLnNsaWNlKCAwLCAzICkgPT09ICJudGgiICkgewoJCQkJLy8gbnRoLSogcmVxdWlyZXMgYXJndW1lbnQKCQkJCWlmICggIW1hdGNoWzNdICkgewoJCQkJCVNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTsKCQkJCX0KCgkJCQkvLyBudW1lcmljIHggYW5kIHkgcGFyYW1ldGVycyBmb3IgRXhwci5maWx0ZXIuQ0hJTEQKCQkJCS8vIHJlbWVtYmVyIHRoYXQgZmFsc2UvdHJ1ZSBjYXN0IHJlc3BlY3RpdmVseSB0byAwLzEKCQkJCW1hdGNoWzRdID0gKyggbWF0Y2hbNF0gPyBtYXRjaFs1XSArIChtYXRjaFs2XSB8fCAxKSA6IDIgKiAoIG1hdGNoWzNdID09PSAiZXZlbiIgfHwgbWF0Y2hbM10gPT09ICJvZGQiICkgKTsKCQkJCW1hdGNoWzVdID0gKyggKCBtYXRjaFs3XSArIG1hdGNoWzhdICkgfHwgbWF0Y2hbM10gPT09ICJvZGQiICk7CgoJCQkvLyBvdGhlciB0eXBlcyBwcm9oaWJpdCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggbWF0Y2hbM10gKSB7CgkJCQlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7CgkJCX0KCgkJCXJldHVybiBtYXRjaDsKCQl9LAoKCQkiUFNFVURPIjogZnVuY3Rpb24oIG1hdGNoICkgewoJCQl2YXIgZXhjZXNzLAoJCQkJdW5xdW90ZWQgPSAhbWF0Y2hbNV0gJiYgbWF0Y2hbMl07CgoJCQlpZiAoIG1hdGNoRXhwclsiQ0hJTEQiXS50ZXN0KCBtYXRjaFswXSApICkgewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCgkJCS8vIEFjY2VwdCBxdW90ZWQgYXJndW1lbnRzIGFzLWlzCgkJCWlmICggbWF0Y2hbNF0gKSB7CgkJCQltYXRjaFsyXSA9IG1hdGNoWzRdOwoKCQkJLy8gU3RyaXAgZXhjZXNzIGNoYXJhY3RlcnMgZnJvbSB1bnF1b3RlZCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggdW5xdW90ZWQgJiYgcnBzZXVkby50ZXN0KCB1bnF1b3RlZCApICYmCgkJCQkvLyBHZXQgZXhjZXNzIGZyb20gdG9rZW5pemUgKHJlY3Vyc2l2ZWx5KQoJCQkJKGV4Y2VzcyA9IHRva2VuaXplKCB1bnF1b3RlZCwgdHJ1ZSApKSAmJgoJCQkJLy8gYWR2YW5jZSB0byB0aGUgbmV4dCBjbG9zaW5nIHBhcmVudGhlc2lzCgkJCQkoZXhjZXNzID0gdW5xdW90ZWQuaW5kZXhPZiggIikiLCB1bnF1b3RlZC5sZW5ndGggLSBleGNlc3MgKSAtIHVucXVvdGVkLmxlbmd0aCkgKSB7CgoJCQkJLy8gZXhjZXNzIGlzIGEgbmVnYXRpdmUgaW5kZXgKCQkJCW1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoIDAsIGV4Y2VzcyApOwoJCQkJbWF0Y2hbMl0gPSB1bnF1b3RlZC5zbGljZSggMCwgZXhjZXNzICk7CgkJCX0KCgkJCS8vIFJldHVybiBvbmx5IGNhcHR1cmVzIG5lZWRlZCBieSB0aGUgcHNldWRvIGZpbHRlciBtZXRob2QgKHR5cGUgYW5kIGFyZ3VtZW50KQoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDMgKTsKCQl9Cgl9LAoKCWZpbHRlcjogewoKCQkiVEFHIjogZnVuY3Rpb24oIG5vZGVOYW1lICkgewoJCQlpZiAoIG5vZGVOYW1lID09PSAiKiIgKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9OwoJCQl9CgoJCQlub2RlTmFtZSA9IG5vZGVOYW1lLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBub2RlTmFtZTsKCQkJfTsKCQl9LAoKCQkiQ0xBU1MiOiBmdW5jdGlvbiggY2xhc3NOYW1lICkgewoJCQl2YXIgcGF0dGVybiA9IGNsYXNzQ2FjaGVbIGNsYXNzTmFtZSArICIgIiBdOwoKCQkJcmV0dXJuIHBhdHRlcm4gfHwKCQkJCShwYXR0ZXJuID0gbmV3IFJlZ0V4cCggIihefCIgKyB3aGl0ZXNwYWNlICsgIikiICsgY2xhc3NOYW1lICsgIigiICsgd2hpdGVzcGFjZSArICJ8JCkiICkpICYmCgkJCQljbGFzc0NhY2hlKCBjbGFzc05hbWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCXJldHVybiBwYXR0ZXJuLnRlc3QoIGVsZW0uY2xhc3NOYW1lIHx8ICh0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGUgIT09IHN0cnVuZGVmaW5lZCAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSkgfHwgIiIgKTsKCQkJCX0pOwoJCX0sCgoJCSJBVFRSIjogZnVuY3Rpb24oIG5hbWUsIG9wZXJhdG9yLCBjaGVjayApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJlc3VsdCA9IFNpenpsZS5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkJaWYgKCByZXN1bHQgPT0gbnVsbCApIHsKCQkJCQlyZXR1cm4gb3BlcmF0b3IgPT09ICIhPSI7CgkJCQl9CgkJCQlpZiAoICFvcGVyYXRvciApIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCgkJCQlyZXN1bHQgKz0gIiI7CgoJCQkJcmV0dXJuIG9wZXJhdG9yID09PSAiPSIgPyByZXN1bHQgPT09IGNoZWNrIDoKCQkJCQlvcGVyYXRvciA9PT0gIiE9IiA/IHJlc3VsdCAhPT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAiXj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPT09IDAgOgoJCQkJCW9wZXJhdG9yID09PSAiKj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPiAtMSA6CgkJCQkJb3BlcmF0b3IgPT09ICIkPSIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoIC1jaGVjay5sZW5ndGggKSA9PT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAifj0iID8gKCAiICIgKyByZXN1bHQgKyAiICIgKS5pbmRleE9mKCBjaGVjayApID4gLTEgOgoJCQkJCW9wZXJhdG9yID09PSAifD0iID8gcmVzdWx0ID09PSBjaGVjayB8fCByZXN1bHQuc2xpY2UoIDAsIGNoZWNrLmxlbmd0aCArIDEgKSA9PT0gY2hlY2sgKyAiLSIgOgoJCQkJCWZhbHNlOwoJCQl9OwoJCX0sCgoJCSJDSElMRCI6IGZ1bmN0aW9uKCB0eXBlLCB3aGF0LCBhcmd1bWVudCwgZmlyc3QsIGxhc3QgKSB7CgkJCXZhciBzaW1wbGUgPSB0eXBlLnNsaWNlKCAwLCAzICkgIT09ICJudGgiLAoJCQkJZm9yd2FyZCA9IHR5cGUuc2xpY2UoIC00ICkgIT09ICJsYXN0IiwKCQkJCW9mVHlwZSA9IHdoYXQgPT09ICJvZi10eXBlIjsKCgkJCXJldHVybiBmaXJzdCA9PT0gMSAmJiBsYXN0ID09PSAwID8KCgkJCQkvLyBTaG9ydGN1dCBmb3IgOm50aC0qKG4pCgkJCQlmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gISFlbGVtLnBhcmVudE5vZGU7CgkJCQl9IDoKCgkJCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQkJCXZhciBjYWNoZSwgb3V0ZXJDYWNoZSwgbm9kZSwgZGlmZiwgbm9kZUluZGV4LCBzdGFydCwKCQkJCQkJZGlyID0gc2ltcGxlICE9PSBmb3J3YXJkID8gIm5leHRTaWJsaW5nIiA6ICJwcmV2aW91c1NpYmxpbmciLAoJCQkJCQlwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGUsCgkJCQkJCW5hbWUgPSBvZlR5cGUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAoJCQkJCQl1c2VDYWNoZSA9ICF4bWwgJiYgIW9mVHlwZTsKCgkJCQkJaWYgKCBwYXJlbnQgKSB7CgoJCQkJCQkvLyA6KGZpcnN0fGxhc3R8b25seSktKGNoaWxkfG9mLXR5cGUpCgkJCQkJCWlmICggc2ltcGxlICkgewoJCQkJCQkJd2hpbGUgKCBkaXIgKSB7CgkJCQkJCQkJbm9kZSA9IGVsZW07CgkJCQkJCQkJd2hpbGUgKCAobm9kZSA9IG5vZGVbIGRpciBdKSApIHsKCQkJCQkJCQkJaWYgKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJCS8vIFJldmVyc2UgZGlyZWN0aW9uIGZvciA6b25seS0qIChpZiB3ZSBoYXZlbid0IHlldCBkb25lIHNvKQoJCQkJCQkJCXN0YXJ0ID0gZGlyID0gdHlwZSA9PT0gIm9ubHkiICYmICFzdGFydCAmJiAibmV4dFNpYmxpbmciOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCX0KCgkJCQkJCXN0YXJ0ID0gWyBmb3J3YXJkID8gcGFyZW50LmZpcnN0Q2hpbGQgOiBwYXJlbnQubGFzdENoaWxkIF07CgoJCQkJCQkvLyBub24teG1sIDpudGgtY2hpbGQoLi4uKSBzdG9yZXMgY2FjaGUgZGF0YSBvbiBgcGFyZW50YAoJCQkJCQlpZiAoIGZvcndhcmQgJiYgdXNlQ2FjaGUgKSB7CgkJCQkJCQkvLyBTZWVrIGBlbGVtYCBmcm9tIGEgcHJldmlvdXNseS1jYWNoZWQgaW5kZXgKCQkJCQkJCW91dGVyQ2FjaGUgPSBwYXJlbnRbIGV4cGFuZG8gXSB8fCAocGFyZW50WyBleHBhbmRvIF0gPSB7fSk7CgkJCQkJCQljYWNoZSA9IG91dGVyQ2FjaGVbIHR5cGUgXSB8fCBbXTsKCQkJCQkJCW5vZGVJbmRleCA9IGNhY2hlWzBdID09PSBkaXJydW5zICYmIGNhY2hlWzFdOwoJCQkJCQkJZGlmZiA9IGNhY2hlWzBdID09PSBkaXJydW5zICYmIGNhY2hlWzJdOwoJCQkJCQkJbm9kZSA9IG5vZGVJbmRleCAmJiBwYXJlbnQuY2hpbGROb2Rlc1sgbm9kZUluZGV4IF07CgoJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCgkJCQkJCQkJLy8gRmFsbGJhY2sgdG8gc2Vla2luZyBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKCQkJCQkJCQkoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHsKCgkJCQkJCQkJLy8gV2hlbiBmb3VuZCwgY2FjaGUgaW5kZXhlcyBvbiBgcGFyZW50YCBhbmQgYnJlYWsKCQkJCQkJCQlpZiAoIG5vZGUubm9kZVR5cGUgPT09IDEgJiYgKytkaWZmICYmIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCW91dGVyQ2FjaGVbIHR5cGUgXSA9IFsgZGlycnVucywgbm9kZUluZGV4LCBkaWZmIF07CgkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCX0KCQkJCQkJCX0KCgkJCQkJCS8vIFVzZSBwcmV2aW91c2x5LWNhY2hlZCBlbGVtZW50IGluZGV4IGlmIGF2YWlsYWJsZQoJCQkJCQl9IGVsc2UgaWYgKCB1c2VDYWNoZSAmJiAoY2FjaGUgPSAoZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0pICYmIGNhY2hlWzBdID09PSBkaXJydW5zICkgewoJCQkJCQkJZGlmZiA9IGNhY2hlWzFdOwoKCQkJCQkJLy8geG1sIDpudGgtY2hpbGQoLi4uKSBvciA6bnRoLWxhc3QtY2hpbGQoLi4uKSBvciA6bnRoKC1sYXN0KT8tb2YtdHlwZSguLi4pCgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBVc2UgdGhlIHNhbWUgbG9vcCBhcyBhYm92ZSB0byBzZWVrIGBlbGVtYCBmcm9tIHRoZSBzdGFydAoJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCQkJCQkJCQkoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHsKCgkJCQkJCQkJaWYgKCAoIG9mVHlwZSA/IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZSA6IG5vZGUubm9kZVR5cGUgPT09IDEgKSAmJiArK2RpZmYgKSB7CgkJCQkJCQkJCS8vIENhY2hlIHRoZSBpbmRleCBvZiBlYWNoIGVuY291bnRlcmVkIGVsZW1lbnQKCQkJCQkJCQkJaWYgKCB1c2VDYWNoZSApIHsKCQkJCQkJCQkJCShub2RlWyBleHBhbmRvIF0gfHwgKG5vZGVbIGV4cGFuZG8gXSA9IHt9KSlbIHR5cGUgXSA9IFsgZGlycnVucywgZGlmZiBdOwoJCQkJCQkJCQl9CgoJCQkJCQkJCQlpZiAoIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gSW5jb3Jwb3JhdGUgdGhlIG9mZnNldCwgdGhlbiBjaGVjayBhZ2FpbnN0IGN5Y2xlIHNpemUKCQkJCQkJZGlmZiAtPSBsYXN0OwoJCQkJCQlyZXR1cm4gZGlmZiA9PT0gZmlyc3QgfHwgKCBkaWZmICUgZmlyc3QgPT09IDAgJiYgZGlmZiAvIGZpcnN0ID49IDAgKTsKCQkJCQl9CgkJCQl9OwoJCX0sCgoJCSJQU0VVRE8iOiBmdW5jdGlvbiggcHNldWRvLCBhcmd1bWVudCApIHsKCQkJLy8gcHNldWRvLWNsYXNzIG5hbWVzIGFyZSBjYXNlLWluc2Vuc2l0aXZlCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jcHNldWRvLWNsYXNzZXMKCQkJLy8gUHJpb3JpdGl6ZSBieSBjYXNlIHNlbnNpdGl2aXR5IGluIGNhc2UgY3VzdG9tIHBzZXVkb3MgYXJlIGFkZGVkIHdpdGggdXBwZXJjYXNlIGxldHRlcnMKCQkJLy8gUmVtZW1iZXIgdGhhdCBzZXRGaWx0ZXJzIGluaGVyaXRzIGZyb20gcHNldWRvcwoJCQl2YXIgYXJncywKCQkJCWZuID0gRXhwci5wc2V1ZG9zWyBwc2V1ZG8gXSB8fCBFeHByLnNldEZpbHRlcnNbIHBzZXVkby50b0xvd2VyQ2FzZSgpIF0gfHwKCQkJCQlTaXp6bGUuZXJyb3IoICJ1bnN1cHBvcnRlZCBwc2V1ZG86ICIgKyBwc2V1ZG8gKTsKCgkJCS8vIFRoZSB1c2VyIG1heSB1c2UgY3JlYXRlUHNldWRvIHRvIGluZGljYXRlIHRoYXQKCQkJLy8gYXJndW1lbnRzIGFyZSBuZWVkZWQgdG8gY3JlYXRlIHRoZSBmaWx0ZXIgZnVuY3Rpb24KCQkJLy8ganVzdCBhcyBTaXp6bGUgZG9lcwoJCQlpZiAoIGZuWyBleHBhbmRvIF0gKSB7CgkJCQlyZXR1cm4gZm4oIGFyZ3VtZW50ICk7CgkJCX0KCgkJCS8vIEJ1dCBtYWludGFpbiBzdXBwb3J0IGZvciBvbGQgc2lnbmF0dXJlcwoJCQlpZiAoIGZuLmxlbmd0aCA+IDEgKSB7CgkJCQlhcmdzID0gWyBwc2V1ZG8sIHBzZXVkbywgIiIsIGFyZ3VtZW50IF07CgkJCQlyZXR1cm4gRXhwci5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KCBwc2V1ZG8udG9Mb3dlckNhc2UoKSApID8KCQkJCQltYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMgKSB7CgkJCQkJCXZhciBpZHgsCgkJCQkJCQltYXRjaGVkID0gZm4oIHNlZWQsIGFyZ3VtZW50ICksCgkJCQkJCQlpID0gbWF0Y2hlZC5sZW5ndGg7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWR4ID0gaW5kZXhPZi5jYWxsKCBzZWVkLCBtYXRjaGVkW2ldICk7CgkJCQkJCQlzZWVkWyBpZHggXSA9ICEoIG1hdGNoZXNbIGlkeCBdID0gbWF0Y2hlZFtpXSApOwoJCQkJCQl9CgkJCQkJfSkgOgoJCQkJCWZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCQlyZXR1cm4gZm4oIGVsZW0sIDAsIGFyZ3MgKTsKCQkJCQl9OwoJCQl9CgoJCQlyZXR1cm4gZm47CgkJfQoJfSwKCglwc2V1ZG9zOiB7CgkJLy8gUG90ZW50aWFsbHkgY29tcGxleCBwc2V1ZG9zCgkJIm5vdCI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJCS8vIFRyaW0gdGhlIHNlbGVjdG9yIHBhc3NlZCB0byBjb21waWxlCgkJCS8vIHRvIGF2b2lkIHRyZWF0aW5nIGxlYWRpbmcgYW5kIHRyYWlsaW5nCgkJCS8vIHNwYWNlcyBhcyBjb21iaW5hdG9ycwoJCQl2YXIgaW5wdXQgPSBbXSwKCQkJCXJlc3VsdHMgPSBbXSwKCQkJCW1hdGNoZXIgPSBjb21waWxlKCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApICk7CgoJCQlyZXR1cm4gbWF0Y2hlclsgZXhwYW5kbyBdID8KCQkJCW1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcywgY29udGV4dCwgeG1sICkgewoJCQkJCXZhciBlbGVtLAoJCQkJCQl1bm1hdGNoZWQgPSBtYXRjaGVyKCBzZWVkLCBudWxsLCB4bWwsIFtdICksCgkJCQkJCWkgPSBzZWVkLmxlbmd0aDsKCgkJCQkJLy8gTWF0Y2ggZWxlbWVudHMgdW5tYXRjaGVkIGJ5IGBtYXRjaGVyYAoJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQlpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHsKCQkJCQkJCXNlZWRbaV0gPSAhKG1hdGNoZXNbaV0gPSBlbGVtKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0pIDoKCQkJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCQkJaW5wdXRbMF0gPSBlbGVtOwoJCQkJCW1hdGNoZXIoIGlucHV0LCBudWxsLCB4bWwsIHJlc3VsdHMgKTsKCQkJCQlyZXR1cm4gIXJlc3VsdHMucG9wKCk7CgkJCQl9OwoJCX0pLAoKCQkiaGFzIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIFNpenpsZSggc2VsZWN0b3IsIGVsZW0gKS5sZW5ndGggPiAwOwoJCQl9OwoJCX0pLAoKCQkiY29udGFpbnMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiAoIGVsZW0udGV4dENvbnRlbnQgfHwgZWxlbS5pbm5lclRleHQgfHwgZ2V0VGV4dCggZWxlbSApICkuaW5kZXhPZiggdGV4dCApID4gLTE7CgkJCX07CgkJfSksCgoJCS8vICJXaGV0aGVyIGFuIGVsZW1lbnQgaXMgcmVwcmVzZW50ZWQgYnkgYSA6bGFuZygpIHNlbGVjdG9yCgkJLy8gaXMgYmFzZWQgc29sZWx5IG9uIHRoZSBlbGVtZW50J3MgbGFuZ3VhZ2UgdmFsdWUKCQkvLyBiZWluZyBlcXVhbCB0byB0aGUgaWRlbnRpZmllciBDLAoJCS8vIG9yIGJlZ2lubmluZyB3aXRoIHRoZSBpZGVudGlmaWVyIEMgaW1tZWRpYXRlbHkgZm9sbG93ZWQgYnkgIi0iLgoJCS8vIFRoZSBtYXRjaGluZyBvZiBDIGFnYWluc3QgdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZSBpcyBwZXJmb3JtZWQgY2FzZS1pbnNlbnNpdGl2ZWx5LgoJCS8vIFRoZSBpZGVudGlmaWVyIEMgZG9lcyBub3QgaGF2ZSB0byBiZSBhIHZhbGlkIGxhbmd1YWdlIG5hbWUuIgoJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jbGFuZy1wc2V1ZG8KCQkibGFuZyI6IG1hcmtGdW5jdGlvbiggZnVuY3Rpb24oIGxhbmcgKSB7CgkJCS8vIGxhbmcgdmFsdWUgbXVzdCBiZSBhIHZhbGlkIGlkZW50aWZpZGVyCgkJCWlmICggIXJpZGVudGlmaWVyLnRlc3QobGFuZyB8fCAiIikgKSB7CgkJCQlTaXp6bGUuZXJyb3IoICJ1bnN1cHBvcnRlZCBsYW5nOiAiICsgbGFuZyApOwoJCQl9CgkJCWxhbmcgPSBsYW5nLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIGVsZW1MYW5nOwoJCQkJZG8gewoJCQkJCWlmICggKGVsZW1MYW5nID0gZG9jdW1lbnRJc1hNTCA/CgkJCQkJCWVsZW0uZ2V0QXR0cmlidXRlKCJ4bWw6bGFuZyIpIHx8IGVsZW0uZ2V0QXR0cmlidXRlKCJsYW5nIikgOgoJCQkJCQllbGVtLmxhbmcpICkgewoKCQkJCQkJZWxlbUxhbmcgPSBlbGVtTGFuZy50b0xvd2VyQ2FzZSgpOwoJCQkJCQlyZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZiggbGFuZyArICItIiApID09PSAwOwoJCQkJCX0KCQkJCX0gd2hpbGUgKCAoZWxlbSA9IGVsZW0ucGFyZW50Tm9kZSkgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9OwoJCX0pLAoKCQkvLyBNaXNjZWxsYW5lb3VzCgkJInRhcmdldCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaDsKCQkJcmV0dXJuIGhhc2ggJiYgaGFzaC5zbGljZSggMSApID09PSBlbGVtLmlkOwoJCX0sCgoJCSJyb290IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBkb2NFbGVtOwoJCX0sCgoJCSJmb2N1cyI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiAoIWRvY3VtZW50Lmhhc0ZvY3VzIHx8IGRvY3VtZW50Lmhhc0ZvY3VzKCkpICYmICEhKGVsZW0udHlwZSB8fCBlbGVtLmhyZWYgfHwgfmVsZW0udGFiSW5kZXgpOwoJCX0sCgoJCS8vIEJvb2xlYW4gcHJvcGVydGllcwoJCSJlbmFibGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLmRpc2FibGVkID09PSBmYWxzZTsKCQl9LAoKCQkiZGlzYWJsZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IHRydWU7CgkJfSwKCgkJImNoZWNrZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJLy8gSW4gQ1NTMywgOmNoZWNrZWQgc2hvdWxkIHJldHVybiBib3RoIGNoZWNrZWQgYW5kIHNlbGVjdGVkIGVsZW1lbnRzCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCXZhciBub2RlTmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIChub2RlTmFtZSA9PT0gImlucHV0IiAmJiAhIWVsZW0uY2hlY2tlZCkgfHwgKG5vZGVOYW1lID09PSAib3B0aW9uIiAmJiAhIWVsZW0uc2VsZWN0ZWQpOwoJCX0sCgoJCSJzZWxlY3RlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBBY2Nlc3NpbmcgdGhpcyBwcm9wZXJ0eSBtYWtlcyBzZWxlY3RlZC1ieS1kZWZhdWx0CgkJCS8vIG9wdGlvbnMgaW4gU2FmYXJpIHdvcmsgcHJvcGVybHkKCQkJaWYgKCBlbGVtLnBhcmVudE5vZGUgKSB7CgkJCQllbGVtLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJfQoKCQkJcmV0dXJuIGVsZW0uc2VsZWN0ZWQgPT09IHRydWU7CgkJfSwKCgkJLy8gQ29udGVudHMKCQkiZW1wdHkiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNlbXB0eS1wc2V1ZG8KCQkJLy8gOmVtcHR5IGlzIG9ubHkgYWZmZWN0ZWQgYnkgZWxlbWVudCBub2RlcyBhbmQgY29udGVudCBub2RlcyhpbmNsdWRpbmcgdGV4dCgzKSwgY2RhdGEoNCkpLAoJCQkvLyAgIG5vdCBjb21tZW50LCBwcm9jZXNzaW5nIGluc3RydWN0aW9ucywgb3Igb3RoZXJzCgkJCS8vIFRoYW5rcyB0byBEaWVnbyBQZXJpbmkgZm9yIHRoZSBub2RlTmFtZSBzaG9ydGN1dAoJCQkvLyAgIEdyZWF0ZXIgdGhhbiAiQCIgbWVhbnMgYWxwaGEgY2hhcmFjdGVycyAoc3BlY2lmaWNhbGx5IG5vdCBzdGFydGluZyB3aXRoICIjIiBvciAiPyIpCgkJCWZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkgewoJCQkJaWYgKCBlbGVtLm5vZGVOYW1lID4gIkAiIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gNCApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSwKCgkJInBhcmVudCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gIUV4cHIucHNldWRvc1siZW1wdHkiXSggZWxlbSApOwoJCX0sCgoJCS8vIEVsZW1lbnQvaW5wdXQgdHlwZXMKCQkiaGVhZGVyIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiByaGVhZGVyLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTsKCQl9LAoKCQkiaW5wdXQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHJpbnB1dHMudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCX0sCgoJCSJidXR0b24iOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCXJldHVybiBuYW1lID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gImJ1dHRvbiIgfHwgbmFtZSA9PT0gImJ1dHRvbiI7CgkJfSwKCgkJInRleHQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJdmFyIGF0dHI7CgkJCS8vIElFNiBhbmQgNyB3aWxsIG1hcCBlbGVtLnR5cGUgdG8gJ3RleHQnIGZvciBuZXcgSFRNTDUgdHlwZXMgKHNlYXJjaCwgZXRjKQoJCQkvLyB1c2UgZ2V0QXR0cmlidXRlIGluc3RlYWQgdG8gdGVzdCB0aGlzIGNhc2UKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJgoJCQkJZWxlbS50eXBlID09PSAidGV4dCIgJiYKCQkJCSggKGF0dHIgPSBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpKSA9PSBudWxsIHx8IGF0dHIudG9Mb3dlckNhc2UoKSA9PT0gZWxlbS50eXBlICk7CgkJfSwKCgkJLy8gUG9zaXRpb24taW4tY29sbGVjdGlvbgoJCSJmaXJzdCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oKSB7CgkJCXJldHVybiBbIDAgXTsKCQl9KSwKCgkJImxhc3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJcmV0dXJuIFsgbGVuZ3RoIC0gMSBdOwoJCX0pLAoKCQkiZXEiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXJldHVybiBbIGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQgXTsKCQl9KSwKCgkJImV2ZW4iOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJdmFyIGkgPSAwOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHsKCQkJCW1hdGNoSW5kZXhlcy5wdXNoKCBpICk7CgkJCX0KCQkJcmV0dXJuIG1hdGNoSW5kZXhlczsKCQl9KSwKCgkJIm9kZCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkgewoJCQl2YXIgaSA9IDE7CgkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSArPSAyICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pLAoKCQkibHQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsKCQkJZm9yICggOyAtLWkgPj0gMDsgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSksCgoJCSJndCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCApIHsKCQkJdmFyIGkgPSBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50OwoJCQlmb3IgKCA7ICsraSA8IGxlbmd0aDsgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSkKCX0KfTsKCi8vIEFkZCBidXR0b24vaW5wdXQgdHlwZSBwc2V1ZG9zCmZvciAoIGkgaW4geyByYWRpbzogdHJ1ZSwgY2hlY2tib3g6IHRydWUsIGZpbGU6IHRydWUsIHBhc3N3b3JkOiB0cnVlLCBpbWFnZTogdHJ1ZSB9ICkgewoJRXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVJbnB1dFBzZXVkbyggaSApOwp9CmZvciAoIGkgaW4geyBzdWJtaXQ6IHRydWUsIHJlc2V0OiB0cnVlIH0gKSB7CglFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUJ1dHRvblBzZXVkbyggaSApOwp9CgpmdW5jdGlvbiB0b2tlbml6ZSggc2VsZWN0b3IsIHBhcnNlT25seSApIHsKCXZhciBtYXRjaGVkLCBtYXRjaCwgdG9rZW5zLCB0eXBlLAoJCXNvRmFyLCBncm91cHMsIHByZUZpbHRlcnMsCgkJY2FjaGVkID0gdG9rZW5DYWNoZVsgc2VsZWN0b3IgKyAiICIgXTsKCglpZiAoIGNhY2hlZCApIHsKCQlyZXR1cm4gcGFyc2VPbmx5ID8gMCA6IGNhY2hlZC5zbGljZSggMCApOwoJfQoKCXNvRmFyID0gc2VsZWN0b3I7Cglncm91cHMgPSBbXTsKCXByZUZpbHRlcnMgPSBFeHByLnByZUZpbHRlcjsKCgl3aGlsZSAoIHNvRmFyICkgewoKCQkvLyBDb21tYSBhbmQgZmlyc3QgcnVuCgkJaWYgKCAhbWF0Y2hlZCB8fCAobWF0Y2ggPSByY29tbWEuZXhlYyggc29GYXIgKSkgKSB7CgkJCWlmICggbWF0Y2ggKSB7CgkJCQkvLyBEb24ndCBjb25zdW1lIHRyYWlsaW5nIGNvbW1hcyBhcyB2YWxpZAoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hbMF0ubGVuZ3RoICkgfHwgc29GYXI7CgkJCX0KCQkJZ3JvdXBzLnB1c2goIHRva2VucyA9IFtdICk7CgkJfQoKCQltYXRjaGVkID0gZmFsc2U7CgoJCS8vIENvbWJpbmF0b3JzCgkJaWYgKCAobWF0Y2ggPSByY29tYmluYXRvcnMuZXhlYyggc29GYXIgKSkgKSB7CgkJCW1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwoJCQl0b2tlbnMucHVzaCggewoJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2UKCQkJCXR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCAiICIgKQoJCQl9ICk7CgkJCXNvRmFyID0gc29GYXIuc2xpY2UoIG1hdGNoZWQubGVuZ3RoICk7CgkJfQoKCQkvLyBGaWx0ZXJzCgkJZm9yICggdHlwZSBpbiBFeHByLmZpbHRlciApIHsKCQkJaWYgKCAobWF0Y2ggPSBtYXRjaEV4cHJbIHR5cGUgXS5leGVjKCBzb0ZhciApKSAmJiAoIXByZUZpbHRlcnNbIHR5cGUgXSB8fAoJCQkJKG1hdGNoID0gcHJlRmlsdGVyc1sgdHlwZSBdKCBtYXRjaCApKSkgKSB7CgkJCQltYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsKCQkJCXRva2Vucy5wdXNoKCB7CgkJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkJdHlwZTogdHlwZSwKCQkJCQltYXRjaGVzOiBtYXRjaAoJCQkJfSApOwoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQkJfQoJCX0KCgkJaWYgKCAhbWF0Y2hlZCApIHsKCQkJYnJlYWs7CgkJfQoJfQoKCS8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwoJLy8gaWYgd2UncmUganVzdCBwYXJzaW5nCgkvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnMKCXJldHVybiBwYXJzZU9ubHkgPwoJCXNvRmFyLmxlbmd0aCA6CgkJc29GYXIgPwoJCQlTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOgoJCQkvLyBDYWNoZSB0aGUgdG9rZW5zCgkJCXRva2VuQ2FjaGUoIHNlbGVjdG9yLCBncm91cHMgKS5zbGljZSggMCApOwp9CgpmdW5jdGlvbiB0b1NlbGVjdG9yKCB0b2tlbnMgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gdG9rZW5zLmxlbmd0aCwKCQlzZWxlY3RvciA9ICIiOwoJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJc2VsZWN0b3IgKz0gdG9rZW5zW2ldLnZhbHVlOwoJfQoJcmV0dXJuIHNlbGVjdG9yOwp9CgpmdW5jdGlvbiBhZGRDb21iaW5hdG9yKCBtYXRjaGVyLCBjb21iaW5hdG9yLCBiYXNlICkgewoJdmFyIGRpciA9IGNvbWJpbmF0b3IuZGlyLAoJCWNoZWNrTm9uRWxlbWVudHMgPSBiYXNlICYmIGRpciA9PT0gInBhcmVudE5vZGUiLAoJCWRvbmVOYW1lID0gZG9uZSsrOwoKCXJldHVybiBjb21iaW5hdG9yLmZpcnN0ID8KCQkvLyBDaGVjayBhZ2FpbnN0IGNsb3Nlc3QgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnQKCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkgewoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7CgkJCQkJcmV0dXJuIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApOwoJCQkJfQoJCQl9CgkJfSA6CgoJCS8vIENoZWNrIGFnYWluc3QgYWxsIGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50cwoJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciBkYXRhLCBjYWNoZSwgb3V0ZXJDYWNoZSwKCQkJCWRpcmtleSA9IGRpcnJ1bnMgKyAiICIgKyBkb25lTmFtZTsKCgkJCS8vIFdlIGNhbid0IHNldCBhcmJpdHJhcnkgZGF0YSBvbiBYTUwgbm9kZXMsIHNvIHRoZXkgZG9uJ3QgYmVuZWZpdCBmcm9tIGRpciBjYWNoaW5nCgkJCWlmICggeG1sICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJaWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJb3V0ZXJDYWNoZSA9IGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQlpZiAoIChjYWNoZSA9IG91dGVyQ2FjaGVbIGRpciBdKSAmJiBjYWNoZVswXSA9PT0gZGlya2V5ICkgewoJCQkJCQkJaWYgKCAoZGF0YSA9IGNhY2hlWzFdKSA9PT0gdHJ1ZSB8fCBkYXRhID09PSBjYWNoZWRydW5zICkgewoJCQkJCQkJCXJldHVybiBkYXRhID09PSB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJY2FjaGUgPSBvdXRlckNhY2hlWyBkaXIgXSA9IFsgZGlya2V5IF07CgkJCQkJCQljYWNoZVsxXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApIHx8IGNhY2hlZHJ1bnM7CgkJCQkJCQlpZiAoIGNhY2hlWzFdID09PSB0cnVlICkgewoJCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfTsKfQoKZnVuY3Rpb24gZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICkgewoJcmV0dXJuIG1hdGNoZXJzLmxlbmd0aCA+IDEgPwoJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciBpID0gbWF0Y2hlcnMubGVuZ3RoOwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWlmICggIW1hdGNoZXJzW2ldKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSA6CgkJbWF0Y2hlcnNbMF07Cn0KCmZ1bmN0aW9uIGNvbmRlbnNlKCB1bm1hdGNoZWQsIG1hcCwgZmlsdGVyLCBjb250ZXh0LCB4bWwgKSB7Cgl2YXIgZWxlbSwKCQluZXdVbm1hdGNoZWQgPSBbXSwKCQlpID0gMCwKCQlsZW4gPSB1bm1hdGNoZWQubGVuZ3RoLAoJCW1hcHBlZCA9IG1hcCAhPSBudWxsOwoKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCWlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkgewoJCQlpZiAoICFmaWx0ZXIgfHwgZmlsdGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCW5ld1VubWF0Y2hlZC5wdXNoKCBlbGVtICk7CgkJCQlpZiAoIG1hcHBlZCApIHsKCQkJCQltYXAucHVzaCggaSApOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiBuZXdVbm1hdGNoZWQ7Cn0KCmZ1bmN0aW9uIHNldE1hdGNoZXIoIHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApIHsKCWlmICggcG9zdEZpbHRlciAmJiAhcG9zdEZpbHRlclsgZXhwYW5kbyBdICkgewoJCXBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKCBwb3N0RmlsdGVyICk7Cgl9CglpZiAoIHBvc3RGaW5kZXIgJiYgIXBvc3RGaW5kZXJbIGV4cGFuZG8gXSApIHsKCQlwb3N0RmluZGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbmRlciwgcG9zdFNlbGVjdG9yICk7Cgl9CglyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCByZXN1bHRzLCBjb250ZXh0LCB4bWwgKSB7CgkJdmFyIHRlbXAsIGksIGVsZW0sCgkJCXByZU1hcCA9IFtdLAoJCQlwb3N0TWFwID0gW10sCgkJCXByZWV4aXN0aW5nID0gcmVzdWx0cy5sZW5ndGgsCgoJCQkvLyBHZXQgaW5pdGlhbCBlbGVtZW50cyBmcm9tIHNlZWQgb3IgY29udGV4dAoJCQllbGVtcyA9IHNlZWQgfHwgbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IgfHwgIioiLCBjb250ZXh0Lm5vZGVUeXBlID8gWyBjb250ZXh0IF0gOiBjb250ZXh0LCBbXSApLAoKCQkJLy8gUHJlZmlsdGVyIHRvIGdldCBtYXRjaGVyIGlucHV0LCBwcmVzZXJ2aW5nIGEgbWFwIGZvciBzZWVkLXJlc3VsdHMgc3luY2hyb25pemF0aW9uCgkJCW1hdGNoZXJJbiA9IHByZUZpbHRlciAmJiAoIHNlZWQgfHwgIXNlbGVjdG9yICkgPwoJCQkJY29uZGVuc2UoIGVsZW1zLCBwcmVNYXAsIHByZUZpbHRlciwgY29udGV4dCwgeG1sICkgOgoJCQkJZWxlbXMsCgoJCQltYXRjaGVyT3V0ID0gbWF0Y2hlciA/CgkJCQkvLyBJZiB3ZSBoYXZlIGEgcG9zdEZpbmRlciwgb3IgZmlsdGVyZWQgc2VlZCwgb3Igbm9uLXNlZWQgcG9zdEZpbHRlciBvciBwcmVleGlzdGluZyByZXN1bHRzLAoJCQkJcG9zdEZpbmRlciB8fCAoIHNlZWQgPyBwcmVGaWx0ZXIgOiBwcmVleGlzdGluZyB8fCBwb3N0RmlsdGVyICkgPwoKCQkJCQkvLyAuLi5pbnRlcm1lZGlhdGUgcHJvY2Vzc2luZyBpcyBuZWNlc3NhcnkKCQkJCQlbXSA6CgoJCQkJCS8vIC4uLm90aGVyd2lzZSB1c2UgcmVzdWx0cyBkaXJlY3RseQoJCQkJCXJlc3VsdHMgOgoJCQkJbWF0Y2hlckluOwoKCQkvLyBGaW5kIHByaW1hcnkgbWF0Y2hlcwoJCWlmICggbWF0Y2hlciApIHsKCQkJbWF0Y2hlciggbWF0Y2hlckluLCBtYXRjaGVyT3V0LCBjb250ZXh0LCB4bWwgKTsKCQl9CgoJCS8vIEFwcGx5IHBvc3RGaWx0ZXIKCQlpZiAoIHBvc3RGaWx0ZXIgKSB7CgkJCXRlbXAgPSBjb25kZW5zZSggbWF0Y2hlck91dCwgcG9zdE1hcCApOwoJCQlwb3N0RmlsdGVyKCB0ZW1wLCBbXSwgY29udGV4dCwgeG1sICk7CgoJCQkvLyBVbi1tYXRjaCBmYWlsaW5nIGVsZW1lbnRzIGJ5IG1vdmluZyB0aGVtIGJhY2sgdG8gbWF0Y2hlckluCgkJCWkgPSB0ZW1wLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoIChlbGVtID0gdGVtcFtpXSkgKSB7CgkJCQkJbWF0Y2hlck91dFsgcG9zdE1hcFtpXSBdID0gIShtYXRjaGVySW5bIHBvc3RNYXBbaV0gXSA9IGVsZW0pOwoJCQkJfQoJCQl9CgkJfQoKCQlpZiAoIHNlZWQgKSB7CgkJCWlmICggcG9zdEZpbmRlciB8fCBwcmVGaWx0ZXIgKSB7CgkJCQlpZiAoIHBvc3RGaW5kZXIgKSB7CgkJCQkJLy8gR2V0IHRoZSBmaW5hbCBtYXRjaGVyT3V0IGJ5IGNvbmRlbnNpbmcgdGhpcyBpbnRlcm1lZGlhdGUgaW50byBwb3N0RmluZGVyIGNvbnRleHRzCgkJCQkJdGVtcCA9IFtdOwoJCQkJCWkgPSBtYXRjaGVyT3V0Lmxlbmd0aDsKCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJaWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICkgewoJCQkJCQkJLy8gUmVzdG9yZSBtYXRjaGVySW4gc2luY2UgZWxlbSBpcyBub3QgeWV0IGEgZmluYWwgbWF0Y2gKCQkJCQkJCXRlbXAucHVzaCggKG1hdGNoZXJJbltpXSA9IGVsZW0pICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcG9zdEZpbmRlciggbnVsbCwgKG1hdGNoZXJPdXQgPSBbXSksIHRlbXAsIHhtbCApOwoJCQkJfQoKCQkJCS8vIE1vdmUgbWF0Y2hlZCBlbGVtZW50cyBmcm9tIHNlZWQgdG8gcmVzdWx0cyB0byBrZWVwIHRoZW0gc3luY2hyb25pemVkCgkJCQlpID0gbWF0Y2hlck91dC5sZW5ndGg7CgkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQlpZiAoIChlbGVtID0gbWF0Y2hlck91dFtpXSkgJiYKCQkJCQkJKHRlbXAgPSBwb3N0RmluZGVyID8gaW5kZXhPZi5jYWxsKCBzZWVkLCBlbGVtICkgOiBwcmVNYXBbaV0pID4gLTEgKSB7CgoJCQkJCQlzZWVkW3RlbXBdID0gIShyZXN1bHRzW3RlbXBdID0gZWxlbSk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIEFkZCBlbGVtZW50cyB0byByZXN1bHRzLCB0aHJvdWdoIHBvc3RGaW5kZXIgaWYgZGVmaW5lZAoJCX0gZWxzZSB7CgkJCW1hdGNoZXJPdXQgPSBjb25kZW5zZSgKCQkJCW1hdGNoZXJPdXQgPT09IHJlc3VsdHMgPwoJCQkJCW1hdGNoZXJPdXQuc3BsaWNlKCBwcmVleGlzdGluZywgbWF0Y2hlck91dC5sZW5ndGggKSA6CgkJCQkJbWF0Y2hlck91dAoJCQkpOwoJCQlpZiAoIHBvc3RGaW5kZXIgKSB7CgkJCQlwb3N0RmluZGVyKCBudWxsLCByZXN1bHRzLCBtYXRjaGVyT3V0LCB4bWwgKTsKCQkJfSBlbHNlIHsKCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIG1hdGNoZXJPdXQgKTsKCQkJfQoJCX0KCX0pOwp9CgpmdW5jdGlvbiBtYXRjaGVyRnJvbVRva2VucyggdG9rZW5zICkgewoJdmFyIGNoZWNrQ29udGV4dCwgbWF0Y2hlciwgaiwKCQlsZW4gPSB0b2tlbnMubGVuZ3RoLAoJCWxlYWRpbmdSZWxhdGl2ZSA9IEV4cHIucmVsYXRpdmVbIHRva2Vuc1swXS50eXBlIF0sCgkJaW1wbGljaXRSZWxhdGl2ZSA9IGxlYWRpbmdSZWxhdGl2ZSB8fCBFeHByLnJlbGF0aXZlWyIgIl0sCgkJaSA9IGxlYWRpbmdSZWxhdGl2ZSA/IDEgOiAwLAoKCQkvLyBUaGUgZm91bmRhdGlvbmFsIG1hdGNoZXIgZW5zdXJlcyB0aGF0IGVsZW1lbnRzIGFyZSByZWFjaGFibGUgZnJvbSB0b3AtbGV2ZWwgY29udGV4dChzKQoJCW1hdGNoQ29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gY2hlY2tDb250ZXh0OwoJCX0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUgKSwKCQltYXRjaEFueUNvbnRleHQgPSBhZGRDb21iaW5hdG9yKCBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGluZGV4T2YuY2FsbCggY2hlY2tDb250ZXh0LCBlbGVtICkgPiAtMTsKCQl9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksCgkJbWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXJldHVybiAoICFsZWFkaW5nUmVsYXRpdmUgJiYgKCB4bWwgfHwgY29udGV4dCAhPT0gb3V0ZXJtb3N0Q29udGV4dCApICkgfHwgKAoJCQkJKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8KCQkJCQltYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDoKCQkJCQltYXRjaEFueUNvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApICk7CgkJfSBdOwoKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCWlmICggKG1hdGNoZXIgPSBFeHByLnJlbGF0aXZlWyB0b2tlbnNbaV0udHlwZSBdKSApIHsKCQkJbWF0Y2hlcnMgPSBbIGFkZENvbWJpbmF0b3IoZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICksIG1hdGNoZXIpIF07CgkJfSBlbHNlIHsKCQkJbWF0Y2hlciA9IEV4cHIuZmlsdGVyWyB0b2tlbnNbaV0udHlwZSBdLmFwcGx5KCBudWxsLCB0b2tlbnNbaV0ubWF0Y2hlcyApOwoKCQkJLy8gUmV0dXJuIHNwZWNpYWwgdXBvbiBzZWVpbmcgYSBwb3NpdGlvbmFsIG1hdGNoZXIKCQkJaWYgKCBtYXRjaGVyWyBleHBhbmRvIF0gKSB7CgkJCQkvLyBGaW5kIHRoZSBuZXh0IHJlbGF0aXZlIG9wZXJhdG9yIChpZiBhbnkpIGZvciBwcm9wZXIgaGFuZGxpbmcKCQkJCWogPSArK2k7CgkJCQlmb3IgKCA7IGogPCBsZW47IGorKyApIHsKCQkJCQlpZiAoIEV4cHIucmVsYXRpdmVbIHRva2Vuc1tqXS50eXBlIF0gKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiBzZXRNYXRjaGVyKAoJCQkJCWkgPiAxICYmIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLAoJCQkJCWkgPiAxICYmIHRvU2VsZWN0b3IoIHRva2Vucy5zbGljZSggMCwgaSAtIDEgKSApLnJlcGxhY2UoIHJ0cmltLCAiJDEiICksCgkJCQkJbWF0Y2hlciwKCQkJCQlpIDwgaiAmJiBtYXRjaGVyRnJvbVRva2VucyggdG9rZW5zLnNsaWNlKCBpLCBqICkgKSwKCQkJCQlqIDwgbGVuICYmIG1hdGNoZXJGcm9tVG9rZW5zKCAodG9rZW5zID0gdG9rZW5zLnNsaWNlKCBqICkpICksCgkJCQkJaiA8IGxlbiAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKQoJCQkJKTsKCQkJfQoJCQltYXRjaGVycy5wdXNoKCBtYXRjaGVyICk7CgkJfQoJfQoKCXJldHVybiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKTsKfQoKZnVuY3Rpb24gbWF0Y2hlckZyb21Hcm91cE1hdGNoZXJzKCBlbGVtZW50TWF0Y2hlcnMsIHNldE1hdGNoZXJzICkgewoJLy8gQSBjb3VudGVyIHRvIHNwZWNpZnkgd2hpY2ggZWxlbWVudCBpcyBjdXJyZW50bHkgYmVpbmcgbWF0Y2hlZAoJdmFyIG1hdGNoZXJDYWNoZWRSdW5zID0gMCwKCQlieVNldCA9IHNldE1hdGNoZXJzLmxlbmd0aCA+IDAsCgkJYnlFbGVtZW50ID0gZWxlbWVudE1hdGNoZXJzLmxlbmd0aCA+IDAsCgkJc3VwZXJNYXRjaGVyID0gZnVuY3Rpb24oIHNlZWQsIGNvbnRleHQsIHhtbCwgcmVzdWx0cywgZXhwYW5kQ29udGV4dCApIHsKCQkJdmFyIGVsZW0sIGosIG1hdGNoZXIsCgkJCQlzZXRNYXRjaGVkID0gW10sCgkJCQltYXRjaGVkQ291bnQgPSAwLAoJCQkJaSA9ICIwIiwKCQkJCXVubWF0Y2hlZCA9IHNlZWQgJiYgW10sCgkJCQlvdXRlcm1vc3QgPSBleHBhbmRDb250ZXh0ICE9IG51bGwsCgkJCQljb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCwKCQkJCS8vIFdlIG11c3QgYWx3YXlzIGhhdmUgZWl0aGVyIHNlZWQgZWxlbWVudHMgb3IgY29udGV4dAoJCQkJZWxlbXMgPSBzZWVkIHx8IGJ5RWxlbWVudCAmJiBFeHByLmZpbmRbIlRBRyJdKCAiKiIsIGV4cGFuZENvbnRleHQgJiYgY29udGV4dC5wYXJlbnROb2RlIHx8IGNvbnRleHQgKSwKCQkJCS8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyCgkJCQlkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKTsKCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgIT09IGRvY3VtZW50ICYmIGNvbnRleHQ7CgkJCQljYWNoZWRydW5zID0gbWF0Y2hlckNhY2hlZFJ1bnM7CgkJCX0KCgkJCS8vIEFkZCBlbGVtZW50cyBwYXNzaW5nIGVsZW1lbnRNYXRjaGVycyBkaXJlY3RseSB0byByZXN1bHRzCgkJCS8vIEtlZXAgYGlgIGEgc3RyaW5nIGlmIHRoZXJlIGFyZSBubyBlbGVtZW50cyBzbyBgbWF0Y2hlZENvdW50YCB3aWxsIGJlICIwMCIgYmVsb3cKCQkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCQlpZiAoIGJ5RWxlbWVudCAmJiBlbGVtICkgewoJCQkJCWogPSAwOwoJCQkJCXdoaWxlICggKG1hdGNoZXIgPSBlbGVtZW50TWF0Y2hlcnNbaisrXSkgKSB7CgkJCQkJCWlmICggbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQkJCQlyZXN1bHRzLnB1c2goIGVsZW0gKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJCQlkaXJydW5zID0gZGlycnVuc1VuaXF1ZTsKCQkJCQkJY2FjaGVkcnVucyA9ICsrbWF0Y2hlckNhY2hlZFJ1bnM7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIFRyYWNrIHVubWF0Y2hlZCBlbGVtZW50cyBmb3Igc2V0IGZpbHRlcnMKCQkJCWlmICggYnlTZXQgKSB7CgkJCQkJLy8gVGhleSB3aWxsIGhhdmUgZ29uZSB0aHJvdWdoIGFsbCBwb3NzaWJsZSBtYXRjaGVycwoJCQkJCWlmICggKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSApIHsKCQkJCQkJbWF0Y2hlZENvdW50LS07CgkJCQkJfQoKCQkJCQkvLyBMZW5ndGhlbiB0aGUgYXJyYXkgZm9yIGV2ZXJ5IGVsZW1lbnQsIG1hdGNoZWQgb3Igbm90CgkJCQkJaWYgKCBzZWVkICkgewoJCQkJCQl1bm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCgkJCW1hdGNoZWRDb3VudCArPSBpOwoJCQlpZiAoIGJ5U2V0ICYmIGkgIT09IG1hdGNoZWRDb3VudCApIHsKCQkJCWogPSAwOwoJCQkJd2hpbGUgKCAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pICkgewoJCQkJCW1hdGNoZXIoIHVubWF0Y2hlZCwgc2V0TWF0Y2hlZCwgY29udGV4dCwgeG1sICk7CgkJCQl9CgoJCQkJaWYgKCBzZWVkICkgewoJCQkJCS8vIFJlaW50ZWdyYXRlIGVsZW1lbnQgbWF0Y2hlcyB0byBlbGltaW5hdGUgdGhlIG5lZWQgZm9yIHNvcnRpbmcKCQkJCQlpZiAoIG1hdGNoZWRDb3VudCA+IDAgKSB7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWYgKCAhKHVubWF0Y2hlZFtpXSB8fCBzZXRNYXRjaGVkW2ldKSApIHsKCQkJCQkJCQlzZXRNYXRjaGVkW2ldID0gcG9wLmNhbGwoIHJlc3VsdHMgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gRGlzY2FyZCBpbmRleCBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gZ2V0IG9ubHkgYWN0dWFsIG1hdGNoZXMKCQkJCQlzZXRNYXRjaGVkID0gY29uZGVuc2UoIHNldE1hdGNoZWQgKTsKCQkJCX0KCgkJCQkvLyBBZGQgbWF0Y2hlcyB0byByZXN1bHRzCgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzZXRNYXRjaGVkICk7CgoJCQkJLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nCgkJCQlpZiAoIG91dGVybW9zdCAmJiAhc2VlZCAmJiBzZXRNYXRjaGVkLmxlbmd0aCA+IDAgJiYKCQkJCQkoIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCApID4gMSApIHsKCgkJCQkJU2l6emxlLnVuaXF1ZVNvcnQoIHJlc3VsdHMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gT3ZlcnJpZGUgbWFuaXB1bGF0aW9uIG9mIGdsb2JhbHMgYnkgbmVzdGVkIG1hdGNoZXJzCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQlvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDsKCQkJfQoKCQkJcmV0dXJuIHVubWF0Y2hlZDsKCQl9OwoKCXJldHVybiBieVNldCA/CgkJbWFya0Z1bmN0aW9uKCBzdXBlck1hdGNoZXIgKSA6CgkJc3VwZXJNYXRjaGVyOwp9Cgpjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGdyb3VwIC8qIEludGVybmFsIFVzZSBPbmx5ICovICkgewoJdmFyIGksCgkJc2V0TWF0Y2hlcnMgPSBbXSwKCQllbGVtZW50TWF0Y2hlcnMgPSBbXSwKCQljYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggIWNhY2hlZCApIHsKCQkvLyBHZW5lcmF0ZSBhIGZ1bmN0aW9uIG9mIHJlY3Vyc2l2ZSBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayBlYWNoIGVsZW1lbnQKCQlpZiAoICFncm91cCApIHsKCQkJZ3JvdXAgPSB0b2tlbml6ZSggc2VsZWN0b3IgKTsKCQl9CgkJaSA9IGdyb3VwLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJY2FjaGVkID0gbWF0Y2hlckZyb21Ub2tlbnMoIGdyb3VwW2ldICk7CgkJCWlmICggY2FjaGVkWyBleHBhbmRvIF0gKSB7CgkJCQlzZXRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfSBlbHNlIHsKCQkJCWVsZW1lbnRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfQoJCX0KCgkJLy8gQ2FjaGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uCgkJY2FjaGVkID0gY29tcGlsZXJDYWNoZSggc2VsZWN0b3IsIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApICk7Cgl9CglyZXR1cm4gY2FjaGVkOwp9OwoKZnVuY3Rpb24gbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IsIGNvbnRleHRzLCByZXN1bHRzICkgewoJdmFyIGkgPSAwLAoJCWxlbiA9IGNvbnRleHRzLmxlbmd0aDsKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCVNpenpsZSggc2VsZWN0b3IsIGNvbnRleHRzW2ldLCByZXN1bHRzICk7Cgl9CglyZXR1cm4gcmVzdWx0czsKfQoKZnVuY3Rpb24gc2VsZWN0KCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHsKCXZhciBpLCB0b2tlbnMsIHRva2VuLCB0eXBlLCBmaW5kLAoJCW1hdGNoID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJaWYgKCAhc2VlZCApIHsKCQkvLyBUcnkgdG8gbWluaW1pemUgb3BlcmF0aW9ucyBpZiB0aGVyZSBpcyBvbmx5IG9uZSBncm91cAoJCWlmICggbWF0Y2gubGVuZ3RoID09PSAxICkgewoKCQkJLy8gVGFrZSBhIHNob3J0Y3V0IGFuZCBzZXQgdGhlIGNvbnRleHQgaWYgdGhlIHJvb3Qgc2VsZWN0b3IgaXMgYW4gSUQKCQkJdG9rZW5zID0gbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSggMCApOwoJCQlpZiAoIHRva2Vucy5sZW5ndGggPiAyICYmICh0b2tlbiA9IHRva2Vuc1swXSkudHlwZSA9PT0gIklEIiAmJgoJCQkJCWNvbnRleHQubm9kZVR5cGUgPT09IDkgJiYgIWRvY3VtZW50SXNYTUwgJiYKCQkJCQlFeHByLnJlbGF0aXZlWyB0b2tlbnNbMV0udHlwZSBdICkgewoKCQkJCWNvbnRleHQgPSBFeHByLmZpbmRbIklEIl0oIHRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKSwgY29udGV4dCApWzBdOwoJCQkJaWYgKCAhY29udGV4dCApIHsKCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCX0KCgkJCQlzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKCB0b2tlbnMuc2hpZnQoKS52YWx1ZS5sZW5ndGggKTsKCQkJfQoKCQkJLy8gRmV0Y2ggYSBzZWVkIHNldCBmb3IgcmlnaHQtdG8tbGVmdCBtYXRjaGluZwoJCQlpID0gbWF0Y2hFeHByWyJuZWVkc0NvbnRleHQiXS50ZXN0KCBzZWxlY3RvciApID8gMCA6IHRva2Vucy5sZW5ndGg7CgkJCXdoaWxlICggaS0tICkgewoJCQkJdG9rZW4gPSB0b2tlbnNbaV07CgoJCQkJLy8gQWJvcnQgaWYgd2UgaGl0IGEgY29tYmluYXRvcgoJCQkJaWYgKCBFeHByLnJlbGF0aXZlWyAodHlwZSA9IHRva2VuLnR5cGUpIF0gKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQlpZiAoIChmaW5kID0gRXhwci5maW5kWyB0eXBlIF0pICkgewoJCQkJCS8vIFNlYXJjaCwgZXhwYW5kaW5nIGNvbnRleHQgZm9yIGxlYWRpbmcgc2libGluZyBjb21iaW5hdG9ycwoJCQkJCWlmICggKHNlZWQgPSBmaW5kKAoJCQkJCQl0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICksCgkJCQkJCXJzaWJsaW5nLnRlc3QoIHRva2Vuc1swXS50eXBlICkgJiYgY29udGV4dC5wYXJlbnROb2RlIHx8IGNvbnRleHQKCQkJCQkpKSApIHsKCgkJCQkJCS8vIElmIHNlZWQgaXMgZW1wdHkgb3Igbm8gdG9rZW5zIHJlbWFpbiwgd2UgY2FuIHJldHVybiBlYXJseQoJCQkJCQl0b2tlbnMuc3BsaWNlKCBpLCAxICk7CgkJCQkJCXNlbGVjdG9yID0gc2VlZC5sZW5ndGggJiYgdG9TZWxlY3RvciggdG9rZW5zICk7CgkJCQkJCWlmICggIXNlbGVjdG9yICkgewoJCQkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2xpY2UuY2FsbCggc2VlZCwgMCApICk7CgkJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQkJfQoKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoKCS8vIENvbXBpbGUgYW5kIGV4ZWN1dGUgYSBmaWx0ZXJpbmcgZnVuY3Rpb24KCS8vIFByb3ZpZGUgYG1hdGNoYCB0byBhdm9pZCByZXRva2VuaXphdGlvbiBpZiB3ZSBtb2RpZmllZCB0aGUgc2VsZWN0b3IgYWJvdmUKCWNvbXBpbGUoIHNlbGVjdG9yLCBtYXRjaCApKAoJCXNlZWQsCgkJY29udGV4dCwKCQlkb2N1bWVudElzWE1MLAoJCXJlc3VsdHMsCgkJcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKQoJKTsKCXJldHVybiByZXN1bHRzOwp9CgovLyBEZXByZWNhdGVkCkV4cHIucHNldWRvc1sibnRoIl0gPSBFeHByLnBzZXVkb3NbImVxIl07CgovLyBFYXN5IEFQSSBmb3IgY3JlYXRpbmcgbmV3IHNldEZpbHRlcnMKZnVuY3Rpb24gc2V0RmlsdGVycygpIHt9CkV4cHIuZmlsdGVycyA9IHNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5wc2V1ZG9zOwpFeHByLnNldEZpbHRlcnMgPSBuZXcgc2V0RmlsdGVycygpOwoKLy8gSW5pdGlhbGl6ZSB3aXRoIHRoZSBkZWZhdWx0IGRvY3VtZW50CnNldERvY3VtZW50KCk7CgovLyBPdmVycmlkZSBzaXp6bGUgYXR0cmlidXRlIHJldHJpZXZhbApTaXp6bGUuYXR0ciA9IGpRdWVyeS5hdHRyOwpqUXVlcnkuZmluZCA9IFNpenpsZTsKalF1ZXJ5LmV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzOwpqUXVlcnkuZXhwclsiOiJdID0galF1ZXJ5LmV4cHIucHNldWRvczsKalF1ZXJ5LnVuaXF1ZSA9IFNpenpsZS51bmlxdWVTb3J0OwpqUXVlcnkudGV4dCA9IFNpenpsZS5nZXRUZXh0OwpqUXVlcnkuaXNYTUxEb2MgPSBTaXp6bGUuaXNYTUw7CmpRdWVyeS5jb250YWlucyA9IFNpenpsZS5jb250YWluczsKCgp9KSggd2luZG93ICk7CnZhciBydW50aWwgPSAvVW50aWwkLywKCXJwYXJlbnRzcHJldiA9IC9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLAoJaXNTaW1wbGUgPSAvXi5bXjojXFtcLixdKiQvLAoJcm5lZWRzQ29udGV4dCA9IGpRdWVyeS5leHByLm1hdGNoLm5lZWRzQ29udGV4dCwKCS8vIG1ldGhvZHMgZ3VhcmFudGVlZCB0byBwcm9kdWNlIGEgdW5pcXVlIHNldCB3aGVuIHN0YXJ0aW5nIGZyb20gYSB1bmlxdWUgc2V0CglndWFyYW50ZWVkVW5pcXVlID0gewoJCWNoaWxkcmVuOiB0cnVlLAoJCWNvbnRlbnRzOiB0cnVlLAoJCW5leHQ6IHRydWUsCgkJcHJldjogdHJ1ZQoJfTsKCmpRdWVyeS5mbi5leHRlbmQoewoJZmluZDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBpLCByZXQsIHNlbGYsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIgKSB7CgkJCXNlbGYgPSB0aGlzOwoJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeSggc2VsZWN0b3IgKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9KSApOwoJCX0KCgkJcmV0ID0gW107CgkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJalF1ZXJ5LmZpbmQoIHNlbGVjdG9yLCB0aGlzWyBpIF0sIHJldCApOwoJCX0KCgkJLy8gTmVlZGVkIGJlY2F1c2UgJCggc2VsZWN0b3IsIGNvbnRleHQgKSBiZWNvbWVzICQoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApCgkJcmV0ID0gdGhpcy5wdXNoU3RhY2soIGxlbiA+IDEgPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldCApOwoJCXJldC5zZWxlY3RvciA9ICggdGhpcy5zZWxlY3RvciA/IHRoaXMuc2VsZWN0b3IgKyAiICIgOiAiIiApICsgc2VsZWN0b3I7CgkJcmV0dXJuIHJldDsKCX0sCgoJaGFzOiBmdW5jdGlvbiggdGFyZ2V0ICkgewoJCXZhciBpLAoJCQl0YXJnZXRzID0galF1ZXJ5KCB0YXJnZXQsIHRoaXMgKSwKCQkJbGVuID0gdGFyZ2V0cy5sZW5ndGg7CgoJCXJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCB0aGlzLCB0YXJnZXRzW2ldICkgKSB7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQl9KTsKCX0sCgoJbm90OiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCB3aW5ub3codGhpcywgc2VsZWN0b3IsIGZhbHNlKSApOwoJfSwKCglmaWx0ZXI6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyh0aGlzLCBzZWxlY3RvciwgdHJ1ZSkgKTsKCX0sCgoJaXM6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gISFzZWxlY3RvciAmJiAoCgkJCXR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgPwoJCQkJLy8gSWYgdGhpcyBpcyBhIHBvc2l0aW9uYWwvcmVsYXRpdmUgc2VsZWN0b3IsIGNoZWNrIG1lbWJlcnNoaXAgaW4gdGhlIHJldHVybmVkIHNldAoJCQkJLy8gc28gJCgicDpmaXJzdCIpLmlzKCJwOmxhc3QiKSB3b24ndCByZXR1cm4gdHJ1ZSBmb3IgYSBkb2Mgd2l0aCB0d28gInAiLgoJCQkJcm5lZWRzQ29udGV4dC50ZXN0KCBzZWxlY3RvciApID8KCQkJCQlqUXVlcnkoIHNlbGVjdG9yLCB0aGlzLmNvbnRleHQgKS5pbmRleCggdGhpc1swXSApID49IDAgOgoJCQkJCWpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCB0aGlzICkubGVuZ3RoID4gMCA6CgkJCQl0aGlzLmZpbHRlciggc2VsZWN0b3IgKS5sZW5ndGggPiAwICk7Cgl9LAoKCWNsb3Nlc3Q6IGZ1bmN0aW9uKCBzZWxlY3RvcnMsIGNvbnRleHQgKSB7CgkJdmFyIGN1ciwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aCwKCQkJcmV0ID0gW10sCgkJCXBvcyA9IHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3JzICkgfHwgdHlwZW9mIHNlbGVjdG9ycyAhPT0gInN0cmluZyIgPwoJCQkJalF1ZXJ5KCBzZWxlY3RvcnMsIGNvbnRleHQgfHwgdGhpcy5jb250ZXh0ICkgOgoJCQkJMDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQljdXIgPSB0aGlzW2ldOwoKCQkJd2hpbGUgKCBjdXIgJiYgY3VyLm93bmVyRG9jdW1lbnQgJiYgY3VyICE9PSBjb250ZXh0ICYmIGN1ci5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQlpZiAoIHBvcyA/IHBvcy5pbmRleChjdXIpID4gLTEgOiBqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoY3VyLCBzZWxlY3RvcnMpICkgewoJCQkJCXJldC5wdXNoKCBjdXIgKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWN1ciA9IGN1ci5wYXJlbnROb2RlOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldC5sZW5ndGggPiAxID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQgKTsKCX0sCgoJLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpbgoJLy8gdGhlIG1hdGNoZWQgc2V0IG9mIGVsZW1lbnRzCglpbmRleDogZnVuY3Rpb24oIGVsZW0gKSB7CgoJCS8vIE5vIGFyZ3VtZW50LCByZXR1cm4gaW5kZXggaW4gcGFyZW50CgkJaWYgKCAhZWxlbSApIHsKCQkJcmV0dXJuICggdGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUgKSA/IHRoaXMuZmlyc3QoKS5wcmV2QWxsKCkubGVuZ3RoIDogLTE7CgkJfQoKCQkvLyBpbmRleCBpbiBzZWxlY3RvcgoJCWlmICggdHlwZW9mIGVsZW0gPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoIHRoaXNbMF0sIGpRdWVyeSggZWxlbSApICk7CgkJfQoKCQkvLyBMb2NhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBkZXNpcmVkIGVsZW1lbnQKCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoCgkJCS8vIElmIGl0IHJlY2VpdmVzIGEgalF1ZXJ5IG9iamVjdCwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdXNlZAoJCQllbGVtLmpxdWVyeSA/IGVsZW1bMF0gOiBlbGVtLCB0aGlzICk7Cgl9LAoKCWFkZDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCXZhciBzZXQgPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciID8KCQkJCWpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSA6CgkJCQlqUXVlcnkubWFrZUFycmF5KCBzZWxlY3RvciAmJiBzZWxlY3Rvci5ub2RlVHlwZSA/IFsgc2VsZWN0b3IgXSA6IHNlbGVjdG9yICksCgkJCWFsbCA9IGpRdWVyeS5tZXJnZSggdGhpcy5nZXQoKSwgc2V0ICk7CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggalF1ZXJ5LnVuaXF1ZShhbGwpICk7Cgl9LAoKCWFkZEJhY2s6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5hZGQoIHNlbGVjdG9yID09IG51bGwgPwoJCQl0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKHNlbGVjdG9yKQoJCSk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmFuZFNlbGYgPSBqUXVlcnkuZm4uYWRkQmFjazsKCmZ1bmN0aW9uIHNpYmxpbmcoIGN1ciwgZGlyICkgewoJZG8gewoJCWN1ciA9IGN1clsgZGlyIF07Cgl9IHdoaWxlICggY3VyICYmIGN1ci5ub2RlVHlwZSAhPT0gMSApOwoKCXJldHVybiBjdXI7Cn0KCmpRdWVyeS5lYWNoKHsKCXBhcmVudDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZTsKCQlyZXR1cm4gcGFyZW50ICYmIHBhcmVudC5ub2RlVHlwZSAhPT0gMTEgPyBwYXJlbnQgOiBudWxsOwoJfSwKCXBhcmVudHM6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAicGFyZW50Tm9kZSIgKTsKCX0sCglwYXJlbnRzVW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInBhcmVudE5vZGUiLCB1bnRpbCApOwoJfSwKCW5leHQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBzaWJsaW5nKCBlbGVtLCAibmV4dFNpYmxpbmciICk7Cgl9LAoJcHJldjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIHNpYmxpbmcoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7Cgl9LAoJbmV4dEFsbDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJuZXh0U2libGluZyIgKTsKCX0sCglwcmV2QWxsOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInByZXZpb3VzU2libGluZyIgKTsKCX0sCgluZXh0VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgIm5leHRTaWJsaW5nIiwgdW50aWwgKTsKCX0sCglwcmV2VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInByZXZpb3VzU2libGluZyIsIHVudGlsICk7Cgl9LAoJc2libGluZ3M6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuc2libGluZyggKCBlbGVtLnBhcmVudE5vZGUgfHwge30gKS5maXJzdENoaWxkLCBlbGVtICk7Cgl9LAoJY2hpbGRyZW46IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuc2libGluZyggZWxlbS5maXJzdENoaWxkICk7Cgl9LAoJY29udGVudHM6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpZnJhbWUiICkgPwoJCQllbGVtLmNvbnRlbnREb2N1bWVudCB8fCBlbGVtLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQgOgoJCQlqUXVlcnkubWVyZ2UoIFtdLCBlbGVtLmNoaWxkTm9kZXMgKTsKCX0KfSwgZnVuY3Rpb24oIG5hbWUsIGZuICkgewoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggdW50aWwsIHNlbGVjdG9yICkgewoJCXZhciByZXQgPSBqUXVlcnkubWFwKCB0aGlzLCBmbiwgdW50aWwgKTsKCgkJaWYgKCAhcnVudGlsLnRlc3QoIG5hbWUgKSApIHsKCQkJc2VsZWN0b3IgPSB1bnRpbDsKCQl9CgoJCWlmICggc2VsZWN0b3IgJiYgdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJcmV0ID0galF1ZXJ5LmZpbHRlciggc2VsZWN0b3IsIHJldCApOwoJCX0KCgkJcmV0ID0gdGhpcy5sZW5ndGggPiAxICYmICFndWFyYW50ZWVkVW5pcXVlWyBuYW1lIF0gPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldDsKCgkJaWYgKCB0aGlzLmxlbmd0aCA+IDEgJiYgcnBhcmVudHNwcmV2LnRlc3QoIG5hbWUgKSApIHsKCQkJcmV0ID0gcmV0LnJldmVyc2UoKTsKCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7Cgl9Owp9KTsKCmpRdWVyeS5leHRlbmQoewoJZmlsdGVyOiBmdW5jdGlvbiggZXhwciwgZWxlbXMsIG5vdCApIHsKCQlpZiAoIG5vdCApIHsKCQkJZXhwciA9ICI6bm90KCIgKyBleHByICsgIikiOwoJCX0KCgkJcmV0dXJuIGVsZW1zLmxlbmd0aCA9PT0gMSA/CgkJCWpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihlbGVtc1swXSwgZXhwcikgPyBbIGVsZW1zWzBdIF0gOiBbXSA6CgkJCWpRdWVyeS5maW5kLm1hdGNoZXMoZXhwciwgZWxlbXMpOwoJfSwKCglkaXI6IGZ1bmN0aW9uKCBlbGVtLCBkaXIsIHVudGlsICkgewoJCXZhciBtYXRjaGVkID0gW10sCgkJCWN1ciA9IGVsZW1bIGRpciBdOwoKCQl3aGlsZSAoIGN1ciAmJiBjdXIubm9kZVR5cGUgIT09IDkgJiYgKHVudGlsID09PSB1bmRlZmluZWQgfHwgY3VyLm5vZGVUeXBlICE9PSAxIHx8ICFqUXVlcnkoIGN1ciApLmlzKCB1bnRpbCApKSApIHsKCQkJaWYgKCBjdXIubm9kZVR5cGUgPT09IDEgKSB7CgkJCQltYXRjaGVkLnB1c2goIGN1ciApOwoJCQl9CgkJCWN1ciA9IGN1cltkaXJdOwoJCX0KCQlyZXR1cm4gbWF0Y2hlZDsKCX0sCgoJc2libGluZzogZnVuY3Rpb24oIG4sIGVsZW0gKSB7CgkJdmFyIHIgPSBbXTsKCgkJZm9yICggOyBuOyBuID0gbi5uZXh0U2libGluZyApIHsKCQkJaWYgKCBuLm5vZGVUeXBlID09PSAxICYmIG4gIT09IGVsZW0gKSB7CgkJCQlyLnB1c2goIG4gKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHI7Cgl9Cn0pOwoKLy8gSW1wbGVtZW50IHRoZSBpZGVudGljYWwgZnVuY3Rpb25hbGl0eSBmb3IgZmlsdGVyIGFuZCBub3QKZnVuY3Rpb24gd2lubm93KCBlbGVtZW50cywgcXVhbGlmaWVyLCBrZWVwICkgewoKCS8vIENhbid0IHBhc3MgbnVsbCBvciB1bmRlZmluZWQgdG8gaW5kZXhPZiBpbiBGaXJlZm94IDQKCS8vIFNldCB0byAwIHRvIHNraXAgc3RyaW5nIGNoZWNrCglxdWFsaWZpZXIgPSBxdWFsaWZpZXIgfHwgMDsKCglpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBxdWFsaWZpZXIgKSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQl2YXIgcmV0VmFsID0gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCQlyZXR1cm4gcmV0VmFsID09PSBrZWVwOwoJCX0pOwoKCX0gZWxzZSBpZiAoIHF1YWxpZmllci5ub2RlVHlwZSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gKCBlbGVtID09PSBxdWFsaWZpZXIgKSA9PT0ga2VlcDsKCQl9KTsKCgl9IGVsc2UgaWYgKCB0eXBlb2YgcXVhbGlmaWVyID09PSAic3RyaW5nIiApIHsKCQl2YXIgZmlsdGVyZWQgPSBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxOwoJCX0pOwoKCQlpZiAoIGlzU2ltcGxlLnRlc3QoIHF1YWxpZmllciApICkgewoJCQlyZXR1cm4galF1ZXJ5LmZpbHRlcihxdWFsaWZpZXIsIGZpbHRlcmVkLCAha2VlcCk7CgkJfSBlbHNlIHsKCQkJcXVhbGlmaWVyID0galF1ZXJ5LmZpbHRlciggcXVhbGlmaWVyLCBmaWx0ZXJlZCApOwoJCX0KCX0KCglyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiAoIGpRdWVyeS5pbkFycmF5KCBlbGVtLCBxdWFsaWZpZXIgKSA+PSAwICkgPT09IGtlZXA7Cgl9KTsKfQpmdW5jdGlvbiBjcmVhdGVTYWZlRnJhZ21lbnQoIGRvY3VtZW50ICkgewoJdmFyIGxpc3QgPSBub2RlTmFtZXMuc3BsaXQoICJ8IiApLAoJCXNhZmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwoKCWlmICggc2FmZUZyYWcuY3JlYXRlRWxlbWVudCApIHsKCQl3aGlsZSAoIGxpc3QubGVuZ3RoICkgewoJCQlzYWZlRnJhZy5jcmVhdGVFbGVtZW50KAoJCQkJbGlzdC5wb3AoKQoJCQkpOwoJCX0KCX0KCXJldHVybiBzYWZlRnJhZzsKfQoKdmFyIG5vZGVOYW1lcyA9ICJhYmJyfGFydGljbGV8YXNpZGV8YXVkaW98YmRpfGNhbnZhc3xkYXRhfGRhdGFsaXN0fGRldGFpbHN8ZmlnY2FwdGlvbnxmaWd1cmV8Zm9vdGVyfCIgKwoJCSJoZWFkZXJ8aGdyb3VwfG1hcmt8bWV0ZXJ8bmF2fG91dHB1dHxwcm9ncmVzc3xzZWN0aW9ufHN1bW1hcnl8dGltZXx2aWRlbyIsCglyaW5saW5lalF1ZXJ5ID0gLyBqUXVlcnlcZCs9Iig/Om51bGx8XGQrKSIvZywKCXJub3NoaW1jYWNoZSA9IG5ldyBSZWdFeHAoIjwoPzoiICsgbm9kZU5hbWVzICsgIilbXFxzLz5dIiwgImkiKSwKCXJsZWFkaW5nV2hpdGVzcGFjZSA9IC9eXHMrLywKCXJ4aHRtbFRhZyA9IC88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcdzpdKylbXj5dKilcLz4vZ2ksCglydGFnTmFtZSA9IC88KFtcdzpdKykvLAoJcnRib2R5ID0gLzx0Ym9keS9pLAoJcmh0bWwgPSAvPHwmIz9cdys7LywKCXJub0lubmVyaHRtbCA9IC88KD86c2NyaXB0fHN0eWxlfGxpbmspL2ksCgltYW5pcHVsYXRpb25fcmNoZWNrYWJsZVR5cGUgPSAvXig/OmNoZWNrYm94fHJhZGlvKSQvaSwKCS8vIGNoZWNrZWQ9ImNoZWNrZWQiIG9yIGNoZWNrZWQKCXJjaGVja2VkID0gL2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksCglyc2NyaXB0VHlwZSA9IC9eJHxcLyg/OmphdmF8ZWNtYSlzY3JpcHQvaSwKCXJzY3JpcHRUeXBlTWFza2VkID0gL150cnVlXC8oLiopLywKCXJjbGVhblNjcmlwdCA9IC9eXHMqPCEoPzpcW0NEQVRBXFt8LS0pfCg/OlxdXF18LS0pPlxzKiQvZywKCgkvLyBXZSBoYXZlIHRvIGNsb3NlIHRoZXNlIHRhZ3MgdG8gc3VwcG9ydCBYSFRNTCAoIzEzMjAwKQoJd3JhcE1hcCA9IHsKCQlvcHRpb246IFsgMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+IiBdLAoJCWxlZ2VuZDogWyAxLCAiPGZpZWxkc2V0PiIsICI8L2ZpZWxkc2V0PiIgXSwKCQlhcmVhOiBbIDEsICI8bWFwPiIsICI8L21hcD4iIF0sCgkJcGFyYW06IFsgMSwgIjxvYmplY3Q+IiwgIjwvb2JqZWN0PiIgXSwKCQl0aGVhZDogWyAxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiIgXSwKCQl0cjogWyAyLCAiPHRhYmxlPjx0Ym9keT4iLCAiPC90Ym9keT48L3RhYmxlPiIgXSwKCQljb2w6IFsgMiwgIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0sCgkJdGQ6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCgoJCS8vIElFNi04IGNhbid0IHNlcmlhbGl6ZSBsaW5rLCBzY3JpcHQsIHN0eWxlLCBvciBhbnkgaHRtbDUgKE5vU2NvcGUpIHRhZ3MsCgkJLy8gdW5sZXNzIHdyYXBwZWQgaW4gYSBkaXYgd2l0aCBub24tYnJlYWtpbmcgY2hhcmFjdGVycyBpbiBmcm9udCBvZiBpdC4KCQlfZGVmYXVsdDogalF1ZXJ5LnN1cHBvcnQuaHRtbFNlcmlhbGl6ZSA/IFsgMCwgIiIsICIiIF0gOiBbIDEsICJYPGRpdj4iLCAiPC9kaXY+IiAgXQoJfSwKCXNhZmVGcmFnbWVudCA9IGNyZWF0ZVNhZmVGcmFnbWVudCggZG9jdW1lbnQgKSwKCWZyYWdtZW50RGl2ID0gc2FmZUZyYWdtZW50LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSApOwoKd3JhcE1hcC5vcHRncm91cCA9IHdyYXBNYXAub3B0aW9uOwp3cmFwTWFwLnRib2R5ID0gd3JhcE1hcC50Zm9vdCA9IHdyYXBNYXAuY29sZ3JvdXAgPSB3cmFwTWFwLmNhcHRpb24gPSB3cmFwTWFwLnRoZWFkOwp3cmFwTWFwLnRoID0gd3JhcE1hcC50ZDsKCmpRdWVyeS5mbi5leHRlbmQoewoJdGV4dDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8KCQkJCWpRdWVyeS50ZXh0KCB0aGlzICkgOgoJCQkJdGhpcy5lbXB0eSgpLmFwcGVuZCggKCB0aGlzWzBdICYmIHRoaXNbMF0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCApLmNyZWF0ZVRleHROb2RlKCB2YWx1ZSApICk7CgkJfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsKCX0sCgoJd3JhcEFsbDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJCWpRdWVyeSh0aGlzKS53cmFwQWxsKCBodG1sLmNhbGwodGhpcywgaSkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHRoaXNbMF0gKSB7CgkJCS8vIFRoZSBlbGVtZW50cyB0byB3cmFwIHRoZSB0YXJnZXQgYXJvdW5kCgkJCXZhciB3cmFwID0galF1ZXJ5KCBodG1sLCB0aGlzWzBdLm93bmVyRG9jdW1lbnQgKS5lcSgwKS5jbG9uZSh0cnVlKTsKCgkJCWlmICggdGhpc1swXS5wYXJlbnROb2RlICkgewoJCQkJd3JhcC5pbnNlcnRCZWZvcmUoIHRoaXNbMF0gKTsKCQkJfQoKCQkJd3JhcC5tYXAoZnVuY3Rpb24oKSB7CgkJCQl2YXIgZWxlbSA9IHRoaXM7CgoJCQkJd2hpbGUgKCBlbGVtLmZpcnN0Q2hpbGQgJiYgZWxlbS5maXJzdENoaWxkLm5vZGVUeXBlID09PSAxICkgewoJCQkJCWVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7CgkJCQl9CgoJCQkJcmV0dXJuIGVsZW07CgkJCX0pLmFwcGVuZCggdGhpcyApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXdyYXBJbm5lcjogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJCWpRdWVyeSh0aGlzKS53cmFwSW5uZXIoIGh0bWwuY2FsbCh0aGlzLCBpKSApOwoJCQl9KTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBzZWxmID0galF1ZXJ5KCB0aGlzICksCgkJCQljb250ZW50cyA9IHNlbGYuY29udGVudHMoKTsKCgkJCWlmICggY29udGVudHMubGVuZ3RoICkgewoJCQkJY29udGVudHMud3JhcEFsbCggaHRtbCApOwoKCQkJfSBlbHNlIHsKCQkJCXNlbGYuYXBwZW5kKCBodG1sICk7CgkJCX0KCQl9KTsKCX0sCgoJd3JhcDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJdmFyIGlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApOwoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaXNGdW5jdGlvbiA/IGh0bWwuY2FsbCh0aGlzLCBpKSA6IGh0bWwgKTsKCQl9KTsKCX0sCgoJdW53cmFwOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJib2R5IiApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVwbGFjZVdpdGgoIHRoaXMuY2hpbGROb2RlcyApOwoJCQl9CgkJfSkuZW5kKCk7Cgl9LAoKCWFwcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQl0aGlzLmFwcGVuZENoaWxkKCBlbGVtICk7CgkJCX0KCQl9KTsKCX0sCgoJcHJlcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQl0aGlzLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5maXJzdENoaWxkICk7CgkJCX0KCQl9KTsKCX0sCgoJYmVmb3JlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmYWxzZSwgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcyApOwoJCQl9CgkJfSk7Cgl9LAoKCWFmdGVyOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmYWxzZSwgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOwoJCQl9CgkJfSk7Cgl9LAoKCS8vIGtlZXBEYXRhIGlzIGZvciBpbnRlcm5hbCB1c2Ugb25seS0tZG8gbm90IGRvY3VtZW50CglyZW1vdmU6IGZ1bmN0aW9uKCBzZWxlY3Rvciwga2VlcERhdGEgKSB7CgkJdmFyIGVsZW0sCgkJCWkgPSAwOwoKCQlmb3IgKCA7IChlbGVtID0gdGhpc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQlpZiAoICFzZWxlY3RvciB8fCBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgWyBlbGVtIF0gKS5sZW5ndGggPiAwICkgewoJCQkJaWYgKCAha2VlcERhdGEgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0gKSApOwoJCQkJfQoKCQkJCWlmICggZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCWlmICgga2VlcERhdGEgJiYgalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCQkJc2V0R2xvYmFsRXZhbCggZ2V0QWxsKCBlbGVtLCAic2NyaXB0IiApICk7CgkJCQkJfQoJCQkJCWVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZWxlbSApOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZW1wdHk6IGZ1bmN0aW9uKCkgewoJCXZhciBlbGVtLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJLy8gUmVtb3ZlIGVsZW1lbnQgbm9kZXMgYW5kIHByZXZlbnQgbWVtb3J5IGxlYWtzCgkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGdldEFsbCggZWxlbSwgZmFsc2UgKSApOwoJCQl9CgoJCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoJCQl3aGlsZSAoIGVsZW0uZmlyc3RDaGlsZCApIHsKCQkJCWVsZW0ucmVtb3ZlQ2hpbGQoIGVsZW0uZmlyc3RDaGlsZCApOwoJCQl9CgoJCQkvLyBJZiB0aGlzIGlzIGEgc2VsZWN0LCBlbnN1cmUgdGhhdCBpdCBkaXNwbGF5cyBlbXB0eSAoIzEyMzM2KQoJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCWlmICggZWxlbS5vcHRpb25zICYmIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgInNlbGVjdCIgKSApIHsKCQkJCWVsZW0ub3B0aW9ucy5sZW5ndGggPSAwOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQlkYXRhQW5kRXZlbnRzID0gZGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZmFsc2UgOiBkYXRhQW5kRXZlbnRzOwoJCWRlZXBEYXRhQW5kRXZlbnRzID0gZGVlcERhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGRhdGFBbmRFdmVudHMgOiBkZWVwRGF0YUFuZEV2ZW50czsKCgkJcmV0dXJuIHRoaXMubWFwKCBmdW5jdGlvbiAoKSB7CgkJCXJldHVybiBqUXVlcnkuY2xvbmUoIHRoaXMsIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzICk7CgkJfSk7Cgl9LAoKCWh0bWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgZWxlbSA9IHRoaXNbMF0gfHwge30sCgkJCQlpID0gMCwKCQkJCWwgPSB0aGlzLmxlbmd0aDsKCgkJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxID8KCQkJCQllbGVtLmlubmVySFRNTC5yZXBsYWNlKCByaW5saW5lalF1ZXJ5LCAiIiApIDoKCQkJCQl1bmRlZmluZWQ7CgkJCX0KCgkJCS8vIFNlZSBpZiB3ZSBjYW4gdGFrZSBhIHNob3J0Y3V0IGFuZCBqdXN0IHVzZSBpbm5lckhUTUwKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmICFybm9Jbm5lcmh0bWwudGVzdCggdmFsdWUgKSAmJgoJCQkJKCBqUXVlcnkuc3VwcG9ydC5odG1sU2VyaWFsaXplIHx8ICFybm9zaGltY2FjaGUudGVzdCggdmFsdWUgKSAgKSAmJgoJCQkJKCBqUXVlcnkuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSB8fCAhcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIHZhbHVlICkgKSAmJgoJCQkJIXdyYXBNYXBbICggcnRhZ05hbWUuZXhlYyggdmFsdWUgKSB8fCBbIiIsICIiXSApWzFdLnRvTG93ZXJDYXNlKCkgXSApIHsKCgkJCQl2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoIHJ4aHRtbFRhZywgIjwkMT48LyQyPiIgKTsKCgkJCQl0cnkgewoJCQkJCWZvciAoOyBpIDwgbDsgaSsrICkgewoJCQkJCQkvLyBSZW1vdmUgZWxlbWVudCBub2RlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3MKCQkJCQkJZWxlbSA9IHRoaXNbaV0gfHwge307CgkJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGdldEFsbCggZWxlbSwgZmFsc2UgKSApOwoJCQkJCQkJZWxlbS5pbm5lckhUTUwgPSB2YWx1ZTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJZWxlbSA9IDA7CgoJCQkJLy8gSWYgdXNpbmcgaW5uZXJIVE1MIHRocm93cyBhbiBleGNlcHRpb24sIHVzZSB0aGUgZmFsbGJhY2sgbWV0aG9kCgkJCQl9IGNhdGNoKGUpIHt9CgkJCX0KCgkJCWlmICggZWxlbSApIHsKCQkJCXRoaXMuZW1wdHkoKS5hcHBlbmQoIHZhbHVlICk7CgkJCX0KCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCApOwoJfSwKCglyZXBsYWNlV2l0aDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXZhciBpc0Z1bmMgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGVsZW1lbnRzIGFyZSByZW1vdmVkIGZyb20gdGhlIERPTSBiZWZvcmUgdGhleSBhcmUgaW5zZXJ0ZWQKCQkvLyB0aGlzIGNhbiBoZWxwIGZpeCByZXBsYWNpbmcgYSBwYXJlbnQgd2l0aCBjaGlsZCBlbGVtZW50cwoJCWlmICggIWlzRnVuYyAmJiB0eXBlb2YgdmFsdWUgIT09ICJzdHJpbmciICkgewoJCQl2YWx1ZSA9IGpRdWVyeSggdmFsdWUgKS5ub3QoIHRoaXMgKS5kZXRhY2goKTsKCQl9CgoJCXJldHVybiB0aGlzLmRvbU1hbmlwKCBbIHZhbHVlIF0sIHRydWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmV4dCA9IHRoaXMubmV4dFNpYmxpbmcsCgkJCQlwYXJlbnQgPSB0aGlzLnBhcmVudE5vZGU7CgoJCQlpZiAoIHBhcmVudCApIHsKCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZSgpOwoJCQkJcGFyZW50Lmluc2VydEJlZm9yZSggZWxlbSwgbmV4dCApOwoJCQl9CgkJfSk7Cgl9LAoKCWRldGFjaDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0aGlzLnJlbW92ZSggc2VsZWN0b3IsIHRydWUgKTsKCX0sCgoJZG9tTWFuaXA6IGZ1bmN0aW9uKCBhcmdzLCB0YWJsZSwgY2FsbGJhY2sgKSB7CgoJCS8vIEZsYXR0ZW4gYW55IG5lc3RlZCBhcnJheXMKCQlhcmdzID0gY29yZV9jb25jYXQuYXBwbHkoIFtdLCBhcmdzICk7CgoJCXZhciBmaXJzdCwgbm9kZSwgaGFzU2NyaXB0cywKCQkJc2NyaXB0cywgZG9jLCBmcmFnbWVudCwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aCwKCQkJc2V0ID0gdGhpcywKCQkJaU5vQ2xvbmUgPSBsIC0gMSwKCQkJdmFsdWUgPSBhcmdzWzBdLAoJCQlpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICk7CgoJCS8vIFdlIGNhbid0IGNsb25lTm9kZSBmcmFnbWVudHMgdGhhdCBjb250YWluIGNoZWNrZWQsIGluIFdlYktpdAoJCWlmICggaXNGdW5jdGlvbiB8fCAhKCBsIDw9IDEgfHwgdHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIiB8fCBqUXVlcnkuc3VwcG9ydC5jaGVja0Nsb25lIHx8ICFyY2hlY2tlZC50ZXN0KCB2YWx1ZSApICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGluZGV4ICkgewoJCQkJdmFyIHNlbGYgPSBzZXQuZXEoIGluZGV4ICk7CgkJCQlpZiAoIGlzRnVuY3Rpb24gKSB7CgkJCQkJYXJnc1swXSA9IHZhbHVlLmNhbGwoIHRoaXMsIGluZGV4LCB0YWJsZSA/IHNlbGYuaHRtbCgpIDogdW5kZWZpbmVkICk7CgkJCQl9CgkJCQlzZWxmLmRvbU1hbmlwKCBhcmdzLCB0YWJsZSwgY2FsbGJhY2sgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIGwgKSB7CgkJCWZyYWdtZW50ID0galF1ZXJ5LmJ1aWxkRnJhZ21lbnQoIGFyZ3MsIHRoaXNbIDAgXS5vd25lckRvY3VtZW50LCBmYWxzZSwgdGhpcyApOwoJCQlmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgoJCQlpZiAoIGZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICkgewoJCQkJZnJhZ21lbnQgPSBmaXJzdDsKCQkJfQoKCQkJaWYgKCBmaXJzdCApIHsKCQkJCXRhYmxlID0gdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBmaXJzdCwgInRyIiApOwoJCQkJc2NyaXB0cyA9IGpRdWVyeS5tYXAoIGdldEFsbCggZnJhZ21lbnQsICJzY3JpcHQiICksIGRpc2FibGVTY3JpcHQgKTsKCQkJCWhhc1NjcmlwdHMgPSBzY3JpcHRzLmxlbmd0aDsKCgkJCQkvLyBVc2UgdGhlIG9yaWdpbmFsIGZyYWdtZW50IGZvciB0aGUgbGFzdCBpdGVtIGluc3RlYWQgb2YgdGhlIGZpcnN0IGJlY2F1c2UgaXQgY2FuIGVuZCB1cAoJCQkJLy8gYmVpbmcgZW1wdGllZCBpbmNvcnJlY3RseSBpbiBjZXJ0YWluIHNpdHVhdGlvbnMgKCM4MDcwKS4KCQkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJCQlub2RlID0gZnJhZ21lbnQ7CgoJCQkJCWlmICggaSAhPT0gaU5vQ2xvbmUgKSB7CgkJCQkJCW5vZGUgPSBqUXVlcnkuY2xvbmUoIG5vZGUsIHRydWUsIHRydWUgKTsKCgkJCQkJCS8vIEtlZXAgcmVmZXJlbmNlcyB0byBjbG9uZWQgc2NyaXB0cyBmb3IgbGF0ZXIgcmVzdG9yYXRpb24KCQkJCQkJaWYgKCBoYXNTY3JpcHRzICkgewoJCQkJCQkJalF1ZXJ5Lm1lcmdlKCBzY3JpcHRzLCBnZXRBbGwoIG5vZGUsICJzY3JpcHQiICkgKTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJY2FsbGJhY2suY2FsbCgKCQkJCQkJdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzW2ldLCAidGFibGUiICkgPwoJCQkJCQkJZmluZE9yQXBwZW5kKCB0aGlzW2ldLCAidGJvZHkiICkgOgoJCQkJCQkJdGhpc1tpXSwKCQkJCQkJbm9kZSwKCQkJCQkJaQoJCQkJCSk7CgkJCQl9CgoJCQkJaWYgKCBoYXNTY3JpcHRzICkgewoJCQkJCWRvYyA9IHNjcmlwdHNbIHNjcmlwdHMubGVuZ3RoIC0gMSBdLm93bmVyRG9jdW1lbnQ7CgoJCQkJCS8vIFJlZW5hYmxlIHNjcmlwdHMKCQkJCQlqUXVlcnkubWFwKCBzY3JpcHRzLCByZXN0b3JlU2NyaXB0ICk7CgoJCQkJCS8vIEV2YWx1YXRlIGV4ZWN1dGFibGUgc2NyaXB0cyBvbiBmaXJzdCBkb2N1bWVudCBpbnNlcnRpb24KCQkJCQlmb3IgKCBpID0gMDsgaSA8IGhhc1NjcmlwdHM7IGkrKyApIHsKCQkJCQkJbm9kZSA9IHNjcmlwdHNbIGkgXTsKCQkJCQkJaWYgKCByc2NyaXB0VHlwZS50ZXN0KCBub2RlLnR5cGUgfHwgIiIgKSAmJgoJCQkJCQkJIWpRdWVyeS5fZGF0YSggbm9kZSwgImdsb2JhbEV2YWwiICkgJiYgalF1ZXJ5LmNvbnRhaW5zKCBkb2MsIG5vZGUgKSApIHsKCgkJCQkJCQlpZiAoIG5vZGUuc3JjICkgewoJCQkJCQkJCS8vIEhvcGUgYWpheCBpcyBhdmFpbGFibGUuLi4KCQkJCQkJCQlqUXVlcnkuYWpheCh7CgkJCQkJCQkJCXVybDogbm9kZS5zcmMsCgkJCQkJCQkJCXR5cGU6ICJHRVQiLAoJCQkJCQkJCQlkYXRhVHlwZTogInNjcmlwdCIsCgkJCQkJCQkJCWFzeW5jOiBmYWxzZSwKCQkJCQkJCQkJZ2xvYmFsOiBmYWxzZSwKCQkJCQkJCQkJInRocm93cyI6IHRydWUKCQkJCQkJCQl9KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJalF1ZXJ5Lmdsb2JhbEV2YWwoICggbm9kZS50ZXh0IHx8IG5vZGUudGV4dENvbnRlbnQgfHwgbm9kZS5pbm5lckhUTUwgfHwgIiIgKS5yZXBsYWNlKCByY2xlYW5TY3JpcHQsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBGaXggIzExODA5OiBBdm9pZCBsZWFraW5nIG1lbW9yeQoJCQkJZnJhZ21lbnQgPSBmaXJzdCA9IG51bGw7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfQp9KTsKCmZ1bmN0aW9uIGZpbmRPckFwcGVuZCggZWxlbSwgdGFnICkgewoJcmV0dXJuIGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApWzBdIHx8IGVsZW0uYXBwZW5kQ2hpbGQoIGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCB0YWcgKSApOwp9CgovLyBSZXBsYWNlL3Jlc3RvcmUgdGhlIHR5cGUgYXR0cmlidXRlIG9mIHNjcmlwdCBlbGVtZW50cyBmb3Igc2FmZSBET00gbWFuaXB1bGF0aW9uCmZ1bmN0aW9uIGRpc2FibGVTY3JpcHQoIGVsZW0gKSB7Cgl2YXIgYXR0ciA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSgidHlwZSIpOwoJZWxlbS50eXBlID0gKCBhdHRyICYmIGF0dHIuc3BlY2lmaWVkICkgKyAiLyIgKyBlbGVtLnR5cGU7CglyZXR1cm4gZWxlbTsKfQpmdW5jdGlvbiByZXN0b3JlU2NyaXB0KCBlbGVtICkgewoJdmFyIG1hdGNoID0gcnNjcmlwdFR5cGVNYXNrZWQuZXhlYyggZWxlbS50eXBlICk7CglpZiAoIG1hdGNoICkgewoJCWVsZW0udHlwZSA9IG1hdGNoWzFdOwoJfSBlbHNlIHsKCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSgidHlwZSIpOwoJfQoJcmV0dXJuIGVsZW07Cn0KCi8vIE1hcmsgc2NyaXB0cyBhcyBoYXZpbmcgYWxyZWFkeSBiZWVuIGV2YWx1YXRlZApmdW5jdGlvbiBzZXRHbG9iYWxFdmFsKCBlbGVtcywgcmVmRWxlbWVudHMgKSB7Cgl2YXIgZWxlbSwKCQlpID0gMDsKCWZvciAoIDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCWpRdWVyeS5fZGF0YSggZWxlbSwgImdsb2JhbEV2YWwiLCAhcmVmRWxlbWVudHMgfHwgalF1ZXJ5Ll9kYXRhKCByZWZFbGVtZW50c1tpXSwgImdsb2JhbEV2YWwiICkgKTsKCX0KfQoKZnVuY3Rpb24gY2xvbmVDb3B5RXZlbnQoIHNyYywgZGVzdCApIHsKCglpZiAoIGRlc3Qubm9kZVR5cGUgIT09IDEgfHwgIWpRdWVyeS5oYXNEYXRhKCBzcmMgKSApIHsKCQlyZXR1cm47Cgl9CgoJdmFyIHR5cGUsIGksIGwsCgkJb2xkRGF0YSA9IGpRdWVyeS5fZGF0YSggc3JjICksCgkJY3VyRGF0YSA9IGpRdWVyeS5fZGF0YSggZGVzdCwgb2xkRGF0YSApLAoJCWV2ZW50cyA9IG9sZERhdGEuZXZlbnRzOwoKCWlmICggZXZlbnRzICkgewoJCWRlbGV0ZSBjdXJEYXRhLmhhbmRsZTsKCQljdXJEYXRhLmV2ZW50cyA9IHt9OwoKCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJZm9yICggaSA9IDAsIGwgPSBldmVudHNbIHR5cGUgXS5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQlqUXVlcnkuZXZlbnQuYWRkKCBkZXN0LCB0eXBlLCBldmVudHNbIHR5cGUgXVsgaSBdICk7CgkJCX0KCQl9Cgl9CgoJLy8gbWFrZSB0aGUgY2xvbmVkIHB1YmxpYyBkYXRhIG9iamVjdCBhIGNvcHkgZnJvbSB0aGUgb3JpZ2luYWwKCWlmICggY3VyRGF0YS5kYXRhICkgewoJCWN1ckRhdGEuZGF0YSA9IGpRdWVyeS5leHRlbmQoIHt9LCBjdXJEYXRhLmRhdGEgKTsKCX0KfQoKZnVuY3Rpb24gZml4Q2xvbmVOb2RlSXNzdWVzKCBzcmMsIGRlc3QgKSB7Cgl2YXIgbm9kZU5hbWUsIGUsIGRhdGE7CgoJLy8gV2UgZG8gbm90IG5lZWQgdG8gZG8gYW55dGhpbmcgZm9yIG5vbi1FbGVtZW50cwoJaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxICkgewoJCXJldHVybjsKCX0KCglub2RlTmFtZSA9IGRlc3Qubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCgkvLyBJRTYtOCBjb3BpZXMgZXZlbnRzIGJvdW5kIHZpYSBhdHRhY2hFdmVudCB3aGVuIHVzaW5nIGNsb25lTm9kZS4KCWlmICggIWpRdWVyeS5zdXBwb3J0Lm5vQ2xvbmVFdmVudCAmJiBkZXN0WyBqUXVlcnkuZXhwYW5kbyBdICkgewoJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIGRlc3QgKTsKCgkJZm9yICggZSBpbiBkYXRhLmV2ZW50cyApIHsKCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBkZXN0LCBlLCBkYXRhLmhhbmRsZSApOwoJCX0KCgkJLy8gRXZlbnQgZGF0YSBnZXRzIHJlZmVyZW5jZWQgaW5zdGVhZCBvZiBjb3BpZWQgaWYgdGhlIGV4cGFuZG8gZ2V0cyBjb3BpZWQgdG9vCgkJZGVzdC5yZW1vdmVBdHRyaWJ1dGUoIGpRdWVyeS5leHBhbmRvICk7Cgl9CgoJLy8gSUUgYmxhbmtzIGNvbnRlbnRzIHdoZW4gY2xvbmluZyBzY3JpcHRzLCBhbmQgdHJpZXMgdG8gZXZhbHVhdGUgbmV3bHktc2V0IHRleHQKCWlmICggbm9kZU5hbWUgPT09ICJzY3JpcHQiICYmIGRlc3QudGV4dCAhPT0gc3JjLnRleHQgKSB7CgkJZGlzYWJsZVNjcmlwdCggZGVzdCApLnRleHQgPSBzcmMudGV4dDsKCQlyZXN0b3JlU2NyaXB0KCBkZXN0ICk7CgoJLy8gSUU2LTEwIGltcHJvcGVybHkgY2xvbmVzIGNoaWxkcmVuIG9mIG9iamVjdCBlbGVtZW50cyB1c2luZyBjbGFzc2lkLgoJLy8gSUUxMCB0aHJvd3MgTm9Nb2RpZmljYXRpb25BbGxvd2VkRXJyb3IgaWYgcGFyZW50IGlzIG51bGwsICMxMjEzMi4KCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAib2JqZWN0IiApIHsKCQlpZiAoIGRlc3QucGFyZW50Tm9kZSApIHsKCQkJZGVzdC5vdXRlckhUTUwgPSBzcmMub3V0ZXJIVE1MOwoJCX0KCgkJLy8gVGhpcyBwYXRoIGFwcGVhcnMgdW5hdm9pZGFibGUgZm9yIElFOS4gV2hlbiBjbG9uaW5nIGFuIG9iamVjdAoJCS8vIGVsZW1lbnQgaW4gSUU5LCB0aGUgb3V0ZXJIVE1MIHN0cmF0ZWd5IGFib3ZlIGlzIG5vdCBzdWZmaWNpZW50LgoJCS8vIElmIHRoZSBzcmMgaGFzIGlubmVySFRNTCBhbmQgdGhlIGRlc3RpbmF0aW9uIGRvZXMgbm90LAoJCS8vIGNvcHkgdGhlIHNyYy5pbm5lckhUTUwgaW50byB0aGUgZGVzdC5pbm5lckhUTUwuICMxMDMyNAoJCWlmICggalF1ZXJ5LnN1cHBvcnQuaHRtbDVDbG9uZSAmJiAoIHNyYy5pbm5lckhUTUwgJiYgIWpRdWVyeS50cmltKGRlc3QuaW5uZXJIVE1MKSApICkgewoJCQlkZXN0LmlubmVySFRNTCA9IHNyYy5pbm5lckhUTUw7CgkJfQoKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAiaW5wdXQiICYmIG1hbmlwdWxhdGlvbl9yY2hlY2thYmxlVHlwZS50ZXN0KCBzcmMudHlwZSApICkgewoJCS8vIElFNi04IGZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3gKCQkvLyBvciByYWRpbyBidXR0b24uIFdvcnNlLCBJRTYtNyBmYWlsIHRvIGdpdmUgdGhlIGNsb25lZCBlbGVtZW50CgkJLy8gYSBjaGVja2VkIGFwcGVhcmFuY2UgaWYgdGhlIGRlZmF1bHRDaGVja2VkIHZhbHVlIGlzbid0IGFsc28gc2V0CgoJCWRlc3QuZGVmYXVsdENoZWNrZWQgPSBkZXN0LmNoZWNrZWQgPSBzcmMuY2hlY2tlZDsKCgkJLy8gSUU2LTcgZ2V0IGNvbmZ1c2VkIGFuZCBlbmQgdXAgc2V0dGluZyB0aGUgdmFsdWUgb2YgYSBjbG9uZWQKCQkvLyBjaGVja2JveC9yYWRpbyBidXR0b24gdG8gYW4gZW1wdHkgc3RyaW5nIGluc3RlYWQgb2YgIm9uIgoJCWlmICggZGVzdC52YWx1ZSAhPT0gc3JjLnZhbHVlICkgewoJCQlkZXN0LnZhbHVlID0gc3JjLnZhbHVlOwoJCX0KCgkvLyBJRTYtOCBmYWlscyB0byByZXR1cm4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0byB0aGUgZGVmYXVsdCBzZWxlY3RlZAoJLy8gc3RhdGUgd2hlbiBjbG9uaW5nIG9wdGlvbnMKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAib3B0aW9uIiApIHsKCQlkZXN0LmRlZmF1bHRTZWxlY3RlZCA9IGRlc3Quc2VsZWN0ZWQgPSBzcmMuZGVmYXVsdFNlbGVjdGVkOwoKCS8vIElFNi04IGZhaWxzIHRvIHNldCB0aGUgZGVmYXVsdFZhbHVlIHRvIHRoZSBjb3JyZWN0IHZhbHVlIHdoZW4KCS8vIGNsb25pbmcgb3RoZXIgdHlwZXMgb2YgaW5wdXQgZmllbGRzCgl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQlkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7Cgl9Cn0KCmpRdWVyeS5lYWNoKHsKCWFwcGVuZFRvOiAiYXBwZW5kIiwKCXByZXBlbmRUbzogInByZXBlbmQiLAoJaW5zZXJ0QmVmb3JlOiAiYmVmb3JlIiwKCWluc2VydEFmdGVyOiAiYWZ0ZXIiLAoJcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIgp9LCBmdW5jdGlvbiggbmFtZSwgb3JpZ2luYWwgKSB7CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgZWxlbXMsCgkJCWkgPSAwLAoJCQlyZXQgPSBbXSwKCQkJaW5zZXJ0ID0galF1ZXJ5KCBzZWxlY3RvciApLAoJCQlsYXN0ID0gaW5zZXJ0Lmxlbmd0aCAtIDE7CgoJCWZvciAoIDsgaSA8PSBsYXN0OyBpKysgKSB7CgkJCWVsZW1zID0gaSA9PT0gbGFzdCA/IHRoaXMgOiB0aGlzLmNsb25lKHRydWUpOwoJCQlqUXVlcnkoIGluc2VydFtpXSApWyBvcmlnaW5hbCBdKCBlbGVtcyApOwoKCQkJLy8gTW9kZXJuIGJyb3dzZXJzIGNhbiBhcHBseSBqUXVlcnkgY29sbGVjdGlvbnMgYXMgYXJyYXlzLCBidXQgb2xkSUUgbmVlZHMgYSAuZ2V0KCkKCQkJY29yZV9wdXNoLmFwcGx5KCByZXQsIGVsZW1zLmdldCgpICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldCApOwoJfTsKfSk7CgpmdW5jdGlvbiBnZXRBbGwoIGNvbnRleHQsIHRhZyApIHsKCXZhciBlbGVtcywgZWxlbSwKCQlpID0gMCwKCQlmb3VuZCA9IHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSBjb3JlX3N0cnVuZGVmaW5lZCA/IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyB8fCAiKiIgKSA6CgkJCXR5cGVvZiBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwgIT09IGNvcmVfc3RydW5kZWZpbmVkID8gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgfHwgIioiICkgOgoJCQl1bmRlZmluZWQ7CgoJaWYgKCAhZm91bmQgKSB7CgkJZm9yICggZm91bmQgPSBbXSwgZWxlbXMgPSBjb250ZXh0LmNoaWxkTm9kZXMgfHwgY29udGV4dDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQlpZiAoICF0YWcgfHwgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCB0YWcgKSApIHsKCQkJCWZvdW5kLnB1c2goIGVsZW0gKTsKCQkJfSBlbHNlIHsKCQkJCWpRdWVyeS5tZXJnZSggZm91bmQsIGdldEFsbCggZWxlbSwgdGFnICkgKTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gdGFnID09PSB1bmRlZmluZWQgfHwgdGFnICYmIGpRdWVyeS5ub2RlTmFtZSggY29udGV4dCwgdGFnICkgPwoJCWpRdWVyeS5tZXJnZSggWyBjb250ZXh0IF0sIGZvdW5kICkgOgoJCWZvdW5kOwp9CgovLyBVc2VkIGluIGJ1aWxkRnJhZ21lbnQsIGZpeGVzIHRoZSBkZWZhdWx0Q2hlY2tlZCBwcm9wZXJ0eQpmdW5jdGlvbiBmaXhEZWZhdWx0Q2hlY2tlZCggZWxlbSApIHsKCWlmICggbWFuaXB1bGF0aW9uX3JjaGVja2FibGVUeXBlLnRlc3QoIGVsZW0udHlwZSApICkgewoJCWVsZW0uZGVmYXVsdENoZWNrZWQgPSBlbGVtLmNoZWNrZWQ7Cgl9Cn0KCmpRdWVyeS5leHRlbmQoewoJY2xvbmU6IGZ1bmN0aW9uKCBlbGVtLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQl2YXIgZGVzdEVsZW1lbnRzLCBub2RlLCBjbG9uZSwgaSwgc3JjRWxlbWVudHMsCgkJCWluUGFnZSA9IGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgoJCWlmICggalF1ZXJ5LnN1cHBvcnQuaHRtbDVDbG9uZSB8fCBqUXVlcnkuaXNYTUxEb2MoZWxlbSkgfHwgIXJub3NoaW1jYWNoZS50ZXN0KCAiPCIgKyBlbGVtLm5vZGVOYW1lICsgIj4iICkgKSB7CgkJCWNsb25lID0gZWxlbS5jbG9uZU5vZGUoIHRydWUgKTsKCgkJLy8gSUU8PTggZG9lcyBub3QgcHJvcGVybHkgY2xvbmUgZGV0YWNoZWQsIHVua25vd24gZWxlbWVudCBub2RlcwoJCX0gZWxzZSB7CgkJCWZyYWdtZW50RGl2LmlubmVySFRNTCA9IGVsZW0ub3V0ZXJIVE1MOwoJCQlmcmFnbWVudERpdi5yZW1vdmVDaGlsZCggY2xvbmUgPSBmcmFnbWVudERpdi5maXJzdENoaWxkICk7CgkJfQoKCQlpZiAoICghalF1ZXJ5LnN1cHBvcnQubm9DbG9uZUV2ZW50IHx8ICFqUXVlcnkuc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCkgJiYKCQkJCShlbGVtLm5vZGVUeXBlID09PSAxIHx8IGVsZW0ubm9kZVR5cGUgPT09IDExKSAmJiAhalF1ZXJ5LmlzWE1MRG9jKGVsZW0pICkgewoKCQkJLy8gV2UgZXNjaGV3IFNpenpsZSBoZXJlIGZvciBwZXJmb3JtYW5jZSByZWFzb25zOiBodHRwOi8vanNwZXJmLmNvbS9nZXRhbGwtdnMtc2l6emxlLzIKCQkJZGVzdEVsZW1lbnRzID0gZ2V0QWxsKCBjbG9uZSApOwoJCQlzcmNFbGVtZW50cyA9IGdldEFsbCggZWxlbSApOwoKCQkJLy8gRml4IGFsbCBJRSBjbG9uaW5nIGlzc3VlcwoJCQlmb3IgKCBpID0gMDsgKG5vZGUgPSBzcmNFbGVtZW50c1tpXSkgIT0gbnVsbDsgKytpICkgewoJCQkJLy8gRW5zdXJlIHRoYXQgdGhlIGRlc3RpbmF0aW9uIG5vZGUgaXMgbm90IG51bGw7IEZpeGVzICM5NTg3CgkJCQlpZiAoIGRlc3RFbGVtZW50c1tpXSApIHsKCQkJCQlmaXhDbG9uZU5vZGVJc3N1ZXMoIG5vZGUsIGRlc3RFbGVtZW50c1tpXSApOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDb3B5IHRoZSBldmVudHMgZnJvbSB0aGUgb3JpZ2luYWwgdG8gdGhlIGNsb25lCgkJaWYgKCBkYXRhQW5kRXZlbnRzICkgewoJCQlpZiAoIGRlZXBEYXRhQW5kRXZlbnRzICkgewoJCQkJc3JjRWxlbWVudHMgPSBzcmNFbGVtZW50cyB8fCBnZXRBbGwoIGVsZW0gKTsKCQkJCWRlc3RFbGVtZW50cyA9IGRlc3RFbGVtZW50cyB8fCBnZXRBbGwoIGNsb25lICk7CgoJCQkJZm9yICggaSA9IDA7IChub2RlID0gc3JjRWxlbWVudHNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJCQljbG9uZUNvcHlFdmVudCggbm9kZSwgZGVzdEVsZW1lbnRzW2ldICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQljbG9uZUNvcHlFdmVudCggZWxlbSwgY2xvbmUgKTsKCQkJfQoJCX0KCgkJLy8gUHJlc2VydmUgc2NyaXB0IGV2YWx1YXRpb24gaGlzdG9yeQoJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUsICJzY3JpcHQiICk7CgkJaWYgKCBkZXN0RWxlbWVudHMubGVuZ3RoID4gMCApIHsKCQkJc2V0R2xvYmFsRXZhbCggZGVzdEVsZW1lbnRzLCAhaW5QYWdlICYmIGdldEFsbCggZWxlbSwgInNjcmlwdCIgKSApOwoJCX0KCgkJZGVzdEVsZW1lbnRzID0gc3JjRWxlbWVudHMgPSBub2RlID0gbnVsbDsKCgkJLy8gUmV0dXJuIHRoZSBjbG9uZWQgc2V0CgkJcmV0dXJuIGNsb25lOwoJfSwKCglidWlsZEZyYWdtZW50OiBmdW5jdGlvbiggZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbiApIHsKCQl2YXIgaiwgZWxlbSwgY29udGFpbnMsCgkJCXRtcCwgdGFnLCB0Ym9keSwgd3JhcCwKCQkJbCA9IGVsZW1zLmxlbmd0aCwKCgkJCS8vIEVuc3VyZSBhIHNhZmUgZnJhZ21lbnQKCQkJc2FmZSA9IGNyZWF0ZVNhZmVGcmFnbWVudCggY29udGV4dCApLAoKCQkJbm9kZXMgPSBbXSwKCQkJaSA9IDA7CgoJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJZWxlbSA9IGVsZW1zWyBpIF07CgoJCQlpZiAoIGVsZW0gfHwgZWxlbSA9PT0gMCApIHsKCgkJCQkvLyBBZGQgbm9kZXMgZGlyZWN0bHkKCQkJCWlmICggalF1ZXJ5LnR5cGUoIGVsZW0gKSA9PT0gIm9iamVjdCIgKSB7CgkJCQkJalF1ZXJ5Lm1lcmdlKCBub2RlcywgZWxlbS5ub2RlVHlwZSA/IFsgZWxlbSBdIDogZWxlbSApOwoKCQkJCS8vIENvbnZlcnQgbm9uLWh0bWwgaW50byBhIHRleHQgbm9kZQoJCQkJfSBlbHNlIGlmICggIXJodG1sLnRlc3QoIGVsZW0gKSApIHsKCQkJCQlub2Rlcy5wdXNoKCBjb250ZXh0LmNyZWF0ZVRleHROb2RlKCBlbGVtICkgKTsKCgkJCQkvLyBDb252ZXJ0IGh0bWwgaW50byBET00gbm9kZXMKCQkJCX0gZWxzZSB7CgkJCQkJdG1wID0gdG1wIHx8IHNhZmUuYXBwZW5kQ2hpbGQoIGNvbnRleHQuY3JlYXRlRWxlbWVudCgiZGl2IikgKTsKCgkJCQkJLy8gRGVzZXJpYWxpemUgYSBzdGFuZGFyZCByZXByZXNlbnRhdGlvbgoJCQkJCXRhZyA9ICggcnRhZ05hbWUuZXhlYyggZWxlbSApIHx8IFsiIiwgIiJdIClbMV0udG9Mb3dlckNhc2UoKTsKCQkJCQl3cmFwID0gd3JhcE1hcFsgdGFnIF0gfHwgd3JhcE1hcC5fZGVmYXVsdDsKCgkJCQkJdG1wLmlubmVySFRNTCA9IHdyYXBbMV0gKyBlbGVtLnJlcGxhY2UoIHJ4aHRtbFRhZywgIjwkMT48LyQyPiIgKSArIHdyYXBbMl07CgoJCQkJCS8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAoJCQkJCWogPSB3cmFwWzBdOwoJCQkJCXdoaWxlICggai0tICkgewoJCQkJCQl0bXAgPSB0bXAubGFzdENoaWxkOwoJCQkJCX0KCgkJCQkJLy8gTWFudWFsbHkgYWRkIGxlYWRpbmcgd2hpdGVzcGFjZSByZW1vdmVkIGJ5IElFCgkJCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UgJiYgcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIGVsZW0gKSApIHsKCQkJCQkJbm9kZXMucHVzaCggY29udGV4dC5jcmVhdGVUZXh0Tm9kZSggcmxlYWRpbmdXaGl0ZXNwYWNlLmV4ZWMoIGVsZW0gKVswXSApICk7CgkJCQkJfQoKCQkJCQkvLyBSZW1vdmUgSUUncyBhdXRvaW5zZXJ0ZWQgPHRib2R5PiBmcm9tIHRhYmxlIGZyYWdtZW50cwoJCQkJCWlmICggIWpRdWVyeS5zdXBwb3J0LnRib2R5ICkgewoKCQkJCQkJLy8gU3RyaW5nIHdhcyBhIDx0YWJsZT4sICptYXkqIGhhdmUgc3B1cmlvdXMgPHRib2R5PgoJCQkJCQllbGVtID0gdGFnID09PSAidGFibGUiICYmICFydGJvZHkudGVzdCggZWxlbSApID8KCQkJCQkJCXRtcC5maXJzdENoaWxkIDoKCgkJCQkJCQkvLyBTdHJpbmcgd2FzIGEgYmFyZSA8dGhlYWQ+IG9yIDx0Zm9vdD4KCQkJCQkJCXdyYXBbMV0gPT09ICI8dGFibGU+IiAmJiAhcnRib2R5LnRlc3QoIGVsZW0gKSA/CgkJCQkJCQkJdG1wIDoKCQkJCQkJCQkwOwoKCQkJCQkJaiA9IGVsZW0gJiYgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsKCQkJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggKHRib2R5ID0gZWxlbS5jaGlsZE5vZGVzW2pdKSwgInRib2R5IiApICYmICF0Ym9keS5jaGlsZE5vZGVzLmxlbmd0aCApIHsKCQkJCQkJCQllbGVtLnJlbW92ZUNoaWxkKCB0Ym9keSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoKCQkJCQlqUXVlcnkubWVyZ2UoIG5vZGVzLCB0bXAuY2hpbGROb2RlcyApOwoKCQkJCQkvLyBGaXggIzEyMzkyIGZvciBXZWJLaXQgYW5kIElFID4gOQoJCQkJCXRtcC50ZXh0Q29udGVudCA9ICIiOwoKCQkJCQkvLyBGaXggIzEyMzkyIGZvciBvbGRJRQoJCQkJCXdoaWxlICggdG1wLmZpcnN0Q2hpbGQgKSB7CgkJCQkJCXRtcC5yZW1vdmVDaGlsZCggdG1wLmZpcnN0Q2hpbGQgKTsKCQkJCQl9CgoJCQkJCS8vIFJlbWVtYmVyIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciBwcm9wZXIgY2xlYW51cAoJCQkJCXRtcCA9IHNhZmUubGFzdENoaWxkOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBGaXggIzExMzU2OiBDbGVhciBlbGVtZW50cyBmcm9tIGZyYWdtZW50CgkJaWYgKCB0bXAgKSB7CgkJCXNhZmUucmVtb3ZlQ2hpbGQoIHRtcCApOwoJCX0KCgkJLy8gUmVzZXQgZGVmYXVsdENoZWNrZWQgZm9yIGFueSByYWRpb3MgYW5kIGNoZWNrYm94ZXMKCQkvLyBhYm91dCB0byBiZSBhcHBlbmRlZCB0byB0aGUgRE9NIGluIElFIDYvNyAoIzgwNjApCgkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuYXBwZW5kQ2hlY2tlZCApIHsKCQkJalF1ZXJ5LmdyZXAoIGdldEFsbCggbm9kZXMsICJpbnB1dCIgKSwgZml4RGVmYXVsdENoZWNrZWQgKTsKCQl9CgoJCWkgPSAwOwoJCXdoaWxlICggKGVsZW0gPSBub2Rlc1sgaSsrIF0pICkgewoKCQkJLy8gIzQwODcgLSBJZiBvcmlnaW4gYW5kIGRlc3RpbmF0aW9uIGVsZW1lbnRzIGFyZSB0aGUgc2FtZSwgYW5kIHRoaXMgaXMKCQkJLy8gdGhhdCBlbGVtZW50LCBkbyBub3QgZG8gYW55dGhpbmcKCQkJaWYgKCBzZWxlY3Rpb24gJiYgalF1ZXJ5LmluQXJyYXkoIGVsZW0sIHNlbGVjdGlvbiApICE9PSAtMSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQljb250YWlucyA9IGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgoJCQkvLyBBcHBlbmQgdG8gZnJhZ21lbnQKCQkJdG1wID0gZ2V0QWxsKCBzYWZlLmFwcGVuZENoaWxkKCBlbGVtICksICJzY3JpcHQiICk7CgoJCQkvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CgkJCWlmICggY29udGFpbnMgKSB7CgkJCQlzZXRHbG9iYWxFdmFsKCB0bXAgKTsKCQkJfQoKCQkJLy8gQ2FwdHVyZSBleGVjdXRhYmxlcwoJCQlpZiAoIHNjcmlwdHMgKSB7CgkJCQlqID0gMDsKCQkJCXdoaWxlICggKGVsZW0gPSB0bXBbIGorKyBdKSApIHsKCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIGVsZW0udHlwZSB8fCAiIiApICkgewoJCQkJCQlzY3JpcHRzLnB1c2goIGVsZW0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXRtcCA9IG51bGw7CgoJCXJldHVybiBzYWZlOwoJfSwKCgljbGVhbkRhdGE6IGZ1bmN0aW9uKCBlbGVtcywgLyogaW50ZXJuYWwgKi8gYWNjZXB0RGF0YSApIHsKCQl2YXIgZWxlbSwgdHlwZSwgaWQsIGRhdGEsCgkJCWkgPSAwLAoJCQlpbnRlcm5hbEtleSA9IGpRdWVyeS5leHBhbmRvLAoJCQljYWNoZSA9IGpRdWVyeS5jYWNoZSwKCQkJZGVsZXRlRXhwYW5kbyA9IGpRdWVyeS5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8sCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgoJCQlpZiAoIGFjY2VwdERhdGEgfHwgalF1ZXJ5LmFjY2VwdERhdGEoIGVsZW0gKSApIHsKCgkJCQlpZCA9IGVsZW1bIGludGVybmFsS2V5IF07CgkJCQlkYXRhID0gaWQgJiYgY2FjaGVbIGlkIF07CgoJCQkJaWYgKCBkYXRhICkgewoJCQkJCWlmICggZGF0YS5ldmVudHMgKSB7CgkJCQkJCWZvciAoIHR5cGUgaW4gZGF0YS5ldmVudHMgKSB7CgkJCQkJCQlpZiAoIHNwZWNpYWxbIHR5cGUgXSApIHsKCQkJCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICk7CgoJCQkJCQkJLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGRhdGEuaGFuZGxlICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIFJlbW92ZSBjYWNoZSBvbmx5IGlmIGl0IHdhcyBub3QgYWxyZWFkeSByZW1vdmVkIGJ5IGpRdWVyeS5ldmVudC5yZW1vdmUKCQkJCQlpZiAoIGNhY2hlWyBpZCBdICkgewoKCQkJCQkJZGVsZXRlIGNhY2hlWyBpZCBdOwoKCQkJCQkJLy8gSUUgZG9lcyBub3QgYWxsb3cgdXMgdG8gZGVsZXRlIGV4cGFuZG8gcHJvcGVydGllcyBmcm9tIG5vZGVzLAoJCQkJCQkvLyBub3IgZG9lcyBpdCBoYXZlIGEgcmVtb3ZlQXR0cmlidXRlIGZ1bmN0aW9uIG9uIERvY3VtZW50IG5vZGVzOwoJCQkJCQkvLyB3ZSBtdXN0IGhhbmRsZSBhbGwgb2YgdGhlc2UgY2FzZXMKCQkJCQkJaWYgKCBkZWxldGVFeHBhbmRvICkgewoJCQkJCQkJZGVsZXRlIGVsZW1bIGludGVybmFsS2V5IF07CgoJCQkJCQl9IGVsc2UgaWYgKCB0eXBlb2YgZWxlbS5yZW1vdmVBdHRyaWJ1dGUgIT09IGNvcmVfc3RydW5kZWZpbmVkICkgewoJCQkJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGludGVybmFsS2V5ICk7CgoJCQkJCQl9IGVsc2UgewoJCQkJCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IG51bGw7CgkJCQkJCX0KCgkJCQkJCWNvcmVfZGVsZXRlZElkcy5wdXNoKCBpZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KfSk7CnZhciBpZnJhbWUsIGdldFN0eWxlcywgY3VyQ1NTLAoJcmFscGhhID0gL2FscGhhXChbXildKlwpL2ksCglyb3BhY2l0eSA9IC9vcGFjaXR5XHMqPVxzKihbXildKikvLAoJcnBvc2l0aW9uID0gL14odG9wfHJpZ2h0fGJvdHRvbXxsZWZ0KSQvLAoJLy8gc3dhcHBhYmxlIGlmIGRpc3BsYXkgaXMgbm9uZSBvciBzdGFydHMgd2l0aCB0YWJsZSBleGNlcHQgInRhYmxlIiwgInRhYmxlLWNlbGwiLCBvciAidGFibGUtY2FwdGlvbiIKCS8vIHNlZSBoZXJlIGZvciBkaXNwbGF5IHZhbHVlczogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9DU1MvZGlzcGxheQoJcmRpc3BsYXlzd2FwID0gL14obm9uZXx0YWJsZSg/IS1jW2VhXSkuKykvLAoJcm1hcmdpbiA9IC9ebWFyZ2luLywKCXJudW1zcGxpdCA9IG5ldyBSZWdFeHAoICJeKCIgKyBjb3JlX3BudW0gKyAiKSguKikkIiwgImkiICksCglybnVtbm9ucHggPSBuZXcgUmVnRXhwKCAiXigiICsgY29yZV9wbnVtICsgIikoPyFweClbYS16JV0rJCIsICJpIiApLAoJcnJlbE51bSA9IG5ldyBSZWdFeHAoICJeKFsrLV0pPSgiICsgY29yZV9wbnVtICsgIikiLCAiaSIgKSwKCWVsZW1kaXNwbGF5ID0geyBCT0RZOiAiYmxvY2siIH0sCgoJY3NzU2hvdyA9IHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2siIH0sCgljc3NOb3JtYWxUcmFuc2Zvcm0gPSB7CgkJbGV0dGVyU3BhY2luZzogMCwKCQlmb250V2VpZ2h0OiA0MDAKCX0sCgoJY3NzRXhwYW5kID0gWyAiVG9wIiwgIlJpZ2h0IiwgIkJvdHRvbSIsICJMZWZ0IiBdLAoJY3NzUHJlZml4ZXMgPSBbICJXZWJraXQiLCAiTyIsICJNb3oiLCAibXMiIF07CgovLyByZXR1cm4gYSBjc3MgcHJvcGVydHkgbWFwcGVkIHRvIGEgcG90ZW50aWFsbHkgdmVuZG9yIHByZWZpeGVkIHByb3BlcnR5CmZ1bmN0aW9uIHZlbmRvclByb3BOYW1lKCBzdHlsZSwgbmFtZSApIHsKCgkvLyBzaG9ydGN1dCBmb3IgbmFtZXMgdGhhdCBhcmUgbm90IHZlbmRvciBwcmVmaXhlZAoJaWYgKCBuYW1lIGluIHN0eWxlICkgewoJCXJldHVybiBuYW1lOwoJfQoKCS8vIGNoZWNrIGZvciB2ZW5kb3IgcHJlZml4ZWQgbmFtZXMKCXZhciBjYXBOYW1lID0gbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSksCgkJb3JpZ05hbWUgPSBuYW1lLAoJCWkgPSBjc3NQcmVmaXhlcy5sZW5ndGg7CgoJd2hpbGUgKCBpLS0gKSB7CgkJbmFtZSA9IGNzc1ByZWZpeGVzWyBpIF0gKyBjYXBOYW1lOwoJCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQkJcmV0dXJuIG5hbWU7CgkJfQoJfQoKCXJldHVybiBvcmlnTmFtZTsKfQoKZnVuY3Rpb24gaXNIaWRkZW4oIGVsZW0sIGVsICkgewoJLy8gaXNIaWRkZW4gbWlnaHQgYmUgY2FsbGVkIGZyb20galF1ZXJ5I2ZpbHRlciBmdW5jdGlvbjsKCS8vIGluIHRoYXQgY2FzZSwgZWxlbWVudCB3aWxsIGJlIHNlY29uZCBhcmd1bWVudAoJZWxlbSA9IGVsIHx8IGVsZW07CglyZXR1cm4galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgPT09ICJub25lIiB8fCAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKfQoKZnVuY3Rpb24gc2hvd0hpZGUoIGVsZW1lbnRzLCBzaG93ICkgewoJdmFyIGRpc3BsYXksIGVsZW0sIGhpZGRlbiwKCQl2YWx1ZXMgPSBbXSwKCQlpbmRleCA9IDAsCgkJbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoOwoKCWZvciAoIDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOwoJCWlmICggIWVsZW0uc3R5bGUgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCgkJdmFsdWVzWyBpbmRleCBdID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIgKTsKCQlkaXNwbGF5ID0gZWxlbS5zdHlsZS5kaXNwbGF5OwoJCWlmICggc2hvdyApIHsKCQkJLy8gUmVzZXQgdGhlIGlubGluZSBkaXNwbGF5IG9mIHRoaXMgZWxlbWVudCB0byBsZWFybiBpZiBpdCBpcwoJCQkvLyBiZWluZyBoaWRkZW4gYnkgY2FzY2FkZWQgcnVsZXMgb3Igbm90CgkJCWlmICggIXZhbHVlc1sgaW5kZXggXSAmJiBkaXNwbGF5ID09PSAibm9uZSIgKSB7CgkJCQllbGVtLnN0eWxlLmRpc3BsYXkgPSAiIjsKCQkJfQoKCQkJLy8gU2V0IGVsZW1lbnRzIHdoaWNoIGhhdmUgYmVlbiBvdmVycmlkZGVuIHdpdGggZGlzcGxheTogbm9uZQoJCQkvLyBpbiBhIHN0eWxlc2hlZXQgdG8gd2hhdGV2ZXIgdGhlIGRlZmF1bHQgYnJvd3NlciBzdHlsZSBpcwoJCQkvLyBmb3Igc3VjaCBhbiBlbGVtZW50CgkJCWlmICggZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiAmJiBpc0hpZGRlbiggZWxlbSApICkgewoJCQkJdmFsdWVzWyBpbmRleCBdID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIsIGNzc19kZWZhdWx0RGlzcGxheShlbGVtLm5vZGVOYW1lKSApOwoJCQl9CgkJfSBlbHNlIHsKCgkJCWlmICggIXZhbHVlc1sgaW5kZXggXSApIHsKCQkJCWhpZGRlbiA9IGlzSGlkZGVuKCBlbGVtICk7CgoJCQkJaWYgKCBkaXNwbGF5ICYmIGRpc3BsYXkgIT09ICJub25lIiB8fCAhaGlkZGVuICkgewoJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgIm9sZGRpc3BsYXkiLCBoaWRkZW4gPyBkaXNwbGF5IDogalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgKTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBTZXQgdGhlIGRpc3BsYXkgb2YgbW9zdCBvZiB0aGUgZWxlbWVudHMgaW4gYSBzZWNvbmQgbG9vcAoJLy8gdG8gYXZvaWQgdGhlIGNvbnN0YW50IHJlZmxvdwoJZm9yICggaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsKCQllbGVtID0gZWxlbWVudHNbIGluZGV4IF07CgkJaWYgKCAhZWxlbS5zdHlsZSApIHsKCQkJY29udGludWU7CgkJfQoJCWlmICggIXNob3cgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiApIHsKCQkJZWxlbS5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IHZhbHVlc1sgaW5kZXggXSB8fCAiIiA6ICJub25lIjsKCQl9Cgl9CgoJcmV0dXJuIGVsZW1lbnRzOwp9CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWNzczogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUgKSB7CgkJCXZhciBsZW4sIHN0eWxlcywKCQkJCW1hcCA9IHt9LAoJCQkJaSA9IDA7CgoJCQlpZiAoIGpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgkJCQlzdHlsZXMgPSBnZXRTdHlsZXMoIGVsZW0gKTsKCQkJCWxlbiA9IG5hbWUubGVuZ3RoOwoKCQkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCW1hcFsgbmFtZVsgaSBdIF0gPSBqUXVlcnkuY3NzKCBlbGVtLCBuYW1lWyBpIF0sIGZhbHNlLCBzdHlsZXMgKTsKCQkJCX0KCgkJCQlyZXR1cm4gbWFwOwoJCQl9CgoJCQlyZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCA/CgkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUsIHZhbHVlICkgOgoJCQkJalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApOwoJCX0sIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOwoJfSwKCXNob3c6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBzaG93SGlkZSggdGhpcywgdHJ1ZSApOwoJfSwKCWhpZGU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBzaG93SGlkZSggdGhpcyApOwoJfSwKCXRvZ2dsZTogZnVuY3Rpb24oIHN0YXRlICkgewoJCXZhciBib29sID0gdHlwZW9mIHN0YXRlID09PSAiYm9vbGVhbiI7CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggYm9vbCA/IHN0YXRlIDogaXNIaWRkZW4oIHRoaXMgKSApIHsKCQkJCWpRdWVyeSggdGhpcyApLnNob3coKTsKCQkJfSBlbHNlIHsKCQkJCWpRdWVyeSggdGhpcyApLmhpZGUoKTsKCQkJfQoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJLy8gQWRkIGluIHN0eWxlIHByb3BlcnR5IGhvb2tzIGZvciBvdmVycmlkaW5nIHRoZSBkZWZhdWx0CgkvLyBiZWhhdmlvciBvZiBnZXR0aW5nIGFuZCBzZXR0aW5nIGEgc3R5bGUgcHJvcGVydHkKCWNzc0hvb2tzOiB7CgkJb3BhY2l0eTogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJCWlmICggY29tcHV0ZWQgKSB7CgkJCQkJLy8gV2Ugc2hvdWxkIGFsd2F5cyBnZXQgYSBudW1iZXIgYmFjayBmcm9tIG9wYWNpdHkKCQkJCQl2YXIgcmV0ID0gY3VyQ1NTKCBlbGVtLCAib3BhY2l0eSIgKTsKCQkJCQlyZXR1cm4gcmV0ID09PSAiIiA/ICIxIiA6IHJldDsKCQkJCX0KCQkJfQoJCX0KCX0sCgoJLy8gRXhjbHVkZSB0aGUgZm9sbG93aW5nIGNzcyBwcm9wZXJ0aWVzIHRvIGFkZCBweAoJY3NzTnVtYmVyOiB7CgkJImNvbHVtbkNvdW50IjogdHJ1ZSwKCQkiZmlsbE9wYWNpdHkiOiB0cnVlLAoJCSJmb250V2VpZ2h0IjogdHJ1ZSwKCQkibGluZUhlaWdodCI6IHRydWUsCgkJIm9wYWNpdHkiOiB0cnVlLAoJCSJvcnBoYW5zIjogdHJ1ZSwKCQkid2lkb3dzIjogdHJ1ZSwKCQkiekluZGV4IjogdHJ1ZSwKCQkiem9vbSI6IHRydWUKCX0sCgoJLy8gQWRkIGluIHByb3BlcnRpZXMgd2hvc2UgbmFtZXMgeW91IHdpc2ggdG8gZml4IGJlZm9yZQoJLy8gc2V0dGluZyBvciBnZXR0aW5nIHRoZSB2YWx1ZQoJY3NzUHJvcHM6IHsKCQkvLyBub3JtYWxpemUgZmxvYXQgY3NzIHByb3BlcnR5CgkJImZsb2F0IjogalF1ZXJ5LnN1cHBvcnQuY3NzRmxvYXQgPyAiY3NzRmxvYXQiIDogInN0eWxlRmxvYXQiCgl9LAoKCS8vIEdldCBhbmQgc2V0IHRoZSBzdHlsZSBwcm9wZXJ0eSBvbiBhIERPTSBOb2RlCglzdHlsZTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlLCBleHRyYSApIHsKCQkvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQlpZiAoICFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJdmFyIHJldCwgdHlwZSwgaG9va3MsCgkJCW9yaWdOYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG9yaWdOYW1lICkgKTsKCgkJLy8gZ2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbgoJCS8vIGZvbGxvd2VkIGJ5IHRoZSB1bnByZWZpeGVkIHZlcnNpb24KCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJLy8gQ2hlY2sgaWYgd2UncmUgc2V0dGluZyBhIHZhbHVlCgkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQl0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQkJLy8gY29udmVydCByZWxhdGl2ZSBudW1iZXIgc3RyaW5ncyAoKz0gb3IgLT0pIHRvIHJlbGF0aXZlIG51bWJlcnMuICM3MzQ1CgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgJiYgKHJldCA9IHJyZWxOdW0uZXhlYyggdmFsdWUgKSkgKSB7CgkJCQl2YWx1ZSA9ICggcmV0WzFdICsgMSApICogcmV0WzJdICsgcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApICk7CgkJCQkvLyBGaXhlcyBidWcgIzkyMzcKCQkJCXR5cGUgPSAibnVtYmVyIjsKCQkJfQoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgTmFOIGFuZCBudWxsIHZhbHVlcyBhcmVuJ3Qgc2V0LiBTZWU6ICM3MTE2CgkJCWlmICggdmFsdWUgPT0gbnVsbCB8fCB0eXBlID09PSAibnVtYmVyIiAmJiBpc05hTiggdmFsdWUgKSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gSWYgYSBudW1iZXIgd2FzIHBhc3NlZCBpbiwgYWRkICdweCcgdG8gdGhlIChleGNlcHQgZm9yIGNlcnRhaW4gQ1NTIHByb3BlcnRpZXMpCgkJCWlmICggdHlwZSA9PT0gIm51bWJlciIgJiYgIWpRdWVyeS5jc3NOdW1iZXJbIG9yaWdOYW1lIF0gKSB7CgkJCQl2YWx1ZSArPSAicHgiOwoJCQl9CgoJCQkvLyBGaXhlcyAjODkwOCwgaXQgY2FuIGJlIGRvbmUgbW9yZSBjb3JyZWN0bHkgYnkgc3BlY2lmaW5nIHNldHRlcnMgaW4gY3NzSG9va3MsCgkJCS8vIGJ1dCBpdCB3b3VsZCBtZWFuIHRvIGRlZmluZSBlaWdodCAoZm9yIGV2ZXJ5IHByb2JsZW1hdGljIHByb3BlcnR5KSBpZGVudGljYWwgZnVuY3Rpb25zCgkJCWlmICggIWpRdWVyeS5zdXBwb3J0LmNsZWFyQ2xvbmVTdHlsZSAmJiB2YWx1ZSA9PT0gIiIgJiYgbmFtZS5pbmRleE9mKCJiYWNrZ3JvdW5kIikgPT09IDAgKSB7CgkJCQlzdHlsZVsgbmFtZSBdID0gImluaGVyaXQiOwoJCQl9CgoJCQkvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkLCB1c2UgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGp1c3Qgc2V0IHRoZSBzcGVjaWZpZWQgdmFsdWUKCQkJaWYgKCAhaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgKHZhbHVlID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgZXh0cmEgKSkgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBXcmFwcGVkIHRvIHByZXZlbnQgSUUgZnJvbSB0aHJvd2luZyBlcnJvcnMgd2hlbiAnaW52YWxpZCcgdmFsdWVzIGFyZSBwcm92aWRlZAoJCQkJLy8gRml4ZXMgYnVnICM1NTA5CgkJCQl0cnkgewoJCQkJCXN0eWxlWyBuYW1lIF0gPSB2YWx1ZTsKCQkJCX0gY2F0Y2goZSkge30KCQkJfQoKCQl9IGVsc2UgewoJCQkvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkIGdldCB0aGUgbm9uLWNvbXB1dGVkIHZhbHVlIGZyb20gdGhlcmUKCQkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBmYWxzZSwgZXh0cmEgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgkJCX0KCgkJCS8vIE90aGVyd2lzZSBqdXN0IGdldCB0aGUgdmFsdWUgZnJvbSB0aGUgc3R5bGUgb2JqZWN0CgkJCXJldHVybiBzdHlsZVsgbmFtZSBdOwoJCX0KCX0sCgoJY3NzOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZXh0cmEsIHN0eWxlcyApIHsKCQl2YXIgbnVtLCB2YWwsIGhvb2tzLAoJCQlvcmlnTmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJbmFtZSA9IGpRdWVyeS5jc3NQcm9wc1sgb3JpZ05hbWUgXSB8fCAoIGpRdWVyeS5jc3NQcm9wc1sgb3JpZ05hbWUgXSA9IHZlbmRvclByb3BOYW1lKCBlbGVtLnN0eWxlLCBvcmlnTmFtZSApICk7CgoJCS8vIGdldHMgaG9vayBmb3IgdGhlIHByZWZpeGVkIHZlcnNpb24KCQkvLyBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCB2ZXJzaW9uCgkJaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSB8fCBqUXVlcnkuY3NzSG9va3NbIG9yaWdOYW1lIF07CgoJCS8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyApIHsKCQkJdmFsID0gaG9va3MuZ2V0KCBlbGVtLCB0cnVlLCBleHRyYSApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlLCBpZiBhIHdheSB0byBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGV4aXN0cywgdXNlIHRoYXQKCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCX0KCgkJLy9jb252ZXJ0ICJub3JtYWwiIHRvIGNvbXB1dGVkIHZhbHVlCgkJaWYgKCB2YWwgPT09ICJub3JtYWwiICYmIG5hbWUgaW4gY3NzTm9ybWFsVHJhbnNmb3JtICkgewoJCQl2YWwgPSBjc3NOb3JtYWxUcmFuc2Zvcm1bIG5hbWUgXTsKCQl9CgoJCS8vIFJldHVybiwgY29udmVydGluZyB0byBudW1iZXIgaWYgZm9yY2VkIG9yIGEgcXVhbGlmaWVyIHdhcyBwcm92aWRlZCBhbmQgdmFsIGxvb2tzIG51bWVyaWMKCQlpZiAoIGV4dHJhID09PSAiIiB8fCBleHRyYSApIHsKCQkJbnVtID0gcGFyc2VGbG9hdCggdmFsICk7CgkJCXJldHVybiBleHRyYSA9PT0gdHJ1ZSB8fCBqUXVlcnkuaXNOdW1lcmljKCBudW0gKSA/IG51bSB8fCAwIDogdmFsOwoJCX0KCQlyZXR1cm4gdmFsOwoJfSwKCgkvLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zCglzd2FwOiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgY2FsbGJhY2ssIGFyZ3MgKSB7CgkJdmFyIHJldCwgbmFtZSwKCQkJb2xkID0ge307CgoJCS8vIFJlbWVtYmVyIHRoZSBvbGQgdmFsdWVzLCBhbmQgaW5zZXJ0IHRoZSBuZXcgb25lcwoJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJb2xkWyBuYW1lIF0gPSBlbGVtLnN0eWxlWyBuYW1lIF07CgkJCWVsZW0uc3R5bGVbIG5hbWUgXSA9IG9wdGlvbnNbIG5hbWUgXTsKCQl9CgoJCXJldCA9IGNhbGxiYWNrLmFwcGx5KCBlbGVtLCBhcmdzIHx8IFtdICk7CgoJCS8vIFJldmVydCB0aGUgb2xkIHZhbHVlcwoJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb2xkWyBuYW1lIF07CgkJfQoKCQlyZXR1cm4gcmV0OwoJfQp9KTsKCi8vIE5PVEU6IHdlJ3ZlIGluY2x1ZGVkIHRoZSAid2luZG93IiBpbiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZQovLyBiZWNhdXNlIGpzZG9tIG9uIG5vZGUuanMgd2lsbCBicmVhayB3aXRob3V0IGl0LgppZiAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlICkgewoJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICk7Cgl9OwoKCWN1ckNTUyA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBfY29tcHV0ZWQgKSB7CgkJdmFyIHdpZHRoLCBtaW5XaWR0aCwgbWF4V2lkdGgsCgkJCWNvbXB1dGVkID0gX2NvbXB1dGVkIHx8IGdldFN0eWxlcyggZWxlbSApLAoKCQkJLy8gZ2V0UHJvcGVydHlWYWx1ZSBpcyBvbmx5IG5lZWRlZCBmb3IgLmNzcygnZmlsdGVyJykgaW4gSUU5LCBzZWUgIzEyNTM3CgkJCXJldCA9IGNvbXB1dGVkID8gY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApIHx8IGNvbXB1dGVkWyBuYW1lIF0gOiB1bmRlZmluZWQsCgkJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgkJaWYgKCBjb21wdXRlZCApIHsKCgkJCWlmICggcmV0ID09PSAiIiAmJiAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCXJldCA9IGpRdWVyeS5zdHlsZSggZWxlbSwgbmFtZSApOwoJCQl9CgoJCQkvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgoJCQkvLyBDaHJvbWUgPCAxNyBhbmQgU2FmYXJpIDUuMCB1c2VzICJjb21wdXRlZCB2YWx1ZSIgaW5zdGVhZCBvZiAidXNlZCB2YWx1ZSIgZm9yIG1hcmdpbi1yaWdodAoJCQkvLyBTYWZhcmkgNS4xLjcgKGF0IGxlYXN0KSByZXR1cm5zIHBlcmNlbnRhZ2UgZm9yIGEgbGFyZ2VyIHNldCBvZiB2YWx1ZXMsIGJ1dCB3aWR0aCBzZWVtcyB0byBiZSByZWxpYWJseSBwaXhlbHMKCQkJLy8gdGhpcyBpcyBhZ2FpbnN0IHRoZSBDU1NPTSBkcmFmdCBzcGVjOiBodHRwOi8vZGV2LnczLm9yZy9jc3N3Zy9jc3NvbS8jcmVzb2x2ZWQtdmFsdWVzCgkJCWlmICggcm51bW5vbnB4LnRlc3QoIHJldCApICYmIHJtYXJnaW4udGVzdCggbmFtZSApICkgewoKCQkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJCXdpZHRoID0gc3R5bGUud2lkdGg7CgkJCQltaW5XaWR0aCA9IHN0eWxlLm1pbldpZHRoOwoJCQkJbWF4V2lkdGggPSBzdHlsZS5tYXhXaWR0aDsKCgkJCQkvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CgkJCQlzdHlsZS5taW5XaWR0aCA9IHN0eWxlLm1heFdpZHRoID0gc3R5bGUud2lkdGggPSByZXQ7CgkJCQlyZXQgPSBjb21wdXRlZC53aWR0aDsKCgkJCQkvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzCgkJCQlzdHlsZS53aWR0aCA9IHdpZHRoOwoJCQkJc3R5bGUubWluV2lkdGggPSBtaW5XaWR0aDsKCQkJCXN0eWxlLm1heFdpZHRoID0gbWF4V2lkdGg7CgkJCX0KCQl9CgoJCXJldHVybiByZXQ7Cgl9Owp9IGVsc2UgaWYgKCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlICkgewoJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGVsZW0uY3VycmVudFN0eWxlOwoJfTsKCgljdXJDU1MgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSwgX2NvbXB1dGVkICkgewoJCXZhciBsZWZ0LCBycywgcnNMZWZ0LAoJCQljb21wdXRlZCA9IF9jb21wdXRlZCB8fCBnZXRTdHlsZXMoIGVsZW0gKSwKCQkJcmV0ID0gY29tcHV0ZWQgPyBjb21wdXRlZFsgbmFtZSBdIDogdW5kZWZpbmVkLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCS8vIEF2b2lkIHNldHRpbmcgcmV0IHRvIGVtcHR5IHN0cmluZyBoZXJlCgkJLy8gc28gd2UgZG9uJ3QgZGVmYXVsdCB0byBhdXRvCgkJaWYgKCByZXQgPT0gbnVsbCAmJiBzdHlsZSAmJiBzdHlsZVsgbmFtZSBdICkgewoJCQlyZXQgPSBzdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gRnJvbSB0aGUgYXdlc29tZSBoYWNrIGJ5IERlYW4gRWR3YXJkcwoJCS8vIGh0dHA6Ly9lcmlrLmVhZS5uZXQvYXJjaGl2ZXMvMjAwNy8wNy8yNy8xOC41NC4xNS8jY29tbWVudC0xMDIyOTEKCgkJLy8gSWYgd2UncmUgbm90IGRlYWxpbmcgd2l0aCBhIHJlZ3VsYXIgcGl4ZWwgbnVtYmVyCgkJLy8gYnV0IGEgbnVtYmVyIHRoYXQgaGFzIGEgd2VpcmQgZW5kaW5nLCB3ZSBuZWVkIHRvIGNvbnZlcnQgaXQgdG8gcGl4ZWxzCgkJLy8gYnV0IG5vdCBwb3NpdGlvbiBjc3MgYXR0cmlidXRlcywgYXMgdGhvc2UgYXJlIHByb3BvcnRpb25hbCB0byB0aGUgcGFyZW50IGVsZW1lbnQgaW5zdGVhZAoJCS8vIGFuZCB3ZSBjYW4ndCBtZWFzdXJlIHRoZSBwYXJlbnQgaW5zdGVhZCBiZWNhdXNlIGl0IG1pZ2h0IHRyaWdnZXIgYSAic3RhY2tpbmcgZG9sbHMiIHByb2JsZW0KCQlpZiAoIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiAhcnBvc2l0aW9uLnRlc3QoIG5hbWUgKSApIHsKCgkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJbGVmdCA9IHN0eWxlLmxlZnQ7CgkJCXJzID0gZWxlbS5ydW50aW1lU3R5bGU7CgkJCXJzTGVmdCA9IHJzICYmIHJzLmxlZnQ7CgoJCQkvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IGVsZW0uY3VycmVudFN0eWxlLmxlZnQ7CgkJCX0KCQkJc3R5bGUubGVmdCA9IG5hbWUgPT09ICJmb250U2l6ZSIgPyAiMWVtIiA6IHJldDsKCQkJcmV0ID0gc3R5bGUucGl4ZWxMZWZ0ICsgInB4IjsKCgkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCQkJc3R5bGUubGVmdCA9IGxlZnQ7CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IHJzTGVmdDsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldCA9PT0gIiIgPyAiYXV0byIgOiByZXQ7Cgl9Owp9CgpmdW5jdGlvbiBzZXRQb3NpdGl2ZU51bWJlciggZWxlbSwgdmFsdWUsIHN1YnRyYWN0ICkgewoJdmFyIG1hdGNoZXMgPSBybnVtc3BsaXQuZXhlYyggdmFsdWUgKTsKCXJldHVybiBtYXRjaGVzID8KCQkvLyBHdWFyZCBhZ2FpbnN0IHVuZGVmaW5lZCAic3VidHJhY3QiLCBlLmcuLCB3aGVuIHVzZWQgYXMgaW4gY3NzSG9va3MKCQlNYXRoLm1heCggMCwgbWF0Y2hlc1sgMSBdIC0gKCBzdWJ0cmFjdCB8fCAwICkgKSArICggbWF0Y2hlc1sgMiBdIHx8ICJweCIgKSA6CgkJdmFsdWU7Cn0KCmZ1bmN0aW9uIGF1Z21lbnRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSwgaXNCb3JkZXJCb3gsIHN0eWxlcyApIHsKCXZhciBpID0gZXh0cmEgPT09ICggaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IiApID8KCQkvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgdGhlIHJpZ2h0IG1lYXN1cmVtZW50LCBhdm9pZCBhdWdtZW50YXRpb24KCQk0IDoKCQkvLyBPdGhlcndpc2UgaW5pdGlhbGl6ZSBmb3IgaG9yaXpvbnRhbCBvciB2ZXJ0aWNhbCBwcm9wZXJ0aWVzCgkJbmFtZSA9PT0gIndpZHRoIiA/IDEgOiAwLAoKCQl2YWwgPSAwOwoKCWZvciAoIDsgaSA8IDQ7IGkgKz0gMiApIHsKCQkvLyBib3RoIGJveCBtb2RlbHMgZXhjbHVkZSBtYXJnaW4sIHNvIGFkZCBpdCBpZiB3ZSB3YW50IGl0CgkJaWYgKCBleHRyYSA9PT0gIm1hcmdpbiIgKSB7CgkJCXZhbCArPSBqUXVlcnkuY3NzKCBlbGVtLCBleHRyYSArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCQl9CgoJCWlmICggaXNCb3JkZXJCb3ggKSB7CgkJCS8vIGJvcmRlci1ib3ggaW5jbHVkZXMgcGFkZGluZywgc28gcmVtb3ZlIGl0IGlmIHdlIHdhbnQgY29udGVudAoJCQlpZiAoIGV4dHJhID09PSAiY29udGVudCIgKSB7CgkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoJCQl9CgoJCQkvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBib3JkZXIgbm9yIG1hcmdpbiwgc28gcmVtb3ZlIGJvcmRlcgoJCQlpZiAoIGV4dHJhICE9PSAibWFyZ2luIiApIHsKCQkJCXZhbCAtPSBqUXVlcnkuY3NzKCBlbGVtLCAiYm9yZGVyIiArIGNzc0V4cGFuZFsgaSBdICsgIldpZHRoIiwgdHJ1ZSwgc3R5bGVzICk7CgkJCX0KCQl9IGVsc2UgewoJCQkvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBjb250ZW50LCBzbyBhZGQgcGFkZGluZwoJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoKCQkJLy8gYXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgY29udGVudCBub3IgcGFkZGluZywgc28gYWRkIGJvcmRlcgoJCQlpZiAoIGV4dHJhICE9PSAicGFkZGluZyIgKSB7CgkJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOwoJCQl9CgkJfQoJfQoKCXJldHVybiB2YWw7Cn0KCmZ1bmN0aW9uIGdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICkgewoKCS8vIFN0YXJ0IHdpdGggb2Zmc2V0IHByb3BlcnR5LCB3aGljaCBpcyBlcXVpdmFsZW50IHRvIHRoZSBib3JkZXItYm94IHZhbHVlCgl2YXIgdmFsdWVJc0JvcmRlckJveCA9IHRydWUsCgkJdmFsID0gbmFtZSA9PT0gIndpZHRoIiA/IGVsZW0ub2Zmc2V0V2lkdGggOiBlbGVtLm9mZnNldEhlaWdodCwKCQlzdHlsZXMgPSBnZXRTdHlsZXMoIGVsZW0gKSwKCQlpc0JvcmRlckJveCA9IGpRdWVyeS5zdXBwb3J0LmJveFNpemluZyAmJiBqUXVlcnkuY3NzKCBlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcyApID09PSAiYm9yZGVyLWJveCI7CgoJLy8gc29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCgkvLyBzdmcgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02NDkyODUKCS8vIE1hdGhNTCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTQ5MTY2OAoJaWYgKCB2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkvLyBGYWxsIGJhY2sgdG8gY29tcHV0ZWQgdGhlbiB1bmNvbXB1dGVkIGNzcyBpZiBuZWNlc3NhcnkKCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCWlmICggdmFsIDwgMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkJdmFsID0gZWxlbS5zdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gQ29tcHV0ZWQgdW5pdCBpcyBub3QgcGl4ZWxzLiBTdG9wIGhlcmUgYW5kIHJldHVybi4KCQlpZiAoIHJudW1ub25weC50ZXN0KHZhbCkgKSB7CgkJCXJldHVybiB2YWw7CgkJfQoKCQkvLyB3ZSBuZWVkIHRoZSBjaGVjayBmb3Igc3R5bGUgaW4gY2FzZSBhIGJyb3dzZXIgd2hpY2ggcmV0dXJucyB1bnJlbGlhYmxlIHZhbHVlcwoJCS8vIGZvciBnZXRDb21wdXRlZFN0eWxlIHNpbGVudGx5IGZhbGxzIGJhY2sgdG8gdGhlIHJlbGlhYmxlIGVsZW0uc3R5bGUKCQl2YWx1ZUlzQm9yZGVyQm94ID0gaXNCb3JkZXJCb3ggJiYgKCBqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmdSZWxpYWJsZSB8fCB2YWwgPT09IGVsZW0uc3R5bGVbIG5hbWUgXSApOwoKCQkvLyBOb3JtYWxpemUgIiIsIGF1dG8sIGFuZCBwcmVwYXJlIGZvciBleHRyYQoJCXZhbCA9IHBhcnNlRmxvYXQoIHZhbCApIHx8IDA7Cgl9CgoJLy8gdXNlIHRoZSBhY3RpdmUgYm94LXNpemluZyBtb2RlbCB0byBhZGQvc3VidHJhY3QgaXJyZWxldmFudCBzdHlsZXMKCXJldHVybiAoIHZhbCArCgkJYXVnbWVudFdpZHRoT3JIZWlnaHQoCgkJCWVsZW0sCgkJCW5hbWUsCgkJCWV4dHJhIHx8ICggaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IiApLAoJCQl2YWx1ZUlzQm9yZGVyQm94LAoJCQlzdHlsZXMKCQkpCgkpICsgInB4IjsKfQoKLy8gVHJ5IHRvIGRldGVybWluZSB0aGUgZGVmYXVsdCBkaXNwbGF5IHZhbHVlIG9mIGFuIGVsZW1lbnQKZnVuY3Rpb24gY3NzX2RlZmF1bHREaXNwbGF5KCBub2RlTmFtZSApIHsKCXZhciBkb2MgPSBkb2N1bWVudCwKCQlkaXNwbGF5ID0gZWxlbWRpc3BsYXlbIG5vZGVOYW1lIF07CgoJaWYgKCAhZGlzcGxheSApIHsKCQlkaXNwbGF5ID0gYWN0dWFsRGlzcGxheSggbm9kZU5hbWUsIGRvYyApOwoKCQkvLyBJZiB0aGUgc2ltcGxlIHdheSBmYWlscywgcmVhZCBmcm9tIGluc2lkZSBhbiBpZnJhbWUKCQlpZiAoIGRpc3BsYXkgPT09ICJub25lIiB8fCAhZGlzcGxheSApIHsKCQkJLy8gVXNlIHRoZSBhbHJlYWR5LWNyZWF0ZWQgaWZyYW1lIGlmIHBvc3NpYmxlCgkJCWlmcmFtZSA9ICggaWZyYW1lIHx8CgkJCQlqUXVlcnkoIjxpZnJhbWUgZnJhbWVib3JkZXI9JzAnIHdpZHRoPScwJyBoZWlnaHQ9JzAnLz4iKQoJCQkJLmNzcyggImNzc1RleHQiLCAiZGlzcGxheTpibG9jayAhaW1wb3J0YW50IiApCgkJCSkuYXBwZW5kVG8oIGRvYy5kb2N1bWVudEVsZW1lbnQgKTsKCgkJCS8vIEFsd2F5cyB3cml0ZSBhIG5ldyBIVE1MIHNrZWxldG9uIHNvIFdlYmtpdCBhbmQgRmlyZWZveCBkb24ndCBjaG9rZSBvbiByZXVzZQoJCQlkb2MgPSAoIGlmcmFtZVswXS5jb250ZW50V2luZG93IHx8IGlmcmFtZVswXS5jb250ZW50RG9jdW1lbnQgKS5kb2N1bWVudDsKCQkJZG9jLndyaXRlKCI8IWRvY3R5cGUgaHRtbD48aHRtbD48Ym9keT4iKTsKCQkJZG9jLmNsb3NlKCk7CgoJCQlkaXNwbGF5ID0gYWN0dWFsRGlzcGxheSggbm9kZU5hbWUsIGRvYyApOwoJCQlpZnJhbWUuZGV0YWNoKCk7CgkJfQoKCQkvLyBTdG9yZSB0aGUgY29ycmVjdCBkZWZhdWx0IGRpc3BsYXkKCQllbGVtZGlzcGxheVsgbm9kZU5hbWUgXSA9IGRpc3BsYXk7Cgl9CgoJcmV0dXJuIGRpc3BsYXk7Cn0KCi8vIENhbGxlZCBPTkxZIGZyb20gd2l0aGluIGNzc19kZWZhdWx0RGlzcGxheQpmdW5jdGlvbiBhY3R1YWxEaXNwbGF5KCBuYW1lLCBkb2MgKSB7Cgl2YXIgZWxlbSA9IGpRdWVyeSggZG9jLmNyZWF0ZUVsZW1lbnQoIG5hbWUgKSApLmFwcGVuZFRvKCBkb2MuYm9keSApLAoJCWRpc3BsYXkgPSBqUXVlcnkuY3NzKCBlbGVtWzBdLCAiZGlzcGxheSIgKTsKCWVsZW0ucmVtb3ZlKCk7CglyZXR1cm4gZGlzcGxheTsKfQoKalF1ZXJ5LmVhY2goWyAiaGVpZ2h0IiwgIndpZHRoIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCWpRdWVyeS5jc3NIb29rc1sgbmFtZSBdID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkLCBleHRyYSApIHsKCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCS8vIGNlcnRhaW4gZWxlbWVudHMgY2FuIGhhdmUgZGltZW5zaW9uIGluZm8gaWYgd2UgaW52aXNpYmx5IHNob3cgdGhlbQoJCQkJLy8gaG93ZXZlciwgaXQgbXVzdCBoYXZlIGEgY3VycmVudCBkaXNwbGF5IHN0eWxlIHRoYXQgd291bGQgYmVuZWZpdCBmcm9tIHRoaXMKCQkJCXJldHVybiBlbGVtLm9mZnNldFdpZHRoID09PSAwICYmIHJkaXNwbGF5c3dhcC50ZXN0KCBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKSApID8KCQkJCQlqUXVlcnkuc3dhcCggZWxlbSwgY3NzU2hvdywgZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiBnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQkJCX0pIDoKCQkJCQlnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQl9CgkJfSwKCgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIGV4dHJhICkgewoJCQl2YXIgc3R5bGVzID0gZXh0cmEgJiYgZ2V0U3R5bGVzKCBlbGVtICk7CgkJCXJldHVybiBzZXRQb3NpdGl2ZU51bWJlciggZWxlbSwgdmFsdWUsIGV4dHJhID8KCQkJCWF1Z21lbnRXaWR0aE9ySGVpZ2h0KAoJCQkJCWVsZW0sCgkJCQkJbmFtZSwKCQkJCQlleHRyYSwKCQkJCQlqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmcgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImJveFNpemluZyIsIGZhbHNlLCBzdHlsZXMgKSA9PT0gImJvcmRlci1ib3giLAoJCQkJCXN0eWxlcwoJCQkJKSA6IDAKCQkJKTsKCQl9Cgl9Owp9KTsKCmlmICggIWpRdWVyeS5zdXBwb3J0Lm9wYWNpdHkgKSB7CglqUXVlcnkuY3NzSG9va3Mub3BhY2l0eSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJLy8gSUUgdXNlcyBmaWx0ZXJzIGZvciBvcGFjaXR5CgkJCXJldHVybiByb3BhY2l0eS50ZXN0KCAoY29tcHV0ZWQgJiYgZWxlbS5jdXJyZW50U3R5bGUgPyBlbGVtLmN1cnJlbnRTdHlsZS5maWx0ZXIgOiBlbGVtLnN0eWxlLmZpbHRlcikgfHwgIiIgKSA/CgkJCQkoIDAuMDEgKiBwYXJzZUZsb2F0KCBSZWdFeHAuJDEgKSApICsgIiIgOgoJCQkJY29tcHV0ZWQgPyAiMSIgOiAiIjsKCQl9LAoKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJdmFyIHN0eWxlID0gZWxlbS5zdHlsZSwKCQkJCWN1cnJlbnRTdHlsZSA9IGVsZW0uY3VycmVudFN0eWxlLAoJCQkJb3BhY2l0eSA9IGpRdWVyeS5pc051bWVyaWMoIHZhbHVlICkgPyAiYWxwaGEob3BhY2l0eT0iICsgdmFsdWUgKiAxMDAgKyAiKSIgOiAiIiwKCQkJCWZpbHRlciA9IGN1cnJlbnRTdHlsZSAmJiBjdXJyZW50U3R5bGUuZmlsdGVyIHx8IHN0eWxlLmZpbHRlciB8fCAiIjsKCgkJCS8vIElFIGhhcyB0cm91YmxlIHdpdGggb3BhY2l0eSBpZiBpdCBkb2VzIG5vdCBoYXZlIGxheW91dAoJCQkvLyBGb3JjZSBpdCBieSBzZXR0aW5nIHRoZSB6b29tIGxldmVsCgkJCXN0eWxlLnpvb20gPSAxOwoKCQkJLy8gaWYgc2V0dGluZyBvcGFjaXR5IHRvIDEsIGFuZCBubyBvdGhlciBmaWx0ZXJzIGV4aXN0IC0gYXR0ZW1wdCB0byByZW1vdmUgZmlsdGVyIGF0dHJpYnV0ZSAjNjY1MgoJCQkvLyBpZiB2YWx1ZSA9PT0gIiIsIHRoZW4gcmVtb3ZlIGlubGluZSBvcGFjaXR5ICMxMjY4NQoJCQlpZiAoICggdmFsdWUgPj0gMSB8fCB2YWx1ZSA9PT0gIiIgKSAmJgoJCQkJCWpRdWVyeS50cmltKCBmaWx0ZXIucmVwbGFjZSggcmFscGhhLCAiIiApICkgPT09ICIiICYmCgkJCQkJc3R5bGUucmVtb3ZlQXR0cmlidXRlICkgewoKCQkJCS8vIFNldHRpbmcgc3R5bGUuZmlsdGVyIHRvIG51bGwsICIiICYgIiAiIHN0aWxsIGxlYXZlICJmaWx0ZXI6IiBpbiB0aGUgY3NzVGV4dAoJCQkJLy8gaWYgImZpbHRlcjoiIGlzIHByZXNlbnQgYXQgYWxsLCBjbGVhclR5cGUgaXMgZGlzYWJsZWQsIHdlIHdhbnQgdG8gYXZvaWQgdGhpcwoJCQkJLy8gc3R5bGUucmVtb3ZlQXR0cmlidXRlIGlzIElFIE9ubHksIGJ1dCBzbyBhcHBhcmVudGx5IGlzIHRoaXMgY29kZSBwYXRoLi4uCgkJCQlzdHlsZS5yZW1vdmVBdHRyaWJ1dGUoICJmaWx0ZXIiICk7CgoJCQkJLy8gaWYgdGhlcmUgaXMgbm8gZmlsdGVyIHN0eWxlIGFwcGxpZWQgaW4gYSBjc3MgcnVsZSBvciB1bnNldCBpbmxpbmUgb3BhY2l0eSwgd2UgYXJlIGRvbmUKCQkJCWlmICggdmFsdWUgPT09ICIiIHx8IGN1cnJlbnRTdHlsZSAmJiAhY3VycmVudFN0eWxlLmZpbHRlciApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCX0KCgkJCS8vIG90aGVyd2lzZSwgc2V0IG5ldyBmaWx0ZXIgdmFsdWVzCgkJCXN0eWxlLmZpbHRlciA9IHJhbHBoYS50ZXN0KCBmaWx0ZXIgKSA/CgkJCQlmaWx0ZXIucmVwbGFjZSggcmFscGhhLCBvcGFjaXR5ICkgOgoJCQkJZmlsdGVyICsgIiAiICsgb3BhY2l0eTsKCQl9Cgl9Owp9CgovLyBUaGVzZSBob29rcyBjYW5ub3QgYmUgYWRkZWQgdW50aWwgRE9NIHJlYWR5IGJlY2F1c2UgdGhlIHN1cHBvcnQgdGVzdAovLyBmb3IgaXQgaXMgbm90IHJ1biB1bnRpbCBhZnRlciBET00gcmVhZHkKalF1ZXJ5KGZ1bmN0aW9uKCkgewoJaWYgKCAhalF1ZXJ5LnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCApIHsKCQlqUXVlcnkuY3NzSG9va3MubWFyZ2luUmlnaHQgPSB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkvLyBXZWJLaXQgQnVnIDEzMzQzIC0gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHdyb25nIHZhbHVlIGZvciBtYXJnaW4tcmlnaHQKCQkJCQkvLyBXb3JrIGFyb3VuZCBieSB0ZW1wb3JhcmlseSBzZXR0aW5nIGVsZW1lbnQgZGlzcGxheSB0byBpbmxpbmUtYmxvY2sKCQkJCQlyZXR1cm4galF1ZXJ5LnN3YXAoIGVsZW0sIHsgImRpc3BsYXkiOiAiaW5saW5lLWJsb2NrIiB9LAoJCQkJCQljdXJDU1MsIFsgZWxlbSwgIm1hcmdpblJpZ2h0IiBdICk7CgkJCQl9CgkJCX0KCQl9OwoJfQoKCS8vIFdlYmtpdCBidWc6IGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0yOTA4NAoJLy8gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHBlcmNlbnQgd2hlbiBzcGVjaWZpZWQgZm9yIHRvcC9sZWZ0L2JvdHRvbS9yaWdodAoJLy8gcmF0aGVyIHRoYW4gbWFrZSB0aGUgY3NzIG1vZHVsZSBkZXBlbmQgb24gdGhlIG9mZnNldCBtb2R1bGUsIHdlIGp1c3QgY2hlY2sgZm9yIGl0IGhlcmUKCWlmICggIWpRdWVyeS5zdXBwb3J0LnBpeGVsUG9zaXRpb24gJiYgalF1ZXJ5LmZuLnBvc2l0aW9uICkgewoJCWpRdWVyeS5lYWNoKCBbICJ0b3AiLCAibGVmdCIgXSwgZnVuY3Rpb24oIGksIHByb3AgKSB7CgkJCWpRdWVyeS5jc3NIb29rc1sgcHJvcCBdID0gewoJCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7CgkJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkJY29tcHV0ZWQgPSBjdXJDU1MoIGVsZW0sIHByb3AgKTsKCQkJCQkJLy8gaWYgY3VyQ1NTIHJldHVybnMgcGVyY2VudGFnZSwgZmFsbGJhY2sgdG8gb2Zmc2V0CgkJCQkJCXJldHVybiBybnVtbm9ucHgudGVzdCggY29tcHV0ZWQgKSA/CgkJCQkJCQlqUXVlcnkoIGVsZW0gKS5wb3NpdGlvbigpWyBwcm9wIF0gKyAicHgiIDoKCQkJCQkJCWNvbXB1dGVkOwoJCQkJCX0KCQkJCX0KCQkJfTsKCQl9KTsKCX0KCn0pOwoKaWYgKCBqUXVlcnkuZXhwciAmJiBqUXVlcnkuZXhwci5maWx0ZXJzICkgewoJalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiggZWxlbSApIHsKCQkvLyBTdXBwb3J0OiBPcGVyYSA8PSAxMi4xMgoJCS8vIE9wZXJhIHJlcG9ydHMgb2Zmc2V0V2lkdGhzIGFuZCBvZmZzZXRIZWlnaHRzIGxlc3MgdGhhbiB6ZXJvIG9uIHNvbWUgZWxlbWVudHMKCQlyZXR1cm4gZWxlbS5vZmZzZXRXaWR0aCA8PSAwICYmIGVsZW0ub2Zmc2V0SGVpZ2h0IDw9IDAgfHwKCQkJKCFqUXVlcnkuc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMgJiYgKChlbGVtLnN0eWxlICYmIGVsZW0uc3R5bGUuZGlzcGxheSkgfHwgalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkpID09PSAibm9uZSIpOwoJfTsKCglqUXVlcnkuZXhwci5maWx0ZXJzLnZpc2libGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gIWpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuKCBlbGVtICk7Cgl9Owp9CgovLyBUaGVzZSBob29rcyBhcmUgdXNlZCBieSBhbmltYXRlIHRvIGV4cGFuZCBwcm9wZXJ0aWVzCmpRdWVyeS5lYWNoKHsKCW1hcmdpbjogIiIsCglwYWRkaW5nOiAiIiwKCWJvcmRlcjogIldpZHRoIgp9LCBmdW5jdGlvbiggcHJlZml4LCBzdWZmaXggKSB7CglqUXVlcnkuY3NzSG9va3NbIHByZWZpeCArIHN1ZmZpeCBdID0gewoJCWV4cGFuZDogZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgaSA9IDAsCgkJCQlleHBhbmRlZCA9IHt9LAoKCQkJCS8vIGFzc3VtZXMgYSBzaW5nbGUgbnVtYmVyIGlmIG5vdCBhIHN0cmluZwoJCQkJcGFydHMgPSB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciID8gdmFsdWUuc3BsaXQoIiAiKSA6IFsgdmFsdWUgXTsKCgkJCWZvciAoIDsgaSA8IDQ7IGkrKyApIHsKCQkJCWV4cGFuZGVkWyBwcmVmaXggKyBjc3NFeHBhbmRbIGkgXSArIHN1ZmZpeCBdID0KCQkJCQlwYXJ0c1sgaSBdIHx8IHBhcnRzWyBpIC0gMiBdIHx8IHBhcnRzWyAwIF07CgkJCX0KCgkJCXJldHVybiBleHBhbmRlZDsKCQl9Cgl9OwoKCWlmICggIXJtYXJnaW4udGVzdCggcHJlZml4ICkgKSB7CgkJalF1ZXJ5LmNzc0hvb2tzWyBwcmVmaXggKyBzdWZmaXggXS5zZXQgPSBzZXRQb3NpdGl2ZU51bWJlcjsKCX0KfSk7CnZhciByMjAgPSAvJTIwL2csCglyYnJhY2tldCA9IC9cW1xdJC8sCglyQ1JMRiA9IC9ccj9cbi9nLAoJcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAoJcnN1Ym1pdHRhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglzZXJpYWxpemU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBqUXVlcnkucGFyYW0oIHRoaXMuc2VyaWFsaXplQXJyYXkoKSApOwoJfSwKCXNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXsKCQkJLy8gQ2FuIGFkZCBwcm9wSG9vayBmb3IgImVsZW1lbnRzIiB0byBmaWx0ZXIgb3IgYWRkIGZvcm0gZWxlbWVudHMKCQkJdmFyIGVsZW1lbnRzID0galF1ZXJ5LnByb3AoIHRoaXMsICJlbGVtZW50cyIgKTsKCQkJcmV0dXJuIGVsZW1lbnRzID8galF1ZXJ5Lm1ha2VBcnJheSggZWxlbWVudHMgKSA6IHRoaXM7CgkJfSkKCQkuZmlsdGVyKGZ1bmN0aW9uKCl7CgkJCXZhciB0eXBlID0gdGhpcy50eXBlOwoJCQkvLyBVc2UgLmlzKCI6ZGlzYWJsZWQiKSBzbyB0aGF0IGZpZWxkc2V0W2Rpc2FibGVkXSB3b3JrcwoJCQlyZXR1cm4gdGhpcy5uYW1lICYmICFqUXVlcnkoIHRoaXMgKS5pcyggIjpkaXNhYmxlZCIgKSAmJgoJCQkJcnN1Ym1pdHRhYmxlLnRlc3QoIHRoaXMubm9kZU5hbWUgKSAmJiAhcnN1Ym1pdHRlclR5cGVzLnRlc3QoIHR5cGUgKSAmJgoJCQkJKCB0aGlzLmNoZWNrZWQgfHwgIW1hbmlwdWxhdGlvbl9yY2hlY2thYmxlVHlwZS50ZXN0KCB0eXBlICkgKTsKCQl9KQoJCS5tYXAoZnVuY3Rpb24oIGksIGVsZW0gKXsKCQkJdmFyIHZhbCA9IGpRdWVyeSggdGhpcyApLnZhbCgpOwoKCQkJcmV0dXJuIHZhbCA9PSBudWxsID8KCQkJCW51bGwgOgoJCQkJalF1ZXJ5LmlzQXJyYXkoIHZhbCApID8KCQkJCQlqUXVlcnkubWFwKCB2YWwsIGZ1bmN0aW9uKCB2YWwgKXsKCQkJCQkJcmV0dXJuIHsgbmFtZTogZWxlbS5uYW1lLCB2YWx1ZTogdmFsLnJlcGxhY2UoIHJDUkxGLCAiXHJcbiIgKSB9OwoJCQkJCX0pIDoKCQkJCQl7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQl9KS5nZXQoKTsKCX0KfSk7CgovL1NlcmlhbGl6ZSBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzIG9yIGEgc2V0IG9mCi8va2V5L3ZhbHVlcyBpbnRvIGEgcXVlcnkgc3RyaW5nCmpRdWVyeS5wYXJhbSA9IGZ1bmN0aW9uKCBhLCB0cmFkaXRpb25hbCApIHsKCXZhciBwcmVmaXgsCgkJcyA9IFtdLAoJCWFkZCA9IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQkvLyBJZiB2YWx1ZSBpcyBhIGZ1bmN0aW9uLCBpbnZva2UgaXQgYW5kIHJldHVybiBpdHMgdmFsdWUKCQkJdmFsdWUgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSA/IHZhbHVlKCkgOiAoIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICk7CgkJCXNbIHMubGVuZ3RoIF0gPSBlbmNvZGVVUklDb21wb25lbnQoIGtleSApICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KCB2YWx1ZSApOwoJCX07CgoJLy8gU2V0IHRyYWRpdGlvbmFsIHRvIHRydWUgZm9yIGpRdWVyeSA8PSAxLjMuMiBiZWhhdmlvci4KCWlmICggdHJhZGl0aW9uYWwgPT09IHVuZGVmaW5lZCApIHsKCQl0cmFkaXRpb25hbCA9IGpRdWVyeS5hamF4U2V0dGluZ3MgJiYgalF1ZXJ5LmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbDsKCX0KCgkvLyBJZiBhbiBhcnJheSB3YXMgcGFzc2VkIGluLCBhc3N1bWUgdGhhdCBpdCBpcyBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzLgoJaWYgKCBqUXVlcnkuaXNBcnJheSggYSApIHx8ICggYS5qcXVlcnkgJiYgIWpRdWVyeS5pc1BsYWluT2JqZWN0KCBhICkgKSApIHsKCQkvLyBTZXJpYWxpemUgdGhlIGZvcm0gZWxlbWVudHMKCQlqUXVlcnkuZWFjaCggYSwgZnVuY3Rpb24oKSB7CgkJCWFkZCggdGhpcy5uYW1lLCB0aGlzLnZhbHVlICk7CgkJfSk7CgoJfSBlbHNlIHsKCQkvLyBJZiB0cmFkaXRpb25hbCwgZW5jb2RlIHRoZSAib2xkIiB3YXkgKHRoZSB3YXkgMS4zLjIgb3Igb2xkZXIKCQkvLyBkaWQgaXQpLCBvdGhlcndpc2UgZW5jb2RlIHBhcmFtcyByZWN1cnNpdmVseS4KCQlmb3IgKCBwcmVmaXggaW4gYSApIHsKCQkJYnVpbGRQYXJhbXMoIHByZWZpeCwgYVsgcHJlZml4IF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSByZXN1bHRpbmcgc2VyaWFsaXphdGlvbgoJcmV0dXJuIHMuam9pbiggIiYiICkucmVwbGFjZSggcjIwLCAiKyIgKTsKfTsKCmZ1bmN0aW9uIGJ1aWxkUGFyYW1zKCBwcmVmaXgsIG9iaiwgdHJhZGl0aW9uYWwsIGFkZCApIHsKCXZhciBuYW1lOwoKCWlmICggalF1ZXJ5LmlzQXJyYXkoIG9iaiApICkgewoJCS8vIFNlcmlhbGl6ZSBhcnJheSBpdGVtLgoJCWpRdWVyeS5lYWNoKCBvYmosIGZ1bmN0aW9uKCBpLCB2ICkgewoJCQlpZiAoIHRyYWRpdGlvbmFsIHx8IHJicmFja2V0LnRlc3QoIHByZWZpeCApICkgewoJCQkJLy8gVHJlYXQgZWFjaCBhcnJheSBpdGVtIGFzIGEgc2NhbGFyLgoJCQkJYWRkKCBwcmVmaXgsIHYgKTsKCgkJCX0gZWxzZSB7CgkJCQkvLyBJdGVtIGlzIG5vbi1zY2FsYXIgKGFycmF5IG9yIG9iamVjdCksIGVuY29kZSBpdHMgbnVtZXJpYyBpbmRleC4KCQkJCWJ1aWxkUGFyYW1zKCBwcmVmaXggKyAiWyIgKyAoIHR5cGVvZiB2ID09PSAib2JqZWN0IiA/IGkgOiAiIiApICsgIl0iLCB2LCB0cmFkaXRpb25hbCwgYWRkICk7CgkJCX0KCQl9KTsKCgl9IGVsc2UgaWYgKCAhdHJhZGl0aW9uYWwgJiYgalF1ZXJ5LnR5cGUoIG9iaiApID09PSAib2JqZWN0IiApIHsKCQkvLyBTZXJpYWxpemUgb2JqZWN0IGl0ZW0uCgkJZm9yICggbmFtZSBpbiBvYmogKSB7CgkJCWJ1aWxkUGFyYW1zKCBwcmVmaXggKyAiWyIgKyBuYW1lICsgIl0iLCBvYmpbIG5hbWUgXSwgdHJhZGl0aW9uYWwsIGFkZCApOwoJCX0KCgl9IGVsc2UgewoJCS8vIFNlcmlhbGl6ZSBzY2FsYXIgaXRlbS4KCQlhZGQoIHByZWZpeCwgb2JqICk7Cgl9Cn0KalF1ZXJ5LmVhY2goICgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgIiArCgkibW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgIiArCgkiY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIpLnNwbGl0KCIgIiksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoKCS8vIEhhbmRsZSBldmVudCBiaW5kaW5nCglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDAgPwoJCQl0aGlzLm9uKCBuYW1lLCBudWxsLCBkYXRhLCBmbiApIDoKCQkJdGhpcy50cmlnZ2VyKCBuYW1lICk7Cgl9Owp9KTsKCmpRdWVyeS5mbi5ob3ZlciA9IGZ1bmN0aW9uKCBmbk92ZXIsIGZuT3V0ICkgewoJcmV0dXJuIHRoaXMubW91c2VlbnRlciggZm5PdmVyICkubW91c2VsZWF2ZSggZm5PdXQgfHwgZm5PdmVyICk7Cn07CnZhcgoJLy8gRG9jdW1lbnQgbG9jYXRpb24KCWFqYXhMb2NQYXJ0cywKCWFqYXhMb2NhdGlvbiwKCWFqYXhfbm9uY2UgPSBqUXVlcnkubm93KCksCgoJYWpheF9ycXVlcnkgPSAvXD8vLAoJcmhhc2ggPSAvIy4qJC8sCglydHMgPSAvKFs/Jl0pXz1bXiZdKi8sCglyaGVhZGVycyA9IC9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKVxyPyQvbWcsIC8vIElFIGxlYXZlcyBhbiBcciBjaGFyYWN0ZXIgYXQgRU9MCgkvLyAjNzY1MywgIzgxMjUsICM4MTUyOiBsb2NhbCBwcm90b2NvbCBkZXRlY3Rpb24KCXJsb2NhbFByb3RvY29sID0gL14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8sCglybm9Db250ZW50ID0gL14oPzpHRVR8SEVBRCkkLywKCXJwcm90b2NvbCA9IC9eXC9cLy8sCglydXJsID0gL14oW1x3ListXSs6KSg/OlwvXC8oW15cLz8jOl0qKSg/OjooXGQrKXwpfCkvLAoKCS8vIEtlZXAgYSBjb3B5IG9mIHRoZSBvbGQgbG9hZCBtZXRob2QKCV9sb2FkID0galF1ZXJ5LmZuLmxvYWQsCgoJLyogUHJlZmlsdGVycwoJICogMSkgVGhleSBhcmUgdXNlZnVsIHRvIGludHJvZHVjZSBjdXN0b20gZGF0YVR5cGVzIChzZWUgYWpheC9qc29ucC5qcyBmb3IgYW4gZXhhbXBsZSkKCSAqIDIpIFRoZXNlIGFyZSBjYWxsZWQ6CgkgKiAgICAtIEJFRk9SRSBhc2tpbmcgZm9yIGEgdHJhbnNwb3J0CgkgKiAgICAtIEFGVEVSIHBhcmFtIHNlcmlhbGl6YXRpb24gKHMuZGF0YSBpcyBhIHN0cmluZyBpZiBzLnByb2Nlc3NEYXRhIGlzIHRydWUpCgkgKiAzKSBrZXkgaXMgdGhlIGRhdGFUeXBlCgkgKiA0KSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJICogNSkgZXhlY3V0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gY29udGludWUgZG93biB0byAiKiIgaWYgbmVlZGVkCgkgKi8KCXByZWZpbHRlcnMgPSB7fSwKCgkvKiBUcmFuc3BvcnRzIGJpbmRpbmdzCgkgKiAxKSBrZXkgaXMgdGhlIGRhdGFUeXBlCgkgKiAyKSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJICogMykgc2VsZWN0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gZ28gdG8gIioiIGlmIG5lZWRlZAoJICovCgl0cmFuc3BvcnRzID0ge30sCgoJLy8gQXZvaWQgY29tbWVudC1wcm9sb2cgY2hhciBzZXF1ZW5jZSAoIzEwMDk4KTsgbXVzdCBhcHBlYXNlIGxpbnQgYW5kIGV2YWRlIGNvbXByZXNzaW9uCglhbGxUeXBlcyA9ICIqLyIuY29uY2F0KCIqIik7CgovLyAjODEzOCwgSUUgbWF5IHRocm93IGFuIGV4Y2VwdGlvbiB3aGVuIGFjY2Vzc2luZwovLyBhIGZpZWxkIGZyb20gd2luZG93LmxvY2F0aW9uIGlmIGRvY3VtZW50LmRvbWFpbiBoYXMgYmVlbiBzZXQKdHJ5IHsKCWFqYXhMb2NhdGlvbiA9IGxvY2F0aW9uLmhyZWY7Cn0gY2F0Y2goIGUgKSB7CgkvLyBVc2UgdGhlIGhyZWYgYXR0cmlidXRlIG9mIGFuIEEgZWxlbWVudAoJLy8gc2luY2UgSUUgd2lsbCBtb2RpZnkgaXQgZ2l2ZW4gZG9jdW1lbnQubG9jYXRpb24KCWFqYXhMb2NhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJhIiApOwoJYWpheExvY2F0aW9uLmhyZWYgPSAiIjsKCWFqYXhMb2NhdGlvbiA9IGFqYXhMb2NhdGlvbi5ocmVmOwp9CgovLyBTZWdtZW50IGxvY2F0aW9uIGludG8gcGFydHMKYWpheExvY1BhcnRzID0gcnVybC5leGVjKCBhamF4TG9jYXRpb24udG9Mb3dlckNhc2UoKSApIHx8IFtdOwoKLy8gQmFzZSAiY29uc3RydWN0b3IiIGZvciBqUXVlcnkuYWpheFByZWZpbHRlciBhbmQgalF1ZXJ5LmFqYXhUcmFuc3BvcnQKZnVuY3Rpb24gYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUgKSB7CgoJLy8gZGF0YVR5cGVFeHByZXNzaW9uIGlzIG9wdGlvbmFsIGFuZCBkZWZhdWx0cyB0byAiKiIKCXJldHVybiBmdW5jdGlvbiggZGF0YVR5cGVFeHByZXNzaW9uLCBmdW5jICkgewoKCQlpZiAoIHR5cGVvZiBkYXRhVHlwZUV4cHJlc3Npb24gIT09ICJzdHJpbmciICkgewoJCQlmdW5jID0gZGF0YVR5cGVFeHByZXNzaW9uOwoJCQlkYXRhVHlwZUV4cHJlc3Npb24gPSAiKiI7CgkJfQoKCQl2YXIgZGF0YVR5cGUsCgkJCWkgPSAwLAoJCQlkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbXTsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZnVuYyApICkgewoJCQkvLyBGb3IgZWFjaCBkYXRhVHlwZSBpbiB0aGUgZGF0YVR5cGVFeHByZXNzaW9uCgkJCXdoaWxlICggKGRhdGFUeXBlID0gZGF0YVR5cGVzW2krK10pICkgewoJCQkJLy8gUHJlcGVuZCBpZiByZXF1ZXN0ZWQKCQkJCWlmICggZGF0YVR5cGVbMF0gPT09ICIrIiApIHsKCQkJCQlkYXRhVHlwZSA9IGRhdGFUeXBlLnNsaWNlKCAxICkgfHwgIioiOwoJCQkJCShzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10pLnVuc2hpZnQoIGZ1bmMgKTsKCgkJCQkvLyBPdGhlcndpc2UgYXBwZW5kCgkJCQl9IGVsc2UgewoJCQkJCShzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10pLnB1c2goIGZ1bmMgKTsKCQkJCX0KCQkJfQoJCX0KCX07Cn0KCi8vIEJhc2UgaW5zcGVjdGlvbiBmdW5jdGlvbiBmb3IgcHJlZmlsdGVycyBhbmQgdHJhbnNwb3J0cwpmdW5jdGlvbiBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggc3RydWN0dXJlLCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSICkgewoKCXZhciBpbnNwZWN0ZWQgPSB7fSwKCQlzZWVraW5nVHJhbnNwb3J0ID0gKCBzdHJ1Y3R1cmUgPT09IHRyYW5zcG9ydHMgKTsKCglmdW5jdGlvbiBpbnNwZWN0KCBkYXRhVHlwZSApIHsKCQl2YXIgc2VsZWN0ZWQ7CgkJaW5zcGVjdGVkWyBkYXRhVHlwZSBdID0gdHJ1ZTsKCQlqUXVlcnkuZWFjaCggc3RydWN0dXJlWyBkYXRhVHlwZSBdIHx8IFtdLCBmdW5jdGlvbiggXywgcHJlZmlsdGVyT3JGYWN0b3J5ICkgewoJCQl2YXIgZGF0YVR5cGVPclRyYW5zcG9ydCA9IHByZWZpbHRlck9yRmFjdG9yeSggb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiApOwoJCQlpZiggdHlwZW9mIGRhdGFUeXBlT3JUcmFuc3BvcnQgPT09ICJzdHJpbmciICYmICFzZWVraW5nVHJhbnNwb3J0ICYmICFpbnNwZWN0ZWRbIGRhdGFUeXBlT3JUcmFuc3BvcnQgXSApIHsKCQkJCW9wdGlvbnMuZGF0YVR5cGVzLnVuc2hpZnQoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCWluc3BlY3QoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfSBlbHNlIGlmICggc2Vla2luZ1RyYW5zcG9ydCApIHsKCQkJCXJldHVybiAhKCBzZWxlY3RlZCA9IGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJfQoJCX0pOwoJCXJldHVybiBzZWxlY3RlZDsKCX0KCglyZXR1cm4gaW5zcGVjdCggb3B0aW9ucy5kYXRhVHlwZXNbIDAgXSApIHx8ICFpbnNwZWN0ZWRbICIqIiBdICYmIGluc3BlY3QoICIqIiApOwp9CgovLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnMKLy8gdGhhdCB0YWtlcyAiZmxhdCIgb3B0aW9ucyAobm90IHRvIGJlIGRlZXAgZXh0ZW5kZWQpCi8vIEZpeGVzICM5ODg3CmZ1bmN0aW9uIGFqYXhFeHRlbmQoIHRhcmdldCwgc3JjICkgewoJdmFyIGRlZXAsIGtleSwKCQlmbGF0T3B0aW9ucyA9IGpRdWVyeS5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307CgoJZm9yICgga2V5IGluIHNyYyApIHsKCQlpZiAoIHNyY1sga2V5IF0gIT09IHVuZGVmaW5lZCApIHsKCQkJKCBmbGF0T3B0aW9uc1sga2V5IF0gPyB0YXJnZXQgOiAoIGRlZXAgfHwgKGRlZXAgPSB7fSkgKSApWyBrZXkgXSA9IHNyY1sga2V5IF07CgkJfQoJfQoJaWYgKCBkZWVwICkgewoJCWpRdWVyeS5leHRlbmQoIHRydWUsIHRhcmdldCwgZGVlcCApOwoJfQoKCXJldHVybiB0YXJnZXQ7Cn0KCmpRdWVyeS5mbi5sb2FkID0gZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsKCWlmICggdHlwZW9mIHVybCAhPT0gInN0cmluZyIgJiYgX2xvYWQgKSB7CgkJcmV0dXJuIF9sb2FkLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCX0KCgl2YXIgc2VsZWN0b3IsIHJlc3BvbnNlLCB0eXBlLAoJCXNlbGYgPSB0aGlzLAoJCW9mZiA9IHVybC5pbmRleE9mKCIgIik7CgoJaWYgKCBvZmYgPj0gMCApIHsKCQlzZWxlY3RvciA9IHVybC5zbGljZSggb2ZmLCB1cmwubGVuZ3RoICk7CgkJdXJsID0gdXJsLnNsaWNlKCAwLCBvZmYgKTsKCX0KCgkvLyBJZiBpdCdzIGEgZnVuY3Rpb24KCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHBhcmFtcyApICkgewoKCQkvLyBXZSBhc3N1bWUgdGhhdCBpdCdzIHRoZSBjYWxsYmFjawoJCWNhbGxiYWNrID0gcGFyYW1zOwoJCXBhcmFtcyA9IHVuZGVmaW5lZDsKCgkvLyBPdGhlcndpc2UsIGJ1aWxkIGEgcGFyYW0gc3RyaW5nCgl9IGVsc2UgaWYgKCBwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcyA9PT0gIm9iamVjdCIgKSB7CgkJdHlwZSA9ICJQT1NUIjsKCX0KCgkvLyBJZiB3ZSBoYXZlIGVsZW1lbnRzIHRvIG1vZGlmeSwgbWFrZSB0aGUgcmVxdWVzdAoJaWYgKCBzZWxmLmxlbmd0aCA+IDAgKSB7CgkJalF1ZXJ5LmFqYXgoewoJCQl1cmw6IHVybCwKCgkJCS8vIGlmICJ0eXBlIiB2YXJpYWJsZSBpcyB1bmRlZmluZWQsIHRoZW4gIkdFVCIgbWV0aG9kIHdpbGwgYmUgdXNlZAoJCQl0eXBlOiB0eXBlLAoJCQlkYXRhVHlwZTogImh0bWwiLAoJCQlkYXRhOiBwYXJhbXMKCQl9KS5kb25lKGZ1bmN0aW9uKCByZXNwb25zZVRleHQgKSB7CgoJCQkvLyBTYXZlIHJlc3BvbnNlIGZvciB1c2UgaW4gY29tcGxldGUgY2FsbGJhY2sKCQkJcmVzcG9uc2UgPSBhcmd1bWVudHM7CgoJCQlzZWxmLmh0bWwoIHNlbGVjdG9yID8KCgkJCQkvLyBJZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWQsIGxvY2F0ZSB0aGUgcmlnaHQgZWxlbWVudHMgaW4gYSBkdW1teSBkaXYKCQkJCS8vIEV4Y2x1ZGUgc2NyaXB0cyB0byBhdm9pZCBJRSAnUGVybWlzc2lvbiBEZW5pZWQnIGVycm9ycwoJCQkJalF1ZXJ5KCI8ZGl2PiIpLmFwcGVuZCggalF1ZXJ5LnBhcnNlSFRNTCggcmVzcG9uc2VUZXh0ICkgKS5maW5kKCBzZWxlY3RvciApIDoKCgkJCQkvLyBPdGhlcndpc2UgdXNlIHRoZSBmdWxsIHJlc3VsdAoJCQkJcmVzcG9uc2VUZXh0ICk7CgoJCX0pLmNvbXBsZXRlKCBjYWxsYmFjayAmJiBmdW5jdGlvbigganFYSFIsIHN0YXR1cyApIHsKCQkJc2VsZi5lYWNoKCBjYWxsYmFjaywgcmVzcG9uc2UgfHwgWyBqcVhIUi5yZXNwb25zZVRleHQsIHN0YXR1cywganFYSFIgXSApOwoJCX0pOwoJfQoKCXJldHVybiB0aGlzOwp9OwoKLy8gQXR0YWNoIGEgYnVuY2ggb2YgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBjb21tb24gQUpBWCBldmVudHMKalF1ZXJ5LmVhY2goIFsgImFqYXhTdGFydCIsICJhamF4U3RvcCIsICJhamF4Q29tcGxldGUiLCAiYWpheEVycm9yIiwgImFqYXhTdWNjZXNzIiwgImFqYXhTZW5kIiBdLCBmdW5jdGlvbiggaSwgdHlwZSApewoJalF1ZXJ5LmZuWyB0eXBlIF0gPSBmdW5jdGlvbiggZm4gKXsKCQlyZXR1cm4gdGhpcy5vbiggdHlwZSwgZm4gKTsKCX07Cn0pOwoKalF1ZXJ5LmVhY2goIFsgImdldCIsICJwb3N0IiBdLCBmdW5jdGlvbiggaSwgbWV0aG9kICkgewoJalF1ZXJ5WyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB1cmwsIGRhdGEsIGNhbGxiYWNrLCB0eXBlICkgewoJCS8vIHNoaWZ0IGFyZ3VtZW50cyBpZiBkYXRhIGFyZ3VtZW50IHdhcyBvbWl0dGVkCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZGF0YSApICkgewoJCQl0eXBlID0gdHlwZSB8fCBjYWxsYmFjazsKCQkJY2FsbGJhY2sgPSBkYXRhOwoJCQlkYXRhID0gdW5kZWZpbmVkOwoJCX0KCgkJcmV0dXJuIGpRdWVyeS5hamF4KHsKCQkJdXJsOiB1cmwsCgkJCXR5cGU6IG1ldGhvZCwKCQkJZGF0YVR5cGU6IHR5cGUsCgkJCWRhdGE6IGRhdGEsCgkJCXN1Y2Nlc3M6IGNhbGxiYWNrCgkJfSk7Cgl9Owp9KTsKCmpRdWVyeS5leHRlbmQoewoKCS8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllcwoJYWN0aXZlOiAwLAoKCS8vIExhc3QtTW9kaWZpZWQgaGVhZGVyIGNhY2hlIGZvciBuZXh0IHJlcXVlc3QKCWxhc3RNb2RpZmllZDoge30sCglldGFnOiB7fSwKCglhamF4U2V0dGluZ3M6IHsKCQl1cmw6IGFqYXhMb2NhdGlvbiwKCQl0eXBlOiAiR0VUIiwKCQlpc0xvY2FsOiBybG9jYWxQcm90b2NvbC50ZXN0KCBhamF4TG9jUGFydHNbIDEgXSApLAoJCWdsb2JhbDogdHJ1ZSwKCQlwcm9jZXNzRGF0YTogdHJ1ZSwKCQlhc3luYzogdHJ1ZSwKCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsCgkJLyoKCQl0aW1lb3V0OiAwLAoJCWRhdGE6IG51bGwsCgkJZGF0YVR5cGU6IG51bGwsCgkJdXNlcm5hbWU6IG51bGwsCgkJcGFzc3dvcmQ6IG51bGwsCgkJY2FjaGU6IG51bGwsCgkJdGhyb3dzOiBmYWxzZSwKCQl0cmFkaXRpb25hbDogZmFsc2UsCgkJaGVhZGVyczoge30sCgkJKi8KCgkJYWNjZXB0czogewoJCQkiKiI6IGFsbFR5cGVzLAoJCQl0ZXh0OiAidGV4dC9wbGFpbiIsCgkJCWh0bWw6ICJ0ZXh0L2h0bWwiLAoJCQl4bWw6ICJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sIiwKCQkJanNvbjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCIKCQl9LAoKCQljb250ZW50czogewoJCQl4bWw6IC94bWwvLAoJCQlodG1sOiAvaHRtbC8sCgkJCWpzb246IC9qc29uLwoJCX0sCgoJCXJlc3BvbnNlRmllbGRzOiB7CgkJCXhtbDogInJlc3BvbnNlWE1MIiwKCQkJdGV4dDogInJlc3BvbnNlVGV4dCIKCQl9LAoKCQkvLyBEYXRhIGNvbnZlcnRlcnMKCQkvLyBLZXlzIHNlcGFyYXRlIHNvdXJjZSAob3IgY2F0Y2hhbGwgIioiKSBhbmQgZGVzdGluYXRpb24gdHlwZXMgd2l0aCBhIHNpbmdsZSBzcGFjZQoJCWNvbnZlcnRlcnM6IHsKCgkJCS8vIENvbnZlcnQgYW55dGhpbmcgdG8gdGV4dAoJCQkiKiB0ZXh0Ijogd2luZG93LlN0cmluZywKCgkJCS8vIFRleHQgdG8gaHRtbCAodHJ1ZSA9IG5vIHRyYW5zZm9ybWF0aW9uKQoJCQkidGV4dCBodG1sIjogdHJ1ZSwKCgkJCS8vIEV2YWx1YXRlIHRleHQgYXMgYSBqc29uIGV4cHJlc3Npb24KCQkJInRleHQganNvbiI6IGpRdWVyeS5wYXJzZUpTT04sCgoJCQkvLyBQYXJzZSB0ZXh0IGFzIHhtbAoJCQkidGV4dCB4bWwiOiBqUXVlcnkucGFyc2VYTUwKCQl9LAoKCQkvLyBGb3Igb3B0aW9ucyB0aGF0IHNob3VsZG4ndCBiZSBkZWVwIGV4dGVuZGVkOgoJCS8vIHlvdSBjYW4gYWRkIHlvdXIgb3duIGN1c3RvbSBvcHRpb25zIGhlcmUgaWYKCQkvLyBhbmQgd2hlbiB5b3UgY3JlYXRlIG9uZSB0aGF0IHNob3VsZG4ndCBiZQoJCS8vIGRlZXAgZXh0ZW5kZWQgKHNlZSBhamF4RXh0ZW5kKQoJCWZsYXRPcHRpb25zOiB7CgkJCXVybDogdHJ1ZSwKCQkJY29udGV4dDogdHJ1ZQoJCX0KCX0sCgoJLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKCS8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KCS8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCglhamF4U2V0dXA6IGZ1bmN0aW9uKCB0YXJnZXQsIHNldHRpbmdzICkgewoJCXJldHVybiBzZXR0aW5ncyA/CgoJCQkvLyBCdWlsZGluZyBhIHNldHRpbmdzIG9iamVjdAoJCQlhamF4RXh0ZW5kKCBhamF4RXh0ZW5kKCB0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MgKSwgc2V0dGluZ3MgKSA6CgoJCQkvLyBFeHRlbmRpbmcgYWpheFNldHRpbmdzCgkJCWFqYXhFeHRlbmQoIGpRdWVyeS5hamF4U2V0dGluZ3MsIHRhcmdldCApOwoJfSwKCglhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMgKSwKCWFqYXhUcmFuc3BvcnQ6IGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cyApLAoKCS8vIE1haW4gbWV0aG9kCglhamF4OiBmdW5jdGlvbiggdXJsLCBvcHRpb25zICkgewoKCQkvLyBJZiB1cmwgaXMgYW4gb2JqZWN0LCBzaW11bGF0ZSBwcmUtMS41IHNpZ25hdHVyZQoJCWlmICggdHlwZW9mIHVybCA9PT0gIm9iamVjdCIgKSB7CgkJCW9wdGlvbnMgPSB1cmw7CgkJCXVybCA9IHVuZGVmaW5lZDsKCQl9CgoJCS8vIEZvcmNlIG9wdGlvbnMgdG8gYmUgYW4gb2JqZWN0CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCXZhciAvLyBDcm9zcy1kb21haW4gZGV0ZWN0aW9uIHZhcnMKCQkJcGFydHMsCgkJCS8vIExvb3AgdmFyaWFibGUKCQkJaSwKCQkJLy8gVVJMIHdpdGhvdXQgYW50aS1jYWNoZSBwYXJhbQoJCQljYWNoZVVSTCwKCQkJLy8gUmVzcG9uc2UgaGVhZGVycyBhcyBzdHJpbmcKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nLAoJCQkvLyB0aW1lb3V0IGhhbmRsZQoJCQl0aW1lb3V0VGltZXIsCgoJCQkvLyBUbyBrbm93IGlmIGdsb2JhbCBldmVudHMgYXJlIHRvIGJlIGRpc3BhdGNoZWQKCQkJZmlyZUdsb2JhbHMsCgoJCQl0cmFuc3BvcnQsCgkJCS8vIFJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzLAoJCQkvLyBDcmVhdGUgdGhlIGZpbmFsIG9wdGlvbnMgb2JqZWN0CgkJCXMgPSBqUXVlcnkuYWpheFNldHVwKCB7fSwgb3B0aW9ucyApLAoJCQkvLyBDYWxsYmFja3MgY29udGV4dAoJCQljYWxsYmFja0NvbnRleHQgPSBzLmNvbnRleHQgfHwgcywKCQkJLy8gQ29udGV4dCBmb3IgZ2xvYmFsIGV2ZW50cyBpcyBjYWxsYmFja0NvbnRleHQgaWYgaXQgaXMgYSBET00gbm9kZSBvciBqUXVlcnkgY29sbGVjdGlvbgoJCQlnbG9iYWxFdmVudENvbnRleHQgPSBzLmNvbnRleHQgJiYgKCBjYWxsYmFja0NvbnRleHQubm9kZVR5cGUgfHwgY2FsbGJhY2tDb250ZXh0LmpxdWVyeSApID8KCQkJCWpRdWVyeSggY2FsbGJhY2tDb250ZXh0ICkgOgoJCQkJalF1ZXJ5LmV2ZW50LAoJCQkvLyBEZWZlcnJlZHMKCQkJZGVmZXJyZWQgPSBqUXVlcnkuRGVmZXJyZWQoKSwKCQkJY29tcGxldGVEZWZlcnJlZCA9IGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksCgkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCXN0YXR1c0NvZGUgPSBzLnN0YXR1c0NvZGUgfHwge30sCgkJCS8vIEhlYWRlcnMgKHRoZXkgYXJlIHNlbnQgYWxsIGF0IG9uY2UpCgkJCXJlcXVlc3RIZWFkZXJzID0ge30sCgkJCXJlcXVlc3RIZWFkZXJzTmFtZXMgPSB7fSwKCQkJLy8gVGhlIGpxWEhSIHN0YXRlCgkJCXN0YXRlID0gMCwKCQkJLy8gRGVmYXVsdCBhYm9ydCBtZXNzYWdlCgkJCXN0ckFib3J0ID0gImNhbmNlbGVkIiwKCQkJLy8gRmFrZSB4aHIKCQkJanFYSFIgPSB7CgkJCQlyZWFkeVN0YXRlOiAwLAoKCQkJCS8vIEJ1aWxkcyBoZWFkZXJzIGhhc2h0YWJsZSBpZiBuZWVkZWQKCQkJCWdldFJlc3BvbnNlSGVhZGVyOiBmdW5jdGlvbigga2V5ICkgewoJCQkJCXZhciBtYXRjaDsKCQkJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJCQlpZiAoICFyZXNwb25zZUhlYWRlcnMgKSB7CgkJCQkJCQlyZXNwb25zZUhlYWRlcnMgPSB7fTsKCQkJCQkJCXdoaWxlICggKG1hdGNoID0gcmhlYWRlcnMuZXhlYyggcmVzcG9uc2VIZWFkZXJzU3RyaW5nICkpICkgewoJCQkJCQkJCXJlc3BvbnNlSGVhZGVyc1sgbWF0Y2hbMV0udG9Mb3dlckNhc2UoKSBdID0gbWF0Y2hbIDIgXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQltYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1sga2V5LnRvTG93ZXJDYXNlKCkgXTsKCQkJCQl9CgkJCQkJcmV0dXJuIG1hdGNoID09IG51bGwgPyBudWxsIDogbWF0Y2g7CgkJCQl9LAoKCQkJCS8vIFJhdyBzdHJpbmcKCQkJCWdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlID09PSAyID8gcmVzcG9uc2VIZWFkZXJzU3RyaW5nIDogbnVsbDsKCQkJCX0sCgoJCQkJLy8gQ2FjaGVzIHRoZSBoZWFkZXIKCQkJCXNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQkJCQl2YXIgbG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCW5hbWUgPSByZXF1ZXN0SGVhZGVyc05hbWVzWyBsbmFtZSBdID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSB8fCBuYW1lOwoJCQkJCQlyZXF1ZXN0SGVhZGVyc1sgbmFtZSBdID0gdmFsdWU7CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQkvLyBPdmVycmlkZXMgcmVzcG9uc2UgY29udGVudC10eXBlIGhlYWRlcgoJCQkJb3ZlcnJpZGVNaW1lVHlwZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCXMubWltZVR5cGUgPSB0eXBlOwoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MKCQkJCXN0YXR1c0NvZGU6IGZ1bmN0aW9uKCBtYXAgKSB7CgkJCQkJdmFyIGNvZGU7CgkJCQkJaWYgKCBtYXAgKSB7CgkJCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCQkJZm9yICggY29kZSBpbiBtYXAgKSB7CgkJCQkJCQkJLy8gTGF6eS1hZGQgdGhlIG5ldyBjYWxsYmFjayBpbiBhIHdheSB0aGF0IHByZXNlcnZlcyBvbGQgb25lcwoJCQkJCQkJCXN0YXR1c0NvZGVbIGNvZGUgXSA9IFsgc3RhdHVzQ29kZVsgY29kZSBdLCBtYXBbIGNvZGUgXSBdOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gRXhlY3V0ZSB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2tzCgkJCQkJCQlqcVhIUi5hbHdheXMoIG1hcFsganFYSFIuc3RhdHVzIF0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gQ2FuY2VsIHRoZSByZXF1ZXN0CgkJCQlhYm9ydDogZnVuY3Rpb24oIHN0YXR1c1RleHQgKSB7CgkJCQkJdmFyIGZpbmFsVGV4dCA9IHN0YXR1c1RleHQgfHwgc3RyQWJvcnQ7CgkJCQkJaWYgKCB0cmFuc3BvcnQgKSB7CgkJCQkJCXRyYW5zcG9ydC5hYm9ydCggZmluYWxUZXh0ICk7CgkJCQkJfQoJCQkJCWRvbmUoIDAsIGZpbmFsVGV4dCApOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfQoJCQl9OwoKCQkvLyBBdHRhY2ggZGVmZXJyZWRzCgkJZGVmZXJyZWQucHJvbWlzZSgganFYSFIgKS5jb21wbGV0ZSA9IGNvbXBsZXRlRGVmZXJyZWQuYWRkOwoJCWpxWEhSLnN1Y2Nlc3MgPSBqcVhIUi5kb25lOwoJCWpxWEhSLmVycm9yID0ganFYSFIuZmFpbDsKCgkJLy8gUmVtb3ZlIGhhc2ggY2hhcmFjdGVyICgjNzUzMTogYW5kIHN0cmluZyBwcm9tb3Rpb24pCgkJLy8gQWRkIHByb3RvY29sIGlmIG5vdCBwcm92aWRlZCAoIzU4NjY6IElFNyBpc3N1ZSB3aXRoIHByb3RvY29sLWxlc3MgdXJscykKCQkvLyBIYW5kbGUgZmFsc3kgdXJsIGluIHRoZSBzZXR0aW5ncyBvYmplY3QgKCMxMDA5MzogY29uc2lzdGVuY3kgd2l0aCBvbGQgc2lnbmF0dXJlKQoJCS8vIFdlIGFsc28gdXNlIHRoZSB1cmwgcGFyYW1ldGVyIGlmIGF2YWlsYWJsZQoJCXMudXJsID0gKCAoIHVybCB8fCBzLnVybCB8fCBhamF4TG9jYXRpb24gKSArICIiICkucmVwbGFjZSggcmhhc2gsICIiICkucmVwbGFjZSggcnByb3RvY29sLCBhamF4TG9jUGFydHNbIDEgXSArICIvLyIgKTsKCgkJLy8gQWxpYXMgbWV0aG9kIG9wdGlvbiB0byB0eXBlIGFzIHBlciB0aWNrZXQgIzEyMDA0CgkJcy50eXBlID0gb3B0aW9ucy5tZXRob2QgfHwgb3B0aW9ucy50eXBlIHx8IHMubWV0aG9kIHx8IHMudHlwZTsKCgkJLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdAoJCXMuZGF0YVR5cGVzID0galF1ZXJ5LnRyaW0oIHMuZGF0YVR5cGUgfHwgIioiICkudG9Mb3dlckNhc2UoKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbIiJdOwoKCQkvLyBBIGNyb3NzLWRvbWFpbiByZXF1ZXN0IGlzIGluIG9yZGVyIHdoZW4gd2UgaGF2ZSBhIHByb3RvY29sOmhvc3Q6cG9ydCBtaXNtYXRjaAoJCWlmICggcy5jcm9zc0RvbWFpbiA9PSBudWxsICkgewoJCQlwYXJ0cyA9IHJ1cmwuZXhlYyggcy51cmwudG9Mb3dlckNhc2UoKSApOwoJCQlzLmNyb3NzRG9tYWluID0gISEoIHBhcnRzICYmCgkJCQkoIHBhcnRzWyAxIF0gIT09IGFqYXhMb2NQYXJ0c1sgMSBdIHx8IHBhcnRzWyAyIF0gIT09IGFqYXhMb2NQYXJ0c1sgMiBdIHx8CgkJCQkJKCBwYXJ0c1sgMyBdIHx8ICggcGFydHNbIDEgXSA9PT0gImh0dHA6IiA/IDgwIDogNDQzICkgKSAhPQoJCQkJCQkoIGFqYXhMb2NQYXJ0c1sgMyBdIHx8ICggYWpheExvY1BhcnRzWyAxIF0gPT09ICJodHRwOiIgPyA4MCA6IDQ0MyApICkgKQoJCQkpOwoJCX0KCgkJLy8gQ29udmVydCBkYXRhIGlmIG5vdCBhbHJlYWR5IGEgc3RyaW5nCgkJaWYgKCBzLmRhdGEgJiYgcy5wcm9jZXNzRGF0YSAmJiB0eXBlb2Ygcy5kYXRhICE9PSAic3RyaW5nIiApIHsKCQkJcy5kYXRhID0galF1ZXJ5LnBhcmFtKCBzLmRhdGEsIHMudHJhZGl0aW9uYWwgKTsKCQl9CgoJCS8vIEFwcGx5IHByZWZpbHRlcnMKCQlpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggcHJlZmlsdGVycywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgcmVxdWVzdCB3YXMgYWJvcnRlZCBpbnNpZGUgYSBwcmVmaWx0ZXIsIHN0b3AgdGhlcmUKCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQlyZXR1cm4ganFYSFI7CgkJfQoKCQkvLyBXZSBjYW4gZmlyZSBnbG9iYWwgZXZlbnRzIGFzIG9mIG5vdyBpZiBhc2tlZCB0bwoJCWZpcmVHbG9iYWxzID0gcy5nbG9iYWw7CgoJCS8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHMKCQlpZiAoIGZpcmVHbG9iYWxzICYmIGpRdWVyeS5hY3RpdmUrKyA9PT0gMCApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpOwoJCX0KCgkJLy8gVXBwZXJjYXNlIHRoZSB0eXBlCgkJcy50eXBlID0gcy50eXBlLnRvVXBwZXJDYXNlKCk7CgoJCS8vIERldGVybWluZSBpZiByZXF1ZXN0IGhhcyBjb250ZW50CgkJcy5oYXNDb250ZW50ID0gIXJub0NvbnRlbnQudGVzdCggcy50eXBlICk7CgoJCS8vIFNhdmUgdGhlIFVSTCBpbiBjYXNlIHdlJ3JlIHRveWluZyB3aXRoIHRoZSBJZi1Nb2RpZmllZC1TaW5jZQoJCS8vIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciBsYXRlciBvbgoJCWNhY2hlVVJMID0gcy51cmw7CgoJCS8vIE1vcmUgb3B0aW9ucyBoYW5kbGluZyBmb3IgcmVxdWVzdHMgd2l0aCBubyBjb250ZW50CgkJaWYgKCAhcy5oYXNDb250ZW50ICkgewoKCQkJLy8gSWYgZGF0YSBpcyBhdmFpbGFibGUsIGFwcGVuZCBkYXRhIHRvIHVybAoJCQlpZiAoIHMuZGF0YSApIHsKCQkJCWNhY2hlVVJMID0gKCBzLnVybCArPSAoIGFqYXhfcnF1ZXJ5LnRlc3QoIGNhY2hlVVJMICkgPyAiJiIgOiAiPyIgKSArIHMuZGF0YSApOwoJCQkJLy8gIzk2ODI6IHJlbW92ZSBkYXRhIHNvIHRoYXQgaXQncyBub3QgdXNlZCBpbiBhbiBldmVudHVhbCByZXRyeQoJCQkJZGVsZXRlIHMuZGF0YTsKCQkJfQoKCQkJLy8gQWRkIGFudGktY2FjaGUgaW4gdXJsIGlmIG5lZWRlZAoJCQlpZiAoIHMuY2FjaGUgPT09IGZhbHNlICkgewoJCQkJcy51cmwgPSBydHMudGVzdCggY2FjaGVVUkwgKSA/CgoJCQkJCS8vIElmIHRoZXJlIGlzIGFscmVhZHkgYSAnXycgcGFyYW1ldGVyLCBzZXQgaXRzIHZhbHVlCgkJCQkJY2FjaGVVUkwucmVwbGFjZSggcnRzLCAiJDFfPSIgKyBhamF4X25vbmNlKysgKSA6CgoJCQkJCS8vIE90aGVyd2lzZSBhZGQgb25lIHRvIHRoZSBlbmQKCQkJCQljYWNoZVVSTCArICggYWpheF9ycXVlcnkudGVzdCggY2FjaGVVUkwgKSA/ICImIiA6ICI/IiApICsgIl89IiArIGFqYXhfbm9uY2UrKzsKCQkJfQoJCX0KCgkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJaWYgKCBqUXVlcnkubGFzdE1vZGlmaWVkWyBjYWNoZVVSTCBdICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU1vZGlmaWVkLVNpbmNlIiwgalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSApOwoJCQl9CgkJCWlmICggalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gKSB7CgkJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiSWYtTm9uZS1NYXRjaCIsIGpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdICk7CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgY29ycmVjdCBoZWFkZXIsIGlmIGRhdGEgaXMgYmVpbmcgc2VudAoJCWlmICggcy5kYXRhICYmIHMuaGFzQ29udGVudCAmJiBzLmNvbnRlbnRUeXBlICE9PSBmYWxzZSB8fCBvcHRpb25zLmNvbnRlbnRUeXBlICkgewoJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiQ29udGVudC1UeXBlIiwgcy5jb250ZW50VHlwZSApOwoJCX0KCgkJLy8gU2V0IHRoZSBBY2NlcHRzIGhlYWRlciBmb3IgdGhlIHNlcnZlciwgZGVwZW5kaW5nIG9uIHRoZSBkYXRhVHlwZQoJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoCgkJCSJBY2NlcHQiLAoJCQlzLmRhdGFUeXBlc1sgMCBdICYmIHMuYWNjZXB0c1sgcy5kYXRhVHlwZXNbMF0gXSA/CgkJCQlzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gKyAoIHMuZGF0YVR5cGVzWyAwIF0gIT09ICIqIiA/ICIsICIgKyBhbGxUeXBlcyArICI7IHE9MC4wMSIgOiAiIiApIDoKCQkJCXMuYWNjZXB0c1sgIioiIF0KCQkpOwoKCQkvLyBDaGVjayBmb3IgaGVhZGVycyBvcHRpb24KCQlmb3IgKCBpIGluIHMuaGVhZGVycyApIHsKCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggaSwgcy5oZWFkZXJzWyBpIF0gKTsKCQl9CgoJCS8vIEFsbG93IGN1c3RvbSBoZWFkZXJzL21pbWV0eXBlcyBhbmQgZWFybHkgYWJvcnQKCQlpZiAoIHMuYmVmb3JlU2VuZCAmJiAoIHMuYmVmb3JlU2VuZC5jYWxsKCBjYWxsYmFja0NvbnRleHQsIGpxWEhSLCBzICkgPT09IGZhbHNlIHx8IHN0YXRlID09PSAyICkgKSB7CgkJCS8vIEFib3J0IGlmIG5vdCBkb25lIGFscmVhZHkgYW5kIHJldHVybgoJCQlyZXR1cm4ganFYSFIuYWJvcnQoKTsKCQl9CgoJCS8vIGFib3J0aW5nIGlzIG5vIGxvbmdlciBhIGNhbmNlbGxhdGlvbgoJCXN0ckFib3J0ID0gImFib3J0IjsKCgkJLy8gSW5zdGFsbCBjYWxsYmFja3Mgb24gZGVmZXJyZWRzCgkJZm9yICggaSBpbiB7IHN1Y2Nlc3M6IDEsIGVycm9yOiAxLCBjb21wbGV0ZTogMSB9ICkgewoJCQlqcVhIUlsgaSBdKCBzWyBpIF0gKTsKCQl9CgoJCS8vIEdldCB0cmFuc3BvcnQKCQl0cmFuc3BvcnQgPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0CgkJaWYgKCAhdHJhbnNwb3J0ICkgewoJCQlkb25lKCAtMSwgIk5vIFRyYW5zcG9ydCIgKTsKCQl9IGVsc2UgewoJCQlqcVhIUi5yZWFkeVN0YXRlID0gMTsKCgkJCS8vIFNlbmQgZ2xvYmFsIGV2ZW50CgkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQlnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggImFqYXhTZW5kIiwgWyBqcVhIUiwgcyBdICk7CgkJCX0KCQkJLy8gVGltZW91dAoJCQlpZiAoIHMuYXN5bmMgJiYgcy50aW1lb3V0ID4gMCApIHsKCQkJCXRpbWVvdXRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQkJanFYSFIuYWJvcnQoInRpbWVvdXQiKTsKCQkJCX0sIHMudGltZW91dCApOwoJCQl9CgoJCQl0cnkgewoJCQkJc3RhdGUgPSAxOwoJCQkJdHJhbnNwb3J0LnNlbmQoIHJlcXVlc3RIZWFkZXJzLCBkb25lICk7CgkJCX0gY2F0Y2ggKCBlICkgewoJCQkJLy8gUHJvcGFnYXRlIGV4Y2VwdGlvbiBhcyBlcnJvciBpZiBub3QgZG9uZQoJCQkJaWYgKCBzdGF0ZSA8IDIgKSB7CgkJCQkJZG9uZSggLTEsIGUgKTsKCQkJCS8vIFNpbXBseSByZXRocm93IG90aGVyd2lzZQoJCQkJfSBlbHNlIHsKCQkJCQl0aHJvdyBlOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsYmFjayBmb3Igd2hlbiBldmVyeXRoaW5nIGlzIGRvbmUKCQlmdW5jdGlvbiBkb25lKCBzdGF0dXMsIG5hdGl2ZVN0YXR1c1RleHQsIHJlc3BvbnNlcywgaGVhZGVycyApIHsKCQkJdmFyIGlzU3VjY2Vzcywgc3VjY2VzcywgZXJyb3IsIHJlc3BvbnNlLCBtb2RpZmllZCwKCQkJCXN0YXR1c1RleHQgPSBuYXRpdmVTdGF0dXNUZXh0OwoKCQkJLy8gQ2FsbGVkIG9uY2UKCQkJaWYgKCBzdGF0ZSA9PT0gMiApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU3RhdGUgaXMgImRvbmUiIG5vdwoJCQlzdGF0ZSA9IDI7CgoJCQkvLyBDbGVhciB0aW1lb3V0IGlmIGl0IGV4aXN0cwoJCQlpZiAoIHRpbWVvdXRUaW1lciApIHsKCQkJCWNsZWFyVGltZW91dCggdGltZW91dFRpbWVyICk7CgkJCX0KCgkJCS8vIERlcmVmZXJlbmNlIHRyYW5zcG9ydCBmb3IgZWFybHkgZ2FyYmFnZSBjb2xsZWN0aW9uCgkJCS8vIChubyBtYXR0ZXIgaG93IGxvbmcgdGhlIGpxWEhSIG9iamVjdCB3aWxsIGJlIHVzZWQpCgkJCXRyYW5zcG9ydCA9IHVuZGVmaW5lZDsKCgkJCS8vIENhY2hlIHJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nID0gaGVhZGVycyB8fCAiIjsKCgkJCS8vIFNldCByZWFkeVN0YXRlCgkJCWpxWEhSLnJlYWR5U3RhdGUgPSBzdGF0dXMgPiAwID8gNCA6IDA7CgoJCQkvLyBHZXQgcmVzcG9uc2UgZGF0YQoJCQlpZiAoIHJlc3BvbnNlcyApIHsKCQkJCXJlc3BvbnNlID0gYWpheEhhbmRsZVJlc3BvbnNlcyggcywganFYSFIsIHJlc3BvbnNlcyApOwoJCQl9CgoJCQkvLyBJZiBzdWNjZXNzZnVsLCBoYW5kbGUgdHlwZSBjaGFpbmluZwoJCQlpZiAoIHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwIHx8IHN0YXR1cyA9PT0gMzA0ICkgewoKCQkJCS8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuCgkJCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSA9IG1vZGlmaWVkOwoJCQkJCX0KCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gaWYgbm8gY29udGVudAoJCQkJaWYgKCBzdGF0dXMgPT09IDIwNCApIHsKCQkJCQlpc1N1Y2Nlc3MgPSB0cnVlOwoJCQkJCXN0YXR1c1RleHQgPSAibm9jb250ZW50IjsKCgkJCQkvLyBpZiBub3QgbW9kaWZpZWQKCQkJCX0gZWxzZSBpZiAoIHN0YXR1cyA9PT0gMzA0ICkgewoJCQkJCWlzU3VjY2VzcyA9IHRydWU7CgkJCQkJc3RhdHVzVGV4dCA9ICJub3Rtb2RpZmllZCI7CgoJCQkJLy8gSWYgd2UgaGF2ZSBkYXRhLCBsZXQncyBjb252ZXJ0IGl0CgkJCQl9IGVsc2UgewoJCQkJCWlzU3VjY2VzcyA9IGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSApOwoJCQkJCXN0YXR1c1RleHQgPSBpc1N1Y2Nlc3Muc3RhdGU7CgkJCQkJc3VjY2VzcyA9IGlzU3VjY2Vzcy5kYXRhOwoJCQkJCWVycm9yID0gaXNTdWNjZXNzLmVycm9yOwoJCQkJCWlzU3VjY2VzcyA9ICFlcnJvcjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIFdlIGV4dHJhY3QgZXJyb3IgZnJvbSBzdGF0dXNUZXh0CgkJCQkvLyB0aGVuIG5vcm1hbGl6ZSBzdGF0dXNUZXh0IGFuZCBzdGF0dXMgZm9yIG5vbi1hYm9ydHMKCQkJCWVycm9yID0gc3RhdHVzVGV4dDsKCQkJCWlmICggc3RhdHVzIHx8ICFzdGF0dXNUZXh0ICkgewoJCQkJCXN0YXR1c1RleHQgPSAiZXJyb3IiOwoJCQkJCWlmICggc3RhdHVzIDwgMCApIHsKCQkJCQkJc3RhdHVzID0gMDsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0CgkJCWpxWEhSLnN0YXR1cyA9IHN0YXR1czsKCQkJanFYSFIuc3RhdHVzVGV4dCA9ICggbmF0aXZlU3RhdHVzVGV4dCB8fCBzdGF0dXNUZXh0ICkgKyAiIjsKCgkJCS8vIFN1Y2Nlc3MvRXJyb3IKCQkJaWYgKCBpc1N1Y2Nlc3MgKSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIHN1Y2Nlc3MsIHN0YXR1c1RleHQsIGpxWEhSIF0gKTsKCQkJfSBlbHNlIHsKCQkJCWRlZmVycmVkLnJlamVjdFdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlqcVhIUi5zdGF0dXNDb2RlKCBzdGF0dXNDb2RlICk7CgkJCXN0YXR1c0NvZGUgPSB1bmRlZmluZWQ7CgoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoIGlzU3VjY2VzcyA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwKCQkJCQlbIGpxWEhSLCBzLCBpc1N1Y2Nlc3MgPyBzdWNjZXNzIDogZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBDb21wbGV0ZQoJCQljb21wbGV0ZURlZmVycmVkLmZpcmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsganFYSFIsIHN0YXR1c1RleHQgXSApOwoKCQkJaWYgKCBmaXJlR2xvYmFscyApIHsKCQkJCWdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCAiYWpheENvbXBsZXRlIiwgWyBqcVhIUiwgcyBdICk7CgkJCQkvLyBIYW5kbGUgdGhlIGdsb2JhbCBBSkFYIGNvdW50ZXIKCQkJCWlmICggISggLS1qUXVlcnkuYWN0aXZlICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIik7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBqcVhIUjsKCX0sCgoJZ2V0U2NyaXB0OiBmdW5jdGlvbiggdXJsLCBjYWxsYmFjayApIHsKCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCB1bmRlZmluZWQsIGNhbGxiYWNrLCAic2NyaXB0IiApOwoJfSwKCglnZXRKU09OOiBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjayApIHsKCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCBkYXRhLCBjYWxsYmFjaywgImpzb24iICk7Cgl9Cn0pOwoKLyogSGFuZGxlcyByZXNwb25zZXMgdG8gYW4gYWpheCByZXF1ZXN0OgogKiAtIHNldHMgYWxsIHJlc3BvbnNlWFhYIGZpZWxkcyBhY2NvcmRpbmdseQogKiAtIGZpbmRzIHRoZSByaWdodCBkYXRhVHlwZSAobWVkaWF0ZXMgYmV0d2VlbiBjb250ZW50LXR5cGUgYW5kIGV4cGVjdGVkIGRhdGFUeXBlKQogKiAtIHJldHVybnMgdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKICovCmZ1bmN0aW9uIGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKSB7Cgl2YXIgZmlyc3REYXRhVHlwZSwgY3QsIGZpbmFsRGF0YVR5cGUsIHR5cGUsCgkJY29udGVudHMgPSBzLmNvbnRlbnRzLAoJCWRhdGFUeXBlcyA9IHMuZGF0YVR5cGVzLAoJCXJlc3BvbnNlRmllbGRzID0gcy5yZXNwb25zZUZpZWxkczsKCgkvLyBGaWxsIHJlc3BvbnNlWFhYIGZpZWxkcwoJZm9yICggdHlwZSBpbiByZXNwb25zZUZpZWxkcyApIHsKCQlpZiAoIHR5cGUgaW4gcmVzcG9uc2VzICkgewoJCQlqcVhIUlsgcmVzcG9uc2VGaWVsZHNbdHlwZV0gXSA9IHJlc3BvbnNlc1sgdHlwZSBdOwoJCX0KCX0KCgkvLyBSZW1vdmUgYXV0byBkYXRhVHlwZSBhbmQgZ2V0IGNvbnRlbnQtdHlwZSBpbiB0aGUgcHJvY2VzcwoJd2hpbGUoIGRhdGFUeXBlc1sgMCBdID09PSAiKiIgKSB7CgkJZGF0YVR5cGVzLnNoaWZ0KCk7CgkJaWYgKCBjdCA9PT0gdW5kZWZpbmVkICkgewoJCQljdCA9IHMubWltZVR5cGUgfHwganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpOwoJCX0KCX0KCgkvLyBDaGVjayBpZiB3ZSdyZSBkZWFsaW5nIHdpdGggYSBrbm93biBjb250ZW50LXR5cGUKCWlmICggY3QgKSB7CgkJZm9yICggdHlwZSBpbiBjb250ZW50cyApIHsKCQkJaWYgKCBjb250ZW50c1sgdHlwZSBdICYmIGNvbnRlbnRzWyB0eXBlIF0udGVzdCggY3QgKSApIHsKCQkJCWRhdGFUeXBlcy51bnNoaWZ0KCB0eXBlICk7CgkJCQlicmVhazsKCQkJfQoJCX0KCX0KCgkvLyBDaGVjayB0byBzZWUgaWYgd2UgaGF2ZSBhIHJlc3BvbnNlIGZvciB0aGUgZXhwZWN0ZWQgZGF0YVR5cGUKCWlmICggZGF0YVR5cGVzWyAwIF0gaW4gcmVzcG9uc2VzICkgewoJCWZpbmFsRGF0YVR5cGUgPSBkYXRhVHlwZXNbIDAgXTsKCX0gZWxzZSB7CgkJLy8gVHJ5IGNvbnZlcnRpYmxlIGRhdGFUeXBlcwoJCWZvciAoIHR5cGUgaW4gcmVzcG9uc2VzICkgewoJCQlpZiAoICFkYXRhVHlwZXNbIDAgXSB8fCBzLmNvbnZlcnRlcnNbIHR5cGUgKyAiICIgKyBkYXRhVHlwZXNbMF0gXSApIHsKCQkJCWZpbmFsRGF0YVR5cGUgPSB0eXBlOwoJCQkJYnJlYWs7CgkJCX0KCQkJaWYgKCAhZmlyc3REYXRhVHlwZSApIHsKCQkJCWZpcnN0RGF0YVR5cGUgPSB0eXBlOwoJCQl9CgkJfQoJCS8vIE9yIGp1c3QgdXNlIGZpcnN0IG9uZQoJCWZpbmFsRGF0YVR5cGUgPSBmaW5hbERhdGFUeXBlIHx8IGZpcnN0RGF0YVR5cGU7Cgl9CgoJLy8gSWYgd2UgZm91bmQgYSBkYXRhVHlwZQoJLy8gV2UgYWRkIHRoZSBkYXRhVHlwZSB0byB0aGUgbGlzdCBpZiBuZWVkZWQKCS8vIGFuZCByZXR1cm4gdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKCWlmICggZmluYWxEYXRhVHlwZSApIHsKCQlpZiAoIGZpbmFsRGF0YVR5cGUgIT09IGRhdGFUeXBlc1sgMCBdICkgewoJCQlkYXRhVHlwZXMudW5zaGlmdCggZmluYWxEYXRhVHlwZSApOwoJCX0KCQlyZXR1cm4gcmVzcG9uc2VzWyBmaW5hbERhdGFUeXBlIF07Cgl9Cn0KCi8vIENoYWluIGNvbnZlcnNpb25zIGdpdmVuIHRoZSByZXF1ZXN0IGFuZCB0aGUgb3JpZ2luYWwgcmVzcG9uc2UKZnVuY3Rpb24gYWpheENvbnZlcnQoIHMsIHJlc3BvbnNlICkgewoJdmFyIGNvbnYyLCBjdXJyZW50LCBjb252LCB0bXAsCgkJY29udmVydGVycyA9IHt9LAoJCWkgPSAwLAoJCS8vIFdvcmsgd2l0aCBhIGNvcHkgb2YgZGF0YVR5cGVzIGluIGNhc2Ugd2UgbmVlZCB0byBtb2RpZnkgaXQgZm9yIGNvbnZlcnNpb24KCQlkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcy5zbGljZSgpLAoJCXByZXYgPSBkYXRhVHlwZXNbIDAgXTsKCgkvLyBBcHBseSB0aGUgZGF0YUZpbHRlciBpZiBwcm92aWRlZAoJaWYgKCBzLmRhdGFGaWx0ZXIgKSB7CgkJcmVzcG9uc2UgPSBzLmRhdGFGaWx0ZXIoIHJlc3BvbnNlLCBzLmRhdGFUeXBlICk7Cgl9CgoJLy8gQ3JlYXRlIGNvbnZlcnRlcnMgbWFwIHdpdGggbG93ZXJjYXNlZCBrZXlzCglpZiAoIGRhdGFUeXBlc1sgMSBdICkgewoJCWZvciAoIGNvbnYgaW4gcy5jb252ZXJ0ZXJzICkgewoJCQljb252ZXJ0ZXJzWyBjb252LnRvTG93ZXJDYXNlKCkgXSA9IHMuY29udmVydGVyc1sgY29udiBdOwoJCX0KCX0KCgkvLyBDb252ZXJ0IHRvIGVhY2ggc2VxdWVudGlhbCBkYXRhVHlwZSwgdG9sZXJhdGluZyBsaXN0IG1vZGlmaWNhdGlvbgoJZm9yICggOyAoY3VycmVudCA9IGRhdGFUeXBlc1srK2ldKTsgKSB7CgoJCS8vIFRoZXJlJ3Mgb25seSB3b3JrIHRvIGRvIGlmIGN1cnJlbnQgZGF0YVR5cGUgaXMgbm9uLWF1dG8KCQlpZiAoIGN1cnJlbnQgIT09ICIqIiApIHsKCgkJCS8vIENvbnZlcnQgcmVzcG9uc2UgaWYgcHJldiBkYXRhVHlwZSBpcyBub24tYXV0byBhbmQgZGlmZmVycyBmcm9tIGN1cnJlbnQKCQkJaWYgKCBwcmV2ICE9PSAiKiIgJiYgcHJldiAhPT0gY3VycmVudCApIHsKCgkJCQkvLyBTZWVrIGEgZGlyZWN0IGNvbnZlcnRlcgoJCQkJY29udiA9IGNvbnZlcnRlcnNbIHByZXYgKyAiICIgKyBjdXJyZW50IF0gfHwgY29udmVydGVyc1sgIiogIiArIGN1cnJlbnQgXTsKCgkJCQkvLyBJZiBub25lIGZvdW5kLCBzZWVrIGEgcGFpcgoJCQkJaWYgKCAhY29udiApIHsKCQkJCQlmb3IgKCBjb252MiBpbiBjb252ZXJ0ZXJzICkgewoKCQkJCQkJLy8gSWYgY29udjIgb3V0cHV0cyBjdXJyZW50CgkJCQkJCXRtcCA9IGNvbnYyLnNwbGl0KCIgIik7CgkJCQkJCWlmICggdG1wWyAxIF0gPT09IGN1cnJlbnQgKSB7CgoJCQkJCQkJLy8gSWYgcHJldiBjYW4gYmUgY29udmVydGVkIHRvIGFjY2VwdGVkIGlucHV0CgkJCQkJCQljb252ID0gY29udmVydGVyc1sgcHJldiArICIgIiArIHRtcFsgMCBdIF0gfHwKCQkJCQkJCQljb252ZXJ0ZXJzWyAiKiAiICsgdG1wWyAwIF0gXTsKCQkJCQkJCWlmICggY29udiApIHsKCQkJCQkJCQkvLyBDb25kZW5zZSBlcXVpdmFsZW5jZSBjb252ZXJ0ZXJzCgkJCQkJCQkJaWYgKCBjb252ID09PSB0cnVlICkgewoJCQkJCQkJCQljb252ID0gY29udmVydGVyc1sgY29udjIgXTsKCgkJCQkJCQkJLy8gT3RoZXJ3aXNlLCBpbnNlcnQgdGhlIGludGVybWVkaWF0ZSBkYXRhVHlwZQoJCQkJCQkJCX0gZWxzZSBpZiAoIGNvbnZlcnRlcnNbIGNvbnYyIF0gIT09IHRydWUgKSB7CgkJCQkJCQkJCWN1cnJlbnQgPSB0bXBbIDAgXTsKCQkJCQkJCQkJZGF0YVR5cGVzLnNwbGljZSggaS0tLCAwLCBjdXJyZW50ICk7CgkJCQkJCQkJfQoKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBBcHBseSBjb252ZXJ0ZXIgKGlmIG5vdCBhbiBlcXVpdmFsZW5jZSkKCQkJCWlmICggY29udiAhPT0gdHJ1ZSApIHsKCgkJCQkJLy8gVW5sZXNzIGVycm9ycyBhcmUgYWxsb3dlZCB0byBidWJibGUsIGNhdGNoIGFuZCByZXR1cm4gdGhlbQoJCQkJCWlmICggY29udiAmJiBzWyJ0aHJvd3MiXSApIHsKCQkJCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlyZXNwb25zZSA9IGNvbnYoIHJlc3BvbnNlICk7CgkJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkJcmV0dXJuIHsgc3RhdGU6ICJwYXJzZXJlcnJvciIsIGVycm9yOiBjb252ID8gZSA6ICJObyBjb252ZXJzaW9uIGZyb20gIiArIHByZXYgKyAiIHRvICIgKyBjdXJyZW50IH07CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFVwZGF0ZSBwcmV2IGZvciBuZXh0IGl0ZXJhdGlvbgoJCQlwcmV2ID0gY3VycmVudDsKCQl9Cgl9CgoJcmV0dXJuIHsgc3RhdGU6ICJzdWNjZXNzIiwgZGF0YTogcmVzcG9uc2UgfTsKfQovLyBJbnN0YWxsIHNjcmlwdCBkYXRhVHlwZQpqUXVlcnkuYWpheFNldHVwKHsKCWFjY2VwdHM6IHsKCQlzY3JpcHQ6ICJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCIKCX0sCgljb250ZW50czogewoJCXNjcmlwdDogLyg/OmphdmF8ZWNtYSlzY3JpcHQvCgl9LAoJY29udmVydGVyczogewoJCSJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uKCB0ZXh0ICkgewoJCQlqUXVlcnkuZ2xvYmFsRXZhbCggdGV4dCApOwoJCQlyZXR1cm4gdGV4dDsKCQl9Cgl9Cn0pOwoKLy8gSGFuZGxlIGNhY2hlJ3Mgc3BlY2lhbCBjYXNlIGFuZCBnbG9iYWwKalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJzY3JpcHQiLCBmdW5jdGlvbiggcyApIHsKCWlmICggcy5jYWNoZSA9PT0gdW5kZWZpbmVkICkgewoJCXMuY2FjaGUgPSBmYWxzZTsKCX0KCWlmICggcy5jcm9zc0RvbWFpbiApIHsKCQlzLnR5cGUgPSAiR0VUIjsKCQlzLmdsb2JhbCA9IGZhbHNlOwoJfQp9KTsKCi8vIEJpbmQgc2NyaXB0IHRhZyBoYWNrIHRyYW5zcG9ydApqUXVlcnkuYWpheFRyYW5zcG9ydCggInNjcmlwdCIsIGZ1bmN0aW9uKHMpIHsKCgkvLyBUaGlzIHRyYW5zcG9ydCBvbmx5IGRlYWxzIHdpdGggY3Jvc3MgZG9tYWluIHJlcXVlc3RzCglpZiAoIHMuY3Jvc3NEb21haW4gKSB7CgoJCXZhciBzY3JpcHQsCgkJCWhlYWQgPSBkb2N1bWVudC5oZWFkIHx8IGpRdWVyeSgiaGVhZCIpWzBdIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCgkJcmV0dXJuIHsKCgkJCXNlbmQ6IGZ1bmN0aW9uKCBfLCBjYWxsYmFjayApIHsKCgkJCQlzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKCgkJCQlzY3JpcHQuYXN5bmMgPSB0cnVlOwoKCQkJCWlmICggcy5zY3JpcHRDaGFyc2V0ICkgewoJCQkJCXNjcmlwdC5jaGFyc2V0ID0gcy5zY3JpcHRDaGFyc2V0OwoJCQkJfQoKCQkJCXNjcmlwdC5zcmMgPSBzLnVybDsKCgkJCQkvLyBBdHRhY2ggaGFuZGxlcnMgZm9yIGFsbCBicm93c2VycwoJCQkJc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiggXywgaXNBYm9ydCApIHsKCgkJCQkJaWYgKCBpc0Fib3J0IHx8ICFzY3JpcHQucmVhZHlTdGF0ZSB8fCAvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KCBzY3JpcHQucmVhZHlTdGF0ZSApICkgewoKCQkJCQkJLy8gSGFuZGxlIG1lbW9yeSBsZWFrIGluIElFCgkJCQkJCXNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsKCgkJCQkJCS8vIFJlbW92ZSB0aGUgc2NyaXB0CgkJCQkJCWlmICggc2NyaXB0LnBhcmVudE5vZGUgKSB7CgkJCQkJCQlzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggc2NyaXB0ICk7CgkJCQkJCX0KCgkJCQkJCS8vIERlcmVmZXJlbmNlIHRoZSBzY3JpcHQKCQkJCQkJc2NyaXB0ID0gbnVsbDsKCgkJCQkJCS8vIENhbGxiYWNrIGlmIG5vdCBhYm9ydAoJCQkJCQlpZiAoICFpc0Fib3J0ICkgewoJCQkJCQkJY2FsbGJhY2soIDIwMCwgInN1Y2Nlc3MiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9OwoKCQkJCS8vIENpcmN1bXZlbnQgSUU2IGJ1Z3Mgd2l0aCBiYXNlIGVsZW1lbnRzICgjMjcwOSBhbmQgIzQzNzgpIGJ5IHByZXBlbmRpbmcKCQkJCS8vIFVzZSBuYXRpdmUgRE9NIG1hbmlwdWxhdGlvbiB0byBhdm9pZCBvdXIgZG9tTWFuaXAgQUpBWCB0cmlja2VyeQoJCQkJaGVhZC5pbnNlcnRCZWZvcmUoIHNjcmlwdCwgaGVhZC5maXJzdENoaWxkICk7CgkJCX0sCgoJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHNjcmlwdCApIHsKCQkJCQlzY3JpcHQub25sb2FkKCB1bmRlZmluZWQsIHRydWUgKTsKCQkJCX0KCQkJfQoJCX07Cgl9Cn0pOwp2YXIgb2xkQ2FsbGJhY2tzID0gW10sCglyanNvbnAgPSAvKD0pXD8oPz0mfCQpfFw/XD8vOwoKLy8gRGVmYXVsdCBqc29ucCBzZXR0aW5ncwpqUXVlcnkuYWpheFNldHVwKHsKCWpzb25wOiAiY2FsbGJhY2siLAoJanNvbnBDYWxsYmFjazogZnVuY3Rpb24oKSB7CgkJdmFyIGNhbGxiYWNrID0gb2xkQ2FsbGJhY2tzLnBvcCgpIHx8ICggalF1ZXJ5LmV4cGFuZG8gKyAiXyIgKyAoIGFqYXhfbm9uY2UrKyApICk7CgkJdGhpc1sgY2FsbGJhY2sgXSA9IHRydWU7CgkJcmV0dXJuIGNhbGxiYWNrOwoJfQp9KTsKCi8vIERldGVjdCwgbm9ybWFsaXplIG9wdGlvbnMgYW5kIGluc3RhbGwgY2FsbGJhY2tzIGZvciBqc29ucCByZXF1ZXN0cwpqUXVlcnkuYWpheFByZWZpbHRlciggImpzb24ganNvbnAiLCBmdW5jdGlvbiggcywgb3JpZ2luYWxTZXR0aW5ncywganFYSFIgKSB7CgoJdmFyIGNhbGxiYWNrTmFtZSwgb3ZlcndyaXR0ZW4sIHJlc3BvbnNlQ29udGFpbmVyLAoJCWpzb25Qcm9wID0gcy5qc29ucCAhPT0gZmFsc2UgJiYgKCByanNvbnAudGVzdCggcy51cmwgKSA/CgkJCSJ1cmwiIDoKCQkJdHlwZW9mIHMuZGF0YSA9PT0gInN0cmluZyIgJiYgISggcy5jb250ZW50VHlwZSB8fCAiIiApLmluZGV4T2YoImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpICYmIHJqc29ucC50ZXN0KCBzLmRhdGEgKSAmJiAiZGF0YSIKCQkpOwoKCS8vIEhhbmRsZSBpZmYgdGhlIGV4cGVjdGVkIGRhdGEgdHlwZSBpcyAianNvbnAiIG9yIHdlIGhhdmUgYSBwYXJhbWV0ZXIgdG8gc2V0CglpZiAoIGpzb25Qcm9wIHx8IHMuZGF0YVR5cGVzWyAwIF0gPT09ICJqc29ucCIgKSB7CgoJCS8vIEdldCBjYWxsYmFjayBuYW1lLCByZW1lbWJlcmluZyBwcmVleGlzdGluZyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggaXQKCQljYWxsYmFja05hbWUgPSBzLmpzb25wQ2FsbGJhY2sgPSBqUXVlcnkuaXNGdW5jdGlvbiggcy5qc29ucENhbGxiYWNrICkgPwoJCQlzLmpzb25wQ2FsbGJhY2soKSA6CgkJCXMuanNvbnBDYWxsYmFjazsKCgkJLy8gSW5zZXJ0IGNhbGxiYWNrIGludG8gdXJsIG9yIGZvcm0gZGF0YQoJCWlmICgganNvblByb3AgKSB7CgkJCXNbIGpzb25Qcm9wIF0gPSBzWyBqc29uUHJvcCBdLnJlcGxhY2UoIHJqc29ucCwgIiQxIiArIGNhbGxiYWNrTmFtZSApOwoJCX0gZWxzZSBpZiAoIHMuanNvbnAgIT09IGZhbHNlICkgewoJCQlzLnVybCArPSAoIGFqYXhfcnF1ZXJ5LnRlc3QoIHMudXJsICkgPyAiJiIgOiAiPyIgKSArIHMuanNvbnAgKyAiPSIgKyBjYWxsYmFja05hbWU7CgkJfQoKCQkvLyBVc2UgZGF0YSBjb252ZXJ0ZXIgdG8gcmV0cmlldmUganNvbiBhZnRlciBzY3JpcHQgZXhlY3V0aW9uCgkJcy5jb252ZXJ0ZXJzWyJzY3JpcHQganNvbiJdID0gZnVuY3Rpb24oKSB7CgkJCWlmICggIXJlc3BvbnNlQ29udGFpbmVyICkgewoJCQkJalF1ZXJ5LmVycm9yKCBjYWxsYmFja05hbWUgKyAiIHdhcyBub3QgY2FsbGVkIiApOwoJCQl9CgkJCXJldHVybiByZXNwb25zZUNvbnRhaW5lclsgMCBdOwoJCX07CgoJCS8vIGZvcmNlIGpzb24gZGF0YVR5cGUKCQlzLmRhdGFUeXBlc1sgMCBdID0gImpzb24iOwoKCQkvLyBJbnN0YWxsIGNhbGxiYWNrCgkJb3ZlcndyaXR0ZW4gPSB3aW5kb3dbIGNhbGxiYWNrTmFtZSBdOwoJCXdpbmRvd1sgY2FsbGJhY2tOYW1lIF0gPSBmdW5jdGlvbigpIHsKCQkJcmVzcG9uc2VDb250YWluZXIgPSBhcmd1bWVudHM7CgkJfTsKCgkJLy8gQ2xlYW4tdXAgZnVuY3Rpb24gKGZpcmVzIGFmdGVyIGNvbnZlcnRlcnMpCgkJanFYSFIuYWx3YXlzKGZ1bmN0aW9uKCkgewoJCQkvLyBSZXN0b3JlIHByZWV4aXN0aW5nIHZhbHVlCgkJCXdpbmRvd1sgY2FsbGJhY2tOYW1lIF0gPSBvdmVyd3JpdHRlbjsKCgkJCS8vIFNhdmUgYmFjayBhcyBmcmVlCgkJCWlmICggc1sgY2FsbGJhY2tOYW1lIF0gKSB7CgkJCQkvLyBtYWtlIHN1cmUgdGhhdCByZS11c2luZyB0aGUgb3B0aW9ucyBkb2Vzbid0IHNjcmV3IHRoaW5ncyBhcm91bmQKCQkJCXMuanNvbnBDYWxsYmFjayA9IG9yaWdpbmFsU2V0dGluZ3MuanNvbnBDYWxsYmFjazsKCgkJCQkvLyBzYXZlIHRoZSBjYWxsYmFjayBuYW1lIGZvciBmdXR1cmUgdXNlCgkJCQlvbGRDYWxsYmFja3MucHVzaCggY2FsbGJhY2tOYW1lICk7CgkJCX0KCgkJCS8vIENhbGwgaWYgaXQgd2FzIGEgZnVuY3Rpb24gYW5kIHdlIGhhdmUgYSByZXNwb25zZQoJCQlpZiAoIHJlc3BvbnNlQ29udGFpbmVyICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBvdmVyd3JpdHRlbiApICkgewoJCQkJb3ZlcndyaXR0ZW4oIHJlc3BvbnNlQ29udGFpbmVyWyAwIF0gKTsKCQkJfQoKCQkJcmVzcG9uc2VDb250YWluZXIgPSBvdmVyd3JpdHRlbiA9IHVuZGVmaW5lZDsKCQl9KTsKCgkJLy8gRGVsZWdhdGUgdG8gc2NyaXB0CgkJcmV0dXJuICJzY3JpcHQiOwoJfQp9KTsKdmFyIHhockNhbGxiYWNrcywgeGhyU3VwcG9ydGVkLAoJeGhySWQgPSAwLAoJLy8gIzUyODA6IEludGVybmV0IEV4cGxvcmVyIHdpbGwga2VlcCBjb25uZWN0aW9ucyBhbGl2ZSBpZiB3ZSBkb24ndCBhYm9ydCBvbiB1bmxvYWQKCXhock9uVW5sb2FkQWJvcnQgPSB3aW5kb3cuQWN0aXZlWE9iamVjdCAmJiBmdW5jdGlvbigpIHsKCQkvLyBBYm9ydCBhbGwgcGVuZGluZyByZXF1ZXN0cwoJCXZhciBrZXk7CgkJZm9yICgga2V5IGluIHhockNhbGxiYWNrcyApIHsKCQkJeGhyQ2FsbGJhY2tzWyBrZXkgXSggdW5kZWZpbmVkLCB0cnVlICk7CgkJfQoJfTsKCi8vIEZ1bmN0aW9ucyB0byBjcmVhdGUgeGhycwpmdW5jdGlvbiBjcmVhdGVTdGFuZGFyZFhIUigpIHsKCXRyeSB7CgkJcmV0dXJuIG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKTsKCX0gY2F0Y2goIGUgKSB7fQp9CgpmdW5jdGlvbiBjcmVhdGVBY3RpdmVYSFIoKSB7Cgl0cnkgewoJCXJldHVybiBuZXcgd2luZG93LkFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIik7Cgl9IGNhdGNoKCBlICkge30KfQoKLy8gQ3JlYXRlIHRoZSByZXF1ZXN0IG9iamVjdAovLyAoVGhpcyBpcyBzdGlsbCBhdHRhY2hlZCB0byBhamF4U2V0dGluZ3MgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkpCmpRdWVyeS5hamF4U2V0dGluZ3MueGhyID0gd2luZG93LkFjdGl2ZVhPYmplY3QgPwoJLyogTWljcm9zb2Z0IGZhaWxlZCB0byBwcm9wZXJseQoJICogaW1wbGVtZW50IHRoZSBYTUxIdHRwUmVxdWVzdCBpbiBJRTcgKGNhbid0IHJlcXVlc3QgbG9jYWwgZmlsZXMpLAoJICogc28gd2UgdXNlIHRoZSBBY3RpdmVYT2JqZWN0IHdoZW4gaXQgaXMgYXZhaWxhYmxlCgkgKiBBZGRpdGlvbmFsbHkgWE1MSHR0cFJlcXVlc3QgY2FuIGJlIGRpc2FibGVkIGluIElFNy9JRTggc28KCSAqIHdlIG5lZWQgYSBmYWxsYmFjay4KCSAqLwoJZnVuY3Rpb24oKSB7CgkJcmV0dXJuICF0aGlzLmlzTG9jYWwgJiYgY3JlYXRlU3RhbmRhcmRYSFIoKSB8fCBjcmVhdGVBY3RpdmVYSFIoKTsKCX0gOgoJLy8gRm9yIGFsbCBvdGhlciBicm93c2VycywgdXNlIHRoZSBzdGFuZGFyZCBYTUxIdHRwUmVxdWVzdCBvYmplY3QKCWNyZWF0ZVN0YW5kYXJkWEhSOwoKLy8gRGV0ZXJtaW5lIHN1cHBvcnQgcHJvcGVydGllcwp4aHJTdXBwb3J0ZWQgPSBqUXVlcnkuYWpheFNldHRpbmdzLnhocigpOwpqUXVlcnkuc3VwcG9ydC5jb3JzID0gISF4aHJTdXBwb3J0ZWQgJiYgKCAid2l0aENyZWRlbnRpYWxzIiBpbiB4aHJTdXBwb3J0ZWQgKTsKeGhyU3VwcG9ydGVkID0galF1ZXJ5LnN1cHBvcnQuYWpheCA9ICEheGhyU3VwcG9ydGVkOwoKLy8gQ3JlYXRlIHRyYW5zcG9ydCBpZiB0aGUgYnJvd3NlciBjYW4gcHJvdmlkZSBhbiB4aHIKaWYgKCB4aHJTdXBwb3J0ZWQgKSB7CgoJalF1ZXJ5LmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oIHMgKSB7CgkJLy8gQ3Jvc3MgZG9tYWluIG9ubHkgYWxsb3dlZCBpZiBzdXBwb3J0ZWQgdGhyb3VnaCBYTUxIdHRwUmVxdWVzdAoJCWlmICggIXMuY3Jvc3NEb21haW4gfHwgalF1ZXJ5LnN1cHBvcnQuY29ycyApIHsKCgkJCXZhciBjYWxsYmFjazsKCgkJCXJldHVybiB7CgkJCQlzZW5kOiBmdW5jdGlvbiggaGVhZGVycywgY29tcGxldGUgKSB7CgoJCQkJCS8vIEdldCBhIG5ldyB4aHIKCQkJCQl2YXIgaGFuZGxlLCBpLAoJCQkJCQl4aHIgPSBzLnhocigpOwoKCQkJCQkvLyBPcGVuIHRoZSBzb2NrZXQKCQkJCQkvLyBQYXNzaW5nIG51bGwgdXNlcm5hbWUsIGdlbmVyYXRlcyBhIGxvZ2luIHBvcHVwIG9uIE9wZXJhICgjMjg2NSkKCQkJCQlpZiAoIHMudXNlcm5hbWUgKSB7CgkJCQkJCXhoci5vcGVuKCBzLnR5cGUsIHMudXJsLCBzLmFzeW5jLCBzLnVzZXJuYW1lLCBzLnBhc3N3b3JkICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJeGhyLm9wZW4oIHMudHlwZSwgcy51cmwsIHMuYXN5bmMgKTsKCQkJCQl9CgoJCQkJCS8vIEFwcGx5IGN1c3RvbSBmaWVsZHMgaWYgcHJvdmlkZWQKCQkJCQlpZiAoIHMueGhyRmllbGRzICkgewoJCQkJCQlmb3IgKCBpIGluIHMueGhyRmllbGRzICkgewoJCQkJCQkJeGhyWyBpIF0gPSBzLnhockZpZWxkc1sgaSBdOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBPdmVycmlkZSBtaW1lIHR5cGUgaWYgbmVlZGVkCgkJCQkJaWYgKCBzLm1pbWVUeXBlICYmIHhoci5vdmVycmlkZU1pbWVUeXBlICkgewoJCQkJCQl4aHIub3ZlcnJpZGVNaW1lVHlwZSggcy5taW1lVHlwZSApOwoJCQkJCX0KCgkJCQkJLy8gWC1SZXF1ZXN0ZWQtV2l0aCBoZWFkZXIKCQkJCQkvLyBGb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzLCBzZWVpbmcgYXMgY29uZGl0aW9ucyBmb3IgYSBwcmVmbGlnaHQgYXJlCgkJCQkJLy8gYWtpbiB0byBhIGppZ3NhdyBwdXp6bGUsIHdlIHNpbXBseSBuZXZlciBzZXQgaXQgdG8gYmUgc3VyZS4KCQkJCQkvLyAoaXQgY2FuIGFsd2F5cyBiZSBzZXQgb24gYSBwZXItcmVxdWVzdCBiYXNpcyBvciBldmVuIHVzaW5nIGFqYXhTZXR1cCkKCQkJCQkvLyBGb3Igc2FtZS1kb21haW4gcmVxdWVzdHMsIHdvbid0IGNoYW5nZSBoZWFkZXIgaWYgYWxyZWFkeSBwcm92aWRlZC4KCQkJCQlpZiAoICFzLmNyb3NzRG9tYWluICYmICFoZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0gKSB7CgkJCQkJCWhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSA9ICJYTUxIdHRwUmVxdWVzdCI7CgkJCQkJfQoKCQkJCQkvLyBOZWVkIGFuIGV4dHJhIHRyeS9jYXRjaCBmb3IgY3Jvc3MgZG9tYWluIHJlcXVlc3RzIGluIEZpcmVmb3ggMwoJCQkJCXRyeSB7CgkJCQkJCWZvciAoIGkgaW4gaGVhZGVycyApIHsKCQkJCQkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCBpLCBoZWFkZXJzWyBpIF0gKTsKCQkJCQkJfQoJCQkJCX0gY2F0Y2goIGVyciApIHt9CgoJCQkJCS8vIERvIHNlbmQgdGhlIHJlcXVlc3QKCQkJCQkvLyBUaGlzIG1heSByYWlzZSBhbiBleGNlcHRpb24gd2hpY2ggaXMgYWN0dWFsbHkKCQkJCQkvLyBoYW5kbGVkIGluIGpRdWVyeS5hamF4IChzbyBubyB0cnkvY2F0Y2ggaGVyZSkKCQkJCQl4aHIuc2VuZCggKCBzLmhhc0NvbnRlbnQgJiYgcy5kYXRhICkgfHwgbnVsbCApOwoKCQkJCQkvLyBMaXN0ZW5lcgoJCQkJCWNhbGxiYWNrID0gZnVuY3Rpb24oIF8sIGlzQWJvcnQgKSB7CgkJCQkJCXZhciBzdGF0dXMsIHJlc3BvbnNlSGVhZGVycywgc3RhdHVzVGV4dCwgcmVzcG9uc2VzOwoKCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgZXhjZXB0aW9ucyB3aGVuIGFjY2Vzc2luZyBwcm9wZXJ0aWVzCgkJCQkJCS8vIG9mIGFuIHhociB3aGVuIGEgbmV0d29yayBlcnJvciBvY2N1cnJlZAoJCQkJCQkvLyBodHRwOi8vaGVscGZ1bC5rbm9icy1kaWFscy5jb20vaW5kZXgucGhwL0NvbXBvbmVudF9yZXR1cm5lZF9mYWlsdXJlX2NvZGU6XzB4ODAwNDAxMTFfKE5TX0VSUk9SX05PVF9BVkFJTEFCTEUpCgkJCQkJCXRyeSB7CgoJCQkJCQkJLy8gV2FzIG5ldmVyIGNhbGxlZCBhbmQgaXMgYWJvcnRlZCBvciBjb21wbGV0ZQoJCQkJCQkJaWYgKCBjYWxsYmFjayAmJiAoIGlzQWJvcnQgfHwgeGhyLnJlYWR5U3RhdGUgPT09IDQgKSApIHsKCgkJCQkJCQkJLy8gT25seSBjYWxsZWQgb25jZQoJCQkJCQkJCWNhbGxiYWNrID0gdW5kZWZpbmVkOwoKCQkJCQkJCQkvLyBEbyBub3Qga2VlcCBhcyBhY3RpdmUgYW55bW9yZQoJCQkJCQkJCWlmICggaGFuZGxlICkgewoJCQkJCQkJCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0galF1ZXJ5Lm5vb3A7CgkJCQkJCQkJCWlmICggeGhyT25VbmxvYWRBYm9ydCApIHsKCQkJCQkJCQkJCWRlbGV0ZSB4aHJDYWxsYmFja3NbIGhhbmRsZSBdOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBJZiBpdCdzIGFuIGFib3J0CgkJCQkJCQkJaWYgKCBpc0Fib3J0ICkgewoJCQkJCQkJCQkvLyBBYm9ydCBpdCBtYW51YWxseSBpZiBuZWVkZWQKCQkJCQkJCQkJaWYgKCB4aHIucmVhZHlTdGF0ZSAhPT0gNCApIHsKCQkJCQkJCQkJCXhoci5hYm9ydCgpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJcmVzcG9uc2VzID0ge307CgkJCQkJCQkJCXN0YXR1cyA9IHhoci5zdGF0dXM7CgkJCQkJCQkJCXJlc3BvbnNlSGVhZGVycyA9IHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTsKCgkJCQkJCQkJCS8vIFdoZW4gcmVxdWVzdGluZyBiaW5hcnkgZGF0YSwgSUU2LTkgd2lsbCB0aHJvdyBhbiBleGNlcHRpb24KCQkJCQkJCQkJLy8gb24gYW55IGF0dGVtcHQgdG8gYWNjZXNzIHJlc3BvbnNlVGV4dCAoIzExNDI2KQoJCQkJCQkJCQlpZiAoIHR5cGVvZiB4aHIucmVzcG9uc2VUZXh0ID09PSAic3RyaW5nIiApIHsKCQkJCQkJCQkJCXJlc3BvbnNlcy50ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDsKCQkJCQkJCQkJfQoKCQkJCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgYW4gZXhjZXB0aW9uIHdoZW4gYWNjZXNzaW5nCgkJCQkJCQkJCS8vIHN0YXR1c1RleHQgZm9yIGZhdWx0eSBjcm9zcy1kb21haW4gcmVxdWVzdHMKCQkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJCXN0YXR1c1RleHQgPSB4aHIuc3RhdHVzVGV4dDsKCQkJCQkJCQkJfSBjYXRjaCggZSApIHsKCQkJCQkJCQkJCS8vIFdlIG5vcm1hbGl6ZSB3aXRoIFdlYmtpdCBnaXZpbmcgYW4gZW1wdHkgc3RhdHVzVGV4dAoJCQkJCQkJCQkJc3RhdHVzVGV4dCA9ICIiOwoJCQkJCQkJCQl9CgoJCQkJCQkJCQkvLyBGaWx0ZXIgc3RhdHVzIGZvciBub24gc3RhbmRhcmQgYmVoYXZpb3JzCgoJCQkJCQkJCQkvLyBJZiB0aGUgcmVxdWVzdCBpcyBsb2NhbCBhbmQgd2UgaGF2ZSBkYXRhOiBhc3N1bWUgYSBzdWNjZXNzCgkJCQkJCQkJCS8vIChzdWNjZXNzIHdpdGggbm8gZGF0YSB3b24ndCBnZXQgbm90aWZpZWQsIHRoYXQncyB0aGUgYmVzdCB3ZQoJCQkJCQkJCQkvLyBjYW4gZG8gZ2l2ZW4gY3VycmVudCBpbXBsZW1lbnRhdGlvbnMpCgkJCQkJCQkJCWlmICggIXN0YXR1cyAmJiBzLmlzTG9jYWwgJiYgIXMuY3Jvc3NEb21haW4gKSB7CgkJCQkJCQkJCQlzdGF0dXMgPSByZXNwb25zZXMudGV4dCA/IDIwMCA6IDQwNDsKCQkJCQkJCQkJLy8gSUUgLSAjMTQ1MDogc29tZXRpbWVzIHJldHVybnMgMTIyMyB3aGVuIGl0IHNob3VsZCBiZSAyMDQKCQkJCQkJCQkJfSBlbHNlIGlmICggc3RhdHVzID09PSAxMjIzICkgewoJCQkJCQkJCQkJc3RhdHVzID0gMjA0OwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9IGNhdGNoKCBmaXJlZm94QWNjZXNzRXhjZXB0aW9uICkgewoJCQkJCQkJaWYgKCAhaXNBYm9ydCApIHsKCQkJCQkJCQljb21wbGV0ZSggLTEsIGZpcmVmb3hBY2Nlc3NFeGNlcHRpb24gKTsKCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gQ2FsbCBjb21wbGV0ZSBpZiBuZWVkZWQKCQkJCQkJaWYgKCByZXNwb25zZXMgKSB7CgkJCQkJCQljb21wbGV0ZSggc3RhdHVzLCBzdGF0dXNUZXh0LCByZXNwb25zZXMsIHJlc3BvbnNlSGVhZGVycyApOwoJCQkJCQl9CgkJCQkJfTsKCgkJCQkJaWYgKCAhcy5hc3luYyApIHsKCQkJCQkJLy8gaWYgd2UncmUgaW4gc3luYyBtb2RlIHdlIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCWNhbGxiYWNrKCk7CgkJCQkJfSBlbHNlIGlmICggeGhyLnJlYWR5U3RhdGUgPT09IDQgKSB7CgkJCQkJCS8vIChJRTYgJiBJRTcpIGlmIGl0J3MgaW4gY2FjaGUgYW5kIGhhcyBiZWVuCgkJCQkJCS8vIHJldHJpZXZlZCBkaXJlY3RseSB3ZSBuZWVkIHRvIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCXNldFRpbWVvdXQoIGNhbGxiYWNrICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJaGFuZGxlID0gKyt4aHJJZDsKCQkJCQkJaWYgKCB4aHJPblVubG9hZEFib3J0ICkgewoJCQkJCQkJLy8gQ3JlYXRlIHRoZSBhY3RpdmUgeGhycyBjYWxsYmFja3MgbGlzdCBpZiBuZWVkZWQKCQkJCQkJCS8vIGFuZCBhdHRhY2ggdGhlIHVubG9hZCBoYW5kbGVyCgkJCQkJCQlpZiAoICF4aHJDYWxsYmFja3MgKSB7CgkJCQkJCQkJeGhyQ2FsbGJhY2tzID0ge307CgkJCQkJCQkJalF1ZXJ5KCB3aW5kb3cgKS51bmxvYWQoIHhock9uVW5sb2FkQWJvcnQgKTsKCQkJCQkJCX0KCQkJCQkJCS8vIEFkZCB0byBsaXN0IG9mIGFjdGl2ZSB4aHJzIGNhbGxiYWNrcwoJCQkJCQkJeGhyQ2FsbGJhY2tzWyBoYW5kbGUgXSA9IGNhbGxiYWNrOwoJCQkJCQl9CgkJCQkJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBjYWxsYmFjazsKCQkJCQl9CgkJCQl9LAoKCQkJCWFib3J0OiBmdW5jdGlvbigpIHsKCQkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCQljYWxsYmFjayggdW5kZWZpbmVkLCB0cnVlICk7CgkJCQkJfQoJCQkJfQoJCQl9OwoJCX0KCX0pOwp9CnZhciBmeE5vdywgdGltZXJJZCwKCXJmeHR5cGVzID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLAoJcmZ4bnVtID0gbmV3IFJlZ0V4cCggIl4oPzooWystXSk9fCkoIiArIGNvcmVfcG51bSArICIpKFthLXolXSopJCIsICJpIiApLAoJcnJ1biA9IC9xdWV1ZUhvb2tzJC8sCglhbmltYXRpb25QcmVmaWx0ZXJzID0gWyBkZWZhdWx0UHJlZmlsdGVyIF0sCgl0d2VlbmVycyA9IHsKCQkiKiI6IFtmdW5jdGlvbiggcHJvcCwgdmFsdWUgKSB7CgkJCXZhciBlbmQsIHVuaXQsCgkJCQl0d2VlbiA9IHRoaXMuY3JlYXRlVHdlZW4oIHByb3AsIHZhbHVlICksCgkJCQlwYXJ0cyA9IHJmeG51bS5leGVjKCB2YWx1ZSApLAoJCQkJdGFyZ2V0ID0gdHdlZW4uY3VyKCksCgkJCQlzdGFydCA9ICt0YXJnZXQgfHwgMCwKCQkJCXNjYWxlID0gMSwKCQkJCW1heEl0ZXJhdGlvbnMgPSAyMDsKCgkJCWlmICggcGFydHMgKSB7CgkJCQllbmQgPSArcGFydHNbMl07CgkJCQl1bml0ID0gcGFydHNbM10gfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKTsKCgkJCQkvLyBXZSBuZWVkIHRvIGNvbXB1dGUgc3RhcnRpbmcgdmFsdWUKCQkJCWlmICggdW5pdCAhPT0gInB4IiAmJiBzdGFydCApIHsKCQkJCQkvLyBJdGVyYXRpdmVseSBhcHByb3hpbWF0ZSBmcm9tIGEgbm9uemVybyBzdGFydGluZyBwb2ludAoJCQkJCS8vIFByZWZlciB0aGUgY3VycmVudCBwcm9wZXJ0eSwgYmVjYXVzZSB0aGlzIHByb2Nlc3Mgd2lsbCBiZSB0cml2aWFsIGlmIGl0IHVzZXMgdGhlIHNhbWUgdW5pdHMKCQkJCQkvLyBGYWxsYmFjayB0byBlbmQgb3IgYSBzaW1wbGUgY29uc3RhbnQKCQkJCQlzdGFydCA9IGpRdWVyeS5jc3MoIHR3ZWVuLmVsZW0sIHByb3AsIHRydWUgKSB8fCBlbmQgfHwgMTsKCgkJCQkJZG8gewoJCQkJCQkvLyBJZiBwcmV2aW91cyBpdGVyYXRpb24gemVyb2VkIG91dCwgZG91YmxlIHVudGlsIHdlIGdldCAqc29tZXRoaW5nKgoJCQkJCQkvLyBVc2UgYSBzdHJpbmcgZm9yIGRvdWJsaW5nIGZhY3RvciBzbyB3ZSBkb24ndCBhY2NpZGVudGFsbHkgc2VlIHNjYWxlIGFzIHVuY2hhbmdlZCBiZWxvdwoJCQkJCQlzY2FsZSA9IHNjYWxlIHx8ICIuNSI7CgoJCQkJCQkvLyBBZGp1c3QgYW5kIGFwcGx5CgkJCQkJCXN0YXJ0ID0gc3RhcnQgLyBzY2FsZTsKCQkJCQkJalF1ZXJ5LnN0eWxlKCB0d2Vlbi5lbGVtLCBwcm9wLCBzdGFydCArIHVuaXQgKTsKCgkJCQkJLy8gVXBkYXRlIHNjYWxlLCB0b2xlcmF0aW5nIHplcm8gb3IgTmFOIGZyb20gdHdlZW4uY3VyKCkKCQkJCQkvLyBBbmQgYnJlYWtpbmcgdGhlIGxvb3AgaWYgc2NhbGUgaXMgdW5jaGFuZ2VkIG9yIHBlcmZlY3QsIG9yIGlmIHdlJ3ZlIGp1c3QgaGFkIGVub3VnaAoJCQkJCX0gd2hpbGUgKCBzY2FsZSAhPT0gKHNjYWxlID0gdHdlZW4uY3VyKCkgLyB0YXJnZXQpICYmIHNjYWxlICE9PSAxICYmIC0tbWF4SXRlcmF0aW9ucyApOwoJCQkJfQoKCQkJCXR3ZWVuLnVuaXQgPSB1bml0OwoJCQkJdHdlZW4uc3RhcnQgPSBzdGFydDsKCQkJCS8vIElmIGEgKz0vLT0gdG9rZW4gd2FzIHByb3ZpZGVkLCB3ZSdyZSBkb2luZyBhIHJlbGF0aXZlIGFuaW1hdGlvbgoJCQkJdHdlZW4uZW5kID0gcGFydHNbMV0gPyBzdGFydCArICggcGFydHNbMV0gKyAxICkgKiBlbmQgOiBlbmQ7CgkJCX0KCQkJcmV0dXJuIHR3ZWVuOwoJCX1dCgl9OwoKLy8gQW5pbWF0aW9ucyBjcmVhdGVkIHN5bmNocm9ub3VzbHkgd2lsbCBydW4gc3luY2hyb25vdXNseQpmdW5jdGlvbiBjcmVhdGVGeE5vdygpIHsKCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJZnhOb3cgPSB1bmRlZmluZWQ7Cgl9KTsKCXJldHVybiAoIGZ4Tm93ID0galF1ZXJ5Lm5vdygpICk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVR3ZWVucyggYW5pbWF0aW9uLCBwcm9wcyApIHsKCWpRdWVyeS5lYWNoKCBwcm9wcywgZnVuY3Rpb24oIHByb3AsIHZhbHVlICkgewoJCXZhciBjb2xsZWN0aW9uID0gKCB0d2VlbmVyc1sgcHJvcCBdIHx8IFtdICkuY29uY2F0KCB0d2VlbmVyc1sgIioiIF0gKSwKCQkJaW5kZXggPSAwLAoJCQlsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCQlpZiAoIGNvbGxlY3Rpb25bIGluZGV4IF0uY2FsbCggYW5pbWF0aW9uLCBwcm9wLCB2YWx1ZSApICkgewoKCQkJCS8vIHdlJ3JlIGRvbmUgd2l0aCB0aGlzIHByb3BlcnR5CgkJCQlyZXR1cm47CgkJCX0KCQl9Cgl9KTsKfQoKZnVuY3Rpb24gQW5pbWF0aW9uKCBlbGVtLCBwcm9wZXJ0aWVzLCBvcHRpb25zICkgewoJdmFyIHJlc3VsdCwKCQlzdG9wcGVkLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBhbmltYXRpb25QcmVmaWx0ZXJzLmxlbmd0aCwKCQlkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCS8vIGRvbid0IG1hdGNoIGVsZW0gaW4gdGhlIDphbmltYXRlZCBzZWxlY3RvcgoJCQlkZWxldGUgdGljay5lbGVtOwoJCX0pLAoJCXRpY2sgPSBmdW5jdGlvbigpIHsKCQkJaWYgKCBzdG9wcGVkICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCXZhciBjdXJyZW50VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCksCgkJCQlyZW1haW5pbmcgPSBNYXRoLm1heCggMCwgYW5pbWF0aW9uLnN0YXJ0VGltZSArIGFuaW1hdGlvbi5kdXJhdGlvbiAtIGN1cnJlbnRUaW1lICksCgkJCQkvLyBhcmNoYWljIGNyYXNoIGJ1ZyB3b24ndCBhbGxvdyB1cyB0byB1c2UgMSAtICggMC41IHx8IDAgKSAoIzEyNDk3KQoJCQkJdGVtcCA9IHJlbWFpbmluZyAvIGFuaW1hdGlvbi5kdXJhdGlvbiB8fCAwLAoJCQkJcGVyY2VudCA9IDEgLSB0ZW1wLAoJCQkJaW5kZXggPSAwLAoJCQkJbGVuZ3RoID0gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGg7CgoJCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCBwZXJjZW50ICk7CgkJCX0KCgkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCBwZXJjZW50LCByZW1haW5pbmcgXSk7CgoJCQlpZiAoIHBlcmNlbnQgPCAxICYmIGxlbmd0aCApIHsKCQkJCXJldHVybiByZW1haW5pbmc7CgkJCX0gZWxzZSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24gXSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSwKCQlhbmltYXRpb24gPSBkZWZlcnJlZC5wcm9taXNlKHsKCQkJZWxlbTogZWxlbSwKCQkJcHJvcHM6IGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wZXJ0aWVzICksCgkJCW9wdHM6IGpRdWVyeS5leHRlbmQoIHRydWUsIHsgc3BlY2lhbEVhc2luZzoge30gfSwgb3B0aW9ucyApLAoJCQlvcmlnaW5hbFByb3BlcnRpZXM6IHByb3BlcnRpZXMsCgkJCW9yaWdpbmFsT3B0aW9uczogb3B0aW9ucywKCQkJc3RhcnRUaW1lOiBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAoJCQlkdXJhdGlvbjogb3B0aW9ucy5kdXJhdGlvbiwKCQkJdHdlZW5zOiBbXSwKCQkJY3JlYXRlVHdlZW46IGZ1bmN0aW9uKCBwcm9wLCBlbmQgKSB7CgkJCQl2YXIgdHdlZW4gPSBqUXVlcnkuVHdlZW4oIGVsZW0sIGFuaW1hdGlvbi5vcHRzLCBwcm9wLCBlbmQsCgkJCQkJCWFuaW1hdGlvbi5vcHRzLnNwZWNpYWxFYXNpbmdbIHByb3AgXSB8fCBhbmltYXRpb24ub3B0cy5lYXNpbmcgKTsKCQkJCWFuaW1hdGlvbi50d2VlbnMucHVzaCggdHdlZW4gKTsKCQkJCXJldHVybiB0d2VlbjsKCQkJfSwKCQkJc3RvcDogZnVuY3Rpb24oIGdvdG9FbmQgKSB7CgkJCQl2YXIgaW5kZXggPSAwLAoJCQkJCS8vIGlmIHdlIGFyZSBnb2luZyB0byB0aGUgZW5kLCB3ZSB3YW50IHRvIHJ1biBhbGwgdGhlIHR3ZWVucwoJCQkJCS8vIG90aGVyd2lzZSB3ZSBza2lwIHRoaXMgcGFydAoJCQkJCWxlbmd0aCA9IGdvdG9FbmQgPyBhbmltYXRpb24udHdlZW5zLmxlbmd0aCA6IDA7CgkJCQlpZiAoIHN0b3BwZWQgKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgkJCQlzdG9wcGVkID0gdHJ1ZTsKCQkJCWZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCAxICk7CgkJCQl9CgoJCQkJLy8gcmVzb2x2ZSB3aGVuIHdlIHBsYXllZCB0aGUgbGFzdCBmcmFtZQoJCQkJLy8gb3RoZXJ3aXNlLCByZWplY3QKCQkJCWlmICggZ290b0VuZCApIHsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWZlcnJlZC5yZWplY3RXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgZ290b0VuZCBdICk7CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfQoJCX0pLAoJCXByb3BzID0gYW5pbWF0aW9uLnByb3BzOwoKCXByb3BGaWx0ZXIoIHByb3BzLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nICk7CgoJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJcmVzdWx0ID0gYW5pbWF0aW9uUHJlZmlsdGVyc1sgaW5kZXggXS5jYWxsKCBhbmltYXRpb24sIGVsZW0sIHByb3BzLCBhbmltYXRpb24ub3B0cyApOwoJCWlmICggcmVzdWx0ICkgewoJCQlyZXR1cm4gcmVzdWx0OwoJCX0KCX0KCgljcmVhdGVUd2VlbnMoIGFuaW1hdGlvbiwgcHJvcHMgKTsKCglpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBhbmltYXRpb24ub3B0cy5zdGFydCApICkgewoJCWFuaW1hdGlvbi5vcHRzLnN0YXJ0LmNhbGwoIGVsZW0sIGFuaW1hdGlvbiApOwoJfQoKCWpRdWVyeS5meC50aW1lcigKCQlqUXVlcnkuZXh0ZW5kKCB0aWNrLCB7CgkJCWVsZW06IGVsZW0sCgkJCWFuaW06IGFuaW1hdGlvbiwKCQkJcXVldWU6IGFuaW1hdGlvbi5vcHRzLnF1ZXVlCgkJfSkKCSk7CgoJLy8gYXR0YWNoIGNhbGxiYWNrcyBmcm9tIG9wdGlvbnMKCXJldHVybiBhbmltYXRpb24ucHJvZ3Jlc3MoIGFuaW1hdGlvbi5vcHRzLnByb2dyZXNzICkKCQkuZG9uZSggYW5pbWF0aW9uLm9wdHMuZG9uZSwgYW5pbWF0aW9uLm9wdHMuY29tcGxldGUgKQoJCS5mYWlsKCBhbmltYXRpb24ub3B0cy5mYWlsICkKCQkuYWx3YXlzKCBhbmltYXRpb24ub3B0cy5hbHdheXMgKTsKfQoKZnVuY3Rpb24gcHJvcEZpbHRlciggcHJvcHMsIHNwZWNpYWxFYXNpbmcgKSB7Cgl2YXIgdmFsdWUsIG5hbWUsIGluZGV4LCBlYXNpbmcsIGhvb2tzOwoKCS8vIGNhbWVsQ2FzZSwgc3BlY2lhbEVhc2luZyBhbmQgZXhwYW5kIGNzc0hvb2sgcGFzcwoJZm9yICggaW5kZXggaW4gcHJvcHMgKSB7CgkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIGluZGV4ICk7CgkJZWFzaW5nID0gc3BlY2lhbEVhc2luZ1sgbmFtZSBdOwoJCXZhbHVlID0gcHJvcHNbIGluZGV4IF07CgkJaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHsKCQkJZWFzaW5nID0gdmFsdWVbIDEgXTsKCQkJdmFsdWUgPSBwcm9wc1sgaW5kZXggXSA9IHZhbHVlWyAwIF07CgkJfQoKCQlpZiAoIGluZGV4ICE9PSBuYW1lICkgewoJCQlwcm9wc1sgbmFtZSBdID0gdmFsdWU7CgkJCWRlbGV0ZSBwcm9wc1sgaW5kZXggXTsKCQl9CgoJCWhvb2tzID0galF1ZXJ5LmNzc0hvb2tzWyBuYW1lIF07CgkJaWYgKCBob29rcyAmJiAiZXhwYW5kIiBpbiBob29rcyApIHsKCQkJdmFsdWUgPSBob29rcy5leHBhbmQoIHZhbHVlICk7CgkJCWRlbGV0ZSBwcm9wc1sgbmFtZSBdOwoKCQkJLy8gbm90IHF1aXRlICQuZXh0ZW5kLCB0aGlzIHdvbnQgb3ZlcndyaXRlIGtleXMgYWxyZWFkeSBwcmVzZW50LgoJCQkvLyBhbHNvIC0gcmV1c2luZyAnaW5kZXgnIGZyb20gYWJvdmUgYmVjYXVzZSB3ZSBoYXZlIHRoZSBjb3JyZWN0ICJuYW1lIgoJCQlmb3IgKCBpbmRleCBpbiB2YWx1ZSApIHsKCQkJCWlmICggISggaW5kZXggaW4gcHJvcHMgKSApIHsKCQkJCQlwcm9wc1sgaW5kZXggXSA9IHZhbHVlWyBpbmRleCBdOwoJCQkJCXNwZWNpYWxFYXNpbmdbIGluZGV4IF0gPSBlYXNpbmc7CgkJCQl9CgkJCX0KCQl9IGVsc2UgewoJCQlzcGVjaWFsRWFzaW5nWyBuYW1lIF0gPSBlYXNpbmc7CgkJfQoJfQp9CgpqUXVlcnkuQW5pbWF0aW9uID0galF1ZXJ5LmV4dGVuZCggQW5pbWF0aW9uLCB7CgoJdHdlZW5lcjogZnVuY3Rpb24oIHByb3BzLCBjYWxsYmFjayApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBwcm9wcyApICkgewoJCQljYWxsYmFjayA9IHByb3BzOwoJCQlwcm9wcyA9IFsgIioiIF07CgkJfSBlbHNlIHsKCQkJcHJvcHMgPSBwcm9wcy5zcGxpdCgiICIpOwoJCX0KCgkJdmFyIHByb3AsCgkJCWluZGV4ID0gMCwKCQkJbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJcHJvcCA9IHByb3BzWyBpbmRleCBdOwoJCQl0d2VlbmVyc1sgcHJvcCBdID0gdHdlZW5lcnNbIHByb3AgXSB8fCBbXTsKCQkJdHdlZW5lcnNbIHByb3AgXS51bnNoaWZ0KCBjYWxsYmFjayApOwoJCX0KCX0sCgoJcHJlZmlsdGVyOiBmdW5jdGlvbiggY2FsbGJhY2ssIHByZXBlbmQgKSB7CgkJaWYgKCBwcmVwZW5kICkgewoJCQlhbmltYXRpb25QcmVmaWx0ZXJzLnVuc2hpZnQoIGNhbGxiYWNrICk7CgkJfSBlbHNlIHsKCQkJYW5pbWF0aW9uUHJlZmlsdGVycy5wdXNoKCBjYWxsYmFjayApOwoJCX0KCX0KfSk7CgpmdW5jdGlvbiBkZWZhdWx0UHJlZmlsdGVyKCBlbGVtLCBwcm9wcywgb3B0cyApIHsKCS8qanNoaW50IHZhbGlkdGhpczp0cnVlICovCgl2YXIgcHJvcCwgaW5kZXgsIGxlbmd0aCwKCQl2YWx1ZSwgZGF0YVNob3csIHRvZ2dsZSwKCQl0d2VlbiwgaG9va3MsIG9sZGZpcmUsCgkJYW5pbSA9IHRoaXMsCgkJc3R5bGUgPSBlbGVtLnN0eWxlLAoJCW9yaWcgPSB7fSwKCQloYW5kbGVkID0gW10sCgkJaGlkZGVuID0gZWxlbS5ub2RlVHlwZSAmJiBpc0hpZGRlbiggZWxlbSApOwoKCS8vIGhhbmRsZSBxdWV1ZTogZmFsc2UgcHJvbWlzZXMKCWlmICggIW9wdHMucXVldWUgKSB7CgkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sICJmeCIgKTsKCQlpZiAoIGhvb2tzLnVucXVldWVkID09IG51bGwgKSB7CgkJCWhvb2tzLnVucXVldWVkID0gMDsKCQkJb2xkZmlyZSA9IGhvb2tzLmVtcHR5LmZpcmU7CgkJCWhvb2tzLmVtcHR5LmZpcmUgPSBmdW5jdGlvbigpIHsKCQkJCWlmICggIWhvb2tzLnVucXVldWVkICkgewoJCQkJCW9sZGZpcmUoKTsKCQkJCX0KCQkJfTsKCQl9CgkJaG9va3MudW5xdWV1ZWQrKzsKCgkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCS8vIGRvaW5nIHRoaXMgbWFrZXMgc3VyZSB0aGF0IHRoZSBjb21wbGV0ZSBoYW5kbGVyIHdpbGwgYmUgY2FsbGVkCgkJCS8vIGJlZm9yZSB0aGlzIGNvbXBsZXRlcwoJCQlhbmltLmFsd2F5cyhmdW5jdGlvbigpIHsKCQkJCWhvb2tzLnVucXVldWVkLS07CgkJCQlpZiAoICFqUXVlcnkucXVldWUoIGVsZW0sICJmeCIgKS5sZW5ndGggKSB7CgkJCQkJaG9va3MuZW1wdHkuZmlyZSgpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCX0KCgkvLyBoZWlnaHQvd2lkdGggb3ZlcmZsb3cgcGFzcwoJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICggImhlaWdodCIgaW4gcHJvcHMgfHwgIndpZHRoIiBpbiBwcm9wcyApICkgewoJCS8vIE1ha2Ugc3VyZSB0aGF0IG5vdGhpbmcgc25lYWtzIG91dAoJCS8vIFJlY29yZCBhbGwgMyBvdmVyZmxvdyBhdHRyaWJ1dGVzIGJlY2F1c2UgSUUgZG9lcyBub3QKCQkvLyBjaGFuZ2UgdGhlIG92ZXJmbG93IGF0dHJpYnV0ZSB3aGVuIG92ZXJmbG93WCBhbmQKCQkvLyBvdmVyZmxvd1kgYXJlIHNldCB0byB0aGUgc2FtZSB2YWx1ZQoJCW9wdHMub3ZlcmZsb3cgPSBbIHN0eWxlLm92ZXJmbG93LCBzdHlsZS5vdmVyZmxvd1gsIHN0eWxlLm92ZXJmbG93WSBdOwoKCQkvLyBTZXQgZGlzcGxheSBwcm9wZXJ0eSB0byBpbmxpbmUtYmxvY2sgZm9yIGhlaWdodC93aWR0aAoJCS8vIGFuaW1hdGlvbnMgb24gaW5saW5lIGVsZW1lbnRzIHRoYXQgYXJlIGhhdmluZyB3aWR0aC9oZWlnaHQgYW5pbWF0ZWQKCQlpZiAoIGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApID09PSAiaW5saW5lIiAmJgoJCQkJalF1ZXJ5LmNzcyggZWxlbSwgImZsb2F0IiApID09PSAibm9uZSIgKSB7CgoJCQkvLyBpbmxpbmUtbGV2ZWwgZWxlbWVudHMgYWNjZXB0IGlubGluZS1ibG9jazsKCQkJLy8gYmxvY2stbGV2ZWwgZWxlbWVudHMgbmVlZCB0byBiZSBpbmxpbmUgd2l0aCBsYXlvdXQKCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCB8fCBjc3NfZGVmYXVsdERpc3BsYXkoIGVsZW0ubm9kZU5hbWUgKSA9PT0gImlubGluZSIgKSB7CgkJCQlzdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgoJCQl9IGVsc2UgewoJCQkJc3R5bGUuem9vbSA9IDE7CgkJCX0KCQl9Cgl9CgoJaWYgKCBvcHRzLm92ZXJmbG93ICkgewoJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyApIHsKCQkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCQlzdHlsZS5vdmVyZmxvdyA9IG9wdHMub3ZlcmZsb3dbIDAgXTsKCQkJCXN0eWxlLm92ZXJmbG93WCA9IG9wdHMub3ZlcmZsb3dbIDEgXTsKCQkJCXN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbIDIgXTsKCQkJfSk7CgkJfQoJfQoKCgkvLyBzaG93L2hpZGUgcGFzcwoJZm9yICggaW5kZXggaW4gcHJvcHMgKSB7CgkJdmFsdWUgPSBwcm9wc1sgaW5kZXggXTsKCQlpZiAoIHJmeHR5cGVzLmV4ZWMoIHZhbHVlICkgKSB7CgkJCWRlbGV0ZSBwcm9wc1sgaW5kZXggXTsKCQkJdG9nZ2xlID0gdG9nZ2xlIHx8IHZhbHVlID09PSAidG9nZ2xlIjsKCQkJaWYgKCB2YWx1ZSA9PT0gKCBoaWRkZW4gPyAiaGlkZSIgOiAic2hvdyIgKSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCWhhbmRsZWQucHVzaCggaW5kZXggKTsKCQl9Cgl9CgoJbGVuZ3RoID0gaGFuZGxlZC5sZW5ndGg7CglpZiAoIGxlbmd0aCApIHsKCQlkYXRhU2hvdyA9IGpRdWVyeS5fZGF0YSggZWxlbSwgImZ4c2hvdyIgKSB8fCBqUXVlcnkuX2RhdGEoIGVsZW0sICJmeHNob3ciLCB7fSApOwoJCWlmICggImhpZGRlbiIgaW4gZGF0YVNob3cgKSB7CgkJCWhpZGRlbiA9IGRhdGFTaG93LmhpZGRlbjsKCQl9CgoJCS8vIHN0b3JlIHN0YXRlIGlmIGl0cyB0b2dnbGUgLSBlbmFibGVzIC5zdG9wKCkudG9nZ2xlKCkgdG8gInJldmVyc2UiCgkJaWYgKCB0b2dnbGUgKSB7CgkJCWRhdGFTaG93LmhpZGRlbiA9ICFoaWRkZW47CgkJfQoJCWlmICggaGlkZGVuICkgewoJCQlqUXVlcnkoIGVsZW0gKS5zaG93KCk7CgkJfSBlbHNlIHsKCQkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5KCBlbGVtICkuaGlkZSgpOwoJCQl9KTsKCQl9CgkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQl2YXIgcHJvcDsKCQkJalF1ZXJ5Ll9yZW1vdmVEYXRhKCBlbGVtLCAiZnhzaG93IiApOwoJCQlmb3IgKCBwcm9wIGluIG9yaWcgKSB7CgkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIHByb3AsIG9yaWdbIHByb3AgXSApOwoJCQl9CgkJfSk7CgkJZm9yICggaW5kZXggPSAwIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQlwcm9wID0gaGFuZGxlZFsgaW5kZXggXTsKCQkJdHdlZW4gPSBhbmltLmNyZWF0ZVR3ZWVuKCBwcm9wLCBoaWRkZW4gPyBkYXRhU2hvd1sgcHJvcCBdIDogMCApOwoJCQlvcmlnWyBwcm9wIF0gPSBkYXRhU2hvd1sgcHJvcCBdIHx8IGpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCApOwoKCQkJaWYgKCAhKCBwcm9wIGluIGRhdGFTaG93ICkgKSB7CgkJCQlkYXRhU2hvd1sgcHJvcCBdID0gdHdlZW4uc3RhcnQ7CgkJCQlpZiAoIGhpZGRlbiApIHsKCQkJCQl0d2Vlbi5lbmQgPSB0d2Vlbi5zdGFydDsKCQkJCQl0d2Vlbi5zdGFydCA9IHByb3AgPT09ICJ3aWR0aCIgfHwgcHJvcCA9PT0gImhlaWdodCIgPyAxIDogMDsKCQkJCX0KCQkJfQoJCX0KCX0KfQoKZnVuY3Rpb24gVHdlZW4oIGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nICkgewoJcmV0dXJuIG5ldyBUd2Vlbi5wcm90b3R5cGUuaW5pdCggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcgKTsKfQpqUXVlcnkuVHdlZW4gPSBUd2VlbjsKClR3ZWVuLnByb3RvdHlwZSA9IHsKCWNvbnN0cnVjdG9yOiBUd2VlbiwKCWluaXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZywgdW5pdCApIHsKCQl0aGlzLmVsZW0gPSBlbGVtOwoJCXRoaXMucHJvcCA9IHByb3A7CgkJdGhpcy5lYXNpbmcgPSBlYXNpbmcgfHwgInN3aW5nIjsKCQl0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwoJCXRoaXMuc3RhcnQgPSB0aGlzLm5vdyA9IHRoaXMuY3VyKCk7CgkJdGhpcy5lbmQgPSBlbmQ7CgkJdGhpcy51bml0ID0gdW5pdCB8fCAoIGpRdWVyeS5jc3NOdW1iZXJbIHByb3AgXSA/ICIiIDogInB4IiApOwoJfSwKCWN1cjogZnVuY3Rpb24oKSB7CgkJdmFyIGhvb2tzID0gVHdlZW4ucHJvcEhvb2tzWyB0aGlzLnByb3AgXTsKCgkJcmV0dXJuIGhvb2tzICYmIGhvb2tzLmdldCA/CgkJCWhvb2tzLmdldCggdGhpcyApIDoKCQkJVHdlZW4ucHJvcEhvb2tzLl9kZWZhdWx0LmdldCggdGhpcyApOwoJfSwKCXJ1bjogZnVuY3Rpb24oIHBlcmNlbnQgKSB7CgkJdmFyIGVhc2VkLAoJCQlob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07CgoJCWlmICggdGhpcy5vcHRpb25zLmR1cmF0aW9uICkgewoJCQl0aGlzLnBvcyA9IGVhc2VkID0galF1ZXJ5LmVhc2luZ1sgdGhpcy5lYXNpbmcgXSgKCQkJCXBlcmNlbnQsIHRoaXMub3B0aW9ucy5kdXJhdGlvbiAqIHBlcmNlbnQsIDAsIDEsIHRoaXMub3B0aW9ucy5kdXJhdGlvbgoJCQkpOwoJCX0gZWxzZSB7CgkJCXRoaXMucG9zID0gZWFzZWQgPSBwZXJjZW50OwoJCX0KCQl0aGlzLm5vdyA9ICggdGhpcy5lbmQgLSB0aGlzLnN0YXJ0ICkgKiBlYXNlZCArIHRoaXMuc3RhcnQ7CgoJCWlmICggdGhpcy5vcHRpb25zLnN0ZXAgKSB7CgkJCXRoaXMub3B0aW9ucy5zdGVwLmNhbGwoIHRoaXMuZWxlbSwgdGhpcy5ub3csIHRoaXMgKTsKCQl9CgoJCWlmICggaG9va3MgJiYgaG9va3Muc2V0ICkgewoJCQlob29rcy5zZXQoIHRoaXMgKTsKCQl9IGVsc2UgewoJCQlUd2Vlbi5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KCB0aGlzICk7CgkJfQoJCXJldHVybiB0aGlzOwoJfQp9OwoKVHdlZW4ucHJvdG90eXBlLmluaXQucHJvdG90eXBlID0gVHdlZW4ucHJvdG90eXBlOwoKVHdlZW4ucHJvcEhvb2tzID0gewoJX2RlZmF1bHQ6IHsKCQlnZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQkJdmFyIHJlc3VsdDsKCgkJCWlmICggdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdICE9IG51bGwgJiYKCQkJCSghdHdlZW4uZWxlbS5zdHlsZSB8fCB0d2Vlbi5lbGVtLnN0eWxlWyB0d2Vlbi5wcm9wIF0gPT0gbnVsbCkgKSB7CgkJCQlyZXR1cm4gdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdOwoJCQl9CgoJCQkvLyBwYXNzaW5nIGFuIGVtcHR5IHN0cmluZyBhcyBhIDNyZCBwYXJhbWV0ZXIgdG8gLmNzcyB3aWxsIGF1dG9tYXRpY2FsbHkKCQkJLy8gYXR0ZW1wdCBhIHBhcnNlRmxvYXQgYW5kIGZhbGxiYWNrIHRvIGEgc3RyaW5nIGlmIHRoZSBwYXJzZSBmYWlscwoJCQkvLyBzbywgc2ltcGxlIHZhbHVlcyBzdWNoIGFzICIxMHB4IiBhcmUgcGFyc2VkIHRvIEZsb2F0LgoJCQkvLyBjb21wbGV4IHZhbHVlcyBzdWNoIGFzICJyb3RhdGUoMXJhZCkiIGFyZSByZXR1cm5lZCBhcyBpcy4KCQkJcmVzdWx0ID0galF1ZXJ5LmNzcyggdHdlZW4uZWxlbSwgdHdlZW4ucHJvcCwgIiIgKTsKCQkJLy8gRW1wdHkgc3RyaW5ncywgbnVsbCwgdW5kZWZpbmVkIGFuZCAiYXV0byIgYXJlIGNvbnZlcnRlZCB0byAwLgoJCQlyZXR1cm4gIXJlc3VsdCB8fCByZXN1bHQgPT09ICJhdXRvIiA/IDAgOiByZXN1bHQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQkJLy8gdXNlIHN0ZXAgaG9vayBmb3IgYmFjayBjb21wYXQgLSB1c2UgY3NzSG9vayBpZiBpdHMgdGhlcmUgLSB1c2UgLnN0eWxlIGlmIGl0cwoJCQkvLyBhdmFpbGFibGUgYW5kIHVzZSBwbGFpbiBwcm9wZXJ0aWVzIHdoZXJlIGF2YWlsYWJsZQoJCQlpZiAoIGpRdWVyeS5meC5zdGVwWyB0d2Vlbi5wcm9wIF0gKSB7CgkJCQlqUXVlcnkuZnguc3RlcFsgdHdlZW4ucHJvcCBdKCB0d2VlbiApOwoJCQl9IGVsc2UgaWYgKCB0d2Vlbi5lbGVtLnN0eWxlICYmICggdHdlZW4uZWxlbS5zdHlsZVsgalF1ZXJ5LmNzc1Byb3BzWyB0d2Vlbi5wcm9wIF0gXSAhPSBudWxsIHx8IGpRdWVyeS5jc3NIb29rc1sgdHdlZW4ucHJvcCBdICkgKSB7CgkJCQlqUXVlcnkuc3R5bGUoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsIHR3ZWVuLm5vdyArIHR3ZWVuLnVuaXQgKTsKCQkJfSBlbHNlIHsKCQkJCXR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSA9IHR3ZWVuLm5vdzsKCQkJfQoJCX0KCX0KfTsKCi8vIFJlbW92ZSBpbiAyLjAgLSB0aGlzIHN1cHBvcnRzIElFOCdzIHBhbmljIGJhc2VkIGFwcHJvYWNoCi8vIHRvIHNldHRpbmcgdGhpbmdzIG9uIGRpc2Nvbm5lY3RlZCBub2RlcwoKVHdlZW4ucHJvcEhvb2tzLnNjcm9sbFRvcCA9IFR3ZWVuLnByb3BIb29rcy5zY3JvbGxMZWZ0ID0gewoJc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJaWYgKCB0d2Vlbi5lbGVtLm5vZGVUeXBlICYmIHR3ZWVuLmVsZW0ucGFyZW50Tm9kZSApIHsKCQkJdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdID0gdHdlZW4ubm93OwoJCX0KCX0KfTsKCmpRdWVyeS5lYWNoKFsgInRvZ2dsZSIsICJzaG93IiwgImhpZGUiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJdmFyIGNzc0ZuID0galF1ZXJ5LmZuWyBuYW1lIF07CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQlyZXR1cm4gc3BlZWQgPT0gbnVsbCB8fCB0eXBlb2Ygc3BlZWQgPT09ICJib29sZWFuIiA/CgkJCWNzc0ZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSA6CgkJCXRoaXMuYW5pbWF0ZSggZ2VuRngoIG5hbWUsIHRydWUgKSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX07Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglmYWRlVG86IGZ1bmN0aW9uKCBzcGVlZCwgdG8sIGVhc2luZywgY2FsbGJhY2sgKSB7CgoJCS8vIHNob3cgYW55IGhpZGRlbiBlbGVtZW50cyBhZnRlciBzZXR0aW5nIG9wYWNpdHkgdG8gMAoJCXJldHVybiB0aGlzLmZpbHRlciggaXNIaWRkZW4gKS5jc3MoICJvcGFjaXR5IiwgMCApLnNob3coKQoKCQkJLy8gYW5pbWF0ZSB0byB0aGUgdmFsdWUgc3BlY2lmaWVkCgkJCS5lbmQoKS5hbmltYXRlKHsgb3BhY2l0eTogdG8gfSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX0sCglhbmltYXRlOiBmdW5jdGlvbiggcHJvcCwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJdmFyIGVtcHR5ID0galF1ZXJ5LmlzRW1wdHlPYmplY3QoIHByb3AgKSwKCQkJb3B0YWxsID0galF1ZXJ5LnNwZWVkKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApLAoJCQlkb0FuaW1hdGlvbiA9IGZ1bmN0aW9uKCkgewoJCQkJLy8gT3BlcmF0ZSBvbiBhIGNvcHkgb2YgcHJvcCBzbyBwZXItcHJvcGVydHkgZWFzaW5nIHdvbid0IGJlIGxvc3QKCQkJCXZhciBhbmltID0gQW5pbWF0aW9uKCB0aGlzLCBqUXVlcnkuZXh0ZW5kKCB7fSwgcHJvcCApLCBvcHRhbGwgKTsKCQkJCWRvQW5pbWF0aW9uLmZpbmlzaCA9IGZ1bmN0aW9uKCkgewoJCQkJCWFuaW0uc3RvcCggdHJ1ZSApOwoJCQkJfTsKCQkJCS8vIEVtcHR5IGFuaW1hdGlvbnMsIG9yIGZpbmlzaGluZyByZXNvbHZlcyBpbW1lZGlhdGVseQoJCQkJaWYgKCBlbXB0eSB8fCBqUXVlcnkuX2RhdGEoIHRoaXMsICJmaW5pc2giICkgKSB7CgkJCQkJYW5pbS5zdG9wKCB0cnVlICk7CgkJCQl9CgkJCX07CgkJCWRvQW5pbWF0aW9uLmZpbmlzaCA9IGRvQW5pbWF0aW9uOwoKCQlyZXR1cm4gZW1wdHkgfHwgb3B0YWxsLnF1ZXVlID09PSBmYWxzZSA/CgkJCXRoaXMuZWFjaCggZG9BbmltYXRpb24gKSA6CgkJCXRoaXMucXVldWUoIG9wdGFsbC5xdWV1ZSwgZG9BbmltYXRpb24gKTsKCX0sCglzdG9wOiBmdW5jdGlvbiggdHlwZSwgY2xlYXJRdWV1ZSwgZ290b0VuZCApIHsKCQl2YXIgc3RvcFF1ZXVlID0gZnVuY3Rpb24oIGhvb2tzICkgewoJCQl2YXIgc3RvcCA9IGhvb2tzLnN0b3A7CgkJCWRlbGV0ZSBob29rcy5zdG9wOwoJCQlzdG9wKCBnb3RvRW5kICk7CgkJfTsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCWdvdG9FbmQgPSBjbGVhclF1ZXVlOwoJCQljbGVhclF1ZXVlID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJaWYgKCBjbGVhclF1ZXVlICYmIHR5cGUgIT09IGZhbHNlICkgewoJCQl0aGlzLnF1ZXVlKCB0eXBlIHx8ICJmeCIsIFtdICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgZGVxdWV1ZSA9IHRydWUsCgkJCQlpbmRleCA9IHR5cGUgIT0gbnVsbCAmJiB0eXBlICsgInF1ZXVlSG9va3MiLAoJCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKTsKCgkJCWlmICggaW5kZXggKSB7CgkJCQlpZiAoIGRhdGFbIGluZGV4IF0gJiYgZGF0YVsgaW5kZXggXS5zdG9wICkgewoJCQkJCXN0b3BRdWV1ZSggZGF0YVsgaW5kZXggXSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZm9yICggaW5kZXggaW4gZGF0YSApIHsKCQkJCQlpZiAoIGRhdGFbIGluZGV4IF0gJiYgZGF0YVsgaW5kZXggXS5zdG9wICYmIHJydW4udGVzdCggaW5kZXggKSApIHsKCQkJCQkJc3RvcFF1ZXVlKCBkYXRhWyBpbmRleCBdICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlmb3IgKCBpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07ICkgewoJCQkJaWYgKCB0aW1lcnNbIGluZGV4IF0uZWxlbSA9PT0gdGhpcyAmJiAodHlwZSA9PSBudWxsIHx8IHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSkgKSB7CgkJCQkJdGltZXJzWyBpbmRleCBdLmFuaW0uc3RvcCggZ290b0VuZCApOwoJCQkJCWRlcXVldWUgPSBmYWxzZTsKCQkJCQl0aW1lcnMuc3BsaWNlKCBpbmRleCwgMSApOwoJCQkJfQoJCQl9CgoJCQkvLyBzdGFydCB0aGUgbmV4dCBpbiB0aGUgcXVldWUgaWYgdGhlIGxhc3Qgc3RlcCB3YXNuJ3QgZm9yY2VkCgkJCS8vIHRpbWVycyBjdXJyZW50bHkgd2lsbCBjYWxsIHRoZWlyIGNvbXBsZXRlIGNhbGxiYWNrcywgd2hpY2ggd2lsbCBkZXF1ZXVlCgkJCS8vIGJ1dCBvbmx5IGlmIHRoZXkgd2VyZSBnb3RvRW5kCgkJCWlmICggZGVxdWV1ZSB8fCAhZ290b0VuZCApIHsKCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJCX0KCQl9KTsKCX0sCglmaW5pc2g6IGZ1bmN0aW9uKCB0eXBlICkgewoJCWlmICggdHlwZSAhPT0gZmFsc2UgKSB7CgkJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgkJfQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBpbmRleCwKCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKSwKCQkJCXF1ZXVlID0gZGF0YVsgdHlwZSArICJxdWV1ZSIgXSwKCQkJCWhvb2tzID0gZGF0YVsgdHlwZSArICJxdWV1ZUhvb2tzIiBdLAoJCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJCWxlbmd0aCA9IHF1ZXVlID8gcXVldWUubGVuZ3RoIDogMDsKCgkJCS8vIGVuYWJsZSBmaW5pc2hpbmcgZmxhZyBvbiBwcml2YXRlIGRhdGEKCQkJZGF0YS5maW5pc2ggPSB0cnVlOwoKCQkJLy8gZW1wdHkgdGhlIHF1ZXVlIGZpcnN0CgkJCWpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgW10gKTsKCgkJCWlmICggaG9va3MgJiYgaG9va3MuY3VyICYmIGhvb2tzLmN1ci5maW5pc2ggKSB7CgkJCQlob29rcy5jdXIuZmluaXNoLmNhbGwoIHRoaXMgKTsKCQkJfQoKCQkJLy8gbG9vayBmb3IgYW55IGFjdGl2ZSBhbmltYXRpb25zLCBhbmQgZmluaXNoIHRoZW0KCQkJZm9yICggaW5kZXggPSB0aW1lcnMubGVuZ3RoOyBpbmRleC0tOyApIHsKCQkJCWlmICggdGltZXJzWyBpbmRleCBdLmVsZW0gPT09IHRoaXMgJiYgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlICkgewoJCQkJCXRpbWVyc1sgaW5kZXggXS5hbmltLnN0b3AoIHRydWUgKTsKCQkJCQl0aW1lcnMuc3BsaWNlKCBpbmRleCwgMSApOwoJCQkJfQoJCQl9CgoJCQkvLyBsb29rIGZvciBhbnkgYW5pbWF0aW9ucyBpbiB0aGUgb2xkIHF1ZXVlIGFuZCBmaW5pc2ggdGhlbQoJCQlmb3IgKCBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCQkJaWYgKCBxdWV1ZVsgaW5kZXggXSAmJiBxdWV1ZVsgaW5kZXggXS5maW5pc2ggKSB7CgkJCQkJcXVldWVbIGluZGV4IF0uZmluaXNoLmNhbGwoIHRoaXMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gdHVybiBvZmYgZmluaXNoaW5nIGZsYWcKCQkJZGVsZXRlIGRhdGEuZmluaXNoOwoJCX0pOwoJfQp9KTsKCi8vIEdlbmVyYXRlIHBhcmFtZXRlcnMgdG8gY3JlYXRlIGEgc3RhbmRhcmQgYW5pbWF0aW9uCmZ1bmN0aW9uIGdlbkZ4KCB0eXBlLCBpbmNsdWRlV2lkdGggKSB7Cgl2YXIgd2hpY2gsCgkJYXR0cnMgPSB7IGhlaWdodDogdHlwZSB9LAoJCWkgPSAwOwoKCS8vIGlmIHdlIGluY2x1ZGUgd2lkdGgsIHN0ZXAgdmFsdWUgaXMgMSB0byBkbyBhbGwgY3NzRXhwYW5kIHZhbHVlcywKCS8vIGlmIHdlIGRvbid0IGluY2x1ZGUgd2lkdGgsIHN0ZXAgdmFsdWUgaXMgMiB0byBza2lwIG92ZXIgTGVmdCBhbmQgUmlnaHQKCWluY2x1ZGVXaWR0aCA9IGluY2x1ZGVXaWR0aD8gMSA6IDA7Cglmb3IoIDsgaSA8IDQgOyBpICs9IDIgLSBpbmNsdWRlV2lkdGggKSB7CgkJd2hpY2ggPSBjc3NFeHBhbmRbIGkgXTsKCQlhdHRyc1sgIm1hcmdpbiIgKyB3aGljaCBdID0gYXR0cnNbICJwYWRkaW5nIiArIHdoaWNoIF0gPSB0eXBlOwoJfQoKCWlmICggaW5jbHVkZVdpZHRoICkgewoJCWF0dHJzLm9wYWNpdHkgPSBhdHRycy53aWR0aCA9IHR5cGU7Cgl9CgoJcmV0dXJuIGF0dHJzOwp9CgovLyBHZW5lcmF0ZSBzaG9ydGN1dHMgZm9yIGN1c3RvbSBhbmltYXRpb25zCmpRdWVyeS5lYWNoKHsKCXNsaWRlRG93bjogZ2VuRngoInNob3ciKSwKCXNsaWRlVXA6IGdlbkZ4KCJoaWRlIiksCglzbGlkZVRvZ2dsZTogZ2VuRngoInRvZ2dsZSIpLAoJZmFkZUluOiB7IG9wYWNpdHk6ICJzaG93IiB9LAoJZmFkZU91dDogeyBvcGFjaXR5OiAiaGlkZSIgfSwKCWZhZGVUb2dnbGU6IHsgb3BhY2l0eTogInRvZ2dsZSIgfQp9LCBmdW5jdGlvbiggbmFtZSwgcHJvcHMgKSB7CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQlyZXR1cm4gdGhpcy5hbmltYXRlKCBwcm9wcywgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX07Cn0pOwoKalF1ZXJ5LnNwZWVkID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGZuICkgewoJdmFyIG9wdCA9IHNwZWVkICYmIHR5cGVvZiBzcGVlZCA9PT0gIm9iamVjdCIgPyBqUXVlcnkuZXh0ZW5kKCB7fSwgc3BlZWQgKSA6IHsKCQljb21wbGV0ZTogZm4gfHwgIWZuICYmIGVhc2luZyB8fAoJCQlqUXVlcnkuaXNGdW5jdGlvbiggc3BlZWQgKSAmJiBzcGVlZCwKCQlkdXJhdGlvbjogc3BlZWQsCgkJZWFzaW5nOiBmbiAmJiBlYXNpbmcgfHwgZWFzaW5nICYmICFqUXVlcnkuaXNGdW5jdGlvbiggZWFzaW5nICkgJiYgZWFzaW5nCgl9OwoKCW9wdC5kdXJhdGlvbiA9IGpRdWVyeS5meC5vZmYgPyAwIDogdHlwZW9mIG9wdC5kdXJhdGlvbiA9PT0gIm51bWJlciIgPyBvcHQuZHVyYXRpb24gOgoJCW9wdC5kdXJhdGlvbiBpbiBqUXVlcnkuZnguc3BlZWRzID8galF1ZXJ5LmZ4LnNwZWVkc1sgb3B0LmR1cmF0aW9uIF0gOiBqUXVlcnkuZnguc3BlZWRzLl9kZWZhdWx0OwoKCS8vIG5vcm1hbGl6ZSBvcHQucXVldWUgLSB0cnVlL3VuZGVmaW5lZC9udWxsIC0+ICJmeCIKCWlmICggb3B0LnF1ZXVlID09IG51bGwgfHwgb3B0LnF1ZXVlID09PSB0cnVlICkgewoJCW9wdC5xdWV1ZSA9ICJmeCI7Cgl9CgoJLy8gUXVldWVpbmcKCW9wdC5vbGQgPSBvcHQuY29tcGxldGU7CgoJb3B0LmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggb3B0Lm9sZCApICkgewoJCQlvcHQub2xkLmNhbGwoIHRoaXMgKTsKCQl9CgoJCWlmICggb3B0LnF1ZXVlICkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgb3B0LnF1ZXVlICk7CgkJfQoJfTsKCglyZXR1cm4gb3B0Owp9OwoKalF1ZXJ5LmVhc2luZyA9IHsKCWxpbmVhcjogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHA7Cgl9LAoJc3dpbmc6IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiAwLjUgLSBNYXRoLmNvcyggcCpNYXRoLlBJICkgLyAyOwoJfQp9OwoKalF1ZXJ5LnRpbWVycyA9IFtdOwpqUXVlcnkuZnggPSBUd2Vlbi5wcm90b3R5cGUuaW5pdDsKalF1ZXJ5LmZ4LnRpY2sgPSBmdW5jdGlvbigpIHsKCXZhciB0aW1lciwKCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCWkgPSAwOwoKCWZ4Tm93ID0galF1ZXJ5Lm5vdygpOwoKCWZvciAoIDsgaSA8IHRpbWVycy5sZW5ndGg7IGkrKyApIHsKCQl0aW1lciA9IHRpbWVyc1sgaSBdOwoJCS8vIENoZWNrcyB0aGUgdGltZXIgaGFzIG5vdCBhbHJlYWR5IGJlZW4gcmVtb3ZlZAoJCWlmICggIXRpbWVyKCkgJiYgdGltZXJzWyBpIF0gPT09IHRpbWVyICkgewoJCQl0aW1lcnMuc3BsaWNlKCBpLS0sIDEgKTsKCQl9Cgl9CgoJaWYgKCAhdGltZXJzLmxlbmd0aCApIHsKCQlqUXVlcnkuZnguc3RvcCgpOwoJfQoJZnhOb3cgPSB1bmRlZmluZWQ7Cn07CgpqUXVlcnkuZngudGltZXIgPSBmdW5jdGlvbiggdGltZXIgKSB7CglpZiAoIHRpbWVyKCkgJiYgalF1ZXJ5LnRpbWVycy5wdXNoKCB0aW1lciApICkgewoJCWpRdWVyeS5meC5zdGFydCgpOwoJfQp9OwoKalF1ZXJ5LmZ4LmludGVydmFsID0gMTM7CgpqUXVlcnkuZnguc3RhcnQgPSBmdW5jdGlvbigpIHsKCWlmICggIXRpbWVySWQgKSB7CgkJdGltZXJJZCA9IHNldEludGVydmFsKCBqUXVlcnkuZngudGljaywgalF1ZXJ5LmZ4LmludGVydmFsICk7Cgl9Cn07CgpqUXVlcnkuZnguc3RvcCA9IGZ1bmN0aW9uKCkgewoJY2xlYXJJbnRlcnZhbCggdGltZXJJZCApOwoJdGltZXJJZCA9IG51bGw7Cn07CgpqUXVlcnkuZnguc3BlZWRzID0gewoJc2xvdzogNjAwLAoJZmFzdDogMjAwLAoJLy8gRGVmYXVsdCBzcGVlZAoJX2RlZmF1bHQ6IDQwMAp9OwoKLy8gQmFjayBDb21wYXQgPDEuOCBleHRlbnNpb24gcG9pbnQKalF1ZXJ5LmZ4LnN0ZXAgPSB7fTsKCmlmICggalF1ZXJ5LmV4cHIgJiYgalF1ZXJ5LmV4cHIuZmlsdGVycyApIHsKCWpRdWVyeS5leHByLmZpbHRlcnMuYW5pbWF0ZWQgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoalF1ZXJ5LnRpbWVycywgZnVuY3Rpb24oIGZuICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gZm4uZWxlbTsKCQl9KS5sZW5ndGg7Cgl9Owp9CmpRdWVyeS5mbi5vZmZzZXQgPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQlyZXR1cm4gb3B0aW9ucyA9PT0gdW5kZWZpbmVkID8KCQkJdGhpcyA6CgkJCXRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJCWpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KCB0aGlzLCBvcHRpb25zLCBpICk7CgkJCX0pOwoJfQoKCXZhciBkb2NFbGVtLCB3aW4sCgkJYm94ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQllbGVtID0gdGhpc1sgMCBdLAoJCWRvYyA9IGVsZW0gJiYgZWxlbS5vd25lckRvY3VtZW50OwoKCWlmICggIWRvYyApIHsKCQlyZXR1cm47Cgl9CgoJZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CgoJLy8gTWFrZSBzdXJlIGl0J3Mgbm90IGEgZGlzY29ubmVjdGVkIERPTSBub2RlCglpZiAoICFqUXVlcnkuY29udGFpbnMoIGRvY0VsZW0sIGVsZW0gKSApIHsKCQlyZXR1cm4gYm94OwoJfQoKCS8vIElmIHdlIGRvbid0IGhhdmUgZ0JDUiwganVzdCB1c2UgMCwwIHJhdGhlciB0aGFuIGVycm9yCgkvLyBCbGFja0JlcnJ5IDUsIGlPUyAzIChvcmlnaW5hbCBpUGhvbmUpCglpZiAoIHR5cGVvZiBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJYm94ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCX0KCXdpbiA9IGdldFdpbmRvdyggZG9jICk7CglyZXR1cm4gewoJCXRvcDogYm94LnRvcCAgKyAoIHdpbi5wYWdlWU9mZnNldCB8fCBkb2NFbGVtLnNjcm9sbFRvcCApICAtICggZG9jRWxlbS5jbGllbnRUb3AgIHx8IDAgKSwKCQlsZWZ0OiBib3gubGVmdCArICggd2luLnBhZ2VYT2Zmc2V0IHx8IGRvY0VsZW0uc2Nyb2xsTGVmdCApIC0gKCBkb2NFbGVtLmNsaWVudExlZnQgfHwgMCApCgl9Owp9OwoKalF1ZXJ5Lm9mZnNldCA9IHsKCglzZXRPZmZzZXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBpICkgewoJCXZhciBwb3NpdGlvbiA9IGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKTsKCgkJLy8gc2V0IHBvc2l0aW9uIGZpcnN0LCBpbi1jYXNlIHRvcC9sZWZ0IGFyZSBzZXQgZXZlbiBvbiBzdGF0aWMgZWxlbQoJCWlmICggcG9zaXRpb24gPT09ICJzdGF0aWMiICkgewoJCQllbGVtLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCQl9CgoJCXZhciBjdXJFbGVtID0galF1ZXJ5KCBlbGVtICksCgkJCWN1ck9mZnNldCA9IGN1ckVsZW0ub2Zmc2V0KCksCgkJCWN1ckNTU1RvcCA9IGpRdWVyeS5jc3MoIGVsZW0sICJ0b3AiICksCgkJCWN1ckNTU0xlZnQgPSBqUXVlcnkuY3NzKCBlbGVtLCAibGVmdCIgKSwKCQkJY2FsY3VsYXRlUG9zaXRpb24gPSAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgJiYgalF1ZXJ5LmluQXJyYXkoImF1dG8iLCBbY3VyQ1NTVG9wLCBjdXJDU1NMZWZ0XSkgPiAtMSwKCQkJcHJvcHMgPSB7fSwgY3VyUG9zaXRpb24gPSB7fSwgY3VyVG9wLCBjdXJMZWZ0OwoKCQkvLyBuZWVkIHRvIGJlIGFibGUgdG8gY2FsY3VsYXRlIHBvc2l0aW9uIGlmIGVpdGhlciB0b3Agb3IgbGVmdCBpcyBhdXRvIGFuZCBwb3NpdGlvbiBpcyBlaXRoZXIgYWJzb2x1dGUgb3IgZml4ZWQKCQlpZiAoIGNhbGN1bGF0ZVBvc2l0aW9uICkgewoJCQljdXJQb3NpdGlvbiA9IGN1ckVsZW0ucG9zaXRpb24oKTsKCQkJY3VyVG9wID0gY3VyUG9zaXRpb24udG9wOwoJCQljdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDsKCQl9IGVsc2UgewoJCQljdXJUb3AgPSBwYXJzZUZsb2F0KCBjdXJDU1NUb3AgKSB8fCAwOwoJCQljdXJMZWZ0ID0gcGFyc2VGbG9hdCggY3VyQ1NTTGVmdCApIHx8IDA7CgkJfQoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHRpb25zICkgKSB7CgkJCW9wdGlvbnMgPSBvcHRpb25zLmNhbGwoIGVsZW0sIGksIGN1ck9mZnNldCApOwoJCX0KCgkJaWYgKCBvcHRpb25zLnRvcCAhPSBudWxsICkgewoJCQlwcm9wcy50b3AgPSAoIG9wdGlvbnMudG9wIC0gY3VyT2Zmc2V0LnRvcCApICsgY3VyVG9wOwoJCX0KCQlpZiAoIG9wdGlvbnMubGVmdCAhPSBudWxsICkgewoJCQlwcm9wcy5sZWZ0ID0gKCBvcHRpb25zLmxlZnQgLSBjdXJPZmZzZXQubGVmdCApICsgY3VyTGVmdDsKCQl9CgoJCWlmICggInVzaW5nIiBpbiBvcHRpb25zICkgewoJCQlvcHRpb25zLnVzaW5nLmNhbGwoIGVsZW0sIHByb3BzICk7CgkJfSBlbHNlIHsKCQkJY3VyRWxlbS5jc3MoIHByb3BzICk7CgkJfQoJfQp9OwoKCmpRdWVyeS5mbi5leHRlbmQoewoKCXBvc2l0aW9uOiBmdW5jdGlvbigpIHsKCQlpZiAoICF0aGlzWyAwIF0gKSB7CgkJCXJldHVybjsKCQl9CgoJCXZhciBvZmZzZXRQYXJlbnQsIG9mZnNldCwKCQkJcGFyZW50T2Zmc2V0ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQkJZWxlbSA9IHRoaXNbIDAgXTsKCgkJLy8gZml4ZWQgZWxlbWVudHMgYXJlIG9mZnNldCBmcm9tIHdpbmRvdyAocGFyZW50T2Zmc2V0ID0ge3RvcDowLCBsZWZ0OiAwfSwgYmVjYXVzZSBpdCBpcyBpdCdzIG9ubHkgb2Zmc2V0IHBhcmVudAoJCWlmICggalF1ZXJ5LmNzcyggZWxlbSwgInBvc2l0aW9uIiApID09PSAiZml4ZWQiICkgewoJCQkvLyB3ZSBhc3N1bWUgdGhhdCBnZXRCb3VuZGluZ0NsaWVudFJlY3QgaXMgYXZhaWxhYmxlIHdoZW4gY29tcHV0ZWQgcG9zaXRpb24gaXMgZml4ZWQKCQkJb2Zmc2V0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQl9IGVsc2UgewoJCQkvLyBHZXQgKnJlYWwqIG9mZnNldFBhcmVudAoJCQlvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudCgpOwoKCQkJLy8gR2V0IGNvcnJlY3Qgb2Zmc2V0cwoJCQlvZmZzZXQgPSB0aGlzLm9mZnNldCgpOwoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudFsgMCBdLCAiaHRtbCIgKSApIHsKCQkJCXBhcmVudE9mZnNldCA9IG9mZnNldFBhcmVudC5vZmZzZXQoKTsKCQkJfQoKCQkJLy8gQWRkIG9mZnNldFBhcmVudCBib3JkZXJzCgkJCXBhcmVudE9mZnNldC50b3AgICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyVG9wV2lkdGgiLCB0cnVlICk7CgkJCXBhcmVudE9mZnNldC5sZWZ0ICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyTGVmdFdpZHRoIiwgdHJ1ZSApOwoJCX0KCgkJLy8gU3VidHJhY3QgcGFyZW50IG9mZnNldHMgYW5kIGVsZW1lbnQgbWFyZ2lucwoJCS8vIG5vdGU6IHdoZW4gYW4gZWxlbWVudCBoYXMgbWFyZ2luOiBhdXRvIHRoZSBvZmZzZXRMZWZ0IGFuZCBtYXJnaW5MZWZ0CgkJLy8gYXJlIHRoZSBzYW1lIGluIFNhZmFyaSBjYXVzaW5nIG9mZnNldC5sZWZ0IHRvIGluY29ycmVjdGx5IGJlIDAKCQlyZXR1cm4gewoJCQl0b3A6ICBvZmZzZXQudG9wICAtIHBhcmVudE9mZnNldC50b3AgLSBqUXVlcnkuY3NzKCBlbGVtLCAibWFyZ2luVG9wIiwgdHJ1ZSApLAoJCQlsZWZ0OiBvZmZzZXQubGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0IC0galF1ZXJ5LmNzcyggZWxlbSwgIm1hcmdpbkxlZnQiLCB0cnVlKQoJCX07Cgl9LAoKCW9mZnNldFBhcmVudDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQl2YXIgb2Zmc2V0UGFyZW50ID0gdGhpcy5vZmZzZXRQYXJlbnQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoJCQl3aGlsZSAoIG9mZnNldFBhcmVudCAmJiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudCwgImh0bWwiICkgJiYgalF1ZXJ5LmNzcyggb2Zmc2V0UGFyZW50LCAicG9zaXRpb24iKSA9PT0gInN0YXRpYyIgKSApIHsKCQkJCW9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5vZmZzZXRQYXJlbnQ7CgkJCX0KCQkJcmV0dXJuIG9mZnNldFBhcmVudCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgkJfSk7Cgl9Cn0pOwoKCi8vIENyZWF0ZSBzY3JvbGxMZWZ0IGFuZCBzY3JvbGxUb3AgbWV0aG9kcwpqUXVlcnkuZWFjaCgge3Njcm9sbExlZnQ6ICJwYWdlWE9mZnNldCIsIHNjcm9sbFRvcDogInBhZ2VZT2Zmc2V0In0sIGZ1bmN0aW9uKCBtZXRob2QsIHByb3AgKSB7Cgl2YXIgdG9wID0gL1kvLnRlc3QoIHByb3AgKTsKCglqUXVlcnkuZm5bIG1ldGhvZCBdID0gZnVuY3Rpb24oIHZhbCApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG1ldGhvZCwgdmFsICkgewoJCQl2YXIgd2luID0gZ2V0V2luZG93KCBlbGVtICk7CgoJCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHdpbiA/IChwcm9wIGluIHdpbikgPyB3aW5bIHByb3AgXSA6CgkJCQkJd2luLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgbWV0aG9kIF0gOgoJCQkJCWVsZW1bIG1ldGhvZCBdOwoJCQl9CgoJCQlpZiAoIHdpbiApIHsKCQkJCXdpbi5zY3JvbGxUbygKCQkJCQkhdG9wID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxMZWZ0KCksCgkJCQkJdG9wID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxUb3AoKQoJCQkJKTsKCgkJCX0gZWxzZSB7CgkJCQllbGVtWyBtZXRob2QgXSA9IHZhbDsKCQkJfQoJCX0sIG1ldGhvZCwgdmFsLCBhcmd1bWVudHMubGVuZ3RoLCBudWxsICk7Cgl9Owp9KTsKCmZ1bmN0aW9uIGdldFdpbmRvdyggZWxlbSApIHsKCXJldHVybiBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSA/CgkJZWxlbSA6CgkJZWxlbS5ub2RlVHlwZSA9PT0gOSA/CgkJCWVsZW0uZGVmYXVsdFZpZXcgfHwgZWxlbS5wYXJlbnRXaW5kb3cgOgoJCQlmYWxzZTsKfQovLyBDcmVhdGUgaW5uZXJIZWlnaHQsIGlubmVyV2lkdGgsIGhlaWdodCwgd2lkdGgsIG91dGVySGVpZ2h0IGFuZCBvdXRlcldpZHRoIG1ldGhvZHMKalF1ZXJ5LmVhY2goIHsgSGVpZ2h0OiAiaGVpZ2h0IiwgV2lkdGg6ICJ3aWR0aCIgfSwgZnVuY3Rpb24oIG5hbWUsIHR5cGUgKSB7CglqUXVlcnkuZWFjaCggeyBwYWRkaW5nOiAiaW5uZXIiICsgbmFtZSwgY29udGVudDogdHlwZSwgIiI6ICJvdXRlciIgKyBuYW1lIH0sIGZ1bmN0aW9uKCBkZWZhdWx0RXh0cmEsIGZ1bmNOYW1lICkgewoJCS8vIG1hcmdpbiBpcyBvbmx5IGZvciBvdXRlckhlaWdodCwgb3V0ZXJXaWR0aAoJCWpRdWVyeS5mblsgZnVuY05hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4sIHZhbHVlICkgewoJCQl2YXIgY2hhaW5hYmxlID0gYXJndW1lbnRzLmxlbmd0aCAmJiAoIGRlZmF1bHRFeHRyYSB8fCB0eXBlb2YgbWFyZ2luICE9PSAiYm9vbGVhbiIgKSwKCQkJCWV4dHJhID0gZGVmYXVsdEV4dHJhIHx8ICggbWFyZ2luID09PSB0cnVlIHx8IHZhbHVlID09PSB0cnVlID8gIm1hcmdpbiIgOiAiYm9yZGVyIiApOwoKCQkJcmV0dXJuIGpRdWVyeS5hY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCB0eXBlLCB2YWx1ZSApIHsKCQkJCXZhciBkb2M7CgoJCQkJaWYgKCBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCQkJCQkvLyBBcyBvZiA1LzgvMjAxMiB0aGlzIHdpbGwgeWllbGQgaW5jb3JyZWN0IHJlc3VsdHMgZm9yIE1vYmlsZSBTYWZhcmksIGJ1dCB0aGVyZQoJCQkJCS8vIGlzbid0IGEgd2hvbGUgbG90IHdlIGNhbiBkby4gU2VlIHB1bGwgcmVxdWVzdCBhdCB0aGlzIFVSTCBmb3IgZGlzY3Vzc2lvbjoKCQkJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS9wdWxsLzc2NAoJCQkJCXJldHVybiBlbGVtLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgImNsaWVudCIgKyBuYW1lIF07CgkJCQl9CgoJCQkJLy8gR2V0IGRvY3VtZW50IHdpZHRoIG9yIGhlaWdodAoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSA5ICkgewoJCQkJCWRvYyA9IGVsZW0uZG9jdW1lbnRFbGVtZW50OwoKCQkJCQkvLyBFaXRoZXIgc2Nyb2xsW1dpZHRoL0hlaWdodF0gb3Igb2Zmc2V0W1dpZHRoL0hlaWdodF0gb3IgY2xpZW50W1dpZHRoL0hlaWdodF0sIHdoaWNoZXZlciBpcyBncmVhdGVzdAoJCQkJCS8vIHVuZm9ydHVuYXRlbHksIHRoaXMgY2F1c2VzIGJ1ZyAjMzgzOCBpbiBJRTYvOCBvbmx5LCBidXQgdGhlcmUgaXMgY3VycmVudGx5IG5vIGdvb2QsIHNtYWxsIHdheSB0byBmaXggaXQuCgkJCQkJcmV0dXJuIE1hdGgubWF4KAoJCQkJCQllbGVtLmJvZHlbICJzY3JvbGwiICsgbmFtZSBdLCBkb2NbICJzY3JvbGwiICsgbmFtZSBdLAoJCQkJCQllbGVtLmJvZHlbICJvZmZzZXQiICsgbmFtZSBdLCBkb2NbICJvZmZzZXQiICsgbmFtZSBdLAoJCQkJCQlkb2NbICJjbGllbnQiICsgbmFtZSBdCgkJCQkJKTsKCQkJCX0KCgkJCQlyZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/CgkJCQkJLy8gR2V0IHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudCwgcmVxdWVzdGluZyBidXQgbm90IGZvcmNpbmcgcGFyc2VGbG9hdAoJCQkJCWpRdWVyeS5jc3MoIGVsZW0sIHR5cGUsIGV4dHJhICkgOgoKCQkJCQkvLyBTZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50CgkJCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCB0eXBlLCB2YWx1ZSwgZXh0cmEgKTsKCQkJfSwgdHlwZSwgY2hhaW5hYmxlID8gbWFyZ2luIDogdW5kZWZpbmVkLCBjaGFpbmFibGUsIG51bGwgKTsKCQl9OwoJfSk7Cn0pOwovLyBMaW1pdCBzY29wZSBwb2xsdXRpb24gZnJvbSBhbnkgZGVwcmVjYXRlZCBBUEkKLy8gKGZ1bmN0aW9uKCkgewoKLy8gfSkoKTsKLy8gRXhwb3NlIGpRdWVyeSB0byB0aGUgZ2xvYmFsIG9iamVjdAp3aW5kb3cualF1ZXJ5ID0gd2luZG93LiQgPSBqUXVlcnk7CgovLyBFeHBvc2UgalF1ZXJ5IGFzIGFuIEFNRCBtb2R1bGUsIGJ1dCBvbmx5IGZvciBBTUQgbG9hZGVycyB0aGF0Ci8vIHVuZGVyc3RhbmQgdGhlIGlzc3VlcyB3aXRoIGxvYWRpbmcgbXVsdGlwbGUgdmVyc2lvbnMgb2YgalF1ZXJ5Ci8vIGluIGEgcGFnZSB0aGF0IGFsbCBtaWdodCBjYWxsIGRlZmluZSgpLiBUaGUgbG9hZGVyIHdpbGwgaW5kaWNhdGUKLy8gdGhleSBoYXZlIHNwZWNpYWwgYWxsb3dhbmNlcyBmb3IgbXVsdGlwbGUgalF1ZXJ5IHZlcnNpb25zIGJ5Ci8vIHNwZWNpZnlpbmcgZGVmaW5lLmFtZC5qUXVlcnkgPSB0cnVlLiBSZWdpc3RlciBhcyBhIG5hbWVkIG1vZHVsZSwKLy8gc2luY2UgalF1ZXJ5IGNhbiBiZSBjb25jYXRlbmF0ZWQgd2l0aCBvdGhlciBmaWxlcyB0aGF0IG1heSB1c2UgZGVmaW5lLAovLyBidXQgbm90IHVzZSBhIHByb3BlciBjb25jYXRlbmF0aW9uIHNjcmlwdCB0aGF0IHVuZGVyc3RhbmRzIGFub255bW91cwovLyBBTUQgbW9kdWxlcy4gQSBuYW1lZCBBTUQgaXMgc2FmZXN0IGFuZCBtb3N0IHJvYnVzdCB3YXkgdG8gcmVnaXN0ZXIuCi8vIExvd2VyY2FzZSBqcXVlcnkgaXMgdXNlZCBiZWNhdXNlIEFNRCBtb2R1bGUgbmFtZXMgYXJlIGRlcml2ZWQgZnJvbQovLyBmaWxlIG5hbWVzLCBhbmQgalF1ZXJ5IGlzIG5vcm1hbGx5IGRlbGl2ZXJlZCBpbiBhIGxvd2VyY2FzZSBmaWxlIG5hbWUuCi8vIERvIHRoaXMgYWZ0ZXIgY3JlYXRpbmcgdGhlIGdsb2JhbCBzbyB0aGF0IGlmIGFuIEFNRCBtb2R1bGUgd2FudHMgdG8gY2FsbAovLyBub0NvbmZsaWN0IHRvIGhpZGUgdGhpcyB2ZXJzaW9uIG9mIGpRdWVyeSwgaXQgd2lsbCB3b3JrLgppZiAoIHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCAmJiBkZWZpbmUuYW1kLmpRdWVyeSApIHsKCWRlZmluZSggImpxdWVyeSIsIFtdLCBmdW5jdGlvbiAoKSB7IHJldHVybiBqUXVlcnk7IH0gKTsKfQoKfSkoIHdpbmRvdyApOwovLyAgICAgVW5kZXJzY29yZS5qcyAxLjYuMAovLyAgICAgaHR0cDovL3VuZGVyc2NvcmVqcy5vcmcKLy8gICAgIChjKSAyMDA5LTIwMTQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKLy8gICAgIFVuZGVyc2NvcmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCgooZnVuY3Rpb24oKSB7CgogIC8vIEJhc2VsaW5lIHNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLS0KCiAgLy8gRXN0YWJsaXNoIHRoZSByb290IG9iamVjdCwgYHdpbmRvd2AgaW4gdGhlIGJyb3dzZXIsIG9yIGBleHBvcnRzYCBvbiB0aGUgc2VydmVyLgogIHZhciByb290ID0gdGhpczsKCiAgLy8gU2F2ZSB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIGBfYCB2YXJpYWJsZS4KICB2YXIgcHJldmlvdXNVbmRlcnNjb3JlID0gcm9vdC5fOwoKICAvLyBFc3RhYmxpc2ggdGhlIG9iamVjdCB0aGF0IGdldHMgcmV0dXJuZWQgdG8gYnJlYWsgb3V0IG9mIGEgbG9vcCBpdGVyYXRpb24uCiAgdmFyIGJyZWFrZXIgPSB7fTsKCiAgLy8gU2F2ZSBieXRlcyBpbiB0aGUgbWluaWZpZWQgKGJ1dCBub3QgZ3ppcHBlZCkgdmVyc2lvbjoKICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwgT2JqUHJvdG8gPSBPYmplY3QucHJvdG90eXBlLCBGdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7CgogIC8vIENyZWF0ZSBxdWljayByZWZlcmVuY2UgdmFyaWFibGVzIGZvciBzcGVlZCBhY2Nlc3MgdG8gY29yZSBwcm90b3R5cGVzLgogIHZhcgogICAgcHVzaCAgICAgICAgICAgICA9IEFycmF5UHJvdG8ucHVzaCwKICAgIHNsaWNlICAgICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgY29uY2F0ICAgICAgICAgICA9IEFycmF5UHJvdG8uY29uY2F0LAogICAgdG9TdHJpbmcgICAgICAgICA9IE9ialByb3RvLnRvU3RyaW5nLAogICAgaGFzT3duUHJvcGVydHkgICA9IE9ialByb3RvLmhhc093blByb3BlcnR5OwoKICAvLyBBbGwgKipFQ01BU2NyaXB0IDUqKiBuYXRpdmUgZnVuY3Rpb24gaW1wbGVtZW50YXRpb25zIHRoYXQgd2UgaG9wZSB0byB1c2UKICAvLyBhcmUgZGVjbGFyZWQgaGVyZS4KICB2YXIKICAgIG5hdGl2ZUZvckVhY2ggICAgICA9IEFycmF5UHJvdG8uZm9yRWFjaCwKICAgIG5hdGl2ZU1hcCAgICAgICAgICA9IEFycmF5UHJvdG8ubWFwLAogICAgbmF0aXZlUmVkdWNlICAgICAgID0gQXJyYXlQcm90by5yZWR1Y2UsCiAgICBuYXRpdmVSZWR1Y2VSaWdodCAgPSBBcnJheVByb3RvLnJlZHVjZVJpZ2h0LAogICAgbmF0aXZlRmlsdGVyICAgICAgID0gQXJyYXlQcm90by5maWx0ZXIsCiAgICBuYXRpdmVFdmVyeSAgICAgICAgPSBBcnJheVByb3RvLmV2ZXJ5LAogICAgbmF0aXZlU29tZSAgICAgICAgID0gQXJyYXlQcm90by5zb21lLAogICAgbmF0aXZlSW5kZXhPZiAgICAgID0gQXJyYXlQcm90by5pbmRleE9mLAogICAgbmF0aXZlTGFzdEluZGV4T2YgID0gQXJyYXlQcm90by5sYXN0SW5kZXhPZiwKICAgIG5hdGl2ZUlzQXJyYXkgICAgICA9IEFycmF5LmlzQXJyYXksCiAgICBuYXRpdmVLZXlzICAgICAgICAgPSBPYmplY3Qua2V5cywKICAgIG5hdGl2ZUJpbmQgICAgICAgICA9IEZ1bmNQcm90by5iaW5kOwoKICAvLyBDcmVhdGUgYSBzYWZlIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yIHVzZSBiZWxvdy4KICB2YXIgXyA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF8pIHJldHVybiBvYmo7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgXykpIHJldHVybiBuZXcgXyhvYmopOwogICAgdGhpcy5fd3JhcHBlZCA9IG9iajsKICB9OwoKICAvLyBFeHBvcnQgdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciAqKk5vZGUuanMqKiwgd2l0aAogIC8vIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5IGZvciB0aGUgb2xkIGByZXF1aXJlKClgIEFQSS4gSWYgd2UncmUgaW4KICAvLyB0aGUgYnJvd3NlciwgYWRkIGBfYCBhcyBhIGdsb2JhbCBvYmplY3QgdmlhIGEgc3RyaW5nIGlkZW50aWZpZXIsCiAgLy8gZm9yIENsb3N1cmUgQ29tcGlsZXIgImFkdmFuY2VkIiBtb2RlLgogIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBfOwogICAgfQogICAgZXhwb3J0cy5fID0gXzsKICB9IGVsc2UgewogICAgcm9vdC5fID0gXzsKICB9CgogIC8vIEN1cnJlbnQgdmVyc2lvbi4KICBfLlZFUlNJT04gPSAnMS42LjAnOwoKICAvLyBDb2xsZWN0aW9uIEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFRoZSBjb3JuZXJzdG9uZSwgYW4gYGVhY2hgIGltcGxlbWVudGF0aW9uLCBha2EgYGZvckVhY2hgLgogIC8vIEhhbmRsZXMgb2JqZWN0cyB3aXRoIHRoZSBidWlsdC1pbiBgZm9yRWFjaGAsIGFycmF5cywgYW5kIHJhdyBvYmplY3RzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmb3JFYWNoYCBpZiBhdmFpbGFibGUuCiAgdmFyIGVhY2ggPSBfLmVhY2ggPSBfLmZvckVhY2ggPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiBvYmo7CiAgICBpZiAobmF0aXZlRm9yRWFjaCAmJiBvYmouZm9yRWFjaCA9PT0gbmF0aXZlRm9yRWFjaCkgewogICAgICBvYmouZm9yRWFjaChpdGVyYXRvciwgY29udGV4dCk7CiAgICB9IGVsc2UgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpba2V5c1tpXV0sIGtleXNbaV0sIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gdGhlIHJlc3VsdHMgb2YgYXBwbHlpbmcgdGhlIGl0ZXJhdG9yIHRvIGVhY2ggZWxlbWVudC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgbWFwYCBpZiBhdmFpbGFibGUuCiAgXy5tYXAgPSBfLmNvbGxlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0czsKICAgIGlmIChuYXRpdmVNYXAgJiYgb2JqLm1hcCA9PT0gbmF0aXZlTWFwKSByZXR1cm4gb2JqLm1hcChpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJlc3VsdHMucHVzaChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB2YXIgcmVkdWNlRXJyb3IgPSAnUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZSc7CgogIC8vICoqUmVkdWNlKiogYnVpbGRzIHVwIGEgc2luZ2xlIHJlc3VsdCBmcm9tIGEgbGlzdCBvZiB2YWx1ZXMsIGFrYSBgaW5qZWN0YCwKICAvLyBvciBgZm9sZGxgLiBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgcmVkdWNlYCBpZiBhdmFpbGFibGUuCiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KSB7CiAgICB2YXIgaW5pdGlhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyOwogICAgaWYgKG9iaiA9PSBudWxsKSBvYmogPSBbXTsKICAgIGlmIChuYXRpdmVSZWR1Y2UgJiYgb2JqLnJlZHVjZSA9PT0gbmF0aXZlUmVkdWNlKSB7CiAgICAgIGlmIChjb250ZXh0KSBpdGVyYXRvciA9IF8uYmluZChpdGVyYXRvciwgY29udGV4dCk7CiAgICAgIHJldHVybiBpbml0aWFsID8gb2JqLnJlZHVjZShpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlKGl0ZXJhdG9yKTsKICAgIH0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCFpbml0aWFsKSB7CiAgICAgICAgbWVtbyA9IHZhbHVlOwogICAgICAgIGluaXRpYWwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1lbW8gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG1lbW8sIHZhbHVlLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFRoZSByaWdodC1hc3NvY2lhdGl2ZSB2ZXJzaW9uIG9mIHJlZHVjZSwgYWxzbyBrbm93biBhcyBgZm9sZHJgLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGByZWR1Y2VSaWdodGAgaWYgYXZhaWxhYmxlLgogIF8ucmVkdWNlUmlnaHQgPSBfLmZvbGRyID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgbWVtbywgY29udGV4dCkgewogICAgdmFyIGluaXRpYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMjsKICAgIGlmIChvYmogPT0gbnVsbCkgb2JqID0gW107CiAgICBpZiAobmF0aXZlUmVkdWNlUmlnaHQgJiYgb2JqLnJlZHVjZVJpZ2h0ID09PSBuYXRpdmVSZWR1Y2VSaWdodCkgewogICAgICBpZiAoY29udGV4dCkgaXRlcmF0b3IgPSBfLmJpbmQoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgICByZXR1cm4gaW5pdGlhbCA/IG9iai5yZWR1Y2VSaWdodChpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlUmlnaHQoaXRlcmF0b3IpOwogICAgfQogICAgdmFyIGxlbmd0aCA9IG9iai5sZW5ndGg7CiAgICBpZiAobGVuZ3RoICE9PSArbGVuZ3RoKSB7CiAgICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICAgIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgfQogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpbmRleCA9IGtleXMgPyBrZXlzWy0tbGVuZ3RoXSA6IC0tbGVuZ3RoOwogICAgICBpZiAoIWluaXRpYWwpIHsKICAgICAgICBtZW1vID0gb2JqW2luZGV4XTsKICAgICAgICBpbml0aWFsID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZW1vID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBtZW1vLCBvYmpbaW5kZXhdLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFJldHVybiB0aGUgZmlyc3QgdmFsdWUgd2hpY2ggcGFzc2VzIGEgdHJ1dGggdGVzdC4gQWxpYXNlZCBhcyBgZGV0ZWN0YC4KICBfLmZpbmQgPSBfLmRldGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0OwogICAgYW55KG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyB0aGF0IHBhc3MgYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmaWx0ZXJgIGlmIGF2YWlsYWJsZS4KICAvLyBBbGlhc2VkIGFzIGBzZWxlY3RgLgogIF8uZmlsdGVyID0gXy5zZWxlY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdHM7CiAgICBpZiAobmF0aXZlRmlsdGVyICYmIG9iai5maWx0ZXIgPT09IG5hdGl2ZUZpbHRlcikgcmV0dXJuIG9iai5maWx0ZXIocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuCiAgXy5yZWplY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcmV0dXJuIF8uZmlsdGVyKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJldHVybiAhcHJlZGljYXRlLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KTsKICAgIH0sIGNvbnRleHQpOwogIH07CgogIC8vIERldGVybWluZSB3aGV0aGVyIGFsbCBvZiB0aGUgZWxlbWVudHMgbWF0Y2ggYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBldmVyeWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFsbGAuCiAgXy5ldmVyeSA9IF8uYWxsID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgIGlmIChuYXRpdmVFdmVyeSAmJiBvYmouZXZlcnkgPT09IG5hdGl2ZUV2ZXJ5KSByZXR1cm4gb2JqLmV2ZXJ5KHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmICghKHJlc3VsdCA9IHJlc3VsdCAmJiBwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSkgcmV0dXJuIGJyZWFrZXI7CiAgICB9KTsKICAgIHJldHVybiAhIXJlc3VsdDsKICB9OwoKICAvLyBEZXRlcm1pbmUgaWYgYXQgbGVhc3Qgb25lIGVsZW1lbnQgaW4gdGhlIG9iamVjdCBtYXRjaGVzIGEgdHJ1dGggdGVzdC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgc29tZWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFueWAuCiAgdmFyIGFueSA9IF8uc29tZSA9IF8uYW55ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHQ7CiAgICBpZiAobmF0aXZlU29tZSAmJiBvYmouc29tZSA9PT0gbmF0aXZlU29tZSkgcmV0dXJuIG9iai5zb21lKHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChyZXN1bHQgfHwgKHJlc3VsdCA9IHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpKSByZXR1cm4gYnJlYWtlcjsKICAgIH0pOwogICAgcmV0dXJuICEhcmVzdWx0OwogIH07CgogIC8vIERldGVybWluZSBpZiB0aGUgYXJyYXkgb3Igb2JqZWN0IGNvbnRhaW5zIGEgZ2l2ZW4gdmFsdWUgKHVzaW5nIGA9PT1gKS4KICAvLyBBbGlhc2VkIGFzIGBpbmNsdWRlYC4KICBfLmNvbnRhaW5zID0gXy5pbmNsdWRlID0gZnVuY3Rpb24ob2JqLCB0YXJnZXQpIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIGZhbHNlOwogICAgaWYgKG5hdGl2ZUluZGV4T2YgJiYgb2JqLmluZGV4T2YgPT09IG5hdGl2ZUluZGV4T2YpIHJldHVybiBvYmouaW5kZXhPZih0YXJnZXQpICE9IC0xOwogICAgcmV0dXJuIGFueShvYmosIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdGFyZ2V0OwogICAgfSk7CiAgfTsKCiAgLy8gSW52b2tlIGEgbWV0aG9kICh3aXRoIGFyZ3VtZW50cykgb24gZXZlcnkgaXRlbSBpbiBhIGNvbGxlY3Rpb24uCiAgXy5pbnZva2UgPSBmdW5jdGlvbihvYmosIG1ldGhvZCkgewogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICB2YXIgaXNGdW5jID0gXy5pc0Z1bmN0aW9uKG1ldGhvZCk7CiAgICByZXR1cm4gXy5tYXAob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKGlzRnVuYyA/IG1ldGhvZCA6IHZhbHVlW21ldGhvZF0pLmFwcGx5KHZhbHVlLCBhcmdzKTsKICAgIH0pOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYG1hcGA6IGZldGNoaW5nIGEgcHJvcGVydHkuCiAgXy5wbHVjayA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gXy5tYXAob2JqLCBfLnByb3BlcnR5KGtleSkpOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbHRlcmA6IHNlbGVjdGluZyBvbmx5IG9iamVjdHMKICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLgogIF8ud2hlcmUgPSBmdW5jdGlvbihvYmosIGF0dHJzKSB7CiAgICByZXR1cm4gXy5maWx0ZXIob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBDb252ZW5pZW5jZSB2ZXJzaW9uIG9mIGEgY29tbW9uIHVzZSBjYXNlIG9mIGBmaW5kYDogZ2V0dGluZyB0aGUgZmlyc3Qgb2JqZWN0CiAgLy8gY29udGFpbmluZyBzcGVjaWZpYyBga2V5OnZhbHVlYCBwYWlycy4KICBfLmZpbmRXaGVyZSA9IGZ1bmN0aW9uKG9iaiwgYXR0cnMpIHsKICAgIHJldHVybiBfLmZpbmQob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1heGltdW0gZWxlbWVudCBvciAoZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgLy8gQ2FuJ3Qgb3B0aW1pemUgYXJyYXlzIG9mIGludGVnZXJzIGxvbmdlciB0aGFuIDY1LDUzNSBlbGVtZW50cy4KICAvLyBTZWUgW1dlYktpdCBCdWcgODA3OTddKGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD04MDc5NykKICBfLm1heCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0FycmF5KG9iaikgJiYgb2JqWzBdID09PSArb2JqWzBdICYmIG9iai5sZW5ndGggPCA2NTUzNSkgewogICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkoTWF0aCwgb2JqKTsKICAgIH0KICAgIHZhciByZXN1bHQgPSAtSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IC1JbmZpbml0eTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0b3IgPyBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkgOiB2YWx1ZTsKICAgICAgaWYgKGNvbXB1dGVkID4gbGFzdENvbXB1dGVkKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gZWxlbWVudCAob3IgZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgXy5taW4gPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoIWl0ZXJhdG9yICYmIF8uaXNBcnJheShvYmopICYmIG9ialswXSA9PT0gK29ialswXSAmJiBvYmoubGVuZ3RoIDwgNjU1MzUpIHsKICAgICAgcmV0dXJuIE1hdGgubWluLmFwcGx5KE1hdGgsIG9iaik7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IEluZmluaXR5OwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICB2YXIgY29tcHV0ZWQgPSBpdGVyYXRvciA/IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSA6IHZhbHVlOwogICAgICBpZiAoY29tcHV0ZWQgPCBsYXN0Q29tcHV0ZWQpIHsKICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICBsYXN0Q29tcHV0ZWQgPSBjb21wdXRlZDsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFNodWZmbGUgYW4gYXJyYXksIHVzaW5nIHRoZSBtb2Rlcm4gdmVyc2lvbiBvZiB0aGUKICAvLyBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVy4oCTWWF0ZXNfc2h1ZmZsZSkuCiAgXy5zaHVmZmxlID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgcmFuZDsKICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc2h1ZmZsZWQgPSBbXTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByYW5kID0gXy5yYW5kb20oaW5kZXgrKyk7CiAgICAgIHNodWZmbGVkW2luZGV4IC0gMV0gPSBzaHVmZmxlZFtyYW5kXTsKICAgICAgc2h1ZmZsZWRbcmFuZF0gPSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIHNodWZmbGVkOwogIH07CgogIC8vIFNhbXBsZSAqKm4qKiByYW5kb20gdmFsdWVzIGZyb20gYSBjb2xsZWN0aW9uLgogIC8vIElmICoqbioqIGlzIG5vdCBzcGVjaWZpZWQsIHJldHVybnMgYSBzaW5nbGUgcmFuZG9tIGVsZW1lbnQuCiAgLy8gVGhlIGludGVybmFsIGBndWFyZGAgYXJndW1lbnQgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgbWFwYC4KICBfLnNhbXBsZSA9IGZ1bmN0aW9uKG9iaiwgbiwgZ3VhcmQpIHsKICAgIGlmIChuID09IG51bGwgfHwgZ3VhcmQpIHsKICAgICAgaWYgKG9iai5sZW5ndGggIT09ICtvYmoubGVuZ3RoKSBvYmogPSBfLnZhbHVlcyhvYmopOwogICAgICByZXR1cm4gb2JqW18ucmFuZG9tKG9iai5sZW5ndGggLSAxKV07CiAgICB9CiAgICByZXR1cm4gXy5zaHVmZmxlKG9iaikuc2xpY2UoMCwgTWF0aC5tYXgoMCwgbikpOwogIH07CgogIC8vIEFuIGludGVybmFsIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIGxvb2t1cCBpdGVyYXRvcnMuCiAgdmFyIGxvb2t1cEl0ZXJhdG9yID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PSBudWxsKSByZXR1cm4gXy5pZGVudGl0eTsKICAgIGlmIChfLmlzRnVuY3Rpb24odmFsdWUpKSByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gXy5wcm9wZXJ0eSh2YWx1ZSk7CiAgfTsKCiAgLy8gU29ydCB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uIHByb2R1Y2VkIGJ5IGFuIGl0ZXJhdG9yLgogIF8uc29ydEJ5ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaXRlcmF0b3IgPSBsb29rdXBJdGVyYXRvcihpdGVyYXRvcik7CiAgICByZXR1cm4gXy5wbHVjayhfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBpbmRleDogaW5kZXgsCiAgICAgICAgY3JpdGVyaWE6IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KQogICAgICB9OwogICAgfSkuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWE7CiAgICAgIHZhciBiID0gcmlnaHQuY3JpdGVyaWE7CiAgICAgIGlmIChhICE9PSBiKSB7CiAgICAgICAgaWYgKGEgPiBiIHx8IGEgPT09IHZvaWQgMCkgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEgPCBiIHx8IGIgPT09IHZvaWQgMCkgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHJldHVybiBsZWZ0LmluZGV4IC0gcmlnaHQuaW5kZXg7CiAgICB9KSwgJ3ZhbHVlJyk7CiAgfTsKCiAgLy8gQW4gaW50ZXJuYWwgZnVuY3Rpb24gdXNlZCBmb3IgYWdncmVnYXRlICJncm91cCBieSIgb3BlcmF0aW9ucy4KICB2YXIgZ3JvdXAgPSBmdW5jdGlvbihiZWhhdmlvcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICAgIHZhciBrZXkgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgb2JqKTsKICAgICAgICBiZWhhdmlvcihyZXN1bHQsIGtleSwgdmFsdWUpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gR3JvdXBzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24uIFBhc3MgZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZQogIC8vIHRvIGdyb3VwIGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY3JpdGVyaW9uLgogIF8uZ3JvdXBCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwga2V5LCB2YWx1ZSkgewogICAgXy5oYXMocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSkgOiByZXN1bHRba2V5XSA9IFt2YWx1ZV07CiAgfSk7CgogIC8vIEluZGV4ZXMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbiwgc2ltaWxhciB0byBgZ3JvdXBCeWAsIGJ1dCBmb3IKICAvLyB3aGVuIHlvdSBrbm93IHRoYXQgeW91ciBpbmRleCB2YWx1ZXMgd2lsbCBiZSB1bmlxdWUuCiAgXy5pbmRleEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXksIHZhbHVlKSB7CiAgICByZXN1bHRba2V5XSA9IHZhbHVlOwogIH0pOwoKICAvLyBDb3VudHMgaW5zdGFuY2VzIG9mIGFuIG9iamVjdCB0aGF0IGdyb3VwIGJ5IGEgY2VydGFpbiBjcml0ZXJpb24uIFBhc3MKICAvLyBlaXRoZXIgYSBzdHJpbmcgYXR0cmlidXRlIHRvIGNvdW50IGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUKICAvLyBjcml0ZXJpb24uCiAgXy5jb3VudEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXkpIHsKICAgIF8uaGFzKHJlc3VsdCwga2V5KSA/IHJlc3VsdFtrZXldKysgOiByZXN1bHRba2V5XSA9IDE7CiAgfSk7CgogIC8vIFVzZSBhIGNvbXBhcmF0b3IgZnVuY3Rpb24gdG8gZmlndXJlIG91dCB0aGUgc21hbGxlc3QgaW5kZXggYXQgd2hpY2gKICAvLyBhbiBvYmplY3Qgc2hvdWxkIGJlIGluc2VydGVkIHNvIGFzIHRvIG1haW50YWluIG9yZGVyLiBVc2VzIGJpbmFyeSBzZWFyY2guCiAgXy5zb3J0ZWRJbmRleCA9IGZ1bmN0aW9uKGFycmF5LCBvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgIHZhciB2YWx1ZSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqKTsKICAgIHZhciBsb3cgPSAwLCBoaWdoID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgdmFyIG1pZCA9IChsb3cgKyBoaWdoKSA+Pj4gMTsKICAgICAgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBhcnJheVttaWRdKSA8IHZhbHVlID8gbG93ID0gbWlkICsgMSA6IGhpZ2ggPSBtaWQ7CiAgICB9CiAgICByZXR1cm4gbG93OwogIH07CgogIC8vIFNhZmVseSBjcmVhdGUgYSByZWFsLCBsaXZlIGFycmF5IGZyb20gYW55dGhpbmcgaXRlcmFibGUuCiAgXy50b0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIW9iaikgcmV0dXJuIFtdOwogICAgaWYgKF8uaXNBcnJheShvYmopKSByZXR1cm4gc2xpY2UuY2FsbChvYmopOwogICAgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSByZXR1cm4gXy5tYXAob2JqLCBfLmlkZW50aXR5KTsKICAgIHJldHVybiBfLnZhbHVlcyhvYmopOwogIH07CgogIC8vIFJldHVybiB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGFuIG9iamVjdC4KICBfLnNpemUgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIDA7CiAgICByZXR1cm4gKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSA/IG9iai5sZW5ndGggOiBfLmtleXMob2JqKS5sZW5ndGg7CiAgfTsKCiAgLy8gQXJyYXkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIEdldCB0aGUgZmlyc3QgZWxlbWVudCBvZiBhbiBhcnJheS4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiB0aGUgZmlyc3QgTgogIC8vIHZhbHVlcyBpbiB0aGUgYXJyYXkuIEFsaWFzZWQgYXMgYGhlYWRgIGFuZCBgdGFrZWAuIFRoZSAqKmd1YXJkKiogY2hlY2sKICAvLyBhbGxvd3MgaXQgdG8gd29yayB3aXRoIGBfLm1hcGAuCiAgXy5maXJzdCA9IF8uaGVhZCA9IF8udGFrZSA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICBpZiAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQpIHJldHVybiBhcnJheVswXTsKICAgIGlmIChuIDwgMCkgcmV0dXJuIFtdOwogICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIDAsIG4pOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGxhc3QgZW50cnkgb2YgdGhlIGFycmF5LiBFc3BlY2lhbGx5IHVzZWZ1bCBvbgogIC8vIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIGFsbCB0aGUgdmFsdWVzIGluCiAgLy8gdGhlIGFycmF5LCBleGNsdWRpbmcgdGhlIGxhc3QgTi4gVGhlICoqZ3VhcmQqKiBjaGVjayBhbGxvd3MgaXQgdG8gd29yayB3aXRoCiAgLy8gYF8ubWFwYC4KICBfLmluaXRpYWwgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAwLCBhcnJheS5sZW5ndGggLSAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQgPyAxIDogbikpOwogIH07CgogIC8vIEdldCB0aGUgbGFzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBsYXN0IE4KICAvLyB2YWx1ZXMgaW4gdGhlIGFycmF5LiBUaGUgKipndWFyZCoqIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLmxhc3QgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgaWYgKChuID09IG51bGwpIHx8IGd1YXJkKSByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgTWF0aC5tYXgoYXJyYXkubGVuZ3RoIC0gbiwgMCkpOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgdGFpbGAgYW5kIGBkcm9wYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKm4qKiB3aWxsIHJldHVybgogIC8vIHRoZSByZXN0IE4gdmFsdWVzIGluIHRoZSBhcnJheS4gVGhlICoqZ3VhcmQqKgogIC8vIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLnJlc3QgPSBfLnRhaWwgPSBfLmRyb3AgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAobiA9PSBudWxsKSB8fCBndWFyZCA/IDEgOiBuKTsKICB9OwoKICAvLyBUcmltIG91dCBhbGwgZmFsc3kgdmFsdWVzIGZyb20gYW4gYXJyYXkuCiAgXy5jb21wYWN0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHJldHVybiBfLmZpbHRlcihhcnJheSwgXy5pZGVudGl0eSk7CiAgfTsKCiAgLy8gSW50ZXJuYWwgaW1wbGVtZW50YXRpb24gb2YgYSByZWN1cnNpdmUgYGZsYXR0ZW5gIGZ1bmN0aW9uLgogIHZhciBmbGF0dGVuID0gZnVuY3Rpb24oaW5wdXQsIHNoYWxsb3csIG91dHB1dCkgewogICAgaWYgKHNoYWxsb3cgJiYgXy5ldmVyeShpbnB1dCwgXy5pc0FycmF5KSkgewogICAgICByZXR1cm4gY29uY2F0LmFwcGx5KG91dHB1dCwgaW5wdXQpOwogICAgfQogICAgZWFjaChpbnB1dCwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKF8uaXNBcnJheSh2YWx1ZSkgfHwgXy5pc0FyZ3VtZW50cyh2YWx1ZSkpIHsKICAgICAgICBzaGFsbG93ID8gcHVzaC5hcHBseShvdXRwdXQsIHZhbHVlKSA6IGZsYXR0ZW4odmFsdWUsIHNoYWxsb3csIG91dHB1dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3V0cHV0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvdXRwdXQ7CiAgfTsKCiAgLy8gRmxhdHRlbiBvdXQgYW4gYXJyYXksIGVpdGhlciByZWN1cnNpdmVseSAoYnkgZGVmYXVsdCksIG9yIGp1c3Qgb25lIGxldmVsLgogIF8uZmxhdHRlbiA9IGZ1bmN0aW9uKGFycmF5LCBzaGFsbG93KSB7CiAgICByZXR1cm4gZmxhdHRlbihhcnJheSwgc2hhbGxvdywgW10pOwogIH07CgogIC8vIFJldHVybiBhIHZlcnNpb24gb2YgdGhlIGFycmF5IHRoYXQgZG9lcyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIHZhbHVlKHMpLgogIF8ud2l0aG91dCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5kaWZmZXJlbmNlKGFycmF5LCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogIH07CgogIC8vIFNwbGl0IGFuIGFycmF5IGludG8gdHdvIGFycmF5czogb25lIHdob3NlIGVsZW1lbnRzIGFsbCBzYXRpc2Z5IHRoZSBnaXZlbgogIC8vIHByZWRpY2F0ZSwgYW5kIG9uZSB3aG9zZSBlbGVtZW50cyBhbGwgZG8gbm90IHNhdGlzZnkgdGhlIHByZWRpY2F0ZS4KICBfLnBhcnRpdGlvbiA9IGZ1bmN0aW9uKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHZhciBwYXNzID0gW10sIGZhaWwgPSBbXTsKICAgIGVhY2goYXJyYXksIGZ1bmN0aW9uKGVsZW0pIHsKICAgICAgKHByZWRpY2F0ZShlbGVtKSA/IHBhc3MgOiBmYWlsKS5wdXNoKGVsZW0pOwogICAgfSk7CiAgICByZXR1cm4gW3Bhc3MsIGZhaWxdOwogIH07CgogIC8vIFByb2R1Y2UgYSBkdXBsaWNhdGUtZnJlZSB2ZXJzaW9uIG9mIHRoZSBhcnJheS4gSWYgdGhlIGFycmF5IGhhcyBhbHJlYWR5CiAgLy8gYmVlbiBzb3J0ZWQsIHlvdSBoYXZlIHRoZSBvcHRpb24gb2YgdXNpbmcgYSBmYXN0ZXIgYWxnb3JpdGhtLgogIC8vIEFsaWFzZWQgYXMgYHVuaXF1ZWAuCiAgXy51bmlxID0gXy51bmlxdWUgPSBmdW5jdGlvbihhcnJheSwgaXNTb3J0ZWQsIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoXy5pc0Z1bmN0aW9uKGlzU29ydGVkKSkgewogICAgICBjb250ZXh0ID0gaXRlcmF0b3I7CiAgICAgIGl0ZXJhdG9yID0gaXNTb3J0ZWQ7CiAgICAgIGlzU29ydGVkID0gZmFsc2U7CiAgICB9CiAgICB2YXIgaW5pdGlhbCA9IGl0ZXJhdG9yID8gXy5tYXAoYXJyYXksIGl0ZXJhdG9yLCBjb250ZXh0KSA6IGFycmF5OwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBzZWVuID0gW107CiAgICBlYWNoKGluaXRpYWwsIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICBpZiAoaXNTb3J0ZWQgPyAoIWluZGV4IHx8IHNlZW5bc2Vlbi5sZW5ndGggLSAxXSAhPT0gdmFsdWUpIDogIV8uY29udGFpbnMoc2VlbiwgdmFsdWUpKSB7CiAgICAgICAgc2Vlbi5wdXNoKHZhbHVlKTsKICAgICAgICByZXN1bHRzLnB1c2goYXJyYXlbaW5kZXhdKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2YKICAvLyB0aGUgcGFzc2VkLWluIGFycmF5cy4KICBfLnVuaW9uID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gXy51bmlxKF8uZmxhdHRlbihhcmd1bWVudHMsIHRydWUpKTsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgZXZlcnkgaXRlbSBzaGFyZWQgYmV0d2VlbiBhbGwgdGhlCiAgLy8gcGFzc2VkLWluIGFycmF5cy4KICBfLmludGVyc2VjdGlvbiA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBfLmZpbHRlcihfLnVuaXEoYXJyYXkpLCBmdW5jdGlvbihpdGVtKSB7CiAgICAgIHJldHVybiBfLmV2ZXJ5KHJlc3QsIGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgcmV0dXJuIF8uY29udGFpbnMob3RoZXIsIGl0ZW0pOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIC8vIFRha2UgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBvbmUgYXJyYXkgYW5kIGEgbnVtYmVyIG9mIG90aGVyIGFycmF5cy4KICAvLyBPbmx5IHRoZSBlbGVtZW50cyBwcmVzZW50IGluIGp1c3QgdGhlIGZpcnN0IGFycmF5IHdpbGwgcmVtYWluLgogIF8uZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgcmV0dXJuIF8uZmlsdGVyKGFycmF5LCBmdW5jdGlvbih2YWx1ZSl7IHJldHVybiAhXy5jb250YWlucyhyZXN0LCB2YWx1ZSk7IH0pOwogIH07CgogIC8vIFppcCB0b2dldGhlciBtdWx0aXBsZSBsaXN0cyBpbnRvIGEgc2luZ2xlIGFycmF5IC0tIGVsZW1lbnRzIHRoYXQgc2hhcmUKICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci4KICBfLnppcCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGxlbmd0aCA9IF8ubWF4KF8ucGx1Y2soYXJndW1lbnRzLCAnbGVuZ3RoJykuY29uY2F0KDApKTsKICAgIHZhciByZXN1bHRzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdHNbaV0gPSBfLnBsdWNrKGFyZ3VtZW50cywgJycgKyBpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIENvbnZlcnRzIGxpc3RzIGludG8gb2JqZWN0cy4gUGFzcyBlaXRoZXIgYSBzaW5nbGUgYXJyYXkgb2YgYFtrZXksIHZhbHVlXWAKICAvLyBwYWlycywgb3IgdHdvIHBhcmFsbGVsIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGggLS0gb25lIG9mIGtleXMsIGFuZCBvbmUgb2YKICAvLyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZXMuCiAgXy5vYmplY3QgPSBmdW5jdGlvbihsaXN0LCB2YWx1ZXMpIHsKICAgIGlmIChsaXN0ID09IG51bGwpIHJldHVybiB7fTsKICAgIHZhciByZXN1bHQgPSB7fTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBsaXN0Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh2YWx1ZXMpIHsKICAgICAgICByZXN1bHRbbGlzdFtpXV0gPSB2YWx1ZXNbaV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0W2xpc3RbaV1bMF1dID0gbGlzdFtpXVsxXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBseSB1cyB3aXRoIGluZGV4T2YgKEknbSBsb29raW5nIGF0IHlvdSwgKipNU0lFKiopLAogIC8vIHdlIG5lZWQgdGhpcyBmdW5jdGlvbi4gUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbgogIC8vIGl0ZW0gaW4gYW4gYXJyYXksIG9yIC0xIGlmIHRoZSBpdGVtIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgYXJyYXkuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGluZGV4T2ZgIGlmIGF2YWlsYWJsZS4KICAvLyBJZiB0aGUgYXJyYXkgaXMgbGFyZ2UgYW5kIGFscmVhZHkgaW4gc29ydCBvcmRlciwgcGFzcyBgdHJ1ZWAKICAvLyBmb3IgKippc1NvcnRlZCoqIHRvIHVzZSBiaW5hcnkgc2VhcmNoLgogIF8uaW5kZXhPZiA9IGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBpc1NvcnRlZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgaWYgKGlzU29ydGVkKSB7CiAgICAgIGlmICh0eXBlb2YgaXNTb3J0ZWQgPT0gJ251bWJlcicpIHsKICAgICAgICBpID0gKGlzU29ydGVkIDwgMCA/IE1hdGgubWF4KDAsIGxlbmd0aCArIGlzU29ydGVkKSA6IGlzU29ydGVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpID0gXy5zb3J0ZWRJbmRleChhcnJheSwgaXRlbSk7CiAgICAgICAgcmV0dXJuIGFycmF5W2ldID09PSBpdGVtID8gaSA6IC0xOwogICAgICB9CiAgICB9CiAgICBpZiAobmF0aXZlSW5kZXhPZiAmJiBhcnJheS5pbmRleE9mID09PSBuYXRpdmVJbmRleE9mKSByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtLCBpc1NvcnRlZCk7CiAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBsYXN0SW5kZXhPZmAgaWYgYXZhaWxhYmxlLgogIF8ubGFzdEluZGV4T2YgPSBmdW5jdGlvbihhcnJheSwgaXRlbSwgZnJvbSkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBoYXNJbmRleCA9IGZyb20gIT0gbnVsbDsKICAgIGlmIChuYXRpdmVMYXN0SW5kZXhPZiAmJiBhcnJheS5sYXN0SW5kZXhPZiA9PT0gbmF0aXZlTGFzdEluZGV4T2YpIHsKICAgICAgcmV0dXJuIGhhc0luZGV4ID8gYXJyYXkubGFzdEluZGV4T2YoaXRlbSwgZnJvbSkgOiBhcnJheS5sYXN0SW5kZXhPZihpdGVtKTsKICAgIH0KICAgIHZhciBpID0gKGhhc0luZGV4ID8gZnJvbSA6IGFycmF5Lmxlbmd0aCk7CiAgICB3aGlsZSAoaS0tKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIEdlbmVyYXRlIGFuIGludGVnZXIgQXJyYXkgY29udGFpbmluZyBhbiBhcml0aG1ldGljIHByb2dyZXNzaW9uLiBBIHBvcnQgb2YKICAvLyB0aGUgbmF0aXZlIFB5dGhvbiBgcmFuZ2UoKWAgZnVuY3Rpb24uIFNlZQogIC8vIFt0aGUgUHl0aG9uIGRvY3VtZW50YXRpb25dKGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvbGlicmFyeS9mdW5jdGlvbnMuaHRtbCNyYW5nZSkuCiAgXy5yYW5nZSA9IGZ1bmN0aW9uKHN0YXJ0LCBzdG9wLCBzdGVwKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8PSAxKSB7CiAgICAgIHN0b3AgPSBzdGFydCB8fCAwOwogICAgICBzdGFydCA9IDA7CiAgICB9CiAgICBzdGVwID0gYXJndW1lbnRzWzJdIHx8IDE7CgogICAgdmFyIGxlbmd0aCA9IE1hdGgubWF4KE1hdGguY2VpbCgoc3RvcCAtIHN0YXJ0KSAvIHN0ZXApLCAwKTsKICAgIHZhciBpZHggPSAwOwogICAgdmFyIHJhbmdlID0gbmV3IEFycmF5KGxlbmd0aCk7CgogICAgd2hpbGUoaWR4IDwgbGVuZ3RoKSB7CiAgICAgIHJhbmdlW2lkeCsrXSA9IHN0YXJ0OwogICAgICBzdGFydCArPSBzdGVwOwogICAgfQoKICAgIHJldHVybiByYW5nZTsKICB9OwoKICAvLyBGdW5jdGlvbiAoYWhlbSkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJldXNhYmxlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciBwcm90b3R5cGUgc2V0dGluZy4KICB2YXIgY3RvciA9IGZ1bmN0aW9uKCl7fTsKCiAgLy8gQ3JlYXRlIGEgZnVuY3Rpb24gYm91bmQgdG8gYSBnaXZlbiBvYmplY3QgKGFzc2lnbmluZyBgdGhpc2AsIGFuZCBhcmd1bWVudHMsCiAgLy8gb3B0aW9uYWxseSkuIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBGdW5jdGlvbi5iaW5kYCBpZgogIC8vIGF2YWlsYWJsZS4KICBfLmJpbmQgPSBmdW5jdGlvbihmdW5jLCBjb250ZXh0KSB7CiAgICB2YXIgYXJncywgYm91bmQ7CiAgICBpZiAobmF0aXZlQmluZCAmJiBmdW5jLmJpbmQgPT09IG5hdGl2ZUJpbmQpIHJldHVybiBuYXRpdmVCaW5kLmFwcGx5KGZ1bmMsIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBpZiAoIV8uaXNGdW5jdGlvbihmdW5jKSkgdGhyb3cgbmV3IFR5cGVFcnJvcjsKICAgIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICByZXR1cm4gYm91bmQgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIGJvdW5kKSkgcmV0dXJuIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGN0b3IucHJvdG90eXBlID0gZnVuYy5wcm90b3R5cGU7CiAgICAgIHZhciBzZWxmID0gbmV3IGN0b3I7CiAgICAgIGN0b3IucHJvdG90eXBlID0gbnVsbDsKICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkoc2VsZiwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGlmIChPYmplY3QocmVzdWx0KSA9PT0gcmVzdWx0KSByZXR1cm4gcmVzdWx0OwogICAgICByZXR1cm4gc2VsZjsKICAgIH07CiAgfTsKCiAgLy8gUGFydGlhbGx5IGFwcGx5IGEgZnVuY3Rpb24gYnkgY3JlYXRpbmcgYSB2ZXJzaW9uIHRoYXQgaGFzIGhhZCBzb21lIG9mIGl0cwogIC8vIGFyZ3VtZW50cyBwcmUtZmlsbGVkLCB3aXRob3V0IGNoYW5naW5nIGl0cyBkeW5hbWljIGB0aGlzYCBjb250ZXh0LiBfIGFjdHMKICAvLyBhcyBhIHBsYWNlaG9sZGVyLCBhbGxvd2luZyBhbnkgY29tYmluYXRpb24gb2YgYXJndW1lbnRzIHRvIGJlIHByZS1maWxsZWQuCiAgXy5wYXJ0aWFsID0gZnVuY3Rpb24oZnVuYykgewogICAgdmFyIGJvdW5kQXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHBvc2l0aW9uID0gMDsKICAgICAgdmFyIGFyZ3MgPSBib3VuZEFyZ3Muc2xpY2UoKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJnc1tpXSA9PT0gXykgYXJnc1tpXSA9IGFyZ3VtZW50c1twb3NpdGlvbisrXTsKICAgICAgfQogICAgICB3aGlsZSAocG9zaXRpb24gPCBhcmd1bWVudHMubGVuZ3RoKSBhcmdzLnB1c2goYXJndW1lbnRzW3Bvc2l0aW9uKytdKTsKICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH07CgogIC8vIEJpbmQgYSBudW1iZXIgb2YgYW4gb2JqZWN0J3MgbWV0aG9kcyB0byB0aGF0IG9iamVjdC4gUmVtYWluaW5nIGFyZ3VtZW50cwogIC8vIGFyZSB0aGUgbWV0aG9kIG5hbWVzIHRvIGJlIGJvdW5kLiBVc2VmdWwgZm9yIGVuc3VyaW5nIHRoYXQgYWxsIGNhbGxiYWNrcwogIC8vIGRlZmluZWQgb24gYW4gb2JqZWN0IGJlbG9uZyB0byBpdC4KICBfLmJpbmRBbGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBmdW5jcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIGlmIChmdW5jcy5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcignYmluZEFsbCBtdXN0IGJlIHBhc3NlZCBmdW5jdGlvbiBuYW1lcycpOwogICAgZWFjaChmdW5jcywgZnVuY3Rpb24oZikgeyBvYmpbZl0gPSBfLmJpbmQob2JqW2ZdLCBvYmopOyB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gTWVtb2l6ZSBhbiBleHBlbnNpdmUgZnVuY3Rpb24gYnkgc3RvcmluZyBpdHMgcmVzdWx0cy4KICBfLm1lbW9pemUgPSBmdW5jdGlvbihmdW5jLCBoYXNoZXIpIHsKICAgIHZhciBtZW1vID0ge307CiAgICBoYXNoZXIgfHwgKGhhc2hlciA9IF8uaWRlbnRpdHkpOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIga2V5ID0gaGFzaGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfLmhhcyhtZW1vLCBrZXkpID8gbWVtb1trZXldIDogKG1lbW9ba2V5XSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9OwogIH07CgogIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHMKICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuCiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7IH0sIHdhaXQpOwogIH07CgogIC8vIERlZmVycyBhIGZ1bmN0aW9uLCBzY2hlZHVsaW5nIGl0IHRvIHJ1biBhZnRlciB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhcwogIC8vIGNsZWFyZWQuCiAgXy5kZWZlciA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHJldHVybiBfLmRlbGF5LmFwcGx5KF8sIFtmdW5jLCAxXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCB3aGVuIGludm9rZWQsIHdpbGwgb25seSBiZSB0cmlnZ2VyZWQgYXQgbW9zdCBvbmNlCiAgLy8gZHVyaW5nIGEgZ2l2ZW4gd2luZG93IG9mIHRpbWUuIE5vcm1hbGx5LCB0aGUgdGhyb3R0bGVkIGZ1bmN0aW9uIHdpbGwgcnVuCiAgLy8gYXMgbXVjaCBhcyBpdCBjYW4sIHdpdGhvdXQgZXZlciBnb2luZyBtb3JlIHRoYW4gb25jZSBwZXIgYHdhaXRgIGR1cmF0aW9uOwogIC8vIGJ1dCBpZiB5b3UnZCBsaWtlIHRvIGRpc2FibGUgdGhlIGV4ZWN1dGlvbiBvbiB0aGUgbGVhZGluZyBlZGdlLCBwYXNzCiAgLy8gYHtsZWFkaW5nOiBmYWxzZX1gLiBUbyBkaXNhYmxlIGV4ZWN1dGlvbiBvbiB0aGUgdHJhaWxpbmcgZWRnZSwgZGl0dG8uCiAgXy50aHJvdHRsZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHsKICAgIHZhciBjb250ZXh0LCBhcmdzLCByZXN1bHQ7CiAgICB2YXIgdGltZW91dCA9IG51bGw7CiAgICB2YXIgcHJldmlvdXMgPSAwOwogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICBwcmV2aW91cyA9IG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UgPyAwIDogXy5ub3coKTsKICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBub3cgPSBfLm5vdygpOwogICAgICBpZiAoIXByZXZpb3VzICYmIG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UpIHByZXZpb3VzID0gbm93OwogICAgICB2YXIgcmVtYWluaW5nID0gd2FpdCAtIChub3cgLSBwcmV2aW91cyk7CiAgICAgIGNvbnRleHQgPSB0aGlzOwogICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICBpZiAocmVtYWluaW5nIDw9IDApIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgcHJldmlvdXMgPSBub3c7CiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQgJiYgb3B0aW9ucy50cmFpbGluZyAhPT0gZmFsc2UpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLiBJZiBgaW1tZWRpYXRlYCBpcyBwYXNzZWQsIHRyaWdnZXIgdGhlIGZ1bmN0aW9uIG9uIHRoZQogIC8vIGxlYWRpbmcgZWRnZSwgaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcuCiAgXy5kZWJvdW5jZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgdmFyIHRpbWVvdXQsIGFyZ3MsIGNvbnRleHQsIHRpbWVzdGFtcCwgcmVzdWx0OwoKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbGFzdCA9IF8ubm93KCkgLSB0aW1lc3RhbXA7CiAgICAgIGlmIChsYXN0IDwgd2FpdCkgewogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0IC0gbGFzdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHsKICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgY29udGV4dCA9IHRoaXM7CiAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIHRpbWVzdGFtcCA9IF8ubm93KCk7CiAgICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0OwogICAgICBpZiAoIXRpbWVvdXQpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICAgIH0KICAgICAgaWYgKGNhbGxOb3cpIHsKICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgcmFuID0gZmFsc2UsIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChyYW4pIHJldHVybiBtZW1vOwogICAgICByYW4gPSB0cnVlOwogICAgICBtZW1vID0gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBmdW5jID0gbnVsbDsKICAgICAgcmV0dXJuIG1lbW87CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGZ1bmN0aW9uIHBhc3NlZCBhcyBhbiBhcmd1bWVudCB0byB0aGUgc2Vjb25kLAogIC8vIGFsbG93aW5nIHlvdSB0byBhZGp1c3QgYXJndW1lbnRzLCBydW4gY29kZSBiZWZvcmUgYW5kIGFmdGVyLCBhbmQKICAvLyBjb25kaXRpb25hbGx5IGV4ZWN1dGUgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uLgogIF8ud3JhcCA9IGZ1bmN0aW9uKGZ1bmMsIHdyYXBwZXIpIHsKICAgIHJldHVybiBfLnBhcnRpYWwod3JhcHBlciwgZnVuYyk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgaXMgdGhlIGNvbXBvc2l0aW9uIG9mIGEgbGlzdCBvZiBmdW5jdGlvbnMsIGVhY2gKICAvLyBjb25zdW1pbmcgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZnVuY3Rpb24gdGhhdCBmb2xsb3dzLgogIF8uY29tcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGZ1bmNzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgICAgZm9yICh2YXIgaSA9IGZ1bmNzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgYXJncyA9IFtmdW5jc1tpXS5hcHBseSh0aGlzLCBhcmdzKV07CiAgICAgIH0KICAgICAgcmV0dXJuIGFyZ3NbMF07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgb25seSBiZSBleGVjdXRlZCBhZnRlciBiZWluZyBjYWxsZWQgTiB0aW1lcy4KICBfLmFmdGVyID0gZnVuY3Rpb24odGltZXMsIGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgaWYgKC0tdGltZXMgPCAxKSB7CiAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9OwoKICAvLyBPYmplY3QgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSZXRyaWV2ZSB0aGUgbmFtZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgT2JqZWN0LmtleXNgCiAgXy5rZXlzID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIV8uaXNPYmplY3Qob2JqKSkgcmV0dXJuIFtdOwogICAgaWYgKG5hdGl2ZUtleXMpIHJldHVybiBuYXRpdmVLZXlzKG9iaik7CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkga2V5cy5wdXNoKGtleSk7CiAgICByZXR1cm4ga2V5czsKICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgdmFsdWVzIG9mIGFuIG9iamVjdCdzIHByb3BlcnRpZXMuCiAgXy52YWx1ZXMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICB2YXIgdmFsdWVzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhbHVlc1tpXSA9IG9ialtrZXlzW2ldXTsKICAgIH0KICAgIHJldHVybiB2YWx1ZXM7CiAgfTsKCiAgLy8gQ29udmVydCBhbiBvYmplY3QgaW50byBhIGxpc3Qgb2YgYFtrZXksIHZhbHVlXWAgcGFpcnMuCiAgXy5wYWlycyA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgIHZhciBwYWlycyA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBwYWlyc1tpXSA9IFtrZXlzW2ldLCBvYmpba2V5c1tpXV1dOwogICAgfQogICAgcmV0dXJuIHBhaXJzOwogIH07CgogIC8vIEludmVydCB0aGUga2V5cyBhbmQgdmFsdWVzIG9mIGFuIG9iamVjdC4gVGhlIHZhbHVlcyBtdXN0IGJlIHNlcmlhbGl6YWJsZS4KICBfLmludmVydCA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIHJlc3VsdCA9IHt9OwogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdFtvYmpba2V5c1tpXV1dID0ga2V5c1tpXTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LgogIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgCiAgXy5mdW5jdGlvbnMgPSBfLm1ldGhvZHMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9ialtrZXldKSkgbmFtZXMucHVzaChrZXkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzLnNvcnQoKTsKICB9OwoKICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS4KICBfLmV4dGVuZCA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHsKICAgICAgICAgIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgb25seSBjb250YWluaW5nIHRoZSB3aGl0ZWxpc3RlZCBwcm9wZXJ0aWVzLgogIF8ucGljayA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGNvcHkgPSB7fTsKICAgIHZhciBrZXlzID0gY29uY2F0LmFwcGx5KEFycmF5UHJvdG8sIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBlYWNoKGtleXMsIGZ1bmN0aW9uKGtleSkgewogICAgICBpZiAoa2V5IGluIG9iaikgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9KTsKICAgIHJldHVybiBjb3B5OwogIH07CgogICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgd2l0aG91dCB0aGUgYmxhY2tsaXN0ZWQgcHJvcGVydGllcy4KICBfLm9taXQgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBjb3B5ID0ge307CiAgICB2YXIga2V5cyA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoIV8uY29udGFpbnMoa2V5cywga2V5KSkgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9CiAgICByZXR1cm4gY29weTsKICB9OwoKICAvLyBGaWxsIGluIGEgZ2l2ZW4gb2JqZWN0IHdpdGggZGVmYXVsdCBwcm9wZXJ0aWVzLgogIF8uZGVmYXVsdHMgPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBmdW5jdGlvbihzb3VyY2UpIHsKICAgICAgaWYgKHNvdXJjZSkgewogICAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgICBpZiAob2JqW3Byb3BdID09PSB2b2lkIDApIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBDcmVhdGUgYSAoc2hhbGxvdy1jbG9uZWQpIGR1cGxpY2F0ZSBvZiBhbiBvYmplY3QuCiAgXy5jbG9uZSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHJldHVybiBvYmo7CiAgICByZXR1cm4gXy5pc0FycmF5KG9iaikgPyBvYmouc2xpY2UoKSA6IF8uZXh0ZW5kKHt9LCBvYmopOwogIH07CgogIC8vIEludm9rZXMgaW50ZXJjZXB0b3Igd2l0aCB0aGUgb2JqLCBhbmQgdGhlbiByZXR1cm5zIG9iai4KICAvLyBUaGUgcHJpbWFyeSBwdXJwb3NlIG9mIHRoaXMgbWV0aG9kIGlzIHRvICJ0YXAgaW50byIgYSBtZXRob2QgY2hhaW4sIGluCiAgLy8gb3JkZXIgdG8gcGVyZm9ybSBvcGVyYXRpb25zIG9uIGludGVybWVkaWF0ZSByZXN1bHRzIHdpdGhpbiB0aGUgY2hhaW4uCiAgXy50YXAgPSBmdW5jdGlvbihvYmosIGludGVyY2VwdG9yKSB7CiAgICBpbnRlcmNlcHRvcihvYmopOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBJbnRlcm5hbCByZWN1cnNpdmUgY29tcGFyaXNvbiBmdW5jdGlvbiBmb3IgYGlzRXF1YWxgLgogIHZhciBlcSA9IGZ1bmN0aW9uKGEsIGIsIGFTdGFjaywgYlN0YWNrKSB7CiAgICAvLyBJZGVudGljYWwgb2JqZWN0cyBhcmUgZXF1YWwuIGAwID09PSAtMGAsIGJ1dCB0aGV5IGFyZW4ndCBpZGVudGljYWwuCiAgICAvLyBTZWUgdGhlIFtIYXJtb255IGBlZ2FsYCBwcm9wb3NhbF0oaHR0cDovL3dpa2kuZWNtYXNjcmlwdC5vcmcvZG9rdS5waHA/aWQ9aGFybW9ueTplZ2FsKS4KICAgIGlmIChhID09PSBiKSByZXR1cm4gYSAhPT0gMCB8fCAxIC8gYSA9PSAxIC8gYjsKICAgIC8vIEEgc3RyaWN0IGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5IGJlY2F1c2UgYG51bGwgPT0gdW5kZWZpbmVkYC4KICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gYSA9PT0gYjsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEgaW5zdGFuY2VvZiBfKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiIGluc3RhbmNlb2YgXykgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBDb21wYXJlIGBbW0NsYXNzXV1gIG5hbWVzLgogICAgdmFyIGNsYXNzTmFtZSA9IHRvU3RyaW5nLmNhbGwoYSk7CiAgICBpZiAoY2xhc3NOYW1lICE9IHRvU3RyaW5nLmNhbGwoYikpIHJldHVybiBmYWxzZTsKICAgIHN3aXRjaCAoY2xhc3NOYW1lKSB7CiAgICAgIC8vIFN0cmluZ3MsIG51bWJlcnMsIGRhdGVzLCBhbmQgYm9vbGVhbnMgYXJlIGNvbXBhcmVkIGJ5IHZhbHVlLgogICAgICBjYXNlICdbb2JqZWN0IFN0cmluZ10nOgogICAgICAgIC8vIFByaW1pdGl2ZXMgYW5kIHRoZWlyIGNvcnJlc3BvbmRpbmcgb2JqZWN0IHdyYXBwZXJzIGFyZSBlcXVpdmFsZW50OyB0aHVzLCBgIjUiYCBpcwogICAgICAgIC8vIGVxdWl2YWxlbnQgdG8gYG5ldyBTdHJpbmcoIjUiKWAuCiAgICAgICAgcmV0dXJuIGEgPT0gU3RyaW5nKGIpOwogICAgICBjYXNlICdbb2JqZWN0IE51bWJlcl0nOgogICAgICAgIC8vIGBOYU5gcyBhcmUgZXF1aXZhbGVudCwgYnV0IG5vbi1yZWZsZXhpdmUuIEFuIGBlZ2FsYCBjb21wYXJpc29uIGlzIHBlcmZvcm1lZCBmb3IKICAgICAgICAvLyBvdGhlciBudW1lcmljIHZhbHVlcy4KICAgICAgICByZXR1cm4gYSAhPSArYSA/IGIgIT0gK2IgOiAoYSA9PSAwID8gMSAvIGEgPT0gMSAvIGIgOiBhID09ICtiKTsKICAgICAgY2FzZSAnW29iamVjdCBEYXRlXSc6CiAgICAgIGNhc2UgJ1tvYmplY3QgQm9vbGVhbl0nOgogICAgICAgIC8vIENvZXJjZSBkYXRlcyBhbmQgYm9vbGVhbnMgdG8gbnVtZXJpYyBwcmltaXRpdmUgdmFsdWVzLiBEYXRlcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIKICAgICAgICAvLyBtaWxsaXNlY29uZCByZXByZXNlbnRhdGlvbnMuIE5vdGUgdGhhdCBpbnZhbGlkIGRhdGVzIHdpdGggbWlsbGlzZWNvbmQgcmVwcmVzZW50YXRpb25zCiAgICAgICAgLy8gb2YgYE5hTmAgYXJlIG5vdCBlcXVpdmFsZW50LgogICAgICAgIHJldHVybiArYSA9PSArYjsKICAgICAgLy8gUmVnRXhwcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIgc291cmNlIHBhdHRlcm5zIGFuZCBmbGFncy4KICAgICAgY2FzZSAnW29iamVjdCBSZWdFeHBdJzoKICAgICAgICByZXR1cm4gYS5zb3VyY2UgPT0gYi5zb3VyY2UgJiYKICAgICAgICAgICAgICAgYS5nbG9iYWwgPT0gYi5nbG9iYWwgJiYKICAgICAgICAgICAgICAgYS5tdWx0aWxpbmUgPT0gYi5tdWx0aWxpbmUgJiYKICAgICAgICAgICAgICAgYS5pZ25vcmVDYXNlID09IGIuaWdub3JlQ2FzZTsKICAgIH0KICAgIGlmICh0eXBlb2YgYSAhPSAnb2JqZWN0JyB8fCB0eXBlb2YgYiAhPSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlOwogICAgLy8gQXNzdW1lIGVxdWFsaXR5IGZvciBjeWNsaWMgc3RydWN0dXJlcy4gVGhlIGFsZ29yaXRobSBmb3IgZGV0ZWN0aW5nIGN5Y2xpYwogICAgLy8gc3RydWN0dXJlcyBpcyBhZGFwdGVkIGZyb20gRVMgNS4xIHNlY3Rpb24gMTUuMTIuMywgYWJzdHJhY3Qgb3BlcmF0aW9uIGBKT2AuCiAgICB2YXIgbGVuZ3RoID0gYVN0YWNrLmxlbmd0aDsKICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAvLyBMaW5lYXIgc2VhcmNoLiBQZXJmb3JtYW5jZSBpcyBpbnZlcnNlbHkgcHJvcG9ydGlvbmFsIHRvIHRoZSBudW1iZXIgb2YKICAgICAgLy8gdW5pcXVlIG5lc3RlZCBzdHJ1Y3R1cmVzLgogICAgICBpZiAoYVN0YWNrW2xlbmd0aF0gPT0gYSkgcmV0dXJuIGJTdGFja1tsZW5ndGhdID09IGI7CiAgICB9CiAgICAvLyBPYmplY3RzIHdpdGggZGlmZmVyZW50IGNvbnN0cnVjdG9ycyBhcmUgbm90IGVxdWl2YWxlbnQsIGJ1dCBgT2JqZWN0YHMKICAgIC8vIGZyb20gZGlmZmVyZW50IGZyYW1lcyBhcmUuCiAgICB2YXIgYUN0b3IgPSBhLmNvbnN0cnVjdG9yLCBiQ3RvciA9IGIuY29uc3RydWN0b3I7CiAgICBpZiAoYUN0b3IgIT09IGJDdG9yICYmICEoXy5pc0Z1bmN0aW9uKGFDdG9yKSAmJiAoYUN0b3IgaW5zdGFuY2VvZiBhQ3RvcikgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmlzRnVuY3Rpb24oYkN0b3IpICYmIChiQ3RvciBpbnN0YW5jZW9mIGJDdG9yKSkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKCdjb25zdHJ1Y3RvcicgaW4gYSAmJiAnY29uc3RydWN0b3InIGluIGIpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vIEFkZCB0aGUgZmlyc3Qgb2JqZWN0IHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIGFTdGFjay5wdXNoKGEpOwogICAgYlN0YWNrLnB1c2goYik7CiAgICB2YXIgc2l6ZSA9IDAsIHJlc3VsdCA9IHRydWU7CiAgICAvLyBSZWN1cnNpdmVseSBjb21wYXJlIG9iamVjdHMgYW5kIGFycmF5cy4KICAgIGlmIChjbGFzc05hbWUgPT0gJ1tvYmplY3QgQXJyYXldJykgewogICAgICAvLyBDb21wYXJlIGFycmF5IGxlbmd0aHMgdG8gZGV0ZXJtaW5lIGlmIGEgZGVlcCBjb21wYXJpc29uIGlzIG5lY2Vzc2FyeS4KICAgICAgc2l6ZSA9IGEubGVuZ3RoOwogICAgICByZXN1bHQgPSBzaXplID09IGIubGVuZ3RoOwogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgLy8gRGVlcCBjb21wYXJlIHRoZSBjb250ZW50cywgaWdub3Jpbmcgbm9uLW51bWVyaWMgcHJvcGVydGllcy4KICAgICAgICB3aGlsZSAoc2l6ZS0tKSB7CiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBlcShhW3NpemVdLCBiW3NpemVdLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIERlZXAgY29tcGFyZSBvYmplY3RzLgogICAgICBmb3IgKHZhciBrZXkgaW4gYSkgewogICAgICAgIGlmIChfLmhhcyhhLCBrZXkpKSB7CiAgICAgICAgICAvLyBDb3VudCB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgICAgICBzaXplKys7CiAgICAgICAgICAvLyBEZWVwIGNvbXBhcmUgZWFjaCBtZW1iZXIuCiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBfLmhhcyhiLCBrZXkpICYmIGVxKGFba2V5XSwgYltrZXldLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gRW5zdXJlIHRoYXQgYm90aCBvYmplY3RzIGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBmb3IgKGtleSBpbiBiKSB7CiAgICAgICAgICBpZiAoXy5oYXMoYiwga2V5KSAmJiAhKHNpemUtLSkpIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSAhc2l6ZTsKICAgICAgfQogICAgfQogICAgLy8gUmVtb3ZlIHRoZSBmaXJzdCBvYmplY3QgZnJvbSB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHMuCiAgICBhU3RhY2sucG9wKCk7CiAgICBiU3RhY2sucG9wKCk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFBlcmZvcm0gYSBkZWVwIGNvbXBhcmlzb24gdG8gY2hlY2sgaWYgdHdvIG9iamVjdHMgYXJlIGVxdWFsLgogIF8uaXNFcXVhbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBlcShhLCBiLCBbXSwgW10pOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5PwogIC8vIEFuICJlbXB0eSIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLgogIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikpIHJldHVybiBvYmoubGVuZ3RoID09PSAwOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIERPTSBlbGVtZW50PwogIF8uaXNFbGVtZW50ID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqICYmIG9iai5ub2RlVHlwZSA9PT0gMSk7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhbiBhcnJheT8KICAvLyBEZWxlZ2F0ZXMgdG8gRUNNQTUncyBuYXRpdmUgQXJyYXkuaXNBcnJheQogIF8uaXNBcnJheSA9IG5hdGl2ZUlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09ICdbb2JqZWN0IEFycmF5XSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YXJpYWJsZSBhbiBvYmplY3Q/CiAgXy5pc09iamVjdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gT2JqZWN0KG9iaik7CiAgfTsKCiAgLy8gQWRkIHNvbWUgaXNUeXBlIG1ldGhvZHM6IGlzQXJndW1lbnRzLCBpc0Z1bmN0aW9uLCBpc1N0cmluZywgaXNOdW1iZXIsIGlzRGF0ZSwgaXNSZWdFeHAuCiAgZWFjaChbJ0FyZ3VtZW50cycsICdGdW5jdGlvbicsICdTdHJpbmcnLCAnTnVtYmVyJywgJ0RhdGUnLCAnUmVnRXhwJ10sIGZ1bmN0aW9uKG5hbWUpIHsKICAgIF9bJ2lzJyArIG5hbWVdID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT0gJ1tvYmplY3QgJyArIG5hbWUgKyAnXSc7CiAgICB9OwogIH0pOwoKICAvLyBEZWZpbmUgYSBmYWxsYmFjayB2ZXJzaW9uIG9mIHRoZSBtZXRob2QgaW4gYnJvd3NlcnMgKGFoZW0sIElFKSwgd2hlcmUKICAvLyB0aGVyZSBpc24ndCBhbnkgaW5zcGVjdGFibGUgIkFyZ3VtZW50cyIgdHlwZS4KICBpZiAoIV8uaXNBcmd1bWVudHMoYXJndW1lbnRzKSkgewogICAgXy5pc0FyZ3VtZW50cyA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gISEob2JqICYmIF8uaGFzKG9iaiwgJ2NhbGxlZScpKTsKICAgIH07CiAgfQoKICAvLyBPcHRpbWl6ZSBgaXNGdW5jdGlvbmAgaWYgYXBwcm9wcmlhdGUuCiAgaWYgKHR5cGVvZiAoLy4vKSAhPT0gJ2Z1bmN0aW9uJykgewogICAgXy5pc0Z1bmN0aW9uID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnZnVuY3Rpb24nOwogICAgfTsKICB9CgogIC8vIElzIGEgZ2l2ZW4gb2JqZWN0IGEgZmluaXRlIG51bWJlcj8KICBfLmlzRmluaXRlID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gaXNGaW5pdGUob2JqKSAmJiAhaXNOYU4ocGFyc2VGbG9hdChvYmopKTsKICB9OwoKICAvLyBJcyB0aGUgZ2l2ZW4gdmFsdWUgYE5hTmA/IChOYU4gaXMgdGhlIG9ubHkgbnVtYmVyIHdoaWNoIGRvZXMgbm90IGVxdWFsIGl0c2VsZikuCiAgXy5pc05hTiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8uaXNOdW1iZXIob2JqKSAmJiBvYmogIT0gK29iajsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgYm9vbGVhbj8KICBfLmlzQm9vbGVhbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlIHx8IHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBCb29sZWFuXSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBlcXVhbCB0byBudWxsPwogIF8uaXNOdWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSBudWxsOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgdW5kZWZpbmVkPwogIF8uaXNVbmRlZmluZWQgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IHZvaWQgMDsKICB9OwoKICAvLyBTaG9ydGN1dCBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHByb3BlcnR5IGRpcmVjdGx5CiAgLy8gb24gaXRzZWxmIChpbiBvdGhlciB3b3Jkcywgbm90IG9uIGEgcHJvdG90eXBlKS4KICBfLmhhcyA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7CiAgfTsKCiAgLy8gVXRpbGl0eSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSdW4gVW5kZXJzY29yZS5qcyBpbiAqbm9Db25mbGljdCogbW9kZSwgcmV0dXJuaW5nIHRoZSBgX2AgdmFyaWFibGUgdG8gaXRzCiAgLy8gcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgcm9vdC5fID0gcHJldmlvdXNVbmRlcnNjb3JlOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gS2VlcCB0aGUgaWRlbnRpdHkgZnVuY3Rpb24gYXJvdW5kIGZvciBkZWZhdWx0IGl0ZXJhdG9ycy4KICBfLmlkZW50aXR5ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9OwoKICBfLmNvbnN0YW50ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgfTsKCiAgXy5wcm9wZXJ0eSA9IGZ1bmN0aW9uKGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gb2JqW2tleV07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBwcmVkaWNhdGUgZm9yIGNoZWNraW5nIHdoZXRoZXIgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHNldCBvZiBga2V5OnZhbHVlYCBwYWlycy4KICBfLm1hdGNoZXMgPSBmdW5jdGlvbihhdHRycykgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICBpZiAob2JqID09PSBhdHRycykgcmV0dXJuIHRydWU7IC8vYXZvaWQgY29tcGFyaW5nIGFuIG9iamVjdCB0byBpdHNlbGYuCiAgICAgIGZvciAodmFyIGtleSBpbiBhdHRycykgewogICAgICAgIGlmIChhdHRyc1trZXldICE9PSBvYmpba2V5XSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9OwoKICAvLyBSdW4gYSBmdW5jdGlvbiAqKm4qKiB0aW1lcy4KICBfLnRpbWVzID0gZnVuY3Rpb24obiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciBhY2N1bSA9IEFycmF5KE1hdGgubWF4KDAsIG4pKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSBhY2N1bVtpXSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgaSk7CiAgICByZXR1cm4gYWNjdW07CiAgfTsKCiAgLy8gUmV0dXJuIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gYW5kIG1heCAoaW5jbHVzaXZlKS4KICBfLnJhbmRvbSA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7CiAgICBpZiAobWF4ID09IG51bGwpIHsKICAgICAgbWF4ID0gbWluOwogICAgICBtaW4gPSAwOwogICAgfQogICAgcmV0dXJuIG1pbiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSk7CiAgfTsKCiAgLy8gQSAocG9zc2libHkgZmFzdGVyKSB3YXkgdG8gZ2V0IHRoZSBjdXJyZW50IHRpbWVzdGFtcCBhcyBhbiBpbnRlZ2VyLgogIF8ubm93ID0gRGF0ZS5ub3cgfHwgZnVuY3Rpb24oKSB7IHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgfTsKCiAgLy8gTGlzdCBvZiBIVE1MIGVudGl0aWVzIGZvciBlc2NhcGluZy4KICB2YXIgZW50aXR5TWFwID0gewogICAgZXNjYXBlOiB7CiAgICAgICcmJzogJyZhbXA7JywKICAgICAgJzwnOiAnJmx0OycsCiAgICAgICc+JzogJyZndDsnLAogICAgICAnIic6ICcmcXVvdDsnLAogICAgICAiJyI6ICcmI3gyNzsnCiAgICB9CiAgfTsKICBlbnRpdHlNYXAudW5lc2NhcGUgPSBfLmludmVydChlbnRpdHlNYXAuZXNjYXBlKTsKCiAgLy8gUmVnZXhlcyBjb250YWluaW5nIHRoZSBrZXlzIGFuZCB2YWx1ZXMgbGlzdGVkIGltbWVkaWF0ZWx5IGFib3ZlLgogIHZhciBlbnRpdHlSZWdleGVzID0gewogICAgZXNjYXBlOiAgIG5ldyBSZWdFeHAoJ1snICsgXy5rZXlzKGVudGl0eU1hcC5lc2NhcGUpLmpvaW4oJycpICsgJ10nLCAnZycpLAogICAgdW5lc2NhcGU6IG5ldyBSZWdFeHAoJygnICsgXy5rZXlzKGVudGl0eU1hcC51bmVzY2FwZSkuam9pbignfCcpICsgJyknLCAnZycpCiAgfTsKCiAgLy8gRnVuY3Rpb25zIGZvciBlc2NhcGluZyBhbmQgdW5lc2NhcGluZyBzdHJpbmdzIHRvL2Zyb20gSFRNTCBpbnRlcnBvbGF0aW9uLgogIF8uZWFjaChbJ2VzY2FwZScsICd1bmVzY2FwZSddLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIF9bbWV0aG9kXSA9IGZ1bmN0aW9uKHN0cmluZykgewogICAgICBpZiAoc3RyaW5nID09IG51bGwpIHJldHVybiAnJzsKICAgICAgcmV0dXJuICgnJyArIHN0cmluZykucmVwbGFjZShlbnRpdHlSZWdleGVzW21ldGhvZF0sIGZ1bmN0aW9uKG1hdGNoKSB7CiAgICAgICAgcmV0dXJuIGVudGl0eU1hcFttZXRob2RdW21hdGNoXTsKICAgICAgfSk7CiAgICB9OwogIH0pOwoKICAvLyBJZiB0aGUgdmFsdWUgb2YgdGhlIG5hbWVkIGBwcm9wZXJ0eWAgaXMgYSBmdW5jdGlvbiB0aGVuIGludm9rZSBpdCB3aXRoIHRoZQogIC8vIGBvYmplY3RgIGFzIGNvbnRleHQ7IG90aGVyd2lzZSwgcmV0dXJuIGl0LgogIF8ucmVzdWx0ID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgewogICAgaWYgKG9iamVjdCA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgdmFyIHZhbHVlID0gb2JqZWN0W3Byb3BlcnR5XTsKICAgIHJldHVybiBfLmlzRnVuY3Rpb24odmFsdWUpID8gdmFsdWUuY2FsbChvYmplY3QpIDogdmFsdWU7CiAgfTsKCiAgLy8gQWRkIHlvdXIgb3duIGN1c3RvbSBmdW5jdGlvbnMgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubWl4aW4gPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goXy5mdW5jdGlvbnMob2JqKSwgZnVuY3Rpb24obmFtZSkgewogICAgICB2YXIgZnVuYyA9IF9bbmFtZV0gPSBvYmpbbmFtZV07CiAgICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy5fd3JhcHBlZF07CiAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBmdW5jLmFwcGx5KF8sIGFyZ3MpKTsKICAgICAgfTsKICAgIH0pOwogIH07CgogIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuCiAgLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy4KICB2YXIgaWRDb3VudGVyID0gMDsKICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7CiAgICB2YXIgaWQgPSArK2lkQ291bnRlciArICcnOwogICAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7CiAgfTsKCiAgLy8gQnkgZGVmYXVsdCwgVW5kZXJzY29yZSB1c2VzIEVSQi1zdHlsZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLCBjaGFuZ2UgdGhlCiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLgogIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgIGV2YWx1YXRlICAgIDogLzwlKFtcc1xTXSs/KSU+L2csCiAgICBpbnRlcnBvbGF0ZSA6IC88JT0oW1xzXFNdKz8pJT4vZywKICAgIGVzY2FwZSAgICAgIDogLzwlLShbXHNcU10rPyklPi9nCiAgfTsKCiAgLy8gV2hlbiBjdXN0b21pemluZyBgdGVtcGxhdGVTZXR0aW5nc2AsIGlmIHlvdSBkb24ndCB3YW50IHRvIGRlZmluZSBhbgogIC8vIGludGVycG9sYXRpb24sIGV2YWx1YXRpb24gb3IgZXNjYXBpbmcgcmVnZXgsIHdlIG5lZWQgb25lIHRoYXQgaXMKICAvLyBndWFyYW50ZWVkIG5vdCB0byBtYXRjaC4KICB2YXIgbm9NYXRjaCA9IC8oLileLzsKCiAgLy8gQ2VydGFpbiBjaGFyYWN0ZXJzIG5lZWQgdG8gYmUgZXNjYXBlZCBzbyB0aGF0IHRoZXkgY2FuIGJlIHB1dCBpbnRvIGEKICAvLyBzdHJpbmcgbGl0ZXJhbC4KICB2YXIgZXNjYXBlcyA9IHsKICAgICInIjogICAgICAiJyIsCiAgICAnXFwnOiAgICAgJ1xcJywKICAgICdccic6ICAgICAncicsCiAgICAnXG4nOiAgICAgJ24nLAogICAgJ1x0JzogICAgICd0JywKICAgICdcdTIwMjgnOiAndTIwMjgnLAogICAgJ1x1MjAyOSc6ICd1MjAyOScKICB9OwoKICB2YXIgZXNjYXBlciA9IC9cXHwnfFxyfFxufFx0fFx1MjAyOHxcdTIwMjkvZzsKCiAgLy8gSmF2YVNjcmlwdCBtaWNyby10ZW1wbGF0aW5nLCBzaW1pbGFyIHRvIEpvaG4gUmVzaWcncyBpbXBsZW1lbnRhdGlvbi4KICAvLyBVbmRlcnNjb3JlIHRlbXBsYXRpbmcgaGFuZGxlcyBhcmJpdHJhcnkgZGVsaW1pdGVycywgcHJlc2VydmVzIHdoaXRlc3BhY2UsCiAgLy8gYW5kIGNvcnJlY3RseSBlc2NhcGVzIHF1b3RlcyB3aXRoaW4gaW50ZXJwb2xhdGVkIGNvZGUuCiAgXy50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHRleHQsIGRhdGEsIHNldHRpbmdzKSB7CiAgICB2YXIgcmVuZGVyOwogICAgc2V0dGluZ3MgPSBfLmRlZmF1bHRzKHt9LCBzZXR0aW5ncywgXy50ZW1wbGF0ZVNldHRpbmdzKTsKCiAgICAvLyBDb21iaW5lIGRlbGltaXRlcnMgaW50byBvbmUgcmVndWxhciBleHByZXNzaW9uIHZpYSBhbHRlcm5hdGlvbi4KICAgIHZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cChbCiAgICAgIChzZXR0aW5ncy5lc2NhcGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuaW50ZXJwb2xhdGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuZXZhbHVhdGUgfHwgbm9NYXRjaCkuc291cmNlCiAgICBdLmpvaW4oJ3wnKSArICd8JCcsICdnJyk7CgogICAgLy8gQ29tcGlsZSB0aGUgdGVtcGxhdGUgc291cmNlLCBlc2NhcGluZyBzdHJpbmcgbGl0ZXJhbHMgYXBwcm9wcmlhdGVseS4KICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc291cmNlID0gIl9fcCs9JyI7CiAgICB0ZXh0LnJlcGxhY2UobWF0Y2hlciwgZnVuY3Rpb24obWF0Y2gsIGVzY2FwZSwgaW50ZXJwb2xhdGUsIGV2YWx1YXRlLCBvZmZzZXQpIHsKICAgICAgc291cmNlICs9IHRleHQuc2xpY2UoaW5kZXgsIG9mZnNldCkKICAgICAgICAucmVwbGFjZShlc2NhcGVyLCBmdW5jdGlvbihtYXRjaCkgeyByZXR1cm4gJ1xcJyArIGVzY2FwZXNbbWF0Y2hdOyB9KTsKCiAgICAgIGlmIChlc2NhcGUpIHsKICAgICAgICBzb3VyY2UgKz0gIicrXG4oKF9fdD0oIiArIGVzY2FwZSArICIpKT09bnVsbD8nJzpfLmVzY2FwZShfX3QpKStcbiciOwogICAgICB9CiAgICAgIGlmIChpbnRlcnBvbGF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJytcbigoX190PSgiICsgaW50ZXJwb2xhdGUgKyAiKSk9PW51bGw/Jyc6X190KStcbiciOwogICAgICB9CiAgICAgIGlmIChldmFsdWF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJztcbiIgKyBldmFsdWF0ZSArICJcbl9fcCs9JyI7CiAgICAgIH0KICAgICAgaW5kZXggPSBvZmZzZXQgKyBtYXRjaC5sZW5ndGg7CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0pOwogICAgc291cmNlICs9ICInO1xuIjsKCiAgICAvLyBJZiBhIHZhcmlhYmxlIGlzIG5vdCBzcGVjaWZpZWQsIHBsYWNlIGRhdGEgdmFsdWVzIGluIGxvY2FsIHNjb3BlLgogICAgaWYgKCFzZXR0aW5ncy52YXJpYWJsZSkgc291cmNlID0gJ3dpdGgob2JqfHx7fSl7XG4nICsgc291cmNlICsgJ31cbic7CgogICAgc291cmNlID0gInZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbiwiICsKICAgICAgInByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307XG4iICsKICAgICAgc291cmNlICsgInJldHVybiBfX3A7XG4iOwoKICAgIHRyeSB7CiAgICAgIHJlbmRlciA9IG5ldyBGdW5jdGlvbihzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJywgJ18nLCBzb3VyY2UpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBlLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgdGhyb3cgZTsKICAgIH0KCiAgICBpZiAoZGF0YSkgcmV0dXJuIHJlbmRlcihkYXRhLCBfKTsKICAgIHZhciB0ZW1wbGF0ZSA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgcmV0dXJuIHJlbmRlci5jYWxsKHRoaXMsIGRhdGEsIF8pOwogICAgfTsKCiAgICAvLyBQcm92aWRlIHRoZSBjb21waWxlZCBmdW5jdGlvbiBzb3VyY2UgYXMgYSBjb252ZW5pZW5jZSBmb3IgcHJlY29tcGlsYXRpb24uCiAgICB0ZW1wbGF0ZS5zb3VyY2UgPSAnZnVuY3Rpb24oJyArIChzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJykgKyAnKXtcbicgKyBzb3VyY2UgKyAnfSc7CgogICAgcmV0dXJuIHRlbXBsYXRlOwogIH07CgogIC8vIEFkZCBhICJjaGFpbiIgZnVuY3Rpb24sIHdoaWNoIHdpbGwgZGVsZWdhdGUgdG8gdGhlIHdyYXBwZXIuCiAgXy5jaGFpbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8ob2JqKS5jaGFpbigpOwogIH07CgogIC8vIE9PUAogIC8vIC0tLS0tLS0tLS0tLS0tLQogIC8vIElmIFVuZGVyc2NvcmUgaXMgY2FsbGVkIGFzIGEgZnVuY3Rpb24sIGl0IHJldHVybnMgYSB3cmFwcGVkIG9iamVjdCB0aGF0CiAgLy8gY2FuIGJlIHVzZWQgT08tc3R5bGUuIFRoaXMgd3JhcHBlciBob2xkcyBhbHRlcmVkIHZlcnNpb25zIG9mIGFsbCB0aGUKICAvLyB1bmRlcnNjb3JlIGZ1bmN0aW9ucy4gV3JhcHBlZCBvYmplY3RzIG1heSBiZSBjaGFpbmVkLgoKICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29udGludWUgY2hhaW5pbmcgaW50ZXJtZWRpYXRlIHJlc3VsdHMuCiAgdmFyIHJlc3VsdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRoaXMuX2NoYWluID8gXyhvYmopLmNoYWluKCkgOiBvYmo7CiAgfTsKCiAgLy8gQWRkIGFsbCBvZiB0aGUgVW5kZXJzY29yZSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIgb2JqZWN0LgogIF8ubWl4aW4oXyk7CgogIC8vIEFkZCBhbGwgbXV0YXRvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuCiAgZWFjaChbJ3BvcCcsICdwdXNoJywgJ3JldmVyc2UnLCAnc2hpZnQnLCAnc29ydCcsICdzcGxpY2UnLCAndW5zaGlmdCddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBvYmogPSB0aGlzLl93cmFwcGVkOwogICAgICBtZXRob2QuYXBwbHkob2JqLCBhcmd1bWVudHMpOwogICAgICBpZiAoKG5hbWUgPT0gJ3NoaWZ0JyB8fCBuYW1lID09ICdzcGxpY2UnKSAmJiBvYmoubGVuZ3RoID09PSAwKSBkZWxldGUgb2JqWzBdOwogICAgICByZXR1cm4gcmVzdWx0LmNhbGwodGhpcywgb2JqKTsKICAgIH07CiAgfSk7CgogIC8vIEFkZCBhbGwgYWNjZXNzb3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLgogIGVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBtZXRob2QuYXBwbHkodGhpcy5fd3JhcHBlZCwgYXJndW1lbnRzKSk7CiAgICB9OwogIH0pOwoKICBfLmV4dGVuZChfLnByb3RvdHlwZSwgewoKICAgIC8vIFN0YXJ0IGNoYWluaW5nIGEgd3JhcHBlZCBVbmRlcnNjb3JlIG9iamVjdC4KICAgIGNoYWluOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5fY2hhaW4gPSB0cnVlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuCiAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl93cmFwcGVkOwogICAgfQoKICB9KTsKCiAgLy8gQU1EIHJlZ2lzdHJhdGlvbiBoYXBwZW5zIGF0IHRoZSBlbmQgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBBTUQgbG9hZGVycwogIC8vIHRoYXQgbWF5IG5vdCBlbmZvcmNlIG5leHQtdHVybiBzZW1hbnRpY3Mgb24gbW9kdWxlcy4gRXZlbiB0aG91Z2ggZ2VuZXJhbAogIC8vIHByYWN0aWNlIGZvciBBTUQgcmVnaXN0cmF0aW9uIGlzIHRvIGJlIGFub255bW91cywgdW5kZXJzY29yZSByZWdpc3RlcnMKICAvLyBhcyBhIG5hbWVkIG1vZHVsZSBiZWNhdXNlLCBsaWtlIGpRdWVyeSwgaXQgaXMgYSBiYXNlIGxpYnJhcnkgdGhhdCBpcwogIC8vIHBvcHVsYXIgZW5vdWdoIHRvIGJlIGJ1bmRsZWQgaW4gYSB0aGlyZCBwYXJ0eSBsaWIsIGJ1dCBub3QgYmUgcGFydCBvZgogIC8vIGFuIEFNRCBsb2FkIHJlcXVlc3QuIFRob3NlIGNhc2VzIGNvdWxkIGdlbmVyYXRlIGFuIGVycm9yIHdoZW4gYW4KICAvLyBhbm9ueW1vdXMgZGVmaW5lKCkgaXMgY2FsbGVkIG91dHNpZGUgb2YgYSBsb2FkZXIgcmVxdWVzdC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ3VuZGVyc2NvcmUnLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfOwogICAgfSk7CiAgfQp9KS5jYWxsKHRoaXMpOwoKLyoqCiAqIGEgc2luZ2xldG9uIG9iamVjdCB0aGF0IHdpbGwgaGFuZGxlIGdsb2JhbCBzY29wZSBjb25maWd1cmF0aW9uIChwYXRoIHRvIHdldCBpbmZvIHJlc3Qgc2VydmljZSBldGMuLikKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnQ29uZmlnJyxbJ3VuZGVyc2NvcmUnXSwgZnVuY3Rpb24gKF8pIHsKICAgIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgICAgICBpbnRlcnBvbGF0ZTogL1x7XHsoLis/KVx9XH0vZwogICAgfTsKCiAgICBDb25maWcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYuZGF0YSA9IHt9CiAgICB9CiAgICBDb25maWcucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIENvbmZpZy5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiB0aGlzLmRhdGFba2V5XTsKICAgIH0KCiAgICByZXR1cm4gbmV3IENvbmZpZygpOwp9KTsKCi8vICAgICBCYWNrYm9uZS5qcyAxLjEuMgoKLy8gICAgIChjKSAyMDEwLTIwMTQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKLy8gICAgIEJhY2tib25lIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgovLyAgICAgRm9yIGFsbCBkZXRhaWxzIGFuZCBkb2N1bWVudGF0aW9uOgovLyAgICAgaHR0cDovL2JhY2tib25lanMub3JnCgooZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkgewoKICAvLyBTZXQgdXAgQmFja2JvbmUgYXBwcm9wcmlhdGVseSBmb3IgdGhlIGVudmlyb25tZW50LiBTdGFydCB3aXRoIEFNRC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ0JhY2tib25lJyxbJ3VuZGVyc2NvcmUnLCAnanF1ZXJ5JywgJ2V4cG9ydHMnXSwgZnVuY3Rpb24oXywgJCwgZXhwb3J0cykgewogICAgICAvLyBFeHBvcnQgZ2xvYmFsIGV2ZW4gaW4gQU1EIGNhc2UgaW4gY2FzZSB0aGlzIHNjcmlwdCBpcyBsb2FkZWQgd2l0aAogICAgICAvLyBvdGhlcnMgdGhhdCBtYXkgc3RpbGwgZXhwZWN0IGEgZ2xvYmFsIEJhY2tib25lLgogICAgICByb290LkJhY2tib25lID0gZmFjdG9yeShyb290LCBleHBvcnRzLCBfLCAkKTsKICAgIH0pOwoKICAvLyBOZXh0IGZvciBOb2RlLmpzIG9yIENvbW1vbkpTLiBqUXVlcnkgbWF5IG5vdCBiZSBuZWVkZWQgYXMgYSBtb2R1bGUuCiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIHZhciBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpOwogICAgZmFjdG9yeShyb290LCBleHBvcnRzLCBfKTsKCiAgLy8gRmluYWxseSwgYXMgYSBicm93c2VyIGdsb2JhbC4KICB9IGVsc2UgewogICAgcm9vdC5CYWNrYm9uZSA9IGZhY3Rvcnkocm9vdCwge30sIHJvb3QuXywgKHJvb3QualF1ZXJ5IHx8IHJvb3QuWmVwdG8gfHwgcm9vdC5lbmRlciB8fCByb290LiQpKTsKICB9Cgp9KHRoaXMsIGZ1bmN0aW9uKHJvb3QsIEJhY2tib25lLCBfLCAkKSB7CgogIC8vIEluaXRpYWwgU2V0dXAKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgQmFja2JvbmVgIHZhcmlhYmxlLCBzbyB0aGF0IGl0IGNhbiBiZQogIC8vIHJlc3RvcmVkIGxhdGVyIG9uLCBpZiBgbm9Db25mbGljdGAgaXMgdXNlZC4KICB2YXIgcHJldmlvdXNCYWNrYm9uZSA9IHJvb3QuQmFja2JvbmU7CgogIC8vIENyZWF0ZSBsb2NhbCByZWZlcmVuY2VzIHRvIGFycmF5IG1ldGhvZHMgd2UnbGwgd2FudCB0byB1c2UgbGF0ZXIuCiAgdmFyIGFycmF5ID0gW107CiAgdmFyIHB1c2ggPSBhcnJheS5wdXNoOwogIHZhciBzbGljZSA9IGFycmF5LnNsaWNlOwogIHZhciBzcGxpY2UgPSBhcnJheS5zcGxpY2U7CgogIC8vIEN1cnJlbnQgdmVyc2lvbiBvZiB0aGUgbGlicmFyeS4gS2VlcCBpbiBzeW5jIHdpdGggYHBhY2thZ2UuanNvbmAuCiAgQmFja2JvbmUuVkVSU0lPTiA9ICcxLjEuMic7CgogIC8vIEZvciBCYWNrYm9uZSdzIHB1cnBvc2VzLCBqUXVlcnksIFplcHRvLCBFbmRlciwgb3IgTXkgTGlicmFyeSAoa2lkZGluZykgb3ducwogIC8vIHRoZSBgJGAgdmFyaWFibGUuCiAgQmFja2JvbmUuJCA9ICQ7CgogIC8vIFJ1bnMgQmFja2JvbmUuanMgaW4gKm5vQ29uZmxpY3QqIG1vZGUsIHJldHVybmluZyB0aGUgYEJhY2tib25lYCB2YXJpYWJsZQogIC8vIHRvIGl0cyBwcmV2aW91cyBvd25lci4gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGlzIEJhY2tib25lIG9iamVjdC4KICBCYWNrYm9uZS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICByb290LkJhY2tib25lID0gcHJldmlvdXNCYWNrYm9uZTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIC8vIFR1cm4gb24gYGVtdWxhdGVIVFRQYCB0byBzdXBwb3J0IGxlZ2FjeSBIVFRQIHNlcnZlcnMuIFNldHRpbmcgdGhpcyBvcHRpb24KICAvLyB3aWxsIGZha2UgYCJQQVRDSCJgLCBgIlBVVCJgIGFuZCBgIkRFTEVURSJgIHJlcXVlc3RzIHZpYSB0aGUgYF9tZXRob2RgIHBhcmFtZXRlciBhbmQKICAvLyBzZXQgYSBgWC1IdHRwLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgogIEJhY2tib25lLmVtdWxhdGVIVFRQID0gZmFsc2U7CgogIC8vIFR1cm4gb24gYGVtdWxhdGVKU09OYCB0byBzdXBwb3J0IGxlZ2FjeSBzZXJ2ZXJzIHRoYXQgY2FuJ3QgZGVhbCB3aXRoIGRpcmVjdAogIC8vIGBhcHBsaWNhdGlvbi9qc29uYCByZXF1ZXN0cyAuLi4gd2lsbCBlbmNvZGUgdGhlIGJvZHkgYXMKICAvLyBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYCBpbnN0ZWFkIGFuZCB3aWxsIHNlbmQgdGhlIG1vZGVsIGluIGEKICAvLyBmb3JtIHBhcmFtIG5hbWVkIGBtb2RlbGAuCiAgQmFja2JvbmUuZW11bGF0ZUpTT04gPSBmYWxzZTsKCiAgLy8gQmFja2JvbmUuRXZlbnRzCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIEEgbW9kdWxlIHRoYXQgY2FuIGJlIG1peGVkIGluIHRvICphbnkgb2JqZWN0KiBpbiBvcmRlciB0byBwcm92aWRlIGl0IHdpdGgKICAvLyBjdXN0b20gZXZlbnRzLiBZb3UgbWF5IGJpbmQgd2l0aCBgb25gIG9yIHJlbW92ZSB3aXRoIGBvZmZgIGNhbGxiYWNrCiAgLy8gZnVuY3Rpb25zIHRvIGFuIGV2ZW50OyBgdHJpZ2dlcmAtaW5nIGFuIGV2ZW50IGZpcmVzIGFsbCBjYWxsYmFja3MgaW4KICAvLyBzdWNjZXNzaW9uLgogIC8vCiAgLy8gICAgIHZhciBvYmplY3QgPSB7fTsKICAvLyAgICAgXy5leHRlbmQob2JqZWN0LCBCYWNrYm9uZS5FdmVudHMpOwogIC8vICAgICBvYmplY3Qub24oJ2V4cGFuZCcsIGZ1bmN0aW9uKCl7IGFsZXJ0KCdleHBhbmRlZCcpOyB9KTsKICAvLyAgICAgb2JqZWN0LnRyaWdnZXIoJ2V4cGFuZCcpOwogIC8vCiAgdmFyIEV2ZW50cyA9IEJhY2tib25lLkV2ZW50cyA9IHsKCiAgICAvLyBCaW5kIGFuIGV2ZW50IHRvIGEgYGNhbGxiYWNrYCBmdW5jdGlvbi4gUGFzc2luZyBgImFsbCJgIHdpbGwgYmluZAogICAgLy8gdGhlIGNhbGxiYWNrIHRvIGFsbCBldmVudHMgZmlyZWQuCiAgICBvbjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgaWYgKCFldmVudHNBcGkodGhpcywgJ29uJywgbmFtZSwgW2NhbGxiYWNrLCBjb250ZXh0XSkgfHwgIWNhbGxiYWNrKSByZXR1cm4gdGhpczsKICAgICAgdGhpcy5fZXZlbnRzIHx8ICh0aGlzLl9ldmVudHMgPSB7fSk7CiAgICAgIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHNbbmFtZV0gfHwgKHRoaXMuX2V2ZW50c1tuYW1lXSA9IFtdKTsKICAgICAgZXZlbnRzLnB1c2goe2NhbGxiYWNrOiBjYWxsYmFjaywgY29udGV4dDogY29udGV4dCwgY3R4OiBjb250ZXh0IHx8IHRoaXN9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIEJpbmQgYW4gZXZlbnQgdG8gb25seSBiZSB0cmlnZ2VyZWQgYSBzaW5nbGUgdGltZS4gQWZ0ZXIgdGhlIGZpcnN0IHRpbWUKICAgIC8vIHRoZSBjYWxsYmFjayBpcyBpbnZva2VkLCBpdCB3aWxsIGJlIHJlbW92ZWQuCiAgICBvbmNlOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgY29udGV4dCkgewogICAgICBpZiAoIWV2ZW50c0FwaSh0aGlzLCAnb25jZScsIG5hbWUsIFtjYWxsYmFjaywgY29udGV4dF0pIHx8ICFjYWxsYmFjaykgcmV0dXJuIHRoaXM7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIG9uY2UgPSBfLm9uY2UoZnVuY3Rpb24oKSB7CiAgICAgICAgc2VsZi5vZmYobmFtZSwgb25jZSk7CiAgICAgICAgY2FsbGJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfSk7CiAgICAgIG9uY2UuX2NhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0aGlzLm9uKG5hbWUsIG9uY2UsIGNvbnRleHQpOwogICAgfSwKCiAgICAvLyBSZW1vdmUgb25lIG9yIG1hbnkgY2FsbGJhY2tzLiBJZiBgY29udGV4dGAgaXMgbnVsbCwgcmVtb3ZlcyBhbGwKICAgIC8vIGNhbGxiYWNrcyB3aXRoIHRoYXQgZnVuY3Rpb24uIElmIGBjYWxsYmFja2AgaXMgbnVsbCwgcmVtb3ZlcyBhbGwKICAgIC8vIGNhbGxiYWNrcyBmb3IgdGhlIGV2ZW50LiBJZiBgbmFtZWAgaXMgbnVsbCwgcmVtb3ZlcyBhbGwgYm91bmQKICAgIC8vIGNhbGxiYWNrcyBmb3IgYWxsIGV2ZW50cy4KICAgIG9mZjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgdmFyIHJldGFpbiwgZXYsIGV2ZW50cywgbmFtZXMsIGksIGwsIGosIGs7CiAgICAgIGlmICghdGhpcy5fZXZlbnRzIHx8ICFldmVudHNBcGkodGhpcywgJ29mZicsIG5hbWUsIFtjYWxsYmFjaywgY29udGV4dF0pKSByZXR1cm4gdGhpczsKICAgICAgaWYgKCFuYW1lICYmICFjYWxsYmFjayAmJiAhY29udGV4dCkgewogICAgICAgIHRoaXMuX2V2ZW50cyA9IHZvaWQgMDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBuYW1lcyA9IG5hbWUgPyBbbmFtZV0gOiBfLmtleXModGhpcy5fZXZlbnRzKTsKICAgICAgZm9yIChpID0gMCwgbCA9IG5hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG5hbWUgPSBuYW1lc1tpXTsKICAgICAgICBpZiAoZXZlbnRzID0gdGhpcy5fZXZlbnRzW25hbWVdKSB7CiAgICAgICAgICB0aGlzLl9ldmVudHNbbmFtZV0gPSByZXRhaW4gPSBbXTsKICAgICAgICAgIGlmIChjYWxsYmFjayB8fCBjb250ZXh0KSB7CiAgICAgICAgICAgIGZvciAoaiA9IDAsIGsgPSBldmVudHMubGVuZ3RoOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgICAgZXYgPSBldmVudHNbal07CiAgICAgICAgICAgICAgaWYgKChjYWxsYmFjayAmJiBjYWxsYmFjayAhPT0gZXYuY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT09IGV2LmNhbGxiYWNrLl9jYWxsYmFjaykgfHwKICAgICAgICAgICAgICAgICAgKGNvbnRleHQgJiYgY29udGV4dCAhPT0gZXYuY29udGV4dCkpIHsKICAgICAgICAgICAgICAgIHJldGFpbi5wdXNoKGV2KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICghcmV0YWluLmxlbmd0aCkgZGVsZXRlIHRoaXMuX2V2ZW50c1tuYW1lXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBUcmlnZ2VyIG9uZSBvciBtYW55IGV2ZW50cywgZmlyaW5nIGFsbCBib3VuZCBjYWxsYmFja3MuIENhbGxiYWNrcyBhcmUKICAgIC8vIHBhc3NlZCB0aGUgc2FtZSBhcmd1bWVudHMgYXMgYHRyaWdnZXJgIGlzLCBhcGFydCBmcm9tIHRoZSBldmVudCBuYW1lCiAgICAvLyAodW5sZXNzIHlvdSdyZSBsaXN0ZW5pbmcgb24gYCJhbGwiYCwgd2hpY2ggd2lsbCBjYXVzZSB5b3VyIGNhbGxiYWNrIHRvCiAgICAvLyByZWNlaXZlIHRoZSB0cnVlIG5hbWUgb2YgdGhlIGV2ZW50IGFzIHRoZSBmaXJzdCBhcmd1bWVudCkuCiAgICB0cmlnZ2VyOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIGlmICghdGhpcy5fZXZlbnRzKSByZXR1cm4gdGhpczsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgIGlmICghZXZlbnRzQXBpKHRoaXMsICd0cmlnZ2VyJywgbmFtZSwgYXJncykpIHJldHVybiB0aGlzOwogICAgICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzW25hbWVdOwogICAgICB2YXIgYWxsRXZlbnRzID0gdGhpcy5fZXZlbnRzLmFsbDsKICAgICAgaWYgKGV2ZW50cykgdHJpZ2dlckV2ZW50cyhldmVudHMsIGFyZ3MpOwogICAgICBpZiAoYWxsRXZlbnRzKSB0cmlnZ2VyRXZlbnRzKGFsbEV2ZW50cywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFRlbGwgdGhpcyBvYmplY3QgdG8gc3RvcCBsaXN0ZW5pbmcgdG8gZWl0aGVyIHNwZWNpZmljIGV2ZW50cyAuLi4gb3IKICAgIC8vIHRvIGV2ZXJ5IG9iamVjdCBpdCdzIGN1cnJlbnRseSBsaXN0ZW5pbmcgdG8uCiAgICBzdG9wTGlzdGVuaW5nOiBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBsaXN0ZW5pbmdUbyA9IHRoaXMuX2xpc3RlbmluZ1RvOwogICAgICBpZiAoIWxpc3RlbmluZ1RvKSByZXR1cm4gdGhpczsKICAgICAgdmFyIHJlbW92ZSA9ICFuYW1lICYmICFjYWxsYmFjazsKICAgICAgaWYgKCFjYWxsYmFjayAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIGNhbGxiYWNrID0gdGhpczsKICAgICAgaWYgKG9iaikgKGxpc3RlbmluZ1RvID0ge30pW29iai5fbGlzdGVuSWRdID0gb2JqOwogICAgICBmb3IgKHZhciBpZCBpbiBsaXN0ZW5pbmdUbykgewogICAgICAgIG9iaiA9IGxpc3RlbmluZ1RvW2lkXTsKICAgICAgICBvYmoub2ZmKG5hbWUsIGNhbGxiYWNrLCB0aGlzKTsKICAgICAgICBpZiAocmVtb3ZlIHx8IF8uaXNFbXB0eShvYmouX2V2ZW50cykpIGRlbGV0ZSB0aGlzLl9saXN0ZW5pbmdUb1tpZF07CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH07CgogIC8vIFJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VkIHRvIHNwbGl0IGV2ZW50IHN0cmluZ3MuCiAgdmFyIGV2ZW50U3BsaXR0ZXIgPSAvXHMrLzsKCiAgLy8gSW1wbGVtZW50IGZhbmN5IGZlYXR1cmVzIG9mIHRoZSBFdmVudHMgQVBJIHN1Y2ggYXMgbXVsdGlwbGUgZXZlbnQKICAvLyBuYW1lcyBgImNoYW5nZSBibHVyImAgYW5kIGpRdWVyeS1zdHlsZSBldmVudCBtYXBzIGB7Y2hhbmdlOiBhY3Rpb259YAogIC8vIGluIHRlcm1zIG9mIHRoZSBleGlzdGluZyBBUEkuCiAgdmFyIGV2ZW50c0FwaSA9IGZ1bmN0aW9uKG9iaiwgYWN0aW9uLCBuYW1lLCByZXN0KSB7CiAgICBpZiAoIW5hbWUpIHJldHVybiB0cnVlOwoKICAgIC8vIEhhbmRsZSBldmVudCBtYXBzLgogICAgaWYgKHR5cGVvZiBuYW1lID09PSAnb2JqZWN0JykgewogICAgICBmb3IgKHZhciBrZXkgaW4gbmFtZSkgewogICAgICAgIG9ialthY3Rpb25dLmFwcGx5KG9iaiwgW2tleSwgbmFtZVtrZXldXS5jb25jYXQocmVzdCkpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBIYW5kbGUgc3BhY2Ugc2VwYXJhdGVkIGV2ZW50IG5hbWVzLgogICAgaWYgKGV2ZW50U3BsaXR0ZXIudGVzdChuYW1lKSkgewogICAgICB2YXIgbmFtZXMgPSBuYW1lLnNwbGl0KGV2ZW50U3BsaXR0ZXIpOwogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG5hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG9ialthY3Rpb25dLmFwcGx5KG9iaiwgW25hbWVzW2ldXS5jb25jYXQocmVzdCkpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKICAvLyBBIGRpZmZpY3VsdC10by1iZWxpZXZlLCBidXQgb3B0aW1pemVkIGludGVybmFsIGRpc3BhdGNoIGZ1bmN0aW9uIGZvcgogIC8vIHRyaWdnZXJpbmcgZXZlbnRzLiBUcmllcyB0byBrZWVwIHRoZSB1c3VhbCBjYXNlcyBzcGVlZHkgKG1vc3QgaW50ZXJuYWwKICAvLyBCYWNrYm9uZSBldmVudHMgaGF2ZSAzIGFyZ3VtZW50cykuCiAgdmFyIHRyaWdnZXJFdmVudHMgPSBmdW5jdGlvbihldmVudHMsIGFyZ3MpIHsKICAgIHZhciBldiwgaSA9IC0xLCBsID0gZXZlbnRzLmxlbmd0aCwgYTEgPSBhcmdzWzBdLCBhMiA9IGFyZ3NbMV0sIGEzID0gYXJnc1syXTsKICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHsKICAgICAgY2FzZSAwOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCk7IHJldHVybjsKICAgICAgY2FzZSAxOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEpOyByZXR1cm47CiAgICAgIGNhc2UgMjogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suY2FsbChldi5jdHgsIGExLCBhMik7IHJldHVybjsKICAgICAgY2FzZSAzOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEsIGEyLCBhMyk7IHJldHVybjsKICAgICAgZGVmYXVsdDogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suYXBwbHkoZXYuY3R4LCBhcmdzKTsgcmV0dXJuOwogICAgfQogIH07CgogIHZhciBsaXN0ZW5NZXRob2RzID0ge2xpc3RlblRvOiAnb24nLCBsaXN0ZW5Ub09uY2U6ICdvbmNlJ307CgogIC8vIEludmVyc2lvbi1vZi1jb250cm9sIHZlcnNpb25zIG9mIGBvbmAgYW5kIGBvbmNlYC4gVGVsbCAqdGhpcyogb2JqZWN0IHRvCiAgLy8gbGlzdGVuIHRvIGFuIGV2ZW50IGluIGFub3RoZXIgb2JqZWN0IC4uLiBrZWVwaW5nIHRyYWNrIG9mIHdoYXQgaXQncwogIC8vIGxpc3RlbmluZyB0by4KICBfLmVhY2gobGlzdGVuTWV0aG9kcywgZnVuY3Rpb24oaW1wbGVtZW50YXRpb24sIG1ldGhvZCkgewogICAgRXZlbnRzW21ldGhvZF0gPSBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBsaXN0ZW5pbmdUbyA9IHRoaXMuX2xpc3RlbmluZ1RvIHx8ICh0aGlzLl9saXN0ZW5pbmdUbyA9IHt9KTsKICAgICAgdmFyIGlkID0gb2JqLl9saXN0ZW5JZCB8fCAob2JqLl9saXN0ZW5JZCA9IF8udW5pcXVlSWQoJ2wnKSk7CiAgICAgIGxpc3RlbmluZ1RvW2lkXSA9IG9iajsKICAgICAgaWYgKCFjYWxsYmFjayAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIGNhbGxiYWNrID0gdGhpczsKICAgICAgb2JqW2ltcGxlbWVudGF0aW9uXShuYW1lLCBjYWxsYmFjaywgdGhpcyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICB9KTsKCiAgLy8gQWxpYXNlcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgRXZlbnRzLmJpbmQgICA9IEV2ZW50cy5vbjsKICBFdmVudHMudW5iaW5kID0gRXZlbnRzLm9mZjsKCiAgLy8gQWxsb3cgdGhlIGBCYWNrYm9uZWAgb2JqZWN0IHRvIHNlcnZlIGFzIGEgZ2xvYmFsIGV2ZW50IGJ1cywgZm9yIGZvbGtzIHdobwogIC8vIHdhbnQgZ2xvYmFsICJwdWJzdWIiIGluIGEgY29udmVuaWVudCBwbGFjZS4KICBfLmV4dGVuZChCYWNrYm9uZSwgRXZlbnRzKTsKCiAgLy8gQmFja2JvbmUuTW9kZWwKICAvLyAtLS0tLS0tLS0tLS0tLQoKICAvLyBCYWNrYm9uZSAqKk1vZGVscyoqIGFyZSB0aGUgYmFzaWMgZGF0YSBvYmplY3QgaW4gdGhlIGZyYW1ld29yayAtLQogIC8vIGZyZXF1ZW50bHkgcmVwcmVzZW50aW5nIGEgcm93IGluIGEgdGFibGUgaW4gYSBkYXRhYmFzZSBvbiB5b3VyIHNlcnZlci4KICAvLyBBIGRpc2NyZXRlIGNodW5rIG9mIGRhdGEgYW5kIGEgYnVuY2ggb2YgdXNlZnVsLCByZWxhdGVkIG1ldGhvZHMgZm9yCiAgLy8gcGVyZm9ybWluZyBjb21wdXRhdGlvbnMgYW5kIHRyYW5zZm9ybWF0aW9ucyBvbiB0aGF0IGRhdGEuCgogIC8vIENyZWF0ZSBhIG5ldyBtb2RlbCB3aXRoIHRoZSBzcGVjaWZpZWQgYXR0cmlidXRlcy4gQSBjbGllbnQgaWQgKGBjaWRgKQogIC8vIGlzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGFuZCBhc3NpZ25lZCBmb3IgeW91LgogIHZhciBNb2RlbCA9IEJhY2tib25lLk1vZGVsID0gZnVuY3Rpb24oYXR0cmlidXRlcywgb3B0aW9ucykgewogICAgdmFyIGF0dHJzID0gYXR0cmlidXRlcyB8fCB7fTsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ2MnKTsKICAgIHRoaXMuYXR0cmlidXRlcyA9IHt9OwogICAgaWYgKG9wdGlvbnMuY29sbGVjdGlvbikgdGhpcy5jb2xsZWN0aW9uID0gb3B0aW9ucy5jb2xsZWN0aW9uOwogICAgaWYgKG9wdGlvbnMucGFyc2UpIGF0dHJzID0gdGhpcy5wYXJzZShhdHRycywgb3B0aW9ucykgfHwge307CiAgICBhdHRycyA9IF8uZGVmYXVsdHMoe30sIGF0dHJzLCBfLnJlc3VsdCh0aGlzLCAnZGVmYXVsdHMnKSk7CiAgICB0aGlzLnNldChhdHRycywgb3B0aW9ucyk7CiAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8vIEF0dGFjaCBhbGwgaW5oZXJpdGFibGUgbWV0aG9kcyB0byB0aGUgTW9kZWwgcHJvdG90eXBlLgogIF8uZXh0ZW5kKE1vZGVsLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gQSBoYXNoIG9mIGF0dHJpYnV0ZXMgd2hvc2UgY3VycmVudCBhbmQgcHJldmlvdXMgdmFsdWUgZGlmZmVyLgogICAgY2hhbmdlZDogbnVsbCwKCiAgICAvLyBUaGUgdmFsdWUgcmV0dXJuZWQgZHVyaW5nIHRoZSBsYXN0IGZhaWxlZCB2YWxpZGF0aW9uLgogICAgdmFsaWRhdGlvbkVycm9yOiBudWxsLAoKICAgIC8vIFRoZSBkZWZhdWx0IG5hbWUgZm9yIHRoZSBKU09OIGBpZGAgYXR0cmlidXRlIGlzIGAiaWQiYC4gTW9uZ29EQiBhbmQKICAgIC8vIENvdWNoREIgdXNlcnMgbWF5IHdhbnQgdG8gc2V0IHRoaXMgdG8gYCJfaWQiYC4KICAgIGlkQXR0cmlidXRlOiAnaWQnLAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gUmV0dXJuIGEgY29weSBvZiB0aGUgbW9kZWwncyBgYXR0cmlidXRlc2Agb2JqZWN0LgogICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIFByb3h5IGBCYWNrYm9uZS5zeW5jYCBieSBkZWZhdWx0IC0tIGJ1dCBvdmVycmlkZSB0aGlzIGlmIHlvdSBuZWVkCiAgICAvLyBjdXN0b20gc3luY2luZyBzZW1hbnRpY3MgZm9yICp0aGlzKiBwYXJ0aWN1bGFyIG1vZGVsLgogICAgc3luYzogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBCYWNrYm9uZS5zeW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgdmFsdWUgb2YgYW4gYXR0cmlidXRlLgogICAgZ2V0OiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXNbYXR0cl07CiAgICB9LAoKICAgIC8vIEdldCB0aGUgSFRNTC1lc2NhcGVkIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZS4KICAgIGVzY2FwZTogZnVuY3Rpb24oYXR0cikgewogICAgICByZXR1cm4gXy5lc2NhcGUodGhpcy5nZXQoYXR0cikpOwogICAgfSwKCiAgICAvLyBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXR0cmlidXRlIGNvbnRhaW5zIGEgdmFsdWUgdGhhdCBpcyBub3QgbnVsbAogICAgLy8gb3IgdW5kZWZpbmVkLgogICAgaGFzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmdldChhdHRyKSAhPSBudWxsOwogICAgfSwKCiAgICAvLyBTZXQgYSBoYXNoIG9mIG1vZGVsIGF0dHJpYnV0ZXMgb24gdGhlIG9iamVjdCwgZmlyaW5nIGAiY2hhbmdlImAuIFRoaXMgaXMKICAgIC8vIHRoZSBjb3JlIHByaW1pdGl2ZSBvcGVyYXRpb24gb2YgYSBtb2RlbCwgdXBkYXRpbmcgdGhlIGRhdGEgYW5kIG5vdGlmeWluZwogICAgLy8gYW55b25lIHdobyBuZWVkcyB0byBrbm93IGFib3V0IHRoZSBjaGFuZ2UgaW4gc3RhdGUuIFRoZSBoZWFydCBvZiB0aGUgYmVhc3QuCiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsLCBvcHRpb25zKSB7CiAgICAgIHZhciBhdHRyLCBhdHRycywgdW5zZXQsIGNoYW5nZXMsIHNpbGVudCwgY2hhbmdpbmcsIHByZXYsIGN1cnJlbnQ7CiAgICAgIGlmIChrZXkgPT0gbnVsbCkgcmV0dXJuIHRoaXM7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgYXR0cnMgPSBrZXk7CiAgICAgICAgb3B0aW9ucyA9IHZhbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAoYXR0cnMgPSB7fSlba2V5XSA9IHZhbDsKICAgICAgfQoKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIC8vIFJ1biB2YWxpZGF0aW9uLgogICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgLy8gRXh0cmFjdCBhdHRyaWJ1dGVzIGFuZCBvcHRpb25zLgogICAgICB1bnNldCAgICAgICAgICAgPSBvcHRpb25zLnVuc2V0OwogICAgICBzaWxlbnQgICAgICAgICAgPSBvcHRpb25zLnNpbGVudDsKICAgICAgY2hhbmdlcyAgICAgICAgID0gW107CiAgICAgIGNoYW5naW5nICAgICAgICA9IHRoaXMuX2NoYW5naW5nOwogICAgICB0aGlzLl9jaGFuZ2luZyAgPSB0cnVlOwoKICAgICAgaWYgKCFjaGFuZ2luZykgewogICAgICAgIHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA9IF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgICAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgICAgfQogICAgICBjdXJyZW50ID0gdGhpcy5hdHRyaWJ1dGVzLCBwcmV2ID0gdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzOwoKICAgICAgLy8gQ2hlY2sgZm9yIGNoYW5nZXMgb2YgYGlkYC4KICAgICAgaWYgKHRoaXMuaWRBdHRyaWJ1dGUgaW4gYXR0cnMpIHRoaXMuaWQgPSBhdHRyc1t0aGlzLmlkQXR0cmlidXRlXTsKCiAgICAgIC8vIEZvciBlYWNoIGBzZXRgIGF0dHJpYnV0ZSwgdXBkYXRlIG9yIGRlbGV0ZSB0aGUgY3VycmVudCB2YWx1ZS4KICAgICAgZm9yIChhdHRyIGluIGF0dHJzKSB7CiAgICAgICAgdmFsID0gYXR0cnNbYXR0cl07CiAgICAgICAgaWYgKCFfLmlzRXF1YWwoY3VycmVudFthdHRyXSwgdmFsKSkgY2hhbmdlcy5wdXNoKGF0dHIpOwogICAgICAgIGlmICghXy5pc0VxdWFsKHByZXZbYXR0cl0sIHZhbCkpIHsKICAgICAgICAgIHRoaXMuY2hhbmdlZFthdHRyXSA9IHZhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlIHRoaXMuY2hhbmdlZFthdHRyXTsKICAgICAgICB9CiAgICAgICAgdW5zZXQgPyBkZWxldGUgY3VycmVudFthdHRyXSA6IGN1cnJlbnRbYXR0cl0gPSB2YWw7CiAgICAgIH0KCiAgICAgIC8vIFRyaWdnZXIgYWxsIHJlbGV2YW50IGF0dHJpYnV0ZSBjaGFuZ2VzLgogICAgICBpZiAoIXNpbGVudCkgewogICAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCkgdGhpcy5fcGVuZGluZyA9IG9wdGlvbnM7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaGFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2U6JyArIGNoYW5nZXNbaV0sIHRoaXMsIGN1cnJlbnRbY2hhbmdlc1tpXV0sIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gWW91IG1pZ2h0IGJlIHdvbmRlcmluZyB3aHkgdGhlcmUncyBhIGB3aGlsZWAgbG9vcCBoZXJlLiBDaGFuZ2VzIGNhbgogICAgICAvLyBiZSByZWN1cnNpdmVseSBuZXN0ZWQgd2l0aGluIGAiY2hhbmdlImAgZXZlbnRzLgogICAgICBpZiAoY2hhbmdpbmcpIHJldHVybiB0aGlzOwogICAgICBpZiAoIXNpbGVudCkgewogICAgICAgIHdoaWxlICh0aGlzLl9wZW5kaW5nKSB7CiAgICAgICAgICBvcHRpb25zID0gdGhpcy5fcGVuZGluZzsKICAgICAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5fY2hhbmdpbmcgPSBmYWxzZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhbiBhdHRyaWJ1dGUgZnJvbSB0aGUgbW9kZWwsIGZpcmluZyBgImNoYW5nZSJgLiBgdW5zZXRgIGlzIGEgbm9vcAogICAgLy8gaWYgdGhlIGF0dHJpYnV0ZSBkb2Vzbid0IGV4aXN0LgogICAgdW5zZXQ6IGZ1bmN0aW9uKGF0dHIsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0KGF0dHIsIHZvaWQgMCwgXy5leHRlbmQoe30sIG9wdGlvbnMsIHt1bnNldDogdHJ1ZX0pKTsKICAgIH0sCgogICAgLy8gQ2xlYXIgYWxsIGF0dHJpYnV0ZXMgb24gdGhlIG1vZGVsLCBmaXJpbmcgYCJjaGFuZ2UiYC4KICAgIGNsZWFyOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBhdHRycyA9IHt9OwogICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5hdHRyaWJ1dGVzKSBhdHRyc1trZXldID0gdm9pZCAwOwogICAgICByZXR1cm4gdGhpcy5zZXQoYXR0cnMsIF8uZXh0ZW5kKHt9LCBvcHRpb25zLCB7dW5zZXQ6IHRydWV9KSk7CiAgICB9LAoKICAgIC8vIERldGVybWluZSBpZiB0aGUgbW9kZWwgaGFzIGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgYCJjaGFuZ2UiYCBldmVudC4KICAgIC8vIElmIHlvdSBzcGVjaWZ5IGFuIGF0dHJpYnV0ZSBuYW1lLCBkZXRlcm1pbmUgaWYgdGhhdCBhdHRyaWJ1dGUgaGFzIGNoYW5nZWQuCiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIGlmIChhdHRyID09IG51bGwpIHJldHVybiAhXy5pc0VtcHR5KHRoaXMuY2hhbmdlZCk7CiAgICAgIHJldHVybiBfLmhhcyh0aGlzLmNoYW5nZWQsIGF0dHIpOwogICAgfSwKCiAgICAvLyBSZXR1cm4gYW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHRoZSBhdHRyaWJ1dGVzIHRoYXQgaGF2ZSBjaGFuZ2VkLCBvcgogICAgLy8gZmFsc2UgaWYgdGhlcmUgYXJlIG5vIGNoYW5nZWQgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBkZXRlcm1pbmluZyB3aGF0CiAgICAvLyBwYXJ0cyBvZiBhIHZpZXcgbmVlZCB0byBiZSB1cGRhdGVkIGFuZC9vciB3aGF0IGF0dHJpYnV0ZXMgbmVlZCB0byBiZQogICAgLy8gcGVyc2lzdGVkIHRvIHRoZSBzZXJ2ZXIuIFVuc2V0IGF0dHJpYnV0ZXMgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAgLy8gWW91IGNhbiBhbHNvIHBhc3MgYW4gYXR0cmlidXRlcyBvYmplY3QgdG8gZGlmZiBhZ2FpbnN0IHRoZSBtb2RlbCwKICAgIC8vIGRldGVybWluaW5nIGlmIHRoZXJlICp3b3VsZCBiZSogYSBjaGFuZ2UuCiAgICBjaGFuZ2VkQXR0cmlidXRlczogZnVuY3Rpb24oZGlmZikgewogICAgICBpZiAoIWRpZmYpIHJldHVybiB0aGlzLmhhc0NoYW5nZWQoKSA/IF8uY2xvbmUodGhpcy5jaGFuZ2VkKSA6IGZhbHNlOwogICAgICB2YXIgdmFsLCBjaGFuZ2VkID0gZmFsc2U7CiAgICAgIHZhciBvbGQgPSB0aGlzLl9jaGFuZ2luZyA/IHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA6IHRoaXMuYXR0cmlidXRlczsKICAgICAgZm9yICh2YXIgYXR0ciBpbiBkaWZmKSB7CiAgICAgICAgaWYgKF8uaXNFcXVhbChvbGRbYXR0cl0sICh2YWwgPSBkaWZmW2F0dHJdKSkpIGNvbnRpbnVlOwogICAgICAgIChjaGFuZ2VkIHx8IChjaGFuZ2VkID0ge30pKVthdHRyXSA9IHZhbDsKICAgICAgfQogICAgICByZXR1cm4gY2hhbmdlZDsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBwcmV2aW91cyB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUsIHJlY29yZGVkIGF0IHRoZSB0aW1lIHRoZSBsYXN0CiAgICAvLyBgImNoYW5nZSJgIGV2ZW50IHdhcyBmaXJlZC4KICAgIHByZXZpb3VzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIGlmIChhdHRyID09IG51bGwgfHwgIXRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcykgcmV0dXJuIG51bGw7CiAgICAgIHJldHVybiB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXNbYXR0cl07CiAgICB9LAoKICAgIC8vIEdldCBhbGwgb2YgdGhlIGF0dHJpYnV0ZXMgb2YgdGhlIG1vZGVsIGF0IHRoZSB0aW1lIG9mIHRoZSBwcmV2aW91cwogICAgLy8gYCJjaGFuZ2UiYCBldmVudC4KICAgIHByZXZpb3VzQXR0cmlidXRlczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfLmNsb25lKHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIEZldGNoIHRoZSBtb2RlbCBmcm9tIHRoZSBzZXJ2ZXIuIElmIHRoZSBzZXJ2ZXIncyByZXByZXNlbnRhdGlvbiBvZiB0aGUKICAgIC8vIG1vZGVsIGRpZmZlcnMgZnJvbSBpdHMgY3VycmVudCBhdHRyaWJ1dGVzLCB0aGV5IHdpbGwgYmUgb3ZlcnJpZGRlbiwKICAgIC8vIHRyaWdnZXJpbmcgYSBgImNoYW5nZSJgIGV2ZW50LgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB2b2lkIDApIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgbW9kZWwgPSB0aGlzOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgIGlmICghbW9kZWwuc2V0KG1vZGVsLnBhcnNlKHJlc3AsIG9wdGlvbnMpLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzLnN5bmMoJ3JlYWQnLCB0aGlzLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gU2V0IGEgaGFzaCBvZiBtb2RlbCBhdHRyaWJ1dGVzLCBhbmQgc3luYyB0aGUgbW9kZWwgdG8gdGhlIHNlcnZlci4KICAgIC8vIElmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBhdHRyaWJ1dGVzIGhhc2ggdGhhdCBkaWZmZXJzLCB0aGUgbW9kZWwncwogICAgLy8gc3RhdGUgd2lsbCBiZSBgc2V0YCBhZ2Fpbi4KICAgIHNhdmU6IGZ1bmN0aW9uKGtleSwgdmFsLCBvcHRpb25zKSB7CiAgICAgIHZhciBhdHRycywgbWV0aG9kLCB4aHIsIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKGtleSA9PSBudWxsIHx8IHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgYXR0cnMgPSBrZXk7CiAgICAgICAgb3B0aW9ucyA9IHZhbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAoYXR0cnMgPSB7fSlba2V5XSA9IHZhbDsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IF8uZXh0ZW5kKHt2YWxpZGF0ZTogdHJ1ZX0sIG9wdGlvbnMpOwoKICAgICAgLy8gSWYgd2UncmUgbm90IHdhaXRpbmcgYW5kIGF0dHJpYnV0ZXMgZXhpc3QsIHNhdmUgYWN0cyBhcwogICAgICAvLyBgc2V0KGF0dHIpLnNhdmUobnVsbCwgb3B0cylgIHdpdGggdmFsaWRhdGlvbi4gT3RoZXJ3aXNlLCBjaGVjayBpZgogICAgICAvLyB0aGUgbW9kZWwgd2lsbCBiZSB2YWxpZCB3aGVuIHRoZSBhdHRyaWJ1dGVzLCBpZiBhbnksIGFyZSBzZXQuCiAgICAgIGlmIChhdHRycyAmJiAhb3B0aW9ucy53YWl0KSB7CiAgICAgICAgaWYgKCF0aGlzLnNldChhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyBTZXQgdGVtcG9yYXJ5IGF0dHJpYnV0ZXMgaWYgYHt3YWl0OiB0cnVlfWAuCiAgICAgIGlmIChhdHRycyAmJiBvcHRpb25zLndhaXQpIHsKICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBfLmV4dGVuZCh7fSwgYXR0cmlidXRlcywgYXR0cnMpOwogICAgICB9CgogICAgICAvLyBBZnRlciBhIHN1Y2Nlc3NmdWwgc2VydmVyLXNpZGUgc2F2ZSwgdGhlIGNsaWVudCBpcyAob3B0aW9uYWxseSkKICAgICAgLy8gdXBkYXRlZCB3aXRoIHRoZSBzZXJ2ZXItc2lkZSBzdGF0ZS4KICAgICAgaWYgKG9wdGlvbnMucGFyc2UgPT09IHZvaWQgMCkgb3B0aW9ucy5wYXJzZSA9IHRydWU7CiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgLy8gRW5zdXJlIGF0dHJpYnV0ZXMgYXJlIHJlc3RvcmVkIGR1cmluZyBzeW5jaHJvbm91cyBzYXZlcy4KICAgICAgICBtb2RlbC5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKICAgICAgICB2YXIgc2VydmVyQXR0cnMgPSBtb2RlbC5wYXJzZShyZXNwLCBvcHRpb25zKTsKICAgICAgICBpZiAob3B0aW9ucy53YWl0KSBzZXJ2ZXJBdHRycyA9IF8uZXh0ZW5kKGF0dHJzIHx8IHt9LCBzZXJ2ZXJBdHRycyk7CiAgICAgICAgaWYgKF8uaXNPYmplY3Qoc2VydmVyQXR0cnMpICYmICFtb2RlbC5zZXQoc2VydmVyQXR0cnMsIG9wdGlvbnMpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CgogICAgICBtZXRob2QgPSB0aGlzLmlzTmV3KCkgPyAnY3JlYXRlJyA6IChvcHRpb25zLnBhdGNoID8gJ3BhdGNoJyA6ICd1cGRhdGUnKTsKICAgICAgaWYgKG1ldGhvZCA9PT0gJ3BhdGNoJykgb3B0aW9ucy5hdHRycyA9IGF0dHJzOwogICAgICB4aHIgPSB0aGlzLnN5bmMobWV0aG9kLCB0aGlzLCBvcHRpb25zKTsKCiAgICAgIC8vIFJlc3RvcmUgYXR0cmlidXRlcy4KICAgICAgaWYgKGF0dHJzICYmIG9wdGlvbnMud2FpdCkgdGhpcy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKCiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlc3Ryb3kgdGhpcyBtb2RlbCBvbiB0aGUgc2VydmVyIGlmIGl0IHdhcyBhbHJlYWR5IHBlcnNpc3RlZC4KICAgIC8vIE9wdGltaXN0aWNhbGx5IHJlbW92ZXMgdGhlIG1vZGVsIGZyb20gaXRzIGNvbGxlY3Rpb24sIGlmIGl0IGhhcyBvbmUuCiAgICAvLyBJZiBgd2FpdDogdHJ1ZWAgaXMgcGFzc2VkLCB3YWl0cyBmb3IgdGhlIHNlcnZlciB0byByZXNwb25kIGJlZm9yZSByZW1vdmFsLgogICAgZGVzdHJveTogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgdmFyIG1vZGVsID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CgogICAgICB2YXIgZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgIG1vZGVsLnRyaWdnZXIoJ2Rlc3Ryb3knLCBtb2RlbCwgbW9kZWwuY29sbGVjdGlvbiwgb3B0aW9ucyk7CiAgICAgIH07CgogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCB8fCBtb2RlbC5pc05ldygpKSBkZXN0cm95KCk7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MobW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGlmICghbW9kZWwuaXNOZXcoKSkgbW9kZWwudHJpZ2dlcignc3luYycsIG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLmlzTmV3KCkpIHsKICAgICAgICBvcHRpb25zLnN1Y2Nlc3MoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgd3JhcEVycm9yKHRoaXMsIG9wdGlvbnMpOwoKICAgICAgdmFyIHhociA9IHRoaXMuc3luYygnZGVsZXRlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSBkZXN0cm95KCk7CiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlZmF1bHQgVVJMIGZvciB0aGUgbW9kZWwncyByZXByZXNlbnRhdGlvbiBvbiB0aGUgc2VydmVyIC0tIGlmIHlvdSdyZQogICAgLy8gdXNpbmcgQmFja2JvbmUncyByZXN0ZnVsIG1ldGhvZHMsIG92ZXJyaWRlIHRoaXMgdG8gY2hhbmdlIHRoZSBlbmRwb2ludAogICAgLy8gdGhhdCB3aWxsIGJlIGNhbGxlZC4KICAgIHVybDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBiYXNlID0KICAgICAgICBfLnJlc3VsdCh0aGlzLCAndXJsUm9vdCcpIHx8CiAgICAgICAgXy5yZXN1bHQodGhpcy5jb2xsZWN0aW9uLCAndXJsJykgfHwKICAgICAgICB1cmxFcnJvcigpOwogICAgICBpZiAodGhpcy5pc05ldygpKSByZXR1cm4gYmFzZTsKICAgICAgcmV0dXJuIGJhc2UucmVwbGFjZSgvKFteXC9dKSQvLCAnJDEvJykgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5pZCk7CiAgICB9LAoKICAgIC8vICoqcGFyc2UqKiBjb252ZXJ0cyBhIHJlc3BvbnNlIGludG8gdGhlIGhhc2ggb2YgYXR0cmlidXRlcyB0byBiZSBgc2V0YCBvbgogICAgLy8gdGhlIG1vZGVsLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgdGhlIHJlc3BvbnNlIGFsb25nLgogICAgcGFyc2U6IGZ1bmN0aW9uKHJlc3AsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHJlc3A7CiAgICB9LAoKICAgIC8vIENyZWF0ZSBhIG5ldyBtb2RlbCB3aXRoIGlkZW50aWNhbCBhdHRyaWJ1dGVzIHRvIHRoaXMgb25lLgogICAgY2xvbmU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5hdHRyaWJ1dGVzKTsKICAgIH0sCgogICAgLy8gQSBtb2RlbCBpcyBuZXcgaWYgaXQgaGFzIG5ldmVyIGJlZW4gc2F2ZWQgdG8gdGhlIHNlcnZlciwgYW5kIGxhY2tzIGFuIGlkLgogICAgaXNOZXc6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gIXRoaXMuaGFzKHRoaXMuaWRBdHRyaWJ1dGUpOwogICAgfSwKCiAgICAvLyBDaGVjayBpZiB0aGUgbW9kZWwgaXMgY3VycmVudGx5IGluIGEgdmFsaWQgc3RhdGUuCiAgICBpc1ZhbGlkOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLl92YWxpZGF0ZSh7fSwgXy5leHRlbmQob3B0aW9ucyB8fCB7fSwgeyB2YWxpZGF0ZTogdHJ1ZSB9KSk7CiAgICB9LAoKICAgIC8vIFJ1biB2YWxpZGF0aW9uIGFnYWluc3QgdGhlIG5leHQgY29tcGxldGUgc2V0IG9mIG1vZGVsIGF0dHJpYnV0ZXMsCiAgICAvLyByZXR1cm5pbmcgYHRydWVgIGlmIGFsbCBpcyB3ZWxsLiBPdGhlcndpc2UsIGZpcmUgYW4gYCJpbnZhbGlkImAgZXZlbnQuCiAgICBfdmFsaWRhdGU6IGZ1bmN0aW9uKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgIGlmICghb3B0aW9ucy52YWxpZGF0ZSB8fCAhdGhpcy52YWxpZGF0ZSkgcmV0dXJuIHRydWU7CiAgICAgIGF0dHJzID0gXy5leHRlbmQoe30sIHRoaXMuYXR0cmlidXRlcywgYXR0cnMpOwogICAgICB2YXIgZXJyb3IgPSB0aGlzLnZhbGlkYXRpb25FcnJvciA9IHRoaXMudmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpIHx8IG51bGw7CiAgICAgIGlmICghZXJyb3IpIHJldHVybiB0cnVlOwogICAgICB0aGlzLnRyaWdnZXIoJ2ludmFsaWQnLCB0aGlzLCBlcnJvciwgXy5leHRlbmQob3B0aW9ucywge3ZhbGlkYXRpb25FcnJvcjogZXJyb3J9KSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgfSk7CgogIC8vIFVuZGVyc2NvcmUgbWV0aG9kcyB0aGF0IHdlIHdhbnQgdG8gaW1wbGVtZW50IG9uIHRoZSBNb2RlbC4KICB2YXIgbW9kZWxNZXRob2RzID0gWydrZXlzJywgJ3ZhbHVlcycsICdwYWlycycsICdpbnZlcnQnLCAncGljaycsICdvbWl0J107CgogIC8vIE1peCBpbiBlYWNoIFVuZGVyc2NvcmUgbWV0aG9kIGFzIGEgcHJveHkgdG8gYE1vZGVsI2F0dHJpYnV0ZXNgLgogIF8uZWFjaChtb2RlbE1ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCkgewogICAgTW9kZWwucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGFyZ3MudW5zaGlmdCh0aGlzLmF0dHJpYnV0ZXMpOwogICAgICByZXR1cm4gX1ttZXRob2RdLmFwcGx5KF8sIGFyZ3MpOwogICAgfTsKICB9KTsKCiAgLy8gQmFja2JvbmUuQ29sbGVjdGlvbgogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gSWYgbW9kZWxzIHRlbmQgdG8gcmVwcmVzZW50IGEgc2luZ2xlIHJvdyBvZiBkYXRhLCBhIEJhY2tib25lIENvbGxlY3Rpb24gaXMKICAvLyBtb3JlIGFuYWxhZ291cyB0byBhIHRhYmxlIGZ1bGwgb2YgZGF0YSAuLi4gb3IgYSBzbWFsbCBzbGljZSBvciBwYWdlIG9mIHRoYXQKICAvLyB0YWJsZSwgb3IgYSBjb2xsZWN0aW9uIG9mIHJvd3MgdGhhdCBiZWxvbmcgdG9nZXRoZXIgZm9yIGEgcGFydGljdWxhciByZWFzb24KICAvLyAtLSBhbGwgb2YgdGhlIG1lc3NhZ2VzIGluIHRoaXMgcGFydGljdWxhciBmb2xkZXIsIGFsbCBvZiB0aGUgZG9jdW1lbnRzCiAgLy8gYmVsb25naW5nIHRvIHRoaXMgcGFydGljdWxhciBhdXRob3IsIGFuZCBzbyBvbi4gQ29sbGVjdGlvbnMgbWFpbnRhaW4KICAvLyBpbmRleGVzIG9mIHRoZWlyIG1vZGVscywgYm90aCBpbiBvcmRlciwgYW5kIGZvciBsb29rdXAgYnkgYGlkYC4KCiAgLy8gQ3JlYXRlIGEgbmV3ICoqQ29sbGVjdGlvbioqLCBwZXJoYXBzIHRvIGNvbnRhaW4gYSBzcGVjaWZpYyB0eXBlIG9mIGBtb2RlbGAuCiAgLy8gSWYgYSBgY29tcGFyYXRvcmAgaXMgc3BlY2lmaWVkLCB0aGUgQ29sbGVjdGlvbiB3aWxsIG1haW50YWluCiAgLy8gaXRzIG1vZGVscyBpbiBzb3J0IG9yZGVyLCBhcyB0aGV5J3JlIGFkZGVkIGFuZCByZW1vdmVkLgogIHZhciBDb2xsZWN0aW9uID0gQmFja2JvbmUuQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIGlmIChvcHRpb25zLm1vZGVsKSB0aGlzLm1vZGVsID0gb3B0aW9ucy5tb2RlbDsKICAgIGlmIChvcHRpb25zLmNvbXBhcmF0b3IgIT09IHZvaWQgMCkgdGhpcy5jb21wYXJhdG9yID0gb3B0aW9ucy5jb21wYXJhdG9yOwogICAgdGhpcy5fcmVzZXQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgaWYgKG1vZGVscykgdGhpcy5yZXNldChtb2RlbHMsIF8uZXh0ZW5kKHtzaWxlbnQ6IHRydWV9LCBvcHRpb25zKSk7CiAgfTsKCiAgLy8gRGVmYXVsdCBvcHRpb25zIGZvciBgQ29sbGVjdGlvbiNzZXRgLgogIHZhciBzZXRPcHRpb25zID0ge2FkZDogdHJ1ZSwgcmVtb3ZlOiB0cnVlLCBtZXJnZTogdHJ1ZX07CiAgdmFyIGFkZE9wdGlvbnMgPSB7YWRkOiB0cnVlLCByZW1vdmU6IGZhbHNlfTsKCiAgLy8gRGVmaW5lIHRoZSBDb2xsZWN0aW9uJ3MgaW5oZXJpdGFibGUgbWV0aG9kcy4KICBfLmV4dGVuZChDb2xsZWN0aW9uLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gVGhlIGRlZmF1bHQgbW9kZWwgZm9yIGEgY29sbGVjdGlvbiBpcyBqdXN0IGEgKipCYWNrYm9uZS5Nb2RlbCoqLgogICAgLy8gVGhpcyBzaG91bGQgYmUgb3ZlcnJpZGRlbiBpbiBtb3N0IGNhc2VzLgogICAgbW9kZWw6IE1vZGVsLAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gVGhlIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYSBDb2xsZWN0aW9uIGlzIGFuIGFycmF5IG9mIHRoZQogICAgLy8gbW9kZWxzJyBhdHRyaWJ1dGVzLgogICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihtb2RlbCl7IHJldHVybiBtb2RlbC50b0pTT04ob3B0aW9ucyk7IH0pOwogICAgfSwKCiAgICAvLyBQcm94eSBgQmFja2JvbmUuc3luY2AgYnkgZGVmYXVsdC4KICAgIHN5bmM6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gQmFja2JvbmUuc3luYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCwgb3IgbGlzdCBvZiBtb2RlbHMgdG8gdGhlIHNldC4KICAgIGFkZDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLnNldChtb2RlbHMsIF8uZXh0ZW5kKHttZXJnZTogZmFsc2V9LCBvcHRpb25zLCBhZGRPcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsLCBvciBhIGxpc3Qgb2YgbW9kZWxzIGZyb20gdGhlIHNldC4KICAgIHJlbW92ZTogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHZhciBzaW5ndWxhciA9ICFfLmlzQXJyYXkobW9kZWxzKTsKICAgICAgbW9kZWxzID0gc2luZ3VsYXIgPyBbbW9kZWxzXSA6IF8uY2xvbmUobW9kZWxzKTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgdmFyIGksIGwsIGluZGV4LCBtb2RlbDsKICAgICAgZm9yIChpID0gMCwgbCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBtb2RlbCA9IG1vZGVsc1tpXSA9IHRoaXMuZ2V0KG1vZGVsc1tpXSk7CiAgICAgICAgaWYgKCFtb2RlbCkgY29udGludWU7CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5SWRbbW9kZWwuaWRdOwogICAgICAgIGRlbGV0ZSB0aGlzLl9ieUlkW21vZGVsLmNpZF07CiAgICAgICAgaW5kZXggPSB0aGlzLmluZGV4T2YobW9kZWwpOwogICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgdGhpcy5sZW5ndGgtLTsKICAgICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB7CiAgICAgICAgICBvcHRpb25zLmluZGV4ID0gaW5kZXg7CiAgICAgICAgICBtb2RlbC50cmlnZ2VyKCdyZW1vdmUnLCBtb2RlbCwgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3JlbW92ZVJlZmVyZW5jZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHNpbmd1bGFyID8gbW9kZWxzWzBdIDogbW9kZWxzOwogICAgfSwKCiAgICAvLyBVcGRhdGUgYSBjb2xsZWN0aW9uIGJ5IGBzZXRgLWluZyBhIG5ldyBsaXN0IG9mIG1vZGVscywgYWRkaW5nIG5ldyBvbmVzLAogICAgLy8gcmVtb3ZpbmcgbW9kZWxzIHRoYXQgYXJlIG5vIGxvbmdlciBwcmVzZW50LCBhbmQgbWVyZ2luZyBtb2RlbHMgdGhhdAogICAgLy8gYWxyZWFkeSBleGlzdCBpbiB0aGUgY29sbGVjdGlvbiwgYXMgbmVjZXNzYXJ5LiBTaW1pbGFyIHRvICoqTW9kZWwjc2V0KiosCiAgICAvLyB0aGUgY29yZSBvcGVyYXRpb24gZm9yIHVwZGF0aW5nIHRoZSBkYXRhIGNvbnRhaW5lZCBieSB0aGUgY29sbGVjdGlvbi4KICAgIHNldDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBfLmRlZmF1bHRzKHt9LCBvcHRpb25zLCBzZXRPcHRpb25zKTsKICAgICAgaWYgKG9wdGlvbnMucGFyc2UpIG1vZGVscyA9IHRoaXMucGFyc2UobW9kZWxzLCBvcHRpb25zKTsKICAgICAgdmFyIHNpbmd1bGFyID0gIV8uaXNBcnJheShtb2RlbHMpOwogICAgICBtb2RlbHMgPSBzaW5ndWxhciA/IChtb2RlbHMgPyBbbW9kZWxzXSA6IFtdKSA6IF8uY2xvbmUobW9kZWxzKTsKICAgICAgdmFyIGksIGwsIGlkLCBtb2RlbCwgYXR0cnMsIGV4aXN0aW5nLCBzb3J0OwogICAgICB2YXIgYXQgPSBvcHRpb25zLmF0OwogICAgICB2YXIgdGFyZ2V0TW9kZWwgPSB0aGlzLm1vZGVsOwogICAgICB2YXIgc29ydGFibGUgPSB0aGlzLmNvbXBhcmF0b3IgJiYgKGF0ID09IG51bGwpICYmIG9wdGlvbnMuc29ydCAhPT0gZmFsc2U7CiAgICAgIHZhciBzb3J0QXR0ciA9IF8uaXNTdHJpbmcodGhpcy5jb21wYXJhdG9yKSA/IHRoaXMuY29tcGFyYXRvciA6IG51bGw7CiAgICAgIHZhciB0b0FkZCA9IFtdLCB0b1JlbW92ZSA9IFtdLCBtb2RlbE1hcCA9IHt9OwogICAgICB2YXIgYWRkID0gb3B0aW9ucy5hZGQsIG1lcmdlID0gb3B0aW9ucy5tZXJnZSwgcmVtb3ZlID0gb3B0aW9ucy5yZW1vdmU7CiAgICAgIHZhciBvcmRlciA9ICFzb3J0YWJsZSAmJiBhZGQgJiYgcmVtb3ZlID8gW10gOiBmYWxzZTsKCiAgICAgIC8vIFR1cm4gYmFyZSBvYmplY3RzIGludG8gbW9kZWwgcmVmZXJlbmNlcywgYW5kIHByZXZlbnQgaW52YWxpZCBtb2RlbHMKICAgICAgLy8gZnJvbSBiZWluZyBhZGRlZC4KICAgICAgZm9yIChpID0gMCwgbCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBhdHRycyA9IG1vZGVsc1tpXSB8fCB7fTsKICAgICAgICBpZiAoYXR0cnMgaW5zdGFuY2VvZiBNb2RlbCkgewogICAgICAgICAgaWQgPSBtb2RlbCA9IGF0dHJzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZCA9IGF0dHJzW3RhcmdldE1vZGVsLnByb3RvdHlwZS5pZEF0dHJpYnV0ZSB8fCAnaWQnXTsKICAgICAgICB9CgogICAgICAgIC8vIElmIGEgZHVwbGljYXRlIGlzIGZvdW5kLCBwcmV2ZW50IGl0IGZyb20gYmVpbmcgYWRkZWQgYW5kCiAgICAgICAgLy8gb3B0aW9uYWxseSBtZXJnZSBpdCBpbnRvIHRoZSBleGlzdGluZyBtb2RlbC4KICAgICAgICBpZiAoZXhpc3RpbmcgPSB0aGlzLmdldChpZCkpIHsKICAgICAgICAgIGlmIChyZW1vdmUpIG1vZGVsTWFwW2V4aXN0aW5nLmNpZF0gPSB0cnVlOwogICAgICAgICAgaWYgKG1lcmdlKSB7CiAgICAgICAgICAgIGF0dHJzID0gYXR0cnMgPT09IG1vZGVsID8gbW9kZWwuYXR0cmlidXRlcyA6IGF0dHJzOwogICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJzZSkgYXR0cnMgPSBleGlzdGluZy5wYXJzZShhdHRycywgb3B0aW9ucyk7CiAgICAgICAgICAgIGV4aXN0aW5nLnNldChhdHRycywgb3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChzb3J0YWJsZSAmJiAhc29ydCAmJiBleGlzdGluZy5oYXNDaGFuZ2VkKHNvcnRBdHRyKSkgc29ydCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBtb2RlbHNbaV0gPSBleGlzdGluZzsKCiAgICAgICAgLy8gSWYgdGhpcyBpcyBhIG5ldywgdmFsaWQgbW9kZWwsIHB1c2ggaXQgdG8gdGhlIGB0b0FkZGAgbGlzdC4KICAgICAgICB9IGVsc2UgaWYgKGFkZCkgewogICAgICAgICAgbW9kZWwgPSBtb2RlbHNbaV0gPSB0aGlzLl9wcmVwYXJlTW9kZWwoYXR0cnMsIG9wdGlvbnMpOwogICAgICAgICAgaWYgKCFtb2RlbCkgY29udGludWU7CiAgICAgICAgICB0b0FkZC5wdXNoKG1vZGVsKTsKICAgICAgICAgIHRoaXMuX2FkZFJlZmVyZW5jZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgICAgfQoKICAgICAgICAvLyBEbyBub3QgYWRkIG11bHRpcGxlIG1vZGVscyB3aXRoIHRoZSBzYW1lIGBpZGAuCiAgICAgICAgbW9kZWwgPSBleGlzdGluZyB8fCBtb2RlbDsKICAgICAgICBpZiAob3JkZXIgJiYgKG1vZGVsLmlzTmV3KCkgfHwgIW1vZGVsTWFwW21vZGVsLmlkXSkpIG9yZGVyLnB1c2gobW9kZWwpOwogICAgICAgIG1vZGVsTWFwW21vZGVsLmlkXSA9IHRydWU7CiAgICAgIH0KCiAgICAgIC8vIFJlbW92ZSBub25leGlzdGVudCBtb2RlbHMgaWYgYXBwcm9wcmlhdGUuCiAgICAgIGlmIChyZW1vdmUpIHsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgICAgICAgIGlmICghbW9kZWxNYXBbKG1vZGVsID0gdGhpcy5tb2RlbHNbaV0pLmNpZF0pIHRvUmVtb3ZlLnB1c2gobW9kZWwpOwogICAgICAgIH0KICAgICAgICBpZiAodG9SZW1vdmUubGVuZ3RoKSB0aGlzLnJlbW92ZSh0b1JlbW92ZSwgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIC8vIFNlZSBpZiBzb3J0aW5nIGlzIG5lZWRlZCwgdXBkYXRlIGBsZW5ndGhgIGFuZCBzcGxpY2UgaW4gbmV3IG1vZGVscy4KICAgICAgaWYgKHRvQWRkLmxlbmd0aCB8fCAob3JkZXIgJiYgb3JkZXIubGVuZ3RoKSkgewogICAgICAgIGlmIChzb3J0YWJsZSkgc29ydCA9IHRydWU7CiAgICAgICAgdGhpcy5sZW5ndGggKz0gdG9BZGQubGVuZ3RoOwogICAgICAgIGlmIChhdCAhPSBudWxsKSB7CiAgICAgICAgICBmb3IgKGkgPSAwLCBsID0gdG9BZGQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShhdCArIGksIDAsIHRvQWRkW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKG9yZGVyKSB0aGlzLm1vZGVscy5sZW5ndGggPSAwOwogICAgICAgICAgdmFyIG9yZGVyZWRNb2RlbHMgPSBvcmRlciB8fCB0b0FkZDsKICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBvcmRlcmVkTW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICB0aGlzLm1vZGVscy5wdXNoKG9yZGVyZWRNb2RlbHNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gU2lsZW50bHkgc29ydCB0aGUgY29sbGVjdGlvbiBpZiBhcHByb3ByaWF0ZS4KICAgICAgaWYgKHNvcnQpIHRoaXMuc29ydCh7c2lsZW50OiB0cnVlfSk7CgogICAgICAvLyBVbmxlc3Mgc2lsZW5jZWQsIGl0J3MgdGltZSB0byBmaXJlIGFsbCBhcHByb3ByaWF0ZSBhZGQvc29ydCBldmVudHMuCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gdG9BZGQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAobW9kZWwgPSB0b0FkZFtpXSkudHJpZ2dlcignYWRkJywgbW9kZWwsIHRoaXMsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICBpZiAoc29ydCB8fCAob3JkZXIgJiYgb3JkZXIubGVuZ3RoKSkgdGhpcy50cmlnZ2VyKCdzb3J0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIC8vIFJldHVybiB0aGUgYWRkZWQgKG9yIG1lcmdlZCkgbW9kZWwgKG9yIG1vZGVscykuCiAgICAgIHJldHVybiBzaW5ndWxhciA/IG1vZGVsc1swXSA6IG1vZGVsczsKICAgIH0sCgogICAgLy8gV2hlbiB5b3UgaGF2ZSBtb3JlIGl0ZW1zIHRoYW4geW91IHdhbnQgdG8gYWRkIG9yIHJlbW92ZSBpbmRpdmlkdWFsbHksCiAgICAvLyB5b3UgY2FuIHJlc2V0IHRoZSBlbnRpcmUgc2V0IHdpdGggYSBuZXcgbGlzdCBvZiBtb2RlbHMsIHdpdGhvdXQgZmlyaW5nCiAgICAvLyBhbnkgZ3JhbnVsYXIgYGFkZGAgb3IgYHJlbW92ZWAgZXZlbnRzLiBGaXJlcyBgcmVzZXRgIHdoZW4gZmluaXNoZWQuCiAgICAvLyBVc2VmdWwgZm9yIGJ1bGsgb3BlcmF0aW9ucyBhbmQgb3B0aW1pemF0aW9ucy4KICAgIHJlc2V0OiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLm1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLl9yZW1vdmVSZWZlcmVuY2UodGhpcy5tb2RlbHNbaV0sIG9wdGlvbnMpOwogICAgICB9CiAgICAgIG9wdGlvbnMucHJldmlvdXNNb2RlbHMgPSB0aGlzLm1vZGVsczsKICAgICAgdGhpcy5fcmVzZXQoKTsKICAgICAgbW9kZWxzID0gdGhpcy5hZGQobW9kZWxzLCBfLmV4dGVuZCh7c2lsZW50OiB0cnVlfSwgb3B0aW9ucykpOwogICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLnRyaWdnZXIoJ3Jlc2V0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiBtb2RlbHM7CiAgICB9LAoKICAgIC8vIEFkZCBhIG1vZGVsIHRvIHRoZSBlbmQgb2YgdGhlIGNvbGxlY3Rpb24uCiAgICBwdXNoOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICByZXR1cm4gdGhpcy5hZGQobW9kZWwsIF8uZXh0ZW5kKHthdDogdGhpcy5sZW5ndGh9LCBvcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGVuZCBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHBvcDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICB2YXIgbW9kZWwgPSB0aGlzLmF0KHRoaXMubGVuZ3RoIC0gMSk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgdW5zaGlmdDogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuYWRkKG1vZGVsLCBfLmV4dGVuZCh7YXQ6IDB9LCBvcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHNoaWZ0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuYXQoMCk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBTbGljZSBvdXQgYSBzdWItYXJyYXkgb2YgbW9kZWxzIGZyb20gdGhlIGNvbGxlY3Rpb24uCiAgICBzbGljZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBzbGljZS5hcHBseSh0aGlzLm1vZGVscywgYXJndW1lbnRzKTsKICAgIH0sCgogICAgLy8gR2V0IGEgbW9kZWwgZnJvbSB0aGUgc2V0IGJ5IGlkLgogICAgZ2V0OiBmdW5jdGlvbihvYmopIHsKICAgICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgICByZXR1cm4gdGhpcy5fYnlJZFtvYmpdIHx8IHRoaXMuX2J5SWRbb2JqLmlkXSB8fCB0aGlzLl9ieUlkW29iai5jaWRdOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIG1vZGVsIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIGF0OiBmdW5jdGlvbihpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlbHNbaW5kZXhdOwogICAgfSwKCiAgICAvLyBSZXR1cm4gbW9kZWxzIHdpdGggbWF0Y2hpbmcgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBzaW1wbGUgY2FzZXMgb2YKICAgIC8vIGBmaWx0ZXJgLgogICAgd2hlcmU6IGZ1bmN0aW9uKGF0dHJzLCBmaXJzdCkgewogICAgICBpZiAoXy5pc0VtcHR5KGF0dHJzKSkgcmV0dXJuIGZpcnN0ID8gdm9pZCAwIDogW107CiAgICAgIHJldHVybiB0aGlzW2ZpcnN0ID8gJ2ZpbmQnIDogJ2ZpbHRlciddKGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7CiAgICAgICAgICBpZiAoYXR0cnNba2V5XSAhPT0gbW9kZWwuZ2V0KGtleSkpIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBSZXR1cm4gdGhlIGZpcnN0IG1vZGVsIHdpdGggbWF0Y2hpbmcgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBzaW1wbGUgY2FzZXMKICAgIC8vIG9mIGBmaW5kYC4KICAgIGZpbmRXaGVyZTogZnVuY3Rpb24oYXR0cnMpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlcmUoYXR0cnMsIHRydWUpOwogICAgfSwKCiAgICAvLyBGb3JjZSB0aGUgY29sbGVjdGlvbiB0byByZS1zb3J0IGl0c2VsZi4gWW91IGRvbid0IG5lZWQgdG8gY2FsbCB0aGlzIHVuZGVyCiAgICAvLyBub3JtYWwgY2lyY3Vtc3RhbmNlcywgYXMgdGhlIHNldCB3aWxsIG1haW50YWluIHNvcnQgb3JkZXIgYXMgZWFjaCBpdGVtCiAgICAvLyBpcyBhZGRlZC4KICAgIHNvcnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgaWYgKCF0aGlzLmNvbXBhcmF0b3IpIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNvcnQgYSBzZXQgd2l0aG91dCBhIGNvbXBhcmF0b3InKTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIC8vIFJ1biBzb3J0IGJhc2VkIG9uIHR5cGUgb2YgYGNvbXBhcmF0b3JgLgogICAgICBpZiAoXy5pc1N0cmluZyh0aGlzLmNvbXBhcmF0b3IpIHx8IHRoaXMuY29tcGFyYXRvci5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLm1vZGVscyA9IHRoaXMuc29ydEJ5KHRoaXMuY29tcGFyYXRvciwgdGhpcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5tb2RlbHMuc29ydChfLmJpbmQodGhpcy5jb21wYXJhdG9yLCB0aGlzKSk7CiAgICAgIH0KCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMudHJpZ2dlcignc29ydCcsIHRoaXMsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUGx1Y2sgYW4gYXR0cmlidXRlIGZyb20gZWFjaCBtb2RlbCBpbiB0aGUgY29sbGVjdGlvbi4KICAgIHBsdWNrOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiBfLmludm9rZSh0aGlzLm1vZGVscywgJ2dldCcsIGF0dHIpOwogICAgfSwKCiAgICAvLyBGZXRjaCB0aGUgZGVmYXVsdCBzZXQgb2YgbW9kZWxzIGZvciB0aGlzIGNvbGxlY3Rpb24sIHJlc2V0dGluZyB0aGUKICAgIC8vIGNvbGxlY3Rpb24gd2hlbiB0aGV5IGFycml2ZS4gSWYgYHJlc2V0OiB0cnVlYCBpcyBwYXNzZWQsIHRoZSByZXNwb25zZQogICAgLy8gZGF0YSB3aWxsIGJlIHBhc3NlZCB0aHJvdWdoIHRoZSBgcmVzZXRgIG1ldGhvZCBpbnN0ZWFkIG9mIGBzZXRgLgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB2b2lkIDApIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgdmFyIGNvbGxlY3Rpb24gPSB0aGlzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IG9wdGlvbnMucmVzZXQgPyAncmVzZXQnIDogJ3NldCc7CiAgICAgICAgY29sbGVjdGlvblttZXRob2RdKHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGNvbGxlY3Rpb24udHJpZ2dlcignc3luYycsIGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzLnN5bmMoJ3JlYWQnLCB0aGlzLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIGEgbW9kZWwgaW4gdGhpcyBjb2xsZWN0aW9uLiBBZGQgdGhlIG1vZGVsIHRvIHRoZQogICAgLy8gY29sbGVjdGlvbiBpbW1lZGlhdGVseSwgdW5sZXNzIGB3YWl0OiB0cnVlYCBpcyBwYXNzZWQsIGluIHdoaWNoIGNhc2Ugd2UKICAgIC8vIHdhaXQgZm9yIHRoZSBzZXJ2ZXIgdG8gYWdyZWUuCiAgICBjcmVhdGU6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9OwogICAgICBpZiAoIShtb2RlbCA9IHRoaXMuX3ByZXBhcmVNb2RlbChtb2RlbCwgb3B0aW9ucykpKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSB0aGlzLmFkZChtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHZhciBjb2xsZWN0aW9uID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKG1vZGVsLCByZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgY29sbGVjdGlvbi5hZGQobW9kZWwsIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKICAgICAgbW9kZWwuc2F2ZShudWxsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyAqKnBhcnNlKiogY29udmVydHMgYSByZXNwb25zZSBpbnRvIGEgbGlzdCBvZiBtb2RlbHMgdG8gYmUgYWRkZWQgdG8gdGhlCiAgICAvLyBjb2xsZWN0aW9uLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgaXQgdGhyb3VnaC4KICAgIHBhcnNlOiBmdW5jdGlvbihyZXNwLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiByZXNwOwogICAgfSwKCiAgICAvLyBDcmVhdGUgYSBuZXcgY29sbGVjdGlvbiB3aXRoIGFuIGlkZW50aWNhbCBsaXN0IG9mIG1vZGVscyBhcyB0aGlzIG9uZS4KICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMubW9kZWxzKTsKICAgIH0sCgogICAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gcmVzZXQgYWxsIGludGVybmFsIHN0YXRlLiBDYWxsZWQgd2hlbiB0aGUgY29sbGVjdGlvbgogICAgLy8gaXMgZmlyc3QgaW5pdGlhbGl6ZWQgb3IgcmVzZXQuCiAgICBfcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubW9kZWxzID0gW107CiAgICAgIHRoaXMuX2J5SWQgID0ge307CiAgICB9LAoKICAgIC8vIFByZXBhcmUgYSBoYXNoIG9mIGF0dHJpYnV0ZXMgKG9yIG90aGVyIG1vZGVsKSB0byBiZSBhZGRlZCB0byB0aGlzCiAgICAvLyBjb2xsZWN0aW9uLgogICAgX3ByZXBhcmVNb2RlbDogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgaWYgKGF0dHJzIGluc3RhbmNlb2YgTW9kZWwpIHJldHVybiBhdHRyczsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIG9wdGlvbnMuY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIHZhciBtb2RlbCA9IG5ldyB0aGlzLm1vZGVsKGF0dHJzLCBvcHRpb25zKTsKICAgICAgaWYgKCFtb2RlbC52YWxpZGF0aW9uRXJyb3IpIHJldHVybiBtb2RlbDsKICAgICAgdGhpcy50cmlnZ2VyKCdpbnZhbGlkJywgdGhpcywgbW9kZWwudmFsaWRhdGlvbkVycm9yLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgdG8gY3JlYXRlIGEgbW9kZWwncyB0aWVzIHRvIGEgY29sbGVjdGlvbi4KICAgIF9hZGRSZWZlcmVuY2U6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIHRoaXMuX2J5SWRbbW9kZWwuY2lkXSA9IG1vZGVsOwogICAgICBpZiAobW9kZWwuaWQgIT0gbnVsbCkgdGhpcy5fYnlJZFttb2RlbC5pZF0gPSBtb2RlbDsKICAgICAgaWYgKCFtb2RlbC5jb2xsZWN0aW9uKSBtb2RlbC5jb2xsZWN0aW9uID0gdGhpczsKICAgICAgbW9kZWwub24oJ2FsbCcsIHRoaXMuX29uTW9kZWxFdmVudCwgdGhpcyk7CiAgICB9LAoKICAgIC8vIEludGVybmFsIG1ldGhvZCB0byBzZXZlciBhIG1vZGVsJ3MgdGllcyB0byBhIGNvbGxlY3Rpb24uCiAgICBfcmVtb3ZlUmVmZXJlbmNlOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICBpZiAodGhpcyA9PT0gbW9kZWwuY29sbGVjdGlvbikgZGVsZXRlIG1vZGVsLmNvbGxlY3Rpb247CiAgICAgIG1vZGVsLm9mZignYWxsJywgdGhpcy5fb25Nb2RlbEV2ZW50LCB0aGlzKTsKICAgIH0sCgogICAgLy8gSW50ZXJuYWwgbWV0aG9kIGNhbGxlZCBldmVyeSB0aW1lIGEgbW9kZWwgaW4gdGhlIHNldCBmaXJlcyBhbiBldmVudC4KICAgIC8vIFNldHMgbmVlZCB0byB1cGRhdGUgdGhlaXIgaW5kZXhlcyB3aGVuIG1vZGVscyBjaGFuZ2UgaWRzLiBBbGwgb3RoZXIKICAgIC8vIGV2ZW50cyBzaW1wbHkgcHJveHkgdGhyb3VnaC4gImFkZCIgYW5kICJyZW1vdmUiIGV2ZW50cyB0aGF0IG9yaWdpbmF0ZQogICAgLy8gaW4gb3RoZXIgY29sbGVjdGlvbnMgYXJlIGlnbm9yZWQuCiAgICBfb25Nb2RlbEV2ZW50OiBmdW5jdGlvbihldmVudCwgbW9kZWwsIGNvbGxlY3Rpb24sIG9wdGlvbnMpIHsKICAgICAgaWYgKChldmVudCA9PT0gJ2FkZCcgfHwgZXZlbnQgPT09ICdyZW1vdmUnKSAmJiBjb2xsZWN0aW9uICE9PSB0aGlzKSByZXR1cm47CiAgICAgIGlmIChldmVudCA9PT0gJ2Rlc3Ryb3knKSB0aGlzLnJlbW92ZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIGlmIChtb2RlbCAmJiBldmVudCA9PT0gJ2NoYW5nZTonICsgbW9kZWwuaWRBdHRyaWJ1dGUpIHsKICAgICAgICBkZWxldGUgdGhpcy5fYnlJZFttb2RlbC5wcmV2aW91cyhtb2RlbC5pZEF0dHJpYnV0ZSldOwogICAgICAgIGlmIChtb2RlbC5pZCAhPSBudWxsKSB0aGlzLl9ieUlkW21vZGVsLmlkXSA9IG1vZGVsOwogICAgICB9CiAgICAgIHRoaXMudHJpZ2dlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICB9KTsKCiAgLy8gVW5kZXJzY29yZSBtZXRob2RzIHRoYXQgd2Ugd2FudCB0byBpbXBsZW1lbnQgb24gdGhlIENvbGxlY3Rpb24uCiAgLy8gOTAlIG9mIHRoZSBjb3JlIHVzZWZ1bG5lc3Mgb2YgQmFja2JvbmUgQ29sbGVjdGlvbnMgaXMgYWN0dWFsbHkgaW1wbGVtZW50ZWQKICAvLyByaWdodCBoZXJlOgogIHZhciBtZXRob2RzID0gWydmb3JFYWNoJywgJ2VhY2gnLCAnbWFwJywgJ2NvbGxlY3QnLCAncmVkdWNlJywgJ2ZvbGRsJywKICAgICdpbmplY3QnLCAncmVkdWNlUmlnaHQnLCAnZm9sZHInLCAnZmluZCcsICdkZXRlY3QnLCAnZmlsdGVyJywgJ3NlbGVjdCcsCiAgICAncmVqZWN0JywgJ2V2ZXJ5JywgJ2FsbCcsICdzb21lJywgJ2FueScsICdpbmNsdWRlJywgJ2NvbnRhaW5zJywgJ2ludm9rZScsCiAgICAnbWF4JywgJ21pbicsICd0b0FycmF5JywgJ3NpemUnLCAnZmlyc3QnLCAnaGVhZCcsICd0YWtlJywgJ2luaXRpYWwnLCAncmVzdCcsCiAgICAndGFpbCcsICdkcm9wJywgJ2xhc3QnLCAnd2l0aG91dCcsICdkaWZmZXJlbmNlJywgJ2luZGV4T2YnLCAnc2h1ZmZsZScsCiAgICAnbGFzdEluZGV4T2YnLCAnaXNFbXB0eScsICdjaGFpbicsICdzYW1wbGUnXTsKCiAgLy8gTWl4IGluIGVhY2ggVW5kZXJzY29yZSBtZXRob2QgYXMgYSBwcm94eSB0byBgQ29sbGVjdGlvbiNtb2RlbHNgLgogIF8uZWFjaChtZXRob2RzLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIENvbGxlY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGFyZ3MudW5zaGlmdCh0aGlzLm1vZGVscyk7CiAgICAgIHJldHVybiBfW21ldGhvZF0uYXBwbHkoXywgYXJncyk7CiAgICB9OwogIH0pOwoKICAvLyBVbmRlcnNjb3JlIG1ldGhvZHMgdGhhdCB0YWtlIGEgcHJvcGVydHkgbmFtZSBhcyBhbiBhcmd1bWVudC4KICB2YXIgYXR0cmlidXRlTWV0aG9kcyA9IFsnZ3JvdXBCeScsICdjb3VudEJ5JywgJ3NvcnRCeScsICdpbmRleEJ5J107CgogIC8vIFVzZSBhdHRyaWJ1dGVzIGluc3RlYWQgb2YgcHJvcGVydGllcy4KICBfLmVhY2goYXR0cmlidXRlTWV0aG9kcywgZnVuY3Rpb24obWV0aG9kKSB7CiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24odmFsdWUsIGNvbnRleHQpIHsKICAgICAgdmFyIGl0ZXJhdG9yID0gXy5pc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlIDogZnVuY3Rpb24obW9kZWwpIHsKICAgICAgICByZXR1cm4gbW9kZWwuZ2V0KHZhbHVlKTsKICAgICAgfTsKICAgICAgcmV0dXJuIF9bbWV0aG9kXSh0aGlzLm1vZGVscywgaXRlcmF0b3IsIGNvbnRleHQpOwogICAgfTsKICB9KTsKCiAgLy8gQmFja2JvbmUuVmlldwogIC8vIC0tLS0tLS0tLS0tLS0KCiAgLy8gQmFja2JvbmUgVmlld3MgYXJlIGFsbW9zdCBtb3JlIGNvbnZlbnRpb24gdGhhbiB0aGV5IGFyZSBhY3R1YWwgY29kZS4gQSBWaWV3CiAgLy8gaXMgc2ltcGx5IGEgSmF2YVNjcmlwdCBvYmplY3QgdGhhdCByZXByZXNlbnRzIGEgbG9naWNhbCBjaHVuayBvZiBVSSBpbiB0aGUKICAvLyBET00uIFRoaXMgbWlnaHQgYmUgYSBzaW5nbGUgaXRlbSwgYW4gZW50aXJlIGxpc3QsIGEgc2lkZWJhciBvciBwYW5lbCwgb3IKICAvLyBldmVuIHRoZSBzdXJyb3VuZGluZyBmcmFtZSB3aGljaCB3cmFwcyB5b3VyIHdob2xlIGFwcC4gRGVmaW5pbmcgYSBjaHVuayBvZgogIC8vIFVJIGFzIGEgKipWaWV3KiogYWxsb3dzIHlvdSB0byBkZWZpbmUgeW91ciBET00gZXZlbnRzIGRlY2xhcmF0aXZlbHksIHdpdGhvdXQKICAvLyBoYXZpbmcgdG8gd29ycnkgYWJvdXQgcmVuZGVyIG9yZGVyIC4uLiBhbmQgbWFrZXMgaXQgZWFzeSBmb3IgdGhlIHZpZXcgdG8KICAvLyByZWFjdCB0byBzcGVjaWZpYyBjaGFuZ2VzIGluIHRoZSBzdGF0ZSBvZiB5b3VyIG1vZGVscy4KCiAgLy8gQ3JlYXRpbmcgYSBCYWNrYm9uZS5WaWV3IGNyZWF0ZXMgaXRzIGluaXRpYWwgZWxlbWVudCBvdXRzaWRlIG9mIHRoZSBET00sCiAgLy8gaWYgYW4gZXhpc3RpbmcgZWxlbWVudCBpcyBub3QgcHJvdmlkZWQuLi4KICB2YXIgVmlldyA9IEJhY2tib25lLlZpZXcgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ3ZpZXcnKTsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICBfLmV4dGVuZCh0aGlzLCBfLnBpY2sob3B0aW9ucywgdmlld09wdGlvbnMpKTsKICAgIHRoaXMuX2Vuc3VyZUVsZW1lbnQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgdGhpcy5kZWxlZ2F0ZUV2ZW50cygpOwogIH07CgogIC8vIENhY2hlZCByZWdleCB0byBzcGxpdCBrZXlzIGZvciBgZGVsZWdhdGVgLgogIHZhciBkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIgPSAvXihcUyspXHMqKC4qKSQvOwoKICAvLyBMaXN0IG9mIHZpZXcgb3B0aW9ucyB0byBiZSBtZXJnZWQgYXMgcHJvcGVydGllcy4KICB2YXIgdmlld09wdGlvbnMgPSBbJ21vZGVsJywgJ2NvbGxlY3Rpb24nLCAnZWwnLCAnaWQnLCAnYXR0cmlidXRlcycsICdjbGFzc05hbWUnLCAndGFnTmFtZScsICdldmVudHMnXTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLlZpZXcqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKFZpZXcucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBgdGFnTmFtZWAgb2YgYSBWaWV3J3MgZWxlbWVudCBpcyBgImRpdiJgLgogICAgdGFnTmFtZTogJ2RpdicsCgogICAgLy8galF1ZXJ5IGRlbGVnYXRlIGZvciBlbGVtZW50IGxvb2t1cCwgc2NvcGVkIHRvIERPTSBlbGVtZW50cyB3aXRoaW4gdGhlCiAgICAvLyBjdXJyZW50IHZpZXcuIFRoaXMgc2hvdWxkIGJlIHByZWZlcnJlZCB0byBnbG9iYWwgbG9va3VwcyB3aGVyZSBwb3NzaWJsZS4KICAgICQ6IGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLiRlbC5maW5kKHNlbGVjdG9yKTsKICAgIH0sCgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyAqKnJlbmRlcioqIGlzIHRoZSBjb3JlIGZ1bmN0aW9uIHRoYXQgeW91ciB2aWV3IHNob3VsZCBvdmVycmlkZSwgaW4gb3JkZXIKICAgIC8vIHRvIHBvcHVsYXRlIGl0cyBlbGVtZW50IChgdGhpcy5lbGApLCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBIVE1MLiBUaGUKICAgIC8vIGNvbnZlbnRpb24gaXMgZm9yICoqcmVuZGVyKiogdG8gYWx3YXlzIHJldHVybiBgdGhpc2AuCiAgICByZW5kZXI6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIHRoaXMgdmlldyBieSB0YWtpbmcgdGhlIGVsZW1lbnQgb3V0IG9mIHRoZSBET00sIGFuZCByZW1vdmluZyBhbnkKICAgIC8vIGFwcGxpY2FibGUgQmFja2JvbmUuRXZlbnRzIGxpc3RlbmVycy4KICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuJGVsLnJlbW92ZSgpOwogICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIENoYW5nZSB0aGUgdmlldydzIGVsZW1lbnQgKGB0aGlzLmVsYCBwcm9wZXJ0eSksIGluY2x1ZGluZyBldmVudAogICAgLy8gcmUtZGVsZWdhdGlvbi4KICAgIHNldEVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIGRlbGVnYXRlKSB7CiAgICAgIGlmICh0aGlzLiRlbCkgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIHRoaXMuJGVsID0gZWxlbWVudCBpbnN0YW5jZW9mIEJhY2tib25lLiQgPyBlbGVtZW50IDogQmFja2JvbmUuJChlbGVtZW50KTsKICAgICAgdGhpcy5lbCA9IHRoaXMuJGVsWzBdOwogICAgICBpZiAoZGVsZWdhdGUgIT09IGZhbHNlKSB0aGlzLmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBTZXQgY2FsbGJhY2tzLCB3aGVyZSBgdGhpcy5ldmVudHNgIGlzIGEgaGFzaCBvZgogICAgLy8KICAgIC8vICp7ImV2ZW50IHNlbGVjdG9yIjogImNhbGxiYWNrIn0qCiAgICAvLwogICAgLy8gICAgIHsKICAgIC8vICAgICAgICdtb3VzZWRvd24gLnRpdGxlJzogICdlZGl0JywKICAgIC8vICAgICAgICdjbGljayAuYnV0dG9uJzogICAgICdzYXZlJywKICAgIC8vICAgICAgICdjbGljayAub3Blbic6ICAgICAgIGZ1bmN0aW9uKGUpIHsgLi4uIH0KICAgIC8vICAgICB9CiAgICAvLwogICAgLy8gcGFpcnMuIENhbGxiYWNrcyB3aWxsIGJlIGJvdW5kIHRvIHRoZSB2aWV3LCB3aXRoIGB0aGlzYCBzZXQgcHJvcGVybHkuCiAgICAvLyBVc2VzIGV2ZW50IGRlbGVnYXRpb24gZm9yIGVmZmljaWVuY3kuCiAgICAvLyBPbWl0dGluZyB0aGUgc2VsZWN0b3IgYmluZHMgdGhlIGV2ZW50IHRvIGB0aGlzLmVsYC4KICAgIC8vIFRoaXMgb25seSB3b3JrcyBmb3IgZGVsZWdhdGUtYWJsZSBldmVudHM6IG5vdCBgZm9jdXNgLCBgYmx1cmAsIGFuZAogICAgLy8gbm90IGBjaGFuZ2VgLCBgc3VibWl0YCwgYW5kIGByZXNldGAgaW4gSW50ZXJuZXQgRXhwbG9yZXIuCiAgICBkZWxlZ2F0ZUV2ZW50czogZnVuY3Rpb24oZXZlbnRzKSB7CiAgICAgIGlmICghKGV2ZW50cyB8fCAoZXZlbnRzID0gXy5yZXN1bHQodGhpcywgJ2V2ZW50cycpKSkpIHJldHVybiB0aGlzOwogICAgICB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgZm9yICh2YXIga2V5IGluIGV2ZW50cykgewogICAgICAgIHZhciBtZXRob2QgPSBldmVudHNba2V5XTsKICAgICAgICBpZiAoIV8uaXNGdW5jdGlvbihtZXRob2QpKSBtZXRob2QgPSB0aGlzW2V2ZW50c1trZXldXTsKICAgICAgICBpZiAoIW1ldGhvZCkgY29udGludWU7CgogICAgICAgIHZhciBtYXRjaCA9IGtleS5tYXRjaChkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIpOwogICAgICAgIHZhciBldmVudE5hbWUgPSBtYXRjaFsxXSwgc2VsZWN0b3IgPSBtYXRjaFsyXTsKICAgICAgICBtZXRob2QgPSBfLmJpbmQobWV0aG9kLCB0aGlzKTsKICAgICAgICBldmVudE5hbWUgKz0gJy5kZWxlZ2F0ZUV2ZW50cycgKyB0aGlzLmNpZDsKICAgICAgICBpZiAoc2VsZWN0b3IgPT09ICcnKSB7CiAgICAgICAgICB0aGlzLiRlbC5vbihldmVudE5hbWUsIG1ldGhvZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJGVsLm9uKGV2ZW50TmFtZSwgc2VsZWN0b3IsIG1ldGhvZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBDbGVhcnMgYWxsIGNhbGxiYWNrcyBwcmV2aW91c2x5IGJvdW5kIHRvIHRoZSB2aWV3IHdpdGggYGRlbGVnYXRlRXZlbnRzYC4KICAgIC8vIFlvdSB1c3VhbGx5IGRvbid0IG5lZWQgdG8gdXNlIHRoaXMsIGJ1dCBtYXkgd2lzaCB0byBpZiB5b3UgaGF2ZSBtdWx0aXBsZQogICAgLy8gQmFja2JvbmUgdmlld3MgYXR0YWNoZWQgdG8gdGhlIHNhbWUgRE9NIGVsZW1lbnQuCiAgICB1bmRlbGVnYXRlRXZlbnRzOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy4kZWwub2ZmKCcuZGVsZWdhdGVFdmVudHMnICsgdGhpcy5jaWQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRW5zdXJlIHRoYXQgdGhlIFZpZXcgaGFzIGEgRE9NIGVsZW1lbnQgdG8gcmVuZGVyIGludG8uCiAgICAvLyBJZiBgdGhpcy5lbGAgaXMgYSBzdHJpbmcsIHBhc3MgaXQgdGhyb3VnaCBgJCgpYCwgdGFrZSB0aGUgZmlyc3QKICAgIC8vIG1hdGNoaW5nIGVsZW1lbnQsIGFuZCByZS1hc3NpZ24gaXQgdG8gYGVsYC4gT3RoZXJ3aXNlLCBjcmVhdGUKICAgIC8vIGFuIGVsZW1lbnQgZnJvbSB0aGUgYGlkYCwgYGNsYXNzTmFtZWAgYW5kIGB0YWdOYW1lYCBwcm9wZXJ0aWVzLgogICAgX2Vuc3VyZUVsZW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMuZWwpIHsKICAgICAgICB2YXIgYXR0cnMgPSBfLmV4dGVuZCh7fSwgXy5yZXN1bHQodGhpcywgJ2F0dHJpYnV0ZXMnKSk7CiAgICAgICAgaWYgKHRoaXMuaWQpIGF0dHJzLmlkID0gXy5yZXN1bHQodGhpcywgJ2lkJyk7CiAgICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKSBhdHRyc1snY2xhc3MnXSA9IF8ucmVzdWx0KHRoaXMsICdjbGFzc05hbWUnKTsKICAgICAgICB2YXIgJGVsID0gQmFja2JvbmUuJCgnPCcgKyBfLnJlc3VsdCh0aGlzLCAndGFnTmFtZScpICsgJz4nKS5hdHRyKGF0dHJzKTsKICAgICAgICB0aGlzLnNldEVsZW1lbnQoJGVsLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRFbGVtZW50KF8ucmVzdWx0KHRoaXMsICdlbCcpLCBmYWxzZSk7CiAgICAgIH0KICAgIH0KCiAgfSk7CgogIC8vIEJhY2tib25lLnN5bmMKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIE92ZXJyaWRlIHRoaXMgZnVuY3Rpb24gdG8gY2hhbmdlIHRoZSBtYW5uZXIgaW4gd2hpY2ggQmFja2JvbmUgcGVyc2lzdHMKICAvLyBtb2RlbHMgdG8gdGhlIHNlcnZlci4gWW91IHdpbGwgYmUgcGFzc2VkIHRoZSB0eXBlIG9mIHJlcXVlc3QsIGFuZCB0aGUKICAvLyBtb2RlbCBpbiBxdWVzdGlvbi4gQnkgZGVmYXVsdCwgbWFrZXMgYSBSRVNUZnVsIEFqYXggcmVxdWVzdAogIC8vIHRvIHRoZSBtb2RlbCdzIGB1cmwoKWAuIFNvbWUgcG9zc2libGUgY3VzdG9taXphdGlvbnMgY291bGQgYmU6CiAgLy8KICAvLyAqIFVzZSBgc2V0VGltZW91dGAgdG8gYmF0Y2ggcmFwaWQtZmlyZSB1cGRhdGVzIGludG8gYSBzaW5nbGUgcmVxdWVzdC4KICAvLyAqIFNlbmQgdXAgdGhlIG1vZGVscyBhcyBYTUwgaW5zdGVhZCBvZiBKU09OLgogIC8vICogUGVyc2lzdCBtb2RlbHMgdmlhIFdlYlNvY2tldHMgaW5zdGVhZCBvZiBBamF4LgogIC8vCiAgLy8gVHVybiBvbiBgQmFja2JvbmUuZW11bGF0ZUhUVFBgIGluIG9yZGVyIHRvIHNlbmQgYFBVVGAgYW5kIGBERUxFVEVgIHJlcXVlc3RzCiAgLy8gYXMgYFBPU1RgLCB3aXRoIGEgYF9tZXRob2RgIHBhcmFtZXRlciBjb250YWluaW5nIHRoZSB0cnVlIEhUVFAgbWV0aG9kLAogIC8vIGFzIHdlbGwgYXMgYWxsIHJlcXVlc3RzIHdpdGggdGhlIGJvZHkgYXMgYGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZGAKICAvLyBpbnN0ZWFkIG9mIGBhcHBsaWNhdGlvbi9qc29uYCB3aXRoIHRoZSBtb2RlbCBpbiBhIHBhcmFtIG5hbWVkIGBtb2RlbGAuCiAgLy8gVXNlZnVsIHdoZW4gaW50ZXJmYWNpbmcgd2l0aCBzZXJ2ZXItc2lkZSBsYW5ndWFnZXMgbGlrZSAqKlBIUCoqIHRoYXQgbWFrZQogIC8vIGl0IGRpZmZpY3VsdCB0byByZWFkIHRoZSBib2R5IG9mIGBQVVRgIHJlcXVlc3RzLgogIEJhY2tib25lLnN5bmMgPSBmdW5jdGlvbihtZXRob2QsIG1vZGVsLCBvcHRpb25zKSB7CiAgICB2YXIgdHlwZSA9IG1ldGhvZE1hcFttZXRob2RdOwoKICAgIC8vIERlZmF1bHQgb3B0aW9ucywgdW5sZXNzIHNwZWNpZmllZC4KICAgIF8uZGVmYXVsdHMob3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KSwgewogICAgICBlbXVsYXRlSFRUUDogQmFja2JvbmUuZW11bGF0ZUhUVFAsCiAgICAgIGVtdWxhdGVKU09OOiBCYWNrYm9uZS5lbXVsYXRlSlNPTgogICAgfSk7CgogICAgLy8gRGVmYXVsdCBKU09OLXJlcXVlc3Qgb3B0aW9ucy4KICAgIHZhciBwYXJhbXMgPSB7dHlwZTogdHlwZSwgZGF0YVR5cGU6ICdqc29uJ307CgogICAgLy8gRW5zdXJlIHRoYXQgd2UgaGF2ZSBhIFVSTC4KICAgIGlmICghb3B0aW9ucy51cmwpIHsKICAgICAgcGFyYW1zLnVybCA9IF8ucmVzdWx0KG1vZGVsLCAndXJsJykgfHwgdXJsRXJyb3IoKTsKICAgIH0KCiAgICAvLyBFbnN1cmUgdGhhdCB3ZSBoYXZlIHRoZSBhcHByb3ByaWF0ZSByZXF1ZXN0IGRhdGEuCiAgICBpZiAob3B0aW9ucy5kYXRhID09IG51bGwgJiYgbW9kZWwgJiYgKG1ldGhvZCA9PT0gJ2NyZWF0ZScgfHwgbWV0aG9kID09PSAndXBkYXRlJyB8fCBtZXRob2QgPT09ICdwYXRjaCcpKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi9qc29uJzsKICAgICAgcGFyYW1zLmRhdGEgPSBKU09OLnN0cmluZ2lmeShvcHRpb25zLmF0dHJzIHx8IG1vZGVsLnRvSlNPTihvcHRpb25zKSk7CiAgICB9CgogICAgLy8gRm9yIG9sZGVyIHNlcnZlcnMsIGVtdWxhdGUgSlNPTiBieSBlbmNvZGluZyB0aGUgcmVxdWVzdCBpbnRvIGFuIEhUTUwtZm9ybS4KICAgIGlmIChvcHRpb25zLmVtdWxhdGVKU09OKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwogICAgICBwYXJhbXMuZGF0YSA9IHBhcmFtcy5kYXRhID8ge21vZGVsOiBwYXJhbXMuZGF0YX0gOiB7fTsKICAgIH0KCiAgICAvLyBGb3Igb2xkZXIgc2VydmVycywgZW11bGF0ZSBIVFRQIGJ5IG1pbWlja2luZyB0aGUgSFRUUCBtZXRob2Qgd2l0aCBgX21ldGhvZGAKICAgIC8vIEFuZCBhbiBgWC1IVFRQLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgogICAgaWYgKG9wdGlvbnMuZW11bGF0ZUhUVFAgJiYgKHR5cGUgPT09ICdQVVQnIHx8IHR5cGUgPT09ICdERUxFVEUnIHx8IHR5cGUgPT09ICdQQVRDSCcpKSB7CiAgICAgIHBhcmFtcy50eXBlID0gJ1BPU1QnOwogICAgICBpZiAob3B0aW9ucy5lbXVsYXRlSlNPTikgcGFyYW1zLmRhdGEuX21ldGhvZCA9IHR5cGU7CiAgICAgIHZhciBiZWZvcmVTZW5kID0gb3B0aW9ucy5iZWZvcmVTZW5kOwogICAgICBvcHRpb25zLmJlZm9yZVNlbmQgPSBmdW5jdGlvbih4aHIpIHsKICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1IVFRQLU1ldGhvZC1PdmVycmlkZScsIHR5cGUpOwogICAgICAgIGlmIChiZWZvcmVTZW5kKSByZXR1cm4gYmVmb3JlU2VuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfQoKICAgIC8vIERvbid0IHByb2Nlc3MgZGF0YSBvbiBhIG5vbi1HRVQgcmVxdWVzdC4KICAgIGlmIChwYXJhbXMudHlwZSAhPT0gJ0dFVCcgJiYgIW9wdGlvbnMuZW11bGF0ZUpTT04pIHsKICAgICAgcGFyYW1zLnByb2Nlc3NEYXRhID0gZmFsc2U7CiAgICB9CgogICAgLy8gSWYgd2UncmUgc2VuZGluZyBhIGBQQVRDSGAgcmVxdWVzdCwgYW5kIHdlJ3JlIGluIGFuIG9sZCBJbnRlcm5ldCBFeHBsb3JlcgogICAgLy8gdGhhdCBzdGlsbCBoYXMgQWN0aXZlWCBlbmFibGVkIGJ5IGRlZmF1bHQsIG92ZXJyaWRlIGpRdWVyeSB0byB1c2UgdGhhdAogICAgLy8gZm9yIFhIUiBpbnN0ZWFkLiBSZW1vdmUgdGhpcyBsaW5lIHdoZW4galF1ZXJ5IHN1cHBvcnRzIGBQQVRDSGAgb24gSUU4LgogICAgaWYgKHBhcmFtcy50eXBlID09PSAnUEFUQ0gnICYmIG5vWGhyUGF0Y2gpIHsKICAgICAgcGFyYW1zLnhociA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKTsKICAgICAgfTsKICAgIH0KCiAgICAvLyBNYWtlIHRoZSByZXF1ZXN0LCBhbGxvd2luZyB0aGUgdXNlciB0byBvdmVycmlkZSBhbnkgQWpheCBvcHRpb25zLgogICAgdmFyIHhociA9IG9wdGlvbnMueGhyID0gQmFja2JvbmUuYWpheChfLmV4dGVuZChwYXJhbXMsIG9wdGlvbnMpKTsKICAgIG1vZGVsLnRyaWdnZXIoJ3JlcXVlc3QnLCBtb2RlbCwgeGhyLCBvcHRpb25zKTsKICAgIHJldHVybiB4aHI7CiAgfTsKCiAgdmFyIG5vWGhyUGF0Y2ggPQogICAgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgISF3aW5kb3cuQWN0aXZlWE9iamVjdCAmJgogICAgICAhKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCAmJiAobmV3IFhNTEh0dHBSZXF1ZXN0KS5kaXNwYXRjaEV2ZW50KTsKCiAgLy8gTWFwIGZyb20gQ1JVRCB0byBIVFRQIGZvciBvdXIgZGVmYXVsdCBgQmFja2JvbmUuc3luY2AgaW1wbGVtZW50YXRpb24uCiAgdmFyIG1ldGhvZE1hcCA9IHsKICAgICdjcmVhdGUnOiAnUE9TVCcsCiAgICAndXBkYXRlJzogJ1BVVCcsCiAgICAncGF0Y2gnOiAgJ1BBVENIJywKICAgICdkZWxldGUnOiAnREVMRVRFJywKICAgICdyZWFkJzogICAnR0VUJwogIH07CgogIC8vIFNldCB0aGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZiBgQmFja2JvbmUuYWpheGAgdG8gcHJveHkgdGhyb3VnaCB0byBgJGAuCiAgLy8gT3ZlcnJpZGUgdGhpcyBpZiB5b3UnZCBsaWtlIHRvIHVzZSBhIGRpZmZlcmVudCBsaWJyYXJ5LgogIEJhY2tib25lLmFqYXggPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBCYWNrYm9uZS4kLmFqYXguYXBwbHkoQmFja2JvbmUuJCwgYXJndW1lbnRzKTsKICB9OwoKICAvLyBCYWNrYm9uZS5Sb3V0ZXIKICAvLyAtLS0tLS0tLS0tLS0tLS0KCiAgLy8gUm91dGVycyBtYXAgZmF1eC1VUkxzIHRvIGFjdGlvbnMsIGFuZCBmaXJlIGV2ZW50cyB3aGVuIHJvdXRlcyBhcmUKICAvLyBtYXRjaGVkLiBDcmVhdGluZyBhIG5ldyBvbmUgc2V0cyBpdHMgYHJvdXRlc2AgaGFzaCwgaWYgbm90IHNldCBzdGF0aWNhbGx5LgogIHZhciBSb3V0ZXIgPSBCYWNrYm9uZS5Sb3V0ZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgaWYgKG9wdGlvbnMucm91dGVzKSB0aGlzLnJvdXRlcyA9IG9wdGlvbnMucm91dGVzOwogICAgdGhpcy5fYmluZFJvdXRlcygpOwogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKCiAgLy8gQ2FjaGVkIHJlZ3VsYXIgZXhwcmVzc2lvbnMgZm9yIG1hdGNoaW5nIG5hbWVkIHBhcmFtIHBhcnRzIGFuZCBzcGxhdHRlZAogIC8vIHBhcnRzIG9mIHJvdXRlIHN0cmluZ3MuCiAgdmFyIG9wdGlvbmFsUGFyYW0gPSAvXCgoLio/KVwpL2c7CiAgdmFyIG5hbWVkUGFyYW0gICAgPSAvKFwoXD8pPzpcdysvZzsKICB2YXIgc3BsYXRQYXJhbSAgICA9IC9cKlx3Ky9nOwogIHZhciBlc2NhcGVSZWdFeHAgID0gL1tcLXt9XFtcXSs/LixcXFxeJHwjXHNdL2c7CgogIC8vIFNldCB1cCBhbGwgaW5oZXJpdGFibGUgKipCYWNrYm9uZS5Sb3V0ZXIqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKFJvdXRlci5wcm90b3R5cGUsIEV2ZW50cywgewoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gTWFudWFsbHkgYmluZCBhIHNpbmdsZSBuYW1lZCByb3V0ZSB0byBhIGNhbGxiYWNrLiBGb3IgZXhhbXBsZToKICAgIC8vCiAgICAvLyAgICAgdGhpcy5yb3V0ZSgnc2VhcmNoLzpxdWVyeS9wOm51bScsICdzZWFyY2gnLCBmdW5jdGlvbihxdWVyeSwgbnVtKSB7CiAgICAvLyAgICAgICAuLi4KICAgIC8vICAgICB9KTsKICAgIC8vCiAgICByb3V0ZTogZnVuY3Rpb24ocm91dGUsIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIGlmICghXy5pc1JlZ0V4cChyb3V0ZSkpIHJvdXRlID0gdGhpcy5fcm91dGVUb1JlZ0V4cChyb3V0ZSk7CiAgICAgIGlmIChfLmlzRnVuY3Rpb24obmFtZSkpIHsKICAgICAgICBjYWxsYmFjayA9IG5hbWU7CiAgICAgICAgbmFtZSA9ICcnOwogICAgICB9CiAgICAgIGlmICghY2FsbGJhY2spIGNhbGxiYWNrID0gdGhpc1tuYW1lXTsKICAgICAgdmFyIHJvdXRlciA9IHRoaXM7CiAgICAgIEJhY2tib25lLmhpc3Rvcnkucm91dGUocm91dGUsIGZ1bmN0aW9uKGZyYWdtZW50KSB7CiAgICAgICAgdmFyIGFyZ3MgPSByb3V0ZXIuX2V4dHJhY3RQYXJhbWV0ZXJzKHJvdXRlLCBmcmFnbWVudCk7CiAgICAgICAgcm91dGVyLmV4ZWN1dGUoY2FsbGJhY2ssIGFyZ3MpOwogICAgICAgIHJvdXRlci50cmlnZ2VyLmFwcGx5KHJvdXRlciwgWydyb3V0ZTonICsgbmFtZV0uY29uY2F0KGFyZ3MpKTsKICAgICAgICByb3V0ZXIudHJpZ2dlcigncm91dGUnLCBuYW1lLCBhcmdzKTsKICAgICAgICBCYWNrYm9uZS5oaXN0b3J5LnRyaWdnZXIoJ3JvdXRlJywgcm91dGVyLCBuYW1lLCBhcmdzKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBFeGVjdXRlIGEgcm91dGUgaGFuZGxlciB3aXRoIHRoZSBwcm92aWRlZCBwYXJhbWV0ZXJzLiAgVGhpcyBpcyBhbgogICAgLy8gZXhjZWxsZW50IHBsYWNlIHRvIGRvIHByZS1yb3V0ZSBzZXR1cCBvciBwb3N0LXJvdXRlIGNsZWFudXAuCiAgICBleGVjdXRlOiBmdW5jdGlvbihjYWxsYmFjaywgYXJncykgewogICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfSwKCiAgICAvLyBTaW1wbGUgcHJveHkgdG8gYEJhY2tib25lLmhpc3RvcnlgIHRvIHNhdmUgYSBmcmFnbWVudCBpbnRvIHRoZSBoaXN0b3J5LgogICAgbmF2aWdhdGU6IGZ1bmN0aW9uKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUoZnJhZ21lbnQsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gQmluZCBhbGwgZGVmaW5lZCByb3V0ZXMgdG8gYEJhY2tib25lLmhpc3RvcnlgLiBXZSBoYXZlIHRvIHJldmVyc2UgdGhlCiAgICAvLyBvcmRlciBvZiB0aGUgcm91dGVzIGhlcmUgdG8gc3VwcG9ydCBiZWhhdmlvciB3aGVyZSB0aGUgbW9zdCBnZW5lcmFsCiAgICAvLyByb3V0ZXMgY2FuIGJlIGRlZmluZWQgYXQgdGhlIGJvdHRvbSBvZiB0aGUgcm91dGUgbWFwLgogICAgX2JpbmRSb3V0ZXM6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMucm91dGVzKSByZXR1cm47CiAgICAgIHRoaXMucm91dGVzID0gXy5yZXN1bHQodGhpcywgJ3JvdXRlcycpOwogICAgICB2YXIgcm91dGUsIHJvdXRlcyA9IF8ua2V5cyh0aGlzLnJvdXRlcyk7CiAgICAgIHdoaWxlICgocm91dGUgPSByb3V0ZXMucG9wKCkpICE9IG51bGwpIHsKICAgICAgICB0aGlzLnJvdXRlKHJvdXRlLCB0aGlzLnJvdXRlc1tyb3V0ZV0pOwogICAgICB9CiAgICB9LAoKICAgIC8vIENvbnZlcnQgYSByb3V0ZSBzdHJpbmcgaW50byBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgc3VpdGFibGUgZm9yIG1hdGNoaW5nCiAgICAvLyBhZ2FpbnN0IHRoZSBjdXJyZW50IGxvY2F0aW9uIGhhc2guCiAgICBfcm91dGVUb1JlZ0V4cDogZnVuY3Rpb24ocm91dGUpIHsKICAgICAgcm91dGUgPSByb3V0ZS5yZXBsYWNlKGVzY2FwZVJlZ0V4cCwgJ1xcJCYnKQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2Uob3B0aW9uYWxQYXJhbSwgJyg/OiQxKT8nKQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2UobmFtZWRQYXJhbSwgZnVuY3Rpb24obWF0Y2gsIG9wdGlvbmFsKSB7CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25hbCA/IG1hdGNoIDogJyhbXi8/XSspJzsKICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAucmVwbGFjZShzcGxhdFBhcmFtLCAnKFteP10qPyknKTsKICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoJ14nICsgcm91dGUgKyAnKD86XFw/KFtcXHNcXFNdKikpPyQnKTsKICAgIH0sCgogICAgLy8gR2l2ZW4gYSByb3V0ZSwgYW5kIGEgVVJMIGZyYWdtZW50IHRoYXQgaXQgbWF0Y2hlcywgcmV0dXJuIHRoZSBhcnJheSBvZgogICAgLy8gZXh0cmFjdGVkIGRlY29kZWQgcGFyYW1ldGVycy4gRW1wdHkgb3IgdW5tYXRjaGVkIHBhcmFtZXRlcnMgd2lsbCBiZQogICAgLy8gdHJlYXRlZCBhcyBgbnVsbGAgdG8gbm9ybWFsaXplIGNyb3NzLWJyb3dzZXIgYmVoYXZpb3IuCiAgICBfZXh0cmFjdFBhcmFtZXRlcnM6IGZ1bmN0aW9uKHJvdXRlLCBmcmFnbWVudCkgewogICAgICB2YXIgcGFyYW1zID0gcm91dGUuZXhlYyhmcmFnbWVudCkuc2xpY2UoMSk7CiAgICAgIHJldHVybiBfLm1hcChwYXJhbXMsIGZ1bmN0aW9uKHBhcmFtLCBpKSB7CiAgICAgICAgLy8gRG9uJ3QgZGVjb2RlIHRoZSBzZWFyY2ggcGFyYW1zLgogICAgICAgIGlmIChpID09PSBwYXJhbXMubGVuZ3RoIC0gMSkgcmV0dXJuIHBhcmFtIHx8IG51bGw7CiAgICAgICAgcmV0dXJuIHBhcmFtID8gZGVjb2RlVVJJQ29tcG9uZW50KHBhcmFtKSA6IG51bGw7CiAgICAgIH0pOwogICAgfQoKICB9KTsKCiAgLy8gQmFja2JvbmUuSGlzdG9yeQogIC8vIC0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gSGFuZGxlcyBjcm9zcy1icm93c2VyIGhpc3RvcnkgbWFuYWdlbWVudCwgYmFzZWQgb24gZWl0aGVyCiAgLy8gW3B1c2hTdGF0ZV0oaHR0cDovL2RpdmVpbnRvaHRtbDUuaW5mby9oaXN0b3J5Lmh0bWwpIGFuZCByZWFsIFVSTHMsIG9yCiAgLy8gW29uaGFzaGNoYW5nZV0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9ET00vd2luZG93Lm9uaGFzaGNoYW5nZSkKICAvLyBhbmQgVVJMIGZyYWdtZW50cy4gSWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgbmVpdGhlciAob2xkIElFLCBuYXRjaCksCiAgLy8gZmFsbHMgYmFjayB0byBwb2xsaW5nLgogIHZhciBIaXN0b3J5ID0gQmFja2JvbmUuSGlzdG9yeSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5oYW5kbGVycyA9IFtdOwogICAgXy5iaW5kQWxsKHRoaXMsICdjaGVja1VybCcpOwoKICAgIC8vIEVuc3VyZSB0aGF0IGBIaXN0b3J5YCBjYW4gYmUgdXNlZCBvdXRzaWRlIG9mIHRoZSBicm93c2VyLgogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRoaXMubG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb247CiAgICAgIHRoaXMuaGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5OwogICAgfQogIH07CgogIC8vIENhY2hlZCByZWdleCBmb3Igc3RyaXBwaW5nIGEgbGVhZGluZyBoYXNoL3NsYXNoIGFuZCB0cmFpbGluZyBzcGFjZS4KICB2YXIgcm91dGVTdHJpcHBlciA9IC9eWyNcL118XHMrJC9nOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHN0cmlwcGluZyBsZWFkaW5nIGFuZCB0cmFpbGluZyBzbGFzaGVzLgogIHZhciByb290U3RyaXBwZXIgPSAvXlwvK3xcLyskL2c7CgogIC8vIENhY2hlZCByZWdleCBmb3IgZGV0ZWN0aW5nIE1TSUUuCiAgdmFyIGlzRXhwbG9yZXIgPSAvbXNpZSBbXHcuXSsvOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHJlbW92aW5nIGEgdHJhaWxpbmcgc2xhc2guCiAgdmFyIHRyYWlsaW5nU2xhc2ggPSAvXC8kLzsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciBzdHJpcHBpbmcgdXJscyBvZiBoYXNoLgogIHZhciBwYXRoU3RyaXBwZXIgPSAvIy4qJC87CgogIC8vIEhhcyB0aGUgaGlzdG9yeSBoYW5kbGluZyBhbHJlYWR5IGJlZW4gc3RhcnRlZD8KICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLkhpc3RvcnkqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKEhpc3RvcnkucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBpbnRlcnZhbCB0byBwb2xsIGZvciBoYXNoIGNoYW5nZXMsIGlmIG5lY2Vzc2FyeSwgaXMKICAgIC8vIHR3ZW50eSB0aW1lcyBhIHNlY29uZC4KICAgIGludGVydmFsOiA1MCwKCiAgICAvLyBBcmUgd2UgYXQgdGhlIGFwcCByb290PwogICAgYXRSb290OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvW15cL10kLywgJyQmLycpID09PSB0aGlzLnJvb3Q7CiAgICB9LAoKICAgIC8vIEdldHMgdGhlIHRydWUgaGFzaCB2YWx1ZS4gQ2Fubm90IHVzZSBsb2NhdGlvbi5oYXNoIGRpcmVjdGx5IGR1ZSB0byBidWcKICAgIC8vIGluIEZpcmVmb3ggd2hlcmUgbG9jYXRpb24uaGFzaCB3aWxsIGFsd2F5cyBiZSBkZWNvZGVkLgogICAgZ2V0SGFzaDogZnVuY3Rpb24od2luZG93KSB7CiAgICAgIHZhciBtYXRjaCA9ICh3aW5kb3cgfHwgdGhpcykubG9jYXRpb24uaHJlZi5tYXRjaCgvIyguKikkLyk7CiAgICAgIHJldHVybiBtYXRjaCA/IG1hdGNoWzFdIDogJyc7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgY3Jvc3MtYnJvd3NlciBub3JtYWxpemVkIFVSTCBmcmFnbWVudCwgZWl0aGVyIGZyb20gdGhlIFVSTCwKICAgIC8vIHRoZSBoYXNoLCBvciB0aGUgb3ZlcnJpZGUuCiAgICBnZXRGcmFnbWVudDogZnVuY3Rpb24oZnJhZ21lbnQsIGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgIGlmIChmcmFnbWVudCA9PSBudWxsKSB7CiAgICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSB8fCAhdGhpcy5fd2FudHNIYXNoQ2hhbmdlIHx8IGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgICAgICBmcmFnbWVudCA9IGRlY29kZVVSSSh0aGlzLmxvY2F0aW9uLnBhdGhuYW1lICsgdGhpcy5sb2NhdGlvbi5zZWFyY2gpOwogICAgICAgICAgdmFyIHJvb3QgPSB0aGlzLnJvb3QucmVwbGFjZSh0cmFpbGluZ1NsYXNoLCAnJyk7CiAgICAgICAgICBpZiAoIWZyYWdtZW50LmluZGV4T2Yocm9vdCkpIGZyYWdtZW50ID0gZnJhZ21lbnQuc2xpY2Uocm9vdC5sZW5ndGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZnJhZ21lbnQucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICB9LAoKICAgIC8vIFN0YXJ0IHRoZSBoYXNoIGNoYW5nZSBoYW5kbGluZywgcmV0dXJuaW5nIGB0cnVlYCBpZiB0aGUgY3VycmVudCBVUkwgbWF0Y2hlcwogICAgLy8gYW4gZXhpc3Rpbmcgcm91dGUsIGFuZCBgZmFsc2VgIG90aGVyd2lzZS4KICAgIHN0YXJ0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGlmIChIaXN0b3J5LnN0YXJ0ZWQpIHRocm93IG5ldyBFcnJvcigiQmFja2JvbmUuaGlzdG9yeSBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQiKTsKICAgICAgSGlzdG9yeS5zdGFydGVkID0gdHJ1ZTsKCiAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIGluaXRpYWwgY29uZmlndXJhdGlvbi4gRG8gd2UgbmVlZCBhbiBpZnJhbWU/CiAgICAgIC8vIElzIHB1c2hTdGF0ZSBkZXNpcmVkIC4uLiBpcyBpdCBhdmFpbGFibGU/CiAgICAgIHRoaXMub3B0aW9ucyAgICAgICAgICA9IF8uZXh0ZW5kKHtyb290OiAnLyd9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICB0aGlzLnJvb3QgICAgICAgICAgICAgPSB0aGlzLm9wdGlvbnMucm9vdDsKICAgICAgdGhpcy5fd2FudHNIYXNoQ2hhbmdlID0gdGhpcy5vcHRpb25zLmhhc2hDaGFuZ2UgIT09IGZhbHNlOwogICAgICB0aGlzLl93YW50c1B1c2hTdGF0ZSAgPSAhIXRoaXMub3B0aW9ucy5wdXNoU3RhdGU7CiAgICAgIHRoaXMuX2hhc1B1c2hTdGF0ZSAgICA9ICEhKHRoaXMub3B0aW9ucy5wdXNoU3RhdGUgJiYgdGhpcy5oaXN0b3J5ICYmIHRoaXMuaGlzdG9yeS5wdXNoU3RhdGUpOwogICAgICB2YXIgZnJhZ21lbnQgICAgICAgICAgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIHZhciBkb2NNb2RlICAgICAgICAgICA9IGRvY3VtZW50LmRvY3VtZW50TW9kZTsKICAgICAgdmFyIG9sZElFICAgICAgICAgICAgID0gKGlzRXhwbG9yZXIuZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpICYmICghZG9jTW9kZSB8fCBkb2NNb2RlIDw9IDcpKTsKCiAgICAgIC8vIE5vcm1hbGl6ZSByb290IHRvIGFsd2F5cyBpbmNsdWRlIGEgbGVhZGluZyBhbmQgdHJhaWxpbmcgc2xhc2guCiAgICAgIHRoaXMucm9vdCA9ICgnLycgKyB0aGlzLnJvb3QgKyAnLycpLnJlcGxhY2Uocm9vdFN0cmlwcGVyLCAnLycpOwoKICAgICAgaWYgKG9sZElFICYmIHRoaXMuX3dhbnRzSGFzaENoYW5nZSkgewogICAgICAgIHZhciBmcmFtZSA9IEJhY2tib25lLiQoJzxpZnJhbWUgc3JjPSJqYXZhc2NyaXB0OjAiIHRhYmluZGV4PSItMSI+Jyk7CiAgICAgICAgdGhpcy5pZnJhbWUgPSBmcmFtZS5oaWRlKCkuYXBwZW5kVG8oJ2JvZHknKVswXS5jb250ZW50V2luZG93OwogICAgICAgIHRoaXMubmF2aWdhdGUoZnJhZ21lbnQpOwogICAgICB9CgogICAgICAvLyBEZXBlbmRpbmcgb24gd2hldGhlciB3ZSdyZSB1c2luZyBwdXNoU3RhdGUgb3IgaGFzaGVzLCBhbmQgd2hldGhlcgogICAgICAvLyAnb25oYXNoY2hhbmdlJyBpcyBzdXBwb3J0ZWQsIGRldGVybWluZSBob3cgd2UgY2hlY2sgdGhlIFVSTCBzdGF0ZS4KICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSkgewogICAgICAgIEJhY2tib25lLiQod2luZG93KS5vbigncG9wc3RhdGUnLCB0aGlzLmNoZWNrVXJsKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgKCdvbmhhc2hjaGFuZ2UnIGluIHdpbmRvdykgJiYgIW9sZElFKSB7CiAgICAgICAgQmFja2JvbmUuJCh3aW5kb3cpLm9uKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7CiAgICAgICAgdGhpcy5fY2hlY2tVcmxJbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMuY2hlY2tVcmwsIHRoaXMuaW50ZXJ2YWwpOwogICAgICB9CgogICAgICAvLyBEZXRlcm1pbmUgaWYgd2UgbmVlZCB0byBjaGFuZ2UgdGhlIGJhc2UgdXJsLCBmb3IgYSBwdXNoU3RhdGUgbGluawogICAgICAvLyBvcGVuZWQgYnkgYSBub24tcHVzaFN0YXRlIGJyb3dzZXIuCiAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKICAgICAgdmFyIGxvYyA9IHRoaXMubG9jYXRpb247CgogICAgICAvLyBUcmFuc2l0aW9uIGZyb20gaGFzaENoYW5nZSB0byBwdXNoU3RhdGUgb3IgdmljZSB2ZXJzYSBpZiBib3RoIGFyZQogICAgICAvLyByZXF1ZXN0ZWQuCiAgICAgIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgdGhpcy5fd2FudHNQdXNoU3RhdGUpIHsKCiAgICAgICAgLy8gSWYgd2UndmUgc3RhcnRlZCBvZmYgd2l0aCBhIHJvdXRlIGZyb20gYSBgcHVzaFN0YXRlYC1lbmFibGVkCiAgICAgICAgLy8gYnJvd3NlciwgYnV0IHdlJ3JlIGN1cnJlbnRseSBpbiBhIGJyb3dzZXIgdGhhdCBkb2Vzbid0IHN1cHBvcnQgaXQuLi4KICAgICAgICBpZiAoIXRoaXMuX2hhc1B1c2hTdGF0ZSAmJiAhdGhpcy5hdFJvb3QoKSkgewogICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQobnVsbCwgdHJ1ZSk7CiAgICAgICAgICB0aGlzLmxvY2F0aW9uLnJlcGxhY2UodGhpcy5yb290ICsgJyMnICsgdGhpcy5mcmFnbWVudCk7CiAgICAgICAgICAvLyBSZXR1cm4gaW1tZWRpYXRlbHkgYXMgYnJvd3NlciB3aWxsIGRvIHJlZGlyZWN0IHRvIG5ldyB1cmwKICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBPciBpZiB3ZSd2ZSBzdGFydGVkIG91dCB3aXRoIGEgaGFzaC1iYXNlZCByb3V0ZSwgYnV0IHdlJ3JlIGN1cnJlbnRseQogICAgICAgIC8vIGluIGEgYnJvd3NlciB3aGVyZSBpdCBjb3VsZCBiZSBgcHVzaFN0YXRlYC1iYXNlZCBpbnN0ZWFkLi4uCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgJiYgdGhpcy5hdFJvb3QoKSAmJiBsb2MuaGFzaCkgewogICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpLnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgICAgICAgdGhpcy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIHRoaXMucm9vdCArIHRoaXMuZnJhZ21lbnQpOwogICAgICAgIH0KCiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5vcHRpb25zLnNpbGVudCkgcmV0dXJuIHRoaXMubG9hZFVybCgpOwogICAgfSwKCiAgICAvLyBEaXNhYmxlIEJhY2tib25lLmhpc3RvcnksIHBlcmhhcHMgdGVtcG9yYXJpbHkuIE5vdCB1c2VmdWwgaW4gYSByZWFsIGFwcCwKICAgIC8vIGJ1dCBwb3NzaWJseSB1c2VmdWwgZm9yIHVuaXQgdGVzdGluZyBSb3V0ZXJzLgogICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgIEJhY2tib25lLiQod2luZG93KS5vZmYoJ3BvcHN0YXRlJywgdGhpcy5jaGVja1VybCkub2ZmKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIGlmICh0aGlzLl9jaGVja1VybEludGVydmFsKSBjbGVhckludGVydmFsKHRoaXMuX2NoZWNrVXJsSW50ZXJ2YWwpOwogICAgICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKICAgIH0sCgogICAgLy8gQWRkIGEgcm91dGUgdG8gYmUgdGVzdGVkIHdoZW4gdGhlIGZyYWdtZW50IGNoYW5nZXMuIFJvdXRlcyBhZGRlZCBsYXRlcgogICAgLy8gbWF5IG92ZXJyaWRlIHByZXZpb3VzIHJvdXRlcy4KICAgIHJvdXRlOiBmdW5jdGlvbihyb3V0ZSwgY2FsbGJhY2spIHsKICAgICAgdGhpcy5oYW5kbGVycy51bnNoaWZ0KHtyb3V0ZTogcm91dGUsIGNhbGxiYWNrOiBjYWxsYmFja30pOwogICAgfSwKCiAgICAvLyBDaGVja3MgdGhlIGN1cnJlbnQgVVJMIHRvIHNlZSBpZiBpdCBoYXMgY2hhbmdlZCwgYW5kIGlmIGl0IGhhcywKICAgIC8vIGNhbGxzIGBsb2FkVXJsYCwgbm9ybWFsaXppbmcgYWNyb3NzIHRoZSBoaWRkZW4gaWZyYW1lLgogICAgY2hlY2tVcmw6IGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIGlmIChjdXJyZW50ID09PSB0aGlzLmZyYWdtZW50ICYmIHRoaXMuaWZyYW1lKSB7CiAgICAgICAgY3VycmVudCA9IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSk7CiAgICAgIH0KICAgICAgaWYgKGN1cnJlbnQgPT09IHRoaXMuZnJhZ21lbnQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKHRoaXMuaWZyYW1lKSB0aGlzLm5hdmlnYXRlKGN1cnJlbnQpOwogICAgICB0aGlzLmxvYWRVcmwoKTsKICAgIH0sCgogICAgLy8gQXR0ZW1wdCB0byBsb2FkIHRoZSBjdXJyZW50IFVSTCBmcmFnbWVudC4gSWYgYSByb3V0ZSBzdWNjZWVkcyB3aXRoIGEKICAgIC8vIG1hdGNoLCByZXR1cm5zIGB0cnVlYC4gSWYgbm8gZGVmaW5lZCByb3V0ZXMgbWF0Y2hlcyB0aGUgZnJhZ21lbnQsCiAgICAvLyByZXR1cm5zIGBmYWxzZWAuCiAgICBsb2FkVXJsOiBmdW5jdGlvbihmcmFnbWVudCkgewogICAgICBmcmFnbWVudCA9IHRoaXMuZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KGZyYWdtZW50KTsKICAgICAgcmV0dXJuIF8uYW55KHRoaXMuaGFuZGxlcnMsIGZ1bmN0aW9uKGhhbmRsZXIpIHsKICAgICAgICBpZiAoaGFuZGxlci5yb3V0ZS50ZXN0KGZyYWdtZW50KSkgewogICAgICAgICAgaGFuZGxlci5jYWxsYmFjayhmcmFnbWVudCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBTYXZlIGEgZnJhZ21lbnQgaW50byB0aGUgaGFzaCBoaXN0b3J5LCBvciByZXBsYWNlIHRoZSBVUkwgc3RhdGUgaWYgdGhlCiAgICAvLyAncmVwbGFjZScgb3B0aW9uIGlzIHBhc3NlZC4gWW91IGFyZSByZXNwb25zaWJsZSBmb3IgcHJvcGVybHkgVVJMLWVuY29kaW5nCiAgICAvLyB0aGUgZnJhZ21lbnQgaW4gYWR2YW5jZS4KICAgIC8vCiAgICAvLyBUaGUgb3B0aW9ucyBvYmplY3QgY2FuIGNvbnRhaW4gYHRyaWdnZXI6IHRydWVgIGlmIHlvdSB3aXNoIHRvIGhhdmUgdGhlCiAgICAvLyByb3V0ZSBjYWxsYmFjayBiZSBmaXJlZCAobm90IHVzdWFsbHkgZGVzaXJhYmxlKSwgb3IgYHJlcGxhY2U6IHRydWVgLCBpZgogICAgLy8geW91IHdpc2ggdG8gbW9kaWZ5IHRoZSBjdXJyZW50IFVSTCB3aXRob3V0IGFkZGluZyBhbiBlbnRyeSB0byB0aGUgaGlzdG9yeS4KICAgIG5hdmlnYXRlOiBmdW5jdGlvbihmcmFnbWVudCwgb3B0aW9ucykgewogICAgICBpZiAoIUhpc3Rvcnkuc3RhcnRlZCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAoIW9wdGlvbnMgfHwgb3B0aW9ucyA9PT0gdHJ1ZSkgb3B0aW9ucyA9IHt0cmlnZ2VyOiAhIW9wdGlvbnN9OwoKICAgICAgdmFyIHVybCA9IHRoaXMucm9vdCArIChmcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoZnJhZ21lbnQgfHwgJycpKTsKCiAgICAgIC8vIFN0cmlwIHRoZSBoYXNoIGZvciBtYXRjaGluZy4KICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudC5yZXBsYWNlKHBhdGhTdHJpcHBlciwgJycpOwoKICAgICAgaWYgKHRoaXMuZnJhZ21lbnQgPT09IGZyYWdtZW50KSByZXR1cm47CiAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKCiAgICAgIC8vIERvbid0IGluY2x1ZGUgYSB0cmFpbGluZyBzbGFzaCBvbiB0aGUgcm9vdC4KICAgICAgaWYgKGZyYWdtZW50ID09PSAnJyAmJiB1cmwgIT09ICcvJykgdXJsID0gdXJsLnNsaWNlKDAsIC0xKTsKCiAgICAgIC8vIElmIHB1c2hTdGF0ZSBpcyBhdmFpbGFibGUsIHdlIHVzZSBpdCB0byBzZXQgdGhlIGZyYWdtZW50IGFzIGEgcmVhbCBVUkwuCiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHsKICAgICAgICB0aGlzLmhpc3Rvcnlbb3B0aW9ucy5yZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oe30sIGRvY3VtZW50LnRpdGxlLCB1cmwpOwoKICAgICAgLy8gSWYgaGFzaCBjaGFuZ2VzIGhhdmVuJ3QgYmVlbiBleHBsaWNpdGx5IGRpc2FibGVkLCB1cGRhdGUgdGhlIGhhc2gKICAgICAgLy8gZnJhZ21lbnQgdG8gc3RvcmUgaGlzdG9yeS4KICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHsKICAgICAgICB0aGlzLl91cGRhdGVIYXNoKHRoaXMubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIGlmICh0aGlzLmlmcmFtZSAmJiAoZnJhZ21lbnQgIT09IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSkpKSB7CiAgICAgICAgICAvLyBPcGVuaW5nIGFuZCBjbG9zaW5nIHRoZSBpZnJhbWUgdHJpY2tzIElFNyBhbmQgZWFybGllciB0byBwdXNoIGEKICAgICAgICAgIC8vIGhpc3RvcnkgZW50cnkgb24gaGFzaC10YWcgY2hhbmdlLiAgV2hlbiByZXBsYWNlIGlzIHRydWUsIHdlIGRvbid0CiAgICAgICAgICAvLyB3YW50IHRoaXMuCiAgICAgICAgICBpZighb3B0aW9ucy5yZXBsYWNlKSB0aGlzLmlmcmFtZS5kb2N1bWVudC5vcGVuKCkuY2xvc2UoKTsKICAgICAgICAgIHRoaXMuX3VwZGF0ZUhhc2godGhpcy5pZnJhbWUubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIH0KCiAgICAgIC8vIElmIHlvdSd2ZSB0b2xkIHVzIHRoYXQgeW91IGV4cGxpY2l0bHkgZG9uJ3Qgd2FudCBmYWxsYmFjayBoYXNoY2hhbmdlLQogICAgICAvLyBiYXNlZCBoaXN0b3J5LCB0aGVuIGBuYXZpZ2F0ZWAgYmVjb21lcyBhIHBhZ2UgcmVmcmVzaC4KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5sb2NhdGlvbi5hc3NpZ24odXJsKTsKICAgICAgfQogICAgICBpZiAob3B0aW9ucy50cmlnZ2VyKSByZXR1cm4gdGhpcy5sb2FkVXJsKGZyYWdtZW50KTsKICAgIH0sCgogICAgLy8gVXBkYXRlIHRoZSBoYXNoIGxvY2F0aW9uLCBlaXRoZXIgcmVwbGFjaW5nIHRoZSBjdXJyZW50IGVudHJ5LCBvciBhZGRpbmcKICAgIC8vIGEgbmV3IG9uZSB0byB0aGUgYnJvd3NlciBoaXN0b3J5LgogICAgX3VwZGF0ZUhhc2g6IGZ1bmN0aW9uKGxvY2F0aW9uLCBmcmFnbWVudCwgcmVwbGFjZSkgewogICAgICBpZiAocmVwbGFjZSkgewogICAgICAgIHZhciBocmVmID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKC8oamF2YXNjcmlwdDp8IykuKiQvLCAnJyk7CiAgICAgICAgbG9jYXRpb24ucmVwbGFjZShocmVmICsgJyMnICsgZnJhZ21lbnQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNvbWUgYnJvd3NlcnMgcmVxdWlyZSB0aGF0IGBoYXNoYCBjb250YWlucyBhIGxlYWRpbmcgIy4KICAgICAgICBsb2NhdGlvbi5oYXNoID0gJyMnICsgZnJhZ21lbnQ7CiAgICAgIH0KICAgIH0KCiAgfSk7CgogIC8vIENyZWF0ZSB0aGUgZGVmYXVsdCBCYWNrYm9uZS5oaXN0b3J5LgogIEJhY2tib25lLmhpc3RvcnkgPSBuZXcgSGlzdG9yeTsKCiAgLy8gSGVscGVycwogIC8vIC0tLS0tLS0KCiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvcnJlY3RseSBzZXQgdXAgdGhlIHByb3RvdHlwZSBjaGFpbiwgZm9yIHN1YmNsYXNzZXMuCiAgLy8gU2ltaWxhciB0byBgZ29vZy5pbmhlcml0c2AsIGJ1dCB1c2VzIGEgaGFzaCBvZiBwcm90b3R5cGUgcHJvcGVydGllcyBhbmQKICAvLyBjbGFzcyBwcm9wZXJ0aWVzIHRvIGJlIGV4dGVuZGVkLgogIHZhciBleHRlbmQgPSBmdW5jdGlvbihwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgdmFyIHBhcmVudCA9IHRoaXM7CiAgICB2YXIgY2hpbGQ7CgogICAgLy8gVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciB0aGUgbmV3IHN1YmNsYXNzIGlzIGVpdGhlciBkZWZpbmVkIGJ5IHlvdQogICAgLy8gKHRoZSAiY29uc3RydWN0b3IiIHByb3BlcnR5IGluIHlvdXIgYGV4dGVuZGAgZGVmaW5pdGlvbiksIG9yIGRlZmF1bHRlZAogICAgLy8gYnkgdXMgdG8gc2ltcGx5IGNhbGwgdGhlIHBhcmVudCdzIGNvbnN0cnVjdG9yLgogICAgaWYgKHByb3RvUHJvcHMgJiYgXy5oYXMocHJvdG9Qcm9wcywgJ2NvbnN0cnVjdG9yJykpIHsKICAgICAgY2hpbGQgPSBwcm90b1Byb3BzLmNvbnN0cnVjdG9yOwogICAgfSBlbHNlIHsKICAgICAgY2hpbGQgPSBmdW5jdGlvbigpeyByZXR1cm4gcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH07CiAgICB9CgogICAgLy8gQWRkIHN0YXRpYyBwcm9wZXJ0aWVzIHRvIHRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiwgaWYgc3VwcGxpZWQuCiAgICBfLmV4dGVuZChjaGlsZCwgcGFyZW50LCBzdGF0aWNQcm9wcyk7CgogICAgLy8gU2V0IHRoZSBwcm90b3R5cGUgY2hhaW4gdG8gaW5oZXJpdCBmcm9tIGBwYXJlbnRgLCB3aXRob3V0IGNhbGxpbmcKICAgIC8vIGBwYXJlbnRgJ3MgY29uc3RydWN0b3IgZnVuY3Rpb24uCiAgICB2YXIgU3Vycm9nYXRlID0gZnVuY3Rpb24oKXsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9OwogICAgU3Vycm9nYXRlLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7CiAgICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgU3Vycm9nYXRlOwoKICAgIC8vIEFkZCBwcm90b3R5cGUgcHJvcGVydGllcyAoaW5zdGFuY2UgcHJvcGVydGllcykgdG8gdGhlIHN1YmNsYXNzLAogICAgLy8gaWYgc3VwcGxpZWQuCiAgICBpZiAocHJvdG9Qcm9wcykgXy5leHRlbmQoY2hpbGQucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKCiAgICAvLyBTZXQgYSBjb252ZW5pZW5jZSBwcm9wZXJ0eSBpbiBjYXNlIHRoZSBwYXJlbnQncyBwcm90b3R5cGUgaXMgbmVlZGVkCiAgICAvLyBsYXRlci4KICAgIGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7CgogICAgcmV0dXJuIGNoaWxkOwogIH07CgogIC8vIFNldCB1cCBpbmhlcml0YW5jZSBmb3IgdGhlIG1vZGVsLCBjb2xsZWN0aW9uLCByb3V0ZXIsIHZpZXcgYW5kIGhpc3RvcnkuCiAgTW9kZWwuZXh0ZW5kID0gQ29sbGVjdGlvbi5leHRlbmQgPSBSb3V0ZXIuZXh0ZW5kID0gVmlldy5leHRlbmQgPSBIaXN0b3J5LmV4dGVuZCA9IGV4dGVuZDsKCiAgLy8gVGhyb3cgYW4gZXJyb3Igd2hlbiBhIFVSTCBpcyBuZWVkZWQsIGFuZCBub25lIGlzIHN1cHBsaWVkLgogIHZhciB1cmxFcnJvciA9IGZ1bmN0aW9uKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdBICJ1cmwiIHByb3BlcnR5IG9yIGZ1bmN0aW9uIG11c3QgYmUgc3BlY2lmaWVkJyk7CiAgfTsKCiAgLy8gV3JhcCBhbiBvcHRpb25hbCBlcnJvciBjYWxsYmFjayB3aXRoIGEgZmFsbGJhY2sgZXJyb3IgZXZlbnQuCiAgdmFyIHdyYXBFcnJvciA9IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICB2YXIgZXJyb3IgPSBvcHRpb25zLmVycm9yOwogICAgb3B0aW9ucy5lcnJvciA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgaWYgKGVycm9yKSBlcnJvcihtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIG1vZGVsLnRyaWdnZXIoJ2Vycm9yJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgfTsKICB9OwoKICByZXR1cm4gQmFja2JvbmU7Cgp9KSk7CgovKgogKiBhbiBleHBlcmltZW50YWwgbXNtcyBzcGVjdHJ1bQogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwTVNNU1NwZWN0cnVtJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ0NvbmZpZyddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgY29uZmlnKSB7CiAgICB2YXIgRXhwTVNNU1NwZWN0cnVtID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIHVybFJvb3QgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9tc21zc3BlY3RydW0nCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfSwKICAgICAgICBzaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnbW96cycpID09IHVuZGVmaW5lZCkgPyAwIDogc2VsZi5nZXQoJ21venMnKS5sZW5ndGg7CiAgICAgICAgfSwKICAgICAgICBmZXRjaCA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgICAgICB2YXIgdXJsID0gc2VsZi51cmxSb290KCkgKyAnLycgKyBzZWxmLmlkOwogICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJhbXMgJiYgb3B0aW9ucy5wYXJhbXMuZmllbGRzID09PSAncHJlY3Vyc29yT25seScpIHsKICAgICAgICAgICAgICAgIHVybCArPSAnP2ZpZWxkcz1wcmVjdXJzb3JPbmx5JzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkLmdldEpTT04odXJsLCB7fSwgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgZm9yIChrIGluIG0pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldChrLCBtW2tdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2VzcyhzZWxmKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgdmFyIG0gPSAnJzsKICAgICAgICAgICAgICAgIGZvciAoaSBpbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgbSArPSBpICsgJzogJyArIGVbaV0gKyAnICAnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA6ICdGZXRjaGluZ1hIUkV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA6IG0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIG1venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCJtb3pzIik7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiByZXR1cm4gYSBuZXcgRXhwZSBzdGVjdHJ1bSwgd2l0aCBhbGwgZnJhZ21lbnQgcGVha3Mgc2hpZnRlZCBieSBhIGdpdmVuIHZhbHVlCiAgICAgICAgICovCiAgICAgICAgc2hpZnRCeU1veiA6IGZ1bmN0aW9uKGRlbHRhKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNwID0gc2VsZi5jbG9uZSgpOwogICAgICAgICAgICBzcC5zZXQoJ21venMnLCBzZWxmLmdldCgnbW96cycpLm1hcChmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbSArIGRlbHRhCiAgICAgICAgICAgIH0pKQogICAgICAgICAgICByZXR1cm4gc3A7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogYWRkIGFsbCBmcmFnbWVudCBmcm9tIHNwZWN0cnVtIHNwIHRvIHRoZSBjdXJyZW50IG9uZSBhbmQgY3JlYXRlIGEgbmV3IG9uZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlcgogICAgICAgICAqLwogICAgICAgIGNvbmNhdEZyYWdtZW50cyA6IGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNwID0gc2VsZi5jbG9uZSgpOwoKICAgICAgICAgICAgdmFyIGNvbmNhdFBlYWtzID0gXy56aXAoc2VsZi5nZXQoJ21venMnKS5jb25jYXQob3RoZXIuZ2V0KCdtb3pzJykpLCBzZWxmLmdldCgnaW50ZW5zaXRpZXMnKS5jb25jYXQob3RoZXIuZ2V0KCdpbnRlbnNpdGllcycpKSwgc2VsZi5nZXQoJ2ludGVuc2l0eVJhbmtzJykuY29uY2F0KG90aGVyLmdldCgnaW50ZW5zaXR5UmFua3MnKSkpLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGFbMF0gLSBiWzBdCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc3Auc2V0KCdtb3pzJywgXy5wbHVjayhjb25jYXRQZWFrcywgMCkpCiAgICAgICAgICAgIHNwLnNldCgnaW50ZW5zaXRpZXMnLCBfLnBsdWNrKGNvbmNhdFBlYWtzLCAxKSkKICAgICAgICAgICAgc3Auc2V0KCdpbnRlbnNpdHlSYW5rcycsIF8ucGx1Y2soY29uY2F0UGVha3MsIDIpKQoKICAgICAgICAgICAgcmV0dXJuIHNwOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIEV4cE1TTVNTcGVjdHJ1bTsKfSk7CgovKgogKiBqdXN0IGEgY29sbGVjdGlvbiBvZiBFeHBNU01TU3BlY3RydW0gCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9FeHBNU01TU3BlY3RydW0nLCBdLCBmdW5jdGlvbihCYWNrYm9uZSwgRXhwTVNNU1NwZWN0cnVtKSB7CiAgICB2YXIgRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICBtb2RlbCA6IEV4cE1TTVNTcGVjdHJ1bSwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uOwp9KTsKCi8qCiAqIGFuIG1zbXNydW4gY2FuIGJlIG9uZSBvYmplY3QsIHdpdGhlIG1vcmUgb3IgbGVzcyBpbmZvcm1hdGlvbi4gdGhpcyBpbmZvcm1hdGlvbiBjYW4gYmUgcG9wdWxhdGVkIGF0IG9uY2Ugd2l0aCB0aGUgbXNtc3J1biBhcGkgb3IgZW5oYW5jZWQgYWZ0ZXJ3YXJkcyB0aHJvdWdoIHRoZSBtc21zc3BlY3RydW0gZ2V0dGVyczoKICogIC0ganVzdCBydW4gaW5mbyAoaWQgJiBuYW1lKQogKiAgLSBtc21zU3BlY3RyYSBkYXRhLCBidXQgb25seSBhdCB0aGUgcHJlY3Vyc29yIGxldmVsIChtc21zPXRydWUmbm9QZWFrcz10cnVlKQogKiAgLSBvbmx5IHRoZSBrIG1vc3QgaW50ZW5zZSBwZWFrcyAobXNtcz10cnVlJm1heFBlYWtzPWspCiAqIC0gIGFsbCBtc21zIGluZm8gKG1zbXM9dHJ1ZSkKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L01TTVNSdW4nLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnQ29uZmlnJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbiddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgY29uZmlnLCBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKSB7CiAgICB2YXIgTVNNU1J1biA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICB1cmxSb290IDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBjb25maWcuZ2V0KCd3ZXQudXJsLnJlc3QnKSArICcvbXNtc3J1bicKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFwcGx5IHRoZSBjYWxsYmFjayBhcmd1bWVudCBvbiB0aGUgb2JqZWN0LCBidXQgb25seSBpZiBvciBvbmNlIHRoZSBtc21zIGluZm8gaGFzIGJlZW4gbG9hZGVkCiAgICAgICAgICovCiAgICAgICAgd2l0aE1zbXMgOiBmdW5jdGlvbihjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChzZWxmLmdldCgnbXNtcycpKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayhzZWxmKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnJlYWRNc21zSW5mbyh7CiAgICAgICAgICAgICAgICBzdWNjZXNzIDogY2FsbGJhY2sKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqICBsb2FkIG1zbXMgaW5mb3JtYXRpb24sIGJ1dCBubyBwZWFrIGxpc3QKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAqLwogICAgICAgIHJlYWRNc21zSW5mbyA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzCiAgICAgICAgICAgIHZhciB1cmwgPSBzZWxmLnVybFJvb3QoKSArICcvJyArIHNlbGYuZ2V0KCdpZCcpICsgJz9tc21zPXRydWUmbm9QZWFrcz10cnVlJzsKCiAgICAgICAgICAgICQuZ2V0SlNPTih1cmwsIHt9LCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldCgnbXNtcycsIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKGRhdGEubXNtc1NwZWN0cmEpKTsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnN1Y2Nlc3Moc2VsZikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgIH0sCiAgICAgICAgZ2V0TVNNU1N1YkNvbGxlY3Rpb24gOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuaWRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oXy5jb2xsZWN0KG9wdGlvbnMuaWRzLCBmdW5jdGlvbihpZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdtc21zJykuZ2V0KGlkKTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5zY2FuTnVtYmVycykgewogICAgICAgICAgICAgICAgdmFyIGtleXMgPSB7fQogICAgICAgICAgICAgICAgXy5lYWNoKG9wdGlvbnMuc2Nhbk51bWJlcnMsIGZ1bmN0aW9uKHNuKSB7CiAgICAgICAgICAgICAgICAgICAga2V5c1siIiArIHNuXSA9IHRydWU7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKHNlbGYuZ2V0KCdtc21zJykuZmlsdGVyKGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleXNbIiIgKyBzcC5nZXQoJ3NjYW5OdW1iZXInKV07CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ211c3QgZ2V0TVNNU1N1YkNvbGxlY3Rpb24gb24gaWRzIG9yIHNuYU51bWJlcnMgbGlzdCBvZiB2YWxzJykKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBnZXQgdGhlIE1TTVNTdWJDb2xsZWN0aW9ucywgdGhlbiBwb3B1bGF0ZSBpdCB3aXRoIHRoZSBtc21zIHBlYWtsaXN0IGFuZCBjYWxsIGEgc3VjY2VzcyBjYWxsYmFjayBpZiBhbnkKICAgICAgICAgKi8KICAgICAgICBmZXRjaE1TTVMgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNvbCA9IHNlbGYuZ2V0TVNNU1N1YkNvbGxlY3Rpb24ob3B0aW9ucyk7CiAgICAgICAgICAgIHZhciBjb2xOb01TTVMgPSBjb2wuZmlsdGVyKGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3AuZ2V0KCdtb3pzJykgPT0gbnVsbDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBuID0gY29sTm9NU01TLmxlbmd0aDsKICAgICAgICAgICAgaWYgKG4gPT0gMCAmJiBvcHRpb25zLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2Vzcyhjb2wpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNwdCA9IDA7CiAgICAgICAgICAgIF8uZWFjaChjb2xOb01TTVMsIGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICBzcC5mZXRjaCh7CiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjcHQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNwdCA9PSBuICYmIG9wdGlvbnMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKGNvbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogYWx0aG91Z2ggdGhlIG91dGNvbWUgaXMgc2ltaWxhciwgdGhpcyBtZXRoaWQgZGlmZmVycyBmcm9tIGZldGNoTVNNUyh7c2NhbnNOdW1iZXJzOi4uLn0pIGluIHRoZSBzZW5zZSB0aGF0IHdlIGRvbid0IG5lZWQgdG8gbG9hZCB0aGUgZnVsbCBydW4gdG8gdHJhbnNsYXRlIHNjYW4gbnVtYmVyIGludG8gaWRzLi4uCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNjYW5OdW1iZXIKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAqLwogICAgICAgIGZldGNoTVNNU0Zyb21TY2FuTnVtYmVycyA6IGZ1bmN0aW9uKHNjYW5zLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHVybCA9IHNlbGYudXJsUm9vdCgpICsgJy8nICsgc2VsZi5nZXQoJ2lkJykgKyAnL21zbXNmcm9tc2NhbnMvJyArIHNjYW5zLmpvaW4oJywnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICQuZ2V0SlNPTih1cmwsIHt9LCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICB2YXIgY29sID0gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oZGF0YSk7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKHNlbGYsIGNvbCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gTVNNU1J1bjsKfSk7CgovKioKICogYmFzaWMgbWF0aCB1dGlsaXRpZXMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy91dGlscy9NYXRoVXRpbHMnLFsndW5kZXJzY29yZSddLCBmdW5jdGlvbiAoXykgewogICAgdmFyIE1hdGhVdGlscyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICB9CiAgICAvKioKICAgICAqIFNpbXBzb24gaW50ZWdyYXRpb24gb3ZlciB4LHkgdmFsdWVzCiAgICAgKiBAcGFyYW0geAogICAgICogQHBhcmFtIHkKICAgICAqIEByZXR1cm4ge251bWJlcn0KICAgICAqLwogICAgTWF0aFV0aWxzLnByb3RvdHlwZS5pbnRlZ3JhdGUgPSBmdW5jdGlvbiAoeCwgeSkgewogICAgICAgIHZhciBzID0gMC4wOwogICAgICAgIF8udGltZXMoeC5sZW5ndGggLSAxLCBmdW5jdGlvbiAoaSkgewogICAgICAgICAgICBzICs9IDEuMCAqICh4W2kgKyAxXSAtIHhbaV0pICogKHlbaV0gKyB5W2kgKyAxXSkKICAgICAgICB9KQogICAgICAgIHJldHVybiBzIC8gMi4wCiAgICB9CgogICAgLyoqCiAgICAgKiBsaW5lYXIgaW50ZXJwb2xhdGlvbQogICAgICogeHMgJiB5cyBhcmUgdGhlIGtub3duIG1lYXN1cmVzCiAgICAgKiB4cyBtdXN0IGJlIHNvcnRlZCBhbmQgc3RyaWNsdHkgaW5jcmVhc2luZwogICAgICoKICAgICAqIGZvciBhIGdpdmVuIHgsIHJldHVybiB0aGUgeXMnIGludGVycG9sYXRpb24gYmV0d2VlbiB0aGUgdHdvIGNsb3Nlc3Qgc3Vycm91bmRpaW5nIHhzJwogICAgICogYXNraW5nIGZvciBhbiB4IG91dHNpZGUgYm91bmRhcmllcyB3aWxsIHJldHVybiBOYU4KICAgICAqCiAgICAgKiBAcGFyYW0ge09iamVjdH0geHMKICAgICAqIEBwYXJhbSB7T2JqZWN0fSB5cwogICAgICogQHBhcmFtIHtPYmplY3R9IHgKICAgICAqLwogICAgTWF0aFV0aWxzLnByb3RvdHlwZS5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uICh4cywgeXMsIHgpIHsKICAgICAgICB2YXIgbiA9IF8uc2l6ZSh4cykKICAgICAgICBpZiAobiA9PSAwIHx8IHggPCB4c1swXSB8fCB4ID4geHNbbiAtIDFdKSB7CiAgICAgICAgICAgIHJldHVybiBOYU47CiAgICAgICAgfQogICAgICAgIHZhciBpMSA9IDAsIGkyID0gbiAtIDE7CiAgICAgICAgd2hpbGUgKGkyIC0gaTEgPiAxKSB7CiAgICAgICAgICAgIHZhciBpbSA9IE1hdGguZmxvb3IoKGkxICsgaTIpIC8gMikKICAgICAgICAgICAgaWYgKHggPCB4c1tpbV0pIHsKICAgICAgICAgICAgICAgIGkyID0gaW0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGkxID0gaW0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gIHlzW2kxXSArICh4IC0geHNbaTFdKSAvICh4c1tpMl0gLSB4c1tpMV0pICogKHlzW2kyXSAtIHlzW2kxXSkKCiAgICB9CgogICAgcmV0dXJuIG5ldyBNYXRoVXRpbHMoKQp9KTsKCi8qCiAqIEdldCB0aGUgaW5zdHJ1bWVudCBwYXJhbWV0ZXJzLgogKiBNYWlubHk6CiAqIC0gcHJlY3Vyc29yVG9sCiAqIC0gZnJhZ21lbnRUb2wKICogVG9sZXJhbmNlIGFyZSBleHByZXNzZWQgaW4gcHBtCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL3dldC9JbnN0cnVtZW50UGFyYW1zJyxbCiAgICAnQmFja2JvbmUnLAogICAgJ0NvbmZpZycKXSwgZnVuY3Rpb24gKEJhY2tib25lLCBjb25maWcpIHsKICAgIHZhciBJbnN0cnVtZW50UGFyYW1zID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICBmcmFnbWVudFRvbDogdW5kZWZpbmVkLAogICAgICAgICAgICBwcmVjdXJzb3JUb2w6IHVuZGVmaW5lZCwKICAgICAgICB9LAogICAgICAgIHVybDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gY29uZmlnLmdldCgnd2V0LnVybC5yZXN0JykgKyAnL2luc3RydW1lbnRwYXJhbXMvJyArIHRoaXMuZ2V0KCdpZCcpCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuICd0b2w6JyArIHNlbGYuZ2V0KCdwcmVjdXJzb3JUb2wnKSArICcvJyArIHNlbGYuZ2V0KCdmcmFnbWVudFRvbCcpOwogICAgICAgIH0sCiAgICAgICAgdG9Kc29uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHByZWN1cnNvclRvbDogc2VsZi5nZXQoJ3ByZWN1cnNvclRvbCcpLAogICAgICAgICAgICAgICAgZnJhZ21lbnRUb2w6IHNlbGYuZ2V0KCdmcmFnbWVudFRvbCcpCiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgIH0pOwogICAgcmV0dXJuIEluc3RydW1lbnRQYXJhbXM7Cn0pOwoKLyoKICogQ3Jvc3MgSW9uIENocm9tYXRvZ3JhbS4KICogQ29udGFpbnMgbWFpbmx5IHR3byBhcnJheXMgb2YgZmxvYXQ6CiAqIC0gcmV0ZW50aW9uVGltZXMKICogLSBpbnRlbnNpdGllcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvWElDJyxbJ0JhY2tib25lJywgJ0NvbmZpZyddLCBmdW5jdGlvbihCYWNrYm9uZSwgY29uZmlnKSB7CiAgICB2YXIgWElDID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHNpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdyZXRlbnRpb25UaW1lcycpLmxlbmd0aAogICAgICAgIH0sCgogICAgICAgIHRvSlNPTiA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBqc29uID0gWElDLl9fc3VwZXJfXy50b0pTT04uY2FsbChzZWxmKTsKCiAgICAgICAgICAgIGlmKGpzb24ucmljaFNlcXVlbmNlKXsKICAgICAgICAgICAgICAgIGpzb24ucmljaFNlcXVlbmNlID0ganNvbi5yaWNoU2VxdWVuY2UudG9TdHJpbmcoKTsgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vanNvbmlmeSBtZW1lYmVycyAobXNtcywgcmljaFNlcXVlbmNlIGFuZCBjbykKICAgICAgICAgICAgdmFyIGtzID0gXy5rZXlzKGpzb24pCiAgICAgICAgICAgIF8uZWFjaChrcywgZnVuY3Rpb24oayl7CiAgICAgICAgICAgICAgICBpZighICgoanNvbltrXSBpbnN0YW5jZW9mIEJhY2tib25lLk1vZGVsKSB8fCAoanNvbltrXSBpbnN0YW5jZW9mIEJhY2tib25lLkNvbGxlY3Rpb24pKSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBqc29uW2tdID0ganNvbltrXS50b0pTT04oKQogICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm4ganNvbgogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIFhJQzsKfSk7CgovKgogKiBhbiBJbmplY3Rpb24gaGFuZGxlcyBvbmUgZXhwZXJpbWVudGFsIHJ1biAoTVNSdW4pLCB0b2xlcmFuY2VzICwgbmFtZSBldGMuCiAqIEl0IGlzIHR5cGljYWxseSBmZWN0aGVkIGZyb20gYSBzZXJ2ZXIuCiAqIFByb3BlcnRpZXMKICogKiBhIG5hbWUKICogKiBhbiBNU01TUnVuCiAqICogYW4gSW5zdHJ1bWVudFBhcmFtcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvSW5qZWN0aW9uJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ0NvbmZpZycsICdmaXNodG9uZXMvdXRpbHMvTWF0aFV0aWxzJywgJy4vSW5zdHJ1bWVudFBhcmFtcycsICcuL1hJQycsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvTVNNU1J1biddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGNvbmZpZywgbWF0aFV0aWxzLCBJbnN0cnVtZW50UGFyYW1zLCBYSUMsIEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24sIE1TTVNSdW4pIHsKICAgIHZhciBJbmplY3Rpb24gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICB9LAogICAgICAgICAgICB1cmxSb290OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmdldCgnd2V0LnVybC5yZXN0JykgKyAnL2luamVjdGlvbic7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVybHM6IHsKICAgICAgICAgICAgICAgIGNocm9tYXRvWGljOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9jaHJvbWF0by94aWMnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB0aGUgc2V0IG1ldGhvZCBuZWVkcyB0byBiZSBzbGlnaGx0eSBvdmVycmlkZW4sIGJlYWNhdXNlCiAgICAgICAgICAgICAqIC0gYW4gaW5zdHJ1bWVudFBhcmFtcyBhdHRyIHNob3VsZCBiZSBjYXN0IGludG8gYW4gYWN0dWFsIEluc3RydW1lbnRQYXJhbXMKICAgICAgICAgICAgICogLSBhbiBydW5JbmZvIGF0dHIgc2hhbGwgYmUgY2FzdGVkIGludG8gYW4gTVNNU1J1biwgZXZlbmUgaWYgaXQgZG9lcyBub3QgY29udGFpbiBtdWNoCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBhdHRycwogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIC8vbG92ZSB0aGF0LiBhcmd1bWVudCBjYW4gZWl0aGVyIGJlIGEgbWFwIGFuZCBhbiBvYmplY3Qgb3IgYSBrZXkgYW5kIGEgdmFsdWUKICAgICAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKGF0dHJzKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBrID0gYXR0cnM7CiAgICAgICAgICAgICAgICAgICAgYXR0cnMgPSB7fTsKICAgICAgICAgICAgICAgICAgICBhdHRyc1trXSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9tb2RpZnkgZXhpc3RpbmcgaW5zdHJ1bW1lbnQgcGFyYW1zCiAgICAgICAgICAgICAgICBpZiAoYXR0cnMuaW5zdHJ1bWVudFBhcmFtcyAmJiAoIShhdHRycy5pbnN0cnVtZW50UGFyYW1zIGluc3RhbmNlb2YgSW5zdHJ1bWVudFBhcmFtcykpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuZ2V0KCdpbnN0cnVtZW50UGFyYW1zJykgaW5zdGFuY2VvZiBJbnN0cnVtZW50UGFyYW1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdpbnN0cnVtZW50UGFyYW1zJykuc2V0KGF0dHJzLmluc3RydW1lbnRQYXJhbXMpOwogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgYXR0cnMuaW5zdHJ1bWVudFBhcmFtcwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLmluc3RydW1lbnRQYXJhbXMgPSBuZXcgSW5zdHJ1bWVudFBhcmFtcyhhdHRycy5pbnN0cnVtZW50UGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGFuZ2luZyBhbiBlbWJlZGRlZCBpbnN0cnVtZW50IHBhcmFtcyBidWJibGUgdGhlIGV2ZW50Li4uCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLmluc3RydW1lbnRQYXJhbXMub24oJ2NoYW5nZScsIGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdjaGFuZ2VJbnN0cnVtZW50UGFyYW1zJywgY3R4LmNoYW5nZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGF0dHJzLnJ1bkluZm8pIHsKICAgICAgICAgICAgICAgICAgICBhdHRycy5ydW4gPSBuZXcgTVNNU1J1bihhdHRycy5ydW5JbmZvKQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBhdHRycy5ydW5JbmZvCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGFzayBmb3IgYSBYSUMsIGVucmljaGVkIHdpdGggTVNNUyBmb3IgYSBnaXZlbiBtYXNzIGFuZCBjYWxsYmFjayBvbiBzdWNjZXNzCiAgICAgICAgICAgICAqIEFzIHRoZSBpbmplY3Rpb24ga25vdyB0aGUgcHJlY3Vyc29yIHRvbGVyYW5jZSAodmlhIHRoZSBpbnN0cnVtZW50UGFyYW1zKSwgbWFzcyBpcyBlbm91Z2ggdG8gZ2V0IHRoZSBYSUMuCiAgICAgICAgICAgICAqIEBwYXJhbSBtYXNzCiAgICAgICAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAgICAgICAqIEBwYXJhbSBjYWxsYmFjayBhIGZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSByZXR1cm4geGljLiB0aGUgY2FsbCBiYWNrIGNhbiBhbHNvIGJlIHNwZWNpZmllZCB0aHJvdWdoIHRoZSBzdWNjZXNzIG9wdGlvbnMKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGNocm9tYXRvWGljOiBmdW5jdGlvbiAobWFzcywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMyAmJiBvcHRpb25zICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgYnVpbGRNc01zUG9pbnRlcnMgPSBmdW5jdGlvbiAoeGljUlQsIHhpY0ludGVucywgbXNtc1NwZWN0cmEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5tYXAobXNtc1NwZWN0cmEsIGZ1bmN0aW9uIChzcCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcnQgPSBzcC5yZXRlbnRpb25UaW1lOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW50ZW5zID0gbWF0aFV0aWxzLmludGVycG9sYXRlKHhpY1JULCB4aWNJbnRlbnMsIHJ0KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY3RydW06IHNwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGludGVucwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzZWxmLnVybHMuY2hyb21hdG9YaWMoKSArICcvJyArIHNlbGYuZ2V0KCdpZCcpICsgJz9tPScgKyBtYXNzICsgJyZtc21zPXRydWUnOwogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY2hhcmdlKSB7CiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICcmej0nICsgb3B0aW9ucy5jaGFyZ2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1cmwgKz0gJyZwcmVjVG9sPScgKyBzZWxmLmdldCgnaW5zdHJ1bWVudFBhcmFtcycpLmdldCgncHJlY3Vyc29yVG9sJyk7CiAgICAgICAgICAgICAgICAkLmdldEpTT04odXJsLCB7fSwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgeGljID0gbmV3IFhJQygkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hc3M6IG1hc3MKICAgICAgICAgICAgICAgICAgICB9LCBvcHRpb25zKSkKICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdpZCcsIHNlbGYuZ2V0KCdpZCcpICsgJ18nICsgbWFzcykKCiAgICAgICAgICAgICAgICAgICAgLy9iYWNrd2FyZHMgY29tcGF0aWJpbGl0eQogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmV4cFNwZWN0cmEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJzID0gYnVpbGRNc01zUG9pbnRlcnMoZGF0YS5yZXRlbnRpb25UaW1lcywgZGF0YS5pbnRlbnNpdGllcywgZGF0YS5leHBTcGVjdHJhKQogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zJywgbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oXy5wbHVjayhwb2ludGVycywgJ3NwZWN0cnVtJykpKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGljLnNldCgnbXNtc1BvaW50ZXJzJywgcG9pbnRlcnMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtc21zID0gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oZGF0YS5tc21zLmV4cFNwZWN0cmEpOwogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zJywgbXNtcyk7CgogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zUG9pbnRlcnMnLCBfLmNvbGxlY3QoXy56aXAoZGF0YS5tc21zLnNwZWN0cmFJZHMsIGRhdGEubXNtcy5yZXRlbnRpb25UaW1lcywgZGF0YS5tc21zLmludGVuc2l0aWVzKSwgZnVuY3Rpb24gKGEsIGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcCA9IG1zbXMuZ2V0KGFbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjdHJ1bTogc3AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogYVsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGFbMl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgeGljLnNldCgncmV0ZW50aW9uVGltZXMnLCBkYXRhLnJldGVudGlvblRpbWVzKQogICAgICAgICAgICAgICAgICAgIHhpYy5zZXQoJ2ludGVuc2l0aWVzJywgZGF0YS5pbnRlbnNpdGllcykKCiAgICAgICAgICAgICAgICAgICAgeGljLnNldCgnaW5qZWN0aW9uSW5mbycsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHNlbGYuZ2V0KCdpZCcpLAogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hJZDogc2VsZi5nZXQoJ3NlYXJjaElkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlbGYuZ2V0KCduYW1lJykKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soeGljKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIDsKICAgIHJldHVybiBJbmplY3Rpb247Cn0pCjsKCi8qCiAqIGp1c3QgYSBjb2xsZWN0aW9uIG9mIEluamVjdGlvbgogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvSW5qZWN0aW9uQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9JbmplY3Rpb24nLCBdLCBmdW5jdGlvbihCYWNrYm9uZSwgSW5qZWN0aW9uKSB7CiAgICB2YXIgSW5qZWN0aW9uQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICBtb2RlbCA6IEluamVjdGlvbiwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBJbmplY3Rpb25Db2xsZWN0aW9uOwp9KTsKCgovKgogKiBBbiBleHBlcmltZW50IGNvbnRhaW5zIG1haW5seSBhIGxpc3Qgb2YgaW5qZWN0aW9ucyAoYWNxdWlyZWQgc2FtcGxlcykKICogUHJvcGVydGllczoKICogLSBpbmplY3Rpb246IGFycmF5IG9mIEluamVjdGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwZXJpbWVudCcsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvSW5qZWN0aW9uJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvSW5qZWN0aW9uQ29sbGVjdGlvbiddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGNvbmZpZywgSW5qZWN0aW9uLCBJbmplY3Rpb25Db2xsZWN0aW9uKSB7CiAgICB2YXIgRXhwZXJpbWVudCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIHVybFJvb3Q6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9leHBlcmltZW50JwogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAvL2xvdmUgdGhhdC4gYXJndW1lbnQgY2FuIGVpdGhlciBiZSBhIG1hcCBhbmQgYW4gb2JqZWN0IG9yIGEga2V5IGFuZCBhIHZhbHVlCiAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKGF0dHJzKSkgewogICAgICAgICAgICAgICAgdmFyIGsgPSBhdHRyczsKICAgICAgICAgICAgICAgIGF0dHJzID0ge307CiAgICAgICAgICAgICAgICBhdHRyc1trXSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9tb2RpZnkgZXhpc3RpbmcgSW5qZWN0aW9uIHBhcmFtcwogICAgICAgICAgICBpZiAoYXR0cnMuaW5qZWN0aW9ucyAmJiAoIShhdHRycy5pbmplY3Rpb25zIGluc3RhbmNlb2YgSW5qZWN0aW9uQ29sbGVjdGlvbikpKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXQoJ2luamVjdGlvbnMnKSBpbnN0YW5jZW9mIEluamVjdGlvbkNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmdldCgnaW5qZWN0aW9ucycpLnJlc2V0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0KCdpbmplY3Rpb25zJywgbmV3IEluamVjdGlvbkNvbGxlY3Rpb24oKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmdldCgnaW5qZWN0aW9ucycpLmFkZChfLmNvbGxlY3QoYXR0cnMuaW5qZWN0aW9ucywgZnVuY3Rpb24gKHBpbmopIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEluamVjdGlvbihwaW5qKQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgZGVsZXRlIGF0dHJzLmluamVjdGlvbnMKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFkZCBhbiBpbmplY3Rpb24gdG8gdGhlIGxpc3QuCiAgICAgICAgICogQHBhcmFtIGluagogICAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAgICogQHJldHVybiB7RXhwZXJpbWVudH0KICAgICAgICAgKi8KICAgICAgICBpbmplY3Rpb25zX2FkZDogZnVuY3Rpb24gKGluaiwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYuZ2V0KCdpbmplY3Rpb25zJykuYWRkKGluaikKICAgICAgICAgICAgaWYgKG9wdGlvbnMuc2F2ZSkgewogICAgICAgICAgICAgICAgdmFyIHVybCA9IHNlbGYudXJsUm9vdCgpICsgJy8nICsgc2VsZi5nZXQoJ2lkJykgKyAnL2luamVjdGlvbnMvJyArIGluai5nZXQoJ2lkJyk7CiAgICAgICAgICAgICAgICAkLmFqYXgodXJsLCB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BVVCcsCiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzczogb3B0aW9ucy5zdWNjZXNzCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBFeHBlcmltZW50Owp9KTsKCi8qCiAqIGp1c3QgYSBjb2xsZWN0aW9uIG9mIFhJQywgd2l0aCBhbiBhdHRhY2hlZCBjb2xsZWN0aW9uIGxlZ2VuZCBjb250YWluZXIKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9YSUMnXSwgZnVuY3Rpb24oQmFja2JvbmUsIFhJQykgewogIHZhciBYSUNDb2xsZWN0aW9uTGVnZW5kID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgIGRlZmF1bHRzIDogewoKICAgIH0sCiAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuX2xlZ2VuZHMgPSBbXTsKICAgIH0sCiAgICByZXNldCA6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLl9sZWdlbmRzLmxlbmd0aCA9IDA7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlIDp7CiAgICAgKiAgIG5hbWU6IHBlcHRpZGUgbmFtZQogICAgICogICBtYXNzZXM6IFtdIGFycmF5IG9mIG1hc3Nlcywgd2hlcmUgbWFzc2VzW2ldIGlzIHRoZSBtYXNzIGZvciBjaGFyZ2UgaQogICAgICogfQogICAgICovCiAgICBhZGQgOiBmdW5jdGlvbihlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLl9sZWdlbmRzLnB1c2goewogICAgICAgIG5hbWUgOiBlLm5hbWUgfHwgJ24vYScsCiAgICAgICAgbWFzc2VzIDogZS5tYXNzZXMgfHwgW10KICAgICAgfSk7CiAgICAgIF90aGlzLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICByZXR1cm4gX3RoaXM7CiAgICB9LAogICAgc2l6ZSA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVnZW5kcy5sZW5ndGg7CiAgICB9LAogICAgbGlzdCA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVnZW5kczsKICAgIH0KICB9KTsKCiAgdmFyIFhJQ0NvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICBtb2RlbCA6IFhJQywKICAgIGRlZmF1bHRzIDogewogICAgfSwKICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLmxlZ2VuZHMgPSBuZXcgWElDQ29sbGVjdGlvbkxlZ2VuZCgpOwogICAgfQogIH0pOwoKICByZXR1cm4gWElDQ29sbGVjdGlvbjsKfSk7CgohZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdCl7cmV0dXJuIHQ+bj8tMTpuPnQ/MTpuPj10PzA6MC8wfWZ1bmN0aW9uIHQobil7cmV0dXJuIG51bGwhPW4mJiFpc05hTihuKX1mdW5jdGlvbiBlKG4pe3JldHVybntsZWZ0OmZ1bmN0aW9uKHQsZSxyLHUpe2Zvcihhcmd1bWVudHMubGVuZ3RoPDMmJihyPTApLGFyZ3VtZW50cy5sZW5ndGg8NCYmKHU9dC5sZW5ndGgpO3U+cjspe3ZhciBpPXIrdT4+PjE7bih0W2ldLGUpPDA/cj1pKzE6dT1pfXJldHVybiByfSxyaWdodDpmdW5jdGlvbih0LGUscix1KXtmb3IoYXJndW1lbnRzLmxlbmd0aDwzJiYocj0wKSxhcmd1bWVudHMubGVuZ3RoPDQmJih1PXQubGVuZ3RoKTt1PnI7KXt2YXIgaT1yK3U+Pj4xO24odFtpXSxlKT4wP3U9aTpyPWkrMX1yZXR1cm4gcn19fWZ1bmN0aW9uIHIobil7cmV0dXJuIG4ubGVuZ3RofWZ1bmN0aW9uIHUobil7Zm9yKHZhciB0PTE7bip0JTE7KXQqPTEwO3JldHVybiB0fWZ1bmN0aW9uIGkobix0KXt0cnl7Zm9yKHZhciBlIGluIHQpT2JqZWN0LmRlZmluZVByb3BlcnR5KG4ucHJvdG90eXBlLGUse3ZhbHVlOnRbZV0sZW51bWVyYWJsZTohMX0pfWNhdGNoKHIpe24ucHJvdG90eXBlPXR9fWZ1bmN0aW9uIG8oKXt9ZnVuY3Rpb24gYShuKXtyZXR1cm4gaGErbiBpbiB0aGlzfWZ1bmN0aW9uIGMobil7cmV0dXJuIG49aGErbixuIGluIHRoaXMmJmRlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIHMoKXt2YXIgbj1bXTtyZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHQpe24ucHVzaCh0KX0pLG59ZnVuY3Rpb24gbCgpe3ZhciBuPTA7Zm9yKHZhciB0IGluIHRoaXMpdC5jaGFyQ29kZUF0KDApPT09Z2EmJisrbjtyZXR1cm4gbn1mdW5jdGlvbiBmKCl7Zm9yKHZhciBuIGluIHRoaXMpaWYobi5jaGFyQ29kZUF0KDApPT09Z2EpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gaCgpe31mdW5jdGlvbiBnKG4sdCxlKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgcj1lLmFwcGx5KHQsYXJndW1lbnRzKTtyZXR1cm4gcj09PXQ/bjpyfX1mdW5jdGlvbiBwKG4sdCl7aWYodCBpbiBuKXJldHVybiB0O3Q9dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0LnN1YnN0cmluZygxKTtmb3IodmFyIGU9MCxyPXBhLmxlbmd0aDtyPmU7KytlKXt2YXIgdT1wYVtlXSt0O2lmKHUgaW4gbilyZXR1cm4gdX19ZnVuY3Rpb24gdigpe31mdW5jdGlvbiBkKCl7fWZ1bmN0aW9uIG0obil7ZnVuY3Rpb24gdCgpe2Zvcih2YXIgdCxyPWUsdT0tMSxpPXIubGVuZ3RoOysrdTxpOykodD1yW3VdLm9uKSYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIG59dmFyIGU9W10scj1uZXcgbztyZXR1cm4gdC5vbj1mdW5jdGlvbih0LHUpe3ZhciBpLG89ci5nZXQodCk7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj9vJiZvLm9uOihvJiYoby5vbj1udWxsLGU9ZS5zbGljZSgwLGk9ZS5pbmRleE9mKG8pKS5jb25jYXQoZS5zbGljZShpKzEpKSxyLnJlbW92ZSh0KSksdSYmZS5wdXNoKHIuc2V0KHQse29uOnV9KSksbil9LHR9ZnVuY3Rpb24geSgpe0dvLmV2ZW50LnByZXZlbnREZWZhdWx0KCl9ZnVuY3Rpb24geCgpe2Zvcih2YXIgbix0PUdvLmV2ZW50O249dC5zb3VyY2VFdmVudDspdD1uO3JldHVybiB0fWZ1bmN0aW9uIE0obil7Zm9yKHZhciB0PW5ldyBkLGU9MCxyPWFyZ3VtZW50cy5sZW5ndGg7KytlPHI7KXRbYXJndW1lbnRzW2VdXT1tKHQpO3JldHVybiB0Lm9mPWZ1bmN0aW9uKGUscil7cmV0dXJuIGZ1bmN0aW9uKHUpe3RyeXt2YXIgaT11LnNvdXJjZUV2ZW50PUdvLmV2ZW50O3UudGFyZ2V0PW4sR28uZXZlbnQ9dSx0W3UudHlwZV0uYXBwbHkoZSxyKX1maW5hbGx5e0dvLmV2ZW50PWl9fX0sdH1mdW5jdGlvbiBfKG4pe3JldHVybiBkYShuLF9hKSxufWZ1bmN0aW9uIGIobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBtYShuLHRoaXMpfX1mdW5jdGlvbiB3KG4pe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBuP246ZnVuY3Rpb24oKXtyZXR1cm4geWEobix0aGlzKX19ZnVuY3Rpb24gUyhuLHQpe2Z1bmN0aW9uIGUoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZShuKX1mdW5jdGlvbiByKCl7dGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpfWZ1bmN0aW9uIHUoKXt0aGlzLnNldEF0dHJpYnV0ZShuLHQpfWZ1bmN0aW9uIGkoKXt0aGlzLnNldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCx0KX1mdW5jdGlvbiBvKCl7dmFyIGU9dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7bnVsbD09ZT90aGlzLnJlbW92ZUF0dHJpYnV0ZShuKTp0aGlzLnNldEF0dHJpYnV0ZShuLGUpfWZ1bmN0aW9uIGEoKXt2YXIgZT10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtudWxsPT1lP3RoaXMucmVtb3ZlQXR0cmlidXRlTlMobi5zcGFjZSxuLmxvY2FsKTp0aGlzLnNldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCxlKX1yZXR1cm4gbj1Hby5ucy5xdWFsaWZ5KG4pLG51bGw9PXQ/bi5sb2NhbD9yOmU6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/bi5sb2NhbD9hOm86bi5sb2NhbD9pOnV9ZnVuY3Rpb24gayhuKXtyZXR1cm4gbi50cmltKCkucmVwbGFjZSgvXHMrL2csIiAiKX1mdW5jdGlvbiBFKG4pe3JldHVybiBuZXcgUmVnRXhwKCIoPzpefFxccyspIitHby5yZXF1b3RlKG4pKyIoPzpcXHMrfCQpIiwiZyIpfWZ1bmN0aW9uIE4obil7cmV0dXJuIG4udHJpbSgpLnNwbGl0KC9efFxzKy8pfWZ1bmN0aW9uIEEobix0KXtmdW5jdGlvbiBlKCl7Zm9yKHZhciBlPS0xOysrZTx1OyluW2VdKHRoaXMsdCl9ZnVuY3Rpb24gcigpe2Zvcih2YXIgZT0tMSxyPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpOysrZTx1OyluW2VdKHRoaXMscil9bj1OKG4pLm1hcChDKTt2YXIgdT1uLmxlbmd0aDtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdD9yOmV9ZnVuY3Rpb24gQyhuKXt2YXIgdD1FKG4pO3JldHVybiBmdW5jdGlvbihlLHIpe2lmKHU9ZS5jbGFzc0xpc3QpcmV0dXJuIHI/dS5hZGQobik6dS5yZW1vdmUobik7dmFyIHU9ZS5nZXRBdHRyaWJ1dGUoImNsYXNzIil8fCIiO3I/KHQubGFzdEluZGV4PTAsdC50ZXN0KHUpfHxlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLGsodSsiICIrbikpKTplLnNldEF0dHJpYnV0ZSgiY2xhc3MiLGsodS5yZXBsYWNlKHQsIiAiKSkpfX1mdW5jdGlvbiBMKG4sdCxlKXtmdW5jdGlvbiByKCl7dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKX1mdW5jdGlvbiB1KCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLHQsZSl9ZnVuY3Rpb24gaSgpe3ZhciByPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PXI/dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKTp0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4scixlKX1yZXR1cm4gbnVsbD09dD9yOiJmdW5jdGlvbiI9PXR5cGVvZiB0P2k6dX1mdW5jdGlvbiBUKG4sdCl7ZnVuY3Rpb24gZSgpe2RlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIHIoKXt0aGlzW25dPXR9ZnVuY3Rpb24gdSgpe3ZhciBlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PWU/ZGVsZXRlIHRoaXNbbl06dGhpc1tuXT1lfXJldHVybiBudWxsPT10P2U6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dTpyfWZ1bmN0aW9uIHEobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjoobj1Hby5ucy5xdWFsaWZ5KG4pKS5sb2NhbD9mdW5jdGlvbigpe3JldHVybiB0aGlzLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG4uc3BhY2Usbi5sb2NhbCl9OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50TlModGhpcy5uYW1lc3BhY2VVUkksbil9fWZ1bmN0aW9uIHoobil7cmV0dXJue19fZGF0YV9fOm59fWZ1bmN0aW9uIFIobil7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIE1hKHRoaXMsbil9fWZ1bmN0aW9uIEQodCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGh8fCh0PW4pLGZ1bmN0aW9uKG4sZSl7cmV0dXJuIG4mJmU/dChuLl9fZGF0YV9fLGUuX19kYXRhX18pOiFuLSFlfX1mdW5jdGlvbiBQKG4sdCl7Zm9yKHZhciBlPTAscj1uLmxlbmd0aDtyPmU7ZSsrKWZvcih2YXIgdSxpPW5bZV0sbz0wLGE9aS5sZW5ndGg7YT5vO28rKykodT1pW29dKSYmdCh1LG8sZSk7cmV0dXJuIG59ZnVuY3Rpb24gVShuKXtyZXR1cm4gZGEobix3YSksbn1mdW5jdGlvbiBqKG4pe3ZhciB0LGU7cmV0dXJuIGZ1bmN0aW9uKHIsdSxpKXt2YXIgbyxhPW5baV0udXBkYXRlLGM9YS5sZW5ndGg7Zm9yKGkhPWUmJihlPWksdD0wKSx1Pj10JiYodD11KzEpOyEobz1hW3RdKSYmKyt0PGM7KTtyZXR1cm4gb319ZnVuY3Rpb24gSCgpe3ZhciBuPXRoaXMuX190cmFuc2l0aW9uX187biYmKytuLmFjdGl2ZX1mdW5jdGlvbiBGKG4sdCxlKXtmdW5jdGlvbiByKCl7dmFyIHQ9dGhpc1tvXTt0JiYodGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKG4sdCx0LiQpLGRlbGV0ZSB0aGlzW29dKX1mdW5jdGlvbiB1KCl7dmFyIHU9Yyh0LFFvKGFyZ3VtZW50cykpO3IuY2FsbCh0aGlzKSx0aGlzLmFkZEV2ZW50TGlzdGVuZXIobix0aGlzW29dPXUsdS4kPWUpLHUuXz10fWZ1bmN0aW9uIGkoKXt2YXIgdCxlPW5ldyBSZWdFeHAoIl5fX29uKFteLl0rKSIrR28ucmVxdW90ZShuKSsiJCIpO2Zvcih2YXIgciBpbiB0aGlzKWlmKHQ9ci5tYXRjaChlKSl7dmFyIHU9dGhpc1tyXTt0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIodFsxXSx1LHUuJCksZGVsZXRlIHRoaXNbcl19fXZhciBvPSJfX29uIituLGE9bi5pbmRleE9mKCIuIiksYz1PO2E+MCYmKG49bi5zdWJzdHJpbmcoMCxhKSk7dmFyIHM9a2EuZ2V0KG4pO3JldHVybiBzJiYobj1zLGM9WSksYT90P3U6cjp0P3Y6aX1mdW5jdGlvbiBPKG4sdCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPUdvLmV2ZW50O0dvLmV2ZW50PWUsdFswXT10aGlzLl9fZGF0YV9fO3RyeXtuLmFwcGx5KHRoaXMsdCl9ZmluYWxseXtHby5ldmVudD1yfX19ZnVuY3Rpb24gWShuLHQpe3ZhciBlPU8obix0KTtyZXR1cm4gZnVuY3Rpb24obil7dmFyIHQ9dGhpcyxyPW4ucmVsYXRlZFRhcmdldDtyJiYocj09PXR8fDgmci5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbih0KSl8fGUuY2FsbCh0LG4pfX1mdW5jdGlvbiBJKCl7dmFyIG49Ii5kcmFnc3VwcHJlc3MtIisgKytOYSx0PSJjbGljayIrbixlPUdvLnNlbGVjdChlYSkub24oInRvdWNobW92ZSIrbix5KS5vbigiZHJhZ3N0YXJ0IituLHkpLm9uKCJzZWxlY3RzdGFydCIrbix5KTtpZihFYSl7dmFyIHI9dGEuc3R5bGUsdT1yW0VhXTtyW0VhXT0ibm9uZSJ9cmV0dXJuIGZ1bmN0aW9uKGkpe2Z1bmN0aW9uIG8oKXtlLm9uKHQsbnVsbCl9ZS5vbihuLG51bGwpLEVhJiYocltFYV09dSksaSYmKGUub24odCxmdW5jdGlvbigpe3koKSxvKCl9LCEwKSxzZXRUaW1lb3V0KG8sMCkpfX1mdW5jdGlvbiBaKG4sdCl7dC5jaGFuZ2VkVG91Y2hlcyYmKHQ9dC5jaGFuZ2VkVG91Y2hlc1swXSk7dmFyIGU9bi5vd25lclNWR0VsZW1lbnR8fG47aWYoZS5jcmVhdGVTVkdQb2ludCl7dmFyIHI9ZS5jcmVhdGVTVkdQb2ludCgpO3JldHVybiByLng9dC5jbGllbnRYLHIueT10LmNsaWVudFkscj1yLm1hdHJpeFRyYW5zZm9ybShuLmdldFNjcmVlbkNUTSgpLmludmVyc2UoKSksW3IueCxyLnldfXZhciB1PW4uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7cmV0dXJuW3QuY2xpZW50WC11LmxlZnQtbi5jbGllbnRMZWZ0LHQuY2xpZW50WS11LnRvcC1uLmNsaWVudFRvcF19ZnVuY3Rpb24gVigpe3JldHVybiBHby5ldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5pZGVudGlmaWVyfWZ1bmN0aW9uICQoKXtyZXR1cm4gR28uZXZlbnQudGFyZ2V0fWZ1bmN0aW9uIFgoKXtyZXR1cm4gZWF9ZnVuY3Rpb24gQihuKXtyZXR1cm4gbj4wPzE6MD5uPy0xOjB9ZnVuY3Rpb24gSihuLHQsZSl7cmV0dXJuKHRbMF0tblswXSkqKGVbMV0tblsxXSktKHRbMV0tblsxXSkqKGVbMF0tblswXSl9ZnVuY3Rpb24gVyhuKXtyZXR1cm4gbj4xPzA6LTE+bj9BYTpNYXRoLmFjb3Mobil9ZnVuY3Rpb24gRyhuKXtyZXR1cm4gbj4xP0xhOi0xPm4/LUxhOk1hdGguYXNpbihuKX1mdW5jdGlvbiBLKG4pe3JldHVybigobj1NYXRoLmV4cChuKSktMS9uKS8yfWZ1bmN0aW9uIFEobil7cmV0dXJuKChuPU1hdGguZXhwKG4pKSsxL24pLzJ9ZnVuY3Rpb24gbnQobil7cmV0dXJuKChuPU1hdGguZXhwKDIqbikpLTEpLyhuKzEpfWZ1bmN0aW9uIHR0KG4pe3JldHVybihuPU1hdGguc2luKG4vMikpKm59ZnVuY3Rpb24gZXQoKXt9ZnVuY3Rpb24gcnQobix0LGUpe3JldHVybiBuZXcgdXQobix0LGUpfWZ1bmN0aW9uIHV0KG4sdCxlKXt0aGlzLmg9bix0aGlzLnM9dCx0aGlzLmw9ZX1mdW5jdGlvbiBpdChuLHQsZSl7ZnVuY3Rpb24gcihuKXtyZXR1cm4gbj4zNjA/bi09MzYwOjA+biYmKG4rPTM2MCksNjA+bj9pKyhvLWkpKm4vNjA6MTgwPm4/bzoyNDA+bj9pKyhvLWkpKigyNDAtbikvNjA6aX1mdW5jdGlvbiB1KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSpyKG4pKX12YXIgaSxvO3JldHVybiBuPWlzTmFOKG4pPzA6KG4lPTM2MCk8MD9uKzM2MDpuLHQ9aXNOYU4odCk/MDowPnQ/MDp0PjE/MTp0LGU9MD5lPzA6ZT4xPzE6ZSxvPS41Pj1lP2UqKDErdCk6ZSt0LWUqdCxpPTIqZS1vLHl0KHUobisxMjApLHUobiksdShuLTEyMCkpfWZ1bmN0aW9uIG90KG4sdCxlKXtyZXR1cm4gbmV3IGF0KG4sdCxlKX1mdW5jdGlvbiBhdChuLHQsZSl7dGhpcy5oPW4sdGhpcy5jPXQsdGhpcy5sPWV9ZnVuY3Rpb24gY3Qobix0LGUpe3JldHVybiBpc05hTihuKSYmKG49MCksaXNOYU4odCkmJih0PTApLHN0KGUsTWF0aC5jb3Mobio9emEpKnQsTWF0aC5zaW4obikqdCl9ZnVuY3Rpb24gc3Qobix0LGUpe3JldHVybiBuZXcgbHQobix0LGUpfWZ1bmN0aW9uIGx0KG4sdCxlKXt0aGlzLmw9bix0aGlzLmE9dCx0aGlzLmI9ZX1mdW5jdGlvbiBmdChuLHQsZSl7dmFyIHI9KG4rMTYpLzExNix1PXIrdC81MDAsaT1yLWUvMjAwO3JldHVybiB1PWd0KHUpKlphLHI9Z3QocikqVmEsaT1ndChpKSokYSx5dCh2dCgzLjI0MDQ1NDIqdS0xLjUzNzEzODUqci0uNDk4NTMxNCppKSx2dCgtLjk2OTI2Nip1KzEuODc2MDEwOCpyKy4wNDE1NTYqaSksdnQoLjA1NTY0MzQqdS0uMjA0MDI1OSpyKzEuMDU3MjI1MippKSl9ZnVuY3Rpb24gaHQobix0LGUpe3JldHVybiBuPjA/b3QoTWF0aC5hdGFuMihlLHQpKlJhLE1hdGguc3FydCh0KnQrZSplKSxuKTpvdCgwLzAsMC8wLG4pfWZ1bmN0aW9uIGd0KG4pe3JldHVybiBuPi4yMDY4OTMwMzQ/bipuKm46KG4tNC8yOSkvNy43ODcwMzd9ZnVuY3Rpb24gcHQobil7cmV0dXJuIG4+LjAwODg1Nj9NYXRoLnBvdyhuLDEvMyk6Ny43ODcwMzcqbis0LzI5fWZ1bmN0aW9uIHZ0KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSooLjAwMzA0Pj1uPzEyLjkyKm46MS4wNTUqTWF0aC5wb3cobiwxLzIuNCktLjA1NSkpfWZ1bmN0aW9uIGR0KG4pe3JldHVybiB5dChuPj4xNiwyNTUmbj4+OCwyNTUmbil9ZnVuY3Rpb24gbXQobil7cmV0dXJuIGR0KG4pKyIifWZ1bmN0aW9uIHl0KG4sdCxlKXtyZXR1cm4gbmV3IHh0KG4sdCxlKX1mdW5jdGlvbiB4dChuLHQsZSl7dGhpcy5yPW4sdGhpcy5nPXQsdGhpcy5iPWV9ZnVuY3Rpb24gTXQobil7cmV0dXJuIDE2Pm4/IjAiK01hdGgubWF4KDAsbikudG9TdHJpbmcoMTYpOk1hdGgubWluKDI1NSxuKS50b1N0cmluZygxNil9ZnVuY3Rpb24gX3Qobix0LGUpe3ZhciByLHUsaSxvPTAsYT0wLGM9MDtpZihyPS8oW2Etel0rKVwoKC4qKVwpL2kuZXhlYyhuKSlzd2l0Y2godT1yWzJdLnNwbGl0KCIsIiksclsxXSl7Y2FzZSJoc2wiOnJldHVybiBlKHBhcnNlRmxvYXQodVswXSkscGFyc2VGbG9hdCh1WzFdKS8xMDAscGFyc2VGbG9hdCh1WzJdKS8xMDApO2Nhc2UicmdiIjpyZXR1cm4gdChrdCh1WzBdKSxrdCh1WzFdKSxrdCh1WzJdKSl9cmV0dXJuKGk9SmEuZ2V0KG4pKT90KGkucixpLmcsaS5iKToobnVsbD09bnx8IiMiIT09bi5jaGFyQXQoMCl8fGlzTmFOKGk9cGFyc2VJbnQobi5zdWJzdHJpbmcoMSksMTYpKXx8KDQ9PT1uLmxlbmd0aD8obz0oMzg0MCZpKT4+NCxvPW8+PjR8byxhPTI0MCZpLGE9YT4+NHxhLGM9MTUmaSxjPWM8PDR8Yyk6Nz09PW4ubGVuZ3RoJiYobz0oMTY3MTE2ODAmaSk+PjE2LGE9KDY1MjgwJmkpPj44LGM9MjU1JmkpKSx0KG8sYSxjKSl9ZnVuY3Rpb24gYnQobix0LGUpe3ZhciByLHUsaT1NYXRoLm1pbihuLz0yNTUsdC89MjU1LGUvPTI1NSksbz1NYXRoLm1heChuLHQsZSksYT1vLWksYz0obytpKS8yO3JldHVybiBhPyh1PS41PmM/YS8obytpKTphLygyLW8taSkscj1uPT1vPyh0LWUpL2ErKGU+dD82OjApOnQ9PW8/KGUtbikvYSsyOihuLXQpL2ErNCxyKj02MCk6KHI9MC8wLHU9Yz4wJiYxPmM/MDpyKSxydChyLHUsYyl9ZnVuY3Rpb24gd3Qobix0LGUpe249U3QobiksdD1TdCh0KSxlPVN0KGUpO3ZhciByPXB0KCguNDEyNDU2NCpuKy4zNTc1NzYxKnQrLjE4MDQzNzUqZSkvWmEpLHU9cHQoKC4yMTI2NzI5Km4rLjcxNTE1MjIqdCsuMDcyMTc1KmUpL1ZhKSxpPXB0KCguMDE5MzMzOSpuKy4xMTkxOTIqdCsuOTUwMzA0MSplKS8kYSk7cmV0dXJuIHN0KDExNip1LTE2LDUwMCooci11KSwyMDAqKHUtaSkpfWZ1bmN0aW9uIFN0KG4pe3JldHVybihuLz0yNTUpPD0uMDQwNDU/bi8xMi45MjpNYXRoLnBvdygobisuMDU1KS8xLjA1NSwyLjQpfWZ1bmN0aW9uIGt0KG4pe3ZhciB0PXBhcnNlRmxvYXQobik7cmV0dXJuIiUiPT09bi5jaGFyQXQobi5sZW5ndGgtMSk/TWF0aC5yb3VuZCgyLjU1KnQpOnR9ZnVuY3Rpb24gRXQobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBufX1mdW5jdGlvbiBOdChuKXtyZXR1cm4gbn1mdW5jdGlvbiBBdChuKXtyZXR1cm4gZnVuY3Rpb24odCxlLHIpe3JldHVybiAyPT09YXJndW1lbnRzLmxlbmd0aCYmImZ1bmN0aW9uIj09dHlwZW9mIGUmJihyPWUsZT1udWxsKSxDdCh0LGUsbixyKX19ZnVuY3Rpb24gQ3Qobix0LGUscil7ZnVuY3Rpb24gdSgpe3ZhciBuLHQ9Yy5zdGF0dXM7aWYoIXQmJmMucmVzcG9uc2VUZXh0fHx0Pj0yMDAmJjMwMD50fHwzMDQ9PT10KXt0cnl7bj1lLmNhbGwoaSxjKX1jYXRjaChyKXtyZXR1cm4gby5lcnJvci5jYWxsKGksciksdm9pZCAwfW8ubG9hZC5jYWxsKGksbil9ZWxzZSBvLmVycm9yLmNhbGwoaSxjKX12YXIgaT17fSxvPUdvLmRpc3BhdGNoKCJiZWZvcmVzZW5kIiwicHJvZ3Jlc3MiLCJsb2FkIiwiZXJyb3IiKSxhPXt9LGM9bmV3IFhNTEh0dHBSZXF1ZXN0LHM9bnVsbDtyZXR1cm4hZWEuWERvbWFpblJlcXVlc3R8fCJ3aXRoQ3JlZGVudGlhbHMiaW4gY3x8IS9eKGh0dHAocyk/Oik/XC9cLy8udGVzdChuKXx8KGM9bmV3IFhEb21haW5SZXF1ZXN0KSwib25sb2FkImluIGM/Yy5vbmxvYWQ9Yy5vbmVycm9yPXU6Yy5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU+MyYmdSgpfSxjLm9ucHJvZ3Jlc3M9ZnVuY3Rpb24obil7dmFyIHQ9R28uZXZlbnQ7R28uZXZlbnQ9bjt0cnl7by5wcm9ncmVzcy5jYWxsKGksYyl9ZmluYWxseXtHby5ldmVudD10fX0saS5oZWFkZXI9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj0obisiIikudG9Mb3dlckNhc2UoKSxhcmd1bWVudHMubGVuZ3RoPDI/YVtuXToobnVsbD09dD9kZWxldGUgYVtuXTphW25dPXQrIiIsaSl9LGkubWltZVR5cGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bnVsbD09bj9udWxsOm4rIiIsaSk6dH0saS5yZXNwb25zZVR5cGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bixpKTpzfSxpLnJlc3BvbnNlPWZ1bmN0aW9uKG4pe3JldHVybiBlPW4saX0sWyJnZXQiLCJwb3N0Il0uZm9yRWFjaChmdW5jdGlvbihuKXtpW25dPWZ1bmN0aW9uKCl7cmV0dXJuIGkuc2VuZC5hcHBseShpLFtuXS5jb25jYXQoUW8oYXJndW1lbnRzKSkpfX0pLGkuc2VuZD1mdW5jdGlvbihlLHIsdSl7aWYoMj09PWFyZ3VtZW50cy5sZW5ndGgmJiJmdW5jdGlvbiI9PXR5cGVvZiByJiYodT1yLHI9bnVsbCksYy5vcGVuKGUsbiwhMCksbnVsbD09dHx8ImFjY2VwdCJpbiBhfHwoYS5hY2NlcHQ9dCsiLCovKiIpLGMuc2V0UmVxdWVzdEhlYWRlcilmb3IodmFyIGwgaW4gYSljLnNldFJlcXVlc3RIZWFkZXIobCxhW2xdKTtyZXR1cm4gbnVsbCE9dCYmYy5vdmVycmlkZU1pbWVUeXBlJiZjLm92ZXJyaWRlTWltZVR5cGUodCksbnVsbCE9cyYmKGMucmVzcG9uc2VUeXBlPXMpLG51bGwhPXUmJmkub24oImVycm9yIix1KS5vbigibG9hZCIsZnVuY3Rpb24obil7dShudWxsLG4pfSksby5iZWZvcmVzZW5kLmNhbGwoaSxjKSxjLnNlbmQobnVsbD09cj9udWxsOnIpLGl9LGkuYWJvcnQ9ZnVuY3Rpb24oKXtyZXR1cm4gYy5hYm9ydCgpLGl9LEdvLnJlYmluZChpLG8sIm9uIiksbnVsbD09cj9pOmkuZ2V0KEx0KHIpKX1mdW5jdGlvbiBMdChuKXtyZXR1cm4gMT09PW4ubGVuZ3RoP2Z1bmN0aW9uKHQsZSl7bihudWxsPT10P2U6bnVsbCl9Om59ZnVuY3Rpb24gVHQoKXt2YXIgbj1xdCgpLHQ9enQoKS1uO3Q+MjQ/KGlzRmluaXRlKHQpJiYoY2xlYXJUaW1lb3V0KFFhKSxRYT1zZXRUaW1lb3V0KFR0LHQpKSxLYT0wKTooS2E9MSx0YyhUdCkpfWZ1bmN0aW9uIHF0KCl7dmFyIG49RGF0ZS5ub3coKTtmb3IobmM9V2E7bmM7KW4+PW5jLnQmJihuYy5mPW5jLmMobi1uYy50KSksbmM9bmMubjtyZXR1cm4gbn1mdW5jdGlvbiB6dCgpe2Zvcih2YXIgbix0PVdhLGU9MS8wO3Q7KXQuZj90PW4/bi5uPXQubjpXYT10Lm46KHQudDxlJiYoZT10LnQpLHQ9KG49dCkubik7cmV0dXJuIEdhPW4sZX1mdW5jdGlvbiBSdChuLHQpe3JldHVybiB0LShuP01hdGguY2VpbChNYXRoLmxvZyhuKS9NYXRoLkxOMTApOjEpfWZ1bmN0aW9uIER0KG4sdCl7dmFyIGU9TWF0aC5wb3coMTAsMypmYSg4LXQpKTtyZXR1cm57c2NhbGU6dD44P2Z1bmN0aW9uKG4pe3JldHVybiBuL2V9OmZ1bmN0aW9uKG4pe3JldHVybiBuKmV9LHN5bWJvbDpufX1mdW5jdGlvbiBQdChuKXt2YXIgdD1uLmRlY2ltYWwsZT1uLnRob3VzYW5kcyxyPW4uZ3JvdXBpbmcsdT1uLmN1cnJlbmN5LGk9cj9mdW5jdGlvbihuKXtmb3IodmFyIHQ9bi5sZW5ndGgsdT1bXSxpPTAsbz1yWzBdO3Q+MCYmbz4wOyl1LnB1c2gobi5zdWJzdHJpbmcodC09byx0K28pKSxvPXJbaT0oaSsxKSVyLmxlbmd0aF07cmV0dXJuIHUucmV2ZXJzZSgpLmpvaW4oZSl9Ok50O3JldHVybiBmdW5jdGlvbihuKXt2YXIgZT1yYy5leGVjKG4pLHI9ZVsxXXx8IiAiLG89ZVsyXXx8Ij4iLGE9ZVszXXx8IiIsYz1lWzRdfHwiIixzPWVbNV0sbD0rZVs2XSxmPWVbN10saD1lWzhdLGc9ZVs5XSxwPTEsdj0iIixkPSIiLG09ITE7c3dpdGNoKGgmJihoPStoLnN1YnN0cmluZygxKSksKHN8fCIwIj09PXImJiI9Ij09PW8pJiYocz1yPSIwIixvPSI9IixmJiYobC09TWF0aC5mbG9vcigobC0xKS80KSkpLGcpe2Nhc2UibiI6Zj0hMCxnPSJnIjticmVhaztjYXNlIiUiOnA9MTAwLGQ9IiUiLGc9ImYiO2JyZWFrO2Nhc2UicCI6cD0xMDAsZD0iJSIsZz0iciI7YnJlYWs7Y2FzZSJiIjpjYXNlIm8iOmNhc2UieCI6Y2FzZSJYIjoiIyI9PT1jJiYodj0iMCIrZy50b0xvd2VyQ2FzZSgpKTtjYXNlImMiOmNhc2UiZCI6bT0hMCxoPTA7YnJlYWs7Y2FzZSJzIjpwPS0xLGc9InIifSIkIj09PWMmJih2PXVbMF0sZD11WzFdKSwiciIhPWd8fGh8fChnPSJnIiksbnVsbCE9aCYmKCJnIj09Zz9oPU1hdGgubWF4KDEsTWF0aC5taW4oMjEsaCkpOigiZSI9PWd8fCJmIj09ZykmJihoPU1hdGgubWF4KDAsTWF0aC5taW4oMjAsaCkpKSksZz11Yy5nZXQoZyl8fFV0O3ZhciB5PXMmJmY7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciBlPWQ7aWYobSYmbiUxKXJldHVybiIiO3ZhciB1PTA+bnx8MD09PW4mJjA+MS9uPyhuPS1uLCItIik6YTtpZigwPnApe3ZhciBjPUdvLmZvcm1hdFByZWZpeChuLGgpO249Yy5zY2FsZShuKSxlPWMuc3ltYm9sK2R9ZWxzZSBuKj1wO249ZyhuLGgpO3ZhciB4PW4ubGFzdEluZGV4T2YoIi4iKSxNPTA+eD9uOm4uc3Vic3RyaW5nKDAseCksXz0wPng/IiI6dCtuLnN1YnN0cmluZyh4KzEpOyFzJiZmJiYoTT1pKE0pKTt2YXIgYj12Lmxlbmd0aCtNLmxlbmd0aCtfLmxlbmd0aCsoeT8wOnUubGVuZ3RoKSx3PWw+Yj9uZXcgQXJyYXkoYj1sLWIrMSkuam9pbihyKToiIjtyZXR1cm4geSYmKE09aSh3K00pKSx1Kz12LG49TStfLCgiPCI9PT1vP3Urbit3OiI+Ij09PW8/dyt1K246Il4iPT09bz93LnN1YnN0cmluZygwLGI+Pj0xKSt1K24rdy5zdWJzdHJpbmcoYik6dSsoeT9uOncrbikpK2V9fX1mdW5jdGlvbiBVdChuKXtyZXR1cm4gbisiIn1mdW5jdGlvbiBqdCgpe3RoaXMuXz1uZXcgRGF0ZShhcmd1bWVudHMubGVuZ3RoPjE/RGF0ZS5VVEMuYXBwbHkodGhpcyxhcmd1bWVudHMpOmFyZ3VtZW50c1swXSl9ZnVuY3Rpb24gSHQobix0LGUpe2Z1bmN0aW9uIHIodCl7dmFyIGU9bih0KSxyPWkoZSwxKTtyZXR1cm4gci10PnQtZT9lOnJ9ZnVuY3Rpb24gdShlKXtyZXR1cm4gdChlPW4obmV3IG9jKGUtMSkpLDEpLGV9ZnVuY3Rpb24gaShuLGUpe3JldHVybiB0KG49bmV3IG9jKCtuKSxlKSxufWZ1bmN0aW9uIG8obixyLGkpe3ZhciBvPXUobiksYT1bXTtpZihpPjEpZm9yKDtyPm87KWUobyklaXx8YS5wdXNoKG5ldyBEYXRlKCtvKSksdChvLDEpO2Vsc2UgZm9yKDtyPm87KWEucHVzaChuZXcgRGF0ZSgrbykpLHQobywxKTtyZXR1cm4gYX1mdW5jdGlvbiBhKG4sdCxlKXt0cnl7b2M9anQ7dmFyIHI9bmV3IGp0O3JldHVybiByLl89bixvKHIsdCxlKX1maW5hbGx5e29jPURhdGV9fW4uZmxvb3I9bixuLnJvdW5kPXIsbi5jZWlsPXUsbi5vZmZzZXQ9aSxuLnJhbmdlPW87dmFyIGM9bi51dGM9RnQobik7cmV0dXJuIGMuZmxvb3I9YyxjLnJvdW5kPUZ0KHIpLGMuY2VpbD1GdCh1KSxjLm9mZnNldD1GdChpKSxjLnJhbmdlPWEsbn1mdW5jdGlvbiBGdChuKXtyZXR1cm4gZnVuY3Rpb24odCxlKXt0cnl7b2M9anQ7dmFyIHI9bmV3IGp0O3JldHVybiByLl89dCxuKHIsZSkuX31maW5hbGx5e29jPURhdGV9fX1mdW5jdGlvbiBPdChuKXtmdW5jdGlvbiB0KG4pe2Z1bmN0aW9uIHQodCl7Zm9yKHZhciBlLHUsaSxvPVtdLGE9LTEsYz0wOysrYTxyOykzNz09PW4uY2hhckNvZGVBdChhKSYmKG8ucHVzaChuLnN1YnN0cmluZyhjLGEpKSxudWxsIT0odT1jY1tlPW4uY2hhckF0KCsrYSldKSYmKGU9bi5jaGFyQXQoKythKSksKGk9QVtlXSkmJihlPWkodCxudWxsPT11PyJlIj09PWU/IiAiOiIwIjp1KSksby5wdXNoKGUpLGM9YSsxKTtyZXR1cm4gby5wdXNoKG4uc3Vic3RyaW5nKGMsYSkpLG8uam9pbigiIil9dmFyIHI9bi5sZW5ndGg7cmV0dXJuIHQucGFyc2U9ZnVuY3Rpb24odCl7dmFyIHI9e3k6MTkwMCxtOjAsZDoxLEg6MCxNOjAsUzowLEw6MCxaOm51bGx9LHU9ZShyLG4sdCwwKTtpZih1IT10Lmxlbmd0aClyZXR1cm4gbnVsbDsicCJpbiByJiYoci5IPXIuSCUxMisxMipyLnApO3ZhciBpPW51bGwhPXIuWiYmb2MhPT1qdCxvPW5ldyhpP2p0Om9jKTtyZXR1cm4iaiJpbiByP28uc2V0RnVsbFllYXIoci55LDAsci5qKToidyJpbiByJiYoIlciaW4gcnx8IlUiaW4gcik/KG8uc2V0RnVsbFllYXIoci55LDAsMSksby5zZXRGdWxsWWVhcihyLnksMCwiVyJpbiByPyhyLncrNiklNys3KnIuVy0oby5nZXREYXkoKSs1KSU3OnIudys3KnIuVS0oby5nZXREYXkoKSs2KSU3KSk6by5zZXRGdWxsWWVhcihyLnksci5tLHIuZCksby5zZXRIb3VycyhyLkgrTWF0aC5mbG9vcihyLlovMTAwKSxyLk0rci5aJTEwMCxyLlMsci5MKSxpP28uXzpvfSx0LnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIG59LHR9ZnVuY3Rpb24gZShuLHQsZSxyKXtmb3IodmFyIHUsaSxvLGE9MCxjPXQubGVuZ3RoLHM9ZS5sZW5ndGg7Yz5hOyl7aWYocj49cylyZXR1cm4tMTtpZih1PXQuY2hhckNvZGVBdChhKyspLDM3PT09dSl7aWYobz10LmNoYXJBdChhKyspLGk9Q1tvIGluIGNjP3QuY2hhckF0KGErKyk6b10sIWl8fChyPWkobixlLHIpKTwwKXJldHVybi0xfWVsc2UgaWYodSE9ZS5jaGFyQ29kZUF0KHIrKykpcmV0dXJuLTF9cmV0dXJuIHJ9ZnVuY3Rpb24gcihuLHQsZSl7Yi5sYXN0SW5kZXg9MDt2YXIgcj1iLmV4ZWModC5zdWJzdHJpbmcoZSkpO3JldHVybiByPyhuLnc9dy5nZXQoclswXS50b0xvd2VyQ2FzZSgpKSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB1KG4sdCxlKXtNLmxhc3RJbmRleD0wO3ZhciByPU0uZXhlYyh0LnN1YnN0cmluZyhlKSk7cmV0dXJuIHI/KG4udz1fLmdldChyWzBdLnRvTG93ZXJDYXNlKCkpLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGkobix0LGUpe0UubGFzdEluZGV4PTA7dmFyIHI9RS5leGVjKHQuc3Vic3RyaW5nKGUpKTtyZXR1cm4gcj8obi5tPU4uZ2V0KHJbMF0udG9Mb3dlckNhc2UoKSksZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gbyhuLHQsZSl7Uy5sYXN0SW5kZXg9MDt2YXIgcj1TLmV4ZWModC5zdWJzdHJpbmcoZSkpO3JldHVybiByPyhuLm09ay5nZXQoclswXS50b0xvd2VyQ2FzZSgpKSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBhKG4sdCxyKXtyZXR1cm4gZShuLEEuYy50b1N0cmluZygpLHQscil9ZnVuY3Rpb24gYyhuLHQscil7cmV0dXJuIGUobixBLngudG9TdHJpbmcoKSx0LHIpfWZ1bmN0aW9uIHMobix0LHIpe3JldHVybiBlKG4sQS5YLnRvU3RyaW5nKCksdCxyKX1mdW5jdGlvbiBsKG4sdCxlKXt2YXIgcj14LmdldCh0LnN1YnN0cmluZyhlLGUrPTIpLnRvTG93ZXJDYXNlKCkpO3JldHVybiBudWxsPT1yPy0xOihuLnA9cixlKX12YXIgZj1uLmRhdGVUaW1lLGg9bi5kYXRlLGc9bi50aW1lLHA9bi5wZXJpb2RzLHY9bi5kYXlzLGQ9bi5zaG9ydERheXMsbT1uLm1vbnRocyx5PW4uc2hvcnRNb250aHM7dC51dGM9ZnVuY3Rpb24obil7ZnVuY3Rpb24gZShuKXt0cnl7b2M9anQ7dmFyIHQ9bmV3IG9jO3JldHVybiB0Ll89bixyKHQpfWZpbmFsbHl7b2M9RGF0ZX19dmFyIHI9dChuKTtyZXR1cm4gZS5wYXJzZT1mdW5jdGlvbihuKXt0cnl7b2M9anQ7dmFyIHQ9ci5wYXJzZShuKTtyZXR1cm4gdCYmdC5ffWZpbmFsbHl7b2M9RGF0ZX19LGUudG9TdHJpbmc9ci50b1N0cmluZyxlfSx0Lm11bHRpPXQudXRjLm11bHRpPWFlO3ZhciB4PUdvLm1hcCgpLE09SXQodiksXz1adCh2KSxiPUl0KGQpLHc9WnQoZCksUz1JdChtKSxrPVp0KG0pLEU9SXQoeSksTj1adCh5KTtwLmZvckVhY2goZnVuY3Rpb24obix0KXt4LnNldChuLnRvTG93ZXJDYXNlKCksdCl9KTt2YXIgQT17YTpmdW5jdGlvbihuKXtyZXR1cm4gZFtuLmdldERheSgpXX0sQTpmdW5jdGlvbihuKXtyZXR1cm4gdltuLmdldERheSgpXX0sYjpmdW5jdGlvbihuKXtyZXR1cm4geVtuLmdldE1vbnRoKCldfSxCOmZ1bmN0aW9uKG4pe3JldHVybiBtW24uZ2V0TW9udGgoKV19LGM6dChmKSxkOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFl0KG4uZ2V0RGF0ZSgpLHQsMil9LGU6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQobi5nZXREYXRlKCksdCwyKX0sSDpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldEhvdXJzKCksdCwyKX0sSTpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldEhvdXJzKCklMTJ8fDEyLHQsMil9LGo6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQoMStpYy5kYXlPZlllYXIobiksdCwzKX0sTDpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldE1pbGxpc2Vjb25kcygpLHQsMyl9LG06ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQobi5nZXRNb250aCgpKzEsdCwyKX0sTTpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldE1pbnV0ZXMoKSx0LDIpfSxwOmZ1bmN0aW9uKG4pe3JldHVybiBwWysobi5nZXRIb3VycygpPj0xMildfSxTOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFl0KG4uZ2V0U2Vjb25kcygpLHQsMil9LFU6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQoaWMuc3VuZGF5T2ZZZWFyKG4pLHQsMil9LHc6ZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF5KCl9LFc6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQoaWMubW9uZGF5T2ZZZWFyKG4pLHQsMil9LHg6dChoKSxYOnQoZykseTpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldEZ1bGxZZWFyKCklMTAwLHQsMil9LFk6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQobi5nZXRGdWxsWWVhcigpJTFlNCx0LDQpfSxaOmllLCIlIjpmdW5jdGlvbigpe3JldHVybiIlIn19LEM9e2E6cixBOnUsYjppLEI6byxjOmEsZDpRdCxlOlF0LEg6dGUsSTp0ZSxqOm5lLEw6dWUsbTpLdCxNOmVlLHA6bCxTOnJlLFU6JHQsdzpWdCxXOlh0LHg6YyxYOnMseTpKdCxZOkJ0LFo6V3QsIiUiOm9lfTtyZXR1cm4gdH1mdW5jdGlvbiBZdChuLHQsZSl7dmFyIHI9MD5uPyItIjoiIix1PShyPy1uOm4pKyIiLGk9dS5sZW5ndGg7cmV0dXJuIHIrKGU+aT9uZXcgQXJyYXkoZS1pKzEpLmpvaW4odCkrdTp1KX1mdW5jdGlvbiBJdChuKXtyZXR1cm4gbmV3IFJlZ0V4cCgiXig/OiIrbi5tYXAoR28ucmVxdW90ZSkuam9pbigifCIpKyIpIiwiaSIpfWZ1bmN0aW9uIFp0KG4pe2Zvcih2YXIgdD1uZXcgbyxlPS0xLHI9bi5sZW5ndGg7KytlPHI7KXQuc2V0KG5bZV0udG9Mb3dlckNhc2UoKSxlKTtyZXR1cm4gdH1mdW5jdGlvbiBWdChuLHQsZSl7c2MubGFzdEluZGV4PTA7dmFyIHI9c2MuZXhlYyh0LnN1YnN0cmluZyhlLGUrMSkpO3JldHVybiByPyhuLnc9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gJHQobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSkpO3JldHVybiByPyhuLlU9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gWHQobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSkpO3JldHVybiByPyhuLlc9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gQnQobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSxlKzQpKTtyZXR1cm4gcj8obi55PStyWzBdLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIEp0KG4sdCxlKXtzYy5sYXN0SW5kZXg9MDt2YXIgcj1zYy5leGVjKHQuc3Vic3RyaW5nKGUsZSsyKSk7cmV0dXJuIHI/KG4ueT1HdCgrclswXSksZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gV3Qobix0LGUpe3JldHVybi9eWystXVxkezR9JC8udGVzdCh0PXQuc3Vic3RyaW5nKGUsZSs1KSk/KG4uWj0rdCxlKzUpOi0xfWZ1bmN0aW9uIEd0KG4pe3JldHVybiBuKyhuPjY4PzE5MDA6MmUzKX1mdW5jdGlvbiBLdChuLHQsZSl7c2MubGFzdEluZGV4PTA7dmFyIHI9c2MuZXhlYyh0LnN1YnN0cmluZyhlLGUrMikpO3JldHVybiByPyhuLm09clswXS0xLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIFF0KG4sdCxlKXtzYy5sYXN0SW5kZXg9MDt2YXIgcj1zYy5leGVjKHQuc3Vic3RyaW5nKGUsZSsyKSk7cmV0dXJuIHI/KG4uZD0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBuZShuLHQsZSl7c2MubGFzdEluZGV4PTA7dmFyIHI9c2MuZXhlYyh0LnN1YnN0cmluZyhlLGUrMykpO3JldHVybiByPyhuLmo9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gdGUobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSxlKzIpKTtyZXR1cm4gcj8obi5IPStyWzBdLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGVlKG4sdCxlKXtzYy5sYXN0SW5kZXg9MDt2YXIgcj1zYy5leGVjKHQuc3Vic3RyaW5nKGUsZSsyKSk7cmV0dXJuIHI/KG4uTT0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiByZShuLHQsZSl7c2MubGFzdEluZGV4PTA7dmFyIHI9c2MuZXhlYyh0LnN1YnN0cmluZyhlLGUrMikpO3JldHVybiByPyhuLlM9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gdWUobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSxlKzMpKTtyZXR1cm4gcj8obi5MPStyWzBdLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGllKG4pe3ZhciB0PW4uZ2V0VGltZXpvbmVPZmZzZXQoKSxlPXQ+MD8iLSI6IisiLHI9fn4oZmEodCkvNjApLHU9ZmEodCklNjA7cmV0dXJuIGUrWXQociwiMCIsMikrWXQodSwiMCIsMil9ZnVuY3Rpb24gb2Uobix0LGUpe2xjLmxhc3RJbmRleD0wO3ZhciByPWxjLmV4ZWModC5zdWJzdHJpbmcoZSxlKzEpKTtyZXR1cm4gcj9lK3JbMF0ubGVuZ3RoOi0xfWZ1bmN0aW9uIGFlKG4pe2Zvcih2YXIgdD1uLmxlbmd0aCxlPS0xOysrZTx0OyluW2VdWzBdPXRoaXMobltlXVswXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe2Zvcih2YXIgZT0wLHI9bltlXTshclsxXSh0KTspcj1uWysrZV07cmV0dXJuIHJbMF0odCl9fWZ1bmN0aW9uIGNlKCl7fWZ1bmN0aW9uIHNlKG4sdCxlKXt2YXIgcj1lLnM9bit0LHU9ci1uLGk9ci11O2UudD1uLWkrKHQtdSl9ZnVuY3Rpb24gbGUobix0KXtuJiZwYy5oYXNPd25Qcm9wZXJ0eShuLnR5cGUpJiZwY1tuLnR5cGVdKG4sdCl9ZnVuY3Rpb24gZmUobix0LGUpe3ZhciByLHU9LTEsaT1uLmxlbmd0aC1lO2Zvcih0LmxpbmVTdGFydCgpOysrdTxpOylyPW5bdV0sdC5wb2ludChyWzBdLHJbMV0sclsyXSk7dC5saW5lRW5kKCl9ZnVuY3Rpb24gaGUobix0KXt2YXIgZT0tMSxyPW4ubGVuZ3RoO2Zvcih0LnBvbHlnb25TdGFydCgpOysrZTxyOylmZShuW2VdLHQsMSk7dC5wb2x5Z29uRW5kKCl9ZnVuY3Rpb24gZ2UoKXtmdW5jdGlvbiBuKG4sdCl7bio9emEsdD10KnphLzIrQWEvNDt2YXIgZT1uLXIsbz1lPj0wPzE6LTEsYT1vKmUsYz1NYXRoLmNvcyh0KSxzPU1hdGguc2luKHQpLGw9aSpzLGY9dSpjK2wqTWF0aC5jb3MoYSksaD1sKm8qTWF0aC5zaW4oYSk7ZGMuYWRkKE1hdGguYXRhbjIoaCxmKSkscj1uLHU9YyxpPXN9dmFyIHQsZSxyLHUsaTttYy5wb2ludD1mdW5jdGlvbihvLGEpe21jLnBvaW50PW4scj0odD1vKSp6YSx1PU1hdGguY29zKGE9KGU9YSkqemEvMitBYS80KSxpPU1hdGguc2luKGEpfSxtYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpfX1mdW5jdGlvbiBwZShuKXt2YXIgdD1uWzBdLGU9blsxXSxyPU1hdGguY29zKGUpO3JldHVybltyKk1hdGguY29zKHQpLHIqTWF0aC5zaW4odCksTWF0aC5zaW4oZSldfWZ1bmN0aW9uIHZlKG4sdCl7cmV0dXJuIG5bMF0qdFswXStuWzFdKnRbMV0rblsyXSp0WzJdfWZ1bmN0aW9uIGRlKG4sdCl7cmV0dXJuW25bMV0qdFsyXS1uWzJdKnRbMV0sblsyXSp0WzBdLW5bMF0qdFsyXSxuWzBdKnRbMV0tblsxXSp0WzBdXX1mdW5jdGlvbiBtZShuLHQpe25bMF0rPXRbMF0sblsxXSs9dFsxXSxuWzJdKz10WzJdfWZ1bmN0aW9uIHllKG4sdCl7cmV0dXJuW25bMF0qdCxuWzFdKnQsblsyXSp0XX1mdW5jdGlvbiB4ZShuKXt2YXIgdD1NYXRoLnNxcnQoblswXSpuWzBdK25bMV0qblsxXStuWzJdKm5bMl0pO25bMF0vPXQsblsxXS89dCxuWzJdLz10fWZ1bmN0aW9uIE1lKG4pe3JldHVybltNYXRoLmF0YW4yKG5bMV0sblswXSksRyhuWzJdKV19ZnVuY3Rpb24gX2Uobix0KXtyZXR1cm4gZmEoblswXS10WzBdKTxUYSYmZmEoblsxXS10WzFdKTxUYX1mdW5jdGlvbiBiZShuLHQpe24qPXphO3ZhciBlPU1hdGguY29zKHQqPXphKTt3ZShlKk1hdGguY29zKG4pLGUqTWF0aC5zaW4obiksTWF0aC5zaW4odCkpfWZ1bmN0aW9uIHdlKG4sdCxlKXsrK3ljLE1jKz0obi1NYykveWMsX2MrPSh0LV9jKS95YyxiYys9KGUtYmMpL3ljfWZ1bmN0aW9uIFNlKCl7ZnVuY3Rpb24gbihuLHUpe24qPXphO3ZhciBpPU1hdGguY29zKHUqPXphKSxvPWkqTWF0aC5jb3MobiksYT1pKk1hdGguc2luKG4pLGM9TWF0aC5zaW4odSkscz1NYXRoLmF0YW4yKE1hdGguc3FydCgocz1lKmMtciphKSpzKyhzPXIqby10KmMpKnMrKHM9dCphLWUqbykqcyksdCpvK2UqYStyKmMpO3hjKz1zLHdjKz1zKih0Kyh0PW8pKSxTYys9cyooZSsoZT1hKSksa2MrPXMqKHIrKHI9YykpLHdlKHQsZSxyKX12YXIgdCxlLHI7Q2MucG9pbnQ9ZnVuY3Rpb24odSxpKXt1Kj16YTt2YXIgbz1NYXRoLmNvcyhpKj16YSk7dD1vKk1hdGguY29zKHUpLGU9bypNYXRoLnNpbih1KSxyPU1hdGguc2luKGkpLENjLnBvaW50PW4sd2UodCxlLHIpfX1mdW5jdGlvbiBrZSgpe0NjLnBvaW50PWJlfWZ1bmN0aW9uIEVlKCl7ZnVuY3Rpb24gbihuLHQpe24qPXphO3ZhciBlPU1hdGguY29zKHQqPXphKSxvPWUqTWF0aC5jb3MobiksYT1lKk1hdGguc2luKG4pLGM9TWF0aC5zaW4odCkscz11KmMtaSphLGw9aSpvLXIqYyxmPXIqYS11Km8saD1NYXRoLnNxcnQocypzK2wqbCtmKmYpLGc9cipvK3UqYStpKmMscD1oJiYtVyhnKS9oLHY9TWF0aC5hdGFuMihoLGcpO0VjKz1wKnMsTmMrPXAqbCxBYys9cCpmLHhjKz12LHdjKz12KihyKyhyPW8pKSxTYys9dioodSsodT1hKSksa2MrPXYqKGkrKGk9YykpLHdlKHIsdSxpKX12YXIgdCxlLHIsdSxpO0NjLnBvaW50PWZ1bmN0aW9uKG8sYSl7dD1vLGU9YSxDYy5wb2ludD1uLG8qPXphO3ZhciBjPU1hdGguY29zKGEqPXphKTtyPWMqTWF0aC5jb3MobyksdT1jKk1hdGguc2luKG8pLGk9TWF0aC5zaW4oYSksd2Uocix1LGkpfSxDYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpLENjLmxpbmVFbmQ9a2UsQ2MucG9pbnQ9YmV9fWZ1bmN0aW9uIE5lKCl7cmV0dXJuITB9ZnVuY3Rpb24gQWUobix0LGUscix1KXt2YXIgaT1bXSxvPVtdO2lmKG4uZm9yRWFjaChmdW5jdGlvbihuKXtpZighKCh0PW4ubGVuZ3RoLTEpPD0wKSl7dmFyIHQsZT1uWzBdLHI9blt0XTtpZihfZShlLHIpKXt1LmxpbmVTdGFydCgpO2Zvcih2YXIgYT0wO3Q+YTsrK2EpdS5wb2ludCgoZT1uW2FdKVswXSxlWzFdKTtyZXR1cm4gdS5saW5lRW5kKCksdm9pZCAwfXZhciBjPW5ldyBMZShlLG4sbnVsbCwhMCkscz1uZXcgTGUoZSxudWxsLGMsITEpO2Mubz1zLGkucHVzaChjKSxvLnB1c2gocyksYz1uZXcgTGUocixuLG51bGwsITEpLHM9bmV3IExlKHIsbnVsbCxjLCEwKSxjLm89cyxpLnB1c2goYyksby5wdXNoKHMpfX0pLG8uc29ydCh0KSxDZShpKSxDZShvKSxpLmxlbmd0aCl7Zm9yKHZhciBhPTAsYz1lLHM9by5sZW5ndGg7cz5hOysrYSlvW2FdLmU9Yz0hYztmb3IodmFyIGwsZixoPWlbMF07Oyl7Zm9yKHZhciBnPWgscD0hMDtnLnY7KWlmKChnPWcubik9PT1oKXJldHVybjtsPWcueix1LmxpbmVTdGFydCgpO2Rve2lmKGcudj1nLm8udj0hMCxnLmUpe2lmKHApZm9yKHZhciBhPTAscz1sLmxlbmd0aDtzPmE7KythKXUucG9pbnQoKGY9bFthXSlbMF0sZlsxXSk7ZWxzZSByKGcueCxnLm4ueCwxLHUpO2c9Zy5ufWVsc2V7aWYocCl7bD1nLnAuejtmb3IodmFyIGE9bC5sZW5ndGgtMTthPj0wOy0tYSl1LnBvaW50KChmPWxbYV0pWzBdLGZbMV0pfWVsc2UgcihnLngsZy5wLngsLTEsdSk7Zz1nLnB9Zz1nLm8sbD1nLnoscD0hcH13aGlsZSghZy52KTt1LmxpbmVFbmQoKX19fWZ1bmN0aW9uIENlKG4pe2lmKHQ9bi5sZW5ndGgpe2Zvcih2YXIgdCxlLHI9MCx1PW5bMF07KytyPHQ7KXUubj1lPW5bcl0sZS5wPXUsdT1lO3Uubj1lPW5bMF0sZS5wPXV9fWZ1bmN0aW9uIExlKG4sdCxlLHIpe3RoaXMueD1uLHRoaXMuej10LHRoaXMubz1lLHRoaXMuZT1yLHRoaXMudj0hMSx0aGlzLm49dGhpcy5wPW51bGx9ZnVuY3Rpb24gVGUobix0LGUscil7cmV0dXJuIGZ1bmN0aW9uKHUsaSl7ZnVuY3Rpb24gbyh0LGUpe3ZhciByPXUodCxlKTtuKHQ9clswXSxlPXJbMV0pJiZpLnBvaW50KHQsZSl9ZnVuY3Rpb24gYShuLHQpe3ZhciBlPXUobix0KTtkLnBvaW50KGVbMF0sZVsxXSl9ZnVuY3Rpb24gYygpe3kucG9pbnQ9YSxkLmxpbmVTdGFydCgpfWZ1bmN0aW9uIHMoKXt5LnBvaW50PW8sZC5saW5lRW5kKCl9ZnVuY3Rpb24gbChuLHQpe3YucHVzaChbbix0XSk7dmFyIGU9dShuLHQpO00ucG9pbnQoZVswXSxlWzFdKX1mdW5jdGlvbiBmKCl7TS5saW5lU3RhcnQoKSx2PVtdfWZ1bmN0aW9uIGgoKXtsKHZbMF1bMF0sdlswXVsxXSksTS5saW5lRW5kKCk7dmFyIG4sdD1NLmNsZWFuKCksZT14LmJ1ZmZlcigpLHI9ZS5sZW5ndGg7aWYodi5wb3AoKSxwLnB1c2godiksdj1udWxsLHIpe2lmKDEmdCl7bj1lWzBdO3ZhciB1LHI9bi5sZW5ndGgtMSxvPS0xO2ZvcihpLmxpbmVTdGFydCgpOysrbzxyOylpLnBvaW50KCh1PW5bb10pWzBdLHVbMV0pO3JldHVybiBpLmxpbmVFbmQoKSx2b2lkIDB9cj4xJiYyJnQmJmUucHVzaChlLnBvcCgpLmNvbmNhdChlLnNoaWZ0KCkpKSxnLnB1c2goZS5maWx0ZXIocWUpKX19dmFyIGcscCx2LGQ9dChpKSxtPXUuaW52ZXJ0KHJbMF0sclsxXSkseT17cG9pbnQ6byxsaW5lU3RhcnQ6YyxsaW5lRW5kOnMscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7eS5wb2ludD1sLHkubGluZVN0YXJ0PWYseS5saW5lRW5kPWgsZz1bXSxwPVtdLGkucG9seWdvblN0YXJ0KCl9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXt5LnBvaW50PW8seS5saW5lU3RhcnQ9Yyx5LmxpbmVFbmQ9cyxnPUdvLm1lcmdlKGcpO3ZhciBuPURlKG0scCk7Zy5sZW5ndGg/QWUoZyxSZSxuLGUsaSk6biYmKGkubGluZVN0YXJ0KCksZShudWxsLG51bGwsMSxpKSxpLmxpbmVFbmQoKSksaS5wb2x5Z29uRW5kKCksZz1wPW51bGx9LHNwaGVyZTpmdW5jdGlvbigpe2kucG9seWdvblN0YXJ0KCksaS5saW5lU3RhcnQoKSxlKG51bGwsbnVsbCwxLGkpLGkubGluZUVuZCgpLGkucG9seWdvbkVuZCgpfX0seD16ZSgpLE09dCh4KTtyZXR1cm4geX19ZnVuY3Rpb24gcWUobil7cmV0dXJuIG4ubGVuZ3RoPjF9ZnVuY3Rpb24gemUoKXt2YXIgbix0PVtdO3JldHVybntsaW5lU3RhcnQ6ZnVuY3Rpb24oKXt0LnB1c2gobj1bXSl9LHBvaW50OmZ1bmN0aW9uKHQsZSl7bi5wdXNoKFt0LGVdKX0sbGluZUVuZDp2LGJ1ZmZlcjpmdW5jdGlvbigpe3ZhciBlPXQ7cmV0dXJuIHQ9W10sbj1udWxsLGV9LHJlam9pbjpmdW5jdGlvbigpe3QubGVuZ3RoPjEmJnQucHVzaCh0LnBvcCgpLmNvbmNhdCh0LnNoaWZ0KCkpKX19fWZ1bmN0aW9uIFJlKG4sdCl7cmV0dXJuKChuPW4ueClbMF08MD9uWzFdLUxhLVRhOkxhLW5bMV0pLSgodD10LngpWzBdPDA/dFsxXS1MYS1UYTpMYS10WzFdKX1mdW5jdGlvbiBEZShuLHQpe3ZhciBlPW5bMF0scj1uWzFdLHU9W01hdGguc2luKGUpLC1NYXRoLmNvcyhlKSwwXSxpPTAsbz0wO2RjLnJlc2V0KCk7Zm9yKHZhciBhPTAsYz10Lmxlbmd0aDtjPmE7KythKXt2YXIgcz10W2FdLGw9cy5sZW5ndGg7aWYobClmb3IodmFyIGY9c1swXSxoPWZbMF0sZz1mWzFdLzIrQWEvNCxwPU1hdGguc2luKGcpLHY9TWF0aC5jb3MoZyksZD0xOzspe2Q9PT1sJiYoZD0wKSxuPXNbZF07dmFyIG09blswXSx5PW5bMV0vMitBYS80LHg9TWF0aC5zaW4oeSksTT1NYXRoLmNvcyh5KSxfPW0taCxiPV8+PTA/MTotMSx3PWIqXyxTPXc+QWEsaz1wKng7aWYoZGMuYWRkKE1hdGguYXRhbjIoaypiKk1hdGguc2luKHcpLHYqTStrKk1hdGguY29zKHcpKSksaSs9Uz9fK2IqQ2E6XyxTXmg+PWVebT49ZSl7dmFyIEU9ZGUocGUoZikscGUobikpO3hlKEUpO3ZhciBOPWRlKHUsRSk7eGUoTik7dmFyIEE9KFNeXz49MD8tMToxKSpHKE5bMl0pOyhyPkF8fHI9PT1BJiYoRVswXXx8RVsxXSkpJiYobys9U15fPj0wPzE6LTEpfWlmKCFkKyspYnJlYWs7aD1tLHA9eCx2PU0sZj1ufX1yZXR1cm4oLVRhPml8fFRhPmkmJjA+ZGMpXjEmb31mdW5jdGlvbiBQZShuKXt2YXIgdCxlPTAvMCxyPTAvMCx1PTAvMDtyZXR1cm57bGluZVN0YXJ0OmZ1bmN0aW9uKCl7bi5saW5lU3RhcnQoKSx0PTF9LHBvaW50OmZ1bmN0aW9uKGksbyl7dmFyIGE9aT4wP0FhOi1BYSxjPWZhKGktZSk7ZmEoYy1BYSk8VGE/KG4ucG9pbnQoZSxyPShyK28pLzI+MD9MYTotTGEpLG4ucG9pbnQodSxyKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQoYSxyKSxuLnBvaW50KGksciksdD0wKTp1IT09YSYmYz49QWEmJihmYShlLXUpPFRhJiYoZS09dSpUYSksZmEoaS1hKTxUYSYmKGktPWEqVGEpLHI9VWUoZSxyLGksbyksbi5wb2ludCh1LHIpLG4ubGluZUVuZCgpLG4ubGluZVN0YXJ0KCksbi5wb2ludChhLHIpLHQ9MCksbi5wb2ludChlPWkscj1vKSx1PWF9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtuLmxpbmVFbmQoKSxlPXI9MC8wfSxjbGVhbjpmdW5jdGlvbigpe3JldHVybiAyLXR9fX1mdW5jdGlvbiBVZShuLHQsZSxyKXt2YXIgdSxpLG89TWF0aC5zaW4obi1lKTtyZXR1cm4gZmEobyk+VGE/TWF0aC5hdGFuKChNYXRoLnNpbih0KSooaT1NYXRoLmNvcyhyKSkqTWF0aC5zaW4oZSktTWF0aC5zaW4ocikqKHU9TWF0aC5jb3ModCkpKk1hdGguc2luKG4pKS8odSppKm8pKToodCtyKS8yfWZ1bmN0aW9uIGplKG4sdCxlLHIpe3ZhciB1O2lmKG51bGw9PW4pdT1lKkxhLHIucG9pbnQoLUFhLHUpLHIucG9pbnQoMCx1KSxyLnBvaW50KEFhLHUpLHIucG9pbnQoQWEsMCksci5wb2ludChBYSwtdSksci5wb2ludCgwLC11KSxyLnBvaW50KC1BYSwtdSksci5wb2ludCgtQWEsMCksci5wb2ludCgtQWEsdSk7ZWxzZSBpZihmYShuWzBdLXRbMF0pPlRhKXt2YXIgaT1uWzBdPHRbMF0/QWE6LUFhO3U9ZSppLzIsci5wb2ludCgtaSx1KSxyLnBvaW50KDAsdSksci5wb2ludChpLHUpfWVsc2Ugci5wb2ludCh0WzBdLHRbMV0pfWZ1bmN0aW9uIEhlKG4pe2Z1bmN0aW9uIHQobix0KXtyZXR1cm4gTWF0aC5jb3MobikqTWF0aC5jb3ModCk+aX1mdW5jdGlvbiBlKG4pe3ZhciBlLGksYyxzLGw7cmV0dXJue2xpbmVTdGFydDpmdW5jdGlvbigpe3M9Yz0hMSxsPTF9LHBvaW50OmZ1bmN0aW9uKGYsaCl7dmFyIGcscD1bZixoXSx2PXQoZixoKSxkPW8/dj8wOnUoZixoKTp2P3UoZisoMD5mP0FhOi1BYSksaCk6MDtpZighZSYmKHM9Yz12KSYmbi5saW5lU3RhcnQoKSx2IT09YyYmKGc9cihlLHApLChfZShlLGcpfHxfZShwLGcpKSYmKHBbMF0rPVRhLHBbMV0rPVRhLHY9dChwWzBdLHBbMV0pKSksdiE9PWMpbD0wLHY/KG4ubGluZVN0YXJ0KCksZz1yKHAsZSksbi5wb2ludChnWzBdLGdbMV0pKTooZz1yKGUscCksbi5wb2ludChnWzBdLGdbMV0pLG4ubGluZUVuZCgpKSxlPWc7ZWxzZSBpZihhJiZlJiZvXnYpe3ZhciBtO2QmaXx8IShtPXIocCxlLCEwKSl8fChsPTAsbz8obi5saW5lU3RhcnQoKSxuLnBvaW50KG1bMF1bMF0sbVswXVsxXSksbi5wb2ludChtWzFdWzBdLG1bMV1bMV0pLG4ubGluZUVuZCgpKToobi5wb2ludChtWzFdWzBdLG1bMV1bMV0pLG4ubGluZUVuZCgpLG4ubGluZVN0YXJ0KCksbi5wb2ludChtWzBdWzBdLG1bMF1bMV0pKSl9IXZ8fGUmJl9lKGUscCl8fG4ucG9pbnQocFswXSxwWzFdKSxlPXAsYz12LGk9ZH0sbGluZUVuZDpmdW5jdGlvbigpe2MmJm4ubGluZUVuZCgpLGU9bnVsbH0sY2xlYW46ZnVuY3Rpb24oKXtyZXR1cm4gbHwocyYmYyk8PDF9fX1mdW5jdGlvbiByKG4sdCxlKXt2YXIgcj1wZShuKSx1PXBlKHQpLG89WzEsMCwwXSxhPWRlKHIsdSksYz12ZShhLGEpLHM9YVswXSxsPWMtcypzO2lmKCFsKXJldHVybiFlJiZuO3ZhciBmPWkqYy9sLGg9LWkqcy9sLGc9ZGUobyxhKSxwPXllKG8sZiksdj15ZShhLGgpO21lKHAsdik7dmFyIGQ9ZyxtPXZlKHAsZCkseT12ZShkLGQpLHg9bSptLXkqKHZlKHAscCktMSk7aWYoISgwPngpKXt2YXIgTT1NYXRoLnNxcnQoeCksXz15ZShkLCgtbS1NKS95KTtpZihtZShfLHApLF89TWUoXyksIWUpcmV0dXJuIF87dmFyIGIsdz1uWzBdLFM9dFswXSxrPW5bMV0sRT10WzFdO3c+UyYmKGI9dyx3PVMsUz1iKTt2YXIgTj1TLXcsQT1mYShOLUFhKTxUYSxDPUF8fFRhPk47aWYoIUEmJms+RSYmKGI9ayxrPUUsRT1iKSxDP0E/aytFPjBeX1sxXTwoZmEoX1swXS13KTxUYT9rOkUpOms8PV9bMV0mJl9bMV08PUU6Tj5BYV4odzw9X1swXSYmX1swXTw9Uykpe3ZhciBMPXllKGQsKC1tK00pL3kpO3JldHVybiBtZShMLHApLFtfLE1lKEwpXX19fWZ1bmN0aW9uIHUodCxlKXt2YXIgcj1vP246QWEtbix1PTA7cmV0dXJuLXI+dD91fD0xOnQ+ciYmKHV8PTIpLC1yPmU/dXw9NDplPnImJih1fD04KSx1fXZhciBpPU1hdGguY29zKG4pLG89aT4wLGE9ZmEoaSk+VGEsYz1ncihuLDYqemEpO3JldHVybiBUZSh0LGUsYyxvP1swLC1uXTpbLUFhLG4tQWFdKX1mdW5jdGlvbiBGZShuLHQsZSxyKXtyZXR1cm4gZnVuY3Rpb24odSl7dmFyIGksbz11LmEsYT11LmIsYz1vLngscz1vLnksbD1hLngsZj1hLnksaD0wLGc9MSxwPWwtYyx2PWYtcztpZihpPW4tYyxwfHwhKGk+MCkpe2lmKGkvPXAsMD5wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9ZWxzZSBpZihwPjApe2lmKGk+ZylyZXR1cm47aT5oJiYoaD1pKX1pZihpPWUtYyxwfHwhKDA+aSkpe2lmKGkvPXAsMD5wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9ZWxzZSBpZihwPjApe2lmKGg+aSlyZXR1cm47Zz5pJiYoZz1pKX1pZihpPXQtcyx2fHwhKGk+MCkpe2lmKGkvPXYsMD52KXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9ZWxzZSBpZih2PjApe2lmKGk+ZylyZXR1cm47aT5oJiYoaD1pKX1pZihpPXItcyx2fHwhKDA+aSkpe2lmKGkvPXYsMD52KXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9ZWxzZSBpZih2PjApe2lmKGg+aSlyZXR1cm47Zz5pJiYoZz1pKX1yZXR1cm4gaD4wJiYodS5hPXt4OmMraCpwLHk6cytoKnZ9KSwxPmcmJih1LmI9e3g6YytnKnAseTpzK2cqdn0pLHV9fX19fX1mdW5jdGlvbiBPZShuLHQsZSxyKXtmdW5jdGlvbiB1KHIsdSl7cmV0dXJuIGZhKHJbMF0tbik8VGE/dT4wPzA6MzpmYShyWzBdLWUpPFRhP3U+MD8yOjE6ZmEoclsxXS10KTxUYT91PjA/MTowOnU+MD8zOjJ9ZnVuY3Rpb24gaShuLHQpe3JldHVybiBvKG4ueCx0LngpfWZ1bmN0aW9uIG8obix0KXt2YXIgZT11KG4sMSkscj11KHQsMSk7cmV0dXJuIGUhPT1yP2UtcjowPT09ZT90WzFdLW5bMV06MT09PWU/blswXS10WzBdOjI9PT1lP25bMV0tdFsxXTp0WzBdLW5bMF19cmV0dXJuIGZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGMobil7Zm9yKHZhciB0PTAsZT1kLmxlbmd0aCxyPW5bMV0sdT0wO2U+dTsrK3UpZm9yKHZhciBpLG89MSxhPWRbdV0sYz1hLmxlbmd0aCxzPWFbMF07Yz5vOysrbylpPWFbb10sc1sxXTw9cj9pWzFdPnImJkoocyxpLG4pPjAmJisrdDppWzFdPD1yJiZKKHMsaSxuKTwwJiYtLXQscz1pO3JldHVybiAwIT09dH1mdW5jdGlvbiBzKGksYSxjLHMpe3ZhciBsPTAsZj0wO2lmKG51bGw9PWl8fChsPXUoaSxjKSkhPT0oZj11KGEsYykpfHxvKGksYSk8MF5jPjApe2RvIHMucG9pbnQoMD09PWx8fDM9PT1sP246ZSxsPjE/cjp0KTt3aGlsZSgobD0obCtjKzQpJTQpIT09Zil9ZWxzZSBzLnBvaW50KGFbMF0sYVsxXSl9ZnVuY3Rpb24gbCh1LGkpe3JldHVybiB1Pj1uJiZlPj11JiZpPj10JiZyPj1pfWZ1bmN0aW9uIGYobix0KXtsKG4sdCkmJmEucG9pbnQobix0KX1mdW5jdGlvbiBoKCl7Qy5wb2ludD1wLGQmJmQucHVzaChtPVtdKSxTPSEwLHc9ITEsXz1iPTAvMH1mdW5jdGlvbiBnKCl7diYmKHAoeSx4KSxNJiZ3JiZOLnJlam9pbigpLHYucHVzaChOLmJ1ZmZlcigpKSksQy5wb2ludD1mLHcmJmEubGluZUVuZCgpfWZ1bmN0aW9uIHAobix0KXtuPU1hdGgubWF4KC1UYyxNYXRoLm1pbihUYyxuKSksdD1NYXRoLm1heCgtVGMsTWF0aC5taW4oVGMsdCkpO3ZhciBlPWwobix0KTtpZihkJiZtLnB1c2goW24sdF0pLFMpeT1uLHg9dCxNPWUsUz0hMSxlJiYoYS5saW5lU3RhcnQoKSxhLnBvaW50KG4sdCkpO2Vsc2UgaWYoZSYmdylhLnBvaW50KG4sdCk7ZWxzZXt2YXIgcj17YTp7eDpfLHk6Yn0sYjp7eDpuLHk6dH19O0Eocik/KHd8fChhLmxpbmVTdGFydCgpLGEucG9pbnQoci5hLngsci5hLnkpKSxhLnBvaW50KHIuYi54LHIuYi55KSxlfHxhLmxpbmVFbmQoKSxrPSExKTplJiYoYS5saW5lU3RhcnQoKSxhLnBvaW50KG4sdCksaz0hMSl9Xz1uLGI9dCx3PWV9dmFyIHYsZCxtLHkseCxNLF8sYix3LFMsayxFPWEsTj16ZSgpLEE9RmUobix0LGUsciksQz17cG9pbnQ6ZixsaW5lU3RhcnQ6aCxsaW5lRW5kOmcscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7YT1OLHY9W10sZD1bXSxrPSEwfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7YT1FLHY9R28ubWVyZ2Uodik7dmFyIHQ9YyhbbixyXSksZT1rJiZ0LHU9di5sZW5ndGg7KGV8fHUpJiYoYS5wb2x5Z29uU3RhcnQoKSxlJiYoYS5saW5lU3RhcnQoKSxzKG51bGwsbnVsbCwxLGEpLGEubGluZUVuZCgpKSx1JiZBZSh2LGksdCxzLGEpLGEucG9seWdvbkVuZCgpKSx2PWQ9bT1udWxsfX07cmV0dXJuIEN9fWZ1bmN0aW9uIFllKG4sdCl7ZnVuY3Rpb24gZShlLHIpe3JldHVybiBlPW4oZSxyKSx0KGVbMF0sZVsxXSl9cmV0dXJuIG4uaW52ZXJ0JiZ0LmludmVydCYmKGUuaW52ZXJ0PWZ1bmN0aW9uKGUscil7cmV0dXJuIGU9dC5pbnZlcnQoZSxyKSxlJiZuLmludmVydChlWzBdLGVbMV0pfSksZX1mdW5jdGlvbiBJZShuKXt2YXIgdD0wLGU9QWEvMyxyPWlyKG4pLHU9cih0LGUpO3JldHVybiB1LnBhcmFsbGVscz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD9yKHQ9blswXSpBYS8xODAsZT1uWzFdKkFhLzE4MCk6WzE4MCoodC9BYSksMTgwKihlL0FhKV19LHV9ZnVuY3Rpb24gWmUobix0KXtmdW5jdGlvbiBlKG4sdCl7dmFyIGU9TWF0aC5zcXJ0KGktMip1Kk1hdGguc2luKHQpKS91O3JldHVybltlKk1hdGguc2luKG4qPXUpLG8tZSpNYXRoLmNvcyhuKV19dmFyIHI9TWF0aC5zaW4obiksdT0ocitNYXRoLnNpbih0KSkvMixpPTErciooMip1LXIpLG89TWF0aC5zcXJ0KGkpL3U7cmV0dXJuIGUuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7dmFyIGU9by10O3JldHVybltNYXRoLmF0YW4yKG4sZSkvdSxHKChpLShuKm4rZSplKSp1KnUpLygyKnUpKV19LGV9ZnVuY3Rpb24gVmUoKXtmdW5jdGlvbiBuKG4sdCl7emMrPXUqbi1yKnQscj1uLHU9dH12YXIgdCxlLHIsdTtqYy5wb2ludD1mdW5jdGlvbihpLG8pe2pjLnBvaW50PW4sdD1yPWksZT11PW99LGpjLmxpbmVFbmQ9ZnVuY3Rpb24oKXtuKHQsZSl9fWZ1bmN0aW9uICRlKG4sdCl7UmM+biYmKFJjPW4pLG4+UGMmJihQYz1uKSxEYz50JiYoRGM9dCksdD5VYyYmKFVjPXQpfWZ1bmN0aW9uIFhlKCl7ZnVuY3Rpb24gbihuLHQpe28ucHVzaCgiTSIsbiwiLCIsdCxpKX1mdW5jdGlvbiB0KG4sdCl7by5wdXNoKCJNIixuLCIsIix0KSxhLnBvaW50PWV9ZnVuY3Rpb24gZShuLHQpe28ucHVzaCgiTCIsbiwiLCIsdCl9ZnVuY3Rpb24gcigpe2EucG9pbnQ9bn1mdW5jdGlvbiB1KCl7by5wdXNoKCJaIil9dmFyIGk9QmUoNC41KSxvPVtdLGE9e3BvaW50Om4sbGluZVN0YXJ0OmZ1bmN0aW9uKCl7YS5wb2ludD10fSxsaW5lRW5kOnIscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7YS5saW5lRW5kPXV9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXthLmxpbmVFbmQ9cixhLnBvaW50PW59LHBvaW50UmFkaXVzOmZ1bmN0aW9uKG4pe3JldHVybiBpPUJlKG4pLGF9LHJlc3VsdDpmdW5jdGlvbigpe2lmKG8ubGVuZ3RoKXt2YXIgbj1vLmpvaW4oIiIpO3JldHVybiBvPVtdLG59fX07cmV0dXJuIGF9ZnVuY3Rpb24gQmUobil7cmV0dXJuIm0wLCIrbisiYSIrbisiLCIrbisiIDAgMSwxIDAsIistMipuKyJhIituKyIsIituKyIgMCAxLDEgMCwiKzIqbisieiJ9ZnVuY3Rpb24gSmUobix0KXtNYys9bixfYys9dCwrK2JjfWZ1bmN0aW9uIFdlKCl7ZnVuY3Rpb24gbihuLHIpe3ZhciB1PW4tdCxpPXItZSxvPU1hdGguc3FydCh1KnUraSppKTt3Yys9byoodCtuKS8yLFNjKz1vKihlK3IpLzIsa2MrPW8sSmUodD1uLGU9cil9dmFyIHQsZTtGYy5wb2ludD1mdW5jdGlvbihyLHUpe0ZjLnBvaW50PW4sSmUodD1yLGU9dSl9fWZ1bmN0aW9uIEdlKCl7RmMucG9pbnQ9SmV9ZnVuY3Rpb24gS2UoKXtmdW5jdGlvbiBuKG4sdCl7dmFyIGU9bi1yLGk9dC11LG89TWF0aC5zcXJ0KGUqZStpKmkpO3djKz1vKihyK24pLzIsU2MrPW8qKHUrdCkvMixrYys9byxvPXUqbi1yKnQsRWMrPW8qKHIrbiksTmMrPW8qKHUrdCksQWMrPTMqbyxKZShyPW4sdT10KX12YXIgdCxlLHIsdTtGYy5wb2ludD1mdW5jdGlvbihpLG8pe0ZjLnBvaW50PW4sSmUodD1yPWksZT11PW8pfSxGYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpfX1mdW5jdGlvbiBRZShuKXtmdW5jdGlvbiB0KHQsZSl7bi5tb3ZlVG8odCxlKSxuLmFyYyh0LGUsbywwLENhKX1mdW5jdGlvbiBlKHQsZSl7bi5tb3ZlVG8odCxlKSxhLnBvaW50PXJ9ZnVuY3Rpb24gcih0LGUpe24ubGluZVRvKHQsZSl9ZnVuY3Rpb24gdSgpe2EucG9pbnQ9dH1mdW5jdGlvbiBpKCl7bi5jbG9zZVBhdGgoKX12YXIgbz00LjUsYT17cG9pbnQ6dCxsaW5lU3RhcnQ6ZnVuY3Rpb24oKXthLnBvaW50PWV9LGxpbmVFbmQ6dSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXthLmxpbmVFbmQ9aX0scG9seWdvbkVuZDpmdW5jdGlvbigpe2EubGluZUVuZD11LGEucG9pbnQ9dH0scG9pbnRSYWRpdXM6ZnVuY3Rpb24obil7cmV0dXJuIG89bixhfSxyZXN1bHQ6dn07cmV0dXJuIGF9ZnVuY3Rpb24gbnIobil7ZnVuY3Rpb24gdChuKXtyZXR1cm4oYT9yOmUpKG4pfWZ1bmN0aW9uIGUodCl7cmV0dXJuIHJyKHQsZnVuY3Rpb24oZSxyKXtlPW4oZSxyKSx0LnBvaW50KGVbMF0sZVsxXSl9KX1mdW5jdGlvbiByKHQpe2Z1bmN0aW9uIGUoZSxyKXtlPW4oZSxyKSx0LnBvaW50KGVbMF0sZVsxXSl9ZnVuY3Rpb24gcigpe3g9MC8wLFMucG9pbnQ9aSx0LmxpbmVTdGFydCgpfWZ1bmN0aW9uIGkoZSxyKXt2YXIgaT1wZShbZSxyXSksbz1uKGUscik7dSh4LE0seSxfLGIsdyx4PW9bMF0sTT1vWzFdLHk9ZSxfPWlbMF0sYj1pWzFdLHc9aVsyXSxhLHQpLHQucG9pbnQoeCxNKX1mdW5jdGlvbiBvKCl7Uy5wb2ludD1lLHQubGluZUVuZCgpfWZ1bmN0aW9uIGMoKXtyKCksUy5wb2ludD1zLFMubGluZUVuZD1sfWZ1bmN0aW9uIHMobix0KXtpKGY9bixoPXQpLGc9eCxwPU0sdj1fLGQ9YixtPXcsUy5wb2ludD1pfWZ1bmN0aW9uIGwoKXt1KHgsTSx5LF8sYix3LGcscCxmLHYsZCxtLGEsdCksUy5saW5lRW5kPW8sbygpfXZhciBmLGgsZyxwLHYsZCxtLHkseCxNLF8sYix3LFM9e3BvaW50OmUsbGluZVN0YXJ0OnIsbGluZUVuZDpvLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3QucG9seWdvblN0YXJ0KCksUy5saW5lU3RhcnQ9Y30scG9seWdvbkVuZDpmdW5jdGlvbigpe3QucG9seWdvbkVuZCgpLFMubGluZVN0YXJ0PXJ9fTtyZXR1cm4gU31mdW5jdGlvbiB1KHQsZSxyLGEsYyxzLGwsZixoLGcscCx2LGQsbSl7dmFyIHk9bC10LHg9Zi1lLE09eSp5K3gqeDtpZihNPjQqaSYmZC0tKXt2YXIgXz1hK2csYj1jK3Asdz1zK3YsUz1NYXRoLnNxcnQoXypfK2IqYit3KncpLGs9TWF0aC5hc2luKHcvPVMpLEU9ZmEoZmEodyktMSk8VGF8fGZhKHItaCk8VGE/KHIraCkvMjpNYXRoLmF0YW4yKGIsXyksTj1uKEUsayksQT1OWzBdLEM9TlsxXSxMPUEtdCxUPUMtZSxxPXgqTC15KlQ7KHEqcS9NPml8fGZhKCh5KkwreCpUKS9NLS41KT4uM3x8bz5hKmcrYypwK3MqdikmJih1KHQsZSxyLGEsYyxzLEEsQyxFLF8vPVMsYi89Uyx3LGQsbSksbS5wb2ludChBLEMpLHUoQSxDLEUsXyxiLHcsbCxmLGgsZyxwLHYsZCxtKSl9fXZhciBpPS41LG89TWF0aC5jb3MoMzAqemEpLGE9MTY7cmV0dXJuIHQucHJlY2lzaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPShpPW4qbik+MCYmMTYsdCk6TWF0aC5zcXJ0KGkpfSx0fWZ1bmN0aW9uIHRyKG4pe3ZhciB0PW5yKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIG4oW3QqUmEsZSpSYV0pfSk7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBvcih0KG4pKX19ZnVuY3Rpb24gZXIobil7dGhpcy5zdHJlYW09bn1mdW5jdGlvbiBycihuLHQpe3JldHVybntwb2ludDp0LHNwaGVyZTpmdW5jdGlvbigpe24uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe24ubGluZVN0YXJ0KCl9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtuLmxpbmVFbmQoKX0scG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7bi5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe24ucG9seWdvbkVuZCgpfX19ZnVuY3Rpb24gdXIobil7cmV0dXJuIGlyKGZ1bmN0aW9uKCl7cmV0dXJuIG59KSgpfWZ1bmN0aW9uIGlyKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuIG49YShuWzBdKnphLG5bMV0qemEpLFtuWzBdKmgrYyxzLW5bMV0qaF19ZnVuY3Rpb24gZShuKXtyZXR1cm4gbj1hLmludmVydCgoblswXS1jKS9oLChzLW5bMV0pL2gpLG4mJltuWzBdKlJhLG5bMV0qUmFdfWZ1bmN0aW9uIHIoKXthPVllKG89c3IobSx5LHgpLGkpO3ZhciBuPWkodixkKTtyZXR1cm4gYz1nLW5bMF0qaCxzPXArblsxXSpoLHUoKX1mdW5jdGlvbiB1KCl7cmV0dXJuIGwmJihsLnZhbGlkPSExLGw9bnVsbCksdH12YXIgaSxvLGEsYyxzLGwsZj1ucihmdW5jdGlvbihuLHQpe3JldHVybiBuPWkobix0KSxbblswXSpoK2Mscy1uWzFdKmhdCn0pLGg9MTUwLGc9NDgwLHA9MjUwLHY9MCxkPTAsbT0wLHk9MCx4PTAsTT1MYyxfPU50LGI9bnVsbCx3PW51bGw7cmV0dXJuIHQuc3RyZWFtPWZ1bmN0aW9uKG4pe3JldHVybiBsJiYobC52YWxpZD0hMSksbD1vcihNKG8sZihfKG4pKSkpLGwudmFsaWQ9ITAsbH0sdC5jbGlwQW5nbGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KE09bnVsbD09bj8oYj1uLExjKTpIZSgoYj0rbikqemEpLHUoKSk6Yn0sdC5jbGlwRXh0ZW50PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh3PW4sXz1uP09lKG5bMF1bMF0sblswXVsxXSxuWzFdWzBdLG5bMV1bMV0pOk50LHUoKSk6d30sdC5zY2FsZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaD0rbixyKCkpOmh9LHQudHJhbnNsYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPStuWzBdLHA9K25bMV0scigpKTpbZyxwXX0sdC5jZW50ZXI9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHY9blswXSUzNjAqemEsZD1uWzFdJTM2MCp6YSxyKCkpOlt2KlJhLGQqUmFdfSx0LnJvdGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obT1uWzBdJTM2MCp6YSx5PW5bMV0lMzYwKnphLHg9bi5sZW5ndGg+Mj9uWzJdJTM2MCp6YTowLHIoKSk6W20qUmEseSpSYSx4KlJhXX0sR28ucmViaW5kKHQsZiwicHJlY2lzaW9uIiksZnVuY3Rpb24oKXtyZXR1cm4gaT1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0LmludmVydD1pLmludmVydCYmZSxyKCl9fWZ1bmN0aW9uIG9yKG4pe3JldHVybiBycihuLGZ1bmN0aW9uKHQsZSl7bi5wb2ludCh0KnphLGUqemEpfSl9ZnVuY3Rpb24gYXIobix0KXtyZXR1cm5bbix0XX1mdW5jdGlvbiBjcihuLHQpe3JldHVybltuPkFhP24tQ2E6LUFhPm4/bitDYTpuLHRdfWZ1bmN0aW9uIHNyKG4sdCxlKXtyZXR1cm4gbj90fHxlP1llKGZyKG4pLGhyKHQsZSkpOmZyKG4pOnR8fGU/aHIodCxlKTpjcn1mdW5jdGlvbiBscihuKXtyZXR1cm4gZnVuY3Rpb24odCxlKXtyZXR1cm4gdCs9bixbdD5BYT90LUNhOi1BYT50P3QrQ2E6dCxlXX19ZnVuY3Rpb24gZnIobil7dmFyIHQ9bHIobik7cmV0dXJuIHQuaW52ZXJ0PWxyKC1uKSx0fWZ1bmN0aW9uIGhyKG4sdCl7ZnVuY3Rpb24gZShuLHQpe3ZhciBlPU1hdGguY29zKHQpLGE9TWF0aC5jb3MobikqZSxjPU1hdGguc2luKG4pKmUscz1NYXRoLnNpbih0KSxsPXMqcithKnU7cmV0dXJuW01hdGguYXRhbjIoYyppLWwqbyxhKnItcyp1KSxHKGwqaStjKm8pXX12YXIgcj1NYXRoLmNvcyhuKSx1PU1hdGguc2luKG4pLGk9TWF0aC5jb3ModCksbz1NYXRoLnNpbih0KTtyZXR1cm4gZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgZT1NYXRoLmNvcyh0KSxhPU1hdGguY29zKG4pKmUsYz1NYXRoLnNpbihuKSplLHM9TWF0aC5zaW4odCksbD1zKmktYypvO3JldHVybltNYXRoLmF0YW4yKGMqaStzKm8sYSpyK2wqdSksRyhsKnItYSp1KV19LGV9ZnVuY3Rpb24gZ3Iobix0KXt2YXIgZT1NYXRoLmNvcyhuKSxyPU1hdGguc2luKG4pO3JldHVybiBmdW5jdGlvbih1LGksbyxhKXt2YXIgYz1vKnQ7bnVsbCE9dT8odT1wcihlLHUpLGk9cHIoZSxpKSwobz4wP2k+dTp1PmkpJiYodSs9bypDYSkpOih1PW4rbypDYSxpPW4tLjUqYyk7Zm9yKHZhciBzLGw9dTtvPjA/bD5pOmk+bDtsLT1jKWEucG9pbnQoKHM9TWUoW2UsLXIqTWF0aC5jb3MobCksLXIqTWF0aC5zaW4obCldKSlbMF0sc1sxXSl9fWZ1bmN0aW9uIHByKG4sdCl7dmFyIGU9cGUodCk7ZVswXS09bix4ZShlKTt2YXIgcj1XKC1lWzFdKTtyZXR1cm4oKC1lWzJdPDA/LXI6cikrMipNYXRoLlBJLVRhKSUoMipNYXRoLlBJKX1mdW5jdGlvbiB2cihuLHQsZSl7dmFyIHI9R28ucmFuZ2Uobix0LVRhLGUpLmNvbmNhdCh0KTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIHIubWFwKGZ1bmN0aW9uKHQpe3JldHVybltuLHRdfSl9fWZ1bmN0aW9uIGRyKG4sdCxlKXt2YXIgcj1Hby5yYW5nZShuLHQtVGEsZSkuY29uY2F0KHQpO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gci5tYXAoZnVuY3Rpb24odCl7cmV0dXJuW3Qsbl19KX19ZnVuY3Rpb24gbXIobil7cmV0dXJuIG4uc291cmNlfWZ1bmN0aW9uIHlyKG4pe3JldHVybiBuLnRhcmdldH1mdW5jdGlvbiB4cihuLHQsZSxyKXt2YXIgdT1NYXRoLmNvcyh0KSxpPU1hdGguc2luKHQpLG89TWF0aC5jb3MociksYT1NYXRoLnNpbihyKSxjPXUqTWF0aC5jb3Mobikscz11Kk1hdGguc2luKG4pLGw9bypNYXRoLmNvcyhlKSxmPW8qTWF0aC5zaW4oZSksaD0yKk1hdGguYXNpbihNYXRoLnNxcnQodHQoci10KSt1Km8qdHQoZS1uKSkpLGc9MS9NYXRoLnNpbihoKSxwPWg/ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zaW4obio9aCkqZyxlPU1hdGguc2luKGgtbikqZyxyPWUqYyt0KmwsdT1lKnMrdCpmLG89ZSppK3QqYTtyZXR1cm5bTWF0aC5hdGFuMih1LHIpKlJhLE1hdGguYXRhbjIobyxNYXRoLnNxcnQocipyK3UqdSkpKlJhXX06ZnVuY3Rpb24oKXtyZXR1cm5bbipSYSx0KlJhXX07cmV0dXJuIHAuZGlzdGFuY2U9aCxwfWZ1bmN0aW9uIE1yKCl7ZnVuY3Rpb24gbihuLHUpe3ZhciBpPU1hdGguc2luKHUqPXphKSxvPU1hdGguY29zKHUpLGE9ZmEoKG4qPXphKS10KSxjPU1hdGguY29zKGEpO09jKz1NYXRoLmF0YW4yKE1hdGguc3FydCgoYT1vKk1hdGguc2luKGEpKSphKyhhPXIqaS1lKm8qYykqYSksZSppK3IqbypjKSx0PW4sZT1pLHI9b312YXIgdCxlLHI7WWMucG9pbnQ9ZnVuY3Rpb24odSxpKXt0PXUqemEsZT1NYXRoLnNpbihpKj16YSkscj1NYXRoLmNvcyhpKSxZYy5wb2ludD1ufSxZYy5saW5lRW5kPWZ1bmN0aW9uKCl7WWMucG9pbnQ9WWMubGluZUVuZD12fX1mdW5jdGlvbiBfcihuLHQpe2Z1bmN0aW9uIGUodCxlKXt2YXIgcj1NYXRoLmNvcyh0KSx1PU1hdGguY29zKGUpLGk9bihyKnUpO3JldHVybltpKnUqTWF0aC5zaW4odCksaSpNYXRoLnNpbihlKV19cmV0dXJuIGUuaW52ZXJ0PWZ1bmN0aW9uKG4sZSl7dmFyIHI9TWF0aC5zcXJ0KG4qbitlKmUpLHU9dChyKSxpPU1hdGguc2luKHUpLG89TWF0aC5jb3ModSk7cmV0dXJuW01hdGguYXRhbjIobippLHIqbyksTWF0aC5hc2luKHImJmUqaS9yKV19LGV9ZnVuY3Rpb24gYnIobix0KXtmdW5jdGlvbiBlKG4sdCl7bz4wPy1MYStUYT50JiYodD0tTGErVGEpOnQ+TGEtVGEmJih0PUxhLVRhKTt2YXIgZT1vL01hdGgucG93KHUodCksaSk7cmV0dXJuW2UqTWF0aC5zaW4oaSpuKSxvLWUqTWF0aC5jb3MoaSpuKV19dmFyIHI9TWF0aC5jb3MobiksdT1mdW5jdGlvbihuKXtyZXR1cm4gTWF0aC50YW4oQWEvNCtuLzIpfSxpPW49PT10P01hdGguc2luKG4pOk1hdGgubG9nKHIvTWF0aC5jb3ModCkpL01hdGgubG9nKHUodCkvdShuKSksbz1yKk1hdGgucG93KHUobiksaSkvaTtyZXR1cm4gaT8oZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgZT1vLXQscj1CKGkpKk1hdGguc3FydChuKm4rZSplKTtyZXR1cm5bTWF0aC5hdGFuMihuLGUpL2ksMipNYXRoLmF0YW4oTWF0aC5wb3coby9yLDEvaSkpLUxhXX0sZSk6U3J9ZnVuY3Rpb24gd3Iobix0KXtmdW5jdGlvbiBlKG4sdCl7dmFyIGU9aS10O3JldHVybltlKk1hdGguc2luKHUqbiksaS1lKk1hdGguY29zKHUqbildfXZhciByPU1hdGguY29zKG4pLHU9bj09PXQ/TWF0aC5zaW4obik6KHItTWF0aC5jb3ModCkpLyh0LW4pLGk9ci91K247cmV0dXJuIGZhKHUpPFRhP2FyOihlLmludmVydD1mdW5jdGlvbihuLHQpe3ZhciBlPWktdDtyZXR1cm5bTWF0aC5hdGFuMihuLGUpL3UsaS1CKHUpKk1hdGguc3FydChuKm4rZSplKV19LGUpfWZ1bmN0aW9uIFNyKG4sdCl7cmV0dXJuW24sTWF0aC5sb2coTWF0aC50YW4oQWEvNCt0LzIpKV19ZnVuY3Rpb24ga3Iobil7dmFyIHQsZT11cihuKSxyPWUuc2NhbGUsdT1lLnRyYW5zbGF0ZSxpPWUuY2xpcEV4dGVudDtyZXR1cm4gZS5zY2FsZT1mdW5jdGlvbigpe3ZhciBuPXIuYXBwbHkoZSxhcmd1bWVudHMpO3JldHVybiBuPT09ZT90P2UuY2xpcEV4dGVudChudWxsKTplOm59LGUudHJhbnNsYXRlPWZ1bmN0aW9uKCl7dmFyIG49dS5hcHBseShlLGFyZ3VtZW50cyk7cmV0dXJuIG49PT1lP3Q/ZS5jbGlwRXh0ZW50KG51bGwpOmU6bn0sZS5jbGlwRXh0ZW50PWZ1bmN0aW9uKG4pe3ZhciBvPWkuYXBwbHkoZSxhcmd1bWVudHMpO2lmKG89PT1lKXtpZih0PW51bGw9PW4pe3ZhciBhPUFhKnIoKSxjPXUoKTtpKFtbY1swXS1hLGNbMV0tYV0sW2NbMF0rYSxjWzFdK2FdXSl9fWVsc2UgdCYmKG89bnVsbCk7cmV0dXJuIG99LGUuY2xpcEV4dGVudChudWxsKX1mdW5jdGlvbiBFcihuLHQpe3JldHVybltNYXRoLmxvZyhNYXRoLnRhbihBYS80K3QvMikpLC1uXX1mdW5jdGlvbiBOcihuKXtyZXR1cm4gblswXX1mdW5jdGlvbiBBcihuKXtyZXR1cm4gblsxXX1mdW5jdGlvbiBDcihuKXtmb3IodmFyIHQ9bi5sZW5ndGgsZT1bMCwxXSxyPTIsdT0yO3Q+dTt1Kyspe2Zvcig7cj4xJiZKKG5bZVtyLTJdXSxuW2Vbci0xXV0sblt1XSk8PTA7KS0tcjtlW3IrK109dX1yZXR1cm4gZS5zbGljZSgwLHIpfWZ1bmN0aW9uIExyKG4sdCl7cmV0dXJuIG5bMF0tdFswXXx8blsxXS10WzFdfWZ1bmN0aW9uIFRyKG4sdCxlKXtyZXR1cm4oZVswXS10WzBdKSooblsxXS10WzFdKTwoZVsxXS10WzFdKSooblswXS10WzBdKX1mdW5jdGlvbiBxcihuLHQsZSxyKXt2YXIgdT1uWzBdLGk9ZVswXSxvPXRbMF0tdSxhPXJbMF0taSxjPW5bMV0scz1lWzFdLGw9dFsxXS1jLGY9clsxXS1zLGg9KGEqKGMtcyktZioodS1pKSkvKGYqby1hKmwpO3JldHVyblt1K2gqbyxjK2gqbF19ZnVuY3Rpb24genIobil7dmFyIHQ9blswXSxlPW5bbi5sZW5ndGgtMV07cmV0dXJuISh0WzBdLWVbMF18fHRbMV0tZVsxXSl9ZnVuY3Rpb24gUnIoKXt0dSh0aGlzKSx0aGlzLmVkZ2U9dGhpcy5zaXRlPXRoaXMuY2lyY2xlPW51bGx9ZnVuY3Rpb24gRHIobil7dmFyIHQ9bnMucG9wKCl8fG5ldyBScjtyZXR1cm4gdC5zaXRlPW4sdH1mdW5jdGlvbiBQcihuKXskcihuKSxHYy5yZW1vdmUobiksbnMucHVzaChuKSx0dShuKX1mdW5jdGlvbiBVcihuKXt2YXIgdD1uLmNpcmNsZSxlPXQueCxyPXQuY3ksdT17eDplLHk6cn0saT1uLlAsbz1uLk4sYT1bbl07UHIobik7Zm9yKHZhciBjPWk7Yy5jaXJjbGUmJmZhKGUtYy5jaXJjbGUueCk8VGEmJmZhKHItYy5jaXJjbGUuY3kpPFRhOylpPWMuUCxhLnVuc2hpZnQoYyksUHIoYyksYz1pO2EudW5zaGlmdChjKSwkcihjKTtmb3IodmFyIHM9bztzLmNpcmNsZSYmZmEoZS1zLmNpcmNsZS54KTxUYSYmZmEoci1zLmNpcmNsZS5jeSk8VGE7KW89cy5OLGEucHVzaChzKSxQcihzKSxzPW87YS5wdXNoKHMpLCRyKHMpO3ZhciBsLGY9YS5sZW5ndGg7Zm9yKGw9MTtmPmw7KytsKXM9YVtsXSxjPWFbbC0xXSxLcihzLmVkZ2UsYy5zaXRlLHMuc2l0ZSx1KTtjPWFbMF0scz1hW2YtMV0scy5lZGdlPVdyKGMuc2l0ZSxzLnNpdGUsbnVsbCx1KSxWcihjKSxWcihzKX1mdW5jdGlvbiBqcihuKXtmb3IodmFyIHQsZSxyLHUsaT1uLngsbz1uLnksYT1HYy5fO2E7KWlmKHI9SHIoYSxvKS1pLHI+VGEpYT1hLkw7ZWxzZXtpZih1PWktRnIoYSxvKSwhKHU+VGEpKXtyPi1UYT8odD1hLlAsZT1hKTp1Pi1UYT8odD1hLGU9YS5OKTp0PWU9YTticmVha31pZighYS5SKXt0PWE7YnJlYWt9YT1hLlJ9dmFyIGM9RHIobik7aWYoR2MuaW5zZXJ0KHQsYyksdHx8ZSl7aWYodD09PWUpcmV0dXJuICRyKHQpLGU9RHIodC5zaXRlKSxHYy5pbnNlcnQoYyxlKSxjLmVkZ2U9ZS5lZGdlPVdyKHQuc2l0ZSxjLnNpdGUpLFZyKHQpLFZyKGUpLHZvaWQgMDtpZighZSlyZXR1cm4gYy5lZGdlPVdyKHQuc2l0ZSxjLnNpdGUpLHZvaWQgMDskcih0KSwkcihlKTt2YXIgcz10LnNpdGUsbD1zLngsZj1zLnksaD1uLngtbCxnPW4ueS1mLHA9ZS5zaXRlLHY9cC54LWwsZD1wLnktZixtPTIqKGgqZC1nKnYpLHk9aCpoK2cqZyx4PXYqditkKmQsTT17eDooZCp5LWcqeCkvbStsLHk6KGgqeC12KnkpL20rZn07S3IoZS5lZGdlLHMscCxNKSxjLmVkZ2U9V3IocyxuLG51bGwsTSksZS5lZGdlPVdyKG4scCxudWxsLE0pLFZyKHQpLFZyKGUpfX1mdW5jdGlvbiBIcihuLHQpe3ZhciBlPW4uc2l0ZSxyPWUueCx1PWUueSxpPXUtdDtpZighaSlyZXR1cm4gcjt2YXIgbz1uLlA7aWYoIW8pcmV0dXJuLTEvMDtlPW8uc2l0ZTt2YXIgYT1lLngsYz1lLnkscz1jLXQ7aWYoIXMpcmV0dXJuIGE7dmFyIGw9YS1yLGY9MS9pLTEvcyxoPWwvcztyZXR1cm4gZj8oLWgrTWF0aC5zcXJ0KGgqaC0yKmYqKGwqbC8oLTIqcyktYytzLzIrdS1pLzIpKSkvZityOihyK2EpLzJ9ZnVuY3Rpb24gRnIobix0KXt2YXIgZT1uLk47aWYoZSlyZXR1cm4gSHIoZSx0KTt2YXIgcj1uLnNpdGU7cmV0dXJuIHIueT09PXQ/ci54OjEvMH1mdW5jdGlvbiBPcihuKXt0aGlzLnNpdGU9bix0aGlzLmVkZ2VzPVtdfWZ1bmN0aW9uIFlyKG4pe2Zvcih2YXIgdCxlLHIsdSxpLG8sYSxjLHMsbCxmPW5bMF1bMF0saD1uWzFdWzBdLGc9blswXVsxXSxwPW5bMV1bMV0sdj1XYyxkPXYubGVuZ3RoO2QtLTspaWYoaT12W2RdLGkmJmkucHJlcGFyZSgpKWZvcihhPWkuZWRnZXMsYz1hLmxlbmd0aCxvPTA7Yz5vOylsPWFbb10uZW5kKCkscj1sLngsdT1sLnkscz1hWysrbyVjXS5zdGFydCgpLHQ9cy54LGU9cy55LChmYShyLXQpPlRhfHxmYSh1LWUpPlRhKSYmKGEuc3BsaWNlKG8sMCxuZXcgUXIoR3IoaS5zaXRlLGwsZmEoci1mKTxUYSYmcC11PlRhP3t4OmYseTpmYSh0LWYpPFRhP2U6cH06ZmEodS1wKTxUYSYmaC1yPlRhP3t4OmZhKGUtcCk8VGE/dDpoLHk6cH06ZmEoci1oKTxUYSYmdS1nPlRhP3t4OmgseTpmYSh0LWgpPFRhP2U6Z306ZmEodS1nKTxUYSYmci1mPlRhP3t4OmZhKGUtZyk8VGE/dDpmLHk6Z306bnVsbCksaS5zaXRlLG51bGwpKSwrK2MpfWZ1bmN0aW9uIElyKG4sdCl7cmV0dXJuIHQuYW5nbGUtbi5hbmdsZX1mdW5jdGlvbiBacigpe3R1KHRoaXMpLHRoaXMueD10aGlzLnk9dGhpcy5hcmM9dGhpcy5zaXRlPXRoaXMuY3k9bnVsbH1mdW5jdGlvbiBWcihuKXt2YXIgdD1uLlAsZT1uLk47aWYodCYmZSl7dmFyIHI9dC5zaXRlLHU9bi5zaXRlLGk9ZS5zaXRlO2lmKHIhPT1pKXt2YXIgbz11LngsYT11LnksYz1yLngtbyxzPXIueS1hLGw9aS54LW8sZj1pLnktYSxoPTIqKGMqZi1zKmwpO2lmKCEoaD49LXFhKSl7dmFyIGc9YypjK3MqcyxwPWwqbCtmKmYsdj0oZipnLXMqcCkvaCxkPShjKnAtbCpnKS9oLGY9ZCthLG09dHMucG9wKCl8fG5ldyBacjttLmFyYz1uLG0uc2l0ZT11LG0ueD12K28sbS55PWYrTWF0aC5zcXJ0KHYqditkKmQpLG0uY3k9ZixuLmNpcmNsZT1tO2Zvcih2YXIgeT1udWxsLHg9UWMuXzt4OylpZihtLnk8eC55fHxtLnk9PT14LnkmJm0ueDw9eC54KXtpZigheC5MKXt5PXguUDticmVha314PXguTH1lbHNle2lmKCF4LlIpe3k9eDticmVha314PXguUn1RYy5pbnNlcnQoeSxtKSx5fHwoS2M9bSl9fX19ZnVuY3Rpb24gJHIobil7dmFyIHQ9bi5jaXJjbGU7dCYmKHQuUHx8KEtjPXQuTiksUWMucmVtb3ZlKHQpLHRzLnB1c2godCksdHUodCksbi5jaXJjbGU9bnVsbCl9ZnVuY3Rpb24gWHIobil7Zm9yKHZhciB0LGU9SmMscj1GZShuWzBdWzBdLG5bMF1bMV0sblsxXVswXSxuWzFdWzFdKSx1PWUubGVuZ3RoO3UtLTspdD1lW3VdLCghQnIodCxuKXx8IXIodCl8fGZhKHQuYS54LXQuYi54KTxUYSYmZmEodC5hLnktdC5iLnkpPFRhKSYmKHQuYT10LmI9bnVsbCxlLnNwbGljZSh1LDEpKX1mdW5jdGlvbiBCcihuLHQpe3ZhciBlPW4uYjtpZihlKXJldHVybiEwO3ZhciByLHUsaT1uLmEsbz10WzBdWzBdLGE9dFsxXVswXSxjPXRbMF1bMV0scz10WzFdWzFdLGw9bi5sLGY9bi5yLGg9bC54LGc9bC55LHA9Zi54LHY9Zi55LGQ9KGgrcCkvMixtPShnK3YpLzI7aWYodj09PWcpe2lmKG8+ZHx8ZD49YSlyZXR1cm47aWYoaD5wKXtpZihpKXtpZihpLnk+PXMpcmV0dXJufWVsc2UgaT17eDpkLHk6Y307ZT17eDpkLHk6c319ZWxzZXtpZihpKXtpZihpLnk8YylyZXR1cm59ZWxzZSBpPXt4OmQseTpzfTtlPXt4OmQseTpjfX19ZWxzZSBpZihyPShoLXApLyh2LWcpLHU9bS1yKmQsLTE+cnx8cj4xKWlmKGg+cCl7aWYoaSl7aWYoaS55Pj1zKXJldHVybn1lbHNlIGk9e3g6KGMtdSkvcix5OmN9O2U9e3g6KHMtdSkvcix5OnN9fWVsc2V7aWYoaSl7aWYoaS55PGMpcmV0dXJufWVsc2UgaT17eDoocy11KS9yLHk6c307ZT17eDooYy11KS9yLHk6Y319ZWxzZSBpZih2Pmcpe2lmKGkpe2lmKGkueD49YSlyZXR1cm59ZWxzZSBpPXt4Om8seTpyKm8rdX07ZT17eDphLHk6ciphK3V9fWVsc2V7aWYoaSl7aWYoaS54PG8pcmV0dXJufWVsc2UgaT17eDphLHk6ciphK3V9O2U9e3g6byx5OnIqbyt1fX1yZXR1cm4gbi5hPWksbi5iPWUsITB9ZnVuY3Rpb24gSnIobix0KXt0aGlzLmw9bix0aGlzLnI9dCx0aGlzLmE9dGhpcy5iPW51bGx9ZnVuY3Rpb24gV3Iobix0LGUscil7dmFyIHU9bmV3IEpyKG4sdCk7cmV0dXJuIEpjLnB1c2godSksZSYmS3IodSxuLHQsZSksciYmS3IodSx0LG4sciksV2Nbbi5pXS5lZGdlcy5wdXNoKG5ldyBRcih1LG4sdCkpLFdjW3QuaV0uZWRnZXMucHVzaChuZXcgUXIodSx0LG4pKSx1fWZ1bmN0aW9uIEdyKG4sdCxlKXt2YXIgcj1uZXcgSnIobixudWxsKTtyZXR1cm4gci5hPXQsci5iPWUsSmMucHVzaChyKSxyfWZ1bmN0aW9uIEtyKG4sdCxlLHIpe24uYXx8bi5iP24ubD09PWU/bi5iPXI6bi5hPXI6KG4uYT1yLG4ubD10LG4ucj1lKX1mdW5jdGlvbiBRcihuLHQsZSl7dmFyIHI9bi5hLHU9bi5iO3RoaXMuZWRnZT1uLHRoaXMuc2l0ZT10LHRoaXMuYW5nbGU9ZT9NYXRoLmF0YW4yKGUueS10LnksZS54LXQueCk6bi5sPT09dD9NYXRoLmF0YW4yKHUueC1yLngsci55LXUueSk6TWF0aC5hdGFuMihyLngtdS54LHUueS1yLnkpfWZ1bmN0aW9uIG51KCl7dGhpcy5fPW51bGx9ZnVuY3Rpb24gdHUobil7bi5VPW4uQz1uLkw9bi5SPW4uUD1uLk49bnVsbH1mdW5jdGlvbiBldShuLHQpe3ZhciBlPXQscj10LlIsdT1lLlU7dT91Lkw9PT1lP3UuTD1yOnUuUj1yOm4uXz1yLHIuVT11LGUuVT1yLGUuUj1yLkwsZS5SJiYoZS5SLlU9ZSksci5MPWV9ZnVuY3Rpb24gcnUobix0KXt2YXIgZT10LHI9dC5MLHU9ZS5VO3U/dS5MPT09ZT91Lkw9cjp1LlI9cjpuLl89cixyLlU9dSxlLlU9cixlLkw9ci5SLGUuTCYmKGUuTC5VPWUpLHIuUj1lfWZ1bmN0aW9uIHV1KG4pe2Zvcig7bi5MOyluPW4uTDtyZXR1cm4gbn1mdW5jdGlvbiBpdShuLHQpe3ZhciBlLHIsdSxpPW4uc29ydChvdSkucG9wKCk7Zm9yKEpjPVtdLFdjPW5ldyBBcnJheShuLmxlbmd0aCksR2M9bmV3IG51LFFjPW5ldyBudTs7KWlmKHU9S2MsaSYmKCF1fHxpLnk8dS55fHxpLnk9PT11LnkmJmkueDx1LngpKShpLnghPT1lfHxpLnkhPT1yKSYmKFdjW2kuaV09bmV3IE9yKGkpLGpyKGkpLGU9aS54LHI9aS55KSxpPW4ucG9wKCk7ZWxzZXtpZighdSlicmVhaztVcih1LmFyYyl9dCYmKFhyKHQpLFlyKHQpKTt2YXIgbz17Y2VsbHM6V2MsZWRnZXM6SmN9O3JldHVybiBHYz1RYz1KYz1XYz1udWxsLG99ZnVuY3Rpb24gb3Uobix0KXtyZXR1cm4gdC55LW4ueXx8dC54LW4ueH1mdW5jdGlvbiBhdShuLHQsZSl7cmV0dXJuKG4ueC1lLngpKih0Lnktbi55KS0obi54LXQueCkqKGUueS1uLnkpfWZ1bmN0aW9uIGN1KG4pe3JldHVybiBuLnh9ZnVuY3Rpb24gc3Uobil7cmV0dXJuIG4ueX1mdW5jdGlvbiBsdSgpe3JldHVybntsZWFmOiEwLG5vZGVzOltdLHBvaW50Om51bGwseDpudWxsLHk6bnVsbH19ZnVuY3Rpb24gZnUobix0LGUscix1LGkpe2lmKCFuKHQsZSxyLHUsaSkpe3ZhciBvPS41KihlK3UpLGE9LjUqKHIraSksYz10Lm5vZGVzO2NbMF0mJmZ1KG4sY1swXSxlLHIsbyxhKSxjWzFdJiZmdShuLGNbMV0sbyxyLHUsYSksY1syXSYmZnUobixjWzJdLGUsYSxvLGkpLGNbM10mJmZ1KG4sY1szXSxvLGEsdSxpKX19ZnVuY3Rpb24gaHUobix0KXtuPUdvLnJnYihuKSx0PUdvLnJnYih0KTt2YXIgZT1uLnIscj1uLmcsdT1uLmIsaT10LnItZSxvPXQuZy1yLGE9dC5iLXU7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiIjIitNdChNYXRoLnJvdW5kKGUraSpuKSkrTXQoTWF0aC5yb3VuZChyK28qbikpK010KE1hdGgucm91bmQodSthKm4pKX19ZnVuY3Rpb24gZ3Uobix0KXt2YXIgZSxyPXt9LHU9e307Zm9yKGUgaW4gbillIGluIHQ/cltlXT1kdShuW2VdLHRbZV0pOnVbZV09bltlXTtmb3IoZSBpbiB0KWUgaW4gbnx8KHVbZV09dFtlXSk7cmV0dXJuIGZ1bmN0aW9uKG4pe2ZvcihlIGluIHIpdVtlXT1yW2VdKG4pO3JldHVybiB1fX1mdW5jdGlvbiBwdShuLHQpe3JldHVybiB0LT1uPStuLGZ1bmN0aW9uKGUpe3JldHVybiBuK3QqZX19ZnVuY3Rpb24gdnUobix0KXt2YXIgZSxyLHUsaSxvLGE9MCxjPTAscz1bXSxsPVtdO2ZvcihuKz0iIix0Kz0iIixycy5sYXN0SW5kZXg9MCxyPTA7ZT1ycy5leGVjKHQpOysrcillLmluZGV4JiZzLnB1c2godC5zdWJzdHJpbmcoYSxjPWUuaW5kZXgpKSxsLnB1c2goe2k6cy5sZW5ndGgseDplWzBdfSkscy5wdXNoKG51bGwpLGE9cnMubGFzdEluZGV4O2ZvcihhPHQubGVuZ3RoJiZzLnB1c2godC5zdWJzdHJpbmcoYSkpLHI9MCxpPWwubGVuZ3RoOyhlPXJzLmV4ZWMobikpJiZpPnI7KytyKWlmKG89bFtyXSxvLng9PWVbMF0pe2lmKG8uaSlpZihudWxsPT1zW28uaSsxXSlmb3Ioc1tvLmktMV0rPW8ueCxzLnNwbGljZShvLmksMSksdT1yKzE7aT51OysrdSlsW3VdLmktLTtlbHNlIGZvcihzW28uaS0xXSs9by54K3Nbby5pKzFdLHMuc3BsaWNlKG8uaSwyKSx1PXIrMTtpPnU7Kyt1KWxbdV0uaS09MjtlbHNlIGlmKG51bGw9PXNbby5pKzFdKXNbby5pXT1vLng7ZWxzZSBmb3Ioc1tvLmldPW8ueCtzW28uaSsxXSxzLnNwbGljZShvLmkrMSwxKSx1PXIrMTtpPnU7Kyt1KWxbdV0uaS0tO2wuc3BsaWNlKHIsMSksaS0tLHItLX1lbHNlIG8ueD1wdShwYXJzZUZsb2F0KGVbMF0pLHBhcnNlRmxvYXQoby54KSk7Zm9yKDtpPnI7KW89bC5wb3AoKSxudWxsPT1zW28uaSsxXT9zW28uaV09by54OihzW28uaV09by54K3Nbby5pKzFdLHMuc3BsaWNlKG8uaSsxLDEpKSxpLS07cmV0dXJuIDE9PT1zLmxlbmd0aD9udWxsPT1zWzBdPyhvPWxbMF0ueCxmdW5jdGlvbihuKXtyZXR1cm4gbyhuKSsiIn0pOmZ1bmN0aW9uKCl7cmV0dXJuIHR9OmZ1bmN0aW9uKG4pe2ZvcihyPTA7aT5yOysrcilzWyhvPWxbcl0pLmldPW8ueChuKTtyZXR1cm4gcy5qb2luKCIiKX19ZnVuY3Rpb24gZHUobix0KXtmb3IodmFyIGUscj1Hby5pbnRlcnBvbGF0b3JzLmxlbmd0aDstLXI+PTAmJiEoZT1Hby5pbnRlcnBvbGF0b3JzW3JdKG4sdCkpOyk7cmV0dXJuIGV9ZnVuY3Rpb24gbXUobix0KXt2YXIgZSxyPVtdLHU9W10saT1uLmxlbmd0aCxvPXQubGVuZ3RoLGE9TWF0aC5taW4obi5sZW5ndGgsdC5sZW5ndGgpO2ZvcihlPTA7YT5lOysrZSlyLnB1c2goZHUobltlXSx0W2VdKSk7Zm9yKDtpPmU7KytlKXVbZV09bltlXTtmb3IoO28+ZTsrK2UpdVtlXT10W2VdO3JldHVybiBmdW5jdGlvbihuKXtmb3IoZT0wO2E+ZTsrK2UpdVtlXT1yW2VdKG4pO3JldHVybiB1fX1mdW5jdGlvbiB5dShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDA+PXQ/MDp0Pj0xPzE6bih0KX19ZnVuY3Rpb24geHUobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiAxLW4oMS10KX19ZnVuY3Rpb24gTXUobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybi41KiguNT50P24oMip0KToyLW4oMi0yKnQpKX19ZnVuY3Rpb24gX3Uobil7cmV0dXJuIG4qbn1mdW5jdGlvbiBidShuKXtyZXR1cm4gbipuKm59ZnVuY3Rpb24gd3Uobil7aWYoMD49bilyZXR1cm4gMDtpZihuPj0xKXJldHVybiAxO3ZhciB0PW4qbixlPXQqbjtyZXR1cm4gNCooLjU+bj9lOjMqKG4tdCkrZS0uNzUpfWZ1bmN0aW9uIFN1KG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5wb3codCxuKX19ZnVuY3Rpb24ga3Uobil7cmV0dXJuIDEtTWF0aC5jb3MobipMYSl9ZnVuY3Rpb24gRXUobil7cmV0dXJuIE1hdGgucG93KDIsMTAqKG4tMSkpfWZ1bmN0aW9uIE51KG4pe3JldHVybiAxLU1hdGguc3FydCgxLW4qbil9ZnVuY3Rpb24gQXUobix0KXt2YXIgZTtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyJiYodD0uNDUpLGFyZ3VtZW50cy5sZW5ndGg/ZT10L0NhKk1hdGguYXNpbigxL24pOihuPTEsZT10LzQpLGZ1bmN0aW9uKHIpe3JldHVybiAxK24qTWF0aC5wb3coMiwtMTAqcikqTWF0aC5zaW4oKHItZSkqQ2EvdCl9fWZ1bmN0aW9uIEN1KG4pe3JldHVybiBufHwobj0xLjcwMTU4KSxmdW5jdGlvbih0KXtyZXR1cm4gdCp0KigobisxKSp0LW4pfX1mdW5jdGlvbiBMdShuKXtyZXR1cm4gMS8yLjc1Pm4/Ny41NjI1Km4qbjoyLzIuNzU+bj83LjU2MjUqKG4tPTEuNS8yLjc1KSpuKy43NToyLjUvMi43NT5uPzcuNTYyNSoobi09Mi4yNS8yLjc1KSpuKy45Mzc1OjcuNTYyNSoobi09Mi42MjUvMi43NSkqbisuOTg0Mzc1fWZ1bmN0aW9uIFR1KG4sdCl7bj1Hby5oY2wobiksdD1Hby5oY2wodCk7dmFyIGU9bi5oLHI9bi5jLHU9bi5sLGk9dC5oLWUsbz10LmMtcixhPXQubC11O3JldHVybiBpc05hTihvKSYmKG89MCxyPWlzTmFOKHIpP3QuYzpyKSxpc05hTihpKT8oaT0wLGU9aXNOYU4oZSk/dC5oOmUpOmk+MTgwP2ktPTM2MDotMTgwPmkmJihpKz0zNjApLGZ1bmN0aW9uKG4pe3JldHVybiBjdChlK2kqbixyK28qbix1K2EqbikrIiJ9fWZ1bmN0aW9uIHF1KG4sdCl7bj1Hby5oc2wobiksdD1Hby5oc2wodCk7dmFyIGU9bi5oLHI9bi5zLHU9bi5sLGk9dC5oLWUsbz10LnMtcixhPXQubC11O3JldHVybiBpc05hTihvKSYmKG89MCxyPWlzTmFOKHIpP3QuczpyKSxpc05hTihpKT8oaT0wLGU9aXNOYU4oZSk/dC5oOmUpOmk+MTgwP2ktPTM2MDotMTgwPmkmJihpKz0zNjApLGZ1bmN0aW9uKG4pe3JldHVybiBpdChlK2kqbixyK28qbix1K2EqbikrIiJ9fWZ1bmN0aW9uIHp1KG4sdCl7bj1Hby5sYWIobiksdD1Hby5sYWIodCk7dmFyIGU9bi5sLHI9bi5hLHU9bi5iLGk9dC5sLWUsbz10LmEtcixhPXQuYi11O3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gZnQoZStpKm4scitvKm4sdSthKm4pKyIifX1mdW5jdGlvbiBSdShuLHQpe3JldHVybiB0LT1uLGZ1bmN0aW9uKGUpe3JldHVybiBNYXRoLnJvdW5kKG4rdCplKX19ZnVuY3Rpb24gRHUobil7dmFyIHQ9W24uYSxuLmJdLGU9W24uYyxuLmRdLHI9VXUodCksdT1QdSh0LGUpLGk9VXUoanUoZSx0LC11KSl8fDA7dFswXSplWzFdPGVbMF0qdFsxXSYmKHRbMF0qPS0xLHRbMV0qPS0xLHIqPS0xLHUqPS0xKSx0aGlzLnJvdGF0ZT0ocj9NYXRoLmF0YW4yKHRbMV0sdFswXSk6TWF0aC5hdGFuMigtZVswXSxlWzFdKSkqUmEsdGhpcy50cmFuc2xhdGU9W24uZSxuLmZdLHRoaXMuc2NhbGU9W3IsaV0sdGhpcy5za2V3PWk/TWF0aC5hdGFuMih1LGkpKlJhOjB9ZnVuY3Rpb24gUHUobix0KXtyZXR1cm4gblswXSp0WzBdK25bMV0qdFsxXX1mdW5jdGlvbiBVdShuKXt2YXIgdD1NYXRoLnNxcnQoUHUobixuKSk7cmV0dXJuIHQmJihuWzBdLz10LG5bMV0vPXQpLHR9ZnVuY3Rpb24ganUobix0LGUpe3JldHVybiBuWzBdKz1lKnRbMF0sblsxXSs9ZSp0WzFdLG59ZnVuY3Rpb24gSHUobix0KXt2YXIgZSxyPVtdLHU9W10saT1Hby50cmFuc2Zvcm0obiksbz1Hby50cmFuc2Zvcm0odCksYT1pLnRyYW5zbGF0ZSxjPW8udHJhbnNsYXRlLHM9aS5yb3RhdGUsbD1vLnJvdGF0ZSxmPWkuc2tldyxoPW8uc2tldyxnPWkuc2NhbGUscD1vLnNjYWxlO3JldHVybiBhWzBdIT1jWzBdfHxhWzFdIT1jWzFdPyhyLnB1c2goInRyYW5zbGF0ZSgiLG51bGwsIiwiLG51bGwsIikiKSx1LnB1c2goe2k6MSx4OnB1KGFbMF0sY1swXSl9LHtpOjMseDpwdShhWzFdLGNbMV0pfSkpOmNbMF18fGNbMV0/ci5wdXNoKCJ0cmFuc2xhdGUoIitjKyIpIik6ci5wdXNoKCIiKSxzIT1sPyhzLWw+MTgwP2wrPTM2MDpsLXM+MTgwJiYocys9MzYwKSx1LnB1c2goe2k6ci5wdXNoKHIucG9wKCkrInJvdGF0ZSgiLG51bGwsIikiKS0yLHg6cHUocyxsKX0pKTpsJiZyLnB1c2goci5wb3AoKSsicm90YXRlKCIrbCsiKSIpLGYhPWg/dS5wdXNoKHtpOnIucHVzaChyLnBvcCgpKyJza2V3WCgiLG51bGwsIikiKS0yLHg6cHUoZixoKX0pOmgmJnIucHVzaChyLnBvcCgpKyJza2V3WCgiK2grIikiKSxnWzBdIT1wWzBdfHxnWzFdIT1wWzFdPyhlPXIucHVzaChyLnBvcCgpKyJzY2FsZSgiLG51bGwsIiwiLG51bGwsIikiKSx1LnB1c2goe2k6ZS00LHg6cHUoZ1swXSxwWzBdKX0se2k6ZS0yLHg6cHUoZ1sxXSxwWzFdKX0pKTooMSE9cFswXXx8MSE9cFsxXSkmJnIucHVzaChyLnBvcCgpKyJzY2FsZSgiK3ArIikiKSxlPXUubGVuZ3RoLGZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxpPS0xOysraTxlOylyWyh0PXVbaV0pLmldPXQueChuKTtyZXR1cm4gci5qb2luKCIiKX19ZnVuY3Rpb24gRnUobix0KXtyZXR1cm4gdD10LShuPStuKT8xLyh0LW4pOjAsZnVuY3Rpb24oZSl7cmV0dXJuKGUtbikqdH19ZnVuY3Rpb24gT3Uobix0KXtyZXR1cm4gdD10LShuPStuKT8xLyh0LW4pOjAsZnVuY3Rpb24oZSl7cmV0dXJuIE1hdGgubWF4KDAsTWF0aC5taW4oMSwoZS1uKSp0KSl9fWZ1bmN0aW9uIFl1KG4pe2Zvcih2YXIgdD1uLnNvdXJjZSxlPW4udGFyZ2V0LHI9WnUodCxlKSx1PVt0XTt0IT09cjspdD10LnBhcmVudCx1LnB1c2godCk7Zm9yKHZhciBpPXUubGVuZ3RoO2UhPT1yOyl1LnNwbGljZShpLDAsZSksZT1lLnBhcmVudDtyZXR1cm4gdX1mdW5jdGlvbiBJdShuKXtmb3IodmFyIHQ9W10sZT1uLnBhcmVudDtudWxsIT1lOyl0LnB1c2gobiksbj1lLGU9ZS5wYXJlbnQ7cmV0dXJuIHQucHVzaChuKSx0fWZ1bmN0aW9uIFp1KG4sdCl7aWYobj09PXQpcmV0dXJuIG47Zm9yKHZhciBlPUl1KG4pLHI9SXUodCksdT1lLnBvcCgpLGk9ci5wb3AoKSxvPW51bGw7dT09PWk7KW89dSx1PWUucG9wKCksaT1yLnBvcCgpO3JldHVybiBvfWZ1bmN0aW9uIFZ1KG4pe24uZml4ZWR8PTJ9ZnVuY3Rpb24gJHUobil7bi5maXhlZCY9LTd9ZnVuY3Rpb24gWHUobil7bi5maXhlZHw9NCxuLnB4PW4ueCxuLnB5PW4ueX1mdW5jdGlvbiBCdShuKXtuLmZpeGVkJj0tNX1mdW5jdGlvbiBKdShuLHQsZSl7dmFyIHI9MCx1PTA7aWYobi5jaGFyZ2U9MCwhbi5sZWFmKWZvcih2YXIgaSxvPW4ubm9kZXMsYT1vLmxlbmd0aCxjPS0xOysrYzxhOylpPW9bY10sbnVsbCE9aSYmKEp1KGksdCxlKSxuLmNoYXJnZSs9aS5jaGFyZ2Uscis9aS5jaGFyZ2UqaS5jeCx1Kz1pLmNoYXJnZSppLmN5KTtpZihuLnBvaW50KXtuLmxlYWZ8fChuLnBvaW50LngrPU1hdGgucmFuZG9tKCktLjUsbi5wb2ludC55Kz1NYXRoLnJhbmRvbSgpLS41KTt2YXIgcz10KmVbbi5wb2ludC5pbmRleF07bi5jaGFyZ2UrPW4ucG9pbnRDaGFyZ2U9cyxyKz1zKm4ucG9pbnQueCx1Kz1zKm4ucG9pbnQueX1uLmN4PXIvbi5jaGFyZ2Usbi5jeT11L24uY2hhcmdlfWZ1bmN0aW9uIFd1KG4sdCl7cmV0dXJuIEdvLnJlYmluZChuLHQsInNvcnQiLCJjaGlsZHJlbiIsInZhbHVlIiksbi5ub2Rlcz1uLG4ubGlua3M9bmksbn1mdW5jdGlvbiBHdShuKXtyZXR1cm4gbi5jaGlsZHJlbn1mdW5jdGlvbiBLdShuKXtyZXR1cm4gbi52YWx1ZX1mdW5jdGlvbiBRdShuLHQpe3JldHVybiB0LnZhbHVlLW4udmFsdWV9ZnVuY3Rpb24gbmkobil7cmV0dXJuIEdvLm1lcmdlKG4ubWFwKGZ1bmN0aW9uKG4pe3JldHVybihuLmNoaWxkcmVufHxbXSkubWFwKGZ1bmN0aW9uKHQpe3JldHVybntzb3VyY2U6bix0YXJnZXQ6dH19KX0pKX1mdW5jdGlvbiB0aShuKXtyZXR1cm4gbi54fWZ1bmN0aW9uIGVpKG4pe3JldHVybiBuLnl9ZnVuY3Rpb24gcmkobix0LGUpe24ueTA9dCxuLnk9ZX1mdW5jdGlvbiB1aShuKXtyZXR1cm4gR28ucmFuZ2Uobi5sZW5ndGgpfWZ1bmN0aW9uIGlpKG4pe2Zvcih2YXIgdD0tMSxlPW5bMF0ubGVuZ3RoLHI9W107Kyt0PGU7KXJbdF09MDtyZXR1cm4gcn1mdW5jdGlvbiBvaShuKXtmb3IodmFyIHQsZT0xLHI9MCx1PW5bMF1bMV0saT1uLmxlbmd0aDtpPmU7KytlKSh0PW5bZV1bMV0pPnUmJihyPWUsdT10KTtyZXR1cm4gcn1mdW5jdGlvbiBhaShuKXtyZXR1cm4gbi5yZWR1Y2UoY2ksMCl9ZnVuY3Rpb24gY2kobix0KXtyZXR1cm4gbit0WzFdfWZ1bmN0aW9uIHNpKG4sdCl7cmV0dXJuIGxpKG4sTWF0aC5jZWlsKE1hdGgubG9nKHQubGVuZ3RoKS9NYXRoLkxOMisxKSl9ZnVuY3Rpb24gbGkobix0KXtmb3IodmFyIGU9LTEscj0rblswXSx1PShuWzFdLXIpL3QsaT1bXTsrK2U8PXQ7KWlbZV09dSplK3I7cmV0dXJuIGl9ZnVuY3Rpb24gZmkobil7cmV0dXJuW0dvLm1pbihuKSxHby5tYXgobildfWZ1bmN0aW9uIGhpKG4sdCl7cmV0dXJuIG4ucGFyZW50PT10LnBhcmVudD8xOjJ9ZnVuY3Rpb24gZ2kobil7dmFyIHQ9bi5jaGlsZHJlbjtyZXR1cm4gdCYmdC5sZW5ndGg/dFswXTpuLl90cmVlLnRocmVhZH1mdW5jdGlvbiBwaShuKXt2YXIgdCxlPW4uY2hpbGRyZW47cmV0dXJuIGUmJih0PWUubGVuZ3RoKT9lW3QtMV06bi5fdHJlZS50aHJlYWR9ZnVuY3Rpb24gdmkobix0KXt2YXIgZT1uLmNoaWxkcmVuO2lmKGUmJih1PWUubGVuZ3RoKSlmb3IodmFyIHIsdSxpPS0xOysraTx1Oyl0KHI9dmkoZVtpXSx0KSxuKT4wJiYobj1yKTtyZXR1cm4gbn1mdW5jdGlvbiBkaShuLHQpe3JldHVybiBuLngtdC54fWZ1bmN0aW9uIG1pKG4sdCl7cmV0dXJuIHQueC1uLnh9ZnVuY3Rpb24geWkobix0KXtyZXR1cm4gbi5kZXB0aC10LmRlcHRofWZ1bmN0aW9uIHhpKG4sdCl7ZnVuY3Rpb24gZShuLHIpe3ZhciB1PW4uY2hpbGRyZW47aWYodSYmKG89dS5sZW5ndGgpKWZvcih2YXIgaSxvLGE9bnVsbCxjPS0xOysrYzxvOylpPXVbY10sZShpLGEpLGE9aTt0KG4scil9ZShuLG51bGwpfWZ1bmN0aW9uIE1pKG4pe2Zvcih2YXIgdCxlPTAscj0wLHU9bi5jaGlsZHJlbixpPXUubGVuZ3RoOy0taT49MDspdD11W2ldLl90cmVlLHQucHJlbGltKz1lLHQubW9kKz1lLGUrPXQuc2hpZnQrKHIrPXQuY2hhbmdlKX1mdW5jdGlvbiBfaShuLHQsZSl7bj1uLl90cmVlLHQ9dC5fdHJlZTt2YXIgcj1lLyh0Lm51bWJlci1uLm51bWJlcik7bi5jaGFuZ2UrPXIsdC5jaGFuZ2UtPXIsdC5zaGlmdCs9ZSx0LnByZWxpbSs9ZSx0Lm1vZCs9ZX1mdW5jdGlvbiBiaShuLHQsZSl7cmV0dXJuIG4uX3RyZWUuYW5jZXN0b3IucGFyZW50PT10LnBhcmVudD9uLl90cmVlLmFuY2VzdG9yOmV9ZnVuY3Rpb24gd2kobix0KXtyZXR1cm4gbi52YWx1ZS10LnZhbHVlfWZ1bmN0aW9uIFNpKG4sdCl7dmFyIGU9bi5fcGFja19uZXh0O24uX3BhY2tfbmV4dD10LHQuX3BhY2tfcHJldj1uLHQuX3BhY2tfbmV4dD1lLGUuX3BhY2tfcHJldj10fWZ1bmN0aW9uIGtpKG4sdCl7bi5fcGFja19uZXh0PXQsdC5fcGFja19wcmV2PW59ZnVuY3Rpb24gRWkobix0KXt2YXIgZT10Lngtbi54LHI9dC55LW4ueSx1PW4ucit0LnI7cmV0dXJuLjk5OSp1KnU+ZSplK3Iqcn1mdW5jdGlvbiBOaShuKXtmdW5jdGlvbiB0KG4pe2w9TWF0aC5taW4obi54LW4ucixsKSxmPU1hdGgubWF4KG4ueCtuLnIsZiksaD1NYXRoLm1pbihuLnktbi5yLGgpLGc9TWF0aC5tYXgobi55K24ucixnKX1pZigoZT1uLmNoaWxkcmVuKSYmKHM9ZS5sZW5ndGgpKXt2YXIgZSxyLHUsaSxvLGEsYyxzLGw9MS8wLGY9LTEvMCxoPTEvMCxnPS0xLzA7aWYoZS5mb3JFYWNoKEFpKSxyPWVbMF0sci54PS1yLnIsci55PTAsdChyKSxzPjEmJih1PWVbMV0sdS54PXUucix1Lnk9MCx0KHUpLHM+MikpZm9yKGk9ZVsyXSxUaShyLHUsaSksdChpKSxTaShyLGkpLHIuX3BhY2tfcHJldj1pLFNpKGksdSksdT1yLl9wYWNrX25leHQsbz0zO3M+bztvKyspe1RpKHIsdSxpPWVbb10pO3ZhciBwPTAsdj0xLGQ9MTtmb3IoYT11Ll9wYWNrX25leHQ7YSE9PXU7YT1hLl9wYWNrX25leHQsdisrKWlmKEVpKGEsaSkpe3A9MTticmVha31pZigxPT1wKWZvcihjPXIuX3BhY2tfcHJldjtjIT09YS5fcGFja19wcmV2JiYhRWkoYyxpKTtjPWMuX3BhY2tfcHJldixkKyspO3A/KGQ+dnx8dj09ZCYmdS5yPHIucj9raShyLHU9YSk6a2kocj1jLHUpLG8tLSk6KFNpKHIsaSksdT1pLHQoaSkpfXZhciBtPShsK2YpLzIseT0oaCtnKS8yLHg9MDtmb3Iobz0wO3M+bztvKyspaT1lW29dLGkueC09bSxpLnktPXkseD1NYXRoLm1heCh4LGkucitNYXRoLnNxcnQoaS54KmkueCtpLnkqaS55KSk7bi5yPXgsZS5mb3JFYWNoKENpKX19ZnVuY3Rpb24gQWkobil7bi5fcGFja19uZXh0PW4uX3BhY2tfcHJldj1ufWZ1bmN0aW9uIENpKG4pe2RlbGV0ZSBuLl9wYWNrX25leHQsZGVsZXRlIG4uX3BhY2tfcHJldn1mdW5jdGlvbiBMaShuLHQsZSxyKXt2YXIgdT1uLmNoaWxkcmVuO2lmKG4ueD10Kz1yKm4ueCxuLnk9ZSs9cipuLnksbi5yKj1yLHUpZm9yKHZhciBpPS0xLG89dS5sZW5ndGg7KytpPG87KUxpKHVbaV0sdCxlLHIpfWZ1bmN0aW9uIFRpKG4sdCxlKXt2YXIgcj1uLnIrZS5yLHU9dC54LW4ueCxpPXQueS1uLnk7aWYociYmKHV8fGkpKXt2YXIgbz10LnIrZS5yLGE9dSp1K2kqaTtvKj1vLHIqPXI7dmFyIGM9LjUrKHItbykvKDIqYSkscz1NYXRoLnNxcnQoTWF0aC5tYXgoMCwyKm8qKHIrYSktKHItPWEpKnItbypvKSkvKDIqYSk7ZS54PW4ueCtjKnUrcyppLGUueT1uLnkrYyppLXMqdX1lbHNlIGUueD1uLngrcixlLnk9bi55fWZ1bmN0aW9uIHFpKG4pe3JldHVybiAxK0dvLm1heChuLGZ1bmN0aW9uKG4pe3JldHVybiBuLnl9KX1mdW5jdGlvbiB6aShuKXtyZXR1cm4gbi5yZWR1Y2UoZnVuY3Rpb24obix0KXtyZXR1cm4gbit0Lnh9LDApL24ubGVuZ3RofWZ1bmN0aW9uIFJpKG4pe3ZhciB0PW4uY2hpbGRyZW47cmV0dXJuIHQmJnQubGVuZ3RoP1JpKHRbMF0pOm59ZnVuY3Rpb24gRGkobil7dmFyIHQsZT1uLmNoaWxkcmVuO3JldHVybiBlJiYodD1lLmxlbmd0aCk/RGkoZVt0LTFdKTpufWZ1bmN0aW9uIFBpKG4pe3JldHVybnt4Om4ueCx5Om4ueSxkeDpuLmR4LGR5Om4uZHl9fWZ1bmN0aW9uIFVpKG4sdCl7dmFyIGU9bi54K3RbM10scj1uLnkrdFswXSx1PW4uZHgtdFsxXS10WzNdLGk9bi5keS10WzBdLXRbMl07cmV0dXJuIDA+dSYmKGUrPXUvMix1PTApLDA+aSYmKHIrPWkvMixpPTApLHt4OmUseTpyLGR4OnUsZHk6aX19ZnVuY3Rpb24gamkobil7dmFyIHQ9blswXSxlPW5bbi5sZW5ndGgtMV07cmV0dXJuIGU+dD9bdCxlXTpbZSx0XX1mdW5jdGlvbiBIaShuKXtyZXR1cm4gbi5yYW5nZUV4dGVudD9uLnJhbmdlRXh0ZW50KCk6amkobi5yYW5nZSgpKX1mdW5jdGlvbiBGaShuLHQsZSxyKXt2YXIgdT1lKG5bMF0sblsxXSksaT1yKHRbMF0sdFsxXSk7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBpKHUobikpfX1mdW5jdGlvbiBPaShuLHQpe3ZhciBlLHI9MCx1PW4ubGVuZ3RoLTEsaT1uW3JdLG89blt1XTtyZXR1cm4gaT5vJiYoZT1yLHI9dSx1PWUsZT1pLGk9byxvPWUpLG5bcl09dC5mbG9vcihpKSxuW3VdPXQuY2VpbChvKSxufWZ1bmN0aW9uIFlpKG4pe3JldHVybiBuP3tmbG9vcjpmdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5mbG9vcih0L24pKm59LGNlaWw6ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGguY2VpbCh0L24pKm59fTpwc31mdW5jdGlvbiBJaShuLHQsZSxyKXt2YXIgdT1bXSxpPVtdLG89MCxhPU1hdGgubWluKG4ubGVuZ3RoLHQubGVuZ3RoKS0xO2ZvcihuW2FdPG5bMF0mJihuPW4uc2xpY2UoKS5yZXZlcnNlKCksdD10LnNsaWNlKCkucmV2ZXJzZSgpKTsrK288PWE7KXUucHVzaChlKG5bby0xXSxuW29dKSksaS5wdXNoKHIodFtvLTFdLHRbb10pKTtyZXR1cm4gZnVuY3Rpb24odCl7dmFyIGU9R28uYmlzZWN0KG4sdCwxLGEpLTE7cmV0dXJuIGlbZV0odVtlXSh0KSl9fWZ1bmN0aW9uIFppKG4sdCxlLHIpe2Z1bmN0aW9uIHUoKXt2YXIgdT1NYXRoLm1pbihuLmxlbmd0aCx0Lmxlbmd0aCk+Mj9JaTpGaSxjPXI/T3U6RnU7cmV0dXJuIG89dShuLHQsYyxlKSxhPXUodCxuLGMsZHUpLGl9ZnVuY3Rpb24gaShuKXtyZXR1cm4gbyhuKX12YXIgbyxhO3JldHVybiBpLmludmVydD1mdW5jdGlvbihuKXtyZXR1cm4gYShuKX0saS5kb21haW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG49dC5tYXAoTnVtYmVyKSx1KCkpOm59LGkucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bix1KCkpOnR9LGkucmFuZ2VSb3VuZD1mdW5jdGlvbihuKXtyZXR1cm4gaS5yYW5nZShuKS5pbnRlcnBvbGF0ZShSdSl9LGkuY2xhbXA9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9bix1KCkpOnJ9LGkuaW50ZXJwb2xhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix1KCkpOmV9LGkudGlja3M9ZnVuY3Rpb24odCl7cmV0dXJuIEJpKG4sdCl9LGkudGlja0Zvcm1hdD1mdW5jdGlvbih0LGUpe3JldHVybiBKaShuLHQsZSl9LGkubmljZT1mdW5jdGlvbih0KXtyZXR1cm4gJGkobix0KSx1KCl9LGkuY29weT1mdW5jdGlvbigpe3JldHVybiBaaShuLHQsZSxyKX0sdSgpfWZ1bmN0aW9uIFZpKG4sdCl7cmV0dXJuIEdvLnJlYmluZChuLHQsInJhbmdlIiwicmFuZ2VSb3VuZCIsImludGVycG9sYXRlIiwiY2xhbXAiKX1mdW5jdGlvbiAkaShuLHQpe3JldHVybiBPaShuLFlpKFhpKG4sdClbMl0pKX1mdW5jdGlvbiBYaShuLHQpe251bGw9PXQmJih0PTEwKTt2YXIgZT1qaShuKSxyPWVbMV0tZVswXSx1PU1hdGgucG93KDEwLE1hdGguZmxvb3IoTWF0aC5sb2coci90KS9NYXRoLkxOMTApKSxpPXQvcip1O3JldHVybi4xNT49aT91Kj0xMDouMzU+PWk/dSo9NTouNzU+PWkmJih1Kj0yKSxlWzBdPU1hdGguY2VpbChlWzBdL3UpKnUsZVsxXT1NYXRoLmZsb29yKGVbMV0vdSkqdSsuNSp1LGVbMl09dSxlfWZ1bmN0aW9uIEJpKG4sdCl7cmV0dXJuIEdvLnJhbmdlLmFwcGx5KEdvLFhpKG4sdCkpfWZ1bmN0aW9uIEppKG4sdCxlKXt2YXIgcj1YaShuLHQpO2lmKGUpe3ZhciB1PXJjLmV4ZWMoZSk7aWYodS5zaGlmdCgpLCJzIj09PXVbOF0pe3ZhciBpPUdvLmZvcm1hdFByZWZpeChNYXRoLm1heChmYShyWzBdKSxmYShyWzFdKSkpO3JldHVybiB1WzddfHwodVs3XT0iLiIrV2koaS5zY2FsZShyWzJdKSkpLHVbOF09ImYiLGU9R28uZm9ybWF0KHUuam9pbigiIikpLGZ1bmN0aW9uKG4pe3JldHVybiBlKGkuc2NhbGUobikpK2kuc3ltYm9sfX11WzddfHwodVs3XT0iLiIrR2kodVs4XSxyKSksZT11LmpvaW4oIiIpfWVsc2UgZT0iLC4iK1dpKHJbMl0pKyJmIjtyZXR1cm4gR28uZm9ybWF0KGUpfWZ1bmN0aW9uIFdpKG4pe3JldHVybi1NYXRoLmZsb29yKE1hdGgubG9nKG4pL01hdGguTE4xMCsuMDEpfWZ1bmN0aW9uIEdpKG4sdCl7dmFyIGU9V2kodFsyXSk7cmV0dXJuIG4gaW4gdnM/TWF0aC5hYnMoZS1XaShNYXRoLm1heChmYSh0WzBdKSxmYSh0WzFdKSkpKSsgKygiZSIhPT1uKTplLTIqKCIlIj09PW4pfWZ1bmN0aW9uIEtpKG4sdCxlLHIpe2Z1bmN0aW9uIHUobil7cmV0dXJuKGU/TWF0aC5sb2coMD5uPzA6bik6LU1hdGgubG9nKG4+MD8wOi1uKSkvTWF0aC5sb2codCl9ZnVuY3Rpb24gaShuKXtyZXR1cm4gZT9NYXRoLnBvdyh0LG4pOi1NYXRoLnBvdyh0LC1uKX1mdW5jdGlvbiBvKHQpe3JldHVybiBuKHUodCkpfXJldHVybiBvLmludmVydD1mdW5jdGlvbih0KXtyZXR1cm4gaShuLmludmVydCh0KSl9LG8uZG9tYWluPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXRbMF0+PTAsbi5kb21haW4oKHI9dC5tYXAoTnVtYmVyKSkubWFwKHUpKSxvKTpyfSxvLmJhc2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9K2Usbi5kb21haW4oci5tYXAodSkpLG8pOnR9LG8ubmljZT1mdW5jdGlvbigpe3ZhciB0PU9pKHIubWFwKHUpLGU/TWF0aDptcyk7cmV0dXJuIG4uZG9tYWluKHQpLHI9dC5tYXAoaSksb30sby50aWNrcz1mdW5jdGlvbigpe3ZhciBuPWppKHIpLG89W10sYT1uWzBdLGM9blsxXSxzPU1hdGguZmxvb3IodShhKSksbD1NYXRoLmNlaWwodShjKSksZj10JTE/Mjp0O2lmKGlzRmluaXRlKGwtcykpe2lmKGUpe2Zvcig7bD5zO3MrKylmb3IodmFyIGg9MTtmPmg7aCsrKW8ucHVzaChpKHMpKmgpO28ucHVzaChpKHMpKX1lbHNlIGZvcihvLnB1c2goaShzKSk7cysrPGw7KWZvcih2YXIgaD1mLTE7aD4wO2gtLSlvLnB1c2goaShzKSpoKTtmb3Iocz0wO29bc108YTtzKyspO2ZvcihsPW8ubGVuZ3RoO29bbC0xXT5jO2wtLSk7bz1vLnNsaWNlKHMsbCl9cmV0dXJuIG99LG8udGlja0Zvcm1hdD1mdW5jdGlvbihuLHQpe2lmKCFhcmd1bWVudHMubGVuZ3RoKXJldHVybiBkczthcmd1bWVudHMubGVuZ3RoPDI/dD1kczoiZnVuY3Rpb24iIT10eXBlb2YgdCYmKHQ9R28uZm9ybWF0KHQpKTt2YXIgcixhPU1hdGgubWF4KC4xLG4vby50aWNrcygpLmxlbmd0aCksYz1lPyhyPTFlLTEyLE1hdGguY2VpbCk6KHI9LTFlLTEyLE1hdGguZmxvb3IpO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gbi9pKGModShuKStyKSk8PWE/dChuKToiIn19LG8uY29weT1mdW5jdGlvbigpe3JldHVybiBLaShuLmNvcHkoKSx0LGUscil9LFZpKG8sbil9ZnVuY3Rpb24gUWkobix0LGUpe2Z1bmN0aW9uIHIodCl7cmV0dXJuIG4odSh0KSl9dmFyIHU9bm8odCksaT1ubygxL3QpO3JldHVybiByLmludmVydD1mdW5jdGlvbih0KXtyZXR1cm4gaShuLmludmVydCh0KSl9LHIuZG9tYWluPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuLmRvbWFpbigoZT10Lm1hcChOdW1iZXIpKS5tYXAodSkpLHIpOmV9LHIudGlja3M9ZnVuY3Rpb24obil7cmV0dXJuIEJpKGUsbil9LHIudGlja0Zvcm1hdD1mdW5jdGlvbihuLHQpe3JldHVybiBKaShlLG4sdCl9LHIubmljZT1mdW5jdGlvbihuKXtyZXR1cm4gci5kb21haW4oJGkoZSxuKSl9LHIuZXhwb25lbnQ9ZnVuY3Rpb24obyl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bm8odD1vKSxpPW5vKDEvdCksbi5kb21haW4oZS5tYXAodSkpLHIpOnR9LHIuY29weT1mdW5jdGlvbigpe3JldHVybiBRaShuLmNvcHkoKSx0LGUpfSxWaShyLG4pfWZ1bmN0aW9uIG5vKG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gMD50Py1NYXRoLnBvdygtdCxuKTpNYXRoLnBvdyh0LG4pfX1mdW5jdGlvbiB0byhuLHQpe2Z1bmN0aW9uIGUoZSl7cmV0dXJuIGlbKCh1LmdldChlKXx8KCJyYW5nZSI9PT10LnQ/dS5zZXQoZSxuLnB1c2goZSkpOjAvMCkpLTEpJWkubGVuZ3RoXX1mdW5jdGlvbiByKHQsZSl7cmV0dXJuIEdvLnJhbmdlKG4ubGVuZ3RoKS5tYXAoZnVuY3Rpb24obil7cmV0dXJuIHQrZSpufSl9dmFyIHUsaSxhO3JldHVybiBlLmRvbWFpbj1mdW5jdGlvbihyKXtpZighYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gbjtuPVtdLHU9bmV3IG87Zm9yKHZhciBpLGE9LTEsYz1yLmxlbmd0aDsrK2E8YzspdS5oYXMoaT1yW2FdKXx8dS5zZXQoaSxuLnB1c2goaSkpO3JldHVybiBlW3QudF0uYXBwbHkoZSx0LmEpfSxlLnJhbmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPW4sYT0wLHQ9e3Q6InJhbmdlIixhOmFyZ3VtZW50c30sZSk6aX0sZS5yYW5nZVBvaW50cz1mdW5jdGlvbih1LG8pe2FyZ3VtZW50cy5sZW5ndGg8MiYmKG89MCk7dmFyIGM9dVswXSxzPXVbMV0sbD0ocy1jKS8oTWF0aC5tYXgoMSxuLmxlbmd0aC0xKStvKTtyZXR1cm4gaT1yKG4ubGVuZ3RoPDI/KGMrcykvMjpjK2wqby8yLGwpLGE9MCx0PXt0OiJyYW5nZVBvaW50cyIsYTphcmd1bWVudHN9LGV9LGUucmFuZ2VCYW5kcz1mdW5jdGlvbih1LG8sYyl7YXJndW1lbnRzLmxlbmd0aDwyJiYobz0wKSxhcmd1bWVudHMubGVuZ3RoPDMmJihjPW8pO3ZhciBzPXVbMV08dVswXSxsPXVbcy0wXSxmPXVbMS1zXSxoPShmLWwpLyhuLmxlbmd0aC1vKzIqYyk7cmV0dXJuIGk9cihsK2gqYyxoKSxzJiZpLnJldmVyc2UoKSxhPWgqKDEtbyksdD17dDoicmFuZ2VCYW5kcyIsYTphcmd1bWVudHN9LGV9LGUucmFuZ2VSb3VuZEJhbmRzPWZ1bmN0aW9uKHUsbyxjKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApLGFyZ3VtZW50cy5sZW5ndGg8MyYmKGM9byk7dmFyIHM9dVsxXTx1WzBdLGw9dVtzLTBdLGY9dVsxLXNdLGg9TWF0aC5mbG9vcigoZi1sKS8obi5sZW5ndGgtbysyKmMpKSxnPWYtbC0obi5sZW5ndGgtbykqaDtyZXR1cm4gaT1yKGwrTWF0aC5yb3VuZChnLzIpLGgpLHMmJmkucmV2ZXJzZSgpLGE9TWF0aC5yb3VuZChoKigxLW8pKSx0PXt0OiJyYW5nZVJvdW5kQmFuZHMiLGE6YXJndW1lbnRzfSxlfSxlLnJhbmdlQmFuZD1mdW5jdGlvbigpe3JldHVybiBhfSxlLnJhbmdlRXh0ZW50PWZ1bmN0aW9uKCl7cmV0dXJuIGppKHQuYVswXSl9LGUuY29weT1mdW5jdGlvbigpe3JldHVybiB0byhuLHQpfSxlLmRvbWFpbihuKX1mdW5jdGlvbiBlbyh0LGUpe2Z1bmN0aW9uIHIoKXt2YXIgbj0wLHI9ZS5sZW5ndGg7Zm9yKGk9W107KytuPHI7KWlbbi0xXT1Hby5xdWFudGlsZSh0LG4vcik7cmV0dXJuIHV9ZnVuY3Rpb24gdShuKXtyZXR1cm4gaXNOYU4obj0rbik/dm9pZCAwOmVbR28uYmlzZWN0KGksbildfXZhciBpO3JldHVybiB1LmRvbWFpbj1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1lLmZpbHRlcihmdW5jdGlvbihuKXtyZXR1cm4haXNOYU4obil9KS5zb3J0KG4pLHIoKSk6dH0sdS5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHIoKSk6ZX0sdS5xdWFudGlsZXM9ZnVuY3Rpb24oKXtyZXR1cm4gaX0sdS5pbnZlcnRFeHRlbnQ9ZnVuY3Rpb24obil7cmV0dXJuIG49ZS5pbmRleE9mKG4pLDA+bj9bMC8wLDAvMF06W24+MD9pW24tMV06dFswXSxuPGkubGVuZ3RoP2lbbl06dFt0Lmxlbmd0aC0xXV19LHUuY29weT1mdW5jdGlvbigpe3JldHVybiBlbyh0LGUpfSxyKCl9ZnVuY3Rpb24gcm8obix0LGUpe2Z1bmN0aW9uIHIodCl7cmV0dXJuIGVbTWF0aC5tYXgoMCxNYXRoLm1pbihvLE1hdGguZmxvb3IoaSoodC1uKSkpKV19ZnVuY3Rpb24gdSgpe3JldHVybiBpPWUubGVuZ3RoLyh0LW4pLG89ZS5sZW5ndGgtMSxyfXZhciBpLG87cmV0dXJuIHIuZG9tYWluPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuPStlWzBdLHQ9K2VbZS5sZW5ndGgtMV0sdSgpKTpbbix0XX0sci5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHUoKSk6ZX0sci5pbnZlcnRFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHQ9ZS5pbmRleE9mKHQpLHQ9MD50PzAvMDp0L2krbixbdCx0KzEvaV19LHIuY29weT1mdW5jdGlvbigpe3JldHVybiBybyhuLHQsZSl9LHUoKX1mdW5jdGlvbiB1byhuLHQpe2Z1bmN0aW9uIGUoZSl7cmV0dXJuIGU+PWU/dFtHby5iaXNlY3QobixlKV06dm9pZCAwfXJldHVybiBlLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj10LGUpOm59LGUucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bixlKTp0fSxlLmludmVydEV4dGVudD1mdW5jdGlvbihlKXtyZXR1cm4gZT10LmluZGV4T2YoZSksW25bZS0xXSxuW2VdXX0sZS5jb3B5PWZ1bmN0aW9uKCl7cmV0dXJuIHVvKG4sdCl9LGV9ZnVuY3Rpb24gaW8obil7ZnVuY3Rpb24gdChuKXtyZXR1cm4rbn1yZXR1cm4gdC5pbnZlcnQ9dCx0LmRvbWFpbj10LnJhbmdlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuPWUubWFwKHQpLHQpOm59LHQudGlja3M9ZnVuY3Rpb24odCl7cmV0dXJuIEJpKG4sdCl9LHQudGlja0Zvcm1hdD1mdW5jdGlvbih0LGUpe3JldHVybiBKaShuLHQsZSl9LHQuY29weT1mdW5jdGlvbigpe3JldHVybiBpbyhuKX0sdH1mdW5jdGlvbiBvbyhuKXtyZXR1cm4gbi5pbm5lclJhZGl1c31mdW5jdGlvbiBhbyhuKXtyZXR1cm4gbi5vdXRlclJhZGl1c31mdW5jdGlvbiBjbyhuKXtyZXR1cm4gbi5zdGFydEFuZ2xlfWZ1bmN0aW9uIHNvKG4pe3JldHVybiBuLmVuZEFuZ2xlfWZ1bmN0aW9uIGxvKG4pe2Z1bmN0aW9uIHQodCl7ZnVuY3Rpb24gbygpe3MucHVzaCgiTSIsaShuKGwpLGEpKX1mb3IodmFyIGMscz1bXSxsPVtdLGY9LTEsaD10Lmxlbmd0aCxnPUV0KGUpLHA9RXQocik7KytmPGg7KXUuY2FsbCh0aGlzLGM9dFtmXSxmKT9sLnB1c2goWytnLmNhbGwodGhpcyxjLGYpLCtwLmNhbGwodGhpcyxjLGYpXSk6bC5sZW5ndGgmJihvKCksbD1bXSk7cmV0dXJuIGwubGVuZ3RoJiZvKCkscy5sZW5ndGg/cy5qb2luKCIiKTpudWxsfXZhciBlPU5yLHI9QXIsdT1OZSxpPWZvLG89aS5rZXksYT0uNztyZXR1cm4gdC54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPW4sdCk6ZX0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC5kZWZpbmVkPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sdCk6dX0sdC5pbnRlcnBvbGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz0iZnVuY3Rpb24iPT10eXBlb2Ygbj9pPW46KGk9U3MuZ2V0KG4pfHxmbykua2V5LHQpOm99LHQudGVuc2lvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1uLHQpOmF9LHR9ZnVuY3Rpb24gZm8obil7cmV0dXJuIG4uam9pbigiTCIpfWZ1bmN0aW9uIGhvKG4pe3JldHVybiBmbyhuKSsiWiJ9ZnVuY3Rpb24gZ28obil7Zm9yKHZhciB0PTAsZT1uLmxlbmd0aCxyPW5bMF0sdT1bclswXSwiLCIsclsxXV07Kyt0PGU7KXUucHVzaCgiSCIsKHJbMF0rKHI9blt0XSlbMF0pLzIsIlYiLHJbMV0pO3JldHVybiBlPjEmJnUucHVzaCgiSCIsclswXSksdS5qb2luKCIiKX1mdW5jdGlvbiBwbyhuKXtmb3IodmFyIHQ9MCxlPW4ubGVuZ3RoLHI9blswXSx1PVtyWzBdLCIsIixyWzFdXTsrK3Q8ZTspdS5wdXNoKCJWIiwocj1uW3RdKVsxXSwiSCIsclswXSk7cmV0dXJuIHUuam9pbigiIil9ZnVuY3Rpb24gdm8obil7Zm9yKHZhciB0PTAsZT1uLmxlbmd0aCxyPW5bMF0sdT1bclswXSwiLCIsclsxXV07Kyt0PGU7KXUucHVzaCgiSCIsKHI9blt0XSlbMF0sIlYiLHJbMV0pO3JldHVybiB1LmpvaW4oIiIpfWZ1bmN0aW9uIG1vKG4sdCl7cmV0dXJuIG4ubGVuZ3RoPDQ/Zm8obik6blsxXStNbyhuLnNsaWNlKDEsbi5sZW5ndGgtMSksX28obix0KSl9ZnVuY3Rpb24geW8obix0KXtyZXR1cm4gbi5sZW5ndGg8Mz9mbyhuKTpuWzBdK01vKChuLnB1c2goblswXSksbiksX28oW25bbi5sZW5ndGgtMl1dLmNvbmNhdChuLFtuWzFdXSksdCkpfWZ1bmN0aW9uIHhvKG4sdCl7cmV0dXJuIG4ubGVuZ3RoPDM/Zm8obik6blswXStNbyhuLF9vKG4sdCkpfWZ1bmN0aW9uIE1vKG4sdCl7aWYodC5sZW5ndGg8MXx8bi5sZW5ndGghPXQubGVuZ3RoJiZuLmxlbmd0aCE9dC5sZW5ndGgrMilyZXR1cm4gZm8obik7dmFyIGU9bi5sZW5ndGghPXQubGVuZ3RoLHI9IiIsdT1uWzBdLGk9blsxXSxvPXRbMF0sYT1vLGM9MTtpZihlJiYocis9IlEiKyhpWzBdLTIqb1swXS8zKSsiLCIrKGlbMV0tMipvWzFdLzMpKyIsIitpWzBdKyIsIitpWzFdLHU9blsxXSxjPTIpLHQubGVuZ3RoPjEpe2E9dFsxXSxpPW5bY10sYysrLHIrPSJDIisodVswXStvWzBdKSsiLCIrKHVbMV0rb1sxXSkrIiwiKyhpWzBdLWFbMF0pKyIsIisoaVsxXS1hWzFdKSsiLCIraVswXSsiLCIraVsxXTtmb3IodmFyIHM9MjtzPHQubGVuZ3RoO3MrKyxjKyspaT1uW2NdLGE9dFtzXSxyKz0iUyIrKGlbMF0tYVswXSkrIiwiKyhpWzFdLWFbMV0pKyIsIitpWzBdKyIsIitpWzFdfWlmKGUpe3ZhciBsPW5bY107cis9IlEiKyhpWzBdKzIqYVswXS8zKSsiLCIrKGlbMV0rMiphWzFdLzMpKyIsIitsWzBdKyIsIitsWzFdfXJldHVybiByfWZ1bmN0aW9uIF9vKG4sdCl7Zm9yKHZhciBlLHI9W10sdT0oMS10KS8yLGk9blswXSxvPW5bMV0sYT0xLGM9bi5sZW5ndGg7KythPGM7KWU9aSxpPW8sbz1uW2FdLHIucHVzaChbdSoob1swXS1lWzBdKSx1KihvWzFdLWVbMV0pXSk7cmV0dXJuIHJ9ZnVuY3Rpb24gYm8obil7aWYobi5sZW5ndGg8MylyZXR1cm4gZm8obik7dmFyIHQ9MSxlPW4ubGVuZ3RoLHI9blswXSx1PXJbMF0saT1yWzFdLG89W3UsdSx1LChyPW5bMV0pWzBdXSxhPVtpLGksaSxyWzFdXSxjPVt1LCIsIixpLCJMIixFbyhOcyxvKSwiLCIsRW8oTnMsYSldO2ZvcihuLnB1c2gobltlLTFdKTsrK3Q8PWU7KXI9blt0XSxvLnNoaWZ0KCksby5wdXNoKHJbMF0pLGEuc2hpZnQoKSxhLnB1c2goclsxXSksTm8oYyxvLGEpO3JldHVybiBuLnBvcCgpLGMucHVzaCgiTCIsciksYy5qb2luKCIiKX1mdW5jdGlvbiB3byhuKXtpZihuLmxlbmd0aDw0KXJldHVybiBmbyhuKTtmb3IodmFyIHQsZT1bXSxyPS0xLHU9bi5sZW5ndGgsaT1bMF0sbz1bMF07KytyPDM7KXQ9bltyXSxpLnB1c2godFswXSksby5wdXNoKHRbMV0pO2ZvcihlLnB1c2goRW8oTnMsaSkrIiwiK0VvKE5zLG8pKSwtLXI7KytyPHU7KXQ9bltyXSxpLnNoaWZ0KCksaS5wdXNoKHRbMF0pLG8uc2hpZnQoKSxvLnB1c2godFsxXSksTm8oZSxpLG8pO3JldHVybiBlLmpvaW4oIiIpfWZ1bmN0aW9uIFNvKG4pe2Zvcih2YXIgdCxlLHI9LTEsdT1uLmxlbmd0aCxpPXUrNCxvPVtdLGE9W107KytyPDQ7KWU9bltyJXVdLG8ucHVzaChlWzBdKSxhLnB1c2goZVsxXSk7Zm9yKHQ9W0VvKE5zLG8pLCIsIixFbyhOcyxhKV0sLS1yOysrcjxpOyllPW5bciV1XSxvLnNoaWZ0KCksby5wdXNoKGVbMF0pLGEuc2hpZnQoKSxhLnB1c2goZVsxXSksTm8odCxvLGEpO3JldHVybiB0LmpvaW4oIiIpfWZ1bmN0aW9uIGtvKG4sdCl7dmFyIGU9bi5sZW5ndGgtMTtpZihlKWZvcih2YXIgcix1LGk9blswXVswXSxvPW5bMF1bMV0sYT1uW2VdWzBdLWksYz1uW2VdWzFdLW8scz0tMTsrK3M8PWU7KXI9bltzXSx1PXMvZSxyWzBdPXQqclswXSsoMS10KSooaSt1KmEpLHJbMV09dCpyWzFdKygxLXQpKihvK3UqYyk7cmV0dXJuIGJvKG4pfWZ1bmN0aW9uIEVvKG4sdCl7cmV0dXJuIG5bMF0qdFswXStuWzFdKnRbMV0rblsyXSp0WzJdK25bM10qdFszXX1mdW5jdGlvbiBObyhuLHQsZSl7bi5wdXNoKCJDIixFbyhrcyx0KSwiLCIsRW8oa3MsZSksIiwiLEVvKEVzLHQpLCIsIixFbyhFcyxlKSwiLCIsRW8oTnMsdCksIiwiLEVvKE5zLGUpKX1mdW5jdGlvbiBBbyhuLHQpe3JldHVybih0WzFdLW5bMV0pLyh0WzBdLW5bMF0pfWZ1bmN0aW9uIENvKG4pe2Zvcih2YXIgdD0wLGU9bi5sZW5ndGgtMSxyPVtdLHU9blswXSxpPW5bMV0sbz1yWzBdPUFvKHUsaSk7Kyt0PGU7KXJbdF09KG8rKG89QW8odT1pLGk9blt0KzFdKSkpLzI7cmV0dXJuIHJbdF09byxyfWZ1bmN0aW9uIExvKG4pe2Zvcih2YXIgdCxlLHIsdSxpPVtdLG89Q28obiksYT0tMSxjPW4ubGVuZ3RoLTE7KythPGM7KXQ9QW8oblthXSxuW2ErMV0pLGZhKHQpPFRhP29bYV09b1thKzFdPTA6KGU9b1thXS90LHI9b1thKzFdL3QsdT1lKmUrcipyLHU+OSYmKHU9Myp0L01hdGguc3FydCh1KSxvW2FdPXUqZSxvW2ErMV09dSpyKSk7Zm9yKGE9LTE7KythPD1jOyl1PShuW01hdGgubWluKGMsYSsxKV1bMF0tbltNYXRoLm1heCgwLGEtMSldWzBdKS8oNiooMStvW2FdKm9bYV0pKSxpLnB1c2goW3V8fDAsb1thXSp1fHwwXSk7cmV0dXJuIGl9ZnVuY3Rpb24gVG8obil7cmV0dXJuIG4ubGVuZ3RoPDM/Zm8obik6blswXStNbyhuLExvKG4pKX1mdW5jdGlvbiBxbyhuKXtmb3IodmFyIHQsZSxyLHU9LTEsaT1uLmxlbmd0aDsrK3U8aTspdD1uW3VdLGU9dFswXSxyPXRbMV0rYnMsdFswXT1lKk1hdGguY29zKHIpLHRbMV09ZSpNYXRoLnNpbihyKTtyZXR1cm4gbn1mdW5jdGlvbiB6byhuKXtmdW5jdGlvbiB0KHQpe2Z1bmN0aW9uIGMoKXt2LnB1c2goIk0iLGEobihtKSxmKSxsLHMobihkLnJldmVyc2UoKSksZiksIloiKX1mb3IodmFyIGgsZyxwLHY9W10sZD1bXSxtPVtdLHk9LTEseD10Lmxlbmd0aCxNPUV0KGUpLF89RXQodSksYj1lPT09cj9mdW5jdGlvbigpe3JldHVybiBnfTpFdChyKSx3PXU9PT1pP2Z1bmN0aW9uKCl7cmV0dXJuIHB9OkV0KGkpOysreTx4OylvLmNhbGwodGhpcyxoPXRbeV0seSk/KGQucHVzaChbZz0rTS5jYWxsKHRoaXMsaCx5KSxwPStfLmNhbGwodGhpcyxoLHkpXSksbS5wdXNoKFsrYi5jYWxsKHRoaXMsaCx5KSwrdy5jYWxsKHRoaXMsaCx5KV0pKTpkLmxlbmd0aCYmKGMoKSxkPVtdLG09W10pO3JldHVybiBkLmxlbmd0aCYmYygpLHYubGVuZ3RoP3Yuam9pbigiIik6bnVsbH12YXIgZT1OcixyPU5yLHU9MCxpPUFyLG89TmUsYT1mbyxjPWEua2V5LHM9YSxsPSJMIixmPS43O3JldHVybiB0Lng9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9cj1uLHQpOnJ9LHQueDA9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix0KTplfSx0LngxPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PWk9bix0KTppfSx0LnkwPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sdCk6dX0sdC55MT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLHQpOml9LHQuZGVmaW5lZD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1uLHQpOm99LHQuaW50ZXJwb2xhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGM9ImZ1bmN0aW9uIj09dHlwZW9mIG4/YT1uOihhPVNzLmdldChuKXx8Zm8pLmtleSxzPWEucmV2ZXJzZXx8YSxsPWEuY2xvc2VkPyJNIjoiTCIsdCk6Y30sdC50ZW5zaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhmPW4sdCk6Zn0sdH1mdW5jdGlvbiBSbyhuKXtyZXR1cm4gbi5yYWRpdXN9ZnVuY3Rpb24gRG8obil7cmV0dXJuW24ueCxuLnldfWZ1bmN0aW9uIFBvKG4pe3JldHVybiBmdW5jdGlvbigpe3ZhciB0PW4uYXBwbHkodGhpcyxhcmd1bWVudHMpLGU9dFswXSxyPXRbMV0rYnM7cmV0dXJuW2UqTWF0aC5jb3MociksZSpNYXRoLnNpbihyKV19fWZ1bmN0aW9uIFVvKCl7cmV0dXJuIDY0fWZ1bmN0aW9uIGpvKCl7cmV0dXJuImNpcmNsZSJ9ZnVuY3Rpb24gSG8obil7dmFyIHQ9TWF0aC5zcXJ0KG4vQWEpO3JldHVybiJNMCwiK3QrIkEiK3QrIiwiK3QrIiAwIDEsMSAwLCIrLXQrIkEiK3QrIiwiK3QrIiAwIDEsMSAwLCIrdCsiWiJ9ZnVuY3Rpb24gRm8obix0KXtyZXR1cm4gZGEobix6cyksbi5pZD10LG59ZnVuY3Rpb24gT28obix0LGUscil7dmFyIHU9bi5pZDtyZXR1cm4gUChuLCJmdW5jdGlvbiI9PXR5cGVvZiBlP2Z1bmN0aW9uKG4saSxvKXtuLl9fdHJhbnNpdGlvbl9fW3VdLnR3ZWVuLnNldCh0LHIoZS5jYWxsKG4sbi5fX2RhdGFfXyxpLG8pKSl9OihlPXIoZSksZnVuY3Rpb24obil7bi5fX3RyYW5zaXRpb25fX1t1XS50d2Vlbi5zZXQodCxlKX0pKX1mdW5jdGlvbiBZbyhuKXtyZXR1cm4gbnVsbD09biYmKG49IiIpLGZ1bmN0aW9uKCl7dGhpcy50ZXh0Q29udGVudD1ufX1mdW5jdGlvbiBJbyhuLHQsZSxyKXt2YXIgdT1uLl9fdHJhbnNpdGlvbl9ffHwobi5fX3RyYW5zaXRpb25fXz17YWN0aXZlOjAsY291bnQ6MH0pLGk9dVtlXTtpZighaSl7dmFyIGE9ci50aW1lO2k9dVtlXT17dHdlZW46bmV3IG8sdGltZTphLGVhc2U6ci5lYXNlLGRlbGF5OnIuZGVsYXksZHVyYXRpb246ci5kdXJhdGlvbn0sKyt1LmNvdW50LEdvLnRpbWVyKGZ1bmN0aW9uKHIpe2Z1bmN0aW9uIG8ocil7cmV0dXJuIHUuYWN0aXZlPmU/cygpOih1LmFjdGl2ZT1lLGkuZXZlbnQmJmkuZXZlbnQuc3RhcnQuY2FsbChuLGwsdCksaS50d2Vlbi5mb3JFYWNoKGZ1bmN0aW9uKGUscil7KHI9ci5jYWxsKG4sbCx0KSkmJnYucHVzaChyKX0pLEdvLnRpbWVyKGZ1bmN0aW9uKCl7cmV0dXJuIHAuYz1jKHJ8fDEpP05lOmMsMX0sMCxhKSx2b2lkIDApfWZ1bmN0aW9uIGMocil7aWYodS5hY3RpdmUhPT1lKXJldHVybiBzKCk7Zm9yKHZhciBvPXIvZyxhPWYobyksYz12Lmxlbmd0aDtjPjA7KXZbLS1jXS5jYWxsKG4sYSk7cmV0dXJuIG8+PTE/KGkuZXZlbnQmJmkuZXZlbnQuZW5kLmNhbGwobixsLHQpLHMoKSk6dm9pZCAwfWZ1bmN0aW9uIHMoKXtyZXR1cm4tLXUuY291bnQ/ZGVsZXRlIHVbZV06ZGVsZXRlIG4uX190cmFuc2l0aW9uX18sMX12YXIgbD1uLl9fZGF0YV9fLGY9aS5lYXNlLGg9aS5kZWxheSxnPWkuZHVyYXRpb24scD1uYyx2PVtdO3JldHVybiBwLnQ9aCthLHI+PWg/byhyLWgpOihwLmM9byx2b2lkIDApCn0sMCxhKX19ZnVuY3Rpb24gWm8obix0KXtuLmF0dHIoInRyYW5zZm9ybSIsZnVuY3Rpb24obil7cmV0dXJuInRyYW5zbGF0ZSgiK3QobikrIiwwKSJ9KX1mdW5jdGlvbiBWbyhuLHQpe24uYXR0cigidHJhbnNmb3JtIixmdW5jdGlvbihuKXtyZXR1cm4idHJhbnNsYXRlKDAsIit0KG4pKyIpIn0pfWZ1bmN0aW9uICRvKG4pe3JldHVybiBuLnRvSVNPU3RyaW5nKCl9ZnVuY3Rpb24gWG8obix0LGUpe2Z1bmN0aW9uIHIodCl7cmV0dXJuIG4odCl9ZnVuY3Rpb24gdShuLGUpe3ZhciByPW5bMV0tblswXSx1PXIvZSxpPUdvLmJpc2VjdChZcyx1KTtyZXR1cm4gaT09WXMubGVuZ3RoP1t0LnllYXIsWGkobi5tYXAoZnVuY3Rpb24obil7cmV0dXJuIG4vMzE1MzZlNn0pLGUpWzJdXTppP3RbdS9Zc1tpLTFdPFlzW2ldL3U/aS0xOmldOltWcyxYaShuLGUpWzJdXX1yZXR1cm4gci5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIEJvKG4uaW52ZXJ0KHQpKX0sci5kb21haW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG4uZG9tYWluKHQpLHIpOm4uZG9tYWluKCkubWFwKEJvKX0sci5uaWNlPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZShlKXtyZXR1cm4haXNOYU4oZSkmJiFuLnJhbmdlKGUsQm8oK2UrMSksdCkubGVuZ3RofXZhciBpPXIuZG9tYWluKCksbz1qaShpKSxhPW51bGw9PW4/dShvLDEwKToibnVtYmVyIj09dHlwZW9mIG4mJnUobyxuKTtyZXR1cm4gYSYmKG49YVswXSx0PWFbMV0pLHIuZG9tYWluKE9pKGksdD4xP3tmbG9vcjpmdW5jdGlvbih0KXtmb3IoO2UodD1uLmZsb29yKHQpKTspdD1Cbyh0LTEpO3JldHVybiB0fSxjZWlsOmZ1bmN0aW9uKHQpe2Zvcig7ZSh0PW4uY2VpbCh0KSk7KXQ9Qm8oK3QrMSk7cmV0dXJuIHR9fTpuKSl9LHIudGlja3M9ZnVuY3Rpb24obix0KXt2YXIgZT1qaShyLmRvbWFpbigpKSxpPW51bGw9PW4/dShlLDEwKToibnVtYmVyIj09dHlwZW9mIG4/dShlLG4pOiFuLnJhbmdlJiZbe3JhbmdlOm59LHRdO3JldHVybiBpJiYobj1pWzBdLHQ9aVsxXSksbi5yYW5nZShlWzBdLEJvKCtlWzFdKzEpLDE+dD8xOnQpfSxyLnRpY2tGb3JtYXQ9ZnVuY3Rpb24oKXtyZXR1cm4gZX0sci5jb3B5PWZ1bmN0aW9uKCl7cmV0dXJuIFhvKG4uY29weSgpLHQsZSl9LFZpKHIsbil9ZnVuY3Rpb24gQm8obil7cmV0dXJuIG5ldyBEYXRlKG4pfWZ1bmN0aW9uIEpvKG4pe3JldHVybiBKU09OLnBhcnNlKG4ucmVzcG9uc2VUZXh0KX1mdW5jdGlvbiBXbyhuKXt2YXIgdD1uYS5jcmVhdGVSYW5nZSgpO3JldHVybiB0LnNlbGVjdE5vZGUobmEuYm9keSksdC5jcmVhdGVDb250ZXh0dWFsRnJhZ21lbnQobi5yZXNwb25zZVRleHQpfXZhciBHbz17dmVyc2lvbjoiMy40LjQifTtEYXRlLm5vd3x8KERhdGUubm93PWZ1bmN0aW9uKCl7cmV0dXJuK25ldyBEYXRlfSk7dmFyIEtvPVtdLnNsaWNlLFFvPWZ1bmN0aW9uKG4pe3JldHVybiBLby5jYWxsKG4pfSxuYT1kb2N1bWVudCx0YT1uYS5kb2N1bWVudEVsZW1lbnQsZWE9d2luZG93O3RyeXtRbyh0YS5jaGlsZE5vZGVzKVswXS5ub2RlVHlwZX1jYXRjaChyYSl7UW89ZnVuY3Rpb24obil7Zm9yKHZhciB0PW4ubGVuZ3RoLGU9bmV3IEFycmF5KHQpO3QtLTspZVt0XT1uW3RdO3JldHVybiBlfX10cnl7bmEuY3JlYXRlRWxlbWVudCgiZGl2Iikuc3R5bGUuc2V0UHJvcGVydHkoIm9wYWNpdHkiLDAsIiIpfWNhdGNoKHVhKXt2YXIgaWE9ZWEuRWxlbWVudC5wcm90b3R5cGUsb2E9aWEuc2V0QXR0cmlidXRlLGFhPWlhLnNldEF0dHJpYnV0ZU5TLGNhPWVhLkNTU1N0eWxlRGVjbGFyYXRpb24ucHJvdG90eXBlLHNhPWNhLnNldFByb3BlcnR5O2lhLnNldEF0dHJpYnV0ZT1mdW5jdGlvbihuLHQpe29hLmNhbGwodGhpcyxuLHQrIiIpfSxpYS5zZXRBdHRyaWJ1dGVOUz1mdW5jdGlvbihuLHQsZSl7YWEuY2FsbCh0aGlzLG4sdCxlKyIiKX0sY2Euc2V0UHJvcGVydHk9ZnVuY3Rpb24obix0LGUpe3NhLmNhbGwodGhpcyxuLHQrIiIsZSl9fUdvLmFzY2VuZGluZz1uLEdvLmRlc2NlbmRpbmc9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj50Py0xOnQ+bj8xOnQ+PW4/MDowLzB9LEdvLm1pbj1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdT0tMSxpPW4ubGVuZ3RoO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKXtmb3IoOysrdTxpJiYhKG51bGwhPShlPW5bdV0pJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK3U8aTspbnVsbCE9KHI9blt1XSkmJmU+ciYmKGU9cil9ZWxzZXtmb3IoOysrdTxpJiYhKG51bGwhPShlPXQuY2FsbChuLG5bdV0sdSkpJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK3U8aTspbnVsbCE9KHI9dC5jYWxsKG4sblt1XSx1KSkmJmU+ciYmKGU9cil9cmV0dXJuIGV9LEdvLm1heD1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdT0tMSxpPW4ubGVuZ3RoO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKXtmb3IoOysrdTxpJiYhKG51bGwhPShlPW5bdV0pJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK3U8aTspbnVsbCE9KHI9blt1XSkmJnI+ZSYmKGU9cil9ZWxzZXtmb3IoOysrdTxpJiYhKG51bGwhPShlPXQuY2FsbChuLG5bdV0sdSkpJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK3U8aTspbnVsbCE9KHI9dC5jYWxsKG4sblt1XSx1KSkmJnI+ZSYmKGU9cil9cmV0dXJuIGV9LEdvLmV4dGVudD1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdSxpPS0xLG89bi5sZW5ndGg7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpe2Zvcig7KytpPG8mJiEobnVsbCE9KGU9dT1uW2ldKSYmZT49ZSk7KWU9dT12b2lkIDA7Zm9yKDsrK2k8bzspbnVsbCE9KHI9bltpXSkmJihlPnImJihlPXIpLHI+dSYmKHU9cikpfWVsc2V7Zm9yKDsrK2k8byYmIShudWxsIT0oZT11PXQuY2FsbChuLG5baV0saSkpJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK2k8bzspbnVsbCE9KHI9dC5jYWxsKG4sbltpXSxpKSkmJihlPnImJihlPXIpLHI+dSYmKHU9cikpfXJldHVybltlLHVdfSxHby5zdW09ZnVuY3Rpb24obix0KXt2YXIgZSxyPTAsdT1uLmxlbmd0aCxpPS0xO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKWZvcig7KytpPHU7KWlzTmFOKGU9K25baV0pfHwocis9ZSk7ZWxzZSBmb3IoOysraTx1Oylpc05hTihlPSt0LmNhbGwobixuW2ldLGkpKXx8KHIrPWUpO3JldHVybiByfSxHby5tZWFuPWZ1bmN0aW9uKG4sZSl7dmFyIHIsdT1uLmxlbmd0aCxpPTAsbz0tMSxhPTA7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpZm9yKDsrK288dTspdChyPW5bb10pJiYoaSs9KHItaSkvKythKTtlbHNlIGZvcig7KytvPHU7KXQocj1lLmNhbGwobixuW29dLG8pKSYmKGkrPShyLWkpLysrYSk7cmV0dXJuIGE/aTp2b2lkIDB9LEdvLnF1YW50aWxlPWZ1bmN0aW9uKG4sdCl7dmFyIGU9KG4ubGVuZ3RoLTEpKnQrMSxyPU1hdGguZmxvb3IoZSksdT0rbltyLTFdLGk9ZS1yO3JldHVybiBpP3UraSoobltyXS11KTp1fSxHby5tZWRpYW49ZnVuY3Rpb24oZSxyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD4xJiYoZT1lLm1hcChyKSksZT1lLmZpbHRlcih0KSxlLmxlbmd0aD9Hby5xdWFudGlsZShlLnNvcnQobiksLjUpOnZvaWQgMH07dmFyIGxhPWUobik7R28uYmlzZWN0TGVmdD1sYS5sZWZ0LEdvLmJpc2VjdD1Hby5iaXNlY3RSaWdodD1sYS5yaWdodCxHby5iaXNlY3Rvcj1mdW5jdGlvbih0KXtyZXR1cm4gZSgxPT09dC5sZW5ndGg/ZnVuY3Rpb24oZSxyKXtyZXR1cm4gbih0KGUpLHIpfTp0KX0sR28uc2h1ZmZsZT1mdW5jdGlvbihuKXtmb3IodmFyIHQsZSxyPW4ubGVuZ3RoO3I7KWU9MHxNYXRoLnJhbmRvbSgpKnItLSx0PW5bcl0sbltyXT1uW2VdLG5bZV09dDtyZXR1cm4gbn0sR28ucGVybXV0ZT1mdW5jdGlvbihuLHQpe2Zvcih2YXIgZT10Lmxlbmd0aCxyPW5ldyBBcnJheShlKTtlLS07KXJbZV09blt0W2VdXTtyZXR1cm4gcn0sR28ucGFpcnM9ZnVuY3Rpb24obil7Zm9yKHZhciB0LGU9MCxyPW4ubGVuZ3RoLTEsdT1uWzBdLGk9bmV3IEFycmF5KDA+cj8wOnIpO3I+ZTspaVtlXT1bdD11LHU9blsrK2VdXTtyZXR1cm4gaX0sR28uemlwPWZ1bmN0aW9uKCl7aWYoISh1PWFyZ3VtZW50cy5sZW5ndGgpKXJldHVybltdO2Zvcih2YXIgbj0tMSx0PUdvLm1pbihhcmd1bWVudHMsciksZT1uZXcgQXJyYXkodCk7KytuPHQ7KWZvcih2YXIgdSxpPS0xLG89ZVtuXT1uZXcgQXJyYXkodSk7KytpPHU7KW9baV09YXJndW1lbnRzW2ldW25dO3JldHVybiBlfSxHby50cmFuc3Bvc2U9ZnVuY3Rpb24obil7cmV0dXJuIEdvLnppcC5hcHBseShHbyxuKX0sR28ua2V5cz1mdW5jdGlvbihuKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gbil0LnB1c2goZSk7cmV0dXJuIHR9LEdvLnZhbHVlcz1mdW5jdGlvbihuKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gbil0LnB1c2gobltlXSk7cmV0dXJuIHR9LEdvLmVudHJpZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciBlIGluIG4pdC5wdXNoKHtrZXk6ZSx2YWx1ZTpuW2VdfSk7cmV0dXJuIHR9LEdvLm1lcmdlPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxlLHIsdT1uLmxlbmd0aCxpPS0xLG89MDsrK2k8dTspbys9bltpXS5sZW5ndGg7Zm9yKGU9bmV3IEFycmF5KG8pOy0tdT49MDspZm9yKHI9blt1XSx0PXIubGVuZ3RoOy0tdD49MDspZVstLW9dPXJbdF07cmV0dXJuIGV9O3ZhciBmYT1NYXRoLmFicztHby5yYW5nZT1mdW5jdGlvbihuLHQsZSl7aWYoYXJndW1lbnRzLmxlbmd0aDwzJiYoZT0xLGFyZ3VtZW50cy5sZW5ndGg8MiYmKHQ9bixuPTApKSwxLzA9PT0odC1uKS9lKXRocm93IG5ldyBFcnJvcigiaW5maW5pdGUgcmFuZ2UiKTt2YXIgcixpPVtdLG89dShmYShlKSksYT0tMTtpZihuKj1vLHQqPW8sZSo9bywwPmUpZm9yKDsocj1uK2UqKythKT50OylpLnB1c2goci9vKTtlbHNlIGZvcig7KHI9bitlKisrYSk8dDspaS5wdXNoKHIvbyk7cmV0dXJuIGl9LEdvLm1hcD1mdW5jdGlvbihuKXt2YXIgdD1uZXcgbztpZihuIGluc3RhbmNlb2YgbyluLmZvckVhY2goZnVuY3Rpb24obixlKXt0LnNldChuLGUpfSk7ZWxzZSBmb3IodmFyIGUgaW4gbil0LnNldChlLG5bZV0pO3JldHVybiB0fSxpKG8se2hhczphLGdldDpmdW5jdGlvbihuKXtyZXR1cm4gdGhpc1toYStuXX0sc2V0OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIHRoaXNbaGErbl09dH0scmVtb3ZlOmMsa2V5czpzLHZhbHVlczpmdW5jdGlvbigpe3ZhciBuPVtdO3JldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24odCxlKXtuLnB1c2goZSl9KSxufSxlbnRyaWVzOmZ1bmN0aW9uKCl7dmFyIG49W107cmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbih0LGUpe24ucHVzaCh7a2V5OnQsdmFsdWU6ZX0pfSksbn0sc2l6ZTpsLGVtcHR5OmYsZm9yRWFjaDpmdW5jdGlvbihuKXtmb3IodmFyIHQgaW4gdGhpcyl0LmNoYXJDb2RlQXQoMCk9PT1nYSYmbi5jYWxsKHRoaXMsdC5zdWJzdHJpbmcoMSksdGhpc1t0XSl9fSk7dmFyIGhhPSJceDAwIixnYT1oYS5jaGFyQ29kZUF0KDApO0dvLm5lc3Q9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKHQsYSxjKXtpZihjPj1pLmxlbmd0aClyZXR1cm4gcj9yLmNhbGwodSxhKTplP2Euc29ydChlKTphO2Zvcih2YXIgcyxsLGYsaCxnPS0xLHA9YS5sZW5ndGgsdj1pW2MrK10sZD1uZXcgbzsrK2c8cDspKGg9ZC5nZXQocz12KGw9YVtnXSkpKT9oLnB1c2gobCk6ZC5zZXQocyxbbF0pO3JldHVybiB0PyhsPXQoKSxmPWZ1bmN0aW9uKGUscil7bC5zZXQoZSxuKHQscixjKSl9KToobD17fSxmPWZ1bmN0aW9uKGUscil7bFtlXT1uKHQscixjKX0pLGQuZm9yRWFjaChmKSxsfWZ1bmN0aW9uIHQobixlKXtpZihlPj1pLmxlbmd0aClyZXR1cm4gbjt2YXIgcj1bXSx1PWFbZSsrXTtyZXR1cm4gbi5mb3JFYWNoKGZ1bmN0aW9uKG4sdSl7ci5wdXNoKHtrZXk6bix2YWx1ZXM6dCh1LGUpfSl9KSx1P3Iuc29ydChmdW5jdGlvbihuLHQpe3JldHVybiB1KG4ua2V5LHQua2V5KX0pOnJ9dmFyIGUscix1PXt9LGk9W10sYT1bXTtyZXR1cm4gdS5tYXA9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbihlLHQsMCl9LHUuZW50cmllcz1mdW5jdGlvbihlKXtyZXR1cm4gdChuKEdvLm1hcCxlLDApLDApfSx1LmtleT1mdW5jdGlvbihuKXtyZXR1cm4gaS5wdXNoKG4pLHV9LHUuc29ydEtleXM9ZnVuY3Rpb24obil7cmV0dXJuIGFbaS5sZW5ndGgtMV09bix1fSx1LnNvcnRWYWx1ZXM9ZnVuY3Rpb24obil7cmV0dXJuIGU9bix1fSx1LnJvbGx1cD1mdW5jdGlvbihuKXtyZXR1cm4gcj1uLHV9LHV9LEdvLnNldD1mdW5jdGlvbihuKXt2YXIgdD1uZXcgaDtpZihuKWZvcih2YXIgZT0wLHI9bi5sZW5ndGg7cj5lOysrZSl0LmFkZChuW2VdKTtyZXR1cm4gdH0saShoLHtoYXM6YSxhZGQ6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXNbaGErbl09ITAsbn0scmVtb3ZlOmZ1bmN0aW9uKG4pe3JldHVybiBuPWhhK24sbiBpbiB0aGlzJiZkZWxldGUgdGhpc1tuXX0sdmFsdWVzOnMsc2l6ZTpsLGVtcHR5OmYsZm9yRWFjaDpmdW5jdGlvbihuKXtmb3IodmFyIHQgaW4gdGhpcyl0LmNoYXJDb2RlQXQoMCk9PT1nYSYmbi5jYWxsKHRoaXMsdC5zdWJzdHJpbmcoMSkpfX0pLEdvLmJlaGF2aW9yPXt9LEdvLnJlYmluZD1mdW5jdGlvbihuLHQpe2Zvcih2YXIgZSxyPTEsdT1hcmd1bWVudHMubGVuZ3RoOysrcjx1OyluW2U9YXJndW1lbnRzW3JdXT1nKG4sdCx0W2VdKTtyZXR1cm4gbn07dmFyIHBhPVsid2Via2l0IiwibXMiLCJtb3oiLCJNb3oiLCJvIiwiTyJdO0dvLmRpc3BhdGNoPWZ1bmN0aW9uKCl7Zm9yKHZhciBuPW5ldyBkLHQ9LTEsZT1hcmd1bWVudHMubGVuZ3RoOysrdDxlOyluW2FyZ3VtZW50c1t0XV09bShuKTtyZXR1cm4gbn0sZC5wcm90b3R5cGUub249ZnVuY3Rpb24obix0KXt2YXIgZT1uLmluZGV4T2YoIi4iKSxyPSIiO2lmKGU+PTAmJihyPW4uc3Vic3RyaW5nKGUrMSksbj1uLnN1YnN0cmluZygwLGUpKSxuKXJldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/dGhpc1tuXS5vbihyKTp0aGlzW25dLm9uKHIsdCk7aWYoMj09PWFyZ3VtZW50cy5sZW5ndGgpe2lmKG51bGw9PXQpZm9yKG4gaW4gdGhpcyl0aGlzLmhhc093blByb3BlcnR5KG4pJiZ0aGlzW25dLm9uKHIsbnVsbCk7cmV0dXJuIHRoaXN9fSxHby5ldmVudD1udWxsLEdvLnJlcXVvdGU9ZnVuY3Rpb24obil7cmV0dXJuIG4ucmVwbGFjZSh2YSwiXFwkJiIpfTt2YXIgdmE9L1tcXFxeXCRcKlwrXD9cfFxbXF1cKFwpXC5ce1x9XS9nLGRhPXt9Ll9fcHJvdG9fXz9mdW5jdGlvbihuLHQpe24uX19wcm90b19fPXR9OmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciBlIGluIHQpbltlXT10W2VdfSxtYT1mdW5jdGlvbihuLHQpe3JldHVybiB0LnF1ZXJ5U2VsZWN0b3Iobil9LHlhPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHQucXVlcnlTZWxlY3RvckFsbChuKX0seGE9dGFbcCh0YSwibWF0Y2hlc1NlbGVjdG9yIildLE1hPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHhhLmNhbGwobix0KX07ImZ1bmN0aW9uIj09dHlwZW9mIFNpenpsZSYmKG1hPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIFNpenpsZShuLHQpWzBdfHxudWxsfSx5YT1TaXp6bGUsTWE9U2l6emxlLm1hdGNoZXNTZWxlY3RvciksR28uc2VsZWN0aW9uPWZ1bmN0aW9uKCl7cmV0dXJuIFNhfTt2YXIgX2E9R28uc2VsZWN0aW9uLnByb3RvdHlwZT1bXTtfYS5zZWxlY3Q9ZnVuY3Rpb24obil7dmFyIHQsZSxyLHUsaT1bXTtuPWIobik7Zm9yKHZhciBvPS0xLGE9dGhpcy5sZW5ndGg7KytvPGE7KXtpLnB1c2godD1bXSksdC5wYXJlbnROb2RlPShyPXRoaXNbb10pLnBhcmVudE5vZGU7Zm9yKHZhciBjPS0xLHM9ci5sZW5ndGg7KytjPHM7KSh1PXJbY10pPyh0LnB1c2goZT1uLmNhbGwodSx1Ll9fZGF0YV9fLGMsbykpLGUmJiJfX2RhdGFfXyJpbiB1JiYoZS5fX2RhdGFfXz11Ll9fZGF0YV9fKSk6dC5wdXNoKG51bGwpfXJldHVybiBfKGkpfSxfYS5zZWxlY3RBbGw9ZnVuY3Rpb24obil7dmFyIHQsZSxyPVtdO249dyhuKTtmb3IodmFyIHU9LTEsaT10aGlzLmxlbmd0aDsrK3U8aTspZm9yKHZhciBvPXRoaXNbdV0sYT0tMSxjPW8ubGVuZ3RoOysrYTxjOykoZT1vW2FdKSYmKHIucHVzaCh0PVFvKG4uY2FsbChlLGUuX19kYXRhX18sYSx1KSkpLHQucGFyZW50Tm9kZT1lKTtyZXR1cm4gXyhyKX07dmFyIGJhPXtzdmc6Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIix4aHRtbDoiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIseGxpbms6Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLHhtbDoiaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIix4bWxuczoiaHR0cDovL3d3dy53My5vcmcvMjAwMC94bWxucy8ifTtHby5ucz17cHJlZml4OmJhLHF1YWxpZnk6ZnVuY3Rpb24obil7dmFyIHQ9bi5pbmRleE9mKCI6IiksZT1uO3JldHVybiB0Pj0wJiYoZT1uLnN1YnN0cmluZygwLHQpLG49bi5zdWJzdHJpbmcodCsxKSksYmEuaGFzT3duUHJvcGVydHkoZSk/e3NwYWNlOmJhW2VdLGxvY2FsOm59Om59fSxfYS5hdHRyPWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pe3ZhciBlPXRoaXMubm9kZSgpO3JldHVybiBuPUdvLm5zLnF1YWxpZnkobiksbi5sb2NhbD9lLmdldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCk6ZS5nZXRBdHRyaWJ1dGUobil9Zm9yKHQgaW4gbil0aGlzLmVhY2goUyh0LG5bdF0pKTtyZXR1cm4gdGhpc31yZXR1cm4gdGhpcy5lYWNoKFMobix0KSl9LF9hLmNsYXNzZWQ9ZnVuY3Rpb24obix0KXtpZihhcmd1bWVudHMubGVuZ3RoPDIpe2lmKCJzdHJpbmciPT10eXBlb2Ygbil7dmFyIGU9dGhpcy5ub2RlKCkscj0obj1OKG4pKS5sZW5ndGgsdT0tMTtpZih0PWUuY2xhc3NMaXN0KXtmb3IoOysrdTxyOylpZighdC5jb250YWlucyhuW3VdKSlyZXR1cm4hMX1lbHNlIGZvcih0PWUuZ2V0QXR0cmlidXRlKCJjbGFzcyIpOysrdTxyOylpZighRShuW3VdKS50ZXN0KHQpKXJldHVybiExO3JldHVybiEwfWZvcih0IGluIG4pdGhpcy5lYWNoKEEodCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaChBKG4sdCkpfSxfYS5zdHlsZT1mdW5jdGlvbihuLHQsZSl7dmFyIHI9YXJndW1lbnRzLmxlbmd0aDtpZigzPnIpe2lmKCJzdHJpbmciIT10eXBlb2Ygbil7Mj5yJiYodD0iIik7Zm9yKGUgaW4gbil0aGlzLmVhY2goTChlLG5bZV0sdCkpO3JldHVybiB0aGlzfWlmKDI+cilyZXR1cm4gZWEuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLm5vZGUoKSxudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKG4pO2U9IiJ9cmV0dXJuIHRoaXMuZWFjaChMKG4sdCxlKSl9LF9hLnByb3BlcnR5PWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pcmV0dXJuIHRoaXMubm9kZSgpW25dO2Zvcih0IGluIG4pdGhpcy5lYWNoKFQodCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaChUKG4sdCkpfSxfYS50ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3RoaXMuZWFjaCgiZnVuY3Rpb24iPT10eXBlb2Ygbj9mdW5jdGlvbigpe3ZhciB0PW4uYXBwbHkodGhpcyxhcmd1bWVudHMpO3RoaXMudGV4dENvbnRlbnQ9bnVsbD09dD8iIjp0fTpudWxsPT1uP2Z1bmN0aW9uKCl7dGhpcy50ZXh0Q29udGVudD0iIn06ZnVuY3Rpb24oKXt0aGlzLnRleHRDb250ZW50PW59KTp0aGlzLm5vZGUoKS50ZXh0Q29udGVudH0sX2EuaHRtbD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD90aGlzLmVhY2goImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24oKXt2YXIgdD1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt0aGlzLmlubmVySFRNTD1udWxsPT10PyIiOnR9Om51bGw9PW4/ZnVuY3Rpb24oKXt0aGlzLmlubmVySFRNTD0iIn06ZnVuY3Rpb24oKXt0aGlzLmlubmVySFRNTD1ufSk6dGhpcy5ub2RlKCkuaW5uZXJIVE1MfSxfYS5hcHBlbmQ9ZnVuY3Rpb24obil7cmV0dXJuIG49cShuKSx0aGlzLnNlbGVjdChmdW5jdGlvbigpe3JldHVybiB0aGlzLmFwcGVuZENoaWxkKG4uYXBwbHkodGhpcyxhcmd1bWVudHMpKX0pfSxfYS5pbnNlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj1xKG4pLHQ9Yih0KSx0aGlzLnNlbGVjdChmdW5jdGlvbigpe3JldHVybiB0aGlzLmluc2VydEJlZm9yZShuLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8bnVsbCl9KX0sX2EucmVtb3ZlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBuPXRoaXMucGFyZW50Tm9kZTtuJiZuLnJlbW92ZUNoaWxkKHRoaXMpfSl9LF9hLmRhdGE9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKG4sZSl7dmFyIHIsdSxpLGE9bi5sZW5ndGgsZj1lLmxlbmd0aCxoPU1hdGgubWluKGEsZiksZz1uZXcgQXJyYXkoZikscD1uZXcgQXJyYXkoZiksdj1uZXcgQXJyYXkoYSk7aWYodCl7dmFyIGQsbT1uZXcgbyx5PW5ldyBvLHg9W107Zm9yKHI9LTE7KytyPGE7KWQ9dC5jYWxsKHU9bltyXSx1Ll9fZGF0YV9fLHIpLG0uaGFzKGQpP3Zbcl09dTptLnNldChkLHUpLHgucHVzaChkKTtmb3Iocj0tMTsrK3I8ZjspZD10LmNhbGwoZSxpPWVbcl0sciksKHU9bS5nZXQoZCkpPyhnW3JdPXUsdS5fX2RhdGFfXz1pKTp5LmhhcyhkKXx8KHBbcl09eihpKSkseS5zZXQoZCxpKSxtLnJlbW92ZShkKTtmb3Iocj0tMTsrK3I8YTspbS5oYXMoeFtyXSkmJih2W3JdPW5bcl0pfWVsc2V7Zm9yKHI9LTE7KytyPGg7KXU9bltyXSxpPWVbcl0sdT8odS5fX2RhdGFfXz1pLGdbcl09dSk6cFtyXT16KGkpO2Zvcig7Zj5yOysrcilwW3JdPXooZVtyXSk7Zm9yKDthPnI7KytyKXZbcl09bltyXX1wLnVwZGF0ZT1nLHAucGFyZW50Tm9kZT1nLnBhcmVudE5vZGU9di5wYXJlbnROb2RlPW4ucGFyZW50Tm9kZSxjLnB1c2gocCkscy5wdXNoKGcpLGwucHVzaCh2KX12YXIgcix1LGk9LTEsYT10aGlzLmxlbmd0aDtpZighYXJndW1lbnRzLmxlbmd0aCl7Zm9yKG49bmV3IEFycmF5KGE9KHI9dGhpc1swXSkubGVuZ3RoKTsrK2k8YTspKHU9cltpXSkmJihuW2ldPXUuX19kYXRhX18pO3JldHVybiBufXZhciBjPVUoW10pLHM9XyhbXSksbD1fKFtdKTtpZigiZnVuY3Rpb24iPT10eXBlb2Ygbilmb3IoOysraTxhOyllKHI9dGhpc1tpXSxuLmNhbGwocixyLnBhcmVudE5vZGUuX19kYXRhX18saSkpO2Vsc2UgZm9yKDsrK2k8YTspZShyPXRoaXNbaV0sbik7cmV0dXJuIHMuZW50ZXI9ZnVuY3Rpb24oKXtyZXR1cm4gY30scy5leGl0PWZ1bmN0aW9uKCl7cmV0dXJuIGx9LHN9LF9hLmRhdHVtPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3RoaXMucHJvcGVydHkoIl9fZGF0YV9fIixuKTp0aGlzLnByb3BlcnR5KCJfX2RhdGFfXyIpfSxfYS5maWx0ZXI9ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9W107ImZ1bmN0aW9uIiE9dHlwZW9mIG4mJihuPVIobikpO2Zvcih2YXIgaT0wLG89dGhpcy5sZW5ndGg7bz5pO2krKyl7dS5wdXNoKHQ9W10pLHQucGFyZW50Tm9kZT0oZT10aGlzW2ldKS5wYXJlbnROb2RlO2Zvcih2YXIgYT0wLGM9ZS5sZW5ndGg7Yz5hO2ErKykocj1lW2FdKSYmbi5jYWxsKHIsci5fX2RhdGFfXyxhLGkpJiZ0LnB1c2gocil9cmV0dXJuIF8odSl9LF9hLm9yZGVyPWZ1bmN0aW9uKCl7Zm9yKHZhciBuPS0xLHQ9dGhpcy5sZW5ndGg7KytuPHQ7KWZvcih2YXIgZSxyPXRoaXNbbl0sdT1yLmxlbmd0aC0xLGk9clt1XTstLXU+PTA7KShlPXJbdV0pJiYoaSYmaSE9PWUubmV4dFNpYmxpbmcmJmkucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZSxpKSxpPWUpO3JldHVybiB0aGlzfSxfYS5zb3J0PWZ1bmN0aW9uKG4pe249RC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Zm9yKHZhciB0PS0xLGU9dGhpcy5sZW5ndGg7Kyt0PGU7KXRoaXNbdF0uc29ydChuKTtyZXR1cm4gdGhpcy5vcmRlcigpfSxfYS5lYWNoPWZ1bmN0aW9uKG4pe3JldHVybiBQKHRoaXMsZnVuY3Rpb24odCxlLHIpe24uY2FsbCh0LHQuX19kYXRhX18sZSxyKX0pfSxfYS5jYWxsPWZ1bmN0aW9uKG4pe3ZhciB0PVFvKGFyZ3VtZW50cyk7cmV0dXJuIG4uYXBwbHkodFswXT10aGlzLHQpLHRoaXN9LF9hLmVtcHR5PWZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMubm9kZSgpfSxfYS5ub2RlPWZ1bmN0aW9uKCl7Zm9yKHZhciBuPTAsdD10aGlzLmxlbmd0aDt0Pm47bisrKWZvcih2YXIgZT10aGlzW25dLHI9MCx1PWUubGVuZ3RoO3U+cjtyKyspe3ZhciBpPWVbcl07aWYoaSlyZXR1cm4gaX1yZXR1cm4gbnVsbH0sX2Euc2l6ZT1mdW5jdGlvbigpe3ZhciBuPTA7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpeysrbn0pLG59O3ZhciB3YT1bXTtHby5zZWxlY3Rpb24uZW50ZXI9VSxHby5zZWxlY3Rpb24uZW50ZXIucHJvdG90eXBlPXdhLHdhLmFwcGVuZD1fYS5hcHBlbmQsd2EuZW1wdHk9X2EuZW1wdHksd2Eubm9kZT1fYS5ub2RlLHdhLmNhbGw9X2EuY2FsbCx3YS5zaXplPV9hLnNpemUsd2Euc2VsZWN0PWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxlLHIsdSxpLG89W10sYT0tMSxjPXRoaXMubGVuZ3RoOysrYTxjOyl7cj0odT10aGlzW2FdKS51cGRhdGUsby5wdXNoKHQ9W10pLHQucGFyZW50Tm9kZT11LnBhcmVudE5vZGU7Zm9yKHZhciBzPS0xLGw9dS5sZW5ndGg7KytzPGw7KShpPXVbc10pPyh0LnB1c2gocltzXT1lPW4uY2FsbCh1LnBhcmVudE5vZGUsaS5fX2RhdGFfXyxzLGEpKSxlLl9fZGF0YV9fPWkuX19kYXRhX18pOnQucHVzaChudWxsKX1yZXR1cm4gXyhvKX0sd2EuaW5zZXJ0PWZ1bmN0aW9uKG4sdCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MiYmKHQ9aih0aGlzKSksX2EuaW5zZXJ0LmNhbGwodGhpcyxuLHQpfSxfYS50cmFuc2l0aW9uPWZ1bmN0aW9uKCl7Zm9yKHZhciBuLHQsZT1Dc3x8KytScyxyPVtdLHU9THN8fHt0aW1lOkRhdGUubm93KCksZWFzZTp3dSxkZWxheTowLGR1cmF0aW9uOjI1MH0saT0tMSxvPXRoaXMubGVuZ3RoOysraTxvOyl7ci5wdXNoKG49W10pO2Zvcih2YXIgYT10aGlzW2ldLGM9LTEscz1hLmxlbmd0aDsrK2M8czspKHQ9YVtjXSkmJklvKHQsYyxlLHUpLG4ucHVzaCh0KX1yZXR1cm4gRm8ocixlKX0sX2EuaW50ZXJydXB0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChIKX0sR28uc2VsZWN0PWZ1bmN0aW9uKG4pe3ZhciB0PVsic3RyaW5nIj09dHlwZW9mIG4/bWEobixuYSk6bl07cmV0dXJuIHQucGFyZW50Tm9kZT10YSxfKFt0XSl9LEdvLnNlbGVjdEFsbD1mdW5jdGlvbihuKXt2YXIgdD1Rbygic3RyaW5nIj09dHlwZW9mIG4/eWEobixuYSk6bik7cmV0dXJuIHQucGFyZW50Tm9kZT10YSxfKFt0XSl9O3ZhciBTYT1Hby5zZWxlY3QodGEpO19hLm9uPWZ1bmN0aW9uKG4sdCxlKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoO2lmKDM+cil7aWYoInN0cmluZyIhPXR5cGVvZiBuKXsyPnImJih0PSExKTtmb3IoZSBpbiBuKXRoaXMuZWFjaChGKGUsbltlXSx0KSk7cmV0dXJuIHRoaXN9aWYoMj5yKXJldHVybihyPXRoaXMubm9kZSgpWyJfX29uIituXSkmJnIuXztlPSExfXJldHVybiB0aGlzLmVhY2goRihuLHQsZSkpfTt2YXIga2E9R28ubWFwKHttb3VzZWVudGVyOiJtb3VzZW92ZXIiLG1vdXNlbGVhdmU6Im1vdXNlb3V0In0pO2thLmZvckVhY2goZnVuY3Rpb24obil7Im9uIituIGluIG5hJiZrYS5yZW1vdmUobil9KTt2YXIgRWE9Im9uc2VsZWN0c3RhcnQiaW4gbmE/bnVsbDpwKHRhLnN0eWxlLCJ1c2VyU2VsZWN0IiksTmE9MDtHby5tb3VzZT1mdW5jdGlvbihuKXtyZXR1cm4gWihuLHgoKSl9LEdvLnRvdWNoZXM9ZnVuY3Rpb24obix0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyJiYodD14KCkudG91Y2hlcyksdD9Rbyh0KS5tYXAoZnVuY3Rpb24odCl7dmFyIGU9WihuLHQpO3JldHVybiBlLmlkZW50aWZpZXI9dC5pZGVudGlmaWVyLGV9KTpbXX0sR28uYmVoYXZpb3IuZHJhZz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt0aGlzLm9uKCJtb3VzZWRvd24uZHJhZyIsdSkub24oInRvdWNoc3RhcnQuZHJhZyIsaSl9ZnVuY3Rpb24gdChuLHQsdSxpLG8pe3JldHVybiBmdW5jdGlvbigpe2Z1bmN0aW9uIGEoKXt2YXIgbixlLHI9dChoLHYpO3ImJihuPXJbMF0teFswXSxlPXJbMV0teFsxXSxwfD1ufGUseD1yLGcoe3R5cGU6ImRyYWciLHg6clswXStzWzBdLHk6clsxXStzWzFdLGR4Om4sZHk6ZX0pKX1mdW5jdGlvbiBjKCl7dChoLHYpJiYobS5vbihpK2QsbnVsbCkub24obytkLG51bGwpLHkocCYmR28uZXZlbnQudGFyZ2V0PT09ZiksZyh7dHlwZToiZHJhZ2VuZCJ9KSl9dmFyIHMsbD10aGlzLGY9R28uZXZlbnQudGFyZ2V0LGg9bC5wYXJlbnROb2RlLGc9ZS5vZihsLGFyZ3VtZW50cykscD0wLHY9bigpLGQ9Ii5kcmFnIisobnVsbD09dj8iIjoiLSIrdiksbT1Hby5zZWxlY3QodSgpKS5vbihpK2QsYSkub24obytkLGMpLHk9SSgpLHg9dChoLHYpO3I/KHM9ci5hcHBseShsLGFyZ3VtZW50cykscz1bcy54LXhbMF0scy55LXhbMV1dKTpzPVswLDBdLGcoe3R5cGU6ImRyYWdzdGFydCJ9KX19dmFyIGU9TShuLCJkcmFnIiwiZHJhZ3N0YXJ0IiwiZHJhZ2VuZCIpLHI9bnVsbCx1PXQodixHby5tb3VzZSxYLCJtb3VzZW1vdmUiLCJtb3VzZXVwIiksaT10KFYsR28udG91Y2gsJCwidG91Y2htb3ZlIiwidG91Y2hlbmQiKTtyZXR1cm4gbi5vcmlnaW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxHby5yZWJpbmQobixlLCJvbiIpfTt2YXIgQWE9TWF0aC5QSSxDYT0yKkFhLExhPUFhLzIsVGE9MWUtNixxYT1UYSpUYSx6YT1BYS8xODAsUmE9MTgwL0FhLERhPU1hdGguU1FSVDIsUGE9MixVYT00O0dvLmludGVycG9sYXRlWm9vbT1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIGUobil7dmFyIHQ9bip5O2lmKG0pe3ZhciBlPVEodiksbz1pLyhQYSpoKSooZSpudChEYSp0K3YpLUsodikpO3JldHVybltyK28qcyx1K28qbCxpKmUvUShEYSp0K3YpXX1yZXR1cm5bcituKnMsdStuKmwsaSpNYXRoLmV4cChEYSp0KV19dmFyIHI9blswXSx1PW5bMV0saT1uWzJdLG89dFswXSxhPXRbMV0sYz10WzJdLHM9by1yLGw9YS11LGY9cypzK2wqbCxoPU1hdGguc3FydChmKSxnPShjKmMtaSppK1VhKmYpLygyKmkqUGEqaCkscD0oYypjLWkqaS1VYSpmKS8oMipjKlBhKmgpLHY9TWF0aC5sb2coTWF0aC5zcXJ0KGcqZysxKS1nKSxkPU1hdGgubG9nKE1hdGguc3FydChwKnArMSktcCksbT1kLXYseT0obXx8TWF0aC5sb2coYy9pKSkvRGE7cmV0dXJuIGUuZHVyYXRpb249MWUzKnksZX0sR28uYmVoYXZpb3Iuem9vbT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obil7bi5vbihOLHMpLm9uKEZhKyIuem9vbSIsZikub24oQSxoKS5vbigiZGJsY2xpY2suem9vbSIsZykub24oTCxsKX1mdW5jdGlvbiB0KG4pe3JldHVyblsoblswXS1TLngpL1MuaywoblsxXS1TLnkpL1Mua119ZnVuY3Rpb24gZShuKXtyZXR1cm5bblswXSpTLmsrUy54LG5bMV0qUy5rK1MueV19ZnVuY3Rpb24gcihuKXtTLms9TWF0aC5tYXgoRVswXSxNYXRoLm1pbihFWzFdLG4pKX1mdW5jdGlvbiB1KG4sdCl7dD1lKHQpLFMueCs9blswXS10WzBdLFMueSs9blsxXS10WzFdfWZ1bmN0aW9uIGkoKXtfJiZfLmRvbWFpbih4LnJhbmdlKCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybihuLVMueCkvUy5rfSkubWFwKHguaW52ZXJ0KSksdyYmdy5kb21haW4oYi5yYW5nZSgpLm1hcChmdW5jdGlvbihuKXtyZXR1cm4obi1TLnkpL1Mua30pLm1hcChiLmludmVydCkpfWZ1bmN0aW9uIG8obil7bih7dHlwZToiem9vbXN0YXJ0In0pfWZ1bmN0aW9uIGEobil7aSgpLG4oe3R5cGU6Inpvb20iLHNjYWxlOlMuayx0cmFuc2xhdGU6W1MueCxTLnldfSl9ZnVuY3Rpb24gYyhuKXtuKHt0eXBlOiJ6b29tZW5kIn0pfWZ1bmN0aW9uIHMoKXtmdW5jdGlvbiBuKCl7bD0xLHUoR28ubW91c2UociksZyksYShzKX1mdW5jdGlvbiBlKCl7Zi5vbihBLGVhPT09cj9oOm51bGwpLm9uKEMsbnVsbCkscChsJiZHby5ldmVudC50YXJnZXQ9PT1pKSxjKHMpfXZhciByPXRoaXMsaT1Hby5ldmVudC50YXJnZXQscz1ULm9mKHIsYXJndW1lbnRzKSxsPTAsZj1Hby5zZWxlY3QoZWEpLm9uKEEsbikub24oQyxlKSxnPXQoR28ubW91c2UocikpLHA9SSgpO0guY2FsbChyKSxvKHMpfWZ1bmN0aW9uIGwoKXtmdW5jdGlvbiBuKCl7dmFyIG49R28udG91Y2hlcyhnKTtyZXR1cm4gaD1TLmssbi5mb3JFYWNoKGZ1bmN0aW9uKG4pe24uaWRlbnRpZmllciBpbiB2JiYodltuLmlkZW50aWZpZXJdPXQobikpfSksbn1mdW5jdGlvbiBlKCl7Zm9yKHZhciB0PUdvLmV2ZW50LmNoYW5nZWRUb3VjaGVzLGU9MCxpPXQubGVuZ3RoO2k+ZTsrK2Updlt0W2VdLmlkZW50aWZpZXJdPW51bGw7dmFyIG89bigpLGM9RGF0ZS5ub3coKTtpZigxPT09by5sZW5ndGgpe2lmKDUwMD5jLW0pe3ZhciBzPW9bMF0sbD12W3MuaWRlbnRpZmllcl07cigyKlMuayksdShzLGwpLHkoKSxhKHApfW09Y31lbHNlIGlmKG8ubGVuZ3RoPjEpe3ZhciBzPW9bMF0sZj1vWzFdLGg9c1swXS1mWzBdLGc9c1sxXS1mWzFdO2Q9aCpoK2cqZ319ZnVuY3Rpb24gaSgpe2Zvcih2YXIgbix0LGUsaSxvPUdvLnRvdWNoZXMoZyksYz0wLHM9by5sZW5ndGg7cz5jOysrYyxpPW51bGwpaWYoZT1vW2NdLGk9dltlLmlkZW50aWZpZXJdKXtpZih0KWJyZWFrO249ZSx0PWl9aWYoaSl7dmFyIGw9KGw9ZVswXS1uWzBdKSpsKyhsPWVbMV0tblsxXSkqbCxmPWQmJk1hdGguc3FydChsL2QpO249WyhuWzBdK2VbMF0pLzIsKG5bMV0rZVsxXSkvMl0sdD1bKHRbMF0raVswXSkvMiwodFsxXStpWzFdKS8yXSxyKGYqaCl9bT1udWxsLHUobix0KSxhKHApfWZ1bmN0aW9uIGYoKXtpZihHby5ldmVudC50b3VjaGVzLmxlbmd0aCl7Zm9yKHZhciB0PUdvLmV2ZW50LmNoYW5nZWRUb3VjaGVzLGU9MCxyPXQubGVuZ3RoO3I+ZTsrK2UpZGVsZXRlIHZbdFtlXS5pZGVudGlmaWVyXTtmb3IodmFyIHUgaW4gdilyZXR1cm4gdm9pZCBuKCl9Yi5vbih4LG51bGwpLHcub24oTixzKS5vbihMLGwpLGsoKSxjKHApfXZhciBoLGc9dGhpcyxwPVQub2YoZyxhcmd1bWVudHMpLHY9e30sZD0wLHg9Ii56b29tLSIrR28uZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllcixNPSJ0b3VjaG1vdmUiK3gsXz0idG91Y2hlbmQiK3gsYj1Hby5zZWxlY3QoR28uZXZlbnQudGFyZ2V0KS5vbihNLGkpLm9uKF8sZiksdz1Hby5zZWxlY3QoZykub24oTixudWxsKS5vbihMLGUpLGs9SSgpO0guY2FsbChnKSxlKCksbyhwKX1mdW5jdGlvbiBmKCl7dmFyIG49VC5vZih0aGlzLGFyZ3VtZW50cyk7ZD9jbGVhclRpbWVvdXQoZCk6KEguY2FsbCh0aGlzKSxvKG4pKSxkPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtkPW51bGwsYyhuKX0sNTApLHkoKTt2YXIgZT12fHxHby5tb3VzZSh0aGlzKTtwfHwocD10KGUpKSxyKE1hdGgucG93KDIsLjAwMipqYSgpKSpTLmspLHUoZSxwKSxhKG4pfWZ1bmN0aW9uIGgoKXtwPW51bGx9ZnVuY3Rpb24gZygpe3ZhciBuPVQub2YodGhpcyxhcmd1bWVudHMpLGU9R28ubW91c2UodGhpcyksaT10KGUpLHM9TWF0aC5sb2coUy5rKS9NYXRoLkxOMjtvKG4pLHIoTWF0aC5wb3coMixHby5ldmVudC5zaGlmdEtleT9NYXRoLmNlaWwocyktMTpNYXRoLmZsb29yKHMpKzEpKSx1KGUsaSksYShuKSxjKG4pfXZhciBwLHYsZCxtLHgsXyxiLHcsUz17eDowLHk6MCxrOjF9LGs9Wzk2MCw1MDBdLEU9SGEsTj0ibW91c2Vkb3duLnpvb20iLEE9Im1vdXNlbW92ZS56b29tIixDPSJtb3VzZXVwLnpvb20iLEw9InRvdWNoc3RhcnQuem9vbSIsVD1NKG4sInpvb21zdGFydCIsInpvb20iLCJ6b29tZW5kIik7cmV0dXJuIG4uZXZlbnQ9ZnVuY3Rpb24obil7bi5lYWNoKGZ1bmN0aW9uKCl7dmFyIG49VC5vZih0aGlzLGFyZ3VtZW50cyksdD1TO0NzP0dvLnNlbGVjdCh0aGlzKS50cmFuc2l0aW9uKCkuZWFjaCgic3RhcnQuem9vbSIsZnVuY3Rpb24oKXtTPXRoaXMuX19jaGFydF9ffHx7eDowLHk6MCxrOjF9LG8obil9KS50d2Vlbigiem9vbTp6b29tIixmdW5jdGlvbigpe3ZhciBlPWtbMF0scj1rWzFdLHU9ZS8yLGk9ci8yLG89R28uaW50ZXJwb2xhdGVab29tKFsodS1TLngpL1MuaywoaS1TLnkpL1MuayxlL1Mua10sWyh1LXQueCkvdC5rLChpLXQueSkvdC5rLGUvdC5rXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciByPW8odCksYz1lL3JbMl07dGhpcy5fX2NoYXJ0X189Uz17eDp1LXJbMF0qYyx5OmktclsxXSpjLGs6Y30sYShuKX19KS5lYWNoKCJlbmQuem9vbSIsZnVuY3Rpb24oKXtjKG4pfSk6KHRoaXMuX19jaGFydF9fPVMsbyhuKSxhKG4pLGMobikpfSl9LG4udHJhbnNsYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhTPXt4Oit0WzBdLHk6K3RbMV0sazpTLmt9LGkoKSxuKTpbUy54LFMueV19LG4uc2NhbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KFM9e3g6Uy54LHk6Uy55LGs6K3R9LGkoKSxuKTpTLmt9LG4uc2NhbGVFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KEU9bnVsbD09dD9IYTpbK3RbMF0sK3RbMV1dLG4pOkV9LG4uY2VudGVyPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh2PXQmJlsrdFswXSwrdFsxXV0sbik6dn0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhrPXQmJlsrdFswXSwrdFsxXV0sbik6a30sbi54PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhfPXQseD10LmNvcHkoKSxTPXt4OjAseTowLGs6MX0sbik6X30sbi55PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh3PXQsYj10LmNvcHkoKSxTPXt4OjAseTowLGs6MX0sbik6d30sR28ucmViaW5kKG4sVCwib24iKX07dmFyIGphLEhhPVswLDEvMF0sRmE9Im9ud2hlZWwiaW4gbmE/KGphPWZ1bmN0aW9uKCl7cmV0dXJuLUdvLmV2ZW50LmRlbHRhWSooR28uZXZlbnQuZGVsdGFNb2RlPzEyMDoxKX0sIndoZWVsIik6Im9ubW91c2V3aGVlbCJpbiBuYT8oamE9ZnVuY3Rpb24oKXtyZXR1cm4gR28uZXZlbnQud2hlZWxEZWx0YX0sIm1vdXNld2hlZWwiKTooamE9ZnVuY3Rpb24oKXtyZXR1cm4tR28uZXZlbnQuZGV0YWlsfSwiTW96TW91c2VQaXhlbFNjcm9sbCIpO2V0LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB0aGlzLnJnYigpKyIifSxHby5oc2w9ZnVuY3Rpb24obix0LGUpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgdXQ/cnQobi5oLG4ucyxuLmwpOl90KCIiK24sYnQscnQpOnJ0KCtuLCt0LCtlKX07dmFyIE9hPXV0LnByb3RvdHlwZT1uZXcgZXQ7T2EuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLHJ0KHRoaXMuaCx0aGlzLnMsdGhpcy5sL24pfSxPYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLHJ0KHRoaXMuaCx0aGlzLnMsbip0aGlzLmwpfSxPYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gaXQodGhpcy5oLHRoaXMucyx0aGlzLmwpfSxHby5oY2w9ZnVuY3Rpb24obix0LGUpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgYXQ/b3Qobi5oLG4uYyxuLmwpOm4gaW5zdGFuY2VvZiBsdD9odChuLmwsbi5hLG4uYik6aHQoKG49d3QoKG49R28ucmdiKG4pKS5yLG4uZyxuLmIpKS5sLG4uYSxuLmIpOm90KCtuLCt0LCtlKX07dmFyIFlhPWF0LnByb3RvdHlwZT1uZXcgZXQ7WWEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG90KHRoaXMuaCx0aGlzLmMsTWF0aC5taW4oMTAwLHRoaXMubCtJYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSl9LFlhLmRhcmtlcj1mdW5jdGlvbihuKXtyZXR1cm4gb3QodGhpcy5oLHRoaXMuYyxNYXRoLm1heCgwLHRoaXMubC1JYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSl9LFlhLnJnYj1mdW5jdGlvbigpe3JldHVybiBjdCh0aGlzLmgsdGhpcy5jLHRoaXMubCkucmdiKCl9LEdvLmxhYj1mdW5jdGlvbihuLHQsZSl7cmV0dXJuIDE9PT1hcmd1bWVudHMubGVuZ3RoP24gaW5zdGFuY2VvZiBsdD9zdChuLmwsbi5hLG4uYik6biBpbnN0YW5jZW9mIGF0P2N0KG4ubCxuLmMsbi5oKTp3dCgobj1Hby5yZ2IobikpLnIsbi5nLG4uYik6c3QoK24sK3QsK2UpfTt2YXIgSWE9MTgsWmE9Ljk1MDQ3LFZhPTEsJGE9MS4wODg4MyxYYT1sdC5wcm90b3R5cGU9bmV3IGV0O1hhLmJyaWdodGVyPWZ1bmN0aW9uKG4pe3JldHVybiBzdChNYXRoLm1pbigxMDAsdGhpcy5sK0lhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSxYYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIHN0KE1hdGgubWF4KDAsdGhpcy5sLUlhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSxYYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gZnQodGhpcy5sLHRoaXMuYSx0aGlzLmIpfSxHby5yZ2I9ZnVuY3Rpb24obix0LGUpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgeHQ/eXQobi5yLG4uZyxuLmIpOl90KCIiK24seXQsaXQpOnl0KH5+bix+fnQsfn5lKX07dmFyIEJhPXh0LnByb3RvdHlwZT1uZXcgZXQ7QmEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7bj1NYXRoLnBvdyguNyxhcmd1bWVudHMubGVuZ3RoP246MSk7dmFyIHQ9dGhpcy5yLGU9dGhpcy5nLHI9dGhpcy5iLHU9MzA7cmV0dXJuIHR8fGV8fHI/KHQmJnU+dCYmKHQ9dSksZSYmdT5lJiYoZT11KSxyJiZ1PnImJihyPXUpLHl0KE1hdGgubWluKDI1NSx+fih0L24pKSxNYXRoLm1pbigyNTUsfn4oZS9uKSksTWF0aC5taW4oMjU1LH5+KHIvbikpKSk6eXQodSx1LHUpfSxCYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLHl0KH5+KG4qdGhpcy5yKSx+fihuKnRoaXMuZyksfn4obip0aGlzLmIpKX0sQmEuaHNsPWZ1bmN0aW9uKCl7cmV0dXJuIGJ0KHRoaXMucix0aGlzLmcsdGhpcy5iKX0sQmEudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iIyIrTXQodGhpcy5yKStNdCh0aGlzLmcpK010KHRoaXMuYil9O3ZhciBKYT1Hby5tYXAoe2FsaWNlYmx1ZToxNTc5MjM4MyxhbnRpcXVld2hpdGU6MTY0NDQzNzUsYXF1YTo2NTUzNSxhcXVhbWFyaW5lOjgzODg1NjQsYXp1cmU6MTU3OTQxNzUsYmVpZ2U6MTYxMTkyNjAsYmlzcXVlOjE2NzcwMjQ0LGJsYWNrOjAsYmxhbmNoZWRhbG1vbmQ6MTY3NzIwNDUsYmx1ZToyNTUsYmx1ZXZpb2xldDo5MDU1MjAyLGJyb3duOjEwODI0MjM0LGJ1cmx5d29vZDoxNDU5NjIzMSxjYWRldGJsdWU6NjI2NjUyOCxjaGFydHJldXNlOjgzODgzNTIsY2hvY29sYXRlOjEzNzg5NDcwLGNvcmFsOjE2NzQ0MjcyLGNvcm5mbG93ZXJibHVlOjY1OTE5ODEsY29ybnNpbGs6MTY3NzUzODgsY3JpbXNvbjoxNDQyMzEwMCxjeWFuOjY1NTM1LGRhcmtibHVlOjEzOSxkYXJrY3lhbjozNTcyMyxkYXJrZ29sZGVucm9kOjEyMDkyOTM5LGRhcmtncmF5OjExMTE5MDE3LGRhcmtncmVlbjoyNTYwMCxkYXJrZ3JleToxMTExOTAxNyxkYXJra2hha2k6MTI0MzMyNTksZGFya21hZ2VudGE6OTEwOTY0MyxkYXJrb2xpdmVncmVlbjo1NTk3OTk5LGRhcmtvcmFuZ2U6MTY3NDc1MjAsZGFya29yY2hpZDoxMDA0MDAxMixkYXJrcmVkOjkxMDk1MDQsZGFya3NhbG1vbjoxNTMwODQxMCxkYXJrc2VhZ3JlZW46OTQxOTkxOSxkYXJrc2xhdGVibHVlOjQ3MzQzNDcsZGFya3NsYXRlZ3JheTozMTAwNDk1LGRhcmtzbGF0ZWdyZXk6MzEwMDQ5NSxkYXJrdHVycXVvaXNlOjUyOTQ1LGRhcmt2aW9sZXQ6OTY5OTUzOSxkZWVwcGluazoxNjcxNjk0NyxkZWVwc2t5Ymx1ZTo0OTE1MSxkaW1ncmF5OjY5MDgyNjUsZGltZ3JleTo2OTA4MjY1LGRvZGdlcmJsdWU6MjAwMzE5OSxmaXJlYnJpY2s6MTE2NzQxNDYsZmxvcmFsd2hpdGU6MTY3NzU5MjAsZm9yZXN0Z3JlZW46MjI2Mzg0MixmdWNoc2lhOjE2NzExOTM1LGdhaW5zYm9ybzoxNDQ3NDQ2MCxnaG9zdHdoaXRlOjE2MzE2NjcxLGdvbGQ6MTY3NjY3MjAsZ29sZGVucm9kOjE0MzI5MTIwLGdyYXk6ODQyMTUwNCxncmVlbjozMjc2OCxncmVlbnllbGxvdzoxMTQwMzA1NSxncmV5Ojg0MjE1MDQsaG9uZXlkZXc6MTU3OTQxNjAsaG90cGluazoxNjczODc0MCxpbmRpYW5yZWQ6MTM0NTg1MjQsaW5kaWdvOjQ5MTUzMzAsaXZvcnk6MTY3NzcyMDAsa2hha2k6MTU3ODc2NjAsbGF2ZW5kZXI6MTUxMzI0MTAsbGF2ZW5kZXJibHVzaDoxNjc3MzM2NSxsYXduZ3JlZW46ODE5MDk3NixsZW1vbmNoaWZmb246MTY3NzU4ODUsbGlnaHRibHVlOjExMzkzMjU0LGxpZ2h0Y29yYWw6MTU3NjE1MzYsbGlnaHRjeWFuOjE0NzQ1NTk5LGxpZ2h0Z29sZGVucm9keWVsbG93OjE2NDQ4MjEwLGxpZ2h0Z3JheToxMzg4MjMyMyxsaWdodGdyZWVuOjk0OTgyNTYsbGlnaHRncmV5OjEzODgyMzIzLGxpZ2h0cGluazoxNjc1ODQ2NSxsaWdodHNhbG1vbjoxNjc1Mjc2MixsaWdodHNlYWdyZWVuOjIxNDI4OTAsbGlnaHRza3libHVlOjg5MDAzNDYsbGlnaHRzbGF0ZWdyYXk6NzgzMzc1MyxsaWdodHNsYXRlZ3JleTo3ODMzNzUzLGxpZ2h0c3RlZWxibHVlOjExNTg0NzM0LGxpZ2h0eWVsbG93OjE2Nzc3MTg0LGxpbWU6NjUyODAsbGltZWdyZWVuOjMzMjkzMzAsbGluZW46MTY0NDU2NzAsbWFnZW50YToxNjcxMTkzNSxtYXJvb246ODM4ODYwOCxtZWRpdW1hcXVhbWFyaW5lOjY3MzczMjIsbWVkaXVtYmx1ZToyMDUsbWVkaXVtb3JjaGlkOjEyMjExNjY3LG1lZGl1bXB1cnBsZTo5NjYyNjgzLG1lZGl1bXNlYWdyZWVuOjM5NzgwOTcsbWVkaXVtc2xhdGVibHVlOjgwODc3OTAsbWVkaXVtc3ByaW5nZ3JlZW46NjQxNTQsbWVkaXVtdHVycXVvaXNlOjQ3NzIzMDAsbWVkaXVtdmlvbGV0cmVkOjEzMDQ3MTczLG1pZG5pZ2h0Ymx1ZToxNjQ0OTEyLG1pbnRjcmVhbToxNjEyMTg1MCxtaXN0eXJvc2U6MTY3NzAyNzMsbW9jY2FzaW46MTY3NzAyMjksbmF2YWpvd2hpdGU6MTY3Njg2ODUsbmF2eToxMjgsb2xkbGFjZToxNjY0MzU1OCxvbGl2ZTo4NDIxMzc2LG9saXZlZHJhYjo3MDQ4NzM5LG9yYW5nZToxNjc1MzkyMCxvcmFuZ2VyZWQ6MTY3MjkzNDQsb3JjaGlkOjE0MzE1NzM0LHBhbGVnb2xkZW5yb2Q6MTU2NTcxMzAscGFsZWdyZWVuOjEwMDI1ODgwLHBhbGV0dXJxdW9pc2U6MTE1Mjk5NjYscGFsZXZpb2xldHJlZDoxNDM4MTIwMyxwYXBheWF3aGlwOjE2NzczMDc3LHBlYWNocHVmZjoxNjc2NzY3MyxwZXJ1OjEzNDY4OTkxLHBpbms6MTY3NjEwMzUscGx1bToxNDUyNDYzNyxwb3dkZXJibHVlOjExNTkxOTEwLHB1cnBsZTo4Mzg4NzM2LHJlZDoxNjcxMTY4MCxyb3N5YnJvd246MTIzNTc1MTkscm95YWxibHVlOjQyODY5NDUsc2FkZGxlYnJvd246OTEyNzE4NyxzYWxtb246MTY0MTY4ODIsc2FuZHlicm93bjoxNjAzMjg2NCxzZWFncmVlbjozMDUwMzI3LHNlYXNoZWxsOjE2Nzc0NjM4LHNpZW5uYToxMDUwNjc5NyxzaWx2ZXI6MTI2MzIyNTYsc2t5Ymx1ZTo4OTAwMzMxLHNsYXRlYmx1ZTo2OTcwMDYxLHNsYXRlZ3JheTo3MzcyOTQ0LHNsYXRlZ3JleTo3MzcyOTQ0LHNub3c6MTY3NzU5MzAsc3ByaW5nZ3JlZW46NjU0MDcsc3RlZWxibHVlOjQ2MjA5ODAsdGFuOjEzODA4NzgwLHRlYWw6MzI4OTYsdGhpc3RsZToxNDIwNDg4OCx0b21hdG86MTY3MzcwOTUsdHVycXVvaXNlOjQyNTE4NTYsdmlvbGV0OjE1NjMxMDg2LHdoZWF0OjE2MTEzMzMxLHdoaXRlOjE2Nzc3MjE1LHdoaXRlc21va2U6MTYxMTkyODUseWVsbG93OjE2Nzc2OTYwLHllbGxvd2dyZWVuOjEwMTQ1MDc0fSk7SmEuZm9yRWFjaChmdW5jdGlvbihuLHQpe0phLnNldChuLGR0KHQpKX0pLEdvLmZ1bmN0b3I9RXQsR28ueGhyPUF0KE50KSxHby5kc3Y9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKG4sZSxpKXthcmd1bWVudHMubGVuZ3RoPDMmJihpPWUsZT1udWxsKTt2YXIgbz1DdChuLHQsbnVsbD09ZT9yOnUoZSksaSk7cmV0dXJuIG8ucm93PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP28ucmVzcG9uc2UobnVsbD09KGU9bik/cjp1KG4pKTplfSxvfWZ1bmN0aW9uIHIobil7cmV0dXJuIGUucGFyc2Uobi5yZXNwb25zZVRleHQpfWZ1bmN0aW9uIHUobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBlLnBhcnNlKHQucmVzcG9uc2VUZXh0LG4pfX1mdW5jdGlvbiBpKHQpe3JldHVybiB0Lm1hcChvKS5qb2luKG4pfWZ1bmN0aW9uIG8obil7cmV0dXJuIGEudGVzdChuKT8nIicrbi5yZXBsYWNlKC9cIi9nLCciIicpKyciJzpufXZhciBhPW5ldyBSZWdFeHAoJ1siJytuKyJcbl0iKSxjPW4uY2hhckNvZGVBdCgwKTtyZXR1cm4gZS5wYXJzZT1mdW5jdGlvbihuLHQpe3ZhciByO3JldHVybiBlLnBhcnNlUm93cyhuLGZ1bmN0aW9uKG4sZSl7aWYocilyZXR1cm4gcihuLGUtMSk7dmFyIHU9bmV3IEZ1bmN0aW9uKCJkIiwicmV0dXJuIHsiK24ubWFwKGZ1bmN0aW9uKG4sdCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KG4pKyI6IGRbIit0KyJdIn0pLmpvaW4oIiwiKSsifSIpO3I9dD9mdW5jdGlvbihuLGUpe3JldHVybiB0KHUobiksZSl9OnV9KX0sZS5wYXJzZVJvd3M9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKCl7aWYobD49cylyZXR1cm4gbztpZih1KXJldHVybiB1PSExLGk7dmFyIHQ9bDtpZigzND09PW4uY2hhckNvZGVBdCh0KSl7Zm9yKHZhciBlPXQ7ZSsrPHM7KWlmKDM0PT09bi5jaGFyQ29kZUF0KGUpKXtpZigzNCE9PW4uY2hhckNvZGVBdChlKzEpKWJyZWFrOysrZX1sPWUrMjt2YXIgcj1uLmNoYXJDb2RlQXQoZSsxKTtyZXR1cm4gMTM9PT1yPyh1PSEwLDEwPT09bi5jaGFyQ29kZUF0KGUrMikmJisrbCk6MTA9PT1yJiYodT0hMCksbi5zdWJzdHJpbmcodCsxLGUpLnJlcGxhY2UoLyIiL2csJyInKX1mb3IoO3M+bDspe3ZhciByPW4uY2hhckNvZGVBdChsKyspLGE9MTtpZigxMD09PXIpdT0hMDtlbHNlIGlmKDEzPT09cil1PSEwLDEwPT09bi5jaGFyQ29kZUF0KGwpJiYoKytsLCsrYSk7ZWxzZSBpZihyIT09Yyljb250aW51ZTtyZXR1cm4gbi5zdWJzdHJpbmcodCxsLWEpfXJldHVybiBuLnN1YnN0cmluZyh0KX1mb3IodmFyIHIsdSxpPXt9LG89e30sYT1bXSxzPW4ubGVuZ3RoLGw9MCxmPTA7KHI9ZSgpKSE9PW87KXtmb3IodmFyIGg9W107ciE9PWkmJnIhPT1vOyloLnB1c2gocikscj1lKCk7KCF0fHwoaD10KGgsZisrKSkpJiZhLnB1c2goaCl9cmV0dXJuIGF9LGUuZm9ybWF0PWZ1bmN0aW9uKHQpe2lmKEFycmF5LmlzQXJyYXkodFswXSkpcmV0dXJuIGUuZm9ybWF0Um93cyh0KTt2YXIgcj1uZXcgaCx1PVtdO3JldHVybiB0LmZvckVhY2goZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIG4pci5oYXModCl8fHUucHVzaChyLmFkZCh0KSl9KSxbdS5tYXAobykuam9pbihuKV0uY29uY2F0KHQubWFwKGZ1bmN0aW9uKHQpe3JldHVybiB1Lm1hcChmdW5jdGlvbihuKXtyZXR1cm4gbyh0W25dKX0pLmpvaW4obil9KSkuam9pbigiXG4iKX0sZS5mb3JtYXRSb3dzPWZ1bmN0aW9uKG4pe3JldHVybiBuLm1hcChpKS5qb2luKCJcbiIpfSxlfSxHby5jc3Y9R28uZHN2KCIsIiwidGV4dC9jc3YiKSxHby50c3Y9R28uZHN2KCIJIiwidGV4dC90YWItc2VwYXJhdGVkLXZhbHVlcyIpLEdvLnRvdWNoPWZ1bmN0aW9uKG4sdCxlKXtpZihhcmd1bWVudHMubGVuZ3RoPDMmJihlPXQsdD14KCkuY2hhbmdlZFRvdWNoZXMpLHQpZm9yKHZhciByLHU9MCxpPXQubGVuZ3RoO2k+dTsrK3UpaWYoKHI9dFt1XSkuaWRlbnRpZmllcj09PWUpcmV0dXJuIFoobixyKX07dmFyIFdhLEdhLEthLFFhLG5jLHRjPWVhW3AoZWEsInJlcXVlc3RBbmltYXRpb25GcmFtZSIpXXx8ZnVuY3Rpb24obil7c2V0VGltZW91dChuLDE3KX07R28udGltZXI9ZnVuY3Rpb24obix0LGUpe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg7Mj5yJiYodD0wKSwzPnImJihlPURhdGUubm93KCkpO3ZhciB1PWUrdCxpPXtjOm4sdDp1LGY6ITEsbjpudWxsfTtHYT9HYS5uPWk6V2E9aSxHYT1pLEthfHwoUWE9Y2xlYXJUaW1lb3V0KFFhKSxLYT0xLHRjKFR0KSl9LEdvLnRpbWVyLmZsdXNoPWZ1bmN0aW9uKCl7cXQoKSx6dCgpfSxHby5yb3VuZD1mdW5jdGlvbihuLHQpe3JldHVybiB0P01hdGgucm91bmQobioodD1NYXRoLnBvdygxMCx0KSkpL3Q6TWF0aC5yb3VuZChuKX07dmFyIGVjPVsieSIsInoiLCJhIiwiZiIsInAiLCJuIiwiXHhiNSIsIm0iLCIiLCJrIiwiTSIsIkciLCJUIiwiUCIsIkUiLCJaIiwiWSJdLm1hcChEdCk7R28uZm9ybWF0UHJlZml4PWZ1bmN0aW9uKG4sdCl7dmFyIGU9MDtyZXR1cm4gbiYmKDA+biYmKG4qPS0xKSx0JiYobj1Hby5yb3VuZChuLFJ0KG4sdCkpKSxlPTErTWF0aC5mbG9vcigxZS0xMitNYXRoLmxvZyhuKS9NYXRoLkxOMTApLGU9TWF0aC5tYXgoLTI0LE1hdGgubWluKDI0LDMqTWF0aC5mbG9vcigoZS0xKS8zKSkpKSxlY1s4K2UvM119O3ZhciByYz0vKD86KFtee10pPyhbPD49Xl0pKT8oWytcLSBdKT8oWyQjXSk/KDApPyhcZCspPygsKT8oXC4tP1xkKyk/KFthLXolXSk/L2ksdWM9R28ubWFwKHtiOmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDIpfSxjOmZ1bmN0aW9uKG4pe3JldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pfSxvOmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDgpfSx4OmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDE2KX0sWDpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX0sZzpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvUHJlY2lzaW9uKHQpfSxlOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4udG9FeHBvbmVudGlhbCh0KX0sZjpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvRml4ZWQodCl9LHI6ZnVuY3Rpb24obix0KXtyZXR1cm4obj1Hby5yb3VuZChuLFJ0KG4sdCkpKS50b0ZpeGVkKE1hdGgubWF4KDAsTWF0aC5taW4oMjAsUnQobiooMSsxZS0xNSksdCkpKSl9fSksaWM9R28udGltZT17fSxvYz1EYXRlO2p0LnByb3RvdHlwZT17Z2V0RGF0ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDRGF0ZSgpfSxnZXREYXk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0RheSgpfSxnZXRGdWxsWWVhcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDRnVsbFllYXIoKX0sZ2V0SG91cnM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0hvdXJzKCl9LGdldE1pbGxpc2Vjb25kczpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDTWlsbGlzZWNvbmRzKCl9LGdldE1pbnV0ZXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01pbnV0ZXMoKX0sZ2V0TW9udGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01vbnRoKCl9LGdldFNlY29uZHM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ1NlY29uZHMoKX0sZ2V0VGltZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VGltZSgpfSxnZXRUaW1lem9uZU9mZnNldDpmdW5jdGlvbigpe3JldHVybiAwfSx2YWx1ZU9mOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy52YWx1ZU9mKCl9LHNldERhdGU6ZnVuY3Rpb24oKXthYy5zZXRVVENEYXRlLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXREYXk6ZnVuY3Rpb24oKXthYy5zZXRVVENEYXkuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldEZ1bGxZZWFyOmZ1bmN0aW9uKCl7YWMuc2V0VVRDRnVsbFllYXIuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldEhvdXJzOmZ1bmN0aW9uKCl7YWMuc2V0VVRDSG91cnMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1pbGxpc2Vjb25kczpmdW5jdGlvbigpe2FjLnNldFVUQ01pbGxpc2Vjb25kcy5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX0sc2V0TWludXRlczpmdW5jdGlvbigpe2FjLnNldFVUQ01pbnV0ZXMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1vbnRoOmZ1bmN0aW9uKCl7YWMuc2V0VVRDTW9udGguYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldFNlY29uZHM6ZnVuY3Rpb24oKXthYy5zZXRVVENTZWNvbmRzLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRUaW1lOmZ1bmN0aW9uKCl7YWMuc2V0VGltZS5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX19O3ZhciBhYz1EYXRlLnByb3RvdHlwZTtpYy55ZWFyPUh0KGZ1bmN0aW9uKG4pe3JldHVybiBuPWljLmRheShuKSxuLnNldE1vbnRoKDAsMSksbn0sZnVuY3Rpb24obix0KXtuLnNldEZ1bGxZZWFyKG4uZ2V0RnVsbFllYXIoKSt0KX0sZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RnVsbFllYXIoKX0pLGljLnllYXJzPWljLnllYXIucmFuZ2UsaWMueWVhcnMudXRjPWljLnllYXIudXRjLnJhbmdlLGljLmRheT1IdChmdW5jdGlvbihuKXt2YXIgdD1uZXcgb2MoMmUzLDApO3JldHVybiB0LnNldEZ1bGxZZWFyKG4uZ2V0RnVsbFllYXIoKSxuLmdldE1vbnRoKCksbi5nZXREYXRlKCkpLHR9LGZ1bmN0aW9uKG4sdCl7bi5zZXREYXRlKG4uZ2V0RGF0ZSgpK3QpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXREYXRlKCktMX0pLGljLmRheXM9aWMuZGF5LnJhbmdlLGljLmRheXMudXRjPWljLmRheS51dGMucmFuZ2UsaWMuZGF5T2ZZZWFyPWZ1bmN0aW9uKG4pe3ZhciB0PWljLnllYXIobik7cmV0dXJuIE1hdGguZmxvb3IoKG4tdC02ZTQqKG4uZ2V0VGltZXpvbmVPZmZzZXQoKS10LmdldFRpbWV6b25lT2Zmc2V0KCkpKS84NjRlNSl9LFsic3VuZGF5IiwibW9uZGF5IiwidHVlc2RheSIsIndlZG5lc2RheSIsInRodXJzZGF5IiwiZnJpZGF5Iiwic2F0dXJkYXkiXS5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7dD03LXQ7dmFyIGU9aWNbbl09SHQoZnVuY3Rpb24obil7cmV0dXJuKG49aWMuZGF5KG4pKS5zZXREYXRlKG4uZ2V0RGF0ZSgpLShuLmdldERheSgpK3QpJTcpLG59LGZ1bmN0aW9uKG4sdCl7bi5zZXREYXRlKG4uZ2V0RGF0ZSgpKzcqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3ZhciBlPWljLnllYXIobikuZ2V0RGF5KCk7cmV0dXJuIE1hdGguZmxvb3IoKGljLmRheU9mWWVhcihuKSsoZSt0KSU3KS83KS0oZSE9PXQpfSk7aWNbbisicyJdPWUucmFuZ2UsaWNbbisicyJdLnV0Yz1lLnV0Yy5yYW5nZSxpY1tuKyJPZlllYXIiXT1mdW5jdGlvbihuKXt2YXIgZT1pYy55ZWFyKG4pLmdldERheSgpO3JldHVybiBNYXRoLmZsb29yKChpYy5kYXlPZlllYXIobikrKGUrdCklNykvNyl9fSksaWMud2Vlaz1pYy5zdW5kYXksaWMud2Vla3M9aWMuc3VuZGF5LnJhbmdlLGljLndlZWtzLnV0Yz1pYy5zdW5kYXkudXRjLnJhbmdlLGljLndlZWtPZlllYXI9aWMuc3VuZGF5T2ZZZWFyO3ZhciBjYz17Ii0iOiIiLF86IiAiLDA6IjAifSxzYz0vXlxzKlxkKy8sbGM9L14lLztHby5sb2NhbGU9ZnVuY3Rpb24obil7cmV0dXJue251bWJlckZvcm1hdDpQdChuKSx0aW1lRm9ybWF0Ok90KG4pfX07dmFyIGZjPUdvLmxvY2FsZSh7ZGVjaW1hbDoiLiIsdGhvdXNhbmRzOiIsIixncm91cGluZzpbM10sY3VycmVuY3k6WyIkIiwiIl0sZGF0ZVRpbWU6IiVhICViICVlICVYICVZIixkYXRlOiIlbS8lZC8lWSIsdGltZToiJUg6JU06JVMiLHBlcmlvZHM6WyJBTSIsIlBNIl0sZGF5czpbIlN1bmRheSIsIk1vbmRheSIsIlR1ZXNkYXkiLCJXZWRuZXNkYXkiLCJUaHVyc2RheSIsIkZyaWRheSIsIlNhdHVyZGF5Il0sc2hvcnREYXlzOlsiU3VuIiwiTW9uIiwiVHVlIiwiV2VkIiwiVGh1IiwiRnJpIiwiU2F0Il0sbW9udGhzOlsiSmFudWFyeSIsIkZlYnJ1YXJ5IiwiTWFyY2giLCJBcHJpbCIsIk1heSIsIkp1bmUiLCJKdWx5IiwiQXVndXN0IiwiU2VwdGVtYmVyIiwiT2N0b2JlciIsIk5vdmVtYmVyIiwiRGVjZW1iZXIiXSxzaG9ydE1vbnRoczpbIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdfSk7R28uZm9ybWF0PWZjLm51bWJlckZvcm1hdCxHby5nZW89e30sY2UucHJvdG90eXBlPXtzOjAsdDowLGFkZDpmdW5jdGlvbihuKXtzZShuLHRoaXMudCxoYyksc2UoaGMucyx0aGlzLnMsdGhpcyksdGhpcy5zP3RoaXMudCs9aGMudDp0aGlzLnM9aGMudH0scmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLnM9dGhpcy50PTB9LHZhbHVlT2Y6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zfX07dmFyIGhjPW5ldyBjZTtHby5nZW8uc3RyZWFtPWZ1bmN0aW9uKG4sdCl7biYmZ2MuaGFzT3duUHJvcGVydHkobi50eXBlKT9nY1tuLnR5cGVdKG4sdCk6bGUobix0KX07dmFyIGdjPXtGZWF0dXJlOmZ1bmN0aW9uKG4sdCl7bGUobi5nZW9tZXRyeSx0KX0sRmVhdHVyZUNvbGxlY3Rpb246ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9bi5mZWF0dXJlcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KWxlKGVbcl0uZ2VvbWV0cnksdCl9fSxwYz17U3BoZXJlOmZ1bmN0aW9uKG4sdCl7dC5zcGhlcmUoKX0sUG9pbnQ6ZnVuY3Rpb24obix0KXtuPW4uY29vcmRpbmF0ZXMsdC5wb2ludChuWzBdLG5bMV0sblsyXSl9LE11bHRpUG9pbnQ6ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9bi5jb29yZGluYXRlcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KW49ZVtyXSx0LnBvaW50KG5bMF0sblsxXSxuWzJdKX0sTGluZVN0cmluZzpmdW5jdGlvbihuLHQpe2ZlKG4uY29vcmRpbmF0ZXMsdCwwKX0sTXVsdGlMaW5lU3RyaW5nOmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciBlPW4uY29vcmRpbmF0ZXMscj0tMSx1PWUubGVuZ3RoOysrcjx1OylmZShlW3JdLHQsMCl9LFBvbHlnb246ZnVuY3Rpb24obix0KXtoZShuLmNvb3JkaW5hdGVzLHQpfSxNdWx0aVBvbHlnb246ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9bi5jb29yZGluYXRlcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KWhlKGVbcl0sdCl9LEdlb21ldHJ5Q29sbGVjdGlvbjpmdW5jdGlvbihuLHQpe2Zvcih2YXIgZT1uLmdlb21ldHJpZXMscj0tMSx1PWUubGVuZ3RoOysrcjx1OylsZShlW3JdLHQpfX07R28uZ2VvLmFyZWE9ZnVuY3Rpb24obil7cmV0dXJuIHZjPTAsR28uZ2VvLnN0cmVhbShuLG1jKSx2Y307dmFyIHZjLGRjPW5ldyBjZSxtYz17c3BoZXJlOmZ1bmN0aW9uKCl7dmMrPTQqQWF9LHBvaW50OnYsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe2RjLnJlc2V0KCksbWMubGluZVN0YXJ0PWdlfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7dmFyIG49MipkYzt2Yys9MD5uPzQqQWErbjpuLG1jLmxpbmVTdGFydD1tYy5saW5lRW5kPW1jLnBvaW50PXZ9fTtHby5nZW8uYm91bmRzPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHQpe3gucHVzaChNPVtsPW4saD1uXSksZj50JiYoZj10KSx0PmcmJihnPXQpfWZ1bmN0aW9uIHQodCxlKXt2YXIgcj1wZShbdCp6YSxlKnphXSk7aWYobSl7dmFyIHU9ZGUobSxyKSxpPVt1WzFdLC11WzBdLDBdLG89ZGUoaSx1KTt4ZShvKSxvPU1lKG8pO3ZhciBjPXQtcCxzPWM+MD8xOi0xLHY9b1swXSpSYSpzLGQ9ZmEoYyk+MTgwO2lmKGReKHY+cypwJiZzKnQ+dikpe3ZhciB5PW9bMV0qUmE7eT5nJiYoZz15KX1lbHNlIGlmKHY9KHYrMzYwKSUzNjAtMTgwLGReKHY+cypwJiZzKnQ+dikpe3ZhciB5PS1vWzFdKlJhO2Y+eSYmKGY9eSl9ZWxzZSBmPmUmJihmPWUpLGU+ZyYmKGc9ZSk7ZD9wPnQ/YShsLHQpPmEobCxoKSYmKGg9dCk6YSh0LGgpPmEobCxoKSYmKGw9dCk6aD49bD8obD50JiYobD10KSx0PmgmJihoPXQpKTp0PnA/YShsLHQpPmEobCxoKSYmKGg9dCk6YSh0LGgpPmEobCxoKSYmKGw9dCl9ZWxzZSBuKHQsZSk7bT1yLHA9dH1mdW5jdGlvbiBlKCl7Xy5wb2ludD10fWZ1bmN0aW9uIHIoKXtNWzBdPWwsTVsxXT1oLF8ucG9pbnQ9bixtPW51bGx9ZnVuY3Rpb24gdShuLGUpe2lmKG0pe3ZhciByPW4tcDt5Kz1mYShyKT4xODA/cisocj4wPzM2MDotMzYwKTpyfWVsc2Ugdj1uLGQ9ZTttYy5wb2ludChuLGUpLHQobixlKX1mdW5jdGlvbiBpKCl7bWMubGluZVN0YXJ0KCl9ZnVuY3Rpb24gbygpe3UodixkKSxtYy5saW5lRW5kKCksZmEoeSk+VGEmJihsPS0oaD0xODApKSxNWzBdPWwsTVsxXT1oLG09bnVsbH1mdW5jdGlvbiBhKG4sdCl7cmV0dXJuKHQtPW4pPDA/dCszNjA6dH1mdW5jdGlvbiBjKG4sdCl7cmV0dXJuIG5bMF0tdFswXX1mdW5jdGlvbiBzKG4sdCl7cmV0dXJuIHRbMF08PXRbMV0/dFswXTw9biYmbjw9dFsxXTpuPHRbMF18fHRbMV08bn12YXIgbCxmLGgsZyxwLHYsZCxtLHkseCxNLF89e3BvaW50Om4sbGluZVN0YXJ0OmUsbGluZUVuZDpyLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe18ucG9pbnQ9dSxfLmxpbmVTdGFydD1pLF8ubGluZUVuZD1vLHk9MCxtYy5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe21jLnBvbHlnb25FbmQoKSxfLnBvaW50PW4sXy5saW5lU3RhcnQ9ZSxfLmxpbmVFbmQ9ciwwPmRjPyhsPS0oaD0xODApLGY9LShnPTkwKSk6eT5UYT9nPTkwOi1UYT55JiYoZj0tOTApLE1bMF09bCxNWzFdPWgKfX07cmV0dXJuIGZ1bmN0aW9uKG4pe2c9aD0tKGw9Zj0xLzApLHg9W10sR28uZ2VvLnN0cmVhbShuLF8pO3ZhciB0PXgubGVuZ3RoO2lmKHQpe3guc29ydChjKTtmb3IodmFyIGUscj0xLHU9eFswXSxpPVt1XTt0PnI7KytyKWU9eFtyXSxzKGVbMF0sdSl8fHMoZVsxXSx1KT8oYSh1WzBdLGVbMV0pPmEodVswXSx1WzFdKSYmKHVbMV09ZVsxXSksYShlWzBdLHVbMV0pPmEodVswXSx1WzFdKSYmKHVbMF09ZVswXSkpOmkucHVzaCh1PWUpO2Zvcih2YXIgbyxlLHA9LTEvMCx0PWkubGVuZ3RoLTEscj0wLHU9aVt0XTt0Pj1yO3U9ZSwrK3IpZT1pW3JdLChvPWEodVsxXSxlWzBdKSk+cCYmKHA9byxsPWVbMF0saD11WzFdKX1yZXR1cm4geD1NPW51bGwsMS8wPT09bHx8MS8wPT09Zj9bWzAvMCwwLzBdLFswLzAsMC8wXV06W1tsLGZdLFtoLGddXX19KCksR28uZ2VvLmNlbnRyb2lkPWZ1bmN0aW9uKG4pe3ljPXhjPU1jPV9jPWJjPXdjPVNjPWtjPUVjPU5jPUFjPTAsR28uZ2VvLnN0cmVhbShuLENjKTt2YXIgdD1FYyxlPU5jLHI9QWMsdT10KnQrZSplK3IqcjtyZXR1cm4gcWE+dSYmKHQ9d2MsZT1TYyxyPWtjLFRhPnhjJiYodD1NYyxlPV9jLHI9YmMpLHU9dCp0K2UqZStyKnIscWE+dSk/WzAvMCwwLzBdOltNYXRoLmF0YW4yKGUsdCkqUmEsRyhyL01hdGguc3FydCh1KSkqUmFdfTt2YXIgeWMseGMsTWMsX2MsYmMsd2MsU2Msa2MsRWMsTmMsQWMsQ2M9e3NwaGVyZTp2LHBvaW50OmJlLGxpbmVTdGFydDpTZSxsaW5lRW5kOmtlLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe0NjLmxpbmVTdGFydD1FZX0scG9seWdvbkVuZDpmdW5jdGlvbigpe0NjLmxpbmVTdGFydD1TZX19LExjPVRlKE5lLFBlLGplLFstQWEsLUFhLzJdKSxUYz0xZTk7R28uZ2VvLmNsaXBFeHRlbnQ9ZnVuY3Rpb24oKXt2YXIgbix0LGUscix1LGksbz17c3RyZWFtOmZ1bmN0aW9uKG4pe3JldHVybiB1JiYodS52YWxpZD0hMSksdT1pKG4pLHUudmFsaWQ9ITAsdX0sZXh0ZW50OmZ1bmN0aW9uKGEpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPU9lKG49K2FbMF1bMF0sdD0rYVswXVsxXSxlPSthWzFdWzBdLHI9K2FbMV1bMV0pLHUmJih1LnZhbGlkPSExLHU9bnVsbCksbyk6W1tuLHRdLFtlLHJdXX19O3JldHVybiBvLmV4dGVudChbWzAsMF0sWzk2MCw1MDBdXSl9LChHby5nZW8uY29uaWNFcXVhbEFyZWE9ZnVuY3Rpb24oKXtyZXR1cm4gSWUoWmUpfSkucmF3PVplLEdvLmdlby5hbGJlcnM9ZnVuY3Rpb24oKXtyZXR1cm4gR28uZ2VvLmNvbmljRXF1YWxBcmVhKCkucm90YXRlKFs5NiwwXSkuY2VudGVyKFstLjYsMzguN10pLnBhcmFsbGVscyhbMjkuNSw0NS41XSkuc2NhbGUoMTA3MCl9LEdvLmdlby5hbGJlcnNVc2E9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3ZhciBpPW5bMF0sbz1uWzFdO3JldHVybiB0PW51bGwsZShpLG8pLHR8fChyKGksbyksdCl8fHUoaSxvKSx0fXZhciB0LGUscix1LGk9R28uZ2VvLmFsYmVycygpLG89R28uZ2VvLmNvbmljRXF1YWxBcmVhKCkucm90YXRlKFsxNTQsMF0pLmNlbnRlcihbLTIsNTguNV0pLnBhcmFsbGVscyhbNTUsNjVdKSxhPUdvLmdlby5jb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbMTU3LDBdKS5jZW50ZXIoWy0zLDE5LjldKS5wYXJhbGxlbHMoWzgsMThdKSxjPXtwb2ludDpmdW5jdGlvbihuLGUpe3Q9W24sZV19fTtyZXR1cm4gbi5pbnZlcnQ9ZnVuY3Rpb24obil7dmFyIHQ9aS5zY2FsZSgpLGU9aS50cmFuc2xhdGUoKSxyPShuWzBdLWVbMF0pL3QsdT0oblsxXS1lWzFdKS90O3JldHVybih1Pj0uMTImJi4yMzQ+dSYmcj49LS40MjUmJi0uMjE0PnI/bzp1Pj0uMTY2JiYuMjM0PnUmJnI+PS0uMjE0JiYtLjExNT5yP2E6aSkuaW52ZXJ0KG4pfSxuLnN0cmVhbT1mdW5jdGlvbihuKXt2YXIgdD1pLnN0cmVhbShuKSxlPW8uc3RyZWFtKG4pLHI9YS5zdHJlYW0obik7cmV0dXJue3BvaW50OmZ1bmN0aW9uKG4sdSl7dC5wb2ludChuLHUpLGUucG9pbnQobix1KSxyLnBvaW50KG4sdSl9LHNwaGVyZTpmdW5jdGlvbigpe3Quc3BoZXJlKCksZS5zcGhlcmUoKSxyLnNwaGVyZSgpfSxsaW5lU3RhcnQ6ZnVuY3Rpb24oKXt0LmxpbmVTdGFydCgpLGUubGluZVN0YXJ0KCksci5saW5lU3RhcnQoKX0sbGluZUVuZDpmdW5jdGlvbigpe3QubGluZUVuZCgpLGUubGluZUVuZCgpLHIubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25TdGFydCgpLGUucG9seWdvblN0YXJ0KCksci5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3QucG9seWdvbkVuZCgpLGUucG9seWdvbkVuZCgpLHIucG9seWdvbkVuZCgpfX19LG4ucHJlY2lzaW9uPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpLnByZWNpc2lvbih0KSxvLnByZWNpc2lvbih0KSxhLnByZWNpc2lvbih0KSxuKTppLnByZWNpc2lvbigpfSxuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpLnNjYWxlKHQpLG8uc2NhbGUoLjM1KnQpLGEuc2NhbGUodCksbi50cmFuc2xhdGUoaS50cmFuc2xhdGUoKSkpOmkuc2NhbGUoKX0sbi50cmFuc2xhdGU9ZnVuY3Rpb24odCl7aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGkudHJhbnNsYXRlKCk7dmFyIHM9aS5zY2FsZSgpLGw9K3RbMF0sZj0rdFsxXTtyZXR1cm4gZT1pLnRyYW5zbGF0ZSh0KS5jbGlwRXh0ZW50KFtbbC0uNDU1KnMsZi0uMjM4KnNdLFtsKy40NTUqcyxmKy4yMzgqc11dKS5zdHJlYW0oYykucG9pbnQscj1vLnRyYW5zbGF0ZShbbC0uMzA3KnMsZisuMjAxKnNdKS5jbGlwRXh0ZW50KFtbbC0uNDI1KnMrVGEsZisuMTIqcytUYV0sW2wtLjIxNCpzLVRhLGYrLjIzNCpzLVRhXV0pLnN0cmVhbShjKS5wb2ludCx1PWEudHJhbnNsYXRlKFtsLS4yMDUqcyxmKy4yMTIqc10pLmNsaXBFeHRlbnQoW1tsLS4yMTQqcytUYSxmKy4xNjYqcytUYV0sW2wtLjExNSpzLVRhLGYrLjIzNCpzLVRhXV0pLnN0cmVhbShjKS5wb2ludCxufSxuLnNjYWxlKDEwNzApfTt2YXIgcWMsemMsUmMsRGMsUGMsVWMsamM9e3BvaW50OnYsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3pjPTAsamMubGluZVN0YXJ0PVZlfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7amMubGluZVN0YXJ0PWpjLmxpbmVFbmQ9amMucG9pbnQ9dixxYys9ZmEoemMvMil9fSxIYz17cG9pbnQ6JGUsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDp2LHBvbHlnb25FbmQ6dn0sRmM9e3BvaW50OkplLGxpbmVTdGFydDpXZSxsaW5lRW5kOkdlLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe0ZjLmxpbmVTdGFydD1LZX0scG9seWdvbkVuZDpmdW5jdGlvbigpe0ZjLnBvaW50PUplLEZjLmxpbmVTdGFydD1XZSxGYy5saW5lRW5kPUdlfX07R28uZ2VvLnBhdGg9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3JldHVybiBuJiYoImZ1bmN0aW9uIj09dHlwZW9mIGEmJmkucG9pbnRSYWRpdXMoK2EuYXBwbHkodGhpcyxhcmd1bWVudHMpKSxvJiZvLnZhbGlkfHwobz11KGkpKSxHby5nZW8uc3RyZWFtKG4sbykpLGkucmVzdWx0KCl9ZnVuY3Rpb24gdCgpe3JldHVybiBvPW51bGwsbn12YXIgZSxyLHUsaSxvLGE9NC41O3JldHVybiBuLmFyZWE9ZnVuY3Rpb24obil7cmV0dXJuIHFjPTAsR28uZ2VvLnN0cmVhbShuLHUoamMpKSxxY30sbi5jZW50cm9pZD1mdW5jdGlvbihuKXtyZXR1cm4gTWM9X2M9YmM9d2M9U2M9a2M9RWM9TmM9QWM9MCxHby5nZW8uc3RyZWFtKG4sdShGYykpLEFjP1tFYy9BYyxOYy9BY106a2M/W3djL2tjLFNjL2tjXTpiYz9bTWMvYmMsX2MvYmNdOlswLzAsMC8wXX0sbi5ib3VuZHM9ZnVuY3Rpb24obil7cmV0dXJuIFBjPVVjPS0oUmM9RGM9MS8wKSxHby5nZW8uc3RyZWFtKG4sdShIYykpLFtbUmMsRGNdLFtQYyxVY11dfSxuLnByb2plY3Rpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9KGU9bik/bi5zdHJlYW18fHRyKG4pOk50LHQoKSk6ZX0sbi5jb250ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPW51bGw9PShyPW4pP25ldyBYZTpuZXcgUWUobiksImZ1bmN0aW9uIiE9dHlwZW9mIGEmJmkucG9pbnRSYWRpdXMoYSksdCgpKTpyfSxuLnBvaW50UmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6KGkucG9pbnRSYWRpdXMoK3QpLCt0KSxuKTphfSxuLnByb2plY3Rpb24oR28uZ2VvLmFsYmVyc1VzYSgpKS5jb250ZXh0KG51bGwpfSxHby5nZW8udHJhbnNmb3JtPWZ1bmN0aW9uKG4pe3JldHVybntzdHJlYW06ZnVuY3Rpb24odCl7dmFyIGU9bmV3IGVyKHQpO2Zvcih2YXIgciBpbiBuKWVbcl09bltyXTtyZXR1cm4gZX19fSxlci5wcm90b3R5cGU9e3BvaW50OmZ1bmN0aW9uKG4sdCl7dGhpcy5zdHJlYW0ucG9pbnQobix0KX0sc3BoZXJlOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLmxpbmVTdGFydCgpfSxsaW5lRW5kOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0ubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0aGlzLnN0cmVhbS5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLnBvbHlnb25FbmQoKX19LEdvLmdlby5wcm9qZWN0aW9uPXVyLEdvLmdlby5wcm9qZWN0aW9uTXV0YXRvcj1pciwoR28uZ2VvLmVxdWlyZWN0YW5ndWxhcj1mdW5jdGlvbigpe3JldHVybiB1cihhcil9KS5yYXc9YXIuaW52ZXJ0PWFyLEdvLmdlby5yb3RhdGlvbj1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KHQpe3JldHVybiB0PW4odFswXSp6YSx0WzFdKnphKSx0WzBdKj1SYSx0WzFdKj1SYSx0fXJldHVybiBuPXNyKG5bMF0lMzYwKnphLG5bMV0qemEsbi5sZW5ndGg+Mj9uWzJdKnphOjApLHQuaW52ZXJ0PWZ1bmN0aW9uKHQpe3JldHVybiB0PW4uaW52ZXJ0KHRbMF0qemEsdFsxXSp6YSksdFswXSo9UmEsdFsxXSo9UmEsdH0sdH0sY3IuaW52ZXJ0PWFyLEdvLmdlby5jaXJjbGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49ImZ1bmN0aW9uIj09dHlwZW9mIHI/ci5hcHBseSh0aGlzLGFyZ3VtZW50cyk6cix0PXNyKC1uWzBdKnphLC1uWzFdKnphLDApLmludmVydCx1PVtdO3JldHVybiBlKG51bGwsbnVsbCwxLHtwb2ludDpmdW5jdGlvbihuLGUpe3UucHVzaChuPXQobixlKSksblswXSo9UmEsblsxXSo9UmF9fSkse3R5cGU6IlBvbHlnb24iLGNvb3JkaW5hdGVzOlt1XX19dmFyIHQsZSxyPVswLDBdLHU9NjtyZXR1cm4gbi5vcmlnaW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxuLmFuZ2xlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPWdyKCh0PStyKSp6YSx1KnphKSxuKTp0fSxuLnByZWNpc2lvbj1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1ncih0KnphLCh1PStyKSp6YSksbik6dX0sbi5hbmdsZSg5MCl9LEdvLmdlby5kaXN0YW5jZT1mdW5jdGlvbihuLHQpe3ZhciBlLHI9KHRbMF0tblswXSkqemEsdT1uWzFdKnphLGk9dFsxXSp6YSxvPU1hdGguc2luKHIpLGE9TWF0aC5jb3MociksYz1NYXRoLnNpbih1KSxzPU1hdGguY29zKHUpLGw9TWF0aC5zaW4oaSksZj1NYXRoLmNvcyhpKTtyZXR1cm4gTWF0aC5hdGFuMihNYXRoLnNxcnQoKGU9ZipvKSplKyhlPXMqbC1jKmYqYSkqZSksYypsK3MqZiphKX0sR28uZ2VvLmdyYXRpY3VsZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXtyZXR1cm57dHlwZToiTXVsdGlMaW5lU3RyaW5nIixjb29yZGluYXRlczp0KCl9fWZ1bmN0aW9uIHQoKXtyZXR1cm4gR28ucmFuZ2UoTWF0aC5jZWlsKGkvZCkqZCx1LGQpLm1hcChoKS5jb25jYXQoR28ucmFuZ2UoTWF0aC5jZWlsKHMvbSkqbSxjLG0pLm1hcChnKSkuY29uY2F0KEdvLnJhbmdlKE1hdGguY2VpbChyL3ApKnAsZSxwKS5maWx0ZXIoZnVuY3Rpb24obil7cmV0dXJuIGZhKG4lZCk+VGF9KS5tYXAobCkpLmNvbmNhdChHby5yYW5nZShNYXRoLmNlaWwoYS92KSp2LG8sdikuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBmYShuJW0pPlRhfSkubWFwKGYpKX12YXIgZSxyLHUsaSxvLGEsYyxzLGwsZixoLGcscD0xMCx2PXAsZD05MCxtPTM2MCx5PTIuNTtyZXR1cm4gbi5saW5lcz1mdW5jdGlvbigpe3JldHVybiB0KCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybnt0eXBlOiJMaW5lU3RyaW5nIixjb29yZGluYXRlczpufX0pfSxuLm91dGxpbmU9ZnVuY3Rpb24oKXtyZXR1cm57dHlwZToiUG9seWdvbiIsY29vcmRpbmF0ZXM6W2goaSkuY29uY2F0KGcoYykuc2xpY2UoMSksaCh1KS5yZXZlcnNlKCkuc2xpY2UoMSksZyhzKS5yZXZlcnNlKCkuc2xpY2UoMSkpXX19LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JFeHRlbnQodCkubWlub3JFeHRlbnQodCk6bi5taW5vckV4dGVudCgpfSxuLm1ham9yRXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSt0WzBdWzBdLHU9K3RbMV1bMF0scz0rdFswXVsxXSxjPSt0WzFdWzFdLGk+dSYmKHQ9aSxpPXUsdT10KSxzPmMmJih0PXMscz1jLGM9dCksbi5wcmVjaXNpb24oeSkpOltbaSxzXSxbdSxjXV19LG4ubWlub3JFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9K3RbMF1bMF0sZT0rdFsxXVswXSxhPSt0WzBdWzFdLG89K3RbMV1bMV0scj5lJiYodD1yLHI9ZSxlPXQpLGE+byYmKHQ9YSxhPW8sbz10KSxuLnByZWNpc2lvbih5KSk6W1tyLGFdLFtlLG9dXX0sbi5zdGVwPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JTdGVwKHQpLm1pbm9yU3RlcCh0KTpuLm1pbm9yU3RlcCgpfSxuLm1ham9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZD0rdFswXSxtPSt0WzFdLG4pOltkLG1dfSxuLm1pbm9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD0rdFswXSx2PSt0WzFdLG4pOltwLHZdfSxuLnByZWNpc2lvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oeT0rdCxsPXZyKGEsbyw5MCksZj1kcihyLGUseSksaD12cihzLGMsOTApLGc9ZHIoaSx1LHkpLG4pOnl9LG4ubWFqb3JFeHRlbnQoW1stMTgwLC05MCtUYV0sWzE4MCw5MC1UYV1dKS5taW5vckV4dGVudChbWy0xODAsLTgwLVRhXSxbMTgwLDgwK1RhXV0pfSxHby5nZW8uZ3JlYXRBcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7cmV0dXJue3R5cGU6IkxpbmVTdHJpbmciLGNvb3JkaW5hdGVzOlt0fHxyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxlfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKV19fXZhciB0LGUscj1tcix1PXlyO3JldHVybiBuLmRpc3RhbmNlPWZ1bmN0aW9uKCl7cmV0dXJuIEdvLmdlby5kaXN0YW5jZSh0fHxyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxlfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9LG4uc291cmNlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPWUsdD0iZnVuY3Rpb24iPT10eXBlb2YgZT9udWxsOmUsbik6cn0sbi50YXJnZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9dCxlPSJmdW5jdGlvbiI9PXR5cGVvZiB0P251bGw6dCxuKTp1fSxuLnByZWNpc2lvbj1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP246MH0sbn0sR28uZ2VvLmludGVycG9sYXRlPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHhyKG5bMF0qemEsblsxXSp6YSx0WzBdKnphLHRbMV0qemEpfSxHby5nZW8ubGVuZ3RoPWZ1bmN0aW9uKG4pe3JldHVybiBPYz0wLEdvLmdlby5zdHJlYW0obixZYyksT2N9O3ZhciBPYyxZYz17c3BoZXJlOnYscG9pbnQ6dixsaW5lU3RhcnQ6TXIsbGluZUVuZDp2LHBvbHlnb25TdGFydDp2LHBvbHlnb25FbmQ6dn0sSWM9X3IoZnVuY3Rpb24obil7cmV0dXJuIE1hdGguc3FydCgyLygxK24pKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hc2luKG4vMil9KTsoR28uZ2VvLmF6aW11dGhhbEVxdWFsQXJlYT1mdW5jdGlvbigpe3JldHVybiB1cihJYyl9KS5yYXc9SWM7dmFyIFpjPV9yKGZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguYWNvcyhuKTtyZXR1cm4gdCYmdC9NYXRoLnNpbih0KX0sTnQpOyhHby5nZW8uYXppbXV0aGFsRXF1aWRpc3RhbnQ9ZnVuY3Rpb24oKXtyZXR1cm4gdXIoWmMpfSkucmF3PVpjLChHby5nZW8uY29uaWNDb25mb3JtYWw9ZnVuY3Rpb24oKXtyZXR1cm4gSWUoYnIpfSkucmF3PWJyLChHby5nZW8uY29uaWNFcXVpZGlzdGFudD1mdW5jdGlvbigpe3JldHVybiBJZSh3cil9KS5yYXc9d3I7dmFyIFZjPV9yKGZ1bmN0aW9uKG4pe3JldHVybiAxL259LE1hdGguYXRhbik7KEdvLmdlby5nbm9tb25pYz1mdW5jdGlvbigpe3JldHVybiB1cihWYyl9KS5yYXc9VmMsU3IuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7cmV0dXJuW24sMipNYXRoLmF0YW4oTWF0aC5leHAodCkpLUxhXX0sKEdvLmdlby5tZXJjYXRvcj1mdW5jdGlvbigpe3JldHVybiBrcihTcil9KS5yYXc9U3I7dmFyICRjPV9yKGZ1bmN0aW9uKCl7cmV0dXJuIDF9LE1hdGguYXNpbik7KEdvLmdlby5vcnRob2dyYXBoaWM9ZnVuY3Rpb24oKXtyZXR1cm4gdXIoJGMpfSkucmF3PSRjO3ZhciBYYz1fcihmdW5jdGlvbihuKXtyZXR1cm4gMS8oMStuKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hdGFuKG4pfSk7KEdvLmdlby5zdGVyZW9ncmFwaGljPWZ1bmN0aW9uKCl7cmV0dXJuIHVyKFhjKX0pLnJhdz1YYyxFci5pbnZlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm5bLXQsMipNYXRoLmF0YW4oTWF0aC5leHAobikpLUxhXX0sKEdvLmdlby50cmFuc3ZlcnNlTWVyY2F0b3I9ZnVuY3Rpb24oKXt2YXIgbj1rcihFciksdD1uLmNlbnRlcixlPW4ucm90YXRlO3JldHVybiBuLmNlbnRlcj1mdW5jdGlvbihuKXtyZXR1cm4gbj90KFstblsxXSxuWzBdXSk6KG49dCgpLFstblsxXSxuWzBdXSl9LG4ucm90YXRlPWZ1bmN0aW9uKG4pe3JldHVybiBuP2UoW25bMF0sblsxXSxuLmxlbmd0aD4yP25bMl0rOTA6OTBdKToobj1lKCksW25bMF0sblsxXSxuWzJdLTkwXSl9LG4ucm90YXRlKFswLDBdKX0pLnJhdz1FcixHby5nZW9tPXt9LEdvLmdlb20uaHVsbD1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe2lmKG4ubGVuZ3RoPDMpcmV0dXJuW107dmFyIHQsdT1FdChlKSxpPUV0KHIpLG89bi5sZW5ndGgsYT1bXSxjPVtdO2Zvcih0PTA7bz50O3QrKylhLnB1c2goWyt1LmNhbGwodGhpcyxuW3RdLHQpLCtpLmNhbGwodGhpcyxuW3RdLHQpLHRdKTtmb3IoYS5zb3J0KExyKSx0PTA7bz50O3QrKyljLnB1c2goW2FbdF1bMF0sLWFbdF1bMV1dKTt2YXIgcz1DcihhKSxsPUNyKGMpLGY9bFswXT09PXNbMF0saD1sW2wubGVuZ3RoLTFdPT09c1tzLmxlbmd0aC0xXSxnPVtdO2Zvcih0PXMubGVuZ3RoLTE7dD49MDstLXQpZy5wdXNoKG5bYVtzW3RdXVsyXV0pO2Zvcih0PStmO3Q8bC5sZW5ndGgtaDsrK3QpZy5wdXNoKG5bYVtsW3RdXVsyXV0pO3JldHVybiBnfXZhciBlPU5yLHI9QXI7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dChuKToodC54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPW4sdCk6ZX0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdCl9LEdvLmdlb20ucG9seWdvbj1mdW5jdGlvbihuKXtyZXR1cm4gZGEobixCYyksbn07dmFyIEJjPUdvLmdlb20ucG9seWdvbi5wcm90b3R5cGU9W107QmMuYXJlYT1mdW5jdGlvbigpe2Zvcih2YXIgbix0PS0xLGU9dGhpcy5sZW5ndGgscj10aGlzW2UtMV0sdT0wOysrdDxlOyluPXIscj10aGlzW3RdLHUrPW5bMV0qclswXS1uWzBdKnJbMV07cmV0dXJuLjUqdX0sQmMuY2VudHJvaWQ9ZnVuY3Rpb24obil7dmFyIHQsZSxyPS0xLHU9dGhpcy5sZW5ndGgsaT0wLG89MCxhPXRoaXNbdS0xXTtmb3IoYXJndW1lbnRzLmxlbmd0aHx8KG49LTEvKDYqdGhpcy5hcmVhKCkpKTsrK3I8dTspdD1hLGE9dGhpc1tyXSxlPXRbMF0qYVsxXS1hWzBdKnRbMV0saSs9KHRbMF0rYVswXSkqZSxvKz0odFsxXSthWzFdKSplO3JldHVybltpKm4sbypuXX0sQmMuY2xpcD1mdW5jdGlvbihuKXtmb3IodmFyIHQsZSxyLHUsaSxvLGE9enIobiksYz0tMSxzPXRoaXMubGVuZ3RoLXpyKHRoaXMpLGw9dGhpc1tzLTFdOysrYzxzOyl7Zm9yKHQ9bi5zbGljZSgpLG4ubGVuZ3RoPTAsdT10aGlzW2NdLGk9dFsocj10Lmxlbmd0aC1hKS0xXSxlPS0xOysrZTxyOylvPXRbZV0sVHIobyxsLHUpPyhUcihpLGwsdSl8fG4ucHVzaChxcihpLG8sbCx1KSksbi5wdXNoKG8pKTpUcihpLGwsdSkmJm4ucHVzaChxcihpLG8sbCx1KSksaT1vO2EmJm4ucHVzaChuWzBdKSxsPXV9cmV0dXJuIG59O3ZhciBKYyxXYyxHYyxLYyxRYyxucz1bXSx0cz1bXTtPci5wcm90b3R5cGUucHJlcGFyZT1mdW5jdGlvbigpe2Zvcih2YXIgbix0PXRoaXMuZWRnZXMsZT10Lmxlbmd0aDtlLS07KW49dFtlXS5lZGdlLG4uYiYmbi5hfHx0LnNwbGljZShlLDEpO3JldHVybiB0LnNvcnQoSXIpLHQubGVuZ3RofSxRci5wcm90b3R5cGU9e3N0YXJ0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWRnZS5sPT09dGhpcy5zaXRlP3RoaXMuZWRnZS5hOnRoaXMuZWRnZS5ifSxlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lZGdlLmw9PT10aGlzLnNpdGU/dGhpcy5lZGdlLmI6dGhpcy5lZGdlLmF9fSxudS5wcm90b3R5cGU9e2luc2VydDpmdW5jdGlvbihuLHQpe3ZhciBlLHIsdTtpZihuKXtpZih0LlA9bix0Lk49bi5OLG4uTiYmKG4uTi5QPXQpLG4uTj10LG4uUil7Zm9yKG49bi5SO24uTDspbj1uLkw7bi5MPXR9ZWxzZSBuLlI9dDtlPW59ZWxzZSB0aGlzLl8/KG49dXUodGhpcy5fKSx0LlA9bnVsbCx0Lk49bixuLlA9bi5MPXQsZT1uKToodC5QPXQuTj1udWxsLHRoaXMuXz10LGU9bnVsbCk7Zm9yKHQuTD10LlI9bnVsbCx0LlU9ZSx0LkM9ITAsbj10O2UmJmUuQzspcj1lLlUsZT09PXIuTD8odT1yLlIsdSYmdS5DPyhlLkM9dS5DPSExLHIuQz0hMCxuPXIpOihuPT09ZS5SJiYoZXUodGhpcyxlKSxuPWUsZT1uLlUpLGUuQz0hMSxyLkM9ITAscnUodGhpcyxyKSkpOih1PXIuTCx1JiZ1LkM/KGUuQz11LkM9ITEsci5DPSEwLG49cik6KG49PT1lLkwmJihydSh0aGlzLGUpLG49ZSxlPW4uVSksZS5DPSExLHIuQz0hMCxldSh0aGlzLHIpKSksZT1uLlU7dGhpcy5fLkM9ITF9LHJlbW92ZTpmdW5jdGlvbihuKXtuLk4mJihuLk4uUD1uLlApLG4uUCYmKG4uUC5OPW4uTiksbi5OPW4uUD1udWxsO3ZhciB0LGUscix1PW4uVSxpPW4uTCxvPW4uUjtpZihlPWk/bz91dShvKTppOm8sdT91Lkw9PT1uP3UuTD1lOnUuUj1lOnRoaXMuXz1lLGkmJm8/KHI9ZS5DLGUuQz1uLkMsZS5MPWksaS5VPWUsZSE9PW8/KHU9ZS5VLGUuVT1uLlUsbj1lLlIsdS5MPW4sZS5SPW8sby5VPWUpOihlLlU9dSx1PWUsbj1lLlIpKToocj1uLkMsbj1lKSxuJiYobi5VPXUpLCFyKXtpZihuJiZuLkMpcmV0dXJuIG4uQz0hMSx2b2lkIDA7ZG97aWYobj09PXRoaXMuXylicmVhaztpZihuPT09dS5MKXtpZih0PXUuUix0LkMmJih0LkM9ITEsdS5DPSEwLGV1KHRoaXMsdSksdD11LlIpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuUiYmdC5SLkN8fCh0LkwuQz0hMSx0LkM9ITAscnUodGhpcyx0KSx0PXUuUiksdC5DPXUuQyx1LkM9dC5SLkM9ITEsZXUodGhpcyx1KSxuPXRoaXMuXzticmVha319ZWxzZSBpZih0PXUuTCx0LkMmJih0LkM9ITEsdS5DPSEwLHJ1KHRoaXMsdSksdD11LkwpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuTCYmdC5MLkN8fCh0LlIuQz0hMSx0LkM9ITAsZXUodGhpcyx0KSx0PXUuTCksdC5DPXUuQyx1LkM9dC5MLkM9ITEscnUodGhpcyx1KSxuPXRoaXMuXzticmVha310LkM9ITAsbj11LHU9dS5VfXdoaWxlKCFuLkMpO24mJihuLkM9ITEpfX19LEdvLmdlb20udm9yb25vaT1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe3ZhciB0PW5ldyBBcnJheShuLmxlbmd0aCkscj1hWzBdWzBdLHU9YVswXVsxXSxpPWFbMV1bMF0sbz1hWzFdWzFdO3JldHVybiBpdShlKG4pLGEpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oZSxhKXt2YXIgYz1lLmVkZ2VzLHM9ZS5zaXRlLGw9dFthXT1jLmxlbmd0aD9jLm1hcChmdW5jdGlvbihuKXt2YXIgdD1uLnN0YXJ0KCk7cmV0dXJuW3QueCx0LnldfSk6cy54Pj1yJiZzLng8PWkmJnMueT49dSYmcy55PD1vP1tbcixvXSxbaSxvXSxbaSx1XSxbcix1XV06W107bC5wb2ludD1uW2FdfSksdH1mdW5jdGlvbiBlKG4pe3JldHVybiBuLm1hcChmdW5jdGlvbihuLHQpe3JldHVybnt4Ok1hdGgucm91bmQoaShuLHQpL1RhKSpUYSx5Ok1hdGgucm91bmQobyhuLHQpL1RhKSpUYSxpOnR9fSl9dmFyIHI9TnIsdT1BcixpPXIsbz11LGE9ZXM7cmV0dXJuIG4/dChuKToodC5saW5rcz1mdW5jdGlvbihuKXtyZXR1cm4gaXUoZShuKSkuZWRnZXMuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBuLmwmJm4ucn0pLm1hcChmdW5jdGlvbih0KXtyZXR1cm57c291cmNlOm5bdC5sLmldLHRhcmdldDpuW3Quci5pXX19KX0sdC50cmlhbmdsZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107cmV0dXJuIGl1KGUobikpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oZSxyKXtmb3IodmFyIHUsaSxvPWUuc2l0ZSxhPWUuZWRnZXMuc29ydChJciksYz0tMSxzPWEubGVuZ3RoLGw9YVtzLTFdLmVkZ2UsZj1sLmw9PT1vP2wucjpsLmw7KytjPHM7KXU9bCxpPWYsbD1hW2NdLmVkZ2UsZj1sLmw9PT1vP2wucjpsLmwscjxpLmkmJnI8Zi5pJiZhdShvLGksZik8MCYmdC5wdXNoKFtuW3JdLG5baS5pXSxuW2YuaV1dKX0pLHR9LHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1FdChyPW4pLHQpOnJ9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1FdCh1PW4pLHQpOnV9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1udWxsPT1uP2VzOm4sdCk6YT09PWVzP251bGw6YX0sdC5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3QuY2xpcEV4dGVudChuJiZbWzAsMF0sbl0pOmE9PT1lcz9udWxsOmEmJmFbMV19LHQpfTt2YXIgZXM9W1stMWU2LC0xZTZdLFsxZTYsMWU2XV07R28uZ2VvbS5kZWxhdW5heT1mdW5jdGlvbihuKXtyZXR1cm4gR28uZ2VvbS52b3Jvbm9pKCkudHJpYW5nbGVzKG4pfSxHby5nZW9tLnF1YWR0cmVlPWZ1bmN0aW9uKG4sdCxlLHIsdSl7ZnVuY3Rpb24gaShuKXtmdW5jdGlvbiBpKG4sdCxlLHIsdSxpLG8sYSl7aWYoIWlzTmFOKGUpJiYhaXNOYU4ocikpaWYobi5sZWFmKXt2YXIgYz1uLngsbD1uLnk7aWYobnVsbCE9YylpZihmYShjLWUpK2ZhKGwtcik8LjAxKXMobix0LGUscix1LGksbyxhKTtlbHNle3ZhciBmPW4ucG9pbnQ7bi54PW4ueT1uLnBvaW50PW51bGwscyhuLGYsYyxsLHUsaSxvLGEpLHMobix0LGUscix1LGksbyxhKX1lbHNlIG4ueD1lLG4ueT1yLG4ucG9pbnQ9dH1lbHNlIHMobix0LGUscix1LGksbyxhKX1mdW5jdGlvbiBzKG4sdCxlLHIsdSxvLGEsYyl7dmFyIHM9LjUqKHUrYSksbD0uNSoobytjKSxmPWU+PXMsaD1yPj1sLGc9KGg8PDEpK2Y7bi5sZWFmPSExLG49bi5ub2Rlc1tnXXx8KG4ubm9kZXNbZ109bHUoKSksZj91PXM6YT1zLGg/bz1sOmM9bCxpKG4sdCxlLHIsdSxvLGEsYyl9dmFyIGwsZixoLGcscCx2LGQsbSx5LHg9RXQoYSksTT1FdChjKTtpZihudWxsIT10KXY9dCxkPWUsbT1yLHk9dTtlbHNlIGlmKG09eT0tKHY9ZD0xLzApLGY9W10saD1bXSxwPW4ubGVuZ3RoLG8pZm9yKGc9MDtwPmc7KytnKWw9bltnXSxsLng8diYmKHY9bC54KSxsLnk8ZCYmKGQ9bC55KSxsLng+bSYmKG09bC54KSxsLnk+eSYmKHk9bC55KSxmLnB1c2gobC54KSxoLnB1c2gobC55KTtlbHNlIGZvcihnPTA7cD5nOysrZyl7dmFyIF89K3gobD1uW2ddLGcpLGI9K00obCxnKTt2Pl8mJih2PV8pLGQ+YiYmKGQ9YiksXz5tJiYobT1fKSxiPnkmJih5PWIpLGYucHVzaChfKSxoLnB1c2goYil9dmFyIHc9bS12LFM9eS1kO3c+Uz95PWQrdzptPXYrUzt2YXIgaz1sdSgpO2lmKGsuYWRkPWZ1bmN0aW9uKG4pe2koayxuLCt4KG4sKytnKSwrTShuLGcpLHYsZCxtLHkpfSxrLnZpc2l0PWZ1bmN0aW9uKG4pe2Z1KG4sayx2LGQsbSx5KX0sZz0tMSxudWxsPT10KXtmb3IoOysrZzxwOylpKGssbltnXSxmW2ddLGhbZ10sdixkLG0seSk7LS1nfWVsc2Ugbi5mb3JFYWNoKGsuYWRkKTtyZXR1cm4gZj1oPW49bD1udWxsLGt9dmFyIG8sYT1OcixjPUFyO3JldHVybihvPWFyZ3VtZW50cy5sZW5ndGgpPyhhPWN1LGM9c3UsMz09PW8mJih1PWUscj10LGU9dD0wKSxpKG4pKTooaS54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPW4saSk6YX0saS55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4saSk6Y30saS5leHRlbnQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG51bGw9PW4/dD1lPXI9dT1udWxsOih0PStuWzBdWzBdLGU9K25bMF1bMV0scj0rblsxXVswXSx1PStuWzFdWzFdKSxpKTpudWxsPT10P251bGw6W1t0LGVdLFtyLHVdXX0saS5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhudWxsPT1uP3Q9ZT1yPXU9bnVsbDoodD1lPTAscj0rblswXSx1PStuWzFdKSxpKTpudWxsPT10P251bGw6W3ItdCx1LWVdfSxpKX0sR28uaW50ZXJwb2xhdGVSZ2I9aHUsR28uaW50ZXJwb2xhdGVPYmplY3Q9Z3UsR28uaW50ZXJwb2xhdGVOdW1iZXI9cHUsR28uaW50ZXJwb2xhdGVTdHJpbmc9dnU7dmFyIHJzPS9bLStdPyg/OlxkK1wuP1xkKnxcLj9cZCspKD86W2VFXVstK10/XGQrKT8vZztHby5pbnRlcnBvbGF0ZT1kdSxHby5pbnRlcnBvbGF0b3JzPVtmdW5jdGlvbihuLHQpe3ZhciBlPXR5cGVvZiB0O3JldHVybigic3RyaW5nIj09PWU/SmEuaGFzKHQpfHwvXigjfHJnYlwofGhzbFwoKS8udGVzdCh0KT9odTp2dTp0IGluc3RhbmNlb2YgZXQ/aHU6QXJyYXkuaXNBcnJheSh0KT9tdToib2JqZWN0Ij09PWUmJmlzTmFOKHQpP2d1OnB1KShuLHQpfV0sR28uaW50ZXJwb2xhdGVBcnJheT1tdTt2YXIgdXM9ZnVuY3Rpb24oKXtyZXR1cm4gTnR9LGlzPUdvLm1hcCh7bGluZWFyOnVzLHBvbHk6U3UscXVhZDpmdW5jdGlvbigpe3JldHVybiBfdX0sY3ViaWM6ZnVuY3Rpb24oKXtyZXR1cm4gYnV9LHNpbjpmdW5jdGlvbigpe3JldHVybiBrdX0sZXhwOmZ1bmN0aW9uKCl7cmV0dXJuIEV1fSxjaXJjbGU6ZnVuY3Rpb24oKXtyZXR1cm4gTnV9LGVsYXN0aWM6QXUsYmFjazpDdSxib3VuY2U6ZnVuY3Rpb24oKXtyZXR1cm4gTHV9fSksb3M9R28ubWFwKHsiaW4iOk50LG91dDp4dSwiaW4tb3V0IjpNdSwib3V0LWluIjpmdW5jdGlvbihuKXtyZXR1cm4gTXUoeHUobikpfX0pO0dvLmVhc2U9ZnVuY3Rpb24obil7dmFyIHQ9bi5pbmRleE9mKCItIiksZT10Pj0wP24uc3Vic3RyaW5nKDAsdCk6bixyPXQ+PTA/bi5zdWJzdHJpbmcodCsxKToiaW4iO3JldHVybiBlPWlzLmdldChlKXx8dXMscj1vcy5nZXQocil8fE50LHl1KHIoZS5hcHBseShudWxsLEtvLmNhbGwoYXJndW1lbnRzLDEpKSkpfSxHby5pbnRlcnBvbGF0ZUhjbD1UdSxHby5pbnRlcnBvbGF0ZUhzbD1xdSxHby5pbnRlcnBvbGF0ZUxhYj16dSxHby5pbnRlcnBvbGF0ZVJvdW5kPVJ1LEdvLnRyYW5zZm9ybT1mdW5jdGlvbihuKXt2YXIgdD1uYS5jcmVhdGVFbGVtZW50TlMoR28ubnMucHJlZml4LnN2ZywiZyIpO3JldHVybihHby50cmFuc2Zvcm09ZnVuY3Rpb24obil7aWYobnVsbCE9bil7dC5zZXRBdHRyaWJ1dGUoInRyYW5zZm9ybSIsbik7dmFyIGU9dC50cmFuc2Zvcm0uYmFzZVZhbC5jb25zb2xpZGF0ZSgpfXJldHVybiBuZXcgRHUoZT9lLm1hdHJpeDphcyl9KShuKX0sRHUucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuInRyYW5zbGF0ZSgiK3RoaXMudHJhbnNsYXRlKyIpcm90YXRlKCIrdGhpcy5yb3RhdGUrIilza2V3WCgiK3RoaXMuc2tldysiKXNjYWxlKCIrdGhpcy5zY2FsZSsiKSJ9O3ZhciBhcz17YToxLGI6MCxjOjAsZDoxLGU6MCxmOjB9O0dvLmludGVycG9sYXRlVHJhbnNmb3JtPUh1LEdvLmxheW91dD17fSxHby5sYXlvdXQuYnVuZGxlPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKG4pe2Zvcih2YXIgdD1bXSxlPS0xLHI9bi5sZW5ndGg7KytlPHI7KXQucHVzaChZdShuW2VdKSk7cmV0dXJuIHR9fSxHby5sYXlvdXQuY2hvcmQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG4scyxmLGgsZyxwPXt9LHY9W10sZD1Hby5yYW5nZShpKSxtPVtdO2ZvcihlPVtdLHI9W10sbj0wLGg9LTE7KytoPGk7KXtmb3Iocz0wLGc9LTE7KytnPGk7KXMrPXVbaF1bZ107di5wdXNoKHMpLG0ucHVzaChHby5yYW5nZShpKSksbis9c31mb3IobyYmZC5zb3J0KGZ1bmN0aW9uKG4sdCl7cmV0dXJuIG8odltuXSx2W3RdKX0pLGEmJm0uZm9yRWFjaChmdW5jdGlvbihuLHQpe24uc29ydChmdW5jdGlvbihuLGUpe3JldHVybiBhKHVbdF1bbl0sdVt0XVtlXSl9KX0pLG49KENhLWwqaSkvbixzPTAsaD0tMTsrK2g8aTspe2ZvcihmPXMsZz0tMTsrK2c8aTspe3ZhciB5PWRbaF0seD1tW3ldW2ddLE09dVt5XVt4XSxfPXMsYj1zKz1NKm47cFt5KyItIit4XT17aW5kZXg6eSxzdWJpbmRleDp4LHN0YXJ0QW5nbGU6XyxlbmRBbmdsZTpiLHZhbHVlOk19fXJbeV09e2luZGV4Onksc3RhcnRBbmdsZTpmLGVuZEFuZ2xlOnMsdmFsdWU6KHMtZikvbn0scys9bH1mb3IoaD0tMTsrK2g8aTspZm9yKGc9aC0xOysrZzxpOyl7dmFyIHc9cFtoKyItIitnXSxTPXBbZysiLSIraF07KHcudmFsdWV8fFMudmFsdWUpJiZlLnB1c2gody52YWx1ZTxTLnZhbHVlP3tzb3VyY2U6Uyx0YXJnZXQ6d306e3NvdXJjZTp3LHRhcmdldDpTfSl9YyYmdCgpfWZ1bmN0aW9uIHQoKXtlLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gYygobi5zb3VyY2UudmFsdWUrbi50YXJnZXQudmFsdWUpLzIsKHQuc291cmNlLnZhbHVlK3QudGFyZ2V0LnZhbHVlKS8yKX0pfXZhciBlLHIsdSxpLG8sYSxjLHM9e30sbD0wO3JldHVybiBzLm1hdHJpeD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT0odT1uKSYmdS5sZW5ndGgsZT1yPW51bGwscyk6dX0scy5wYWRkaW5nPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhsPW4sZT1yPW51bGwscyk6bH0scy5zb3J0R3JvdXBzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPW4sZT1yPW51bGwscyk6b30scy5zb3J0U3ViZ3JvdXBzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPW4sZT1udWxsLHMpOmF9LHMuc29ydENob3Jkcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz1uLGUmJnQoKSxzKTpjfSxzLmNob3Jkcz1mdW5jdGlvbigpe3JldHVybiBlfHxuKCksZX0scy5ncm91cHM9ZnVuY3Rpb24oKXtyZXR1cm4gcnx8bigpLHJ9LHN9LEdvLmxheW91dC5mb3JjZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obil7cmV0dXJuIGZ1bmN0aW9uKHQsZSxyLHUpe2lmKHQucG9pbnQhPT1uKXt2YXIgaT10LmN4LW4ueCxvPXQuY3ktbi55LGE9dS1lLGM9aSppK28qbztpZihjPmEqYS9kKXtpZihwPmMpe3ZhciBzPXQuY2hhcmdlL2M7bi5weC09aSpzLG4ucHktPW8qc31yZXR1cm4hMH1pZih0LnBvaW50JiZjJiZwPmMpe3ZhciBzPXQucG9pbnRDaGFyZ2UvYztuLnB4LT1pKnMsbi5weS09bypzfX1yZXR1cm4hdC5jaGFyZ2V9fWZ1bmN0aW9uIHQobil7bi5weD1Hby5ldmVudC54LG4ucHk9R28uZXZlbnQueSxhLnJlc3VtZSgpfXZhciBlLHIsdSxpLG8sYT17fSxjPUdvLmRpc3BhdGNoKCJzdGFydCIsInRpY2siLCJlbmQiKSxzPVsxLDFdLGw9LjksZj1jcyxoPXNzLGc9LTMwLHA9bHMsdj0uMSxkPS42NCxtPVtdLHk9W107cmV0dXJuIGEudGljaz1mdW5jdGlvbigpe2lmKChyKj0uOTkpPC4wMDUpcmV0dXJuIGMuZW5kKHt0eXBlOiJlbmQiLGFscGhhOnI9MH0pLCEwO3ZhciB0LGUsYSxmLGgscCxkLHgsTSxfPW0ubGVuZ3RoLGI9eS5sZW5ndGg7Zm9yKGU9MDtiPmU7KytlKWE9eVtlXSxmPWEuc291cmNlLGg9YS50YXJnZXQseD1oLngtZi54LE09aC55LWYueSwocD14KngrTSpNKSYmKHA9cippW2VdKigocD1NYXRoLnNxcnQocCkpLXVbZV0pL3AseCo9cCxNKj1wLGgueC09eCooZD1mLndlaWdodC8oaC53ZWlnaHQrZi53ZWlnaHQpKSxoLnktPU0qZCxmLngrPXgqKGQ9MS1kKSxmLnkrPU0qZCk7aWYoKGQ9cip2KSYmKHg9c1swXS8yLE09c1sxXS8yLGU9LTEsZCkpZm9yKDsrK2U8XzspYT1tW2VdLGEueCs9KHgtYS54KSpkLGEueSs9KE0tYS55KSpkO2lmKGcpZm9yKEp1KHQ9R28uZ2VvbS5xdWFkdHJlZShtKSxyLG8pLGU9LTE7KytlPF87KShhPW1bZV0pLmZpeGVkfHx0LnZpc2l0KG4oYSkpO2ZvcihlPS0xOysrZTxfOylhPW1bZV0sYS5maXhlZD8oYS54PWEucHgsYS55PWEucHkpOihhLngtPShhLnB4LShhLnB4PWEueCkpKmwsYS55LT0oYS5weS0oYS5weT1hLnkpKSpsKTtjLnRpY2soe3R5cGU6InRpY2siLGFscGhhOnJ9KX0sYS5ub2Rlcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obT1uLGEpOm19LGEubGlua3M9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHk9bixhKTp5fSxhLnNpemU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bixhKTpzfSxhLmxpbmtEaXN0YW5jZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZj0iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOituLGEpOmZ9LGEuZGlzdGFuY2U9YS5saW5rRGlzdGFuY2UsYS5saW5rU3RyZW5ndGg9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGg9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bjorbixhKTpofSxhLmZyaWN0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhsPStuLGEpOmx9LGEuY2hhcmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPSJmdW5jdGlvbiI9PXR5cGVvZiBuP246K24sYSk6Z30sYS5jaGFyZ2VEaXN0YW5jZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD1uKm4sYSk6TWF0aC5zcXJ0KHApfSxhLmdyYXZpdHk9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHY9K24sYSk6dn0sYS50aGV0YT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZD1uKm4sYSk6TWF0aC5zcXJ0KGQpfSxhLmFscGhhPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuPStuLHI/cj1uPjA/bjowOm4+MCYmKGMuc3RhcnQoe3R5cGU6InN0YXJ0IixhbHBoYTpyPW59KSxHby50aW1lcihhLnRpY2spKSxhKTpyfSxhLnN0YXJ0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHIpe2lmKCFlKXtmb3IoZT1uZXcgQXJyYXkoYyksYT0wO2M+YTsrK2EpZVthXT1bXTtmb3IoYT0wO3M+YTsrK2Epe3ZhciB1PXlbYV07ZVt1LnNvdXJjZS5pbmRleF0ucHVzaCh1LnRhcmdldCksZVt1LnRhcmdldC5pbmRleF0ucHVzaCh1LnNvdXJjZSl9fWZvcih2YXIgaSxvPWVbdF0sYT0tMSxzPW8ubGVuZ3RoOysrYTxzOylpZighaXNOYU4oaT1vW2FdW25dKSlyZXR1cm4gaTtyZXR1cm4gTWF0aC5yYW5kb20oKSpyfXZhciB0LGUscixjPW0ubGVuZ3RoLGw9eS5sZW5ndGgscD1zWzBdLHY9c1sxXTtmb3IodD0wO2M+dDsrK3QpKHI9bVt0XSkuaW5kZXg9dCxyLndlaWdodD0wO2Zvcih0PTA7bD50OysrdClyPXlbdF0sIm51bWJlciI9PXR5cGVvZiByLnNvdXJjZSYmKHIuc291cmNlPW1bci5zb3VyY2VdKSwibnVtYmVyIj09dHlwZW9mIHIudGFyZ2V0JiYoci50YXJnZXQ9bVtyLnRhcmdldF0pLCsrci5zb3VyY2Uud2VpZ2h0LCsrci50YXJnZXQud2VpZ2h0O2Zvcih0PTA7Yz50OysrdClyPW1bdF0saXNOYU4oci54KSYmKHIueD1uKCJ4IixwKSksaXNOYU4oci55KSYmKHIueT1uKCJ5Iix2KSksaXNOYU4oci5weCkmJihyLnB4PXIueCksaXNOYU4oci5weSkmJihyLnB5PXIueSk7aWYodT1bXSwiZnVuY3Rpb24iPT10eXBlb2YgZilmb3IodD0wO2w+dDsrK3QpdVt0XT0rZi5jYWxsKHRoaXMseVt0XSx0KTtlbHNlIGZvcih0PTA7bD50OysrdCl1W3RdPWY7aWYoaT1bXSwiZnVuY3Rpb24iPT10eXBlb2YgaClmb3IodD0wO2w+dDsrK3QpaVt0XT0raC5jYWxsKHRoaXMseVt0XSx0KTtlbHNlIGZvcih0PTA7bD50OysrdClpW3RdPWg7aWYobz1bXSwiZnVuY3Rpb24iPT10eXBlb2YgZylmb3IodD0wO2M+dDsrK3Qpb1t0XT0rZy5jYWxsKHRoaXMsbVt0XSx0KTtlbHNlIGZvcih0PTA7Yz50OysrdClvW3RdPWc7cmV0dXJuIGEucmVzdW1lKCl9LGEucmVzdW1lPWZ1bmN0aW9uKCl7cmV0dXJuIGEuYWxwaGEoLjEpfSxhLnN0b3A9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hbHBoYSgwKX0sYS5kcmFnPWZ1bmN0aW9uKCl7cmV0dXJuIGV8fChlPUdvLmJlaGF2aW9yLmRyYWcoKS5vcmlnaW4oTnQpLm9uKCJkcmFnc3RhcnQuZm9yY2UiLFZ1KS5vbigiZHJhZy5mb3JjZSIsdCkub24oImRyYWdlbmQuZm9yY2UiLCR1KSksYXJndW1lbnRzLmxlbmd0aD8odGhpcy5vbigibW91c2VvdmVyLmZvcmNlIixYdSkub24oIm1vdXNlb3V0LmZvcmNlIixCdSkuY2FsbChlKSx2b2lkIDApOmV9LEdvLnJlYmluZChhLGMsIm9uIil9O3ZhciBjcz0yMCxzcz0xLGxzPTEvMDtHby5sYXlvdXQuaGllcmFyY2h5PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbih0LG8sYSl7dmFyIGM9dS5jYWxsKGUsdCxvKTtpZih0LmRlcHRoPW8sYS5wdXNoKHQpLGMmJihzPWMubGVuZ3RoKSl7Zm9yKHZhciBzLGwsZj0tMSxoPXQuY2hpbGRyZW49bmV3IEFycmF5KHMpLGc9MCxwPW8rMTsrK2Y8czspbD1oW2ZdPW4oY1tmXSxwLGEpLGwucGFyZW50PXQsZys9bC52YWx1ZTtyJiZoLnNvcnQociksaSYmKHQudmFsdWU9Zyl9ZWxzZSBkZWxldGUgdC5jaGlsZHJlbixpJiYodC52YWx1ZT0raS5jYWxsKGUsdCxvKXx8MCk7cmV0dXJuIHR9ZnVuY3Rpb24gdChuLHIpe3ZhciB1PW4uY2hpbGRyZW4sbz0wO2lmKHUmJihhPXUubGVuZ3RoKSlmb3IodmFyIGEsYz0tMSxzPXIrMTsrK2M8YTspbys9dCh1W2NdLHMpO2Vsc2UgaSYmKG89K2kuY2FsbChlLG4scil8fDApO3JldHVybiBpJiYobi52YWx1ZT1vKSxvfWZ1bmN0aW9uIGUodCl7dmFyIGU9W107cmV0dXJuIG4odCwwLGUpLGV9dmFyIHI9UXUsdT1HdSxpPUt1O3JldHVybiBlLnNvcnQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9bixlKTpyfSxlLmNoaWxkcmVuPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sZSk6dX0sZS52YWx1ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLGUpOml9LGUucmV2YWx1ZT1mdW5jdGlvbihuKXtyZXR1cm4gdChuLDApLG59LGV9LEdvLmxheW91dC5wYXJ0aXRpb249ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKHQsZSxyLHUpe3ZhciBpPXQuY2hpbGRyZW47aWYodC54PWUsdC55PXQuZGVwdGgqdSx0LmR4PXIsdC5keT11LGkmJihvPWkubGVuZ3RoKSl7dmFyIG8sYSxjLHM9LTE7Zm9yKHI9dC52YWx1ZT9yL3QudmFsdWU6MDsrK3M8bzspbihhPWlbc10sZSxjPWEudmFsdWUqcix1KSxlKz1jfX1mdW5jdGlvbiB0KG4pe3ZhciBlPW4uY2hpbGRyZW4scj0wO2lmKGUmJih1PWUubGVuZ3RoKSlmb3IodmFyIHUsaT0tMTsrK2k8dTspcj1NYXRoLm1heChyLHQoZVtpXSkpO3JldHVybiAxK3J9ZnVuY3Rpb24gZShlLGkpe3ZhciBvPXIuY2FsbCh0aGlzLGUsaSk7cmV0dXJuIG4ob1swXSwwLHVbMF0sdVsxXS90KG9bMF0pKSxvfXZhciByPUdvLmxheW91dC5oaWVyYXJjaHkoKSx1PVsxLDFdO3JldHVybiBlLnNpemU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bixlKTp1fSxXdShlLHIpfSxHby5sYXlvdXQucGllPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihpKXt2YXIgbz1pLm1hcChmdW5jdGlvbihlLHIpe3JldHVybit0LmNhbGwobixlLHIpfSksYT0rKCJmdW5jdGlvbiI9PXR5cGVvZiByP3IuYXBwbHkodGhpcyxhcmd1bWVudHMpOnIpLGM9KCgiZnVuY3Rpb24iPT10eXBlb2YgdT91LmFwcGx5KHRoaXMsYXJndW1lbnRzKTp1KS1hKS9Hby5zdW0obykscz1Hby5yYW5nZShpLmxlbmd0aCk7bnVsbCE9ZSYmcy5zb3J0KGU9PT1mcz9mdW5jdGlvbihuLHQpe3JldHVybiBvW3RdLW9bbl19OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIGUoaVtuXSxpW3RdKX0pO3ZhciBsPVtdO3JldHVybiBzLmZvckVhY2goZnVuY3Rpb24obil7dmFyIHQ7bFtuXT17ZGF0YTppW25dLHZhbHVlOnQ9b1tuXSxzdGFydEFuZ2xlOmEsZW5kQW5nbGU6YSs9dCpjfX0pLGx9dmFyIHQ9TnVtYmVyLGU9ZnMscj0wLHU9Q2E7cmV0dXJuIG4udmFsdWU9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ZSxuKTp0fSxuLnNvcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLnN0YXJ0QW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxuLmVuZEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PXQsbik6dX0sbn07dmFyIGZzPXt9O0dvLmxheW91dC5zdGFjaz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oYSxjKXt2YXIgcz1hLm1hcChmdW5jdGlvbihlLHIpe3JldHVybiB0LmNhbGwobixlLHIpfSksbD1zLm1hcChmdW5jdGlvbih0KXtyZXR1cm4gdC5tYXAoZnVuY3Rpb24odCxlKXtyZXR1cm5baS5jYWxsKG4sdCxlKSxvLmNhbGwobix0LGUpXX0pfSksZj1lLmNhbGwobixsLGMpO3M9R28ucGVybXV0ZShzLGYpLGw9R28ucGVybXV0ZShsLGYpO3ZhciBoLGcscCx2PXIuY2FsbChuLGwsYyksZD1zLmxlbmd0aCxtPXNbMF0ubGVuZ3RoO2ZvcihnPTA7bT5nOysrZylmb3IodS5jYWxsKG4sc1swXVtnXSxwPXZbZ10sbFswXVtnXVsxXSksaD0xO2Q+aDsrK2gpdS5jYWxsKG4sc1toXVtnXSxwKz1sW2gtMV1bZ11bMV0sbFtoXVtnXVsxXSk7cmV0dXJuIGF9dmFyIHQ9TnQsZT11aSxyPWlpLHU9cmksaT10aSxvPWVpO3JldHVybiBuLnZhbHVlcz1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1lLG4pOnR9LG4ub3JkZXI9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dDpocy5nZXQodCl8fHVpLG4pOmV9LG4ub2Zmc2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6Z3MuZ2V0KHQpfHxpaSxuKTpyfSxuLng9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9dCxuKTppfSxuLnk9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89dCxuKTpvfSxuLm91dD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG59O3ZhciBocz1Hby5tYXAoeyJpbnNpZGUtb3V0IjpmdW5jdGlvbihuKXt2YXIgdCxlLHI9bi5sZW5ndGgsdT1uLm1hcChvaSksaT1uLm1hcChhaSksbz1Hby5yYW5nZShyKS5zb3J0KGZ1bmN0aW9uKG4sdCl7cmV0dXJuIHVbbl0tdVt0XX0pLGE9MCxjPTAscz1bXSxsPVtdO2Zvcih0PTA7cj50OysrdCllPW9bdF0sYz5hPyhhKz1pW2VdLHMucHVzaChlKSk6KGMrPWlbZV0sbC5wdXNoKGUpKTtyZXR1cm4gbC5yZXZlcnNlKCkuY29uY2F0KHMpfSxyZXZlcnNlOmZ1bmN0aW9uKG4pe3JldHVybiBHby5yYW5nZShuLmxlbmd0aCkucmV2ZXJzZSgpfSwiZGVmYXVsdCI6dWl9KSxncz1Hby5tYXAoe3NpbGhvdWV0dGU6ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9bi5sZW5ndGgsaT1uWzBdLmxlbmd0aCxvPVtdLGE9MCxjPVtdO2ZvcihlPTA7aT5lOysrZSl7Zm9yKHQ9MCxyPTA7dT50O3QrKylyKz1uW3RdW2VdWzFdO3I+YSYmKGE9ciksby5wdXNoKHIpfWZvcihlPTA7aT5lOysrZSljW2VdPShhLW9bZV0pLzI7cmV0dXJuIGN9LHdpZ2dsZTpmdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpLG8sYSxjLHMsbD1uLmxlbmd0aCxmPW5bMF0saD1mLmxlbmd0aCxnPVtdO2ZvcihnWzBdPWM9cz0wLGU9MTtoPmU7KytlKXtmb3IodD0wLHU9MDtsPnQ7Kyt0KXUrPW5bdF1bZV1bMV07Zm9yKHQ9MCxpPTAsYT1mW2VdWzBdLWZbZS0xXVswXTtsPnQ7Kyt0KXtmb3Iocj0wLG89KG5bdF1bZV1bMV0tblt0XVtlLTFdWzFdKS8oMiphKTt0PnI7KytyKW8rPShuW3JdW2VdWzFdLW5bcl1bZS0xXVsxXSkvYTtpKz1vKm5bdF1bZV1bMV19Z1tlXT1jLT11P2kvdSphOjAscz5jJiYocz1jKX1mb3IoZT0wO2g+ZTsrK2UpZ1tlXS09cztyZXR1cm4gZ30sZXhwYW5kOmZ1bmN0aW9uKG4pe3ZhciB0LGUscix1PW4ubGVuZ3RoLGk9blswXS5sZW5ndGgsbz0xL3UsYT1bXTtmb3IoZT0wO2k+ZTsrK2Upe2Zvcih0PTAscj0wO3U+dDt0Kyspcis9blt0XVtlXVsxXTtpZihyKWZvcih0PTA7dT50O3QrKyluW3RdW2VdWzFdLz1yO2Vsc2UgZm9yKHQ9MDt1PnQ7dCsrKW5bdF1bZV1bMV09b31mb3IoZT0wO2k+ZTsrK2UpYVtlXT0wO3JldHVybiBhfSx6ZXJvOmlpfSk7R28ubGF5b3V0Lmhpc3RvZ3JhbT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixpKXtmb3IodmFyIG8sYSxjPVtdLHM9bi5tYXAoZSx0aGlzKSxsPXIuY2FsbCh0aGlzLHMsaSksZj11LmNhbGwodGhpcyxsLHMsaSksaT0tMSxoPXMubGVuZ3RoLGc9Zi5sZW5ndGgtMSxwPXQ/MToxL2g7KytpPGc7KW89Y1tpXT1bXSxvLmR4PWZbaSsxXS0oby54PWZbaV0pLG8ueT0wO2lmKGc+MClmb3IoaT0tMTsrK2k8aDspYT1zW2ldLGE+PWxbMF0mJmE8PWxbMV0mJihvPWNbR28uYmlzZWN0KGYsYSwxLGcpLTFdLG8ueSs9cCxvLnB1c2gobltpXSkpO3JldHVybiBjfXZhciB0PSEwLGU9TnVtYmVyLHI9ZmksdT1zaTtyZXR1cm4gbi52YWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT10LG4pOmV9LG4ucmFuZ2U9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RXQodCksbik6cn0sbi5iaW5zPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PSJudW1iZXIiPT10eXBlb2YgdD9mdW5jdGlvbihuKXtyZXR1cm4gbGkobix0KX06RXQodCksbik6dX0sbi5mcmVxdWVuY3k9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ISFlLG4pOnR9LG59LEdvLmxheW91dC50cmVlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe2Z1bmN0aW9uIG8obix0KXt2YXIgcj1uLmNoaWxkcmVuLHU9bi5fdHJlZTtpZihyJiYoaT1yLmxlbmd0aCkpe2Zvcih2YXIgaSxhLHMsbD1yWzBdLGY9bCxoPS0xOysraDxpOylzPXJbaF0sbyhzLGEpLGY9YyhzLGEsZiksYT1zO01pKG4pO3ZhciBnPS41KihsLl90cmVlLnByZWxpbStzLl90cmVlLnByZWxpbSk7dD8odS5wcmVsaW09dC5fdHJlZS5wcmVsaW0rZShuLHQpLHUubW9kPXUucHJlbGltLWcpOnUucHJlbGltPWd9ZWxzZSB0JiYodS5wcmVsaW09dC5fdHJlZS5wcmVsaW0rZShuLHQpKX1mdW5jdGlvbiBhKG4sdCl7bi54PW4uX3RyZWUucHJlbGltK3Q7dmFyIGU9bi5jaGlsZHJlbjtpZihlJiYocj1lLmxlbmd0aCkpe3ZhciByLHU9LTE7Zm9yKHQrPW4uX3RyZWUubW9kOysrdTxyOylhKGVbdV0sdCl9fWZ1bmN0aW9uIGMobix0LHIpe2lmKHQpe2Zvcih2YXIgdSxpPW4sbz1uLGE9dCxjPW4ucGFyZW50LmNoaWxkcmVuWzBdLHM9aS5fdHJlZS5tb2QsbD1vLl90cmVlLm1vZCxmPWEuX3RyZWUubW9kLGg9Yy5fdHJlZS5tb2Q7YT1waShhKSxpPWdpKGkpLGEmJmk7KWM9Z2koYyksbz1waShvKSxvLl90cmVlLmFuY2VzdG9yPW4sdT1hLl90cmVlLnByZWxpbStmLWkuX3RyZWUucHJlbGltLXMrZShhLGkpLHU+MCYmKF9pKGJpKGEsbixyKSxuLHUpLHMrPXUsbCs9dSksZis9YS5fdHJlZS5tb2Qscys9aS5fdHJlZS5tb2QsaCs9Yy5fdHJlZS5tb2QsbCs9by5fdHJlZS5tb2Q7YSYmIXBpKG8pJiYoby5fdHJlZS50aHJlYWQ9YSxvLl90cmVlLm1vZCs9Zi1sKSxpJiYhZ2koYykmJihjLl90cmVlLnRocmVhZD1pLGMuX3RyZWUubW9kKz1zLWgscj1uKX1yZXR1cm4gcn12YXIgcz10LmNhbGwodGhpcyxuLGkpLGw9c1swXTt4aShsLGZ1bmN0aW9uKG4sdCl7bi5fdHJlZT17YW5jZXN0b3I6bixwcmVsaW06MCxtb2Q6MCxjaGFuZ2U6MCxzaGlmdDowLG51bWJlcjp0P3QuX3RyZWUubnVtYmVyKzE6MH19KSxvKGwpLGEobCwtbC5fdHJlZS5wcmVsaW0pO3ZhciBmPXZpKGwsbWkpLGg9dmkobCxkaSksZz12aShsLHlpKSxwPWYueC1lKGYsaCkvMix2PWgueCtlKGgsZikvMixkPWcuZGVwdGh8fDE7cmV0dXJuIHhpKGwsdT9mdW5jdGlvbihuKXtuLngqPXJbMF0sbi55PW4uZGVwdGgqclsxXSxkZWxldGUgbi5fdHJlZX06ZnVuY3Rpb24obil7bi54PShuLngtcCkvKHYtcCkqclswXSxuLnk9bi5kZXB0aC9kKnJbMV0sZGVsZXRlIG4uX3RyZWV9KSxzfXZhciB0PUdvLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KG51bGwpLnZhbHVlKG51bGwpLGU9aGkscj1bMSwxXSx1PSExO3JldHVybiBuLnNlcGFyYXRpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLnNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bnVsbD09KHI9dCksbik6dT9udWxsOnJ9LG4ubm9kZVNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bnVsbCE9KHI9dCksbik6dT9yOm51bGx9LFd1KG4sdCl9LEdvLmxheW91dC5wYWNrPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe3ZhciBvPWUuY2FsbCh0aGlzLG4saSksYT1vWzBdLGM9dVswXSxzPXVbMV0sbD1udWxsPT10P01hdGguc3FydDoiZnVuY3Rpb24iPT10eXBlb2YgdD90OmZ1bmN0aW9uKCl7cmV0dXJuIHR9O2lmKGEueD1hLnk9MCx4aShhLGZ1bmN0aW9uKG4pe24ucj0rbChuLnZhbHVlKX0pLHhpKGEsTmkpLHIpe3ZhciBmPXIqKHQ/MTpNYXRoLm1heCgyKmEuci9jLDIqYS5yL3MpKS8yO3hpKGEsZnVuY3Rpb24obil7bi5yKz1mfSkseGkoYSxOaSkseGkoYSxmdW5jdGlvbihuKXtuLnItPWZ9KX1yZXR1cm4gTGkoYSxjLzIscy8yLHQ/MToxL01hdGgubWF4KDIqYS5yL2MsMiphLnIvcykpLG99dmFyIHQsZT1Hby5sYXlvdXQuaGllcmFyY2h5KCkuc29ydCh3aSkscj0wLHU9WzEsMV07cmV0dXJuIG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG4ucmFkaXVzPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW51bGw9PWV8fCJmdW5jdGlvbiI9PXR5cGVvZiBlP2U6K2Usbik6dH0sbi5wYWRkaW5nPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPSt0LG4pOnJ9LFd1KG4sZSl9LEdvLmxheW91dC5jbHVzdGVyPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe3ZhciBvLGE9dC5jYWxsKHRoaXMsbixpKSxjPWFbMF0scz0wO3hpKGMsZnVuY3Rpb24obil7dmFyIHQ9bi5jaGlsZHJlbjt0JiZ0Lmxlbmd0aD8obi54PXppKHQpLG4ueT1xaSh0KSk6KG4ueD1vP3MrPWUobixvKTowLG4ueT0wLG89bil9KTt2YXIgbD1SaShjKSxmPURpKGMpLGg9bC54LWUobCxmKS8yLGc9Zi54K2UoZixsKS8yO3JldHVybiB4aShjLHU/ZnVuY3Rpb24obil7bi54PShuLngtYy54KSpyWzBdLG4ueT0oYy55LW4ueSkqclsxXX06ZnVuY3Rpb24obil7bi54PShuLngtaCkvKGctaCkqclswXSxuLnk9KDEtKGMueT9uLnkvYy55OjEpKSpyWzFdfSksYX12YXIgdD1Hby5sYXlvdXQuaGllcmFyY2h5KCkuc29ydChudWxsKS52YWx1ZShudWxsKSxlPWhpLHI9WzEsMV0sdT0hMTtyZXR1cm4gbi5zZXBhcmF0aW9uPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW51bGw9PShyPXQpLG4pOnU/bnVsbDpyfSxuLm5vZGVTaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW51bGwhPShyPXQpLG4pOnU/cjpudWxsfSxXdShuLHQpfSxHby5sYXlvdXQudHJlZW1hcD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obix0KXtmb3IodmFyIGUscix1PS0xLGk9bi5sZW5ndGg7Kyt1PGk7KXI9KGU9blt1XSkudmFsdWUqKDA+dD8wOnQpLGUuYXJlYT1pc05hTihyKXx8MD49cj8wOnJ9ZnVuY3Rpb24gdChlKXt2YXIgaT1lLmNoaWxkcmVuO2lmKGkmJmkubGVuZ3RoKXt2YXIgbyxhLGMscz1mKGUpLGw9W10saD1pLnNsaWNlKCkscD0xLzAsdj0ic2xpY2UiPT09Zz9zLmR4OiJkaWNlIj09PWc/cy5keToic2xpY2UtZGljZSI9PT1nPzEmZS5kZXB0aD9zLmR5OnMuZHg6TWF0aC5taW4ocy5keCxzLmR5KTtmb3IobihoLHMuZHgqcy5keS9lLnZhbHVlKSxsLmFyZWE9MDsoYz1oLmxlbmd0aCk+MDspbC5wdXNoKG89aFtjLTFdKSxsLmFyZWErPW8uYXJlYSwic3F1YXJpZnkiIT09Z3x8KGE9cihsLHYpKTw9cD8oaC5wb3AoKSxwPWEpOihsLmFyZWEtPWwucG9wKCkuYXJlYSx1KGwsdixzLCExKSx2PU1hdGgubWluKHMuZHgscy5keSksbC5sZW5ndGg9bC5hcmVhPTAscD0xLzApO2wubGVuZ3RoJiYodShsLHYscywhMCksbC5sZW5ndGg9bC5hcmVhPTApLGkuZm9yRWFjaCh0KX19ZnVuY3Rpb24gZSh0KXt2YXIgcj10LmNoaWxkcmVuO2lmKHImJnIubGVuZ3RoKXt2YXIgaSxvPWYodCksYT1yLnNsaWNlKCksYz1bXTtmb3IobihhLG8uZHgqby5keS90LnZhbHVlKSxjLmFyZWE9MDtpPWEucG9wKCk7KWMucHVzaChpKSxjLmFyZWErPWkuYXJlYSxudWxsIT1pLnomJih1KGMsaS56P28uZHg6by5keSxvLCFhLmxlbmd0aCksYy5sZW5ndGg9Yy5hcmVhPTApO3IuZm9yRWFjaChlKX19ZnVuY3Rpb24gcihuLHQpe2Zvcih2YXIgZSxyPW4uYXJlYSx1PTAsaT0xLzAsbz0tMSxhPW4ubGVuZ3RoOysrbzxhOykoZT1uW29dLmFyZWEpJiYoaT5lJiYoaT1lKSxlPnUmJih1PWUpKTtyZXR1cm4gcio9cix0Kj10LHI/TWF0aC5tYXgodCp1KnAvcixyLyh0KmkqcCkpOjEvMH1mdW5jdGlvbiB1KG4sdCxlLHIpe3ZhciB1LGk9LTEsbz1uLmxlbmd0aCxhPWUueCxzPWUueSxsPXQ/YyhuLmFyZWEvdCk6MDtpZih0PT1lLmR4KXtmb3IoKHJ8fGw+ZS5keSkmJihsPWUuZHkpOysraTxvOyl1PW5baV0sdS54PWEsdS55PXMsdS5keT1sLGErPXUuZHg9TWF0aC5taW4oZS54K2UuZHgtYSxsP2ModS5hcmVhL2wpOjApO3Uuej0hMCx1LmR4Kz1lLngrZS5keC1hLGUueSs9bCxlLmR5LT1sfWVsc2V7Zm9yKChyfHxsPmUuZHgpJiYobD1lLmR4KTsrK2k8bzspdT1uW2ldLHUueD1hLHUueT1zLHUuZHg9bCxzKz11LmR5PU1hdGgubWluKGUueStlLmR5LXMsbD9jKHUuYXJlYS9sKTowKTt1Lno9ITEsdS5keSs9ZS55K2UuZHktcyxlLngrPWwsZS5keC09bH19ZnVuY3Rpb24gaShyKXt2YXIgdT1vfHxhKHIpLGk9dVswXTtyZXR1cm4gaS54PTAsaS55PTAsaS5keD1zWzBdLGkuZHk9c1sxXSxvJiZhLnJldmFsdWUoaSksbihbaV0saS5keCppLmR5L2kudmFsdWUpLChvP2U6dCkoaSksaCYmKG89dSksdX12YXIgbyxhPUdvLmxheW91dC5oaWVyYXJjaHkoKSxjPU1hdGgucm91bmQscz1bMSwxXSxsPW51bGwsZj1QaSxoPSExLGc9InNxdWFyaWZ5IixwPS41KigxK01hdGguc3FydCg1KSk7cmV0dXJuIGkuc2l6ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz1uLGkpOnN9LGkucGFkZGluZz1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KHQpe3ZhciBlPW4uY2FsbChpLHQsdC5kZXB0aCk7cmV0dXJuIG51bGw9PWU/UGkodCk6VWkodCwibnVtYmVyIj09dHlwZW9mIGU/W2UsZSxlLGVdOmUpfWZ1bmN0aW9uIGUodCl7cmV0dXJuIFVpKHQsbil9aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGw7dmFyIHI7cmV0dXJuIGY9bnVsbD09KGw9bik/UGk6ImZ1bmN0aW9uIj09KHI9dHlwZW9mIG4pP3Q6Im51bWJlciI9PT1yPyhuPVtuLG4sbixuXSxlKTplLGl9LGkucm91bmQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGM9bj9NYXRoLnJvdW5kOk51bWJlcixpKTpjIT1OdW1iZXJ9LGkuc3RpY2t5PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhoPW4sbz1udWxsLGkpOmh9LGkucmF0aW89ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHA9bixpKTpwfSxpLm1vZGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGc9bisiIixpKTpnfSxXdShpLGEpfSxHby5yYW5kb209e25vcm1hbDpmdW5jdGlvbihuLHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg7cmV0dXJuIDI+ZSYmKHQ9MSksMT5lJiYobj0wKSxmdW5jdGlvbigpe3ZhciBlLHIsdTtkbyBlPTIqTWF0aC5yYW5kb20oKS0xLHI9MipNYXRoLnJhbmRvbSgpLTEsdT1lKmUrcipyO3doaWxlKCF1fHx1PjEpO3JldHVybiBuK3QqZSpNYXRoLnNxcnQoLTIqTWF0aC5sb2codSkvdSl9fSxsb2dOb3JtYWw6ZnVuY3Rpb24oKXt2YXIgbj1Hby5yYW5kb20ubm9ybWFsLmFwcGx5KEdvLGFyZ3VtZW50cyk7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZXhwKG4oKSl9fSxiYXRlczpmdW5jdGlvbihuKXt2YXIgdD1Hby5yYW5kb20uaXJ3aW5IYWxsKG4pO3JldHVybiBmdW5jdGlvbigpe3JldHVybiB0KCkvbn19LGlyd2luSGFsbDpmdW5jdGlvbihuKXtyZXR1cm4gZnVuY3Rpb24oKXtmb3IodmFyIHQ9MCxlPTA7bj5lO2UrKyl0Kz1NYXRoLnJhbmRvbSgpO3JldHVybiB0fX19LEdvLnNjYWxlPXt9O3ZhciBwcz17Zmxvb3I6TnQsY2VpbDpOdH07R28uc2NhbGUubGluZWFyPWZ1bmN0aW9uKCl7cmV0dXJuIFppKFswLDFdLFswLDFdLGR1LCExKX07dmFyIHZzPXtzOjEsZzoxLHA6MSxyOjEsZToxfTtHby5zY2FsZS5sb2c9ZnVuY3Rpb24oKXtyZXR1cm4gS2koR28uc2NhbGUubGluZWFyKCkuZG9tYWluKFswLDFdKSwxMCwhMCxbMSwxMF0pfTt2YXIgZHM9R28uZm9ybWF0KCIuMGUiKSxtcz17Zmxvb3I6ZnVuY3Rpb24obil7cmV0dXJuLU1hdGguY2VpbCgtbil9LGNlaWw6ZnVuY3Rpb24obil7cmV0dXJuLU1hdGguZmxvb3IoLW4pfX07R28uc2NhbGUucG93PWZ1bmN0aW9uKCl7cmV0dXJuIFFpKEdvLnNjYWxlLmxpbmVhcigpLDEsWzAsMV0pfSxHby5zY2FsZS5zcXJ0PWZ1bmN0aW9uKCl7cmV0dXJuIEdvLnNjYWxlLnBvdygpLmV4cG9uZW50KC41KX0sR28uc2NhbGUub3JkaW5hbD1mdW5jdGlvbigpe3JldHVybiB0byhbXSx7dDoicmFuZ2UiLGE6W1tdXX0pfSxHby5zY2FsZS5jYXRlZ29yeTEwPWZ1bmN0aW9uKCl7cmV0dXJuIEdvLnNjYWxlLm9yZGluYWwoKS5yYW5nZSh5cyl9LEdvLnNjYWxlLmNhdGVnb3J5MjA9ZnVuY3Rpb24oKXtyZXR1cm4gR28uc2NhbGUub3JkaW5hbCgpLnJhbmdlKHhzKX0sR28uc2NhbGUuY2F0ZWdvcnkyMGI9ZnVuY3Rpb24oKXtyZXR1cm4gR28uc2NhbGUub3JkaW5hbCgpLnJhbmdlKE1zKX0sR28uc2NhbGUuY2F0ZWdvcnkyMGM9ZnVuY3Rpb24oKXtyZXR1cm4gR28uc2NhbGUub3JkaW5hbCgpLnJhbmdlKF9zKX07dmFyIHlzPVsyMDYyMjYwLDE2NzQ0MjA2LDI5MjQ1ODgsMTQwMzQ3MjgsOTcyNTg4NSw5MTk3MTMxLDE0OTA3MzMwLDgzNTU3MTEsMTIzNjkxODYsMTU1NjE3NV0ubWFwKG10KSx4cz1bMjA2MjI2MCwxMTQ1NDQ0MCwxNjc0NDIwNiwxNjc1OTY3MiwyOTI0NTg4LDEwMDE4Njk4LDE0MDM0NzI4LDE2NzUwNzQyLDk3MjU4ODUsMTI5NTU4NjEsOTE5NzEzMSwxMjg4NTE0MCwxNDkwNzMzMCwxNjIzNDE5NCw4MzU1NzExLDEzMDkyODA3LDEyMzY5MTg2LDE0NDA4NTg5LDE1NTYxNzUsMTA0MTA3MjVdLm1hcChtdCksTXM9WzM3NTA3NzcsNTM5NTYxOSw3MDQwNzE5LDEwMjY0Mjg2LDY1MTkwOTcsOTIxNjU5NCwxMTkxNTExNSwxMzU1NjYzNiw5MjAyOTkzLDEyNDI2ODA5LDE1MTg2NTE0LDE1MTkwOTMyLDg2NjYxNjksMTEzNTY0OTAsMTQwNDk2NDMsMTUxNzczNzIsODA3NzY4MywxMDgzNDMyNCwxMzUyODUwOSwxNDU4OTY1NF0ubWFwKG10KSxfcz1bMzI0NDczMyw3MDU3MTEwLDEwNDA2NjI1LDEzMDMyNDMxLDE1MDk1MDUzLDE2NjE2NzY0LDE2NjI1MjU5LDE2NjM0MDE4LDMyNTMwNzYsNzY1MjQ3MCwxMDYwNzAwMywxMzEwMTUwNCw3Njk1MjgxLDEwMzk0MzEyLDEyMzY5MzcyLDE0MzQyODkxLDY1MTM1MDcsOTg2ODk1MCwxMjQzNDg3NywxNDI3NzA4MV0ubWFwKG10KTtHby5zY2FsZS5xdWFudGlsZT1mdW5jdGlvbigpe3JldHVybiBlbyhbXSxbXSkKfSxHby5zY2FsZS5xdWFudGl6ZT1mdW5jdGlvbigpe3JldHVybiBybygwLDEsWzAsMV0pfSxHby5zY2FsZS50aHJlc2hvbGQ9ZnVuY3Rpb24oKXtyZXR1cm4gdW8oWy41XSxbMCwxXSl9LEdvLnNjYWxlLmlkZW50aXR5PWZ1bmN0aW9uKCl7cmV0dXJuIGlvKFswLDFdKX0sR28uc3ZnPXt9LEdvLnN2Zy5hcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49dC5hcHBseSh0aGlzLGFyZ3VtZW50cyksaT1lLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxvPXIuYXBwbHkodGhpcyxhcmd1bWVudHMpK2JzLGE9dS5hcHBseSh0aGlzLGFyZ3VtZW50cykrYnMsYz0obz5hJiYoYz1vLG89YSxhPWMpLGEtbykscz1BYT5jPyIwIjoiMSIsbD1NYXRoLmNvcyhvKSxmPU1hdGguc2luKG8pLGg9TWF0aC5jb3MoYSksZz1NYXRoLnNpbihhKTtyZXR1cm4gYz49d3M/bj8iTTAsIitpKyJBIitpKyIsIitpKyIgMCAxLDEgMCwiKy1pKyJBIitpKyIsIitpKyIgMCAxLDEgMCwiK2krIk0wLCIrbisiQSIrbisiLCIrbisiIDAgMSwwIDAsIistbisiQSIrbisiLCIrbisiIDAgMSwwIDAsIituKyJaIjoiTTAsIitpKyJBIitpKyIsIitpKyIgMCAxLDEgMCwiKy1pKyJBIitpKyIsIitpKyIgMCAxLDEgMCwiK2krIloiOm4/Ik0iK2kqbCsiLCIraSpmKyJBIitpKyIsIitpKyIgMCAiK3MrIiwxICIraSpoKyIsIitpKmcrIkwiK24qaCsiLCIrbipnKyJBIituKyIsIituKyIgMCAiK3MrIiwwICIrbipsKyIsIituKmYrIloiOiJNIitpKmwrIiwiK2kqZisiQSIraSsiLCIraSsiIDAgIitzKyIsMSAiK2kqaCsiLCIraSpnKyJMMCwwIisiWiJ9dmFyIHQ9b28sZT1hbyxyPWNvLHU9c287cmV0dXJuIG4uaW5uZXJSYWRpdXM9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9RXQoZSksbik6dH0sbi5vdXRlclJhZGl1cz1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1FdCh0KSxuKTplfSxuLnN0YXJ0QW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RXQodCksbik6cn0sbi5lbmRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1FdCh0KSxuKTp1fSxuLmNlbnRyb2lkPWZ1bmN0aW9uKCl7dmFyIG49KHQuYXBwbHkodGhpcyxhcmd1bWVudHMpK2UuYXBwbHkodGhpcyxhcmd1bWVudHMpKS8yLGk9KHIuYXBwbHkodGhpcyxhcmd1bWVudHMpK3UuYXBwbHkodGhpcyxhcmd1bWVudHMpKS8yK2JzO3JldHVybltNYXRoLmNvcyhpKSpuLE1hdGguc2luKGkpKm5dfSxufTt2YXIgYnM9LUxhLHdzPUNhLVRhO0dvLnN2Zy5saW5lPWZ1bmN0aW9uKCl7cmV0dXJuIGxvKE50KX07dmFyIFNzPUdvLm1hcCh7bGluZWFyOmZvLCJsaW5lYXItY2xvc2VkIjpobyxzdGVwOmdvLCJzdGVwLWJlZm9yZSI6cG8sInN0ZXAtYWZ0ZXIiOnZvLGJhc2lzOmJvLCJiYXNpcy1vcGVuIjp3bywiYmFzaXMtY2xvc2VkIjpTbyxidW5kbGU6a28sY2FyZGluYWw6eG8sImNhcmRpbmFsLW9wZW4iOm1vLCJjYXJkaW5hbC1jbG9zZWQiOnlvLG1vbm90b25lOlRvfSk7U3MuZm9yRWFjaChmdW5jdGlvbihuLHQpe3Qua2V5PW4sdC5jbG9zZWQ9Ly1jbG9zZWQkLy50ZXN0KG4pfSk7dmFyIGtzPVswLDIvMywxLzMsMF0sRXM9WzAsMS8zLDIvMywwXSxOcz1bMCwxLzYsMi8zLDEvNl07R28uc3ZnLmxpbmUucmFkaWFsPWZ1bmN0aW9uKCl7dmFyIG49bG8ocW8pO3JldHVybiBuLnJhZGl1cz1uLngsZGVsZXRlIG4ueCxuLmFuZ2xlPW4ueSxkZWxldGUgbi55LG59LHBvLnJldmVyc2U9dm8sdm8ucmV2ZXJzZT1wbyxHby5zdmcuYXJlYT1mdW5jdGlvbigpe3JldHVybiB6byhOdCl9LEdvLnN2Zy5hcmVhLnJhZGlhbD1mdW5jdGlvbigpe3ZhciBuPXpvKHFvKTtyZXR1cm4gbi5yYWRpdXM9bi54LGRlbGV0ZSBuLngsbi5pbm5lclJhZGl1cz1uLngwLGRlbGV0ZSBuLngwLG4ub3V0ZXJSYWRpdXM9bi54MSxkZWxldGUgbi54MSxuLmFuZ2xlPW4ueSxkZWxldGUgbi55LG4uc3RhcnRBbmdsZT1uLnkwLGRlbGV0ZSBuLnkwLG4uZW5kQW5nbGU9bi55MSxkZWxldGUgbi55MSxufSxHby5zdmcuY2hvcmQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sYSl7dmFyIGM9dCh0aGlzLGksbixhKSxzPXQodGhpcyxvLG4sYSk7cmV0dXJuIk0iK2MucDArcihjLnIsYy5wMSxjLmExLWMuYTApKyhlKGMscyk/dShjLnIsYy5wMSxjLnIsYy5wMCk6dShjLnIsYy5wMSxzLnIscy5wMCkrcihzLnIscy5wMSxzLmExLXMuYTApK3Uocy5yLHMucDEsYy5yLGMucDApKSsiWiJ9ZnVuY3Rpb24gdChuLHQsZSxyKXt2YXIgdT10LmNhbGwobixlLHIpLGk9YS5jYWxsKG4sdSxyKSxvPWMuY2FsbChuLHUscikrYnMsbD1zLmNhbGwobix1LHIpK2JzO3JldHVybntyOmksYTA6byxhMTpsLHAwOltpKk1hdGguY29zKG8pLGkqTWF0aC5zaW4obyldLHAxOltpKk1hdGguY29zKGwpLGkqTWF0aC5zaW4obCldfX1mdW5jdGlvbiBlKG4sdCl7cmV0dXJuIG4uYTA9PXQuYTAmJm4uYTE9PXQuYTF9ZnVuY3Rpb24gcihuLHQsZSl7cmV0dXJuIkEiK24rIiwiK24rIiAwICIrICsoZT5BYSkrIiwxICIrdH1mdW5jdGlvbiB1KG4sdCxlLHIpe3JldHVybiJRIDAsMCAiK3J9dmFyIGk9bXIsbz15cixhPVJvLGM9Y28scz1zbztyZXR1cm4gbi5yYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9RXQodCksbik6YX0sbi5zb3VyY2U9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9RXQodCksbik6aX0sbi50YXJnZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89RXQodCksbik6b30sbi5zdGFydEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPUV0KHQpLG4pOmN9LG4uZW5kQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9RXQodCksbik6c30sbn0sR28uc3ZnLmRpYWdvbmFsPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHUpe3ZhciBpPXQuY2FsbCh0aGlzLG4sdSksbz1lLmNhbGwodGhpcyxuLHUpLGE9KGkueStvLnkpLzIsYz1baSx7eDppLngseTphfSx7eDpvLngseTphfSxvXTtyZXR1cm4gYz1jLm1hcChyKSwiTSIrY1swXSsiQyIrY1sxXSsiICIrY1syXSsiICIrY1szXX12YXIgdD1tcixlPXlyLHI9RG87cmV0dXJuIG4uc291cmNlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PUV0KGUpLG4pOnR9LG4udGFyZ2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPUV0KHQpLG4pOmV9LG4ucHJvamVjdGlvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG59LEdvLnN2Zy5kaWFnb25hbC5yYWRpYWw9ZnVuY3Rpb24oKXt2YXIgbj1Hby5zdmcuZGlhZ29uYWwoKSx0PURvLGU9bi5wcm9qZWN0aW9uO3JldHVybiBuLnByb2plY3Rpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/ZShQbyh0PW4pKTp0fSxufSxHby5zdmcuc3ltYm9sPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHIpe3JldHVybihBcy5nZXQodC5jYWxsKHRoaXMsbixyKSl8fEhvKShlLmNhbGwodGhpcyxuLHIpKX12YXIgdD1qbyxlPVVvO3JldHVybiBuLnR5cGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9RXQoZSksbik6dH0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPUV0KHQpLG4pOmV9LG59O3ZhciBBcz1Hby5tYXAoe2NpcmNsZTpIbyxjcm9zczpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi81KS8yO3JldHVybiJNIistMyp0KyIsIistdCsiSCIrLXQrIlYiKy0zKnQrIkgiK3QrIlYiKy10KyJIIiszKnQrIlYiK3QrIkgiK3QrIlYiKzMqdCsiSCIrLXQrIlYiK3QrIkgiKy0zKnQrIloifSxkaWFtb25kOmZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguc3FydChuLygyKnFzKSksZT10KnFzO3JldHVybiJNMCwiKy10KyJMIitlKyIsMCIrIiAwLCIrdCsiICIrLWUrIiwwIisiWiJ9LHNxdWFyZTpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobikvMjtyZXR1cm4iTSIrLXQrIiwiKy10KyJMIit0KyIsIistdCsiICIrdCsiLCIrdCsiICIrLXQrIiwiK3QrIloifSwidHJpYW5nbGUtZG93biI6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4vVHMpLGU9dCpUcy8yO3JldHVybiJNMCwiK2UrIkwiK3QrIiwiKy1lKyIgIistdCsiLCIrLWUrIloifSwidHJpYW5nbGUtdXAiOmZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguc3FydChuL1RzKSxlPXQqVHMvMjtyZXR1cm4iTTAsIistZSsiTCIrdCsiLCIrZSsiICIrLXQrIiwiK2UrIloifX0pO0dvLnN2Zy5zeW1ib2xUeXBlcz1Bcy5rZXlzKCk7dmFyIENzLExzLFRzPU1hdGguc3FydCgzKSxxcz1NYXRoLnRhbigzMCp6YSksenM9W10sUnM9MDt6cy5jYWxsPV9hLmNhbGwsenMuZW1wdHk9X2EuZW1wdHksenMubm9kZT1fYS5ub2RlLHpzLnNpemU9X2Euc2l6ZSxHby50cmFuc2l0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP0NzP24udHJhbnNpdGlvbigpOm46U2EudHJhbnNpdGlvbigpfSxHby50cmFuc2l0aW9uLnByb3RvdHlwZT16cyx6cy5zZWxlY3Q9ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9dGhpcy5pZCxpPVtdO249YihuKTtmb3IodmFyIG89LTEsYT10aGlzLmxlbmd0aDsrK288YTspe2kucHVzaCh0PVtdKTtmb3IodmFyIGM9dGhpc1tvXSxzPS0xLGw9Yy5sZW5ndGg7KytzPGw7KShyPWNbc10pJiYoZT1uLmNhbGwocixyLl9fZGF0YV9fLHMsbykpPygiX19kYXRhX18iaW4gciYmKGUuX19kYXRhX189ci5fX2RhdGFfXyksSW8oZSxzLHUsci5fX3RyYW5zaXRpb25fX1t1XSksdC5wdXNoKGUpKTp0LnB1c2gobnVsbCl9cmV0dXJuIEZvKGksdSl9LHpzLnNlbGVjdEFsbD1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpLG89dGhpcy5pZCxhPVtdO249dyhuKTtmb3IodmFyIGM9LTEscz10aGlzLmxlbmd0aDsrK2M8czspZm9yKHZhciBsPXRoaXNbY10sZj0tMSxoPWwubGVuZ3RoOysrZjxoOylpZihyPWxbZl0pe2k9ci5fX3RyYW5zaXRpb25fX1tvXSxlPW4uY2FsbChyLHIuX19kYXRhX18sZixjKSxhLnB1c2godD1bXSk7Zm9yKHZhciBnPS0xLHA9ZS5sZW5ndGg7KytnPHA7KSh1PWVbZ10pJiZJbyh1LGcsbyxpKSx0LnB1c2godSl9cmV0dXJuIEZvKGEsbyl9LHpzLmZpbHRlcj1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdT1bXTsiZnVuY3Rpb24iIT10eXBlb2YgbiYmKG49UihuKSk7Zm9yKHZhciBpPTAsbz10aGlzLmxlbmd0aDtvPmk7aSsrKXt1LnB1c2godD1bXSk7Zm9yKHZhciBlPXRoaXNbaV0sYT0wLGM9ZS5sZW5ndGg7Yz5hO2ErKykocj1lW2FdKSYmbi5jYWxsKHIsci5fX2RhdGFfXyxhLGkpJiZ0LnB1c2gocil9cmV0dXJuIEZvKHUsdGhpcy5pZCl9LHpzLnR3ZWVuPWZ1bmN0aW9uKG4sdCl7dmFyIGU9dGhpcy5pZDtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyP3RoaXMubm9kZSgpLl9fdHJhbnNpdGlvbl9fW2VdLnR3ZWVuLmdldChuKTpQKHRoaXMsbnVsbD09dD9mdW5jdGlvbih0KXt0Ll9fdHJhbnNpdGlvbl9fW2VdLnR3ZWVuLnJlbW92ZShuKX06ZnVuY3Rpb24ocil7ci5fX3RyYW5zaXRpb25fX1tlXS50d2Vlbi5zZXQobix0KX0pfSx6cy5hdHRyPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZSgpe3RoaXMucmVtb3ZlQXR0cmlidXRlKGEpfWZ1bmN0aW9uIHIoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZU5TKGEuc3BhY2UsYS5sb2NhbCl9ZnVuY3Rpb24gdShuKXtyZXR1cm4gbnVsbD09bj9lOihuKz0iIixmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5nZXRBdHRyaWJ1dGUoYSk7cmV0dXJuIGUhPT1uJiYodD1vKGUsbiksZnVuY3Rpb24obil7dGhpcy5zZXRBdHRyaWJ1dGUoYSx0KG4pKX0pfSl9ZnVuY3Rpb24gaShuKXtyZXR1cm4gbnVsbD09bj9yOihuKz0iIixmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5nZXRBdHRyaWJ1dGVOUyhhLnNwYWNlLGEubG9jYWwpO3JldHVybiBlIT09biYmKHQ9byhlLG4pLGZ1bmN0aW9uKG4pe3RoaXMuc2V0QXR0cmlidXRlTlMoYS5zcGFjZSxhLmxvY2FsLHQobikpfSl9KX1pZihhcmd1bWVudHMubGVuZ3RoPDIpe2Zvcih0IGluIG4pdGhpcy5hdHRyKHQsblt0XSk7cmV0dXJuIHRoaXN9dmFyIG89InRyYW5zZm9ybSI9PW4/SHU6ZHUsYT1Hby5ucy5xdWFsaWZ5KG4pO3JldHVybiBPbyh0aGlzLCJhdHRyLiIrbix0LGEubG9jYWw/aTp1KX0senMuYXR0clR3ZWVuPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZShuLGUpe3ZhciByPXQuY2FsbCh0aGlzLG4sZSx0aGlzLmdldEF0dHJpYnV0ZSh1KSk7cmV0dXJuIHImJmZ1bmN0aW9uKG4pe3RoaXMuc2V0QXR0cmlidXRlKHUscihuKSl9fWZ1bmN0aW9uIHIobixlKXt2YXIgcj10LmNhbGwodGhpcyxuLGUsdGhpcy5nZXRBdHRyaWJ1dGVOUyh1LnNwYWNlLHUubG9jYWwpKTtyZXR1cm4gciYmZnVuY3Rpb24obil7dGhpcy5zZXRBdHRyaWJ1dGVOUyh1LnNwYWNlLHUubG9jYWwscihuKSl9fXZhciB1PUdvLm5zLnF1YWxpZnkobik7cmV0dXJuIHRoaXMudHdlZW4oImF0dHIuIituLHUubG9jYWw/cjplKX0senMuc3R5bGU9ZnVuY3Rpb24obix0LGUpe2Z1bmN0aW9uIHIoKXt0aGlzLnN0eWxlLnJlbW92ZVByb3BlcnR5KG4pfWZ1bmN0aW9uIHUodCl7cmV0dXJuIG51bGw9PXQ/cjoodCs9IiIsZnVuY3Rpb24oKXt2YXIgcix1PWVhLmdldENvbXB1dGVkU3R5bGUodGhpcyxudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKG4pO3JldHVybiB1IT09dCYmKHI9ZHUodSx0KSxmdW5jdGlvbih0KXt0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4scih0KSxlKX0pfSl9dmFyIGk9YXJndW1lbnRzLmxlbmd0aDtpZigzPmkpe2lmKCJzdHJpbmciIT10eXBlb2Ygbil7Mj5pJiYodD0iIik7Zm9yKGUgaW4gbil0aGlzLnN0eWxlKGUsbltlXSx0KTtyZXR1cm4gdGhpc31lPSIifXJldHVybiBPbyh0aGlzLCJzdHlsZS4iK24sdCx1KX0senMuc3R5bGVUd2Vlbj1mdW5jdGlvbihuLHQsZSl7ZnVuY3Rpb24gcihyLHUpe3ZhciBpPXQuY2FsbCh0aGlzLHIsdSxlYS5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKSk7cmV0dXJuIGkmJmZ1bmN0aW9uKHQpe3RoaXMuc3R5bGUuc2V0UHJvcGVydHkobixpKHQpLGUpfX1yZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwzJiYoZT0iIiksdGhpcy50d2Vlbigic3R5bGUuIituLHIpfSx6cy50ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBPbyh0aGlzLCJ0ZXh0IixuLFlvKX0senMucmVtb3ZlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaCgiZW5kLnRyYW5zaXRpb24iLGZ1bmN0aW9uKCl7dmFyIG47dGhpcy5fX3RyYW5zaXRpb25fXy5jb3VudDwyJiYobj10aGlzLnBhcmVudE5vZGUpJiZuLnJlbW92ZUNoaWxkKHRoaXMpfSl9LHpzLmVhc2U9ZnVuY3Rpb24obil7dmFyIHQ9dGhpcy5pZDtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwxP3RoaXMubm9kZSgpLl9fdHJhbnNpdGlvbl9fW3RdLmVhc2U6KCJmdW5jdGlvbiIhPXR5cGVvZiBuJiYobj1Hby5lYXNlLmFwcGx5KEdvLGFyZ3VtZW50cykpLFAodGhpcyxmdW5jdGlvbihlKXtlLl9fdHJhbnNpdGlvbl9fW3RdLmVhc2U9bn0pKX0senMuZGVsYXk9ZnVuY3Rpb24obil7dmFyIHQ9dGhpcy5pZDtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwxP3RoaXMubm9kZSgpLl9fdHJhbnNpdGlvbl9fW3RdLmRlbGF5OlAodGhpcywiZnVuY3Rpb24iPT10eXBlb2Ygbj9mdW5jdGlvbihlLHIsdSl7ZS5fX3RyYW5zaXRpb25fX1t0XS5kZWxheT0rbi5jYWxsKGUsZS5fX2RhdGFfXyxyLHUpfToobj0rbixmdW5jdGlvbihlKXtlLl9fdHJhbnNpdGlvbl9fW3RdLmRlbGF5PW59KSl9LHpzLmR1cmF0aW9uPWZ1bmN0aW9uKG4pe3ZhciB0PXRoaXMuaWQ7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKS5fX3RyYW5zaXRpb25fX1t0XS5kdXJhdGlvbjpQKHRoaXMsImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24oZSxyLHUpe2UuX190cmFuc2l0aW9uX19bdF0uZHVyYXRpb249TWF0aC5tYXgoMSxuLmNhbGwoZSxlLl9fZGF0YV9fLHIsdSkpfToobj1NYXRoLm1heCgxLG4pLGZ1bmN0aW9uKGUpe2UuX190cmFuc2l0aW9uX19bdF0uZHVyYXRpb249bn0pKX0senMuZWFjaD1mdW5jdGlvbihuLHQpe3ZhciBlPXRoaXMuaWQ7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXt2YXIgcj1Mcyx1PUNzO0NzPWUsUCh0aGlzLGZ1bmN0aW9uKHQscix1KXtMcz10Ll9fdHJhbnNpdGlvbl9fW2VdLG4uY2FsbCh0LHQuX19kYXRhX18scix1KX0pLExzPXIsQ3M9dX1lbHNlIFAodGhpcyxmdW5jdGlvbihyKXt2YXIgdT1yLl9fdHJhbnNpdGlvbl9fW2VdOyh1LmV2ZW50fHwodS5ldmVudD1Hby5kaXNwYXRjaCgic3RhcnQiLCJlbmQiKSkpLm9uKG4sdCl9KTtyZXR1cm4gdGhpc30senMudHJhbnNpdGlvbj1mdW5jdGlvbigpe2Zvcih2YXIgbix0LGUscix1PXRoaXMuaWQsaT0rK1JzLG89W10sYT0wLGM9dGhpcy5sZW5ndGg7Yz5hO2ErKyl7by5wdXNoKG49W10pO2Zvcih2YXIgdD10aGlzW2FdLHM9MCxsPXQubGVuZ3RoO2w+cztzKyspKGU9dFtzXSkmJihyPU9iamVjdC5jcmVhdGUoZS5fX3RyYW5zaXRpb25fX1t1XSksci5kZWxheSs9ci5kdXJhdGlvbixJbyhlLHMsaSxyKSksbi5wdXNoKGUpfXJldHVybiBGbyhvLGkpfSxHby5zdmcuYXhpcz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obil7bi5lYWNoKGZ1bmN0aW9uKCl7dmFyIG4scz1Hby5zZWxlY3QodGhpcyksbD10aGlzLl9fY2hhcnRfX3x8ZSxmPXRoaXMuX19jaGFydF9fPWUuY29weSgpLGg9bnVsbD09Yz9mLnRpY2tzP2YudGlja3MuYXBwbHkoZixhKTpmLmRvbWFpbigpOmMsZz1udWxsPT10P2YudGlja0Zvcm1hdD9mLnRpY2tGb3JtYXQuYXBwbHkoZixhKTpOdDp0LHA9cy5zZWxlY3RBbGwoIi50aWNrIikuZGF0YShoLGYpLHY9cC5lbnRlcigpLmluc2VydCgiZyIsIi5kb21haW4iKS5hdHRyKCJjbGFzcyIsInRpY2siKS5zdHlsZSgib3BhY2l0eSIsVGEpLGQ9R28udHJhbnNpdGlvbihwLmV4aXQoKSkuc3R5bGUoIm9wYWNpdHkiLFRhKS5yZW1vdmUoKSxtPUdvLnRyYW5zaXRpb24ocC5vcmRlcigpKS5zdHlsZSgib3BhY2l0eSIsMSkseT1IaShmKSx4PXMuc2VsZWN0QWxsKCIuZG9tYWluIikuZGF0YShbMF0pLE09KHguZW50ZXIoKS5hcHBlbmQoInBhdGgiKS5hdHRyKCJjbGFzcyIsImRvbWFpbiIpLEdvLnRyYW5zaXRpb24oeCkpO3YuYXBwZW5kKCJsaW5lIiksdi5hcHBlbmQoInRleHQiKTt2YXIgXz12LnNlbGVjdCgibGluZSIpLGI9bS5zZWxlY3QoImxpbmUiKSx3PXAuc2VsZWN0KCJ0ZXh0IikudGV4dChnKSxTPXYuc2VsZWN0KCJ0ZXh0Iiksaz1tLnNlbGVjdCgidGV4dCIpO3N3aXRjaChyKXtjYXNlImJvdHRvbSI6bj1abyxfLmF0dHIoInkyIix1KSxTLmF0dHIoInkiLE1hdGgubWF4KHUsMCkrbyksYi5hdHRyKCJ4MiIsMCkuYXR0cigieTIiLHUpLGsuYXR0cigieCIsMCkuYXR0cigieSIsTWF0aC5tYXgodSwwKStvKSx3LmF0dHIoImR5IiwiLjcxZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJtaWRkbGUiKSxNLmF0dHIoImQiLCJNIit5WzBdKyIsIitpKyJWMEgiK3lbMV0rIlYiK2kpO2JyZWFrO2Nhc2UidG9wIjpuPVpvLF8uYXR0cigieTIiLC11KSxTLmF0dHIoInkiLC0oTWF0aC5tYXgodSwwKStvKSksYi5hdHRyKCJ4MiIsMCkuYXR0cigieTIiLC11KSxrLmF0dHIoIngiLDApLmF0dHIoInkiLC0oTWF0aC5tYXgodSwwKStvKSksdy5hdHRyKCJkeSIsIjBlbSIpLnN0eWxlKCJ0ZXh0LWFuY2hvciIsIm1pZGRsZSIpLE0uYXR0cigiZCIsIk0iK3lbMF0rIiwiKy1pKyJWMEgiK3lbMV0rIlYiKy1pKTticmVhaztjYXNlImxlZnQiOm49Vm8sXy5hdHRyKCJ4MiIsLXUpLFMuYXR0cigieCIsLShNYXRoLm1heCh1LDApK28pKSxiLmF0dHIoIngyIiwtdSkuYXR0cigieTIiLDApLGsuYXR0cigieCIsLShNYXRoLm1heCh1LDApK28pKS5hdHRyKCJ5IiwwKSx3LmF0dHIoImR5IiwiLjMyZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJlbmQiKSxNLmF0dHIoImQiLCJNIistaSsiLCIreVswXSsiSDBWIit5WzFdKyJIIistaSk7YnJlYWs7Y2FzZSJyaWdodCI6bj1WbyxfLmF0dHIoIngyIix1KSxTLmF0dHIoIngiLE1hdGgubWF4KHUsMCkrbyksYi5hdHRyKCJ4MiIsdSkuYXR0cigieTIiLDApLGsuYXR0cigieCIsTWF0aC5tYXgodSwwKStvKS5hdHRyKCJ5IiwwKSx3LmF0dHIoImR5IiwiLjMyZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJzdGFydCIpLE0uYXR0cigiZCIsIk0iK2krIiwiK3lbMF0rIkgwViIreVsxXSsiSCIraSl9aWYoZi5yYW5nZUJhbmQpe3ZhciBFPWYsTj1FLnJhbmdlQmFuZCgpLzI7bD1mPWZ1bmN0aW9uKG4pe3JldHVybiBFKG4pK059fWVsc2UgbC5yYW5nZUJhbmQ/bD1mOmQuY2FsbChuLGYpO3YuY2FsbChuLGwpLG0uY2FsbChuLGYpfSl9dmFyIHQsZT1Hby5zY2FsZS5saW5lYXIoKSxyPURzLHU9NixpPTYsbz0zLGE9WzEwXSxjPW51bGw7cmV0dXJuIG4uc2NhbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLm9yaWVudD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10IGluIFBzP3QrIiI6RHMsbik6cn0sbi50aWNrcz1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPWFyZ3VtZW50cyxuKTphfSxuLnRpY2tWYWx1ZXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGM9dCxuKTpjfSxuLnRpY2tGb3JtYXQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ZSxuKTp0fSxuLnRpY2tTaXplPWZ1bmN0aW9uKHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg7cmV0dXJuIGU/KHU9K3QsaT0rYXJndW1lbnRzW2UtMV0sbik6dX0sbi5pbm5lclRpY2tTaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PSt0LG4pOnV9LG4ub3V0ZXJUaWNrU2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT0rdCxuKTppfSxuLnRpY2tQYWRkaW5nPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPSt0LG4pOm99LG4udGlja1N1YmRpdmlkZT1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoJiZufSxufTt2YXIgRHM9ImJvdHRvbSIsUHM9e3RvcDoxLHJpZ2h0OjEsYm90dG9tOjEsbGVmdDoxfTtHby5zdmcuYnJ1c2g9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKGkpe2kuZWFjaChmdW5jdGlvbigpe3ZhciBpPUdvLnNlbGVjdCh0aGlzKS5zdHlsZSgicG9pbnRlci1ldmVudHMiLCJhbGwiKS5zdHlsZSgiLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yIiwicmdiYSgwLDAsMCwwKSIpLm9uKCJtb3VzZWRvd24uYnJ1c2giLHUpLm9uKCJ0b3VjaHN0YXJ0LmJydXNoIix1KSxvPWkuc2VsZWN0QWxsKCIuYmFja2dyb3VuZCIpLmRhdGEoWzBdKTtvLmVudGVyKCkuYXBwZW5kKCJyZWN0IikuYXR0cigiY2xhc3MiLCJiYWNrZ3JvdW5kIikuc3R5bGUoInZpc2liaWxpdHkiLCJoaWRkZW4iKS5zdHlsZSgiY3Vyc29yIiwiY3Jvc3NoYWlyIiksaS5zZWxlY3RBbGwoIi5leHRlbnQiKS5kYXRhKFswXSkuZW50ZXIoKS5hcHBlbmQoInJlY3QiKS5hdHRyKCJjbGFzcyIsImV4dGVudCIpLnN0eWxlKCJjdXJzb3IiLCJtb3ZlIik7dmFyIGE9aS5zZWxlY3RBbGwoIi5yZXNpemUiKS5kYXRhKHAsTnQpO2EuZXhpdCgpLnJlbW92ZSgpLGEuZW50ZXIoKS5hcHBlbmQoImciKS5hdHRyKCJjbGFzcyIsZnVuY3Rpb24obil7cmV0dXJuInJlc2l6ZSAiK259KS5zdHlsZSgiY3Vyc29yIixmdW5jdGlvbihuKXtyZXR1cm4gVXNbbl19KS5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4IixmdW5jdGlvbihuKXtyZXR1cm4vW2V3XSQvLnRlc3Qobik/LTM6bnVsbH0pLmF0dHIoInkiLGZ1bmN0aW9uKG4pe3JldHVybi9eW25zXS8udGVzdChuKT8tMzpudWxsfSkuYXR0cigid2lkdGgiLDYpLmF0dHIoImhlaWdodCIsNikuc3R5bGUoInZpc2liaWxpdHkiLCJoaWRkZW4iKSxhLnN0eWxlKCJkaXNwbGF5IixuLmVtcHR5KCk/Im5vbmUiOm51bGwpO3ZhciBsLGY9R28udHJhbnNpdGlvbihpKSxoPUdvLnRyYW5zaXRpb24obyk7YyYmKGw9SGkoYyksaC5hdHRyKCJ4IixsWzBdKS5hdHRyKCJ3aWR0aCIsbFsxXS1sWzBdKSxlKGYpKSxzJiYobD1IaShzKSxoLmF0dHIoInkiLGxbMF0pLmF0dHIoImhlaWdodCIsbFsxXS1sWzBdKSxyKGYpKSx0KGYpfSl9ZnVuY3Rpb24gdChuKXtuLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLmF0dHIoInRyYW5zZm9ybSIsZnVuY3Rpb24obil7cmV0dXJuInRyYW5zbGF0ZSgiK2xbKy9lJC8udGVzdChuKV0rIiwiK2ZbKy9ecy8udGVzdChuKV0rIikifSl9ZnVuY3Rpb24gZShuKXtuLnNlbGVjdCgiLmV4dGVudCIpLmF0dHIoIngiLGxbMF0pLG4uc2VsZWN0QWxsKCIuZXh0ZW50LC5uPnJlY3QsLnM+cmVjdCIpLmF0dHIoIndpZHRoIixsWzFdLWxbMF0pfWZ1bmN0aW9uIHIobil7bi5zZWxlY3QoIi5leHRlbnQiKS5hdHRyKCJ5IixmWzBdKSxuLnNlbGVjdEFsbCgiLmV4dGVudCwuZT5yZWN0LC53PnJlY3QiKS5hdHRyKCJoZWlnaHQiLGZbMV0tZlswXSl9ZnVuY3Rpb24gdSgpe2Z1bmN0aW9uIHUoKXszMj09R28uZXZlbnQua2V5Q29kZSYmKEF8fCh4PW51bGwsTFswXS09bFsxXSxMWzFdLT1mWzFdLEE9MikseSgpKX1mdW5jdGlvbiBwKCl7MzI9PUdvLmV2ZW50LmtleUNvZGUmJjI9PUEmJihMWzBdKz1sWzFdLExbMV0rPWZbMV0sQT0wLHkoKSl9ZnVuY3Rpb24gdigpe3ZhciBuPUdvLm1vdXNlKF8pLHU9ITE7TSYmKG5bMF0rPU1bMF0sblsxXSs9TVsxXSksQXx8KEdvLmV2ZW50LmFsdEtleT8oeHx8KHg9WyhsWzBdK2xbMV0pLzIsKGZbMF0rZlsxXSkvMl0pLExbMF09bFsrKG5bMF08eFswXSldLExbMV09ZlsrKG5bMV08eFsxXSldKTp4PW51bGwpLEUmJmQobixjLDApJiYoZShTKSx1PSEwKSxOJiZkKG4scywxKSYmKHIoUyksdT0hMCksdSYmKHQoUyksdyh7dHlwZToiYnJ1c2giLG1vZGU6QT8ibW92ZSI6InJlc2l6ZSJ9KSl9ZnVuY3Rpb24gZChuLHQsZSl7dmFyIHIsdSxhPUhpKHQpLGM9YVswXSxzPWFbMV0scD1MW2VdLHY9ZT9mOmwsZD12WzFdLXZbMF07cmV0dXJuIEEmJihjLT1wLHMtPWQrcCkscj0oZT9nOmgpP01hdGgubWF4KGMsTWF0aC5taW4ocyxuW2VdKSk6bltlXSxBP3U9KHIrPXApK2Q6KHgmJihwPU1hdGgubWF4KGMsTWF0aC5taW4ocywyKnhbZV0tcikpKSxyPnA/KHU9cixyPXApOnU9cCksdlswXSE9cnx8dlsxXSE9dT8oZT9vPW51bGw6aT1udWxsLHZbMF09cix2WzFdPXUsITApOnZvaWQgMH1mdW5jdGlvbiBtKCl7digpLFMuc3R5bGUoInBvaW50ZXItZXZlbnRzIiwiYWxsIikuc2VsZWN0QWxsKCIucmVzaXplIikuc3R5bGUoImRpc3BsYXkiLG4uZW1wdHkoKT8ibm9uZSI6bnVsbCksR28uc2VsZWN0KCJib2R5Iikuc3R5bGUoImN1cnNvciIsbnVsbCksVC5vbigibW91c2Vtb3ZlLmJydXNoIixudWxsKS5vbigibW91c2V1cC5icnVzaCIsbnVsbCkub24oInRvdWNobW92ZS5icnVzaCIsbnVsbCkub24oInRvdWNoZW5kLmJydXNoIixudWxsKS5vbigia2V5ZG93bi5icnVzaCIsbnVsbCkub24oImtleXVwLmJydXNoIixudWxsKSxDKCksdyh7dHlwZToiYnJ1c2hlbmQifSl9dmFyIHgsTSxfPXRoaXMsYj1Hby5zZWxlY3QoR28uZXZlbnQudGFyZ2V0KSx3PWEub2YoXyxhcmd1bWVudHMpLFM9R28uc2VsZWN0KF8pLGs9Yi5kYXR1bSgpLEU9IS9eKG58cykkLy50ZXN0KGspJiZjLE49IS9eKGV8dykkLy50ZXN0KGspJiZzLEE9Yi5jbGFzc2VkKCJleHRlbnQiKSxDPUkoKSxMPUdvLm1vdXNlKF8pLFQ9R28uc2VsZWN0KGVhKS5vbigia2V5ZG93bi5icnVzaCIsdSkub24oImtleXVwLmJydXNoIixwKTtpZihHby5ldmVudC5jaGFuZ2VkVG91Y2hlcz9ULm9uKCJ0b3VjaG1vdmUuYnJ1c2giLHYpLm9uKCJ0b3VjaGVuZC5icnVzaCIsbSk6VC5vbigibW91c2Vtb3ZlLmJydXNoIix2KS5vbigibW91c2V1cC5icnVzaCIsbSksUy5pbnRlcnJ1cHQoKS5zZWxlY3RBbGwoIioiKS5pbnRlcnJ1cHQoKSxBKUxbMF09bFswXS1MWzBdLExbMV09ZlswXS1MWzFdO2Vsc2UgaWYoayl7dmFyIHE9Ky93JC8udGVzdChrKSx6PSsvXm4vLnRlc3Qoayk7TT1bbFsxLXFdLUxbMF0sZlsxLXpdLUxbMV1dLExbMF09bFtxXSxMWzFdPWZbel19ZWxzZSBHby5ldmVudC5hbHRLZXkmJih4PUwuc2xpY2UoKSk7Uy5zdHlsZSgicG9pbnRlci1ldmVudHMiLCJub25lIikuc2VsZWN0QWxsKCIucmVzaXplIikuc3R5bGUoImRpc3BsYXkiLG51bGwpLEdvLnNlbGVjdCgiYm9keSIpLnN0eWxlKCJjdXJzb3IiLGIuc3R5bGUoImN1cnNvciIpKSx3KHt0eXBlOiJicnVzaHN0YXJ0In0pLHYoKX12YXIgaSxvLGE9TShuLCJicnVzaHN0YXJ0IiwiYnJ1c2giLCJicnVzaGVuZCIpLGM9bnVsbCxzPW51bGwsbD1bMCwwXSxmPVswLDBdLGg9ITAsZz0hMCxwPWpzWzBdO3JldHVybiBuLmV2ZW50PWZ1bmN0aW9uKG4pe24uZWFjaChmdW5jdGlvbigpe3ZhciBuPWEub2YodGhpcyxhcmd1bWVudHMpLHQ9e3g6bCx5OmYsaTppLGo6b30sZT10aGlzLl9fY2hhcnRfX3x8dDt0aGlzLl9fY2hhcnRfXz10LENzP0dvLnNlbGVjdCh0aGlzKS50cmFuc2l0aW9uKCkuZWFjaCgic3RhcnQuYnJ1c2giLGZ1bmN0aW9uKCl7aT1lLmksbz1lLmosbD1lLngsZj1lLnksbih7dHlwZToiYnJ1c2hzdGFydCJ9KX0pLnR3ZWVuKCJicnVzaDpicnVzaCIsZnVuY3Rpb24oKXt2YXIgZT1tdShsLHQueCkscj1tdShmLHQueSk7cmV0dXJuIGk9bz1udWxsLGZ1bmN0aW9uKHUpe2w9dC54PWUodSksZj10Lnk9cih1KSxuKHt0eXBlOiJicnVzaCIsbW9kZToicmVzaXplIn0pfX0pLmVhY2goImVuZC5icnVzaCIsZnVuY3Rpb24oKXtpPXQuaSxvPXQuaixuKHt0eXBlOiJicnVzaCIsbW9kZToicmVzaXplIn0pLG4oe3R5cGU6ImJydXNoZW5kIn0pfSk6KG4oe3R5cGU6ImJydXNoc3RhcnQifSksbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KSxuKHt0eXBlOiJicnVzaGVuZCJ9KSl9KX0sbi54PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPXQscD1qc1shYzw8MXwhc10sbik6Y30sbi55PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhzPXQscD1qc1shYzw8MXwhc10sbik6c30sbi5jbGFtcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYyYmcz8oaD0hIXRbMF0sZz0hIXRbMV0pOmM/aD0hIXQ6cyYmKGc9ISF0KSxuKTpjJiZzP1toLGddOmM/aDpzP2c6bnVsbH0sbi5leHRlbnQ9ZnVuY3Rpb24odCl7dmFyIGUscix1LGEsaDtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYyYmKGU9dFswXSxyPXRbMV0scyYmKGU9ZVswXSxyPXJbMF0pLGk9W2Uscl0sYy5pbnZlcnQmJihlPWMoZSkscj1jKHIpKSxlPnImJihoPWUsZT1yLHI9aCksKGUhPWxbMF18fHIhPWxbMV0pJiYobD1bZSxyXSkpLHMmJih1PXRbMF0sYT10WzFdLGMmJih1PXVbMV0sYT1hWzFdKSxvPVt1LGFdLHMuaW52ZXJ0JiYodT1zKHUpLGE9cyhhKSksdT5hJiYoaD11LHU9YSxhPWgpLCh1IT1mWzBdfHxhIT1mWzFdKSYmKGY9W3UsYV0pKSxuKTooYyYmKGk/KGU9aVswXSxyPWlbMV0pOihlPWxbMF0scj1sWzFdLGMuaW52ZXJ0JiYoZT1jLmludmVydChlKSxyPWMuaW52ZXJ0KHIpKSxlPnImJihoPWUsZT1yLHI9aCkpKSxzJiYobz8odT1vWzBdLGE9b1sxXSk6KHU9ZlswXSxhPWZbMV0scy5pbnZlcnQmJih1PXMuaW52ZXJ0KHUpLGE9cy5pbnZlcnQoYSkpLHU+YSYmKGg9dSx1PWEsYT1oKSkpLGMmJnM/W1tlLHVdLFtyLGFdXTpjP1tlLHJdOnMmJlt1LGFdKX0sbi5jbGVhcj1mdW5jdGlvbigpe3JldHVybiBuLmVtcHR5KCl8fChsPVswLDBdLGY9WzAsMF0saT1vPW51bGwpLG59LG4uZW1wdHk9ZnVuY3Rpb24oKXtyZXR1cm4hIWMmJmxbMF09PWxbMV18fCEhcyYmZlswXT09ZlsxXX0sR28ucmViaW5kKG4sYSwib24iKX07dmFyIFVzPXtuOiJucy1yZXNpemUiLGU6ImV3LXJlc2l6ZSIsczoibnMtcmVzaXplIix3OiJldy1yZXNpemUiLG53OiJud3NlLXJlc2l6ZSIsbmU6Im5lc3ctcmVzaXplIixzZToibndzZS1yZXNpemUiLHN3OiJuZXN3LXJlc2l6ZSJ9LGpzPVtbIm4iLCJlIiwicyIsInciLCJudyIsIm5lIiwic2UiLCJzdyJdLFsiZSIsInciXSxbIm4iLCJzIl0sW11dLEhzPWljLmZvcm1hdD1mYy50aW1lRm9ybWF0LEZzPUhzLnV0YyxPcz1GcygiJVktJW0tJWRUJUg6JU06JVMuJUxaIik7SHMuaXNvPURhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nJiYrbmV3IERhdGUoIjIwMDAtMDEtMDFUMDA6MDA6MDAuMDAwWiIpPyRvOk9zLCRvLnBhcnNlPWZ1bmN0aW9uKG4pe3ZhciB0PW5ldyBEYXRlKG4pO3JldHVybiBpc05hTih0KT9udWxsOnR9LCRvLnRvU3RyaW5nPU9zLnRvU3RyaW5nLGljLnNlY29uZD1IdChmdW5jdGlvbihuKXtyZXR1cm4gbmV3IG9jKDFlMypNYXRoLmZsb29yKG4vMWUzKSl9LGZ1bmN0aW9uKG4sdCl7bi5zZXRUaW1lKG4uZ2V0VGltZSgpKzFlMypNYXRoLmZsb29yKHQpKX0sZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0U2Vjb25kcygpfSksaWMuc2Vjb25kcz1pYy5zZWNvbmQucmFuZ2UsaWMuc2Vjb25kcy51dGM9aWMuc2Vjb25kLnV0Yy5yYW5nZSxpYy5taW51dGU9SHQoZnVuY3Rpb24obil7cmV0dXJuIG5ldyBvYyg2ZTQqTWF0aC5mbG9vcihuLzZlNCkpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSs2ZTQqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldE1pbnV0ZXMoKX0pLGljLm1pbnV0ZXM9aWMubWludXRlLnJhbmdlLGljLm1pbnV0ZXMudXRjPWljLm1pbnV0ZS51dGMucmFuZ2UsaWMuaG91cj1IdChmdW5jdGlvbihuKXt2YXIgdD1uLmdldFRpbWV6b25lT2Zmc2V0KCkvNjA7cmV0dXJuIG5ldyBvYygzNmU1KihNYXRoLmZsb29yKG4vMzZlNS10KSt0KSl9LGZ1bmN0aW9uKG4sdCl7bi5zZXRUaW1lKG4uZ2V0VGltZSgpKzM2ZTUqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldEhvdXJzKCl9KSxpYy5ob3Vycz1pYy5ob3VyLnJhbmdlLGljLmhvdXJzLnV0Yz1pYy5ob3VyLnV0Yy5yYW5nZSxpYy5tb250aD1IdChmdW5jdGlvbihuKXtyZXR1cm4gbj1pYy5kYXkobiksbi5zZXREYXRlKDEpLG59LGZ1bmN0aW9uKG4sdCl7bi5zZXRNb250aChuLmdldE1vbnRoKCkrdCl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldE1vbnRoKCl9KSxpYy5tb250aHM9aWMubW9udGgucmFuZ2UsaWMubW9udGhzLnV0Yz1pYy5tb250aC51dGMucmFuZ2U7dmFyIFlzPVsxZTMsNWUzLDE1ZTMsM2U0LDZlNCwzZTUsOWU1LDE4ZTUsMzZlNSwxMDhlNSwyMTZlNSw0MzJlNSw4NjRlNSwxNzI4ZTUsNjA0OGU1LDI1OTJlNiw3Nzc2ZTYsMzE1MzZlNl0sSXM9W1tpYy5zZWNvbmQsMV0sW2ljLnNlY29uZCw1XSxbaWMuc2Vjb25kLDE1XSxbaWMuc2Vjb25kLDMwXSxbaWMubWludXRlLDFdLFtpYy5taW51dGUsNV0sW2ljLm1pbnV0ZSwxNV0sW2ljLm1pbnV0ZSwzMF0sW2ljLmhvdXIsMV0sW2ljLmhvdXIsM10sW2ljLmhvdXIsNl0sW2ljLmhvdXIsMTJdLFtpYy5kYXksMV0sW2ljLmRheSwyXSxbaWMud2VlaywxXSxbaWMubW9udGgsMV0sW2ljLm1vbnRoLDNdLFtpYy55ZWFyLDFdXSxacz1Icy5tdWx0aShbWyIuJUwiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldE1pbGxpc2Vjb25kcygpfV0sWyI6JVMiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFNlY29uZHMoKX1dLFsiJUk6JU0iLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldE1pbnV0ZXMoKX1dLFsiJUkgJXAiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldEhvdXJzKCl9XSxbIiVhICVkIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXREYXkoKSYmMSE9bi5nZXREYXRlKCl9XSxbIiViICVkIixmdW5jdGlvbihuKXtyZXR1cm4gMSE9bi5nZXREYXRlKCl9XSxbIiVCIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNb250aCgpfV0sWyIlWSIsTmVdXSksVnM9e3JhbmdlOmZ1bmN0aW9uKG4sdCxlKXtyZXR1cm4gR28ucmFuZ2UoTWF0aC5jZWlsKG4vZSkqZSwrdCxlKS5tYXAoQm8pfSxmbG9vcjpOdCxjZWlsOk50fTtJcy55ZWFyPWljLnllYXIsaWMuc2NhbGU9ZnVuY3Rpb24oKXtyZXR1cm4gWG8oR28uc2NhbGUubGluZWFyKCksSXMsWnMpfTt2YXIgJHM9SXMubWFwKGZ1bmN0aW9uKG4pe3JldHVybltuWzBdLnV0YyxuWzFdXX0pLFhzPUZzLm11bHRpKFtbIi4lTCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDTWlsbGlzZWNvbmRzKCl9XSxbIjolUyIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDU2Vjb25kcygpfV0sWyIlSTolTSIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDTWludXRlcygpfV0sWyIlSSAlcCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDSG91cnMoKX1dLFsiJWEgJWQiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ0RheSgpJiYxIT1uLmdldFVUQ0RhdGUoKX1dLFsiJWIgJWQiLGZ1bmN0aW9uKG4pe3JldHVybiAxIT1uLmdldFVUQ0RhdGUoKX1dLFsiJUIiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ01vbnRoKCl9XSxbIiVZIixOZV1dKTskcy55ZWFyPWljLnllYXIudXRjLGljLnNjYWxlLnV0Yz1mdW5jdGlvbigpe3JldHVybiBYbyhHby5zY2FsZS5saW5lYXIoKSwkcyxYcyl9LEdvLnRleHQ9QXQoZnVuY3Rpb24obil7cmV0dXJuIG4ucmVzcG9uc2VUZXh0fSksR28uanNvbj1mdW5jdGlvbihuLHQpe3JldHVybiBDdChuLCJhcHBsaWNhdGlvbi9qc29uIixKbyx0KX0sR28uaHRtbD1mdW5jdGlvbihuLHQpe3JldHVybiBDdChuLCJ0ZXh0L2h0bWwiLFdvLHQpfSxHby54bWw9QXQoZnVuY3Rpb24obil7cmV0dXJuIG4ucmVzcG9uc2VYTUx9KSwiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZSgnZDMnLFtdLEdvKToib2JqZWN0Ij09dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9R286dGhpcy5kMz1Hb30oKTsKLyoqCiAqIHRoZSB3aWR0aCBoZWlnaHQgJiB4L3IgcmFuZ2UgYWxsIHRoZSBjaHJvbWF0byAmIHNwZWN0cmEgd2lsbCBzaGFyZQogKgogKiBmb2xsb3dpbmcgZDMsIHRoZXJlIGlzCiAqICogYSBkb21haW46IHJhbmdlIG9mICJyZWFsICIgdmFsdWVzCiAqICogYSByYW5nZTogdmlld3BvcnQgY29vcmVkaW5hdGVzCiAqICogb3JpZ0RvbWFpbiAoZG9tYWluIGF0IGxhcmdlLCBiZWZvcmUgem9vbSkKICoKICogJ3NjYWxlY2hhbmdlJyBldm50IGlzIHRyaWdnZXJlZCB3aGVuIGJvdW5kYXJpZXMgYXJlIGNoYW5nZWQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JyxbJ2QzJywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnXSwgZnVuY3Rpb24oZDMsIF8sIEJhY2tib25lKSB7CiAgdmFyIEQzU2NhbGluZ0NvbnRleHQgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKCiAgICAgIHRoaXMuX3hPcmlnRG9tYWluID0gKG9wdGlvbnMgJiYgb3B0aW9ucy54RG9tYWluICYmIG9wdGlvbnMueERvbWFpbi5zbGljZSgpKSB8fCBbMCwgMV07CiAgICAgIHRoaXMuX3lPcmlnRG9tYWluID0gKG9wdGlvbnMgJiYgb3B0aW9ucy55RG9tYWluICYmIG9wdGlvbnMueURvbWFpbi5zbGljZSgpKSB8fCBbMCwgMV07CiAgICAgIHRoaXMuX3hEb21haW4gPSB0aGlzLl94T3JpZ0RvbWFpbi5zbGljZSgpOwogICAgICB0aGlzLl95RG9tYWluID0gdGhpcy5feU9yaWdEb21haW4uc2xpY2UoKTsKCiAgICAgIHRoaXMuX3hSYW5nZSA9IFswLCAob3B0aW9ucyAmJiBvcHRpb25zLndpZHRoKSB8fCAzMzJdOwogICAgICB0aGlzLl95UmFuZ2UgPSBbKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQpIHx8IDY2NCwgMF07CgogICAgICB0aGlzLmNoYW5nZVhEb21haW5DYWxsQmFja3MgPSB7fTsKICAgICAgcmV0dXJuIHRoaXMKICAgIH0sCiAgICB3aWR0aCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhciBjaGFuZ2VkID0gdGhpcy5feFJhbmdlWzFdICE9IHY7CiAgICAgICAgdGhpcy5feFJhbmdlWzFdID0gdjsKICAgICAgICBpZiAoY2hhbmdlZCkgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdzY2FsZWNoYW5nZScsICdyZXNldCcpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feFJhbmdlWzFdOwogICAgfSwKICAgIGhlaWdodCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhciBjaGFuZ2VkID0gdGhpcy5feVJhbmdlWzBdICE9IHY7CiAgICAgICAgdGhpcy5feVJhbmdlWzBdID0gdjsKICAgICAgICBpZiAoY2hhbmdlZCkgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdzY2FsZWNoYW5nZScsICdyZXNldCcpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feVJhbmdlWzBdOwogICAgfSwKICAgIHggOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzLnNjYWxlLmxpbmVhcigpLmRvbWFpbih0aGlzLl94RG9tYWluKS5yYW5nZSh0aGlzLl94UmFuZ2UpOwogICAgfSwKICAgIHkgOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzLnNjYWxlLmxpbmVhcigpLmRvbWFpbih0aGlzLl95RG9tYWluKS5yYW5nZSh0aGlzLl95UmFuZ2UpCiAgICB9LAogICAgcmVzZXQgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgY2hhbmdlZCA9IHNlbGYuX3hEb21haW5bMF0gIT0gc2VsZi5feE9yaWdEb21haW5bMF0gfHwgc2VsZi5feERvbWFpblsxXSAhPSBzZWxmLl94T3JpZ0RvbWFpblsxXSB8fCBzZWxmLl95RG9tYWluWzBdICE9IHNlbGYuX3lPcmlnRG9tYWluWzBdIHx8IHNlbGYuX3lEb21haW5bMV0gIT0gc2VsZi5feU9yaWdEb21haW5bMV07CgogICAgICBzZWxmLl94RG9tYWluWzBdID0gc2VsZi5feE9yaWdEb21haW5bMF07CiAgICAgIHNlbGYuX3hEb21haW5bMV0gPSBzZWxmLl94T3JpZ0RvbWFpblsxXTsKICAgICAgc2VsZi5feURvbWFpblswXSA9IHNlbGYuX3lPcmlnRG9tYWluWzBdOwogICAgICBzZWxmLl95RG9tYWluWzFdID0gc2VsZi5feU9yaWdEb21haW5bMV07CiAgICAgIGlmIChjaGFuZ2VkKSB7CiAgICAgICAgc2VsZi50cmlnZ2VyKCdzY2FsZWNoYW5nZScsICdyZXNldCcpOwogICAgICB9CiAgICAgIC8vc2VsZi5maXJlQ2hhbmdlWFJhbmdlKCk7CiAgICB9LAogICAgcmVzZXRYIDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGNoYW5nZWQgPSBzZWxmLl94RG9tYWluWzBdICE9IHNlbGYuX3hPcmlnRG9tYWluWzBdIHx8IHNlbGYuX3hEb21haW5bMV0gIT0gc2VsZi5feE9yaWdEb21haW5bMV07CgogICAgICBzZWxmLl94RG9tYWluWzBdID0gc2VsZi5feE9yaWdEb21haW5bMF07CiAgICAgIHNlbGYuX3hEb21haW5bMV0gPSBzZWxmLl94T3JpZ0RvbWFpblsxXTsKICAgICAgaWYgKGNoYW5nZWQpIHsKICAgICAgICBzZWxmLnRyaWdnZXIoJ3NjYWxlY2hhbmdlJywgJ3Jlc2V0WCcpOwogICAgICB9CiAgICAgIHJldHVybiBzZWxmOwoKICAgICAgLy9zZWxmLmZpcmVDaGFuZ2VYUmFuZ2UoKTsKICAgIH0sCiAgICByZXNldFkgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgc2VsZi5feURvbWFpblswXSA9IHNlbGYuX3lPcmlnRG9tYWluWzBdOwogICAgICBzZWxmLl95RG9tYWluWzFdID0gc2VsZi5feU9yaWdEb21haW5bMV07CiAgICAgIC8vc2VsZi5maXJlQ2hhbmdlWFJhbmdlKCk7CiAgICAgIHJldHVybiBzZWxmOwogICAgfSwKICAgIHhNaW4gOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl94T3JpZ0RvbWFpblswXSA9IHY7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3hPcmlnRG9tYWluWzBdCiAgICB9LAogICAgeE1heCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX3hPcmlnRG9tYWluWzFdID0gdjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feE9yaWdEb21haW5bMV0KICAgIH0sCiAgICB5TWluIDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feU9yaWdEb21haW5bMF0gPSB2OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl95T3JpZ0RvbWFpblswXQogICAgfSwKICAgIHlNYXggOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl95T3JpZ0RvbWFpblsxXSA9IHY7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3lPcmlnRG9tYWluWzFdCiAgICB9LAoKICAgIHhPcmlnRG9tYWluIDogZnVuY3Rpb24odnMpIHsKICAgICAgaWYgKHZzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl94T3JpZ0RvbWFpbiA9IHZzLnNsaWNlKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3hPcmlnRG9tYWluLnNsaWNlKCkKICAgIH0sCiAgICB5T3JpZ0RvbWFpbiA6IGZ1bmN0aW9uKHZzKSB7CiAgICAgIGlmICh2cyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feU9yaWdEb21haW4gPSB2cy5zbGljZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl95T3JpZ0RvbWFpbi5zbGljZSgpCiAgICB9LAogICAgeERvbWFpbiA6IGZ1bmN0aW9uKHgwLCB4MSwgb3B0cykgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICB2YXIgb3B0aW9ucyA9IF8uZXh0ZW5kKHsKICAgICAgICBzaWxlbnQgOiBmYWxzZQogICAgICB9LCBvcHRzKQoKICAgICAgaWYgKHgwID09PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuIHNlbGYuX3hEb21haW4uc2xpY2UoKTsKCiAgICAgIGlmIChfLmlzQXJyYXkoeDApKSB7CiAgICAgICAgeDEgPSB4MFsxXTsKICAgICAgICB4MCA9IHgwWzBdOwogICAgICB9CiAgICAgIHZhciBjaGFuZ2VkID0geDAgIT0gc2VsZi5feERvbWFpblswXSB8fCB4MSAhPSBzZWxmLl94RG9tYWluWzFdOwogICAgICBzZWxmLl94RG9tYWluWzBdID0geDA7CiAgICAgIHNlbGYuX3hEb21haW5bMV0gPSB4MTsKCiAgICAgIGlmIChjaGFuZ2VkICYmICFvcHRpb25zLnNpbGVudCkgewogICAgICAgIHNlbGYudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAneERvbWFpbicpOwogICAgICB9CgogICAgICByZXR1cm4gc2VsZgogICAgICAvL3RoaXMuZmlyZUNoYW5nZVhSYW5nZSgpOwogICAgfSwKICAgIHlEb21haW4gOiBmdW5jdGlvbih5MCwgeTEsIG9wdHMpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgb3B0aW9ucyA9IF8uZXh0ZW5kKHsKICAgICAgICBzaWxlbnQgOiBmYWxzZQogICAgICB9LCBvcHRzKQoKICAgICAgaWYgKHkwID09PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuIHRoaXMuX3lEb21haW4uc2xpY2UoKTsKCiAgICAgIGlmIChfLmlzQXJyYXkoeTApKSB7CiAgICAgICAgeTEgPSB5MFsxXTsKICAgICAgICB5MCA9IHkwWzBdOwogICAgICB9CiAgICAgIHZhciBjaGFuZ2VkID0geTAgIT0gc2VsZi5feURvbWFpblswXSB8fCB5MSAhPSBzZWxmLl95RG9tYWluWzFdOwoKICAgICAgc2VsZi5feURvbWFpblswXSA9IHkwOwogICAgICBzZWxmLl95RG9tYWluWzFdID0geTE7CiAgICAgIGlmIChjaGFuZ2VkICYmICFvcHRpb25zLnNpbGVudCkgewogICAgICAgIHNlbGYudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAneURvbWFpbicpOwogICAgICB9CiAgICAgIHNlbGYuZmlyZUNoYW5nZVhEb21haW4oKTsKICAgICAgcmV0dXJuIHNlbGY7CiAgICB9LAogICAgaXNYWm9vbWVkIDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgcmV0dXJuIHNlbGYuX3hEb21haW5bMF0gPiBzZWxmLl94T3JpZ0RvbWFpblswXSB8fCBzZWxmLl94RG9tYWluWzFdIDwgc2VsZi5feE9yaWdEb21haW5bMV07CiAgICB9LAogICAgLyoKICAgICAqIHNldCB0aGUgbXhpbXVtIHggdmFsdWUsIHRoZSBvdmVyYWxsIG1heCBhbmQgdGhlIGN1cnJlbnQgb25lLgogICAgICogaWYgbGltaXRPbmx5LCB0aGVuIHdlIGp1c3QgbW9kaWZ5IHRoZSBvdmVyYWxsIGxpbWl0CiAgICAgKi8KICAgIHNldFhNYXggOiBmdW5jdGlvbihtLCBsaW1pdE9ubHkpIHsKICAgICAgdGhpcy5feE9yaWdEb21haW5bMV0gPSBtCiAgICAgIGlmIChsaW1pdE9ubHkpIHsKICAgICAgICB0aGlzLl94RG9tYWluWzFdID0gbQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIHNldFlNYXggOiBmdW5jdGlvbihtKSB7CiAgICAgIHRoaXMuX3lEb21haW5bMV0gPSB0aGlzLl95T3JpZ0RvbWFpblsxXSA9IG0KCiAgICB9LAogICAgYWRkQ2hhbmdlWERvbWFpbkNhbGxCYWNrIDogZnVuY3Rpb24obmFtZSwgZmN0KSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgc2VsZi5jaGFuZ2VYRG9tYWluQ2FsbEJhY2tzW25hbWVdID0gZmN0OwogICAgfSwKICAgIHJlbW92ZUNoYW5nZVhEb21haW5DYWxsQmFjayA6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBkZWxldGUgc2VsZi5jaGFuZ2VYRG9tYWluQ2FsbEJhY2tzW25hbWVdOwogICAgfSwKICAgIGZpcmVDaGFuZ2VYRG9tYWluIDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgXy5lYWNoKHNlbGYuY2hhbmdlWERvbWFpbkNhbGxCYWNrcywgZnVuY3Rpb24oZmN0LCBuYW1lKSB7CiAgICAgICAgZmN0KHNlbGYpOwogICAgICB9KTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIEQzU2NhbGluZ0NvbnRleHQ7Cgp9KTsKCi8qCiAqIGFyZWEgdG8gaGFuZGxlIG1vdmUvem9vbSBldGMuIGJ1dHRvbnMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhQnV0dG9ucycsWyd1bmRlcnNjb3JlJywgJ2QzJ10sIGZ1bmN0aW9uKF8sIGQzKXsKICAgIC8qKgogICAgICogc3ZnIGNvbnRhaW5lcgogICAgICogZDMtU2NhbGluZy1jb250ZXh0IChjb250YWlucyB0aGUgdmlld3BvcnQgYW5kIGRvbWFpbnMgYm91bmRhcmllcwogICAgICogYSBjYWxsIGJhY2sgdG8gYmUgY2FsbGVkIHdoZW4gem9vbWVkCiAgICAgKi8KICAgIEQzU2NhbGluZ0FyZWFCdXR0b25zID0gZnVuY3Rpb24oY29udGFpbmVyLCBjb250ZXh0LCBjYWxsYmFjaywgb3B0aW9ucykgewogICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYuY29udGV4dCA9IGNvbnRleHQ7CiAgICAgICAgc2VsZi5jb250YWluZXIgPSBjb250YWluZXI7CiAgICAgICAgc2VsZi5jYWxsYmFjayA9IGNhbGxiYWNrCiAgICAgICAgc2VsZi5oZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCAzMDsKCiAgICAgICAgc2VsZi5jb250YWluZXIuYXR0cignd2lkdGgnLCBjb250ZXh0LndpZHRoKTsKICAgICAgICBzZWxmLmNvbnRhaW5lci5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCk7CgogICAgICAgIHNlbGYucF9zZXR1cCA9IHBfc2V0dXA7CgogICAgICAgIHNlbGYucF9zZXR1cCgpCgogICAgfQogICAgICByZXR1cm4gRDNTY2FsaW5nQXJlYUJ1dHRvbnM7Cgp9KTsKLyoKICogc3ZnIGNvbnRhaW5lciBmb3IgdGhlIGNvbW1vbiBzY2FsaW5nZiBhcmVhLgogKgogKiBkMy1TY2FsaW5nLWNvbnRleHQgKGNvbnRhaW5zIHRoZSB2aWV3cG9ydCBhbmQgZG9tYWlucyBib3VuZGFyaWVzCiAqIGEgY2FsbCBiYWNrIHRvIGJlIGNhbGxlZCB3aGVuIHpvb21lZAogKiAqIG1vZGVsOiBzY2FsaW5nQ29udGV4dCwKICogKiBlbDogY29udGFpbmVyLAogKiAqIGNhbGxiYWNrOiBjYWxsIGJhY2sgd2hlbiB6b29tZWQgaGFzIGJlZW4gY2FsbGVkIChmb3IgIHN0dHVkZmYgbm90IHRyaWdnZXJlIGJ5IHNjYWxlY2hhbmdlIGV2ZW50cykKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0FyZWEnLFsndW5kZXJzY29yZScsICdkMycsICdCYWNrYm9uZScsICcuL0QzU2NhbGluZ0FyZWFCdXR0b25zJ10sIGZ1bmN0aW9uIChfLCBkMywgQmFja2JvbmUsIEQzU2NhbGluZ0FyZWFCdXR0b25zKSB7CiAgICB2YXIgRDNTY2FsaW5nQXJlYSA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgey8vY29udGFpbmVyLCBjb250ZXh0LCBjYWxsYmFjaywgb3B0aW9ucykgewoKICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmNhbGxiYWNrID0gb3B0aW9ucy5jYWxsYmFjazsKCiAgICAgICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgc2VsZi5tb2RlbC5oZWlnaHQoKSB8fCAzMDsKCiAgICAgICAgICAgIHZhciBlbCA9IF8uaXNBcnJheShzZWxmLmVsKSA/IHNlbGYuZWxbMF0gOiBzZWxmLmVsOwogICAgICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGQzLnNlbGVjdChlbCkuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmF0dHIoJ3dpZHRoJywgb3B0aW9ucy53aWR0aCB8fCBzZWxmLm1vZGVsLndpZHRoKCkpOwogICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCk7CgogICAgICAgICAgICBzZWxmLnBfc2V0dXAoKQoKICAgICAgICB9LAogICAgICAgIHVwZGF0ZVNjYWxpbmdDb250ZXh0OiBmdW5jdGlvbiAoY3R4KSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5tb2RlbCA9IGN0eDsKCiAgICAgICAgfSwKICAgICAgICBwX3NldHVwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciBnID0gc2VsZi5jb250YWluZXIuaW5zZXJ0KCJnIiwgIjpmaXJzdC1jaGlsZCIpCiAgICAgICAgICAgIC8vdmFyIHJlY3QgPSBnLmluc2VydCgicmVjdCIsICI6Zmlyc3QtY2hpbGQiKS5hdHRyKCd4JywgMCkuYXR0cigneScsIDApLmF0dHIoJ3dpZHRoJywgJzEwMCUnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ2ZpbGwtb3BhY2l0eScsICcwJScpLmF0dHIoJ2NsYXNzJywgJ3pvb20tYXJlYScpOwoKICAgICAgICAgICAgc2VsZi5wX3NldHVwX2J1dHRvbnMoKTsKCiAgICAgICAgICAgIC8vIHNlbGYuem9vbSA9IGQzLmJlaGF2aW9yLnpvb20oKS54KHNlbGYuY29udGV4dC54U2NhbGUpLnNjYWxlRXh0ZW50KFsxLCAxODBdKS5vbigiem9vbSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAvLyBzZWxmLmNhbGxiYWNrKCk7CiAgICAgICAgICAgIC8vIHNlbGYuY29udGV4dC5maXJlQ2hhbmdlWFJhbmdlKCk7CiAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAvLyAgIHNlbGYuY29udGFpbmVyLmNhbGwoc2VsZi56b29tKTsKICAgICAgICB9LAogICAgICAgIHBfc2V0dXBfYnV0dG9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgc2NhbGluZ0NvbnRleHQgPSBzZWxmLm1vZGVsOwogICAgICAgICAgICBzZWxmLmJ1dHRvbnMgPSB7fTsKICAgICAgICAgICAgdmFyIGcgPSBzZWxmLmNvbnRhaW5lci5pbnNlcnQoImciKS5hdHRyKCdjbGFzcycsICdzY2FsaW5nLWFyZWEtbWVudScpOwoKICAgICAgICAgICAgdmFyIGlCdXR0b24gPSAwOwogICAgICAgICAgICB2YXIgZmN0QWRkQnV0dG9uID0gZnVuY3Rpb24gKG5hbWUsIHRleHQsIGZJc1Nob3dpbmcsIGZBY3Rpb24pIHsKICAgICAgICAgICAgICAgIHZhciBnYnV0ID0gZy5pbnNlcnQoImciKS5hdHRyKCdjbGFzcycsICdzY2FsaW5nLWFyZWEtbWVudS1vbmUtYnV0dG9uJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgyMCwnICsgKDEwICsgaUJ1dHRvbiAqIDI3KSArICcpJyk7CiAgICAgICAgICAgICAgICB2YXIgcmVjdCA9IGdidXQuaW5zZXJ0KCJyZWN0IikuYXR0cignY2xhc3MnLCAnYnV0dG9uJykuYXR0cigneCcsIDApLmF0dHIoJ3knLCAwKS5hdHRyKCd3aWR0aCcsIDgwKS5hdHRyKCdyeCcsIDUpLmF0dHIoJ3J5JywgNSkuYXR0cignaGVpZ2h0JywgMjIpOwogICAgICAgICAgICAgICAgZ2J1dC5hcHBlbmQoJ3RleHQnKS5hdHRyKCJ4IiwgNDApLmF0dHIoInkiLCAxMSkudGV4dCh0ZXh0KTsKICAgICAgICAgICAgICAgIHNlbGYuYnV0dG9uc1tuYW1lXSA9IHsKICAgICAgICAgICAgICAgICAgICBlbDogZ2J1dCwKICAgICAgICAgICAgICAgICAgICBpc1Nob3dpbmc6IGZJc1Nob3dpbmcsCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBmQWN0aW9uCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdmFyIGdPdmVyID0gZ2J1dC5pbnNlcnQoInJlY3QiKS5hdHRyKCdjbGFzcycsICdvdmVyLWJ1dHRvbicpLmF0dHIoJ3gnLCAwKS5hdHRyKCd5JywgMCkuYXR0cignd2lkdGgnLCA4MCkuYXR0cigncngnLCA1KS5hdHRyKCdyeScsIDUpLmF0dHIoJ2hlaWdodCcsIDIyKTsKICAgICAgICAgICAgICAgIGdidXQub24oJ2NsaWNrJywgZkFjdGlvbik7CgogICAgICAgICAgICAgICAgZ2J1dC5zdHlsZSgnZGlzcGxheScsIGZJc1Nob3dpbmcoKSA/IG51bGwgOiAnbm9uZScpOwogICAgICAgICAgICAgICAgaUJ1dHRvbisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZjdEFkZEJ1dHRvbignem9vbU91dCcsICd6b29tIG91dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLm1vZGVsLmlzWFpvb21lZCgpOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLm1vZGVsLnJlc2V0KCk7CiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBzZWxmLmxpc3RlblRvKHNjYWxpbmdDb250ZXh0LCAnc2NhbGVjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfLmVhY2goc2VsZi5idXR0b25zLCBmdW5jdGlvbiAoYnV0Q29uZiwgbmFtZSkgewogICAgICAgICAgICAgICAgICAgIGJ1dENvbmYuZWwuc3R5bGUoJ2Rpc3BsYXknLCBidXRDb25mLmlzU2hvd2luZygpID8gbnVsbCA6ICdub25lJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKCiAgICAgICAgfSwKICAgICAgICBoaWRlQWxsQnV0dG9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIF8uZWFjaChzZWxmLmJ1dHRvbnMsIGZ1bmN0aW9uIChidXRDb25mLCBuYW1lKSB7CiAgICAgICAgICAgICAgICBidXRDb25mLmVsLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTsKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBEM1NjYWxpbmdBcmVhOwoKfSk7CgovKioKICogQW4gYWJzdHJhY3QgY2xhc3MgZm9yIEQzV2lkZ2V0IG9yaWVudGVkIHZpZXdzCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZDMnLCAnLi4vdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICcuLi91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBkMywgRDNTY2FsaW5nQ29udGV4dCwgRDNTY2FsaW5nQXJlYSkgewogIHZhciBLRVlQUkVTU0VEX05PTkUgPSAwOwogIHZhciBLRVlQUkVTU0VEX1NISUZUID0gMTsKICB2YXIgS0VZUFJFU1NFRF9BTFQgPSAyOwogIHZhciBET1VCTEVfQ0xJQ0sgPSA0OwoKICBDb21tb25XaWRnZXRWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIGVsVG1wID0gXy5pc0FycmF5KHNlbGYuZWwpID8gc2VsZi5lbFswXSA6IHNlbGYuZWwKICAgICAgaWYgKCQoZWxUbXApLnByb3AoInRhZ05hbWUiKS50b0xvd2VyQ2FzZSgpID09PSAnZGl2JykgewogICAgICAgIHNlbGYuZWwgPSBkMy5zZWxlY3QoZWxUbXApLmFwcGVuZCgnc3ZnJykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCd3aWR0aCcsICcxMDAlJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZi5lbCA9IGQzLnNlbGVjdChlbFRtcCk7CiAgICAgIH0KCiAgICAgIGlmIChzZWxmLnNjYWxpbmdDb250ZXh0KSB7CiAgICAgICAgc2VsZi54Wm9vbWFibGUoKQogICAgICB9CiAgICAgIHNlbGYuYnJ1c2hDYWxsYmFja3MgPSB7fTsKCiAgICAgIGlmICgkKGVsVG1wKS5wcm9wKCd0YWdOYW1lJykudG9Mb3dlckNhc2UoKSA9PT0gJ3N2ZycpIHsKICAgICAgICBzZWxmLl9oZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCAkKGVsVG1wKS5wYXJlbnQoKS5oZWlnaHQoKSB8fCAzMDA7CiAgICAgICAgc2VsZi5fd2lkdGggPSBvcHRpb25zLndpZHRoIHx8ICQoZWxUbXApLnBhcmVudCgpLndpZHRoKCkgfHwgMjAwOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGYuX2hlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8ICQoZWxUbXApLmhlaWdodCgpIHx8IDMwMDsKICAgICAgICBzZWxmLl93aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgJChlbFRtcCkud2lkdGgoKSB8fCAyMDA7CiAgICAgIH0KCiAgICB9LAogICAgaGVpZ2h0IDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5faGVpZ2h0ID0gdjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5faGVpZ2h0OwogICAgfSwKICAgIHdpZHRoIDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5fd2lkdGggPSB2OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl93aWR0aDsKICAgIH0sCiAgICAvKioKICAgICAqIGdldCB0aGUgc2NhbGluZ0NvbnRleHQgZnJvbSB0aGUgb3B0aW9ucyAoY29udHJ1Y3RvciBvcmllbnRlZCkgb3IgZGVmaW5lIGEgbmV3IG9uZQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgICAqLwogICAgc2V0dXBTY2FsaW5nQ29udGV4dCA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgICAgIGlmIChvcHRpb25zLnNjYWxpbmdDb250ZXh0ICE9IHVuZGVmaW5lZCkgewogICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQgPSBvcHRpb25zLnNjYWxpbmdDb250ZXh0OwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChzZWxmLnNjYWxpbmdDb250ZXh0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQgPSBuZXcgRDNTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgICAgIGhlaWdodCA6IHNlbGYuX2hlaWdodCwKICAgICAgICAgICAgd2lkdGggOiBzZWxmLl93aWR0aAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy54RG9tYWluKSB7CiAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnhPcmlnRG9tYWluKG9wdGlvbnMueERvbWFpbik7CiAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnhEb21haW4ob3B0aW9ucy54RG9tYWluKTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMueURvbWFpbikgewogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC55T3JpZ0RvbWFpbihvcHRpb25zLnlEb21haW4pOwogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC55RG9tYWluKG9wdGlvbnMueURvbWFpbik7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLmhlaWdodCkgewogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5oZWlnaHQob3B0aW9ucy5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy53aWR0aCkgewogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC53aWR0aChvcHRpb25zLndpZHRoKTsKICAgICAgICB9CgogICAgICB9CiAgICAgIHNlbGYubGlzdGVuVG8oc2VsZi5zY2FsaW5nQ29udGV4dCwgJ3NjYWxlY2hhbmdlJywgZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgc2VsZi5yZW5kZXIoewogICAgICAgICAgY2F1c2UgOiB7CiAgICAgICAgICAgIG5hbWUgOiBldnQsCiAgICAgICAgICAgIGlkIDogTWF0aC5yYW5kb20oKQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KQogICAgfSwKICAgIC8qKgogICAgICogYWRkIGEgRDNTY2FsaW5nQXJlLCBpLmUuIGEgeC16b29tYWJsZSBhcmVhCiAgICAgKi8KICAgIHhab29tYWJsZSA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICB2YXIgYWRhcHRZRG9tYWluID0gZnVuY3Rpb24oeHMpIHsKICAgICAgICBpZiAoIXNlbGYuZ2V0TWF4WUluWERvbWFpbikKICAgICAgICAgIHJldHVybgogICAgICAgIHZhciB5bWF4ID0gc2VsZi5nZXRNYXhZSW5YRG9tYWluKHhzWzBdLCB4c1sxXSk7CiAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC55RG9tYWluKDAsIHltYXgsIHsKICAgICAgICAgIHNpbGVudCA6IHRydWUKICAgICAgICB9KTsKCiAgICAgIH0KCiAgICAgIHNlbGYuc2V0dXBJbnRlcmFjdGl2ZSgpOwogICAgICBzZWxmLnNldEJydXNoQ2FsbGJhY2soS0VZUFJFU1NFRF9OT05FLCBmdW5jdGlvbih4cykgewogICAgICAgIGFkYXB0WURvbWFpbih4cykKICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnhEb21haW4oeHMpCiAgICAgIH0pCiAgICAgIHNlbGYuc2V0QnJ1c2hDYWxsYmFjayhET1VCTEVfQ0xJQ0ssIGZ1bmN0aW9uKHhzKSB7CiAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5yZXNldCgpCiAgICAgIH0pCiAgICB9LAoKICAgIHNldFNoaWZ0U2VsZWN0Q2FsbGJhY2sgOiBmdW5jdGlvbihmKSB7CiAgICAgIHRoaXMuc2V0QnJ1c2hDYWxsYmFjayhLRVlQUkVTU0VEX1NISUZULCBmKTsKICAgIH0sCgogICAgc2V0dXBJbnRlcmFjdGl2ZSA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIGlmIChzZWxmLmJydXNoICE9PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuOwoKICAgICAgc2VsZi5lbC5zZWxlY3RBbGwoJy56b29tLWFyZWEnKS5yZW1vdmUoKQogICAgICBpZiAoc2VsZi5zY2FsaW5nQXJlYSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgc2VsZi5zY2FsaW5nQXJlYS51cGRhdGVTY2FsaW5nQ29udGV4dChzZWxmLnNjYWxpbmdDb250ZXh0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxmLnNjYWxpbmdBcmVhID0gbmV3IEQzU2NhbGluZ0FyZWEoewogICAgICAgICAgZWwgOiBzZWxmLnZpcyB8fCBzZWxmLmVsLAogICAgICAgICAgbW9kZWwgOiBzZWxmLnNjYWxpbmdDb250ZXh0LAogICAgICAgICAgY2FsbGJhY2sgOiBmdW5jdGlvbigpIHsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIGdCcnVzaCA9IChzZWxmLnZpcyB8fCBzZWxmLmVsKS5pbnNlcnQoJ2cnLCAnOmZpcnN0LWNoaWxkJykuYXR0cignY2xhc3MnLCAneC1zZWxlY3RvcicpOwogICAgICBnQnJ1c2guYXBwZW5kKCdyZWN0JykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCd3aWR0aCcsICcxMDAlJykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpOwogICAgICB2YXIgbGVmdEhpZGVyID0gZ0JydXNoLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2hpZGVyIGxlZnQnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ3dpZHRoJywgMCkuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpOwogICAgICB2YXIgcmlnaHRIaWRlciA9IGdCcnVzaC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsICdoaWRlciByaWdodCcpLmF0dHIoJ2hlaWdodCcsICcxMDAlJykuYXR0cignd2lkdGgnLCAnMTAwJScpLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTsKCiAgICAgIHZhciB0U3RhbXAgPSAwOwogICAgICB2YXIgaXNEYmxDbGljayA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBkID0gbmV3IERhdGUoKTsKICAgICAgICB2YXIgdDEgPSBkLmdldE1pbGxpc2Vjb25kcygpICsgMTAwMCAqIChkLmdldFNlY29uZHMoKSArIDYwICogZC5nZXRNaW51dGVzKCkpCiAgICAgICAgdmFyIGIgPSAodDEgLSB0U3RhbXApIDwgNDUwCiAgICAgICAgdFN0YW1wID0gdDE7CiAgICAgICAgcmV0dXJuIGI7CiAgICAgIH0KICAgICAgdmFyIGJydXNoID0gZDMuc3ZnLmJydXNoKCkub24oImJydXNoc3RhcnQiLCBmdW5jdGlvbigpIHsKICAgICAgICBicnVzaC54KHNlbGYuc2NhbGluZ0NvbnRleHQueCgpKTsKICAgICAgICBsZWZ0SGlkZXIuc3R5bGUoJ2Rpc3BsYXknLCBudWxsKQogICAgICAgIHJpZ2h0SGlkZXIuc3R5bGUoJ2Rpc3BsYXknLCBudWxsKQoKICAgICAgfSkub24oImJydXNoIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGJvdW5kcyA9IGJydXNoLmV4dGVudCgpCiAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKQogICAgICAgIGxlZnRIaWRlci5hdHRyKCd3aWR0aCcsIHgoYm91bmRzWzBdKSkKICAgICAgICByaWdodEhpZGVyLmF0dHIoJ3gnLCB4KGJvdW5kc1sxXSkpCgogICAgICB9KS5vbigiYnJ1c2hlbmQiLCBmdW5jdGlvbigpIHsKICAgICAgICB2YXIga3AgPSBnZXRLZXlQcmVzc2VkKCk7CiAgICAgICAgdmFyIGJvdW5kcyA9IGJydXNoLmV4dGVudCgpCiAgICAgICAgaWYgKGlzRGJsQ2xpY2soKSkgewogICAgICAgICAgc2VsZi5icnVzaENhbGxiYWNrc1tET1VCTEVfQ0xJQ0tdKCkKICAgICAgICB9IGVsc2UgaWYgKChib3VuZHNbMV0gLSBib3VuZHNbMF0pID49IDAuMDAxICogc2VsZi5zY2FsaW5nQ29udGV4dC54TWF4KCkpIHsKICAgICAgICAgIGlmIChzZWxmLmJydXNoQ2FsbGJhY2tzW2twXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHNlbGYuYnJ1c2hDYWxsYmFja3Nba3BdKGJvdW5kcykKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGVmdEhpZGVyLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKQogICAgICAgIHJpZ2h0SGlkZXIuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpCiAgICAgIH0pOwoKICAgICAgYnJ1c2gueChzZWxmLnNjYWxpbmdDb250ZXh0LngoKSk7CiAgICAgIGJydXNoKGdCcnVzaCk7CgogICAgfSwKICAgIHNldEJydXNoQ2FsbGJhY2sgOiBmdW5jdGlvbihrZXlNYXNrLCBmKSB7CiAgICAgIHRoaXMuYnJ1c2hDYWxsYmFja3Nba2V5TWFza10gPSBmCiAgICB9CiAgfSk7CgogIHZhciBnZXRLZXlQcmVzc2VkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaSA9IDA7CiAgICBpZiAoZDMuZXZlbnQuc291cmNlRXZlbnQuc2hpZnRLZXkpCiAgICAgIGkgfD0gS0VZUFJFU1NFRF9TSElGVDsKCiAgICBpZiAoZDMuZXZlbnQuc291cmNlRXZlbnQuYWx0S2V5KQogICAgICBpIHw9IEtFWVBSRVNTRURfQUxUOwogICAgcmV0dXJuIGkKICB9CiAgcmV0dXJuIENvbW1vbldpZGdldFZpZXc7Cn0pOwoKCi8qKgogKiB1dGlsaXR5IG1ldGhvZCB0aGF0IHdpbGwgYXBwbHkgYSByZWd1bGFyIGV4cHJlc3Npb24gb250byBhIHN0cmluZywgYXNzdW1pbmcgdGhhdCBhbGwgYWwgdGhlIHN0cmluZyBpcyBjYXB0aXJlZCBieSB0aGUgcmVnIGV4cCAobm8gaG9sZXMpCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdXRpbHMvUmVnRXhwRnVsbFNwbGl0ZXInLFsndW5kZXJzY29yZSddLCBmdW5jdGlvbiAoXykgewogICAgUmVnRXhwRnVsbFNwbGl0ZXIgPSBmdW5jdGlvbiAob3B0aW9ucykgewoKICAgIH0KICAgIC8qKgogICAgICogYWxsIG1hdGNoIGNhdHB1cmUgYnkgdGhlIHJlZ2V4cCBhcmUgcmV0dXJuZWQgaW4gYW4gYXJyYXksCiAgICAgKiBJZiBzb21lIHBpZWNlIG9mIHRoZSBzdHJpbmcgaXMgbm90IGNvdmVyZWQsIHRoZW4gYW4gRXhjZXB0aW9uIGlzIHRocm93bgogICAgICogcmVnZXhwIGlzIGR1cGxpY2F0ZSB0byBhdm9pZCBzeW5jIHByb2JsZW0gb24gbGFzdEluZGV4T2YgYW5kIHRoaXMga2luZCBvZiB0aGluZ3MuLi4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWdleHAgaXMgYSBzdHJpbmcgb3IgcmVnZXhwCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc3RyCiAgICAgKi8KICAgIFJlZ0V4cEZ1bGxTcGxpdGVyLnByb3RvdHlwZS5zcGxpdCA9IGZ1bmN0aW9uIChyZWdleHAsIHN0cikgewogICAgICAgIHZhciByZXQgPSBbXQoKICAgICAgICB2YXIgcmUKICAgICAgICBpZiAocmVnZXhwIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgICAgIHJlID0gbmV3IFJlZ0V4cChyZWdleHAuc291cmNlLCAnZycpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmUgPSBuZXcgUmVnRXhwKHJlZ2V4cCwgJ2cnKQogICAgICAgIH0KICAgICAgICByZS5nbG9iYWwgPSB0cnVlCgogICAgICAgIHZhciBwb3NNYXRjaCA9IDAKICAgICAgICB3aGlsZSAobSA9IHJlLmV4ZWMoc3RyKSkgewogICAgICAgICAgICBpZiAobS5pbmRleCAhPSBwb3NNYXRjaCkgewogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdSZWdleHBGdWxsU2VxdWVuY2VDb3ZlcmFnZScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2Nhbm5vdCBjaGFyYWN0ZXIgYXQgcG9zIFsnICsgcG9zTWF0Y2ggKyAnLScgKyBtLmluZGV4ICsgJ10gKCcgKyBzdHIuc3Vic3RyaW5nKHBvc01hdGNoLCBtLmluZGV4KSArICcpIGluICInICsgc3RyICsgJyIgaXMgbm90IGNvdmVyZWQgYnkgcmVndWxhciBleHByZXNzaW9uICcgKyByZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHBvc01hdGNoID0gcmUubGFzdEluZGV4OwoKICAgICAgICAgICAgcmV0LnB1c2gobSkKICAgICAgICB9CiAgICAgICAgaWYgKHN0ci5sZW5ndGggIT0gcG9zTWF0Y2gpIHsKICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgbmFtZTogJ1JlZ2V4cEZ1bGxTZXF1ZW5jZUNvdmVyYWdlJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdjYW5ub3QgY2hhcmFjdGVyIGF0IHBvcyBbJyArIHBvc01hdGNoICsgJy0nICsgbS5pbmRleCArICddICgnICsgc3RyLnN1YnN0cmluZyhwb3NNYXRjaCwgbS5pbmRleCkgKyAnKSBpbiAiJyArIHN0ciArICciIGlzIG5vdCBjb3ZlcmVkIGJ5IHJlZ3VsYXIgZXhwcmVzc2lvbiAnICsgcmUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0CiAgICB9CgogICAgcmV0dXJuIFJlZ0V4cEZ1bGxTcGxpdGVyCn0pOwoKLyoKICogQW1pbm9BY2lkIG9iamVjdC4KICAqIFByb3BlcnRpZXM6CiAgKiAtIGEgY29kZTEgKG9uZSBsZXR0ZXIpLAogICogLSBhIG1hc3MuCiAgKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9BbWlub0FjaWQnLFsnQmFja2JvbmUnXSwgZnVuY3Rpb24oQmFja2JvbmUpIHsKCiAgICB2YXIgQW1pbm9BY2lkID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBpZEF0dHJpYnV0ZSA6ICdjb2RlMScsCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgICAgIG1hc3MgOiAtMQogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCiAgICAgICAgdG9TdHJpbmcgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ2NvZGUxJyk7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIEFtaW5vQWNpZDsKfSk7CgovKgogKiBhbWlubyBhY2lkIGRlZmluaXRpb24sIGxvYWRlZCBieSBjb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkaWN0aW9uYXJ5CiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvZGF0YS9hbWlub0FjaWRzJyxbXSxmdW5jdGlvbigpIHsKICAgIHJldHVybiBbewogICAgICAgIGNvZGUxIDogIkEiLAogICAgICAgICJtYXNzIiA6IDcxLjAzNzExNAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiUiIsCiAgICAgICAgIm1hc3MiIDogMTU2LjEwMTExMQogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiTiIsCiAgICAgICAgIm1hc3MiIDogMTE0LjA0MjkyNwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiRCIsCiAgICAgICAgIm1hc3MiIDogMTE1LjAyNjk0MwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiQyIsCiAgICAgICAgIm1hc3MiIDogMTAzLjAwOTE4NQogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiRSIsCiAgICAgICAgIm1hc3MiIDogMTI5LjA0MjU5MwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiUSIsCiAgICAgICAgIm1hc3MiIDogMTI4LjA1ODU3OAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiRyIsCiAgICAgICAgIm1hc3MiIDogNTcuMDIxNDY0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJIIiwKICAgICAgICAibWFzcyIgOiAxMzcuMDU4OTEyCiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJJIiwKICAgICAgICAibWFzcyIgOiAxMTMuMDg0MDY0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJMIiwKICAgICAgICAibWFzcyIgOiAxMTMuMDg0MDY0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJLIiwKICAgICAgICAibWFzcyIgOiAxMjguMDk0OTYzCiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJNIiwKICAgICAgICAibWFzcyIgOiAxMzEuMDQwNDg1CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJGIiwKICAgICAgICAibWFzcyIgOiAxNDcuMDY4NDE0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJQIiwKICAgICAgICAibWFzcyIgOiA5Ny4wNTI3NjQKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlMiLAogICAgICAgICJtYXNzIiA6IDg3LjAzMjAyOAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiVCIsCiAgICAgICAgIm1hc3MiIDogMTAxLjA0NzY3OQogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiVyIsCiAgICAgICAgIm1hc3MiIDogMTg2LjA3OTMxMwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiWSIsCiAgICAgICAgIm1hc3MiIDogMTYzLjA2MzMyCiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJWIiwKICAgICAgICAibWFzcyIgOiA5OS4wNjg0MTQKICAgIH1dCn0pOwoKLyoKICogQSBzaW5nbGV0b24gYW1pbm8gYWNpZCBkaWN0aW9uYXJ5LCBsb2FkZWQgZnJvbSBqc29uIGZpbCBkYXRhL2FtaW5vQWNpZC5qcwogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsWydmaXNodG9uZXMvbW9kZWxzL2RyeS9BbWlub0FjaWQnLCAnZmlzaHRvbmVzL2RhdGEvYW1pbm9BY2lkcyddLCBmdW5jdGlvbihBbWlub0FjaWQsIGJzX2FtaW5vYWNpZHMpIHsKICAgIHZhciBBbWlub0FjaWREaWN0aW9uYXJ5ID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewoKICAgICAgICBtb2RlbCA6IEFtaW5vQWNpZCwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5hZGQoYnNfYW1pbm9hY2lkcyk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbmV3IEFtaW5vQWNpZERpY3Rpb25hcnkoKTsKfSk7CgovKgogKiBBIFJlc2lkdWVNb2RpZmljYXRpb24gUE9KTywgd2lodCBwcm9wZXJ0aWVzCiAqICAtIG5hbWUgKHVuaXF1ZSBhY3Jvc3MgdGhlIGRpY3Rpb25hcnkKICogIC0gbWFzcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbicsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZSddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSkgewoKICAgIHZhciBSZXNpZHVlTW9kaWZpY2F0aW9uID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBpZEF0dHJpYnV0ZTonbmFtZScsCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgICAgIG1hc3MgOiAtMQogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCiAgICAgICAgdG9TdHJpbmcgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ25hbWUnKSArICcoJytzZWxmLmdldCgnbWFzcycpKycpJzsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gUmVzaWR1ZU1vZGlmaWNhdGlvbjsKfSk7CgovKgogKiBhIGpzb24gcG9ydCBvZiBVbmltb2QgKyBzb21lIGN1c3RvbSBtb2RpZnMuCiAqIGxvYWRlZCBieSBjb2xsZWN0aW9ucy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbkRpY3Rpb25hcnkKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9kYXRhL3Jlc2lkdWVNb2RpZmljYXRpb25zJyxbXSxmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUElDIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBJQyIsCiAgICAgICAgICAgICJtYXNzIjogMTE5LjAzNzExNCwKICAgICAgICAgICAgZm9ybXVsYTogJ0M3T05INScKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUElDX0hFQVZZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBJQ19IRUFWWSIsCiAgICAgICAgICAgICJtYXNzIjogMTI1LjA1NzI0Mjk4LAogICAgICAgICAgICBmb3JtdWxhOiAnQzdPTkg1JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tQSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tQSIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMDcwOTk0MDY2LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tQyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tQyIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMDcwOTk0MDY2LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tRCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tRCIsCiAgICAgICAgICAgICJtYXNzIjogNS4wMTA0NTQyNDQ0LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tRSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tRSIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkwODIyLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tRiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tRiIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDI3MjI4NDMzNCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tIiwKICAgICAgICAgICAgIm1hc3MiOiAzLjAwMzc0NDU2ODgsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1IIiwKICAgICAgICAgICAgIm1hc3MiOiA5LjAxMTIzMzcwNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUkiLAogICAgICAgICAgICAibWFzcyI6IDcuMDE3MTYzOTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUsiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUsiLAogICAgICAgICAgICAibWFzcyI6IDguMDE0MTk4ODEzMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tTCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tTCIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTcxNjM5MgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tTSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tTSIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkwODIyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1OIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAwNzQ4OTEzNzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLVAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLVAiLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5MDgyMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tUSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tUSIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTA4NDM5NzU0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1SIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMDgyNjg1OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1TIiwKICAgICAgICAgICAgIm1hc3MiOiA0LjAwNzA5OTQwNjYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLVQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLVQiLAogICAgICAgICAgICAibWFzcyI6IDUuMDEwNDU0MjQ0NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tViIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkwODIyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1XIiwKICAgICAgICAgICAgIm1hc3MiOiAxMy4wMzA5NzMwMDIyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1ZIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMjcyMjg0MzM0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFjZXR5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBY2V0eWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDEwNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFtaWRhdGVkIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFtaWRhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogLTAuOTg0MDE2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJpb3RpbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCaW90aW55bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyMjYuMDc3NTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhcmJhbWlkb21ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJb2RvYWNldGFtaWRlIGRlcml2YXRpdmUiLAogICAgICAgICAgICAibWFzcyI6IDU3LjAyMTQ2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDYXJiYW15bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDYXJiYW15bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA0My4wMDU4MTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ2FyYm94eW1ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJb2RvYWNldGljIGFjaWQgZGVyaXZhdGl2ZSIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDA1NDc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRlYW1pZGF0ZWQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRGVhbWlkYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDAuOTg0MDE2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk1ldC0+SHNlIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhvbW9zZXJpbmUiLAogICAgICAgICAgICAibWFzcyI6IC0yOS45OTI4MDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTWV0LT5Ic2wiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSG9tb3NlcmluZSBsYWN0b25lIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDguMDAzMzcxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk5JUENBTSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOLWlzb3Byb3B5bGNhcmJveGFtaWRvbWV0aHlsIiwKICAgICAgICAgICAgIm1hc3MiOiA5OS4wNjg0MTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUGhvc3BobyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaG9zcGhvcnlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDc5Ljk2NjMzMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEZWh5ZHJhdGVkIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkRlaHlkcmF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTguMDEwNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlByb3Bpb25hbWlkZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBY3J5bGFtaWRlIGFkZHVjdCIsCiAgICAgICAgICAgICJtYXNzIjogNzEuMDM3MTE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlB5cm8tY2FyYmFtaWRvbWV0aHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlMtY2FyYmFtb3lsbWV0aHlsY3lzdGVpbmUgY3ljbGl6YXRpb24gKE4tdGVybWludXMpIiwKICAgICAgICAgICAgIm1hc3MiOiAzOS45OTQ5MTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2x1LT5weXJvLUdsdSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQeXJvLWdsdSBmcm9tIEUiLAogICAgICAgICAgICAibWFzcyI6IC0xOC4wMTA1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2xuLT5weXJvLUdsdSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQeXJvLWdsdSBmcm9tIFEiLAogICAgICAgICAgICAibWFzcyI6IC0xNy4wMjY1NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ2F0aW9uOk5hIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNvZGl1bSBhZGR1Y3QiLAogICAgICAgICAgICAibWFzcyI6IDIxLjk4MTk0MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQeXJpZHlsZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUy1weXJpZHlsZXRoeWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMTA1LjA1Nzg0OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0aHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk94aWRhdGlvbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJPeGlkYXRpb24gb3IgSHlkcm94eWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTk0OTE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRpbWV0aHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImRpLU1ldGh5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRyaW1ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJ0cmktTWV0aHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDQyLjA0Njk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk1ldGh5bHRoaW8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmV0YS1tZXRoeWx0aGlvbGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA0NS45ODc3MjEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiU3VsZm8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTy1TdWxmb25hdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNzkuOTU2ODE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIZXhvc2UiLAogICAgICAgICAgICAibWFzcyI6IDE2Mi4wNTI4MjMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSGV4TkFjIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk4tQWNldHlsaGV4b3NhbWluZSIsCiAgICAgICAgICAgICJtYXNzIjogMjAzLjA3OTM3MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNeXJpc3RveWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTXlyaXN0b3lsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDIxMC4xOTgzNjYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR3VhbmlkaW55bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHdWFuaWRpbmF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wMjE3OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUHJvcGlvbnlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlByb3Bpb25hdGUgbGFiZWxpbmcgcmVhZ2VudCBsaWdodCBmb3JtIChOLXRlcm0gJiBLKSIsCiAgICAgICAgICAgICJtYXNzIjogNTYuMDI2MjE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlByby0+cHlyby1HbHUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAicHJvbGluZSBveGlkYXRpb24gdG8gcHlyb2dsdXRhbWljIGFjaWQiLAogICAgICAgICAgICAibWFzcyI6IDEzLjk3OTI2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOSFMtTEMtQmlvdGluIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk5IUy1MQy1CaW90aW4iLAogICAgICAgICAgICAibWFzcyI6IDMzOS4xNjE2NjIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSUNBVC1DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFwcGxpZWQgQmlvc3lzdGVtcyBjbGVhdmFibGUgSUNBVChUTSkgbGlnaHQiLAogICAgICAgICAgICAibWFzcyI6IDIyNy4xMjY5OTEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSUNBVC1DOjEzQyg5KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcHBsaWVkIEJpb3N5c3RlbXMgY2xlYXZhYmxlIElDQVQoVE0pIGhlYXZ5IiwKICAgICAgICAgICAgIm1hc3MiOiAyMzYuMTU3MTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk5ldGh5bG1hbGVpbWlkZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOLWV0aHlsbWFsZWltaWRlIG9uIGN5c3RlaW5lcyIsCiAgICAgICAgICAgICJtYXNzIjogMTI1LjA0NzY3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHbHlHbHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAidWJpcXVpdGlueWxhdGlvbiByZXNpZHVlIiwKICAgICAgICAgICAgIm1hc3MiOiAxMTQuMDQyOTI3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkZvcm15bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJGb3JteWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjcuOTk0OTE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleCgxKUhleE5BYygxKU5ldUFjKDIpIChTVCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGV4MUhleE5BYzFOZXVBYzIgKFNUKSIsCiAgICAgICAgICAgICJtYXNzIjogOTQ3LjMyMzAyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEaW1ldGh5bDoySCg2KTEzQygyKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJkaW1ldGh5bGF0ZWQgYXJnaW5pbmUiLAogICAgICAgICAgICAibWFzcyI6IDM2LjA3NTY3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRlbHRhOkgoNClDKDIpTygtMSlTKDEpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlMtRXRoeWxjeXN0aW5lIGZyb20gU2VyaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wMDg0NTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MTNDKDYpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQyg2KSBTaWxhYyBsYWJlbCIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMjAxMjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MThPKDIpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk8xOCBsYWJlbCBhdCBib3RoIEMtdGVybWluYWwgb3h5Z2VucyIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMDg0OTEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiaVRSQVE0cGxleCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJSZXByZXNlbnRhdGl2ZSBtYXNzIGFuZCBhY2N1cmF0ZSBtYXNzIGZvciAxMTYgJiAxMTciLAogICAgICAgICAgICAibWFzcyI6IDE0NC4xMDIwNjMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MThPKDEpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk8xOCBMYWJlbGluZyIsCiAgICAgICAgICAgICJtYXNzIjogMi4wMDQyNDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MTNDKDYpMTVOKDIpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQyg2KSAxNU4oMikgU2lsYWMgbGFiZWwiLAogICAgICAgICAgICAibWFzcyI6IDguMDE0MTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg2KTE1Tig0KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoNikgMTVOKDQpIFNpbGFjIGxhYmVsIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMDgyNjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MTNDKDkpMTVOKDEpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQyg5KSAxNU4oMSkgU2lsYWMgbGFiZWwiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyNzIyOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMYWJlbDoxM0MoNSkxNU4oMSkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDKDUpIDE1TigxKSBTaWxhYyBsYWJlbCIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTml0cm9zeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUy1uaXRyb3N5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC45OTAxNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQUVCUyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbWlub2V0aHlsYmVuemVuZXN1bGZvbnlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDE4My4wMzUzOTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRXRoYW5vbHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkV0aGFub2xhdGlvbiBvZiBDeXMiLAogICAgICAgICAgICAibWFzcyI6IDQ0LjAyNjIxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFdGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJFdGh5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhcmJveHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ2FyYm94eWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDMuOTg5ODI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk5ldGh5bG1hbGVpbWlkZSt3YXRlciIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOZXRoeWxtYWxlaW1pZGVoeWRyb2x5c2lzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNDMuMDU4MjQzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDUEw6MTNDKDYpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJydWtlciBEYWx0b25pY3MgU0VSVkEtSUNQTChUTSkgcXVhbnRpZmljYXRpb24gY2hlbWlzdHJ5LCBoZWF2eSBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxMTEuMDQxNTkzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDUEwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQnJ1a2VyIERhbHRvbmljcyBTRVJWQS1JQ1BMKFRNKSBxdWFudGlmaWNhdGlvbiBjaGVtaXN0cnksIGxpZ2h0IGZvcm0iLAogICAgICAgICAgICAibWFzcyI6IDEwNS4wMjE0NjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGVoeWRybyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIYWxmIG9mIGEgZGlzdWxmaWRlIGJyaWRnZSIsCiAgICAgICAgICAgICJtYXNzIjogLTEuMDA3ODI1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkh5cHVzaW5lIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImh5cHVzaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA4Ny4wNjg0MTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQW1tb25pYS1sb3NzIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxvc3Mgb2YgYW1tb25pYSIsCiAgICAgICAgICAgICJtYXNzIjogLTE3LjAyNjU0OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHbHVjb3N5bGdhbGFjdG9zeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiZ2x1Y29zeWxnYWxhY3Rvc3lsIGh5ZHJveHlseXNpbmUiLAogICAgICAgICAgICAibWFzcyI6IDM0MC4xMDA1NjIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGlveGlkYXRpb24iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiZGloeWRyb3h5IiwKICAgICAgICAgICAgIm1hc3MiOiAzMS45ODk4MjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSGV4TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIZXhvc2FtaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAxNjEuMDY4ODA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjJIKDQpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjQsNCw1LDUtRDQgTHlzaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA0LjAyNTEwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEaW1ldGh5bDoySCg0KTEzQygyKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJEaU1ldGh5bC1DMTNIRDIiLAogICAgICAgICAgICAibWFzcyI6IDM0LjA2MzExNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNYWxlaW1pZGUtUEVPMi1CaW90aW4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWFsZWltaWRlLVBFTzItQmlvdGluIiwKICAgICAgICAgICAgIm1hc3MiOiA1MjUuMjI1NzE5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFsYS0+U2VyIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYS0+U2VyIHN1YnN0aXR1dGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTk0OTE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRoci0+SWxlIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRoci0+SWxlIHN1YnN0aXR1dGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMTIuMDM2Mzg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDUEw6MkgoNCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQnJ1a2VyIERhbHRvbmljcyBTRVJWQS1JQ1BMKFRNKSBxdWFudGlmaWNhdGlvbiBjaGVtaXN0cnksIG1lZGl1bSBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxMDkuMDQ2NTcxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogImlUUkFROHBsZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUmVwcmVzZW50YXRpdmUgbWFzcyBhbmQgYWNjdXJhdGUgbWFzcyBmb3IgMTEzLCAxMTQsIDExNiAmIDExNyIsCiAgICAgICAgICAgICJtYXNzIjogMzA0LjIwNTM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg2KTE1TigxKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoNikgMTVOKDEpIFNpbGFjIGxhYmVsIiwKICAgICAgICAgICAgIm1hc3MiOiA3LjAxNzE2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUTVQ2cGxleCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIiLAogICAgICAgICAgICAibWFzcyI6IDIyOS4xNjI5MzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVE1UMnBsZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVE1UMnBsZXggYnkgVGhlcm1vIiwKICAgICAgICAgICAgIm1hc3MiOiAyMjUuMTU1ODMzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRNVCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIiLAogICAgICAgICAgICAibWFzcyI6IDIyNC4xNTI0NzgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRXhhY1RhZ1RoaW9sIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkV4YWNUYWcgVGhpb2wgbGFiZWwgbWFzcyBmb3IgMi00LTctMTAgcGxleCIsCiAgICAgICAgICAgICJtYXNzIjogOTcyLjM2NTIxOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFeGFjVGFnQW1pbmUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRXhhY1RhZyBBbWluZSBsYWJlbCBtYXNzIGZvciAyLTQtNy0xMCBwbGV4IiwKICAgICAgICAgICAgIm1hc3MiOiAxMDMwLjM1Mjk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFyZ0dseUdseSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJVYmlxdWl0aW5hdGlvbiBSR0ciLAogICAgICAgICAgICAibWFzcyI6IDI3MC4xNDQwMzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiU3VsZm8tTkhTLVNTLUJpb3RpbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJFWi1MaW5rIFN1bGZvLU5IUy1TUy1CaW90aW4gKFBpZXJjZSkiLAogICAgICAgICAgICAibWFzcyI6IDM4OS4wOTAxNTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQlBBIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUiLAogICAgICAgICAgICAibWFzcyI6IDI2OC4wOTczNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQlBBX0FJTFYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmVuem95YWwgUGhlbnlsYWxhbmluZSBBSUxWIiwKICAgICAgICAgICAgIm1hc3MiOiAyNjguMDk3MzY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQV9TVEROIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUgU1RETiIsCiAgICAgICAgICAgICJtYXNzIjogMjY4LjA5NzM2OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCUEFfUFdZRiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCZW56b3lhbCBQaGVueWxhbGFuaW5lIFBXWUYiLAogICAgICAgICAgICAibWFzcyI6IDI2OC4wOTczNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQlBBX1JFQ1EiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmVuem95YWwgUGhlbnlsYWxhbmluZSBSRUNRIiwKICAgICAgICAgICAgIm1hc3MiOiAyNjguMDk3MzY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQV9HSEtNIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUgR0hLTSIsCiAgICAgICAgICAgICJtYXNzIjogMjY4LjA5NzM2OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTTUNDIGxpbmtlciIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTdWNjaW5pbWlkeWwtNC0oTi1tYWxlaW1pZG9tZXRoeWwpY3ljbG9oZXhhbmUtMS1jYXJib3h5bGF0ZSIsCiAgICAgICAgICAgICJtYXNzIjogMjE5LjA4OTU0MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDSEQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMSwyLUN5Y2xvaGV4YW5lZGlvbmUgYXJnaW5pbmUiLAogICAgICAgICAgICAibWFzcyI6IDExMi4wNTI0MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCRCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxLDItQnV0YW5lZGlvbmUgYXJnaW5pbmUiLAogICAgICAgICAgICAibWFzcyI6IDg2LjAzNjc3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIQS1VYmlxdWl0aW4gVmlueWwgU3VsZm9uZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIQS1VYmlxdWl0aW4gVmlueWwgU3VsZm9uZSIsCiAgICAgICAgICAgICJtYXNzIjogMTIwLjAxMTkyNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIQS1HbHktVWJpcXVpdGluIFZpbnlsIFN1bGZvbmUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSEEtR2x5Y3lsLVViaXF1aXRpbiBWaW55bCBTdWxmb25lIiwKICAgICAgICAgICAgIm1hc3MiOiAxNzcuMDMzMzg4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhcmJhbWlkb21ldGh5bC1EZXV0ZXJhdGVkIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkRldXRlcmF0ZWQgSW9kb2FjZXRhbWlkZSBEZXJpdmF0aXZlIiwKICAgICAgICAgICAgIm1hc3MiOiA1OS4wMzQwMTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUkdHVWJpcSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJVYmlxdWl0aW5hdGlvbiBSR0cgLSBBcmdHbHlHbHkiLAogICAgICAgICAgICAibWFzcyI6IDI3MC4xNDQwMzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiaW9kb2FjZXRhbmlsaWRlIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlvZG9hY2V0YW5pbGlkZSIsCiAgICAgICAgICAgICJtYXNzIjogMTM5LjA3Mjg5MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJwcm9weWxtZXJjYXB0byIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJwcm9weWxtZXJjYXB0byAvIHByb3BhbmV0aGlvbCIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDI0MTA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkdseUdseSAxM0MoNikgMTVOKDIpIEx5cyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJEb3VibGUgbW9kaWZpY2F0aW9uIG9mIFViaXF1aXRpbiBhbmQgTHlzKzguMDIiLAogICAgICAgICAgICAibWFzcyI6IDEyMi4wNTcxMjYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUkVQTGktRE5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkROUCBGcmV0IG1vZGlmaWNhdGlvbiBmb3IgUkVQTGkgcHJvamVjdCIsCiAgICAgICAgICAgICJtYXNzIjogMjUyLjA0OTQ2OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSRVBMaS1NQ0EtSCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJSRVBMaS1NQ0EgQzEySDhPNCIsCiAgICAgICAgICAgICJtYXNzIjogMjE2LjA0MjI1OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRUVFUR0ciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU1VNTyBMeXMtUVFRVEdHIiwKICAgICAgICAgICAgIm1hc3MiOiA1OTkuMjY2MzM5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDUEw6MTNDKDYpMkgoNCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQnJ1a2VyIERhbHRvbmljcyBTRVJWQS1JQ1BMKFRNKSBxdWFudGlmaWNhdGlvbiBjaGVtaXN0cnksIGhlYXZ5IGZvcm0sICsxMCAgeXVrMyAxLTMxLTIwMTEiLAogICAgICAgICAgICAibWFzcyI6IDExNS4wNjY3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIm1UUkFRIGQwIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIm1UUkFRIHJhZ2VudCBieSBBQiBTQ0lFWCwgZGVsdGEgMCBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxNDAuMDk0OTYzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIm1UUkFRIGQ0IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIm1UUkFRIHJhZ2VudCBieSBBQiBTQ0lFWCwgZGVsdGEgKzQgZm9ybSIsCiAgICAgICAgICAgICJtYXNzIjogMTQ0LjEwMjA2MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJtVFJBUSBkOCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJtVFJBUSByYWdlbnQgYnkgQUIgU0NJRVgsIGRlbHRhICs4IGZvcm0iLAogICAgICAgICAgICAibWFzcyI6IDE0OC4xMDkxNjIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSGV4KDEpSGV4TkFjKDEpIChTVCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGV4MUhleE5BYzEgKFNUKSIsCiAgICAgICAgICAgICJtYXNzIjogMzY1LjEzMjE5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIZXgoMSlIZXhOQWMoMSlOZXVBYygxKSAoU1QpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhleDFIZXhOQWMxTmV1QWMxIChTVCkiLAogICAgICAgICAgICAibWFzcyI6IDY1Ni4yMjc2MTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVE1ULUx5c0dseUdseSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUTVQgd2l0aCBVYmlxdWl0aW4gKEdseUdseSkgbW9kaWZpY2F0aW9uIG9uIHNhbWUgcmVzaWR1ZSIsCiAgICAgICAgICAgICJtYXNzIjogMzM4LjE5NTQwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUTVQ2LUx5c0dseUdseSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUTVQgNnBsZXggd2l0aCBVYmlxdWl0aW4gTW9kaWZpY2F0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAzNDMuMjA1ODYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ3JvdG9ueWxhdGlvbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDcm90b255bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA2OC4wMjYyMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTFJMUkdHLUsiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1QXJnTGV1QXJnR2x5R2x5LUx5cyIsCiAgICAgICAgICAgICJtYXNzIjogNjUyLjQxMzI3OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSTFJHRy1LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZ0xldUFyZ0dseUdseS1MeXMiLAogICAgICAgICAgICAibWFzcyI6IDUzOS4zMjkyMTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTFJHRy1LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxSR0cgbW9kaWZpY2F0aW9uIG9uIEx5cyIsCiAgICAgICAgICAgICJtYXNzIjogMzgzLjIyODEwMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX1YiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiYXF1YS1WIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxMzgwOSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlcyBQcm8iLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfUFYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWVzIFBybyBhbmQgVmFsIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxMzgwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0wiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgTGV1IiwKICAgICAgICAgICAgIm1hc3MiOiA3LjAxNzE2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0kiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgSXNvbGV1Y2luZSIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTcxNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIFRociIsCiAgICAgICAgICAgICJtYXNzIjogNS4wMTA0NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0ciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgR2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAzLjAwMzc0NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0YiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgRiIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDI4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfQSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpc290b3BpY2FsbHkgbW9kaWZpZWQgcmVzaWR1ZSBBbGEiLAogICAgICAgICAgICAibWFzcyI6IDQuMDA3MDk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfWXBob3MiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgcGhvc3Bob3J5bGF0ZWQgVHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA4OS45OTM1NTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIFR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDI3MjI4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFjZXR5bF9oZWF2eV9MeXMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWNldHlsX2hlYXZ5X0x5cyIsCiAgICAgICAgICAgICJtYXNzIjogNTAuMDI0NzY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlFFUVRHRyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTVU1PIEx5cy1RRVFUR0ciLAogICAgICAgICAgICAibWFzcyI6IDYwMC4yNTAzNTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTW9ub01ldGh5bFByb3Bpb255bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNb25vTWV0aHlsUHJvcGlvbnlsTHlzaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA3MC4wNDE4NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUHJvcGlvbnlsOjJIKDUpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlByb3Bpb25hdGUgbGFiZWxpbmcgcmVhZ2VudCBwZW50YWRldXRlcmF0ZWQgZm9ybSAoKzVhbXUpLCBOLXRlcm0gJiBLIiwKICAgICAgICAgICAgIm1hc3MiOiA2MS4wNTc1OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2x5R2x5Q2FyYmFteWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ2FyYmFteWxhdGVkIERpZ2x5Y2luZSIsCiAgICAgICAgICAgICJtYXNzIjogMTU3LjA0ODc0MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0QiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgQXNwIiwKICAgICAgICAgICAgIm1hc3MiOiA1LjAxMDQ1NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogODUuMDYzOTk3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiA0My4wMDU4MTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDQzLjk4OTgyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogMzEuOTcyMDcxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiA1OC4wMDU0NzkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogNTcuMDIxNDY0MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wMTU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogNjYuMDIxNzk3OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDQyLjA0Njk0OTk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDQ2OTQ5OTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny4wNTc4NDkwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDYwLjAwMzM3MDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiA3Ni4wMzEyOTk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45OTQ5MTM5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5UaHIiLAogICAgICAgICAgICAibWFzcyI6IDMwLjAxMDU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogMTE1LjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA5Mi4wMjYyMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5WYWwiLAogICAgICAgICAgICAibWFzcyI6IDI4LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC04NS4wNjM5OTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wNTgxODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC00MS4wNzQxNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC01My4wOTE5MjYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC0yNy4wNTg1MTc5OTk5OTk5OTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0yOC4wNDI1MzI5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTk5LjA3OTY0NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogLTE5LjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDMuMDE3MDQ3MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtNDMuMDE3MDQ3MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjguMDA2MTQ3OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAtMjUuMDYwNjI2MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAtOS4wMzI2OTcwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC01OS4wNDgzNDcwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTY5LjA2OTA4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTU1LjA1MzQzMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogMjkuOTc4MjAyMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDYuOTYyMjA5MDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDMyNjk3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDMuMDA1ODEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wNTgxODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDAuOTg0MDE1OTk5OTk5OTk2OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTExLjAzMzc0MjAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMTQuOTk5NjY2MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wMTU2NTEwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC01Ny4wMjE0NjMwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDIzLjAxNTk4NDk5OTk5OTk4NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTAuOTU4ODYzMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMC45NTg4NjMwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDE0LjA1MjAzNjAwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMTYuOTk3NTU3OTk5OTk5OTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAzMy4wMjU0ODY5OTk5OTk5ODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0xNi45OTAxNjMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTI3LjAxMDg5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTIuOTk1MjQ4MDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA3Mi4wMzYzODYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNDkuMDIwMzkzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuOTc0NTEzMDAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDMuOTg5ODI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA0MS4wNzQxNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0wLjk4NDAxNTk5OTk5OTk5NjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0xMi4wMTc3NTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY1MDAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMTMuMDMxNjM1MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTguMDA1NDc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyMi4wMzE5Njg5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTQyODc5MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMS45NDI4NzkwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDEzLjA2ODAyMDAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMTYuMDEzNTQxOTk5OTk5OTg3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAzMi4wNDE0NzA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTE3Ljk3NDE3OTAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTI3Ljk5NDkxNTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTEzLjk3OTI2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNzEuMDUyMzcwMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDQ4LjAzNjM3NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTE1Ljk1ODUyODk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTMxLjk3MjA3MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNTMuMDkxOTI2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAxMS4wMzM3NDIwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDEyLjAxNzc1OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDMzNDA4MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDI1LjA0OTM5MzAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNDUuOTg3NzIxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAzNC4wNDk3MjY5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDc0ODc4OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wNzQ4Nzg5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDI1LjA4NTc3ODAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMjguMDMxMjk5OTk5OTk5OTg3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wNTkyMjg5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTUuOTU2NDIxMDAwMDAwMDA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTc3MTU3MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMS45NjE1MDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDgzLjA3MDEyODAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA2MC4wNTQxMzUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0zLjk0MDc3MDk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTU4LjAwNTQ3OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy4wNTg1MTc5OTk5OTk5OTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0xNC45OTk2NjYwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wMTU2NTAwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wMzM0MDgwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTAuOTg0MDE0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTcyLjAyMTEyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogOC4wMTYzMTg5OTk5OTk5ODIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0xNS45NTg1MjkwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0xNS45NTg1MjkwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC0wLjk0NzYzMDAwMDAwMDAwMzcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDEuOTk3ODkxOTk5OTk5OTc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAxOC4wMjU4MjA5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTMxLjk4OTgyOTAwMDAwMDAxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTQyLjAxMDU2NTAwMDAwMDAxNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTI3Ljk5NDkxNDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny4wMzY3MgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMzQuMDIwNzI2OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjkuOTc0MTc5MDAwMDAwMDA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDIxNDY0MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5BcmciLAogICAgICAgICAgICAibWFzcyI6IDI4LjA0MjUzMjk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDE1NjUxMDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTMuMDMxNjM1MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjUuMDQ5MzkzMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDAuOTg0MDE0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTcxLjAzNzExNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogOS4wMDAzMzM5OTk5OTk5ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0xNC45NzQ1MTQwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0xNC45NzQ1MTQwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDAuMDM2Mzg0OTk5OTk5OTk1NjcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDIuOTgxOTA2OTk5OTk5OTc4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMTkuMDA5ODM1OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0zMS4wMDU4MTQwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC00MS4wMjY1NTAwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDIwNzM1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiAzNS4wMDQ3NDE5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTI4Ljk5MDE2NDAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDk5LjA3OTY0NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogNTcuMDIxNDYzMDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiA1OC4wMDU0NzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDQ1Ljk4NzcyMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogNzIuMDIxMTI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiA3MS4wMzcxMTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDgwLjAzNzQ0Nzk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ni4wNjI1OTk5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5MZXUiLAogICAgICAgICAgICAibWFzcyI6IDU2LjA2MjU5OTk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5Pkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogNzEuMDczNDk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiA3NC4wMTkwMjA5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogOTAuMDQ2OTQ5OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IDQwLjAzMTI5OTk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PlNlciIsCiAgICAgICAgICAgICJtYXNzIjogMzAuMDEwNTYzOTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wMjYyMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDEyOS4wNTc4NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDEwNi4wNDE4NTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5WYWwiLAogICAgICAgICAgICAibWFzcyI6IDQyLjA0Njk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNjYuMDIxNzk3OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5BcmciLAogICAgICAgICAgICAibWFzcyI6IDE5LjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjMuMDE1OTg0OTk5OTk5OTg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjIuMDMxOTY4OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0zNC4wNDk3MjY5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogLTguMDE2MzE4OTk5OTk5OTgyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAtOS4wMDAzMzM5OTk5OTk5ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC04MC4wMzc0NDc5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTIzLjk3NDg0Nzk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTIzLjk3NDg0Nzk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTguOTYzOTQ4OTk5OTk5OTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAtNi4wMTg0MjcwMDAwMDAwMDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAwOTUwMTk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTQwLjAwNjE0Nzk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTUwLjAyNjg4Mzk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTM2LjAxMTIzMjk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA0OS4wMjA0MDEwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDA0NDA4MDAwMDAwMDEyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzcuOTkwNDk3OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wNDY5NDk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDQzLjAxNzA0NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMC45NTg4NjMwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDEuOTQyODc5MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTAuMDc0ODc4OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45NTg1MjkwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDE0Ljk3NDUxNDAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTU2LjA2MjU5OTk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMjMuOTc0ODQ3OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS4wMTA4OTkwMDAwMDAwMDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDE3Ljk1NjQyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAzMy45ODQzNDk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTE2LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wNTIwMzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0xMi4wMzYzODQ5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDcyLjk5NTI0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA0OS45NzkyNTYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTE0LjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTQyLjA0Njk0OTk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNDMuMDE3MDQ3MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk1ODg2MzAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogMS45NDI4NzkwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0xMC4wNzQ4Nzg5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDE1Ljk1ODUyOTAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMTQuOTc0NTE0MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTYuMDYyNTk5OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyMy45NzQ4NDc5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDE1LjAxMDg5OTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1Pk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMTcuOTU2NDIwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDMzLjk4NDM0OTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTYuMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTI2LjA1MjAzNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTEyLjAzNjM4NDk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNzIuOTk1MjQ5MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDQ5Ljk3OTI1NjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDU3ODQ5MDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wMDYxNDc5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wNTIwMzYwMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC0xMy4wNjgwMjAwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0yNS4wODU3NzgwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDAuOTQ3NjMwMDAwMDAwMDAzNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTAuMDM2Mzg0OTk5OTk5OTk1NjcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC03MS4wNzM0OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDguOTYzOTQ4OTk5OTk5OTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuMDEwODk5MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuMDEwODk5MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAyLjk0NTUyMTk5OTk5OTk4MjcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDE4Ljk3MzQ1MDk5OTk5OTk4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTMxLjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDEuMDYyOTM1MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy4wNDcyODQwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDU3Ljk4NDM1MDAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMzQuOTY4MzU3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjkuMDI2NTQ5MDAwMDAwMDAzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNjAuMDAzMzcwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5BcmciLAogICAgICAgICAgICAibWFzcyI6IDI1LjA2MDYyNjAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogLTE2Ljk5NzU1Nzk5OTk5OTk4NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTE2LjAxMzU0MTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTI4LjAzMTI5OTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTk3ODkxOTk5OTk5OTc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMi45ODE5MDY5OTk5OTk5NzgzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNzQuMDE5MDIwOTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDYuMDE4NDI3MDAwMDAwMDAzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTcuOTU2NDIwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0xNy45NTY0MjA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0Pkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTIuOTQ1NTIxOTk5OTk5OTgyNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMTYuMDI3OTI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzMuOTg3NzIwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC00NC4wMDg0NTY5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTI5Ljk5MjgwNTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNTUuMDM4ODI4MDAwMDAwMDI0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiAzMi4wMjI4MzUwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0zMS45NzIwNzA5OTk5OTk5ODUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC03Ni4wMzEyOTk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogOS4wMzI2OTcwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0zMy4wMjU0ODY5OTk5OTk5ODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC0zMi4wNDE0NzA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTQ0LjA1OTIyODk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTguMDI1ODIwOTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0xOS4wMDk4MzU5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTkwLjA0Njk0OTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTAuMDA5NTAxOTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzMuOTg0MzQ5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0zMy45ODQzNDk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTE4Ljk3MzQ1MDk5OTk5OTk4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogLTE2LjAyNzkyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTUwLjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTYwLjAzNjM4NTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDYuMDIwNzM0OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDM5LjAxMDg5OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45OTQ5MDYwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC00Ny45OTk5OTk5OTk5OTk5ODYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5BcmciLAogICAgICAgICAgICAibWFzcyI6IDU5LjA0ODM0NzAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAxNi45OTAxNjMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogMTcuOTc0MTc5MDAwMDAwMDA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ljk1NjQyMTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMzEuOTg5ODI5MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAzMS4wMDU4MTQwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC00MC4wMzEyOTk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDQwLjAwNjE0Nzk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogMTYuMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMTYuMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogMzEuMDQyMTk5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDMzLjk4NzcyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiA1MC4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0xMC4wMjA3MzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5UaHIiLAogICAgICAgICAgICAibWFzcyI6IDMuOTk0OTE1MDAwMDAwMDA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA4OS4wMjY1NDkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNjYuMDEwNTU2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5WYWwiLAogICAgICAgICAgICAibWFzcyI6IDIuMDE1NjUwMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTk0OTEzOTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA2OS4wNjkwODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5Bc24iLAogICAgICAgICAgICAibWFzcyI6IDI3LjAxMDg5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy45OTQ5MTUwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDE1Ljk3NzE1NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDEwNTY1MDAwMDAwMDE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiA0MS4wMjY1NTAwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC0zMC4wMTA1NjM5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDUwLjAyNjg4Mzk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDUyMDM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAyNi4wNTIwMzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDQxLjA2MjkzNTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wMDg0NTY5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNjAuMDM2Mzg1OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyMDczNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPlRociIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjUxMDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA5OS4wNDcyODUwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNzYuMDMxMjkyMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5WYWwiLAogICAgICAgICAgICAibWFzcyI6IDEyLjAzNjM4NjAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTMwLjAxMDU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNTUuMDUzNDMyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAxMi45OTUyNDgwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDEzLjk3OTI2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogMS45NjE1MDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDI3Ljk5NDkxNDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ0LjAyNjIxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMzYuMDExMjMyOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDEyLjAzNjM4NDk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMTIuMDM2Mzg0OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy4wNDcyODQwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDI5Ljk5MjgwNTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNDYuMDIwNzM0OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0zLjk5NDkxNTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTE0LjAxNTY1MTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogODUuMDMxNjM0MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDYyLjAxNTY0MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTc5MjY0OTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTE1LjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjkuOTc4MjAyMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC03Mi4wMzYzODYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTcxLjA1MjM3MDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtODMuMDcwMTI4MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC01Ny4wMzY3MgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTU4LjAyMDczNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTEyOS4wNTc4NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5IaXMiLAogICAgICAgICAgICAibWFzcyI6IC00OS4wMjA0MDEwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTcyLjk5NTI0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtNzIuOTk1MjQ5MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC01Ny45ODQzNTAwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5NZXQiLAogICAgICAgICAgICAibWFzcyI6IC01NS4wMzg4MjgwMDAwMDAwMjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5QaGUiLAogICAgICAgICAgICAibWFzcyI6IC0zOS4wMTA4OTkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTg5LjAyNjU0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtOTkuMDQ3Mjg1MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC04NS4wMzE2MzQwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogLTIzLjAxNTk5MzAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtODcuMDEwODk5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC05Mi4wMjYyMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5BcmciLAogICAgICAgICAgICAibWFzcyI6IC02Ljk2MjIwOTAwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogLTQ5LjAyMDM5MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTQ4LjAzNjM3NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTYwLjA1NDEzNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogLTM0LjAyMDcyNjk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTM1LjAwNDc0MTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTA2LjA0MTg1NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogLTI2LjAwNDQwODAwMDAwMDAxMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ5Ljk3OTI1NjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtNDkuOTc5MjU2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC0zNC45NjgzNTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5NZXQiLAogICAgICAgICAgICAibWFzcyI6IC0zMi4wMjI4MzUwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5QaGUiLAogICAgICAgICAgICAibWFzcyI6IC0xNS45OTQ5MDYwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC02Ni4wMTA1NTYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTc2LjAzMTI5MjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNjIuMDE1NjQxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiAyMy4wMTU5OTMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTYzLjk5NDkwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTI4LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5BcmciLAogICAgICAgICAgICAibWFzcyI6IDU3LjAzMjY5NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMTQuOTc0NTEzMDAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45NTg1Mjg5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDMuOTQwNzcwOTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAyOS45NzQxNzkwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDI4Ljk5MDE2NDAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTQyLjA0Njk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAzNy45OTA0OTc5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDI5LjAyNjU0OTAwMDAwMDAwMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMzEuOTcyMDcwOTk5OTk5OTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiA0Ny45OTk5OTk5OTk5OTk5ODYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0yLjAxNTY1MDAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTEyLjAzNjM4NjAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPlRociIsCiAgICAgICAgICAgICJtYXNzIjogMS45NzkyNjQ5OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDg3LjAxMDg5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA2My45OTQ5MDYKICAgICAgICB9CiAgICBdCn0pOwoKLyoKICogQSBzaW5nbGV0b24gZGljdGlvbmFyeSBmb3IgcmVzaWR1ZSBtb2RpZmljYXRpb25zLCBsb2FkZWQgZnJvbSBkYXRhL3Jlc2l1ZU1vZGlmaWNhdGlvbnMuanMsIGEgdHJhbnNmb3JtIGZyb20gVW5pbW9kLAogKiBidXQgYW55IG1vZGlmaWNhdGlvbiBjYW4gYmUgYWRkZWQgYXMgbG9uZyBhcyB0aGUgbmFtZSBpcyB1bmlxdWUuCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbkRpY3Rpb25hcnknLFsgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb24nLCAnZmlzaHRvbmVzL2RhdGEvcmVzaWR1ZU1vZGlmaWNhdGlvbnMnXSwgZnVuY3Rpb24oQmFja2JvbmUsIFJlc2lkdWVNb2RpZmljYXRpb24sIGJzX3Jlc21vZCkgewogICAgdmFyIFJlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5ID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewoKICAgICAgICBtb2RlbCA6IFJlc2lkdWVNb2RpZmljYXRpb24sCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuYWRkKGJzX3Jlc21vZCk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbmV3IFJlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5KCk7Cn0pOwoKLyoKICogUmljaFNlcXVlbmNlIGlzIHRoZSBleHByZXNzaW9uIG9mIGEgcGVwdGlkZSwgd2l0aCBtb2RpZmljYXRpb25zLiBJdCBpcyBjZXJ0YWlubHkgb25lIG9mIHRoZSBtb3N0IHVzZWQgY2xhc3MgYW1vbmcgZmlzaFRvbmVzLWpzLgogKiBJdCBob2xkIHRoZSBwZXB0aWRlIHNlcXVlbmNlLCB3aXRoIGFueSBudW1iZXIgb2YgcG9zc2libGUgbW9kaWZpY2F0aW9uIG9uIGEgYW1pbm8gYWNpZC4KICogSXQgYWxzbyBob2xkcyBDL04tdGVybXMgbW9kaWZpY2F0aW9uKHMpIChtdWx0aXBsZSBjYW4gYWxzbyBhcHBseSBvbiB0aGUgdGVybWluaS4KICogVGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBub3QgZG9uZSB3aXRoIHNwZWVkIGluIG1pbmQsIGJ1dCB2ZXJzYXRpbGl0eSBvZiB1c2UuCiAqCiAqIEEgUmljaFNlcXVlbmNlIG9iamVjdCB3aWxsIGNvbnRhaW5zIGEgJ3NlcXVlbmNlJyBwcm9wZXJ0aWVzIHdoaWNoIGlzIGFuIGFycmF5IG9mIHthYTp4LCBtb2RpZmljYXRpb25zOltdfQogKgogKiBXaGVuIGdldHRpbmcgbW9kaWZpY2F0aW9uIHBlciBwb3NpdGlvbnMgb24gYSBwZXB0aWRlIG9mIGxlbmd0aCBsOgogKiAwIC0+IG1vZGlmIG9uZSB0aGUgZmlyc3QgYW1pbm8gYWNpZAogKiBsLTEgLT4gb24gdGhlIGxhc3QgYW1pbm8gYWNpZAogKiAtMSAtPiBOVGVybQogKiBsIC0+IENUZXJtCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9SaWNoU2VxdWVuY2UnLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL3V0aWxzL1JlZ0V4cEZ1bGxTcGxpdGVyJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5JywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb24nXSwgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBSZWdFeHBGdWxsU3BsaXRlciwgZGljb0FBLCBkaWNvUmVzTW9kLCBSZXNpZHVlTW9kaWZpY2F0aW9uKSB7CgogICAgdmFyIFJpY2hTZXF1ZW5jZSA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICAgICAgc2VxdWVuY2U6IFtdCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgfSwKCiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSaWNoU2VxdWVuY2UoKS5mcm9tU3RyaW5nKHRoaXMudG9TdHJpbmcoKSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGdldCB0aGUgbW9kaWZpY2F0aW9uIGFycmF5IGZvciBhIGdpdmVuIGFtaW5vIGFjaWQgcG9zaXRpb24KICAgICAgICAgKiBAcGFyYW0gcG9zCiAgICAgICAgICogQHBhcmFtIGNyZWF0ZSA6IGNyZWF0ZSBzdWNoIGFuIGFycnlhIG9uIHRoZSBvYmplY3QgaWYgaXQgd2FzIG5vdCBleGlzdGluZyBbZGVmYXVsdCBmYWxzZV0KICAgICAgICAgKiBAcmV0dXJuIHsqfQogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgZ2V0TW9kaWZpY2F0aW9uQXJyYXk6IGZ1bmN0aW9uIChwb3MsIGNyZWF0ZSkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEpIHsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmdldCgnblRlcm1Nb2RpZmljYXRpb25zJykgPT09IHVuZGVmaW5lZCAmJiBjcmVhdGUpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldCgnblRlcm1Nb2RpZmljYXRpb25zJywgW10pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwb3MgPT0gc2VsZi5zaXplKCkpIHsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmdldCgnY1Rlcm1Nb2RpZmljYXRpb25zJykgPT09IHVuZGVmaW5lZCAmJiBjcmVhdGUpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldCgnY1Rlcm1Nb2RpZmljYXRpb25zJywgW10pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghc2VsZi5nZXQoJ3NlcXVlbmNlJylbcG9zXS5tb2RpZmljYXRpb25zICYmIGNyZWF0ZSkgewogICAgICAgICAgICAgICAgc2VsZi5nZXQoJ3NlcXVlbmNlJylbcG9zXS5tb2RpZmljYXRpb25zID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdzZXF1ZW5jZScpW3Bvc10ubW9kaWZpY2F0aW9uczsKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBzZXQgdGhlIG1vZmljaWF0aW9uIGFycmF5CiAgICAgICAgICogQHBhcmFtIHBvcwogICAgICAgICAqIEBwYXJhbSBtb2RpZmFycmF5CiAgICAgICAgICogQHJldHVybiB0aGlzCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKi8KICAgICAgICBzZXRNb2RpZmljYXRpb25BcnJheTogZnVuY3Rpb24gKHBvcywgbW9kaWZhcnJheSkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEpIHsKICAgICAgICAgICAgICAgIHNlbGYuc2V0KCduVGVybU1vZGlmaWNhdGlvbnMnLCBtb2RpZmFycmF5KTsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocG9zID09IHNlbGYuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldCgnY1Rlcm1Nb2RpZmljYXRpb25zJywgbW9kaWZhcnJheSkKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzZWxmLmdldCgnc2VxdWVuY2UnKVtwb3NdLm1vZGlmaWNhdGlvbnMgPSBtb2RpZmFycmF5OwogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBhZGQgb25lIG1vZGlmaWNhdGlvbiBvciBhbiBhcnJheSBvZiBtb2RpZiBhdCBhIGdpdmVuIHBvc2l0aW9uIHRvIHRoZSBleGlzaXRpbmcgbGlzdC4KICAgICAgICAgKiBAcGFyYW0gcG9zOiBwb3NpdGlvbiBiZWV0d2VlbiAtMSBhbmQgbGVuCiAgICAgICAgICogQHBhcmFtIG1vZDogb25lIG1vZGlmaWNhaXRvbiBvciBhbiBhcnJheSBvZiBpdAogICAgICAgICAqLwogICAgICAgIHNldE1vZGlmaWNhdGlvbjogZnVuY3Rpb24gKHBvcywgbW9kKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5zZXRNb2RpZmljYXRpb25BcnJheShwb3MsIHVuZGVmaW5lZCk7CiAgICAgICAgICAgIHNlbGYuYWRkTW9kaWZpY2F0aW9uKHBvcywgbW9kKTsKICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdjaGFuZ2UnKQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogYWRkIG9uZSBtb2RpZmljYXRpb24gb3IgYW4gYXJyYXkgb2YgbW9kaWYgYXQgYSBnaXZlbiBwb3NpdGlvbiB0byB0aGUgZXhpc2l0aW5nIGxpc3QuCiAgICAgICAgICogQHBhcmFtIHBvczogcG9zaXRpb24gYmVldHdlZW4gLTEgYW5kIGxlbgogICAgICAgICAqIEBwYXJhbSBtb2Q6IG9uZSBtb2RpZmljYWl0b24gb3IgYW4gYXJyYXkgb2YgaXQKICAgICAgICAgKi8KICAgICAgICBhZGRNb2RpZmljYXRpb246IGZ1bmN0aW9uIChwb3MsIG1vZCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICBpZiAobW9kID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBtb2RBcnIgPSBzZWxmLmdldE1vZGlmaWNhdGlvbkFycmF5KHBvcywgdHJ1ZSkKICAgICAgICAgICAgaWYgKF8uaXNBcnJheShtb2QpKSB7CiAgICAgICAgICAgICAgICBfLmVhY2gobW9kLCBmdW5jdGlvbiAocm0pIHsKICAgICAgICAgICAgICAgICAgICBtb2RBcnIucHVzaChybSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1vZEFyci5wdXNoKG1vZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHBvczogYmV0d2VlbiAtMSBhbmQgbGVuCiAgICAgICAgICogQHJldHVybiB0aGUgbGlzdCBvZiBtb2RpZmljYXRpb24gYXQgdGhpcyBwb3NpdGlvbiAoLTEgYW5kIHNpemUoKSBwb3NpdGlvbiBmb3IgdGVybWluaSkKICAgICAgICAgKi8KICAgICAgICBjb3VudE1vZGlmaWNhdGlvbnNBdDogZnVuY3Rpb24gKHBvcykgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuZ2V0TW9kaWZpY2F0aW9uQXJyYXkocG9zKTsKICAgICAgICAgICAgcmV0dXJuIGEgPyBhLmxlbmd0aCA6IDA7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0gcG9zOiBiZXR3ZWVuIC0xIGFuZCBsZW4KICAgICAgICAgKiBAcmV0dXJuIHRoZSBsaXN0IG9mIG1vZGlmaWNhdGlvbiBhdCB0aGlzIHBvc2l0aW9uCiAgICAgICAgICovCiAgICAgICAgbW9kaWZBdDogZnVuY3Rpb24gKHBvcykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRNb2RpZmljYXRpb25BcnJheShwb3MpCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhZXJhbSBwb3M6IGJldHdlZW4gMCBhbmQgbGVuLTEKICAgICAgICAgKiBAcmV0dXJuIHRoZSBhbWlubyBhaWNkIGF0IHRoaXMgcG9zaXRpb24KICAgICAgICAgKi8KICAgICAgICBhYUF0OiBmdW5jdGlvbiAocG9zKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldCgnc2VxdWVuY2UnKVtwb3NdLmFhCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiByZWFkIHRoZSBvYmplY3QgYmFjayBmcm9tIHRoZSB0b1N0cmluZyBtZXRob2QuIFNlZSB0b1N0cmluZyBmb3IgbW9yZSBkZXRhaWxzICdBQ0R7T3hpZGF0aW9ufUVGR3sxMjMuNDUsUGhvc3Bob3J5bGF0aW9ufUhJSy17QWNldHlsfScKICAgICAgICAgKiBSaWNoU2VxdWVuY2UtdGVzdHMuanMgd2lsIHNob3cgcGxlbnR5IG9mIGV4YW1wbGVzCiAgICAgICAgICogQHBhcmFtIHN0cgogICAgICAgICAqIEByZXR1cm4ge1JpY2hTZXF1ZW5jZX0KICAgICAgICAgKi8KICAgICAgICBmcm9tU3RyaW5nOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5zZXQoJ3NlcXVlbmNlJywgW10pOwoKICAgICAgICAgICAgc3RyID0gc3RyLnRyaW0oKQogICAgICAgICAgICB2YXIgbWF0Y2hOdGVybSA9IC9eXHsoW15cfV0qKVx9Ly5leGVjKHN0cikKICAgICAgICAgICAgaWYgKG1hdGNoTnRlcm0pIHsKICAgICAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcobWF0Y2hOdGVybVswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgc2VsZi5zZXRNb2RpZmljYXRpb24oLTEsIHNlbGYuc3RyaW5nMm1vZGlmcyhtYXRjaE50ZXJtWzFdKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldE1vZGlmaWNhdGlvbigtMSwgdW5kZWZpbmVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbWF0Y2hDdGVybSA9IC8oW1x9XC1dKVx7KFteXH1dKilcfSQvLmV4ZWMoc3RyKTsKICAgICAgICAgICAgdmFyIGN0ZXJtTW9kaWZzID0gdW5kZWZpbmVkOwogICAgICAgICAgICBpZiAobWF0Y2hDdGVybSkgewogICAgICAgICAgICAgICAgc3RyID0gc3RyLnN1YnN0cigwLCBzdHIubGVuZ3RoIC0gbWF0Y2hDdGVybVswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoQ3Rlcm1bMV0gPT0gJ30nKQogICAgICAgICAgICAgICAgICAgIHN0ciArPSAnfSc7CiAgICAgICAgICAgICAgICBjdGVybU1vZGlmcyA9IHNlbGYuc3RyaW5nMm1vZGlmcyhtYXRjaEN0ZXJtWzJdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBuZXcgUmVnRXhwRnVsbFNwbGl0ZXIoKS5zcGxpdCgvKFtBLVpdKShceyhbXlx9XSopXH0pPy8sIHN0cikKCiAgICAgICAgICAgIF8uZWFjaChtYXRjaGVzLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgdmFyIHJhYSA9IHsKICAgICAgICAgICAgICAgICAgICBhYTogZGljb0FBLmdldChtWzFdKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmICghcmFhLmFhKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVW5rbndvd25BbWlub0FjaWQnLAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAndW5rbndvbiBhbWlubyBhY2lkICcgKyBtWzFdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG1bM10pIHsKICAgICAgICAgICAgICAgICAgICByYWEubW9kaWZpY2F0aW9ucyA9IHNlbGYuc3RyaW5nMm1vZGlmcyhtWzNdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdzZXF1ZW5jZScpLnB1c2gocmFhKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5zZXRNb2RpZmljYXRpb24oc2VsZi5zaXplKCksIGN0ZXJtTW9kaWZzKTsKICAgICAgICAgICAgLy9zZWxmLmNoYW5nZSgpOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIHBhcnNlIGEgbW9kaWZpY2F0aW9uIHN0cmluZyBzdHJpbmcKICAgICAgICAgKiBAcGFyYW0gc3RyTW9kcwogICAgICAgICAqIEByZXR1cm4ge0FycmF5fQogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgc3RyaW5nMm1vZGlmczogZnVuY3Rpb24gKHN0ck1vZHMpIHsKICAgICAgICAgICAgdmFyIGwgPSBbXTsKICAgICAgICAgICAgXy5lYWNoKHN0ck1vZHMuc3BsaXQoJywnKSwgZnVuY3Rpb24gKG1uKSB7CiAgICAgICAgICAgICAgICB2YXIgbW9kID0gZGljb1Jlc01vZC5nZXQobW4pOwogICAgICAgICAgICAgICAgaWYgKCFtb2QpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbW1hc3MgPSBwYXJzZUZsb2F0KG1uKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNGaW5pdGUobW1hc3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdVbmtud293blJlc2lkdWVNb2RpZmljYXRpb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3Vua25vd24gbW9kaWZpY2F0aW9uIFsnICsgbW9kICsgJ10gaW4gJyArIG1uCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbW9kID0gbmV3IFJlc2lkdWVNb2RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiIiArIG1tYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBtYXNzOiBtbWFzcwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsLnB1c2gobW9kKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGw7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogY2hlY2sgZXF1YWxpdHkgYmV0d2VlIDIgcmljaCBzZXF1ZW5jZS4KICAgICAgICAgKiBUaGF0IGNhbiBiZSBub3QgdGhhdCBzdHJhaWdodCBmb3J3YXJkcywgYmVjYXVzZSB0aGUgbW9kaWZpY2F0aW9uIG9yZGVyIG9uIGEgZ2l2ZW4gYW1pbm8gYWNpZCBpcyBub3QgcmVsZXZhbnQuCiAgICAgICAgICogQHBhcmFtIG9ycwogICAgICAgICAqIEByZXR1cm4geyp9CiAgICAgICAgICovCiAgICAgICAgZXF1YWxzVG86IGZ1bmN0aW9uIChvcnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAoKG9ycyA9PSBudWxsKSB8fCAoc2VsZi5zaXplKCkgIT0gb3JzLnNpemUoKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gXy5hbGwoc2VsZi5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uIChyYWEsIGkpIHsKICAgICAgICAgICAgICAgIG9yYWEgPSBvcnMuZ2V0KCdzZXF1ZW5jZScpW2ldOwogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJhYS5hYS5jb2RlMSwgb3JhYS5hYS5jb2RlKQogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF8ucGx1Y2socmFhLm1vZGlmaWNhdGlvbnMsICduYW1lJykuc29ydCgpLmpvaW4oCiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnKSwgXy5wbHVjayhvcmFhLm1vZGlmaWNhdGlvbnMsICduYW1lJykKICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNvcnQoKS5qb2luKCcnKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gKHJhYS5hYS5nZXQoJ2NvZGUxJykgPT0gb3JhYS5hYS5nZXQoJ2NvZGUxJykpICYmIChfLmNvbGxlY3QocmFhLm1vZGlmaWNhdGlvbnMsIGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uZ2V0KCduYW1lJykKICAgICAgICAgICAgICAgIH0pLnNvcnQoKS5qb2luKCcnKSA9PSBfLmNvbGxlY3Qob3JhYS5tb2RpZmljYXRpb25zLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICB9KS5zb3J0KCkuam9pbignJykpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJuIGp1c3QgdGhlIGFtaW5vIGFjaWQgbGlzdCBhcyBhIHN0cmluZwogICAgICAgICAqLwogICAgICAgIHRvQUFTdHJpbmc6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIF8uY29sbGVjdCh0aGlzLmdldCgnc2VxdWVuY2UnKSwgZnVuY3Rpb24gKHJhYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJhYS5hYS5nZXQoJ2NvZGUxJyk7CiAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGZ1bGwgc3RyaW5nLCBjb21wYXRpYmxlIHdpdGggdGhlIGZyb21TdHJpbmcvY29uc3RydWN0b3Igc3ludGF4CiAgICAgICAgICogc2VlIFJpY2hTZXF1ZW5jZS10ZXN0cy5qcyBmb3IgZXhhbXBsZXMKICAgICAgICAgKiBAcmV0dXJuIGEgc3RyaW5nCiAgICAgICAgICovCiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIG1vZGlmMnN0cmluZyA9IGZ1bmN0aW9uIChtb2RpZnMpIHsKICAgICAgICAgICAgICAgIGlmICghbW9kaWZzIHx8IG1vZGlmcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAneycgKyBfLmNvbGxlY3QobW9kaWZzLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICB9KS5zb3J0KCkuam9pbignLCcpICsgJ30nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHMgPSBtb2RpZjJzdHJpbmcoc2VsZi5nZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycpKTsKICAgICAgICAgICAgdmFyIHNpemUgPSBzZWxmLnNpemUoKTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgcyArPSBzZWxmLmdldCgnc2VxdWVuY2UnKVtpXS5hYS5nZXQoJ2NvZGUxJyk7CiAgICAgICAgICAgICAgICBzICs9IG1vZGlmMnN0cmluZyhzZWxmLmdldCgnc2VxdWVuY2UnKVtpXS5tb2RpZmljYXRpb25zKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNlbGYuY291bnRNb2RpZmljYXRpb25zQXQoc2l6ZSkgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5jb3VudE1vZGlmaWNhdGlvbnNBdChzaXplIC0gMSkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHMgKz0gJy0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICBzICs9IG1vZGlmMnN0cmluZyhzZWxmLmdldCgnY1Rlcm1Nb2RpZmljYXRpb25zJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIDsKCiAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIGEgc2VxdWVuY2UgbGVuZ3RoCiAgICAgICAgICovCiAgICAgICAgc2l6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoJ3NlcXVlbmNlJykubGVuZ3RoOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBSaWNoU2VxdWVuY2U7Cn0pOwoKLyoKICogQSB0aGVvcmV0aWNhbCBzcGVjdHJ1bSBwb2pvLCBtYWRlIG91dCBmcm9tIGEgUmljaFNlcXVlbmNlIGFuZCBhIHNldCBvZiBmcmFnbWVudGF0aW9uIHNlcmllcwogKiBQcm9wZXJ0aWVzOgogKiAtIHJpY2hTZXF1ZW5jZQogKiAtIHBlYWtzCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9UaGVvU3BlY3RydW0nLFsndW5kZXJzY29yZScsICdCYWNrYm9uZSddLCBmdW5jdGlvbihfLCBCYWNrYm9uZSkgewogICAgdmFyIFRoZW9TcGVjdHJ1bSA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgICAgIHJpY2hTZXF1ZW5jZSA6IG51bGwsCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJuIHRoZSBsaXN0IG9mIG0vei4gd2UgbmVlZCB0aGF0IHRvIGhhdmUgYSBraW5kIG9mICdhYnN0cmFjdGlvbicgb3ZlciBNYXNzTGlzdAogICAgICAgICAqLwogICAgICAgIG1venM6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgcmV0dXJuIF8ucGx1Y2sodGhpcy5nZXQoJ3BlYWtzJyksICdtb3onKTsKICAgICAgICB9LAogICAgICAgIHNpemU6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdwZWFrcycpLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgCiAgICB9KTsKICAgIHJldHVybiBUaGVvU3BlY3RydW07Cn0pOwoKLyoKICogQnVpbGRzIHRoZW9yZXRpY2FsIG1hc3NlcyBiYXNlZCBvbiBhIFJpY2hTZXVlbmNlLiBJdCBjYW4gYmUgaW50YWN0IG1hc3MgKHdpdGggY2hhcmdlcykgb3IgZnJhZ21lbnRhdGlvbiBzcGVjdHJhLgogKiBWaXNpdCBNYXNzQnVpbGRlci10ZXN0LmpzIGZvciBwbGVudHkgb2YgZXhhbXBsZXMuCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvTWFzc0J1aWxkZXInLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1RoZW9TcGVjdHJ1bScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeSddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgUmljaFNlcXVlbmNlLCBUaGVvU3BlY3RydW0sIGRpY29BQSwgZGljb1Jlc01vZCkgewogIHZhciBNQVNTX09IID0gMTUuOTk0OTE0NjIyICsgMS4wMDc4MjUwMzIvLyBjdGVybQogIHZhciBNQVNTX0ggPSAxLjAwNzgyNTAzMi8vIG50ZXJtCiAgdmFyIE1BU1NfSFBMVVMgPSAxLjAwNzI3NjQ2NjgxMgoKICAvKioKICAgKiBwcml2YXRlIGNvbnRzdHJ1Y3RvcgogICAqLwogIE1hc3NCdWlsZGVyID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgIGluaXREZWYgOiBpbml0RGVmLAogICAgbGF1bmNoSW5pdCA6IGZhbHNlLAoKICAgIF9pbmRleE1vZGlmIDogbnVsbCwKICAgIF9pbmRleEFtaW5vQWNpZCA6IG51bGwsCgogICAgaW5kZXhNb2RpZiA6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgcmV0dXJuIChuYW1lID09PSB1bmRlZmluZWQpID8gdGhpcy5faW5kZXhNb2RpZiA6IHRoaXMuX2luZGV4TW9kaWZbbmFtZV0KICAgIH0sCiAgICBpbmRleEFtaW5vQWNpZCA6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgcmV0dXJuIChuYW1lID09PSB1bmRlZmluZWQpID8gdGhpcy5faW5kZXhBbWlub0FjaWQgOiB0aGlzLl9pbmRleEFtaW5vQWNpZFtuYW1lXQogICAgfSwKCiAgICBwX2luaXRfYW1pbm9fYWNpZHNfZnJvbV9qc29uIDogcF9pbml0X2FtaW5vX2FjaWRzX2Zyb21fanNvbiwKICAgIHBfaW5pdF9yZXNpZHVlX21vZGlmaWNhdGlvbnNfZnJvbV9qc29uIDogcF9pbml0X3Jlc2lkdWVfbW9kaWZpY2F0aW9uc19mcm9tX2pzb24sCgogICAgY29tcHV0ZU1hc3NSaWNoU2VxdWVuY2UgOiBjb21wdXRlTWFzc1JpY2hTZXF1ZW5jZSwKICAgIGNvbXB1dGVUaGVvU3BlY3RydW0gOiBjb21wdXRlVGhlb1NwZWN0cnVtLAogICAgY29tcHV0ZU1hc3NSaWNoQUEgOiBjb21wdXRlTWFzc1JpY2hBQSwKICAgIGNvbXB1dGVNYXNzTW9kaWZBcnJheSA6IGNvbXB1dGVNYXNzTW9kaWZBcnJheQoKICB9KTsKCiAgTWFzc0J1aWxkZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB0aGlzLmluaXREZWYob3B0aW9ucykKCiAgfQogIC8qKgogICAqIHJlYWQgTW9kaWZpY2F0aW9uLCBhbWlubyBhY2lkICYgY28gZGVmaW5pdGlvbnMgYXV0b21hdGljYWxseSBjYWxsZWQgb25jZQogICAqIGZyb20gdGhlIG9wdGlvbiBzcmMgaW4gbmV3CiAgICogQHByaXZhdGUKICAgKi8KICBmdW5jdGlvbiBpbml0RGVmKG9wdGlvbnMpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc3JjICE9PSB1bmRlZmluZWQpIHsKICAgICAgc2VsZi5sYXVuY2hJbml0ID0gdHJ1ZQogICAgICAkLmdldEpTT04ob3B0aW9ucy5zcmMgKyAnL3Jlc2lkdWVNb2RpZmljYXRpb24vbGlzdCcsIGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICBzZWxmLnBfaW5pdF9yZXNpZHVlX21vZGlmaWNhdGlvbnNfZnJvbV9qc29uKGRhdGEpCiAgICAgIH0pOwogICAgICAkLmdldEpTT04ob3B0aW9ucy5zcmMgKyAnL2FtaW5vQWNpZC9saXN0JywgZnVuY3Rpb24oZGF0YSkgewoKICAgICAgICBzZWxmLnBfaW5pdF9hbWlub19hY2lkc19mcm9tX2pzb24oZGF0YSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZGF0YSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHNlbGYubGF1bmNoSW5pdCA9IHRydWUKICAgICAgc2VsZi5wX2luaXRfYW1pbm9fYWNpZHNfZnJvbV9qc29uKG9wdGlvbnMuZGF0YS5hbWlub0FjaWRzKTsKICAgICAgc2VsZi5wX2luaXRfcmVzaWR1ZV9tb2RpZmljYXRpb25zX2Zyb21fanNvbihvcHRpb25zLmRhdGEucmVzaWR1ZU1vZGlmaWNhdGlvbnMpOwogICAgfQogIH0KCiAgdmFyIHBfaW5pdF9hbWlub19hY2lkc19mcm9tX2pzb24gPSBmdW5jdGlvbihkYXRhKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgaWR4ID0ge307CiAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24oZCkgewogICAgICBpZHhbZC5jb2RlMV0gPSBkCiAgICB9KTsKCiAgICBzZWxmLl9pbmRleEFtaW5vQWNpZCA9IGlkeDsKICB9OwoKICB2YXIgcF9pbml0X3Jlc2lkdWVfbW9kaWZpY2F0aW9uc19mcm9tX2pzb24gPSBmdW5jdGlvbihkYXRhKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgaWR4ID0ge307CiAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24oZCkgewogICAgICBpZHhbZC5uYW1lXSA9IGQKICAgIH0pOwoKICAgIHNlbGYuX2luZGV4TW9kaWYgPSBpZHg7CiAgfTsKCiAgLyoqCiAgICogY29tcHV0ZSBSaWNoQUEgbWFzcyAoYW1pbm8gYWNpZCArIG1vZGlmaWNhdGlvbnMpCiAgICogQHByaXZhdGUKICAgKi8KICBmdW5jdGlvbiBjb21wdXRlTWFzc1JpY2hBQShyYWEpIHsKICAgIHJldHVybiByYWEuYWEuZ2V0KCdtYXNzJykgKyBjb21wdXRlTWFzc01vZGlmQXJyYXkocmFhLm1vZGlmaWNhdGlvbnMpOwogIH0KCiAgLyoqCiAgICogY29tcHV0ZSB0aGUgbWFzcyBvZiBvZiBsaXN0IG9mIG1vZGlmaWNhdGlvbnMgKHVuZGVmaWVuZCBpcyBwb3NzaWJsZSkuIEl0J3MganVzdCB0aGUgc3VtIG9mIHRoZSBtb2RpZiBtYXNzZXMKICAgKiBAcHJpdmF0ZQogICAqLwogIGZ1bmN0aW9uIGNvbXB1dGVNYXNzTW9kaWZBcnJheShtb2RpZmljYXRpb25zKSB7CgogICAgaWYgKG1vZGlmaWNhdGlvbnMgPT09IHVuZGVmaW5lZCB8fCBtb2RpZmljYXRpb25zLmxlbmd0aCA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdmFyIHRvdCA9IDA7CiAgICBfLmVhY2gobW9kaWZpY2F0aW9ucywgZnVuY3Rpb24obSkgewogICAgICB0b3QgKz0gbS5nZXQoJ21hc3MnKTsKICAgIH0pOwogICAgcmV0dXJuIHRvdDsKICB9CgogIC8qKgogICAqIGdldCByaWNoIHNlcXVlbmNlIG1hc3MgaWYgYSBjaGFyZ2UgYXJndW1lbnQgaXMgZ2l2ZW4gLCBnZXQgdGhlIGNoYXJnZWQKICAgKiBwZXB0aWRlCiAgICogQHBhcmFtIHJpY2hTZXE6IHRoZSBwZXB0aWRlCiAgICogQHBhcmFtIGNoYXJnZTogY2hhcmdlIHN0YXRlLiBpZiB1bmRlZmluZWQsIE1IIHdpbGwgYmUgcmV0dXJuZWQKICAgKiBAcmV0dXJuIGEgZG91YmxlIGZvciB0aGUgbWFzcwogICAqLwogIGZ1bmN0aW9uIGNvbXB1dGVNYXNzUmljaFNlcXVlbmNlKHJpY2hTZXEsIGNoYXJnZSkgewoKICAgIHZhciByYXdNYXNzID0gMDsKCiAgICBfLmVhY2gocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICByYXdNYXNzICs9IGNvbXB1dGVNYXNzUmljaEFBKHJhYSkKICAgIH0pOwoKICAgIHJhd01hc3MgKz0gTUFTU19PSCArIE1BU1NfSDsKICAgIHJhd01hc3MgKz0gY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJpY2hTZXEuZ2V0KCduVGVybU1vZGlmaWNhdGlvbnMnKSkgKyBjb21wdXRlTWFzc01vZGlmQXJyYXkocmljaFNlcS5nZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycpKTsKICAgIGlmICghY2hhcmdlKSB7CiAgICAgIHJldHVybiByYXdNYXNzCiAgICB9CiAgICByZXR1cm4gcmF3TWFzcyAvIGNoYXJnZSArIE1BU1NfSFBMVVM7CiAgfQoKICAvKioKICAgKiBjb21wdXRlIHRoZSB0aGVvcmV0aWNhbCBtYXNzIHNwZWN0cnVtLiBiLCBiKyssIHksIHkrKwogICAqIEByZXR1cm4gYSB0aGVvcmV0aWNhbCBzcGVjdHJ1bQogICAqLwogIGZ1bmN0aW9uIGNvbXB1dGVUaGVvU3BlY3RydW0ocmljaFNlcSkgewogICAgdmFyIHJhd01hc3NlcyA9IFtjb21wdXRlTWFzc01vZGlmQXJyYXkocmljaFNlcS5nZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycpKV0uY29uY2F0KF8uY29sbGVjdChyaWNoU2VxLmdldCgnc2VxdWVuY2UnKSwgY29tcHV0ZU1hc3NSaWNoQUEpKTsKICAgIHZhciBuID0gcmF3TWFzc2VzLmxlbmd0aDsKICAgIGZvciAoIGkgPSAxOyBpIDwgbjsgaSsrKSB7CiAgICAgIHJhd01hc3Nlc1tpXSArPSByYXdNYXNzZXNbaSAtIDFdCiAgICB9CiAgICB2YXIgbXRvdCA9IHJhd01hc3Nlc1tuIC0gMV07CgogICAgdmFyIHRoZW9TcCA9IG5ldyBUaGVvU3BlY3RydW0oewogICAgICBmcmFnU2VyaWVzIDogWydiJywgJ2IrKycsICd5JywgJ3krKyddLAogICAgICBsZW5TZXEgOiByaWNoU2VxLnNpemUoKSwKICAgICAgcGVha3MgOiBbXSwKICAgICAgcmljaFNlcXVlbmNlIDogcmljaFNlcQogICAgfSk7CiAgICB2YXIgcGVha3MgPSB0aGVvU3AuZ2V0KCdwZWFrcycpOwogICAgZm9yICggaSA9IChyYXdNYXNzZXNbMF0gPj0gMTAwKSA/IDAgOiAxOyBpIDwgcmF3TWFzc2VzLmxlbmd0aDsgaSsrKSB7CgogICAgICB2YXIgcm0gPSByYXdNYXNzZXNbaV07CiAgICAgIC8vICAgICAgICAgICAgY29uc29sZS5sb2cocm0sIGkpCiAgICAgIHBlYWtzLnB1c2goewogICAgICAgIGxhYmVsIDogJ2InICsgaSwKICAgICAgICBzZXJpZXMgOiAnYicsCiAgICAgICAgbW96IDogcm0gKyBNQVNTX0hQTFVTLAogICAgICAgIHBvcyA6IGkgLSAxCiAgICAgIH0pOwogICAgICBwZWFrcy5wdXNoKHsKICAgICAgICBsYWJlbCA6ICdiKysnICsgaSwKICAgICAgICBzZXJpZXMgOiAnYisrJywKICAgICAgICBtb3ogOiBybSAvIDIgKyBNQVNTX0hQTFVTLAogICAgICAgIHBvcyA6IGkgLSAxCiAgICAgIH0pOwogICAgfQoKICAgIHZhciBtY3Rlcm1pbnVzID0gY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJpY2hTZXEuZ2V0KCdjVGVybU1vZGlmaWNhdGlvbnMnKSkKICAgIGZvciAoIGkgPSAwOyBpIDwgcmF3TWFzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciB5bSA9IG10b3QgLSByYXdNYXNzZXNbaV0gKyBNQVNTX09IICsgTUFTU19IICsgbWN0ZXJtaW51czsKICAgICAgaWYgKChpID09IHJhd01hc3Nlcy5sZW5ndGggLSAxICkgJiYgeW0gPCAxMDApIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgcGVha3MucHVzaCh7CiAgICAgICAgbGFiZWwgOiAneScgKyAobiAtIGkgLSAxKSwKICAgICAgICBzZXJpZXMgOiAneScsCiAgICAgICAgbW96IDogeW0gKyBNQVNTX0hQTFVTLAogICAgICAgIHBvcyA6IGkKICAgICAgfSk7CiAgICAgIHBlYWtzLnB1c2goewogICAgICAgIGxhYmVsIDogJ3krKycgKyAobiAtIGkgLSAxKSwKICAgICAgICBzZXJpZXMgOiAneSsrJywKICAgICAgICBtb3ogOiB5bSAvIDIgKyBNQVNTX0hQTFVTLAogICAgICAgIHBvcyA6IGkKICAgICAgfSk7CiAgICB9CiAgICBwZWFrcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgcmV0dXJuIGEubW96IC0gYi5tb3oKICAgIH0pOwogICAgcmV0dXJuIHRoZW9TcAogIH0KCiAgcmV0dXJuIG5ldyBNYXNzQnVpbGRlcigpOwp9KTsKCi8qCiAqIGZ1bmN0aW9uIHRvIGNvbXB1dGUgZGVsdGEgbWFzc2VzLgogICogT25seSBwcG0gaXMgaW1wbGVtZW50ZWQsIGJ1dCB0aGF0IHNob3VsZCBiZSB0aGUgaGFuZGxlciBmb3Igb3RoZXIgdW5pdHMgKERhIGV0Yy4uKQogICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3V0aWxzL0RlbHRhTWFzcycsWyd1bmRlcnNjb3JlJ10sIGZ1bmN0aW9uKF8pIHsKICAgIHZhciBEZWx0YU1hc3MgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIC8qKgogICAgICAgICAqIHN5bW1ldHJpY2FsbHkgY29ycmVjdCBwcG0gY29tcHV0YXRpb24gKHgteSkgc2hvdWxkIGVxdWFsIHRvICh5LXgpCiAgICAgICAgICoKICAgICAgICAgKiBAdHlwZSB7e2RlbHRhOiBkZWx0YSwgcmFuZ2U6IHJhbmdlLCBpc0Nsb3NlVG86IGlzQ2xvc2VUb319CiAgICAgICAgICovCiAgICAgICAgc2VsZi5wcG0gPSB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBtYXNzZXMKICAgICAgICAgICAgICAqIEBwYXJhbSB4CiAgICAgICAgICAgICAqIEBwYXJhbSB5CiAgICAgICAgICAgICAqIEByZXR1cm4ge251bWJlcn0KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGRlbHRhIDogZnVuY3Rpb24oeCwgeSkgewogICAgICAgICAgICAgICAgcmV0dXJuIDIgKiAoeSAtIHgpIC8gKHkgKyB4KSAqIDEwMDAwMDA7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiByZXR1cm4gbWFzcyBib3VuZGFyaWVzIGZvciB4ICstIHRvbAogICAgICAgICAgICAgKiBAcGFyYW0geAogICAgICAgICAgICAgKiBAcGFyYW0gdG9sCiAgICAgICAgICAgICAqIEByZXR1cm4ge1ttTWluLCBtTWF4XX0KICAgICAgICAgICAgICovCiAgICAgICAgICAgIHJhbmdlIDogZnVuY3Rpb24oeCwgdG9sKSB7CiAgICAgICAgICAgICAgICB0b2wgPSBNYXRoLmFicyh0b2wpIC8gMTAwMDAwMC4wOwogICAgICAgICAgICAgICAgdmFyIGYgPSAoMiArIHRvbCkgLyAoMiAtIHRvbCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiAoeD49MCk/W3ggLyBmLCB4ICogZl06W3ggKiBmLCB4IC8gZl0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIHdlIGhhdmUgdHdvIHZlcnNpb246CiAgICAgICAgICAgICAqICAtIHdpdGggdGhyZWUgcGFyYW1zLCByZXR1cm4gdHJ1ZS9mYWxzZSBpZiAodGFyZ2V0ICYgdG9sIGFyZSBjbG9zZXIgdGhhbiBjYW5kaWRhdGUpCiAgICAgICAgICAgICAqICAtIHdpdGggdHdvIHBhcmFtZXRlcnMsIHJldHVybiBhIGZ1bmN0aW9uIHRoYXQgd2lsbCB0YWtlIHcgcGFyZW10ZXIgb2YgdHlwZSBjYW5kaWRhdGU7IHRoaXMgc2hvdWxkIGJlIG11Y2ggZmFzdGVyCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQKICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHRvbAogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2FuZGlkYXRlCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBpc0Nsb3NlVG8gOiBmdW5jdGlvbih0YXJnZXQsIHRvbCwgY2FuZGlkYXRlKSB7CiAgICAgICAgICAgICAgICBpZiAoY2FuZGlkYXRlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoMiAqIChjYW5kaWRhdGUgLSB0YXJnZXQpIC8gKGNhbmRpZGF0ZSArIHRhcmdldCkgKiAxMDAwMDAwKSA8PSB0b2wKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciByID0gc2VsZi5wcG0ucmFuZ2UodGFyZ2V0LCB0b2wpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyA+PSByWzBdICYmIGMgPD0gclsxXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KCiAgICByZXR1cm4gbmV3IERlbHRhTWFzcygpOwoKfSkKOwovKgogKiBBYnN0cmFjdCB3aGF0IHdhcyBvbmx5IFBTTUFsaWdubWVudCBpbnRvIGFsaWdubWVudCBvZiB0d28gYmVhbnMgd2l0aCBmdW5jdGlvbiAubW96cygpIChnZXR0aW5nIGJhY2sgdGhlIGxpc3Qgb2YgbWFzc2VzKQogKiBUaGUgcG9pbnQgaXMgdG8gYWxpZ24gZXhwL3RoZW8sIGJ1dCBhbHNvIGV4cC9leHAKICoKICogVGhpcyB3aWxsIGJlIHBvcHVsYXRlZCB3aXRoIHBrbEEgYW5kIHBrbEIsIGVhY2ggb2YgdGhlbSBoYXZpbmcgYSAubW96cygpIGZ1bmN0aW9uLgogKgogKiBOQjogdGhlIHdheSB0aGUgYWxpZ25tZW50IGlzIHBlcmZvcm1lZCBub3QuLi4gZWZmaWNpZW50LiB3ZSBjb21wdXRlIGFnYWluIGFuZCBhZ2FpbiB0aGUgY2xvc2VzdCBwZWFrIHdpdGggdGhlIGRpY2hvdG9teSBtZXRob2RzLCBpbnN0ZWFkIG9mIG1vdmluZyAgd2l0aCBhIHNpbmdsZSwgb25lIHNob3QgbGluZWFyL2RpY2hvIG1ldGhvZC4uLgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvUGVha0xpc3RQYWlyQWxpZ25tZW50JyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy91dGlscy9EZWx0YU1hc3MnXSwgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBEZWx0YU1hc3MpIHsKICAgIHZhciBjbG9zZXN0UGVhayA9IGZ1bmN0aW9uICh4LCB4cGVha3MpIHsKCiAgICAgICAgaWYgKHggPD0geHBlYWtzWzBdKSB7CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfQogICAgICAgIHZhciBpc3VwID0geHBlYWtzLmxlbmd0aCAtIDE7CiAgICAgICAgaWYgKHggPj0geHBlYWtzW2lzdXBdKSB7CiAgICAgICAgICAgIHJldHVybiBpc3VwCiAgICAgICAgfQogICAgICAgIHZhciBpaW5mID0gMDsKCiAgICAgICAgd2hpbGUgKChpaW5mICsgMSkgPCBpc3VwKSB7CiAgICAgICAgICAgIHZhciBpbWlkID0gTWF0aC5yb3VuZCgoaWluZiArIGlzdXApIC8gMik7CiAgICAgICAgICAgIGlmICh4IDwgeHBlYWtzW2ltaWRdKSB7CiAgICAgICAgICAgICAgICBpc3VwID0gaW1pZAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWluZiA9IGltaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICgoeCAtIHhwZWFrc1tpaW5mXSkgPCAoeHBlYWtzW2lzdXBdIC0geCkpID8gaWluZiA6IGlzdXA7CiAgICB9CgogICAgcmV0dXJuIEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogZ2V0IHRoZSBtYXRjaGluZyBwZWFrIGluZGljZXMgZnJvbSBBIHRvIEIKICAgICAgICAgKiBAcmV0dXJuIHsqfQogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgbWF0Y2hJbmRpY2VzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG1venNBID0gc2VsZi5nZXQoJ3BrbEEnKS5tb3pzKCk7CiAgICAgICAgICAgIHZhciBtb3pzQiA9IHNlbGYuZ2V0KCdwa2xCJykubW96cygpOwoKICAgICAgICAgICAgdmFyIG5BID0gbW96c0EubGVuZ3RoOwogICAgICAgICAgICB2YXIgbkIgPSBtb3pzQi5sZW5ndGg7CiAgICAgICAgICAgIGlmIChuQSAqIG5CID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gW107CgogICAgICAgICAgICB2YXIgaUEgPSAwOwogICAgICAgICAgICB2YXIgaUIgPSAwOwogICAgICAgICAgICB2YXIgY3VyRGVsdGEgPSBEZWx0YU1hc3MucHBtLmRlbHRhKG1venNCWzBdLCBtb3pzQVswXSk7CiAgICAgICAgICAgIHZhciBsYXN0TWF0Y2ggPSB7CiAgICAgICAgICAgICAgICBpQTogMCwKICAgICAgICAgICAgICAgIGlCOiAwLAogICAgICAgICAgICAgICAgZXJyb3JQUE06IGN1ckRlbHRhCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciByZXQgPSBbbGFzdE1hdGNoXTsKICAgICAgICAgICAgd2hpbGUgKGlBIDwgbkEgJiYgaUIgPCBuQikgewogICAgICAgICAgICAgICAgdmFyIGluY0E7CiAgICAgICAgICAgICAgICBpZiAobW96c0FbaUFdIDwgbW96c0JbaUJdKSB7CiAgICAgICAgICAgICAgICAgICAgaW5jQSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgaUEgKz0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoaUEgPT0gbkEpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpbmNBID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaUIgKz0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoaUIgPT0gbkIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBuZXdEZWx0YSA9IERlbHRhTWFzcy5wcG0uZGVsdGEobW96c0JbaUJdLCBtb3pzQVtpQV0pOwogICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKG5ld0RlbHRhKSA8IE1hdGguYWJzKGN1ckRlbHRhKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChsYXN0TWF0Y2ggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXN0TWF0Y2ggPSB7fQogICAgICAgICAgICAgICAgICAgICAgICByZXQucHVzaChsYXN0TWF0Y2gpOwoKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoLmlBID0gaUE7CiAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoLmlCID0gaUI7CiAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoLmVycm9yUFBNID0gbmV3RGVsdGE7CgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjdXJEZWx0YSA9IDk5OTk5OTk5OTk5OTk5OTkuMDsKICAgICAgICAgICAgICAgICAgICBsYXN0TWF0Y2ggPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjdXJEZWx0YSA9IG5ld0RlbHRhOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQ7CgogICAgICAgIH0sCiAgICAgICAgbWF0Y2hlczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaEluZGljZXMoKTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEAgcmV0dXJuIHRoZSBsaXN0IG9mIG1hdGNoZXMgY2xvc2VyIHRoYW4gYSBnaXZlbiB0b2xlcmFuY2UKICAgICAgICAgKi8KICAgICAgICBjbG9zZXJUaGFuUFBNOiBmdW5jdGlvbiAodG9sKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG0gPSBfLmZpbHRlcihzZWxmLmdldCgnbWF0Y2hlcycpLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgcmV0dXJuIChNYXRoLmFicyhtLmVycm9yUFBNKSA8IHRvbCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBtCiAgICAgICAgfQogICAgfSk7Cn0pOwoKLyoqCiAqIGV4dGVuZHMgUGVha0xpc3RQYWlyQWxpZ25tZW50IHRvIG1hcCB0aGUgY2xvc2VzdCBwZWFrIG9mIGFuIGV4cGVyaW1lbnRhbCBhbmQgdGhlb3JldGljYWwgc3BlY3RyYS4gQm90aCBtdXN0IGJlIHNvcnRlZCBieSBtb3pzLgogKiBQcm9wZXJ0aWVzIGFyZQogKiAtIHJpY2hTZXF1ZW5jZQogKiAtIGV4cFNwZWN0cnVtCiAqCiAqIGFsaWdubWVudCBpcyByZWNvbXB1dGVkIG9uIHByb3BlcnR5IGNoYW5nZS4KICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvUFNNQWxpZ25tZW50JyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvTWFzc0J1aWxkZXInLCAnLi9QZWFrTGlzdFBhaXJBbGlnbm1lbnQnXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUsIG1hc3NCdWlsZGVyLCBQZWFrTGlzdFBhaXJBbGlnbm1lbnQpIHsKCiAgICAvKioKICAgICAqIGJ1aWxkIHRoZSBhbGlnbm1lbnQgd2l0aCBvcHRpb25zIHtyaWNoU2VxdWVuY2U6Li4uLCBleHBTcGVjdHJ1bTouLi59CiAgICAgKi8KICAgIHZhciBQU01BbGlnbm1lbnQgPSBQZWFrTGlzdFBhaXJBbGlnbm1lbnQuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIFBTTUFsaWdubWVudC5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIHt9KTsKCiAgICAgICAgICAgIHNlbGYuc2V0KCdyaWNoU2VxdWVuY2UnLCBvcHRpb25zLnJpY2hTZXF1ZW5jZSk7CiAgICAgICAgICAgIHNlbGYuc2V0KCdleHBTcGVjdHJ1bScsIG9wdGlvbnMuZXhwU3BlY3RydW0pOwoKICAgICAgICAgICAgc2VsZi5idWlsZCgpCgogICAgICAgICAgICBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpLm9uKCJjaGFuZ2UiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHNlbGYuYnVpbGQoKQogICAgICAgICAgICB9KQogICAgICAgICAgICBzZWxmLm9uKCJjaGFuZ2U6cmljaFNlcXVlbmNlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBjb21wdXRlIHRoZSB1bmRlcmx5aW5nIGFsaWdubWVudAogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgYnVpbGQgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zZXQoJ3RoZW9TcGVjdHJ1bScsIG1hc3NCdWlsZGVyLmNvbXB1dGVUaGVvU3BlY3RydW0oc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpKSk7CgogICAgICAgICAgICBzZWxmLnNldCgncGtsQScsIHNlbGYuZ2V0KCd0aGVvU3BlY3RydW0nKSkKICAgICAgICAgICAgc2VsZi5zZXQoJ3BrbEInLCBzZWxmLmdldCgnZXhwU3BlY3RydW0nKSkKCiAgICAgICAgICAgIHZhciBtYXRjaEluZGljZXMgPSBzZWxmLm1hdGNoSW5kaWNlcygpOwogICAgICAgICAgICB2YXIgc3BUaGVvID0gc2VsZi5nZXQoJ3RoZW9TcGVjdHJ1bScpLmdldCgncGVha3MnKTsKICAgICAgICAgICAgdmFyIHhwZWFrcyA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnbW96cycpOwogICAgICAgICAgICB2YXIgeEludGVuc2l0aWVzID0gc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwoKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBfLm1hcChtYXRjaEluZGljZXMsIGZ1bmN0aW9uKG1pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewoKICAgICAgICAgICAgICAgICAgICB0aGVvIDogc3BUaGVvW21pLmlBXSwKICAgICAgICAgICAgICAgICAgICBleHAgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4IDogbWkuaUIsCiAgICAgICAgICAgICAgICAgICAgICAgIG1veiA6IHhwZWFrc1ttaS5pQl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNbbWkuaUJdLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZXJyb3JQUE0gOiBtaS5lcnJvclBQTQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICBzZWxmLnNldCgnbWF0Y2hlcycsIG1hdGNoZXMpOwoKICAgICAgICB9LAogICAKICAgICAgICAvKioKICAgICAgICAgKiBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGV4cGVyaW1lbnRhbCBwcmVjdXJzbyBtYXNzIGFuZCB0aGUgc2VxdWVuY2UgbWFzcyAoTUgpCiAgICAgICAgICovCiAgICAgICAgZGVsdGFQcmVjTW96cyA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciB6ID0gc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdwcmVjQ2hhcmdlJyk7CiAgICAgICAgICAgIHZhciB0aGVvID0gbWFzc0J1aWxkZXIuY29tcHV0ZU1hc3NSaWNoU2VxdWVuY2Uoc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpLCB6KQogICAgICAgICAgICByZXR1cm4gKHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgncHJlY01veicpIC0gdGhlbykgKiB6CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4ge3t9fSBhIGpzbyByZWFkeSBzdHJpbmcKICAgICAgICAgKi8KICAgICAgICBzZXJpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcmV0ID0ge307CiAgICAgICAgICAgIHJldC5leHBTcGVjdHJ1bSA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLnRvSlNPTigpCgogICAgICAgICAgICB2YXIgcnNlcSA9IHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKS50b1N0cmluZygpOwogICAgICAgICAgICByZXQucmljaFNlcXVlbmNlID0gcnNlcQoKICAgICAgICAgICAgcmV0LmlkID0gc2VsZi5jb21wdXRlSWQoKTsKICAgICAgICAgICAgcmV0LmFhU2VxdWVuY2UgPSBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9BQVN0cmluZygpOwoKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9LAogICAgICAgIGNvbXB1dGVJZCA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2lkJykgKyAnfCcgKyBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKQoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIHJldHVybiB0aGUgbnVtYmVyIG9mIHVubWF0Y2hlZCBleHBlcmltZW50YWwgcGVhaywgd2l0aCBhIG1hc3MgZ3JlYXRlciB0aGFuIHRoZSBwcmVjdXJzb3IsCiAgICAgICAgICogaW50ZW5zaXR5IDwgaW5GaXJzdCBhbmQgd2l0aCB0b2wgZXJyb3IKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdG9sCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGluRmlyc3QKICAgICAgICAgKiBAcmV0dXJuIGFuIGludGVnZXIgY291bnQKICAgICAgICAgKi8KICAgICAgICB1bm1hdGNoZWRGYWN0b3IgOiBmdW5jdGlvbih0b2wsIGluRmlyc3QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHNlbGYuY2xvc2VyVGhhblBQTSh0b2wpOwoKICAgICAgICAgICAgdmFyIHBrcyA9IF8uZmlsdGVyKF8uemlwKHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnbW96cycpLCBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2ludGVuc2l0eVJhbmtzJykpLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFsxXSA8IGluRmlyc3QKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbVByZWMgPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKQogICAgICAgICAgICByZXR1cm4gXy5maWx0ZXIocGtzLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFswXSA+IG1QcmVjOwogICAgICAgICAgICB9KS5sZW5ndGggLSBfLmZpbHRlcihtYXRjaGVzLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKG0uZXhwLmludGVuc2l0eVJhbmsgPCBpbkZpcnN0KSAmJiAobS5leHAubW96ID4gbVByZWMpOwogICAgICAgICAgICB9KS5sZW5ndGgKCiAgICAgICAgfQogICAgfSk7CiAgIAogICAgcmV0dXJuIFBTTUFsaWdubWVudDsKfSk7CgovKioKICogYW4gSW1wbGljaXRNb2RpZmllciBpcyB0byBiZSBsaW5rZWQgdG8gbGFiZWxsaW5nIG9yIHRvIGEgZ2xvYmFsIGF0dHJpYnV0aW9uIG9mIG1vZGlmaWNhdGlvbi4KICogSXQgZWFzaWVyIHRvIHNheSBhIHBlcHRpZGUgaXMgU2lsYWMgZWl0aGVyIHRoYW4gYWRkaW5nIFNpbGFjIG1hc3Mgc2hpZnQgb2luIGV2ZXJ5IEsgJiBSLgogKiBUaGlzIGNhbiBiZSBldmVuIGxpZ2h0ZXIgd2l0aCAxM0MxNU4gbGFiZWwsIHdoZXJlIGV2ZXJ5IGFtaW5vIGFjaWQgaXMgbW9kaWZpZWQgd2l0aCBhIG1hc3Mgc2hpZnQgKHJlcHJlc2VudGVkIGFzIGEgcmVzaWR1ZSBtb2RpZmljYXRpb24pLgogKiBNdWx0aXBsZSBsYWJlbHMgY2FuIGJlIGFwcGxpZWQgb24gdGhlIHNhbWUgc2VxdWVuY2UgKHRoZXJlIGlzIGEgZGVmaW5lZCBsaXN0IG9mIHByZWNlZGVuY2UpCiAqCiAqIEltcGxpY2l0TW9kaWZpZXIgaGFzIHRvIGtub3cgdGhlIG9kZHMgb2YgZWFjaCBsYWJlbGluZyBtZXRob2QuIEZvciBleGFtcGxlLCBLIGNhbiBzdGlsbCBiZSBwcm9waW9ueWxhdGVkIGlmIGl0IGhhcyBhIE1ldGh5bCwgYnV0IG5vdCBhIERpbWV0aHlsLgogKgogKiBUaGUgbWFpbiBtZXRob2QgYXJlCiAqIGxhYmVsKGxhYk5hbWUsIHJpY2hTZXEpOiBhZGQgYWxsIHRoZSBsYWJlbCBtb2RpZmljYXRpb24gdG8gYSBnaXZlbiBwZXB0aWRlCiAqIHVubGFiZWwobGFiTmFtLCByaWNoU2VxdWVuY2UpOiByZW1vdmUgdGhlIG1vZGlmaWNhdGlvbiB0aWdodGVuIHRvIHRoaXMgbGFiZWwgKGlmIHRoZXJlIHdlcmUgZW5vdWdoIHRvIGxhYmVsIHRoZSBzZXF1ZW5jZSkuCiAqIGdldExhYmVsKHJpY2hTZXEpOiBnZXQgdGhlIGxhYmVsIGZpdHRpbmcgdGhlIGdpdmVuIHJpY2hTZXF1ZW5jZQogKgogKiBUaGVyZSBpcyBhIHZhc3Qgc2V0IG9mIHRlc3QgYXZhaWxhYmxlIGluIHRoZSBJbXBsaWNpdE1vZGlmaWVyLXRlc3RzLmpzCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvSW1wbGljaXRNb2RpZmllcicsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9SaWNoU2VxdWVuY2UnLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeSddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIFJpY2hTZXF1ZW5jZSwgZGljb1Jlc01vZCkgewoKICAgIC8qKgogICAgICogbGFiZWxlcnMgYXJlIHRoZSBlc3NlbmNlIG9mIHRoZSBpbXBsaWNpdCBsYWJlbGxpbmcKICAgICAqIHRoZXkgYXJlIGZ1bmN0aW9ucywgZGVmaW5lZCBmb3IgZWFjaCBwcm9wLCBwcm9wX2QxMCwgc2lsYWMgb3Igd2hhdGV2ZXIsIHRoYXQgdGFrZSBhIHJpY2hTZXF1ZW5lY2UgYW5kIGEgcG9zaXRpb24gYW5kIHJldHVybiBhIG1vZGlmaWNhdGlvbiAob3IgdW5kZWZpbmVkKSB0aGF0IHNob3VsZCBvY2N1ciB0aGVyZS4KICAgICAqIFdlIG5lZWQgYWxsIHRoYXQgYmVjYXVzZSBmb3IgZXhhbXBsZSBmb3IgcHJvcGlvbnlsYXRpb24sIHdlIG11c3Qga25vdyBpZiB0aGVyZSBpcyBhbHJlYWRuIGEgbW9uby0gb3IgYSBkaS1tZXRoeWxhdGlvbiBvbiB0aGUgc2l0ZS4uLgogICAgICoKICAgICAqIHByb3Bpb255bExhYmVsZXIgaXMganVzdCBhbiBwcml2YXRlIGZ1bmN0aW9uIHRvIGxhYmVsIEsgKyBudGVybSB3aXRoIHByb3Bpb255bCBkMCBvciBkNQogICAgICovCgogICAgdmFyIGFxdWFNb2RpZnMgPSB7fTsKICAgIF8uZWFjaCgnVkRMSVRHRkFZJy5zcGxpdCgnJyksIGZ1bmN0aW9uKGFhKXsKICAgIAlhcXVhTW9kaWZzW2FhXSA9ICBkaWNvUmVzTW9kLmdldCgnQVFVQV8nK2FhKQogICAgfSk7CiAgICBfLmVhY2goYXF1YU1vZGlmcywgZnVuY3Rpb24obW9kLCBhYSkgewogICAgICAgIGRpY29SZXNNb2QuYWRkKHsKICAgICAgICAgICAgbmFtZSA6ICdkZV8nICsgbW9kLmdldCgnbmFtZScpLAogICAgICAgICAgICBmdWxsTmFtZSA6ICdkZV8nICsgbW9kLmdldCgnZnVsbE5hbWUnKSwKICAgICAgICAgICAgbWFzcyA6IC1tb2QuZ2V0KCdtYXNzJykKICAgICAgICB9KTsKICAgIH0pCiAgICB2YXIgcHJvcGlvbnlsTGFiZWxlciA9IGZ1bmN0aW9uKHBtb2QpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEpIHsKICAgICAgICAgICAgICAgIGlmIChyaWNoU2VxLmNvdW50TW9kaWZpY2F0aW9uc0F0KC0xKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbW9kcyA9IHJpY2hTZXEubW9kaWZBdCgtMSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZHMubGVuZ3RoID09IDEgJiYgbW9kc1swXSA9PSBwbW9kKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbW9kOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcG1vZDsKICAgICAgICAgICAgICAgIC8vKHJpY2hTZXEuY291bnRNb2RpZmljYXRpb25zQXQoLTEpID4gMCkgPyB1bmRlZmluZWQgOiBwbW9kCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmljaFNlcS5hYUF0KHBvcykuZ2V0KCdjb2RlMScpID09PSAnSycpIHsKICAgICAgICAgICAgICAgIGlmIChfLmFueShyaWNoU2VxLm1vZGlmQXQocG9zKSwgZnVuY3Rpb24ocm0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIS8oTWV0aHlsfFByb3Bpb255bC4qKS8udGVzdChybS5nZXQoJ25hbWUnKSk7CiAgICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG1vZDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgbGFiZWxlcnMgPSB7CiAgICAgICAgbm9uZSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0sCiAgICAgICAgcHJvcF9kMCA6IHByb3Bpb255bExhYmVsZXIoZGljb1Jlc01vZC5nZXQoJ1Byb3Bpb255bCcpKSwKICAgICAgICBwcm9wX2Q1IDogcHJvcGlvbnlsTGFiZWxlcihkaWNvUmVzTW9kLmdldCgnUHJvcGlvbnlsOjJIKDUpJykpLAogICAgICAgICcxM0MxNU4nIDogZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEgfHwgcG9zID09IHJpY2hTZXEuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhYSA9IHJpY2hTZXEuYWFBdChwb3MpLmdldCgnY29kZTEnKTsKICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCcxM0MxNU4tJyArIGFhKTsKICAgICAgICB9LAogICAgICAgICdhcXVhJyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gYXF1YU1vZGlmc1tyaWNoU2VxLmFhQXQocG9zKS5nZXQoJ2NvZGUxJyldOwogICAgICAgIH0sCiAgICAgICAgJ2RlX2FxdWEnIDogZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEgfHwgcG9zID09IHJpY2hTZXEuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYW0gPSBfLmZpbHRlcihyaWNoU2VxLm1vZGlmQXQocG9zKSwgZnVuY3Rpb24ocm0pewogICAgICAgICAgICAgICAgcmV0dXJuIHJtLmdldCgnbmFtZScpLmluZGV4T2YoJ0FRVUFfJykgPT09IDA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSlbMF07CiAgICAgICAgICAgIGlmKGFtID09PSB1bmRlZmluZWQgKXsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdkZV8nK2FtLmdldCgnbmFtZScpKTsKICAgICAgICB9LAogICAgICAgIHNpbGFjIDogZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEgfHwgcG9zID09IHJpY2hTZXEuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhYSA9IHJpY2hTZXEuYWFBdChwb3MpLmdldCgnY29kZTEnKTsKCiAgICAgICAgICAgIGlmIChhYSA9PT0gJ0snKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGljb1Jlc01vZC5nZXQoJ0xhYmVsOjEzQyg2KTE1TigyKScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhYSA9PT0gJ1InKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGljb1Jlc01vZC5nZXQoJ0xhYmVsOjEzQyg2KTE1Tig0KScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIHVuZGVmaW5lZAogICAgICAgIH0sCiAgICAgICAgJ3N1cGVyX3NpbGFjJyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFhID0gcmljaFNlcS5hYUF0KHBvcykuZ2V0KCdjb2RlMScpOwoKICAgICAgICAgICAgaWYgKGFhID09PSAnSycpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnTGFiZWw6MTNDKDYpMTVOKDIpJykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICB9OwogICAgbGFiZWxlcnMucHJvcF9kNV9udGVybSA9IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgIGlmIChwb3MgPT0gLTEpIHsKICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdQcm9waW9ueWw6MkgoNSknKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxhYmVsZXJzLnByb3BfZDAocmljaFNlcSwgcG9zKTsKICAgIH07CiAgICBsYWJlbGVycy5waWMgPSBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICBpZiAocG9zICE9IC0xKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdQSUMnKTsKICAgICAgICAvL3JldHVybiAocmljaFNlcS5jb3VudE1vZGlmaWNhdGlvbnNBdCgtMSkgPiAwKSA/IHVuZGVmaW5lZCA6IGRpY29SZXNNb2QuZ2V0KCdQSUMnKTsKICAgIH07CiAgICBsYWJlbGVycy5waWNfaGVhdnkgPSBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICBpZiAocG9zICE9IC0xKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdQSUNfSEVBVlknKTsKICAgICAgICAvL3JldHVybiAocmljaFNlcS5jb3VudE1vZGlmaWNhdGlvbnNBdCgtMSkgPiAwKSA/IHVuZGVmaW5lZCA6IGRpY29SZXNNb2QuZ2V0KCdQSUMnKTsKICAgIH07CiAgICB2YXIgbGFiZWxlcnNPcmRlciA9IHsKICAgICAgICAnMTNDMTVOJyA6IDMsCiAgICAgICAgJ2FxdWEnIDogNCwKICAgICAgICAnZGVfYXF1YScgOiA0LAogICAgICAgIHByb3BfZDAgOiAxMCwKICAgICAgICBwcm9wX2Q1IDogOSwKICAgICAgICBwcm9wX2Q1X250ZXJtIDogMTUsCiAgICAgICAgcGljIDogNSwKICAgICAgICBwaWNfaGVhdnkgOiA1LAogICAgICAgIHNpbGFjIDogMTAwLAogICAgICAgIHN1cGVyX3NpbGFjIDogOTAsCiAgICAgICAgbm9uZSA6IDEwMDAKICAgIH0KCiAgICBJbXBsaWNpdE1vZGlmaWVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYubGFiZWxlcnMgPSBsYWJlbGVyczsKICAgICAgICBzZWxmLmxhYmVsZXJzT3JkZXIgPSBsYWJlbGVyc09yZGVyOwoKICAgICAgICByZXR1cm4gc2VsZgogICAgfTsKCiAgICAvKioKICAgICAqIEFkZCBhbGwgbW9kaWZpY2F0aW9uIGFzc29jaWF0ZWQgdG8gdGhlIGxhYmVsIG9uIHRoZSByaWNoU2VxdWVuY2Ugb2JqZWN0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gbGFiZWxOYW1lcyBhIGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIGxhYmVscywgb3IgYW4gYXJyYXkgb2Ygc3RyaW5nICh3ZSBjYW4gaGF2ZSAnc2lsYWMscHJvcF9kMCcsIG9yICdwcm9wX2Q1JykKICAgICAqIEBwYXJhbSB7T2JqZWN0fSByaWNoU2VxdWVuY2UKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUubGFiZWwgPSBmdW5jdGlvbihsYWJlbE5hbWVzLCByaWNoU2VxdWVuY2UpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgdmFyIHMgPSByaWNoU2VxdWVuY2Uuc2l6ZSgpOwogICAgICAgIGlmICghIF8uaXNBcnJheShsYWJlbE5hbWVzKSkgewogICAgICAgICAgICBsYWJlbE5hbWVzID0gbGFiZWxOYW1lcy5zcGxpdCgnLCcpCiAgICAgICAgfQogICAgICAgIF8uZWFjaChfLnNvcnRCeShsYWJlbE5hbWVzLCBmdW5jdGlvbihsbmFtZSkgewogICAgICAgICAgICByZXR1cm4gc2VsZi5sYWJlbGVyc09yZGVyW2xuYW1lXSB8fCAxMDAwMDA7CiAgICAgICAgfSksIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAtMTsgaSA8PSBzOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBtID0gc2VsZi5sYWJlbGVyc1tsbmFtZV0ocmljaFNlcXVlbmNlLCBpKTsKICAgICAgICAgICAgICAgIGlmIChtICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByaWNoU2VxdWVuY2UuYWRkTW9kaWZpY2F0aW9uKGksIG0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgIH0KICAgIC8qKgogICAgICoganVzdCByZXR1cm5zIGEgc29ydGVkIChhbHBoYW51bWVyaWMpIGxpc3Qgb2YgdGhlIGF2YWlsYWJsZSBsYWJlbHMKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUuYXZhaWxhYmxlTGFiZWxzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF8ua2V5cyh0aGlzLmxhYmVsZXJzKS5zb3J0KCk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbGwgbW9kaWZpY2F0aW9uIGFzc29jaWF0ZWQgdG8gdGhlIGxhYmVsIG9uIHRoZSByaWNoU2VxdWVuY2Ugb2JqZWN0LgogICAgICogQXQgdGhpcyBzdGFnZSwgd2UgYXNzdW1lIHRoZSByaWNoU2VxdWVuY2UgaGFzIHRoZSBtb2RpZiBhc3NvY2lhdGVkIHdpdGggdGhlIGxhYmVsCiAgICAgKiBAcGFyYW0ge09iamVjdH0gbGFiZWxOYW1lcyBhIGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIGxhYmVscyAod2UgY2FuIGhhdmUgJ3NpbGFjLHByb3BfZDAnLCBvciAncHJvcF9kMTAnKQogICAgICogQHBhcmFtIHtPYmplY3R9IHJpc2hTZXF1ZW5jZQogICAgICovCiAgICBJbXBsaWNpdE1vZGlmaWVyLnByb3RvdHlwZS51bmxhYmVsID0gZnVuY3Rpb24obGFiZWxOYW1lcywgcmljaFNlcXVlbmNlKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICB2YXIgcyA9IHJpY2hTZXF1ZW5jZS5zaXplKCk7CiAgICAgICAgaWYgKCEgXy5pc0FycmF5KGxhYmVsTmFtZXMpKSB7CiAgICAgICAgICAgIGxhYmVsTmFtZXMgPSBsYWJlbE5hbWVzLnNwbGl0KCcsJykKICAgICAgICB9CiAgICAgICAgXy5lYWNoKF8uc29ydEJ5KGxhYmVsTmFtZXMsIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiAtKHNlbGYubGFiZWxlcnNPcmRlcltsbmFtZV0gfHwgMTAwMDAwKTsKICAgICAgICB9KSwgZnVuY3Rpb24obG5hbWUpIHsKICAgICAgICAgICAgZm9yICggaSA9IC0xOyBpIDw9IHM7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIG1vZGlmcyA9IHJpY2hTZXF1ZW5jZS5nZXRNb2RpZmljYXRpb25BcnJheShpKTsKICAgICAgICAgICAgICAgIGlmICghbW9kaWZzKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtb2RpZnMgPSBfLmRpZmZlcmVuY2UobW9kaWZzLCBzZWxmLmxhYmVsZXJzW2xuYW1lXShyaWNoU2VxdWVuY2UsIGkpKTsKICAgICAgICAgICAgICAgIHJpY2hTZXF1ZW5jZS5zZXRNb2RpZmljYXRpb25BcnJheShpLCBtb2RpZnMpCgogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIHJldHVybnMgYW4gYXJyYXkgd2l0aCB0aGUgbW9kaWZpZWQgcG9pc2l0aW9ucywgb25jZSBsYWJlaW5nIG1vZGlmIGhhdmUgYmVlbiByZW1vdmVkCiAgICAgKiAoLTEgPT4gbnRlcm0pCiAgICAgKi8KICAgIEltcGxpY2l0TW9kaWZpZXIucHJvdG90eXBlLm5vbmltcGxpY2l0TW9kaWZpZWRQb3MgPSBmdW5jdGlvbihyaWNoU2VxdWVuY2UpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgdmFyIHJzID0gcmljaFNlcXVlbmNlLmNsb25lKCk7CiAgICAgICAgc2VsZi5nZXRMYWJlbHNBbmRDbGVhbihycyk7CiAgICAgICAgcmV0dXJuIF8uZmlsdGVyKF8ucmFuZ2UoLTEsIHJzLnNpemUoKSksIGZ1bmN0aW9uKGkpIHsKICAgICAgICAgICAgcmV0dXJuIHJzLmNvdW50TW9kaWZpY2F0aW9uc0F0KGkpID4gMDsKICAgICAgICB9KQogICAgfQogICAgLyoqCiAgICAgKiByZXR1cm4gdHJ1ZS9mYWxzZSBpZiB0aGUgUmljaFNlcXVlbmNlIGlzIGZpbGxlZCB3aXRoIHRoZSBtb2RpZmljYXRpb24gY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gbGFiZWwuCiAgICAgKiBpLmUuIHdlIGNhbiByZW1vdmUgYWxsIHRoZSBtb2RpZiBhbmQgY29uc2lkZXIgdGhlIFJpY2hTZXF1ZW5jZSBhcyBpbXBsaWNpdGVseSBtb2RpZmllZAogICAgICogQHBhcmFtIHtPYmplY3R9IGxhYmVsTmFtZSBvbmUgbGFiZWwgbmFtZQogICAgICogQHBhcmFtIHtPYmplY3R9IHJpc2hTZXF1ZW5jZQogICAgICovCiAgICBJbXBsaWNpdE1vZGlmaWVyLnByb3RvdHlwZS5pc0xhYmVsZWQgPSBmdW5jdGlvbihsYWJlbE5hbWUsIHJpY2hTZXF1ZW5jZSkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIGF0TGVhc3RPbmUgPSBmYWxzZQogICAgICAgIHJldHVybiBfLmFsbChfLnJhbmdlKC0xLCByaWNoU2VxdWVuY2Uuc2l6ZSgpICsgMSksIGZ1bmN0aW9uKGkpIHsKICAgICAgICAgICAgdmFyIGV4cGVjdGVkTW9kaWYgPSBzZWxmLmxhYmVsZXJzW2xhYmVsTmFtZV0ocmljaFNlcXVlbmNlLCBpKTsKICAgICAgICAgICAgaWYgKGV4cGVjdGVkTW9kaWYgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJpY2hTZXF1ZW5jZS5jb3VudE1vZGlmaWNhdGlvbnNBdChpKSA9PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF0TGVhc3RPbmUgPSB0cnVlOwoKICAgICAgICAgICAgcmV0dXJuIF8uYW55KHJpY2hTZXF1ZW5jZS5nZXRNb2RpZmljYXRpb25BcnJheShpKSwgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG0gPT0gZXhwZWN0ZWRNb2RpZjsKICAgICAgICAgICAgfSk7CgogICAgICAgIH0pICYmIGF0TGVhc3RPbmU7CgogICAgfQogICAgLyoqCiAgICAgKiBjbGVhbiB1cCB0aGUgaW1wbGljaXQgbW9kaWZpY2F0aW9ucyAgYW5kIHJldHVybiBhIGxpc3Qgb2YgKHNvcnRlZCBhbHBoYSkgbGFiZWwgbmFtZXMgdGhhdCB3ZXJlIHVzZWQgZm9yIGNsZWFudXAKICAgICAqIEBwYXJhbSB7T2JqZWN0fSByaWNoU2VxdWVuY2UKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUuZ2V0TGFiZWxzQW5kQ2xlYW4gPSBmdW5jdGlvbihyaWNoU2VxdWVuY2UpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIHZhciBsYWJlbHMgPSBbXTsKICAgICAgICBfLmVhY2goXy5zb3J0QnkoXy5rZXlzKHNlbGYubGFiZWxlcnNPcmRlciksIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiAtKHNlbGYubGFiZWxlcnNPcmRlcltsbmFtZV0gfHwgMTAwMDAwKTsKICAgICAgICB9KSwgZnVuY3Rpb24obG5hbWUpIHsKICAgICAgICAgICAgaWYgKCFzZWxmLmlzTGFiZWxlZChsbmFtZSwgcmljaFNlcXVlbmNlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZi51bmxhYmVsKGxuYW1lLCByaWNoU2VxdWVuY2UpOwogICAgICAgICAgICBsYWJlbHMucHVzaChsbmFtZSkKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gbGFiZWxzLnNvcnQoKQogICAgfQogICAgcmV0dXJuIG5ldyBJbXBsaWNpdE1vZGlmaWVyKCk7Cn0pOwoKLyoqCiAqIGEgcmVjdGFuZ3VsYXIsIG5vIGxlZ2VuZCBjb2xvciBQU01BbGlnbm1lbnQgd2lkZ2V0CiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hNYXBTbGltVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInXSwgZnVuY3Rpb24oXywgQmFja2JvbmUsIENvbW1vbldpZGdldFZpZXcsIGltcGxpY2l0TW9kaWZpZXIpIHsKCiAgICBNYXRjaE1hcFNsaW1WaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBoZWlnaHQgOiAxMiwKICAgICAgICAgICAgdG9sIDogNTAwCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICBNYXRjaE1hcFNsaW1WaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgYXJndW1lbnRzKQogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgMTI7CiAgICAgICAgICAgIHNlbGYudG9sID0gb3B0aW9ucy50b2wgfHwgNTAwOwoKICAgICAgICB9LAogICAgICAgIHJlbmRlciA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgdGhlb1NwZWN0cnVtID0gc2VsZi5tb2RlbC5nZXQoJ3RoZW9TcGVjdHJ1bScpOwogICAgICAgICAgICB2YXIgbmJTZXJpZXMgPSB0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoCgogICAgICAgICAgICAvLyBnZXQgZnJhZyBzZXJpZXMgLT4gb3JkaW5hdGUKICAgICAgICAgICAgdmFyIHNlcmllczJqID0ge307CiAgICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgICAgXy5lYWNoKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSwgZnVuY3Rpb24oZnMpIHsKICAgICAgICAgICAgICAgIGlmIChzZXJpZXMyaltmc1swXV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2VyaWVzMmpbZnNbMF1dID0gaSsrOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBoUm93ID0gc2VsZi5oZWlnaHQgLyBfLmtleXMoc2VyaWVzMmopLmxlbmd0aDsKICAgICAgICAgICAgdmFyIHdDb2wgPSBoUm93OwoKICAgICAgICAgICAgdmFyIGxlblNlcSA9IHRoZW9TcGVjdHJ1bS5nZXQoJ2xlblNlcScpOwogICAgICAgICAgICB2YXIgd1RleHQgPSAzMDsKICAgICAgICAgICAgdmFyIHdpZHRoID0gbGVuU2VxICogd0NvbCArIHdUZXh0OwogICAgICAgICAgICB2YXIgaGVpZ2h0ID0gc2VsZi5oZWlnaHQ7CgogICAgICAgICAgICB2YXIgZnMyaiA9IGZ1bmN0aW9uKGZzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHNlcmllczJqW2ZzWzBdXSkgKiBoUm93OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRhdGEgbWF0Y2hlcwogICAgICAgICAgICB2YXIgZG1hdGNoZXMgPSBzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi50b2wpOwoKICAgICAgICAgICAgdmFyIHJlY3RCZyA9IHNlbGYuZWwuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpLmF0dHIoJ3dpZHRoJywgd2lkdGgpLmF0dHIoJ2hlaWdodCcsIGhlaWdodCkKICAgICAgICAgICAgdmFyIGdSb290ID0gc2VsZi5lbC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdmcmFnLWNvbG9yLW1hdGNoJyk7CiAgICAgICAgICAgIHByZWN0ID0gZ1Jvb3Quc2VsZWN0QWxsKCdyZWN0JykuZGF0YShkbWF0Y2hlcykuZW50ZXIoKQogICAgICAgICAgICBwcmVjdC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKGRtKSB7CiAgICAgICAgICAgICAgICB2YXIgaXJrID0gZG0uZXhwLmludGVuc2l0eVJhbms7CiAgICAgICAgICAgICAgICByZXR1cm4gInJrLSIgKyAoKGlyayA8IDQwKSA/IE1hdGguZmxvb3IoaXJrIC8gMTApIDogJ3gnKQogICAgICAgICAgICB9KS5hdHRyKCd4JywgZnVuY3Rpb24oZG0pIHsKICAgICAgICAgICAgICAgIGlmIChkbS50aGVvLnNlcmllcyA8ICdnJykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGRtLnRoZW8ucG9zICsgMC41KSAqIHdDb2wKICAgICAgICAgICAgICAgIGlmIChkbS50aGVvLnBvcyA9PSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgICAgICByZXR1cm4gKGRtLnRoZW8ucG9zIC0gMC41KSAqIHdDb2wKICAgICAgICAgICAgfSkuYXR0cigneScsIGZ1bmN0aW9uKGRtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnMyaihkbS50aGVvLnNlcmllcykKICAgICAgICAgICAgfSkuYXR0cignd2lkdGgnLCBmdW5jdGlvbihkbSkgewogICAgICAgICAgICAgICAgaWYgKChkbS50aGVvLnBvcyA9PSAwKSAmJiAoZG0udGhlby5zZXJpZXMgPiAnZycpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB3Q29sIC8gMjsKICAgICAgICAgICAgICAgIGlmICgoZG0udGhlby5wb3MgPT0gbGVuU2VxIC0gMSkgJiYgKGRtLnRoZW8uc2VyaWVzIDwgJ2cnKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd0NvbCAvIDI7CiAgICAgICAgICAgICAgICByZXR1cm4gd0NvbDsKICAgICAgICAgICAgfSkuYXR0cignaGVpZ2h0JywgaFJvdykuYXR0cigndGl0bGUnLCBmdW5jdGlvbihkbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRtLnRoZW8ubGFiZWwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbW9kUG9zID0gaW1wbGljaXRNb2RpZmllci5ub25pbXBsaWNpdE1vZGlmaWVkUG9zKHNlbGYubW9kZWwuZ2V0KCdyaWNoU2VxdWVuY2UnKSk7CiAgICAgICAgICAgIGdSb290LnNlbGVjdEFsbCgncmVjdC5tb2RpZmllZC1zaXRlJykuZGF0YShtb2RQb3MpLmVudGVyKCkuYXBwZW5kKCdyZWN0JykuY2xhc3NlZCgnbW9kaWZpZWQtc2l0ZScsIHRydWUpLmF0dHIoJ3gnLCBmdW5jdGlvbihpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaSAqIHdDb2w7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCAwKS5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCkuYXR0cignd2lkdGgnLCB3Q29sKTsKCiAgICAgICAgICAgIHZhciBnID0gc2VsZi5lbC5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAod2lkdGggLSB3VGV4dCkgKyAnLDApJyk7CiAgICAgICAgICAgIGcuYXBwZW5kKCdyZWN0JykuY2xhc3NlZCgnbWF0Y2gtYm94LXRleHQtYmcnLCB0cnVlKS5hdHRyKCd3aWR0aCcsIHdUZXh0KS5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBnLmFwcGVuZCgnZycpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJysod1RleHQgLSA1KSsnLDIpLHNjYWxlKCcraGVpZ2h0KycsJytoZWlnaHQrJyknKS4KICAgICAgICAgICAgYXBwZW5kKCd0ZXh0JykuY2xhc3NlZCgndW5tYXRjaGVkLWZhY3RvcicsIHRydWUpLnRleHQoIi8iICsgc2VsZi5tb2RlbC51bm1hdGNoZWRGYWN0b3Ioc2VsZi50b2wsIDEwKSkKCiAgICAgICAgICAgIHNlbGYuZGltID0gewogICAgICAgICAgICAgICAgaGVpZ2h0IDogc2VsZi5oZWlnaHQsCiAgICAgICAgICAgICAgICB3aWR0aCA6IHdpZHRoCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGltCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIE1hdGNoTWFwU2xpbVZpZXc7Cn0pOwoKLyoqCiAqIFRoZSBQUSB3aWRnZXQgKFBRID0gInRvaWxldCBwYXBlciIgaW4gZnJlbmNoKSBpcyBkaXNrIHByb2plY3RlZCBkYXRhLCB3aGljaCBjYW4gYmUgcHVsbGVkIG9mIHdoZW4gbW91c2luZyBvdmVyCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvdXRpbHMvUFFWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnZDMnXSwgZnVuY3Rpb24oXywgZDMpIHsKCiAgUFFWaWV3ID0gZnVuY3Rpb24odGFyZ2V0LCBvcHRpb25zKSB7CiAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgdGhpcy5yYWRpdXMgPSBvcHRpb25zLnJhZGl1cyB8fCA1MDsKICAgIHRoaXMudGltZSA9IG9wdGlvbnMudGltZSB8fCAxMjU7CiAgICB0aGlzLnJvdGF0aW5nID0gMDsKICAgIHRoaXMub25jbGljayA9IG9wdGlvbnMub25jbGljazsKCiAgICBpZiAoIHR5cGVvZiB0YXJnZXQgPT0gJ29iamVjdCcpIHsKICAgICAgdGhpcy52aXMgPSB0YXJnZXQuYXBwZW5kKCdnJykKCiAgICB9IGVsc2UgewogICAgICB0aGlzLnZpcyA9IGQzLnNlbGVjdCh0YXJnZXQpLmFwcGVuZCgnZycpCiAgICB9CiAgfQoKICBQUVZpZXcucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24oc2VjdG9yQ2xhc3NlcywgcmVjdEJ1aWxkRnVuY3Rpb24pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHNlbGYubGVuID0gc2VjdG9yQ2xhc3Nlcy5sZW5ndGg7CiAgICBzZWxmLnNlY3RvckNsYXNzZXMgPSBzZWN0b3JDbGFzc2VzOwoKICAgIHNlbGYuc3ZnUmVjdCA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJysgc2VsZi5yYWRpdXMrJywwKScpOwogICAgc2VsZi5yZWN0ID0gc2VsZi5zdmdSZWN0LmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3JlY3QtY29udGFpbmVyJyk7CiAgICBzZWxmLmRpbVJlY3QgPSByZWN0QnVpbGRGdW5jdGlvbihzZWxmLnJlY3QpOwogICAgc2VsZi5zdmdSZWN0LmF0dHIoJ3dpZHRoJywgc2VsZi5kaW1SZWN0LndpZHRoKQoKICAgIHNlbGYucmVjdC5hdHRyKCd0cmFuc2Zvcm0nLCAnc2NhbGUoMCwxKScpOwogICAgc2VsZi5zdmdSZWN0LmF0dHIoJ3gnLCBzZWxmLnJhZGl1cyk7CiAgICBzZWxmLnZpcy5hdHRyKCdoZWlnaHQnLCAyICogc2VsZi5yYWRpdXMpLmF0dHIoJ3dpZHRoJywgc2VsZi5yYWRpdXMgKyBzZWxmLmRpbVJlY3Qud2lkdGgpOwoKICB9CgogIFBRVmlldy5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBjaXJjbGUgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyBzZWxmLnJhZGl1cyArICcsJyArIHNlbGYucmFkaXVzICsgJyknKS5hcHBlbmQoJ2cnKTsKCiAgICB2YXIgYXJjID0gZDMuc3ZnLmFyYygpLm91dGVyUmFkaXVzKHNlbGYucmFkaXVzKS5pbm5lclJhZGl1cygwKS5zdGFydEFuZ2xlKGZ1bmN0aW9uKHYsIGkpIHsKICAgICAgcmV0dXJuIDIgKiAzLjE0ICogaSAvIHNlbGYubGVuOwogICAgfSkuZW5kQW5nbGUoZnVuY3Rpb24odiwgaSkgewogICAgICByZXR1cm4gMiAqIDMuMTQgKiAoaSArIDEpIC8gc2VsZi5sZW47CiAgICB9KTsKICAgIHZhciBwY2lyYyA9IGNpcmNsZS5zZWxlY3RBbGwoJ2cuY2lyY2xlJykuZGF0YShzZWxmLnNlY3RvckNsYXNzZXMpLmVudGVyKCkuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnY2lyY2xlJyk7CiAgICBwY2lyYy5hcHBlbmQoJ3BhdGgnKS5hdHRyKCdkJywgYXJjKS5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKGQsIGkpIHsKICAgICAgcmV0dXJuIGQgKyAnIHNlY3RvciBzZWN0b3ItJyArIGkKICAgIH0pLmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiBkMy5yZ2IoMjU1IC8gMTAgKiBkLCAyNTUgLyAxMCAqIGQsIDI1NSAvIDEwICogZCkKICAgIH0pOwogICAgdmFyIG1za0NpcmNsZSA9IGNpcmNsZS5hcHBlbmQoJ2NpcmNsZScpLmF0dHIoJ3InLCBzZWxmLnJhZGl1cykuYXR0cignZmlsbC1vcGFjaXR5JywgJzAnKS5hdHRyKCdmaWxsJywgJ3llbGxvdycpLnN0eWxlKCdjdXJzb3InLCAnaGFuZCcpOwoKICAgIG1za0NpcmNsZS5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oKSB7CiAgICAgIHNlbGYucm9sbE91dChjaXJjbGUpOwogICAgfSk7CiAgICBtc2tDaXJjbGUub24oJ21vdXNlb3V0JywgZnVuY3Rpb24oKSB7CiAgICAgIHNlbGYucm9sbEJhY2soY2lyY2xlKTsKICAgIH0pOwogICAgaWYgKHNlbGYub25jbGljaykgewogICAgICBtc2tDaXJjbGUub24oJ2NsaWNrJywgc2VsZi5vbmNsaWNrKTsKICAgIH0KICB9CgogIFBRVmlldy5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHRoaXMudmlzLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArICh4IC0gc2VsZi5yYWRpdXMpICsgJywnICsgKHkgLSBzZWxmLnJhZGl1cykgKyAnKScpLnN0eWxlKCdsZWZ0JywgeCArICdweCcpLnN0eWxlKCdsZWZ0JywgeSArICdweCcpLnN0eWxlKCdwb3NpdGlvbicsICdyZWxhdGl2ZScpOwogICAgcmV0dXJuIHRoaXMKICB9CgogIFBRVmlldy5wcm90b3R5cGUucm9sbE91dCA9IGZ1bmN0aW9uKGNpcmNsZSwgb3B0aW9ucykgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKHNlbGYucm90YXRpbmcgPiAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHNlbGYucm90YXRpbmcgPSAxOwogICAgdmFyIGNwdCA9IDA7CiAgICB2YXIgZHQgPSBzZWxmLnRpbWUgLyBzZWxmLmxlbjsKICAgIHZhciB3UmVjdCA9IHNlbGYuZGltUmVjdC53aWR0aDsKICAgIGZvciAoIGkgPSAwOyBpIDwgc2VsZi5sZW47IGkrKykgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChzZWxmLnJvdGF0aW5nIDw9IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY2lyY2xlLmF0dHIoJ3RyYW5zZm9ybScsICdyb3RhdGUoJyArICgoY3B0ICsgMSkgLyBzZWxmLmxlbiAqIDM2MCkgKyAnKScpOwogICAgICAgIGNwdCsrOwogICAgICAgIHNlbGYucmVjdC5hdHRyKCd0cmFuc2Zvcm0nLCAnc2NhbGUoJyArICgoaSArIDEpIC8gc2VsZi5sZW4pICsgJywxKScpOwogICAgICAgIC8vKTsndHJhbnNsYXRlKCcgKyAoKGNwdCAtIHNlbGYubGVuKSAqIHdSZWN0IC8gc2VsZi5sZW4pICsgJywwKScpOwoKICAgICAgICBjaXJjbGUuc2VsZWN0QWxsKCcuc2VjdG9yLScgKyAoc2VsZi5sZW4gLSBjcHQpKS5hdHRyKCdkaXNwbGF5JywgJ25vbmUnKTsKICAgICAgICBpZiAoY3B0ID09IHNlbGYubGVuKSB7CiAgICAgICAgICBzZWxmLnJvdGF0aW5nID0gMDsKICAgICAgICB9CiAgICAgIH0sIGkgKiBkdCk7CiAgICB9CiAgfQogIFBRVmlldy5wcm90b3R5cGUucm9sbEJhY2sgPSBmdW5jdGlvbihjaXJjbGUsIG9wdGlvbnMpIHsKCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBpZiAoc2VsZi5yb3RhdGluZyA8IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc2VsZi5yb3RhdGluZyA9IC0xOwogICAgdmFyIGNwdCA9IHNlbGYubGVuIC0gMTsKICAgIHZhciBkdCA9IHNlbGYudGltZSAvIHNlbGYubGVuOwogICAgdmFyIHdSZWN0ID0gc2VsZi5kaW1SZWN0LndpZHRoOwogICAgZm9yICggaSA9IDA7IGkgPCBzZWxmLmxlbjsgaSsrKSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHNlbGYucm90YXRpbmcgPj0gMCkgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGNpcmNsZS5hdHRyKCd0cmFuc2Zvcm0nLCAncm90YXRlKCcgKyAoY3B0IC8gc2VsZi5sZW4gKiAzNjApICsgJyknKTsKICAgICAgICAvLyAgICAgICAgdmFyIHRyID0gJ3RyYW5zbGF0ZSgnICsgKChjcHQgLSBzZWxmLmxlbikgKiB3UmVjdCAvIHNlbGYubGVuKSArICcsMCknOwogICAgICAgIHZhciB0ciA9ICdzY2FsZSgnICsgKDEgLSBpIC8gc2VsZi5sZW4pICsgJywxKSc7CiAgICAgICAgc2VsZi5yZWN0LmF0dHIoJ3RyYW5zZm9ybScsIHRyKTsKCiAgICAgICAgdmFyIHNlbCA9ICcuc2VjdG9yLScgKyAoc2VsZi5sZW4gLSBjcHQgLSAxKTsKICAgICAgICBjaXJjbGUuc2VsZWN0QWxsKHNlbCkuYXR0cignZGlzcGxheScsIG51bGwpCiAgICAgICAgY3B0LS07CiAgICAgICAgaWYgKGNwdCA8IDApIHsKICAgICAgICAgIHNlbGYucm90YXRpbmcgPSAwOwogICAgICAgIH0KICAgICAgfSwgaSAqIGR0KTsKICAgIH0KCiAgfQoKICByZXR1cm4gUFFWaWV3Owp9KTsKCi8qCiAqIHdpdGRnZXQgdG8gZGlzcGxheSBQU00sIGJhc2VkIG9uIHRoZSBzcGVjdHJ1bSBwZXJzcGVjdGl2ZQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLFsndW5kZXJzY29yZScsICdkMycsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0NvbnRleHQnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0FyZWEnXSwgZnVuY3Rpb24gKF8sIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CgogICAgTWF0Y2hTcGVjdHJ1bVZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIE1hdGNoU3BlY3RydW1WaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucykKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgICAgICAgc2VsZi5vcHRpb25zID0gb3B0aW9uczsKCiAgICAgICAgICAgIHNlbGYudG9sID0gb3B0aW9ucy50b2wgfHwgNTAwOwoKICAgICAgICAgICAgc2VsZi5oZWlnaHRYQXhpcyA9IDIxOwogICAgICAgICAgICBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQgPSAxMDsKCiAgICAgICAgICAgIGlmIChvcHRpb25zLmZseWluZykgewogICAgICAgICAgICAgICAgc2VsZi5lbCA9IGQzLnNlbGVjdCgnYm9keScpOwogICAgICAgICAgICAgICAgc2VsZi5pc0ZseWluZyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWxmLmlzRmx5aW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZi5wX3NldHVwKCk7CgogICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLnhab29tYWJsZSkgewogICAgICAgICAgICAgICAgc2VsZi54Wm9vbWFibGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICB9LAogICAgICAgIHBfc2V0dXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAvLyB2YXIgZXZ0ID0gZDMubW91c2Uoc2VsZi5jb250YWluZXIpOwogICAgICAgICAgICBzZWxmLnZpcyA9IHNlbGYuZWwuYXBwZW5kKCdzdmcnKQogICAgICAgICAgICBzZWxmLnZpcy5hdHRyKCd3aWR0aCcsIHNlbGYud2lkdGgoKSkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQoKSkuYXR0cignY2xhc3MnLCAnZDMtd2lkZ2V0LW1hdGNoLXNwZWN0cnVtJyk7CiAgICAgICAgICAgIGlmIChzZWxmLmlzRmx5aW5nKSB7CiAgICAgICAgICAgICAgICB2YXIgeCA9IGQzLmV2ZW50LnBhZ2VYICsgMTA7CiAgICAgICAgICAgICAgICB2YXIgeSA9IGQzLmV2ZW50LnBhZ2VZIC0gc2VsZi5oZWlnaHQoKSAqIDIgLyAzOwogICAgICAgICAgICAgICAgc2VsZi52aXMuc3R5bGUoJ2xlZnQnLCB4ICsgJ3B4Jykuc3R5bGUoJ3RvcCcsIHkgKyAncHgnKTsKICAgICAgICAgICAgICAgIHNlbGYucF9mbHlpbmdfZG9udF9mbHlfYXdheSgpOwoKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBzZWxmLnZpcy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCd3aWR0aCcsICcxMDAlJykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCdmaWxsJywgJyNkZGQnKS5hdHRyKCdjbGFzcycsICdiYWNrZ3JvdW5kJyk7CgogICAgICAgICAgICBzZWxmLnBfc2V0dXBfdGl0bGUoKTsKCiAgICAgICAgICAgIGlmIChzZWxmLmlzRmx5aW5nKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1dHRvbkNvbnRhaW5lciA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2J1dHRvbi1jb250YWluZXIgcmlnaHQtYWxpZ24nKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyBzZWxmLndpZHRoKCkgKyAnLDApJykKICAgICAgICAgICAgICAgIHNlbGYucF9zZXR1cF9tZW51X2J1dHRvbnMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gYWRkIHNwZWN0cnVtCiAgICAgICAgICAgIHZhciBleHBTcCA9IHNlbGYubW9kZWwuZ2V0KCdleHBTcGVjdHJ1bScpOwogICAgICAgICAgICB2YXIgaFNwZWN0cnVtID0gc2VsZi5oZWlnaHQoKSAtIDIwIC0gc2VsZi5oZWlnaHRYQXhpczsKCiAgICAgICAgICAgIHNlbGYucF9idWlsZF9kYXRhKCk7CiAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgICAgICAgICB4RG9tYWluOiBbZXhwU3AuZ2V0KCdtb3pzJylbMF0gKiAwLjk1LCBleHBTcC5nZXQoJ21venMnKVtleHBTcC5zaXplKCkgLSAxXSAqIDEuMDVdLAogICAgICAgICAgICAgICAgeURvbWFpbjogWzAsIF8ubWF4KF8ucGx1Y2soc2VsZi5kYXRhLnBlYWtzLCAneScpKSAqIDEuMl0sCiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhTcGVjdHJ1bSAtIHNlbGYucGVha3NCYXNlbGluZUhlaWdodCwKICAgICAgICAgICAgICAgIHdpZHRoOiBzZWxmLndpZHRoKCkKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIHZhciBzdmdzcCA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwyMCknKTsKICAgICAgICAgICAgc2VsZi5zdmdzcCA9IHN2Z3NwOwoKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQXJlYSA9IG5ldyBEM1NjYWxpbmdBcmVhKHsKICAgICAgICAgICAgICAgIGVsOiBzdmdzcCwKICAgICAgICAgICAgICAgIG1vZGVsOiBzZWxmLnNjYWxpbmdDb250ZXh0LAogICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcigpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaGVpZ2h0OiBoU3BlY3RydW0sCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc2VsZi5kM0hvbGRlclhBeGlzID0gc3Znc3AuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAneGF4aXMnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIGhTcGVjdHJ1bSArICcpJyk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQcmVjdXJzb3IgPSBzdmdzcC5zZWxlY3RBbGwoJ2cucHJlY3Vyc29yJykuZGF0YShzZWxmLmRhdGEucHJlY3Vyc29yKS5lbnRlcigpLmFwcGVuZCgnZycpCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQcmVjdXJzb3IuYXBwZW5kKCdwYXRoJykuYXR0cignY2xhc3MnLCAncHJlY3Vyc29yJykuYXR0cignZCcsICdNMCwtMjBMMTAsMEwtMTAsMEwwLC0yMCcpLmF0dHIoJ3gnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAueDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQZWFrcyA9IHN2Z3NwLnNlbGVjdEFsbCgnbGluZS5wZWFrJykuZGF0YShzZWxmLmRhdGEucGVha3MpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHZhciBjbGF6eiA9ICdwZWFrJzsKICAgICAgICAgICAgICAgIGlmIChway5sYWJlbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgY2xhenogKz0gJyBtYXRjaGVkIGZyYWctc2VyaWVzLScgKyBway5sYWJlbC5sYWJlbC5zZXJpZXMucmVwbGFjZSgnKysnLCAnJykKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2xhenogKz0gJyB1bm1hdGNoZWQnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY2xhenoKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQZWFrc1RydW5jYXRlZCA9IHN2Z3NwLnNlbGVjdEFsbCgnbGluZS5wZWFrLXRydW5jYXRlZCcpLmRhdGEoc2VsZi5kYXRhLnBlYWtzVHJ1bmNhdGVkKS5lbnRlcigpLmFwcGVuZCgnbGluZScpOwoKICAgICAgICAgICAgc2VsZi5wX3NldHVwX2xhYmVscygpOwoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGRpdiB3aXRoIGZseWluZyBzcGVjdHJ1bSBpcyBwb2lzdGlvbiBzb213aGVyZSAoYnkgdGhlIHZlbnRzb3VyY2UsIGZvciBleGFtcGxlKQogICAgICAgICAqIG5lcnZlcnRoZWxlc3MsIGl0IHNob3VsZCBub3QgZ28gb3V0c2lkZSB0aGUgbWFpbiB3aW5kb3cKICAgICAgICAgKi8KICAgICAgICBwX2ZseWluZ19kb250X2ZseV9hd2F5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQoc2VsZi52aXMuc3R5bGUoJ2xlZnQnKSk7CiAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQoc2VsZi52aXMuc3R5bGUoJ3RvcCcpKTsKICAgICAgICAgICAgdmFyIG1pbkRpc3QgPSAyMDsKCiAgICAgICAgICAgIHggPSBNYXRoLm1heCh4LCBtaW5EaXN0KTsKICAgICAgICAgICAgeCA9IE1hdGgubWluKHgsIHdpbmRvdy5pbm5lcldpZHRoIC0gc2VsZi53aWR0aCgpIC0gbWluRGlzdCk7CgogICAgICAgICAgICB5ID0gTWF0aC5tYXgoeSwgbWluRGlzdCk7CiAgICAgICAgICAgIHkgPSBNYXRoLm1pbih5LCAkKGRvY3VtZW50KS5oZWlnaHQoKSAtIHNlbGYuaGVpZ2h0KCkgLSBtaW5EaXN0KQoKICAgICAgICAgICAgc2VsZi52aXMuc3R5bGUoJ2xlZnQnLCB4KQogICAgICAgICAgICBzZWxmLnZpcy5zdHlsZSgndG9wJywgeSkKCiAgICAgICAgfSwKICAgICAgICBwX3NldHVwX2xhYmVsczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICBzZWxmLnN2Z3NwLnNlbGVjdEFsbCgnZy5sYWJlbCcpLnJlbW92ZSgpOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzID0gc2VsZi5zdmdzcC5zZWxlY3RBbGwoJ2cubGFiZWwnKS5kYXRhKHNlbGYuZGF0YS5sYWJlbHMpLmVudGVyKCkuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNQYXRoID0gc2VsZi5kM2hvbGRlckxhYmVscy5hcHBlbmQoJ3BhdGgnKQogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzVGV4dEcgPSBzZWxmLmQzaG9sZGVyTGFiZWxzLmFwcGVuZCgnZycpCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNUZXh0ID0gc2VsZi5kM2hvbGRlckxhYmVsc1RleHRHLmFwcGVuZCgndGV4dCcpCiAgICAgICAgICAgIHJldHVybiBzZWxmCiAgICAgICAgfSwKICAgICAgICBwX3NldHVwX3RpdGxlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgLy8gdGl0bGUKICAgICAgICAgICAgdmFyIGV4cFNwID0gc2VsZi5tb2RlbC5nZXQoJ2V4cFNwZWN0cnVtJykKICAgICAgICAgICAgdmFyIHRpdGxlID0gJ3NjYW46ICcgKyBleHBTcC5nZXQoJ3NjYW5OdW1iZXInKSArICcgKCcgKyAoTWF0aC5yb3VuZChleHBTcC5nZXQoJ3JldGVudGlvblRpbWUnKSkgLyA2MCkudG9GaXhlZCgxKSArICdtaW4pICcgKyBleHBTcC5nZXQoJ3ByZWNDaGFyZ2UnKSArICcrICcgKyBleHBTcC5nZXQoJ3ByZWNNb3onKS50b0ZpeGVkKDQpICsgJ0RhJzsKICAgICAgICAgICAgc2VsZi52aXMuYXBwZW5kKCd0ZXh0JykuYXR0cigneCcsIDUpLmF0dHIoJ3knLCA1KS5hdHRyKCdjbGFzcycsICd0aXRsZScpLnRleHQodGl0bGUpOwogICAgICAgICAgICBzZWxmLnZpcy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdoZWlnaHQnLCAnMjAnKS5hdHRyKCd3aWR0aCcsICcxMDAlJykuYXR0cignY2xhc3MnLCAndGl0bGUnKS50ZXh0KHRpdGxlKTsKCiAgICAgICAgfSwKICAgICAgICBwX25ld19idXR0b246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbiA9IHNlbGYuYnV0dG9uQ29udGFpbmVyLnNlbGVjdEFsbCgnZy5idXR0b24tY29udGFpbmVyJylbMF0ubGVuZ3RoCiAgICAgICAgICAgIHJldHVybiBzZWxmLmJ1dHRvbkNvbnRhaW5lci5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdidXR0b24tY29udGFpbmVyJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgtJyArIChuICsgMSkgKiA0MiArICcsMiknKTsKICAgICAgICB9LAogICAgICAgIHBfc2V0dXBfbWVudV9idXR0b25zOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciBhZGRCdXR0b24gPSBmdW5jdGlvbiAoZ2J1dCwgdGV4dCwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIGVsV3JhcHBlciA9IGdidXQuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgICAgICAvLy5hdHRyKCd0cmFuc2Zvcm0nLCAnc2NhbGUoJyArIChvcHRpb25zLnNpemUgLyA0MCkgKyAnLCcgKyAob3B0aW9ucy5zaXplIC8gNDApICsgJyknKTsKICAgICAgICAgICAgICAgIGdidXQuY2xhc3NlZCgnYnV0dG9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBlbFdyYXBwZXIuYXBwZW5kKCdyZWN0JykuYXR0cignd2lkdGgnLCA0MCkuYXR0cignaGVpZ2h0JywgMTYpLmF0dHIoJ3J4JywgNCkuYXR0cigncnknLCA0KS5jbGFzc2VkKCdidXR0b24nLCB0cnVlKTsKICAgICAgICAgICAgICAgIGdidXQuYXBwZW5kKCd0ZXh0JykuYXR0cigneCcsIDIwKS5hdHRyKCd5JywgMTEpLnRleHQodGV4dCk7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmN1cnNvcikgewogICAgICAgICAgICAgICAgICAgIGdidXQuc3R5bGUoJ2N1cnNvcicsIG9wdGlvbnMuY3Vyc29yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBnYnV0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNsb3NlCiAgICAgICAgICAgIHZhciBnYnV0ID0gc2VsZi5wX25ld19idXR0b24oKTsKICAgICAgICAgICAgYWRkQnV0dG9uKGdidXQsICdjbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIHJlc2l6ZQogICAgICAgICAgICBnYnV0ID0gc2VsZi5wX25ld19idXR0b24oKTsKCiAgICAgICAgICAgIGFkZEJ1dHRvbihnYnV0LCAnbGFyZ2VyJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHNlbGYuaGVpZ2h0KCkgPCAzMDApIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlc2l6ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5taW4oJChkb2N1bWVudCkud2lkdGgoKSAqIDAuOSwgMTAwMCkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlc2l6ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogNTAwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIGRyYWcKICAgICAgICAgICAgZ2J1dCA9IHNlbGYucF9uZXdfYnV0dG9uKCk7CiAgICAgICAgICAgIGFkZEJ1dHRvbihnYnV0LCAnbW92ZScsIHsKICAgICAgICAgICAgICAgIGN1cnNvcjogJ21vdmUnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBzZXR1cCBkcmFnZ2luCiAgICAgICAgICAgIHZhciBkcmFnQ29vcmQgPSB7CiAgICAgICAgICAgICAgICB4OiAxMDAwLAogICAgICAgICAgICAgICAgeTogMTAwMAogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgZHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKS5vbigiZHJhZ3N0YXJ0IiwgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIGRyYWdDb29yZCA9IHsKICAgICAgICAgICAgICAgICAgICBteDogZDMuZXZlbnQuc291cmNlRXZlbnQucGFnZVgsCiAgICAgICAgICAgICAgICAgICAgbXk6IGQzLmV2ZW50LnNvdXJjZUV2ZW50LnBhZ2VZLAogICAgICAgICAgICAgICAgICAgIHZ4OiBwYXJzZUludChzZWxmLnZpcy5zdHlsZSgnbGVmdCcpLnJlcGxhY2UoJ3B4JywgJycpKSwKICAgICAgICAgICAgICAgICAgICB2eTogcGFyc2VJbnQoc2VsZi52aXMuc3R5bGUoJ3RvcCcpLnJlcGxhY2UoJ3B4JywgJycpKSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pLm9uKCJkcmFnIiwgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIG14ID0gZDMuZXZlbnQuc291cmNlRXZlbnQucGFnZVg7CiAgICAgICAgICAgICAgICBteSA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50LnBhZ2VZOwoKICAgICAgICAgICAgICAgIHNlbGYudmlzLnN0eWxlKCJsZWZ0IiwgKGRyYWdDb29yZC52eCArIG14IC0gZHJhZ0Nvb3JkLm14KSArICdweCcpLnN0eWxlKCJ0b3AiLCAoZHJhZ0Nvb3JkLnZ5ICsgbXkgLSBkcmFnQ29vcmQubXkpICsgJ3B4Jyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBnYnV0LmNhbGwoZHJhZyk7CgogICAgICAgICAgICAvL2VkaXQKICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5lZGl0VXJsKSB7CiAgICAgICAgICAgICAgICBnYnV0ID0gc2VsZi5wX25ld19idXR0b24oKTsKCiAgICAgICAgICAgICAgICBhZGRCdXR0b24oZ2J1dCwgJ2VkaXQnKTsKICAgICAgICAgICAgICAgIGdidXQub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHNlbGYub3B0aW9ucy5lZGl0VXJsLCAnZXBpLXNob3dfX0lEX0lOVEVSQUNUSVZFX19YSUMnKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gLy8uYXBwZW5kKCd0ZXh0JykuYXR0cigneScsIDE0KS50ZXh0KCc/JykKICAgICAgICAgICAgICAgIC8vIHZhciBiID0gZDNHbHlwaGljb25zLmFwcGVuZChhLCAnYmlub2N1bGFycycsIHsKICAgICAgICAgICAgICAgIC8vIHNpemUgOiAyNCwKICAgICAgICAgICAgICAgIC8vIGJ1dHRvbiA6IHRydWUKICAgICAgICAgICAgICAgIC8vIH0pOwoKICAgICAgICAgICAgfQoKICAgICAgICB9LAogICAgICAgIC8qCiAgICAgICAgICogYnVpbGQgZGF0YSByZWFkeSBmb3IgcGxvdHRpbmc6IC0gcGVha3MgLSBsYWJlbCAtIHByZWN1cnNvcgogICAgICAgICAqIFRPRE86IGF0dGFjaGUgbGFiZWwgdG8gcGVhaywgZmlsdGVyIGRhdGEgb24gXy5wbHVjayhwZWFrcywgJ2xhYmVsJykuZmlsdGVyKGZ1bmN0aW9uKGwpe3JldHVybiBsIT09IHVuZGVmaW5lZH0pCiAgICAgICAgICogc28gZXZlcnl0aGluZyBpcyBhdHRhY2hlZCB0b2dldGhlciBhdCBvbmNlCiAgICAgICAgICogVE9ETyBhdHRhY2hlIHRoZSB0cnVuY2F0ZWQgaW5mbyBpbiB0aGUgc2FtZSB3YXkuCiAgICAgICAgICogVE9ETyBhdCB2aWV3IHRpbWUsIHdlIGNhbiBzdGFydCBldmVyeSB0aGluZyBvbiBhIGcgc2hpZnQgdG8gdGhlIGNvcnJlY3QgcG9zaXRpb24KICAgICAgICAgKi8KICAgICAgICBwX2J1aWxkX2RhdGE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgZXhwU3AgPSBzZWxmLm1vZGVsLmdldCgnZXhwU3BlY3RydW0nKTsKCiAgICAgICAgICAgIHZhciByZXQgPSB7fTsKICAgICAgICAgICAgdmFyIGRtYXRjaGVzID0gc2VsZi5tb2RlbC5jbG9zZXJUaGFuUFBNKHNlbGYudG9sKQoKICAgICAgICAgICAgdmFyIGxhYmVsZWRQZWFrcyA9IFtdOwogICAgICAgICAgICByZXQubGFiZWxzID0gXy5jb2xsZWN0KGRtYXRjaGVzLCBmdW5jdGlvbiAoZG0pIHsKICAgICAgICAgICAgICAgIHZhciByZXQgPSB7CiAgICAgICAgICAgICAgICAgICAgeDogZG0uZXhwLm1veiwKICAgICAgICAgICAgICAgICAgICB5OiBleHBTcC5nZXQoJ2ludGVuc2l0aWVzJylbZG0uZXhwLmluZGV4XSwKICAgICAgICAgICAgICAgICAgICBsYWJlbDogZG0udGhlbwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGxhYmVsZWRQZWFrc1tkbS5leHAuaW5kZXhdID0gcmV0OwogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXQucGVha3MgPSBfLmNvbGxlY3QoXy56aXAoZXhwU3AuZ2V0KCdtb3pzJyksIGV4cFNwLmdldCgnaW50ZW5zaXRpZXMnKSwgZXhwU3AuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKSwgZnVuY3Rpb24gKHAsIGkpIHsKICAgICAgICAgICAgICAgIHZhciBwayA9IHsKICAgICAgICAgICAgICAgICAgICB4OiBwWzBdLAogICAgICAgICAgICAgICAgICAgIHk6IHBbMV0sCiAgICAgICAgICAgICAgICAgICAgaW50UmFuazogcFsyXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGxhYmVsZWRQZWFrc1tpXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcGsubGFiZWwgPSBsYWJlbGVkUGVha3NbaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcGs7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXQucGVha3NUcnVuY2F0ZWQgPSBbXQogICAgICAgICAgICB2YXIgc29ydGVkSW50ZW5zaXRpZXMgPSBfLmNoYWluKHJldC5wZWFrcykucGx1Y2soJ3knKS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYiAtIGEKICAgICAgICAgICAgfSkudmFsdWUoKTsKICAgICAgICAgICAgaWYgKHNvcnRlZEludGVuc2l0aWVzWzBdID4gMS41ICogc29ydGVkSW50ZW5zaXRpZXNbMV0pIHsKICAgICAgICAgICAgICAgIHZhciBtYXhJbnRlbnMgPSBzb3J0ZWRJbnRlbnNpdGllc1sxXSAqIDEuMTsKICAgICAgICAgICAgICAgIF8uY2hhaW4ocmV0LnBlYWtzKS5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcC55ID4gbWF4SW50ZW5zCiAgICAgICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICAgICAgcC55ID0gbWF4SW50ZW5zOwogICAgICAgICAgICAgICAgICAgIHJldC5wZWFrc1RydW5jYXRlZC5wdXNoKHApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldC5wcmVjdXJzb3IgPSBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgeDogZXhwU3AuZ2V0KCdwcmVjTW96JykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQoKICAgICAgICAgICAgc2VsZi5kYXRhID0gcmV0OwogICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0sCiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy52aXMucmVtb3ZlKCk7CiAgICAgICAgfSwKCiAgICAgICAgcmVzaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgaCA9IG9wdGlvbnMuaGVpZ2h0IHx8IDIwMDsKICAgICAgICAgICAgc2VsZi5oZWlnaHQoaCkud2lkdGgob3B0aW9ucy53aWR0aCB8fCA1MDApOwoKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignaGVpZ2h0JywgaCkKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpCgogICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LmhlaWdodChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRYQXhpcyAtIHNlbGYucGVha3NCYXNlbGluZUhlaWdodCAtIDIwKTsKICAgICAgICAgICAgLy8gMjAgZm9yIHRoZSBtZW51IGxpbmUsCiAgICAgICAgICAgIC8vIDEwIGZvciB3YXRlciBsaW5lIC0KICAgICAgICAgICAgLy8gdWdseSwgbmVpPwogICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LndpZHRoKHNlbGYud2lkdGgoKSkKCiAgICAgICAgICAgIHNlbGYudmlzLnNlbGVjdEFsbCgnLnJpZ2h0LWFsaWduJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgc2VsZi53aWR0aCgpICsgJywwKScpOwogICAgICAgICAgICBpZiAoc2VsZi5pc0ZseWluZykgewogICAgICAgICAgICAgICAgc2VsZi5wX2ZseWluZ19kb250X2ZseV9hd2F5KCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2VsZi5yZW5kZXIoKQogICAgICAgIH0sCiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYucF9idWlsZF9kYXRhKCk7CiAgICAgICAgICAgIHNlbGYucF9zZXR1cF9sYWJlbHMoKTsKICAgICAgICAgICAgc2VsZi5yZW5kZXIoKTsKICAgICAgICB9LAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgeCA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwogICAgICAgICAgICB2YXIgeSA9IHNlbGYuc2NhbGluZ0NvbnRleHQueSgpOwoKICAgICAgICAgICAgc2VsZi5kM2hvbGRlclByZWN1cnNvci5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSAndHJhbnNsYXRlKCcgKyB4KHAueCkgKyAnLCcgKyAoeSgwKSArIDkpICsgJyknOwogICAgICAgICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeCkudGlja3MoNykudGlja1NpemUoNSk7CiAgICAgICAgICAgIHNlbGYuZDNIb2xkZXJYQXhpcy5jYWxsKHhBeGlzKTsKCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQZWFrcy5hdHRyKCd4MScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwLngpOwogICAgICAgICAgICB9KS5hdHRyKCd4MicsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwLngpOwogICAgICAgICAgICB9KS5hdHRyKCd5MScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geSgwKSArIHNlbGYucGVha3NCYXNlbGluZUhlaWdodDsKICAgICAgICAgICAgfSkuYXR0cigneTInLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHkocC55KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBzZWxmLnZpcy5zZWxlY3RBbGwoJ3JlY3QucGVhay1iYXNlbGluZScpLnJlbW92ZSgpOwogICAgICAgICAgICBzZWxmLnZpcy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsICdwZWFrLWJhc2VsaW5lIHJlbGF0aXZlLXNpemUnKS5hdHRyKCd5Jywgc2VsZi5oZWlnaHQoKSAtIHNlbGYucGVha3NCYXNlbGluZUhlaWdodCAtIHNlbGYuaGVpZ2h0WEF4aXMpLmF0dHIoJ2hlaWdodCcsIHNlbGYucGVha3NCYXNlbGluZUhlaWdodCkuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkgLSAyKS5hdHRyKCd4JywgMSkuYXR0cigncmVsYXRpdmVXaWR0aCcsIC0yKTsKCiAgICAgICAgICAgIHNlbGYuZDNIb2xkZXJYQXhpcy5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIChzZWxmLmhlaWdodCgpIC0gMjAgLSBzZWxmLmhlaWdodFhBeGlzKSArICcpJyk7CgogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUGVha3NUcnVuY2F0ZWQuYXR0cignY2xhc3MnLCAncGVhay10cnVuY2F0ZWQnKS5hdHRyKCd4MScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwLngpOwogICAgICAgICAgICB9KS5hdHRyKCd4MicsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwLngpOwogICAgICAgICAgICB9KS5hdHRyKCd5MScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geShwLnkpOwogICAgICAgICAgICB9KS5hdHRyKCd5MicsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICAwOy8vIHJldHVybiBzZWxmLnNjYWxpbmdDb250ZXh0LnlTY2FsZSgpKHAueSktMjA7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIGxhYlkgPSBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KHkocC55KSAtIDI4LCA4KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHMuYXR0cignY2xhc3MnLCAnbGFiZWwnKS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIHgocC54KSArICcsMCknOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVsc1BhdGguYXR0cignY2xhc3MnLCAnbGFiZWwtcG9pbnRlcicpLmF0dHIoJ2QnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgdmFyIGogPSB5KHAueSk7CiAgICAgICAgICAgICAgICByZXR1cm4gJ001LCcgKyBsYWJZKHApICsgJ2wtNSw4TDAsJyArIGo7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVsc1RleHRHLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gInRyYW5zbGF0ZSgxMCwgIiArIChsYWJZKHApIC0gMikgKyAiKSxyb3RhdGUoLTQ4KSIKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVsc1RleHQuYXR0cignY2xhc3MnLCAnbGFiZWwnKS50ZXh0KGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcC5sYWJlbC5sYWJlbDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChzZWxmLnJlbmRlckNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlckNhbGxiYWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBNYXRjaFNwZWN0cnVtVmlldzsKfSk7CgovKgogKiB0aGUgZGlzayB3aXRoIHVucm9sbGVkIHBlcHRpZGUgY292ZXJhZ2UgZm9yIFBTTQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJy4vTWF0Y2hNYXBTbGltVmlldycsICdmaXNodG9uZXMvdmlld3MvdXRpbHMvUFFWaWV3JywgJy4vTWF0Y2hTcGVjdHJ1bVZpZXcnXSwgZnVuY3Rpb24oXywgQmFja2JvbmUsIENvbW1vbldpZGdldFZpZXcsIE1hdGNoTWFwU2xpbVZpZXcsIFBRVmlldywgTWF0Y2hTcGVjdHJ1bVZpZXcpIHsKCiAgICBNYXRjaE1hcFBRVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIE1hdGNoTWFwUFFWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgYXJndW1lbnRzKQoKICAgICAgICAgICAgc2VsZi5yYWRpdXMgPSBvcHRpb25zLnJhZGl1c3x8IDI0OwogICAgICAgICAgICBzZWxmLnRvbCA9IG9wdGlvbnMudG9sfHwgNDk4OwoKCiAgICAgICAgICAgIHZhciBzcG1hID0gc2VsZi5tb2RlbDsKICAgICAgICAgICAgdmFyIHdpZGdldCA9IG5ldyBQUVZpZXcoc2VsZi5lbCwgewogICAgICAgICAgICAgICAgcmFkaXVzIDogc2VsZi5yYWRpdXMsCiAgICAgICAgICAgICAgICBvbmNsaWNrIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHdpZGdldFNwZWN0cnVtID0gbmV3IE1hdGNoU3BlY3RydW1WaWV3KHsKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwgOiBzcG1hLAogICAgICAgICAgICAgICAgICAgICAgICBmbHlpbmcgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBlZGl0VXJsOicvZmlzaHRvbmVzL2lkLyNpbnRlcmFjdGl2ZS8nK3NlbGYubW9kZWwuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnaWQnKSsnLycrc2VsZi50b2wrJy8nK3NlbGYubW9kZWwuZ2V0KCdyaWNoU2VxdWVuY2UnKS50b1N0cmluZygpLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6MjAwLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDo0ODAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAvLyAvL3dpZGdldFNwZWN0cnVtLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB3aWRnZXRTcGVjdHJ1bS5yZW5kZXIoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHNlY3RvckNsYXNzZXMgPSBuZXcgQXJyYXkoc2VsZi5tb2RlbC5nZXQoJ3JpY2hTZXF1ZW5jZScpLnNpemUoKSkKICAgICAgICAgICAgZm9yICggaXNjID0gMDsgaXNjIDwgc2VjdG9yQ2xhc3Nlcy5sZW5ndGg7IGlzYysrKSB7CiAgICAgICAgICAgICAgICBzZWN0b3JDbGFzc2VzW2lzY10gPSAnc2VjdG9yLXJrLW5vbmUnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF8uY2hhaW4oc3BtYS5jbG9zZXJUaGFuUFBNKHNlbGYudG9sKSkuZmlsdGVyKGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmFicyhtLmVycm9yUFBNKSA8PSA0OTkKICAgICAgICAgICAgfSkuZ3JvdXBCeShmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbS50aGVvLnBvcwogICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uKGdwKSB7CiAgICAgICAgICAgICAgICB2YXIgcG9zID0gZ3BbMF0udGhlby5wb3MKICAgICAgICAgICAgICAgIHZhciByayA9IF8uY2hhaW4oZ3ApLm1hcChmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uZXhwLmludGVuc2l0eVJhbmsKICAgICAgICAgICAgICAgIH0pLm1pbigpLnZhbHVlKCk7CiAgICAgICAgICAgICAgICBzZWN0b3JDbGFzc2VzW3Bvc10gPSAnc2VjdG9yLXJrLScgKyAoKHJrIDwgNDApID8gTWF0aC5mbG9vcihyayAvIDEwKSA6ICd4JykKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB3aWRnZXQuYnVpbGQoc2VjdG9yQ2xhc3NlcywgZnVuY3Rpb24oY250KSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IG5ldyBNYXRjaE1hcFNsaW1WaWV3KHsKICAgICAgICAgICAgICAgICAgICBtb2RlbCA6IHNwbWEsCiAgICAgICAgICAgICAgICAgICAgZWwgOiBjbnQsCiAgICAgICAgICAgICAgICAgICAgdG9sIDogc2VsZi50b2wsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0IDogc2VsZi5yYWRpdXMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHIucmVuZGVyKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLndpZGdldFBRID0gd2lkZ2V0OwogICAgICAgIH0sCiAgICAgICAgY2xjY2MgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0NMQUtLJykKICAgICAgICB9LAoKICAgICAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLndpZGdldFBRLmRyYXcoKTsKICAgICAgICB9LAoKICAgICAgICBtb3ZlIDogZnVuY3Rpb24oaSwgaikgewogICAgICAgICAgICB0aGlzLndpZGdldFBRLm1vdmUoaSwgaik7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIE1hdGNoTWFwUFFWaWV3Owp9KTsKCgovKioKICogZGlzcGxheSBvbmUgWElDICgrIHBsdXMgbXNtcyBtYXRjaGVzIGV2ZW50dWFsbHkpCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3Mvd2V0L1hJQ1ZpZXcnLFsndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdkMycsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnZmlzaHRvbmVzL21vZGVscy9tYXRjaC9QU01BbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0NvbnRleHQnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0FyZWEnLCAnLi4vbWF0Y2gvTWF0Y2hNYXBQUVZpZXcnXSwgZnVuY3Rpb24gKF8sIEJhY2tib25lLCBkMywgR0ZZVmlld1ZpZXcsIFBTTUFsaWdubWVudCwgRDNTY2FsaW5nQ29udGV4dCwgRDNTY2FsaW5nQXJlYSwgTWF0Y2hNYXBQUVZpZXcpIHsKCiAgICBYSUNWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgWElDVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIHNlbGYucmljaFNlcXVlbmNlID0gb3B0aW9ucy5yaWNoU2VxdWVuY2U7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnNjYWxpbmdDb250ZXh0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMueERvbWFpbiA9IFswLCBfLm1heChzZWxmLm1vZGVsLmdldCgncmV0ZW50aW9uVGltZXMnKSkgKiAxLjA1XTsKICAgICAgICAgICAgICAgIG9wdGlvbnMueURvbWFpbiA9IFswLCBfLm1heChzZWxmLm1vZGVsLmdldCgnaW50ZW5zaXRpZXMnKSkgKiAxLjFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dChvcHRpb25zKTsKCiAgICAgICAgICAgIHNlbGYucF9zZXRfbXMxcG9pbnRzKCk7CiAgICAgICAgICAgIGlmIChzZWxmLnJpY2hTZXF1ZW5jZSkgewogICAgICAgICAgICAgICAgc2VsZi5wX3NldF9tc21zZGF0YSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgLy9yZXR1cm4gdGhlIGNsYXNzIC0gd2VsbCwgSSBjYW5ub3QgZmlndXJlIHdoYXQgdGhpcyBvcyBkb25lIGxpa2UgdGhhdC4uLgogICAgICAgIHBfY2xhenpDb21tb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuICdjaHJvbWF0byBtc21zLWFsaWdubWVudC1pY29uIGNoYXJnZV8nICsgdGhpcy5tb2RlbC5nZXQoJ2NoYXJnZScpICsgJyB0YXJnZXRfJyArIHRoaXMubW9kZWwuZ2V0KCd0YXJnZXQnKTsKICAgICAgICB9LAogICAgICAgIC8vcGFja2FnZSB0aGUgbXMxIGdyYXBoIHBvaW50IChhbmQgZ2V0IGR0YXQgcmVhZHkgZm9yIGRyYXdpbmcpCiAgICAgICAgcF9zZXRfbXMxcG9pbnRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNocm9tYXRvID0gc2VsZi5tb2RlbDsKICAgICAgICAgICAgY2hyb21hdG8uX2RhdGFQb2ludHMgPSBfLnppcChjaHJvbWF0by5nZXQoJ3JldGVudGlvblRpbWVzJyksIGNocm9tYXRvLmdldCgnaW50ZW5zaXRpZXMnKSkKCiAgICAgICAgICAgIC8vY29uc29sZS5sb2cobXMxcG9pbnRzKQogICAgICAgICAgICB2YXIgc2VsZWN0b3IgPSAnZy4nICsgc2VsZi5wX2NsYXp6Q29tbW9uKCkucmVwbGFjZSgvXHMrL2csICcuJyk7CiAgICAgICAgICAgIHZhciBjb250ID0gc2VsZi5lbC5zZWxlY3RBbGwoc2VsZWN0b3IpOwogICAgICAgICAgICAvLyBjb250LnJlbW92ZSgpOwogICAgICAgICAgICBjb250ID0gc2VsZi5lbC5hcHBlbmQoJ2cnKTsKICAgICAgICAgICAgY29udC5hdHRyKCdjbGFzcycsIHNlbGYucF9jbGF6ekNvbW1vbigpICsgJyBwbG90Jyk7CgogICAgICAgICAgICB2YXIgY2xhenogPSBzZWxmLnBfY2xhenpDb21tb24oKSArICcgcGxvdCc7CiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2FkZGluZyBtczFwb2ludCcsIG1zMXBvaW50cykKICAgICAgICAgICAgc2VsZi5wMSA9IGNvbnQuc2VsZWN0QWxsKCJwYXRoLiIgKyBjbGF6eikuZGF0YShbY2hyb21hdG8uX2RhdGFQb2ludHNdKS5lbnRlcigpLmluc2VydCgicGF0aCIpOwoKICAgICAgICB9LAogICAgICAgIHBfc2V0X21zbXNkYXRhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNocm9tYXRvID0gc2VsZi5tb2RlbDsKCiAgICAgICAgICAgIHNlbGYubXNtc0RhdGEgPSBbXQoKICAgICAgICAgICAgXy5lYWNoKGNocm9tYXRvLmdldCgnbXNtcycpLm1vZGVscywgZnVuY3Rpb24gKHNwLCBpKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BtYSA9IG5ldyBQU01BbGlnbm1lbnQoewogICAgICAgICAgICAgICAgICAgIHJpY2hTZXF1ZW5jZTogc2VsZi5yaWNoU2VxdWVuY2UsCiAgICAgICAgICAgICAgICAgICAgZXhwU3BlY3RydW06IHNwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICB2YXIgd2lkZ2V0ID0gbmV3IE1hdGNoTWFwUFFWaWV3KHsKICAgICAgICAgICAgICAgICAgICBtb2RlbDogc3BtYSwKICAgICAgICAgICAgICAgICAgICBlbDogc2VsZi5lbCwKICAgICAgICAgICAgICAgICAgICByYWRpdXM6IDEyLAogICAgICAgICAgICAgICAgICAgIHRvbDogc2VsZi50b2wKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgd2lkZ2V0LndpZGdldFBRLnZpcy5hdHRyKCdjbGFzcycsIHNlbGYucF9jbGF6ekNvbW1vbigpKQoKICAgICAgICAgICAgICAgIHNlbGYubXNtc0RhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0OiB3aWRnZXQsCiAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogY2hyb21hdG8uZ2V0KCdtc21zUG9pbnRlcnMnKVtpXS5yZXRlbnRpb25UaW1lLAogICAgICAgICAgICAgICAgICAgIGludGVuc2l0eTogY2hyb21hdG8uZ2V0KCdtc21zUG9pbnRlcnMnKVtpXS5pbnRlbnNpdHkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAvL2RyYXdpbmcgcHV0IHRoZW0gb24gdGhlIHNjcmVlbgogICAgICAgICAgICAvL2FjdHVhbCBkcmF3aW5nIHdpbGwgbW92ZSB0aGVtIHRvIHRoZSBjb3JyZWN0IHBvc2l0aW9uCiAgICAgICAgICAgIF8uZWFjaChzZWxmLm1zbXNEYXRhLCBmdW5jdGlvbiAobXNtcykgewogICAgICAgICAgICAgICAgbXNtcy53aWRnZXQucmVuZGVyKCkKICAgICAgICAgICAgfSk7CgogICAgICAgIH0KICAgIH0pOwoKICAgIFhJQ1ZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICB2YXIgY2hybSA9IHNlbGYubW9kZWw7CgogICAgICAgIHZhciBjbGF6eiA9IHNlbGYucF9jbGF6ekNvbW1vbigpICsgJyBtc21zLWFubm90JzsKCiAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsvL2QzLnNjYWxlLmxpbmVhcigpLmRvbWFpbihzZWxmLnNjYWxpbmdDb250ZXh0LnhTY2FsZS5kb21haW4oKSkucmFuZ2Uoc2VsZi5zY2FsaW5nQ29udGV4dC54U2NhbGUucmFuZ2UoKSkKICAgICAgICB2YXIgeSA9IHNlbGYuc2NhbGluZ0NvbnRleHQueSgpOy8vZDMuc2NhbGUubGluZWFyKCkuZG9tYWluKHNlbGYuc2NhbGluZ0NvbnRleHQueVNjYWxlLmRvbWFpbigpKS5yYW5nZShzZWxmLnNjYWxpbmdDb250ZXh0LnlTY2FsZS5yYW5nZSgpKQoKICAgICAgICB2YXIgcExpbmUgPSBkMy5zdmcubGluZSgpLngoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgcmV0dXJuIHgoZFswXSk7CiAgICAgICAgfSkueShmdW5jdGlvbiAoZCkgewogICAgICAgICAgICByZXR1cm4geShkWzFdKQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZ3AxID0gc2VsZi5wMS5hdHRyKCdjbGFzcycsIGNsYXp6KS5hdHRyKCdmaWxsJywgJ25vbmUnKTsKICAgICAgICBncDEuYXR0cigiZCIsIHBMaW5lKHNlbGYubW9kZWwuX2RhdGFQb2ludHMpKTsKICAgICAgICBfLmVhY2goc2VsZi5tc21zRGF0YSwgZnVuY3Rpb24gKG1zbXMpIHsKICAgICAgICAgICAgbXNtcy53aWRnZXQubW92ZSh4KG1zbXMucmV0ZW50aW9uVGltZSksIE1hdGgubWluKHkobXNtcy5pbnRlbnNpdHkpLCBzZWxmLnNjYWxpbmdDb250ZXh0LmhlaWdodCgpIC0gMTUpKQogICAgICAgIH0pOwogICAgICAgIC8vIHZhciBtczJwb2ludHMgPSBfLnppcChjaHJtLm1zbXMucmV0ZW50aW9uVGltZXMsIGNocm0ubXNtcy5pbnRlbnNpdGllcywgY2hybS5tc21zLnNwZWN0cmFJZHMpOwogICAgfQoKICAgIHJldHVybiBYSUNWaWV3Owp9KTsKCi8qKgogKiBtdWx0aXBsZSBYSUMgdmlld3MgaW4gb25lIGJveC4gWElDIGlzIHVuaXF1ZSBieSBpdHMgbWFzcyBmaWVsZAogKiB0aGUgc2NhbGluZyBjb250ZXh0IGlzIGVpdGhlciBwYXNzZWQgKGlmIG11bHRpcGxlIGVsZW1lbnQgYXJlIHNoYXJpbmcgdGhlIHNhbWVvbmUpIG9yIGJ1aWx0LiByYW5nZXMgd2lsbCBiZSBhZGFwdGVkIGVhY2ggdGltZSBhIFhJQyBpcyBhZGRlZAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3Mvd2V0L011bHRpWElDVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICcuL1hJQ1ZpZXcnXSwgZnVuY3Rpb24gKF8sIEJhY2tib25lLCBkMywgQ29tbW9uV2lkZ2V0VmlldywgWElDVmlldykgewoKICAgIE11bHRpWElDVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBNdWx0aVhJQ1ZpZXcuX19zdXBlcl9fLmluaXRpYWxpemUuY2FsbCh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICBzZWxmLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQob3B0aW9ucyk7CgogICAgICAgICAgICBzZWxmLnhpY1ZpZXdzID0ge307CiAgICAgICAgICAgIHNlbGYubW9kZWwuYmluZCgnYWRkJywgZnVuY3Rpb24gKHhpYykgewogICAgICAgICAgICAgICAgc2VsZi5hZGQoeGljLCBvcHRpb25zKQogICAgICAgICAgICB9KQogICAgICAgICAgICBzZWxmLmJ1aWxkKG9wdGlvbnMpOwoKICAgICAgICAgICAgc2VsZi5saXN0ZW5UbyhzZWxmLm1vZGVsLCAnYWRkJywgc2VsZi5yZW5kZXIpOwogICAgICAgICAgICBzZWxmLmxpc3RlblRvKHNlbGYubW9kZWwsICdyZXNldCcsIHNlbGYucmVuZGVyKTsKCiAgICAgICAgfSwKICAgICAgICBidWlsZDogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnlheGlzKSB7CiAgICAgICAgICAgICAgICBzZWxmLmVsWUF4aXMgPSBzZWxmLmVsLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3hpYyB5YXhpcycpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlbGYudGl0bGUgPSBvcHRpb25zLnRpdGxlOwogICAgICAgICAgICBzZWxmLmVsVGl0bGUgPSBzZWxmLmVsLmFwcGVuZCgndGV4dCcpLmF0dHIoJ3gnLCBzZWxmLnNjYWxpbmdDb250ZXh0LndpZHRoKCkgLSAyMCkuYXR0cigneScsIDMwKS5hdHRyKCdjbGFzcycsICd4aWMgdGl0bGUnKTsKICAgICAgICB9LAogICAgICAgIC8vIGV2ZW50cyA6IHsKICAgICAgICAvLyAnY2hhbmdlIG1vZGVsJyA6ICdhZGQnCiAgICAgICAgLy8gfSwKICAgICAgICBhZGQ6IGZ1bmN0aW9uICh4aWMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbSA9IHhpYy5nZXQoJ21hc3MnKTsKCiAgICAgICAgICAgIHZhciB4bWF4ID0gTWF0aC5tYXgoc2VsZi5zY2FsaW5nQ29udGV4dC54TWF4KCksIF8ubWF4KHhpYy5nZXQoJ3JldGVudGlvblRpbWVzJykpKTsKICAgICAgICAgICAgaWYgKCEob3B0aW9ucyAmJiBvcHRpb25zLm5vQXV0b1gpKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnNldFhNYXgoeG1heCwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnNldFhNYXgoeG1heCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHltYXggPSBNYXRoLm1heChzZWxmLnNjYWxpbmdDb250ZXh0LnlNYXgoKSwgXy5tYXgoeGljLmdldCgnaW50ZW5zaXRpZXMnKSkgKiAxLjEpOwogICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnNldFlNYXgoeW1heCk7CgogICAgICAgICAgICB2YXIgeHYgPSBuZXcgWElDVmlldyh7CiAgICAgICAgICAgICAgICBlbDogc2VsZi5lbC5hcHBlbmQoJ2cnKSwKICAgICAgICAgICAgICAgIG1vZGVsOiB4aWMsCiAgICAgICAgICAgICAgICBzY2FsaW5nQ29udGV4dDogc2VsZi5zY2FsaW5nQ29udGV4dCwKICAgICAgICAgICAgICAgIHJpY2hTZXF1ZW5jZTogeGljLmdldCgncmljaFNlcXVlbmNlJyksCiAgICAgICAgICAgICAgICBub0F1dG9YOiAob3B0aW9ucyAmJiBvcHRpb25zLm5vQXV0b1gpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlbGYuY2lkLCAnWElDICcsIHhpYy5nZXQoJ2lkJyksIHhpYy5jaWQsIHh2LmNpZCkKCiAgICAgICAgICAgIHNlbGYueGljVmlld3NbbV0gPSB4djsKCiAgICAgICAgICAgIC8vc2VsZi54Wm9vbWFibGUoKTsKCiAgICAgICAgfSwKCiAgICAgICAgdXBkYXRlWUF4aXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeUF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHNlbGYuc2NhbGluZ0NvbnRleHQueSgpKS50aWNrcyg0KS50aWNrU2l6ZSg1KTsKICAgICAgICAgICAgc2VsZi5lbFlBeGlzLnNlbGVjdEFsbCgnZycpLnJlbW92ZSgpOwogICAgICAgICAgICB5QXhpcy5vcmllbnQoJ3JpZ2h0Jyk7CiAgICAgICAgICAgIHlBeGlzLnRpY2tGb3JtYXQoZDMuZm9ybWF0KCJlIikpOwogICAgICAgICAgICBzZWxmLmVsWUF4aXMuY2FsbCh5QXhpcyk7CgogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuZWxUaXRsZS50ZXh0KHNlbGYudGl0bGUpOwogICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLnlheGlzKSB7CiAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZVlBeGlzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgXy5lYWNoKF8udmFsdWVzKHNlbGYueGljVmlld3MpLCBmdW5jdGlvbiAoeHYpIHsKICAgICAgICAgICAgICAgIHh2LnJlbmRlcigpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gTXVsdGlYSUNWaWV3Owp9KTsKCi8qKgogKiBkaXNwbGF5IGEgRDNTY2FsaW5nQ29udGV4dCwgb24gdGhlIHhheGlzIHZpZXcKICoKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzWEF4aXNWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3J10sCiAgICBmdW5jdGlvbiAoXywgQmFja2JvbmUsIGQzLCBDb21tb25XaWRnZXRWaWV3KSB7CiAgICAgICAgRDNYQXhpc1ZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBYSUNWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dChvcHRpb25zKTsKICAgICAgICAgICAgICAgIHNlbGYudHJhbnNmb3JtID0gb3B0aW9ucy50cmFuc2Zvcm07CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciB4U2NhbGU7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi50cmFuc2Zvcm0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgeERvbSA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpLmRvbWFpbigpCiAgICAgICAgICAgICAgICAgICAgeFNjYWxlID0gZDMuc2NhbGUubGluZWFyKCkuZG9tYWluKFtzZWxmLnRyYW5zZm9ybSh4RG9tWzBdKSwgc2VsZi50cmFuc2Zvcm0oeERvbVsxXSldKS5yYW5nZShbMCwgc2VsZi5zY2FsaW5nQ29udGV4dC53aWR0aCgpXSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgeFNjYWxlID0gc2VsZi5zY2FsaW5nQ29udGV4dC54KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeFNjYWxlKS50aWNrcyg3KS50aWNrU3ViZGl2aWRlKDQpLnRpY2tTaXplKDYsIDUsIDApOwogICAgICAgICAgICAgICAgc2VsZi5lbC5jYWxsKHhBeGlzKTsKICAgICAgICAgICAgICAgIHZhciBlbHNUaWNrcyA9IHNlbGYuZWwuc2VsZWN0QWxsKCdnIGcgZycpWzBdCiAgICAgICAgICAgICAgICBfLmVhY2goZWxzVGlja3MsIGZ1bmN0aW9uIChlbHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gcGFyc2VGbG9hdChkMy5zZWxlY3QoZWx0KS5hdHRyKCd0cmFuc2Zvcm0nKS5yZXBsYWNlKCd0cmFuc2xhdGUoJywgJycpLnJlcGxhY2UoJywwKScsICcnKSk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KGVsdCkuc3R5bGUoJ2Rpc3BsYXknLCAocG9zIDwgMzUpID8gJ25vbmUnIDogbnVsbCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICByZXR1cm4gRDNYQXhpc1ZpZXcKICAgIH0pOwoKLyoKICogQSBjbGlwcGVkIHZlcnNpb24gb2YgYSBYSUMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L1hJQ0NsaXAnLFsnQmFja2JvbmUnLCAnQ29uZmlnJywgJy4vWElDJ10sIGZ1bmN0aW9uKEJhY2tib25lLCBjb25maWcsIFhJQykgewogICAgdmFyIFhJQ0NsaXAgPSBYSUMuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBYSUNDbGlwOwp9KTsKCi8qCiAqIGJ1aWxkcyBhbiBYSUMgQ2xpcCBvdXQgb2YgYSBYSUMgKyByZXRlbnRpb24gdGltZSByYW5nZQogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3NlcnZpY2VzL3dldC9YSUNDbGlwcGVyRmFjdG9yeScsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvWElDQ2xpcCcsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUsIGNvbmZpZywgWElDQ2xpcCwgRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbikgewogICAgdmFyIFhJQ0NsaXBwZXJGYWN0b3J5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgfTsKCiAgICAvKioKICAgICAqIGJ1aWxkIGEgWElDQ2xpcCBiYXNlZCBvbiB4aWMgd2l0aCByZXRlbnRpb25UaW1lcyBpbiB0aGUgd2luZG93CiAgICAgKiB4aWMgIGNhbiBiZSBlaXRoZXI6CiAgICAgKiAtIG9uZSBYSUMKICAgICAqIC0gb25lWElDQ29sbGVjdGlvbiAKICAgICAqIC0gQXJyYXkgb2YgWElDCiAgICAgKi8KICAgIFhJQ0NsaXBwZXJGYWN0b3J5LnByb3RvdHlwZS5jbGlwID0gZnVuY3Rpb24oeGljLCBydEluZiwgcnRTdXAsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgCiAgICAgICAgaWYoeGljIGluc3RhbmNlb2YgQmFja2JvbmUuQ29sbGVjdGlvbil7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmNsaXAoeGljLm1vZGVscywgcnRJbmYsIHJ0U3VwLCBvcHRpb25zKQogICAgICAgIH0KICAgICAgICBpZih4aWMgaW5zdGFuY2VvZiBBcnJheSl7CiAgICAgICAgICAgIHJldHVybiBfLmNvbGxlY3QoeGljLCBmdW5jdGlvbih4KXsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNsaXAoeCwgcnRJbmYsIHJ0U3VwLCBvcHRpb25zKQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBjbGlwcGVkID0geGljLmNsb25lKCk7CiAgICAgICAgdmFyIHBvaW50cyA9IF8uemlwKHhpYy5nZXQoJ3JldGVudGlvblRpbWVzJyksIHhpYy5nZXQoJ2ludGVuc2l0aWVzJykpCiAgICAgICAgcG9pbnRzID0gXy5maWx0ZXIocG9pbnRzLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgIHJldHVybiBwWzBdID49IHJ0SW5mICYmIHBbMF0gPD0gcnRTdXA7CiAgICAgICAgfSkKCiAgICAgICAgY2xpcHBlZC5zZXQoJ3JldGVudGlvblRpbWVzJywgXy5wbHVjayhwb2ludHMsIDApKQogICAgICAgIGNsaXBwZWQuc2V0KCdpbnRlbnNpdGllcycsIF8ucGx1Y2socG9pbnRzLCAxKSkKICAgICAgICBjbGlwcGVkLnNldCgncnRSYW5nZScsIHsKICAgICAgICAgICAgaW5mIDogcnRJbmYsCiAgICAgICAgICAgIHN1cCA6IHJ0U3VwCiAgICAgICAgfSkKICAgICAgICBjbGlwcGVkLnNldCgnbXNtcycsIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKGNsaXBwZWQuZ2V0KCdtc21zJykuZmlsdGVyKGZ1bmN0aW9uKG1zbXMpIHsKICAgICAgICAgICAgdmFyIHJ0ID0gbXNtcy5nZXQoJ3JldGVudGlvblRpbWUnKTsKICAgICAgICAgICAgcmV0dXJuIHJ0ID49IHJ0SW5mICYmIHJ0IDw9IHJ0U3VwCiAgICAgICAgfSkpKQoKICAgICAgICByZXR1cm4gbmV3IFhJQ0NsaXAoY2xpcHBlZC5hdHRyaWJ1dGVzKQogICAgfTsKICAgIHJldHVybiBuZXcgWElDQ2xpcHBlckZhY3RvcnkoKTsKfSk7CgovKioKICogbXVsdGlwbGUgWElDIHZpZXdzIGluIG9uZSBib3guIFhJQyBpcyB1bmlxdWUgYnkgaXRzIG1hc3MgZmllbGQKICogdGhlIHNjYWxpbmcgY29udGV4dCBpcyBlaXRoZXIgcGFzc2VkIChpZiBtdWx0aXBsZSBlbGVtZW50IGFyZSBzaGFyaW5nIHRoZSBzYW1lb25lKSBvciBidWlsdC4gcmFuZ2VzIHdpbGwgYmUgYWRhcHRlZCBlYWNoIHRpbWUgYSBYSUMgaXMgYWRkZWQKICogIGEgWElDTXVsdGlQYW5lVmlldyBpcyBhIHNldCBvZiBNdWx0aVhJQ1ZpZXcuCiAqIFdlIGNhbiBzZWUgdGhhdCBhcyBhIG11bHRsaW5lcyB3aWRnZXQsIGVhY2ggbGluZSBjb25zaXN0IG9mIGEgYSBzZXJpZXMgb2YgWElDLgogKiBzY2FsaW5nIGNvbnRleHQgaXMgY29oZXJlbnQgdGhyb3VnaG91dCB0aGUgZGlmZmVyZW50IFhJQwogKgogKiB0aGUgbW9kZWwgb2YgdGhlIHZpZXcgaWYgYSBtYXAgb2YgWElDQ29sbGVjdGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3Mvd2V0L1hJQ011bHRpUGFuZVZpZXcnLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJy4uL3V0aWxzL0QzWEF4aXNWaWV3JywKICAgICAgICAnLi9NdWx0aVhJQ1ZpZXcnLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL3dldC9YSUNDb2xsZWN0aW9uJywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy93ZXQvWElDQ2xpcHBlckZhY3RvcnknXSwKICAgIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgZDMsIENvbW1vbldpZGdldFZpZXcsIEQzWEF4aXNWaWV3LCBNdWx0aVhJQ1ZpZXcsIFhJQ0NvbGxlY3Rpb24sIHhpY0NsaXBwZXJGYWN0b3J5KSB7CgogICAgICAgIFhJQ011bHRpUGFuZVZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIC8vbWFwIG9mIE11bHRpWElDVmlldwogICAgICAgICAgICB4aWNQYW5lczoge30sCgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgZm9yIGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqICogZ3JvdXBCeSA6IGEgZnVuY3Rpb24gdGFraW5nIGEgcHJvdmlkZWQgWElDIGFuZCBjb21wdXRpbmcgdGhlIGtleSBvbiB3aGljaCB3ZSBzaGFsbCBncm91cGUgdGhlIFhJQyBwYWVycCBwYW5lCiAgICAgICAgICAgICAqICogZ2V0R3JvdXBOYW1lIFtvcHRpb25hbF06IGhvdyB0byBuYW1lIGEgZ3JvdXAgYmFzZWQgb24gdGhlIHByb3ZpZGVkIFhJQy4gV2Ugc2hvdWxkIGFzc3VtZSB0aGF0IGFsbCB0aGUgZ3JvdXBlZEJ5IFhJQyB3aWxsIHByb3ZpZGUgdGhlIHNhbWUgbmFtZS4uLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBvcHRpb25zID0gXy5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgTXVsdGlYSUNWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucyk7CgogICAgICAgICAgICAgICAgc2VsZi5ncm91cEJ5ID0gb3B0aW9ucy5ncm91cEJ5OwogICAgICAgICAgICAgICAgc2VsZi5nZXRHcm91cE5hbWUgPSBvcHRpb25zLmdldEdyb3VwTmFtZSB8fCBzZWxmLmdyb3VwQnk7CiAgICAgICAgICAgICAgICBzZWxmLnJldGVudGlvblRpbWVTZWxlY3RDYWxsYmFjayA9IG9wdGlvbnMucmV0ZW50aW9uVGltZVNlbGVjdENhbGxiYWNrOwoKICAgICAgICAgICAgICAgIHNlbGYubGVnZW5kSXNEaXNwbGF5ZWQgPSBvcHRpb25zLmxlZ2VuZCB8fCBmYWxzZTsKICAgICAgICAgICAgICAgIHNlbGYubm9BdXRvWCA9IG9wdGlvbnMubm9BdXRvWDsKCiAgICAgICAgICAgICAgICBzZWxmLmhlaWdodFhBeGlzID0gMzA7CiAgICAgICAgICAgICAgICBzZWxmLnhpY1BhbmVzID0ge307CiAgICAgICAgICAgICAgICBzZWxmLmdyb3VwZWRNb2RlbHMgPSB7fTsKCiAgICAgICAgICAgICAgICBzZWxmLmxpc3RlblRvKHNlbGYubW9kZWwsICdhZGQnLCBzZWxmLnNldHVwKTsKICAgICAgICAgICAgICAgIHNlbGYubGlzdGVuVG8oc2VsZi5tb2RlbCwgJ3Jlc2V0Jywgc2VsZi5jbGVhcik7CgogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhzZWxmKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHBfaW5pdF9ydF9kb21haW5fc2VsZWN0b3I6IGZ1bmN0aW9uIChjYikgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgLy9zZXQgdGhlIFJUIHJhbmdlIHNlbGVjdG9yIGFuZCBwaXBlIGl0IHRvIGEgY2FsbGJhY2sKCiAgICAgICAgICAgICAgICBpZiAoY2IpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldFNoaWZ0U2VsZWN0Q2FsbGJhY2soZnVuY3Rpb24gKHJ0RG9tYWluKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBydEluZiA9IHJ0RG9tYWluWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBydFN1cCA9IHJ0RG9tYWluWzFdCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgeGljY2xpcENvbCA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChzZWxmLm1vZGVsLm1vZGVscywgZnVuY3Rpb24gKHhpYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsaXAgPSB4aWNDbGlwcGVyRmFjdG9yeS5jbGlwKHhpYywgcnRJbmYsIHJ0U3VwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaXAudW5zZXQoJ21zbXNQb2ludGVycycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aWNjbGlwQ29sLnB1c2goY2xpcCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNiKHhpY2NsaXBDb2wsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ0RG9tYWluOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mOiBydEluZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXA6IHJ0U3VwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0UGFuZVRpdGxlOiBmdW5jdGlvbiAobmFtZSwgdGl0bGUpIHsKICAgICAgICAgICAgICAgIHRoaXMueGljUGFuZXNbbmFtZV0udGl0bGUgPSB0aXRsZQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2xlYXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgICAgICAgX3RoaXMueGljUGFuZXMgPSB7fTsKICAgICAgICAgICAgICAgIF90aGlzLmdyb3VwZWRNb2RlbHMgPSB7fTsKICAgICAgICAgICAgICAgIF90aGlzLnhpY1BhbmVzID0ge307CiAgICAgICAgICAgICAgICBfdGhpcy5wcmV2UGFuZXNHcm91cEtleXMgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgX3RoaXMuc2V0dXAoKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0dXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXR1cFBhbmVzKCk7CiAgICAgICAgICAgICAgICBfdGhpcy5kaXNwYXRjaE1vZGVscygpOwoKICAgICAgICAgICAgICAgIF90aGlzLnJlbmRlcigpCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogcGFuZXMgYXJlIGJ1aWxkIGFyZSByZW5kZXIgdGltZSwgYmFzZWQgb24gdGhlIGdyb3VwQnkgcHJvcGVydHkKICAgICAgICAgICAgICogYmVmcmUgbWVzc2luZyBldmVyeXRoaW5nIGFyb3VuZCwgd2UgY2hlY2sgaWYgbmV3IHBhbmVzIHdlcmUgYWN0dWFsbHkgYWRkZWQuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBzZXR1cFBhbmVzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5tb2RlbC5zaXplKCkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL2dldCBvbmUgWElDIHJlcHJlc2VudGF0aXZlcyBvZiBhIHBhbmVzCiAgICAgICAgICAgICAgICB2YXIgcmVwNHBhbmVzID0gXy5jaGFpbihzZWxmLm1vZGVsLm1vZGVscykuZ3JvdXBCeShzZWxmLmdyb3VwQnkpLnZhbHVlcygpLm1hcChmdW5jdGlvbiAobCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBsWzBdOwogICAgICAgICAgICAgICAgfSkuc29ydEJ5KHNlbGYuZ3JvdXBCeSkudmFsdWUoKTsKCiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgdGhlIGtleSBwZXIgZ3JvdXAsIGFuZCByZXR1cm4gaWYgbm8gY2hhbmdlLgogICAgICAgICAgICAgICAgdmFyIHBhbmVzR3JvdXBLZXlzID0gXy5tYXAocmVwNHBhbmVzLCBzZWxmLmdyb3VwQnkpOwogICAgICAgICAgICAgICAgaWYgKF8uaXNFcXVhbChwYW5lc0dyb3VwS2V5cywgc2VsZi5wcmV2UGFuZXNHcm91cEtleXMpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2VsZi5wcmV2UGFuZXNHcm91cEtleXMgPSBwYW5lc0dyb3VwS2V5czsKCiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgZ3JvdXAgbmFtZXMKICAgICAgICAgICAgICAgIHNlbGYucGFuZU5hbWVzID0gcmVwNHBhbmVzLm1hcChzZWxmLmdldEdyb3VwTmFtZSk7CiAgICAgICAgICAgICAgICB2YXIgbmJQYW5lcyA9IHJlcDRwYW5lcy5sZW5ndGg7CgogICAgICAgICAgICAgICAgdmFyIGhlaWdodFBhbmUgPSBNYXRoLmZsb29yKChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRYQXhpcykgLyBuYlBhbmVzKTsKCiAgICAgICAgICAgICAgICBpZiAoc2VsZi54YXhpc1ZpZXcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0UGFuZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHZhciBneGF4aXMgPSBzZWxmLmVsLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3RpbWUtc2NhbGUgeGF4aXMnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRYQXhpcykgKyAnKScpOwogICAgICAgICAgICAgICAgICAgIGd4YXhpcy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCd3aWR0aCcsIHNlbGYuc2NhbGluZ0NvbnRleHQud2lkdGgoKSkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHRYQXhpcykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpOwogICAgICAgICAgICAgICAgICAgIHNlbGYueGF4aXNWaWV3ID0gbmV3IEQzWEF4aXNWaWV3KHsKICAgICAgICAgICAgICAgICAgICAgICAgZWw6IGd4YXhpcy5hcHBlbmQoJ2cnKSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGluZ0NvbnRleHQ6IHNlbGYuc2NhbGluZ0NvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB4IC8gNjAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBab29tKCk7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vY3JlYXRlIHBhbmVzIGlmIHRoZXJlIGFyZSBuZWNlc3NhcnkKICAgICAgICAgICAgICAgIHJlcDRwYW5lcy5mb3JFYWNoKGZ1bmN0aW9uIChyZXBYaWMsIGkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgayA9IHNlbGYuZ3JvdXBCeShyZXBYaWMpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnhpY1BhbmVzW2tdID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IHNlbGYuZWwuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ3JvdXBlZE1vZGVsc1trXSA9IG5ldyBYSUNDb2xsZWN0aW9uKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnhpY1BhbmVzW2tdID0gbmV3IE11bHRpWElDVmlldyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDogZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxpbmdDb250ZXh0OiBzZWxmLnNjYWxpbmdDb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHNlbGYuZ3JvdXBlZE1vZGVsc1trXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlbGYuZ2V0R3JvdXBOYW1lKHJlcFhpYyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXhpczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vQXV0b1g6IHNlbGYubm9BdXRvWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBzZWxmLmdldEdyb3VwTmFtZShyZXBYaWMpCgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2VsZi54aWNQYW5lc1trXS5lbC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIChpICogaGVpZ2h0UGFuZSApICsgJyknKTsKICAgICAgICAgICAgICAgICAgICAvL3NlbGYueGljUGFuZXNba10uc2NhbGluZ0NvbnRleHQgPSBzZWxmLnNjYWxpbmdDb250ZXh0OwogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coaywgc2VsZi54aWNQYW5lc1trXS5zY2FsaW5nQ29udGV4dCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LmhlaWdodChoZWlnaHRQYW5lKTsKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coc2VsZi5jaWQsICdhZGRpbmcgcGFuZScsIG5hbWUsIHNlbGYueGljUGFuZXNbbmFtZV0uY2lkKQoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldHVwWm9vbTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgc2VsZi54Wm9vbWFibGUoKQoKICAgICAgICAgICAgICAgIHNlbGYuZ2V0TWF4WUluWERvbWFpbiA9IGZ1bmN0aW9uICh4bWluLCB4bWF4KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHltYXggPSBfLmNoYWluKHNlbGYubW9kZWwubW9kZWxzKS5wbHVjaygnX2RhdGFQb2ludHMnKS5tYXAoZnVuY3Rpb24gKGRwcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5jaGFpbihkcHMpLmZpbHRlcihmdW5jdGlvbiAoZHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkcFswXSA+PSB4bWluICYmIGRwWzBdIDw9IHhtYXg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnBsdWNrKDEpLm1heCgpLnZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgfSkubWF4KCkudmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geW1heCAqIDEuMSAvLzEuMSBhc3NlcnQgZm9yIHRoZSBzY2FsaW5nWSBjb250ZXh0IG1ham9yZWQgZnJvbSB0aGUgcmVhbCBtYXgKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzZWxmLnJ0RG9tYWluU2VsZWN0b3IgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYucF9pbml0X3J0X2RvbWFpbl9zZWxlY3RvcihzZWxmLnJldGVudGlvblRpbWVTZWxlY3RDYWxsYmFjaykKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5ydERvbWFpblNlbGVjdG9yLnNjYWxpbmdDb250ZXh0ID0gc2VsZi5zY2FsaW5nQ29udGV4dDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXR1cExlZ2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIF90aGlzLmdMZWdlbmQgPSBfdGhpcy5lbC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdjaHJvbWF0byBsZWdlbmQnKTsKICAgICAgICAgICAgICAgIF90aGlzLmdMZWdlbmQuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpLmF0dHIoJ3J4JywgNSkuYXR0cigncnknLCA1KTsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB0aGUgbW9kZWwgaXMgYSBjb2xsZWN0aW9ucywgYnV0IHRob3NlIG1vZGVscyBzaG91bGQgYmUgZGlzcGF0Y2hlZCB0b3dyYWRzIHRoZSBpbmRpdmlkdWFsICBzZWxmLmdyb3VwZWRNb2RlbHNba10KICAgICAgICAgICAgICogQW5kIHRoZSBwb2ludCBpcyBub3QgdG8gdXBkYXRlIGEgY29sbGVjdGlvbiB0aGF0IGhhcyBub3QgY2hhbmdlZC4uLi4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGRpc3BhdGNoTW9kZWxzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBfLmNoYWluKHNlbGYubW9kZWwubW9kZWxzKS5ncm91cEJ5KHNlbGYuZ3JvdXBCeSkuZWFjaChmdW5jdGlvbiAobE1vZGVscywgaykgewogICAgICAgICAgICAgICAgICAgIGxNb2RlbHMuZm9yRWFjaChmdW5jdGlvbiAoeCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdyb3VwZWRNb2RlbHNba10uYWRkKHgpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLmdyb3VwZWRNb2RlbHNba10ucmVzZXQobE1vZGVscyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGFkZCB0aGUgbGVnZW5kcyBpbnRvIHRoZSBib3gKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHJlbmRlckxlZ2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuZ0xlZ2VuZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0dXBMZWdlbmQoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgaExpbmUgPSAyMDsKICAgICAgICAgICAgICAgIHZhciB3TW96ID0gMTMwOwogICAgICAgICAgICAgICAgdmFyIHdUZXh0ID0gMjAwOwoKICAgICAgICAgICAgICAgIF90aGlzLmdMZWdlbmQuc2VsZWN0QWxsKCdnLmxlZ2VuZC1saW5lJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB2YXIgbWF4TW96ID0gXy5jaGFpbihfdGhpcy5tb2RlbC5sZWdlbmRzLmxpc3QoKSkucGx1Y2soJ21hc3NlcycpLm1hcChmdW5jdGlvbiAobCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBsLmZpbHRlcihmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICB9KS5sZW5ndGg7CiAgICAgICAgICAgICAgICB9KS5tYXgoKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgbWF4TW96ID0gTWF0aC5tYXgobWF4TW96LCAwKTsKCiAgICAgICAgICAgICAgICBfLmVhY2goX3RoaXMubW9kZWwubGVnZW5kcy5saXN0KCksIGZ1bmN0aW9uIChsZWcsIGlMZWcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZ0xpbmUgPSBfdGhpcy5nTGVnZW5kLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2xlZ2VuZC1saW5lJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSg1LCcgKyAoaExpbmUgKiAoaUxlZyArIDAuNSkpICsgJyknKQoKICAgICAgICAgICAgICAgICAgICB2YXIgaW1veiA9IDA7CiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKGxlZy5tYXNzZXMsIGZ1bmN0aW9uIChtb3osIHopIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtb3opIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ01veiA9IGdMaW5lLmFwcGVuZCgnZycpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIChpbW96ICogd01veikgKyAnLDApJykuYXR0cignY2xhc3MnLCAnIGxlZ2VuZC1lbmxpZ2h0ZXInKS5hdHRyKCdsZWdlbmRzdWJsaWdodGVkJywgJy5jaHJvbWF0bycpLmF0dHIoJ2xlZ2VuZGVubGlnaHRlZCcsICcuY2hyb21hdG8uY2hhcmdlXycgKyB6ICsgJy50YXJnZXRfJyArIGlMZWcpOwogICAgICAgICAgICAgICAgICAgICAgICBnTW96LmFwcGVuZCgncGF0aCcpLmF0dHIoJ2QnLCAnTTAsMEw1MCwwJykuYXR0cignY2xhc3MnLCAnY2hyb21hdG8gdGFyZ2V0XycgKyBpTGVnICsgJyBjaGFyZ2VfJyArIHopOwogICAgICAgICAgICAgICAgICAgICAgICBnTW96LmFwcGVuZCgndGV4dCcpLnRleHQoJycgKyB6ICsgJysgKCcgKyBtb3oudG9GaXhlZCg0KSArICcpJykuYXR0cigneCcsIDU1KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGltb3orKzsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBnTGluZS5hcHBlbmQoJ3RleHQnKS5hdHRyKCd4JywgbWF4TW96ICogd01veikudGV4dChsZWcubmFtZSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kLnNlbGVjdEFsbCgnZy5sZWdlbmQtZW5saWdodGVyJykub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZW5TZWwgPSAkKHRoaXMpLmF0dHIoJ2xlZ2VuZGVubGlnaHRlZCcpOwogICAgICAgICAgICAgICAgICAgIHZhciBzdWJTZWwgPSAkKHRoaXMpLmF0dHIoJ2xlZ2VuZHN1YmxpZ2h0ZWQnKTsKCiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKHN1YlNlbCkuc3R5bGUoJ3N0cm9rZS1vcGFjaXR5JywgJzE1JScpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChlblNlbCkuc3R5bGUoJ3N0cm9rZS1vcGFjaXR5JywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKHN1YlNlbCkuc3R5bGUoJ2ZpbGwtb3BhY2l0eScsICcxNSUnKTsKICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3RBbGwoZW5TZWwpLnN0eWxlKCdmaWxsLW9wYWNpdHknLCBudWxsKTsKICAgICAgICAgICAgICAgIH0pLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc3ViU2VsID0gJCh0aGlzKS5hdHRyKCdsZWdlbmRzdWJsaWdodGVkJyk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKHN1YlNlbCkuc3R5bGUoJ3N0cm9rZS1vcGFjaXR5JywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKHN1YlNlbCkuc3R5bGUoJ2ZpbGwtb3BhY2l0eScsIG51bGwpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIHcgPSBtYXhNb3ogKiB3TW96ICsgd1RleHQ7CiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIChfdGhpcy53aWR0aCgpIC0gdyAtIDIwKSArICcsJyArIDQwICsgJyknKQogICAgICAgICAgICAgICAgX3RoaXMuZ0xlZ2VuZC5zZWxlY3RBbGwoJ3JlY3QuYmFja2dyb3VuZCcpLmF0dHIoJ3dpZHRoJywgdykuYXR0cignaGVpZ2h0JywgX3RoaXMubW9kZWwubGVnZW5kcy5zaXplKCkgKiBoTGluZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi54YXhpc1ZpZXcpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnhheGlzVmlldy5yZW5kZXIoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgOwoKICAgICAgICAgICAgICAgIF8uZWFjaChfLnZhbHVlcyhzZWxmLnhpY1BhbmVzKSwgZnVuY3Rpb24gKHh2KSB7CiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnbXVsdGlwYW5lIHJlbmRlcmluZyBNVVRMVEkgWElDJywgeHYpCiAgICAgICAgICAgICAgICAgICAgeHYucmVuZGVyKCk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoc2VsZi5sZWdlbmRJc0Rpc3BsYXllZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyTGVnZW5kKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBYSUNNdWx0aVBhbmVWaWV3OwogICAgfSk7CgovKgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3Mvd2V0L1NwZWN0cnVtVmlldycsWyd1bmRlcnNjb3JlJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQXJlYSddLCBmdW5jdGlvbiAoXywgZDMsIENvbW1vbldpZGdldFZpZXcsIEQzU2NhbGluZ0NvbnRleHQsIEQzU2NhbGluZ0FyZWEpIHsKICAgIC8qCiAgICAgKiBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgMyB2YWx1ZXM6CiAgICAgKgogICAgICogMDogbW96CiAgICAgKiAxOmludGVuc2l0eQogICAgICogMjogaW50ZW5zaXR5IHJhbmtzCiAgICAgKi8KICAgIHZhciBwcm9qZWN0UGVha3MgPSBmdW5jdGlvbiAoZXhwU3ApIHsKICAgICAgICByZXR1cm4gXy5jaGFpbihleHBTcC5nZXQoJ21venMnKSkuemlwKGV4cFNwLmdldCgnaW50ZW5zaXRpZXMnKSwgZXhwU3AuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKS52YWx1ZSgpCgogICAgfQogICAgdmFyIHBlYWtSYW5rQ2xhc3MgPSBmdW5jdGlvbiAocGspIHsKICAgICAgICB2YXIgaXJrID0gcGtbMl07CiAgICAgICAgcmV0dXJuICdyay0nICsgKChpcmsgPCA0MCkgPyBNYXRoLmZsb29yKGlyayAvIDEwKSA6ICd4Jyk7CiAgICB9CiAgICB2YXIgU3BlY3RydW1WaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGRlZmF1bHRzOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgICAgICBTcGVjdHJ1bVZpZXcuX19zdXBlcl9fLmluaXRpYWxpemUuY2FsbCh0aGlzLCBvcHRpb25zKQogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuY29sb3JQZWFrcyA9IG9wdGlvbnMuY29sb3JQZWFrczsKCiAgICAgICAgICAgIHNlbGYuaFNjYWxlPTIwOwogICAgICAgICAgICBzZWxmLmJ1aWxkKCk7CiAgICAgICAgICAgIHNlbGYubW9kZWwub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuYnVpbGQoKS5yZW5kZXIoKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAoKICAgICAgICBidWlsZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5idWlsZERhdGEoKS5idWlsZENvbnRleHQoKS5idWlsZEQzKCk7CiAgICAgICAgfSwKICAgICAgICBidWlsZERhdGE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLnBlYWtzID0gcHJvamVjdFBlYWtzKHNlbGYubW9kZWwpOwoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICBidWlsZENvbnRleHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHhNYXggPSBzZWxmLm1vZGVsLmdldCgnbW96cycpW3NlbGYubW9kZWwuc2l6ZSgpIC0gMV0gKiAxLjE7CiAgICAgICAgICAgIHZhciB4TWluID0gc2VsZi5tb2RlbC5nZXQoJ21venMnKVswXSAqIDAuNTsKICAgICAgICAgICAgdmFyIHlNYXggPSBNYXRoLm1heChfLm1heChzZWxmLm1vZGVsLmdldCgnaW50ZW5zaXRpZXMnKSkpICogMS4wNTsKCiAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgICAgICAgICB4RG9tYWluOiBbeE1pbiwgeE1heF0sCiAgICAgICAgICAgICAgICB5RG9tYWluOiBbMCwgeU1heF0sCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNlbGYuaGVpZ2h0KCktc2VsZi5oU2NhbGUsCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRDM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi52aXMgPSBzZWxmLmVsLmFwcGVuZCgnZycpOwogICAgICAgICAgICBzZWxmLnZpcy5hdHRyKCd3aWR0aCcsIHNlbGYud2lkdGgoKSkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQoKSkuYXR0cignY2xhc3MnLCAnc3BlY3RydW0nKTsKCiAgICAgICAgICAgIHZhciB5cyA9IHNlbGYuc2NhbGluZ0NvbnRleHQueSgpOwoKICAgICAgICAgICAgc2VsZi5wZWFrc0hvbGRlciA9IHNlbGYudmlzLnNlbGVjdEFsbCgnbGluZS5wZWFrJykuZGF0YShzZWxmLnBlYWtzKS5lbnRlcigpLmFwcGVuZCgnbGluZScpLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICB2YXIgY2wgPSAncGVhayAgcGVhay14JzsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmNvbG9yUGVha3MpIHsKICAgICAgICAgICAgICAgICAgICBjbCArPSAnICcgKyBwZWFrUmFua0NsYXNzKHBrKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjbDsKICAgICAgICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB5cygwKTsKICAgICAgICAgICAgfSkuYXR0cigneTInLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB5cyhwa1sxXSk7CiAgICAgICAgICAgIH0pOwoKCiAgICAgICAgICAgIHZhciBndGl0bGVzID0gc2VsZi52aXMuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAndGl0bGVzJykKICAgICAgICAgICAgZ3RpdGxlcy5hcHBlbmQoJ3RleHQnKS50ZXh0KCcjJyArIHNlbGYubW9kZWwuZ2V0KCdzY2FuTnVtYmVyJykpLmF0dHIoJ3gnLCBzZWxmLndpZHRoKCkgLSA1KS5hdHRyKCd5JywgMzApLmF0dHIoJ2NsYXNzJywgJ3NjYW4gdG9wJykKCiAgICAgICAgICAgIHNlbGYuYXhpc0NvbnRhaW5lciA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2F4aXMnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyt5cygwKSsnKScpOwoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeCA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwoKICAgICAgICAgICAgc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsteCcpLmF0dHIoJ3gxJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwa1swXSkKICAgICAgICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB4KHBrWzBdKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS50aWNrU2l6ZSg0LCAzLCAzKS50aWNrcygzKS8vIiIudGlja0Zvcm1hdChkMy5mb3JtYXQoImQiKSk7CiAgICAgICAgICAgIHNlbGYuYXhpc0NvbnRhaW5lci5jYWxsKHhBeGlzKTsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gU3BlY3RydW1WaWV3OwoKfSkKOwovKgogKiBDbGVhdmFnZSBlbnp5bWUgdG8gY2xlYXZlIHByb3RlaW4gc2VxdWVuY2UKICogcHJvcGVydGllczoKICogLSBuYW1lCiAqIC0gcnVsZTogYSByZWd1bGFyIGV4cHJlc3Npb24gKHNpbnRyZyBvciBSZWdFeHAgb2JqZWN0KQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9DbGVhdmFnZUVuenltZScsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lKSB7CiAgICB2YXIgQ2xlYXZhZ2VFbnp5bWUgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGlkQXR0cmlidXRlIDogJ25hbWUnLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBuYW1lIDogJycsCiAgICAgICAgICAgIHJ1bGUgOiBudWxsCiAgICAgICAgfSwKICAgICAgICBzZXQgOiBmdW5jdGlvbihhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICBpZiAoXy5pc1N0cmluZyhhdHRycy5ydWxlKSkgewogICAgICAgICAgICAgICAgYXR0cnMucnVsZSA9IG5ldyBSZWdFeHAoIGF0dHJzLnJ1bGUsICdnJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIEJhY2tib25lLk1vZGVsLnByb3RvdHlwZS5zZXQuY2FsbCh0aGlzLCBhdHRycywgb3B0aW9ucyk7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfSwKCiAgICAgICAgdG9TdHJpbmcgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ25hbWUnKSArIHNlbGYuZ2V0KCdydWxlJyk7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzZXEgYW4gaW5wdXQgYW1pbm8gYWNpZCBzdHJpbmcgc2VxdWVuY2UKICAgICAgICAgKiBAcmV0dXJuIHtBcnJheX0gYSBsaXN0IG9mIHN0cmluZyBzZXF1ZW5jZXMKICAgICAgICAgKi8KICAgICAgICBjbGVhdmUgOiBmdW5jdGlvbihzZXEpIHsKICAgICAgICAgICAgdmFyIHJldCA9IFtdOwogICAgICAgICAgICB2YXIgcmVnZXhwID0gbmV3IFJlZ0V4cCh0aGlzLmdldCgncnVsZScpLnNvdXJjZSwgJ2cnKTsKICAgICAgICAgICAgd2hpbGUgKCBtID0gcmVnZXhwLmV4ZWMoc2VxKSkgewogICAgICAgICAgICAgICAgcmV0LnB1c2gobVswXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIENsZWF2YWdlRW56eW1lOwp9KTsKCi8qCiAqIGVuenltZSB3aXRoIHJlZ3VsYXIgZXhwcmVzc2lvbi4gVGhlc2VzIGFyZSBhIGJpdCB1Z2x5LCBiZWNhdXNlIEphdmFTY3JpcHQgZG9lcyBzdXBwb3J0IGxvb2sgYWhlYWQKICogVGhpcyBmaWxlIGlzIHRvIGJlIGxvYWRlZCBieSBjb2xsZWN0aW9ucy9kcnkvQ2xlYXZhZ2VFbnp5bWVEaWN0aW9uYXJ5CiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMi0xNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL2RhdGEvY2xlYXZhZ2VFbnp5bWVzJyxbXSxmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogInRyeXBzaW4iLAogICAgICAgICAgICBydWxlOiAnKD86W1JLXXwuKz8oPzpbUktdfCQpKSg/PVteUF18JCknCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICJhcmctYyIsCiAgICAgICAgICAgIHJ1bGU6ICcoPzpSfC4rPyg/OlJ8JCkpKD89W15QXXwkKScKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogImNoeW1vdHJ5cHNpbiIsCiAgICAgICAgICAgIHJ1bGU6ICcoPzpbRkxXWV18Lis/KD86W0ZMV1ldfCQpKSg/PVteUF18JCknCiAgICAgICAgfQogICAgXQp9KTsKCgovKgogKiBBIHNpbmdsZXRvbiBjbGVhdmFnZSBlbnp5bWUgY29sbGVjdGlvbiwgbG9hZGVkIGZyb20gZGF0YS9jbGVhdmFnZUVuenltZXMuanMKICogCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0NsZWF2YWdlRW56eW1lRGljdGlvbmFyeScsWydmaXNodG9uZXMvbW9kZWxzL2RyeS9DbGVhdmFnZUVuenltZScsICdmaXNodG9uZXMvZGF0YS9jbGVhdmFnZUVuenltZXMnXSwgZnVuY3Rpb24oQ2xlYXZhZ2VFbnp5bWUsIGJzX2VuenltZXMpIHsKICAgIHZhciBDbGVhdmFnZUVuenltZURpY3Rpb25hcnkgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICAgICAgbW9kZWwgOiBDbGVhdmFnZUVuenltZSwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmFkZChic19lbnp5bWVzKTsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBuZXcgQ2xlYXZhZ2VFbnp5bWVEaWN0aW9uYXJ5KCk7Cn0pOwoKLyoKICogQW4gYW1pbm8gYWNpZCBzZXF1ZW5jZSwgd2l0aAogKiAtIGFjY2Vzc2lvbmNvZGUKICogLSBuYW1lCiAqIC0gc2VxdWVuY2UKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvQUFTZXF1ZW5jZScsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZSddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSkgewogICAgdmFyIEFBU2VxdWVuY2UgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGlkQXR0cmlidXRlIDogJ25hbWUnLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBuYW1lIDogbnVsbCwKICAgICAgICAgICAgYWNjZXNzaW9uQ29kZSA6IG51bGwsCiAgICAgICAgICAgIHNlcXVlbmNlIDogbnVsbAogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCiAgICAgICAgdG9TdHJpbmcgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ2FjY2Vzc2lvbmNvZGUnKSArICd8JyArIHNlbGYuZ2V0KCduYW1lJykgKyAnICgnICsgc2VsZi5nZXQoJ3NlcXVlbmNlJykubGVuZ2ggKyAnKSc7CiAgICAgICAgfSwKICAgICAgICBzaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzID0gdGhpcy5nZXQoJ3NlcXVlbmNlJykKICAgICAgICAgICAgaWYgKHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcy5sZW5ndGgKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBBQVNlcXVlbmNlOwp9KTsgCgovKgogKiBhIGZldyBkZWZhdWx0IHNlcXVlbmNlcywgYnV0IGFueSBvdGhlciBjYW4gYmUgYWRkZWQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL2RhdGEvYWFTZXF1ZW5jZXMnLFtdLGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIFt7CiAgICAgICAgbmFtZSA6ICJIMy4xIiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlA2ODQzMSIsCiAgICAgICAgc2VxdWVuY2UgOiAiTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTU0FWTUFMUUVBQ0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQSIKICAgIH0sIHsKICAgICAgICBuYW1lIDogIkgzLjFUIiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlExNjY5NSIsCiAgICAgICAgc2VxdWVuY2UgOiAiTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLVkFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxNUkVJQVFERktURExSRlFTU0FWTUFMUUVBQ0VTWUxWR0xGRURUTkxDVklIQUtSVlRJTVBLRElRTEFSUklSR0VSQSIKICAgIH0sIHsKICAgICAgICBuYW1lIDogIkgzLjIiLAogICAgICAgIGFjY2Vzc2lvbkNvZGUgOiAiUTcxREkzIiwKICAgICAgICBzZXF1ZW5jZSA6ICJNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQQVRHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNTQVZNQUxRRUFTRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBIgogICAgfSwgewogICAgICAgIG5hbWUgOiAiSDMuMyIsCiAgICAgICAgYWNjZXNzaW9uQ29kZSA6ICJQODQyNDMiLAogICAgICAgIHNlcXVlbmNlIDogIk1BUlRLUVRBUktTVEdHS0FQUktRTEFUS0FBUktTQVBTVEdHVktLUEhSWVJQR1RWQUxSRUlSUllRS1NURUxMSVJLTFBGUVJMVlJFSUFRREZLVERMUkZRU0FBSUdBTFFFQVNFQVlMVkdMRkVEVE5MQ0FJSEFLUlZUSU1QS0RJUUxBUlJJUkdFUkEiCiAgICB9LCB7CiAgICAgICAgbmFtZSA6ICJIMy5DIiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlE2TlhUMiIsCiAgICAgICAgc2VxdWVuY2UgOiAiTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NUUFNUQ0dWS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGTlRETFJGUVNBQVZHQUxRRUFTRUFZTFZHTExFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBIgogICAgfSwgewogICAgICAgIG5hbWUgOiAiSDQiLAogICAgICAgIGFjY2Vzc2lvbkNvZGUgOiAiUDYyODA1IiwKICAgICAgICBzZXF1ZW5jZSA6ICJNU0dSR0tHR0tHTEdLR0dBS1JIUktWTFJETklRR0lUS1BBSVJSTEFSUkdHVktSSVNHTElZRUVUUkdWTEtWRkxFTlZJUkRBVlRZVEVIQUtSS1RWVEFNRFZWWUFMS1JRR1JUTFlHRkdHIgogICAgfV0KfSk7CgovLyA+c3B8UDY4NDMxfEgzMV9IVU1BTiBIaXN0b25lIEgzLjEgT1M9SG9tbyBzYXBpZW5zIEdOPUhJU1QxSDNBIFBFPTEgU1Y9MgovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQQVRHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNTQVZNQUxRRUFDRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCi8vID5zcHxRMTY2OTV8SDMxVF9IVU1BTiBIaXN0b25lIEgzLjF0IE9TPUhvbW8gc2FwaWVucyBHTj1ISVNUM0gzIFBFPTEgU1Y9MwovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtWQVJLU0FQQVRHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTE1SRUlBUURGS1RETFJGUVNTQVZNQUxRRUFDRVNZTFZHTEZFRFROTENWSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCgovLyA+c3B8UTcxREkzfEgzMl9IVU1BTiBIaXN0b25lIEgzLjIgT1M9SG9tbyBzYXBpZW5zIEdOPUhJU1QySDNBIFBFPTEgU1Y9MwovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQQVRHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNTQVZNQUxRRUFTRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCgovLyA+c3B8UDg0MjQzfEgzM19IVU1BTiBIaXN0b25lIEgzLjMgT1M9SG9tbyBzYXBpZW5zIEdOPUgzRjNBIFBFPTEgU1Y9MgovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQU1RHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNBQUlHQUxRRUFTRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCi8vID5zcHxRNk5YVDJ8SDNDX0hVTUFOIEhpc3RvbmUgSDMuM0MgT1M9SG9tbyBzYXBpZW5zIEdOPUgzRjNDIFBFPTEgU1Y9MwovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU1RQU1RDR1ZLUEhSWVJQR1RWQUxSRUlSUllRS1NURUxMSVJLTFBGUVJMVlJFSUFRREZOVERMUkZRU0FBVkdBTFFFQVNFQVlMVkdMTEVEVE5MQ0FJSEFLUlZUSU1QS0RJUUxBUlJJUkdFUkEKLy8KLy8gPnNwfFA2MjgwNXxINF9IVU1BTiBIaXN0b25lIEg0IE9TPUhvbW8gc2FwaWVucyBHTj1ISVNUMUg0QSBQRT0xIFNWPTIKLy8gTVNHUkdLR0dLR0xHS0dHQUtSSFJLVkxSRE5JUUdJVEtQQUlSUkxBUlJHR1ZLUklTR0xJWUVFVFJHVkxLVkZMRU5WSVJEQVZUWVRFSEFLUktUVlRBTURWVllBTEtSUUdSVExZR0ZHRwo7Ci8qCiAqIEEgc2luZ2xldG9uIGRpY3Rpb25hcnkgZm9yIGEgZmV3IHByb3RlaW4gc2VxdWVuY2VzIChtYWlubHkgaGlzdG9uZSB0YWlscywgYnV0IGFkZCB5b3VyIG93bi4uLikKICogaXQgYWxsb3cgdG8gZ2V0IGEgbmFtZSB0byBhIHNlcXVlbmNlLCBidXQgYWxzbywgaWYgYSB0cnlwdGljIHBlcHRpZGUgc2VxdWVuY2UgaXMgdW5pcXVlIGFjcm9zcyB0aGUgZGlmZmVyZW50IEFBU2VxdWVuY2UsCiAqIHdlIGNhbiByZWZlciB0byBpdCBsaWtlIEgzLjNLMjcKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQUFTZXF1ZW5jZURpY3Rpb25hcnknLFsnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvQUFTZXF1ZW5jZScsICdmaXNodG9uZXMvZGF0YS9hYVNlcXVlbmNlcyddLCBmdW5jdGlvbihCYWNrYm9uZSwgQUFTZXF1ZW5jZSwgYnNfc2VxdWVuY2VzKSB7CiAgICB2YXIgQUFTZXF1ZW5jZURpY3Rpb25hcnkgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICAgICAgbW9kZWwgOiBBQVNlcXVlbmNlLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmFkZChic19zZXF1ZW5jZXMpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG5ldyBBQVNlcXVlbmNlRGljdGlvbmFyeSgpOwp9KTsKCi8qCiAqIGEgQUFTZXF1ZW5jZVBlcHRpZGVQdHIgb2JqZWN0IHRyYW5zZm9ybXMgcGVwdGlkZSBzZXF1ZW5jZSBpbnRvIGEgc2hvcnRlciBwb2ludGVyIHRvIHRoZSBwcm90ZWlucy4KICogVGhpcyBhbGlhcyBzaG91bGQgYmUgdW5lcXVpdm9jYWwgcmVnYXJkaW5nIHRvIHRoZSBsaXN0IG9mIGtub3duIHByb3RlaW5zIChBQVNlcXVlbmNlRGljdGlvbmFyeSkKICoKICogVGhpcyBjbGFzcyBpcyB1c2VkIGFzIGEgdXRpbGl0eSBieSBSdWljaFNlcXVlbmNlU2hvcnRjdXRlcgogKgogKiBXZSB3YW50IHRvIGdpdmUgSDNLNCBhbmQgdGhpcyBraW5kIG9mIHNob3J0Y3V0LCBnaXZlbiBhbiBlbnp5bWUsIGFuZCBpdCByZXR1cm5zIGEgdW5hbWJpZ3VvdXMgcGVwdGlkZQogKiBBbmQgdmljZSB2ZXJzYSwgZ2l2ZW4gYSBwZXB0aWRlLCBpdCBnaXZlcyBiYWNrIHRoZSBzaG9ydGVzdCBwb3NzaWJsZSBwb2ludGVyCiAqCiAqIEZvciBleGFtcGxlLCBTZWUgQUFTZXF1ZW5jZVBlcHRpZGVQdHItdGVzdC5qcyBmb3IgZXhhbXBsZXMKICoKICogUHJvcGVydGllczoKICogLSBjbGVhdmFnZUVuenltZTogZWl0aGVyIGEgbmFtZSByZWZlcmluZyB0byB0aGUgZGljdGlvbmFyeSBvciBhbiBvYmplY3QKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9BQVNlcXVlbmNlUGVwdGlkZVB0cicsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQ2xlYXZhZ2VFbnp5bWVEaWN0aW9uYXJ5JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQUFTZXF1ZW5jZURpY3Rpb25hcnknXSwgZnVuY3Rpb24gKF8sIEJhY2tib25lLCBkaWNvQ0UsIGRpY29TZXEpIHsKICAgIHZhciBBQVNlcXVlbmNlUGVwdGlkZVB0ciA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICAgICAgY2xlYXZhZ2VFbnp5bWU6IG51bGwsCiAgICAgICAgICAgIHBlcHRpZGVJbmRleDoge30KICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNlID0gbnVsbDsKICAgICAgICAgICAgaWYgKGF0dHJzID09ICdjbGVhdmFnZUVuenltZScpIHsKICAgICAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKG9wdGlvbnMpKSB7CiAgICAgICAgICAgICAgICAgICAgY2UgPSBvcHRpb25zID0gZGljb0NFLmdldChvcHRpb25zKQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zIGluc3RhbmNlb2YgQ2xlYXZhZ2VFbnp5bWUpIHsKICAgICAgICAgICAgICAgICAgICBjZSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhhdHRycy5jbGVhdmFnZUVuenltZSkpIHsKICAgICAgICAgICAgICAgIGNlID0gYXR0cnMuY2xlYXZhZ2VFbnp5bWUgPSBkaWNvQ0UuZ2V0KGF0dHJzLmNsZWF2YWdlRW56eW1lKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhdHRycy5jbGVhdmFnZUVuenltZSkgewogICAgICAgICAgICAgICAgY2UgPSBhdHRycy5jbGVhdmFnZUVuenltZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2UgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsZi5wX3JlYnVpbGRQZXB0aWRlSW5kZXgoY2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5wcm90b3R5cGUuc2V0LmNhbGwoc2VsZiwgYXR0cnMsIG9wdGlvbnMpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIHJlYnVpbGQgdGhlIGluZGV4IHBlcHRpZGUgLT4gc2VxdWVuY2UgKyBwb3NpdGlvbnMKICAgICAgICAgKiBAcGFyYW0ge0NsZWF2YWdlRW56eW1lfSBvcHRpb25hbCBwYXJhbXMgKGRlZmF1bHQgaXMgdGhlIGNsZWF2YWdlRW56eW1lIHByb3BlcnR5KS4gV2UgY2FuIHBhc3MgaXQgaW4gY2FzZSB0aGUgZW56eW1lIHBybyBoYXMgbm90IGJlZSBzZXQgeWV0IChzZXR0ZXIgb3ZlcmlkaW5nKQogICAgICAgICAqLwogICAgICAgIHBfcmVidWlsZFBlcHRpZGVJbmRleDogZnVuY3Rpb24gKGNlKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHBpbmRleCA9IHt9OwoKICAgICAgICAgICAgY2UgPSBjZSB8fCBzZWxmLmdldCgnY2xlYXZhZ2VFbnp5bWUnKTsKICAgICAgICAgICAgaWYgKGNlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbiA9IDA7CiAgICAgICAgICAgIF8uZWFjaChkaWNvU2VxLm1vZGVscywgZnVuY3Rpb24gKGFhU2VxKSB7CiAgICAgICAgICAgICAgICB2YXIgcG9zID0gMDsKICAgICAgICAgICAgICAgIF8uZWFjaChjZS5jbGVhdmUoYWFTZXEuZ2V0KCdzZXF1ZW5jZScpKSwgZnVuY3Rpb24gKHBlcHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGxpc3QgPSBwaW5kZXhbcGVwdF07CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwbGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBwaW5kZXhbcGVwdF0gPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgcGxpc3QgPSBwaW5kZXhbcGVwdF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGxpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGFhU2VxOiBhYVNlcSwKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBwb3MKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIHBvcyArPSBwZXB0Lmxlbmd0aDsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBuKysKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGYuc2V0KCdwZXB0aWRlSW5kZXgnLCBwaW5kZXgpOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiB0YW5zZm9ybQogICAgICAgICAqIEgzLlsxLDFULDJdIC0+IEgzLjEKICAgICAgICAgKiBIMy4xIC0+IEgzLjEKICAgICAgICAgKi8KICAgICAgICBwdHJUcmltOiBmdW5jdGlvbiAocHRyKSB7CgogICAgICAgICAgICBpZiAobSA9IC8oLispXFsoLis/KSwuKj9dKC4qKS8uZXhlYyhwdHIpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbVsxXSArIG1bMl0gKyBtWzNdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gdGhlIHNlcXVlbmNlIHBvaW50ZXIsIGV4dHJhY3QgdGhlIGxpc3Qgb2YgcHJvdGVpbnMgbWF0Y2hpbmcKICAgICAgICAgKiBIM0s0ID0+IGFsbCB0aGUgcHJvdCBzdGF0aW5nIHdpdGggYSBuYW1lIEgzCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHB0cgogICAgICAgICAqLwogICAgICAgIHB0cjJBQVNlcXVlbmNlczogZnVuY3Rpb24gKHB0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBzZXFQdHIgPSBzZWxmLnBfcHRyMnNlcUFuZFBlcHRBbmNob3Ioc2VsZi5wdHJUcmltKHB0cikpLnNlcVB0cjsKCiAgICAgICAgICAgIGlmIChkaWNvU2VxLmdldChzZXFQdHIpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBbZGljb1NlcS5nZXQoc2VxUHRyKV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsID0gXy5maWx0ZXIoZGljb1NlcS5tb2RlbHMsIGZ1bmN0aW9uIChhYXNlcSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFhc2VxLmdldCgnbmFtZScpLmluZGV4T2Yoc2VxUHRyKSA9PSAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGwubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnSWxsZWdhbHNlcXVlbmNlUHRyRXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnY2Fubm90IGZpbmQgbWF0Y2hpbmcgQUFTZXF1ZW5jZSBbJyArIHB0ciArICddL1snICsgc2VxUHRyICsgJ10nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbDsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gdGhlIHNlcXVlbmNlIHBvaW50ZXIsIHJldHVybiBvbmUgbWFwIGZvciB0aGUgcGVwdGlkZToge3NlcXVlbmNlOiAuLi4gLCBvZmZzZXQ6Li4ufQogICAgICAgICAqIEl0IHdpbGwgdGhlIGJlIHBhc3NlZCB0byBSaWNoU2VxdWVuY2VTaG9ydGN1dGVyIGZvciB0aGUgYWN0dWFsUmljaFNlcXVlbmNlIGNyZWF0aW9uCiAgICAgICAgICoKICAgICAgICAgKiBJZiB0aGUgYW5zd2VyIGlzIGFtYmlndW91cywgYW4gZXhjcGV0aW9uSGFuZGxlci5yYWlzZShleGNwZXRpb24pIGlzIHJhaXNlZAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHB0cgogICAgICAgICAqLwogICAgICAgIHB0cjJwZXB0aWRlOiBmdW5jdGlvbiAocHRyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGxTZXF1ZW5jZXMgPSBzZWxmLnB0cjJBQVNlcXVlbmNlcyhwdHIpOwoKICAgICAgICAgICAgdmFyIGFhcHRyID0gc2VsZi5wX3B0cjJzZXFBbmRQZXB0QW5jaG9yKHB0cikuYWFQdHI7CiAgICAgICAgICAgIHZhciBtID0gYWFwdHIubWF0Y2goLyhbQS1aXSkoXGQrKS8pCiAgICAgICAgICAgIHZhciBhbmNob3JBQSA9IG1bMV07CiAgICAgICAgICAgIHZhciBhbmNob3JQb3MgPSBwYXJzZUludChtWzJdKTsKCiAgICAgICAgICAgIHZhciBscGVwdCA9IF8uY2hhaW4obFNlcXVlbmNlcykuY29sbGVjdChmdW5jdGlvbiAoYWFTZXEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnBfY2xlYXZlZFBlcHRpZGVBdChhYVNlcSwgYW5jaG9yUG9zKTsKICAgICAgICAgICAgfSkudW5pcSgpLmdyb3VwQnkoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLnNlcXVlbmNlICsgJ3wnICsgcC5vZmZzZXQKICAgICAgICAgICAgfSkudmFsdWVzKCkuY29sbGVjdChmdW5jdGlvbiAobCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxbMF0KICAgICAgICAgICAgfSkudmFsdWUoKTsKCiAgICAgICAgICAgIGlmIChscGVwdC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0FtYmlndW91c1B0ckV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3BvaW50ZXIgJyArIHB0ciArICcgcG9pbnRzIHRvIG11bHRpcGxlIHBlcHRpZGVzOiAnICsgXy5jb2xsZWN0KGxwZXB0LCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcC5zZXF1ZW5jZSArICdAJyArIHAub2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgfSkuam9pbignLCAnKSArICIuXG5DaG9vc2UgYSBsZXNzIGFtYmlndW91cyBwcm90ZWluIG5hbWUgYW1vbmc6ICIgKyBfLmNvbGxlY3QobFNlcXVlbmNlcywgZnVuY3Rpb24gKGFhU2VxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhYVNlcS5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCcsICcpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXQgPSBscGVwdFswXTsKCiAgICAgICAgICAgIGlmIChyZXQuc2VxdWVuY2UuY2hhckF0KGFuY2hvclBvcyAtIHJldC5vZmZzZXQpICE9IGFuY2hvckFBKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0ludmFsaWRQdHJFeGNlcHRpb24nLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdwb2ludGVyICcgKyBwdHIgKyAnIGRvZXMgbm90IHBvaW50IHRvIGFtaW5vYWNpZDogJyArIGFuY2hvckFBICsgJyBhdCBwb3NpdGlvbiAnICsgYW5jaG9yUG9zICsgJyAoaW4gZmFjdDonICsgcmV0LnNlcXVlbmNlLmNoYXJBdChhbmNob3JQb3MgLSByZXQub2Zmc2V0KSArICcpJwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJldAoKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIGEgbGlzdCBvZiBBQVNlcXVlbmNlIG9yIG5hbWVzLCBidWlsZCBhIHNob3J0IGNvbmNhdGVuYXRpb24gb24gdGhlbQogICAgICAgICAqLwogICAgICAgIGNvbmNhdGVuYXRlTmFtZXM6IGZ1bmN0aW9uIChsc2VxKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGxOYW1lcyA9IF8uY29sbGVjdChsc2VxLCBmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgaWYgKF8uaXNTdHJpbmcobikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG4uZ2V0KCduYW1lJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsTmFtZXMgPSBsTmFtZXMuc29ydCgpOwoKICAgICAgICAgICAgaWYgKGxOYW1lcy5sZW5ndGggPD0gMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxOYW1lc1swXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGlDb21tb24gPSAxOwogICAgICAgICAgICB3aGlsZSAoaUNvbW1vbiA8PSBsTmFtZXNbMF0ubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJlZiA9IGxOYW1lc1swXS5zdWJzdHIoMCwgaUNvbW1vbik7CgogICAgICAgICAgICAgICAgaWYgKF8uYW55KGxOYW1lcywgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5zdWJzdHIoMCwgaUNvbW1vbikgIT0gcHJlZjsKICAgICAgICAgICAgICAgIH0pKSB7CgogICAgICAgICAgICAgICAgICAgIGlDb21tb24tLTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlDb21tb24rKwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjb21tb24gPSBsTmFtZXNbMF0uc3Vic3RyKDAsIGlDb21tb24pOwoKICAgICAgICAgICAgdmFyIGFsbE5hbWVzNGNvbW1vbiA9IF8uY2hhaW4oZGljb1NlcS5tb2RlbHMpLmNvbGxlY3QoZnVuY3Rpb24gKGFhc2VxKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWFzZXEuZ2V0KCduYW1lJykKICAgICAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbi5pbmRleE9mKGNvbW1vbikgPT0gMAogICAgICAgICAgICB9KS52YWx1ZSgpLnNvcnQoKQogICAgICAgICAgICBpZiAoYWxsTmFtZXM0Y29tbW9uLmxlbmd0aCA9PSBsTmFtZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5wX3Nob3J0ZW5OYW1lKGNvbW1vbikKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY29tbW9uICsgbE5hbWVzWzBdLnN1YnN0cihpQ29tbW9uKTsKCiAgICAgICAgICAgIC8vIHJldHVybiBjb21tb24gKyAnWycgKyBfLmNvbGxlY3QobE5hbWVzLCBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIC8vIHJldHVybiBuLnN1YnN0cihpQ29tbW9uKTsKICAgICAgICAgICAgLy8gfSkuam9pbignLCcpICsgJ10nCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogZnJvbSBhIHNlcXVlbmNlLCByZXR1cm4gdGhlIGNsZWF2ZWQgcGVwdGlkZSBjb250YWluZWluZyBwb3NpdGlvbiBwb3MKICAgICAgICAgKiBAcGFyYW0ge0FBU2VxdWVuY2V9IGFhU2VxCiAgICAgICAgICogQHBhcmFtIHtpbnR9IHBvcwogICAgICAgICAqLwogICAgICAgIHBfY2xlYXZlZFBlcHRpZGVBdDogZnVuY3Rpb24gKGFhU2VxLCBwb3MpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAocG9zID49IGFhU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdJbGxlZ2FsUG9zaXRpb25PblNlcXVlbmNlJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAncG9zaXRpb24gJyArIHBvcyArICcgZXhjZWVkIHNpemUgJyArIGFhU2VxLnNpemUoKSArICcgZm9yIHNlcSAnICsgZ2V0LmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHAgPSAwOwoKICAgICAgICAgICAgdmFyIHJlZ2V4cCA9IHNlbGYuZ2V0KCdjbGVhdmFnZUVuenltZScpLmdldCgncnVsZScpOwogICAgICAgICAgICByZWdleHAubGFzdEluZGV4ID0gMDsKICAgICAgICAgICAgd2hpbGUgKG0gPSByZWdleHAuZXhlYyhhYVNlcS5nZXQoJ3NlcXVlbmNlJykpKSB7CiAgICAgICAgICAgICAgICB2YXIgcGVwdCA9IG1bMF0KICAgICAgICAgICAgICAgIHAgKz0gcGVwdC5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAocCA+IHBvcykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlOiBwZXB0LAogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IHAgLSBwZXB0Lmxlbmd0aAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogZnJvbSBIMkFLMjdBY0szNk1lIC0+IHtzZXFQdHI6J0gyQScsIGFhUHRyOidLMjcnfQogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwdHIKICAgICAgICAgKi8KICAgICAgICBwX3B0cjJzZXFBbmRQZXB0QW5jaG9yOiBmdW5jdGlvbiAocHRyKSB7CiAgICAgICAgICAgIHZhciByZSA9IC9eXHMqKFtBLVpdKy4qPykoW0EtWl1cZCspLzsKICAgICAgICAgICAgdmFyIG0gPSBwdHIubWF0Y2gocmUpOwogICAgICAgICAgICBpZiAoIW0pIHsKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnSWxsZWdhbHNlcXVlbmNlUHRyRXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnIGNhbm5vdCBleHRyYWN0IHNlcXVlbmNlIG5hbWUgaGVhZCAgLyBBQSBwb3MgZnJvbSBbJyArIHB0ciArICddIHdpdGggJyArIHJlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHNlcVB0cjogbVsxXSwKICAgICAgICAgICAgICAgIGFhUHRyOiBtWzJdCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICAvLyBjaGVjayBpZiBoYXZlIHRoZW0gYWxsIHN0YXRpbmcgd2l0aCBjb21tb24gKGluIHRoaXMgY2FzZSwgd2UgY2FuIHJldHVybiBvbmx5IHRoZSBjb21tb24gcGFydCkKICAgICAgICBwX3Nob3J0ZW5OYW1lOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICB2YXIgYWxsTmFtZXMgPSBfLmNvbGxlY3QoZGljb1NlcS5tb2RlbHMsIGZ1bmN0aW9uIChhYXNlcSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFhc2VxLmdldCgnbmFtZScpOwogICAgICAgICAgICB9KQogICAgICAgICAgICB2YXIgY3VyTmFtZSA9IG5hbWU7CiAgICAgICAgICAgIHZhciBpID0gbmFtZS5sZW5ndGggLSAxOwogICAgICAgICAgICB3aGlsZSAoaSA+IDApIHsKICAgICAgICAgICAgICAgIHZhciB0cnVuY2F0ZWQgPSBuYW1lLnN1YnN0cigwLCBpKTsKICAgICAgICAgICAgICAgIGlmIChfLmFueShhbGxOYW1lcywgZnVuY3Rpb24gKG4pIHsKCiAgICAgICAgICAgICAgICAgICAgdmFyIG9rRnVsbCA9IG4uc3Vic3RyKDAsIG5hbWUubGVuZ3RoKSA9PSBuYW1lOwogICAgICAgICAgICAgICAgICAgIHZhciBva1RydW5jID0gbi5zdWJzdHIoMCwgdHJ1bmNhdGVkLmxlbmd0aCkgPT0gdHJ1bmNhdGVkOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoIW9rRnVsbCAmJiBva1RydW5jKSB8fCAob2tGdWxsICYmICFva1RydW5jKTsKICAgICAgICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpLS07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5hbWUuc3Vic3RyKDAsIGkgKyAxKQogICAgICAgIH0sCgogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdjbGVhdmFnZUVuenltZScpICsgJyAjIHBlcHRpZGVzOiAnICsgXy5zaXplKHNlbGYuZ2V0KCdwZXB0aWRlSW5kZXgnKSk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gQUFTZXF1ZW5jZVBlcHRpZGVQdHI7Cn0pOwoKLyoKICogQnVpbGRzIGFuZCB1bmJ1aWxkcyBwZXB0aWRlIHNlcXVlbmNlIGF0bGFzIGNvbXBvc2luZwogKiBJbXBsaWNpdE1vZGlmaWVyIGZvciBsYWJlbHMKICogQUFTZXF1ZW5jZVBlcHRpZGVQdHIgdG8gcG9pbnQgYSB0cnlwdGljIHBlcHRpZGUgdG8gYW4gdW5hbWJpZ3VvdXMgcHJvdGVpbiBzZXF1ZW5jZSBhbiBwb3NpdGlvbgogKiB0cmFuc2Zvcm0gY29tbW9uIG1vZGlkaWZpY2F0aW9ucyBpbnRvIGEgc2hvcnRjdXQgQUNEe1Bob3NwaG99RUZ7RGltZXRoeWx9RyAtPiBBQ0RQb0VGTWUyRwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L0FBU2VxdWVuY2VQZXB0aWRlUHRyJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5JywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvSW1wbGljaXRNb2RpZmllciddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgUmljaFNlcXVlbmNlLCBBQVNlcXVlbmNlUGVwdGlkZVB0ciwgZGljb0FBLCBkaWNvUmVzTW9kLCBpbXBsaWNpdE1vZGlmaWVyKSB7CgogICAgdmFyIFJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBtb2RpZjJzaG9ydCA6IHsKICAgICAgICAgICAgICAgIC8vICdMYWJlbDoxM0MoNikxNU4oMiknOidTaWxhY2snLAogICAgICAgICAgICAgICAgLy8gJ0xhYmVsOjEzQyg2KTE1Tig0KSc6J1NpbGFjcicsCiAgICAgICAgICAgICAgICBQcm9waW9ueWwgOiAiUHJvcCIsCiAgICAgICAgICAgICAgICAnUHJvcGlvbnlsOjJIKDUpJyA6ICdQcm9wZDUnLAogICAgICAgICAgICAgICAgTWV0aHlsIDogWydNZScsICdNZTEnXSwKICAgICAgICAgICAgICAgIERpbWV0aHlsIDogJ01lMicsCiAgICAgICAgICAgICAgICBUcmltZXRoeWwgOiAnTWUzJywKICAgICAgICAgICAgICAgIEFjZXR5bCA6ICdBYycsCiAgICAgICAgICAgICAgICBQaG9zcGhvIDogJ1BvJywKICAgICAgICAgICAgICAgIEdseUdseSA6ICdVYicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVSZXZlcnNlIDogLyhbQS1aXSkoKD86W0EtWl1bYS16MC05XSspKikvZywKICAgICAgICAgICAgcmVSZXZTcGxpdE1vZGlmIDogLyg/OltBLVpdW2EtejAtOV0rKS9nCgogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7Y2xlYXZhZ2VFbnp5bWU6ICdhcmctYyd9OwogICAgICAgICAgICBzZWxmLnNldCgnYWFTZXF1ZW5jZVBlcHRpZGVQdHInLCBuZXcgQUFTZXF1ZW5jZVBlcHRpZGVQdHIoKSk7CiAgICAgICAgICAgIHNlbGYuZ2V0KCdhYVNlcXVlbmNlUGVwdGlkZVB0cicpLnNldCgnY2xlYXZhZ2VFbnp5bWUnLCBvcHRpb25zLmNsZWF2YWdlRW56eW1lKTsKICAgICAgICB9LAogICAgICAgIHNldCA6IGZ1bmN0aW9uKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKGF0dHJzLm1vZGlmMnNob3J0KSB7CiAgICAgICAgICAgICAgICBzZWxmLnBfaW5pdF9zaG9ydDJtb2RpZihhdHRycy5tb2RpZjJzaG9ydCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIEJhY2tib25lLk1vZGVsLnByb3RvdHlwZS5zZXQuY2FsbCh0aGlzLCBhdHRycywgb3B0aW9ucyk7CiAgICAgICAgfSwKCiAgICAgICAgLy8gdGhpcy5zaG9ydDJtb2RpZiA9IG51bGw7CiAgICAgICAgLy8gdGhpcy5wX2luaXRfc2hvcnQybW9kaWYgPSBwX2luaXRfc2hvcnQybW9kaWY7CiAgICAgICAgc2hvcnQybW9kaWYgOiBmdW5jdGlvbihtb2RpZlNob3JjdHV0KSB7CiAgICAgICAgICAgIHZhciBybSA9IHRoaXMuZ2V0KCdzaG9ydDJtb2RpZicpW21vZGlmU2hvcmN0dXRdOwogICAgICAgICAgICBpZiAoIXJtKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmtub3duU2hvcnRNb2RpZk5hbWUnLCBtb2RpZlNob3JjdHV0LCB0aGlzLmdldCgnc2hvcnQybW9kaWYnKSkKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lIDogJ1Vua25vd25TaG9ydE1vZGlmTmFtZScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA6IG1vZGlmU2hvcmN0dXQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcm07CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIG9uZSBvZGlmLCByZXR1cm4gdGhlIHNob3J0IGZvcm0gb2YgaXQuCiAgICAgICAgICogVGhlIG9ubHkgdHJpY2sgaXMgdGhhdCBvbmUgbW9kaWYgY2FuIGhhdmUgc2V2ZXJhbCBzaG9ydCBmb3JtcyAoTWV0aHlsIC0+IE1lIGFuZCBNZTEpCiAgICAgICAgICogYW5kIHdlIHBpY2sgdGhlIGZpcnN0IGluIHRoZSBsaXN0CiAgICAgICAgICovCiAgICAgICAgbW9kaWYyc2hvcnQgOiBmdW5jdGlvbihyZXNtb2QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgc2hvcnQgPSBzZWxmLmdldCgnbW9kaWYyc2hvcnQnKVtyZXNtb2QuZ2V0KCduYW1lJyldOwogICAgICAgICAgICBpZiAoIXNob3J0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzbW9kLmdldCgnbmFtZScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoIHNob3J0IGluc3RhbmNlb2YgQXJyYXkpID8gc2hvcnRbMF0gOiBzaG9ydDsKICAgICAgICB9LAoKICAgICAgICAvKgogICAgICAgICAqIGNvbnN0cnVjdCBhIG1hcCBmcm9tIHNob3J0IG5hbWUgdG8gbW9kaWYgb2JqZWN0LiBJbiBjYXNlIDIgc2hvcnRjdXQgcG9pbnQKICAgICAgICAgKiB0byB0aGUgc2FtZSBtb2RpZiwgd2UgdGFrZSB0aGUgb25lIHdpdGggdGhlIHNob3J0ZXN0IG5hbWUKICAgICAgICAgKi8KICAgICAgICBwX2luaXRfc2hvcnQybW9kaWYgOiBmdW5jdGlvbihuZXdWYWwpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgdG1wX3Nob3J0Mm1vZGlmID0ge307CiAgICAgICAgICAgIHZhciB0bXBfbW9kaWYyc2hvcnQgPSBuZXdWYWwgfHwgc2VsZi5nZXQoJ21vZGlmMnNob3J0Jyk7CiAgICAgICAgICAgIGZvciAobW9kIGluIHRtcF9tb2RpZjJzaG9ydCkgewogICAgICAgICAgICAgICAgdmFyIHZhbHMgPSB0bXBfbW9kaWYyc2hvcnRbbW9kXQogICAgICAgICAgICAgICAgdmFyIGxzaG9ydHMgPSAoIHZhbHMgaW5zdGFuY2VvZiBBcnJheSkgPyB2YWxzIDogW3ZhbHNdOwogICAgICAgICAgICAgICAgXy5lYWNoKGxzaG9ydHMsIGZ1bmN0aW9uKHNob3J0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRtcF9zaG9ydDJtb2RpZltzaG9ydF0gJiYgdG1wX3Nob3J0Mm1vZGlmW3Nob3J0XS5nZXQoJ25hbWUnKS5sZW5ndGggPCBtb2QubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdG1wX3Nob3J0Mm1vZGlmW3Nob3J0XSA9IGRpY29SZXNNb2QuZ2V0KG1vZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYuc2V0KCdzaG9ydDJtb2RpZicsIHRtcF9zaG9ydDJtb2RpZik7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGV4dHJhY3QgbGFiZWwgYXQgdGhlIGVuZCBiZXRld3dlbiBjdXJseSBicmFja2V0IGlmIGFueQogICAgICAgICAqIHJldHVybiBhbiBhcnJheSB3aXRoIHR3byBlbGVtZW50CiAgICAgICAgICogWzBdOiBwZXB0aWRlIHN0cmluZyB3aXRob3V0IGFueSB0cmVhdG1lbnQKICAgICAgICAgKiBbMV06IGFuIGFycmF5LCBtYXliZSBlbXB0eSB3aXRoIHRoZSBsYWJlbHMgaW4gYW4gYWxwaGFudW1lcmljYWwgb3JkZXIKICAgICAgICAgKi8KICAgICAgICBzdHJpbmcycGVwdGlkZUFuZExhYmVscyA6IGZ1bmN0aW9uKHN0cikgewogICAgICAgICAgICB2YXIgcmUgPSAvKC4rKVxbKC4qKVxdXHMqJC87CiAgICAgICAgICAgIHZhciBtID0gcmUuZXhlYyhzdHIpOwogICAgICAgICAgICBpZiAoIW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBbc3RyLnRyaW0oKSwgW11dCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFttWzFdLnRyaW0oKSwgbVsyXS50cmltKCkuc3BsaXQoJywnKS5zb3J0KCldCgogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gYSBtaW5pZmllZCBzdHJpbmcsIGJ1aWxkIGEgZnVsbCBSaWNoU2VxdWVuY2UgcGJqZWN0CiAgICAgICAgICovCiAgICAgICAgcmljaFNlcUZyb21TdHJpbmcgOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHQgPSBzZWxmLnN0cmluZzJwZXB0aWRlQW5kTGFiZWxzKHN0cikKICAgICAgICAgICAgc3RyID0gdFswXQogICAgICAgICAgICB2YXIgbW9kaWZMYWJlbHMgPSB0WzFdOwoKICAgICAgICAgICAgdmFyIHJzOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcnMgPSBuZXcgUmljaFNlcXVlbmNlKCkuZnJvbVN0cmluZyhzdHIpCiAgICAgICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICAgICAgdmFyIHRtcF9zZXEgPSBbXQogICAgICAgICAgICAgICAgdmFyIHRtcF9yZVJldlNwbGl0TW9kaWYgPSBzZWxmLmdldCgncmVSZXZTcGxpdE1vZGlmJyk7CiAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IG5ldyBSZWdFeHBGdWxsU3BsaXRlcigpLnNwbGl0KHNlbGYuZ2V0KCdyZVJldmVyc2UnKSwgc3RyLnRyaW0oKSkKCiAgICAgICAgICAgICAgICBfLmVhY2gobWF0Y2hlcywgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgICAgIHZhciByYWEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFhIDogZGljb0FBLmdldChtWzFdKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGlmU3RyID0gbVsyXTsKICAgICAgICAgICAgICAgICAgICBpZiAobW9kaWZTdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmFhLm1vZGlmaWNhdGlvbnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKG1vZGlmU3RyLm1hdGNoKHRtcF9yZVJldlNwbGl0TW9kaWYpLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWEubW9kaWZpY2F0aW9ucy5wdXNoKHNlbGYuc2hvcnQybW9kaWYobSkgfHwgZGljb1Jlc01vZC5nZXQobSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0bXBfc2VxLnB1c2gocmFhKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHJzID0gbmV3IFJpY2hTZXF1ZW5jZSh7CiAgICAgICAgICAgICAgICAgICAgc2VxdWVuY2UgOiB0bXBfc2VxCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbXBsaWNpdE1vZGlmaWVyLmxhYmVsKG1vZGlmTGFiZWxzLCBycykKICAgICAgICAgICAgcmV0dXJuIHJzOwoKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgaW52ZXJzZSBvZiByaWNoU2VxRnJvbVN0cmluZwogICAgICAgICAqLwogICAgICAgIHJpY2hTZXFUb1N0cmluZyA6IGZ1bmN0aW9uKHJpY2hTZXEpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcyA9ICcnOwoKICAgICAgICAgICAgcmljaFNlcSA9IHJpY2hTZXEuY2xvbmUoKQogICAgICAgICAgICB2YXIgbGFiZWxzID0gaW1wbGljaXRNb2RpZmllci5nZXRMYWJlbHNBbmRDbGVhbihyaWNoU2VxKQoKICAgICAgICAgICAgdmFyIHRtcF9zZXEgPSByaWNoU2VxLmdldCgnc2VxdWVuY2UnKTsKICAgICAgICAgICAgdmFyIHRtcF9tb2RpZjJzaG9ydCA9IHNlbGYuZ2V0KCdtb2RpZjJzaG9ydCcpOwoKICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCB0bXBfc2VxLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzICs9IHRtcF9zZXFbaV0uYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICAgICAgaWYgKHRtcF9zZXFbaV0ubW9kaWZpY2F0aW9ucykgewoKICAgICAgICAgICAgICAgICAgICBzICs9IF8uY29sbGVjdCh0bXBfc2VxW2ldLm1vZGlmaWNhdGlvbnMsIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1uYW1lID0gc2VsZi5tb2RpZjJzaG9ydChtKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1uYW1lID09IG0uZ2V0KCduYW1lJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoJ3snICsgbW5hbWUgKyAnfScpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybiAodG1wX21vZGlmMnNob3J0W20uZ2V0KCduYW1lJyldICE9IHVuZGVmaW5lZCkgPyB0bXBfbW9kaWYyc2hvcnRbbS5nZXQoJ25hbWUnKV0gOiAoJ3snICsgbS5uYW1lICsgJ30nKQogICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsYWJlbHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcyArPSAnIFsnICsgbGFiZWxzLmpvaW4oJywnKSArICddJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gczsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqICdIMy4xSzlNZScsICdIM0s0JywgJ0gzLkNLOU1lQWMnLCAnSDNLOU1lSzE0QUMnLCAgJ0gzLkNLOU1lQWMgW3Byb3BfZDEwXScsIHJldHVybiB0aGUgbW9kaWZpZWQgZnVsbCBSaWNoU2VxCiAgICAgICAgICoKICAgICAgICAgKi8KICAgICAgICByaWNoU2VxRnJvbVNlcXVlbmNlUHRyIDogZnVuY3Rpb24ocHRyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciB0ID0gc2VsZi5zdHJpbmcycGVwdGlkZUFuZExhYmVscyhwdHIpCiAgICAgICAgICAgIHB0ciA9IHRbMF0KICAgICAgICAgICAgdmFyIG1vZGlmTGFiZWxzID0gdFsxXTsKCiAgICAgICAgICAgIHZhciBwZXB0ID0gc2VsZi5nZXQoJ2FhU2VxdWVuY2VQZXB0aWRlUHRyJykucHRyMnBlcHRpZGUocHRyKTsKCiAgICAgICAgICAgIGlmIChwZXB0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBhYSA9IHBlcHQuc2VxdWVuY2Uuc3BsaXQoJycpOwogICAgICAgICAgICB2YXIgcmUgPSAvKFtBLVpdKShcZCspKCg/OltBLVpdW2Etel1bYS16MC05XSopKikvZzsKCiAgICAgICAgICAgIHdoaWxlICggbSA9IHJlLmV4ZWMocHRyKSkgewogICAgICAgICAgICAgICAgdmFyIGkgPSBwYXJzZUludChtWzJdKSAtIHBlcHQub2Zmc2V0CiAgICAgICAgICAgICAgICBhYVtpXSArPSBtWzNdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHNlcXBwID0gYWEuam9pbignJykKCiAgICAgICAgICAgIHZhciByaWNoU2VxID0gc2VsZi5yaWNoU2VxRnJvbVN0cmluZyhzZXFwcCkKICAgICAgICAgICAgaW1wbGljaXRNb2RpZmllci5sYWJlbChtb2RpZkxhYmVscywgcmljaFNlcSkKICAgICAgICAgICAgcmV0dXJuIHJpY2hTZXE7CgogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFdlbGwsIHRoYXQncyB0aGUgcmV2ZXJzZSBvZiByaWNoU2VxRnJvbVNlcXVlbmNlUHRyLgogICAgICAgICAqIGZyb20gYSByaWNoIHNlcXVlbmNlLCB3ZSB0cnkgdG8gZmluZCB0aGUgc2hvcnRlc3QgcG9zc2libGUgcHRyCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcmljaFNlcQogICAgICAgICAqLwogICAgICAgIHJpY2hTZXFUb1NlcXVlbmNlUHRyIDogZnVuY3Rpb24ocmljaFNlcU9yaWcpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHJpY2hTZXEgPSByaWNoU2VxT3JpZy5jbG9uZSgpCiAgICAgICAgICAgIHZhciBsYWJlbHMgPSBpbXBsaWNpdE1vZGlmaWVyLmdldExhYmVsc0FuZENsZWFuKHJpY2hTZXEpCiAgICAgICAgICAgIGlmIChsYWJlbHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgbGFiZWxzID0gJyBbJyArIGxhYmVscy5qb2luKCcsJykgKyAnXSc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsYWJlbHMgPSAnJwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYWFzZXEgPSBfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJhYS5hYS5nZXQoJ2NvZGUxJyk7CiAgICAgICAgICAgIH0pLmpvaW4oJycpOwoKICAgICAgICAgICAgdmFyIHJlZ1NlcUxpc3QgPSBzZWxmLmdldCgnYWFTZXF1ZW5jZVBlcHRpZGVQdHInKS5nZXQoJ3BlcHRpZGVJbmRleCcpW2Fhc2VxXTsKCiAgICAgICAgICAgIGlmICghcmVnU2VxTGlzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcVRvU3RyaW5nKHJpY2hTZXEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc2VxUHRyID0gc2VsZi5nZXQoJ2FhU2VxdWVuY2VQZXB0aWRlUHRyJykuY29uY2F0ZW5hdGVOYW1lcyhfLmNvbGxlY3QocmVnU2VxTGlzdCwgZnVuY3Rpb24ocHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwcC5hYVNlcS5nZXQoJ25hbWUnKQogICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAvL2NhcHV0cmUgdGhlIHN0YXJ0aW5nIHBvc2l0aW9uLiBtdXN0IHRoZSBzYW1lIGZvciBhbGwgcGVwdGlkZXMKICAgICAgICAgICAgdmFyIG9mZnNldCA9IF8uY2hhaW4ocmVnU2VxTGlzdCkuY29sbGVjdChmdW5jdGlvbihwcCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBwLm9mZnNldAogICAgICAgICAgICB9KS51bmlxKCkudmFsdWUoKTsKICAgICAgICAgICAgaWYgKG9mZnNldC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAvL3dlIGhhdmUgZGlmZmVyZW50IHNpemVzCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5yaWNoU2VxVG9TdHJpbmcocmljaFNlcSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0WzBdCgogICAgICAgICAgICB2YXIgbWluaVN0ciA9ICcnOwogICAgICAgICAgICBfLmVhY2gocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSwgaSkgewogICAgICAgICAgICAgICAgdmFyIG1vZHMgPSBfLmNoYWluKHJhYS5tb2RpZmljYXRpb25zKS5jb2xsZWN0KGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5tb2RpZjJzaG9ydChtKTsKICAgICAgICAgICAgICAgIH0pLnZhbHVlKCkuam9pbignJyk7CiAgICAgICAgICAgICAgICBpZiAobW9kcyAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICBtaW5pU3RyICs9IHJhYS5hYS5nZXQoJ2NvZGUxJykgKyAoaSArIG9mZnNldCkgKyBtb2RzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAobWluaVN0ciA9PT0gJycpIHsKICAgICAgICAgICAgICAgIC8vZmluZCBhdCBsZWFzdCBvbmUgbHlzaW5lCiAgICAgICAgICAgICAgICB2YXIgaWsgPSBfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpCiAgICAgICAgICAgICAgICB9KS5qb2luKCcnKS5pbmRleE9mKCdLJyk7CiAgICAgICAgICAgICAgICBpZiAoaWsgPj0gMCkgewogICAgICAgICAgICAgICAgICAgIG1pbmlTdHIgPSAnSycgKyAoaWsgKyBvZmZzZXQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1pbmlTdHIgPT09ICcnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5yaWNoU2VxVG9TdHJpbmcocmljaFNlcSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vYmFjayBjaGVjayB0aGF0IHRoZSByZXZlcnNlIGlzIGdpdmUgdGhlIHNhbWUKICAgICAgICAgICAgbWluaVN0ciA9IHNlcVB0ciArIG1pbmlTdHIgKyBsYWJlbHM7CiAgICAgICAgICAgIHZhciBiYWNrUGVwdCA9IHNlbGYucmljaFNlcUZyb21TZXF1ZW5jZVB0cihtaW5pU3RyLCB0cnVlKTsKCiAgICAgICAgICAgIGlmICghYmFja1BlcHQuZXF1YWxzVG8ocmljaFNlcU9yaWcpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5yaWNoU2VxVG9TdHJpbmcocmljaFNlcU9yaWcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtaW5pU3RyCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBXaWxsIHRyeSB0byBidWlsZCB0aGUgc2VxdWVuY2UgZnJvbSBhIHNlcXVlbmNlUHRyIG9yIGEgY2xhc3NpYyBzZXF1ZW5jZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdHIKICAgICAgICAgKiBAcGFyYW0ge1JpY2hTZXF1ZW5jZX0gaXBSaWNoU2VxLCBmb3IgaW5wbGFjZSByZXBsYWNlbWVudCBpbnN0ZWFkIG9mIGNyZWF0aW5nIGEgbmV3IG9uZS4uLgogICAgICAgICAqLwogICAgICAgIHJpY2hTZXFGcm9tIDogZnVuY3Rpb24oc3RyLCBpcFJpY2hTZXEpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAzKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCczIHBhcmFtZXRlcnMsIG5vIGdvb2QhIScpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL15cd1wuLywgJycpOwogICAgICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvXC5cdyQvLCAnJyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJpY2hTZXF1ZW5jZSgpLmZyb21TdHJpbmcoc3RyKTsKICAgICAgICAgICAgfSBjYXRjaChleGMpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcUZyb21TZXF1ZW5jZVB0cihzdHIpCiAgICAgICAgICAgICAgICB9IGNhdGNoKGV4YykgewogICAgICAgICAgICAgICAgICAgIHZhciBycyA9IHNlbGYucmljaFNlcUZyb21TdHJpbmcoc3RyKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBycwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogV2lsbCB0cnkgdG8gYnVpbGQgdGhlIHNlcXVlbmNlIGZyb20gYSBzZXF1ZW5jZVB0ciBvciBhIGNsYXNzaWMgc2VxdWVuY2UKICAgICAgICAgKiBjb21wYXJlZCB0byByaWNoU2VxRnJvbSwgaW5wbGFjZSByZXBsYWNlbWVudCBvZiBpcFJpY2hTZXEsIGluc3RlYWQgb2YgcmVhdGluZyBhIG5ldyBvbmUuLi4KICAgICAgICAgKiBAcGFyYW0ge1JpY2hTZXF1ZW5jZX0gaXBSaWNoU2VxLAogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdHIKICAgICAgICAgKi8KICAgICAgICByaWNoU2VxUmVhZEZyb20gOiBmdW5jdGlvbihpcFJpY2hTZXEsIHN0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBycyA9IHNlbGYucmljaFNlcUZyb20oc3RyKTsKCiAgICAgICAgICAgIC8vb2ssIHdlIGNhbiBkbyBiZXR0ZXIsIGJ1IHRoYXQgd2lsbCBmbHkgZm9yIHRoZSBtb21lbnQKICAgICAgICAgICAgaXBSaWNoU2VxLmZyb21TdHJpbmcocnMudG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXI7Cn0pOwoKLyohCiAqIEJvb3RzdHJhcCB2My4xLjEgKGh0dHA6Ly9nZXRib290c3RyYXAuY29tKQogKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICovCmlmKCJ1bmRlZmluZWQiPT10eXBlb2YgalF1ZXJ5KXRocm93IG5ldyBFcnJvcigiQm9vdHN0cmFwJ3MgSmF2YVNjcmlwdCByZXF1aXJlcyBqUXVlcnkiKTsrZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYigpe3ZhciBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJvb3RzdHJhcCIpLGI9e1dlYmtpdFRyYW5zaXRpb246IndlYmtpdFRyYW5zaXRpb25FbmQiLE1velRyYW5zaXRpb246InRyYW5zaXRpb25lbmQiLE9UcmFuc2l0aW9uOiJvVHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCIsdHJhbnNpdGlvbjoidHJhbnNpdGlvbmVuZCJ9O2Zvcih2YXIgYyBpbiBiKWlmKHZvaWQgMCE9PWEuc3R5bGVbY10pcmV0dXJue2VuZDpiW2NdfTtyZXR1cm4hMX1hLmZuLmVtdWxhdGVUcmFuc2l0aW9uRW5kPWZ1bmN0aW9uKGIpe3ZhciBjPSExLGQ9dGhpczthKHRoaXMpLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZnVuY3Rpb24oKXtjPSEwfSk7dmFyIGU9ZnVuY3Rpb24oKXtjfHxhKGQpLnRyaWdnZXIoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kKX07cmV0dXJuIHNldFRpbWVvdXQoZSxiKSx0aGlzfSxhKGZ1bmN0aW9uKCl7YS5zdXBwb3J0LnRyYW5zaXRpb249YigpfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPSdbZGF0YS1kaXNtaXNzPSJhbGVydCJdJyxjPWZ1bmN0aW9uKGMpe2EoYykub24oImNsaWNrIixiLHRoaXMuY2xvc2UpfTtjLnByb3RvdHlwZS5jbG9zZT1mdW5jdGlvbihiKXtmdW5jdGlvbiBjKCl7Zi50cmlnZ2VyKCJjbG9zZWQuYnMuYWxlcnQiKS5yZW1vdmUoKX12YXIgZD1hKHRoaXMpLGU9ZC5hdHRyKCJkYXRhLXRhcmdldCIpO2V8fChlPWQuYXR0cigiaHJlZiIpLGU9ZSYmZS5yZXBsYWNlKC8uKig/PSNbXlxzXSokKS8sIiIpKTt2YXIgZj1hKGUpO2ImJmIucHJldmVudERlZmF1bHQoKSxmLmxlbmd0aHx8KGY9ZC5oYXNDbGFzcygiYWxlcnQiKT9kOmQucGFyZW50KCkpLGYudHJpZ2dlcihiPWEuRXZlbnQoImNsb3NlLmJzLmFsZXJ0IikpLGIuaXNEZWZhdWx0UHJldmVudGVkKCl8fChmLnJlbW92ZUNsYXNzKCJpbiIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZmLmhhc0NsYXNzKCJmYWRlIik/Zi5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGMpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCk6YygpKX07dmFyIGQ9YS5mbi5hbGVydDthLmZuLmFsZXJ0PWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5hbGVydCIpO2V8fGQuZGF0YSgiYnMuYWxlcnQiLGU9bmV3IGModGhpcykpLCJzdHJpbmciPT10eXBlb2YgYiYmZVtiXS5jYWxsKGQpfSl9LGEuZm4uYWxlcnQuQ29uc3RydWN0b3I9YyxhLmZuLmFsZXJ0Lm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5hbGVydD1kLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5hbGVydC5kYXRhLWFwaSIsYixjLnByb3RvdHlwZS5jbG9zZSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGMsZCl7dGhpcy4kZWxlbWVudD1hKGMpLHRoaXMub3B0aW9ucz1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQpLHRoaXMuaXNMb2FkaW5nPSExfTtiLkRFRkFVTFRTPXtsb2FkaW5nVGV4dDoibG9hZGluZy4uLiJ9LGIucHJvdG90eXBlLnNldFN0YXRlPWZ1bmN0aW9uKGIpe3ZhciBjPSJkaXNhYmxlZCIsZD10aGlzLiRlbGVtZW50LGU9ZC5pcygiaW5wdXQiKT8idmFsIjoiaHRtbCIsZj1kLmRhdGEoKTtiKz0iVGV4dCIsZi5yZXNldFRleHR8fGQuZGF0YSgicmVzZXRUZXh0IixkW2VdKCkpLGRbZV0oZltiXXx8dGhpcy5vcHRpb25zW2JdKSxzZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXsibG9hZGluZ1RleHQiPT1iPyh0aGlzLmlzTG9hZGluZz0hMCxkLmFkZENsYXNzKGMpLmF0dHIoYyxjKSk6dGhpcy5pc0xvYWRpbmcmJih0aGlzLmlzTG9hZGluZz0hMSxkLnJlbW92ZUNsYXNzKGMpLnJlbW92ZUF0dHIoYykpfSx0aGlzKSwwKX0sYi5wcm90b3R5cGUudG9nZ2xlPWZ1bmN0aW9uKCl7dmFyIGE9ITAsYj10aGlzLiRlbGVtZW50LmNsb3Nlc3QoJ1tkYXRhLXRvZ2dsZT0iYnV0dG9ucyJdJyk7aWYoYi5sZW5ndGgpe3ZhciBjPXRoaXMuJGVsZW1lbnQuZmluZCgiaW5wdXQiKTsicmFkaW8iPT1jLnByb3AoInR5cGUiKSYmKGMucHJvcCgiY2hlY2tlZCIpJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJhY3RpdmUiKT9hPSExOmIuZmluZCgiLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSksYSYmYy5wcm9wKCJjaGVja2VkIiwhdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiYWN0aXZlIikpLnRyaWdnZXIoImNoYW5nZSIpfWEmJnRoaXMuJGVsZW1lbnQudG9nZ2xlQ2xhc3MoImFjdGl2ZSIpfTt2YXIgYz1hLmZuLmJ1dHRvbjthLmZuLmJ1dHRvbj1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMuYnV0dG9uIiksZj0ib2JqZWN0Ij09dHlwZW9mIGMmJmM7ZXx8ZC5kYXRhKCJicy5idXR0b24iLGU9bmV3IGIodGhpcyxmKSksInRvZ2dsZSI9PWM/ZS50b2dnbGUoKTpjJiZlLnNldFN0YXRlKGMpfSl9LGEuZm4uYnV0dG9uLkNvbnN0cnVjdG9yPWIsYS5mbi5idXR0b24ubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLmJ1dHRvbj1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5idXR0b24uZGF0YS1hcGkiLCJbZGF0YS10b2dnbGVePWJ1dHRvbl0iLGZ1bmN0aW9uKGIpe3ZhciBjPWEoYi50YXJnZXQpO2MuaGFzQ2xhc3MoImJ0biIpfHwoYz1jLmNsb3Nlc3QoIi5idG4iKSksYy5idXR0b24oInRvZ2dsZSIpLGIucHJldmVudERlZmF1bHQoKX0pfShqUXVlcnkpLCtmdW5jdGlvbihhKXt2YXIgYj1mdW5jdGlvbihiLGMpe3RoaXMuJGVsZW1lbnQ9YShiKSx0aGlzLiRpbmRpY2F0b3JzPXRoaXMuJGVsZW1lbnQuZmluZCgiLmNhcm91c2VsLWluZGljYXRvcnMiKSx0aGlzLm9wdGlvbnM9Yyx0aGlzLnBhdXNlZD10aGlzLnNsaWRpbmc9dGhpcy5pbnRlcnZhbD10aGlzLiRhY3RpdmU9dGhpcy4kaXRlbXM9bnVsbCwiaG92ZXIiPT10aGlzLm9wdGlvbnMucGF1c2UmJnRoaXMuJGVsZW1lbnQub24oIm1vdXNlZW50ZXIiLGEucHJveHkodGhpcy5wYXVzZSx0aGlzKSkub24oIm1vdXNlbGVhdmUiLGEucHJveHkodGhpcy5jeWNsZSx0aGlzKSl9O2IuREVGQVVMVFM9e2ludGVydmFsOjVlMyxwYXVzZToiaG92ZXIiLHdyYXA6ITB9LGIucHJvdG90eXBlLmN5Y2xlPWZ1bmN0aW9uKGIpe3JldHVybiBifHwodGhpcy5wYXVzZWQ9ITEpLHRoaXMuaW50ZXJ2YWwmJmNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCksdGhpcy5vcHRpb25zLmludGVydmFsJiYhdGhpcy5wYXVzZWQmJih0aGlzLmludGVydmFsPXNldEludGVydmFsKGEucHJveHkodGhpcy5uZXh0LHRoaXMpLHRoaXMub3B0aW9ucy5pbnRlcnZhbCkpLHRoaXN9LGIucHJvdG90eXBlLmdldEFjdGl2ZUluZGV4PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJGFjdGl2ZT10aGlzLiRlbGVtZW50LmZpbmQoIi5pdGVtLmFjdGl2ZSIpLHRoaXMuJGl0ZW1zPXRoaXMuJGFjdGl2ZS5wYXJlbnQoKS5jaGlsZHJlbigpLHRoaXMuJGl0ZW1zLmluZGV4KHRoaXMuJGFjdGl2ZSl9LGIucHJvdG90eXBlLnRvPWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMsZD10aGlzLmdldEFjdGl2ZUluZGV4KCk7cmV0dXJuIGI+dGhpcy4kaXRlbXMubGVuZ3RoLTF8fDA+Yj92b2lkIDA6dGhpcy5zbGlkaW5nP3RoaXMuJGVsZW1lbnQub25lKCJzbGlkLmJzLmNhcm91c2VsIixmdW5jdGlvbigpe2MudG8oYil9KTpkPT1iP3RoaXMucGF1c2UoKS5jeWNsZSgpOnRoaXMuc2xpZGUoYj5kPyJuZXh0IjoicHJldiIsYSh0aGlzLiRpdGVtc1tiXSkpfSxiLnByb3RvdHlwZS5wYXVzZT1mdW5jdGlvbihiKXtyZXR1cm4gYnx8KHRoaXMucGF1c2VkPSEwKSx0aGlzLiRlbGVtZW50LmZpbmQoIi5uZXh0LCAucHJldiIpLmxlbmd0aCYmYS5zdXBwb3J0LnRyYW5zaXRpb24mJih0aGlzLiRlbGVtZW50LnRyaWdnZXIoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kKSx0aGlzLmN5Y2xlKCEwKSksdGhpcy5pbnRlcnZhbD1jbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpLHRoaXN9LGIucHJvdG90eXBlLm5leHQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zbGlkaW5nP3ZvaWQgMDp0aGlzLnNsaWRlKCJuZXh0Iil9LGIucHJvdG90eXBlLnByZXY9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zbGlkaW5nP3ZvaWQgMDp0aGlzLnNsaWRlKCJwcmV2Iil9LGIucHJvdG90eXBlLnNsaWRlPWZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy4kZWxlbWVudC5maW5kKCIuaXRlbS5hY3RpdmUiKSxlPWN8fGRbYl0oKSxmPXRoaXMuaW50ZXJ2YWwsZz0ibmV4dCI9PWI/ImxlZnQiOiJyaWdodCIsaD0ibmV4dCI9PWI/ImZpcnN0IjoibGFzdCIsaT10aGlzO2lmKCFlLmxlbmd0aCl7aWYoIXRoaXMub3B0aW9ucy53cmFwKXJldHVybjtlPXRoaXMuJGVsZW1lbnQuZmluZCgiLml0ZW0iKVtoXSgpfWlmKGUuaGFzQ2xhc3MoImFjdGl2ZSIpKXJldHVybiB0aGlzLnNsaWRpbmc9ITE7dmFyIGo9YS5FdmVudCgic2xpZGUuYnMuY2Fyb3VzZWwiLHtyZWxhdGVkVGFyZ2V0OmVbMF0sZGlyZWN0aW9uOmd9KTtyZXR1cm4gdGhpcy4kZWxlbWVudC50cmlnZ2VyKGopLGouaXNEZWZhdWx0UHJldmVudGVkKCk/dm9pZCAwOih0aGlzLnNsaWRpbmc9ITAsZiYmdGhpcy5wYXVzZSgpLHRoaXMuJGluZGljYXRvcnMubGVuZ3RoJiYodGhpcy4kaW5kaWNhdG9ycy5maW5kKCIuYWN0aXZlIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpLHRoaXMuJGVsZW1lbnQub25lKCJzbGlkLmJzLmNhcm91c2VsIixmdW5jdGlvbigpe3ZhciBiPWEoaS4kaW5kaWNhdG9ycy5jaGlsZHJlbigpW2kuZ2V0QWN0aXZlSW5kZXgoKV0pO2ImJmIuYWRkQ2xhc3MoImFjdGl2ZSIpfSkpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJzbGlkZSIpPyhlLmFkZENsYXNzKGIpLGVbMF0ub2Zmc2V0V2lkdGgsZC5hZGRDbGFzcyhnKSxlLmFkZENsYXNzKGcpLGQub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxmdW5jdGlvbigpe2UucmVtb3ZlQ2xhc3MoW2IsZ10uam9pbigiICIpKS5hZGRDbGFzcygiYWN0aXZlIiksZC5yZW1vdmVDbGFzcyhbImFjdGl2ZSIsZ10uam9pbigiICIpKSxpLnNsaWRpbmc9ITEsc2V0VGltZW91dChmdW5jdGlvbigpe2kuJGVsZW1lbnQudHJpZ2dlcigic2xpZC5icy5jYXJvdXNlbCIpfSwwKX0pLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDFlMypkLmNzcygidHJhbnNpdGlvbi1kdXJhdGlvbiIpLnNsaWNlKDAsLTEpKSk6KGQucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpLGUuYWRkQ2xhc3MoImFjdGl2ZSIpLHRoaXMuc2xpZGluZz0hMSx0aGlzLiRlbGVtZW50LnRyaWdnZXIoInNsaWQuYnMuY2Fyb3VzZWwiKSksZiYmdGhpcy5jeWNsZSgpLHRoaXMpfTt2YXIgYz1hLmZuLmNhcm91c2VsO2EuZm4uY2Fyb3VzZWw9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLmNhcm91c2VsIiksZj1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQuZGF0YSgpLCJvYmplY3QiPT10eXBlb2YgYyYmYyksZz0ic3RyaW5nIj09dHlwZW9mIGM/YzpmLnNsaWRlO2V8fGQuZGF0YSgiYnMuY2Fyb3VzZWwiLGU9bmV3IGIodGhpcyxmKSksIm51bWJlciI9PXR5cGVvZiBjP2UudG8oYyk6Zz9lW2ddKCk6Zi5pbnRlcnZhbCYmZS5wYXVzZSgpLmN5Y2xlKCl9KX0sYS5mbi5jYXJvdXNlbC5Db25zdHJ1Y3Rvcj1iLGEuZm4uY2Fyb3VzZWwubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLmNhcm91c2VsPWMsdGhpc30sYShkb2N1bWVudCkub24oImNsaWNrLmJzLmNhcm91c2VsLmRhdGEtYXBpIiwiW2RhdGEtc2xpZGVdLCBbZGF0YS1zbGlkZS10b10iLGZ1bmN0aW9uKGIpe3ZhciBjLGQ9YSh0aGlzKSxlPWEoZC5hdHRyKCJkYXRhLXRhcmdldCIpfHwoYz1kLmF0dHIoImhyZWYiKSkmJmMucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCIiKSksZj1hLmV4dGVuZCh7fSxlLmRhdGEoKSxkLmRhdGEoKSksZz1kLmF0dHIoImRhdGEtc2xpZGUtdG8iKTtnJiYoZi5pbnRlcnZhbD0hMSksZS5jYXJvdXNlbChmKSwoZz1kLmF0dHIoImRhdGEtc2xpZGUtdG8iKSkmJmUuZGF0YSgiYnMuY2Fyb3VzZWwiKS50byhnKSxiLnByZXZlbnREZWZhdWx0KCl9KSxhKHdpbmRvdykub24oImxvYWQiLGZ1bmN0aW9uKCl7YSgnW2RhdGEtcmlkZT0iY2Fyb3VzZWwiXScpLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1hKHRoaXMpO2IuY2Fyb3VzZWwoYi5kYXRhKCkpfSl9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYyxkKXt0aGlzLiRlbGVtZW50PWEoYyksdGhpcy5vcHRpb25zPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZCksdGhpcy50cmFuc2l0aW9uaW5nPW51bGwsdGhpcy5vcHRpb25zLnBhcmVudCYmKHRoaXMuJHBhcmVudD1hKHRoaXMub3B0aW9ucy5wYXJlbnQpKSx0aGlzLm9wdGlvbnMudG9nZ2xlJiZ0aGlzLnRvZ2dsZSgpfTtiLkRFRkFVTFRTPXt0b2dnbGU6ITB9LGIucHJvdG90eXBlLmRpbWVuc2lvbj1mdW5jdGlvbigpe3ZhciBhPXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoIndpZHRoIik7cmV0dXJuIGE/IndpZHRoIjoiaGVpZ2h0In0sYi5wcm90b3R5cGUuc2hvdz1mdW5jdGlvbigpe2lmKCF0aGlzLnRyYW5zaXRpb25pbmcmJiF0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJpbiIpKXt2YXIgYj1hLkV2ZW50KCJzaG93LmJzLmNvbGxhcHNlIik7aWYodGhpcy4kZWxlbWVudC50cmlnZ2VyKGIpLCFiLmlzRGVmYXVsdFByZXZlbnRlZCgpKXt2YXIgYz10aGlzLiRwYXJlbnQmJnRoaXMuJHBhcmVudC5maW5kKCI+IC5wYW5lbCA+IC5pbiIpO2lmKGMmJmMubGVuZ3RoKXt2YXIgZD1jLmRhdGEoImJzLmNvbGxhcHNlIik7aWYoZCYmZC50cmFuc2l0aW9uaW5nKXJldHVybjtjLmNvbGxhcHNlKCJoaWRlIiksZHx8Yy5kYXRhKCJicy5jb2xsYXBzZSIsbnVsbCl9dmFyIGU9dGhpcy5kaW1lbnNpb24oKTt0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJjb2xsYXBzZSIpLmFkZENsYXNzKCJjb2xsYXBzaW5nIilbZV0oMCksdGhpcy50cmFuc2l0aW9uaW5nPTE7dmFyIGY9ZnVuY3Rpb24oKXt0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJjb2xsYXBzaW5nIikuYWRkQ2xhc3MoImNvbGxhcHNlIGluIilbZV0oImF1dG8iKSx0aGlzLnRyYW5zaXRpb25pbmc9MCx0aGlzLiRlbGVtZW50LnRyaWdnZXIoInNob3duLmJzLmNvbGxhcHNlIil9O2lmKCFhLnN1cHBvcnQudHJhbnNpdGlvbilyZXR1cm4gZi5jYWxsKHRoaXMpO3ZhciBnPWEuY2FtZWxDYXNlKFsic2Nyb2xsIixlXS5qb2luKCItIikpO3RoaXMuJGVsZW1lbnQub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxhLnByb3h5KGYsdGhpcykpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDM1MClbZV0odGhpcy4kZWxlbWVudFswXVtnXSl9fX0sYi5wcm90b3R5cGUuaGlkZT1mdW5jdGlvbigpe2lmKCF0aGlzLnRyYW5zaXRpb25pbmcmJnRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImluIikpe3ZhciBiPWEuRXZlbnQoImhpZGUuYnMuY29sbGFwc2UiKTtpZih0aGlzLiRlbGVtZW50LnRyaWdnZXIoYiksIWIuaXNEZWZhdWx0UHJldmVudGVkKCkpe3ZhciBjPXRoaXMuZGltZW5zaW9uKCk7dGhpcy4kZWxlbWVudFtjXSh0aGlzLiRlbGVtZW50W2NdKCkpWzBdLm9mZnNldEhlaWdodCx0aGlzLiRlbGVtZW50LmFkZENsYXNzKCJjb2xsYXBzaW5nIikucmVtb3ZlQ2xhc3MoImNvbGxhcHNlIikucmVtb3ZlQ2xhc3MoImluIiksdGhpcy50cmFuc2l0aW9uaW5nPTE7dmFyIGQ9ZnVuY3Rpb24oKXt0aGlzLnRyYW5zaXRpb25pbmc9MCx0aGlzLiRlbGVtZW50LnRyaWdnZXIoImhpZGRlbi5icy5jb2xsYXBzZSIpLnJlbW92ZUNsYXNzKCJjb2xsYXBzaW5nIikuYWRkQ2xhc3MoImNvbGxhcHNlIil9O3JldHVybiBhLnN1cHBvcnQudHJhbnNpdGlvbj92b2lkIHRoaXMuJGVsZW1lbnRbY10oMCkub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxhLnByb3h5KGQsdGhpcykpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDM1MCk6ZC5jYWxsKHRoaXMpfX19LGIucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbigpe3RoaXNbdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiaW4iKT8iaGlkZSI6InNob3ciXSgpfTt2YXIgYz1hLmZuLmNvbGxhcHNlO2EuZm4uY29sbGFwc2U9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLmNvbGxhcHNlIiksZj1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQuZGF0YSgpLCJvYmplY3QiPT10eXBlb2YgYyYmYyk7IWUmJmYudG9nZ2xlJiYic2hvdyI9PWMmJihjPSFjKSxlfHxkLmRhdGEoImJzLmNvbGxhcHNlIixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4uY29sbGFwc2UuQ29uc3RydWN0b3I9YixhLmZuLmNvbGxhcHNlLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5jb2xsYXBzZT1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5jb2xsYXBzZS5kYXRhLWFwaSIsIltkYXRhLXRvZ2dsZT1jb2xsYXBzZV0iLGZ1bmN0aW9uKGIpe3ZhciBjLGQ9YSh0aGlzKSxlPWQuYXR0cigiZGF0YS10YXJnZXQiKXx8Yi5wcmV2ZW50RGVmYXVsdCgpfHwoYz1kLmF0dHIoImhyZWYiKSkmJmMucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCIiKSxmPWEoZSksZz1mLmRhdGEoImJzLmNvbGxhcHNlIiksaD1nPyJ0b2dnbGUiOmQuZGF0YSgpLGk9ZC5hdHRyKCJkYXRhLXBhcmVudCIpLGo9aSYmYShpKTtnJiZnLnRyYW5zaXRpb25pbmd8fChqJiZqLmZpbmQoJ1tkYXRhLXRvZ2dsZT1jb2xsYXBzZV1bZGF0YS1wYXJlbnQ9IicraSsnIl0nKS5ub3QoZCkuYWRkQ2xhc3MoImNvbGxhcHNlZCIpLGRbZi5oYXNDbGFzcygiaW4iKT8iYWRkQ2xhc3MiOiJyZW1vdmVDbGFzcyJdKCJjb2xsYXBzZWQiKSksZi5jb2xsYXBzZShoKX0pfShqUXVlcnkpLCtmdW5jdGlvbihhKXtmdW5jdGlvbiBiKGIpe2EoZCkucmVtb3ZlKCksYShlKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YyhhKHRoaXMpKSxlPXtyZWxhdGVkVGFyZ2V0OnRoaXN9O2QuaGFzQ2xhc3MoIm9wZW4iKSYmKGQudHJpZ2dlcihiPWEuRXZlbnQoImhpZGUuYnMuZHJvcGRvd24iLGUpKSxiLmlzRGVmYXVsdFByZXZlbnRlZCgpfHxkLnJlbW92ZUNsYXNzKCJvcGVuIikudHJpZ2dlcigiaGlkZGVuLmJzLmRyb3Bkb3duIixlKSl9KX1mdW5jdGlvbiBjKGIpe3ZhciBjPWIuYXR0cigiZGF0YS10YXJnZXQiKTtjfHwoYz1iLmF0dHIoImhyZWYiKSxjPWMmJi8jW0EtWmEtel0vLnRlc3QoYykmJmMucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCIiKSk7dmFyIGQ9YyYmYShjKTtyZXR1cm4gZCYmZC5sZW5ndGg/ZDpiLnBhcmVudCgpfXZhciBkPSIuZHJvcGRvd24tYmFja2Ryb3AiLGU9IltkYXRhLXRvZ2dsZT1kcm9wZG93bl0iLGY9ZnVuY3Rpb24oYil7YShiKS5vbigiY2xpY2suYnMuZHJvcGRvd24iLHRoaXMudG9nZ2xlKX07Zi5wcm90b3R5cGUudG9nZ2xlPWZ1bmN0aW9uKGQpe3ZhciBlPWEodGhpcyk7aWYoIWUuaXMoIi5kaXNhYmxlZCwgOmRpc2FibGVkIikpe3ZhciBmPWMoZSksZz1mLmhhc0NsYXNzKCJvcGVuIik7aWYoYigpLCFnKXsib250b3VjaHN0YXJ0ImluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCYmIWYuY2xvc2VzdCgiLm5hdmJhci1uYXYiKS5sZW5ndGgmJmEoJzxkaXYgY2xhc3M9ImRyb3Bkb3duLWJhY2tkcm9wIi8+JykuaW5zZXJ0QWZ0ZXIoYSh0aGlzKSkub24oImNsaWNrIixiKTt2YXIgaD17cmVsYXRlZFRhcmdldDp0aGlzfTtpZihmLnRyaWdnZXIoZD1hLkV2ZW50KCJzaG93LmJzLmRyb3Bkb3duIixoKSksZC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSlyZXR1cm47Zi50b2dnbGVDbGFzcygib3BlbiIpLnRyaWdnZXIoInNob3duLmJzLmRyb3Bkb3duIixoKSxlLmZvY3VzKCl9cmV0dXJuITF9fSxmLnByb3RvdHlwZS5rZXlkb3duPWZ1bmN0aW9uKGIpe2lmKC8oMzh8NDB8MjcpLy50ZXN0KGIua2V5Q29kZSkpe3ZhciBkPWEodGhpcyk7aWYoYi5wcmV2ZW50RGVmYXVsdCgpLGIuc3RvcFByb3BhZ2F0aW9uKCksIWQuaXMoIi5kaXNhYmxlZCwgOmRpc2FibGVkIikpe3ZhciBmPWMoZCksZz1mLmhhc0NsYXNzKCJvcGVuIik7aWYoIWd8fGcmJjI3PT1iLmtleUNvZGUpcmV0dXJuIDI3PT1iLndoaWNoJiZmLmZpbmQoZSkuZm9jdXMoKSxkLmNsaWNrKCk7dmFyIGg9IiBsaTpub3QoLmRpdmlkZXIpOnZpc2libGUgYSIsaT1mLmZpbmQoIltyb2xlPW1lbnVdIitoKyIsIFtyb2xlPWxpc3Rib3hdIitoKTtpZihpLmxlbmd0aCl7dmFyIGo9aS5pbmRleChpLmZpbHRlcigiOmZvY3VzIikpOzM4PT1iLmtleUNvZGUmJmo+MCYmai0tLDQwPT1iLmtleUNvZGUmJmo8aS5sZW5ndGgtMSYmaisrLH5qfHwoaj0wKSxpLmVxKGopLmZvY3VzKCl9fX19O3ZhciBnPWEuZm4uZHJvcGRvd247YS5mbi5kcm9wZG93bj1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxkPWMuZGF0YSgiYnMuZHJvcGRvd24iKTtkfHxjLmRhdGEoImJzLmRyb3Bkb3duIixkPW5ldyBmKHRoaXMpKSwic3RyaW5nIj09dHlwZW9mIGImJmRbYl0uY2FsbChjKX0pfSxhLmZuLmRyb3Bkb3duLkNvbnN0cnVjdG9yPWYsYS5mbi5kcm9wZG93bi5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uZHJvcGRvd249Zyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuZHJvcGRvd24uZGF0YS1hcGkiLGIpLm9uKCJjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaSIsIi5kcm9wZG93biBmb3JtIixmdW5jdGlvbihhKXthLnN0b3BQcm9wYWdhdGlvbigpfSkub24oImNsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpIixlLGYucHJvdG90eXBlLnRvZ2dsZSkub24oImtleWRvd24uYnMuZHJvcGRvd24uZGF0YS1hcGkiLGUrIiwgW3JvbGU9bWVudV0sIFtyb2xlPWxpc3Rib3hdIixmLnByb3RvdHlwZS5rZXlkb3duKX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYixjKXt0aGlzLm9wdGlvbnM9Yyx0aGlzLiRlbGVtZW50PWEoYiksdGhpcy4kYmFja2Ryb3A9dGhpcy5pc1Nob3duPW51bGwsdGhpcy5vcHRpb25zLnJlbW90ZSYmdGhpcy4kZWxlbWVudC5maW5kKCIubW9kYWwtY29udGVudCIpLmxvYWQodGhpcy5vcHRpb25zLnJlbW90ZSxhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy4kZWxlbWVudC50cmlnZ2VyKCJsb2FkZWQuYnMubW9kYWwiKX0sdGhpcykpfTtiLkRFRkFVTFRTPXtiYWNrZHJvcDohMCxrZXlib2FyZDohMCxzaG93OiEwfSxiLnByb3RvdHlwZS50b2dnbGU9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXNbdGhpcy5pc1Nob3duPyJoaWRlIjoic2hvdyJdKGEpfSxiLnByb3RvdHlwZS5zaG93PWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMsZD1hLkV2ZW50KCJzaG93LmJzLm1vZGFsIix7cmVsYXRlZFRhcmdldDpifSk7dGhpcy4kZWxlbWVudC50cmlnZ2VyKGQpLHRoaXMuaXNTaG93bnx8ZC5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8KHRoaXMuaXNTaG93bj0hMCx0aGlzLmVzY2FwZSgpLHRoaXMuJGVsZW1lbnQub24oImNsaWNrLmRpc21pc3MuYnMubW9kYWwiLCdbZGF0YS1kaXNtaXNzPSJtb2RhbCJdJyxhLnByb3h5KHRoaXMuaGlkZSx0aGlzKSksdGhpcy5iYWNrZHJvcChmdW5jdGlvbigpe3ZhciBkPWEuc3VwcG9ydC50cmFuc2l0aW9uJiZjLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik7Yy4kZWxlbWVudC5wYXJlbnQoKS5sZW5ndGh8fGMuJGVsZW1lbnQuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSksYy4kZWxlbWVudC5zaG93KCkuc2Nyb2xsVG9wKDApLGQmJmMuJGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGgsYy4kZWxlbWVudC5hZGRDbGFzcygiaW4iKS5hdHRyKCJhcmlhLWhpZGRlbiIsITEpLGMuZW5mb3JjZUZvY3VzKCk7dmFyIGU9YS5FdmVudCgic2hvd24uYnMubW9kYWwiLHtyZWxhdGVkVGFyZ2V0OmJ9KTtkP2MuJGVsZW1lbnQuZmluZCgiLm1vZGFsLWRpYWxvZyIpLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZnVuY3Rpb24oKXtjLiRlbGVtZW50LmZvY3VzKCkudHJpZ2dlcihlKX0pLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDMwMCk6Yy4kZWxlbWVudC5mb2N1cygpLnRyaWdnZXIoZSl9KSl9LGIucHJvdG90eXBlLmhpZGU9ZnVuY3Rpb24oYil7YiYmYi5wcmV2ZW50RGVmYXVsdCgpLGI9YS5FdmVudCgiaGlkZS5icy5tb2RhbCIpLHRoaXMuJGVsZW1lbnQudHJpZ2dlcihiKSx0aGlzLmlzU2hvd24mJiFiLmlzRGVmYXVsdFByZXZlbnRlZCgpJiYodGhpcy5pc1Nob3duPSExLHRoaXMuZXNjYXBlKCksYShkb2N1bWVudCkub2ZmKCJmb2N1c2luLmJzLm1vZGFsIiksdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygiaW4iKS5hdHRyKCJhcmlhLWhpZGRlbiIsITApLm9mZigiY2xpY2suZGlzbWlzcy5icy5tb2RhbCIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik/dGhpcy4kZWxlbWVudC5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGEucHJveHkodGhpcy5oaWRlTW9kYWwsdGhpcykpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDMwMCk6dGhpcy5oaWRlTW9kYWwoKSl9LGIucHJvdG90eXBlLmVuZm9yY2VGb2N1cz1mdW5jdGlvbigpe2EoZG9jdW1lbnQpLm9mZigiZm9jdXNpbi5icy5tb2RhbCIpLm9uKCJmb2N1c2luLmJzLm1vZGFsIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMuJGVsZW1lbnRbMF09PT1hLnRhcmdldHx8dGhpcy4kZWxlbWVudC5oYXMoYS50YXJnZXQpLmxlbmd0aHx8dGhpcy4kZWxlbWVudC5mb2N1cygpfSx0aGlzKSl9LGIucHJvdG90eXBlLmVzY2FwZT1mdW5jdGlvbigpe3RoaXMuaXNTaG93biYmdGhpcy5vcHRpb25zLmtleWJvYXJkP3RoaXMuJGVsZW1lbnQub24oImtleXVwLmRpc21pc3MuYnMubW9kYWwiLGEucHJveHkoZnVuY3Rpb24oYSl7Mjc9PWEud2hpY2gmJnRoaXMuaGlkZSgpfSx0aGlzKSk6dGhpcy5pc1Nob3dufHx0aGlzLiRlbGVtZW50Lm9mZigia2V5dXAuZGlzbWlzcy5icy5tb2RhbCIpfSxiLnByb3RvdHlwZS5oaWRlTW9kYWw9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3RoaXMuJGVsZW1lbnQuaGlkZSgpLHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24oKXthLnJlbW92ZUJhY2tkcm9wKCksYS4kZWxlbWVudC50cmlnZ2VyKCJoaWRkZW4uYnMubW9kYWwiKX0pfSxiLnByb3RvdHlwZS5yZW1vdmVCYWNrZHJvcD1mdW5jdGlvbigpe3RoaXMuJGJhY2tkcm9wJiZ0aGlzLiRiYWNrZHJvcC5yZW1vdmUoKSx0aGlzLiRiYWNrZHJvcD1udWxsfSxiLnByb3RvdHlwZS5iYWNrZHJvcD1mdW5jdGlvbihiKXt2YXIgYz10aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik/ImZhZGUiOiIiO2lmKHRoaXMuaXNTaG93biYmdGhpcy5vcHRpb25zLmJhY2tkcm9wKXt2YXIgZD1hLnN1cHBvcnQudHJhbnNpdGlvbiYmYztpZih0aGlzLiRiYWNrZHJvcD1hKCc8ZGl2IGNsYXNzPSJtb2RhbC1iYWNrZHJvcCAnK2MrJyIgLz4nKS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KSx0aGlzLiRlbGVtZW50Lm9uKCJjbGljay5kaXNtaXNzLmJzLm1vZGFsIixhLnByb3h5KGZ1bmN0aW9uKGEpe2EudGFyZ2V0PT09YS5jdXJyZW50VGFyZ2V0JiYoInN0YXRpYyI9PXRoaXMub3B0aW9ucy5iYWNrZHJvcD90aGlzLiRlbGVtZW50WzBdLmZvY3VzLmNhbGwodGhpcy4kZWxlbWVudFswXSk6dGhpcy5oaWRlLmNhbGwodGhpcykpfSx0aGlzKSksZCYmdGhpcy4kYmFja2Ryb3BbMF0ub2Zmc2V0V2lkdGgsdGhpcy4kYmFja2Ryb3AuYWRkQ2xhc3MoImluIiksIWIpcmV0dXJuO2Q/dGhpcy4kYmFja2Ryb3Aub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxiKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmIoKX1lbHNlIXRoaXMuaXNTaG93biYmdGhpcy4kYmFja2Ryb3A/KHRoaXMuJGJhY2tkcm9wLnJlbW92ZUNsYXNzKCJpbiIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik/dGhpcy4kYmFja2Ryb3Aub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxiKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmIoKSk6YiYmYigpfTt2YXIgYz1hLmZuLm1vZGFsO2EuZm4ubW9kYWw9ZnVuY3Rpb24oYyxkKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGU9YSh0aGlzKSxmPWUuZGF0YSgiYnMubW9kYWwiKSxnPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZS5kYXRhKCksIm9iamVjdCI9PXR5cGVvZiBjJiZjKTtmfHxlLmRhdGEoImJzLm1vZGFsIixmPW5ldyBiKHRoaXMsZykpLCJzdHJpbmciPT10eXBlb2YgYz9mW2NdKGQpOmcuc2hvdyYmZi5zaG93KGQpfSl9LGEuZm4ubW9kYWwuQ29uc3RydWN0b3I9YixhLmZuLm1vZGFsLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5tb2RhbD1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5tb2RhbC5kYXRhLWFwaSIsJ1tkYXRhLXRvZ2dsZT0ibW9kYWwiXScsZnVuY3Rpb24oYil7dmFyIGM9YSh0aGlzKSxkPWMuYXR0cigiaHJlZiIpLGU9YShjLmF0dHIoImRhdGEtdGFyZ2V0Iil8fGQmJmQucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCIiKSksZj1lLmRhdGEoImJzLm1vZGFsIik/InRvZ2dsZSI6YS5leHRlbmQoe3JlbW90ZTohLyMvLnRlc3QoZCkmJmR9LGUuZGF0YSgpLGMuZGF0YSgpKTtjLmlzKCJhIikmJmIucHJldmVudERlZmF1bHQoKSxlLm1vZGFsKGYsdGhpcykub25lKCJoaWRlIixmdW5jdGlvbigpe2MuaXMoIjp2aXNpYmxlIikmJmMuZm9jdXMoKX0pfSksYShkb2N1bWVudCkub24oInNob3cuYnMubW9kYWwiLCIubW9kYWwiLGZ1bmN0aW9uKCl7YShkb2N1bWVudC5ib2R5KS5hZGRDbGFzcygibW9kYWwtb3BlbiIpfSkub24oImhpZGRlbi5icy5tb2RhbCIsIi5tb2RhbCIsZnVuY3Rpb24oKXthKGRvY3VtZW50LmJvZHkpLnJlbW92ZUNsYXNzKCJtb2RhbC1vcGVuIil9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYSxiKXt0aGlzLnR5cGU9dGhpcy5vcHRpb25zPXRoaXMuZW5hYmxlZD10aGlzLnRpbWVvdXQ9dGhpcy5ob3ZlclN0YXRlPXRoaXMuJGVsZW1lbnQ9bnVsbCx0aGlzLmluaXQoInRvb2x0aXAiLGEsYil9O2IuREVGQVVMVFM9e2FuaW1hdGlvbjohMCxwbGFjZW1lbnQ6InRvcCIsc2VsZWN0b3I6ITEsdGVtcGxhdGU6JzxkaXYgY2xhc3M9InRvb2x0aXAiPjxkaXYgY2xhc3M9InRvb2x0aXAtYXJyb3ciPjwvZGl2PjxkaXYgY2xhc3M9InRvb2x0aXAtaW5uZXIiPjwvZGl2PjwvZGl2PicsdHJpZ2dlcjoiaG92ZXIgZm9jdXMiLHRpdGxlOiIiLGRlbGF5OjAsaHRtbDohMSxjb250YWluZXI6ITF9LGIucHJvdG90eXBlLmluaXQ9ZnVuY3Rpb24oYixjLGQpe3RoaXMuZW5hYmxlZD0hMCx0aGlzLnR5cGU9Yix0aGlzLiRlbGVtZW50PWEoYyksdGhpcy5vcHRpb25zPXRoaXMuZ2V0T3B0aW9ucyhkKTtmb3IodmFyIGU9dGhpcy5vcHRpb25zLnRyaWdnZXIuc3BsaXQoIiAiKSxmPWUubGVuZ3RoO2YtLTspe3ZhciBnPWVbZl07aWYoImNsaWNrIj09Zyl0aGlzLiRlbGVtZW50Lm9uKCJjbGljay4iK3RoaXMudHlwZSx0aGlzLm9wdGlvbnMuc2VsZWN0b3IsYS5wcm94eSh0aGlzLnRvZ2dsZSx0aGlzKSk7ZWxzZSBpZigibWFudWFsIiE9Zyl7dmFyIGg9ImhvdmVyIj09Zz8ibW91c2VlbnRlciI6ImZvY3VzaW4iLGk9ImhvdmVyIj09Zz8ibW91c2VsZWF2ZSI6ImZvY3Vzb3V0Ijt0aGlzLiRlbGVtZW50Lm9uKGgrIi4iK3RoaXMudHlwZSx0aGlzLm9wdGlvbnMuc2VsZWN0b3IsYS5wcm94eSh0aGlzLmVudGVyLHRoaXMpKSx0aGlzLiRlbGVtZW50Lm9uKGkrIi4iK3RoaXMudHlwZSx0aGlzLm9wdGlvbnMuc2VsZWN0b3IsYS5wcm94eSh0aGlzLmxlYXZlLHRoaXMpKX19dGhpcy5vcHRpb25zLnNlbGVjdG9yP3RoaXMuX29wdGlvbnM9YS5leHRlbmQoe30sdGhpcy5vcHRpb25zLHt0cmlnZ2VyOiJtYW51YWwiLHNlbGVjdG9yOiIifSk6dGhpcy5maXhUaXRsZSgpfSxiLnByb3RvdHlwZS5nZXREZWZhdWx0cz1mdW5jdGlvbigpe3JldHVybiBiLkRFRkFVTFRTfSxiLnByb3RvdHlwZS5nZXRPcHRpb25zPWZ1bmN0aW9uKGIpe3JldHVybiBiPWEuZXh0ZW5kKHt9LHRoaXMuZ2V0RGVmYXVsdHMoKSx0aGlzLiRlbGVtZW50LmRhdGEoKSxiKSxiLmRlbGF5JiYibnVtYmVyIj09dHlwZW9mIGIuZGVsYXkmJihiLmRlbGF5PXtzaG93OmIuZGVsYXksaGlkZTpiLmRlbGF5fSksYn0sYi5wcm90b3R5cGUuZ2V0RGVsZWdhdGVPcHRpb25zPWZ1bmN0aW9uKCl7dmFyIGI9e30sYz10aGlzLmdldERlZmF1bHRzKCk7cmV0dXJuIHRoaXMuX29wdGlvbnMmJmEuZWFjaCh0aGlzLl9vcHRpb25zLGZ1bmN0aW9uKGEsZCl7Y1thXSE9ZCYmKGJbYV09ZCl9KSxifSxiLnByb3RvdHlwZS5lbnRlcj1mdW5jdGlvbihiKXt2YXIgYz1iIGluc3RhbmNlb2YgdGhpcy5jb25zdHJ1Y3Rvcj9iOmEoYi5jdXJyZW50VGFyZ2V0KVt0aGlzLnR5cGVdKHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpLmRhdGEoImJzLiIrdGhpcy50eXBlKTtyZXR1cm4gY2xlYXJUaW1lb3V0KGMudGltZW91dCksYy5ob3ZlclN0YXRlPSJpbiIsYy5vcHRpb25zLmRlbGF5JiZjLm9wdGlvbnMuZGVsYXkuc2hvdz92b2lkKGMudGltZW91dD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ImluIj09Yy5ob3ZlclN0YXRlJiZjLnNob3coKX0sYy5vcHRpb25zLmRlbGF5LnNob3cpKTpjLnNob3coKX0sYi5wcm90b3R5cGUubGVhdmU9ZnVuY3Rpb24oYil7dmFyIGM9YiBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3I/YjphKGIuY3VycmVudFRhcmdldClbdGhpcy50eXBlXSh0aGlzLmdldERlbGVnYXRlT3B0aW9ucygpKS5kYXRhKCJicy4iK3RoaXMudHlwZSk7cmV0dXJuIGNsZWFyVGltZW91dChjLnRpbWVvdXQpLGMuaG92ZXJTdGF0ZT0ib3V0IixjLm9wdGlvbnMuZGVsYXkmJmMub3B0aW9ucy5kZWxheS5oaWRlP3ZvaWQoYy50aW1lb3V0PXNldFRpbWVvdXQoZnVuY3Rpb24oKXsib3V0Ij09Yy5ob3ZlclN0YXRlJiZjLmhpZGUoKX0sYy5vcHRpb25zLmRlbGF5LmhpZGUpKTpjLmhpZGUoKX0sYi5wcm90b3R5cGUuc2hvdz1mdW5jdGlvbigpe3ZhciBiPWEuRXZlbnQoInNob3cuYnMuIit0aGlzLnR5cGUpO2lmKHRoaXMuaGFzQ29udGVudCgpJiZ0aGlzLmVuYWJsZWQpe2lmKHRoaXMuJGVsZW1lbnQudHJpZ2dlcihiKSxiLmlzRGVmYXVsdFByZXZlbnRlZCgpKXJldHVybjt2YXIgYz10aGlzLGQ9dGhpcy50aXAoKTt0aGlzLnNldENvbnRlbnQoKSx0aGlzLm9wdGlvbnMuYW5pbWF0aW9uJiZkLmFkZENsYXNzKCJmYWRlIik7dmFyIGU9ImZ1bmN0aW9uIj09dHlwZW9mIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQ/dGhpcy5vcHRpb25zLnBsYWNlbWVudC5jYWxsKHRoaXMsZFswXSx0aGlzLiRlbGVtZW50WzBdKTp0aGlzLm9wdGlvbnMucGxhY2VtZW50LGY9L1xzP2F1dG8/XHM/L2ksZz1mLnRlc3QoZSk7ZyYmKGU9ZS5yZXBsYWNlKGYsIiIpfHwidG9wIiksZC5kZXRhY2goKS5jc3Moe3RvcDowLGxlZnQ6MCxkaXNwbGF5OiJibG9jayJ9KS5hZGRDbGFzcyhlKSx0aGlzLm9wdGlvbnMuY29udGFpbmVyP2QuYXBwZW5kVG8odGhpcy5vcHRpb25zLmNvbnRhaW5lcik6ZC5pbnNlcnRBZnRlcih0aGlzLiRlbGVtZW50KTt2YXIgaD10aGlzLmdldFBvc2l0aW9uKCksaT1kWzBdLm9mZnNldFdpZHRoLGo9ZFswXS5vZmZzZXRIZWlnaHQ7aWYoZyl7dmFyIGs9dGhpcy4kZWxlbWVudC5wYXJlbnQoKSxsPWUsbT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wfHxkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCxuPSJib2R5Ij09dGhpcy5vcHRpb25zLmNvbnRhaW5lcj93aW5kb3cuaW5uZXJXaWR0aDprLm91dGVyV2lkdGgoKSxvPSJib2R5Ij09dGhpcy5vcHRpb25zLmNvbnRhaW5lcj93aW5kb3cuaW5uZXJIZWlnaHQ6ay5vdXRlckhlaWdodCgpLHA9ImJvZHkiPT10aGlzLm9wdGlvbnMuY29udGFpbmVyPzA6ay5vZmZzZXQoKS5sZWZ0O2U9ImJvdHRvbSI9PWUmJmgudG9wK2guaGVpZ2h0K2otbT5vPyJ0b3AiOiJ0b3AiPT1lJiZoLnRvcC1tLWo8MD8iYm90dG9tIjoicmlnaHQiPT1lJiZoLnJpZ2h0K2k+bj8ibGVmdCI6ImxlZnQiPT1lJiZoLmxlZnQtaTxwPyJyaWdodCI6ZSxkLnJlbW92ZUNsYXNzKGwpLmFkZENsYXNzKGUpfXZhciBxPXRoaXMuZ2V0Q2FsY3VsYXRlZE9mZnNldChlLGgsaSxqKTt0aGlzLmFwcGx5UGxhY2VtZW50KHEsZSksdGhpcy5ob3ZlclN0YXRlPW51bGw7dmFyIHI9ZnVuY3Rpb24oKXtjLiRlbGVtZW50LnRyaWdnZXIoInNob3duLmJzLiIrYy50eXBlKX07YS5zdXBwb3J0LnRyYW5zaXRpb24mJnRoaXMuJHRpcC5oYXNDbGFzcygiZmFkZSIpP2Qub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxyKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOnIoKX19LGIucHJvdG90eXBlLmFwcGx5UGxhY2VtZW50PWZ1bmN0aW9uKGIsYyl7dmFyIGQsZT10aGlzLnRpcCgpLGY9ZVswXS5vZmZzZXRXaWR0aCxnPWVbMF0ub2Zmc2V0SGVpZ2h0LGg9cGFyc2VJbnQoZS5jc3MoIm1hcmdpbi10b3AiKSwxMCksaT1wYXJzZUludChlLmNzcygibWFyZ2luLWxlZnQiKSwxMCk7aXNOYU4oaCkmJihoPTApLGlzTmFOKGkpJiYoaT0wKSxiLnRvcD1iLnRvcCtoLGIubGVmdD1iLmxlZnQraSxhLm9mZnNldC5zZXRPZmZzZXQoZVswXSxhLmV4dGVuZCh7dXNpbmc6ZnVuY3Rpb24oYSl7ZS5jc3Moe3RvcDpNYXRoLnJvdW5kKGEudG9wKSxsZWZ0Ok1hdGgucm91bmQoYS5sZWZ0KX0pfX0sYiksMCksZS5hZGRDbGFzcygiaW4iKTt2YXIgaj1lWzBdLm9mZnNldFdpZHRoLGs9ZVswXS5vZmZzZXRIZWlnaHQ7aWYoInRvcCI9PWMmJmshPWcmJihkPSEwLGIudG9wPWIudG9wK2ctayksL2JvdHRvbXx0b3AvLnRlc3QoYykpe3ZhciBsPTA7Yi5sZWZ0PDAmJihsPS0yKmIubGVmdCxiLmxlZnQ9MCxlLm9mZnNldChiKSxqPWVbMF0ub2Zmc2V0V2lkdGgsaz1lWzBdLm9mZnNldEhlaWdodCksdGhpcy5yZXBsYWNlQXJyb3cobC1mK2osaiwibGVmdCIpfWVsc2UgdGhpcy5yZXBsYWNlQXJyb3coay1nLGssInRvcCIpO2QmJmUub2Zmc2V0KGIpfSxiLnByb3RvdHlwZS5yZXBsYWNlQXJyb3c9ZnVuY3Rpb24oYSxiLGMpe3RoaXMuYXJyb3coKS5jc3MoYyxhPzUwKigxLWEvYikrIiUiOiIiKX0sYi5wcm90b3R5cGUuc2V0Q29udGVudD1mdW5jdGlvbigpe3ZhciBhPXRoaXMudGlwKCksYj10aGlzLmdldFRpdGxlKCk7YS5maW5kKCIudG9vbHRpcC1pbm5lciIpW3RoaXMub3B0aW9ucy5odG1sPyJodG1sIjoidGV4dCJdKGIpLGEucmVtb3ZlQ2xhc3MoImZhZGUgaW4gdG9wIGJvdHRvbSBsZWZ0IHJpZ2h0Iil9LGIucHJvdG90eXBlLmhpZGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBiKCl7ImluIiE9Yy5ob3ZlclN0YXRlJiZkLmRldGFjaCgpLGMuJGVsZW1lbnQudHJpZ2dlcigiaGlkZGVuLmJzLiIrYy50eXBlKX12YXIgYz10aGlzLGQ9dGhpcy50aXAoKSxlPWEuRXZlbnQoImhpZGUuYnMuIit0aGlzLnR5cGUpO3JldHVybiB0aGlzLiRlbGVtZW50LnRyaWdnZXIoZSksZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKT92b2lkIDA6KGQucmVtb3ZlQ2xhc3MoImluIiksYS5zdXBwb3J0LnRyYW5zaXRpb24mJnRoaXMuJHRpcC5oYXNDbGFzcygiZmFkZSIpP2Qub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxiKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmIoKSx0aGlzLmhvdmVyU3RhdGU9bnVsbCx0aGlzKX0sYi5wcm90b3R5cGUuZml4VGl0bGU9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLiRlbGVtZW50OyhhLmF0dHIoInRpdGxlIil8fCJzdHJpbmciIT10eXBlb2YgYS5hdHRyKCJkYXRhLW9yaWdpbmFsLXRpdGxlIikpJiZhLmF0dHIoImRhdGEtb3JpZ2luYWwtdGl0bGUiLGEuYXR0cigidGl0bGUiKXx8IiIpLmF0dHIoInRpdGxlIiwiIil9LGIucHJvdG90eXBlLmhhc0NvbnRlbnQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaXRsZSgpfSxiLnByb3RvdHlwZS5nZXRQb3NpdGlvbj1mdW5jdGlvbigpe3ZhciBiPXRoaXMuJGVsZW1lbnRbMF07cmV0dXJuIGEuZXh0ZW5kKHt9LCJmdW5jdGlvbiI9PXR5cGVvZiBiLmdldEJvdW5kaW5nQ2xpZW50UmVjdD9iLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOnt3aWR0aDpiLm9mZnNldFdpZHRoLGhlaWdodDpiLm9mZnNldEhlaWdodH0sdGhpcy4kZWxlbWVudC5vZmZzZXQoKSl9LGIucHJvdG90eXBlLmdldENhbGN1bGF0ZWRPZmZzZXQ9ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuImJvdHRvbSI9PWE/e3RvcDpiLnRvcCtiLmhlaWdodCxsZWZ0OmIubGVmdCtiLndpZHRoLzItYy8yfToidG9wIj09YT97dG9wOmIudG9wLWQsbGVmdDpiLmxlZnQrYi53aWR0aC8yLWMvMn06ImxlZnQiPT1hP3t0b3A6Yi50b3ArYi5oZWlnaHQvMi1kLzIsbGVmdDpiLmxlZnQtY306e3RvcDpiLnRvcCtiLmhlaWdodC8yLWQvMixsZWZ0OmIubGVmdCtiLndpZHRofX0sYi5wcm90b3R5cGUuZ2V0VGl0bGU9ZnVuY3Rpb24oKXt2YXIgYSxiPXRoaXMuJGVsZW1lbnQsYz10aGlzLm9wdGlvbnM7cmV0dXJuIGE9Yi5hdHRyKCJkYXRhLW9yaWdpbmFsLXRpdGxlIil8fCgiZnVuY3Rpb24iPT10eXBlb2YgYy50aXRsZT9jLnRpdGxlLmNhbGwoYlswXSk6Yy50aXRsZSl9LGIucHJvdG90eXBlLnRpcD1mdW5jdGlvbigpe3JldHVybiB0aGlzLiR0aXA9dGhpcy4kdGlwfHxhKHRoaXMub3B0aW9ucy50ZW1wbGF0ZSl9LGIucHJvdG90eXBlLmFycm93PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJGFycm93PXRoaXMuJGFycm93fHx0aGlzLnRpcCgpLmZpbmQoIi50b29sdGlwLWFycm93Iil9LGIucHJvdG90eXBlLnZhbGlkYXRlPWZ1bmN0aW9uKCl7dGhpcy4kZWxlbWVudFswXS5wYXJlbnROb2RlfHwodGhpcy5oaWRlKCksdGhpcy4kZWxlbWVudD1udWxsLHRoaXMub3B0aW9ucz1udWxsKX0sYi5wcm90b3R5cGUuZW5hYmxlPWZ1bmN0aW9uKCl7dGhpcy5lbmFibGVkPSEwfSxiLnByb3RvdHlwZS5kaXNhYmxlPWZ1bmN0aW9uKCl7dGhpcy5lbmFibGVkPSExfSxiLnByb3RvdHlwZS50b2dnbGVFbmFibGVkPWZ1bmN0aW9uKCl7dGhpcy5lbmFibGVkPSF0aGlzLmVuYWJsZWR9LGIucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbihiKXt2YXIgYz1iP2EoYi5jdXJyZW50VGFyZ2V0KVt0aGlzLnR5cGVdKHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpLmRhdGEoImJzLiIrdGhpcy50eXBlKTp0aGlzO2MudGlwKCkuaGFzQ2xhc3MoImluIik/Yy5sZWF2ZShjKTpjLmVudGVyKGMpfSxiLnByb3RvdHlwZS5kZXN0cm95PWZ1bmN0aW9uKCl7Y2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCksdGhpcy5oaWRlKCkuJGVsZW1lbnQub2ZmKCIuIit0aGlzLnR5cGUpLnJlbW92ZURhdGEoImJzLiIrdGhpcy50eXBlKX07dmFyIGM9YS5mbi50b29sdGlwO2EuZm4udG9vbHRpcD1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMudG9vbHRpcCIpLGY9Im9iamVjdCI9PXR5cGVvZiBjJiZjOyhlfHwiZGVzdHJveSIhPWMpJiYoZXx8ZC5kYXRhKCJicy50b29sdGlwIixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpKX0pfSxhLmZuLnRvb2x0aXAuQ29uc3RydWN0b3I9YixhLmZuLnRvb2x0aXAubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLnRvb2x0aXA9Yyx0aGlzfX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYSxiKXt0aGlzLmluaXQoInBvcG92ZXIiLGEsYil9O2lmKCFhLmZuLnRvb2x0aXApdGhyb3cgbmV3IEVycm9yKCJQb3BvdmVyIHJlcXVpcmVzIHRvb2x0aXAuanMiKTtiLkRFRkFVTFRTPWEuZXh0ZW5kKHt9LGEuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvci5ERUZBVUxUUyx7cGxhY2VtZW50OiJyaWdodCIsdHJpZ2dlcjoiY2xpY2siLGNvbnRlbnQ6IiIsdGVtcGxhdGU6JzxkaXYgY2xhc3M9InBvcG92ZXIiPjxkaXYgY2xhc3M9ImFycm93Ij48L2Rpdj48aDMgY2xhc3M9InBvcG92ZXItdGl0bGUiPjwvaDM+PGRpdiBjbGFzcz0icG9wb3Zlci1jb250ZW50Ij48L2Rpdj48L2Rpdj4nfSksYi5wcm90b3R5cGU9YS5leHRlbmQoe30sYS5mbi50b29sdGlwLkNvbnN0cnVjdG9yLnByb3RvdHlwZSksYi5wcm90b3R5cGUuY29uc3RydWN0b3I9YixiLnByb3RvdHlwZS5nZXREZWZhdWx0cz1mdW5jdGlvbigpe3JldHVybiBiLkRFRkFVTFRTfSxiLnByb3RvdHlwZS5zZXRDb250ZW50PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy50aXAoKSxiPXRoaXMuZ2V0VGl0bGUoKSxjPXRoaXMuZ2V0Q29udGVudCgpO2EuZmluZCgiLnBvcG92ZXItdGl0bGUiKVt0aGlzLm9wdGlvbnMuaHRtbD8iaHRtbCI6InRleHQiXShiKSxhLmZpbmQoIi5wb3BvdmVyLWNvbnRlbnQiKVt0aGlzLm9wdGlvbnMuaHRtbD8ic3RyaW5nIj09dHlwZW9mIGM/Imh0bWwiOiJhcHBlbmQiOiJ0ZXh0Il0oYyksYS5yZW1vdmVDbGFzcygiZmFkZSB0b3AgYm90dG9tIGxlZnQgcmlnaHQgaW4iKSxhLmZpbmQoIi5wb3BvdmVyLXRpdGxlIikuaHRtbCgpfHxhLmZpbmQoIi5wb3BvdmVyLXRpdGxlIikuaGlkZSgpfSxiLnByb3RvdHlwZS5oYXNDb250ZW50PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0VGl0bGUoKXx8dGhpcy5nZXRDb250ZW50KCl9LGIucHJvdG90eXBlLmdldENvbnRlbnQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLiRlbGVtZW50LGI9dGhpcy5vcHRpb25zO3JldHVybiBhLmF0dHIoImRhdGEtY29udGVudCIpfHwoImZ1bmN0aW9uIj09dHlwZW9mIGIuY29udGVudD9iLmNvbnRlbnQuY2FsbChhWzBdKTpiLmNvbnRlbnQpfSxiLnByb3RvdHlwZS5hcnJvdz1mdW5jdGlvbigpe3JldHVybiB0aGlzLiRhcnJvdz10aGlzLiRhcnJvd3x8dGhpcy50aXAoKS5maW5kKCIuYXJyb3ciKX0sYi5wcm90b3R5cGUudGlwPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJHRpcHx8KHRoaXMuJHRpcD1hKHRoaXMub3B0aW9ucy50ZW1wbGF0ZSkpLHRoaXMuJHRpcH07dmFyIGM9YS5mbi5wb3BvdmVyO2EuZm4ucG9wb3Zlcj1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMucG9wb3ZlciIpLGY9Im9iamVjdCI9PXR5cGVvZiBjJiZjOyhlfHwiZGVzdHJveSIhPWMpJiYoZXx8ZC5kYXRhKCJicy5wb3BvdmVyIixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpKX0pfSxhLmZuLnBvcG92ZXIuQ29uc3RydWN0b3I9YixhLmZuLnBvcG92ZXIubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLnBvcG92ZXI9Yyx0aGlzfX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihjLGQpe3ZhciBlLGY9YS5wcm94eSh0aGlzLnByb2Nlc3MsdGhpcyk7dGhpcy4kZWxlbWVudD1hKGEoYykuaXMoImJvZHkiKT93aW5kb3c6YyksdGhpcy4kYm9keT1hKCJib2R5IiksdGhpcy4kc2Nyb2xsRWxlbWVudD10aGlzLiRlbGVtZW50Lm9uKCJzY3JvbGwuYnMuc2Nyb2xsLXNweS5kYXRhLWFwaSIsZiksdGhpcy5vcHRpb25zPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZCksdGhpcy5zZWxlY3Rvcj0odGhpcy5vcHRpb25zLnRhcmdldHx8KGU9YShjKS5hdHRyKCJocmVmIikpJiZlLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIil8fCIiKSsiIC5uYXYgbGkgPiBhIix0aGlzLm9mZnNldHM9YShbXSksdGhpcy50YXJnZXRzPWEoW10pLHRoaXMuYWN0aXZlVGFyZ2V0PW51bGwsdGhpcy5yZWZyZXNoKCksdGhpcy5wcm9jZXNzKCl9Yi5ERUZBVUxUUz17b2Zmc2V0OjEwfSxiLnByb3RvdHlwZS5yZWZyZXNoPWZ1bmN0aW9uKCl7dmFyIGI9dGhpcy4kZWxlbWVudFswXT09d2luZG93PyJvZmZzZXQiOiJwb3NpdGlvbiI7dGhpcy5vZmZzZXRzPWEoW10pLHRoaXMudGFyZ2V0cz1hKFtdKTt7dmFyIGM9dGhpczt0aGlzLiRib2R5LmZpbmQodGhpcy5zZWxlY3RvcikubWFwKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgidGFyZ2V0Iil8fGQuYXR0cigiaHJlZiIpLGY9L14jLi8udGVzdChlKSYmYShlKTtyZXR1cm4gZiYmZi5sZW5ndGgmJmYuaXMoIjp2aXNpYmxlIikmJltbZltiXSgpLnRvcCsoIWEuaXNXaW5kb3coYy4kc2Nyb2xsRWxlbWVudC5nZXQoMCkpJiZjLiRzY3JvbGxFbGVtZW50LnNjcm9sbFRvcCgpKSxlXV18fG51bGx9KS5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIGFbMF0tYlswXX0pLmVhY2goZnVuY3Rpb24oKXtjLm9mZnNldHMucHVzaCh0aGlzWzBdKSxjLnRhcmdldHMucHVzaCh0aGlzWzFdKX0pfX0sYi5wcm90b3R5cGUucHJvY2Vzcz1mdW5jdGlvbigpe3ZhciBhLGI9dGhpcy4kc2Nyb2xsRWxlbWVudC5zY3JvbGxUb3AoKSt0aGlzLm9wdGlvbnMub2Zmc2V0LGM9dGhpcy4kc2Nyb2xsRWxlbWVudFswXS5zY3JvbGxIZWlnaHR8fHRoaXMuJGJvZHlbMF0uc2Nyb2xsSGVpZ2h0LGQ9Yy10aGlzLiRzY3JvbGxFbGVtZW50LmhlaWdodCgpLGU9dGhpcy5vZmZzZXRzLGY9dGhpcy50YXJnZXRzLGc9dGhpcy5hY3RpdmVUYXJnZXQ7aWYoYj49ZClyZXR1cm4gZyE9KGE9Zi5sYXN0KClbMF0pJiZ0aGlzLmFjdGl2YXRlKGEpO2lmKGcmJmI8PWVbMF0pcmV0dXJuIGchPShhPWZbMF0pJiZ0aGlzLmFjdGl2YXRlKGEpO2ZvcihhPWUubGVuZ3RoO2EtLTspZyE9ZlthXSYmYj49ZVthXSYmKCFlW2ErMV18fGI8PWVbYSsxXSkmJnRoaXMuYWN0aXZhdGUoZlthXSl9LGIucHJvdG90eXBlLmFjdGl2YXRlPWZ1bmN0aW9uKGIpe3RoaXMuYWN0aXZlVGFyZ2V0PWIsYSh0aGlzLnNlbGVjdG9yKS5wYXJlbnRzVW50aWwodGhpcy5vcHRpb25zLnRhcmdldCwiLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKTt2YXIgYz10aGlzLnNlbGVjdG9yKydbZGF0YS10YXJnZXQ9IicrYisnIl0sJyt0aGlzLnNlbGVjdG9yKydbaHJlZj0iJytiKyciXScsZD1hKGMpLnBhcmVudHMoImxpIikuYWRkQ2xhc3MoImFjdGl2ZSIpO2QucGFyZW50KCIuZHJvcGRvd24tbWVudSIpLmxlbmd0aCYmKGQ9ZC5jbG9zZXN0KCJsaS5kcm9wZG93biIpLmFkZENsYXNzKCJhY3RpdmUiKSksZC50cmlnZ2VyKCJhY3RpdmF0ZS5icy5zY3JvbGxzcHkiKX07dmFyIGM9YS5mbi5zY3JvbGxzcHk7YS5mbi5zY3JvbGxzcHk9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLnNjcm9sbHNweSIpLGY9Im9iamVjdCI9PXR5cGVvZiBjJiZjO2V8fGQuZGF0YSgiYnMuc2Nyb2xsc3B5IixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4uc2Nyb2xsc3B5LkNvbnN0cnVjdG9yPWIsYS5mbi5zY3JvbGxzcHkubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLnNjcm9sbHNweT1jLHRoaXN9LGEod2luZG93KS5vbigibG9hZCIsZnVuY3Rpb24oKXthKCdbZGF0YS1zcHk9InNjcm9sbCJdJykuZWFjaChmdW5jdGlvbigpe3ZhciBiPWEodGhpcyk7Yi5zY3JvbGxzcHkoYi5kYXRhKCkpfSl9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYil7dGhpcy5lbGVtZW50PWEoYil9O2IucHJvdG90eXBlLnNob3c9ZnVuY3Rpb24oKXt2YXIgYj10aGlzLmVsZW1lbnQsYz1iLmNsb3Nlc3QoInVsOm5vdCguZHJvcGRvd24tbWVudSkiKSxkPWIuZGF0YSgidGFyZ2V0Iik7aWYoZHx8KGQ9Yi5hdHRyKCJocmVmIiksZD1kJiZkLnJlcGxhY2UoLy4qKD89I1teXHNdKiQpLywiIikpLCFiLnBhcmVudCgibGkiKS5oYXNDbGFzcygiYWN0aXZlIikpe3ZhciBlPWMuZmluZCgiLmFjdGl2ZTpsYXN0IGEiKVswXSxmPWEuRXZlbnQoInNob3cuYnMudGFiIix7cmVsYXRlZFRhcmdldDplfSk7aWYoYi50cmlnZ2VyKGYpLCFmLmlzRGVmYXVsdFByZXZlbnRlZCgpKXt2YXIgZz1hKGQpO3RoaXMuYWN0aXZhdGUoYi5wYXJlbnQoImxpIiksYyksdGhpcy5hY3RpdmF0ZShnLGcucGFyZW50KCksZnVuY3Rpb24oKXtiLnRyaWdnZXIoe3R5cGU6InNob3duLmJzLnRhYiIscmVsYXRlZFRhcmdldDplfSl9KX19fSxiLnByb3RvdHlwZS5hY3RpdmF0ZT1mdW5jdGlvbihiLGMsZCl7ZnVuY3Rpb24gZSgpe2YucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpLmZpbmQoIj4gLmRyb3Bkb3duLW1lbnUgPiAuYWN0aXZlIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpLGIuYWRkQ2xhc3MoImFjdGl2ZSIpLGc/KGJbMF0ub2Zmc2V0V2lkdGgsYi5hZGRDbGFzcygiaW4iKSk6Yi5yZW1vdmVDbGFzcygiZmFkZSIpLGIucGFyZW50KCIuZHJvcGRvd24tbWVudSIpJiZiLmNsb3Nlc3QoImxpLmRyb3Bkb3duIikuYWRkQ2xhc3MoImFjdGl2ZSIpLGQmJmQoKX12YXIgZj1jLmZpbmQoIj4gLmFjdGl2ZSIpLGc9ZCYmYS5zdXBwb3J0LnRyYW5zaXRpb24mJmYuaGFzQ2xhc3MoImZhZGUiKTtnP2Yub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxlKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmUoKSxmLnJlbW92ZUNsYXNzKCJpbiIpfTt2YXIgYz1hLmZuLnRhYjthLmZuLnRhYj1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMudGFiIik7ZXx8ZC5kYXRhKCJicy50YWIiLGU9bmV3IGIodGhpcykpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4udGFiLkNvbnN0cnVjdG9yPWIsYS5mbi50YWIubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLnRhYj1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy50YWIuZGF0YS1hcGkiLCdbZGF0YS10b2dnbGU9InRhYiJdLCBbZGF0YS10b2dnbGU9InBpbGwiXScsZnVuY3Rpb24oYil7Yi5wcmV2ZW50RGVmYXVsdCgpLGEodGhpcykudGFiKCJzaG93Iil9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYyxkKXt0aGlzLm9wdGlvbnM9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkKSx0aGlzLiR3aW5kb3c9YSh3aW5kb3cpLm9uKCJzY3JvbGwuYnMuYWZmaXguZGF0YS1hcGkiLGEucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uLHRoaXMpKS5vbigiY2xpY2suYnMuYWZmaXguZGF0YS1hcGkiLGEucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uV2l0aEV2ZW50TG9vcCx0aGlzKSksdGhpcy4kZWxlbWVudD1hKGMpLHRoaXMuYWZmaXhlZD10aGlzLnVucGluPXRoaXMucGlubmVkT2Zmc2V0PW51bGwsdGhpcy5jaGVja1Bvc2l0aW9uKCl9O2IuUkVTRVQ9ImFmZml4IGFmZml4LXRvcCBhZmZpeC1ib3R0b20iLGIuREVGQVVMVFM9e29mZnNldDowfSxiLnByb3RvdHlwZS5nZXRQaW5uZWRPZmZzZXQ9ZnVuY3Rpb24oKXtpZih0aGlzLnBpbm5lZE9mZnNldClyZXR1cm4gdGhpcy5waW5uZWRPZmZzZXQ7dGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcyhiLlJFU0VUKS5hZGRDbGFzcygiYWZmaXgiKTt2YXIgYT10aGlzLiR3aW5kb3cuc2Nyb2xsVG9wKCksYz10aGlzLiRlbGVtZW50Lm9mZnNldCgpO3JldHVybiB0aGlzLnBpbm5lZE9mZnNldD1jLnRvcC1hfSxiLnByb3RvdHlwZS5jaGVja1Bvc2l0aW9uV2l0aEV2ZW50TG9vcD1mdW5jdGlvbigpe3NldFRpbWVvdXQoYS5wcm94eSh0aGlzLmNoZWNrUG9zaXRpb24sdGhpcyksMSl9LGIucHJvdG90eXBlLmNoZWNrUG9zaXRpb249ZnVuY3Rpb24oKXtpZih0aGlzLiRlbGVtZW50LmlzKCI6dmlzaWJsZSIpKXt2YXIgYz1hKGRvY3VtZW50KS5oZWlnaHQoKSxkPXRoaXMuJHdpbmRvdy5zY3JvbGxUb3AoKSxlPXRoaXMuJGVsZW1lbnQub2Zmc2V0KCksZj10aGlzLm9wdGlvbnMub2Zmc2V0LGc9Zi50b3AsaD1mLmJvdHRvbTsidG9wIj09dGhpcy5hZmZpeGVkJiYoZS50b3ArPWQpLCJvYmplY3QiIT10eXBlb2YgZiYmKGg9Zz1mKSwiZnVuY3Rpb24iPT10eXBlb2YgZyYmKGc9Zi50b3AodGhpcy4kZWxlbWVudCkpLCJmdW5jdGlvbiI9PXR5cGVvZiBoJiYoaD1mLmJvdHRvbSh0aGlzLiRlbGVtZW50KSk7dmFyIGk9bnVsbCE9dGhpcy51bnBpbiYmZCt0aGlzLnVucGluPD1lLnRvcD8hMTpudWxsIT1oJiZlLnRvcCt0aGlzLiRlbGVtZW50LmhlaWdodCgpPj1jLWg/ImJvdHRvbSI6bnVsbCE9ZyYmZz49ZD8idG9wIjohMTtpZih0aGlzLmFmZml4ZWQhPT1pKXt0aGlzLnVucGluJiZ0aGlzLiRlbGVtZW50LmNzcygidG9wIiwiIik7dmFyIGo9ImFmZml4IisoaT8iLSIraToiIiksaz1hLkV2ZW50KGorIi5icy5hZmZpeCIpO3RoaXMuJGVsZW1lbnQudHJpZ2dlcihrKSxrLmlzRGVmYXVsdFByZXZlbnRlZCgpfHwodGhpcy5hZmZpeGVkPWksdGhpcy51bnBpbj0iYm90dG9tIj09aT90aGlzLmdldFBpbm5lZE9mZnNldCgpOm51bGwsdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcyhiLlJFU0VUKS5hZGRDbGFzcyhqKS50cmlnZ2VyKGEuRXZlbnQoai5yZXBsYWNlKCJhZmZpeCIsImFmZml4ZWQiKSkpLCJib3R0b20iPT1pJiZ0aGlzLiRlbGVtZW50Lm9mZnNldCh7dG9wOmMtaC10aGlzLiRlbGVtZW50LmhlaWdodCgpfSkpfX19O3ZhciBjPWEuZm4uYWZmaXg7YS5mbi5hZmZpeD1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMuYWZmaXgiKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYztlfHxkLmRhdGEoImJzLmFmZml4IixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4uYWZmaXguQ29uc3RydWN0b3I9YixhLmZuLmFmZml4Lm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5hZmZpeD1jLHRoaXN9LGEod2luZG93KS5vbigibG9hZCIsZnVuY3Rpb24oKXthKCdbZGF0YS1zcHk9ImFmZml4Il0nKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKSxjPWIuZGF0YSgpO2Mub2Zmc2V0PWMub2Zmc2V0fHx7fSxjLm9mZnNldEJvdHRvbSYmKGMub2Zmc2V0LmJvdHRvbT1jLm9mZnNldEJvdHRvbSksYy5vZmZzZXRUb3AmJihjLm9mZnNldC50b3A9Yy5vZmZzZXRUb3ApLGIuYWZmaXgoYyl9KX0pfShqUXVlcnkpOwpkZWZpbmUoImJvb3RzdHJhcCIsIFsianF1ZXJ5Il0sIChmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBnbG9iYWwuYm9vdHN0cmFwOwogICAgfQp9KHRoaXMpKSk7CgovKiEKICogdHlwZWFoZWFkLmpzIDAuMTAuMgogKiBodHRwczovL2dpdGh1Yi5jb20vdHdpdHRlci90eXBlYWhlYWQuanMKICogQ29weXJpZ2h0IDIwMTMtMjAxNCBUd2l0dGVyLCBJbmMuIGFuZCBvdGhlciBjb250cmlidXRvcnM7IExpY2Vuc2VkIE1JVAogKi8KCihmdW5jdGlvbigkKSB7CiAgICB2YXIgXyA9IHsKICAgICAgICBpc01zaWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gLyhtc2llfHRyaWRlbnQpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSA/IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLyhtc2llIHxydjopKFxkKyguXGQrKT8pL2kpWzJdIDogZmFsc2U7CiAgICAgICAgfSwKICAgICAgICBpc0JsYW5rU3RyaW5nOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgcmV0dXJuICFzdHIgfHwgL15ccyokLy50ZXN0KHN0cik7CiAgICAgICAgfSwKICAgICAgICBlc2NhcGVSZWdFeENoYXJzOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bXC1cW1xdXC9ce1x9XChcKVwqXCtcP1wuXFxcXlwkXHxdL2csICJcXCQmIik7CiAgICAgICAgfSwKICAgICAgICBpc1N0cmluZzogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAic3RyaW5nIjsKICAgICAgICB9LAogICAgICAgIGlzTnVtYmVyOiBmdW5jdGlvbihvYmopIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJudW1iZXIiOwogICAgICAgIH0sCiAgICAgICAgaXNBcnJheTogJC5pc0FycmF5LAogICAgICAgIGlzRnVuY3Rpb246ICQuaXNGdW5jdGlvbiwKICAgICAgICBpc09iamVjdDogJC5pc1BsYWluT2JqZWN0LAogICAgICAgIGlzVW5kZWZpbmVkOiBmdW5jdGlvbihvYmopIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJ1bmRlZmluZWQiOwogICAgICAgIH0sCiAgICAgICAgYmluZDogJC5wcm94eSwKICAgICAgICBlYWNoOiBmdW5jdGlvbihjb2xsZWN0aW9uLCBjYikgewogICAgICAgICAgICAkLmVhY2goY29sbGVjdGlvbiwgcmV2ZXJzZUFyZ3MpOwogICAgICAgICAgICBmdW5jdGlvbiByZXZlcnNlQXJncyhpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYih2YWx1ZSwgaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBtYXA6ICQubWFwLAogICAgICAgIGZpbHRlcjogJC5ncmVwLAogICAgICAgIGV2ZXJ5OiBmdW5jdGlvbihvYmosIHRlc3QpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICAgICAgICAgIGlmICghb2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uKGtleSwgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoIShyZXN1bHQgPSB0ZXN0LmNhbGwobnVsbCwgdmFsLCBrZXksIG9iaikpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuICEhcmVzdWx0OwogICAgICAgIH0sCiAgICAgICAgc29tZTogZnVuY3Rpb24ob2JqLCB0ZXN0KSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKCFvYmopIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJC5lYWNoKG9iaiwgZnVuY3Rpb24oa2V5LCB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPSB0ZXN0LmNhbGwobnVsbCwgdmFsLCBrZXksIG9iaikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gISFyZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICBtaXhpbjogJC5leHRlbmQsCiAgICAgICAgZ2V0VW5pcXVlSWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgY291bnRlciA9IDA7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjb3VudGVyKys7CiAgICAgICAgICAgIH07CiAgICAgICAgfSgpLAogICAgICAgIHRlbXBsYXRpZnk6IGZ1bmN0aW9uIHRlbXBsYXRpZnkob2JqKSB7CiAgICAgICAgICAgIHJldHVybiAkLmlzRnVuY3Rpb24ob2JqKSA/IG9iaiA6IHRlbXBsYXRlOwogICAgICAgICAgICBmdW5jdGlvbiB0ZW1wbGF0ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcob2JqKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGVmZXI6IGZ1bmN0aW9uKGZuKSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZm4sIDApOwogICAgICAgIH0sCiAgICAgICAgZGVib3VuY2U6IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgICAgICAgICB2YXIgdGltZW91dCwgcmVzdWx0OwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHMsIGxhdGVyLCBjYWxsTm93OwogICAgICAgICAgICAgICAgbGF0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoIWltbWVkaWF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0OwogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpOwogICAgICAgICAgICAgICAgaWYgKGNhbGxOb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIHRocm90dGxlOiBmdW5jdGlvbihmdW5jLCB3YWl0KSB7CiAgICAgICAgICAgIHZhciBjb250ZXh0LCBhcmdzLCB0aW1lb3V0LCByZXN1bHQsIHByZXZpb3VzLCBsYXRlcjsKICAgICAgICAgICAgcHJldmlvdXMgPSAwOwogICAgICAgICAgICBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcHJldmlvdXMgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKSwgcmVtYWluaW5nID0gd2FpdCAtIChub3cgLSBwcmV2aW91cyk7CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gdGhpczsKICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXMgPSBub3c7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQpIHsKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBub29wOiBmdW5jdGlvbigpIHt9CiAgICB9OwogICAgdmFyIGh0bWwgPSB7CiAgICAgICAgd3JhcHBlcjogJzxzcGFuIGNsYXNzPSJ0d2l0dGVyLXR5cGVhaGVhZCI+PC9zcGFuPicsCiAgICAgICAgZHJvcGRvd246ICc8c3BhbiBjbGFzcz0idHQtZHJvcGRvd24tbWVudSI+PC9zcGFuPicsCiAgICAgICAgZGF0YXNldDogJzxkaXYgY2xhc3M9InR0LWRhdGFzZXQtJUNMQVNTJSI+PC9kaXY+JywKICAgICAgICBzdWdnZXN0aW9uczogJzxzcGFuIGNsYXNzPSJ0dC1zdWdnZXN0aW9ucyI+PC9zcGFuPicsCiAgICAgICAgc3VnZ2VzdGlvbjogJzxkaXYgY2xhc3M9InR0LXN1Z2dlc3Rpb24iPjwvZGl2PicKICAgIH07CiAgICB2YXIgY3NzID0gewogICAgICAgIHdyYXBwZXI6IHsKICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUtYmxvY2siCiAgICAgICAgfSwKICAgICAgICBoaW50OiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICB0b3A6ICIwIiwKICAgICAgICAgICAgbGVmdDogIjAiLAogICAgICAgICAgICBib3JkZXJDb2xvcjogInRyYW5zcGFyZW50IiwKICAgICAgICAgICAgYm94U2hhZG93OiAibm9uZSIKICAgICAgICB9LAogICAgICAgIGlucHV0OiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAidG9wIiwKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAidHJhbnNwYXJlbnQiCiAgICAgICAgfSwKICAgICAgICBpbnB1dFdpdGhOb0hpbnQ6IHsKICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICJ0b3AiCiAgICAgICAgfSwKICAgICAgICBkcm9wZG93bjogewogICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgdG9wOiAiMTAwJSIsCiAgICAgICAgICAgIGxlZnQ6ICIwIiwKICAgICAgICAgICAgekluZGV4OiAiMTAwIiwKICAgICAgICAgICAgZGlzcGxheTogIm5vbmUiCiAgICAgICAgfSwKICAgICAgICBzdWdnZXN0aW9uczogewogICAgICAgICAgICBkaXNwbGF5OiAiYmxvY2siCiAgICAgICAgfSwKICAgICAgICBzdWdnZXN0aW9uOiB7CiAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJub3dyYXAiLAogICAgICAgICAgICBjdXJzb3I6ICJwb2ludGVyIgogICAgICAgIH0sCiAgICAgICAgc3VnZ2VzdGlvbkNoaWxkOiB7CiAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJub3JtYWwiCiAgICAgICAgfSwKICAgICAgICBsdHI6IHsKICAgICAgICAgICAgbGVmdDogIjAiLAogICAgICAgICAgICByaWdodDogImF1dG8iCiAgICAgICAgfSwKICAgICAgICBydGw6IHsKICAgICAgICAgICAgbGVmdDogImF1dG8iLAogICAgICAgICAgICByaWdodDogIiAwIgogICAgICAgIH0KICAgIH07CiAgICBpZiAoXy5pc01zaWUoKSkgewogICAgICAgIF8ubWl4aW4oY3NzLmlucHV0LCB7CiAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogInVybChkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUlBQUFBQUFBUC8vL3lINUJBRUFBQUFBTEFBQUFBQUJBQUVBQUFJQlJBQTcpIgogICAgICAgIH0pOwogICAgfQogICAgaWYgKF8uaXNNc2llKCkgJiYgXy5pc01zaWUoKSA8PSA3KSB7CiAgICAgICAgXy5taXhpbihjc3MuaW5wdXQsIHsKICAgICAgICAgICAgbWFyZ2luVG9wOiAiLTFweCIKICAgICAgICB9KTsKICAgIH0KICAgIHZhciBFdmVudEJ1cyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBuYW1lc3BhY2UgPSAidHlwZWFoZWFkOiI7CiAgICAgICAgZnVuY3Rpb24gRXZlbnRCdXMobykgewogICAgICAgICAgICBpZiAoIW8gfHwgIW8uZWwpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoIkV2ZW50QnVzIGluaXRpYWxpemVkIHdpdGhvdXQgZWwiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiRlbCA9ICQoby5lbCk7CiAgICAgICAgfQogICAgICAgIF8ubWl4aW4oRXZlbnRCdXMucHJvdG90eXBlLCB7CiAgICAgICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwudHJpZ2dlcihuYW1lc3BhY2UgKyB0eXBlLCBhcmdzKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBFdmVudEJ1czsKICAgIH0oKTsKICAgIHZhciBFdmVudEVtaXR0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc3BsaXR0ZXIgPSAvXHMrLywgbmV4dFRpY2sgPSBnZXROZXh0VGljaygpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9uU3luYzogb25TeW5jLAogICAgICAgICAgICBvbkFzeW5jOiBvbkFzeW5jLAogICAgICAgICAgICBvZmY6IG9mZiwKICAgICAgICAgICAgdHJpZ2dlcjogdHJpZ2dlcgogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gb24obWV0aG9kLCB0eXBlcywgY2IsIGNvbnRleHQpIHsKICAgICAgICAgICAgdmFyIHR5cGU7CiAgICAgICAgICAgIGlmICghY2IpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGVzID0gdHlwZXMuc3BsaXQoc3BsaXR0ZXIpOwogICAgICAgICAgICBjYiA9IGNvbnRleHQgPyBiaW5kQ29udGV4dChjYiwgY29udGV4dCkgOiBjYjsKICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzIHx8IHt9OwogICAgICAgICAgICB3aGlsZSAodHlwZSA9IHR5cGVzLnNoaWZ0KCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrc1t0eXBlXSA9IHRoaXMuX2NhbGxiYWNrc1t0eXBlXSB8fCB7CiAgICAgICAgICAgICAgICAgICAgc3luYzogW10sCiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IFtdCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tzW3R5cGVdW21ldGhvZF0ucHVzaChjYik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9uQXN5bmModHlwZXMsIGNiLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBvbi5jYWxsKHRoaXMsICJhc3luYyIsIHR5cGVzLCBjYiwgY29udGV4dCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9uU3luYyh0eXBlcywgY2IsIGNvbnRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIG9uLmNhbGwodGhpcywgInN5bmMiLCB0eXBlcywgY2IsIGNvbnRleHQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvZmYodHlwZXMpIHsKICAgICAgICAgICAgdmFyIHR5cGU7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlcyA9IHR5cGVzLnNwbGl0KHNwbGl0dGVyKTsKICAgICAgICAgICAgd2hpbGUgKHR5cGUgPSB0eXBlcy5zaGlmdCgpKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fY2FsbGJhY2tzW3R5cGVdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0cmlnZ2VyKHR5cGVzKSB7CiAgICAgICAgICAgIHZhciB0eXBlLCBjYWxsYmFja3MsIGFyZ3MsIHN5bmNGbHVzaCwgYXN5bmNGbHVzaDsKICAgICAgICAgICAgaWYgKCF0aGlzLl9jYWxsYmFja3MpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGVzID0gdHlwZXMuc3BsaXQoc3BsaXR0ZXIpOwogICAgICAgICAgICBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICAgICAgICB3aGlsZSAoKHR5cGUgPSB0eXBlcy5zaGlmdCgpKSAmJiAoY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzW3R5cGVdKSkgewogICAgICAgICAgICAgICAgc3luY0ZsdXNoID0gZ2V0Rmx1c2goY2FsbGJhY2tzLnN5bmMsIHRoaXMsIFsgdHlwZSBdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgICAgICAgICBhc3luY0ZsdXNoID0gZ2V0Rmx1c2goY2FsbGJhY2tzLmFzeW5jLCB0aGlzLCBbIHR5cGUgXS5jb25jYXQoYXJncykpOwogICAgICAgICAgICAgICAgc3luY0ZsdXNoKCkgJiYgbmV4dFRpY2soYXN5bmNGbHVzaCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldEZsdXNoKGNhbGxiYWNrcywgY29udGV4dCwgYXJncykgewogICAgICAgICAgICByZXR1cm4gZmx1c2g7CiAgICAgICAgICAgIGZ1bmN0aW9uIGZsdXNoKCkgewogICAgICAgICAgICAgICAgdmFyIGNhbmNlbGxlZDsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyAhY2FuY2VsbGVkICYmIGkgPCBjYWxsYmFja3MubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBjYW5jZWxsZWQgPSBjYWxsYmFja3NbaV0uYXBwbHkoY29udGV4dCwgYXJncykgPT09IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICFjYW5jZWxsZWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ2V0TmV4dFRpY2soKSB7CiAgICAgICAgICAgIHZhciBuZXh0VGlja0ZuOwogICAgICAgICAgICBpZiAod2luZG93LnNldEltbWVkaWF0ZSkgewogICAgICAgICAgICAgICAgbmV4dFRpY2tGbiA9IGZ1bmN0aW9uIG5leHRUaWNrU2V0SW1tZWRpYXRlKGZuKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0SW1tZWRpYXRlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmbigpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHRUaWNrRm4gPSBmdW5jdGlvbiBuZXh0VGlja1NldFRpbWVvdXQoZm4pIHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmbigpOwogICAgICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV4dFRpY2tGbjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmluZENvbnRleHQoZm4sIGNvbnRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIGZuLmJpbmQgPyBmbi5iaW5kKGNvbnRleHQpIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmbi5hcHBseShjb250ZXh0LCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCkpOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBoaWdobGlnaHQgPSBmdW5jdGlvbihkb2MpIHsKICAgICAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgICAgIG5vZGU6IG51bGwsCiAgICAgICAgICAgIHBhdHRlcm46IG51bGwsCiAgICAgICAgICAgIHRhZ05hbWU6ICJzdHJvbmciLAogICAgICAgICAgICBjbGFzc05hbWU6IG51bGwsCiAgICAgICAgICAgIHdvcmRzT25seTogZmFsc2UsCiAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gaGlnaHRsaWdodChvKSB7CiAgICAgICAgICAgIHZhciByZWdleDsKICAgICAgICAgICAgbyA9IF8ubWl4aW4oe30sIGRlZmF1bHRzLCBvKTsKICAgICAgICAgICAgaWYgKCFvLm5vZGUgfHwgIW8ucGF0dGVybikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG8ucGF0dGVybiA9IF8uaXNBcnJheShvLnBhdHRlcm4pID8gby5wYXR0ZXJuIDogWyBvLnBhdHRlcm4gXTsKICAgICAgICAgICAgcmVnZXggPSBnZXRSZWdleChvLnBhdHRlcm4sIG8uY2FzZVNlbnNpdGl2ZSwgby53b3Jkc09ubHkpOwogICAgICAgICAgICB0cmF2ZXJzZShvLm5vZGUsIGhpZ2h0bGlnaHRUZXh0Tm9kZSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGhpZ2h0bGlnaHRUZXh0Tm9kZSh0ZXh0Tm9kZSkgewogICAgICAgICAgICAgICAgdmFyIG1hdGNoLCBwYXR0ZXJuTm9kZTsKICAgICAgICAgICAgICAgIGlmIChtYXRjaCA9IHJlZ2V4LmV4ZWModGV4dE5vZGUuZGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICB3cmFwcGVyTm9kZSA9IGRvYy5jcmVhdGVFbGVtZW50KG8udGFnTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgby5jbGFzc05hbWUgJiYgKHdyYXBwZXJOb2RlLmNsYXNzTmFtZSA9IG8uY2xhc3NOYW1lKTsKICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuTm9kZSA9IHRleHROb2RlLnNwbGl0VGV4dChtYXRjaC5pbmRleCk7CiAgICAgICAgICAgICAgICAgICAgcGF0dGVybk5vZGUuc3BsaXRUZXh0KG1hdGNoWzBdLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgd3JhcHBlck5vZGUuYXBwZW5kQ2hpbGQocGF0dGVybk5vZGUuY2xvbmVOb2RlKHRydWUpKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0Tm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCh3cmFwcGVyTm9kZSwgcGF0dGVybk5vZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICEhbWF0Y2g7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdHJhdmVyc2UoZWwsIGhpZ2h0bGlnaHRUZXh0Tm9kZSkgewogICAgICAgICAgICAgICAgdmFyIGNoaWxkTm9kZSwgVEVYVF9OT0RFX1RZUEUgPSAzOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbC5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGROb2RlID0gZWwuY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGROb2RlLm5vZGVUeXBlID09PSBURVhUX05PREVfVFlQRSkgewogICAgICAgICAgICAgICAgICAgICAgICBpICs9IGhpZ2h0bGlnaHRUZXh0Tm9kZShjaGlsZE5vZGUpID8gMSA6IDA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJhdmVyc2UoY2hpbGROb2RlLCBoaWdodGxpZ2h0VGV4dE5vZGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gZ2V0UmVnZXgocGF0dGVybnMsIGNhc2VTZW5zaXRpdmUsIHdvcmRzT25seSkgewogICAgICAgICAgICB2YXIgZXNjYXBlZFBhdHRlcm5zID0gW10sIHJlZ2V4U3RyOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdHRlcm5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBlc2NhcGVkUGF0dGVybnMucHVzaChfLmVzY2FwZVJlZ0V4Q2hhcnMocGF0dGVybnNbaV0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWdleFN0ciA9IHdvcmRzT25seSA/ICJcXGIoIiArIGVzY2FwZWRQYXR0ZXJucy5qb2luKCJ8IikgKyAiKVxcYiIgOiAiKCIgKyBlc2NhcGVkUGF0dGVybnMuam9pbigifCIpICsgIikiOwogICAgICAgICAgICByZXR1cm4gY2FzZVNlbnNpdGl2ZSA/IG5ldyBSZWdFeHAocmVnZXhTdHIpIDogbmV3IFJlZ0V4cChyZWdleFN0ciwgImkiKTsKICAgICAgICB9CiAgICB9KHdpbmRvdy5kb2N1bWVudCk7CiAgICB2YXIgSW5wdXQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc3BlY2lhbEtleUNvZGVNYXA7CiAgICAgICAgc3BlY2lhbEtleUNvZGVNYXAgPSB7CiAgICAgICAgICAgIDk6ICJ0YWIiLAogICAgICAgICAgICAyNzogImVzYyIsCiAgICAgICAgICAgIDM3OiAibGVmdCIsCiAgICAgICAgICAgIDM5OiAicmlnaHQiLAogICAgICAgICAgICAxMzogImVudGVyIiwKICAgICAgICAgICAgMzg6ICJ1cCIsCiAgICAgICAgICAgIDQwOiAiZG93biIKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIElucHV0KG8pIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvbkJsdXIsIG9uRm9jdXMsIG9uS2V5ZG93biwgb25JbnB1dDsKICAgICAgICAgICAgbyA9IG8gfHwge307CiAgICAgICAgICAgIGlmICghby5pbnB1dCkgewogICAgICAgICAgICAgICAgJC5lcnJvcigiaW5wdXQgaXMgbWlzc2luZyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9uQmx1ciA9IF8uYmluZCh0aGlzLl9vbkJsdXIsIHRoaXMpOwogICAgICAgICAgICBvbkZvY3VzID0gXy5iaW5kKHRoaXMuX29uRm9jdXMsIHRoaXMpOwogICAgICAgICAgICBvbktleWRvd24gPSBfLmJpbmQodGhpcy5fb25LZXlkb3duLCB0aGlzKTsKICAgICAgICAgICAgb25JbnB1dCA9IF8uYmluZCh0aGlzLl9vbklucHV0LCB0aGlzKTsKICAgICAgICAgICAgdGhpcy4kaGludCA9ICQoby5oaW50KTsKICAgICAgICAgICAgdGhpcy4kaW5wdXQgPSAkKG8uaW5wdXQpLm9uKCJibHVyLnR0Iiwgb25CbHVyKS5vbigiZm9jdXMudHQiLCBvbkZvY3VzKS5vbigia2V5ZG93bi50dCIsIG9uS2V5ZG93bik7CiAgICAgICAgICAgIGlmICh0aGlzLiRoaW50Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRIaW50ID0gdGhpcy5nZXRIaW50ID0gdGhpcy5jbGVhckhpbnQgPSB0aGlzLmNsZWFySGludElmSW52YWxpZCA9IF8ubm9vcDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIV8uaXNNc2llKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCJpbnB1dC50dCIsIG9uSW5wdXQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQub24oImtleWRvd24udHQga2V5cHJlc3MudHQgY3V0LnR0IHBhc3RlLnR0IiwgZnVuY3Rpb24oJGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3BlY2lhbEtleUNvZGVNYXBbJGUud2hpY2ggfHwgJGUua2V5Q29kZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfLmRlZmVyKF8uYmluZCh0aGF0Ll9vbklucHV0LCB0aGF0LCAkZSkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHRoaXMuJGlucHV0LnZhbCgpOwogICAgICAgICAgICB0aGlzLiRvdmVyZmxvd0hlbHBlciA9IGJ1aWxkT3ZlcmZsb3dIZWxwZXIodGhpcy4kaW5wdXQpOwogICAgICAgIH0KICAgICAgICBJbnB1dC5ub3JtYWxpemVRdWVyeSA9IGZ1bmN0aW9uKHN0cikgewogICAgICAgICAgICByZXR1cm4gKHN0ciB8fCAiIikucmVwbGFjZSgvXlxzKi9nLCAiIikucmVwbGFjZSgvXHN7Mix9L2csICIgIik7CiAgICAgICAgfTsKICAgICAgICBfLm1peGluKElucHV0LnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9vbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImJsdXJyZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRm9jdXM6IGZ1bmN0aW9uIG9uRm9jdXMoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImZvY3VzZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uS2V5ZG93bjogZnVuY3Rpb24gb25LZXlkb3duKCRlKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5TmFtZSA9IHNwZWNpYWxLZXlDb2RlTWFwWyRlLndoaWNoIHx8ICRlLmtleUNvZGVdOwogICAgICAgICAgICAgICAgdGhpcy5fbWFuYWdlUHJldmVudERlZmF1bHQoa2V5TmFtZSwgJGUpOwogICAgICAgICAgICAgICAgaWYgKGtleU5hbWUgJiYgdGhpcy5fc2hvdWxkVHJpZ2dlcihrZXlOYW1lLCAkZSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoa2V5TmFtZSArICJLZXllZCIsICRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uSW5wdXQ6IGZ1bmN0aW9uIG9uSW5wdXQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsdWUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX21hbmFnZVByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiBtYW5hZ2VQcmV2ZW50RGVmYXVsdChrZXlOYW1lLCAkZSkgewogICAgICAgICAgICAgICAgdmFyIHByZXZlbnREZWZhdWx0LCBoaW50VmFsdWUsIGlucHV0VmFsdWU7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtleU5hbWUpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAidGFiIjoKICAgICAgICAgICAgICAgICAgICBoaW50VmFsdWUgPSB0aGlzLmdldEhpbnQoKTsKICAgICAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSBoaW50VmFsdWUgJiYgaGludFZhbHVlICE9PSBpbnB1dFZhbHVlICYmICF3aXRoTW9kaWZpZXIoJGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAidXAiOgogICAgICAgICAgICAgICAgICBjYXNlICJkb3duIjoKICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdCA9ICF3aXRoTW9kaWZpZXIoJGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgJiYgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3Nob3VsZFRyaWdnZXI6IGZ1bmN0aW9uIHNob3VsZFRyaWdnZXIoa2V5TmFtZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciB0cmlnZ2VyOwogICAgICAgICAgICAgICAgc3dpdGNoIChrZXlOYW1lKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgInRhYiI6CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlciA9ICF3aXRoTW9kaWZpZXIoJGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cmlnZ2VyOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfY2hlY2tJbnB1dFZhbHVlOiBmdW5jdGlvbiBjaGVja0lucHV0VmFsdWUoKSB7CiAgICAgICAgICAgICAgICB2YXIgaW5wdXRWYWx1ZSwgYXJlRXF1aXZhbGVudCwgaGFzRGlmZmVyZW50V2hpdGVzcGFjZTsKICAgICAgICAgICAgICAgIGlucHV0VmFsdWUgPSB0aGlzLmdldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGFyZUVxdWl2YWxlbnQgPSBhcmVRdWVyaWVzRXF1aXZhbGVudChpbnB1dFZhbHVlLCB0aGlzLnF1ZXJ5KTsKICAgICAgICAgICAgICAgIGhhc0RpZmZlcmVudFdoaXRlc3BhY2UgPSBhcmVFcXVpdmFsZW50ID8gdGhpcy5xdWVyeS5sZW5ndGggIT09IGlucHV0VmFsdWUubGVuZ3RoIDogZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIWFyZUVxdWl2YWxlbnQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoInF1ZXJ5Q2hhbmdlZCIsIHRoaXMucXVlcnkgPSBpbnB1dFZhbHVlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzRGlmZmVyZW50V2hpdGVzcGFjZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigid2hpdGVzcGFjZUNoYW5nZWQiLCB0aGlzLnF1ZXJ5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uIGZvY3VzKCkgewogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYmx1cjogZnVuY3Rpb24gYmx1cigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LmJsdXIoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0UXVlcnk6IGZ1bmN0aW9uIGdldFF1ZXJ5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVlcnk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldFF1ZXJ5OiBmdW5jdGlvbiBzZXRRdWVyeShxdWVyeSkgewogICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5OwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRJbnB1dFZhbHVlOiBmdW5jdGlvbiBnZXRJbnB1dFZhbHVlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGlucHV0LnZhbCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRJbnB1dFZhbHVlOiBmdW5jdGlvbiBzZXRJbnB1dFZhbHVlKHZhbHVlLCBzaWxlbnQpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LnZhbCh2YWx1ZSk7CiAgICAgICAgICAgICAgICBzaWxlbnQgPyB0aGlzLmNsZWFySGludCgpIDogdGhpcy5fY2hlY2tJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlc2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gcmVzZXRJbnB1dFZhbHVlKCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dFZhbHVlKHRoaXMucXVlcnksIHRydWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRIaW50OiBmdW5jdGlvbiBnZXRIaW50KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGhpbnQudmFsKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldEhpbnQ6IGZ1bmN0aW9uIHNldEhpbnQodmFsdWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGhpbnQudmFsKHZhbHVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xlYXJIaW50OiBmdW5jdGlvbiBjbGVhckhpbnQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldEhpbnQoIiIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGVhckhpbnRJZkludmFsaWQ6IGZ1bmN0aW9uIGNsZWFySGludElmSW52YWxpZCgpIHsKICAgICAgICAgICAgICAgIHZhciB2YWwsIGhpbnQsIHZhbElzUHJlZml4T2ZIaW50LCBpc1ZhbGlkOwogICAgICAgICAgICAgICAgdmFsID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICBoaW50ID0gdGhpcy5nZXRIaW50KCk7CiAgICAgICAgICAgICAgICB2YWxJc1ByZWZpeE9mSGludCA9IHZhbCAhPT0gaGludCAmJiBoaW50LmluZGV4T2YodmFsKSA9PT0gMDsKICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgIT09ICIiICYmIHZhbElzUHJlZml4T2ZIaW50ICYmICF0aGlzLmhhc092ZXJmbG93KCk7CiAgICAgICAgICAgICAgICAhaXNWYWxpZCAmJiB0aGlzLmNsZWFySGludCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRMYW5ndWFnZURpcmVjdGlvbjogZnVuY3Rpb24gZ2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHRoaXMuJGlucHV0LmNzcygiZGlyZWN0aW9uIikgfHwgImx0ciIpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhhc092ZXJmbG93OiBmdW5jdGlvbiBoYXNPdmVyZmxvdygpIHsKICAgICAgICAgICAgICAgIHZhciBjb25zdHJhaW50ID0gdGhpcy4kaW5wdXQud2lkdGgoKSAtIDI7CiAgICAgICAgICAgICAgICB0aGlzLiRvdmVyZmxvd0hlbHBlci50ZXh0KHRoaXMuZ2V0SW5wdXRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRvdmVyZmxvd0hlbHBlci53aWR0aCgpID49IGNvbnN0cmFpbnQ7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzQ3Vyc29yQXRFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlTGVuZ3RoLCBzZWxlY3Rpb25TdGFydCwgcmFuZ2U7CiAgICAgICAgICAgICAgICB2YWx1ZUxlbmd0aCA9IHRoaXMuJGlucHV0LnZhbCgpLmxlbmd0aDsKICAgICAgICAgICAgICAgIHNlbGVjdGlvblN0YXJ0ID0gdGhpcy4kaW5wdXRbMF0uc2VsZWN0aW9uU3RhcnQ7CiAgICAgICAgICAgICAgICBpZiAoXy5pc051bWJlcihzZWxlY3Rpb25TdGFydCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0aW9uU3RhcnQgPT09IHZhbHVlTGVuZ3RoOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICByYW5nZSA9IGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpOwogICAgICAgICAgICAgICAgICAgIHJhbmdlLm1vdmVTdGFydCgiY2hhcmFjdGVyIiwgLXZhbHVlTGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVMZW5ndGggPT09IHJhbmdlLnRleHQubGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRoaW50Lm9mZigiLnR0Iik7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5vZmYoIi50dCIpOwogICAgICAgICAgICAgICAgdGhpcy4kaGludCA9IHRoaXMuJGlucHV0ID0gdGhpcy4kb3ZlcmZsb3dIZWxwZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIElucHV0OwogICAgICAgIGZ1bmN0aW9uIGJ1aWxkT3ZlcmZsb3dIZWxwZXIoJGlucHV0KSB7CiAgICAgICAgICAgIHJldHVybiAkKCc8cHJlIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3ByZT4nKS5jc3MoewogICAgICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiAiaGlkZGVuIiwKICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJwcmUiLAogICAgICAgICAgICAgICAgZm9udEZhbWlseTogJGlucHV0LmNzcygiZm9udC1mYW1pbHkiKSwKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAkaW5wdXQuY3NzKCJmb250LXNpemUiKSwKICAgICAgICAgICAgICAgIGZvbnRTdHlsZTogJGlucHV0LmNzcygiZm9udC1zdHlsZSIpLAogICAgICAgICAgICAgICAgZm9udFZhcmlhbnQ6ICRpbnB1dC5jc3MoImZvbnQtdmFyaWFudCIpLAogICAgICAgICAgICAgICAgZm9udFdlaWdodDogJGlucHV0LmNzcygiZm9udC13ZWlnaHQiKSwKICAgICAgICAgICAgICAgIHdvcmRTcGFjaW5nOiAkaW5wdXQuY3NzKCJ3b3JkLXNwYWNpbmciKSwKICAgICAgICAgICAgICAgIGxldHRlclNwYWNpbmc6ICRpbnB1dC5jc3MoImxldHRlci1zcGFjaW5nIiksCiAgICAgICAgICAgICAgICB0ZXh0SW5kZW50OiAkaW5wdXQuY3NzKCJ0ZXh0LWluZGVudCIpLAogICAgICAgICAgICAgICAgdGV4dFJlbmRlcmluZzogJGlucHV0LmNzcygidGV4dC1yZW5kZXJpbmciKSwKICAgICAgICAgICAgICAgIHRleHRUcmFuc2Zvcm06ICRpbnB1dC5jc3MoInRleHQtdHJhbnNmb3JtIikKICAgICAgICAgICAgfSkuaW5zZXJ0QWZ0ZXIoJGlucHV0KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYXJlUXVlcmllc0VxdWl2YWxlbnQoYSwgYikgewogICAgICAgICAgICByZXR1cm4gSW5wdXQubm9ybWFsaXplUXVlcnkoYSkgPT09IElucHV0Lm5vcm1hbGl6ZVF1ZXJ5KGIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB3aXRoTW9kaWZpZXIoJGUpIHsKICAgICAgICAgICAgcmV0dXJuICRlLmFsdEtleSB8fCAkZS5jdHJsS2V5IHx8ICRlLm1ldGFLZXkgfHwgJGUuc2hpZnRLZXk7CiAgICAgICAgfQogICAgfSgpOwogICAgdmFyIERhdGFzZXQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZGF0YXNldEtleSA9ICJ0dERhdGFzZXQiLCB2YWx1ZUtleSA9ICJ0dFZhbHVlIiwgZGF0dW1LZXkgPSAidHREYXR1bSI7CiAgICAgICAgZnVuY3Rpb24gRGF0YXNldChvKSB7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBvLnRlbXBsYXRlcyA9IG8udGVtcGxhdGVzIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8uc291cmNlKSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJtaXNzaW5nIHNvdXJjZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvLm5hbWUgJiYgIWlzVmFsaWROYW1lKG8ubmFtZSkpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoImludmFsaWQgZGF0YXNldCBuYW1lOiAiICsgby5uYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5oaWdobGlnaHQgPSAhIW8uaGlnaGxpZ2h0OwogICAgICAgICAgICB0aGlzLm5hbWUgPSBvLm5hbWUgfHwgXy5nZXRVbmlxdWVJZCgpOwogICAgICAgICAgICB0aGlzLnNvdXJjZSA9IG8uc291cmNlOwogICAgICAgICAgICB0aGlzLmRpc3BsYXlGbiA9IGdldERpc3BsYXlGbihvLmRpc3BsYXkgfHwgby5kaXNwbGF5S2V5KTsKICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZXMgPSBnZXRUZW1wbGF0ZXMoby50ZW1wbGF0ZXMsIHRoaXMuZGlzcGxheUZuKTsKICAgICAgICAgICAgdGhpcy4kZWwgPSAkKGh0bWwuZGF0YXNldC5yZXBsYWNlKCIlQ0xBU1MlIiwgdGhpcy5uYW1lKSk7CiAgICAgICAgfQogICAgICAgIERhdGFzZXQuZXh0cmFjdERhdGFzZXROYW1lID0gZnVuY3Rpb24gZXh0cmFjdERhdGFzZXROYW1lKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKGRhdGFzZXRLZXkpOwogICAgICAgIH07CiAgICAgICAgRGF0YXNldC5leHRyYWN0VmFsdWUgPSBmdW5jdGlvbiBleHRyYWN0RGF0dW0oZWwpIHsKICAgICAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEodmFsdWVLZXkpOwogICAgICAgIH07CiAgICAgICAgRGF0YXNldC5leHRyYWN0RGF0dW0gPSBmdW5jdGlvbiBleHRyYWN0RGF0dW0oZWwpIHsKICAgICAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEoZGF0dW1LZXkpOwogICAgICAgIH07CiAgICAgICAgXy5taXhpbihEYXRhc2V0LnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9yZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihxdWVyeSwgc3VnZ2VzdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy4kZWwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGhhc1N1Z2dlc3Rpb25zOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZW1wdHkoKTsKICAgICAgICAgICAgICAgIGhhc1N1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnMgJiYgc3VnZ2VzdGlvbnMubGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKCFoYXNTdWdnZXN0aW9ucyAmJiB0aGlzLnRlbXBsYXRlcy5lbXB0eSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoZ2V0RW1wdHlIdG1sKCkpLnByZXBlbmQodGhhdC50ZW1wbGF0ZXMuaGVhZGVyID8gZ2V0SGVhZGVySHRtbCgpIDogbnVsbCkuYXBwZW5kKHRoYXQudGVtcGxhdGVzLmZvb3RlciA/IGdldEZvb3Rlckh0bWwoKSA6IG51bGwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNTdWdnZXN0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoZ2V0U3VnZ2VzdGlvbnNIdG1sKCkpLnByZXBlbmQodGhhdC50ZW1wbGF0ZXMuaGVhZGVyID8gZ2V0SGVhZGVySHRtbCgpIDogbnVsbCkuYXBwZW5kKHRoYXQudGVtcGxhdGVzLmZvb3RlciA/IGdldEZvb3Rlckh0bWwoKSA6IG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJyZW5kZXJlZCIpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RW1wdHlIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGF0LnRlbXBsYXRlcy5lbXB0eSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbXB0eTogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U3VnZ2VzdGlvbnNIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkc3VnZ2VzdGlvbnMsIG5vZGVzOwogICAgICAgICAgICAgICAgICAgICRzdWdnZXN0aW9ucyA9ICQoaHRtbC5zdWdnZXN0aW9ucykuY3NzKGNzcy5zdWdnZXN0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgbm9kZXMgPSBfLm1hcChzdWdnZXN0aW9ucywgZ2V0U3VnZ2VzdGlvbk5vZGUpOwogICAgICAgICAgICAgICAgICAgICRzdWdnZXN0aW9ucy5hcHBlbmQuYXBwbHkoJHN1Z2dlc3Rpb25zLCBub2Rlcyk7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5oaWdobGlnaHQgJiYgaGlnaGxpZ2h0KHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogJHN1Z2dlc3Rpb25zWzBdLAogICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuOiBxdWVyeQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3VnZ2VzdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U3VnZ2VzdGlvbk5vZGUoc3VnZ2VzdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGVsOwogICAgICAgICAgICAgICAgICAgICAgICAkZWwgPSAkKGh0bWwuc3VnZ2VzdGlvbikuYXBwZW5kKHRoYXQudGVtcGxhdGVzLnN1Z2dlc3Rpb24oc3VnZ2VzdGlvbikpLmRhdGEoZGF0YXNldEtleSwgdGhhdC5uYW1lKS5kYXRhKHZhbHVlS2V5LCB0aGF0LmRpc3BsYXlGbihzdWdnZXN0aW9uKSkuZGF0YShkYXR1bUtleSwgc3VnZ2VzdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICRlbC5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhjc3Muc3VnZ2VzdGlvbkNoaWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZWw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0SGVhZGVySHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC50ZW1wbGF0ZXMuaGVhZGVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICBpc0VtcHR5OiAhaGFzU3VnZ2VzdGlvbnMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZvb3Rlckh0bWwoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQudGVtcGxhdGVzLmZvb3Rlcih7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbXB0eTogIWhhc1N1Z2dlc3Rpb25zCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFJvb3Q6IGZ1bmN0aW9uIGdldFJvb3QoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZWw7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gcXVlcnk7CiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZShxdWVyeSwgcmVuZGVyKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlcihzdWdnZXN0aW9ucykgewogICAgICAgICAgICAgICAgICAgIGlmICghdGhhdC5jYW5jZWxlZCAmJiBxdWVyeSA9PT0gdGhhdC5xdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9yZW5kZXIocXVlcnksIHN1Z2dlc3Rpb25zKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24gY2FuY2VsKCkgewogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxlZCA9IHRydWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsZWFyOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5lbXB0eSgpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJyZW5kZXJlZCIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0VtcHR5OiBmdW5jdGlvbiBpc0VtcHR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsLmlzKCI6ZW1wdHkiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBEYXRhc2V0OwogICAgICAgIGZ1bmN0aW9uIGdldERpc3BsYXlGbihkaXNwbGF5KSB7CiAgICAgICAgICAgIGRpc3BsYXkgPSBkaXNwbGF5IHx8ICJ2YWx1ZSI7CiAgICAgICAgICAgIHJldHVybiBfLmlzRnVuY3Rpb24oZGlzcGxheSkgPyBkaXNwbGF5IDogZGlzcGxheUZuOwogICAgICAgICAgICBmdW5jdGlvbiBkaXNwbGF5Rm4ob2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JqW2Rpc3BsYXldOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldFRlbXBsYXRlcyh0ZW1wbGF0ZXMsIGRpc3BsYXlGbikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgZW1wdHk6IHRlbXBsYXRlcy5lbXB0eSAmJiBfLnRlbXBsYXRpZnkodGVtcGxhdGVzLmVtcHR5KSwKICAgICAgICAgICAgICAgIGhlYWRlcjogdGVtcGxhdGVzLmhlYWRlciAmJiBfLnRlbXBsYXRpZnkodGVtcGxhdGVzLmhlYWRlciksCiAgICAgICAgICAgICAgICBmb290ZXI6IHRlbXBsYXRlcy5mb290ZXIgJiYgXy50ZW1wbGF0aWZ5KHRlbXBsYXRlcy5mb290ZXIpLAogICAgICAgICAgICAgICAgc3VnZ2VzdGlvbjogdGVtcGxhdGVzLnN1Z2dlc3Rpb24gfHwgc3VnZ2VzdGlvblRlbXBsYXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGZ1bmN0aW9uIHN1Z2dlc3Rpb25UZW1wbGF0ZShjb250ZXh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIjxwPiIgKyBkaXNwbGF5Rm4oY29udGV4dCkgKyAiPC9wPiI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNWYWxpZE5hbWUoc3RyKSB7CiAgICAgICAgICAgIHJldHVybiAvXltfYS16QS1aMC05LV0rJC8udGVzdChzdHIpOwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBEcm9wZG93biA9IGZ1bmN0aW9uKCkgewogICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duKG8pIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvblN1Z2dlc3Rpb25DbGljaywgb25TdWdnZXN0aW9uTW91c2VFbnRlciwgb25TdWdnZXN0aW9uTW91c2VMZWF2ZTsKICAgICAgICAgICAgbyA9IG8gfHwge307CiAgICAgICAgICAgIGlmICghby5tZW51KSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJtZW51IGlzIHJlcXVpcmVkIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5kYXRhc2V0cyA9IF8ubWFwKG8uZGF0YXNldHMsIGluaXRpYWxpemVEYXRhc2V0KTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uQ2xpY2sgPSBfLmJpbmQodGhpcy5fb25TdWdnZXN0aW9uQ2xpY2ssIHRoaXMpOwogICAgICAgICAgICBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyID0gXy5iaW5kKHRoaXMuX29uU3VnZ2VzdGlvbk1vdXNlRW50ZXIsIHRoaXMpOwogICAgICAgICAgICBvblN1Z2dlc3Rpb25Nb3VzZUxlYXZlID0gXy5iaW5kKHRoaXMuX29uU3VnZ2VzdGlvbk1vdXNlTGVhdmUsIHRoaXMpOwogICAgICAgICAgICB0aGlzLiRtZW51ID0gJChvLm1lbnUpLm9uKCJjbGljay50dCIsICIudHQtc3VnZ2VzdGlvbiIsIG9uU3VnZ2VzdGlvbkNsaWNrKS5vbigibW91c2VlbnRlci50dCIsICIudHQtc3VnZ2VzdGlvbiIsIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIpLm9uKCJtb3VzZWxlYXZlLnR0IiwgIi50dC1zdWdnZXN0aW9uIiwgb25TdWdnZXN0aW9uTW91c2VMZWF2ZSk7CiAgICAgICAgICAgIF8uZWFjaCh0aGlzLmRhdGFzZXRzLCBmdW5jdGlvbihkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICB0aGF0LiRtZW51LmFwcGVuZChkYXRhc2V0LmdldFJvb3QoKSk7CiAgICAgICAgICAgICAgICBkYXRhc2V0Lm9uU3luYygicmVuZGVyZWQiLCB0aGF0Ll9vblJlbmRlcmVkLCB0aGF0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIF8ubWl4aW4oRHJvcGRvd24ucHJvdG90eXBlLCBFdmVudEVtaXR0ZXIsIHsKICAgICAgICAgICAgX29uU3VnZ2VzdGlvbkNsaWNrOiBmdW5jdGlvbiBvblN1Z2dlc3Rpb25DbGljaygkZSkgewogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJzdWdnZXN0aW9uQ2xpY2tlZCIsICQoJGUuY3VycmVudFRhcmdldCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25TdWdnZXN0aW9uTW91c2VFbnRlcjogZnVuY3Rpb24gb25TdWdnZXN0aW9uTW91c2VFbnRlcigkZSkgewogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRDdXJzb3IoJCgkZS5jdXJyZW50VGFyZ2V0KSwgdHJ1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25Nb3VzZUxlYXZlOiBmdW5jdGlvbiBvblN1Z2dlc3Rpb25Nb3VzZUxlYXZlKCkgewogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3Vyc29yKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblJlbmRlcmVkOiBmdW5jdGlvbiBvblJlbmRlcmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID0gXy5ldmVyeSh0aGlzLmRhdGFzZXRzLCBpc0RhdGFzZXRFbXB0eSk7CiAgICAgICAgICAgICAgICB0aGlzLmlzRW1wdHkgPyB0aGlzLl9oaWRlKCkgOiB0aGlzLmlzT3BlbiAmJiB0aGlzLl9zaG93KCk7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImRhdGFzZXRSZW5kZXJlZCIpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gaXNEYXRhc2V0RW1wdHkoZGF0YXNldCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0LmlzRW1wdHkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2hpZGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy4kbWVudS5oaWRlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zaG93OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUuY3NzKCJkaXNwbGF5IiwgImJsb2NrIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9nZXRTdWdnZXN0aW9uczogZnVuY3Rpb24gZ2V0U3VnZ2VzdGlvbnMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVudS5maW5kKCIudHQtc3VnZ2VzdGlvbiIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfZ2V0Q3Vyc29yOiBmdW5jdGlvbiBnZXRDdXJzb3IoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVudS5maW5kKCIudHQtY3Vyc29yIikuZmlyc3QoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3NldEN1cnNvcjogZnVuY3Rpb24gc2V0Q3Vyc29yKCRlbCwgc2lsZW50KSB7CiAgICAgICAgICAgICAgICAkZWwuZmlyc3QoKS5hZGRDbGFzcygidHQtY3Vyc29yIik7CiAgICAgICAgICAgICAgICAhc2lsZW50ICYmIHRoaXMudHJpZ2dlcigiY3Vyc29yTW92ZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3JlbW92ZUN1cnNvcjogZnVuY3Rpb24gcmVtb3ZlQ3Vyc29yKCkgewogICAgICAgICAgICAgICAgdGhpcy5fZ2V0Q3Vyc29yKCkucmVtb3ZlQ2xhc3MoInR0LWN1cnNvciIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfbW92ZUN1cnNvcjogZnVuY3Rpb24gbW92ZUN1cnNvcihpbmNyZW1lbnQpIHsKICAgICAgICAgICAgICAgIHZhciAkc3VnZ2VzdGlvbnMsICRvbGRDdXJzb3IsIG5ld0N1cnNvckluZGV4LCAkbmV3Q3Vyc29yOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzT3BlbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRvbGRDdXJzb3IgPSB0aGlzLl9nZXRDdXJzb3IoKTsKICAgICAgICAgICAgICAgICRzdWdnZXN0aW9ucyA9IHRoaXMuX2dldFN1Z2dlc3Rpb25zKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDdXJzb3IoKTsKICAgICAgICAgICAgICAgIG5ld0N1cnNvckluZGV4ID0gJHN1Z2dlc3Rpb25zLmluZGV4KCRvbGRDdXJzb3IpICsgaW5jcmVtZW50OwogICAgICAgICAgICAgICAgbmV3Q3Vyc29ySW5kZXggPSAobmV3Q3Vyc29ySW5kZXggKyAxKSAlICgkc3VnZ2VzdGlvbnMubGVuZ3RoICsgMSkgLSAxOwogICAgICAgICAgICAgICAgaWYgKG5ld0N1cnNvckluZGV4ID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigiY3Vyc29yUmVtb3ZlZCIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3Q3Vyc29ySW5kZXggPCAtMSkgewogICAgICAgICAgICAgICAgICAgIG5ld0N1cnNvckluZGV4ID0gJHN1Z2dlc3Rpb25zLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRDdXJzb3IoJG5ld0N1cnNvciA9ICRzdWdnZXN0aW9ucy5lcShuZXdDdXJzb3JJbmRleCkpOwogICAgICAgICAgICAgICAgdGhpcy5fZW5zdXJlVmlzaWJsZSgkbmV3Q3Vyc29yKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2Vuc3VyZVZpc2libGU6IGZ1bmN0aW9uIGVuc3VyZVZpc2libGUoJGVsKSB7CiAgICAgICAgICAgICAgICB2YXIgZWxUb3AsIGVsQm90dG9tLCBtZW51U2Nyb2xsVG9wLCBtZW51SGVpZ2h0OwogICAgICAgICAgICAgICAgZWxUb3AgPSAkZWwucG9zaXRpb24oKS50b3A7CiAgICAgICAgICAgICAgICBlbEJvdHRvbSA9IGVsVG9wICsgJGVsLm91dGVySGVpZ2h0KHRydWUpOwogICAgICAgICAgICAgICAgbWVudVNjcm9sbFRvcCA9IHRoaXMuJG1lbnUuc2Nyb2xsVG9wKCk7CiAgICAgICAgICAgICAgICBtZW51SGVpZ2h0ID0gdGhpcy4kbWVudS5oZWlnaHQoKSArIHBhcnNlSW50KHRoaXMuJG1lbnUuY3NzKCJwYWRkaW5nVG9wIiksIDEwKSArIHBhcnNlSW50KHRoaXMuJG1lbnUuY3NzKCJwYWRkaW5nQm90dG9tIiksIDEwKTsKICAgICAgICAgICAgICAgIGlmIChlbFRvcCA8IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZW51LnNjcm9sbFRvcChtZW51U2Nyb2xsVG9wICsgZWxUb3ApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZW51SGVpZ2h0IDwgZWxCb3R0b20pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZW51LnNjcm9sbFRvcChtZW51U2Nyb2xsVG9wICsgKGVsQm90dG9tIC0gbWVudUhlaWdodCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpZGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImNsb3NlZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzT3BlbikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAhdGhpcy5pc0VtcHR5ICYmIHRoaXMuX3Nob3coKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoIm9wZW5lZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRMYW5ndWFnZURpcmVjdGlvbjogZnVuY3Rpb24gc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oZGlyKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZW51LmNzcyhkaXIgPT09ICJsdHIiID8gY3NzLmx0ciA6IGNzcy5ydGwpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBtb3ZlQ3Vyc29yVXA6IGZ1bmN0aW9uIG1vdmVDdXJzb3JVcCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX21vdmVDdXJzb3IoLTEpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBtb3ZlQ3Vyc29yRG93bjogZnVuY3Rpb24gbW92ZUN1cnNvckRvd24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlQ3Vyc29yKCsxKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uOiBmdW5jdGlvbiBnZXREYXR1bUZvclN1Z2dlc3Rpb24oJGVsKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW0gPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKCRlbC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBkYXR1bSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmF3OiBEYXRhc2V0LmV4dHJhY3REYXR1bSgkZWwpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogRGF0YXNldC5leHRyYWN0VmFsdWUoJGVsKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNldE5hbWU6IERhdGFzZXQuZXh0cmFjdERhdGFzZXROYW1lKCRlbCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdHVtOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXREYXR1bUZvckN1cnNvcjogZnVuY3Rpb24gZ2V0RGF0dW1Gb3JDdXJzb3IoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXREYXR1bUZvclN1Z2dlc3Rpb24odGhpcy5fZ2V0Q3Vyc29yKCkuZmlyc3QoKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbjogZnVuY3Rpb24gZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKHRoaXMuX2dldFN1Z2dlc3Rpb25zKCkuZmlyc3QoKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgdXBkYXRlRGF0YXNldCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVEYXRhc2V0KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LnVwZGF0ZShxdWVyeSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVtcHR5OiBmdW5jdGlvbiBlbXB0eSgpIHsKICAgICAgICAgICAgICAgIF8uZWFjaCh0aGlzLmRhdGFzZXRzLCBjbGVhckRhdGFzZXQpOwogICAgICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNsZWFyRGF0YXNldChkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YXNldC5jbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBpc1Zpc2libGU6IGZ1bmN0aW9uIGlzVmlzaWJsZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzT3BlbiAmJiAhdGhpcy5pc0VtcHR5OwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgICAgdGhpcy4kbWVudS5vZmYoIi50dCIpOwogICAgICAgICAgICAgICAgdGhpcy4kbWVudSA9IG51bGw7CiAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgZGVzdHJveURhdGFzZXQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gZGVzdHJveURhdGFzZXQoZGF0YXNldCkgewogICAgICAgICAgICAgICAgICAgIGRhdGFzZXQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIERyb3Bkb3duOwogICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemVEYXRhc2V0KG9EYXRhc2V0KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0YXNldChvRGF0YXNldCk7CiAgICAgICAgfQogICAgfSgpOwogICAgdmFyIFR5cGVhaGVhZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhdHRyc0tleSA9ICJ0dEF0dHJzIjsKICAgICAgICBmdW5jdGlvbiBUeXBlYWhlYWQobykgewogICAgICAgICAgICB2YXIgJG1lbnUsICRpbnB1dCwgJGhpbnQ7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8uaW5wdXQpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoIm1pc3NpbmcgaW5wdXQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmlzQWN0aXZhdGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuYXV0b3NlbGVjdCA9ICEhby5hdXRvc2VsZWN0OwogICAgICAgICAgICB0aGlzLm1pbkxlbmd0aCA9IF8uaXNOdW1iZXIoby5taW5MZW5ndGgpID8gby5taW5MZW5ndGggOiAxOwogICAgICAgICAgICB0aGlzLiRub2RlID0gYnVpbGREb21TdHJ1Y3R1cmUoby5pbnB1dCwgby53aXRoSGludCk7CiAgICAgICAgICAgICRtZW51ID0gdGhpcy4kbm9kZS5maW5kKCIudHQtZHJvcGRvd24tbWVudSIpOwogICAgICAgICAgICAkaW5wdXQgPSB0aGlzLiRub2RlLmZpbmQoIi50dC1pbnB1dCIpOwogICAgICAgICAgICAkaGludCA9IHRoaXMuJG5vZGUuZmluZCgiLnR0LWhpbnQiKTsKICAgICAgICAgICAgJGlucHV0Lm9uKCJibHVyLnR0IiwgZnVuY3Rpb24oJGUpIHsKICAgICAgICAgICAgICAgIHZhciBhY3RpdmUsIGlzQWN0aXZlLCBoYXNBY3RpdmU7CiAgICAgICAgICAgICAgICBhY3RpdmUgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OwogICAgICAgICAgICAgICAgaXNBY3RpdmUgPSAkbWVudS5pcyhhY3RpdmUpOwogICAgICAgICAgICAgICAgaGFzQWN0aXZlID0gJG1lbnUuaGFzKGFjdGl2ZSkubGVuZ3RoID4gMDsKICAgICAgICAgICAgICAgIGlmIChfLmlzTXNpZSgpICYmIChpc0FjdGl2ZSB8fCBoYXNBY3RpdmUpKSB7CiAgICAgICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAkZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRtZW51Lm9uKCJtb3VzZWRvd24udHQiLCBmdW5jdGlvbigkZSkgewogICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMgPSBvLmV2ZW50QnVzIHx8IG5ldyBFdmVudEJ1cyh7CiAgICAgICAgICAgICAgICBlbDogJGlucHV0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmRyb3Bkb3duID0gbmV3IERyb3Bkb3duKHsKICAgICAgICAgICAgICAgIG1lbnU6ICRtZW51LAogICAgICAgICAgICAgICAgZGF0YXNldHM6IG8uZGF0YXNldHMKICAgICAgICAgICAgfSkub25TeW5jKCJzdWdnZXN0aW9uQ2xpY2tlZCIsIHRoaXMuX29uU3VnZ2VzdGlvbkNsaWNrZWQsIHRoaXMpLm9uU3luYygiY3Vyc29yTW92ZWQiLCB0aGlzLl9vbkN1cnNvck1vdmVkLCB0aGlzKS5vblN5bmMoImN1cnNvclJlbW92ZWQiLCB0aGlzLl9vbkN1cnNvclJlbW92ZWQsIHRoaXMpLm9uU3luYygib3BlbmVkIiwgdGhpcy5fb25PcGVuZWQsIHRoaXMpLm9uU3luYygiY2xvc2VkIiwgdGhpcy5fb25DbG9zZWQsIHRoaXMpLm9uQXN5bmMoImRhdGFzZXRSZW5kZXJlZCIsIHRoaXMuX29uRGF0YXNldFJlbmRlcmVkLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5pbnB1dCA9IG5ldyBJbnB1dCh7CiAgICAgICAgICAgICAgICBpbnB1dDogJGlucHV0LAogICAgICAgICAgICAgICAgaGludDogJGhpbnQKICAgICAgICAgICAgfSkub25TeW5jKCJmb2N1c2VkIiwgdGhpcy5fb25Gb2N1c2VkLCB0aGlzKS5vblN5bmMoImJsdXJyZWQiLCB0aGlzLl9vbkJsdXJyZWQsIHRoaXMpLm9uU3luYygiZW50ZXJLZXllZCIsIHRoaXMuX29uRW50ZXJLZXllZCwgdGhpcykub25TeW5jKCJ0YWJLZXllZCIsIHRoaXMuX29uVGFiS2V5ZWQsIHRoaXMpLm9uU3luYygiZXNjS2V5ZWQiLCB0aGlzLl9vbkVzY0tleWVkLCB0aGlzKS5vblN5bmMoInVwS2V5ZWQiLCB0aGlzLl9vblVwS2V5ZWQsIHRoaXMpLm9uU3luYygiZG93bktleWVkIiwgdGhpcy5fb25Eb3duS2V5ZWQsIHRoaXMpLm9uU3luYygibGVmdEtleWVkIiwgdGhpcy5fb25MZWZ0S2V5ZWQsIHRoaXMpLm9uU3luYygicmlnaHRLZXllZCIsIHRoaXMuX29uUmlnaHRLZXllZCwgdGhpcykub25TeW5jKCJxdWVyeUNoYW5nZWQiLCB0aGlzLl9vblF1ZXJ5Q2hhbmdlZCwgdGhpcykub25TeW5jKCJ3aGl0ZXNwYWNlQ2hhbmdlZCIsIHRoaXMuX29uV2hpdGVzcGFjZUNoYW5nZWQsIHRoaXMpOwogICAgICAgICAgICB0aGlzLl9zZXRMYW5ndWFnZURpcmVjdGlvbigpOwogICAgICAgIH0KICAgICAgICBfLm1peGluKFR5cGVhaGVhZC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgX29uU3VnZ2VzdGlvbkNsaWNrZWQ6IGZ1bmN0aW9uIG9uU3VnZ2VzdGlvbkNsaWNrZWQodHlwZSwgJGVsKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW07CiAgICAgICAgICAgICAgICBpZiAoZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yU3VnZ2VzdGlvbigkZWwpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0KGRhdHVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uQ3Vyc29yTW92ZWQ6IGZ1bmN0aW9uIG9uQ3Vyc29yTW92ZWQoKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldElucHV0VmFsdWUoZGF0dW0udmFsdWUsIHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJjdXJzb3JjaGFuZ2VkIiwgZGF0dW0ucmF3LCBkYXR1bS5kYXRhc2V0TmFtZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkN1cnNvclJlbW92ZWQ6IGZ1bmN0aW9uIG9uQ3Vyc29yUmVtb3ZlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQucmVzZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIaW50KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkRhdGFzZXRSZW5kZXJlZDogZnVuY3Rpb24gb25EYXRhc2V0UmVuZGVyZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIaW50KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbk9wZW5lZDogZnVuY3Rpb24gb25PcGVuZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIaW50KCk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoIm9wZW5lZCIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25DbG9zZWQ6IGZ1bmN0aW9uIG9uQ2xvc2VkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5jbGVhckhpbnQoKTsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigiY2xvc2VkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkZvY3VzZWQ6IGZ1bmN0aW9uIG9uRm9jdXNlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNBY3RpdmF0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkJsdXJyZWQ6IGZ1bmN0aW9uIG9uQmx1cnJlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNBY3RpdmF0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uZW1wdHkoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uY2xvc2UoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRW50ZXJLZXllZDogZnVuY3Rpb24gb25FbnRlcktleWVkKHR5cGUsICRlKSB7CiAgICAgICAgICAgICAgICB2YXIgY3Vyc29yRGF0dW0sIHRvcFN1Z2dlc3Rpb25EYXR1bTsKICAgICAgICAgICAgICAgIGN1cnNvckRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvckN1cnNvcigpOwogICAgICAgICAgICAgICAgdG9wU3VnZ2VzdGlvbkRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclRvcFN1Z2dlc3Rpb24oKTsKICAgICAgICAgICAgICAgIGlmIChjdXJzb3JEYXR1bSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdChjdXJzb3JEYXR1bSk7CiAgICAgICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hdXRvc2VsZWN0ICYmIHRvcFN1Z2dlc3Rpb25EYXR1bSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdCh0b3BTdWdnZXN0aW9uRGF0dW0pOwogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblRhYktleWVkOiBmdW5jdGlvbiBvblRhYktleWVkKHR5cGUsICRlKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW07CiAgICAgICAgICAgICAgICBpZiAoZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yQ3Vyc29yKCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QoZGF0dW0pOwogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2F1dG9jb21wbGV0ZSh0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRXNjS2V5ZWQ6IGZ1bmN0aW9uIG9uRXNjS2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnJlc2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25VcEtleWVkOiBmdW5jdGlvbiBvblVwS2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLmlucHV0LmdldFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmlzRW1wdHkgJiYgcXVlcnkubGVuZ3RoID49IHRoaXMubWluTGVuZ3RoID8gdGhpcy5kcm9wZG93bi51cGRhdGUocXVlcnkpIDogdGhpcy5kcm9wZG93bi5tb3ZlQ3Vyc29yVXAoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25Eb3duS2V5ZWQ6IGZ1bmN0aW9uIG9uRG93bktleWVkKCkgewogICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5pbnB1dC5nZXRRdWVyeSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5pc0VtcHR5ICYmIHF1ZXJ5Lmxlbmd0aCA+PSB0aGlzLm1pbkxlbmd0aCA/IHRoaXMuZHJvcGRvd24udXBkYXRlKHF1ZXJ5KSA6IHRoaXMuZHJvcGRvd24ubW92ZUN1cnNvckRvd24oKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25MZWZ0S2V5ZWQ6IGZ1bmN0aW9uIG9uTGVmdEtleWVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5kaXIgPT09ICJydGwiICYmIHRoaXMuX2F1dG9jb21wbGV0ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25SaWdodEtleWVkOiBmdW5jdGlvbiBvblJpZ2h0S2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRpciA9PT0gImx0ciIgJiYgdGhpcy5fYXV0b2NvbXBsZXRlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblF1ZXJ5Q2hhbmdlZDogZnVuY3Rpb24gb25RdWVyeUNoYW5nZWQoZSwgcXVlcnkpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuY2xlYXJIaW50SWZJbnZhbGlkKCk7CiAgICAgICAgICAgICAgICBxdWVyeS5sZW5ndGggPj0gdGhpcy5taW5MZW5ndGggPyB0aGlzLmRyb3Bkb3duLnVwZGF0ZShxdWVyeSkgOiB0aGlzLmRyb3Bkb3duLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbldoaXRlc3BhY2VDaGFuZ2VkOiBmdW5jdGlvbiBvbldoaXRlc3BhY2VDaGFuZ2VkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zZXRMYW5ndWFnZURpcmVjdGlvbjogZnVuY3Rpb24gc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgZGlyOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyICE9PSAoZGlyID0gdGhpcy5pbnB1dC5nZXRMYW5ndWFnZURpcmVjdGlvbigpKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyID0gZGlyOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJG5vZGUuY3NzKCJkaXJlY3Rpb24iLCBkaXIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oZGlyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3VwZGF0ZUhpbnQ6IGZ1bmN0aW9uIHVwZGF0ZUhpbnQoKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW0sIHZhbCwgcXVlcnksIGVzY2FwZWRRdWVyeSwgZnJvbnRNYXRjaFJlZ0V4LCBtYXRjaDsKICAgICAgICAgICAgICAgIGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclRvcFN1Z2dlc3Rpb24oKTsKICAgICAgICAgICAgICAgIGlmIChkYXR1bSAmJiB0aGlzLmRyb3Bkb3duLmlzVmlzaWJsZSgpICYmICF0aGlzLmlucHV0Lmhhc092ZXJmbG93KCkpIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSB0aGlzLmlucHV0LmdldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICBxdWVyeSA9IElucHV0Lm5vcm1hbGl6ZVF1ZXJ5KHZhbCk7CiAgICAgICAgICAgICAgICAgICAgZXNjYXBlZFF1ZXJ5ID0gXy5lc2NhcGVSZWdFeENoYXJzKHF1ZXJ5KTsKICAgICAgICAgICAgICAgICAgICBmcm9udE1hdGNoUmVnRXggPSBuZXcgUmVnRXhwKCJeKD86IiArIGVzY2FwZWRRdWVyeSArICIpKC4rJCkiLCAiaSIpOwogICAgICAgICAgICAgICAgICAgIG1hdGNoID0gZnJvbnRNYXRjaFJlZ0V4LmV4ZWMoZGF0dW0udmFsdWUpOwogICAgICAgICAgICAgICAgICAgIG1hdGNoID8gdGhpcy5pbnB1dC5zZXRIaW50KHZhbCArIG1hdGNoWzFdKSA6IHRoaXMuaW5wdXQuY2xlYXJIaW50KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuY2xlYXJIaW50KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9hdXRvY29tcGxldGU6IGZ1bmN0aW9uIGF1dG9jb21wbGV0ZShsYXhDdXJzb3IpIHsKICAgICAgICAgICAgICAgIHZhciBoaW50LCBxdWVyeSwgaXNDdXJzb3JBdEVuZCwgZGF0dW07CiAgICAgICAgICAgICAgICBoaW50ID0gdGhpcy5pbnB1dC5nZXRIaW50KCk7CiAgICAgICAgICAgICAgICBxdWVyeSA9IHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgICAgIGlzQ3Vyc29yQXRFbmQgPSBsYXhDdXJzb3IgfHwgdGhpcy5pbnB1dC5pc0N1cnNvckF0RW5kKCk7CiAgICAgICAgICAgICAgICBpZiAoaGludCAmJiBxdWVyeSAhPT0gaGludCAmJiBpc0N1cnNvckF0RW5kKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpOwogICAgICAgICAgICAgICAgICAgIGRhdHVtICYmIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZShkYXR1bS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJhdXRvY29tcGxldGVkIiwgZGF0dW0ucmF3LCBkYXR1bS5kYXRhc2V0TmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zZWxlY3Q6IGZ1bmN0aW9uIHNlbGVjdChkYXR1bSkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRRdWVyeShkYXR1bS52YWx1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldElucHV0VmFsdWUoZGF0dW0udmFsdWUsIHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKTsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigic2VsZWN0ZWQiLCBkYXR1bS5yYXcsIGRhdHVtLmRhdGFzZXROYW1lKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uY2xvc2UoKTsKICAgICAgICAgICAgICAgIF8uZGVmZXIoXy5iaW5kKHRoaXMuZHJvcGRvd24uZW1wdHksIHRoaXMuZHJvcGRvd24pKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldFZhbDogZnVuY3Rpb24gc2V0VmFsKHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNBY3RpdmF0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldElucHV0VmFsdWUodmFsKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRRdWVyeSh2YWwpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZSh2YWwsIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0VmFsOiBmdW5jdGlvbiBnZXRWYWwoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnB1dC5nZXRRdWVyeSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIGRlc3Ryb3lEb21TdHJ1Y3R1cmUodGhpcy4kbm9kZSk7CiAgICAgICAgICAgICAgICB0aGlzLiRub2RlID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBUeXBlYWhlYWQ7CiAgICAgICAgZnVuY3Rpb24gYnVpbGREb21TdHJ1Y3R1cmUoaW5wdXQsIHdpdGhIaW50KSB7CiAgICAgICAgICAgIHZhciAkaW5wdXQsICR3cmFwcGVyLCAkZHJvcGRvd24sICRoaW50OwogICAgICAgICAgICAkaW5wdXQgPSAkKGlucHV0KTsKICAgICAgICAgICAgJHdyYXBwZXIgPSAkKGh0bWwud3JhcHBlcikuY3NzKGNzcy53cmFwcGVyKTsKICAgICAgICAgICAgJGRyb3Bkb3duID0gJChodG1sLmRyb3Bkb3duKS5jc3MoY3NzLmRyb3Bkb3duKTsKICAgICAgICAgICAgJGhpbnQgPSAkaW5wdXQuY2xvbmUoKS5jc3MoY3NzLmhpbnQpLmNzcyhnZXRCYWNrZ3JvdW5kU3R5bGVzKCRpbnB1dCkpOwogICAgICAgICAgICAkaGludC52YWwoIiIpLnJlbW92ZURhdGEoKS5hZGRDbGFzcygidHQtaGludCIpLnJlbW92ZUF0dHIoImlkIG5hbWUgcGxhY2Vob2xkZXIiKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpLmF0dHIoewogICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlOiAib2ZmIiwKICAgICAgICAgICAgICAgIHNwZWxsY2hlY2s6ICJmYWxzZSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRpbnB1dC5kYXRhKGF0dHJzS2V5LCB7CiAgICAgICAgICAgICAgICBkaXI6ICRpbnB1dC5hdHRyKCJkaXIiKSwKICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogJGlucHV0LmF0dHIoImF1dG9jb21wbGV0ZSIpLAogICAgICAgICAgICAgICAgc3BlbGxjaGVjazogJGlucHV0LmF0dHIoInNwZWxsY2hlY2siKSwKICAgICAgICAgICAgICAgIHN0eWxlOiAkaW5wdXQuYXR0cigic3R5bGUiKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGlucHV0LmFkZENsYXNzKCJ0dC1pbnB1dCIpLmF0dHIoewogICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlOiAib2ZmIiwKICAgICAgICAgICAgICAgIHNwZWxsY2hlY2s6IGZhbHNlCiAgICAgICAgICAgIH0pLmNzcyh3aXRoSGludCA/IGNzcy5pbnB1dCA6IGNzcy5pbnB1dFdpdGhOb0hpbnQpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgISRpbnB1dC5hdHRyKCJkaXIiKSAmJiAkaW5wdXQuYXR0cigiZGlyIiwgImF1dG8iKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgcmV0dXJuICRpbnB1dC53cmFwKCR3cmFwcGVyKS5wYXJlbnQoKS5wcmVwZW5kKHdpdGhIaW50ID8gJGhpbnQgOiBudWxsKS5hcHBlbmQoJGRyb3Bkb3duKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ2V0QmFja2dyb3VuZFN0eWxlcygkZWwpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmRBdHRhY2htZW50OiAkZWwuY3NzKCJiYWNrZ3JvdW5kLWF0dGFjaG1lbnQiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDbGlwOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLWNsaXAiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJGVsLmNzcygiYmFja2dyb3VuZC1jb2xvciIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLWltYWdlIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kT3JpZ2luOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLW9yaWdpbiIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLXBvc2l0aW9uIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiAkZWwuY3NzKCJiYWNrZ3JvdW5kLXJlcGVhdCIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICRlbC5jc3MoImJhY2tncm91bmQtc2l6ZSIpCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lEb21TdHJ1Y3R1cmUoJG5vZGUpIHsKICAgICAgICAgICAgdmFyICRpbnB1dCA9ICRub2RlLmZpbmQoIi50dC1pbnB1dCIpOwogICAgICAgICAgICBfLmVhY2goJGlucHV0LmRhdGEoYXR0cnNLZXkpLCBmdW5jdGlvbih2YWwsIGtleSkgewogICAgICAgICAgICAgICAgXy5pc1VuZGVmaW5lZCh2YWwpID8gJGlucHV0LnJlbW92ZUF0dHIoa2V5KSA6ICRpbnB1dC5hdHRyKGtleSwgdmFsKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRpbnB1dC5kZXRhY2goKS5yZW1vdmVEYXRhKGF0dHJzS2V5KS5yZW1vdmVDbGFzcygidHQtaW5wdXQiKS5pbnNlcnRBZnRlcigkbm9kZSk7CiAgICAgICAgICAgICRub2RlLnJlbW92ZSgpOwogICAgICAgIH0KICAgIH0oKTsKICAgIChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgb2xkLCB0eXBlYWhlYWRLZXksIG1ldGhvZHM7CiAgICAgICAgb2xkID0gJC5mbi50eXBlYWhlYWQ7CiAgICAgICAgdHlwZWFoZWFkS2V5ID0gInR0VHlwZWFoZWFkIjsKICAgICAgICBtZXRob2RzID0gewogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG8sIGRhdGFzZXRzKSB7CiAgICAgICAgICAgICAgICBkYXRhc2V0cyA9IF8uaXNBcnJheShkYXRhc2V0cykgPyBkYXRhc2V0cyA6IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChhdHRhY2gpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gYXR0YWNoKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCBldmVudEJ1cywgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIF8uZWFjaChkYXRhc2V0cywgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgICAgICBkLmhpZ2hsaWdodCA9ICEhby5oaWdobGlnaHQ7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkID0gbmV3IFR5cGVhaGVhZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiAkaW5wdXQsCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50QnVzOiBldmVudEJ1cyA9IG5ldyBFdmVudEJ1cyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDogJGlucHV0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICB3aXRoSGludDogXy5pc1VuZGVmaW5lZChvLmhpbnQpID8gdHJ1ZSA6ICEhby5oaW50LAogICAgICAgICAgICAgICAgICAgICAgICBtaW5MZW5ndGg6IG8ubWluTGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBhdXRvc2VsZWN0OiBvLmF1dG9zZWxlY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBkYXRhc2V0cwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSwgdHlwZWFoZWFkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2gob3BlblR5cGVhaGVhZCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBvcGVuVHlwZWFoZWFkKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLm9wZW4oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goY2xvc2VUeXBlYWhlYWQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VUeXBlYWhlYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZhbDogZnVuY3Rpb24gdmFsKG5ld1ZhbCkgewogICAgICAgICAgICAgICAgcmV0dXJuICFhcmd1bWVudHMubGVuZ3RoID8gZ2V0VmFsKHRoaXMuZmlyc3QoKSkgOiB0aGlzLmVhY2goc2V0VmFsKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNldFZhbCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5zZXRWYWwobmV3VmFsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRWYWwoJGlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVhaGVhZCwgcXVlcnk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSB0eXBlYWhlYWQuZ2V0VmFsKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2godW5hdHRhY2gpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gdW5hdHRhY2goKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgICAgICAkaW5wdXQucmVtb3ZlRGF0YSh0eXBlYWhlYWRLZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgJC5mbi50eXBlYWhlYWQgPSBmdW5jdGlvbihtZXRob2QpIHsKICAgICAgICAgICAgaWYgKG1ldGhvZHNbbWV0aG9kXSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHNbbWV0aG9kXS5hcHBseSh0aGlzLCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAkLmZuLnR5cGVhaGVhZC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gbm9Db25mbGljdCgpIHsKICAgICAgICAgICAgJC5mbi50eXBlYWhlYWQgPSBvbGQ7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CiAgICB9KSgpOwp9KSh3aW5kb3cualF1ZXJ5KTsKZGVmaW5lKCJ0eXBlYWhlYWQiLCBmdW5jdGlvbigpe30pOwoKLyohCiAqIGpRdWVyeSBDb29raWUgUGx1Z2luIHYxLjQuMAogKiBodHRwczovL2dpdGh1Yi5jb20vY2FyaGFydGwvanF1ZXJ5LWNvb2tpZQogKgogKiBDb3B5cmlnaHQgMjAxMyBLbGF1cyBIYXJ0bAogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICovCihmdW5jdGlvbiAoZmFjdG9yeSkgewoJaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewoJCS8vIEFNRC4gUmVnaXN0ZXIgYXMgYW5vbnltb3VzIG1vZHVsZS4KCQlkZWZpbmUoJ2pRdWVyeUNvb2tpZScsWydqcXVlcnknXSwgZmFjdG9yeSk7Cgl9IGVsc2UgewoJCS8vIEJyb3dzZXIgZ2xvYmFscy4KCQlmYWN0b3J5KGpRdWVyeSk7Cgl9Cn0oZnVuY3Rpb24gKCQpIHsKCgl2YXIgcGx1c2VzID0gL1wrL2c7CgoJZnVuY3Rpb24gZW5jb2RlKHMpIHsKCQlyZXR1cm4gY29uZmlnLnJhdyA/IHMgOiBlbmNvZGVVUklDb21wb25lbnQocyk7Cgl9CgoJZnVuY3Rpb24gZGVjb2RlKHMpIHsKCQlyZXR1cm4gY29uZmlnLnJhdyA/IHMgOiBkZWNvZGVVUklDb21wb25lbnQocyk7Cgl9CgoJZnVuY3Rpb24gc3RyaW5naWZ5Q29va2llVmFsdWUodmFsdWUpIHsKCQlyZXR1cm4gZW5jb2RlKGNvbmZpZy5qc29uID8gSlNPTi5zdHJpbmdpZnkodmFsdWUpIDogU3RyaW5nKHZhbHVlKSk7Cgl9CgoJZnVuY3Rpb24gcGFyc2VDb29raWVWYWx1ZShzKSB7CgkJaWYgKHMuaW5kZXhPZignIicpID09PSAwKSB7CgkJCS8vIFRoaXMgaXMgYSBxdW90ZWQgY29va2llIGFzIGFjY29yZGluZyB0byBSRkMyMDY4LCB1bmVzY2FwZS4uLgoJCQlzID0gcy5zbGljZSgxLCAtMSkucmVwbGFjZSgvXFwiL2csICciJykucmVwbGFjZSgvXFxcXC9nLCAnXFwnKTsKCQl9CgoJCXRyeSB7CgkJCS8vIFJlcGxhY2Ugc2VydmVyLXNpZGUgd3JpdHRlbiBwbHVzZXMgd2l0aCBzcGFjZXMuCgkJCS8vIElmIHdlIGNhbid0IGRlY29kZSB0aGUgY29va2llLCBpZ25vcmUgaXQsIGl0J3MgdW51c2FibGUuCgkJCXMgPSBkZWNvZGVVUklDb21wb25lbnQocy5yZXBsYWNlKHBsdXNlcywgJyAnKSk7CgkJfSBjYXRjaChlKSB7CgkJCXJldHVybjsKCQl9CgoJCXRyeSB7CgkJCS8vIElmIHdlIGNhbid0IHBhcnNlIHRoZSBjb29raWUsIGlnbm9yZSBpdCwgaXQncyB1bnVzYWJsZS4KCQkJcmV0dXJuIGNvbmZpZy5qc29uID8gSlNPTi5wYXJzZShzKSA6IHM7CgkJfSBjYXRjaChlKSB7fQoJfQoKCWZ1bmN0aW9uIHJlYWQocywgY29udmVydGVyKSB7CgkJdmFyIHZhbHVlID0gY29uZmlnLnJhdyA/IHMgOiBwYXJzZUNvb2tpZVZhbHVlKHMpOwoJCXJldHVybiAkLmlzRnVuY3Rpb24oY29udmVydGVyKSA/IGNvbnZlcnRlcih2YWx1ZSkgOiB2YWx1ZTsKCX0KCgl2YXIgY29uZmlnID0gJC5jb29raWUgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgb3B0aW9ucykgewoKCQkvLyBXcml0ZQoJCWlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmICEkLmlzRnVuY3Rpb24odmFsdWUpKSB7CgkJCW9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgY29uZmlnLmRlZmF1bHRzLCBvcHRpb25zKTsKCgkJCWlmICh0eXBlb2Ygb3B0aW9ucy5leHBpcmVzID09PSAnbnVtYmVyJykgewoJCQkJdmFyIGRheXMgPSBvcHRpb25zLmV4cGlyZXMsIHQgPSBvcHRpb25zLmV4cGlyZXMgPSBuZXcgRGF0ZSgpOwoJCQkJdC5zZXREYXRlKHQuZ2V0RGF0ZSgpICsgZGF5cyk7CgkJCX0KCgkJCXJldHVybiAoZG9jdW1lbnQuY29va2llID0gWwoJCQkJZW5jb2RlKGtleSksICc9Jywgc3RyaW5naWZ5Q29va2llVmFsdWUodmFsdWUpLAoJCQkJb3B0aW9ucy5leHBpcmVzID8gJzsgZXhwaXJlcz0nICsgb3B0aW9ucy5leHBpcmVzLnRvVVRDU3RyaW5nKCkgOiAnJywgLy8gdXNlIGV4cGlyZXMgYXR0cmlidXRlLCBtYXgtYWdlIGlzIG5vdCBzdXBwb3J0ZWQgYnkgSUUKCQkJCW9wdGlvbnMucGF0aCAgICA/ICc7IHBhdGg9JyArIG9wdGlvbnMucGF0aCA6ICcnLAoJCQkJb3B0aW9ucy5kb21haW4gID8gJzsgZG9tYWluPScgKyBvcHRpb25zLmRvbWFpbiA6ICcnLAoJCQkJb3B0aW9ucy5zZWN1cmUgID8gJzsgc2VjdXJlJyA6ICcnCgkJCV0uam9pbignJykpOwoJCX0KCgkJLy8gUmVhZAoKCQl2YXIgcmVzdWx0ID0ga2V5ID8gdW5kZWZpbmVkIDoge307CgoJCS8vIFRvIHByZXZlbnQgdGhlIGZvciBsb29wIGluIHRoZSBmaXJzdCBwbGFjZSBhc3NpZ24gYW4gZW1wdHkgYXJyYXkKCQkvLyBpbiBjYXNlIHRoZXJlIGFyZSBubyBjb29raWVzIGF0IGFsbC4gQWxzbyBwcmV2ZW50cyBvZGQgcmVzdWx0IHdoZW4KCQkvLyBjYWxsaW5nICQuY29va2llKCkuCgkJdmFyIGNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUgPyBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsgJykgOiBbXTsKCgkJZm9yICh2YXIgaSA9IDAsIGwgPSBjb29raWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewoJCQl2YXIgcGFydHMgPSBjb29raWVzW2ldLnNwbGl0KCc9Jyk7CgkJCXZhciBuYW1lID0gZGVjb2RlKHBhcnRzLnNoaWZ0KCkpOwoJCQl2YXIgY29va2llID0gcGFydHMuam9pbignPScpOwoKCQkJaWYgKGtleSAmJiBrZXkgPT09IG5hbWUpIHsKCQkJCS8vIElmIHNlY29uZCBhcmd1bWVudCAodmFsdWUpIGlzIGEgZnVuY3Rpb24gaXQncyBhIGNvbnZlcnRlci4uLgoJCQkJcmVzdWx0ID0gcmVhZChjb29raWUsIHZhbHVlKTsKCQkJCWJyZWFrOwoJCQl9CgoJCQkvLyBQcmV2ZW50IHN0b3JpbmcgYSBjb29raWUgdGhhdCB3ZSBjb3VsZG4ndCBkZWNvZGUuCgkJCWlmICgha2V5ICYmIChjb29raWUgPSByZWFkKGNvb2tpZSkpICE9PSB1bmRlZmluZWQpIHsKCQkJCXJlc3VsdFtuYW1lXSA9IGNvb2tpZTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJlc3VsdDsKCX07CgoJY29uZmlnLmRlZmF1bHRzID0ge307CgoJJC5yZW1vdmVDb29raWUgPSBmdW5jdGlvbiAoa2V5LCBvcHRpb25zKSB7CgkJaWYgKCQuY29va2llKGtleSkgIT09IHVuZGVmaW5lZCkgewoJCQkvLyBNdXN0IG5vdCBhbHRlciBvcHRpb25zLCB0aHVzIGV4dGVuZGluZyBhIGZyZXNoIG9iamVjdC4uLgoJCQkkLmNvb2tpZShrZXksICcnLCAkLmV4dGVuZCh7fSwgb3B0aW9ucywgeyBleHBpcmVzOiAtMSB9KSk7CgkJCXJldHVybiB0cnVlOwoJCX0KCQlyZXR1cm4gZmFsc2U7Cgl9OwoKfSkpOwoKLyoKICogZ2l2ZW4gYSBwYXJ0aWFsIFJpY2hTZXF1ZW5jZSBzdHJpbmcsIHJldHVybiB2YWx1ZSBhdXRvY29tcGxldGlvbiB2YWx1ZXMuCiAqIFRoaXMgY2FuIGNvdmVyOgogKiAtIGdpdmUgbWUgYSBudW1lcmljYWwgdmFsdWUsIEknbGwgcmV0dXJuIGNsb3NlIG1vZGlmaWNhdGlvbiBsaXN0CiAqIC0gZ2l2ZSBtZSBhIHBhcnRpYWwgbW9kaWZpY2F0aW9uIG5hbWUsIEknbGwgc2hvb3QgdGhlIG1hdGNoaW5nIG1vZGlmaWNhdGlvbnMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9SaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5J10sIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgZGljb0FBLCBkaWNvUmVzTW9kKSB7CgogICAgdmFyIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYubW9kaWZOYW1lcyA9IF8uY2hhaW4oZGljb1Jlc01vZC5tb2RlbHMpLmNvbGxlY3QoZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgIHJldHVybiBybS5nZXQoJ25hbWUnKQogICAgICAgIH0pLnNvcnQoKS52YWx1ZSgpOwoKICAgICAgICBzZWxmLm1vZGlmMm1hc3MgPSB7fQogICAgICAgIF8uZWFjaChkaWNvUmVzTW9kLm1vZGVscywgZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgIHNlbGYubW9kaWYybWFzc1tybS5nZXQoJ25hbWUnKV0gPSBybS5nZXQoJ21hc3MnKQogICAgICAgIH0pCiAgICB9OwoKICAgIC8qKgogICAgICogcmV0dXJuIGEgdHJ1ZSB2YWx1ZSBpZiB0aGUgY3VycmVudCB0aGVyZSBpcyBub3QgY2xvc2VlZCBjdXJseSBicmFja2V0IGJlZm9yZSB0aGUgbmV4dCBvcGVuIG9yIHRoZSBlbmQKICAgICAqIChpLmUuLCBpZiB3ZSBjYWxsIHRoYXQgZnVuY2l0b24gZnRlciBvcGVuaW5nIGEgY3VscnksIGl0IHdpbGwgdXMgaWYgd2Ugc2hhbGwgYWRkIGEgY29zZSBvbmUpCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdHh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9zCiAgICAgKi8KICAgIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIucHJvdG90eXBlLmNsb3NlQ3VybHkgPSBmdW5jdGlvbiAodHh0LCBwb3MpIHsKICAgICAgICB2YXIgdGFpbCA9IHR4dC5zdWJzdHJpbmcocG9zKQogICAgICAgIGlmICh0YWlsLmluZGV4T2YoJ30nKSA8IDAgfHwgKHRhaWwuaW5kZXhPZigneycpID4gMCkgJiYgKHRhaWwuaW5kZXhPZignfScpID4gdGFpbC5pbmRleE9mKCd7JykpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICAvKioKICAgICAqIGdpdmVuIGEgdGV4dCBhbmQgYSBwb3N0aW9uLCBleHRyYWN0IHRoZSBwcmVmaXggdGhhdCB3aWxsIGJlIHVzZWQgYXMgYSBhbmNob3IgZm9yIGF1dG9jb21wbGV0aW9uLCBhcyB3ZWxsIGFzIHRoZSB0ZXh0IHBvc2l0aW9uIHRvIGJlIHJlcGxhY2VkIGJ5IHRoZSBhdXRvY29tcGxldGlvbmVyCiAgICAgKiBUaGluayB0aGF0IHdlIGNhbiBjb21lIGJhY2sgaW50byAgY3VybHkgYnJhY2tldHMgYW5kIHdlIHN0aWxsIHdhbnQgc29tZSBjb21wbGV0aW9uCiAgICAgKiByZXR1cm4gbnVsbCBpcyB3ZSBhcmUgbm90IGF0IGEgcG9zaXRpb24gdG8gZ2V0IGFueSByZXBsYWNlbWVudAogICAgICoKICAgICAqIGdvIGNoZWNrIGphc21pbmUgUmljaFNlcXVlbmNlQXV0b0NvbXBsZXRpb25lciUyMHJlcGxhY2VhYmxlIHRvIGdldCB0b25zIG9mIGV4YW1wbGVzCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdHh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9zCiAgICAgKi8KICAgIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIucHJvdG90eXBlLnJlcGxhY2VhYmxlID0gZnVuY3Rpb24gKHR4dCwgcG9zKSB7CiAgICAgICAgdmFyIGJlZm9yZSA9IHR4dC5zdWJzdHJpbmcoMCwgcG9zKQogICAgICAgIHZhciBhZnRlciA9IHR4dC5zdWJzdHJpbmcocG9zKQoKICAgICAgICBpZiAoYmVmb3JlLmluZGV4T2YoJ3snKSA8IDApIHsKICAgICAgICAgICAgLy9ub3QgZXZlbiBhbiBvcGVuIGN1cmx5LCBkb24ndCB3YXN0ZSBteSB0aW1lCiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQoKICAgICAgICBiZWZvcmUgPSBiZWZvcmUucmVwbGFjZSgvLipcfS8sICcnKTsKICAgICAgICBpZiAoYmVmb3JlLmluZGV4T2YoJ3snKSA8IDApIHsKICAgICAgICAgICAgLy93ZSBhcmUgbm90IGFmdGVyIGFuIG9wZW4gY3VybHkgYnJhY2tldAogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgYmVmb3JlID0gYmVmb3JlLnJlcGxhY2UoLy4qW1x7LF0vLCAnJyk7CgogICAgICAgIGFmdGVyID0gYWZ0ZXIucmVwbGFjZSgvW1x9LF0uKi8sICcnKTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlZml4OiBiZWZvcmUsCiAgICAgICAgICAgIHBvc1N0YXJ0OiBwb3MgLSBiZWZvcmUubGVuZ3RoLAogICAgICAgICAgICBwb3NFbmQ6IHBvcyArIGFmdGVyLmxlbmd0aAogICAgICAgIH0KCiAgICB9OwoKICAgIC8qKgogICAgICogZ2V0IHRoZSBsaXN0IG9mIG1vZGlmY2F0aW9uIG1hYXRjaGluZyB0aGUgcHJlZml4LiBpLmUuCiAgICAgKiBzdGFydGluZyB3aXRoIHRoZSBwcmVmaXgKICAgICAqIGNhc2UgaXMgbm90IGltcG9ydGFudAogICAgICogcHJlZml4IGNhbiBiZSBhIG1hc3MgKCsvLSAxIERhKQogICAgICogQHBhcmFtIHtPYmplY3R9IHByZWZpeAogICAgICovCiAgICBSaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyLnByb3RvdHlwZS5nZXRMaXN0ID0gZnVuY3Rpb24gKHByZWZpeCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIG1hc3MgPSBwYXJzZUZsb2F0KHByZWZpeCkKICAgICAgICBpZiAoXy5pc0Zpbml0ZShtYXNzKSkgewogICAgICAgICAgICB2YXIgbUluZiA9IG1hc3MgLSAxLjAKICAgICAgICAgICAgdmFyIG1TdXAgPSBtYXNzICsgMS4wCiAgICAgICAgICAgIHJldHVybiBfLmNoYWluKHNlbGYubW9kaWYybWFzcykuY29sbGVjdChmdW5jdGlvbiAobWFzcywgbmFtZSkgewogICAgICAgICAgICAgICAgaWYgKG1hc3MgPCBtSW5mIHx8IG1hc3MgPiBtU3VwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuYW1lCiAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgcmV0dXJuIG4gIT0gbnVsbAogICAgICAgICAgICB9KS52YWx1ZSgpCiAgICAgICAgfQoKICAgICAgICBwcmVmaXggPSBwcmVmaXgudG9Mb3dlckNhc2UoKTsKICAgICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5tb2RpZk5hbWVzLCBmdW5jdGlvbiAobikgewogICAgICAgICAgICByZXR1cm4gbi50b0xvd2VyQ2FzZSgpLmluZGV4T2YocHJlZml4KSA9PSAwCiAgICAgICAgfSkKICAgIH0KICAgIHJldHVybiBSaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyOwp9KTsKCi8qCiBSZXF1aXJlSlMgdGV4dCAwLjI3LjAgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KIEF2YWlsYWJsZSB2aWEgdGhlIE1JVCBvciBuZXcgQlNEIGxpY2Vuc2UuCiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvcmVxdWlyZWpzIGZvciBkZXRhaWxzCiovCihmdW5jdGlvbigpe3ZhciBrPVsiTXN4bWwyLlhNTEhUVFAiLCJNaWNyb3NvZnQuWE1MSFRUUCIsIk1zeG1sMi5YTUxIVFRQLjQuMCJdLG49L15ccyo8XD94bWwoXHMpK3ZlcnNpb249W1wnXCJdKFxkKSouKFxkKSpbXCdcIl0oXHMpKlw/Pi9pbSxvPS88Ym9keVtePl0qPlxzKihbXHNcU10rKVxzKjxcL2JvZHk+L2ltLGk9dHlwZW9mIGxvY2F0aW9uIT09InVuZGVmaW5lZCImJmxvY2F0aW9uLmhyZWYscD1pJiZsb2NhdGlvbi5wcm90b2NvbCYmbG9jYXRpb24ucHJvdG9jb2wucmVwbGFjZSgvXDovLCIiKSxxPWkmJmxvY2F0aW9uLmhvc3RuYW1lLHI9aSYmKGxvY2F0aW9uLnBvcnR8fHZvaWQgMCksaj1bXTtkZWZpbmUoJ3RleHQnLFtdLGZ1bmN0aW9uKCl7dmFyIGcsaCxsO3R5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIiYmd2luZG93Lm5hdmlnYXRvciYmd2luZG93LmRvY3VtZW50P2g9ZnVuY3Rpb24oYSxiKXt2YXIgYz1nLmNyZWF0ZVhocigpO2Mub3BlbigiR0VUIixhLCEwKTtjLm9ucmVhZHlzdGF0ZWNoYW5nZT0KZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU9PT00JiZiKGMucmVzcG9uc2VUZXh0KX07Yy5zZW5kKG51bGwpfTp0eXBlb2YgcHJvY2VzcyE9PSJ1bmRlZmluZWQiJiZwcm9jZXNzLnZlcnNpb25zJiZwcm9jZXNzLnZlcnNpb25zLm5vZGU/KGw9cmVxdWlyZS5ub2RlUmVxdWlyZSgiZnMiKSxoPWZ1bmN0aW9uKGEsYil7YihsLnJlYWRGaWxlU3luYyhhLCJ1dGY4IikpfSk6dHlwZW9mIFBhY2thZ2VzIT09InVuZGVmaW5lZCImJihoPWZ1bmN0aW9uKGEsYil7dmFyIGM9bmV3IGphdmEuaW8uRmlsZShhKSxlPWphdmEubGFuZy5TeXN0ZW0uZ2V0UHJvcGVydHkoImxpbmUuc2VwYXJhdG9yIiksYz1uZXcgamF2YS5pby5CdWZmZXJlZFJlYWRlcihuZXcgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRlcihuZXcgamF2YS5pby5GaWxlSW5wdXRTdHJlYW0oYyksInV0Zi04IikpLGQsZixnPSIiO3RyeXtkPW5ldyBqYXZhLmxhbmcuU3RyaW5nQnVmZmVyOyhmPWMucmVhZExpbmUoKSkmJmYubGVuZ3RoKCkmJgpmLmNoYXJBdCgwKT09PTY1Mjc5JiYoZj1mLnN1YnN0cmluZygxKSk7Zm9yKGQuYXBwZW5kKGYpOyhmPWMucmVhZExpbmUoKSkhPT1udWxsOylkLmFwcGVuZChlKSxkLmFwcGVuZChmKTtnPVN0cmluZyhkLnRvU3RyaW5nKCkpfWZpbmFsbHl7Yy5jbG9zZSgpfWIoZyl9KTtyZXR1cm4gZz17dmVyc2lvbjoiMC4yNy4wIixzdHJpcDpmdW5jdGlvbihhKXtpZihhKXt2YXIgYT1hLnJlcGxhY2UobiwiIiksYj1hLm1hdGNoKG8pO2ImJihhPWJbMV0pfWVsc2UgYT0iIjtyZXR1cm4gYX0sanNFc2NhcGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvKFsnXFxdKS9nLCJcXCQxIikucmVwbGFjZSgvW1xmXS9nLCJcXGYiKS5yZXBsYWNlKC9bXGJdL2csIlxcYiIpLnJlcGxhY2UoL1tcbl0vZywiXFxuIikucmVwbGFjZSgvW1x0XS9nLCJcXHQiKS5yZXBsYWNlKC9bXHJdL2csIlxcciIpfSxjcmVhdGVYaHI6ZnVuY3Rpb24oKXt2YXIgYSxiLGM7aWYodHlwZW9mIFhNTEh0dHBSZXF1ZXN0IT09CiJ1bmRlZmluZWQiKXJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3Q7ZWxzZSBmb3IoYj0wO2I8MztiKyspe2M9a1tiXTt0cnl7YT1uZXcgQWN0aXZlWE9iamVjdChjKX1jYXRjaChlKXt9aWYoYSl7az1bY107YnJlYWt9fWlmKCFhKXRocm93IEVycm9yKCJjcmVhdGVYaHIoKTogWE1MSHR0cFJlcXVlc3Qgbm90IGF2YWlsYWJsZSIpO3JldHVybiBhfSxnZXQ6aCxwYXJzZU5hbWU6ZnVuY3Rpb24oYSl7dmFyIGI9ITEsYz1hLmluZGV4T2YoIi4iKSxlPWEuc3Vic3RyaW5nKDAsYyksYT1hLnN1YnN0cmluZyhjKzEsYS5sZW5ndGgpLGM9YS5pbmRleE9mKCIhIik7YyE9PS0xJiYoYj1hLnN1YnN0cmluZyhjKzEsYS5sZW5ndGgpLGI9Yj09PSJzdHJpcCIsYT1hLnN1YnN0cmluZygwLGMpKTtyZXR1cm57bW9kdWxlTmFtZTplLGV4dDphLHN0cmlwOmJ9fSx4ZFJlZ0V4cDovXigoXHcrKVw6KT9cL1wvKFteXC9cXF0rKS8sdXNlWGhyOmZ1bmN0aW9uKGEsYixjLGUpe3ZhciBkPWcueGRSZWdFeHAuZXhlYyhhKSwKZjtpZighZClyZXR1cm4hMDthPWRbMl07ZD1kWzNdO2Q9ZC5zcGxpdCgiOiIpO2Y9ZFsxXTtkPWRbMF07cmV0dXJuKCFhfHxhPT09YikmJighZHx8ZD09PWMpJiYoIWYmJiFkfHxmPT09ZSl9LGZpbmlzaExvYWQ6ZnVuY3Rpb24oYSxiLGMsZSxkKXtjPWI/Zy5zdHJpcChjKTpjO2QuaXNCdWlsZCYmZC5pbmxpbmVUZXh0JiYoalthXT1jKTtlKGMpfSxsb2FkOmZ1bmN0aW9uKGEsYixjLGUpe3ZhciBkPWcucGFyc2VOYW1lKGEpLGY9ZC5tb2R1bGVOYW1lKyIuIitkLmV4dCxtPWIudG9VcmwoZiksaD1lJiZlLnRleHQmJmUudGV4dC51c2VYaHJ8fGcudXNlWGhyOyFpfHxoKG0scCxxLHIpP2cuZ2V0KG0sZnVuY3Rpb24oYil7Zy5maW5pc2hMb2FkKGEsZC5zdHJpcCxiLGMsZSl9KTpiKFtmXSxmdW5jdGlvbihhKXtnLmZpbmlzaExvYWQoZC5tb2R1bGVOYW1lKyIuIitkLmV4dCxkLnN0cmlwLGEsYyxlKX0pfSx3cml0ZTpmdW5jdGlvbihhLGIsYyl7aWYoYiBpbiBqKXt2YXIgZT1nLmpzRXNjYXBlKGpbYl0pOwpjLmFzTW9kdWxlKGErIiEiK2IsImRlZmluZShmdW5jdGlvbiAoKSB7IHJldHVybiAnIitlKyInO30pO1xuIil9fSx3cml0ZUZpbGU6ZnVuY3Rpb24oYSxiLGMsZSxkKXt2YXIgYj1nLnBhcnNlTmFtZShiKSxmPWIubW9kdWxlTmFtZSsiLiIrYi5leHQsaD1jLnRvVXJsKGIubW9kdWxlTmFtZSsiLiIrYi5leHQpKyIuanMiO2cubG9hZChmLGMsZnVuY3Rpb24oKXt2YXIgYj1mdW5jdGlvbihhKXtyZXR1cm4gZShoLGEpfTtiLmFzTW9kdWxlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGUuYXNNb2R1bGUoYSxoLGIpfTtnLndyaXRlKGEsZixiLGQpfSxkKX19fSl9KSgpOwoKZGVmaW5lKCd0ZXh0IWZpc2h0b25lcy10ZW1wbGF0ZXMvZHJ5L2Zvcm1zL3JpY2hzZXF1ZW5jZS1pbnB1dC5odG1sJyxbXSxmdW5jdGlvbiAoKSB7IHJldHVybiAnPGRpdiBjbGFzcz0iaW5wdXQtYXBwZW5kIiBzdHlsZT0id2lkdGg6MTAwJSI+XG4gICAgPHNwYW4gY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tcXVlc3Rpb24tc2lnbiI+PC9zcGFuPlxuICAgIDxpbnB1dCBpZD0ie3tpbnB1dElkfX0iIHR5cGU9InRleHQiIGNsYXNzPSJ7e2lucHV0Q2xhc3N9fSIgcGxhY2Vob2xkZXI9Int7cGxhY2Vob2xkZXJ9fSJcbiAgICAgICAgICAgdmFsdWU9Int7dmFsdWV9fSIvPlxuXG4gICAgPGJ1dHRvbiBpZD0ie3tidXR0b25JZH19IiBjbGFzcz0ie3tidXR0b25DbGFzc319IiB0eXBlPSJidXR0b24iPnt7YnV0dG9uVGV4dH19PC9idXR0b24+XG4gICAgPHNwYW4gaWQ9Int7dmFsaWRJbmRpY2F0b3JJZH19IiBjbGFzcz0iYmFkZ2UgYmFkZ2UtaW1wb3J0YW50Ij5YPC9zcGFuPlxuPC9kaXY+Jzt9KTsKCi8qKgogKiBJbnB1dCBmaWVsZCBmb3IgIFJpY2hTZXF1ZW5jZSwgd2l0aCBhdXRvY29tcGxldGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvZHJ5L2Zvcm1zL1JpY2hTZXF1ZW5jZUlucHV0JyxbJ2pxdWVyeS1wbHVzJywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvUmljaFNlcXVlbmNlU2hvcnRjdXRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXInLCAndGV4dCFmaXNodG9uZXMtdGVtcGxhdGVzL2RyeS9mb3Jtcy9yaWNoc2VxdWVuY2UtaW5wdXQuaHRtbCddLAogICAgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBSaWNoU2VxdWVuY2UsIFJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIsIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIsIHRtcGwpIHsKCiAgICAgICAgUmljaFNlcXVlbmNlSW5wdXQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAgICAgaWYgKCFzZWxmLm1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2RlbCA9IG5ldyBSaWNoU2VxdWVuY2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vaW5pdGlhbGl6YXRpb24gcGVyIHNlCiAgICAgICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIgPSBuZXcgUmljaFNlcXVlbmNlU2hvcnRjdXRlcigpOwogICAgICAgICAgICAgICAgc2VsZi5hdXRvQ29tcGxldGlvbmVyID0gbmV3IFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIoKQogICAgICAgICAgICAgICAgc2VsZi5jYWxsYmFja3NJbnZhbGlkID0gW107CiAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrc1ZhbGlkID0gW107CiAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrc0NsZWFyID0gW107CgogICAgICAgICAgICAgICAgc2VsZi5hY3Rpb24gPSBvcHRpb25zICYmIG9wdGlvbnMuYWN0aW9uOwoKICAgICAgICAgICAgICAgIC8vZG9tIGNvbnN0cnVjdGlvbgogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSAkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdIM0s0LCBIMy4xSzE4QWMsIEgzLjFLMThBY0syM01lMiwgS1FUQVIsIEtBY1FUQVIsIEt7QWNldHlsYXRpb24sTWV0aHlsYXRpb259UVRBUntNZXRoeWxhdGlvbn0nLAogICAgICAgICAgICAgICAgICAgIGlucHV0Q2xhc3M6ICdmb3JtLWNvbnRyb2wnLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgICAgICAgICAgICBpbnB1dElkOiAncnNpLWlucHV0LScgKyBzZWxmLmNpZCwKICAgICAgICAgICAgICAgICAgICBidXR0b25DbGFzczogJ2J0bicsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uSWQ6ICdyc2ktYnV0LScgKyBzZWxmLmNpZCwKICAgICAgICAgICAgICAgICAgICBidXR0b25UZXh0OiAnYWN0aW9uJywKICAgICAgICAgICAgICAgICAgICBoaWRlQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBoaWRlVmFsaWRJbmRpY2F0b3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdmFsaWRJbmRpY2F0b3JJZDogJ3JzaS1iYWRnZS0nICsgc2VsZi5jaWQKICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMpOwoKICAgICAgICAgICAgICAgIHZhciBjb250ID0gJChzZWxmLmVsKS5hcHBlbmQoJChfLnRlbXBsYXRlKHRtcGwsIGFyZ3MpKSk7CiAgICAgICAgICAgICAgICBzZWxmLmVsSW5wdXQgPSBjb250LmZpbmQoJ2lucHV0Jyk7CiAgICAgICAgICAgICAgICBzZWxmLmVsQnV0dG9uID0gY29udC5maW5kKCdidXR0b24nKTsKICAgICAgICAgICAgICAgIHNlbGYuaGlkZUluZGljYXRvciA9IGNvbnQuZmluZCgnc3Bhbi5iYWRnZScpCgoKICAgICAgICAgICAgICAgIGlmIChhcmdzLmhpZGVCdXR0b24pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmVsQnV0dG9uLmhpZGUoKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGlkZVZhbGlkSW5kaWNhdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oaWRlSW5kaWNhdG9yLmhpZGUoKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHNlbGYuZWxJY29uID0gY29udC5maW5kKCdzcGFuLmdseXBoaWNvbicpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHZhciB0b3RhbFdpZHRoID0gJChzZWxmLmVsKS53aWR0aCgpOwogICAgICAgICAgICAgICAgICAgIHRvdGFsV2lkdGgtPXNlbGYuZWxCdXR0b24ub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT1zZWxmLmhpZGVJbmRpY2F0b3Iub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT0gc2VsZi5lbEljb24ub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT0yMAoKICAgICAgICAgICAgICAgICAgICBzZWxmLmVsSW5wdXQud2lkdGgoJycrdG90YWxXaWR0aCsncHgnKTsKICAgICAgICAgICAgICAgIH0sMCk7CgogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnZhbChzZWxmLm1vZGVsLnRvU3RyaW5nKCkpCgogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnR5cGVhaGVhZCh7CiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBmdW5jdGlvbiAodHh0LCBwcm9jZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQucmVwbGFjZUNvbnRleHQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcENhcmV0ID0gc2VsZi5lbElucHV0WzBdLnNlbGVjdGlvblN0YXJ0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnNlcnRlZENoYXIgPSB0eHQuY2hhckF0KHBDYXJldCAtIDEpCgogICAgICAgICAgICAgICAgICAgICAgICAvL2Nsb3NlIHRoZSBjdXJseSBicmFja2V0IGlmIG5lZWRlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zZXJ0ZWRDaGFyID09ICd7JyAmJiBzZWxmLmF1dG9Db21wbGV0aW9uZXIuY2xvc2VDdXJseSh0eHQsIHBDYXJldCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWxJbnB1dC52YWwodHh0LnN1YnN0cmluZygwLCBwQ2FyZXQpICsgJ30nICsgdHh0LnN1YnN0cmluZyhwQ2FyZXQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRDYXJldEF0KHBDYXJldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcGxhY2UgPSBzZWxmLmF1dG9Db21wbGV0aW9uZXIucmVwbGFjZWFibGUodHh0LCBwQ2FyZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlLnByZWZpeC5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dCA9IHJlcGxhY2UKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYXV0b0NvbXBsZXRpb25lci5nZXRMaXN0KHJlcGxhY2UucHJlZml4KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZXI6IGZ1bmN0aW9uICh0eHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVhaGVhZCA9IHRoaXM7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5lbElucHV0LnZhbCgpLnN1YnN0cmluZygwLCB0eXBlYWhlYWQucmVwbGFjZUNvbnRleHQucG9zU3RhcnQpICsgJzxiPicgKyB0eHQgKyAnPC9iPicgKyBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NFbmQpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB1cGRhdGVyOiBmdW5jdGlvbiAodHh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldENhcmV0U2VsZWN0aW9uKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NTdGFydCwgdHlwZWFoZWFkLnJlcGxhY2VDb250ZXh0LnBvc0VuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdWYWwgPSBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKDAsIHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NTdGFydCkgKyB0eHQgKyBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NFbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWxJbnB1dC52YWwobmV3VmFsKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdWYWwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIHZhciBwb3AgPSBzZWxmLmVsSWNvbi5wb3BvdmVyKHsKICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6ICJib3R0b20iLAogICAgICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ2hvdmVyJywKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0hvdyB0byBlbnRlciBhIHBlcHRpZGUgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0ibW9kYWwiIGFyaWEtaGlkZGVuPSJ0cnVlIicsCgogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICJUaGVyZSBpcyBtb3JlIHRoYW4gb25lIHdheSB0byBkbyBpdDo8dWw+IDxsaT5zaG9ydGN1dCBhcyA8Y29kZT5IM0s5PC9jb2RlPiBvciA8Y29kZT5IMy4xSzI3PC9jb2RlPjwvbGk+PGxpPnNob3J0Y3V0IHdpdGggbW9kaWZpY2F0aW9uIGFzIDxjb2RlPkgzSzlNZTI8L2NvZGU+PC9saT48bGk+YXMgc2VxdWVuY2Ugd2l0aCBzaG9ydCBtb2RpZmljYXRpb24gPGNvZGU+UUtBY1RBUk1lPC9jb2RlPjwvbGk+PGxpPndpdGggbG9uZyB2ZXJzaW9uIG1vZGlmaWNhdGlvbiA8Y29kZT5RS3tBY2V0eWx9VEFSPC9jb2RlPjwvbGk+PGxpPndpdGggZXhwbGljaXQgbWFzcyA8Y29kZT5QRVB7MTIzNC41Njd9VElERU1lPC9jb2RlPjwvbGk+PGxpPmluIGNvbnRleHQgPGNvZGU+Ui5RS1RBUi5LPC9jb2RlPjwvbGk+PC91bD5UaGUgbW9kaWZpY2F0aW9uIGxpc3QgY2FuIGJlIGZvdW5kIDxhIGhyZWY9Jyc+c29vbjwvYT4iCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnZhbChzZWxmLm1vZGVsLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgc2VsZi5kZWxlZ2F0ZUV2ZW50cyh7CiAgICAgICAgICAgICAgICAgICAgJ2lucHV0JzogJ3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgJ2tleXByZXNzIGlucHV0JzogJ2lucHV0S2V5UHJlc3NlZCcsCiAgICAgICAgICAgICAgICAgICAgJ2NsaWNrIGJ1dHRvbic6ICdjYWxsQWN0aW9uJwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIHNlbGYub24oJ2NoYW5nZTppbnB1dCcsIGZ1bmN0aW9uKCl7c2VsZi51cGRhdGUoKX0pOwogICAgICAgICAgICAgICAgLy8gc2VsZi5vbigna2V5cHJlc3M6aW5wdXQnLCBmdW5jdGlvbigpe3NlbGYuaW5wdXRLZXlQcmVzc2VkKCl9KTsKICAgICAgICAgICAgICAgIC8vIHNlbGYub24oJ2J1dHRvbjpjbGljaycsIGZ1bmN0aW9uKCl7c2VsZi5jYWxsQWN0aW9uKCl9KTsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBldmVudHMgOiB7CiAgICAgICAgICAgIC8vICdpbnB1dCcgOiAndXBkYXRlJywKICAgICAgICAgICAgLy8gJ2tleXByZXNzIGlucHV0JyA6ICdpbnB1dEtleVByZXNzZWQnLAogICAgICAgICAgICAvLyAnY2xpY2sgYnV0dG9uJyA6ICdjYWxsQWN0aW9uJwogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGluU3RyID0gc2VsZi5lbElucHV0LnZhbCgpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5TdHIgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuY2FsbGJhY2tzQ2xlYXIsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmKHNlbGYubW9kZWwpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIucmljaFNlcVJlYWRGcm9tKHNlbGYubW9kZWwsIGluU3RyKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaXNWYWxpZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbEJ1dHRvbi5yZW1vdmVDbGFzcygnYnRuLXdhcm5pbmcnKS5hZGRDbGFzcygnYnRuLXN1Y2Nlc3MnKS5hdHRyKCdkaXNhYmxlZCcsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHNlbGYuaGlkZUluZGljYXRvci5yZW1vdmVDbGFzcygnYmFkZ2UtaW1wb3J0YW50JykuYWRkQ2xhc3MoJ2JhZGdlLXN1Y2Nlc3MnKS5odG1sKCcmcmFkaWM7Jyk7CiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuY2FsbGJhY2tzVmFsaWQsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYoc2VsZi5tb2RlbCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4YykgewogICAgICAgICAgICAgICAgICAgIHNlbGYuaXNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHNlbGYuZWxCdXR0b24uYWRkQ2xhc3MoJ2J0bi13YXJuaW5nJykucmVtb3ZlQ2xhc3MoJ2J0bi1zdWNjZXNzJykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTsKICAgICAgICAgICAgICAgICAgICBzZWxmLmhpZGVJbmRpY2F0b3IucmVtb3ZlQ2xhc3MoJ2JhZGdlLXN1Y2Nlc3MnKS5hZGRDbGFzcygnYmFkZ2UtaW1wb3J0YW50JykuaHRtbCgnWCcpOwogICAgICAgICAgICAgICAgICAgIF8uZWFjaChzZWxmLmNhbGxiYWNrc0ludmFsaWQsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYoZXhjKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGNsaWNrIGJ1dHRvbiBpZiBlbnRlciBrZXkgaXMgcHJlc3NlZAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaW5wdXRLZXlQcmVzc2VkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoZXZ0LmNoYXJDb2RlID09IDEzKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsQWN0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgYSBmdW5jaXRvbiB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIGZpZWxkIGlzIGEgdmFsaWQgUmljaFNlcXVlbmNlIGRlc2NyaXB0b3IKICAgICAgICAgICAgICogYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBmdW5jdGlvbiB3aWxsIGEgUmljaFNlcXVlbmNlICh0aGUgUlNJIG1vZGVsKQogICAgICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBhZGRDYWxsYmFja1ZhbGlkOiBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NWYWxpZC5wdXNoKGYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgYSBmdW5jaXRvbiB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIGZpZWxkIGlzIGEgSU52YWxpZCBSaWNoU2VxdWVuY2UgZGVzY3JpcHRvcgogICAgICAgICAgICAgKiBhcmcgcGFzc2VkIHRvIGZ1bmN0aW9uIGlzIHRoZSBjdXJyZW50IGV4Y2VwdGlvbgogICAgICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBhZGRDYWxsYmFja0ludmFsaWQ6IGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrc0ludmFsaWQucHVzaChmKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhZGRDYWxsYmFja0NsZWFyOiBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NDbGVhci5wdXNoKGYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbGxBY3Rpb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmFjdGlvbiA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmFjdGlvbihzZWxmLm1vZGVsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRDYXJldEF0OiBmdW5jdGlvbiAocG9zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHNlbGYuZWxJbnB1dFswXTsKICAgICAgICAgICAgICAgIG5vZGUuc2V0U2VsZWN0aW9uUmFuZ2UocG9zLCBwb3MpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRDYXJldFNlbGVjdGlvbjogZnVuY3Rpb24gKHBTdGFydCwgcEVuZCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBzZWxmLmVsSW5wdXRbMF07CiAgICAgICAgICAgICAgICBub2RlLnNldFNlbGVjdGlvblJhbmdlKHBTdGFydCwgcEVuZCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBqdXN0IHJldHVybiB0aGUgdGV4dCBpbiB0aGUgaW5wdXQgZmllbGQKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGlucHV0U2VxdWVuY2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmVsSW5wdXQudmFsKCkudHJpbSgpCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIHJldHVybiBSaWNoU2VxdWVuY2VJbnB1dDsKICAgIH0pOwoKLyoKICogU1ZHIHJlbmRlciBvZiB0aGVvcmV0aWNhbCBmcmFnbWVudCBvbiBhIHNlcXVlbmNlCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBkMykgewoKICAgIFRoZW9PblNlcXVlbmNlVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAoKICAgICAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHRoZW9TcGVjdHJ1bSA9IHNlbGYubW9kZWw7CgogICAgICAgICAgICB2YXIgd1VuaXQgPSA2NTsKICAgICAgICAgICAgdmFyIGhVbml0ID0gMTU7CgogICAgICAgICAgICB2YXIgd2lkdGggPSAodGhlb1NwZWN0cnVtLmdldCgncmljaFNlcXVlbmNlJykuc2l6ZSgpICsgMSkgKiB3VW5pdDsKICAgICAgICAgICAgdmFyIGhlaWdodCA9ICh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoICsgMiApICogaFVuaXQ7CgogICAgICAgICAgICBzZWxmLnZpeiA9IGQzLnNlbGVjdChzZWxmLmVsKS5hcHBlbmQoInN2ZyIpLmF0dHIoJ2NsYXNzJywgJ2QzLXdpZGdldC10aGVvLW9uLXNlcXVlbmNlJykuYXR0cigid2lkdGgiLCB3aWR0aCkuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0KTsKCiAgICAgICAgICAgIHZhciBzZXJpZXMyaSA9IHt9OwogICAgICAgICAgICB2YXIgaV9jID0gMDsKICAgICAgICAgICAgdmFyIGlfbiA9IDA7CiAgICAgICAgICAgIF8uZWFjaCh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJyksIGZ1bmN0aW9uKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoZnMgPCAnbScpIHsvLyBudGVybQogICAgICAgICAgICAgICAgICAgIGlfbiA9IGlfbiAtIDE7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9uOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpX2MgPSBpX2MgKyAxCiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9jOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaV9uIC09IDAuNTsKCiAgICAgICAgICAgIHZhciByaWNoU2VxID0gdGhlb1NwZWN0cnVtLmdldCgncmljaFNlcXVlbmNlJyk7CiAgICAgICAgICAgIHNlbGYudml6LmFwcGVuZCgnZycpLnNlbGVjdEFsbCgndGV4dC5hYScpLmRhdGEocmljaFNlcS5nZXQoJ3NlcXVlbmNlJykpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnYWEnKS5hdHRyKCd4JywgZnVuY3Rpb24oYWEsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoaSArIDEpICogd1VuaXQ7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCAoLWlfbiArIDAuNSkgKiBoVW5pdCkudGV4dChmdW5jdGlvbihyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBzaXplID0gcmljaFNlcS5zaXplKCk7CiAgICAgICAgICAgIHZhciBtb2RpZnMgPSBbcmljaFNlcS5nZXRNb2RpZmljYXRpb25BcnJheSgtMSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJhYS5tb2RpZmljYXRpb25zCiAgICAgICAgICAgIH0pKS5jb25jYXQoW3JpY2hTZXEuZ2V0TW9kaWZpY2F0aW9uQXJyYXkoc2l6ZSldKTsKICAgICAgICAgICAgc2VsZi52aXouYXBwZW5kKCdnJykuc2VsZWN0QWxsKCd0ZXh0LmFhLW1vZGlmJykuZGF0YShtb2RpZnMpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnYWEtbW9kaWYnKS5hdHRyKCd4JywgZnVuY3Rpb24obW9kcywgaSkgewogICAgICAgICAgICAgICAgaWYoaT09MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdVbml0ICowLjQ1OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoaT09c2l6ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpLTAuNDUpKndVbml0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGkgKiB3VW5pdDsKICAgICAgICAgICAgfSkuYXR0cigneScsICgtaV9uICsgMC41KSAqIGhVbml0ICsgMTApLnRleHQoZnVuY3Rpb24obW9kcykgewogICAgICAgICAgICAgICAgaWYgKG1vZHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KG1vZHMsIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJywnKTsKCiAgICAgICAgICAgIH0pLnN0eWxlKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uKG1vZHMsIGkpewogICAgICAgICAgICAgICAgaWYoaT09MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdlbmQnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoaT09c2l6ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdzdGFydCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ21pZGRsZScKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgcGVhazJwb3MgPSBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VyaWVzID0gcC5zZXJpZXM7CiAgICAgICAgICAgICAgICBpZiAoc2VyaWVzIDwgJ20nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNOdGVybSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHggOiB3VW5pdCAqIChwLnBvcyArIDEuNSkgLSA3LAogICAgICAgICAgICAgICAgICAgICAgICB5IDogKHNlcmllczJpW3Nlcmllc10gLSBpX24pICogaFVuaXQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlzTnRlcm0gOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB4IDogd1VuaXQgKiAocC5wb3MgKyAuNSkgKyA3LAogICAgICAgICAgICAgICAgICAgIHkgOiAoc2VyaWVzMmlbc2VyaWVzXSAtIGlfbiArIDEpICogaFVuaXQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3BhdGguZnJhZ21lbnQnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ3BlYWtzJykpLmVudGVyKCkuYXBwZW5kKCdwYXRoJykuYXR0cignY2xhc3MnLCAnZnJhZ21lbnQnKS5hdHRyKCdkJywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgdmFyIHNlcmllcyA9IHAuc2VyaWVzOwogICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBlYWsycG9zKHApCiAgICAgICAgICAgICAgICBpZiAocG9zLmlzTnRlcm0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ00nICsgcG9zLnggKyAnLCcgKyBwb3MueSArICdsNywzIGwwLCcgKyAoaFVuaXQgLSA1KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdNJyArIHBvcy54ICsgJywnICsgcG9zLnkgKyAnbC03LC0zIGwwLCcgKyAoLWhVbml0ICsgNSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3RleHQuZnJhZy1tb3oucGVha3MnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ3BlYWtzJykpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnZnJhZy1tb3ogcGVha3MnKS5hdHRyKCd4JywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBlYWsycG9zKHApOwogICAgICAgICAgICAgICAgcmV0dXJuIHBvcy54ICsgKHBvcy5pc050ZXJtID8gLTMgOiArMyk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGVhazJwb3MocCkueSArIDM7CiAgICAgICAgICAgIH0pLnN0eWxlKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwZWFrMnBvcyhwKS5pc050ZXJtID8gJ2VuZCcgOiAnc3RhcnQnOwogICAgICAgICAgICB9KS50ZXh0KGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLm1vei50b0ZpeGVkKDQpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy9hZGQgZnJhZ3NlcmllcyBuYW1lIG9uIGxlZnQvcmlnaHQgY29sdW1uCiAgICAgICAgICAgIHZhciBkU2VyaWVzTmFtZXMgPSBfLnppcChfLmtleXMoc2VyaWVzMmkpLCBfLnZhbHVlcyhzZXJpZXMyaSkpOwogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3RleHQuZnJhZy1tb3oubGVnZW5kJykuZGF0YShkU2VyaWVzTmFtZXMpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnZnJhZy1tb3ogbGVnZW5kJykuYXR0cigneCcsIGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiAocFswXSA8ICdtJykgPyA1IDogKHdpZHRoIC0gNSk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICB2YXIgcGsgPSB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzIDogcFswXSwKICAgICAgICAgICAgICAgICAgICBwb3MgOiAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcGVhazJwb3MocGspLnkgKyAzOwogICAgICAgICAgICB9KS5zdHlsZSgndGV4dC1hbmNob3InLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHBbMF0gPiAnbScpID8gJ2VuZCcgOiAnc3RhcnQnOwogICAgICAgICAgICB9KS50ZXh0KGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwWzBdOwogICAgICAgICAgICB9KTsKCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFRoZW9PblNlcXVlbmNlVmlldzsKfSk7CgovKioKICogRXh0ZW5kcyBQZWFrTGlzdFBhaXJBbGlnbm1lbnQgZm9yIGEgcGFpciBvZiB0d28gRXhwU3BlY3RydW0KICogUHJvcGVydGllcyBhcmUKICogLSBzcGVjdHJ1bUEKICogLSBzcGVjdHJ1bUIKICoKICogYWxpZ25tZW50IGlzIHJlY29tcHV0ZWQgaWYgYW55IG9mIHRoZW0gdHJpZ2dlIGEgJ2NoYW5nZScgZXZlbnQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLFsndW5kZXJzY29yZScsICcuL1BlYWtMaXN0UGFpckFsaWdubWVudCddLCBmdW5jdGlvbihfLCBQZWFrTGlzdFBhaXJBbGlnbm1lbnQpIHsKCiAgICAvKioKICAgICAqIGJ1aWxkIHRoZSBhbGlnbm1lbnQgd2l0aCBvcHRpb25zIHtyaWNoU2VxdWVuY2U6Li4uLCBleHBTcGVjdHJ1bTouLi59CiAgICAgKi8KICAgIHZhciBQU01BbGlnbm1lbnQgPSBQZWFrTGlzdFBhaXJBbGlnbm1lbnQuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIFBTTUFsaWdubWVudC5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIHt9KTsKICAgICAgICAgICAgc2VsZi5idWlsZCgpCgogICAgICAgICAgICBzZWxmLmdldCgnc3BlY3RydW1BJykub24oImNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2VsZi5idWlsZCgpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuZ2V0KCdzcGVjdHJ1bUInKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgYnVpbGQgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zZXQoJ3BrbEEnLCBzZWxmLmdldCgnc3BlY3RydW1BJykpCiAgICAgICAgICAgIHNlbGYuc2V0KCdwa2xCJywgc2VsZi5nZXQoJ3NwZWN0cnVtQicpKQoKICAgICAgICAgICAgdmFyIG1hdGNoSW5kaWNlcyA9IHNlbGYubWF0Y2hJbmRpY2VzKCk7CgogICAgICAgICAgICB2YXIgeHBlYWtzQSA9IHNlbGYuZ2V0KCdzcGVjdHJ1bUEnKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllc0EgPSBzZWxmLmdldCgnc3BlY3RydW1BJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwogICAgICAgICAgICB2YXIgeHBlYWtzQiA9IHNlbGYuZ2V0KCdzcGVjdHJ1bUInKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllc0IgPSBzZWxmLmdldCgnc3BlY3RydW1CJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwoKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBfLm1hcChtYXRjaEluZGljZXMsIGZ1bmN0aW9uKG1pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHBrQiA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggOiBtaS5pQiwKICAgICAgICAgICAgICAgICAgICAgICAgbW96IDogeHBlYWtzQlttaS5pQl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNCW21pLmlCXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBrQSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggOiBtaS5pQSwKICAgICAgICAgICAgICAgICAgICAgICAgbW96IDogeHBlYWtzQVttaS5pQV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNBW21pLmlBXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGVycm9yUFBNIDogbWkuZXJyb3JQUE0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5zZXQoJ21hdGNoZXMnLCBtYXRjaGVzKTsKCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybiBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGV4cGVyaW1lbnRhbCBhbmQgdGhlIHRoZW9yZXRpY2FsIHByZWN1cnNvcnMgKE1IKQogICAgICAgICAqLwogICAgICAgIGRlbHRhUHJlY01venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeiA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgncHJlY0NoYXJnZScpOwogICAgICAgICAgICB2YXIgdGhlbyA9IG1hc3NCdWlsZGVyLmNvbXB1dGVNYXNzUmljaFNlcXVlbmNlKHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKSwgeikKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKSAtIHRoZW8pICogegogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHt7fX0gcmVhZHkgZm9yIEpTT04KICAgICAgICAgKi8KICAgICAgICBzZXJpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcmV0ID0ge307CiAgICAgICAgICAgIHJldC5leHBTcGVjdHJ1bSA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLnRvSlNPTigpCgogICAgICAgICAgICB2YXIgcnNlcSA9IHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKS50b1N0cmluZygpOwogICAgICAgICAgICByZXQucmljaFNlcXVlbmNlID0gcnNlcQoKICAgICAgICAgICAgcmV0LmlkID0gc2VsZi5jb21wdXRlSWQoKTsKICAgICAgICAgICAgcmV0LmFhU2VxdWVuY2UgPSBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9BQVN0cmluZygpOwoKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9LAogICAgICAgIGNvbXB1dGVJZCA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2lkJykgKyAnfCcgKyBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKQoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIHJldHVybiB0aGUgbnVtYmVyIG9mIHVubWFjdGhlZCBleHBlcmltZW50YWwgcGVhaywgd2l0aCBhIG1hc3MgZ3JlYXRlciB0aGFuIHRoZSBwcmVjdXJzb3IsCiAgICAgICAgICogaW50ZW5zaXR5IDwgaW5GaXJzdCBhbmQgd2l0aCB0b2wgZXJyb3IKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdG9sCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGluRmlyc3QKICAgICAgICAgKi8KICAgICAgICB1bm1hdGNoZWRGYWN0b3IgOiBmdW5jdGlvbih0b2wsIGluRmlyc3QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHNlbGYuY2xvc2VyVGhhblBQTSh0b2wpOwoKICAgICAgICAgICAgdmFyIHBrcyA9IF8uZmlsdGVyKF8uemlwKHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnbW96cycpLCBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2ludGVuc2l0eVJhbmtzJykpLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFsxXSA8IGluRmlyc3QKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbVByZWMgPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKQogICAgICAgICAgICByZXR1cm4gXy5maWx0ZXIocGtzLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFswXSA+IG1QcmVjOwogICAgICAgICAgICB9KS5sZW5ndGggLSBfLmZpbHRlcihtYXRjaGVzLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKG0uZXhwLmludGVuc2l0eVJhbmsgPCBpbkZpcnN0KSAmJiAobS5leHAubW96ID4gbVByZWMpOwogICAgICAgICAgICB9KS5sZW5ndGgKCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFBTTUFsaWdubWVudDsKfSk7CgovKgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uKF8sIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CiAgLyoKICAgKiBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgNCB2YWx1ZXM6CiAgICoKICAgKiAwOiBtb3oKICAgKiAxOmludGVuc2l0eQogICAqIDI6IGludGVuc2l0eSByYW5rcwogICAqIDM6IGlzTWF0aGNpbmcgKCBjb25zdHJ1Y3RlZCBhdCB0aGUgYnVpbGREYXRhIHN0ZXApCiAgICovCiAgdmFyIHByb2plY3RTcGVjdHJ1bSA9IGZ1bmN0aW9uKGV4cFNwKSB7CiAgICByZXR1cm4gewogICAgICBwcmVjdXJzb3IgOiB7CiAgICAgICAgc2Nhbk51bWJlciA6IGV4cFNwLmdldCgnc2Nhbk51bWJlcicpLAogICAgICAgIGlkIDogZXhwU3AuZ2V0KCdpZCcpCiAgICAgIH0sCiAgICAgIHBlYWtzIDogXy5jaGFpbihleHBTcC5nZXQoJ21venMnKSkuemlwKGV4cFNwLmdldCgnaW50ZW5zaXRpZXMnKSwgZXhwU3AuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKS52YWx1ZSgpCiAgICB9CiAgfQogIHZhciBwZWFrUmFua0NsYXNzID0gZnVuY3Rpb24ocGspIHsKICAgIHZhciBpcmsgPSBwa1syXTsKICAgIHJldHVybiAncmstJyArICgoaXJrIDwgNDApID8gTWF0aC5mbG9vcihpcmsgLyAxMCkgOiAneCcpOwogIH0KICB2YXIgU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgZGVmYXVsdHMgOiB7CiAgICB9LAogICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucykKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLmlzRW5oYW5jZWQgPSBvcHRpb25zLmVuaGFuY2VkOwogICAgICBzZWxmLm1heFJhbmtNYXRjaGluZ1BlYWtzID0gb3B0aW9ucy5tYXhQZWFrcyB8fCAxMDAwOwogICAgICBzZWxmLmluZGVwZW5kZW50WVNjYWxlcyA9IG9wdGlvbnMuaW5kZXBlbmRlbnRZU2NhbGVzOwogICAgICBzZWxmLmNvbG9yUGVha3MgPSBvcHRpb25zLmNvbG9yUGVha3M7CgogICAgICBzZWxmLmZyYWdUb2wgPSBvcHRpb25zLmZyYWdUb2wgfHwgMjA7CiAgICAgIHNlbGYuaGVpZ2h0TWlkZGxlWm9uZSA9IChzZWxmLmlzRW5oYW5jZWQpID8gKHNlbGYuaGVpZ2h0KCkgKiAwLjEpIDogMAoKICAgICAgc2VsZi5idWlsZCgpOwogICAgICBzZWxmLm1vZGVsLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZWxmLmJ1aWxkKCkucmVuZGVyKCk7CiAgICAgIH0pCiAgICB9LAoKICAgIGJ1aWxkIDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1aWxkRGF0YSgpLmJ1aWxkQ29udGV4dCgpLmJ1aWxkRDMoKTsKICAgIH0sCiAgICBidWlsZERhdGEgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLnNwQSA9IHByb2plY3RTcGVjdHJ1bShzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1BJykpOwogICAgICBzZWxmLnNwQiA9IHByb2plY3RTcGVjdHJ1bShzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1CJykpOwoKICAgICAgaWYgKHNlbGYuaXNFbmhhbmNlZCkgewogICAgICAgIF8uZWFjaChzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi5mcmFnVG9sKSwgZnVuY3Rpb24ocCkgewogICAgICAgICAgc2VsZi5zcEEucGVha3NbcC5wa0EuaW5kZXhdWzNdID0gdHJ1ZTsKICAgICAgICAgIHNlbGYuc3BCLnBlYWtzW3AucGtCLmluZGV4XVszXSA9IHRydWU7CiAgICAgICAgfSkKICAgICAgfQoKICAgICAgc2VsZi5hbGxQZWFrcyA9IHNlbGYuc3BBLnBlYWtzLm1hcChmdW5jdGlvbihwKSB7CiAgICAgICAgcFs0XSA9IDAKICAgICAgICByZXR1cm4gcDsKICAgICAgfSkuY29uY2F0KHNlbGYuc3BCLnBlYWtzLm1hcChmdW5jdGlvbihwKSB7CiAgICAgICAgcFs0XSA9IDEKICAgICAgICByZXR1cm4gcDsKICAgICAgfSkpCgogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICBidWlsZENvbnRleHQgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIHhNYXggPSBNYXRoLm1heChzZWxmLnNwQS5wZWFrc1tzZWxmLnNwQS5wZWFrcy5sZW5ndGgtMV1bMF0sIHNlbGYuc3BCLnBlYWtzW3NlbGYuc3BCLnBlYWtzLmxlbmd0aC0xXVswXSkgKiAxLjE7CiAgICAgIHZhciB4TWluID0gTWF0aC5tYXgoc2VsZi5zcEEucGVha3NbMF1bMF0sIHNlbGYuc3BCLnBlYWtzWzBdWzBdKSAqIDAuNTsKICAgICAgdmFyIHlNYXggPSBNYXRoLm1heChfLm1heChzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1BJykuZ2V0KCdpbnRlbnNpdGllcycpKSwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3NwZWN0cnVtQicpLmdldCgnaW50ZW5zaXRpZXMnKSkpICogMS4wNTsKCiAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgeERvbWFpbiA6IFt4TWluLCB4TWF4XSwKICAgICAgICB5RG9tYWluIDogWzAsIHlNYXhdLAogICAgICAgIGhlaWdodCA6IChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRNaWRkbGVab25lKSAvIDIsCiAgICAgICAgd2lkdGggOiBzZWxmLndpZHRoKCkKICAgICAgfSkKCiAgICAgIHJldHVybiBzZWxmOwogICAgfSwKICAgIGJ1aWxkRDMgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgc2VsZi52aXMgPSBzZWxmLmVsLmFwcGVuZCgnc3ZnJyk7CiAgICAgIHNlbGYudmlzLmF0dHIoJ3dpZHRoJywgc2VsZi53aWR0aCgpKS5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCgpKS5hdHRyKCdjbGFzcycsICdzcGVjdHJhLXBhaXItYWxpZ25tZW50Jyk7CiAgICAgIHNlbGYudmlzLmFwcGVuZCgnbGluZScpLmF0dHIoJ3kxJywgc2VsZi5oZWlnaHQoKSAvIDIpLmF0dHIoJ3kyJywgc2VsZi5oZWlnaHQoKSAvIDIpLmF0dHIoJ3gxJywgMCkuYXR0cigneDInLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2NsYXNzJywgJ2F4aXMnKQoKICAgICAgdmFyIHlzID0gW3NlbGYuc2NhbGluZ0NvbnRleHQueSgpLCBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKV0KCiAgICAgIHlzWzFdLnJhbmdlKFsoc2VsZi5oZWlnaHQoKSArIHNlbGYuaGVpZ2h0TWlkZGxlWm9uZSkgLyAyLCBzZWxmLmhlaWdodCgpXSk7CiAgICAgIGlmIChzZWxmLmluZGVwZW5kZW50WVNjYWxlcykgewogICAgICAgIHlzWzBdLmRvbWFpbihbMCwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3NwZWN0cnVtQScpLmdldCgnaW50ZW5zaXRpZXMnKSkgKiAxLjA1XSkKICAgICAgICB5c1sxXS5kb21haW4oWzAsIF8ubWF4KHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUInKS5nZXQoJ2ludGVuc2l0aWVzJykpICogMS4wNV0pCiAgICAgIH0KCiAgICAgIHZhciBqMHVwID0gKHNlbGYuaGVpZ2h0KCkgLSBzZWxmLmhlaWdodE1pZGRsZVpvbmUpIC8gMjsKICAgICAgdmFyIGowZG93biA9IChzZWxmLmhlaWdodCgpICsgc2VsZi5oZWlnaHRNaWRkbGVab25lKSAvIDI7CgogICAgICBzZWxmLnBlYWtzSG9sZGVyID0gc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsnKS5kYXRhKHNlbGYuYWxsUGVha3MpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihwaykgewogICAgICAgIHZhciBjbCA9ICdwZWFrICBwZWFrLXgnOwogICAgICAgIGlmIChzZWxmLmNvbG9yUGVha3MpIHsKICAgICAgICAgIGNsICs9ICcgJyArIHBlYWtSYW5rQ2xhc3MocGspOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5pc0VuaGFuY2VkKSB7CiAgICAgICAgICBjbCArPSBwa1szXSA/ICIgbWF0Y2hlZCIgOiAiIHVubWF0Y2hlZCI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjbDsKICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbihwaykgewogICAgICAgIHJldHVybiB5c1twa1s0XV0oMCk7CiAgICAgICAgLy8ocGtbMV0gPiAwKSA/IGowdXAgOiBqMGRvd247CiAgICAgIH0pLmF0dHIoJ3kyJywgZnVuY3Rpb24ocGspIHsKICAgICAgICByZXR1cm4geXNbcGtbNF1dKHBrWzFdKS8vKHBrWzFdID4gMCkgPyAoajB1cCAtIHkocGtbMV0pKSA6IChqMGRvd24gKyB5KC1wa1sxXSkpOwogICAgICB9KTsKCiAgICAgIGlmIChzZWxmLmlzRW5oYW5jZWQpIHsKICAgICAgICBzZWxmLnZpcy5zZWxlY3RBbGwoJ2xpbmUucGVhay1tYXRjaCcpLmRhdGEoXy5maWx0ZXIoc2VsZi5zcEEucGVha3MuY29uY2F0KHNlbGYuc3BCLnBlYWtzKSwgZnVuY3Rpb24ocGspIHsKICAgICAgICAgIHJldHVybiBwa1szXSAmJiAocGtbMl0gPCBzZWxmLm1heFJhbmtNYXRjaGluZ1BlYWtzICk7CiAgICAgICAgfSkpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihwaykgewogICAgICAgICAgdmFyIGNsID0gJ3BlYWsgcGVhay1tYXRjaCBwZWFrLXgnOwogICAgICAgICAgY2wgKz0gJyAnICsgcGVha1JhbmtDbGFzcyhwayk7CiAgICAgICAgICByZXR1cm4gY2wKICAgICAgICB9KS5hdHRyKCd5MScsIHNlbGYuaGVpZ2h0KCkgLyAyKS5hdHRyKCd5MicsIGZ1bmN0aW9uKHBrKSB7CiAgICAgICAgICByZXR1cm4gKHBrWzRdID09IDApID8gajB1cCA6IGowZG93bjsKICAgICAgICB9KQogICAgICB9CgogICAgICB2YXIgZ3RpdGxlcyA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3RpdGxlcycpCiAgICAgIGd0aXRsZXMuYXBwZW5kKCd0ZXh0JykudGV4dCgnIycgKyBzZWxmLnNwQS5wcmVjdXJzb3Iuc2Nhbk51bWJlcikuYXR0cigneCcsIHNlbGYud2lkdGgoKSAtIDUpLmF0dHIoJ3knLCAzMCkuYXR0cignY2xhc3MnLCAnc2NhbiB0b3AnKQogICAgICBndGl0bGVzLmFwcGVuZCgndGV4dCcpLnRleHQoJyMnICsgc2VsZi5zcEIucHJlY3Vyc29yLnNjYW5OdW1iZXIpLmF0dHIoJ3gnLCBzZWxmLndpZHRoKCkgLSA1KS5hdHRyKCd5Jywgc2VsZi5oZWlnaHQoKSAtIDMwKS5hdHRyKCdjbGFzcycsICdzY2FuIGJvdHRvbScpCgogICAgICBzZWxmLmF4aXNDb250YWluZXIgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdheGlzJyk7CgogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgeCA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwoKICAgICAgc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsteCcpLmF0dHIoJ3gxJywgZnVuY3Rpb24ocGspIHsKICAgICAgICByZXR1cm4geChwa1swXSkKICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbihwaykgewogICAgICAgIHJldHVybiB4KHBrWzBdKQogICAgICB9KTsKICAgICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS50aWNrU2l6ZSg2LCAwLCAwKS50aWNrcygzKS8vIiIudGlja0Zvcm1hdChkMy5mb3JtYXQoImQiKSk7CiAgICAgIHNlbGYuYXhpc0NvbnRhaW5lci5jYWxsKHhBeGlzKTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIFNwZWN0cmFQYWlyQWxpZ25tZW50VmlldzsKCn0pCjsKLyoqCiAqIHRoaXMgaXMgYSBncmlkIGZvciBkaXNwbGF5aW5nIGEgc3BlY3RydW0vcGVwdGlkZSBtYXRjaC4gVGhlIGNsYXNzaWMgc3R1ZmYsIGFzCiAqIGEgaHRtbCB0YWJsZSwgYWRkaW5nIGNvbG9yIGFuZCBzby4uLgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hHcmlkVmFsdWVzVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldyddLCBmdW5jdGlvbiAoXywgQmFja2JvbmUsIENvbW1vbldpZGdldFZpZXcpIHsKCiAgICBNYXRjaEdyaWRWYWx1ZXNWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgTWF0Y2hHcmlkVmFsdWVzVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cykKCiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNDAwOwogICAgICAgICAgICBzZWxmLndpZHRoID0gb3B0aW9ucy53aWR0aCB8fCAzMDA7CiAgICAgICAgICAgIHNlbGYudG9sID0gb3B0aW9ucy50b2wgfHwgNTAwOwoKICAgICAgICAgICAgc2VsZi5lbC5jbGFzc2VkKCdkMy13aWRnZXQtbWF0Y2gtZ3JpZC12YWx1ZXMnLCB0cnVlKQogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgdGhlb1NwZWN0cnVtID0gc2VsZi5tb2RlbC5nZXQoJ3RoZW9TcGVjdHJ1bScpOwogICAgICAgICAgICB2YXIgbmJTZXJpZXMgPSB0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoCgogICAgICAgICAgICBzZWxmLmVsLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCd3aWR0aCcsIHNlbGYud2lkdGgpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KQogICAgICAgICAgICAvLyBnZXQgZnJhZyBzZXJpZXMgLT4gb3JkaW5hdGUKICAgICAgICAgICAgdmFyIHNlcmllczJpID0ge307CiAgICAgICAgICAgIHZhciBpX2MgPSAwOwogICAgICAgICAgICB2YXIgaV9uID0gMDsKICAgICAgICAgICAgXy5lYWNoKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSwgZnVuY3Rpb24gKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoZnMgPCAnbScpIHsvLyBudGVybQogICAgICAgICAgICAgICAgICAgIGlfbiA9IGlfbiAtIDM7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9uICsgMjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaV9jID0gaV9jICsgMwogICAgICAgICAgICAgICAgICAgIHNlcmllczJpW2ZzXSA9IGlfYyArIDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byBzY2FsZSBbMDood2lkdGggLSAyKjEwKV0geCBbMC1oZWlnaHRdIHRvIFtpX246aV9jKzFdIHgKICAgICAgICAgICAgLy8gWy0xOiB0aGVvU3BlY3RydW0ucmljaFNlcXVlbmNlLnNpemUoKV0KICAgICAgICAgICAgdmFyIHJpY2hTZXEgPSB0aGVvU3BlY3RydW0uZ2V0KCdyaWNoU2VxdWVuY2UnKTsKICAgICAgICAgICAgdmFyIHNpemUgPSByaWNoU2VxLnNpemUoKTsKCiAgICAgICAgICAgIHZhciBzY2FsZSA9IE1hdGgubWluKCgoc2VsZi53aWR0aCkgLyAoaV9jICsgMSAtIGlfbiArIDMpKSwgKHNlbGYuaGVpZ2h0IC8gKHNpemUgKyAxKSkpOwogICAgICAgICAgICB2YXIgdHJhbnNmID0gJ3NjYWxlKCcgKyBzY2FsZSArICcsJyArIHNjYWxlICsgJyksdHJhbnNsYXRlKCcgKyAoLWlfbiArIDEpICsgJywxLjcpJzsKCiAgICAgICAgICAgIHZhciBnQ29udCA9IHNlbGYuZWwuYXBwZW5kKCdnJykuYXR0cigndHJhbnNmb3JtJywgdHJhbnNmKTsKCiAgICAgICAgICAgIHZhciBmczJpID0gZnVuY3Rpb24gKGZzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWVzMmlbZnNdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRhdGEgbWF0Y2hlcwogICAgICAgICAgICB2YXIgZG1hdGNoZXMgPSBzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi50b2wpOwoKICAgICAgICAgICAgZ0NvbnQuc2VsZWN0QWxsKCd0ZXh0LmFhJykuZGF0YShyaWNoU2VxLmdldCgnc2VxdWVuY2UnKSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS5hdHRyKCdjbGFzcycsICdhYScpLmF0dHIoJ3gnLCAxKS5hdHRyKCd5JywgZnVuY3Rpb24gKGQsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpICsgMC41CiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkLmFhLmdldCgnY29kZTEnKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBtb2RpZnMgPSBbcmljaFNlcS5nZXRNb2RpZmljYXRpb25BcnJheSgtMSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uIChyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEubW9kaWZpY2F0aW9ucwogICAgICAgICAgICB9KSkuY29uY2F0KFtyaWNoU2VxLmdldE1vZGlmaWNhdGlvbkFycmF5KHNpemUpXSk7CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5hYS1tb2RpZicpLmRhdGEobW9kaWZzKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ2FhLW1vZGlmJykuYXR0cigneCcsIDEpLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCwgaSkgewogICAgICAgICAgICAgICAgaWYgKGkgPT0gc2l6ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpICsgMC4zMiAtIDAuNSArIDAuNQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGkgKyAwLjMyIC0gMSArIDAuNTsKICAgICAgICAgICAgfSkudGV4dChmdW5jdGlvbiAobW9kcykgewogICAgICAgICAgICAgICAgaWYgKG1vZHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KG1vZHMsIGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uZ2V0KCduYW1lJyk7CiAgICAgICAgICAgICAgICB9KS5qb2luKCcsJyk7CgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5zZXJpZXMnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS5hdHRyKCdjbGFzcycsICdzZXJpZXMnKS5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZXJpZXMyaVtkXTsKICAgICAgICAgICAgfSkuYXR0cigneScsIC0xKS50ZXh0KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgcG9zbGFiID0gW107CiAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBwb3NsYWIucHVzaChpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5wb3NsYWJlbC5udGVybScpLmRhdGEocG9zbGFiKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3Bvc2xhYmVsIG50ZXJtJykuYXR0cigneCcsIGlfbiAtIDAuOSkuYXR0cigneScsIGZ1bmN0aW9uIChkLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaSArIDEKICAgICAgICAgICAgfSkudGV4dChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5wb3NsYWJlbC5jdGVybScpLmRhdGEocG9zbGFiKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3Bvc2xhYmVsIGN0ZXJtJykuYXR0cigneCcsIGlfYyArIDIuOSkuYXR0cigneScsIGZ1bmN0aW9uIChkLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZSAtIGkgLSAxCiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZ0NvbnQuc2VsZWN0QWxsKCd0ZXh0LnRoZW9mcmFnJykuZGF0YSh0aGVvU3BlY3RydW0uZ2V0KCdwZWFrcycpKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3RoZW9mcmFnJykuYXR0cigneCcsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWVzMmlbcC5zZXJpZXNdCiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIChwLnNlcmllcyA8ICdnJykgPyAocC5wb3MgKyAxKSA6IHAucG9zCiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLm1vei50b0ZpeGVkKDIpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgncmVjdC5tYXRjaGluZycpLmRhdGEoZG1hdGNoZXMpLmVudGVyKCkuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgdmFyIGlyayA9IGQuZXhwLmludGVuc2l0eVJhbms7CiAgICAgICAgICAgICAgICByZXR1cm4gIm1hdGNoaW5nIHJrLSIgKyAoKGlyayA8IDQwKSA/IE1hdGguZmxvb3IoaXJrIC8gMTApIDogJ3gnKQogICAgICAgICAgICB9KS5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZXJpZXMyaVtkLnRoZW8uc2VyaWVzXSAtIDIuOAogICAgICAgICAgICB9KS5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoZC50aGVvLnNlcmllcyA8ICdnJykgPyAoZC50aGVvLnBvcyAtIDAuNyArIDEpIDogKGQudGhlby5wb3MgLSAwLjcpOwogICAgICAgICAgICB9KS5hdHRyKCd3aWR0aCcsIDMpLmF0dHIoJ2hlaWdodCcsIDEpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBNYXRjaEdyaWRWYWx1ZXNWaWV3Owp9KTsKCi8qCiAqIGEgY29tcGFjdCBpY29uaWMgdmlldyBvZiBTcGVjdHJ1bS9TcGVjdHJ1bSBhbGlnbm1lbnQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50SWNvbicsWyd1bmRlcnNjb3JlJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uIChfLCBkMywgQ29tbW9uV2lkZ2V0VmlldywgRGVsdGFNYXNzLCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CgogICAgdmFyIHByb2plY3RTcGVjdHJ1bSA9IGZ1bmN0aW9uIChleHBTcCwgc2FtcGxlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlY3Vyc29yOiB7CiAgICAgICAgICAgICAgICBzY2FuTnVtYmVyOiBleHBTcC5nZXQoJ3NjYW5OdW1iZXInKSwKICAgICAgICAgICAgICAgIGlkOiBleHBTcC5nZXQoJ2lkJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcGVha3M6IF8uY2hhaW4oZXhwU3AuZ2V0KCdtb3pzJykpLnppcChleHBTcC5nZXQoJ2ludGVuc2l0aWVzJyksIGV4cFNwLmdldCgnaW50ZW5zaXR5UmFua3MnKSkubWFwKGZ1bmN0aW9uIChwLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIG1vejogcFswXSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rOiBwWzJdLAogICAgICAgICAgICAgICAgICAgIG9yaWdJbmRleDogaSwKICAgICAgICAgICAgICAgICAgICBzYW1wbGU6IHNhbXBsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkudmFsdWUoKQogICAgICAgIH0KICAgIH0KICAgIHZhciBTcGVjdHJhUGFpckFsaWdubWVudEljb24gPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIFNwZWN0cmFQYWlyQWxpZ25tZW50SWNvbi5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpCiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYubWF4UGVha3MgPSBvcHRpb25zLm1heFBlYWtzIHx8IDUwOwogICAgICAgICAgICBzZWxmLmZyYWdUb2wgPSBvcHRpb25zLmZyYWdUb2wgfHwgMjA7CgogICAgICAgICAgICBzZWxmLmJ1aWxkKCk7CiAgICAgICAgICAgIHNlbGYubW9kZWwub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuYnVpbGQoKS5yZW5kZXIoKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGJ1aWxkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkRGF0YSgpLmJ1aWxkQ29udGV4dCgpLmJ1aWxkRDMoKTsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRGF0YTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuc3BBID0gcHJvamVjdFNwZWN0cnVtKHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUEnKSwgMCk7CiAgICAgICAgICAgIHNlbGYuc3BCID0gcHJvamVjdFNwZWN0cnVtKHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUInKSwgMSk7CgogICAgICAgICAgICAvL2xhYmVsIHRoZSBwZWFrcwogICAgICAgICAgICB2YXIgcGtCaW5zID0gWwogICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICBbXQogICAgICAgICAgICBdCgogICAgICAgICAgICAvL29uZSBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgW21veiwgaW50ZW5zaXR5LCBpbnRlbnNpdHlSYW5rLCBpc01hdGNoaW5nLCBzYW1wbGVOYW1lLCBvdmVyYWxsTnVtYmVyXQoKICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3MgPSBfLmNoYWluKHNlbGYuc3BBLnBlYWtzLmNvbmNhdChzZWxmLnNwQi5wZWFrcykpLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAuaW50ZW5zaXR5UmFuayA8IHNlbGYubWF4UGVha3M7CiAgICAgICAgICAgIH0pLnNvcnRCeShmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAubW96OwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHAsIGkpIHsKICAgICAgICAgICAgICAgIHAuYmluSW5kZXggPSBpOwogICAgICAgICAgICAgICAgcC5tYXRjaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBwa0JpbnNbcC5zYW1wbGVdW3Aub3JpZ0luZGV4XSA9IGk7CiAgICAgICAgICAgICAgICByZXR1cm4gcDsKICAgICAgICAgICAgfSkudmFsdWUoKTsKCiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gc2VsZi5tb2RlbC5jbG9zZXJUaGFuUFBNKHNlbGYuZnJhZ1RvbCk7CiAgICAgICAgICAgIF8uZWFjaChtYXRjaGVzLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgaWYgKChtLnBrQi5pbnRlbnNpdHlSYW5rID49IHNlbGYubWF4UGVha3MpIHx8IChtLnBrQS5pbnRlbnNpdHlSYW5rID49IHNlbGYubWF4UGVha3MpKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIHNlbGYuc29ydGVkTWF0Y2hlZFBlYWtzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHNhbXBsZTogMSwKICAgICAgICAgICAgICAgICAgICBiaW5JbmRleDogcGtCaW5zWzBdW20ucGtBLmluZGV4XSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rOiBtLnBrQi5pbnRlbnNpdHlSYW5rLAogICAgICAgICAgICAgICAgICAgIG1hdGNoZWQ6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgc2FtcGxlOiAwLAogICAgICAgICAgICAgICAgICAgIGJpbkluZGV4OiBwa0JpbnNbMV1bbS5wa0IuaW5kZXhdLAogICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbms6IG0ucGtBLmludGVuc2l0eVJhbmssCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZDogdHJ1ZQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBzZWxmLnNvcnRlZE1hdGNoZWRQZWFrc1twa0JpbnNbMV1bbS5wa0IuaW5kZXhdXS5tYXRjaGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3NbcGtCaW5zWzBdW20ucGtBLmluZGV4XV0ubWF0Y2hlZCA9IHRydWUKCgogICAgICAgICAgICB9KQoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICBidWlsZENvbnRleHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dCA9IG5ldyBEM1NjYWxpbmdDb250ZXh0KHsKICAgICAgICAgICAgICAgIHhEb21haW46IFswLCAyICogc2VsZi5tYXhQZWFrc10sCiAgICAgICAgICAgICAgICB5RG9tYWluOiBbMiwgMF0sCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNlbGYuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRDM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLnZpcyA9IHNlbGYuZWwuYXBwZW5kKCdzdmcnKTsKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KCkpLmF0dHIoJ2NsYXNzJywgJ3NwZWN0cmEtcGFpci1pY29uJyk7CiAgICAgICAgICAgIHNlbGYudmlzLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ3dpZHRoJywgJzEwMCUnKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIgPSBzZWxmLnZpcy5zZWxlY3RBbGwoJ3JlY3QucGVhay1iaW4nKS5kYXRhKHNlbGYuc29ydGVkTWF0Y2hlZFBlYWtzKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ3BlYWstYmluJyk7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsKICAgICAgICAgICAgdmFyIHkgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIuYXR0cigneCcsIGZ1bmN0aW9uIChwaykgewogICAgICAgICAgICAgICAgLy8gaWYocGtbNF09PSdCJyAmJiBwWzNdKXsKICAgICAgICAgICAgICAgIC8vIHJldHVybiB4KHBrWzVdLTEpCiAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICByZXR1cm4geChway5iaW5JbmRleCkKICAgICAgICAgICAgfSkuYXR0cignd2lkdGgnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB4KDEpCiAgICAgICAgICAgIH0pLmF0dHIoJ2hlaWdodCcsIHkoMSkpLmF0dHIoJ3knLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB5KHBrLnNhbXBsZSkKICAgICAgICAgICAgfSkuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHZhciBpcmsgPSBway5pbnRlbnNpdHlSYW5rOwogICAgICAgICAgICAgICAgdmFyIGNsID0gJ3NwZWN0cmEtcGFpci1pY29uLWJpbiByay0nICsgKChpcmsgPCA0MCkgPyBNYXRoLmZsb29yKGlyayAvIDEwKSA6ICd4Jyk7CiAgICAgICAgICAgICAgICBpZiAocGsubWF0Y2hlZCkKICAgICAgICAgICAgICAgICAgICBjbCArPSAiIG1hdGNoZWQiCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY2wgKz0gIiB1bm1hdGNoZWQiCiAgICAgICAgICAgICAgICByZXR1cm4gY2w7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBTcGVjdHJhUGFpckFsaWdubWVudEljb247Cgp9KTsKLyoqCiAqIHdyYXBwIGFsbCBleHBvc2VkIGZ1bmN0aW9uIGhhbmRsZXJzIGFuZCBwcm90b3R5cGVzCiAqCiAqIHRoZXJlIGlzIHNvbWUgcmVwZXRpdGlvbiBhbmQgc29tZSBvcmRlci4gQnV0IEkgY2Fubm90IGZpZ3VyZSBvdXQgd2hhdCBpcyBoYXBwZW5pbmcgd2l0aCBhbG1vbmQsIHdoaWNoIGxvb2sgbGlrZSBpdCBkb2VzIG5vdCBpbnRlcnByZXQgJ2RlZmluZScgaW4gc29tZSBjYXNzaWMgd2F5Li4uCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKKGZ1bmN0aW9uICgpIHsKICAgIGRlZmluZSgnanF1ZXJ5LXBsdXMnLCBbJ2pxdWVyeScsICdib290c3RyYXAnLCAndHlwZWFoZWFkJywgJ2pRdWVyeUNvb2tpZSddLCBmdW5jdGlvbiAoJCkgewogICAgICAgIHJldHVybiAkOwogICAgfSk7CgogICAgdmFyIGV4cG9ydGVkID0gewogICAgICAgIHdldDogWydDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwTVNNU1NwZWN0cnVtJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9NU01TUnVuJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L0luamVjdGlvbicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9FeHBlcmltZW50JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsICdmaXNodG9uZXMvdmlld3Mvd2V0L1hJQ1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9NdWx0aVhJQ1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNNdWx0aVBhbmVWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvU3BlY3RydW1WaWV3J10sCiAgICAgICAgZHJ5OiBbJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9NYXNzQnVpbGRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL3ZpZXdzL2RyeS9mb3Jtcy9SaWNoU2VxdWVuY2VJbnB1dCcsICdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldyddLAogICAgICAgIG1hdGNoOiBbJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50VmlldycsICdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsICdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoR3JpZFZhbHVlc1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFNsaW1WaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9TcGVjdHJhUGFpckFsaWdubWVudEljb24nXSwKICAgICAgICB1dGlsczogWydmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJ10KICAgIH0KCiAgICBjb25zdCBjbGFzc1BhdGhzID0gW107CiAgICB2YXIgYWxsID0gW107CiAgICB2YXIgdHlwZTJjYXQgPSB7fTsKCiAgICBbJ3dldCcsICdkcnknLCAnbWF0Y2gnLCAndXRpbHMnXS5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHsKICAgICAgICB2YXIgbCA9IGV4cG9ydGVkW2NhdF07CiAgICAgICAgZm9yIChpIGluIGwpIHsKICAgICAgICAgICAgdmFyIHR5cGUgPSBsW2ldOwogICAgICAgICAgICB0eXBlMmNhdFt0eXBlXSA9IGNhdDsKICAgICAgICAgICAgYWxsLnB1c2godHlwZSk7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyIGJ1aWxkRXhwb3J0ID0gZnVuY3Rpb24gKF8pIHsKICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgdmFyICQgPSBhcmdzLnNoaWZ0KCk7CiAgICAgICAgdmFyIGV4cCA9IHt9CiAgICAgICAgZm9yIChpIGluIGFsbCkgewogICAgICAgICAgICB2YXIgYXJnID0gYXJnc1tpXTsKICAgICAgICAgICAgdmFyIHR5cGUgPSBhbGxbaV0KICAgICAgICAgICAgdmFyIHNpbXBsZU5hbWUgPSB0eXBlLnJlcGxhY2UoLy4qXC8vLCAnJyk7CiAgICAgICAgICAgIHZhciBjYXQgPSB0eXBlMmNhdFt0eXBlXTsKCiAgICAgICAgICAgIGlmIChleHBbY2F0XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBleHBbY2F0XSA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV4cFtjYXRdW3NpbXBsZU5hbWVdID0gYXJnc1tpXTsKICAgICAgICB9CiAgICAgICAgZXhwLmRlcHMgPSB7CiAgICAgICAgICAgICckJzogJAogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH07CgogICAgZGVmaW5lKCdNU01TSlNFeHBvcnQnLFsKICAgICAgICAnanF1ZXJ5JywKICAgICAgICAnQ29uZmlnJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L0V4cE1TTVNTcGVjdHJ1bScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvTVNNU1J1bicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9JbmplY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwZXJpbWVudCcsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L1hJQ0NvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvTXVsdGlYSUNWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvWElDTXVsdGlQYW5lVmlldycsICdmaXNodG9uZXMvdmlld3Mvd2V0L1NwZWN0cnVtVmlldycsCiAgICAgICAgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9NYXNzQnVpbGRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL3ZpZXdzL2RyeS9mb3Jtcy9SaWNoU2VxdWVuY2VJbnB1dCcsICdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldycsCiAgICAgICAgJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50VmlldycsICdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsICdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoR3JpZFZhbHVlc1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFNsaW1WaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9TcGVjdHJhUGFpckFsaWdubWVudEljb24nLAogICAgICAgICdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJywKICAgIF0sIGJ1aWxkRXhwb3J0KTsKCn0pKCk7CgogICAgcmV0dXJuIHJlcXVpcmUoJ01TTVNKU0V4cG9ydCcpOwp9KSk7",
                "body": "LyoqCiAqIHBWaXogYWxsIGJ1bmRsZWQgZmlsZSwgd2l0aCBkZXBlbmRlbmNpZXMKCgogKiBqUXVlcnkgdjEuOC4zIGpxdWVyeS5jb20gfCBqcXVlcnkub3JnL2xpY2Vuc2UKICogYm9vdHN0cmFwIDMuMCBUaGUgTUlUICBMaWNlbnNlIChNSVQpIENvcHlyaWdodCAoYykgMjAxMyBUd2l0dGVyLCBJbmMKICogZDMudjMuanMgQ29weXJpZ2h0IChjKSAyMDEzLCBNaWNoYWVsIEJvc3RvY2sgQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogYmFja2JvbmVqcy5vcmcgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTMgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkCiAqIHVuZGVyc2NvcmUuanMgQ29weXJpZ2h0IChjKSAyMDA5LTIwMTMgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKIAogKiBmaXNodG9uZXMtanMKICogQ29weXJpZ2h0IChjKSAyMDEzLCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAgCiAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3JtcyBhcmUgcGVybWl0dGVkCnByb3ZpZGVkIHRoYXQgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGFyYWdyYXBoIGFyZQkKZHVwbGljYXRlZCBpbiBhbGwgc3VjaCBmb3JtcyBhbmQgdGhhdCBhbnkgZG9jdW1lbnRhdGlvbiwKYWR2ZXJ0aXNpbmcgbWF0ZXJpYWxzLCBhbmQgb3RoZXIgbWF0ZXJpYWxzIHJlbGF0ZWQgdG8gc3VjaApkaXN0cmlidXRpb24gYW5kIHVzZSBhY2tub3dsZWRnZSB0aGF0IHRoZSBzb2Z0d2FyZSB3YXMgZGV2ZWxvcGVkCmJ5IHRoZSBCaW9pbmZvcm1hdGljcyBhbmQgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaCBJbmMuICBUaGUgbmFtZSBvZgpHZW5lbnRlY2ggbWF5IG5vdCBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkCmZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBgYEFTIElTJycgQU5EIFdJVEhPVVQgQU5ZIEVYUFJFU1MgT1IKSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIFdJVEhPVVQgTElNSVRBVElPTiwgVEhFIElNUExJRUQKV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLgoKICovCgoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgIAogICAgICAgIGRlZmluZShmYWN0b3J5KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy9Ccm93c2VyIGdsb2JhbHMgY2FzZS4gSnVzdCBhc3NpZ24gdGhlCiAgICAgICAgLy9yZXN1bHQgdG8gYSBwcm9wZXJ0eSBvbiB0aGUgZ2xvYmFsLgogICAgICAgIHJvb3QuZmlzaHRvbmVzID0gZmFjdG9yeSgpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uICgpIHsKICAgIC8vYWxtb25kLCBhbmQgeW91ciBtb2R1bGVzIHdpbGwgYmUgaW5saW5lZCBoZXJlCiAgICAKLyoqCiAqIGFsbW9uZCAwLjIuNSBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxMiwgVGhlIERvam8gRm91bmRhdGlvbiBBbGwgUmlnaHRzIFJlc2VydmVkLgogKiBBdmFpbGFibGUgdmlhIHRoZSBNSVQgb3IgbmV3IEJTRCBsaWNlbnNlLgogKiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvYWxtb25kIGZvciBkZXRhaWxzCiAqLwovL0dvaW5nIHNsb3BweSB0byBhdm9pZCAndXNlIHN0cmljdCcgc3RyaW5nIGNvc3QsIGJ1dCBzdHJpY3QgcHJhY3RpY2VzIHNob3VsZAovL2JlIGZvbGxvd2VkLgovKmpzbGludCBzbG9wcHk6IHRydWUgKi8KLypnbG9iYWwgc2V0VGltZW91dDogZmFsc2UgKi8KCnZhciByZXF1aXJlanMsIHJlcXVpcmUsIGRlZmluZTsKKGZ1bmN0aW9uICh1bmRlZikgewogICAgdmFyIG1haW4sIHJlcSwgbWFrZU1hcCwgaGFuZGxlcnMsCiAgICAgICAgZGVmaW5lZCA9IHt9LAogICAgICAgIHdhaXRpbmcgPSB7fSwKICAgICAgICBjb25maWcgPSB7fSwKICAgICAgICBkZWZpbmluZyA9IHt9LAogICAgICAgIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksCiAgICAgICAgYXBzID0gW10uc2xpY2U7CgogICAgZnVuY3Rpb24gaGFzUHJvcChvYmosIHByb3ApIHsKICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwob2JqLCBwcm9wKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdpdmVuIGEgcmVsYXRpdmUgbW9kdWxlIG5hbWUsIGxpa2UgLi9zb21ldGhpbmcsIG5vcm1hbGl6ZSBpdCB0bwogICAgICogYSByZWFsIG5hbWUgdGhhdCBjYW4gYmUgbWFwcGVkIHRvIGEgcGF0aC4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIHRoZSByZWxhdGl2ZSBuYW1lCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYmFzZU5hbWUgYSByZWFsIG5hbWUgdGhhdCB0aGUgbmFtZSBhcmcgaXMgcmVsYXRpdmUKICAgICAqIHRvLgogICAgICogQHJldHVybnMge1N0cmluZ30gbm9ybWFsaXplZCBuYW1lCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZShuYW1lLCBiYXNlTmFtZSkgewogICAgICAgIHZhciBuYW1lUGFydHMsIG5hbWVTZWdtZW50LCBtYXBWYWx1ZSwgZm91bmRNYXAsCiAgICAgICAgICAgIGZvdW5kSSwgZm91bmRTdGFyTWFwLCBzdGFySSwgaSwgaiwgcGFydCwKICAgICAgICAgICAgYmFzZVBhcnRzID0gYmFzZU5hbWUgJiYgYmFzZU5hbWUuc3BsaXQoIi8iKSwKICAgICAgICAgICAgbWFwID0gY29uZmlnLm1hcCwKICAgICAgICAgICAgc3Rhck1hcCA9IChtYXAgJiYgbWFwWycqJ10pIHx8IHt9OwoKICAgICAgICAvL0FkanVzdCBhbnkgcmVsYXRpdmUgcGF0aHMuCiAgICAgICAgaWYgKG5hbWUgJiYgbmFtZS5jaGFyQXQoMCkgPT09ICIuIikgewogICAgICAgICAgICAvL0lmIGhhdmUgYSBiYXNlIG5hbWUsIHRyeSB0byBub3JtYWxpemUgYWdhaW5zdCBpdCwKICAgICAgICAgICAgLy9vdGhlcndpc2UsIGFzc3VtZSBpdCBpcyBhIHRvcC1sZXZlbCByZXF1aXJlIHRoYXQgd2lsbAogICAgICAgICAgICAvL2JlIHJlbGF0aXZlIHRvIGJhc2VVcmwgaW4gdGhlIGVuZC4KICAgICAgICAgICAgaWYgKGJhc2VOYW1lKSB7CiAgICAgICAgICAgICAgICAvL0NvbnZlcnQgYmFzZU5hbWUgdG8gYXJyYXksIGFuZCBsb3Agb2ZmIHRoZSBsYXN0IHBhcnQsCiAgICAgICAgICAgICAgICAvL3NvIHRoYXQgLiBtYXRjaGVzIHRoYXQgImRpcmVjdG9yeSIgYW5kIG5vdCBuYW1lIG9mIHRoZSBiYXNlTmFtZSdzCiAgICAgICAgICAgICAgICAvL21vZHVsZS4gRm9yIGluc3RhbmNlLCBiYXNlTmFtZSBvZiAib25lL3R3by90aHJlZSIsIG1hcHMgdG8KICAgICAgICAgICAgICAgIC8vIm9uZS90d28vdGhyZWUuanMiLCBidXQgd2Ugd2FudCB0aGUgZGlyZWN0b3J5LCAib25lL3R3byIgZm9yCiAgICAgICAgICAgICAgICAvL3RoaXMgbm9ybWFsaXphdGlvbi4KICAgICAgICAgICAgICAgIGJhc2VQYXJ0cyA9IGJhc2VQYXJ0cy5zbGljZSgwLCBiYXNlUGFydHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICAgICAgbmFtZSA9IGJhc2VQYXJ0cy5jb25jYXQobmFtZS5zcGxpdCgiLyIpKTsKCiAgICAgICAgICAgICAgICAvL3N0YXJ0IHRyaW1Eb3RzCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbmFtZS5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgICAgIHBhcnQgPSBuYW1lW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0ID09PSAiLiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnQgPT09ICIuLiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDEgJiYgKG5hbWVbMl0gPT09ICcuLicgfHwgbmFtZVswXSA9PT0gJy4uJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRW5kIG9mIHRoZSBsaW5lLiBLZWVwIGF0IGxlYXN0IG9uZSBub24tZG90CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3BhdGggc2VnbWVudCBhdCB0aGUgZnJvbnQgc28gaXQgY2FuIGJlIG1hcHBlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb3JyZWN0bHkgdG8gZGlzay4gT3RoZXJ3aXNlLCB0aGVyZSBpcyBsaWtlbHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbm8gcGF0aCBtYXBwaW5nIGZvciBhIHBhdGggc3RhcnRpbmcgd2l0aCAnLi4nLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9UaGlzIGNhbiBzdGlsbCBmYWlsLCBidXQgY2F0Y2hlcyB0aGUgbW9zdCByZWFzb25hYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VzZXMgb2YgLi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lLnNwbGljZShpIC0gMSwgMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpIC09IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2VuZCB0cmltRG90cwoKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLmpvaW4oIi8iKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluZGV4T2YoJy4vJykgPT09IDApIHsKICAgICAgICAgICAgICAgIC8vIE5vIGJhc2VOYW1lLCBzbyB0aGlzIGlzIElEIGlzIHJlc29sdmVkIHJlbGF0aXZlCiAgICAgICAgICAgICAgICAvLyB0byBiYXNlVXJsLCBwdWxsIG9mZiB0aGUgbGVhZGluZyBkb3QuCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vQXBwbHkgbWFwIGNvbmZpZyBpZiBhdmFpbGFibGUuCiAgICAgICAgaWYgKChiYXNlUGFydHMgfHwgc3Rhck1hcCkgJiYgbWFwKSB7CiAgICAgICAgICAgIG5hbWVQYXJ0cyA9IG5hbWUuc3BsaXQoJy8nKTsKCiAgICAgICAgICAgIGZvciAoaSA9IG5hbWVQYXJ0cy5sZW5ndGg7IGkgPiAwOyBpIC09IDEpIHsKICAgICAgICAgICAgICAgIG5hbWVTZWdtZW50ID0gbmFtZVBhcnRzLnNsaWNlKDAsIGkpLmpvaW4oIi8iKTsKCiAgICAgICAgICAgICAgICBpZiAoYmFzZVBhcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgLy9GaW5kIHRoZSBsb25nZXN0IGJhc2VOYW1lIHNlZ21lbnQgbWF0Y2ggaW4gdGhlIGNvbmZpZy4KICAgICAgICAgICAgICAgICAgICAvL1NvLCBkbyBqb2lucyBvbiB0aGUgYmlnZ2VzdCB0byBzbWFsbGVzdCBsZW5ndGhzIG9mIGJhc2VQYXJ0cy4KICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSBiYXNlUGFydHMubGVuZ3RoOyBqID4gMDsgaiAtPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcFZhbHVlID0gbWFwW2Jhc2VQYXJ0cy5zbGljZSgwLCBqKS5qb2luKCcvJyldOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9iYXNlTmFtZSBzZWdtZW50IGhhcyAgY29uZmlnLCBmaW5kIGlmIGl0IGhhcyBvbmUgZm9yCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcyBuYW1lLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcFZhbHVlID0gbWFwVmFsdWVbbmFtZVNlZ21lbnRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9NYXRjaCwgdXBkYXRlIG5hbWUgdG8gdGhlIG5ldyB2YWx1ZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZE1hcCA9IG1hcFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kSSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGZvdW5kTWFwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9DaGVjayBmb3IgYSBzdGFyIG1hcCBtYXRjaCwgYnV0IGp1c3QgaG9sZCBvbiB0byBpdCwKICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgYSBzaG9ydGVyIHNlZ21lbnQgbWF0Y2ggbGF0ZXIgaW4gYSBtYXRjaGluZwogICAgICAgICAgICAgICAgLy9jb25maWcsIHRoZW4gZmF2b3Igb3ZlciB0aGlzIHN0YXIgbWFwLgogICAgICAgICAgICAgICAgaWYgKCFmb3VuZFN0YXJNYXAgJiYgc3Rhck1hcCAmJiBzdGFyTWFwW25hbWVTZWdtZW50XSkgewogICAgICAgICAgICAgICAgICAgIGZvdW5kU3Rhck1hcCA9IHN0YXJNYXBbbmFtZVNlZ21lbnRdOwogICAgICAgICAgICAgICAgICAgIHN0YXJJID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFmb3VuZE1hcCAmJiBmb3VuZFN0YXJNYXApIHsKICAgICAgICAgICAgICAgIGZvdW5kTWFwID0gZm91bmRTdGFyTWFwOwogICAgICAgICAgICAgICAgZm91bmRJID0gc3Rhckk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmb3VuZE1hcCkgewogICAgICAgICAgICAgICAgbmFtZVBhcnRzLnNwbGljZSgwLCBmb3VuZEksIGZvdW5kTWFwKTsKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lUGFydHMuam9pbignLycpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlUmVxdWlyZShyZWxOYW1lLCBmb3JjZVN5bmMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvL0EgdmVyc2lvbiBvZiBhIHJlcXVpcmUgZnVuY3Rpb24gdGhhdCBwYXNzZXMgYSBtb2R1bGVOYW1lCiAgICAgICAgICAgIC8vdmFsdWUgZm9yIGl0ZW1zIHRoYXQgbWF5IG5lZWQgdG8KICAgICAgICAgICAgLy9sb29rIHVwIHBhdGhzIHJlbGF0aXZlIHRvIHRoZSBtb2R1bGVOYW1lCiAgICAgICAgICAgIHJldHVybiByZXEuYXBwbHkodW5kZWYsIGFwcy5jYWxsKGFyZ3VtZW50cywgMCkuY29uY2F0KFtyZWxOYW1lLCBmb3JjZVN5bmNdKSk7CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlTm9ybWFsaXplKHJlbE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VMb2FkKGRlcE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgIGRlZmluZWRbZGVwTmFtZV0gPSB2YWx1ZTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxEZXAobmFtZSkgewogICAgICAgIGlmIChoYXNQcm9wKHdhaXRpbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHZhciBhcmdzID0gd2FpdGluZ1tuYW1lXTsKICAgICAgICAgICAgZGVsZXRlIHdhaXRpbmdbbmFtZV07CiAgICAgICAgICAgIGRlZmluaW5nW25hbWVdID0gdHJ1ZTsKICAgICAgICAgICAgbWFpbi5hcHBseSh1bmRlZiwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWhhc1Byb3AoZGVmaW5lZCwgbmFtZSkgJiYgIWhhc1Byb3AoZGVmaW5pbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gJyArIG5hbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVmaW5lZFtuYW1lXTsKICAgIH0KCiAgICAvL1R1cm5zIGEgcGx1Z2luIXJlc291cmNlIHRvIFtwbHVnaW4sIHJlc291cmNlXQogICAgLy93aXRoIHRoZSBwbHVnaW4gYmVpbmcgdW5kZWZpbmVkIGlmIHRoZSBuYW1lCiAgICAvL2RpZCBub3QgaGF2ZSBhIHBsdWdpbiBwcmVmaXguCiAgICBmdW5jdGlvbiBzcGxpdFByZWZpeChuYW1lKSB7CiAgICAgICAgdmFyIHByZWZpeCwKICAgICAgICAgICAgaW5kZXggPSBuYW1lID8gbmFtZS5pbmRleE9mKCchJykgOiAtMTsKICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICBwcmVmaXggPSBuYW1lLnN1YnN0cmluZygwLCBpbmRleCk7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhpbmRleCArIDEsIG5hbWUubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFtwcmVmaXgsIG5hbWVdOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZXMgYSBuYW1lIG1hcCwgbm9ybWFsaXppbmcgdGhlIG5hbWUsIGFuZCB1c2luZyBhIHBsdWdpbgogICAgICogZm9yIG5vcm1hbGl6YXRpb24gaWYgbmVjZXNzYXJ5LiBHcmFicyBhIHJlZiB0byBwbHVnaW4KICAgICAqIHRvbywgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICovCiAgICBtYWtlTWFwID0gZnVuY3Rpb24gKG5hbWUsIHJlbE5hbWUpIHsKICAgICAgICB2YXIgcGx1Z2luLAogICAgICAgICAgICBwYXJ0cyA9IHNwbGl0UHJlZml4KG5hbWUpLAogICAgICAgICAgICBwcmVmaXggPSBwYXJ0c1swXTsKCiAgICAgICAgbmFtZSA9IHBhcnRzWzFdOwoKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIHByZWZpeCA9IG5vcm1hbGl6ZShwcmVmaXgsIHJlbE5hbWUpOwogICAgICAgICAgICBwbHVnaW4gPSBjYWxsRGVwKHByZWZpeCk7CiAgICAgICAgfQoKICAgICAgICAvL05vcm1hbGl6ZSBhY2NvcmRpbmcKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIGlmIChwbHVnaW4gJiYgcGx1Z2luLm5vcm1hbGl6ZSkgewogICAgICAgICAgICAgICAgbmFtZSA9IHBsdWdpbi5ub3JtYWxpemUobmFtZSwgbWFrZU5vcm1hbGl6ZShyZWxOYW1lKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplKG5hbWUsIHJlbE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmFtZSA9IG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICAgICAgcGFydHMgPSBzcGxpdFByZWZpeChuYW1lKTsKICAgICAgICAgICAgcHJlZml4ID0gcGFydHNbMF07CiAgICAgICAgICAgIG5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICAgICAgcGx1Z2luID0gY2FsbERlcChwcmVmaXgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1VzaW5nIHJpZGljdWxvdXMgcHJvcGVydHkgbmFtZXMgZm9yIHNwYWNlIHJlYXNvbnMKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmOiBwcmVmaXggPyBwcmVmaXggKyAnIScgKyBuYW1lIDogbmFtZSwgLy9mdWxsTmFtZQogICAgICAgICAgICBuOiBuYW1lLAogICAgICAgICAgICBwcjogcHJlZml4LAogICAgICAgICAgICBwOiBwbHVnaW4KICAgICAgICB9OwogICAgfTsKCiAgICBmdW5jdGlvbiBtYWtlQ29uZmlnKG5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKGNvbmZpZyAmJiBjb25maWcuY29uZmlnICYmIGNvbmZpZy5jb25maWdbbmFtZV0pIHx8IHt9OwogICAgICAgIH07CiAgICB9CgogICAgaGFuZGxlcnMgPSB7CiAgICAgICAgcmVxdWlyZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG1ha2VSZXF1aXJlKG5hbWUpOwogICAgICAgIH0sCiAgICAgICAgZXhwb3J0czogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgdmFyIGUgPSBkZWZpbmVkW25hbWVdOwogICAgICAgICAgICBpZiAodHlwZW9mIGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAoZGVmaW5lZFtuYW1lXSA9IHt9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbW9kdWxlOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IG5hbWUsCiAgICAgICAgICAgICAgICB1cmk6ICcnLAogICAgICAgICAgICAgICAgZXhwb3J0czogZGVmaW5lZFtuYW1lXSwKICAgICAgICAgICAgICAgIGNvbmZpZzogbWFrZUNvbmZpZyhuYW1lKQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH07CgogICAgbWFpbiA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSkgewogICAgICAgIHZhciBjanNNb2R1bGUsIGRlcE5hbWUsIHJldCwgbWFwLCBpLAogICAgICAgICAgICBhcmdzID0gW10sCiAgICAgICAgICAgIHVzaW5nRXhwb3J0czsKCiAgICAgICAgLy9Vc2UgbmFtZSBpZiBubyByZWxOYW1lCiAgICAgICAgcmVsTmFtZSA9IHJlbE5hbWUgfHwgbmFtZTsKCiAgICAgICAgLy9DYWxsIHRoZSBjYWxsYmFjayB0byBkZWZpbmUgdGhlIG1vZHVsZSwgaWYgbmVjZXNzYXJ5LgogICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKCiAgICAgICAgICAgIC8vUHVsbCBvdXQgdGhlIGRlZmluZWQgZGVwZW5kZW5jaWVzIGFuZCBwYXNzIHRoZSBvcmRlcmVkCiAgICAgICAgICAgIC8vdmFsdWVzIHRvIHRoZSBjYWxsYmFjay4KICAgICAgICAgICAgLy9EZWZhdWx0IHRvIFtyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGVdIGlmIG5vIGRlcHMKICAgICAgICAgICAgZGVwcyA9ICFkZXBzLmxlbmd0aCAmJiBjYWxsYmFjay5sZW5ndGggPyBbJ3JlcXVpcmUnLCAnZXhwb3J0cycsICdtb2R1bGUnXSA6IGRlcHM7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBkZXBzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICBtYXAgPSBtYWtlTWFwKGRlcHNbaV0sIHJlbE5hbWUpOwogICAgICAgICAgICAgICAgZGVwTmFtZSA9IG1hcC5mOwoKICAgICAgICAgICAgICAgIC8vRmFzdCBwYXRoIENvbW1vbkpTIHN0YW5kYXJkIGRlcGVuZGVuY2llcy4KICAgICAgICAgICAgICAgIGlmIChkZXBOYW1lID09PSAicmVxdWlyZSIpIHsKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gaGFuZGxlcnMucmVxdWlyZShuYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVwTmFtZSA9PT0gImV4cG9ydHMiKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Db21tb25KUyBtb2R1bGUgc3BlYyAxLjEKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gaGFuZGxlcnMuZXhwb3J0cyhuYW1lKTsKICAgICAgICAgICAgICAgICAgICB1c2luZ0V4cG9ydHMgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXBOYW1lID09PSAibW9kdWxlIikgewogICAgICAgICAgICAgICAgICAgIC8vQ29tbW9uSlMgbW9kdWxlIHNwZWMgMS4xCiAgICAgICAgICAgICAgICAgICAgY2pzTW9kdWxlID0gYXJnc1tpXSA9IGhhbmRsZXJzLm1vZHVsZShuYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzUHJvcChkZWZpbmVkLCBkZXBOYW1lKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNQcm9wKHdhaXRpbmcsIGRlcE5hbWUpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1Byb3AoZGVmaW5pbmcsIGRlcE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGNhbGxEZXAoZGVwTmFtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1hcC5wKSB7CiAgICAgICAgICAgICAgICAgICAgbWFwLnAubG9hZChtYXAubiwgbWFrZVJlcXVpcmUocmVsTmFtZSwgdHJ1ZSksIG1ha2VMb2FkKGRlcE5hbWUpLCB7fSk7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGRlZmluZWRbZGVwTmFtZV07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lICsgJyBtaXNzaW5nICcgKyBkZXBOYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0ID0gY2FsbGJhY2suYXBwbHkoZGVmaW5lZFtuYW1lXSwgYXJncyk7CgogICAgICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgICAgICAgLy9JZiBzZXR0aW5nIGV4cG9ydHMgdmlhICJtb2R1bGUiIGlzIGluIHBsYXksCiAgICAgICAgICAgICAgICAvL2Zhdm9yIHRoYXQgb3ZlciByZXR1cm4gdmFsdWUgYW5kIGV4cG9ydHMuIEFmdGVyIHRoYXQsCiAgICAgICAgICAgICAgICAvL2Zhdm9yIGEgbm9uLXVuZGVmaW5lZCByZXR1cm4gdmFsdWUgb3ZlciBleHBvcnRzIHVzZS4KICAgICAgICAgICAgICAgIGlmIChjanNNb2R1bGUgJiYgY2pzTW9kdWxlLmV4cG9ydHMgIT09IHVuZGVmICYmCiAgICAgICAgICAgICAgICAgICAgICAgIGNqc01vZHVsZS5leHBvcnRzICE9PSBkZWZpbmVkW25hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNqc01vZHVsZS5leHBvcnRzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXQgIT09IHVuZGVmIHx8ICF1c2luZ0V4cG9ydHMpIHsKICAgICAgICAgICAgICAgICAgICAvL1VzZSB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uLgogICAgICAgICAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSByZXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG5hbWUpIHsKICAgICAgICAgICAgLy9NYXkganVzdCBiZSBhbiBvYmplY3QgZGVmaW5pdGlvbiBmb3IgdGhlIG1vZHVsZS4gT25seQogICAgICAgICAgICAvL3dvcnJ5IGFib3V0IGRlZmluaW5nIGlmIGhhdmUgYSBtb2R1bGUgbmFtZS4KICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNhbGxiYWNrOwogICAgICAgIH0KICAgIH07CgogICAgcmVxdWlyZWpzID0gcmVxdWlyZSA9IHJlcSA9IGZ1bmN0aW9uIChkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSwgZm9yY2VTeW5jLCBhbHQpIHsKICAgICAgICBpZiAodHlwZW9mIGRlcHMgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGlmIChoYW5kbGVyc1tkZXBzXSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpbiB0aGlzIGNhc2UgaXMgcmVhbGx5IHJlbE5hbWUKICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyc1tkZXBzXShjYWxsYmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9KdXN0IHJldHVybiB0aGUgbW9kdWxlIHdhbnRlZC4gSW4gdGhpcyBzY2VuYXJpbywgdGhlCiAgICAgICAgICAgIC8vZGVwcyBhcmcgaXMgdGhlIG1vZHVsZSBuYW1lLCBhbmQgc2Vjb25kIGFyZyAoaWYgcGFzc2VkKQogICAgICAgICAgICAvL2lzIGp1c3QgdGhlIHJlbE5hbWUuCiAgICAgICAgICAgIC8vTm9ybWFsaXplIG1vZHVsZSBuYW1lLCBpZiBpdCBjb250YWlucyAuIG9yIC4uCiAgICAgICAgICAgIHJldHVybiBjYWxsRGVwKG1ha2VNYXAoZGVwcywgY2FsbGJhY2spLmYpOwogICAgICAgIH0gZWxzZSBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBhIGNvbmZpZyBvYmplY3QsIG5vdCBhbiBhcnJheS4KICAgICAgICAgICAgY29uZmlnID0gZGVwczsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrLnNwbGljZSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpcyBhbiBhcnJheSwgd2hpY2ggbWVhbnMgaXQgaXMgYSBkZXBlbmRlbmN5IGxpc3QuCiAgICAgICAgICAgICAgICAvL0FkanVzdCBhcmdzIGlmIHRoZXJlIGFyZSBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgICAgIGRlcHMgPSBjYWxsYmFjazsKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gcmVsTmFtZTsKICAgICAgICAgICAgICAgIHJlbE5hbWUgPSBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVwcyA9IHVuZGVmOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1N1cHBvcnQgcmVxdWlyZShbJ2EnXSkKICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9OwoKICAgICAgICAvL0lmIHJlbE5hbWUgaXMgYSBmdW5jdGlvbiwgaXQgaXMgYW4gZXJyYmFjayBoYW5kbGVyLAogICAgICAgIC8vc28gcmVtb3ZlIGl0LgogICAgICAgIGlmICh0eXBlb2YgcmVsTmFtZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICByZWxOYW1lID0gZm9yY2VTeW5jOwogICAgICAgICAgICBmb3JjZVN5bmMgPSBhbHQ7CiAgICAgICAgfQoKICAgICAgICAvL1NpbXVsYXRlIGFzeW5jIGNhbGxiYWNrOwogICAgICAgIGlmIChmb3JjZVN5bmMpIHsKICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNpbmcgYSBub24temVybyB2YWx1ZSBiZWNhdXNlIG9mIGNvbmNlcm4gZm9yIHdoYXQgb2xkIGJyb3dzZXJzCiAgICAgICAgICAgIC8vZG8sIGFuZCBsYXRlc3QgYnJvd3NlcnMgInVwZ3JhZGUiIHRvIDQgaWYgbG93ZXIgdmFsdWUgaXMgdXNlZDoKICAgICAgICAgICAgLy9odHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS90aW1lcnMuaHRtbCNkb20td2luZG93dGltZXJzLXNldHRpbWVvdXQ6CiAgICAgICAgICAgIC8vSWYgd2FudCBhIHZhbHVlIGltbWVkaWF0ZWx5LCB1c2UgcmVxdWlyZSgnaWQnKSBpbnN0ZWFkIC0tIHNvbWV0aGluZwogICAgICAgICAgICAvL3RoYXQgd29ya3MgaW4gYWxtb25kIG9uIHRoZSBnbG9iYWwgbGV2ZWwsIGJ1dCBub3QgZ3VhcmFudGVlZCBhbmQKICAgICAgICAgICAgLy91bmxpa2VseSB0byB3b3JrIGluIG90aGVyIEFNRCBpbXBsZW1lbnRhdGlvbnMuCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgICAgICB9LCA0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIC8qKgogICAgICogSnVzdCBkcm9wcyB0aGUgY29uZmlnIG9uIHRoZSBmbG9vciwgYnV0IHJldHVybnMgcmVxIGluIGNhc2UKICAgICAqIHRoZSBjb25maWcgcmV0dXJuIHZhbHVlIGlzIHVzZWQuCiAgICAgKi8KICAgIHJlcS5jb25maWcgPSBmdW5jdGlvbiAoY2ZnKSB7CiAgICAgICAgY29uZmlnID0gY2ZnOwogICAgICAgIGlmIChjb25maWcuZGVwcykgewogICAgICAgICAgICByZXEoY29uZmlnLmRlcHMsIGNvbmZpZy5jYWxsYmFjayk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIGRlZmluZSA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaykgewoKICAgICAgICAvL1RoaXMgbW9kdWxlIG1heSBub3QgaGF2ZSBkZXBlbmRlbmNpZXMKICAgICAgICBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBub3QgYW4gYXJyYXksIHNvIHByb2JhYmx5IG1lYW5zCiAgICAgICAgICAgIC8vYW4gb2JqZWN0IGxpdGVyYWwgb3IgZmFjdG9yeSBmdW5jdGlvbiBmb3IKICAgICAgICAgICAgLy90aGUgdmFsdWUuIEFkanVzdCBhcmdzLgogICAgICAgICAgICBjYWxsYmFjayA9IGRlcHM7CiAgICAgICAgICAgIGRlcHMgPSBbXTsKICAgICAgICB9CgogICAgICAgIGlmICghaGFzUHJvcChkZWZpbmVkLCBuYW1lKSAmJiAhaGFzUHJvcCh3YWl0aW5nLCBuYW1lKSkgewogICAgICAgICAgICB3YWl0aW5nW25hbWVdID0gW25hbWUsIGRlcHMsIGNhbGxiYWNrXTsKICAgICAgICB9CiAgICB9OwoKICAgIGRlZmluZS5hbWQgPSB7CiAgICAgICAgalF1ZXJ5OiB0cnVlCiAgICB9Owp9KCkpOwpkZWZpbmUoIi4uLy4uL2J1aWxkLXV0aWxzL2FsbW9uZCIsIGZ1bmN0aW9uKCl7fSk7CgovKiEKICogalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS45LjEKICogaHR0cDovL2pxdWVyeS5jb20vCiAqCiAqIEluY2x1ZGVzIFNpenpsZS5qcwogKiBodHRwOi8vc2l6emxlanMuY29tLwogKgogKiBDb3B5cmlnaHQgMjAwNSwgMjAxMiBqUXVlcnkgRm91bmRhdGlvbiwgSW5jLiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIERhdGU6IDIwMTMtMi00CiAqLwooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgewoKLy8gQ2FuJ3QgZG8gdGhpcyBiZWNhdXNlIHNldmVyYWwgYXBwcyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQovLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYKLy8geW91IHRyeSB0byB0cmFjZSB0aHJvdWdoICJ1c2Ugc3RyaWN0IiBjYWxsIGNoYWlucy4gKCMxMzMzNSkKLy8gU3VwcG9ydDogRmlyZWZveCAxOCsKLy8KdmFyCgkvLyBUaGUgZGVmZXJyZWQgdXNlZCBvbiBET00gcmVhZHkKCXJlYWR5TGlzdCwKCgkvLyBBIGNlbnRyYWwgcmVmZXJlbmNlIHRvIHRoZSByb290IGpRdWVyeShkb2N1bWVudCkKCXJvb3RqUXVlcnksCgoJLy8gU3VwcG9ydDogSUU8OQoJLy8gRm9yIGB0eXBlb2Ygbm9kZS5tZXRob2RgIGluc3RlYWQgb2YgYG5vZGUubWV0aG9kICE9PSB1bmRlZmluZWRgCgljb3JlX3N0cnVuZGVmaW5lZCA9IHR5cGVvZiB1bmRlZmluZWQsCgoJLy8gVXNlIHRoZSBjb3JyZWN0IGRvY3VtZW50IGFjY29yZGluZ2x5IHdpdGggd2luZG93IGFyZ3VtZW50IChzYW5kYm94KQoJZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQsCglsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbiwKCgkvLyBNYXAgb3ZlciBqUXVlcnkgaW4gY2FzZSBvZiBvdmVyd3JpdGUKCV9qUXVlcnkgPSB3aW5kb3cualF1ZXJ5LAoKCS8vIE1hcCBvdmVyIHRoZSAkIGluIGNhc2Ugb2Ygb3ZlcndyaXRlCglfJCA9IHdpbmRvdy4kLAoKCS8vIFtbQ2xhc3NdXSAtPiB0eXBlIHBhaXJzCgljbGFzczJ0eXBlID0ge30sCgoJLy8gTGlzdCBvZiBkZWxldGVkIGRhdGEgY2FjaGUgaWRzLCBzbyB3ZSBjYW4gcmV1c2UgdGhlbQoJY29yZV9kZWxldGVkSWRzID0gW10sCgoJY29yZV92ZXJzaW9uID0gIjEuOS4xIiwKCgkvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHNvbWUgY29yZSBtZXRob2RzCgljb3JlX2NvbmNhdCA9IGNvcmVfZGVsZXRlZElkcy5jb25jYXQsCgljb3JlX3B1c2ggPSBjb3JlX2RlbGV0ZWRJZHMucHVzaCwKCWNvcmVfc2xpY2UgPSBjb3JlX2RlbGV0ZWRJZHMuc2xpY2UsCgljb3JlX2luZGV4T2YgPSBjb3JlX2RlbGV0ZWRJZHMuaW5kZXhPZiwKCWNvcmVfdG9TdHJpbmcgPSBjbGFzczJ0eXBlLnRvU3RyaW5nLAoJY29yZV9oYXNPd24gPSBjbGFzczJ0eXBlLmhhc093blByb3BlcnR5LAoJY29yZV90cmltID0gY29yZV92ZXJzaW9uLnRyaW0sCgoJLy8gRGVmaW5lIGEgbG9jYWwgY29weSBvZiBqUXVlcnkKCWpRdWVyeSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQkvLyBUaGUgalF1ZXJ5IG9iamVjdCBpcyBhY3R1YWxseSBqdXN0IHRoZSBpbml0IGNvbnN0cnVjdG9yICdlbmhhbmNlZCcKCQlyZXR1cm4gbmV3IGpRdWVyeS5mbi5pbml0KCBzZWxlY3RvciwgY29udGV4dCwgcm9vdGpRdWVyeSApOwoJfSwKCgkvLyBVc2VkIGZvciBtYXRjaGluZyBudW1iZXJzCgljb3JlX3BudW0gPSAvWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSwKCgkvLyBVc2VkIGZvciBzcGxpdHRpbmcgb24gd2hpdGVzcGFjZQoJY29yZV9ybm90d2hpdGUgPSAvXFMrL2csCgoJLy8gTWFrZSBzdXJlIHdlIHRyaW0gQk9NIGFuZCBOQlNQIChoZXJlJ3MgbG9va2luZyBhdCB5b3UsIFNhZmFyaSA1LjAgYW5kIElFKQoJcnRyaW0gPSAvXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2csCgoJLy8gQSBzaW1wbGUgd2F5IHRvIGNoZWNrIGZvciBIVE1MIHN0cmluZ3MKCS8vIFByaW9yaXRpemUgI2lkIG92ZXIgPHRhZz4gdG8gYXZvaWQgWFNTIHZpYSBsb2NhdGlvbi5oYXNoICgjOTUyMSkKCS8vIFN0cmljdCBIVE1MIHJlY29nbml0aW9uICgjMTEyOTA6IG11c3Qgc3RhcnQgd2l0aCA8KQoJcnF1aWNrRXhwciA9IC9eKD86KDxbXHdcV10rPilbXj5dKnwjKFtcdy1dKikpJC8sCgoJLy8gTWF0Y2ggYSBzdGFuZGFsb25lIHRhZwoJcnNpbmdsZVRhZyA9IC9ePChcdyspXHMqXC8/Pig/OjxcL1wxPnwpJC8sCgoJLy8gSlNPTiBSZWdFeHAKCXJ2YWxpZGNoYXJzID0gL15bXF0sOnt9XHNdKiQvLAoJcnZhbGlkYnJhY2VzID0gLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywKCXJ2YWxpZGVzY2FwZSA9IC9cXCg/OlsiXFxcL2JmbnJ0XXx1W1xkYS1mQS1GXXs0fSkvZywKCXJ2YWxpZHRva2VucyA9IC8iW14iXFxcclxuXSoifHRydWV8ZmFsc2V8bnVsbHwtPyg/OlxkK1wufClcZCsoPzpbZUVdWystXT9cZCt8KS9nLAoKCS8vIE1hdGNoZXMgZGFzaGVkIHN0cmluZyBmb3IgY2FtZWxpemluZwoJcm1zUHJlZml4ID0gL14tbXMtLywKCXJkYXNoQWxwaGEgPSAvLShbXGRhLXpdKS9naSwKCgkvLyBVc2VkIGJ5IGpRdWVyeS5jYW1lbENhc2UgYXMgY2FsbGJhY2sgdG8gcmVwbGFjZSgpCglmY2FtZWxDYXNlID0gZnVuY3Rpb24oIGFsbCwgbGV0dGVyICkgewoJCXJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsKCX0sCgoJLy8gVGhlIHJlYWR5IGV2ZW50IGhhbmRsZXIKCWNvbXBsZXRlZCA9IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJLy8gcmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiBpcyBnb29kIGVub3VnaCBmb3IgdXMgdG8gY2FsbCB0aGUgZG9tIHJlYWR5IGluIG9sZElFCgkJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIHx8IGV2ZW50LnR5cGUgPT09ICJsb2FkIiB8fCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgewoJCQlkZXRhY2goKTsKCQkJalF1ZXJ5LnJlYWR5KCk7CgkJfQoJfSwKCS8vIENsZWFuLXVwIG1ldGhvZCBmb3IgZG9tIHJlYWR5IGV2ZW50cwoJZGV0YWNoID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICkgewoJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAiRE9NQ29udGVudExvYWRlZCIsIGNvbXBsZXRlZCwgZmFsc2UgKTsKCQkJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoKCQl9IGVsc2UgewoJCQlkb2N1bWVudC5kZXRhY2hFdmVudCggIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCApOwoJCQl3aW5kb3cuZGV0YWNoRXZlbnQoICJvbmxvYWQiLCBjb21wbGV0ZWQgKTsKCQl9Cgl9OwoKalF1ZXJ5LmZuID0galF1ZXJ5LnByb3RvdHlwZSA9IHsKCS8vIFRoZSBjdXJyZW50IHZlcnNpb24gb2YgalF1ZXJ5IGJlaW5nIHVzZWQKCWpxdWVyeTogY29yZV92ZXJzaW9uLAoKCWNvbnN0cnVjdG9yOiBqUXVlcnksCglpbml0OiBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHJvb3RqUXVlcnkgKSB7CgkJdmFyIG1hdGNoLCBlbGVtOwoKCQkvLyBIQU5ETEU6ICQoIiIpLCAkKG51bGwpLCAkKHVuZGVmaW5lZCksICQoZmFsc2UpCgkJaWYgKCAhc2VsZWN0b3IgKSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJLy8gSGFuZGxlIEhUTUwgc3RyaW5ncwoJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJaWYgKCBzZWxlY3Rvci5jaGFyQXQoMCkgPT09ICI8IiAmJiBzZWxlY3Rvci5jaGFyQXQoIHNlbGVjdG9yLmxlbmd0aCAtIDEgKSA9PT0gIj4iICYmIHNlbGVjdG9yLmxlbmd0aCA+PSAzICkgewoJCQkJLy8gQXNzdW1lIHRoYXQgc3RyaW5ncyB0aGF0IHN0YXJ0IGFuZCBlbmQgd2l0aCA8PiBhcmUgSFRNTCBhbmQgc2tpcCB0aGUgcmVnZXggY2hlY2sKCQkJCW1hdGNoID0gWyBudWxsLCBzZWxlY3RvciwgbnVsbCBdOwoKCQkJfSBlbHNlIHsKCQkJCW1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApOwoJCQl9CgoJCQkvLyBNYXRjaCBodG1sIG9yIG1ha2Ugc3VyZSBubyBjb250ZXh0IGlzIHNwZWNpZmllZCBmb3IgI2lkCgkJCWlmICggbWF0Y2ggJiYgKG1hdGNoWzFdIHx8ICFjb250ZXh0KSApIHsKCgkJCQkvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKCQkJCWlmICggbWF0Y2hbMV0gKSB7CgkJCQkJY29udGV4dCA9IGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZXh0WzBdIDogY29udGV4dDsKCgkJCQkJLy8gc2NyaXB0cyBpcyB0cnVlIGZvciBiYWNrLWNvbXBhdAoJCQkJCWpRdWVyeS5tZXJnZSggdGhpcywgalF1ZXJ5LnBhcnNlSFRNTCgKCQkJCQkJbWF0Y2hbMV0sCgkJCQkJCWNvbnRleHQgJiYgY29udGV4dC5ub2RlVHlwZSA/IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0IDogZG9jdW1lbnQsCgkJCQkJCXRydWUKCQkJCQkpICk7CgoJCQkJCS8vIEhBTkRMRTogJChodG1sLCBwcm9wcykKCQkJCQlpZiAoIHJzaW5nbGVUYWcudGVzdCggbWF0Y2hbMV0gKSAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdCggY29udGV4dCApICkgewoJCQkJCQlmb3IgKCBtYXRjaCBpbiBjb250ZXh0ICkgewoJCQkJCQkJLy8gUHJvcGVydGllcyBvZiBjb250ZXh0IGFyZSBjYWxsZWQgYXMgbWV0aG9kcyBpZiBwb3NzaWJsZQoJCQkJCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdGhpc1sgbWF0Y2ggXSApICkgewoJCQkJCQkJCXRoaXNbIG1hdGNoIF0oIGNvbnRleHRbIG1hdGNoIF0gKTsKCgkJCQkJCQkvLyAuLi5hbmQgb3RoZXJ3aXNlIHNldCBhcyBhdHRyaWJ1dGVzCgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRoaXMuYXR0ciggbWF0Y2gsIGNvbnRleHRbIG1hdGNoIF0gKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJcmV0dXJuIHRoaXM7CgoJCQkJLy8gSEFORExFOiAkKCNpZCkKCQkJCX0gZWxzZSB7CgkJCQkJZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtYXRjaFsyXSApOwoKCQkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMKCQkJCQlpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCQkvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUgYW5kIE9wZXJhIHJldHVybiBpdGVtcwoJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJaWYgKCBlbGVtLmlkICE9PSBtYXRjaFsyXSApIHsKCQkJCQkJCXJldHVybiByb290alF1ZXJ5LmZpbmQoIHNlbGVjdG9yICk7CgkJCQkJCX0KCgkJCQkJCS8vIE90aGVyd2lzZSwgd2UgaW5qZWN0IHRoZSBlbGVtZW50IGRpcmVjdGx5IGludG8gdGhlIGpRdWVyeSBvYmplY3QKCQkJCQkJdGhpcy5sZW5ndGggPSAxOwoJCQkJCQl0aGlzWzBdID0gZWxlbTsKCQkJCQl9CgoJCQkJCXRoaXMuY29udGV4dCA9IGRvY3VtZW50OwoJCQkJCXRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCgkJCS8vIEhBTkRMRTogJChleHByLCAkKC4uLikpCgkJCX0gZWxzZSBpZiAoICFjb250ZXh0IHx8IGNvbnRleHQuanF1ZXJ5ICkgewoJCQkJcmV0dXJuICggY29udGV4dCB8fCByb290alF1ZXJ5ICkuZmluZCggc2VsZWN0b3IgKTsKCgkJCS8vIEhBTkRMRTogJChleHByLCBjb250ZXh0KQoJCQkvLyAod2hpY2ggaXMganVzdCBlcXVpdmFsZW50IHRvOiAkKGNvbnRleHQpLmZpbmQoZXhwcikKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yKCBjb250ZXh0ICkuZmluZCggc2VsZWN0b3IgKTsKCQkJfQoKCQkvLyBIQU5ETEU6ICQoRE9NRWxlbWVudCkKCQl9IGVsc2UgaWYgKCBzZWxlY3Rvci5ub2RlVHlwZSApIHsKCQkJdGhpcy5jb250ZXh0ID0gdGhpc1swXSA9IHNlbGVjdG9yOwoJCQl0aGlzLmxlbmd0aCA9IDE7CgkJCXJldHVybiB0aGlzOwoKCQkvLyBIQU5ETEU6ICQoZnVuY3Rpb24pCgkJLy8gU2hvcnRjdXQgZm9yIGRvY3VtZW50IHJlYWR5CgkJfSBlbHNlIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHNlbGVjdG9yICkgKSB7CgkJCXJldHVybiByb290alF1ZXJ5LnJlYWR5KCBzZWxlY3RvciApOwoJCX0KCgkJaWYgKCBzZWxlY3Rvci5zZWxlY3RvciAhPT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3Iuc2VsZWN0b3I7CgkJCXRoaXMuY29udGV4dCA9IHNlbGVjdG9yLmNvbnRleHQ7CgkJfQoKCQlyZXR1cm4galF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IsIHRoaXMgKTsKCX0sCgoJLy8gU3RhcnQgd2l0aCBhbiBlbXB0eSBzZWxlY3RvcgoJc2VsZWN0b3I6ICIiLAoKCS8vIFRoZSBkZWZhdWx0IGxlbmd0aCBvZiBhIGpRdWVyeSBvYmplY3QgaXMgMAoJbGVuZ3RoOiAwLAoKCS8vIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgY29udGFpbmVkIGluIHRoZSBtYXRjaGVkIGVsZW1lbnQgc2V0CglzaXplOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5sZW5ndGg7Cgl9LAoKCXRvQXJyYXk6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBjb3JlX3NsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUgoJLy8gR2V0IHRoZSB3aG9sZSBtYXRjaGVkIGVsZW1lbnQgc2V0IGFzIGEgY2xlYW4gYXJyYXkKCWdldDogZnVuY3Rpb24oIG51bSApIHsKCQlyZXR1cm4gbnVtID09IG51bGwgPwoKCQkJLy8gUmV0dXJuIGEgJ2NsZWFuJyBhcnJheQoJCQl0aGlzLnRvQXJyYXkoKSA6CgoJCQkvLyBSZXR1cm4ganVzdCB0aGUgb2JqZWN0CgkJCSggbnVtIDwgMCA/IHRoaXNbIHRoaXMubGVuZ3RoICsgbnVtIF0gOiB0aGlzWyBudW0gXSApOwoJfSwKCgkvLyBUYWtlIGFuIGFycmF5IG9mIGVsZW1lbnRzIGFuZCBwdXNoIGl0IG9udG8gdGhlIHN0YWNrCgkvLyAocmV0dXJuaW5nIHRoZSBuZXcgbWF0Y2hlZCBlbGVtZW50IHNldCkKCXB1c2hTdGFjazogZnVuY3Rpb24oIGVsZW1zICkgewoKCQkvLyBCdWlsZCBhIG5ldyBqUXVlcnkgbWF0Y2hlZCBlbGVtZW50IHNldAoJCXZhciByZXQgPSBqUXVlcnkubWVyZ2UoIHRoaXMuY29uc3RydWN0b3IoKSwgZWxlbXMgKTsKCgkJLy8gQWRkIHRoZSBvbGQgb2JqZWN0IG9udG8gdGhlIHN0YWNrIChhcyBhIHJlZmVyZW5jZSkKCQlyZXQucHJldk9iamVjdCA9IHRoaXM7CgkJcmV0LmNvbnRleHQgPSB0aGlzLmNvbnRleHQ7CgoJCS8vIFJldHVybiB0aGUgbmV3bHktZm9ybWVkIGVsZW1lbnQgc2V0CgkJcmV0dXJuIHJldDsKCX0sCgoJLy8gRXhlY3V0ZSBhIGNhbGxiYWNrIGZvciBldmVyeSBlbGVtZW50IGluIHRoZSBtYXRjaGVkIHNldC4KCS8vIChZb3UgY2FuIHNlZWQgdGhlIGFyZ3VtZW50cyB3aXRoIGFuIGFycmF5IG9mIGFyZ3MsIGJ1dCB0aGlzIGlzCgkvLyBvbmx5IHVzZWQgaW50ZXJuYWxseS4pCgllYWNoOiBmdW5jdGlvbiggY2FsbGJhY2ssIGFyZ3MgKSB7CgkJcmV0dXJuIGpRdWVyeS5lYWNoKCB0aGlzLCBjYWxsYmFjaywgYXJncyApOwoJfSwKCglyZWFkeTogZnVuY3Rpb24oIGZuICkgewoJCS8vIEFkZCB0aGUgY2FsbGJhY2sKCQlqUXVlcnkucmVhZHkucHJvbWlzZSgpLmRvbmUoIGZuICk7CgoJCXJldHVybiB0aGlzOwoJfSwKCglzbGljZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBjb3JlX3NsaWNlLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSApOwoJfSwKCglmaXJzdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZXEoIDAgKTsKCX0sCgoJbGFzdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZXEoIC0xICk7Cgl9LAoKCWVxOiBmdW5jdGlvbiggaSApIHsKCQl2YXIgbGVuID0gdGhpcy5sZW5ndGgsCgkJCWogPSAraSArICggaSA8IDAgPyBsZW4gOiAwICk7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqID49IDAgJiYgaiA8IGxlbiA/IFsgdGhpc1tqXSBdIDogW10gKTsKCX0sCgoJbWFwOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gY2FsbGJhY2suY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCX0pKTsKCX0sCgoJZW5kOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IobnVsbCk7Cgl9LAoKCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCS8vIEJlaGF2ZXMgbGlrZSBhbiBBcnJheSdzIG1ldGhvZCwgbm90IGxpa2UgYSBqUXVlcnkgbWV0aG9kLgoJcHVzaDogY29yZV9wdXNoLAoJc29ydDogW10uc29ydCwKCXNwbGljZTogW10uc3BsaWNlCn07CgovLyBHaXZlIHRoZSBpbml0IGZ1bmN0aW9uIHRoZSBqUXVlcnkgcHJvdG90eXBlIGZvciBsYXRlciBpbnN0YW50aWF0aW9uCmpRdWVyeS5mbi5pbml0LnByb3RvdHlwZSA9IGpRdWVyeS5mbjsKCmpRdWVyeS5leHRlbmQgPSBqUXVlcnkuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7Cgl2YXIgc3JjLCBjb3B5SXNBcnJheSwgY29weSwgbmFtZSwgb3B0aW9ucywgY2xvbmUsCgkJdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAoJCWkgPSAxLAoJCWxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCgkJZGVlcCA9IGZhbHNlOwoKCS8vIEhhbmRsZSBhIGRlZXAgY29weSBzaXR1YXRpb24KCWlmICggdHlwZW9mIHRhcmdldCA9PT0gImJvb2xlYW4iICkgewoJCWRlZXAgPSB0YXJnZXQ7CgkJdGFyZ2V0ID0gYXJndW1lbnRzWzFdIHx8IHt9OwoJCS8vIHNraXAgdGhlIGJvb2xlYW4gYW5kIHRoZSB0YXJnZXQKCQlpID0gMjsKCX0KCgkvLyBIYW5kbGUgY2FzZSB3aGVuIHRhcmdldCBpcyBhIHN0cmluZyBvciBzb21ldGhpbmcgKHBvc3NpYmxlIGluIGRlZXAgY29weSkKCWlmICggdHlwZW9mIHRhcmdldCAhPT0gIm9iamVjdCIgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKHRhcmdldCkgKSB7CgkJdGFyZ2V0ID0ge307Cgl9CgoJLy8gZXh0ZW5kIGpRdWVyeSBpdHNlbGYgaWYgb25seSBvbmUgYXJndW1lbnQgaXMgcGFzc2VkCglpZiAoIGxlbmd0aCA9PT0gaSApIHsKCQl0YXJnZXQgPSB0aGlzOwoJCS0taTsKCX0KCglmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkvLyBPbmx5IGRlYWwgd2l0aCBub24tbnVsbC91bmRlZmluZWQgdmFsdWVzCgkJaWYgKCAob3B0aW9ucyA9IGFyZ3VtZW50c1sgaSBdKSAhPSBudWxsICkgewoJCQkvLyBFeHRlbmQgdGhlIGJhc2Ugb2JqZWN0CgkJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJCXNyYyA9IHRhcmdldFsgbmFtZSBdOwoJCQkJY29weSA9IG9wdGlvbnNbIG5hbWUgXTsKCgkJCQkvLyBQcmV2ZW50IG5ldmVyLWVuZGluZyBsb29wCgkJCQlpZiAoIHRhcmdldCA9PT0gY29weSApIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQkvLyBSZWN1cnNlIGlmIHdlJ3JlIG1lcmdpbmcgcGxhaW4gb2JqZWN0cyBvciBhcnJheXMKCQkJCWlmICggZGVlcCAmJiBjb3B5ICYmICggalF1ZXJ5LmlzUGxhaW5PYmplY3QoY29weSkgfHwgKGNvcHlJc0FycmF5ID0galF1ZXJ5LmlzQXJyYXkoY29weSkpICkgKSB7CgkJCQkJaWYgKCBjb3B5SXNBcnJheSApIHsKCQkJCQkJY29weUlzQXJyYXkgPSBmYWxzZTsKCQkJCQkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzQXJyYXkoc3JjKSA/IHNyYyA6IFtdOwoKCQkJCQl9IGVsc2UgewoJCQkJCQljbG9uZSA9IHNyYyAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdChzcmMpID8gc3JjIDoge307CgkJCQkJfQoKCQkJCQkvLyBOZXZlciBtb3ZlIG9yaWdpbmFsIG9iamVjdHMsIGNsb25lIHRoZW0KCQkJCQl0YXJnZXRbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGRlZXAsIGNsb25lLCBjb3B5ICk7CgoJCQkJLy8gRG9uJ3QgYnJpbmcgaW4gdW5kZWZpbmVkIHZhbHVlcwoJCQkJfSBlbHNlIGlmICggY29weSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXRhcmdldFsgbmFtZSBdID0gY29weTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBSZXR1cm4gdGhlIG1vZGlmaWVkIG9iamVjdAoJcmV0dXJuIHRhcmdldDsKfTsKCmpRdWVyeS5leHRlbmQoewoJbm9Db25mbGljdDogZnVuY3Rpb24oIGRlZXAgKSB7CgkJaWYgKCB3aW5kb3cuJCA9PT0galF1ZXJ5ICkgewoJCQl3aW5kb3cuJCA9IF8kOwoJCX0KCgkJaWYgKCBkZWVwICYmIHdpbmRvdy5qUXVlcnkgPT09IGpRdWVyeSApIHsKCQkJd2luZG93LmpRdWVyeSA9IF9qUXVlcnk7CgkJfQoKCQlyZXR1cm4galF1ZXJ5OwoJfSwKCgkvLyBJcyB0aGUgRE9NIHJlYWR5IHRvIGJlIHVzZWQ/IFNldCB0byB0cnVlIG9uY2UgaXQgb2NjdXJzLgoJaXNSZWFkeTogZmFsc2UsCgoJLy8gQSBjb3VudGVyIHRvIHRyYWNrIGhvdyBtYW55IGl0ZW1zIHRvIHdhaXQgZm9yIGJlZm9yZQoJLy8gdGhlIHJlYWR5IGV2ZW50IGZpcmVzLiBTZWUgIzY3ODEKCXJlYWR5V2FpdDogMSwKCgkvLyBIb2xkIChvciByZWxlYXNlKSB0aGUgcmVhZHkgZXZlbnQKCWhvbGRSZWFkeTogZnVuY3Rpb24oIGhvbGQgKSB7CgkJaWYgKCBob2xkICkgewoJCQlqUXVlcnkucmVhZHlXYWl0Kys7CgkJfSBlbHNlIHsKCQkJalF1ZXJ5LnJlYWR5KCB0cnVlICk7CgkJfQoJfSwKCgkvLyBIYW5kbGUgd2hlbiB0aGUgRE9NIGlzIHJlYWR5CglyZWFkeTogZnVuY3Rpb24oIHdhaXQgKSB7CgoJCS8vIEFib3J0IGlmIHRoZXJlIGFyZSBwZW5kaW5nIGhvbGRzIG9yIHdlJ3JlIGFscmVhZHkgcmVhZHkKCQlpZiAoIHdhaXQgPT09IHRydWUgPyAtLWpRdWVyeS5yZWFkeVdhaXQgOiBqUXVlcnkuaXNSZWFkeSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIGJvZHkgZXhpc3RzLCBhdCBsZWFzdCwgaW4gY2FzZSBJRSBnZXRzIGEgbGl0dGxlIG92ZXJ6ZWFsb3VzICh0aWNrZXQgIzU0NDMpLgoJCWlmICggIWRvY3VtZW50LmJvZHkgKSB7CgkJCXJldHVybiBzZXRUaW1lb3V0KCBqUXVlcnkucmVhZHkgKTsKCQl9CgoJCS8vIFJlbWVtYmVyIHRoYXQgdGhlIERPTSBpcyByZWFkeQoJCWpRdWVyeS5pc1JlYWR5ID0gdHJ1ZTsKCgkJLy8gSWYgYSBub3JtYWwgRE9NIFJlYWR5IGV2ZW50IGZpcmVkLCBkZWNyZW1lbnQsIGFuZCB3YWl0IGlmIG5lZWQgYmUKCQlpZiAoIHdhaXQgIT09IHRydWUgJiYgLS1qUXVlcnkucmVhZHlXYWl0ID4gMCApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gSWYgdGhlcmUgYXJlIGZ1bmN0aW9ucyBib3VuZCwgdG8gZXhlY3V0ZQoJCXJlYWR5TGlzdC5yZXNvbHZlV2l0aCggZG9jdW1lbnQsIFsgalF1ZXJ5IF0gKTsKCgkJLy8gVHJpZ2dlciBhbnkgYm91bmQgcmVhZHkgZXZlbnRzCgkJaWYgKCBqUXVlcnkuZm4udHJpZ2dlciApIHsKCQkJalF1ZXJ5KCBkb2N1bWVudCApLnRyaWdnZXIoInJlYWR5Iikub2ZmKCJyZWFkeSIpOwoJCX0KCX0sCgoJLy8gU2VlIHRlc3QvdW5pdC9jb3JlLmpzIGZvciBkZXRhaWxzIGNvbmNlcm5pbmcgaXNGdW5jdGlvbi4KCS8vIFNpbmNlIHZlcnNpb24gMS4zLCBET00gbWV0aG9kcyBhbmQgZnVuY3Rpb25zIGxpa2UgYWxlcnQKCS8vIGFyZW4ndCBzdXBwb3J0ZWQuIFRoZXkgcmV0dXJuIGZhbHNlIG9uIElFICgjMjk2OCkuCglpc0Z1bmN0aW9uOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiZnVuY3Rpb24iOwoJfSwKCglpc0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKCBvYmogKSB7CgkJcmV0dXJuIGpRdWVyeS50eXBlKG9iaikgPT09ICJhcnJheSI7Cgl9LAoKCWlzV2luZG93OiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT0gb2JqLndpbmRvdzsKCX0sCgoJaXNOdW1lcmljOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiAhaXNOYU4oIHBhcnNlRmxvYXQob2JqKSApICYmIGlzRmluaXRlKCBvYmogKTsKCX0sCgoJdHlwZTogZnVuY3Rpb24oIG9iaiApIHsKCQlpZiAoIG9iaiA9PSBudWxsICkgewoJCQlyZXR1cm4gU3RyaW5nKCBvYmogKTsKCQl9CgkJcmV0dXJuIHR5cGVvZiBvYmogPT09ICJvYmplY3QiIHx8IHR5cGVvZiBvYmogPT09ICJmdW5jdGlvbiIgPwoJCQljbGFzczJ0eXBlWyBjb3JlX3RvU3RyaW5nLmNhbGwob2JqKSBdIHx8ICJvYmplY3QiIDoKCQkJdHlwZW9mIG9iajsKCX0sCgoJaXNQbGFpbk9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBNdXN0IGJlIGFuIE9iamVjdC4KCQkvLyBCZWNhdXNlIG9mIElFLCB3ZSBhbHNvIGhhdmUgdG8gY2hlY2sgdGhlIHByZXNlbmNlIG9mIHRoZSBjb25zdHJ1Y3RvciBwcm9wZXJ0eS4KCQkvLyBNYWtlIHN1cmUgdGhhdCBET00gbm9kZXMgYW5kIHdpbmRvdyBvYmplY3RzIGRvbid0IHBhc3MgdGhyb3VnaCwgYXMgd2VsbAoJCWlmICggIW9iaiB8fCBqUXVlcnkudHlwZShvYmopICE9PSAib2JqZWN0IiB8fCBvYmoubm9kZVR5cGUgfHwgalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJdHJ5IHsKCQkJLy8gTm90IG93biBjb25zdHJ1Y3RvciBwcm9wZXJ0eSBtdXN0IGJlIE9iamVjdAoJCQlpZiAoIG9iai5jb25zdHJ1Y3RvciAmJgoJCQkJIWNvcmVfaGFzT3duLmNhbGwob2JqLCAiY29uc3RydWN0b3IiKSAmJgoJCQkJIWNvcmVfaGFzT3duLmNhbGwob2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgImlzUHJvdG90eXBlT2YiKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0gY2F0Y2ggKCBlICkgewoJCQkvLyBJRTgsOSBXaWxsIHRocm93IGV4Y2VwdGlvbnMgb24gY2VydGFpbiBob3N0IG9iamVjdHMgIzk4OTcKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gT3duIHByb3BlcnRpZXMgYXJlIGVudW1lcmF0ZWQgZmlyc3RseSwgc28gdG8gc3BlZWQgdXAsCgkJLy8gaWYgbGFzdCBvbmUgaXMgb3duLCB0aGVuIGFsbCBwcm9wZXJ0aWVzIGFyZSBvd24uCgoJCXZhciBrZXk7CgkJZm9yICgga2V5IGluIG9iaiApIHt9CgoJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCBjb3JlX2hhc093bi5jYWxsKCBvYmosIGtleSApOwoJfSwKCglpc0VtcHR5T2JqZWN0OiBmdW5jdGlvbiggb2JqICkgewoJCXZhciBuYW1lOwoJCWZvciAoIG5hbWUgaW4gb2JqICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXJldHVybiB0cnVlOwoJfSwKCgllcnJvcjogZnVuY3Rpb24oIG1zZyApIHsKCQl0aHJvdyBuZXcgRXJyb3IoIG1zZyApOwoJfSwKCgkvLyBkYXRhOiBzdHJpbmcgb2YgaHRtbAoJLy8gY29udGV4dCAob3B0aW9uYWwpOiBJZiBzcGVjaWZpZWQsIHRoZSBmcmFnbWVudCB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhpcyBjb250ZXh0LCBkZWZhdWx0cyB0byBkb2N1bWVudAoJLy8ga2VlcFNjcmlwdHMgKG9wdGlvbmFsKTogSWYgdHJ1ZSwgd2lsbCBpbmNsdWRlIHNjcmlwdHMgcGFzc2VkIGluIHRoZSBodG1sIHN0cmluZwoJcGFyc2VIVE1MOiBmdW5jdGlvbiggZGF0YSwgY29udGV4dCwga2VlcFNjcmlwdHMgKSB7CgkJaWYgKCAhZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCQlpZiAoIHR5cGVvZiBjb250ZXh0ID09PSAiYm9vbGVhbiIgKSB7CgkJCWtlZXBTY3JpcHRzID0gY29udGV4dDsKCQkJY29udGV4dCA9IGZhbHNlOwoJCX0KCQljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCgkJdmFyIHBhcnNlZCA9IHJzaW5nbGVUYWcuZXhlYyggZGF0YSApLAoJCQlzY3JpcHRzID0gIWtlZXBTY3JpcHRzICYmIFtdOwoKCQkvLyBTaW5nbGUgdGFnCgkJaWYgKCBwYXJzZWQgKSB7CgkJCXJldHVybiBbIGNvbnRleHQuY3JlYXRlRWxlbWVudCggcGFyc2VkWzFdICkgXTsKCQl9CgoJCXBhcnNlZCA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBbIGRhdGEgXSwgY29udGV4dCwgc2NyaXB0cyApOwoJCWlmICggc2NyaXB0cyApIHsKCQkJalF1ZXJ5KCBzY3JpcHRzICkucmVtb3ZlKCk7CgkJfQoJCXJldHVybiBqUXVlcnkubWVyZ2UoIFtdLCBwYXJzZWQuY2hpbGROb2RlcyApOwoJfSwKCglwYXJzZUpTT046IGZ1bmN0aW9uKCBkYXRhICkgewoJCS8vIEF0dGVtcHQgdG8gcGFyc2UgdXNpbmcgdGhlIG5hdGl2ZSBKU09OIHBhcnNlciBmaXJzdAoJCWlmICggd2luZG93LkpTT04gJiYgd2luZG93LkpTT04ucGFyc2UgKSB7CgkJCXJldHVybiB3aW5kb3cuSlNPTi5wYXJzZSggZGF0YSApOwoJCX0KCgkJaWYgKCBkYXRhID09PSBudWxsICkgewoJCQlyZXR1cm4gZGF0YTsKCQl9CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoKCQkJLy8gTWFrZSBzdXJlIGxlYWRpbmcvdHJhaWxpbmcgd2hpdGVzcGFjZSBpcyByZW1vdmVkIChJRSBjYW4ndCBoYW5kbGUgaXQpCgkJCWRhdGEgPSBqUXVlcnkudHJpbSggZGF0YSApOwoKCQkJaWYgKCBkYXRhICkgewoJCQkJLy8gTWFrZSBzdXJlIHRoZSBpbmNvbWluZyBkYXRhIGlzIGFjdHVhbCBKU09OCgkJCQkvLyBMb2dpYyBib3Jyb3dlZCBmcm9tIGh0dHA6Ly9qc29uLm9yZy9qc29uMi5qcwoJCQkJaWYgKCBydmFsaWRjaGFycy50ZXN0KCBkYXRhLnJlcGxhY2UoIHJ2YWxpZGVzY2FwZSwgIkAiICkKCQkJCQkucmVwbGFjZSggcnZhbGlkdG9rZW5zLCAiXSIgKQoJCQkJCS5yZXBsYWNlKCBydmFsaWRicmFjZXMsICIiKSkgKSB7CgoJCQkJCXJldHVybiAoIG5ldyBGdW5jdGlvbiggInJldHVybiAiICsgZGF0YSApICkoKTsKCQkJCX0KCQkJfQoJCX0KCgkJalF1ZXJ5LmVycm9yKCAiSW52YWxpZCBKU09OOiAiICsgZGF0YSApOwoJfSwKCgkvLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nCglwYXJzZVhNTDogZnVuY3Rpb24oIGRhdGEgKSB7CgkJdmFyIHhtbCwgdG1wOwoJCWlmICggIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJdHJ5IHsKCQkJaWYgKCB3aW5kb3cuRE9NUGFyc2VyICkgeyAvLyBTdGFuZGFyZAoJCQkJdG1wID0gbmV3IERPTVBhcnNlcigpOwoJCQkJeG1sID0gdG1wLnBhcnNlRnJvbVN0cmluZyggZGF0YSAsICJ0ZXh0L3htbCIgKTsKCQkJfSBlbHNlIHsgLy8gSUUKCQkJCXhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCAiTWljcm9zb2Z0LlhNTERPTSIgKTsKCQkJCXhtbC5hc3luYyA9ICJmYWxzZSI7CgkJCQl4bWwubG9hZFhNTCggZGF0YSApOwoJCQl9CgkJfSBjYXRjaCggZSApIHsKCQkJeG1sID0gdW5kZWZpbmVkOwoJCX0KCQlpZiAoICF4bWwgfHwgIXhtbC5kb2N1bWVudEVsZW1lbnQgfHwgeG1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAicGFyc2VyZXJyb3IiICkubGVuZ3RoICkgewoJCQlqUXVlcnkuZXJyb3IoICJJbnZhbGlkIFhNTDogIiArIGRhdGEgKTsKCQl9CgkJcmV0dXJuIHhtbDsKCX0sCgoJbm9vcDogZnVuY3Rpb24oKSB7fSwKCgkvLyBFdmFsdWF0ZXMgYSBzY3JpcHQgaW4gYSBnbG9iYWwgY29udGV4dAoJLy8gV29ya2Fyb3VuZHMgYmFzZWQgb24gZmluZGluZ3MgYnkgSmltIERyaXNjb2xsCgkvLyBodHRwOi8vd2VibG9ncy5qYXZhLm5ldC9ibG9nL2RyaXNjb2xsL2FyY2hpdmUvMjAwOS8wOS8wOC9ldmFsLWphdmFzY3JpcHQtZ2xvYmFsLWNvbnRleHQKCWdsb2JhbEV2YWw6IGZ1bmN0aW9uKCBkYXRhICkgewoJCWlmICggZGF0YSAmJiBqUXVlcnkudHJpbSggZGF0YSApICkgewoJCQkvLyBXZSB1c2UgZXhlY1NjcmlwdCBvbiBJbnRlcm5ldCBFeHBsb3JlcgoJCQkvLyBXZSB1c2UgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHNvIHRoYXQgY29udGV4dCBpcyB3aW5kb3cKCQkJLy8gcmF0aGVyIHRoYW4galF1ZXJ5IGluIEZpcmVmb3gKCQkJKCB3aW5kb3cuZXhlY1NjcmlwdCB8fCBmdW5jdGlvbiggZGF0YSApIHsKCQkJCXdpbmRvd1sgImV2YWwiIF0uY2FsbCggd2luZG93LCBkYXRhICk7CgkJCX0gKSggZGF0YSApOwoJCX0KCX0sCgoJLy8gQ29udmVydCBkYXNoZWQgdG8gY2FtZWxDYXNlOyB1c2VkIGJ5IHRoZSBjc3MgYW5kIGRhdGEgbW9kdWxlcwoJLy8gTWljcm9zb2Z0IGZvcmdvdCB0byBodW1wIHRoZWlyIHZlbmRvciBwcmVmaXggKCM5NTcyKQoJY2FtZWxDYXNlOiBmdW5jdGlvbiggc3RyaW5nICkgewoJCXJldHVybiBzdHJpbmcucmVwbGFjZSggcm1zUHJlZml4LCAibXMtIiApLnJlcGxhY2UoIHJkYXNoQWxwaGEsIGZjYW1lbENhc2UgKTsKCX0sCgoJbm9kZU5hbWU6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCXJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJfSwKCgkvLyBhcmdzIGlzIGZvciBpbnRlcm5hbCB1c2FnZSBvbmx5CgllYWNoOiBmdW5jdGlvbiggb2JqLCBjYWxsYmFjaywgYXJncyApIHsKCQl2YXIgdmFsdWUsCgkJCWkgPSAwLAoJCQlsZW5ndGggPSBvYmoubGVuZ3RoLAoJCQlpc0FycmF5ID0gaXNBcnJheWxpa2UoIG9iaiApOwoKCQlpZiAoIGFyZ3MgKSB7CgkJCWlmICggaXNBcnJheSApIHsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suYXBwbHkoIG9ialsgaSBdLCBhcmdzICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpIGluIG9iaiApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmFwcGx5KCBvYmpbIGkgXSwgYXJncyApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIEEgc3BlY2lhbCwgZmFzdCwgY2FzZSBmb3IgdGhlIG1vc3QgY29tbW9uIHVzZSBvZiBlYWNoCgkJfSBlbHNlIHsKCQkJaWYgKCBpc0FycmF5ICkgewoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQkJdmFsdWUgPSBjYWxsYmFjay5jYWxsKCBvYmpbIGkgXSwgaSwgb2JqWyBpIF0gKTsKCgkJCQkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWZvciAoIGkgaW4gb2JqICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suY2FsbCggb2JqWyBpIF0sIGksIG9ialsgaSBdICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBvYmo7Cgl9LAoKCS8vIFVzZSBuYXRpdmUgU3RyaW5nLnRyaW0gZnVuY3Rpb24gd2hlcmV2ZXIgcG9zc2libGUKCXRyaW06IGNvcmVfdHJpbSAmJiAhY29yZV90cmltLmNhbGwoIlx1RkVGRlx4QTAiKSA/CgkJZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiB0ZXh0ID09IG51bGwgPwoJCQkJIiIgOgoJCQkJY29yZV90cmltLmNhbGwoIHRleHQgKTsKCQl9IDoKCgkJLy8gT3RoZXJ3aXNlIHVzZSBvdXIgb3duIHRyaW1taW5nIGZ1bmN0aW9uYWxpdHkKCQlmdW5jdGlvbiggdGV4dCApIHsKCQkJcmV0dXJuIHRleHQgPT0gbnVsbCA/CgkJCQkiIiA6CgkJCQkoIHRleHQgKyAiIiApLnJlcGxhY2UoIHJ0cmltLCAiIiApOwoJCX0sCgoJLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJbWFrZUFycmF5OiBmdW5jdGlvbiggYXJyLCByZXN1bHRzICkgewoJCXZhciByZXQgPSByZXN1bHRzIHx8IFtdOwoKCQlpZiAoIGFyciAhPSBudWxsICkgewoJCQlpZiAoIGlzQXJyYXlsaWtlKCBPYmplY3QoYXJyKSApICkgewoJCQkJalF1ZXJ5Lm1lcmdlKCByZXQsCgkJCQkJdHlwZW9mIGFyciA9PT0gInN0cmluZyIgPwoJCQkJCVsgYXJyIF0gOiBhcnIKCQkJCSk7CgkJCX0gZWxzZSB7CgkJCQljb3JlX3B1c2guY2FsbCggcmV0LCBhcnIgKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX0sCgoJaW5BcnJheTogZnVuY3Rpb24oIGVsZW0sIGFyciwgaSApIHsKCQl2YXIgbGVuOwoKCQlpZiAoIGFyciApIHsKCQkJaWYgKCBjb3JlX2luZGV4T2YgKSB7CgkJCQlyZXR1cm4gY29yZV9pbmRleE9mLmNhbGwoIGFyciwgZWxlbSwgaSApOwoJCQl9CgoJCQlsZW4gPSBhcnIubGVuZ3RoOwoJCQlpID0gaSA/IGkgPCAwID8gTWF0aC5tYXgoIDAsIGxlbiArIGkgKSA6IGkgOiAwOwoKCQkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCQkvLyBTa2lwIGFjY2Vzc2luZyBpbiBzcGFyc2UgYXJyYXlzCgkJCQlpZiAoIGkgaW4gYXJyICYmIGFyclsgaSBdID09PSBlbGVtICkgewoJCQkJCXJldHVybiBpOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gLTE7Cgl9LAoKCW1lcmdlOiBmdW5jdGlvbiggZmlyc3QsIHNlY29uZCApIHsKCQl2YXIgbCA9IHNlY29uZC5sZW5ndGgsCgkJCWkgPSBmaXJzdC5sZW5ndGgsCgkJCWogPSAwOwoKCQlpZiAoIHR5cGVvZiBsID09PSAibnVtYmVyIiApIHsKCQkJZm9yICggOyBqIDwgbDsgaisrICkgewoJCQkJZmlyc3RbIGkrKyBdID0gc2Vjb25kWyBqIF07CgkJCX0KCQl9IGVsc2UgewoJCQl3aGlsZSAoIHNlY29uZFtqXSAhPT0gdW5kZWZpbmVkICkgewoJCQkJZmlyc3RbIGkrKyBdID0gc2Vjb25kWyBqKysgXTsKCQkJfQoJCX0KCgkJZmlyc3QubGVuZ3RoID0gaTsKCgkJcmV0dXJuIGZpcnN0OwoJfSwKCglncmVwOiBmdW5jdGlvbiggZWxlbXMsIGNhbGxiYWNrLCBpbnYgKSB7CgkJdmFyIHJldFZhbCwKCQkJcmV0ID0gW10sCgkJCWkgPSAwLAoJCQlsZW5ndGggPSBlbGVtcy5sZW5ndGg7CgkJaW52ID0gISFpbnY7CgoJCS8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCBvbmx5IHNhdmluZyB0aGUgaXRlbXMKCQkvLyB0aGF0IHBhc3MgdGhlIHZhbGlkYXRvciBmdW5jdGlvbgoJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQlyZXRWYWwgPSAhIWNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpICk7CgkJCWlmICggaW52ICE9PSByZXRWYWwgKSB7CgkJCQlyZXQucHVzaCggZWxlbXNbIGkgXSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gcmV0OwoJfSwKCgkvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKCW1hcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgYXJnICkgewoJCXZhciB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBlbGVtcyApLAoJCQlyZXQgPSBbXTsKCgkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIHRyYW5zbGF0aW5nIGVhY2ggb2YgdGhlIGl0ZW1zIHRvIHRoZWlyCgkJaWYgKCBpc0FycmF5ICkgewoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgoJCS8vIEdvIHRocm91Z2ggZXZlcnkga2V5IG9uIHRoZSBvYmplY3QsCgkJfSBlbHNlIHsKCQkJZm9yICggaSBpbiBlbGVtcyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCgkJcmV0dXJuIGNvcmVfY29uY2F0LmFwcGx5KCBbXSwgcmV0ICk7Cgl9LAoKCS8vIEEgZ2xvYmFsIEdVSUQgY291bnRlciBmb3Igb2JqZWN0cwoJZ3VpZDogMSwKCgkvLyBCaW5kIGEgZnVuY3Rpb24gdG8gYSBjb250ZXh0LCBvcHRpb25hbGx5IHBhcnRpYWxseSBhcHBseWluZyBhbnkKCS8vIGFyZ3VtZW50cy4KCXByb3h5OiBmdW5jdGlvbiggZm4sIGNvbnRleHQgKSB7CgkJdmFyIGFyZ3MsIHByb3h5LCB0bXA7CgoJCWlmICggdHlwZW9mIGNvbnRleHQgPT09ICJzdHJpbmciICkgewoJCQl0bXAgPSBmblsgY29udGV4dCBdOwoJCQljb250ZXh0ID0gZm47CgkJCWZuID0gdG1wOwoJCX0KCgkJLy8gUXVpY2sgY2hlY2sgdG8gZGV0ZXJtaW5lIGlmIHRhcmdldCBpcyBjYWxsYWJsZSwgaW4gdGhlIHNwZWMKCQkvLyB0aGlzIHRocm93cyBhIFR5cGVFcnJvciwgYnV0IHdlIHdpbGwganVzdCByZXR1cm4gdW5kZWZpbmVkLgoJCWlmICggIWpRdWVyeS5pc0Z1bmN0aW9uKCBmbiApICkgewoJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCX0KCgkJLy8gU2ltdWxhdGVkIGJpbmQKCQlhcmdzID0gY29yZV9zbGljZS5jYWxsKCBhcmd1bWVudHMsIDIgKTsKCQlwcm94eSA9IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gZm4uYXBwbHkoIGNvbnRleHQgfHwgdGhpcywgYXJncy5jb25jYXQoIGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzICkgKSApOwoJCX07CgoJCS8vIFNldCB0aGUgZ3VpZCBvZiB1bmlxdWUgaGFuZGxlciB0byB0aGUgc2FtZSBvZiBvcmlnaW5hbCBoYW5kbGVyLCBzbyBpdCBjYW4gYmUgcmVtb3ZlZAoJCXByb3h5Lmd1aWQgPSBmbi5ndWlkID0gZm4uZ3VpZCB8fCBqUXVlcnkuZ3VpZCsrOwoKCQlyZXR1cm4gcHJveHk7Cgl9LAoKCS8vIE11bHRpZnVuY3Rpb25hbCBtZXRob2QgdG8gZ2V0IGFuZCBzZXQgdmFsdWVzIG9mIGEgY29sbGVjdGlvbgoJLy8gVGhlIHZhbHVlL3MgY2FuIG9wdGlvbmFsbHkgYmUgZXhlY3V0ZWQgaWYgaXQncyBhIGZ1bmN0aW9uCglhY2Nlc3M6IGZ1bmN0aW9uKCBlbGVtcywgZm4sIGtleSwgdmFsdWUsIGNoYWluYWJsZSwgZW1wdHlHZXQsIHJhdyApIHsKCQl2YXIgaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJYnVsayA9IGtleSA9PSBudWxsOwoKCQkvLyBTZXRzIG1hbnkgdmFsdWVzCgkJaWYgKCBqUXVlcnkudHlwZSgga2V5ICkgPT09ICJvYmplY3QiICkgewoJCQljaGFpbmFibGUgPSB0cnVlOwoJCQlmb3IgKCBpIGluIGtleSApIHsKCQkJCWpRdWVyeS5hY2Nlc3MoIGVsZW1zLCBmbiwgaSwga2V5W2ldLCB0cnVlLCBlbXB0eUdldCwgcmF3ICk7CgkJCX0KCgkJLy8gU2V0cyBvbmUgdmFsdWUKCQl9IGVsc2UgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQljaGFpbmFibGUgPSB0cnVlOwoKCQkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCQlyYXcgPSB0cnVlOwoJCQl9CgoJCQlpZiAoIGJ1bGsgKSB7CgkJCQkvLyBCdWxrIG9wZXJhdGlvbnMgcnVuIGFnYWluc3QgdGhlIGVudGlyZSBzZXQKCQkJCWlmICggcmF3ICkgewoJCQkJCWZuLmNhbGwoIGVsZW1zLCB2YWx1ZSApOwoJCQkJCWZuID0gbnVsbDsKCgkJCQkvLyAuLi5leGNlcHQgd2hlbiBleGVjdXRpbmcgZnVuY3Rpb24gdmFsdWVzCgkJCQl9IGVsc2UgewoJCQkJCWJ1bGsgPSBmbjsKCQkJCQlmbiA9IGZ1bmN0aW9uKCBlbGVtLCBrZXksIHZhbHVlICkgewoJCQkJCQlyZXR1cm4gYnVsay5jYWxsKCBqUXVlcnkoIGVsZW0gKSwgdmFsdWUgKTsKCQkJCQl9OwoJCQkJfQoJCQl9CgoJCQlpZiAoIGZuICkgewoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQkJZm4oIGVsZW1zW2ldLCBrZXksIHJhdyA/IHZhbHVlIDogdmFsdWUuY2FsbCggZWxlbXNbaV0sIGksIGZuKCBlbGVtc1tpXSwga2V5ICkgKSApOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gY2hhaW5hYmxlID8KCQkJZWxlbXMgOgoKCQkJLy8gR2V0cwoJCQlidWxrID8KCQkJCWZuLmNhbGwoIGVsZW1zICkgOgoJCQkJbGVuZ3RoID8gZm4oIGVsZW1zWzBdLCBrZXkgKSA6IGVtcHR5R2V0OwoJfSwKCglub3c6IGZ1bmN0aW9uKCkgewoJCXJldHVybiAoIG5ldyBEYXRlKCkgKS5nZXRUaW1lKCk7Cgl9Cn0pOwoKalF1ZXJ5LnJlYWR5LnByb21pc2UgPSBmdW5jdGlvbiggb2JqICkgewoJaWYgKCAhcmVhZHlMaXN0ICkgewoKCQlyZWFkeUxpc3QgPSBqUXVlcnkuRGVmZXJyZWQoKTsKCgkJLy8gQ2F0Y2ggY2FzZXMgd2hlcmUgJChkb2N1bWVudCkucmVhZHkoKSBpcyBjYWxsZWQgYWZ0ZXIgdGhlIGJyb3dzZXIgZXZlbnQgaGFzIGFscmVhZHkgb2NjdXJyZWQuCgkJLy8gd2Ugb25jZSB0cmllZCB0byB1c2UgcmVhZHlTdGF0ZSAiaW50ZXJhY3RpdmUiIGhlcmUsIGJ1dCBpdCBjYXVzZWQgaXNzdWVzIGxpa2UgdGhlIG9uZQoJCS8vIGRpc2NvdmVyZWQgYnkgQ2hyaXNTIGhlcmU6IGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMjgyI2NvbW1lbnQ6MTUKCQlpZiAoIGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgKSB7CgkJCS8vIEhhbmRsZSBpdCBhc3luY2hyb25vdXNseSB0byBhbGxvdyBzY3JpcHRzIHRoZSBvcHBvcnR1bml0eSB0byBkZWxheSByZWFkeQoJCQlzZXRUaW1lb3V0KCBqUXVlcnkucmVhZHkgKTsKCgkJLy8gU3RhbmRhcmRzLWJhc2VkIGJyb3dzZXJzIHN1cHBvcnQgRE9NQ29udGVudExvYWRlZAoJCX0gZWxzZSBpZiAoIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKSB7CgkJCS8vIFVzZSB0aGUgaGFuZHkgZXZlbnQgY2FsbGJhY2sKCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggIkRPTUNvbnRlbnRMb2FkZWQiLCBjb21wbGV0ZWQsIGZhbHNlICk7CgoJCQkvLyBBIGZhbGxiYWNrIHRvIHdpbmRvdy5vbmxvYWQsIHRoYXQgd2lsbCBhbHdheXMgd29yawoJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggImxvYWQiLCBjb21wbGV0ZWQsIGZhbHNlICk7CgoJCS8vIElmIElFIGV2ZW50IG1vZGVsIGlzIHVzZWQKCQl9IGVsc2UgewoJCQkvLyBFbnN1cmUgZmlyaW5nIGJlZm9yZSBvbmxvYWQsIG1heWJlIGxhdGUgYnV0IHNhZmUgYWxzbyBmb3IgaWZyYW1lcwoJCQlkb2N1bWVudC5hdHRhY2hFdmVudCggIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCApOwoKCQkJLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmsKCQkJd2luZG93LmF0dGFjaEV2ZW50KCAib25sb2FkIiwgY29tcGxldGVkICk7CgoJCQkvLyBJZiBJRSBhbmQgbm90IGEgZnJhbWUKCQkJLy8gY29udGludWFsbHkgY2hlY2sgdG8gc2VlIGlmIHRoZSBkb2N1bWVudCBpcyByZWFkeQoJCQl2YXIgdG9wID0gZmFsc2U7CgoJCQl0cnkgewoJCQkJdG9wID0gd2luZG93LmZyYW1lRWxlbWVudCA9PSBudWxsICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCQkJfSBjYXRjaChlKSB7fQoKCQkJaWYgKCB0b3AgJiYgdG9wLmRvU2Nyb2xsICkgewoJCQkJKGZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7CgkJCQkJaWYgKCAhalF1ZXJ5LmlzUmVhZHkgKSB7CgoJCQkJCQl0cnkgewoJCQkJCQkJLy8gVXNlIHRoZSB0cmljayBieSBEaWVnbyBQZXJpbmkKCQkJCQkJCS8vIGh0dHA6Ly9qYXZhc2NyaXB0Lm53Ym94LmNvbS9JRUNvbnRlbnRMb2FkZWQvCgkJCQkJCQl0b3AuZG9TY3JvbGwoImxlZnQiKTsKCQkJCQkJfSBjYXRjaChlKSB7CgkJCQkJCQlyZXR1cm4gc2V0VGltZW91dCggZG9TY3JvbGxDaGVjaywgNTAgKTsKCQkJCQkJfQoKCQkJCQkJLy8gZGV0YWNoIGFsbCBkb20gcmVhZHkgZXZlbnRzCgkJCQkJCWRldGFjaCgpOwoKCQkJCQkJLy8gYW5kIGV4ZWN1dGUgYW55IHdhaXRpbmcgZnVuY3Rpb25zCgkJCQkJCWpRdWVyeS5yZWFkeSgpOwoJCQkJCX0KCQkJCX0pKCk7CgkJCX0KCQl9Cgl9CglyZXR1cm4gcmVhZHlMaXN0LnByb21pc2UoIG9iaiApOwp9OwoKLy8gUG9wdWxhdGUgdGhlIGNsYXNzMnR5cGUgbWFwCmpRdWVyeS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0IEVycm9yIi5zcGxpdCgiICIpLCBmdW5jdGlvbihpLCBuYW1lKSB7CgljbGFzczJ0eXBlWyAiW29iamVjdCAiICsgbmFtZSArICJdIiBdID0gbmFtZS50b0xvd2VyQ2FzZSgpOwp9KTsKCmZ1bmN0aW9uIGlzQXJyYXlsaWtlKCBvYmogKSB7Cgl2YXIgbGVuZ3RoID0gb2JqLmxlbmd0aCwKCQl0eXBlID0galF1ZXJ5LnR5cGUoIG9iaiApOwoKCWlmICggalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJaWYgKCBvYmoubm9kZVR5cGUgPT09IDEgJiYgbGVuZ3RoICkgewoJCXJldHVybiB0cnVlOwoJfQoKCXJldHVybiB0eXBlID09PSAiYXJyYXkiIHx8IHR5cGUgIT09ICJmdW5jdGlvbiIgJiYKCQkoIGxlbmd0aCA9PT0gMCB8fAoJCXR5cGVvZiBsZW5ndGggPT09ICJudW1iZXIiICYmIGxlbmd0aCA+IDAgJiYgKCBsZW5ndGggLSAxICkgaW4gb2JqICk7Cn0KCi8vIEFsbCBqUXVlcnkgb2JqZWN0cyBzaG91bGQgcG9pbnQgYmFjayB0byB0aGVzZQpyb290alF1ZXJ5ID0galF1ZXJ5KGRvY3VtZW50KTsKLy8gU3RyaW5nIHRvIE9iamVjdCBvcHRpb25zIGZvcm1hdCBjYWNoZQp2YXIgb3B0aW9uc0NhY2hlID0ge307CgovLyBDb252ZXJ0IFN0cmluZy1mb3JtYXR0ZWQgb3B0aW9ucyBpbnRvIE9iamVjdC1mb3JtYXR0ZWQgb25lcyBhbmQgc3RvcmUgaW4gY2FjaGUKZnVuY3Rpb24gY3JlYXRlT3B0aW9ucyggb3B0aW9ucyApIHsKCXZhciBvYmplY3QgPSBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSA9IHt9OwoJalF1ZXJ5LmVhY2goIG9wdGlvbnMubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW10sIGZ1bmN0aW9uKCBfLCBmbGFnICkgewoJCW9iamVjdFsgZmxhZyBdID0gdHJ1ZTsKCX0pOwoJcmV0dXJuIG9iamVjdDsKfQoKLyoKICogQ3JlYXRlIGEgY2FsbGJhY2sgbGlzdCB1c2luZyB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CiAqCiAqCW9wdGlvbnM6IGFuIG9wdGlvbmFsIGxpc3Qgb2Ygc3BhY2Utc2VwYXJhdGVkIG9wdGlvbnMgdGhhdCB3aWxsIGNoYW5nZSBob3cKICoJCQl0aGUgY2FsbGJhY2sgbGlzdCBiZWhhdmVzIG9yIGEgbW9yZSB0cmFkaXRpb25hbCBvcHRpb24gb2JqZWN0CiAqCiAqIEJ5IGRlZmF1bHQgYSBjYWxsYmFjayBsaXN0IHdpbGwgYWN0IGxpa2UgYW4gZXZlbnQgY2FsbGJhY2sgbGlzdCBhbmQgY2FuIGJlCiAqICJmaXJlZCIgbXVsdGlwbGUgdGltZXMuCiAqCiAqIFBvc3NpYmxlIG9wdGlvbnM6CiAqCiAqCW9uY2U6CQkJd2lsbCBlbnN1cmUgdGhlIGNhbGxiYWNrIGxpc3QgY2FuIG9ubHkgYmUgZmlyZWQgb25jZSAobGlrZSBhIERlZmVycmVkKQogKgogKgltZW1vcnk6CQkJd2lsbCBrZWVwIHRyYWNrIG9mIHByZXZpb3VzIHZhbHVlcyBhbmQgd2lsbCBjYWxsIGFueSBjYWxsYmFjayBhZGRlZAogKgkJCQkJYWZ0ZXIgdGhlIGxpc3QgaGFzIGJlZW4gZmlyZWQgcmlnaHQgYXdheSB3aXRoIHRoZSBsYXRlc3QgIm1lbW9yaXplZCIKICoJCQkJCXZhbHVlcyAobGlrZSBhIERlZmVycmVkKQogKgogKgl1bmlxdWU6CQkJd2lsbCBlbnN1cmUgYSBjYWxsYmFjayBjYW4gb25seSBiZSBhZGRlZCBvbmNlIChubyBkdXBsaWNhdGUgaW4gdGhlIGxpc3QpCiAqCiAqCXN0b3BPbkZhbHNlOglpbnRlcnJ1cHQgY2FsbGluZ3Mgd2hlbiBhIGNhbGxiYWNrIHJldHVybnMgZmFsc2UKICoKICovCmpRdWVyeS5DYWxsYmFja3MgPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCgkvLyBDb252ZXJ0IG9wdGlvbnMgZnJvbSBTdHJpbmctZm9ybWF0dGVkIHRvIE9iamVjdC1mb3JtYXR0ZWQgaWYgbmVlZGVkCgkvLyAod2UgY2hlY2sgaW4gY2FjaGUgZmlyc3QpCglvcHRpb25zID0gdHlwZW9mIG9wdGlvbnMgPT09ICJzdHJpbmciID8KCQkoIG9wdGlvbnNDYWNoZVsgb3B0aW9ucyBdIHx8IGNyZWF0ZU9wdGlvbnMoIG9wdGlvbnMgKSApIDoKCQlqUXVlcnkuZXh0ZW5kKCB7fSwgb3B0aW9ucyApOwoKCXZhciAvLyBGbGFnIHRvIGtub3cgaWYgbGlzdCBpcyBjdXJyZW50bHkgZmlyaW5nCgkJZmlyaW5nLAoJCS8vIExhc3QgZmlyZSB2YWx1ZSAoZm9yIG5vbi1mb3JnZXR0YWJsZSBsaXN0cykKCQltZW1vcnksCgkJLy8gRmxhZyB0byBrbm93IGlmIGxpc3Qgd2FzIGFscmVhZHkgZmlyZWQKCQlmaXJlZCwKCQkvLyBFbmQgb2YgdGhlIGxvb3Agd2hlbiBmaXJpbmcKCQlmaXJpbmdMZW5ndGgsCgkJLy8gSW5kZXggb2YgY3VycmVudGx5IGZpcmluZyBjYWxsYmFjayAobW9kaWZpZWQgYnkgcmVtb3ZlIGlmIG5lZWRlZCkKCQlmaXJpbmdJbmRleCwKCQkvLyBGaXJzdCBjYWxsYmFjayB0byBmaXJlICh1c2VkIGludGVybmFsbHkgYnkgYWRkIGFuZCBmaXJlV2l0aCkKCQlmaXJpbmdTdGFydCwKCQkvLyBBY3R1YWwgY2FsbGJhY2sgbGlzdAoJCWxpc3QgPSBbXSwKCQkvLyBTdGFjayBvZiBmaXJlIGNhbGxzIGZvciByZXBlYXRhYmxlIGxpc3RzCgkJc3RhY2sgPSAhb3B0aW9ucy5vbmNlICYmIFtdLAoJCS8vIEZpcmUgY2FsbGJhY2tzCgkJZmlyZSA9IGZ1bmN0aW9uKCBkYXRhICkgewoJCQltZW1vcnkgPSBvcHRpb25zLm1lbW9yeSAmJiBkYXRhOwoJCQlmaXJlZCA9IHRydWU7CgkJCWZpcmluZ0luZGV4ID0gZmlyaW5nU3RhcnQgfHwgMDsKCQkJZmlyaW5nU3RhcnQgPSAwOwoJCQlmaXJpbmdMZW5ndGggPSBsaXN0Lmxlbmd0aDsKCQkJZmlyaW5nID0gdHJ1ZTsKCQkJZm9yICggOyBsaXN0ICYmIGZpcmluZ0luZGV4IDwgZmlyaW5nTGVuZ3RoOyBmaXJpbmdJbmRleCsrICkgewoJCQkJaWYgKCBsaXN0WyBmaXJpbmdJbmRleCBdLmFwcGx5KCBkYXRhWyAwIF0sIGRhdGFbIDEgXSApID09PSBmYWxzZSAmJiBvcHRpb25zLnN0b3BPbkZhbHNlICkgewoJCQkJCW1lbW9yeSA9IGZhbHNlOyAvLyBUbyBwcmV2ZW50IGZ1cnRoZXIgY2FsbHMgdXNpbmcgYWRkCgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJZmlyaW5nID0gZmFsc2U7CgkJCWlmICggbGlzdCApIHsKCQkJCWlmICggc3RhY2sgKSB7CgkJCQkJaWYgKCBzdGFjay5sZW5ndGggKSB7CgkJCQkJCWZpcmUoIHN0YWNrLnNoaWZ0KCkgKTsKCQkJCQl9CgkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgKSB7CgkJCQkJbGlzdCA9IFtdOwoJCQkJfSBlbHNlIHsKCQkJCQlzZWxmLmRpc2FibGUoKTsKCQkJCX0KCQkJfQoJCX0sCgkJLy8gQWN0dWFsIENhbGxiYWNrcyBvYmplY3QKCQlzZWxmID0gewoJCQkvLyBBZGQgYSBjYWxsYmFjayBvciBhIGNvbGxlY3Rpb24gb2YgY2FsbGJhY2tzIHRvIHRoZSBsaXN0CgkJCWFkZDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJLy8gRmlyc3QsIHdlIHNhdmUgdGhlIGN1cnJlbnQgbGVuZ3RoCgkJCQkJdmFyIHN0YXJ0ID0gbGlzdC5sZW5ndGg7CgkJCQkJKGZ1bmN0aW9uIGFkZCggYXJncyApIHsKCQkJCQkJalF1ZXJ5LmVhY2goIGFyZ3MsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7CgkJCQkJCQl2YXIgdHlwZSA9IGpRdWVyeS50eXBlKCBhcmcgKTsKCQkJCQkJCWlmICggdHlwZSA9PT0gImZ1bmN0aW9uIiApIHsKCQkJCQkJCQlpZiAoICFvcHRpb25zLnVuaXF1ZSB8fCAhc2VsZi5oYXMoIGFyZyApICkgewoJCQkJCQkJCQlsaXN0LnB1c2goIGFyZyApOwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSBpZiAoIGFyZyAmJiBhcmcubGVuZ3RoICYmIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQkJCQkJCS8vIEluc3BlY3QgcmVjdXJzaXZlbHkKCQkJCQkJCQlhZGQoIGFyZyApOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9KSggYXJndW1lbnRzICk7CgkJCQkJLy8gRG8gd2UgbmVlZCB0byBhZGQgdGhlIGNhbGxiYWNrcyB0byB0aGUKCQkJCQkvLyBjdXJyZW50IGZpcmluZyBiYXRjaD8KCQkJCQlpZiAoIGZpcmluZyApIHsKCQkJCQkJZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCQkJLy8gV2l0aCBtZW1vcnksIGlmIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbgoJCQkJCS8vIHdlIHNob3VsZCBjYWxsIHJpZ2h0IGF3YXkKCQkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgKSB7CgkJCQkJCWZpcmluZ1N0YXJ0ID0gc3RhcnQ7CgkJCQkJCWZpcmUoIG1lbW9yeSApOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBSZW1vdmUgYSBjYWxsYmFjayBmcm9tIHRoZSBsaXN0CgkJCXJlbW92ZTogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJalF1ZXJ5LmVhY2goIGFyZ3VtZW50cywgZnVuY3Rpb24oIF8sIGFyZyApIHsKCQkJCQkJdmFyIGluZGV4OwoJCQkJCQl3aGlsZSggKCBpbmRleCA9IGpRdWVyeS5pbkFycmF5KCBhcmcsIGxpc3QsIGluZGV4ICkgKSA+IC0xICkgewoJCQkJCQkJbGlzdC5zcGxpY2UoIGluZGV4LCAxICk7CgkJCQkJCQkvLyBIYW5kbGUgZmlyaW5nIGluZGV4ZXMKCQkJCQkJCWlmICggZmlyaW5nICkgewoJCQkJCQkJCWlmICggaW5kZXggPD0gZmlyaW5nTGVuZ3RoICkgewoJCQkJCQkJCQlmaXJpbmdMZW5ndGgtLTsKCQkJCQkJCQl9CgkJCQkJCQkJaWYgKCBpbmRleCA8PSBmaXJpbmdJbmRleCApIHsKCQkJCQkJCQkJZmlyaW5nSW5kZXgtLTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBDaGVjayBpZiBhIGdpdmVuIGNhbGxiYWNrIGlzIGluIHRoZSBsaXN0LgoJCQkvLyBJZiBubyBhcmd1bWVudCBpcyBnaXZlbiwgcmV0dXJuIHdoZXRoZXIgb3Igbm90IGxpc3QgaGFzIGNhbGxiYWNrcyBhdHRhY2hlZC4KCQkJaGFzOiBmdW5jdGlvbiggZm4gKSB7CgkJCQlyZXR1cm4gZm4gPyBqUXVlcnkuaW5BcnJheSggZm4sIGxpc3QgKSA+IC0xIDogISEoIGxpc3QgJiYgbGlzdC5sZW5ndGggKTsKCQkJfSwKCQkJLy8gUmVtb3ZlIGFsbCBjYWxsYmFja3MgZnJvbSB0aGUgbGlzdAoJCQllbXB0eTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gW107CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSGF2ZSB0aGUgbGlzdCBkbyBub3RoaW5nIGFueW1vcmUKCQkJZGlzYWJsZTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gc3RhY2sgPSBtZW1vcnkgPSB1bmRlZmluZWQ7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSXMgaXQgZGlzYWJsZWQ/CgkJCWRpc2FibGVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhbGlzdDsKCQkJfSwKCQkJLy8gTG9jayB0aGUgbGlzdCBpbiBpdHMgY3VycmVudCBzdGF0ZQoJCQlsb2NrOiBmdW5jdGlvbigpIHsKCQkJCXN0YWNrID0gdW5kZWZpbmVkOwoJCQkJaWYgKCAhbWVtb3J5ICkgewoJCQkJCXNlbGYuZGlzYWJsZSgpOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIElzIGl0IGxvY2tlZD8KCQkJbG9ja2VkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhc3RhY2s7CgkJCX0sCgkJCS8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKCQkJZmlyZVdpdGg6IGZ1bmN0aW9uKCBjb250ZXh0LCBhcmdzICkgewoJCQkJYXJncyA9IGFyZ3MgfHwgW107CgkJCQlhcmdzID0gWyBjb250ZXh0LCBhcmdzLnNsaWNlID8gYXJncy5zbGljZSgpIDogYXJncyBdOwoJCQkJaWYgKCBsaXN0ICYmICggIWZpcmVkIHx8IHN0YWNrICkgKSB7CgkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCXN0YWNrLnB1c2goIGFyZ3MgKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlmaXJlKCBhcmdzICk7CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIENhbGwgYWxsIHRoZSBjYWxsYmFja3Mgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzCgkJCWZpcmU6IGZ1bmN0aW9uKCkgewoJCQkJc2VsZi5maXJlV2l0aCggdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gVG8ga25vdyBpZiB0aGUgY2FsbGJhY2tzIGhhdmUgYWxyZWFkeSBiZWVuIGNhbGxlZCBhdCBsZWFzdCBvbmNlCgkJCWZpcmVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhIWZpcmVkOwoJCQl9CgkJfTsKCglyZXR1cm4gc2VsZjsKfTsKalF1ZXJ5LmV4dGVuZCh7CgoJRGVmZXJyZWQ6IGZ1bmN0aW9uKCBmdW5jICkgewoJCXZhciB0dXBsZXMgPSBbCgkJCQkvLyBhY3Rpb24sIGFkZCBsaXN0ZW5lciwgbGlzdGVuZXIgbGlzdCwgZmluYWwgc3RhdGUKCQkJCVsgInJlc29sdmUiLCAiZG9uZSIsIGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZXNvbHZlZCIgXSwKCQkJCVsgInJlamVjdCIsICJmYWlsIiwgalF1ZXJ5LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgInJlamVjdGVkIiBdLAoJCQkJWyAibm90aWZ5IiwgInByb2dyZXNzIiwgalF1ZXJ5LkNhbGxiYWNrcygibWVtb3J5IikgXQoJCQldLAoJCQlzdGF0ZSA9ICJwZW5kaW5nIiwKCQkJcHJvbWlzZSA9IHsKCQkJCXN0YXRlOiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gc3RhdGU7CgkJCQl9LAoJCQkJYWx3YXlzOiBmdW5jdGlvbigpIHsKCQkJCQlkZWZlcnJlZC5kb25lKCBhcmd1bWVudHMgKS5mYWlsKCBhcmd1bWVudHMgKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgkJCQl0aGVuOiBmdW5jdGlvbiggLyogZm5Eb25lLCBmbkZhaWwsIGZuUHJvZ3Jlc3MgKi8gKSB7CgkJCQkJdmFyIGZucyA9IGFyZ3VtZW50czsKCQkJCQlyZXR1cm4galF1ZXJ5LkRlZmVycmVkKGZ1bmN0aW9uKCBuZXdEZWZlciApIHsKCQkJCQkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQkJCQkJdmFyIGFjdGlvbiA9IHR1cGxlWyAwIF0sCgkJCQkJCQkJZm4gPSBqUXVlcnkuaXNGdW5jdGlvbiggZm5zWyBpIF0gKSAmJiBmbnNbIGkgXTsKCQkJCQkJCS8vIGRlZmVycmVkWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gZm9yIGZvcndhcmRpbmcgYWN0aW9ucyB0byBuZXdEZWZlcgoJCQkJCQkJZGVmZXJyZWRbIHR1cGxlWzFdIF0oZnVuY3Rpb24oKSB7CgkJCQkJCQkJdmFyIHJldHVybmVkID0gZm4gJiYgZm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJCQkJCWlmICggcmV0dXJuZWQgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIHJldHVybmVkLnByb21pc2UgKSApIHsKCQkJCQkJCQkJcmV0dXJuZWQucHJvbWlzZSgpCgkJCQkJCQkJCQkuZG9uZSggbmV3RGVmZXIucmVzb2x2ZSApCgkJCQkJCQkJCQkuZmFpbCggbmV3RGVmZXIucmVqZWN0ICkKCQkJCQkJCQkJCS5wcm9ncmVzcyggbmV3RGVmZXIubm90aWZ5ICk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJbmV3RGVmZXJbIGFjdGlvbiArICJXaXRoIiBdKCB0aGlzID09PSBwcm9taXNlID8gbmV3RGVmZXIucHJvbWlzZSgpIDogdGhpcywgZm4gPyBbIHJldHVybmVkIF0gOiBhcmd1bWVudHMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfSk7CgkJCQkJCWZucyA9IG51bGw7CgkJCQkJfSkucHJvbWlzZSgpOwoJCQkJfSwKCQkJCS8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKCQkJCS8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKCQkJCXByb21pc2U6IGZ1bmN0aW9uKCBvYmogKSB7CgkJCQkJcmV0dXJuIG9iaiAhPSBudWxsID8galF1ZXJ5LmV4dGVuZCggb2JqLCBwcm9taXNlICkgOiBwcm9taXNlOwoJCQkJfQoJCQl9LAoJCQlkZWZlcnJlZCA9IHt9OwoKCQkvLyBLZWVwIHBpcGUgZm9yIGJhY2stY29tcGF0CgkJcHJvbWlzZS5waXBlID0gcHJvbWlzZS50aGVuOwoKCQkvLyBBZGQgbGlzdC1zcGVjaWZpYyBtZXRob2RzCgkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQl2YXIgbGlzdCA9IHR1cGxlWyAyIF0sCgkJCQlzdGF0ZVN0cmluZyA9IHR1cGxlWyAzIF07CgoJCQkvLyBwcm9taXNlWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gPSBsaXN0LmFkZAoJCQlwcm9taXNlWyB0dXBsZVsxXSBdID0gbGlzdC5hZGQ7CgoJCQkvLyBIYW5kbGUgc3RhdGUKCQkJaWYgKCBzdGF0ZVN0cmluZyApIHsKCQkJCWxpc3QuYWRkKGZ1bmN0aW9uKCkgewoJCQkJCS8vIHN0YXRlID0gWyByZXNvbHZlZCB8IHJlamVjdGVkIF0KCQkJCQlzdGF0ZSA9IHN0YXRlU3RyaW5nOwoKCQkJCS8vIFsgcmVqZWN0X2xpc3QgfCByZXNvbHZlX2xpc3QgXS5kaXNhYmxlOyBwcm9ncmVzc19saXN0LmxvY2sKCQkJCX0sIHR1cGxlc1sgaSBeIDEgXVsgMiBdLmRpc2FibGUsIHR1cGxlc1sgMiBdWyAyIF0ubG9jayApOwoJCQl9CgoJCQkvLyBkZWZlcnJlZFsgcmVzb2x2ZSB8IHJlamVjdCB8IG5vdGlmeSBdCgkJCWRlZmVycmVkWyB0dXBsZVswXSBdID0gZnVuY3Rpb24oKSB7CgkJCQlkZWZlcnJlZFsgdHVwbGVbMF0gKyAiV2l0aCIgXSggdGhpcyA9PT0gZGVmZXJyZWQgPyBwcm9taXNlIDogdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfTsKCQkJZGVmZXJyZWRbIHR1cGxlWzBdICsgIldpdGgiIF0gPSBsaXN0LmZpcmVXaXRoOwoJCX0pOwoKCQkvLyBNYWtlIHRoZSBkZWZlcnJlZCBhIHByb21pc2UKCQlwcm9taXNlLnByb21pc2UoIGRlZmVycmVkICk7CgoJCS8vIENhbGwgZ2l2ZW4gZnVuYyBpZiBhbnkKCQlpZiAoIGZ1bmMgKSB7CgkJCWZ1bmMuY2FsbCggZGVmZXJyZWQsIGRlZmVycmVkICk7CgkJfQoKCQkvLyBBbGwgZG9uZSEKCQlyZXR1cm4gZGVmZXJyZWQ7Cgl9LAoKCS8vIERlZmVycmVkIGhlbHBlcgoJd2hlbjogZnVuY3Rpb24oIHN1Ym9yZGluYXRlIC8qICwgLi4uLCBzdWJvcmRpbmF0ZU4gKi8gKSB7CgkJdmFyIGkgPSAwLAoJCQlyZXNvbHZlVmFsdWVzID0gY29yZV9zbGljZS5jYWxsKCBhcmd1bWVudHMgKSwKCQkJbGVuZ3RoID0gcmVzb2x2ZVZhbHVlcy5sZW5ndGgsCgoJCQkvLyB0aGUgY291bnQgb2YgdW5jb21wbGV0ZWQgc3Vib3JkaW5hdGVzCgkJCXJlbWFpbmluZyA9IGxlbmd0aCAhPT0gMSB8fCAoIHN1Ym9yZGluYXRlICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBzdWJvcmRpbmF0ZS5wcm9taXNlICkgKSA/IGxlbmd0aCA6IDAsCgoJCQkvLyB0aGUgbWFzdGVyIERlZmVycmVkLiBJZiByZXNvbHZlVmFsdWVzIGNvbnNpc3Qgb2Ygb25seSBhIHNpbmdsZSBEZWZlcnJlZCwganVzdCB1c2UgdGhhdC4KCQkJZGVmZXJyZWQgPSByZW1haW5pbmcgPT09IDEgPyBzdWJvcmRpbmF0ZSA6IGpRdWVyeS5EZWZlcnJlZCgpLAoKCQkJLy8gVXBkYXRlIGZ1bmN0aW9uIGZvciBib3RoIHJlc29sdmUgYW5kIHByb2dyZXNzIHZhbHVlcwoJCQl1cGRhdGVGdW5jID0gZnVuY3Rpb24oIGksIGNvbnRleHRzLCB2YWx1ZXMgKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24oIHZhbHVlICkgewoJCQkJCWNvbnRleHRzWyBpIF0gPSB0aGlzOwoJCQkJCXZhbHVlc1sgaSBdID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBjb3JlX3NsaWNlLmNhbGwoIGFyZ3VtZW50cyApIDogdmFsdWU7CgkJCQkJaWYoIHZhbHVlcyA9PT0gcHJvZ3Jlc3NWYWx1ZXMgKSB7CgkJCQkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGNvbnRleHRzLCB2YWx1ZXMgKTsKCQkJCQl9IGVsc2UgaWYgKCAhKCAtLXJlbWFpbmluZyApICkgewoJCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY29udGV4dHMsIHZhbHVlcyApOwoJCQkJCX0KCQkJCX07CgkJCX0sCgoJCQlwcm9ncmVzc1ZhbHVlcywgcHJvZ3Jlc3NDb250ZXh0cywgcmVzb2x2ZUNvbnRleHRzOwoKCQkvLyBhZGQgbGlzdGVuZXJzIHRvIERlZmVycmVkIHN1Ym9yZGluYXRlczsgdHJlYXQgb3RoZXJzIGFzIHJlc29sdmVkCgkJaWYgKCBsZW5ndGggPiAxICkgewoJCQlwcm9ncmVzc1ZhbHVlcyA9IG5ldyBBcnJheSggbGVuZ3RoICk7CgkJCXByb2dyZXNzQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlyZXNvbHZlQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWlmICggcmVzb2x2ZVZhbHVlc1sgaSBdICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCXJlc29sdmVWYWx1ZXNbIGkgXS5wcm9taXNlKCkKCQkJCQkJLmRvbmUoIHVwZGF0ZUZ1bmMoIGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApICkKCQkJCQkJLmZhaWwoIGRlZmVycmVkLnJlamVjdCApCgkJCQkJCS5wcm9ncmVzcyggdXBkYXRlRnVuYyggaSwgcHJvZ3Jlc3NDb250ZXh0cywgcHJvZ3Jlc3NWYWx1ZXMgKSApOwoJCQkJfSBlbHNlIHsKCQkJCQktLXJlbWFpbmluZzsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gaWYgd2UncmUgbm90IHdhaXRpbmcgb24gYW55dGhpbmcsIHJlc29sdmUgdGhlIG1hc3RlcgoJCWlmICggIXJlbWFpbmluZyApIHsKCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApOwoJCX0KCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKCX0KfSk7CmpRdWVyeS5zdXBwb3J0ID0gKGZ1bmN0aW9uKCkgewoKCXZhciBzdXBwb3J0LCBhbGwsIGEsCgkJaW5wdXQsIHNlbGVjdCwgZnJhZ21lbnQsCgkJb3B0LCBldmVudE5hbWUsIGlzU3VwcG9ydGVkLCBpLAoJCWRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKCS8vIFNldHVwCglkaXYuc2V0QXR0cmlidXRlKCAiY2xhc3NOYW1lIiwgInQiICk7CglkaXYuaW5uZXJIVE1MID0gIiAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJz5hPC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPiI7CgoJLy8gU3VwcG9ydCB0ZXN0cyB3b24ndCBydW4gaW4gc29tZSBsaW1pdGVkIG9yIG5vbi1icm93c2VyIGVudmlyb25tZW50cwoJYWxsID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIik7CglhID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJhIilbIDAgXTsKCWlmICggIWFsbCB8fCAhYSB8fCAhYWxsLmxlbmd0aCApIHsKCQlyZXR1cm4ge307Cgl9CgoJLy8gRmlyc3QgYmF0Y2ggb2YgdGVzdHMKCXNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJb3B0ID0gc2VsZWN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSApOwoJaW5wdXQgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IilbIDAgXTsKCglhLnN0eWxlLmNzc1RleHQgPSAidG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjUiOwoJc3VwcG9ydCA9IHsKCQkvLyBUZXN0IHNldEF0dHJpYnV0ZSBvbiBjYW1lbENhc2UgY2xhc3MuIElmIGl0IHdvcmtzLCB3ZSBuZWVkIGF0dHJGaXhlcyB3aGVuIGRvaW5nIGdldC9zZXRBdHRyaWJ1dGUgKGllNi83KQoJCWdldFNldEF0dHJpYnV0ZTogZGl2LmNsYXNzTmFtZSAhPT0gInQiLAoKCQkvLyBJRSBzdHJpcHMgbGVhZGluZyB3aGl0ZXNwYWNlIHdoZW4gLmlubmVySFRNTCBpcyB1c2VkCgkJbGVhZGluZ1doaXRlc3BhY2U6IGRpdi5maXJzdENoaWxkLm5vZGVUeXBlID09PSAzLAoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0Ym9keSBlbGVtZW50cyBhcmVuJ3QgYXV0b21hdGljYWxseSBpbnNlcnRlZAoJCS8vIElFIHdpbGwgaW5zZXJ0IHRoZW0gaW50byBlbXB0eSB0YWJsZXMKCQl0Ym9keTogIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKS5sZW5ndGgsCgoJCS8vIE1ha2Ugc3VyZSB0aGF0IGxpbmsgZWxlbWVudHMgZ2V0IHNlcmlhbGl6ZWQgY29ycmVjdGx5IGJ5IGlubmVySFRNTAoJCS8vIFRoaXMgcmVxdWlyZXMgYSB3cmFwcGVyIGVsZW1lbnQgaW4gSUUKCQlodG1sU2VyaWFsaXplOiAhIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgibGluayIpLmxlbmd0aCwKCgkJLy8gR2V0IHRoZSBzdHlsZSBpbmZvcm1hdGlvbiBmcm9tIGdldEF0dHJpYnV0ZQoJCS8vIChJRSB1c2VzIC5jc3NUZXh0IGluc3RlYWQpCgkJc3R5bGU6IC90b3AvLnRlc3QoIGEuZ2V0QXR0cmlidXRlKCJzdHlsZSIpICksCgoJCS8vIE1ha2Ugc3VyZSB0aGF0IFVSTHMgYXJlbid0IG1hbmlwdWxhdGVkCgkJLy8gKElFIG5vcm1hbGl6ZXMgaXQgYnkgZGVmYXVsdCkKCQlocmVmTm9ybWFsaXplZDogYS5nZXRBdHRyaWJ1dGUoImhyZWYiKSA9PT0gIi9hIiwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgZWxlbWVudCBvcGFjaXR5IGV4aXN0cwoJCS8vIChJRSB1c2VzIGZpbHRlciBpbnN0ZWFkKQoJCS8vIFVzZSBhIHJlZ2V4IHRvIHdvcmsgYXJvdW5kIGEgV2ViS2l0IGlzc3VlLiBTZWUgIzUxNDUKCQlvcGFjaXR5OiAvXjAuNS8udGVzdCggYS5zdHlsZS5vcGFjaXR5ICksCgoJCS8vIFZlcmlmeSBzdHlsZSBmbG9hdCBleGlzdGVuY2UKCQkvLyAoSUUgdXNlcyBzdHlsZUZsb2F0IGluc3RlYWQgb2YgY3NzRmxvYXQpCgkJY3NzRmxvYXQ6ICEhYS5zdHlsZS5jc3NGbG9hdCwKCgkJLy8gQ2hlY2sgdGhlIGRlZmF1bHQgY2hlY2tib3gvcmFkaW8gdmFsdWUgKCIiIG9uIFdlYktpdDsgIm9uIiBlbHNld2hlcmUpCgkJY2hlY2tPbjogISFpbnB1dC52YWx1ZSwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgYSBzZWxlY3RlZC1ieS1kZWZhdWx0IG9wdGlvbiBoYXMgYSB3b3JraW5nIHNlbGVjdGVkIHByb3BlcnR5LgoJCS8vIChXZWJLaXQgZGVmYXVsdHMgdG8gZmFsc2UgaW5zdGVhZCBvZiB0cnVlLCBJRSB0b28sIGlmIGl0J3MgaW4gYW4gb3B0Z3JvdXApCgkJb3B0U2VsZWN0ZWQ6IG9wdC5zZWxlY3RlZCwKCgkJLy8gVGVzdHMgZm9yIGVuY3R5cGUgc3VwcG9ydCBvbiBhIGZvcm0gKCM2NzQzKQoJCWVuY3R5cGU6ICEhZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9ybSIpLmVuY3R5cGUsCgoJCS8vIE1ha2VzIHN1cmUgY2xvbmluZyBhbiBodG1sNSBlbGVtZW50IGRvZXMgbm90IGNhdXNlIHByb2JsZW1zCgkJLy8gV2hlcmUgb3V0ZXJIVE1MIGlzIHVuZGVmaW5lZCwgdGhpcyBzdGlsbCB3b3JrcwoJCWh0bWw1Q2xvbmU6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm5hdiIpLmNsb25lTm9kZSggdHJ1ZSApLm91dGVySFRNTCAhPT0gIjw6bmF2PjwvOm5hdj4iLAoKCQkvLyBqUXVlcnkuc3VwcG9ydC5ib3hNb2RlbCBERVBSRUNBVEVEIGluIDEuOCBzaW5jZSB3ZSBkb24ndCBzdXBwb3J0IFF1aXJrcyBNb2RlCgkJYm94TW9kZWw6IGRvY3VtZW50LmNvbXBhdE1vZGUgPT09ICJDU1MxQ29tcGF0IiwKCgkJLy8gV2lsbCBiZSBkZWZpbmVkIGxhdGVyCgkJZGVsZXRlRXhwYW5kbzogdHJ1ZSwKCQlub0Nsb25lRXZlbnQ6IHRydWUsCgkJaW5saW5lQmxvY2tOZWVkc0xheW91dDogZmFsc2UsCgkJc2hyaW5rV3JhcEJsb2NrczogZmFsc2UsCgkJcmVsaWFibGVNYXJnaW5SaWdodDogdHJ1ZSwKCQlib3hTaXppbmdSZWxpYWJsZTogdHJ1ZSwKCQlwaXhlbFBvc2l0aW9uOiBmYWxzZQoJfTsKCgkvLyBNYWtlIHN1cmUgY2hlY2tlZCBzdGF0dXMgaXMgcHJvcGVybHkgY2xvbmVkCglpbnB1dC5jaGVja2VkID0gdHJ1ZTsKCXN1cHBvcnQubm9DbG9uZUNoZWNrZWQgPSBpbnB1dC5jbG9uZU5vZGUoIHRydWUgKS5jaGVja2VkOwoKCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBvcHRpb25zIGluc2lkZSBkaXNhYmxlZCBzZWxlY3RzIGFyZW4ndCBtYXJrZWQgYXMgZGlzYWJsZWQKCS8vIChXZWJLaXQgbWFya3MgdGhlbSBhcyBkaXNhYmxlZCkKCXNlbGVjdC5kaXNhYmxlZCA9IHRydWU7CglzdXBwb3J0Lm9wdERpc2FibGVkID0gIW9wdC5kaXNhYmxlZDsKCgkvLyBTdXBwb3J0OiBJRTw5Cgl0cnkgewoJCWRlbGV0ZSBkaXYudGVzdDsKCX0gY2F0Y2goIGUgKSB7CgkJc3VwcG9ydC5kZWxldGVFeHBhbmRvID0gZmFsc2U7Cgl9CgoJLy8gQ2hlY2sgaWYgd2UgY2FuIHRydXN0IGdldEF0dHJpYnV0ZSgidmFsdWUiKQoJaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidmFsdWUiLCAiIiApOwoJc3VwcG9ydC5pbnB1dCA9IGlucHV0LmdldEF0dHJpYnV0ZSggInZhbHVlIiApID09PSAiIjsKCgkvLyBDaGVjayBpZiBhbiBpbnB1dCBtYWludGFpbnMgaXRzIHZhbHVlIGFmdGVyIGJlY29taW5nIGEgcmFkaW8KCWlucHV0LnZhbHVlID0gInQiOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidHlwZSIsICJyYWRpbyIgKTsKCXN1cHBvcnQucmFkaW9WYWx1ZSA9IGlucHV0LnZhbHVlID09PSAidCI7CgoJLy8gIzExMjE3IC0gV2ViS2l0IGxvc2VzIGNoZWNrIHdoZW4gdGhlIG5hbWUgaXMgYWZ0ZXIgdGhlIGNoZWNrZWQgYXR0cmlidXRlCglpbnB1dC5zZXRBdHRyaWJ1dGUoICJjaGVja2VkIiwgInQiICk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoICJuYW1lIiwgInQiICk7CgoJZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CglmcmFnbWVudC5hcHBlbmRDaGlsZCggaW5wdXQgKTsKCgkvLyBDaGVjayBpZiBhIGRpc2Nvbm5lY3RlZCBjaGVja2JveCB3aWxsIHJldGFpbiBpdHMgY2hlY2tlZAoJLy8gdmFsdWUgb2YgdHJ1ZSBhZnRlciBhcHBlbmRlZCB0byB0aGUgRE9NIChJRTYvNykKCXN1cHBvcnQuYXBwZW5kQ2hlY2tlZCA9IGlucHV0LmNoZWNrZWQ7CgoJLy8gV2ViS2l0IGRvZXNuJ3QgY2xvbmUgY2hlY2tlZCBzdGF0ZSBjb3JyZWN0bHkgaW4gZnJhZ21lbnRzCglzdXBwb3J0LmNoZWNrQ2xvbmUgPSBmcmFnbWVudC5jbG9uZU5vZGUoIHRydWUgKS5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuY2hlY2tlZDsKCgkvLyBTdXBwb3J0OiBJRTw5CgkvLyBPcGVyYSBkb2VzIG5vdCBjbG9uZSBldmVudHMgKGFuZCB0eXBlb2YgZGl2LmF0dGFjaEV2ZW50ID09PSB1bmRlZmluZWQpLgoJLy8gSUU5LTEwIGNsb25lcyBldmVudHMgYm91bmQgdmlhIGF0dGFjaEV2ZW50LCBidXQgdGhleSBkb24ndCB0cmlnZ2VyIHdpdGggLmNsaWNrKCkKCWlmICggZGl2LmF0dGFjaEV2ZW50ICkgewoJCWRpdi5hdHRhY2hFdmVudCggIm9uY2xpY2siLCBmdW5jdGlvbigpIHsKCQkJc3VwcG9ydC5ub0Nsb25lRXZlbnQgPSBmYWxzZTsKCQl9KTsKCgkJZGl2LmNsb25lTm9kZSggdHJ1ZSApLmNsaWNrKCk7Cgl9CgoJLy8gU3VwcG9ydDogSUU8OSAobGFjayBzdWJtaXQvY2hhbmdlIGJ1YmJsZSksIEZpcmVmb3ggMTcrIChsYWNrIGZvY3VzaW4gZXZlbnQpCgkvLyBCZXdhcmUgb2YgQ1NQIHJlc3RyaWN0aW9ucyAoaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vU2VjdXJpdHkvQ1NQKSwgdGVzdC9jc3AucGhwCglmb3IgKCBpIGluIHsgc3VibWl0OiB0cnVlLCBjaGFuZ2U6IHRydWUsIGZvY3VzaW46IHRydWUgfSkgewoJCWRpdi5zZXRBdHRyaWJ1dGUoIGV2ZW50TmFtZSA9ICJvbiIgKyBpLCAidCIgKTsKCgkJc3VwcG9ydFsgaSArICJCdWJibGVzIiBdID0gZXZlbnROYW1lIGluIHdpbmRvdyB8fCBkaXYuYXR0cmlidXRlc1sgZXZlbnROYW1lIF0uZXhwYW5kbyA9PT0gZmFsc2U7Cgl9CgoJZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID0gImNvbnRlbnQtYm94IjsKCWRpdi5jbG9uZU5vZGUoIHRydWUgKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICIiOwoJc3VwcG9ydC5jbGVhckNsb25lU3R5bGUgPSBkaXYuc3R5bGUuYmFja2dyb3VuZENsaXAgPT09ICJjb250ZW50LWJveCI7CgoJLy8gUnVuIHRlc3RzIHRoYXQgbmVlZCBhIGJvZHkgYXQgZG9jIHJlYWR5CglqUXVlcnkoZnVuY3Rpb24oKSB7CgkJdmFyIGNvbnRhaW5lciwgbWFyZ2luRGl2LCB0ZHMsCgkJCWRpdlJlc2V0ID0gInBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5OmJsb2NrO2JveC1zaXppbmc6Y29udGVudC1ib3g7LW1vei1ib3gtc2l6aW5nOmNvbnRlbnQtYm94Oy13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDsiLAoJCQlib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsKCgkJaWYgKCAhYm9keSApIHsKCQkJLy8gUmV0dXJuIGZvciBmcmFtZXNldCBkb2NzIHRoYXQgZG9uJ3QgaGF2ZSBhIGJvZHkKCQkJcmV0dXJuOwoJCX0KCgkJY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgkJY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAiYm9yZGVyOjA7d2lkdGg6MDtoZWlnaHQ6MDtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0Oi05OTk5cHg7bWFyZ2luLXRvcDoxcHgiOwoKCQlib2R5LmFwcGVuZENoaWxkKCBjb250YWluZXIgKS5hcHBlbmRDaGlsZCggZGl2ICk7CgoJCS8vIFN1cHBvcnQ6IElFOAoJCS8vIENoZWNrIGlmIHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0IHdoZW4gdGhleSBhcmUgc2V0CgkJLy8gdG8gZGlzcGxheTpub25lIGFuZCB0aGVyZSBhcmUgc3RpbGwgb3RoZXIgdmlzaWJsZSB0YWJsZSBjZWxscyBpbiBhCgkJLy8gdGFibGUgcm93OyBpZiBzbywgb2Zmc2V0V2lkdGgvSGVpZ2h0IGFyZSBub3QgcmVsaWFibGUgZm9yIHVzZSB3aGVuCgkJLy8gZGV0ZXJtaW5pbmcgaWYgYW4gZWxlbWVudCBoYXMgYmVlbiBoaWRkZW4gZGlyZWN0bHkgdXNpbmcKCQkvLyBkaXNwbGF5Om5vbmUgKGl0IGlzIHN0aWxsIHNhZmUgdG8gdXNlIG9mZnNldHMgaWYgYSBwYXJlbnQgZWxlbWVudCBpcwoJCS8vIGhpZGRlbjsgZG9uIHNhZmV0eSBnb2dnbGVzIGFuZCBzZWUgYnVnICM0NTEyIGZvciBtb3JlIGluZm9ybWF0aW9uKS4KCQlkaXYuaW5uZXJIVE1MID0gIjx0YWJsZT48dHI+PHRkPjwvdGQ+PHRkPnQ8L3RkPjwvdHI+PC90YWJsZT4iOwoJCXRkcyA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGQiKTsKCQl0ZHNbIDAgXS5zdHlsZS5jc3NUZXh0ID0gInBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5Om5vbmUiOwoJCWlzU3VwcG9ydGVkID0gKCB0ZHNbIDAgXS5vZmZzZXRIZWlnaHQgPT09IDAgKTsKCgkJdGRzWyAwIF0uc3R5bGUuZGlzcGxheSA9ICIiOwoJCXRkc1sgMSBdLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgoJCS8vIFN1cHBvcnQ6IElFOAoJCS8vIENoZWNrIGlmIGVtcHR5IHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0CgkJc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMgPSBpc1N1cHBvcnRlZCAmJiAoIHRkc1sgMCBdLm9mZnNldEhlaWdodCA9PT0gMCApOwoKCQkvLyBDaGVjayBib3gtc2l6aW5nIGFuZCBtYXJnaW4gYmVoYXZpb3IKCQlkaXYuaW5uZXJIVE1MID0gIiI7CgkJZGl2LnN0eWxlLmNzc1RleHQgPSAiYm94LXNpemluZzpib3JkZXItYm94Oy1tb3otYm94LXNpemluZzpib3JkZXItYm94Oy13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94O3BhZGRpbmc6MXB4O2JvcmRlcjoxcHg7ZGlzcGxheTpibG9jazt3aWR0aDo0cHg7bWFyZ2luLXRvcDoxJTtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MSU7IjsKCQlzdXBwb3J0LmJveFNpemluZyA9ICggZGl2Lm9mZnNldFdpZHRoID09PSA0ICk7CgkJc3VwcG9ydC5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldCA9ICggYm9keS5vZmZzZXRUb3AgIT09IDEgKTsKCgkJLy8gVXNlIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlIGJlY2F1c2UganNkb20gb24gbm9kZS5qcyB3aWxsIGJyZWFrIHdpdGhvdXQgaXQuCgkJaWYgKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSApIHsKCQkJc3VwcG9ydC5waXhlbFBvc2l0aW9uID0gKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggZGl2LCBudWxsICkgfHwge30gKS50b3AgIT09ICIxJSI7CgkJCXN1cHBvcnQuYm94U2l6aW5nUmVsaWFibGUgPSAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBkaXYsIG51bGwgKSB8fCB7IHdpZHRoOiAiNHB4IiB9ICkud2lkdGggPT09ICI0cHgiOwoKCQkJLy8gQ2hlY2sgaWYgZGl2IHdpdGggZXhwbGljaXQgd2lkdGggYW5kIG5vIG1hcmdpbi1yaWdodCBpbmNvcnJlY3RseQoJCQkvLyBnZXRzIGNvbXB1dGVkIG1hcmdpbi1yaWdodCBiYXNlZCBvbiB3aWR0aCBvZiBjb250YWluZXIuICgjMzMzMykKCQkJLy8gRmFpbHMgaW4gV2ViS2l0IGJlZm9yZSBGZWIgMjAxMSBuaWdodGxpZXMKCQkJLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CgkJCW1hcmdpbkRpdiA9IGRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikgKTsKCQkJbWFyZ2luRGl2LnN0eWxlLmNzc1RleHQgPSBkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0OwoJCQltYXJnaW5EaXYuc3R5bGUubWFyZ2luUmlnaHQgPSBtYXJnaW5EaXYuc3R5bGUud2lkdGggPSAiMCI7CgkJCWRpdi5zdHlsZS53aWR0aCA9ICIxcHgiOwoKCQkJc3VwcG9ydC5yZWxpYWJsZU1hcmdpblJpZ2h0ID0KCQkJCSFwYXJzZUZsb2F0KCAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBtYXJnaW5EaXYsIG51bGwgKSB8fCB7fSApLm1hcmdpblJpZ2h0ICk7CgkJfQoKCQlpZiAoIHR5cGVvZiBkaXYuc3R5bGUuem9vbSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCS8vIFN1cHBvcnQ6IElFPDgKCQkJLy8gQ2hlY2sgaWYgbmF0aXZlbHkgYmxvY2stbGV2ZWwgZWxlbWVudHMgYWN0IGxpa2UgaW5saW5lLWJsb2NrCgkJCS8vIGVsZW1lbnRzIHdoZW4gc2V0dGluZyB0aGVpciBkaXNwbGF5IHRvICdpbmxpbmUnIGFuZCBnaXZpbmcKCQkJLy8gdGhlbSBsYXlvdXQKCQkJZGl2LmlubmVySFRNTCA9ICIiOwoJCQlkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0ICsgIndpZHRoOjFweDtwYWRkaW5nOjFweDtkaXNwbGF5OmlubGluZTt6b29tOjEiOwoJCQlzdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQgPSAoIGRpdi5vZmZzZXRXaWR0aCA9PT0gMyApOwoKCQkJLy8gU3VwcG9ydDogSUU2CgkJCS8vIENoZWNrIGlmIGVsZW1lbnRzIHdpdGggbGF5b3V0IHNocmluay13cmFwIHRoZWlyIGNoaWxkcmVuCgkJCWRpdi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJZGl2LmlubmVySFRNTCA9ICI8ZGl2PjwvZGl2PiI7CgkJCWRpdi5maXJzdENoaWxkLnN0eWxlLndpZHRoID0gIjVweCI7CgkJCXN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyA9ICggZGl2Lm9mZnNldFdpZHRoICE9PSAzICk7CgoJCQlpZiAoIHN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCApIHsKCQkJCS8vIFByZXZlbnQgSUUgNiBmcm9tIGFmZmVjdGluZyBsYXlvdXQgZm9yIHBvc2l0aW9uZWQgZWxlbWVudHMgIzExMDQ4CgkJCQkvLyBQcmV2ZW50IElFIGZyb20gc2hyaW5raW5nIHRoZSBib2R5IGluIElFIDcgbW9kZSAjMTI4NjkKCQkJCS8vIFN1cHBvcnQ6IElFPDgKCQkJCWJvZHkuc3R5bGUuem9vbSA9IDE7CgkJCX0KCQl9CgoJCWJvZHkucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwoKCQkvLyBOdWxsIGVsZW1lbnRzIHRvIGF2b2lkIGxlYWtzIGluIElFCgkJY29udGFpbmVyID0gZGl2ID0gdGRzID0gbWFyZ2luRGl2ID0gbnVsbDsKCX0pOwoKCS8vIE51bGwgZWxlbWVudHMgdG8gYXZvaWQgbGVha3MgaW4gSUUKCWFsbCA9IHNlbGVjdCA9IGZyYWdtZW50ID0gb3B0ID0gYSA9IGlucHV0ID0gbnVsbDsKCglyZXR1cm4gc3VwcG9ydDsKfSkoKTsKCnZhciByYnJhY2UgPSAvKD86XHtbXHNcU10qXH18XFtbXHNcU10qXF0pJC8sCglybXVsdGlEYXNoID0gLyhbQS1aXSkvZzsKCmZ1bmN0aW9uIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSwgcHZ0IC8qIEludGVybmFsIFVzZSBPbmx5ICovICl7CglpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCXJldHVybjsKCX0KCgl2YXIgdGhpc0NhY2hlLCByZXQsCgkJaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbywKCQlnZXRCeU5hbWUgPSB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIsCgoJCS8vIFdlIGhhdmUgdG8gaGFuZGxlIERPTSBub2RlcyBhbmQgSlMgb2JqZWN0cyBkaWZmZXJlbnRseSBiZWNhdXNlIElFNi03CgkJLy8gY2FuJ3QgR0Mgb2JqZWN0IHJlZmVyZW5jZXMgcHJvcGVybHkgYWNyb3NzIHRoZSBET00tSlMgYm91bmRhcnkKCQlpc05vZGUgPSBlbGVtLm5vZGVUeXBlLAoKCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIHRoZSBnbG9iYWwgalF1ZXJ5IGNhY2hlOyBKUyBvYmplY3QgZGF0YSBpcwoJCS8vIGF0dGFjaGVkIGRpcmVjdGx5IHRvIHRoZSBvYmplY3Qgc28gR0MgY2FuIG9jY3VyIGF1dG9tYXRpY2FsbHkKCQljYWNoZSA9IGlzTm9kZSA/IGpRdWVyeS5jYWNoZSA6IGVsZW0sCgoJCS8vIE9ubHkgZGVmaW5pbmcgYW4gSUQgZm9yIEpTIG9iamVjdHMgaWYgaXRzIGNhY2hlIGFscmVhZHkgZXhpc3RzIGFsbG93cwoJCS8vIHRoZSBjb2RlIHRvIHNob3J0Y3V0IG9uIHRoZSBzYW1lIHBhdGggYXMgYSBET00gbm9kZSB3aXRoIG5vIGNhY2hlCgkJaWQgPSBpc05vZGUgPyBlbGVtWyBpbnRlcm5hbEtleSBdIDogZWxlbVsgaW50ZXJuYWxLZXkgXSAmJiBpbnRlcm5hbEtleTsKCgkvLyBBdm9pZCBkb2luZyBhbnkgbW9yZSB3b3JrIHRoYW4gd2UgbmVlZCB0byB3aGVuIHRyeWluZyB0byBnZXQgZGF0YSBvbiBhbgoJLy8gb2JqZWN0IHRoYXQgaGFzIG5vIGRhdGEgYXQgYWxsCglpZiAoICghaWQgfHwgIWNhY2hlW2lkXSB8fCAoIXB2dCAmJiAhY2FjaGVbaWRdLmRhdGEpKSAmJiBnZXRCeU5hbWUgJiYgZGF0YSA9PT0gdW5kZWZpbmVkICkgewoJCXJldHVybjsKCX0KCglpZiAoICFpZCApIHsKCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIGEgbmV3IHVuaXF1ZSBJRCBmb3IgZWFjaCBlbGVtZW50IHNpbmNlIHRoZWlyIGRhdGEKCQkvLyBlbmRzIHVwIGluIHRoZSBnbG9iYWwgY2FjaGUKCQlpZiAoIGlzTm9kZSApIHsKCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IGlkID0gY29yZV9kZWxldGVkSWRzLnBvcCgpIHx8IGpRdWVyeS5ndWlkKys7CgkJfSBlbHNlIHsKCQkJaWQgPSBpbnRlcm5hbEtleTsKCQl9Cgl9CgoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgkJY2FjaGVbIGlkIF0gPSB7fTsKCgkJLy8gQXZvaWRzIGV4cG9zaW5nIGpRdWVyeSBtZXRhZGF0YSBvbiBwbGFpbiBKUyBvYmplY3RzIHdoZW4gdGhlIG9iamVjdAoJCS8vIGlzIHNlcmlhbGl6ZWQgdXNpbmcgSlNPTi5zdHJpbmdpZnkKCQlpZiAoICFpc05vZGUgKSB7CgkJCWNhY2hlWyBpZCBdLnRvSlNPTiA9IGpRdWVyeS5ub29wOwoJCX0KCX0KCgkvLyBBbiBvYmplY3QgY2FuIGJlIHBhc3NlZCB0byBqUXVlcnkuZGF0YSBpbnN0ZWFkIG9mIGEga2V5L3ZhbHVlIHBhaXI7IHRoaXMgZ2V0cwoJLy8gc2hhbGxvdyBjb3BpZWQgb3ZlciBvbnRvIHRoZSBleGlzdGluZyBjYWNoZQoJaWYgKCB0eXBlb2YgbmFtZSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIG5hbWUgPT09ICJmdW5jdGlvbiIgKSB7CgkJaWYgKCBwdnQgKSB7CgkJCWNhY2hlWyBpZCBdID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0sIG5hbWUgKTsKCQl9IGVsc2UgewoJCQljYWNoZVsgaWQgXS5kYXRhID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0uZGF0YSwgbmFtZSApOwoJCX0KCX0KCgl0aGlzQ2FjaGUgPSBjYWNoZVsgaWQgXTsKCgkvLyBqUXVlcnkgZGF0YSgpIGlzIHN0b3JlZCBpbiBhIHNlcGFyYXRlIG9iamVjdCBpbnNpZGUgdGhlIG9iamVjdCdzIGludGVybmFsIGRhdGEKCS8vIGNhY2hlIGluIG9yZGVyIHRvIGF2b2lkIGtleSBjb2xsaXNpb25zIGJldHdlZW4gaW50ZXJuYWwgZGF0YSBhbmQgdXNlci1kZWZpbmVkCgkvLyBkYXRhLgoJaWYgKCAhcHZ0ICkgewoJCWlmICggIXRoaXNDYWNoZS5kYXRhICkgewoJCQl0aGlzQ2FjaGUuZGF0YSA9IHt9OwoJCX0KCgkJdGhpc0NhY2hlID0gdGhpc0NhY2hlLmRhdGE7Cgl9CgoJaWYgKCBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJdGhpc0NhY2hlWyBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICkgXSA9IGRhdGE7Cgl9CgoJLy8gQ2hlY2sgZm9yIGJvdGggY29udmVydGVkLXRvLWNhbWVsIGFuZCBub24tY29udmVydGVkIGRhdGEgcHJvcGVydHkgbmFtZXMKCS8vIElmIGEgZGF0YSBwcm9wZXJ0eSB3YXMgc3BlY2lmaWVkCglpZiAoIGdldEJ5TmFtZSApIHsKCgkJLy8gRmlyc3QgVHJ5IHRvIGZpbmQgYXMtaXMgcHJvcGVydHkgZGF0YQoJCXJldCA9IHRoaXNDYWNoZVsgbmFtZSBdOwoKCQkvLyBUZXN0IGZvciBudWxsfHVuZGVmaW5lZCBwcm9wZXJ0eSBkYXRhCgkJaWYgKCByZXQgPT0gbnVsbCApIHsKCgkJCS8vIFRyeSB0byBmaW5kIHRoZSBjYW1lbENhc2VkIHByb3BlcnR5CgkJCXJldCA9IHRoaXNDYWNoZVsgalF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApIF07CgkJfQoJfSBlbHNlIHsKCQlyZXQgPSB0aGlzQ2FjaGU7Cgl9CgoJcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lLCBwdnQgKSB7CglpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCXJldHVybjsKCX0KCgl2YXIgaSwgbCwgdGhpc0NhY2hlLAoJCWlzTm9kZSA9IGVsZW0ubm9kZVR5cGUsCgoJCS8vIFNlZSBqUXVlcnkuZGF0YSBmb3IgbW9yZSBpbmZvcm1hdGlvbgoJCWNhY2hlID0gaXNOb2RlID8galF1ZXJ5LmNhY2hlIDogZWxlbSwKCQlpZCA9IGlzTm9kZSA/IGVsZW1bIGpRdWVyeS5leHBhbmRvIF0gOiBqUXVlcnkuZXhwYW5kbzsKCgkvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IG5vIGNhY2hlIGVudHJ5IGZvciB0aGlzIG9iamVjdCwgdGhlcmUgaXMgbm8KCS8vIHB1cnBvc2UgaW4gY29udGludWluZwoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgkJcmV0dXJuOwoJfQoKCWlmICggbmFtZSApIHsKCgkJdGhpc0NhY2hlID0gcHZ0ID8gY2FjaGVbIGlkIF0gOiBjYWNoZVsgaWQgXS5kYXRhOwoKCQlpZiAoIHRoaXNDYWNoZSApIHsKCgkJCS8vIFN1cHBvcnQgYXJyYXkgb3Igc3BhY2Ugc2VwYXJhdGVkIHN0cmluZyBuYW1lcyBmb3IgZGF0YSBrZXlzCgkJCWlmICggIWpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgoJCQkJLy8gdHJ5IHRoZSBzdHJpbmcgYXMgYSBrZXkgYmVmb3JlIGFueSBtYW5pcHVsYXRpb24KCQkJCWlmICggbmFtZSBpbiB0aGlzQ2FjaGUgKSB7CgkJCQkJbmFtZSA9IFsgbmFtZSBdOwoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gc3BsaXQgdGhlIGNhbWVsIGNhc2VkIHZlcnNpb24gYnkgc3BhY2VzIHVubGVzcyBhIGtleSB3aXRoIHRoZSBzcGFjZXMgZXhpc3RzCgkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCQkJCQlpZiAoIG5hbWUgaW4gdGhpc0NhY2hlICkgewoJCQkJCQluYW1lID0gWyBuYW1lIF07CgkJCQkJfSBlbHNlIHsKCQkJCQkJbmFtZSA9IG5hbWUuc3BsaXQoIiAiKTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQkvLyBJZiAibmFtZSIgaXMgYW4gYXJyYXkgb2Yga2V5cy4uLgoJCQkJLy8gV2hlbiBkYXRhIGlzIGluaXRpYWxseSBjcmVhdGVkLCB2aWEgKCJrZXkiLCAidmFsIikgc2lnbmF0dXJlLAoJCQkJLy8ga2V5cyB3aWxsIGJlIGNvbnZlcnRlZCB0byBjYW1lbENhc2UuCgkJCQkvLyBTaW5jZSB0aGVyZSBpcyBubyB3YXkgdG8gdGVsbCBfaG93XyBhIGtleSB3YXMgYWRkZWQsIHJlbW92ZQoJCQkJLy8gYm90aCBwbGFpbiBrZXkgYW5kIGNhbWVsQ2FzZSBrZXkuICMxMjc4NgoJCQkJLy8gVGhpcyB3aWxsIG9ubHkgcGVuYWxpemUgdGhlIGFycmF5IGFyZ3VtZW50IHBhdGguCgkJCQluYW1lID0gbmFtZS5jb25jYXQoIGpRdWVyeS5tYXAoIG5hbWUsIGpRdWVyeS5jYW1lbENhc2UgKSApOwoJCQl9CgoJCQlmb3IgKCBpID0gMCwgbCA9IG5hbWUubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJZGVsZXRlIHRoaXNDYWNoZVsgbmFtZVtpXSBdOwoJCQl9CgoJCQkvLyBJZiB0aGVyZSBpcyBubyBkYXRhIGxlZnQgaW4gdGhlIGNhY2hlLCB3ZSB3YW50IHRvIGNvbnRpbnVlCgkJCS8vIGFuZCBsZXQgdGhlIGNhY2hlIG9iamVjdCBpdHNlbGYgZ2V0IGRlc3Ryb3llZAoJCQlpZiAoICEoIHB2dCA/IGlzRW1wdHlEYXRhT2JqZWN0IDogalF1ZXJ5LmlzRW1wdHlPYmplY3QgKSggdGhpc0NhY2hlICkgKSB7CgkJCQlyZXR1cm47CgkJCX0KCQl9Cgl9CgoJLy8gU2VlIGpRdWVyeS5kYXRhIGZvciBtb3JlIGluZm9ybWF0aW9uCglpZiAoICFwdnQgKSB7CgkJZGVsZXRlIGNhY2hlWyBpZCBdLmRhdGE7CgoJCS8vIERvbid0IGRlc3Ryb3kgdGhlIHBhcmVudCBjYWNoZSB1bmxlc3MgdGhlIGludGVybmFsIGRhdGEgb2JqZWN0CgkJLy8gaGFkIGJlZW4gdGhlIG9ubHkgdGhpbmcgbGVmdCBpbiBpdAoJCWlmICggIWlzRW1wdHlEYXRhT2JqZWN0KCBjYWNoZVsgaWQgXSApICkgewoJCQlyZXR1cm47CgkJfQoJfQoKCS8vIERlc3Ryb3kgdGhlIGNhY2hlCglpZiAoIGlzTm9kZSApIHsKCQlqUXVlcnkuY2xlYW5EYXRhKCBbIGVsZW0gXSwgdHJ1ZSApOwoKCS8vIFVzZSBkZWxldGUgd2hlbiBzdXBwb3J0ZWQgZm9yIGV4cGFuZG9zIG9yIGBjYWNoZWAgaXMgbm90IGEgd2luZG93IHBlciBpc1dpbmRvdyAoIzEwMDgwKQoJfSBlbHNlIGlmICggalF1ZXJ5LnN1cHBvcnQuZGVsZXRlRXhwYW5kbyB8fCBjYWNoZSAhPSBjYWNoZS53aW5kb3cgKSB7CgkJZGVsZXRlIGNhY2hlWyBpZCBdOwoKCS8vIFdoZW4gYWxsIGVsc2UgZmFpbHMsIG51bGwKCX0gZWxzZSB7CgkJY2FjaGVbIGlkIF0gPSBudWxsOwoJfQp9CgpqUXVlcnkuZXh0ZW5kKHsKCWNhY2hlOiB7fSwKCgkvLyBVbmlxdWUgZm9yIGVhY2ggY29weSBvZiBqUXVlcnkgb24gdGhlIHBhZ2UKCS8vIE5vbi1kaWdpdHMgcmVtb3ZlZCB0byBtYXRjaCByaW5saW5lalF1ZXJ5CglleHBhbmRvOiAialF1ZXJ5IiArICggY29yZV92ZXJzaW9uICsgTWF0aC5yYW5kb20oKSApLnJlcGxhY2UoIC9cRC9nLCAiIiApLAoKCS8vIFRoZSBmb2xsb3dpbmcgZWxlbWVudHMgdGhyb3cgdW5jYXRjaGFibGUgZXhjZXB0aW9ucyBpZiB5b3UKCS8vIGF0dGVtcHQgdG8gYWRkIGV4cGFuZG8gcHJvcGVydGllcyB0byB0aGVtLgoJbm9EYXRhOiB7CgkJImVtYmVkIjogdHJ1ZSwKCQkvLyBCYW4gYWxsIG9iamVjdHMgZXhjZXB0IGZvciBGbGFzaCAod2hpY2ggaGFuZGxlIGV4cGFuZG9zKQoJCSJvYmplY3QiOiAiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIiwKCQkiYXBwbGV0IjogdHJ1ZQoJfSwKCgloYXNEYXRhOiBmdW5jdGlvbiggZWxlbSApIHsKCQllbGVtID0gZWxlbS5ub2RlVHlwZSA/IGpRdWVyeS5jYWNoZVsgZWxlbVtqUXVlcnkuZXhwYW5kb10gXSA6IGVsZW1bIGpRdWVyeS5leHBhbmRvIF07CgkJcmV0dXJuICEhZWxlbSAmJiAhaXNFbXB0eURhdGFPYmplY3QoIGVsZW0gKTsKCX0sCgoJZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJcmV0dXJuIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSApOwoJfSwKCglyZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lICk7Cgl9LAoKCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCV9kYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZGF0YSApIHsKCQlyZXR1cm4gaW50ZXJuYWxEYXRhKCBlbGVtLCBuYW1lLCBkYXRhLCB0cnVlICk7Cgl9LAoKCV9yZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lLCB0cnVlICk7Cgl9LAoKCS8vIEEgbWV0aG9kIGZvciBkZXRlcm1pbmluZyBpZiBhIERPTSBub2RlIGNhbiBoYW5kbGUgdGhlIGRhdGEgZXhwYW5kbwoJYWNjZXB0RGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7CgkJLy8gRG8gbm90IHNldCBkYXRhIG9uIG5vbi1lbGVtZW50IGJlY2F1c2UgaXQgd2lsbCBub3QgYmUgY2xlYXJlZCAoIzgzMzUpLgoJCWlmICggZWxlbS5ub2RlVHlwZSAmJiBlbGVtLm5vZGVUeXBlICE9PSAxICYmIGVsZW0ubm9kZVR5cGUgIT09IDkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXZhciBub0RhdGEgPSBlbGVtLm5vZGVOYW1lICYmIGpRdWVyeS5ub0RhdGFbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkvLyBub2RlcyBhY2NlcHQgZGF0YSB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZDsgcmVqZWN0aW9uIGNhbiBiZSBjb25kaXRpb25hbAoJCXJldHVybiAhbm9EYXRhIHx8IG5vRGF0YSAhPT0gdHJ1ZSAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3NpZCIpID09PSBub0RhdGE7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglkYXRhOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgYXR0cnMsIG5hbWUsCgkJCWVsZW0gPSB0aGlzWzBdLAoJCQlpID0gMCwKCQkJZGF0YSA9IG51bGw7CgoJCS8vIEdldHMgYWxsIHZhbHVlcwoJCWlmICgga2V5ID09PSB1bmRlZmluZWQgKSB7CgkJCWlmICggdGhpcy5sZW5ndGggKSB7CgkJCQlkYXRhID0galF1ZXJ5LmRhdGEoIGVsZW0gKTsKCgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgInBhcnNlZEF0dHJzIiApICkgewoJCQkJCWF0dHJzID0gZWxlbS5hdHRyaWJ1dGVzOwoJCQkJCWZvciAoIDsgaSA8IGF0dHJzLmxlbmd0aDsgaSsrICkgewoJCQkJCQluYW1lID0gYXR0cnNbaV0ubmFtZTsKCgkJCQkJCWlmICggIW5hbWUuaW5kZXhPZiggImRhdGEtIiApICkgewoJCQkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUuc2xpY2UoNSkgKTsKCgkJCQkJCQlkYXRhQXR0ciggZWxlbSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJalF1ZXJ5Ll9kYXRhKCBlbGVtLCAicGFyc2VkQXR0cnMiLCB0cnVlICk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiBkYXRhOwoJCX0KCgkJLy8gU2V0cyBtdWx0aXBsZSB2YWx1ZXMKCQlpZiAoIHR5cGVvZiBrZXkgPT09ICJvYmplY3QiICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRhdGEoIHRoaXMsIGtleSApOwoJCQl9KTsKCQl9CgoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgoJCQlpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCQkvLyBUcnkgdG8gZmV0Y2ggYW55IGludGVybmFsbHkgc3RvcmVkIGRhdGEgZmlyc3QKCQkJCXJldHVybiBlbGVtID8gZGF0YUF0dHIoIGVsZW0sIGtleSwgalF1ZXJ5LmRhdGEoIGVsZW0sIGtleSApICkgOiBudWxsOwoJCQl9CgoJCQl0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZGF0YSggdGhpcywga2V5LCB2YWx1ZSApOwoJCQl9KTsKCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsIHRydWUgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkucmVtb3ZlRGF0YSggdGhpcywga2V5ICk7CgkJfSk7Cgl9Cn0pOwoKZnVuY3Rpb24gZGF0YUF0dHIoIGVsZW0sIGtleSwgZGF0YSApIHsKCS8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKCS8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQoJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCgkJdmFyIG5hbWUgPSAiZGF0YS0iICsga2V5LnJlcGxhY2UoIHJtdWx0aURhc2gsICItJDEiICkudG9Mb3dlckNhc2UoKTsKCgkJZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQl0cnkgewoJCQkJZGF0YSA9IGRhdGEgPT09ICJ0cnVlIiA/IHRydWUgOgoJCQkJCWRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6CgkJCQkJZGF0YSA9PT0gIm51bGwiID8gbnVsbCA6CgkJCQkJLy8gT25seSBjb252ZXJ0IHRvIGEgbnVtYmVyIGlmIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSBzdHJpbmcKCQkJCQkrZGF0YSArICIiID09PSBkYXRhID8gK2RhdGEgOgoJCQkJCXJicmFjZS50ZXN0KCBkYXRhICkgPyBqUXVlcnkucGFyc2VKU09OKCBkYXRhICkgOgoJCQkJCQlkYXRhOwoJCQl9IGNhdGNoKCBlICkge30KCgkJCS8vIE1ha2Ugc3VyZSB3ZSBzZXQgdGhlIGRhdGEgc28gaXQgaXNuJ3QgY2hhbmdlZCBsYXRlcgoJCQlqUXVlcnkuZGF0YSggZWxlbSwga2V5LCBkYXRhICk7CgoJCX0gZWxzZSB7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoJfQoKCXJldHVybiBkYXRhOwp9CgovLyBjaGVja3MgYSBjYWNoZSBvYmplY3QgZm9yIGVtcHRpbmVzcwpmdW5jdGlvbiBpc0VtcHR5RGF0YU9iamVjdCggb2JqICkgewoJdmFyIG5hbWU7Cglmb3IgKCBuYW1lIGluIG9iaiApIHsKCgkJLy8gaWYgdGhlIHB1YmxpYyBkYXRhIG9iamVjdCBpcyBlbXB0eSwgdGhlIHByaXZhdGUgaXMgc3RpbGwgZW1wdHkKCQlpZiAoIG5hbWUgPT09ICJkYXRhIiAmJiBqUXVlcnkuaXNFbXB0eU9iamVjdCggb2JqW25hbWVdICkgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlpZiAoIG5hbWUgIT09ICJ0b0pTT04iICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCXJldHVybiB0cnVlOwp9CmpRdWVyeS5leHRlbmQoewoJcXVldWU6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBkYXRhICkgewoJCXZhciBxdWV1ZTsKCgkJaWYgKCBlbGVtICkgewoJCQl0eXBlID0gKCB0eXBlIHx8ICJmeCIgKSArICJxdWV1ZSI7CgkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlICk7CgoJCQkvLyBTcGVlZCB1cCBkZXF1ZXVlIGJ5IGdldHRpbmcgb3V0IHF1aWNrbHkgaWYgdGhpcyBpcyBqdXN0IGEgbG9va3VwCgkJCWlmICggZGF0YSApIHsKCQkJCWlmICggIXF1ZXVlIHx8IGpRdWVyeS5pc0FycmF5KGRhdGEpICkgewoJCQkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KGRhdGEpICk7CgkJCQl9IGVsc2UgewoJCQkJCXF1ZXVlLnB1c2goIGRhdGEgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gcXVldWUgfHwgW107CgkJfQoJfSwKCglkZXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsKCQl0eXBlID0gdHlwZSB8fCAiZngiOwoKCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSwKCQkJc3RhcnRMZW5ndGggPSBxdWV1ZS5sZW5ndGgsCgkJCWZuID0gcXVldWUuc2hpZnQoKSwKCQkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sIHR5cGUgKSwKCQkJbmV4dCA9IGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRlcXVldWUoIGVsZW0sIHR5cGUgKTsKCQkJfTsKCgkJLy8gSWYgdGhlIGZ4IHF1ZXVlIGlzIGRlcXVldWVkLCBhbHdheXMgcmVtb3ZlIHRoZSBwcm9ncmVzcyBzZW50aW5lbAoJCWlmICggZm4gPT09ICJpbnByb2dyZXNzIiApIHsKCQkJZm4gPSBxdWV1ZS5zaGlmdCgpOwoJCQlzdGFydExlbmd0aC0tOwoJCX0KCgkJaG9va3MuY3VyID0gZm47CgkJaWYgKCBmbiApIHsKCgkJCS8vIEFkZCBhIHByb2dyZXNzIHNlbnRpbmVsIHRvIHByZXZlbnQgdGhlIGZ4IHF1ZXVlIGZyb20gYmVpbmcKCQkJLy8gYXV0b21hdGljYWxseSBkZXF1ZXVlZAoJCQlpZiAoIHR5cGUgPT09ICJmeCIgKSB7CgkJCQlxdWV1ZS51bnNoaWZ0KCAiaW5wcm9ncmVzcyIgKTsKCQkJfQoKCQkJLy8gY2xlYXIgdXAgdGhlIGxhc3QgcXVldWUgc3RvcCBmdW5jdGlvbgoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJZm4uY2FsbCggZWxlbSwgbmV4dCwgaG9va3MgKTsKCQl9CgoJCWlmICggIXN0YXJ0TGVuZ3RoICYmIGhvb2tzICkgewoJCQlob29rcy5lbXB0eS5maXJlKCk7CgkJfQoJfSwKCgkvLyBub3QgaW50ZW5kZWQgZm9yIHB1YmxpYyBjb25zdW1wdGlvbiAtIGdlbmVyYXRlcyBhIHF1ZXVlSG9va3Mgb2JqZWN0LCBvciByZXR1cm5zIHRoZSBjdXJyZW50IG9uZQoJX3F1ZXVlSG9va3M6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkgewoJCXZhciBrZXkgPSB0eXBlICsgInF1ZXVlSG9va3MiOwoJCXJldHVybiBqUXVlcnkuX2RhdGEoIGVsZW0sIGtleSApIHx8IGpRdWVyeS5fZGF0YSggZWxlbSwga2V5LCB7CgkJCWVtcHR5OiBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLmFkZChmdW5jdGlvbigpIHsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwgdHlwZSArICJxdWV1ZSIgKTsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwga2V5ICk7CgkJCX0pCgkJfSk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglxdWV1ZTogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJdmFyIHNldHRlciA9IDI7CgoJCWlmICggdHlwZW9mIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQlkYXRhID0gdHlwZTsKCQkJdHlwZSA9ICJmeCI7CgkJCXNldHRlci0tOwoJCX0KCgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoIDwgc2V0dGVyICkgewoJCQlyZXR1cm4galF1ZXJ5LnF1ZXVlKCB0aGlzWzBdLCB0eXBlICk7CgkJfQoKCQlyZXR1cm4gZGF0YSA9PT0gdW5kZWZpbmVkID8KCQkJdGhpcyA6CgkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBxdWV1ZSA9IGpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgZGF0YSApOwoKCQkJCS8vIGVuc3VyZSBhIGhvb2tzIGZvciB0aGlzIHF1ZXVlCgkJCQlqUXVlcnkuX3F1ZXVlSG9va3MoIHRoaXMsIHR5cGUgKTsKCgkJCQlpZiAoIHR5cGUgPT09ICJmeCIgJiYgcXVldWVbMF0gIT09ICJpbnByb2dyZXNzIiApIHsKCQkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQkJfQoJCQl9KTsKCX0sCglkZXF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCX0pOwoJfSwKCS8vIEJhc2VkIG9mZiBvZiB0aGUgcGx1Z2luIGJ5IENsaW50IEhlbGZlcnMsIHdpdGggcGVybWlzc2lvbi4KCS8vIGh0dHA6Ly9ibGluZHNpZ25hbHMuY29tL2luZGV4LnBocC8yMDA5LzA3L2pxdWVyeS1kZWxheS8KCWRlbGF5OiBmdW5jdGlvbiggdGltZSwgdHlwZSApIHsKCQl0aW1lID0galF1ZXJ5LmZ4ID8galF1ZXJ5LmZ4LnNwZWVkc1sgdGltZSBdIHx8IHRpbWUgOiB0aW1lOwoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7CgkJCXZhciB0aW1lb3V0ID0gc2V0VGltZW91dCggbmV4dCwgdGltZSApOwoJCQlob29rcy5zdG9wID0gZnVuY3Rpb24oKSB7CgkJCQljbGVhclRpbWVvdXQoIHRpbWVvdXQgKTsKCQkJfTsKCQl9KTsKCX0sCgljbGVhclF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJfSwKCS8vIEdldCBhIHByb21pc2UgcmVzb2x2ZWQgd2hlbiBxdWV1ZXMgb2YgYSBjZXJ0YWluIHR5cGUKCS8vIGFyZSBlbXB0aWVkIChmeCBpcyB0aGUgdHlwZSBieSBkZWZhdWx0KQoJcHJvbWlzZTogZnVuY3Rpb24oIHR5cGUsIG9iaiApIHsKCQl2YXIgdG1wLAoJCQljb3VudCA9IDEsCgkJCWRlZmVyID0galF1ZXJ5LkRlZmVycmVkKCksCgkJCWVsZW1lbnRzID0gdGhpcywKCQkJaSA9IHRoaXMubGVuZ3RoLAoJCQlyZXNvbHZlID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoICEoIC0tY291bnQgKSApIHsKCQkJCQlkZWZlci5yZXNvbHZlV2l0aCggZWxlbWVudHMsIFsgZWxlbWVudHMgXSApOwoJCQkJfQoJCQl9OwoKCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJb2JqID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJdHlwZSA9IHR5cGUgfHwgImZ4IjsKCgkJd2hpbGUoIGktLSApIHsKCQkJdG1wID0galF1ZXJ5Ll9kYXRhKCBlbGVtZW50c1sgaSBdLCB0eXBlICsgInF1ZXVlSG9va3MiICk7CgkJCWlmICggdG1wICYmIHRtcC5lbXB0eSApIHsKCQkJCWNvdW50Kys7CgkJCQl0bXAuZW1wdHkuYWRkKCByZXNvbHZlICk7CgkJCX0KCQl9CgkJcmVzb2x2ZSgpOwoJCXJldHVybiBkZWZlci5wcm9taXNlKCBvYmogKTsKCX0KfSk7CnZhciBub2RlSG9vaywgYm9vbEhvb2ssCglyY2xhc3MgPSAvW1x0XHJcbl0vZywKCXJyZXR1cm4gPSAvXHIvZywKCXJmb2N1c2FibGUgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvaSwKCXJjbGlja2FibGUgPSAvXig/OmF8YXJlYSkkL2ksCglyYm9vbGVhbiA9IC9eKD86Y2hlY2tlZHxzZWxlY3RlZHxhdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQpJC9pLAoJcnVzZURlZmF1bHQgPSAvXig/OmNoZWNrZWR8c2VsZWN0ZWQpJC9pLAoJZ2V0U2V0QXR0cmlidXRlID0galF1ZXJ5LnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlLAoJZ2V0U2V0SW5wdXQgPSBqUXVlcnkuc3VwcG9ydC5pbnB1dDsKCmpRdWVyeS5mbi5leHRlbmQoewoJYXR0cjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBqUXVlcnkuYXR0ciwgbmFtZSwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxICk7Cgl9LAoKCXJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBuYW1lICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5yZW1vdmVBdHRyKCB0aGlzLCBuYW1lICk7CgkJfSk7Cgl9LAoKCXByb3A6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgalF1ZXJ5LnByb3AsIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOwoJfSwKCglyZW1vdmVQcm9wOiBmdW5jdGlvbiggbmFtZSApIHsKCQluYW1lID0galF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lOwoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCS8vIHRyeS9jYXRjaCBoYW5kbGVzIGNhc2VzIHdoZXJlIElFIGJhbGtzIChzdWNoIGFzIHJlbW92aW5nIGEgcHJvcGVydHkgb24gd2luZG93KQoJCQl0cnkgewoJCQkJdGhpc1sgbmFtZSBdID0gdW5kZWZpbmVkOwoJCQkJZGVsZXRlIHRoaXNbIG5hbWUgXTsKCQkJfSBjYXRjaCggZSApIHt9CgkJfSk7Cgl9LAoKCWFkZENsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzZXMsIGVsZW0sIGN1ciwgY2xhenosIGosCgkJCWkgPSAwLAoJCQlsZW4gPSB0aGlzLmxlbmd0aCwKCQkJcHJvY2VlZCA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgdmFsdWU7CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGogKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS5hZGRDbGFzcyggdmFsdWUuY2FsbCggdGhpcywgaiwgdGhpcy5jbGFzc05hbWUgKSApOwoJCQl9KTsKCQl9CgoJCWlmICggcHJvY2VlZCApIHsKCQkJLy8gVGhlIGRpc2p1bmN0aW9uIGhlcmUgaXMgZm9yIGJldHRlciBjb21wcmVzc2liaWxpdHkgKHNlZSByZW1vdmVDbGFzcykKCQkJY2xhc3NlcyA9ICggdmFsdWUgfHwgIiIgKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbXTsKCgkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJZWxlbSA9IHRoaXNbIGkgXTsKCQkJCWN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgKCBlbGVtLmNsYXNzTmFtZSA/CgkJCQkJKCAiICIgKyBlbGVtLmNsYXNzTmFtZSArICIgIiApLnJlcGxhY2UoIHJjbGFzcywgIiAiICkgOgoJCQkJCSIgIgoJCQkJKTsKCgkJCQlpZiAoIGN1ciApIHsKCQkJCQlqID0gMDsKCQkJCQl3aGlsZSAoIChjbGF6eiA9IGNsYXNzZXNbaisrXSkgKSB7CgkJCQkJCWlmICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPCAwICkgewoJCQkJCQkJY3VyICs9IGNsYXp6ICsgIiAiOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWVsZW0uY2xhc3NOYW1lID0galF1ZXJ5LnRyaW0oIGN1ciApOwoKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzZXMsIGVsZW0sIGN1ciwgY2xhenosIGosCgkJCWkgPSAwLAoJCQlsZW4gPSB0aGlzLmxlbmd0aCwKCQkJcHJvY2VlZCA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZTsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaiApIHsKCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZUNsYXNzKCB2YWx1ZS5jYWxsKCB0aGlzLCBqLCB0aGlzLmNsYXNzTmFtZSApICk7CgkJCX0pOwoJCX0KCQlpZiAoIHByb2NlZWQgKSB7CgkJCWNsYXNzZXMgPSAoIHZhbHVlIHx8ICIiICkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW107CgoJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWVsZW0gPSB0aGlzWyBpIF07CgkJCQkvLyBUaGlzIGV4cHJlc3Npb24gaXMgaGVyZSBmb3IgYmV0dGVyIGNvbXByZXNzaWJpbGl0eSAoc2VlIGFkZENsYXNzKQoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiIKCQkJCSk7CgoJCQkJaWYgKCBjdXIgKSB7CgkJCQkJaiA9IDA7CgkJCQkJd2hpbGUgKCAoY2xhenogPSBjbGFzc2VzW2orK10pICkgewoJCQkJCQkvLyBSZW1vdmUgKmFsbCogaW5zdGFuY2VzCgkJCQkJCXdoaWxlICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPj0gMCApIHsKCQkJCQkJCWN1ciA9IGN1ci5yZXBsYWNlKCAiICIgKyBjbGF6eiArICIgIiwgIiAiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxlbS5jbGFzc05hbWUgPSB2YWx1ZSA/IGpRdWVyeS50cmltKCBjdXIgKSA6ICIiOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJdG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSwgc3RhdGVWYWwgKSB7CgkJdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWUsCgkJCWlzQm9vbCA9IHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkudG9nZ2xlQ2xhc3MoIHZhbHVlLmNhbGwodGhpcywgaSwgdGhpcy5jbGFzc05hbWUsIHN0YXRlVmFsKSwgc3RhdGVWYWwgKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoIHR5cGUgPT09ICJzdHJpbmciICkgewoJCQkJLy8gdG9nZ2xlIGluZGl2aWR1YWwgY2xhc3MgbmFtZXMKCQkJCXZhciBjbGFzc05hbWUsCgkJCQkJaSA9IDAsCgkJCQkJc2VsZiA9IGpRdWVyeSggdGhpcyApLAoJCQkJCXN0YXRlID0gc3RhdGVWYWwsCgkJCQkJY2xhc3NOYW1lcyA9IHZhbHVlLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFtdOwoKCQkJCXdoaWxlICggKGNsYXNzTmFtZSA9IGNsYXNzTmFtZXNbIGkrKyBdKSApIHsKCQkJCQkvLyBjaGVjayBlYWNoIGNsYXNzTmFtZSBnaXZlbiwgc3BhY2Ugc2VwYXJhdGVkIGxpc3QKCQkJCQlzdGF0ZSA9IGlzQm9vbCA/IHN0YXRlIDogIXNlbGYuaGFzQ2xhc3MoIGNsYXNzTmFtZSApOwoJCQkJCXNlbGZbIHN0YXRlID8gImFkZENsYXNzIiA6ICJyZW1vdmVDbGFzcyIgXSggY2xhc3NOYW1lICk7CgkJCQl9CgoJCQkvLyBUb2dnbGUgd2hvbGUgY2xhc3MgbmFtZQoJCQl9IGVsc2UgaWYgKCB0eXBlID09PSBjb3JlX3N0cnVuZGVmaW5lZCB8fCB0eXBlID09PSAiYm9vbGVhbiIgKSB7CgkJCQlpZiAoIHRoaXMuY2xhc3NOYW1lICkgewoJCQkJCS8vIHN0b3JlIGNsYXNzTmFtZSBpZiBzZXQKCQkJCQlqUXVlcnkuX2RhdGEoIHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgdGhpcy5jbGFzc05hbWUgKTsKCQkJCX0KCgkJCQkvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBjbGFzcyBuYW1lIG9yIGlmIHdlJ3JlIHBhc3NlZCAiZmFsc2UiLAoJCQkJLy8gdGhlbiByZW1vdmUgdGhlIHdob2xlIGNsYXNzbmFtZSAoaWYgdGhlcmUgd2FzIG9uZSwgdGhlIGFib3ZlIHNhdmVkIGl0KS4KCQkJCS8vIE90aGVyd2lzZSBicmluZyBiYWNrIHdoYXRldmVyIHdhcyBwcmV2aW91c2x5IHNhdmVkIChpZiBhbnl0aGluZyksCgkJCQkvLyBmYWxsaW5nIGJhY2sgdG8gdGhlIGVtcHR5IHN0cmluZyBpZiBub3RoaW5nIHdhcyBzdG9yZWQuCgkJCQl0aGlzLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/ICIiIDogalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiX19jbGFzc05hbWVfXyIgKSB8fCAiIjsKCQkJfQoJCX0pOwoJfSwKCgloYXNDbGFzczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBjbGFzc05hbWUgPSAiICIgKyBzZWxlY3RvciArICIgIiwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aDsKCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCWlmICggdGhpc1tpXS5ub2RlVHlwZSA9PT0gMSAmJiAoIiAiICsgdGhpc1tpXS5jbGFzc05hbWUgKyAiICIpLnJlcGxhY2UocmNsYXNzLCAiICIpLmluZGV4T2YoIGNsYXNzTmFtZSApID49IDAgKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfSwKCgl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgcmV0LCBob29rcywgaXNGdW5jdGlvbiwKCQkJZWxlbSA9IHRoaXNbMF07CgoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCWlmICggZWxlbSApIHsKCQkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJcmV0ID0gZWxlbS52YWx1ZTsKCgkJCQlyZXR1cm4gdHlwZW9mIHJldCA9PT0gInN0cmluZyIgPwoJCQkJCS8vIGhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQlyZXQucmVwbGFjZShycmV0dXJuLCAiIikgOgoJCQkJCS8vIGhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlcgoJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHZhbCwKCQkJCXNlbGYgPSBqUXVlcnkodGhpcyk7CgoJCQlpZiAoIHRoaXMubm9kZVR5cGUgIT09IDEgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmICggaXNGdW5jdGlvbiApIHsKCQkJCXZhbCA9IHZhbHVlLmNhbGwoIHRoaXMsIGksIHNlbGYudmFsKCkgKTsKCQkJfSBlbHNlIHsKCQkJCXZhbCA9IHZhbHVlOwoJCQl9CgoJCQkvLyBUcmVhdCBudWxsL3VuZGVmaW5lZCBhcyAiIjsgY29udmVydCBudW1iZXJzIHRvIHN0cmluZwoJCQlpZiAoIHZhbCA9PSBudWxsICkgewoJCQkJdmFsID0gIiI7CgkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWwgPT09ICJudW1iZXIiICkgewoJCQkJdmFsICs9ICIiOwoJCQl9IGVsc2UgaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsICkgKSB7CgkJCQl2YWwgPSBqUXVlcnkubWFwKHZhbCwgZnVuY3Rpb24gKCB2YWx1ZSApIHsKCQkJCQlyZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWUgKyAiIjsKCQkJCX0pOwoJCQl9CgoJCQlob29rcyA9IGpRdWVyeS52YWxIb29rc1sgdGhpcy50eXBlIF0gfHwgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTsKCgkJCS8vIElmIHNldCByZXR1cm5zIHVuZGVmaW5lZCwgZmFsbCBiYWNrIHRvIG5vcm1hbCBzZXR0aW5nCgkJCWlmICggIWhvb2tzIHx8ICEoInNldCIgaW4gaG9va3MpIHx8IGhvb2tzLnNldCggdGhpcywgdmFsLCAidmFsdWUiICkgPT09IHVuZGVmaW5lZCApIHsKCQkJCXRoaXMudmFsdWUgPSB2YWw7CgkJCX0KCQl9KTsKCX0KfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCXZhbEhvb2tzOiB7CgkJb3B0aW9uOiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBhdHRyaWJ1dGVzLnZhbHVlIGlzIHVuZGVmaW5lZCBpbiBCbGFja2JlcnJ5IDQuNyBidXQKCQkJCS8vIHVzZXMgLnZhbHVlLiBTZWUgIzY5MzIKCQkJCXZhciB2YWwgPSBlbGVtLmF0dHJpYnV0ZXMudmFsdWU7CgkJCQlyZXR1cm4gIXZhbCB8fCB2YWwuc3BlY2lmaWVkID8gZWxlbS52YWx1ZSA6IGVsZW0udGV4dDsKCQkJfQoJCX0sCgkJc2VsZWN0OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgdmFsdWUsIG9wdGlvbiwKCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLAoJCQkJCWluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LAoJCQkJCW9uZSA9IGVsZW0udHlwZSA9PT0gInNlbGVjdC1vbmUiIHx8IGluZGV4IDwgMCwKCQkJCQl2YWx1ZXMgPSBvbmUgPyBudWxsIDogW10sCgkJCQkJbWF4ID0gb25lID8gaW5kZXggKyAxIDogb3B0aW9ucy5sZW5ndGgsCgkJCQkJaSA9IGluZGV4IDwgMCA/CgkJCQkJCW1heCA6CgkJCQkJCW9uZSA/IGluZGV4IDogMDsKCgkJCQkvLyBMb29wIHRocm91Z2ggYWxsIHRoZSBzZWxlY3RlZCBvcHRpb25zCgkJCQlmb3IgKCA7IGkgPCBtYXg7IGkrKyApIHsKCQkJCQlvcHRpb24gPSBvcHRpb25zWyBpIF07CgoJCQkJCS8vIG9sZElFIGRvZXNuJ3QgdXBkYXRlIHNlbGVjdGVkIGFmdGVyIGZvcm0gcmVzZXQgKCMyNTUxKQoJCQkJCWlmICggKCBvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXggKSAmJgoJCQkJCQkJLy8gRG9uJ3QgcmV0dXJuIG9wdGlvbnMgdGhhdCBhcmUgZGlzYWJsZWQgb3IgaW4gYSBkaXNhYmxlZCBvcHRncm91cAoJCQkJCQkJKCBqUXVlcnkuc3VwcG9ydC5vcHREaXNhYmxlZCA/ICFvcHRpb24uZGlzYWJsZWQgOiBvcHRpb24uZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpID09PSBudWxsICkgJiYKCQkJCQkJCSggIW9wdGlvbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFqUXVlcnkubm9kZU5hbWUoIG9wdGlvbi5wYXJlbnROb2RlLCAib3B0Z3JvdXAiICkgKSApIHsKCgkJCQkJCS8vIEdldCB0aGUgc3BlY2lmaWMgdmFsdWUgZm9yIHRoZSBvcHRpb24KCQkJCQkJdmFsdWUgPSBqUXVlcnkoIG9wdGlvbiApLnZhbCgpOwoKCQkJCQkJLy8gV2UgZG9uJ3QgbmVlZCBhbiBhcnJheSBmb3Igb25lIHNlbGVjdHMKCQkJCQkJaWYgKCBvbmUgKSB7CgkJCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQkJCX0KCgkJCQkJCS8vIE11bHRpLVNlbGVjdHMgcmV0dXJuIGFuIGFycmF5CgkJCQkJCXZhbHVlcy5wdXNoKCB2YWx1ZSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdmFsdWVzOwoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQl2YXIgdmFsdWVzID0galF1ZXJ5Lm1ha2VBcnJheSggdmFsdWUgKTsKCgkJCQlqUXVlcnkoZWxlbSkuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbigpIHsKCQkJCQl0aGlzLnNlbGVjdGVkID0galF1ZXJ5LmluQXJyYXkoIGpRdWVyeSh0aGlzKS52YWwoKSwgdmFsdWVzICkgPj0gMDsKCQkJCX0pOwoKCQkJCWlmICggIXZhbHVlcy5sZW5ndGggKSB7CgkJCQkJZWxlbS5zZWxlY3RlZEluZGV4ID0gLTE7CgkJCQl9CgkJCQlyZXR1cm4gdmFsdWVzOwoJCQl9CgkJfQoJfSwKCglhdHRyOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUgKSB7CgkJdmFyIGhvb2tzLCBub3R4bWwsIHJldCwKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBkb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSA9PT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCXJldHVybiBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSwgdmFsdWUgKTsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJLy8gQWxsIGF0dHJpYnV0ZXMgYXJlIGxvd2VyY2FzZQoJCS8vIEdyYWIgbmVjZXNzYXJ5IGhvb2sgaWYgb25lIGlzIGRlZmluZWQKCQlpZiAoIG5vdHhtbCApIHsKCQkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCQkJaG9va3MgPSBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gfHwgKCByYm9vbGVhbi50ZXN0KCBuYW1lICkgPyBib29sSG9vayA6IG5vZGVIb29rICk7CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIHZhbHVlID09PSBudWxsICkgewoJCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIGVsZW0sIG5hbWUgKTsKCgkJCX0gZWxzZSBpZiAoIGhvb2tzICYmIG5vdHhtbCAmJiAic2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHJldDsKCgkJCX0gZWxzZSB7CgkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgdmFsdWUgKyAiIiApOwoJCQkJcmV0dXJuIHZhbHVlOwoJCQl9CgoJCX0gZWxzZSBpZiAoIGhvb2tzICYmIG5vdHhtbCAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsICkgewoJCQlyZXR1cm4gcmV0OwoKCQl9IGVsc2UgewoKCQkJLy8gSW4gSUU5KywgRmxhc2ggb2JqZWN0cyBkb24ndCBoYXZlIC5nZXRBdHRyaWJ1dGUgKCMxMjk0NSkKCQkJLy8gU3VwcG9ydDogSUU5KwoJCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCQlyZXQgPSAgZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKTsKCQkJfQoKCQkJLy8gTm9uLWV4aXN0ZW50IGF0dHJpYnV0ZXMgcmV0dXJuIG51bGwsIHdlIG5vcm1hbGl6ZSB0byB1bmRlZmluZWQKCQkJcmV0dXJuIHJldCA9PSBudWxsID8KCQkJCXVuZGVmaW5lZCA6CgkJCQlyZXQ7CgkJfQoJfSwKCglyZW1vdmVBdHRyOiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJdmFyIG5hbWUsIHByb3BOYW1lLAoJCQlpID0gMCwKCQkJYXR0ck5hbWVzID0gdmFsdWUgJiYgdmFsdWUubWF0Y2goIGNvcmVfcm5vdHdoaXRlICk7CgoJCWlmICggYXR0ck5hbWVzICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCXdoaWxlICggKG5hbWUgPSBhdHRyTmFtZXNbaSsrXSkgKSB7CgkJCQlwcm9wTmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCgkJCQkvLyBCb29sZWFuIGF0dHJpYnV0ZXMgZ2V0IHNwZWNpYWwgdHJlYXRtZW50ICgjMTA4NzApCgkJCQlpZiAoIHJib29sZWFuLnRlc3QoIG5hbWUgKSApIHsKCQkJCQkvLyBTZXQgY29ycmVzcG9uZGluZyBwcm9wZXJ0eSB0byBmYWxzZSBmb3IgYm9vbGVhbiBhdHRyaWJ1dGVzCgkJCQkJLy8gQWxzbyBjbGVhciBkZWZhdWx0Q2hlY2tlZC9kZWZhdWx0U2VsZWN0ZWQgKGlmIGFwcHJvcHJpYXRlKSBmb3IgSUU8OAoJCQkJCWlmICggIWdldFNldEF0dHJpYnV0ZSAmJiBydXNlRGVmYXVsdC50ZXN0KCBuYW1lICkgKSB7CgkJCQkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9CgkJCQkJCQllbGVtWyBwcm9wTmFtZSBdID0gZmFsc2U7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZWxlbVsgcHJvcE5hbWUgXSA9IGZhbHNlOwoJCQkJCX0KCgkJCQkvLyBTZWUgIzk2OTkgZm9yIGV4cGxhbmF0aW9uIG9mIHRoaXMgYXBwcm9hY2ggKHNldHRpbmcgZmlyc3QsIHRoZW4gcmVtb3ZhbCkKCQkJCX0gZWxzZSB7CgkJCQkJalF1ZXJ5LmF0dHIoIGVsZW0sIG5hbWUsICIiICk7CgkJCQl9CgoJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGdldFNldEF0dHJpYnV0ZSA/IG5hbWUgOiBwcm9wTmFtZSApOwoJCQl9CgkJfQoJfSwKCglhdHRySG9va3M6IHsKCQl0eXBlOiB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQucmFkaW9WYWx1ZSAmJiB2YWx1ZSA9PT0gInJhZGlvIiAmJiBqUXVlcnkubm9kZU5hbWUoZWxlbSwgImlucHV0IikgKSB7CgkJCQkJLy8gU2V0dGluZyB0aGUgdHlwZSBvbiBhIHJhZGlvIGJ1dHRvbiBhZnRlciB0aGUgdmFsdWUgcmVzZXRzIHRoZSB2YWx1ZSBpbiBJRTYtOQoJCQkJCS8vIFJlc2V0IHZhbHVlIHRvIGRlZmF1bHQgaW4gY2FzZSB0eXBlIGlzIHNldCBhZnRlciB2YWx1ZSBkdXJpbmcgY3JlYXRpb24KCQkJCQl2YXIgdmFsID0gZWxlbS52YWx1ZTsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggInR5cGUiLCB2YWx1ZSApOwoJCQkJCWlmICggdmFsICkgewoJCQkJCQllbGVtLnZhbHVlID0gdmFsOwoJCQkJCX0KCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCXByb3BGaXg6IHsKCQl0YWJpbmRleDogInRhYkluZGV4IiwKCQlyZWFkb25seTogInJlYWRPbmx5IiwKCQkiZm9yIjogImh0bWxGb3IiLAoJCSJjbGFzcyI6ICJjbGFzc05hbWUiLAoJCW1heGxlbmd0aDogIm1heExlbmd0aCIsCgkJY2VsbHNwYWNpbmc6ICJjZWxsU3BhY2luZyIsCgkJY2VsbHBhZGRpbmc6ICJjZWxsUGFkZGluZyIsCgkJcm93c3BhbjogInJvd1NwYW4iLAoJCWNvbHNwYW46ICJjb2xTcGFuIiwKCQl1c2VtYXA6ICJ1c2VNYXAiLAoJCWZyYW1lYm9yZGVyOiAiZnJhbWVCb3JkZXIiLAoJCWNvbnRlbnRlZGl0YWJsZTogImNvbnRlbnRFZGl0YWJsZSIKCX0sCgoJcHJvcDogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCXZhciByZXQsIGhvb2tzLCBub3R4bWwsCgkJCW5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJLy8gZG9uJ3QgZ2V0L3NldCBwcm9wZXJ0aWVzIG9uIHRleHQsIGNvbW1lbnQgYW5kIGF0dHJpYnV0ZSBub2RlcwoJCWlmICggIWVsZW0gfHwgblR5cGUgPT09IDMgfHwgblR5cGUgPT09IDggfHwgblR5cGUgPT09IDIgKSB7CgkJCXJldHVybjsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJaWYgKCBub3R4bWwgKSB7CgkJCS8vIEZpeCBuYW1lIGFuZCBhdHRhY2ggaG9va3MKCQkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQkJaG9va3MgPSBqUXVlcnkucHJvcEhvb2tzWyBuYW1lIF07CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCWlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgoJCQl9IGVsc2UgewoJCQkJcmV0dXJuICggZWxlbVsgbmFtZSBdID0gdmFsdWUgKTsKCQkJfQoKCQl9IGVsc2UgewoJCQlpZiAoIGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoIGVsZW0sIG5hbWUgKSkgIT09IG51bGwgKSB7CgkJCQlyZXR1cm4gcmV0OwoKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBlbGVtWyBuYW1lIF07CgkJCX0KCQl9Cgl9LAoKCXByb3BIb29rczogewoJCXRhYkluZGV4OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBlbGVtLnRhYkluZGV4IGRvZXNuJ3QgYWx3YXlzIHJldHVybiB0aGUgY29ycmVjdCB2YWx1ZSB3aGVuIGl0IGhhc24ndCBiZWVuIGV4cGxpY2l0bHkgc2V0CgkJCQkvLyBodHRwOi8vZmx1aWRwcm9qZWN0Lm9yZy9ibG9nLzIwMDgvMDEvMDkvZ2V0dGluZy1zZXR0aW5nLWFuZC1yZW1vdmluZy10YWJpbmRleC12YWx1ZXMtd2l0aC1qYXZhc2NyaXB0LwoJCQkJdmFyIGF0dHJpYnV0ZU5vZGUgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoInRhYmluZGV4Iik7CgoJCQkJcmV0dXJuIGF0dHJpYnV0ZU5vZGUgJiYgYXR0cmlidXRlTm9kZS5zcGVjaWZpZWQgPwoJCQkJCXBhcnNlSW50KCBhdHRyaWJ1dGVOb2RlLnZhbHVlLCAxMCApIDoKCQkJCQlyZm9jdXNhYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSB8fCByY2xpY2thYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSAmJiBlbGVtLmhyZWYgPwoJCQkJCQkwIDoKCQkJCQkJdW5kZWZpbmVkOwoJCQl9CgkJfQoJfQp9KTsKCi8vIEhvb2sgZm9yIGJvb2xlYW4gYXR0cmlidXRlcwpib29sSG9vayA9IHsKCWdldDogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJdmFyCgkJCS8vIFVzZSAucHJvcCB0byBkZXRlcm1pbmUgaWYgdGhpcyBhdHRyaWJ1dGUgaXMgdW5kZXJzdG9vZCBhcyBib29sZWFuCgkJCXByb3AgPSBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSApLAoKCQkJLy8gRmV0Y2ggaXQgYWNjb3JkaW5nbHkKCQkJYXR0ciA9IHR5cGVvZiBwcm9wID09PSAiYm9vbGVhbiIgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSwKCQkJZGV0YWlsID0gdHlwZW9mIHByb3AgPT09ICJib29sZWFuIiA/CgoJCQkJZ2V0U2V0SW5wdXQgJiYgZ2V0U2V0QXR0cmlidXRlID8KCQkJCQlhdHRyICE9IG51bGwgOgoJCQkJCS8vIG9sZElFIGZhYnJpY2F0ZXMgYW4gZW1wdHkgc3RyaW5nIGZvciBtaXNzaW5nIGJvb2xlYW4gYXR0cmlidXRlcwoJCQkJCS8vIGFuZCBjb25mbGF0ZXMgY2hlY2tlZC9zZWxlY3RlZCBpbnRvIGF0dHJvcGVydGllcwoJCQkJCXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSA/CgkJCQkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA6CgkJCQkJCSEhYXR0ciA6CgoJCQkJLy8gZmV0Y2ggYW4gYXR0cmlidXRlIG5vZGUgZm9yIHByb3BlcnRpZXMgbm90IHJlY29nbml6ZWQgYXMgYm9vbGVhbgoJCQkJZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7CgoJCXJldHVybiBkZXRhaWwgJiYgZGV0YWlsLnZhbHVlICE9PSBmYWxzZSA/CgkJCW5hbWUudG9Mb3dlckNhc2UoKSA6CgkJCXVuZGVmaW5lZDsKCX0sCglzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJLy8gUmVtb3ZlIGJvb2xlYW4gYXR0cmlidXRlcyB3aGVuIHNldCB0byBmYWxzZQoJCQlqUXVlcnkucmVtb3ZlQXR0ciggZWxlbSwgbmFtZSApOwoJCX0gZWxzZSBpZiAoIGdldFNldElucHV0ICYmIGdldFNldEF0dHJpYnV0ZSB8fCAhcnVzZURlZmF1bHQudGVzdCggbmFtZSApICkgewoJCQkvLyBJRTw4IG5lZWRzIHRoZSAqcHJvcGVydHkqIG5hbWUKCQkJZWxlbS5zZXRBdHRyaWJ1dGUoICFnZXRTZXRBdHRyaWJ1dGUgJiYgalF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lLCBuYW1lICk7CgoJCS8vIFVzZSBkZWZhdWx0Q2hlY2tlZCBhbmQgZGVmYXVsdFNlbGVjdGVkIGZvciBvbGRJRQoJCX0gZWxzZSB7CgkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9IGVsZW1bIG5hbWUgXSA9IHRydWU7CgkJfQoKCQlyZXR1cm4gbmFtZTsKCX0KfTsKCi8vIGZpeCBvbGRJRSB2YWx1ZSBhdHRyb3BlcnR5CmlmICggIWdldFNldElucHV0IHx8ICFnZXRTZXRBdHRyaWJ1dGUgKSB7CglqUXVlcnkuYXR0ckhvb2tzLnZhbHVlID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJCXZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKTsKCQkJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApID8KCgkJCQkvLyBJZ25vcmUgdGhlIHZhbHVlICpwcm9wZXJ0eSogYnkgdXNpbmcgZGVmYXVsdFZhbHVlCgkJCQllbGVtLmRlZmF1bHRWYWx1ZSA6CgoJCQkJcmV0ICYmIHJldC5zcGVjaWZpZWQgPyByZXQudmFsdWUgOiB1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSApIHsKCQkJCS8vIERvZXMgbm90IHJldHVybiBzbyB0aGF0IHNldEF0dHJpYnV0ZSBpcyBhbHNvIHVzZWQKCQkJCWVsZW0uZGVmYXVsdFZhbHVlID0gdmFsdWU7CgkJCX0gZWxzZSB7CgkJCQkvLyBVc2Ugbm9kZUhvb2sgaWYgZGVmaW5lZCAoIzE5NTQpOyBvdGhlcndpc2Ugc2V0QXR0cmlidXRlIGlzIGZpbmUKCQkJCXJldHVybiBub2RlSG9vayAmJiBub2RlSG9vay5zZXQoIGVsZW0sIHZhbHVlLCBuYW1lICk7CgkJCX0KCQl9Cgl9Owp9CgovLyBJRTYvNyBkbyBub3Qgc3VwcG9ydCBnZXR0aW5nL3NldHRpbmcgc29tZSBhdHRyaWJ1dGVzIHdpdGggZ2V0L3NldEF0dHJpYnV0ZQppZiAoICFnZXRTZXRBdHRyaWJ1dGUgKSB7CgoJLy8gVXNlIHRoaXMgZm9yIGFueSBhdHRyaWJ1dGUgaW4gSUU2LzcKCS8vIFRoaXMgZml4ZXMgYWxtb3N0IGV2ZXJ5IElFNi83IGlzc3VlCglub2RlSG9vayA9IGpRdWVyeS52YWxIb29rcy5idXR0b24gPSB7CgkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOwoJCQlyZXR1cm4gcmV0ICYmICggbmFtZSA9PT0gImlkIiB8fCBuYW1lID09PSAibmFtZSIgfHwgbmFtZSA9PT0gImNvb3JkcyIgPyByZXQudmFsdWUgIT09ICIiIDogcmV0LnNwZWNpZmllZCApID8KCQkJCXJldC52YWx1ZSA6CgkJCQl1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJLy8gU2V0IHRoZSBleGlzdGluZyBvciBjcmVhdGUgYSBuZXcgYXR0cmlidXRlIG5vZGUKCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOwoJCQlpZiAoICFyZXQgKSB7CgkJCQllbGVtLnNldEF0dHJpYnV0ZU5vZGUoCgkJCQkJKHJldCA9IGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoIG5hbWUgKSkKCQkJCSk7CgkJCX0KCgkJCXJldC52YWx1ZSA9IHZhbHVlICs9ICIiOwoKCQkJLy8gQnJlYWsgYXNzb2NpYXRpb24gd2l0aCBjbG9uZWQgZWxlbWVudHMgYnkgYWxzbyB1c2luZyBzZXRBdHRyaWJ1dGUgKCM5NjQ2KQoJCQlyZXR1cm4gbmFtZSA9PT0gInZhbHVlIiB8fCB2YWx1ZSA9PT0gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSA/CgkJCQl2YWx1ZSA6CgkJCQl1bmRlZmluZWQ7CgkJfQoJfTsKCgkvLyBTZXQgY29udGVudGVkaXRhYmxlIHRvIGZhbHNlIG9uIHJlbW92YWxzKCMxMDQyOSkKCS8vIFNldHRpbmcgdG8gZW1wdHkgc3RyaW5nIHRocm93cyBhbiBlcnJvciBhcyBhbiBpbnZhbGlkIHZhbHVlCglqUXVlcnkuYXR0ckhvb2tzLmNvbnRlbnRlZGl0YWJsZSA9IHsKCQlnZXQ6IG5vZGVIb29rLmdldCwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJbm9kZUhvb2suc2V0KCBlbGVtLCB2YWx1ZSA9PT0gIiIgPyBmYWxzZSA6IHZhbHVlLCBuYW1lICk7CgkJfQoJfTsKCgkvLyBTZXQgd2lkdGggYW5kIGhlaWdodCB0byBhdXRvIGluc3RlYWQgb2YgMCBvbiBlbXB0eSBzdHJpbmcoIEJ1ZyAjODE1MCApCgkvLyBUaGlzIGlzIGZvciByZW1vdmFscwoJalF1ZXJ5LmVhY2goWyAid2lkdGgiLCAiaGVpZ2h0IiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCQlqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0sIHsKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQlpZiAoIHZhbHVlID09PSAiIiApIHsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgImF1dG8iICk7CgkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJfQoJCQl9CgkJfSk7Cgl9KTsKfQoKCi8vIFNvbWUgYXR0cmlidXRlcyByZXF1aXJlIGEgc3BlY2lhbCBjYWxsIG9uIElFCi8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczUzNjQyOSUyOFZTLjg1JTI5LmFzcHgKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWQgKSB7CglqUXVlcnkuZWFjaChbICJocmVmIiwgInNyYyIsICJ3aWR0aCIsICJoZWlnaHQiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJCWpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSwgewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCAyICk7CgkJCQlyZXR1cm4gcmV0ID09IG51bGwgPyB1bmRlZmluZWQgOiByZXQ7CgkJCX0KCQl9KTsKCX0pOwoKCS8vIGhyZWYvc3JjIHByb3BlcnR5IHNob3VsZCBnZXQgdGhlIGZ1bGwgbm9ybWFsaXplZCBVUkwgKCMxMDI5OS8jMTI5MTUpCglqUXVlcnkuZWFjaChbICJocmVmIiwgInNyYyIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CgkJalF1ZXJ5LnByb3BIb29rc1sgbmFtZSBdID0gewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCA0ICk7CgkJCX0KCQl9OwoJfSk7Cn0KCmlmICggIWpRdWVyeS5zdXBwb3J0LnN0eWxlICkgewoJalF1ZXJ5LmF0dHJIb29rcy5zdHlsZSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBSZXR1cm4gdW5kZWZpbmVkIGluIHRoZSBjYXNlIG9mIGVtcHR5IHN0cmluZwoJCQkvLyBOb3RlOiBJRSB1cHBlcmNhc2VzIGNzcyBwcm9wZXJ0eSBuYW1lcywgYnV0IGlmIHdlIHdlcmUgdG8gLnRvTG93ZXJDYXNlKCkKCQkJLy8gLmNzc1RleHQsIHRoYXQgd291bGQgZGVzdHJveSBjYXNlIHNlbnN0aXRpdml0eSBpbiBVUkwncywgbGlrZSBpbiAiYmFja2dyb3VuZCIKCQkJcmV0dXJuIGVsZW0uc3R5bGUuY3NzVGV4dCB8fCB1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJcmV0dXJuICggZWxlbS5zdHlsZS5jc3NUZXh0ID0gdmFsdWUgKyAiIiApOwoJCX0KCX07Cn0KCi8vIFNhZmFyaSBtaXMtcmVwb3J0cyB0aGUgZGVmYXVsdCBzZWxlY3RlZCBwcm9wZXJ0eSBvZiBhbiBvcHRpb24KLy8gQWNjZXNzaW5nIHRoZSBwYXJlbnQncyBzZWxlY3RlZEluZGV4IHByb3BlcnR5IGZpeGVzIGl0CmlmICggIWpRdWVyeS5zdXBwb3J0Lm9wdFNlbGVjdGVkICkgewoJalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5wcm9wSG9va3Muc2VsZWN0ZWQsIHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoKCQkJaWYgKCBwYXJlbnQgKSB7CgkJCQlwYXJlbnQuc2VsZWN0ZWRJbmRleDsKCgkJCQkvLyBNYWtlIHN1cmUgdGhhdCBpdCBhbHNvIHdvcmtzIHdpdGggb3B0Z3JvdXBzLCBzZWUgIzU3MDEKCQkJCWlmICggcGFyZW50LnBhcmVudE5vZGUgKSB7CgkJCQkJcGFyZW50LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9Cgl9KTsKfQoKLy8gSUU2LzcgY2FsbCBlbmN0eXBlIGVuY29kaW5nCmlmICggIWpRdWVyeS5zdXBwb3J0LmVuY3R5cGUgKSB7CglqUXVlcnkucHJvcEZpeC5lbmN0eXBlID0gImVuY29kaW5nIjsKfQoKLy8gUmFkaW9zIGFuZCBjaGVja2JveGVzIGdldHRlci9zZXR0ZXIKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuY2hlY2tPbiApIHsKCWpRdWVyeS5lYWNoKFsgInJhZGlvIiwgImNoZWNrYm94IiBdLCBmdW5jdGlvbigpIHsKCQlqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCS8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBpbiBXZWJraXQgIiIgaXMgcmV0dXJuZWQgaW5zdGVhZCBvZiAib24iIGlmIGEgdmFsdWUgaXNuJ3Qgc3BlY2lmaWVkCgkJCQlyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoInZhbHVlIikgPT09IG51bGwgPyAib24iIDogZWxlbS52YWx1ZTsKCQkJfQoJCX07Cgl9KTsKfQpqUXVlcnkuZWFjaChbICJyYWRpbyIsICJjaGVja2JveCIgXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS52YWxIb29rc1sgdGhpcyBdLCB7CgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgkJCQlyZXR1cm4gKCBlbGVtLmNoZWNrZWQgPSBqUXVlcnkuaW5BcnJheSggalF1ZXJ5KGVsZW0pLnZhbCgpLCB2YWx1ZSApID49IDAgKTsKCQkJfQoJCX0KCX0pOwp9KTsKdmFyIHJmb3JtRWxlbXMgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYSkkL2ksCglya2V5RXZlbnQgPSAvXmtleS8sCglybW91c2VFdmVudCA9IC9eKD86bW91c2V8Y29udGV4dG1lbnUpfGNsaWNrLywKCXJmb2N1c01vcnBoID0gL14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLAoJcnR5cGVuYW1lc3BhY2UgPSAvXihbXi5dKikoPzpcLiguKyl8KSQvOwoKZnVuY3Rpb24gcmV0dXJuVHJ1ZSgpIHsKCXJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiByZXR1cm5GYWxzZSgpIHsKCXJldHVybiBmYWxzZTsKfQoKLyoKICogSGVscGVyIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgZXZlbnRzIC0tIG5vdCBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLgogKiBQcm9wcyB0byBEZWFuIEVkd2FyZHMnIGFkZEV2ZW50IGxpYnJhcnkgZm9yIG1hbnkgb2YgdGhlIGlkZWFzLgogKi8KalF1ZXJ5LmV2ZW50ID0gewoKCWdsb2JhbDoge30sCgoJYWRkOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIGRhdGEsIHNlbGVjdG9yICkgewoJCXZhciB0bXAsIGV2ZW50cywgdCwgaGFuZGxlT2JqSW4sCgkJCXNwZWNpYWwsIGV2ZW50SGFuZGxlLCBoYW5kbGVPYmosCgkJCWhhbmRsZXJzLCB0eXBlLCBuYW1lc3BhY2VzLCBvcmlnVHlwZSwKCQkJZWxlbURhdGEgPSBqUXVlcnkuX2RhdGEoIGVsZW0gKTsKCgkJLy8gRG9uJ3QgYXR0YWNoIGV2ZW50cyB0byBub0RhdGEgb3IgdGV4dC9jb21tZW50IG5vZGVzIChidXQgYWxsb3cgcGxhaW4gb2JqZWN0cykKCQlpZiAoICFlbGVtRGF0YSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gQ2FsbGVyIGNhbiBwYXNzIGluIGFuIG9iamVjdCBvZiBjdXN0b20gZGF0YSBpbiBsaWV1IG9mIHRoZSBoYW5kbGVyCgkJaWYgKCBoYW5kbGVyLmhhbmRsZXIgKSB7CgkJCWhhbmRsZU9iakluID0gaGFuZGxlcjsKCQkJaGFuZGxlciA9IGhhbmRsZU9iakluLmhhbmRsZXI7CgkJCXNlbGVjdG9yID0gaGFuZGxlT2JqSW4uc2VsZWN0b3I7CgkJfQoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0aGUgaGFuZGxlciBoYXMgYSB1bmlxdWUgSUQsIHVzZWQgdG8gZmluZC9yZW1vdmUgaXQgbGF0ZXIKCQlpZiAoICFoYW5kbGVyLmd1aWQgKSB7CgkJCWhhbmRsZXIuZ3VpZCA9IGpRdWVyeS5ndWlkKys7CgkJfQoKCQkvLyBJbml0IHRoZSBlbGVtZW50J3MgZXZlbnQgc3RydWN0dXJlIGFuZCBtYWluIGhhbmRsZXIsIGlmIHRoaXMgaXMgdGhlIGZpcnN0CgkJaWYgKCAhKGV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cykgKSB7CgkJCWV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cyA9IHt9OwoJCX0KCQlpZiAoICEoZXZlbnRIYW5kbGUgPSBlbGVtRGF0YS5oYW5kbGUpICkgewoJCQlldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSA9IGZ1bmN0aW9uKCBlICkgewoJCQkJLy8gRGlzY2FyZCB0aGUgc2Vjb25kIGV2ZW50IG9mIGEgalF1ZXJ5LmV2ZW50LnRyaWdnZXIoKSBhbmQKCQkJCS8vIHdoZW4gYW4gZXZlbnQgaXMgY2FsbGVkIGFmdGVyIGEgcGFnZSBoYXMgdW5sb2FkZWQKCQkJCXJldHVybiB0eXBlb2YgalF1ZXJ5ICE9PSBjb3JlX3N0cnVuZGVmaW5lZCAmJiAoIWUgfHwgalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCAhPT0gZS50eXBlKSA/CgkJCQkJalF1ZXJ5LmV2ZW50LmRpc3BhdGNoLmFwcGx5KCBldmVudEhhbmRsZS5lbGVtLCBhcmd1bWVudHMgKSA6CgkJCQkJdW5kZWZpbmVkOwoJCQl9OwoJCQkvLyBBZGQgZWxlbSBhcyBhIHByb3BlcnR5IG9mIHRoZSBoYW5kbGUgZm4gdG8gcHJldmVudCBhIG1lbW9yeSBsZWFrIHdpdGggSUUgbm9uLW5hdGl2ZSBldmVudHMKCQkJZXZlbnRIYW5kbGUuZWxlbSA9IGVsZW07CgkJfQoKCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCgkJLy8galF1ZXJ5KC4uLikuYmluZCgibW91c2VvdmVyIG1vdXNlb3V0IiwgZm4pOwoJCXR5cGVzID0gKCB0eXBlcyB8fCAiIiApLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFsiIl07CgkJdCA9IHR5cGVzLmxlbmd0aDsKCQl3aGlsZSAoIHQtLSApIHsKCQkJdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTsKCQkJdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOwoJCQluYW1lc3BhY2VzID0gKCB0bXBbMl0gfHwgIiIgKS5zcGxpdCggIi4iICkuc29ydCgpOwoKCQkJLy8gSWYgZXZlbnQgY2hhbmdlcyBpdHMgdHlwZSwgdXNlIHRoZSBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgY2hhbmdlZCB0eXBlCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoKCQkJLy8gSWYgc2VsZWN0b3IgZGVmaW5lZCwgZGV0ZXJtaW5lIHNwZWNpYWwgZXZlbnQgYXBpIHR5cGUsIG90aGVyd2lzZSBnaXZlbiB0eXBlCgkJCXR5cGUgPSAoIHNlbGVjdG9yID8gc3BlY2lhbC5kZWxlZ2F0ZVR5cGUgOiBzcGVjaWFsLmJpbmRUeXBlICkgfHwgdHlwZTsKCgkJCS8vIFVwZGF0ZSBzcGVjaWFsIGJhc2VkIG9uIG5ld2x5IHJlc2V0IHR5cGUKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkvLyBoYW5kbGVPYmogaXMgcGFzc2VkIHRvIGFsbCBldmVudCBoYW5kbGVycwoJCQloYW5kbGVPYmogPSBqUXVlcnkuZXh0ZW5kKHsKCQkJCXR5cGU6IHR5cGUsCgkJCQlvcmlnVHlwZTogb3JpZ1R5cGUsCgkJCQlkYXRhOiBkYXRhLAoJCQkJaGFuZGxlcjogaGFuZGxlciwKCQkJCWd1aWQ6IGhhbmRsZXIuZ3VpZCwKCQkJCXNlbGVjdG9yOiBzZWxlY3RvciwKCQkJCW5lZWRzQ29udGV4dDogc2VsZWN0b3IgJiYgalF1ZXJ5LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3QoIHNlbGVjdG9yICksCgkJCQluYW1lc3BhY2U6IG5hbWVzcGFjZXMuam9pbigiLiIpCgkJCX0sIGhhbmRsZU9iakluICk7CgoJCQkvLyBJbml0IHRoZSBldmVudCBoYW5kbGVyIHF1ZXVlIGlmIHdlJ3JlIHRoZSBmaXJzdAoJCQlpZiAoICEoaGFuZGxlcnMgPSBldmVudHNbIHR5cGUgXSkgKSB7CgkJCQloYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdID0gW107CgkJCQloYW5kbGVycy5kZWxlZ2F0ZUNvdW50ID0gMDsKCgkJCQkvLyBPbmx5IHVzZSBhZGRFdmVudExpc3RlbmVyL2F0dGFjaEV2ZW50IGlmIHRoZSBzcGVjaWFsIGV2ZW50cyBoYW5kbGVyIHJldHVybnMgZmFsc2UKCQkJCWlmICggIXNwZWNpYWwuc2V0dXAgfHwgc3BlY2lhbC5zZXR1cC5jYWxsKCBlbGVtLCBkYXRhLCBuYW1lc3BhY2VzLCBldmVudEhhbmRsZSApID09PSBmYWxzZSApIHsKCQkJCQkvLyBCaW5kIHRoZSBnbG9iYWwgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAoJCQkJCWlmICggZWxlbS5hZGRFdmVudExpc3RlbmVyICkgewoJCQkJCQllbGVtLmFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGV2ZW50SGFuZGxlLCBmYWxzZSApOwoKCQkJCQl9IGVsc2UgaWYgKCBlbGVtLmF0dGFjaEV2ZW50ICkgewoJCQkJCQllbGVtLmF0dGFjaEV2ZW50KCAib24iICsgdHlwZSwgZXZlbnRIYW5kbGUgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWlmICggc3BlY2lhbC5hZGQgKSB7CgkJCQlzcGVjaWFsLmFkZC5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsKCgkJCQlpZiAoICFoYW5kbGVPYmouaGFuZGxlci5ndWlkICkgewoJCQkJCWhhbmRsZU9iai5oYW5kbGVyLmd1aWQgPSBoYW5kbGVyLmd1aWQ7CgkJCQl9CgkJCX0KCgkJCS8vIEFkZCB0byB0aGUgZWxlbWVudCdzIGhhbmRsZXIgbGlzdCwgZGVsZWdhdGVzIGluIGZyb250CgkJCWlmICggc2VsZWN0b3IgKSB7CgkJCQloYW5kbGVycy5zcGxpY2UoIGhhbmRsZXJzLmRlbGVnYXRlQ291bnQrKywgMCwgaGFuZGxlT2JqICk7CgkJCX0gZWxzZSB7CgkJCQloYW5kbGVycy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJfQoKCQkJLy8gS2VlcCB0cmFjayBvZiB3aGljaCBldmVudHMgaGF2ZSBldmVyIGJlZW4gdXNlZCwgZm9yIGV2ZW50IG9wdGltaXphdGlvbgoJCQlqUXVlcnkuZXZlbnQuZ2xvYmFsWyB0eXBlIF0gPSB0cnVlOwoJCX0KCgkJLy8gTnVsbGlmeSBlbGVtIHRvIHByZXZlbnQgbWVtb3J5IGxlYWtzIGluIElFCgkJZWxlbSA9IG51bGw7Cgl9LAoKCS8vIERldGFjaCBhbiBldmVudCBvciBzZXQgb2YgZXZlbnRzIGZyb20gYW4gZWxlbWVudAoJcmVtb3ZlOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIHNlbGVjdG9yLCBtYXBwZWRUeXBlcyApIHsKCQl2YXIgaiwgaGFuZGxlT2JqLCB0bXAsCgkJCW9yaWdDb3VudCwgdCwgZXZlbnRzLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwKCQkJbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0galF1ZXJ5Lmhhc0RhdGEoIGVsZW0gKSAmJiBqUXVlcnkuX2RhdGEoIGVsZW0gKTsKCgkJaWYgKCAhZWxlbURhdGEgfHwgIShldmVudHMgPSBlbGVtRGF0YS5ldmVudHMpICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBPbmNlIGZvciBlYWNoIHR5cGUubmFtZXNwYWNlIGluIHR5cGVzOyB0eXBlIG1heSBiZSBvbWl0dGVkCgkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgWyIiXTsKCQl0ID0gdHlwZXMubGVuZ3RoOwoJCXdoaWxlICggdC0tICkgewoJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1t0XSApIHx8IFtdOwoJCQl0eXBlID0gb3JpZ1R5cGUgPSB0bXBbMV07CgkJCW5hbWVzcGFjZXMgPSAoIHRtcFsyXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkvLyBVbmJpbmQgYWxsIGV2ZW50cyAob24gdGhpcyBuYW1lc3BhY2UsIGlmIHByb3ZpZGVkKSBmb3IgdGhlIGVsZW1lbnQKCQkJaWYgKCAhdHlwZSApIHsKCQkJCWZvciAoIHR5cGUgaW4gZXZlbnRzICkgewoJCQkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIGVsZW0sIHR5cGUgKyB0eXBlc1sgdCBdLCBoYW5kbGVyLCBzZWxlY3RvciwgdHJ1ZSApOwoJCQkJfQoJCQkJY29udGludWU7CgkJCX0KCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoJCQl0eXBlID0gKCBzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSApIHx8IHR5cGU7CgkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gfHwgW107CgkJCXRtcCA9IHRtcFsyXSAmJiBuZXcgUmVnRXhwKCAiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIiApOwoKCQkJLy8gUmVtb3ZlIG1hdGNoaW5nIGV2ZW50cwoJCQlvcmlnQ291bnQgPSBqID0gaGFuZGxlcnMubGVuZ3RoOwoJCQl3aGlsZSAoIGotLSApIHsKCQkJCWhhbmRsZU9iaiA9IGhhbmRsZXJzWyBqIF07CgoJCQkJaWYgKCAoIG1hcHBlZFR5cGVzIHx8IG9yaWdUeXBlID09PSBoYW5kbGVPYmoub3JpZ1R5cGUgKSAmJgoJCQkJCSggIWhhbmRsZXIgfHwgaGFuZGxlci5ndWlkID09PSBoYW5kbGVPYmouZ3VpZCApICYmCgkJCQkJKCAhdG1wIHx8IHRtcC50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSAmJgoJCQkJCSggIXNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSBoYW5kbGVPYmouc2VsZWN0b3IgfHwgc2VsZWN0b3IgPT09ICIqKiIgJiYgaGFuZGxlT2JqLnNlbGVjdG9yICkgKSB7CgkJCQkJaGFuZGxlcnMuc3BsaWNlKCBqLCAxICk7CgoJCQkJCWlmICggaGFuZGxlT2JqLnNlbGVjdG9yICkgewoJCQkJCQloYW5kbGVycy5kZWxlZ2F0ZUNvdW50LS07CgkJCQkJfQoJCQkJCWlmICggc3BlY2lhbC5yZW1vdmUgKSB7CgkJCQkJCXNwZWNpYWwucmVtb3ZlLmNhbGwoIGVsZW0sIGhhbmRsZU9iaiApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gUmVtb3ZlIGdlbmVyaWMgZXZlbnQgaGFuZGxlciBpZiB3ZSByZW1vdmVkIHNvbWV0aGluZyBhbmQgbm8gbW9yZSBoYW5kbGVycyBleGlzdAoJCQkvLyAoYXZvaWRzIHBvdGVudGlhbCBmb3IgZW5kbGVzcyByZWN1cnNpb24gZHVyaW5nIHJlbW92YWwgb2Ygc3BlY2lhbCBldmVudCBoYW5kbGVycykKCQkJaWYgKCBvcmlnQ291bnQgJiYgIWhhbmRsZXJzLmxlbmd0aCApIHsKCQkJCWlmICggIXNwZWNpYWwudGVhcmRvd24gfHwgc3BlY2lhbC50ZWFyZG93bi5jYWxsKCBlbGVtLCBuYW1lc3BhY2VzLCBlbGVtRGF0YS5oYW5kbGUgKSA9PT0gZmFsc2UgKSB7CgkJCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBlbGVtLCB0eXBlLCBlbGVtRGF0YS5oYW5kbGUgKTsKCQkJCX0KCgkJCQlkZWxldGUgZXZlbnRzWyB0eXBlIF07CgkJCX0KCQl9CgoJCS8vIFJlbW92ZSB0aGUgZXhwYW5kbyBpZiBpdCdzIG5vIGxvbmdlciB1c2VkCgkJaWYgKCBqUXVlcnkuaXNFbXB0eU9iamVjdCggZXZlbnRzICkgKSB7CgkJCWRlbGV0ZSBlbGVtRGF0YS5oYW5kbGU7CgoJCQkvLyByZW1vdmVEYXRhIGFsc28gY2hlY2tzIGZvciBlbXB0aW5lc3MgYW5kIGNsZWFycyB0aGUgZXhwYW5kbyBpZiBlbXB0eQoJCQkvLyBzbyB1c2UgaXQgaW5zdGVhZCBvZiBkZWxldGUKCQkJalF1ZXJ5Ll9yZW1vdmVEYXRhKCBlbGVtLCAiZXZlbnRzIiApOwoJCX0KCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIGV2ZW50LCBkYXRhLCBlbGVtLCBvbmx5SGFuZGxlcnMgKSB7CgkJdmFyIGhhbmRsZSwgb250eXBlLCBjdXIsCgkJCWJ1YmJsZVR5cGUsIHNwZWNpYWwsIHRtcCwgaSwKCQkJZXZlbnRQYXRoID0gWyBlbGVtIHx8IGRvY3VtZW50IF0sCgkJCXR5cGUgPSBjb3JlX2hhc093bi5jYWxsKCBldmVudCwgInR5cGUiICkgPyBldmVudC50eXBlIDogZXZlbnQsCgkJCW5hbWVzcGFjZXMgPSBjb3JlX2hhc093bi5jYWxsKCBldmVudCwgIm5hbWVzcGFjZSIgKSA/IGV2ZW50Lm5hbWVzcGFjZS5zcGxpdCgiLiIpIDogW107CgoJCWN1ciA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKCQkvLyBEb24ndCBkbyBldmVudHMgb24gdGV4dCBhbmQgY29tbWVudCBub2RlcwoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBmb2N1cy9ibHVyIG1vcnBocyB0byBmb2N1c2luL291dDsgZW5zdXJlIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbSByaWdodCBub3cKCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdHlwZS5pbmRleE9mKCIuIikgPj0gMCApIHsKCQkJLy8gTmFtZXNwYWNlZCB0cmlnZ2VyOyBjcmVhdGUgYSByZWdleHAgdG8gbWF0Y2ggZXZlbnQgdHlwZSBpbiBoYW5kbGUoKQoJCQluYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwoJCQl0eXBlID0gbmFtZXNwYWNlcy5zaGlmdCgpOwoJCQluYW1lc3BhY2VzLnNvcnQoKTsKCQl9CgkJb250eXBlID0gdHlwZS5pbmRleE9mKCI6IikgPCAwICYmICJvbiIgKyB0eXBlOwoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYSBqUXVlcnkuRXZlbnQgb2JqZWN0LCBPYmplY3QsIG9yIGp1c3QgYW4gZXZlbnQgdHlwZSBzdHJpbmcKCQlldmVudCA9IGV2ZW50WyBqUXVlcnkuZXhwYW5kbyBdID8KCQkJZXZlbnQgOgoJCQluZXcgalF1ZXJ5LkV2ZW50KCB0eXBlLCB0eXBlb2YgZXZlbnQgPT09ICJvYmplY3QiICYmIGV2ZW50ICk7CgoJCWV2ZW50LmlzVHJpZ2dlciA9IHRydWU7CgkJZXZlbnQubmFtZXNwYWNlID0gbmFtZXNwYWNlcy5qb2luKCIuIik7CgkJZXZlbnQubmFtZXNwYWNlX3JlID0gZXZlbnQubmFtZXNwYWNlID8KCQkJbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIgKSA6CgkJCW51bGw7CgoJCS8vIENsZWFuIHVwIHRoZSBldmVudCBpbiBjYXNlIGl0IGlzIGJlaW5nIHJldXNlZAoJCWV2ZW50LnJlc3VsdCA9IHVuZGVmaW5lZDsKCQlpZiAoICFldmVudC50YXJnZXQgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGVsZW07CgkJfQoKCQkvLyBDbG9uZSBhbnkgaW5jb21pbmcgZGF0YSBhbmQgcHJlcGVuZCB0aGUgZXZlbnQsIGNyZWF0aW5nIHRoZSBoYW5kbGVyIGFyZyBsaXN0CgkJZGF0YSA9IGRhdGEgPT0gbnVsbCA/CgkJCVsgZXZlbnQgXSA6CgkJCWpRdWVyeS5tYWtlQXJyYXkoIGRhdGEsIFsgZXZlbnQgXSApOwoKCQkvLyBBbGxvdyBzcGVjaWFsIGV2ZW50cyB0byBkcmF3IG91dHNpZGUgdGhlIGxpbmVzCgkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgkJaWYgKCAhb25seUhhbmRsZXJzICYmIHNwZWNpYWwudHJpZ2dlciAmJiBzcGVjaWFsLnRyaWdnZXIuYXBwbHkoIGVsZW0sIGRhdGEgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBldmVudCBwcm9wYWdhdGlvbiBwYXRoIGluIGFkdmFuY2UsIHBlciBXM0MgZXZlbnRzIHNwZWMgKCM5OTUxKQoJCS8vIEJ1YmJsZSB1cCB0byBkb2N1bWVudCwgdGhlbiB0byB3aW5kb3c7IHdhdGNoIGZvciBhIGdsb2JhbCBvd25lckRvY3VtZW50IHZhciAoIzk3MjQpCgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFzcGVjaWFsLm5vQnViYmxlICYmICFqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCgkJCWJ1YmJsZVR5cGUgPSBzcGVjaWFsLmRlbGVnYXRlVHlwZSB8fCB0eXBlOwoJCQlpZiAoICFyZm9jdXNNb3JwaC50ZXN0KCBidWJibGVUeXBlICsgdHlwZSApICkgewoJCQkJY3VyID0gY3VyLnBhcmVudE5vZGU7CgkJCX0KCQkJZm9yICggOyBjdXI7IGN1ciA9IGN1ci5wYXJlbnROb2RlICkgewoJCQkJZXZlbnRQYXRoLnB1c2goIGN1ciApOwoJCQkJdG1wID0gY3VyOwoJCQl9CgoJCQkvLyBPbmx5IGFkZCB3aW5kb3cgaWYgd2UgZ290IHRvIGRvY3VtZW50IChlLmcuLCBub3QgcGxhaW4gb2JqIG9yIGRldGFjaGVkIERPTSkKCQkJaWYgKCB0bXAgPT09IChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpICkgewoJCQkJZXZlbnRQYXRoLnB1c2goIHRtcC5kZWZhdWx0VmlldyB8fCB0bXAucGFyZW50V2luZG93IHx8IHdpbmRvdyApOwoJCQl9CgkJfQoKCQkvLyBGaXJlIGhhbmRsZXJzIG9uIHRoZSBldmVudCBwYXRoCgkJaSA9IDA7CgkJd2hpbGUgKCAoY3VyID0gZXZlbnRQYXRoW2krK10pICYmICFldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJZXZlbnQudHlwZSA9IGkgPiAxID8KCQkJCWJ1YmJsZVR5cGUgOgoJCQkJc3BlY2lhbC5iaW5kVHlwZSB8fCB0eXBlOwoKCQkJLy8galF1ZXJ5IGhhbmRsZXIKCQkJaGFuZGxlID0gKCBqUXVlcnkuX2RhdGEoIGN1ciwgImV2ZW50cyIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gJiYgalF1ZXJ5Ll9kYXRhKCBjdXIsICJoYW5kbGUiICk7CgkJCWlmICggaGFuZGxlICkgewoJCQkJaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKTsKCQkJfQoKCQkJLy8gTmF0aXZlIGhhbmRsZXIKCQkJaGFuZGxlID0gb250eXBlICYmIGN1clsgb250eXBlIF07CgkJCWlmICggaGFuZGxlICYmIGpRdWVyeS5hY2NlcHREYXRhKCBjdXIgKSAmJiBoYW5kbGUuYXBwbHkgJiYgaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKSA9PT0gZmFsc2UgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9CgkJfQoJCWV2ZW50LnR5cGUgPSB0eXBlOwoKCQkvLyBJZiBub2JvZHkgcHJldmVudGVkIHRoZSBkZWZhdWx0IGFjdGlvbiwgZG8gaXQgbm93CgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCgkJCWlmICggKCFzcGVjaWFsLl9kZWZhdWx0IHx8IHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoIGVsZW0ub3duZXJEb2N1bWVudCwgZGF0YSApID09PSBmYWxzZSkgJiYKCQkJCSEodHlwZSA9PT0gImNsaWNrIiAmJiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJhIiApKSAmJiBqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoKCQkJCS8vIENhbGwgYSBuYXRpdmUgRE9NIG1ldGhvZCBvbiB0aGUgdGFyZ2V0IHdpdGggdGhlIHNhbWUgbmFtZSBuYW1lIGFzIHRoZSBldmVudC4KCQkJCS8vIENhbid0IHVzZSBhbiAuaXNGdW5jdGlvbigpIGNoZWNrIGhlcmUgYmVjYXVzZSBJRTYvNyBmYWlscyB0aGF0IHRlc3QuCgkJCQkvLyBEb24ndCBkbyBkZWZhdWx0IGFjdGlvbnMgb24gd2luZG93LCB0aGF0J3Mgd2hlcmUgZ2xvYmFsIHZhcmlhYmxlcyBiZSAoIzYxNzApCgkJCQlpZiAoIG9udHlwZSAmJiBlbGVtWyB0eXBlIF0gJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJCQkvLyBEb24ndCByZS10cmlnZ2VyIGFuIG9uRk9PIGV2ZW50IHdoZW4gd2UgY2FsbCBpdHMgRk9PKCkgbWV0aG9kCgkJCQkJdG1wID0gZWxlbVsgb250eXBlIF07CgoJCQkJCWlmICggdG1wICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IG51bGw7CgkJCQkJfQoKCQkJCQkvLyBQcmV2ZW50IHJlLXRyaWdnZXJpbmcgb2YgdGhlIHNhbWUgZXZlbnQsIHNpbmNlIHdlIGFscmVhZHkgYnViYmxlZCBpdCBhYm92ZQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB0eXBlOwoJCQkJCXRyeSB7CgkJCQkJCWVsZW1bIHR5cGUgXSgpOwoJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkvLyBJRTw5IGRpZXMgb24gZm9jdXMvYmx1ciB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsIzEyNTE4KQoJCQkJCQkvLyBvbmx5IHJlcHJvZHVjaWJsZSBvbiB3aW5YUCBJRTggbmF0aXZlLCBub3QgSUU5IGluIElFOCBtb2RlCgkJCQkJfQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB1bmRlZmluZWQ7CgoJCQkJCWlmICggdG1wICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IHRtcDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWRpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCS8vIE1ha2UgYSB3cml0YWJsZSBqUXVlcnkuRXZlbnQgZnJvbSB0aGUgbmF0aXZlIGV2ZW50IG9iamVjdAoJCWV2ZW50ID0galF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKTsKCgkJdmFyIGksIHJldCwgaGFuZGxlT2JqLCBtYXRjaGVkLCBqLAoJCQloYW5kbGVyUXVldWUgPSBbXSwKCQkJYXJncyA9IGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzICksCgkJCWhhbmRsZXJzID0gKCBqUXVlcnkuX2RhdGEoIHRoaXMsICJldmVudHMiICkgfHwge30gKVsgZXZlbnQudHlwZSBdIHx8IFtdLAoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGV2ZW50LnR5cGUgXSB8fCB7fTsKCgkJLy8gVXNlIHRoZSBmaXgtZWQgalF1ZXJ5LkV2ZW50IHJhdGhlciB0aGFuIHRoZSAocmVhZC1vbmx5KSBuYXRpdmUgZXZlbnQKCQlhcmdzWzBdID0gZXZlbnQ7CgkJZXZlbnQuZGVsZWdhdGVUYXJnZXQgPSB0aGlzOwoKCQkvLyBDYWxsIHRoZSBwcmVEaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUsIGFuZCBsZXQgaXQgYmFpbCBpZiBkZXNpcmVkCgkJaWYgKCBzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBoYW5kbGVycwoJCWhhbmRsZXJRdWV1ZSA9IGpRdWVyeS5ldmVudC5oYW5kbGVycy5jYWxsKCB0aGlzLCBldmVudCwgaGFuZGxlcnMgKTsKCgkJLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXMKCQlpID0gMDsKCQl3aGlsZSAoIChtYXRjaGVkID0gaGFuZGxlclF1ZXVlWyBpKysgXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgkJCWV2ZW50LmN1cnJlbnRUYXJnZXQgPSBtYXRjaGVkLmVsZW07CgoJCQlqID0gMDsKCQkJd2hpbGUgKCAoaGFuZGxlT2JqID0gbWF0Y2hlZC5oYW5kbGVyc1sgaisrIF0pICYmICFldmVudC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJCS8vIFRyaWdnZXJlZCBldmVudCBtdXN0IGVpdGhlciAxKSBoYXZlIG5vIG5hbWVzcGFjZSwgb3IKCQkJCS8vIDIpIGhhdmUgbmFtZXNwYWNlKHMpIGEgc3Vic2V0IG9yIGVxdWFsIHRvIHRob3NlIGluIHRoZSBib3VuZCBldmVudCAoYm90aCBjYW4gaGF2ZSBubyBuYW1lc3BhY2UpLgoJCQkJaWYgKCAhZXZlbnQubmFtZXNwYWNlX3JlIHx8IGV2ZW50Lm5hbWVzcGFjZV9yZS50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSB7CgoJCQkJCWV2ZW50LmhhbmRsZU9iaiA9IGhhbmRsZU9iajsKCQkJCQlldmVudC5kYXRhID0gaGFuZGxlT2JqLmRhdGE7CgoJCQkJCXJldCA9ICggKGpRdWVyeS5ldmVudC5zcGVjaWFsWyBoYW5kbGVPYmoub3JpZ1R5cGUgXSB8fCB7fSkuaGFuZGxlIHx8IGhhbmRsZU9iai5oYW5kbGVyICkKCQkJCQkJCS5hcHBseSggbWF0Y2hlZC5lbGVtLCBhcmdzICk7CgoJCQkJCWlmICggcmV0ICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJCWlmICggKGV2ZW50LnJlc3VsdCA9IHJldCkgPT09IGZhbHNlICkgewoJCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsIHRoZSBwb3N0RGlzcGF0Y2ggaG9vayBmb3IgdGhlIG1hcHBlZCB0eXBlCgkJaWYgKCBzcGVjaWFsLnBvc3REaXNwYXRjaCApIHsKCQkJc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKTsKCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWhhbmRsZXJzOiBmdW5jdGlvbiggZXZlbnQsIGhhbmRsZXJzICkgewoJCXZhciBzZWwsIGhhbmRsZU9iaiwgbWF0Y2hlcywgaSwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWRlbGVnYXRlQ291bnQgPSBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LAoJCQljdXIgPSBldmVudC50YXJnZXQ7CgoJCS8vIEZpbmQgZGVsZWdhdGUgaGFuZGxlcnMKCQkvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAoIzEzMTgwKQoJCS8vIEF2b2lkIG5vbi1sZWZ0LWNsaWNrIGJ1YmJsaW5nIGluIEZpcmVmb3ggKCMzODYxKQoJCWlmICggZGVsZWdhdGVDb3VudCAmJiBjdXIubm9kZVR5cGUgJiYgKCFldmVudC5idXR0b24gfHwgZXZlbnQudHlwZSAhPT0gImNsaWNrIikgKSB7CgoJCQlmb3IgKCA7IGN1ciAhPSB0aGlzOyBjdXIgPSBjdXIucGFyZW50Tm9kZSB8fCB0aGlzICkgewoKCQkJCS8vIERvbid0IGNoZWNrIG5vbi1lbGVtZW50cyAoIzEzMjA4KQoJCQkJLy8gRG9uJ3QgcHJvY2VzcyBjbGlja3Mgb24gZGlzYWJsZWQgZWxlbWVudHMgKCM2OTExLCAjODE2NSwgIzExMzgyLCAjMTE3NjQpCgkJCQlpZiAoIGN1ci5ub2RlVHlwZSA9PT0gMSAmJiAoY3VyLmRpc2FibGVkICE9PSB0cnVlIHx8IGV2ZW50LnR5cGUgIT09ICJjbGljayIpICkgewoJCQkJCW1hdGNoZXMgPSBbXTsKCQkJCQlmb3IgKCBpID0gMDsgaSA8IGRlbGVnYXRlQ291bnQ7IGkrKyApIHsKCQkJCQkJaGFuZGxlT2JqID0gaGFuZGxlcnNbIGkgXTsKCgkJCQkJCS8vIERvbid0IGNvbmZsaWN0IHdpdGggT2JqZWN0LnByb3RvdHlwZSBwcm9wZXJ0aWVzICgjMTMyMDMpCgkJCQkJCXNlbCA9IGhhbmRsZU9iai5zZWxlY3RvciArICIgIjsKCgkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gPT09IHVuZGVmaW5lZCApIHsKCQkJCQkJCW1hdGNoZXNbIHNlbCBdID0gaGFuZGxlT2JqLm5lZWRzQ29udGV4dCA/CgkJCQkJCQkJalF1ZXJ5KCBzZWwsIHRoaXMgKS5pbmRleCggY3VyICkgPj0gMCA6CgkJCQkJCQkJalF1ZXJ5LmZpbmQoIHNlbCwgdGhpcywgbnVsbCwgWyBjdXIgXSApLmxlbmd0aDsKCQkJCQkJfQoJCQkJCQlpZiAoIG1hdGNoZXNbIHNlbCBdICkgewoJCQkJCQkJbWF0Y2hlcy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoIG1hdGNoZXMubGVuZ3RoICkgewoJCQkJCQloYW5kbGVyUXVldWUucHVzaCh7IGVsZW06IGN1ciwgaGFuZGxlcnM6IG1hdGNoZXMgfSk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBBZGQgdGhlIHJlbWFpbmluZyAoZGlyZWN0bHktYm91bmQpIGhhbmRsZXJzCgkJaWYgKCBkZWxlZ2F0ZUNvdW50IDwgaGFuZGxlcnMubGVuZ3RoICkgewoJCQloYW5kbGVyUXVldWUucHVzaCh7IGVsZW06IHRoaXMsIGhhbmRsZXJzOiBoYW5kbGVycy5zbGljZSggZGVsZWdhdGVDb3VudCApIH0pOwoJCX0KCgkJcmV0dXJuIGhhbmRsZXJRdWV1ZTsKCX0sCgoJZml4OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCgkJLy8gQ3JlYXRlIGEgd3JpdGFibGUgY29weSBvZiB0aGUgZXZlbnQgb2JqZWN0IGFuZCBub3JtYWxpemUgc29tZSBwcm9wZXJ0aWVzCgkJdmFyIGksIHByb3AsIGNvcHksCgkJCXR5cGUgPSBldmVudC50eXBlLAoJCQlvcmlnaW5hbEV2ZW50ID0gZXZlbnQsCgkJCWZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzWyB0eXBlIF07CgoJCWlmICggIWZpeEhvb2sgKSB7CgkJCXRoaXMuZml4SG9va3NbIHR5cGUgXSA9IGZpeEhvb2sgPQoJCQkJcm1vdXNlRXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5tb3VzZUhvb2tzIDoKCQkJCXJrZXlFdmVudC50ZXN0KCB0eXBlICkgPyB0aGlzLmtleUhvb2tzIDoKCQkJCXt9OwoJCX0KCQljb3B5ID0gZml4SG9vay5wcm9wcyA/IHRoaXMucHJvcHMuY29uY2F0KCBmaXhIb29rLnByb3BzICkgOiB0aGlzLnByb3BzOwoKCQlldmVudCA9IG5ldyBqUXVlcnkuRXZlbnQoIG9yaWdpbmFsRXZlbnQgKTsKCgkJaSA9IGNvcHkubGVuZ3RoOwoJCXdoaWxlICggaS0tICkgewoJCQlwcm9wID0gY29weVsgaSBdOwoJCQlldmVudFsgcHJvcCBdID0gb3JpZ2luYWxFdmVudFsgcHJvcCBdOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEZpeCB0YXJnZXQgcHJvcGVydHkgKCMxOTI1KQoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gb3JpZ2luYWxFdmVudC5zcmNFbGVtZW50IHx8IGRvY3VtZW50OwoJCX0KCgkJLy8gU3VwcG9ydDogQ2hyb21lIDIzKywgU2FmYXJpPwoJCS8vIFRhcmdldCBzaG91bGQgbm90IGJlIGEgdGV4dCBub2RlICgjNTA0LCAjMTMxNDMpCgkJaWYgKCBldmVudC50YXJnZXQubm9kZVR5cGUgPT09IDMgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEZvciBtb3VzZS9rZXkgZXZlbnRzLCBtZXRhS2V5PT1mYWxzZSBpZiBpdCdzIHVuZGVmaW5lZCAoIzMzNjgsICMxMTMyOCkKCQlldmVudC5tZXRhS2V5ID0gISFldmVudC5tZXRhS2V5OwoKCQlyZXR1cm4gZml4SG9vay5maWx0ZXIgPyBmaXhIb29rLmZpbHRlciggZXZlbnQsIG9yaWdpbmFsRXZlbnQgKSA6IGV2ZW50OwoJfSwKCgkvLyBJbmNsdWRlcyBzb21lIGV2ZW50IHByb3BzIHNoYXJlZCBieSBLZXlFdmVudCBhbmQgTW91c2VFdmVudAoJcHJvcHM6ICJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giLnNwbGl0KCIgIiksCgoJZml4SG9va3M6IHt9LAoKCWtleUhvb2tzOiB7CgkJcHJvcHM6ICJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCgiICIpLAoJCWZpbHRlcjogZnVuY3Rpb24oIGV2ZW50LCBvcmlnaW5hbCApIHsKCgkJCS8vIEFkZCB3aGljaCBmb3Iga2V5IGV2ZW50cwoJCQlpZiAoIGV2ZW50LndoaWNoID09IG51bGwgKSB7CgkJCQlldmVudC53aGljaCA9IG9yaWdpbmFsLmNoYXJDb2RlICE9IG51bGwgPyBvcmlnaW5hbC5jaGFyQ29kZSA6IG9yaWdpbmFsLmtleUNvZGU7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCW1vdXNlSG9va3M6IHsKCQlwcm9wczogImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBmcm9tRWxlbWVudCBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIuc3BsaXQoIiAiKSwKCQlmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7CgkJCXZhciBib2R5LCBldmVudERvYywgZG9jLAoJCQkJYnV0dG9uID0gb3JpZ2luYWwuYnV0dG9uLAoJCQkJZnJvbUVsZW1lbnQgPSBvcmlnaW5hbC5mcm9tRWxlbWVudDsKCgkJCS8vIENhbGN1bGF0ZSBwYWdlWC9ZIGlmIG1pc3NpbmcgYW5kIGNsaWVudFgvWSBhdmFpbGFibGUKCQkJaWYgKCBldmVudC5wYWdlWCA9PSBudWxsICYmIG9yaWdpbmFsLmNsaWVudFggIT0gbnVsbCApIHsKCQkJCWV2ZW50RG9jID0gZXZlbnQudGFyZ2V0Lm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQ7CgkJCQlkb2MgPSBldmVudERvYy5kb2N1bWVudEVsZW1lbnQ7CgkJCQlib2R5ID0gZXZlbnREb2MuYm9keTsKCgkJCQlldmVudC5wYWdlWCA9IG9yaWdpbmFsLmNsaWVudFggKyAoIGRvYyAmJiBkb2Muc2Nyb2xsTGVmdCB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsTGVmdCB8fCAwICkgLSAoIGRvYyAmJiBkb2MuY2xpZW50TGVmdCB8fCBib2R5ICYmIGJvZHkuY2xpZW50TGVmdCB8fCAwICk7CgkJCQlldmVudC5wYWdlWSA9IG9yaWdpbmFsLmNsaWVudFkgKyAoIGRvYyAmJiBkb2Muc2Nyb2xsVG9wICB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsVG9wICB8fCAwICkgLSAoIGRvYyAmJiBkb2MuY2xpZW50VG9wICB8fCBib2R5ICYmIGJvZHkuY2xpZW50VG9wICB8fCAwICk7CgkJCX0KCgkJCS8vIEFkZCByZWxhdGVkVGFyZ2V0LCBpZiBuZWNlc3NhcnkKCQkJaWYgKCAhZXZlbnQucmVsYXRlZFRhcmdldCAmJiBmcm9tRWxlbWVudCApIHsKCQkJCWV2ZW50LnJlbGF0ZWRUYXJnZXQgPSBmcm9tRWxlbWVudCA9PT0gZXZlbnQudGFyZ2V0ID8gb3JpZ2luYWwudG9FbGVtZW50IDogZnJvbUVsZW1lbnQ7CgkJCX0KCgkJCS8vIEFkZCB3aGljaCBmb3IgY2xpY2s6IDEgPT09IGxlZnQ7IDIgPT09IG1pZGRsZTsgMyA9PT0gcmlnaHQKCQkJLy8gTm90ZTogYnV0dG9uIGlzIG5vdCBub3JtYWxpemVkLCBzbyBkb24ndCB1c2UgaXQKCQkJaWYgKCAhZXZlbnQud2hpY2ggJiYgYnV0dG9uICE9PSB1bmRlZmluZWQgKSB7CgkJCQlldmVudC53aGljaCA9ICggYnV0dG9uICYgMSA/IDEgOiAoIGJ1dHRvbiAmIDIgPyAzIDogKCBidXR0b24gJiA0ID8gMiA6IDAgKSApICk7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCXNwZWNpYWw6IHsKCQlsb2FkOiB7CgkJCS8vIFByZXZlbnQgdHJpZ2dlcmVkIGltYWdlLmxvYWQgZXZlbnRzIGZyb20gYnViYmxpbmcgdG8gd2luZG93LmxvYWQKCQkJbm9CdWJibGU6IHRydWUKCQl9LAoJCWNsaWNrOiB7CgkJCS8vIEZvciBjaGVja2JveCwgZmlyZSBuYXRpdmUgZXZlbnQgc28gY2hlY2tlZCBzdGF0ZSB3aWxsIGJlIHJpZ2h0CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJpbnB1dCIgKSAmJiB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgJiYgdGhpcy5jbGljayApIHsKCQkJCQl0aGlzLmNsaWNrKCk7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJfSwKCQlmb2N1czogewoJCQkvLyBGaXJlIG5hdGl2ZSBldmVudCBpZiBwb3NzaWJsZSBzbyBibHVyL2ZvY3VzIHNlcXVlbmNlIGlzIGNvcnJlY3QKCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHRoaXMgIT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgdGhpcy5mb2N1cyApIHsKCQkJCQl0cnkgewoJCQkJCQl0aGlzLmZvY3VzKCk7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9IGNhdGNoICggZSApIHsKCQkJCQkJLy8gU3VwcG9ydDogSUU8OQoJCQkJCQkvLyBJZiB3ZSBlcnJvciBvbiBmb2N1cyB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsICMxMjUxOCksCgkJCQkJCS8vIGxldCAudHJpZ2dlcigpIHJ1biB0aGUgaGFuZGxlcnMKCQkJCQl9CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3VzaW4iCgkJfSwKCQlibHVyOiB7CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIHRoaXMuYmx1ciApIHsKCQkJCQl0aGlzLmJsdXIoKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3Vzb3V0IgoJCX0sCgoJCWJlZm9yZXVubG9hZDogewoJCQlwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJCQkvLyBFdmVuIHdoZW4gcmV0dXJuVmFsdWUgZXF1YWxzIHRvIHVuZGVmaW5lZCBGaXJlZm94IHdpbGwgc3RpbGwgc2hvdyBhbGVydAoJCQkJaWYgKCBldmVudC5yZXN1bHQgIT09IHVuZGVmaW5lZCApIHsKCQkJCQlldmVudC5vcmlnaW5hbEV2ZW50LnJldHVyblZhbHVlID0gZXZlbnQucmVzdWx0OwoJCQkJfQoJCQl9CgkJfQoJfSwKCglzaW11bGF0ZTogZnVuY3Rpb24oIHR5cGUsIGVsZW0sIGV2ZW50LCBidWJibGUgKSB7CgkJLy8gUGlnZ3liYWNrIG9uIGEgZG9ub3IgZXZlbnQgdG8gc2ltdWxhdGUgYSBkaWZmZXJlbnQgb25lLgoJCS8vIEZha2Ugb3JpZ2luYWxFdmVudCB0byBhdm9pZCBkb25vcidzIHN0b3BQcm9wYWdhdGlvbiwgYnV0IGlmIHRoZQoJCS8vIHNpbXVsYXRlZCBldmVudCBwcmV2ZW50cyBkZWZhdWx0IHRoZW4gd2UgZG8gdGhlIHNhbWUgb24gdGhlIGRvbm9yLgoJCXZhciBlID0galF1ZXJ5LmV4dGVuZCgKCQkJbmV3IGpRdWVyeS5FdmVudCgpLAoJCQlldmVudCwKCQkJeyB0eXBlOiB0eXBlLAoJCQkJaXNTaW11bGF0ZWQ6IHRydWUsCgkJCQlvcmlnaW5hbEV2ZW50OiB7fQoJCQl9CgkJKTsKCQlpZiAoIGJ1YmJsZSApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGUsIG51bGwsIGVsZW0gKTsKCQl9IGVsc2UgewoJCQlqUXVlcnkuZXZlbnQuZGlzcGF0Y2guY2FsbCggZWxlbSwgZSApOwoJCX0KCQlpZiAoIGUuaXNEZWZhdWx0UHJldmVudGVkKCkgKSB7CgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJfQoJfQp9OwoKalF1ZXJ5LnJlbW92ZUV2ZW50ID0gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciA/CglmdW5jdGlvbiggZWxlbSwgdHlwZSwgaGFuZGxlICkgewoJCWlmICggZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICkgewoJCQllbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIoIHR5cGUsIGhhbmRsZSwgZmFsc2UgKTsKCQl9Cgl9IDoKCWZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBoYW5kbGUgKSB7CgkJdmFyIG5hbWUgPSAib24iICsgdHlwZTsKCgkJaWYgKCBlbGVtLmRldGFjaEV2ZW50ICkgewoKCQkJLy8gIzg1NDUsICM3MDU0LCBwcmV2ZW50aW5nIG1lbW9yeSBsZWFrcyBmb3IgY3VzdG9tIGV2ZW50cyBpbiBJRTYtOAoJCQkvLyBkZXRhY2hFdmVudCBuZWVkZWQgcHJvcGVydHkgb24gZWxlbWVudCwgYnkgbmFtZSBvZiB0aGF0IGV2ZW50LCB0byBwcm9wZXJseSBleHBvc2UgaXQgdG8gR0MKCQkJaWYgKCB0eXBlb2YgZWxlbVsgbmFtZSBdID09PSBjb3JlX3N0cnVuZGVmaW5lZCApIHsKCQkJCWVsZW1bIG5hbWUgXSA9IG51bGw7CgkJCX0KCgkJCWVsZW0uZGV0YWNoRXZlbnQoIG5hbWUsIGhhbmRsZSApOwoJCX0KCX07CgpqUXVlcnkuRXZlbnQgPSBmdW5jdGlvbiggc3JjLCBwcm9wcyApIHsKCS8vIEFsbG93IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgJ25ldycga2V5d29yZAoJaWYgKCAhKHRoaXMgaW5zdGFuY2VvZiBqUXVlcnkuRXZlbnQpICkgewoJCXJldHVybiBuZXcgalF1ZXJ5LkV2ZW50KCBzcmMsIHByb3BzICk7Cgl9CgoJLy8gRXZlbnQgb2JqZWN0CglpZiAoIHNyYyAmJiBzcmMudHlwZSApIHsKCQl0aGlzLm9yaWdpbmFsRXZlbnQgPSBzcmM7CgkJdGhpcy50eXBlID0gc3JjLnR5cGU7CgoJCS8vIEV2ZW50cyBidWJibGluZyB1cCB0aGUgZG9jdW1lbnQgbWF5IGhhdmUgYmVlbiBtYXJrZWQgYXMgcHJldmVudGVkCgkJLy8gYnkgYSBoYW5kbGVyIGxvd2VyIGRvd24gdGhlIHRyZWU7IHJlZmxlY3QgdGhlIGNvcnJlY3QgdmFsdWUuCgkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSAoIHNyYy5kZWZhdWx0UHJldmVudGVkIHx8IHNyYy5yZXR1cm5WYWx1ZSA9PT0gZmFsc2UgfHwKCQkJc3JjLmdldFByZXZlbnREZWZhdWx0ICYmIHNyYy5nZXRQcmV2ZW50RGVmYXVsdCgpICkgPyByZXR1cm5UcnVlIDogcmV0dXJuRmFsc2U7CgoJLy8gRXZlbnQgdHlwZQoJfSBlbHNlIHsKCQl0aGlzLnR5cGUgPSBzcmM7Cgl9CgoJLy8gUHV0IGV4cGxpY2l0bHkgcHJvdmlkZWQgcHJvcGVydGllcyBvbnRvIHRoZSBldmVudCBvYmplY3QKCWlmICggcHJvcHMgKSB7CgkJalF1ZXJ5LmV4dGVuZCggdGhpcywgcHJvcHMgKTsKCX0KCgkvLyBDcmVhdGUgYSB0aW1lc3RhbXAgaWYgaW5jb21pbmcgZXZlbnQgZG9lc24ndCBoYXZlIG9uZQoJdGhpcy50aW1lU3RhbXAgPSBzcmMgJiYgc3JjLnRpbWVTdGFtcCB8fCBqUXVlcnkubm93KCk7CgoJLy8gTWFyayBpdCBhcyBmaXhlZAoJdGhpc1sgalF1ZXJ5LmV4cGFuZG8gXSA9IHRydWU7Cn07CgovLyBqUXVlcnkuRXZlbnQgaXMgYmFzZWQgb24gRE9NMyBFdmVudHMgYXMgc3BlY2lmaWVkIGJ5IHRoZSBFQ01BU2NyaXB0IExhbmd1YWdlIEJpbmRpbmcKLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMy9XRC1ET00tTGV2ZWwtMy1FdmVudHMtMjAwMzAzMzEvZWNtYS1zY3JpcHQtYmluZGluZy5odG1sCmpRdWVyeS5FdmVudC5wcm90b3R5cGUgPSB7Cglpc0RlZmF1bHRQcmV2ZW50ZWQ6IHJldHVybkZhbHNlLAoJaXNQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoJaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoKCXByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSByZXR1cm5UcnVlOwoJCWlmICggIWUgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIElmIHByZXZlbnREZWZhdWx0IGV4aXN0cywgcnVuIGl0IG9uIHRoZSBvcmlnaW5hbCBldmVudAoJCWlmICggZS5wcmV2ZW50RGVmYXVsdCApIHsKCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoKCQkvLyBTdXBwb3J0OiBJRQoJCS8vIE90aGVyd2lzZSBzZXQgdGhlIHJldHVyblZhbHVlIHByb3BlcnR5IG9mIHRoZSBvcmlnaW5hbCBldmVudCB0byBmYWxzZQoJCX0gZWxzZSB7CgkJCWUucmV0dXJuVmFsdWUgPSBmYWxzZTsKCQl9Cgl9LAoJc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgkJaWYgKCAhZSApIHsKCQkJcmV0dXJuOwoJCX0KCQkvLyBJZiBzdG9wUHJvcGFnYXRpb24gZXhpc3RzLCBydW4gaXQgb24gdGhlIG9yaWdpbmFsIGV2ZW50CgkJaWYgKCBlLnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9CgoJCS8vIFN1cHBvcnQ6IElFCgkJLy8gU2V0IHRoZSBjYW5jZWxCdWJibGUgcHJvcGVydHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IHRvIHRydWUKCQllLmNhbmNlbEJ1YmJsZSA9IHRydWU7Cgl9LAoJc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTsKCQl0aGlzLnN0b3BQcm9wYWdhdGlvbigpOwoJfQp9OwoKLy8gQ3JlYXRlIG1vdXNlZW50ZXIvbGVhdmUgZXZlbnRzIHVzaW5nIG1vdXNlb3Zlci9vdXQgYW5kIGV2ZW50LXRpbWUgY2hlY2tzCmpRdWVyeS5lYWNoKHsKCW1vdXNlZW50ZXI6ICJtb3VzZW92ZXIiLAoJbW91c2VsZWF2ZTogIm1vdXNlb3V0Igp9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoJalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIG9yaWcgXSA9IHsKCQlkZWxlZ2F0ZVR5cGU6IGZpeCwKCQliaW5kVHlwZTogZml4LAoKCQloYW5kbGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIHJldCwKCQkJCXRhcmdldCA9IHRoaXMsCgkJCQlyZWxhdGVkID0gZXZlbnQucmVsYXRlZFRhcmdldCwKCQkJCWhhbmRsZU9iaiA9IGV2ZW50LmhhbmRsZU9iajsKCgkJCS8vIEZvciBtb3VzZW50ZXIvbGVhdmUgY2FsbCB0aGUgaGFuZGxlciBpZiByZWxhdGVkIGlzIG91dHNpZGUgdGhlIHRhcmdldC4KCQkJLy8gTkI6IE5vIHJlbGF0ZWRUYXJnZXQgaWYgdGhlIG1vdXNlIGxlZnQvZW50ZXJlZCB0aGUgYnJvd3NlciB3aW5kb3cKCQkJaWYgKCAhcmVsYXRlZCB8fCAocmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFqUXVlcnkuY29udGFpbnMoIHRhcmdldCwgcmVsYXRlZCApKSApIHsKCQkJCWV2ZW50LnR5cGUgPSBoYW5kbGVPYmoub3JpZ1R5cGU7CgkJCQlyZXQgPSBoYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQlldmVudC50eXBlID0gZml4OwoJCQl9CgkJCXJldHVybiByZXQ7CgkJfQoJfTsKfSk7CgovLyBJRSBzdWJtaXQgZGVsZWdhdGlvbgppZiAoICFqUXVlcnkuc3VwcG9ydC5zdWJtaXRCdWJibGVzICkgewoKCWpRdWVyeS5ldmVudC5zcGVjaWFsLnN1Ym1pdCA9IHsKCQlzZXR1cDogZnVuY3Rpb24oKSB7CgkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiZm9ybSIgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gTGF6eS1hZGQgYSBzdWJtaXQgaGFuZGxlciB3aGVuIGEgZGVzY2VuZGFudCBmb3JtIG1heSBwb3RlbnRpYWxseSBiZSBzdWJtaXR0ZWQKCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgImNsaWNrLl9zdWJtaXQga2V5cHJlc3MuX3N1Ym1pdCIsIGZ1bmN0aW9uKCBlICkgewoJCQkJLy8gTm9kZSBuYW1lIGNoZWNrIGF2b2lkcyBhIFZNTC1yZWxhdGVkIGNyYXNoIGluIElFICgjOTgwNykKCQkJCXZhciBlbGVtID0gZS50YXJnZXQsCgkJCQkJZm9ybSA9IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApIHx8IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImJ1dHRvbiIgKSA/IGVsZW0uZm9ybSA6IHVuZGVmaW5lZDsKCQkJCWlmICggZm9ybSAmJiAhalF1ZXJ5Ll9kYXRhKCBmb3JtLCAic3VibWl0QnViYmxlcyIgKSApIHsKCQkJCQlqUXVlcnkuZXZlbnQuYWRkKCBmb3JtLCAic3VibWl0Ll9zdWJtaXQiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWV2ZW50Ll9zdWJtaXRfYnViYmxlID0gdHJ1ZTsKCQkJCQl9KTsKCQkJCQlqUXVlcnkuX2RhdGEoIGZvcm0sICJzdWJtaXRCdWJibGVzIiwgdHJ1ZSApOwoJCQkJfQoJCQl9KTsKCQkJLy8gcmV0dXJuIHVuZGVmaW5lZCBzaW5jZSB3ZSBkb24ndCBuZWVkIGFuIGV2ZW50IGxpc3RlbmVyCgkJfSwKCgkJcG9zdERpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCS8vIElmIGZvcm0gd2FzIHN1Ym1pdHRlZCBieSB0aGUgdXNlciwgYnViYmxlIHRoZSBldmVudCB1cCB0aGUgdHJlZQoJCQlpZiAoIGV2ZW50Ll9zdWJtaXRfYnViYmxlICkgewoJCQkJZGVsZXRlIGV2ZW50Ll9zdWJtaXRfYnViYmxlOwoJCQkJaWYgKCB0aGlzLnBhcmVudE5vZGUgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQlqUXVlcnkuZXZlbnQuc2ltdWxhdGUoICJzdWJtaXQiLCB0aGlzLnBhcmVudE5vZGUsIGV2ZW50LCB0cnVlICk7CgkJCQl9CgkJCX0KCQl9LAoKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiZm9ybSIgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gUmVtb3ZlIGRlbGVnYXRlZCBoYW5kbGVyczsgY2xlYW5EYXRhIGV2ZW50dWFsbHkgcmVhcHMgc3VibWl0IGhhbmRsZXJzIGF0dGFjaGVkIGFib3ZlCgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX3N1Ym1pdCIgKTsKCQl9Cgl9Owp9CgovLyBJRSBjaGFuZ2UgZGVsZWdhdGlvbiBhbmQgY2hlY2tib3gvcmFkaW8gZml4CmlmICggIWpRdWVyeS5zdXBwb3J0LmNoYW5nZUJ1YmJsZXMgKSB7CgoJalF1ZXJ5LmV2ZW50LnNwZWNpYWwuY2hhbmdlID0gewoKCQlzZXR1cDogZnVuY3Rpb24oKSB7CgoJCQlpZiAoIHJmb3JtRWxlbXMudGVzdCggdGhpcy5ub2RlTmFtZSApICkgewoJCQkJLy8gSUUgZG9lc24ndCBmaXJlIGNoYW5nZSBvbiBhIGNoZWNrL3JhZGlvIHVudGlsIGJsdXI7IHRyaWdnZXIgaXQgb24gY2xpY2sKCQkJCS8vIGFmdGVyIGEgcHJvcGVydHljaGFuZ2UuIEVhdCB0aGUgYmx1ci1jaGFuZ2UgaW4gc3BlY2lhbC5jaGFuZ2UuaGFuZGxlLgoJCQkJLy8gVGhpcyBzdGlsbCBmaXJlcyBvbmNoYW5nZSBhIHNlY29uZCB0aW1lIGZvciBjaGVjay9yYWRpbyBhZnRlciBibHVyLgoJCQkJaWYgKCB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgfHwgdGhpcy50eXBlID09PSAicmFkaW8iICkgewoJCQkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJwcm9wZXJ0eWNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQlpZiAoIGV2ZW50Lm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lID09PSAiY2hlY2tlZCIgKSB7CgkJCQkJCQl0aGlzLl9qdXN0X2NoYW5nZWQgPSB0cnVlOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgImNsaWNrLl9jaGFuZ2UiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWlmICggdGhpcy5fanVzdF9jaGFuZ2VkICYmICFldmVudC5pc1RyaWdnZXIgKSB7CgkJCQkJCQl0aGlzLl9qdXN0X2NoYW5nZWQgPSBmYWxzZTsKCQkJCQkJfQoJCQkJCQkvLyBBbGxvdyB0cmlnZ2VyZWQsIHNpbXVsYXRlZCBjaGFuZ2UgZXZlbnRzICgjMTE1MDApCgkJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggImNoYW5nZSIsIHRoaXMsIGV2ZW50LCB0cnVlICk7CgkJCQkJfSk7CgkJCQl9CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJLy8gRGVsZWdhdGVkIGV2ZW50OyBsYXp5LWFkZCBhIGNoYW5nZSBoYW5kbGVyIG9uIGRlc2NlbmRhbnQgaW5wdXRzCgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGUgKSB7CgkJCQl2YXIgZWxlbSA9IGUudGFyZ2V0OwoKCQkJCWlmICggcmZvcm1FbGVtcy50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZUJ1YmJsZXMiICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggZWxlbSwgImNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSAmJiAhZXZlbnQuaXNTaW11bGF0ZWQgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggImNoYW5nZSIsIHRoaXMucGFyZW50Tm9kZSwgZXZlbnQsIHRydWUgKTsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZUJ1YmJsZXMiLCB0cnVlICk7CgkJCQl9CgkJCX0pOwoJCX0sCgoJCWhhbmRsZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgZWxlbSA9IGV2ZW50LnRhcmdldDsKCgkJCS8vIFN3YWxsb3cgbmF0aXZlIGNoYW5nZSBldmVudHMgZnJvbSBjaGVja2JveC9yYWRpbywgd2UgYWxyZWFkeSB0cmlnZ2VyZWQgdGhlbSBhYm92ZQoJCQlpZiAoIHRoaXMgIT09IGVsZW0gfHwgZXZlbnQuaXNTaW11bGF0ZWQgfHwgZXZlbnQuaXNUcmlnZ2VyIHx8IChlbGVtLnR5cGUgIT09ICJyYWRpbyIgJiYgZWxlbS50eXBlICE9PSAiY2hlY2tib3giKSApIHsKCQkJCXJldHVybiBldmVudC5oYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCX0KCQl9LAoKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX2NoYW5nZSIgKTsKCgkJCXJldHVybiAhcmZvcm1FbGVtcy50ZXN0KCB0aGlzLm5vZGVOYW1lICk7CgkJfQoJfTsKfQoKLy8gQ3JlYXRlICJidWJibGluZyIgZm9jdXMgYW5kIGJsdXIgZXZlbnRzCmlmICggIWpRdWVyeS5zdXBwb3J0LmZvY3VzaW5CdWJibGVzICkgewoJalF1ZXJ5LmVhY2goeyBmb2N1czogImZvY3VzaW4iLCBibHVyOiAiZm9jdXNvdXQiIH0sIGZ1bmN0aW9uKCBvcmlnLCBmaXggKSB7CgoJCS8vIEF0dGFjaCBhIHNpbmdsZSBjYXB0dXJpbmcgaGFuZGxlciB3aGlsZSBzb21lb25lIHdhbnRzIGZvY3VzaW4vZm9jdXNvdXQKCQl2YXIgYXR0YWNoZXMgPSAwLAoJCQloYW5kbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCBmaXgsIGV2ZW50LnRhcmdldCwgalF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKSwgdHJ1ZSApOwoJCQl9OwoKCQlqUXVlcnkuZXZlbnQuc3BlY2lhbFsgZml4IF0gPSB7CgkJCXNldHVwOiBmdW5jdGlvbigpIHsKCQkJCWlmICggYXR0YWNoZXMrKyA9PT0gMCApIHsKCQkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCBvcmlnLCBoYW5kbGVyLCB0cnVlICk7CgkJCQl9CgkJCX0sCgkJCXRlYXJkb3duOiBmdW5jdGlvbigpIHsKCQkJCWlmICggLS1hdHRhY2hlcyA9PT0gMCApIHsKCQkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCBvcmlnLCBoYW5kbGVyLCB0cnVlICk7CgkJCQl9CgkJCX0KCQl9OwoJfSk7Cn0KCmpRdWVyeS5mbi5leHRlbmQoewoKCW9uOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgLypJTlRFUk5BTCovIG9uZSApIHsKCQl2YXIgdHlwZSwgb3JpZ0ZuOwoKCQkvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCQlpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7CgkJCS8vICggdHlwZXMtT2JqZWN0LCBzZWxlY3RvciwgZGF0YSApCgkJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMtT2JqZWN0LCBkYXRhICkKCQkJCWRhdGEgPSBkYXRhIHx8IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub24oIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggZGF0YSA9PSBudWxsICYmIGZuID09IG51bGwgKSB7CgkJCS8vICggdHlwZXMsIGZuICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0gZWxzZSBpZiAoIGZuID09IG51bGwgKSB7CgkJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApCgkJCQlmbiA9IGRhdGE7CgkJCQlkYXRhID0gdW5kZWZpbmVkOwoJCQl9IGVsc2UgewoJCQkJLy8gKCB0eXBlcywgZGF0YSwgZm4gKQoJCQkJZm4gPSBkYXRhOwoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfSBlbHNlIGlmICggIWZuICkgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggb25lID09PSAxICkgewoJCQlvcmlnRm4gPSBmbjsKCQkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkvLyBDYW4gdXNlIGFuIGVtcHR5IHNldCwgc2luY2UgZXZlbnQgY29udGFpbnMgdGhlIGluZm8KCQkJCWpRdWVyeSgpLm9mZiggZXZlbnQgKTsKCQkJCXJldHVybiBvcmlnRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9OwoJCQkvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGbgoJCQlmbi5ndWlkID0gb3JpZ0ZuLmd1aWQgfHwgKCBvcmlnRm4uZ3VpZCA9IGpRdWVyeS5ndWlkKysgKTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsIHR5cGVzLCBmbiwgZGF0YSwgc2VsZWN0b3IgKTsKCQl9KTsKCX0sCglvbmU6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAxICk7Cgl9LAoJb2ZmOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBmbiApIHsKCQl2YXIgaGFuZGxlT2JqLCB0eXBlOwoJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoJCQkvLyAoIGV2ZW50ICkgIGRpc3BhdGNoZWQgalF1ZXJ5LkV2ZW50CgkJCWhhbmRsZU9iaiA9IHR5cGVzLmhhbmRsZU9iajsKCQkJalF1ZXJ5KCB0eXBlcy5kZWxlZ2F0ZVRhcmdldCApLm9mZigKCQkJCWhhbmRsZU9iai5uYW1lc3BhY2UgPyBoYW5kbGVPYmoub3JpZ1R5cGUgKyAiLiIgKyBoYW5kbGVPYmoubmFtZXNwYWNlIDogaGFuZGxlT2JqLm9yaWdUeXBlLAoJCQkJaGFuZGxlT2JqLnNlbGVjdG9yLAoJCQkJaGFuZGxlT2JqLmhhbmRsZXIKCQkJKTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoJCWlmICggdHlwZW9mIHR5cGVzID09PSAib2JqZWN0IiApIHsKCQkJLy8gKCB0eXBlcy1vYmplY3QgWywgc2VsZWN0b3JdICkKCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApOwoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAoIHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIgKSB7CgkJCS8vICggdHlwZXMgWywgZm5dICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggZm4gPT09IGZhbHNlICkgewoJCQlmbiA9IHJldHVybkZhbHNlOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCB0eXBlcywgZm4sIHNlbGVjdG9yICk7CgkJfSk7Cgl9LAoKCWJpbmQ6IGZ1bmN0aW9uKCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGVzLCBudWxsLCBkYXRhLCBmbiApOwoJfSwKCXVuYmluZDogZnVuY3Rpb24oIHR5cGVzLCBmbiApIHsKCQlyZXR1cm4gdGhpcy5vZmYoIHR5cGVzLCBudWxsLCBmbiApOwoJfSwKCglkZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4gKTsKCX0sCgl1bmRlbGVnYXRlOiBmdW5jdGlvbiggc2VsZWN0b3IsIHR5cGVzLCBmbiApIHsKCQkvLyAoIG5hbWVzcGFjZSApIG9yICggc2VsZWN0b3IsIHR5cGVzIFssIGZuXSApCgkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyB0aGlzLm9mZiggc2VsZWN0b3IsICIqKiIgKSA6IHRoaXMub2ZmKCB0eXBlcywgc2VsZWN0b3IgfHwgIioqIiwgZm4gKTsKCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIHR5cGUsIGRhdGEsIHRoaXMgKTsKCQl9KTsKCX0sCgl0cmlnZ2VySGFuZGxlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJdmFyIGVsZW0gPSB0aGlzWzBdOwoJCWlmICggZWxlbSApIHsKCQkJcmV0dXJuIGpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCBlbGVtLCB0cnVlICk7CgkJfQoJfQp9KTsKLyohCiAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lCiAqIENvcHlyaWdodCAyMDEyIGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqIGh0dHA6Ly9zaXp6bGVqcy5jb20vCiAqLwooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgewoKdmFyIGksCgljYWNoZWRydW5zLAoJRXhwciwKCWdldFRleHQsCglpc1hNTCwKCWNvbXBpbGUsCgloYXNEdXBsaWNhdGUsCglvdXRlcm1vc3RDb250ZXh0LAoKCS8vIExvY2FsIGRvY3VtZW50IHZhcnMKCXNldERvY3VtZW50LAoJZG9jdW1lbnQsCglkb2NFbGVtLAoJZG9jdW1lbnRJc1hNTCwKCXJidWdneVFTQSwKCXJidWdneU1hdGNoZXMsCgltYXRjaGVzLAoJY29udGFpbnMsCglzb3J0T3JkZXIsCgoJLy8gSW5zdGFuY2Utc3BlY2lmaWMgZGF0YQoJZXhwYW5kbyA9ICJzaXp6bGUiICsgLShuZXcgRGF0ZSgpKSwKCXByZWZlcnJlZERvYyA9IHdpbmRvdy5kb2N1bWVudCwKCXN1cHBvcnQgPSB7fSwKCWRpcnJ1bnMgPSAwLAoJZG9uZSA9IDAsCgljbGFzc0NhY2hlID0gY3JlYXRlQ2FjaGUoKSwKCXRva2VuQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAoJY29tcGlsZXJDYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgoJLy8gR2VuZXJhbC1wdXJwb3NlIGNvbnN0YW50cwoJc3RydW5kZWZpbmVkID0gdHlwZW9mIHVuZGVmaW5lZCwKCU1BWF9ORUdBVElWRSA9IDEgPDwgMzEsCgoJLy8gQXJyYXkgbWV0aG9kcwoJYXJyID0gW10sCglwb3AgPSBhcnIucG9wLAoJcHVzaCA9IGFyci5wdXNoLAoJc2xpY2UgPSBhcnIuc2xpY2UsCgkvLyBVc2UgYSBzdHJpcHBlZC1kb3duIGluZGV4T2YgaWYgd2UgY2FuJ3QgdXNlIGEgbmF0aXZlIG9uZQoJaW5kZXhPZiA9IGFyci5pbmRleE9mIHx8IGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBpID0gMCwKCQkJbGVuID0gdGhpcy5sZW5ndGg7CgkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCWlmICggdGhpc1tpXSA9PT0gZWxlbSApIHsKCQkJCXJldHVybiBpOwoJCQl9CgkJfQoJCXJldHVybiAtMTsKCX0sCgoKCS8vIFJlZ3VsYXIgZXhwcmVzc2lvbnMKCgkvLyBXaGl0ZXNwYWNlIGNoYXJhY3RlcnMgaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI3doaXRlc3BhY2UKCXdoaXRlc3BhY2UgPSAiW1xceDIwXFx0XFxyXFxuXFxmXSIsCgkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXN5bnRheC8jY2hhcmFjdGVycwoJY2hhcmFjdGVyRW5jb2RpbmcgPSAiKD86XFxcXC58W1xcdy1dfFteXFx4MDAtXFx4YTBdKSsiLAoKCS8vIExvb3NlbHkgbW9kZWxlZCBvbiBDU1MgaWRlbnRpZmllciBjaGFyYWN0ZXJzCgkvLyBBbiB1bnF1b3RlZCB2YWx1ZSBzaG91bGQgYmUgYSBDU1MgaWRlbnRpZmllciBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jYXR0cmlidXRlLXNlbGVjdG9ycwoJLy8gUHJvcGVyIHN5bnRheDogaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI3ZhbHVlLWRlZi1pZGVudGlmaWVyCglpZGVudGlmaWVyID0gY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggInciLCAidyMiICksCgoJLy8gQWNjZXB0YWJsZSBvcGVyYXRvcnMgaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNhdHRyaWJ1dGUtc2VsZWN0b3JzCglvcGVyYXRvcnMgPSAiKFsqXiR8IX5dPz0pIiwKCWF0dHJpYnV0ZXMgPSAiXFxbIiArIHdoaXRlc3BhY2UgKyAiKigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKyB3aGl0ZXNwYWNlICsKCQkiKig/OiIgKyBvcGVyYXRvcnMgKyB3aGl0ZXNwYWNlICsgIiooPzooWydcIl0pKCg/OlxcXFwufFteXFxcXF0pKj8pXFwzfCgiICsgaWRlbnRpZmllciArICIpfCl8KSIgKyB3aGl0ZXNwYWNlICsgIipcXF0iLAoKCS8vIFByZWZlciBhcmd1bWVudHMgcXVvdGVkLAoJLy8gICB0aGVuIG5vdCBjb250YWluaW5nIHBzZXVkb3MvYnJhY2tldHMsCgkvLyAgIHRoZW4gYXR0cmlidXRlIHNlbGVjdG9ycy9ub24tcGFyZW50aGV0aWNhbCBleHByZXNzaW9ucywKCS8vICAgdGhlbiBhbnl0aGluZyBlbHNlCgkvLyBUaGVzZSBwcmVmZXJlbmNlcyBhcmUgaGVyZSB0byByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMKCS8vICAgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgUFNFVURPIHByZUZpbHRlcgoJcHNldWRvcyA9ICI6KCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpKD86XFwoKChbJ1wiXSkoKD86XFxcXC58W15cXFxcXSkqPylcXDN8KCg/OlxcXFwufFteXFxcXCgpW1xcXV18IiArIGF0dHJpYnV0ZXMucmVwbGFjZSggMywgOCApICsgIikqKXwuKilcXCl8KSIsCgoJLy8gTGVhZGluZyBhbmQgbm9uLWVzY2FwZWQgdHJhaWxpbmcgd2hpdGVzcGFjZSwgY2FwdHVyaW5nIHNvbWUgbm9uLXdoaXRlc3BhY2UgY2hhcmFjdGVycyBwcmVjZWRpbmcgdGhlIGxhdHRlcgoJcnRyaW0gPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIit8KCg/Ol58W15cXFxcXSkoPzpcXFxcLikqKSIgKyB3aGl0ZXNwYWNlICsgIiskIiwgImciICksCgoJcmNvbW1hID0gbmV3IFJlZ0V4cCggIl4iICsgd2hpdGVzcGFjZSArICIqLCIgKyB3aGl0ZXNwYWNlICsgIioiICksCglyY29tYmluYXRvcnMgPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIiooW1xceDIwXFx0XFxyXFxuXFxmPit+XSkiICsgd2hpdGVzcGFjZSArICIqIiApLAoJcnBzZXVkbyA9IG5ldyBSZWdFeHAoIHBzZXVkb3MgKSwKCXJpZGVudGlmaWVyID0gbmV3IFJlZ0V4cCggIl4iICsgaWRlbnRpZmllciArICIkIiApLAoKCW1hdGNoRXhwciA9IHsKCQkiSUQiOiBuZXcgUmVnRXhwKCAiXiMoIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiICksCgkJIkNMQVNTIjogbmV3IFJlZ0V4cCggIl5cXC4oIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiICksCgkJIk5BTUUiOiBuZXcgUmVnRXhwKCAiXlxcW25hbWU9WydcIl0/KCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpWydcIl0/XFxdIiApLAoJCSJUQUciOiBuZXcgUmVnRXhwKCAiXigiICsgY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggInciLCAidyoiICkgKyAiKSIgKSwKCQkiQVRUUiI6IG5ldyBSZWdFeHAoICJeIiArIGF0dHJpYnV0ZXMgKSwKCQkiUFNFVURPIjogbmV3IFJlZ0V4cCggIl4iICsgcHNldWRvcyApLAoJCSJDSElMRCI6IG5ldyBSZWdFeHAoICJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXCgiICsgd2hpdGVzcGFjZSArCgkJCSIqKGV2ZW58b2RkfCgoWystXXwpKFxcZCopbnwpIiArIHdoaXRlc3BhY2UgKyAiKig/OihbKy1dfCkiICsgd2hpdGVzcGFjZSArCgkJCSIqKFxcZCspfCkpIiArIHdoaXRlc3BhY2UgKyAiKlxcKXwpIiwgImkiICksCgkJLy8gRm9yIHVzZSBpbiBsaWJyYXJpZXMgaW1wbGVtZW50aW5nIC5pcygpCgkJLy8gV2UgdXNlIHRoaXMgZm9yIFBPUyBtYXRjaGluZyBpbiBgc2VsZWN0YAoJCSJuZWVkc0NvbnRleHQiOiBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIgKwoJCQl3aGl0ZXNwYWNlICsgIiooKD86LVxcZCk/XFxkKikiICsgd2hpdGVzcGFjZSArICIqXFwpfCkoPz1bXi1dfCQpIiwgImkiICkKCX0sCgoJcnNpYmxpbmcgPSAvW1x4MjBcdFxyXG5cZl0qWyt+XS8sCgoJcm5hdGl2ZSA9IC9eW157XStce1xzKlxbbmF0aXZlIGNvZGUvLAoKCS8vIEVhc2lseS1wYXJzZWFibGUvcmV0cmlldmFibGUgSUQgb3IgVEFHIG9yIENMQVNTIHNlbGVjdG9ycwoJcnF1aWNrRXhwciA9IC9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sCgoJcmlucHV0cyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksCglyaGVhZGVyID0gL15oXGQkL2ksCgoJcmVzY2FwZSA9IC8nfFxcL2csCglyYXR0cmlidXRlUXVvdGVzID0gL1w9W1x4MjBcdFxyXG5cZl0qKFteJyJcXV0qKVtceDIwXHRcclxuXGZdKlxdL2csCgoJLy8gQ1NTIGVzY2FwZXMgaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI2VzY2FwZWQtY2hhcmFjdGVycwoJcnVuZXNjYXBlID0gL1xcKFtcZGEtZkEtRl17MSw2fVtceDIwXHRcclxuXGZdP3wuKS9nLAoJZnVuZXNjYXBlID0gZnVuY3Rpb24oIF8sIGVzY2FwZWQgKSB7CgkJdmFyIGhpZ2ggPSAiMHgiICsgZXNjYXBlZCAtIDB4MTAwMDA7CgkJLy8gTmFOIG1lYW5zIG5vbi1jb2RlcG9pbnQKCQlyZXR1cm4gaGlnaCAhPT0gaGlnaCA/CgkJCWVzY2FwZWQgOgoJCQkvLyBCTVAgY29kZXBvaW50CgkJCWhpZ2ggPCAwID8KCQkJCVN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggKyAweDEwMDAwICkgOgoJCQkJLy8gU3VwcGxlbWVudGFsIFBsYW5lIGNvZGVwb2ludCAoc3Vycm9nYXRlIHBhaXIpCgkJCQlTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoID4+IDEwIHwgMHhEODAwLCBoaWdoICYgMHgzRkYgfCAweERDMDAgKTsKCX07CgovLyBVc2UgYSBzdHJpcHBlZC1kb3duIHNsaWNlIGlmIHdlIGNhbid0IHVzZSBhIG5hdGl2ZSBvbmUKdHJ5IHsKCXNsaWNlLmNhbGwoIHByZWZlcnJlZERvYy5kb2N1bWVudEVsZW1lbnQuY2hpbGROb2RlcywgMCApWzBdLm5vZGVUeXBlOwp9IGNhdGNoICggZSApIHsKCXNsaWNlID0gZnVuY3Rpb24oIGkgKSB7CgkJdmFyIGVsZW0sCgkJCXJlc3VsdHMgPSBbXTsKCQl3aGlsZSAoIChlbGVtID0gdGhpc1tpKytdKSApIHsKCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJfQoJCXJldHVybiByZXN1bHRzOwoJfTsKfQoKLyoqCiAqIEZvciBmZWF0dXJlIGRldGVjdGlvbgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gdGVzdCBmb3IgbmF0aXZlIHN1cHBvcnQKICovCmZ1bmN0aW9uIGlzTmF0aXZlKCBmbiApIHsKCXJldHVybiBybmF0aXZlLnRlc3QoIGZuICsgIiIgKTsKfQoKLyoqCiAqIENyZWF0ZSBrZXktdmFsdWUgY2FjaGVzIG9mIGxpbWl0ZWQgc2l6ZQogKiBAcmV0dXJucyB7RnVuY3Rpb24oc3RyaW5nLCBPYmplY3QpfSBSZXR1cm5zIHRoZSBPYmplY3QgZGF0YSBhZnRlciBzdG9yaW5nIGl0IG9uIGl0c2VsZiB3aXRoCiAqCXByb3BlcnR5IG5hbWUgdGhlIChzcGFjZS1zdWZmaXhlZCkgc3RyaW5nIGFuZCAoaWYgdGhlIGNhY2hlIGlzIGxhcmdlciB0aGFuIEV4cHIuY2FjaGVMZW5ndGgpCiAqCWRlbGV0aW5nIHRoZSBvbGRlc3QgZW50cnkKICovCmZ1bmN0aW9uIGNyZWF0ZUNhY2hlKCkgewoJdmFyIGNhY2hlLAoJCWtleXMgPSBbXTsKCglyZXR1cm4gKGNhY2hlID0gZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJLy8gVXNlIChrZXkgKyAiICIpIHRvIGF2b2lkIGNvbGxpc2lvbiB3aXRoIG5hdGl2ZSBwcm90b3R5cGUgcHJvcGVydGllcyAoc2VlIElzc3VlICMxNTcpCgkJaWYgKCBrZXlzLnB1c2goIGtleSArPSAiICIgKSA+IEV4cHIuY2FjaGVMZW5ndGggKSB7CgkJCS8vIE9ubHkga2VlcCB0aGUgbW9zdCByZWNlbnQgZW50cmllcwoJCQlkZWxldGUgY2FjaGVbIGtleXMuc2hpZnQoKSBdOwoJCX0KCQlyZXR1cm4gKGNhY2hlWyBrZXkgXSA9IHZhbHVlKTsKCX0pOwp9CgovKioKICogTWFyayBhIGZ1bmN0aW9uIGZvciBzcGVjaWFsIHVzZSBieSBTaXp6bGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGZ1bmN0aW9uIHRvIG1hcmsKICovCmZ1bmN0aW9uIG1hcmtGdW5jdGlvbiggZm4gKSB7CglmblsgZXhwYW5kbyBdID0gdHJ1ZTsKCXJldHVybiBmbjsKfQoKLyoqCiAqIFN1cHBvcnQgdGVzdGluZyB1c2luZyBhbiBlbGVtZW50CiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFBhc3NlZCB0aGUgY3JlYXRlZCBkaXYgYW5kIGV4cGVjdHMgYSBib29sZWFuIHJlc3VsdAogKi8KZnVuY3Rpb24gYXNzZXJ0KCBmbiApIHsKCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCgl0cnkgewoJCXJldHVybiBmbiggZGl2ICk7Cgl9IGNhdGNoIChlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfSBmaW5hbGx5IHsKCQkvLyByZWxlYXNlIG1lbW9yeSBpbiBJRQoJCWRpdiA9IG51bGw7Cgl9Cn0KCmZ1bmN0aW9uIFNpenpsZSggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7Cgl2YXIgbWF0Y2gsIGVsZW0sIG0sIG5vZGVUeXBlLAoJCS8vIFFTQSB2YXJzCgkJaSwgZ3JvdXBzLCBvbGQsIG5pZCwgbmV3Q29udGV4dCwgbmV3U2VsZWN0b3I7CgoJaWYgKCAoIGNvbnRleHQgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IHByZWZlcnJlZERvYyApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJfQoKCWNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50OwoJcmVzdWx0cyA9IHJlc3VsdHMgfHwgW107CgoJaWYgKCAhc2VsZWN0b3IgfHwgdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQlyZXR1cm4gcmVzdWx0czsKCX0KCglpZiAoIChub2RlVHlwZSA9IGNvbnRleHQubm9kZVR5cGUpICE9PSAxICYmIG5vZGVUeXBlICE9PSA5ICkgewoJCXJldHVybiBbXTsKCX0KCglpZiAoICFkb2N1bWVudElzWE1MICYmICFzZWVkICkgewoKCQkvLyBTaG9ydGN1dHMKCQlpZiAoIChtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyggc2VsZWN0b3IgKSkgKSB7CgkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoIiNJRCIpCgkJCWlmICggKG0gPSBtYXRjaFsxXSkgKSB7CgkJCQlpZiAoIG5vZGVUeXBlID09PSA5ICkgewoJCQkJCWVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBtICk7CgkJCQkJLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnMKCQkJCQkvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzCgkJCQkJaWYgKCBlbGVtICYmIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCQkJLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIElFLCBPcGVyYSwgYW5kIFdlYmtpdCByZXR1cm4gaXRlbXMKCQkJCQkJLy8gYnkgbmFtZSBpbnN0ZWFkIG9mIElECgkJCQkJCWlmICggZWxlbS5pZCA9PT0gbSApIHsKCQkJCQkJCXJlc3VsdHMucHVzaCggZWxlbSApOwoJCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJCX0KCQkJCQl9IGVsc2UgewoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCS8vIENvbnRleHQgaXMgbm90IGEgZG9jdW1lbnQKCQkJCQlpZiAoIGNvbnRleHQub3duZXJEb2N1bWVudCAmJiAoZWxlbSA9IGNvbnRleHQub3duZXJEb2N1bWVudC5nZXRFbGVtZW50QnlJZCggbSApKSAmJgoJCQkJCQljb250YWlucyggY29udGV4dCwgZWxlbSApICYmIGVsZW0uaWQgPT09IG0gKSB7CgkJCQkJCXJlc3VsdHMucHVzaCggZWxlbSApOwoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgkJCQl9CgoJCQkvLyBTcGVlZC11cDogU2l6emxlKCJUQUciKQoJCQl9IGVsc2UgaWYgKCBtYXRjaFsyXSApIHsKCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIHNsaWNlLmNhbGwoY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggc2VsZWN0b3IgKSwgMCkgKTsKCQkJCXJldHVybiByZXN1bHRzOwoKCQkJLy8gU3BlZWQtdXA6IFNpenpsZSgiLkNMQVNTIikKCQkJfSBlbHNlIGlmICggKG0gPSBtYXRjaFszXSkgJiYgc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSAmJiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSB7CgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzbGljZS5jYWxsKGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggbSApLCAwKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCX0KCQl9CgoJCS8vIFFTQSBwYXRoCgkJaWYgKCBzdXBwb3J0LnFzYSAmJiAhcmJ1Z2d5UVNBLnRlc3Qoc2VsZWN0b3IpICkgewoJCQlvbGQgPSB0cnVlOwoJCQluaWQgPSBleHBhbmRvOwoJCQluZXdDb250ZXh0ID0gY29udGV4dDsKCQkJbmV3U2VsZWN0b3IgPSBub2RlVHlwZSA9PT0gOSAmJiBzZWxlY3RvcjsKCgkJCS8vIHFTQSB3b3JrcyBzdHJhbmdlbHkgb24gRWxlbWVudC1yb290ZWQgcXVlcmllcwoJCQkvLyBXZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBzcGVjaWZ5aW5nIGFuIGV4dHJhIElEIG9uIHRoZSByb290CgkJCS8vIGFuZCB3b3JraW5nIHVwIGZyb20gdGhlcmUgKFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGUgdGVjaG5pcXVlKQoJCQkvLyBJRSA4IGRvZXNuJ3Qgd29yayBvbiBvYmplY3QgZWxlbWVudHMKCQkJaWYgKCBub2RlVHlwZSA9PT0gMSAmJiBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiICkgewoJCQkJZ3JvdXBzID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJCQkJaWYgKCAob2xkID0gY29udGV4dC5nZXRBdHRyaWJ1dGUoImlkIikpICkgewoJCQkJCW5pZCA9IG9sZC5yZXBsYWNlKCByZXNjYXBlLCAiXFwkJiIgKTsKCQkJCX0gZWxzZSB7CgkJCQkJY29udGV4dC5zZXRBdHRyaWJ1dGUoICJpZCIsIG5pZCApOwoJCQkJfQoJCQkJbmlkID0gIltpZD0nIiArIG5pZCArICInXSAiOwoKCQkJCWkgPSBncm91cHMubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJZ3JvdXBzW2ldID0gbmlkICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7CgkJCQl9CgkJCQluZXdDb250ZXh0ID0gcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiBjb250ZXh0LnBhcmVudE5vZGUgfHwgY29udGV4dDsKCQkJCW5ld1NlbGVjdG9yID0gZ3JvdXBzLmpvaW4oIiwiKTsKCQkJfQoKCQkJaWYgKCBuZXdTZWxlY3RvciApIHsKCQkJCXRyeSB7CgkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2xpY2UuY2FsbCggbmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKAoJCQkJCQluZXdTZWxlY3RvcgoJCQkJCSksIDAgKSApOwoJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJfSBjYXRjaChxc2FFcnJvcikgewoJCQkJfSBmaW5hbGx5IHsKCQkJCQlpZiAoICFvbGQgKSB7CgkJCQkJCWNvbnRleHQucmVtb3ZlQXR0cmlidXRlKCJpZCIpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBBbGwgb3RoZXJzCglyZXR1cm4gc2VsZWN0KCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICk7Cn0KCi8qKgogKiBEZXRlY3QgeG1sCiAqIEBwYXJhbSB7RWxlbWVudHxPYmplY3R9IGVsZW0gQW4gZWxlbWVudCBvciBhIGRvY3VtZW50CiAqLwppc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJLy8gZG9jdW1lbnRFbGVtZW50IGlzIHZlcmlmaWVkIGZvciBjYXNlcyB3aGVyZSBpdCBkb2Vzbid0IHlldCBleGlzdAoJLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCgl2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDsKCXJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09ICJIVE1MIiA6IGZhbHNlOwp9OwoKLyoqCiAqIFNldHMgZG9jdW1lbnQtcmVsYXRlZCB2YXJpYWJsZXMgb25jZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkb2N1bWVudAogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjdXJyZW50IGRvY3VtZW50CiAqLwpzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkgewoJdmFyIGRvYyA9IG5vZGUgPyBub2RlLm93bmVyRG9jdW1lbnQgfHwgbm9kZSA6IHByZWZlcnJlZERvYzsKCgkvLyBJZiBubyBkb2N1bWVudCBhbmQgZG9jdW1lbnRFbGVtZW50IGlzIGF2YWlsYWJsZSwgcmV0dXJuCglpZiAoIGRvYyA9PT0gZG9jdW1lbnQgfHwgZG9jLm5vZGVUeXBlICE9PSA5IHx8ICFkb2MuZG9jdW1lbnRFbGVtZW50ICkgewoJCXJldHVybiBkb2N1bWVudDsKCX0KCgkvLyBTZXQgb3VyIGRvY3VtZW50Cglkb2N1bWVudCA9IGRvYzsKCWRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50OwoKCS8vIFN1cHBvcnQgdGVzdHMKCWRvY3VtZW50SXNYTUwgPSBpc1hNTCggZG9jICk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSByZXR1cm5zIG9ubHkgZWxlbWVudHMKCXN1cHBvcnQudGFnTmFtZU5vQ29tbWVudHMgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuYXBwZW5kQ2hpbGQoIGRvYy5jcmVhdGVDb21tZW50KCIiKSApOwoJCXJldHVybiAhZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikubGVuZ3RoOwoJfSk7CgoJLy8gQ2hlY2sgaWYgYXR0cmlidXRlcyBzaG91bGQgYmUgcmV0cmlldmVkIGJ5IGF0dHJpYnV0ZSBub2RlcwoJc3VwcG9ydC5hdHRyaWJ1dGVzID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmlubmVySFRNTCA9ICI8c2VsZWN0Pjwvc2VsZWN0PiI7CgkJdmFyIHR5cGUgPSB0eXBlb2YgZGl2Lmxhc3RDaGlsZC5nZXRBdHRyaWJ1dGUoIm11bHRpcGxlIik7CgkJLy8gSUU4IHJldHVybnMgYSBzdHJpbmcgZm9yIHNvbWUgYXR0cmlidXRlcyBldmVuIHdoZW4gbm90IHByZXNlbnQKCQlyZXR1cm4gdHlwZSAhPT0gImJvb2xlYW4iICYmIHR5cGUgIT09ICJzdHJpbmciOwoJfSk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSBjYW4gYmUgdHJ1c3RlZAoJc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCS8vIE9wZXJhIGNhbid0IGZpbmQgYSBzZWNvbmQgY2xhc3NuYW1lIChpbiA5LjYpCgkJZGl2LmlubmVySFRNTCA9ICI8ZGl2IGNsYXNzPSdoaWRkZW4gZSc+PC9kaXY+PGRpdiBjbGFzcz0naGlkZGVuJz48L2Rpdj4iOwoJCWlmICggIWRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lIHx8ICFkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aCApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gU2FmYXJpIDMuMiBjYWNoZXMgY2xhc3MgYXR0cmlidXRlcyBhbmQgZG9lc24ndCBjYXRjaCBjaGFuZ2VzCgkJZGl2Lmxhc3RDaGlsZC5jbGFzc05hbWUgPSAiZSI7CgkJcmV0dXJuIGRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoID09PSAyOwoJfSk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudEJ5SWQgcmV0dXJucyBlbGVtZW50cyBieSBuYW1lCgkvLyBDaGVjayBpZiBnZXRFbGVtZW50c0J5TmFtZSBwcml2aWxlZ2VzIGZvcm0gY29udHJvbHMgb3IgcmV0dXJucyBlbGVtZW50cyBieSBJRAoJc3VwcG9ydC5nZXRCeU5hbWUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkvLyBJbmplY3QgY29udGVudAoJCWRpdi5pZCA9IGV4cGFuZG8gKyAwOwoJCWRpdi5pbm5lckhUTUwgPSAiPGEgbmFtZT0nIiArIGV4cGFuZG8gKyAiJz48L2E+PGRpdiBuYW1lPSciICsgZXhwYW5kbyArICInPjwvZGl2PiI7CgkJZG9jRWxlbS5pbnNlcnRCZWZvcmUoIGRpdiwgZG9jRWxlbS5maXJzdENoaWxkICk7CgoJCS8vIFRlc3QKCQl2YXIgcGFzcyA9IGRvYy5nZXRFbGVtZW50c0J5TmFtZSAmJgoJCQkvLyBidWdneSBicm93c2VycyB3aWxsIHJldHVybiBmZXdlciB0aGFuIHRoZSBjb3JyZWN0IDIKCQkJZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICkubGVuZ3RoID09PSAyICsKCQkJLy8gYnVnZ3kgYnJvd3NlcnMgd2lsbCByZXR1cm4gbW9yZSB0aGFuIHRoZSBjb3JyZWN0IDAKCQkJZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICsgMCApLmxlbmd0aDsKCQlzdXBwb3J0LmdldElkTm90TmFtZSA9ICFkb2MuZ2V0RWxlbWVudEJ5SWQoIGV4cGFuZG8gKTsKCgkJLy8gQ2xlYW51cAoJCWRvY0VsZW0ucmVtb3ZlQ2hpbGQoIGRpdiApOwoKCQlyZXR1cm4gcGFzczsKCX0pOwoKCS8vIElFNi83IHJldHVybiBtb2RpZmllZCBhdHRyaWJ1dGVzCglFeHByLmF0dHJIYW5kbGUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iOwoJCXJldHVybiBkaXYuZmlyc3RDaGlsZCAmJiB0eXBlb2YgZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlICE9PSBzdHJ1bmRlZmluZWQgJiYKCQkJZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIikgPT09ICIjIjsKCX0pID8KCQl7fSA6CgkJewoJCQkiaHJlZiI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCAiaHJlZiIsIDIgKTsKCQkJfSwKCQkJInR5cGUiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpOwoJCQl9CgkJfTsKCgkvLyBJRCBmaW5kIGFuZCBmaWx0ZXIKCWlmICggc3VwcG9ydC5nZXRJZE5vdE5hbWUgKSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIGlkICk7CgkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJLy8gbm9kZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBkb2N1bWVudCAjNjk2MwoJCQkJcmV0dXJuIG0gJiYgbS5wYXJlbnROb2RlID8gW21dIDogW107CgkJCX0KCQl9OwoJCUV4cHIuZmlsdGVyWyJJRCJdID0gZnVuY3Rpb24oIGlkICkgewoJCQl2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCJpZCIpID09PSBhdHRySWQ7CgkJCX07CgkJfTsKCX0gZWxzZSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIGlkICk7CgoJCQkJcmV0dXJuIG0gPwoJCQkJCW0uaWQgPT09IGlkIHx8IHR5cGVvZiBtLmdldEF0dHJpYnV0ZU5vZGUgIT09IHN0cnVuZGVmaW5lZCAmJiBtLmdldEF0dHJpYnV0ZU5vZGUoImlkIikudmFsdWUgPT09IGlkID8KCQkJCQkJW21dIDoKCQkJCQkJdW5kZWZpbmVkIDoKCQkJCQlbXTsKCQkJfQoJCX07CgkJRXhwci5maWx0ZXJbIklEIl0gPSAgZnVuY3Rpb24oIGlkICkgewoJCQl2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIG5vZGUgPSB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSBzdHJ1bmRlZmluZWQgJiYgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOwoJCQkJcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9CgoJLy8gVGFnCglFeHByLmZpbmRbIlRBRyJdID0gc3VwcG9ydC50YWdOYW1lTm9Db21tZW50cyA/CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gc3RydW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApOwoJCQl9CgkJfSA6CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJdmFyIGVsZW0sCgkJCQl0bXAgPSBbXSwKCQkJCWkgPSAwLAoJCQkJcmVzdWx0cyA9IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApOwoKCQkJLy8gRmlsdGVyIG91dCBwb3NzaWJsZSBjb21tZW50cwoJCQlpZiAoIHRhZyA9PT0gIioiICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7CgkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQl0bXAucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdG1wOwoJCQl9CgkJCXJldHVybiByZXN1bHRzOwoJCX07CgoJLy8gTmFtZQoJRXhwci5maW5kWyJOQU1FIl0gPSBzdXBwb3J0LmdldEJ5TmFtZSAmJiBmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkgewoJCWlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUgIT09IHN0cnVuZGVmaW5lZCApIHsKCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUoIG5hbWUgKTsKCQl9Cgl9OwoKCS8vIENsYXNzCglFeHByLmZpbmRbIkNMQVNTIl0gPSBzdXBwb3J0LmdldEJ5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKCBjbGFzc05hbWUsIGNvbnRleHQgKSB7CgkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCXJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIGNsYXNzTmFtZSApOwoJCX0KCX07CgoJLy8gUVNBIGFuZCBtYXRjaGVzU2VsZWN0b3Igc3VwcG9ydAoKCS8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCglyYnVnZ3lNYXRjaGVzID0gW107CgoJLy8gcVNhKDpmb2N1cykgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKENocm9tZSAyMSksCgkvLyBubyBuZWVkIHRvIGFsc28gYWRkIHRvIGJ1Z2d5TWF0Y2hlcyBzaW5jZSBtYXRjaGVzIGNoZWNrcyBidWdneVFTQQoJLy8gQSBzdXBwb3J0IHRlc3Qgd291bGQgcmVxdWlyZSB0b28gbXVjaCBjb2RlICh3b3VsZCBpbmNsdWRlIGRvY3VtZW50IHJlYWR5KQoJcmJ1Z2d5UVNBID0gWyAiOmZvY3VzIiBdOwoKCWlmICggKHN1cHBvcnQucXNhID0gaXNOYXRpdmUoZG9jLnF1ZXJ5U2VsZWN0b3JBbGwpKSApIHsKCQkvLyBCdWlsZCBRU0EgcmVnZXgKCQkvLyBSZWdleCBzdHJhdGVneSBhZG9wdGVkIGZyb20gRGllZ28gUGVyaW5pCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIFNlbGVjdCBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIG9uIHB1cnBvc2UKCQkJLy8gVGhpcyBpcyB0byB0ZXN0IElFJ3MgdHJlYXRtZW50IG9mIG5vdCBleHBsaWN0bHkKCQkJLy8gc2V0dGluZyBhIGJvb2xlYW4gY29udGVudCBhdHRyaWJ1dGUsCgkJCS8vIHNpbmNlIGl0cyBwcmVzZW5jZSBzaG91bGQgYmUgZW5vdWdoCgkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CgkJCWRpdi5pbm5lckhUTUwgPSAiPHNlbGVjdD48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PiI7CgoJCQkvLyBJRTggLSBTb21lIGJvb2xlYW4gYXR0cmlidXRlcyBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICJcXFsiICsgd2hpdGVzcGFjZSArICIqKD86Y2hlY2tlZHxkaXNhYmxlZHxpc21hcHxtdWx0aXBsZXxyZWFkb25seXxzZWxlY3RlZHx2YWx1ZSkiICk7CgkJCX0KCgkJCS8vIFdlYmtpdC9PcGVyYSAtIDpjaGVja2VkIHNob3VsZCByZXR1cm4gc2VsZWN0ZWQgb3B0aW9uIGVsZW1lbnRzCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCS8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzCgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCI6Y2hlY2tlZCIpLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCI6Y2hlY2tlZCIpOwoJCQl9CgkJfSk7CgoJCWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoKCQkJLy8gT3BlcmEgMTAtMTIvSUU4IC0gXj0gJD0gKj0gYW5kIGVtcHR5IHZhbHVlcwoJCQkvLyBTaG91bGQgbm90IHNlbGVjdCBhbnl0aGluZwoJCQlkaXYuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPSdoaWRkZW4nIGk9JycvPiI7CgkJCWlmICggZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIltpXj0nJ10iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIlsqXiRdPSIgKyB3aGl0ZXNwYWNlICsgIiooPzpcIlwifCcnKSIgKTsKCQkJfQoKCQkJLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZCkKCQkJLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiICk7CgkJCX0KCgkJCS8vIE9wZXJhIDEwLTExIGRvZXMgbm90IHRocm93IG9uIHBvc3QtY29tbWEgaW52YWxpZCBwc2V1ZG9zCgkJCWRpdi5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4Iik7CgkJCXJidWdneVFTQS5wdXNoKCIsLio6Iik7CgkJfSk7Cgl9CgoJaWYgKCAoc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgPSBpc05hdGl2ZSggKG1hdGNoZXMgPSBkb2NFbGVtLm1hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ubW96TWF0Y2hlc1NlbGVjdG9yIHx8CgkJZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm9NYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKSApKSApIHsKCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIENoZWNrIHRvIHNlZSBpZiBpdCdzIHBvc3NpYmxlIHRvIGRvIG1hdGNoZXNTZWxlY3RvcgoJCQkvLyBvbiBhIGRpc2Nvbm5lY3RlZCBub2RlIChJRSA5KQoJCQlzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoID0gbWF0Y2hlcy5jYWxsKCBkaXYsICJkaXYiICk7CgoJCQkvLyBUaGlzIHNob3VsZCBmYWlsIHdpdGggYW4gZXhjZXB0aW9uCgkJCS8vIEdlY2tvIGRvZXMgbm90IGVycm9yLCByZXR1cm5zIGZhbHNlIGluc3RlYWQKCQkJbWF0Y2hlcy5jYWxsKCBkaXYsICJbcyE9JyddOngiICk7CgkJCXJidWdneU1hdGNoZXMucHVzaCggIiE9IiwgcHNldWRvcyApOwoJCX0pOwoJfQoKCXJidWdneVFTQSA9IG5ldyBSZWdFeHAoIHJidWdneVFTQS5qb2luKCJ8IikgKTsKCXJidWdneU1hdGNoZXMgPSBuZXcgUmVnRXhwKCByYnVnZ3lNYXRjaGVzLmpvaW4oInwiKSApOwoKCS8vIEVsZW1lbnQgY29udGFpbnMgYW5vdGhlcgoJLy8gUHVycG9zZWZ1bGx5IGRvZXMgbm90IGltcGxlbWVudCBpbmNsdXNpdmUgZGVzY2VuZGVudAoJLy8gQXMgaW4sIGFuIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBpdHNlbGYKCWNvbnRhaW5zID0gaXNOYXRpdmUoZG9jRWxlbS5jb250YWlucykgfHwgZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCXZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCgkJCQlidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKCQkJcmV0dXJuIGEgPT09IGJ1cCB8fCAhISggYnVwICYmIGJ1cC5ub2RlVHlwZSA9PT0gMSAmJiAoCgkJCQlhZG93bi5jb250YWlucyA/CgkJCQkJYWRvd24uY29udGFpbnMoIGJ1cCApIDoKCQkJCQlhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTYKCQkJKSk7CgkJfSA6CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYiApIHsKCQkJCXdoaWxlICggKGIgPSBiLnBhcmVudE5vZGUpICkgewoJCQkJCWlmICggYiA9PT0gYSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoKCS8vIERvY3VtZW50IG9yZGVyIHNvcnRpbmcKCXNvcnRPcmRlciA9IGRvY0VsZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24gPwoJZnVuY3Rpb24oIGEsIGIgKSB7CgkJdmFyIGNvbXBhcmU7CgoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQlpZiAoIChjb21wYXJlID0gYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGIgKSkgKSB7CgkJCWlmICggY29tcGFyZSAmIDEgfHwgYS5wYXJlbnROb2RlICYmIGEucGFyZW50Tm9kZS5ub2RlVHlwZSA9PT0gMTEgKSB7CgkJCQlpZiAoIGEgPT09IGRvYyB8fCBjb250YWlucyggcHJlZmVycmVkRG9jLCBhICkgKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfQoJCQkJaWYgKCBiID09PSBkb2MgfHwgY29udGFpbnMoIHByZWZlcnJlZERvYywgYiApICkgewoJCQkJCXJldHVybiAxOwoJCQkJfQoJCQkJcmV0dXJuIDA7CgkJCX0KCQkJcmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxOwoJCX0KCgkJcmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPyAtMSA6IDE7Cgl9IDoKCWZ1bmN0aW9uKCBhLCBiICkgewoJCXZhciBjdXIsCgkJCWkgPSAwLAoJCQlhdXAgPSBhLnBhcmVudE5vZGUsCgkJCWJ1cCA9IGIucGFyZW50Tm9kZSwKCQkJYXAgPSBbIGEgXSwKCQkJYnAgPSBbIGIgXTsKCgkJLy8gRXhpdCBlYXJseSBpZiB0aGUgbm9kZXMgYXJlIGlkZW50aWNhbAoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgoJCS8vIFBhcmVudGxlc3Mgbm9kZXMgYXJlIGVpdGhlciBkb2N1bWVudHMgb3IgZGlzY29ubmVjdGVkCgkJfSBlbHNlIGlmICggIWF1cCB8fCAhYnVwICkgewoJCQlyZXR1cm4gYSA9PT0gZG9jID8gLTEgOgoJCQkJYiA9PT0gZG9jID8gMSA6CgkJCQlhdXAgPyAtMSA6CgkJCQlidXAgPyAxIDoKCQkJCTA7CgoJCS8vIElmIHRoZSBub2RlcyBhcmUgc2libGluZ3MsIHdlIGNhbiBkbyBhIHF1aWNrIGNoZWNrCgkJfSBlbHNlIGlmICggYXVwID09PSBidXAgKSB7CgkJCXJldHVybiBzaWJsaW5nQ2hlY2soIGEsIGIgKTsKCQl9CgoJCS8vIE90aGVyd2lzZSB3ZSBuZWVkIGZ1bGwgbGlzdHMgb2YgdGhlaXIgYW5jZXN0b3JzIGZvciBjb21wYXJpc29uCgkJY3VyID0gYTsKCQl3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7CgkJCWFwLnVuc2hpZnQoIGN1ciApOwoJCX0KCQljdXIgPSBiOwoJCXdoaWxlICggKGN1ciA9IGN1ci5wYXJlbnROb2RlKSApIHsKCQkJYnAudW5zaGlmdCggY3VyICk7CgkJfQoKCQkvLyBXYWxrIGRvd24gdGhlIHRyZWUgbG9va2luZyBmb3IgYSBkaXNjcmVwYW5jeQoJCXdoaWxlICggYXBbaV0gPT09IGJwW2ldICkgewoJCQlpKys7CgkJfQoKCQlyZXR1cm4gaSA/CgkJCS8vIERvIGEgc2libGluZyBjaGVjayBpZiB0aGUgbm9kZXMgaGF2ZSBhIGNvbW1vbiBhbmNlc3RvcgoJCQlzaWJsaW5nQ2hlY2soIGFwW2ldLCBicFtpXSApIDoKCgkJCS8vIE90aGVyd2lzZSBub2RlcyBpbiBvdXIgZG9jdW1lbnQgc29ydCBmaXJzdAoJCQlhcFtpXSA9PT0gcHJlZmVycmVkRG9jID8gLTEgOgoJCQlicFtpXSA9PT0gcHJlZmVycmVkRG9jID8gMSA6CgkJCTA7Cgl9OwoKCS8vIEFsd2F5cyBhc3N1bWUgdGhlIHByZXNlbmNlIG9mIGR1cGxpY2F0ZXMgaWYgc29ydCBkb2Vzbid0CgkvLyBwYXNzIHRoZW0gdG8gb3VyIGNvbXBhcmlzb24gZnVuY3Rpb24gKGFzIGluIEdvb2dsZSBDaHJvbWUpLgoJaGFzRHVwbGljYXRlID0gZmFsc2U7CglbMCwgMF0uc29ydCggc29ydE9yZGVyICk7CglzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXMgPSBoYXNEdXBsaWNhdGU7CgoJcmV0dXJuIGRvY3VtZW50Owp9OwoKU2l6emxlLm1hdGNoZXMgPSBmdW5jdGlvbiggZXhwciwgZWxlbWVudHMgKSB7CglyZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBlbGVtZW50cyApOwp9OwoKU2l6emxlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKCBlbGVtLCBleHByICkgewoJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCglpZiAoICggZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0gKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGVsZW0gKTsKCX0KCgkvLyBNYWtlIHN1cmUgdGhhdCBhdHRyaWJ1dGUgc2VsZWN0b3JzIGFyZSBxdW90ZWQKCWV4cHIgPSBleHByLnJlcGxhY2UoIHJhdHRyaWJ1dGVRdW90ZXMsICI9JyQxJ10iICk7CgoJLy8gcmJ1Z2d5UVNBIGFsd2F5cyBjb250YWlucyA6Zm9jdXMsIHNvIG5vIG5lZWQgZm9yIGFuIGV4aXN0ZW5jZSBjaGVjawoJaWYgKCBzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciAmJiAhZG9jdW1lbnRJc1hNTCAmJiAoIXJidWdneU1hdGNoZXMgfHwgIXJidWdneU1hdGNoZXMudGVzdChleHByKSkgJiYgIXJidWdneVFTQS50ZXN0KGV4cHIpICkgewoJCXRyeSB7CgkJCXZhciByZXQgPSBtYXRjaGVzLmNhbGwoIGVsZW0sIGV4cHIgKTsKCgkJCS8vIElFIDkncyBtYXRjaGVzU2VsZWN0b3IgcmV0dXJucyBmYWxzZSBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKCQkJaWYgKCByZXQgfHwgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCB8fAoJCQkJCS8vIEFzIHdlbGwsIGRpc2Nvbm5lY3RlZCBub2RlcyBhcmUgc2FpZCB0byBiZSBpbiBhIGRvY3VtZW50CgkJCQkJLy8gZnJhZ21lbnQgaW4gSUUgOQoJCQkJCWVsZW0uZG9jdW1lbnQgJiYgZWxlbS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgkJfSBjYXRjaChlKSB7fQoJfQoKCXJldHVybiBTaXp6bGUoIGV4cHIsIGRvY3VtZW50LCBudWxsLCBbZWxlbV0gKS5sZW5ndGggPiAwOwp9OwoKU2l6emxlLmNvbnRhaW5zID0gZnVuY3Rpb24oIGNvbnRleHQsIGVsZW0gKSB7CgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJfQoJcmV0dXJuIGNvbnRhaW5zKCBjb250ZXh0LCBlbGVtICk7Cn07CgpTaXp6bGUuYXR0ciA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJdmFyIHZhbDsKCgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggZWxlbSApOwoJfQoKCWlmICggIWRvY3VtZW50SXNYTUwgKSB7CgkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCX0KCWlmICggKHZhbCA9IEV4cHIuYXR0ckhhbmRsZVsgbmFtZSBdKSApIHsKCQlyZXR1cm4gdmFsKCBlbGVtICk7Cgl9CglpZiAoIGRvY3VtZW50SXNYTUwgfHwgc3VwcG9ydC5hdHRyaWJ1dGVzICkgewoJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApOwoJfQoJcmV0dXJuICggKHZhbCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApKSB8fCBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApICkgJiYgZWxlbVsgbmFtZSBdID09PSB0cnVlID8KCQluYW1lIDoKCQl2YWwgJiYgdmFsLnNwZWNpZmllZCA/IHZhbC52YWx1ZSA6IG51bGw7Cn07CgpTaXp6bGUuZXJyb3IgPSBmdW5jdGlvbiggbXNnICkgewoJdGhyb3cgbmV3IEVycm9yKCAiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIiArIG1zZyApOwp9OwoKLy8gRG9jdW1lbnQgc29ydGluZyBhbmQgcmVtb3ZpbmcgZHVwbGljYXRlcwpTaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkgewoJdmFyIGVsZW0sCgkJZHVwbGljYXRlcyA9IFtdLAoJCWkgPSAxLAoJCWogPSAwOwoKCS8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKCWhhc0R1cGxpY2F0ZSA9ICFzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXM7CglyZXN1bHRzLnNvcnQoIHNvcnRPcmRlciApOwoKCWlmICggaGFzRHVwbGljYXRlICkgewoJCWZvciAoIDsgKGVsZW0gPSByZXN1bHRzW2ldKTsgaSsrICkgewoJCQlpZiAoIGVsZW0gPT09IHJlc3VsdHNbIGkgLSAxIF0gKSB7CgkJCQlqID0gZHVwbGljYXRlcy5wdXNoKCBpICk7CgkJCX0KCQl9CgkJd2hpbGUgKCBqLS0gKSB7CgkJCXJlc3VsdHMuc3BsaWNlKCBkdXBsaWNhdGVzWyBqIF0sIDEgKTsKCQl9Cgl9CgoJcmV0dXJuIHJlc3VsdHM7Cn07CgpmdW5jdGlvbiBzaWJsaW5nQ2hlY2soIGEsIGIgKSB7Cgl2YXIgY3VyID0gYiAmJiBhLAoJCWRpZmYgPSBjdXIgJiYgKCB+Yi5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKSAtICggfmEuc291cmNlSW5kZXggfHwgTUFYX05FR0FUSVZFICk7CgoJLy8gVXNlIElFIHNvdXJjZUluZGV4IGlmIGF2YWlsYWJsZSBvbiBib3RoIG5vZGVzCglpZiAoIGRpZmYgKSB7CgkJcmV0dXJuIGRpZmY7Cgl9CgoJLy8gQ2hlY2sgaWYgYiBmb2xsb3dzIGEKCWlmICggY3VyICkgewoJCXdoaWxlICggKGN1ciA9IGN1ci5uZXh0U2libGluZykgKSB7CgkJCWlmICggY3VyID09PSBiICkgewoJCQkJcmV0dXJuIC0xOwoJCQl9CgkJfQoJfQoKCXJldHVybiBhID8gMSA6IC0xOwp9CgovLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGlucHV0IHR5cGVzCmZ1bmN0aW9uIGNyZWF0ZUlucHV0UHNldWRvKCB0eXBlICkgewoJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCXJldHVybiBuYW1lID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gdHlwZTsKCX07Cn0KCi8vIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgYnV0dG9ucwpmdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7CglyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJcmV0dXJuIChuYW1lID09PSAiaW5wdXQiIHx8IG5hbWUgPT09ICJidXR0b24iKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIHBvc2l0aW9uYWxzCmZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oIGZuICkgewoJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggYXJndW1lbnQgKSB7CgkJYXJndW1lbnQgPSArYXJndW1lbnQ7CgkJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcyApIHsKCQkJdmFyIGosCgkJCQltYXRjaEluZGV4ZXMgPSBmbiggW10sIHNlZWQubGVuZ3RoLCBhcmd1bWVudCApLAoJCQkJaSA9IG1hdGNoSW5kZXhlcy5sZW5ndGg7CgoJCQkvLyBNYXRjaCBlbGVtZW50cyBmb3VuZCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4ZXMKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoIHNlZWRbIChqID0gbWF0Y2hJbmRleGVzW2ldKSBdICkgewoJCQkJCXNlZWRbal0gPSAhKG1hdGNoZXNbal0gPSBzZWVkW2pdKTsKCQkJCX0KCQkJfQoJCX0pOwoJfSk7Cn0KCi8qKgogKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIHRoZSB0ZXh0IHZhbHVlIG9mIGFuIGFycmF5IG9mIERPTSBub2RlcwogKiBAcGFyYW0ge0FycmF5fEVsZW1lbnR9IGVsZW0KICovCmdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJdmFyIG5vZGUsCgkJcmV0ID0gIiIsCgkJaSA9IDAsCgkJbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCWlmICggIW5vZGVUeXBlICkgewoJCS8vIElmIG5vIG5vZGVUeXBlLCB0aGlzIGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5CgkJZm9yICggOyAobm9kZSA9IGVsZW1baV0pOyBpKysgKSB7CgkJCS8vIERvIG5vdCB0cmF2ZXJzZSBjb21tZW50IG5vZGVzCgkJCXJldCArPSBnZXRUZXh0KCBub2RlICk7CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDkgfHwgbm9kZVR5cGUgPT09IDExICkgewoJCS8vIFVzZSB0ZXh0Q29udGVudCBmb3IgZWxlbWVudHMKCQkvLyBpbm5lclRleHQgdXNhZ2UgcmVtb3ZlZCBmb3IgY29uc2lzdGVuY3kgb2YgbmV3IGxpbmVzIChzZWUgIzExMTUzKQoJCWlmICggdHlwZW9mIGVsZW0udGV4dENvbnRlbnQgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gZWxlbS50ZXh0Q29udGVudDsKCQl9IGVsc2UgewoJCQkvLyBUcmF2ZXJzZSBpdHMgY2hpbGRyZW4KCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQlyZXQgKz0gZ2V0VGV4dCggZWxlbSApOwoJCQl9CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQgKSB7CgkJcmV0dXJuIGVsZW0ubm9kZVZhbHVlOwoJfQoJLy8gRG8gbm90IGluY2x1ZGUgY29tbWVudCBvciBwcm9jZXNzaW5nIGluc3RydWN0aW9uIG5vZGVzCgoJcmV0dXJuIHJldDsKfTsKCkV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzID0gewoKCS8vIENhbiBiZSBhZGp1c3RlZCBieSB0aGUgdXNlcgoJY2FjaGVMZW5ndGg6IDUwLAoKCWNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLAoKCW1hdGNoOiBtYXRjaEV4cHIsCgoJZmluZDoge30sCgoJcmVsYXRpdmU6IHsKCQkiPiI6IHsgZGlyOiAicGFyZW50Tm9kZSIsIGZpcnN0OiB0cnVlIH0sCgkJIiAiOiB7IGRpcjogInBhcmVudE5vZGUiIH0sCgkJIisiOiB7IGRpcjogInByZXZpb3VzU2libGluZyIsIGZpcnN0OiB0cnVlIH0sCgkJIn4iOiB7IGRpcjogInByZXZpb3VzU2libGluZyIgfQoJfSwKCglwcmVGaWx0ZXI6IHsKCQkiQVRUUiI6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJbWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApOwoKCQkJLy8gTW92ZSB0aGUgZ2l2ZW4gdmFsdWUgdG8gbWF0Y2hbM10gd2hldGhlciBxdW90ZWQgb3IgdW5xdW90ZWQKCQkJbWF0Y2hbM10gPSAoIG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8ICIiICkucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCWlmICggbWF0Y2hbMl0gPT09ICJ+PSIgKSB7CgkJCQltYXRjaFszXSA9ICIgIiArIG1hdGNoWzNdICsgIiAiOwoJCQl9CgoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDQgKTsKCQl9LAoKCQkiQ0hJTEQiOiBmdW5jdGlvbiggbWF0Y2ggKSB7CgkJCS8qIG1hdGNoZXMgZnJvbSBtYXRjaEV4cHJbIkNISUxEIl0KCQkJCTEgdHlwZSAob25seXxudGh8Li4uKQoJCQkJMiB3aGF0IChjaGlsZHxvZi10eXBlKQoJCQkJMyBhcmd1bWVudCAoZXZlbnxvZGR8XGQqfFxkKm4oWystXVxkKyk/fC4uLikKCQkJCTQgeG4tY29tcG9uZW50IG9mIHhuK3kgYXJndW1lbnQgKFsrLV0/XGQqbnwpCgkJCQk1IHNpZ24gb2YgeG4tY29tcG9uZW50CgkJCQk2IHggb2YgeG4tY29tcG9uZW50CgkJCQk3IHNpZ24gb2YgeS1jb21wb25lbnQKCQkJCTggeSBvZiB5LWNvbXBvbmVudAoJCQkqLwoJCQltYXRjaFsxXSA9IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCk7CgoJCQlpZiAoIG1hdGNoWzFdLnNsaWNlKCAwLCAzICkgPT09ICJudGgiICkgewoJCQkJLy8gbnRoLSogcmVxdWlyZXMgYXJndW1lbnQKCQkJCWlmICggIW1hdGNoWzNdICkgewoJCQkJCVNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTsKCQkJCX0KCgkJCQkvLyBudW1lcmljIHggYW5kIHkgcGFyYW1ldGVycyBmb3IgRXhwci5maWx0ZXIuQ0hJTEQKCQkJCS8vIHJlbWVtYmVyIHRoYXQgZmFsc2UvdHJ1ZSBjYXN0IHJlc3BlY3RpdmVseSB0byAwLzEKCQkJCW1hdGNoWzRdID0gKyggbWF0Y2hbNF0gPyBtYXRjaFs1XSArIChtYXRjaFs2XSB8fCAxKSA6IDIgKiAoIG1hdGNoWzNdID09PSAiZXZlbiIgfHwgbWF0Y2hbM10gPT09ICJvZGQiICkgKTsKCQkJCW1hdGNoWzVdID0gKyggKCBtYXRjaFs3XSArIG1hdGNoWzhdICkgfHwgbWF0Y2hbM10gPT09ICJvZGQiICk7CgoJCQkvLyBvdGhlciB0eXBlcyBwcm9oaWJpdCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggbWF0Y2hbM10gKSB7CgkJCQlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7CgkJCX0KCgkJCXJldHVybiBtYXRjaDsKCQl9LAoKCQkiUFNFVURPIjogZnVuY3Rpb24oIG1hdGNoICkgewoJCQl2YXIgZXhjZXNzLAoJCQkJdW5xdW90ZWQgPSAhbWF0Y2hbNV0gJiYgbWF0Y2hbMl07CgoJCQlpZiAoIG1hdGNoRXhwclsiQ0hJTEQiXS50ZXN0KCBtYXRjaFswXSApICkgewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCgkJCS8vIEFjY2VwdCBxdW90ZWQgYXJndW1lbnRzIGFzLWlzCgkJCWlmICggbWF0Y2hbNF0gKSB7CgkJCQltYXRjaFsyXSA9IG1hdGNoWzRdOwoKCQkJLy8gU3RyaXAgZXhjZXNzIGNoYXJhY3RlcnMgZnJvbSB1bnF1b3RlZCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggdW5xdW90ZWQgJiYgcnBzZXVkby50ZXN0KCB1bnF1b3RlZCApICYmCgkJCQkvLyBHZXQgZXhjZXNzIGZyb20gdG9rZW5pemUgKHJlY3Vyc2l2ZWx5KQoJCQkJKGV4Y2VzcyA9IHRva2VuaXplKCB1bnF1b3RlZCwgdHJ1ZSApKSAmJgoJCQkJLy8gYWR2YW5jZSB0byB0aGUgbmV4dCBjbG9zaW5nIHBhcmVudGhlc2lzCgkJCQkoZXhjZXNzID0gdW5xdW90ZWQuaW5kZXhPZiggIikiLCB1bnF1b3RlZC5sZW5ndGggLSBleGNlc3MgKSAtIHVucXVvdGVkLmxlbmd0aCkgKSB7CgoJCQkJLy8gZXhjZXNzIGlzIGEgbmVnYXRpdmUgaW5kZXgKCQkJCW1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoIDAsIGV4Y2VzcyApOwoJCQkJbWF0Y2hbMl0gPSB1bnF1b3RlZC5zbGljZSggMCwgZXhjZXNzICk7CgkJCX0KCgkJCS8vIFJldHVybiBvbmx5IGNhcHR1cmVzIG5lZWRlZCBieSB0aGUgcHNldWRvIGZpbHRlciBtZXRob2QgKHR5cGUgYW5kIGFyZ3VtZW50KQoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDMgKTsKCQl9Cgl9LAoKCWZpbHRlcjogewoKCQkiVEFHIjogZnVuY3Rpb24oIG5vZGVOYW1lICkgewoJCQlpZiAoIG5vZGVOYW1lID09PSAiKiIgKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9OwoJCQl9CgoJCQlub2RlTmFtZSA9IG5vZGVOYW1lLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBub2RlTmFtZTsKCQkJfTsKCQl9LAoKCQkiQ0xBU1MiOiBmdW5jdGlvbiggY2xhc3NOYW1lICkgewoJCQl2YXIgcGF0dGVybiA9IGNsYXNzQ2FjaGVbIGNsYXNzTmFtZSArICIgIiBdOwoKCQkJcmV0dXJuIHBhdHRlcm4gfHwKCQkJCShwYXR0ZXJuID0gbmV3IFJlZ0V4cCggIihefCIgKyB3aGl0ZXNwYWNlICsgIikiICsgY2xhc3NOYW1lICsgIigiICsgd2hpdGVzcGFjZSArICJ8JCkiICkpICYmCgkJCQljbGFzc0NhY2hlKCBjbGFzc05hbWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCXJldHVybiBwYXR0ZXJuLnRlc3QoIGVsZW0uY2xhc3NOYW1lIHx8ICh0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGUgIT09IHN0cnVuZGVmaW5lZCAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSkgfHwgIiIgKTsKCQkJCX0pOwoJCX0sCgoJCSJBVFRSIjogZnVuY3Rpb24oIG5hbWUsIG9wZXJhdG9yLCBjaGVjayApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJlc3VsdCA9IFNpenpsZS5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkJaWYgKCByZXN1bHQgPT0gbnVsbCApIHsKCQkJCQlyZXR1cm4gb3BlcmF0b3IgPT09ICIhPSI7CgkJCQl9CgkJCQlpZiAoICFvcGVyYXRvciApIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCgkJCQlyZXN1bHQgKz0gIiI7CgoJCQkJcmV0dXJuIG9wZXJhdG9yID09PSAiPSIgPyByZXN1bHQgPT09IGNoZWNrIDoKCQkJCQlvcGVyYXRvciA9PT0gIiE9IiA/IHJlc3VsdCAhPT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAiXj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPT09IDAgOgoJCQkJCW9wZXJhdG9yID09PSAiKj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPiAtMSA6CgkJCQkJb3BlcmF0b3IgPT09ICIkPSIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoIC1jaGVjay5sZW5ndGggKSA9PT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAifj0iID8gKCAiICIgKyByZXN1bHQgKyAiICIgKS5pbmRleE9mKCBjaGVjayApID4gLTEgOgoJCQkJCW9wZXJhdG9yID09PSAifD0iID8gcmVzdWx0ID09PSBjaGVjayB8fCByZXN1bHQuc2xpY2UoIDAsIGNoZWNrLmxlbmd0aCArIDEgKSA9PT0gY2hlY2sgKyAiLSIgOgoJCQkJCWZhbHNlOwoJCQl9OwoJCX0sCgoJCSJDSElMRCI6IGZ1bmN0aW9uKCB0eXBlLCB3aGF0LCBhcmd1bWVudCwgZmlyc3QsIGxhc3QgKSB7CgkJCXZhciBzaW1wbGUgPSB0eXBlLnNsaWNlKCAwLCAzICkgIT09ICJudGgiLAoJCQkJZm9yd2FyZCA9IHR5cGUuc2xpY2UoIC00ICkgIT09ICJsYXN0IiwKCQkJCW9mVHlwZSA9IHdoYXQgPT09ICJvZi10eXBlIjsKCgkJCXJldHVybiBmaXJzdCA9PT0gMSAmJiBsYXN0ID09PSAwID8KCgkJCQkvLyBTaG9ydGN1dCBmb3IgOm50aC0qKG4pCgkJCQlmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gISFlbGVtLnBhcmVudE5vZGU7CgkJCQl9IDoKCgkJCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQkJCXZhciBjYWNoZSwgb3V0ZXJDYWNoZSwgbm9kZSwgZGlmZiwgbm9kZUluZGV4LCBzdGFydCwKCQkJCQkJZGlyID0gc2ltcGxlICE9PSBmb3J3YXJkID8gIm5leHRTaWJsaW5nIiA6ICJwcmV2aW91c1NpYmxpbmciLAoJCQkJCQlwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGUsCgkJCQkJCW5hbWUgPSBvZlR5cGUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAoJCQkJCQl1c2VDYWNoZSA9ICF4bWwgJiYgIW9mVHlwZTsKCgkJCQkJaWYgKCBwYXJlbnQgKSB7CgoJCQkJCQkvLyA6KGZpcnN0fGxhc3R8b25seSktKGNoaWxkfG9mLXR5cGUpCgkJCQkJCWlmICggc2ltcGxlICkgewoJCQkJCQkJd2hpbGUgKCBkaXIgKSB7CgkJCQkJCQkJbm9kZSA9IGVsZW07CgkJCQkJCQkJd2hpbGUgKCAobm9kZSA9IG5vZGVbIGRpciBdKSApIHsKCQkJCQkJCQkJaWYgKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJCS8vIFJldmVyc2UgZGlyZWN0aW9uIGZvciA6b25seS0qIChpZiB3ZSBoYXZlbid0IHlldCBkb25lIHNvKQoJCQkJCQkJCXN0YXJ0ID0gZGlyID0gdHlwZSA9PT0gIm9ubHkiICYmICFzdGFydCAmJiAibmV4dFNpYmxpbmciOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCX0KCgkJCQkJCXN0YXJ0ID0gWyBmb3J3YXJkID8gcGFyZW50LmZpcnN0Q2hpbGQgOiBwYXJlbnQubGFzdENoaWxkIF07CgoJCQkJCQkvLyBub24teG1sIDpudGgtY2hpbGQoLi4uKSBzdG9yZXMgY2FjaGUgZGF0YSBvbiBgcGFyZW50YAoJCQkJCQlpZiAoIGZvcndhcmQgJiYgdXNlQ2FjaGUgKSB7CgkJCQkJCQkvLyBTZWVrIGBlbGVtYCBmcm9tIGEgcHJldmlvdXNseS1jYWNoZWQgaW5kZXgKCQkJCQkJCW91dGVyQ2FjaGUgPSBwYXJlbnRbIGV4cGFuZG8gXSB8fCAocGFyZW50WyBleHBhbmRvIF0gPSB7fSk7CgkJCQkJCQljYWNoZSA9IG91dGVyQ2FjaGVbIHR5cGUgXSB8fCBbXTsKCQkJCQkJCW5vZGVJbmRleCA9IGNhY2hlWzBdID09PSBkaXJydW5zICYmIGNhY2hlWzFdOwoJCQkJCQkJZGlmZiA9IGNhY2hlWzBdID09PSBkaXJydW5zICYmIGNhY2hlWzJdOwoJCQkJCQkJbm9kZSA9IG5vZGVJbmRleCAmJiBwYXJlbnQuY2hpbGROb2Rlc1sgbm9kZUluZGV4IF07CgoJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCgkJCQkJCQkJLy8gRmFsbGJhY2sgdG8gc2Vla2luZyBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKCQkJCQkJCQkoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHsKCgkJCQkJCQkJLy8gV2hlbiBmb3VuZCwgY2FjaGUgaW5kZXhlcyBvbiBgcGFyZW50YCBhbmQgYnJlYWsKCQkJCQkJCQlpZiAoIG5vZGUubm9kZVR5cGUgPT09IDEgJiYgKytkaWZmICYmIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCW91dGVyQ2FjaGVbIHR5cGUgXSA9IFsgZGlycnVucywgbm9kZUluZGV4LCBkaWZmIF07CgkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCX0KCQkJCQkJCX0KCgkJCQkJCS8vIFVzZSBwcmV2aW91c2x5LWNhY2hlZCBlbGVtZW50IGluZGV4IGlmIGF2YWlsYWJsZQoJCQkJCQl9IGVsc2UgaWYgKCB1c2VDYWNoZSAmJiAoY2FjaGUgPSAoZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0pICYmIGNhY2hlWzBdID09PSBkaXJydW5zICkgewoJCQkJCQkJZGlmZiA9IGNhY2hlWzFdOwoKCQkJCQkJLy8geG1sIDpudGgtY2hpbGQoLi4uKSBvciA6bnRoLWxhc3QtY2hpbGQoLi4uKSBvciA6bnRoKC1sYXN0KT8tb2YtdHlwZSguLi4pCgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBVc2UgdGhlIHNhbWUgbG9vcCBhcyBhYm92ZSB0byBzZWVrIGBlbGVtYCBmcm9tIHRoZSBzdGFydAoJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCQkJCQkJCQkoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHsKCgkJCQkJCQkJaWYgKCAoIG9mVHlwZSA/IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZSA6IG5vZGUubm9kZVR5cGUgPT09IDEgKSAmJiArK2RpZmYgKSB7CgkJCQkJCQkJCS8vIENhY2hlIHRoZSBpbmRleCBvZiBlYWNoIGVuY291bnRlcmVkIGVsZW1lbnQKCQkJCQkJCQkJaWYgKCB1c2VDYWNoZSApIHsKCQkJCQkJCQkJCShub2RlWyBleHBhbmRvIF0gfHwgKG5vZGVbIGV4cGFuZG8gXSA9IHt9KSlbIHR5cGUgXSA9IFsgZGlycnVucywgZGlmZiBdOwoJCQkJCQkJCQl9CgoJCQkJCQkJCQlpZiAoIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gSW5jb3Jwb3JhdGUgdGhlIG9mZnNldCwgdGhlbiBjaGVjayBhZ2FpbnN0IGN5Y2xlIHNpemUKCQkJCQkJZGlmZiAtPSBsYXN0OwoJCQkJCQlyZXR1cm4gZGlmZiA9PT0gZmlyc3QgfHwgKCBkaWZmICUgZmlyc3QgPT09IDAgJiYgZGlmZiAvIGZpcnN0ID49IDAgKTsKCQkJCQl9CgkJCQl9OwoJCX0sCgoJCSJQU0VVRE8iOiBmdW5jdGlvbiggcHNldWRvLCBhcmd1bWVudCApIHsKCQkJLy8gcHNldWRvLWNsYXNzIG5hbWVzIGFyZSBjYXNlLWluc2Vuc2l0aXZlCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jcHNldWRvLWNsYXNzZXMKCQkJLy8gUHJpb3JpdGl6ZSBieSBjYXNlIHNlbnNpdGl2aXR5IGluIGNhc2UgY3VzdG9tIHBzZXVkb3MgYXJlIGFkZGVkIHdpdGggdXBwZXJjYXNlIGxldHRlcnMKCQkJLy8gUmVtZW1iZXIgdGhhdCBzZXRGaWx0ZXJzIGluaGVyaXRzIGZyb20gcHNldWRvcwoJCQl2YXIgYXJncywKCQkJCWZuID0gRXhwci5wc2V1ZG9zWyBwc2V1ZG8gXSB8fCBFeHByLnNldEZpbHRlcnNbIHBzZXVkby50b0xvd2VyQ2FzZSgpIF0gfHwKCQkJCQlTaXp6bGUuZXJyb3IoICJ1bnN1cHBvcnRlZCBwc2V1ZG86ICIgKyBwc2V1ZG8gKTsKCgkJCS8vIFRoZSB1c2VyIG1heSB1c2UgY3JlYXRlUHNldWRvIHRvIGluZGljYXRlIHRoYXQKCQkJLy8gYXJndW1lbnRzIGFyZSBuZWVkZWQgdG8gY3JlYXRlIHRoZSBmaWx0ZXIgZnVuY3Rpb24KCQkJLy8ganVzdCBhcyBTaXp6bGUgZG9lcwoJCQlpZiAoIGZuWyBleHBhbmRvIF0gKSB7CgkJCQlyZXR1cm4gZm4oIGFyZ3VtZW50ICk7CgkJCX0KCgkJCS8vIEJ1dCBtYWludGFpbiBzdXBwb3J0IGZvciBvbGQgc2lnbmF0dXJlcwoJCQlpZiAoIGZuLmxlbmd0aCA+IDEgKSB7CgkJCQlhcmdzID0gWyBwc2V1ZG8sIHBzZXVkbywgIiIsIGFyZ3VtZW50IF07CgkJCQlyZXR1cm4gRXhwci5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KCBwc2V1ZG8udG9Mb3dlckNhc2UoKSApID8KCQkJCQltYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMgKSB7CgkJCQkJCXZhciBpZHgsCgkJCQkJCQltYXRjaGVkID0gZm4oIHNlZWQsIGFyZ3VtZW50ICksCgkJCQkJCQlpID0gbWF0Y2hlZC5sZW5ndGg7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWR4ID0gaW5kZXhPZi5jYWxsKCBzZWVkLCBtYXRjaGVkW2ldICk7CgkJCQkJCQlzZWVkWyBpZHggXSA9ICEoIG1hdGNoZXNbIGlkeCBdID0gbWF0Y2hlZFtpXSApOwoJCQkJCQl9CgkJCQkJfSkgOgoJCQkJCWZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCQlyZXR1cm4gZm4oIGVsZW0sIDAsIGFyZ3MgKTsKCQkJCQl9OwoJCQl9CgoJCQlyZXR1cm4gZm47CgkJfQoJfSwKCglwc2V1ZG9zOiB7CgkJLy8gUG90ZW50aWFsbHkgY29tcGxleCBwc2V1ZG9zCgkJIm5vdCI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJCS8vIFRyaW0gdGhlIHNlbGVjdG9yIHBhc3NlZCB0byBjb21waWxlCgkJCS8vIHRvIGF2b2lkIHRyZWF0aW5nIGxlYWRpbmcgYW5kIHRyYWlsaW5nCgkJCS8vIHNwYWNlcyBhcyBjb21iaW5hdG9ycwoJCQl2YXIgaW5wdXQgPSBbXSwKCQkJCXJlc3VsdHMgPSBbXSwKCQkJCW1hdGNoZXIgPSBjb21waWxlKCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApICk7CgoJCQlyZXR1cm4gbWF0Y2hlclsgZXhwYW5kbyBdID8KCQkJCW1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcywgY29udGV4dCwgeG1sICkgewoJCQkJCXZhciBlbGVtLAoJCQkJCQl1bm1hdGNoZWQgPSBtYXRjaGVyKCBzZWVkLCBudWxsLCB4bWwsIFtdICksCgkJCQkJCWkgPSBzZWVkLmxlbmd0aDsKCgkJCQkJLy8gTWF0Y2ggZWxlbWVudHMgdW5tYXRjaGVkIGJ5IGBtYXRjaGVyYAoJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQlpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHsKCQkJCQkJCXNlZWRbaV0gPSAhKG1hdGNoZXNbaV0gPSBlbGVtKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0pIDoKCQkJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCQkJaW5wdXRbMF0gPSBlbGVtOwoJCQkJCW1hdGNoZXIoIGlucHV0LCBudWxsLCB4bWwsIHJlc3VsdHMgKTsKCQkJCQlyZXR1cm4gIXJlc3VsdHMucG9wKCk7CgkJCQl9OwoJCX0pLAoKCQkiaGFzIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIFNpenpsZSggc2VsZWN0b3IsIGVsZW0gKS5sZW5ndGggPiAwOwoJCQl9OwoJCX0pLAoKCQkiY29udGFpbnMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiAoIGVsZW0udGV4dENvbnRlbnQgfHwgZWxlbS5pbm5lclRleHQgfHwgZ2V0VGV4dCggZWxlbSApICkuaW5kZXhPZiggdGV4dCApID4gLTE7CgkJCX07CgkJfSksCgoJCS8vICJXaGV0aGVyIGFuIGVsZW1lbnQgaXMgcmVwcmVzZW50ZWQgYnkgYSA6bGFuZygpIHNlbGVjdG9yCgkJLy8gaXMgYmFzZWQgc29sZWx5IG9uIHRoZSBlbGVtZW50J3MgbGFuZ3VhZ2UgdmFsdWUKCQkvLyBiZWluZyBlcXVhbCB0byB0aGUgaWRlbnRpZmllciBDLAoJCS8vIG9yIGJlZ2lubmluZyB3aXRoIHRoZSBpZGVudGlmaWVyIEMgaW1tZWRpYXRlbHkgZm9sbG93ZWQgYnkgIi0iLgoJCS8vIFRoZSBtYXRjaGluZyBvZiBDIGFnYWluc3QgdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZSBpcyBwZXJmb3JtZWQgY2FzZS1pbnNlbnNpdGl2ZWx5LgoJCS8vIFRoZSBpZGVudGlmaWVyIEMgZG9lcyBub3QgaGF2ZSB0byBiZSBhIHZhbGlkIGxhbmd1YWdlIG5hbWUuIgoJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jbGFuZy1wc2V1ZG8KCQkibGFuZyI6IG1hcmtGdW5jdGlvbiggZnVuY3Rpb24oIGxhbmcgKSB7CgkJCS8vIGxhbmcgdmFsdWUgbXVzdCBiZSBhIHZhbGlkIGlkZW50aWZpZGVyCgkJCWlmICggIXJpZGVudGlmaWVyLnRlc3QobGFuZyB8fCAiIikgKSB7CgkJCQlTaXp6bGUuZXJyb3IoICJ1bnN1cHBvcnRlZCBsYW5nOiAiICsgbGFuZyApOwoJCQl9CgkJCWxhbmcgPSBsYW5nLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIGVsZW1MYW5nOwoJCQkJZG8gewoJCQkJCWlmICggKGVsZW1MYW5nID0gZG9jdW1lbnRJc1hNTCA/CgkJCQkJCWVsZW0uZ2V0QXR0cmlidXRlKCJ4bWw6bGFuZyIpIHx8IGVsZW0uZ2V0QXR0cmlidXRlKCJsYW5nIikgOgoJCQkJCQllbGVtLmxhbmcpICkgewoKCQkJCQkJZWxlbUxhbmcgPSBlbGVtTGFuZy50b0xvd2VyQ2FzZSgpOwoJCQkJCQlyZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZiggbGFuZyArICItIiApID09PSAwOwoJCQkJCX0KCQkJCX0gd2hpbGUgKCAoZWxlbSA9IGVsZW0ucGFyZW50Tm9kZSkgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9OwoJCX0pLAoKCQkvLyBNaXNjZWxsYW5lb3VzCgkJInRhcmdldCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaDsKCQkJcmV0dXJuIGhhc2ggJiYgaGFzaC5zbGljZSggMSApID09PSBlbGVtLmlkOwoJCX0sCgoJCSJyb290IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBkb2NFbGVtOwoJCX0sCgoJCSJmb2N1cyI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiAoIWRvY3VtZW50Lmhhc0ZvY3VzIHx8IGRvY3VtZW50Lmhhc0ZvY3VzKCkpICYmICEhKGVsZW0udHlwZSB8fCBlbGVtLmhyZWYgfHwgfmVsZW0udGFiSW5kZXgpOwoJCX0sCgoJCS8vIEJvb2xlYW4gcHJvcGVydGllcwoJCSJlbmFibGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLmRpc2FibGVkID09PSBmYWxzZTsKCQl9LAoKCQkiZGlzYWJsZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IHRydWU7CgkJfSwKCgkJImNoZWNrZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJLy8gSW4gQ1NTMywgOmNoZWNrZWQgc2hvdWxkIHJldHVybiBib3RoIGNoZWNrZWQgYW5kIHNlbGVjdGVkIGVsZW1lbnRzCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCXZhciBub2RlTmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIChub2RlTmFtZSA9PT0gImlucHV0IiAmJiAhIWVsZW0uY2hlY2tlZCkgfHwgKG5vZGVOYW1lID09PSAib3B0aW9uIiAmJiAhIWVsZW0uc2VsZWN0ZWQpOwoJCX0sCgoJCSJzZWxlY3RlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBBY2Nlc3NpbmcgdGhpcyBwcm9wZXJ0eSBtYWtlcyBzZWxlY3RlZC1ieS1kZWZhdWx0CgkJCS8vIG9wdGlvbnMgaW4gU2FmYXJpIHdvcmsgcHJvcGVybHkKCQkJaWYgKCBlbGVtLnBhcmVudE5vZGUgKSB7CgkJCQllbGVtLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJfQoKCQkJcmV0dXJuIGVsZW0uc2VsZWN0ZWQgPT09IHRydWU7CgkJfSwKCgkJLy8gQ29udGVudHMKCQkiZW1wdHkiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNlbXB0eS1wc2V1ZG8KCQkJLy8gOmVtcHR5IGlzIG9ubHkgYWZmZWN0ZWQgYnkgZWxlbWVudCBub2RlcyBhbmQgY29udGVudCBub2RlcyhpbmNsdWRpbmcgdGV4dCgzKSwgY2RhdGEoNCkpLAoJCQkvLyAgIG5vdCBjb21tZW50LCBwcm9jZXNzaW5nIGluc3RydWN0aW9ucywgb3Igb3RoZXJzCgkJCS8vIFRoYW5rcyB0byBEaWVnbyBQZXJpbmkgZm9yIHRoZSBub2RlTmFtZSBzaG9ydGN1dAoJCQkvLyAgIEdyZWF0ZXIgdGhhbiAiQCIgbWVhbnMgYWxwaGEgY2hhcmFjdGVycyAoc3BlY2lmaWNhbGx5IG5vdCBzdGFydGluZyB3aXRoICIjIiBvciAiPyIpCgkJCWZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkgewoJCQkJaWYgKCBlbGVtLm5vZGVOYW1lID4gIkAiIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gNCApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSwKCgkJInBhcmVudCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gIUV4cHIucHNldWRvc1siZW1wdHkiXSggZWxlbSApOwoJCX0sCgoJCS8vIEVsZW1lbnQvaW5wdXQgdHlwZXMKCQkiaGVhZGVyIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiByaGVhZGVyLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTsKCQl9LAoKCQkiaW5wdXQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHJpbnB1dHMudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCX0sCgoJCSJidXR0b24iOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCXJldHVybiBuYW1lID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gImJ1dHRvbiIgfHwgbmFtZSA9PT0gImJ1dHRvbiI7CgkJfSwKCgkJInRleHQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJdmFyIGF0dHI7CgkJCS8vIElFNiBhbmQgNyB3aWxsIG1hcCBlbGVtLnR5cGUgdG8gJ3RleHQnIGZvciBuZXcgSFRNTDUgdHlwZXMgKHNlYXJjaCwgZXRjKQoJCQkvLyB1c2UgZ2V0QXR0cmlidXRlIGluc3RlYWQgdG8gdGVzdCB0aGlzIGNhc2UKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJgoJCQkJZWxlbS50eXBlID09PSAidGV4dCIgJiYKCQkJCSggKGF0dHIgPSBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpKSA9PSBudWxsIHx8IGF0dHIudG9Mb3dlckNhc2UoKSA9PT0gZWxlbS50eXBlICk7CgkJfSwKCgkJLy8gUG9zaXRpb24taW4tY29sbGVjdGlvbgoJCSJmaXJzdCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oKSB7CgkJCXJldHVybiBbIDAgXTsKCQl9KSwKCgkJImxhc3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJcmV0dXJuIFsgbGVuZ3RoIC0gMSBdOwoJCX0pLAoKCQkiZXEiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXJldHVybiBbIGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQgXTsKCQl9KSwKCgkJImV2ZW4iOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJdmFyIGkgPSAwOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHsKCQkJCW1hdGNoSW5kZXhlcy5wdXNoKCBpICk7CgkJCX0KCQkJcmV0dXJuIG1hdGNoSW5kZXhlczsKCQl9KSwKCgkJIm9kZCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkgewoJCQl2YXIgaSA9IDE7CgkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSArPSAyICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pLAoKCQkibHQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsKCQkJZm9yICggOyAtLWkgPj0gMDsgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSksCgoJCSJndCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCApIHsKCQkJdmFyIGkgPSBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50OwoJCQlmb3IgKCA7ICsraSA8IGxlbmd0aDsgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSkKCX0KfTsKCi8vIEFkZCBidXR0b24vaW5wdXQgdHlwZSBwc2V1ZG9zCmZvciAoIGkgaW4geyByYWRpbzogdHJ1ZSwgY2hlY2tib3g6IHRydWUsIGZpbGU6IHRydWUsIHBhc3N3b3JkOiB0cnVlLCBpbWFnZTogdHJ1ZSB9ICkgewoJRXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVJbnB1dFBzZXVkbyggaSApOwp9CmZvciAoIGkgaW4geyBzdWJtaXQ6IHRydWUsIHJlc2V0OiB0cnVlIH0gKSB7CglFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUJ1dHRvblBzZXVkbyggaSApOwp9CgpmdW5jdGlvbiB0b2tlbml6ZSggc2VsZWN0b3IsIHBhcnNlT25seSApIHsKCXZhciBtYXRjaGVkLCBtYXRjaCwgdG9rZW5zLCB0eXBlLAoJCXNvRmFyLCBncm91cHMsIHByZUZpbHRlcnMsCgkJY2FjaGVkID0gdG9rZW5DYWNoZVsgc2VsZWN0b3IgKyAiICIgXTsKCglpZiAoIGNhY2hlZCApIHsKCQlyZXR1cm4gcGFyc2VPbmx5ID8gMCA6IGNhY2hlZC5zbGljZSggMCApOwoJfQoKCXNvRmFyID0gc2VsZWN0b3I7Cglncm91cHMgPSBbXTsKCXByZUZpbHRlcnMgPSBFeHByLnByZUZpbHRlcjsKCgl3aGlsZSAoIHNvRmFyICkgewoKCQkvLyBDb21tYSBhbmQgZmlyc3QgcnVuCgkJaWYgKCAhbWF0Y2hlZCB8fCAobWF0Y2ggPSByY29tbWEuZXhlYyggc29GYXIgKSkgKSB7CgkJCWlmICggbWF0Y2ggKSB7CgkJCQkvLyBEb24ndCBjb25zdW1lIHRyYWlsaW5nIGNvbW1hcyBhcyB2YWxpZAoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hbMF0ubGVuZ3RoICkgfHwgc29GYXI7CgkJCX0KCQkJZ3JvdXBzLnB1c2goIHRva2VucyA9IFtdICk7CgkJfQoKCQltYXRjaGVkID0gZmFsc2U7CgoJCS8vIENvbWJpbmF0b3JzCgkJaWYgKCAobWF0Y2ggPSByY29tYmluYXRvcnMuZXhlYyggc29GYXIgKSkgKSB7CgkJCW1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwoJCQl0b2tlbnMucHVzaCggewoJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2UKCQkJCXR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCAiICIgKQoJCQl9ICk7CgkJCXNvRmFyID0gc29GYXIuc2xpY2UoIG1hdGNoZWQubGVuZ3RoICk7CgkJfQoKCQkvLyBGaWx0ZXJzCgkJZm9yICggdHlwZSBpbiBFeHByLmZpbHRlciApIHsKCQkJaWYgKCAobWF0Y2ggPSBtYXRjaEV4cHJbIHR5cGUgXS5leGVjKCBzb0ZhciApKSAmJiAoIXByZUZpbHRlcnNbIHR5cGUgXSB8fAoJCQkJKG1hdGNoID0gcHJlRmlsdGVyc1sgdHlwZSBdKCBtYXRjaCApKSkgKSB7CgkJCQltYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsKCQkJCXRva2Vucy5wdXNoKCB7CgkJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkJdHlwZTogdHlwZSwKCQkJCQltYXRjaGVzOiBtYXRjaAoJCQkJfSApOwoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQkJfQoJCX0KCgkJaWYgKCAhbWF0Y2hlZCApIHsKCQkJYnJlYWs7CgkJfQoJfQoKCS8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwoJLy8gaWYgd2UncmUganVzdCBwYXJzaW5nCgkvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnMKCXJldHVybiBwYXJzZU9ubHkgPwoJCXNvRmFyLmxlbmd0aCA6CgkJc29GYXIgPwoJCQlTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOgoJCQkvLyBDYWNoZSB0aGUgdG9rZW5zCgkJCXRva2VuQ2FjaGUoIHNlbGVjdG9yLCBncm91cHMgKS5zbGljZSggMCApOwp9CgpmdW5jdGlvbiB0b1NlbGVjdG9yKCB0b2tlbnMgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gdG9rZW5zLmxlbmd0aCwKCQlzZWxlY3RvciA9ICIiOwoJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJc2VsZWN0b3IgKz0gdG9rZW5zW2ldLnZhbHVlOwoJfQoJcmV0dXJuIHNlbGVjdG9yOwp9CgpmdW5jdGlvbiBhZGRDb21iaW5hdG9yKCBtYXRjaGVyLCBjb21iaW5hdG9yLCBiYXNlICkgewoJdmFyIGRpciA9IGNvbWJpbmF0b3IuZGlyLAoJCWNoZWNrTm9uRWxlbWVudHMgPSBiYXNlICYmIGRpciA9PT0gInBhcmVudE5vZGUiLAoJCWRvbmVOYW1lID0gZG9uZSsrOwoKCXJldHVybiBjb21iaW5hdG9yLmZpcnN0ID8KCQkvLyBDaGVjayBhZ2FpbnN0IGNsb3Nlc3QgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnQKCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkgewoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7CgkJCQkJcmV0dXJuIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApOwoJCQkJfQoJCQl9CgkJfSA6CgoJCS8vIENoZWNrIGFnYWluc3QgYWxsIGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50cwoJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciBkYXRhLCBjYWNoZSwgb3V0ZXJDYWNoZSwKCQkJCWRpcmtleSA9IGRpcnJ1bnMgKyAiICIgKyBkb25lTmFtZTsKCgkJCS8vIFdlIGNhbid0IHNldCBhcmJpdHJhcnkgZGF0YSBvbiBYTUwgbm9kZXMsIHNvIHRoZXkgZG9uJ3QgYmVuZWZpdCBmcm9tIGRpciBjYWNoaW5nCgkJCWlmICggeG1sICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJaWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJb3V0ZXJDYWNoZSA9IGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQlpZiAoIChjYWNoZSA9IG91dGVyQ2FjaGVbIGRpciBdKSAmJiBjYWNoZVswXSA9PT0gZGlya2V5ICkgewoJCQkJCQkJaWYgKCAoZGF0YSA9IGNhY2hlWzFdKSA9PT0gdHJ1ZSB8fCBkYXRhID09PSBjYWNoZWRydW5zICkgewoJCQkJCQkJCXJldHVybiBkYXRhID09PSB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJY2FjaGUgPSBvdXRlckNhY2hlWyBkaXIgXSA9IFsgZGlya2V5IF07CgkJCQkJCQljYWNoZVsxXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApIHx8IGNhY2hlZHJ1bnM7CgkJCQkJCQlpZiAoIGNhY2hlWzFdID09PSB0cnVlICkgewoJCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfTsKfQoKZnVuY3Rpb24gZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICkgewoJcmV0dXJuIG1hdGNoZXJzLmxlbmd0aCA+IDEgPwoJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciBpID0gbWF0Y2hlcnMubGVuZ3RoOwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWlmICggIW1hdGNoZXJzW2ldKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSA6CgkJbWF0Y2hlcnNbMF07Cn0KCmZ1bmN0aW9uIGNvbmRlbnNlKCB1bm1hdGNoZWQsIG1hcCwgZmlsdGVyLCBjb250ZXh0LCB4bWwgKSB7Cgl2YXIgZWxlbSwKCQluZXdVbm1hdGNoZWQgPSBbXSwKCQlpID0gMCwKCQlsZW4gPSB1bm1hdGNoZWQubGVuZ3RoLAoJCW1hcHBlZCA9IG1hcCAhPSBudWxsOwoKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCWlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkgewoJCQlpZiAoICFmaWx0ZXIgfHwgZmlsdGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCW5ld1VubWF0Y2hlZC5wdXNoKCBlbGVtICk7CgkJCQlpZiAoIG1hcHBlZCApIHsKCQkJCQltYXAucHVzaCggaSApOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiBuZXdVbm1hdGNoZWQ7Cn0KCmZ1bmN0aW9uIHNldE1hdGNoZXIoIHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApIHsKCWlmICggcG9zdEZpbHRlciAmJiAhcG9zdEZpbHRlclsgZXhwYW5kbyBdICkgewoJCXBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKCBwb3N0RmlsdGVyICk7Cgl9CglpZiAoIHBvc3RGaW5kZXIgJiYgIXBvc3RGaW5kZXJbIGV4cGFuZG8gXSApIHsKCQlwb3N0RmluZGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbmRlciwgcG9zdFNlbGVjdG9yICk7Cgl9CglyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCByZXN1bHRzLCBjb250ZXh0LCB4bWwgKSB7CgkJdmFyIHRlbXAsIGksIGVsZW0sCgkJCXByZU1hcCA9IFtdLAoJCQlwb3N0TWFwID0gW10sCgkJCXByZWV4aXN0aW5nID0gcmVzdWx0cy5sZW5ndGgsCgoJCQkvLyBHZXQgaW5pdGlhbCBlbGVtZW50cyBmcm9tIHNlZWQgb3IgY29udGV4dAoJCQllbGVtcyA9IHNlZWQgfHwgbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IgfHwgIioiLCBjb250ZXh0Lm5vZGVUeXBlID8gWyBjb250ZXh0IF0gOiBjb250ZXh0LCBbXSApLAoKCQkJLy8gUHJlZmlsdGVyIHRvIGdldCBtYXRjaGVyIGlucHV0LCBwcmVzZXJ2aW5nIGEgbWFwIGZvciBzZWVkLXJlc3VsdHMgc3luY2hyb25pemF0aW9uCgkJCW1hdGNoZXJJbiA9IHByZUZpbHRlciAmJiAoIHNlZWQgfHwgIXNlbGVjdG9yICkgPwoJCQkJY29uZGVuc2UoIGVsZW1zLCBwcmVNYXAsIHByZUZpbHRlciwgY29udGV4dCwgeG1sICkgOgoJCQkJZWxlbXMsCgoJCQltYXRjaGVyT3V0ID0gbWF0Y2hlciA/CgkJCQkvLyBJZiB3ZSBoYXZlIGEgcG9zdEZpbmRlciwgb3IgZmlsdGVyZWQgc2VlZCwgb3Igbm9uLXNlZWQgcG9zdEZpbHRlciBvciBwcmVleGlzdGluZyByZXN1bHRzLAoJCQkJcG9zdEZpbmRlciB8fCAoIHNlZWQgPyBwcmVGaWx0ZXIgOiBwcmVleGlzdGluZyB8fCBwb3N0RmlsdGVyICkgPwoKCQkJCQkvLyAuLi5pbnRlcm1lZGlhdGUgcHJvY2Vzc2luZyBpcyBuZWNlc3NhcnkKCQkJCQlbXSA6CgoJCQkJCS8vIC4uLm90aGVyd2lzZSB1c2UgcmVzdWx0cyBkaXJlY3RseQoJCQkJCXJlc3VsdHMgOgoJCQkJbWF0Y2hlckluOwoKCQkvLyBGaW5kIHByaW1hcnkgbWF0Y2hlcwoJCWlmICggbWF0Y2hlciApIHsKCQkJbWF0Y2hlciggbWF0Y2hlckluLCBtYXRjaGVyT3V0LCBjb250ZXh0LCB4bWwgKTsKCQl9CgoJCS8vIEFwcGx5IHBvc3RGaWx0ZXIKCQlpZiAoIHBvc3RGaWx0ZXIgKSB7CgkJCXRlbXAgPSBjb25kZW5zZSggbWF0Y2hlck91dCwgcG9zdE1hcCApOwoJCQlwb3N0RmlsdGVyKCB0ZW1wLCBbXSwgY29udGV4dCwgeG1sICk7CgoJCQkvLyBVbi1tYXRjaCBmYWlsaW5nIGVsZW1lbnRzIGJ5IG1vdmluZyB0aGVtIGJhY2sgdG8gbWF0Y2hlckluCgkJCWkgPSB0ZW1wLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoIChlbGVtID0gdGVtcFtpXSkgKSB7CgkJCQkJbWF0Y2hlck91dFsgcG9zdE1hcFtpXSBdID0gIShtYXRjaGVySW5bIHBvc3RNYXBbaV0gXSA9IGVsZW0pOwoJCQkJfQoJCQl9CgkJfQoKCQlpZiAoIHNlZWQgKSB7CgkJCWlmICggcG9zdEZpbmRlciB8fCBwcmVGaWx0ZXIgKSB7CgkJCQlpZiAoIHBvc3RGaW5kZXIgKSB7CgkJCQkJLy8gR2V0IHRoZSBmaW5hbCBtYXRjaGVyT3V0IGJ5IGNvbmRlbnNpbmcgdGhpcyBpbnRlcm1lZGlhdGUgaW50byBwb3N0RmluZGVyIGNvbnRleHRzCgkJCQkJdGVtcCA9IFtdOwoJCQkJCWkgPSBtYXRjaGVyT3V0Lmxlbmd0aDsKCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJaWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICkgewoJCQkJCQkJLy8gUmVzdG9yZSBtYXRjaGVySW4gc2luY2UgZWxlbSBpcyBub3QgeWV0IGEgZmluYWwgbWF0Y2gKCQkJCQkJCXRlbXAucHVzaCggKG1hdGNoZXJJbltpXSA9IGVsZW0pICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcG9zdEZpbmRlciggbnVsbCwgKG1hdGNoZXJPdXQgPSBbXSksIHRlbXAsIHhtbCApOwoJCQkJfQoKCQkJCS8vIE1vdmUgbWF0Y2hlZCBlbGVtZW50cyBmcm9tIHNlZWQgdG8gcmVzdWx0cyB0byBrZWVwIHRoZW0gc3luY2hyb25pemVkCgkJCQlpID0gbWF0Y2hlck91dC5sZW5ndGg7CgkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQlpZiAoIChlbGVtID0gbWF0Y2hlck91dFtpXSkgJiYKCQkJCQkJKHRlbXAgPSBwb3N0RmluZGVyID8gaW5kZXhPZi5jYWxsKCBzZWVkLCBlbGVtICkgOiBwcmVNYXBbaV0pID4gLTEgKSB7CgoJCQkJCQlzZWVkW3RlbXBdID0gIShyZXN1bHRzW3RlbXBdID0gZWxlbSk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIEFkZCBlbGVtZW50cyB0byByZXN1bHRzLCB0aHJvdWdoIHBvc3RGaW5kZXIgaWYgZGVmaW5lZAoJCX0gZWxzZSB7CgkJCW1hdGNoZXJPdXQgPSBjb25kZW5zZSgKCQkJCW1hdGNoZXJPdXQgPT09IHJlc3VsdHMgPwoJCQkJCW1hdGNoZXJPdXQuc3BsaWNlKCBwcmVleGlzdGluZywgbWF0Y2hlck91dC5sZW5ndGggKSA6CgkJCQkJbWF0Y2hlck91dAoJCQkpOwoJCQlpZiAoIHBvc3RGaW5kZXIgKSB7CgkJCQlwb3N0RmluZGVyKCBudWxsLCByZXN1bHRzLCBtYXRjaGVyT3V0LCB4bWwgKTsKCQkJfSBlbHNlIHsKCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIG1hdGNoZXJPdXQgKTsKCQkJfQoJCX0KCX0pOwp9CgpmdW5jdGlvbiBtYXRjaGVyRnJvbVRva2VucyggdG9rZW5zICkgewoJdmFyIGNoZWNrQ29udGV4dCwgbWF0Y2hlciwgaiwKCQlsZW4gPSB0b2tlbnMubGVuZ3RoLAoJCWxlYWRpbmdSZWxhdGl2ZSA9IEV4cHIucmVsYXRpdmVbIHRva2Vuc1swXS50eXBlIF0sCgkJaW1wbGljaXRSZWxhdGl2ZSA9IGxlYWRpbmdSZWxhdGl2ZSB8fCBFeHByLnJlbGF0aXZlWyIgIl0sCgkJaSA9IGxlYWRpbmdSZWxhdGl2ZSA/IDEgOiAwLAoKCQkvLyBUaGUgZm91bmRhdGlvbmFsIG1hdGNoZXIgZW5zdXJlcyB0aGF0IGVsZW1lbnRzIGFyZSByZWFjaGFibGUgZnJvbSB0b3AtbGV2ZWwgY29udGV4dChzKQoJCW1hdGNoQ29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gY2hlY2tDb250ZXh0OwoJCX0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUgKSwKCQltYXRjaEFueUNvbnRleHQgPSBhZGRDb21iaW5hdG9yKCBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGluZGV4T2YuY2FsbCggY2hlY2tDb250ZXh0LCBlbGVtICkgPiAtMTsKCQl9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksCgkJbWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXJldHVybiAoICFsZWFkaW5nUmVsYXRpdmUgJiYgKCB4bWwgfHwgY29udGV4dCAhPT0gb3V0ZXJtb3N0Q29udGV4dCApICkgfHwgKAoJCQkJKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8KCQkJCQltYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDoKCQkJCQltYXRjaEFueUNvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApICk7CgkJfSBdOwoKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCWlmICggKG1hdGNoZXIgPSBFeHByLnJlbGF0aXZlWyB0b2tlbnNbaV0udHlwZSBdKSApIHsKCQkJbWF0Y2hlcnMgPSBbIGFkZENvbWJpbmF0b3IoZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICksIG1hdGNoZXIpIF07CgkJfSBlbHNlIHsKCQkJbWF0Y2hlciA9IEV4cHIuZmlsdGVyWyB0b2tlbnNbaV0udHlwZSBdLmFwcGx5KCBudWxsLCB0b2tlbnNbaV0ubWF0Y2hlcyApOwoKCQkJLy8gUmV0dXJuIHNwZWNpYWwgdXBvbiBzZWVpbmcgYSBwb3NpdGlvbmFsIG1hdGNoZXIKCQkJaWYgKCBtYXRjaGVyWyBleHBhbmRvIF0gKSB7CgkJCQkvLyBGaW5kIHRoZSBuZXh0IHJlbGF0aXZlIG9wZXJhdG9yIChpZiBhbnkpIGZvciBwcm9wZXIgaGFuZGxpbmcKCQkJCWogPSArK2k7CgkJCQlmb3IgKCA7IGogPCBsZW47IGorKyApIHsKCQkJCQlpZiAoIEV4cHIucmVsYXRpdmVbIHRva2Vuc1tqXS50eXBlIF0gKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiBzZXRNYXRjaGVyKAoJCQkJCWkgPiAxICYmIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLAoJCQkJCWkgPiAxICYmIHRvU2VsZWN0b3IoIHRva2Vucy5zbGljZSggMCwgaSAtIDEgKSApLnJlcGxhY2UoIHJ0cmltLCAiJDEiICksCgkJCQkJbWF0Y2hlciwKCQkJCQlpIDwgaiAmJiBtYXRjaGVyRnJvbVRva2VucyggdG9rZW5zLnNsaWNlKCBpLCBqICkgKSwKCQkJCQlqIDwgbGVuICYmIG1hdGNoZXJGcm9tVG9rZW5zKCAodG9rZW5zID0gdG9rZW5zLnNsaWNlKCBqICkpICksCgkJCQkJaiA8IGxlbiAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKQoJCQkJKTsKCQkJfQoJCQltYXRjaGVycy5wdXNoKCBtYXRjaGVyICk7CgkJfQoJfQoKCXJldHVybiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKTsKfQoKZnVuY3Rpb24gbWF0Y2hlckZyb21Hcm91cE1hdGNoZXJzKCBlbGVtZW50TWF0Y2hlcnMsIHNldE1hdGNoZXJzICkgewoJLy8gQSBjb3VudGVyIHRvIHNwZWNpZnkgd2hpY2ggZWxlbWVudCBpcyBjdXJyZW50bHkgYmVpbmcgbWF0Y2hlZAoJdmFyIG1hdGNoZXJDYWNoZWRSdW5zID0gMCwKCQlieVNldCA9IHNldE1hdGNoZXJzLmxlbmd0aCA+IDAsCgkJYnlFbGVtZW50ID0gZWxlbWVudE1hdGNoZXJzLmxlbmd0aCA+IDAsCgkJc3VwZXJNYXRjaGVyID0gZnVuY3Rpb24oIHNlZWQsIGNvbnRleHQsIHhtbCwgcmVzdWx0cywgZXhwYW5kQ29udGV4dCApIHsKCQkJdmFyIGVsZW0sIGosIG1hdGNoZXIsCgkJCQlzZXRNYXRjaGVkID0gW10sCgkJCQltYXRjaGVkQ291bnQgPSAwLAoJCQkJaSA9ICIwIiwKCQkJCXVubWF0Y2hlZCA9IHNlZWQgJiYgW10sCgkJCQlvdXRlcm1vc3QgPSBleHBhbmRDb250ZXh0ICE9IG51bGwsCgkJCQljb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCwKCQkJCS8vIFdlIG11c3QgYWx3YXlzIGhhdmUgZWl0aGVyIHNlZWQgZWxlbWVudHMgb3IgY29udGV4dAoJCQkJZWxlbXMgPSBzZWVkIHx8IGJ5RWxlbWVudCAmJiBFeHByLmZpbmRbIlRBRyJdKCAiKiIsIGV4cGFuZENvbnRleHQgJiYgY29udGV4dC5wYXJlbnROb2RlIHx8IGNvbnRleHQgKSwKCQkJCS8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyCgkJCQlkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKTsKCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgIT09IGRvY3VtZW50ICYmIGNvbnRleHQ7CgkJCQljYWNoZWRydW5zID0gbWF0Y2hlckNhY2hlZFJ1bnM7CgkJCX0KCgkJCS8vIEFkZCBlbGVtZW50cyBwYXNzaW5nIGVsZW1lbnRNYXRjaGVycyBkaXJlY3RseSB0byByZXN1bHRzCgkJCS8vIEtlZXAgYGlgIGEgc3RyaW5nIGlmIHRoZXJlIGFyZSBubyBlbGVtZW50cyBzbyBgbWF0Y2hlZENvdW50YCB3aWxsIGJlICIwMCIgYmVsb3cKCQkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCQlpZiAoIGJ5RWxlbWVudCAmJiBlbGVtICkgewoJCQkJCWogPSAwOwoJCQkJCXdoaWxlICggKG1hdGNoZXIgPSBlbGVtZW50TWF0Y2hlcnNbaisrXSkgKSB7CgkJCQkJCWlmICggbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQkJCQlyZXN1bHRzLnB1c2goIGVsZW0gKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJCQlkaXJydW5zID0gZGlycnVuc1VuaXF1ZTsKCQkJCQkJY2FjaGVkcnVucyA9ICsrbWF0Y2hlckNhY2hlZFJ1bnM7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIFRyYWNrIHVubWF0Y2hlZCBlbGVtZW50cyBmb3Igc2V0IGZpbHRlcnMKCQkJCWlmICggYnlTZXQgKSB7CgkJCQkJLy8gVGhleSB3aWxsIGhhdmUgZ29uZSB0aHJvdWdoIGFsbCBwb3NzaWJsZSBtYXRjaGVycwoJCQkJCWlmICggKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSApIHsKCQkJCQkJbWF0Y2hlZENvdW50LS07CgkJCQkJfQoKCQkJCQkvLyBMZW5ndGhlbiB0aGUgYXJyYXkgZm9yIGV2ZXJ5IGVsZW1lbnQsIG1hdGNoZWQgb3Igbm90CgkJCQkJaWYgKCBzZWVkICkgewoJCQkJCQl1bm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCgkJCW1hdGNoZWRDb3VudCArPSBpOwoJCQlpZiAoIGJ5U2V0ICYmIGkgIT09IG1hdGNoZWRDb3VudCApIHsKCQkJCWogPSAwOwoJCQkJd2hpbGUgKCAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pICkgewoJCQkJCW1hdGNoZXIoIHVubWF0Y2hlZCwgc2V0TWF0Y2hlZCwgY29udGV4dCwgeG1sICk7CgkJCQl9CgoJCQkJaWYgKCBzZWVkICkgewoJCQkJCS8vIFJlaW50ZWdyYXRlIGVsZW1lbnQgbWF0Y2hlcyB0byBlbGltaW5hdGUgdGhlIG5lZWQgZm9yIHNvcnRpbmcKCQkJCQlpZiAoIG1hdGNoZWRDb3VudCA+IDAgKSB7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWYgKCAhKHVubWF0Y2hlZFtpXSB8fCBzZXRNYXRjaGVkW2ldKSApIHsKCQkJCQkJCQlzZXRNYXRjaGVkW2ldID0gcG9wLmNhbGwoIHJlc3VsdHMgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gRGlzY2FyZCBpbmRleCBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gZ2V0IG9ubHkgYWN0dWFsIG1hdGNoZXMKCQkJCQlzZXRNYXRjaGVkID0gY29uZGVuc2UoIHNldE1hdGNoZWQgKTsKCQkJCX0KCgkJCQkvLyBBZGQgbWF0Y2hlcyB0byByZXN1bHRzCgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzZXRNYXRjaGVkICk7CgoJCQkJLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nCgkJCQlpZiAoIG91dGVybW9zdCAmJiAhc2VlZCAmJiBzZXRNYXRjaGVkLmxlbmd0aCA+IDAgJiYKCQkJCQkoIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCApID4gMSApIHsKCgkJCQkJU2l6emxlLnVuaXF1ZVNvcnQoIHJlc3VsdHMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gT3ZlcnJpZGUgbWFuaXB1bGF0aW9uIG9mIGdsb2JhbHMgYnkgbmVzdGVkIG1hdGNoZXJzCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQlvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDsKCQkJfQoKCQkJcmV0dXJuIHVubWF0Y2hlZDsKCQl9OwoKCXJldHVybiBieVNldCA/CgkJbWFya0Z1bmN0aW9uKCBzdXBlck1hdGNoZXIgKSA6CgkJc3VwZXJNYXRjaGVyOwp9Cgpjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGdyb3VwIC8qIEludGVybmFsIFVzZSBPbmx5ICovICkgewoJdmFyIGksCgkJc2V0TWF0Y2hlcnMgPSBbXSwKCQllbGVtZW50TWF0Y2hlcnMgPSBbXSwKCQljYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggIWNhY2hlZCApIHsKCQkvLyBHZW5lcmF0ZSBhIGZ1bmN0aW9uIG9mIHJlY3Vyc2l2ZSBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayBlYWNoIGVsZW1lbnQKCQlpZiAoICFncm91cCApIHsKCQkJZ3JvdXAgPSB0b2tlbml6ZSggc2VsZWN0b3IgKTsKCQl9CgkJaSA9IGdyb3VwLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJY2FjaGVkID0gbWF0Y2hlckZyb21Ub2tlbnMoIGdyb3VwW2ldICk7CgkJCWlmICggY2FjaGVkWyBleHBhbmRvIF0gKSB7CgkJCQlzZXRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfSBlbHNlIHsKCQkJCWVsZW1lbnRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfQoJCX0KCgkJLy8gQ2FjaGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uCgkJY2FjaGVkID0gY29tcGlsZXJDYWNoZSggc2VsZWN0b3IsIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApICk7Cgl9CglyZXR1cm4gY2FjaGVkOwp9OwoKZnVuY3Rpb24gbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IsIGNvbnRleHRzLCByZXN1bHRzICkgewoJdmFyIGkgPSAwLAoJCWxlbiA9IGNvbnRleHRzLmxlbmd0aDsKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCVNpenpsZSggc2VsZWN0b3IsIGNvbnRleHRzW2ldLCByZXN1bHRzICk7Cgl9CglyZXR1cm4gcmVzdWx0czsKfQoKZnVuY3Rpb24gc2VsZWN0KCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHsKCXZhciBpLCB0b2tlbnMsIHRva2VuLCB0eXBlLCBmaW5kLAoJCW1hdGNoID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJaWYgKCAhc2VlZCApIHsKCQkvLyBUcnkgdG8gbWluaW1pemUgb3BlcmF0aW9ucyBpZiB0aGVyZSBpcyBvbmx5IG9uZSBncm91cAoJCWlmICggbWF0Y2gubGVuZ3RoID09PSAxICkgewoKCQkJLy8gVGFrZSBhIHNob3J0Y3V0IGFuZCBzZXQgdGhlIGNvbnRleHQgaWYgdGhlIHJvb3Qgc2VsZWN0b3IgaXMgYW4gSUQKCQkJdG9rZW5zID0gbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSggMCApOwoJCQlpZiAoIHRva2Vucy5sZW5ndGggPiAyICYmICh0b2tlbiA9IHRva2Vuc1swXSkudHlwZSA9PT0gIklEIiAmJgoJCQkJCWNvbnRleHQubm9kZVR5cGUgPT09IDkgJiYgIWRvY3VtZW50SXNYTUwgJiYKCQkJCQlFeHByLnJlbGF0aXZlWyB0b2tlbnNbMV0udHlwZSBdICkgewoKCQkJCWNvbnRleHQgPSBFeHByLmZpbmRbIklEIl0oIHRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKSwgY29udGV4dCApWzBdOwoJCQkJaWYgKCAhY29udGV4dCApIHsKCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCX0KCgkJCQlzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKCB0b2tlbnMuc2hpZnQoKS52YWx1ZS5sZW5ndGggKTsKCQkJfQoKCQkJLy8gRmV0Y2ggYSBzZWVkIHNldCBmb3IgcmlnaHQtdG8tbGVmdCBtYXRjaGluZwoJCQlpID0gbWF0Y2hFeHByWyJuZWVkc0NvbnRleHQiXS50ZXN0KCBzZWxlY3RvciApID8gMCA6IHRva2Vucy5sZW5ndGg7CgkJCXdoaWxlICggaS0tICkgewoJCQkJdG9rZW4gPSB0b2tlbnNbaV07CgoJCQkJLy8gQWJvcnQgaWYgd2UgaGl0IGEgY29tYmluYXRvcgoJCQkJaWYgKCBFeHByLnJlbGF0aXZlWyAodHlwZSA9IHRva2VuLnR5cGUpIF0gKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQlpZiAoIChmaW5kID0gRXhwci5maW5kWyB0eXBlIF0pICkgewoJCQkJCS8vIFNlYXJjaCwgZXhwYW5kaW5nIGNvbnRleHQgZm9yIGxlYWRpbmcgc2libGluZyBjb21iaW5hdG9ycwoJCQkJCWlmICggKHNlZWQgPSBmaW5kKAoJCQkJCQl0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICksCgkJCQkJCXJzaWJsaW5nLnRlc3QoIHRva2Vuc1swXS50eXBlICkgJiYgY29udGV4dC5wYXJlbnROb2RlIHx8IGNvbnRleHQKCQkJCQkpKSApIHsKCgkJCQkJCS8vIElmIHNlZWQgaXMgZW1wdHkgb3Igbm8gdG9rZW5zIHJlbWFpbiwgd2UgY2FuIHJldHVybiBlYXJseQoJCQkJCQl0b2tlbnMuc3BsaWNlKCBpLCAxICk7CgkJCQkJCXNlbGVjdG9yID0gc2VlZC5sZW5ndGggJiYgdG9TZWxlY3RvciggdG9rZW5zICk7CgkJCQkJCWlmICggIXNlbGVjdG9yICkgewoJCQkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2xpY2UuY2FsbCggc2VlZCwgMCApICk7CgkJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQkJfQoKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoKCS8vIENvbXBpbGUgYW5kIGV4ZWN1dGUgYSBmaWx0ZXJpbmcgZnVuY3Rpb24KCS8vIFByb3ZpZGUgYG1hdGNoYCB0byBhdm9pZCByZXRva2VuaXphdGlvbiBpZiB3ZSBtb2RpZmllZCB0aGUgc2VsZWN0b3IgYWJvdmUKCWNvbXBpbGUoIHNlbGVjdG9yLCBtYXRjaCApKAoJCXNlZWQsCgkJY29udGV4dCwKCQlkb2N1bWVudElzWE1MLAoJCXJlc3VsdHMsCgkJcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKQoJKTsKCXJldHVybiByZXN1bHRzOwp9CgovLyBEZXByZWNhdGVkCkV4cHIucHNldWRvc1sibnRoIl0gPSBFeHByLnBzZXVkb3NbImVxIl07CgovLyBFYXN5IEFQSSBmb3IgY3JlYXRpbmcgbmV3IHNldEZpbHRlcnMKZnVuY3Rpb24gc2V0RmlsdGVycygpIHt9CkV4cHIuZmlsdGVycyA9IHNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5wc2V1ZG9zOwpFeHByLnNldEZpbHRlcnMgPSBuZXcgc2V0RmlsdGVycygpOwoKLy8gSW5pdGlhbGl6ZSB3aXRoIHRoZSBkZWZhdWx0IGRvY3VtZW50CnNldERvY3VtZW50KCk7CgovLyBPdmVycmlkZSBzaXp6bGUgYXR0cmlidXRlIHJldHJpZXZhbApTaXp6bGUuYXR0ciA9IGpRdWVyeS5hdHRyOwpqUXVlcnkuZmluZCA9IFNpenpsZTsKalF1ZXJ5LmV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzOwpqUXVlcnkuZXhwclsiOiJdID0galF1ZXJ5LmV4cHIucHNldWRvczsKalF1ZXJ5LnVuaXF1ZSA9IFNpenpsZS51bmlxdWVTb3J0OwpqUXVlcnkudGV4dCA9IFNpenpsZS5nZXRUZXh0OwpqUXVlcnkuaXNYTUxEb2MgPSBTaXp6bGUuaXNYTUw7CmpRdWVyeS5jb250YWlucyA9IFNpenpsZS5jb250YWluczsKCgp9KSggd2luZG93ICk7CnZhciBydW50aWwgPSAvVW50aWwkLywKCXJwYXJlbnRzcHJldiA9IC9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLAoJaXNTaW1wbGUgPSAvXi5bXjojXFtcLixdKiQvLAoJcm5lZWRzQ29udGV4dCA9IGpRdWVyeS5leHByLm1hdGNoLm5lZWRzQ29udGV4dCwKCS8vIG1ldGhvZHMgZ3VhcmFudGVlZCB0byBwcm9kdWNlIGEgdW5pcXVlIHNldCB3aGVuIHN0YXJ0aW5nIGZyb20gYSB1bmlxdWUgc2V0CglndWFyYW50ZWVkVW5pcXVlID0gewoJCWNoaWxkcmVuOiB0cnVlLAoJCWNvbnRlbnRzOiB0cnVlLAoJCW5leHQ6IHRydWUsCgkJcHJldjogdHJ1ZQoJfTsKCmpRdWVyeS5mbi5leHRlbmQoewoJZmluZDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBpLCByZXQsIHNlbGYsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIgKSB7CgkJCXNlbGYgPSB0aGlzOwoJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeSggc2VsZWN0b3IgKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9KSApOwoJCX0KCgkJcmV0ID0gW107CgkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJalF1ZXJ5LmZpbmQoIHNlbGVjdG9yLCB0aGlzWyBpIF0sIHJldCApOwoJCX0KCgkJLy8gTmVlZGVkIGJlY2F1c2UgJCggc2VsZWN0b3IsIGNvbnRleHQgKSBiZWNvbWVzICQoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApCgkJcmV0ID0gdGhpcy5wdXNoU3RhY2soIGxlbiA+IDEgPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldCApOwoJCXJldC5zZWxlY3RvciA9ICggdGhpcy5zZWxlY3RvciA/IHRoaXMuc2VsZWN0b3IgKyAiICIgOiAiIiApICsgc2VsZWN0b3I7CgkJcmV0dXJuIHJldDsKCX0sCgoJaGFzOiBmdW5jdGlvbiggdGFyZ2V0ICkgewoJCXZhciBpLAoJCQl0YXJnZXRzID0galF1ZXJ5KCB0YXJnZXQsIHRoaXMgKSwKCQkJbGVuID0gdGFyZ2V0cy5sZW5ndGg7CgoJCXJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCB0aGlzLCB0YXJnZXRzW2ldICkgKSB7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQl9KTsKCX0sCgoJbm90OiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCB3aW5ub3codGhpcywgc2VsZWN0b3IsIGZhbHNlKSApOwoJfSwKCglmaWx0ZXI6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyh0aGlzLCBzZWxlY3RvciwgdHJ1ZSkgKTsKCX0sCgoJaXM6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gISFzZWxlY3RvciAmJiAoCgkJCXR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgPwoJCQkJLy8gSWYgdGhpcyBpcyBhIHBvc2l0aW9uYWwvcmVsYXRpdmUgc2VsZWN0b3IsIGNoZWNrIG1lbWJlcnNoaXAgaW4gdGhlIHJldHVybmVkIHNldAoJCQkJLy8gc28gJCgicDpmaXJzdCIpLmlzKCJwOmxhc3QiKSB3b24ndCByZXR1cm4gdHJ1ZSBmb3IgYSBkb2Mgd2l0aCB0d28gInAiLgoJCQkJcm5lZWRzQ29udGV4dC50ZXN0KCBzZWxlY3RvciApID8KCQkJCQlqUXVlcnkoIHNlbGVjdG9yLCB0aGlzLmNvbnRleHQgKS5pbmRleCggdGhpc1swXSApID49IDAgOgoJCQkJCWpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCB0aGlzICkubGVuZ3RoID4gMCA6CgkJCQl0aGlzLmZpbHRlciggc2VsZWN0b3IgKS5sZW5ndGggPiAwICk7Cgl9LAoKCWNsb3Nlc3Q6IGZ1bmN0aW9uKCBzZWxlY3RvcnMsIGNvbnRleHQgKSB7CgkJdmFyIGN1ciwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aCwKCQkJcmV0ID0gW10sCgkJCXBvcyA9IHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3JzICkgfHwgdHlwZW9mIHNlbGVjdG9ycyAhPT0gInN0cmluZyIgPwoJCQkJalF1ZXJ5KCBzZWxlY3RvcnMsIGNvbnRleHQgfHwgdGhpcy5jb250ZXh0ICkgOgoJCQkJMDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQljdXIgPSB0aGlzW2ldOwoKCQkJd2hpbGUgKCBjdXIgJiYgY3VyLm93bmVyRG9jdW1lbnQgJiYgY3VyICE9PSBjb250ZXh0ICYmIGN1ci5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQlpZiAoIHBvcyA/IHBvcy5pbmRleChjdXIpID4gLTEgOiBqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoY3VyLCBzZWxlY3RvcnMpICkgewoJCQkJCXJldC5wdXNoKCBjdXIgKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWN1ciA9IGN1ci5wYXJlbnROb2RlOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldC5sZW5ndGggPiAxID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQgKTsKCX0sCgoJLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpbgoJLy8gdGhlIG1hdGNoZWQgc2V0IG9mIGVsZW1lbnRzCglpbmRleDogZnVuY3Rpb24oIGVsZW0gKSB7CgoJCS8vIE5vIGFyZ3VtZW50LCByZXR1cm4gaW5kZXggaW4gcGFyZW50CgkJaWYgKCAhZWxlbSApIHsKCQkJcmV0dXJuICggdGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUgKSA/IHRoaXMuZmlyc3QoKS5wcmV2QWxsKCkubGVuZ3RoIDogLTE7CgkJfQoKCQkvLyBpbmRleCBpbiBzZWxlY3RvcgoJCWlmICggdHlwZW9mIGVsZW0gPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoIHRoaXNbMF0sIGpRdWVyeSggZWxlbSApICk7CgkJfQoKCQkvLyBMb2NhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBkZXNpcmVkIGVsZW1lbnQKCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoCgkJCS8vIElmIGl0IHJlY2VpdmVzIGEgalF1ZXJ5IG9iamVjdCwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdXNlZAoJCQllbGVtLmpxdWVyeSA/IGVsZW1bMF0gOiBlbGVtLCB0aGlzICk7Cgl9LAoKCWFkZDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCXZhciBzZXQgPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciID8KCQkJCWpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSA6CgkJCQlqUXVlcnkubWFrZUFycmF5KCBzZWxlY3RvciAmJiBzZWxlY3Rvci5ub2RlVHlwZSA/IFsgc2VsZWN0b3IgXSA6IHNlbGVjdG9yICksCgkJCWFsbCA9IGpRdWVyeS5tZXJnZSggdGhpcy5nZXQoKSwgc2V0ICk7CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggalF1ZXJ5LnVuaXF1ZShhbGwpICk7Cgl9LAoKCWFkZEJhY2s6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5hZGQoIHNlbGVjdG9yID09IG51bGwgPwoJCQl0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKHNlbGVjdG9yKQoJCSk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmFuZFNlbGYgPSBqUXVlcnkuZm4uYWRkQmFjazsKCmZ1bmN0aW9uIHNpYmxpbmcoIGN1ciwgZGlyICkgewoJZG8gewoJCWN1ciA9IGN1clsgZGlyIF07Cgl9IHdoaWxlICggY3VyICYmIGN1ci5ub2RlVHlwZSAhPT0gMSApOwoKCXJldHVybiBjdXI7Cn0KCmpRdWVyeS5lYWNoKHsKCXBhcmVudDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZTsKCQlyZXR1cm4gcGFyZW50ICYmIHBhcmVudC5ub2RlVHlwZSAhPT0gMTEgPyBwYXJlbnQgOiBudWxsOwoJfSwKCXBhcmVudHM6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAicGFyZW50Tm9kZSIgKTsKCX0sCglwYXJlbnRzVW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInBhcmVudE5vZGUiLCB1bnRpbCApOwoJfSwKCW5leHQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBzaWJsaW5nKCBlbGVtLCAibmV4dFNpYmxpbmciICk7Cgl9LAoJcHJldjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIHNpYmxpbmcoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7Cgl9LAoJbmV4dEFsbDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJuZXh0U2libGluZyIgKTsKCX0sCglwcmV2QWxsOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInByZXZpb3VzU2libGluZyIgKTsKCX0sCgluZXh0VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgIm5leHRTaWJsaW5nIiwgdW50aWwgKTsKCX0sCglwcmV2VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInByZXZpb3VzU2libGluZyIsIHVudGlsICk7Cgl9LAoJc2libGluZ3M6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuc2libGluZyggKCBlbGVtLnBhcmVudE5vZGUgfHwge30gKS5maXJzdENoaWxkLCBlbGVtICk7Cgl9LAoJY2hpbGRyZW46IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuc2libGluZyggZWxlbS5maXJzdENoaWxkICk7Cgl9LAoJY29udGVudHM6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpZnJhbWUiICkgPwoJCQllbGVtLmNvbnRlbnREb2N1bWVudCB8fCBlbGVtLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQgOgoJCQlqUXVlcnkubWVyZ2UoIFtdLCBlbGVtLmNoaWxkTm9kZXMgKTsKCX0KfSwgZnVuY3Rpb24oIG5hbWUsIGZuICkgewoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggdW50aWwsIHNlbGVjdG9yICkgewoJCXZhciByZXQgPSBqUXVlcnkubWFwKCB0aGlzLCBmbiwgdW50aWwgKTsKCgkJaWYgKCAhcnVudGlsLnRlc3QoIG5hbWUgKSApIHsKCQkJc2VsZWN0b3IgPSB1bnRpbDsKCQl9CgoJCWlmICggc2VsZWN0b3IgJiYgdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJcmV0ID0galF1ZXJ5LmZpbHRlciggc2VsZWN0b3IsIHJldCApOwoJCX0KCgkJcmV0ID0gdGhpcy5sZW5ndGggPiAxICYmICFndWFyYW50ZWVkVW5pcXVlWyBuYW1lIF0gPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldDsKCgkJaWYgKCB0aGlzLmxlbmd0aCA+IDEgJiYgcnBhcmVudHNwcmV2LnRlc3QoIG5hbWUgKSApIHsKCQkJcmV0ID0gcmV0LnJldmVyc2UoKTsKCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7Cgl9Owp9KTsKCmpRdWVyeS5leHRlbmQoewoJZmlsdGVyOiBmdW5jdGlvbiggZXhwciwgZWxlbXMsIG5vdCApIHsKCQlpZiAoIG5vdCApIHsKCQkJZXhwciA9ICI6bm90KCIgKyBleHByICsgIikiOwoJCX0KCgkJcmV0dXJuIGVsZW1zLmxlbmd0aCA9PT0gMSA/CgkJCWpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihlbGVtc1swXSwgZXhwcikgPyBbIGVsZW1zWzBdIF0gOiBbXSA6CgkJCWpRdWVyeS5maW5kLm1hdGNoZXMoZXhwciwgZWxlbXMpOwoJfSwKCglkaXI6IGZ1bmN0aW9uKCBlbGVtLCBkaXIsIHVudGlsICkgewoJCXZhciBtYXRjaGVkID0gW10sCgkJCWN1ciA9IGVsZW1bIGRpciBdOwoKCQl3aGlsZSAoIGN1ciAmJiBjdXIubm9kZVR5cGUgIT09IDkgJiYgKHVudGlsID09PSB1bmRlZmluZWQgfHwgY3VyLm5vZGVUeXBlICE9PSAxIHx8ICFqUXVlcnkoIGN1ciApLmlzKCB1bnRpbCApKSApIHsKCQkJaWYgKCBjdXIubm9kZVR5cGUgPT09IDEgKSB7CgkJCQltYXRjaGVkLnB1c2goIGN1ciApOwoJCQl9CgkJCWN1ciA9IGN1cltkaXJdOwoJCX0KCQlyZXR1cm4gbWF0Y2hlZDsKCX0sCgoJc2libGluZzogZnVuY3Rpb24oIG4sIGVsZW0gKSB7CgkJdmFyIHIgPSBbXTsKCgkJZm9yICggOyBuOyBuID0gbi5uZXh0U2libGluZyApIHsKCQkJaWYgKCBuLm5vZGVUeXBlID09PSAxICYmIG4gIT09IGVsZW0gKSB7CgkJCQlyLnB1c2goIG4gKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHI7Cgl9Cn0pOwoKLy8gSW1wbGVtZW50IHRoZSBpZGVudGljYWwgZnVuY3Rpb25hbGl0eSBmb3IgZmlsdGVyIGFuZCBub3QKZnVuY3Rpb24gd2lubm93KCBlbGVtZW50cywgcXVhbGlmaWVyLCBrZWVwICkgewoKCS8vIENhbid0IHBhc3MgbnVsbCBvciB1bmRlZmluZWQgdG8gaW5kZXhPZiBpbiBGaXJlZm94IDQKCS8vIFNldCB0byAwIHRvIHNraXAgc3RyaW5nIGNoZWNrCglxdWFsaWZpZXIgPSBxdWFsaWZpZXIgfHwgMDsKCglpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBxdWFsaWZpZXIgKSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQl2YXIgcmV0VmFsID0gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCQlyZXR1cm4gcmV0VmFsID09PSBrZWVwOwoJCX0pOwoKCX0gZWxzZSBpZiAoIHF1YWxpZmllci5ub2RlVHlwZSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gKCBlbGVtID09PSBxdWFsaWZpZXIgKSA9PT0ga2VlcDsKCQl9KTsKCgl9IGVsc2UgaWYgKCB0eXBlb2YgcXVhbGlmaWVyID09PSAic3RyaW5nIiApIHsKCQl2YXIgZmlsdGVyZWQgPSBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxOwoJCX0pOwoKCQlpZiAoIGlzU2ltcGxlLnRlc3QoIHF1YWxpZmllciApICkgewoJCQlyZXR1cm4galF1ZXJ5LmZpbHRlcihxdWFsaWZpZXIsIGZpbHRlcmVkLCAha2VlcCk7CgkJfSBlbHNlIHsKCQkJcXVhbGlmaWVyID0galF1ZXJ5LmZpbHRlciggcXVhbGlmaWVyLCBmaWx0ZXJlZCApOwoJCX0KCX0KCglyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiAoIGpRdWVyeS5pbkFycmF5KCBlbGVtLCBxdWFsaWZpZXIgKSA+PSAwICkgPT09IGtlZXA7Cgl9KTsKfQpmdW5jdGlvbiBjcmVhdGVTYWZlRnJhZ21lbnQoIGRvY3VtZW50ICkgewoJdmFyIGxpc3QgPSBub2RlTmFtZXMuc3BsaXQoICJ8IiApLAoJCXNhZmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwoKCWlmICggc2FmZUZyYWcuY3JlYXRlRWxlbWVudCApIHsKCQl3aGlsZSAoIGxpc3QubGVuZ3RoICkgewoJCQlzYWZlRnJhZy5jcmVhdGVFbGVtZW50KAoJCQkJbGlzdC5wb3AoKQoJCQkpOwoJCX0KCX0KCXJldHVybiBzYWZlRnJhZzsKfQoKdmFyIG5vZGVOYW1lcyA9ICJhYmJyfGFydGljbGV8YXNpZGV8YXVkaW98YmRpfGNhbnZhc3xkYXRhfGRhdGFsaXN0fGRldGFpbHN8ZmlnY2FwdGlvbnxmaWd1cmV8Zm9vdGVyfCIgKwoJCSJoZWFkZXJ8aGdyb3VwfG1hcmt8bWV0ZXJ8bmF2fG91dHB1dHxwcm9ncmVzc3xzZWN0aW9ufHN1bW1hcnl8dGltZXx2aWRlbyIsCglyaW5saW5lalF1ZXJ5ID0gLyBqUXVlcnlcZCs9Iig/Om51bGx8XGQrKSIvZywKCXJub3NoaW1jYWNoZSA9IG5ldyBSZWdFeHAoIjwoPzoiICsgbm9kZU5hbWVzICsgIilbXFxzLz5dIiwgImkiKSwKCXJsZWFkaW5nV2hpdGVzcGFjZSA9IC9eXHMrLywKCXJ4aHRtbFRhZyA9IC88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcdzpdKylbXj5dKilcLz4vZ2ksCglydGFnTmFtZSA9IC88KFtcdzpdKykvLAoJcnRib2R5ID0gLzx0Ym9keS9pLAoJcmh0bWwgPSAvPHwmIz9cdys7LywKCXJub0lubmVyaHRtbCA9IC88KD86c2NyaXB0fHN0eWxlfGxpbmspL2ksCgltYW5pcHVsYXRpb25fcmNoZWNrYWJsZVR5cGUgPSAvXig/OmNoZWNrYm94fHJhZGlvKSQvaSwKCS8vIGNoZWNrZWQ9ImNoZWNrZWQiIG9yIGNoZWNrZWQKCXJjaGVja2VkID0gL2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksCglyc2NyaXB0VHlwZSA9IC9eJHxcLyg/OmphdmF8ZWNtYSlzY3JpcHQvaSwKCXJzY3JpcHRUeXBlTWFza2VkID0gL150cnVlXC8oLiopLywKCXJjbGVhblNjcmlwdCA9IC9eXHMqPCEoPzpcW0NEQVRBXFt8LS0pfCg/OlxdXF18LS0pPlxzKiQvZywKCgkvLyBXZSBoYXZlIHRvIGNsb3NlIHRoZXNlIHRhZ3MgdG8gc3VwcG9ydCBYSFRNTCAoIzEzMjAwKQoJd3JhcE1hcCA9IHsKCQlvcHRpb246IFsgMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+IiBdLAoJCWxlZ2VuZDogWyAxLCAiPGZpZWxkc2V0PiIsICI8L2ZpZWxkc2V0PiIgXSwKCQlhcmVhOiBbIDEsICI8bWFwPiIsICI8L21hcD4iIF0sCgkJcGFyYW06IFsgMSwgIjxvYmplY3Q+IiwgIjwvb2JqZWN0PiIgXSwKCQl0aGVhZDogWyAxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiIgXSwKCQl0cjogWyAyLCAiPHRhYmxlPjx0Ym9keT4iLCAiPC90Ym9keT48L3RhYmxlPiIgXSwKCQljb2w6IFsgMiwgIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0sCgkJdGQ6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCgoJCS8vIElFNi04IGNhbid0IHNlcmlhbGl6ZSBsaW5rLCBzY3JpcHQsIHN0eWxlLCBvciBhbnkgaHRtbDUgKE5vU2NvcGUpIHRhZ3MsCgkJLy8gdW5sZXNzIHdyYXBwZWQgaW4gYSBkaXYgd2l0aCBub24tYnJlYWtpbmcgY2hhcmFjdGVycyBpbiBmcm9udCBvZiBpdC4KCQlfZGVmYXVsdDogalF1ZXJ5LnN1cHBvcnQuaHRtbFNlcmlhbGl6ZSA/IFsgMCwgIiIsICIiIF0gOiBbIDEsICJYPGRpdj4iLCAiPC9kaXY+IiAgXQoJfSwKCXNhZmVGcmFnbWVudCA9IGNyZWF0ZVNhZmVGcmFnbWVudCggZG9jdW1lbnQgKSwKCWZyYWdtZW50RGl2ID0gc2FmZUZyYWdtZW50LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSApOwoKd3JhcE1hcC5vcHRncm91cCA9IHdyYXBNYXAub3B0aW9uOwp3cmFwTWFwLnRib2R5ID0gd3JhcE1hcC50Zm9vdCA9IHdyYXBNYXAuY29sZ3JvdXAgPSB3cmFwTWFwLmNhcHRpb24gPSB3cmFwTWFwLnRoZWFkOwp3cmFwTWFwLnRoID0gd3JhcE1hcC50ZDsKCmpRdWVyeS5mbi5leHRlbmQoewoJdGV4dDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8KCQkJCWpRdWVyeS50ZXh0KCB0aGlzICkgOgoJCQkJdGhpcy5lbXB0eSgpLmFwcGVuZCggKCB0aGlzWzBdICYmIHRoaXNbMF0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCApLmNyZWF0ZVRleHROb2RlKCB2YWx1ZSApICk7CgkJfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsKCX0sCgoJd3JhcEFsbDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJCWpRdWVyeSh0aGlzKS53cmFwQWxsKCBodG1sLmNhbGwodGhpcywgaSkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHRoaXNbMF0gKSB7CgkJCS8vIFRoZSBlbGVtZW50cyB0byB3cmFwIHRoZSB0YXJnZXQgYXJvdW5kCgkJCXZhciB3cmFwID0galF1ZXJ5KCBodG1sLCB0aGlzWzBdLm93bmVyRG9jdW1lbnQgKS5lcSgwKS5jbG9uZSh0cnVlKTsKCgkJCWlmICggdGhpc1swXS5wYXJlbnROb2RlICkgewoJCQkJd3JhcC5pbnNlcnRCZWZvcmUoIHRoaXNbMF0gKTsKCQkJfQoKCQkJd3JhcC5tYXAoZnVuY3Rpb24oKSB7CgkJCQl2YXIgZWxlbSA9IHRoaXM7CgoJCQkJd2hpbGUgKCBlbGVtLmZpcnN0Q2hpbGQgJiYgZWxlbS5maXJzdENoaWxkLm5vZGVUeXBlID09PSAxICkgewoJCQkJCWVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7CgkJCQl9CgoJCQkJcmV0dXJuIGVsZW07CgkJCX0pLmFwcGVuZCggdGhpcyApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXdyYXBJbm5lcjogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJCWpRdWVyeSh0aGlzKS53cmFwSW5uZXIoIGh0bWwuY2FsbCh0aGlzLCBpKSApOwoJCQl9KTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBzZWxmID0galF1ZXJ5KCB0aGlzICksCgkJCQljb250ZW50cyA9IHNlbGYuY29udGVudHMoKTsKCgkJCWlmICggY29udGVudHMubGVuZ3RoICkgewoJCQkJY29udGVudHMud3JhcEFsbCggaHRtbCApOwoKCQkJfSBlbHNlIHsKCQkJCXNlbGYuYXBwZW5kKCBodG1sICk7CgkJCX0KCQl9KTsKCX0sCgoJd3JhcDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJdmFyIGlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApOwoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaXNGdW5jdGlvbiA/IGh0bWwuY2FsbCh0aGlzLCBpKSA6IGh0bWwgKTsKCQl9KTsKCX0sCgoJdW53cmFwOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJib2R5IiApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVwbGFjZVdpdGgoIHRoaXMuY2hpbGROb2RlcyApOwoJCQl9CgkJfSkuZW5kKCk7Cgl9LAoKCWFwcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQl0aGlzLmFwcGVuZENoaWxkKCBlbGVtICk7CgkJCX0KCQl9KTsKCX0sCgoJcHJlcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQl0aGlzLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5maXJzdENoaWxkICk7CgkJCX0KCQl9KTsKCX0sCgoJYmVmb3JlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmYWxzZSwgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcyApOwoJCQl9CgkJfSk7Cgl9LAoKCWFmdGVyOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmYWxzZSwgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOwoJCQl9CgkJfSk7Cgl9LAoKCS8vIGtlZXBEYXRhIGlzIGZvciBpbnRlcm5hbCB1c2Ugb25seS0tZG8gbm90IGRvY3VtZW50CglyZW1vdmU6IGZ1bmN0aW9uKCBzZWxlY3Rvciwga2VlcERhdGEgKSB7CgkJdmFyIGVsZW0sCgkJCWkgPSAwOwoKCQlmb3IgKCA7IChlbGVtID0gdGhpc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQlpZiAoICFzZWxlY3RvciB8fCBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgWyBlbGVtIF0gKS5sZW5ndGggPiAwICkgewoJCQkJaWYgKCAha2VlcERhdGEgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0gKSApOwoJCQkJfQoKCQkJCWlmICggZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCWlmICgga2VlcERhdGEgJiYgalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCQkJc2V0R2xvYmFsRXZhbCggZ2V0QWxsKCBlbGVtLCAic2NyaXB0IiApICk7CgkJCQkJfQoJCQkJCWVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZWxlbSApOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZW1wdHk6IGZ1bmN0aW9uKCkgewoJCXZhciBlbGVtLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJLy8gUmVtb3ZlIGVsZW1lbnQgbm9kZXMgYW5kIHByZXZlbnQgbWVtb3J5IGxlYWtzCgkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGdldEFsbCggZWxlbSwgZmFsc2UgKSApOwoJCQl9CgoJCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoJCQl3aGlsZSAoIGVsZW0uZmlyc3RDaGlsZCApIHsKCQkJCWVsZW0ucmVtb3ZlQ2hpbGQoIGVsZW0uZmlyc3RDaGlsZCApOwoJCQl9CgoJCQkvLyBJZiB0aGlzIGlzIGEgc2VsZWN0LCBlbnN1cmUgdGhhdCBpdCBkaXNwbGF5cyBlbXB0eSAoIzEyMzM2KQoJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCWlmICggZWxlbS5vcHRpb25zICYmIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgInNlbGVjdCIgKSApIHsKCQkJCWVsZW0ub3B0aW9ucy5sZW5ndGggPSAwOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQlkYXRhQW5kRXZlbnRzID0gZGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZmFsc2UgOiBkYXRhQW5kRXZlbnRzOwoJCWRlZXBEYXRhQW5kRXZlbnRzID0gZGVlcERhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGRhdGFBbmRFdmVudHMgOiBkZWVwRGF0YUFuZEV2ZW50czsKCgkJcmV0dXJuIHRoaXMubWFwKCBmdW5jdGlvbiAoKSB7CgkJCXJldHVybiBqUXVlcnkuY2xvbmUoIHRoaXMsIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzICk7CgkJfSk7Cgl9LAoKCWh0bWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgZWxlbSA9IHRoaXNbMF0gfHwge30sCgkJCQlpID0gMCwKCQkJCWwgPSB0aGlzLmxlbmd0aDsKCgkJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxID8KCQkJCQllbGVtLmlubmVySFRNTC5yZXBsYWNlKCByaW5saW5lalF1ZXJ5LCAiIiApIDoKCQkJCQl1bmRlZmluZWQ7CgkJCX0KCgkJCS8vIFNlZSBpZiB3ZSBjYW4gdGFrZSBhIHNob3J0Y3V0IGFuZCBqdXN0IHVzZSBpbm5lckhUTUwKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmICFybm9Jbm5lcmh0bWwudGVzdCggdmFsdWUgKSAmJgoJCQkJKCBqUXVlcnkuc3VwcG9ydC5odG1sU2VyaWFsaXplIHx8ICFybm9zaGltY2FjaGUudGVzdCggdmFsdWUgKSAgKSAmJgoJCQkJKCBqUXVlcnkuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSB8fCAhcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIHZhbHVlICkgKSAmJgoJCQkJIXdyYXBNYXBbICggcnRhZ05hbWUuZXhlYyggdmFsdWUgKSB8fCBbIiIsICIiXSApWzFdLnRvTG93ZXJDYXNlKCkgXSApIHsKCgkJCQl2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoIHJ4aHRtbFRhZywgIjwkMT48LyQyPiIgKTsKCgkJCQl0cnkgewoJCQkJCWZvciAoOyBpIDwgbDsgaSsrICkgewoJCQkJCQkvLyBSZW1vdmUgZWxlbWVudCBub2RlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3MKCQkJCQkJZWxlbSA9IHRoaXNbaV0gfHwge307CgkJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGdldEFsbCggZWxlbSwgZmFsc2UgKSApOwoJCQkJCQkJZWxlbS5pbm5lckhUTUwgPSB2YWx1ZTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJZWxlbSA9IDA7CgoJCQkJLy8gSWYgdXNpbmcgaW5uZXJIVE1MIHRocm93cyBhbiBleGNlcHRpb24sIHVzZSB0aGUgZmFsbGJhY2sgbWV0aG9kCgkJCQl9IGNhdGNoKGUpIHt9CgkJCX0KCgkJCWlmICggZWxlbSApIHsKCQkJCXRoaXMuZW1wdHkoKS5hcHBlbmQoIHZhbHVlICk7CgkJCX0KCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCApOwoJfSwKCglyZXBsYWNlV2l0aDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXZhciBpc0Z1bmMgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGVsZW1lbnRzIGFyZSByZW1vdmVkIGZyb20gdGhlIERPTSBiZWZvcmUgdGhleSBhcmUgaW5zZXJ0ZWQKCQkvLyB0aGlzIGNhbiBoZWxwIGZpeCByZXBsYWNpbmcgYSBwYXJlbnQgd2l0aCBjaGlsZCBlbGVtZW50cwoJCWlmICggIWlzRnVuYyAmJiB0eXBlb2YgdmFsdWUgIT09ICJzdHJpbmciICkgewoJCQl2YWx1ZSA9IGpRdWVyeSggdmFsdWUgKS5ub3QoIHRoaXMgKS5kZXRhY2goKTsKCQl9CgoJCXJldHVybiB0aGlzLmRvbU1hbmlwKCBbIHZhbHVlIF0sIHRydWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmV4dCA9IHRoaXMubmV4dFNpYmxpbmcsCgkJCQlwYXJlbnQgPSB0aGlzLnBhcmVudE5vZGU7CgoJCQlpZiAoIHBhcmVudCApIHsKCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZSgpOwoJCQkJcGFyZW50Lmluc2VydEJlZm9yZSggZWxlbSwgbmV4dCApOwoJCQl9CgkJfSk7Cgl9LAoKCWRldGFjaDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0aGlzLnJlbW92ZSggc2VsZWN0b3IsIHRydWUgKTsKCX0sCgoJZG9tTWFuaXA6IGZ1bmN0aW9uKCBhcmdzLCB0YWJsZSwgY2FsbGJhY2sgKSB7CgoJCS8vIEZsYXR0ZW4gYW55IG5lc3RlZCBhcnJheXMKCQlhcmdzID0gY29yZV9jb25jYXQuYXBwbHkoIFtdLCBhcmdzICk7CgoJCXZhciBmaXJzdCwgbm9kZSwgaGFzU2NyaXB0cywKCQkJc2NyaXB0cywgZG9jLCBmcmFnbWVudCwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aCwKCQkJc2V0ID0gdGhpcywKCQkJaU5vQ2xvbmUgPSBsIC0gMSwKCQkJdmFsdWUgPSBhcmdzWzBdLAoJCQlpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICk7CgoJCS8vIFdlIGNhbid0IGNsb25lTm9kZSBmcmFnbWVudHMgdGhhdCBjb250YWluIGNoZWNrZWQsIGluIFdlYktpdAoJCWlmICggaXNGdW5jdGlvbiB8fCAhKCBsIDw9IDEgfHwgdHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIiB8fCBqUXVlcnkuc3VwcG9ydC5jaGVja0Nsb25lIHx8ICFyY2hlY2tlZC50ZXN0KCB2YWx1ZSApICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGluZGV4ICkgewoJCQkJdmFyIHNlbGYgPSBzZXQuZXEoIGluZGV4ICk7CgkJCQlpZiAoIGlzRnVuY3Rpb24gKSB7CgkJCQkJYXJnc1swXSA9IHZhbHVlLmNhbGwoIHRoaXMsIGluZGV4LCB0YWJsZSA/IHNlbGYuaHRtbCgpIDogdW5kZWZpbmVkICk7CgkJCQl9CgkJCQlzZWxmLmRvbU1hbmlwKCBhcmdzLCB0YWJsZSwgY2FsbGJhY2sgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIGwgKSB7CgkJCWZyYWdtZW50ID0galF1ZXJ5LmJ1aWxkRnJhZ21lbnQoIGFyZ3MsIHRoaXNbIDAgXS5vd25lckRvY3VtZW50LCBmYWxzZSwgdGhpcyApOwoJCQlmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgoJCQlpZiAoIGZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICkgewoJCQkJZnJhZ21lbnQgPSBmaXJzdDsKCQkJfQoKCQkJaWYgKCBmaXJzdCApIHsKCQkJCXRhYmxlID0gdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBmaXJzdCwgInRyIiApOwoJCQkJc2NyaXB0cyA9IGpRdWVyeS5tYXAoIGdldEFsbCggZnJhZ21lbnQsICJzY3JpcHQiICksIGRpc2FibGVTY3JpcHQgKTsKCQkJCWhhc1NjcmlwdHMgPSBzY3JpcHRzLmxlbmd0aDsKCgkJCQkvLyBVc2UgdGhlIG9yaWdpbmFsIGZyYWdtZW50IGZvciB0aGUgbGFzdCBpdGVtIGluc3RlYWQgb2YgdGhlIGZpcnN0IGJlY2F1c2UgaXQgY2FuIGVuZCB1cAoJCQkJLy8gYmVpbmcgZW1wdGllZCBpbmNvcnJlY3RseSBpbiBjZXJ0YWluIHNpdHVhdGlvbnMgKCM4MDcwKS4KCQkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJCQlub2RlID0gZnJhZ21lbnQ7CgoJCQkJCWlmICggaSAhPT0gaU5vQ2xvbmUgKSB7CgkJCQkJCW5vZGUgPSBqUXVlcnkuY2xvbmUoIG5vZGUsIHRydWUsIHRydWUgKTsKCgkJCQkJCS8vIEtlZXAgcmVmZXJlbmNlcyB0byBjbG9uZWQgc2NyaXB0cyBmb3IgbGF0ZXIgcmVzdG9yYXRpb24KCQkJCQkJaWYgKCBoYXNTY3JpcHRzICkgewoJCQkJCQkJalF1ZXJ5Lm1lcmdlKCBzY3JpcHRzLCBnZXRBbGwoIG5vZGUsICJzY3JpcHQiICkgKTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJY2FsbGJhY2suY2FsbCgKCQkJCQkJdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzW2ldLCAidGFibGUiICkgPwoJCQkJCQkJZmluZE9yQXBwZW5kKCB0aGlzW2ldLCAidGJvZHkiICkgOgoJCQkJCQkJdGhpc1tpXSwKCQkJCQkJbm9kZSwKCQkJCQkJaQoJCQkJCSk7CgkJCQl9CgoJCQkJaWYgKCBoYXNTY3JpcHRzICkgewoJCQkJCWRvYyA9IHNjcmlwdHNbIHNjcmlwdHMubGVuZ3RoIC0gMSBdLm93bmVyRG9jdW1lbnQ7CgoJCQkJCS8vIFJlZW5hYmxlIHNjcmlwdHMKCQkJCQlqUXVlcnkubWFwKCBzY3JpcHRzLCByZXN0b3JlU2NyaXB0ICk7CgoJCQkJCS8vIEV2YWx1YXRlIGV4ZWN1dGFibGUgc2NyaXB0cyBvbiBmaXJzdCBkb2N1bWVudCBpbnNlcnRpb24KCQkJCQlmb3IgKCBpID0gMDsgaSA8IGhhc1NjcmlwdHM7IGkrKyApIHsKCQkJCQkJbm9kZSA9IHNjcmlwdHNbIGkgXTsKCQkJCQkJaWYgKCByc2NyaXB0VHlwZS50ZXN0KCBub2RlLnR5cGUgfHwgIiIgKSAmJgoJCQkJCQkJIWpRdWVyeS5fZGF0YSggbm9kZSwgImdsb2JhbEV2YWwiICkgJiYgalF1ZXJ5LmNvbnRhaW5zKCBkb2MsIG5vZGUgKSApIHsKCgkJCQkJCQlpZiAoIG5vZGUuc3JjICkgewoJCQkJCQkJCS8vIEhvcGUgYWpheCBpcyBhdmFpbGFibGUuLi4KCQkJCQkJCQlqUXVlcnkuYWpheCh7CgkJCQkJCQkJCXVybDogbm9kZS5zcmMsCgkJCQkJCQkJCXR5cGU6ICJHRVQiLAoJCQkJCQkJCQlkYXRhVHlwZTogInNjcmlwdCIsCgkJCQkJCQkJCWFzeW5jOiBmYWxzZSwKCQkJCQkJCQkJZ2xvYmFsOiBmYWxzZSwKCQkJCQkJCQkJInRocm93cyI6IHRydWUKCQkJCQkJCQl9KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJalF1ZXJ5Lmdsb2JhbEV2YWwoICggbm9kZS50ZXh0IHx8IG5vZGUudGV4dENvbnRlbnQgfHwgbm9kZS5pbm5lckhUTUwgfHwgIiIgKS5yZXBsYWNlKCByY2xlYW5TY3JpcHQsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBGaXggIzExODA5OiBBdm9pZCBsZWFraW5nIG1lbW9yeQoJCQkJZnJhZ21lbnQgPSBmaXJzdCA9IG51bGw7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfQp9KTsKCmZ1bmN0aW9uIGZpbmRPckFwcGVuZCggZWxlbSwgdGFnICkgewoJcmV0dXJuIGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApWzBdIHx8IGVsZW0uYXBwZW5kQ2hpbGQoIGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCB0YWcgKSApOwp9CgovLyBSZXBsYWNlL3Jlc3RvcmUgdGhlIHR5cGUgYXR0cmlidXRlIG9mIHNjcmlwdCBlbGVtZW50cyBmb3Igc2FmZSBET00gbWFuaXB1bGF0aW9uCmZ1bmN0aW9uIGRpc2FibGVTY3JpcHQoIGVsZW0gKSB7Cgl2YXIgYXR0ciA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSgidHlwZSIpOwoJZWxlbS50eXBlID0gKCBhdHRyICYmIGF0dHIuc3BlY2lmaWVkICkgKyAiLyIgKyBlbGVtLnR5cGU7CglyZXR1cm4gZWxlbTsKfQpmdW5jdGlvbiByZXN0b3JlU2NyaXB0KCBlbGVtICkgewoJdmFyIG1hdGNoID0gcnNjcmlwdFR5cGVNYXNrZWQuZXhlYyggZWxlbS50eXBlICk7CglpZiAoIG1hdGNoICkgewoJCWVsZW0udHlwZSA9IG1hdGNoWzFdOwoJfSBlbHNlIHsKCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSgidHlwZSIpOwoJfQoJcmV0dXJuIGVsZW07Cn0KCi8vIE1hcmsgc2NyaXB0cyBhcyBoYXZpbmcgYWxyZWFkeSBiZWVuIGV2YWx1YXRlZApmdW5jdGlvbiBzZXRHbG9iYWxFdmFsKCBlbGVtcywgcmVmRWxlbWVudHMgKSB7Cgl2YXIgZWxlbSwKCQlpID0gMDsKCWZvciAoIDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCWpRdWVyeS5fZGF0YSggZWxlbSwgImdsb2JhbEV2YWwiLCAhcmVmRWxlbWVudHMgfHwgalF1ZXJ5Ll9kYXRhKCByZWZFbGVtZW50c1tpXSwgImdsb2JhbEV2YWwiICkgKTsKCX0KfQoKZnVuY3Rpb24gY2xvbmVDb3B5RXZlbnQoIHNyYywgZGVzdCApIHsKCglpZiAoIGRlc3Qubm9kZVR5cGUgIT09IDEgfHwgIWpRdWVyeS5oYXNEYXRhKCBzcmMgKSApIHsKCQlyZXR1cm47Cgl9CgoJdmFyIHR5cGUsIGksIGwsCgkJb2xkRGF0YSA9IGpRdWVyeS5fZGF0YSggc3JjICksCgkJY3VyRGF0YSA9IGpRdWVyeS5fZGF0YSggZGVzdCwgb2xkRGF0YSApLAoJCWV2ZW50cyA9IG9sZERhdGEuZXZlbnRzOwoKCWlmICggZXZlbnRzICkgewoJCWRlbGV0ZSBjdXJEYXRhLmhhbmRsZTsKCQljdXJEYXRhLmV2ZW50cyA9IHt9OwoKCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJZm9yICggaSA9IDAsIGwgPSBldmVudHNbIHR5cGUgXS5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQlqUXVlcnkuZXZlbnQuYWRkKCBkZXN0LCB0eXBlLCBldmVudHNbIHR5cGUgXVsgaSBdICk7CgkJCX0KCQl9Cgl9CgoJLy8gbWFrZSB0aGUgY2xvbmVkIHB1YmxpYyBkYXRhIG9iamVjdCBhIGNvcHkgZnJvbSB0aGUgb3JpZ2luYWwKCWlmICggY3VyRGF0YS5kYXRhICkgewoJCWN1ckRhdGEuZGF0YSA9IGpRdWVyeS5leHRlbmQoIHt9LCBjdXJEYXRhLmRhdGEgKTsKCX0KfQoKZnVuY3Rpb24gZml4Q2xvbmVOb2RlSXNzdWVzKCBzcmMsIGRlc3QgKSB7Cgl2YXIgbm9kZU5hbWUsIGUsIGRhdGE7CgoJLy8gV2UgZG8gbm90IG5lZWQgdG8gZG8gYW55dGhpbmcgZm9yIG5vbi1FbGVtZW50cwoJaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxICkgewoJCXJldHVybjsKCX0KCglub2RlTmFtZSA9IGRlc3Qubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCgkvLyBJRTYtOCBjb3BpZXMgZXZlbnRzIGJvdW5kIHZpYSBhdHRhY2hFdmVudCB3aGVuIHVzaW5nIGNsb25lTm9kZS4KCWlmICggIWpRdWVyeS5zdXBwb3J0Lm5vQ2xvbmVFdmVudCAmJiBkZXN0WyBqUXVlcnkuZXhwYW5kbyBdICkgewoJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIGRlc3QgKTsKCgkJZm9yICggZSBpbiBkYXRhLmV2ZW50cyApIHsKCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBkZXN0LCBlLCBkYXRhLmhhbmRsZSApOwoJCX0KCgkJLy8gRXZlbnQgZGF0YSBnZXRzIHJlZmVyZW5jZWQgaW5zdGVhZCBvZiBjb3BpZWQgaWYgdGhlIGV4cGFuZG8gZ2V0cyBjb3BpZWQgdG9vCgkJZGVzdC5yZW1vdmVBdHRyaWJ1dGUoIGpRdWVyeS5leHBhbmRvICk7Cgl9CgoJLy8gSUUgYmxhbmtzIGNvbnRlbnRzIHdoZW4gY2xvbmluZyBzY3JpcHRzLCBhbmQgdHJpZXMgdG8gZXZhbHVhdGUgbmV3bHktc2V0IHRleHQKCWlmICggbm9kZU5hbWUgPT09ICJzY3JpcHQiICYmIGRlc3QudGV4dCAhPT0gc3JjLnRleHQgKSB7CgkJZGlzYWJsZVNjcmlwdCggZGVzdCApLnRleHQgPSBzcmMudGV4dDsKCQlyZXN0b3JlU2NyaXB0KCBkZXN0ICk7CgoJLy8gSUU2LTEwIGltcHJvcGVybHkgY2xvbmVzIGNoaWxkcmVuIG9mIG9iamVjdCBlbGVtZW50cyB1c2luZyBjbGFzc2lkLgoJLy8gSUUxMCB0aHJvd3MgTm9Nb2RpZmljYXRpb25BbGxvd2VkRXJyb3IgaWYgcGFyZW50IGlzIG51bGwsICMxMjEzMi4KCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAib2JqZWN0IiApIHsKCQlpZiAoIGRlc3QucGFyZW50Tm9kZSApIHsKCQkJZGVzdC5vdXRlckhUTUwgPSBzcmMub3V0ZXJIVE1MOwoJCX0KCgkJLy8gVGhpcyBwYXRoIGFwcGVhcnMgdW5hdm9pZGFibGUgZm9yIElFOS4gV2hlbiBjbG9uaW5nIGFuIG9iamVjdAoJCS8vIGVsZW1lbnQgaW4gSUU5LCB0aGUgb3V0ZXJIVE1MIHN0cmF0ZWd5IGFib3ZlIGlzIG5vdCBzdWZmaWNpZW50LgoJCS8vIElmIHRoZSBzcmMgaGFzIGlubmVySFRNTCBhbmQgdGhlIGRlc3RpbmF0aW9uIGRvZXMgbm90LAoJCS8vIGNvcHkgdGhlIHNyYy5pbm5lckhUTUwgaW50byB0aGUgZGVzdC5pbm5lckhUTUwuICMxMDMyNAoJCWlmICggalF1ZXJ5LnN1cHBvcnQuaHRtbDVDbG9uZSAmJiAoIHNyYy5pbm5lckhUTUwgJiYgIWpRdWVyeS50cmltKGRlc3QuaW5uZXJIVE1MKSApICkgewoJCQlkZXN0LmlubmVySFRNTCA9IHNyYy5pbm5lckhUTUw7CgkJfQoKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAiaW5wdXQiICYmIG1hbmlwdWxhdGlvbl9yY2hlY2thYmxlVHlwZS50ZXN0KCBzcmMudHlwZSApICkgewoJCS8vIElFNi04IGZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3gKCQkvLyBvciByYWRpbyBidXR0b24uIFdvcnNlLCBJRTYtNyBmYWlsIHRvIGdpdmUgdGhlIGNsb25lZCBlbGVtZW50CgkJLy8gYSBjaGVja2VkIGFwcGVhcmFuY2UgaWYgdGhlIGRlZmF1bHRDaGVja2VkIHZhbHVlIGlzbid0IGFsc28gc2V0CgoJCWRlc3QuZGVmYXVsdENoZWNrZWQgPSBkZXN0LmNoZWNrZWQgPSBzcmMuY2hlY2tlZDsKCgkJLy8gSUU2LTcgZ2V0IGNvbmZ1c2VkIGFuZCBlbmQgdXAgc2V0dGluZyB0aGUgdmFsdWUgb2YgYSBjbG9uZWQKCQkvLyBjaGVja2JveC9yYWRpbyBidXR0b24gdG8gYW4gZW1wdHkgc3RyaW5nIGluc3RlYWQgb2YgIm9uIgoJCWlmICggZGVzdC52YWx1ZSAhPT0gc3JjLnZhbHVlICkgewoJCQlkZXN0LnZhbHVlID0gc3JjLnZhbHVlOwoJCX0KCgkvLyBJRTYtOCBmYWlscyB0byByZXR1cm4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0byB0aGUgZGVmYXVsdCBzZWxlY3RlZAoJLy8gc3RhdGUgd2hlbiBjbG9uaW5nIG9wdGlvbnMKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAib3B0aW9uIiApIHsKCQlkZXN0LmRlZmF1bHRTZWxlY3RlZCA9IGRlc3Quc2VsZWN0ZWQgPSBzcmMuZGVmYXVsdFNlbGVjdGVkOwoKCS8vIElFNi04IGZhaWxzIHRvIHNldCB0aGUgZGVmYXVsdFZhbHVlIHRvIHRoZSBjb3JyZWN0IHZhbHVlIHdoZW4KCS8vIGNsb25pbmcgb3RoZXIgdHlwZXMgb2YgaW5wdXQgZmllbGRzCgl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQlkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7Cgl9Cn0KCmpRdWVyeS5lYWNoKHsKCWFwcGVuZFRvOiAiYXBwZW5kIiwKCXByZXBlbmRUbzogInByZXBlbmQiLAoJaW5zZXJ0QmVmb3JlOiAiYmVmb3JlIiwKCWluc2VydEFmdGVyOiAiYWZ0ZXIiLAoJcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIgp9LCBmdW5jdGlvbiggbmFtZSwgb3JpZ2luYWwgKSB7CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgZWxlbXMsCgkJCWkgPSAwLAoJCQlyZXQgPSBbXSwKCQkJaW5zZXJ0ID0galF1ZXJ5KCBzZWxlY3RvciApLAoJCQlsYXN0ID0gaW5zZXJ0Lmxlbmd0aCAtIDE7CgoJCWZvciAoIDsgaSA8PSBsYXN0OyBpKysgKSB7CgkJCWVsZW1zID0gaSA9PT0gbGFzdCA/IHRoaXMgOiB0aGlzLmNsb25lKHRydWUpOwoJCQlqUXVlcnkoIGluc2VydFtpXSApWyBvcmlnaW5hbCBdKCBlbGVtcyApOwoKCQkJLy8gTW9kZXJuIGJyb3dzZXJzIGNhbiBhcHBseSBqUXVlcnkgY29sbGVjdGlvbnMgYXMgYXJyYXlzLCBidXQgb2xkSUUgbmVlZHMgYSAuZ2V0KCkKCQkJY29yZV9wdXNoLmFwcGx5KCByZXQsIGVsZW1zLmdldCgpICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldCApOwoJfTsKfSk7CgpmdW5jdGlvbiBnZXRBbGwoIGNvbnRleHQsIHRhZyApIHsKCXZhciBlbGVtcywgZWxlbSwKCQlpID0gMCwKCQlmb3VuZCA9IHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSBjb3JlX3N0cnVuZGVmaW5lZCA/IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyB8fCAiKiIgKSA6CgkJCXR5cGVvZiBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwgIT09IGNvcmVfc3RydW5kZWZpbmVkID8gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgfHwgIioiICkgOgoJCQl1bmRlZmluZWQ7CgoJaWYgKCAhZm91bmQgKSB7CgkJZm9yICggZm91bmQgPSBbXSwgZWxlbXMgPSBjb250ZXh0LmNoaWxkTm9kZXMgfHwgY29udGV4dDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQlpZiAoICF0YWcgfHwgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCB0YWcgKSApIHsKCQkJCWZvdW5kLnB1c2goIGVsZW0gKTsKCQkJfSBlbHNlIHsKCQkJCWpRdWVyeS5tZXJnZSggZm91bmQsIGdldEFsbCggZWxlbSwgdGFnICkgKTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gdGFnID09PSB1bmRlZmluZWQgfHwgdGFnICYmIGpRdWVyeS5ub2RlTmFtZSggY29udGV4dCwgdGFnICkgPwoJCWpRdWVyeS5tZXJnZSggWyBjb250ZXh0IF0sIGZvdW5kICkgOgoJCWZvdW5kOwp9CgovLyBVc2VkIGluIGJ1aWxkRnJhZ21lbnQsIGZpeGVzIHRoZSBkZWZhdWx0Q2hlY2tlZCBwcm9wZXJ0eQpmdW5jdGlvbiBmaXhEZWZhdWx0Q2hlY2tlZCggZWxlbSApIHsKCWlmICggbWFuaXB1bGF0aW9uX3JjaGVja2FibGVUeXBlLnRlc3QoIGVsZW0udHlwZSApICkgewoJCWVsZW0uZGVmYXVsdENoZWNrZWQgPSBlbGVtLmNoZWNrZWQ7Cgl9Cn0KCmpRdWVyeS5leHRlbmQoewoJY2xvbmU6IGZ1bmN0aW9uKCBlbGVtLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQl2YXIgZGVzdEVsZW1lbnRzLCBub2RlLCBjbG9uZSwgaSwgc3JjRWxlbWVudHMsCgkJCWluUGFnZSA9IGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgoJCWlmICggalF1ZXJ5LnN1cHBvcnQuaHRtbDVDbG9uZSB8fCBqUXVlcnkuaXNYTUxEb2MoZWxlbSkgfHwgIXJub3NoaW1jYWNoZS50ZXN0KCAiPCIgKyBlbGVtLm5vZGVOYW1lICsgIj4iICkgKSB7CgkJCWNsb25lID0gZWxlbS5jbG9uZU5vZGUoIHRydWUgKTsKCgkJLy8gSUU8PTggZG9lcyBub3QgcHJvcGVybHkgY2xvbmUgZGV0YWNoZWQsIHVua25vd24gZWxlbWVudCBub2RlcwoJCX0gZWxzZSB7CgkJCWZyYWdtZW50RGl2LmlubmVySFRNTCA9IGVsZW0ub3V0ZXJIVE1MOwoJCQlmcmFnbWVudERpdi5yZW1vdmVDaGlsZCggY2xvbmUgPSBmcmFnbWVudERpdi5maXJzdENoaWxkICk7CgkJfQoKCQlpZiAoICghalF1ZXJ5LnN1cHBvcnQubm9DbG9uZUV2ZW50IHx8ICFqUXVlcnkuc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCkgJiYKCQkJCShlbGVtLm5vZGVUeXBlID09PSAxIHx8IGVsZW0ubm9kZVR5cGUgPT09IDExKSAmJiAhalF1ZXJ5LmlzWE1MRG9jKGVsZW0pICkgewoKCQkJLy8gV2UgZXNjaGV3IFNpenpsZSBoZXJlIGZvciBwZXJmb3JtYW5jZSByZWFzb25zOiBodHRwOi8vanNwZXJmLmNvbS9nZXRhbGwtdnMtc2l6emxlLzIKCQkJZGVzdEVsZW1lbnRzID0gZ2V0QWxsKCBjbG9uZSApOwoJCQlzcmNFbGVtZW50cyA9IGdldEFsbCggZWxlbSApOwoKCQkJLy8gRml4IGFsbCBJRSBjbG9uaW5nIGlzc3VlcwoJCQlmb3IgKCBpID0gMDsgKG5vZGUgPSBzcmNFbGVtZW50c1tpXSkgIT0gbnVsbDsgKytpICkgewoJCQkJLy8gRW5zdXJlIHRoYXQgdGhlIGRlc3RpbmF0aW9uIG5vZGUgaXMgbm90IG51bGw7IEZpeGVzICM5NTg3CgkJCQlpZiAoIGRlc3RFbGVtZW50c1tpXSApIHsKCQkJCQlmaXhDbG9uZU5vZGVJc3N1ZXMoIG5vZGUsIGRlc3RFbGVtZW50c1tpXSApOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDb3B5IHRoZSBldmVudHMgZnJvbSB0aGUgb3JpZ2luYWwgdG8gdGhlIGNsb25lCgkJaWYgKCBkYXRhQW5kRXZlbnRzICkgewoJCQlpZiAoIGRlZXBEYXRhQW5kRXZlbnRzICkgewoJCQkJc3JjRWxlbWVudHMgPSBzcmNFbGVtZW50cyB8fCBnZXRBbGwoIGVsZW0gKTsKCQkJCWRlc3RFbGVtZW50cyA9IGRlc3RFbGVtZW50cyB8fCBnZXRBbGwoIGNsb25lICk7CgoJCQkJZm9yICggaSA9IDA7IChub2RlID0gc3JjRWxlbWVudHNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJCQljbG9uZUNvcHlFdmVudCggbm9kZSwgZGVzdEVsZW1lbnRzW2ldICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQljbG9uZUNvcHlFdmVudCggZWxlbSwgY2xvbmUgKTsKCQkJfQoJCX0KCgkJLy8gUHJlc2VydmUgc2NyaXB0IGV2YWx1YXRpb24gaGlzdG9yeQoJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUsICJzY3JpcHQiICk7CgkJaWYgKCBkZXN0RWxlbWVudHMubGVuZ3RoID4gMCApIHsKCQkJc2V0R2xvYmFsRXZhbCggZGVzdEVsZW1lbnRzLCAhaW5QYWdlICYmIGdldEFsbCggZWxlbSwgInNjcmlwdCIgKSApOwoJCX0KCgkJZGVzdEVsZW1lbnRzID0gc3JjRWxlbWVudHMgPSBub2RlID0gbnVsbDsKCgkJLy8gUmV0dXJuIHRoZSBjbG9uZWQgc2V0CgkJcmV0dXJuIGNsb25lOwoJfSwKCglidWlsZEZyYWdtZW50OiBmdW5jdGlvbiggZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbiApIHsKCQl2YXIgaiwgZWxlbSwgY29udGFpbnMsCgkJCXRtcCwgdGFnLCB0Ym9keSwgd3JhcCwKCQkJbCA9IGVsZW1zLmxlbmd0aCwKCgkJCS8vIEVuc3VyZSBhIHNhZmUgZnJhZ21lbnQKCQkJc2FmZSA9IGNyZWF0ZVNhZmVGcmFnbWVudCggY29udGV4dCApLAoKCQkJbm9kZXMgPSBbXSwKCQkJaSA9IDA7CgoJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJZWxlbSA9IGVsZW1zWyBpIF07CgoJCQlpZiAoIGVsZW0gfHwgZWxlbSA9PT0gMCApIHsKCgkJCQkvLyBBZGQgbm9kZXMgZGlyZWN0bHkKCQkJCWlmICggalF1ZXJ5LnR5cGUoIGVsZW0gKSA9PT0gIm9iamVjdCIgKSB7CgkJCQkJalF1ZXJ5Lm1lcmdlKCBub2RlcywgZWxlbS5ub2RlVHlwZSA/IFsgZWxlbSBdIDogZWxlbSApOwoKCQkJCS8vIENvbnZlcnQgbm9uLWh0bWwgaW50byBhIHRleHQgbm9kZQoJCQkJfSBlbHNlIGlmICggIXJodG1sLnRlc3QoIGVsZW0gKSApIHsKCQkJCQlub2Rlcy5wdXNoKCBjb250ZXh0LmNyZWF0ZVRleHROb2RlKCBlbGVtICkgKTsKCgkJCQkvLyBDb252ZXJ0IGh0bWwgaW50byBET00gbm9kZXMKCQkJCX0gZWxzZSB7CgkJCQkJdG1wID0gdG1wIHx8IHNhZmUuYXBwZW5kQ2hpbGQoIGNvbnRleHQuY3JlYXRlRWxlbWVudCgiZGl2IikgKTsKCgkJCQkJLy8gRGVzZXJpYWxpemUgYSBzdGFuZGFyZCByZXByZXNlbnRhdGlvbgoJCQkJCXRhZyA9ICggcnRhZ05hbWUuZXhlYyggZWxlbSApIHx8IFsiIiwgIiJdIClbMV0udG9Mb3dlckNhc2UoKTsKCQkJCQl3cmFwID0gd3JhcE1hcFsgdGFnIF0gfHwgd3JhcE1hcC5fZGVmYXVsdDsKCgkJCQkJdG1wLmlubmVySFRNTCA9IHdyYXBbMV0gKyBlbGVtLnJlcGxhY2UoIHJ4aHRtbFRhZywgIjwkMT48LyQyPiIgKSArIHdyYXBbMl07CgoJCQkJCS8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAoJCQkJCWogPSB3cmFwWzBdOwoJCQkJCXdoaWxlICggai0tICkgewoJCQkJCQl0bXAgPSB0bXAubGFzdENoaWxkOwoJCQkJCX0KCgkJCQkJLy8gTWFudWFsbHkgYWRkIGxlYWRpbmcgd2hpdGVzcGFjZSByZW1vdmVkIGJ5IElFCgkJCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UgJiYgcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIGVsZW0gKSApIHsKCQkJCQkJbm9kZXMucHVzaCggY29udGV4dC5jcmVhdGVUZXh0Tm9kZSggcmxlYWRpbmdXaGl0ZXNwYWNlLmV4ZWMoIGVsZW0gKVswXSApICk7CgkJCQkJfQoKCQkJCQkvLyBSZW1vdmUgSUUncyBhdXRvaW5zZXJ0ZWQgPHRib2R5PiBmcm9tIHRhYmxlIGZyYWdtZW50cwoJCQkJCWlmICggIWpRdWVyeS5zdXBwb3J0LnRib2R5ICkgewoKCQkJCQkJLy8gU3RyaW5nIHdhcyBhIDx0YWJsZT4sICptYXkqIGhhdmUgc3B1cmlvdXMgPHRib2R5PgoJCQkJCQllbGVtID0gdGFnID09PSAidGFibGUiICYmICFydGJvZHkudGVzdCggZWxlbSApID8KCQkJCQkJCXRtcC5maXJzdENoaWxkIDoKCgkJCQkJCQkvLyBTdHJpbmcgd2FzIGEgYmFyZSA8dGhlYWQ+IG9yIDx0Zm9vdD4KCQkJCQkJCXdyYXBbMV0gPT09ICI8dGFibGU+IiAmJiAhcnRib2R5LnRlc3QoIGVsZW0gKSA/CgkJCQkJCQkJdG1wIDoKCQkJCQkJCQkwOwoKCQkJCQkJaiA9IGVsZW0gJiYgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsKCQkJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggKHRib2R5ID0gZWxlbS5jaGlsZE5vZGVzW2pdKSwgInRib2R5IiApICYmICF0Ym9keS5jaGlsZE5vZGVzLmxlbmd0aCApIHsKCQkJCQkJCQllbGVtLnJlbW92ZUNoaWxkKCB0Ym9keSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoKCQkJCQlqUXVlcnkubWVyZ2UoIG5vZGVzLCB0bXAuY2hpbGROb2RlcyApOwoKCQkJCQkvLyBGaXggIzEyMzkyIGZvciBXZWJLaXQgYW5kIElFID4gOQoJCQkJCXRtcC50ZXh0Q29udGVudCA9ICIiOwoKCQkJCQkvLyBGaXggIzEyMzkyIGZvciBvbGRJRQoJCQkJCXdoaWxlICggdG1wLmZpcnN0Q2hpbGQgKSB7CgkJCQkJCXRtcC5yZW1vdmVDaGlsZCggdG1wLmZpcnN0Q2hpbGQgKTsKCQkJCQl9CgoJCQkJCS8vIFJlbWVtYmVyIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciBwcm9wZXIgY2xlYW51cAoJCQkJCXRtcCA9IHNhZmUubGFzdENoaWxkOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBGaXggIzExMzU2OiBDbGVhciBlbGVtZW50cyBmcm9tIGZyYWdtZW50CgkJaWYgKCB0bXAgKSB7CgkJCXNhZmUucmVtb3ZlQ2hpbGQoIHRtcCApOwoJCX0KCgkJLy8gUmVzZXQgZGVmYXVsdENoZWNrZWQgZm9yIGFueSByYWRpb3MgYW5kIGNoZWNrYm94ZXMKCQkvLyBhYm91dCB0byBiZSBhcHBlbmRlZCB0byB0aGUgRE9NIGluIElFIDYvNyAoIzgwNjApCgkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuYXBwZW5kQ2hlY2tlZCApIHsKCQkJalF1ZXJ5LmdyZXAoIGdldEFsbCggbm9kZXMsICJpbnB1dCIgKSwgZml4RGVmYXVsdENoZWNrZWQgKTsKCQl9CgoJCWkgPSAwOwoJCXdoaWxlICggKGVsZW0gPSBub2Rlc1sgaSsrIF0pICkgewoKCQkJLy8gIzQwODcgLSBJZiBvcmlnaW4gYW5kIGRlc3RpbmF0aW9uIGVsZW1lbnRzIGFyZSB0aGUgc2FtZSwgYW5kIHRoaXMgaXMKCQkJLy8gdGhhdCBlbGVtZW50LCBkbyBub3QgZG8gYW55dGhpbmcKCQkJaWYgKCBzZWxlY3Rpb24gJiYgalF1ZXJ5LmluQXJyYXkoIGVsZW0sIHNlbGVjdGlvbiApICE9PSAtMSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQljb250YWlucyA9IGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgoJCQkvLyBBcHBlbmQgdG8gZnJhZ21lbnQKCQkJdG1wID0gZ2V0QWxsKCBzYWZlLmFwcGVuZENoaWxkKCBlbGVtICksICJzY3JpcHQiICk7CgoJCQkvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CgkJCWlmICggY29udGFpbnMgKSB7CgkJCQlzZXRHbG9iYWxFdmFsKCB0bXAgKTsKCQkJfQoKCQkJLy8gQ2FwdHVyZSBleGVjdXRhYmxlcwoJCQlpZiAoIHNjcmlwdHMgKSB7CgkJCQlqID0gMDsKCQkJCXdoaWxlICggKGVsZW0gPSB0bXBbIGorKyBdKSApIHsKCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIGVsZW0udHlwZSB8fCAiIiApICkgewoJCQkJCQlzY3JpcHRzLnB1c2goIGVsZW0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXRtcCA9IG51bGw7CgoJCXJldHVybiBzYWZlOwoJfSwKCgljbGVhbkRhdGE6IGZ1bmN0aW9uKCBlbGVtcywgLyogaW50ZXJuYWwgKi8gYWNjZXB0RGF0YSApIHsKCQl2YXIgZWxlbSwgdHlwZSwgaWQsIGRhdGEsCgkJCWkgPSAwLAoJCQlpbnRlcm5hbEtleSA9IGpRdWVyeS5leHBhbmRvLAoJCQljYWNoZSA9IGpRdWVyeS5jYWNoZSwKCQkJZGVsZXRlRXhwYW5kbyA9IGpRdWVyeS5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8sCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgoJCQlpZiAoIGFjY2VwdERhdGEgfHwgalF1ZXJ5LmFjY2VwdERhdGEoIGVsZW0gKSApIHsKCgkJCQlpZCA9IGVsZW1bIGludGVybmFsS2V5IF07CgkJCQlkYXRhID0gaWQgJiYgY2FjaGVbIGlkIF07CgoJCQkJaWYgKCBkYXRhICkgewoJCQkJCWlmICggZGF0YS5ldmVudHMgKSB7CgkJCQkJCWZvciAoIHR5cGUgaW4gZGF0YS5ldmVudHMgKSB7CgkJCQkJCQlpZiAoIHNwZWNpYWxbIHR5cGUgXSApIHsKCQkJCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICk7CgoJCQkJCQkJLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGRhdGEuaGFuZGxlICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIFJlbW92ZSBjYWNoZSBvbmx5IGlmIGl0IHdhcyBub3QgYWxyZWFkeSByZW1vdmVkIGJ5IGpRdWVyeS5ldmVudC5yZW1vdmUKCQkJCQlpZiAoIGNhY2hlWyBpZCBdICkgewoKCQkJCQkJZGVsZXRlIGNhY2hlWyBpZCBdOwoKCQkJCQkJLy8gSUUgZG9lcyBub3QgYWxsb3cgdXMgdG8gZGVsZXRlIGV4cGFuZG8gcHJvcGVydGllcyBmcm9tIG5vZGVzLAoJCQkJCQkvLyBub3IgZG9lcyBpdCBoYXZlIGEgcmVtb3ZlQXR0cmlidXRlIGZ1bmN0aW9uIG9uIERvY3VtZW50IG5vZGVzOwoJCQkJCQkvLyB3ZSBtdXN0IGhhbmRsZSBhbGwgb2YgdGhlc2UgY2FzZXMKCQkJCQkJaWYgKCBkZWxldGVFeHBhbmRvICkgewoJCQkJCQkJZGVsZXRlIGVsZW1bIGludGVybmFsS2V5IF07CgoJCQkJCQl9IGVsc2UgaWYgKCB0eXBlb2YgZWxlbS5yZW1vdmVBdHRyaWJ1dGUgIT09IGNvcmVfc3RydW5kZWZpbmVkICkgewoJCQkJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGludGVybmFsS2V5ICk7CgoJCQkJCQl9IGVsc2UgewoJCQkJCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IG51bGw7CgkJCQkJCX0KCgkJCQkJCWNvcmVfZGVsZXRlZElkcy5wdXNoKCBpZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KfSk7CnZhciBpZnJhbWUsIGdldFN0eWxlcywgY3VyQ1NTLAoJcmFscGhhID0gL2FscGhhXChbXildKlwpL2ksCglyb3BhY2l0eSA9IC9vcGFjaXR5XHMqPVxzKihbXildKikvLAoJcnBvc2l0aW9uID0gL14odG9wfHJpZ2h0fGJvdHRvbXxsZWZ0KSQvLAoJLy8gc3dhcHBhYmxlIGlmIGRpc3BsYXkgaXMgbm9uZSBvciBzdGFydHMgd2l0aCB0YWJsZSBleGNlcHQgInRhYmxlIiwgInRhYmxlLWNlbGwiLCBvciAidGFibGUtY2FwdGlvbiIKCS8vIHNlZSBoZXJlIGZvciBkaXNwbGF5IHZhbHVlczogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9DU1MvZGlzcGxheQoJcmRpc3BsYXlzd2FwID0gL14obm9uZXx0YWJsZSg/IS1jW2VhXSkuKykvLAoJcm1hcmdpbiA9IC9ebWFyZ2luLywKCXJudW1zcGxpdCA9IG5ldyBSZWdFeHAoICJeKCIgKyBjb3JlX3BudW0gKyAiKSguKikkIiwgImkiICksCglybnVtbm9ucHggPSBuZXcgUmVnRXhwKCAiXigiICsgY29yZV9wbnVtICsgIikoPyFweClbYS16JV0rJCIsICJpIiApLAoJcnJlbE51bSA9IG5ldyBSZWdFeHAoICJeKFsrLV0pPSgiICsgY29yZV9wbnVtICsgIikiLCAiaSIgKSwKCWVsZW1kaXNwbGF5ID0geyBCT0RZOiAiYmxvY2siIH0sCgoJY3NzU2hvdyA9IHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2siIH0sCgljc3NOb3JtYWxUcmFuc2Zvcm0gPSB7CgkJbGV0dGVyU3BhY2luZzogMCwKCQlmb250V2VpZ2h0OiA0MDAKCX0sCgoJY3NzRXhwYW5kID0gWyAiVG9wIiwgIlJpZ2h0IiwgIkJvdHRvbSIsICJMZWZ0IiBdLAoJY3NzUHJlZml4ZXMgPSBbICJXZWJraXQiLCAiTyIsICJNb3oiLCAibXMiIF07CgovLyByZXR1cm4gYSBjc3MgcHJvcGVydHkgbWFwcGVkIHRvIGEgcG90ZW50aWFsbHkgdmVuZG9yIHByZWZpeGVkIHByb3BlcnR5CmZ1bmN0aW9uIHZlbmRvclByb3BOYW1lKCBzdHlsZSwgbmFtZSApIHsKCgkvLyBzaG9ydGN1dCBmb3IgbmFtZXMgdGhhdCBhcmUgbm90IHZlbmRvciBwcmVmaXhlZAoJaWYgKCBuYW1lIGluIHN0eWxlICkgewoJCXJldHVybiBuYW1lOwoJfQoKCS8vIGNoZWNrIGZvciB2ZW5kb3IgcHJlZml4ZWQgbmFtZXMKCXZhciBjYXBOYW1lID0gbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSksCgkJb3JpZ05hbWUgPSBuYW1lLAoJCWkgPSBjc3NQcmVmaXhlcy5sZW5ndGg7CgoJd2hpbGUgKCBpLS0gKSB7CgkJbmFtZSA9IGNzc1ByZWZpeGVzWyBpIF0gKyBjYXBOYW1lOwoJCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQkJcmV0dXJuIG5hbWU7CgkJfQoJfQoKCXJldHVybiBvcmlnTmFtZTsKfQoKZnVuY3Rpb24gaXNIaWRkZW4oIGVsZW0sIGVsICkgewoJLy8gaXNIaWRkZW4gbWlnaHQgYmUgY2FsbGVkIGZyb20galF1ZXJ5I2ZpbHRlciBmdW5jdGlvbjsKCS8vIGluIHRoYXQgY2FzZSwgZWxlbWVudCB3aWxsIGJlIHNlY29uZCBhcmd1bWVudAoJZWxlbSA9IGVsIHx8IGVsZW07CglyZXR1cm4galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgPT09ICJub25lIiB8fCAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKfQoKZnVuY3Rpb24gc2hvd0hpZGUoIGVsZW1lbnRzLCBzaG93ICkgewoJdmFyIGRpc3BsYXksIGVsZW0sIGhpZGRlbiwKCQl2YWx1ZXMgPSBbXSwKCQlpbmRleCA9IDAsCgkJbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoOwoKCWZvciAoIDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOwoJCWlmICggIWVsZW0uc3R5bGUgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCgkJdmFsdWVzWyBpbmRleCBdID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIgKTsKCQlkaXNwbGF5ID0gZWxlbS5zdHlsZS5kaXNwbGF5OwoJCWlmICggc2hvdyApIHsKCQkJLy8gUmVzZXQgdGhlIGlubGluZSBkaXNwbGF5IG9mIHRoaXMgZWxlbWVudCB0byBsZWFybiBpZiBpdCBpcwoJCQkvLyBiZWluZyBoaWRkZW4gYnkgY2FzY2FkZWQgcnVsZXMgb3Igbm90CgkJCWlmICggIXZhbHVlc1sgaW5kZXggXSAmJiBkaXNwbGF5ID09PSAibm9uZSIgKSB7CgkJCQllbGVtLnN0eWxlLmRpc3BsYXkgPSAiIjsKCQkJfQoKCQkJLy8gU2V0IGVsZW1lbnRzIHdoaWNoIGhhdmUgYmVlbiBvdmVycmlkZGVuIHdpdGggZGlzcGxheTogbm9uZQoJCQkvLyBpbiBhIHN0eWxlc2hlZXQgdG8gd2hhdGV2ZXIgdGhlIGRlZmF1bHQgYnJvd3NlciBzdHlsZSBpcwoJCQkvLyBmb3Igc3VjaCBhbiBlbGVtZW50CgkJCWlmICggZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiAmJiBpc0hpZGRlbiggZWxlbSApICkgewoJCQkJdmFsdWVzWyBpbmRleCBdID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIsIGNzc19kZWZhdWx0RGlzcGxheShlbGVtLm5vZGVOYW1lKSApOwoJCQl9CgkJfSBlbHNlIHsKCgkJCWlmICggIXZhbHVlc1sgaW5kZXggXSApIHsKCQkJCWhpZGRlbiA9IGlzSGlkZGVuKCBlbGVtICk7CgoJCQkJaWYgKCBkaXNwbGF5ICYmIGRpc3BsYXkgIT09ICJub25lIiB8fCAhaGlkZGVuICkgewoJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgIm9sZGRpc3BsYXkiLCBoaWRkZW4gPyBkaXNwbGF5IDogalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgKTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBTZXQgdGhlIGRpc3BsYXkgb2YgbW9zdCBvZiB0aGUgZWxlbWVudHMgaW4gYSBzZWNvbmQgbG9vcAoJLy8gdG8gYXZvaWQgdGhlIGNvbnN0YW50IHJlZmxvdwoJZm9yICggaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsKCQllbGVtID0gZWxlbWVudHNbIGluZGV4IF07CgkJaWYgKCAhZWxlbS5zdHlsZSApIHsKCQkJY29udGludWU7CgkJfQoJCWlmICggIXNob3cgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiApIHsKCQkJZWxlbS5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IHZhbHVlc1sgaW5kZXggXSB8fCAiIiA6ICJub25lIjsKCQl9Cgl9CgoJcmV0dXJuIGVsZW1lbnRzOwp9CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWNzczogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUgKSB7CgkJCXZhciBsZW4sIHN0eWxlcywKCQkJCW1hcCA9IHt9LAoJCQkJaSA9IDA7CgoJCQlpZiAoIGpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgkJCQlzdHlsZXMgPSBnZXRTdHlsZXMoIGVsZW0gKTsKCQkJCWxlbiA9IG5hbWUubGVuZ3RoOwoKCQkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCW1hcFsgbmFtZVsgaSBdIF0gPSBqUXVlcnkuY3NzKCBlbGVtLCBuYW1lWyBpIF0sIGZhbHNlLCBzdHlsZXMgKTsKCQkJCX0KCgkJCQlyZXR1cm4gbWFwOwoJCQl9CgoJCQlyZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCA/CgkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUsIHZhbHVlICkgOgoJCQkJalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApOwoJCX0sIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOwoJfSwKCXNob3c6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBzaG93SGlkZSggdGhpcywgdHJ1ZSApOwoJfSwKCWhpZGU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBzaG93SGlkZSggdGhpcyApOwoJfSwKCXRvZ2dsZTogZnVuY3Rpb24oIHN0YXRlICkgewoJCXZhciBib29sID0gdHlwZW9mIHN0YXRlID09PSAiYm9vbGVhbiI7CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggYm9vbCA/IHN0YXRlIDogaXNIaWRkZW4oIHRoaXMgKSApIHsKCQkJCWpRdWVyeSggdGhpcyApLnNob3coKTsKCQkJfSBlbHNlIHsKCQkJCWpRdWVyeSggdGhpcyApLmhpZGUoKTsKCQkJfQoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJLy8gQWRkIGluIHN0eWxlIHByb3BlcnR5IGhvb2tzIGZvciBvdmVycmlkaW5nIHRoZSBkZWZhdWx0CgkvLyBiZWhhdmlvciBvZiBnZXR0aW5nIGFuZCBzZXR0aW5nIGEgc3R5bGUgcHJvcGVydHkKCWNzc0hvb2tzOiB7CgkJb3BhY2l0eTogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJCWlmICggY29tcHV0ZWQgKSB7CgkJCQkJLy8gV2Ugc2hvdWxkIGFsd2F5cyBnZXQgYSBudW1iZXIgYmFjayBmcm9tIG9wYWNpdHkKCQkJCQl2YXIgcmV0ID0gY3VyQ1NTKCBlbGVtLCAib3BhY2l0eSIgKTsKCQkJCQlyZXR1cm4gcmV0ID09PSAiIiA/ICIxIiA6IHJldDsKCQkJCX0KCQkJfQoJCX0KCX0sCgoJLy8gRXhjbHVkZSB0aGUgZm9sbG93aW5nIGNzcyBwcm9wZXJ0aWVzIHRvIGFkZCBweAoJY3NzTnVtYmVyOiB7CgkJImNvbHVtbkNvdW50IjogdHJ1ZSwKCQkiZmlsbE9wYWNpdHkiOiB0cnVlLAoJCSJmb250V2VpZ2h0IjogdHJ1ZSwKCQkibGluZUhlaWdodCI6IHRydWUsCgkJIm9wYWNpdHkiOiB0cnVlLAoJCSJvcnBoYW5zIjogdHJ1ZSwKCQkid2lkb3dzIjogdHJ1ZSwKCQkiekluZGV4IjogdHJ1ZSwKCQkiem9vbSI6IHRydWUKCX0sCgoJLy8gQWRkIGluIHByb3BlcnRpZXMgd2hvc2UgbmFtZXMgeW91IHdpc2ggdG8gZml4IGJlZm9yZQoJLy8gc2V0dGluZyBvciBnZXR0aW5nIHRoZSB2YWx1ZQoJY3NzUHJvcHM6IHsKCQkvLyBub3JtYWxpemUgZmxvYXQgY3NzIHByb3BlcnR5CgkJImZsb2F0IjogalF1ZXJ5LnN1cHBvcnQuY3NzRmxvYXQgPyAiY3NzRmxvYXQiIDogInN0eWxlRmxvYXQiCgl9LAoKCS8vIEdldCBhbmQgc2V0IHRoZSBzdHlsZSBwcm9wZXJ0eSBvbiBhIERPTSBOb2RlCglzdHlsZTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlLCBleHRyYSApIHsKCQkvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQlpZiAoICFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJdmFyIHJldCwgdHlwZSwgaG9va3MsCgkJCW9yaWdOYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG9yaWdOYW1lICkgKTsKCgkJLy8gZ2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbgoJCS8vIGZvbGxvd2VkIGJ5IHRoZSB1bnByZWZpeGVkIHZlcnNpb24KCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJLy8gQ2hlY2sgaWYgd2UncmUgc2V0dGluZyBhIHZhbHVlCgkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQl0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQkJLy8gY29udmVydCByZWxhdGl2ZSBudW1iZXIgc3RyaW5ncyAoKz0gb3IgLT0pIHRvIHJlbGF0aXZlIG51bWJlcnMuICM3MzQ1CgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgJiYgKHJldCA9IHJyZWxOdW0uZXhlYyggdmFsdWUgKSkgKSB7CgkJCQl2YWx1ZSA9ICggcmV0WzFdICsgMSApICogcmV0WzJdICsgcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApICk7CgkJCQkvLyBGaXhlcyBidWcgIzkyMzcKCQkJCXR5cGUgPSAibnVtYmVyIjsKCQkJfQoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgTmFOIGFuZCBudWxsIHZhbHVlcyBhcmVuJ3Qgc2V0LiBTZWU6ICM3MTE2CgkJCWlmICggdmFsdWUgPT0gbnVsbCB8fCB0eXBlID09PSAibnVtYmVyIiAmJiBpc05hTiggdmFsdWUgKSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gSWYgYSBudW1iZXIgd2FzIHBhc3NlZCBpbiwgYWRkICdweCcgdG8gdGhlIChleGNlcHQgZm9yIGNlcnRhaW4gQ1NTIHByb3BlcnRpZXMpCgkJCWlmICggdHlwZSA9PT0gIm51bWJlciIgJiYgIWpRdWVyeS5jc3NOdW1iZXJbIG9yaWdOYW1lIF0gKSB7CgkJCQl2YWx1ZSArPSAicHgiOwoJCQl9CgoJCQkvLyBGaXhlcyAjODkwOCwgaXQgY2FuIGJlIGRvbmUgbW9yZSBjb3JyZWN0bHkgYnkgc3BlY2lmaW5nIHNldHRlcnMgaW4gY3NzSG9va3MsCgkJCS8vIGJ1dCBpdCB3b3VsZCBtZWFuIHRvIGRlZmluZSBlaWdodCAoZm9yIGV2ZXJ5IHByb2JsZW1hdGljIHByb3BlcnR5KSBpZGVudGljYWwgZnVuY3Rpb25zCgkJCWlmICggIWpRdWVyeS5zdXBwb3J0LmNsZWFyQ2xvbmVTdHlsZSAmJiB2YWx1ZSA9PT0gIiIgJiYgbmFtZS5pbmRleE9mKCJiYWNrZ3JvdW5kIikgPT09IDAgKSB7CgkJCQlzdHlsZVsgbmFtZSBdID0gImluaGVyaXQiOwoJCQl9CgoJCQkvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkLCB1c2UgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGp1c3Qgc2V0IHRoZSBzcGVjaWZpZWQgdmFsdWUKCQkJaWYgKCAhaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgKHZhbHVlID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgZXh0cmEgKSkgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBXcmFwcGVkIHRvIHByZXZlbnQgSUUgZnJvbSB0aHJvd2luZyBlcnJvcnMgd2hlbiAnaW52YWxpZCcgdmFsdWVzIGFyZSBwcm92aWRlZAoJCQkJLy8gRml4ZXMgYnVnICM1NTA5CgkJCQl0cnkgewoJCQkJCXN0eWxlWyBuYW1lIF0gPSB2YWx1ZTsKCQkJCX0gY2F0Y2goZSkge30KCQkJfQoKCQl9IGVsc2UgewoJCQkvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkIGdldCB0aGUgbm9uLWNvbXB1dGVkIHZhbHVlIGZyb20gdGhlcmUKCQkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBmYWxzZSwgZXh0cmEgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgkJCX0KCgkJCS8vIE90aGVyd2lzZSBqdXN0IGdldCB0aGUgdmFsdWUgZnJvbSB0aGUgc3R5bGUgb2JqZWN0CgkJCXJldHVybiBzdHlsZVsgbmFtZSBdOwoJCX0KCX0sCgoJY3NzOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZXh0cmEsIHN0eWxlcyApIHsKCQl2YXIgbnVtLCB2YWwsIGhvb2tzLAoJCQlvcmlnTmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJbmFtZSA9IGpRdWVyeS5jc3NQcm9wc1sgb3JpZ05hbWUgXSB8fCAoIGpRdWVyeS5jc3NQcm9wc1sgb3JpZ05hbWUgXSA9IHZlbmRvclByb3BOYW1lKCBlbGVtLnN0eWxlLCBvcmlnTmFtZSApICk7CgoJCS8vIGdldHMgaG9vayBmb3IgdGhlIHByZWZpeGVkIHZlcnNpb24KCQkvLyBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCB2ZXJzaW9uCgkJaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSB8fCBqUXVlcnkuY3NzSG9va3NbIG9yaWdOYW1lIF07CgoJCS8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyApIHsKCQkJdmFsID0gaG9va3MuZ2V0KCBlbGVtLCB0cnVlLCBleHRyYSApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlLCBpZiBhIHdheSB0byBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGV4aXN0cywgdXNlIHRoYXQKCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCX0KCgkJLy9jb252ZXJ0ICJub3JtYWwiIHRvIGNvbXB1dGVkIHZhbHVlCgkJaWYgKCB2YWwgPT09ICJub3JtYWwiICYmIG5hbWUgaW4gY3NzTm9ybWFsVHJhbnNmb3JtICkgewoJCQl2YWwgPSBjc3NOb3JtYWxUcmFuc2Zvcm1bIG5hbWUgXTsKCQl9CgoJCS8vIFJldHVybiwgY29udmVydGluZyB0byBudW1iZXIgaWYgZm9yY2VkIG9yIGEgcXVhbGlmaWVyIHdhcyBwcm92aWRlZCBhbmQgdmFsIGxvb2tzIG51bWVyaWMKCQlpZiAoIGV4dHJhID09PSAiIiB8fCBleHRyYSApIHsKCQkJbnVtID0gcGFyc2VGbG9hdCggdmFsICk7CgkJCXJldHVybiBleHRyYSA9PT0gdHJ1ZSB8fCBqUXVlcnkuaXNOdW1lcmljKCBudW0gKSA/IG51bSB8fCAwIDogdmFsOwoJCX0KCQlyZXR1cm4gdmFsOwoJfSwKCgkvLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zCglzd2FwOiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgY2FsbGJhY2ssIGFyZ3MgKSB7CgkJdmFyIHJldCwgbmFtZSwKCQkJb2xkID0ge307CgoJCS8vIFJlbWVtYmVyIHRoZSBvbGQgdmFsdWVzLCBhbmQgaW5zZXJ0IHRoZSBuZXcgb25lcwoJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJb2xkWyBuYW1lIF0gPSBlbGVtLnN0eWxlWyBuYW1lIF07CgkJCWVsZW0uc3R5bGVbIG5hbWUgXSA9IG9wdGlvbnNbIG5hbWUgXTsKCQl9CgoJCXJldCA9IGNhbGxiYWNrLmFwcGx5KCBlbGVtLCBhcmdzIHx8IFtdICk7CgoJCS8vIFJldmVydCB0aGUgb2xkIHZhbHVlcwoJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb2xkWyBuYW1lIF07CgkJfQoKCQlyZXR1cm4gcmV0OwoJfQp9KTsKCi8vIE5PVEU6IHdlJ3ZlIGluY2x1ZGVkIHRoZSAid2luZG93IiBpbiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZQovLyBiZWNhdXNlIGpzZG9tIG9uIG5vZGUuanMgd2lsbCBicmVhayB3aXRob3V0IGl0LgppZiAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlICkgewoJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICk7Cgl9OwoKCWN1ckNTUyA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBfY29tcHV0ZWQgKSB7CgkJdmFyIHdpZHRoLCBtaW5XaWR0aCwgbWF4V2lkdGgsCgkJCWNvbXB1dGVkID0gX2NvbXB1dGVkIHx8IGdldFN0eWxlcyggZWxlbSApLAoKCQkJLy8gZ2V0UHJvcGVydHlWYWx1ZSBpcyBvbmx5IG5lZWRlZCBmb3IgLmNzcygnZmlsdGVyJykgaW4gSUU5LCBzZWUgIzEyNTM3CgkJCXJldCA9IGNvbXB1dGVkID8gY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApIHx8IGNvbXB1dGVkWyBuYW1lIF0gOiB1bmRlZmluZWQsCgkJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgkJaWYgKCBjb21wdXRlZCApIHsKCgkJCWlmICggcmV0ID09PSAiIiAmJiAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCXJldCA9IGpRdWVyeS5zdHlsZSggZWxlbSwgbmFtZSApOwoJCQl9CgoJCQkvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgoJCQkvLyBDaHJvbWUgPCAxNyBhbmQgU2FmYXJpIDUuMCB1c2VzICJjb21wdXRlZCB2YWx1ZSIgaW5zdGVhZCBvZiAidXNlZCB2YWx1ZSIgZm9yIG1hcmdpbi1yaWdodAoJCQkvLyBTYWZhcmkgNS4xLjcgKGF0IGxlYXN0KSByZXR1cm5zIHBlcmNlbnRhZ2UgZm9yIGEgbGFyZ2VyIHNldCBvZiB2YWx1ZXMsIGJ1dCB3aWR0aCBzZWVtcyB0byBiZSByZWxpYWJseSBwaXhlbHMKCQkJLy8gdGhpcyBpcyBhZ2FpbnN0IHRoZSBDU1NPTSBkcmFmdCBzcGVjOiBodHRwOi8vZGV2LnczLm9yZy9jc3N3Zy9jc3NvbS8jcmVzb2x2ZWQtdmFsdWVzCgkJCWlmICggcm51bW5vbnB4LnRlc3QoIHJldCApICYmIHJtYXJnaW4udGVzdCggbmFtZSApICkgewoKCQkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJCXdpZHRoID0gc3R5bGUud2lkdGg7CgkJCQltaW5XaWR0aCA9IHN0eWxlLm1pbldpZHRoOwoJCQkJbWF4V2lkdGggPSBzdHlsZS5tYXhXaWR0aDsKCgkJCQkvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CgkJCQlzdHlsZS5taW5XaWR0aCA9IHN0eWxlLm1heFdpZHRoID0gc3R5bGUud2lkdGggPSByZXQ7CgkJCQlyZXQgPSBjb21wdXRlZC53aWR0aDsKCgkJCQkvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzCgkJCQlzdHlsZS53aWR0aCA9IHdpZHRoOwoJCQkJc3R5bGUubWluV2lkdGggPSBtaW5XaWR0aDsKCQkJCXN0eWxlLm1heFdpZHRoID0gbWF4V2lkdGg7CgkJCX0KCQl9CgoJCXJldHVybiByZXQ7Cgl9Owp9IGVsc2UgaWYgKCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlICkgewoJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGVsZW0uY3VycmVudFN0eWxlOwoJfTsKCgljdXJDU1MgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSwgX2NvbXB1dGVkICkgewoJCXZhciBsZWZ0LCBycywgcnNMZWZ0LAoJCQljb21wdXRlZCA9IF9jb21wdXRlZCB8fCBnZXRTdHlsZXMoIGVsZW0gKSwKCQkJcmV0ID0gY29tcHV0ZWQgPyBjb21wdXRlZFsgbmFtZSBdIDogdW5kZWZpbmVkLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCS8vIEF2b2lkIHNldHRpbmcgcmV0IHRvIGVtcHR5IHN0cmluZyBoZXJlCgkJLy8gc28gd2UgZG9uJ3QgZGVmYXVsdCB0byBhdXRvCgkJaWYgKCByZXQgPT0gbnVsbCAmJiBzdHlsZSAmJiBzdHlsZVsgbmFtZSBdICkgewoJCQlyZXQgPSBzdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gRnJvbSB0aGUgYXdlc29tZSBoYWNrIGJ5IERlYW4gRWR3YXJkcwoJCS8vIGh0dHA6Ly9lcmlrLmVhZS5uZXQvYXJjaGl2ZXMvMjAwNy8wNy8yNy8xOC41NC4xNS8jY29tbWVudC0xMDIyOTEKCgkJLy8gSWYgd2UncmUgbm90IGRlYWxpbmcgd2l0aCBhIHJlZ3VsYXIgcGl4ZWwgbnVtYmVyCgkJLy8gYnV0IGEgbnVtYmVyIHRoYXQgaGFzIGEgd2VpcmQgZW5kaW5nLCB3ZSBuZWVkIHRvIGNvbnZlcnQgaXQgdG8gcGl4ZWxzCgkJLy8gYnV0IG5vdCBwb3NpdGlvbiBjc3MgYXR0cmlidXRlcywgYXMgdGhvc2UgYXJlIHByb3BvcnRpb25hbCB0byB0aGUgcGFyZW50IGVsZW1lbnQgaW5zdGVhZAoJCS8vIGFuZCB3ZSBjYW4ndCBtZWFzdXJlIHRoZSBwYXJlbnQgaW5zdGVhZCBiZWNhdXNlIGl0IG1pZ2h0IHRyaWdnZXIgYSAic3RhY2tpbmcgZG9sbHMiIHByb2JsZW0KCQlpZiAoIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiAhcnBvc2l0aW9uLnRlc3QoIG5hbWUgKSApIHsKCgkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJbGVmdCA9IHN0eWxlLmxlZnQ7CgkJCXJzID0gZWxlbS5ydW50aW1lU3R5bGU7CgkJCXJzTGVmdCA9IHJzICYmIHJzLmxlZnQ7CgoJCQkvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IGVsZW0uY3VycmVudFN0eWxlLmxlZnQ7CgkJCX0KCQkJc3R5bGUubGVmdCA9IG5hbWUgPT09ICJmb250U2l6ZSIgPyAiMWVtIiA6IHJldDsKCQkJcmV0ID0gc3R5bGUucGl4ZWxMZWZ0ICsgInB4IjsKCgkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCQkJc3R5bGUubGVmdCA9IGxlZnQ7CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IHJzTGVmdDsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldCA9PT0gIiIgPyAiYXV0byIgOiByZXQ7Cgl9Owp9CgpmdW5jdGlvbiBzZXRQb3NpdGl2ZU51bWJlciggZWxlbSwgdmFsdWUsIHN1YnRyYWN0ICkgewoJdmFyIG1hdGNoZXMgPSBybnVtc3BsaXQuZXhlYyggdmFsdWUgKTsKCXJldHVybiBtYXRjaGVzID8KCQkvLyBHdWFyZCBhZ2FpbnN0IHVuZGVmaW5lZCAic3VidHJhY3QiLCBlLmcuLCB3aGVuIHVzZWQgYXMgaW4gY3NzSG9va3MKCQlNYXRoLm1heCggMCwgbWF0Y2hlc1sgMSBdIC0gKCBzdWJ0cmFjdCB8fCAwICkgKSArICggbWF0Y2hlc1sgMiBdIHx8ICJweCIgKSA6CgkJdmFsdWU7Cn0KCmZ1bmN0aW9uIGF1Z21lbnRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSwgaXNCb3JkZXJCb3gsIHN0eWxlcyApIHsKCXZhciBpID0gZXh0cmEgPT09ICggaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IiApID8KCQkvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgdGhlIHJpZ2h0IG1lYXN1cmVtZW50LCBhdm9pZCBhdWdtZW50YXRpb24KCQk0IDoKCQkvLyBPdGhlcndpc2UgaW5pdGlhbGl6ZSBmb3IgaG9yaXpvbnRhbCBvciB2ZXJ0aWNhbCBwcm9wZXJ0aWVzCgkJbmFtZSA9PT0gIndpZHRoIiA/IDEgOiAwLAoKCQl2YWwgPSAwOwoKCWZvciAoIDsgaSA8IDQ7IGkgKz0gMiApIHsKCQkvLyBib3RoIGJveCBtb2RlbHMgZXhjbHVkZSBtYXJnaW4sIHNvIGFkZCBpdCBpZiB3ZSB3YW50IGl0CgkJaWYgKCBleHRyYSA9PT0gIm1hcmdpbiIgKSB7CgkJCXZhbCArPSBqUXVlcnkuY3NzKCBlbGVtLCBleHRyYSArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCQl9CgoJCWlmICggaXNCb3JkZXJCb3ggKSB7CgkJCS8vIGJvcmRlci1ib3ggaW5jbHVkZXMgcGFkZGluZywgc28gcmVtb3ZlIGl0IGlmIHdlIHdhbnQgY29udGVudAoJCQlpZiAoIGV4dHJhID09PSAiY29udGVudCIgKSB7CgkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoJCQl9CgoJCQkvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBib3JkZXIgbm9yIG1hcmdpbiwgc28gcmVtb3ZlIGJvcmRlcgoJCQlpZiAoIGV4dHJhICE9PSAibWFyZ2luIiApIHsKCQkJCXZhbCAtPSBqUXVlcnkuY3NzKCBlbGVtLCAiYm9yZGVyIiArIGNzc0V4cGFuZFsgaSBdICsgIldpZHRoIiwgdHJ1ZSwgc3R5bGVzICk7CgkJCX0KCQl9IGVsc2UgewoJCQkvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBjb250ZW50LCBzbyBhZGQgcGFkZGluZwoJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoKCQkJLy8gYXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgY29udGVudCBub3IgcGFkZGluZywgc28gYWRkIGJvcmRlcgoJCQlpZiAoIGV4dHJhICE9PSAicGFkZGluZyIgKSB7CgkJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOwoJCQl9CgkJfQoJfQoKCXJldHVybiB2YWw7Cn0KCmZ1bmN0aW9uIGdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICkgewoKCS8vIFN0YXJ0IHdpdGggb2Zmc2V0IHByb3BlcnR5LCB3aGljaCBpcyBlcXVpdmFsZW50IHRvIHRoZSBib3JkZXItYm94IHZhbHVlCgl2YXIgdmFsdWVJc0JvcmRlckJveCA9IHRydWUsCgkJdmFsID0gbmFtZSA9PT0gIndpZHRoIiA/IGVsZW0ub2Zmc2V0V2lkdGggOiBlbGVtLm9mZnNldEhlaWdodCwKCQlzdHlsZXMgPSBnZXRTdHlsZXMoIGVsZW0gKSwKCQlpc0JvcmRlckJveCA9IGpRdWVyeS5zdXBwb3J0LmJveFNpemluZyAmJiBqUXVlcnkuY3NzKCBlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcyApID09PSAiYm9yZGVyLWJveCI7CgoJLy8gc29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCgkvLyBzdmcgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02NDkyODUKCS8vIE1hdGhNTCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTQ5MTY2OAoJaWYgKCB2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkvLyBGYWxsIGJhY2sgdG8gY29tcHV0ZWQgdGhlbiB1bmNvbXB1dGVkIGNzcyBpZiBuZWNlc3NhcnkKCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCWlmICggdmFsIDwgMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkJdmFsID0gZWxlbS5zdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gQ29tcHV0ZWQgdW5pdCBpcyBub3QgcGl4ZWxzLiBTdG9wIGhlcmUgYW5kIHJldHVybi4KCQlpZiAoIHJudW1ub25weC50ZXN0KHZhbCkgKSB7CgkJCXJldHVybiB2YWw7CgkJfQoKCQkvLyB3ZSBuZWVkIHRoZSBjaGVjayBmb3Igc3R5bGUgaW4gY2FzZSBhIGJyb3dzZXIgd2hpY2ggcmV0dXJucyB1bnJlbGlhYmxlIHZhbHVlcwoJCS8vIGZvciBnZXRDb21wdXRlZFN0eWxlIHNpbGVudGx5IGZhbGxzIGJhY2sgdG8gdGhlIHJlbGlhYmxlIGVsZW0uc3R5bGUKCQl2YWx1ZUlzQm9yZGVyQm94ID0gaXNCb3JkZXJCb3ggJiYgKCBqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmdSZWxpYWJsZSB8fCB2YWwgPT09IGVsZW0uc3R5bGVbIG5hbWUgXSApOwoKCQkvLyBOb3JtYWxpemUgIiIsIGF1dG8sIGFuZCBwcmVwYXJlIGZvciBleHRyYQoJCXZhbCA9IHBhcnNlRmxvYXQoIHZhbCApIHx8IDA7Cgl9CgoJLy8gdXNlIHRoZSBhY3RpdmUgYm94LXNpemluZyBtb2RlbCB0byBhZGQvc3VidHJhY3QgaXJyZWxldmFudCBzdHlsZXMKCXJldHVybiAoIHZhbCArCgkJYXVnbWVudFdpZHRoT3JIZWlnaHQoCgkJCWVsZW0sCgkJCW5hbWUsCgkJCWV4dHJhIHx8ICggaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IiApLAoJCQl2YWx1ZUlzQm9yZGVyQm94LAoJCQlzdHlsZXMKCQkpCgkpICsgInB4IjsKfQoKLy8gVHJ5IHRvIGRldGVybWluZSB0aGUgZGVmYXVsdCBkaXNwbGF5IHZhbHVlIG9mIGFuIGVsZW1lbnQKZnVuY3Rpb24gY3NzX2RlZmF1bHREaXNwbGF5KCBub2RlTmFtZSApIHsKCXZhciBkb2MgPSBkb2N1bWVudCwKCQlkaXNwbGF5ID0gZWxlbWRpc3BsYXlbIG5vZGVOYW1lIF07CgoJaWYgKCAhZGlzcGxheSApIHsKCQlkaXNwbGF5ID0gYWN0dWFsRGlzcGxheSggbm9kZU5hbWUsIGRvYyApOwoKCQkvLyBJZiB0aGUgc2ltcGxlIHdheSBmYWlscywgcmVhZCBmcm9tIGluc2lkZSBhbiBpZnJhbWUKCQlpZiAoIGRpc3BsYXkgPT09ICJub25lIiB8fCAhZGlzcGxheSApIHsKCQkJLy8gVXNlIHRoZSBhbHJlYWR5LWNyZWF0ZWQgaWZyYW1lIGlmIHBvc3NpYmxlCgkJCWlmcmFtZSA9ICggaWZyYW1lIHx8CgkJCQlqUXVlcnkoIjxpZnJhbWUgZnJhbWVib3JkZXI9JzAnIHdpZHRoPScwJyBoZWlnaHQ9JzAnLz4iKQoJCQkJLmNzcyggImNzc1RleHQiLCAiZGlzcGxheTpibG9jayAhaW1wb3J0YW50IiApCgkJCSkuYXBwZW5kVG8oIGRvYy5kb2N1bWVudEVsZW1lbnQgKTsKCgkJCS8vIEFsd2F5cyB3cml0ZSBhIG5ldyBIVE1MIHNrZWxldG9uIHNvIFdlYmtpdCBhbmQgRmlyZWZveCBkb24ndCBjaG9rZSBvbiByZXVzZQoJCQlkb2MgPSAoIGlmcmFtZVswXS5jb250ZW50V2luZG93IHx8IGlmcmFtZVswXS5jb250ZW50RG9jdW1lbnQgKS5kb2N1bWVudDsKCQkJZG9jLndyaXRlKCI8IWRvY3R5cGUgaHRtbD48aHRtbD48Ym9keT4iKTsKCQkJZG9jLmNsb3NlKCk7CgoJCQlkaXNwbGF5ID0gYWN0dWFsRGlzcGxheSggbm9kZU5hbWUsIGRvYyApOwoJCQlpZnJhbWUuZGV0YWNoKCk7CgkJfQoKCQkvLyBTdG9yZSB0aGUgY29ycmVjdCBkZWZhdWx0IGRpc3BsYXkKCQllbGVtZGlzcGxheVsgbm9kZU5hbWUgXSA9IGRpc3BsYXk7Cgl9CgoJcmV0dXJuIGRpc3BsYXk7Cn0KCi8vIENhbGxlZCBPTkxZIGZyb20gd2l0aGluIGNzc19kZWZhdWx0RGlzcGxheQpmdW5jdGlvbiBhY3R1YWxEaXNwbGF5KCBuYW1lLCBkb2MgKSB7Cgl2YXIgZWxlbSA9IGpRdWVyeSggZG9jLmNyZWF0ZUVsZW1lbnQoIG5hbWUgKSApLmFwcGVuZFRvKCBkb2MuYm9keSApLAoJCWRpc3BsYXkgPSBqUXVlcnkuY3NzKCBlbGVtWzBdLCAiZGlzcGxheSIgKTsKCWVsZW0ucmVtb3ZlKCk7CglyZXR1cm4gZGlzcGxheTsKfQoKalF1ZXJ5LmVhY2goWyAiaGVpZ2h0IiwgIndpZHRoIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCWpRdWVyeS5jc3NIb29rc1sgbmFtZSBdID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkLCBleHRyYSApIHsKCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCS8vIGNlcnRhaW4gZWxlbWVudHMgY2FuIGhhdmUgZGltZW5zaW9uIGluZm8gaWYgd2UgaW52aXNpYmx5IHNob3cgdGhlbQoJCQkJLy8gaG93ZXZlciwgaXQgbXVzdCBoYXZlIGEgY3VycmVudCBkaXNwbGF5IHN0eWxlIHRoYXQgd291bGQgYmVuZWZpdCBmcm9tIHRoaXMKCQkJCXJldHVybiBlbGVtLm9mZnNldFdpZHRoID09PSAwICYmIHJkaXNwbGF5c3dhcC50ZXN0KCBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKSApID8KCQkJCQlqUXVlcnkuc3dhcCggZWxlbSwgY3NzU2hvdywgZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiBnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQkJCX0pIDoKCQkJCQlnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQl9CgkJfSwKCgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIGV4dHJhICkgewoJCQl2YXIgc3R5bGVzID0gZXh0cmEgJiYgZ2V0U3R5bGVzKCBlbGVtICk7CgkJCXJldHVybiBzZXRQb3NpdGl2ZU51bWJlciggZWxlbSwgdmFsdWUsIGV4dHJhID8KCQkJCWF1Z21lbnRXaWR0aE9ySGVpZ2h0KAoJCQkJCWVsZW0sCgkJCQkJbmFtZSwKCQkJCQlleHRyYSwKCQkJCQlqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmcgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImJveFNpemluZyIsIGZhbHNlLCBzdHlsZXMgKSA9PT0gImJvcmRlci1ib3giLAoJCQkJCXN0eWxlcwoJCQkJKSA6IDAKCQkJKTsKCQl9Cgl9Owp9KTsKCmlmICggIWpRdWVyeS5zdXBwb3J0Lm9wYWNpdHkgKSB7CglqUXVlcnkuY3NzSG9va3Mub3BhY2l0eSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJLy8gSUUgdXNlcyBmaWx0ZXJzIGZvciBvcGFjaXR5CgkJCXJldHVybiByb3BhY2l0eS50ZXN0KCAoY29tcHV0ZWQgJiYgZWxlbS5jdXJyZW50U3R5bGUgPyBlbGVtLmN1cnJlbnRTdHlsZS5maWx0ZXIgOiBlbGVtLnN0eWxlLmZpbHRlcikgfHwgIiIgKSA/CgkJCQkoIDAuMDEgKiBwYXJzZUZsb2F0KCBSZWdFeHAuJDEgKSApICsgIiIgOgoJCQkJY29tcHV0ZWQgPyAiMSIgOiAiIjsKCQl9LAoKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJdmFyIHN0eWxlID0gZWxlbS5zdHlsZSwKCQkJCWN1cnJlbnRTdHlsZSA9IGVsZW0uY3VycmVudFN0eWxlLAoJCQkJb3BhY2l0eSA9IGpRdWVyeS5pc051bWVyaWMoIHZhbHVlICkgPyAiYWxwaGEob3BhY2l0eT0iICsgdmFsdWUgKiAxMDAgKyAiKSIgOiAiIiwKCQkJCWZpbHRlciA9IGN1cnJlbnRTdHlsZSAmJiBjdXJyZW50U3R5bGUuZmlsdGVyIHx8IHN0eWxlLmZpbHRlciB8fCAiIjsKCgkJCS8vIElFIGhhcyB0cm91YmxlIHdpdGggb3BhY2l0eSBpZiBpdCBkb2VzIG5vdCBoYXZlIGxheW91dAoJCQkvLyBGb3JjZSBpdCBieSBzZXR0aW5nIHRoZSB6b29tIGxldmVsCgkJCXN0eWxlLnpvb20gPSAxOwoKCQkJLy8gaWYgc2V0dGluZyBvcGFjaXR5IHRvIDEsIGFuZCBubyBvdGhlciBmaWx0ZXJzIGV4aXN0IC0gYXR0ZW1wdCB0byByZW1vdmUgZmlsdGVyIGF0dHJpYnV0ZSAjNjY1MgoJCQkvLyBpZiB2YWx1ZSA9PT0gIiIsIHRoZW4gcmVtb3ZlIGlubGluZSBvcGFjaXR5ICMxMjY4NQoJCQlpZiAoICggdmFsdWUgPj0gMSB8fCB2YWx1ZSA9PT0gIiIgKSAmJgoJCQkJCWpRdWVyeS50cmltKCBmaWx0ZXIucmVwbGFjZSggcmFscGhhLCAiIiApICkgPT09ICIiICYmCgkJCQkJc3R5bGUucmVtb3ZlQXR0cmlidXRlICkgewoKCQkJCS8vIFNldHRpbmcgc3R5bGUuZmlsdGVyIHRvIG51bGwsICIiICYgIiAiIHN0aWxsIGxlYXZlICJmaWx0ZXI6IiBpbiB0aGUgY3NzVGV4dAoJCQkJLy8gaWYgImZpbHRlcjoiIGlzIHByZXNlbnQgYXQgYWxsLCBjbGVhclR5cGUgaXMgZGlzYWJsZWQsIHdlIHdhbnQgdG8gYXZvaWQgdGhpcwoJCQkJLy8gc3R5bGUucmVtb3ZlQXR0cmlidXRlIGlzIElFIE9ubHksIGJ1dCBzbyBhcHBhcmVudGx5IGlzIHRoaXMgY29kZSBwYXRoLi4uCgkJCQlzdHlsZS5yZW1vdmVBdHRyaWJ1dGUoICJmaWx0ZXIiICk7CgoJCQkJLy8gaWYgdGhlcmUgaXMgbm8gZmlsdGVyIHN0eWxlIGFwcGxpZWQgaW4gYSBjc3MgcnVsZSBvciB1bnNldCBpbmxpbmUgb3BhY2l0eSwgd2UgYXJlIGRvbmUKCQkJCWlmICggdmFsdWUgPT09ICIiIHx8IGN1cnJlbnRTdHlsZSAmJiAhY3VycmVudFN0eWxlLmZpbHRlciApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCX0KCgkJCS8vIG90aGVyd2lzZSwgc2V0IG5ldyBmaWx0ZXIgdmFsdWVzCgkJCXN0eWxlLmZpbHRlciA9IHJhbHBoYS50ZXN0KCBmaWx0ZXIgKSA/CgkJCQlmaWx0ZXIucmVwbGFjZSggcmFscGhhLCBvcGFjaXR5ICkgOgoJCQkJZmlsdGVyICsgIiAiICsgb3BhY2l0eTsKCQl9Cgl9Owp9CgovLyBUaGVzZSBob29rcyBjYW5ub3QgYmUgYWRkZWQgdW50aWwgRE9NIHJlYWR5IGJlY2F1c2UgdGhlIHN1cHBvcnQgdGVzdAovLyBmb3IgaXQgaXMgbm90IHJ1biB1bnRpbCBhZnRlciBET00gcmVhZHkKalF1ZXJ5KGZ1bmN0aW9uKCkgewoJaWYgKCAhalF1ZXJ5LnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCApIHsKCQlqUXVlcnkuY3NzSG9va3MubWFyZ2luUmlnaHQgPSB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkvLyBXZWJLaXQgQnVnIDEzMzQzIC0gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHdyb25nIHZhbHVlIGZvciBtYXJnaW4tcmlnaHQKCQkJCQkvLyBXb3JrIGFyb3VuZCBieSB0ZW1wb3JhcmlseSBzZXR0aW5nIGVsZW1lbnQgZGlzcGxheSB0byBpbmxpbmUtYmxvY2sKCQkJCQlyZXR1cm4galF1ZXJ5LnN3YXAoIGVsZW0sIHsgImRpc3BsYXkiOiAiaW5saW5lLWJsb2NrIiB9LAoJCQkJCQljdXJDU1MsIFsgZWxlbSwgIm1hcmdpblJpZ2h0IiBdICk7CgkJCQl9CgkJCX0KCQl9OwoJfQoKCS8vIFdlYmtpdCBidWc6IGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0yOTA4NAoJLy8gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHBlcmNlbnQgd2hlbiBzcGVjaWZpZWQgZm9yIHRvcC9sZWZ0L2JvdHRvbS9yaWdodAoJLy8gcmF0aGVyIHRoYW4gbWFrZSB0aGUgY3NzIG1vZHVsZSBkZXBlbmQgb24gdGhlIG9mZnNldCBtb2R1bGUsIHdlIGp1c3QgY2hlY2sgZm9yIGl0IGhlcmUKCWlmICggIWpRdWVyeS5zdXBwb3J0LnBpeGVsUG9zaXRpb24gJiYgalF1ZXJ5LmZuLnBvc2l0aW9uICkgewoJCWpRdWVyeS5lYWNoKCBbICJ0b3AiLCAibGVmdCIgXSwgZnVuY3Rpb24oIGksIHByb3AgKSB7CgkJCWpRdWVyeS5jc3NIb29rc1sgcHJvcCBdID0gewoJCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7CgkJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkJY29tcHV0ZWQgPSBjdXJDU1MoIGVsZW0sIHByb3AgKTsKCQkJCQkJLy8gaWYgY3VyQ1NTIHJldHVybnMgcGVyY2VudGFnZSwgZmFsbGJhY2sgdG8gb2Zmc2V0CgkJCQkJCXJldHVybiBybnVtbm9ucHgudGVzdCggY29tcHV0ZWQgKSA/CgkJCQkJCQlqUXVlcnkoIGVsZW0gKS5wb3NpdGlvbigpWyBwcm9wIF0gKyAicHgiIDoKCQkJCQkJCWNvbXB1dGVkOwoJCQkJCX0KCQkJCX0KCQkJfTsKCQl9KTsKCX0KCn0pOwoKaWYgKCBqUXVlcnkuZXhwciAmJiBqUXVlcnkuZXhwci5maWx0ZXJzICkgewoJalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiggZWxlbSApIHsKCQkvLyBTdXBwb3J0OiBPcGVyYSA8PSAxMi4xMgoJCS8vIE9wZXJhIHJlcG9ydHMgb2Zmc2V0V2lkdGhzIGFuZCBvZmZzZXRIZWlnaHRzIGxlc3MgdGhhbiB6ZXJvIG9uIHNvbWUgZWxlbWVudHMKCQlyZXR1cm4gZWxlbS5vZmZzZXRXaWR0aCA8PSAwICYmIGVsZW0ub2Zmc2V0SGVpZ2h0IDw9IDAgfHwKCQkJKCFqUXVlcnkuc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMgJiYgKChlbGVtLnN0eWxlICYmIGVsZW0uc3R5bGUuZGlzcGxheSkgfHwgalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkpID09PSAibm9uZSIpOwoJfTsKCglqUXVlcnkuZXhwci5maWx0ZXJzLnZpc2libGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gIWpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuKCBlbGVtICk7Cgl9Owp9CgovLyBUaGVzZSBob29rcyBhcmUgdXNlZCBieSBhbmltYXRlIHRvIGV4cGFuZCBwcm9wZXJ0aWVzCmpRdWVyeS5lYWNoKHsKCW1hcmdpbjogIiIsCglwYWRkaW5nOiAiIiwKCWJvcmRlcjogIldpZHRoIgp9LCBmdW5jdGlvbiggcHJlZml4LCBzdWZmaXggKSB7CglqUXVlcnkuY3NzSG9va3NbIHByZWZpeCArIHN1ZmZpeCBdID0gewoJCWV4cGFuZDogZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgaSA9IDAsCgkJCQlleHBhbmRlZCA9IHt9LAoKCQkJCS8vIGFzc3VtZXMgYSBzaW5nbGUgbnVtYmVyIGlmIG5vdCBhIHN0cmluZwoJCQkJcGFydHMgPSB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciID8gdmFsdWUuc3BsaXQoIiAiKSA6IFsgdmFsdWUgXTsKCgkJCWZvciAoIDsgaSA8IDQ7IGkrKyApIHsKCQkJCWV4cGFuZGVkWyBwcmVmaXggKyBjc3NFeHBhbmRbIGkgXSArIHN1ZmZpeCBdID0KCQkJCQlwYXJ0c1sgaSBdIHx8IHBhcnRzWyBpIC0gMiBdIHx8IHBhcnRzWyAwIF07CgkJCX0KCgkJCXJldHVybiBleHBhbmRlZDsKCQl9Cgl9OwoKCWlmICggIXJtYXJnaW4udGVzdCggcHJlZml4ICkgKSB7CgkJalF1ZXJ5LmNzc0hvb2tzWyBwcmVmaXggKyBzdWZmaXggXS5zZXQgPSBzZXRQb3NpdGl2ZU51bWJlcjsKCX0KfSk7CnZhciByMjAgPSAvJTIwL2csCglyYnJhY2tldCA9IC9cW1xdJC8sCglyQ1JMRiA9IC9ccj9cbi9nLAoJcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAoJcnN1Ym1pdHRhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglzZXJpYWxpemU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBqUXVlcnkucGFyYW0oIHRoaXMuc2VyaWFsaXplQXJyYXkoKSApOwoJfSwKCXNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXsKCQkJLy8gQ2FuIGFkZCBwcm9wSG9vayBmb3IgImVsZW1lbnRzIiB0byBmaWx0ZXIgb3IgYWRkIGZvcm0gZWxlbWVudHMKCQkJdmFyIGVsZW1lbnRzID0galF1ZXJ5LnByb3AoIHRoaXMsICJlbGVtZW50cyIgKTsKCQkJcmV0dXJuIGVsZW1lbnRzID8galF1ZXJ5Lm1ha2VBcnJheSggZWxlbWVudHMgKSA6IHRoaXM7CgkJfSkKCQkuZmlsdGVyKGZ1bmN0aW9uKCl7CgkJCXZhciB0eXBlID0gdGhpcy50eXBlOwoJCQkvLyBVc2UgLmlzKCI6ZGlzYWJsZWQiKSBzbyB0aGF0IGZpZWxkc2V0W2Rpc2FibGVkXSB3b3JrcwoJCQlyZXR1cm4gdGhpcy5uYW1lICYmICFqUXVlcnkoIHRoaXMgKS5pcyggIjpkaXNhYmxlZCIgKSAmJgoJCQkJcnN1Ym1pdHRhYmxlLnRlc3QoIHRoaXMubm9kZU5hbWUgKSAmJiAhcnN1Ym1pdHRlclR5cGVzLnRlc3QoIHR5cGUgKSAmJgoJCQkJKCB0aGlzLmNoZWNrZWQgfHwgIW1hbmlwdWxhdGlvbl9yY2hlY2thYmxlVHlwZS50ZXN0KCB0eXBlICkgKTsKCQl9KQoJCS5tYXAoZnVuY3Rpb24oIGksIGVsZW0gKXsKCQkJdmFyIHZhbCA9IGpRdWVyeSggdGhpcyApLnZhbCgpOwoKCQkJcmV0dXJuIHZhbCA9PSBudWxsID8KCQkJCW51bGwgOgoJCQkJalF1ZXJ5LmlzQXJyYXkoIHZhbCApID8KCQkJCQlqUXVlcnkubWFwKCB2YWwsIGZ1bmN0aW9uKCB2YWwgKXsKCQkJCQkJcmV0dXJuIHsgbmFtZTogZWxlbS5uYW1lLCB2YWx1ZTogdmFsLnJlcGxhY2UoIHJDUkxGLCAiXHJcbiIgKSB9OwoJCQkJCX0pIDoKCQkJCQl7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQl9KS5nZXQoKTsKCX0KfSk7CgovL1NlcmlhbGl6ZSBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzIG9yIGEgc2V0IG9mCi8va2V5L3ZhbHVlcyBpbnRvIGEgcXVlcnkgc3RyaW5nCmpRdWVyeS5wYXJhbSA9IGZ1bmN0aW9uKCBhLCB0cmFkaXRpb25hbCApIHsKCXZhciBwcmVmaXgsCgkJcyA9IFtdLAoJCWFkZCA9IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQkvLyBJZiB2YWx1ZSBpcyBhIGZ1bmN0aW9uLCBpbnZva2UgaXQgYW5kIHJldHVybiBpdHMgdmFsdWUKCQkJdmFsdWUgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSA/IHZhbHVlKCkgOiAoIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICk7CgkJCXNbIHMubGVuZ3RoIF0gPSBlbmNvZGVVUklDb21wb25lbnQoIGtleSApICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KCB2YWx1ZSApOwoJCX07CgoJLy8gU2V0IHRyYWRpdGlvbmFsIHRvIHRydWUgZm9yIGpRdWVyeSA8PSAxLjMuMiBiZWhhdmlvci4KCWlmICggdHJhZGl0aW9uYWwgPT09IHVuZGVmaW5lZCApIHsKCQl0cmFkaXRpb25hbCA9IGpRdWVyeS5hamF4U2V0dGluZ3MgJiYgalF1ZXJ5LmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbDsKCX0KCgkvLyBJZiBhbiBhcnJheSB3YXMgcGFzc2VkIGluLCBhc3N1bWUgdGhhdCBpdCBpcyBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzLgoJaWYgKCBqUXVlcnkuaXNBcnJheSggYSApIHx8ICggYS5qcXVlcnkgJiYgIWpRdWVyeS5pc1BsYWluT2JqZWN0KCBhICkgKSApIHsKCQkvLyBTZXJpYWxpemUgdGhlIGZvcm0gZWxlbWVudHMKCQlqUXVlcnkuZWFjaCggYSwgZnVuY3Rpb24oKSB7CgkJCWFkZCggdGhpcy5uYW1lLCB0aGlzLnZhbHVlICk7CgkJfSk7CgoJfSBlbHNlIHsKCQkvLyBJZiB0cmFkaXRpb25hbCwgZW5jb2RlIHRoZSAib2xkIiB3YXkgKHRoZSB3YXkgMS4zLjIgb3Igb2xkZXIKCQkvLyBkaWQgaXQpLCBvdGhlcndpc2UgZW5jb2RlIHBhcmFtcyByZWN1cnNpdmVseS4KCQlmb3IgKCBwcmVmaXggaW4gYSApIHsKCQkJYnVpbGRQYXJhbXMoIHByZWZpeCwgYVsgcHJlZml4IF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSByZXN1bHRpbmcgc2VyaWFsaXphdGlvbgoJcmV0dXJuIHMuam9pbiggIiYiICkucmVwbGFjZSggcjIwLCAiKyIgKTsKfTsKCmZ1bmN0aW9uIGJ1aWxkUGFyYW1zKCBwcmVmaXgsIG9iaiwgdHJhZGl0aW9uYWwsIGFkZCApIHsKCXZhciBuYW1lOwoKCWlmICggalF1ZXJ5LmlzQXJyYXkoIG9iaiApICkgewoJCS8vIFNlcmlhbGl6ZSBhcnJheSBpdGVtLgoJCWpRdWVyeS5lYWNoKCBvYmosIGZ1bmN0aW9uKCBpLCB2ICkgewoJCQlpZiAoIHRyYWRpdGlvbmFsIHx8IHJicmFja2V0LnRlc3QoIHByZWZpeCApICkgewoJCQkJLy8gVHJlYXQgZWFjaCBhcnJheSBpdGVtIGFzIGEgc2NhbGFyLgoJCQkJYWRkKCBwcmVmaXgsIHYgKTsKCgkJCX0gZWxzZSB7CgkJCQkvLyBJdGVtIGlzIG5vbi1zY2FsYXIgKGFycmF5IG9yIG9iamVjdCksIGVuY29kZSBpdHMgbnVtZXJpYyBpbmRleC4KCQkJCWJ1aWxkUGFyYW1zKCBwcmVmaXggKyAiWyIgKyAoIHR5cGVvZiB2ID09PSAib2JqZWN0IiA/IGkgOiAiIiApICsgIl0iLCB2LCB0cmFkaXRpb25hbCwgYWRkICk7CgkJCX0KCQl9KTsKCgl9IGVsc2UgaWYgKCAhdHJhZGl0aW9uYWwgJiYgalF1ZXJ5LnR5cGUoIG9iaiApID09PSAib2JqZWN0IiApIHsKCQkvLyBTZXJpYWxpemUgb2JqZWN0IGl0ZW0uCgkJZm9yICggbmFtZSBpbiBvYmogKSB7CgkJCWJ1aWxkUGFyYW1zKCBwcmVmaXggKyAiWyIgKyBuYW1lICsgIl0iLCBvYmpbIG5hbWUgXSwgdHJhZGl0aW9uYWwsIGFkZCApOwoJCX0KCgl9IGVsc2UgewoJCS8vIFNlcmlhbGl6ZSBzY2FsYXIgaXRlbS4KCQlhZGQoIHByZWZpeCwgb2JqICk7Cgl9Cn0KalF1ZXJ5LmVhY2goICgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgIiArCgkibW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgIiArCgkiY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIpLnNwbGl0KCIgIiksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoKCS8vIEhhbmRsZSBldmVudCBiaW5kaW5nCglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDAgPwoJCQl0aGlzLm9uKCBuYW1lLCBudWxsLCBkYXRhLCBmbiApIDoKCQkJdGhpcy50cmlnZ2VyKCBuYW1lICk7Cgl9Owp9KTsKCmpRdWVyeS5mbi5ob3ZlciA9IGZ1bmN0aW9uKCBmbk92ZXIsIGZuT3V0ICkgewoJcmV0dXJuIHRoaXMubW91c2VlbnRlciggZm5PdmVyICkubW91c2VsZWF2ZSggZm5PdXQgfHwgZm5PdmVyICk7Cn07CnZhcgoJLy8gRG9jdW1lbnQgbG9jYXRpb24KCWFqYXhMb2NQYXJ0cywKCWFqYXhMb2NhdGlvbiwKCWFqYXhfbm9uY2UgPSBqUXVlcnkubm93KCksCgoJYWpheF9ycXVlcnkgPSAvXD8vLAoJcmhhc2ggPSAvIy4qJC8sCglydHMgPSAvKFs/Jl0pXz1bXiZdKi8sCglyaGVhZGVycyA9IC9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKVxyPyQvbWcsIC8vIElFIGxlYXZlcyBhbiBcciBjaGFyYWN0ZXIgYXQgRU9MCgkvLyAjNzY1MywgIzgxMjUsICM4MTUyOiBsb2NhbCBwcm90b2NvbCBkZXRlY3Rpb24KCXJsb2NhbFByb3RvY29sID0gL14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8sCglybm9Db250ZW50ID0gL14oPzpHRVR8SEVBRCkkLywKCXJwcm90b2NvbCA9IC9eXC9cLy8sCglydXJsID0gL14oW1x3ListXSs6KSg/OlwvXC8oW15cLz8jOl0qKSg/OjooXGQrKXwpfCkvLAoKCS8vIEtlZXAgYSBjb3B5IG9mIHRoZSBvbGQgbG9hZCBtZXRob2QKCV9sb2FkID0galF1ZXJ5LmZuLmxvYWQsCgoJLyogUHJlZmlsdGVycwoJICogMSkgVGhleSBhcmUgdXNlZnVsIHRvIGludHJvZHVjZSBjdXN0b20gZGF0YVR5cGVzIChzZWUgYWpheC9qc29ucC5qcyBmb3IgYW4gZXhhbXBsZSkKCSAqIDIpIFRoZXNlIGFyZSBjYWxsZWQ6CgkgKiAgICAtIEJFRk9SRSBhc2tpbmcgZm9yIGEgdHJhbnNwb3J0CgkgKiAgICAtIEFGVEVSIHBhcmFtIHNlcmlhbGl6YXRpb24gKHMuZGF0YSBpcyBhIHN0cmluZyBpZiBzLnByb2Nlc3NEYXRhIGlzIHRydWUpCgkgKiAzKSBrZXkgaXMgdGhlIGRhdGFUeXBlCgkgKiA0KSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJICogNSkgZXhlY3V0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gY29udGludWUgZG93biB0byAiKiIgaWYgbmVlZGVkCgkgKi8KCXByZWZpbHRlcnMgPSB7fSwKCgkvKiBUcmFuc3BvcnRzIGJpbmRpbmdzCgkgKiAxKSBrZXkgaXMgdGhlIGRhdGFUeXBlCgkgKiAyKSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJICogMykgc2VsZWN0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gZ28gdG8gIioiIGlmIG5lZWRlZAoJICovCgl0cmFuc3BvcnRzID0ge30sCgoJLy8gQXZvaWQgY29tbWVudC1wcm9sb2cgY2hhciBzZXF1ZW5jZSAoIzEwMDk4KTsgbXVzdCBhcHBlYXNlIGxpbnQgYW5kIGV2YWRlIGNvbXByZXNzaW9uCglhbGxUeXBlcyA9ICIqLyIuY29uY2F0KCIqIik7CgovLyAjODEzOCwgSUUgbWF5IHRocm93IGFuIGV4Y2VwdGlvbiB3aGVuIGFjY2Vzc2luZwovLyBhIGZpZWxkIGZyb20gd2luZG93LmxvY2F0aW9uIGlmIGRvY3VtZW50LmRvbWFpbiBoYXMgYmVlbiBzZXQKdHJ5IHsKCWFqYXhMb2NhdGlvbiA9IGxvY2F0aW9uLmhyZWY7Cn0gY2F0Y2goIGUgKSB7CgkvLyBVc2UgdGhlIGhyZWYgYXR0cmlidXRlIG9mIGFuIEEgZWxlbWVudAoJLy8gc2luY2UgSUUgd2lsbCBtb2RpZnkgaXQgZ2l2ZW4gZG9jdW1lbnQubG9jYXRpb24KCWFqYXhMb2NhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJhIiApOwoJYWpheExvY2F0aW9uLmhyZWYgPSAiIjsKCWFqYXhMb2NhdGlvbiA9IGFqYXhMb2NhdGlvbi5ocmVmOwp9CgovLyBTZWdtZW50IGxvY2F0aW9uIGludG8gcGFydHMKYWpheExvY1BhcnRzID0gcnVybC5leGVjKCBhamF4TG9jYXRpb24udG9Mb3dlckNhc2UoKSApIHx8IFtdOwoKLy8gQmFzZSAiY29uc3RydWN0b3IiIGZvciBqUXVlcnkuYWpheFByZWZpbHRlciBhbmQgalF1ZXJ5LmFqYXhUcmFuc3BvcnQKZnVuY3Rpb24gYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUgKSB7CgoJLy8gZGF0YVR5cGVFeHByZXNzaW9uIGlzIG9wdGlvbmFsIGFuZCBkZWZhdWx0cyB0byAiKiIKCXJldHVybiBmdW5jdGlvbiggZGF0YVR5cGVFeHByZXNzaW9uLCBmdW5jICkgewoKCQlpZiAoIHR5cGVvZiBkYXRhVHlwZUV4cHJlc3Npb24gIT09ICJzdHJpbmciICkgewoJCQlmdW5jID0gZGF0YVR5cGVFeHByZXNzaW9uOwoJCQlkYXRhVHlwZUV4cHJlc3Npb24gPSAiKiI7CgkJfQoKCQl2YXIgZGF0YVR5cGUsCgkJCWkgPSAwLAoJCQlkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbXTsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZnVuYyApICkgewoJCQkvLyBGb3IgZWFjaCBkYXRhVHlwZSBpbiB0aGUgZGF0YVR5cGVFeHByZXNzaW9uCgkJCXdoaWxlICggKGRhdGFUeXBlID0gZGF0YVR5cGVzW2krK10pICkgewoJCQkJLy8gUHJlcGVuZCBpZiByZXF1ZXN0ZWQKCQkJCWlmICggZGF0YVR5cGVbMF0gPT09ICIrIiApIHsKCQkJCQlkYXRhVHlwZSA9IGRhdGFUeXBlLnNsaWNlKCAxICkgfHwgIioiOwoJCQkJCShzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10pLnVuc2hpZnQoIGZ1bmMgKTsKCgkJCQkvLyBPdGhlcndpc2UgYXBwZW5kCgkJCQl9IGVsc2UgewoJCQkJCShzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10pLnB1c2goIGZ1bmMgKTsKCQkJCX0KCQkJfQoJCX0KCX07Cn0KCi8vIEJhc2UgaW5zcGVjdGlvbiBmdW5jdGlvbiBmb3IgcHJlZmlsdGVycyBhbmQgdHJhbnNwb3J0cwpmdW5jdGlvbiBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggc3RydWN0dXJlLCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSICkgewoKCXZhciBpbnNwZWN0ZWQgPSB7fSwKCQlzZWVraW5nVHJhbnNwb3J0ID0gKCBzdHJ1Y3R1cmUgPT09IHRyYW5zcG9ydHMgKTsKCglmdW5jdGlvbiBpbnNwZWN0KCBkYXRhVHlwZSApIHsKCQl2YXIgc2VsZWN0ZWQ7CgkJaW5zcGVjdGVkWyBkYXRhVHlwZSBdID0gdHJ1ZTsKCQlqUXVlcnkuZWFjaCggc3RydWN0dXJlWyBkYXRhVHlwZSBdIHx8IFtdLCBmdW5jdGlvbiggXywgcHJlZmlsdGVyT3JGYWN0b3J5ICkgewoJCQl2YXIgZGF0YVR5cGVPclRyYW5zcG9ydCA9IHByZWZpbHRlck9yRmFjdG9yeSggb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiApOwoJCQlpZiggdHlwZW9mIGRhdGFUeXBlT3JUcmFuc3BvcnQgPT09ICJzdHJpbmciICYmICFzZWVraW5nVHJhbnNwb3J0ICYmICFpbnNwZWN0ZWRbIGRhdGFUeXBlT3JUcmFuc3BvcnQgXSApIHsKCQkJCW9wdGlvbnMuZGF0YVR5cGVzLnVuc2hpZnQoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCWluc3BlY3QoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfSBlbHNlIGlmICggc2Vla2luZ1RyYW5zcG9ydCApIHsKCQkJCXJldHVybiAhKCBzZWxlY3RlZCA9IGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJfQoJCX0pOwoJCXJldHVybiBzZWxlY3RlZDsKCX0KCglyZXR1cm4gaW5zcGVjdCggb3B0aW9ucy5kYXRhVHlwZXNbIDAgXSApIHx8ICFpbnNwZWN0ZWRbICIqIiBdICYmIGluc3BlY3QoICIqIiApOwp9CgovLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnMKLy8gdGhhdCB0YWtlcyAiZmxhdCIgb3B0aW9ucyAobm90IHRvIGJlIGRlZXAgZXh0ZW5kZWQpCi8vIEZpeGVzICM5ODg3CmZ1bmN0aW9uIGFqYXhFeHRlbmQoIHRhcmdldCwgc3JjICkgewoJdmFyIGRlZXAsIGtleSwKCQlmbGF0T3B0aW9ucyA9IGpRdWVyeS5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307CgoJZm9yICgga2V5IGluIHNyYyApIHsKCQlpZiAoIHNyY1sga2V5IF0gIT09IHVuZGVmaW5lZCApIHsKCQkJKCBmbGF0T3B0aW9uc1sga2V5IF0gPyB0YXJnZXQgOiAoIGRlZXAgfHwgKGRlZXAgPSB7fSkgKSApWyBrZXkgXSA9IHNyY1sga2V5IF07CgkJfQoJfQoJaWYgKCBkZWVwICkgewoJCWpRdWVyeS5leHRlbmQoIHRydWUsIHRhcmdldCwgZGVlcCApOwoJfQoKCXJldHVybiB0YXJnZXQ7Cn0KCmpRdWVyeS5mbi5sb2FkID0gZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsKCWlmICggdHlwZW9mIHVybCAhPT0gInN0cmluZyIgJiYgX2xvYWQgKSB7CgkJcmV0dXJuIF9sb2FkLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCX0KCgl2YXIgc2VsZWN0b3IsIHJlc3BvbnNlLCB0eXBlLAoJCXNlbGYgPSB0aGlzLAoJCW9mZiA9IHVybC5pbmRleE9mKCIgIik7CgoJaWYgKCBvZmYgPj0gMCApIHsKCQlzZWxlY3RvciA9IHVybC5zbGljZSggb2ZmLCB1cmwubGVuZ3RoICk7CgkJdXJsID0gdXJsLnNsaWNlKCAwLCBvZmYgKTsKCX0KCgkvLyBJZiBpdCdzIGEgZnVuY3Rpb24KCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHBhcmFtcyApICkgewoKCQkvLyBXZSBhc3N1bWUgdGhhdCBpdCdzIHRoZSBjYWxsYmFjawoJCWNhbGxiYWNrID0gcGFyYW1zOwoJCXBhcmFtcyA9IHVuZGVmaW5lZDsKCgkvLyBPdGhlcndpc2UsIGJ1aWxkIGEgcGFyYW0gc3RyaW5nCgl9IGVsc2UgaWYgKCBwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcyA9PT0gIm9iamVjdCIgKSB7CgkJdHlwZSA9ICJQT1NUIjsKCX0KCgkvLyBJZiB3ZSBoYXZlIGVsZW1lbnRzIHRvIG1vZGlmeSwgbWFrZSB0aGUgcmVxdWVzdAoJaWYgKCBzZWxmLmxlbmd0aCA+IDAgKSB7CgkJalF1ZXJ5LmFqYXgoewoJCQl1cmw6IHVybCwKCgkJCS8vIGlmICJ0eXBlIiB2YXJpYWJsZSBpcyB1bmRlZmluZWQsIHRoZW4gIkdFVCIgbWV0aG9kIHdpbGwgYmUgdXNlZAoJCQl0eXBlOiB0eXBlLAoJCQlkYXRhVHlwZTogImh0bWwiLAoJCQlkYXRhOiBwYXJhbXMKCQl9KS5kb25lKGZ1bmN0aW9uKCByZXNwb25zZVRleHQgKSB7CgoJCQkvLyBTYXZlIHJlc3BvbnNlIGZvciB1c2UgaW4gY29tcGxldGUgY2FsbGJhY2sKCQkJcmVzcG9uc2UgPSBhcmd1bWVudHM7CgoJCQlzZWxmLmh0bWwoIHNlbGVjdG9yID8KCgkJCQkvLyBJZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWQsIGxvY2F0ZSB0aGUgcmlnaHQgZWxlbWVudHMgaW4gYSBkdW1teSBkaXYKCQkJCS8vIEV4Y2x1ZGUgc2NyaXB0cyB0byBhdm9pZCBJRSAnUGVybWlzc2lvbiBEZW5pZWQnIGVycm9ycwoJCQkJalF1ZXJ5KCI8ZGl2PiIpLmFwcGVuZCggalF1ZXJ5LnBhcnNlSFRNTCggcmVzcG9uc2VUZXh0ICkgKS5maW5kKCBzZWxlY3RvciApIDoKCgkJCQkvLyBPdGhlcndpc2UgdXNlIHRoZSBmdWxsIHJlc3VsdAoJCQkJcmVzcG9uc2VUZXh0ICk7CgoJCX0pLmNvbXBsZXRlKCBjYWxsYmFjayAmJiBmdW5jdGlvbigganFYSFIsIHN0YXR1cyApIHsKCQkJc2VsZi5lYWNoKCBjYWxsYmFjaywgcmVzcG9uc2UgfHwgWyBqcVhIUi5yZXNwb25zZVRleHQsIHN0YXR1cywganFYSFIgXSApOwoJCX0pOwoJfQoKCXJldHVybiB0aGlzOwp9OwoKLy8gQXR0YWNoIGEgYnVuY2ggb2YgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBjb21tb24gQUpBWCBldmVudHMKalF1ZXJ5LmVhY2goIFsgImFqYXhTdGFydCIsICJhamF4U3RvcCIsICJhamF4Q29tcGxldGUiLCAiYWpheEVycm9yIiwgImFqYXhTdWNjZXNzIiwgImFqYXhTZW5kIiBdLCBmdW5jdGlvbiggaSwgdHlwZSApewoJalF1ZXJ5LmZuWyB0eXBlIF0gPSBmdW5jdGlvbiggZm4gKXsKCQlyZXR1cm4gdGhpcy5vbiggdHlwZSwgZm4gKTsKCX07Cn0pOwoKalF1ZXJ5LmVhY2goIFsgImdldCIsICJwb3N0IiBdLCBmdW5jdGlvbiggaSwgbWV0aG9kICkgewoJalF1ZXJ5WyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB1cmwsIGRhdGEsIGNhbGxiYWNrLCB0eXBlICkgewoJCS8vIHNoaWZ0IGFyZ3VtZW50cyBpZiBkYXRhIGFyZ3VtZW50IHdhcyBvbWl0dGVkCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZGF0YSApICkgewoJCQl0eXBlID0gdHlwZSB8fCBjYWxsYmFjazsKCQkJY2FsbGJhY2sgPSBkYXRhOwoJCQlkYXRhID0gdW5kZWZpbmVkOwoJCX0KCgkJcmV0dXJuIGpRdWVyeS5hamF4KHsKCQkJdXJsOiB1cmwsCgkJCXR5cGU6IG1ldGhvZCwKCQkJZGF0YVR5cGU6IHR5cGUsCgkJCWRhdGE6IGRhdGEsCgkJCXN1Y2Nlc3M6IGNhbGxiYWNrCgkJfSk7Cgl9Owp9KTsKCmpRdWVyeS5leHRlbmQoewoKCS8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllcwoJYWN0aXZlOiAwLAoKCS8vIExhc3QtTW9kaWZpZWQgaGVhZGVyIGNhY2hlIGZvciBuZXh0IHJlcXVlc3QKCWxhc3RNb2RpZmllZDoge30sCglldGFnOiB7fSwKCglhamF4U2V0dGluZ3M6IHsKCQl1cmw6IGFqYXhMb2NhdGlvbiwKCQl0eXBlOiAiR0VUIiwKCQlpc0xvY2FsOiBybG9jYWxQcm90b2NvbC50ZXN0KCBhamF4TG9jUGFydHNbIDEgXSApLAoJCWdsb2JhbDogdHJ1ZSwKCQlwcm9jZXNzRGF0YTogdHJ1ZSwKCQlhc3luYzogdHJ1ZSwKCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsCgkJLyoKCQl0aW1lb3V0OiAwLAoJCWRhdGE6IG51bGwsCgkJZGF0YVR5cGU6IG51bGwsCgkJdXNlcm5hbWU6IG51bGwsCgkJcGFzc3dvcmQ6IG51bGwsCgkJY2FjaGU6IG51bGwsCgkJdGhyb3dzOiBmYWxzZSwKCQl0cmFkaXRpb25hbDogZmFsc2UsCgkJaGVhZGVyczoge30sCgkJKi8KCgkJYWNjZXB0czogewoJCQkiKiI6IGFsbFR5cGVzLAoJCQl0ZXh0OiAidGV4dC9wbGFpbiIsCgkJCWh0bWw6ICJ0ZXh0L2h0bWwiLAoJCQl4bWw6ICJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sIiwKCQkJanNvbjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCIKCQl9LAoKCQljb250ZW50czogewoJCQl4bWw6IC94bWwvLAoJCQlodG1sOiAvaHRtbC8sCgkJCWpzb246IC9qc29uLwoJCX0sCgoJCXJlc3BvbnNlRmllbGRzOiB7CgkJCXhtbDogInJlc3BvbnNlWE1MIiwKCQkJdGV4dDogInJlc3BvbnNlVGV4dCIKCQl9LAoKCQkvLyBEYXRhIGNvbnZlcnRlcnMKCQkvLyBLZXlzIHNlcGFyYXRlIHNvdXJjZSAob3IgY2F0Y2hhbGwgIioiKSBhbmQgZGVzdGluYXRpb24gdHlwZXMgd2l0aCBhIHNpbmdsZSBzcGFjZQoJCWNvbnZlcnRlcnM6IHsKCgkJCS8vIENvbnZlcnQgYW55dGhpbmcgdG8gdGV4dAoJCQkiKiB0ZXh0Ijogd2luZG93LlN0cmluZywKCgkJCS8vIFRleHQgdG8gaHRtbCAodHJ1ZSA9IG5vIHRyYW5zZm9ybWF0aW9uKQoJCQkidGV4dCBodG1sIjogdHJ1ZSwKCgkJCS8vIEV2YWx1YXRlIHRleHQgYXMgYSBqc29uIGV4cHJlc3Npb24KCQkJInRleHQganNvbiI6IGpRdWVyeS5wYXJzZUpTT04sCgoJCQkvLyBQYXJzZSB0ZXh0IGFzIHhtbAoJCQkidGV4dCB4bWwiOiBqUXVlcnkucGFyc2VYTUwKCQl9LAoKCQkvLyBGb3Igb3B0aW9ucyB0aGF0IHNob3VsZG4ndCBiZSBkZWVwIGV4dGVuZGVkOgoJCS8vIHlvdSBjYW4gYWRkIHlvdXIgb3duIGN1c3RvbSBvcHRpb25zIGhlcmUgaWYKCQkvLyBhbmQgd2hlbiB5b3UgY3JlYXRlIG9uZSB0aGF0IHNob3VsZG4ndCBiZQoJCS8vIGRlZXAgZXh0ZW5kZWQgKHNlZSBhamF4RXh0ZW5kKQoJCWZsYXRPcHRpb25zOiB7CgkJCXVybDogdHJ1ZSwKCQkJY29udGV4dDogdHJ1ZQoJCX0KCX0sCgoJLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKCS8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KCS8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCglhamF4U2V0dXA6IGZ1bmN0aW9uKCB0YXJnZXQsIHNldHRpbmdzICkgewoJCXJldHVybiBzZXR0aW5ncyA/CgoJCQkvLyBCdWlsZGluZyBhIHNldHRpbmdzIG9iamVjdAoJCQlhamF4RXh0ZW5kKCBhamF4RXh0ZW5kKCB0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MgKSwgc2V0dGluZ3MgKSA6CgoJCQkvLyBFeHRlbmRpbmcgYWpheFNldHRpbmdzCgkJCWFqYXhFeHRlbmQoIGpRdWVyeS5hamF4U2V0dGluZ3MsIHRhcmdldCApOwoJfSwKCglhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMgKSwKCWFqYXhUcmFuc3BvcnQ6IGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cyApLAoKCS8vIE1haW4gbWV0aG9kCglhamF4OiBmdW5jdGlvbiggdXJsLCBvcHRpb25zICkgewoKCQkvLyBJZiB1cmwgaXMgYW4gb2JqZWN0LCBzaW11bGF0ZSBwcmUtMS41IHNpZ25hdHVyZQoJCWlmICggdHlwZW9mIHVybCA9PT0gIm9iamVjdCIgKSB7CgkJCW9wdGlvbnMgPSB1cmw7CgkJCXVybCA9IHVuZGVmaW5lZDsKCQl9CgoJCS8vIEZvcmNlIG9wdGlvbnMgdG8gYmUgYW4gb2JqZWN0CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCXZhciAvLyBDcm9zcy1kb21haW4gZGV0ZWN0aW9uIHZhcnMKCQkJcGFydHMsCgkJCS8vIExvb3AgdmFyaWFibGUKCQkJaSwKCQkJLy8gVVJMIHdpdGhvdXQgYW50aS1jYWNoZSBwYXJhbQoJCQljYWNoZVVSTCwKCQkJLy8gUmVzcG9uc2UgaGVhZGVycyBhcyBzdHJpbmcKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nLAoJCQkvLyB0aW1lb3V0IGhhbmRsZQoJCQl0aW1lb3V0VGltZXIsCgoJCQkvLyBUbyBrbm93IGlmIGdsb2JhbCBldmVudHMgYXJlIHRvIGJlIGRpc3BhdGNoZWQKCQkJZmlyZUdsb2JhbHMsCgoJCQl0cmFuc3BvcnQsCgkJCS8vIFJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzLAoJCQkvLyBDcmVhdGUgdGhlIGZpbmFsIG9wdGlvbnMgb2JqZWN0CgkJCXMgPSBqUXVlcnkuYWpheFNldHVwKCB7fSwgb3B0aW9ucyApLAoJCQkvLyBDYWxsYmFja3MgY29udGV4dAoJCQljYWxsYmFja0NvbnRleHQgPSBzLmNvbnRleHQgfHwgcywKCQkJLy8gQ29udGV4dCBmb3IgZ2xvYmFsIGV2ZW50cyBpcyBjYWxsYmFja0NvbnRleHQgaWYgaXQgaXMgYSBET00gbm9kZSBvciBqUXVlcnkgY29sbGVjdGlvbgoJCQlnbG9iYWxFdmVudENvbnRleHQgPSBzLmNvbnRleHQgJiYgKCBjYWxsYmFja0NvbnRleHQubm9kZVR5cGUgfHwgY2FsbGJhY2tDb250ZXh0LmpxdWVyeSApID8KCQkJCWpRdWVyeSggY2FsbGJhY2tDb250ZXh0ICkgOgoJCQkJalF1ZXJ5LmV2ZW50LAoJCQkvLyBEZWZlcnJlZHMKCQkJZGVmZXJyZWQgPSBqUXVlcnkuRGVmZXJyZWQoKSwKCQkJY29tcGxldGVEZWZlcnJlZCA9IGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksCgkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCXN0YXR1c0NvZGUgPSBzLnN0YXR1c0NvZGUgfHwge30sCgkJCS8vIEhlYWRlcnMgKHRoZXkgYXJlIHNlbnQgYWxsIGF0IG9uY2UpCgkJCXJlcXVlc3RIZWFkZXJzID0ge30sCgkJCXJlcXVlc3RIZWFkZXJzTmFtZXMgPSB7fSwKCQkJLy8gVGhlIGpxWEhSIHN0YXRlCgkJCXN0YXRlID0gMCwKCQkJLy8gRGVmYXVsdCBhYm9ydCBtZXNzYWdlCgkJCXN0ckFib3J0ID0gImNhbmNlbGVkIiwKCQkJLy8gRmFrZSB4aHIKCQkJanFYSFIgPSB7CgkJCQlyZWFkeVN0YXRlOiAwLAoKCQkJCS8vIEJ1aWxkcyBoZWFkZXJzIGhhc2h0YWJsZSBpZiBuZWVkZWQKCQkJCWdldFJlc3BvbnNlSGVhZGVyOiBmdW5jdGlvbigga2V5ICkgewoJCQkJCXZhciBtYXRjaDsKCQkJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJCQlpZiAoICFyZXNwb25zZUhlYWRlcnMgKSB7CgkJCQkJCQlyZXNwb25zZUhlYWRlcnMgPSB7fTsKCQkJCQkJCXdoaWxlICggKG1hdGNoID0gcmhlYWRlcnMuZXhlYyggcmVzcG9uc2VIZWFkZXJzU3RyaW5nICkpICkgewoJCQkJCQkJCXJlc3BvbnNlSGVhZGVyc1sgbWF0Y2hbMV0udG9Mb3dlckNhc2UoKSBdID0gbWF0Y2hbIDIgXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQltYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1sga2V5LnRvTG93ZXJDYXNlKCkgXTsKCQkJCQl9CgkJCQkJcmV0dXJuIG1hdGNoID09IG51bGwgPyBudWxsIDogbWF0Y2g7CgkJCQl9LAoKCQkJCS8vIFJhdyBzdHJpbmcKCQkJCWdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlID09PSAyID8gcmVzcG9uc2VIZWFkZXJzU3RyaW5nIDogbnVsbDsKCQkJCX0sCgoJCQkJLy8gQ2FjaGVzIHRoZSBoZWFkZXIKCQkJCXNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQkJCQl2YXIgbG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCW5hbWUgPSByZXF1ZXN0SGVhZGVyc05hbWVzWyBsbmFtZSBdID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSB8fCBuYW1lOwoJCQkJCQlyZXF1ZXN0SGVhZGVyc1sgbmFtZSBdID0gdmFsdWU7CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQkvLyBPdmVycmlkZXMgcmVzcG9uc2UgY29udGVudC10eXBlIGhlYWRlcgoJCQkJb3ZlcnJpZGVNaW1lVHlwZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCXMubWltZVR5cGUgPSB0eXBlOwoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MKCQkJCXN0YXR1c0NvZGU6IGZ1bmN0aW9uKCBtYXAgKSB7CgkJCQkJdmFyIGNvZGU7CgkJCQkJaWYgKCBtYXAgKSB7CgkJCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCQkJZm9yICggY29kZSBpbiBtYXAgKSB7CgkJCQkJCQkJLy8gTGF6eS1hZGQgdGhlIG5ldyBjYWxsYmFjayBpbiBhIHdheSB0aGF0IHByZXNlcnZlcyBvbGQgb25lcwoJCQkJCQkJCXN0YXR1c0NvZGVbIGNvZGUgXSA9IFsgc3RhdHVzQ29kZVsgY29kZSBdLCBtYXBbIGNvZGUgXSBdOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gRXhlY3V0ZSB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2tzCgkJCQkJCQlqcVhIUi5hbHdheXMoIG1hcFsganFYSFIuc3RhdHVzIF0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gQ2FuY2VsIHRoZSByZXF1ZXN0CgkJCQlhYm9ydDogZnVuY3Rpb24oIHN0YXR1c1RleHQgKSB7CgkJCQkJdmFyIGZpbmFsVGV4dCA9IHN0YXR1c1RleHQgfHwgc3RyQWJvcnQ7CgkJCQkJaWYgKCB0cmFuc3BvcnQgKSB7CgkJCQkJCXRyYW5zcG9ydC5hYm9ydCggZmluYWxUZXh0ICk7CgkJCQkJfQoJCQkJCWRvbmUoIDAsIGZpbmFsVGV4dCApOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfQoJCQl9OwoKCQkvLyBBdHRhY2ggZGVmZXJyZWRzCgkJZGVmZXJyZWQucHJvbWlzZSgganFYSFIgKS5jb21wbGV0ZSA9IGNvbXBsZXRlRGVmZXJyZWQuYWRkOwoJCWpxWEhSLnN1Y2Nlc3MgPSBqcVhIUi5kb25lOwoJCWpxWEhSLmVycm9yID0ganFYSFIuZmFpbDsKCgkJLy8gUmVtb3ZlIGhhc2ggY2hhcmFjdGVyICgjNzUzMTogYW5kIHN0cmluZyBwcm9tb3Rpb24pCgkJLy8gQWRkIHByb3RvY29sIGlmIG5vdCBwcm92aWRlZCAoIzU4NjY6IElFNyBpc3N1ZSB3aXRoIHByb3RvY29sLWxlc3MgdXJscykKCQkvLyBIYW5kbGUgZmFsc3kgdXJsIGluIHRoZSBzZXR0aW5ncyBvYmplY3QgKCMxMDA5MzogY29uc2lzdGVuY3kgd2l0aCBvbGQgc2lnbmF0dXJlKQoJCS8vIFdlIGFsc28gdXNlIHRoZSB1cmwgcGFyYW1ldGVyIGlmIGF2YWlsYWJsZQoJCXMudXJsID0gKCAoIHVybCB8fCBzLnVybCB8fCBhamF4TG9jYXRpb24gKSArICIiICkucmVwbGFjZSggcmhhc2gsICIiICkucmVwbGFjZSggcnByb3RvY29sLCBhamF4TG9jUGFydHNbIDEgXSArICIvLyIgKTsKCgkJLy8gQWxpYXMgbWV0aG9kIG9wdGlvbiB0byB0eXBlIGFzIHBlciB0aWNrZXQgIzEyMDA0CgkJcy50eXBlID0gb3B0aW9ucy5tZXRob2QgfHwgb3B0aW9ucy50eXBlIHx8IHMubWV0aG9kIHx8IHMudHlwZTsKCgkJLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdAoJCXMuZGF0YVR5cGVzID0galF1ZXJ5LnRyaW0oIHMuZGF0YVR5cGUgfHwgIioiICkudG9Mb3dlckNhc2UoKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbIiJdOwoKCQkvLyBBIGNyb3NzLWRvbWFpbiByZXF1ZXN0IGlzIGluIG9yZGVyIHdoZW4gd2UgaGF2ZSBhIHByb3RvY29sOmhvc3Q6cG9ydCBtaXNtYXRjaAoJCWlmICggcy5jcm9zc0RvbWFpbiA9PSBudWxsICkgewoJCQlwYXJ0cyA9IHJ1cmwuZXhlYyggcy51cmwudG9Mb3dlckNhc2UoKSApOwoJCQlzLmNyb3NzRG9tYWluID0gISEoIHBhcnRzICYmCgkJCQkoIHBhcnRzWyAxIF0gIT09IGFqYXhMb2NQYXJ0c1sgMSBdIHx8IHBhcnRzWyAyIF0gIT09IGFqYXhMb2NQYXJ0c1sgMiBdIHx8CgkJCQkJKCBwYXJ0c1sgMyBdIHx8ICggcGFydHNbIDEgXSA9PT0gImh0dHA6IiA/IDgwIDogNDQzICkgKSAhPQoJCQkJCQkoIGFqYXhMb2NQYXJ0c1sgMyBdIHx8ICggYWpheExvY1BhcnRzWyAxIF0gPT09ICJodHRwOiIgPyA4MCA6IDQ0MyApICkgKQoJCQkpOwoJCX0KCgkJLy8gQ29udmVydCBkYXRhIGlmIG5vdCBhbHJlYWR5IGEgc3RyaW5nCgkJaWYgKCBzLmRhdGEgJiYgcy5wcm9jZXNzRGF0YSAmJiB0eXBlb2Ygcy5kYXRhICE9PSAic3RyaW5nIiApIHsKCQkJcy5kYXRhID0galF1ZXJ5LnBhcmFtKCBzLmRhdGEsIHMudHJhZGl0aW9uYWwgKTsKCQl9CgoJCS8vIEFwcGx5IHByZWZpbHRlcnMKCQlpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggcHJlZmlsdGVycywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgcmVxdWVzdCB3YXMgYWJvcnRlZCBpbnNpZGUgYSBwcmVmaWx0ZXIsIHN0b3AgdGhlcmUKCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQlyZXR1cm4ganFYSFI7CgkJfQoKCQkvLyBXZSBjYW4gZmlyZSBnbG9iYWwgZXZlbnRzIGFzIG9mIG5vdyBpZiBhc2tlZCB0bwoJCWZpcmVHbG9iYWxzID0gcy5nbG9iYWw7CgoJCS8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHMKCQlpZiAoIGZpcmVHbG9iYWxzICYmIGpRdWVyeS5hY3RpdmUrKyA9PT0gMCApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpOwoJCX0KCgkJLy8gVXBwZXJjYXNlIHRoZSB0eXBlCgkJcy50eXBlID0gcy50eXBlLnRvVXBwZXJDYXNlKCk7CgoJCS8vIERldGVybWluZSBpZiByZXF1ZXN0IGhhcyBjb250ZW50CgkJcy5oYXNDb250ZW50ID0gIXJub0NvbnRlbnQudGVzdCggcy50eXBlICk7CgoJCS8vIFNhdmUgdGhlIFVSTCBpbiBjYXNlIHdlJ3JlIHRveWluZyB3aXRoIHRoZSBJZi1Nb2RpZmllZC1TaW5jZQoJCS8vIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciBsYXRlciBvbgoJCWNhY2hlVVJMID0gcy51cmw7CgoJCS8vIE1vcmUgb3B0aW9ucyBoYW5kbGluZyBmb3IgcmVxdWVzdHMgd2l0aCBubyBjb250ZW50CgkJaWYgKCAhcy5oYXNDb250ZW50ICkgewoKCQkJLy8gSWYgZGF0YSBpcyBhdmFpbGFibGUsIGFwcGVuZCBkYXRhIHRvIHVybAoJCQlpZiAoIHMuZGF0YSApIHsKCQkJCWNhY2hlVVJMID0gKCBzLnVybCArPSAoIGFqYXhfcnF1ZXJ5LnRlc3QoIGNhY2hlVVJMICkgPyAiJiIgOiAiPyIgKSArIHMuZGF0YSApOwoJCQkJLy8gIzk2ODI6IHJlbW92ZSBkYXRhIHNvIHRoYXQgaXQncyBub3QgdXNlZCBpbiBhbiBldmVudHVhbCByZXRyeQoJCQkJZGVsZXRlIHMuZGF0YTsKCQkJfQoKCQkJLy8gQWRkIGFudGktY2FjaGUgaW4gdXJsIGlmIG5lZWRlZAoJCQlpZiAoIHMuY2FjaGUgPT09IGZhbHNlICkgewoJCQkJcy51cmwgPSBydHMudGVzdCggY2FjaGVVUkwgKSA/CgoJCQkJCS8vIElmIHRoZXJlIGlzIGFscmVhZHkgYSAnXycgcGFyYW1ldGVyLCBzZXQgaXRzIHZhbHVlCgkJCQkJY2FjaGVVUkwucmVwbGFjZSggcnRzLCAiJDFfPSIgKyBhamF4X25vbmNlKysgKSA6CgoJCQkJCS8vIE90aGVyd2lzZSBhZGQgb25lIHRvIHRoZSBlbmQKCQkJCQljYWNoZVVSTCArICggYWpheF9ycXVlcnkudGVzdCggY2FjaGVVUkwgKSA/ICImIiA6ICI/IiApICsgIl89IiArIGFqYXhfbm9uY2UrKzsKCQkJfQoJCX0KCgkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJaWYgKCBqUXVlcnkubGFzdE1vZGlmaWVkWyBjYWNoZVVSTCBdICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU1vZGlmaWVkLVNpbmNlIiwgalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSApOwoJCQl9CgkJCWlmICggalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gKSB7CgkJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiSWYtTm9uZS1NYXRjaCIsIGpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdICk7CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgY29ycmVjdCBoZWFkZXIsIGlmIGRhdGEgaXMgYmVpbmcgc2VudAoJCWlmICggcy5kYXRhICYmIHMuaGFzQ29udGVudCAmJiBzLmNvbnRlbnRUeXBlICE9PSBmYWxzZSB8fCBvcHRpb25zLmNvbnRlbnRUeXBlICkgewoJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiQ29udGVudC1UeXBlIiwgcy5jb250ZW50VHlwZSApOwoJCX0KCgkJLy8gU2V0IHRoZSBBY2NlcHRzIGhlYWRlciBmb3IgdGhlIHNlcnZlciwgZGVwZW5kaW5nIG9uIHRoZSBkYXRhVHlwZQoJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoCgkJCSJBY2NlcHQiLAoJCQlzLmRhdGFUeXBlc1sgMCBdICYmIHMuYWNjZXB0c1sgcy5kYXRhVHlwZXNbMF0gXSA/CgkJCQlzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gKyAoIHMuZGF0YVR5cGVzWyAwIF0gIT09ICIqIiA/ICIsICIgKyBhbGxUeXBlcyArICI7IHE9MC4wMSIgOiAiIiApIDoKCQkJCXMuYWNjZXB0c1sgIioiIF0KCQkpOwoKCQkvLyBDaGVjayBmb3IgaGVhZGVycyBvcHRpb24KCQlmb3IgKCBpIGluIHMuaGVhZGVycyApIHsKCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggaSwgcy5oZWFkZXJzWyBpIF0gKTsKCQl9CgoJCS8vIEFsbG93IGN1c3RvbSBoZWFkZXJzL21pbWV0eXBlcyBhbmQgZWFybHkgYWJvcnQKCQlpZiAoIHMuYmVmb3JlU2VuZCAmJiAoIHMuYmVmb3JlU2VuZC5jYWxsKCBjYWxsYmFja0NvbnRleHQsIGpxWEhSLCBzICkgPT09IGZhbHNlIHx8IHN0YXRlID09PSAyICkgKSB7CgkJCS8vIEFib3J0IGlmIG5vdCBkb25lIGFscmVhZHkgYW5kIHJldHVybgoJCQlyZXR1cm4ganFYSFIuYWJvcnQoKTsKCQl9CgoJCS8vIGFib3J0aW5nIGlzIG5vIGxvbmdlciBhIGNhbmNlbGxhdGlvbgoJCXN0ckFib3J0ID0gImFib3J0IjsKCgkJLy8gSW5zdGFsbCBjYWxsYmFja3Mgb24gZGVmZXJyZWRzCgkJZm9yICggaSBpbiB7IHN1Y2Nlc3M6IDEsIGVycm9yOiAxLCBjb21wbGV0ZTogMSB9ICkgewoJCQlqcVhIUlsgaSBdKCBzWyBpIF0gKTsKCQl9CgoJCS8vIEdldCB0cmFuc3BvcnQKCQl0cmFuc3BvcnQgPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0CgkJaWYgKCAhdHJhbnNwb3J0ICkgewoJCQlkb25lKCAtMSwgIk5vIFRyYW5zcG9ydCIgKTsKCQl9IGVsc2UgewoJCQlqcVhIUi5yZWFkeVN0YXRlID0gMTsKCgkJCS8vIFNlbmQgZ2xvYmFsIGV2ZW50CgkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQlnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggImFqYXhTZW5kIiwgWyBqcVhIUiwgcyBdICk7CgkJCX0KCQkJLy8gVGltZW91dAoJCQlpZiAoIHMuYXN5bmMgJiYgcy50aW1lb3V0ID4gMCApIHsKCQkJCXRpbWVvdXRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQkJanFYSFIuYWJvcnQoInRpbWVvdXQiKTsKCQkJCX0sIHMudGltZW91dCApOwoJCQl9CgoJCQl0cnkgewoJCQkJc3RhdGUgPSAxOwoJCQkJdHJhbnNwb3J0LnNlbmQoIHJlcXVlc3RIZWFkZXJzLCBkb25lICk7CgkJCX0gY2F0Y2ggKCBlICkgewoJCQkJLy8gUHJvcGFnYXRlIGV4Y2VwdGlvbiBhcyBlcnJvciBpZiBub3QgZG9uZQoJCQkJaWYgKCBzdGF0ZSA8IDIgKSB7CgkJCQkJZG9uZSggLTEsIGUgKTsKCQkJCS8vIFNpbXBseSByZXRocm93IG90aGVyd2lzZQoJCQkJfSBlbHNlIHsKCQkJCQl0aHJvdyBlOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsYmFjayBmb3Igd2hlbiBldmVyeXRoaW5nIGlzIGRvbmUKCQlmdW5jdGlvbiBkb25lKCBzdGF0dXMsIG5hdGl2ZVN0YXR1c1RleHQsIHJlc3BvbnNlcywgaGVhZGVycyApIHsKCQkJdmFyIGlzU3VjY2Vzcywgc3VjY2VzcywgZXJyb3IsIHJlc3BvbnNlLCBtb2RpZmllZCwKCQkJCXN0YXR1c1RleHQgPSBuYXRpdmVTdGF0dXNUZXh0OwoKCQkJLy8gQ2FsbGVkIG9uY2UKCQkJaWYgKCBzdGF0ZSA9PT0gMiApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU3RhdGUgaXMgImRvbmUiIG5vdwoJCQlzdGF0ZSA9IDI7CgoJCQkvLyBDbGVhciB0aW1lb3V0IGlmIGl0IGV4aXN0cwoJCQlpZiAoIHRpbWVvdXRUaW1lciApIHsKCQkJCWNsZWFyVGltZW91dCggdGltZW91dFRpbWVyICk7CgkJCX0KCgkJCS8vIERlcmVmZXJlbmNlIHRyYW5zcG9ydCBmb3IgZWFybHkgZ2FyYmFnZSBjb2xsZWN0aW9uCgkJCS8vIChubyBtYXR0ZXIgaG93IGxvbmcgdGhlIGpxWEhSIG9iamVjdCB3aWxsIGJlIHVzZWQpCgkJCXRyYW5zcG9ydCA9IHVuZGVmaW5lZDsKCgkJCS8vIENhY2hlIHJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nID0gaGVhZGVycyB8fCAiIjsKCgkJCS8vIFNldCByZWFkeVN0YXRlCgkJCWpxWEhSLnJlYWR5U3RhdGUgPSBzdGF0dXMgPiAwID8gNCA6IDA7CgoJCQkvLyBHZXQgcmVzcG9uc2UgZGF0YQoJCQlpZiAoIHJlc3BvbnNlcyApIHsKCQkJCXJlc3BvbnNlID0gYWpheEhhbmRsZVJlc3BvbnNlcyggcywganFYSFIsIHJlc3BvbnNlcyApOwoJCQl9CgoJCQkvLyBJZiBzdWNjZXNzZnVsLCBoYW5kbGUgdHlwZSBjaGFpbmluZwoJCQlpZiAoIHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwIHx8IHN0YXR1cyA9PT0gMzA0ICkgewoKCQkJCS8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuCgkJCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSA9IG1vZGlmaWVkOwoJCQkJCX0KCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gaWYgbm8gY29udGVudAoJCQkJaWYgKCBzdGF0dXMgPT09IDIwNCApIHsKCQkJCQlpc1N1Y2Nlc3MgPSB0cnVlOwoJCQkJCXN0YXR1c1RleHQgPSAibm9jb250ZW50IjsKCgkJCQkvLyBpZiBub3QgbW9kaWZpZWQKCQkJCX0gZWxzZSBpZiAoIHN0YXR1cyA9PT0gMzA0ICkgewoJCQkJCWlzU3VjY2VzcyA9IHRydWU7CgkJCQkJc3RhdHVzVGV4dCA9ICJub3Rtb2RpZmllZCI7CgoJCQkJLy8gSWYgd2UgaGF2ZSBkYXRhLCBsZXQncyBjb252ZXJ0IGl0CgkJCQl9IGVsc2UgewoJCQkJCWlzU3VjY2VzcyA9IGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSApOwoJCQkJCXN0YXR1c1RleHQgPSBpc1N1Y2Nlc3Muc3RhdGU7CgkJCQkJc3VjY2VzcyA9IGlzU3VjY2Vzcy5kYXRhOwoJCQkJCWVycm9yID0gaXNTdWNjZXNzLmVycm9yOwoJCQkJCWlzU3VjY2VzcyA9ICFlcnJvcjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIFdlIGV4dHJhY3QgZXJyb3IgZnJvbSBzdGF0dXNUZXh0CgkJCQkvLyB0aGVuIG5vcm1hbGl6ZSBzdGF0dXNUZXh0IGFuZCBzdGF0dXMgZm9yIG5vbi1hYm9ydHMKCQkJCWVycm9yID0gc3RhdHVzVGV4dDsKCQkJCWlmICggc3RhdHVzIHx8ICFzdGF0dXNUZXh0ICkgewoJCQkJCXN0YXR1c1RleHQgPSAiZXJyb3IiOwoJCQkJCWlmICggc3RhdHVzIDwgMCApIHsKCQkJCQkJc3RhdHVzID0gMDsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0CgkJCWpxWEhSLnN0YXR1cyA9IHN0YXR1czsKCQkJanFYSFIuc3RhdHVzVGV4dCA9ICggbmF0aXZlU3RhdHVzVGV4dCB8fCBzdGF0dXNUZXh0ICkgKyAiIjsKCgkJCS8vIFN1Y2Nlc3MvRXJyb3IKCQkJaWYgKCBpc1N1Y2Nlc3MgKSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIHN1Y2Nlc3MsIHN0YXR1c1RleHQsIGpxWEhSIF0gKTsKCQkJfSBlbHNlIHsKCQkJCWRlZmVycmVkLnJlamVjdFdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlqcVhIUi5zdGF0dXNDb2RlKCBzdGF0dXNDb2RlICk7CgkJCXN0YXR1c0NvZGUgPSB1bmRlZmluZWQ7CgoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoIGlzU3VjY2VzcyA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwKCQkJCQlbIGpxWEhSLCBzLCBpc1N1Y2Nlc3MgPyBzdWNjZXNzIDogZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBDb21wbGV0ZQoJCQljb21wbGV0ZURlZmVycmVkLmZpcmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsganFYSFIsIHN0YXR1c1RleHQgXSApOwoKCQkJaWYgKCBmaXJlR2xvYmFscyApIHsKCQkJCWdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCAiYWpheENvbXBsZXRlIiwgWyBqcVhIUiwgcyBdICk7CgkJCQkvLyBIYW5kbGUgdGhlIGdsb2JhbCBBSkFYIGNvdW50ZXIKCQkJCWlmICggISggLS1qUXVlcnkuYWN0aXZlICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIik7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBqcVhIUjsKCX0sCgoJZ2V0U2NyaXB0OiBmdW5jdGlvbiggdXJsLCBjYWxsYmFjayApIHsKCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCB1bmRlZmluZWQsIGNhbGxiYWNrLCAic2NyaXB0IiApOwoJfSwKCglnZXRKU09OOiBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjayApIHsKCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCBkYXRhLCBjYWxsYmFjaywgImpzb24iICk7Cgl9Cn0pOwoKLyogSGFuZGxlcyByZXNwb25zZXMgdG8gYW4gYWpheCByZXF1ZXN0OgogKiAtIHNldHMgYWxsIHJlc3BvbnNlWFhYIGZpZWxkcyBhY2NvcmRpbmdseQogKiAtIGZpbmRzIHRoZSByaWdodCBkYXRhVHlwZSAobWVkaWF0ZXMgYmV0d2VlbiBjb250ZW50LXR5cGUgYW5kIGV4cGVjdGVkIGRhdGFUeXBlKQogKiAtIHJldHVybnMgdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKICovCmZ1bmN0aW9uIGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKSB7Cgl2YXIgZmlyc3REYXRhVHlwZSwgY3QsIGZpbmFsRGF0YVR5cGUsIHR5cGUsCgkJY29udGVudHMgPSBzLmNvbnRlbnRzLAoJCWRhdGFUeXBlcyA9IHMuZGF0YVR5cGVzLAoJCXJlc3BvbnNlRmllbGRzID0gcy5yZXNwb25zZUZpZWxkczsKCgkvLyBGaWxsIHJlc3BvbnNlWFhYIGZpZWxkcwoJZm9yICggdHlwZSBpbiByZXNwb25zZUZpZWxkcyApIHsKCQlpZiAoIHR5cGUgaW4gcmVzcG9uc2VzICkgewoJCQlqcVhIUlsgcmVzcG9uc2VGaWVsZHNbdHlwZV0gXSA9IHJlc3BvbnNlc1sgdHlwZSBdOwoJCX0KCX0KCgkvLyBSZW1vdmUgYXV0byBkYXRhVHlwZSBhbmQgZ2V0IGNvbnRlbnQtdHlwZSBpbiB0aGUgcHJvY2VzcwoJd2hpbGUoIGRhdGFUeXBlc1sgMCBdID09PSAiKiIgKSB7CgkJZGF0YVR5cGVzLnNoaWZ0KCk7CgkJaWYgKCBjdCA9PT0gdW5kZWZpbmVkICkgewoJCQljdCA9IHMubWltZVR5cGUgfHwganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpOwoJCX0KCX0KCgkvLyBDaGVjayBpZiB3ZSdyZSBkZWFsaW5nIHdpdGggYSBrbm93biBjb250ZW50LXR5cGUKCWlmICggY3QgKSB7CgkJZm9yICggdHlwZSBpbiBjb250ZW50cyApIHsKCQkJaWYgKCBjb250ZW50c1sgdHlwZSBdICYmIGNvbnRlbnRzWyB0eXBlIF0udGVzdCggY3QgKSApIHsKCQkJCWRhdGFUeXBlcy51bnNoaWZ0KCB0eXBlICk7CgkJCQlicmVhazsKCQkJfQoJCX0KCX0KCgkvLyBDaGVjayB0byBzZWUgaWYgd2UgaGF2ZSBhIHJlc3BvbnNlIGZvciB0aGUgZXhwZWN0ZWQgZGF0YVR5cGUKCWlmICggZGF0YVR5cGVzWyAwIF0gaW4gcmVzcG9uc2VzICkgewoJCWZpbmFsRGF0YVR5cGUgPSBkYXRhVHlwZXNbIDAgXTsKCX0gZWxzZSB7CgkJLy8gVHJ5IGNvbnZlcnRpYmxlIGRhdGFUeXBlcwoJCWZvciAoIHR5cGUgaW4gcmVzcG9uc2VzICkgewoJCQlpZiAoICFkYXRhVHlwZXNbIDAgXSB8fCBzLmNvbnZlcnRlcnNbIHR5cGUgKyAiICIgKyBkYXRhVHlwZXNbMF0gXSApIHsKCQkJCWZpbmFsRGF0YVR5cGUgPSB0eXBlOwoJCQkJYnJlYWs7CgkJCX0KCQkJaWYgKCAhZmlyc3REYXRhVHlwZSApIHsKCQkJCWZpcnN0RGF0YVR5cGUgPSB0eXBlOwoJCQl9CgkJfQoJCS8vIE9yIGp1c3QgdXNlIGZpcnN0IG9uZQoJCWZpbmFsRGF0YVR5cGUgPSBmaW5hbERhdGFUeXBlIHx8IGZpcnN0RGF0YVR5cGU7Cgl9CgoJLy8gSWYgd2UgZm91bmQgYSBkYXRhVHlwZQoJLy8gV2UgYWRkIHRoZSBkYXRhVHlwZSB0byB0aGUgbGlzdCBpZiBuZWVkZWQKCS8vIGFuZCByZXR1cm4gdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKCWlmICggZmluYWxEYXRhVHlwZSApIHsKCQlpZiAoIGZpbmFsRGF0YVR5cGUgIT09IGRhdGFUeXBlc1sgMCBdICkgewoJCQlkYXRhVHlwZXMudW5zaGlmdCggZmluYWxEYXRhVHlwZSApOwoJCX0KCQlyZXR1cm4gcmVzcG9uc2VzWyBmaW5hbERhdGFUeXBlIF07Cgl9Cn0KCi8vIENoYWluIGNvbnZlcnNpb25zIGdpdmVuIHRoZSByZXF1ZXN0IGFuZCB0aGUgb3JpZ2luYWwgcmVzcG9uc2UKZnVuY3Rpb24gYWpheENvbnZlcnQoIHMsIHJlc3BvbnNlICkgewoJdmFyIGNvbnYyLCBjdXJyZW50LCBjb252LCB0bXAsCgkJY29udmVydGVycyA9IHt9LAoJCWkgPSAwLAoJCS8vIFdvcmsgd2l0aCBhIGNvcHkgb2YgZGF0YVR5cGVzIGluIGNhc2Ugd2UgbmVlZCB0byBtb2RpZnkgaXQgZm9yIGNvbnZlcnNpb24KCQlkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcy5zbGljZSgpLAoJCXByZXYgPSBkYXRhVHlwZXNbIDAgXTsKCgkvLyBBcHBseSB0aGUgZGF0YUZpbHRlciBpZiBwcm92aWRlZAoJaWYgKCBzLmRhdGFGaWx0ZXIgKSB7CgkJcmVzcG9uc2UgPSBzLmRhdGFGaWx0ZXIoIHJlc3BvbnNlLCBzLmRhdGFUeXBlICk7Cgl9CgoJLy8gQ3JlYXRlIGNvbnZlcnRlcnMgbWFwIHdpdGggbG93ZXJjYXNlZCBrZXlzCglpZiAoIGRhdGFUeXBlc1sgMSBdICkgewoJCWZvciAoIGNvbnYgaW4gcy5jb252ZXJ0ZXJzICkgewoJCQljb252ZXJ0ZXJzWyBjb252LnRvTG93ZXJDYXNlKCkgXSA9IHMuY29udmVydGVyc1sgY29udiBdOwoJCX0KCX0KCgkvLyBDb252ZXJ0IHRvIGVhY2ggc2VxdWVudGlhbCBkYXRhVHlwZSwgdG9sZXJhdGluZyBsaXN0IG1vZGlmaWNhdGlvbgoJZm9yICggOyAoY3VycmVudCA9IGRhdGFUeXBlc1srK2ldKTsgKSB7CgoJCS8vIFRoZXJlJ3Mgb25seSB3b3JrIHRvIGRvIGlmIGN1cnJlbnQgZGF0YVR5cGUgaXMgbm9uLWF1dG8KCQlpZiAoIGN1cnJlbnQgIT09ICIqIiApIHsKCgkJCS8vIENvbnZlcnQgcmVzcG9uc2UgaWYgcHJldiBkYXRhVHlwZSBpcyBub24tYXV0byBhbmQgZGlmZmVycyBmcm9tIGN1cnJlbnQKCQkJaWYgKCBwcmV2ICE9PSAiKiIgJiYgcHJldiAhPT0gY3VycmVudCApIHsKCgkJCQkvLyBTZWVrIGEgZGlyZWN0IGNvbnZlcnRlcgoJCQkJY29udiA9IGNvbnZlcnRlcnNbIHByZXYgKyAiICIgKyBjdXJyZW50IF0gfHwgY29udmVydGVyc1sgIiogIiArIGN1cnJlbnQgXTsKCgkJCQkvLyBJZiBub25lIGZvdW5kLCBzZWVrIGEgcGFpcgoJCQkJaWYgKCAhY29udiApIHsKCQkJCQlmb3IgKCBjb252MiBpbiBjb252ZXJ0ZXJzICkgewoKCQkJCQkJLy8gSWYgY29udjIgb3V0cHV0cyBjdXJyZW50CgkJCQkJCXRtcCA9IGNvbnYyLnNwbGl0KCIgIik7CgkJCQkJCWlmICggdG1wWyAxIF0gPT09IGN1cnJlbnQgKSB7CgoJCQkJCQkJLy8gSWYgcHJldiBjYW4gYmUgY29udmVydGVkIHRvIGFjY2VwdGVkIGlucHV0CgkJCQkJCQljb252ID0gY29udmVydGVyc1sgcHJldiArICIgIiArIHRtcFsgMCBdIF0gfHwKCQkJCQkJCQljb252ZXJ0ZXJzWyAiKiAiICsgdG1wWyAwIF0gXTsKCQkJCQkJCWlmICggY29udiApIHsKCQkJCQkJCQkvLyBDb25kZW5zZSBlcXVpdmFsZW5jZSBjb252ZXJ0ZXJzCgkJCQkJCQkJaWYgKCBjb252ID09PSB0cnVlICkgewoJCQkJCQkJCQljb252ID0gY29udmVydGVyc1sgY29udjIgXTsKCgkJCQkJCQkJLy8gT3RoZXJ3aXNlLCBpbnNlcnQgdGhlIGludGVybWVkaWF0ZSBkYXRhVHlwZQoJCQkJCQkJCX0gZWxzZSBpZiAoIGNvbnZlcnRlcnNbIGNvbnYyIF0gIT09IHRydWUgKSB7CgkJCQkJCQkJCWN1cnJlbnQgPSB0bXBbIDAgXTsKCQkJCQkJCQkJZGF0YVR5cGVzLnNwbGljZSggaS0tLCAwLCBjdXJyZW50ICk7CgkJCQkJCQkJfQoKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBBcHBseSBjb252ZXJ0ZXIgKGlmIG5vdCBhbiBlcXVpdmFsZW5jZSkKCQkJCWlmICggY29udiAhPT0gdHJ1ZSApIHsKCgkJCQkJLy8gVW5sZXNzIGVycm9ycyBhcmUgYWxsb3dlZCB0byBidWJibGUsIGNhdGNoIGFuZCByZXR1cm4gdGhlbQoJCQkJCWlmICggY29udiAmJiBzWyJ0aHJvd3MiXSApIHsKCQkJCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlyZXNwb25zZSA9IGNvbnYoIHJlc3BvbnNlICk7CgkJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkJcmV0dXJuIHsgc3RhdGU6ICJwYXJzZXJlcnJvciIsIGVycm9yOiBjb252ID8gZSA6ICJObyBjb252ZXJzaW9uIGZyb20gIiArIHByZXYgKyAiIHRvICIgKyBjdXJyZW50IH07CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFVwZGF0ZSBwcmV2IGZvciBuZXh0IGl0ZXJhdGlvbgoJCQlwcmV2ID0gY3VycmVudDsKCQl9Cgl9CgoJcmV0dXJuIHsgc3RhdGU6ICJzdWNjZXNzIiwgZGF0YTogcmVzcG9uc2UgfTsKfQovLyBJbnN0YWxsIHNjcmlwdCBkYXRhVHlwZQpqUXVlcnkuYWpheFNldHVwKHsKCWFjY2VwdHM6IHsKCQlzY3JpcHQ6ICJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCIKCX0sCgljb250ZW50czogewoJCXNjcmlwdDogLyg/OmphdmF8ZWNtYSlzY3JpcHQvCgl9LAoJY29udmVydGVyczogewoJCSJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uKCB0ZXh0ICkgewoJCQlqUXVlcnkuZ2xvYmFsRXZhbCggdGV4dCApOwoJCQlyZXR1cm4gdGV4dDsKCQl9Cgl9Cn0pOwoKLy8gSGFuZGxlIGNhY2hlJ3Mgc3BlY2lhbCBjYXNlIGFuZCBnbG9iYWwKalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJzY3JpcHQiLCBmdW5jdGlvbiggcyApIHsKCWlmICggcy5jYWNoZSA9PT0gdW5kZWZpbmVkICkgewoJCXMuY2FjaGUgPSBmYWxzZTsKCX0KCWlmICggcy5jcm9zc0RvbWFpbiApIHsKCQlzLnR5cGUgPSAiR0VUIjsKCQlzLmdsb2JhbCA9IGZhbHNlOwoJfQp9KTsKCi8vIEJpbmQgc2NyaXB0IHRhZyBoYWNrIHRyYW5zcG9ydApqUXVlcnkuYWpheFRyYW5zcG9ydCggInNjcmlwdCIsIGZ1bmN0aW9uKHMpIHsKCgkvLyBUaGlzIHRyYW5zcG9ydCBvbmx5IGRlYWxzIHdpdGggY3Jvc3MgZG9tYWluIHJlcXVlc3RzCglpZiAoIHMuY3Jvc3NEb21haW4gKSB7CgoJCXZhciBzY3JpcHQsCgkJCWhlYWQgPSBkb2N1bWVudC5oZWFkIHx8IGpRdWVyeSgiaGVhZCIpWzBdIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCgkJcmV0dXJuIHsKCgkJCXNlbmQ6IGZ1bmN0aW9uKCBfLCBjYWxsYmFjayApIHsKCgkJCQlzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKCgkJCQlzY3JpcHQuYXN5bmMgPSB0cnVlOwoKCQkJCWlmICggcy5zY3JpcHRDaGFyc2V0ICkgewoJCQkJCXNjcmlwdC5jaGFyc2V0ID0gcy5zY3JpcHRDaGFyc2V0OwoJCQkJfQoKCQkJCXNjcmlwdC5zcmMgPSBzLnVybDsKCgkJCQkvLyBBdHRhY2ggaGFuZGxlcnMgZm9yIGFsbCBicm93c2VycwoJCQkJc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiggXywgaXNBYm9ydCApIHsKCgkJCQkJaWYgKCBpc0Fib3J0IHx8ICFzY3JpcHQucmVhZHlTdGF0ZSB8fCAvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KCBzY3JpcHQucmVhZHlTdGF0ZSApICkgewoKCQkJCQkJLy8gSGFuZGxlIG1lbW9yeSBsZWFrIGluIElFCgkJCQkJCXNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsKCgkJCQkJCS8vIFJlbW92ZSB0aGUgc2NyaXB0CgkJCQkJCWlmICggc2NyaXB0LnBhcmVudE5vZGUgKSB7CgkJCQkJCQlzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggc2NyaXB0ICk7CgkJCQkJCX0KCgkJCQkJCS8vIERlcmVmZXJlbmNlIHRoZSBzY3JpcHQKCQkJCQkJc2NyaXB0ID0gbnVsbDsKCgkJCQkJCS8vIENhbGxiYWNrIGlmIG5vdCBhYm9ydAoJCQkJCQlpZiAoICFpc0Fib3J0ICkgewoJCQkJCQkJY2FsbGJhY2soIDIwMCwgInN1Y2Nlc3MiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9OwoKCQkJCS8vIENpcmN1bXZlbnQgSUU2IGJ1Z3Mgd2l0aCBiYXNlIGVsZW1lbnRzICgjMjcwOSBhbmQgIzQzNzgpIGJ5IHByZXBlbmRpbmcKCQkJCS8vIFVzZSBuYXRpdmUgRE9NIG1hbmlwdWxhdGlvbiB0byBhdm9pZCBvdXIgZG9tTWFuaXAgQUpBWCB0cmlja2VyeQoJCQkJaGVhZC5pbnNlcnRCZWZvcmUoIHNjcmlwdCwgaGVhZC5maXJzdENoaWxkICk7CgkJCX0sCgoJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHNjcmlwdCApIHsKCQkJCQlzY3JpcHQub25sb2FkKCB1bmRlZmluZWQsIHRydWUgKTsKCQkJCX0KCQkJfQoJCX07Cgl9Cn0pOwp2YXIgb2xkQ2FsbGJhY2tzID0gW10sCglyanNvbnAgPSAvKD0pXD8oPz0mfCQpfFw/XD8vOwoKLy8gRGVmYXVsdCBqc29ucCBzZXR0aW5ncwpqUXVlcnkuYWpheFNldHVwKHsKCWpzb25wOiAiY2FsbGJhY2siLAoJanNvbnBDYWxsYmFjazogZnVuY3Rpb24oKSB7CgkJdmFyIGNhbGxiYWNrID0gb2xkQ2FsbGJhY2tzLnBvcCgpIHx8ICggalF1ZXJ5LmV4cGFuZG8gKyAiXyIgKyAoIGFqYXhfbm9uY2UrKyApICk7CgkJdGhpc1sgY2FsbGJhY2sgXSA9IHRydWU7CgkJcmV0dXJuIGNhbGxiYWNrOwoJfQp9KTsKCi8vIERldGVjdCwgbm9ybWFsaXplIG9wdGlvbnMgYW5kIGluc3RhbGwgY2FsbGJhY2tzIGZvciBqc29ucCByZXF1ZXN0cwpqUXVlcnkuYWpheFByZWZpbHRlciggImpzb24ganNvbnAiLCBmdW5jdGlvbiggcywgb3JpZ2luYWxTZXR0aW5ncywganFYSFIgKSB7CgoJdmFyIGNhbGxiYWNrTmFtZSwgb3ZlcndyaXR0ZW4sIHJlc3BvbnNlQ29udGFpbmVyLAoJCWpzb25Qcm9wID0gcy5qc29ucCAhPT0gZmFsc2UgJiYgKCByanNvbnAudGVzdCggcy51cmwgKSA/CgkJCSJ1cmwiIDoKCQkJdHlwZW9mIHMuZGF0YSA9PT0gInN0cmluZyIgJiYgISggcy5jb250ZW50VHlwZSB8fCAiIiApLmluZGV4T2YoImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpICYmIHJqc29ucC50ZXN0KCBzLmRhdGEgKSAmJiAiZGF0YSIKCQkpOwoKCS8vIEhhbmRsZSBpZmYgdGhlIGV4cGVjdGVkIGRhdGEgdHlwZSBpcyAianNvbnAiIG9yIHdlIGhhdmUgYSBwYXJhbWV0ZXIgdG8gc2V0CglpZiAoIGpzb25Qcm9wIHx8IHMuZGF0YVR5cGVzWyAwIF0gPT09ICJqc29ucCIgKSB7CgoJCS8vIEdldCBjYWxsYmFjayBuYW1lLCByZW1lbWJlcmluZyBwcmVleGlzdGluZyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggaXQKCQljYWxsYmFja05hbWUgPSBzLmpzb25wQ2FsbGJhY2sgPSBqUXVlcnkuaXNGdW5jdGlvbiggcy5qc29ucENhbGxiYWNrICkgPwoJCQlzLmpzb25wQ2FsbGJhY2soKSA6CgkJCXMuanNvbnBDYWxsYmFjazsKCgkJLy8gSW5zZXJ0IGNhbGxiYWNrIGludG8gdXJsIG9yIGZvcm0gZGF0YQoJCWlmICgganNvblByb3AgKSB7CgkJCXNbIGpzb25Qcm9wIF0gPSBzWyBqc29uUHJvcCBdLnJlcGxhY2UoIHJqc29ucCwgIiQxIiArIGNhbGxiYWNrTmFtZSApOwoJCX0gZWxzZSBpZiAoIHMuanNvbnAgIT09IGZhbHNlICkgewoJCQlzLnVybCArPSAoIGFqYXhfcnF1ZXJ5LnRlc3QoIHMudXJsICkgPyAiJiIgOiAiPyIgKSArIHMuanNvbnAgKyAiPSIgKyBjYWxsYmFja05hbWU7CgkJfQoKCQkvLyBVc2UgZGF0YSBjb252ZXJ0ZXIgdG8gcmV0cmlldmUganNvbiBhZnRlciBzY3JpcHQgZXhlY3V0aW9uCgkJcy5jb252ZXJ0ZXJzWyJzY3JpcHQganNvbiJdID0gZnVuY3Rpb24oKSB7CgkJCWlmICggIXJlc3BvbnNlQ29udGFpbmVyICkgewoJCQkJalF1ZXJ5LmVycm9yKCBjYWxsYmFja05hbWUgKyAiIHdhcyBub3QgY2FsbGVkIiApOwoJCQl9CgkJCXJldHVybiByZXNwb25zZUNvbnRhaW5lclsgMCBdOwoJCX07CgoJCS8vIGZvcmNlIGpzb24gZGF0YVR5cGUKCQlzLmRhdGFUeXBlc1sgMCBdID0gImpzb24iOwoKCQkvLyBJbnN0YWxsIGNhbGxiYWNrCgkJb3ZlcndyaXR0ZW4gPSB3aW5kb3dbIGNhbGxiYWNrTmFtZSBdOwoJCXdpbmRvd1sgY2FsbGJhY2tOYW1lIF0gPSBmdW5jdGlvbigpIHsKCQkJcmVzcG9uc2VDb250YWluZXIgPSBhcmd1bWVudHM7CgkJfTsKCgkJLy8gQ2xlYW4tdXAgZnVuY3Rpb24gKGZpcmVzIGFmdGVyIGNvbnZlcnRlcnMpCgkJanFYSFIuYWx3YXlzKGZ1bmN0aW9uKCkgewoJCQkvLyBSZXN0b3JlIHByZWV4aXN0aW5nIHZhbHVlCgkJCXdpbmRvd1sgY2FsbGJhY2tOYW1lIF0gPSBvdmVyd3JpdHRlbjsKCgkJCS8vIFNhdmUgYmFjayBhcyBmcmVlCgkJCWlmICggc1sgY2FsbGJhY2tOYW1lIF0gKSB7CgkJCQkvLyBtYWtlIHN1cmUgdGhhdCByZS11c2luZyB0aGUgb3B0aW9ucyBkb2Vzbid0IHNjcmV3IHRoaW5ncyBhcm91bmQKCQkJCXMuanNvbnBDYWxsYmFjayA9IG9yaWdpbmFsU2V0dGluZ3MuanNvbnBDYWxsYmFjazsKCgkJCQkvLyBzYXZlIHRoZSBjYWxsYmFjayBuYW1lIGZvciBmdXR1cmUgdXNlCgkJCQlvbGRDYWxsYmFja3MucHVzaCggY2FsbGJhY2tOYW1lICk7CgkJCX0KCgkJCS8vIENhbGwgaWYgaXQgd2FzIGEgZnVuY3Rpb24gYW5kIHdlIGhhdmUgYSByZXNwb25zZQoJCQlpZiAoIHJlc3BvbnNlQ29udGFpbmVyICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBvdmVyd3JpdHRlbiApICkgewoJCQkJb3ZlcndyaXR0ZW4oIHJlc3BvbnNlQ29udGFpbmVyWyAwIF0gKTsKCQkJfQoKCQkJcmVzcG9uc2VDb250YWluZXIgPSBvdmVyd3JpdHRlbiA9IHVuZGVmaW5lZDsKCQl9KTsKCgkJLy8gRGVsZWdhdGUgdG8gc2NyaXB0CgkJcmV0dXJuICJzY3JpcHQiOwoJfQp9KTsKdmFyIHhockNhbGxiYWNrcywgeGhyU3VwcG9ydGVkLAoJeGhySWQgPSAwLAoJLy8gIzUyODA6IEludGVybmV0IEV4cGxvcmVyIHdpbGwga2VlcCBjb25uZWN0aW9ucyBhbGl2ZSBpZiB3ZSBkb24ndCBhYm9ydCBvbiB1bmxvYWQKCXhock9uVW5sb2FkQWJvcnQgPSB3aW5kb3cuQWN0aXZlWE9iamVjdCAmJiBmdW5jdGlvbigpIHsKCQkvLyBBYm9ydCBhbGwgcGVuZGluZyByZXF1ZXN0cwoJCXZhciBrZXk7CgkJZm9yICgga2V5IGluIHhockNhbGxiYWNrcyApIHsKCQkJeGhyQ2FsbGJhY2tzWyBrZXkgXSggdW5kZWZpbmVkLCB0cnVlICk7CgkJfQoJfTsKCi8vIEZ1bmN0aW9ucyB0byBjcmVhdGUgeGhycwpmdW5jdGlvbiBjcmVhdGVTdGFuZGFyZFhIUigpIHsKCXRyeSB7CgkJcmV0dXJuIG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKTsKCX0gY2F0Y2goIGUgKSB7fQp9CgpmdW5jdGlvbiBjcmVhdGVBY3RpdmVYSFIoKSB7Cgl0cnkgewoJCXJldHVybiBuZXcgd2luZG93LkFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIik7Cgl9IGNhdGNoKCBlICkge30KfQoKLy8gQ3JlYXRlIHRoZSByZXF1ZXN0IG9iamVjdAovLyAoVGhpcyBpcyBzdGlsbCBhdHRhY2hlZCB0byBhamF4U2V0dGluZ3MgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkpCmpRdWVyeS5hamF4U2V0dGluZ3MueGhyID0gd2luZG93LkFjdGl2ZVhPYmplY3QgPwoJLyogTWljcm9zb2Z0IGZhaWxlZCB0byBwcm9wZXJseQoJICogaW1wbGVtZW50IHRoZSBYTUxIdHRwUmVxdWVzdCBpbiBJRTcgKGNhbid0IHJlcXVlc3QgbG9jYWwgZmlsZXMpLAoJICogc28gd2UgdXNlIHRoZSBBY3RpdmVYT2JqZWN0IHdoZW4gaXQgaXMgYXZhaWxhYmxlCgkgKiBBZGRpdGlvbmFsbHkgWE1MSHR0cFJlcXVlc3QgY2FuIGJlIGRpc2FibGVkIGluIElFNy9JRTggc28KCSAqIHdlIG5lZWQgYSBmYWxsYmFjay4KCSAqLwoJZnVuY3Rpb24oKSB7CgkJcmV0dXJuICF0aGlzLmlzTG9jYWwgJiYgY3JlYXRlU3RhbmRhcmRYSFIoKSB8fCBjcmVhdGVBY3RpdmVYSFIoKTsKCX0gOgoJLy8gRm9yIGFsbCBvdGhlciBicm93c2VycywgdXNlIHRoZSBzdGFuZGFyZCBYTUxIdHRwUmVxdWVzdCBvYmplY3QKCWNyZWF0ZVN0YW5kYXJkWEhSOwoKLy8gRGV0ZXJtaW5lIHN1cHBvcnQgcHJvcGVydGllcwp4aHJTdXBwb3J0ZWQgPSBqUXVlcnkuYWpheFNldHRpbmdzLnhocigpOwpqUXVlcnkuc3VwcG9ydC5jb3JzID0gISF4aHJTdXBwb3J0ZWQgJiYgKCAid2l0aENyZWRlbnRpYWxzIiBpbiB4aHJTdXBwb3J0ZWQgKTsKeGhyU3VwcG9ydGVkID0galF1ZXJ5LnN1cHBvcnQuYWpheCA9ICEheGhyU3VwcG9ydGVkOwoKLy8gQ3JlYXRlIHRyYW5zcG9ydCBpZiB0aGUgYnJvd3NlciBjYW4gcHJvdmlkZSBhbiB4aHIKaWYgKCB4aHJTdXBwb3J0ZWQgKSB7CgoJalF1ZXJ5LmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oIHMgKSB7CgkJLy8gQ3Jvc3MgZG9tYWluIG9ubHkgYWxsb3dlZCBpZiBzdXBwb3J0ZWQgdGhyb3VnaCBYTUxIdHRwUmVxdWVzdAoJCWlmICggIXMuY3Jvc3NEb21haW4gfHwgalF1ZXJ5LnN1cHBvcnQuY29ycyApIHsKCgkJCXZhciBjYWxsYmFjazsKCgkJCXJldHVybiB7CgkJCQlzZW5kOiBmdW5jdGlvbiggaGVhZGVycywgY29tcGxldGUgKSB7CgoJCQkJCS8vIEdldCBhIG5ldyB4aHIKCQkJCQl2YXIgaGFuZGxlLCBpLAoJCQkJCQl4aHIgPSBzLnhocigpOwoKCQkJCQkvLyBPcGVuIHRoZSBzb2NrZXQKCQkJCQkvLyBQYXNzaW5nIG51bGwgdXNlcm5hbWUsIGdlbmVyYXRlcyBhIGxvZ2luIHBvcHVwIG9uIE9wZXJhICgjMjg2NSkKCQkJCQlpZiAoIHMudXNlcm5hbWUgKSB7CgkJCQkJCXhoci5vcGVuKCBzLnR5cGUsIHMudXJsLCBzLmFzeW5jLCBzLnVzZXJuYW1lLCBzLnBhc3N3b3JkICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJeGhyLm9wZW4oIHMudHlwZSwgcy51cmwsIHMuYXN5bmMgKTsKCQkJCQl9CgoJCQkJCS8vIEFwcGx5IGN1c3RvbSBmaWVsZHMgaWYgcHJvdmlkZWQKCQkJCQlpZiAoIHMueGhyRmllbGRzICkgewoJCQkJCQlmb3IgKCBpIGluIHMueGhyRmllbGRzICkgewoJCQkJCQkJeGhyWyBpIF0gPSBzLnhockZpZWxkc1sgaSBdOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBPdmVycmlkZSBtaW1lIHR5cGUgaWYgbmVlZGVkCgkJCQkJaWYgKCBzLm1pbWVUeXBlICYmIHhoci5vdmVycmlkZU1pbWVUeXBlICkgewoJCQkJCQl4aHIub3ZlcnJpZGVNaW1lVHlwZSggcy5taW1lVHlwZSApOwoJCQkJCX0KCgkJCQkJLy8gWC1SZXF1ZXN0ZWQtV2l0aCBoZWFkZXIKCQkJCQkvLyBGb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzLCBzZWVpbmcgYXMgY29uZGl0aW9ucyBmb3IgYSBwcmVmbGlnaHQgYXJlCgkJCQkJLy8gYWtpbiB0byBhIGppZ3NhdyBwdXp6bGUsIHdlIHNpbXBseSBuZXZlciBzZXQgaXQgdG8gYmUgc3VyZS4KCQkJCQkvLyAoaXQgY2FuIGFsd2F5cyBiZSBzZXQgb24gYSBwZXItcmVxdWVzdCBiYXNpcyBvciBldmVuIHVzaW5nIGFqYXhTZXR1cCkKCQkJCQkvLyBGb3Igc2FtZS1kb21haW4gcmVxdWVzdHMsIHdvbid0IGNoYW5nZSBoZWFkZXIgaWYgYWxyZWFkeSBwcm92aWRlZC4KCQkJCQlpZiAoICFzLmNyb3NzRG9tYWluICYmICFoZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0gKSB7CgkJCQkJCWhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSA9ICJYTUxIdHRwUmVxdWVzdCI7CgkJCQkJfQoKCQkJCQkvLyBOZWVkIGFuIGV4dHJhIHRyeS9jYXRjaCBmb3IgY3Jvc3MgZG9tYWluIHJlcXVlc3RzIGluIEZpcmVmb3ggMwoJCQkJCXRyeSB7CgkJCQkJCWZvciAoIGkgaW4gaGVhZGVycyApIHsKCQkJCQkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCBpLCBoZWFkZXJzWyBpIF0gKTsKCQkJCQkJfQoJCQkJCX0gY2F0Y2goIGVyciApIHt9CgoJCQkJCS8vIERvIHNlbmQgdGhlIHJlcXVlc3QKCQkJCQkvLyBUaGlzIG1heSByYWlzZSBhbiBleGNlcHRpb24gd2hpY2ggaXMgYWN0dWFsbHkKCQkJCQkvLyBoYW5kbGVkIGluIGpRdWVyeS5hamF4IChzbyBubyB0cnkvY2F0Y2ggaGVyZSkKCQkJCQl4aHIuc2VuZCggKCBzLmhhc0NvbnRlbnQgJiYgcy5kYXRhICkgfHwgbnVsbCApOwoKCQkJCQkvLyBMaXN0ZW5lcgoJCQkJCWNhbGxiYWNrID0gZnVuY3Rpb24oIF8sIGlzQWJvcnQgKSB7CgkJCQkJCXZhciBzdGF0dXMsIHJlc3BvbnNlSGVhZGVycywgc3RhdHVzVGV4dCwgcmVzcG9uc2VzOwoKCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgZXhjZXB0aW9ucyB3aGVuIGFjY2Vzc2luZyBwcm9wZXJ0aWVzCgkJCQkJCS8vIG9mIGFuIHhociB3aGVuIGEgbmV0d29yayBlcnJvciBvY2N1cnJlZAoJCQkJCQkvLyBodHRwOi8vaGVscGZ1bC5rbm9icy1kaWFscy5jb20vaW5kZXgucGhwL0NvbXBvbmVudF9yZXR1cm5lZF9mYWlsdXJlX2NvZGU6XzB4ODAwNDAxMTFfKE5TX0VSUk9SX05PVF9BVkFJTEFCTEUpCgkJCQkJCXRyeSB7CgoJCQkJCQkJLy8gV2FzIG5ldmVyIGNhbGxlZCBhbmQgaXMgYWJvcnRlZCBvciBjb21wbGV0ZQoJCQkJCQkJaWYgKCBjYWxsYmFjayAmJiAoIGlzQWJvcnQgfHwgeGhyLnJlYWR5U3RhdGUgPT09IDQgKSApIHsKCgkJCQkJCQkJLy8gT25seSBjYWxsZWQgb25jZQoJCQkJCQkJCWNhbGxiYWNrID0gdW5kZWZpbmVkOwoKCQkJCQkJCQkvLyBEbyBub3Qga2VlcCBhcyBhY3RpdmUgYW55bW9yZQoJCQkJCQkJCWlmICggaGFuZGxlICkgewoJCQkJCQkJCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0galF1ZXJ5Lm5vb3A7CgkJCQkJCQkJCWlmICggeGhyT25VbmxvYWRBYm9ydCApIHsKCQkJCQkJCQkJCWRlbGV0ZSB4aHJDYWxsYmFja3NbIGhhbmRsZSBdOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBJZiBpdCdzIGFuIGFib3J0CgkJCQkJCQkJaWYgKCBpc0Fib3J0ICkgewoJCQkJCQkJCQkvLyBBYm9ydCBpdCBtYW51YWxseSBpZiBuZWVkZWQKCQkJCQkJCQkJaWYgKCB4aHIucmVhZHlTdGF0ZSAhPT0gNCApIHsKCQkJCQkJCQkJCXhoci5hYm9ydCgpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJcmVzcG9uc2VzID0ge307CgkJCQkJCQkJCXN0YXR1cyA9IHhoci5zdGF0dXM7CgkJCQkJCQkJCXJlc3BvbnNlSGVhZGVycyA9IHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTsKCgkJCQkJCQkJCS8vIFdoZW4gcmVxdWVzdGluZyBiaW5hcnkgZGF0YSwgSUU2LTkgd2lsbCB0aHJvdyBhbiBleGNlcHRpb24KCQkJCQkJCQkJLy8gb24gYW55IGF0dGVtcHQgdG8gYWNjZXNzIHJlc3BvbnNlVGV4dCAoIzExNDI2KQoJCQkJCQkJCQlpZiAoIHR5cGVvZiB4aHIucmVzcG9uc2VUZXh0ID09PSAic3RyaW5nIiApIHsKCQkJCQkJCQkJCXJlc3BvbnNlcy50ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDsKCQkJCQkJCQkJfQoKCQkJCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgYW4gZXhjZXB0aW9uIHdoZW4gYWNjZXNzaW5nCgkJCQkJCQkJCS8vIHN0YXR1c1RleHQgZm9yIGZhdWx0eSBjcm9zcy1kb21haW4gcmVxdWVzdHMKCQkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJCXN0YXR1c1RleHQgPSB4aHIuc3RhdHVzVGV4dDsKCQkJCQkJCQkJfSBjYXRjaCggZSApIHsKCQkJCQkJCQkJCS8vIFdlIG5vcm1hbGl6ZSB3aXRoIFdlYmtpdCBnaXZpbmcgYW4gZW1wdHkgc3RhdHVzVGV4dAoJCQkJCQkJCQkJc3RhdHVzVGV4dCA9ICIiOwoJCQkJCQkJCQl9CgoJCQkJCQkJCQkvLyBGaWx0ZXIgc3RhdHVzIGZvciBub24gc3RhbmRhcmQgYmVoYXZpb3JzCgoJCQkJCQkJCQkvLyBJZiB0aGUgcmVxdWVzdCBpcyBsb2NhbCBhbmQgd2UgaGF2ZSBkYXRhOiBhc3N1bWUgYSBzdWNjZXNzCgkJCQkJCQkJCS8vIChzdWNjZXNzIHdpdGggbm8gZGF0YSB3b24ndCBnZXQgbm90aWZpZWQsIHRoYXQncyB0aGUgYmVzdCB3ZQoJCQkJCQkJCQkvLyBjYW4gZG8gZ2l2ZW4gY3VycmVudCBpbXBsZW1lbnRhdGlvbnMpCgkJCQkJCQkJCWlmICggIXN0YXR1cyAmJiBzLmlzTG9jYWwgJiYgIXMuY3Jvc3NEb21haW4gKSB7CgkJCQkJCQkJCQlzdGF0dXMgPSByZXNwb25zZXMudGV4dCA/IDIwMCA6IDQwNDsKCQkJCQkJCQkJLy8gSUUgLSAjMTQ1MDogc29tZXRpbWVzIHJldHVybnMgMTIyMyB3aGVuIGl0IHNob3VsZCBiZSAyMDQKCQkJCQkJCQkJfSBlbHNlIGlmICggc3RhdHVzID09PSAxMjIzICkgewoJCQkJCQkJCQkJc3RhdHVzID0gMjA0OwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9IGNhdGNoKCBmaXJlZm94QWNjZXNzRXhjZXB0aW9uICkgewoJCQkJCQkJaWYgKCAhaXNBYm9ydCApIHsKCQkJCQkJCQljb21wbGV0ZSggLTEsIGZpcmVmb3hBY2Nlc3NFeGNlcHRpb24gKTsKCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gQ2FsbCBjb21wbGV0ZSBpZiBuZWVkZWQKCQkJCQkJaWYgKCByZXNwb25zZXMgKSB7CgkJCQkJCQljb21wbGV0ZSggc3RhdHVzLCBzdGF0dXNUZXh0LCByZXNwb25zZXMsIHJlc3BvbnNlSGVhZGVycyApOwoJCQkJCQl9CgkJCQkJfTsKCgkJCQkJaWYgKCAhcy5hc3luYyApIHsKCQkJCQkJLy8gaWYgd2UncmUgaW4gc3luYyBtb2RlIHdlIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCWNhbGxiYWNrKCk7CgkJCQkJfSBlbHNlIGlmICggeGhyLnJlYWR5U3RhdGUgPT09IDQgKSB7CgkJCQkJCS8vIChJRTYgJiBJRTcpIGlmIGl0J3MgaW4gY2FjaGUgYW5kIGhhcyBiZWVuCgkJCQkJCS8vIHJldHJpZXZlZCBkaXJlY3RseSB3ZSBuZWVkIHRvIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCXNldFRpbWVvdXQoIGNhbGxiYWNrICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJaGFuZGxlID0gKyt4aHJJZDsKCQkJCQkJaWYgKCB4aHJPblVubG9hZEFib3J0ICkgewoJCQkJCQkJLy8gQ3JlYXRlIHRoZSBhY3RpdmUgeGhycyBjYWxsYmFja3MgbGlzdCBpZiBuZWVkZWQKCQkJCQkJCS8vIGFuZCBhdHRhY2ggdGhlIHVubG9hZCBoYW5kbGVyCgkJCQkJCQlpZiAoICF4aHJDYWxsYmFja3MgKSB7CgkJCQkJCQkJeGhyQ2FsbGJhY2tzID0ge307CgkJCQkJCQkJalF1ZXJ5KCB3aW5kb3cgKS51bmxvYWQoIHhock9uVW5sb2FkQWJvcnQgKTsKCQkJCQkJCX0KCQkJCQkJCS8vIEFkZCB0byBsaXN0IG9mIGFjdGl2ZSB4aHJzIGNhbGxiYWNrcwoJCQkJCQkJeGhyQ2FsbGJhY2tzWyBoYW5kbGUgXSA9IGNhbGxiYWNrOwoJCQkJCQl9CgkJCQkJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBjYWxsYmFjazsKCQkJCQl9CgkJCQl9LAoKCQkJCWFib3J0OiBmdW5jdGlvbigpIHsKCQkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCQljYWxsYmFjayggdW5kZWZpbmVkLCB0cnVlICk7CgkJCQkJfQoJCQkJfQoJCQl9OwoJCX0KCX0pOwp9CnZhciBmeE5vdywgdGltZXJJZCwKCXJmeHR5cGVzID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLAoJcmZ4bnVtID0gbmV3IFJlZ0V4cCggIl4oPzooWystXSk9fCkoIiArIGNvcmVfcG51bSArICIpKFthLXolXSopJCIsICJpIiApLAoJcnJ1biA9IC9xdWV1ZUhvb2tzJC8sCglhbmltYXRpb25QcmVmaWx0ZXJzID0gWyBkZWZhdWx0UHJlZmlsdGVyIF0sCgl0d2VlbmVycyA9IHsKCQkiKiI6IFtmdW5jdGlvbiggcHJvcCwgdmFsdWUgKSB7CgkJCXZhciBlbmQsIHVuaXQsCgkJCQl0d2VlbiA9IHRoaXMuY3JlYXRlVHdlZW4oIHByb3AsIHZhbHVlICksCgkJCQlwYXJ0cyA9IHJmeG51bS5leGVjKCB2YWx1ZSApLAoJCQkJdGFyZ2V0ID0gdHdlZW4uY3VyKCksCgkJCQlzdGFydCA9ICt0YXJnZXQgfHwgMCwKCQkJCXNjYWxlID0gMSwKCQkJCW1heEl0ZXJhdGlvbnMgPSAyMDsKCgkJCWlmICggcGFydHMgKSB7CgkJCQllbmQgPSArcGFydHNbMl07CgkJCQl1bml0ID0gcGFydHNbM10gfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKTsKCgkJCQkvLyBXZSBuZWVkIHRvIGNvbXB1dGUgc3RhcnRpbmcgdmFsdWUKCQkJCWlmICggdW5pdCAhPT0gInB4IiAmJiBzdGFydCApIHsKCQkJCQkvLyBJdGVyYXRpdmVseSBhcHByb3hpbWF0ZSBmcm9tIGEgbm9uemVybyBzdGFydGluZyBwb2ludAoJCQkJCS8vIFByZWZlciB0aGUgY3VycmVudCBwcm9wZXJ0eSwgYmVjYXVzZSB0aGlzIHByb2Nlc3Mgd2lsbCBiZSB0cml2aWFsIGlmIGl0IHVzZXMgdGhlIHNhbWUgdW5pdHMKCQkJCQkvLyBGYWxsYmFjayB0byBlbmQgb3IgYSBzaW1wbGUgY29uc3RhbnQKCQkJCQlzdGFydCA9IGpRdWVyeS5jc3MoIHR3ZWVuLmVsZW0sIHByb3AsIHRydWUgKSB8fCBlbmQgfHwgMTsKCgkJCQkJZG8gewoJCQkJCQkvLyBJZiBwcmV2aW91cyBpdGVyYXRpb24gemVyb2VkIG91dCwgZG91YmxlIHVudGlsIHdlIGdldCAqc29tZXRoaW5nKgoJCQkJCQkvLyBVc2UgYSBzdHJpbmcgZm9yIGRvdWJsaW5nIGZhY3RvciBzbyB3ZSBkb24ndCBhY2NpZGVudGFsbHkgc2VlIHNjYWxlIGFzIHVuY2hhbmdlZCBiZWxvdwoJCQkJCQlzY2FsZSA9IHNjYWxlIHx8ICIuNSI7CgoJCQkJCQkvLyBBZGp1c3QgYW5kIGFwcGx5CgkJCQkJCXN0YXJ0ID0gc3RhcnQgLyBzY2FsZTsKCQkJCQkJalF1ZXJ5LnN0eWxlKCB0d2Vlbi5lbGVtLCBwcm9wLCBzdGFydCArIHVuaXQgKTsKCgkJCQkJLy8gVXBkYXRlIHNjYWxlLCB0b2xlcmF0aW5nIHplcm8gb3IgTmFOIGZyb20gdHdlZW4uY3VyKCkKCQkJCQkvLyBBbmQgYnJlYWtpbmcgdGhlIGxvb3AgaWYgc2NhbGUgaXMgdW5jaGFuZ2VkIG9yIHBlcmZlY3QsIG9yIGlmIHdlJ3ZlIGp1c3QgaGFkIGVub3VnaAoJCQkJCX0gd2hpbGUgKCBzY2FsZSAhPT0gKHNjYWxlID0gdHdlZW4uY3VyKCkgLyB0YXJnZXQpICYmIHNjYWxlICE9PSAxICYmIC0tbWF4SXRlcmF0aW9ucyApOwoJCQkJfQoKCQkJCXR3ZWVuLnVuaXQgPSB1bml0OwoJCQkJdHdlZW4uc3RhcnQgPSBzdGFydDsKCQkJCS8vIElmIGEgKz0vLT0gdG9rZW4gd2FzIHByb3ZpZGVkLCB3ZSdyZSBkb2luZyBhIHJlbGF0aXZlIGFuaW1hdGlvbgoJCQkJdHdlZW4uZW5kID0gcGFydHNbMV0gPyBzdGFydCArICggcGFydHNbMV0gKyAxICkgKiBlbmQgOiBlbmQ7CgkJCX0KCQkJcmV0dXJuIHR3ZWVuOwoJCX1dCgl9OwoKLy8gQW5pbWF0aW9ucyBjcmVhdGVkIHN5bmNocm9ub3VzbHkgd2lsbCBydW4gc3luY2hyb25vdXNseQpmdW5jdGlvbiBjcmVhdGVGeE5vdygpIHsKCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJZnhOb3cgPSB1bmRlZmluZWQ7Cgl9KTsKCXJldHVybiAoIGZ4Tm93ID0galF1ZXJ5Lm5vdygpICk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVR3ZWVucyggYW5pbWF0aW9uLCBwcm9wcyApIHsKCWpRdWVyeS5lYWNoKCBwcm9wcywgZnVuY3Rpb24oIHByb3AsIHZhbHVlICkgewoJCXZhciBjb2xsZWN0aW9uID0gKCB0d2VlbmVyc1sgcHJvcCBdIHx8IFtdICkuY29uY2F0KCB0d2VlbmVyc1sgIioiIF0gKSwKCQkJaW5kZXggPSAwLAoJCQlsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCQlpZiAoIGNvbGxlY3Rpb25bIGluZGV4IF0uY2FsbCggYW5pbWF0aW9uLCBwcm9wLCB2YWx1ZSApICkgewoKCQkJCS8vIHdlJ3JlIGRvbmUgd2l0aCB0aGlzIHByb3BlcnR5CgkJCQlyZXR1cm47CgkJCX0KCQl9Cgl9KTsKfQoKZnVuY3Rpb24gQW5pbWF0aW9uKCBlbGVtLCBwcm9wZXJ0aWVzLCBvcHRpb25zICkgewoJdmFyIHJlc3VsdCwKCQlzdG9wcGVkLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBhbmltYXRpb25QcmVmaWx0ZXJzLmxlbmd0aCwKCQlkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCS8vIGRvbid0IG1hdGNoIGVsZW0gaW4gdGhlIDphbmltYXRlZCBzZWxlY3RvcgoJCQlkZWxldGUgdGljay5lbGVtOwoJCX0pLAoJCXRpY2sgPSBmdW5jdGlvbigpIHsKCQkJaWYgKCBzdG9wcGVkICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCXZhciBjdXJyZW50VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCksCgkJCQlyZW1haW5pbmcgPSBNYXRoLm1heCggMCwgYW5pbWF0aW9uLnN0YXJ0VGltZSArIGFuaW1hdGlvbi5kdXJhdGlvbiAtIGN1cnJlbnRUaW1lICksCgkJCQkvLyBhcmNoYWljIGNyYXNoIGJ1ZyB3b24ndCBhbGxvdyB1cyB0byB1c2UgMSAtICggMC41IHx8IDAgKSAoIzEyNDk3KQoJCQkJdGVtcCA9IHJlbWFpbmluZyAvIGFuaW1hdGlvbi5kdXJhdGlvbiB8fCAwLAoJCQkJcGVyY2VudCA9IDEgLSB0ZW1wLAoJCQkJaW5kZXggPSAwLAoJCQkJbGVuZ3RoID0gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGg7CgoJCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCBwZXJjZW50ICk7CgkJCX0KCgkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCBwZXJjZW50LCByZW1haW5pbmcgXSk7CgoJCQlpZiAoIHBlcmNlbnQgPCAxICYmIGxlbmd0aCApIHsKCQkJCXJldHVybiByZW1haW5pbmc7CgkJCX0gZWxzZSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24gXSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSwKCQlhbmltYXRpb24gPSBkZWZlcnJlZC5wcm9taXNlKHsKCQkJZWxlbTogZWxlbSwKCQkJcHJvcHM6IGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wZXJ0aWVzICksCgkJCW9wdHM6IGpRdWVyeS5leHRlbmQoIHRydWUsIHsgc3BlY2lhbEVhc2luZzoge30gfSwgb3B0aW9ucyApLAoJCQlvcmlnaW5hbFByb3BlcnRpZXM6IHByb3BlcnRpZXMsCgkJCW9yaWdpbmFsT3B0aW9uczogb3B0aW9ucywKCQkJc3RhcnRUaW1lOiBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAoJCQlkdXJhdGlvbjogb3B0aW9ucy5kdXJhdGlvbiwKCQkJdHdlZW5zOiBbXSwKCQkJY3JlYXRlVHdlZW46IGZ1bmN0aW9uKCBwcm9wLCBlbmQgKSB7CgkJCQl2YXIgdHdlZW4gPSBqUXVlcnkuVHdlZW4oIGVsZW0sIGFuaW1hdGlvbi5vcHRzLCBwcm9wLCBlbmQsCgkJCQkJCWFuaW1hdGlvbi5vcHRzLnNwZWNpYWxFYXNpbmdbIHByb3AgXSB8fCBhbmltYXRpb24ub3B0cy5lYXNpbmcgKTsKCQkJCWFuaW1hdGlvbi50d2VlbnMucHVzaCggdHdlZW4gKTsKCQkJCXJldHVybiB0d2VlbjsKCQkJfSwKCQkJc3RvcDogZnVuY3Rpb24oIGdvdG9FbmQgKSB7CgkJCQl2YXIgaW5kZXggPSAwLAoJCQkJCS8vIGlmIHdlIGFyZSBnb2luZyB0byB0aGUgZW5kLCB3ZSB3YW50IHRvIHJ1biBhbGwgdGhlIHR3ZWVucwoJCQkJCS8vIG90aGVyd2lzZSB3ZSBza2lwIHRoaXMgcGFydAoJCQkJCWxlbmd0aCA9IGdvdG9FbmQgPyBhbmltYXRpb24udHdlZW5zLmxlbmd0aCA6IDA7CgkJCQlpZiAoIHN0b3BwZWQgKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgkJCQlzdG9wcGVkID0gdHJ1ZTsKCQkJCWZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCAxICk7CgkJCQl9CgoJCQkJLy8gcmVzb2x2ZSB3aGVuIHdlIHBsYXllZCB0aGUgbGFzdCBmcmFtZQoJCQkJLy8gb3RoZXJ3aXNlLCByZWplY3QKCQkJCWlmICggZ290b0VuZCApIHsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWZlcnJlZC5yZWplY3RXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgZ290b0VuZCBdICk7CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfQoJCX0pLAoJCXByb3BzID0gYW5pbWF0aW9uLnByb3BzOwoKCXByb3BGaWx0ZXIoIHByb3BzLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nICk7CgoJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJcmVzdWx0ID0gYW5pbWF0aW9uUHJlZmlsdGVyc1sgaW5kZXggXS5jYWxsKCBhbmltYXRpb24sIGVsZW0sIHByb3BzLCBhbmltYXRpb24ub3B0cyApOwoJCWlmICggcmVzdWx0ICkgewoJCQlyZXR1cm4gcmVzdWx0OwoJCX0KCX0KCgljcmVhdGVUd2VlbnMoIGFuaW1hdGlvbiwgcHJvcHMgKTsKCglpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBhbmltYXRpb24ub3B0cy5zdGFydCApICkgewoJCWFuaW1hdGlvbi5vcHRzLnN0YXJ0LmNhbGwoIGVsZW0sIGFuaW1hdGlvbiApOwoJfQoKCWpRdWVyeS5meC50aW1lcigKCQlqUXVlcnkuZXh0ZW5kKCB0aWNrLCB7CgkJCWVsZW06IGVsZW0sCgkJCWFuaW06IGFuaW1hdGlvbiwKCQkJcXVldWU6IGFuaW1hdGlvbi5vcHRzLnF1ZXVlCgkJfSkKCSk7CgoJLy8gYXR0YWNoIGNhbGxiYWNrcyBmcm9tIG9wdGlvbnMKCXJldHVybiBhbmltYXRpb24ucHJvZ3Jlc3MoIGFuaW1hdGlvbi5vcHRzLnByb2dyZXNzICkKCQkuZG9uZSggYW5pbWF0aW9uLm9wdHMuZG9uZSwgYW5pbWF0aW9uLm9wdHMuY29tcGxldGUgKQoJCS5mYWlsKCBhbmltYXRpb24ub3B0cy5mYWlsICkKCQkuYWx3YXlzKCBhbmltYXRpb24ub3B0cy5hbHdheXMgKTsKfQoKZnVuY3Rpb24gcHJvcEZpbHRlciggcHJvcHMsIHNwZWNpYWxFYXNpbmcgKSB7Cgl2YXIgdmFsdWUsIG5hbWUsIGluZGV4LCBlYXNpbmcsIGhvb2tzOwoKCS8vIGNhbWVsQ2FzZSwgc3BlY2lhbEVhc2luZyBhbmQgZXhwYW5kIGNzc0hvb2sgcGFzcwoJZm9yICggaW5kZXggaW4gcHJvcHMgKSB7CgkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIGluZGV4ICk7CgkJZWFzaW5nID0gc3BlY2lhbEVhc2luZ1sgbmFtZSBdOwoJCXZhbHVlID0gcHJvcHNbIGluZGV4IF07CgkJaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHsKCQkJZWFzaW5nID0gdmFsdWVbIDEgXTsKCQkJdmFsdWUgPSBwcm9wc1sgaW5kZXggXSA9IHZhbHVlWyAwIF07CgkJfQoKCQlpZiAoIGluZGV4ICE9PSBuYW1lICkgewoJCQlwcm9wc1sgbmFtZSBdID0gdmFsdWU7CgkJCWRlbGV0ZSBwcm9wc1sgaW5kZXggXTsKCQl9CgoJCWhvb2tzID0galF1ZXJ5LmNzc0hvb2tzWyBuYW1lIF07CgkJaWYgKCBob29rcyAmJiAiZXhwYW5kIiBpbiBob29rcyApIHsKCQkJdmFsdWUgPSBob29rcy5leHBhbmQoIHZhbHVlICk7CgkJCWRlbGV0ZSBwcm9wc1sgbmFtZSBdOwoKCQkJLy8gbm90IHF1aXRlICQuZXh0ZW5kLCB0aGlzIHdvbnQgb3ZlcndyaXRlIGtleXMgYWxyZWFkeSBwcmVzZW50LgoJCQkvLyBhbHNvIC0gcmV1c2luZyAnaW5kZXgnIGZyb20gYWJvdmUgYmVjYXVzZSB3ZSBoYXZlIHRoZSBjb3JyZWN0ICJuYW1lIgoJCQlmb3IgKCBpbmRleCBpbiB2YWx1ZSApIHsKCQkJCWlmICggISggaW5kZXggaW4gcHJvcHMgKSApIHsKCQkJCQlwcm9wc1sgaW5kZXggXSA9IHZhbHVlWyBpbmRleCBdOwoJCQkJCXNwZWNpYWxFYXNpbmdbIGluZGV4IF0gPSBlYXNpbmc7CgkJCQl9CgkJCX0KCQl9IGVsc2UgewoJCQlzcGVjaWFsRWFzaW5nWyBuYW1lIF0gPSBlYXNpbmc7CgkJfQoJfQp9CgpqUXVlcnkuQW5pbWF0aW9uID0galF1ZXJ5LmV4dGVuZCggQW5pbWF0aW9uLCB7CgoJdHdlZW5lcjogZnVuY3Rpb24oIHByb3BzLCBjYWxsYmFjayApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBwcm9wcyApICkgewoJCQljYWxsYmFjayA9IHByb3BzOwoJCQlwcm9wcyA9IFsgIioiIF07CgkJfSBlbHNlIHsKCQkJcHJvcHMgPSBwcm9wcy5zcGxpdCgiICIpOwoJCX0KCgkJdmFyIHByb3AsCgkJCWluZGV4ID0gMCwKCQkJbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJcHJvcCA9IHByb3BzWyBpbmRleCBdOwoJCQl0d2VlbmVyc1sgcHJvcCBdID0gdHdlZW5lcnNbIHByb3AgXSB8fCBbXTsKCQkJdHdlZW5lcnNbIHByb3AgXS51bnNoaWZ0KCBjYWxsYmFjayApOwoJCX0KCX0sCgoJcHJlZmlsdGVyOiBmdW5jdGlvbiggY2FsbGJhY2ssIHByZXBlbmQgKSB7CgkJaWYgKCBwcmVwZW5kICkgewoJCQlhbmltYXRpb25QcmVmaWx0ZXJzLnVuc2hpZnQoIGNhbGxiYWNrICk7CgkJfSBlbHNlIHsKCQkJYW5pbWF0aW9uUHJlZmlsdGVycy5wdXNoKCBjYWxsYmFjayApOwoJCX0KCX0KfSk7CgpmdW5jdGlvbiBkZWZhdWx0UHJlZmlsdGVyKCBlbGVtLCBwcm9wcywgb3B0cyApIHsKCS8qanNoaW50IHZhbGlkdGhpczp0cnVlICovCgl2YXIgcHJvcCwgaW5kZXgsIGxlbmd0aCwKCQl2YWx1ZSwgZGF0YVNob3csIHRvZ2dsZSwKCQl0d2VlbiwgaG9va3MsIG9sZGZpcmUsCgkJYW5pbSA9IHRoaXMsCgkJc3R5bGUgPSBlbGVtLnN0eWxlLAoJCW9yaWcgPSB7fSwKCQloYW5kbGVkID0gW10sCgkJaGlkZGVuID0gZWxlbS5ub2RlVHlwZSAmJiBpc0hpZGRlbiggZWxlbSApOwoKCS8vIGhhbmRsZSBxdWV1ZTogZmFsc2UgcHJvbWlzZXMKCWlmICggIW9wdHMucXVldWUgKSB7CgkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sICJmeCIgKTsKCQlpZiAoIGhvb2tzLnVucXVldWVkID09IG51bGwgKSB7CgkJCWhvb2tzLnVucXVldWVkID0gMDsKCQkJb2xkZmlyZSA9IGhvb2tzLmVtcHR5LmZpcmU7CgkJCWhvb2tzLmVtcHR5LmZpcmUgPSBmdW5jdGlvbigpIHsKCQkJCWlmICggIWhvb2tzLnVucXVldWVkICkgewoJCQkJCW9sZGZpcmUoKTsKCQkJCX0KCQkJfTsKCQl9CgkJaG9va3MudW5xdWV1ZWQrKzsKCgkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCS8vIGRvaW5nIHRoaXMgbWFrZXMgc3VyZSB0aGF0IHRoZSBjb21wbGV0ZSBoYW5kbGVyIHdpbGwgYmUgY2FsbGVkCgkJCS8vIGJlZm9yZSB0aGlzIGNvbXBsZXRlcwoJCQlhbmltLmFsd2F5cyhmdW5jdGlvbigpIHsKCQkJCWhvb2tzLnVucXVldWVkLS07CgkJCQlpZiAoICFqUXVlcnkucXVldWUoIGVsZW0sICJmeCIgKS5sZW5ndGggKSB7CgkJCQkJaG9va3MuZW1wdHkuZmlyZSgpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCX0KCgkvLyBoZWlnaHQvd2lkdGggb3ZlcmZsb3cgcGFzcwoJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICggImhlaWdodCIgaW4gcHJvcHMgfHwgIndpZHRoIiBpbiBwcm9wcyApICkgewoJCS8vIE1ha2Ugc3VyZSB0aGF0IG5vdGhpbmcgc25lYWtzIG91dAoJCS8vIFJlY29yZCBhbGwgMyBvdmVyZmxvdyBhdHRyaWJ1dGVzIGJlY2F1c2UgSUUgZG9lcyBub3QKCQkvLyBjaGFuZ2UgdGhlIG92ZXJmbG93IGF0dHJpYnV0ZSB3aGVuIG92ZXJmbG93WCBhbmQKCQkvLyBvdmVyZmxvd1kgYXJlIHNldCB0byB0aGUgc2FtZSB2YWx1ZQoJCW9wdHMub3ZlcmZsb3cgPSBbIHN0eWxlLm92ZXJmbG93LCBzdHlsZS5vdmVyZmxvd1gsIHN0eWxlLm92ZXJmbG93WSBdOwoKCQkvLyBTZXQgZGlzcGxheSBwcm9wZXJ0eSB0byBpbmxpbmUtYmxvY2sgZm9yIGhlaWdodC93aWR0aAoJCS8vIGFuaW1hdGlvbnMgb24gaW5saW5lIGVsZW1lbnRzIHRoYXQgYXJlIGhhdmluZyB3aWR0aC9oZWlnaHQgYW5pbWF0ZWQKCQlpZiAoIGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApID09PSAiaW5saW5lIiAmJgoJCQkJalF1ZXJ5LmNzcyggZWxlbSwgImZsb2F0IiApID09PSAibm9uZSIgKSB7CgoJCQkvLyBpbmxpbmUtbGV2ZWwgZWxlbWVudHMgYWNjZXB0IGlubGluZS1ibG9jazsKCQkJLy8gYmxvY2stbGV2ZWwgZWxlbWVudHMgbmVlZCB0byBiZSBpbmxpbmUgd2l0aCBsYXlvdXQKCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCB8fCBjc3NfZGVmYXVsdERpc3BsYXkoIGVsZW0ubm9kZU5hbWUgKSA9PT0gImlubGluZSIgKSB7CgkJCQlzdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgoJCQl9IGVsc2UgewoJCQkJc3R5bGUuem9vbSA9IDE7CgkJCX0KCQl9Cgl9CgoJaWYgKCBvcHRzLm92ZXJmbG93ICkgewoJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyApIHsKCQkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCQlzdHlsZS5vdmVyZmxvdyA9IG9wdHMub3ZlcmZsb3dbIDAgXTsKCQkJCXN0eWxlLm92ZXJmbG93WCA9IG9wdHMub3ZlcmZsb3dbIDEgXTsKCQkJCXN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbIDIgXTsKCQkJfSk7CgkJfQoJfQoKCgkvLyBzaG93L2hpZGUgcGFzcwoJZm9yICggaW5kZXggaW4gcHJvcHMgKSB7CgkJdmFsdWUgPSBwcm9wc1sgaW5kZXggXTsKCQlpZiAoIHJmeHR5cGVzLmV4ZWMoIHZhbHVlICkgKSB7CgkJCWRlbGV0ZSBwcm9wc1sgaW5kZXggXTsKCQkJdG9nZ2xlID0gdG9nZ2xlIHx8IHZhbHVlID09PSAidG9nZ2xlIjsKCQkJaWYgKCB2YWx1ZSA9PT0gKCBoaWRkZW4gPyAiaGlkZSIgOiAic2hvdyIgKSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCWhhbmRsZWQucHVzaCggaW5kZXggKTsKCQl9Cgl9CgoJbGVuZ3RoID0gaGFuZGxlZC5sZW5ndGg7CglpZiAoIGxlbmd0aCApIHsKCQlkYXRhU2hvdyA9IGpRdWVyeS5fZGF0YSggZWxlbSwgImZ4c2hvdyIgKSB8fCBqUXVlcnkuX2RhdGEoIGVsZW0sICJmeHNob3ciLCB7fSApOwoJCWlmICggImhpZGRlbiIgaW4gZGF0YVNob3cgKSB7CgkJCWhpZGRlbiA9IGRhdGFTaG93LmhpZGRlbjsKCQl9CgoJCS8vIHN0b3JlIHN0YXRlIGlmIGl0cyB0b2dnbGUgLSBlbmFibGVzIC5zdG9wKCkudG9nZ2xlKCkgdG8gInJldmVyc2UiCgkJaWYgKCB0b2dnbGUgKSB7CgkJCWRhdGFTaG93LmhpZGRlbiA9ICFoaWRkZW47CgkJfQoJCWlmICggaGlkZGVuICkgewoJCQlqUXVlcnkoIGVsZW0gKS5zaG93KCk7CgkJfSBlbHNlIHsKCQkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5KCBlbGVtICkuaGlkZSgpOwoJCQl9KTsKCQl9CgkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQl2YXIgcHJvcDsKCQkJalF1ZXJ5Ll9yZW1vdmVEYXRhKCBlbGVtLCAiZnhzaG93IiApOwoJCQlmb3IgKCBwcm9wIGluIG9yaWcgKSB7CgkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIHByb3AsIG9yaWdbIHByb3AgXSApOwoJCQl9CgkJfSk7CgkJZm9yICggaW5kZXggPSAwIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQlwcm9wID0gaGFuZGxlZFsgaW5kZXggXTsKCQkJdHdlZW4gPSBhbmltLmNyZWF0ZVR3ZWVuKCBwcm9wLCBoaWRkZW4gPyBkYXRhU2hvd1sgcHJvcCBdIDogMCApOwoJCQlvcmlnWyBwcm9wIF0gPSBkYXRhU2hvd1sgcHJvcCBdIHx8IGpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCApOwoKCQkJaWYgKCAhKCBwcm9wIGluIGRhdGFTaG93ICkgKSB7CgkJCQlkYXRhU2hvd1sgcHJvcCBdID0gdHdlZW4uc3RhcnQ7CgkJCQlpZiAoIGhpZGRlbiApIHsKCQkJCQl0d2Vlbi5lbmQgPSB0d2Vlbi5zdGFydDsKCQkJCQl0d2Vlbi5zdGFydCA9IHByb3AgPT09ICJ3aWR0aCIgfHwgcHJvcCA9PT0gImhlaWdodCIgPyAxIDogMDsKCQkJCX0KCQkJfQoJCX0KCX0KfQoKZnVuY3Rpb24gVHdlZW4oIGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nICkgewoJcmV0dXJuIG5ldyBUd2Vlbi5wcm90b3R5cGUuaW5pdCggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcgKTsKfQpqUXVlcnkuVHdlZW4gPSBUd2VlbjsKClR3ZWVuLnByb3RvdHlwZSA9IHsKCWNvbnN0cnVjdG9yOiBUd2VlbiwKCWluaXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZywgdW5pdCApIHsKCQl0aGlzLmVsZW0gPSBlbGVtOwoJCXRoaXMucHJvcCA9IHByb3A7CgkJdGhpcy5lYXNpbmcgPSBlYXNpbmcgfHwgInN3aW5nIjsKCQl0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwoJCXRoaXMuc3RhcnQgPSB0aGlzLm5vdyA9IHRoaXMuY3VyKCk7CgkJdGhpcy5lbmQgPSBlbmQ7CgkJdGhpcy51bml0ID0gdW5pdCB8fCAoIGpRdWVyeS5jc3NOdW1iZXJbIHByb3AgXSA/ICIiIDogInB4IiApOwoJfSwKCWN1cjogZnVuY3Rpb24oKSB7CgkJdmFyIGhvb2tzID0gVHdlZW4ucHJvcEhvb2tzWyB0aGlzLnByb3AgXTsKCgkJcmV0dXJuIGhvb2tzICYmIGhvb2tzLmdldCA/CgkJCWhvb2tzLmdldCggdGhpcyApIDoKCQkJVHdlZW4ucHJvcEhvb2tzLl9kZWZhdWx0LmdldCggdGhpcyApOwoJfSwKCXJ1bjogZnVuY3Rpb24oIHBlcmNlbnQgKSB7CgkJdmFyIGVhc2VkLAoJCQlob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07CgoJCWlmICggdGhpcy5vcHRpb25zLmR1cmF0aW9uICkgewoJCQl0aGlzLnBvcyA9IGVhc2VkID0galF1ZXJ5LmVhc2luZ1sgdGhpcy5lYXNpbmcgXSgKCQkJCXBlcmNlbnQsIHRoaXMub3B0aW9ucy5kdXJhdGlvbiAqIHBlcmNlbnQsIDAsIDEsIHRoaXMub3B0aW9ucy5kdXJhdGlvbgoJCQkpOwoJCX0gZWxzZSB7CgkJCXRoaXMucG9zID0gZWFzZWQgPSBwZXJjZW50OwoJCX0KCQl0aGlzLm5vdyA9ICggdGhpcy5lbmQgLSB0aGlzLnN0YXJ0ICkgKiBlYXNlZCArIHRoaXMuc3RhcnQ7CgoJCWlmICggdGhpcy5vcHRpb25zLnN0ZXAgKSB7CgkJCXRoaXMub3B0aW9ucy5zdGVwLmNhbGwoIHRoaXMuZWxlbSwgdGhpcy5ub3csIHRoaXMgKTsKCQl9CgoJCWlmICggaG9va3MgJiYgaG9va3Muc2V0ICkgewoJCQlob29rcy5zZXQoIHRoaXMgKTsKCQl9IGVsc2UgewoJCQlUd2Vlbi5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KCB0aGlzICk7CgkJfQoJCXJldHVybiB0aGlzOwoJfQp9OwoKVHdlZW4ucHJvdG90eXBlLmluaXQucHJvdG90eXBlID0gVHdlZW4ucHJvdG90eXBlOwoKVHdlZW4ucHJvcEhvb2tzID0gewoJX2RlZmF1bHQ6IHsKCQlnZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQkJdmFyIHJlc3VsdDsKCgkJCWlmICggdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdICE9IG51bGwgJiYKCQkJCSghdHdlZW4uZWxlbS5zdHlsZSB8fCB0d2Vlbi5lbGVtLnN0eWxlWyB0d2Vlbi5wcm9wIF0gPT0gbnVsbCkgKSB7CgkJCQlyZXR1cm4gdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdOwoJCQl9CgoJCQkvLyBwYXNzaW5nIGFuIGVtcHR5IHN0cmluZyBhcyBhIDNyZCBwYXJhbWV0ZXIgdG8gLmNzcyB3aWxsIGF1dG9tYXRpY2FsbHkKCQkJLy8gYXR0ZW1wdCBhIHBhcnNlRmxvYXQgYW5kIGZhbGxiYWNrIHRvIGEgc3RyaW5nIGlmIHRoZSBwYXJzZSBmYWlscwoJCQkvLyBzbywgc2ltcGxlIHZhbHVlcyBzdWNoIGFzICIxMHB4IiBhcmUgcGFyc2VkIHRvIEZsb2F0LgoJCQkvLyBjb21wbGV4IHZhbHVlcyBzdWNoIGFzICJyb3RhdGUoMXJhZCkiIGFyZSByZXR1cm5lZCBhcyBpcy4KCQkJcmVzdWx0ID0galF1ZXJ5LmNzcyggdHdlZW4uZWxlbSwgdHdlZW4ucHJvcCwgIiIgKTsKCQkJLy8gRW1wdHkgc3RyaW5ncywgbnVsbCwgdW5kZWZpbmVkIGFuZCAiYXV0byIgYXJlIGNvbnZlcnRlZCB0byAwLgoJCQlyZXR1cm4gIXJlc3VsdCB8fCByZXN1bHQgPT09ICJhdXRvIiA/IDAgOiByZXN1bHQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQkJLy8gdXNlIHN0ZXAgaG9vayBmb3IgYmFjayBjb21wYXQgLSB1c2UgY3NzSG9vayBpZiBpdHMgdGhlcmUgLSB1c2UgLnN0eWxlIGlmIGl0cwoJCQkvLyBhdmFpbGFibGUgYW5kIHVzZSBwbGFpbiBwcm9wZXJ0aWVzIHdoZXJlIGF2YWlsYWJsZQoJCQlpZiAoIGpRdWVyeS5meC5zdGVwWyB0d2Vlbi5wcm9wIF0gKSB7CgkJCQlqUXVlcnkuZnguc3RlcFsgdHdlZW4ucHJvcCBdKCB0d2VlbiApOwoJCQl9IGVsc2UgaWYgKCB0d2Vlbi5lbGVtLnN0eWxlICYmICggdHdlZW4uZWxlbS5zdHlsZVsgalF1ZXJ5LmNzc1Byb3BzWyB0d2Vlbi5wcm9wIF0gXSAhPSBudWxsIHx8IGpRdWVyeS5jc3NIb29rc1sgdHdlZW4ucHJvcCBdICkgKSB7CgkJCQlqUXVlcnkuc3R5bGUoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsIHR3ZWVuLm5vdyArIHR3ZWVuLnVuaXQgKTsKCQkJfSBlbHNlIHsKCQkJCXR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSA9IHR3ZWVuLm5vdzsKCQkJfQoJCX0KCX0KfTsKCi8vIFJlbW92ZSBpbiAyLjAgLSB0aGlzIHN1cHBvcnRzIElFOCdzIHBhbmljIGJhc2VkIGFwcHJvYWNoCi8vIHRvIHNldHRpbmcgdGhpbmdzIG9uIGRpc2Nvbm5lY3RlZCBub2RlcwoKVHdlZW4ucHJvcEhvb2tzLnNjcm9sbFRvcCA9IFR3ZWVuLnByb3BIb29rcy5zY3JvbGxMZWZ0ID0gewoJc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJaWYgKCB0d2Vlbi5lbGVtLm5vZGVUeXBlICYmIHR3ZWVuLmVsZW0ucGFyZW50Tm9kZSApIHsKCQkJdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdID0gdHdlZW4ubm93OwoJCX0KCX0KfTsKCmpRdWVyeS5lYWNoKFsgInRvZ2dsZSIsICJzaG93IiwgImhpZGUiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJdmFyIGNzc0ZuID0galF1ZXJ5LmZuWyBuYW1lIF07CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQlyZXR1cm4gc3BlZWQgPT0gbnVsbCB8fCB0eXBlb2Ygc3BlZWQgPT09ICJib29sZWFuIiA/CgkJCWNzc0ZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSA6CgkJCXRoaXMuYW5pbWF0ZSggZ2VuRngoIG5hbWUsIHRydWUgKSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX07Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglmYWRlVG86IGZ1bmN0aW9uKCBzcGVlZCwgdG8sIGVhc2luZywgY2FsbGJhY2sgKSB7CgoJCS8vIHNob3cgYW55IGhpZGRlbiBlbGVtZW50cyBhZnRlciBzZXR0aW5nIG9wYWNpdHkgdG8gMAoJCXJldHVybiB0aGlzLmZpbHRlciggaXNIaWRkZW4gKS5jc3MoICJvcGFjaXR5IiwgMCApLnNob3coKQoKCQkJLy8gYW5pbWF0ZSB0byB0aGUgdmFsdWUgc3BlY2lmaWVkCgkJCS5lbmQoKS5hbmltYXRlKHsgb3BhY2l0eTogdG8gfSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX0sCglhbmltYXRlOiBmdW5jdGlvbiggcHJvcCwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJdmFyIGVtcHR5ID0galF1ZXJ5LmlzRW1wdHlPYmplY3QoIHByb3AgKSwKCQkJb3B0YWxsID0galF1ZXJ5LnNwZWVkKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApLAoJCQlkb0FuaW1hdGlvbiA9IGZ1bmN0aW9uKCkgewoJCQkJLy8gT3BlcmF0ZSBvbiBhIGNvcHkgb2YgcHJvcCBzbyBwZXItcHJvcGVydHkgZWFzaW5nIHdvbid0IGJlIGxvc3QKCQkJCXZhciBhbmltID0gQW5pbWF0aW9uKCB0aGlzLCBqUXVlcnkuZXh0ZW5kKCB7fSwgcHJvcCApLCBvcHRhbGwgKTsKCQkJCWRvQW5pbWF0aW9uLmZpbmlzaCA9IGZ1bmN0aW9uKCkgewoJCQkJCWFuaW0uc3RvcCggdHJ1ZSApOwoJCQkJfTsKCQkJCS8vIEVtcHR5IGFuaW1hdGlvbnMsIG9yIGZpbmlzaGluZyByZXNvbHZlcyBpbW1lZGlhdGVseQoJCQkJaWYgKCBlbXB0eSB8fCBqUXVlcnkuX2RhdGEoIHRoaXMsICJmaW5pc2giICkgKSB7CgkJCQkJYW5pbS5zdG9wKCB0cnVlICk7CgkJCQl9CgkJCX07CgkJCWRvQW5pbWF0aW9uLmZpbmlzaCA9IGRvQW5pbWF0aW9uOwoKCQlyZXR1cm4gZW1wdHkgfHwgb3B0YWxsLnF1ZXVlID09PSBmYWxzZSA/CgkJCXRoaXMuZWFjaCggZG9BbmltYXRpb24gKSA6CgkJCXRoaXMucXVldWUoIG9wdGFsbC5xdWV1ZSwgZG9BbmltYXRpb24gKTsKCX0sCglzdG9wOiBmdW5jdGlvbiggdHlwZSwgY2xlYXJRdWV1ZSwgZ290b0VuZCApIHsKCQl2YXIgc3RvcFF1ZXVlID0gZnVuY3Rpb24oIGhvb2tzICkgewoJCQl2YXIgc3RvcCA9IGhvb2tzLnN0b3A7CgkJCWRlbGV0ZSBob29rcy5zdG9wOwoJCQlzdG9wKCBnb3RvRW5kICk7CgkJfTsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCWdvdG9FbmQgPSBjbGVhclF1ZXVlOwoJCQljbGVhclF1ZXVlID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJaWYgKCBjbGVhclF1ZXVlICYmIHR5cGUgIT09IGZhbHNlICkgewoJCQl0aGlzLnF1ZXVlKCB0eXBlIHx8ICJmeCIsIFtdICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgZGVxdWV1ZSA9IHRydWUsCgkJCQlpbmRleCA9IHR5cGUgIT0gbnVsbCAmJiB0eXBlICsgInF1ZXVlSG9va3MiLAoJCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKTsKCgkJCWlmICggaW5kZXggKSB7CgkJCQlpZiAoIGRhdGFbIGluZGV4IF0gJiYgZGF0YVsgaW5kZXggXS5zdG9wICkgewoJCQkJCXN0b3BRdWV1ZSggZGF0YVsgaW5kZXggXSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZm9yICggaW5kZXggaW4gZGF0YSApIHsKCQkJCQlpZiAoIGRhdGFbIGluZGV4IF0gJiYgZGF0YVsgaW5kZXggXS5zdG9wICYmIHJydW4udGVzdCggaW5kZXggKSApIHsKCQkJCQkJc3RvcFF1ZXVlKCBkYXRhWyBpbmRleCBdICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlmb3IgKCBpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07ICkgewoJCQkJaWYgKCB0aW1lcnNbIGluZGV4IF0uZWxlbSA9PT0gdGhpcyAmJiAodHlwZSA9PSBudWxsIHx8IHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSkgKSB7CgkJCQkJdGltZXJzWyBpbmRleCBdLmFuaW0uc3RvcCggZ290b0VuZCApOwoJCQkJCWRlcXVldWUgPSBmYWxzZTsKCQkJCQl0aW1lcnMuc3BsaWNlKCBpbmRleCwgMSApOwoJCQkJfQoJCQl9CgoJCQkvLyBzdGFydCB0aGUgbmV4dCBpbiB0aGUgcXVldWUgaWYgdGhlIGxhc3Qgc3RlcCB3YXNuJ3QgZm9yY2VkCgkJCS8vIHRpbWVycyBjdXJyZW50bHkgd2lsbCBjYWxsIHRoZWlyIGNvbXBsZXRlIGNhbGxiYWNrcywgd2hpY2ggd2lsbCBkZXF1ZXVlCgkJCS8vIGJ1dCBvbmx5IGlmIHRoZXkgd2VyZSBnb3RvRW5kCgkJCWlmICggZGVxdWV1ZSB8fCAhZ290b0VuZCApIHsKCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJCX0KCQl9KTsKCX0sCglmaW5pc2g6IGZ1bmN0aW9uKCB0eXBlICkgewoJCWlmICggdHlwZSAhPT0gZmFsc2UgKSB7CgkJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgkJfQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBpbmRleCwKCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKSwKCQkJCXF1ZXVlID0gZGF0YVsgdHlwZSArICJxdWV1ZSIgXSwKCQkJCWhvb2tzID0gZGF0YVsgdHlwZSArICJxdWV1ZUhvb2tzIiBdLAoJCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJCWxlbmd0aCA9IHF1ZXVlID8gcXVldWUubGVuZ3RoIDogMDsKCgkJCS8vIGVuYWJsZSBmaW5pc2hpbmcgZmxhZyBvbiBwcml2YXRlIGRhdGEKCQkJZGF0YS5maW5pc2ggPSB0cnVlOwoKCQkJLy8gZW1wdHkgdGhlIHF1ZXVlIGZpcnN0CgkJCWpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgW10gKTsKCgkJCWlmICggaG9va3MgJiYgaG9va3MuY3VyICYmIGhvb2tzLmN1ci5maW5pc2ggKSB7CgkJCQlob29rcy5jdXIuZmluaXNoLmNhbGwoIHRoaXMgKTsKCQkJfQoKCQkJLy8gbG9vayBmb3IgYW55IGFjdGl2ZSBhbmltYXRpb25zLCBhbmQgZmluaXNoIHRoZW0KCQkJZm9yICggaW5kZXggPSB0aW1lcnMubGVuZ3RoOyBpbmRleC0tOyApIHsKCQkJCWlmICggdGltZXJzWyBpbmRleCBdLmVsZW0gPT09IHRoaXMgJiYgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlICkgewoJCQkJCXRpbWVyc1sgaW5kZXggXS5hbmltLnN0b3AoIHRydWUgKTsKCQkJCQl0aW1lcnMuc3BsaWNlKCBpbmRleCwgMSApOwoJCQkJfQoJCQl9CgoJCQkvLyBsb29rIGZvciBhbnkgYW5pbWF0aW9ucyBpbiB0aGUgb2xkIHF1ZXVlIGFuZCBmaW5pc2ggdGhlbQoJCQlmb3IgKCBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCQkJaWYgKCBxdWV1ZVsgaW5kZXggXSAmJiBxdWV1ZVsgaW5kZXggXS5maW5pc2ggKSB7CgkJCQkJcXVldWVbIGluZGV4IF0uZmluaXNoLmNhbGwoIHRoaXMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gdHVybiBvZmYgZmluaXNoaW5nIGZsYWcKCQkJZGVsZXRlIGRhdGEuZmluaXNoOwoJCX0pOwoJfQp9KTsKCi8vIEdlbmVyYXRlIHBhcmFtZXRlcnMgdG8gY3JlYXRlIGEgc3RhbmRhcmQgYW5pbWF0aW9uCmZ1bmN0aW9uIGdlbkZ4KCB0eXBlLCBpbmNsdWRlV2lkdGggKSB7Cgl2YXIgd2hpY2gsCgkJYXR0cnMgPSB7IGhlaWdodDogdHlwZSB9LAoJCWkgPSAwOwoKCS8vIGlmIHdlIGluY2x1ZGUgd2lkdGgsIHN0ZXAgdmFsdWUgaXMgMSB0byBkbyBhbGwgY3NzRXhwYW5kIHZhbHVlcywKCS8vIGlmIHdlIGRvbid0IGluY2x1ZGUgd2lkdGgsIHN0ZXAgdmFsdWUgaXMgMiB0byBza2lwIG92ZXIgTGVmdCBhbmQgUmlnaHQKCWluY2x1ZGVXaWR0aCA9IGluY2x1ZGVXaWR0aD8gMSA6IDA7Cglmb3IoIDsgaSA8IDQgOyBpICs9IDIgLSBpbmNsdWRlV2lkdGggKSB7CgkJd2hpY2ggPSBjc3NFeHBhbmRbIGkgXTsKCQlhdHRyc1sgIm1hcmdpbiIgKyB3aGljaCBdID0gYXR0cnNbICJwYWRkaW5nIiArIHdoaWNoIF0gPSB0eXBlOwoJfQoKCWlmICggaW5jbHVkZVdpZHRoICkgewoJCWF0dHJzLm9wYWNpdHkgPSBhdHRycy53aWR0aCA9IHR5cGU7Cgl9CgoJcmV0dXJuIGF0dHJzOwp9CgovLyBHZW5lcmF0ZSBzaG9ydGN1dHMgZm9yIGN1c3RvbSBhbmltYXRpb25zCmpRdWVyeS5lYWNoKHsKCXNsaWRlRG93bjogZ2VuRngoInNob3ciKSwKCXNsaWRlVXA6IGdlbkZ4KCJoaWRlIiksCglzbGlkZVRvZ2dsZTogZ2VuRngoInRvZ2dsZSIpLAoJZmFkZUluOiB7IG9wYWNpdHk6ICJzaG93IiB9LAoJZmFkZU91dDogeyBvcGFjaXR5OiAiaGlkZSIgfSwKCWZhZGVUb2dnbGU6IHsgb3BhY2l0eTogInRvZ2dsZSIgfQp9LCBmdW5jdGlvbiggbmFtZSwgcHJvcHMgKSB7CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQlyZXR1cm4gdGhpcy5hbmltYXRlKCBwcm9wcywgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX07Cn0pOwoKalF1ZXJ5LnNwZWVkID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGZuICkgewoJdmFyIG9wdCA9IHNwZWVkICYmIHR5cGVvZiBzcGVlZCA9PT0gIm9iamVjdCIgPyBqUXVlcnkuZXh0ZW5kKCB7fSwgc3BlZWQgKSA6IHsKCQljb21wbGV0ZTogZm4gfHwgIWZuICYmIGVhc2luZyB8fAoJCQlqUXVlcnkuaXNGdW5jdGlvbiggc3BlZWQgKSAmJiBzcGVlZCwKCQlkdXJhdGlvbjogc3BlZWQsCgkJZWFzaW5nOiBmbiAmJiBlYXNpbmcgfHwgZWFzaW5nICYmICFqUXVlcnkuaXNGdW5jdGlvbiggZWFzaW5nICkgJiYgZWFzaW5nCgl9OwoKCW9wdC5kdXJhdGlvbiA9IGpRdWVyeS5meC5vZmYgPyAwIDogdHlwZW9mIG9wdC5kdXJhdGlvbiA9PT0gIm51bWJlciIgPyBvcHQuZHVyYXRpb24gOgoJCW9wdC5kdXJhdGlvbiBpbiBqUXVlcnkuZnguc3BlZWRzID8galF1ZXJ5LmZ4LnNwZWVkc1sgb3B0LmR1cmF0aW9uIF0gOiBqUXVlcnkuZnguc3BlZWRzLl9kZWZhdWx0OwoKCS8vIG5vcm1hbGl6ZSBvcHQucXVldWUgLSB0cnVlL3VuZGVmaW5lZC9udWxsIC0+ICJmeCIKCWlmICggb3B0LnF1ZXVlID09IG51bGwgfHwgb3B0LnF1ZXVlID09PSB0cnVlICkgewoJCW9wdC5xdWV1ZSA9ICJmeCI7Cgl9CgoJLy8gUXVldWVpbmcKCW9wdC5vbGQgPSBvcHQuY29tcGxldGU7CgoJb3B0LmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggb3B0Lm9sZCApICkgewoJCQlvcHQub2xkLmNhbGwoIHRoaXMgKTsKCQl9CgoJCWlmICggb3B0LnF1ZXVlICkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgb3B0LnF1ZXVlICk7CgkJfQoJfTsKCglyZXR1cm4gb3B0Owp9OwoKalF1ZXJ5LmVhc2luZyA9IHsKCWxpbmVhcjogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHA7Cgl9LAoJc3dpbmc6IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiAwLjUgLSBNYXRoLmNvcyggcCpNYXRoLlBJICkgLyAyOwoJfQp9OwoKalF1ZXJ5LnRpbWVycyA9IFtdOwpqUXVlcnkuZnggPSBUd2Vlbi5wcm90b3R5cGUuaW5pdDsKalF1ZXJ5LmZ4LnRpY2sgPSBmdW5jdGlvbigpIHsKCXZhciB0aW1lciwKCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCWkgPSAwOwoKCWZ4Tm93ID0galF1ZXJ5Lm5vdygpOwoKCWZvciAoIDsgaSA8IHRpbWVycy5sZW5ndGg7IGkrKyApIHsKCQl0aW1lciA9IHRpbWVyc1sgaSBdOwoJCS8vIENoZWNrcyB0aGUgdGltZXIgaGFzIG5vdCBhbHJlYWR5IGJlZW4gcmVtb3ZlZAoJCWlmICggIXRpbWVyKCkgJiYgdGltZXJzWyBpIF0gPT09IHRpbWVyICkgewoJCQl0aW1lcnMuc3BsaWNlKCBpLS0sIDEgKTsKCQl9Cgl9CgoJaWYgKCAhdGltZXJzLmxlbmd0aCApIHsKCQlqUXVlcnkuZnguc3RvcCgpOwoJfQoJZnhOb3cgPSB1bmRlZmluZWQ7Cn07CgpqUXVlcnkuZngudGltZXIgPSBmdW5jdGlvbiggdGltZXIgKSB7CglpZiAoIHRpbWVyKCkgJiYgalF1ZXJ5LnRpbWVycy5wdXNoKCB0aW1lciApICkgewoJCWpRdWVyeS5meC5zdGFydCgpOwoJfQp9OwoKalF1ZXJ5LmZ4LmludGVydmFsID0gMTM7CgpqUXVlcnkuZnguc3RhcnQgPSBmdW5jdGlvbigpIHsKCWlmICggIXRpbWVySWQgKSB7CgkJdGltZXJJZCA9IHNldEludGVydmFsKCBqUXVlcnkuZngudGljaywgalF1ZXJ5LmZ4LmludGVydmFsICk7Cgl9Cn07CgpqUXVlcnkuZnguc3RvcCA9IGZ1bmN0aW9uKCkgewoJY2xlYXJJbnRlcnZhbCggdGltZXJJZCApOwoJdGltZXJJZCA9IG51bGw7Cn07CgpqUXVlcnkuZnguc3BlZWRzID0gewoJc2xvdzogNjAwLAoJZmFzdDogMjAwLAoJLy8gRGVmYXVsdCBzcGVlZAoJX2RlZmF1bHQ6IDQwMAp9OwoKLy8gQmFjayBDb21wYXQgPDEuOCBleHRlbnNpb24gcG9pbnQKalF1ZXJ5LmZ4LnN0ZXAgPSB7fTsKCmlmICggalF1ZXJ5LmV4cHIgJiYgalF1ZXJ5LmV4cHIuZmlsdGVycyApIHsKCWpRdWVyeS5leHByLmZpbHRlcnMuYW5pbWF0ZWQgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoalF1ZXJ5LnRpbWVycywgZnVuY3Rpb24oIGZuICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gZm4uZWxlbTsKCQl9KS5sZW5ndGg7Cgl9Owp9CmpRdWVyeS5mbi5vZmZzZXQgPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQlyZXR1cm4gb3B0aW9ucyA9PT0gdW5kZWZpbmVkID8KCQkJdGhpcyA6CgkJCXRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJCWpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KCB0aGlzLCBvcHRpb25zLCBpICk7CgkJCX0pOwoJfQoKCXZhciBkb2NFbGVtLCB3aW4sCgkJYm94ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQllbGVtID0gdGhpc1sgMCBdLAoJCWRvYyA9IGVsZW0gJiYgZWxlbS5vd25lckRvY3VtZW50OwoKCWlmICggIWRvYyApIHsKCQlyZXR1cm47Cgl9CgoJZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CgoJLy8gTWFrZSBzdXJlIGl0J3Mgbm90IGEgZGlzY29ubmVjdGVkIERPTSBub2RlCglpZiAoICFqUXVlcnkuY29udGFpbnMoIGRvY0VsZW0sIGVsZW0gKSApIHsKCQlyZXR1cm4gYm94OwoJfQoKCS8vIElmIHdlIGRvbid0IGhhdmUgZ0JDUiwganVzdCB1c2UgMCwwIHJhdGhlciB0aGFuIGVycm9yCgkvLyBCbGFja0JlcnJ5IDUsIGlPUyAzIChvcmlnaW5hbCBpUGhvbmUpCglpZiAoIHR5cGVvZiBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJYm94ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCX0KCXdpbiA9IGdldFdpbmRvdyggZG9jICk7CglyZXR1cm4gewoJCXRvcDogYm94LnRvcCAgKyAoIHdpbi5wYWdlWU9mZnNldCB8fCBkb2NFbGVtLnNjcm9sbFRvcCApICAtICggZG9jRWxlbS5jbGllbnRUb3AgIHx8IDAgKSwKCQlsZWZ0OiBib3gubGVmdCArICggd2luLnBhZ2VYT2Zmc2V0IHx8IGRvY0VsZW0uc2Nyb2xsTGVmdCApIC0gKCBkb2NFbGVtLmNsaWVudExlZnQgfHwgMCApCgl9Owp9OwoKalF1ZXJ5Lm9mZnNldCA9IHsKCglzZXRPZmZzZXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBpICkgewoJCXZhciBwb3NpdGlvbiA9IGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKTsKCgkJLy8gc2V0IHBvc2l0aW9uIGZpcnN0LCBpbi1jYXNlIHRvcC9sZWZ0IGFyZSBzZXQgZXZlbiBvbiBzdGF0aWMgZWxlbQoJCWlmICggcG9zaXRpb24gPT09ICJzdGF0aWMiICkgewoJCQllbGVtLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCQl9CgoJCXZhciBjdXJFbGVtID0galF1ZXJ5KCBlbGVtICksCgkJCWN1ck9mZnNldCA9IGN1ckVsZW0ub2Zmc2V0KCksCgkJCWN1ckNTU1RvcCA9IGpRdWVyeS5jc3MoIGVsZW0sICJ0b3AiICksCgkJCWN1ckNTU0xlZnQgPSBqUXVlcnkuY3NzKCBlbGVtLCAibGVmdCIgKSwKCQkJY2FsY3VsYXRlUG9zaXRpb24gPSAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgJiYgalF1ZXJ5LmluQXJyYXkoImF1dG8iLCBbY3VyQ1NTVG9wLCBjdXJDU1NMZWZ0XSkgPiAtMSwKCQkJcHJvcHMgPSB7fSwgY3VyUG9zaXRpb24gPSB7fSwgY3VyVG9wLCBjdXJMZWZ0OwoKCQkvLyBuZWVkIHRvIGJlIGFibGUgdG8gY2FsY3VsYXRlIHBvc2l0aW9uIGlmIGVpdGhlciB0b3Agb3IgbGVmdCBpcyBhdXRvIGFuZCBwb3NpdGlvbiBpcyBlaXRoZXIgYWJzb2x1dGUgb3IgZml4ZWQKCQlpZiAoIGNhbGN1bGF0ZVBvc2l0aW9uICkgewoJCQljdXJQb3NpdGlvbiA9IGN1ckVsZW0ucG9zaXRpb24oKTsKCQkJY3VyVG9wID0gY3VyUG9zaXRpb24udG9wOwoJCQljdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDsKCQl9IGVsc2UgewoJCQljdXJUb3AgPSBwYXJzZUZsb2F0KCBjdXJDU1NUb3AgKSB8fCAwOwoJCQljdXJMZWZ0ID0gcGFyc2VGbG9hdCggY3VyQ1NTTGVmdCApIHx8IDA7CgkJfQoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHRpb25zICkgKSB7CgkJCW9wdGlvbnMgPSBvcHRpb25zLmNhbGwoIGVsZW0sIGksIGN1ck9mZnNldCApOwoJCX0KCgkJaWYgKCBvcHRpb25zLnRvcCAhPSBudWxsICkgewoJCQlwcm9wcy50b3AgPSAoIG9wdGlvbnMudG9wIC0gY3VyT2Zmc2V0LnRvcCApICsgY3VyVG9wOwoJCX0KCQlpZiAoIG9wdGlvbnMubGVmdCAhPSBudWxsICkgewoJCQlwcm9wcy5sZWZ0ID0gKCBvcHRpb25zLmxlZnQgLSBjdXJPZmZzZXQubGVmdCApICsgY3VyTGVmdDsKCQl9CgoJCWlmICggInVzaW5nIiBpbiBvcHRpb25zICkgewoJCQlvcHRpb25zLnVzaW5nLmNhbGwoIGVsZW0sIHByb3BzICk7CgkJfSBlbHNlIHsKCQkJY3VyRWxlbS5jc3MoIHByb3BzICk7CgkJfQoJfQp9OwoKCmpRdWVyeS5mbi5leHRlbmQoewoKCXBvc2l0aW9uOiBmdW5jdGlvbigpIHsKCQlpZiAoICF0aGlzWyAwIF0gKSB7CgkJCXJldHVybjsKCQl9CgoJCXZhciBvZmZzZXRQYXJlbnQsIG9mZnNldCwKCQkJcGFyZW50T2Zmc2V0ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQkJZWxlbSA9IHRoaXNbIDAgXTsKCgkJLy8gZml4ZWQgZWxlbWVudHMgYXJlIG9mZnNldCBmcm9tIHdpbmRvdyAocGFyZW50T2Zmc2V0ID0ge3RvcDowLCBsZWZ0OiAwfSwgYmVjYXVzZSBpdCBpcyBpdCdzIG9ubHkgb2Zmc2V0IHBhcmVudAoJCWlmICggalF1ZXJ5LmNzcyggZWxlbSwgInBvc2l0aW9uIiApID09PSAiZml4ZWQiICkgewoJCQkvLyB3ZSBhc3N1bWUgdGhhdCBnZXRCb3VuZGluZ0NsaWVudFJlY3QgaXMgYXZhaWxhYmxlIHdoZW4gY29tcHV0ZWQgcG9zaXRpb24gaXMgZml4ZWQKCQkJb2Zmc2V0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQl9IGVsc2UgewoJCQkvLyBHZXQgKnJlYWwqIG9mZnNldFBhcmVudAoJCQlvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudCgpOwoKCQkJLy8gR2V0IGNvcnJlY3Qgb2Zmc2V0cwoJCQlvZmZzZXQgPSB0aGlzLm9mZnNldCgpOwoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudFsgMCBdLCAiaHRtbCIgKSApIHsKCQkJCXBhcmVudE9mZnNldCA9IG9mZnNldFBhcmVudC5vZmZzZXQoKTsKCQkJfQoKCQkJLy8gQWRkIG9mZnNldFBhcmVudCBib3JkZXJzCgkJCXBhcmVudE9mZnNldC50b3AgICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyVG9wV2lkdGgiLCB0cnVlICk7CgkJCXBhcmVudE9mZnNldC5sZWZ0ICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyTGVmdFdpZHRoIiwgdHJ1ZSApOwoJCX0KCgkJLy8gU3VidHJhY3QgcGFyZW50IG9mZnNldHMgYW5kIGVsZW1lbnQgbWFyZ2lucwoJCS8vIG5vdGU6IHdoZW4gYW4gZWxlbWVudCBoYXMgbWFyZ2luOiBhdXRvIHRoZSBvZmZzZXRMZWZ0IGFuZCBtYXJnaW5MZWZ0CgkJLy8gYXJlIHRoZSBzYW1lIGluIFNhZmFyaSBjYXVzaW5nIG9mZnNldC5sZWZ0IHRvIGluY29ycmVjdGx5IGJlIDAKCQlyZXR1cm4gewoJCQl0b3A6ICBvZmZzZXQudG9wICAtIHBhcmVudE9mZnNldC50b3AgLSBqUXVlcnkuY3NzKCBlbGVtLCAibWFyZ2luVG9wIiwgdHJ1ZSApLAoJCQlsZWZ0OiBvZmZzZXQubGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0IC0galF1ZXJ5LmNzcyggZWxlbSwgIm1hcmdpbkxlZnQiLCB0cnVlKQoJCX07Cgl9LAoKCW9mZnNldFBhcmVudDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQl2YXIgb2Zmc2V0UGFyZW50ID0gdGhpcy5vZmZzZXRQYXJlbnQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoJCQl3aGlsZSAoIG9mZnNldFBhcmVudCAmJiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudCwgImh0bWwiICkgJiYgalF1ZXJ5LmNzcyggb2Zmc2V0UGFyZW50LCAicG9zaXRpb24iKSA9PT0gInN0YXRpYyIgKSApIHsKCQkJCW9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5vZmZzZXRQYXJlbnQ7CgkJCX0KCQkJcmV0dXJuIG9mZnNldFBhcmVudCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgkJfSk7Cgl9Cn0pOwoKCi8vIENyZWF0ZSBzY3JvbGxMZWZ0IGFuZCBzY3JvbGxUb3AgbWV0aG9kcwpqUXVlcnkuZWFjaCgge3Njcm9sbExlZnQ6ICJwYWdlWE9mZnNldCIsIHNjcm9sbFRvcDogInBhZ2VZT2Zmc2V0In0sIGZ1bmN0aW9uKCBtZXRob2QsIHByb3AgKSB7Cgl2YXIgdG9wID0gL1kvLnRlc3QoIHByb3AgKTsKCglqUXVlcnkuZm5bIG1ldGhvZCBdID0gZnVuY3Rpb24oIHZhbCApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG1ldGhvZCwgdmFsICkgewoJCQl2YXIgd2luID0gZ2V0V2luZG93KCBlbGVtICk7CgoJCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHdpbiA/IChwcm9wIGluIHdpbikgPyB3aW5bIHByb3AgXSA6CgkJCQkJd2luLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgbWV0aG9kIF0gOgoJCQkJCWVsZW1bIG1ldGhvZCBdOwoJCQl9CgoJCQlpZiAoIHdpbiApIHsKCQkJCXdpbi5zY3JvbGxUbygKCQkJCQkhdG9wID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxMZWZ0KCksCgkJCQkJdG9wID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxUb3AoKQoJCQkJKTsKCgkJCX0gZWxzZSB7CgkJCQllbGVtWyBtZXRob2QgXSA9IHZhbDsKCQkJfQoJCX0sIG1ldGhvZCwgdmFsLCBhcmd1bWVudHMubGVuZ3RoLCBudWxsICk7Cgl9Owp9KTsKCmZ1bmN0aW9uIGdldFdpbmRvdyggZWxlbSApIHsKCXJldHVybiBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSA/CgkJZWxlbSA6CgkJZWxlbS5ub2RlVHlwZSA9PT0gOSA/CgkJCWVsZW0uZGVmYXVsdFZpZXcgfHwgZWxlbS5wYXJlbnRXaW5kb3cgOgoJCQlmYWxzZTsKfQovLyBDcmVhdGUgaW5uZXJIZWlnaHQsIGlubmVyV2lkdGgsIGhlaWdodCwgd2lkdGgsIG91dGVySGVpZ2h0IGFuZCBvdXRlcldpZHRoIG1ldGhvZHMKalF1ZXJ5LmVhY2goIHsgSGVpZ2h0OiAiaGVpZ2h0IiwgV2lkdGg6ICJ3aWR0aCIgfSwgZnVuY3Rpb24oIG5hbWUsIHR5cGUgKSB7CglqUXVlcnkuZWFjaCggeyBwYWRkaW5nOiAiaW5uZXIiICsgbmFtZSwgY29udGVudDogdHlwZSwgIiI6ICJvdXRlciIgKyBuYW1lIH0sIGZ1bmN0aW9uKCBkZWZhdWx0RXh0cmEsIGZ1bmNOYW1lICkgewoJCS8vIG1hcmdpbiBpcyBvbmx5IGZvciBvdXRlckhlaWdodCwgb3V0ZXJXaWR0aAoJCWpRdWVyeS5mblsgZnVuY05hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4sIHZhbHVlICkgewoJCQl2YXIgY2hhaW5hYmxlID0gYXJndW1lbnRzLmxlbmd0aCAmJiAoIGRlZmF1bHRFeHRyYSB8fCB0eXBlb2YgbWFyZ2luICE9PSAiYm9vbGVhbiIgKSwKCQkJCWV4dHJhID0gZGVmYXVsdEV4dHJhIHx8ICggbWFyZ2luID09PSB0cnVlIHx8IHZhbHVlID09PSB0cnVlID8gIm1hcmdpbiIgOiAiYm9yZGVyIiApOwoKCQkJcmV0dXJuIGpRdWVyeS5hY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCB0eXBlLCB2YWx1ZSApIHsKCQkJCXZhciBkb2M7CgoJCQkJaWYgKCBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCQkJCQkvLyBBcyBvZiA1LzgvMjAxMiB0aGlzIHdpbGwgeWllbGQgaW5jb3JyZWN0IHJlc3VsdHMgZm9yIE1vYmlsZSBTYWZhcmksIGJ1dCB0aGVyZQoJCQkJCS8vIGlzbid0IGEgd2hvbGUgbG90IHdlIGNhbiBkby4gU2VlIHB1bGwgcmVxdWVzdCBhdCB0aGlzIFVSTCBmb3IgZGlzY3Vzc2lvbjoKCQkJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS9wdWxsLzc2NAoJCQkJCXJldHVybiBlbGVtLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgImNsaWVudCIgKyBuYW1lIF07CgkJCQl9CgoJCQkJLy8gR2V0IGRvY3VtZW50IHdpZHRoIG9yIGhlaWdodAoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSA5ICkgewoJCQkJCWRvYyA9IGVsZW0uZG9jdW1lbnRFbGVtZW50OwoKCQkJCQkvLyBFaXRoZXIgc2Nyb2xsW1dpZHRoL0hlaWdodF0gb3Igb2Zmc2V0W1dpZHRoL0hlaWdodF0gb3IgY2xpZW50W1dpZHRoL0hlaWdodF0sIHdoaWNoZXZlciBpcyBncmVhdGVzdAoJCQkJCS8vIHVuZm9ydHVuYXRlbHksIHRoaXMgY2F1c2VzIGJ1ZyAjMzgzOCBpbiBJRTYvOCBvbmx5LCBidXQgdGhlcmUgaXMgY3VycmVudGx5IG5vIGdvb2QsIHNtYWxsIHdheSB0byBmaXggaXQuCgkJCQkJcmV0dXJuIE1hdGgubWF4KAoJCQkJCQllbGVtLmJvZHlbICJzY3JvbGwiICsgbmFtZSBdLCBkb2NbICJzY3JvbGwiICsgbmFtZSBdLAoJCQkJCQllbGVtLmJvZHlbICJvZmZzZXQiICsgbmFtZSBdLCBkb2NbICJvZmZzZXQiICsgbmFtZSBdLAoJCQkJCQlkb2NbICJjbGllbnQiICsgbmFtZSBdCgkJCQkJKTsKCQkJCX0KCgkJCQlyZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/CgkJCQkJLy8gR2V0IHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudCwgcmVxdWVzdGluZyBidXQgbm90IGZvcmNpbmcgcGFyc2VGbG9hdAoJCQkJCWpRdWVyeS5jc3MoIGVsZW0sIHR5cGUsIGV4dHJhICkgOgoKCQkJCQkvLyBTZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50CgkJCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCB0eXBlLCB2YWx1ZSwgZXh0cmEgKTsKCQkJfSwgdHlwZSwgY2hhaW5hYmxlID8gbWFyZ2luIDogdW5kZWZpbmVkLCBjaGFpbmFibGUsIG51bGwgKTsKCQl9OwoJfSk7Cn0pOwovLyBMaW1pdCBzY29wZSBwb2xsdXRpb24gZnJvbSBhbnkgZGVwcmVjYXRlZCBBUEkKLy8gKGZ1bmN0aW9uKCkgewoKLy8gfSkoKTsKLy8gRXhwb3NlIGpRdWVyeSB0byB0aGUgZ2xvYmFsIG9iamVjdAp3aW5kb3cualF1ZXJ5ID0gd2luZG93LiQgPSBqUXVlcnk7CgovLyBFeHBvc2UgalF1ZXJ5IGFzIGFuIEFNRCBtb2R1bGUsIGJ1dCBvbmx5IGZvciBBTUQgbG9hZGVycyB0aGF0Ci8vIHVuZGVyc3RhbmQgdGhlIGlzc3VlcyB3aXRoIGxvYWRpbmcgbXVsdGlwbGUgdmVyc2lvbnMgb2YgalF1ZXJ5Ci8vIGluIGEgcGFnZSB0aGF0IGFsbCBtaWdodCBjYWxsIGRlZmluZSgpLiBUaGUgbG9hZGVyIHdpbGwgaW5kaWNhdGUKLy8gdGhleSBoYXZlIHNwZWNpYWwgYWxsb3dhbmNlcyBmb3IgbXVsdGlwbGUgalF1ZXJ5IHZlcnNpb25zIGJ5Ci8vIHNwZWNpZnlpbmcgZGVmaW5lLmFtZC5qUXVlcnkgPSB0cnVlLiBSZWdpc3RlciBhcyBhIG5hbWVkIG1vZHVsZSwKLy8gc2luY2UgalF1ZXJ5IGNhbiBiZSBjb25jYXRlbmF0ZWQgd2l0aCBvdGhlciBmaWxlcyB0aGF0IG1heSB1c2UgZGVmaW5lLAovLyBidXQgbm90IHVzZSBhIHByb3BlciBjb25jYXRlbmF0aW9uIHNjcmlwdCB0aGF0IHVuZGVyc3RhbmRzIGFub255bW91cwovLyBBTUQgbW9kdWxlcy4gQSBuYW1lZCBBTUQgaXMgc2FmZXN0IGFuZCBtb3N0IHJvYnVzdCB3YXkgdG8gcmVnaXN0ZXIuCi8vIExvd2VyY2FzZSBqcXVlcnkgaXMgdXNlZCBiZWNhdXNlIEFNRCBtb2R1bGUgbmFtZXMgYXJlIGRlcml2ZWQgZnJvbQovLyBmaWxlIG5hbWVzLCBhbmQgalF1ZXJ5IGlzIG5vcm1hbGx5IGRlbGl2ZXJlZCBpbiBhIGxvd2VyY2FzZSBmaWxlIG5hbWUuCi8vIERvIHRoaXMgYWZ0ZXIgY3JlYXRpbmcgdGhlIGdsb2JhbCBzbyB0aGF0IGlmIGFuIEFNRCBtb2R1bGUgd2FudHMgdG8gY2FsbAovLyBub0NvbmZsaWN0IHRvIGhpZGUgdGhpcyB2ZXJzaW9uIG9mIGpRdWVyeSwgaXQgd2lsbCB3b3JrLgppZiAoIHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCAmJiBkZWZpbmUuYW1kLmpRdWVyeSApIHsKCWRlZmluZSggImpxdWVyeSIsIFtdLCBmdW5jdGlvbiAoKSB7IHJldHVybiBqUXVlcnk7IH0gKTsKfQoKfSkoIHdpbmRvdyApOwovLyAgICAgVW5kZXJzY29yZS5qcyAxLjYuMAovLyAgICAgaHR0cDovL3VuZGVyc2NvcmVqcy5vcmcKLy8gICAgIChjKSAyMDA5LTIwMTQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKLy8gICAgIFVuZGVyc2NvcmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCgooZnVuY3Rpb24oKSB7CgogIC8vIEJhc2VsaW5lIHNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLS0KCiAgLy8gRXN0YWJsaXNoIHRoZSByb290IG9iamVjdCwgYHdpbmRvd2AgaW4gdGhlIGJyb3dzZXIsIG9yIGBleHBvcnRzYCBvbiB0aGUgc2VydmVyLgogIHZhciByb290ID0gdGhpczsKCiAgLy8gU2F2ZSB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIGBfYCB2YXJpYWJsZS4KICB2YXIgcHJldmlvdXNVbmRlcnNjb3JlID0gcm9vdC5fOwoKICAvLyBFc3RhYmxpc2ggdGhlIG9iamVjdCB0aGF0IGdldHMgcmV0dXJuZWQgdG8gYnJlYWsgb3V0IG9mIGEgbG9vcCBpdGVyYXRpb24uCiAgdmFyIGJyZWFrZXIgPSB7fTsKCiAgLy8gU2F2ZSBieXRlcyBpbiB0aGUgbWluaWZpZWQgKGJ1dCBub3QgZ3ppcHBlZCkgdmVyc2lvbjoKICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwgT2JqUHJvdG8gPSBPYmplY3QucHJvdG90eXBlLCBGdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7CgogIC8vIENyZWF0ZSBxdWljayByZWZlcmVuY2UgdmFyaWFibGVzIGZvciBzcGVlZCBhY2Nlc3MgdG8gY29yZSBwcm90b3R5cGVzLgogIHZhcgogICAgcHVzaCAgICAgICAgICAgICA9IEFycmF5UHJvdG8ucHVzaCwKICAgIHNsaWNlICAgICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgY29uY2F0ICAgICAgICAgICA9IEFycmF5UHJvdG8uY29uY2F0LAogICAgdG9TdHJpbmcgICAgICAgICA9IE9ialByb3RvLnRvU3RyaW5nLAogICAgaGFzT3duUHJvcGVydHkgICA9IE9ialByb3RvLmhhc093blByb3BlcnR5OwoKICAvLyBBbGwgKipFQ01BU2NyaXB0IDUqKiBuYXRpdmUgZnVuY3Rpb24gaW1wbGVtZW50YXRpb25zIHRoYXQgd2UgaG9wZSB0byB1c2UKICAvLyBhcmUgZGVjbGFyZWQgaGVyZS4KICB2YXIKICAgIG5hdGl2ZUZvckVhY2ggICAgICA9IEFycmF5UHJvdG8uZm9yRWFjaCwKICAgIG5hdGl2ZU1hcCAgICAgICAgICA9IEFycmF5UHJvdG8ubWFwLAogICAgbmF0aXZlUmVkdWNlICAgICAgID0gQXJyYXlQcm90by5yZWR1Y2UsCiAgICBuYXRpdmVSZWR1Y2VSaWdodCAgPSBBcnJheVByb3RvLnJlZHVjZVJpZ2h0LAogICAgbmF0aXZlRmlsdGVyICAgICAgID0gQXJyYXlQcm90by5maWx0ZXIsCiAgICBuYXRpdmVFdmVyeSAgICAgICAgPSBBcnJheVByb3RvLmV2ZXJ5LAogICAgbmF0aXZlU29tZSAgICAgICAgID0gQXJyYXlQcm90by5zb21lLAogICAgbmF0aXZlSW5kZXhPZiAgICAgID0gQXJyYXlQcm90by5pbmRleE9mLAogICAgbmF0aXZlTGFzdEluZGV4T2YgID0gQXJyYXlQcm90by5sYXN0SW5kZXhPZiwKICAgIG5hdGl2ZUlzQXJyYXkgICAgICA9IEFycmF5LmlzQXJyYXksCiAgICBuYXRpdmVLZXlzICAgICAgICAgPSBPYmplY3Qua2V5cywKICAgIG5hdGl2ZUJpbmQgICAgICAgICA9IEZ1bmNQcm90by5iaW5kOwoKICAvLyBDcmVhdGUgYSBzYWZlIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yIHVzZSBiZWxvdy4KICB2YXIgXyA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF8pIHJldHVybiBvYmo7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgXykpIHJldHVybiBuZXcgXyhvYmopOwogICAgdGhpcy5fd3JhcHBlZCA9IG9iajsKICB9OwoKICAvLyBFeHBvcnQgdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciAqKk5vZGUuanMqKiwgd2l0aAogIC8vIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5IGZvciB0aGUgb2xkIGByZXF1aXJlKClgIEFQSS4gSWYgd2UncmUgaW4KICAvLyB0aGUgYnJvd3NlciwgYWRkIGBfYCBhcyBhIGdsb2JhbCBvYmplY3QgdmlhIGEgc3RyaW5nIGlkZW50aWZpZXIsCiAgLy8gZm9yIENsb3N1cmUgQ29tcGlsZXIgImFkdmFuY2VkIiBtb2RlLgogIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBfOwogICAgfQogICAgZXhwb3J0cy5fID0gXzsKICB9IGVsc2UgewogICAgcm9vdC5fID0gXzsKICB9CgogIC8vIEN1cnJlbnQgdmVyc2lvbi4KICBfLlZFUlNJT04gPSAnMS42LjAnOwoKICAvLyBDb2xsZWN0aW9uIEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFRoZSBjb3JuZXJzdG9uZSwgYW4gYGVhY2hgIGltcGxlbWVudGF0aW9uLCBha2EgYGZvckVhY2hgLgogIC8vIEhhbmRsZXMgb2JqZWN0cyB3aXRoIHRoZSBidWlsdC1pbiBgZm9yRWFjaGAsIGFycmF5cywgYW5kIHJhdyBvYmplY3RzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmb3JFYWNoYCBpZiBhdmFpbGFibGUuCiAgdmFyIGVhY2ggPSBfLmVhY2ggPSBfLmZvckVhY2ggPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiBvYmo7CiAgICBpZiAobmF0aXZlRm9yRWFjaCAmJiBvYmouZm9yRWFjaCA9PT0gbmF0aXZlRm9yRWFjaCkgewogICAgICBvYmouZm9yRWFjaChpdGVyYXRvciwgY29udGV4dCk7CiAgICB9IGVsc2UgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpba2V5c1tpXV0sIGtleXNbaV0sIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gdGhlIHJlc3VsdHMgb2YgYXBwbHlpbmcgdGhlIGl0ZXJhdG9yIHRvIGVhY2ggZWxlbWVudC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgbWFwYCBpZiBhdmFpbGFibGUuCiAgXy5tYXAgPSBfLmNvbGxlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0czsKICAgIGlmIChuYXRpdmVNYXAgJiYgb2JqLm1hcCA9PT0gbmF0aXZlTWFwKSByZXR1cm4gb2JqLm1hcChpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJlc3VsdHMucHVzaChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB2YXIgcmVkdWNlRXJyb3IgPSAnUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZSc7CgogIC8vICoqUmVkdWNlKiogYnVpbGRzIHVwIGEgc2luZ2xlIHJlc3VsdCBmcm9tIGEgbGlzdCBvZiB2YWx1ZXMsIGFrYSBgaW5qZWN0YCwKICAvLyBvciBgZm9sZGxgLiBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgcmVkdWNlYCBpZiBhdmFpbGFibGUuCiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KSB7CiAgICB2YXIgaW5pdGlhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyOwogICAgaWYgKG9iaiA9PSBudWxsKSBvYmogPSBbXTsKICAgIGlmIChuYXRpdmVSZWR1Y2UgJiYgb2JqLnJlZHVjZSA9PT0gbmF0aXZlUmVkdWNlKSB7CiAgICAgIGlmIChjb250ZXh0KSBpdGVyYXRvciA9IF8uYmluZChpdGVyYXRvciwgY29udGV4dCk7CiAgICAgIHJldHVybiBpbml0aWFsID8gb2JqLnJlZHVjZShpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlKGl0ZXJhdG9yKTsKICAgIH0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCFpbml0aWFsKSB7CiAgICAgICAgbWVtbyA9IHZhbHVlOwogICAgICAgIGluaXRpYWwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1lbW8gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG1lbW8sIHZhbHVlLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFRoZSByaWdodC1hc3NvY2lhdGl2ZSB2ZXJzaW9uIG9mIHJlZHVjZSwgYWxzbyBrbm93biBhcyBgZm9sZHJgLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGByZWR1Y2VSaWdodGAgaWYgYXZhaWxhYmxlLgogIF8ucmVkdWNlUmlnaHQgPSBfLmZvbGRyID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgbWVtbywgY29udGV4dCkgewogICAgdmFyIGluaXRpYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMjsKICAgIGlmIChvYmogPT0gbnVsbCkgb2JqID0gW107CiAgICBpZiAobmF0aXZlUmVkdWNlUmlnaHQgJiYgb2JqLnJlZHVjZVJpZ2h0ID09PSBuYXRpdmVSZWR1Y2VSaWdodCkgewogICAgICBpZiAoY29udGV4dCkgaXRlcmF0b3IgPSBfLmJpbmQoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgICByZXR1cm4gaW5pdGlhbCA/IG9iai5yZWR1Y2VSaWdodChpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlUmlnaHQoaXRlcmF0b3IpOwogICAgfQogICAgdmFyIGxlbmd0aCA9IG9iai5sZW5ndGg7CiAgICBpZiAobGVuZ3RoICE9PSArbGVuZ3RoKSB7CiAgICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICAgIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgfQogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpbmRleCA9IGtleXMgPyBrZXlzWy0tbGVuZ3RoXSA6IC0tbGVuZ3RoOwogICAgICBpZiAoIWluaXRpYWwpIHsKICAgICAgICBtZW1vID0gb2JqW2luZGV4XTsKICAgICAgICBpbml0aWFsID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZW1vID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBtZW1vLCBvYmpbaW5kZXhdLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFJldHVybiB0aGUgZmlyc3QgdmFsdWUgd2hpY2ggcGFzc2VzIGEgdHJ1dGggdGVzdC4gQWxpYXNlZCBhcyBgZGV0ZWN0YC4KICBfLmZpbmQgPSBfLmRldGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0OwogICAgYW55KG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyB0aGF0IHBhc3MgYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmaWx0ZXJgIGlmIGF2YWlsYWJsZS4KICAvLyBBbGlhc2VkIGFzIGBzZWxlY3RgLgogIF8uZmlsdGVyID0gXy5zZWxlY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdHM7CiAgICBpZiAobmF0aXZlRmlsdGVyICYmIG9iai5maWx0ZXIgPT09IG5hdGl2ZUZpbHRlcikgcmV0dXJuIG9iai5maWx0ZXIocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuCiAgXy5yZWplY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcmV0dXJuIF8uZmlsdGVyKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJldHVybiAhcHJlZGljYXRlLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KTsKICAgIH0sIGNvbnRleHQpOwogIH07CgogIC8vIERldGVybWluZSB3aGV0aGVyIGFsbCBvZiB0aGUgZWxlbWVudHMgbWF0Y2ggYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBldmVyeWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFsbGAuCiAgXy5ldmVyeSA9IF8uYWxsID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgIGlmIChuYXRpdmVFdmVyeSAmJiBvYmouZXZlcnkgPT09IG5hdGl2ZUV2ZXJ5KSByZXR1cm4gb2JqLmV2ZXJ5KHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmICghKHJlc3VsdCA9IHJlc3VsdCAmJiBwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSkgcmV0dXJuIGJyZWFrZXI7CiAgICB9KTsKICAgIHJldHVybiAhIXJlc3VsdDsKICB9OwoKICAvLyBEZXRlcm1pbmUgaWYgYXQgbGVhc3Qgb25lIGVsZW1lbnQgaW4gdGhlIG9iamVjdCBtYXRjaGVzIGEgdHJ1dGggdGVzdC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgc29tZWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFueWAuCiAgdmFyIGFueSA9IF8uc29tZSA9IF8uYW55ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHQ7CiAgICBpZiAobmF0aXZlU29tZSAmJiBvYmouc29tZSA9PT0gbmF0aXZlU29tZSkgcmV0dXJuIG9iai5zb21lKHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChyZXN1bHQgfHwgKHJlc3VsdCA9IHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpKSByZXR1cm4gYnJlYWtlcjsKICAgIH0pOwogICAgcmV0dXJuICEhcmVzdWx0OwogIH07CgogIC8vIERldGVybWluZSBpZiB0aGUgYXJyYXkgb3Igb2JqZWN0IGNvbnRhaW5zIGEgZ2l2ZW4gdmFsdWUgKHVzaW5nIGA9PT1gKS4KICAvLyBBbGlhc2VkIGFzIGBpbmNsdWRlYC4KICBfLmNvbnRhaW5zID0gXy5pbmNsdWRlID0gZnVuY3Rpb24ob2JqLCB0YXJnZXQpIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIGZhbHNlOwogICAgaWYgKG5hdGl2ZUluZGV4T2YgJiYgb2JqLmluZGV4T2YgPT09IG5hdGl2ZUluZGV4T2YpIHJldHVybiBvYmouaW5kZXhPZih0YXJnZXQpICE9IC0xOwogICAgcmV0dXJuIGFueShvYmosIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdGFyZ2V0OwogICAgfSk7CiAgfTsKCiAgLy8gSW52b2tlIGEgbWV0aG9kICh3aXRoIGFyZ3VtZW50cykgb24gZXZlcnkgaXRlbSBpbiBhIGNvbGxlY3Rpb24uCiAgXy5pbnZva2UgPSBmdW5jdGlvbihvYmosIG1ldGhvZCkgewogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICB2YXIgaXNGdW5jID0gXy5pc0Z1bmN0aW9uKG1ldGhvZCk7CiAgICByZXR1cm4gXy5tYXAob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKGlzRnVuYyA/IG1ldGhvZCA6IHZhbHVlW21ldGhvZF0pLmFwcGx5KHZhbHVlLCBhcmdzKTsKICAgIH0pOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYG1hcGA6IGZldGNoaW5nIGEgcHJvcGVydHkuCiAgXy5wbHVjayA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gXy5tYXAob2JqLCBfLnByb3BlcnR5KGtleSkpOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbHRlcmA6IHNlbGVjdGluZyBvbmx5IG9iamVjdHMKICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLgogIF8ud2hlcmUgPSBmdW5jdGlvbihvYmosIGF0dHJzKSB7CiAgICByZXR1cm4gXy5maWx0ZXIob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBDb252ZW5pZW5jZSB2ZXJzaW9uIG9mIGEgY29tbW9uIHVzZSBjYXNlIG9mIGBmaW5kYDogZ2V0dGluZyB0aGUgZmlyc3Qgb2JqZWN0CiAgLy8gY29udGFpbmluZyBzcGVjaWZpYyBga2V5OnZhbHVlYCBwYWlycy4KICBfLmZpbmRXaGVyZSA9IGZ1bmN0aW9uKG9iaiwgYXR0cnMpIHsKICAgIHJldHVybiBfLmZpbmQob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1heGltdW0gZWxlbWVudCBvciAoZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgLy8gQ2FuJ3Qgb3B0aW1pemUgYXJyYXlzIG9mIGludGVnZXJzIGxvbmdlciB0aGFuIDY1LDUzNSBlbGVtZW50cy4KICAvLyBTZWUgW1dlYktpdCBCdWcgODA3OTddKGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD04MDc5NykKICBfLm1heCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0FycmF5KG9iaikgJiYgb2JqWzBdID09PSArb2JqWzBdICYmIG9iai5sZW5ndGggPCA2NTUzNSkgewogICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkoTWF0aCwgb2JqKTsKICAgIH0KICAgIHZhciByZXN1bHQgPSAtSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IC1JbmZpbml0eTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0b3IgPyBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkgOiB2YWx1ZTsKICAgICAgaWYgKGNvbXB1dGVkID4gbGFzdENvbXB1dGVkKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gZWxlbWVudCAob3IgZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgXy5taW4gPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoIWl0ZXJhdG9yICYmIF8uaXNBcnJheShvYmopICYmIG9ialswXSA9PT0gK29ialswXSAmJiBvYmoubGVuZ3RoIDwgNjU1MzUpIHsKICAgICAgcmV0dXJuIE1hdGgubWluLmFwcGx5KE1hdGgsIG9iaik7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IEluZmluaXR5OwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICB2YXIgY29tcHV0ZWQgPSBpdGVyYXRvciA/IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSA6IHZhbHVlOwogICAgICBpZiAoY29tcHV0ZWQgPCBsYXN0Q29tcHV0ZWQpIHsKICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICBsYXN0Q29tcHV0ZWQgPSBjb21wdXRlZDsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFNodWZmbGUgYW4gYXJyYXksIHVzaW5nIHRoZSBtb2Rlcm4gdmVyc2lvbiBvZiB0aGUKICAvLyBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVy4oCTWWF0ZXNfc2h1ZmZsZSkuCiAgXy5zaHVmZmxlID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgcmFuZDsKICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc2h1ZmZsZWQgPSBbXTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByYW5kID0gXy5yYW5kb20oaW5kZXgrKyk7CiAgICAgIHNodWZmbGVkW2luZGV4IC0gMV0gPSBzaHVmZmxlZFtyYW5kXTsKICAgICAgc2h1ZmZsZWRbcmFuZF0gPSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIHNodWZmbGVkOwogIH07CgogIC8vIFNhbXBsZSAqKm4qKiByYW5kb20gdmFsdWVzIGZyb20gYSBjb2xsZWN0aW9uLgogIC8vIElmICoqbioqIGlzIG5vdCBzcGVjaWZpZWQsIHJldHVybnMgYSBzaW5nbGUgcmFuZG9tIGVsZW1lbnQuCiAgLy8gVGhlIGludGVybmFsIGBndWFyZGAgYXJndW1lbnQgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgbWFwYC4KICBfLnNhbXBsZSA9IGZ1bmN0aW9uKG9iaiwgbiwgZ3VhcmQpIHsKICAgIGlmIChuID09IG51bGwgfHwgZ3VhcmQpIHsKICAgICAgaWYgKG9iai5sZW5ndGggIT09ICtvYmoubGVuZ3RoKSBvYmogPSBfLnZhbHVlcyhvYmopOwogICAgICByZXR1cm4gb2JqW18ucmFuZG9tKG9iai5sZW5ndGggLSAxKV07CiAgICB9CiAgICByZXR1cm4gXy5zaHVmZmxlKG9iaikuc2xpY2UoMCwgTWF0aC5tYXgoMCwgbikpOwogIH07CgogIC8vIEFuIGludGVybmFsIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIGxvb2t1cCBpdGVyYXRvcnMuCiAgdmFyIGxvb2t1cEl0ZXJhdG9yID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PSBudWxsKSByZXR1cm4gXy5pZGVudGl0eTsKICAgIGlmIChfLmlzRnVuY3Rpb24odmFsdWUpKSByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gXy5wcm9wZXJ0eSh2YWx1ZSk7CiAgfTsKCiAgLy8gU29ydCB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uIHByb2R1Y2VkIGJ5IGFuIGl0ZXJhdG9yLgogIF8uc29ydEJ5ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaXRlcmF0b3IgPSBsb29rdXBJdGVyYXRvcihpdGVyYXRvcik7CiAgICByZXR1cm4gXy5wbHVjayhfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBpbmRleDogaW5kZXgsCiAgICAgICAgY3JpdGVyaWE6IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KQogICAgICB9OwogICAgfSkuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWE7CiAgICAgIHZhciBiID0gcmlnaHQuY3JpdGVyaWE7CiAgICAgIGlmIChhICE9PSBiKSB7CiAgICAgICAgaWYgKGEgPiBiIHx8IGEgPT09IHZvaWQgMCkgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEgPCBiIHx8IGIgPT09IHZvaWQgMCkgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHJldHVybiBsZWZ0LmluZGV4IC0gcmlnaHQuaW5kZXg7CiAgICB9KSwgJ3ZhbHVlJyk7CiAgfTsKCiAgLy8gQW4gaW50ZXJuYWwgZnVuY3Rpb24gdXNlZCBmb3IgYWdncmVnYXRlICJncm91cCBieSIgb3BlcmF0aW9ucy4KICB2YXIgZ3JvdXAgPSBmdW5jdGlvbihiZWhhdmlvcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICAgIHZhciBrZXkgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgb2JqKTsKICAgICAgICBiZWhhdmlvcihyZXN1bHQsIGtleSwgdmFsdWUpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gR3JvdXBzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24uIFBhc3MgZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZQogIC8vIHRvIGdyb3VwIGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY3JpdGVyaW9uLgogIF8uZ3JvdXBCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwga2V5LCB2YWx1ZSkgewogICAgXy5oYXMocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSkgOiByZXN1bHRba2V5XSA9IFt2YWx1ZV07CiAgfSk7CgogIC8vIEluZGV4ZXMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbiwgc2ltaWxhciB0byBgZ3JvdXBCeWAsIGJ1dCBmb3IKICAvLyB3aGVuIHlvdSBrbm93IHRoYXQgeW91ciBpbmRleCB2YWx1ZXMgd2lsbCBiZSB1bmlxdWUuCiAgXy5pbmRleEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXksIHZhbHVlKSB7CiAgICByZXN1bHRba2V5XSA9IHZhbHVlOwogIH0pOwoKICAvLyBDb3VudHMgaW5zdGFuY2VzIG9mIGFuIG9iamVjdCB0aGF0IGdyb3VwIGJ5IGEgY2VydGFpbiBjcml0ZXJpb24uIFBhc3MKICAvLyBlaXRoZXIgYSBzdHJpbmcgYXR0cmlidXRlIHRvIGNvdW50IGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUKICAvLyBjcml0ZXJpb24uCiAgXy5jb3VudEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXkpIHsKICAgIF8uaGFzKHJlc3VsdCwga2V5KSA/IHJlc3VsdFtrZXldKysgOiByZXN1bHRba2V5XSA9IDE7CiAgfSk7CgogIC8vIFVzZSBhIGNvbXBhcmF0b3IgZnVuY3Rpb24gdG8gZmlndXJlIG91dCB0aGUgc21hbGxlc3QgaW5kZXggYXQgd2hpY2gKICAvLyBhbiBvYmplY3Qgc2hvdWxkIGJlIGluc2VydGVkIHNvIGFzIHRvIG1haW50YWluIG9yZGVyLiBVc2VzIGJpbmFyeSBzZWFyY2guCiAgXy5zb3J0ZWRJbmRleCA9IGZ1bmN0aW9uKGFycmF5LCBvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgIHZhciB2YWx1ZSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqKTsKICAgIHZhciBsb3cgPSAwLCBoaWdoID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgdmFyIG1pZCA9IChsb3cgKyBoaWdoKSA+Pj4gMTsKICAgICAgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBhcnJheVttaWRdKSA8IHZhbHVlID8gbG93ID0gbWlkICsgMSA6IGhpZ2ggPSBtaWQ7CiAgICB9CiAgICByZXR1cm4gbG93OwogIH07CgogIC8vIFNhZmVseSBjcmVhdGUgYSByZWFsLCBsaXZlIGFycmF5IGZyb20gYW55dGhpbmcgaXRlcmFibGUuCiAgXy50b0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIW9iaikgcmV0dXJuIFtdOwogICAgaWYgKF8uaXNBcnJheShvYmopKSByZXR1cm4gc2xpY2UuY2FsbChvYmopOwogICAgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSByZXR1cm4gXy5tYXAob2JqLCBfLmlkZW50aXR5KTsKICAgIHJldHVybiBfLnZhbHVlcyhvYmopOwogIH07CgogIC8vIFJldHVybiB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGFuIG9iamVjdC4KICBfLnNpemUgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIDA7CiAgICByZXR1cm4gKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSA/IG9iai5sZW5ndGggOiBfLmtleXMob2JqKS5sZW5ndGg7CiAgfTsKCiAgLy8gQXJyYXkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIEdldCB0aGUgZmlyc3QgZWxlbWVudCBvZiBhbiBhcnJheS4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiB0aGUgZmlyc3QgTgogIC8vIHZhbHVlcyBpbiB0aGUgYXJyYXkuIEFsaWFzZWQgYXMgYGhlYWRgIGFuZCBgdGFrZWAuIFRoZSAqKmd1YXJkKiogY2hlY2sKICAvLyBhbGxvd3MgaXQgdG8gd29yayB3aXRoIGBfLm1hcGAuCiAgXy5maXJzdCA9IF8uaGVhZCA9IF8udGFrZSA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICBpZiAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQpIHJldHVybiBhcnJheVswXTsKICAgIGlmIChuIDwgMCkgcmV0dXJuIFtdOwogICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIDAsIG4pOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGxhc3QgZW50cnkgb2YgdGhlIGFycmF5LiBFc3BlY2lhbGx5IHVzZWZ1bCBvbgogIC8vIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIGFsbCB0aGUgdmFsdWVzIGluCiAgLy8gdGhlIGFycmF5LCBleGNsdWRpbmcgdGhlIGxhc3QgTi4gVGhlICoqZ3VhcmQqKiBjaGVjayBhbGxvd3MgaXQgdG8gd29yayB3aXRoCiAgLy8gYF8ubWFwYC4KICBfLmluaXRpYWwgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAwLCBhcnJheS5sZW5ndGggLSAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQgPyAxIDogbikpOwogIH07CgogIC8vIEdldCB0aGUgbGFzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBsYXN0IE4KICAvLyB2YWx1ZXMgaW4gdGhlIGFycmF5LiBUaGUgKipndWFyZCoqIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLmxhc3QgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgaWYgKChuID09IG51bGwpIHx8IGd1YXJkKSByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgTWF0aC5tYXgoYXJyYXkubGVuZ3RoIC0gbiwgMCkpOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgdGFpbGAgYW5kIGBkcm9wYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKm4qKiB3aWxsIHJldHVybgogIC8vIHRoZSByZXN0IE4gdmFsdWVzIGluIHRoZSBhcnJheS4gVGhlICoqZ3VhcmQqKgogIC8vIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLnJlc3QgPSBfLnRhaWwgPSBfLmRyb3AgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAobiA9PSBudWxsKSB8fCBndWFyZCA/IDEgOiBuKTsKICB9OwoKICAvLyBUcmltIG91dCBhbGwgZmFsc3kgdmFsdWVzIGZyb20gYW4gYXJyYXkuCiAgXy5jb21wYWN0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHJldHVybiBfLmZpbHRlcihhcnJheSwgXy5pZGVudGl0eSk7CiAgfTsKCiAgLy8gSW50ZXJuYWwgaW1wbGVtZW50YXRpb24gb2YgYSByZWN1cnNpdmUgYGZsYXR0ZW5gIGZ1bmN0aW9uLgogIHZhciBmbGF0dGVuID0gZnVuY3Rpb24oaW5wdXQsIHNoYWxsb3csIG91dHB1dCkgewogICAgaWYgKHNoYWxsb3cgJiYgXy5ldmVyeShpbnB1dCwgXy5pc0FycmF5KSkgewogICAgICByZXR1cm4gY29uY2F0LmFwcGx5KG91dHB1dCwgaW5wdXQpOwogICAgfQogICAgZWFjaChpbnB1dCwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKF8uaXNBcnJheSh2YWx1ZSkgfHwgXy5pc0FyZ3VtZW50cyh2YWx1ZSkpIHsKICAgICAgICBzaGFsbG93ID8gcHVzaC5hcHBseShvdXRwdXQsIHZhbHVlKSA6IGZsYXR0ZW4odmFsdWUsIHNoYWxsb3csIG91dHB1dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3V0cHV0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvdXRwdXQ7CiAgfTsKCiAgLy8gRmxhdHRlbiBvdXQgYW4gYXJyYXksIGVpdGhlciByZWN1cnNpdmVseSAoYnkgZGVmYXVsdCksIG9yIGp1c3Qgb25lIGxldmVsLgogIF8uZmxhdHRlbiA9IGZ1bmN0aW9uKGFycmF5LCBzaGFsbG93KSB7CiAgICByZXR1cm4gZmxhdHRlbihhcnJheSwgc2hhbGxvdywgW10pOwogIH07CgogIC8vIFJldHVybiBhIHZlcnNpb24gb2YgdGhlIGFycmF5IHRoYXQgZG9lcyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIHZhbHVlKHMpLgogIF8ud2l0aG91dCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5kaWZmZXJlbmNlKGFycmF5LCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogIH07CgogIC8vIFNwbGl0IGFuIGFycmF5IGludG8gdHdvIGFycmF5czogb25lIHdob3NlIGVsZW1lbnRzIGFsbCBzYXRpc2Z5IHRoZSBnaXZlbgogIC8vIHByZWRpY2F0ZSwgYW5kIG9uZSB3aG9zZSBlbGVtZW50cyBhbGwgZG8gbm90IHNhdGlzZnkgdGhlIHByZWRpY2F0ZS4KICBfLnBhcnRpdGlvbiA9IGZ1bmN0aW9uKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHZhciBwYXNzID0gW10sIGZhaWwgPSBbXTsKICAgIGVhY2goYXJyYXksIGZ1bmN0aW9uKGVsZW0pIHsKICAgICAgKHByZWRpY2F0ZShlbGVtKSA/IHBhc3MgOiBmYWlsKS5wdXNoKGVsZW0pOwogICAgfSk7CiAgICByZXR1cm4gW3Bhc3MsIGZhaWxdOwogIH07CgogIC8vIFByb2R1Y2UgYSBkdXBsaWNhdGUtZnJlZSB2ZXJzaW9uIG9mIHRoZSBhcnJheS4gSWYgdGhlIGFycmF5IGhhcyBhbHJlYWR5CiAgLy8gYmVlbiBzb3J0ZWQsIHlvdSBoYXZlIHRoZSBvcHRpb24gb2YgdXNpbmcgYSBmYXN0ZXIgYWxnb3JpdGhtLgogIC8vIEFsaWFzZWQgYXMgYHVuaXF1ZWAuCiAgXy51bmlxID0gXy51bmlxdWUgPSBmdW5jdGlvbihhcnJheSwgaXNTb3J0ZWQsIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoXy5pc0Z1bmN0aW9uKGlzU29ydGVkKSkgewogICAgICBjb250ZXh0ID0gaXRlcmF0b3I7CiAgICAgIGl0ZXJhdG9yID0gaXNTb3J0ZWQ7CiAgICAgIGlzU29ydGVkID0gZmFsc2U7CiAgICB9CiAgICB2YXIgaW5pdGlhbCA9IGl0ZXJhdG9yID8gXy5tYXAoYXJyYXksIGl0ZXJhdG9yLCBjb250ZXh0KSA6IGFycmF5OwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBzZWVuID0gW107CiAgICBlYWNoKGluaXRpYWwsIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICBpZiAoaXNTb3J0ZWQgPyAoIWluZGV4IHx8IHNlZW5bc2Vlbi5sZW5ndGggLSAxXSAhPT0gdmFsdWUpIDogIV8uY29udGFpbnMoc2VlbiwgdmFsdWUpKSB7CiAgICAgICAgc2Vlbi5wdXNoKHZhbHVlKTsKICAgICAgICByZXN1bHRzLnB1c2goYXJyYXlbaW5kZXhdKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2YKICAvLyB0aGUgcGFzc2VkLWluIGFycmF5cy4KICBfLnVuaW9uID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gXy51bmlxKF8uZmxhdHRlbihhcmd1bWVudHMsIHRydWUpKTsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgZXZlcnkgaXRlbSBzaGFyZWQgYmV0d2VlbiBhbGwgdGhlCiAgLy8gcGFzc2VkLWluIGFycmF5cy4KICBfLmludGVyc2VjdGlvbiA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBfLmZpbHRlcihfLnVuaXEoYXJyYXkpLCBmdW5jdGlvbihpdGVtKSB7CiAgICAgIHJldHVybiBfLmV2ZXJ5KHJlc3QsIGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgcmV0dXJuIF8uY29udGFpbnMob3RoZXIsIGl0ZW0pOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIC8vIFRha2UgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBvbmUgYXJyYXkgYW5kIGEgbnVtYmVyIG9mIG90aGVyIGFycmF5cy4KICAvLyBPbmx5IHRoZSBlbGVtZW50cyBwcmVzZW50IGluIGp1c3QgdGhlIGZpcnN0IGFycmF5IHdpbGwgcmVtYWluLgogIF8uZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgcmV0dXJuIF8uZmlsdGVyKGFycmF5LCBmdW5jdGlvbih2YWx1ZSl7IHJldHVybiAhXy5jb250YWlucyhyZXN0LCB2YWx1ZSk7IH0pOwogIH07CgogIC8vIFppcCB0b2dldGhlciBtdWx0aXBsZSBsaXN0cyBpbnRvIGEgc2luZ2xlIGFycmF5IC0tIGVsZW1lbnRzIHRoYXQgc2hhcmUKICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci4KICBfLnppcCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGxlbmd0aCA9IF8ubWF4KF8ucGx1Y2soYXJndW1lbnRzLCAnbGVuZ3RoJykuY29uY2F0KDApKTsKICAgIHZhciByZXN1bHRzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdHNbaV0gPSBfLnBsdWNrKGFyZ3VtZW50cywgJycgKyBpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIENvbnZlcnRzIGxpc3RzIGludG8gb2JqZWN0cy4gUGFzcyBlaXRoZXIgYSBzaW5nbGUgYXJyYXkgb2YgYFtrZXksIHZhbHVlXWAKICAvLyBwYWlycywgb3IgdHdvIHBhcmFsbGVsIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGggLS0gb25lIG9mIGtleXMsIGFuZCBvbmUgb2YKICAvLyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZXMuCiAgXy5vYmplY3QgPSBmdW5jdGlvbihsaXN0LCB2YWx1ZXMpIHsKICAgIGlmIChsaXN0ID09IG51bGwpIHJldHVybiB7fTsKICAgIHZhciByZXN1bHQgPSB7fTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBsaXN0Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh2YWx1ZXMpIHsKICAgICAgICByZXN1bHRbbGlzdFtpXV0gPSB2YWx1ZXNbaV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0W2xpc3RbaV1bMF1dID0gbGlzdFtpXVsxXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBseSB1cyB3aXRoIGluZGV4T2YgKEknbSBsb29raW5nIGF0IHlvdSwgKipNU0lFKiopLAogIC8vIHdlIG5lZWQgdGhpcyBmdW5jdGlvbi4gUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbgogIC8vIGl0ZW0gaW4gYW4gYXJyYXksIG9yIC0xIGlmIHRoZSBpdGVtIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgYXJyYXkuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGluZGV4T2ZgIGlmIGF2YWlsYWJsZS4KICAvLyBJZiB0aGUgYXJyYXkgaXMgbGFyZ2UgYW5kIGFscmVhZHkgaW4gc29ydCBvcmRlciwgcGFzcyBgdHJ1ZWAKICAvLyBmb3IgKippc1NvcnRlZCoqIHRvIHVzZSBiaW5hcnkgc2VhcmNoLgogIF8uaW5kZXhPZiA9IGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBpc1NvcnRlZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgaWYgKGlzU29ydGVkKSB7CiAgICAgIGlmICh0eXBlb2YgaXNTb3J0ZWQgPT0gJ251bWJlcicpIHsKICAgICAgICBpID0gKGlzU29ydGVkIDwgMCA/IE1hdGgubWF4KDAsIGxlbmd0aCArIGlzU29ydGVkKSA6IGlzU29ydGVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpID0gXy5zb3J0ZWRJbmRleChhcnJheSwgaXRlbSk7CiAgICAgICAgcmV0dXJuIGFycmF5W2ldID09PSBpdGVtID8gaSA6IC0xOwogICAgICB9CiAgICB9CiAgICBpZiAobmF0aXZlSW5kZXhPZiAmJiBhcnJheS5pbmRleE9mID09PSBuYXRpdmVJbmRleE9mKSByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtLCBpc1NvcnRlZCk7CiAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBsYXN0SW5kZXhPZmAgaWYgYXZhaWxhYmxlLgogIF8ubGFzdEluZGV4T2YgPSBmdW5jdGlvbihhcnJheSwgaXRlbSwgZnJvbSkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBoYXNJbmRleCA9IGZyb20gIT0gbnVsbDsKICAgIGlmIChuYXRpdmVMYXN0SW5kZXhPZiAmJiBhcnJheS5sYXN0SW5kZXhPZiA9PT0gbmF0aXZlTGFzdEluZGV4T2YpIHsKICAgICAgcmV0dXJuIGhhc0luZGV4ID8gYXJyYXkubGFzdEluZGV4T2YoaXRlbSwgZnJvbSkgOiBhcnJheS5sYXN0SW5kZXhPZihpdGVtKTsKICAgIH0KICAgIHZhciBpID0gKGhhc0luZGV4ID8gZnJvbSA6IGFycmF5Lmxlbmd0aCk7CiAgICB3aGlsZSAoaS0tKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIEdlbmVyYXRlIGFuIGludGVnZXIgQXJyYXkgY29udGFpbmluZyBhbiBhcml0aG1ldGljIHByb2dyZXNzaW9uLiBBIHBvcnQgb2YKICAvLyB0aGUgbmF0aXZlIFB5dGhvbiBgcmFuZ2UoKWAgZnVuY3Rpb24uIFNlZQogIC8vIFt0aGUgUHl0aG9uIGRvY3VtZW50YXRpb25dKGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvbGlicmFyeS9mdW5jdGlvbnMuaHRtbCNyYW5nZSkuCiAgXy5yYW5nZSA9IGZ1bmN0aW9uKHN0YXJ0LCBzdG9wLCBzdGVwKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8PSAxKSB7CiAgICAgIHN0b3AgPSBzdGFydCB8fCAwOwogICAgICBzdGFydCA9IDA7CiAgICB9CiAgICBzdGVwID0gYXJndW1lbnRzWzJdIHx8IDE7CgogICAgdmFyIGxlbmd0aCA9IE1hdGgubWF4KE1hdGguY2VpbCgoc3RvcCAtIHN0YXJ0KSAvIHN0ZXApLCAwKTsKICAgIHZhciBpZHggPSAwOwogICAgdmFyIHJhbmdlID0gbmV3IEFycmF5KGxlbmd0aCk7CgogICAgd2hpbGUoaWR4IDwgbGVuZ3RoKSB7CiAgICAgIHJhbmdlW2lkeCsrXSA9IHN0YXJ0OwogICAgICBzdGFydCArPSBzdGVwOwogICAgfQoKICAgIHJldHVybiByYW5nZTsKICB9OwoKICAvLyBGdW5jdGlvbiAoYWhlbSkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJldXNhYmxlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciBwcm90b3R5cGUgc2V0dGluZy4KICB2YXIgY3RvciA9IGZ1bmN0aW9uKCl7fTsKCiAgLy8gQ3JlYXRlIGEgZnVuY3Rpb24gYm91bmQgdG8gYSBnaXZlbiBvYmplY3QgKGFzc2lnbmluZyBgdGhpc2AsIGFuZCBhcmd1bWVudHMsCiAgLy8gb3B0aW9uYWxseSkuIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBGdW5jdGlvbi5iaW5kYCBpZgogIC8vIGF2YWlsYWJsZS4KICBfLmJpbmQgPSBmdW5jdGlvbihmdW5jLCBjb250ZXh0KSB7CiAgICB2YXIgYXJncywgYm91bmQ7CiAgICBpZiAobmF0aXZlQmluZCAmJiBmdW5jLmJpbmQgPT09IG5hdGl2ZUJpbmQpIHJldHVybiBuYXRpdmVCaW5kLmFwcGx5KGZ1bmMsIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBpZiAoIV8uaXNGdW5jdGlvbihmdW5jKSkgdGhyb3cgbmV3IFR5cGVFcnJvcjsKICAgIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICByZXR1cm4gYm91bmQgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIGJvdW5kKSkgcmV0dXJuIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGN0b3IucHJvdG90eXBlID0gZnVuYy5wcm90b3R5cGU7CiAgICAgIHZhciBzZWxmID0gbmV3IGN0b3I7CiAgICAgIGN0b3IucHJvdG90eXBlID0gbnVsbDsKICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkoc2VsZiwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGlmIChPYmplY3QocmVzdWx0KSA9PT0gcmVzdWx0KSByZXR1cm4gcmVzdWx0OwogICAgICByZXR1cm4gc2VsZjsKICAgIH07CiAgfTsKCiAgLy8gUGFydGlhbGx5IGFwcGx5IGEgZnVuY3Rpb24gYnkgY3JlYXRpbmcgYSB2ZXJzaW9uIHRoYXQgaGFzIGhhZCBzb21lIG9mIGl0cwogIC8vIGFyZ3VtZW50cyBwcmUtZmlsbGVkLCB3aXRob3V0IGNoYW5naW5nIGl0cyBkeW5hbWljIGB0aGlzYCBjb250ZXh0LiBfIGFjdHMKICAvLyBhcyBhIHBsYWNlaG9sZGVyLCBhbGxvd2luZyBhbnkgY29tYmluYXRpb24gb2YgYXJndW1lbnRzIHRvIGJlIHByZS1maWxsZWQuCiAgXy5wYXJ0aWFsID0gZnVuY3Rpb24oZnVuYykgewogICAgdmFyIGJvdW5kQXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHBvc2l0aW9uID0gMDsKICAgICAgdmFyIGFyZ3MgPSBib3VuZEFyZ3Muc2xpY2UoKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJnc1tpXSA9PT0gXykgYXJnc1tpXSA9IGFyZ3VtZW50c1twb3NpdGlvbisrXTsKICAgICAgfQogICAgICB3aGlsZSAocG9zaXRpb24gPCBhcmd1bWVudHMubGVuZ3RoKSBhcmdzLnB1c2goYXJndW1lbnRzW3Bvc2l0aW9uKytdKTsKICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH07CgogIC8vIEJpbmQgYSBudW1iZXIgb2YgYW4gb2JqZWN0J3MgbWV0aG9kcyB0byB0aGF0IG9iamVjdC4gUmVtYWluaW5nIGFyZ3VtZW50cwogIC8vIGFyZSB0aGUgbWV0aG9kIG5hbWVzIHRvIGJlIGJvdW5kLiBVc2VmdWwgZm9yIGVuc3VyaW5nIHRoYXQgYWxsIGNhbGxiYWNrcwogIC8vIGRlZmluZWQgb24gYW4gb2JqZWN0IGJlbG9uZyB0byBpdC4KICBfLmJpbmRBbGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBmdW5jcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIGlmIChmdW5jcy5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcignYmluZEFsbCBtdXN0IGJlIHBhc3NlZCBmdW5jdGlvbiBuYW1lcycpOwogICAgZWFjaChmdW5jcywgZnVuY3Rpb24oZikgeyBvYmpbZl0gPSBfLmJpbmQob2JqW2ZdLCBvYmopOyB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gTWVtb2l6ZSBhbiBleHBlbnNpdmUgZnVuY3Rpb24gYnkgc3RvcmluZyBpdHMgcmVzdWx0cy4KICBfLm1lbW9pemUgPSBmdW5jdGlvbihmdW5jLCBoYXNoZXIpIHsKICAgIHZhciBtZW1vID0ge307CiAgICBoYXNoZXIgfHwgKGhhc2hlciA9IF8uaWRlbnRpdHkpOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIga2V5ID0gaGFzaGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfLmhhcyhtZW1vLCBrZXkpID8gbWVtb1trZXldIDogKG1lbW9ba2V5XSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9OwogIH07CgogIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHMKICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuCiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7IH0sIHdhaXQpOwogIH07CgogIC8vIERlZmVycyBhIGZ1bmN0aW9uLCBzY2hlZHVsaW5nIGl0IHRvIHJ1biBhZnRlciB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhcwogIC8vIGNsZWFyZWQuCiAgXy5kZWZlciA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHJldHVybiBfLmRlbGF5LmFwcGx5KF8sIFtmdW5jLCAxXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCB3aGVuIGludm9rZWQsIHdpbGwgb25seSBiZSB0cmlnZ2VyZWQgYXQgbW9zdCBvbmNlCiAgLy8gZHVyaW5nIGEgZ2l2ZW4gd2luZG93IG9mIHRpbWUuIE5vcm1hbGx5LCB0aGUgdGhyb3R0bGVkIGZ1bmN0aW9uIHdpbGwgcnVuCiAgLy8gYXMgbXVjaCBhcyBpdCBjYW4sIHdpdGhvdXQgZXZlciBnb2luZyBtb3JlIHRoYW4gb25jZSBwZXIgYHdhaXRgIGR1cmF0aW9uOwogIC8vIGJ1dCBpZiB5b3UnZCBsaWtlIHRvIGRpc2FibGUgdGhlIGV4ZWN1dGlvbiBvbiB0aGUgbGVhZGluZyBlZGdlLCBwYXNzCiAgLy8gYHtsZWFkaW5nOiBmYWxzZX1gLiBUbyBkaXNhYmxlIGV4ZWN1dGlvbiBvbiB0aGUgdHJhaWxpbmcgZWRnZSwgZGl0dG8uCiAgXy50aHJvdHRsZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHsKICAgIHZhciBjb250ZXh0LCBhcmdzLCByZXN1bHQ7CiAgICB2YXIgdGltZW91dCA9IG51bGw7CiAgICB2YXIgcHJldmlvdXMgPSAwOwogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICBwcmV2aW91cyA9IG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UgPyAwIDogXy5ub3coKTsKICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBub3cgPSBfLm5vdygpOwogICAgICBpZiAoIXByZXZpb3VzICYmIG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UpIHByZXZpb3VzID0gbm93OwogICAgICB2YXIgcmVtYWluaW5nID0gd2FpdCAtIChub3cgLSBwcmV2aW91cyk7CiAgICAgIGNvbnRleHQgPSB0aGlzOwogICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICBpZiAocmVtYWluaW5nIDw9IDApIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgcHJldmlvdXMgPSBub3c7CiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQgJiYgb3B0aW9ucy50cmFpbGluZyAhPT0gZmFsc2UpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLiBJZiBgaW1tZWRpYXRlYCBpcyBwYXNzZWQsIHRyaWdnZXIgdGhlIGZ1bmN0aW9uIG9uIHRoZQogIC8vIGxlYWRpbmcgZWRnZSwgaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcuCiAgXy5kZWJvdW5jZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgdmFyIHRpbWVvdXQsIGFyZ3MsIGNvbnRleHQsIHRpbWVzdGFtcCwgcmVzdWx0OwoKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbGFzdCA9IF8ubm93KCkgLSB0aW1lc3RhbXA7CiAgICAgIGlmIChsYXN0IDwgd2FpdCkgewogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0IC0gbGFzdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHsKICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgY29udGV4dCA9IHRoaXM7CiAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIHRpbWVzdGFtcCA9IF8ubm93KCk7CiAgICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0OwogICAgICBpZiAoIXRpbWVvdXQpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICAgIH0KICAgICAgaWYgKGNhbGxOb3cpIHsKICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgcmFuID0gZmFsc2UsIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChyYW4pIHJldHVybiBtZW1vOwogICAgICByYW4gPSB0cnVlOwogICAgICBtZW1vID0gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBmdW5jID0gbnVsbDsKICAgICAgcmV0dXJuIG1lbW87CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGZ1bmN0aW9uIHBhc3NlZCBhcyBhbiBhcmd1bWVudCB0byB0aGUgc2Vjb25kLAogIC8vIGFsbG93aW5nIHlvdSB0byBhZGp1c3QgYXJndW1lbnRzLCBydW4gY29kZSBiZWZvcmUgYW5kIGFmdGVyLCBhbmQKICAvLyBjb25kaXRpb25hbGx5IGV4ZWN1dGUgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uLgogIF8ud3JhcCA9IGZ1bmN0aW9uKGZ1bmMsIHdyYXBwZXIpIHsKICAgIHJldHVybiBfLnBhcnRpYWwod3JhcHBlciwgZnVuYyk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgaXMgdGhlIGNvbXBvc2l0aW9uIG9mIGEgbGlzdCBvZiBmdW5jdGlvbnMsIGVhY2gKICAvLyBjb25zdW1pbmcgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZnVuY3Rpb24gdGhhdCBmb2xsb3dzLgogIF8uY29tcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGZ1bmNzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgICAgZm9yICh2YXIgaSA9IGZ1bmNzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgYXJncyA9IFtmdW5jc1tpXS5hcHBseSh0aGlzLCBhcmdzKV07CiAgICAgIH0KICAgICAgcmV0dXJuIGFyZ3NbMF07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgb25seSBiZSBleGVjdXRlZCBhZnRlciBiZWluZyBjYWxsZWQgTiB0aW1lcy4KICBfLmFmdGVyID0gZnVuY3Rpb24odGltZXMsIGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgaWYgKC0tdGltZXMgPCAxKSB7CiAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9OwoKICAvLyBPYmplY3QgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSZXRyaWV2ZSB0aGUgbmFtZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgT2JqZWN0LmtleXNgCiAgXy5rZXlzID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIV8uaXNPYmplY3Qob2JqKSkgcmV0dXJuIFtdOwogICAgaWYgKG5hdGl2ZUtleXMpIHJldHVybiBuYXRpdmVLZXlzKG9iaik7CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkga2V5cy5wdXNoKGtleSk7CiAgICByZXR1cm4ga2V5czsKICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgdmFsdWVzIG9mIGFuIG9iamVjdCdzIHByb3BlcnRpZXMuCiAgXy52YWx1ZXMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICB2YXIgdmFsdWVzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhbHVlc1tpXSA9IG9ialtrZXlzW2ldXTsKICAgIH0KICAgIHJldHVybiB2YWx1ZXM7CiAgfTsKCiAgLy8gQ29udmVydCBhbiBvYmplY3QgaW50byBhIGxpc3Qgb2YgYFtrZXksIHZhbHVlXWAgcGFpcnMuCiAgXy5wYWlycyA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgIHZhciBwYWlycyA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBwYWlyc1tpXSA9IFtrZXlzW2ldLCBvYmpba2V5c1tpXV1dOwogICAgfQogICAgcmV0dXJuIHBhaXJzOwogIH07CgogIC8vIEludmVydCB0aGUga2V5cyBhbmQgdmFsdWVzIG9mIGFuIG9iamVjdC4gVGhlIHZhbHVlcyBtdXN0IGJlIHNlcmlhbGl6YWJsZS4KICBfLmludmVydCA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIHJlc3VsdCA9IHt9OwogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdFtvYmpba2V5c1tpXV1dID0ga2V5c1tpXTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LgogIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgCiAgXy5mdW5jdGlvbnMgPSBfLm1ldGhvZHMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9ialtrZXldKSkgbmFtZXMucHVzaChrZXkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzLnNvcnQoKTsKICB9OwoKICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS4KICBfLmV4dGVuZCA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHsKICAgICAgICAgIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgb25seSBjb250YWluaW5nIHRoZSB3aGl0ZWxpc3RlZCBwcm9wZXJ0aWVzLgogIF8ucGljayA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGNvcHkgPSB7fTsKICAgIHZhciBrZXlzID0gY29uY2F0LmFwcGx5KEFycmF5UHJvdG8sIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBlYWNoKGtleXMsIGZ1bmN0aW9uKGtleSkgewogICAgICBpZiAoa2V5IGluIG9iaikgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9KTsKICAgIHJldHVybiBjb3B5OwogIH07CgogICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgd2l0aG91dCB0aGUgYmxhY2tsaXN0ZWQgcHJvcGVydGllcy4KICBfLm9taXQgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBjb3B5ID0ge307CiAgICB2YXIga2V5cyA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoIV8uY29udGFpbnMoa2V5cywga2V5KSkgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9CiAgICByZXR1cm4gY29weTsKICB9OwoKICAvLyBGaWxsIGluIGEgZ2l2ZW4gb2JqZWN0IHdpdGggZGVmYXVsdCBwcm9wZXJ0aWVzLgogIF8uZGVmYXVsdHMgPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBmdW5jdGlvbihzb3VyY2UpIHsKICAgICAgaWYgKHNvdXJjZSkgewogICAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgICBpZiAob2JqW3Byb3BdID09PSB2b2lkIDApIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBDcmVhdGUgYSAoc2hhbGxvdy1jbG9uZWQpIGR1cGxpY2F0ZSBvZiBhbiBvYmplY3QuCiAgXy5jbG9uZSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHJldHVybiBvYmo7CiAgICByZXR1cm4gXy5pc0FycmF5KG9iaikgPyBvYmouc2xpY2UoKSA6IF8uZXh0ZW5kKHt9LCBvYmopOwogIH07CgogIC8vIEludm9rZXMgaW50ZXJjZXB0b3Igd2l0aCB0aGUgb2JqLCBhbmQgdGhlbiByZXR1cm5zIG9iai4KICAvLyBUaGUgcHJpbWFyeSBwdXJwb3NlIG9mIHRoaXMgbWV0aG9kIGlzIHRvICJ0YXAgaW50byIgYSBtZXRob2QgY2hhaW4sIGluCiAgLy8gb3JkZXIgdG8gcGVyZm9ybSBvcGVyYXRpb25zIG9uIGludGVybWVkaWF0ZSByZXN1bHRzIHdpdGhpbiB0aGUgY2hhaW4uCiAgXy50YXAgPSBmdW5jdGlvbihvYmosIGludGVyY2VwdG9yKSB7CiAgICBpbnRlcmNlcHRvcihvYmopOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBJbnRlcm5hbCByZWN1cnNpdmUgY29tcGFyaXNvbiBmdW5jdGlvbiBmb3IgYGlzRXF1YWxgLgogIHZhciBlcSA9IGZ1bmN0aW9uKGEsIGIsIGFTdGFjaywgYlN0YWNrKSB7CiAgICAvLyBJZGVudGljYWwgb2JqZWN0cyBhcmUgZXF1YWwuIGAwID09PSAtMGAsIGJ1dCB0aGV5IGFyZW4ndCBpZGVudGljYWwuCiAgICAvLyBTZWUgdGhlIFtIYXJtb255IGBlZ2FsYCBwcm9wb3NhbF0oaHR0cDovL3dpa2kuZWNtYXNjcmlwdC5vcmcvZG9rdS5waHA/aWQ9aGFybW9ueTplZ2FsKS4KICAgIGlmIChhID09PSBiKSByZXR1cm4gYSAhPT0gMCB8fCAxIC8gYSA9PSAxIC8gYjsKICAgIC8vIEEgc3RyaWN0IGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5IGJlY2F1c2UgYG51bGwgPT0gdW5kZWZpbmVkYC4KICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gYSA9PT0gYjsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEgaW5zdGFuY2VvZiBfKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiIGluc3RhbmNlb2YgXykgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBDb21wYXJlIGBbW0NsYXNzXV1gIG5hbWVzLgogICAgdmFyIGNsYXNzTmFtZSA9IHRvU3RyaW5nLmNhbGwoYSk7CiAgICBpZiAoY2xhc3NOYW1lICE9IHRvU3RyaW5nLmNhbGwoYikpIHJldHVybiBmYWxzZTsKICAgIHN3aXRjaCAoY2xhc3NOYW1lKSB7CiAgICAgIC8vIFN0cmluZ3MsIG51bWJlcnMsIGRhdGVzLCBhbmQgYm9vbGVhbnMgYXJlIGNvbXBhcmVkIGJ5IHZhbHVlLgogICAgICBjYXNlICdbb2JqZWN0IFN0cmluZ10nOgogICAgICAgIC8vIFByaW1pdGl2ZXMgYW5kIHRoZWlyIGNvcnJlc3BvbmRpbmcgb2JqZWN0IHdyYXBwZXJzIGFyZSBlcXVpdmFsZW50OyB0aHVzLCBgIjUiYCBpcwogICAgICAgIC8vIGVxdWl2YWxlbnQgdG8gYG5ldyBTdHJpbmcoIjUiKWAuCiAgICAgICAgcmV0dXJuIGEgPT0gU3RyaW5nKGIpOwogICAgICBjYXNlICdbb2JqZWN0IE51bWJlcl0nOgogICAgICAgIC8vIGBOYU5gcyBhcmUgZXF1aXZhbGVudCwgYnV0IG5vbi1yZWZsZXhpdmUuIEFuIGBlZ2FsYCBjb21wYXJpc29uIGlzIHBlcmZvcm1lZCBmb3IKICAgICAgICAvLyBvdGhlciBudW1lcmljIHZhbHVlcy4KICAgICAgICByZXR1cm4gYSAhPSArYSA/IGIgIT0gK2IgOiAoYSA9PSAwID8gMSAvIGEgPT0gMSAvIGIgOiBhID09ICtiKTsKICAgICAgY2FzZSAnW29iamVjdCBEYXRlXSc6CiAgICAgIGNhc2UgJ1tvYmplY3QgQm9vbGVhbl0nOgogICAgICAgIC8vIENvZXJjZSBkYXRlcyBhbmQgYm9vbGVhbnMgdG8gbnVtZXJpYyBwcmltaXRpdmUgdmFsdWVzLiBEYXRlcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIKICAgICAgICAvLyBtaWxsaXNlY29uZCByZXByZXNlbnRhdGlvbnMuIE5vdGUgdGhhdCBpbnZhbGlkIGRhdGVzIHdpdGggbWlsbGlzZWNvbmQgcmVwcmVzZW50YXRpb25zCiAgICAgICAgLy8gb2YgYE5hTmAgYXJlIG5vdCBlcXVpdmFsZW50LgogICAgICAgIHJldHVybiArYSA9PSArYjsKICAgICAgLy8gUmVnRXhwcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIgc291cmNlIHBhdHRlcm5zIGFuZCBmbGFncy4KICAgICAgY2FzZSAnW29iamVjdCBSZWdFeHBdJzoKICAgICAgICByZXR1cm4gYS5zb3VyY2UgPT0gYi5zb3VyY2UgJiYKICAgICAgICAgICAgICAgYS5nbG9iYWwgPT0gYi5nbG9iYWwgJiYKICAgICAgICAgICAgICAgYS5tdWx0aWxpbmUgPT0gYi5tdWx0aWxpbmUgJiYKICAgICAgICAgICAgICAgYS5pZ25vcmVDYXNlID09IGIuaWdub3JlQ2FzZTsKICAgIH0KICAgIGlmICh0eXBlb2YgYSAhPSAnb2JqZWN0JyB8fCB0eXBlb2YgYiAhPSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlOwogICAgLy8gQXNzdW1lIGVxdWFsaXR5IGZvciBjeWNsaWMgc3RydWN0dXJlcy4gVGhlIGFsZ29yaXRobSBmb3IgZGV0ZWN0aW5nIGN5Y2xpYwogICAgLy8gc3RydWN0dXJlcyBpcyBhZGFwdGVkIGZyb20gRVMgNS4xIHNlY3Rpb24gMTUuMTIuMywgYWJzdHJhY3Qgb3BlcmF0aW9uIGBKT2AuCiAgICB2YXIgbGVuZ3RoID0gYVN0YWNrLmxlbmd0aDsKICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAvLyBMaW5lYXIgc2VhcmNoLiBQZXJmb3JtYW5jZSBpcyBpbnZlcnNlbHkgcHJvcG9ydGlvbmFsIHRvIHRoZSBudW1iZXIgb2YKICAgICAgLy8gdW5pcXVlIG5lc3RlZCBzdHJ1Y3R1cmVzLgogICAgICBpZiAoYVN0YWNrW2xlbmd0aF0gPT0gYSkgcmV0dXJuIGJTdGFja1tsZW5ndGhdID09IGI7CiAgICB9CiAgICAvLyBPYmplY3RzIHdpdGggZGlmZmVyZW50IGNvbnN0cnVjdG9ycyBhcmUgbm90IGVxdWl2YWxlbnQsIGJ1dCBgT2JqZWN0YHMKICAgIC8vIGZyb20gZGlmZmVyZW50IGZyYW1lcyBhcmUuCiAgICB2YXIgYUN0b3IgPSBhLmNvbnN0cnVjdG9yLCBiQ3RvciA9IGIuY29uc3RydWN0b3I7CiAgICBpZiAoYUN0b3IgIT09IGJDdG9yICYmICEoXy5pc0Z1bmN0aW9uKGFDdG9yKSAmJiAoYUN0b3IgaW5zdGFuY2VvZiBhQ3RvcikgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmlzRnVuY3Rpb24oYkN0b3IpICYmIChiQ3RvciBpbnN0YW5jZW9mIGJDdG9yKSkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKCdjb25zdHJ1Y3RvcicgaW4gYSAmJiAnY29uc3RydWN0b3InIGluIGIpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vIEFkZCB0aGUgZmlyc3Qgb2JqZWN0IHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIGFTdGFjay5wdXNoKGEpOwogICAgYlN0YWNrLnB1c2goYik7CiAgICB2YXIgc2l6ZSA9IDAsIHJlc3VsdCA9IHRydWU7CiAgICAvLyBSZWN1cnNpdmVseSBjb21wYXJlIG9iamVjdHMgYW5kIGFycmF5cy4KICAgIGlmIChjbGFzc05hbWUgPT0gJ1tvYmplY3QgQXJyYXldJykgewogICAgICAvLyBDb21wYXJlIGFycmF5IGxlbmd0aHMgdG8gZGV0ZXJtaW5lIGlmIGEgZGVlcCBjb21wYXJpc29uIGlzIG5lY2Vzc2FyeS4KICAgICAgc2l6ZSA9IGEubGVuZ3RoOwogICAgICByZXN1bHQgPSBzaXplID09IGIubGVuZ3RoOwogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgLy8gRGVlcCBjb21wYXJlIHRoZSBjb250ZW50cywgaWdub3Jpbmcgbm9uLW51bWVyaWMgcHJvcGVydGllcy4KICAgICAgICB3aGlsZSAoc2l6ZS0tKSB7CiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBlcShhW3NpemVdLCBiW3NpemVdLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIERlZXAgY29tcGFyZSBvYmplY3RzLgogICAgICBmb3IgKHZhciBrZXkgaW4gYSkgewogICAgICAgIGlmIChfLmhhcyhhLCBrZXkpKSB7CiAgICAgICAgICAvLyBDb3VudCB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgICAgICBzaXplKys7CiAgICAgICAgICAvLyBEZWVwIGNvbXBhcmUgZWFjaCBtZW1iZXIuCiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBfLmhhcyhiLCBrZXkpICYmIGVxKGFba2V5XSwgYltrZXldLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gRW5zdXJlIHRoYXQgYm90aCBvYmplY3RzIGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBmb3IgKGtleSBpbiBiKSB7CiAgICAgICAgICBpZiAoXy5oYXMoYiwga2V5KSAmJiAhKHNpemUtLSkpIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSAhc2l6ZTsKICAgICAgfQogICAgfQogICAgLy8gUmVtb3ZlIHRoZSBmaXJzdCBvYmplY3QgZnJvbSB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHMuCiAgICBhU3RhY2sucG9wKCk7CiAgICBiU3RhY2sucG9wKCk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFBlcmZvcm0gYSBkZWVwIGNvbXBhcmlzb24gdG8gY2hlY2sgaWYgdHdvIG9iamVjdHMgYXJlIGVxdWFsLgogIF8uaXNFcXVhbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBlcShhLCBiLCBbXSwgW10pOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5PwogIC8vIEFuICJlbXB0eSIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLgogIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikpIHJldHVybiBvYmoubGVuZ3RoID09PSAwOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIERPTSBlbGVtZW50PwogIF8uaXNFbGVtZW50ID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqICYmIG9iai5ub2RlVHlwZSA9PT0gMSk7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhbiBhcnJheT8KICAvLyBEZWxlZ2F0ZXMgdG8gRUNNQTUncyBuYXRpdmUgQXJyYXkuaXNBcnJheQogIF8uaXNBcnJheSA9IG5hdGl2ZUlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09ICdbb2JqZWN0IEFycmF5XSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YXJpYWJsZSBhbiBvYmplY3Q/CiAgXy5pc09iamVjdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gT2JqZWN0KG9iaik7CiAgfTsKCiAgLy8gQWRkIHNvbWUgaXNUeXBlIG1ldGhvZHM6IGlzQXJndW1lbnRzLCBpc0Z1bmN0aW9uLCBpc1N0cmluZywgaXNOdW1iZXIsIGlzRGF0ZSwgaXNSZWdFeHAuCiAgZWFjaChbJ0FyZ3VtZW50cycsICdGdW5jdGlvbicsICdTdHJpbmcnLCAnTnVtYmVyJywgJ0RhdGUnLCAnUmVnRXhwJ10sIGZ1bmN0aW9uKG5hbWUpIHsKICAgIF9bJ2lzJyArIG5hbWVdID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT0gJ1tvYmplY3QgJyArIG5hbWUgKyAnXSc7CiAgICB9OwogIH0pOwoKICAvLyBEZWZpbmUgYSBmYWxsYmFjayB2ZXJzaW9uIG9mIHRoZSBtZXRob2QgaW4gYnJvd3NlcnMgKGFoZW0sIElFKSwgd2hlcmUKICAvLyB0aGVyZSBpc24ndCBhbnkgaW5zcGVjdGFibGUgIkFyZ3VtZW50cyIgdHlwZS4KICBpZiAoIV8uaXNBcmd1bWVudHMoYXJndW1lbnRzKSkgewogICAgXy5pc0FyZ3VtZW50cyA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gISEob2JqICYmIF8uaGFzKG9iaiwgJ2NhbGxlZScpKTsKICAgIH07CiAgfQoKICAvLyBPcHRpbWl6ZSBgaXNGdW5jdGlvbmAgaWYgYXBwcm9wcmlhdGUuCiAgaWYgKHR5cGVvZiAoLy4vKSAhPT0gJ2Z1bmN0aW9uJykgewogICAgXy5pc0Z1bmN0aW9uID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnZnVuY3Rpb24nOwogICAgfTsKICB9CgogIC8vIElzIGEgZ2l2ZW4gb2JqZWN0IGEgZmluaXRlIG51bWJlcj8KICBfLmlzRmluaXRlID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gaXNGaW5pdGUob2JqKSAmJiAhaXNOYU4ocGFyc2VGbG9hdChvYmopKTsKICB9OwoKICAvLyBJcyB0aGUgZ2l2ZW4gdmFsdWUgYE5hTmA/IChOYU4gaXMgdGhlIG9ubHkgbnVtYmVyIHdoaWNoIGRvZXMgbm90IGVxdWFsIGl0c2VsZikuCiAgXy5pc05hTiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8uaXNOdW1iZXIob2JqKSAmJiBvYmogIT0gK29iajsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgYm9vbGVhbj8KICBfLmlzQm9vbGVhbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlIHx8IHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBCb29sZWFuXSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBlcXVhbCB0byBudWxsPwogIF8uaXNOdWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSBudWxsOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgdW5kZWZpbmVkPwogIF8uaXNVbmRlZmluZWQgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IHZvaWQgMDsKICB9OwoKICAvLyBTaG9ydGN1dCBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHByb3BlcnR5IGRpcmVjdGx5CiAgLy8gb24gaXRzZWxmIChpbiBvdGhlciB3b3Jkcywgbm90IG9uIGEgcHJvdG90eXBlKS4KICBfLmhhcyA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7CiAgfTsKCiAgLy8gVXRpbGl0eSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSdW4gVW5kZXJzY29yZS5qcyBpbiAqbm9Db25mbGljdCogbW9kZSwgcmV0dXJuaW5nIHRoZSBgX2AgdmFyaWFibGUgdG8gaXRzCiAgLy8gcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgcm9vdC5fID0gcHJldmlvdXNVbmRlcnNjb3JlOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gS2VlcCB0aGUgaWRlbnRpdHkgZnVuY3Rpb24gYXJvdW5kIGZvciBkZWZhdWx0IGl0ZXJhdG9ycy4KICBfLmlkZW50aXR5ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9OwoKICBfLmNvbnN0YW50ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgfTsKCiAgXy5wcm9wZXJ0eSA9IGZ1bmN0aW9uKGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gb2JqW2tleV07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBwcmVkaWNhdGUgZm9yIGNoZWNraW5nIHdoZXRoZXIgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHNldCBvZiBga2V5OnZhbHVlYCBwYWlycy4KICBfLm1hdGNoZXMgPSBmdW5jdGlvbihhdHRycykgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICBpZiAob2JqID09PSBhdHRycykgcmV0dXJuIHRydWU7IC8vYXZvaWQgY29tcGFyaW5nIGFuIG9iamVjdCB0byBpdHNlbGYuCiAgICAgIGZvciAodmFyIGtleSBpbiBhdHRycykgewogICAgICAgIGlmIChhdHRyc1trZXldICE9PSBvYmpba2V5XSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9OwoKICAvLyBSdW4gYSBmdW5jdGlvbiAqKm4qKiB0aW1lcy4KICBfLnRpbWVzID0gZnVuY3Rpb24obiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciBhY2N1bSA9IEFycmF5KE1hdGgubWF4KDAsIG4pKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSBhY2N1bVtpXSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgaSk7CiAgICByZXR1cm4gYWNjdW07CiAgfTsKCiAgLy8gUmV0dXJuIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gYW5kIG1heCAoaW5jbHVzaXZlKS4KICBfLnJhbmRvbSA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7CiAgICBpZiAobWF4ID09IG51bGwpIHsKICAgICAgbWF4ID0gbWluOwogICAgICBtaW4gPSAwOwogICAgfQogICAgcmV0dXJuIG1pbiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSk7CiAgfTsKCiAgLy8gQSAocG9zc2libHkgZmFzdGVyKSB3YXkgdG8gZ2V0IHRoZSBjdXJyZW50IHRpbWVzdGFtcCBhcyBhbiBpbnRlZ2VyLgogIF8ubm93ID0gRGF0ZS5ub3cgfHwgZnVuY3Rpb24oKSB7IHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgfTsKCiAgLy8gTGlzdCBvZiBIVE1MIGVudGl0aWVzIGZvciBlc2NhcGluZy4KICB2YXIgZW50aXR5TWFwID0gewogICAgZXNjYXBlOiB7CiAgICAgICcmJzogJyZhbXA7JywKICAgICAgJzwnOiAnJmx0OycsCiAgICAgICc+JzogJyZndDsnLAogICAgICAnIic6ICcmcXVvdDsnLAogICAgICAiJyI6ICcmI3gyNzsnCiAgICB9CiAgfTsKICBlbnRpdHlNYXAudW5lc2NhcGUgPSBfLmludmVydChlbnRpdHlNYXAuZXNjYXBlKTsKCiAgLy8gUmVnZXhlcyBjb250YWluaW5nIHRoZSBrZXlzIGFuZCB2YWx1ZXMgbGlzdGVkIGltbWVkaWF0ZWx5IGFib3ZlLgogIHZhciBlbnRpdHlSZWdleGVzID0gewogICAgZXNjYXBlOiAgIG5ldyBSZWdFeHAoJ1snICsgXy5rZXlzKGVudGl0eU1hcC5lc2NhcGUpLmpvaW4oJycpICsgJ10nLCAnZycpLAogICAgdW5lc2NhcGU6IG5ldyBSZWdFeHAoJygnICsgXy5rZXlzKGVudGl0eU1hcC51bmVzY2FwZSkuam9pbignfCcpICsgJyknLCAnZycpCiAgfTsKCiAgLy8gRnVuY3Rpb25zIGZvciBlc2NhcGluZyBhbmQgdW5lc2NhcGluZyBzdHJpbmdzIHRvL2Zyb20gSFRNTCBpbnRlcnBvbGF0aW9uLgogIF8uZWFjaChbJ2VzY2FwZScsICd1bmVzY2FwZSddLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIF9bbWV0aG9kXSA9IGZ1bmN0aW9uKHN0cmluZykgewogICAgICBpZiAoc3RyaW5nID09IG51bGwpIHJldHVybiAnJzsKICAgICAgcmV0dXJuICgnJyArIHN0cmluZykucmVwbGFjZShlbnRpdHlSZWdleGVzW21ldGhvZF0sIGZ1bmN0aW9uKG1hdGNoKSB7CiAgICAgICAgcmV0dXJuIGVudGl0eU1hcFttZXRob2RdW21hdGNoXTsKICAgICAgfSk7CiAgICB9OwogIH0pOwoKICAvLyBJZiB0aGUgdmFsdWUgb2YgdGhlIG5hbWVkIGBwcm9wZXJ0eWAgaXMgYSBmdW5jdGlvbiB0aGVuIGludm9rZSBpdCB3aXRoIHRoZQogIC8vIGBvYmplY3RgIGFzIGNvbnRleHQ7IG90aGVyd2lzZSwgcmV0dXJuIGl0LgogIF8ucmVzdWx0ID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgewogICAgaWYgKG9iamVjdCA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgdmFyIHZhbHVlID0gb2JqZWN0W3Byb3BlcnR5XTsKICAgIHJldHVybiBfLmlzRnVuY3Rpb24odmFsdWUpID8gdmFsdWUuY2FsbChvYmplY3QpIDogdmFsdWU7CiAgfTsKCiAgLy8gQWRkIHlvdXIgb3duIGN1c3RvbSBmdW5jdGlvbnMgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubWl4aW4gPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goXy5mdW5jdGlvbnMob2JqKSwgZnVuY3Rpb24obmFtZSkgewogICAgICB2YXIgZnVuYyA9IF9bbmFtZV0gPSBvYmpbbmFtZV07CiAgICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy5fd3JhcHBlZF07CiAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBmdW5jLmFwcGx5KF8sIGFyZ3MpKTsKICAgICAgfTsKICAgIH0pOwogIH07CgogIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuCiAgLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy4KICB2YXIgaWRDb3VudGVyID0gMDsKICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7CiAgICB2YXIgaWQgPSArK2lkQ291bnRlciArICcnOwogICAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7CiAgfTsKCiAgLy8gQnkgZGVmYXVsdCwgVW5kZXJzY29yZSB1c2VzIEVSQi1zdHlsZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLCBjaGFuZ2UgdGhlCiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLgogIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgIGV2YWx1YXRlICAgIDogLzwlKFtcc1xTXSs/KSU+L2csCiAgICBpbnRlcnBvbGF0ZSA6IC88JT0oW1xzXFNdKz8pJT4vZywKICAgIGVzY2FwZSAgICAgIDogLzwlLShbXHNcU10rPyklPi9nCiAgfTsKCiAgLy8gV2hlbiBjdXN0b21pemluZyBgdGVtcGxhdGVTZXR0aW5nc2AsIGlmIHlvdSBkb24ndCB3YW50IHRvIGRlZmluZSBhbgogIC8vIGludGVycG9sYXRpb24sIGV2YWx1YXRpb24gb3IgZXNjYXBpbmcgcmVnZXgsIHdlIG5lZWQgb25lIHRoYXQgaXMKICAvLyBndWFyYW50ZWVkIG5vdCB0byBtYXRjaC4KICB2YXIgbm9NYXRjaCA9IC8oLileLzsKCiAgLy8gQ2VydGFpbiBjaGFyYWN0ZXJzIG5lZWQgdG8gYmUgZXNjYXBlZCBzbyB0aGF0IHRoZXkgY2FuIGJlIHB1dCBpbnRvIGEKICAvLyBzdHJpbmcgbGl0ZXJhbC4KICB2YXIgZXNjYXBlcyA9IHsKICAgICInIjogICAgICAiJyIsCiAgICAnXFwnOiAgICAgJ1xcJywKICAgICdccic6ICAgICAncicsCiAgICAnXG4nOiAgICAgJ24nLAogICAgJ1x0JzogICAgICd0JywKICAgICdcdTIwMjgnOiAndTIwMjgnLAogICAgJ1x1MjAyOSc6ICd1MjAyOScKICB9OwoKICB2YXIgZXNjYXBlciA9IC9cXHwnfFxyfFxufFx0fFx1MjAyOHxcdTIwMjkvZzsKCiAgLy8gSmF2YVNjcmlwdCBtaWNyby10ZW1wbGF0aW5nLCBzaW1pbGFyIHRvIEpvaG4gUmVzaWcncyBpbXBsZW1lbnRhdGlvbi4KICAvLyBVbmRlcnNjb3JlIHRlbXBsYXRpbmcgaGFuZGxlcyBhcmJpdHJhcnkgZGVsaW1pdGVycywgcHJlc2VydmVzIHdoaXRlc3BhY2UsCiAgLy8gYW5kIGNvcnJlY3RseSBlc2NhcGVzIHF1b3RlcyB3aXRoaW4gaW50ZXJwb2xhdGVkIGNvZGUuCiAgXy50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHRleHQsIGRhdGEsIHNldHRpbmdzKSB7CiAgICB2YXIgcmVuZGVyOwogICAgc2V0dGluZ3MgPSBfLmRlZmF1bHRzKHt9LCBzZXR0aW5ncywgXy50ZW1wbGF0ZVNldHRpbmdzKTsKCiAgICAvLyBDb21iaW5lIGRlbGltaXRlcnMgaW50byBvbmUgcmVndWxhciBleHByZXNzaW9uIHZpYSBhbHRlcm5hdGlvbi4KICAgIHZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cChbCiAgICAgIChzZXR0aW5ncy5lc2NhcGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuaW50ZXJwb2xhdGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuZXZhbHVhdGUgfHwgbm9NYXRjaCkuc291cmNlCiAgICBdLmpvaW4oJ3wnKSArICd8JCcsICdnJyk7CgogICAgLy8gQ29tcGlsZSB0aGUgdGVtcGxhdGUgc291cmNlLCBlc2NhcGluZyBzdHJpbmcgbGl0ZXJhbHMgYXBwcm9wcmlhdGVseS4KICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc291cmNlID0gIl9fcCs9JyI7CiAgICB0ZXh0LnJlcGxhY2UobWF0Y2hlciwgZnVuY3Rpb24obWF0Y2gsIGVzY2FwZSwgaW50ZXJwb2xhdGUsIGV2YWx1YXRlLCBvZmZzZXQpIHsKICAgICAgc291cmNlICs9IHRleHQuc2xpY2UoaW5kZXgsIG9mZnNldCkKICAgICAgICAucmVwbGFjZShlc2NhcGVyLCBmdW5jdGlvbihtYXRjaCkgeyByZXR1cm4gJ1xcJyArIGVzY2FwZXNbbWF0Y2hdOyB9KTsKCiAgICAgIGlmIChlc2NhcGUpIHsKICAgICAgICBzb3VyY2UgKz0gIicrXG4oKF9fdD0oIiArIGVzY2FwZSArICIpKT09bnVsbD8nJzpfLmVzY2FwZShfX3QpKStcbiciOwogICAgICB9CiAgICAgIGlmIChpbnRlcnBvbGF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJytcbigoX190PSgiICsgaW50ZXJwb2xhdGUgKyAiKSk9PW51bGw/Jyc6X190KStcbiciOwogICAgICB9CiAgICAgIGlmIChldmFsdWF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJztcbiIgKyBldmFsdWF0ZSArICJcbl9fcCs9JyI7CiAgICAgIH0KICAgICAgaW5kZXggPSBvZmZzZXQgKyBtYXRjaC5sZW5ndGg7CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0pOwogICAgc291cmNlICs9ICInO1xuIjsKCiAgICAvLyBJZiBhIHZhcmlhYmxlIGlzIG5vdCBzcGVjaWZpZWQsIHBsYWNlIGRhdGEgdmFsdWVzIGluIGxvY2FsIHNjb3BlLgogICAgaWYgKCFzZXR0aW5ncy52YXJpYWJsZSkgc291cmNlID0gJ3dpdGgob2JqfHx7fSl7XG4nICsgc291cmNlICsgJ31cbic7CgogICAgc291cmNlID0gInZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbiwiICsKICAgICAgInByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307XG4iICsKICAgICAgc291cmNlICsgInJldHVybiBfX3A7XG4iOwoKICAgIHRyeSB7CiAgICAgIHJlbmRlciA9IG5ldyBGdW5jdGlvbihzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJywgJ18nLCBzb3VyY2UpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBlLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgdGhyb3cgZTsKICAgIH0KCiAgICBpZiAoZGF0YSkgcmV0dXJuIHJlbmRlcihkYXRhLCBfKTsKICAgIHZhciB0ZW1wbGF0ZSA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgcmV0dXJuIHJlbmRlci5jYWxsKHRoaXMsIGRhdGEsIF8pOwogICAgfTsKCiAgICAvLyBQcm92aWRlIHRoZSBjb21waWxlZCBmdW5jdGlvbiBzb3VyY2UgYXMgYSBjb252ZW5pZW5jZSBmb3IgcHJlY29tcGlsYXRpb24uCiAgICB0ZW1wbGF0ZS5zb3VyY2UgPSAnZnVuY3Rpb24oJyArIChzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJykgKyAnKXtcbicgKyBzb3VyY2UgKyAnfSc7CgogICAgcmV0dXJuIHRlbXBsYXRlOwogIH07CgogIC8vIEFkZCBhICJjaGFpbiIgZnVuY3Rpb24sIHdoaWNoIHdpbGwgZGVsZWdhdGUgdG8gdGhlIHdyYXBwZXIuCiAgXy5jaGFpbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8ob2JqKS5jaGFpbigpOwogIH07CgogIC8vIE9PUAogIC8vIC0tLS0tLS0tLS0tLS0tLQogIC8vIElmIFVuZGVyc2NvcmUgaXMgY2FsbGVkIGFzIGEgZnVuY3Rpb24sIGl0IHJldHVybnMgYSB3cmFwcGVkIG9iamVjdCB0aGF0CiAgLy8gY2FuIGJlIHVzZWQgT08tc3R5bGUuIFRoaXMgd3JhcHBlciBob2xkcyBhbHRlcmVkIHZlcnNpb25zIG9mIGFsbCB0aGUKICAvLyB1bmRlcnNjb3JlIGZ1bmN0aW9ucy4gV3JhcHBlZCBvYmplY3RzIG1heSBiZSBjaGFpbmVkLgoKICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29udGludWUgY2hhaW5pbmcgaW50ZXJtZWRpYXRlIHJlc3VsdHMuCiAgdmFyIHJlc3VsdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRoaXMuX2NoYWluID8gXyhvYmopLmNoYWluKCkgOiBvYmo7CiAgfTsKCiAgLy8gQWRkIGFsbCBvZiB0aGUgVW5kZXJzY29yZSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIgb2JqZWN0LgogIF8ubWl4aW4oXyk7CgogIC8vIEFkZCBhbGwgbXV0YXRvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuCiAgZWFjaChbJ3BvcCcsICdwdXNoJywgJ3JldmVyc2UnLCAnc2hpZnQnLCAnc29ydCcsICdzcGxpY2UnLCAndW5zaGlmdCddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBvYmogPSB0aGlzLl93cmFwcGVkOwogICAgICBtZXRob2QuYXBwbHkob2JqLCBhcmd1bWVudHMpOwogICAgICBpZiAoKG5hbWUgPT0gJ3NoaWZ0JyB8fCBuYW1lID09ICdzcGxpY2UnKSAmJiBvYmoubGVuZ3RoID09PSAwKSBkZWxldGUgb2JqWzBdOwogICAgICByZXR1cm4gcmVzdWx0LmNhbGwodGhpcywgb2JqKTsKICAgIH07CiAgfSk7CgogIC8vIEFkZCBhbGwgYWNjZXNzb3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLgogIGVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBtZXRob2QuYXBwbHkodGhpcy5fd3JhcHBlZCwgYXJndW1lbnRzKSk7CiAgICB9OwogIH0pOwoKICBfLmV4dGVuZChfLnByb3RvdHlwZSwgewoKICAgIC8vIFN0YXJ0IGNoYWluaW5nIGEgd3JhcHBlZCBVbmRlcnNjb3JlIG9iamVjdC4KICAgIGNoYWluOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5fY2hhaW4gPSB0cnVlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuCiAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl93cmFwcGVkOwogICAgfQoKICB9KTsKCiAgLy8gQU1EIHJlZ2lzdHJhdGlvbiBoYXBwZW5zIGF0IHRoZSBlbmQgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBBTUQgbG9hZGVycwogIC8vIHRoYXQgbWF5IG5vdCBlbmZvcmNlIG5leHQtdHVybiBzZW1hbnRpY3Mgb24gbW9kdWxlcy4gRXZlbiB0aG91Z2ggZ2VuZXJhbAogIC8vIHByYWN0aWNlIGZvciBBTUQgcmVnaXN0cmF0aW9uIGlzIHRvIGJlIGFub255bW91cywgdW5kZXJzY29yZSByZWdpc3RlcnMKICAvLyBhcyBhIG5hbWVkIG1vZHVsZSBiZWNhdXNlLCBsaWtlIGpRdWVyeSwgaXQgaXMgYSBiYXNlIGxpYnJhcnkgdGhhdCBpcwogIC8vIHBvcHVsYXIgZW5vdWdoIHRvIGJlIGJ1bmRsZWQgaW4gYSB0aGlyZCBwYXJ0eSBsaWIsIGJ1dCBub3QgYmUgcGFydCBvZgogIC8vIGFuIEFNRCBsb2FkIHJlcXVlc3QuIFRob3NlIGNhc2VzIGNvdWxkIGdlbmVyYXRlIGFuIGVycm9yIHdoZW4gYW4KICAvLyBhbm9ueW1vdXMgZGVmaW5lKCkgaXMgY2FsbGVkIG91dHNpZGUgb2YgYSBsb2FkZXIgcmVxdWVzdC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ3VuZGVyc2NvcmUnLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfOwogICAgfSk7CiAgfQp9KS5jYWxsKHRoaXMpOwoKLyoqCiAqIGEgc2luZ2xldG9uIG9iamVjdCB0aGF0IHdpbGwgaGFuZGxlIGdsb2JhbCBzY29wZSBjb25maWd1cmF0aW9uIChwYXRoIHRvIHdldCBpbmZvIHJlc3Qgc2VydmljZSBldGMuLikKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnQ29uZmlnJyxbJ3VuZGVyc2NvcmUnXSwgZnVuY3Rpb24gKF8pIHsKICAgIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgICAgICBpbnRlcnBvbGF0ZTogL1x7XHsoLis/KVx9XH0vZwogICAgfTsKCiAgICBDb25maWcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYuZGF0YSA9IHt9CiAgICB9CiAgICBDb25maWcucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIENvbmZpZy5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiB0aGlzLmRhdGFba2V5XTsKICAgIH0KCiAgICByZXR1cm4gbmV3IENvbmZpZygpOwp9KTsKCi8vICAgICBCYWNrYm9uZS5qcyAxLjEuMgoKLy8gICAgIChjKSAyMDEwLTIwMTQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKLy8gICAgIEJhY2tib25lIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgovLyAgICAgRm9yIGFsbCBkZXRhaWxzIGFuZCBkb2N1bWVudGF0aW9uOgovLyAgICAgaHR0cDovL2JhY2tib25lanMub3JnCgooZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkgewoKICAvLyBTZXQgdXAgQmFja2JvbmUgYXBwcm9wcmlhdGVseSBmb3IgdGhlIGVudmlyb25tZW50LiBTdGFydCB3aXRoIEFNRC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ0JhY2tib25lJyxbJ3VuZGVyc2NvcmUnLCAnanF1ZXJ5JywgJ2V4cG9ydHMnXSwgZnVuY3Rpb24oXywgJCwgZXhwb3J0cykgewogICAgICAvLyBFeHBvcnQgZ2xvYmFsIGV2ZW4gaW4gQU1EIGNhc2UgaW4gY2FzZSB0aGlzIHNjcmlwdCBpcyBsb2FkZWQgd2l0aAogICAgICAvLyBvdGhlcnMgdGhhdCBtYXkgc3RpbGwgZXhwZWN0IGEgZ2xvYmFsIEJhY2tib25lLgogICAgICByb290LkJhY2tib25lID0gZmFjdG9yeShyb290LCBleHBvcnRzLCBfLCAkKTsKICAgIH0pOwoKICAvLyBOZXh0IGZvciBOb2RlLmpzIG9yIENvbW1vbkpTLiBqUXVlcnkgbWF5IG5vdCBiZSBuZWVkZWQgYXMgYSBtb2R1bGUuCiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIHZhciBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpOwogICAgZmFjdG9yeShyb290LCBleHBvcnRzLCBfKTsKCiAgLy8gRmluYWxseSwgYXMgYSBicm93c2VyIGdsb2JhbC4KICB9IGVsc2UgewogICAgcm9vdC5CYWNrYm9uZSA9IGZhY3Rvcnkocm9vdCwge30sIHJvb3QuXywgKHJvb3QualF1ZXJ5IHx8IHJvb3QuWmVwdG8gfHwgcm9vdC5lbmRlciB8fCByb290LiQpKTsKICB9Cgp9KHRoaXMsIGZ1bmN0aW9uKHJvb3QsIEJhY2tib25lLCBfLCAkKSB7CgogIC8vIEluaXRpYWwgU2V0dXAKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgQmFja2JvbmVgIHZhcmlhYmxlLCBzbyB0aGF0IGl0IGNhbiBiZQogIC8vIHJlc3RvcmVkIGxhdGVyIG9uLCBpZiBgbm9Db25mbGljdGAgaXMgdXNlZC4KICB2YXIgcHJldmlvdXNCYWNrYm9uZSA9IHJvb3QuQmFja2JvbmU7CgogIC8vIENyZWF0ZSBsb2NhbCByZWZlcmVuY2VzIHRvIGFycmF5IG1ldGhvZHMgd2UnbGwgd2FudCB0byB1c2UgbGF0ZXIuCiAgdmFyIGFycmF5ID0gW107CiAgdmFyIHB1c2ggPSBhcnJheS5wdXNoOwogIHZhciBzbGljZSA9IGFycmF5LnNsaWNlOwogIHZhciBzcGxpY2UgPSBhcnJheS5zcGxpY2U7CgogIC8vIEN1cnJlbnQgdmVyc2lvbiBvZiB0aGUgbGlicmFyeS4gS2VlcCBpbiBzeW5jIHdpdGggYHBhY2thZ2UuanNvbmAuCiAgQmFja2JvbmUuVkVSU0lPTiA9ICcxLjEuMic7CgogIC8vIEZvciBCYWNrYm9uZSdzIHB1cnBvc2VzLCBqUXVlcnksIFplcHRvLCBFbmRlciwgb3IgTXkgTGlicmFyeSAoa2lkZGluZykgb3ducwogIC8vIHRoZSBgJGAgdmFyaWFibGUuCiAgQmFja2JvbmUuJCA9ICQ7CgogIC8vIFJ1bnMgQmFja2JvbmUuanMgaW4gKm5vQ29uZmxpY3QqIG1vZGUsIHJldHVybmluZyB0aGUgYEJhY2tib25lYCB2YXJpYWJsZQogIC8vIHRvIGl0cyBwcmV2aW91cyBvd25lci4gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGlzIEJhY2tib25lIG9iamVjdC4KICBCYWNrYm9uZS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICByb290LkJhY2tib25lID0gcHJldmlvdXNCYWNrYm9uZTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIC8vIFR1cm4gb24gYGVtdWxhdGVIVFRQYCB0byBzdXBwb3J0IGxlZ2FjeSBIVFRQIHNlcnZlcnMuIFNldHRpbmcgdGhpcyBvcHRpb24KICAvLyB3aWxsIGZha2UgYCJQQVRDSCJgLCBgIlBVVCJgIGFuZCBgIkRFTEVURSJgIHJlcXVlc3RzIHZpYSB0aGUgYF9tZXRob2RgIHBhcmFtZXRlciBhbmQKICAvLyBzZXQgYSBgWC1IdHRwLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgogIEJhY2tib25lLmVtdWxhdGVIVFRQID0gZmFsc2U7CgogIC8vIFR1cm4gb24gYGVtdWxhdGVKU09OYCB0byBzdXBwb3J0IGxlZ2FjeSBzZXJ2ZXJzIHRoYXQgY2FuJ3QgZGVhbCB3aXRoIGRpcmVjdAogIC8vIGBhcHBsaWNhdGlvbi9qc29uYCByZXF1ZXN0cyAuLi4gd2lsbCBlbmNvZGUgdGhlIGJvZHkgYXMKICAvLyBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYCBpbnN0ZWFkIGFuZCB3aWxsIHNlbmQgdGhlIG1vZGVsIGluIGEKICAvLyBmb3JtIHBhcmFtIG5hbWVkIGBtb2RlbGAuCiAgQmFja2JvbmUuZW11bGF0ZUpTT04gPSBmYWxzZTsKCiAgLy8gQmFja2JvbmUuRXZlbnRzCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIEEgbW9kdWxlIHRoYXQgY2FuIGJlIG1peGVkIGluIHRvICphbnkgb2JqZWN0KiBpbiBvcmRlciB0byBwcm92aWRlIGl0IHdpdGgKICAvLyBjdXN0b20gZXZlbnRzLiBZb3UgbWF5IGJpbmQgd2l0aCBgb25gIG9yIHJlbW92ZSB3aXRoIGBvZmZgIGNhbGxiYWNrCiAgLy8gZnVuY3Rpb25zIHRvIGFuIGV2ZW50OyBgdHJpZ2dlcmAtaW5nIGFuIGV2ZW50IGZpcmVzIGFsbCBjYWxsYmFja3MgaW4KICAvLyBzdWNjZXNzaW9uLgogIC8vCiAgLy8gICAgIHZhciBvYmplY3QgPSB7fTsKICAvLyAgICAgXy5leHRlbmQob2JqZWN0LCBCYWNrYm9uZS5FdmVudHMpOwogIC8vICAgICBvYmplY3Qub24oJ2V4cGFuZCcsIGZ1bmN0aW9uKCl7IGFsZXJ0KCdleHBhbmRlZCcpOyB9KTsKICAvLyAgICAgb2JqZWN0LnRyaWdnZXIoJ2V4cGFuZCcpOwogIC8vCiAgdmFyIEV2ZW50cyA9IEJhY2tib25lLkV2ZW50cyA9IHsKCiAgICAvLyBCaW5kIGFuIGV2ZW50IHRvIGEgYGNhbGxiYWNrYCBmdW5jdGlvbi4gUGFzc2luZyBgImFsbCJgIHdpbGwgYmluZAogICAgLy8gdGhlIGNhbGxiYWNrIHRvIGFsbCBldmVudHMgZmlyZWQuCiAgICBvbjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgaWYgKCFldmVudHNBcGkodGhpcywgJ29uJywgbmFtZSwgW2NhbGxiYWNrLCBjb250ZXh0XSkgfHwgIWNhbGxiYWNrKSByZXR1cm4gdGhpczsKICAgICAgdGhpcy5fZXZlbnRzIHx8ICh0aGlzLl9ldmVudHMgPSB7fSk7CiAgICAgIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHNbbmFtZV0gfHwgKHRoaXMuX2V2ZW50c1tuYW1lXSA9IFtdKTsKICAgICAgZXZlbnRzLnB1c2goe2NhbGxiYWNrOiBjYWxsYmFjaywgY29udGV4dDogY29udGV4dCwgY3R4OiBjb250ZXh0IHx8IHRoaXN9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIEJpbmQgYW4gZXZlbnQgdG8gb25seSBiZSB0cmlnZ2VyZWQgYSBzaW5nbGUgdGltZS4gQWZ0ZXIgdGhlIGZpcnN0IHRpbWUKICAgIC8vIHRoZSBjYWxsYmFjayBpcyBpbnZva2VkLCBpdCB3aWxsIGJlIHJlbW92ZWQuCiAgICBvbmNlOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgY29udGV4dCkgewogICAgICBpZiAoIWV2ZW50c0FwaSh0aGlzLCAnb25jZScsIG5hbWUsIFtjYWxsYmFjaywgY29udGV4dF0pIHx8ICFjYWxsYmFjaykgcmV0dXJuIHRoaXM7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIG9uY2UgPSBfLm9uY2UoZnVuY3Rpb24oKSB7CiAgICAgICAgc2VsZi5vZmYobmFtZSwgb25jZSk7CiAgICAgICAgY2FsbGJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfSk7CiAgICAgIG9uY2UuX2NhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0aGlzLm9uKG5hbWUsIG9uY2UsIGNvbnRleHQpOwogICAgfSwKCiAgICAvLyBSZW1vdmUgb25lIG9yIG1hbnkgY2FsbGJhY2tzLiBJZiBgY29udGV4dGAgaXMgbnVsbCwgcmVtb3ZlcyBhbGwKICAgIC8vIGNhbGxiYWNrcyB3aXRoIHRoYXQgZnVuY3Rpb24uIElmIGBjYWxsYmFja2AgaXMgbnVsbCwgcmVtb3ZlcyBhbGwKICAgIC8vIGNhbGxiYWNrcyBmb3IgdGhlIGV2ZW50LiBJZiBgbmFtZWAgaXMgbnVsbCwgcmVtb3ZlcyBhbGwgYm91bmQKICAgIC8vIGNhbGxiYWNrcyBmb3IgYWxsIGV2ZW50cy4KICAgIG9mZjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgdmFyIHJldGFpbiwgZXYsIGV2ZW50cywgbmFtZXMsIGksIGwsIGosIGs7CiAgICAgIGlmICghdGhpcy5fZXZlbnRzIHx8ICFldmVudHNBcGkodGhpcywgJ29mZicsIG5hbWUsIFtjYWxsYmFjaywgY29udGV4dF0pKSByZXR1cm4gdGhpczsKICAgICAgaWYgKCFuYW1lICYmICFjYWxsYmFjayAmJiAhY29udGV4dCkgewogICAgICAgIHRoaXMuX2V2ZW50cyA9IHZvaWQgMDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBuYW1lcyA9IG5hbWUgPyBbbmFtZV0gOiBfLmtleXModGhpcy5fZXZlbnRzKTsKICAgICAgZm9yIChpID0gMCwgbCA9IG5hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG5hbWUgPSBuYW1lc1tpXTsKICAgICAgICBpZiAoZXZlbnRzID0gdGhpcy5fZXZlbnRzW25hbWVdKSB7CiAgICAgICAgICB0aGlzLl9ldmVudHNbbmFtZV0gPSByZXRhaW4gPSBbXTsKICAgICAgICAgIGlmIChjYWxsYmFjayB8fCBjb250ZXh0KSB7CiAgICAgICAgICAgIGZvciAoaiA9IDAsIGsgPSBldmVudHMubGVuZ3RoOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgICAgZXYgPSBldmVudHNbal07CiAgICAgICAgICAgICAgaWYgKChjYWxsYmFjayAmJiBjYWxsYmFjayAhPT0gZXYuY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT09IGV2LmNhbGxiYWNrLl9jYWxsYmFjaykgfHwKICAgICAgICAgICAgICAgICAgKGNvbnRleHQgJiYgY29udGV4dCAhPT0gZXYuY29udGV4dCkpIHsKICAgICAgICAgICAgICAgIHJldGFpbi5wdXNoKGV2KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICghcmV0YWluLmxlbmd0aCkgZGVsZXRlIHRoaXMuX2V2ZW50c1tuYW1lXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBUcmlnZ2VyIG9uZSBvciBtYW55IGV2ZW50cywgZmlyaW5nIGFsbCBib3VuZCBjYWxsYmFja3MuIENhbGxiYWNrcyBhcmUKICAgIC8vIHBhc3NlZCB0aGUgc2FtZSBhcmd1bWVudHMgYXMgYHRyaWdnZXJgIGlzLCBhcGFydCBmcm9tIHRoZSBldmVudCBuYW1lCiAgICAvLyAodW5sZXNzIHlvdSdyZSBsaXN0ZW5pbmcgb24gYCJhbGwiYCwgd2hpY2ggd2lsbCBjYXVzZSB5b3VyIGNhbGxiYWNrIHRvCiAgICAvLyByZWNlaXZlIHRoZSB0cnVlIG5hbWUgb2YgdGhlIGV2ZW50IGFzIHRoZSBmaXJzdCBhcmd1bWVudCkuCiAgICB0cmlnZ2VyOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIGlmICghdGhpcy5fZXZlbnRzKSByZXR1cm4gdGhpczsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgIGlmICghZXZlbnRzQXBpKHRoaXMsICd0cmlnZ2VyJywgbmFtZSwgYXJncykpIHJldHVybiB0aGlzOwogICAgICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzW25hbWVdOwogICAgICB2YXIgYWxsRXZlbnRzID0gdGhpcy5fZXZlbnRzLmFsbDsKICAgICAgaWYgKGV2ZW50cykgdHJpZ2dlckV2ZW50cyhldmVudHMsIGFyZ3MpOwogICAgICBpZiAoYWxsRXZlbnRzKSB0cmlnZ2VyRXZlbnRzKGFsbEV2ZW50cywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFRlbGwgdGhpcyBvYmplY3QgdG8gc3RvcCBsaXN0ZW5pbmcgdG8gZWl0aGVyIHNwZWNpZmljIGV2ZW50cyAuLi4gb3IKICAgIC8vIHRvIGV2ZXJ5IG9iamVjdCBpdCdzIGN1cnJlbnRseSBsaXN0ZW5pbmcgdG8uCiAgICBzdG9wTGlzdGVuaW5nOiBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBsaXN0ZW5pbmdUbyA9IHRoaXMuX2xpc3RlbmluZ1RvOwogICAgICBpZiAoIWxpc3RlbmluZ1RvKSByZXR1cm4gdGhpczsKICAgICAgdmFyIHJlbW92ZSA9ICFuYW1lICYmICFjYWxsYmFjazsKICAgICAgaWYgKCFjYWxsYmFjayAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIGNhbGxiYWNrID0gdGhpczsKICAgICAgaWYgKG9iaikgKGxpc3RlbmluZ1RvID0ge30pW29iai5fbGlzdGVuSWRdID0gb2JqOwogICAgICBmb3IgKHZhciBpZCBpbiBsaXN0ZW5pbmdUbykgewogICAgICAgIG9iaiA9IGxpc3RlbmluZ1RvW2lkXTsKICAgICAgICBvYmoub2ZmKG5hbWUsIGNhbGxiYWNrLCB0aGlzKTsKICAgICAgICBpZiAocmVtb3ZlIHx8IF8uaXNFbXB0eShvYmouX2V2ZW50cykpIGRlbGV0ZSB0aGlzLl9saXN0ZW5pbmdUb1tpZF07CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH07CgogIC8vIFJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VkIHRvIHNwbGl0IGV2ZW50IHN0cmluZ3MuCiAgdmFyIGV2ZW50U3BsaXR0ZXIgPSAvXHMrLzsKCiAgLy8gSW1wbGVtZW50IGZhbmN5IGZlYXR1cmVzIG9mIHRoZSBFdmVudHMgQVBJIHN1Y2ggYXMgbXVsdGlwbGUgZXZlbnQKICAvLyBuYW1lcyBgImNoYW5nZSBibHVyImAgYW5kIGpRdWVyeS1zdHlsZSBldmVudCBtYXBzIGB7Y2hhbmdlOiBhY3Rpb259YAogIC8vIGluIHRlcm1zIG9mIHRoZSBleGlzdGluZyBBUEkuCiAgdmFyIGV2ZW50c0FwaSA9IGZ1bmN0aW9uKG9iaiwgYWN0aW9uLCBuYW1lLCByZXN0KSB7CiAgICBpZiAoIW5hbWUpIHJldHVybiB0cnVlOwoKICAgIC8vIEhhbmRsZSBldmVudCBtYXBzLgogICAgaWYgKHR5cGVvZiBuYW1lID09PSAnb2JqZWN0JykgewogICAgICBmb3IgKHZhciBrZXkgaW4gbmFtZSkgewogICAgICAgIG9ialthY3Rpb25dLmFwcGx5KG9iaiwgW2tleSwgbmFtZVtrZXldXS5jb25jYXQocmVzdCkpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBIYW5kbGUgc3BhY2Ugc2VwYXJhdGVkIGV2ZW50IG5hbWVzLgogICAgaWYgKGV2ZW50U3BsaXR0ZXIudGVzdChuYW1lKSkgewogICAgICB2YXIgbmFtZXMgPSBuYW1lLnNwbGl0KGV2ZW50U3BsaXR0ZXIpOwogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG5hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG9ialthY3Rpb25dLmFwcGx5KG9iaiwgW25hbWVzW2ldXS5jb25jYXQocmVzdCkpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKICAvLyBBIGRpZmZpY3VsdC10by1iZWxpZXZlLCBidXQgb3B0aW1pemVkIGludGVybmFsIGRpc3BhdGNoIGZ1bmN0aW9uIGZvcgogIC8vIHRyaWdnZXJpbmcgZXZlbnRzLiBUcmllcyB0byBrZWVwIHRoZSB1c3VhbCBjYXNlcyBzcGVlZHkgKG1vc3QgaW50ZXJuYWwKICAvLyBCYWNrYm9uZSBldmVudHMgaGF2ZSAzIGFyZ3VtZW50cykuCiAgdmFyIHRyaWdnZXJFdmVudHMgPSBmdW5jdGlvbihldmVudHMsIGFyZ3MpIHsKICAgIHZhciBldiwgaSA9IC0xLCBsID0gZXZlbnRzLmxlbmd0aCwgYTEgPSBhcmdzWzBdLCBhMiA9IGFyZ3NbMV0sIGEzID0gYXJnc1syXTsKICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHsKICAgICAgY2FzZSAwOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCk7IHJldHVybjsKICAgICAgY2FzZSAxOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEpOyByZXR1cm47CiAgICAgIGNhc2UgMjogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suY2FsbChldi5jdHgsIGExLCBhMik7IHJldHVybjsKICAgICAgY2FzZSAzOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEsIGEyLCBhMyk7IHJldHVybjsKICAgICAgZGVmYXVsdDogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suYXBwbHkoZXYuY3R4LCBhcmdzKTsgcmV0dXJuOwogICAgfQogIH07CgogIHZhciBsaXN0ZW5NZXRob2RzID0ge2xpc3RlblRvOiAnb24nLCBsaXN0ZW5Ub09uY2U6ICdvbmNlJ307CgogIC8vIEludmVyc2lvbi1vZi1jb250cm9sIHZlcnNpb25zIG9mIGBvbmAgYW5kIGBvbmNlYC4gVGVsbCAqdGhpcyogb2JqZWN0IHRvCiAgLy8gbGlzdGVuIHRvIGFuIGV2ZW50IGluIGFub3RoZXIgb2JqZWN0IC4uLiBrZWVwaW5nIHRyYWNrIG9mIHdoYXQgaXQncwogIC8vIGxpc3RlbmluZyB0by4KICBfLmVhY2gobGlzdGVuTWV0aG9kcywgZnVuY3Rpb24oaW1wbGVtZW50YXRpb24sIG1ldGhvZCkgewogICAgRXZlbnRzW21ldGhvZF0gPSBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBsaXN0ZW5pbmdUbyA9IHRoaXMuX2xpc3RlbmluZ1RvIHx8ICh0aGlzLl9saXN0ZW5pbmdUbyA9IHt9KTsKICAgICAgdmFyIGlkID0gb2JqLl9saXN0ZW5JZCB8fCAob2JqLl9saXN0ZW5JZCA9IF8udW5pcXVlSWQoJ2wnKSk7CiAgICAgIGxpc3RlbmluZ1RvW2lkXSA9IG9iajsKICAgICAgaWYgKCFjYWxsYmFjayAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIGNhbGxiYWNrID0gdGhpczsKICAgICAgb2JqW2ltcGxlbWVudGF0aW9uXShuYW1lLCBjYWxsYmFjaywgdGhpcyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICB9KTsKCiAgLy8gQWxpYXNlcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgRXZlbnRzLmJpbmQgICA9IEV2ZW50cy5vbjsKICBFdmVudHMudW5iaW5kID0gRXZlbnRzLm9mZjsKCiAgLy8gQWxsb3cgdGhlIGBCYWNrYm9uZWAgb2JqZWN0IHRvIHNlcnZlIGFzIGEgZ2xvYmFsIGV2ZW50IGJ1cywgZm9yIGZvbGtzIHdobwogIC8vIHdhbnQgZ2xvYmFsICJwdWJzdWIiIGluIGEgY29udmVuaWVudCBwbGFjZS4KICBfLmV4dGVuZChCYWNrYm9uZSwgRXZlbnRzKTsKCiAgLy8gQmFja2JvbmUuTW9kZWwKICAvLyAtLS0tLS0tLS0tLS0tLQoKICAvLyBCYWNrYm9uZSAqKk1vZGVscyoqIGFyZSB0aGUgYmFzaWMgZGF0YSBvYmplY3QgaW4gdGhlIGZyYW1ld29yayAtLQogIC8vIGZyZXF1ZW50bHkgcmVwcmVzZW50aW5nIGEgcm93IGluIGEgdGFibGUgaW4gYSBkYXRhYmFzZSBvbiB5b3VyIHNlcnZlci4KICAvLyBBIGRpc2NyZXRlIGNodW5rIG9mIGRhdGEgYW5kIGEgYnVuY2ggb2YgdXNlZnVsLCByZWxhdGVkIG1ldGhvZHMgZm9yCiAgLy8gcGVyZm9ybWluZyBjb21wdXRhdGlvbnMgYW5kIHRyYW5zZm9ybWF0aW9ucyBvbiB0aGF0IGRhdGEuCgogIC8vIENyZWF0ZSBhIG5ldyBtb2RlbCB3aXRoIHRoZSBzcGVjaWZpZWQgYXR0cmlidXRlcy4gQSBjbGllbnQgaWQgKGBjaWRgKQogIC8vIGlzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGFuZCBhc3NpZ25lZCBmb3IgeW91LgogIHZhciBNb2RlbCA9IEJhY2tib25lLk1vZGVsID0gZnVuY3Rpb24oYXR0cmlidXRlcywgb3B0aW9ucykgewogICAgdmFyIGF0dHJzID0gYXR0cmlidXRlcyB8fCB7fTsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ2MnKTsKICAgIHRoaXMuYXR0cmlidXRlcyA9IHt9OwogICAgaWYgKG9wdGlvbnMuY29sbGVjdGlvbikgdGhpcy5jb2xsZWN0aW9uID0gb3B0aW9ucy5jb2xsZWN0aW9uOwogICAgaWYgKG9wdGlvbnMucGFyc2UpIGF0dHJzID0gdGhpcy5wYXJzZShhdHRycywgb3B0aW9ucykgfHwge307CiAgICBhdHRycyA9IF8uZGVmYXVsdHMoe30sIGF0dHJzLCBfLnJlc3VsdCh0aGlzLCAnZGVmYXVsdHMnKSk7CiAgICB0aGlzLnNldChhdHRycywgb3B0aW9ucyk7CiAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8vIEF0dGFjaCBhbGwgaW5oZXJpdGFibGUgbWV0aG9kcyB0byB0aGUgTW9kZWwgcHJvdG90eXBlLgogIF8uZXh0ZW5kKE1vZGVsLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gQSBoYXNoIG9mIGF0dHJpYnV0ZXMgd2hvc2UgY3VycmVudCBhbmQgcHJldmlvdXMgdmFsdWUgZGlmZmVyLgogICAgY2hhbmdlZDogbnVsbCwKCiAgICAvLyBUaGUgdmFsdWUgcmV0dXJuZWQgZHVyaW5nIHRoZSBsYXN0IGZhaWxlZCB2YWxpZGF0aW9uLgogICAgdmFsaWRhdGlvbkVycm9yOiBudWxsLAoKICAgIC8vIFRoZSBkZWZhdWx0IG5hbWUgZm9yIHRoZSBKU09OIGBpZGAgYXR0cmlidXRlIGlzIGAiaWQiYC4gTW9uZ29EQiBhbmQKICAgIC8vIENvdWNoREIgdXNlcnMgbWF5IHdhbnQgdG8gc2V0IHRoaXMgdG8gYCJfaWQiYC4KICAgIGlkQXR0cmlidXRlOiAnaWQnLAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gUmV0dXJuIGEgY29weSBvZiB0aGUgbW9kZWwncyBgYXR0cmlidXRlc2Agb2JqZWN0LgogICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIFByb3h5IGBCYWNrYm9uZS5zeW5jYCBieSBkZWZhdWx0IC0tIGJ1dCBvdmVycmlkZSB0aGlzIGlmIHlvdSBuZWVkCiAgICAvLyBjdXN0b20gc3luY2luZyBzZW1hbnRpY3MgZm9yICp0aGlzKiBwYXJ0aWN1bGFyIG1vZGVsLgogICAgc3luYzogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBCYWNrYm9uZS5zeW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgdmFsdWUgb2YgYW4gYXR0cmlidXRlLgogICAgZ2V0OiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXNbYXR0cl07CiAgICB9LAoKICAgIC8vIEdldCB0aGUgSFRNTC1lc2NhcGVkIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZS4KICAgIGVzY2FwZTogZnVuY3Rpb24oYXR0cikgewogICAgICByZXR1cm4gXy5lc2NhcGUodGhpcy5nZXQoYXR0cikpOwogICAgfSwKCiAgICAvLyBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXR0cmlidXRlIGNvbnRhaW5zIGEgdmFsdWUgdGhhdCBpcyBub3QgbnVsbAogICAgLy8gb3IgdW5kZWZpbmVkLgogICAgaGFzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmdldChhdHRyKSAhPSBudWxsOwogICAgfSwKCiAgICAvLyBTZXQgYSBoYXNoIG9mIG1vZGVsIGF0dHJpYnV0ZXMgb24gdGhlIG9iamVjdCwgZmlyaW5nIGAiY2hhbmdlImAuIFRoaXMgaXMKICAgIC8vIHRoZSBjb3JlIHByaW1pdGl2ZSBvcGVyYXRpb24gb2YgYSBtb2RlbCwgdXBkYXRpbmcgdGhlIGRhdGEgYW5kIG5vdGlmeWluZwogICAgLy8gYW55b25lIHdobyBuZWVkcyB0byBrbm93IGFib3V0IHRoZSBjaGFuZ2UgaW4gc3RhdGUuIFRoZSBoZWFydCBvZiB0aGUgYmVhc3QuCiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsLCBvcHRpb25zKSB7CiAgICAgIHZhciBhdHRyLCBhdHRycywgdW5zZXQsIGNoYW5nZXMsIHNpbGVudCwgY2hhbmdpbmcsIHByZXYsIGN1cnJlbnQ7CiAgICAgIGlmIChrZXkgPT0gbnVsbCkgcmV0dXJuIHRoaXM7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgYXR0cnMgPSBrZXk7CiAgICAgICAgb3B0aW9ucyA9IHZhbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAoYXR0cnMgPSB7fSlba2V5XSA9IHZhbDsKICAgICAgfQoKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIC8vIFJ1biB2YWxpZGF0aW9uLgogICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgLy8gRXh0cmFjdCBhdHRyaWJ1dGVzIGFuZCBvcHRpb25zLgogICAgICB1bnNldCAgICAgICAgICAgPSBvcHRpb25zLnVuc2V0OwogICAgICBzaWxlbnQgICAgICAgICAgPSBvcHRpb25zLnNpbGVudDsKICAgICAgY2hhbmdlcyAgICAgICAgID0gW107CiAgICAgIGNoYW5naW5nICAgICAgICA9IHRoaXMuX2NoYW5naW5nOwogICAgICB0aGlzLl9jaGFuZ2luZyAgPSB0cnVlOwoKICAgICAgaWYgKCFjaGFuZ2luZykgewogICAgICAgIHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA9IF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgICAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgICAgfQogICAgICBjdXJyZW50ID0gdGhpcy5hdHRyaWJ1dGVzLCBwcmV2ID0gdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzOwoKICAgICAgLy8gQ2hlY2sgZm9yIGNoYW5nZXMgb2YgYGlkYC4KICAgICAgaWYgKHRoaXMuaWRBdHRyaWJ1dGUgaW4gYXR0cnMpIHRoaXMuaWQgPSBhdHRyc1t0aGlzLmlkQXR0cmlidXRlXTsKCiAgICAgIC8vIEZvciBlYWNoIGBzZXRgIGF0dHJpYnV0ZSwgdXBkYXRlIG9yIGRlbGV0ZSB0aGUgY3VycmVudCB2YWx1ZS4KICAgICAgZm9yIChhdHRyIGluIGF0dHJzKSB7CiAgICAgICAgdmFsID0gYXR0cnNbYXR0cl07CiAgICAgICAgaWYgKCFfLmlzRXF1YWwoY3VycmVudFthdHRyXSwgdmFsKSkgY2hhbmdlcy5wdXNoKGF0dHIpOwogICAgICAgIGlmICghXy5pc0VxdWFsKHByZXZbYXR0cl0sIHZhbCkpIHsKICAgICAgICAgIHRoaXMuY2hhbmdlZFthdHRyXSA9IHZhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlIHRoaXMuY2hhbmdlZFthdHRyXTsKICAgICAgICB9CiAgICAgICAgdW5zZXQgPyBkZWxldGUgY3VycmVudFthdHRyXSA6IGN1cnJlbnRbYXR0cl0gPSB2YWw7CiAgICAgIH0KCiAgICAgIC8vIFRyaWdnZXIgYWxsIHJlbGV2YW50IGF0dHJpYnV0ZSBjaGFuZ2VzLgogICAgICBpZiAoIXNpbGVudCkgewogICAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCkgdGhpcy5fcGVuZGluZyA9IG9wdGlvbnM7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaGFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2U6JyArIGNoYW5nZXNbaV0sIHRoaXMsIGN1cnJlbnRbY2hhbmdlc1tpXV0sIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gWW91IG1pZ2h0IGJlIHdvbmRlcmluZyB3aHkgdGhlcmUncyBhIGB3aGlsZWAgbG9vcCBoZXJlLiBDaGFuZ2VzIGNhbgogICAgICAvLyBiZSByZWN1cnNpdmVseSBuZXN0ZWQgd2l0aGluIGAiY2hhbmdlImAgZXZlbnRzLgogICAgICBpZiAoY2hhbmdpbmcpIHJldHVybiB0aGlzOwogICAgICBpZiAoIXNpbGVudCkgewogICAgICAgIHdoaWxlICh0aGlzLl9wZW5kaW5nKSB7CiAgICAgICAgICBvcHRpb25zID0gdGhpcy5fcGVuZGluZzsKICAgICAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5fY2hhbmdpbmcgPSBmYWxzZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhbiBhdHRyaWJ1dGUgZnJvbSB0aGUgbW9kZWwsIGZpcmluZyBgImNoYW5nZSJgLiBgdW5zZXRgIGlzIGEgbm9vcAogICAgLy8gaWYgdGhlIGF0dHJpYnV0ZSBkb2Vzbid0IGV4aXN0LgogICAgdW5zZXQ6IGZ1bmN0aW9uKGF0dHIsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0KGF0dHIsIHZvaWQgMCwgXy5leHRlbmQoe30sIG9wdGlvbnMsIHt1bnNldDogdHJ1ZX0pKTsKICAgIH0sCgogICAgLy8gQ2xlYXIgYWxsIGF0dHJpYnV0ZXMgb24gdGhlIG1vZGVsLCBmaXJpbmcgYCJjaGFuZ2UiYC4KICAgIGNsZWFyOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBhdHRycyA9IHt9OwogICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5hdHRyaWJ1dGVzKSBhdHRyc1trZXldID0gdm9pZCAwOwogICAgICByZXR1cm4gdGhpcy5zZXQoYXR0cnMsIF8uZXh0ZW5kKHt9LCBvcHRpb25zLCB7dW5zZXQ6IHRydWV9KSk7CiAgICB9LAoKICAgIC8vIERldGVybWluZSBpZiB0aGUgbW9kZWwgaGFzIGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgYCJjaGFuZ2UiYCBldmVudC4KICAgIC8vIElmIHlvdSBzcGVjaWZ5IGFuIGF0dHJpYnV0ZSBuYW1lLCBkZXRlcm1pbmUgaWYgdGhhdCBhdHRyaWJ1dGUgaGFzIGNoYW5nZWQuCiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIGlmIChhdHRyID09IG51bGwpIHJldHVybiAhXy5pc0VtcHR5KHRoaXMuY2hhbmdlZCk7CiAgICAgIHJldHVybiBfLmhhcyh0aGlzLmNoYW5nZWQsIGF0dHIpOwogICAgfSwKCiAgICAvLyBSZXR1cm4gYW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHRoZSBhdHRyaWJ1dGVzIHRoYXQgaGF2ZSBjaGFuZ2VkLCBvcgogICAgLy8gZmFsc2UgaWYgdGhlcmUgYXJlIG5vIGNoYW5nZWQgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBkZXRlcm1pbmluZyB3aGF0CiAgICAvLyBwYXJ0cyBvZiBhIHZpZXcgbmVlZCB0byBiZSB1cGRhdGVkIGFuZC9vciB3aGF0IGF0dHJpYnV0ZXMgbmVlZCB0byBiZQogICAgLy8gcGVyc2lzdGVkIHRvIHRoZSBzZXJ2ZXIuIFVuc2V0IGF0dHJpYnV0ZXMgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAgLy8gWW91IGNhbiBhbHNvIHBhc3MgYW4gYXR0cmlidXRlcyBvYmplY3QgdG8gZGlmZiBhZ2FpbnN0IHRoZSBtb2RlbCwKICAgIC8vIGRldGVybWluaW5nIGlmIHRoZXJlICp3b3VsZCBiZSogYSBjaGFuZ2UuCiAgICBjaGFuZ2VkQXR0cmlidXRlczogZnVuY3Rpb24oZGlmZikgewogICAgICBpZiAoIWRpZmYpIHJldHVybiB0aGlzLmhhc0NoYW5nZWQoKSA/IF8uY2xvbmUodGhpcy5jaGFuZ2VkKSA6IGZhbHNlOwogICAgICB2YXIgdmFsLCBjaGFuZ2VkID0gZmFsc2U7CiAgICAgIHZhciBvbGQgPSB0aGlzLl9jaGFuZ2luZyA/IHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA6IHRoaXMuYXR0cmlidXRlczsKICAgICAgZm9yICh2YXIgYXR0ciBpbiBkaWZmKSB7CiAgICAgICAgaWYgKF8uaXNFcXVhbChvbGRbYXR0cl0sICh2YWwgPSBkaWZmW2F0dHJdKSkpIGNvbnRpbnVlOwogICAgICAgIChjaGFuZ2VkIHx8IChjaGFuZ2VkID0ge30pKVthdHRyXSA9IHZhbDsKICAgICAgfQogICAgICByZXR1cm4gY2hhbmdlZDsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBwcmV2aW91cyB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUsIHJlY29yZGVkIGF0IHRoZSB0aW1lIHRoZSBsYXN0CiAgICAvLyBgImNoYW5nZSJgIGV2ZW50IHdhcyBmaXJlZC4KICAgIHByZXZpb3VzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIGlmIChhdHRyID09IG51bGwgfHwgIXRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcykgcmV0dXJuIG51bGw7CiAgICAgIHJldHVybiB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXNbYXR0cl07CiAgICB9LAoKICAgIC8vIEdldCBhbGwgb2YgdGhlIGF0dHJpYnV0ZXMgb2YgdGhlIG1vZGVsIGF0IHRoZSB0aW1lIG9mIHRoZSBwcmV2aW91cwogICAgLy8gYCJjaGFuZ2UiYCBldmVudC4KICAgIHByZXZpb3VzQXR0cmlidXRlczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfLmNsb25lKHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIEZldGNoIHRoZSBtb2RlbCBmcm9tIHRoZSBzZXJ2ZXIuIElmIHRoZSBzZXJ2ZXIncyByZXByZXNlbnRhdGlvbiBvZiB0aGUKICAgIC8vIG1vZGVsIGRpZmZlcnMgZnJvbSBpdHMgY3VycmVudCBhdHRyaWJ1dGVzLCB0aGV5IHdpbGwgYmUgb3ZlcnJpZGRlbiwKICAgIC8vIHRyaWdnZXJpbmcgYSBgImNoYW5nZSJgIGV2ZW50LgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB2b2lkIDApIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgbW9kZWwgPSB0aGlzOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgIGlmICghbW9kZWwuc2V0KG1vZGVsLnBhcnNlKHJlc3AsIG9wdGlvbnMpLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzLnN5bmMoJ3JlYWQnLCB0aGlzLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gU2V0IGEgaGFzaCBvZiBtb2RlbCBhdHRyaWJ1dGVzLCBhbmQgc3luYyB0aGUgbW9kZWwgdG8gdGhlIHNlcnZlci4KICAgIC8vIElmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBhdHRyaWJ1dGVzIGhhc2ggdGhhdCBkaWZmZXJzLCB0aGUgbW9kZWwncwogICAgLy8gc3RhdGUgd2lsbCBiZSBgc2V0YCBhZ2Fpbi4KICAgIHNhdmU6IGZ1bmN0aW9uKGtleSwgdmFsLCBvcHRpb25zKSB7CiAgICAgIHZhciBhdHRycywgbWV0aG9kLCB4aHIsIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKGtleSA9PSBudWxsIHx8IHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgYXR0cnMgPSBrZXk7CiAgICAgICAgb3B0aW9ucyA9IHZhbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAoYXR0cnMgPSB7fSlba2V5XSA9IHZhbDsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IF8uZXh0ZW5kKHt2YWxpZGF0ZTogdHJ1ZX0sIG9wdGlvbnMpOwoKICAgICAgLy8gSWYgd2UncmUgbm90IHdhaXRpbmcgYW5kIGF0dHJpYnV0ZXMgZXhpc3QsIHNhdmUgYWN0cyBhcwogICAgICAvLyBgc2V0KGF0dHIpLnNhdmUobnVsbCwgb3B0cylgIHdpdGggdmFsaWRhdGlvbi4gT3RoZXJ3aXNlLCBjaGVjayBpZgogICAgICAvLyB0aGUgbW9kZWwgd2lsbCBiZSB2YWxpZCB3aGVuIHRoZSBhdHRyaWJ1dGVzLCBpZiBhbnksIGFyZSBzZXQuCiAgICAgIGlmIChhdHRycyAmJiAhb3B0aW9ucy53YWl0KSB7CiAgICAgICAgaWYgKCF0aGlzLnNldChhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyBTZXQgdGVtcG9yYXJ5IGF0dHJpYnV0ZXMgaWYgYHt3YWl0OiB0cnVlfWAuCiAgICAgIGlmIChhdHRycyAmJiBvcHRpb25zLndhaXQpIHsKICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBfLmV4dGVuZCh7fSwgYXR0cmlidXRlcywgYXR0cnMpOwogICAgICB9CgogICAgICAvLyBBZnRlciBhIHN1Y2Nlc3NmdWwgc2VydmVyLXNpZGUgc2F2ZSwgdGhlIGNsaWVudCBpcyAob3B0aW9uYWxseSkKICAgICAgLy8gdXBkYXRlZCB3aXRoIHRoZSBzZXJ2ZXItc2lkZSBzdGF0ZS4KICAgICAgaWYgKG9wdGlvbnMucGFyc2UgPT09IHZvaWQgMCkgb3B0aW9ucy5wYXJzZSA9IHRydWU7CiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgLy8gRW5zdXJlIGF0dHJpYnV0ZXMgYXJlIHJlc3RvcmVkIGR1cmluZyBzeW5jaHJvbm91cyBzYXZlcy4KICAgICAgICBtb2RlbC5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKICAgICAgICB2YXIgc2VydmVyQXR0cnMgPSBtb2RlbC5wYXJzZShyZXNwLCBvcHRpb25zKTsKICAgICAgICBpZiAob3B0aW9ucy53YWl0KSBzZXJ2ZXJBdHRycyA9IF8uZXh0ZW5kKGF0dHJzIHx8IHt9LCBzZXJ2ZXJBdHRycyk7CiAgICAgICAgaWYgKF8uaXNPYmplY3Qoc2VydmVyQXR0cnMpICYmICFtb2RlbC5zZXQoc2VydmVyQXR0cnMsIG9wdGlvbnMpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CgogICAgICBtZXRob2QgPSB0aGlzLmlzTmV3KCkgPyAnY3JlYXRlJyA6IChvcHRpb25zLnBhdGNoID8gJ3BhdGNoJyA6ICd1cGRhdGUnKTsKICAgICAgaWYgKG1ldGhvZCA9PT0gJ3BhdGNoJykgb3B0aW9ucy5hdHRycyA9IGF0dHJzOwogICAgICB4aHIgPSB0aGlzLnN5bmMobWV0aG9kLCB0aGlzLCBvcHRpb25zKTsKCiAgICAgIC8vIFJlc3RvcmUgYXR0cmlidXRlcy4KICAgICAgaWYgKGF0dHJzICYmIG9wdGlvbnMud2FpdCkgdGhpcy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKCiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlc3Ryb3kgdGhpcyBtb2RlbCBvbiB0aGUgc2VydmVyIGlmIGl0IHdhcyBhbHJlYWR5IHBlcnNpc3RlZC4KICAgIC8vIE9wdGltaXN0aWNhbGx5IHJlbW92ZXMgdGhlIG1vZGVsIGZyb20gaXRzIGNvbGxlY3Rpb24sIGlmIGl0IGhhcyBvbmUuCiAgICAvLyBJZiBgd2FpdDogdHJ1ZWAgaXMgcGFzc2VkLCB3YWl0cyBmb3IgdGhlIHNlcnZlciB0byByZXNwb25kIGJlZm9yZSByZW1vdmFsLgogICAgZGVzdHJveTogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgdmFyIG1vZGVsID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CgogICAgICB2YXIgZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgIG1vZGVsLnRyaWdnZXIoJ2Rlc3Ryb3knLCBtb2RlbCwgbW9kZWwuY29sbGVjdGlvbiwgb3B0aW9ucyk7CiAgICAgIH07CgogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCB8fCBtb2RlbC5pc05ldygpKSBkZXN0cm95KCk7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MobW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGlmICghbW9kZWwuaXNOZXcoKSkgbW9kZWwudHJpZ2dlcignc3luYycsIG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLmlzTmV3KCkpIHsKICAgICAgICBvcHRpb25zLnN1Y2Nlc3MoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgd3JhcEVycm9yKHRoaXMsIG9wdGlvbnMpOwoKICAgICAgdmFyIHhociA9IHRoaXMuc3luYygnZGVsZXRlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSBkZXN0cm95KCk7CiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlZmF1bHQgVVJMIGZvciB0aGUgbW9kZWwncyByZXByZXNlbnRhdGlvbiBvbiB0aGUgc2VydmVyIC0tIGlmIHlvdSdyZQogICAgLy8gdXNpbmcgQmFja2JvbmUncyByZXN0ZnVsIG1ldGhvZHMsIG92ZXJyaWRlIHRoaXMgdG8gY2hhbmdlIHRoZSBlbmRwb2ludAogICAgLy8gdGhhdCB3aWxsIGJlIGNhbGxlZC4KICAgIHVybDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBiYXNlID0KICAgICAgICBfLnJlc3VsdCh0aGlzLCAndXJsUm9vdCcpIHx8CiAgICAgICAgXy5yZXN1bHQodGhpcy5jb2xsZWN0aW9uLCAndXJsJykgfHwKICAgICAgICB1cmxFcnJvcigpOwogICAgICBpZiAodGhpcy5pc05ldygpKSByZXR1cm4gYmFzZTsKICAgICAgcmV0dXJuIGJhc2UucmVwbGFjZSgvKFteXC9dKSQvLCAnJDEvJykgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5pZCk7CiAgICB9LAoKICAgIC8vICoqcGFyc2UqKiBjb252ZXJ0cyBhIHJlc3BvbnNlIGludG8gdGhlIGhhc2ggb2YgYXR0cmlidXRlcyB0byBiZSBgc2V0YCBvbgogICAgLy8gdGhlIG1vZGVsLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgdGhlIHJlc3BvbnNlIGFsb25nLgogICAgcGFyc2U6IGZ1bmN0aW9uKHJlc3AsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHJlc3A7CiAgICB9LAoKICAgIC8vIENyZWF0ZSBhIG5ldyBtb2RlbCB3aXRoIGlkZW50aWNhbCBhdHRyaWJ1dGVzIHRvIHRoaXMgb25lLgogICAgY2xvbmU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5hdHRyaWJ1dGVzKTsKICAgIH0sCgogICAgLy8gQSBtb2RlbCBpcyBuZXcgaWYgaXQgaGFzIG5ldmVyIGJlZW4gc2F2ZWQgdG8gdGhlIHNlcnZlciwgYW5kIGxhY2tzIGFuIGlkLgogICAgaXNOZXc6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gIXRoaXMuaGFzKHRoaXMuaWRBdHRyaWJ1dGUpOwogICAgfSwKCiAgICAvLyBDaGVjayBpZiB0aGUgbW9kZWwgaXMgY3VycmVudGx5IGluIGEgdmFsaWQgc3RhdGUuCiAgICBpc1ZhbGlkOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLl92YWxpZGF0ZSh7fSwgXy5leHRlbmQob3B0aW9ucyB8fCB7fSwgeyB2YWxpZGF0ZTogdHJ1ZSB9KSk7CiAgICB9LAoKICAgIC8vIFJ1biB2YWxpZGF0aW9uIGFnYWluc3QgdGhlIG5leHQgY29tcGxldGUgc2V0IG9mIG1vZGVsIGF0dHJpYnV0ZXMsCiAgICAvLyByZXR1cm5pbmcgYHRydWVgIGlmIGFsbCBpcyB3ZWxsLiBPdGhlcndpc2UsIGZpcmUgYW4gYCJpbnZhbGlkImAgZXZlbnQuCiAgICBfdmFsaWRhdGU6IGZ1bmN0aW9uKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgIGlmICghb3B0aW9ucy52YWxpZGF0ZSB8fCAhdGhpcy52YWxpZGF0ZSkgcmV0dXJuIHRydWU7CiAgICAgIGF0dHJzID0gXy5leHRlbmQoe30sIHRoaXMuYXR0cmlidXRlcywgYXR0cnMpOwogICAgICB2YXIgZXJyb3IgPSB0aGlzLnZhbGlkYXRpb25FcnJvciA9IHRoaXMudmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpIHx8IG51bGw7CiAgICAgIGlmICghZXJyb3IpIHJldHVybiB0cnVlOwogICAgICB0aGlzLnRyaWdnZXIoJ2ludmFsaWQnLCB0aGlzLCBlcnJvciwgXy5leHRlbmQob3B0aW9ucywge3ZhbGlkYXRpb25FcnJvcjogZXJyb3J9KSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgfSk7CgogIC8vIFVuZGVyc2NvcmUgbWV0aG9kcyB0aGF0IHdlIHdhbnQgdG8gaW1wbGVtZW50IG9uIHRoZSBNb2RlbC4KICB2YXIgbW9kZWxNZXRob2RzID0gWydrZXlzJywgJ3ZhbHVlcycsICdwYWlycycsICdpbnZlcnQnLCAncGljaycsICdvbWl0J107CgogIC8vIE1peCBpbiBlYWNoIFVuZGVyc2NvcmUgbWV0aG9kIGFzIGEgcHJveHkgdG8gYE1vZGVsI2F0dHJpYnV0ZXNgLgogIF8uZWFjaChtb2RlbE1ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCkgewogICAgTW9kZWwucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGFyZ3MudW5zaGlmdCh0aGlzLmF0dHJpYnV0ZXMpOwogICAgICByZXR1cm4gX1ttZXRob2RdLmFwcGx5KF8sIGFyZ3MpOwogICAgfTsKICB9KTsKCiAgLy8gQmFja2JvbmUuQ29sbGVjdGlvbgogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gSWYgbW9kZWxzIHRlbmQgdG8gcmVwcmVzZW50IGEgc2luZ2xlIHJvdyBvZiBkYXRhLCBhIEJhY2tib25lIENvbGxlY3Rpb24gaXMKICAvLyBtb3JlIGFuYWxhZ291cyB0byBhIHRhYmxlIGZ1bGwgb2YgZGF0YSAuLi4gb3IgYSBzbWFsbCBzbGljZSBvciBwYWdlIG9mIHRoYXQKICAvLyB0YWJsZSwgb3IgYSBjb2xsZWN0aW9uIG9mIHJvd3MgdGhhdCBiZWxvbmcgdG9nZXRoZXIgZm9yIGEgcGFydGljdWxhciByZWFzb24KICAvLyAtLSBhbGwgb2YgdGhlIG1lc3NhZ2VzIGluIHRoaXMgcGFydGljdWxhciBmb2xkZXIsIGFsbCBvZiB0aGUgZG9jdW1lbnRzCiAgLy8gYmVsb25naW5nIHRvIHRoaXMgcGFydGljdWxhciBhdXRob3IsIGFuZCBzbyBvbi4gQ29sbGVjdGlvbnMgbWFpbnRhaW4KICAvLyBpbmRleGVzIG9mIHRoZWlyIG1vZGVscywgYm90aCBpbiBvcmRlciwgYW5kIGZvciBsb29rdXAgYnkgYGlkYC4KCiAgLy8gQ3JlYXRlIGEgbmV3ICoqQ29sbGVjdGlvbioqLCBwZXJoYXBzIHRvIGNvbnRhaW4gYSBzcGVjaWZpYyB0eXBlIG9mIGBtb2RlbGAuCiAgLy8gSWYgYSBgY29tcGFyYXRvcmAgaXMgc3BlY2lmaWVkLCB0aGUgQ29sbGVjdGlvbiB3aWxsIG1haW50YWluCiAgLy8gaXRzIG1vZGVscyBpbiBzb3J0IG9yZGVyLCBhcyB0aGV5J3JlIGFkZGVkIGFuZCByZW1vdmVkLgogIHZhciBDb2xsZWN0aW9uID0gQmFja2JvbmUuQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIGlmIChvcHRpb25zLm1vZGVsKSB0aGlzLm1vZGVsID0gb3B0aW9ucy5tb2RlbDsKICAgIGlmIChvcHRpb25zLmNvbXBhcmF0b3IgIT09IHZvaWQgMCkgdGhpcy5jb21wYXJhdG9yID0gb3B0aW9ucy5jb21wYXJhdG9yOwogICAgdGhpcy5fcmVzZXQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgaWYgKG1vZGVscykgdGhpcy5yZXNldChtb2RlbHMsIF8uZXh0ZW5kKHtzaWxlbnQ6IHRydWV9LCBvcHRpb25zKSk7CiAgfTsKCiAgLy8gRGVmYXVsdCBvcHRpb25zIGZvciBgQ29sbGVjdGlvbiNzZXRgLgogIHZhciBzZXRPcHRpb25zID0ge2FkZDogdHJ1ZSwgcmVtb3ZlOiB0cnVlLCBtZXJnZTogdHJ1ZX07CiAgdmFyIGFkZE9wdGlvbnMgPSB7YWRkOiB0cnVlLCByZW1vdmU6IGZhbHNlfTsKCiAgLy8gRGVmaW5lIHRoZSBDb2xsZWN0aW9uJ3MgaW5oZXJpdGFibGUgbWV0aG9kcy4KICBfLmV4dGVuZChDb2xsZWN0aW9uLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gVGhlIGRlZmF1bHQgbW9kZWwgZm9yIGEgY29sbGVjdGlvbiBpcyBqdXN0IGEgKipCYWNrYm9uZS5Nb2RlbCoqLgogICAgLy8gVGhpcyBzaG91bGQgYmUgb3ZlcnJpZGRlbiBpbiBtb3N0IGNhc2VzLgogICAgbW9kZWw6IE1vZGVsLAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gVGhlIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYSBDb2xsZWN0aW9uIGlzIGFuIGFycmF5IG9mIHRoZQogICAgLy8gbW9kZWxzJyBhdHRyaWJ1dGVzLgogICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihtb2RlbCl7IHJldHVybiBtb2RlbC50b0pTT04ob3B0aW9ucyk7IH0pOwogICAgfSwKCiAgICAvLyBQcm94eSBgQmFja2JvbmUuc3luY2AgYnkgZGVmYXVsdC4KICAgIHN5bmM6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gQmFja2JvbmUuc3luYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCwgb3IgbGlzdCBvZiBtb2RlbHMgdG8gdGhlIHNldC4KICAgIGFkZDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLnNldChtb2RlbHMsIF8uZXh0ZW5kKHttZXJnZTogZmFsc2V9LCBvcHRpb25zLCBhZGRPcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsLCBvciBhIGxpc3Qgb2YgbW9kZWxzIGZyb20gdGhlIHNldC4KICAgIHJlbW92ZTogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHZhciBzaW5ndWxhciA9ICFfLmlzQXJyYXkobW9kZWxzKTsKICAgICAgbW9kZWxzID0gc2luZ3VsYXIgPyBbbW9kZWxzXSA6IF8uY2xvbmUobW9kZWxzKTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgdmFyIGksIGwsIGluZGV4LCBtb2RlbDsKICAgICAgZm9yIChpID0gMCwgbCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBtb2RlbCA9IG1vZGVsc1tpXSA9IHRoaXMuZ2V0KG1vZGVsc1tpXSk7CiAgICAgICAgaWYgKCFtb2RlbCkgY29udGludWU7CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5SWRbbW9kZWwuaWRdOwogICAgICAgIGRlbGV0ZSB0aGlzLl9ieUlkW21vZGVsLmNpZF07CiAgICAgICAgaW5kZXggPSB0aGlzLmluZGV4T2YobW9kZWwpOwogICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgdGhpcy5sZW5ndGgtLTsKICAgICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB7CiAgICAgICAgICBvcHRpb25zLmluZGV4ID0gaW5kZXg7CiAgICAgICAgICBtb2RlbC50cmlnZ2VyKCdyZW1vdmUnLCBtb2RlbCwgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3JlbW92ZVJlZmVyZW5jZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHNpbmd1bGFyID8gbW9kZWxzWzBdIDogbW9kZWxzOwogICAgfSwKCiAgICAvLyBVcGRhdGUgYSBjb2xsZWN0aW9uIGJ5IGBzZXRgLWluZyBhIG5ldyBsaXN0IG9mIG1vZGVscywgYWRkaW5nIG5ldyBvbmVzLAogICAgLy8gcmVtb3ZpbmcgbW9kZWxzIHRoYXQgYXJlIG5vIGxvbmdlciBwcmVzZW50LCBhbmQgbWVyZ2luZyBtb2RlbHMgdGhhdAogICAgLy8gYWxyZWFkeSBleGlzdCBpbiB0aGUgY29sbGVjdGlvbiwgYXMgbmVjZXNzYXJ5LiBTaW1pbGFyIHRvICoqTW9kZWwjc2V0KiosCiAgICAvLyB0aGUgY29yZSBvcGVyYXRpb24gZm9yIHVwZGF0aW5nIHRoZSBkYXRhIGNvbnRhaW5lZCBieSB0aGUgY29sbGVjdGlvbi4KICAgIHNldDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBfLmRlZmF1bHRzKHt9LCBvcHRpb25zLCBzZXRPcHRpb25zKTsKICAgICAgaWYgKG9wdGlvbnMucGFyc2UpIG1vZGVscyA9IHRoaXMucGFyc2UobW9kZWxzLCBvcHRpb25zKTsKICAgICAgdmFyIHNpbmd1bGFyID0gIV8uaXNBcnJheShtb2RlbHMpOwogICAgICBtb2RlbHMgPSBzaW5ndWxhciA/IChtb2RlbHMgPyBbbW9kZWxzXSA6IFtdKSA6IF8uY2xvbmUobW9kZWxzKTsKICAgICAgdmFyIGksIGwsIGlkLCBtb2RlbCwgYXR0cnMsIGV4aXN0aW5nLCBzb3J0OwogICAgICB2YXIgYXQgPSBvcHRpb25zLmF0OwogICAgICB2YXIgdGFyZ2V0TW9kZWwgPSB0aGlzLm1vZGVsOwogICAgICB2YXIgc29ydGFibGUgPSB0aGlzLmNvbXBhcmF0b3IgJiYgKGF0ID09IG51bGwpICYmIG9wdGlvbnMuc29ydCAhPT0gZmFsc2U7CiAgICAgIHZhciBzb3J0QXR0ciA9IF8uaXNTdHJpbmcodGhpcy5jb21wYXJhdG9yKSA/IHRoaXMuY29tcGFyYXRvciA6IG51bGw7CiAgICAgIHZhciB0b0FkZCA9IFtdLCB0b1JlbW92ZSA9IFtdLCBtb2RlbE1hcCA9IHt9OwogICAgICB2YXIgYWRkID0gb3B0aW9ucy5hZGQsIG1lcmdlID0gb3B0aW9ucy5tZXJnZSwgcmVtb3ZlID0gb3B0aW9ucy5yZW1vdmU7CiAgICAgIHZhciBvcmRlciA9ICFzb3J0YWJsZSAmJiBhZGQgJiYgcmVtb3ZlID8gW10gOiBmYWxzZTsKCiAgICAgIC8vIFR1cm4gYmFyZSBvYmplY3RzIGludG8gbW9kZWwgcmVmZXJlbmNlcywgYW5kIHByZXZlbnQgaW52YWxpZCBtb2RlbHMKICAgICAgLy8gZnJvbSBiZWluZyBhZGRlZC4KICAgICAgZm9yIChpID0gMCwgbCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBhdHRycyA9IG1vZGVsc1tpXSB8fCB7fTsKICAgICAgICBpZiAoYXR0cnMgaW5zdGFuY2VvZiBNb2RlbCkgewogICAgICAgICAgaWQgPSBtb2RlbCA9IGF0dHJzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZCA9IGF0dHJzW3RhcmdldE1vZGVsLnByb3RvdHlwZS5pZEF0dHJpYnV0ZSB8fCAnaWQnXTsKICAgICAgICB9CgogICAgICAgIC8vIElmIGEgZHVwbGljYXRlIGlzIGZvdW5kLCBwcmV2ZW50IGl0IGZyb20gYmVpbmcgYWRkZWQgYW5kCiAgICAgICAgLy8gb3B0aW9uYWxseSBtZXJnZSBpdCBpbnRvIHRoZSBleGlzdGluZyBtb2RlbC4KICAgICAgICBpZiAoZXhpc3RpbmcgPSB0aGlzLmdldChpZCkpIHsKICAgICAgICAgIGlmIChyZW1vdmUpIG1vZGVsTWFwW2V4aXN0aW5nLmNpZF0gPSB0cnVlOwogICAgICAgICAgaWYgKG1lcmdlKSB7CiAgICAgICAgICAgIGF0dHJzID0gYXR0cnMgPT09IG1vZGVsID8gbW9kZWwuYXR0cmlidXRlcyA6IGF0dHJzOwogICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJzZSkgYXR0cnMgPSBleGlzdGluZy5wYXJzZShhdHRycywgb3B0aW9ucyk7CiAgICAgICAgICAgIGV4aXN0aW5nLnNldChhdHRycywgb3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChzb3J0YWJsZSAmJiAhc29ydCAmJiBleGlzdGluZy5oYXNDaGFuZ2VkKHNvcnRBdHRyKSkgc29ydCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBtb2RlbHNbaV0gPSBleGlzdGluZzsKCiAgICAgICAgLy8gSWYgdGhpcyBpcyBhIG5ldywgdmFsaWQgbW9kZWwsIHB1c2ggaXQgdG8gdGhlIGB0b0FkZGAgbGlzdC4KICAgICAgICB9IGVsc2UgaWYgKGFkZCkgewogICAgICAgICAgbW9kZWwgPSBtb2RlbHNbaV0gPSB0aGlzLl9wcmVwYXJlTW9kZWwoYXR0cnMsIG9wdGlvbnMpOwogICAgICAgICAgaWYgKCFtb2RlbCkgY29udGludWU7CiAgICAgICAgICB0b0FkZC5wdXNoKG1vZGVsKTsKICAgICAgICAgIHRoaXMuX2FkZFJlZmVyZW5jZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgICAgfQoKICAgICAgICAvLyBEbyBub3QgYWRkIG11bHRpcGxlIG1vZGVscyB3aXRoIHRoZSBzYW1lIGBpZGAuCiAgICAgICAgbW9kZWwgPSBleGlzdGluZyB8fCBtb2RlbDsKICAgICAgICBpZiAob3JkZXIgJiYgKG1vZGVsLmlzTmV3KCkgfHwgIW1vZGVsTWFwW21vZGVsLmlkXSkpIG9yZGVyLnB1c2gobW9kZWwpOwogICAgICAgIG1vZGVsTWFwW21vZGVsLmlkXSA9IHRydWU7CiAgICAgIH0KCiAgICAgIC8vIFJlbW92ZSBub25leGlzdGVudCBtb2RlbHMgaWYgYXBwcm9wcmlhdGUuCiAgICAgIGlmIChyZW1vdmUpIHsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgICAgICAgIGlmICghbW9kZWxNYXBbKG1vZGVsID0gdGhpcy5tb2RlbHNbaV0pLmNpZF0pIHRvUmVtb3ZlLnB1c2gobW9kZWwpOwogICAgICAgIH0KICAgICAgICBpZiAodG9SZW1vdmUubGVuZ3RoKSB0aGlzLnJlbW92ZSh0b1JlbW92ZSwgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIC8vIFNlZSBpZiBzb3J0aW5nIGlzIG5lZWRlZCwgdXBkYXRlIGBsZW5ndGhgIGFuZCBzcGxpY2UgaW4gbmV3IG1vZGVscy4KICAgICAgaWYgKHRvQWRkLmxlbmd0aCB8fCAob3JkZXIgJiYgb3JkZXIubGVuZ3RoKSkgewogICAgICAgIGlmIChzb3J0YWJsZSkgc29ydCA9IHRydWU7CiAgICAgICAgdGhpcy5sZW5ndGggKz0gdG9BZGQubGVuZ3RoOwogICAgICAgIGlmIChhdCAhPSBudWxsKSB7CiAgICAgICAgICBmb3IgKGkgPSAwLCBsID0gdG9BZGQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShhdCArIGksIDAsIHRvQWRkW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKG9yZGVyKSB0aGlzLm1vZGVscy5sZW5ndGggPSAwOwogICAgICAgICAgdmFyIG9yZGVyZWRNb2RlbHMgPSBvcmRlciB8fCB0b0FkZDsKICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBvcmRlcmVkTW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICB0aGlzLm1vZGVscy5wdXNoKG9yZGVyZWRNb2RlbHNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gU2lsZW50bHkgc29ydCB0aGUgY29sbGVjdGlvbiBpZiBhcHByb3ByaWF0ZS4KICAgICAgaWYgKHNvcnQpIHRoaXMuc29ydCh7c2lsZW50OiB0cnVlfSk7CgogICAgICAvLyBVbmxlc3Mgc2lsZW5jZWQsIGl0J3MgdGltZSB0byBmaXJlIGFsbCBhcHByb3ByaWF0ZSBhZGQvc29ydCBldmVudHMuCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gdG9BZGQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAobW9kZWwgPSB0b0FkZFtpXSkudHJpZ2dlcignYWRkJywgbW9kZWwsIHRoaXMsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICBpZiAoc29ydCB8fCAob3JkZXIgJiYgb3JkZXIubGVuZ3RoKSkgdGhpcy50cmlnZ2VyKCdzb3J0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIC8vIFJldHVybiB0aGUgYWRkZWQgKG9yIG1lcmdlZCkgbW9kZWwgKG9yIG1vZGVscykuCiAgICAgIHJldHVybiBzaW5ndWxhciA/IG1vZGVsc1swXSA6IG1vZGVsczsKICAgIH0sCgogICAgLy8gV2hlbiB5b3UgaGF2ZSBtb3JlIGl0ZW1zIHRoYW4geW91IHdhbnQgdG8gYWRkIG9yIHJlbW92ZSBpbmRpdmlkdWFsbHksCiAgICAvLyB5b3UgY2FuIHJlc2V0IHRoZSBlbnRpcmUgc2V0IHdpdGggYSBuZXcgbGlzdCBvZiBtb2RlbHMsIHdpdGhvdXQgZmlyaW5nCiAgICAvLyBhbnkgZ3JhbnVsYXIgYGFkZGAgb3IgYHJlbW92ZWAgZXZlbnRzLiBGaXJlcyBgcmVzZXRgIHdoZW4gZmluaXNoZWQuCiAgICAvLyBVc2VmdWwgZm9yIGJ1bGsgb3BlcmF0aW9ucyBhbmQgb3B0aW1pemF0aW9ucy4KICAgIHJlc2V0OiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLm1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLl9yZW1vdmVSZWZlcmVuY2UodGhpcy5tb2RlbHNbaV0sIG9wdGlvbnMpOwogICAgICB9CiAgICAgIG9wdGlvbnMucHJldmlvdXNNb2RlbHMgPSB0aGlzLm1vZGVsczsKICAgICAgdGhpcy5fcmVzZXQoKTsKICAgICAgbW9kZWxzID0gdGhpcy5hZGQobW9kZWxzLCBfLmV4dGVuZCh7c2lsZW50OiB0cnVlfSwgb3B0aW9ucykpOwogICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLnRyaWdnZXIoJ3Jlc2V0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiBtb2RlbHM7CiAgICB9LAoKICAgIC8vIEFkZCBhIG1vZGVsIHRvIHRoZSBlbmQgb2YgdGhlIGNvbGxlY3Rpb24uCiAgICBwdXNoOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICByZXR1cm4gdGhpcy5hZGQobW9kZWwsIF8uZXh0ZW5kKHthdDogdGhpcy5sZW5ndGh9LCBvcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGVuZCBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHBvcDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICB2YXIgbW9kZWwgPSB0aGlzLmF0KHRoaXMubGVuZ3RoIC0gMSk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgdW5zaGlmdDogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuYWRkKG1vZGVsLCBfLmV4dGVuZCh7YXQ6IDB9LCBvcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHNoaWZ0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuYXQoMCk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBTbGljZSBvdXQgYSBzdWItYXJyYXkgb2YgbW9kZWxzIGZyb20gdGhlIGNvbGxlY3Rpb24uCiAgICBzbGljZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBzbGljZS5hcHBseSh0aGlzLm1vZGVscywgYXJndW1lbnRzKTsKICAgIH0sCgogICAgLy8gR2V0IGEgbW9kZWwgZnJvbSB0aGUgc2V0IGJ5IGlkLgogICAgZ2V0OiBmdW5jdGlvbihvYmopIHsKICAgICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgICByZXR1cm4gdGhpcy5fYnlJZFtvYmpdIHx8IHRoaXMuX2J5SWRbb2JqLmlkXSB8fCB0aGlzLl9ieUlkW29iai5jaWRdOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIG1vZGVsIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIGF0OiBmdW5jdGlvbihpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlbHNbaW5kZXhdOwogICAgfSwKCiAgICAvLyBSZXR1cm4gbW9kZWxzIHdpdGggbWF0Y2hpbmcgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBzaW1wbGUgY2FzZXMgb2YKICAgIC8vIGBmaWx0ZXJgLgogICAgd2hlcmU6IGZ1bmN0aW9uKGF0dHJzLCBmaXJzdCkgewogICAgICBpZiAoXy5pc0VtcHR5KGF0dHJzKSkgcmV0dXJuIGZpcnN0ID8gdm9pZCAwIDogW107CiAgICAgIHJldHVybiB0aGlzW2ZpcnN0ID8gJ2ZpbmQnIDogJ2ZpbHRlciddKGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7CiAgICAgICAgICBpZiAoYXR0cnNba2V5XSAhPT0gbW9kZWwuZ2V0KGtleSkpIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBSZXR1cm4gdGhlIGZpcnN0IG1vZGVsIHdpdGggbWF0Y2hpbmcgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBzaW1wbGUgY2FzZXMKICAgIC8vIG9mIGBmaW5kYC4KICAgIGZpbmRXaGVyZTogZnVuY3Rpb24oYXR0cnMpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlcmUoYXR0cnMsIHRydWUpOwogICAgfSwKCiAgICAvLyBGb3JjZSB0aGUgY29sbGVjdGlvbiB0byByZS1zb3J0IGl0c2VsZi4gWW91IGRvbid0IG5lZWQgdG8gY2FsbCB0aGlzIHVuZGVyCiAgICAvLyBub3JtYWwgY2lyY3Vtc3RhbmNlcywgYXMgdGhlIHNldCB3aWxsIG1haW50YWluIHNvcnQgb3JkZXIgYXMgZWFjaCBpdGVtCiAgICAvLyBpcyBhZGRlZC4KICAgIHNvcnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgaWYgKCF0aGlzLmNvbXBhcmF0b3IpIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNvcnQgYSBzZXQgd2l0aG91dCBhIGNvbXBhcmF0b3InKTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIC8vIFJ1biBzb3J0IGJhc2VkIG9uIHR5cGUgb2YgYGNvbXBhcmF0b3JgLgogICAgICBpZiAoXy5pc1N0cmluZyh0aGlzLmNvbXBhcmF0b3IpIHx8IHRoaXMuY29tcGFyYXRvci5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLm1vZGVscyA9IHRoaXMuc29ydEJ5KHRoaXMuY29tcGFyYXRvciwgdGhpcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5tb2RlbHMuc29ydChfLmJpbmQodGhpcy5jb21wYXJhdG9yLCB0aGlzKSk7CiAgICAgIH0KCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMudHJpZ2dlcignc29ydCcsIHRoaXMsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUGx1Y2sgYW4gYXR0cmlidXRlIGZyb20gZWFjaCBtb2RlbCBpbiB0aGUgY29sbGVjdGlvbi4KICAgIHBsdWNrOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiBfLmludm9rZSh0aGlzLm1vZGVscywgJ2dldCcsIGF0dHIpOwogICAgfSwKCiAgICAvLyBGZXRjaCB0aGUgZGVmYXVsdCBzZXQgb2YgbW9kZWxzIGZvciB0aGlzIGNvbGxlY3Rpb24sIHJlc2V0dGluZyB0aGUKICAgIC8vIGNvbGxlY3Rpb24gd2hlbiB0aGV5IGFycml2ZS4gSWYgYHJlc2V0OiB0cnVlYCBpcyBwYXNzZWQsIHRoZSByZXNwb25zZQogICAgLy8gZGF0YSB3aWxsIGJlIHBhc3NlZCB0aHJvdWdoIHRoZSBgcmVzZXRgIG1ldGhvZCBpbnN0ZWFkIG9mIGBzZXRgLgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB2b2lkIDApIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgdmFyIGNvbGxlY3Rpb24gPSB0aGlzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IG9wdGlvbnMucmVzZXQgPyAncmVzZXQnIDogJ3NldCc7CiAgICAgICAgY29sbGVjdGlvblttZXRob2RdKHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGNvbGxlY3Rpb24udHJpZ2dlcignc3luYycsIGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzLnN5bmMoJ3JlYWQnLCB0aGlzLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIGEgbW9kZWwgaW4gdGhpcyBjb2xsZWN0aW9uLiBBZGQgdGhlIG1vZGVsIHRvIHRoZQogICAgLy8gY29sbGVjdGlvbiBpbW1lZGlhdGVseSwgdW5sZXNzIGB3YWl0OiB0cnVlYCBpcyBwYXNzZWQsIGluIHdoaWNoIGNhc2Ugd2UKICAgIC8vIHdhaXQgZm9yIHRoZSBzZXJ2ZXIgdG8gYWdyZWUuCiAgICBjcmVhdGU6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9OwogICAgICBpZiAoIShtb2RlbCA9IHRoaXMuX3ByZXBhcmVNb2RlbChtb2RlbCwgb3B0aW9ucykpKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSB0aGlzLmFkZChtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHZhciBjb2xsZWN0aW9uID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKG1vZGVsLCByZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgY29sbGVjdGlvbi5hZGQobW9kZWwsIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKICAgICAgbW9kZWwuc2F2ZShudWxsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyAqKnBhcnNlKiogY29udmVydHMgYSByZXNwb25zZSBpbnRvIGEgbGlzdCBvZiBtb2RlbHMgdG8gYmUgYWRkZWQgdG8gdGhlCiAgICAvLyBjb2xsZWN0aW9uLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgaXQgdGhyb3VnaC4KICAgIHBhcnNlOiBmdW5jdGlvbihyZXNwLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiByZXNwOwogICAgfSwKCiAgICAvLyBDcmVhdGUgYSBuZXcgY29sbGVjdGlvbiB3aXRoIGFuIGlkZW50aWNhbCBsaXN0IG9mIG1vZGVscyBhcyB0aGlzIG9uZS4KICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMubW9kZWxzKTsKICAgIH0sCgogICAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gcmVzZXQgYWxsIGludGVybmFsIHN0YXRlLiBDYWxsZWQgd2hlbiB0aGUgY29sbGVjdGlvbgogICAgLy8gaXMgZmlyc3QgaW5pdGlhbGl6ZWQgb3IgcmVzZXQuCiAgICBfcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubW9kZWxzID0gW107CiAgICAgIHRoaXMuX2J5SWQgID0ge307CiAgICB9LAoKICAgIC8vIFByZXBhcmUgYSBoYXNoIG9mIGF0dHJpYnV0ZXMgKG9yIG90aGVyIG1vZGVsKSB0byBiZSBhZGRlZCB0byB0aGlzCiAgICAvLyBjb2xsZWN0aW9uLgogICAgX3ByZXBhcmVNb2RlbDogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgaWYgKGF0dHJzIGluc3RhbmNlb2YgTW9kZWwpIHJldHVybiBhdHRyczsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIG9wdGlvbnMuY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIHZhciBtb2RlbCA9IG5ldyB0aGlzLm1vZGVsKGF0dHJzLCBvcHRpb25zKTsKICAgICAgaWYgKCFtb2RlbC52YWxpZGF0aW9uRXJyb3IpIHJldHVybiBtb2RlbDsKICAgICAgdGhpcy50cmlnZ2VyKCdpbnZhbGlkJywgdGhpcywgbW9kZWwudmFsaWRhdGlvbkVycm9yLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgdG8gY3JlYXRlIGEgbW9kZWwncyB0aWVzIHRvIGEgY29sbGVjdGlvbi4KICAgIF9hZGRSZWZlcmVuY2U6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIHRoaXMuX2J5SWRbbW9kZWwuY2lkXSA9IG1vZGVsOwogICAgICBpZiAobW9kZWwuaWQgIT0gbnVsbCkgdGhpcy5fYnlJZFttb2RlbC5pZF0gPSBtb2RlbDsKICAgICAgaWYgKCFtb2RlbC5jb2xsZWN0aW9uKSBtb2RlbC5jb2xsZWN0aW9uID0gdGhpczsKICAgICAgbW9kZWwub24oJ2FsbCcsIHRoaXMuX29uTW9kZWxFdmVudCwgdGhpcyk7CiAgICB9LAoKICAgIC8vIEludGVybmFsIG1ldGhvZCB0byBzZXZlciBhIG1vZGVsJ3MgdGllcyB0byBhIGNvbGxlY3Rpb24uCiAgICBfcmVtb3ZlUmVmZXJlbmNlOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICBpZiAodGhpcyA9PT0gbW9kZWwuY29sbGVjdGlvbikgZGVsZXRlIG1vZGVsLmNvbGxlY3Rpb247CiAgICAgIG1vZGVsLm9mZignYWxsJywgdGhpcy5fb25Nb2RlbEV2ZW50LCB0aGlzKTsKICAgIH0sCgogICAgLy8gSW50ZXJuYWwgbWV0aG9kIGNhbGxlZCBldmVyeSB0aW1lIGEgbW9kZWwgaW4gdGhlIHNldCBmaXJlcyBhbiBldmVudC4KICAgIC8vIFNldHMgbmVlZCB0byB1cGRhdGUgdGhlaXIgaW5kZXhlcyB3aGVuIG1vZGVscyBjaGFuZ2UgaWRzLiBBbGwgb3RoZXIKICAgIC8vIGV2ZW50cyBzaW1wbHkgcHJveHkgdGhyb3VnaC4gImFkZCIgYW5kICJyZW1vdmUiIGV2ZW50cyB0aGF0IG9yaWdpbmF0ZQogICAgLy8gaW4gb3RoZXIgY29sbGVjdGlvbnMgYXJlIGlnbm9yZWQuCiAgICBfb25Nb2RlbEV2ZW50OiBmdW5jdGlvbihldmVudCwgbW9kZWwsIGNvbGxlY3Rpb24sIG9wdGlvbnMpIHsKICAgICAgaWYgKChldmVudCA9PT0gJ2FkZCcgfHwgZXZlbnQgPT09ICdyZW1vdmUnKSAmJiBjb2xsZWN0aW9uICE9PSB0aGlzKSByZXR1cm47CiAgICAgIGlmIChldmVudCA9PT0gJ2Rlc3Ryb3knKSB0aGlzLnJlbW92ZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIGlmIChtb2RlbCAmJiBldmVudCA9PT0gJ2NoYW5nZTonICsgbW9kZWwuaWRBdHRyaWJ1dGUpIHsKICAgICAgICBkZWxldGUgdGhpcy5fYnlJZFttb2RlbC5wcmV2aW91cyhtb2RlbC5pZEF0dHJpYnV0ZSldOwogICAgICAgIGlmIChtb2RlbC5pZCAhPSBudWxsKSB0aGlzLl9ieUlkW21vZGVsLmlkXSA9IG1vZGVsOwogICAgICB9CiAgICAgIHRoaXMudHJpZ2dlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICB9KTsKCiAgLy8gVW5kZXJzY29yZSBtZXRob2RzIHRoYXQgd2Ugd2FudCB0byBpbXBsZW1lbnQgb24gdGhlIENvbGxlY3Rpb24uCiAgLy8gOTAlIG9mIHRoZSBjb3JlIHVzZWZ1bG5lc3Mgb2YgQmFja2JvbmUgQ29sbGVjdGlvbnMgaXMgYWN0dWFsbHkgaW1wbGVtZW50ZWQKICAvLyByaWdodCBoZXJlOgogIHZhciBtZXRob2RzID0gWydmb3JFYWNoJywgJ2VhY2gnLCAnbWFwJywgJ2NvbGxlY3QnLCAncmVkdWNlJywgJ2ZvbGRsJywKICAgICdpbmplY3QnLCAncmVkdWNlUmlnaHQnLCAnZm9sZHInLCAnZmluZCcsICdkZXRlY3QnLCAnZmlsdGVyJywgJ3NlbGVjdCcsCiAgICAncmVqZWN0JywgJ2V2ZXJ5JywgJ2FsbCcsICdzb21lJywgJ2FueScsICdpbmNsdWRlJywgJ2NvbnRhaW5zJywgJ2ludm9rZScsCiAgICAnbWF4JywgJ21pbicsICd0b0FycmF5JywgJ3NpemUnLCAnZmlyc3QnLCAnaGVhZCcsICd0YWtlJywgJ2luaXRpYWwnLCAncmVzdCcsCiAgICAndGFpbCcsICdkcm9wJywgJ2xhc3QnLCAnd2l0aG91dCcsICdkaWZmZXJlbmNlJywgJ2luZGV4T2YnLCAnc2h1ZmZsZScsCiAgICAnbGFzdEluZGV4T2YnLCAnaXNFbXB0eScsICdjaGFpbicsICdzYW1wbGUnXTsKCiAgLy8gTWl4IGluIGVhY2ggVW5kZXJzY29yZSBtZXRob2QgYXMgYSBwcm94eSB0byBgQ29sbGVjdGlvbiNtb2RlbHNgLgogIF8uZWFjaChtZXRob2RzLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIENvbGxlY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGFyZ3MudW5zaGlmdCh0aGlzLm1vZGVscyk7CiAgICAgIHJldHVybiBfW21ldGhvZF0uYXBwbHkoXywgYXJncyk7CiAgICB9OwogIH0pOwoKICAvLyBVbmRlcnNjb3JlIG1ldGhvZHMgdGhhdCB0YWtlIGEgcHJvcGVydHkgbmFtZSBhcyBhbiBhcmd1bWVudC4KICB2YXIgYXR0cmlidXRlTWV0aG9kcyA9IFsnZ3JvdXBCeScsICdjb3VudEJ5JywgJ3NvcnRCeScsICdpbmRleEJ5J107CgogIC8vIFVzZSBhdHRyaWJ1dGVzIGluc3RlYWQgb2YgcHJvcGVydGllcy4KICBfLmVhY2goYXR0cmlidXRlTWV0aG9kcywgZnVuY3Rpb24obWV0aG9kKSB7CiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24odmFsdWUsIGNvbnRleHQpIHsKICAgICAgdmFyIGl0ZXJhdG9yID0gXy5pc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlIDogZnVuY3Rpb24obW9kZWwpIHsKICAgICAgICByZXR1cm4gbW9kZWwuZ2V0KHZhbHVlKTsKICAgICAgfTsKICAgICAgcmV0dXJuIF9bbWV0aG9kXSh0aGlzLm1vZGVscywgaXRlcmF0b3IsIGNvbnRleHQpOwogICAgfTsKICB9KTsKCiAgLy8gQmFja2JvbmUuVmlldwogIC8vIC0tLS0tLS0tLS0tLS0KCiAgLy8gQmFja2JvbmUgVmlld3MgYXJlIGFsbW9zdCBtb3JlIGNvbnZlbnRpb24gdGhhbiB0aGV5IGFyZSBhY3R1YWwgY29kZS4gQSBWaWV3CiAgLy8gaXMgc2ltcGx5IGEgSmF2YVNjcmlwdCBvYmplY3QgdGhhdCByZXByZXNlbnRzIGEgbG9naWNhbCBjaHVuayBvZiBVSSBpbiB0aGUKICAvLyBET00uIFRoaXMgbWlnaHQgYmUgYSBzaW5nbGUgaXRlbSwgYW4gZW50aXJlIGxpc3QsIGEgc2lkZWJhciBvciBwYW5lbCwgb3IKICAvLyBldmVuIHRoZSBzdXJyb3VuZGluZyBmcmFtZSB3aGljaCB3cmFwcyB5b3VyIHdob2xlIGFwcC4gRGVmaW5pbmcgYSBjaHVuayBvZgogIC8vIFVJIGFzIGEgKipWaWV3KiogYWxsb3dzIHlvdSB0byBkZWZpbmUgeW91ciBET00gZXZlbnRzIGRlY2xhcmF0aXZlbHksIHdpdGhvdXQKICAvLyBoYXZpbmcgdG8gd29ycnkgYWJvdXQgcmVuZGVyIG9yZGVyIC4uLiBhbmQgbWFrZXMgaXQgZWFzeSBmb3IgdGhlIHZpZXcgdG8KICAvLyByZWFjdCB0byBzcGVjaWZpYyBjaGFuZ2VzIGluIHRoZSBzdGF0ZSBvZiB5b3VyIG1vZGVscy4KCiAgLy8gQ3JlYXRpbmcgYSBCYWNrYm9uZS5WaWV3IGNyZWF0ZXMgaXRzIGluaXRpYWwgZWxlbWVudCBvdXRzaWRlIG9mIHRoZSBET00sCiAgLy8gaWYgYW4gZXhpc3RpbmcgZWxlbWVudCBpcyBub3QgcHJvdmlkZWQuLi4KICB2YXIgVmlldyA9IEJhY2tib25lLlZpZXcgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ3ZpZXcnKTsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICBfLmV4dGVuZCh0aGlzLCBfLnBpY2sob3B0aW9ucywgdmlld09wdGlvbnMpKTsKICAgIHRoaXMuX2Vuc3VyZUVsZW1lbnQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgdGhpcy5kZWxlZ2F0ZUV2ZW50cygpOwogIH07CgogIC8vIENhY2hlZCByZWdleCB0byBzcGxpdCBrZXlzIGZvciBgZGVsZWdhdGVgLgogIHZhciBkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIgPSAvXihcUyspXHMqKC4qKSQvOwoKICAvLyBMaXN0IG9mIHZpZXcgb3B0aW9ucyB0byBiZSBtZXJnZWQgYXMgcHJvcGVydGllcy4KICB2YXIgdmlld09wdGlvbnMgPSBbJ21vZGVsJywgJ2NvbGxlY3Rpb24nLCAnZWwnLCAnaWQnLCAnYXR0cmlidXRlcycsICdjbGFzc05hbWUnLCAndGFnTmFtZScsICdldmVudHMnXTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLlZpZXcqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKFZpZXcucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBgdGFnTmFtZWAgb2YgYSBWaWV3J3MgZWxlbWVudCBpcyBgImRpdiJgLgogICAgdGFnTmFtZTogJ2RpdicsCgogICAgLy8galF1ZXJ5IGRlbGVnYXRlIGZvciBlbGVtZW50IGxvb2t1cCwgc2NvcGVkIHRvIERPTSBlbGVtZW50cyB3aXRoaW4gdGhlCiAgICAvLyBjdXJyZW50IHZpZXcuIFRoaXMgc2hvdWxkIGJlIHByZWZlcnJlZCB0byBnbG9iYWwgbG9va3VwcyB3aGVyZSBwb3NzaWJsZS4KICAgICQ6IGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLiRlbC5maW5kKHNlbGVjdG9yKTsKICAgIH0sCgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyAqKnJlbmRlcioqIGlzIHRoZSBjb3JlIGZ1bmN0aW9uIHRoYXQgeW91ciB2aWV3IHNob3VsZCBvdmVycmlkZSwgaW4gb3JkZXIKICAgIC8vIHRvIHBvcHVsYXRlIGl0cyBlbGVtZW50IChgdGhpcy5lbGApLCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBIVE1MLiBUaGUKICAgIC8vIGNvbnZlbnRpb24gaXMgZm9yICoqcmVuZGVyKiogdG8gYWx3YXlzIHJldHVybiBgdGhpc2AuCiAgICByZW5kZXI6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIHRoaXMgdmlldyBieSB0YWtpbmcgdGhlIGVsZW1lbnQgb3V0IG9mIHRoZSBET00sIGFuZCByZW1vdmluZyBhbnkKICAgIC8vIGFwcGxpY2FibGUgQmFja2JvbmUuRXZlbnRzIGxpc3RlbmVycy4KICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuJGVsLnJlbW92ZSgpOwogICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIENoYW5nZSB0aGUgdmlldydzIGVsZW1lbnQgKGB0aGlzLmVsYCBwcm9wZXJ0eSksIGluY2x1ZGluZyBldmVudAogICAgLy8gcmUtZGVsZWdhdGlvbi4KICAgIHNldEVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIGRlbGVnYXRlKSB7CiAgICAgIGlmICh0aGlzLiRlbCkgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIHRoaXMuJGVsID0gZWxlbWVudCBpbnN0YW5jZW9mIEJhY2tib25lLiQgPyBlbGVtZW50IDogQmFja2JvbmUuJChlbGVtZW50KTsKICAgICAgdGhpcy5lbCA9IHRoaXMuJGVsWzBdOwogICAgICBpZiAoZGVsZWdhdGUgIT09IGZhbHNlKSB0aGlzLmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBTZXQgY2FsbGJhY2tzLCB3aGVyZSBgdGhpcy5ldmVudHNgIGlzIGEgaGFzaCBvZgogICAgLy8KICAgIC8vICp7ImV2ZW50IHNlbGVjdG9yIjogImNhbGxiYWNrIn0qCiAgICAvLwogICAgLy8gICAgIHsKICAgIC8vICAgICAgICdtb3VzZWRvd24gLnRpdGxlJzogICdlZGl0JywKICAgIC8vICAgICAgICdjbGljayAuYnV0dG9uJzogICAgICdzYXZlJywKICAgIC8vICAgICAgICdjbGljayAub3Blbic6ICAgICAgIGZ1bmN0aW9uKGUpIHsgLi4uIH0KICAgIC8vICAgICB9CiAgICAvLwogICAgLy8gcGFpcnMuIENhbGxiYWNrcyB3aWxsIGJlIGJvdW5kIHRvIHRoZSB2aWV3LCB3aXRoIGB0aGlzYCBzZXQgcHJvcGVybHkuCiAgICAvLyBVc2VzIGV2ZW50IGRlbGVnYXRpb24gZm9yIGVmZmljaWVuY3kuCiAgICAvLyBPbWl0dGluZyB0aGUgc2VsZWN0b3IgYmluZHMgdGhlIGV2ZW50IHRvIGB0aGlzLmVsYC4KICAgIC8vIFRoaXMgb25seSB3b3JrcyBmb3IgZGVsZWdhdGUtYWJsZSBldmVudHM6IG5vdCBgZm9jdXNgLCBgYmx1cmAsIGFuZAogICAgLy8gbm90IGBjaGFuZ2VgLCBgc3VibWl0YCwgYW5kIGByZXNldGAgaW4gSW50ZXJuZXQgRXhwbG9yZXIuCiAgICBkZWxlZ2F0ZUV2ZW50czogZnVuY3Rpb24oZXZlbnRzKSB7CiAgICAgIGlmICghKGV2ZW50cyB8fCAoZXZlbnRzID0gXy5yZXN1bHQodGhpcywgJ2V2ZW50cycpKSkpIHJldHVybiB0aGlzOwogICAgICB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgZm9yICh2YXIga2V5IGluIGV2ZW50cykgewogICAgICAgIHZhciBtZXRob2QgPSBldmVudHNba2V5XTsKICAgICAgICBpZiAoIV8uaXNGdW5jdGlvbihtZXRob2QpKSBtZXRob2QgPSB0aGlzW2V2ZW50c1trZXldXTsKICAgICAgICBpZiAoIW1ldGhvZCkgY29udGludWU7CgogICAgICAgIHZhciBtYXRjaCA9IGtleS5tYXRjaChkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIpOwogICAgICAgIHZhciBldmVudE5hbWUgPSBtYXRjaFsxXSwgc2VsZWN0b3IgPSBtYXRjaFsyXTsKICAgICAgICBtZXRob2QgPSBfLmJpbmQobWV0aG9kLCB0aGlzKTsKICAgICAgICBldmVudE5hbWUgKz0gJy5kZWxlZ2F0ZUV2ZW50cycgKyB0aGlzLmNpZDsKICAgICAgICBpZiAoc2VsZWN0b3IgPT09ICcnKSB7CiAgICAgICAgICB0aGlzLiRlbC5vbihldmVudE5hbWUsIG1ldGhvZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJGVsLm9uKGV2ZW50TmFtZSwgc2VsZWN0b3IsIG1ldGhvZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBDbGVhcnMgYWxsIGNhbGxiYWNrcyBwcmV2aW91c2x5IGJvdW5kIHRvIHRoZSB2aWV3IHdpdGggYGRlbGVnYXRlRXZlbnRzYC4KICAgIC8vIFlvdSB1c3VhbGx5IGRvbid0IG5lZWQgdG8gdXNlIHRoaXMsIGJ1dCBtYXkgd2lzaCB0byBpZiB5b3UgaGF2ZSBtdWx0aXBsZQogICAgLy8gQmFja2JvbmUgdmlld3MgYXR0YWNoZWQgdG8gdGhlIHNhbWUgRE9NIGVsZW1lbnQuCiAgICB1bmRlbGVnYXRlRXZlbnRzOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy4kZWwub2ZmKCcuZGVsZWdhdGVFdmVudHMnICsgdGhpcy5jaWQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRW5zdXJlIHRoYXQgdGhlIFZpZXcgaGFzIGEgRE9NIGVsZW1lbnQgdG8gcmVuZGVyIGludG8uCiAgICAvLyBJZiBgdGhpcy5lbGAgaXMgYSBzdHJpbmcsIHBhc3MgaXQgdGhyb3VnaCBgJCgpYCwgdGFrZSB0aGUgZmlyc3QKICAgIC8vIG1hdGNoaW5nIGVsZW1lbnQsIGFuZCByZS1hc3NpZ24gaXQgdG8gYGVsYC4gT3RoZXJ3aXNlLCBjcmVhdGUKICAgIC8vIGFuIGVsZW1lbnQgZnJvbSB0aGUgYGlkYCwgYGNsYXNzTmFtZWAgYW5kIGB0YWdOYW1lYCBwcm9wZXJ0aWVzLgogICAgX2Vuc3VyZUVsZW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMuZWwpIHsKICAgICAgICB2YXIgYXR0cnMgPSBfLmV4dGVuZCh7fSwgXy5yZXN1bHQodGhpcywgJ2F0dHJpYnV0ZXMnKSk7CiAgICAgICAgaWYgKHRoaXMuaWQpIGF0dHJzLmlkID0gXy5yZXN1bHQodGhpcywgJ2lkJyk7CiAgICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKSBhdHRyc1snY2xhc3MnXSA9IF8ucmVzdWx0KHRoaXMsICdjbGFzc05hbWUnKTsKICAgICAgICB2YXIgJGVsID0gQmFja2JvbmUuJCgnPCcgKyBfLnJlc3VsdCh0aGlzLCAndGFnTmFtZScpICsgJz4nKS5hdHRyKGF0dHJzKTsKICAgICAgICB0aGlzLnNldEVsZW1lbnQoJGVsLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRFbGVtZW50KF8ucmVzdWx0KHRoaXMsICdlbCcpLCBmYWxzZSk7CiAgICAgIH0KICAgIH0KCiAgfSk7CgogIC8vIEJhY2tib25lLnN5bmMKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIE92ZXJyaWRlIHRoaXMgZnVuY3Rpb24gdG8gY2hhbmdlIHRoZSBtYW5uZXIgaW4gd2hpY2ggQmFja2JvbmUgcGVyc2lzdHMKICAvLyBtb2RlbHMgdG8gdGhlIHNlcnZlci4gWW91IHdpbGwgYmUgcGFzc2VkIHRoZSB0eXBlIG9mIHJlcXVlc3QsIGFuZCB0aGUKICAvLyBtb2RlbCBpbiBxdWVzdGlvbi4gQnkgZGVmYXVsdCwgbWFrZXMgYSBSRVNUZnVsIEFqYXggcmVxdWVzdAogIC8vIHRvIHRoZSBtb2RlbCdzIGB1cmwoKWAuIFNvbWUgcG9zc2libGUgY3VzdG9taXphdGlvbnMgY291bGQgYmU6CiAgLy8KICAvLyAqIFVzZSBgc2V0VGltZW91dGAgdG8gYmF0Y2ggcmFwaWQtZmlyZSB1cGRhdGVzIGludG8gYSBzaW5nbGUgcmVxdWVzdC4KICAvLyAqIFNlbmQgdXAgdGhlIG1vZGVscyBhcyBYTUwgaW5zdGVhZCBvZiBKU09OLgogIC8vICogUGVyc2lzdCBtb2RlbHMgdmlhIFdlYlNvY2tldHMgaW5zdGVhZCBvZiBBamF4LgogIC8vCiAgLy8gVHVybiBvbiBgQmFja2JvbmUuZW11bGF0ZUhUVFBgIGluIG9yZGVyIHRvIHNlbmQgYFBVVGAgYW5kIGBERUxFVEVgIHJlcXVlc3RzCiAgLy8gYXMgYFBPU1RgLCB3aXRoIGEgYF9tZXRob2RgIHBhcmFtZXRlciBjb250YWluaW5nIHRoZSB0cnVlIEhUVFAgbWV0aG9kLAogIC8vIGFzIHdlbGwgYXMgYWxsIHJlcXVlc3RzIHdpdGggdGhlIGJvZHkgYXMgYGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZGAKICAvLyBpbnN0ZWFkIG9mIGBhcHBsaWNhdGlvbi9qc29uYCB3aXRoIHRoZSBtb2RlbCBpbiBhIHBhcmFtIG5hbWVkIGBtb2RlbGAuCiAgLy8gVXNlZnVsIHdoZW4gaW50ZXJmYWNpbmcgd2l0aCBzZXJ2ZXItc2lkZSBsYW5ndWFnZXMgbGlrZSAqKlBIUCoqIHRoYXQgbWFrZQogIC8vIGl0IGRpZmZpY3VsdCB0byByZWFkIHRoZSBib2R5IG9mIGBQVVRgIHJlcXVlc3RzLgogIEJhY2tib25lLnN5bmMgPSBmdW5jdGlvbihtZXRob2QsIG1vZGVsLCBvcHRpb25zKSB7CiAgICB2YXIgdHlwZSA9IG1ldGhvZE1hcFttZXRob2RdOwoKICAgIC8vIERlZmF1bHQgb3B0aW9ucywgdW5sZXNzIHNwZWNpZmllZC4KICAgIF8uZGVmYXVsdHMob3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KSwgewogICAgICBlbXVsYXRlSFRUUDogQmFja2JvbmUuZW11bGF0ZUhUVFAsCiAgICAgIGVtdWxhdGVKU09OOiBCYWNrYm9uZS5lbXVsYXRlSlNPTgogICAgfSk7CgogICAgLy8gRGVmYXVsdCBKU09OLXJlcXVlc3Qgb3B0aW9ucy4KICAgIHZhciBwYXJhbXMgPSB7dHlwZTogdHlwZSwgZGF0YVR5cGU6ICdqc29uJ307CgogICAgLy8gRW5zdXJlIHRoYXQgd2UgaGF2ZSBhIFVSTC4KICAgIGlmICghb3B0aW9ucy51cmwpIHsKICAgICAgcGFyYW1zLnVybCA9IF8ucmVzdWx0KG1vZGVsLCAndXJsJykgfHwgdXJsRXJyb3IoKTsKICAgIH0KCiAgICAvLyBFbnN1cmUgdGhhdCB3ZSBoYXZlIHRoZSBhcHByb3ByaWF0ZSByZXF1ZXN0IGRhdGEuCiAgICBpZiAob3B0aW9ucy5kYXRhID09IG51bGwgJiYgbW9kZWwgJiYgKG1ldGhvZCA9PT0gJ2NyZWF0ZScgfHwgbWV0aG9kID09PSAndXBkYXRlJyB8fCBtZXRob2QgPT09ICdwYXRjaCcpKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi9qc29uJzsKICAgICAgcGFyYW1zLmRhdGEgPSBKU09OLnN0cmluZ2lmeShvcHRpb25zLmF0dHJzIHx8IG1vZGVsLnRvSlNPTihvcHRpb25zKSk7CiAgICB9CgogICAgLy8gRm9yIG9sZGVyIHNlcnZlcnMsIGVtdWxhdGUgSlNPTiBieSBlbmNvZGluZyB0aGUgcmVxdWVzdCBpbnRvIGFuIEhUTUwtZm9ybS4KICAgIGlmIChvcHRpb25zLmVtdWxhdGVKU09OKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwogICAgICBwYXJhbXMuZGF0YSA9IHBhcmFtcy5kYXRhID8ge21vZGVsOiBwYXJhbXMuZGF0YX0gOiB7fTsKICAgIH0KCiAgICAvLyBGb3Igb2xkZXIgc2VydmVycywgZW11bGF0ZSBIVFRQIGJ5IG1pbWlja2luZyB0aGUgSFRUUCBtZXRob2Qgd2l0aCBgX21ldGhvZGAKICAgIC8vIEFuZCBhbiBgWC1IVFRQLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgogICAgaWYgKG9wdGlvbnMuZW11bGF0ZUhUVFAgJiYgKHR5cGUgPT09ICdQVVQnIHx8IHR5cGUgPT09ICdERUxFVEUnIHx8IHR5cGUgPT09ICdQQVRDSCcpKSB7CiAgICAgIHBhcmFtcy50eXBlID0gJ1BPU1QnOwogICAgICBpZiAob3B0aW9ucy5lbXVsYXRlSlNPTikgcGFyYW1zLmRhdGEuX21ldGhvZCA9IHR5cGU7CiAgICAgIHZhciBiZWZvcmVTZW5kID0gb3B0aW9ucy5iZWZvcmVTZW5kOwogICAgICBvcHRpb25zLmJlZm9yZVNlbmQgPSBmdW5jdGlvbih4aHIpIHsKICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1IVFRQLU1ldGhvZC1PdmVycmlkZScsIHR5cGUpOwogICAgICAgIGlmIChiZWZvcmVTZW5kKSByZXR1cm4gYmVmb3JlU2VuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfQoKICAgIC8vIERvbid0IHByb2Nlc3MgZGF0YSBvbiBhIG5vbi1HRVQgcmVxdWVzdC4KICAgIGlmIChwYXJhbXMudHlwZSAhPT0gJ0dFVCcgJiYgIW9wdGlvbnMuZW11bGF0ZUpTT04pIHsKICAgICAgcGFyYW1zLnByb2Nlc3NEYXRhID0gZmFsc2U7CiAgICB9CgogICAgLy8gSWYgd2UncmUgc2VuZGluZyBhIGBQQVRDSGAgcmVxdWVzdCwgYW5kIHdlJ3JlIGluIGFuIG9sZCBJbnRlcm5ldCBFeHBsb3JlcgogICAgLy8gdGhhdCBzdGlsbCBoYXMgQWN0aXZlWCBlbmFibGVkIGJ5IGRlZmF1bHQsIG92ZXJyaWRlIGpRdWVyeSB0byB1c2UgdGhhdAogICAgLy8gZm9yIFhIUiBpbnN0ZWFkLiBSZW1vdmUgdGhpcyBsaW5lIHdoZW4galF1ZXJ5IHN1cHBvcnRzIGBQQVRDSGAgb24gSUU4LgogICAgaWYgKHBhcmFtcy50eXBlID09PSAnUEFUQ0gnICYmIG5vWGhyUGF0Y2gpIHsKICAgICAgcGFyYW1zLnhociA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKTsKICAgICAgfTsKICAgIH0KCiAgICAvLyBNYWtlIHRoZSByZXF1ZXN0LCBhbGxvd2luZyB0aGUgdXNlciB0byBvdmVycmlkZSBhbnkgQWpheCBvcHRpb25zLgogICAgdmFyIHhociA9IG9wdGlvbnMueGhyID0gQmFja2JvbmUuYWpheChfLmV4dGVuZChwYXJhbXMsIG9wdGlvbnMpKTsKICAgIG1vZGVsLnRyaWdnZXIoJ3JlcXVlc3QnLCBtb2RlbCwgeGhyLCBvcHRpb25zKTsKICAgIHJldHVybiB4aHI7CiAgfTsKCiAgdmFyIG5vWGhyUGF0Y2ggPQogICAgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgISF3aW5kb3cuQWN0aXZlWE9iamVjdCAmJgogICAgICAhKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCAmJiAobmV3IFhNTEh0dHBSZXF1ZXN0KS5kaXNwYXRjaEV2ZW50KTsKCiAgLy8gTWFwIGZyb20gQ1JVRCB0byBIVFRQIGZvciBvdXIgZGVmYXVsdCBgQmFja2JvbmUuc3luY2AgaW1wbGVtZW50YXRpb24uCiAgdmFyIG1ldGhvZE1hcCA9IHsKICAgICdjcmVhdGUnOiAnUE9TVCcsCiAgICAndXBkYXRlJzogJ1BVVCcsCiAgICAncGF0Y2gnOiAgJ1BBVENIJywKICAgICdkZWxldGUnOiAnREVMRVRFJywKICAgICdyZWFkJzogICAnR0VUJwogIH07CgogIC8vIFNldCB0aGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZiBgQmFja2JvbmUuYWpheGAgdG8gcHJveHkgdGhyb3VnaCB0byBgJGAuCiAgLy8gT3ZlcnJpZGUgdGhpcyBpZiB5b3UnZCBsaWtlIHRvIHVzZSBhIGRpZmZlcmVudCBsaWJyYXJ5LgogIEJhY2tib25lLmFqYXggPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBCYWNrYm9uZS4kLmFqYXguYXBwbHkoQmFja2JvbmUuJCwgYXJndW1lbnRzKTsKICB9OwoKICAvLyBCYWNrYm9uZS5Sb3V0ZXIKICAvLyAtLS0tLS0tLS0tLS0tLS0KCiAgLy8gUm91dGVycyBtYXAgZmF1eC1VUkxzIHRvIGFjdGlvbnMsIGFuZCBmaXJlIGV2ZW50cyB3aGVuIHJvdXRlcyBhcmUKICAvLyBtYXRjaGVkLiBDcmVhdGluZyBhIG5ldyBvbmUgc2V0cyBpdHMgYHJvdXRlc2AgaGFzaCwgaWYgbm90IHNldCBzdGF0aWNhbGx5LgogIHZhciBSb3V0ZXIgPSBCYWNrYm9uZS5Sb3V0ZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgaWYgKG9wdGlvbnMucm91dGVzKSB0aGlzLnJvdXRlcyA9IG9wdGlvbnMucm91dGVzOwogICAgdGhpcy5fYmluZFJvdXRlcygpOwogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKCiAgLy8gQ2FjaGVkIHJlZ3VsYXIgZXhwcmVzc2lvbnMgZm9yIG1hdGNoaW5nIG5hbWVkIHBhcmFtIHBhcnRzIGFuZCBzcGxhdHRlZAogIC8vIHBhcnRzIG9mIHJvdXRlIHN0cmluZ3MuCiAgdmFyIG9wdGlvbmFsUGFyYW0gPSAvXCgoLio/KVwpL2c7CiAgdmFyIG5hbWVkUGFyYW0gICAgPSAvKFwoXD8pPzpcdysvZzsKICB2YXIgc3BsYXRQYXJhbSAgICA9IC9cKlx3Ky9nOwogIHZhciBlc2NhcGVSZWdFeHAgID0gL1tcLXt9XFtcXSs/LixcXFxeJHwjXHNdL2c7CgogIC8vIFNldCB1cCBhbGwgaW5oZXJpdGFibGUgKipCYWNrYm9uZS5Sb3V0ZXIqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKFJvdXRlci5wcm90b3R5cGUsIEV2ZW50cywgewoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gTWFudWFsbHkgYmluZCBhIHNpbmdsZSBuYW1lZCByb3V0ZSB0byBhIGNhbGxiYWNrLiBGb3IgZXhhbXBsZToKICAgIC8vCiAgICAvLyAgICAgdGhpcy5yb3V0ZSgnc2VhcmNoLzpxdWVyeS9wOm51bScsICdzZWFyY2gnLCBmdW5jdGlvbihxdWVyeSwgbnVtKSB7CiAgICAvLyAgICAgICAuLi4KICAgIC8vICAgICB9KTsKICAgIC8vCiAgICByb3V0ZTogZnVuY3Rpb24ocm91dGUsIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIGlmICghXy5pc1JlZ0V4cChyb3V0ZSkpIHJvdXRlID0gdGhpcy5fcm91dGVUb1JlZ0V4cChyb3V0ZSk7CiAgICAgIGlmIChfLmlzRnVuY3Rpb24obmFtZSkpIHsKICAgICAgICBjYWxsYmFjayA9IG5hbWU7CiAgICAgICAgbmFtZSA9ICcnOwogICAgICB9CiAgICAgIGlmICghY2FsbGJhY2spIGNhbGxiYWNrID0gdGhpc1tuYW1lXTsKICAgICAgdmFyIHJvdXRlciA9IHRoaXM7CiAgICAgIEJhY2tib25lLmhpc3Rvcnkucm91dGUocm91dGUsIGZ1bmN0aW9uKGZyYWdtZW50KSB7CiAgICAgICAgdmFyIGFyZ3MgPSByb3V0ZXIuX2V4dHJhY3RQYXJhbWV0ZXJzKHJvdXRlLCBmcmFnbWVudCk7CiAgICAgICAgcm91dGVyLmV4ZWN1dGUoY2FsbGJhY2ssIGFyZ3MpOwogICAgICAgIHJvdXRlci50cmlnZ2VyLmFwcGx5KHJvdXRlciwgWydyb3V0ZTonICsgbmFtZV0uY29uY2F0KGFyZ3MpKTsKICAgICAgICByb3V0ZXIudHJpZ2dlcigncm91dGUnLCBuYW1lLCBhcmdzKTsKICAgICAgICBCYWNrYm9uZS5oaXN0b3J5LnRyaWdnZXIoJ3JvdXRlJywgcm91dGVyLCBuYW1lLCBhcmdzKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBFeGVjdXRlIGEgcm91dGUgaGFuZGxlciB3aXRoIHRoZSBwcm92aWRlZCBwYXJhbWV0ZXJzLiAgVGhpcyBpcyBhbgogICAgLy8gZXhjZWxsZW50IHBsYWNlIHRvIGRvIHByZS1yb3V0ZSBzZXR1cCBvciBwb3N0LXJvdXRlIGNsZWFudXAuCiAgICBleGVjdXRlOiBmdW5jdGlvbihjYWxsYmFjaywgYXJncykgewogICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfSwKCiAgICAvLyBTaW1wbGUgcHJveHkgdG8gYEJhY2tib25lLmhpc3RvcnlgIHRvIHNhdmUgYSBmcmFnbWVudCBpbnRvIHRoZSBoaXN0b3J5LgogICAgbmF2aWdhdGU6IGZ1bmN0aW9uKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUoZnJhZ21lbnQsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gQmluZCBhbGwgZGVmaW5lZCByb3V0ZXMgdG8gYEJhY2tib25lLmhpc3RvcnlgLiBXZSBoYXZlIHRvIHJldmVyc2UgdGhlCiAgICAvLyBvcmRlciBvZiB0aGUgcm91dGVzIGhlcmUgdG8gc3VwcG9ydCBiZWhhdmlvciB3aGVyZSB0aGUgbW9zdCBnZW5lcmFsCiAgICAvLyByb3V0ZXMgY2FuIGJlIGRlZmluZWQgYXQgdGhlIGJvdHRvbSBvZiB0aGUgcm91dGUgbWFwLgogICAgX2JpbmRSb3V0ZXM6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMucm91dGVzKSByZXR1cm47CiAgICAgIHRoaXMucm91dGVzID0gXy5yZXN1bHQodGhpcywgJ3JvdXRlcycpOwogICAgICB2YXIgcm91dGUsIHJvdXRlcyA9IF8ua2V5cyh0aGlzLnJvdXRlcyk7CiAgICAgIHdoaWxlICgocm91dGUgPSByb3V0ZXMucG9wKCkpICE9IG51bGwpIHsKICAgICAgICB0aGlzLnJvdXRlKHJvdXRlLCB0aGlzLnJvdXRlc1tyb3V0ZV0pOwogICAgICB9CiAgICB9LAoKICAgIC8vIENvbnZlcnQgYSByb3V0ZSBzdHJpbmcgaW50byBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgc3VpdGFibGUgZm9yIG1hdGNoaW5nCiAgICAvLyBhZ2FpbnN0IHRoZSBjdXJyZW50IGxvY2F0aW9uIGhhc2guCiAgICBfcm91dGVUb1JlZ0V4cDogZnVuY3Rpb24ocm91dGUpIHsKICAgICAgcm91dGUgPSByb3V0ZS5yZXBsYWNlKGVzY2FwZVJlZ0V4cCwgJ1xcJCYnKQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2Uob3B0aW9uYWxQYXJhbSwgJyg/OiQxKT8nKQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2UobmFtZWRQYXJhbSwgZnVuY3Rpb24obWF0Y2gsIG9wdGlvbmFsKSB7CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25hbCA/IG1hdGNoIDogJyhbXi8/XSspJzsKICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAucmVwbGFjZShzcGxhdFBhcmFtLCAnKFteP10qPyknKTsKICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoJ14nICsgcm91dGUgKyAnKD86XFw/KFtcXHNcXFNdKikpPyQnKTsKICAgIH0sCgogICAgLy8gR2l2ZW4gYSByb3V0ZSwgYW5kIGEgVVJMIGZyYWdtZW50IHRoYXQgaXQgbWF0Y2hlcywgcmV0dXJuIHRoZSBhcnJheSBvZgogICAgLy8gZXh0cmFjdGVkIGRlY29kZWQgcGFyYW1ldGVycy4gRW1wdHkgb3IgdW5tYXRjaGVkIHBhcmFtZXRlcnMgd2lsbCBiZQogICAgLy8gdHJlYXRlZCBhcyBgbnVsbGAgdG8gbm9ybWFsaXplIGNyb3NzLWJyb3dzZXIgYmVoYXZpb3IuCiAgICBfZXh0cmFjdFBhcmFtZXRlcnM6IGZ1bmN0aW9uKHJvdXRlLCBmcmFnbWVudCkgewogICAgICB2YXIgcGFyYW1zID0gcm91dGUuZXhlYyhmcmFnbWVudCkuc2xpY2UoMSk7CiAgICAgIHJldHVybiBfLm1hcChwYXJhbXMsIGZ1bmN0aW9uKHBhcmFtLCBpKSB7CiAgICAgICAgLy8gRG9uJ3QgZGVjb2RlIHRoZSBzZWFyY2ggcGFyYW1zLgogICAgICAgIGlmIChpID09PSBwYXJhbXMubGVuZ3RoIC0gMSkgcmV0dXJuIHBhcmFtIHx8IG51bGw7CiAgICAgICAgcmV0dXJuIHBhcmFtID8gZGVjb2RlVVJJQ29tcG9uZW50KHBhcmFtKSA6IG51bGw7CiAgICAgIH0pOwogICAgfQoKICB9KTsKCiAgLy8gQmFja2JvbmUuSGlzdG9yeQogIC8vIC0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gSGFuZGxlcyBjcm9zcy1icm93c2VyIGhpc3RvcnkgbWFuYWdlbWVudCwgYmFzZWQgb24gZWl0aGVyCiAgLy8gW3B1c2hTdGF0ZV0oaHR0cDovL2RpdmVpbnRvaHRtbDUuaW5mby9oaXN0b3J5Lmh0bWwpIGFuZCByZWFsIFVSTHMsIG9yCiAgLy8gW29uaGFzaGNoYW5nZV0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9ET00vd2luZG93Lm9uaGFzaGNoYW5nZSkKICAvLyBhbmQgVVJMIGZyYWdtZW50cy4gSWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgbmVpdGhlciAob2xkIElFLCBuYXRjaCksCiAgLy8gZmFsbHMgYmFjayB0byBwb2xsaW5nLgogIHZhciBIaXN0b3J5ID0gQmFja2JvbmUuSGlzdG9yeSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5oYW5kbGVycyA9IFtdOwogICAgXy5iaW5kQWxsKHRoaXMsICdjaGVja1VybCcpOwoKICAgIC8vIEVuc3VyZSB0aGF0IGBIaXN0b3J5YCBjYW4gYmUgdXNlZCBvdXRzaWRlIG9mIHRoZSBicm93c2VyLgogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRoaXMubG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb247CiAgICAgIHRoaXMuaGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5OwogICAgfQogIH07CgogIC8vIENhY2hlZCByZWdleCBmb3Igc3RyaXBwaW5nIGEgbGVhZGluZyBoYXNoL3NsYXNoIGFuZCB0cmFpbGluZyBzcGFjZS4KICB2YXIgcm91dGVTdHJpcHBlciA9IC9eWyNcL118XHMrJC9nOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHN0cmlwcGluZyBsZWFkaW5nIGFuZCB0cmFpbGluZyBzbGFzaGVzLgogIHZhciByb290U3RyaXBwZXIgPSAvXlwvK3xcLyskL2c7CgogIC8vIENhY2hlZCByZWdleCBmb3IgZGV0ZWN0aW5nIE1TSUUuCiAgdmFyIGlzRXhwbG9yZXIgPSAvbXNpZSBbXHcuXSsvOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHJlbW92aW5nIGEgdHJhaWxpbmcgc2xhc2guCiAgdmFyIHRyYWlsaW5nU2xhc2ggPSAvXC8kLzsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciBzdHJpcHBpbmcgdXJscyBvZiBoYXNoLgogIHZhciBwYXRoU3RyaXBwZXIgPSAvIy4qJC87CgogIC8vIEhhcyB0aGUgaGlzdG9yeSBoYW5kbGluZyBhbHJlYWR5IGJlZW4gc3RhcnRlZD8KICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLkhpc3RvcnkqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKEhpc3RvcnkucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBpbnRlcnZhbCB0byBwb2xsIGZvciBoYXNoIGNoYW5nZXMsIGlmIG5lY2Vzc2FyeSwgaXMKICAgIC8vIHR3ZW50eSB0aW1lcyBhIHNlY29uZC4KICAgIGludGVydmFsOiA1MCwKCiAgICAvLyBBcmUgd2UgYXQgdGhlIGFwcCByb290PwogICAgYXRSb290OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvW15cL10kLywgJyQmLycpID09PSB0aGlzLnJvb3Q7CiAgICB9LAoKICAgIC8vIEdldHMgdGhlIHRydWUgaGFzaCB2YWx1ZS4gQ2Fubm90IHVzZSBsb2NhdGlvbi5oYXNoIGRpcmVjdGx5IGR1ZSB0byBidWcKICAgIC8vIGluIEZpcmVmb3ggd2hlcmUgbG9jYXRpb24uaGFzaCB3aWxsIGFsd2F5cyBiZSBkZWNvZGVkLgogICAgZ2V0SGFzaDogZnVuY3Rpb24od2luZG93KSB7CiAgICAgIHZhciBtYXRjaCA9ICh3aW5kb3cgfHwgdGhpcykubG9jYXRpb24uaHJlZi5tYXRjaCgvIyguKikkLyk7CiAgICAgIHJldHVybiBtYXRjaCA/IG1hdGNoWzFdIDogJyc7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgY3Jvc3MtYnJvd3NlciBub3JtYWxpemVkIFVSTCBmcmFnbWVudCwgZWl0aGVyIGZyb20gdGhlIFVSTCwKICAgIC8vIHRoZSBoYXNoLCBvciB0aGUgb3ZlcnJpZGUuCiAgICBnZXRGcmFnbWVudDogZnVuY3Rpb24oZnJhZ21lbnQsIGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgIGlmIChmcmFnbWVudCA9PSBudWxsKSB7CiAgICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSB8fCAhdGhpcy5fd2FudHNIYXNoQ2hhbmdlIHx8IGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgICAgICBmcmFnbWVudCA9IGRlY29kZVVSSSh0aGlzLmxvY2F0aW9uLnBhdGhuYW1lICsgdGhpcy5sb2NhdGlvbi5zZWFyY2gpOwogICAgICAgICAgdmFyIHJvb3QgPSB0aGlzLnJvb3QucmVwbGFjZSh0cmFpbGluZ1NsYXNoLCAnJyk7CiAgICAgICAgICBpZiAoIWZyYWdtZW50LmluZGV4T2Yocm9vdCkpIGZyYWdtZW50ID0gZnJhZ21lbnQuc2xpY2Uocm9vdC5sZW5ndGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZnJhZ21lbnQucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICB9LAoKICAgIC8vIFN0YXJ0IHRoZSBoYXNoIGNoYW5nZSBoYW5kbGluZywgcmV0dXJuaW5nIGB0cnVlYCBpZiB0aGUgY3VycmVudCBVUkwgbWF0Y2hlcwogICAgLy8gYW4gZXhpc3Rpbmcgcm91dGUsIGFuZCBgZmFsc2VgIG90aGVyd2lzZS4KICAgIHN0YXJ0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGlmIChIaXN0b3J5LnN0YXJ0ZWQpIHRocm93IG5ldyBFcnJvcigiQmFja2JvbmUuaGlzdG9yeSBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQiKTsKICAgICAgSGlzdG9yeS5zdGFydGVkID0gdHJ1ZTsKCiAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIGluaXRpYWwgY29uZmlndXJhdGlvbi4gRG8gd2UgbmVlZCBhbiBpZnJhbWU/CiAgICAgIC8vIElzIHB1c2hTdGF0ZSBkZXNpcmVkIC4uLiBpcyBpdCBhdmFpbGFibGU/CiAgICAgIHRoaXMub3B0aW9ucyAgICAgICAgICA9IF8uZXh0ZW5kKHtyb290OiAnLyd9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICB0aGlzLnJvb3QgICAgICAgICAgICAgPSB0aGlzLm9wdGlvbnMucm9vdDsKICAgICAgdGhpcy5fd2FudHNIYXNoQ2hhbmdlID0gdGhpcy5vcHRpb25zLmhhc2hDaGFuZ2UgIT09IGZhbHNlOwogICAgICB0aGlzLl93YW50c1B1c2hTdGF0ZSAgPSAhIXRoaXMub3B0aW9ucy5wdXNoU3RhdGU7CiAgICAgIHRoaXMuX2hhc1B1c2hTdGF0ZSAgICA9ICEhKHRoaXMub3B0aW9ucy5wdXNoU3RhdGUgJiYgdGhpcy5oaXN0b3J5ICYmIHRoaXMuaGlzdG9yeS5wdXNoU3RhdGUpOwogICAgICB2YXIgZnJhZ21lbnQgICAgICAgICAgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIHZhciBkb2NNb2RlICAgICAgICAgICA9IGRvY3VtZW50LmRvY3VtZW50TW9kZTsKICAgICAgdmFyIG9sZElFICAgICAgICAgICAgID0gKGlzRXhwbG9yZXIuZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpICYmICghZG9jTW9kZSB8fCBkb2NNb2RlIDw9IDcpKTsKCiAgICAgIC8vIE5vcm1hbGl6ZSByb290IHRvIGFsd2F5cyBpbmNsdWRlIGEgbGVhZGluZyBhbmQgdHJhaWxpbmcgc2xhc2guCiAgICAgIHRoaXMucm9vdCA9ICgnLycgKyB0aGlzLnJvb3QgKyAnLycpLnJlcGxhY2Uocm9vdFN0cmlwcGVyLCAnLycpOwoKICAgICAgaWYgKG9sZElFICYmIHRoaXMuX3dhbnRzSGFzaENoYW5nZSkgewogICAgICAgIHZhciBmcmFtZSA9IEJhY2tib25lLiQoJzxpZnJhbWUgc3JjPSJqYXZhc2NyaXB0OjAiIHRhYmluZGV4PSItMSI+Jyk7CiAgICAgICAgdGhpcy5pZnJhbWUgPSBmcmFtZS5oaWRlKCkuYXBwZW5kVG8oJ2JvZHknKVswXS5jb250ZW50V2luZG93OwogICAgICAgIHRoaXMubmF2aWdhdGUoZnJhZ21lbnQpOwogICAgICB9CgogICAgICAvLyBEZXBlbmRpbmcgb24gd2hldGhlciB3ZSdyZSB1c2luZyBwdXNoU3RhdGUgb3IgaGFzaGVzLCBhbmQgd2hldGhlcgogICAgICAvLyAnb25oYXNoY2hhbmdlJyBpcyBzdXBwb3J0ZWQsIGRldGVybWluZSBob3cgd2UgY2hlY2sgdGhlIFVSTCBzdGF0ZS4KICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSkgewogICAgICAgIEJhY2tib25lLiQod2luZG93KS5vbigncG9wc3RhdGUnLCB0aGlzLmNoZWNrVXJsKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgKCdvbmhhc2hjaGFuZ2UnIGluIHdpbmRvdykgJiYgIW9sZElFKSB7CiAgICAgICAgQmFja2JvbmUuJCh3aW5kb3cpLm9uKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7CiAgICAgICAgdGhpcy5fY2hlY2tVcmxJbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMuY2hlY2tVcmwsIHRoaXMuaW50ZXJ2YWwpOwogICAgICB9CgogICAgICAvLyBEZXRlcm1pbmUgaWYgd2UgbmVlZCB0byBjaGFuZ2UgdGhlIGJhc2UgdXJsLCBmb3IgYSBwdXNoU3RhdGUgbGluawogICAgICAvLyBvcGVuZWQgYnkgYSBub24tcHVzaFN0YXRlIGJyb3dzZXIuCiAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKICAgICAgdmFyIGxvYyA9IHRoaXMubG9jYXRpb247CgogICAgICAvLyBUcmFuc2l0aW9uIGZyb20gaGFzaENoYW5nZSB0byBwdXNoU3RhdGUgb3IgdmljZSB2ZXJzYSBpZiBib3RoIGFyZQogICAgICAvLyByZXF1ZXN0ZWQuCiAgICAgIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgdGhpcy5fd2FudHNQdXNoU3RhdGUpIHsKCiAgICAgICAgLy8gSWYgd2UndmUgc3RhcnRlZCBvZmYgd2l0aCBhIHJvdXRlIGZyb20gYSBgcHVzaFN0YXRlYC1lbmFibGVkCiAgICAgICAgLy8gYnJvd3NlciwgYnV0IHdlJ3JlIGN1cnJlbnRseSBpbiBhIGJyb3dzZXIgdGhhdCBkb2Vzbid0IHN1cHBvcnQgaXQuLi4KICAgICAgICBpZiAoIXRoaXMuX2hhc1B1c2hTdGF0ZSAmJiAhdGhpcy5hdFJvb3QoKSkgewogICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQobnVsbCwgdHJ1ZSk7CiAgICAgICAgICB0aGlzLmxvY2F0aW9uLnJlcGxhY2UodGhpcy5yb290ICsgJyMnICsgdGhpcy5mcmFnbWVudCk7CiAgICAgICAgICAvLyBSZXR1cm4gaW1tZWRpYXRlbHkgYXMgYnJvd3NlciB3aWxsIGRvIHJlZGlyZWN0IHRvIG5ldyB1cmwKICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBPciBpZiB3ZSd2ZSBzdGFydGVkIG91dCB3aXRoIGEgaGFzaC1iYXNlZCByb3V0ZSwgYnV0IHdlJ3JlIGN1cnJlbnRseQogICAgICAgIC8vIGluIGEgYnJvd3NlciB3aGVyZSBpdCBjb3VsZCBiZSBgcHVzaFN0YXRlYC1iYXNlZCBpbnN0ZWFkLi4uCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgJiYgdGhpcy5hdFJvb3QoKSAmJiBsb2MuaGFzaCkgewogICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpLnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgICAgICAgdGhpcy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIHRoaXMucm9vdCArIHRoaXMuZnJhZ21lbnQpOwogICAgICAgIH0KCiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5vcHRpb25zLnNpbGVudCkgcmV0dXJuIHRoaXMubG9hZFVybCgpOwogICAgfSwKCiAgICAvLyBEaXNhYmxlIEJhY2tib25lLmhpc3RvcnksIHBlcmhhcHMgdGVtcG9yYXJpbHkuIE5vdCB1c2VmdWwgaW4gYSByZWFsIGFwcCwKICAgIC8vIGJ1dCBwb3NzaWJseSB1c2VmdWwgZm9yIHVuaXQgdGVzdGluZyBSb3V0ZXJzLgogICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgIEJhY2tib25lLiQod2luZG93KS5vZmYoJ3BvcHN0YXRlJywgdGhpcy5jaGVja1VybCkub2ZmKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIGlmICh0aGlzLl9jaGVja1VybEludGVydmFsKSBjbGVhckludGVydmFsKHRoaXMuX2NoZWNrVXJsSW50ZXJ2YWwpOwogICAgICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKICAgIH0sCgogICAgLy8gQWRkIGEgcm91dGUgdG8gYmUgdGVzdGVkIHdoZW4gdGhlIGZyYWdtZW50IGNoYW5nZXMuIFJvdXRlcyBhZGRlZCBsYXRlcgogICAgLy8gbWF5IG92ZXJyaWRlIHByZXZpb3VzIHJvdXRlcy4KICAgIHJvdXRlOiBmdW5jdGlvbihyb3V0ZSwgY2FsbGJhY2spIHsKICAgICAgdGhpcy5oYW5kbGVycy51bnNoaWZ0KHtyb3V0ZTogcm91dGUsIGNhbGxiYWNrOiBjYWxsYmFja30pOwogICAgfSwKCiAgICAvLyBDaGVja3MgdGhlIGN1cnJlbnQgVVJMIHRvIHNlZSBpZiBpdCBoYXMgY2hhbmdlZCwgYW5kIGlmIGl0IGhhcywKICAgIC8vIGNhbGxzIGBsb2FkVXJsYCwgbm9ybWFsaXppbmcgYWNyb3NzIHRoZSBoaWRkZW4gaWZyYW1lLgogICAgY2hlY2tVcmw6IGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIGlmIChjdXJyZW50ID09PSB0aGlzLmZyYWdtZW50ICYmIHRoaXMuaWZyYW1lKSB7CiAgICAgICAgY3VycmVudCA9IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSk7CiAgICAgIH0KICAgICAgaWYgKGN1cnJlbnQgPT09IHRoaXMuZnJhZ21lbnQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKHRoaXMuaWZyYW1lKSB0aGlzLm5hdmlnYXRlKGN1cnJlbnQpOwogICAgICB0aGlzLmxvYWRVcmwoKTsKICAgIH0sCgogICAgLy8gQXR0ZW1wdCB0byBsb2FkIHRoZSBjdXJyZW50IFVSTCBmcmFnbWVudC4gSWYgYSByb3V0ZSBzdWNjZWVkcyB3aXRoIGEKICAgIC8vIG1hdGNoLCByZXR1cm5zIGB0cnVlYC4gSWYgbm8gZGVmaW5lZCByb3V0ZXMgbWF0Y2hlcyB0aGUgZnJhZ21lbnQsCiAgICAvLyByZXR1cm5zIGBmYWxzZWAuCiAgICBsb2FkVXJsOiBmdW5jdGlvbihmcmFnbWVudCkgewogICAgICBmcmFnbWVudCA9IHRoaXMuZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KGZyYWdtZW50KTsKICAgICAgcmV0dXJuIF8uYW55KHRoaXMuaGFuZGxlcnMsIGZ1bmN0aW9uKGhhbmRsZXIpIHsKICAgICAgICBpZiAoaGFuZGxlci5yb3V0ZS50ZXN0KGZyYWdtZW50KSkgewogICAgICAgICAgaGFuZGxlci5jYWxsYmFjayhmcmFnbWVudCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBTYXZlIGEgZnJhZ21lbnQgaW50byB0aGUgaGFzaCBoaXN0b3J5LCBvciByZXBsYWNlIHRoZSBVUkwgc3RhdGUgaWYgdGhlCiAgICAvLyAncmVwbGFjZScgb3B0aW9uIGlzIHBhc3NlZC4gWW91IGFyZSByZXNwb25zaWJsZSBmb3IgcHJvcGVybHkgVVJMLWVuY29kaW5nCiAgICAvLyB0aGUgZnJhZ21lbnQgaW4gYWR2YW5jZS4KICAgIC8vCiAgICAvLyBUaGUgb3B0aW9ucyBvYmplY3QgY2FuIGNvbnRhaW4gYHRyaWdnZXI6IHRydWVgIGlmIHlvdSB3aXNoIHRvIGhhdmUgdGhlCiAgICAvLyByb3V0ZSBjYWxsYmFjayBiZSBmaXJlZCAobm90IHVzdWFsbHkgZGVzaXJhYmxlKSwgb3IgYHJlcGxhY2U6IHRydWVgLCBpZgogICAgLy8geW91IHdpc2ggdG8gbW9kaWZ5IHRoZSBjdXJyZW50IFVSTCB3aXRob3V0IGFkZGluZyBhbiBlbnRyeSB0byB0aGUgaGlzdG9yeS4KICAgIG5hdmlnYXRlOiBmdW5jdGlvbihmcmFnbWVudCwgb3B0aW9ucykgewogICAgICBpZiAoIUhpc3Rvcnkuc3RhcnRlZCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAoIW9wdGlvbnMgfHwgb3B0aW9ucyA9PT0gdHJ1ZSkgb3B0aW9ucyA9IHt0cmlnZ2VyOiAhIW9wdGlvbnN9OwoKICAgICAgdmFyIHVybCA9IHRoaXMucm9vdCArIChmcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoZnJhZ21lbnQgfHwgJycpKTsKCiAgICAgIC8vIFN0cmlwIHRoZSBoYXNoIGZvciBtYXRjaGluZy4KICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudC5yZXBsYWNlKHBhdGhTdHJpcHBlciwgJycpOwoKICAgICAgaWYgKHRoaXMuZnJhZ21lbnQgPT09IGZyYWdtZW50KSByZXR1cm47CiAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKCiAgICAgIC8vIERvbid0IGluY2x1ZGUgYSB0cmFpbGluZyBzbGFzaCBvbiB0aGUgcm9vdC4KICAgICAgaWYgKGZyYWdtZW50ID09PSAnJyAmJiB1cmwgIT09ICcvJykgdXJsID0gdXJsLnNsaWNlKDAsIC0xKTsKCiAgICAgIC8vIElmIHB1c2hTdGF0ZSBpcyBhdmFpbGFibGUsIHdlIHVzZSBpdCB0byBzZXQgdGhlIGZyYWdtZW50IGFzIGEgcmVhbCBVUkwuCiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHsKICAgICAgICB0aGlzLmhpc3Rvcnlbb3B0aW9ucy5yZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oe30sIGRvY3VtZW50LnRpdGxlLCB1cmwpOwoKICAgICAgLy8gSWYgaGFzaCBjaGFuZ2VzIGhhdmVuJ3QgYmVlbiBleHBsaWNpdGx5IGRpc2FibGVkLCB1cGRhdGUgdGhlIGhhc2gKICAgICAgLy8gZnJhZ21lbnQgdG8gc3RvcmUgaGlzdG9yeS4KICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHsKICAgICAgICB0aGlzLl91cGRhdGVIYXNoKHRoaXMubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIGlmICh0aGlzLmlmcmFtZSAmJiAoZnJhZ21lbnQgIT09IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSkpKSB7CiAgICAgICAgICAvLyBPcGVuaW5nIGFuZCBjbG9zaW5nIHRoZSBpZnJhbWUgdHJpY2tzIElFNyBhbmQgZWFybGllciB0byBwdXNoIGEKICAgICAgICAgIC8vIGhpc3RvcnkgZW50cnkgb24gaGFzaC10YWcgY2hhbmdlLiAgV2hlbiByZXBsYWNlIGlzIHRydWUsIHdlIGRvbid0CiAgICAgICAgICAvLyB3YW50IHRoaXMuCiAgICAgICAgICBpZighb3B0aW9ucy5yZXBsYWNlKSB0aGlzLmlmcmFtZS5kb2N1bWVudC5vcGVuKCkuY2xvc2UoKTsKICAgICAgICAgIHRoaXMuX3VwZGF0ZUhhc2godGhpcy5pZnJhbWUubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIH0KCiAgICAgIC8vIElmIHlvdSd2ZSB0b2xkIHVzIHRoYXQgeW91IGV4cGxpY2l0bHkgZG9uJ3Qgd2FudCBmYWxsYmFjayBoYXNoY2hhbmdlLQogICAgICAvLyBiYXNlZCBoaXN0b3J5LCB0aGVuIGBuYXZpZ2F0ZWAgYmVjb21lcyBhIHBhZ2UgcmVmcmVzaC4KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5sb2NhdGlvbi5hc3NpZ24odXJsKTsKICAgICAgfQogICAgICBpZiAob3B0aW9ucy50cmlnZ2VyKSByZXR1cm4gdGhpcy5sb2FkVXJsKGZyYWdtZW50KTsKICAgIH0sCgogICAgLy8gVXBkYXRlIHRoZSBoYXNoIGxvY2F0aW9uLCBlaXRoZXIgcmVwbGFjaW5nIHRoZSBjdXJyZW50IGVudHJ5LCBvciBhZGRpbmcKICAgIC8vIGEgbmV3IG9uZSB0byB0aGUgYnJvd3NlciBoaXN0b3J5LgogICAgX3VwZGF0ZUhhc2g6IGZ1bmN0aW9uKGxvY2F0aW9uLCBmcmFnbWVudCwgcmVwbGFjZSkgewogICAgICBpZiAocmVwbGFjZSkgewogICAgICAgIHZhciBocmVmID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKC8oamF2YXNjcmlwdDp8IykuKiQvLCAnJyk7CiAgICAgICAgbG9jYXRpb24ucmVwbGFjZShocmVmICsgJyMnICsgZnJhZ21lbnQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNvbWUgYnJvd3NlcnMgcmVxdWlyZSB0aGF0IGBoYXNoYCBjb250YWlucyBhIGxlYWRpbmcgIy4KICAgICAgICBsb2NhdGlvbi5oYXNoID0gJyMnICsgZnJhZ21lbnQ7CiAgICAgIH0KICAgIH0KCiAgfSk7CgogIC8vIENyZWF0ZSB0aGUgZGVmYXVsdCBCYWNrYm9uZS5oaXN0b3J5LgogIEJhY2tib25lLmhpc3RvcnkgPSBuZXcgSGlzdG9yeTsKCiAgLy8gSGVscGVycwogIC8vIC0tLS0tLS0KCiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvcnJlY3RseSBzZXQgdXAgdGhlIHByb3RvdHlwZSBjaGFpbiwgZm9yIHN1YmNsYXNzZXMuCiAgLy8gU2ltaWxhciB0byBgZ29vZy5pbmhlcml0c2AsIGJ1dCB1c2VzIGEgaGFzaCBvZiBwcm90b3R5cGUgcHJvcGVydGllcyBhbmQKICAvLyBjbGFzcyBwcm9wZXJ0aWVzIHRvIGJlIGV4dGVuZGVkLgogIHZhciBleHRlbmQgPSBmdW5jdGlvbihwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgdmFyIHBhcmVudCA9IHRoaXM7CiAgICB2YXIgY2hpbGQ7CgogICAgLy8gVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciB0aGUgbmV3IHN1YmNsYXNzIGlzIGVpdGhlciBkZWZpbmVkIGJ5IHlvdQogICAgLy8gKHRoZSAiY29uc3RydWN0b3IiIHByb3BlcnR5IGluIHlvdXIgYGV4dGVuZGAgZGVmaW5pdGlvbiksIG9yIGRlZmF1bHRlZAogICAgLy8gYnkgdXMgdG8gc2ltcGx5IGNhbGwgdGhlIHBhcmVudCdzIGNvbnN0cnVjdG9yLgogICAgaWYgKHByb3RvUHJvcHMgJiYgXy5oYXMocHJvdG9Qcm9wcywgJ2NvbnN0cnVjdG9yJykpIHsKICAgICAgY2hpbGQgPSBwcm90b1Byb3BzLmNvbnN0cnVjdG9yOwogICAgfSBlbHNlIHsKICAgICAgY2hpbGQgPSBmdW5jdGlvbigpeyByZXR1cm4gcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH07CiAgICB9CgogICAgLy8gQWRkIHN0YXRpYyBwcm9wZXJ0aWVzIHRvIHRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiwgaWYgc3VwcGxpZWQuCiAgICBfLmV4dGVuZChjaGlsZCwgcGFyZW50LCBzdGF0aWNQcm9wcyk7CgogICAgLy8gU2V0IHRoZSBwcm90b3R5cGUgY2hhaW4gdG8gaW5oZXJpdCBmcm9tIGBwYXJlbnRgLCB3aXRob3V0IGNhbGxpbmcKICAgIC8vIGBwYXJlbnRgJ3MgY29uc3RydWN0b3IgZnVuY3Rpb24uCiAgICB2YXIgU3Vycm9nYXRlID0gZnVuY3Rpb24oKXsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9OwogICAgU3Vycm9nYXRlLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7CiAgICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgU3Vycm9nYXRlOwoKICAgIC8vIEFkZCBwcm90b3R5cGUgcHJvcGVydGllcyAoaW5zdGFuY2UgcHJvcGVydGllcykgdG8gdGhlIHN1YmNsYXNzLAogICAgLy8gaWYgc3VwcGxpZWQuCiAgICBpZiAocHJvdG9Qcm9wcykgXy5leHRlbmQoY2hpbGQucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKCiAgICAvLyBTZXQgYSBjb252ZW5pZW5jZSBwcm9wZXJ0eSBpbiBjYXNlIHRoZSBwYXJlbnQncyBwcm90b3R5cGUgaXMgbmVlZGVkCiAgICAvLyBsYXRlci4KICAgIGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7CgogICAgcmV0dXJuIGNoaWxkOwogIH07CgogIC8vIFNldCB1cCBpbmhlcml0YW5jZSBmb3IgdGhlIG1vZGVsLCBjb2xsZWN0aW9uLCByb3V0ZXIsIHZpZXcgYW5kIGhpc3RvcnkuCiAgTW9kZWwuZXh0ZW5kID0gQ29sbGVjdGlvbi5leHRlbmQgPSBSb3V0ZXIuZXh0ZW5kID0gVmlldy5leHRlbmQgPSBIaXN0b3J5LmV4dGVuZCA9IGV4dGVuZDsKCiAgLy8gVGhyb3cgYW4gZXJyb3Igd2hlbiBhIFVSTCBpcyBuZWVkZWQsIGFuZCBub25lIGlzIHN1cHBsaWVkLgogIHZhciB1cmxFcnJvciA9IGZ1bmN0aW9uKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdBICJ1cmwiIHByb3BlcnR5IG9yIGZ1bmN0aW9uIG11c3QgYmUgc3BlY2lmaWVkJyk7CiAgfTsKCiAgLy8gV3JhcCBhbiBvcHRpb25hbCBlcnJvciBjYWxsYmFjayB3aXRoIGEgZmFsbGJhY2sgZXJyb3IgZXZlbnQuCiAgdmFyIHdyYXBFcnJvciA9IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICB2YXIgZXJyb3IgPSBvcHRpb25zLmVycm9yOwogICAgb3B0aW9ucy5lcnJvciA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgaWYgKGVycm9yKSBlcnJvcihtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIG1vZGVsLnRyaWdnZXIoJ2Vycm9yJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgfTsKICB9OwoKICByZXR1cm4gQmFja2JvbmU7Cgp9KSk7CgovKgogKiBhbiBleHBlcmltZW50YWwgbXNtcyBzcGVjdHJ1bQogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwTVNNU1NwZWN0cnVtJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ0NvbmZpZyddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgY29uZmlnKSB7CiAgICB2YXIgRXhwTVNNU1NwZWN0cnVtID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIHVybFJvb3QgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9tc21zc3BlY3RydW0nCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfSwKICAgICAgICBzaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnbW96cycpID09IHVuZGVmaW5lZCkgPyAwIDogc2VsZi5nZXQoJ21venMnKS5sZW5ndGg7CiAgICAgICAgfSwKICAgICAgICBmZXRjaCA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgICAgICB2YXIgdXJsID0gc2VsZi51cmxSb290KCkgKyAnLycgKyBzZWxmLmlkOwogICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJhbXMgJiYgb3B0aW9ucy5wYXJhbXMuZmllbGRzID09PSAncHJlY3Vyc29yT25seScpIHsKICAgICAgICAgICAgICAgIHVybCArPSAnP2ZpZWxkcz1wcmVjdXJzb3JPbmx5JzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkLmdldEpTT04odXJsLCB7fSwgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgZm9yIChrIGluIG0pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldChrLCBtW2tdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2VzcyhzZWxmKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgdmFyIG0gPSAnJzsKICAgICAgICAgICAgICAgIGZvciAoaSBpbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgbSArPSBpICsgJzogJyArIGVbaV0gKyAnICAnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA6ICdGZXRjaGluZ1hIUkV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA6IG0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIG1venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCJtb3pzIik7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiByZXR1cm4gYSBuZXcgRXhwZSBzdGVjdHJ1bSwgd2l0aCBhbGwgZnJhZ21lbnQgcGVha3Mgc2hpZnRlZCBieSBhIGdpdmVuIHZhbHVlCiAgICAgICAgICovCiAgICAgICAgc2hpZnRCeU1veiA6IGZ1bmN0aW9uKGRlbHRhKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNwID0gc2VsZi5jbG9uZSgpOwogICAgICAgICAgICBzcC5zZXQoJ21venMnLCBzZWxmLmdldCgnbW96cycpLm1hcChmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbSArIGRlbHRhCiAgICAgICAgICAgIH0pKQogICAgICAgICAgICByZXR1cm4gc3A7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogYWRkIGFsbCBmcmFnbWVudCBmcm9tIHNwZWN0cnVtIHNwIHRvIHRoZSBjdXJyZW50IG9uZSBhbmQgY3JlYXRlIGEgbmV3IG9uZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlcgogICAgICAgICAqLwogICAgICAgIGNvbmNhdEZyYWdtZW50cyA6IGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNwID0gc2VsZi5jbG9uZSgpOwoKICAgICAgICAgICAgdmFyIGNvbmNhdFBlYWtzID0gXy56aXAoc2VsZi5nZXQoJ21venMnKS5jb25jYXQob3RoZXIuZ2V0KCdtb3pzJykpLCBzZWxmLmdldCgnaW50ZW5zaXRpZXMnKS5jb25jYXQob3RoZXIuZ2V0KCdpbnRlbnNpdGllcycpKSwgc2VsZi5nZXQoJ2ludGVuc2l0eVJhbmtzJykuY29uY2F0KG90aGVyLmdldCgnaW50ZW5zaXR5UmFua3MnKSkpLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGFbMF0gLSBiWzBdCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc3Auc2V0KCdtb3pzJywgXy5wbHVjayhjb25jYXRQZWFrcywgMCkpCiAgICAgICAgICAgIHNwLnNldCgnaW50ZW5zaXRpZXMnLCBfLnBsdWNrKGNvbmNhdFBlYWtzLCAxKSkKICAgICAgICAgICAgc3Auc2V0KCdpbnRlbnNpdHlSYW5rcycsIF8ucGx1Y2soY29uY2F0UGVha3MsIDIpKQoKICAgICAgICAgICAgcmV0dXJuIHNwOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIEV4cE1TTVNTcGVjdHJ1bTsKfSk7CgovKgogKiBqdXN0IGEgY29sbGVjdGlvbiBvZiBFeHBNU01TU3BlY3RydW0gCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9FeHBNU01TU3BlY3RydW0nLCBdLCBmdW5jdGlvbihCYWNrYm9uZSwgRXhwTVNNU1NwZWN0cnVtKSB7CiAgICB2YXIgRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICBtb2RlbCA6IEV4cE1TTVNTcGVjdHJ1bSwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uOwp9KTsKCi8qCiAqIGFuIG1zbXNydW4gY2FuIGJlIG9uZSBvYmplY3QsIHdpdGhlIG1vcmUgb3IgbGVzcyBpbmZvcm1hdGlvbi4gdGhpcyBpbmZvcm1hdGlvbiBjYW4gYmUgcG9wdWxhdGVkIGF0IG9uY2Ugd2l0aCB0aGUgbXNtc3J1biBhcGkgb3IgZW5oYW5jZWQgYWZ0ZXJ3YXJkcyB0aHJvdWdoIHRoZSBtc21zc3BlY3RydW0gZ2V0dGVyczoKICogIC0ganVzdCBydW4gaW5mbyAoaWQgJiBuYW1lKQogKiAgLSBtc21zU3BlY3RyYSBkYXRhLCBidXQgb25seSBhdCB0aGUgcHJlY3Vyc29yIGxldmVsIChtc21zPXRydWUmbm9QZWFrcz10cnVlKQogKiAgLSBvbmx5IHRoZSBrIG1vc3QgaW50ZW5zZSBwZWFrcyAobXNtcz10cnVlJm1heFBlYWtzPWspCiAqIC0gIGFsbCBtc21zIGluZm8gKG1zbXM9dHJ1ZSkKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L01TTVNSdW4nLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnQ29uZmlnJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbiddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgY29uZmlnLCBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKSB7CiAgICB2YXIgTVNNU1J1biA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICB1cmxSb290IDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBjb25maWcuZ2V0KCd3ZXQudXJsLnJlc3QnKSArICcvbXNtc3J1bicKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFwcGx5IHRoZSBjYWxsYmFjayBhcmd1bWVudCBvbiB0aGUgb2JqZWN0LCBidXQgb25seSBpZiBvciBvbmNlIHRoZSBtc21zIGluZm8gaGFzIGJlZW4gbG9hZGVkCiAgICAgICAgICovCiAgICAgICAgd2l0aE1zbXMgOiBmdW5jdGlvbihjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChzZWxmLmdldCgnbXNtcycpKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayhzZWxmKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnJlYWRNc21zSW5mbyh7CiAgICAgICAgICAgICAgICBzdWNjZXNzIDogY2FsbGJhY2sKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqICBsb2FkIG1zbXMgaW5mb3JtYXRpb24sIGJ1dCBubyBwZWFrIGxpc3QKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAqLwogICAgICAgIHJlYWRNc21zSW5mbyA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzCiAgICAgICAgICAgIHZhciB1cmwgPSBzZWxmLnVybFJvb3QoKSArICcvJyArIHNlbGYuZ2V0KCdpZCcpICsgJz9tc21zPXRydWUmbm9QZWFrcz10cnVlJzsKCiAgICAgICAgICAgICQuZ2V0SlNPTih1cmwsIHt9LCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldCgnbXNtcycsIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKGRhdGEubXNtc1NwZWN0cmEpKTsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnN1Y2Nlc3Moc2VsZikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgIH0sCiAgICAgICAgZ2V0TVNNU1N1YkNvbGxlY3Rpb24gOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuaWRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oXy5jb2xsZWN0KG9wdGlvbnMuaWRzLCBmdW5jdGlvbihpZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdtc21zJykuZ2V0KGlkKTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5zY2FuTnVtYmVycykgewogICAgICAgICAgICAgICAgdmFyIGtleXMgPSB7fQogICAgICAgICAgICAgICAgXy5lYWNoKG9wdGlvbnMuc2Nhbk51bWJlcnMsIGZ1bmN0aW9uKHNuKSB7CiAgICAgICAgICAgICAgICAgICAga2V5c1siIiArIHNuXSA9IHRydWU7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKHNlbGYuZ2V0KCdtc21zJykuZmlsdGVyKGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleXNbIiIgKyBzcC5nZXQoJ3NjYW5OdW1iZXInKV07CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ211c3QgZ2V0TVNNU1N1YkNvbGxlY3Rpb24gb24gaWRzIG9yIHNuYU51bWJlcnMgbGlzdCBvZiB2YWxzJykKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBnZXQgdGhlIE1TTVNTdWJDb2xsZWN0aW9ucywgdGhlbiBwb3B1bGF0ZSBpdCB3aXRoIHRoZSBtc21zIHBlYWtsaXN0IGFuZCBjYWxsIGEgc3VjY2VzcyBjYWxsYmFjayBpZiBhbnkKICAgICAgICAgKi8KICAgICAgICBmZXRjaE1TTVMgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNvbCA9IHNlbGYuZ2V0TVNNU1N1YkNvbGxlY3Rpb24ob3B0aW9ucyk7CiAgICAgICAgICAgIHZhciBjb2xOb01TTVMgPSBjb2wuZmlsdGVyKGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3AuZ2V0KCdtb3pzJykgPT0gbnVsbDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBuID0gY29sTm9NU01TLmxlbmd0aDsKICAgICAgICAgICAgaWYgKG4gPT0gMCAmJiBvcHRpb25zLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2Vzcyhjb2wpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNwdCA9IDA7CiAgICAgICAgICAgIF8uZWFjaChjb2xOb01TTVMsIGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICBzcC5mZXRjaCh7CiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjcHQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNwdCA9PSBuICYmIG9wdGlvbnMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKGNvbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogYWx0aG91Z2ggdGhlIG91dGNvbWUgaXMgc2ltaWxhciwgdGhpcyBtZXRoaWQgZGlmZmVycyBmcm9tIGZldGNoTVNNUyh7c2NhbnNOdW1iZXJzOi4uLn0pIGluIHRoZSBzZW5zZSB0aGF0IHdlIGRvbid0IG5lZWQgdG8gbG9hZCB0aGUgZnVsbCBydW4gdG8gdHJhbnNsYXRlIHNjYW4gbnVtYmVyIGludG8gaWRzLi4uCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNjYW5OdW1iZXIKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAqLwogICAgICAgIGZldGNoTVNNU0Zyb21TY2FuTnVtYmVycyA6IGZ1bmN0aW9uKHNjYW5zLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHVybCA9IHNlbGYudXJsUm9vdCgpICsgJy8nICsgc2VsZi5nZXQoJ2lkJykgKyAnL21zbXNmcm9tc2NhbnMvJyArIHNjYW5zLmpvaW4oJywnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICQuZ2V0SlNPTih1cmwsIHt9LCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICB2YXIgY29sID0gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oZGF0YSk7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKHNlbGYsIGNvbCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gTVNNU1J1bjsKfSk7CgovKioKICogYmFzaWMgbWF0aCB1dGlsaXRpZXMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy91dGlscy9NYXRoVXRpbHMnLFsndW5kZXJzY29yZSddLCBmdW5jdGlvbiAoXykgewogICAgdmFyIE1hdGhVdGlscyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICB9CiAgICAvKioKICAgICAqIFNpbXBzb24gaW50ZWdyYXRpb24gb3ZlciB4LHkgdmFsdWVzCiAgICAgKiBAcGFyYW0geAogICAgICogQHBhcmFtIHkKICAgICAqIEByZXR1cm4ge251bWJlcn0KICAgICAqLwogICAgTWF0aFV0aWxzLnByb3RvdHlwZS5pbnRlZ3JhdGUgPSBmdW5jdGlvbiAoeCwgeSkgewogICAgICAgIHZhciBzID0gMC4wOwogICAgICAgIF8udGltZXMoeC5sZW5ndGggLSAxLCBmdW5jdGlvbiAoaSkgewogICAgICAgICAgICBzICs9IDEuMCAqICh4W2kgKyAxXSAtIHhbaV0pICogKHlbaV0gKyB5W2kgKyAxXSkKICAgICAgICB9KQogICAgICAgIHJldHVybiBzIC8gMi4wCiAgICB9CgogICAgLyoqCiAgICAgKiBsaW5lYXIgaW50ZXJwb2xhdGlvbQogICAgICogeHMgJiB5cyBhcmUgdGhlIGtub3duIG1lYXN1cmVzCiAgICAgKiB4cyBtdXN0IGJlIHNvcnRlZCBhbmQgc3RyaWNsdHkgaW5jcmVhc2luZwogICAgICoKICAgICAqIGZvciBhIGdpdmVuIHgsIHJldHVybiB0aGUgeXMnIGludGVycG9sYXRpb24gYmV0d2VlbiB0aGUgdHdvIGNsb3Nlc3Qgc3Vycm91bmRpaW5nIHhzJwogICAgICogYXNraW5nIGZvciBhbiB4IG91dHNpZGUgYm91bmRhcmllcyB3aWxsIHJldHVybiBOYU4KICAgICAqCiAgICAgKiBAcGFyYW0ge09iamVjdH0geHMKICAgICAqIEBwYXJhbSB7T2JqZWN0fSB5cwogICAgICogQHBhcmFtIHtPYmplY3R9IHgKICAgICAqLwogICAgTWF0aFV0aWxzLnByb3RvdHlwZS5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uICh4cywgeXMsIHgpIHsKICAgICAgICB2YXIgbiA9IF8uc2l6ZSh4cykKICAgICAgICBpZiAobiA9PSAwIHx8IHggPCB4c1swXSB8fCB4ID4geHNbbiAtIDFdKSB7CiAgICAgICAgICAgIHJldHVybiBOYU47CiAgICAgICAgfQogICAgICAgIHZhciBpMSA9IDAsIGkyID0gbiAtIDE7CiAgICAgICAgd2hpbGUgKGkyIC0gaTEgPiAxKSB7CiAgICAgICAgICAgIHZhciBpbSA9IE1hdGguZmxvb3IoKGkxICsgaTIpIC8gMikKICAgICAgICAgICAgaWYgKHggPCB4c1tpbV0pIHsKICAgICAgICAgICAgICAgIGkyID0gaW0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGkxID0gaW0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gIHlzW2kxXSArICh4IC0geHNbaTFdKSAvICh4c1tpMl0gLSB4c1tpMV0pICogKHlzW2kyXSAtIHlzW2kxXSkKCiAgICB9CgogICAgcmV0dXJuIG5ldyBNYXRoVXRpbHMoKQp9KTsKCi8qCiAqIEdldCB0aGUgaW5zdHJ1bWVudCBwYXJhbWV0ZXJzLgogKiBNYWlubHk6CiAqIC0gcHJlY3Vyc29yVG9sCiAqIC0gZnJhZ21lbnRUb2wKICogVG9sZXJhbmNlIGFyZSBleHByZXNzZWQgaW4gcHBtCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL3dldC9JbnN0cnVtZW50UGFyYW1zJyxbCiAgICAnQmFja2JvbmUnLAogICAgJ0NvbmZpZycKXSwgZnVuY3Rpb24gKEJhY2tib25lLCBjb25maWcpIHsKICAgIHZhciBJbnN0cnVtZW50UGFyYW1zID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICBmcmFnbWVudFRvbDogdW5kZWZpbmVkLAogICAgICAgICAgICBwcmVjdXJzb3JUb2w6IHVuZGVmaW5lZCwKICAgICAgICB9LAogICAgICAgIHVybDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gY29uZmlnLmdldCgnd2V0LnVybC5yZXN0JykgKyAnL2luc3RydW1lbnRwYXJhbXMvJyArIHRoaXMuZ2V0KCdpZCcpCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuICd0b2w6JyArIHNlbGYuZ2V0KCdwcmVjdXJzb3JUb2wnKSArICcvJyArIHNlbGYuZ2V0KCdmcmFnbWVudFRvbCcpOwogICAgICAgIH0sCiAgICAgICAgdG9Kc29uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHByZWN1cnNvclRvbDogc2VsZi5nZXQoJ3ByZWN1cnNvclRvbCcpLAogICAgICAgICAgICAgICAgZnJhZ21lbnRUb2w6IHNlbGYuZ2V0KCdmcmFnbWVudFRvbCcpCiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgIH0pOwogICAgcmV0dXJuIEluc3RydW1lbnRQYXJhbXM7Cn0pOwoKLyoKICogQ3Jvc3MgSW9uIENocm9tYXRvZ3JhbS4KICogQ29udGFpbnMgbWFpbmx5IHR3byBhcnJheXMgb2YgZmxvYXQ6CiAqIC0gcmV0ZW50aW9uVGltZXMKICogLSBpbnRlbnNpdGllcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvWElDJyxbJ0JhY2tib25lJywgJ0NvbmZpZyddLCBmdW5jdGlvbihCYWNrYm9uZSwgY29uZmlnKSB7CiAgICB2YXIgWElDID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHNpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdyZXRlbnRpb25UaW1lcycpLmxlbmd0aAogICAgICAgIH0sCgogICAgICAgIHRvSlNPTiA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBqc29uID0gWElDLl9fc3VwZXJfXy50b0pTT04uY2FsbChzZWxmKTsKCiAgICAgICAgICAgIGlmKGpzb24ucmljaFNlcXVlbmNlKXsKICAgICAgICAgICAgICAgIGpzb24ucmljaFNlcXVlbmNlID0ganNvbi5yaWNoU2VxdWVuY2UudG9TdHJpbmcoKTsgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vanNvbmlmeSBtZW1lYmVycyAobXNtcywgcmljaFNlcXVlbmNlIGFuZCBjbykKICAgICAgICAgICAgdmFyIGtzID0gXy5rZXlzKGpzb24pCiAgICAgICAgICAgIF8uZWFjaChrcywgZnVuY3Rpb24oayl7CiAgICAgICAgICAgICAgICBpZighICgoanNvbltrXSBpbnN0YW5jZW9mIEJhY2tib25lLk1vZGVsKSB8fCAoanNvbltrXSBpbnN0YW5jZW9mIEJhY2tib25lLkNvbGxlY3Rpb24pKSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBqc29uW2tdID0ganNvbltrXS50b0pTT04oKQogICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm4ganNvbgogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIFhJQzsKfSk7CgovKgogKiBhbiBJbmplY3Rpb24gaGFuZGxlcyBvbmUgZXhwZXJpbWVudGFsIHJ1biAoTVNSdW4pLCB0b2xlcmFuY2VzICwgbmFtZSBldGMuCiAqIEl0IGlzIHR5cGljYWxseSBmZWN0aGVkIGZyb20gYSBzZXJ2ZXIuCiAqIFByb3BlcnRpZXMKICogKiBhIG5hbWUKICogKiBhbiBNU01TUnVuCiAqICogYW4gSW5zdHJ1bWVudFBhcmFtcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvSW5qZWN0aW9uJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ0NvbmZpZycsICdmaXNodG9uZXMvdXRpbHMvTWF0aFV0aWxzJywgJy4vSW5zdHJ1bWVudFBhcmFtcycsICcuL1hJQycsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvTVNNU1J1biddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGNvbmZpZywgbWF0aFV0aWxzLCBJbnN0cnVtZW50UGFyYW1zLCBYSUMsIEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24sIE1TTVNSdW4pIHsKICAgIHZhciBJbmplY3Rpb24gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICB9LAogICAgICAgICAgICB1cmxSb290OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmdldCgnd2V0LnVybC5yZXN0JykgKyAnL2luamVjdGlvbic7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVybHM6IHsKICAgICAgICAgICAgICAgIGNocm9tYXRvWGljOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9jaHJvbWF0by94aWMnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB0aGUgc2V0IG1ldGhvZCBuZWVkcyB0byBiZSBzbGlnaGx0eSBvdmVycmlkZW4sIGJlYWNhdXNlCiAgICAgICAgICAgICAqIC0gYW4gaW5zdHJ1bWVudFBhcmFtcyBhdHRyIHNob3VsZCBiZSBjYXN0IGludG8gYW4gYWN0dWFsIEluc3RydW1lbnRQYXJhbXMKICAgICAgICAgICAgICogLSBhbiBydW5JbmZvIGF0dHIgc2hhbGwgYmUgY2FzdGVkIGludG8gYW4gTVNNU1J1biwgZXZlbmUgaWYgaXQgZG9lcyBub3QgY29udGFpbiBtdWNoCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBhdHRycwogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIC8vbG92ZSB0aGF0LiBhcmd1bWVudCBjYW4gZWl0aGVyIGJlIGEgbWFwIGFuZCBhbiBvYmplY3Qgb3IgYSBrZXkgYW5kIGEgdmFsdWUKICAgICAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKGF0dHJzKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBrID0gYXR0cnM7CiAgICAgICAgICAgICAgICAgICAgYXR0cnMgPSB7fTsKICAgICAgICAgICAgICAgICAgICBhdHRyc1trXSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9tb2RpZnkgZXhpc3RpbmcgaW5zdHJ1bW1lbnQgcGFyYW1zCiAgICAgICAgICAgICAgICBpZiAoYXR0cnMuaW5zdHJ1bWVudFBhcmFtcyAmJiAoIShhdHRycy5pbnN0cnVtZW50UGFyYW1zIGluc3RhbmNlb2YgSW5zdHJ1bWVudFBhcmFtcykpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuZ2V0KCdpbnN0cnVtZW50UGFyYW1zJykgaW5zdGFuY2VvZiBJbnN0cnVtZW50UGFyYW1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdpbnN0cnVtZW50UGFyYW1zJykuc2V0KGF0dHJzLmluc3RydW1lbnRQYXJhbXMpOwogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgYXR0cnMuaW5zdHJ1bWVudFBhcmFtcwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLmluc3RydW1lbnRQYXJhbXMgPSBuZXcgSW5zdHJ1bWVudFBhcmFtcyhhdHRycy5pbnN0cnVtZW50UGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGFuZ2luZyBhbiBlbWJlZGRlZCBpbnN0cnVtZW50IHBhcmFtcyBidWJibGUgdGhlIGV2ZW50Li4uCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLmluc3RydW1lbnRQYXJhbXMub24oJ2NoYW5nZScsIGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdjaGFuZ2VJbnN0cnVtZW50UGFyYW1zJywgY3R4LmNoYW5nZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGF0dHJzLnJ1bkluZm8pIHsKICAgICAgICAgICAgICAgICAgICBhdHRycy5ydW4gPSBuZXcgTVNNU1J1bihhdHRycy5ydW5JbmZvKQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBhdHRycy5ydW5JbmZvCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGFzayBmb3IgYSBYSUMsIGVucmljaGVkIHdpdGggTVNNUyBmb3IgYSBnaXZlbiBtYXNzIGFuZCBjYWxsYmFjayBvbiBzdWNjZXNzCiAgICAgICAgICAgICAqIEFzIHRoZSBpbmplY3Rpb24ga25vdyB0aGUgcHJlY3Vyc29yIHRvbGVyYW5jZSAodmlhIHRoZSBpbnN0cnVtZW50UGFyYW1zKSwgbWFzcyBpcyBlbm91Z2ggdG8gZ2V0IHRoZSBYSUMuCiAgICAgICAgICAgICAqIEBwYXJhbSBtYXNzCiAgICAgICAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAgICAgICAqIEBwYXJhbSBjYWxsYmFjayBhIGZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSByZXR1cm4geGljLiB0aGUgY2FsbCBiYWNrIGNhbiBhbHNvIGJlIHNwZWNpZmllZCB0aHJvdWdoIHRoZSBzdWNjZXNzIG9wdGlvbnMKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGNocm9tYXRvWGljOiBmdW5jdGlvbiAobWFzcywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMyAmJiBvcHRpb25zICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgYnVpbGRNc01zUG9pbnRlcnMgPSBmdW5jdGlvbiAoeGljUlQsIHhpY0ludGVucywgbXNtc1NwZWN0cmEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5tYXAobXNtc1NwZWN0cmEsIGZ1bmN0aW9uIChzcCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcnQgPSBzcC5yZXRlbnRpb25UaW1lOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW50ZW5zID0gbWF0aFV0aWxzLmludGVycG9sYXRlKHhpY1JULCB4aWNJbnRlbnMsIHJ0KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY3RydW06IHNwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGludGVucwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzZWxmLnVybHMuY2hyb21hdG9YaWMoKSArICcvJyArIHNlbGYuZ2V0KCdpZCcpICsgJz9tPScgKyBtYXNzICsgJyZtc21zPXRydWUnOwogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY2hhcmdlKSB7CiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICcmej0nICsgb3B0aW9ucy5jaGFyZ2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1cmwgKz0gJyZwcmVjVG9sPScgKyBzZWxmLmdldCgnaW5zdHJ1bWVudFBhcmFtcycpLmdldCgncHJlY3Vyc29yVG9sJyk7CiAgICAgICAgICAgICAgICAkLmdldEpTT04odXJsLCB7fSwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgeGljID0gbmV3IFhJQygkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hc3M6IG1hc3MKICAgICAgICAgICAgICAgICAgICB9LCBvcHRpb25zKSkKICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdpZCcsIHNlbGYuZ2V0KCdpZCcpICsgJ18nICsgbWFzcykKCiAgICAgICAgICAgICAgICAgICAgLy9iYWNrd2FyZHMgY29tcGF0aWJpbGl0eQogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmV4cFNwZWN0cmEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJzID0gYnVpbGRNc01zUG9pbnRlcnMoZGF0YS5yZXRlbnRpb25UaW1lcywgZGF0YS5pbnRlbnNpdGllcywgZGF0YS5leHBTcGVjdHJhKQogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zJywgbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oXy5wbHVjayhwb2ludGVycywgJ3NwZWN0cnVtJykpKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGljLnNldCgnbXNtc1BvaW50ZXJzJywgcG9pbnRlcnMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtc21zID0gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oZGF0YS5tc21zLmV4cFNwZWN0cmEpOwogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zJywgbXNtcyk7CgogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zUG9pbnRlcnMnLCBfLmNvbGxlY3QoXy56aXAoZGF0YS5tc21zLnNwZWN0cmFJZHMsIGRhdGEubXNtcy5yZXRlbnRpb25UaW1lcywgZGF0YS5tc21zLmludGVuc2l0aWVzKSwgZnVuY3Rpb24gKGEsIGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcCA9IG1zbXMuZ2V0KGFbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjdHJ1bTogc3AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogYVsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGFbMl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgeGljLnNldCgncmV0ZW50aW9uVGltZXMnLCBkYXRhLnJldGVudGlvblRpbWVzKQogICAgICAgICAgICAgICAgICAgIHhpYy5zZXQoJ2ludGVuc2l0aWVzJywgZGF0YS5pbnRlbnNpdGllcykKCiAgICAgICAgICAgICAgICAgICAgeGljLnNldCgnaW5qZWN0aW9uSW5mbycsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHNlbGYuZ2V0KCdpZCcpLAogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hJZDogc2VsZi5nZXQoJ3NlYXJjaElkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlbGYuZ2V0KCduYW1lJykKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soeGljKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIDsKICAgIHJldHVybiBJbmplY3Rpb247Cn0pCjsKCi8qCiAqIGp1c3QgYSBjb2xsZWN0aW9uIG9mIEluamVjdGlvbgogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvSW5qZWN0aW9uQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9JbmplY3Rpb24nLCBdLCBmdW5jdGlvbihCYWNrYm9uZSwgSW5qZWN0aW9uKSB7CiAgICB2YXIgSW5qZWN0aW9uQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICBtb2RlbCA6IEluamVjdGlvbiwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBJbmplY3Rpb25Db2xsZWN0aW9uOwp9KTsKCgovKgogKiBBbiBleHBlcmltZW50IGNvbnRhaW5zIG1haW5seSBhIGxpc3Qgb2YgaW5qZWN0aW9ucyAoYWNxdWlyZWQgc2FtcGxlcykKICogUHJvcGVydGllczoKICogLSBpbmplY3Rpb246IGFycmF5IG9mIEluamVjdGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwZXJpbWVudCcsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvSW5qZWN0aW9uJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvSW5qZWN0aW9uQ29sbGVjdGlvbiddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGNvbmZpZywgSW5qZWN0aW9uLCBJbmplY3Rpb25Db2xsZWN0aW9uKSB7CiAgICB2YXIgRXhwZXJpbWVudCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIHVybFJvb3Q6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9leHBlcmltZW50JwogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAvL2xvdmUgdGhhdC4gYXJndW1lbnQgY2FuIGVpdGhlciBiZSBhIG1hcCBhbmQgYW4gb2JqZWN0IG9yIGEga2V5IGFuZCBhIHZhbHVlCiAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKGF0dHJzKSkgewogICAgICAgICAgICAgICAgdmFyIGsgPSBhdHRyczsKICAgICAgICAgICAgICAgIGF0dHJzID0ge307CiAgICAgICAgICAgICAgICBhdHRyc1trXSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9tb2RpZnkgZXhpc3RpbmcgSW5qZWN0aW9uIHBhcmFtcwogICAgICAgICAgICBpZiAoYXR0cnMuaW5qZWN0aW9ucyAmJiAoIShhdHRycy5pbmplY3Rpb25zIGluc3RhbmNlb2YgSW5qZWN0aW9uQ29sbGVjdGlvbikpKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXQoJ2luamVjdGlvbnMnKSBpbnN0YW5jZW9mIEluamVjdGlvbkNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmdldCgnaW5qZWN0aW9ucycpLnJlc2V0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0KCdpbmplY3Rpb25zJywgbmV3IEluamVjdGlvbkNvbGxlY3Rpb24oKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmdldCgnaW5qZWN0aW9ucycpLmFkZChfLmNvbGxlY3QoYXR0cnMuaW5qZWN0aW9ucywgZnVuY3Rpb24gKHBpbmopIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEluamVjdGlvbihwaW5qKQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgZGVsZXRlIGF0dHJzLmluamVjdGlvbnMKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFkZCBhbiBpbmplY3Rpb24gdG8gdGhlIGxpc3QuCiAgICAgICAgICogQHBhcmFtIGluagogICAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAgICogQHJldHVybiB7RXhwZXJpbWVudH0KICAgICAgICAgKi8KICAgICAgICBpbmplY3Rpb25zX2FkZDogZnVuY3Rpb24gKGluaiwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYuZ2V0KCdpbmplY3Rpb25zJykuYWRkKGluaikKICAgICAgICAgICAgaWYgKG9wdGlvbnMuc2F2ZSkgewogICAgICAgICAgICAgICAgdmFyIHVybCA9IHNlbGYudXJsUm9vdCgpICsgJy8nICsgc2VsZi5nZXQoJ2lkJykgKyAnL2luamVjdGlvbnMvJyArIGluai5nZXQoJ2lkJyk7CiAgICAgICAgICAgICAgICAkLmFqYXgodXJsLCB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BVVCcsCiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzczogb3B0aW9ucy5zdWNjZXNzCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBFeHBlcmltZW50Owp9KTsKCi8qCiAqIGp1c3QgYSBjb2xsZWN0aW9uIG9mIFhJQywgd2l0aCBhbiBhdHRhY2hlZCBjb2xsZWN0aW9uIGxlZ2VuZCBjb250YWluZXIKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9YSUMnXSwgZnVuY3Rpb24oQmFja2JvbmUsIFhJQykgewogIHZhciBYSUNDb2xsZWN0aW9uTGVnZW5kID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgIGRlZmF1bHRzIDogewoKICAgIH0sCiAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuX2xlZ2VuZHMgPSBbXTsKICAgIH0sCiAgICByZXNldCA6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLl9sZWdlbmRzLmxlbmd0aCA9IDA7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlIDp7CiAgICAgKiAgIG5hbWU6IHBlcHRpZGUgbmFtZQogICAgICogICBtYXNzZXM6IFtdIGFycmF5IG9mIG1hc3Nlcywgd2hlcmUgbWFzc2VzW2ldIGlzIHRoZSBtYXNzIGZvciBjaGFyZ2UgaQogICAgICogfQogICAgICovCiAgICBhZGQgOiBmdW5jdGlvbihlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLl9sZWdlbmRzLnB1c2goewogICAgICAgIG5hbWUgOiBlLm5hbWUgfHwgJ24vYScsCiAgICAgICAgbWFzc2VzIDogZS5tYXNzZXMgfHwgW10KICAgICAgfSk7CiAgICAgIF90aGlzLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICByZXR1cm4gX3RoaXM7CiAgICB9LAogICAgc2l6ZSA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVnZW5kcy5sZW5ndGg7CiAgICB9LAogICAgbGlzdCA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVnZW5kczsKICAgIH0KICB9KTsKCiAgdmFyIFhJQ0NvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICBtb2RlbCA6IFhJQywKICAgIGRlZmF1bHRzIDogewogICAgfSwKICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLmxlZ2VuZHMgPSBuZXcgWElDQ29sbGVjdGlvbkxlZ2VuZCgpOwogICAgfQogIH0pOwoKICByZXR1cm4gWElDQ29sbGVjdGlvbjsKfSk7CgohZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdCl7cmV0dXJuIHQ+bj8tMTpuPnQ/MTpuPj10PzA6MC8wfWZ1bmN0aW9uIHQobil7cmV0dXJuIG51bGwhPW4mJiFpc05hTihuKX1mdW5jdGlvbiBlKG4pe3JldHVybntsZWZ0OmZ1bmN0aW9uKHQsZSxyLHUpe2Zvcihhcmd1bWVudHMubGVuZ3RoPDMmJihyPTApLGFyZ3VtZW50cy5sZW5ndGg8NCYmKHU9dC5sZW5ndGgpO3U+cjspe3ZhciBpPXIrdT4+PjE7bih0W2ldLGUpPDA/cj1pKzE6dT1pfXJldHVybiByfSxyaWdodDpmdW5jdGlvbih0LGUscix1KXtmb3IoYXJndW1lbnRzLmxlbmd0aDwzJiYocj0wKSxhcmd1bWVudHMubGVuZ3RoPDQmJih1PXQubGVuZ3RoKTt1PnI7KXt2YXIgaT1yK3U+Pj4xO24odFtpXSxlKT4wP3U9aTpyPWkrMX1yZXR1cm4gcn19fWZ1bmN0aW9uIHIobil7cmV0dXJuIG4ubGVuZ3RofWZ1bmN0aW9uIHUobil7Zm9yKHZhciB0PTE7bip0JTE7KXQqPTEwO3JldHVybiB0fWZ1bmN0aW9uIGkobix0KXt0cnl7Zm9yKHZhciBlIGluIHQpT2JqZWN0LmRlZmluZVByb3BlcnR5KG4ucHJvdG90eXBlLGUse3ZhbHVlOnRbZV0sZW51bWVyYWJsZTohMX0pfWNhdGNoKHIpe24ucHJvdG90eXBlPXR9fWZ1bmN0aW9uIG8oKXt9ZnVuY3Rpb24gYShuKXtyZXR1cm4gaGErbiBpbiB0aGlzfWZ1bmN0aW9uIGMobil7cmV0dXJuIG49aGErbixuIGluIHRoaXMmJmRlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIHMoKXt2YXIgbj1bXTtyZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHQpe24ucHVzaCh0KX0pLG59ZnVuY3Rpb24gbCgpe3ZhciBuPTA7Zm9yKHZhciB0IGluIHRoaXMpdC5jaGFyQ29kZUF0KDApPT09Z2EmJisrbjtyZXR1cm4gbn1mdW5jdGlvbiBmKCl7Zm9yKHZhciBuIGluIHRoaXMpaWYobi5jaGFyQ29kZUF0KDApPT09Z2EpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gaCgpe31mdW5jdGlvbiBnKG4sdCxlKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgcj1lLmFwcGx5KHQsYXJndW1lbnRzKTtyZXR1cm4gcj09PXQ/bjpyfX1mdW5jdGlvbiBwKG4sdCl7aWYodCBpbiBuKXJldHVybiB0O3Q9dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0LnN1YnN0cmluZygxKTtmb3IodmFyIGU9MCxyPXBhLmxlbmd0aDtyPmU7KytlKXt2YXIgdT1wYVtlXSt0O2lmKHUgaW4gbilyZXR1cm4gdX19ZnVuY3Rpb24gdigpe31mdW5jdGlvbiBkKCl7fWZ1bmN0aW9uIG0obil7ZnVuY3Rpb24gdCgpe2Zvcih2YXIgdCxyPWUsdT0tMSxpPXIubGVuZ3RoOysrdTxpOykodD1yW3VdLm9uKSYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIG59dmFyIGU9W10scj1uZXcgbztyZXR1cm4gdC5vbj1mdW5jdGlvbih0LHUpe3ZhciBpLG89ci5nZXQodCk7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj9vJiZvLm9uOihvJiYoby5vbj1udWxsLGU9ZS5zbGljZSgwLGk9ZS5pbmRleE9mKG8pKS5jb25jYXQoZS5zbGljZShpKzEpKSxyLnJlbW92ZSh0KSksdSYmZS5wdXNoKHIuc2V0KHQse29uOnV9KSksbil9LHR9ZnVuY3Rpb24geSgpe0dvLmV2ZW50LnByZXZlbnREZWZhdWx0KCl9ZnVuY3Rpb24geCgpe2Zvcih2YXIgbix0PUdvLmV2ZW50O249dC5zb3VyY2VFdmVudDspdD1uO3JldHVybiB0fWZ1bmN0aW9uIE0obil7Zm9yKHZhciB0PW5ldyBkLGU9MCxyPWFyZ3VtZW50cy5sZW5ndGg7KytlPHI7KXRbYXJndW1lbnRzW2VdXT1tKHQpO3JldHVybiB0Lm9mPWZ1bmN0aW9uKGUscil7cmV0dXJuIGZ1bmN0aW9uKHUpe3RyeXt2YXIgaT11LnNvdXJjZUV2ZW50PUdvLmV2ZW50O3UudGFyZ2V0PW4sR28uZXZlbnQ9dSx0W3UudHlwZV0uYXBwbHkoZSxyKX1maW5hbGx5e0dvLmV2ZW50PWl9fX0sdH1mdW5jdGlvbiBfKG4pe3JldHVybiBkYShuLF9hKSxufWZ1bmN0aW9uIGIobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBtYShuLHRoaXMpfX1mdW5jdGlvbiB3KG4pe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBuP246ZnVuY3Rpb24oKXtyZXR1cm4geWEobix0aGlzKX19ZnVuY3Rpb24gUyhuLHQpe2Z1bmN0aW9uIGUoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZShuKX1mdW5jdGlvbiByKCl7dGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpfWZ1bmN0aW9uIHUoKXt0aGlzLnNldEF0dHJpYnV0ZShuLHQpfWZ1bmN0aW9uIGkoKXt0aGlzLnNldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCx0KX1mdW5jdGlvbiBvKCl7dmFyIGU9dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7bnVsbD09ZT90aGlzLnJlbW92ZUF0dHJpYnV0ZShuKTp0aGlzLnNldEF0dHJpYnV0ZShuLGUpfWZ1bmN0aW9uIGEoKXt2YXIgZT10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtudWxsPT1lP3RoaXMucmVtb3ZlQXR0cmlidXRlTlMobi5zcGFjZSxuLmxvY2FsKTp0aGlzLnNldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCxlKX1yZXR1cm4gbj1Hby5ucy5xdWFsaWZ5KG4pLG51bGw9PXQ/bi5sb2NhbD9yOmU6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/bi5sb2NhbD9hOm86bi5sb2NhbD9pOnV9ZnVuY3Rpb24gayhuKXtyZXR1cm4gbi50cmltKCkucmVwbGFjZSgvXHMrL2csIiAiKX1mdW5jdGlvbiBFKG4pe3JldHVybiBuZXcgUmVnRXhwKCIoPzpefFxccyspIitHby5yZXF1b3RlKG4pKyIoPzpcXHMrfCQpIiwiZyIpfWZ1bmN0aW9uIE4obil7cmV0dXJuIG4udHJpbSgpLnNwbGl0KC9efFxzKy8pfWZ1bmN0aW9uIEEobix0KXtmdW5jdGlvbiBlKCl7Zm9yKHZhciBlPS0xOysrZTx1OyluW2VdKHRoaXMsdCl9ZnVuY3Rpb24gcigpe2Zvcih2YXIgZT0tMSxyPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpOysrZTx1OyluW2VdKHRoaXMscil9bj1OKG4pLm1hcChDKTt2YXIgdT1uLmxlbmd0aDtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdD9yOmV9ZnVuY3Rpb24gQyhuKXt2YXIgdD1FKG4pO3JldHVybiBmdW5jdGlvbihlLHIpe2lmKHU9ZS5jbGFzc0xpc3QpcmV0dXJuIHI/dS5hZGQobik6dS5yZW1vdmUobik7dmFyIHU9ZS5nZXRBdHRyaWJ1dGUoImNsYXNzIil8fCIiO3I/KHQubGFzdEluZGV4PTAsdC50ZXN0KHUpfHxlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLGsodSsiICIrbikpKTplLnNldEF0dHJpYnV0ZSgiY2xhc3MiLGsodS5yZXBsYWNlKHQsIiAiKSkpfX1mdW5jdGlvbiBMKG4sdCxlKXtmdW5jdGlvbiByKCl7dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKX1mdW5jdGlvbiB1KCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLHQsZSl9ZnVuY3Rpb24gaSgpe3ZhciByPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PXI/dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKTp0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4scixlKX1yZXR1cm4gbnVsbD09dD9yOiJmdW5jdGlvbiI9PXR5cGVvZiB0P2k6dX1mdW5jdGlvbiBUKG4sdCl7ZnVuY3Rpb24gZSgpe2RlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIHIoKXt0aGlzW25dPXR9ZnVuY3Rpb24gdSgpe3ZhciBlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PWU/ZGVsZXRlIHRoaXNbbl06dGhpc1tuXT1lfXJldHVybiBudWxsPT10P2U6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dTpyfWZ1bmN0aW9uIHEobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjoobj1Hby5ucy5xdWFsaWZ5KG4pKS5sb2NhbD9mdW5jdGlvbigpe3JldHVybiB0aGlzLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG4uc3BhY2Usbi5sb2NhbCl9OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50TlModGhpcy5uYW1lc3BhY2VVUkksbil9fWZ1bmN0aW9uIHoobil7cmV0dXJue19fZGF0YV9fOm59fWZ1bmN0aW9uIFIobil7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIE1hKHRoaXMsbil9fWZ1bmN0aW9uIEQodCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGh8fCh0PW4pLGZ1bmN0aW9uKG4sZSl7cmV0dXJuIG4mJmU/dChuLl9fZGF0YV9fLGUuX19kYXRhX18pOiFuLSFlfX1mdW5jdGlvbiBQKG4sdCl7Zm9yKHZhciBlPTAscj1uLmxlbmd0aDtyPmU7ZSsrKWZvcih2YXIgdSxpPW5bZV0sbz0wLGE9aS5sZW5ndGg7YT5vO28rKykodT1pW29dKSYmdCh1LG8sZSk7cmV0dXJuIG59ZnVuY3Rpb24gVShuKXtyZXR1cm4gZGEobix3YSksbn1mdW5jdGlvbiBqKG4pe3ZhciB0LGU7cmV0dXJuIGZ1bmN0aW9uKHIsdSxpKXt2YXIgbyxhPW5baV0udXBkYXRlLGM9YS5sZW5ndGg7Zm9yKGkhPWUmJihlPWksdD0wKSx1Pj10JiYodD11KzEpOyEobz1hW3RdKSYmKyt0PGM7KTtyZXR1cm4gb319ZnVuY3Rpb24gSCgpe3ZhciBuPXRoaXMuX190cmFuc2l0aW9uX187biYmKytuLmFjdGl2ZX1mdW5jdGlvbiBGKG4sdCxlKXtmdW5jdGlvbiByKCl7dmFyIHQ9dGhpc1tvXTt0JiYodGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKG4sdCx0LiQpLGRlbGV0ZSB0aGlzW29dKX1mdW5jdGlvbiB1KCl7dmFyIHU9Yyh0LFFvKGFyZ3VtZW50cykpO3IuY2FsbCh0aGlzKSx0aGlzLmFkZEV2ZW50TGlzdGVuZXIobix0aGlzW29dPXUsdS4kPWUpLHUuXz10fWZ1bmN0aW9uIGkoKXt2YXIgdCxlPW5ldyBSZWdFeHAoIl5fX29uKFteLl0rKSIrR28ucmVxdW90ZShuKSsiJCIpO2Zvcih2YXIgciBpbiB0aGlzKWlmKHQ9ci5tYXRjaChlKSl7dmFyIHU9dGhpc1tyXTt0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIodFsxXSx1LHUuJCksZGVsZXRlIHRoaXNbcl19fXZhciBvPSJfX29uIituLGE9bi5pbmRleE9mKCIuIiksYz1PO2E+MCYmKG49bi5zdWJzdHJpbmcoMCxhKSk7dmFyIHM9a2EuZ2V0KG4pO3JldHVybiBzJiYobj1zLGM9WSksYT90P3U6cjp0P3Y6aX1mdW5jdGlvbiBPKG4sdCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPUdvLmV2ZW50O0dvLmV2ZW50PWUsdFswXT10aGlzLl9fZGF0YV9fO3RyeXtuLmFwcGx5KHRoaXMsdCl9ZmluYWxseXtHby5ldmVudD1yfX19ZnVuY3Rpb24gWShuLHQpe3ZhciBlPU8obix0KTtyZXR1cm4gZnVuY3Rpb24obil7dmFyIHQ9dGhpcyxyPW4ucmVsYXRlZFRhcmdldDtyJiYocj09PXR8fDgmci5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbih0KSl8fGUuY2FsbCh0LG4pfX1mdW5jdGlvbiBJKCl7dmFyIG49Ii5kcmFnc3VwcHJlc3MtIisgKytOYSx0PSJjbGljayIrbixlPUdvLnNlbGVjdChlYSkub24oInRvdWNobW92ZSIrbix5KS5vbigiZHJhZ3N0YXJ0IituLHkpLm9uKCJzZWxlY3RzdGFydCIrbix5KTtpZihFYSl7dmFyIHI9dGEuc3R5bGUsdT1yW0VhXTtyW0VhXT0ibm9uZSJ9cmV0dXJuIGZ1bmN0aW9uKGkpe2Z1bmN0aW9uIG8oKXtlLm9uKHQsbnVsbCl9ZS5vbihuLG51bGwpLEVhJiYocltFYV09dSksaSYmKGUub24odCxmdW5jdGlvbigpe3koKSxvKCl9LCEwKSxzZXRUaW1lb3V0KG8sMCkpfX1mdW5jdGlvbiBaKG4sdCl7dC5jaGFuZ2VkVG91Y2hlcyYmKHQ9dC5jaGFuZ2VkVG91Y2hlc1swXSk7dmFyIGU9bi5vd25lclNWR0VsZW1lbnR8fG47aWYoZS5jcmVhdGVTVkdQb2ludCl7dmFyIHI9ZS5jcmVhdGVTVkdQb2ludCgpO3JldHVybiByLng9dC5jbGllbnRYLHIueT10LmNsaWVudFkscj1yLm1hdHJpeFRyYW5zZm9ybShuLmdldFNjcmVlbkNUTSgpLmludmVyc2UoKSksW3IueCxyLnldfXZhciB1PW4uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7cmV0dXJuW3QuY2xpZW50WC11LmxlZnQtbi5jbGllbnRMZWZ0LHQuY2xpZW50WS11LnRvcC1uLmNsaWVudFRvcF19ZnVuY3Rpb24gVigpe3JldHVybiBHby5ldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5pZGVudGlmaWVyfWZ1bmN0aW9uICQoKXtyZXR1cm4gR28uZXZlbnQudGFyZ2V0fWZ1bmN0aW9uIFgoKXtyZXR1cm4gZWF9ZnVuY3Rpb24gQihuKXtyZXR1cm4gbj4wPzE6MD5uPy0xOjB9ZnVuY3Rpb24gSihuLHQsZSl7cmV0dXJuKHRbMF0tblswXSkqKGVbMV0tblsxXSktKHRbMV0tblsxXSkqKGVbMF0tblswXSl9ZnVuY3Rpb24gVyhuKXtyZXR1cm4gbj4xPzA6LTE+bj9BYTpNYXRoLmFjb3Mobil9ZnVuY3Rpb24gRyhuKXtyZXR1cm4gbj4xP0xhOi0xPm4/LUxhOk1hdGguYXNpbihuKX1mdW5jdGlvbiBLKG4pe3JldHVybigobj1NYXRoLmV4cChuKSktMS9uKS8yfWZ1bmN0aW9uIFEobil7cmV0dXJuKChuPU1hdGguZXhwKG4pKSsxL24pLzJ9ZnVuY3Rpb24gbnQobil7cmV0dXJuKChuPU1hdGguZXhwKDIqbikpLTEpLyhuKzEpfWZ1bmN0aW9uIHR0KG4pe3JldHVybihuPU1hdGguc2luKG4vMikpKm59ZnVuY3Rpb24gZXQoKXt9ZnVuY3Rpb24gcnQobix0LGUpe3JldHVybiBuZXcgdXQobix0LGUpfWZ1bmN0aW9uIHV0KG4sdCxlKXt0aGlzLmg9bix0aGlzLnM9dCx0aGlzLmw9ZX1mdW5jdGlvbiBpdChuLHQsZSl7ZnVuY3Rpb24gcihuKXtyZXR1cm4gbj4zNjA/bi09MzYwOjA+biYmKG4rPTM2MCksNjA+bj9pKyhvLWkpKm4vNjA6MTgwPm4/bzoyNDA+bj9pKyhvLWkpKigyNDAtbikvNjA6aX1mdW5jdGlvbiB1KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSpyKG4pKX12YXIgaSxvO3JldHVybiBuPWlzTmFOKG4pPzA6KG4lPTM2MCk8MD9uKzM2MDpuLHQ9aXNOYU4odCk/MDowPnQ/MDp0PjE/MTp0LGU9MD5lPzA6ZT4xPzE6ZSxvPS41Pj1lP2UqKDErdCk6ZSt0LWUqdCxpPTIqZS1vLHl0KHUobisxMjApLHUobiksdShuLTEyMCkpfWZ1bmN0aW9uIG90KG4sdCxlKXtyZXR1cm4gbmV3IGF0KG4sdCxlKX1mdW5jdGlvbiBhdChuLHQsZSl7dGhpcy5oPW4sdGhpcy5jPXQsdGhpcy5sPWV9ZnVuY3Rpb24gY3Qobix0LGUpe3JldHVybiBpc05hTihuKSYmKG49MCksaXNOYU4odCkmJih0PTApLHN0KGUsTWF0aC5jb3Mobio9emEpKnQsTWF0aC5zaW4obikqdCl9ZnVuY3Rpb24gc3Qobix0LGUpe3JldHVybiBuZXcgbHQobix0LGUpfWZ1bmN0aW9uIGx0KG4sdCxlKXt0aGlzLmw9bix0aGlzLmE9dCx0aGlzLmI9ZX1mdW5jdGlvbiBmdChuLHQsZSl7dmFyIHI9KG4rMTYpLzExNix1PXIrdC81MDAsaT1yLWUvMjAwO3JldHVybiB1PWd0KHUpKlphLHI9Z3QocikqVmEsaT1ndChpKSokYSx5dCh2dCgzLjI0MDQ1NDIqdS0xLjUzNzEzODUqci0uNDk4NTMxNCppKSx2dCgtLjk2OTI2Nip1KzEuODc2MDEwOCpyKy4wNDE1NTYqaSksdnQoLjA1NTY0MzQqdS0uMjA0MDI1OSpyKzEuMDU3MjI1MippKSl9ZnVuY3Rpb24gaHQobix0LGUpe3JldHVybiBuPjA/b3QoTWF0aC5hdGFuMihlLHQpKlJhLE1hdGguc3FydCh0KnQrZSplKSxuKTpvdCgwLzAsMC8wLG4pfWZ1bmN0aW9uIGd0KG4pe3JldHVybiBuPi4yMDY4OTMwMzQ/bipuKm46KG4tNC8yOSkvNy43ODcwMzd9ZnVuY3Rpb24gcHQobil7cmV0dXJuIG4+LjAwODg1Nj9NYXRoLnBvdyhuLDEvMyk6Ny43ODcwMzcqbis0LzI5fWZ1bmN0aW9uIHZ0KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSooLjAwMzA0Pj1uPzEyLjkyKm46MS4wNTUqTWF0aC5wb3cobiwxLzIuNCktLjA1NSkpfWZ1bmN0aW9uIGR0KG4pe3JldHVybiB5dChuPj4xNiwyNTUmbj4+OCwyNTUmbil9ZnVuY3Rpb24gbXQobil7cmV0dXJuIGR0KG4pKyIifWZ1bmN0aW9uIHl0KG4sdCxlKXtyZXR1cm4gbmV3IHh0KG4sdCxlKX1mdW5jdGlvbiB4dChuLHQsZSl7dGhpcy5yPW4sdGhpcy5nPXQsdGhpcy5iPWV9ZnVuY3Rpb24gTXQobil7cmV0dXJuIDE2Pm4/IjAiK01hdGgubWF4KDAsbikudG9TdHJpbmcoMTYpOk1hdGgubWluKDI1NSxuKS50b1N0cmluZygxNil9ZnVuY3Rpb24gX3Qobix0LGUpe3ZhciByLHUsaSxvPTAsYT0wLGM9MDtpZihyPS8oW2Etel0rKVwoKC4qKVwpL2kuZXhlYyhuKSlzd2l0Y2godT1yWzJdLnNwbGl0KCIsIiksclsxXSl7Y2FzZSJoc2wiOnJldHVybiBlKHBhcnNlRmxvYXQodVswXSkscGFyc2VGbG9hdCh1WzFdKS8xMDAscGFyc2VGbG9hdCh1WzJdKS8xMDApO2Nhc2UicmdiIjpyZXR1cm4gdChrdCh1WzBdKSxrdCh1WzFdKSxrdCh1WzJdKSl9cmV0dXJuKGk9SmEuZ2V0KG4pKT90KGkucixpLmcsaS5iKToobnVsbD09bnx8IiMiIT09bi5jaGFyQXQoMCl8fGlzTmFOKGk9cGFyc2VJbnQobi5zdWJzdHJpbmcoMSksMTYpKXx8KDQ9PT1uLmxlbmd0aD8obz0oMzg0MCZpKT4+NCxvPW8+PjR8byxhPTI0MCZpLGE9YT4+NHxhLGM9MTUmaSxjPWM8PDR8Yyk6Nz09PW4ubGVuZ3RoJiYobz0oMTY3MTE2ODAmaSk+PjE2LGE9KDY1MjgwJmkpPj44LGM9MjU1JmkpKSx0KG8sYSxjKSl9ZnVuY3Rpb24gYnQobix0LGUpe3ZhciByLHUsaT1NYXRoLm1pbihuLz0yNTUsdC89MjU1LGUvPTI1NSksbz1NYXRoLm1heChuLHQsZSksYT1vLWksYz0obytpKS8yO3JldHVybiBhPyh1PS41PmM/YS8obytpKTphLygyLW8taSkscj1uPT1vPyh0LWUpL2ErKGU+dD82OjApOnQ9PW8/KGUtbikvYSsyOihuLXQpL2ErNCxyKj02MCk6KHI9MC8wLHU9Yz4wJiYxPmM/MDpyKSxydChyLHUsYyl9ZnVuY3Rpb24gd3Qobix0LGUpe249U3QobiksdD1TdCh0KSxlPVN0KGUpO3ZhciByPXB0KCguNDEyNDU2NCpuKy4zNTc1NzYxKnQrLjE4MDQzNzUqZSkvWmEpLHU9cHQoKC4yMTI2NzI5Km4rLjcxNTE1MjIqdCsuMDcyMTc1KmUpL1ZhKSxpPXB0KCguMDE5MzMzOSpuKy4xMTkxOTIqdCsuOTUwMzA0MSplKS8kYSk7cmV0dXJuIHN0KDExNip1LTE2LDUwMCooci11KSwyMDAqKHUtaSkpfWZ1bmN0aW9uIFN0KG4pe3JldHVybihuLz0yNTUpPD0uMDQwNDU/bi8xMi45MjpNYXRoLnBvdygobisuMDU1KS8xLjA1NSwyLjQpfWZ1bmN0aW9uIGt0KG4pe3ZhciB0PXBhcnNlRmxvYXQobik7cmV0dXJuIiUiPT09bi5jaGFyQXQobi5sZW5ndGgtMSk/TWF0aC5yb3VuZCgyLjU1KnQpOnR9ZnVuY3Rpb24gRXQobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBufX1mdW5jdGlvbiBOdChuKXtyZXR1cm4gbn1mdW5jdGlvbiBBdChuKXtyZXR1cm4gZnVuY3Rpb24odCxlLHIpe3JldHVybiAyPT09YXJndW1lbnRzLmxlbmd0aCYmImZ1bmN0aW9uIj09dHlwZW9mIGUmJihyPWUsZT1udWxsKSxDdCh0LGUsbixyKX19ZnVuY3Rpb24gQ3Qobix0LGUscil7ZnVuY3Rpb24gdSgpe3ZhciBuLHQ9Yy5zdGF0dXM7aWYoIXQmJmMucmVzcG9uc2VUZXh0fHx0Pj0yMDAmJjMwMD50fHwzMDQ9PT10KXt0cnl7bj1lLmNhbGwoaSxjKX1jYXRjaChyKXtyZXR1cm4gby5lcnJvci5jYWxsKGksciksdm9pZCAwfW8ubG9hZC5jYWxsKGksbil9ZWxzZSBvLmVycm9yLmNhbGwoaSxjKX12YXIgaT17fSxvPUdvLmRpc3BhdGNoKCJiZWZvcmVzZW5kIiwicHJvZ3Jlc3MiLCJsb2FkIiwiZXJyb3IiKSxhPXt9LGM9bmV3IFhNTEh0dHBSZXF1ZXN0LHM9bnVsbDtyZXR1cm4hZWEuWERvbWFpblJlcXVlc3R8fCJ3aXRoQ3JlZGVudGlhbHMiaW4gY3x8IS9eKGh0dHAocyk/Oik/XC9cLy8udGVzdChuKXx8KGM9bmV3IFhEb21haW5SZXF1ZXN0KSwib25sb2FkImluIGM/Yy5vbmxvYWQ9Yy5vbmVycm9yPXU6Yy5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU+MyYmdSgpfSxjLm9ucHJvZ3Jlc3M9ZnVuY3Rpb24obil7dmFyIHQ9R28uZXZlbnQ7R28uZXZlbnQ9bjt0cnl7by5wcm9ncmVzcy5jYWxsKGksYyl9ZmluYWxseXtHby5ldmVudD10fX0saS5oZWFkZXI9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj0obisiIikudG9Mb3dlckNhc2UoKSxhcmd1bWVudHMubGVuZ3RoPDI/YVtuXToobnVsbD09dD9kZWxldGUgYVtuXTphW25dPXQrIiIsaSl9LGkubWltZVR5cGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bnVsbD09bj9udWxsOm4rIiIsaSk6dH0saS5yZXNwb25zZVR5cGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bixpKTpzfSxpLnJlc3BvbnNlPWZ1bmN0aW9uKG4pe3JldHVybiBlPW4saX0sWyJnZXQiLCJwb3N0Il0uZm9yRWFjaChmdW5jdGlvbihuKXtpW25dPWZ1bmN0aW9uKCl7cmV0dXJuIGkuc2VuZC5hcHBseShpLFtuXS5jb25jYXQoUW8oYXJndW1lbnRzKSkpfX0pLGkuc2VuZD1mdW5jdGlvbihlLHIsdSl7aWYoMj09PWFyZ3VtZW50cy5sZW5ndGgmJiJmdW5jdGlvbiI9PXR5cGVvZiByJiYodT1yLHI9bnVsbCksYy5vcGVuKGUsbiwhMCksbnVsbD09dHx8ImFjY2VwdCJpbiBhfHwoYS5hY2NlcHQ9dCsiLCovKiIpLGMuc2V0UmVxdWVzdEhlYWRlcilmb3IodmFyIGwgaW4gYSljLnNldFJlcXVlc3RIZWFkZXIobCxhW2xdKTtyZXR1cm4gbnVsbCE9dCYmYy5vdmVycmlkZU1pbWVUeXBlJiZjLm92ZXJyaWRlTWltZVR5cGUodCksbnVsbCE9cyYmKGMucmVzcG9uc2VUeXBlPXMpLG51bGwhPXUmJmkub24oImVycm9yIix1KS5vbigibG9hZCIsZnVuY3Rpb24obil7dShudWxsLG4pfSksby5iZWZvcmVzZW5kLmNhbGwoaSxjKSxjLnNlbmQobnVsbD09cj9udWxsOnIpLGl9LGkuYWJvcnQ9ZnVuY3Rpb24oKXtyZXR1cm4gYy5hYm9ydCgpLGl9LEdvLnJlYmluZChpLG8sIm9uIiksbnVsbD09cj9pOmkuZ2V0KEx0KHIpKX1mdW5jdGlvbiBMdChuKXtyZXR1cm4gMT09PW4ubGVuZ3RoP2Z1bmN0aW9uKHQsZSl7bihudWxsPT10P2U6bnVsbCl9Om59ZnVuY3Rpb24gVHQoKXt2YXIgbj1xdCgpLHQ9enQoKS1uO3Q+MjQ/KGlzRmluaXRlKHQpJiYoY2xlYXJUaW1lb3V0KFFhKSxRYT1zZXRUaW1lb3V0KFR0LHQpKSxLYT0wKTooS2E9MSx0YyhUdCkpfWZ1bmN0aW9uIHF0KCl7dmFyIG49RGF0ZS5ub3coKTtmb3IobmM9V2E7bmM7KW4+PW5jLnQmJihuYy5mPW5jLmMobi1uYy50KSksbmM9bmMubjtyZXR1cm4gbn1mdW5jdGlvbiB6dCgpe2Zvcih2YXIgbix0PVdhLGU9MS8wO3Q7KXQuZj90PW4/bi5uPXQubjpXYT10Lm46KHQudDxlJiYoZT10LnQpLHQ9KG49dCkubik7cmV0dXJuIEdhPW4sZX1mdW5jdGlvbiBSdChuLHQpe3JldHVybiB0LShuP01hdGguY2VpbChNYXRoLmxvZyhuKS9NYXRoLkxOMTApOjEpfWZ1bmN0aW9uIER0KG4sdCl7dmFyIGU9TWF0aC5wb3coMTAsMypmYSg4LXQpKTtyZXR1cm57c2NhbGU6dD44P2Z1bmN0aW9uKG4pe3JldHVybiBuL2V9OmZ1bmN0aW9uKG4pe3JldHVybiBuKmV9LHN5bWJvbDpufX1mdW5jdGlvbiBQdChuKXt2YXIgdD1uLmRlY2ltYWwsZT1uLnRob3VzYW5kcyxyPW4uZ3JvdXBpbmcsdT1uLmN1cnJlbmN5LGk9cj9mdW5jdGlvbihuKXtmb3IodmFyIHQ9bi5sZW5ndGgsdT1bXSxpPTAsbz1yWzBdO3Q+MCYmbz4wOyl1LnB1c2gobi5zdWJzdHJpbmcodC09byx0K28pKSxvPXJbaT0oaSsxKSVyLmxlbmd0aF07cmV0dXJuIHUucmV2ZXJzZSgpLmpvaW4oZSl9Ok50O3JldHVybiBmdW5jdGlvbihuKXt2YXIgZT1yYy5leGVjKG4pLHI9ZVsxXXx8IiAiLG89ZVsyXXx8Ij4iLGE9ZVszXXx8IiIsYz1lWzRdfHwiIixzPWVbNV0sbD0rZVs2XSxmPWVbN10saD1lWzhdLGc9ZVs5XSxwPTEsdj0iIixkPSIiLG09ITE7c3dpdGNoKGgmJihoPStoLnN1YnN0cmluZygxKSksKHN8fCIwIj09PXImJiI9Ij09PW8pJiYocz1yPSIwIixvPSI9IixmJiYobC09TWF0aC5mbG9vcigobC0xKS80KSkpLGcpe2Nhc2UibiI6Zj0hMCxnPSJnIjticmVhaztjYXNlIiUiOnA9MTAwLGQ9IiUiLGc9ImYiO2JyZWFrO2Nhc2UicCI6cD0xMDAsZD0iJSIsZz0iciI7YnJlYWs7Y2FzZSJiIjpjYXNlIm8iOmNhc2UieCI6Y2FzZSJYIjoiIyI9PT1jJiYodj0iMCIrZy50b0xvd2VyQ2FzZSgpKTtjYXNlImMiOmNhc2UiZCI6bT0hMCxoPTA7YnJlYWs7Y2FzZSJzIjpwPS0xLGc9InIifSIkIj09PWMmJih2PXVbMF0sZD11WzFdKSwiciIhPWd8fGh8fChnPSJnIiksbnVsbCE9aCYmKCJnIj09Zz9oPU1hdGgubWF4KDEsTWF0aC5taW4oMjEsaCkpOigiZSI9PWd8fCJmIj09ZykmJihoPU1hdGgubWF4KDAsTWF0aC5taW4oMjAsaCkpKSksZz11Yy5nZXQoZyl8fFV0O3ZhciB5PXMmJmY7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciBlPWQ7aWYobSYmbiUxKXJldHVybiIiO3ZhciB1PTA+bnx8MD09PW4mJjA+MS9uPyhuPS1uLCItIik6YTtpZigwPnApe3ZhciBjPUdvLmZvcm1hdFByZWZpeChuLGgpO249Yy5zY2FsZShuKSxlPWMuc3ltYm9sK2R9ZWxzZSBuKj1wO249ZyhuLGgpO3ZhciB4PW4ubGFzdEluZGV4T2YoIi4iKSxNPTA+eD9uOm4uc3Vic3RyaW5nKDAseCksXz0wPng/IiI6dCtuLnN1YnN0cmluZyh4KzEpOyFzJiZmJiYoTT1pKE0pKTt2YXIgYj12Lmxlbmd0aCtNLmxlbmd0aCtfLmxlbmd0aCsoeT8wOnUubGVuZ3RoKSx3PWw+Yj9uZXcgQXJyYXkoYj1sLWIrMSkuam9pbihyKToiIjtyZXR1cm4geSYmKE09aSh3K00pKSx1Kz12LG49TStfLCgiPCI9PT1vP3Urbit3OiI+Ij09PW8/dyt1K246Il4iPT09bz93LnN1YnN0cmluZygwLGI+Pj0xKSt1K24rdy5zdWJzdHJpbmcoYik6dSsoeT9uOncrbikpK2V9fX1mdW5jdGlvbiBVdChuKXtyZXR1cm4gbisiIn1mdW5jdGlvbiBqdCgpe3RoaXMuXz1uZXcgRGF0ZShhcmd1bWVudHMubGVuZ3RoPjE/RGF0ZS5VVEMuYXBwbHkodGhpcyxhcmd1bWVudHMpOmFyZ3VtZW50c1swXSl9ZnVuY3Rpb24gSHQobix0LGUpe2Z1bmN0aW9uIHIodCl7dmFyIGU9bih0KSxyPWkoZSwxKTtyZXR1cm4gci10PnQtZT9lOnJ9ZnVuY3Rpb24gdShlKXtyZXR1cm4gdChlPW4obmV3IG9jKGUtMSkpLDEpLGV9ZnVuY3Rpb24gaShuLGUpe3JldHVybiB0KG49bmV3IG9jKCtuKSxlKSxufWZ1bmN0aW9uIG8obixyLGkpe3ZhciBvPXUobiksYT1bXTtpZihpPjEpZm9yKDtyPm87KWUobyklaXx8YS5wdXNoKG5ldyBEYXRlKCtvKSksdChvLDEpO2Vsc2UgZm9yKDtyPm87KWEucHVzaChuZXcgRGF0ZSgrbykpLHQobywxKTtyZXR1cm4gYX1mdW5jdGlvbiBhKG4sdCxlKXt0cnl7b2M9anQ7dmFyIHI9bmV3IGp0O3JldHVybiByLl89bixvKHIsdCxlKX1maW5hbGx5e29jPURhdGV9fW4uZmxvb3I9bixuLnJvdW5kPXIsbi5jZWlsPXUsbi5vZmZzZXQ9aSxuLnJhbmdlPW87dmFyIGM9bi51dGM9RnQobik7cmV0dXJuIGMuZmxvb3I9YyxjLnJvdW5kPUZ0KHIpLGMuY2VpbD1GdCh1KSxjLm9mZnNldD1GdChpKSxjLnJhbmdlPWEsbn1mdW5jdGlvbiBGdChuKXtyZXR1cm4gZnVuY3Rpb24odCxlKXt0cnl7b2M9anQ7dmFyIHI9bmV3IGp0O3JldHVybiByLl89dCxuKHIsZSkuX31maW5hbGx5e29jPURhdGV9fX1mdW5jdGlvbiBPdChuKXtmdW5jdGlvbiB0KG4pe2Z1bmN0aW9uIHQodCl7Zm9yKHZhciBlLHUsaSxvPVtdLGE9LTEsYz0wOysrYTxyOykzNz09PW4uY2hhckNvZGVBdChhKSYmKG8ucHVzaChuLnN1YnN0cmluZyhjLGEpKSxudWxsIT0odT1jY1tlPW4uY2hhckF0KCsrYSldKSYmKGU9bi5jaGFyQXQoKythKSksKGk9QVtlXSkmJihlPWkodCxudWxsPT11PyJlIj09PWU/IiAiOiIwIjp1KSksby5wdXNoKGUpLGM9YSsxKTtyZXR1cm4gby5wdXNoKG4uc3Vic3RyaW5nKGMsYSkpLG8uam9pbigiIil9dmFyIHI9bi5sZW5ndGg7cmV0dXJuIHQucGFyc2U9ZnVuY3Rpb24odCl7dmFyIHI9e3k6MTkwMCxtOjAsZDoxLEg6MCxNOjAsUzowLEw6MCxaOm51bGx9LHU9ZShyLG4sdCwwKTtpZih1IT10Lmxlbmd0aClyZXR1cm4gbnVsbDsicCJpbiByJiYoci5IPXIuSCUxMisxMipyLnApO3ZhciBpPW51bGwhPXIuWiYmb2MhPT1qdCxvPW5ldyhpP2p0Om9jKTtyZXR1cm4iaiJpbiByP28uc2V0RnVsbFllYXIoci55LDAsci5qKToidyJpbiByJiYoIlciaW4gcnx8IlUiaW4gcik/KG8uc2V0RnVsbFllYXIoci55LDAsMSksby5zZXRGdWxsWWVhcihyLnksMCwiVyJpbiByPyhyLncrNiklNys3KnIuVy0oby5nZXREYXkoKSs1KSU3OnIudys3KnIuVS0oby5nZXREYXkoKSs2KSU3KSk6by5zZXRGdWxsWWVhcihyLnksci5tLHIuZCksby5zZXRIb3VycyhyLkgrTWF0aC5mbG9vcihyLlovMTAwKSxyLk0rci5aJTEwMCxyLlMsci5MKSxpP28uXzpvfSx0LnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIG59LHR9ZnVuY3Rpb24gZShuLHQsZSxyKXtmb3IodmFyIHUsaSxvLGE9MCxjPXQubGVuZ3RoLHM9ZS5sZW5ndGg7Yz5hOyl7aWYocj49cylyZXR1cm4tMTtpZih1PXQuY2hhckNvZGVBdChhKyspLDM3PT09dSl7aWYobz10LmNoYXJBdChhKyspLGk9Q1tvIGluIGNjP3QuY2hhckF0KGErKyk6b10sIWl8fChyPWkobixlLHIpKTwwKXJldHVybi0xfWVsc2UgaWYodSE9ZS5jaGFyQ29kZUF0KHIrKykpcmV0dXJuLTF9cmV0dXJuIHJ9ZnVuY3Rpb24gcihuLHQsZSl7Yi5sYXN0SW5kZXg9MDt2YXIgcj1iLmV4ZWModC5zdWJzdHJpbmcoZSkpO3JldHVybiByPyhuLnc9dy5nZXQoclswXS50b0xvd2VyQ2FzZSgpKSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB1KG4sdCxlKXtNLmxhc3RJbmRleD0wO3ZhciByPU0uZXhlYyh0LnN1YnN0cmluZyhlKSk7cmV0dXJuIHI/KG4udz1fLmdldChyWzBdLnRvTG93ZXJDYXNlKCkpLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGkobix0LGUpe0UubGFzdEluZGV4PTA7dmFyIHI9RS5leGVjKHQuc3Vic3RyaW5nKGUpKTtyZXR1cm4gcj8obi5tPU4uZ2V0KHJbMF0udG9Mb3dlckNhc2UoKSksZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gbyhuLHQsZSl7Uy5sYXN0SW5kZXg9MDt2YXIgcj1TLmV4ZWModC5zdWJzdHJpbmcoZSkpO3JldHVybiByPyhuLm09ay5nZXQoclswXS50b0xvd2VyQ2FzZSgpKSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBhKG4sdCxyKXtyZXR1cm4gZShuLEEuYy50b1N0cmluZygpLHQscil9ZnVuY3Rpb24gYyhuLHQscil7cmV0dXJuIGUobixBLngudG9TdHJpbmcoKSx0LHIpfWZ1bmN0aW9uIHMobix0LHIpe3JldHVybiBlKG4sQS5YLnRvU3RyaW5nKCksdCxyKX1mdW5jdGlvbiBsKG4sdCxlKXt2YXIgcj14LmdldCh0LnN1YnN0cmluZyhlLGUrPTIpLnRvTG93ZXJDYXNlKCkpO3JldHVybiBudWxsPT1yPy0xOihuLnA9cixlKX12YXIgZj1uLmRhdGVUaW1lLGg9bi5kYXRlLGc9bi50aW1lLHA9bi5wZXJpb2RzLHY9bi5kYXlzLGQ9bi5zaG9ydERheXMsbT1uLm1vbnRocyx5PW4uc2hvcnRNb250aHM7dC51dGM9ZnVuY3Rpb24obil7ZnVuY3Rpb24gZShuKXt0cnl7b2M9anQ7dmFyIHQ9bmV3IG9jO3JldHVybiB0Ll89bixyKHQpfWZpbmFsbHl7b2M9RGF0ZX19dmFyIHI9dChuKTtyZXR1cm4gZS5wYXJzZT1mdW5jdGlvbihuKXt0cnl7b2M9anQ7dmFyIHQ9ci5wYXJzZShuKTtyZXR1cm4gdCYmdC5ffWZpbmFsbHl7b2M9RGF0ZX19LGUudG9TdHJpbmc9ci50b1N0cmluZyxlfSx0Lm11bHRpPXQudXRjLm11bHRpPWFlO3ZhciB4PUdvLm1hcCgpLE09SXQodiksXz1adCh2KSxiPUl0KGQpLHc9WnQoZCksUz1JdChtKSxrPVp0KG0pLEU9SXQoeSksTj1adCh5KTtwLmZvckVhY2goZnVuY3Rpb24obix0KXt4LnNldChuLnRvTG93ZXJDYXNlKCksdCl9KTt2YXIgQT17YTpmdW5jdGlvbihuKXtyZXR1cm4gZFtuLmdldERheSgpXX0sQTpmdW5jdGlvbihuKXtyZXR1cm4gdltuLmdldERheSgpXX0sYjpmdW5jdGlvbihuKXtyZXR1cm4geVtuLmdldE1vbnRoKCldfSxCOmZ1bmN0aW9uKG4pe3JldHVybiBtW24uZ2V0TW9udGgoKV19LGM6dChmKSxkOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFl0KG4uZ2V0RGF0ZSgpLHQsMil9LGU6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQobi5nZXREYXRlKCksdCwyKX0sSDpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldEhvdXJzKCksdCwyKX0sSTpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldEhvdXJzKCklMTJ8fDEyLHQsMil9LGo6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQoMStpYy5kYXlPZlllYXIobiksdCwzKX0sTDpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldE1pbGxpc2Vjb25kcygpLHQsMyl9LG06ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQobi5nZXRNb250aCgpKzEsdCwyKX0sTTpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldE1pbnV0ZXMoKSx0LDIpfSxwOmZ1bmN0aW9uKG4pe3JldHVybiBwWysobi5nZXRIb3VycygpPj0xMildfSxTOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFl0KG4uZ2V0U2Vjb25kcygpLHQsMil9LFU6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQoaWMuc3VuZGF5T2ZZZWFyKG4pLHQsMil9LHc6ZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF5KCl9LFc6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQoaWMubW9uZGF5T2ZZZWFyKG4pLHQsMil9LHg6dChoKSxYOnQoZykseTpmdW5jdGlvbihuLHQpe3JldHVybiBZdChuLmdldEZ1bGxZZWFyKCklMTAwLHQsMil9LFk6ZnVuY3Rpb24obix0KXtyZXR1cm4gWXQobi5nZXRGdWxsWWVhcigpJTFlNCx0LDQpfSxaOmllLCIlIjpmdW5jdGlvbigpe3JldHVybiIlIn19LEM9e2E6cixBOnUsYjppLEI6byxjOmEsZDpRdCxlOlF0LEg6dGUsSTp0ZSxqOm5lLEw6dWUsbTpLdCxNOmVlLHA6bCxTOnJlLFU6JHQsdzpWdCxXOlh0LHg6YyxYOnMseTpKdCxZOkJ0LFo6V3QsIiUiOm9lfTtyZXR1cm4gdH1mdW5jdGlvbiBZdChuLHQsZSl7dmFyIHI9MD5uPyItIjoiIix1PShyPy1uOm4pKyIiLGk9dS5sZW5ndGg7cmV0dXJuIHIrKGU+aT9uZXcgQXJyYXkoZS1pKzEpLmpvaW4odCkrdTp1KX1mdW5jdGlvbiBJdChuKXtyZXR1cm4gbmV3IFJlZ0V4cCgiXig/OiIrbi5tYXAoR28ucmVxdW90ZSkuam9pbigifCIpKyIpIiwiaSIpfWZ1bmN0aW9uIFp0KG4pe2Zvcih2YXIgdD1uZXcgbyxlPS0xLHI9bi5sZW5ndGg7KytlPHI7KXQuc2V0KG5bZV0udG9Mb3dlckNhc2UoKSxlKTtyZXR1cm4gdH1mdW5jdGlvbiBWdChuLHQsZSl7c2MubGFzdEluZGV4PTA7dmFyIHI9c2MuZXhlYyh0LnN1YnN0cmluZyhlLGUrMSkpO3JldHVybiByPyhuLnc9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gJHQobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSkpO3JldHVybiByPyhuLlU9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gWHQobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSkpO3JldHVybiByPyhuLlc9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gQnQobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSxlKzQpKTtyZXR1cm4gcj8obi55PStyWzBdLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIEp0KG4sdCxlKXtzYy5sYXN0SW5kZXg9MDt2YXIgcj1zYy5leGVjKHQuc3Vic3RyaW5nKGUsZSsyKSk7cmV0dXJuIHI/KG4ueT1HdCgrclswXSksZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gV3Qobix0LGUpe3JldHVybi9eWystXVxkezR9JC8udGVzdCh0PXQuc3Vic3RyaW5nKGUsZSs1KSk/KG4uWj0rdCxlKzUpOi0xfWZ1bmN0aW9uIEd0KG4pe3JldHVybiBuKyhuPjY4PzE5MDA6MmUzKX1mdW5jdGlvbiBLdChuLHQsZSl7c2MubGFzdEluZGV4PTA7dmFyIHI9c2MuZXhlYyh0LnN1YnN0cmluZyhlLGUrMikpO3JldHVybiByPyhuLm09clswXS0xLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIFF0KG4sdCxlKXtzYy5sYXN0SW5kZXg9MDt2YXIgcj1zYy5leGVjKHQuc3Vic3RyaW5nKGUsZSsyKSk7cmV0dXJuIHI/KG4uZD0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBuZShuLHQsZSl7c2MubGFzdEluZGV4PTA7dmFyIHI9c2MuZXhlYyh0LnN1YnN0cmluZyhlLGUrMykpO3JldHVybiByPyhuLmo9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gdGUobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSxlKzIpKTtyZXR1cm4gcj8obi5IPStyWzBdLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGVlKG4sdCxlKXtzYy5sYXN0SW5kZXg9MDt2YXIgcj1zYy5leGVjKHQuc3Vic3RyaW5nKGUsZSsyKSk7cmV0dXJuIHI/KG4uTT0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiByZShuLHQsZSl7c2MubGFzdEluZGV4PTA7dmFyIHI9c2MuZXhlYyh0LnN1YnN0cmluZyhlLGUrMikpO3JldHVybiByPyhuLlM9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gdWUobix0LGUpe3NjLmxhc3RJbmRleD0wO3ZhciByPXNjLmV4ZWModC5zdWJzdHJpbmcoZSxlKzMpKTtyZXR1cm4gcj8obi5MPStyWzBdLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGllKG4pe3ZhciB0PW4uZ2V0VGltZXpvbmVPZmZzZXQoKSxlPXQ+MD8iLSI6IisiLHI9fn4oZmEodCkvNjApLHU9ZmEodCklNjA7cmV0dXJuIGUrWXQociwiMCIsMikrWXQodSwiMCIsMil9ZnVuY3Rpb24gb2Uobix0LGUpe2xjLmxhc3RJbmRleD0wO3ZhciByPWxjLmV4ZWModC5zdWJzdHJpbmcoZSxlKzEpKTtyZXR1cm4gcj9lK3JbMF0ubGVuZ3RoOi0xfWZ1bmN0aW9uIGFlKG4pe2Zvcih2YXIgdD1uLmxlbmd0aCxlPS0xOysrZTx0OyluW2VdWzBdPXRoaXMobltlXVswXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe2Zvcih2YXIgZT0wLHI9bltlXTshclsxXSh0KTspcj1uWysrZV07cmV0dXJuIHJbMF0odCl9fWZ1bmN0aW9uIGNlKCl7fWZ1bmN0aW9uIHNlKG4sdCxlKXt2YXIgcj1lLnM9bit0LHU9ci1uLGk9ci11O2UudD1uLWkrKHQtdSl9ZnVuY3Rpb24gbGUobix0KXtuJiZwYy5oYXNPd25Qcm9wZXJ0eShuLnR5cGUpJiZwY1tuLnR5cGVdKG4sdCl9ZnVuY3Rpb24gZmUobix0LGUpe3ZhciByLHU9LTEsaT1uLmxlbmd0aC1lO2Zvcih0LmxpbmVTdGFydCgpOysrdTxpOylyPW5bdV0sdC5wb2ludChyWzBdLHJbMV0sclsyXSk7dC5saW5lRW5kKCl9ZnVuY3Rpb24gaGUobix0KXt2YXIgZT0tMSxyPW4ubGVuZ3RoO2Zvcih0LnBvbHlnb25TdGFydCgpOysrZTxyOylmZShuW2VdLHQsMSk7dC5wb2x5Z29uRW5kKCl9ZnVuY3Rpb24gZ2UoKXtmdW5jdGlvbiBuKG4sdCl7bio9emEsdD10KnphLzIrQWEvNDt2YXIgZT1uLXIsbz1lPj0wPzE6LTEsYT1vKmUsYz1NYXRoLmNvcyh0KSxzPU1hdGguc2luKHQpLGw9aSpzLGY9dSpjK2wqTWF0aC5jb3MoYSksaD1sKm8qTWF0aC5zaW4oYSk7ZGMuYWRkKE1hdGguYXRhbjIoaCxmKSkscj1uLHU9YyxpPXN9dmFyIHQsZSxyLHUsaTttYy5wb2ludD1mdW5jdGlvbihvLGEpe21jLnBvaW50PW4scj0odD1vKSp6YSx1PU1hdGguY29zKGE9KGU9YSkqemEvMitBYS80KSxpPU1hdGguc2luKGEpfSxtYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpfX1mdW5jdGlvbiBwZShuKXt2YXIgdD1uWzBdLGU9blsxXSxyPU1hdGguY29zKGUpO3JldHVybltyKk1hdGguY29zKHQpLHIqTWF0aC5zaW4odCksTWF0aC5zaW4oZSldfWZ1bmN0aW9uIHZlKG4sdCl7cmV0dXJuIG5bMF0qdFswXStuWzFdKnRbMV0rblsyXSp0WzJdfWZ1bmN0aW9uIGRlKG4sdCl7cmV0dXJuW25bMV0qdFsyXS1uWzJdKnRbMV0sblsyXSp0WzBdLW5bMF0qdFsyXSxuWzBdKnRbMV0tblsxXSp0WzBdXX1mdW5jdGlvbiBtZShuLHQpe25bMF0rPXRbMF0sblsxXSs9dFsxXSxuWzJdKz10WzJdfWZ1bmN0aW9uIHllKG4sdCl7cmV0dXJuW25bMF0qdCxuWzFdKnQsblsyXSp0XX1mdW5jdGlvbiB4ZShuKXt2YXIgdD1NYXRoLnNxcnQoblswXSpuWzBdK25bMV0qblsxXStuWzJdKm5bMl0pO25bMF0vPXQsblsxXS89dCxuWzJdLz10fWZ1bmN0aW9uIE1lKG4pe3JldHVybltNYXRoLmF0YW4yKG5bMV0sblswXSksRyhuWzJdKV19ZnVuY3Rpb24gX2Uobix0KXtyZXR1cm4gZmEoblswXS10WzBdKTxUYSYmZmEoblsxXS10WzFdKTxUYX1mdW5jdGlvbiBiZShuLHQpe24qPXphO3ZhciBlPU1hdGguY29zKHQqPXphKTt3ZShlKk1hdGguY29zKG4pLGUqTWF0aC5zaW4obiksTWF0aC5zaW4odCkpfWZ1bmN0aW9uIHdlKG4sdCxlKXsrK3ljLE1jKz0obi1NYykveWMsX2MrPSh0LV9jKS95YyxiYys9KGUtYmMpL3ljfWZ1bmN0aW9uIFNlKCl7ZnVuY3Rpb24gbihuLHUpe24qPXphO3ZhciBpPU1hdGguY29zKHUqPXphKSxvPWkqTWF0aC5jb3MobiksYT1pKk1hdGguc2luKG4pLGM9TWF0aC5zaW4odSkscz1NYXRoLmF0YW4yKE1hdGguc3FydCgocz1lKmMtciphKSpzKyhzPXIqby10KmMpKnMrKHM9dCphLWUqbykqcyksdCpvK2UqYStyKmMpO3hjKz1zLHdjKz1zKih0Kyh0PW8pKSxTYys9cyooZSsoZT1hKSksa2MrPXMqKHIrKHI9YykpLHdlKHQsZSxyKX12YXIgdCxlLHI7Q2MucG9pbnQ9ZnVuY3Rpb24odSxpKXt1Kj16YTt2YXIgbz1NYXRoLmNvcyhpKj16YSk7dD1vKk1hdGguY29zKHUpLGU9bypNYXRoLnNpbih1KSxyPU1hdGguc2luKGkpLENjLnBvaW50PW4sd2UodCxlLHIpfX1mdW5jdGlvbiBrZSgpe0NjLnBvaW50PWJlfWZ1bmN0aW9uIEVlKCl7ZnVuY3Rpb24gbihuLHQpe24qPXphO3ZhciBlPU1hdGguY29zKHQqPXphKSxvPWUqTWF0aC5jb3MobiksYT1lKk1hdGguc2luKG4pLGM9TWF0aC5zaW4odCkscz11KmMtaSphLGw9aSpvLXIqYyxmPXIqYS11Km8saD1NYXRoLnNxcnQocypzK2wqbCtmKmYpLGc9cipvK3UqYStpKmMscD1oJiYtVyhnKS9oLHY9TWF0aC5hdGFuMihoLGcpO0VjKz1wKnMsTmMrPXAqbCxBYys9cCpmLHhjKz12LHdjKz12KihyKyhyPW8pKSxTYys9dioodSsodT1hKSksa2MrPXYqKGkrKGk9YykpLHdlKHIsdSxpKX12YXIgdCxlLHIsdSxpO0NjLnBvaW50PWZ1bmN0aW9uKG8sYSl7dD1vLGU9YSxDYy5wb2ludD1uLG8qPXphO3ZhciBjPU1hdGguY29zKGEqPXphKTtyPWMqTWF0aC5jb3MobyksdT1jKk1hdGguc2luKG8pLGk9TWF0aC5zaW4oYSksd2Uocix1LGkpfSxDYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpLENjLmxpbmVFbmQ9a2UsQ2MucG9pbnQ9YmV9fWZ1bmN0aW9uIE5lKCl7cmV0dXJuITB9ZnVuY3Rpb24gQWUobix0LGUscix1KXt2YXIgaT1bXSxvPVtdO2lmKG4uZm9yRWFjaChmdW5jdGlvbihuKXtpZighKCh0PW4ubGVuZ3RoLTEpPD0wKSl7dmFyIHQsZT1uWzBdLHI9blt0XTtpZihfZShlLHIpKXt1LmxpbmVTdGFydCgpO2Zvcih2YXIgYT0wO3Q+YTsrK2EpdS5wb2ludCgoZT1uW2FdKVswXSxlWzFdKTtyZXR1cm4gdS5saW5lRW5kKCksdm9pZCAwfXZhciBjPW5ldyBMZShlLG4sbnVsbCwhMCkscz1uZXcgTGUoZSxudWxsLGMsITEpO2Mubz1zLGkucHVzaChjKSxvLnB1c2gocyksYz1uZXcgTGUocixuLG51bGwsITEpLHM9bmV3IExlKHIsbnVsbCxjLCEwKSxjLm89cyxpLnB1c2goYyksby5wdXNoKHMpfX0pLG8uc29ydCh0KSxDZShpKSxDZShvKSxpLmxlbmd0aCl7Zm9yKHZhciBhPTAsYz1lLHM9by5sZW5ndGg7cz5hOysrYSlvW2FdLmU9Yz0hYztmb3IodmFyIGwsZixoPWlbMF07Oyl7Zm9yKHZhciBnPWgscD0hMDtnLnY7KWlmKChnPWcubik9PT1oKXJldHVybjtsPWcueix1LmxpbmVTdGFydCgpO2Rve2lmKGcudj1nLm8udj0hMCxnLmUpe2lmKHApZm9yKHZhciBhPTAscz1sLmxlbmd0aDtzPmE7KythKXUucG9pbnQoKGY9bFthXSlbMF0sZlsxXSk7ZWxzZSByKGcueCxnLm4ueCwxLHUpO2c9Zy5ufWVsc2V7aWYocCl7bD1nLnAuejtmb3IodmFyIGE9bC5sZW5ndGgtMTthPj0wOy0tYSl1LnBvaW50KChmPWxbYV0pWzBdLGZbMV0pfWVsc2UgcihnLngsZy5wLngsLTEsdSk7Zz1nLnB9Zz1nLm8sbD1nLnoscD0hcH13aGlsZSghZy52KTt1LmxpbmVFbmQoKX19fWZ1bmN0aW9uIENlKG4pe2lmKHQ9bi5sZW5ndGgpe2Zvcih2YXIgdCxlLHI9MCx1PW5bMF07KytyPHQ7KXUubj1lPW5bcl0sZS5wPXUsdT1lO3Uubj1lPW5bMF0sZS5wPXV9fWZ1bmN0aW9uIExlKG4sdCxlLHIpe3RoaXMueD1uLHRoaXMuej10LHRoaXMubz1lLHRoaXMuZT1yLHRoaXMudj0hMSx0aGlzLm49dGhpcy5wPW51bGx9ZnVuY3Rpb24gVGUobix0LGUscil7cmV0dXJuIGZ1bmN0aW9uKHUsaSl7ZnVuY3Rpb24gbyh0LGUpe3ZhciByPXUodCxlKTtuKHQ9clswXSxlPXJbMV0pJiZpLnBvaW50KHQsZSl9ZnVuY3Rpb24gYShuLHQpe3ZhciBlPXUobix0KTtkLnBvaW50KGVbMF0sZVsxXSl9ZnVuY3Rpb24gYygpe3kucG9pbnQ9YSxkLmxpbmVTdGFydCgpfWZ1bmN0aW9uIHMoKXt5LnBvaW50PW8sZC5saW5lRW5kKCl9ZnVuY3Rpb24gbChuLHQpe3YucHVzaChbbix0XSk7dmFyIGU9dShuLHQpO00ucG9pbnQoZVswXSxlWzFdKX1mdW5jdGlvbiBmKCl7TS5saW5lU3RhcnQoKSx2PVtdfWZ1bmN0aW9uIGgoKXtsKHZbMF1bMF0sdlswXVsxXSksTS5saW5lRW5kKCk7dmFyIG4sdD1NLmNsZWFuKCksZT14LmJ1ZmZlcigpLHI9ZS5sZW5ndGg7aWYodi5wb3AoKSxwLnB1c2godiksdj1udWxsLHIpe2lmKDEmdCl7bj1lWzBdO3ZhciB1LHI9bi5sZW5ndGgtMSxvPS0xO2ZvcihpLmxpbmVTdGFydCgpOysrbzxyOylpLnBvaW50KCh1PW5bb10pWzBdLHVbMV0pO3JldHVybiBpLmxpbmVFbmQoKSx2b2lkIDB9cj4xJiYyJnQmJmUucHVzaChlLnBvcCgpLmNvbmNhdChlLnNoaWZ0KCkpKSxnLnB1c2goZS5maWx0ZXIocWUpKX19dmFyIGcscCx2LGQ9dChpKSxtPXUuaW52ZXJ0KHJbMF0sclsxXSkseT17cG9pbnQ6byxsaW5lU3RhcnQ6YyxsaW5lRW5kOnMscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7eS5wb2ludD1sLHkubGluZVN0YXJ0PWYseS5saW5lRW5kPWgsZz1bXSxwPVtdLGkucG9seWdvblN0YXJ0KCl9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXt5LnBvaW50PW8seS5saW5lU3RhcnQ9Yyx5LmxpbmVFbmQ9cyxnPUdvLm1lcmdlKGcpO3ZhciBuPURlKG0scCk7Zy5sZW5ndGg/QWUoZyxSZSxuLGUsaSk6biYmKGkubGluZVN0YXJ0KCksZShudWxsLG51bGwsMSxpKSxpLmxpbmVFbmQoKSksaS5wb2x5Z29uRW5kKCksZz1wPW51bGx9LHNwaGVyZTpmdW5jdGlvbigpe2kucG9seWdvblN0YXJ0KCksaS5saW5lU3RhcnQoKSxlKG51bGwsbnVsbCwxLGkpLGkubGluZUVuZCgpLGkucG9seWdvbkVuZCgpfX0seD16ZSgpLE09dCh4KTtyZXR1cm4geX19ZnVuY3Rpb24gcWUobil7cmV0dXJuIG4ubGVuZ3RoPjF9ZnVuY3Rpb24gemUoKXt2YXIgbix0PVtdO3JldHVybntsaW5lU3RhcnQ6ZnVuY3Rpb24oKXt0LnB1c2gobj1bXSl9LHBvaW50OmZ1bmN0aW9uKHQsZSl7bi5wdXNoKFt0LGVdKX0sbGluZUVuZDp2LGJ1ZmZlcjpmdW5jdGlvbigpe3ZhciBlPXQ7cmV0dXJuIHQ9W10sbj1udWxsLGV9LHJlam9pbjpmdW5jdGlvbigpe3QubGVuZ3RoPjEmJnQucHVzaCh0LnBvcCgpLmNvbmNhdCh0LnNoaWZ0KCkpKX19fWZ1bmN0aW9uIFJlKG4sdCl7cmV0dXJuKChuPW4ueClbMF08MD9uWzFdLUxhLVRhOkxhLW5bMV0pLSgodD10LngpWzBdPDA/dFsxXS1MYS1UYTpMYS10WzFdKX1mdW5jdGlvbiBEZShuLHQpe3ZhciBlPW5bMF0scj1uWzFdLHU9W01hdGguc2luKGUpLC1NYXRoLmNvcyhlKSwwXSxpPTAsbz0wO2RjLnJlc2V0KCk7Zm9yKHZhciBhPTAsYz10Lmxlbmd0aDtjPmE7KythKXt2YXIgcz10W2FdLGw9cy5sZW5ndGg7aWYobClmb3IodmFyIGY9c1swXSxoPWZbMF0sZz1mWzFdLzIrQWEvNCxwPU1hdGguc2luKGcpLHY9TWF0aC5jb3MoZyksZD0xOzspe2Q9PT1sJiYoZD0wKSxuPXNbZF07dmFyIG09blswXSx5PW5bMV0vMitBYS80LHg9TWF0aC5zaW4oeSksTT1NYXRoLmNvcyh5KSxfPW0taCxiPV8+PTA/MTotMSx3PWIqXyxTPXc+QWEsaz1wKng7aWYoZGMuYWRkKE1hdGguYXRhbjIoaypiKk1hdGguc2luKHcpLHYqTStrKk1hdGguY29zKHcpKSksaSs9Uz9fK2IqQ2E6XyxTXmg+PWVebT49ZSl7dmFyIEU9ZGUocGUoZikscGUobikpO3hlKEUpO3ZhciBOPWRlKHUsRSk7eGUoTik7dmFyIEE9KFNeXz49MD8tMToxKSpHKE5bMl0pOyhyPkF8fHI9PT1BJiYoRVswXXx8RVsxXSkpJiYobys9U15fPj0wPzE6LTEpfWlmKCFkKyspYnJlYWs7aD1tLHA9eCx2PU0sZj1ufX1yZXR1cm4oLVRhPml8fFRhPmkmJjA+ZGMpXjEmb31mdW5jdGlvbiBQZShuKXt2YXIgdCxlPTAvMCxyPTAvMCx1PTAvMDtyZXR1cm57bGluZVN0YXJ0OmZ1bmN0aW9uKCl7bi5saW5lU3RhcnQoKSx0PTF9LHBvaW50OmZ1bmN0aW9uKGksbyl7dmFyIGE9aT4wP0FhOi1BYSxjPWZhKGktZSk7ZmEoYy1BYSk8VGE/KG4ucG9pbnQoZSxyPShyK28pLzI+MD9MYTotTGEpLG4ucG9pbnQodSxyKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQoYSxyKSxuLnBvaW50KGksciksdD0wKTp1IT09YSYmYz49QWEmJihmYShlLXUpPFRhJiYoZS09dSpUYSksZmEoaS1hKTxUYSYmKGktPWEqVGEpLHI9VWUoZSxyLGksbyksbi5wb2ludCh1LHIpLG4ubGluZUVuZCgpLG4ubGluZVN0YXJ0KCksbi5wb2ludChhLHIpLHQ9MCksbi5wb2ludChlPWkscj1vKSx1PWF9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtuLmxpbmVFbmQoKSxlPXI9MC8wfSxjbGVhbjpmdW5jdGlvbigpe3JldHVybiAyLXR9fX1mdW5jdGlvbiBVZShuLHQsZSxyKXt2YXIgdSxpLG89TWF0aC5zaW4obi1lKTtyZXR1cm4gZmEobyk+VGE/TWF0aC5hdGFuKChNYXRoLnNpbih0KSooaT1NYXRoLmNvcyhyKSkqTWF0aC5zaW4oZSktTWF0aC5zaW4ocikqKHU9TWF0aC5jb3ModCkpKk1hdGguc2luKG4pKS8odSppKm8pKToodCtyKS8yfWZ1bmN0aW9uIGplKG4sdCxlLHIpe3ZhciB1O2lmKG51bGw9PW4pdT1lKkxhLHIucG9pbnQoLUFhLHUpLHIucG9pbnQoMCx1KSxyLnBvaW50KEFhLHUpLHIucG9pbnQoQWEsMCksci5wb2ludChBYSwtdSksci5wb2ludCgwLC11KSxyLnBvaW50KC1BYSwtdSksci5wb2ludCgtQWEsMCksci5wb2ludCgtQWEsdSk7ZWxzZSBpZihmYShuWzBdLXRbMF0pPlRhKXt2YXIgaT1uWzBdPHRbMF0/QWE6LUFhO3U9ZSppLzIsci5wb2ludCgtaSx1KSxyLnBvaW50KDAsdSksci5wb2ludChpLHUpfWVsc2Ugci5wb2ludCh0WzBdLHRbMV0pfWZ1bmN0aW9uIEhlKG4pe2Z1bmN0aW9uIHQobix0KXtyZXR1cm4gTWF0aC5jb3MobikqTWF0aC5jb3ModCk+aX1mdW5jdGlvbiBlKG4pe3ZhciBlLGksYyxzLGw7cmV0dXJue2xpbmVTdGFydDpmdW5jdGlvbigpe3M9Yz0hMSxsPTF9LHBvaW50OmZ1bmN0aW9uKGYsaCl7dmFyIGcscD1bZixoXSx2PXQoZixoKSxkPW8/dj8wOnUoZixoKTp2P3UoZisoMD5mP0FhOi1BYSksaCk6MDtpZighZSYmKHM9Yz12KSYmbi5saW5lU3RhcnQoKSx2IT09YyYmKGc9cihlLHApLChfZShlLGcpfHxfZShwLGcpKSYmKHBbMF0rPVRhLHBbMV0rPVRhLHY9dChwWzBdLHBbMV0pKSksdiE9PWMpbD0wLHY/KG4ubGluZVN0YXJ0KCksZz1yKHAsZSksbi5wb2ludChnWzBdLGdbMV0pKTooZz1yKGUscCksbi5wb2ludChnWzBdLGdbMV0pLG4ubGluZUVuZCgpKSxlPWc7ZWxzZSBpZihhJiZlJiZvXnYpe3ZhciBtO2QmaXx8IShtPXIocCxlLCEwKSl8fChsPTAsbz8obi5saW5lU3RhcnQoKSxuLnBvaW50KG1bMF1bMF0sbVswXVsxXSksbi5wb2ludChtWzFdWzBdLG1bMV1bMV0pLG4ubGluZUVuZCgpKToobi5wb2ludChtWzFdWzBdLG1bMV1bMV0pLG4ubGluZUVuZCgpLG4ubGluZVN0YXJ0KCksbi5wb2ludChtWzBdWzBdLG1bMF1bMV0pKSl9IXZ8fGUmJl9lKGUscCl8fG4ucG9pbnQocFswXSxwWzFdKSxlPXAsYz12LGk9ZH0sbGluZUVuZDpmdW5jdGlvbigpe2MmJm4ubGluZUVuZCgpLGU9bnVsbH0sY2xlYW46ZnVuY3Rpb24oKXtyZXR1cm4gbHwocyYmYyk8PDF9fX1mdW5jdGlvbiByKG4sdCxlKXt2YXIgcj1wZShuKSx1PXBlKHQpLG89WzEsMCwwXSxhPWRlKHIsdSksYz12ZShhLGEpLHM9YVswXSxsPWMtcypzO2lmKCFsKXJldHVybiFlJiZuO3ZhciBmPWkqYy9sLGg9LWkqcy9sLGc9ZGUobyxhKSxwPXllKG8sZiksdj15ZShhLGgpO21lKHAsdik7dmFyIGQ9ZyxtPXZlKHAsZCkseT12ZShkLGQpLHg9bSptLXkqKHZlKHAscCktMSk7aWYoISgwPngpKXt2YXIgTT1NYXRoLnNxcnQoeCksXz15ZShkLCgtbS1NKS95KTtpZihtZShfLHApLF89TWUoXyksIWUpcmV0dXJuIF87dmFyIGIsdz1uWzBdLFM9dFswXSxrPW5bMV0sRT10WzFdO3c+UyYmKGI9dyx3PVMsUz1iKTt2YXIgTj1TLXcsQT1mYShOLUFhKTxUYSxDPUF8fFRhPk47aWYoIUEmJms+RSYmKGI9ayxrPUUsRT1iKSxDP0E/aytFPjBeX1sxXTwoZmEoX1swXS13KTxUYT9rOkUpOms8PV9bMV0mJl9bMV08PUU6Tj5BYV4odzw9X1swXSYmX1swXTw9Uykpe3ZhciBMPXllKGQsKC1tK00pL3kpO3JldHVybiBtZShMLHApLFtfLE1lKEwpXX19fWZ1bmN0aW9uIHUodCxlKXt2YXIgcj1vP246QWEtbix1PTA7cmV0dXJuLXI+dD91fD0xOnQ+ciYmKHV8PTIpLC1yPmU/dXw9NDplPnImJih1fD04KSx1fXZhciBpPU1hdGguY29zKG4pLG89aT4wLGE9ZmEoaSk+VGEsYz1ncihuLDYqemEpO3JldHVybiBUZSh0LGUsYyxvP1swLC1uXTpbLUFhLG4tQWFdKX1mdW5jdGlvbiBGZShuLHQsZSxyKXtyZXR1cm4gZnVuY3Rpb24odSl7dmFyIGksbz11LmEsYT11LmIsYz1vLngscz1vLnksbD1hLngsZj1hLnksaD0wLGc9MSxwPWwtYyx2PWYtcztpZihpPW4tYyxwfHwhKGk+MCkpe2lmKGkvPXAsMD5wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9ZWxzZSBpZihwPjApe2lmKGk+ZylyZXR1cm47aT5oJiYoaD1pKX1pZihpPWUtYyxwfHwhKDA+aSkpe2lmKGkvPXAsMD5wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9ZWxzZSBpZihwPjApe2lmKGg+aSlyZXR1cm47Zz5pJiYoZz1pKX1pZihpPXQtcyx2fHwhKGk+MCkpe2lmKGkvPXYsMD52KXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9ZWxzZSBpZih2PjApe2lmKGk+ZylyZXR1cm47aT5oJiYoaD1pKX1pZihpPXItcyx2fHwhKDA+aSkpe2lmKGkvPXYsMD52KXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9ZWxzZSBpZih2PjApe2lmKGg+aSlyZXR1cm47Zz5pJiYoZz1pKX1yZXR1cm4gaD4wJiYodS5hPXt4OmMraCpwLHk6cytoKnZ9KSwxPmcmJih1LmI9e3g6YytnKnAseTpzK2cqdn0pLHV9fX19fX1mdW5jdGlvbiBPZShuLHQsZSxyKXtmdW5jdGlvbiB1KHIsdSl7cmV0dXJuIGZhKHJbMF0tbik8VGE/dT4wPzA6MzpmYShyWzBdLWUpPFRhP3U+MD8yOjE6ZmEoclsxXS10KTxUYT91PjA/MTowOnU+MD8zOjJ9ZnVuY3Rpb24gaShuLHQpe3JldHVybiBvKG4ueCx0LngpfWZ1bmN0aW9uIG8obix0KXt2YXIgZT11KG4sMSkscj11KHQsMSk7cmV0dXJuIGUhPT1yP2UtcjowPT09ZT90WzFdLW5bMV06MT09PWU/blswXS10WzBdOjI9PT1lP25bMV0tdFsxXTp0WzBdLW5bMF19cmV0dXJuIGZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGMobil7Zm9yKHZhciB0PTAsZT1kLmxlbmd0aCxyPW5bMV0sdT0wO2U+dTsrK3UpZm9yKHZhciBpLG89MSxhPWRbdV0sYz1hLmxlbmd0aCxzPWFbMF07Yz5vOysrbylpPWFbb10sc1sxXTw9cj9pWzFdPnImJkoocyxpLG4pPjAmJisrdDppWzFdPD1yJiZKKHMsaSxuKTwwJiYtLXQscz1pO3JldHVybiAwIT09dH1mdW5jdGlvbiBzKGksYSxjLHMpe3ZhciBsPTAsZj0wO2lmKG51bGw9PWl8fChsPXUoaSxjKSkhPT0oZj11KGEsYykpfHxvKGksYSk8MF5jPjApe2RvIHMucG9pbnQoMD09PWx8fDM9PT1sP246ZSxsPjE/cjp0KTt3aGlsZSgobD0obCtjKzQpJTQpIT09Zil9ZWxzZSBzLnBvaW50KGFbMF0sYVsxXSl9ZnVuY3Rpb24gbCh1LGkpe3JldHVybiB1Pj1uJiZlPj11JiZpPj10JiZyPj1pfWZ1bmN0aW9uIGYobix0KXtsKG4sdCkmJmEucG9pbnQobix0KX1mdW5jdGlvbiBoKCl7Qy5wb2ludD1wLGQmJmQucHVzaChtPVtdKSxTPSEwLHc9ITEsXz1iPTAvMH1mdW5jdGlvbiBnKCl7diYmKHAoeSx4KSxNJiZ3JiZOLnJlam9pbigpLHYucHVzaChOLmJ1ZmZlcigpKSksQy5wb2ludD1mLHcmJmEubGluZUVuZCgpfWZ1bmN0aW9uIHAobix0KXtuPU1hdGgubWF4KC1UYyxNYXRoLm1pbihUYyxuKSksdD1NYXRoLm1heCgtVGMsTWF0aC5taW4oVGMsdCkpO3ZhciBlPWwobix0KTtpZihkJiZtLnB1c2goW24sdF0pLFMpeT1uLHg9dCxNPWUsUz0hMSxlJiYoYS5saW5lU3RhcnQoKSxhLnBvaW50KG4sdCkpO2Vsc2UgaWYoZSYmdylhLnBvaW50KG4sdCk7ZWxzZXt2YXIgcj17YTp7eDpfLHk6Yn0sYjp7eDpuLHk6dH19O0Eocik/KHd8fChhLmxpbmVTdGFydCgpLGEucG9pbnQoci5hLngsci5hLnkpKSxhLnBvaW50KHIuYi54LHIuYi55KSxlfHxhLmxpbmVFbmQoKSxrPSExKTplJiYoYS5saW5lU3RhcnQoKSxhLnBvaW50KG4sdCksaz0hMSl9Xz1uLGI9dCx3PWV9dmFyIHYsZCxtLHkseCxNLF8sYix3LFMsayxFPWEsTj16ZSgpLEE9RmUobix0LGUsciksQz17cG9pbnQ6ZixsaW5lU3RhcnQ6aCxsaW5lRW5kOmcscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7YT1OLHY9W10sZD1bXSxrPSEwfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7YT1FLHY9R28ubWVyZ2Uodik7dmFyIHQ9YyhbbixyXSksZT1rJiZ0LHU9di5sZW5ndGg7KGV8fHUpJiYoYS5wb2x5Z29uU3RhcnQoKSxlJiYoYS5saW5lU3RhcnQoKSxzKG51bGwsbnVsbCwxLGEpLGEubGluZUVuZCgpKSx1JiZBZSh2LGksdCxzLGEpLGEucG9seWdvbkVuZCgpKSx2PWQ9bT1udWxsfX07cmV0dXJuIEN9fWZ1bmN0aW9uIFllKG4sdCl7ZnVuY3Rpb24gZShlLHIpe3JldHVybiBlPW4oZSxyKSx0KGVbMF0sZVsxXSl9cmV0dXJuIG4uaW52ZXJ0JiZ0LmludmVydCYmKGUuaW52ZXJ0PWZ1bmN0aW9uKGUscil7cmV0dXJuIGU9dC5pbnZlcnQoZSxyKSxlJiZuLmludmVydChlWzBdLGVbMV0pfSksZX1mdW5jdGlvbiBJZShuKXt2YXIgdD0wLGU9QWEvMyxyPWlyKG4pLHU9cih0LGUpO3JldHVybiB1LnBhcmFsbGVscz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD9yKHQ9blswXSpBYS8xODAsZT1uWzFdKkFhLzE4MCk6WzE4MCoodC9BYSksMTgwKihlL0FhKV19LHV9ZnVuY3Rpb24gWmUobix0KXtmdW5jdGlvbiBlKG4sdCl7dmFyIGU9TWF0aC5zcXJ0KGktMip1Kk1hdGguc2luKHQpKS91O3JldHVybltlKk1hdGguc2luKG4qPXUpLG8tZSpNYXRoLmNvcyhuKV19dmFyIHI9TWF0aC5zaW4obiksdT0ocitNYXRoLnNpbih0KSkvMixpPTErciooMip1LXIpLG89TWF0aC5zcXJ0KGkpL3U7cmV0dXJuIGUuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7dmFyIGU9by10O3JldHVybltNYXRoLmF0YW4yKG4sZSkvdSxHKChpLShuKm4rZSplKSp1KnUpLygyKnUpKV19LGV9ZnVuY3Rpb24gVmUoKXtmdW5jdGlvbiBuKG4sdCl7emMrPXUqbi1yKnQscj1uLHU9dH12YXIgdCxlLHIsdTtqYy5wb2ludD1mdW5jdGlvbihpLG8pe2pjLnBvaW50PW4sdD1yPWksZT11PW99LGpjLmxpbmVFbmQ9ZnVuY3Rpb24oKXtuKHQsZSl9fWZ1bmN0aW9uICRlKG4sdCl7UmM+biYmKFJjPW4pLG4+UGMmJihQYz1uKSxEYz50JiYoRGM9dCksdD5VYyYmKFVjPXQpfWZ1bmN0aW9uIFhlKCl7ZnVuY3Rpb24gbihuLHQpe28ucHVzaCgiTSIsbiwiLCIsdCxpKX1mdW5jdGlvbiB0KG4sdCl7by5wdXNoKCJNIixuLCIsIix0KSxhLnBvaW50PWV9ZnVuY3Rpb24gZShuLHQpe28ucHVzaCgiTCIsbiwiLCIsdCl9ZnVuY3Rpb24gcigpe2EucG9pbnQ9bn1mdW5jdGlvbiB1KCl7by5wdXNoKCJaIil9dmFyIGk9QmUoNC41KSxvPVtdLGE9e3BvaW50Om4sbGluZVN0YXJ0OmZ1bmN0aW9uKCl7YS5wb2ludD10fSxsaW5lRW5kOnIscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7YS5saW5lRW5kPXV9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXthLmxpbmVFbmQ9cixhLnBvaW50PW59LHBvaW50UmFkaXVzOmZ1bmN0aW9uKG4pe3JldHVybiBpPUJlKG4pLGF9LHJlc3VsdDpmdW5jdGlvbigpe2lmKG8ubGVuZ3RoKXt2YXIgbj1vLmpvaW4oIiIpO3JldHVybiBvPVtdLG59fX07cmV0dXJuIGF9ZnVuY3Rpb24gQmUobil7cmV0dXJuIm0wLCIrbisiYSIrbisiLCIrbisiIDAgMSwxIDAsIistMipuKyJhIituKyIsIituKyIgMCAxLDEgMCwiKzIqbisieiJ9ZnVuY3Rpb24gSmUobix0KXtNYys9bixfYys9dCwrK2JjfWZ1bmN0aW9uIFdlKCl7ZnVuY3Rpb24gbihuLHIpe3ZhciB1PW4tdCxpPXItZSxvPU1hdGguc3FydCh1KnUraSppKTt3Yys9byoodCtuKS8yLFNjKz1vKihlK3IpLzIsa2MrPW8sSmUodD1uLGU9cil9dmFyIHQsZTtGYy5wb2ludD1mdW5jdGlvbihyLHUpe0ZjLnBvaW50PW4sSmUodD1yLGU9dSl9fWZ1bmN0aW9uIEdlKCl7RmMucG9pbnQ9SmV9ZnVuY3Rpb24gS2UoKXtmdW5jdGlvbiBuKG4sdCl7dmFyIGU9bi1yLGk9dC11LG89TWF0aC5zcXJ0KGUqZStpKmkpO3djKz1vKihyK24pLzIsU2MrPW8qKHUrdCkvMixrYys9byxvPXUqbi1yKnQsRWMrPW8qKHIrbiksTmMrPW8qKHUrdCksQWMrPTMqbyxKZShyPW4sdT10KX12YXIgdCxlLHIsdTtGYy5wb2ludD1mdW5jdGlvbihpLG8pe0ZjLnBvaW50PW4sSmUodD1yPWksZT11PW8pfSxGYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpfX1mdW5jdGlvbiBRZShuKXtmdW5jdGlvbiB0KHQsZSl7bi5tb3ZlVG8odCxlKSxuLmFyYyh0LGUsbywwLENhKX1mdW5jdGlvbiBlKHQsZSl7bi5tb3ZlVG8odCxlKSxhLnBvaW50PXJ9ZnVuY3Rpb24gcih0LGUpe24ubGluZVRvKHQsZSl9ZnVuY3Rpb24gdSgpe2EucG9pbnQ9dH1mdW5jdGlvbiBpKCl7bi5jbG9zZVBhdGgoKX12YXIgbz00LjUsYT17cG9pbnQ6dCxsaW5lU3RhcnQ6ZnVuY3Rpb24oKXthLnBvaW50PWV9LGxpbmVFbmQ6dSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXthLmxpbmVFbmQ9aX0scG9seWdvbkVuZDpmdW5jdGlvbigpe2EubGluZUVuZD11LGEucG9pbnQ9dH0scG9pbnRSYWRpdXM6ZnVuY3Rpb24obil7cmV0dXJuIG89bixhfSxyZXN1bHQ6dn07cmV0dXJuIGF9ZnVuY3Rpb24gbnIobil7ZnVuY3Rpb24gdChuKXtyZXR1cm4oYT9yOmUpKG4pfWZ1bmN0aW9uIGUodCl7cmV0dXJuIHJyKHQsZnVuY3Rpb24oZSxyKXtlPW4oZSxyKSx0LnBvaW50KGVbMF0sZVsxXSl9KX1mdW5jdGlvbiByKHQpe2Z1bmN0aW9uIGUoZSxyKXtlPW4oZSxyKSx0LnBvaW50KGVbMF0sZVsxXSl9ZnVuY3Rpb24gcigpe3g9MC8wLFMucG9pbnQ9aSx0LmxpbmVTdGFydCgpfWZ1bmN0aW9uIGkoZSxyKXt2YXIgaT1wZShbZSxyXSksbz1uKGUscik7dSh4LE0seSxfLGIsdyx4PW9bMF0sTT1vWzFdLHk9ZSxfPWlbMF0sYj1pWzFdLHc9aVsyXSxhLHQpLHQucG9pbnQoeCxNKX1mdW5jdGlvbiBvKCl7Uy5wb2ludD1lLHQubGluZUVuZCgpfWZ1bmN0aW9uIGMoKXtyKCksUy5wb2ludD1zLFMubGluZUVuZD1sfWZ1bmN0aW9uIHMobix0KXtpKGY9bixoPXQpLGc9eCxwPU0sdj1fLGQ9YixtPXcsUy5wb2ludD1pfWZ1bmN0aW9uIGwoKXt1KHgsTSx5LF8sYix3LGcscCxmLHYsZCxtLGEsdCksUy5saW5lRW5kPW8sbygpfXZhciBmLGgsZyxwLHYsZCxtLHkseCxNLF8sYix3LFM9e3BvaW50OmUsbGluZVN0YXJ0OnIsbGluZUVuZDpvLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3QucG9seWdvblN0YXJ0KCksUy5saW5lU3RhcnQ9Y30scG9seWdvbkVuZDpmdW5jdGlvbigpe3QucG9seWdvbkVuZCgpLFMubGluZVN0YXJ0PXJ9fTtyZXR1cm4gU31mdW5jdGlvbiB1KHQsZSxyLGEsYyxzLGwsZixoLGcscCx2LGQsbSl7dmFyIHk9bC10LHg9Zi1lLE09eSp5K3gqeDtpZihNPjQqaSYmZC0tKXt2YXIgXz1hK2csYj1jK3Asdz1zK3YsUz1NYXRoLnNxcnQoXypfK2IqYit3KncpLGs9TWF0aC5hc2luKHcvPVMpLEU9ZmEoZmEodyktMSk8VGF8fGZhKHItaCk8VGE/KHIraCkvMjpNYXRoLmF0YW4yKGIsXyksTj1uKEUsayksQT1OWzBdLEM9TlsxXSxMPUEtdCxUPUMtZSxxPXgqTC15KlQ7KHEqcS9NPml8fGZhKCh5KkwreCpUKS9NLS41KT4uM3x8bz5hKmcrYypwK3MqdikmJih1KHQsZSxyLGEsYyxzLEEsQyxFLF8vPVMsYi89Uyx3LGQsbSksbS5wb2ludChBLEMpLHUoQSxDLEUsXyxiLHcsbCxmLGgsZyxwLHYsZCxtKSl9fXZhciBpPS41LG89TWF0aC5jb3MoMzAqemEpLGE9MTY7cmV0dXJuIHQucHJlY2lzaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPShpPW4qbik+MCYmMTYsdCk6TWF0aC5zcXJ0KGkpfSx0fWZ1bmN0aW9uIHRyKG4pe3ZhciB0PW5yKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIG4oW3QqUmEsZSpSYV0pfSk7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBvcih0KG4pKX19ZnVuY3Rpb24gZXIobil7dGhpcy5zdHJlYW09bn1mdW5jdGlvbiBycihuLHQpe3JldHVybntwb2ludDp0LHNwaGVyZTpmdW5jdGlvbigpe24uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe24ubGluZVN0YXJ0KCl9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtuLmxpbmVFbmQoKX0scG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7bi5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe24ucG9seWdvbkVuZCgpfX19ZnVuY3Rpb24gdXIobil7cmV0dXJuIGlyKGZ1bmN0aW9uKCl7cmV0dXJuIG59KSgpfWZ1bmN0aW9uIGlyKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuIG49YShuWzBdKnphLG5bMV0qemEpLFtuWzBdKmgrYyxzLW5bMV0qaF19ZnVuY3Rpb24gZShuKXtyZXR1cm4gbj1hLmludmVydCgoblswXS1jKS9oLChzLW5bMV0pL2gpLG4mJltuWzBdKlJhLG5bMV0qUmFdfWZ1bmN0aW9uIHIoKXthPVllKG89c3IobSx5LHgpLGkpO3ZhciBuPWkodixkKTtyZXR1cm4gYz1nLW5bMF0qaCxzPXArblsxXSpoLHUoKX1mdW5jdGlvbiB1KCl7cmV0dXJuIGwmJihsLnZhbGlkPSExLGw9bnVsbCksdH12YXIgaSxvLGEsYyxzLGwsZj1ucihmdW5jdGlvbihuLHQpe3JldHVybiBuPWkobix0KSxbblswXSpoK2Mscy1uWzFdKmhdCn0pLGg9MTUwLGc9NDgwLHA9MjUwLHY9MCxkPTAsbT0wLHk9MCx4PTAsTT1MYyxfPU50LGI9bnVsbCx3PW51bGw7cmV0dXJuIHQuc3RyZWFtPWZ1bmN0aW9uKG4pe3JldHVybiBsJiYobC52YWxpZD0hMSksbD1vcihNKG8sZihfKG4pKSkpLGwudmFsaWQ9ITAsbH0sdC5jbGlwQW5nbGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KE09bnVsbD09bj8oYj1uLExjKTpIZSgoYj0rbikqemEpLHUoKSk6Yn0sdC5jbGlwRXh0ZW50PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh3PW4sXz1uP09lKG5bMF1bMF0sblswXVsxXSxuWzFdWzBdLG5bMV1bMV0pOk50LHUoKSk6d30sdC5zY2FsZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaD0rbixyKCkpOmh9LHQudHJhbnNsYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPStuWzBdLHA9K25bMV0scigpKTpbZyxwXX0sdC5jZW50ZXI9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHY9blswXSUzNjAqemEsZD1uWzFdJTM2MCp6YSxyKCkpOlt2KlJhLGQqUmFdfSx0LnJvdGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obT1uWzBdJTM2MCp6YSx5PW5bMV0lMzYwKnphLHg9bi5sZW5ndGg+Mj9uWzJdJTM2MCp6YTowLHIoKSk6W20qUmEseSpSYSx4KlJhXX0sR28ucmViaW5kKHQsZiwicHJlY2lzaW9uIiksZnVuY3Rpb24oKXtyZXR1cm4gaT1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0LmludmVydD1pLmludmVydCYmZSxyKCl9fWZ1bmN0aW9uIG9yKG4pe3JldHVybiBycihuLGZ1bmN0aW9uKHQsZSl7bi5wb2ludCh0KnphLGUqemEpfSl9ZnVuY3Rpb24gYXIobix0KXtyZXR1cm5bbix0XX1mdW5jdGlvbiBjcihuLHQpe3JldHVybltuPkFhP24tQ2E6LUFhPm4/bitDYTpuLHRdfWZ1bmN0aW9uIHNyKG4sdCxlKXtyZXR1cm4gbj90fHxlP1llKGZyKG4pLGhyKHQsZSkpOmZyKG4pOnR8fGU/aHIodCxlKTpjcn1mdW5jdGlvbiBscihuKXtyZXR1cm4gZnVuY3Rpb24odCxlKXtyZXR1cm4gdCs9bixbdD5BYT90LUNhOi1BYT50P3QrQ2E6dCxlXX19ZnVuY3Rpb24gZnIobil7dmFyIHQ9bHIobik7cmV0dXJuIHQuaW52ZXJ0PWxyKC1uKSx0fWZ1bmN0aW9uIGhyKG4sdCl7ZnVuY3Rpb24gZShuLHQpe3ZhciBlPU1hdGguY29zKHQpLGE9TWF0aC5jb3MobikqZSxjPU1hdGguc2luKG4pKmUscz1NYXRoLnNpbih0KSxsPXMqcithKnU7cmV0dXJuW01hdGguYXRhbjIoYyppLWwqbyxhKnItcyp1KSxHKGwqaStjKm8pXX12YXIgcj1NYXRoLmNvcyhuKSx1PU1hdGguc2luKG4pLGk9TWF0aC5jb3ModCksbz1NYXRoLnNpbih0KTtyZXR1cm4gZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgZT1NYXRoLmNvcyh0KSxhPU1hdGguY29zKG4pKmUsYz1NYXRoLnNpbihuKSplLHM9TWF0aC5zaW4odCksbD1zKmktYypvO3JldHVybltNYXRoLmF0YW4yKGMqaStzKm8sYSpyK2wqdSksRyhsKnItYSp1KV19LGV9ZnVuY3Rpb24gZ3Iobix0KXt2YXIgZT1NYXRoLmNvcyhuKSxyPU1hdGguc2luKG4pO3JldHVybiBmdW5jdGlvbih1LGksbyxhKXt2YXIgYz1vKnQ7bnVsbCE9dT8odT1wcihlLHUpLGk9cHIoZSxpKSwobz4wP2k+dTp1PmkpJiYodSs9bypDYSkpOih1PW4rbypDYSxpPW4tLjUqYyk7Zm9yKHZhciBzLGw9dTtvPjA/bD5pOmk+bDtsLT1jKWEucG9pbnQoKHM9TWUoW2UsLXIqTWF0aC5jb3MobCksLXIqTWF0aC5zaW4obCldKSlbMF0sc1sxXSl9fWZ1bmN0aW9uIHByKG4sdCl7dmFyIGU9cGUodCk7ZVswXS09bix4ZShlKTt2YXIgcj1XKC1lWzFdKTtyZXR1cm4oKC1lWzJdPDA/LXI6cikrMipNYXRoLlBJLVRhKSUoMipNYXRoLlBJKX1mdW5jdGlvbiB2cihuLHQsZSl7dmFyIHI9R28ucmFuZ2Uobix0LVRhLGUpLmNvbmNhdCh0KTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIHIubWFwKGZ1bmN0aW9uKHQpe3JldHVybltuLHRdfSl9fWZ1bmN0aW9uIGRyKG4sdCxlKXt2YXIgcj1Hby5yYW5nZShuLHQtVGEsZSkuY29uY2F0KHQpO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gci5tYXAoZnVuY3Rpb24odCl7cmV0dXJuW3Qsbl19KX19ZnVuY3Rpb24gbXIobil7cmV0dXJuIG4uc291cmNlfWZ1bmN0aW9uIHlyKG4pe3JldHVybiBuLnRhcmdldH1mdW5jdGlvbiB4cihuLHQsZSxyKXt2YXIgdT1NYXRoLmNvcyh0KSxpPU1hdGguc2luKHQpLG89TWF0aC5jb3MociksYT1NYXRoLnNpbihyKSxjPXUqTWF0aC5jb3Mobikscz11Kk1hdGguc2luKG4pLGw9bypNYXRoLmNvcyhlKSxmPW8qTWF0aC5zaW4oZSksaD0yKk1hdGguYXNpbihNYXRoLnNxcnQodHQoci10KSt1Km8qdHQoZS1uKSkpLGc9MS9NYXRoLnNpbihoKSxwPWg/ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zaW4obio9aCkqZyxlPU1hdGguc2luKGgtbikqZyxyPWUqYyt0KmwsdT1lKnMrdCpmLG89ZSppK3QqYTtyZXR1cm5bTWF0aC5hdGFuMih1LHIpKlJhLE1hdGguYXRhbjIobyxNYXRoLnNxcnQocipyK3UqdSkpKlJhXX06ZnVuY3Rpb24oKXtyZXR1cm5bbipSYSx0KlJhXX07cmV0dXJuIHAuZGlzdGFuY2U9aCxwfWZ1bmN0aW9uIE1yKCl7ZnVuY3Rpb24gbihuLHUpe3ZhciBpPU1hdGguc2luKHUqPXphKSxvPU1hdGguY29zKHUpLGE9ZmEoKG4qPXphKS10KSxjPU1hdGguY29zKGEpO09jKz1NYXRoLmF0YW4yKE1hdGguc3FydCgoYT1vKk1hdGguc2luKGEpKSphKyhhPXIqaS1lKm8qYykqYSksZSppK3IqbypjKSx0PW4sZT1pLHI9b312YXIgdCxlLHI7WWMucG9pbnQ9ZnVuY3Rpb24odSxpKXt0PXUqemEsZT1NYXRoLnNpbihpKj16YSkscj1NYXRoLmNvcyhpKSxZYy5wb2ludD1ufSxZYy5saW5lRW5kPWZ1bmN0aW9uKCl7WWMucG9pbnQ9WWMubGluZUVuZD12fX1mdW5jdGlvbiBfcihuLHQpe2Z1bmN0aW9uIGUodCxlKXt2YXIgcj1NYXRoLmNvcyh0KSx1PU1hdGguY29zKGUpLGk9bihyKnUpO3JldHVybltpKnUqTWF0aC5zaW4odCksaSpNYXRoLnNpbihlKV19cmV0dXJuIGUuaW52ZXJ0PWZ1bmN0aW9uKG4sZSl7dmFyIHI9TWF0aC5zcXJ0KG4qbitlKmUpLHU9dChyKSxpPU1hdGguc2luKHUpLG89TWF0aC5jb3ModSk7cmV0dXJuW01hdGguYXRhbjIobippLHIqbyksTWF0aC5hc2luKHImJmUqaS9yKV19LGV9ZnVuY3Rpb24gYnIobix0KXtmdW5jdGlvbiBlKG4sdCl7bz4wPy1MYStUYT50JiYodD0tTGErVGEpOnQ+TGEtVGEmJih0PUxhLVRhKTt2YXIgZT1vL01hdGgucG93KHUodCksaSk7cmV0dXJuW2UqTWF0aC5zaW4oaSpuKSxvLWUqTWF0aC5jb3MoaSpuKV19dmFyIHI9TWF0aC5jb3MobiksdT1mdW5jdGlvbihuKXtyZXR1cm4gTWF0aC50YW4oQWEvNCtuLzIpfSxpPW49PT10P01hdGguc2luKG4pOk1hdGgubG9nKHIvTWF0aC5jb3ModCkpL01hdGgubG9nKHUodCkvdShuKSksbz1yKk1hdGgucG93KHUobiksaSkvaTtyZXR1cm4gaT8oZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgZT1vLXQscj1CKGkpKk1hdGguc3FydChuKm4rZSplKTtyZXR1cm5bTWF0aC5hdGFuMihuLGUpL2ksMipNYXRoLmF0YW4oTWF0aC5wb3coby9yLDEvaSkpLUxhXX0sZSk6U3J9ZnVuY3Rpb24gd3Iobix0KXtmdW5jdGlvbiBlKG4sdCl7dmFyIGU9aS10O3JldHVybltlKk1hdGguc2luKHUqbiksaS1lKk1hdGguY29zKHUqbildfXZhciByPU1hdGguY29zKG4pLHU9bj09PXQ/TWF0aC5zaW4obik6KHItTWF0aC5jb3ModCkpLyh0LW4pLGk9ci91K247cmV0dXJuIGZhKHUpPFRhP2FyOihlLmludmVydD1mdW5jdGlvbihuLHQpe3ZhciBlPWktdDtyZXR1cm5bTWF0aC5hdGFuMihuLGUpL3UsaS1CKHUpKk1hdGguc3FydChuKm4rZSplKV19LGUpfWZ1bmN0aW9uIFNyKG4sdCl7cmV0dXJuW24sTWF0aC5sb2coTWF0aC50YW4oQWEvNCt0LzIpKV19ZnVuY3Rpb24ga3Iobil7dmFyIHQsZT11cihuKSxyPWUuc2NhbGUsdT1lLnRyYW5zbGF0ZSxpPWUuY2xpcEV4dGVudDtyZXR1cm4gZS5zY2FsZT1mdW5jdGlvbigpe3ZhciBuPXIuYXBwbHkoZSxhcmd1bWVudHMpO3JldHVybiBuPT09ZT90P2UuY2xpcEV4dGVudChudWxsKTplOm59LGUudHJhbnNsYXRlPWZ1bmN0aW9uKCl7dmFyIG49dS5hcHBseShlLGFyZ3VtZW50cyk7cmV0dXJuIG49PT1lP3Q/ZS5jbGlwRXh0ZW50KG51bGwpOmU6bn0sZS5jbGlwRXh0ZW50PWZ1bmN0aW9uKG4pe3ZhciBvPWkuYXBwbHkoZSxhcmd1bWVudHMpO2lmKG89PT1lKXtpZih0PW51bGw9PW4pe3ZhciBhPUFhKnIoKSxjPXUoKTtpKFtbY1swXS1hLGNbMV0tYV0sW2NbMF0rYSxjWzFdK2FdXSl9fWVsc2UgdCYmKG89bnVsbCk7cmV0dXJuIG99LGUuY2xpcEV4dGVudChudWxsKX1mdW5jdGlvbiBFcihuLHQpe3JldHVybltNYXRoLmxvZyhNYXRoLnRhbihBYS80K3QvMikpLC1uXX1mdW5jdGlvbiBOcihuKXtyZXR1cm4gblswXX1mdW5jdGlvbiBBcihuKXtyZXR1cm4gblsxXX1mdW5jdGlvbiBDcihuKXtmb3IodmFyIHQ9bi5sZW5ndGgsZT1bMCwxXSxyPTIsdT0yO3Q+dTt1Kyspe2Zvcig7cj4xJiZKKG5bZVtyLTJdXSxuW2Vbci0xXV0sblt1XSk8PTA7KS0tcjtlW3IrK109dX1yZXR1cm4gZS5zbGljZSgwLHIpfWZ1bmN0aW9uIExyKG4sdCl7cmV0dXJuIG5bMF0tdFswXXx8blsxXS10WzFdfWZ1bmN0aW9uIFRyKG4sdCxlKXtyZXR1cm4oZVswXS10WzBdKSooblsxXS10WzFdKTwoZVsxXS10WzFdKSooblswXS10WzBdKX1mdW5jdGlvbiBxcihuLHQsZSxyKXt2YXIgdT1uWzBdLGk9ZVswXSxvPXRbMF0tdSxhPXJbMF0taSxjPW5bMV0scz1lWzFdLGw9dFsxXS1jLGY9clsxXS1zLGg9KGEqKGMtcyktZioodS1pKSkvKGYqby1hKmwpO3JldHVyblt1K2gqbyxjK2gqbF19ZnVuY3Rpb24genIobil7dmFyIHQ9blswXSxlPW5bbi5sZW5ndGgtMV07cmV0dXJuISh0WzBdLWVbMF18fHRbMV0tZVsxXSl9ZnVuY3Rpb24gUnIoKXt0dSh0aGlzKSx0aGlzLmVkZ2U9dGhpcy5zaXRlPXRoaXMuY2lyY2xlPW51bGx9ZnVuY3Rpb24gRHIobil7dmFyIHQ9bnMucG9wKCl8fG5ldyBScjtyZXR1cm4gdC5zaXRlPW4sdH1mdW5jdGlvbiBQcihuKXskcihuKSxHYy5yZW1vdmUobiksbnMucHVzaChuKSx0dShuKX1mdW5jdGlvbiBVcihuKXt2YXIgdD1uLmNpcmNsZSxlPXQueCxyPXQuY3ksdT17eDplLHk6cn0saT1uLlAsbz1uLk4sYT1bbl07UHIobik7Zm9yKHZhciBjPWk7Yy5jaXJjbGUmJmZhKGUtYy5jaXJjbGUueCk8VGEmJmZhKHItYy5jaXJjbGUuY3kpPFRhOylpPWMuUCxhLnVuc2hpZnQoYyksUHIoYyksYz1pO2EudW5zaGlmdChjKSwkcihjKTtmb3IodmFyIHM9bztzLmNpcmNsZSYmZmEoZS1zLmNpcmNsZS54KTxUYSYmZmEoci1zLmNpcmNsZS5jeSk8VGE7KW89cy5OLGEucHVzaChzKSxQcihzKSxzPW87YS5wdXNoKHMpLCRyKHMpO3ZhciBsLGY9YS5sZW5ndGg7Zm9yKGw9MTtmPmw7KytsKXM9YVtsXSxjPWFbbC0xXSxLcihzLmVkZ2UsYy5zaXRlLHMuc2l0ZSx1KTtjPWFbMF0scz1hW2YtMV0scy5lZGdlPVdyKGMuc2l0ZSxzLnNpdGUsbnVsbCx1KSxWcihjKSxWcihzKX1mdW5jdGlvbiBqcihuKXtmb3IodmFyIHQsZSxyLHUsaT1uLngsbz1uLnksYT1HYy5fO2E7KWlmKHI9SHIoYSxvKS1pLHI+VGEpYT1hLkw7ZWxzZXtpZih1PWktRnIoYSxvKSwhKHU+VGEpKXtyPi1UYT8odD1hLlAsZT1hKTp1Pi1UYT8odD1hLGU9YS5OKTp0PWU9YTticmVha31pZighYS5SKXt0PWE7YnJlYWt9YT1hLlJ9dmFyIGM9RHIobik7aWYoR2MuaW5zZXJ0KHQsYyksdHx8ZSl7aWYodD09PWUpcmV0dXJuICRyKHQpLGU9RHIodC5zaXRlKSxHYy5pbnNlcnQoYyxlKSxjLmVkZ2U9ZS5lZGdlPVdyKHQuc2l0ZSxjLnNpdGUpLFZyKHQpLFZyKGUpLHZvaWQgMDtpZighZSlyZXR1cm4gYy5lZGdlPVdyKHQuc2l0ZSxjLnNpdGUpLHZvaWQgMDskcih0KSwkcihlKTt2YXIgcz10LnNpdGUsbD1zLngsZj1zLnksaD1uLngtbCxnPW4ueS1mLHA9ZS5zaXRlLHY9cC54LWwsZD1wLnktZixtPTIqKGgqZC1nKnYpLHk9aCpoK2cqZyx4PXYqditkKmQsTT17eDooZCp5LWcqeCkvbStsLHk6KGgqeC12KnkpL20rZn07S3IoZS5lZGdlLHMscCxNKSxjLmVkZ2U9V3IocyxuLG51bGwsTSksZS5lZGdlPVdyKG4scCxudWxsLE0pLFZyKHQpLFZyKGUpfX1mdW5jdGlvbiBIcihuLHQpe3ZhciBlPW4uc2l0ZSxyPWUueCx1PWUueSxpPXUtdDtpZighaSlyZXR1cm4gcjt2YXIgbz1uLlA7aWYoIW8pcmV0dXJuLTEvMDtlPW8uc2l0ZTt2YXIgYT1lLngsYz1lLnkscz1jLXQ7aWYoIXMpcmV0dXJuIGE7dmFyIGw9YS1yLGY9MS9pLTEvcyxoPWwvcztyZXR1cm4gZj8oLWgrTWF0aC5zcXJ0KGgqaC0yKmYqKGwqbC8oLTIqcyktYytzLzIrdS1pLzIpKSkvZityOihyK2EpLzJ9ZnVuY3Rpb24gRnIobix0KXt2YXIgZT1uLk47aWYoZSlyZXR1cm4gSHIoZSx0KTt2YXIgcj1uLnNpdGU7cmV0dXJuIHIueT09PXQ/ci54OjEvMH1mdW5jdGlvbiBPcihuKXt0aGlzLnNpdGU9bix0aGlzLmVkZ2VzPVtdfWZ1bmN0aW9uIFlyKG4pe2Zvcih2YXIgdCxlLHIsdSxpLG8sYSxjLHMsbCxmPW5bMF1bMF0saD1uWzFdWzBdLGc9blswXVsxXSxwPW5bMV1bMV0sdj1XYyxkPXYubGVuZ3RoO2QtLTspaWYoaT12W2RdLGkmJmkucHJlcGFyZSgpKWZvcihhPWkuZWRnZXMsYz1hLmxlbmd0aCxvPTA7Yz5vOylsPWFbb10uZW5kKCkscj1sLngsdT1sLnkscz1hWysrbyVjXS5zdGFydCgpLHQ9cy54LGU9cy55LChmYShyLXQpPlRhfHxmYSh1LWUpPlRhKSYmKGEuc3BsaWNlKG8sMCxuZXcgUXIoR3IoaS5zaXRlLGwsZmEoci1mKTxUYSYmcC11PlRhP3t4OmYseTpmYSh0LWYpPFRhP2U6cH06ZmEodS1wKTxUYSYmaC1yPlRhP3t4OmZhKGUtcCk8VGE/dDpoLHk6cH06ZmEoci1oKTxUYSYmdS1nPlRhP3t4OmgseTpmYSh0LWgpPFRhP2U6Z306ZmEodS1nKTxUYSYmci1mPlRhP3t4OmZhKGUtZyk8VGE/dDpmLHk6Z306bnVsbCksaS5zaXRlLG51bGwpKSwrK2MpfWZ1bmN0aW9uIElyKG4sdCl7cmV0dXJuIHQuYW5nbGUtbi5hbmdsZX1mdW5jdGlvbiBacigpe3R1KHRoaXMpLHRoaXMueD10aGlzLnk9dGhpcy5hcmM9dGhpcy5zaXRlPXRoaXMuY3k9bnVsbH1mdW5jdGlvbiBWcihuKXt2YXIgdD1uLlAsZT1uLk47aWYodCYmZSl7dmFyIHI9dC5zaXRlLHU9bi5zaXRlLGk9ZS5zaXRlO2lmKHIhPT1pKXt2YXIgbz11LngsYT11LnksYz1yLngtbyxzPXIueS1hLGw9aS54LW8sZj1pLnktYSxoPTIqKGMqZi1zKmwpO2lmKCEoaD49LXFhKSl7dmFyIGc9YypjK3MqcyxwPWwqbCtmKmYsdj0oZipnLXMqcCkvaCxkPShjKnAtbCpnKS9oLGY9ZCthLG09dHMucG9wKCl8fG5ldyBacjttLmFyYz1uLG0uc2l0ZT11LG0ueD12K28sbS55PWYrTWF0aC5zcXJ0KHYqditkKmQpLG0uY3k9ZixuLmNpcmNsZT1tO2Zvcih2YXIgeT1udWxsLHg9UWMuXzt4OylpZihtLnk8eC55fHxtLnk9PT14LnkmJm0ueDw9eC54KXtpZigheC5MKXt5PXguUDticmVha314PXguTH1lbHNle2lmKCF4LlIpe3k9eDticmVha314PXguUn1RYy5pbnNlcnQoeSxtKSx5fHwoS2M9bSl9fX19ZnVuY3Rpb24gJHIobil7dmFyIHQ9bi5jaXJjbGU7dCYmKHQuUHx8KEtjPXQuTiksUWMucmVtb3ZlKHQpLHRzLnB1c2godCksdHUodCksbi5jaXJjbGU9bnVsbCl9ZnVuY3Rpb24gWHIobil7Zm9yKHZhciB0LGU9SmMscj1GZShuWzBdWzBdLG5bMF1bMV0sblsxXVswXSxuWzFdWzFdKSx1PWUubGVuZ3RoO3UtLTspdD1lW3VdLCghQnIodCxuKXx8IXIodCl8fGZhKHQuYS54LXQuYi54KTxUYSYmZmEodC5hLnktdC5iLnkpPFRhKSYmKHQuYT10LmI9bnVsbCxlLnNwbGljZSh1LDEpKX1mdW5jdGlvbiBCcihuLHQpe3ZhciBlPW4uYjtpZihlKXJldHVybiEwO3ZhciByLHUsaT1uLmEsbz10WzBdWzBdLGE9dFsxXVswXSxjPXRbMF1bMV0scz10WzFdWzFdLGw9bi5sLGY9bi5yLGg9bC54LGc9bC55LHA9Zi54LHY9Zi55LGQ9KGgrcCkvMixtPShnK3YpLzI7aWYodj09PWcpe2lmKG8+ZHx8ZD49YSlyZXR1cm47aWYoaD5wKXtpZihpKXtpZihpLnk+PXMpcmV0dXJufWVsc2UgaT17eDpkLHk6Y307ZT17eDpkLHk6c319ZWxzZXtpZihpKXtpZihpLnk8YylyZXR1cm59ZWxzZSBpPXt4OmQseTpzfTtlPXt4OmQseTpjfX19ZWxzZSBpZihyPShoLXApLyh2LWcpLHU9bS1yKmQsLTE+cnx8cj4xKWlmKGg+cCl7aWYoaSl7aWYoaS55Pj1zKXJldHVybn1lbHNlIGk9e3g6KGMtdSkvcix5OmN9O2U9e3g6KHMtdSkvcix5OnN9fWVsc2V7aWYoaSl7aWYoaS55PGMpcmV0dXJufWVsc2UgaT17eDoocy11KS9yLHk6c307ZT17eDooYy11KS9yLHk6Y319ZWxzZSBpZih2Pmcpe2lmKGkpe2lmKGkueD49YSlyZXR1cm59ZWxzZSBpPXt4Om8seTpyKm8rdX07ZT17eDphLHk6ciphK3V9fWVsc2V7aWYoaSl7aWYoaS54PG8pcmV0dXJufWVsc2UgaT17eDphLHk6ciphK3V9O2U9e3g6byx5OnIqbyt1fX1yZXR1cm4gbi5hPWksbi5iPWUsITB9ZnVuY3Rpb24gSnIobix0KXt0aGlzLmw9bix0aGlzLnI9dCx0aGlzLmE9dGhpcy5iPW51bGx9ZnVuY3Rpb24gV3Iobix0LGUscil7dmFyIHU9bmV3IEpyKG4sdCk7cmV0dXJuIEpjLnB1c2godSksZSYmS3IodSxuLHQsZSksciYmS3IodSx0LG4sciksV2Nbbi5pXS5lZGdlcy5wdXNoKG5ldyBRcih1LG4sdCkpLFdjW3QuaV0uZWRnZXMucHVzaChuZXcgUXIodSx0LG4pKSx1fWZ1bmN0aW9uIEdyKG4sdCxlKXt2YXIgcj1uZXcgSnIobixudWxsKTtyZXR1cm4gci5hPXQsci5iPWUsSmMucHVzaChyKSxyfWZ1bmN0aW9uIEtyKG4sdCxlLHIpe24uYXx8bi5iP24ubD09PWU/bi5iPXI6bi5hPXI6KG4uYT1yLG4ubD10LG4ucj1lKX1mdW5jdGlvbiBRcihuLHQsZSl7dmFyIHI9bi5hLHU9bi5iO3RoaXMuZWRnZT1uLHRoaXMuc2l0ZT10LHRoaXMuYW5nbGU9ZT9NYXRoLmF0YW4yKGUueS10LnksZS54LXQueCk6bi5sPT09dD9NYXRoLmF0YW4yKHUueC1yLngsci55LXUueSk6TWF0aC5hdGFuMihyLngtdS54LHUueS1yLnkpfWZ1bmN0aW9uIG51KCl7dGhpcy5fPW51bGx9ZnVuY3Rpb24gdHUobil7bi5VPW4uQz1uLkw9bi5SPW4uUD1uLk49bnVsbH1mdW5jdGlvbiBldShuLHQpe3ZhciBlPXQscj10LlIsdT1lLlU7dT91Lkw9PT1lP3UuTD1yOnUuUj1yOm4uXz1yLHIuVT11LGUuVT1yLGUuUj1yLkwsZS5SJiYoZS5SLlU9ZSksci5MPWV9ZnVuY3Rpb24gcnUobix0KXt2YXIgZT10LHI9dC5MLHU9ZS5VO3U/dS5MPT09ZT91Lkw9cjp1LlI9cjpuLl89cixyLlU9dSxlLlU9cixlLkw9ci5SLGUuTCYmKGUuTC5VPWUpLHIuUj1lfWZ1bmN0aW9uIHV1KG4pe2Zvcig7bi5MOyluPW4uTDtyZXR1cm4gbn1mdW5jdGlvbiBpdShuLHQpe3ZhciBlLHIsdSxpPW4uc29ydChvdSkucG9wKCk7Zm9yKEpjPVtdLFdjPW5ldyBBcnJheShuLmxlbmd0aCksR2M9bmV3IG51LFFjPW5ldyBudTs7KWlmKHU9S2MsaSYmKCF1fHxpLnk8dS55fHxpLnk9PT11LnkmJmkueDx1LngpKShpLnghPT1lfHxpLnkhPT1yKSYmKFdjW2kuaV09bmV3IE9yKGkpLGpyKGkpLGU9aS54LHI9aS55KSxpPW4ucG9wKCk7ZWxzZXtpZighdSlicmVhaztVcih1LmFyYyl9dCYmKFhyKHQpLFlyKHQpKTt2YXIgbz17Y2VsbHM6V2MsZWRnZXM6SmN9O3JldHVybiBHYz1RYz1KYz1XYz1udWxsLG99ZnVuY3Rpb24gb3Uobix0KXtyZXR1cm4gdC55LW4ueXx8dC54LW4ueH1mdW5jdGlvbiBhdShuLHQsZSl7cmV0dXJuKG4ueC1lLngpKih0Lnktbi55KS0obi54LXQueCkqKGUueS1uLnkpfWZ1bmN0aW9uIGN1KG4pe3JldHVybiBuLnh9ZnVuY3Rpb24gc3Uobil7cmV0dXJuIG4ueX1mdW5jdGlvbiBsdSgpe3JldHVybntsZWFmOiEwLG5vZGVzOltdLHBvaW50Om51bGwseDpudWxsLHk6bnVsbH19ZnVuY3Rpb24gZnUobix0LGUscix1LGkpe2lmKCFuKHQsZSxyLHUsaSkpe3ZhciBvPS41KihlK3UpLGE9LjUqKHIraSksYz10Lm5vZGVzO2NbMF0mJmZ1KG4sY1swXSxlLHIsbyxhKSxjWzFdJiZmdShuLGNbMV0sbyxyLHUsYSksY1syXSYmZnUobixjWzJdLGUsYSxvLGkpLGNbM10mJmZ1KG4sY1szXSxvLGEsdSxpKX19ZnVuY3Rpb24gaHUobix0KXtuPUdvLnJnYihuKSx0PUdvLnJnYih0KTt2YXIgZT1uLnIscj1uLmcsdT1uLmIsaT10LnItZSxvPXQuZy1yLGE9dC5iLXU7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiIjIitNdChNYXRoLnJvdW5kKGUraSpuKSkrTXQoTWF0aC5yb3VuZChyK28qbikpK010KE1hdGgucm91bmQodSthKm4pKX19ZnVuY3Rpb24gZ3Uobix0KXt2YXIgZSxyPXt9LHU9e307Zm9yKGUgaW4gbillIGluIHQ/cltlXT1kdShuW2VdLHRbZV0pOnVbZV09bltlXTtmb3IoZSBpbiB0KWUgaW4gbnx8KHVbZV09dFtlXSk7cmV0dXJuIGZ1bmN0aW9uKG4pe2ZvcihlIGluIHIpdVtlXT1yW2VdKG4pO3JldHVybiB1fX1mdW5jdGlvbiBwdShuLHQpe3JldHVybiB0LT1uPStuLGZ1bmN0aW9uKGUpe3JldHVybiBuK3QqZX19ZnVuY3Rpb24gdnUobix0KXt2YXIgZSxyLHUsaSxvLGE9MCxjPTAscz1bXSxsPVtdO2ZvcihuKz0iIix0Kz0iIixycy5sYXN0SW5kZXg9MCxyPTA7ZT1ycy5leGVjKHQpOysrcillLmluZGV4JiZzLnB1c2godC5zdWJzdHJpbmcoYSxjPWUuaW5kZXgpKSxsLnB1c2goe2k6cy5sZW5ndGgseDplWzBdfSkscy5wdXNoKG51bGwpLGE9cnMubGFzdEluZGV4O2ZvcihhPHQubGVuZ3RoJiZzLnB1c2godC5zdWJzdHJpbmcoYSkpLHI9MCxpPWwubGVuZ3RoOyhlPXJzLmV4ZWMobikpJiZpPnI7KytyKWlmKG89bFtyXSxvLng9PWVbMF0pe2lmKG8uaSlpZihudWxsPT1zW28uaSsxXSlmb3Ioc1tvLmktMV0rPW8ueCxzLnNwbGljZShvLmksMSksdT1yKzE7aT51OysrdSlsW3VdLmktLTtlbHNlIGZvcihzW28uaS0xXSs9by54K3Nbby5pKzFdLHMuc3BsaWNlKG8uaSwyKSx1PXIrMTtpPnU7Kyt1KWxbdV0uaS09MjtlbHNlIGlmKG51bGw9PXNbby5pKzFdKXNbby5pXT1vLng7ZWxzZSBmb3Ioc1tvLmldPW8ueCtzW28uaSsxXSxzLnNwbGljZShvLmkrMSwxKSx1PXIrMTtpPnU7Kyt1KWxbdV0uaS0tO2wuc3BsaWNlKHIsMSksaS0tLHItLX1lbHNlIG8ueD1wdShwYXJzZUZsb2F0KGVbMF0pLHBhcnNlRmxvYXQoby54KSk7Zm9yKDtpPnI7KW89bC5wb3AoKSxudWxsPT1zW28uaSsxXT9zW28uaV09by54OihzW28uaV09by54K3Nbby5pKzFdLHMuc3BsaWNlKG8uaSsxLDEpKSxpLS07cmV0dXJuIDE9PT1zLmxlbmd0aD9udWxsPT1zWzBdPyhvPWxbMF0ueCxmdW5jdGlvbihuKXtyZXR1cm4gbyhuKSsiIn0pOmZ1bmN0aW9uKCl7cmV0dXJuIHR9OmZ1bmN0aW9uKG4pe2ZvcihyPTA7aT5yOysrcilzWyhvPWxbcl0pLmldPW8ueChuKTtyZXR1cm4gcy5qb2luKCIiKX19ZnVuY3Rpb24gZHUobix0KXtmb3IodmFyIGUscj1Hby5pbnRlcnBvbGF0b3JzLmxlbmd0aDstLXI+PTAmJiEoZT1Hby5pbnRlcnBvbGF0b3JzW3JdKG4sdCkpOyk7cmV0dXJuIGV9ZnVuY3Rpb24gbXUobix0KXt2YXIgZSxyPVtdLHU9W10saT1uLmxlbmd0aCxvPXQubGVuZ3RoLGE9TWF0aC5taW4obi5sZW5ndGgsdC5sZW5ndGgpO2ZvcihlPTA7YT5lOysrZSlyLnB1c2goZHUobltlXSx0W2VdKSk7Zm9yKDtpPmU7KytlKXVbZV09bltlXTtmb3IoO28+ZTsrK2UpdVtlXT10W2VdO3JldHVybiBmdW5jdGlvbihuKXtmb3IoZT0wO2E+ZTsrK2UpdVtlXT1yW2VdKG4pO3JldHVybiB1fX1mdW5jdGlvbiB5dShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDA+PXQ/MDp0Pj0xPzE6bih0KX19ZnVuY3Rpb24geHUobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiAxLW4oMS10KX19ZnVuY3Rpb24gTXUobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybi41KiguNT50P24oMip0KToyLW4oMi0yKnQpKX19ZnVuY3Rpb24gX3Uobil7cmV0dXJuIG4qbn1mdW5jdGlvbiBidShuKXtyZXR1cm4gbipuKm59ZnVuY3Rpb24gd3Uobil7aWYoMD49bilyZXR1cm4gMDtpZihuPj0xKXJldHVybiAxO3ZhciB0PW4qbixlPXQqbjtyZXR1cm4gNCooLjU+bj9lOjMqKG4tdCkrZS0uNzUpfWZ1bmN0aW9uIFN1KG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5wb3codCxuKX19ZnVuY3Rpb24ga3Uobil7cmV0dXJuIDEtTWF0aC5jb3MobipMYSl9ZnVuY3Rpb24gRXUobil7cmV0dXJuIE1hdGgucG93KDIsMTAqKG4tMSkpfWZ1bmN0aW9uIE51KG4pe3JldHVybiAxLU1hdGguc3FydCgxLW4qbil9ZnVuY3Rpb24gQXUobix0KXt2YXIgZTtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyJiYodD0uNDUpLGFyZ3VtZW50cy5sZW5ndGg/ZT10L0NhKk1hdGguYXNpbigxL24pOihuPTEsZT10LzQpLGZ1bmN0aW9uKHIpe3JldHVybiAxK24qTWF0aC5wb3coMiwtMTAqcikqTWF0aC5zaW4oKHItZSkqQ2EvdCl9fWZ1bmN0aW9uIEN1KG4pe3JldHVybiBufHwobj0xLjcwMTU4KSxmdW5jdGlvbih0KXtyZXR1cm4gdCp0KigobisxKSp0LW4pfX1mdW5jdGlvbiBMdShuKXtyZXR1cm4gMS8yLjc1Pm4/Ny41NjI1Km4qbjoyLzIuNzU+bj83LjU2MjUqKG4tPTEuNS8yLjc1KSpuKy43NToyLjUvMi43NT5uPzcuNTYyNSoobi09Mi4yNS8yLjc1KSpuKy45Mzc1OjcuNTYyNSoobi09Mi42MjUvMi43NSkqbisuOTg0Mzc1fWZ1bmN0aW9uIFR1KG4sdCl7bj1Hby5oY2wobiksdD1Hby5oY2wodCk7dmFyIGU9bi5oLHI9bi5jLHU9bi5sLGk9dC5oLWUsbz10LmMtcixhPXQubC11O3JldHVybiBpc05hTihvKSYmKG89MCxyPWlzTmFOKHIpP3QuYzpyKSxpc05hTihpKT8oaT0wLGU9aXNOYU4oZSk/dC5oOmUpOmk+MTgwP2ktPTM2MDotMTgwPmkmJihpKz0zNjApLGZ1bmN0aW9uKG4pe3JldHVybiBjdChlK2kqbixyK28qbix1K2EqbikrIiJ9fWZ1bmN0aW9uIHF1KG4sdCl7bj1Hby5oc2wobiksdD1Hby5oc2wodCk7dmFyIGU9bi5oLHI9bi5zLHU9bi5sLGk9dC5oLWUsbz10LnMtcixhPXQubC11O3JldHVybiBpc05hTihvKSYmKG89MCxyPWlzTmFOKHIpP3QuczpyKSxpc05hTihpKT8oaT0wLGU9aXNOYU4oZSk/dC5oOmUpOmk+MTgwP2ktPTM2MDotMTgwPmkmJihpKz0zNjApLGZ1bmN0aW9uKG4pe3JldHVybiBpdChlK2kqbixyK28qbix1K2EqbikrIiJ9fWZ1bmN0aW9uIHp1KG4sdCl7bj1Hby5sYWIobiksdD1Hby5sYWIodCk7dmFyIGU9bi5sLHI9bi5hLHU9bi5iLGk9dC5sLWUsbz10LmEtcixhPXQuYi11O3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gZnQoZStpKm4scitvKm4sdSthKm4pKyIifX1mdW5jdGlvbiBSdShuLHQpe3JldHVybiB0LT1uLGZ1bmN0aW9uKGUpe3JldHVybiBNYXRoLnJvdW5kKG4rdCplKX19ZnVuY3Rpb24gRHUobil7dmFyIHQ9W24uYSxuLmJdLGU9W24uYyxuLmRdLHI9VXUodCksdT1QdSh0LGUpLGk9VXUoanUoZSx0LC11KSl8fDA7dFswXSplWzFdPGVbMF0qdFsxXSYmKHRbMF0qPS0xLHRbMV0qPS0xLHIqPS0xLHUqPS0xKSx0aGlzLnJvdGF0ZT0ocj9NYXRoLmF0YW4yKHRbMV0sdFswXSk6TWF0aC5hdGFuMigtZVswXSxlWzFdKSkqUmEsdGhpcy50cmFuc2xhdGU9W24uZSxuLmZdLHRoaXMuc2NhbGU9W3IsaV0sdGhpcy5za2V3PWk/TWF0aC5hdGFuMih1LGkpKlJhOjB9ZnVuY3Rpb24gUHUobix0KXtyZXR1cm4gblswXSp0WzBdK25bMV0qdFsxXX1mdW5jdGlvbiBVdShuKXt2YXIgdD1NYXRoLnNxcnQoUHUobixuKSk7cmV0dXJuIHQmJihuWzBdLz10LG5bMV0vPXQpLHR9ZnVuY3Rpb24ganUobix0LGUpe3JldHVybiBuWzBdKz1lKnRbMF0sblsxXSs9ZSp0WzFdLG59ZnVuY3Rpb24gSHUobix0KXt2YXIgZSxyPVtdLHU9W10saT1Hby50cmFuc2Zvcm0obiksbz1Hby50cmFuc2Zvcm0odCksYT1pLnRyYW5zbGF0ZSxjPW8udHJhbnNsYXRlLHM9aS5yb3RhdGUsbD1vLnJvdGF0ZSxmPWkuc2tldyxoPW8uc2tldyxnPWkuc2NhbGUscD1vLnNjYWxlO3JldHVybiBhWzBdIT1jWzBdfHxhWzFdIT1jWzFdPyhyLnB1c2goInRyYW5zbGF0ZSgiLG51bGwsIiwiLG51bGwsIikiKSx1LnB1c2goe2k6MSx4OnB1KGFbMF0sY1swXSl9LHtpOjMseDpwdShhWzFdLGNbMV0pfSkpOmNbMF18fGNbMV0/ci5wdXNoKCJ0cmFuc2xhdGUoIitjKyIpIik6ci5wdXNoKCIiKSxzIT1sPyhzLWw+MTgwP2wrPTM2MDpsLXM+MTgwJiYocys9MzYwKSx1LnB1c2goe2k6ci5wdXNoKHIucG9wKCkrInJvdGF0ZSgiLG51bGwsIikiKS0yLHg6cHUocyxsKX0pKTpsJiZyLnB1c2goci5wb3AoKSsicm90YXRlKCIrbCsiKSIpLGYhPWg/dS5wdXNoKHtpOnIucHVzaChyLnBvcCgpKyJza2V3WCgiLG51bGwsIikiKS0yLHg6cHUoZixoKX0pOmgmJnIucHVzaChyLnBvcCgpKyJza2V3WCgiK2grIikiKSxnWzBdIT1wWzBdfHxnWzFdIT1wWzFdPyhlPXIucHVzaChyLnBvcCgpKyJzY2FsZSgiLG51bGwsIiwiLG51bGwsIikiKSx1LnB1c2goe2k6ZS00LHg6cHUoZ1swXSxwWzBdKX0se2k6ZS0yLHg6cHUoZ1sxXSxwWzFdKX0pKTooMSE9cFswXXx8MSE9cFsxXSkmJnIucHVzaChyLnBvcCgpKyJzY2FsZSgiK3ArIikiKSxlPXUubGVuZ3RoLGZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxpPS0xOysraTxlOylyWyh0PXVbaV0pLmldPXQueChuKTtyZXR1cm4gci5qb2luKCIiKX19ZnVuY3Rpb24gRnUobix0KXtyZXR1cm4gdD10LShuPStuKT8xLyh0LW4pOjAsZnVuY3Rpb24oZSl7cmV0dXJuKGUtbikqdH19ZnVuY3Rpb24gT3Uobix0KXtyZXR1cm4gdD10LShuPStuKT8xLyh0LW4pOjAsZnVuY3Rpb24oZSl7cmV0dXJuIE1hdGgubWF4KDAsTWF0aC5taW4oMSwoZS1uKSp0KSl9fWZ1bmN0aW9uIFl1KG4pe2Zvcih2YXIgdD1uLnNvdXJjZSxlPW4udGFyZ2V0LHI9WnUodCxlKSx1PVt0XTt0IT09cjspdD10LnBhcmVudCx1LnB1c2godCk7Zm9yKHZhciBpPXUubGVuZ3RoO2UhPT1yOyl1LnNwbGljZShpLDAsZSksZT1lLnBhcmVudDtyZXR1cm4gdX1mdW5jdGlvbiBJdShuKXtmb3IodmFyIHQ9W10sZT1uLnBhcmVudDtudWxsIT1lOyl0LnB1c2gobiksbj1lLGU9ZS5wYXJlbnQ7cmV0dXJuIHQucHVzaChuKSx0fWZ1bmN0aW9uIFp1KG4sdCl7aWYobj09PXQpcmV0dXJuIG47Zm9yKHZhciBlPUl1KG4pLHI9SXUodCksdT1lLnBvcCgpLGk9ci5wb3AoKSxvPW51bGw7dT09PWk7KW89dSx1PWUucG9wKCksaT1yLnBvcCgpO3JldHVybiBvfWZ1bmN0aW9uIFZ1KG4pe24uZml4ZWR8PTJ9ZnVuY3Rpb24gJHUobil7bi5maXhlZCY9LTd9ZnVuY3Rpb24gWHUobil7bi5maXhlZHw9NCxuLnB4PW4ueCxuLnB5PW4ueX1mdW5jdGlvbiBCdShuKXtuLmZpeGVkJj0tNX1mdW5jdGlvbiBKdShuLHQsZSl7dmFyIHI9MCx1PTA7aWYobi5jaGFyZ2U9MCwhbi5sZWFmKWZvcih2YXIgaSxvPW4ubm9kZXMsYT1vLmxlbmd0aCxjPS0xOysrYzxhOylpPW9bY10sbnVsbCE9aSYmKEp1KGksdCxlKSxuLmNoYXJnZSs9aS5jaGFyZ2Uscis9aS5jaGFyZ2UqaS5jeCx1Kz1pLmNoYXJnZSppLmN5KTtpZihuLnBvaW50KXtuLmxlYWZ8fChuLnBvaW50LngrPU1hdGgucmFuZG9tKCktLjUsbi5wb2ludC55Kz1NYXRoLnJhbmRvbSgpLS41KTt2YXIgcz10KmVbbi5wb2ludC5pbmRleF07bi5jaGFyZ2UrPW4ucG9pbnRDaGFyZ2U9cyxyKz1zKm4ucG9pbnQueCx1Kz1zKm4ucG9pbnQueX1uLmN4PXIvbi5jaGFyZ2Usbi5jeT11L24uY2hhcmdlfWZ1bmN0aW9uIFd1KG4sdCl7cmV0dXJuIEdvLnJlYmluZChuLHQsInNvcnQiLCJjaGlsZHJlbiIsInZhbHVlIiksbi5ub2Rlcz1uLG4ubGlua3M9bmksbn1mdW5jdGlvbiBHdShuKXtyZXR1cm4gbi5jaGlsZHJlbn1mdW5jdGlvbiBLdShuKXtyZXR1cm4gbi52YWx1ZX1mdW5jdGlvbiBRdShuLHQpe3JldHVybiB0LnZhbHVlLW4udmFsdWV9ZnVuY3Rpb24gbmkobil7cmV0dXJuIEdvLm1lcmdlKG4ubWFwKGZ1bmN0aW9uKG4pe3JldHVybihuLmNoaWxkcmVufHxbXSkubWFwKGZ1bmN0aW9uKHQpe3JldHVybntzb3VyY2U6bix0YXJnZXQ6dH19KX0pKX1mdW5jdGlvbiB0aShuKXtyZXR1cm4gbi54fWZ1bmN0aW9uIGVpKG4pe3JldHVybiBuLnl9ZnVuY3Rpb24gcmkobix0LGUpe24ueTA9dCxuLnk9ZX1mdW5jdGlvbiB1aShuKXtyZXR1cm4gR28ucmFuZ2Uobi5sZW5ndGgpfWZ1bmN0aW9uIGlpKG4pe2Zvcih2YXIgdD0tMSxlPW5bMF0ubGVuZ3RoLHI9W107Kyt0PGU7KXJbdF09MDtyZXR1cm4gcn1mdW5jdGlvbiBvaShuKXtmb3IodmFyIHQsZT0xLHI9MCx1PW5bMF1bMV0saT1uLmxlbmd0aDtpPmU7KytlKSh0PW5bZV1bMV0pPnUmJihyPWUsdT10KTtyZXR1cm4gcn1mdW5jdGlvbiBhaShuKXtyZXR1cm4gbi5yZWR1Y2UoY2ksMCl9ZnVuY3Rpb24gY2kobix0KXtyZXR1cm4gbit0WzFdfWZ1bmN0aW9uIHNpKG4sdCl7cmV0dXJuIGxpKG4sTWF0aC5jZWlsKE1hdGgubG9nKHQubGVuZ3RoKS9NYXRoLkxOMisxKSl9ZnVuY3Rpb24gbGkobix0KXtmb3IodmFyIGU9LTEscj0rblswXSx1PShuWzFdLXIpL3QsaT1bXTsrK2U8PXQ7KWlbZV09dSplK3I7cmV0dXJuIGl9ZnVuY3Rpb24gZmkobil7cmV0dXJuW0dvLm1pbihuKSxHby5tYXgobildfWZ1bmN0aW9uIGhpKG4sdCl7cmV0dXJuIG4ucGFyZW50PT10LnBhcmVudD8xOjJ9ZnVuY3Rpb24gZ2kobil7dmFyIHQ9bi5jaGlsZHJlbjtyZXR1cm4gdCYmdC5sZW5ndGg/dFswXTpuLl90cmVlLnRocmVhZH1mdW5jdGlvbiBwaShuKXt2YXIgdCxlPW4uY2hpbGRyZW47cmV0dXJuIGUmJih0PWUubGVuZ3RoKT9lW3QtMV06bi5fdHJlZS50aHJlYWR9ZnVuY3Rpb24gdmkobix0KXt2YXIgZT1uLmNoaWxkcmVuO2lmKGUmJih1PWUubGVuZ3RoKSlmb3IodmFyIHIsdSxpPS0xOysraTx1Oyl0KHI9dmkoZVtpXSx0KSxuKT4wJiYobj1yKTtyZXR1cm4gbn1mdW5jdGlvbiBkaShuLHQpe3JldHVybiBuLngtdC54fWZ1bmN0aW9uIG1pKG4sdCl7cmV0dXJuIHQueC1uLnh9ZnVuY3Rpb24geWkobix0KXtyZXR1cm4gbi5kZXB0aC10LmRlcHRofWZ1bmN0aW9uIHhpKG4sdCl7ZnVuY3Rpb24gZShuLHIpe3ZhciB1PW4uY2hpbGRyZW47aWYodSYmKG89dS5sZW5ndGgpKWZvcih2YXIgaSxvLGE9bnVsbCxjPS0xOysrYzxvOylpPXVbY10sZShpLGEpLGE9aTt0KG4scil9ZShuLG51bGwpfWZ1bmN0aW9uIE1pKG4pe2Zvcih2YXIgdCxlPTAscj0wLHU9bi5jaGlsZHJlbixpPXUubGVuZ3RoOy0taT49MDspdD11W2ldLl90cmVlLHQucHJlbGltKz1lLHQubW9kKz1lLGUrPXQuc2hpZnQrKHIrPXQuY2hhbmdlKX1mdW5jdGlvbiBfaShuLHQsZSl7bj1uLl90cmVlLHQ9dC5fdHJlZTt2YXIgcj1lLyh0Lm51bWJlci1uLm51bWJlcik7bi5jaGFuZ2UrPXIsdC5jaGFuZ2UtPXIsdC5zaGlmdCs9ZSx0LnByZWxpbSs9ZSx0Lm1vZCs9ZX1mdW5jdGlvbiBiaShuLHQsZSl7cmV0dXJuIG4uX3RyZWUuYW5jZXN0b3IucGFyZW50PT10LnBhcmVudD9uLl90cmVlLmFuY2VzdG9yOmV9ZnVuY3Rpb24gd2kobix0KXtyZXR1cm4gbi52YWx1ZS10LnZhbHVlfWZ1bmN0aW9uIFNpKG4sdCl7dmFyIGU9bi5fcGFja19uZXh0O24uX3BhY2tfbmV4dD10LHQuX3BhY2tfcHJldj1uLHQuX3BhY2tfbmV4dD1lLGUuX3BhY2tfcHJldj10fWZ1bmN0aW9uIGtpKG4sdCl7bi5fcGFja19uZXh0PXQsdC5fcGFja19wcmV2PW59ZnVuY3Rpb24gRWkobix0KXt2YXIgZT10Lngtbi54LHI9dC55LW4ueSx1PW4ucit0LnI7cmV0dXJuLjk5OSp1KnU+ZSplK3Iqcn1mdW5jdGlvbiBOaShuKXtmdW5jdGlvbiB0KG4pe2w9TWF0aC5taW4obi54LW4ucixsKSxmPU1hdGgubWF4KG4ueCtuLnIsZiksaD1NYXRoLm1pbihuLnktbi5yLGgpLGc9TWF0aC5tYXgobi55K24ucixnKX1pZigoZT1uLmNoaWxkcmVuKSYmKHM9ZS5sZW5ndGgpKXt2YXIgZSxyLHUsaSxvLGEsYyxzLGw9MS8wLGY9LTEvMCxoPTEvMCxnPS0xLzA7aWYoZS5mb3JFYWNoKEFpKSxyPWVbMF0sci54PS1yLnIsci55PTAsdChyKSxzPjEmJih1PWVbMV0sdS54PXUucix1Lnk9MCx0KHUpLHM+MikpZm9yKGk9ZVsyXSxUaShyLHUsaSksdChpKSxTaShyLGkpLHIuX3BhY2tfcHJldj1pLFNpKGksdSksdT1yLl9wYWNrX25leHQsbz0zO3M+bztvKyspe1RpKHIsdSxpPWVbb10pO3ZhciBwPTAsdj0xLGQ9MTtmb3IoYT11Ll9wYWNrX25leHQ7YSE9PXU7YT1hLl9wYWNrX25leHQsdisrKWlmKEVpKGEsaSkpe3A9MTticmVha31pZigxPT1wKWZvcihjPXIuX3BhY2tfcHJldjtjIT09YS5fcGFja19wcmV2JiYhRWkoYyxpKTtjPWMuX3BhY2tfcHJldixkKyspO3A/KGQ+dnx8dj09ZCYmdS5yPHIucj9raShyLHU9YSk6a2kocj1jLHUpLG8tLSk6KFNpKHIsaSksdT1pLHQoaSkpfXZhciBtPShsK2YpLzIseT0oaCtnKS8yLHg9MDtmb3Iobz0wO3M+bztvKyspaT1lW29dLGkueC09bSxpLnktPXkseD1NYXRoLm1heCh4LGkucitNYXRoLnNxcnQoaS54KmkueCtpLnkqaS55KSk7bi5yPXgsZS5mb3JFYWNoKENpKX19ZnVuY3Rpb24gQWkobil7bi5fcGFja19uZXh0PW4uX3BhY2tfcHJldj1ufWZ1bmN0aW9uIENpKG4pe2RlbGV0ZSBuLl9wYWNrX25leHQsZGVsZXRlIG4uX3BhY2tfcHJldn1mdW5jdGlvbiBMaShuLHQsZSxyKXt2YXIgdT1uLmNoaWxkcmVuO2lmKG4ueD10Kz1yKm4ueCxuLnk9ZSs9cipuLnksbi5yKj1yLHUpZm9yKHZhciBpPS0xLG89dS5sZW5ndGg7KytpPG87KUxpKHVbaV0sdCxlLHIpfWZ1bmN0aW9uIFRpKG4sdCxlKXt2YXIgcj1uLnIrZS5yLHU9dC54LW4ueCxpPXQueS1uLnk7aWYociYmKHV8fGkpKXt2YXIgbz10LnIrZS5yLGE9dSp1K2kqaTtvKj1vLHIqPXI7dmFyIGM9LjUrKHItbykvKDIqYSkscz1NYXRoLnNxcnQoTWF0aC5tYXgoMCwyKm8qKHIrYSktKHItPWEpKnItbypvKSkvKDIqYSk7ZS54PW4ueCtjKnUrcyppLGUueT1uLnkrYyppLXMqdX1lbHNlIGUueD1uLngrcixlLnk9bi55fWZ1bmN0aW9uIHFpKG4pe3JldHVybiAxK0dvLm1heChuLGZ1bmN0aW9uKG4pe3JldHVybiBuLnl9KX1mdW5jdGlvbiB6aShuKXtyZXR1cm4gbi5yZWR1Y2UoZnVuY3Rpb24obix0KXtyZXR1cm4gbit0Lnh9LDApL24ubGVuZ3RofWZ1bmN0aW9uIFJpKG4pe3ZhciB0PW4uY2hpbGRyZW47cmV0dXJuIHQmJnQubGVuZ3RoP1JpKHRbMF0pOm59ZnVuY3Rpb24gRGkobil7dmFyIHQsZT1uLmNoaWxkcmVuO3JldHVybiBlJiYodD1lLmxlbmd0aCk/RGkoZVt0LTFdKTpufWZ1bmN0aW9uIFBpKG4pe3JldHVybnt4Om4ueCx5Om4ueSxkeDpuLmR4LGR5Om4uZHl9fWZ1bmN0aW9uIFVpKG4sdCl7dmFyIGU9bi54K3RbM10scj1uLnkrdFswXSx1PW4uZHgtdFsxXS10WzNdLGk9bi5keS10WzBdLXRbMl07cmV0dXJuIDA+dSYmKGUrPXUvMix1PTApLDA+aSYmKHIrPWkvMixpPTApLHt4OmUseTpyLGR4OnUsZHk6aX19ZnVuY3Rpb24gamkobil7dmFyIHQ9blswXSxlPW5bbi5sZW5ndGgtMV07cmV0dXJuIGU+dD9bdCxlXTpbZSx0XX1mdW5jdGlvbiBIaShuKXtyZXR1cm4gbi5yYW5nZUV4dGVudD9uLnJhbmdlRXh0ZW50KCk6amkobi5yYW5nZSgpKX1mdW5jdGlvbiBGaShuLHQsZSxyKXt2YXIgdT1lKG5bMF0sblsxXSksaT1yKHRbMF0sdFsxXSk7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBpKHUobikpfX1mdW5jdGlvbiBPaShuLHQpe3ZhciBlLHI9MCx1PW4ubGVuZ3RoLTEsaT1uW3JdLG89blt1XTtyZXR1cm4gaT5vJiYoZT1yLHI9dSx1PWUsZT1pLGk9byxvPWUpLG5bcl09dC5mbG9vcihpKSxuW3VdPXQuY2VpbChvKSxufWZ1bmN0aW9uIFlpKG4pe3JldHVybiBuP3tmbG9vcjpmdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5mbG9vcih0L24pKm59LGNlaWw6ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGguY2VpbCh0L24pKm59fTpwc31mdW5jdGlvbiBJaShuLHQsZSxyKXt2YXIgdT1bXSxpPVtdLG89MCxhPU1hdGgubWluKG4ubGVuZ3RoLHQubGVuZ3RoKS0xO2ZvcihuW2FdPG5bMF0mJihuPW4uc2xpY2UoKS5yZXZlcnNlKCksdD10LnNsaWNlKCkucmV2ZXJzZSgpKTsrK288PWE7KXUucHVzaChlKG5bby0xXSxuW29dKSksaS5wdXNoKHIodFtvLTFdLHRbb10pKTtyZXR1cm4gZnVuY3Rpb24odCl7dmFyIGU9R28uYmlzZWN0KG4sdCwxLGEpLTE7cmV0dXJuIGlbZV0odVtlXSh0KSl9fWZ1bmN0aW9uIFppKG4sdCxlLHIpe2Z1bmN0aW9uIHUoKXt2YXIgdT1NYXRoLm1pbihuLmxlbmd0aCx0Lmxlbmd0aCk+Mj9JaTpGaSxjPXI/T3U6RnU7cmV0dXJuIG89dShuLHQsYyxlKSxhPXUodCxuLGMsZHUpLGl9ZnVuY3Rpb24gaShuKXtyZXR1cm4gbyhuKX12YXIgbyxhO3JldHVybiBpLmludmVydD1mdW5jdGlvbihuKXtyZXR1cm4gYShuKX0saS5kb21haW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG49dC5tYXAoTnVtYmVyKSx1KCkpOm59LGkucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bix1KCkpOnR9LGkucmFuZ2VSb3VuZD1mdW5jdGlvbihuKXtyZXR1cm4gaS5yYW5nZShuKS5pbnRlcnBvbGF0ZShSdSl9LGkuY2xhbXA9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9bix1KCkpOnJ9LGkuaW50ZXJwb2xhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix1KCkpOmV9LGkudGlja3M9ZnVuY3Rpb24odCl7cmV0dXJuIEJpKG4sdCl9LGkudGlja0Zvcm1hdD1mdW5jdGlvbih0LGUpe3JldHVybiBKaShuLHQsZSl9LGkubmljZT1mdW5jdGlvbih0KXtyZXR1cm4gJGkobix0KSx1KCl9LGkuY29weT1mdW5jdGlvbigpe3JldHVybiBaaShuLHQsZSxyKX0sdSgpfWZ1bmN0aW9uIFZpKG4sdCl7cmV0dXJuIEdvLnJlYmluZChuLHQsInJhbmdlIiwicmFuZ2VSb3VuZCIsImludGVycG9sYXRlIiwiY2xhbXAiKX1mdW5jdGlvbiAkaShuLHQpe3JldHVybiBPaShuLFlpKFhpKG4sdClbMl0pKX1mdW5jdGlvbiBYaShuLHQpe251bGw9PXQmJih0PTEwKTt2YXIgZT1qaShuKSxyPWVbMV0tZVswXSx1PU1hdGgucG93KDEwLE1hdGguZmxvb3IoTWF0aC5sb2coci90KS9NYXRoLkxOMTApKSxpPXQvcip1O3JldHVybi4xNT49aT91Kj0xMDouMzU+PWk/dSo9NTouNzU+PWkmJih1Kj0yKSxlWzBdPU1hdGguY2VpbChlWzBdL3UpKnUsZVsxXT1NYXRoLmZsb29yKGVbMV0vdSkqdSsuNSp1LGVbMl09dSxlfWZ1bmN0aW9uIEJpKG4sdCl7cmV0dXJuIEdvLnJhbmdlLmFwcGx5KEdvLFhpKG4sdCkpfWZ1bmN0aW9uIEppKG4sdCxlKXt2YXIgcj1YaShuLHQpO2lmKGUpe3ZhciB1PXJjLmV4ZWMoZSk7aWYodS5zaGlmdCgpLCJzIj09PXVbOF0pe3ZhciBpPUdvLmZvcm1hdFByZWZpeChNYXRoLm1heChmYShyWzBdKSxmYShyWzFdKSkpO3JldHVybiB1WzddfHwodVs3XT0iLiIrV2koaS5zY2FsZShyWzJdKSkpLHVbOF09ImYiLGU9R28uZm9ybWF0KHUuam9pbigiIikpLGZ1bmN0aW9uKG4pe3JldHVybiBlKGkuc2NhbGUobikpK2kuc3ltYm9sfX11WzddfHwodVs3XT0iLiIrR2kodVs4XSxyKSksZT11LmpvaW4oIiIpfWVsc2UgZT0iLC4iK1dpKHJbMl0pKyJmIjtyZXR1cm4gR28uZm9ybWF0KGUpfWZ1bmN0aW9uIFdpKG4pe3JldHVybi1NYXRoLmZsb29yKE1hdGgubG9nKG4pL01hdGguTE4xMCsuMDEpfWZ1bmN0aW9uIEdpKG4sdCl7dmFyIGU9V2kodFsyXSk7cmV0dXJuIG4gaW4gdnM/TWF0aC5hYnMoZS1XaShNYXRoLm1heChmYSh0WzBdKSxmYSh0WzFdKSkpKSsgKygiZSIhPT1uKTplLTIqKCIlIj09PW4pfWZ1bmN0aW9uIEtpKG4sdCxlLHIpe2Z1bmN0aW9uIHUobil7cmV0dXJuKGU/TWF0aC5sb2coMD5uPzA6bik6LU1hdGgubG9nKG4+MD8wOi1uKSkvTWF0aC5sb2codCl9ZnVuY3Rpb24gaShuKXtyZXR1cm4gZT9NYXRoLnBvdyh0LG4pOi1NYXRoLnBvdyh0LC1uKX1mdW5jdGlvbiBvKHQpe3JldHVybiBuKHUodCkpfXJldHVybiBvLmludmVydD1mdW5jdGlvbih0KXtyZXR1cm4gaShuLmludmVydCh0KSl9LG8uZG9tYWluPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXRbMF0+PTAsbi5kb21haW4oKHI9dC5tYXAoTnVtYmVyKSkubWFwKHUpKSxvKTpyfSxvLmJhc2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9K2Usbi5kb21haW4oci5tYXAodSkpLG8pOnR9LG8ubmljZT1mdW5jdGlvbigpe3ZhciB0PU9pKHIubWFwKHUpLGU/TWF0aDptcyk7cmV0dXJuIG4uZG9tYWluKHQpLHI9dC5tYXAoaSksb30sby50aWNrcz1mdW5jdGlvbigpe3ZhciBuPWppKHIpLG89W10sYT1uWzBdLGM9blsxXSxzPU1hdGguZmxvb3IodShhKSksbD1NYXRoLmNlaWwodShjKSksZj10JTE/Mjp0O2lmKGlzRmluaXRlKGwtcykpe2lmKGUpe2Zvcig7bD5zO3MrKylmb3IodmFyIGg9MTtmPmg7aCsrKW8ucHVzaChpKHMpKmgpO28ucHVzaChpKHMpKX1lbHNlIGZvcihvLnB1c2goaShzKSk7cysrPGw7KWZvcih2YXIgaD1mLTE7aD4wO2gtLSlvLnB1c2goaShzKSpoKTtmb3Iocz0wO29bc108YTtzKyspO2ZvcihsPW8ubGVuZ3RoO29bbC0xXT5jO2wtLSk7bz1vLnNsaWNlKHMsbCl9cmV0dXJuIG99LG8udGlja0Zvcm1hdD1mdW5jdGlvbihuLHQpe2lmKCFhcmd1bWVudHMubGVuZ3RoKXJldHVybiBkczthcmd1bWVudHMubGVuZ3RoPDI/dD1kczoiZnVuY3Rpb24iIT10eXBlb2YgdCYmKHQ9R28uZm9ybWF0KHQpKTt2YXIgcixhPU1hdGgubWF4KC4xLG4vby50aWNrcygpLmxlbmd0aCksYz1lPyhyPTFlLTEyLE1hdGguY2VpbCk6KHI9LTFlLTEyLE1hdGguZmxvb3IpO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gbi9pKGModShuKStyKSk8PWE/dChuKToiIn19LG8uY29weT1mdW5jdGlvbigpe3JldHVybiBLaShuLmNvcHkoKSx0LGUscil9LFZpKG8sbil9ZnVuY3Rpb24gUWkobix0LGUpe2Z1bmN0aW9uIHIodCl7cmV0dXJuIG4odSh0KSl9dmFyIHU9bm8odCksaT1ubygxL3QpO3JldHVybiByLmludmVydD1mdW5jdGlvbih0KXtyZXR1cm4gaShuLmludmVydCh0KSl9LHIuZG9tYWluPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuLmRvbWFpbigoZT10Lm1hcChOdW1iZXIpKS5tYXAodSkpLHIpOmV9LHIudGlja3M9ZnVuY3Rpb24obil7cmV0dXJuIEJpKGUsbil9LHIudGlja0Zvcm1hdD1mdW5jdGlvbihuLHQpe3JldHVybiBKaShlLG4sdCl9LHIubmljZT1mdW5jdGlvbihuKXtyZXR1cm4gci5kb21haW4oJGkoZSxuKSl9LHIuZXhwb25lbnQ9ZnVuY3Rpb24obyl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bm8odD1vKSxpPW5vKDEvdCksbi5kb21haW4oZS5tYXAodSkpLHIpOnR9LHIuY29weT1mdW5jdGlvbigpe3JldHVybiBRaShuLmNvcHkoKSx0LGUpfSxWaShyLG4pfWZ1bmN0aW9uIG5vKG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gMD50Py1NYXRoLnBvdygtdCxuKTpNYXRoLnBvdyh0LG4pfX1mdW5jdGlvbiB0byhuLHQpe2Z1bmN0aW9uIGUoZSl7cmV0dXJuIGlbKCh1LmdldChlKXx8KCJyYW5nZSI9PT10LnQ/dS5zZXQoZSxuLnB1c2goZSkpOjAvMCkpLTEpJWkubGVuZ3RoXX1mdW5jdGlvbiByKHQsZSl7cmV0dXJuIEdvLnJhbmdlKG4ubGVuZ3RoKS5tYXAoZnVuY3Rpb24obil7cmV0dXJuIHQrZSpufSl9dmFyIHUsaSxhO3JldHVybiBlLmRvbWFpbj1mdW5jdGlvbihyKXtpZighYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gbjtuPVtdLHU9bmV3IG87Zm9yKHZhciBpLGE9LTEsYz1yLmxlbmd0aDsrK2E8YzspdS5oYXMoaT1yW2FdKXx8dS5zZXQoaSxuLnB1c2goaSkpO3JldHVybiBlW3QudF0uYXBwbHkoZSx0LmEpfSxlLnJhbmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPW4sYT0wLHQ9e3Q6InJhbmdlIixhOmFyZ3VtZW50c30sZSk6aX0sZS5yYW5nZVBvaW50cz1mdW5jdGlvbih1LG8pe2FyZ3VtZW50cy5sZW5ndGg8MiYmKG89MCk7dmFyIGM9dVswXSxzPXVbMV0sbD0ocy1jKS8oTWF0aC5tYXgoMSxuLmxlbmd0aC0xKStvKTtyZXR1cm4gaT1yKG4ubGVuZ3RoPDI/KGMrcykvMjpjK2wqby8yLGwpLGE9MCx0PXt0OiJyYW5nZVBvaW50cyIsYTphcmd1bWVudHN9LGV9LGUucmFuZ2VCYW5kcz1mdW5jdGlvbih1LG8sYyl7YXJndW1lbnRzLmxlbmd0aDwyJiYobz0wKSxhcmd1bWVudHMubGVuZ3RoPDMmJihjPW8pO3ZhciBzPXVbMV08dVswXSxsPXVbcy0wXSxmPXVbMS1zXSxoPShmLWwpLyhuLmxlbmd0aC1vKzIqYyk7cmV0dXJuIGk9cihsK2gqYyxoKSxzJiZpLnJldmVyc2UoKSxhPWgqKDEtbyksdD17dDoicmFuZ2VCYW5kcyIsYTphcmd1bWVudHN9LGV9LGUucmFuZ2VSb3VuZEJhbmRzPWZ1bmN0aW9uKHUsbyxjKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApLGFyZ3VtZW50cy5sZW5ndGg8MyYmKGM9byk7dmFyIHM9dVsxXTx1WzBdLGw9dVtzLTBdLGY9dVsxLXNdLGg9TWF0aC5mbG9vcigoZi1sKS8obi5sZW5ndGgtbysyKmMpKSxnPWYtbC0obi5sZW5ndGgtbykqaDtyZXR1cm4gaT1yKGwrTWF0aC5yb3VuZChnLzIpLGgpLHMmJmkucmV2ZXJzZSgpLGE9TWF0aC5yb3VuZChoKigxLW8pKSx0PXt0OiJyYW5nZVJvdW5kQmFuZHMiLGE6YXJndW1lbnRzfSxlfSxlLnJhbmdlQmFuZD1mdW5jdGlvbigpe3JldHVybiBhfSxlLnJhbmdlRXh0ZW50PWZ1bmN0aW9uKCl7cmV0dXJuIGppKHQuYVswXSl9LGUuY29weT1mdW5jdGlvbigpe3JldHVybiB0byhuLHQpfSxlLmRvbWFpbihuKX1mdW5jdGlvbiBlbyh0LGUpe2Z1bmN0aW9uIHIoKXt2YXIgbj0wLHI9ZS5sZW5ndGg7Zm9yKGk9W107KytuPHI7KWlbbi0xXT1Hby5xdWFudGlsZSh0LG4vcik7cmV0dXJuIHV9ZnVuY3Rpb24gdShuKXtyZXR1cm4gaXNOYU4obj0rbik/dm9pZCAwOmVbR28uYmlzZWN0KGksbildfXZhciBpO3JldHVybiB1LmRvbWFpbj1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1lLmZpbHRlcihmdW5jdGlvbihuKXtyZXR1cm4haXNOYU4obil9KS5zb3J0KG4pLHIoKSk6dH0sdS5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHIoKSk6ZX0sdS5xdWFudGlsZXM9ZnVuY3Rpb24oKXtyZXR1cm4gaX0sdS5pbnZlcnRFeHRlbnQ9ZnVuY3Rpb24obil7cmV0dXJuIG49ZS5pbmRleE9mKG4pLDA+bj9bMC8wLDAvMF06W24+MD9pW24tMV06dFswXSxuPGkubGVuZ3RoP2lbbl06dFt0Lmxlbmd0aC0xXV19LHUuY29weT1mdW5jdGlvbigpe3JldHVybiBlbyh0LGUpfSxyKCl9ZnVuY3Rpb24gcm8obix0LGUpe2Z1bmN0aW9uIHIodCl7cmV0dXJuIGVbTWF0aC5tYXgoMCxNYXRoLm1pbihvLE1hdGguZmxvb3IoaSoodC1uKSkpKV19ZnVuY3Rpb24gdSgpe3JldHVybiBpPWUubGVuZ3RoLyh0LW4pLG89ZS5sZW5ndGgtMSxyfXZhciBpLG87cmV0dXJuIHIuZG9tYWluPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuPStlWzBdLHQ9K2VbZS5sZW5ndGgtMV0sdSgpKTpbbix0XX0sci5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHUoKSk6ZX0sci5pbnZlcnRFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHQ9ZS5pbmRleE9mKHQpLHQ9MD50PzAvMDp0L2krbixbdCx0KzEvaV19LHIuY29weT1mdW5jdGlvbigpe3JldHVybiBybyhuLHQsZSl9LHUoKX1mdW5jdGlvbiB1byhuLHQpe2Z1bmN0aW9uIGUoZSl7cmV0dXJuIGU+PWU/dFtHby5iaXNlY3QobixlKV06dm9pZCAwfXJldHVybiBlLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj10LGUpOm59LGUucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bixlKTp0fSxlLmludmVydEV4dGVudD1mdW5jdGlvbihlKXtyZXR1cm4gZT10LmluZGV4T2YoZSksW25bZS0xXSxuW2VdXX0sZS5jb3B5PWZ1bmN0aW9uKCl7cmV0dXJuIHVvKG4sdCl9LGV9ZnVuY3Rpb24gaW8obil7ZnVuY3Rpb24gdChuKXtyZXR1cm4rbn1yZXR1cm4gdC5pbnZlcnQ9dCx0LmRvbWFpbj10LnJhbmdlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuPWUubWFwKHQpLHQpOm59LHQudGlja3M9ZnVuY3Rpb24odCl7cmV0dXJuIEJpKG4sdCl9LHQudGlja0Zvcm1hdD1mdW5jdGlvbih0LGUpe3JldHVybiBKaShuLHQsZSl9LHQuY29weT1mdW5jdGlvbigpe3JldHVybiBpbyhuKX0sdH1mdW5jdGlvbiBvbyhuKXtyZXR1cm4gbi5pbm5lclJhZGl1c31mdW5jdGlvbiBhbyhuKXtyZXR1cm4gbi5vdXRlclJhZGl1c31mdW5jdGlvbiBjbyhuKXtyZXR1cm4gbi5zdGFydEFuZ2xlfWZ1bmN0aW9uIHNvKG4pe3JldHVybiBuLmVuZEFuZ2xlfWZ1bmN0aW9uIGxvKG4pe2Z1bmN0aW9uIHQodCl7ZnVuY3Rpb24gbygpe3MucHVzaCgiTSIsaShuKGwpLGEpKX1mb3IodmFyIGMscz1bXSxsPVtdLGY9LTEsaD10Lmxlbmd0aCxnPUV0KGUpLHA9RXQocik7KytmPGg7KXUuY2FsbCh0aGlzLGM9dFtmXSxmKT9sLnB1c2goWytnLmNhbGwodGhpcyxjLGYpLCtwLmNhbGwodGhpcyxjLGYpXSk6bC5sZW5ndGgmJihvKCksbD1bXSk7cmV0dXJuIGwubGVuZ3RoJiZvKCkscy5sZW5ndGg/cy5qb2luKCIiKTpudWxsfXZhciBlPU5yLHI9QXIsdT1OZSxpPWZvLG89aS5rZXksYT0uNztyZXR1cm4gdC54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPW4sdCk6ZX0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC5kZWZpbmVkPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sdCk6dX0sdC5pbnRlcnBvbGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz0iZnVuY3Rpb24iPT10eXBlb2Ygbj9pPW46KGk9U3MuZ2V0KG4pfHxmbykua2V5LHQpOm99LHQudGVuc2lvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1uLHQpOmF9LHR9ZnVuY3Rpb24gZm8obil7cmV0dXJuIG4uam9pbigiTCIpfWZ1bmN0aW9uIGhvKG4pe3JldHVybiBmbyhuKSsiWiJ9ZnVuY3Rpb24gZ28obil7Zm9yKHZhciB0PTAsZT1uLmxlbmd0aCxyPW5bMF0sdT1bclswXSwiLCIsclsxXV07Kyt0PGU7KXUucHVzaCgiSCIsKHJbMF0rKHI9blt0XSlbMF0pLzIsIlYiLHJbMV0pO3JldHVybiBlPjEmJnUucHVzaCgiSCIsclswXSksdS5qb2luKCIiKX1mdW5jdGlvbiBwbyhuKXtmb3IodmFyIHQ9MCxlPW4ubGVuZ3RoLHI9blswXSx1PVtyWzBdLCIsIixyWzFdXTsrK3Q8ZTspdS5wdXNoKCJWIiwocj1uW3RdKVsxXSwiSCIsclswXSk7cmV0dXJuIHUuam9pbigiIil9ZnVuY3Rpb24gdm8obil7Zm9yKHZhciB0PTAsZT1uLmxlbmd0aCxyPW5bMF0sdT1bclswXSwiLCIsclsxXV07Kyt0PGU7KXUucHVzaCgiSCIsKHI9blt0XSlbMF0sIlYiLHJbMV0pO3JldHVybiB1LmpvaW4oIiIpfWZ1bmN0aW9uIG1vKG4sdCl7cmV0dXJuIG4ubGVuZ3RoPDQ/Zm8obik6blsxXStNbyhuLnNsaWNlKDEsbi5sZW5ndGgtMSksX28obix0KSl9ZnVuY3Rpb24geW8obix0KXtyZXR1cm4gbi5sZW5ndGg8Mz9mbyhuKTpuWzBdK01vKChuLnB1c2goblswXSksbiksX28oW25bbi5sZW5ndGgtMl1dLmNvbmNhdChuLFtuWzFdXSksdCkpfWZ1bmN0aW9uIHhvKG4sdCl7cmV0dXJuIG4ubGVuZ3RoPDM/Zm8obik6blswXStNbyhuLF9vKG4sdCkpfWZ1bmN0aW9uIE1vKG4sdCl7aWYodC5sZW5ndGg8MXx8bi5sZW5ndGghPXQubGVuZ3RoJiZuLmxlbmd0aCE9dC5sZW5ndGgrMilyZXR1cm4gZm8obik7dmFyIGU9bi5sZW5ndGghPXQubGVuZ3RoLHI9IiIsdT1uWzBdLGk9blsxXSxvPXRbMF0sYT1vLGM9MTtpZihlJiYocis9IlEiKyhpWzBdLTIqb1swXS8zKSsiLCIrKGlbMV0tMipvWzFdLzMpKyIsIitpWzBdKyIsIitpWzFdLHU9blsxXSxjPTIpLHQubGVuZ3RoPjEpe2E9dFsxXSxpPW5bY10sYysrLHIrPSJDIisodVswXStvWzBdKSsiLCIrKHVbMV0rb1sxXSkrIiwiKyhpWzBdLWFbMF0pKyIsIisoaVsxXS1hWzFdKSsiLCIraVswXSsiLCIraVsxXTtmb3IodmFyIHM9MjtzPHQubGVuZ3RoO3MrKyxjKyspaT1uW2NdLGE9dFtzXSxyKz0iUyIrKGlbMF0tYVswXSkrIiwiKyhpWzFdLWFbMV0pKyIsIitpWzBdKyIsIitpWzFdfWlmKGUpe3ZhciBsPW5bY107cis9IlEiKyhpWzBdKzIqYVswXS8zKSsiLCIrKGlbMV0rMiphWzFdLzMpKyIsIitsWzBdKyIsIitsWzFdfXJldHVybiByfWZ1bmN0aW9uIF9vKG4sdCl7Zm9yKHZhciBlLHI9W10sdT0oMS10KS8yLGk9blswXSxvPW5bMV0sYT0xLGM9bi5sZW5ndGg7KythPGM7KWU9aSxpPW8sbz1uW2FdLHIucHVzaChbdSoob1swXS1lWzBdKSx1KihvWzFdLWVbMV0pXSk7cmV0dXJuIHJ9ZnVuY3Rpb24gYm8obil7aWYobi5sZW5ndGg8MylyZXR1cm4gZm8obik7dmFyIHQ9MSxlPW4ubGVuZ3RoLHI9blswXSx1PXJbMF0saT1yWzFdLG89W3UsdSx1LChyPW5bMV0pWzBdXSxhPVtpLGksaSxyWzFdXSxjPVt1LCIsIixpLCJMIixFbyhOcyxvKSwiLCIsRW8oTnMsYSldO2ZvcihuLnB1c2gobltlLTFdKTsrK3Q8PWU7KXI9blt0XSxvLnNoaWZ0KCksby5wdXNoKHJbMF0pLGEuc2hpZnQoKSxhLnB1c2goclsxXSksTm8oYyxvLGEpO3JldHVybiBuLnBvcCgpLGMucHVzaCgiTCIsciksYy5qb2luKCIiKX1mdW5jdGlvbiB3byhuKXtpZihuLmxlbmd0aDw0KXJldHVybiBmbyhuKTtmb3IodmFyIHQsZT1bXSxyPS0xLHU9bi5sZW5ndGgsaT1bMF0sbz1bMF07KytyPDM7KXQ9bltyXSxpLnB1c2godFswXSksby5wdXNoKHRbMV0pO2ZvcihlLnB1c2goRW8oTnMsaSkrIiwiK0VvKE5zLG8pKSwtLXI7KytyPHU7KXQ9bltyXSxpLnNoaWZ0KCksaS5wdXNoKHRbMF0pLG8uc2hpZnQoKSxvLnB1c2godFsxXSksTm8oZSxpLG8pO3JldHVybiBlLmpvaW4oIiIpfWZ1bmN0aW9uIFNvKG4pe2Zvcih2YXIgdCxlLHI9LTEsdT1uLmxlbmd0aCxpPXUrNCxvPVtdLGE9W107KytyPDQ7KWU9bltyJXVdLG8ucHVzaChlWzBdKSxhLnB1c2goZVsxXSk7Zm9yKHQ9W0VvKE5zLG8pLCIsIixFbyhOcyxhKV0sLS1yOysrcjxpOyllPW5bciV1XSxvLnNoaWZ0KCksby5wdXNoKGVbMF0pLGEuc2hpZnQoKSxhLnB1c2goZVsxXSksTm8odCxvLGEpO3JldHVybiB0LmpvaW4oIiIpfWZ1bmN0aW9uIGtvKG4sdCl7dmFyIGU9bi5sZW5ndGgtMTtpZihlKWZvcih2YXIgcix1LGk9blswXVswXSxvPW5bMF1bMV0sYT1uW2VdWzBdLWksYz1uW2VdWzFdLW8scz0tMTsrK3M8PWU7KXI9bltzXSx1PXMvZSxyWzBdPXQqclswXSsoMS10KSooaSt1KmEpLHJbMV09dCpyWzFdKygxLXQpKihvK3UqYyk7cmV0dXJuIGJvKG4pfWZ1bmN0aW9uIEVvKG4sdCl7cmV0dXJuIG5bMF0qdFswXStuWzFdKnRbMV0rblsyXSp0WzJdK25bM10qdFszXX1mdW5jdGlvbiBObyhuLHQsZSl7bi5wdXNoKCJDIixFbyhrcyx0KSwiLCIsRW8oa3MsZSksIiwiLEVvKEVzLHQpLCIsIixFbyhFcyxlKSwiLCIsRW8oTnMsdCksIiwiLEVvKE5zLGUpKX1mdW5jdGlvbiBBbyhuLHQpe3JldHVybih0WzFdLW5bMV0pLyh0WzBdLW5bMF0pfWZ1bmN0aW9uIENvKG4pe2Zvcih2YXIgdD0wLGU9bi5sZW5ndGgtMSxyPVtdLHU9blswXSxpPW5bMV0sbz1yWzBdPUFvKHUsaSk7Kyt0PGU7KXJbdF09KG8rKG89QW8odT1pLGk9blt0KzFdKSkpLzI7cmV0dXJuIHJbdF09byxyfWZ1bmN0aW9uIExvKG4pe2Zvcih2YXIgdCxlLHIsdSxpPVtdLG89Q28obiksYT0tMSxjPW4ubGVuZ3RoLTE7KythPGM7KXQ9QW8oblthXSxuW2ErMV0pLGZhKHQpPFRhP29bYV09b1thKzFdPTA6KGU9b1thXS90LHI9b1thKzFdL3QsdT1lKmUrcipyLHU+OSYmKHU9Myp0L01hdGguc3FydCh1KSxvW2FdPXUqZSxvW2ErMV09dSpyKSk7Zm9yKGE9LTE7KythPD1jOyl1PShuW01hdGgubWluKGMsYSsxKV1bMF0tbltNYXRoLm1heCgwLGEtMSldWzBdKS8oNiooMStvW2FdKm9bYV0pKSxpLnB1c2goW3V8fDAsb1thXSp1fHwwXSk7cmV0dXJuIGl9ZnVuY3Rpb24gVG8obil7cmV0dXJuIG4ubGVuZ3RoPDM/Zm8obik6blswXStNbyhuLExvKG4pKX1mdW5jdGlvbiBxbyhuKXtmb3IodmFyIHQsZSxyLHU9LTEsaT1uLmxlbmd0aDsrK3U8aTspdD1uW3VdLGU9dFswXSxyPXRbMV0rYnMsdFswXT1lKk1hdGguY29zKHIpLHRbMV09ZSpNYXRoLnNpbihyKTtyZXR1cm4gbn1mdW5jdGlvbiB6byhuKXtmdW5jdGlvbiB0KHQpe2Z1bmN0aW9uIGMoKXt2LnB1c2goIk0iLGEobihtKSxmKSxsLHMobihkLnJldmVyc2UoKSksZiksIloiKX1mb3IodmFyIGgsZyxwLHY9W10sZD1bXSxtPVtdLHk9LTEseD10Lmxlbmd0aCxNPUV0KGUpLF89RXQodSksYj1lPT09cj9mdW5jdGlvbigpe3JldHVybiBnfTpFdChyKSx3PXU9PT1pP2Z1bmN0aW9uKCl7cmV0dXJuIHB9OkV0KGkpOysreTx4OylvLmNhbGwodGhpcyxoPXRbeV0seSk/KGQucHVzaChbZz0rTS5jYWxsKHRoaXMsaCx5KSxwPStfLmNhbGwodGhpcyxoLHkpXSksbS5wdXNoKFsrYi5jYWxsKHRoaXMsaCx5KSwrdy5jYWxsKHRoaXMsaCx5KV0pKTpkLmxlbmd0aCYmKGMoKSxkPVtdLG09W10pO3JldHVybiBkLmxlbmd0aCYmYygpLHYubGVuZ3RoP3Yuam9pbigiIik6bnVsbH12YXIgZT1OcixyPU5yLHU9MCxpPUFyLG89TmUsYT1mbyxjPWEua2V5LHM9YSxsPSJMIixmPS43O3JldHVybiB0Lng9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9cj1uLHQpOnJ9LHQueDA9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix0KTplfSx0LngxPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PWk9bix0KTppfSx0LnkwPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sdCk6dX0sdC55MT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLHQpOml9LHQuZGVmaW5lZD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1uLHQpOm99LHQuaW50ZXJwb2xhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGM9ImZ1bmN0aW9uIj09dHlwZW9mIG4/YT1uOihhPVNzLmdldChuKXx8Zm8pLmtleSxzPWEucmV2ZXJzZXx8YSxsPWEuY2xvc2VkPyJNIjoiTCIsdCk6Y30sdC50ZW5zaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhmPW4sdCk6Zn0sdH1mdW5jdGlvbiBSbyhuKXtyZXR1cm4gbi5yYWRpdXN9ZnVuY3Rpb24gRG8obil7cmV0dXJuW24ueCxuLnldfWZ1bmN0aW9uIFBvKG4pe3JldHVybiBmdW5jdGlvbigpe3ZhciB0PW4uYXBwbHkodGhpcyxhcmd1bWVudHMpLGU9dFswXSxyPXRbMV0rYnM7cmV0dXJuW2UqTWF0aC5jb3MociksZSpNYXRoLnNpbihyKV19fWZ1bmN0aW9uIFVvKCl7cmV0dXJuIDY0fWZ1bmN0aW9uIGpvKCl7cmV0dXJuImNpcmNsZSJ9ZnVuY3Rpb24gSG8obil7dmFyIHQ9TWF0aC5zcXJ0KG4vQWEpO3JldHVybiJNMCwiK3QrIkEiK3QrIiwiK3QrIiAwIDEsMSAwLCIrLXQrIkEiK3QrIiwiK3QrIiAwIDEsMSAwLCIrdCsiWiJ9ZnVuY3Rpb24gRm8obix0KXtyZXR1cm4gZGEobix6cyksbi5pZD10LG59ZnVuY3Rpb24gT28obix0LGUscil7dmFyIHU9bi5pZDtyZXR1cm4gUChuLCJmdW5jdGlvbiI9PXR5cGVvZiBlP2Z1bmN0aW9uKG4saSxvKXtuLl9fdHJhbnNpdGlvbl9fW3VdLnR3ZWVuLnNldCh0LHIoZS5jYWxsKG4sbi5fX2RhdGFfXyxpLG8pKSl9OihlPXIoZSksZnVuY3Rpb24obil7bi5fX3RyYW5zaXRpb25fX1t1XS50d2Vlbi5zZXQodCxlKX0pKX1mdW5jdGlvbiBZbyhuKXtyZXR1cm4gbnVsbD09biYmKG49IiIpLGZ1bmN0aW9uKCl7dGhpcy50ZXh0Q29udGVudD1ufX1mdW5jdGlvbiBJbyhuLHQsZSxyKXt2YXIgdT1uLl9fdHJhbnNpdGlvbl9ffHwobi5fX3RyYW5zaXRpb25fXz17YWN0aXZlOjAsY291bnQ6MH0pLGk9dVtlXTtpZighaSl7dmFyIGE9ci50aW1lO2k9dVtlXT17dHdlZW46bmV3IG8sdGltZTphLGVhc2U6ci5lYXNlLGRlbGF5OnIuZGVsYXksZHVyYXRpb246ci5kdXJhdGlvbn0sKyt1LmNvdW50LEdvLnRpbWVyKGZ1bmN0aW9uKHIpe2Z1bmN0aW9uIG8ocil7cmV0dXJuIHUuYWN0aXZlPmU/cygpOih1LmFjdGl2ZT1lLGkuZXZlbnQmJmkuZXZlbnQuc3RhcnQuY2FsbChuLGwsdCksaS50d2Vlbi5mb3JFYWNoKGZ1bmN0aW9uKGUscil7KHI9ci5jYWxsKG4sbCx0KSkmJnYucHVzaChyKX0pLEdvLnRpbWVyKGZ1bmN0aW9uKCl7cmV0dXJuIHAuYz1jKHJ8fDEpP05lOmMsMX0sMCxhKSx2b2lkIDApfWZ1bmN0aW9uIGMocil7aWYodS5hY3RpdmUhPT1lKXJldHVybiBzKCk7Zm9yKHZhciBvPXIvZyxhPWYobyksYz12Lmxlbmd0aDtjPjA7KXZbLS1jXS5jYWxsKG4sYSk7cmV0dXJuIG8+PTE/KGkuZXZlbnQmJmkuZXZlbnQuZW5kLmNhbGwobixsLHQpLHMoKSk6dm9pZCAwfWZ1bmN0aW9uIHMoKXtyZXR1cm4tLXUuY291bnQ/ZGVsZXRlIHVbZV06ZGVsZXRlIG4uX190cmFuc2l0aW9uX18sMX12YXIgbD1uLl9fZGF0YV9fLGY9aS5lYXNlLGg9aS5kZWxheSxnPWkuZHVyYXRpb24scD1uYyx2PVtdO3JldHVybiBwLnQ9aCthLHI+PWg/byhyLWgpOihwLmM9byx2b2lkIDApCn0sMCxhKX19ZnVuY3Rpb24gWm8obix0KXtuLmF0dHIoInRyYW5zZm9ybSIsZnVuY3Rpb24obil7cmV0dXJuInRyYW5zbGF0ZSgiK3QobikrIiwwKSJ9KX1mdW5jdGlvbiBWbyhuLHQpe24uYXR0cigidHJhbnNmb3JtIixmdW5jdGlvbihuKXtyZXR1cm4idHJhbnNsYXRlKDAsIit0KG4pKyIpIn0pfWZ1bmN0aW9uICRvKG4pe3JldHVybiBuLnRvSVNPU3RyaW5nKCl9ZnVuY3Rpb24gWG8obix0LGUpe2Z1bmN0aW9uIHIodCl7cmV0dXJuIG4odCl9ZnVuY3Rpb24gdShuLGUpe3ZhciByPW5bMV0tblswXSx1PXIvZSxpPUdvLmJpc2VjdChZcyx1KTtyZXR1cm4gaT09WXMubGVuZ3RoP1t0LnllYXIsWGkobi5tYXAoZnVuY3Rpb24obil7cmV0dXJuIG4vMzE1MzZlNn0pLGUpWzJdXTppP3RbdS9Zc1tpLTFdPFlzW2ldL3U/aS0xOmldOltWcyxYaShuLGUpWzJdXX1yZXR1cm4gci5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIEJvKG4uaW52ZXJ0KHQpKX0sci5kb21haW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG4uZG9tYWluKHQpLHIpOm4uZG9tYWluKCkubWFwKEJvKX0sci5uaWNlPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZShlKXtyZXR1cm4haXNOYU4oZSkmJiFuLnJhbmdlKGUsQm8oK2UrMSksdCkubGVuZ3RofXZhciBpPXIuZG9tYWluKCksbz1qaShpKSxhPW51bGw9PW4/dShvLDEwKToibnVtYmVyIj09dHlwZW9mIG4mJnUobyxuKTtyZXR1cm4gYSYmKG49YVswXSx0PWFbMV0pLHIuZG9tYWluKE9pKGksdD4xP3tmbG9vcjpmdW5jdGlvbih0KXtmb3IoO2UodD1uLmZsb29yKHQpKTspdD1Cbyh0LTEpO3JldHVybiB0fSxjZWlsOmZ1bmN0aW9uKHQpe2Zvcig7ZSh0PW4uY2VpbCh0KSk7KXQ9Qm8oK3QrMSk7cmV0dXJuIHR9fTpuKSl9LHIudGlja3M9ZnVuY3Rpb24obix0KXt2YXIgZT1qaShyLmRvbWFpbigpKSxpPW51bGw9PW4/dShlLDEwKToibnVtYmVyIj09dHlwZW9mIG4/dShlLG4pOiFuLnJhbmdlJiZbe3JhbmdlOm59LHRdO3JldHVybiBpJiYobj1pWzBdLHQ9aVsxXSksbi5yYW5nZShlWzBdLEJvKCtlWzFdKzEpLDE+dD8xOnQpfSxyLnRpY2tGb3JtYXQ9ZnVuY3Rpb24oKXtyZXR1cm4gZX0sci5jb3B5PWZ1bmN0aW9uKCl7cmV0dXJuIFhvKG4uY29weSgpLHQsZSl9LFZpKHIsbil9ZnVuY3Rpb24gQm8obil7cmV0dXJuIG5ldyBEYXRlKG4pfWZ1bmN0aW9uIEpvKG4pe3JldHVybiBKU09OLnBhcnNlKG4ucmVzcG9uc2VUZXh0KX1mdW5jdGlvbiBXbyhuKXt2YXIgdD1uYS5jcmVhdGVSYW5nZSgpO3JldHVybiB0LnNlbGVjdE5vZGUobmEuYm9keSksdC5jcmVhdGVDb250ZXh0dWFsRnJhZ21lbnQobi5yZXNwb25zZVRleHQpfXZhciBHbz17dmVyc2lvbjoiMy40LjQifTtEYXRlLm5vd3x8KERhdGUubm93PWZ1bmN0aW9uKCl7cmV0dXJuK25ldyBEYXRlfSk7dmFyIEtvPVtdLnNsaWNlLFFvPWZ1bmN0aW9uKG4pe3JldHVybiBLby5jYWxsKG4pfSxuYT1kb2N1bWVudCx0YT1uYS5kb2N1bWVudEVsZW1lbnQsZWE9d2luZG93O3RyeXtRbyh0YS5jaGlsZE5vZGVzKVswXS5ub2RlVHlwZX1jYXRjaChyYSl7UW89ZnVuY3Rpb24obil7Zm9yKHZhciB0PW4ubGVuZ3RoLGU9bmV3IEFycmF5KHQpO3QtLTspZVt0XT1uW3RdO3JldHVybiBlfX10cnl7bmEuY3JlYXRlRWxlbWVudCgiZGl2Iikuc3R5bGUuc2V0UHJvcGVydHkoIm9wYWNpdHkiLDAsIiIpfWNhdGNoKHVhKXt2YXIgaWE9ZWEuRWxlbWVudC5wcm90b3R5cGUsb2E9aWEuc2V0QXR0cmlidXRlLGFhPWlhLnNldEF0dHJpYnV0ZU5TLGNhPWVhLkNTU1N0eWxlRGVjbGFyYXRpb24ucHJvdG90eXBlLHNhPWNhLnNldFByb3BlcnR5O2lhLnNldEF0dHJpYnV0ZT1mdW5jdGlvbihuLHQpe29hLmNhbGwodGhpcyxuLHQrIiIpfSxpYS5zZXRBdHRyaWJ1dGVOUz1mdW5jdGlvbihuLHQsZSl7YWEuY2FsbCh0aGlzLG4sdCxlKyIiKX0sY2Euc2V0UHJvcGVydHk9ZnVuY3Rpb24obix0LGUpe3NhLmNhbGwodGhpcyxuLHQrIiIsZSl9fUdvLmFzY2VuZGluZz1uLEdvLmRlc2NlbmRpbmc9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj50Py0xOnQ+bj8xOnQ+PW4/MDowLzB9LEdvLm1pbj1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdT0tMSxpPW4ubGVuZ3RoO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKXtmb3IoOysrdTxpJiYhKG51bGwhPShlPW5bdV0pJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK3U8aTspbnVsbCE9KHI9blt1XSkmJmU+ciYmKGU9cil9ZWxzZXtmb3IoOysrdTxpJiYhKG51bGwhPShlPXQuY2FsbChuLG5bdV0sdSkpJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK3U8aTspbnVsbCE9KHI9dC5jYWxsKG4sblt1XSx1KSkmJmU+ciYmKGU9cil9cmV0dXJuIGV9LEdvLm1heD1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdT0tMSxpPW4ubGVuZ3RoO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKXtmb3IoOysrdTxpJiYhKG51bGwhPShlPW5bdV0pJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK3U8aTspbnVsbCE9KHI9blt1XSkmJnI+ZSYmKGU9cil9ZWxzZXtmb3IoOysrdTxpJiYhKG51bGwhPShlPXQuY2FsbChuLG5bdV0sdSkpJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK3U8aTspbnVsbCE9KHI9dC5jYWxsKG4sblt1XSx1KSkmJnI+ZSYmKGU9cil9cmV0dXJuIGV9LEdvLmV4dGVudD1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdSxpPS0xLG89bi5sZW5ndGg7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpe2Zvcig7KytpPG8mJiEobnVsbCE9KGU9dT1uW2ldKSYmZT49ZSk7KWU9dT12b2lkIDA7Zm9yKDsrK2k8bzspbnVsbCE9KHI9bltpXSkmJihlPnImJihlPXIpLHI+dSYmKHU9cikpfWVsc2V7Zm9yKDsrK2k8byYmIShudWxsIT0oZT11PXQuY2FsbChuLG5baV0saSkpJiZlPj1lKTspZT12b2lkIDA7Zm9yKDsrK2k8bzspbnVsbCE9KHI9dC5jYWxsKG4sbltpXSxpKSkmJihlPnImJihlPXIpLHI+dSYmKHU9cikpfXJldHVybltlLHVdfSxHby5zdW09ZnVuY3Rpb24obix0KXt2YXIgZSxyPTAsdT1uLmxlbmd0aCxpPS0xO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKWZvcig7KytpPHU7KWlzTmFOKGU9K25baV0pfHwocis9ZSk7ZWxzZSBmb3IoOysraTx1Oylpc05hTihlPSt0LmNhbGwobixuW2ldLGkpKXx8KHIrPWUpO3JldHVybiByfSxHby5tZWFuPWZ1bmN0aW9uKG4sZSl7dmFyIHIsdT1uLmxlbmd0aCxpPTAsbz0tMSxhPTA7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpZm9yKDsrK288dTspdChyPW5bb10pJiYoaSs9KHItaSkvKythKTtlbHNlIGZvcig7KytvPHU7KXQocj1lLmNhbGwobixuW29dLG8pKSYmKGkrPShyLWkpLysrYSk7cmV0dXJuIGE/aTp2b2lkIDB9LEdvLnF1YW50aWxlPWZ1bmN0aW9uKG4sdCl7dmFyIGU9KG4ubGVuZ3RoLTEpKnQrMSxyPU1hdGguZmxvb3IoZSksdT0rbltyLTFdLGk9ZS1yO3JldHVybiBpP3UraSoobltyXS11KTp1fSxHby5tZWRpYW49ZnVuY3Rpb24oZSxyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD4xJiYoZT1lLm1hcChyKSksZT1lLmZpbHRlcih0KSxlLmxlbmd0aD9Hby5xdWFudGlsZShlLnNvcnQobiksLjUpOnZvaWQgMH07dmFyIGxhPWUobik7R28uYmlzZWN0TGVmdD1sYS5sZWZ0LEdvLmJpc2VjdD1Hby5iaXNlY3RSaWdodD1sYS5yaWdodCxHby5iaXNlY3Rvcj1mdW5jdGlvbih0KXtyZXR1cm4gZSgxPT09dC5sZW5ndGg/ZnVuY3Rpb24oZSxyKXtyZXR1cm4gbih0KGUpLHIpfTp0KX0sR28uc2h1ZmZsZT1mdW5jdGlvbihuKXtmb3IodmFyIHQsZSxyPW4ubGVuZ3RoO3I7KWU9MHxNYXRoLnJhbmRvbSgpKnItLSx0PW5bcl0sbltyXT1uW2VdLG5bZV09dDtyZXR1cm4gbn0sR28ucGVybXV0ZT1mdW5jdGlvbihuLHQpe2Zvcih2YXIgZT10Lmxlbmd0aCxyPW5ldyBBcnJheShlKTtlLS07KXJbZV09blt0W2VdXTtyZXR1cm4gcn0sR28ucGFpcnM9ZnVuY3Rpb24obil7Zm9yKHZhciB0LGU9MCxyPW4ubGVuZ3RoLTEsdT1uWzBdLGk9bmV3IEFycmF5KDA+cj8wOnIpO3I+ZTspaVtlXT1bdD11LHU9blsrK2VdXTtyZXR1cm4gaX0sR28uemlwPWZ1bmN0aW9uKCl7aWYoISh1PWFyZ3VtZW50cy5sZW5ndGgpKXJldHVybltdO2Zvcih2YXIgbj0tMSx0PUdvLm1pbihhcmd1bWVudHMsciksZT1uZXcgQXJyYXkodCk7KytuPHQ7KWZvcih2YXIgdSxpPS0xLG89ZVtuXT1uZXcgQXJyYXkodSk7KytpPHU7KW9baV09YXJndW1lbnRzW2ldW25dO3JldHVybiBlfSxHby50cmFuc3Bvc2U9ZnVuY3Rpb24obil7cmV0dXJuIEdvLnppcC5hcHBseShHbyxuKX0sR28ua2V5cz1mdW5jdGlvbihuKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gbil0LnB1c2goZSk7cmV0dXJuIHR9LEdvLnZhbHVlcz1mdW5jdGlvbihuKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gbil0LnB1c2gobltlXSk7cmV0dXJuIHR9LEdvLmVudHJpZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciBlIGluIG4pdC5wdXNoKHtrZXk6ZSx2YWx1ZTpuW2VdfSk7cmV0dXJuIHR9LEdvLm1lcmdlPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxlLHIsdT1uLmxlbmd0aCxpPS0xLG89MDsrK2k8dTspbys9bltpXS5sZW5ndGg7Zm9yKGU9bmV3IEFycmF5KG8pOy0tdT49MDspZm9yKHI9blt1XSx0PXIubGVuZ3RoOy0tdD49MDspZVstLW9dPXJbdF07cmV0dXJuIGV9O3ZhciBmYT1NYXRoLmFicztHby5yYW5nZT1mdW5jdGlvbihuLHQsZSl7aWYoYXJndW1lbnRzLmxlbmd0aDwzJiYoZT0xLGFyZ3VtZW50cy5sZW5ndGg8MiYmKHQ9bixuPTApKSwxLzA9PT0odC1uKS9lKXRocm93IG5ldyBFcnJvcigiaW5maW5pdGUgcmFuZ2UiKTt2YXIgcixpPVtdLG89dShmYShlKSksYT0tMTtpZihuKj1vLHQqPW8sZSo9bywwPmUpZm9yKDsocj1uK2UqKythKT50OylpLnB1c2goci9vKTtlbHNlIGZvcig7KHI9bitlKisrYSk8dDspaS5wdXNoKHIvbyk7cmV0dXJuIGl9LEdvLm1hcD1mdW5jdGlvbihuKXt2YXIgdD1uZXcgbztpZihuIGluc3RhbmNlb2YgbyluLmZvckVhY2goZnVuY3Rpb24obixlKXt0LnNldChuLGUpfSk7ZWxzZSBmb3IodmFyIGUgaW4gbil0LnNldChlLG5bZV0pO3JldHVybiB0fSxpKG8se2hhczphLGdldDpmdW5jdGlvbihuKXtyZXR1cm4gdGhpc1toYStuXX0sc2V0OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIHRoaXNbaGErbl09dH0scmVtb3ZlOmMsa2V5czpzLHZhbHVlczpmdW5jdGlvbigpe3ZhciBuPVtdO3JldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24odCxlKXtuLnB1c2goZSl9KSxufSxlbnRyaWVzOmZ1bmN0aW9uKCl7dmFyIG49W107cmV0dXJuIHRoaXMuZm9yRWFjaChmdW5jdGlvbih0LGUpe24ucHVzaCh7a2V5OnQsdmFsdWU6ZX0pfSksbn0sc2l6ZTpsLGVtcHR5OmYsZm9yRWFjaDpmdW5jdGlvbihuKXtmb3IodmFyIHQgaW4gdGhpcyl0LmNoYXJDb2RlQXQoMCk9PT1nYSYmbi5jYWxsKHRoaXMsdC5zdWJzdHJpbmcoMSksdGhpc1t0XSl9fSk7dmFyIGhhPSJceDAwIixnYT1oYS5jaGFyQ29kZUF0KDApO0dvLm5lc3Q9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKHQsYSxjKXtpZihjPj1pLmxlbmd0aClyZXR1cm4gcj9yLmNhbGwodSxhKTplP2Euc29ydChlKTphO2Zvcih2YXIgcyxsLGYsaCxnPS0xLHA9YS5sZW5ndGgsdj1pW2MrK10sZD1uZXcgbzsrK2c8cDspKGg9ZC5nZXQocz12KGw9YVtnXSkpKT9oLnB1c2gobCk6ZC5zZXQocyxbbF0pO3JldHVybiB0PyhsPXQoKSxmPWZ1bmN0aW9uKGUscil7bC5zZXQoZSxuKHQscixjKSl9KToobD17fSxmPWZ1bmN0aW9uKGUscil7bFtlXT1uKHQscixjKX0pLGQuZm9yRWFjaChmKSxsfWZ1bmN0aW9uIHQobixlKXtpZihlPj1pLmxlbmd0aClyZXR1cm4gbjt2YXIgcj1bXSx1PWFbZSsrXTtyZXR1cm4gbi5mb3JFYWNoKGZ1bmN0aW9uKG4sdSl7ci5wdXNoKHtrZXk6bix2YWx1ZXM6dCh1LGUpfSl9KSx1P3Iuc29ydChmdW5jdGlvbihuLHQpe3JldHVybiB1KG4ua2V5LHQua2V5KX0pOnJ9dmFyIGUscix1PXt9LGk9W10sYT1bXTtyZXR1cm4gdS5tYXA9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbihlLHQsMCl9LHUuZW50cmllcz1mdW5jdGlvbihlKXtyZXR1cm4gdChuKEdvLm1hcCxlLDApLDApfSx1LmtleT1mdW5jdGlvbihuKXtyZXR1cm4gaS5wdXNoKG4pLHV9LHUuc29ydEtleXM9ZnVuY3Rpb24obil7cmV0dXJuIGFbaS5sZW5ndGgtMV09bix1fSx1LnNvcnRWYWx1ZXM9ZnVuY3Rpb24obil7cmV0dXJuIGU9bix1fSx1LnJvbGx1cD1mdW5jdGlvbihuKXtyZXR1cm4gcj1uLHV9LHV9LEdvLnNldD1mdW5jdGlvbihuKXt2YXIgdD1uZXcgaDtpZihuKWZvcih2YXIgZT0wLHI9bi5sZW5ndGg7cj5lOysrZSl0LmFkZChuW2VdKTtyZXR1cm4gdH0saShoLHtoYXM6YSxhZGQ6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXNbaGErbl09ITAsbn0scmVtb3ZlOmZ1bmN0aW9uKG4pe3JldHVybiBuPWhhK24sbiBpbiB0aGlzJiZkZWxldGUgdGhpc1tuXX0sdmFsdWVzOnMsc2l6ZTpsLGVtcHR5OmYsZm9yRWFjaDpmdW5jdGlvbihuKXtmb3IodmFyIHQgaW4gdGhpcyl0LmNoYXJDb2RlQXQoMCk9PT1nYSYmbi5jYWxsKHRoaXMsdC5zdWJzdHJpbmcoMSkpfX0pLEdvLmJlaGF2aW9yPXt9LEdvLnJlYmluZD1mdW5jdGlvbihuLHQpe2Zvcih2YXIgZSxyPTEsdT1hcmd1bWVudHMubGVuZ3RoOysrcjx1OyluW2U9YXJndW1lbnRzW3JdXT1nKG4sdCx0W2VdKTtyZXR1cm4gbn07dmFyIHBhPVsid2Via2l0IiwibXMiLCJtb3oiLCJNb3oiLCJvIiwiTyJdO0dvLmRpc3BhdGNoPWZ1bmN0aW9uKCl7Zm9yKHZhciBuPW5ldyBkLHQ9LTEsZT1hcmd1bWVudHMubGVuZ3RoOysrdDxlOyluW2FyZ3VtZW50c1t0XV09bShuKTtyZXR1cm4gbn0sZC5wcm90b3R5cGUub249ZnVuY3Rpb24obix0KXt2YXIgZT1uLmluZGV4T2YoIi4iKSxyPSIiO2lmKGU+PTAmJihyPW4uc3Vic3RyaW5nKGUrMSksbj1uLnN1YnN0cmluZygwLGUpKSxuKXJldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/dGhpc1tuXS5vbihyKTp0aGlzW25dLm9uKHIsdCk7aWYoMj09PWFyZ3VtZW50cy5sZW5ndGgpe2lmKG51bGw9PXQpZm9yKG4gaW4gdGhpcyl0aGlzLmhhc093blByb3BlcnR5KG4pJiZ0aGlzW25dLm9uKHIsbnVsbCk7cmV0dXJuIHRoaXN9fSxHby5ldmVudD1udWxsLEdvLnJlcXVvdGU9ZnVuY3Rpb24obil7cmV0dXJuIG4ucmVwbGFjZSh2YSwiXFwkJiIpfTt2YXIgdmE9L1tcXFxeXCRcKlwrXD9cfFxbXF1cKFwpXC5ce1x9XS9nLGRhPXt9Ll9fcHJvdG9fXz9mdW5jdGlvbihuLHQpe24uX19wcm90b19fPXR9OmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciBlIGluIHQpbltlXT10W2VdfSxtYT1mdW5jdGlvbihuLHQpe3JldHVybiB0LnF1ZXJ5U2VsZWN0b3Iobil9LHlhPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHQucXVlcnlTZWxlY3RvckFsbChuKX0seGE9dGFbcCh0YSwibWF0Y2hlc1NlbGVjdG9yIildLE1hPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHhhLmNhbGwobix0KX07ImZ1bmN0aW9uIj09dHlwZW9mIFNpenpsZSYmKG1hPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIFNpenpsZShuLHQpWzBdfHxudWxsfSx5YT1TaXp6bGUsTWE9U2l6emxlLm1hdGNoZXNTZWxlY3RvciksR28uc2VsZWN0aW9uPWZ1bmN0aW9uKCl7cmV0dXJuIFNhfTt2YXIgX2E9R28uc2VsZWN0aW9uLnByb3RvdHlwZT1bXTtfYS5zZWxlY3Q9ZnVuY3Rpb24obil7dmFyIHQsZSxyLHUsaT1bXTtuPWIobik7Zm9yKHZhciBvPS0xLGE9dGhpcy5sZW5ndGg7KytvPGE7KXtpLnB1c2godD1bXSksdC5wYXJlbnROb2RlPShyPXRoaXNbb10pLnBhcmVudE5vZGU7Zm9yKHZhciBjPS0xLHM9ci5sZW5ndGg7KytjPHM7KSh1PXJbY10pPyh0LnB1c2goZT1uLmNhbGwodSx1Ll9fZGF0YV9fLGMsbykpLGUmJiJfX2RhdGFfXyJpbiB1JiYoZS5fX2RhdGFfXz11Ll9fZGF0YV9fKSk6dC5wdXNoKG51bGwpfXJldHVybiBfKGkpfSxfYS5zZWxlY3RBbGw9ZnVuY3Rpb24obil7dmFyIHQsZSxyPVtdO249dyhuKTtmb3IodmFyIHU9LTEsaT10aGlzLmxlbmd0aDsrK3U8aTspZm9yKHZhciBvPXRoaXNbdV0sYT0tMSxjPW8ubGVuZ3RoOysrYTxjOykoZT1vW2FdKSYmKHIucHVzaCh0PVFvKG4uY2FsbChlLGUuX19kYXRhX18sYSx1KSkpLHQucGFyZW50Tm9kZT1lKTtyZXR1cm4gXyhyKX07dmFyIGJhPXtzdmc6Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIix4aHRtbDoiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIseGxpbms6Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLHhtbDoiaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIix4bWxuczoiaHR0cDovL3d3dy53My5vcmcvMjAwMC94bWxucy8ifTtHby5ucz17cHJlZml4OmJhLHF1YWxpZnk6ZnVuY3Rpb24obil7dmFyIHQ9bi5pbmRleE9mKCI6IiksZT1uO3JldHVybiB0Pj0wJiYoZT1uLnN1YnN0cmluZygwLHQpLG49bi5zdWJzdHJpbmcodCsxKSksYmEuaGFzT3duUHJvcGVydHkoZSk/e3NwYWNlOmJhW2VdLGxvY2FsOm59Om59fSxfYS5hdHRyPWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pe3ZhciBlPXRoaXMubm9kZSgpO3JldHVybiBuPUdvLm5zLnF1YWxpZnkobiksbi5sb2NhbD9lLmdldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCk6ZS5nZXRBdHRyaWJ1dGUobil9Zm9yKHQgaW4gbil0aGlzLmVhY2goUyh0LG5bdF0pKTtyZXR1cm4gdGhpc31yZXR1cm4gdGhpcy5lYWNoKFMobix0KSl9LF9hLmNsYXNzZWQ9ZnVuY3Rpb24obix0KXtpZihhcmd1bWVudHMubGVuZ3RoPDIpe2lmKCJzdHJpbmciPT10eXBlb2Ygbil7dmFyIGU9dGhpcy5ub2RlKCkscj0obj1OKG4pKS5sZW5ndGgsdT0tMTtpZih0PWUuY2xhc3NMaXN0KXtmb3IoOysrdTxyOylpZighdC5jb250YWlucyhuW3VdKSlyZXR1cm4hMX1lbHNlIGZvcih0PWUuZ2V0QXR0cmlidXRlKCJjbGFzcyIpOysrdTxyOylpZighRShuW3VdKS50ZXN0KHQpKXJldHVybiExO3JldHVybiEwfWZvcih0IGluIG4pdGhpcy5lYWNoKEEodCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaChBKG4sdCkpfSxfYS5zdHlsZT1mdW5jdGlvbihuLHQsZSl7dmFyIHI9YXJndW1lbnRzLmxlbmd0aDtpZigzPnIpe2lmKCJzdHJpbmciIT10eXBlb2Ygbil7Mj5yJiYodD0iIik7Zm9yKGUgaW4gbil0aGlzLmVhY2goTChlLG5bZV0sdCkpO3JldHVybiB0aGlzfWlmKDI+cilyZXR1cm4gZWEuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLm5vZGUoKSxudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKG4pO2U9IiJ9cmV0dXJuIHRoaXMuZWFjaChMKG4sdCxlKSl9LF9hLnByb3BlcnR5PWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pcmV0dXJuIHRoaXMubm9kZSgpW25dO2Zvcih0IGluIG4pdGhpcy5lYWNoKFQodCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaChUKG4sdCkpfSxfYS50ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3RoaXMuZWFjaCgiZnVuY3Rpb24iPT10eXBlb2Ygbj9mdW5jdGlvbigpe3ZhciB0PW4uYXBwbHkodGhpcyxhcmd1bWVudHMpO3RoaXMudGV4dENvbnRlbnQ9bnVsbD09dD8iIjp0fTpudWxsPT1uP2Z1bmN0aW9uKCl7dGhpcy50ZXh0Q29udGVudD0iIn06ZnVuY3Rpb24oKXt0aGlzLnRleHRDb250ZW50PW59KTp0aGlzLm5vZGUoKS50ZXh0Q29udGVudH0sX2EuaHRtbD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD90aGlzLmVhY2goImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24oKXt2YXIgdD1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt0aGlzLmlubmVySFRNTD1udWxsPT10PyIiOnR9Om51bGw9PW4/ZnVuY3Rpb24oKXt0aGlzLmlubmVySFRNTD0iIn06ZnVuY3Rpb24oKXt0aGlzLmlubmVySFRNTD1ufSk6dGhpcy5ub2RlKCkuaW5uZXJIVE1MfSxfYS5hcHBlbmQ9ZnVuY3Rpb24obil7cmV0dXJuIG49cShuKSx0aGlzLnNlbGVjdChmdW5jdGlvbigpe3JldHVybiB0aGlzLmFwcGVuZENoaWxkKG4uYXBwbHkodGhpcyxhcmd1bWVudHMpKX0pfSxfYS5pbnNlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj1xKG4pLHQ9Yih0KSx0aGlzLnNlbGVjdChmdW5jdGlvbigpe3JldHVybiB0aGlzLmluc2VydEJlZm9yZShuLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8bnVsbCl9KX0sX2EucmVtb3ZlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBuPXRoaXMucGFyZW50Tm9kZTtuJiZuLnJlbW92ZUNoaWxkKHRoaXMpfSl9LF9hLmRhdGE9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKG4sZSl7dmFyIHIsdSxpLGE9bi5sZW5ndGgsZj1lLmxlbmd0aCxoPU1hdGgubWluKGEsZiksZz1uZXcgQXJyYXkoZikscD1uZXcgQXJyYXkoZiksdj1uZXcgQXJyYXkoYSk7aWYodCl7dmFyIGQsbT1uZXcgbyx5PW5ldyBvLHg9W107Zm9yKHI9LTE7KytyPGE7KWQ9dC5jYWxsKHU9bltyXSx1Ll9fZGF0YV9fLHIpLG0uaGFzKGQpP3Zbcl09dTptLnNldChkLHUpLHgucHVzaChkKTtmb3Iocj0tMTsrK3I8ZjspZD10LmNhbGwoZSxpPWVbcl0sciksKHU9bS5nZXQoZCkpPyhnW3JdPXUsdS5fX2RhdGFfXz1pKTp5LmhhcyhkKXx8KHBbcl09eihpKSkseS5zZXQoZCxpKSxtLnJlbW92ZShkKTtmb3Iocj0tMTsrK3I8YTspbS5oYXMoeFtyXSkmJih2W3JdPW5bcl0pfWVsc2V7Zm9yKHI9LTE7KytyPGg7KXU9bltyXSxpPWVbcl0sdT8odS5fX2RhdGFfXz1pLGdbcl09dSk6cFtyXT16KGkpO2Zvcig7Zj5yOysrcilwW3JdPXooZVtyXSk7Zm9yKDthPnI7KytyKXZbcl09bltyXX1wLnVwZGF0ZT1nLHAucGFyZW50Tm9kZT1nLnBhcmVudE5vZGU9di5wYXJlbnROb2RlPW4ucGFyZW50Tm9kZSxjLnB1c2gocCkscy5wdXNoKGcpLGwucHVzaCh2KX12YXIgcix1LGk9LTEsYT10aGlzLmxlbmd0aDtpZighYXJndW1lbnRzLmxlbmd0aCl7Zm9yKG49bmV3IEFycmF5KGE9KHI9dGhpc1swXSkubGVuZ3RoKTsrK2k8YTspKHU9cltpXSkmJihuW2ldPXUuX19kYXRhX18pO3JldHVybiBufXZhciBjPVUoW10pLHM9XyhbXSksbD1fKFtdKTtpZigiZnVuY3Rpb24iPT10eXBlb2Ygbilmb3IoOysraTxhOyllKHI9dGhpc1tpXSxuLmNhbGwocixyLnBhcmVudE5vZGUuX19kYXRhX18saSkpO2Vsc2UgZm9yKDsrK2k8YTspZShyPXRoaXNbaV0sbik7cmV0dXJuIHMuZW50ZXI9ZnVuY3Rpb24oKXtyZXR1cm4gY30scy5leGl0PWZ1bmN0aW9uKCl7cmV0dXJuIGx9LHN9LF9hLmRhdHVtPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3RoaXMucHJvcGVydHkoIl9fZGF0YV9fIixuKTp0aGlzLnByb3BlcnR5KCJfX2RhdGFfXyIpfSxfYS5maWx0ZXI9ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9W107ImZ1bmN0aW9uIiE9dHlwZW9mIG4mJihuPVIobikpO2Zvcih2YXIgaT0wLG89dGhpcy5sZW5ndGg7bz5pO2krKyl7dS5wdXNoKHQ9W10pLHQucGFyZW50Tm9kZT0oZT10aGlzW2ldKS5wYXJlbnROb2RlO2Zvcih2YXIgYT0wLGM9ZS5sZW5ndGg7Yz5hO2ErKykocj1lW2FdKSYmbi5jYWxsKHIsci5fX2RhdGFfXyxhLGkpJiZ0LnB1c2gocil9cmV0dXJuIF8odSl9LF9hLm9yZGVyPWZ1bmN0aW9uKCl7Zm9yKHZhciBuPS0xLHQ9dGhpcy5sZW5ndGg7KytuPHQ7KWZvcih2YXIgZSxyPXRoaXNbbl0sdT1yLmxlbmd0aC0xLGk9clt1XTstLXU+PTA7KShlPXJbdV0pJiYoaSYmaSE9PWUubmV4dFNpYmxpbmcmJmkucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZSxpKSxpPWUpO3JldHVybiB0aGlzfSxfYS5zb3J0PWZ1bmN0aW9uKG4pe249RC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Zm9yKHZhciB0PS0xLGU9dGhpcy5sZW5ndGg7Kyt0PGU7KXRoaXNbdF0uc29ydChuKTtyZXR1cm4gdGhpcy5vcmRlcigpfSxfYS5lYWNoPWZ1bmN0aW9uKG4pe3JldHVybiBQKHRoaXMsZnVuY3Rpb24odCxlLHIpe24uY2FsbCh0LHQuX19kYXRhX18sZSxyKX0pfSxfYS5jYWxsPWZ1bmN0aW9uKG4pe3ZhciB0PVFvKGFyZ3VtZW50cyk7cmV0dXJuIG4uYXBwbHkodFswXT10aGlzLHQpLHRoaXN9LF9hLmVtcHR5PWZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMubm9kZSgpfSxfYS5ub2RlPWZ1bmN0aW9uKCl7Zm9yKHZhciBuPTAsdD10aGlzLmxlbmd0aDt0Pm47bisrKWZvcih2YXIgZT10aGlzW25dLHI9MCx1PWUubGVuZ3RoO3U+cjtyKyspe3ZhciBpPWVbcl07aWYoaSlyZXR1cm4gaX1yZXR1cm4gbnVsbH0sX2Euc2l6ZT1mdW5jdGlvbigpe3ZhciBuPTA7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpeysrbn0pLG59O3ZhciB3YT1bXTtHby5zZWxlY3Rpb24uZW50ZXI9VSxHby5zZWxlY3Rpb24uZW50ZXIucHJvdG90eXBlPXdhLHdhLmFwcGVuZD1fYS5hcHBlbmQsd2EuZW1wdHk9X2EuZW1wdHksd2Eubm9kZT1fYS5ub2RlLHdhLmNhbGw9X2EuY2FsbCx3YS5zaXplPV9hLnNpemUsd2Euc2VsZWN0PWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxlLHIsdSxpLG89W10sYT0tMSxjPXRoaXMubGVuZ3RoOysrYTxjOyl7cj0odT10aGlzW2FdKS51cGRhdGUsby5wdXNoKHQ9W10pLHQucGFyZW50Tm9kZT11LnBhcmVudE5vZGU7Zm9yKHZhciBzPS0xLGw9dS5sZW5ndGg7KytzPGw7KShpPXVbc10pPyh0LnB1c2gocltzXT1lPW4uY2FsbCh1LnBhcmVudE5vZGUsaS5fX2RhdGFfXyxzLGEpKSxlLl9fZGF0YV9fPWkuX19kYXRhX18pOnQucHVzaChudWxsKX1yZXR1cm4gXyhvKX0sd2EuaW5zZXJ0PWZ1bmN0aW9uKG4sdCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MiYmKHQ9aih0aGlzKSksX2EuaW5zZXJ0LmNhbGwodGhpcyxuLHQpfSxfYS50cmFuc2l0aW9uPWZ1bmN0aW9uKCl7Zm9yKHZhciBuLHQsZT1Dc3x8KytScyxyPVtdLHU9THN8fHt0aW1lOkRhdGUubm93KCksZWFzZTp3dSxkZWxheTowLGR1cmF0aW9uOjI1MH0saT0tMSxvPXRoaXMubGVuZ3RoOysraTxvOyl7ci5wdXNoKG49W10pO2Zvcih2YXIgYT10aGlzW2ldLGM9LTEscz1hLmxlbmd0aDsrK2M8czspKHQ9YVtjXSkmJklvKHQsYyxlLHUpLG4ucHVzaCh0KX1yZXR1cm4gRm8ocixlKX0sX2EuaW50ZXJydXB0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChIKX0sR28uc2VsZWN0PWZ1bmN0aW9uKG4pe3ZhciB0PVsic3RyaW5nIj09dHlwZW9mIG4/bWEobixuYSk6bl07cmV0dXJuIHQucGFyZW50Tm9kZT10YSxfKFt0XSl9LEdvLnNlbGVjdEFsbD1mdW5jdGlvbihuKXt2YXIgdD1Rbygic3RyaW5nIj09dHlwZW9mIG4/eWEobixuYSk6bik7cmV0dXJuIHQucGFyZW50Tm9kZT10YSxfKFt0XSl9O3ZhciBTYT1Hby5zZWxlY3QodGEpO19hLm9uPWZ1bmN0aW9uKG4sdCxlKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoO2lmKDM+cil7aWYoInN0cmluZyIhPXR5cGVvZiBuKXsyPnImJih0PSExKTtmb3IoZSBpbiBuKXRoaXMuZWFjaChGKGUsbltlXSx0KSk7cmV0dXJuIHRoaXN9aWYoMj5yKXJldHVybihyPXRoaXMubm9kZSgpWyJfX29uIituXSkmJnIuXztlPSExfXJldHVybiB0aGlzLmVhY2goRihuLHQsZSkpfTt2YXIga2E9R28ubWFwKHttb3VzZWVudGVyOiJtb3VzZW92ZXIiLG1vdXNlbGVhdmU6Im1vdXNlb3V0In0pO2thLmZvckVhY2goZnVuY3Rpb24obil7Im9uIituIGluIG5hJiZrYS5yZW1vdmUobil9KTt2YXIgRWE9Im9uc2VsZWN0c3RhcnQiaW4gbmE/bnVsbDpwKHRhLnN0eWxlLCJ1c2VyU2VsZWN0IiksTmE9MDtHby5tb3VzZT1mdW5jdGlvbihuKXtyZXR1cm4gWihuLHgoKSl9LEdvLnRvdWNoZXM9ZnVuY3Rpb24obix0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyJiYodD14KCkudG91Y2hlcyksdD9Rbyh0KS5tYXAoZnVuY3Rpb24odCl7dmFyIGU9WihuLHQpO3JldHVybiBlLmlkZW50aWZpZXI9dC5pZGVudGlmaWVyLGV9KTpbXX0sR28uYmVoYXZpb3IuZHJhZz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt0aGlzLm9uKCJtb3VzZWRvd24uZHJhZyIsdSkub24oInRvdWNoc3RhcnQuZHJhZyIsaSl9ZnVuY3Rpb24gdChuLHQsdSxpLG8pe3JldHVybiBmdW5jdGlvbigpe2Z1bmN0aW9uIGEoKXt2YXIgbixlLHI9dChoLHYpO3ImJihuPXJbMF0teFswXSxlPXJbMV0teFsxXSxwfD1ufGUseD1yLGcoe3R5cGU6ImRyYWciLHg6clswXStzWzBdLHk6clsxXStzWzFdLGR4Om4sZHk6ZX0pKX1mdW5jdGlvbiBjKCl7dChoLHYpJiYobS5vbihpK2QsbnVsbCkub24obytkLG51bGwpLHkocCYmR28uZXZlbnQudGFyZ2V0PT09ZiksZyh7dHlwZToiZHJhZ2VuZCJ9KSl9dmFyIHMsbD10aGlzLGY9R28uZXZlbnQudGFyZ2V0LGg9bC5wYXJlbnROb2RlLGc9ZS5vZihsLGFyZ3VtZW50cykscD0wLHY9bigpLGQ9Ii5kcmFnIisobnVsbD09dj8iIjoiLSIrdiksbT1Hby5zZWxlY3QodSgpKS5vbihpK2QsYSkub24obytkLGMpLHk9SSgpLHg9dChoLHYpO3I/KHM9ci5hcHBseShsLGFyZ3VtZW50cykscz1bcy54LXhbMF0scy55LXhbMV1dKTpzPVswLDBdLGcoe3R5cGU6ImRyYWdzdGFydCJ9KX19dmFyIGU9TShuLCJkcmFnIiwiZHJhZ3N0YXJ0IiwiZHJhZ2VuZCIpLHI9bnVsbCx1PXQodixHby5tb3VzZSxYLCJtb3VzZW1vdmUiLCJtb3VzZXVwIiksaT10KFYsR28udG91Y2gsJCwidG91Y2htb3ZlIiwidG91Y2hlbmQiKTtyZXR1cm4gbi5vcmlnaW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxHby5yZWJpbmQobixlLCJvbiIpfTt2YXIgQWE9TWF0aC5QSSxDYT0yKkFhLExhPUFhLzIsVGE9MWUtNixxYT1UYSpUYSx6YT1BYS8xODAsUmE9MTgwL0FhLERhPU1hdGguU1FSVDIsUGE9MixVYT00O0dvLmludGVycG9sYXRlWm9vbT1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIGUobil7dmFyIHQ9bip5O2lmKG0pe3ZhciBlPVEodiksbz1pLyhQYSpoKSooZSpudChEYSp0K3YpLUsodikpO3JldHVybltyK28qcyx1K28qbCxpKmUvUShEYSp0K3YpXX1yZXR1cm5bcituKnMsdStuKmwsaSpNYXRoLmV4cChEYSp0KV19dmFyIHI9blswXSx1PW5bMV0saT1uWzJdLG89dFswXSxhPXRbMV0sYz10WzJdLHM9by1yLGw9YS11LGY9cypzK2wqbCxoPU1hdGguc3FydChmKSxnPShjKmMtaSppK1VhKmYpLygyKmkqUGEqaCkscD0oYypjLWkqaS1VYSpmKS8oMipjKlBhKmgpLHY9TWF0aC5sb2coTWF0aC5zcXJ0KGcqZysxKS1nKSxkPU1hdGgubG9nKE1hdGguc3FydChwKnArMSktcCksbT1kLXYseT0obXx8TWF0aC5sb2coYy9pKSkvRGE7cmV0dXJuIGUuZHVyYXRpb249MWUzKnksZX0sR28uYmVoYXZpb3Iuem9vbT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obil7bi5vbihOLHMpLm9uKEZhKyIuem9vbSIsZikub24oQSxoKS5vbigiZGJsY2xpY2suem9vbSIsZykub24oTCxsKX1mdW5jdGlvbiB0KG4pe3JldHVyblsoblswXS1TLngpL1MuaywoblsxXS1TLnkpL1Mua119ZnVuY3Rpb24gZShuKXtyZXR1cm5bblswXSpTLmsrUy54LG5bMV0qUy5rK1MueV19ZnVuY3Rpb24gcihuKXtTLms9TWF0aC5tYXgoRVswXSxNYXRoLm1pbihFWzFdLG4pKX1mdW5jdGlvbiB1KG4sdCl7dD1lKHQpLFMueCs9blswXS10WzBdLFMueSs9blsxXS10WzFdfWZ1bmN0aW9uIGkoKXtfJiZfLmRvbWFpbih4LnJhbmdlKCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybihuLVMueCkvUy5rfSkubWFwKHguaW52ZXJ0KSksdyYmdy5kb21haW4oYi5yYW5nZSgpLm1hcChmdW5jdGlvbihuKXtyZXR1cm4obi1TLnkpL1Mua30pLm1hcChiLmludmVydCkpfWZ1bmN0aW9uIG8obil7bih7dHlwZToiem9vbXN0YXJ0In0pfWZ1bmN0aW9uIGEobil7aSgpLG4oe3R5cGU6Inpvb20iLHNjYWxlOlMuayx0cmFuc2xhdGU6W1MueCxTLnldfSl9ZnVuY3Rpb24gYyhuKXtuKHt0eXBlOiJ6b29tZW5kIn0pfWZ1bmN0aW9uIHMoKXtmdW5jdGlvbiBuKCl7bD0xLHUoR28ubW91c2UociksZyksYShzKX1mdW5jdGlvbiBlKCl7Zi5vbihBLGVhPT09cj9oOm51bGwpLm9uKEMsbnVsbCkscChsJiZHby5ldmVudC50YXJnZXQ9PT1pKSxjKHMpfXZhciByPXRoaXMsaT1Hby5ldmVudC50YXJnZXQscz1ULm9mKHIsYXJndW1lbnRzKSxsPTAsZj1Hby5zZWxlY3QoZWEpLm9uKEEsbikub24oQyxlKSxnPXQoR28ubW91c2UocikpLHA9SSgpO0guY2FsbChyKSxvKHMpfWZ1bmN0aW9uIGwoKXtmdW5jdGlvbiBuKCl7dmFyIG49R28udG91Y2hlcyhnKTtyZXR1cm4gaD1TLmssbi5mb3JFYWNoKGZ1bmN0aW9uKG4pe24uaWRlbnRpZmllciBpbiB2JiYodltuLmlkZW50aWZpZXJdPXQobikpfSksbn1mdW5jdGlvbiBlKCl7Zm9yKHZhciB0PUdvLmV2ZW50LmNoYW5nZWRUb3VjaGVzLGU9MCxpPXQubGVuZ3RoO2k+ZTsrK2Updlt0W2VdLmlkZW50aWZpZXJdPW51bGw7dmFyIG89bigpLGM9RGF0ZS5ub3coKTtpZigxPT09by5sZW5ndGgpe2lmKDUwMD5jLW0pe3ZhciBzPW9bMF0sbD12W3MuaWRlbnRpZmllcl07cigyKlMuayksdShzLGwpLHkoKSxhKHApfW09Y31lbHNlIGlmKG8ubGVuZ3RoPjEpe3ZhciBzPW9bMF0sZj1vWzFdLGg9c1swXS1mWzBdLGc9c1sxXS1mWzFdO2Q9aCpoK2cqZ319ZnVuY3Rpb24gaSgpe2Zvcih2YXIgbix0LGUsaSxvPUdvLnRvdWNoZXMoZyksYz0wLHM9by5sZW5ndGg7cz5jOysrYyxpPW51bGwpaWYoZT1vW2NdLGk9dltlLmlkZW50aWZpZXJdKXtpZih0KWJyZWFrO249ZSx0PWl9aWYoaSl7dmFyIGw9KGw9ZVswXS1uWzBdKSpsKyhsPWVbMV0tblsxXSkqbCxmPWQmJk1hdGguc3FydChsL2QpO249WyhuWzBdK2VbMF0pLzIsKG5bMV0rZVsxXSkvMl0sdD1bKHRbMF0raVswXSkvMiwodFsxXStpWzFdKS8yXSxyKGYqaCl9bT1udWxsLHUobix0KSxhKHApfWZ1bmN0aW9uIGYoKXtpZihHby5ldmVudC50b3VjaGVzLmxlbmd0aCl7Zm9yKHZhciB0PUdvLmV2ZW50LmNoYW5nZWRUb3VjaGVzLGU9MCxyPXQubGVuZ3RoO3I+ZTsrK2UpZGVsZXRlIHZbdFtlXS5pZGVudGlmaWVyXTtmb3IodmFyIHUgaW4gdilyZXR1cm4gdm9pZCBuKCl9Yi5vbih4LG51bGwpLHcub24oTixzKS5vbihMLGwpLGsoKSxjKHApfXZhciBoLGc9dGhpcyxwPVQub2YoZyxhcmd1bWVudHMpLHY9e30sZD0wLHg9Ii56b29tLSIrR28uZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllcixNPSJ0b3VjaG1vdmUiK3gsXz0idG91Y2hlbmQiK3gsYj1Hby5zZWxlY3QoR28uZXZlbnQudGFyZ2V0KS5vbihNLGkpLm9uKF8sZiksdz1Hby5zZWxlY3QoZykub24oTixudWxsKS5vbihMLGUpLGs9SSgpO0guY2FsbChnKSxlKCksbyhwKX1mdW5jdGlvbiBmKCl7dmFyIG49VC5vZih0aGlzLGFyZ3VtZW50cyk7ZD9jbGVhclRpbWVvdXQoZCk6KEguY2FsbCh0aGlzKSxvKG4pKSxkPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtkPW51bGwsYyhuKX0sNTApLHkoKTt2YXIgZT12fHxHby5tb3VzZSh0aGlzKTtwfHwocD10KGUpKSxyKE1hdGgucG93KDIsLjAwMipqYSgpKSpTLmspLHUoZSxwKSxhKG4pfWZ1bmN0aW9uIGgoKXtwPW51bGx9ZnVuY3Rpb24gZygpe3ZhciBuPVQub2YodGhpcyxhcmd1bWVudHMpLGU9R28ubW91c2UodGhpcyksaT10KGUpLHM9TWF0aC5sb2coUy5rKS9NYXRoLkxOMjtvKG4pLHIoTWF0aC5wb3coMixHby5ldmVudC5zaGlmdEtleT9NYXRoLmNlaWwocyktMTpNYXRoLmZsb29yKHMpKzEpKSx1KGUsaSksYShuKSxjKG4pfXZhciBwLHYsZCxtLHgsXyxiLHcsUz17eDowLHk6MCxrOjF9LGs9Wzk2MCw1MDBdLEU9SGEsTj0ibW91c2Vkb3duLnpvb20iLEE9Im1vdXNlbW92ZS56b29tIixDPSJtb3VzZXVwLnpvb20iLEw9InRvdWNoc3RhcnQuem9vbSIsVD1NKG4sInpvb21zdGFydCIsInpvb20iLCJ6b29tZW5kIik7cmV0dXJuIG4uZXZlbnQ9ZnVuY3Rpb24obil7bi5lYWNoKGZ1bmN0aW9uKCl7dmFyIG49VC5vZih0aGlzLGFyZ3VtZW50cyksdD1TO0NzP0dvLnNlbGVjdCh0aGlzKS50cmFuc2l0aW9uKCkuZWFjaCgic3RhcnQuem9vbSIsZnVuY3Rpb24oKXtTPXRoaXMuX19jaGFydF9ffHx7eDowLHk6MCxrOjF9LG8obil9KS50d2Vlbigiem9vbTp6b29tIixmdW5jdGlvbigpe3ZhciBlPWtbMF0scj1rWzFdLHU9ZS8yLGk9ci8yLG89R28uaW50ZXJwb2xhdGVab29tKFsodS1TLngpL1MuaywoaS1TLnkpL1MuayxlL1Mua10sWyh1LXQueCkvdC5rLChpLXQueSkvdC5rLGUvdC5rXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciByPW8odCksYz1lL3JbMl07dGhpcy5fX2NoYXJ0X189Uz17eDp1LXJbMF0qYyx5OmktclsxXSpjLGs6Y30sYShuKX19KS5lYWNoKCJlbmQuem9vbSIsZnVuY3Rpb24oKXtjKG4pfSk6KHRoaXMuX19jaGFydF9fPVMsbyhuKSxhKG4pLGMobikpfSl9LG4udHJhbnNsYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhTPXt4Oit0WzBdLHk6K3RbMV0sazpTLmt9LGkoKSxuKTpbUy54LFMueV19LG4uc2NhbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KFM9e3g6Uy54LHk6Uy55LGs6K3R9LGkoKSxuKTpTLmt9LG4uc2NhbGVFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KEU9bnVsbD09dD9IYTpbK3RbMF0sK3RbMV1dLG4pOkV9LG4uY2VudGVyPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh2PXQmJlsrdFswXSwrdFsxXV0sbik6dn0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhrPXQmJlsrdFswXSwrdFsxXV0sbik6a30sbi54PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhfPXQseD10LmNvcHkoKSxTPXt4OjAseTowLGs6MX0sbik6X30sbi55PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh3PXQsYj10LmNvcHkoKSxTPXt4OjAseTowLGs6MX0sbik6d30sR28ucmViaW5kKG4sVCwib24iKX07dmFyIGphLEhhPVswLDEvMF0sRmE9Im9ud2hlZWwiaW4gbmE/KGphPWZ1bmN0aW9uKCl7cmV0dXJuLUdvLmV2ZW50LmRlbHRhWSooR28uZXZlbnQuZGVsdGFNb2RlPzEyMDoxKX0sIndoZWVsIik6Im9ubW91c2V3aGVlbCJpbiBuYT8oamE9ZnVuY3Rpb24oKXtyZXR1cm4gR28uZXZlbnQud2hlZWxEZWx0YX0sIm1vdXNld2hlZWwiKTooamE9ZnVuY3Rpb24oKXtyZXR1cm4tR28uZXZlbnQuZGV0YWlsfSwiTW96TW91c2VQaXhlbFNjcm9sbCIpO2V0LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB0aGlzLnJnYigpKyIifSxHby5oc2w9ZnVuY3Rpb24obix0LGUpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgdXQ/cnQobi5oLG4ucyxuLmwpOl90KCIiK24sYnQscnQpOnJ0KCtuLCt0LCtlKX07dmFyIE9hPXV0LnByb3RvdHlwZT1uZXcgZXQ7T2EuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLHJ0KHRoaXMuaCx0aGlzLnMsdGhpcy5sL24pfSxPYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLHJ0KHRoaXMuaCx0aGlzLnMsbip0aGlzLmwpfSxPYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gaXQodGhpcy5oLHRoaXMucyx0aGlzLmwpfSxHby5oY2w9ZnVuY3Rpb24obix0LGUpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgYXQ/b3Qobi5oLG4uYyxuLmwpOm4gaW5zdGFuY2VvZiBsdD9odChuLmwsbi5hLG4uYik6aHQoKG49d3QoKG49R28ucmdiKG4pKS5yLG4uZyxuLmIpKS5sLG4uYSxuLmIpOm90KCtuLCt0LCtlKX07dmFyIFlhPWF0LnByb3RvdHlwZT1uZXcgZXQ7WWEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG90KHRoaXMuaCx0aGlzLmMsTWF0aC5taW4oMTAwLHRoaXMubCtJYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSl9LFlhLmRhcmtlcj1mdW5jdGlvbihuKXtyZXR1cm4gb3QodGhpcy5oLHRoaXMuYyxNYXRoLm1heCgwLHRoaXMubC1JYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSl9LFlhLnJnYj1mdW5jdGlvbigpe3JldHVybiBjdCh0aGlzLmgsdGhpcy5jLHRoaXMubCkucmdiKCl9LEdvLmxhYj1mdW5jdGlvbihuLHQsZSl7cmV0dXJuIDE9PT1hcmd1bWVudHMubGVuZ3RoP24gaW5zdGFuY2VvZiBsdD9zdChuLmwsbi5hLG4uYik6biBpbnN0YW5jZW9mIGF0P2N0KG4ubCxuLmMsbi5oKTp3dCgobj1Hby5yZ2IobikpLnIsbi5nLG4uYik6c3QoK24sK3QsK2UpfTt2YXIgSWE9MTgsWmE9Ljk1MDQ3LFZhPTEsJGE9MS4wODg4MyxYYT1sdC5wcm90b3R5cGU9bmV3IGV0O1hhLmJyaWdodGVyPWZ1bmN0aW9uKG4pe3JldHVybiBzdChNYXRoLm1pbigxMDAsdGhpcy5sK0lhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSxYYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIHN0KE1hdGgubWF4KDAsdGhpcy5sLUlhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSxYYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gZnQodGhpcy5sLHRoaXMuYSx0aGlzLmIpfSxHby5yZ2I9ZnVuY3Rpb24obix0LGUpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgeHQ/eXQobi5yLG4uZyxuLmIpOl90KCIiK24seXQsaXQpOnl0KH5+bix+fnQsfn5lKX07dmFyIEJhPXh0LnByb3RvdHlwZT1uZXcgZXQ7QmEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7bj1NYXRoLnBvdyguNyxhcmd1bWVudHMubGVuZ3RoP246MSk7dmFyIHQ9dGhpcy5yLGU9dGhpcy5nLHI9dGhpcy5iLHU9MzA7cmV0dXJuIHR8fGV8fHI/KHQmJnU+dCYmKHQ9dSksZSYmdT5lJiYoZT11KSxyJiZ1PnImJihyPXUpLHl0KE1hdGgubWluKDI1NSx+fih0L24pKSxNYXRoLm1pbigyNTUsfn4oZS9uKSksTWF0aC5taW4oMjU1LH5+KHIvbikpKSk6eXQodSx1LHUpfSxCYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLHl0KH5+KG4qdGhpcy5yKSx+fihuKnRoaXMuZyksfn4obip0aGlzLmIpKX0sQmEuaHNsPWZ1bmN0aW9uKCl7cmV0dXJuIGJ0KHRoaXMucix0aGlzLmcsdGhpcy5iKX0sQmEudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iIyIrTXQodGhpcy5yKStNdCh0aGlzLmcpK010KHRoaXMuYil9O3ZhciBKYT1Hby5tYXAoe2FsaWNlYmx1ZToxNTc5MjM4MyxhbnRpcXVld2hpdGU6MTY0NDQzNzUsYXF1YTo2NTUzNSxhcXVhbWFyaW5lOjgzODg1NjQsYXp1cmU6MTU3OTQxNzUsYmVpZ2U6MTYxMTkyNjAsYmlzcXVlOjE2NzcwMjQ0LGJsYWNrOjAsYmxhbmNoZWRhbG1vbmQ6MTY3NzIwNDUsYmx1ZToyNTUsYmx1ZXZpb2xldDo5MDU1MjAyLGJyb3duOjEwODI0MjM0LGJ1cmx5d29vZDoxNDU5NjIzMSxjYWRldGJsdWU6NjI2NjUyOCxjaGFydHJldXNlOjgzODgzNTIsY2hvY29sYXRlOjEzNzg5NDcwLGNvcmFsOjE2NzQ0MjcyLGNvcm5mbG93ZXJibHVlOjY1OTE5ODEsY29ybnNpbGs6MTY3NzUzODgsY3JpbXNvbjoxNDQyMzEwMCxjeWFuOjY1NTM1LGRhcmtibHVlOjEzOSxkYXJrY3lhbjozNTcyMyxkYXJrZ29sZGVucm9kOjEyMDkyOTM5LGRhcmtncmF5OjExMTE5MDE3LGRhcmtncmVlbjoyNTYwMCxkYXJrZ3JleToxMTExOTAxNyxkYXJra2hha2k6MTI0MzMyNTksZGFya21hZ2VudGE6OTEwOTY0MyxkYXJrb2xpdmVncmVlbjo1NTk3OTk5LGRhcmtvcmFuZ2U6MTY3NDc1MjAsZGFya29yY2hpZDoxMDA0MDAxMixkYXJrcmVkOjkxMDk1MDQsZGFya3NhbG1vbjoxNTMwODQxMCxkYXJrc2VhZ3JlZW46OTQxOTkxOSxkYXJrc2xhdGVibHVlOjQ3MzQzNDcsZGFya3NsYXRlZ3JheTozMTAwNDk1LGRhcmtzbGF0ZWdyZXk6MzEwMDQ5NSxkYXJrdHVycXVvaXNlOjUyOTQ1LGRhcmt2aW9sZXQ6OTY5OTUzOSxkZWVwcGluazoxNjcxNjk0NyxkZWVwc2t5Ymx1ZTo0OTE1MSxkaW1ncmF5OjY5MDgyNjUsZGltZ3JleTo2OTA4MjY1LGRvZGdlcmJsdWU6MjAwMzE5OSxmaXJlYnJpY2s6MTE2NzQxNDYsZmxvcmFsd2hpdGU6MTY3NzU5MjAsZm9yZXN0Z3JlZW46MjI2Mzg0MixmdWNoc2lhOjE2NzExOTM1LGdhaW5zYm9ybzoxNDQ3NDQ2MCxnaG9zdHdoaXRlOjE2MzE2NjcxLGdvbGQ6MTY3NjY3MjAsZ29sZGVucm9kOjE0MzI5MTIwLGdyYXk6ODQyMTUwNCxncmVlbjozMjc2OCxncmVlbnllbGxvdzoxMTQwMzA1NSxncmV5Ojg0MjE1MDQsaG9uZXlkZXc6MTU3OTQxNjAsaG90cGluazoxNjczODc0MCxpbmRpYW5yZWQ6MTM0NTg1MjQsaW5kaWdvOjQ5MTUzMzAsaXZvcnk6MTY3NzcyMDAsa2hha2k6MTU3ODc2NjAsbGF2ZW5kZXI6MTUxMzI0MTAsbGF2ZW5kZXJibHVzaDoxNjc3MzM2NSxsYXduZ3JlZW46ODE5MDk3NixsZW1vbmNoaWZmb246MTY3NzU4ODUsbGlnaHRibHVlOjExMzkzMjU0LGxpZ2h0Y29yYWw6MTU3NjE1MzYsbGlnaHRjeWFuOjE0NzQ1NTk5LGxpZ2h0Z29sZGVucm9keWVsbG93OjE2NDQ4MjEwLGxpZ2h0Z3JheToxMzg4MjMyMyxsaWdodGdyZWVuOjk0OTgyNTYsbGlnaHRncmV5OjEzODgyMzIzLGxpZ2h0cGluazoxNjc1ODQ2NSxsaWdodHNhbG1vbjoxNjc1Mjc2MixsaWdodHNlYWdyZWVuOjIxNDI4OTAsbGlnaHRza3libHVlOjg5MDAzNDYsbGlnaHRzbGF0ZWdyYXk6NzgzMzc1MyxsaWdodHNsYXRlZ3JleTo3ODMzNzUzLGxpZ2h0c3RlZWxibHVlOjExNTg0NzM0LGxpZ2h0eWVsbG93OjE2Nzc3MTg0LGxpbWU6NjUyODAsbGltZWdyZWVuOjMzMjkzMzAsbGluZW46MTY0NDU2NzAsbWFnZW50YToxNjcxMTkzNSxtYXJvb246ODM4ODYwOCxtZWRpdW1hcXVhbWFyaW5lOjY3MzczMjIsbWVkaXVtYmx1ZToyMDUsbWVkaXVtb3JjaGlkOjEyMjExNjY3LG1lZGl1bXB1cnBsZTo5NjYyNjgzLG1lZGl1bXNlYWdyZWVuOjM5NzgwOTcsbWVkaXVtc2xhdGVibHVlOjgwODc3OTAsbWVkaXVtc3ByaW5nZ3JlZW46NjQxNTQsbWVkaXVtdHVycXVvaXNlOjQ3NzIzMDAsbWVkaXVtdmlvbGV0cmVkOjEzMDQ3MTczLG1pZG5pZ2h0Ymx1ZToxNjQ0OTEyLG1pbnRjcmVhbToxNjEyMTg1MCxtaXN0eXJvc2U6MTY3NzAyNzMsbW9jY2FzaW46MTY3NzAyMjksbmF2YWpvd2hpdGU6MTY3Njg2ODUsbmF2eToxMjgsb2xkbGFjZToxNjY0MzU1OCxvbGl2ZTo4NDIxMzc2LG9saXZlZHJhYjo3MDQ4NzM5LG9yYW5nZToxNjc1MzkyMCxvcmFuZ2VyZWQ6MTY3MjkzNDQsb3JjaGlkOjE0MzE1NzM0LHBhbGVnb2xkZW5yb2Q6MTU2NTcxMzAscGFsZWdyZWVuOjEwMDI1ODgwLHBhbGV0dXJxdW9pc2U6MTE1Mjk5NjYscGFsZXZpb2xldHJlZDoxNDM4MTIwMyxwYXBheWF3aGlwOjE2NzczMDc3LHBlYWNocHVmZjoxNjc2NzY3MyxwZXJ1OjEzNDY4OTkxLHBpbms6MTY3NjEwMzUscGx1bToxNDUyNDYzNyxwb3dkZXJibHVlOjExNTkxOTEwLHB1cnBsZTo4Mzg4NzM2LHJlZDoxNjcxMTY4MCxyb3N5YnJvd246MTIzNTc1MTkscm95YWxibHVlOjQyODY5NDUsc2FkZGxlYnJvd246OTEyNzE4NyxzYWxtb246MTY0MTY4ODIsc2FuZHlicm93bjoxNjAzMjg2NCxzZWFncmVlbjozMDUwMzI3LHNlYXNoZWxsOjE2Nzc0NjM4LHNpZW5uYToxMDUwNjc5NyxzaWx2ZXI6MTI2MzIyNTYsc2t5Ymx1ZTo4OTAwMzMxLHNsYXRlYmx1ZTo2OTcwMDYxLHNsYXRlZ3JheTo3MzcyOTQ0LHNsYXRlZ3JleTo3MzcyOTQ0LHNub3c6MTY3NzU5MzAsc3ByaW5nZ3JlZW46NjU0MDcsc3RlZWxibHVlOjQ2MjA5ODAsdGFuOjEzODA4NzgwLHRlYWw6MzI4OTYsdGhpc3RsZToxNDIwNDg4OCx0b21hdG86MTY3MzcwOTUsdHVycXVvaXNlOjQyNTE4NTYsdmlvbGV0OjE1NjMxMDg2LHdoZWF0OjE2MTEzMzMxLHdoaXRlOjE2Nzc3MjE1LHdoaXRlc21va2U6MTYxMTkyODUseWVsbG93OjE2Nzc2OTYwLHllbGxvd2dyZWVuOjEwMTQ1MDc0fSk7SmEuZm9yRWFjaChmdW5jdGlvbihuLHQpe0phLnNldChuLGR0KHQpKX0pLEdvLmZ1bmN0b3I9RXQsR28ueGhyPUF0KE50KSxHby5kc3Y9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKG4sZSxpKXthcmd1bWVudHMubGVuZ3RoPDMmJihpPWUsZT1udWxsKTt2YXIgbz1DdChuLHQsbnVsbD09ZT9yOnUoZSksaSk7cmV0dXJuIG8ucm93PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP28ucmVzcG9uc2UobnVsbD09KGU9bik/cjp1KG4pKTplfSxvfWZ1bmN0aW9uIHIobil7cmV0dXJuIGUucGFyc2Uobi5yZXNwb25zZVRleHQpfWZ1bmN0aW9uIHUobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBlLnBhcnNlKHQucmVzcG9uc2VUZXh0LG4pfX1mdW5jdGlvbiBpKHQpe3JldHVybiB0Lm1hcChvKS5qb2luKG4pfWZ1bmN0aW9uIG8obil7cmV0dXJuIGEudGVzdChuKT8nIicrbi5yZXBsYWNlKC9cIi9nLCciIicpKyciJzpufXZhciBhPW5ldyBSZWdFeHAoJ1siJytuKyJcbl0iKSxjPW4uY2hhckNvZGVBdCgwKTtyZXR1cm4gZS5wYXJzZT1mdW5jdGlvbihuLHQpe3ZhciByO3JldHVybiBlLnBhcnNlUm93cyhuLGZ1bmN0aW9uKG4sZSl7aWYocilyZXR1cm4gcihuLGUtMSk7dmFyIHU9bmV3IEZ1bmN0aW9uKCJkIiwicmV0dXJuIHsiK24ubWFwKGZ1bmN0aW9uKG4sdCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KG4pKyI6IGRbIit0KyJdIn0pLmpvaW4oIiwiKSsifSIpO3I9dD9mdW5jdGlvbihuLGUpe3JldHVybiB0KHUobiksZSl9OnV9KX0sZS5wYXJzZVJvd3M9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKCl7aWYobD49cylyZXR1cm4gbztpZih1KXJldHVybiB1PSExLGk7dmFyIHQ9bDtpZigzND09PW4uY2hhckNvZGVBdCh0KSl7Zm9yKHZhciBlPXQ7ZSsrPHM7KWlmKDM0PT09bi5jaGFyQ29kZUF0KGUpKXtpZigzNCE9PW4uY2hhckNvZGVBdChlKzEpKWJyZWFrOysrZX1sPWUrMjt2YXIgcj1uLmNoYXJDb2RlQXQoZSsxKTtyZXR1cm4gMTM9PT1yPyh1PSEwLDEwPT09bi5jaGFyQ29kZUF0KGUrMikmJisrbCk6MTA9PT1yJiYodT0hMCksbi5zdWJzdHJpbmcodCsxLGUpLnJlcGxhY2UoLyIiL2csJyInKX1mb3IoO3M+bDspe3ZhciByPW4uY2hhckNvZGVBdChsKyspLGE9MTtpZigxMD09PXIpdT0hMDtlbHNlIGlmKDEzPT09cil1PSEwLDEwPT09bi5jaGFyQ29kZUF0KGwpJiYoKytsLCsrYSk7ZWxzZSBpZihyIT09Yyljb250aW51ZTtyZXR1cm4gbi5zdWJzdHJpbmcodCxsLWEpfXJldHVybiBuLnN1YnN0cmluZyh0KX1mb3IodmFyIHIsdSxpPXt9LG89e30sYT1bXSxzPW4ubGVuZ3RoLGw9MCxmPTA7KHI9ZSgpKSE9PW87KXtmb3IodmFyIGg9W107ciE9PWkmJnIhPT1vOyloLnB1c2gocikscj1lKCk7KCF0fHwoaD10KGgsZisrKSkpJiZhLnB1c2goaCl9cmV0dXJuIGF9LGUuZm9ybWF0PWZ1bmN0aW9uKHQpe2lmKEFycmF5LmlzQXJyYXkodFswXSkpcmV0dXJuIGUuZm9ybWF0Um93cyh0KTt2YXIgcj1uZXcgaCx1PVtdO3JldHVybiB0LmZvckVhY2goZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIG4pci5oYXModCl8fHUucHVzaChyLmFkZCh0KSl9KSxbdS5tYXAobykuam9pbihuKV0uY29uY2F0KHQubWFwKGZ1bmN0aW9uKHQpe3JldHVybiB1Lm1hcChmdW5jdGlvbihuKXtyZXR1cm4gbyh0W25dKX0pLmpvaW4obil9KSkuam9pbigiXG4iKX0sZS5mb3JtYXRSb3dzPWZ1bmN0aW9uKG4pe3JldHVybiBuLm1hcChpKS5qb2luKCJcbiIpfSxlfSxHby5jc3Y9R28uZHN2KCIsIiwidGV4dC9jc3YiKSxHby50c3Y9R28uZHN2KCIJIiwidGV4dC90YWItc2VwYXJhdGVkLXZhbHVlcyIpLEdvLnRvdWNoPWZ1bmN0aW9uKG4sdCxlKXtpZihhcmd1bWVudHMubGVuZ3RoPDMmJihlPXQsdD14KCkuY2hhbmdlZFRvdWNoZXMpLHQpZm9yKHZhciByLHU9MCxpPXQubGVuZ3RoO2k+dTsrK3UpaWYoKHI9dFt1XSkuaWRlbnRpZmllcj09PWUpcmV0dXJuIFoobixyKX07dmFyIFdhLEdhLEthLFFhLG5jLHRjPWVhW3AoZWEsInJlcXVlc3RBbmltYXRpb25GcmFtZSIpXXx8ZnVuY3Rpb24obil7c2V0VGltZW91dChuLDE3KX07R28udGltZXI9ZnVuY3Rpb24obix0LGUpe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg7Mj5yJiYodD0wKSwzPnImJihlPURhdGUubm93KCkpO3ZhciB1PWUrdCxpPXtjOm4sdDp1LGY6ITEsbjpudWxsfTtHYT9HYS5uPWk6V2E9aSxHYT1pLEthfHwoUWE9Y2xlYXJUaW1lb3V0KFFhKSxLYT0xLHRjKFR0KSl9LEdvLnRpbWVyLmZsdXNoPWZ1bmN0aW9uKCl7cXQoKSx6dCgpfSxHby5yb3VuZD1mdW5jdGlvbihuLHQpe3JldHVybiB0P01hdGgucm91bmQobioodD1NYXRoLnBvdygxMCx0KSkpL3Q6TWF0aC5yb3VuZChuKX07dmFyIGVjPVsieSIsInoiLCJhIiwiZiIsInAiLCJuIiwiXHhiNSIsIm0iLCIiLCJrIiwiTSIsIkciLCJUIiwiUCIsIkUiLCJaIiwiWSJdLm1hcChEdCk7R28uZm9ybWF0UHJlZml4PWZ1bmN0aW9uKG4sdCl7dmFyIGU9MDtyZXR1cm4gbiYmKDA+biYmKG4qPS0xKSx0JiYobj1Hby5yb3VuZChuLFJ0KG4sdCkpKSxlPTErTWF0aC5mbG9vcigxZS0xMitNYXRoLmxvZyhuKS9NYXRoLkxOMTApLGU9TWF0aC5tYXgoLTI0LE1hdGgubWluKDI0LDMqTWF0aC5mbG9vcigoZS0xKS8zKSkpKSxlY1s4K2UvM119O3ZhciByYz0vKD86KFtee10pPyhbPD49Xl0pKT8oWytcLSBdKT8oWyQjXSk/KDApPyhcZCspPygsKT8oXC4tP1xkKyk/KFthLXolXSk/L2ksdWM9R28ubWFwKHtiOmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDIpfSxjOmZ1bmN0aW9uKG4pe3JldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pfSxvOmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDgpfSx4OmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDE2KX0sWDpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX0sZzpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvUHJlY2lzaW9uKHQpfSxlOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4udG9FeHBvbmVudGlhbCh0KX0sZjpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvRml4ZWQodCl9LHI6ZnVuY3Rpb24obix0KXtyZXR1cm4obj1Hby5yb3VuZChuLFJ0KG4sdCkpKS50b0ZpeGVkKE1hdGgubWF4KDAsTWF0aC5taW4oMjAsUnQobiooMSsxZS0xNSksdCkpKSl9fSksaWM9R28udGltZT17fSxvYz1EYXRlO2p0LnByb3RvdHlwZT17Z2V0RGF0ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDRGF0ZSgpfSxnZXREYXk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0RheSgpfSxnZXRGdWxsWWVhcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDRnVsbFllYXIoKX0sZ2V0SG91cnM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0hvdXJzKCl9LGdldE1pbGxpc2Vjb25kczpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDTWlsbGlzZWNvbmRzKCl9LGdldE1pbnV0ZXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01pbnV0ZXMoKX0sZ2V0TW9udGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01vbnRoKCl9LGdldFNlY29uZHM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ1NlY29uZHMoKX0sZ2V0VGltZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VGltZSgpfSxnZXRUaW1lem9uZU9mZnNldDpmdW5jdGlvbigpe3JldHVybiAwfSx2YWx1ZU9mOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy52YWx1ZU9mKCl9LHNldERhdGU6ZnVuY3Rpb24oKXthYy5zZXRVVENEYXRlLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXREYXk6ZnVuY3Rpb24oKXthYy5zZXRVVENEYXkuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldEZ1bGxZZWFyOmZ1bmN0aW9uKCl7YWMuc2V0VVRDRnVsbFllYXIuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldEhvdXJzOmZ1bmN0aW9uKCl7YWMuc2V0VVRDSG91cnMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1pbGxpc2Vjb25kczpmdW5jdGlvbigpe2FjLnNldFVUQ01pbGxpc2Vjb25kcy5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX0sc2V0TWludXRlczpmdW5jdGlvbigpe2FjLnNldFVUQ01pbnV0ZXMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1vbnRoOmZ1bmN0aW9uKCl7YWMuc2V0VVRDTW9udGguYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldFNlY29uZHM6ZnVuY3Rpb24oKXthYy5zZXRVVENTZWNvbmRzLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRUaW1lOmZ1bmN0aW9uKCl7YWMuc2V0VGltZS5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX19O3ZhciBhYz1EYXRlLnByb3RvdHlwZTtpYy55ZWFyPUh0KGZ1bmN0aW9uKG4pe3JldHVybiBuPWljLmRheShuKSxuLnNldE1vbnRoKDAsMSksbn0sZnVuY3Rpb24obix0KXtuLnNldEZ1bGxZZWFyKG4uZ2V0RnVsbFllYXIoKSt0KX0sZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RnVsbFllYXIoKX0pLGljLnllYXJzPWljLnllYXIucmFuZ2UsaWMueWVhcnMudXRjPWljLnllYXIudXRjLnJhbmdlLGljLmRheT1IdChmdW5jdGlvbihuKXt2YXIgdD1uZXcgb2MoMmUzLDApO3JldHVybiB0LnNldEZ1bGxZZWFyKG4uZ2V0RnVsbFllYXIoKSxuLmdldE1vbnRoKCksbi5nZXREYXRlKCkpLHR9LGZ1bmN0aW9uKG4sdCl7bi5zZXREYXRlKG4uZ2V0RGF0ZSgpK3QpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXREYXRlKCktMX0pLGljLmRheXM9aWMuZGF5LnJhbmdlLGljLmRheXMudXRjPWljLmRheS51dGMucmFuZ2UsaWMuZGF5T2ZZZWFyPWZ1bmN0aW9uKG4pe3ZhciB0PWljLnllYXIobik7cmV0dXJuIE1hdGguZmxvb3IoKG4tdC02ZTQqKG4uZ2V0VGltZXpvbmVPZmZzZXQoKS10LmdldFRpbWV6b25lT2Zmc2V0KCkpKS84NjRlNSl9LFsic3VuZGF5IiwibW9uZGF5IiwidHVlc2RheSIsIndlZG5lc2RheSIsInRodXJzZGF5IiwiZnJpZGF5Iiwic2F0dXJkYXkiXS5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7dD03LXQ7dmFyIGU9aWNbbl09SHQoZnVuY3Rpb24obil7cmV0dXJuKG49aWMuZGF5KG4pKS5zZXREYXRlKG4uZ2V0RGF0ZSgpLShuLmdldERheSgpK3QpJTcpLG59LGZ1bmN0aW9uKG4sdCl7bi5zZXREYXRlKG4uZ2V0RGF0ZSgpKzcqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3ZhciBlPWljLnllYXIobikuZ2V0RGF5KCk7cmV0dXJuIE1hdGguZmxvb3IoKGljLmRheU9mWWVhcihuKSsoZSt0KSU3KS83KS0oZSE9PXQpfSk7aWNbbisicyJdPWUucmFuZ2UsaWNbbisicyJdLnV0Yz1lLnV0Yy5yYW5nZSxpY1tuKyJPZlllYXIiXT1mdW5jdGlvbihuKXt2YXIgZT1pYy55ZWFyKG4pLmdldERheSgpO3JldHVybiBNYXRoLmZsb29yKChpYy5kYXlPZlllYXIobikrKGUrdCklNykvNyl9fSksaWMud2Vlaz1pYy5zdW5kYXksaWMud2Vla3M9aWMuc3VuZGF5LnJhbmdlLGljLndlZWtzLnV0Yz1pYy5zdW5kYXkudXRjLnJhbmdlLGljLndlZWtPZlllYXI9aWMuc3VuZGF5T2ZZZWFyO3ZhciBjYz17Ii0iOiIiLF86IiAiLDA6IjAifSxzYz0vXlxzKlxkKy8sbGM9L14lLztHby5sb2NhbGU9ZnVuY3Rpb24obil7cmV0dXJue251bWJlckZvcm1hdDpQdChuKSx0aW1lRm9ybWF0Ok90KG4pfX07dmFyIGZjPUdvLmxvY2FsZSh7ZGVjaW1hbDoiLiIsdGhvdXNhbmRzOiIsIixncm91cGluZzpbM10sY3VycmVuY3k6WyIkIiwiIl0sZGF0ZVRpbWU6IiVhICViICVlICVYICVZIixkYXRlOiIlbS8lZC8lWSIsdGltZToiJUg6JU06JVMiLHBlcmlvZHM6WyJBTSIsIlBNIl0sZGF5czpbIlN1bmRheSIsIk1vbmRheSIsIlR1ZXNkYXkiLCJXZWRuZXNkYXkiLCJUaHVyc2RheSIsIkZyaWRheSIsIlNhdHVyZGF5Il0sc2hvcnREYXlzOlsiU3VuIiwiTW9uIiwiVHVlIiwiV2VkIiwiVGh1IiwiRnJpIiwiU2F0Il0sbW9udGhzOlsiSmFudWFyeSIsIkZlYnJ1YXJ5IiwiTWFyY2giLCJBcHJpbCIsIk1heSIsIkp1bmUiLCJKdWx5IiwiQXVndXN0IiwiU2VwdGVtYmVyIiwiT2N0b2JlciIsIk5vdmVtYmVyIiwiRGVjZW1iZXIiXSxzaG9ydE1vbnRoczpbIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdfSk7R28uZm9ybWF0PWZjLm51bWJlckZvcm1hdCxHby5nZW89e30sY2UucHJvdG90eXBlPXtzOjAsdDowLGFkZDpmdW5jdGlvbihuKXtzZShuLHRoaXMudCxoYyksc2UoaGMucyx0aGlzLnMsdGhpcyksdGhpcy5zP3RoaXMudCs9aGMudDp0aGlzLnM9aGMudH0scmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLnM9dGhpcy50PTB9LHZhbHVlT2Y6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zfX07dmFyIGhjPW5ldyBjZTtHby5nZW8uc3RyZWFtPWZ1bmN0aW9uKG4sdCl7biYmZ2MuaGFzT3duUHJvcGVydHkobi50eXBlKT9nY1tuLnR5cGVdKG4sdCk6bGUobix0KX07dmFyIGdjPXtGZWF0dXJlOmZ1bmN0aW9uKG4sdCl7bGUobi5nZW9tZXRyeSx0KX0sRmVhdHVyZUNvbGxlY3Rpb246ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9bi5mZWF0dXJlcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KWxlKGVbcl0uZ2VvbWV0cnksdCl9fSxwYz17U3BoZXJlOmZ1bmN0aW9uKG4sdCl7dC5zcGhlcmUoKX0sUG9pbnQ6ZnVuY3Rpb24obix0KXtuPW4uY29vcmRpbmF0ZXMsdC5wb2ludChuWzBdLG5bMV0sblsyXSl9LE11bHRpUG9pbnQ6ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9bi5jb29yZGluYXRlcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KW49ZVtyXSx0LnBvaW50KG5bMF0sblsxXSxuWzJdKX0sTGluZVN0cmluZzpmdW5jdGlvbihuLHQpe2ZlKG4uY29vcmRpbmF0ZXMsdCwwKX0sTXVsdGlMaW5lU3RyaW5nOmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciBlPW4uY29vcmRpbmF0ZXMscj0tMSx1PWUubGVuZ3RoOysrcjx1OylmZShlW3JdLHQsMCl9LFBvbHlnb246ZnVuY3Rpb24obix0KXtoZShuLmNvb3JkaW5hdGVzLHQpfSxNdWx0aVBvbHlnb246ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9bi5jb29yZGluYXRlcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KWhlKGVbcl0sdCl9LEdlb21ldHJ5Q29sbGVjdGlvbjpmdW5jdGlvbihuLHQpe2Zvcih2YXIgZT1uLmdlb21ldHJpZXMscj0tMSx1PWUubGVuZ3RoOysrcjx1OylsZShlW3JdLHQpfX07R28uZ2VvLmFyZWE9ZnVuY3Rpb24obil7cmV0dXJuIHZjPTAsR28uZ2VvLnN0cmVhbShuLG1jKSx2Y307dmFyIHZjLGRjPW5ldyBjZSxtYz17c3BoZXJlOmZ1bmN0aW9uKCl7dmMrPTQqQWF9LHBvaW50OnYsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe2RjLnJlc2V0KCksbWMubGluZVN0YXJ0PWdlfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7dmFyIG49MipkYzt2Yys9MD5uPzQqQWErbjpuLG1jLmxpbmVTdGFydD1tYy5saW5lRW5kPW1jLnBvaW50PXZ9fTtHby5nZW8uYm91bmRzPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHQpe3gucHVzaChNPVtsPW4saD1uXSksZj50JiYoZj10KSx0PmcmJihnPXQpfWZ1bmN0aW9uIHQodCxlKXt2YXIgcj1wZShbdCp6YSxlKnphXSk7aWYobSl7dmFyIHU9ZGUobSxyKSxpPVt1WzFdLC11WzBdLDBdLG89ZGUoaSx1KTt4ZShvKSxvPU1lKG8pO3ZhciBjPXQtcCxzPWM+MD8xOi0xLHY9b1swXSpSYSpzLGQ9ZmEoYyk+MTgwO2lmKGReKHY+cypwJiZzKnQ+dikpe3ZhciB5PW9bMV0qUmE7eT5nJiYoZz15KX1lbHNlIGlmKHY9KHYrMzYwKSUzNjAtMTgwLGReKHY+cypwJiZzKnQ+dikpe3ZhciB5PS1vWzFdKlJhO2Y+eSYmKGY9eSl9ZWxzZSBmPmUmJihmPWUpLGU+ZyYmKGc9ZSk7ZD9wPnQ/YShsLHQpPmEobCxoKSYmKGg9dCk6YSh0LGgpPmEobCxoKSYmKGw9dCk6aD49bD8obD50JiYobD10KSx0PmgmJihoPXQpKTp0PnA/YShsLHQpPmEobCxoKSYmKGg9dCk6YSh0LGgpPmEobCxoKSYmKGw9dCl9ZWxzZSBuKHQsZSk7bT1yLHA9dH1mdW5jdGlvbiBlKCl7Xy5wb2ludD10fWZ1bmN0aW9uIHIoKXtNWzBdPWwsTVsxXT1oLF8ucG9pbnQ9bixtPW51bGx9ZnVuY3Rpb24gdShuLGUpe2lmKG0pe3ZhciByPW4tcDt5Kz1mYShyKT4xODA/cisocj4wPzM2MDotMzYwKTpyfWVsc2Ugdj1uLGQ9ZTttYy5wb2ludChuLGUpLHQobixlKX1mdW5jdGlvbiBpKCl7bWMubGluZVN0YXJ0KCl9ZnVuY3Rpb24gbygpe3UodixkKSxtYy5saW5lRW5kKCksZmEoeSk+VGEmJihsPS0oaD0xODApKSxNWzBdPWwsTVsxXT1oLG09bnVsbH1mdW5jdGlvbiBhKG4sdCl7cmV0dXJuKHQtPW4pPDA/dCszNjA6dH1mdW5jdGlvbiBjKG4sdCl7cmV0dXJuIG5bMF0tdFswXX1mdW5jdGlvbiBzKG4sdCl7cmV0dXJuIHRbMF08PXRbMV0/dFswXTw9biYmbjw9dFsxXTpuPHRbMF18fHRbMV08bn12YXIgbCxmLGgsZyxwLHYsZCxtLHkseCxNLF89e3BvaW50Om4sbGluZVN0YXJ0OmUsbGluZUVuZDpyLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe18ucG9pbnQ9dSxfLmxpbmVTdGFydD1pLF8ubGluZUVuZD1vLHk9MCxtYy5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe21jLnBvbHlnb25FbmQoKSxfLnBvaW50PW4sXy5saW5lU3RhcnQ9ZSxfLmxpbmVFbmQ9ciwwPmRjPyhsPS0oaD0xODApLGY9LShnPTkwKSk6eT5UYT9nPTkwOi1UYT55JiYoZj0tOTApLE1bMF09bCxNWzFdPWgKfX07cmV0dXJuIGZ1bmN0aW9uKG4pe2c9aD0tKGw9Zj0xLzApLHg9W10sR28uZ2VvLnN0cmVhbShuLF8pO3ZhciB0PXgubGVuZ3RoO2lmKHQpe3guc29ydChjKTtmb3IodmFyIGUscj0xLHU9eFswXSxpPVt1XTt0PnI7KytyKWU9eFtyXSxzKGVbMF0sdSl8fHMoZVsxXSx1KT8oYSh1WzBdLGVbMV0pPmEodVswXSx1WzFdKSYmKHVbMV09ZVsxXSksYShlWzBdLHVbMV0pPmEodVswXSx1WzFdKSYmKHVbMF09ZVswXSkpOmkucHVzaCh1PWUpO2Zvcih2YXIgbyxlLHA9LTEvMCx0PWkubGVuZ3RoLTEscj0wLHU9aVt0XTt0Pj1yO3U9ZSwrK3IpZT1pW3JdLChvPWEodVsxXSxlWzBdKSk+cCYmKHA9byxsPWVbMF0saD11WzFdKX1yZXR1cm4geD1NPW51bGwsMS8wPT09bHx8MS8wPT09Zj9bWzAvMCwwLzBdLFswLzAsMC8wXV06W1tsLGZdLFtoLGddXX19KCksR28uZ2VvLmNlbnRyb2lkPWZ1bmN0aW9uKG4pe3ljPXhjPU1jPV9jPWJjPXdjPVNjPWtjPUVjPU5jPUFjPTAsR28uZ2VvLnN0cmVhbShuLENjKTt2YXIgdD1FYyxlPU5jLHI9QWMsdT10KnQrZSplK3IqcjtyZXR1cm4gcWE+dSYmKHQ9d2MsZT1TYyxyPWtjLFRhPnhjJiYodD1NYyxlPV9jLHI9YmMpLHU9dCp0K2UqZStyKnIscWE+dSk/WzAvMCwwLzBdOltNYXRoLmF0YW4yKGUsdCkqUmEsRyhyL01hdGguc3FydCh1KSkqUmFdfTt2YXIgeWMseGMsTWMsX2MsYmMsd2MsU2Msa2MsRWMsTmMsQWMsQ2M9e3NwaGVyZTp2LHBvaW50OmJlLGxpbmVTdGFydDpTZSxsaW5lRW5kOmtlLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe0NjLmxpbmVTdGFydD1FZX0scG9seWdvbkVuZDpmdW5jdGlvbigpe0NjLmxpbmVTdGFydD1TZX19LExjPVRlKE5lLFBlLGplLFstQWEsLUFhLzJdKSxUYz0xZTk7R28uZ2VvLmNsaXBFeHRlbnQ9ZnVuY3Rpb24oKXt2YXIgbix0LGUscix1LGksbz17c3RyZWFtOmZ1bmN0aW9uKG4pe3JldHVybiB1JiYodS52YWxpZD0hMSksdT1pKG4pLHUudmFsaWQ9ITAsdX0sZXh0ZW50OmZ1bmN0aW9uKGEpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPU9lKG49K2FbMF1bMF0sdD0rYVswXVsxXSxlPSthWzFdWzBdLHI9K2FbMV1bMV0pLHUmJih1LnZhbGlkPSExLHU9bnVsbCksbyk6W1tuLHRdLFtlLHJdXX19O3JldHVybiBvLmV4dGVudChbWzAsMF0sWzk2MCw1MDBdXSl9LChHby5nZW8uY29uaWNFcXVhbEFyZWE9ZnVuY3Rpb24oKXtyZXR1cm4gSWUoWmUpfSkucmF3PVplLEdvLmdlby5hbGJlcnM9ZnVuY3Rpb24oKXtyZXR1cm4gR28uZ2VvLmNvbmljRXF1YWxBcmVhKCkucm90YXRlKFs5NiwwXSkuY2VudGVyKFstLjYsMzguN10pLnBhcmFsbGVscyhbMjkuNSw0NS41XSkuc2NhbGUoMTA3MCl9LEdvLmdlby5hbGJlcnNVc2E9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3ZhciBpPW5bMF0sbz1uWzFdO3JldHVybiB0PW51bGwsZShpLG8pLHR8fChyKGksbyksdCl8fHUoaSxvKSx0fXZhciB0LGUscix1LGk9R28uZ2VvLmFsYmVycygpLG89R28uZ2VvLmNvbmljRXF1YWxBcmVhKCkucm90YXRlKFsxNTQsMF0pLmNlbnRlcihbLTIsNTguNV0pLnBhcmFsbGVscyhbNTUsNjVdKSxhPUdvLmdlby5jb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbMTU3LDBdKS5jZW50ZXIoWy0zLDE5LjldKS5wYXJhbGxlbHMoWzgsMThdKSxjPXtwb2ludDpmdW5jdGlvbihuLGUpe3Q9W24sZV19fTtyZXR1cm4gbi5pbnZlcnQ9ZnVuY3Rpb24obil7dmFyIHQ9aS5zY2FsZSgpLGU9aS50cmFuc2xhdGUoKSxyPShuWzBdLWVbMF0pL3QsdT0oblsxXS1lWzFdKS90O3JldHVybih1Pj0uMTImJi4yMzQ+dSYmcj49LS40MjUmJi0uMjE0PnI/bzp1Pj0uMTY2JiYuMjM0PnUmJnI+PS0uMjE0JiYtLjExNT5yP2E6aSkuaW52ZXJ0KG4pfSxuLnN0cmVhbT1mdW5jdGlvbihuKXt2YXIgdD1pLnN0cmVhbShuKSxlPW8uc3RyZWFtKG4pLHI9YS5zdHJlYW0obik7cmV0dXJue3BvaW50OmZ1bmN0aW9uKG4sdSl7dC5wb2ludChuLHUpLGUucG9pbnQobix1KSxyLnBvaW50KG4sdSl9LHNwaGVyZTpmdW5jdGlvbigpe3Quc3BoZXJlKCksZS5zcGhlcmUoKSxyLnNwaGVyZSgpfSxsaW5lU3RhcnQ6ZnVuY3Rpb24oKXt0LmxpbmVTdGFydCgpLGUubGluZVN0YXJ0KCksci5saW5lU3RhcnQoKX0sbGluZUVuZDpmdW5jdGlvbigpe3QubGluZUVuZCgpLGUubGluZUVuZCgpLHIubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25TdGFydCgpLGUucG9seWdvblN0YXJ0KCksci5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3QucG9seWdvbkVuZCgpLGUucG9seWdvbkVuZCgpLHIucG9seWdvbkVuZCgpfX19LG4ucHJlY2lzaW9uPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpLnByZWNpc2lvbih0KSxvLnByZWNpc2lvbih0KSxhLnByZWNpc2lvbih0KSxuKTppLnByZWNpc2lvbigpfSxuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpLnNjYWxlKHQpLG8uc2NhbGUoLjM1KnQpLGEuc2NhbGUodCksbi50cmFuc2xhdGUoaS50cmFuc2xhdGUoKSkpOmkuc2NhbGUoKX0sbi50cmFuc2xhdGU9ZnVuY3Rpb24odCl7aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGkudHJhbnNsYXRlKCk7dmFyIHM9aS5zY2FsZSgpLGw9K3RbMF0sZj0rdFsxXTtyZXR1cm4gZT1pLnRyYW5zbGF0ZSh0KS5jbGlwRXh0ZW50KFtbbC0uNDU1KnMsZi0uMjM4KnNdLFtsKy40NTUqcyxmKy4yMzgqc11dKS5zdHJlYW0oYykucG9pbnQscj1vLnRyYW5zbGF0ZShbbC0uMzA3KnMsZisuMjAxKnNdKS5jbGlwRXh0ZW50KFtbbC0uNDI1KnMrVGEsZisuMTIqcytUYV0sW2wtLjIxNCpzLVRhLGYrLjIzNCpzLVRhXV0pLnN0cmVhbShjKS5wb2ludCx1PWEudHJhbnNsYXRlKFtsLS4yMDUqcyxmKy4yMTIqc10pLmNsaXBFeHRlbnQoW1tsLS4yMTQqcytUYSxmKy4xNjYqcytUYV0sW2wtLjExNSpzLVRhLGYrLjIzNCpzLVRhXV0pLnN0cmVhbShjKS5wb2ludCxufSxuLnNjYWxlKDEwNzApfTt2YXIgcWMsemMsUmMsRGMsUGMsVWMsamM9e3BvaW50OnYsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3pjPTAsamMubGluZVN0YXJ0PVZlfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7amMubGluZVN0YXJ0PWpjLmxpbmVFbmQ9amMucG9pbnQ9dixxYys9ZmEoemMvMil9fSxIYz17cG9pbnQ6JGUsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDp2LHBvbHlnb25FbmQ6dn0sRmM9e3BvaW50OkplLGxpbmVTdGFydDpXZSxsaW5lRW5kOkdlLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe0ZjLmxpbmVTdGFydD1LZX0scG9seWdvbkVuZDpmdW5jdGlvbigpe0ZjLnBvaW50PUplLEZjLmxpbmVTdGFydD1XZSxGYy5saW5lRW5kPUdlfX07R28uZ2VvLnBhdGg9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3JldHVybiBuJiYoImZ1bmN0aW9uIj09dHlwZW9mIGEmJmkucG9pbnRSYWRpdXMoK2EuYXBwbHkodGhpcyxhcmd1bWVudHMpKSxvJiZvLnZhbGlkfHwobz11KGkpKSxHby5nZW8uc3RyZWFtKG4sbykpLGkucmVzdWx0KCl9ZnVuY3Rpb24gdCgpe3JldHVybiBvPW51bGwsbn12YXIgZSxyLHUsaSxvLGE9NC41O3JldHVybiBuLmFyZWE9ZnVuY3Rpb24obil7cmV0dXJuIHFjPTAsR28uZ2VvLnN0cmVhbShuLHUoamMpKSxxY30sbi5jZW50cm9pZD1mdW5jdGlvbihuKXtyZXR1cm4gTWM9X2M9YmM9d2M9U2M9a2M9RWM9TmM9QWM9MCxHby5nZW8uc3RyZWFtKG4sdShGYykpLEFjP1tFYy9BYyxOYy9BY106a2M/W3djL2tjLFNjL2tjXTpiYz9bTWMvYmMsX2MvYmNdOlswLzAsMC8wXX0sbi5ib3VuZHM9ZnVuY3Rpb24obil7cmV0dXJuIFBjPVVjPS0oUmM9RGM9MS8wKSxHby5nZW8uc3RyZWFtKG4sdShIYykpLFtbUmMsRGNdLFtQYyxVY11dfSxuLnByb2plY3Rpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9KGU9bik/bi5zdHJlYW18fHRyKG4pOk50LHQoKSk6ZX0sbi5jb250ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPW51bGw9PShyPW4pP25ldyBYZTpuZXcgUWUobiksImZ1bmN0aW9uIiE9dHlwZW9mIGEmJmkucG9pbnRSYWRpdXMoYSksdCgpKTpyfSxuLnBvaW50UmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6KGkucG9pbnRSYWRpdXMoK3QpLCt0KSxuKTphfSxuLnByb2plY3Rpb24oR28uZ2VvLmFsYmVyc1VzYSgpKS5jb250ZXh0KG51bGwpfSxHby5nZW8udHJhbnNmb3JtPWZ1bmN0aW9uKG4pe3JldHVybntzdHJlYW06ZnVuY3Rpb24odCl7dmFyIGU9bmV3IGVyKHQpO2Zvcih2YXIgciBpbiBuKWVbcl09bltyXTtyZXR1cm4gZX19fSxlci5wcm90b3R5cGU9e3BvaW50OmZ1bmN0aW9uKG4sdCl7dGhpcy5zdHJlYW0ucG9pbnQobix0KX0sc3BoZXJlOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLmxpbmVTdGFydCgpfSxsaW5lRW5kOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0ubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0aGlzLnN0cmVhbS5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLnBvbHlnb25FbmQoKX19LEdvLmdlby5wcm9qZWN0aW9uPXVyLEdvLmdlby5wcm9qZWN0aW9uTXV0YXRvcj1pciwoR28uZ2VvLmVxdWlyZWN0YW5ndWxhcj1mdW5jdGlvbigpe3JldHVybiB1cihhcil9KS5yYXc9YXIuaW52ZXJ0PWFyLEdvLmdlby5yb3RhdGlvbj1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KHQpe3JldHVybiB0PW4odFswXSp6YSx0WzFdKnphKSx0WzBdKj1SYSx0WzFdKj1SYSx0fXJldHVybiBuPXNyKG5bMF0lMzYwKnphLG5bMV0qemEsbi5sZW5ndGg+Mj9uWzJdKnphOjApLHQuaW52ZXJ0PWZ1bmN0aW9uKHQpe3JldHVybiB0PW4uaW52ZXJ0KHRbMF0qemEsdFsxXSp6YSksdFswXSo9UmEsdFsxXSo9UmEsdH0sdH0sY3IuaW52ZXJ0PWFyLEdvLmdlby5jaXJjbGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49ImZ1bmN0aW9uIj09dHlwZW9mIHI/ci5hcHBseSh0aGlzLGFyZ3VtZW50cyk6cix0PXNyKC1uWzBdKnphLC1uWzFdKnphLDApLmludmVydCx1PVtdO3JldHVybiBlKG51bGwsbnVsbCwxLHtwb2ludDpmdW5jdGlvbihuLGUpe3UucHVzaChuPXQobixlKSksblswXSo9UmEsblsxXSo9UmF9fSkse3R5cGU6IlBvbHlnb24iLGNvb3JkaW5hdGVzOlt1XX19dmFyIHQsZSxyPVswLDBdLHU9NjtyZXR1cm4gbi5vcmlnaW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxuLmFuZ2xlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPWdyKCh0PStyKSp6YSx1KnphKSxuKTp0fSxuLnByZWNpc2lvbj1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1ncih0KnphLCh1PStyKSp6YSksbik6dX0sbi5hbmdsZSg5MCl9LEdvLmdlby5kaXN0YW5jZT1mdW5jdGlvbihuLHQpe3ZhciBlLHI9KHRbMF0tblswXSkqemEsdT1uWzFdKnphLGk9dFsxXSp6YSxvPU1hdGguc2luKHIpLGE9TWF0aC5jb3MociksYz1NYXRoLnNpbih1KSxzPU1hdGguY29zKHUpLGw9TWF0aC5zaW4oaSksZj1NYXRoLmNvcyhpKTtyZXR1cm4gTWF0aC5hdGFuMihNYXRoLnNxcnQoKGU9ZipvKSplKyhlPXMqbC1jKmYqYSkqZSksYypsK3MqZiphKX0sR28uZ2VvLmdyYXRpY3VsZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXtyZXR1cm57dHlwZToiTXVsdGlMaW5lU3RyaW5nIixjb29yZGluYXRlczp0KCl9fWZ1bmN0aW9uIHQoKXtyZXR1cm4gR28ucmFuZ2UoTWF0aC5jZWlsKGkvZCkqZCx1LGQpLm1hcChoKS5jb25jYXQoR28ucmFuZ2UoTWF0aC5jZWlsKHMvbSkqbSxjLG0pLm1hcChnKSkuY29uY2F0KEdvLnJhbmdlKE1hdGguY2VpbChyL3ApKnAsZSxwKS5maWx0ZXIoZnVuY3Rpb24obil7cmV0dXJuIGZhKG4lZCk+VGF9KS5tYXAobCkpLmNvbmNhdChHby5yYW5nZShNYXRoLmNlaWwoYS92KSp2LG8sdikuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBmYShuJW0pPlRhfSkubWFwKGYpKX12YXIgZSxyLHUsaSxvLGEsYyxzLGwsZixoLGcscD0xMCx2PXAsZD05MCxtPTM2MCx5PTIuNTtyZXR1cm4gbi5saW5lcz1mdW5jdGlvbigpe3JldHVybiB0KCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybnt0eXBlOiJMaW5lU3RyaW5nIixjb29yZGluYXRlczpufX0pfSxuLm91dGxpbmU9ZnVuY3Rpb24oKXtyZXR1cm57dHlwZToiUG9seWdvbiIsY29vcmRpbmF0ZXM6W2goaSkuY29uY2F0KGcoYykuc2xpY2UoMSksaCh1KS5yZXZlcnNlKCkuc2xpY2UoMSksZyhzKS5yZXZlcnNlKCkuc2xpY2UoMSkpXX19LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JFeHRlbnQodCkubWlub3JFeHRlbnQodCk6bi5taW5vckV4dGVudCgpfSxuLm1ham9yRXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSt0WzBdWzBdLHU9K3RbMV1bMF0scz0rdFswXVsxXSxjPSt0WzFdWzFdLGk+dSYmKHQ9aSxpPXUsdT10KSxzPmMmJih0PXMscz1jLGM9dCksbi5wcmVjaXNpb24oeSkpOltbaSxzXSxbdSxjXV19LG4ubWlub3JFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9K3RbMF1bMF0sZT0rdFsxXVswXSxhPSt0WzBdWzFdLG89K3RbMV1bMV0scj5lJiYodD1yLHI9ZSxlPXQpLGE+byYmKHQ9YSxhPW8sbz10KSxuLnByZWNpc2lvbih5KSk6W1tyLGFdLFtlLG9dXX0sbi5zdGVwPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JTdGVwKHQpLm1pbm9yU3RlcCh0KTpuLm1pbm9yU3RlcCgpfSxuLm1ham9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZD0rdFswXSxtPSt0WzFdLG4pOltkLG1dfSxuLm1pbm9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD0rdFswXSx2PSt0WzFdLG4pOltwLHZdfSxuLnByZWNpc2lvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oeT0rdCxsPXZyKGEsbyw5MCksZj1kcihyLGUseSksaD12cihzLGMsOTApLGc9ZHIoaSx1LHkpLG4pOnl9LG4ubWFqb3JFeHRlbnQoW1stMTgwLC05MCtUYV0sWzE4MCw5MC1UYV1dKS5taW5vckV4dGVudChbWy0xODAsLTgwLVRhXSxbMTgwLDgwK1RhXV0pfSxHby5nZW8uZ3JlYXRBcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7cmV0dXJue3R5cGU6IkxpbmVTdHJpbmciLGNvb3JkaW5hdGVzOlt0fHxyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxlfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKV19fXZhciB0LGUscj1tcix1PXlyO3JldHVybiBuLmRpc3RhbmNlPWZ1bmN0aW9uKCl7cmV0dXJuIEdvLmdlby5kaXN0YW5jZSh0fHxyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxlfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9LG4uc291cmNlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPWUsdD0iZnVuY3Rpb24iPT10eXBlb2YgZT9udWxsOmUsbik6cn0sbi50YXJnZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9dCxlPSJmdW5jdGlvbiI9PXR5cGVvZiB0P251bGw6dCxuKTp1fSxuLnByZWNpc2lvbj1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP246MH0sbn0sR28uZ2VvLmludGVycG9sYXRlPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHhyKG5bMF0qemEsblsxXSp6YSx0WzBdKnphLHRbMV0qemEpfSxHby5nZW8ubGVuZ3RoPWZ1bmN0aW9uKG4pe3JldHVybiBPYz0wLEdvLmdlby5zdHJlYW0obixZYyksT2N9O3ZhciBPYyxZYz17c3BoZXJlOnYscG9pbnQ6dixsaW5lU3RhcnQ6TXIsbGluZUVuZDp2LHBvbHlnb25TdGFydDp2LHBvbHlnb25FbmQ6dn0sSWM9X3IoZnVuY3Rpb24obil7cmV0dXJuIE1hdGguc3FydCgyLygxK24pKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hc2luKG4vMil9KTsoR28uZ2VvLmF6aW11dGhhbEVxdWFsQXJlYT1mdW5jdGlvbigpe3JldHVybiB1cihJYyl9KS5yYXc9SWM7dmFyIFpjPV9yKGZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguYWNvcyhuKTtyZXR1cm4gdCYmdC9NYXRoLnNpbih0KX0sTnQpOyhHby5nZW8uYXppbXV0aGFsRXF1aWRpc3RhbnQ9ZnVuY3Rpb24oKXtyZXR1cm4gdXIoWmMpfSkucmF3PVpjLChHby5nZW8uY29uaWNDb25mb3JtYWw9ZnVuY3Rpb24oKXtyZXR1cm4gSWUoYnIpfSkucmF3PWJyLChHby5nZW8uY29uaWNFcXVpZGlzdGFudD1mdW5jdGlvbigpe3JldHVybiBJZSh3cil9KS5yYXc9d3I7dmFyIFZjPV9yKGZ1bmN0aW9uKG4pe3JldHVybiAxL259LE1hdGguYXRhbik7KEdvLmdlby5nbm9tb25pYz1mdW5jdGlvbigpe3JldHVybiB1cihWYyl9KS5yYXc9VmMsU3IuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7cmV0dXJuW24sMipNYXRoLmF0YW4oTWF0aC5leHAodCkpLUxhXX0sKEdvLmdlby5tZXJjYXRvcj1mdW5jdGlvbigpe3JldHVybiBrcihTcil9KS5yYXc9U3I7dmFyICRjPV9yKGZ1bmN0aW9uKCl7cmV0dXJuIDF9LE1hdGguYXNpbik7KEdvLmdlby5vcnRob2dyYXBoaWM9ZnVuY3Rpb24oKXtyZXR1cm4gdXIoJGMpfSkucmF3PSRjO3ZhciBYYz1fcihmdW5jdGlvbihuKXtyZXR1cm4gMS8oMStuKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hdGFuKG4pfSk7KEdvLmdlby5zdGVyZW9ncmFwaGljPWZ1bmN0aW9uKCl7cmV0dXJuIHVyKFhjKX0pLnJhdz1YYyxFci5pbnZlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm5bLXQsMipNYXRoLmF0YW4oTWF0aC5leHAobikpLUxhXX0sKEdvLmdlby50cmFuc3ZlcnNlTWVyY2F0b3I9ZnVuY3Rpb24oKXt2YXIgbj1rcihFciksdD1uLmNlbnRlcixlPW4ucm90YXRlO3JldHVybiBuLmNlbnRlcj1mdW5jdGlvbihuKXtyZXR1cm4gbj90KFstblsxXSxuWzBdXSk6KG49dCgpLFstblsxXSxuWzBdXSl9LG4ucm90YXRlPWZ1bmN0aW9uKG4pe3JldHVybiBuP2UoW25bMF0sblsxXSxuLmxlbmd0aD4yP25bMl0rOTA6OTBdKToobj1lKCksW25bMF0sblsxXSxuWzJdLTkwXSl9LG4ucm90YXRlKFswLDBdKX0pLnJhdz1FcixHby5nZW9tPXt9LEdvLmdlb20uaHVsbD1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe2lmKG4ubGVuZ3RoPDMpcmV0dXJuW107dmFyIHQsdT1FdChlKSxpPUV0KHIpLG89bi5sZW5ndGgsYT1bXSxjPVtdO2Zvcih0PTA7bz50O3QrKylhLnB1c2goWyt1LmNhbGwodGhpcyxuW3RdLHQpLCtpLmNhbGwodGhpcyxuW3RdLHQpLHRdKTtmb3IoYS5zb3J0KExyKSx0PTA7bz50O3QrKyljLnB1c2goW2FbdF1bMF0sLWFbdF1bMV1dKTt2YXIgcz1DcihhKSxsPUNyKGMpLGY9bFswXT09PXNbMF0saD1sW2wubGVuZ3RoLTFdPT09c1tzLmxlbmd0aC0xXSxnPVtdO2Zvcih0PXMubGVuZ3RoLTE7dD49MDstLXQpZy5wdXNoKG5bYVtzW3RdXVsyXV0pO2Zvcih0PStmO3Q8bC5sZW5ndGgtaDsrK3QpZy5wdXNoKG5bYVtsW3RdXVsyXV0pO3JldHVybiBnfXZhciBlPU5yLHI9QXI7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dChuKToodC54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPW4sdCk6ZX0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdCl9LEdvLmdlb20ucG9seWdvbj1mdW5jdGlvbihuKXtyZXR1cm4gZGEobixCYyksbn07dmFyIEJjPUdvLmdlb20ucG9seWdvbi5wcm90b3R5cGU9W107QmMuYXJlYT1mdW5jdGlvbigpe2Zvcih2YXIgbix0PS0xLGU9dGhpcy5sZW5ndGgscj10aGlzW2UtMV0sdT0wOysrdDxlOyluPXIscj10aGlzW3RdLHUrPW5bMV0qclswXS1uWzBdKnJbMV07cmV0dXJuLjUqdX0sQmMuY2VudHJvaWQ9ZnVuY3Rpb24obil7dmFyIHQsZSxyPS0xLHU9dGhpcy5sZW5ndGgsaT0wLG89MCxhPXRoaXNbdS0xXTtmb3IoYXJndW1lbnRzLmxlbmd0aHx8KG49LTEvKDYqdGhpcy5hcmVhKCkpKTsrK3I8dTspdD1hLGE9dGhpc1tyXSxlPXRbMF0qYVsxXS1hWzBdKnRbMV0saSs9KHRbMF0rYVswXSkqZSxvKz0odFsxXSthWzFdKSplO3JldHVybltpKm4sbypuXX0sQmMuY2xpcD1mdW5jdGlvbihuKXtmb3IodmFyIHQsZSxyLHUsaSxvLGE9enIobiksYz0tMSxzPXRoaXMubGVuZ3RoLXpyKHRoaXMpLGw9dGhpc1tzLTFdOysrYzxzOyl7Zm9yKHQ9bi5zbGljZSgpLG4ubGVuZ3RoPTAsdT10aGlzW2NdLGk9dFsocj10Lmxlbmd0aC1hKS0xXSxlPS0xOysrZTxyOylvPXRbZV0sVHIobyxsLHUpPyhUcihpLGwsdSl8fG4ucHVzaChxcihpLG8sbCx1KSksbi5wdXNoKG8pKTpUcihpLGwsdSkmJm4ucHVzaChxcihpLG8sbCx1KSksaT1vO2EmJm4ucHVzaChuWzBdKSxsPXV9cmV0dXJuIG59O3ZhciBKYyxXYyxHYyxLYyxRYyxucz1bXSx0cz1bXTtPci5wcm90b3R5cGUucHJlcGFyZT1mdW5jdGlvbigpe2Zvcih2YXIgbix0PXRoaXMuZWRnZXMsZT10Lmxlbmd0aDtlLS07KW49dFtlXS5lZGdlLG4uYiYmbi5hfHx0LnNwbGljZShlLDEpO3JldHVybiB0LnNvcnQoSXIpLHQubGVuZ3RofSxRci5wcm90b3R5cGU9e3N0YXJ0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWRnZS5sPT09dGhpcy5zaXRlP3RoaXMuZWRnZS5hOnRoaXMuZWRnZS5ifSxlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lZGdlLmw9PT10aGlzLnNpdGU/dGhpcy5lZGdlLmI6dGhpcy5lZGdlLmF9fSxudS5wcm90b3R5cGU9e2luc2VydDpmdW5jdGlvbihuLHQpe3ZhciBlLHIsdTtpZihuKXtpZih0LlA9bix0Lk49bi5OLG4uTiYmKG4uTi5QPXQpLG4uTj10LG4uUil7Zm9yKG49bi5SO24uTDspbj1uLkw7bi5MPXR9ZWxzZSBuLlI9dDtlPW59ZWxzZSB0aGlzLl8/KG49dXUodGhpcy5fKSx0LlA9bnVsbCx0Lk49bixuLlA9bi5MPXQsZT1uKToodC5QPXQuTj1udWxsLHRoaXMuXz10LGU9bnVsbCk7Zm9yKHQuTD10LlI9bnVsbCx0LlU9ZSx0LkM9ITAsbj10O2UmJmUuQzspcj1lLlUsZT09PXIuTD8odT1yLlIsdSYmdS5DPyhlLkM9dS5DPSExLHIuQz0hMCxuPXIpOihuPT09ZS5SJiYoZXUodGhpcyxlKSxuPWUsZT1uLlUpLGUuQz0hMSxyLkM9ITAscnUodGhpcyxyKSkpOih1PXIuTCx1JiZ1LkM/KGUuQz11LkM9ITEsci5DPSEwLG49cik6KG49PT1lLkwmJihydSh0aGlzLGUpLG49ZSxlPW4uVSksZS5DPSExLHIuQz0hMCxldSh0aGlzLHIpKSksZT1uLlU7dGhpcy5fLkM9ITF9LHJlbW92ZTpmdW5jdGlvbihuKXtuLk4mJihuLk4uUD1uLlApLG4uUCYmKG4uUC5OPW4uTiksbi5OPW4uUD1udWxsO3ZhciB0LGUscix1PW4uVSxpPW4uTCxvPW4uUjtpZihlPWk/bz91dShvKTppOm8sdT91Lkw9PT1uP3UuTD1lOnUuUj1lOnRoaXMuXz1lLGkmJm8/KHI9ZS5DLGUuQz1uLkMsZS5MPWksaS5VPWUsZSE9PW8/KHU9ZS5VLGUuVT1uLlUsbj1lLlIsdS5MPW4sZS5SPW8sby5VPWUpOihlLlU9dSx1PWUsbj1lLlIpKToocj1uLkMsbj1lKSxuJiYobi5VPXUpLCFyKXtpZihuJiZuLkMpcmV0dXJuIG4uQz0hMSx2b2lkIDA7ZG97aWYobj09PXRoaXMuXylicmVhaztpZihuPT09dS5MKXtpZih0PXUuUix0LkMmJih0LkM9ITEsdS5DPSEwLGV1KHRoaXMsdSksdD11LlIpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuUiYmdC5SLkN8fCh0LkwuQz0hMSx0LkM9ITAscnUodGhpcyx0KSx0PXUuUiksdC5DPXUuQyx1LkM9dC5SLkM9ITEsZXUodGhpcyx1KSxuPXRoaXMuXzticmVha319ZWxzZSBpZih0PXUuTCx0LkMmJih0LkM9ITEsdS5DPSEwLHJ1KHRoaXMsdSksdD11LkwpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuTCYmdC5MLkN8fCh0LlIuQz0hMSx0LkM9ITAsZXUodGhpcyx0KSx0PXUuTCksdC5DPXUuQyx1LkM9dC5MLkM9ITEscnUodGhpcyx1KSxuPXRoaXMuXzticmVha310LkM9ITAsbj11LHU9dS5VfXdoaWxlKCFuLkMpO24mJihuLkM9ITEpfX19LEdvLmdlb20udm9yb25vaT1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe3ZhciB0PW5ldyBBcnJheShuLmxlbmd0aCkscj1hWzBdWzBdLHU9YVswXVsxXSxpPWFbMV1bMF0sbz1hWzFdWzFdO3JldHVybiBpdShlKG4pLGEpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oZSxhKXt2YXIgYz1lLmVkZ2VzLHM9ZS5zaXRlLGw9dFthXT1jLmxlbmd0aD9jLm1hcChmdW5jdGlvbihuKXt2YXIgdD1uLnN0YXJ0KCk7cmV0dXJuW3QueCx0LnldfSk6cy54Pj1yJiZzLng8PWkmJnMueT49dSYmcy55PD1vP1tbcixvXSxbaSxvXSxbaSx1XSxbcix1XV06W107bC5wb2ludD1uW2FdfSksdH1mdW5jdGlvbiBlKG4pe3JldHVybiBuLm1hcChmdW5jdGlvbihuLHQpe3JldHVybnt4Ok1hdGgucm91bmQoaShuLHQpL1RhKSpUYSx5Ok1hdGgucm91bmQobyhuLHQpL1RhKSpUYSxpOnR9fSl9dmFyIHI9TnIsdT1BcixpPXIsbz11LGE9ZXM7cmV0dXJuIG4/dChuKToodC5saW5rcz1mdW5jdGlvbihuKXtyZXR1cm4gaXUoZShuKSkuZWRnZXMuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBuLmwmJm4ucn0pLm1hcChmdW5jdGlvbih0KXtyZXR1cm57c291cmNlOm5bdC5sLmldLHRhcmdldDpuW3Quci5pXX19KX0sdC50cmlhbmdsZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107cmV0dXJuIGl1KGUobikpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oZSxyKXtmb3IodmFyIHUsaSxvPWUuc2l0ZSxhPWUuZWRnZXMuc29ydChJciksYz0tMSxzPWEubGVuZ3RoLGw9YVtzLTFdLmVkZ2UsZj1sLmw9PT1vP2wucjpsLmw7KytjPHM7KXU9bCxpPWYsbD1hW2NdLmVkZ2UsZj1sLmw9PT1vP2wucjpsLmwscjxpLmkmJnI8Zi5pJiZhdShvLGksZik8MCYmdC5wdXNoKFtuW3JdLG5baS5pXSxuW2YuaV1dKX0pLHR9LHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1FdChyPW4pLHQpOnJ9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1FdCh1PW4pLHQpOnV9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1udWxsPT1uP2VzOm4sdCk6YT09PWVzP251bGw6YX0sdC5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3QuY2xpcEV4dGVudChuJiZbWzAsMF0sbl0pOmE9PT1lcz9udWxsOmEmJmFbMV19LHQpfTt2YXIgZXM9W1stMWU2LC0xZTZdLFsxZTYsMWU2XV07R28uZ2VvbS5kZWxhdW5heT1mdW5jdGlvbihuKXtyZXR1cm4gR28uZ2VvbS52b3Jvbm9pKCkudHJpYW5nbGVzKG4pfSxHby5nZW9tLnF1YWR0cmVlPWZ1bmN0aW9uKG4sdCxlLHIsdSl7ZnVuY3Rpb24gaShuKXtmdW5jdGlvbiBpKG4sdCxlLHIsdSxpLG8sYSl7aWYoIWlzTmFOKGUpJiYhaXNOYU4ocikpaWYobi5sZWFmKXt2YXIgYz1uLngsbD1uLnk7aWYobnVsbCE9YylpZihmYShjLWUpK2ZhKGwtcik8LjAxKXMobix0LGUscix1LGksbyxhKTtlbHNle3ZhciBmPW4ucG9pbnQ7bi54PW4ueT1uLnBvaW50PW51bGwscyhuLGYsYyxsLHUsaSxvLGEpLHMobix0LGUscix1LGksbyxhKX1lbHNlIG4ueD1lLG4ueT1yLG4ucG9pbnQ9dH1lbHNlIHMobix0LGUscix1LGksbyxhKX1mdW5jdGlvbiBzKG4sdCxlLHIsdSxvLGEsYyl7dmFyIHM9LjUqKHUrYSksbD0uNSoobytjKSxmPWU+PXMsaD1yPj1sLGc9KGg8PDEpK2Y7bi5sZWFmPSExLG49bi5ub2Rlc1tnXXx8KG4ubm9kZXNbZ109bHUoKSksZj91PXM6YT1zLGg/bz1sOmM9bCxpKG4sdCxlLHIsdSxvLGEsYyl9dmFyIGwsZixoLGcscCx2LGQsbSx5LHg9RXQoYSksTT1FdChjKTtpZihudWxsIT10KXY9dCxkPWUsbT1yLHk9dTtlbHNlIGlmKG09eT0tKHY9ZD0xLzApLGY9W10saD1bXSxwPW4ubGVuZ3RoLG8pZm9yKGc9MDtwPmc7KytnKWw9bltnXSxsLng8diYmKHY9bC54KSxsLnk8ZCYmKGQ9bC55KSxsLng+bSYmKG09bC54KSxsLnk+eSYmKHk9bC55KSxmLnB1c2gobC54KSxoLnB1c2gobC55KTtlbHNlIGZvcihnPTA7cD5nOysrZyl7dmFyIF89K3gobD1uW2ddLGcpLGI9K00obCxnKTt2Pl8mJih2PV8pLGQ+YiYmKGQ9YiksXz5tJiYobT1fKSxiPnkmJih5PWIpLGYucHVzaChfKSxoLnB1c2goYil9dmFyIHc9bS12LFM9eS1kO3c+Uz95PWQrdzptPXYrUzt2YXIgaz1sdSgpO2lmKGsuYWRkPWZ1bmN0aW9uKG4pe2koayxuLCt4KG4sKytnKSwrTShuLGcpLHYsZCxtLHkpfSxrLnZpc2l0PWZ1bmN0aW9uKG4pe2Z1KG4sayx2LGQsbSx5KX0sZz0tMSxudWxsPT10KXtmb3IoOysrZzxwOylpKGssbltnXSxmW2ddLGhbZ10sdixkLG0seSk7LS1nfWVsc2Ugbi5mb3JFYWNoKGsuYWRkKTtyZXR1cm4gZj1oPW49bD1udWxsLGt9dmFyIG8sYT1OcixjPUFyO3JldHVybihvPWFyZ3VtZW50cy5sZW5ndGgpPyhhPWN1LGM9c3UsMz09PW8mJih1PWUscj10LGU9dD0wKSxpKG4pKTooaS54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPW4saSk6YX0saS55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4saSk6Y30saS5leHRlbnQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG51bGw9PW4/dD1lPXI9dT1udWxsOih0PStuWzBdWzBdLGU9K25bMF1bMV0scj0rblsxXVswXSx1PStuWzFdWzFdKSxpKTpudWxsPT10P251bGw6W1t0LGVdLFtyLHVdXX0saS5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhudWxsPT1uP3Q9ZT1yPXU9bnVsbDoodD1lPTAscj0rblswXSx1PStuWzFdKSxpKTpudWxsPT10P251bGw6W3ItdCx1LWVdfSxpKX0sR28uaW50ZXJwb2xhdGVSZ2I9aHUsR28uaW50ZXJwb2xhdGVPYmplY3Q9Z3UsR28uaW50ZXJwb2xhdGVOdW1iZXI9cHUsR28uaW50ZXJwb2xhdGVTdHJpbmc9dnU7dmFyIHJzPS9bLStdPyg/OlxkK1wuP1xkKnxcLj9cZCspKD86W2VFXVstK10/XGQrKT8vZztHby5pbnRlcnBvbGF0ZT1kdSxHby5pbnRlcnBvbGF0b3JzPVtmdW5jdGlvbihuLHQpe3ZhciBlPXR5cGVvZiB0O3JldHVybigic3RyaW5nIj09PWU/SmEuaGFzKHQpfHwvXigjfHJnYlwofGhzbFwoKS8udGVzdCh0KT9odTp2dTp0IGluc3RhbmNlb2YgZXQ/aHU6QXJyYXkuaXNBcnJheSh0KT9tdToib2JqZWN0Ij09PWUmJmlzTmFOKHQpP2d1OnB1KShuLHQpfV0sR28uaW50ZXJwb2xhdGVBcnJheT1tdTt2YXIgdXM9ZnVuY3Rpb24oKXtyZXR1cm4gTnR9LGlzPUdvLm1hcCh7bGluZWFyOnVzLHBvbHk6U3UscXVhZDpmdW5jdGlvbigpe3JldHVybiBfdX0sY3ViaWM6ZnVuY3Rpb24oKXtyZXR1cm4gYnV9LHNpbjpmdW5jdGlvbigpe3JldHVybiBrdX0sZXhwOmZ1bmN0aW9uKCl7cmV0dXJuIEV1fSxjaXJjbGU6ZnVuY3Rpb24oKXtyZXR1cm4gTnV9LGVsYXN0aWM6QXUsYmFjazpDdSxib3VuY2U6ZnVuY3Rpb24oKXtyZXR1cm4gTHV9fSksb3M9R28ubWFwKHsiaW4iOk50LG91dDp4dSwiaW4tb3V0IjpNdSwib3V0LWluIjpmdW5jdGlvbihuKXtyZXR1cm4gTXUoeHUobikpfX0pO0dvLmVhc2U9ZnVuY3Rpb24obil7dmFyIHQ9bi5pbmRleE9mKCItIiksZT10Pj0wP24uc3Vic3RyaW5nKDAsdCk6bixyPXQ+PTA/bi5zdWJzdHJpbmcodCsxKToiaW4iO3JldHVybiBlPWlzLmdldChlKXx8dXMscj1vcy5nZXQocil8fE50LHl1KHIoZS5hcHBseShudWxsLEtvLmNhbGwoYXJndW1lbnRzLDEpKSkpfSxHby5pbnRlcnBvbGF0ZUhjbD1UdSxHby5pbnRlcnBvbGF0ZUhzbD1xdSxHby5pbnRlcnBvbGF0ZUxhYj16dSxHby5pbnRlcnBvbGF0ZVJvdW5kPVJ1LEdvLnRyYW5zZm9ybT1mdW5jdGlvbihuKXt2YXIgdD1uYS5jcmVhdGVFbGVtZW50TlMoR28ubnMucHJlZml4LnN2ZywiZyIpO3JldHVybihHby50cmFuc2Zvcm09ZnVuY3Rpb24obil7aWYobnVsbCE9bil7dC5zZXRBdHRyaWJ1dGUoInRyYW5zZm9ybSIsbik7dmFyIGU9dC50cmFuc2Zvcm0uYmFzZVZhbC5jb25zb2xpZGF0ZSgpfXJldHVybiBuZXcgRHUoZT9lLm1hdHJpeDphcyl9KShuKX0sRHUucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuInRyYW5zbGF0ZSgiK3RoaXMudHJhbnNsYXRlKyIpcm90YXRlKCIrdGhpcy5yb3RhdGUrIilza2V3WCgiK3RoaXMuc2tldysiKXNjYWxlKCIrdGhpcy5zY2FsZSsiKSJ9O3ZhciBhcz17YToxLGI6MCxjOjAsZDoxLGU6MCxmOjB9O0dvLmludGVycG9sYXRlVHJhbnNmb3JtPUh1LEdvLmxheW91dD17fSxHby5sYXlvdXQuYnVuZGxlPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKG4pe2Zvcih2YXIgdD1bXSxlPS0xLHI9bi5sZW5ndGg7KytlPHI7KXQucHVzaChZdShuW2VdKSk7cmV0dXJuIHR9fSxHby5sYXlvdXQuY2hvcmQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG4scyxmLGgsZyxwPXt9LHY9W10sZD1Hby5yYW5nZShpKSxtPVtdO2ZvcihlPVtdLHI9W10sbj0wLGg9LTE7KytoPGk7KXtmb3Iocz0wLGc9LTE7KytnPGk7KXMrPXVbaF1bZ107di5wdXNoKHMpLG0ucHVzaChHby5yYW5nZShpKSksbis9c31mb3IobyYmZC5zb3J0KGZ1bmN0aW9uKG4sdCl7cmV0dXJuIG8odltuXSx2W3RdKX0pLGEmJm0uZm9yRWFjaChmdW5jdGlvbihuLHQpe24uc29ydChmdW5jdGlvbihuLGUpe3JldHVybiBhKHVbdF1bbl0sdVt0XVtlXSl9KX0pLG49KENhLWwqaSkvbixzPTAsaD0tMTsrK2g8aTspe2ZvcihmPXMsZz0tMTsrK2c8aTspe3ZhciB5PWRbaF0seD1tW3ldW2ddLE09dVt5XVt4XSxfPXMsYj1zKz1NKm47cFt5KyItIit4XT17aW5kZXg6eSxzdWJpbmRleDp4LHN0YXJ0QW5nbGU6XyxlbmRBbmdsZTpiLHZhbHVlOk19fXJbeV09e2luZGV4Onksc3RhcnRBbmdsZTpmLGVuZEFuZ2xlOnMsdmFsdWU6KHMtZikvbn0scys9bH1mb3IoaD0tMTsrK2g8aTspZm9yKGc9aC0xOysrZzxpOyl7dmFyIHc9cFtoKyItIitnXSxTPXBbZysiLSIraF07KHcudmFsdWV8fFMudmFsdWUpJiZlLnB1c2gody52YWx1ZTxTLnZhbHVlP3tzb3VyY2U6Uyx0YXJnZXQ6d306e3NvdXJjZTp3LHRhcmdldDpTfSl9YyYmdCgpfWZ1bmN0aW9uIHQoKXtlLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gYygobi5zb3VyY2UudmFsdWUrbi50YXJnZXQudmFsdWUpLzIsKHQuc291cmNlLnZhbHVlK3QudGFyZ2V0LnZhbHVlKS8yKX0pfXZhciBlLHIsdSxpLG8sYSxjLHM9e30sbD0wO3JldHVybiBzLm1hdHJpeD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT0odT1uKSYmdS5sZW5ndGgsZT1yPW51bGwscyk6dX0scy5wYWRkaW5nPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhsPW4sZT1yPW51bGwscyk6bH0scy5zb3J0R3JvdXBzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPW4sZT1yPW51bGwscyk6b30scy5zb3J0U3ViZ3JvdXBzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPW4sZT1udWxsLHMpOmF9LHMuc29ydENob3Jkcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz1uLGUmJnQoKSxzKTpjfSxzLmNob3Jkcz1mdW5jdGlvbigpe3JldHVybiBlfHxuKCksZX0scy5ncm91cHM9ZnVuY3Rpb24oKXtyZXR1cm4gcnx8bigpLHJ9LHN9LEdvLmxheW91dC5mb3JjZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obil7cmV0dXJuIGZ1bmN0aW9uKHQsZSxyLHUpe2lmKHQucG9pbnQhPT1uKXt2YXIgaT10LmN4LW4ueCxvPXQuY3ktbi55LGE9dS1lLGM9aSppK28qbztpZihjPmEqYS9kKXtpZihwPmMpe3ZhciBzPXQuY2hhcmdlL2M7bi5weC09aSpzLG4ucHktPW8qc31yZXR1cm4hMH1pZih0LnBvaW50JiZjJiZwPmMpe3ZhciBzPXQucG9pbnRDaGFyZ2UvYztuLnB4LT1pKnMsbi5weS09bypzfX1yZXR1cm4hdC5jaGFyZ2V9fWZ1bmN0aW9uIHQobil7bi5weD1Hby5ldmVudC54LG4ucHk9R28uZXZlbnQueSxhLnJlc3VtZSgpfXZhciBlLHIsdSxpLG8sYT17fSxjPUdvLmRpc3BhdGNoKCJzdGFydCIsInRpY2siLCJlbmQiKSxzPVsxLDFdLGw9LjksZj1jcyxoPXNzLGc9LTMwLHA9bHMsdj0uMSxkPS42NCxtPVtdLHk9W107cmV0dXJuIGEudGljaz1mdW5jdGlvbigpe2lmKChyKj0uOTkpPC4wMDUpcmV0dXJuIGMuZW5kKHt0eXBlOiJlbmQiLGFscGhhOnI9MH0pLCEwO3ZhciB0LGUsYSxmLGgscCxkLHgsTSxfPW0ubGVuZ3RoLGI9eS5sZW5ndGg7Zm9yKGU9MDtiPmU7KytlKWE9eVtlXSxmPWEuc291cmNlLGg9YS50YXJnZXQseD1oLngtZi54LE09aC55LWYueSwocD14KngrTSpNKSYmKHA9cippW2VdKigocD1NYXRoLnNxcnQocCkpLXVbZV0pL3AseCo9cCxNKj1wLGgueC09eCooZD1mLndlaWdodC8oaC53ZWlnaHQrZi53ZWlnaHQpKSxoLnktPU0qZCxmLngrPXgqKGQ9MS1kKSxmLnkrPU0qZCk7aWYoKGQ9cip2KSYmKHg9c1swXS8yLE09c1sxXS8yLGU9LTEsZCkpZm9yKDsrK2U8XzspYT1tW2VdLGEueCs9KHgtYS54KSpkLGEueSs9KE0tYS55KSpkO2lmKGcpZm9yKEp1KHQ9R28uZ2VvbS5xdWFkdHJlZShtKSxyLG8pLGU9LTE7KytlPF87KShhPW1bZV0pLmZpeGVkfHx0LnZpc2l0KG4oYSkpO2ZvcihlPS0xOysrZTxfOylhPW1bZV0sYS5maXhlZD8oYS54PWEucHgsYS55PWEucHkpOihhLngtPShhLnB4LShhLnB4PWEueCkpKmwsYS55LT0oYS5weS0oYS5weT1hLnkpKSpsKTtjLnRpY2soe3R5cGU6InRpY2siLGFscGhhOnJ9KX0sYS5ub2Rlcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obT1uLGEpOm19LGEubGlua3M9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHk9bixhKTp5fSxhLnNpemU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bixhKTpzfSxhLmxpbmtEaXN0YW5jZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZj0iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOituLGEpOmZ9LGEuZGlzdGFuY2U9YS5saW5rRGlzdGFuY2UsYS5saW5rU3RyZW5ndGg9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGg9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bjorbixhKTpofSxhLmZyaWN0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhsPStuLGEpOmx9LGEuY2hhcmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPSJmdW5jdGlvbiI9PXR5cGVvZiBuP246K24sYSk6Z30sYS5jaGFyZ2VEaXN0YW5jZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD1uKm4sYSk6TWF0aC5zcXJ0KHApfSxhLmdyYXZpdHk9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHY9K24sYSk6dn0sYS50aGV0YT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZD1uKm4sYSk6TWF0aC5zcXJ0KGQpfSxhLmFscGhhPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuPStuLHI/cj1uPjA/bjowOm4+MCYmKGMuc3RhcnQoe3R5cGU6InN0YXJ0IixhbHBoYTpyPW59KSxHby50aW1lcihhLnRpY2spKSxhKTpyfSxhLnN0YXJ0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHIpe2lmKCFlKXtmb3IoZT1uZXcgQXJyYXkoYyksYT0wO2M+YTsrK2EpZVthXT1bXTtmb3IoYT0wO3M+YTsrK2Epe3ZhciB1PXlbYV07ZVt1LnNvdXJjZS5pbmRleF0ucHVzaCh1LnRhcmdldCksZVt1LnRhcmdldC5pbmRleF0ucHVzaCh1LnNvdXJjZSl9fWZvcih2YXIgaSxvPWVbdF0sYT0tMSxzPW8ubGVuZ3RoOysrYTxzOylpZighaXNOYU4oaT1vW2FdW25dKSlyZXR1cm4gaTtyZXR1cm4gTWF0aC5yYW5kb20oKSpyfXZhciB0LGUscixjPW0ubGVuZ3RoLGw9eS5sZW5ndGgscD1zWzBdLHY9c1sxXTtmb3IodD0wO2M+dDsrK3QpKHI9bVt0XSkuaW5kZXg9dCxyLndlaWdodD0wO2Zvcih0PTA7bD50OysrdClyPXlbdF0sIm51bWJlciI9PXR5cGVvZiByLnNvdXJjZSYmKHIuc291cmNlPW1bci5zb3VyY2VdKSwibnVtYmVyIj09dHlwZW9mIHIudGFyZ2V0JiYoci50YXJnZXQ9bVtyLnRhcmdldF0pLCsrci5zb3VyY2Uud2VpZ2h0LCsrci50YXJnZXQud2VpZ2h0O2Zvcih0PTA7Yz50OysrdClyPW1bdF0saXNOYU4oci54KSYmKHIueD1uKCJ4IixwKSksaXNOYU4oci55KSYmKHIueT1uKCJ5Iix2KSksaXNOYU4oci5weCkmJihyLnB4PXIueCksaXNOYU4oci5weSkmJihyLnB5PXIueSk7aWYodT1bXSwiZnVuY3Rpb24iPT10eXBlb2YgZilmb3IodD0wO2w+dDsrK3QpdVt0XT0rZi5jYWxsKHRoaXMseVt0XSx0KTtlbHNlIGZvcih0PTA7bD50OysrdCl1W3RdPWY7aWYoaT1bXSwiZnVuY3Rpb24iPT10eXBlb2YgaClmb3IodD0wO2w+dDsrK3QpaVt0XT0raC5jYWxsKHRoaXMseVt0XSx0KTtlbHNlIGZvcih0PTA7bD50OysrdClpW3RdPWg7aWYobz1bXSwiZnVuY3Rpb24iPT10eXBlb2YgZylmb3IodD0wO2M+dDsrK3Qpb1t0XT0rZy5jYWxsKHRoaXMsbVt0XSx0KTtlbHNlIGZvcih0PTA7Yz50OysrdClvW3RdPWc7cmV0dXJuIGEucmVzdW1lKCl9LGEucmVzdW1lPWZ1bmN0aW9uKCl7cmV0dXJuIGEuYWxwaGEoLjEpfSxhLnN0b3A9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hbHBoYSgwKX0sYS5kcmFnPWZ1bmN0aW9uKCl7cmV0dXJuIGV8fChlPUdvLmJlaGF2aW9yLmRyYWcoKS5vcmlnaW4oTnQpLm9uKCJkcmFnc3RhcnQuZm9yY2UiLFZ1KS5vbigiZHJhZy5mb3JjZSIsdCkub24oImRyYWdlbmQuZm9yY2UiLCR1KSksYXJndW1lbnRzLmxlbmd0aD8odGhpcy5vbigibW91c2VvdmVyLmZvcmNlIixYdSkub24oIm1vdXNlb3V0LmZvcmNlIixCdSkuY2FsbChlKSx2b2lkIDApOmV9LEdvLnJlYmluZChhLGMsIm9uIil9O3ZhciBjcz0yMCxzcz0xLGxzPTEvMDtHby5sYXlvdXQuaGllcmFyY2h5PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbih0LG8sYSl7dmFyIGM9dS5jYWxsKGUsdCxvKTtpZih0LmRlcHRoPW8sYS5wdXNoKHQpLGMmJihzPWMubGVuZ3RoKSl7Zm9yKHZhciBzLGwsZj0tMSxoPXQuY2hpbGRyZW49bmV3IEFycmF5KHMpLGc9MCxwPW8rMTsrK2Y8czspbD1oW2ZdPW4oY1tmXSxwLGEpLGwucGFyZW50PXQsZys9bC52YWx1ZTtyJiZoLnNvcnQociksaSYmKHQudmFsdWU9Zyl9ZWxzZSBkZWxldGUgdC5jaGlsZHJlbixpJiYodC52YWx1ZT0raS5jYWxsKGUsdCxvKXx8MCk7cmV0dXJuIHR9ZnVuY3Rpb24gdChuLHIpe3ZhciB1PW4uY2hpbGRyZW4sbz0wO2lmKHUmJihhPXUubGVuZ3RoKSlmb3IodmFyIGEsYz0tMSxzPXIrMTsrK2M8YTspbys9dCh1W2NdLHMpO2Vsc2UgaSYmKG89K2kuY2FsbChlLG4scil8fDApO3JldHVybiBpJiYobi52YWx1ZT1vKSxvfWZ1bmN0aW9uIGUodCl7dmFyIGU9W107cmV0dXJuIG4odCwwLGUpLGV9dmFyIHI9UXUsdT1HdSxpPUt1O3JldHVybiBlLnNvcnQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9bixlKTpyfSxlLmNoaWxkcmVuPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sZSk6dX0sZS52YWx1ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLGUpOml9LGUucmV2YWx1ZT1mdW5jdGlvbihuKXtyZXR1cm4gdChuLDApLG59LGV9LEdvLmxheW91dC5wYXJ0aXRpb249ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKHQsZSxyLHUpe3ZhciBpPXQuY2hpbGRyZW47aWYodC54PWUsdC55PXQuZGVwdGgqdSx0LmR4PXIsdC5keT11LGkmJihvPWkubGVuZ3RoKSl7dmFyIG8sYSxjLHM9LTE7Zm9yKHI9dC52YWx1ZT9yL3QudmFsdWU6MDsrK3M8bzspbihhPWlbc10sZSxjPWEudmFsdWUqcix1KSxlKz1jfX1mdW5jdGlvbiB0KG4pe3ZhciBlPW4uY2hpbGRyZW4scj0wO2lmKGUmJih1PWUubGVuZ3RoKSlmb3IodmFyIHUsaT0tMTsrK2k8dTspcj1NYXRoLm1heChyLHQoZVtpXSkpO3JldHVybiAxK3J9ZnVuY3Rpb24gZShlLGkpe3ZhciBvPXIuY2FsbCh0aGlzLGUsaSk7cmV0dXJuIG4ob1swXSwwLHVbMF0sdVsxXS90KG9bMF0pKSxvfXZhciByPUdvLmxheW91dC5oaWVyYXJjaHkoKSx1PVsxLDFdO3JldHVybiBlLnNpemU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bixlKTp1fSxXdShlLHIpfSxHby5sYXlvdXQucGllPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihpKXt2YXIgbz1pLm1hcChmdW5jdGlvbihlLHIpe3JldHVybit0LmNhbGwobixlLHIpfSksYT0rKCJmdW5jdGlvbiI9PXR5cGVvZiByP3IuYXBwbHkodGhpcyxhcmd1bWVudHMpOnIpLGM9KCgiZnVuY3Rpb24iPT10eXBlb2YgdT91LmFwcGx5KHRoaXMsYXJndW1lbnRzKTp1KS1hKS9Hby5zdW0obykscz1Hby5yYW5nZShpLmxlbmd0aCk7bnVsbCE9ZSYmcy5zb3J0KGU9PT1mcz9mdW5jdGlvbihuLHQpe3JldHVybiBvW3RdLW9bbl19OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIGUoaVtuXSxpW3RdKX0pO3ZhciBsPVtdO3JldHVybiBzLmZvckVhY2goZnVuY3Rpb24obil7dmFyIHQ7bFtuXT17ZGF0YTppW25dLHZhbHVlOnQ9b1tuXSxzdGFydEFuZ2xlOmEsZW5kQW5nbGU6YSs9dCpjfX0pLGx9dmFyIHQ9TnVtYmVyLGU9ZnMscj0wLHU9Q2E7cmV0dXJuIG4udmFsdWU9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ZSxuKTp0fSxuLnNvcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLnN0YXJ0QW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxuLmVuZEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PXQsbik6dX0sbn07dmFyIGZzPXt9O0dvLmxheW91dC5zdGFjaz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oYSxjKXt2YXIgcz1hLm1hcChmdW5jdGlvbihlLHIpe3JldHVybiB0LmNhbGwobixlLHIpfSksbD1zLm1hcChmdW5jdGlvbih0KXtyZXR1cm4gdC5tYXAoZnVuY3Rpb24odCxlKXtyZXR1cm5baS5jYWxsKG4sdCxlKSxvLmNhbGwobix0LGUpXX0pfSksZj1lLmNhbGwobixsLGMpO3M9R28ucGVybXV0ZShzLGYpLGw9R28ucGVybXV0ZShsLGYpO3ZhciBoLGcscCx2PXIuY2FsbChuLGwsYyksZD1zLmxlbmd0aCxtPXNbMF0ubGVuZ3RoO2ZvcihnPTA7bT5nOysrZylmb3IodS5jYWxsKG4sc1swXVtnXSxwPXZbZ10sbFswXVtnXVsxXSksaD0xO2Q+aDsrK2gpdS5jYWxsKG4sc1toXVtnXSxwKz1sW2gtMV1bZ11bMV0sbFtoXVtnXVsxXSk7cmV0dXJuIGF9dmFyIHQ9TnQsZT11aSxyPWlpLHU9cmksaT10aSxvPWVpO3JldHVybiBuLnZhbHVlcz1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1lLG4pOnR9LG4ub3JkZXI9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dDpocy5nZXQodCl8fHVpLG4pOmV9LG4ub2Zmc2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6Z3MuZ2V0KHQpfHxpaSxuKTpyfSxuLng9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9dCxuKTppfSxuLnk9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89dCxuKTpvfSxuLm91dD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG59O3ZhciBocz1Hby5tYXAoeyJpbnNpZGUtb3V0IjpmdW5jdGlvbihuKXt2YXIgdCxlLHI9bi5sZW5ndGgsdT1uLm1hcChvaSksaT1uLm1hcChhaSksbz1Hby5yYW5nZShyKS5zb3J0KGZ1bmN0aW9uKG4sdCl7cmV0dXJuIHVbbl0tdVt0XX0pLGE9MCxjPTAscz1bXSxsPVtdO2Zvcih0PTA7cj50OysrdCllPW9bdF0sYz5hPyhhKz1pW2VdLHMucHVzaChlKSk6KGMrPWlbZV0sbC5wdXNoKGUpKTtyZXR1cm4gbC5yZXZlcnNlKCkuY29uY2F0KHMpfSxyZXZlcnNlOmZ1bmN0aW9uKG4pe3JldHVybiBHby5yYW5nZShuLmxlbmd0aCkucmV2ZXJzZSgpfSwiZGVmYXVsdCI6dWl9KSxncz1Hby5tYXAoe3NpbGhvdWV0dGU6ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9bi5sZW5ndGgsaT1uWzBdLmxlbmd0aCxvPVtdLGE9MCxjPVtdO2ZvcihlPTA7aT5lOysrZSl7Zm9yKHQ9MCxyPTA7dT50O3QrKylyKz1uW3RdW2VdWzFdO3I+YSYmKGE9ciksby5wdXNoKHIpfWZvcihlPTA7aT5lOysrZSljW2VdPShhLW9bZV0pLzI7cmV0dXJuIGN9LHdpZ2dsZTpmdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpLG8sYSxjLHMsbD1uLmxlbmd0aCxmPW5bMF0saD1mLmxlbmd0aCxnPVtdO2ZvcihnWzBdPWM9cz0wLGU9MTtoPmU7KytlKXtmb3IodD0wLHU9MDtsPnQ7Kyt0KXUrPW5bdF1bZV1bMV07Zm9yKHQ9MCxpPTAsYT1mW2VdWzBdLWZbZS0xXVswXTtsPnQ7Kyt0KXtmb3Iocj0wLG89KG5bdF1bZV1bMV0tblt0XVtlLTFdWzFdKS8oMiphKTt0PnI7KytyKW8rPShuW3JdW2VdWzFdLW5bcl1bZS0xXVsxXSkvYTtpKz1vKm5bdF1bZV1bMV19Z1tlXT1jLT11P2kvdSphOjAscz5jJiYocz1jKX1mb3IoZT0wO2g+ZTsrK2UpZ1tlXS09cztyZXR1cm4gZ30sZXhwYW5kOmZ1bmN0aW9uKG4pe3ZhciB0LGUscix1PW4ubGVuZ3RoLGk9blswXS5sZW5ndGgsbz0xL3UsYT1bXTtmb3IoZT0wO2k+ZTsrK2Upe2Zvcih0PTAscj0wO3U+dDt0Kyspcis9blt0XVtlXVsxXTtpZihyKWZvcih0PTA7dT50O3QrKyluW3RdW2VdWzFdLz1yO2Vsc2UgZm9yKHQ9MDt1PnQ7dCsrKW5bdF1bZV1bMV09b31mb3IoZT0wO2k+ZTsrK2UpYVtlXT0wO3JldHVybiBhfSx6ZXJvOmlpfSk7R28ubGF5b3V0Lmhpc3RvZ3JhbT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixpKXtmb3IodmFyIG8sYSxjPVtdLHM9bi5tYXAoZSx0aGlzKSxsPXIuY2FsbCh0aGlzLHMsaSksZj11LmNhbGwodGhpcyxsLHMsaSksaT0tMSxoPXMubGVuZ3RoLGc9Zi5sZW5ndGgtMSxwPXQ/MToxL2g7KytpPGc7KW89Y1tpXT1bXSxvLmR4PWZbaSsxXS0oby54PWZbaV0pLG8ueT0wO2lmKGc+MClmb3IoaT0tMTsrK2k8aDspYT1zW2ldLGE+PWxbMF0mJmE8PWxbMV0mJihvPWNbR28uYmlzZWN0KGYsYSwxLGcpLTFdLG8ueSs9cCxvLnB1c2gobltpXSkpO3JldHVybiBjfXZhciB0PSEwLGU9TnVtYmVyLHI9ZmksdT1zaTtyZXR1cm4gbi52YWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT10LG4pOmV9LG4ucmFuZ2U9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RXQodCksbik6cn0sbi5iaW5zPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PSJudW1iZXIiPT10eXBlb2YgdD9mdW5jdGlvbihuKXtyZXR1cm4gbGkobix0KX06RXQodCksbik6dX0sbi5mcmVxdWVuY3k9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ISFlLG4pOnR9LG59LEdvLmxheW91dC50cmVlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe2Z1bmN0aW9uIG8obix0KXt2YXIgcj1uLmNoaWxkcmVuLHU9bi5fdHJlZTtpZihyJiYoaT1yLmxlbmd0aCkpe2Zvcih2YXIgaSxhLHMsbD1yWzBdLGY9bCxoPS0xOysraDxpOylzPXJbaF0sbyhzLGEpLGY9YyhzLGEsZiksYT1zO01pKG4pO3ZhciBnPS41KihsLl90cmVlLnByZWxpbStzLl90cmVlLnByZWxpbSk7dD8odS5wcmVsaW09dC5fdHJlZS5wcmVsaW0rZShuLHQpLHUubW9kPXUucHJlbGltLWcpOnUucHJlbGltPWd9ZWxzZSB0JiYodS5wcmVsaW09dC5fdHJlZS5wcmVsaW0rZShuLHQpKX1mdW5jdGlvbiBhKG4sdCl7bi54PW4uX3RyZWUucHJlbGltK3Q7dmFyIGU9bi5jaGlsZHJlbjtpZihlJiYocj1lLmxlbmd0aCkpe3ZhciByLHU9LTE7Zm9yKHQrPW4uX3RyZWUubW9kOysrdTxyOylhKGVbdV0sdCl9fWZ1bmN0aW9uIGMobix0LHIpe2lmKHQpe2Zvcih2YXIgdSxpPW4sbz1uLGE9dCxjPW4ucGFyZW50LmNoaWxkcmVuWzBdLHM9aS5fdHJlZS5tb2QsbD1vLl90cmVlLm1vZCxmPWEuX3RyZWUubW9kLGg9Yy5fdHJlZS5tb2Q7YT1waShhKSxpPWdpKGkpLGEmJmk7KWM9Z2koYyksbz1waShvKSxvLl90cmVlLmFuY2VzdG9yPW4sdT1hLl90cmVlLnByZWxpbStmLWkuX3RyZWUucHJlbGltLXMrZShhLGkpLHU+MCYmKF9pKGJpKGEsbixyKSxuLHUpLHMrPXUsbCs9dSksZis9YS5fdHJlZS5tb2Qscys9aS5fdHJlZS5tb2QsaCs9Yy5fdHJlZS5tb2QsbCs9by5fdHJlZS5tb2Q7YSYmIXBpKG8pJiYoby5fdHJlZS50aHJlYWQ9YSxvLl90cmVlLm1vZCs9Zi1sKSxpJiYhZ2koYykmJihjLl90cmVlLnRocmVhZD1pLGMuX3RyZWUubW9kKz1zLWgscj1uKX1yZXR1cm4gcn12YXIgcz10LmNhbGwodGhpcyxuLGkpLGw9c1swXTt4aShsLGZ1bmN0aW9uKG4sdCl7bi5fdHJlZT17YW5jZXN0b3I6bixwcmVsaW06MCxtb2Q6MCxjaGFuZ2U6MCxzaGlmdDowLG51bWJlcjp0P3QuX3RyZWUubnVtYmVyKzE6MH19KSxvKGwpLGEobCwtbC5fdHJlZS5wcmVsaW0pO3ZhciBmPXZpKGwsbWkpLGg9dmkobCxkaSksZz12aShsLHlpKSxwPWYueC1lKGYsaCkvMix2PWgueCtlKGgsZikvMixkPWcuZGVwdGh8fDE7cmV0dXJuIHhpKGwsdT9mdW5jdGlvbihuKXtuLngqPXJbMF0sbi55PW4uZGVwdGgqclsxXSxkZWxldGUgbi5fdHJlZX06ZnVuY3Rpb24obil7bi54PShuLngtcCkvKHYtcCkqclswXSxuLnk9bi5kZXB0aC9kKnJbMV0sZGVsZXRlIG4uX3RyZWV9KSxzfXZhciB0PUdvLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KG51bGwpLnZhbHVlKG51bGwpLGU9aGkscj1bMSwxXSx1PSExO3JldHVybiBuLnNlcGFyYXRpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLnNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bnVsbD09KHI9dCksbik6dT9udWxsOnJ9LG4ubm9kZVNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bnVsbCE9KHI9dCksbik6dT9yOm51bGx9LFd1KG4sdCl9LEdvLmxheW91dC5wYWNrPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe3ZhciBvPWUuY2FsbCh0aGlzLG4saSksYT1vWzBdLGM9dVswXSxzPXVbMV0sbD1udWxsPT10P01hdGguc3FydDoiZnVuY3Rpb24iPT10eXBlb2YgdD90OmZ1bmN0aW9uKCl7cmV0dXJuIHR9O2lmKGEueD1hLnk9MCx4aShhLGZ1bmN0aW9uKG4pe24ucj0rbChuLnZhbHVlKX0pLHhpKGEsTmkpLHIpe3ZhciBmPXIqKHQ/MTpNYXRoLm1heCgyKmEuci9jLDIqYS5yL3MpKS8yO3hpKGEsZnVuY3Rpb24obil7bi5yKz1mfSkseGkoYSxOaSkseGkoYSxmdW5jdGlvbihuKXtuLnItPWZ9KX1yZXR1cm4gTGkoYSxjLzIscy8yLHQ/MToxL01hdGgubWF4KDIqYS5yL2MsMiphLnIvcykpLG99dmFyIHQsZT1Hby5sYXlvdXQuaGllcmFyY2h5KCkuc29ydCh3aSkscj0wLHU9WzEsMV07cmV0dXJuIG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG4ucmFkaXVzPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW51bGw9PWV8fCJmdW5jdGlvbiI9PXR5cGVvZiBlP2U6K2Usbik6dH0sbi5wYWRkaW5nPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPSt0LG4pOnJ9LFd1KG4sZSl9LEdvLmxheW91dC5jbHVzdGVyPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe3ZhciBvLGE9dC5jYWxsKHRoaXMsbixpKSxjPWFbMF0scz0wO3hpKGMsZnVuY3Rpb24obil7dmFyIHQ9bi5jaGlsZHJlbjt0JiZ0Lmxlbmd0aD8obi54PXppKHQpLG4ueT1xaSh0KSk6KG4ueD1vP3MrPWUobixvKTowLG4ueT0wLG89bil9KTt2YXIgbD1SaShjKSxmPURpKGMpLGg9bC54LWUobCxmKS8yLGc9Zi54K2UoZixsKS8yO3JldHVybiB4aShjLHU/ZnVuY3Rpb24obil7bi54PShuLngtYy54KSpyWzBdLG4ueT0oYy55LW4ueSkqclsxXX06ZnVuY3Rpb24obil7bi54PShuLngtaCkvKGctaCkqclswXSxuLnk9KDEtKGMueT9uLnkvYy55OjEpKSpyWzFdfSksYX12YXIgdD1Hby5sYXlvdXQuaGllcmFyY2h5KCkuc29ydChudWxsKS52YWx1ZShudWxsKSxlPWhpLHI9WzEsMV0sdT0hMTtyZXR1cm4gbi5zZXBhcmF0aW9uPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW51bGw9PShyPXQpLG4pOnU/bnVsbDpyfSxuLm5vZGVTaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW51bGwhPShyPXQpLG4pOnU/cjpudWxsfSxXdShuLHQpfSxHby5sYXlvdXQudHJlZW1hcD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obix0KXtmb3IodmFyIGUscix1PS0xLGk9bi5sZW5ndGg7Kyt1PGk7KXI9KGU9blt1XSkudmFsdWUqKDA+dD8wOnQpLGUuYXJlYT1pc05hTihyKXx8MD49cj8wOnJ9ZnVuY3Rpb24gdChlKXt2YXIgaT1lLmNoaWxkcmVuO2lmKGkmJmkubGVuZ3RoKXt2YXIgbyxhLGMscz1mKGUpLGw9W10saD1pLnNsaWNlKCkscD0xLzAsdj0ic2xpY2UiPT09Zz9zLmR4OiJkaWNlIj09PWc/cy5keToic2xpY2UtZGljZSI9PT1nPzEmZS5kZXB0aD9zLmR5OnMuZHg6TWF0aC5taW4ocy5keCxzLmR5KTtmb3IobihoLHMuZHgqcy5keS9lLnZhbHVlKSxsLmFyZWE9MDsoYz1oLmxlbmd0aCk+MDspbC5wdXNoKG89aFtjLTFdKSxsLmFyZWErPW8uYXJlYSwic3F1YXJpZnkiIT09Z3x8KGE9cihsLHYpKTw9cD8oaC5wb3AoKSxwPWEpOihsLmFyZWEtPWwucG9wKCkuYXJlYSx1KGwsdixzLCExKSx2PU1hdGgubWluKHMuZHgscy5keSksbC5sZW5ndGg9bC5hcmVhPTAscD0xLzApO2wubGVuZ3RoJiYodShsLHYscywhMCksbC5sZW5ndGg9bC5hcmVhPTApLGkuZm9yRWFjaCh0KX19ZnVuY3Rpb24gZSh0KXt2YXIgcj10LmNoaWxkcmVuO2lmKHImJnIubGVuZ3RoKXt2YXIgaSxvPWYodCksYT1yLnNsaWNlKCksYz1bXTtmb3IobihhLG8uZHgqby5keS90LnZhbHVlKSxjLmFyZWE9MDtpPWEucG9wKCk7KWMucHVzaChpKSxjLmFyZWErPWkuYXJlYSxudWxsIT1pLnomJih1KGMsaS56P28uZHg6by5keSxvLCFhLmxlbmd0aCksYy5sZW5ndGg9Yy5hcmVhPTApO3IuZm9yRWFjaChlKX19ZnVuY3Rpb24gcihuLHQpe2Zvcih2YXIgZSxyPW4uYXJlYSx1PTAsaT0xLzAsbz0tMSxhPW4ubGVuZ3RoOysrbzxhOykoZT1uW29dLmFyZWEpJiYoaT5lJiYoaT1lKSxlPnUmJih1PWUpKTtyZXR1cm4gcio9cix0Kj10LHI/TWF0aC5tYXgodCp1KnAvcixyLyh0KmkqcCkpOjEvMH1mdW5jdGlvbiB1KG4sdCxlLHIpe3ZhciB1LGk9LTEsbz1uLmxlbmd0aCxhPWUueCxzPWUueSxsPXQ/YyhuLmFyZWEvdCk6MDtpZih0PT1lLmR4KXtmb3IoKHJ8fGw+ZS5keSkmJihsPWUuZHkpOysraTxvOyl1PW5baV0sdS54PWEsdS55PXMsdS5keT1sLGErPXUuZHg9TWF0aC5taW4oZS54K2UuZHgtYSxsP2ModS5hcmVhL2wpOjApO3Uuej0hMCx1LmR4Kz1lLngrZS5keC1hLGUueSs9bCxlLmR5LT1sfWVsc2V7Zm9yKChyfHxsPmUuZHgpJiYobD1lLmR4KTsrK2k8bzspdT1uW2ldLHUueD1hLHUueT1zLHUuZHg9bCxzKz11LmR5PU1hdGgubWluKGUueStlLmR5LXMsbD9jKHUuYXJlYS9sKTowKTt1Lno9ITEsdS5keSs9ZS55K2UuZHktcyxlLngrPWwsZS5keC09bH19ZnVuY3Rpb24gaShyKXt2YXIgdT1vfHxhKHIpLGk9dVswXTtyZXR1cm4gaS54PTAsaS55PTAsaS5keD1zWzBdLGkuZHk9c1sxXSxvJiZhLnJldmFsdWUoaSksbihbaV0saS5keCppLmR5L2kudmFsdWUpLChvP2U6dCkoaSksaCYmKG89dSksdX12YXIgbyxhPUdvLmxheW91dC5oaWVyYXJjaHkoKSxjPU1hdGgucm91bmQscz1bMSwxXSxsPW51bGwsZj1QaSxoPSExLGc9InNxdWFyaWZ5IixwPS41KigxK01hdGguc3FydCg1KSk7cmV0dXJuIGkuc2l6ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz1uLGkpOnN9LGkucGFkZGluZz1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KHQpe3ZhciBlPW4uY2FsbChpLHQsdC5kZXB0aCk7cmV0dXJuIG51bGw9PWU/UGkodCk6VWkodCwibnVtYmVyIj09dHlwZW9mIGU/W2UsZSxlLGVdOmUpfWZ1bmN0aW9uIGUodCl7cmV0dXJuIFVpKHQsbil9aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGw7dmFyIHI7cmV0dXJuIGY9bnVsbD09KGw9bik/UGk6ImZ1bmN0aW9uIj09KHI9dHlwZW9mIG4pP3Q6Im51bWJlciI9PT1yPyhuPVtuLG4sbixuXSxlKTplLGl9LGkucm91bmQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGM9bj9NYXRoLnJvdW5kOk51bWJlcixpKTpjIT1OdW1iZXJ9LGkuc3RpY2t5PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhoPW4sbz1udWxsLGkpOmh9LGkucmF0aW89ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHA9bixpKTpwfSxpLm1vZGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGc9bisiIixpKTpnfSxXdShpLGEpfSxHby5yYW5kb209e25vcm1hbDpmdW5jdGlvbihuLHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg7cmV0dXJuIDI+ZSYmKHQ9MSksMT5lJiYobj0wKSxmdW5jdGlvbigpe3ZhciBlLHIsdTtkbyBlPTIqTWF0aC5yYW5kb20oKS0xLHI9MipNYXRoLnJhbmRvbSgpLTEsdT1lKmUrcipyO3doaWxlKCF1fHx1PjEpO3JldHVybiBuK3QqZSpNYXRoLnNxcnQoLTIqTWF0aC5sb2codSkvdSl9fSxsb2dOb3JtYWw6ZnVuY3Rpb24oKXt2YXIgbj1Hby5yYW5kb20ubm9ybWFsLmFwcGx5KEdvLGFyZ3VtZW50cyk7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZXhwKG4oKSl9fSxiYXRlczpmdW5jdGlvbihuKXt2YXIgdD1Hby5yYW5kb20uaXJ3aW5IYWxsKG4pO3JldHVybiBmdW5jdGlvbigpe3JldHVybiB0KCkvbn19LGlyd2luSGFsbDpmdW5jdGlvbihuKXtyZXR1cm4gZnVuY3Rpb24oKXtmb3IodmFyIHQ9MCxlPTA7bj5lO2UrKyl0Kz1NYXRoLnJhbmRvbSgpO3JldHVybiB0fX19LEdvLnNjYWxlPXt9O3ZhciBwcz17Zmxvb3I6TnQsY2VpbDpOdH07R28uc2NhbGUubGluZWFyPWZ1bmN0aW9uKCl7cmV0dXJuIFppKFswLDFdLFswLDFdLGR1LCExKX07dmFyIHZzPXtzOjEsZzoxLHA6MSxyOjEsZToxfTtHby5zY2FsZS5sb2c9ZnVuY3Rpb24oKXtyZXR1cm4gS2koR28uc2NhbGUubGluZWFyKCkuZG9tYWluKFswLDFdKSwxMCwhMCxbMSwxMF0pfTt2YXIgZHM9R28uZm9ybWF0KCIuMGUiKSxtcz17Zmxvb3I6ZnVuY3Rpb24obil7cmV0dXJuLU1hdGguY2VpbCgtbil9LGNlaWw6ZnVuY3Rpb24obil7cmV0dXJuLU1hdGguZmxvb3IoLW4pfX07R28uc2NhbGUucG93PWZ1bmN0aW9uKCl7cmV0dXJuIFFpKEdvLnNjYWxlLmxpbmVhcigpLDEsWzAsMV0pfSxHby5zY2FsZS5zcXJ0PWZ1bmN0aW9uKCl7cmV0dXJuIEdvLnNjYWxlLnBvdygpLmV4cG9uZW50KC41KX0sR28uc2NhbGUub3JkaW5hbD1mdW5jdGlvbigpe3JldHVybiB0byhbXSx7dDoicmFuZ2UiLGE6W1tdXX0pfSxHby5zY2FsZS5jYXRlZ29yeTEwPWZ1bmN0aW9uKCl7cmV0dXJuIEdvLnNjYWxlLm9yZGluYWwoKS5yYW5nZSh5cyl9LEdvLnNjYWxlLmNhdGVnb3J5MjA9ZnVuY3Rpb24oKXtyZXR1cm4gR28uc2NhbGUub3JkaW5hbCgpLnJhbmdlKHhzKX0sR28uc2NhbGUuY2F0ZWdvcnkyMGI9ZnVuY3Rpb24oKXtyZXR1cm4gR28uc2NhbGUub3JkaW5hbCgpLnJhbmdlKE1zKX0sR28uc2NhbGUuY2F0ZWdvcnkyMGM9ZnVuY3Rpb24oKXtyZXR1cm4gR28uc2NhbGUub3JkaW5hbCgpLnJhbmdlKF9zKX07dmFyIHlzPVsyMDYyMjYwLDE2NzQ0MjA2LDI5MjQ1ODgsMTQwMzQ3MjgsOTcyNTg4NSw5MTk3MTMxLDE0OTA3MzMwLDgzNTU3MTEsMTIzNjkxODYsMTU1NjE3NV0ubWFwKG10KSx4cz1bMjA2MjI2MCwxMTQ1NDQ0MCwxNjc0NDIwNiwxNjc1OTY3MiwyOTI0NTg4LDEwMDE4Njk4LDE0MDM0NzI4LDE2NzUwNzQyLDk3MjU4ODUsMTI5NTU4NjEsOTE5NzEzMSwxMjg4NTE0MCwxNDkwNzMzMCwxNjIzNDE5NCw4MzU1NzExLDEzMDkyODA3LDEyMzY5MTg2LDE0NDA4NTg5LDE1NTYxNzUsMTA0MTA3MjVdLm1hcChtdCksTXM9WzM3NTA3NzcsNTM5NTYxOSw3MDQwNzE5LDEwMjY0Mjg2LDY1MTkwOTcsOTIxNjU5NCwxMTkxNTExNSwxMzU1NjYzNiw5MjAyOTkzLDEyNDI2ODA5LDE1MTg2NTE0LDE1MTkwOTMyLDg2NjYxNjksMTEzNTY0OTAsMTQwNDk2NDMsMTUxNzczNzIsODA3NzY4MywxMDgzNDMyNCwxMzUyODUwOSwxNDU4OTY1NF0ubWFwKG10KSxfcz1bMzI0NDczMyw3MDU3MTEwLDEwNDA2NjI1LDEzMDMyNDMxLDE1MDk1MDUzLDE2NjE2NzY0LDE2NjI1MjU5LDE2NjM0MDE4LDMyNTMwNzYsNzY1MjQ3MCwxMDYwNzAwMywxMzEwMTUwNCw3Njk1MjgxLDEwMzk0MzEyLDEyMzY5MzcyLDE0MzQyODkxLDY1MTM1MDcsOTg2ODk1MCwxMjQzNDg3NywxNDI3NzA4MV0ubWFwKG10KTtHby5zY2FsZS5xdWFudGlsZT1mdW5jdGlvbigpe3JldHVybiBlbyhbXSxbXSkKfSxHby5zY2FsZS5xdWFudGl6ZT1mdW5jdGlvbigpe3JldHVybiBybygwLDEsWzAsMV0pfSxHby5zY2FsZS50aHJlc2hvbGQ9ZnVuY3Rpb24oKXtyZXR1cm4gdW8oWy41XSxbMCwxXSl9LEdvLnNjYWxlLmlkZW50aXR5PWZ1bmN0aW9uKCl7cmV0dXJuIGlvKFswLDFdKX0sR28uc3ZnPXt9LEdvLnN2Zy5hcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49dC5hcHBseSh0aGlzLGFyZ3VtZW50cyksaT1lLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxvPXIuYXBwbHkodGhpcyxhcmd1bWVudHMpK2JzLGE9dS5hcHBseSh0aGlzLGFyZ3VtZW50cykrYnMsYz0obz5hJiYoYz1vLG89YSxhPWMpLGEtbykscz1BYT5jPyIwIjoiMSIsbD1NYXRoLmNvcyhvKSxmPU1hdGguc2luKG8pLGg9TWF0aC5jb3MoYSksZz1NYXRoLnNpbihhKTtyZXR1cm4gYz49d3M/bj8iTTAsIitpKyJBIitpKyIsIitpKyIgMCAxLDEgMCwiKy1pKyJBIitpKyIsIitpKyIgMCAxLDEgMCwiK2krIk0wLCIrbisiQSIrbisiLCIrbisiIDAgMSwwIDAsIistbisiQSIrbisiLCIrbisiIDAgMSwwIDAsIituKyJaIjoiTTAsIitpKyJBIitpKyIsIitpKyIgMCAxLDEgMCwiKy1pKyJBIitpKyIsIitpKyIgMCAxLDEgMCwiK2krIloiOm4/Ik0iK2kqbCsiLCIraSpmKyJBIitpKyIsIitpKyIgMCAiK3MrIiwxICIraSpoKyIsIitpKmcrIkwiK24qaCsiLCIrbipnKyJBIituKyIsIituKyIgMCAiK3MrIiwwICIrbipsKyIsIituKmYrIloiOiJNIitpKmwrIiwiK2kqZisiQSIraSsiLCIraSsiIDAgIitzKyIsMSAiK2kqaCsiLCIraSpnKyJMMCwwIisiWiJ9dmFyIHQ9b28sZT1hbyxyPWNvLHU9c287cmV0dXJuIG4uaW5uZXJSYWRpdXM9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9RXQoZSksbik6dH0sbi5vdXRlclJhZGl1cz1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1FdCh0KSxuKTplfSxuLnN0YXJ0QW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RXQodCksbik6cn0sbi5lbmRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1FdCh0KSxuKTp1fSxuLmNlbnRyb2lkPWZ1bmN0aW9uKCl7dmFyIG49KHQuYXBwbHkodGhpcyxhcmd1bWVudHMpK2UuYXBwbHkodGhpcyxhcmd1bWVudHMpKS8yLGk9KHIuYXBwbHkodGhpcyxhcmd1bWVudHMpK3UuYXBwbHkodGhpcyxhcmd1bWVudHMpKS8yK2JzO3JldHVybltNYXRoLmNvcyhpKSpuLE1hdGguc2luKGkpKm5dfSxufTt2YXIgYnM9LUxhLHdzPUNhLVRhO0dvLnN2Zy5saW5lPWZ1bmN0aW9uKCl7cmV0dXJuIGxvKE50KX07dmFyIFNzPUdvLm1hcCh7bGluZWFyOmZvLCJsaW5lYXItY2xvc2VkIjpobyxzdGVwOmdvLCJzdGVwLWJlZm9yZSI6cG8sInN0ZXAtYWZ0ZXIiOnZvLGJhc2lzOmJvLCJiYXNpcy1vcGVuIjp3bywiYmFzaXMtY2xvc2VkIjpTbyxidW5kbGU6a28sY2FyZGluYWw6eG8sImNhcmRpbmFsLW9wZW4iOm1vLCJjYXJkaW5hbC1jbG9zZWQiOnlvLG1vbm90b25lOlRvfSk7U3MuZm9yRWFjaChmdW5jdGlvbihuLHQpe3Qua2V5PW4sdC5jbG9zZWQ9Ly1jbG9zZWQkLy50ZXN0KG4pfSk7dmFyIGtzPVswLDIvMywxLzMsMF0sRXM9WzAsMS8zLDIvMywwXSxOcz1bMCwxLzYsMi8zLDEvNl07R28uc3ZnLmxpbmUucmFkaWFsPWZ1bmN0aW9uKCl7dmFyIG49bG8ocW8pO3JldHVybiBuLnJhZGl1cz1uLngsZGVsZXRlIG4ueCxuLmFuZ2xlPW4ueSxkZWxldGUgbi55LG59LHBvLnJldmVyc2U9dm8sdm8ucmV2ZXJzZT1wbyxHby5zdmcuYXJlYT1mdW5jdGlvbigpe3JldHVybiB6byhOdCl9LEdvLnN2Zy5hcmVhLnJhZGlhbD1mdW5jdGlvbigpe3ZhciBuPXpvKHFvKTtyZXR1cm4gbi5yYWRpdXM9bi54LGRlbGV0ZSBuLngsbi5pbm5lclJhZGl1cz1uLngwLGRlbGV0ZSBuLngwLG4ub3V0ZXJSYWRpdXM9bi54MSxkZWxldGUgbi54MSxuLmFuZ2xlPW4ueSxkZWxldGUgbi55LG4uc3RhcnRBbmdsZT1uLnkwLGRlbGV0ZSBuLnkwLG4uZW5kQW5nbGU9bi55MSxkZWxldGUgbi55MSxufSxHby5zdmcuY2hvcmQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sYSl7dmFyIGM9dCh0aGlzLGksbixhKSxzPXQodGhpcyxvLG4sYSk7cmV0dXJuIk0iK2MucDArcihjLnIsYy5wMSxjLmExLWMuYTApKyhlKGMscyk/dShjLnIsYy5wMSxjLnIsYy5wMCk6dShjLnIsYy5wMSxzLnIscy5wMCkrcihzLnIscy5wMSxzLmExLXMuYTApK3Uocy5yLHMucDEsYy5yLGMucDApKSsiWiJ9ZnVuY3Rpb24gdChuLHQsZSxyKXt2YXIgdT10LmNhbGwobixlLHIpLGk9YS5jYWxsKG4sdSxyKSxvPWMuY2FsbChuLHUscikrYnMsbD1zLmNhbGwobix1LHIpK2JzO3JldHVybntyOmksYTA6byxhMTpsLHAwOltpKk1hdGguY29zKG8pLGkqTWF0aC5zaW4obyldLHAxOltpKk1hdGguY29zKGwpLGkqTWF0aC5zaW4obCldfX1mdW5jdGlvbiBlKG4sdCl7cmV0dXJuIG4uYTA9PXQuYTAmJm4uYTE9PXQuYTF9ZnVuY3Rpb24gcihuLHQsZSl7cmV0dXJuIkEiK24rIiwiK24rIiAwICIrICsoZT5BYSkrIiwxICIrdH1mdW5jdGlvbiB1KG4sdCxlLHIpe3JldHVybiJRIDAsMCAiK3J9dmFyIGk9bXIsbz15cixhPVJvLGM9Y28scz1zbztyZXR1cm4gbi5yYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9RXQodCksbik6YX0sbi5zb3VyY2U9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9RXQodCksbik6aX0sbi50YXJnZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89RXQodCksbik6b30sbi5zdGFydEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPUV0KHQpLG4pOmN9LG4uZW5kQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9RXQodCksbik6c30sbn0sR28uc3ZnLmRpYWdvbmFsPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHUpe3ZhciBpPXQuY2FsbCh0aGlzLG4sdSksbz1lLmNhbGwodGhpcyxuLHUpLGE9KGkueStvLnkpLzIsYz1baSx7eDppLngseTphfSx7eDpvLngseTphfSxvXTtyZXR1cm4gYz1jLm1hcChyKSwiTSIrY1swXSsiQyIrY1sxXSsiICIrY1syXSsiICIrY1szXX12YXIgdD1tcixlPXlyLHI9RG87cmV0dXJuIG4uc291cmNlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PUV0KGUpLG4pOnR9LG4udGFyZ2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPUV0KHQpLG4pOmV9LG4ucHJvamVjdGlvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG59LEdvLnN2Zy5kaWFnb25hbC5yYWRpYWw9ZnVuY3Rpb24oKXt2YXIgbj1Hby5zdmcuZGlhZ29uYWwoKSx0PURvLGU9bi5wcm9qZWN0aW9uO3JldHVybiBuLnByb2plY3Rpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/ZShQbyh0PW4pKTp0fSxufSxHby5zdmcuc3ltYm9sPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHIpe3JldHVybihBcy5nZXQodC5jYWxsKHRoaXMsbixyKSl8fEhvKShlLmNhbGwodGhpcyxuLHIpKX12YXIgdD1qbyxlPVVvO3JldHVybiBuLnR5cGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9RXQoZSksbik6dH0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPUV0KHQpLG4pOmV9LG59O3ZhciBBcz1Hby5tYXAoe2NpcmNsZTpIbyxjcm9zczpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi81KS8yO3JldHVybiJNIistMyp0KyIsIistdCsiSCIrLXQrIlYiKy0zKnQrIkgiK3QrIlYiKy10KyJIIiszKnQrIlYiK3QrIkgiK3QrIlYiKzMqdCsiSCIrLXQrIlYiK3QrIkgiKy0zKnQrIloifSxkaWFtb25kOmZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguc3FydChuLygyKnFzKSksZT10KnFzO3JldHVybiJNMCwiKy10KyJMIitlKyIsMCIrIiAwLCIrdCsiICIrLWUrIiwwIisiWiJ9LHNxdWFyZTpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobikvMjtyZXR1cm4iTSIrLXQrIiwiKy10KyJMIit0KyIsIistdCsiICIrdCsiLCIrdCsiICIrLXQrIiwiK3QrIloifSwidHJpYW5nbGUtZG93biI6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4vVHMpLGU9dCpUcy8yO3JldHVybiJNMCwiK2UrIkwiK3QrIiwiKy1lKyIgIistdCsiLCIrLWUrIloifSwidHJpYW5nbGUtdXAiOmZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguc3FydChuL1RzKSxlPXQqVHMvMjtyZXR1cm4iTTAsIistZSsiTCIrdCsiLCIrZSsiICIrLXQrIiwiK2UrIloifX0pO0dvLnN2Zy5zeW1ib2xUeXBlcz1Bcy5rZXlzKCk7dmFyIENzLExzLFRzPU1hdGguc3FydCgzKSxxcz1NYXRoLnRhbigzMCp6YSksenM9W10sUnM9MDt6cy5jYWxsPV9hLmNhbGwsenMuZW1wdHk9X2EuZW1wdHksenMubm9kZT1fYS5ub2RlLHpzLnNpemU9X2Euc2l6ZSxHby50cmFuc2l0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP0NzP24udHJhbnNpdGlvbigpOm46U2EudHJhbnNpdGlvbigpfSxHby50cmFuc2l0aW9uLnByb3RvdHlwZT16cyx6cy5zZWxlY3Q9ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9dGhpcy5pZCxpPVtdO249YihuKTtmb3IodmFyIG89LTEsYT10aGlzLmxlbmd0aDsrK288YTspe2kucHVzaCh0PVtdKTtmb3IodmFyIGM9dGhpc1tvXSxzPS0xLGw9Yy5sZW5ndGg7KytzPGw7KShyPWNbc10pJiYoZT1uLmNhbGwocixyLl9fZGF0YV9fLHMsbykpPygiX19kYXRhX18iaW4gciYmKGUuX19kYXRhX189ci5fX2RhdGFfXyksSW8oZSxzLHUsci5fX3RyYW5zaXRpb25fX1t1XSksdC5wdXNoKGUpKTp0LnB1c2gobnVsbCl9cmV0dXJuIEZvKGksdSl9LHpzLnNlbGVjdEFsbD1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpLG89dGhpcy5pZCxhPVtdO249dyhuKTtmb3IodmFyIGM9LTEscz10aGlzLmxlbmd0aDsrK2M8czspZm9yKHZhciBsPXRoaXNbY10sZj0tMSxoPWwubGVuZ3RoOysrZjxoOylpZihyPWxbZl0pe2k9ci5fX3RyYW5zaXRpb25fX1tvXSxlPW4uY2FsbChyLHIuX19kYXRhX18sZixjKSxhLnB1c2godD1bXSk7Zm9yKHZhciBnPS0xLHA9ZS5sZW5ndGg7KytnPHA7KSh1PWVbZ10pJiZJbyh1LGcsbyxpKSx0LnB1c2godSl9cmV0dXJuIEZvKGEsbyl9LHpzLmZpbHRlcj1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdT1bXTsiZnVuY3Rpb24iIT10eXBlb2YgbiYmKG49UihuKSk7Zm9yKHZhciBpPTAsbz10aGlzLmxlbmd0aDtvPmk7aSsrKXt1LnB1c2godD1bXSk7Zm9yKHZhciBlPXRoaXNbaV0sYT0wLGM9ZS5sZW5ndGg7Yz5hO2ErKykocj1lW2FdKSYmbi5jYWxsKHIsci5fX2RhdGFfXyxhLGkpJiZ0LnB1c2gocil9cmV0dXJuIEZvKHUsdGhpcy5pZCl9LHpzLnR3ZWVuPWZ1bmN0aW9uKG4sdCl7dmFyIGU9dGhpcy5pZDtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyP3RoaXMubm9kZSgpLl9fdHJhbnNpdGlvbl9fW2VdLnR3ZWVuLmdldChuKTpQKHRoaXMsbnVsbD09dD9mdW5jdGlvbih0KXt0Ll9fdHJhbnNpdGlvbl9fW2VdLnR3ZWVuLnJlbW92ZShuKX06ZnVuY3Rpb24ocil7ci5fX3RyYW5zaXRpb25fX1tlXS50d2Vlbi5zZXQobix0KX0pfSx6cy5hdHRyPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZSgpe3RoaXMucmVtb3ZlQXR0cmlidXRlKGEpfWZ1bmN0aW9uIHIoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZU5TKGEuc3BhY2UsYS5sb2NhbCl9ZnVuY3Rpb24gdShuKXtyZXR1cm4gbnVsbD09bj9lOihuKz0iIixmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5nZXRBdHRyaWJ1dGUoYSk7cmV0dXJuIGUhPT1uJiYodD1vKGUsbiksZnVuY3Rpb24obil7dGhpcy5zZXRBdHRyaWJ1dGUoYSx0KG4pKX0pfSl9ZnVuY3Rpb24gaShuKXtyZXR1cm4gbnVsbD09bj9yOihuKz0iIixmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5nZXRBdHRyaWJ1dGVOUyhhLnNwYWNlLGEubG9jYWwpO3JldHVybiBlIT09biYmKHQ9byhlLG4pLGZ1bmN0aW9uKG4pe3RoaXMuc2V0QXR0cmlidXRlTlMoYS5zcGFjZSxhLmxvY2FsLHQobikpfSl9KX1pZihhcmd1bWVudHMubGVuZ3RoPDIpe2Zvcih0IGluIG4pdGhpcy5hdHRyKHQsblt0XSk7cmV0dXJuIHRoaXN9dmFyIG89InRyYW5zZm9ybSI9PW4/SHU6ZHUsYT1Hby5ucy5xdWFsaWZ5KG4pO3JldHVybiBPbyh0aGlzLCJhdHRyLiIrbix0LGEubG9jYWw/aTp1KX0senMuYXR0clR3ZWVuPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZShuLGUpe3ZhciByPXQuY2FsbCh0aGlzLG4sZSx0aGlzLmdldEF0dHJpYnV0ZSh1KSk7cmV0dXJuIHImJmZ1bmN0aW9uKG4pe3RoaXMuc2V0QXR0cmlidXRlKHUscihuKSl9fWZ1bmN0aW9uIHIobixlKXt2YXIgcj10LmNhbGwodGhpcyxuLGUsdGhpcy5nZXRBdHRyaWJ1dGVOUyh1LnNwYWNlLHUubG9jYWwpKTtyZXR1cm4gciYmZnVuY3Rpb24obil7dGhpcy5zZXRBdHRyaWJ1dGVOUyh1LnNwYWNlLHUubG9jYWwscihuKSl9fXZhciB1PUdvLm5zLnF1YWxpZnkobik7cmV0dXJuIHRoaXMudHdlZW4oImF0dHIuIituLHUubG9jYWw/cjplKX0senMuc3R5bGU9ZnVuY3Rpb24obix0LGUpe2Z1bmN0aW9uIHIoKXt0aGlzLnN0eWxlLnJlbW92ZVByb3BlcnR5KG4pfWZ1bmN0aW9uIHUodCl7cmV0dXJuIG51bGw9PXQ/cjoodCs9IiIsZnVuY3Rpb24oKXt2YXIgcix1PWVhLmdldENvbXB1dGVkU3R5bGUodGhpcyxudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKG4pO3JldHVybiB1IT09dCYmKHI9ZHUodSx0KSxmdW5jdGlvbih0KXt0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4scih0KSxlKX0pfSl9dmFyIGk9YXJndW1lbnRzLmxlbmd0aDtpZigzPmkpe2lmKCJzdHJpbmciIT10eXBlb2Ygbil7Mj5pJiYodD0iIik7Zm9yKGUgaW4gbil0aGlzLnN0eWxlKGUsbltlXSx0KTtyZXR1cm4gdGhpc31lPSIifXJldHVybiBPbyh0aGlzLCJzdHlsZS4iK24sdCx1KX0senMuc3R5bGVUd2Vlbj1mdW5jdGlvbihuLHQsZSl7ZnVuY3Rpb24gcihyLHUpe3ZhciBpPXQuY2FsbCh0aGlzLHIsdSxlYS5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKSk7cmV0dXJuIGkmJmZ1bmN0aW9uKHQpe3RoaXMuc3R5bGUuc2V0UHJvcGVydHkobixpKHQpLGUpfX1yZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwzJiYoZT0iIiksdGhpcy50d2Vlbigic3R5bGUuIituLHIpfSx6cy50ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBPbyh0aGlzLCJ0ZXh0IixuLFlvKX0senMucmVtb3ZlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaCgiZW5kLnRyYW5zaXRpb24iLGZ1bmN0aW9uKCl7dmFyIG47dGhpcy5fX3RyYW5zaXRpb25fXy5jb3VudDwyJiYobj10aGlzLnBhcmVudE5vZGUpJiZuLnJlbW92ZUNoaWxkKHRoaXMpfSl9LHpzLmVhc2U9ZnVuY3Rpb24obil7dmFyIHQ9dGhpcy5pZDtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwxP3RoaXMubm9kZSgpLl9fdHJhbnNpdGlvbl9fW3RdLmVhc2U6KCJmdW5jdGlvbiIhPXR5cGVvZiBuJiYobj1Hby5lYXNlLmFwcGx5KEdvLGFyZ3VtZW50cykpLFAodGhpcyxmdW5jdGlvbihlKXtlLl9fdHJhbnNpdGlvbl9fW3RdLmVhc2U9bn0pKX0senMuZGVsYXk9ZnVuY3Rpb24obil7dmFyIHQ9dGhpcy5pZDtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwxP3RoaXMubm9kZSgpLl9fdHJhbnNpdGlvbl9fW3RdLmRlbGF5OlAodGhpcywiZnVuY3Rpb24iPT10eXBlb2Ygbj9mdW5jdGlvbihlLHIsdSl7ZS5fX3RyYW5zaXRpb25fX1t0XS5kZWxheT0rbi5jYWxsKGUsZS5fX2RhdGFfXyxyLHUpfToobj0rbixmdW5jdGlvbihlKXtlLl9fdHJhbnNpdGlvbl9fW3RdLmRlbGF5PW59KSl9LHpzLmR1cmF0aW9uPWZ1bmN0aW9uKG4pe3ZhciB0PXRoaXMuaWQ7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKS5fX3RyYW5zaXRpb25fX1t0XS5kdXJhdGlvbjpQKHRoaXMsImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24oZSxyLHUpe2UuX190cmFuc2l0aW9uX19bdF0uZHVyYXRpb249TWF0aC5tYXgoMSxuLmNhbGwoZSxlLl9fZGF0YV9fLHIsdSkpfToobj1NYXRoLm1heCgxLG4pLGZ1bmN0aW9uKGUpe2UuX190cmFuc2l0aW9uX19bdF0uZHVyYXRpb249bn0pKX0senMuZWFjaD1mdW5jdGlvbihuLHQpe3ZhciBlPXRoaXMuaWQ7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXt2YXIgcj1Mcyx1PUNzO0NzPWUsUCh0aGlzLGZ1bmN0aW9uKHQscix1KXtMcz10Ll9fdHJhbnNpdGlvbl9fW2VdLG4uY2FsbCh0LHQuX19kYXRhX18scix1KX0pLExzPXIsQ3M9dX1lbHNlIFAodGhpcyxmdW5jdGlvbihyKXt2YXIgdT1yLl9fdHJhbnNpdGlvbl9fW2VdOyh1LmV2ZW50fHwodS5ldmVudD1Hby5kaXNwYXRjaCgic3RhcnQiLCJlbmQiKSkpLm9uKG4sdCl9KTtyZXR1cm4gdGhpc30senMudHJhbnNpdGlvbj1mdW5jdGlvbigpe2Zvcih2YXIgbix0LGUscix1PXRoaXMuaWQsaT0rK1JzLG89W10sYT0wLGM9dGhpcy5sZW5ndGg7Yz5hO2ErKyl7by5wdXNoKG49W10pO2Zvcih2YXIgdD10aGlzW2FdLHM9MCxsPXQubGVuZ3RoO2w+cztzKyspKGU9dFtzXSkmJihyPU9iamVjdC5jcmVhdGUoZS5fX3RyYW5zaXRpb25fX1t1XSksci5kZWxheSs9ci5kdXJhdGlvbixJbyhlLHMsaSxyKSksbi5wdXNoKGUpfXJldHVybiBGbyhvLGkpfSxHby5zdmcuYXhpcz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obil7bi5lYWNoKGZ1bmN0aW9uKCl7dmFyIG4scz1Hby5zZWxlY3QodGhpcyksbD10aGlzLl9fY2hhcnRfX3x8ZSxmPXRoaXMuX19jaGFydF9fPWUuY29weSgpLGg9bnVsbD09Yz9mLnRpY2tzP2YudGlja3MuYXBwbHkoZixhKTpmLmRvbWFpbigpOmMsZz1udWxsPT10P2YudGlja0Zvcm1hdD9mLnRpY2tGb3JtYXQuYXBwbHkoZixhKTpOdDp0LHA9cy5zZWxlY3RBbGwoIi50aWNrIikuZGF0YShoLGYpLHY9cC5lbnRlcigpLmluc2VydCgiZyIsIi5kb21haW4iKS5hdHRyKCJjbGFzcyIsInRpY2siKS5zdHlsZSgib3BhY2l0eSIsVGEpLGQ9R28udHJhbnNpdGlvbihwLmV4aXQoKSkuc3R5bGUoIm9wYWNpdHkiLFRhKS5yZW1vdmUoKSxtPUdvLnRyYW5zaXRpb24ocC5vcmRlcigpKS5zdHlsZSgib3BhY2l0eSIsMSkseT1IaShmKSx4PXMuc2VsZWN0QWxsKCIuZG9tYWluIikuZGF0YShbMF0pLE09KHguZW50ZXIoKS5hcHBlbmQoInBhdGgiKS5hdHRyKCJjbGFzcyIsImRvbWFpbiIpLEdvLnRyYW5zaXRpb24oeCkpO3YuYXBwZW5kKCJsaW5lIiksdi5hcHBlbmQoInRleHQiKTt2YXIgXz12LnNlbGVjdCgibGluZSIpLGI9bS5zZWxlY3QoImxpbmUiKSx3PXAuc2VsZWN0KCJ0ZXh0IikudGV4dChnKSxTPXYuc2VsZWN0KCJ0ZXh0Iiksaz1tLnNlbGVjdCgidGV4dCIpO3N3aXRjaChyKXtjYXNlImJvdHRvbSI6bj1abyxfLmF0dHIoInkyIix1KSxTLmF0dHIoInkiLE1hdGgubWF4KHUsMCkrbyksYi5hdHRyKCJ4MiIsMCkuYXR0cigieTIiLHUpLGsuYXR0cigieCIsMCkuYXR0cigieSIsTWF0aC5tYXgodSwwKStvKSx3LmF0dHIoImR5IiwiLjcxZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJtaWRkbGUiKSxNLmF0dHIoImQiLCJNIit5WzBdKyIsIitpKyJWMEgiK3lbMV0rIlYiK2kpO2JyZWFrO2Nhc2UidG9wIjpuPVpvLF8uYXR0cigieTIiLC11KSxTLmF0dHIoInkiLC0oTWF0aC5tYXgodSwwKStvKSksYi5hdHRyKCJ4MiIsMCkuYXR0cigieTIiLC11KSxrLmF0dHIoIngiLDApLmF0dHIoInkiLC0oTWF0aC5tYXgodSwwKStvKSksdy5hdHRyKCJkeSIsIjBlbSIpLnN0eWxlKCJ0ZXh0LWFuY2hvciIsIm1pZGRsZSIpLE0uYXR0cigiZCIsIk0iK3lbMF0rIiwiKy1pKyJWMEgiK3lbMV0rIlYiKy1pKTticmVhaztjYXNlImxlZnQiOm49Vm8sXy5hdHRyKCJ4MiIsLXUpLFMuYXR0cigieCIsLShNYXRoLm1heCh1LDApK28pKSxiLmF0dHIoIngyIiwtdSkuYXR0cigieTIiLDApLGsuYXR0cigieCIsLShNYXRoLm1heCh1LDApK28pKS5hdHRyKCJ5IiwwKSx3LmF0dHIoImR5IiwiLjMyZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJlbmQiKSxNLmF0dHIoImQiLCJNIistaSsiLCIreVswXSsiSDBWIit5WzFdKyJIIistaSk7YnJlYWs7Y2FzZSJyaWdodCI6bj1WbyxfLmF0dHIoIngyIix1KSxTLmF0dHIoIngiLE1hdGgubWF4KHUsMCkrbyksYi5hdHRyKCJ4MiIsdSkuYXR0cigieTIiLDApLGsuYXR0cigieCIsTWF0aC5tYXgodSwwKStvKS5hdHRyKCJ5IiwwKSx3LmF0dHIoImR5IiwiLjMyZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJzdGFydCIpLE0uYXR0cigiZCIsIk0iK2krIiwiK3lbMF0rIkgwViIreVsxXSsiSCIraSl9aWYoZi5yYW5nZUJhbmQpe3ZhciBFPWYsTj1FLnJhbmdlQmFuZCgpLzI7bD1mPWZ1bmN0aW9uKG4pe3JldHVybiBFKG4pK059fWVsc2UgbC5yYW5nZUJhbmQ/bD1mOmQuY2FsbChuLGYpO3YuY2FsbChuLGwpLG0uY2FsbChuLGYpfSl9dmFyIHQsZT1Hby5zY2FsZS5saW5lYXIoKSxyPURzLHU9NixpPTYsbz0zLGE9WzEwXSxjPW51bGw7cmV0dXJuIG4uc2NhbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLm9yaWVudD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10IGluIFBzP3QrIiI6RHMsbik6cn0sbi50aWNrcz1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPWFyZ3VtZW50cyxuKTphfSxuLnRpY2tWYWx1ZXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGM9dCxuKTpjfSxuLnRpY2tGb3JtYXQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ZSxuKTp0fSxuLnRpY2tTaXplPWZ1bmN0aW9uKHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg7cmV0dXJuIGU/KHU9K3QsaT0rYXJndW1lbnRzW2UtMV0sbik6dX0sbi5pbm5lclRpY2tTaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PSt0LG4pOnV9LG4ub3V0ZXJUaWNrU2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT0rdCxuKTppfSxuLnRpY2tQYWRkaW5nPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPSt0LG4pOm99LG4udGlja1N1YmRpdmlkZT1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoJiZufSxufTt2YXIgRHM9ImJvdHRvbSIsUHM9e3RvcDoxLHJpZ2h0OjEsYm90dG9tOjEsbGVmdDoxfTtHby5zdmcuYnJ1c2g9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKGkpe2kuZWFjaChmdW5jdGlvbigpe3ZhciBpPUdvLnNlbGVjdCh0aGlzKS5zdHlsZSgicG9pbnRlci1ldmVudHMiLCJhbGwiKS5zdHlsZSgiLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yIiwicmdiYSgwLDAsMCwwKSIpLm9uKCJtb3VzZWRvd24uYnJ1c2giLHUpLm9uKCJ0b3VjaHN0YXJ0LmJydXNoIix1KSxvPWkuc2VsZWN0QWxsKCIuYmFja2dyb3VuZCIpLmRhdGEoWzBdKTtvLmVudGVyKCkuYXBwZW5kKCJyZWN0IikuYXR0cigiY2xhc3MiLCJiYWNrZ3JvdW5kIikuc3R5bGUoInZpc2liaWxpdHkiLCJoaWRkZW4iKS5zdHlsZSgiY3Vyc29yIiwiY3Jvc3NoYWlyIiksaS5zZWxlY3RBbGwoIi5leHRlbnQiKS5kYXRhKFswXSkuZW50ZXIoKS5hcHBlbmQoInJlY3QiKS5hdHRyKCJjbGFzcyIsImV4dGVudCIpLnN0eWxlKCJjdXJzb3IiLCJtb3ZlIik7dmFyIGE9aS5zZWxlY3RBbGwoIi5yZXNpemUiKS5kYXRhKHAsTnQpO2EuZXhpdCgpLnJlbW92ZSgpLGEuZW50ZXIoKS5hcHBlbmQoImciKS5hdHRyKCJjbGFzcyIsZnVuY3Rpb24obil7cmV0dXJuInJlc2l6ZSAiK259KS5zdHlsZSgiY3Vyc29yIixmdW5jdGlvbihuKXtyZXR1cm4gVXNbbl19KS5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4IixmdW5jdGlvbihuKXtyZXR1cm4vW2V3XSQvLnRlc3Qobik/LTM6bnVsbH0pLmF0dHIoInkiLGZ1bmN0aW9uKG4pe3JldHVybi9eW25zXS8udGVzdChuKT8tMzpudWxsfSkuYXR0cigid2lkdGgiLDYpLmF0dHIoImhlaWdodCIsNikuc3R5bGUoInZpc2liaWxpdHkiLCJoaWRkZW4iKSxhLnN0eWxlKCJkaXNwbGF5IixuLmVtcHR5KCk/Im5vbmUiOm51bGwpO3ZhciBsLGY9R28udHJhbnNpdGlvbihpKSxoPUdvLnRyYW5zaXRpb24obyk7YyYmKGw9SGkoYyksaC5hdHRyKCJ4IixsWzBdKS5hdHRyKCJ3aWR0aCIsbFsxXS1sWzBdKSxlKGYpKSxzJiYobD1IaShzKSxoLmF0dHIoInkiLGxbMF0pLmF0dHIoImhlaWdodCIsbFsxXS1sWzBdKSxyKGYpKSx0KGYpfSl9ZnVuY3Rpb24gdChuKXtuLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLmF0dHIoInRyYW5zZm9ybSIsZnVuY3Rpb24obil7cmV0dXJuInRyYW5zbGF0ZSgiK2xbKy9lJC8udGVzdChuKV0rIiwiK2ZbKy9ecy8udGVzdChuKV0rIikifSl9ZnVuY3Rpb24gZShuKXtuLnNlbGVjdCgiLmV4dGVudCIpLmF0dHIoIngiLGxbMF0pLG4uc2VsZWN0QWxsKCIuZXh0ZW50LC5uPnJlY3QsLnM+cmVjdCIpLmF0dHIoIndpZHRoIixsWzFdLWxbMF0pfWZ1bmN0aW9uIHIobil7bi5zZWxlY3QoIi5leHRlbnQiKS5hdHRyKCJ5IixmWzBdKSxuLnNlbGVjdEFsbCgiLmV4dGVudCwuZT5yZWN0LC53PnJlY3QiKS5hdHRyKCJoZWlnaHQiLGZbMV0tZlswXSl9ZnVuY3Rpb24gdSgpe2Z1bmN0aW9uIHUoKXszMj09R28uZXZlbnQua2V5Q29kZSYmKEF8fCh4PW51bGwsTFswXS09bFsxXSxMWzFdLT1mWzFdLEE9MikseSgpKX1mdW5jdGlvbiBwKCl7MzI9PUdvLmV2ZW50LmtleUNvZGUmJjI9PUEmJihMWzBdKz1sWzFdLExbMV0rPWZbMV0sQT0wLHkoKSl9ZnVuY3Rpb24gdigpe3ZhciBuPUdvLm1vdXNlKF8pLHU9ITE7TSYmKG5bMF0rPU1bMF0sblsxXSs9TVsxXSksQXx8KEdvLmV2ZW50LmFsdEtleT8oeHx8KHg9WyhsWzBdK2xbMV0pLzIsKGZbMF0rZlsxXSkvMl0pLExbMF09bFsrKG5bMF08eFswXSldLExbMV09ZlsrKG5bMV08eFsxXSldKTp4PW51bGwpLEUmJmQobixjLDApJiYoZShTKSx1PSEwKSxOJiZkKG4scywxKSYmKHIoUyksdT0hMCksdSYmKHQoUyksdyh7dHlwZToiYnJ1c2giLG1vZGU6QT8ibW92ZSI6InJlc2l6ZSJ9KSl9ZnVuY3Rpb24gZChuLHQsZSl7dmFyIHIsdSxhPUhpKHQpLGM9YVswXSxzPWFbMV0scD1MW2VdLHY9ZT9mOmwsZD12WzFdLXZbMF07cmV0dXJuIEEmJihjLT1wLHMtPWQrcCkscj0oZT9nOmgpP01hdGgubWF4KGMsTWF0aC5taW4ocyxuW2VdKSk6bltlXSxBP3U9KHIrPXApK2Q6KHgmJihwPU1hdGgubWF4KGMsTWF0aC5taW4ocywyKnhbZV0tcikpKSxyPnA/KHU9cixyPXApOnU9cCksdlswXSE9cnx8dlsxXSE9dT8oZT9vPW51bGw6aT1udWxsLHZbMF09cix2WzFdPXUsITApOnZvaWQgMH1mdW5jdGlvbiBtKCl7digpLFMuc3R5bGUoInBvaW50ZXItZXZlbnRzIiwiYWxsIikuc2VsZWN0QWxsKCIucmVzaXplIikuc3R5bGUoImRpc3BsYXkiLG4uZW1wdHkoKT8ibm9uZSI6bnVsbCksR28uc2VsZWN0KCJib2R5Iikuc3R5bGUoImN1cnNvciIsbnVsbCksVC5vbigibW91c2Vtb3ZlLmJydXNoIixudWxsKS5vbigibW91c2V1cC5icnVzaCIsbnVsbCkub24oInRvdWNobW92ZS5icnVzaCIsbnVsbCkub24oInRvdWNoZW5kLmJydXNoIixudWxsKS5vbigia2V5ZG93bi5icnVzaCIsbnVsbCkub24oImtleXVwLmJydXNoIixudWxsKSxDKCksdyh7dHlwZToiYnJ1c2hlbmQifSl9dmFyIHgsTSxfPXRoaXMsYj1Hby5zZWxlY3QoR28uZXZlbnQudGFyZ2V0KSx3PWEub2YoXyxhcmd1bWVudHMpLFM9R28uc2VsZWN0KF8pLGs9Yi5kYXR1bSgpLEU9IS9eKG58cykkLy50ZXN0KGspJiZjLE49IS9eKGV8dykkLy50ZXN0KGspJiZzLEE9Yi5jbGFzc2VkKCJleHRlbnQiKSxDPUkoKSxMPUdvLm1vdXNlKF8pLFQ9R28uc2VsZWN0KGVhKS5vbigia2V5ZG93bi5icnVzaCIsdSkub24oImtleXVwLmJydXNoIixwKTtpZihHby5ldmVudC5jaGFuZ2VkVG91Y2hlcz9ULm9uKCJ0b3VjaG1vdmUuYnJ1c2giLHYpLm9uKCJ0b3VjaGVuZC5icnVzaCIsbSk6VC5vbigibW91c2Vtb3ZlLmJydXNoIix2KS5vbigibW91c2V1cC5icnVzaCIsbSksUy5pbnRlcnJ1cHQoKS5zZWxlY3RBbGwoIioiKS5pbnRlcnJ1cHQoKSxBKUxbMF09bFswXS1MWzBdLExbMV09ZlswXS1MWzFdO2Vsc2UgaWYoayl7dmFyIHE9Ky93JC8udGVzdChrKSx6PSsvXm4vLnRlc3Qoayk7TT1bbFsxLXFdLUxbMF0sZlsxLXpdLUxbMV1dLExbMF09bFtxXSxMWzFdPWZbel19ZWxzZSBHby5ldmVudC5hbHRLZXkmJih4PUwuc2xpY2UoKSk7Uy5zdHlsZSgicG9pbnRlci1ldmVudHMiLCJub25lIikuc2VsZWN0QWxsKCIucmVzaXplIikuc3R5bGUoImRpc3BsYXkiLG51bGwpLEdvLnNlbGVjdCgiYm9keSIpLnN0eWxlKCJjdXJzb3IiLGIuc3R5bGUoImN1cnNvciIpKSx3KHt0eXBlOiJicnVzaHN0YXJ0In0pLHYoKX12YXIgaSxvLGE9TShuLCJicnVzaHN0YXJ0IiwiYnJ1c2giLCJicnVzaGVuZCIpLGM9bnVsbCxzPW51bGwsbD1bMCwwXSxmPVswLDBdLGg9ITAsZz0hMCxwPWpzWzBdO3JldHVybiBuLmV2ZW50PWZ1bmN0aW9uKG4pe24uZWFjaChmdW5jdGlvbigpe3ZhciBuPWEub2YodGhpcyxhcmd1bWVudHMpLHQ9e3g6bCx5OmYsaTppLGo6b30sZT10aGlzLl9fY2hhcnRfX3x8dDt0aGlzLl9fY2hhcnRfXz10LENzP0dvLnNlbGVjdCh0aGlzKS50cmFuc2l0aW9uKCkuZWFjaCgic3RhcnQuYnJ1c2giLGZ1bmN0aW9uKCl7aT1lLmksbz1lLmosbD1lLngsZj1lLnksbih7dHlwZToiYnJ1c2hzdGFydCJ9KX0pLnR3ZWVuKCJicnVzaDpicnVzaCIsZnVuY3Rpb24oKXt2YXIgZT1tdShsLHQueCkscj1tdShmLHQueSk7cmV0dXJuIGk9bz1udWxsLGZ1bmN0aW9uKHUpe2w9dC54PWUodSksZj10Lnk9cih1KSxuKHt0eXBlOiJicnVzaCIsbW9kZToicmVzaXplIn0pfX0pLmVhY2goImVuZC5icnVzaCIsZnVuY3Rpb24oKXtpPXQuaSxvPXQuaixuKHt0eXBlOiJicnVzaCIsbW9kZToicmVzaXplIn0pLG4oe3R5cGU6ImJydXNoZW5kIn0pfSk6KG4oe3R5cGU6ImJydXNoc3RhcnQifSksbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KSxuKHt0eXBlOiJicnVzaGVuZCJ9KSl9KX0sbi54PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPXQscD1qc1shYzw8MXwhc10sbik6Y30sbi55PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhzPXQscD1qc1shYzw8MXwhc10sbik6c30sbi5jbGFtcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYyYmcz8oaD0hIXRbMF0sZz0hIXRbMV0pOmM/aD0hIXQ6cyYmKGc9ISF0KSxuKTpjJiZzP1toLGddOmM/aDpzP2c6bnVsbH0sbi5leHRlbnQ9ZnVuY3Rpb24odCl7dmFyIGUscix1LGEsaDtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYyYmKGU9dFswXSxyPXRbMV0scyYmKGU9ZVswXSxyPXJbMF0pLGk9W2Uscl0sYy5pbnZlcnQmJihlPWMoZSkscj1jKHIpKSxlPnImJihoPWUsZT1yLHI9aCksKGUhPWxbMF18fHIhPWxbMV0pJiYobD1bZSxyXSkpLHMmJih1PXRbMF0sYT10WzFdLGMmJih1PXVbMV0sYT1hWzFdKSxvPVt1LGFdLHMuaW52ZXJ0JiYodT1zKHUpLGE9cyhhKSksdT5hJiYoaD11LHU9YSxhPWgpLCh1IT1mWzBdfHxhIT1mWzFdKSYmKGY9W3UsYV0pKSxuKTooYyYmKGk/KGU9aVswXSxyPWlbMV0pOihlPWxbMF0scj1sWzFdLGMuaW52ZXJ0JiYoZT1jLmludmVydChlKSxyPWMuaW52ZXJ0KHIpKSxlPnImJihoPWUsZT1yLHI9aCkpKSxzJiYobz8odT1vWzBdLGE9b1sxXSk6KHU9ZlswXSxhPWZbMV0scy5pbnZlcnQmJih1PXMuaW52ZXJ0KHUpLGE9cy5pbnZlcnQoYSkpLHU+YSYmKGg9dSx1PWEsYT1oKSkpLGMmJnM/W1tlLHVdLFtyLGFdXTpjP1tlLHJdOnMmJlt1LGFdKX0sbi5jbGVhcj1mdW5jdGlvbigpe3JldHVybiBuLmVtcHR5KCl8fChsPVswLDBdLGY9WzAsMF0saT1vPW51bGwpLG59LG4uZW1wdHk9ZnVuY3Rpb24oKXtyZXR1cm4hIWMmJmxbMF09PWxbMV18fCEhcyYmZlswXT09ZlsxXX0sR28ucmViaW5kKG4sYSwib24iKX07dmFyIFVzPXtuOiJucy1yZXNpemUiLGU6ImV3LXJlc2l6ZSIsczoibnMtcmVzaXplIix3OiJldy1yZXNpemUiLG53OiJud3NlLXJlc2l6ZSIsbmU6Im5lc3ctcmVzaXplIixzZToibndzZS1yZXNpemUiLHN3OiJuZXN3LXJlc2l6ZSJ9LGpzPVtbIm4iLCJlIiwicyIsInciLCJudyIsIm5lIiwic2UiLCJzdyJdLFsiZSIsInciXSxbIm4iLCJzIl0sW11dLEhzPWljLmZvcm1hdD1mYy50aW1lRm9ybWF0LEZzPUhzLnV0YyxPcz1GcygiJVktJW0tJWRUJUg6JU06JVMuJUxaIik7SHMuaXNvPURhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nJiYrbmV3IERhdGUoIjIwMDAtMDEtMDFUMDA6MDA6MDAuMDAwWiIpPyRvOk9zLCRvLnBhcnNlPWZ1bmN0aW9uKG4pe3ZhciB0PW5ldyBEYXRlKG4pO3JldHVybiBpc05hTih0KT9udWxsOnR9LCRvLnRvU3RyaW5nPU9zLnRvU3RyaW5nLGljLnNlY29uZD1IdChmdW5jdGlvbihuKXtyZXR1cm4gbmV3IG9jKDFlMypNYXRoLmZsb29yKG4vMWUzKSl9LGZ1bmN0aW9uKG4sdCl7bi5zZXRUaW1lKG4uZ2V0VGltZSgpKzFlMypNYXRoLmZsb29yKHQpKX0sZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0U2Vjb25kcygpfSksaWMuc2Vjb25kcz1pYy5zZWNvbmQucmFuZ2UsaWMuc2Vjb25kcy51dGM9aWMuc2Vjb25kLnV0Yy5yYW5nZSxpYy5taW51dGU9SHQoZnVuY3Rpb24obil7cmV0dXJuIG5ldyBvYyg2ZTQqTWF0aC5mbG9vcihuLzZlNCkpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSs2ZTQqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldE1pbnV0ZXMoKX0pLGljLm1pbnV0ZXM9aWMubWludXRlLnJhbmdlLGljLm1pbnV0ZXMudXRjPWljLm1pbnV0ZS51dGMucmFuZ2UsaWMuaG91cj1IdChmdW5jdGlvbihuKXt2YXIgdD1uLmdldFRpbWV6b25lT2Zmc2V0KCkvNjA7cmV0dXJuIG5ldyBvYygzNmU1KihNYXRoLmZsb29yKG4vMzZlNS10KSt0KSl9LGZ1bmN0aW9uKG4sdCl7bi5zZXRUaW1lKG4uZ2V0VGltZSgpKzM2ZTUqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldEhvdXJzKCl9KSxpYy5ob3Vycz1pYy5ob3VyLnJhbmdlLGljLmhvdXJzLnV0Yz1pYy5ob3VyLnV0Yy5yYW5nZSxpYy5tb250aD1IdChmdW5jdGlvbihuKXtyZXR1cm4gbj1pYy5kYXkobiksbi5zZXREYXRlKDEpLG59LGZ1bmN0aW9uKG4sdCl7bi5zZXRNb250aChuLmdldE1vbnRoKCkrdCl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldE1vbnRoKCl9KSxpYy5tb250aHM9aWMubW9udGgucmFuZ2UsaWMubW9udGhzLnV0Yz1pYy5tb250aC51dGMucmFuZ2U7dmFyIFlzPVsxZTMsNWUzLDE1ZTMsM2U0LDZlNCwzZTUsOWU1LDE4ZTUsMzZlNSwxMDhlNSwyMTZlNSw0MzJlNSw4NjRlNSwxNzI4ZTUsNjA0OGU1LDI1OTJlNiw3Nzc2ZTYsMzE1MzZlNl0sSXM9W1tpYy5zZWNvbmQsMV0sW2ljLnNlY29uZCw1XSxbaWMuc2Vjb25kLDE1XSxbaWMuc2Vjb25kLDMwXSxbaWMubWludXRlLDFdLFtpYy5taW51dGUsNV0sW2ljLm1pbnV0ZSwxNV0sW2ljLm1pbnV0ZSwzMF0sW2ljLmhvdXIsMV0sW2ljLmhvdXIsM10sW2ljLmhvdXIsNl0sW2ljLmhvdXIsMTJdLFtpYy5kYXksMV0sW2ljLmRheSwyXSxbaWMud2VlaywxXSxbaWMubW9udGgsMV0sW2ljLm1vbnRoLDNdLFtpYy55ZWFyLDFdXSxacz1Icy5tdWx0aShbWyIuJUwiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldE1pbGxpc2Vjb25kcygpfV0sWyI6JVMiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFNlY29uZHMoKX1dLFsiJUk6JU0iLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldE1pbnV0ZXMoKX1dLFsiJUkgJXAiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldEhvdXJzKCl9XSxbIiVhICVkIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXREYXkoKSYmMSE9bi5nZXREYXRlKCl9XSxbIiViICVkIixmdW5jdGlvbihuKXtyZXR1cm4gMSE9bi5nZXREYXRlKCl9XSxbIiVCIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNb250aCgpfV0sWyIlWSIsTmVdXSksVnM9e3JhbmdlOmZ1bmN0aW9uKG4sdCxlKXtyZXR1cm4gR28ucmFuZ2UoTWF0aC5jZWlsKG4vZSkqZSwrdCxlKS5tYXAoQm8pfSxmbG9vcjpOdCxjZWlsOk50fTtJcy55ZWFyPWljLnllYXIsaWMuc2NhbGU9ZnVuY3Rpb24oKXtyZXR1cm4gWG8oR28uc2NhbGUubGluZWFyKCksSXMsWnMpfTt2YXIgJHM9SXMubWFwKGZ1bmN0aW9uKG4pe3JldHVybltuWzBdLnV0YyxuWzFdXX0pLFhzPUZzLm11bHRpKFtbIi4lTCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDTWlsbGlzZWNvbmRzKCl9XSxbIjolUyIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDU2Vjb25kcygpfV0sWyIlSTolTSIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDTWludXRlcygpfV0sWyIlSSAlcCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDSG91cnMoKX1dLFsiJWEgJWQiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ0RheSgpJiYxIT1uLmdldFVUQ0RhdGUoKX1dLFsiJWIgJWQiLGZ1bmN0aW9uKG4pe3JldHVybiAxIT1uLmdldFVUQ0RhdGUoKX1dLFsiJUIiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ01vbnRoKCl9XSxbIiVZIixOZV1dKTskcy55ZWFyPWljLnllYXIudXRjLGljLnNjYWxlLnV0Yz1mdW5jdGlvbigpe3JldHVybiBYbyhHby5zY2FsZS5saW5lYXIoKSwkcyxYcyl9LEdvLnRleHQ9QXQoZnVuY3Rpb24obil7cmV0dXJuIG4ucmVzcG9uc2VUZXh0fSksR28uanNvbj1mdW5jdGlvbihuLHQpe3JldHVybiBDdChuLCJhcHBsaWNhdGlvbi9qc29uIixKbyx0KX0sR28uaHRtbD1mdW5jdGlvbihuLHQpe3JldHVybiBDdChuLCJ0ZXh0L2h0bWwiLFdvLHQpfSxHby54bWw9QXQoZnVuY3Rpb24obil7cmV0dXJuIG4ucmVzcG9uc2VYTUx9KSwiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZSgnZDMnLFtdLEdvKToib2JqZWN0Ij09dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9R286dGhpcy5kMz1Hb30oKTsKLyoqCiAqIHRoZSB3aWR0aCBoZWlnaHQgJiB4L3IgcmFuZ2UgYWxsIHRoZSBjaHJvbWF0byAmIHNwZWN0cmEgd2lsbCBzaGFyZQogKgogKiBmb2xsb3dpbmcgZDMsIHRoZXJlIGlzCiAqICogYSBkb21haW46IHJhbmdlIG9mICJyZWFsICIgdmFsdWVzCiAqICogYSByYW5nZTogdmlld3BvcnQgY29vcmVkaW5hdGVzCiAqICogb3JpZ0RvbWFpbiAoZG9tYWluIGF0IGxhcmdlLCBiZWZvcmUgem9vbSkKICoKICogJ3NjYWxlY2hhbmdlJyBldm50IGlzIHRyaWdnZXJlZCB3aGVuIGJvdW5kYXJpZXMgYXJlIGNoYW5nZWQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JyxbJ2QzJywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnXSwgZnVuY3Rpb24oZDMsIF8sIEJhY2tib25lKSB7CiAgdmFyIEQzU2NhbGluZ0NvbnRleHQgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKCiAgICAgIHRoaXMuX3hPcmlnRG9tYWluID0gKG9wdGlvbnMgJiYgb3B0aW9ucy54RG9tYWluICYmIG9wdGlvbnMueERvbWFpbi5zbGljZSgpKSB8fCBbMCwgMV07CiAgICAgIHRoaXMuX3lPcmlnRG9tYWluID0gKG9wdGlvbnMgJiYgb3B0aW9ucy55RG9tYWluICYmIG9wdGlvbnMueURvbWFpbi5zbGljZSgpKSB8fCBbMCwgMV07CiAgICAgIHRoaXMuX3hEb21haW4gPSB0aGlzLl94T3JpZ0RvbWFpbi5zbGljZSgpOwogICAgICB0aGlzLl95RG9tYWluID0gdGhpcy5feU9yaWdEb21haW4uc2xpY2UoKTsKCiAgICAgIHRoaXMuX3hSYW5nZSA9IFswLCAob3B0aW9ucyAmJiBvcHRpb25zLndpZHRoKSB8fCAzMzJdOwogICAgICB0aGlzLl95UmFuZ2UgPSBbKG9wdGlvbnMgJiYgb3B0aW9ucy5oZWlnaHQpIHx8IDY2NCwgMF07CgogICAgICB0aGlzLmNoYW5nZVhEb21haW5DYWxsQmFja3MgPSB7fTsKICAgICAgcmV0dXJuIHRoaXMKICAgIH0sCiAgICB3aWR0aCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhciBjaGFuZ2VkID0gdGhpcy5feFJhbmdlWzFdICE9IHY7CiAgICAgICAgdGhpcy5feFJhbmdlWzFdID0gdjsKICAgICAgICBpZiAoY2hhbmdlZCkgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdzY2FsZWNoYW5nZScsICdyZXNldCcpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feFJhbmdlWzFdOwogICAgfSwKICAgIGhlaWdodCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhciBjaGFuZ2VkID0gdGhpcy5feVJhbmdlWzBdICE9IHY7CiAgICAgICAgdGhpcy5feVJhbmdlWzBdID0gdjsKICAgICAgICBpZiAoY2hhbmdlZCkgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdzY2FsZWNoYW5nZScsICdyZXNldCcpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feVJhbmdlWzBdOwogICAgfSwKICAgIHggOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzLnNjYWxlLmxpbmVhcigpLmRvbWFpbih0aGlzLl94RG9tYWluKS5yYW5nZSh0aGlzLl94UmFuZ2UpOwogICAgfSwKICAgIHkgOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzLnNjYWxlLmxpbmVhcigpLmRvbWFpbih0aGlzLl95RG9tYWluKS5yYW5nZSh0aGlzLl95UmFuZ2UpCiAgICB9LAogICAgcmVzZXQgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgY2hhbmdlZCA9IHNlbGYuX3hEb21haW5bMF0gIT0gc2VsZi5feE9yaWdEb21haW5bMF0gfHwgc2VsZi5feERvbWFpblsxXSAhPSBzZWxmLl94T3JpZ0RvbWFpblsxXSB8fCBzZWxmLl95RG9tYWluWzBdICE9IHNlbGYuX3lPcmlnRG9tYWluWzBdIHx8IHNlbGYuX3lEb21haW5bMV0gIT0gc2VsZi5feU9yaWdEb21haW5bMV07CgogICAgICBzZWxmLl94RG9tYWluWzBdID0gc2VsZi5feE9yaWdEb21haW5bMF07CiAgICAgIHNlbGYuX3hEb21haW5bMV0gPSBzZWxmLl94T3JpZ0RvbWFpblsxXTsKICAgICAgc2VsZi5feURvbWFpblswXSA9IHNlbGYuX3lPcmlnRG9tYWluWzBdOwogICAgICBzZWxmLl95RG9tYWluWzFdID0gc2VsZi5feU9yaWdEb21haW5bMV07CiAgICAgIGlmIChjaGFuZ2VkKSB7CiAgICAgICAgc2VsZi50cmlnZ2VyKCdzY2FsZWNoYW5nZScsICdyZXNldCcpOwogICAgICB9CiAgICAgIC8vc2VsZi5maXJlQ2hhbmdlWFJhbmdlKCk7CiAgICB9LAogICAgcmVzZXRYIDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGNoYW5nZWQgPSBzZWxmLl94RG9tYWluWzBdICE9IHNlbGYuX3hPcmlnRG9tYWluWzBdIHx8IHNlbGYuX3hEb21haW5bMV0gIT0gc2VsZi5feE9yaWdEb21haW5bMV07CgogICAgICBzZWxmLl94RG9tYWluWzBdID0gc2VsZi5feE9yaWdEb21haW5bMF07CiAgICAgIHNlbGYuX3hEb21haW5bMV0gPSBzZWxmLl94T3JpZ0RvbWFpblsxXTsKICAgICAgaWYgKGNoYW5nZWQpIHsKICAgICAgICBzZWxmLnRyaWdnZXIoJ3NjYWxlY2hhbmdlJywgJ3Jlc2V0WCcpOwogICAgICB9CiAgICAgIHJldHVybiBzZWxmOwoKICAgICAgLy9zZWxmLmZpcmVDaGFuZ2VYUmFuZ2UoKTsKICAgIH0sCiAgICByZXNldFkgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgc2VsZi5feURvbWFpblswXSA9IHNlbGYuX3lPcmlnRG9tYWluWzBdOwogICAgICBzZWxmLl95RG9tYWluWzFdID0gc2VsZi5feU9yaWdEb21haW5bMV07CiAgICAgIC8vc2VsZi5maXJlQ2hhbmdlWFJhbmdlKCk7CiAgICAgIHJldHVybiBzZWxmOwogICAgfSwKICAgIHhNaW4gOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl94T3JpZ0RvbWFpblswXSA9IHY7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3hPcmlnRG9tYWluWzBdCiAgICB9LAogICAgeE1heCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX3hPcmlnRG9tYWluWzFdID0gdjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feE9yaWdEb21haW5bMV0KICAgIH0sCiAgICB5TWluIDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feU9yaWdEb21haW5bMF0gPSB2OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl95T3JpZ0RvbWFpblswXQogICAgfSwKICAgIHlNYXggOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl95T3JpZ0RvbWFpblsxXSA9IHY7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3lPcmlnRG9tYWluWzFdCiAgICB9LAoKICAgIHhPcmlnRG9tYWluIDogZnVuY3Rpb24odnMpIHsKICAgICAgaWYgKHZzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl94T3JpZ0RvbWFpbiA9IHZzLnNsaWNlKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3hPcmlnRG9tYWluLnNsaWNlKCkKICAgIH0sCiAgICB5T3JpZ0RvbWFpbiA6IGZ1bmN0aW9uKHZzKSB7CiAgICAgIGlmICh2cyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feU9yaWdEb21haW4gPSB2cy5zbGljZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl95T3JpZ0RvbWFpbi5zbGljZSgpCiAgICB9LAogICAgeERvbWFpbiA6IGZ1bmN0aW9uKHgwLCB4MSwgb3B0cykgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICB2YXIgb3B0aW9ucyA9IF8uZXh0ZW5kKHsKICAgICAgICBzaWxlbnQgOiBmYWxzZQogICAgICB9LCBvcHRzKQoKICAgICAgaWYgKHgwID09PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuIHNlbGYuX3hEb21haW4uc2xpY2UoKTsKCiAgICAgIGlmIChfLmlzQXJyYXkoeDApKSB7CiAgICAgICAgeDEgPSB4MFsxXTsKICAgICAgICB4MCA9IHgwWzBdOwogICAgICB9CiAgICAgIHZhciBjaGFuZ2VkID0geDAgIT0gc2VsZi5feERvbWFpblswXSB8fCB4MSAhPSBzZWxmLl94RG9tYWluWzFdOwogICAgICBzZWxmLl94RG9tYWluWzBdID0geDA7CiAgICAgIHNlbGYuX3hEb21haW5bMV0gPSB4MTsKCiAgICAgIGlmIChjaGFuZ2VkICYmICFvcHRpb25zLnNpbGVudCkgewogICAgICAgIHNlbGYudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAneERvbWFpbicpOwogICAgICB9CgogICAgICByZXR1cm4gc2VsZgogICAgICAvL3RoaXMuZmlyZUNoYW5nZVhSYW5nZSgpOwogICAgfSwKICAgIHlEb21haW4gOiBmdW5jdGlvbih5MCwgeTEsIG9wdHMpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgb3B0aW9ucyA9IF8uZXh0ZW5kKHsKICAgICAgICBzaWxlbnQgOiBmYWxzZQogICAgICB9LCBvcHRzKQoKICAgICAgaWYgKHkwID09PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuIHRoaXMuX3lEb21haW4uc2xpY2UoKTsKCiAgICAgIGlmIChfLmlzQXJyYXkoeTApKSB7CiAgICAgICAgeTEgPSB5MFsxXTsKICAgICAgICB5MCA9IHkwWzBdOwogICAgICB9CiAgICAgIHZhciBjaGFuZ2VkID0geTAgIT0gc2VsZi5feURvbWFpblswXSB8fCB5MSAhPSBzZWxmLl95RG9tYWluWzFdOwoKICAgICAgc2VsZi5feURvbWFpblswXSA9IHkwOwogICAgICBzZWxmLl95RG9tYWluWzFdID0geTE7CiAgICAgIGlmIChjaGFuZ2VkICYmICFvcHRpb25zLnNpbGVudCkgewogICAgICAgIHNlbGYudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAneURvbWFpbicpOwogICAgICB9CiAgICAgIHNlbGYuZmlyZUNoYW5nZVhEb21haW4oKTsKICAgICAgcmV0dXJuIHNlbGY7CiAgICB9LAogICAgaXNYWm9vbWVkIDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgcmV0dXJuIHNlbGYuX3hEb21haW5bMF0gPiBzZWxmLl94T3JpZ0RvbWFpblswXSB8fCBzZWxmLl94RG9tYWluWzFdIDwgc2VsZi5feE9yaWdEb21haW5bMV07CiAgICB9LAogICAgLyoKICAgICAqIHNldCB0aGUgbXhpbXVtIHggdmFsdWUsIHRoZSBvdmVyYWxsIG1heCBhbmQgdGhlIGN1cnJlbnQgb25lLgogICAgICogaWYgbGltaXRPbmx5LCB0aGVuIHdlIGp1c3QgbW9kaWZ5IHRoZSBvdmVyYWxsIGxpbWl0CiAgICAgKi8KICAgIHNldFhNYXggOiBmdW5jdGlvbihtLCBsaW1pdE9ubHkpIHsKICAgICAgdGhpcy5feE9yaWdEb21haW5bMV0gPSBtCiAgICAgIGlmIChsaW1pdE9ubHkpIHsKICAgICAgICB0aGlzLl94RG9tYWluWzFdID0gbQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIHNldFlNYXggOiBmdW5jdGlvbihtKSB7CiAgICAgIHRoaXMuX3lEb21haW5bMV0gPSB0aGlzLl95T3JpZ0RvbWFpblsxXSA9IG0KCiAgICB9LAogICAgYWRkQ2hhbmdlWERvbWFpbkNhbGxCYWNrIDogZnVuY3Rpb24obmFtZSwgZmN0KSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgc2VsZi5jaGFuZ2VYRG9tYWluQ2FsbEJhY2tzW25hbWVdID0gZmN0OwogICAgfSwKICAgIHJlbW92ZUNoYW5nZVhEb21haW5DYWxsQmFjayA6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBkZWxldGUgc2VsZi5jaGFuZ2VYRG9tYWluQ2FsbEJhY2tzW25hbWVdOwogICAgfSwKICAgIGZpcmVDaGFuZ2VYRG9tYWluIDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgXy5lYWNoKHNlbGYuY2hhbmdlWERvbWFpbkNhbGxCYWNrcywgZnVuY3Rpb24oZmN0LCBuYW1lKSB7CiAgICAgICAgZmN0KHNlbGYpOwogICAgICB9KTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIEQzU2NhbGluZ0NvbnRleHQ7Cgp9KTsKCi8qCiAqIGFyZWEgdG8gaGFuZGxlIG1vdmUvem9vbSBldGMuIGJ1dHRvbnMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhQnV0dG9ucycsWyd1bmRlcnNjb3JlJywgJ2QzJ10sIGZ1bmN0aW9uKF8sIGQzKXsKICAgIC8qKgogICAgICogc3ZnIGNvbnRhaW5lcgogICAgICogZDMtU2NhbGluZy1jb250ZXh0IChjb250YWlucyB0aGUgdmlld3BvcnQgYW5kIGRvbWFpbnMgYm91bmRhcmllcwogICAgICogYSBjYWxsIGJhY2sgdG8gYmUgY2FsbGVkIHdoZW4gem9vbWVkCiAgICAgKi8KICAgIEQzU2NhbGluZ0FyZWFCdXR0b25zID0gZnVuY3Rpb24oY29udGFpbmVyLCBjb250ZXh0LCBjYWxsYmFjaywgb3B0aW9ucykgewogICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYuY29udGV4dCA9IGNvbnRleHQ7CiAgICAgICAgc2VsZi5jb250YWluZXIgPSBjb250YWluZXI7CiAgICAgICAgc2VsZi5jYWxsYmFjayA9IGNhbGxiYWNrCiAgICAgICAgc2VsZi5oZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCAzMDsKCiAgICAgICAgc2VsZi5jb250YWluZXIuYXR0cignd2lkdGgnLCBjb250ZXh0LndpZHRoKTsKICAgICAgICBzZWxmLmNvbnRhaW5lci5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCk7CgogICAgICAgIHNlbGYucF9zZXR1cCA9IHBfc2V0dXA7CgogICAgICAgIHNlbGYucF9zZXR1cCgpCgogICAgfQogICAgICByZXR1cm4gRDNTY2FsaW5nQXJlYUJ1dHRvbnM7Cgp9KTsKLyoKICogc3ZnIGNvbnRhaW5lciBmb3IgdGhlIGNvbW1vbiBzY2FsaW5nZiBhcmVhLgogKgogKiBkMy1TY2FsaW5nLWNvbnRleHQgKGNvbnRhaW5zIHRoZSB2aWV3cG9ydCBhbmQgZG9tYWlucyBib3VuZGFyaWVzCiAqIGEgY2FsbCBiYWNrIHRvIGJlIGNhbGxlZCB3aGVuIHpvb21lZAogKiAqIG1vZGVsOiBzY2FsaW5nQ29udGV4dCwKICogKiBlbDogY29udGFpbmVyLAogKiAqIGNhbGxiYWNrOiBjYWxsIGJhY2sgd2hlbiB6b29tZWQgaGFzIGJlZW4gY2FsbGVkIChmb3IgIHN0dHVkZmYgbm90IHRyaWdnZXJlIGJ5IHNjYWxlY2hhbmdlIGV2ZW50cykKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0FyZWEnLFsndW5kZXJzY29yZScsICdkMycsICdCYWNrYm9uZScsICcuL0QzU2NhbGluZ0FyZWFCdXR0b25zJ10sIGZ1bmN0aW9uIChfLCBkMywgQmFja2JvbmUsIEQzU2NhbGluZ0FyZWFCdXR0b25zKSB7CiAgICB2YXIgRDNTY2FsaW5nQXJlYSA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgey8vY29udGFpbmVyLCBjb250ZXh0LCBjYWxsYmFjaywgb3B0aW9ucykgewoKICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmNhbGxiYWNrID0gb3B0aW9ucy5jYWxsYmFjazsKCiAgICAgICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgc2VsZi5tb2RlbC5oZWlnaHQoKSB8fCAzMDsKCiAgICAgICAgICAgIHZhciBlbCA9IF8uaXNBcnJheShzZWxmLmVsKSA/IHNlbGYuZWxbMF0gOiBzZWxmLmVsOwogICAgICAgICAgICBzZWxmLmNvbnRhaW5lciA9IGQzLnNlbGVjdChlbCkuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgIHNlbGYuY29udGFpbmVyLmF0dHIoJ3dpZHRoJywgb3B0aW9ucy53aWR0aCB8fCBzZWxmLm1vZGVsLndpZHRoKCkpOwogICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCk7CgogICAgICAgICAgICBzZWxmLnBfc2V0dXAoKQoKICAgICAgICB9LAogICAgICAgIHVwZGF0ZVNjYWxpbmdDb250ZXh0OiBmdW5jdGlvbiAoY3R4KSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5tb2RlbCA9IGN0eDsKCiAgICAgICAgfSwKICAgICAgICBwX3NldHVwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciBnID0gc2VsZi5jb250YWluZXIuaW5zZXJ0KCJnIiwgIjpmaXJzdC1jaGlsZCIpCiAgICAgICAgICAgIC8vdmFyIHJlY3QgPSBnLmluc2VydCgicmVjdCIsICI6Zmlyc3QtY2hpbGQiKS5hdHRyKCd4JywgMCkuYXR0cigneScsIDApLmF0dHIoJ3dpZHRoJywgJzEwMCUnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ2ZpbGwtb3BhY2l0eScsICcwJScpLmF0dHIoJ2NsYXNzJywgJ3pvb20tYXJlYScpOwoKICAgICAgICAgICAgc2VsZi5wX3NldHVwX2J1dHRvbnMoKTsKCiAgICAgICAgICAgIC8vIHNlbGYuem9vbSA9IGQzLmJlaGF2aW9yLnpvb20oKS54KHNlbGYuY29udGV4dC54U2NhbGUpLnNjYWxlRXh0ZW50KFsxLCAxODBdKS5vbigiem9vbSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAvLyBzZWxmLmNhbGxiYWNrKCk7CiAgICAgICAgICAgIC8vIHNlbGYuY29udGV4dC5maXJlQ2hhbmdlWFJhbmdlKCk7CiAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAvLyAgIHNlbGYuY29udGFpbmVyLmNhbGwoc2VsZi56b29tKTsKICAgICAgICB9LAogICAgICAgIHBfc2V0dXBfYnV0dG9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgc2NhbGluZ0NvbnRleHQgPSBzZWxmLm1vZGVsOwogICAgICAgICAgICBzZWxmLmJ1dHRvbnMgPSB7fTsKICAgICAgICAgICAgdmFyIGcgPSBzZWxmLmNvbnRhaW5lci5pbnNlcnQoImciKS5hdHRyKCdjbGFzcycsICdzY2FsaW5nLWFyZWEtbWVudScpOwoKICAgICAgICAgICAgdmFyIGlCdXR0b24gPSAwOwogICAgICAgICAgICB2YXIgZmN0QWRkQnV0dG9uID0gZnVuY3Rpb24gKG5hbWUsIHRleHQsIGZJc1Nob3dpbmcsIGZBY3Rpb24pIHsKICAgICAgICAgICAgICAgIHZhciBnYnV0ID0gZy5pbnNlcnQoImciKS5hdHRyKCdjbGFzcycsICdzY2FsaW5nLWFyZWEtbWVudS1vbmUtYnV0dG9uJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgyMCwnICsgKDEwICsgaUJ1dHRvbiAqIDI3KSArICcpJyk7CiAgICAgICAgICAgICAgICB2YXIgcmVjdCA9IGdidXQuaW5zZXJ0KCJyZWN0IikuYXR0cignY2xhc3MnLCAnYnV0dG9uJykuYXR0cigneCcsIDApLmF0dHIoJ3knLCAwKS5hdHRyKCd3aWR0aCcsIDgwKS5hdHRyKCdyeCcsIDUpLmF0dHIoJ3J5JywgNSkuYXR0cignaGVpZ2h0JywgMjIpOwogICAgICAgICAgICAgICAgZ2J1dC5hcHBlbmQoJ3RleHQnKS5hdHRyKCJ4IiwgNDApLmF0dHIoInkiLCAxMSkudGV4dCh0ZXh0KTsKICAgICAgICAgICAgICAgIHNlbGYuYnV0dG9uc1tuYW1lXSA9IHsKICAgICAgICAgICAgICAgICAgICBlbDogZ2J1dCwKICAgICAgICAgICAgICAgICAgICBpc1Nob3dpbmc6IGZJc1Nob3dpbmcsCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBmQWN0aW9uCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdmFyIGdPdmVyID0gZ2J1dC5pbnNlcnQoInJlY3QiKS5hdHRyKCdjbGFzcycsICdvdmVyLWJ1dHRvbicpLmF0dHIoJ3gnLCAwKS5hdHRyKCd5JywgMCkuYXR0cignd2lkdGgnLCA4MCkuYXR0cigncngnLCA1KS5hdHRyKCdyeScsIDUpLmF0dHIoJ2hlaWdodCcsIDIyKTsKICAgICAgICAgICAgICAgIGdidXQub24oJ2NsaWNrJywgZkFjdGlvbik7CgogICAgICAgICAgICAgICAgZ2J1dC5zdHlsZSgnZGlzcGxheScsIGZJc1Nob3dpbmcoKSA/IG51bGwgOiAnbm9uZScpOwogICAgICAgICAgICAgICAgaUJ1dHRvbisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZjdEFkZEJ1dHRvbignem9vbU91dCcsICd6b29tIG91dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLm1vZGVsLmlzWFpvb21lZCgpOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLm1vZGVsLnJlc2V0KCk7CiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBzZWxmLmxpc3RlblRvKHNjYWxpbmdDb250ZXh0LCAnc2NhbGVjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfLmVhY2goc2VsZi5idXR0b25zLCBmdW5jdGlvbiAoYnV0Q29uZiwgbmFtZSkgewogICAgICAgICAgICAgICAgICAgIGJ1dENvbmYuZWwuc3R5bGUoJ2Rpc3BsYXknLCBidXRDb25mLmlzU2hvd2luZygpID8gbnVsbCA6ICdub25lJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKCiAgICAgICAgfSwKICAgICAgICBoaWRlQWxsQnV0dG9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIF8uZWFjaChzZWxmLmJ1dHRvbnMsIGZ1bmN0aW9uIChidXRDb25mLCBuYW1lKSB7CiAgICAgICAgICAgICAgICBidXRDb25mLmVsLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTsKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBEM1NjYWxpbmdBcmVhOwoKfSk7CgovKioKICogQW4gYWJzdHJhY3QgY2xhc3MgZm9yIEQzV2lkZ2V0IG9yaWVudGVkIHZpZXdzCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZDMnLCAnLi4vdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICcuLi91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBkMywgRDNTY2FsaW5nQ29udGV4dCwgRDNTY2FsaW5nQXJlYSkgewogIHZhciBLRVlQUkVTU0VEX05PTkUgPSAwOwogIHZhciBLRVlQUkVTU0VEX1NISUZUID0gMTsKICB2YXIgS0VZUFJFU1NFRF9BTFQgPSAyOwogIHZhciBET1VCTEVfQ0xJQ0sgPSA0OwoKICBDb21tb25XaWRnZXRWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIGVsVG1wID0gXy5pc0FycmF5KHNlbGYuZWwpID8gc2VsZi5lbFswXSA6IHNlbGYuZWwKICAgICAgaWYgKCQoZWxUbXApLnByb3AoInRhZ05hbWUiKS50b0xvd2VyQ2FzZSgpID09PSAnZGl2JykgewogICAgICAgIHNlbGYuZWwgPSBkMy5zZWxlY3QoZWxUbXApLmFwcGVuZCgnc3ZnJykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCd3aWR0aCcsICcxMDAlJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZi5lbCA9IGQzLnNlbGVjdChlbFRtcCk7CiAgICAgIH0KCiAgICAgIGlmIChzZWxmLnNjYWxpbmdDb250ZXh0KSB7CiAgICAgICAgc2VsZi54Wm9vbWFibGUoKQogICAgICB9CiAgICAgIHNlbGYuYnJ1c2hDYWxsYmFja3MgPSB7fTsKCiAgICAgIGlmICgkKGVsVG1wKS5wcm9wKCd0YWdOYW1lJykudG9Mb3dlckNhc2UoKSA9PT0gJ3N2ZycpIHsKICAgICAgICBzZWxmLl9oZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCAkKGVsVG1wKS5wYXJlbnQoKS5oZWlnaHQoKSB8fCAzMDA7CiAgICAgICAgc2VsZi5fd2lkdGggPSBvcHRpb25zLndpZHRoIHx8ICQoZWxUbXApLnBhcmVudCgpLndpZHRoKCkgfHwgMjAwOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGYuX2hlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8ICQoZWxUbXApLmhlaWdodCgpIHx8IDMwMDsKICAgICAgICBzZWxmLl93aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgJChlbFRtcCkud2lkdGgoKSB8fCAyMDA7CiAgICAgIH0KCiAgICB9LAogICAgaGVpZ2h0IDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5faGVpZ2h0ID0gdjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5faGVpZ2h0OwogICAgfSwKICAgIHdpZHRoIDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5fd2lkdGggPSB2OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl93aWR0aDsKICAgIH0sCiAgICAvKioKICAgICAqIGdldCB0aGUgc2NhbGluZ0NvbnRleHQgZnJvbSB0aGUgb3B0aW9ucyAoY29udHJ1Y3RvciBvcmllbnRlZCkgb3IgZGVmaW5lIGEgbmV3IG9uZQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgICAqLwogICAgc2V0dXBTY2FsaW5nQ29udGV4dCA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgICAgIGlmIChvcHRpb25zLnNjYWxpbmdDb250ZXh0ICE9IHVuZGVmaW5lZCkgewogICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQgPSBvcHRpb25zLnNjYWxpbmdDb250ZXh0OwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChzZWxmLnNjYWxpbmdDb250ZXh0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQgPSBuZXcgRDNTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgICAgIGhlaWdodCA6IHNlbGYuX2hlaWdodCwKICAgICAgICAgICAgd2lkdGggOiBzZWxmLl93aWR0aAogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy54RG9tYWluKSB7CiAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnhPcmlnRG9tYWluKG9wdGlvbnMueERvbWFpbik7CiAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnhEb21haW4ob3B0aW9ucy54RG9tYWluKTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMueURvbWFpbikgewogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC55T3JpZ0RvbWFpbihvcHRpb25zLnlEb21haW4pOwogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC55RG9tYWluKG9wdGlvbnMueURvbWFpbik7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLmhlaWdodCkgewogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5oZWlnaHQob3B0aW9ucy5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy53aWR0aCkgewogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC53aWR0aChvcHRpb25zLndpZHRoKTsKICAgICAgICB9CgogICAgICB9CiAgICAgIHNlbGYubGlzdGVuVG8oc2VsZi5zY2FsaW5nQ29udGV4dCwgJ3NjYWxlY2hhbmdlJywgZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgc2VsZi5yZW5kZXIoewogICAgICAgICAgY2F1c2UgOiB7CiAgICAgICAgICAgIG5hbWUgOiBldnQsCiAgICAgICAgICAgIGlkIDogTWF0aC5yYW5kb20oKQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KQogICAgfSwKICAgIC8qKgogICAgICogYWRkIGEgRDNTY2FsaW5nQXJlLCBpLmUuIGEgeC16b29tYWJsZSBhcmVhCiAgICAgKi8KICAgIHhab29tYWJsZSA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICB2YXIgYWRhcHRZRG9tYWluID0gZnVuY3Rpb24oeHMpIHsKICAgICAgICBpZiAoIXNlbGYuZ2V0TWF4WUluWERvbWFpbikKICAgICAgICAgIHJldHVybgogICAgICAgIHZhciB5bWF4ID0gc2VsZi5nZXRNYXhZSW5YRG9tYWluKHhzWzBdLCB4c1sxXSk7CiAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC55RG9tYWluKDAsIHltYXgsIHsKICAgICAgICAgIHNpbGVudCA6IHRydWUKICAgICAgICB9KTsKCiAgICAgIH0KCiAgICAgIHNlbGYuc2V0dXBJbnRlcmFjdGl2ZSgpOwogICAgICBzZWxmLnNldEJydXNoQ2FsbGJhY2soS0VZUFJFU1NFRF9OT05FLCBmdW5jdGlvbih4cykgewogICAgICAgIGFkYXB0WURvbWFpbih4cykKICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnhEb21haW4oeHMpCiAgICAgIH0pCiAgICAgIHNlbGYuc2V0QnJ1c2hDYWxsYmFjayhET1VCTEVfQ0xJQ0ssIGZ1bmN0aW9uKHhzKSB7CiAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5yZXNldCgpCiAgICAgIH0pCiAgICB9LAoKICAgIHNldFNoaWZ0U2VsZWN0Q2FsbGJhY2sgOiBmdW5jdGlvbihmKSB7CiAgICAgIHRoaXMuc2V0QnJ1c2hDYWxsYmFjayhLRVlQUkVTU0VEX1NISUZULCBmKTsKICAgIH0sCgogICAgc2V0dXBJbnRlcmFjdGl2ZSA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIGlmIChzZWxmLmJydXNoICE9PSB1bmRlZmluZWQpCiAgICAgICAgcmV0dXJuOwoKICAgICAgc2VsZi5lbC5zZWxlY3RBbGwoJy56b29tLWFyZWEnKS5yZW1vdmUoKQogICAgICBpZiAoc2VsZi5zY2FsaW5nQXJlYSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgc2VsZi5zY2FsaW5nQXJlYS51cGRhdGVTY2FsaW5nQ29udGV4dChzZWxmLnNjYWxpbmdDb250ZXh0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxmLnNjYWxpbmdBcmVhID0gbmV3IEQzU2NhbGluZ0FyZWEoewogICAgICAgICAgZWwgOiBzZWxmLnZpcyB8fCBzZWxmLmVsLAogICAgICAgICAgbW9kZWwgOiBzZWxmLnNjYWxpbmdDb250ZXh0LAogICAgICAgICAgY2FsbGJhY2sgOiBmdW5jdGlvbigpIHsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIGdCcnVzaCA9IChzZWxmLnZpcyB8fCBzZWxmLmVsKS5pbnNlcnQoJ2cnLCAnOmZpcnN0LWNoaWxkJykuYXR0cignY2xhc3MnLCAneC1zZWxlY3RvcicpOwogICAgICBnQnJ1c2guYXBwZW5kKCdyZWN0JykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCd3aWR0aCcsICcxMDAlJykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpOwogICAgICB2YXIgbGVmdEhpZGVyID0gZ0JydXNoLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2hpZGVyIGxlZnQnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ3dpZHRoJywgMCkuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpOwogICAgICB2YXIgcmlnaHRIaWRlciA9IGdCcnVzaC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsICdoaWRlciByaWdodCcpLmF0dHIoJ2hlaWdodCcsICcxMDAlJykuYXR0cignd2lkdGgnLCAnMTAwJScpLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTsKCiAgICAgIHZhciB0U3RhbXAgPSAwOwogICAgICB2YXIgaXNEYmxDbGljayA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBkID0gbmV3IERhdGUoKTsKICAgICAgICB2YXIgdDEgPSBkLmdldE1pbGxpc2Vjb25kcygpICsgMTAwMCAqIChkLmdldFNlY29uZHMoKSArIDYwICogZC5nZXRNaW51dGVzKCkpCiAgICAgICAgdmFyIGIgPSAodDEgLSB0U3RhbXApIDwgNDUwCiAgICAgICAgdFN0YW1wID0gdDE7CiAgICAgICAgcmV0dXJuIGI7CiAgICAgIH0KICAgICAgdmFyIGJydXNoID0gZDMuc3ZnLmJydXNoKCkub24oImJydXNoc3RhcnQiLCBmdW5jdGlvbigpIHsKICAgICAgICBicnVzaC54KHNlbGYuc2NhbGluZ0NvbnRleHQueCgpKTsKICAgICAgICBsZWZ0SGlkZXIuc3R5bGUoJ2Rpc3BsYXknLCBudWxsKQogICAgICAgIHJpZ2h0SGlkZXIuc3R5bGUoJ2Rpc3BsYXknLCBudWxsKQoKICAgICAgfSkub24oImJydXNoIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGJvdW5kcyA9IGJydXNoLmV4dGVudCgpCiAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKQogICAgICAgIGxlZnRIaWRlci5hdHRyKCd3aWR0aCcsIHgoYm91bmRzWzBdKSkKICAgICAgICByaWdodEhpZGVyLmF0dHIoJ3gnLCB4KGJvdW5kc1sxXSkpCgogICAgICB9KS5vbigiYnJ1c2hlbmQiLCBmdW5jdGlvbigpIHsKICAgICAgICB2YXIga3AgPSBnZXRLZXlQcmVzc2VkKCk7CiAgICAgICAgdmFyIGJvdW5kcyA9IGJydXNoLmV4dGVudCgpCiAgICAgICAgaWYgKGlzRGJsQ2xpY2soKSkgewogICAgICAgICAgc2VsZi5icnVzaENhbGxiYWNrc1tET1VCTEVfQ0xJQ0tdKCkKICAgICAgICB9IGVsc2UgaWYgKChib3VuZHNbMV0gLSBib3VuZHNbMF0pID49IDAuMDAxICogc2VsZi5zY2FsaW5nQ29udGV4dC54TWF4KCkpIHsKICAgICAgICAgIGlmIChzZWxmLmJydXNoQ2FsbGJhY2tzW2twXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHNlbGYuYnJ1c2hDYWxsYmFja3Nba3BdKGJvdW5kcykKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGVmdEhpZGVyLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKQogICAgICAgIHJpZ2h0SGlkZXIuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpCiAgICAgIH0pOwoKICAgICAgYnJ1c2gueChzZWxmLnNjYWxpbmdDb250ZXh0LngoKSk7CiAgICAgIGJydXNoKGdCcnVzaCk7CgogICAgfSwKICAgIHNldEJydXNoQ2FsbGJhY2sgOiBmdW5jdGlvbihrZXlNYXNrLCBmKSB7CiAgICAgIHRoaXMuYnJ1c2hDYWxsYmFja3Nba2V5TWFza10gPSBmCiAgICB9CiAgfSk7CgogIHZhciBnZXRLZXlQcmVzc2VkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaSA9IDA7CiAgICBpZiAoZDMuZXZlbnQuc291cmNlRXZlbnQuc2hpZnRLZXkpCiAgICAgIGkgfD0gS0VZUFJFU1NFRF9TSElGVDsKCiAgICBpZiAoZDMuZXZlbnQuc291cmNlRXZlbnQuYWx0S2V5KQogICAgICBpIHw9IEtFWVBSRVNTRURfQUxUOwogICAgcmV0dXJuIGkKICB9CiAgcmV0dXJuIENvbW1vbldpZGdldFZpZXc7Cn0pOwoKCi8qKgogKiB1dGlsaXR5IG1ldGhvZCB0aGF0IHdpbGwgYXBwbHkgYSByZWd1bGFyIGV4cHJlc3Npb24gb250byBhIHN0cmluZywgYXNzdW1pbmcgdGhhdCBhbGwgYWwgdGhlIHN0cmluZyBpcyBjYXB0aXJlZCBieSB0aGUgcmVnIGV4cCAobm8gaG9sZXMpCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdXRpbHMvUmVnRXhwRnVsbFNwbGl0ZXInLFsndW5kZXJzY29yZSddLCBmdW5jdGlvbiAoXykgewogICAgUmVnRXhwRnVsbFNwbGl0ZXIgPSBmdW5jdGlvbiAob3B0aW9ucykgewoKICAgIH0KICAgIC8qKgogICAgICogYWxsIG1hdGNoIGNhdHB1cmUgYnkgdGhlIHJlZ2V4cCBhcmUgcmV0dXJuZWQgaW4gYW4gYXJyYXksCiAgICAgKiBJZiBzb21lIHBpZWNlIG9mIHRoZSBzdHJpbmcgaXMgbm90IGNvdmVyZWQsIHRoZW4gYW4gRXhjZXB0aW9uIGlzIHRocm93bgogICAgICogcmVnZXhwIGlzIGR1cGxpY2F0ZSB0byBhdm9pZCBzeW5jIHByb2JsZW0gb24gbGFzdEluZGV4T2YgYW5kIHRoaXMga2luZCBvZiB0aGluZ3MuLi4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZWdleHAgaXMgYSBzdHJpbmcgb3IgcmVnZXhwCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc3RyCiAgICAgKi8KICAgIFJlZ0V4cEZ1bGxTcGxpdGVyLnByb3RvdHlwZS5zcGxpdCA9IGZ1bmN0aW9uIChyZWdleHAsIHN0cikgewogICAgICAgIHZhciByZXQgPSBbXQoKICAgICAgICB2YXIgcmUKICAgICAgICBpZiAocmVnZXhwIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgICAgIHJlID0gbmV3IFJlZ0V4cChyZWdleHAuc291cmNlLCAnZycpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmUgPSBuZXcgUmVnRXhwKHJlZ2V4cCwgJ2cnKQogICAgICAgIH0KICAgICAgICByZS5nbG9iYWwgPSB0cnVlCgogICAgICAgIHZhciBwb3NNYXRjaCA9IDAKICAgICAgICB3aGlsZSAobSA9IHJlLmV4ZWMoc3RyKSkgewogICAgICAgICAgICBpZiAobS5pbmRleCAhPSBwb3NNYXRjaCkgewogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdSZWdleHBGdWxsU2VxdWVuY2VDb3ZlcmFnZScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2Nhbm5vdCBjaGFyYWN0ZXIgYXQgcG9zIFsnICsgcG9zTWF0Y2ggKyAnLScgKyBtLmluZGV4ICsgJ10gKCcgKyBzdHIuc3Vic3RyaW5nKHBvc01hdGNoLCBtLmluZGV4KSArICcpIGluICInICsgc3RyICsgJyIgaXMgbm90IGNvdmVyZWQgYnkgcmVndWxhciBleHByZXNzaW9uICcgKyByZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHBvc01hdGNoID0gcmUubGFzdEluZGV4OwoKICAgICAgICAgICAgcmV0LnB1c2gobSkKICAgICAgICB9CiAgICAgICAgaWYgKHN0ci5sZW5ndGggIT0gcG9zTWF0Y2gpIHsKICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgbmFtZTogJ1JlZ2V4cEZ1bGxTZXF1ZW5jZUNvdmVyYWdlJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdjYW5ub3QgY2hhcmFjdGVyIGF0IHBvcyBbJyArIHBvc01hdGNoICsgJy0nICsgbS5pbmRleCArICddICgnICsgc3RyLnN1YnN0cmluZyhwb3NNYXRjaCwgbS5pbmRleCkgKyAnKSBpbiAiJyArIHN0ciArICciIGlzIG5vdCBjb3ZlcmVkIGJ5IHJlZ3VsYXIgZXhwcmVzc2lvbiAnICsgcmUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0CiAgICB9CgogICAgcmV0dXJuIFJlZ0V4cEZ1bGxTcGxpdGVyCn0pOwoKLyoKICogQW1pbm9BY2lkIG9iamVjdC4KICAqIFByb3BlcnRpZXM6CiAgKiAtIGEgY29kZTEgKG9uZSBsZXR0ZXIpLAogICogLSBhIG1hc3MuCiAgKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9BbWlub0FjaWQnLFsnQmFja2JvbmUnXSwgZnVuY3Rpb24oQmFja2JvbmUpIHsKCiAgICB2YXIgQW1pbm9BY2lkID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBpZEF0dHJpYnV0ZSA6ICdjb2RlMScsCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgICAgIG1hc3MgOiAtMQogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCiAgICAgICAgdG9TdHJpbmcgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ2NvZGUxJyk7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIEFtaW5vQWNpZDsKfSk7CgovKgogKiBhbWlubyBhY2lkIGRlZmluaXRpb24sIGxvYWRlZCBieSBjb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkaWN0aW9uYXJ5CiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvZGF0YS9hbWlub0FjaWRzJyxbXSxmdW5jdGlvbigpIHsKICAgIHJldHVybiBbewogICAgICAgIGNvZGUxIDogIkEiLAogICAgICAgICJtYXNzIiA6IDcxLjAzNzExNAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiUiIsCiAgICAgICAgIm1hc3MiIDogMTU2LjEwMTExMQogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiTiIsCiAgICAgICAgIm1hc3MiIDogMTE0LjA0MjkyNwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiRCIsCiAgICAgICAgIm1hc3MiIDogMTE1LjAyNjk0MwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiQyIsCiAgICAgICAgIm1hc3MiIDogMTAzLjAwOTE4NQogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiRSIsCiAgICAgICAgIm1hc3MiIDogMTI5LjA0MjU5MwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiUSIsCiAgICAgICAgIm1hc3MiIDogMTI4LjA1ODU3OAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiRyIsCiAgICAgICAgIm1hc3MiIDogNTcuMDIxNDY0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJIIiwKICAgICAgICAibWFzcyIgOiAxMzcuMDU4OTEyCiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJJIiwKICAgICAgICAibWFzcyIgOiAxMTMuMDg0MDY0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJMIiwKICAgICAgICAibWFzcyIgOiAxMTMuMDg0MDY0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJLIiwKICAgICAgICAibWFzcyIgOiAxMjguMDk0OTYzCiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJNIiwKICAgICAgICAibWFzcyIgOiAxMzEuMDQwNDg1CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJGIiwKICAgICAgICAibWFzcyIgOiAxNDcuMDY4NDE0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJQIiwKICAgICAgICAibWFzcyIgOiA5Ny4wNTI3NjQKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlMiLAogICAgICAgICJtYXNzIiA6IDg3LjAzMjAyOAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiVCIsCiAgICAgICAgIm1hc3MiIDogMTAxLjA0NzY3OQogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiVyIsCiAgICAgICAgIm1hc3MiIDogMTg2LjA3OTMxMwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiWSIsCiAgICAgICAgIm1hc3MiIDogMTYzLjA2MzMyCiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJWIiwKICAgICAgICAibWFzcyIgOiA5OS4wNjg0MTQKICAgIH1dCn0pOwoKLyoKICogQSBzaW5nbGV0b24gYW1pbm8gYWNpZCBkaWN0aW9uYXJ5LCBsb2FkZWQgZnJvbSBqc29uIGZpbCBkYXRhL2FtaW5vQWNpZC5qcwogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsWydmaXNodG9uZXMvbW9kZWxzL2RyeS9BbWlub0FjaWQnLCAnZmlzaHRvbmVzL2RhdGEvYW1pbm9BY2lkcyddLCBmdW5jdGlvbihBbWlub0FjaWQsIGJzX2FtaW5vYWNpZHMpIHsKICAgIHZhciBBbWlub0FjaWREaWN0aW9uYXJ5ID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewoKICAgICAgICBtb2RlbCA6IEFtaW5vQWNpZCwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5hZGQoYnNfYW1pbm9hY2lkcyk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbmV3IEFtaW5vQWNpZERpY3Rpb25hcnkoKTsKfSk7CgovKgogKiBBIFJlc2lkdWVNb2RpZmljYXRpb24gUE9KTywgd2lodCBwcm9wZXJ0aWVzCiAqICAtIG5hbWUgKHVuaXF1ZSBhY3Jvc3MgdGhlIGRpY3Rpb25hcnkKICogIC0gbWFzcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbicsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZSddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSkgewoKICAgIHZhciBSZXNpZHVlTW9kaWZpY2F0aW9uID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBpZEF0dHJpYnV0ZTonbmFtZScsCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgICAgIG1hc3MgOiAtMQogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCiAgICAgICAgdG9TdHJpbmcgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ25hbWUnKSArICcoJytzZWxmLmdldCgnbWFzcycpKycpJzsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gUmVzaWR1ZU1vZGlmaWNhdGlvbjsKfSk7CgovKgogKiBhIGpzb24gcG9ydCBvZiBVbmltb2QgKyBzb21lIGN1c3RvbSBtb2RpZnMuCiAqIGxvYWRlZCBieSBjb2xsZWN0aW9ucy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbkRpY3Rpb25hcnkKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9kYXRhL3Jlc2lkdWVNb2RpZmljYXRpb25zJyxbXSxmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUElDIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBJQyIsCiAgICAgICAgICAgICJtYXNzIjogMTE5LjAzNzExNCwKICAgICAgICAgICAgZm9ybXVsYTogJ0M3T05INScKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUElDX0hFQVZZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBJQ19IRUFWWSIsCiAgICAgICAgICAgICJtYXNzIjogMTI1LjA1NzI0Mjk4LAogICAgICAgICAgICBmb3JtdWxhOiAnQzdPTkg1JwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tQSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tQSIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMDcwOTk0MDY2LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tQyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tQyIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMDcwOTk0MDY2LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tRCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tRCIsCiAgICAgICAgICAgICJtYXNzIjogNS4wMTA0NTQyNDQ0LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tRSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tRSIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkwODIyLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tRiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tRiIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDI3MjI4NDMzNCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tIiwKICAgICAgICAgICAgIm1hc3MiOiAzLjAwMzc0NDU2ODgsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1IIiwKICAgICAgICAgICAgIm1hc3MiOiA5LjAxMTIzMzcwNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUkiLAogICAgICAgICAgICAibWFzcyI6IDcuMDE3MTYzOTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUsiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUsiLAogICAgICAgICAgICAibWFzcyI6IDguMDE0MTk4ODEzMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tTCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tTCIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTcxNjM5MgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tTSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tTSIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkwODIyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1OIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAwNzQ4OTEzNzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLVAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLVAiLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5MDgyMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tUSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tUSIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTA4NDM5NzU0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1SIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMDgyNjg1OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1TIiwKICAgICAgICAgICAgIm1hc3MiOiA0LjAwNzA5OTQwNjYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLVQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLVQiLAogICAgICAgICAgICAibWFzcyI6IDUuMDEwNDU0MjQ0NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tViIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkwODIyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1XIiwKICAgICAgICAgICAgIm1hc3MiOiAxMy4wMzA5NzMwMDIyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1ZIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMjcyMjg0MzM0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFjZXR5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBY2V0eWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDEwNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFtaWRhdGVkIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFtaWRhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogLTAuOTg0MDE2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJpb3RpbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCaW90aW55bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyMjYuMDc3NTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhcmJhbWlkb21ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJb2RvYWNldGFtaWRlIGRlcml2YXRpdmUiLAogICAgICAgICAgICAibWFzcyI6IDU3LjAyMTQ2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDYXJiYW15bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDYXJiYW15bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA0My4wMDU4MTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ2FyYm94eW1ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJb2RvYWNldGljIGFjaWQgZGVyaXZhdGl2ZSIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDA1NDc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRlYW1pZGF0ZWQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRGVhbWlkYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDAuOTg0MDE2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk1ldC0+SHNlIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhvbW9zZXJpbmUiLAogICAgICAgICAgICAibWFzcyI6IC0yOS45OTI4MDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTWV0LT5Ic2wiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSG9tb3NlcmluZSBsYWN0b25lIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDguMDAzMzcxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk5JUENBTSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOLWlzb3Byb3B5bGNhcmJveGFtaWRvbWV0aHlsIiwKICAgICAgICAgICAgIm1hc3MiOiA5OS4wNjg0MTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUGhvc3BobyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaG9zcGhvcnlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDc5Ljk2NjMzMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEZWh5ZHJhdGVkIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkRlaHlkcmF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTguMDEwNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlByb3Bpb25hbWlkZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBY3J5bGFtaWRlIGFkZHVjdCIsCiAgICAgICAgICAgICJtYXNzIjogNzEuMDM3MTE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlB5cm8tY2FyYmFtaWRvbWV0aHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlMtY2FyYmFtb3lsbWV0aHlsY3lzdGVpbmUgY3ljbGl6YXRpb24gKE4tdGVybWludXMpIiwKICAgICAgICAgICAgIm1hc3MiOiAzOS45OTQ5MTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2x1LT5weXJvLUdsdSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQeXJvLWdsdSBmcm9tIEUiLAogICAgICAgICAgICAibWFzcyI6IC0xOC4wMTA1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2xuLT5weXJvLUdsdSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQeXJvLWdsdSBmcm9tIFEiLAogICAgICAgICAgICAibWFzcyI6IC0xNy4wMjY1NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ2F0aW9uOk5hIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNvZGl1bSBhZGR1Y3QiLAogICAgICAgICAgICAibWFzcyI6IDIxLjk4MTk0MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQeXJpZHlsZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUy1weXJpZHlsZXRoeWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMTA1LjA1Nzg0OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0aHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk94aWRhdGlvbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJPeGlkYXRpb24gb3IgSHlkcm94eWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTk0OTE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRpbWV0aHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImRpLU1ldGh5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRyaW1ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJ0cmktTWV0aHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDQyLjA0Njk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk1ldGh5bHRoaW8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmV0YS1tZXRoeWx0aGlvbGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA0NS45ODc3MjEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiU3VsZm8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTy1TdWxmb25hdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNzkuOTU2ODE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIZXhvc2UiLAogICAgICAgICAgICAibWFzcyI6IDE2Mi4wNTI4MjMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSGV4TkFjIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk4tQWNldHlsaGV4b3NhbWluZSIsCiAgICAgICAgICAgICJtYXNzIjogMjAzLjA3OTM3MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNeXJpc3RveWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTXlyaXN0b3lsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDIxMC4xOTgzNjYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR3VhbmlkaW55bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHdWFuaWRpbmF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wMjE3OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUHJvcGlvbnlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlByb3Bpb25hdGUgbGFiZWxpbmcgcmVhZ2VudCBsaWdodCBmb3JtIChOLXRlcm0gJiBLKSIsCiAgICAgICAgICAgICJtYXNzIjogNTYuMDI2MjE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlByby0+cHlyby1HbHUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAicHJvbGluZSBveGlkYXRpb24gdG8gcHlyb2dsdXRhbWljIGFjaWQiLAogICAgICAgICAgICAibWFzcyI6IDEzLjk3OTI2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOSFMtTEMtQmlvdGluIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk5IUy1MQy1CaW90aW4iLAogICAgICAgICAgICAibWFzcyI6IDMzOS4xNjE2NjIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSUNBVC1DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFwcGxpZWQgQmlvc3lzdGVtcyBjbGVhdmFibGUgSUNBVChUTSkgbGlnaHQiLAogICAgICAgICAgICAibWFzcyI6IDIyNy4xMjY5OTEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSUNBVC1DOjEzQyg5KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcHBsaWVkIEJpb3N5c3RlbXMgY2xlYXZhYmxlIElDQVQoVE0pIGhlYXZ5IiwKICAgICAgICAgICAgIm1hc3MiOiAyMzYuMTU3MTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk5ldGh5bG1hbGVpbWlkZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOLWV0aHlsbWFsZWltaWRlIG9uIGN5c3RlaW5lcyIsCiAgICAgICAgICAgICJtYXNzIjogMTI1LjA0NzY3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHbHlHbHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAidWJpcXVpdGlueWxhdGlvbiByZXNpZHVlIiwKICAgICAgICAgICAgIm1hc3MiOiAxMTQuMDQyOTI3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkZvcm15bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJGb3JteWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjcuOTk0OTE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleCgxKUhleE5BYygxKU5ldUFjKDIpIChTVCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGV4MUhleE5BYzFOZXVBYzIgKFNUKSIsCiAgICAgICAgICAgICJtYXNzIjogOTQ3LjMyMzAyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEaW1ldGh5bDoySCg2KTEzQygyKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJkaW1ldGh5bGF0ZWQgYXJnaW5pbmUiLAogICAgICAgICAgICAibWFzcyI6IDM2LjA3NTY3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRlbHRhOkgoNClDKDIpTygtMSlTKDEpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlMtRXRoeWxjeXN0aW5lIGZyb20gU2VyaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wMDg0NTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MTNDKDYpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQyg2KSBTaWxhYyBsYWJlbCIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMjAxMjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MThPKDIpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk8xOCBsYWJlbCBhdCBib3RoIEMtdGVybWluYWwgb3h5Z2VucyIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMDg0OTEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiaVRSQVE0cGxleCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJSZXByZXNlbnRhdGl2ZSBtYXNzIGFuZCBhY2N1cmF0ZSBtYXNzIGZvciAxMTYgJiAxMTciLAogICAgICAgICAgICAibWFzcyI6IDE0NC4xMDIwNjMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MThPKDEpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk8xOCBMYWJlbGluZyIsCiAgICAgICAgICAgICJtYXNzIjogMi4wMDQyNDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MTNDKDYpMTVOKDIpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQyg2KSAxNU4oMikgU2lsYWMgbGFiZWwiLAogICAgICAgICAgICAibWFzcyI6IDguMDE0MTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg2KTE1Tig0KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoNikgMTVOKDQpIFNpbGFjIGxhYmVsIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMDgyNjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MTNDKDkpMTVOKDEpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQyg5KSAxNU4oMSkgU2lsYWMgbGFiZWwiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyNzIyOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMYWJlbDoxM0MoNSkxNU4oMSkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDKDUpIDE1TigxKSBTaWxhYyBsYWJlbCIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTml0cm9zeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUy1uaXRyb3N5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC45OTAxNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQUVCUyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbWlub2V0aHlsYmVuemVuZXN1bGZvbnlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDE4My4wMzUzOTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRXRoYW5vbHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkV0aGFub2xhdGlvbiBvZiBDeXMiLAogICAgICAgICAgICAibWFzcyI6IDQ0LjAyNjIxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFdGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJFdGh5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhcmJveHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ2FyYm94eWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDMuOTg5ODI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk5ldGh5bG1hbGVpbWlkZSt3YXRlciIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOZXRoeWxtYWxlaW1pZGVoeWRyb2x5c2lzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNDMuMDU4MjQzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDUEw6MTNDKDYpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJydWtlciBEYWx0b25pY3MgU0VSVkEtSUNQTChUTSkgcXVhbnRpZmljYXRpb24gY2hlbWlzdHJ5LCBoZWF2eSBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxMTEuMDQxNTkzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDUEwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQnJ1a2VyIERhbHRvbmljcyBTRVJWQS1JQ1BMKFRNKSBxdWFudGlmaWNhdGlvbiBjaGVtaXN0cnksIGxpZ2h0IGZvcm0iLAogICAgICAgICAgICAibWFzcyI6IDEwNS4wMjE0NjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGVoeWRybyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIYWxmIG9mIGEgZGlzdWxmaWRlIGJyaWRnZSIsCiAgICAgICAgICAgICJtYXNzIjogLTEuMDA3ODI1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkh5cHVzaW5lIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImh5cHVzaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA4Ny4wNjg0MTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQW1tb25pYS1sb3NzIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxvc3Mgb2YgYW1tb25pYSIsCiAgICAgICAgICAgICJtYXNzIjogLTE3LjAyNjU0OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHbHVjb3N5bGdhbGFjdG9zeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiZ2x1Y29zeWxnYWxhY3Rvc3lsIGh5ZHJveHlseXNpbmUiLAogICAgICAgICAgICAibWFzcyI6IDM0MC4xMDA1NjIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGlveGlkYXRpb24iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiZGloeWRyb3h5IiwKICAgICAgICAgICAgIm1hc3MiOiAzMS45ODk4MjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSGV4TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIZXhvc2FtaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAxNjEuMDY4ODA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjJIKDQpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjQsNCw1LDUtRDQgTHlzaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA0LjAyNTEwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEaW1ldGh5bDoySCg0KTEzQygyKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJEaU1ldGh5bC1DMTNIRDIiLAogICAgICAgICAgICAibWFzcyI6IDM0LjA2MzExNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNYWxlaW1pZGUtUEVPMi1CaW90aW4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWFsZWltaWRlLVBFTzItQmlvdGluIiwKICAgICAgICAgICAgIm1hc3MiOiA1MjUuMjI1NzE5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFsYS0+U2VyIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYS0+U2VyIHN1YnN0aXR1dGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTk0OTE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRoci0+SWxlIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRoci0+SWxlIHN1YnN0aXR1dGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMTIuMDM2Mzg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDUEw6MkgoNCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQnJ1a2VyIERhbHRvbmljcyBTRVJWQS1JQ1BMKFRNKSBxdWFudGlmaWNhdGlvbiBjaGVtaXN0cnksIG1lZGl1bSBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxMDkuMDQ2NTcxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogImlUUkFROHBsZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUmVwcmVzZW50YXRpdmUgbWFzcyBhbmQgYWNjdXJhdGUgbWFzcyBmb3IgMTEzLCAxMTQsIDExNiAmIDExNyIsCiAgICAgICAgICAgICJtYXNzIjogMzA0LjIwNTM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg2KTE1TigxKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoNikgMTVOKDEpIFNpbGFjIGxhYmVsIiwKICAgICAgICAgICAgIm1hc3MiOiA3LjAxNzE2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUTVQ2cGxleCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIiLAogICAgICAgICAgICAibWFzcyI6IDIyOS4xNjI5MzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVE1UMnBsZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVE1UMnBsZXggYnkgVGhlcm1vIiwKICAgICAgICAgICAgIm1hc3MiOiAyMjUuMTU1ODMzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRNVCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIiLAogICAgICAgICAgICAibWFzcyI6IDIyNC4xNTI0NzgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRXhhY1RhZ1RoaW9sIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkV4YWNUYWcgVGhpb2wgbGFiZWwgbWFzcyBmb3IgMi00LTctMTAgcGxleCIsCiAgICAgICAgICAgICJtYXNzIjogOTcyLjM2NTIxOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFeGFjVGFnQW1pbmUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRXhhY1RhZyBBbWluZSBsYWJlbCBtYXNzIGZvciAyLTQtNy0xMCBwbGV4IiwKICAgICAgICAgICAgIm1hc3MiOiAxMDMwLjM1Mjk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFyZ0dseUdseSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJVYmlxdWl0aW5hdGlvbiBSR0ciLAogICAgICAgICAgICAibWFzcyI6IDI3MC4xNDQwMzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiU3VsZm8tTkhTLVNTLUJpb3RpbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJFWi1MaW5rIFN1bGZvLU5IUy1TUy1CaW90aW4gKFBpZXJjZSkiLAogICAgICAgICAgICAibWFzcyI6IDM4OS4wOTAxNTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQlBBIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUiLAogICAgICAgICAgICAibWFzcyI6IDI2OC4wOTczNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQlBBX0FJTFYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmVuem95YWwgUGhlbnlsYWxhbmluZSBBSUxWIiwKICAgICAgICAgICAgIm1hc3MiOiAyNjguMDk3MzY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQV9TVEROIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUgU1RETiIsCiAgICAgICAgICAgICJtYXNzIjogMjY4LjA5NzM2OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCUEFfUFdZRiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCZW56b3lhbCBQaGVueWxhbGFuaW5lIFBXWUYiLAogICAgICAgICAgICAibWFzcyI6IDI2OC4wOTczNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQlBBX1JFQ1EiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmVuem95YWwgUGhlbnlsYWxhbmluZSBSRUNRIiwKICAgICAgICAgICAgIm1hc3MiOiAyNjguMDk3MzY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQV9HSEtNIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUgR0hLTSIsCiAgICAgICAgICAgICJtYXNzIjogMjY4LjA5NzM2OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTTUNDIGxpbmtlciIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTdWNjaW5pbWlkeWwtNC0oTi1tYWxlaW1pZG9tZXRoeWwpY3ljbG9oZXhhbmUtMS1jYXJib3h5bGF0ZSIsCiAgICAgICAgICAgICJtYXNzIjogMjE5LjA4OTU0MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDSEQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMSwyLUN5Y2xvaGV4YW5lZGlvbmUgYXJnaW5pbmUiLAogICAgICAgICAgICAibWFzcyI6IDExMi4wNTI0MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCRCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxLDItQnV0YW5lZGlvbmUgYXJnaW5pbmUiLAogICAgICAgICAgICAibWFzcyI6IDg2LjAzNjc3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIQS1VYmlxdWl0aW4gVmlueWwgU3VsZm9uZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIQS1VYmlxdWl0aW4gVmlueWwgU3VsZm9uZSIsCiAgICAgICAgICAgICJtYXNzIjogMTIwLjAxMTkyNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIQS1HbHktVWJpcXVpdGluIFZpbnlsIFN1bGZvbmUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSEEtR2x5Y3lsLVViaXF1aXRpbiBWaW55bCBTdWxmb25lIiwKICAgICAgICAgICAgIm1hc3MiOiAxNzcuMDMzMzg4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhcmJhbWlkb21ldGh5bC1EZXV0ZXJhdGVkIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkRldXRlcmF0ZWQgSW9kb2FjZXRhbWlkZSBEZXJpdmF0aXZlIiwKICAgICAgICAgICAgIm1hc3MiOiA1OS4wMzQwMTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUkdHVWJpcSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJVYmlxdWl0aW5hdGlvbiBSR0cgLSBBcmdHbHlHbHkiLAogICAgICAgICAgICAibWFzcyI6IDI3MC4xNDQwMzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiaW9kb2FjZXRhbmlsaWRlIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlvZG9hY2V0YW5pbGlkZSIsCiAgICAgICAgICAgICJtYXNzIjogMTM5LjA3Mjg5MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJwcm9weWxtZXJjYXB0byIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJwcm9weWxtZXJjYXB0byAvIHByb3BhbmV0aGlvbCIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDI0MTA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkdseUdseSAxM0MoNikgMTVOKDIpIEx5cyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJEb3VibGUgbW9kaWZpY2F0aW9uIG9mIFViaXF1aXRpbiBhbmQgTHlzKzguMDIiLAogICAgICAgICAgICAibWFzcyI6IDEyMi4wNTcxMjYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUkVQTGktRE5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkROUCBGcmV0IG1vZGlmaWNhdGlvbiBmb3IgUkVQTGkgcHJvamVjdCIsCiAgICAgICAgICAgICJtYXNzIjogMjUyLjA0OTQ2OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSRVBMaS1NQ0EtSCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJSRVBMaS1NQ0EgQzEySDhPNCIsCiAgICAgICAgICAgICJtYXNzIjogMjE2LjA0MjI1OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRUVFUR0ciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU1VNTyBMeXMtUVFRVEdHIiwKICAgICAgICAgICAgIm1hc3MiOiA1OTkuMjY2MzM5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDUEw6MTNDKDYpMkgoNCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQnJ1a2VyIERhbHRvbmljcyBTRVJWQS1JQ1BMKFRNKSBxdWFudGlmaWNhdGlvbiBjaGVtaXN0cnksIGhlYXZ5IGZvcm0sICsxMCAgeXVrMyAxLTMxLTIwMTEiLAogICAgICAgICAgICAibWFzcyI6IDExNS4wNjY3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIm1UUkFRIGQwIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIm1UUkFRIHJhZ2VudCBieSBBQiBTQ0lFWCwgZGVsdGEgMCBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxNDAuMDk0OTYzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIm1UUkFRIGQ0IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIm1UUkFRIHJhZ2VudCBieSBBQiBTQ0lFWCwgZGVsdGEgKzQgZm9ybSIsCiAgICAgICAgICAgICJtYXNzIjogMTQ0LjEwMjA2MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJtVFJBUSBkOCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJtVFJBUSByYWdlbnQgYnkgQUIgU0NJRVgsIGRlbHRhICs4IGZvcm0iLAogICAgICAgICAgICAibWFzcyI6IDE0OC4xMDkxNjIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSGV4KDEpSGV4TkFjKDEpIChTVCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGV4MUhleE5BYzEgKFNUKSIsCiAgICAgICAgICAgICJtYXNzIjogMzY1LjEzMjE5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIZXgoMSlIZXhOQWMoMSlOZXVBYygxKSAoU1QpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhleDFIZXhOQWMxTmV1QWMxIChTVCkiLAogICAgICAgICAgICAibWFzcyI6IDY1Ni4yMjc2MTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVE1ULUx5c0dseUdseSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUTVQgd2l0aCBVYmlxdWl0aW4gKEdseUdseSkgbW9kaWZpY2F0aW9uIG9uIHNhbWUgcmVzaWR1ZSIsCiAgICAgICAgICAgICJtYXNzIjogMzM4LjE5NTQwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUTVQ2LUx5c0dseUdseSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUTVQgNnBsZXggd2l0aCBVYmlxdWl0aW4gTW9kaWZpY2F0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAzNDMuMjA1ODYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ3JvdG9ueWxhdGlvbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDcm90b255bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA2OC4wMjYyMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTFJMUkdHLUsiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1QXJnTGV1QXJnR2x5R2x5LUx5cyIsCiAgICAgICAgICAgICJtYXNzIjogNjUyLjQxMzI3OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSTFJHRy1LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZ0xldUFyZ0dseUdseS1MeXMiLAogICAgICAgICAgICAibWFzcyI6IDUzOS4zMjkyMTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTFJHRy1LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxSR0cgbW9kaWZpY2F0aW9uIG9uIEx5cyIsCiAgICAgICAgICAgICJtYXNzIjogMzgzLjIyODEwMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX1YiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiYXF1YS1WIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxMzgwOSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlcyBQcm8iLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfUFYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWVzIFBybyBhbmQgVmFsIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxMzgwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0wiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgTGV1IiwKICAgICAgICAgICAgIm1hc3MiOiA3LjAxNzE2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0kiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgSXNvbGV1Y2luZSIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTcxNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIFRociIsCiAgICAgICAgICAgICJtYXNzIjogNS4wMTA0NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0ciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgR2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAzLjAwMzc0NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0YiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgRiIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDI4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfQSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpc290b3BpY2FsbHkgbW9kaWZpZWQgcmVzaWR1ZSBBbGEiLAogICAgICAgICAgICAibWFzcyI6IDQuMDA3MDk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfWXBob3MiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgcGhvc3Bob3J5bGF0ZWQgVHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA4OS45OTM1NTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIFR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDI3MjI4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFjZXR5bF9oZWF2eV9MeXMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWNldHlsX2hlYXZ5X0x5cyIsCiAgICAgICAgICAgICJtYXNzIjogNTAuMDI0NzY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlFFUVRHRyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTVU1PIEx5cy1RRVFUR0ciLAogICAgICAgICAgICAibWFzcyI6IDYwMC4yNTAzNTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTW9ub01ldGh5bFByb3Bpb255bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNb25vTWV0aHlsUHJvcGlvbnlsTHlzaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA3MC4wNDE4NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUHJvcGlvbnlsOjJIKDUpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlByb3Bpb25hdGUgbGFiZWxpbmcgcmVhZ2VudCBwZW50YWRldXRlcmF0ZWQgZm9ybSAoKzVhbXUpLCBOLXRlcm0gJiBLIiwKICAgICAgICAgICAgIm1hc3MiOiA2MS4wNTc1OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2x5R2x5Q2FyYmFteWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ2FyYmFteWxhdGVkIERpZ2x5Y2luZSIsCiAgICAgICAgICAgICJtYXNzIjogMTU3LjA0ODc0MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0QiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgQXNwIiwKICAgICAgICAgICAgIm1hc3MiOiA1LjAxMDQ1NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogODUuMDYzOTk3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiA0My4wMDU4MTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDQzLjk4OTgyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogMzEuOTcyMDcxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiA1OC4wMDU0NzkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogNTcuMDIxNDY0MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wMTU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogNjYuMDIxNzk3OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDQyLjA0Njk0OTk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDQ2OTQ5OTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny4wNTc4NDkwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDYwLjAwMzM3MDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiA3Ni4wMzEyOTk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45OTQ5MTM5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5UaHIiLAogICAgICAgICAgICAibWFzcyI6IDMwLjAxMDU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogMTE1LjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA5Mi4wMjYyMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5WYWwiLAogICAgICAgICAgICAibWFzcyI6IDI4LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC04NS4wNjM5OTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wNTgxODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC00MS4wNzQxNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC01My4wOTE5MjYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC0yNy4wNTg1MTc5OTk5OTk5OTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0yOC4wNDI1MzI5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTk5LjA3OTY0NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogLTE5LjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDMuMDE3MDQ3MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtNDMuMDE3MDQ3MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjguMDA2MTQ3OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAtMjUuMDYwNjI2MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAtOS4wMzI2OTcwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC01OS4wNDgzNDcwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTY5LjA2OTA4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTU1LjA1MzQzMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogMjkuOTc4MjAyMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDYuOTYyMjA5MDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDMyNjk3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDMuMDA1ODEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wNTgxODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDAuOTg0MDE1OTk5OTk5OTk2OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTExLjAzMzc0MjAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMTQuOTk5NjY2MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wMTU2NTEwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC01Ny4wMjE0NjMwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDIzLjAxNTk4NDk5OTk5OTk4NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTAuOTU4ODYzMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMC45NTg4NjMwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDE0LjA1MjAzNjAwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMTYuOTk3NTU3OTk5OTk5OTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAzMy4wMjU0ODY5OTk5OTk5ODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0xNi45OTAxNjMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTI3LjAxMDg5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTIuOTk1MjQ4MDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA3Mi4wMzYzODYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNDkuMDIwMzkzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuOTc0NTEzMDAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDMuOTg5ODI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA0MS4wNzQxNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0wLjk4NDAxNTk5OTk5OTk5NjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0xMi4wMTc3NTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY1MDAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMTMuMDMxNjM1MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTguMDA1NDc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyMi4wMzE5Njg5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTQyODc5MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMS45NDI4NzkwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDEzLjA2ODAyMDAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMTYuMDEzNTQxOTk5OTk5OTg3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAzMi4wNDE0NzA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTE3Ljk3NDE3OTAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTI3Ljk5NDkxNTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTEzLjk3OTI2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNzEuMDUyMzcwMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDQ4LjAzNjM3NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTE1Ljk1ODUyODk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTMxLjk3MjA3MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNTMuMDkxOTI2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAxMS4wMzM3NDIwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDEyLjAxNzc1OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDMzNDA4MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDI1LjA0OTM5MzAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNDUuOTg3NzIxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAzNC4wNDk3MjY5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDc0ODc4OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wNzQ4Nzg5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDI1LjA4NTc3ODAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMjguMDMxMjk5OTk5OTk5OTg3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wNTkyMjg5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTUuOTU2NDIxMDAwMDAwMDA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTc3MTU3MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMS45NjE1MDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDgzLjA3MDEyODAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA2MC4wNTQxMzUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0zLjk0MDc3MDk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTU4LjAwNTQ3OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy4wNTg1MTc5OTk5OTk5OTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0xNC45OTk2NjYwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wMTU2NTAwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wMzM0MDgwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTAuOTg0MDE0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTcyLjAyMTEyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogOC4wMTYzMTg5OTk5OTk5ODIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0xNS45NTg1MjkwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0xNS45NTg1MjkwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC0wLjk0NzYzMDAwMDAwMDAwMzcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDEuOTk3ODkxOTk5OTk5OTc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAxOC4wMjU4MjA5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTMxLjk4OTgyOTAwMDAwMDAxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTQyLjAxMDU2NTAwMDAwMDAxNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTI3Ljk5NDkxNDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny4wMzY3MgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMzQuMDIwNzI2OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjkuOTc0MTc5MDAwMDAwMDA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDIxNDY0MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5BcmciLAogICAgICAgICAgICAibWFzcyI6IDI4LjA0MjUzMjk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDE1NjUxMDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTMuMDMxNjM1MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjUuMDQ5MzkzMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDAuOTg0MDE0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTcxLjAzNzExNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogOS4wMDAzMzM5OTk5OTk5ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0xNC45NzQ1MTQwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0xNC45NzQ1MTQwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDAuMDM2Mzg0OTk5OTk5OTk1NjcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDIuOTgxOTA2OTk5OTk5OTc4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMTkuMDA5ODM1OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0zMS4wMDU4MTQwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC00MS4wMjY1NTAwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDIwNzM1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiAzNS4wMDQ3NDE5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTI4Ljk5MDE2NDAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDk5LjA3OTY0NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogNTcuMDIxNDYzMDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiA1OC4wMDU0NzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDQ1Ljk4NzcyMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogNzIuMDIxMTI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiA3MS4wMzcxMTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDgwLjAzNzQ0Nzk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ni4wNjI1OTk5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5MZXUiLAogICAgICAgICAgICAibWFzcyI6IDU2LjA2MjU5OTk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5Pkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogNzEuMDczNDk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiA3NC4wMTkwMjA5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogOTAuMDQ2OTQ5OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IDQwLjAzMTI5OTk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PlNlciIsCiAgICAgICAgICAgICJtYXNzIjogMzAuMDEwNTYzOTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wMjYyMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDEyOS4wNTc4NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDEwNi4wNDE4NTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5WYWwiLAogICAgICAgICAgICAibWFzcyI6IDQyLjA0Njk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNjYuMDIxNzk3OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5BcmciLAogICAgICAgICAgICAibWFzcyI6IDE5LjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjMuMDE1OTg0OTk5OTk5OTg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjIuMDMxOTY4OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0zNC4wNDk3MjY5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogLTguMDE2MzE4OTk5OTk5OTgyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAtOS4wMDAzMzM5OTk5OTk5ODEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC04MC4wMzc0NDc5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTIzLjk3NDg0Nzk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTIzLjk3NDg0Nzk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTguOTYzOTQ4OTk5OTk5OTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAtNi4wMTg0MjcwMDAwMDAwMDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAwOTUwMTk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTQwLjAwNjE0Nzk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTUwLjAyNjg4Mzk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTM2LjAxMTIzMjk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA0OS4wMjA0MDEwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDA0NDA4MDAwMDAwMDEyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzcuOTkwNDk3OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wNDY5NDk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDQzLjAxNzA0NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMC45NTg4NjMwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDEuOTQyODc5MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTAuMDc0ODc4OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45NTg1MjkwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDE0Ljk3NDUxNDAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTU2LjA2MjU5OTk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMjMuOTc0ODQ3OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS4wMTA4OTkwMDAwMDAwMDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDE3Ljk1NjQyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAzMy45ODQzNDk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTE2LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wNTIwMzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0xMi4wMzYzODQ5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDcyLjk5NTI0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA0OS45NzkyNTYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTE0LjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTQyLjA0Njk0OTk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNDMuMDE3MDQ3MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk1ODg2MzAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogMS45NDI4NzkwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0xMC4wNzQ4Nzg5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDE1Ljk1ODUyOTAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMTQuOTc0NTE0MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTYuMDYyNTk5OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyMy45NzQ4NDc5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDE1LjAxMDg5OTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1Pk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMTcuOTU2NDIwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDMzLjk4NDM0OTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTYuMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTI2LjA1MjAzNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTEyLjAzNjM4NDk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNzIuOTk1MjQ5MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDQ5Ljk3OTI1NjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDU3ODQ5MDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wMDYxNDc5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wNTIwMzYwMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC0xMy4wNjgwMjAwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0yNS4wODU3NzgwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDAuOTQ3NjMwMDAwMDAwMDAzNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTAuMDM2Mzg0OTk5OTk5OTk1NjcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC03MS4wNzM0OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDguOTYzOTQ4OTk5OTk5OTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuMDEwODk5MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuMDEwODk5MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAyLjk0NTUyMTk5OTk5OTk4MjcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDE4Ljk3MzQ1MDk5OTk5OTk4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTMxLjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDEuMDYyOTM1MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy4wNDcyODQwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDU3Ljk4NDM1MDAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMzQuOTY4MzU3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjkuMDI2NTQ5MDAwMDAwMDAzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNjAuMDAzMzcwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5BcmciLAogICAgICAgICAgICAibWFzcyI6IDI1LjA2MDYyNjAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogLTE2Ljk5NzU1Nzk5OTk5OTk4NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTE2LjAxMzU0MTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTI4LjAzMTI5OTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTk3ODkxOTk5OTk5OTc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMi45ODE5MDY5OTk5OTk5NzgzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNzQuMDE5MDIwOTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDYuMDE4NDI3MDAwMDAwMDAzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTcuOTU2NDIwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0xNy45NTY0MjA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0Pkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTIuOTQ1NTIxOTk5OTk5OTgyNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMTYuMDI3OTI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzMuOTg3NzIwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC00NC4wMDg0NTY5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTI5Ljk5MjgwNTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNTUuMDM4ODI4MDAwMDAwMDI0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiAzMi4wMjI4MzUwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0zMS45NzIwNzA5OTk5OTk5ODUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC03Ni4wMzEyOTk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogOS4wMzI2OTcwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0zMy4wMjU0ODY5OTk5OTk5ODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC0zMi4wNDE0NzA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTQ0LjA1OTIyODk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTguMDI1ODIwOTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0xOS4wMDk4MzU5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTkwLjA0Njk0OTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTAuMDA5NTAxOTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzMuOTg0MzQ5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0zMy45ODQzNDk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTE4Ljk3MzQ1MDk5OTk5OTk4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogLTE2LjAyNzkyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTUwLjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTYwLjAzNjM4NTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDYuMDIwNzM0OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDM5LjAxMDg5OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45OTQ5MDYwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC00Ny45OTk5OTk5OTk5OTk5ODYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5BcmciLAogICAgICAgICAgICAibWFzcyI6IDU5LjA0ODM0NzAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAxNi45OTAxNjMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogMTcuOTc0MTc5MDAwMDAwMDA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ljk1NjQyMTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMzEuOTg5ODI5MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAzMS4wMDU4MTQwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC00MC4wMzEyOTk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDQwLjAwNjE0Nzk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogMTYuMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMTYuMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogMzEuMDQyMTk5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDMzLjk4NzcyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiA1MC4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0xMC4wMjA3MzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5UaHIiLAogICAgICAgICAgICAibWFzcyI6IDMuOTk0OTE1MDAwMDAwMDA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA4OS4wMjY1NDkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNjYuMDEwNTU2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5WYWwiLAogICAgICAgICAgICAibWFzcyI6IDIuMDE1NjUwMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTk0OTEzOTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA2OS4wNjkwODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5Bc24iLAogICAgICAgICAgICAibWFzcyI6IDI3LjAxMDg5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy45OTQ5MTUwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDE1Ljk3NzE1NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDEwNTY1MDAwMDAwMDE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiA0MS4wMjY1NTAwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC0zMC4wMTA1NjM5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDUwLjAyNjg4Mzk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDUyMDM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAyNi4wNTIwMzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDQxLjA2MjkzNTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wMDg0NTY5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNjAuMDM2Mzg1OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyMDczNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPlRociIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjUxMDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA5OS4wNDcyODUwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNzYuMDMxMjkyMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5WYWwiLAogICAgICAgICAgICAibWFzcyI6IDEyLjAzNjM4NjAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTMwLjAxMDU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNTUuMDUzNDMyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAxMi45OTUyNDgwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDEzLjk3OTI2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogMS45NjE1MDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDI3Ljk5NDkxNDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ0LjAyNjIxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMzYuMDExMjMyOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDEyLjAzNjM4NDk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMTIuMDM2Mzg0OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy4wNDcyODQwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDI5Ljk5MjgwNTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNDYuMDIwNzM0OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0zLjk5NDkxNTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTE0LjAxNTY1MTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogODUuMDMxNjM0MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDYyLjAxNTY0MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTc5MjY0OTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTE1LjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjkuOTc4MjAyMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC03Mi4wMzYzODYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTcxLjA1MjM3MDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtODMuMDcwMTI4MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC01Ny4wMzY3MgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTU4LjAyMDczNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTEyOS4wNTc4NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5IaXMiLAogICAgICAgICAgICAibWFzcyI6IC00OS4wMjA0MDEwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTcyLjk5NTI0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtNzIuOTk1MjQ5MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC01Ny45ODQzNTAwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5NZXQiLAogICAgICAgICAgICAibWFzcyI6IC01NS4wMzg4MjgwMDAwMDAwMjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5QaGUiLAogICAgICAgICAgICAibWFzcyI6IC0zOS4wMTA4OTkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTg5LjAyNjU0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtOTkuMDQ3Mjg1MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC04NS4wMzE2MzQwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogLTIzLjAxNTk5MzAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtODcuMDEwODk5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC05Mi4wMjYyMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5BcmciLAogICAgICAgICAgICAibWFzcyI6IC02Ljk2MjIwOTAwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogLTQ5LjAyMDM5MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTQ4LjAzNjM3NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTYwLjA1NDEzNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogLTM0LjAyMDcyNjk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTM1LjAwNDc0MTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTA2LjA0MTg1NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogLTI2LjAwNDQwODAwMDAwMDAxMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ5Ljk3OTI1NjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtNDkuOTc5MjU2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC0zNC45NjgzNTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5NZXQiLAogICAgICAgICAgICAibWFzcyI6IC0zMi4wMjI4MzUwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5QaGUiLAogICAgICAgICAgICAibWFzcyI6IC0xNS45OTQ5MDYwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC02Ni4wMTA1NTYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTc2LjAzMTI5MjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNjIuMDE1NjQxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiAyMy4wMTU5OTMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTYzLjk5NDkwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTI4LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5BcmciLAogICAgICAgICAgICAibWFzcyI6IDU3LjAzMjY5NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMTQuOTc0NTEzMDAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45NTg1Mjg5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDMuOTQwNzcwOTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAyOS45NzQxNzkwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDI4Ljk5MDE2NDAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTQyLjA0Njk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAzNy45OTA0OTc5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDI5LjAyNjU0OTAwMDAwMDAwMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMzEuOTcyMDcwOTk5OTk5OTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiA0Ny45OTk5OTk5OTk5OTk5ODYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0yLjAxNTY1MDAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTEyLjAzNjM4NjAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPlRociIsCiAgICAgICAgICAgICJtYXNzIjogMS45NzkyNjQ5OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDg3LjAxMDg5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA2My45OTQ5MDYKICAgICAgICB9CiAgICBdCn0pOwoKLyoKICogQSBzaW5nbGV0b24gZGljdGlvbmFyeSBmb3IgcmVzaWR1ZSBtb2RpZmljYXRpb25zLCBsb2FkZWQgZnJvbSBkYXRhL3Jlc2l1ZU1vZGlmaWNhdGlvbnMuanMsIGEgdHJhbnNmb3JtIGZyb20gVW5pbW9kLAogKiBidXQgYW55IG1vZGlmaWNhdGlvbiBjYW4gYmUgYWRkZWQgYXMgbG9uZyBhcyB0aGUgbmFtZSBpcyB1bmlxdWUuCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbkRpY3Rpb25hcnknLFsgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb24nLCAnZmlzaHRvbmVzL2RhdGEvcmVzaWR1ZU1vZGlmaWNhdGlvbnMnXSwgZnVuY3Rpb24oQmFja2JvbmUsIFJlc2lkdWVNb2RpZmljYXRpb24sIGJzX3Jlc21vZCkgewogICAgdmFyIFJlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5ID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewoKICAgICAgICBtb2RlbCA6IFJlc2lkdWVNb2RpZmljYXRpb24sCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuYWRkKGJzX3Jlc21vZCk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbmV3IFJlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5KCk7Cn0pOwoKLyoKICogUmljaFNlcXVlbmNlIGlzIHRoZSBleHByZXNzaW9uIG9mIGEgcGVwdGlkZSwgd2l0aCBtb2RpZmljYXRpb25zLiBJdCBpcyBjZXJ0YWlubHkgb25lIG9mIHRoZSBtb3N0IHVzZWQgY2xhc3MgYW1vbmcgZmlzaFRvbmVzLWpzLgogKiBJdCBob2xkIHRoZSBwZXB0aWRlIHNlcXVlbmNlLCB3aXRoIGFueSBudW1iZXIgb2YgcG9zc2libGUgbW9kaWZpY2F0aW9uIG9uIGEgYW1pbm8gYWNpZC4KICogSXQgYWxzbyBob2xkcyBDL04tdGVybXMgbW9kaWZpY2F0aW9uKHMpIChtdWx0aXBsZSBjYW4gYWxzbyBhcHBseSBvbiB0aGUgdGVybWluaS4KICogVGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBub3QgZG9uZSB3aXRoIHNwZWVkIGluIG1pbmQsIGJ1dCB2ZXJzYXRpbGl0eSBvZiB1c2UuCiAqCiAqIEEgUmljaFNlcXVlbmNlIG9iamVjdCB3aWxsIGNvbnRhaW5zIGEgJ3NlcXVlbmNlJyBwcm9wZXJ0aWVzIHdoaWNoIGlzIGFuIGFycmF5IG9mIHthYTp4LCBtb2RpZmljYXRpb25zOltdfQogKgogKiBXaGVuIGdldHRpbmcgbW9kaWZpY2F0aW9uIHBlciBwb3NpdGlvbnMgb24gYSBwZXB0aWRlIG9mIGxlbmd0aCBsOgogKiAwIC0+IG1vZGlmIG9uZSB0aGUgZmlyc3QgYW1pbm8gYWNpZAogKiBsLTEgLT4gb24gdGhlIGxhc3QgYW1pbm8gYWNpZAogKiAtMSAtPiBOVGVybQogKiBsIC0+IENUZXJtCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9SaWNoU2VxdWVuY2UnLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL3V0aWxzL1JlZ0V4cEZ1bGxTcGxpdGVyJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5JywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb24nXSwgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBSZWdFeHBGdWxsU3BsaXRlciwgZGljb0FBLCBkaWNvUmVzTW9kLCBSZXNpZHVlTW9kaWZpY2F0aW9uKSB7CgogICAgdmFyIFJpY2hTZXF1ZW5jZSA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICAgICAgc2VxdWVuY2U6IFtdCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgfSwKCiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSaWNoU2VxdWVuY2UoKS5mcm9tU3RyaW5nKHRoaXMudG9TdHJpbmcoKSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGdldCB0aGUgbW9kaWZpY2F0aW9uIGFycmF5IGZvciBhIGdpdmVuIGFtaW5vIGFjaWQgcG9zaXRpb24KICAgICAgICAgKiBAcGFyYW0gcG9zCiAgICAgICAgICogQHBhcmFtIGNyZWF0ZSA6IGNyZWF0ZSBzdWNoIGFuIGFycnlhIG9uIHRoZSBvYmplY3QgaWYgaXQgd2FzIG5vdCBleGlzdGluZyBbZGVmYXVsdCBmYWxzZV0KICAgICAgICAgKiBAcmV0dXJuIHsqfQogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgZ2V0TW9kaWZpY2F0aW9uQXJyYXk6IGZ1bmN0aW9uIChwb3MsIGNyZWF0ZSkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEpIHsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmdldCgnblRlcm1Nb2RpZmljYXRpb25zJykgPT09IHVuZGVmaW5lZCAmJiBjcmVhdGUpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldCgnblRlcm1Nb2RpZmljYXRpb25zJywgW10pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwb3MgPT0gc2VsZi5zaXplKCkpIHsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmdldCgnY1Rlcm1Nb2RpZmljYXRpb25zJykgPT09IHVuZGVmaW5lZCAmJiBjcmVhdGUpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldCgnY1Rlcm1Nb2RpZmljYXRpb25zJywgW10pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghc2VsZi5nZXQoJ3NlcXVlbmNlJylbcG9zXS5tb2RpZmljYXRpb25zICYmIGNyZWF0ZSkgewogICAgICAgICAgICAgICAgc2VsZi5nZXQoJ3NlcXVlbmNlJylbcG9zXS5tb2RpZmljYXRpb25zID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdzZXF1ZW5jZScpW3Bvc10ubW9kaWZpY2F0aW9uczsKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBzZXQgdGhlIG1vZmljaWF0aW9uIGFycmF5CiAgICAgICAgICogQHBhcmFtIHBvcwogICAgICAgICAqIEBwYXJhbSBtb2RpZmFycmF5CiAgICAgICAgICogQHJldHVybiB0aGlzCiAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgKi8KICAgICAgICBzZXRNb2RpZmljYXRpb25BcnJheTogZnVuY3Rpb24gKHBvcywgbW9kaWZhcnJheSkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEpIHsKICAgICAgICAgICAgICAgIHNlbGYuc2V0KCduVGVybU1vZGlmaWNhdGlvbnMnLCBtb2RpZmFycmF5KTsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocG9zID09IHNlbGYuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldCgnY1Rlcm1Nb2RpZmljYXRpb25zJywgbW9kaWZhcnJheSkKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzZWxmLmdldCgnc2VxdWVuY2UnKVtwb3NdLm1vZGlmaWNhdGlvbnMgPSBtb2RpZmFycmF5OwogICAgICAgICAgICByZXR1cm4gc2VsZjsKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBhZGQgb25lIG1vZGlmaWNhdGlvbiBvciBhbiBhcnJheSBvZiBtb2RpZiBhdCBhIGdpdmVuIHBvc2l0aW9uIHRvIHRoZSBleGlzaXRpbmcgbGlzdC4KICAgICAgICAgKiBAcGFyYW0gcG9zOiBwb3NpdGlvbiBiZWV0d2VlbiAtMSBhbmQgbGVuCiAgICAgICAgICogQHBhcmFtIG1vZDogb25lIG1vZGlmaWNhaXRvbiBvciBhbiBhcnJheSBvZiBpdAogICAgICAgICAqLwogICAgICAgIHNldE1vZGlmaWNhdGlvbjogZnVuY3Rpb24gKHBvcywgbW9kKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5zZXRNb2RpZmljYXRpb25BcnJheShwb3MsIHVuZGVmaW5lZCk7CiAgICAgICAgICAgIHNlbGYuYWRkTW9kaWZpY2F0aW9uKHBvcywgbW9kKTsKICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdjaGFuZ2UnKQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogYWRkIG9uZSBtb2RpZmljYXRpb24gb3IgYW4gYXJyYXkgb2YgbW9kaWYgYXQgYSBnaXZlbiBwb3NpdGlvbiB0byB0aGUgZXhpc2l0aW5nIGxpc3QuCiAgICAgICAgICogQHBhcmFtIHBvczogcG9zaXRpb24gYmVldHdlZW4gLTEgYW5kIGxlbgogICAgICAgICAqIEBwYXJhbSBtb2Q6IG9uZSBtb2RpZmljYWl0b24gb3IgYW4gYXJyYXkgb2YgaXQKICAgICAgICAgKi8KICAgICAgICBhZGRNb2RpZmljYXRpb246IGZ1bmN0aW9uIChwb3MsIG1vZCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICBpZiAobW9kID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBtb2RBcnIgPSBzZWxmLmdldE1vZGlmaWNhdGlvbkFycmF5KHBvcywgdHJ1ZSkKICAgICAgICAgICAgaWYgKF8uaXNBcnJheShtb2QpKSB7CiAgICAgICAgICAgICAgICBfLmVhY2gobW9kLCBmdW5jdGlvbiAocm0pIHsKICAgICAgICAgICAgICAgICAgICBtb2RBcnIucHVzaChybSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1vZEFyci5wdXNoKG1vZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHBvczogYmV0d2VlbiAtMSBhbmQgbGVuCiAgICAgICAgICogQHJldHVybiB0aGUgbGlzdCBvZiBtb2RpZmljYXRpb24gYXQgdGhpcyBwb3NpdGlvbiAoLTEgYW5kIHNpemUoKSBwb3NpdGlvbiBmb3IgdGVybWluaSkKICAgICAgICAgKi8KICAgICAgICBjb3VudE1vZGlmaWNhdGlvbnNBdDogZnVuY3Rpb24gKHBvcykgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuZ2V0TW9kaWZpY2F0aW9uQXJyYXkocG9zKTsKICAgICAgICAgICAgcmV0dXJuIGEgPyBhLmxlbmd0aCA6IDA7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0gcG9zOiBiZXR3ZWVuIC0xIGFuZCBsZW4KICAgICAgICAgKiBAcmV0dXJuIHRoZSBsaXN0IG9mIG1vZGlmaWNhdGlvbiBhdCB0aGlzIHBvc2l0aW9uCiAgICAgICAgICovCiAgICAgICAgbW9kaWZBdDogZnVuY3Rpb24gKHBvcykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRNb2RpZmljYXRpb25BcnJheShwb3MpCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhZXJhbSBwb3M6IGJldHdlZW4gMCBhbmQgbGVuLTEKICAgICAgICAgKiBAcmV0dXJuIHRoZSBhbWlubyBhaWNkIGF0IHRoaXMgcG9zaXRpb24KICAgICAgICAgKi8KICAgICAgICBhYUF0OiBmdW5jdGlvbiAocG9zKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldCgnc2VxdWVuY2UnKVtwb3NdLmFhCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiByZWFkIHRoZSBvYmplY3QgYmFjayBmcm9tIHRoZSB0b1N0cmluZyBtZXRob2QuIFNlZSB0b1N0cmluZyBmb3IgbW9yZSBkZXRhaWxzICdBQ0R7T3hpZGF0aW9ufUVGR3sxMjMuNDUsUGhvc3Bob3J5bGF0aW9ufUhJSy17QWNldHlsfScKICAgICAgICAgKiBSaWNoU2VxdWVuY2UtdGVzdHMuanMgd2lsIHNob3cgcGxlbnR5IG9mIGV4YW1wbGVzCiAgICAgICAgICogQHBhcmFtIHN0cgogICAgICAgICAqIEByZXR1cm4ge1JpY2hTZXF1ZW5jZX0KICAgICAgICAgKi8KICAgICAgICBmcm9tU3RyaW5nOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5zZXQoJ3NlcXVlbmNlJywgW10pOwoKICAgICAgICAgICAgc3RyID0gc3RyLnRyaW0oKQogICAgICAgICAgICB2YXIgbWF0Y2hOdGVybSA9IC9eXHsoW15cfV0qKVx9Ly5leGVjKHN0cikKICAgICAgICAgICAgaWYgKG1hdGNoTnRlcm0pIHsKICAgICAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcobWF0Y2hOdGVybVswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgc2VsZi5zZXRNb2RpZmljYXRpb24oLTEsIHNlbGYuc3RyaW5nMm1vZGlmcyhtYXRjaE50ZXJtWzFdKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldE1vZGlmaWNhdGlvbigtMSwgdW5kZWZpbmVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbWF0Y2hDdGVybSA9IC8oW1x9XC1dKVx7KFteXH1dKilcfSQvLmV4ZWMoc3RyKTsKICAgICAgICAgICAgdmFyIGN0ZXJtTW9kaWZzID0gdW5kZWZpbmVkOwogICAgICAgICAgICBpZiAobWF0Y2hDdGVybSkgewogICAgICAgICAgICAgICAgc3RyID0gc3RyLnN1YnN0cigwLCBzdHIubGVuZ3RoIC0gbWF0Y2hDdGVybVswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoQ3Rlcm1bMV0gPT0gJ30nKQogICAgICAgICAgICAgICAgICAgIHN0ciArPSAnfSc7CiAgICAgICAgICAgICAgICBjdGVybU1vZGlmcyA9IHNlbGYuc3RyaW5nMm1vZGlmcyhtYXRjaEN0ZXJtWzJdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBuZXcgUmVnRXhwRnVsbFNwbGl0ZXIoKS5zcGxpdCgvKFtBLVpdKShceyhbXlx9XSopXH0pPy8sIHN0cikKCiAgICAgICAgICAgIF8uZWFjaChtYXRjaGVzLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgdmFyIHJhYSA9IHsKICAgICAgICAgICAgICAgICAgICBhYTogZGljb0FBLmdldChtWzFdKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmICghcmFhLmFhKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVW5rbndvd25BbWlub0FjaWQnLAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAndW5rbndvbiBhbWlubyBhY2lkICcgKyBtWzFdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG1bM10pIHsKICAgICAgICAgICAgICAgICAgICByYWEubW9kaWZpY2F0aW9ucyA9IHNlbGYuc3RyaW5nMm1vZGlmcyhtWzNdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdzZXF1ZW5jZScpLnB1c2gocmFhKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5zZXRNb2RpZmljYXRpb24oc2VsZi5zaXplKCksIGN0ZXJtTW9kaWZzKTsKICAgICAgICAgICAgLy9zZWxmLmNoYW5nZSgpOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIHBhcnNlIGEgbW9kaWZpY2F0aW9uIHN0cmluZyBzdHJpbmcKICAgICAgICAgKiBAcGFyYW0gc3RyTW9kcwogICAgICAgICAqIEByZXR1cm4ge0FycmF5fQogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgc3RyaW5nMm1vZGlmczogZnVuY3Rpb24gKHN0ck1vZHMpIHsKICAgICAgICAgICAgdmFyIGwgPSBbXTsKICAgICAgICAgICAgXy5lYWNoKHN0ck1vZHMuc3BsaXQoJywnKSwgZnVuY3Rpb24gKG1uKSB7CiAgICAgICAgICAgICAgICB2YXIgbW9kID0gZGljb1Jlc01vZC5nZXQobW4pOwogICAgICAgICAgICAgICAgaWYgKCFtb2QpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbW1hc3MgPSBwYXJzZUZsb2F0KG1uKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNGaW5pdGUobW1hc3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdVbmtud293blJlc2lkdWVNb2RpZmljYXRpb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3Vua25vd24gbW9kaWZpY2F0aW9uIFsnICsgbW9kICsgJ10gaW4gJyArIG1uCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbW9kID0gbmV3IFJlc2lkdWVNb2RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiIiArIG1tYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBtYXNzOiBtbWFzcwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsLnB1c2gobW9kKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGw7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogY2hlY2sgZXF1YWxpdHkgYmV0d2VlIDIgcmljaCBzZXF1ZW5jZS4KICAgICAgICAgKiBUaGF0IGNhbiBiZSBub3QgdGhhdCBzdHJhaWdodCBmb3J3YXJkcywgYmVjYXVzZSB0aGUgbW9kaWZpY2F0aW9uIG9yZGVyIG9uIGEgZ2l2ZW4gYW1pbm8gYWNpZCBpcyBub3QgcmVsZXZhbnQuCiAgICAgICAgICogQHBhcmFtIG9ycwogICAgICAgICAqIEByZXR1cm4geyp9CiAgICAgICAgICovCiAgICAgICAgZXF1YWxzVG86IGZ1bmN0aW9uIChvcnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAoKG9ycyA9PSBudWxsKSB8fCAoc2VsZi5zaXplKCkgIT0gb3JzLnNpemUoKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gXy5hbGwoc2VsZi5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uIChyYWEsIGkpIHsKICAgICAgICAgICAgICAgIG9yYWEgPSBvcnMuZ2V0KCdzZXF1ZW5jZScpW2ldOwogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJhYS5hYS5jb2RlMSwgb3JhYS5hYS5jb2RlKQogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF8ucGx1Y2socmFhLm1vZGlmaWNhdGlvbnMsICduYW1lJykuc29ydCgpLmpvaW4oCiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcnKSwgXy5wbHVjayhvcmFhLm1vZGlmaWNhdGlvbnMsICduYW1lJykKICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNvcnQoKS5qb2luKCcnKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gKHJhYS5hYS5nZXQoJ2NvZGUxJykgPT0gb3JhYS5hYS5nZXQoJ2NvZGUxJykpICYmIChfLmNvbGxlY3QocmFhLm1vZGlmaWNhdGlvbnMsIGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uZ2V0KCduYW1lJykKICAgICAgICAgICAgICAgIH0pLnNvcnQoKS5qb2luKCcnKSA9PSBfLmNvbGxlY3Qob3JhYS5tb2RpZmljYXRpb25zLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICB9KS5zb3J0KCkuam9pbignJykpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJuIGp1c3QgdGhlIGFtaW5vIGFjaWQgbGlzdCBhcyBhIHN0cmluZwogICAgICAgICAqLwogICAgICAgIHRvQUFTdHJpbmc6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIF8uY29sbGVjdCh0aGlzLmdldCgnc2VxdWVuY2UnKSwgZnVuY3Rpb24gKHJhYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJhYS5hYS5nZXQoJ2NvZGUxJyk7CiAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGZ1bGwgc3RyaW5nLCBjb21wYXRpYmxlIHdpdGggdGhlIGZyb21TdHJpbmcvY29uc3RydWN0b3Igc3ludGF4CiAgICAgICAgICogc2VlIFJpY2hTZXF1ZW5jZS10ZXN0cy5qcyBmb3IgZXhhbXBsZXMKICAgICAgICAgKiBAcmV0dXJuIGEgc3RyaW5nCiAgICAgICAgICovCiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIG1vZGlmMnN0cmluZyA9IGZ1bmN0aW9uIChtb2RpZnMpIHsKICAgICAgICAgICAgICAgIGlmICghbW9kaWZzIHx8IG1vZGlmcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAneycgKyBfLmNvbGxlY3QobW9kaWZzLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICB9KS5zb3J0KCkuam9pbignLCcpICsgJ30nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHMgPSBtb2RpZjJzdHJpbmcoc2VsZi5nZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycpKTsKICAgICAgICAgICAgdmFyIHNpemUgPSBzZWxmLnNpemUoKTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgcyArPSBzZWxmLmdldCgnc2VxdWVuY2UnKVtpXS5hYS5nZXQoJ2NvZGUxJyk7CiAgICAgICAgICAgICAgICBzICs9IG1vZGlmMnN0cmluZyhzZWxmLmdldCgnc2VxdWVuY2UnKVtpXS5tb2RpZmljYXRpb25zKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNlbGYuY291bnRNb2RpZmljYXRpb25zQXQoc2l6ZSkgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5jb3VudE1vZGlmaWNhdGlvbnNBdChzaXplIC0gMSkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHMgKz0gJy0nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICBzICs9IG1vZGlmMnN0cmluZyhzZWxmLmdldCgnY1Rlcm1Nb2RpZmljYXRpb25zJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIDsKCiAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIGEgc2VxdWVuY2UgbGVuZ3RoCiAgICAgICAgICovCiAgICAgICAgc2l6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoJ3NlcXVlbmNlJykubGVuZ3RoOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBSaWNoU2VxdWVuY2U7Cn0pOwoKLyoKICogQSB0aGVvcmV0aWNhbCBzcGVjdHJ1bSBwb2pvLCBtYWRlIG91dCBmcm9tIGEgUmljaFNlcXVlbmNlIGFuZCBhIHNldCBvZiBmcmFnbWVudGF0aW9uIHNlcmllcwogKiBQcm9wZXJ0aWVzOgogKiAtIHJpY2hTZXF1ZW5jZQogKiAtIHBlYWtzCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9UaGVvU3BlY3RydW0nLFsndW5kZXJzY29yZScsICdCYWNrYm9uZSddLCBmdW5jdGlvbihfLCBCYWNrYm9uZSkgewogICAgdmFyIFRoZW9TcGVjdHJ1bSA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgICAgIHJpY2hTZXF1ZW5jZSA6IG51bGwsCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJuIHRoZSBsaXN0IG9mIG0vei4gd2UgbmVlZCB0aGF0IHRvIGhhdmUgYSBraW5kIG9mICdhYnN0cmFjdGlvbicgb3ZlciBNYXNzTGlzdAogICAgICAgICAqLwogICAgICAgIG1venM6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgcmV0dXJuIF8ucGx1Y2sodGhpcy5nZXQoJ3BlYWtzJyksICdtb3onKTsKICAgICAgICB9LAogICAgICAgIHNpemU6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdwZWFrcycpLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgCiAgICB9KTsKICAgIHJldHVybiBUaGVvU3BlY3RydW07Cn0pOwoKLyoKICogQnVpbGRzIHRoZW9yZXRpY2FsIG1hc3NlcyBiYXNlZCBvbiBhIFJpY2hTZXVlbmNlLiBJdCBjYW4gYmUgaW50YWN0IG1hc3MgKHdpdGggY2hhcmdlcykgb3IgZnJhZ21lbnRhdGlvbiBzcGVjdHJhLgogKiBWaXNpdCBNYXNzQnVpbGRlci10ZXN0LmpzIGZvciBwbGVudHkgb2YgZXhhbXBsZXMuCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvTWFzc0J1aWxkZXInLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1RoZW9TcGVjdHJ1bScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeSddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgUmljaFNlcXVlbmNlLCBUaGVvU3BlY3RydW0sIGRpY29BQSwgZGljb1Jlc01vZCkgewogIHZhciBNQVNTX09IID0gMTUuOTk0OTE0NjIyICsgMS4wMDc4MjUwMzIvLyBjdGVybQogIHZhciBNQVNTX0ggPSAxLjAwNzgyNTAzMi8vIG50ZXJtCiAgdmFyIE1BU1NfSFBMVVMgPSAxLjAwNzI3NjQ2NjgxMgoKICAvKioKICAgKiBwcml2YXRlIGNvbnRzdHJ1Y3RvcgogICAqLwogIE1hc3NCdWlsZGVyID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgIGluaXREZWYgOiBpbml0RGVmLAogICAgbGF1bmNoSW5pdCA6IGZhbHNlLAoKICAgIF9pbmRleE1vZGlmIDogbnVsbCwKICAgIF9pbmRleEFtaW5vQWNpZCA6IG51bGwsCgogICAgaW5kZXhNb2RpZiA6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgcmV0dXJuIChuYW1lID09PSB1bmRlZmluZWQpID8gdGhpcy5faW5kZXhNb2RpZiA6IHRoaXMuX2luZGV4TW9kaWZbbmFtZV0KICAgIH0sCiAgICBpbmRleEFtaW5vQWNpZCA6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgcmV0dXJuIChuYW1lID09PSB1bmRlZmluZWQpID8gdGhpcy5faW5kZXhBbWlub0FjaWQgOiB0aGlzLl9pbmRleEFtaW5vQWNpZFtuYW1lXQogICAgfSwKCiAgICBwX2luaXRfYW1pbm9fYWNpZHNfZnJvbV9qc29uIDogcF9pbml0X2FtaW5vX2FjaWRzX2Zyb21fanNvbiwKICAgIHBfaW5pdF9yZXNpZHVlX21vZGlmaWNhdGlvbnNfZnJvbV9qc29uIDogcF9pbml0X3Jlc2lkdWVfbW9kaWZpY2F0aW9uc19mcm9tX2pzb24sCgogICAgY29tcHV0ZU1hc3NSaWNoU2VxdWVuY2UgOiBjb21wdXRlTWFzc1JpY2hTZXF1ZW5jZSwKICAgIGNvbXB1dGVUaGVvU3BlY3RydW0gOiBjb21wdXRlVGhlb1NwZWN0cnVtLAogICAgY29tcHV0ZU1hc3NSaWNoQUEgOiBjb21wdXRlTWFzc1JpY2hBQSwKICAgIGNvbXB1dGVNYXNzTW9kaWZBcnJheSA6IGNvbXB1dGVNYXNzTW9kaWZBcnJheQoKICB9KTsKCiAgTWFzc0J1aWxkZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB0aGlzLmluaXREZWYob3B0aW9ucykKCiAgfQogIC8qKgogICAqIHJlYWQgTW9kaWZpY2F0aW9uLCBhbWlubyBhY2lkICYgY28gZGVmaW5pdGlvbnMgYXV0b21hdGljYWxseSBjYWxsZWQgb25jZQogICAqIGZyb20gdGhlIG9wdGlvbiBzcmMgaW4gbmV3CiAgICogQHByaXZhdGUKICAgKi8KICBmdW5jdGlvbiBpbml0RGVmKG9wdGlvbnMpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc3JjICE9PSB1bmRlZmluZWQpIHsKICAgICAgc2VsZi5sYXVuY2hJbml0ID0gdHJ1ZQogICAgICAkLmdldEpTT04ob3B0aW9ucy5zcmMgKyAnL3Jlc2lkdWVNb2RpZmljYXRpb24vbGlzdCcsIGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICBzZWxmLnBfaW5pdF9yZXNpZHVlX21vZGlmaWNhdGlvbnNfZnJvbV9qc29uKGRhdGEpCiAgICAgIH0pOwogICAgICAkLmdldEpTT04ob3B0aW9ucy5zcmMgKyAnL2FtaW5vQWNpZC9saXN0JywgZnVuY3Rpb24oZGF0YSkgewoKICAgICAgICBzZWxmLnBfaW5pdF9hbWlub19hY2lkc19mcm9tX2pzb24oZGF0YSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZGF0YSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHNlbGYubGF1bmNoSW5pdCA9IHRydWUKICAgICAgc2VsZi5wX2luaXRfYW1pbm9fYWNpZHNfZnJvbV9qc29uKG9wdGlvbnMuZGF0YS5hbWlub0FjaWRzKTsKICAgICAgc2VsZi5wX2luaXRfcmVzaWR1ZV9tb2RpZmljYXRpb25zX2Zyb21fanNvbihvcHRpb25zLmRhdGEucmVzaWR1ZU1vZGlmaWNhdGlvbnMpOwogICAgfQogIH0KCiAgdmFyIHBfaW5pdF9hbWlub19hY2lkc19mcm9tX2pzb24gPSBmdW5jdGlvbihkYXRhKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgaWR4ID0ge307CiAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24oZCkgewogICAgICBpZHhbZC5jb2RlMV0gPSBkCiAgICB9KTsKCiAgICBzZWxmLl9pbmRleEFtaW5vQWNpZCA9IGlkeDsKICB9OwoKICB2YXIgcF9pbml0X3Jlc2lkdWVfbW9kaWZpY2F0aW9uc19mcm9tX2pzb24gPSBmdW5jdGlvbihkYXRhKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgaWR4ID0ge307CiAgICBfLmVhY2goZGF0YSwgZnVuY3Rpb24oZCkgewogICAgICBpZHhbZC5uYW1lXSA9IGQKICAgIH0pOwoKICAgIHNlbGYuX2luZGV4TW9kaWYgPSBpZHg7CiAgfTsKCiAgLyoqCiAgICogY29tcHV0ZSBSaWNoQUEgbWFzcyAoYW1pbm8gYWNpZCArIG1vZGlmaWNhdGlvbnMpCiAgICogQHByaXZhdGUKICAgKi8KICBmdW5jdGlvbiBjb21wdXRlTWFzc1JpY2hBQShyYWEpIHsKICAgIHJldHVybiByYWEuYWEuZ2V0KCdtYXNzJykgKyBjb21wdXRlTWFzc01vZGlmQXJyYXkocmFhLm1vZGlmaWNhdGlvbnMpOwogIH0KCiAgLyoqCiAgICogY29tcHV0ZSB0aGUgbWFzcyBvZiBvZiBsaXN0IG9mIG1vZGlmaWNhdGlvbnMgKHVuZGVmaWVuZCBpcyBwb3NzaWJsZSkuIEl0J3MganVzdCB0aGUgc3VtIG9mIHRoZSBtb2RpZiBtYXNzZXMKICAgKiBAcHJpdmF0ZQogICAqLwogIGZ1bmN0aW9uIGNvbXB1dGVNYXNzTW9kaWZBcnJheShtb2RpZmljYXRpb25zKSB7CgogICAgaWYgKG1vZGlmaWNhdGlvbnMgPT09IHVuZGVmaW5lZCB8fCBtb2RpZmljYXRpb25zLmxlbmd0aCA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdmFyIHRvdCA9IDA7CiAgICBfLmVhY2gobW9kaWZpY2F0aW9ucywgZnVuY3Rpb24obSkgewogICAgICB0b3QgKz0gbS5nZXQoJ21hc3MnKTsKICAgIH0pOwogICAgcmV0dXJuIHRvdDsKICB9CgogIC8qKgogICAqIGdldCByaWNoIHNlcXVlbmNlIG1hc3MgaWYgYSBjaGFyZ2UgYXJndW1lbnQgaXMgZ2l2ZW4gLCBnZXQgdGhlIGNoYXJnZWQKICAgKiBwZXB0aWRlCiAgICogQHBhcmFtIHJpY2hTZXE6IHRoZSBwZXB0aWRlCiAgICogQHBhcmFtIGNoYXJnZTogY2hhcmdlIHN0YXRlLiBpZiB1bmRlZmluZWQsIE1IIHdpbGwgYmUgcmV0dXJuZWQKICAgKiBAcmV0dXJuIGEgZG91YmxlIGZvciB0aGUgbWFzcwogICAqLwogIGZ1bmN0aW9uIGNvbXB1dGVNYXNzUmljaFNlcXVlbmNlKHJpY2hTZXEsIGNoYXJnZSkgewoKICAgIHZhciByYXdNYXNzID0gMDsKCiAgICBfLmVhY2gocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICByYXdNYXNzICs9IGNvbXB1dGVNYXNzUmljaEFBKHJhYSkKICAgIH0pOwoKICAgIHJhd01hc3MgKz0gTUFTU19PSCArIE1BU1NfSDsKICAgIHJhd01hc3MgKz0gY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJpY2hTZXEuZ2V0KCduVGVybU1vZGlmaWNhdGlvbnMnKSkgKyBjb21wdXRlTWFzc01vZGlmQXJyYXkocmljaFNlcS5nZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycpKTsKICAgIGlmICghY2hhcmdlKSB7CiAgICAgIHJldHVybiByYXdNYXNzCiAgICB9CiAgICByZXR1cm4gcmF3TWFzcyAvIGNoYXJnZSArIE1BU1NfSFBMVVM7CiAgfQoKICAvKioKICAgKiBjb21wdXRlIHRoZSB0aGVvcmV0aWNhbCBtYXNzIHNwZWN0cnVtLiBiLCBiKyssIHksIHkrKwogICAqIEByZXR1cm4gYSB0aGVvcmV0aWNhbCBzcGVjdHJ1bQogICAqLwogIGZ1bmN0aW9uIGNvbXB1dGVUaGVvU3BlY3RydW0ocmljaFNlcSkgewogICAgdmFyIHJhd01hc3NlcyA9IFtjb21wdXRlTWFzc01vZGlmQXJyYXkocmljaFNlcS5nZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycpKV0uY29uY2F0KF8uY29sbGVjdChyaWNoU2VxLmdldCgnc2VxdWVuY2UnKSwgY29tcHV0ZU1hc3NSaWNoQUEpKTsKICAgIHZhciBuID0gcmF3TWFzc2VzLmxlbmd0aDsKICAgIGZvciAoIGkgPSAxOyBpIDwgbjsgaSsrKSB7CiAgICAgIHJhd01hc3Nlc1tpXSArPSByYXdNYXNzZXNbaSAtIDFdCiAgICB9CiAgICB2YXIgbXRvdCA9IHJhd01hc3Nlc1tuIC0gMV07CgogICAgdmFyIHRoZW9TcCA9IG5ldyBUaGVvU3BlY3RydW0oewogICAgICBmcmFnU2VyaWVzIDogWydiJywgJ2IrKycsICd5JywgJ3krKyddLAogICAgICBsZW5TZXEgOiByaWNoU2VxLnNpemUoKSwKICAgICAgcGVha3MgOiBbXSwKICAgICAgcmljaFNlcXVlbmNlIDogcmljaFNlcQogICAgfSk7CiAgICB2YXIgcGVha3MgPSB0aGVvU3AuZ2V0KCdwZWFrcycpOwogICAgZm9yICggaSA9IChyYXdNYXNzZXNbMF0gPj0gMTAwKSA/IDAgOiAxOyBpIDwgcmF3TWFzc2VzLmxlbmd0aDsgaSsrKSB7CgogICAgICB2YXIgcm0gPSByYXdNYXNzZXNbaV07CiAgICAgIC8vICAgICAgICAgICAgY29uc29sZS5sb2cocm0sIGkpCiAgICAgIHBlYWtzLnB1c2goewogICAgICAgIGxhYmVsIDogJ2InICsgaSwKICAgICAgICBzZXJpZXMgOiAnYicsCiAgICAgICAgbW96IDogcm0gKyBNQVNTX0hQTFVTLAogICAgICAgIHBvcyA6IGkgLSAxCiAgICAgIH0pOwogICAgICBwZWFrcy5wdXNoKHsKICAgICAgICBsYWJlbCA6ICdiKysnICsgaSwKICAgICAgICBzZXJpZXMgOiAnYisrJywKICAgICAgICBtb3ogOiBybSAvIDIgKyBNQVNTX0hQTFVTLAogICAgICAgIHBvcyA6IGkgLSAxCiAgICAgIH0pOwogICAgfQoKICAgIHZhciBtY3Rlcm1pbnVzID0gY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJpY2hTZXEuZ2V0KCdjVGVybU1vZGlmaWNhdGlvbnMnKSkKICAgIGZvciAoIGkgPSAwOyBpIDwgcmF3TWFzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciB5bSA9IG10b3QgLSByYXdNYXNzZXNbaV0gKyBNQVNTX09IICsgTUFTU19IICsgbWN0ZXJtaW51czsKICAgICAgaWYgKChpID09IHJhd01hc3Nlcy5sZW5ndGggLSAxICkgJiYgeW0gPCAxMDApIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgcGVha3MucHVzaCh7CiAgICAgICAgbGFiZWwgOiAneScgKyAobiAtIGkgLSAxKSwKICAgICAgICBzZXJpZXMgOiAneScsCiAgICAgICAgbW96IDogeW0gKyBNQVNTX0hQTFVTLAogICAgICAgIHBvcyA6IGkKICAgICAgfSk7CiAgICAgIHBlYWtzLnB1c2goewogICAgICAgIGxhYmVsIDogJ3krKycgKyAobiAtIGkgLSAxKSwKICAgICAgICBzZXJpZXMgOiAneSsrJywKICAgICAgICBtb3ogOiB5bSAvIDIgKyBNQVNTX0hQTFVTLAogICAgICAgIHBvcyA6IGkKICAgICAgfSk7CiAgICB9CiAgICBwZWFrcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgcmV0dXJuIGEubW96IC0gYi5tb3oKICAgIH0pOwogICAgcmV0dXJuIHRoZW9TcAogIH0KCiAgcmV0dXJuIG5ldyBNYXNzQnVpbGRlcigpOwp9KTsKCi8qCiAqIGZ1bmN0aW9uIHRvIGNvbXB1dGUgZGVsdGEgbWFzc2VzLgogICogT25seSBwcG0gaXMgaW1wbGVtZW50ZWQsIGJ1dCB0aGF0IHNob3VsZCBiZSB0aGUgaGFuZGxlciBmb3Igb3RoZXIgdW5pdHMgKERhIGV0Yy4uKQogICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3V0aWxzL0RlbHRhTWFzcycsWyd1bmRlcnNjb3JlJ10sIGZ1bmN0aW9uKF8pIHsKICAgIHZhciBEZWx0YU1hc3MgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIC8qKgogICAgICAgICAqIHN5bW1ldHJpY2FsbHkgY29ycmVjdCBwcG0gY29tcHV0YXRpb24gKHgteSkgc2hvdWxkIGVxdWFsIHRvICh5LXgpCiAgICAgICAgICoKICAgICAgICAgKiBAdHlwZSB7e2RlbHRhOiBkZWx0YSwgcmFuZ2U6IHJhbmdlLCBpc0Nsb3NlVG86IGlzQ2xvc2VUb319CiAgICAgICAgICovCiAgICAgICAgc2VsZi5wcG0gPSB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBtYXNzZXMKICAgICAgICAgICAgICAqIEBwYXJhbSB4CiAgICAgICAgICAgICAqIEBwYXJhbSB5CiAgICAgICAgICAgICAqIEByZXR1cm4ge251bWJlcn0KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGRlbHRhIDogZnVuY3Rpb24oeCwgeSkgewogICAgICAgICAgICAgICAgcmV0dXJuIDIgKiAoeSAtIHgpIC8gKHkgKyB4KSAqIDEwMDAwMDA7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiByZXR1cm4gbWFzcyBib3VuZGFyaWVzIGZvciB4ICstIHRvbAogICAgICAgICAgICAgKiBAcGFyYW0geAogICAgICAgICAgICAgKiBAcGFyYW0gdG9sCiAgICAgICAgICAgICAqIEByZXR1cm4ge1ttTWluLCBtTWF4XX0KICAgICAgICAgICAgICovCiAgICAgICAgICAgIHJhbmdlIDogZnVuY3Rpb24oeCwgdG9sKSB7CiAgICAgICAgICAgICAgICB0b2wgPSBNYXRoLmFicyh0b2wpIC8gMTAwMDAwMC4wOwogICAgICAgICAgICAgICAgdmFyIGYgPSAoMiArIHRvbCkgLyAoMiAtIHRvbCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiAoeD49MCk/W3ggLyBmLCB4ICogZl06W3ggKiBmLCB4IC8gZl0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIHdlIGhhdmUgdHdvIHZlcnNpb246CiAgICAgICAgICAgICAqICAtIHdpdGggdGhyZWUgcGFyYW1zLCByZXR1cm4gdHJ1ZS9mYWxzZSBpZiAodGFyZ2V0ICYgdG9sIGFyZSBjbG9zZXIgdGhhbiBjYW5kaWRhdGUpCiAgICAgICAgICAgICAqICAtIHdpdGggdHdvIHBhcmFtZXRlcnMsIHJldHVybiBhIGZ1bmN0aW9uIHRoYXQgd2lsbCB0YWtlIHcgcGFyZW10ZXIgb2YgdHlwZSBjYW5kaWRhdGU7IHRoaXMgc2hvdWxkIGJlIG11Y2ggZmFzdGVyCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQKICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHRvbAogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2FuZGlkYXRlCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBpc0Nsb3NlVG8gOiBmdW5jdGlvbih0YXJnZXQsIHRvbCwgY2FuZGlkYXRlKSB7CiAgICAgICAgICAgICAgICBpZiAoY2FuZGlkYXRlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoMiAqIChjYW5kaWRhdGUgLSB0YXJnZXQpIC8gKGNhbmRpZGF0ZSArIHRhcmdldCkgKiAxMDAwMDAwKSA8PSB0b2wKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciByID0gc2VsZi5wcG0ucmFuZ2UodGFyZ2V0LCB0b2wpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyA+PSByWzBdICYmIGMgPD0gclsxXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KCiAgICByZXR1cm4gbmV3IERlbHRhTWFzcygpOwoKfSkKOwovKgogKiBBYnN0cmFjdCB3aGF0IHdhcyBvbmx5IFBTTUFsaWdubWVudCBpbnRvIGFsaWdubWVudCBvZiB0d28gYmVhbnMgd2l0aCBmdW5jdGlvbiAubW96cygpIChnZXR0aW5nIGJhY2sgdGhlIGxpc3Qgb2YgbWFzc2VzKQogKiBUaGUgcG9pbnQgaXMgdG8gYWxpZ24gZXhwL3RoZW8sIGJ1dCBhbHNvIGV4cC9leHAKICoKICogVGhpcyB3aWxsIGJlIHBvcHVsYXRlZCB3aXRoIHBrbEEgYW5kIHBrbEIsIGVhY2ggb2YgdGhlbSBoYXZpbmcgYSAubW96cygpIGZ1bmN0aW9uLgogKgogKiBOQjogdGhlIHdheSB0aGUgYWxpZ25tZW50IGlzIHBlcmZvcm1lZCBub3QuLi4gZWZmaWNpZW50LiB3ZSBjb21wdXRlIGFnYWluIGFuZCBhZ2FpbiB0aGUgY2xvc2VzdCBwZWFrIHdpdGggdGhlIGRpY2hvdG9teSBtZXRob2RzLCBpbnN0ZWFkIG9mIG1vdmluZyAgd2l0aCBhIHNpbmdsZSwgb25lIHNob3QgbGluZWFyL2RpY2hvIG1ldGhvZC4uLgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvUGVha0xpc3RQYWlyQWxpZ25tZW50JyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy91dGlscy9EZWx0YU1hc3MnXSwgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBEZWx0YU1hc3MpIHsKICAgIHZhciBjbG9zZXN0UGVhayA9IGZ1bmN0aW9uICh4LCB4cGVha3MpIHsKCiAgICAgICAgaWYgKHggPD0geHBlYWtzWzBdKSB7CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfQogICAgICAgIHZhciBpc3VwID0geHBlYWtzLmxlbmd0aCAtIDE7CiAgICAgICAgaWYgKHggPj0geHBlYWtzW2lzdXBdKSB7CiAgICAgICAgICAgIHJldHVybiBpc3VwCiAgICAgICAgfQogICAgICAgIHZhciBpaW5mID0gMDsKCiAgICAgICAgd2hpbGUgKChpaW5mICsgMSkgPCBpc3VwKSB7CiAgICAgICAgICAgIHZhciBpbWlkID0gTWF0aC5yb3VuZCgoaWluZiArIGlzdXApIC8gMik7CiAgICAgICAgICAgIGlmICh4IDwgeHBlYWtzW2ltaWRdKSB7CiAgICAgICAgICAgICAgICBpc3VwID0gaW1pZAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWluZiA9IGltaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICgoeCAtIHhwZWFrc1tpaW5mXSkgPCAoeHBlYWtzW2lzdXBdIC0geCkpID8gaWluZiA6IGlzdXA7CiAgICB9CgogICAgcmV0dXJuIEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogZ2V0IHRoZSBtYXRjaGluZyBwZWFrIGluZGljZXMgZnJvbSBBIHRvIEIKICAgICAgICAgKiBAcmV0dXJuIHsqfQogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgbWF0Y2hJbmRpY2VzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG1venNBID0gc2VsZi5nZXQoJ3BrbEEnKS5tb3pzKCk7CiAgICAgICAgICAgIHZhciBtb3pzQiA9IHNlbGYuZ2V0KCdwa2xCJykubW96cygpOwoKICAgICAgICAgICAgdmFyIG5BID0gbW96c0EubGVuZ3RoOwogICAgICAgICAgICB2YXIgbkIgPSBtb3pzQi5sZW5ndGg7CiAgICAgICAgICAgIGlmIChuQSAqIG5CID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gW107CgogICAgICAgICAgICB2YXIgaUEgPSAwOwogICAgICAgICAgICB2YXIgaUIgPSAwOwogICAgICAgICAgICB2YXIgY3VyRGVsdGEgPSBEZWx0YU1hc3MucHBtLmRlbHRhKG1venNCWzBdLCBtb3pzQVswXSk7CiAgICAgICAgICAgIHZhciBsYXN0TWF0Y2ggPSB7CiAgICAgICAgICAgICAgICBpQTogMCwKICAgICAgICAgICAgICAgIGlCOiAwLAogICAgICAgICAgICAgICAgZXJyb3JQUE06IGN1ckRlbHRhCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciByZXQgPSBbbGFzdE1hdGNoXTsKICAgICAgICAgICAgd2hpbGUgKGlBIDwgbkEgJiYgaUIgPCBuQikgewogICAgICAgICAgICAgICAgdmFyIGluY0E7CiAgICAgICAgICAgICAgICBpZiAobW96c0FbaUFdIDwgbW96c0JbaUJdKSB7CiAgICAgICAgICAgICAgICAgICAgaW5jQSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgaUEgKz0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoaUEgPT0gbkEpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpbmNBID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaUIgKz0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoaUIgPT0gbkIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBuZXdEZWx0YSA9IERlbHRhTWFzcy5wcG0uZGVsdGEobW96c0JbaUJdLCBtb3pzQVtpQV0pOwogICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKG5ld0RlbHRhKSA8IE1hdGguYWJzKGN1ckRlbHRhKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChsYXN0TWF0Y2ggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXN0TWF0Y2ggPSB7fQogICAgICAgICAgICAgICAgICAgICAgICByZXQucHVzaChsYXN0TWF0Y2gpOwoKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoLmlBID0gaUE7CiAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoLmlCID0gaUI7CiAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoLmVycm9yUFBNID0gbmV3RGVsdGE7CgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjdXJEZWx0YSA9IDk5OTk5OTk5OTk5OTk5OTkuMDsKICAgICAgICAgICAgICAgICAgICBsYXN0TWF0Y2ggPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjdXJEZWx0YSA9IG5ld0RlbHRhOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQ7CgogICAgICAgIH0sCiAgICAgICAgbWF0Y2hlczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5tYXRjaEluZGljZXMoKTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEAgcmV0dXJuIHRoZSBsaXN0IG9mIG1hdGNoZXMgY2xvc2VyIHRoYW4gYSBnaXZlbiB0b2xlcmFuY2UKICAgICAgICAgKi8KICAgICAgICBjbG9zZXJUaGFuUFBNOiBmdW5jdGlvbiAodG9sKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG0gPSBfLmZpbHRlcihzZWxmLmdldCgnbWF0Y2hlcycpLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgcmV0dXJuIChNYXRoLmFicyhtLmVycm9yUFBNKSA8IHRvbCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBtCiAgICAgICAgfQogICAgfSk7Cn0pOwoKLyoqCiAqIGV4dGVuZHMgUGVha0xpc3RQYWlyQWxpZ25tZW50IHRvIG1hcCB0aGUgY2xvc2VzdCBwZWFrIG9mIGFuIGV4cGVyaW1lbnRhbCBhbmQgdGhlb3JldGljYWwgc3BlY3RyYS4gQm90aCBtdXN0IGJlIHNvcnRlZCBieSBtb3pzLgogKiBQcm9wZXJ0aWVzIGFyZQogKiAtIHJpY2hTZXF1ZW5jZQogKiAtIGV4cFNwZWN0cnVtCiAqCiAqIGFsaWdubWVudCBpcyByZWNvbXB1dGVkIG9uIHByb3BlcnR5IGNoYW5nZS4KICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvUFNNQWxpZ25tZW50JyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvTWFzc0J1aWxkZXInLCAnLi9QZWFrTGlzdFBhaXJBbGlnbm1lbnQnXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUsIG1hc3NCdWlsZGVyLCBQZWFrTGlzdFBhaXJBbGlnbm1lbnQpIHsKCiAgICAvKioKICAgICAqIGJ1aWxkIHRoZSBhbGlnbm1lbnQgd2l0aCBvcHRpb25zIHtyaWNoU2VxdWVuY2U6Li4uLCBleHBTcGVjdHJ1bTouLi59CiAgICAgKi8KICAgIHZhciBQU01BbGlnbm1lbnQgPSBQZWFrTGlzdFBhaXJBbGlnbm1lbnQuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIFBTTUFsaWdubWVudC5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIHt9KTsKCiAgICAgICAgICAgIHNlbGYuc2V0KCdyaWNoU2VxdWVuY2UnLCBvcHRpb25zLnJpY2hTZXF1ZW5jZSk7CiAgICAgICAgICAgIHNlbGYuc2V0KCdleHBTcGVjdHJ1bScsIG9wdGlvbnMuZXhwU3BlY3RydW0pOwoKICAgICAgICAgICAgc2VsZi5idWlsZCgpCgogICAgICAgICAgICBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpLm9uKCJjaGFuZ2UiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHNlbGYuYnVpbGQoKQogICAgICAgICAgICB9KQogICAgICAgICAgICBzZWxmLm9uKCJjaGFuZ2U6cmljaFNlcXVlbmNlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBjb21wdXRlIHRoZSB1bmRlcmx5aW5nIGFsaWdubWVudAogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgYnVpbGQgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zZXQoJ3RoZW9TcGVjdHJ1bScsIG1hc3NCdWlsZGVyLmNvbXB1dGVUaGVvU3BlY3RydW0oc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpKSk7CgogICAgICAgICAgICBzZWxmLnNldCgncGtsQScsIHNlbGYuZ2V0KCd0aGVvU3BlY3RydW0nKSkKICAgICAgICAgICAgc2VsZi5zZXQoJ3BrbEInLCBzZWxmLmdldCgnZXhwU3BlY3RydW0nKSkKCiAgICAgICAgICAgIHZhciBtYXRjaEluZGljZXMgPSBzZWxmLm1hdGNoSW5kaWNlcygpOwogICAgICAgICAgICB2YXIgc3BUaGVvID0gc2VsZi5nZXQoJ3RoZW9TcGVjdHJ1bScpLmdldCgncGVha3MnKTsKICAgICAgICAgICAgdmFyIHhwZWFrcyA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnbW96cycpOwogICAgICAgICAgICB2YXIgeEludGVuc2l0aWVzID0gc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwoKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBfLm1hcChtYXRjaEluZGljZXMsIGZ1bmN0aW9uKG1pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewoKICAgICAgICAgICAgICAgICAgICB0aGVvIDogc3BUaGVvW21pLmlBXSwKICAgICAgICAgICAgICAgICAgICBleHAgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4IDogbWkuaUIsCiAgICAgICAgICAgICAgICAgICAgICAgIG1veiA6IHhwZWFrc1ttaS5pQl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNbbWkuaUJdLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZXJyb3JQUE0gOiBtaS5lcnJvclBQTQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICBzZWxmLnNldCgnbWF0Y2hlcycsIG1hdGNoZXMpOwoKICAgICAgICB9LAogICAKICAgICAgICAvKioKICAgICAgICAgKiBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGV4cGVyaW1lbnRhbCBwcmVjdXJzbyBtYXNzIGFuZCB0aGUgc2VxdWVuY2UgbWFzcyAoTUgpCiAgICAgICAgICovCiAgICAgICAgZGVsdGFQcmVjTW96cyA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciB6ID0gc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdwcmVjQ2hhcmdlJyk7CiAgICAgICAgICAgIHZhciB0aGVvID0gbWFzc0J1aWxkZXIuY29tcHV0ZU1hc3NSaWNoU2VxdWVuY2Uoc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpLCB6KQogICAgICAgICAgICByZXR1cm4gKHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgncHJlY01veicpIC0gdGhlbykgKiB6CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4ge3t9fSBhIGpzbyByZWFkeSBzdHJpbmcKICAgICAgICAgKi8KICAgICAgICBzZXJpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcmV0ID0ge307CiAgICAgICAgICAgIHJldC5leHBTcGVjdHJ1bSA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLnRvSlNPTigpCgogICAgICAgICAgICB2YXIgcnNlcSA9IHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKS50b1N0cmluZygpOwogICAgICAgICAgICByZXQucmljaFNlcXVlbmNlID0gcnNlcQoKICAgICAgICAgICAgcmV0LmlkID0gc2VsZi5jb21wdXRlSWQoKTsKICAgICAgICAgICAgcmV0LmFhU2VxdWVuY2UgPSBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9BQVN0cmluZygpOwoKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9LAogICAgICAgIGNvbXB1dGVJZCA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2lkJykgKyAnfCcgKyBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKQoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIHJldHVybiB0aGUgbnVtYmVyIG9mIHVubWF0Y2hlZCBleHBlcmltZW50YWwgcGVhaywgd2l0aCBhIG1hc3MgZ3JlYXRlciB0aGFuIHRoZSBwcmVjdXJzb3IsCiAgICAgICAgICogaW50ZW5zaXR5IDwgaW5GaXJzdCBhbmQgd2l0aCB0b2wgZXJyb3IKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdG9sCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGluRmlyc3QKICAgICAgICAgKiBAcmV0dXJuIGFuIGludGVnZXIgY291bnQKICAgICAgICAgKi8KICAgICAgICB1bm1hdGNoZWRGYWN0b3IgOiBmdW5jdGlvbih0b2wsIGluRmlyc3QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHNlbGYuY2xvc2VyVGhhblBQTSh0b2wpOwoKICAgICAgICAgICAgdmFyIHBrcyA9IF8uZmlsdGVyKF8uemlwKHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnbW96cycpLCBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2ludGVuc2l0eVJhbmtzJykpLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFsxXSA8IGluRmlyc3QKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbVByZWMgPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKQogICAgICAgICAgICByZXR1cm4gXy5maWx0ZXIocGtzLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFswXSA+IG1QcmVjOwogICAgICAgICAgICB9KS5sZW5ndGggLSBfLmZpbHRlcihtYXRjaGVzLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKG0uZXhwLmludGVuc2l0eVJhbmsgPCBpbkZpcnN0KSAmJiAobS5leHAubW96ID4gbVByZWMpOwogICAgICAgICAgICB9KS5sZW5ndGgKCiAgICAgICAgfQogICAgfSk7CiAgIAogICAgcmV0dXJuIFBTTUFsaWdubWVudDsKfSk7CgovKioKICogYW4gSW1wbGljaXRNb2RpZmllciBpcyB0byBiZSBsaW5rZWQgdG8gbGFiZWxsaW5nIG9yIHRvIGEgZ2xvYmFsIGF0dHJpYnV0aW9uIG9mIG1vZGlmaWNhdGlvbi4KICogSXQgZWFzaWVyIHRvIHNheSBhIHBlcHRpZGUgaXMgU2lsYWMgZWl0aGVyIHRoYW4gYWRkaW5nIFNpbGFjIG1hc3Mgc2hpZnQgb2luIGV2ZXJ5IEsgJiBSLgogKiBUaGlzIGNhbiBiZSBldmVuIGxpZ2h0ZXIgd2l0aCAxM0MxNU4gbGFiZWwsIHdoZXJlIGV2ZXJ5IGFtaW5vIGFjaWQgaXMgbW9kaWZpZWQgd2l0aCBhIG1hc3Mgc2hpZnQgKHJlcHJlc2VudGVkIGFzIGEgcmVzaWR1ZSBtb2RpZmljYXRpb24pLgogKiBNdWx0aXBsZSBsYWJlbHMgY2FuIGJlIGFwcGxpZWQgb24gdGhlIHNhbWUgc2VxdWVuY2UgKHRoZXJlIGlzIGEgZGVmaW5lZCBsaXN0IG9mIHByZWNlZGVuY2UpCiAqCiAqIEltcGxpY2l0TW9kaWZpZXIgaGFzIHRvIGtub3cgdGhlIG9kZHMgb2YgZWFjaCBsYWJlbGluZyBtZXRob2QuIEZvciBleGFtcGxlLCBLIGNhbiBzdGlsbCBiZSBwcm9waW9ueWxhdGVkIGlmIGl0IGhhcyBhIE1ldGh5bCwgYnV0IG5vdCBhIERpbWV0aHlsLgogKgogKiBUaGUgbWFpbiBtZXRob2QgYXJlCiAqIGxhYmVsKGxhYk5hbWUsIHJpY2hTZXEpOiBhZGQgYWxsIHRoZSBsYWJlbCBtb2RpZmljYXRpb24gdG8gYSBnaXZlbiBwZXB0aWRlCiAqIHVubGFiZWwobGFiTmFtLCByaWNoU2VxdWVuY2UpOiByZW1vdmUgdGhlIG1vZGlmaWNhdGlvbiB0aWdodGVuIHRvIHRoaXMgbGFiZWwgKGlmIHRoZXJlIHdlcmUgZW5vdWdoIHRvIGxhYmVsIHRoZSBzZXF1ZW5jZSkuCiAqIGdldExhYmVsKHJpY2hTZXEpOiBnZXQgdGhlIGxhYmVsIGZpdHRpbmcgdGhlIGdpdmVuIHJpY2hTZXF1ZW5jZQogKgogKiBUaGVyZSBpcyBhIHZhc3Qgc2V0IG9mIHRlc3QgYXZhaWxhYmxlIGluIHRoZSBJbXBsaWNpdE1vZGlmaWVyLXRlc3RzLmpzCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvSW1wbGljaXRNb2RpZmllcicsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9SaWNoU2VxdWVuY2UnLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeSddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIFJpY2hTZXF1ZW5jZSwgZGljb1Jlc01vZCkgewoKICAgIC8qKgogICAgICogbGFiZWxlcnMgYXJlIHRoZSBlc3NlbmNlIG9mIHRoZSBpbXBsaWNpdCBsYWJlbGxpbmcKICAgICAqIHRoZXkgYXJlIGZ1bmN0aW9ucywgZGVmaW5lZCBmb3IgZWFjaCBwcm9wLCBwcm9wX2QxMCwgc2lsYWMgb3Igd2hhdGV2ZXIsIHRoYXQgdGFrZSBhIHJpY2hTZXF1ZW5lY2UgYW5kIGEgcG9zaXRpb24gYW5kIHJldHVybiBhIG1vZGlmaWNhdGlvbiAob3IgdW5kZWZpbmVkKSB0aGF0IHNob3VsZCBvY2N1ciB0aGVyZS4KICAgICAqIFdlIG5lZWQgYWxsIHRoYXQgYmVjYXVzZSBmb3IgZXhhbXBsZSBmb3IgcHJvcGlvbnlsYXRpb24sIHdlIG11c3Qga25vdyBpZiB0aGVyZSBpcyBhbHJlYWRuIGEgbW9uby0gb3IgYSBkaS1tZXRoeWxhdGlvbiBvbiB0aGUgc2l0ZS4uLgogICAgICoKICAgICAqIHByb3Bpb255bExhYmVsZXIgaXMganVzdCBhbiBwcml2YXRlIGZ1bmN0aW9uIHRvIGxhYmVsIEsgKyBudGVybSB3aXRoIHByb3Bpb255bCBkMCBvciBkNQogICAgICovCgogICAgdmFyIGFxdWFNb2RpZnMgPSB7fTsKICAgIF8uZWFjaCgnVkRMSVRHRkFZJy5zcGxpdCgnJyksIGZ1bmN0aW9uKGFhKXsKICAgIAlhcXVhTW9kaWZzW2FhXSA9ICBkaWNvUmVzTW9kLmdldCgnQVFVQV8nK2FhKQogICAgfSk7CiAgICBfLmVhY2goYXF1YU1vZGlmcywgZnVuY3Rpb24obW9kLCBhYSkgewogICAgICAgIGRpY29SZXNNb2QuYWRkKHsKICAgICAgICAgICAgbmFtZSA6ICdkZV8nICsgbW9kLmdldCgnbmFtZScpLAogICAgICAgICAgICBmdWxsTmFtZSA6ICdkZV8nICsgbW9kLmdldCgnZnVsbE5hbWUnKSwKICAgICAgICAgICAgbWFzcyA6IC1tb2QuZ2V0KCdtYXNzJykKICAgICAgICB9KTsKICAgIH0pCiAgICB2YXIgcHJvcGlvbnlsTGFiZWxlciA9IGZ1bmN0aW9uKHBtb2QpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEpIHsKICAgICAgICAgICAgICAgIGlmIChyaWNoU2VxLmNvdW50TW9kaWZpY2F0aW9uc0F0KC0xKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbW9kcyA9IHJpY2hTZXEubW9kaWZBdCgtMSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZHMubGVuZ3RoID09IDEgJiYgbW9kc1swXSA9PSBwbW9kKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbW9kOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcG1vZDsKICAgICAgICAgICAgICAgIC8vKHJpY2hTZXEuY291bnRNb2RpZmljYXRpb25zQXQoLTEpID4gMCkgPyB1bmRlZmluZWQgOiBwbW9kCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocmljaFNlcS5hYUF0KHBvcykuZ2V0KCdjb2RlMScpID09PSAnSycpIHsKICAgICAgICAgICAgICAgIGlmIChfLmFueShyaWNoU2VxLm1vZGlmQXQocG9zKSwgZnVuY3Rpb24ocm0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIS8oTWV0aHlsfFByb3Bpb255bC4qKS8udGVzdChybS5nZXQoJ25hbWUnKSk7CiAgICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG1vZDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgbGFiZWxlcnMgPSB7CiAgICAgICAgbm9uZSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0sCiAgICAgICAgcHJvcF9kMCA6IHByb3Bpb255bExhYmVsZXIoZGljb1Jlc01vZC5nZXQoJ1Byb3Bpb255bCcpKSwKICAgICAgICBwcm9wX2Q1IDogcHJvcGlvbnlsTGFiZWxlcihkaWNvUmVzTW9kLmdldCgnUHJvcGlvbnlsOjJIKDUpJykpLAogICAgICAgICcxM0MxNU4nIDogZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEgfHwgcG9zID09IHJpY2hTZXEuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhYSA9IHJpY2hTZXEuYWFBdChwb3MpLmdldCgnY29kZTEnKTsKICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCcxM0MxNU4tJyArIGFhKTsKICAgICAgICB9LAogICAgICAgICdhcXVhJyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gYXF1YU1vZGlmc1tyaWNoU2VxLmFhQXQocG9zKS5nZXQoJ2NvZGUxJyldOwogICAgICAgIH0sCiAgICAgICAgJ2RlX2FxdWEnIDogZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEgfHwgcG9zID09IHJpY2hTZXEuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYW0gPSBfLmZpbHRlcihyaWNoU2VxLm1vZGlmQXQocG9zKSwgZnVuY3Rpb24ocm0pewogICAgICAgICAgICAgICAgcmV0dXJuIHJtLmdldCgnbmFtZScpLmluZGV4T2YoJ0FRVUFfJykgPT09IDA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSlbMF07CiAgICAgICAgICAgIGlmKGFtID09PSB1bmRlZmluZWQgKXsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdkZV8nK2FtLmdldCgnbmFtZScpKTsKICAgICAgICB9LAogICAgICAgIHNpbGFjIDogZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgICAgIGlmIChwb3MgPT0gLTEgfHwgcG9zID09IHJpY2hTZXEuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhYSA9IHJpY2hTZXEuYWFBdChwb3MpLmdldCgnY29kZTEnKTsKCiAgICAgICAgICAgIGlmIChhYSA9PT0gJ0snKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGljb1Jlc01vZC5nZXQoJ0xhYmVsOjEzQyg2KTE1TigyKScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhYSA9PT0gJ1InKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGljb1Jlc01vZC5nZXQoJ0xhYmVsOjEzQyg2KTE1Tig0KScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIHVuZGVmaW5lZAogICAgICAgIH0sCiAgICAgICAgJ3N1cGVyX3NpbGFjJyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFhID0gcmljaFNlcS5hYUF0KHBvcykuZ2V0KCdjb2RlMScpOwoKICAgICAgICAgICAgaWYgKGFhID09PSAnSycpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnTGFiZWw6MTNDKDYpMTVOKDIpJykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICB9OwogICAgbGFiZWxlcnMucHJvcF9kNV9udGVybSA9IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgIGlmIChwb3MgPT0gLTEpIHsKICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdQcm9waW9ueWw6MkgoNSknKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxhYmVsZXJzLnByb3BfZDAocmljaFNlcSwgcG9zKTsKICAgIH07CiAgICBsYWJlbGVycy5waWMgPSBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICBpZiAocG9zICE9IC0xKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdQSUMnKTsKICAgICAgICAvL3JldHVybiAocmljaFNlcS5jb3VudE1vZGlmaWNhdGlvbnNBdCgtMSkgPiAwKSA/IHVuZGVmaW5lZCA6IGRpY29SZXNNb2QuZ2V0KCdQSUMnKTsKICAgIH07CiAgICBsYWJlbGVycy5waWNfaGVhdnkgPSBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICBpZiAocG9zICE9IC0xKSB7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdQSUNfSEVBVlknKTsKICAgICAgICAvL3JldHVybiAocmljaFNlcS5jb3VudE1vZGlmaWNhdGlvbnNBdCgtMSkgPiAwKSA/IHVuZGVmaW5lZCA6IGRpY29SZXNNb2QuZ2V0KCdQSUMnKTsKICAgIH07CiAgICB2YXIgbGFiZWxlcnNPcmRlciA9IHsKICAgICAgICAnMTNDMTVOJyA6IDMsCiAgICAgICAgJ2FxdWEnIDogNCwKICAgICAgICAnZGVfYXF1YScgOiA0LAogICAgICAgIHByb3BfZDAgOiAxMCwKICAgICAgICBwcm9wX2Q1IDogOSwKICAgICAgICBwcm9wX2Q1X250ZXJtIDogMTUsCiAgICAgICAgcGljIDogNSwKICAgICAgICBwaWNfaGVhdnkgOiA1LAogICAgICAgIHNpbGFjIDogMTAwLAogICAgICAgIHN1cGVyX3NpbGFjIDogOTAsCiAgICAgICAgbm9uZSA6IDEwMDAKICAgIH0KCiAgICBJbXBsaWNpdE1vZGlmaWVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYubGFiZWxlcnMgPSBsYWJlbGVyczsKICAgICAgICBzZWxmLmxhYmVsZXJzT3JkZXIgPSBsYWJlbGVyc09yZGVyOwoKICAgICAgICByZXR1cm4gc2VsZgogICAgfTsKCiAgICAvKioKICAgICAqIEFkZCBhbGwgbW9kaWZpY2F0aW9uIGFzc29jaWF0ZWQgdG8gdGhlIGxhYmVsIG9uIHRoZSByaWNoU2VxdWVuY2Ugb2JqZWN0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gbGFiZWxOYW1lcyBhIGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIGxhYmVscywgb3IgYW4gYXJyYXkgb2Ygc3RyaW5nICh3ZSBjYW4gaGF2ZSAnc2lsYWMscHJvcF9kMCcsIG9yICdwcm9wX2Q1JykKICAgICAqIEBwYXJhbSB7T2JqZWN0fSByaWNoU2VxdWVuY2UKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUubGFiZWwgPSBmdW5jdGlvbihsYWJlbE5hbWVzLCByaWNoU2VxdWVuY2UpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgdmFyIHMgPSByaWNoU2VxdWVuY2Uuc2l6ZSgpOwogICAgICAgIGlmICghIF8uaXNBcnJheShsYWJlbE5hbWVzKSkgewogICAgICAgICAgICBsYWJlbE5hbWVzID0gbGFiZWxOYW1lcy5zcGxpdCgnLCcpCiAgICAgICAgfQogICAgICAgIF8uZWFjaChfLnNvcnRCeShsYWJlbE5hbWVzLCBmdW5jdGlvbihsbmFtZSkgewogICAgICAgICAgICByZXR1cm4gc2VsZi5sYWJlbGVyc09yZGVyW2xuYW1lXSB8fCAxMDAwMDA7CiAgICAgICAgfSksIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAtMTsgaSA8PSBzOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBtID0gc2VsZi5sYWJlbGVyc1tsbmFtZV0ocmljaFNlcXVlbmNlLCBpKTsKICAgICAgICAgICAgICAgIGlmIChtICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByaWNoU2VxdWVuY2UuYWRkTW9kaWZpY2F0aW9uKGksIG0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgIH0KICAgIC8qKgogICAgICoganVzdCByZXR1cm5zIGEgc29ydGVkIChhbHBoYW51bWVyaWMpIGxpc3Qgb2YgdGhlIGF2YWlsYWJsZSBsYWJlbHMKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUuYXZhaWxhYmxlTGFiZWxzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF8ua2V5cyh0aGlzLmxhYmVsZXJzKS5zb3J0KCk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbGwgbW9kaWZpY2F0aW9uIGFzc29jaWF0ZWQgdG8gdGhlIGxhYmVsIG9uIHRoZSByaWNoU2VxdWVuY2Ugb2JqZWN0LgogICAgICogQXQgdGhpcyBzdGFnZSwgd2UgYXNzdW1lIHRoZSByaWNoU2VxdWVuY2UgaGFzIHRoZSBtb2RpZiBhc3NvY2lhdGVkIHdpdGggdGhlIGxhYmVsCiAgICAgKiBAcGFyYW0ge09iamVjdH0gbGFiZWxOYW1lcyBhIGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIGxhYmVscyAod2UgY2FuIGhhdmUgJ3NpbGFjLHByb3BfZDAnLCBvciAncHJvcF9kMTAnKQogICAgICogQHBhcmFtIHtPYmplY3R9IHJpc2hTZXF1ZW5jZQogICAgICovCiAgICBJbXBsaWNpdE1vZGlmaWVyLnByb3RvdHlwZS51bmxhYmVsID0gZnVuY3Rpb24obGFiZWxOYW1lcywgcmljaFNlcXVlbmNlKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICB2YXIgcyA9IHJpY2hTZXF1ZW5jZS5zaXplKCk7CiAgICAgICAgaWYgKCEgXy5pc0FycmF5KGxhYmVsTmFtZXMpKSB7CiAgICAgICAgICAgIGxhYmVsTmFtZXMgPSBsYWJlbE5hbWVzLnNwbGl0KCcsJykKICAgICAgICB9CiAgICAgICAgXy5lYWNoKF8uc29ydEJ5KGxhYmVsTmFtZXMsIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiAtKHNlbGYubGFiZWxlcnNPcmRlcltsbmFtZV0gfHwgMTAwMDAwKTsKICAgICAgICB9KSwgZnVuY3Rpb24obG5hbWUpIHsKICAgICAgICAgICAgZm9yICggaSA9IC0xOyBpIDw9IHM7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIG1vZGlmcyA9IHJpY2hTZXF1ZW5jZS5nZXRNb2RpZmljYXRpb25BcnJheShpKTsKICAgICAgICAgICAgICAgIGlmICghbW9kaWZzKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtb2RpZnMgPSBfLmRpZmZlcmVuY2UobW9kaWZzLCBzZWxmLmxhYmVsZXJzW2xuYW1lXShyaWNoU2VxdWVuY2UsIGkpKTsKICAgICAgICAgICAgICAgIHJpY2hTZXF1ZW5jZS5zZXRNb2RpZmljYXRpb25BcnJheShpLCBtb2RpZnMpCgogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIHJldHVybnMgYW4gYXJyYXkgd2l0aCB0aGUgbW9kaWZpZWQgcG9pc2l0aW9ucywgb25jZSBsYWJlaW5nIG1vZGlmIGhhdmUgYmVlbiByZW1vdmVkCiAgICAgKiAoLTEgPT4gbnRlcm0pCiAgICAgKi8KICAgIEltcGxpY2l0TW9kaWZpZXIucHJvdG90eXBlLm5vbmltcGxpY2l0TW9kaWZpZWRQb3MgPSBmdW5jdGlvbihyaWNoU2VxdWVuY2UpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgdmFyIHJzID0gcmljaFNlcXVlbmNlLmNsb25lKCk7CiAgICAgICAgc2VsZi5nZXRMYWJlbHNBbmRDbGVhbihycyk7CiAgICAgICAgcmV0dXJuIF8uZmlsdGVyKF8ucmFuZ2UoLTEsIHJzLnNpemUoKSksIGZ1bmN0aW9uKGkpIHsKICAgICAgICAgICAgcmV0dXJuIHJzLmNvdW50TW9kaWZpY2F0aW9uc0F0KGkpID4gMDsKICAgICAgICB9KQogICAgfQogICAgLyoqCiAgICAgKiByZXR1cm4gdHJ1ZS9mYWxzZSBpZiB0aGUgUmljaFNlcXVlbmNlIGlzIGZpbGxlZCB3aXRoIHRoZSBtb2RpZmljYXRpb24gY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gbGFiZWwuCiAgICAgKiBpLmUuIHdlIGNhbiByZW1vdmUgYWxsIHRoZSBtb2RpZiBhbmQgY29uc2lkZXIgdGhlIFJpY2hTZXF1ZW5jZSBhcyBpbXBsaWNpdGVseSBtb2RpZmllZAogICAgICogQHBhcmFtIHtPYmplY3R9IGxhYmVsTmFtZSBvbmUgbGFiZWwgbmFtZQogICAgICogQHBhcmFtIHtPYmplY3R9IHJpc2hTZXF1ZW5jZQogICAgICovCiAgICBJbXBsaWNpdE1vZGlmaWVyLnByb3RvdHlwZS5pc0xhYmVsZWQgPSBmdW5jdGlvbihsYWJlbE5hbWUsIHJpY2hTZXF1ZW5jZSkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIGF0TGVhc3RPbmUgPSBmYWxzZQogICAgICAgIHJldHVybiBfLmFsbChfLnJhbmdlKC0xLCByaWNoU2VxdWVuY2Uuc2l6ZSgpICsgMSksIGZ1bmN0aW9uKGkpIHsKICAgICAgICAgICAgdmFyIGV4cGVjdGVkTW9kaWYgPSBzZWxmLmxhYmVsZXJzW2xhYmVsTmFtZV0ocmljaFNlcXVlbmNlLCBpKTsKICAgICAgICAgICAgaWYgKGV4cGVjdGVkTW9kaWYgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJpY2hTZXF1ZW5jZS5jb3VudE1vZGlmaWNhdGlvbnNBdChpKSA9PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF0TGVhc3RPbmUgPSB0cnVlOwoKICAgICAgICAgICAgcmV0dXJuIF8uYW55KHJpY2hTZXF1ZW5jZS5nZXRNb2RpZmljYXRpb25BcnJheShpKSwgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG0gPT0gZXhwZWN0ZWRNb2RpZjsKICAgICAgICAgICAgfSk7CgogICAgICAgIH0pICYmIGF0TGVhc3RPbmU7CgogICAgfQogICAgLyoqCiAgICAgKiBjbGVhbiB1cCB0aGUgaW1wbGljaXQgbW9kaWZpY2F0aW9ucyAgYW5kIHJldHVybiBhIGxpc3Qgb2YgKHNvcnRlZCBhbHBoYSkgbGFiZWwgbmFtZXMgdGhhdCB3ZXJlIHVzZWQgZm9yIGNsZWFudXAKICAgICAqIEBwYXJhbSB7T2JqZWN0fSByaWNoU2VxdWVuY2UKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUuZ2V0TGFiZWxzQW5kQ2xlYW4gPSBmdW5jdGlvbihyaWNoU2VxdWVuY2UpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIHZhciBsYWJlbHMgPSBbXTsKICAgICAgICBfLmVhY2goXy5zb3J0QnkoXy5rZXlzKHNlbGYubGFiZWxlcnNPcmRlciksIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiAtKHNlbGYubGFiZWxlcnNPcmRlcltsbmFtZV0gfHwgMTAwMDAwKTsKICAgICAgICB9KSwgZnVuY3Rpb24obG5hbWUpIHsKICAgICAgICAgICAgaWYgKCFzZWxmLmlzTGFiZWxlZChsbmFtZSwgcmljaFNlcXVlbmNlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZi51bmxhYmVsKGxuYW1lLCByaWNoU2VxdWVuY2UpOwogICAgICAgICAgICBsYWJlbHMucHVzaChsbmFtZSkKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gbGFiZWxzLnNvcnQoKQogICAgfQogICAgcmV0dXJuIG5ldyBJbXBsaWNpdE1vZGlmaWVyKCk7Cn0pOwoKLyoqCiAqIGEgcmVjdGFuZ3VsYXIsIG5vIGxlZ2VuZCBjb2xvciBQU01BbGlnbm1lbnQgd2lkZ2V0CiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hNYXBTbGltVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInXSwgZnVuY3Rpb24oXywgQmFja2JvbmUsIENvbW1vbldpZGdldFZpZXcsIGltcGxpY2l0TW9kaWZpZXIpIHsKCiAgICBNYXRjaE1hcFNsaW1WaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBoZWlnaHQgOiAxMiwKICAgICAgICAgICAgdG9sIDogNTAwCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICBNYXRjaE1hcFNsaW1WaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgYXJndW1lbnRzKQogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgMTI7CiAgICAgICAgICAgIHNlbGYudG9sID0gb3B0aW9ucy50b2wgfHwgNTAwOwoKICAgICAgICB9LAogICAgICAgIHJlbmRlciA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgdGhlb1NwZWN0cnVtID0gc2VsZi5tb2RlbC5nZXQoJ3RoZW9TcGVjdHJ1bScpOwogICAgICAgICAgICB2YXIgbmJTZXJpZXMgPSB0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoCgogICAgICAgICAgICAvLyBnZXQgZnJhZyBzZXJpZXMgLT4gb3JkaW5hdGUKICAgICAgICAgICAgdmFyIHNlcmllczJqID0ge307CiAgICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgICAgXy5lYWNoKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSwgZnVuY3Rpb24oZnMpIHsKICAgICAgICAgICAgICAgIGlmIChzZXJpZXMyaltmc1swXV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2VyaWVzMmpbZnNbMF1dID0gaSsrOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBoUm93ID0gc2VsZi5oZWlnaHQgLyBfLmtleXMoc2VyaWVzMmopLmxlbmd0aDsKICAgICAgICAgICAgdmFyIHdDb2wgPSBoUm93OwoKICAgICAgICAgICAgdmFyIGxlblNlcSA9IHRoZW9TcGVjdHJ1bS5nZXQoJ2xlblNlcScpOwogICAgICAgICAgICB2YXIgd1RleHQgPSAzMDsKICAgICAgICAgICAgdmFyIHdpZHRoID0gbGVuU2VxICogd0NvbCArIHdUZXh0OwogICAgICAgICAgICB2YXIgaGVpZ2h0ID0gc2VsZi5oZWlnaHQ7CgogICAgICAgICAgICB2YXIgZnMyaiA9IGZ1bmN0aW9uKGZzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHNlcmllczJqW2ZzWzBdXSkgKiBoUm93OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRhdGEgbWF0Y2hlcwogICAgICAgICAgICB2YXIgZG1hdGNoZXMgPSBzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi50b2wpOwoKICAgICAgICAgICAgdmFyIHJlY3RCZyA9IHNlbGYuZWwuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpLmF0dHIoJ3dpZHRoJywgd2lkdGgpLmF0dHIoJ2hlaWdodCcsIGhlaWdodCkKICAgICAgICAgICAgdmFyIGdSb290ID0gc2VsZi5lbC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdmcmFnLWNvbG9yLW1hdGNoJyk7CiAgICAgICAgICAgIHByZWN0ID0gZ1Jvb3Quc2VsZWN0QWxsKCdyZWN0JykuZGF0YShkbWF0Y2hlcykuZW50ZXIoKQogICAgICAgICAgICBwcmVjdC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKGRtKSB7CiAgICAgICAgICAgICAgICB2YXIgaXJrID0gZG0uZXhwLmludGVuc2l0eVJhbms7CiAgICAgICAgICAgICAgICByZXR1cm4gInJrLSIgKyAoKGlyayA8IDQwKSA/IE1hdGguZmxvb3IoaXJrIC8gMTApIDogJ3gnKQogICAgICAgICAgICB9KS5hdHRyKCd4JywgZnVuY3Rpb24oZG0pIHsKICAgICAgICAgICAgICAgIGlmIChkbS50aGVvLnNlcmllcyA8ICdnJykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGRtLnRoZW8ucG9zICsgMC41KSAqIHdDb2wKICAgICAgICAgICAgICAgIGlmIChkbS50aGVvLnBvcyA9PSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgICAgICByZXR1cm4gKGRtLnRoZW8ucG9zIC0gMC41KSAqIHdDb2wKICAgICAgICAgICAgfSkuYXR0cigneScsIGZ1bmN0aW9uKGRtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnMyaihkbS50aGVvLnNlcmllcykKICAgICAgICAgICAgfSkuYXR0cignd2lkdGgnLCBmdW5jdGlvbihkbSkgewogICAgICAgICAgICAgICAgaWYgKChkbS50aGVvLnBvcyA9PSAwKSAmJiAoZG0udGhlby5zZXJpZXMgPiAnZycpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB3Q29sIC8gMjsKICAgICAgICAgICAgICAgIGlmICgoZG0udGhlby5wb3MgPT0gbGVuU2VxIC0gMSkgJiYgKGRtLnRoZW8uc2VyaWVzIDwgJ2cnKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd0NvbCAvIDI7CiAgICAgICAgICAgICAgICByZXR1cm4gd0NvbDsKICAgICAgICAgICAgfSkuYXR0cignaGVpZ2h0JywgaFJvdykuYXR0cigndGl0bGUnLCBmdW5jdGlvbihkbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRtLnRoZW8ubGFiZWwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbW9kUG9zID0gaW1wbGljaXRNb2RpZmllci5ub25pbXBsaWNpdE1vZGlmaWVkUG9zKHNlbGYubW9kZWwuZ2V0KCdyaWNoU2VxdWVuY2UnKSk7CiAgICAgICAgICAgIGdSb290LnNlbGVjdEFsbCgncmVjdC5tb2RpZmllZC1zaXRlJykuZGF0YShtb2RQb3MpLmVudGVyKCkuYXBwZW5kKCdyZWN0JykuY2xhc3NlZCgnbW9kaWZpZWQtc2l0ZScsIHRydWUpLmF0dHIoJ3gnLCBmdW5jdGlvbihpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaSAqIHdDb2w7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCAwKS5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCkuYXR0cignd2lkdGgnLCB3Q29sKTsKCiAgICAgICAgICAgIHZhciBnID0gc2VsZi5lbC5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAod2lkdGggLSB3VGV4dCkgKyAnLDApJyk7CiAgICAgICAgICAgIGcuYXBwZW5kKCdyZWN0JykuY2xhc3NlZCgnbWF0Y2gtYm94LXRleHQtYmcnLCB0cnVlKS5hdHRyKCd3aWR0aCcsIHdUZXh0KS5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBnLmFwcGVuZCgnZycpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJysod1RleHQgLSA1KSsnLDIpLHNjYWxlKCcraGVpZ2h0KycsJytoZWlnaHQrJyknKS4KICAgICAgICAgICAgYXBwZW5kKCd0ZXh0JykuY2xhc3NlZCgndW5tYXRjaGVkLWZhY3RvcicsIHRydWUpLnRleHQoIi8iICsgc2VsZi5tb2RlbC51bm1hdGNoZWRGYWN0b3Ioc2VsZi50b2wsIDEwKSkKCiAgICAgICAgICAgIHNlbGYuZGltID0gewogICAgICAgICAgICAgICAgaGVpZ2h0IDogc2VsZi5oZWlnaHQsCiAgICAgICAgICAgICAgICB3aWR0aCA6IHdpZHRoCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuZGltCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIE1hdGNoTWFwU2xpbVZpZXc7Cn0pOwoKLyoqCiAqIFRoZSBQUSB3aWRnZXQgKFBRID0gInRvaWxldCBwYXBlciIgaW4gZnJlbmNoKSBpcyBkaXNrIHByb2plY3RlZCBkYXRhLCB3aGljaCBjYW4gYmUgcHVsbGVkIG9mIHdoZW4gbW91c2luZyBvdmVyCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvdXRpbHMvUFFWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnZDMnXSwgZnVuY3Rpb24oXywgZDMpIHsKCiAgUFFWaWV3ID0gZnVuY3Rpb24odGFyZ2V0LCBvcHRpb25zKSB7CiAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgdGhpcy5yYWRpdXMgPSBvcHRpb25zLnJhZGl1cyB8fCA1MDsKICAgIHRoaXMudGltZSA9IG9wdGlvbnMudGltZSB8fCAxMjU7CiAgICB0aGlzLnJvdGF0aW5nID0gMDsKICAgIHRoaXMub25jbGljayA9IG9wdGlvbnMub25jbGljazsKCiAgICBpZiAoIHR5cGVvZiB0YXJnZXQgPT0gJ29iamVjdCcpIHsKICAgICAgdGhpcy52aXMgPSB0YXJnZXQuYXBwZW5kKCdnJykKCiAgICB9IGVsc2UgewogICAgICB0aGlzLnZpcyA9IGQzLnNlbGVjdCh0YXJnZXQpLmFwcGVuZCgnZycpCiAgICB9CiAgfQoKICBQUVZpZXcucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24oc2VjdG9yQ2xhc3NlcywgcmVjdEJ1aWxkRnVuY3Rpb24pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHNlbGYubGVuID0gc2VjdG9yQ2xhc3Nlcy5sZW5ndGg7CiAgICBzZWxmLnNlY3RvckNsYXNzZXMgPSBzZWN0b3JDbGFzc2VzOwoKICAgIHNlbGYuc3ZnUmVjdCA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJysgc2VsZi5yYWRpdXMrJywwKScpOwogICAgc2VsZi5yZWN0ID0gc2VsZi5zdmdSZWN0LmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3JlY3QtY29udGFpbmVyJyk7CiAgICBzZWxmLmRpbVJlY3QgPSByZWN0QnVpbGRGdW5jdGlvbihzZWxmLnJlY3QpOwogICAgc2VsZi5zdmdSZWN0LmF0dHIoJ3dpZHRoJywgc2VsZi5kaW1SZWN0LndpZHRoKQoKICAgIHNlbGYucmVjdC5hdHRyKCd0cmFuc2Zvcm0nLCAnc2NhbGUoMCwxKScpOwogICAgc2VsZi5zdmdSZWN0LmF0dHIoJ3gnLCBzZWxmLnJhZGl1cyk7CiAgICBzZWxmLnZpcy5hdHRyKCdoZWlnaHQnLCAyICogc2VsZi5yYWRpdXMpLmF0dHIoJ3dpZHRoJywgc2VsZi5yYWRpdXMgKyBzZWxmLmRpbVJlY3Qud2lkdGgpOwoKICB9CgogIFBRVmlldy5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBjaXJjbGUgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyBzZWxmLnJhZGl1cyArICcsJyArIHNlbGYucmFkaXVzICsgJyknKS5hcHBlbmQoJ2cnKTsKCiAgICB2YXIgYXJjID0gZDMuc3ZnLmFyYygpLm91dGVyUmFkaXVzKHNlbGYucmFkaXVzKS5pbm5lclJhZGl1cygwKS5zdGFydEFuZ2xlKGZ1bmN0aW9uKHYsIGkpIHsKICAgICAgcmV0dXJuIDIgKiAzLjE0ICogaSAvIHNlbGYubGVuOwogICAgfSkuZW5kQW5nbGUoZnVuY3Rpb24odiwgaSkgewogICAgICByZXR1cm4gMiAqIDMuMTQgKiAoaSArIDEpIC8gc2VsZi5sZW47CiAgICB9KTsKICAgIHZhciBwY2lyYyA9IGNpcmNsZS5zZWxlY3RBbGwoJ2cuY2lyY2xlJykuZGF0YShzZWxmLnNlY3RvckNsYXNzZXMpLmVudGVyKCkuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnY2lyY2xlJyk7CiAgICBwY2lyYy5hcHBlbmQoJ3BhdGgnKS5hdHRyKCdkJywgYXJjKS5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKGQsIGkpIHsKICAgICAgcmV0dXJuIGQgKyAnIHNlY3RvciBzZWN0b3ItJyArIGkKICAgIH0pLmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiBkMy5yZ2IoMjU1IC8gMTAgKiBkLCAyNTUgLyAxMCAqIGQsIDI1NSAvIDEwICogZCkKICAgIH0pOwogICAgdmFyIG1za0NpcmNsZSA9IGNpcmNsZS5hcHBlbmQoJ2NpcmNsZScpLmF0dHIoJ3InLCBzZWxmLnJhZGl1cykuYXR0cignZmlsbC1vcGFjaXR5JywgJzAnKS5hdHRyKCdmaWxsJywgJ3llbGxvdycpLnN0eWxlKCdjdXJzb3InLCAnaGFuZCcpOwoKICAgIG1za0NpcmNsZS5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oKSB7CiAgICAgIHNlbGYucm9sbE91dChjaXJjbGUpOwogICAgfSk7CiAgICBtc2tDaXJjbGUub24oJ21vdXNlb3V0JywgZnVuY3Rpb24oKSB7CiAgICAgIHNlbGYucm9sbEJhY2soY2lyY2xlKTsKICAgIH0pOwogICAgaWYgKHNlbGYub25jbGljaykgewogICAgICBtc2tDaXJjbGUub24oJ2NsaWNrJywgc2VsZi5vbmNsaWNrKTsKICAgIH0KICB9CgogIFBRVmlldy5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHRoaXMudmlzLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArICh4IC0gc2VsZi5yYWRpdXMpICsgJywnICsgKHkgLSBzZWxmLnJhZGl1cykgKyAnKScpLnN0eWxlKCdsZWZ0JywgeCArICdweCcpLnN0eWxlKCdsZWZ0JywgeSArICdweCcpLnN0eWxlKCdwb3NpdGlvbicsICdyZWxhdGl2ZScpOwogICAgcmV0dXJuIHRoaXMKICB9CgogIFBRVmlldy5wcm90b3R5cGUucm9sbE91dCA9IGZ1bmN0aW9uKGNpcmNsZSwgb3B0aW9ucykgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKHNlbGYucm90YXRpbmcgPiAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHNlbGYucm90YXRpbmcgPSAxOwogICAgdmFyIGNwdCA9IDA7CiAgICB2YXIgZHQgPSBzZWxmLnRpbWUgLyBzZWxmLmxlbjsKICAgIHZhciB3UmVjdCA9IHNlbGYuZGltUmVjdC53aWR0aDsKICAgIGZvciAoIGkgPSAwOyBpIDwgc2VsZi5sZW47IGkrKykgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChzZWxmLnJvdGF0aW5nIDw9IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY2lyY2xlLmF0dHIoJ3RyYW5zZm9ybScsICdyb3RhdGUoJyArICgoY3B0ICsgMSkgLyBzZWxmLmxlbiAqIDM2MCkgKyAnKScpOwogICAgICAgIGNwdCsrOwogICAgICAgIHNlbGYucmVjdC5hdHRyKCd0cmFuc2Zvcm0nLCAnc2NhbGUoJyArICgoaSArIDEpIC8gc2VsZi5sZW4pICsgJywxKScpOwogICAgICAgIC8vKTsndHJhbnNsYXRlKCcgKyAoKGNwdCAtIHNlbGYubGVuKSAqIHdSZWN0IC8gc2VsZi5sZW4pICsgJywwKScpOwoKICAgICAgICBjaXJjbGUuc2VsZWN0QWxsKCcuc2VjdG9yLScgKyAoc2VsZi5sZW4gLSBjcHQpKS5hdHRyKCdkaXNwbGF5JywgJ25vbmUnKTsKICAgICAgICBpZiAoY3B0ID09IHNlbGYubGVuKSB7CiAgICAgICAgICBzZWxmLnJvdGF0aW5nID0gMDsKICAgICAgICB9CiAgICAgIH0sIGkgKiBkdCk7CiAgICB9CiAgfQogIFBRVmlldy5wcm90b3R5cGUucm9sbEJhY2sgPSBmdW5jdGlvbihjaXJjbGUsIG9wdGlvbnMpIHsKCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBpZiAoc2VsZi5yb3RhdGluZyA8IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc2VsZi5yb3RhdGluZyA9IC0xOwogICAgdmFyIGNwdCA9IHNlbGYubGVuIC0gMTsKICAgIHZhciBkdCA9IHNlbGYudGltZSAvIHNlbGYubGVuOwogICAgdmFyIHdSZWN0ID0gc2VsZi5kaW1SZWN0LndpZHRoOwogICAgZm9yICggaSA9IDA7IGkgPCBzZWxmLmxlbjsgaSsrKSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHNlbGYucm90YXRpbmcgPj0gMCkgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGNpcmNsZS5hdHRyKCd0cmFuc2Zvcm0nLCAncm90YXRlKCcgKyAoY3B0IC8gc2VsZi5sZW4gKiAzNjApICsgJyknKTsKICAgICAgICAvLyAgICAgICAgdmFyIHRyID0gJ3RyYW5zbGF0ZSgnICsgKChjcHQgLSBzZWxmLmxlbikgKiB3UmVjdCAvIHNlbGYubGVuKSArICcsMCknOwogICAgICAgIHZhciB0ciA9ICdzY2FsZSgnICsgKDEgLSBpIC8gc2VsZi5sZW4pICsgJywxKSc7CiAgICAgICAgc2VsZi5yZWN0LmF0dHIoJ3RyYW5zZm9ybScsIHRyKTsKCiAgICAgICAgdmFyIHNlbCA9ICcuc2VjdG9yLScgKyAoc2VsZi5sZW4gLSBjcHQgLSAxKTsKICAgICAgICBjaXJjbGUuc2VsZWN0QWxsKHNlbCkuYXR0cignZGlzcGxheScsIG51bGwpCiAgICAgICAgY3B0LS07CiAgICAgICAgaWYgKGNwdCA8IDApIHsKICAgICAgICAgIHNlbGYucm90YXRpbmcgPSAwOwogICAgICAgIH0KICAgICAgfSwgaSAqIGR0KTsKICAgIH0KCiAgfQoKICByZXR1cm4gUFFWaWV3Owp9KTsKCi8qCiAqIHdpdGRnZXQgdG8gZGlzcGxheSBQU00sIGJhc2VkIG9uIHRoZSBzcGVjdHJ1bSBwZXJzcGVjdGl2ZQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLFsndW5kZXJzY29yZScsICdkMycsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0NvbnRleHQnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0FyZWEnXSwgZnVuY3Rpb24gKF8sIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CgogICAgTWF0Y2hTcGVjdHJ1bVZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIE1hdGNoU3BlY3RydW1WaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucykKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgICAgICAgc2VsZi5vcHRpb25zID0gb3B0aW9uczsKCiAgICAgICAgICAgIHNlbGYudG9sID0gb3B0aW9ucy50b2wgfHwgNTAwOwoKICAgICAgICAgICAgc2VsZi5oZWlnaHRYQXhpcyA9IDIxOwogICAgICAgICAgICBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQgPSAxMDsKCiAgICAgICAgICAgIGlmIChvcHRpb25zLmZseWluZykgewogICAgICAgICAgICAgICAgc2VsZi5lbCA9IGQzLnNlbGVjdCgnYm9keScpOwogICAgICAgICAgICAgICAgc2VsZi5pc0ZseWluZyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWxmLmlzRmx5aW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZi5wX3NldHVwKCk7CgogICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLnhab29tYWJsZSkgewogICAgICAgICAgICAgICAgc2VsZi54Wm9vbWFibGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICB9LAogICAgICAgIHBfc2V0dXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAvLyB2YXIgZXZ0ID0gZDMubW91c2Uoc2VsZi5jb250YWluZXIpOwogICAgICAgICAgICBzZWxmLnZpcyA9IHNlbGYuZWwuYXBwZW5kKCdzdmcnKQogICAgICAgICAgICBzZWxmLnZpcy5hdHRyKCd3aWR0aCcsIHNlbGYud2lkdGgoKSkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQoKSkuYXR0cignY2xhc3MnLCAnZDMtd2lkZ2V0LW1hdGNoLXNwZWN0cnVtJyk7CiAgICAgICAgICAgIGlmIChzZWxmLmlzRmx5aW5nKSB7CiAgICAgICAgICAgICAgICB2YXIgeCA9IGQzLmV2ZW50LnBhZ2VYICsgMTA7CiAgICAgICAgICAgICAgICB2YXIgeSA9IGQzLmV2ZW50LnBhZ2VZIC0gc2VsZi5oZWlnaHQoKSAqIDIgLyAzOwogICAgICAgICAgICAgICAgc2VsZi52aXMuc3R5bGUoJ2xlZnQnLCB4ICsgJ3B4Jykuc3R5bGUoJ3RvcCcsIHkgKyAncHgnKTsKICAgICAgICAgICAgICAgIHNlbGYucF9mbHlpbmdfZG9udF9mbHlfYXdheSgpOwoKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBzZWxmLnZpcy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCd3aWR0aCcsICcxMDAlJykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCdmaWxsJywgJyNkZGQnKS5hdHRyKCdjbGFzcycsICdiYWNrZ3JvdW5kJyk7CgogICAgICAgICAgICBzZWxmLnBfc2V0dXBfdGl0bGUoKTsKCiAgICAgICAgICAgIGlmIChzZWxmLmlzRmx5aW5nKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1dHRvbkNvbnRhaW5lciA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2J1dHRvbi1jb250YWluZXIgcmlnaHQtYWxpZ24nKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyBzZWxmLndpZHRoKCkgKyAnLDApJykKICAgICAgICAgICAgICAgIHNlbGYucF9zZXR1cF9tZW51X2J1dHRvbnMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gYWRkIHNwZWN0cnVtCiAgICAgICAgICAgIHZhciBleHBTcCA9IHNlbGYubW9kZWwuZ2V0KCdleHBTcGVjdHJ1bScpOwogICAgICAgICAgICB2YXIgaFNwZWN0cnVtID0gc2VsZi5oZWlnaHQoKSAtIDIwIC0gc2VsZi5oZWlnaHRYQXhpczsKCiAgICAgICAgICAgIHNlbGYucF9idWlsZF9kYXRhKCk7CiAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgICAgICAgICB4RG9tYWluOiBbZXhwU3AuZ2V0KCdtb3pzJylbMF0gKiAwLjk1LCBleHBTcC5nZXQoJ21venMnKVtleHBTcC5zaXplKCkgLSAxXSAqIDEuMDVdLAogICAgICAgICAgICAgICAgeURvbWFpbjogWzAsIF8ubWF4KF8ucGx1Y2soc2VsZi5kYXRhLnBlYWtzLCAneScpKSAqIDEuMl0sCiAgICAgICAgICAgICAgICBoZWlnaHQ6IGhTcGVjdHJ1bSAtIHNlbGYucGVha3NCYXNlbGluZUhlaWdodCwKICAgICAgICAgICAgICAgIHdpZHRoOiBzZWxmLndpZHRoKCkKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIHZhciBzdmdzcCA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwyMCknKTsKICAgICAgICAgICAgc2VsZi5zdmdzcCA9IHN2Z3NwOwoKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQXJlYSA9IG5ldyBEM1NjYWxpbmdBcmVhKHsKICAgICAgICAgICAgICAgIGVsOiBzdmdzcCwKICAgICAgICAgICAgICAgIG1vZGVsOiBzZWxmLnNjYWxpbmdDb250ZXh0LAogICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbmRlcigpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaGVpZ2h0OiBoU3BlY3RydW0sCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc2VsZi5kM0hvbGRlclhBeGlzID0gc3Znc3AuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAneGF4aXMnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIGhTcGVjdHJ1bSArICcpJyk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQcmVjdXJzb3IgPSBzdmdzcC5zZWxlY3RBbGwoJ2cucHJlY3Vyc29yJykuZGF0YShzZWxmLmRhdGEucHJlY3Vyc29yKS5lbnRlcigpLmFwcGVuZCgnZycpCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQcmVjdXJzb3IuYXBwZW5kKCdwYXRoJykuYXR0cignY2xhc3MnLCAncHJlY3Vyc29yJykuYXR0cignZCcsICdNMCwtMjBMMTAsMEwtMTAsMEwwLC0yMCcpLmF0dHIoJ3gnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAueDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQZWFrcyA9IHN2Z3NwLnNlbGVjdEFsbCgnbGluZS5wZWFrJykuZGF0YShzZWxmLmRhdGEucGVha3MpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHZhciBjbGF6eiA9ICdwZWFrJzsKICAgICAgICAgICAgICAgIGlmIChway5sYWJlbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgY2xhenogKz0gJyBtYXRjaGVkIGZyYWctc2VyaWVzLScgKyBway5sYWJlbC5sYWJlbC5zZXJpZXMucmVwbGFjZSgnKysnLCAnJykKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2xhenogKz0gJyB1bm1hdGNoZWQnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY2xhenoKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQZWFrc1RydW5jYXRlZCA9IHN2Z3NwLnNlbGVjdEFsbCgnbGluZS5wZWFrLXRydW5jYXRlZCcpLmRhdGEoc2VsZi5kYXRhLnBlYWtzVHJ1bmNhdGVkKS5lbnRlcigpLmFwcGVuZCgnbGluZScpOwoKICAgICAgICAgICAgc2VsZi5wX3NldHVwX2xhYmVscygpOwoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGRpdiB3aXRoIGZseWluZyBzcGVjdHJ1bSBpcyBwb2lzdGlvbiBzb213aGVyZSAoYnkgdGhlIHZlbnRzb3VyY2UsIGZvciBleGFtcGxlKQogICAgICAgICAqIG5lcnZlcnRoZWxlc3MsIGl0IHNob3VsZCBub3QgZ28gb3V0c2lkZSB0aGUgbWFpbiB3aW5kb3cKICAgICAgICAgKi8KICAgICAgICBwX2ZseWluZ19kb250X2ZseV9hd2F5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQoc2VsZi52aXMuc3R5bGUoJ2xlZnQnKSk7CiAgICAgICAgICAgIHZhciB5ID0gcGFyc2VJbnQoc2VsZi52aXMuc3R5bGUoJ3RvcCcpKTsKICAgICAgICAgICAgdmFyIG1pbkRpc3QgPSAyMDsKCiAgICAgICAgICAgIHggPSBNYXRoLm1heCh4LCBtaW5EaXN0KTsKICAgICAgICAgICAgeCA9IE1hdGgubWluKHgsIHdpbmRvdy5pbm5lcldpZHRoIC0gc2VsZi53aWR0aCgpIC0gbWluRGlzdCk7CgogICAgICAgICAgICB5ID0gTWF0aC5tYXgoeSwgbWluRGlzdCk7CiAgICAgICAgICAgIHkgPSBNYXRoLm1pbih5LCAkKGRvY3VtZW50KS5oZWlnaHQoKSAtIHNlbGYuaGVpZ2h0KCkgLSBtaW5EaXN0KQoKICAgICAgICAgICAgc2VsZi52aXMuc3R5bGUoJ2xlZnQnLCB4KQogICAgICAgICAgICBzZWxmLnZpcy5zdHlsZSgndG9wJywgeSkKCiAgICAgICAgfSwKICAgICAgICBwX3NldHVwX2xhYmVsczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICBzZWxmLnN2Z3NwLnNlbGVjdEFsbCgnZy5sYWJlbCcpLnJlbW92ZSgpOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzID0gc2VsZi5zdmdzcC5zZWxlY3RBbGwoJ2cubGFiZWwnKS5kYXRhKHNlbGYuZGF0YS5sYWJlbHMpLmVudGVyKCkuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNQYXRoID0gc2VsZi5kM2hvbGRlckxhYmVscy5hcHBlbmQoJ3BhdGgnKQogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzVGV4dEcgPSBzZWxmLmQzaG9sZGVyTGFiZWxzLmFwcGVuZCgnZycpCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNUZXh0ID0gc2VsZi5kM2hvbGRlckxhYmVsc1RleHRHLmFwcGVuZCgndGV4dCcpCiAgICAgICAgICAgIHJldHVybiBzZWxmCiAgICAgICAgfSwKICAgICAgICBwX3NldHVwX3RpdGxlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgLy8gdGl0bGUKICAgICAgICAgICAgdmFyIGV4cFNwID0gc2VsZi5tb2RlbC5nZXQoJ2V4cFNwZWN0cnVtJykKICAgICAgICAgICAgdmFyIHRpdGxlID0gJ3NjYW46ICcgKyBleHBTcC5nZXQoJ3NjYW5OdW1iZXInKSArICcgKCcgKyAoTWF0aC5yb3VuZChleHBTcC5nZXQoJ3JldGVudGlvblRpbWUnKSkgLyA2MCkudG9GaXhlZCgxKSArICdtaW4pICcgKyBleHBTcC5nZXQoJ3ByZWNDaGFyZ2UnKSArICcrICcgKyBleHBTcC5nZXQoJ3ByZWNNb3onKS50b0ZpeGVkKDQpICsgJ0RhJzsKICAgICAgICAgICAgc2VsZi52aXMuYXBwZW5kKCd0ZXh0JykuYXR0cigneCcsIDUpLmF0dHIoJ3knLCA1KS5hdHRyKCdjbGFzcycsICd0aXRsZScpLnRleHQodGl0bGUpOwogICAgICAgICAgICBzZWxmLnZpcy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdoZWlnaHQnLCAnMjAnKS5hdHRyKCd3aWR0aCcsICcxMDAlJykuYXR0cignY2xhc3MnLCAndGl0bGUnKS50ZXh0KHRpdGxlKTsKCiAgICAgICAgfSwKICAgICAgICBwX25ld19idXR0b246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbiA9IHNlbGYuYnV0dG9uQ29udGFpbmVyLnNlbGVjdEFsbCgnZy5idXR0b24tY29udGFpbmVyJylbMF0ubGVuZ3RoCiAgICAgICAgICAgIHJldHVybiBzZWxmLmJ1dHRvbkNvbnRhaW5lci5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdidXR0b24tY29udGFpbmVyJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgtJyArIChuICsgMSkgKiA0MiArICcsMiknKTsKICAgICAgICB9LAogICAgICAgIHBfc2V0dXBfbWVudV9idXR0b25zOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciBhZGRCdXR0b24gPSBmdW5jdGlvbiAoZ2J1dCwgdGV4dCwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIGVsV3JhcHBlciA9IGdidXQuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgICAgICAvLy5hdHRyKCd0cmFuc2Zvcm0nLCAnc2NhbGUoJyArIChvcHRpb25zLnNpemUgLyA0MCkgKyAnLCcgKyAob3B0aW9ucy5zaXplIC8gNDApICsgJyknKTsKICAgICAgICAgICAgICAgIGdidXQuY2xhc3NlZCgnYnV0dG9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBlbFdyYXBwZXIuYXBwZW5kKCdyZWN0JykuYXR0cignd2lkdGgnLCA0MCkuYXR0cignaGVpZ2h0JywgMTYpLmF0dHIoJ3J4JywgNCkuYXR0cigncnknLCA0KS5jbGFzc2VkKCdidXR0b24nLCB0cnVlKTsKICAgICAgICAgICAgICAgIGdidXQuYXBwZW5kKCd0ZXh0JykuYXR0cigneCcsIDIwKS5hdHRyKCd5JywgMTEpLnRleHQodGV4dCk7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmN1cnNvcikgewogICAgICAgICAgICAgICAgICAgIGdidXQuc3R5bGUoJ2N1cnNvcicsIG9wdGlvbnMuY3Vyc29yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBnYnV0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNsb3NlCiAgICAgICAgICAgIHZhciBnYnV0ID0gc2VsZi5wX25ld19idXR0b24oKTsKICAgICAgICAgICAgYWRkQnV0dG9uKGdidXQsICdjbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuY2xvc2UoKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIHJlc2l6ZQogICAgICAgICAgICBnYnV0ID0gc2VsZi5wX25ld19idXR0b24oKTsKCiAgICAgICAgICAgIGFkZEJ1dHRvbihnYnV0LCAnbGFyZ2VyJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHNlbGYuaGVpZ2h0KCkgPCAzMDApIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlc2l6ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDAwLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5taW4oJChkb2N1bWVudCkud2lkdGgoKSAqIDAuOSwgMTAwMCkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlc2l6ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogNTAwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIGRyYWcKICAgICAgICAgICAgZ2J1dCA9IHNlbGYucF9uZXdfYnV0dG9uKCk7CiAgICAgICAgICAgIGFkZEJ1dHRvbihnYnV0LCAnbW92ZScsIHsKICAgICAgICAgICAgICAgIGN1cnNvcjogJ21vdmUnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBzZXR1cCBkcmFnZ2luCiAgICAgICAgICAgIHZhciBkcmFnQ29vcmQgPSB7CiAgICAgICAgICAgICAgICB4OiAxMDAwLAogICAgICAgICAgICAgICAgeTogMTAwMAogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgZHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKS5vbigiZHJhZ3N0YXJ0IiwgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIGRyYWdDb29yZCA9IHsKICAgICAgICAgICAgICAgICAgICBteDogZDMuZXZlbnQuc291cmNlRXZlbnQucGFnZVgsCiAgICAgICAgICAgICAgICAgICAgbXk6IGQzLmV2ZW50LnNvdXJjZUV2ZW50LnBhZ2VZLAogICAgICAgICAgICAgICAgICAgIHZ4OiBwYXJzZUludChzZWxmLnZpcy5zdHlsZSgnbGVmdCcpLnJlcGxhY2UoJ3B4JywgJycpKSwKICAgICAgICAgICAgICAgICAgICB2eTogcGFyc2VJbnQoc2VsZi52aXMuc3R5bGUoJ3RvcCcpLnJlcGxhY2UoJ3B4JywgJycpKSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pLm9uKCJkcmFnIiwgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIG14ID0gZDMuZXZlbnQuc291cmNlRXZlbnQucGFnZVg7CiAgICAgICAgICAgICAgICBteSA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50LnBhZ2VZOwoKICAgICAgICAgICAgICAgIHNlbGYudmlzLnN0eWxlKCJsZWZ0IiwgKGRyYWdDb29yZC52eCArIG14IC0gZHJhZ0Nvb3JkLm14KSArICdweCcpLnN0eWxlKCJ0b3AiLCAoZHJhZ0Nvb3JkLnZ5ICsgbXkgLSBkcmFnQ29vcmQubXkpICsgJ3B4Jyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBnYnV0LmNhbGwoZHJhZyk7CgogICAgICAgICAgICAvL2VkaXQKICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5lZGl0VXJsKSB7CiAgICAgICAgICAgICAgICBnYnV0ID0gc2VsZi5wX25ld19idXR0b24oKTsKCiAgICAgICAgICAgICAgICBhZGRCdXR0b24oZ2J1dCwgJ2VkaXQnKTsKICAgICAgICAgICAgICAgIGdidXQub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHNlbGYub3B0aW9ucy5lZGl0VXJsLCAnZXBpLXNob3dfX0lEX0lOVEVSQUNUSVZFX19YSUMnKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gLy8uYXBwZW5kKCd0ZXh0JykuYXR0cigneScsIDE0KS50ZXh0KCc/JykKICAgICAgICAgICAgICAgIC8vIHZhciBiID0gZDNHbHlwaGljb25zLmFwcGVuZChhLCAnYmlub2N1bGFycycsIHsKICAgICAgICAgICAgICAgIC8vIHNpemUgOiAyNCwKICAgICAgICAgICAgICAgIC8vIGJ1dHRvbiA6IHRydWUKICAgICAgICAgICAgICAgIC8vIH0pOwoKICAgICAgICAgICAgfQoKICAgICAgICB9LAogICAgICAgIC8qCiAgICAgICAgICogYnVpbGQgZGF0YSByZWFkeSBmb3IgcGxvdHRpbmc6IC0gcGVha3MgLSBsYWJlbCAtIHByZWN1cnNvcgogICAgICAgICAqIFRPRE86IGF0dGFjaGUgbGFiZWwgdG8gcGVhaywgZmlsdGVyIGRhdGEgb24gXy5wbHVjayhwZWFrcywgJ2xhYmVsJykuZmlsdGVyKGZ1bmN0aW9uKGwpe3JldHVybiBsIT09IHVuZGVmaW5lZH0pCiAgICAgICAgICogc28gZXZlcnl0aGluZyBpcyBhdHRhY2hlZCB0b2dldGhlciBhdCBvbmNlCiAgICAgICAgICogVE9ETyBhdHRhY2hlIHRoZSB0cnVuY2F0ZWQgaW5mbyBpbiB0aGUgc2FtZSB3YXkuCiAgICAgICAgICogVE9ETyBhdCB2aWV3IHRpbWUsIHdlIGNhbiBzdGFydCBldmVyeSB0aGluZyBvbiBhIGcgc2hpZnQgdG8gdGhlIGNvcnJlY3QgcG9zaXRpb24KICAgICAgICAgKi8KICAgICAgICBwX2J1aWxkX2RhdGE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgZXhwU3AgPSBzZWxmLm1vZGVsLmdldCgnZXhwU3BlY3RydW0nKTsKCiAgICAgICAgICAgIHZhciByZXQgPSB7fTsKICAgICAgICAgICAgdmFyIGRtYXRjaGVzID0gc2VsZi5tb2RlbC5jbG9zZXJUaGFuUFBNKHNlbGYudG9sKQoKICAgICAgICAgICAgdmFyIGxhYmVsZWRQZWFrcyA9IFtdOwogICAgICAgICAgICByZXQubGFiZWxzID0gXy5jb2xsZWN0KGRtYXRjaGVzLCBmdW5jdGlvbiAoZG0pIHsKICAgICAgICAgICAgICAgIHZhciByZXQgPSB7CiAgICAgICAgICAgICAgICAgICAgeDogZG0uZXhwLm1veiwKICAgICAgICAgICAgICAgICAgICB5OiBleHBTcC5nZXQoJ2ludGVuc2l0aWVzJylbZG0uZXhwLmluZGV4XSwKICAgICAgICAgICAgICAgICAgICBsYWJlbDogZG0udGhlbwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGxhYmVsZWRQZWFrc1tkbS5leHAuaW5kZXhdID0gcmV0OwogICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXQucGVha3MgPSBfLmNvbGxlY3QoXy56aXAoZXhwU3AuZ2V0KCdtb3pzJyksIGV4cFNwLmdldCgnaW50ZW5zaXRpZXMnKSwgZXhwU3AuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKSwgZnVuY3Rpb24gKHAsIGkpIHsKICAgICAgICAgICAgICAgIHZhciBwayA9IHsKICAgICAgICAgICAgICAgICAgICB4OiBwWzBdLAogICAgICAgICAgICAgICAgICAgIHk6IHBbMV0sCiAgICAgICAgICAgICAgICAgICAgaW50UmFuazogcFsyXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGxhYmVsZWRQZWFrc1tpXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcGsubGFiZWwgPSBsYWJlbGVkUGVha3NbaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcGs7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXQucGVha3NUcnVuY2F0ZWQgPSBbXQogICAgICAgICAgICB2YXIgc29ydGVkSW50ZW5zaXRpZXMgPSBfLmNoYWluKHJldC5wZWFrcykucGx1Y2soJ3knKS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYiAtIGEKICAgICAgICAgICAgfSkudmFsdWUoKTsKICAgICAgICAgICAgaWYgKHNvcnRlZEludGVuc2l0aWVzWzBdID4gMS41ICogc29ydGVkSW50ZW5zaXRpZXNbMV0pIHsKICAgICAgICAgICAgICAgIHZhciBtYXhJbnRlbnMgPSBzb3J0ZWRJbnRlbnNpdGllc1sxXSAqIDEuMTsKICAgICAgICAgICAgICAgIF8uY2hhaW4ocmV0LnBlYWtzKS5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcC55ID4gbWF4SW50ZW5zCiAgICAgICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICAgICAgcC55ID0gbWF4SW50ZW5zOwogICAgICAgICAgICAgICAgICAgIHJldC5wZWFrc1RydW5jYXRlZC5wdXNoKHApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldC5wcmVjdXJzb3IgPSBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgeDogZXhwU3AuZ2V0KCdwcmVjTW96JykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQoKICAgICAgICAgICAgc2VsZi5kYXRhID0gcmV0OwogICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0sCiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy52aXMucmVtb3ZlKCk7CiAgICAgICAgfSwKCiAgICAgICAgcmVzaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgaCA9IG9wdGlvbnMuaGVpZ2h0IHx8IDIwMDsKICAgICAgICAgICAgc2VsZi5oZWlnaHQoaCkud2lkdGgob3B0aW9ucy53aWR0aCB8fCA1MDApOwoKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignaGVpZ2h0JywgaCkKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpCgogICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LmhlaWdodChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRYQXhpcyAtIHNlbGYucGVha3NCYXNlbGluZUhlaWdodCAtIDIwKTsKICAgICAgICAgICAgLy8gMjAgZm9yIHRoZSBtZW51IGxpbmUsCiAgICAgICAgICAgIC8vIDEwIGZvciB3YXRlciBsaW5lIC0KICAgICAgICAgICAgLy8gdWdseSwgbmVpPwogICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LndpZHRoKHNlbGYud2lkdGgoKSkKCiAgICAgICAgICAgIHNlbGYudmlzLnNlbGVjdEFsbCgnLnJpZ2h0LWFsaWduJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgc2VsZi53aWR0aCgpICsgJywwKScpOwogICAgICAgICAgICBpZiAoc2VsZi5pc0ZseWluZykgewogICAgICAgICAgICAgICAgc2VsZi5wX2ZseWluZ19kb250X2ZseV9hd2F5KCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2VsZi5yZW5kZXIoKQogICAgICAgIH0sCiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYucF9idWlsZF9kYXRhKCk7CiAgICAgICAgICAgIHNlbGYucF9zZXR1cF9sYWJlbHMoKTsKICAgICAgICAgICAgc2VsZi5yZW5kZXIoKTsKICAgICAgICB9LAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgeCA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwogICAgICAgICAgICB2YXIgeSA9IHNlbGYuc2NhbGluZ0NvbnRleHQueSgpOwoKICAgICAgICAgICAgc2VsZi5kM2hvbGRlclByZWN1cnNvci5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSAndHJhbnNsYXRlKCcgKyB4KHAueCkgKyAnLCcgKyAoeSgwKSArIDkpICsgJyknOwogICAgICAgICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeCkudGlja3MoNykudGlja1NpemUoNSk7CiAgICAgICAgICAgIHNlbGYuZDNIb2xkZXJYQXhpcy5jYWxsKHhBeGlzKTsKCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQZWFrcy5hdHRyKCd4MScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwLngpOwogICAgICAgICAgICB9KS5hdHRyKCd4MicsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwLngpOwogICAgICAgICAgICB9KS5hdHRyKCd5MScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geSgwKSArIHNlbGYucGVha3NCYXNlbGluZUhlaWdodDsKICAgICAgICAgICAgfSkuYXR0cigneTInLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHkocC55KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBzZWxmLnZpcy5zZWxlY3RBbGwoJ3JlY3QucGVhay1iYXNlbGluZScpLnJlbW92ZSgpOwogICAgICAgICAgICBzZWxmLnZpcy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsICdwZWFrLWJhc2VsaW5lIHJlbGF0aXZlLXNpemUnKS5hdHRyKCd5Jywgc2VsZi5oZWlnaHQoKSAtIHNlbGYucGVha3NCYXNlbGluZUhlaWdodCAtIHNlbGYuaGVpZ2h0WEF4aXMpLmF0dHIoJ2hlaWdodCcsIHNlbGYucGVha3NCYXNlbGluZUhlaWdodCkuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkgLSAyKS5hdHRyKCd4JywgMSkuYXR0cigncmVsYXRpdmVXaWR0aCcsIC0yKTsKCiAgICAgICAgICAgIHNlbGYuZDNIb2xkZXJYQXhpcy5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIChzZWxmLmhlaWdodCgpIC0gMjAgLSBzZWxmLmhlaWdodFhBeGlzKSArICcpJyk7CgogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUGVha3NUcnVuY2F0ZWQuYXR0cignY2xhc3MnLCAncGVhay10cnVuY2F0ZWQnKS5hdHRyKCd4MScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwLngpOwogICAgICAgICAgICB9KS5hdHRyKCd4MicsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwLngpOwogICAgICAgICAgICB9KS5hdHRyKCd5MScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geShwLnkpOwogICAgICAgICAgICB9KS5hdHRyKCd5MicsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICAwOy8vIHJldHVybiBzZWxmLnNjYWxpbmdDb250ZXh0LnlTY2FsZSgpKHAueSktMjA7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIGxhYlkgPSBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KHkocC55KSAtIDI4LCA4KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHMuYXR0cignY2xhc3MnLCAnbGFiZWwnKS5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIHgocC54KSArICcsMCknOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVsc1BhdGguYXR0cignY2xhc3MnLCAnbGFiZWwtcG9pbnRlcicpLmF0dHIoJ2QnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgdmFyIGogPSB5KHAueSk7CiAgICAgICAgICAgICAgICByZXR1cm4gJ001LCcgKyBsYWJZKHApICsgJ2wtNSw4TDAsJyArIGo7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVsc1RleHRHLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gInRyYW5zbGF0ZSgxMCwgIiArIChsYWJZKHApIC0gMikgKyAiKSxyb3RhdGUoLTQ4KSIKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVsc1RleHQuYXR0cignY2xhc3MnLCAnbGFiZWwnKS50ZXh0KGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcC5sYWJlbC5sYWJlbDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChzZWxmLnJlbmRlckNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlckNhbGxiYWNrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBNYXRjaFNwZWN0cnVtVmlldzsKfSk7CgovKgogKiB0aGUgZGlzayB3aXRoIHVucm9sbGVkIHBlcHRpZGUgY292ZXJhZ2UgZm9yIFBTTQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJy4vTWF0Y2hNYXBTbGltVmlldycsICdmaXNodG9uZXMvdmlld3MvdXRpbHMvUFFWaWV3JywgJy4vTWF0Y2hTcGVjdHJ1bVZpZXcnXSwgZnVuY3Rpb24oXywgQmFja2JvbmUsIENvbW1vbldpZGdldFZpZXcsIE1hdGNoTWFwU2xpbVZpZXcsIFBRVmlldywgTWF0Y2hTcGVjdHJ1bVZpZXcpIHsKCiAgICBNYXRjaE1hcFBRVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIE1hdGNoTWFwUFFWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgYXJndW1lbnRzKQoKICAgICAgICAgICAgc2VsZi5yYWRpdXMgPSBvcHRpb25zLnJhZGl1c3x8IDI0OwogICAgICAgICAgICBzZWxmLnRvbCA9IG9wdGlvbnMudG9sfHwgNDk4OwoKCiAgICAgICAgICAgIHZhciBzcG1hID0gc2VsZi5tb2RlbDsKICAgICAgICAgICAgdmFyIHdpZGdldCA9IG5ldyBQUVZpZXcoc2VsZi5lbCwgewogICAgICAgICAgICAgICAgcmFkaXVzIDogc2VsZi5yYWRpdXMsCiAgICAgICAgICAgICAgICBvbmNsaWNrIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHdpZGdldFNwZWN0cnVtID0gbmV3IE1hdGNoU3BlY3RydW1WaWV3KHsKICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwgOiBzcG1hLAogICAgICAgICAgICAgICAgICAgICAgICBmbHlpbmcgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBlZGl0VXJsOicvZmlzaHRvbmVzL2lkLyNpbnRlcmFjdGl2ZS8nK3NlbGYubW9kZWwuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnaWQnKSsnLycrc2VsZi50b2wrJy8nK3NlbGYubW9kZWwuZ2V0KCdyaWNoU2VxdWVuY2UnKS50b1N0cmluZygpLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6MjAwLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDo0ODAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAvLyAvL3dpZGdldFNwZWN0cnVtLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB3aWRnZXRTcGVjdHJ1bS5yZW5kZXIoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHNlY3RvckNsYXNzZXMgPSBuZXcgQXJyYXkoc2VsZi5tb2RlbC5nZXQoJ3JpY2hTZXF1ZW5jZScpLnNpemUoKSkKICAgICAgICAgICAgZm9yICggaXNjID0gMDsgaXNjIDwgc2VjdG9yQ2xhc3Nlcy5sZW5ndGg7IGlzYysrKSB7CiAgICAgICAgICAgICAgICBzZWN0b3JDbGFzc2VzW2lzY10gPSAnc2VjdG9yLXJrLW5vbmUnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF8uY2hhaW4oc3BtYS5jbG9zZXJUaGFuUFBNKHNlbGYudG9sKSkuZmlsdGVyKGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmFicyhtLmVycm9yUFBNKSA8PSA0OTkKICAgICAgICAgICAgfSkuZ3JvdXBCeShmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbS50aGVvLnBvcwogICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uKGdwKSB7CiAgICAgICAgICAgICAgICB2YXIgcG9zID0gZ3BbMF0udGhlby5wb3MKICAgICAgICAgICAgICAgIHZhciByayA9IF8uY2hhaW4oZ3ApLm1hcChmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uZXhwLmludGVuc2l0eVJhbmsKICAgICAgICAgICAgICAgIH0pLm1pbigpLnZhbHVlKCk7CiAgICAgICAgICAgICAgICBzZWN0b3JDbGFzc2VzW3Bvc10gPSAnc2VjdG9yLXJrLScgKyAoKHJrIDwgNDApID8gTWF0aC5mbG9vcihyayAvIDEwKSA6ICd4JykKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB3aWRnZXQuYnVpbGQoc2VjdG9yQ2xhc3NlcywgZnVuY3Rpb24oY250KSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IG5ldyBNYXRjaE1hcFNsaW1WaWV3KHsKICAgICAgICAgICAgICAgICAgICBtb2RlbCA6IHNwbWEsCiAgICAgICAgICAgICAgICAgICAgZWwgOiBjbnQsCiAgICAgICAgICAgICAgICAgICAgdG9sIDogc2VsZi50b2wsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0IDogc2VsZi5yYWRpdXMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHIucmVuZGVyKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLndpZGdldFBRID0gd2lkZ2V0OwogICAgICAgIH0sCiAgICAgICAgY2xjY2MgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0NMQUtLJykKICAgICAgICB9LAoKICAgICAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLndpZGdldFBRLmRyYXcoKTsKICAgICAgICB9LAoKICAgICAgICBtb3ZlIDogZnVuY3Rpb24oaSwgaikgewogICAgICAgICAgICB0aGlzLndpZGdldFBRLm1vdmUoaSwgaik7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIE1hdGNoTWFwUFFWaWV3Owp9KTsKCgovKioKICogZGlzcGxheSBvbmUgWElDICgrIHBsdXMgbXNtcyBtYXRjaGVzIGV2ZW50dWFsbHkpCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3Mvd2V0L1hJQ1ZpZXcnLFsndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdkMycsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnZmlzaHRvbmVzL21vZGVscy9tYXRjaC9QU01BbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0NvbnRleHQnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0FyZWEnLCAnLi4vbWF0Y2gvTWF0Y2hNYXBQUVZpZXcnXSwgZnVuY3Rpb24gKF8sIEJhY2tib25lLCBkMywgR0ZZVmlld1ZpZXcsIFBTTUFsaWdubWVudCwgRDNTY2FsaW5nQ29udGV4dCwgRDNTY2FsaW5nQXJlYSwgTWF0Y2hNYXBQUVZpZXcpIHsKCiAgICBYSUNWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgWElDVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIHNlbGYucmljaFNlcXVlbmNlID0gb3B0aW9ucy5yaWNoU2VxdWVuY2U7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnNjYWxpbmdDb250ZXh0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMueERvbWFpbiA9IFswLCBfLm1heChzZWxmLm1vZGVsLmdldCgncmV0ZW50aW9uVGltZXMnKSkgKiAxLjA1XTsKICAgICAgICAgICAgICAgIG9wdGlvbnMueURvbWFpbiA9IFswLCBfLm1heChzZWxmLm1vZGVsLmdldCgnaW50ZW5zaXRpZXMnKSkgKiAxLjFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dChvcHRpb25zKTsKCiAgICAgICAgICAgIHNlbGYucF9zZXRfbXMxcG9pbnRzKCk7CiAgICAgICAgICAgIGlmIChzZWxmLnJpY2hTZXF1ZW5jZSkgewogICAgICAgICAgICAgICAgc2VsZi5wX3NldF9tc21zZGF0YSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgLy9yZXR1cm4gdGhlIGNsYXNzIC0gd2VsbCwgSSBjYW5ub3QgZmlndXJlIHdoYXQgdGhpcyBvcyBkb25lIGxpa2UgdGhhdC4uLgogICAgICAgIHBfY2xhenpDb21tb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuICdjaHJvbWF0byBtc21zLWFsaWdubWVudC1pY29uIGNoYXJnZV8nICsgdGhpcy5tb2RlbC5nZXQoJ2NoYXJnZScpICsgJyB0YXJnZXRfJyArIHRoaXMubW9kZWwuZ2V0KCd0YXJnZXQnKTsKICAgICAgICB9LAogICAgICAgIC8vcGFja2FnZSB0aGUgbXMxIGdyYXBoIHBvaW50IChhbmQgZ2V0IGR0YXQgcmVhZHkgZm9yIGRyYXdpbmcpCiAgICAgICAgcF9zZXRfbXMxcG9pbnRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNocm9tYXRvID0gc2VsZi5tb2RlbDsKICAgICAgICAgICAgY2hyb21hdG8uX2RhdGFQb2ludHMgPSBfLnppcChjaHJvbWF0by5nZXQoJ3JldGVudGlvblRpbWVzJyksIGNocm9tYXRvLmdldCgnaW50ZW5zaXRpZXMnKSkKCiAgICAgICAgICAgIC8vY29uc29sZS5sb2cobXMxcG9pbnRzKQogICAgICAgICAgICB2YXIgc2VsZWN0b3IgPSAnZy4nICsgc2VsZi5wX2NsYXp6Q29tbW9uKCkucmVwbGFjZSgvXHMrL2csICcuJyk7CiAgICAgICAgICAgIHZhciBjb250ID0gc2VsZi5lbC5zZWxlY3RBbGwoc2VsZWN0b3IpOwogICAgICAgICAgICAvLyBjb250LnJlbW92ZSgpOwogICAgICAgICAgICBjb250ID0gc2VsZi5lbC5hcHBlbmQoJ2cnKTsKICAgICAgICAgICAgY29udC5hdHRyKCdjbGFzcycsIHNlbGYucF9jbGF6ekNvbW1vbigpICsgJyBwbG90Jyk7CgogICAgICAgICAgICB2YXIgY2xhenogPSBzZWxmLnBfY2xhenpDb21tb24oKSArICcgcGxvdCc7CiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2FkZGluZyBtczFwb2ludCcsIG1zMXBvaW50cykKICAgICAgICAgICAgc2VsZi5wMSA9IGNvbnQuc2VsZWN0QWxsKCJwYXRoLiIgKyBjbGF6eikuZGF0YShbY2hyb21hdG8uX2RhdGFQb2ludHNdKS5lbnRlcigpLmluc2VydCgicGF0aCIpOwoKICAgICAgICB9LAogICAgICAgIHBfc2V0X21zbXNkYXRhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNocm9tYXRvID0gc2VsZi5tb2RlbDsKCiAgICAgICAgICAgIHNlbGYubXNtc0RhdGEgPSBbXQoKICAgICAgICAgICAgXy5lYWNoKGNocm9tYXRvLmdldCgnbXNtcycpLm1vZGVscywgZnVuY3Rpb24gKHNwLCBpKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BtYSA9IG5ldyBQU01BbGlnbm1lbnQoewogICAgICAgICAgICAgICAgICAgIHJpY2hTZXF1ZW5jZTogc2VsZi5yaWNoU2VxdWVuY2UsCiAgICAgICAgICAgICAgICAgICAgZXhwU3BlY3RydW06IHNwCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICB2YXIgd2lkZ2V0ID0gbmV3IE1hdGNoTWFwUFFWaWV3KHsKICAgICAgICAgICAgICAgICAgICBtb2RlbDogc3BtYSwKICAgICAgICAgICAgICAgICAgICBlbDogc2VsZi5lbCwKICAgICAgICAgICAgICAgICAgICByYWRpdXM6IDEyLAogICAgICAgICAgICAgICAgICAgIHRvbDogc2VsZi50b2wKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgd2lkZ2V0LndpZGdldFBRLnZpcy5hdHRyKCdjbGFzcycsIHNlbGYucF9jbGF6ekNvbW1vbigpKQoKICAgICAgICAgICAgICAgIHNlbGYubXNtc0RhdGEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0OiB3aWRnZXQsCiAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogY2hyb21hdG8uZ2V0KCdtc21zUG9pbnRlcnMnKVtpXS5yZXRlbnRpb25UaW1lLAogICAgICAgICAgICAgICAgICAgIGludGVuc2l0eTogY2hyb21hdG8uZ2V0KCdtc21zUG9pbnRlcnMnKVtpXS5pbnRlbnNpdHkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAvL2RyYXdpbmcgcHV0IHRoZW0gb24gdGhlIHNjcmVlbgogICAgICAgICAgICAvL2FjdHVhbCBkcmF3aW5nIHdpbGwgbW92ZSB0aGVtIHRvIHRoZSBjb3JyZWN0IHBvc2l0aW9uCiAgICAgICAgICAgIF8uZWFjaChzZWxmLm1zbXNEYXRhLCBmdW5jdGlvbiAobXNtcykgewogICAgICAgICAgICAgICAgbXNtcy53aWRnZXQucmVuZGVyKCkKICAgICAgICAgICAgfSk7CgogICAgICAgIH0KICAgIH0pOwoKICAgIFhJQ1ZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICB2YXIgY2hybSA9IHNlbGYubW9kZWw7CgogICAgICAgIHZhciBjbGF6eiA9IHNlbGYucF9jbGF6ekNvbW1vbigpICsgJyBtc21zLWFubm90JzsKCiAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsvL2QzLnNjYWxlLmxpbmVhcigpLmRvbWFpbihzZWxmLnNjYWxpbmdDb250ZXh0LnhTY2FsZS5kb21haW4oKSkucmFuZ2Uoc2VsZi5zY2FsaW5nQ29udGV4dC54U2NhbGUucmFuZ2UoKSkKICAgICAgICB2YXIgeSA9IHNlbGYuc2NhbGluZ0NvbnRleHQueSgpOy8vZDMuc2NhbGUubGluZWFyKCkuZG9tYWluKHNlbGYuc2NhbGluZ0NvbnRleHQueVNjYWxlLmRvbWFpbigpKS5yYW5nZShzZWxmLnNjYWxpbmdDb250ZXh0LnlTY2FsZS5yYW5nZSgpKQoKICAgICAgICB2YXIgcExpbmUgPSBkMy5zdmcubGluZSgpLngoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgcmV0dXJuIHgoZFswXSk7CiAgICAgICAgfSkueShmdW5jdGlvbiAoZCkgewogICAgICAgICAgICByZXR1cm4geShkWzFdKQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZ3AxID0gc2VsZi5wMS5hdHRyKCdjbGFzcycsIGNsYXp6KS5hdHRyKCdmaWxsJywgJ25vbmUnKTsKICAgICAgICBncDEuYXR0cigiZCIsIHBMaW5lKHNlbGYubW9kZWwuX2RhdGFQb2ludHMpKTsKICAgICAgICBfLmVhY2goc2VsZi5tc21zRGF0YSwgZnVuY3Rpb24gKG1zbXMpIHsKICAgICAgICAgICAgbXNtcy53aWRnZXQubW92ZSh4KG1zbXMucmV0ZW50aW9uVGltZSksIE1hdGgubWluKHkobXNtcy5pbnRlbnNpdHkpLCBzZWxmLnNjYWxpbmdDb250ZXh0LmhlaWdodCgpIC0gMTUpKQogICAgICAgIH0pOwogICAgICAgIC8vIHZhciBtczJwb2ludHMgPSBfLnppcChjaHJtLm1zbXMucmV0ZW50aW9uVGltZXMsIGNocm0ubXNtcy5pbnRlbnNpdGllcywgY2hybS5tc21zLnNwZWN0cmFJZHMpOwogICAgfQoKICAgIHJldHVybiBYSUNWaWV3Owp9KTsKCi8qKgogKiBtdWx0aXBsZSBYSUMgdmlld3MgaW4gb25lIGJveC4gWElDIGlzIHVuaXF1ZSBieSBpdHMgbWFzcyBmaWVsZAogKiB0aGUgc2NhbGluZyBjb250ZXh0IGlzIGVpdGhlciBwYXNzZWQgKGlmIG11bHRpcGxlIGVsZW1lbnQgYXJlIHNoYXJpbmcgdGhlIHNhbWVvbmUpIG9yIGJ1aWx0LiByYW5nZXMgd2lsbCBiZSBhZGFwdGVkIGVhY2ggdGltZSBhIFhJQyBpcyBhZGRlZAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3Mvd2V0L011bHRpWElDVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICcuL1hJQ1ZpZXcnXSwgZnVuY3Rpb24gKF8sIEJhY2tib25lLCBkMywgQ29tbW9uV2lkZ2V0VmlldywgWElDVmlldykgewoKICAgIE11bHRpWElDVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBNdWx0aVhJQ1ZpZXcuX19zdXBlcl9fLmluaXRpYWxpemUuY2FsbCh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICBzZWxmLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQob3B0aW9ucyk7CgogICAgICAgICAgICBzZWxmLnhpY1ZpZXdzID0ge307CiAgICAgICAgICAgIHNlbGYubW9kZWwuYmluZCgnYWRkJywgZnVuY3Rpb24gKHhpYykgewogICAgICAgICAgICAgICAgc2VsZi5hZGQoeGljLCBvcHRpb25zKQogICAgICAgICAgICB9KQogICAgICAgICAgICBzZWxmLmJ1aWxkKG9wdGlvbnMpOwoKICAgICAgICAgICAgc2VsZi5saXN0ZW5UbyhzZWxmLm1vZGVsLCAnYWRkJywgc2VsZi5yZW5kZXIpOwogICAgICAgICAgICBzZWxmLmxpc3RlblRvKHNlbGYubW9kZWwsICdyZXNldCcsIHNlbGYucmVuZGVyKTsKCiAgICAgICAgfSwKICAgICAgICBidWlsZDogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnlheGlzKSB7CiAgICAgICAgICAgICAgICBzZWxmLmVsWUF4aXMgPSBzZWxmLmVsLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3hpYyB5YXhpcycpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlbGYudGl0bGUgPSBvcHRpb25zLnRpdGxlOwogICAgICAgICAgICBzZWxmLmVsVGl0bGUgPSBzZWxmLmVsLmFwcGVuZCgndGV4dCcpLmF0dHIoJ3gnLCBzZWxmLnNjYWxpbmdDb250ZXh0LndpZHRoKCkgLSAyMCkuYXR0cigneScsIDMwKS5hdHRyKCdjbGFzcycsICd4aWMgdGl0bGUnKTsKICAgICAgICB9LAogICAgICAgIC8vIGV2ZW50cyA6IHsKICAgICAgICAvLyAnY2hhbmdlIG1vZGVsJyA6ICdhZGQnCiAgICAgICAgLy8gfSwKICAgICAgICBhZGQ6IGZ1bmN0aW9uICh4aWMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbSA9IHhpYy5nZXQoJ21hc3MnKTsKCiAgICAgICAgICAgIHZhciB4bWF4ID0gTWF0aC5tYXgoc2VsZi5zY2FsaW5nQ29udGV4dC54TWF4KCksIF8ubWF4KHhpYy5nZXQoJ3JldGVudGlvblRpbWVzJykpKTsKICAgICAgICAgICAgaWYgKCEob3B0aW9ucyAmJiBvcHRpb25zLm5vQXV0b1gpKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnNldFhNYXgoeG1heCwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnNldFhNYXgoeG1heCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHltYXggPSBNYXRoLm1heChzZWxmLnNjYWxpbmdDb250ZXh0LnlNYXgoKSwgXy5tYXgoeGljLmdldCgnaW50ZW5zaXRpZXMnKSkgKiAxLjEpOwogICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LnNldFlNYXgoeW1heCk7CgogICAgICAgICAgICB2YXIgeHYgPSBuZXcgWElDVmlldyh7CiAgICAgICAgICAgICAgICBlbDogc2VsZi5lbC5hcHBlbmQoJ2cnKSwKICAgICAgICAgICAgICAgIG1vZGVsOiB4aWMsCiAgICAgICAgICAgICAgICBzY2FsaW5nQ29udGV4dDogc2VsZi5zY2FsaW5nQ29udGV4dCwKICAgICAgICAgICAgICAgIHJpY2hTZXF1ZW5jZTogeGljLmdldCgncmljaFNlcXVlbmNlJyksCiAgICAgICAgICAgICAgICBub0F1dG9YOiAob3B0aW9ucyAmJiBvcHRpb25zLm5vQXV0b1gpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlbGYuY2lkLCAnWElDICcsIHhpYy5nZXQoJ2lkJyksIHhpYy5jaWQsIHh2LmNpZCkKCiAgICAgICAgICAgIHNlbGYueGljVmlld3NbbV0gPSB4djsKCiAgICAgICAgICAgIC8vc2VsZi54Wm9vbWFibGUoKTsKCiAgICAgICAgfSwKCiAgICAgICAgdXBkYXRlWUF4aXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeUF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHNlbGYuc2NhbGluZ0NvbnRleHQueSgpKS50aWNrcyg0KS50aWNrU2l6ZSg1KTsKICAgICAgICAgICAgc2VsZi5lbFlBeGlzLnNlbGVjdEFsbCgnZycpLnJlbW92ZSgpOwogICAgICAgICAgICB5QXhpcy5vcmllbnQoJ3JpZ2h0Jyk7CiAgICAgICAgICAgIHlBeGlzLnRpY2tGb3JtYXQoZDMuZm9ybWF0KCJlIikpOwogICAgICAgICAgICBzZWxmLmVsWUF4aXMuY2FsbCh5QXhpcyk7CgogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuZWxUaXRsZS50ZXh0KHNlbGYudGl0bGUpOwogICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLnlheGlzKSB7CiAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZVlBeGlzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgXy5lYWNoKF8udmFsdWVzKHNlbGYueGljVmlld3MpLCBmdW5jdGlvbiAoeHYpIHsKICAgICAgICAgICAgICAgIHh2LnJlbmRlcigpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gTXVsdGlYSUNWaWV3Owp9KTsKCi8qKgogKiBkaXNwbGF5IGEgRDNTY2FsaW5nQ29udGV4dCwgb24gdGhlIHhheGlzIHZpZXcKICoKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzWEF4aXNWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3J10sCiAgICBmdW5jdGlvbiAoXywgQmFja2JvbmUsIGQzLCBDb21tb25XaWRnZXRWaWV3KSB7CiAgICAgICAgRDNYQXhpc1ZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBYSUNWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dChvcHRpb25zKTsKICAgICAgICAgICAgICAgIHNlbGYudHJhbnNmb3JtID0gb3B0aW9ucy50cmFuc2Zvcm07CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciB4U2NhbGU7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi50cmFuc2Zvcm0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgeERvbSA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpLmRvbWFpbigpCiAgICAgICAgICAgICAgICAgICAgeFNjYWxlID0gZDMuc2NhbGUubGluZWFyKCkuZG9tYWluKFtzZWxmLnRyYW5zZm9ybSh4RG9tWzBdKSwgc2VsZi50cmFuc2Zvcm0oeERvbVsxXSldKS5yYW5nZShbMCwgc2VsZi5zY2FsaW5nQ29udGV4dC53aWR0aCgpXSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgeFNjYWxlID0gc2VsZi5zY2FsaW5nQ29udGV4dC54KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeFNjYWxlKS50aWNrcyg3KS50aWNrU3ViZGl2aWRlKDQpLnRpY2tTaXplKDYsIDUsIDApOwogICAgICAgICAgICAgICAgc2VsZi5lbC5jYWxsKHhBeGlzKTsKICAgICAgICAgICAgICAgIHZhciBlbHNUaWNrcyA9IHNlbGYuZWwuc2VsZWN0QWxsKCdnIGcgZycpWzBdCiAgICAgICAgICAgICAgICBfLmVhY2goZWxzVGlja3MsIGZ1bmN0aW9uIChlbHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gcGFyc2VGbG9hdChkMy5zZWxlY3QoZWx0KS5hdHRyKCd0cmFuc2Zvcm0nKS5yZXBsYWNlKCd0cmFuc2xhdGUoJywgJycpLnJlcGxhY2UoJywwKScsICcnKSk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KGVsdCkuc3R5bGUoJ2Rpc3BsYXknLCAocG9zIDwgMzUpID8gJ25vbmUnIDogbnVsbCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICByZXR1cm4gRDNYQXhpc1ZpZXcKICAgIH0pOwoKLyoKICogQSBjbGlwcGVkIHZlcnNpb24gb2YgYSBYSUMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L1hJQ0NsaXAnLFsnQmFja2JvbmUnLCAnQ29uZmlnJywgJy4vWElDJ10sIGZ1bmN0aW9uKEJhY2tib25lLCBjb25maWcsIFhJQykgewogICAgdmFyIFhJQ0NsaXAgPSBYSUMuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBYSUNDbGlwOwp9KTsKCi8qCiAqIGJ1aWxkcyBhbiBYSUMgQ2xpcCBvdXQgb2YgYSBYSUMgKyByZXRlbnRpb24gdGltZSByYW5nZQogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3NlcnZpY2VzL3dldC9YSUNDbGlwcGVyRmFjdG9yeScsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvWElDQ2xpcCcsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUsIGNvbmZpZywgWElDQ2xpcCwgRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbikgewogICAgdmFyIFhJQ0NsaXBwZXJGYWN0b3J5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgfTsKCiAgICAvKioKICAgICAqIGJ1aWxkIGEgWElDQ2xpcCBiYXNlZCBvbiB4aWMgd2l0aCByZXRlbnRpb25UaW1lcyBpbiB0aGUgd2luZG93CiAgICAgKiB4aWMgIGNhbiBiZSBlaXRoZXI6CiAgICAgKiAtIG9uZSBYSUMKICAgICAqIC0gb25lWElDQ29sbGVjdGlvbiAKICAgICAqIC0gQXJyYXkgb2YgWElDCiAgICAgKi8KICAgIFhJQ0NsaXBwZXJGYWN0b3J5LnByb3RvdHlwZS5jbGlwID0gZnVuY3Rpb24oeGljLCBydEluZiwgcnRTdXAsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgCiAgICAgICAgaWYoeGljIGluc3RhbmNlb2YgQmFja2JvbmUuQ29sbGVjdGlvbil7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmNsaXAoeGljLm1vZGVscywgcnRJbmYsIHJ0U3VwLCBvcHRpb25zKQogICAgICAgIH0KICAgICAgICBpZih4aWMgaW5zdGFuY2VvZiBBcnJheSl7CiAgICAgICAgICAgIHJldHVybiBfLmNvbGxlY3QoeGljLCBmdW5jdGlvbih4KXsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNsaXAoeCwgcnRJbmYsIHJ0U3VwLCBvcHRpb25zKQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBjbGlwcGVkID0geGljLmNsb25lKCk7CiAgICAgICAgdmFyIHBvaW50cyA9IF8uemlwKHhpYy5nZXQoJ3JldGVudGlvblRpbWVzJyksIHhpYy5nZXQoJ2ludGVuc2l0aWVzJykpCiAgICAgICAgcG9pbnRzID0gXy5maWx0ZXIocG9pbnRzLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgIHJldHVybiBwWzBdID49IHJ0SW5mICYmIHBbMF0gPD0gcnRTdXA7CiAgICAgICAgfSkKCiAgICAgICAgY2xpcHBlZC5zZXQoJ3JldGVudGlvblRpbWVzJywgXy5wbHVjayhwb2ludHMsIDApKQogICAgICAgIGNsaXBwZWQuc2V0KCdpbnRlbnNpdGllcycsIF8ucGx1Y2socG9pbnRzLCAxKSkKICAgICAgICBjbGlwcGVkLnNldCgncnRSYW5nZScsIHsKICAgICAgICAgICAgaW5mIDogcnRJbmYsCiAgICAgICAgICAgIHN1cCA6IHJ0U3VwCiAgICAgICAgfSkKICAgICAgICBjbGlwcGVkLnNldCgnbXNtcycsIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKGNsaXBwZWQuZ2V0KCdtc21zJykuZmlsdGVyKGZ1bmN0aW9uKG1zbXMpIHsKICAgICAgICAgICAgdmFyIHJ0ID0gbXNtcy5nZXQoJ3JldGVudGlvblRpbWUnKTsKICAgICAgICAgICAgcmV0dXJuIHJ0ID49IHJ0SW5mICYmIHJ0IDw9IHJ0U3VwCiAgICAgICAgfSkpKQoKICAgICAgICByZXR1cm4gbmV3IFhJQ0NsaXAoY2xpcHBlZC5hdHRyaWJ1dGVzKQogICAgfTsKICAgIHJldHVybiBuZXcgWElDQ2xpcHBlckZhY3RvcnkoKTsKfSk7CgovKioKICogbXVsdGlwbGUgWElDIHZpZXdzIGluIG9uZSBib3guIFhJQyBpcyB1bmlxdWUgYnkgaXRzIG1hc3MgZmllbGQKICogdGhlIHNjYWxpbmcgY29udGV4dCBpcyBlaXRoZXIgcGFzc2VkIChpZiBtdWx0aXBsZSBlbGVtZW50IGFyZSBzaGFyaW5nIHRoZSBzYW1lb25lKSBvciBidWlsdC4gcmFuZ2VzIHdpbGwgYmUgYWRhcHRlZCBlYWNoIHRpbWUgYSBYSUMgaXMgYWRkZWQKICogIGEgWElDTXVsdGlQYW5lVmlldyBpcyBhIHNldCBvZiBNdWx0aVhJQ1ZpZXcuCiAqIFdlIGNhbiBzZWUgdGhhdCBhcyBhIG11bHRsaW5lcyB3aWRnZXQsIGVhY2ggbGluZSBjb25zaXN0IG9mIGEgYSBzZXJpZXMgb2YgWElDLgogKiBzY2FsaW5nIGNvbnRleHQgaXMgY29oZXJlbnQgdGhyb3VnaG91dCB0aGUgZGlmZmVyZW50IFhJQwogKgogKiB0aGUgbW9kZWwgb2YgdGhlIHZpZXcgaWYgYSBtYXAgb2YgWElDQ29sbGVjdGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3Mvd2V0L1hJQ011bHRpUGFuZVZpZXcnLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJy4uL3V0aWxzL0QzWEF4aXNWaWV3JywKICAgICAgICAnLi9NdWx0aVhJQ1ZpZXcnLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL3dldC9YSUNDb2xsZWN0aW9uJywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy93ZXQvWElDQ2xpcHBlckZhY3RvcnknXSwKICAgIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgZDMsIENvbW1vbldpZGdldFZpZXcsIEQzWEF4aXNWaWV3LCBNdWx0aVhJQ1ZpZXcsIFhJQ0NvbGxlY3Rpb24sIHhpY0NsaXBwZXJGYWN0b3J5KSB7CgogICAgICAgIFhJQ011bHRpUGFuZVZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIC8vbWFwIG9mIE11bHRpWElDVmlldwogICAgICAgICAgICB4aWNQYW5lczoge30sCgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICoKICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgZm9yIGNvbnN0cnVjdG9yCiAgICAgICAgICAgICAqICogZ3JvdXBCeSA6IGEgZnVuY3Rpb24gdGFraW5nIGEgcHJvdmlkZWQgWElDIGFuZCBjb21wdXRpbmcgdGhlIGtleSBvbiB3aGljaCB3ZSBzaGFsbCBncm91cGUgdGhlIFhJQyBwYWVycCBwYW5lCiAgICAgICAgICAgICAqICogZ2V0R3JvdXBOYW1lIFtvcHRpb25hbF06IGhvdyB0byBuYW1lIGEgZ3JvdXAgYmFzZWQgb24gdGhlIHByb3ZpZGVkIFhJQy4gV2Ugc2hvdWxkIGFzc3VtZSB0aGF0IGFsbCB0aGUgZ3JvdXBlZEJ5IFhJQyB3aWxsIHByb3ZpZGUgdGhlIHNhbWUgbmFtZS4uLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBvcHRpb25zID0gXy5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgTXVsdGlYSUNWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucyk7CgogICAgICAgICAgICAgICAgc2VsZi5ncm91cEJ5ID0gb3B0aW9ucy5ncm91cEJ5OwogICAgICAgICAgICAgICAgc2VsZi5nZXRHcm91cE5hbWUgPSBvcHRpb25zLmdldEdyb3VwTmFtZSB8fCBzZWxmLmdyb3VwQnk7CiAgICAgICAgICAgICAgICBzZWxmLnJldGVudGlvblRpbWVTZWxlY3RDYWxsYmFjayA9IG9wdGlvbnMucmV0ZW50aW9uVGltZVNlbGVjdENhbGxiYWNrOwoKICAgICAgICAgICAgICAgIHNlbGYubGVnZW5kSXNEaXNwbGF5ZWQgPSBvcHRpb25zLmxlZ2VuZCB8fCBmYWxzZTsKICAgICAgICAgICAgICAgIHNlbGYubm9BdXRvWCA9IG9wdGlvbnMubm9BdXRvWDsKCiAgICAgICAgICAgICAgICBzZWxmLmhlaWdodFhBeGlzID0gMzA7CiAgICAgICAgICAgICAgICBzZWxmLnhpY1BhbmVzID0ge307CiAgICAgICAgICAgICAgICBzZWxmLmdyb3VwZWRNb2RlbHMgPSB7fTsKCiAgICAgICAgICAgICAgICBzZWxmLmxpc3RlblRvKHNlbGYubW9kZWwsICdhZGQnLCBzZWxmLnNldHVwKTsKICAgICAgICAgICAgICAgIHNlbGYubGlzdGVuVG8oc2VsZi5tb2RlbCwgJ3Jlc2V0Jywgc2VsZi5jbGVhcik7CgogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhzZWxmKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHBfaW5pdF9ydF9kb21haW5fc2VsZWN0b3I6IGZ1bmN0aW9uIChjYikgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgLy9zZXQgdGhlIFJUIHJhbmdlIHNlbGVjdG9yIGFuZCBwaXBlIGl0IHRvIGEgY2FsbGJhY2sKCiAgICAgICAgICAgICAgICBpZiAoY2IpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldFNoaWZ0U2VsZWN0Q2FsbGJhY2soZnVuY3Rpb24gKHJ0RG9tYWluKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBydEluZiA9IHJ0RG9tYWluWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBydFN1cCA9IHJ0RG9tYWluWzFdCgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgeGljY2xpcENvbCA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChzZWxmLm1vZGVsLm1vZGVscywgZnVuY3Rpb24gKHhpYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsaXAgPSB4aWNDbGlwcGVyRmFjdG9yeS5jbGlwKHhpYywgcnRJbmYsIHJ0U3VwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaXAudW5zZXQoJ21zbXNQb2ludGVycycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aWNjbGlwQ29sLnB1c2goY2xpcCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNiKHhpY2NsaXBDb2wsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ0RG9tYWluOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mOiBydEluZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXA6IHJ0U3VwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0UGFuZVRpdGxlOiBmdW5jdGlvbiAobmFtZSwgdGl0bGUpIHsKICAgICAgICAgICAgICAgIHRoaXMueGljUGFuZXNbbmFtZV0udGl0bGUgPSB0aXRsZQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2xlYXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgICAgICAgX3RoaXMueGljUGFuZXMgPSB7fTsKICAgICAgICAgICAgICAgIF90aGlzLmdyb3VwZWRNb2RlbHMgPSB7fTsKICAgICAgICAgICAgICAgIF90aGlzLnhpY1BhbmVzID0ge307CiAgICAgICAgICAgICAgICBfdGhpcy5wcmV2UGFuZXNHcm91cEtleXMgPSB1bmRlZmluZWQ7CgogICAgICAgICAgICAgICAgX3RoaXMuc2V0dXAoKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0dXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXR1cFBhbmVzKCk7CiAgICAgICAgICAgICAgICBfdGhpcy5kaXNwYXRjaE1vZGVscygpOwoKICAgICAgICAgICAgICAgIF90aGlzLnJlbmRlcigpCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogcGFuZXMgYXJlIGJ1aWxkIGFyZSByZW5kZXIgdGltZSwgYmFzZWQgb24gdGhlIGdyb3VwQnkgcHJvcGVydHkKICAgICAgICAgICAgICogYmVmcmUgbWVzc2luZyBldmVyeXRoaW5nIGFyb3VuZCwgd2UgY2hlY2sgaWYgbmV3IHBhbmVzIHdlcmUgYWN0dWFsbHkgYWRkZWQuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBzZXR1cFBhbmVzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5tb2RlbC5zaXplKCkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL2dldCBvbmUgWElDIHJlcHJlc2VudGF0aXZlcyBvZiBhIHBhbmVzCiAgICAgICAgICAgICAgICB2YXIgcmVwNHBhbmVzID0gXy5jaGFpbihzZWxmLm1vZGVsLm1vZGVscykuZ3JvdXBCeShzZWxmLmdyb3VwQnkpLnZhbHVlcygpLm1hcChmdW5jdGlvbiAobCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBsWzBdOwogICAgICAgICAgICAgICAgfSkuc29ydEJ5KHNlbGYuZ3JvdXBCeSkudmFsdWUoKTsKCiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgdGhlIGtleSBwZXIgZ3JvdXAsIGFuZCByZXR1cm4gaWYgbm8gY2hhbmdlLgogICAgICAgICAgICAgICAgdmFyIHBhbmVzR3JvdXBLZXlzID0gXy5tYXAocmVwNHBhbmVzLCBzZWxmLmdyb3VwQnkpOwogICAgICAgICAgICAgICAgaWYgKF8uaXNFcXVhbChwYW5lc0dyb3VwS2V5cywgc2VsZi5wcmV2UGFuZXNHcm91cEtleXMpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2VsZi5wcmV2UGFuZXNHcm91cEtleXMgPSBwYW5lc0dyb3VwS2V5czsKCiAgICAgICAgICAgICAgICAvL2V4dHJhY3QgZ3JvdXAgbmFtZXMKICAgICAgICAgICAgICAgIHNlbGYucGFuZU5hbWVzID0gcmVwNHBhbmVzLm1hcChzZWxmLmdldEdyb3VwTmFtZSk7CiAgICAgICAgICAgICAgICB2YXIgbmJQYW5lcyA9IHJlcDRwYW5lcy5sZW5ndGg7CgogICAgICAgICAgICAgICAgdmFyIGhlaWdodFBhbmUgPSBNYXRoLmZsb29yKChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRYQXhpcykgLyBuYlBhbmVzKTsKCiAgICAgICAgICAgICAgICBpZiAoc2VsZi54YXhpc1ZpZXcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0UGFuZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHZhciBneGF4aXMgPSBzZWxmLmVsLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3RpbWUtc2NhbGUgeGF4aXMnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRYQXhpcykgKyAnKScpOwogICAgICAgICAgICAgICAgICAgIGd4YXhpcy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCd3aWR0aCcsIHNlbGYuc2NhbGluZ0NvbnRleHQud2lkdGgoKSkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHRYQXhpcykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpOwogICAgICAgICAgICAgICAgICAgIHNlbGYueGF4aXNWaWV3ID0gbmV3IEQzWEF4aXNWaWV3KHsKICAgICAgICAgICAgICAgICAgICAgICAgZWw6IGd4YXhpcy5hcHBlbmQoJ2cnKSwKICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGluZ0NvbnRleHQ6IHNlbGYuc2NhbGluZ0NvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB4IC8gNjAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dXBab29tKCk7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vY3JlYXRlIHBhbmVzIGlmIHRoZXJlIGFyZSBuZWNlc3NhcnkKICAgICAgICAgICAgICAgIHJlcDRwYW5lcy5mb3JFYWNoKGZ1bmN0aW9uIChyZXBYaWMsIGkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgayA9IHNlbGYuZ3JvdXBCeShyZXBYaWMpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnhpY1BhbmVzW2tdID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IHNlbGYuZWwuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ3JvdXBlZE1vZGVsc1trXSA9IG5ldyBYSUNDb2xsZWN0aW9uKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnhpY1BhbmVzW2tdID0gbmV3IE11bHRpWElDVmlldyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDogZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxpbmdDb250ZXh0OiBzZWxmLnNjYWxpbmdDb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHNlbGYuZ3JvdXBlZE1vZGVsc1trXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlbGYuZ2V0R3JvdXBOYW1lKHJlcFhpYyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5YXhpczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vQXV0b1g6IHNlbGYubm9BdXRvWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBzZWxmLmdldEdyb3VwTmFtZShyZXBYaWMpCgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2VsZi54aWNQYW5lc1trXS5lbC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIChpICogaGVpZ2h0UGFuZSApICsgJyknKTsKICAgICAgICAgICAgICAgICAgICAvL3NlbGYueGljUGFuZXNba10uc2NhbGluZ0NvbnRleHQgPSBzZWxmLnNjYWxpbmdDb250ZXh0OwogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coaywgc2VsZi54aWNQYW5lc1trXS5zY2FsaW5nQ29udGV4dCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0LmhlaWdodChoZWlnaHRQYW5lKTsKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coc2VsZi5jaWQsICdhZGRpbmcgcGFuZScsIG5hbWUsIHNlbGYueGljUGFuZXNbbmFtZV0uY2lkKQoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldHVwWm9vbTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgc2VsZi54Wm9vbWFibGUoKQoKICAgICAgICAgICAgICAgIHNlbGYuZ2V0TWF4WUluWERvbWFpbiA9IGZ1bmN0aW9uICh4bWluLCB4bWF4KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHltYXggPSBfLmNoYWluKHNlbGYubW9kZWwubW9kZWxzKS5wbHVjaygnX2RhdGFQb2ludHMnKS5tYXAoZnVuY3Rpb24gKGRwcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5jaGFpbihkcHMpLmZpbHRlcihmdW5jdGlvbiAoZHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkcFswXSA+PSB4bWluICYmIGRwWzBdIDw9IHhtYXg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnBsdWNrKDEpLm1heCgpLnZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgfSkubWF4KCkudmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geW1heCAqIDEuMSAvLzEuMSBhc3NlcnQgZm9yIHRoZSBzY2FsaW5nWSBjb250ZXh0IG1ham9yZWQgZnJvbSB0aGUgcmVhbCBtYXgKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzZWxmLnJ0RG9tYWluU2VsZWN0b3IgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYucF9pbml0X3J0X2RvbWFpbl9zZWxlY3RvcihzZWxmLnJldGVudGlvblRpbWVTZWxlY3RDYWxsYmFjaykKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5ydERvbWFpblNlbGVjdG9yLnNjYWxpbmdDb250ZXh0ID0gc2VsZi5zY2FsaW5nQ29udGV4dDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXR1cExlZ2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgIF90aGlzLmdMZWdlbmQgPSBfdGhpcy5lbC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdjaHJvbWF0byBsZWdlbmQnKTsKICAgICAgICAgICAgICAgIF90aGlzLmdMZWdlbmQuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpLmF0dHIoJ3J4JywgNSkuYXR0cigncnknLCA1KTsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB0aGUgbW9kZWwgaXMgYSBjb2xsZWN0aW9ucywgYnV0IHRob3NlIG1vZGVscyBzaG91bGQgYmUgZGlzcGF0Y2hlZCB0b3dyYWRzIHRoZSBpbmRpdmlkdWFsICBzZWxmLmdyb3VwZWRNb2RlbHNba10KICAgICAgICAgICAgICogQW5kIHRoZSBwb2ludCBpcyBub3QgdG8gdXBkYXRlIGEgY29sbGVjdGlvbiB0aGF0IGhhcyBub3QgY2hhbmdlZC4uLi4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGRpc3BhdGNoTW9kZWxzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBfLmNoYWluKHNlbGYubW9kZWwubW9kZWxzKS5ncm91cEJ5KHNlbGYuZ3JvdXBCeSkuZWFjaChmdW5jdGlvbiAobE1vZGVscywgaykgewogICAgICAgICAgICAgICAgICAgIGxNb2RlbHMuZm9yRWFjaChmdW5jdGlvbiAoeCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdyb3VwZWRNb2RlbHNba10uYWRkKHgpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLmdyb3VwZWRNb2RlbHNba10ucmVzZXQobE1vZGVscyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGFkZCB0aGUgbGVnZW5kcyBpbnRvIHRoZSBib3gKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHJlbmRlckxlZ2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuZ0xlZ2VuZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0dXBMZWdlbmQoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgaExpbmUgPSAyMDsKICAgICAgICAgICAgICAgIHZhciB3TW96ID0gMTMwOwogICAgICAgICAgICAgICAgdmFyIHdUZXh0ID0gMjAwOwoKICAgICAgICAgICAgICAgIF90aGlzLmdMZWdlbmQuc2VsZWN0QWxsKCdnLmxlZ2VuZC1saW5lJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB2YXIgbWF4TW96ID0gXy5jaGFpbihfdGhpcy5tb2RlbC5sZWdlbmRzLmxpc3QoKSkucGx1Y2soJ21hc3NlcycpLm1hcChmdW5jdGlvbiAobCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBsLmZpbHRlcihmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgICAgICAgICAgICB9KS5sZW5ndGg7CiAgICAgICAgICAgICAgICB9KS5tYXgoKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgbWF4TW96ID0gTWF0aC5tYXgobWF4TW96LCAwKTsKCiAgICAgICAgICAgICAgICBfLmVhY2goX3RoaXMubW9kZWwubGVnZW5kcy5saXN0KCksIGZ1bmN0aW9uIChsZWcsIGlMZWcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZ0xpbmUgPSBfdGhpcy5nTGVnZW5kLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2xlZ2VuZC1saW5lJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSg1LCcgKyAoaExpbmUgKiAoaUxlZyArIDAuNSkpICsgJyknKQoKICAgICAgICAgICAgICAgICAgICB2YXIgaW1veiA9IDA7CiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKGxlZy5tYXNzZXMsIGZ1bmN0aW9uIChtb3osIHopIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtb3opIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ01veiA9IGdMaW5lLmFwcGVuZCgnZycpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIChpbW96ICogd01veikgKyAnLDApJykuYXR0cignY2xhc3MnLCAnIGxlZ2VuZC1lbmxpZ2h0ZXInKS5hdHRyKCdsZWdlbmRzdWJsaWdodGVkJywgJy5jaHJvbWF0bycpLmF0dHIoJ2xlZ2VuZGVubGlnaHRlZCcsICcuY2hyb21hdG8uY2hhcmdlXycgKyB6ICsgJy50YXJnZXRfJyArIGlMZWcpOwogICAgICAgICAgICAgICAgICAgICAgICBnTW96LmFwcGVuZCgncGF0aCcpLmF0dHIoJ2QnLCAnTTAsMEw1MCwwJykuYXR0cignY2xhc3MnLCAnY2hyb21hdG8gdGFyZ2V0XycgKyBpTGVnICsgJyBjaGFyZ2VfJyArIHopOwogICAgICAgICAgICAgICAgICAgICAgICBnTW96LmFwcGVuZCgndGV4dCcpLnRleHQoJycgKyB6ICsgJysgKCcgKyBtb3oudG9GaXhlZCg0KSArICcpJykuYXR0cigneCcsIDU1KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGltb3orKzsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBnTGluZS5hcHBlbmQoJ3RleHQnKS5hdHRyKCd4JywgbWF4TW96ICogd01veikudGV4dChsZWcubmFtZSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kLnNlbGVjdEFsbCgnZy5sZWdlbmQtZW5saWdodGVyJykub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZW5TZWwgPSAkKHRoaXMpLmF0dHIoJ2xlZ2VuZGVubGlnaHRlZCcpOwogICAgICAgICAgICAgICAgICAgIHZhciBzdWJTZWwgPSAkKHRoaXMpLmF0dHIoJ2xlZ2VuZHN1YmxpZ2h0ZWQnKTsKCiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKHN1YlNlbCkuc3R5bGUoJ3N0cm9rZS1vcGFjaXR5JywgJzE1JScpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChlblNlbCkuc3R5bGUoJ3N0cm9rZS1vcGFjaXR5JywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKHN1YlNlbCkuc3R5bGUoJ2ZpbGwtb3BhY2l0eScsICcxNSUnKTsKICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3RBbGwoZW5TZWwpLnN0eWxlKCdmaWxsLW9wYWNpdHknLCBudWxsKTsKICAgICAgICAgICAgICAgIH0pLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc3ViU2VsID0gJCh0aGlzKS5hdHRyKCdsZWdlbmRzdWJsaWdodGVkJyk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKHN1YlNlbCkuc3R5bGUoJ3N0cm9rZS1vcGFjaXR5JywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKHN1YlNlbCkuc3R5bGUoJ2ZpbGwtb3BhY2l0eScsIG51bGwpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIHcgPSBtYXhNb3ogKiB3TW96ICsgd1RleHQ7CiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIChfdGhpcy53aWR0aCgpIC0gdyAtIDIwKSArICcsJyArIDQwICsgJyknKQogICAgICAgICAgICAgICAgX3RoaXMuZ0xlZ2VuZC5zZWxlY3RBbGwoJ3JlY3QuYmFja2dyb3VuZCcpLmF0dHIoJ3dpZHRoJywgdykuYXR0cignaGVpZ2h0JywgX3RoaXMubW9kZWwubGVnZW5kcy5zaXplKCkgKiBoTGluZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi54YXhpc1ZpZXcpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnhheGlzVmlldy5yZW5kZXIoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgOwoKICAgICAgICAgICAgICAgIF8uZWFjaChfLnZhbHVlcyhzZWxmLnhpY1BhbmVzKSwgZnVuY3Rpb24gKHh2KSB7CiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnbXVsdGlwYW5lIHJlbmRlcmluZyBNVVRMVEkgWElDJywgeHYpCiAgICAgICAgICAgICAgICAgICAgeHYucmVuZGVyKCk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoc2VsZi5sZWdlbmRJc0Rpc3BsYXllZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYucmVuZGVyTGVnZW5kKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBYSUNNdWx0aVBhbmVWaWV3OwogICAgfSk7CgovKgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3Mvd2V0L1NwZWN0cnVtVmlldycsWyd1bmRlcnNjb3JlJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQXJlYSddLCBmdW5jdGlvbiAoXywgZDMsIENvbW1vbldpZGdldFZpZXcsIEQzU2NhbGluZ0NvbnRleHQsIEQzU2NhbGluZ0FyZWEpIHsKICAgIC8qCiAgICAgKiBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgMyB2YWx1ZXM6CiAgICAgKgogICAgICogMDogbW96CiAgICAgKiAxOmludGVuc2l0eQogICAgICogMjogaW50ZW5zaXR5IHJhbmtzCiAgICAgKi8KICAgIHZhciBwcm9qZWN0UGVha3MgPSBmdW5jdGlvbiAoZXhwU3ApIHsKICAgICAgICByZXR1cm4gXy5jaGFpbihleHBTcC5nZXQoJ21venMnKSkuemlwKGV4cFNwLmdldCgnaW50ZW5zaXRpZXMnKSwgZXhwU3AuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKS52YWx1ZSgpCgogICAgfQogICAgdmFyIHBlYWtSYW5rQ2xhc3MgPSBmdW5jdGlvbiAocGspIHsKICAgICAgICB2YXIgaXJrID0gcGtbMl07CiAgICAgICAgcmV0dXJuICdyay0nICsgKChpcmsgPCA0MCkgPyBNYXRoLmZsb29yKGlyayAvIDEwKSA6ICd4Jyk7CiAgICB9CiAgICB2YXIgU3BlY3RydW1WaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGRlZmF1bHRzOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgICAgICBTcGVjdHJ1bVZpZXcuX19zdXBlcl9fLmluaXRpYWxpemUuY2FsbCh0aGlzLCBvcHRpb25zKQogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuY29sb3JQZWFrcyA9IG9wdGlvbnMuY29sb3JQZWFrczsKCiAgICAgICAgICAgIHNlbGYuaFNjYWxlPTIwOwogICAgICAgICAgICBzZWxmLmJ1aWxkKCk7CiAgICAgICAgICAgIHNlbGYubW9kZWwub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuYnVpbGQoKS5yZW5kZXIoKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAoKICAgICAgICBidWlsZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5idWlsZERhdGEoKS5idWlsZENvbnRleHQoKS5idWlsZEQzKCk7CiAgICAgICAgfSwKICAgICAgICBidWlsZERhdGE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLnBlYWtzID0gcHJvamVjdFBlYWtzKHNlbGYubW9kZWwpOwoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICBidWlsZENvbnRleHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHhNYXggPSBzZWxmLm1vZGVsLmdldCgnbW96cycpW3NlbGYubW9kZWwuc2l6ZSgpIC0gMV0gKiAxLjE7CiAgICAgICAgICAgIHZhciB4TWluID0gc2VsZi5tb2RlbC5nZXQoJ21venMnKVswXSAqIDAuNTsKICAgICAgICAgICAgdmFyIHlNYXggPSBNYXRoLm1heChfLm1heChzZWxmLm1vZGVsLmdldCgnaW50ZW5zaXRpZXMnKSkpICogMS4wNTsKCiAgICAgICAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgICAgICAgICB4RG9tYWluOiBbeE1pbiwgeE1heF0sCiAgICAgICAgICAgICAgICB5RG9tYWluOiBbMCwgeU1heF0sCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNlbGYuaGVpZ2h0KCktc2VsZi5oU2NhbGUsCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRDM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi52aXMgPSBzZWxmLmVsLmFwcGVuZCgnZycpOwogICAgICAgICAgICBzZWxmLnZpcy5hdHRyKCd3aWR0aCcsIHNlbGYud2lkdGgoKSkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQoKSkuYXR0cignY2xhc3MnLCAnc3BlY3RydW0nKTsKCiAgICAgICAgICAgIHZhciB5cyA9IHNlbGYuc2NhbGluZ0NvbnRleHQueSgpOwoKICAgICAgICAgICAgc2VsZi5wZWFrc0hvbGRlciA9IHNlbGYudmlzLnNlbGVjdEFsbCgnbGluZS5wZWFrJykuZGF0YShzZWxmLnBlYWtzKS5lbnRlcigpLmFwcGVuZCgnbGluZScpLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICB2YXIgY2wgPSAncGVhayAgcGVhay14JzsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmNvbG9yUGVha3MpIHsKICAgICAgICAgICAgICAgICAgICBjbCArPSAnICcgKyBwZWFrUmFua0NsYXNzKHBrKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjbDsKICAgICAgICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB5cygwKTsKICAgICAgICAgICAgfSkuYXR0cigneTInLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB5cyhwa1sxXSk7CiAgICAgICAgICAgIH0pOwoKCiAgICAgICAgICAgIHZhciBndGl0bGVzID0gc2VsZi52aXMuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAndGl0bGVzJykKICAgICAgICAgICAgZ3RpdGxlcy5hcHBlbmQoJ3RleHQnKS50ZXh0KCcjJyArIHNlbGYubW9kZWwuZ2V0KCdzY2FuTnVtYmVyJykpLmF0dHIoJ3gnLCBzZWxmLndpZHRoKCkgLSA1KS5hdHRyKCd5JywgMzApLmF0dHIoJ2NsYXNzJywgJ3NjYW4gdG9wJykKCiAgICAgICAgICAgIHNlbGYuYXhpc0NvbnRhaW5lciA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2F4aXMnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyt5cygwKSsnKScpOwoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeCA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwoKICAgICAgICAgICAgc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsteCcpLmF0dHIoJ3gxJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwa1swXSkKICAgICAgICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB4KHBrWzBdKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS50aWNrU2l6ZSg0LCAzLCAzKS50aWNrcygzKS8vIiIudGlja0Zvcm1hdChkMy5mb3JtYXQoImQiKSk7CiAgICAgICAgICAgIHNlbGYuYXhpc0NvbnRhaW5lci5jYWxsKHhBeGlzKTsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gU3BlY3RydW1WaWV3OwoKfSkKOwovKgogKiBDbGVhdmFnZSBlbnp5bWUgdG8gY2xlYXZlIHByb3RlaW4gc2VxdWVuY2UKICogcHJvcGVydGllczoKICogLSBuYW1lCiAqIC0gcnVsZTogYSByZWd1bGFyIGV4cHJlc3Npb24gKHNpbnRyZyBvciBSZWdFeHAgb2JqZWN0KQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9DbGVhdmFnZUVuenltZScsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lKSB7CiAgICB2YXIgQ2xlYXZhZ2VFbnp5bWUgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGlkQXR0cmlidXRlIDogJ25hbWUnLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBuYW1lIDogJycsCiAgICAgICAgICAgIHJ1bGUgOiBudWxsCiAgICAgICAgfSwKICAgICAgICBzZXQgOiBmdW5jdGlvbihhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICBpZiAoXy5pc1N0cmluZyhhdHRycy5ydWxlKSkgewogICAgICAgICAgICAgICAgYXR0cnMucnVsZSA9IG5ldyBSZWdFeHAoIGF0dHJzLnJ1bGUsICdnJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIEJhY2tib25lLk1vZGVsLnByb3RvdHlwZS5zZXQuY2FsbCh0aGlzLCBhdHRycywgb3B0aW9ucyk7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfSwKCiAgICAgICAgdG9TdHJpbmcgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ25hbWUnKSArIHNlbGYuZ2V0KCdydWxlJyk7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzZXEgYW4gaW5wdXQgYW1pbm8gYWNpZCBzdHJpbmcgc2VxdWVuY2UKICAgICAgICAgKiBAcmV0dXJuIHtBcnJheX0gYSBsaXN0IG9mIHN0cmluZyBzZXF1ZW5jZXMKICAgICAgICAgKi8KICAgICAgICBjbGVhdmUgOiBmdW5jdGlvbihzZXEpIHsKICAgICAgICAgICAgdmFyIHJldCA9IFtdOwogICAgICAgICAgICB2YXIgcmVnZXhwID0gbmV3IFJlZ0V4cCh0aGlzLmdldCgncnVsZScpLnNvdXJjZSwgJ2cnKTsKICAgICAgICAgICAgd2hpbGUgKCBtID0gcmVnZXhwLmV4ZWMoc2VxKSkgewogICAgICAgICAgICAgICAgcmV0LnB1c2gobVswXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIENsZWF2YWdlRW56eW1lOwp9KTsKCi8qCiAqIGVuenltZSB3aXRoIHJlZ3VsYXIgZXhwcmVzc2lvbi4gVGhlc2VzIGFyZSBhIGJpdCB1Z2x5LCBiZWNhdXNlIEphdmFTY3JpcHQgZG9lcyBzdXBwb3J0IGxvb2sgYWhlYWQKICogVGhpcyBmaWxlIGlzIHRvIGJlIGxvYWRlZCBieSBjb2xsZWN0aW9ucy9kcnkvQ2xlYXZhZ2VFbnp5bWVEaWN0aW9uYXJ5CiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMi0xNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL2RhdGEvY2xlYXZhZ2VFbnp5bWVzJyxbXSxmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogInRyeXBzaW4iLAogICAgICAgICAgICBydWxlOiAnKD86W1JLXXwuKz8oPzpbUktdfCQpKSg/PVteUF18JCknCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICJhcmctYyIsCiAgICAgICAgICAgIHJ1bGU6ICcoPzpSfC4rPyg/OlJ8JCkpKD89W15QXXwkKScKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbmFtZTogImNoeW1vdHJ5cHNpbiIsCiAgICAgICAgICAgIHJ1bGU6ICcoPzpbRkxXWV18Lis/KD86W0ZMV1ldfCQpKSg/PVteUF18JCknCiAgICAgICAgfQogICAgXQp9KTsKCgovKgogKiBBIHNpbmdsZXRvbiBjbGVhdmFnZSBlbnp5bWUgY29sbGVjdGlvbiwgbG9hZGVkIGZyb20gZGF0YS9jbGVhdmFnZUVuenltZXMuanMKICogCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0NsZWF2YWdlRW56eW1lRGljdGlvbmFyeScsWydmaXNodG9uZXMvbW9kZWxzL2RyeS9DbGVhdmFnZUVuenltZScsICdmaXNodG9uZXMvZGF0YS9jbGVhdmFnZUVuenltZXMnXSwgZnVuY3Rpb24oQ2xlYXZhZ2VFbnp5bWUsIGJzX2VuenltZXMpIHsKICAgIHZhciBDbGVhdmFnZUVuenltZURpY3Rpb25hcnkgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICAgICAgbW9kZWwgOiBDbGVhdmFnZUVuenltZSwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmFkZChic19lbnp5bWVzKTsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBuZXcgQ2xlYXZhZ2VFbnp5bWVEaWN0aW9uYXJ5KCk7Cn0pOwoKLyoKICogQW4gYW1pbm8gYWNpZCBzZXF1ZW5jZSwgd2l0aAogKiAtIGFjY2Vzc2lvbmNvZGUKICogLSBuYW1lCiAqIC0gc2VxdWVuY2UKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvQUFTZXF1ZW5jZScsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZSddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSkgewogICAgdmFyIEFBU2VxdWVuY2UgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGlkQXR0cmlidXRlIDogJ25hbWUnLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBuYW1lIDogbnVsbCwKICAgICAgICAgICAgYWNjZXNzaW9uQ29kZSA6IG51bGwsCiAgICAgICAgICAgIHNlcXVlbmNlIDogbnVsbAogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCiAgICAgICAgdG9TdHJpbmcgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ2FjY2Vzc2lvbmNvZGUnKSArICd8JyArIHNlbGYuZ2V0KCduYW1lJykgKyAnICgnICsgc2VsZi5nZXQoJ3NlcXVlbmNlJykubGVuZ2ggKyAnKSc7CiAgICAgICAgfSwKICAgICAgICBzaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzID0gdGhpcy5nZXQoJ3NlcXVlbmNlJykKICAgICAgICAgICAgaWYgKHMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcy5sZW5ndGgKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBBQVNlcXVlbmNlOwp9KTsgCgovKgogKiBhIGZldyBkZWZhdWx0IHNlcXVlbmNlcywgYnV0IGFueSBvdGhlciBjYW4gYmUgYWRkZWQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL2RhdGEvYWFTZXF1ZW5jZXMnLFtdLGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIFt7CiAgICAgICAgbmFtZSA6ICJIMy4xIiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlA2ODQzMSIsCiAgICAgICAgc2VxdWVuY2UgOiAiTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTU0FWTUFMUUVBQ0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQSIKICAgIH0sIHsKICAgICAgICBuYW1lIDogIkgzLjFUIiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlExNjY5NSIsCiAgICAgICAgc2VxdWVuY2UgOiAiTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLVkFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxNUkVJQVFERktURExSRlFTU0FWTUFMUUVBQ0VTWUxWR0xGRURUTkxDVklIQUtSVlRJTVBLRElRTEFSUklSR0VSQSIKICAgIH0sIHsKICAgICAgICBuYW1lIDogIkgzLjIiLAogICAgICAgIGFjY2Vzc2lvbkNvZGUgOiAiUTcxREkzIiwKICAgICAgICBzZXF1ZW5jZSA6ICJNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQQVRHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNTQVZNQUxRRUFTRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBIgogICAgfSwgewogICAgICAgIG5hbWUgOiAiSDMuMyIsCiAgICAgICAgYWNjZXNzaW9uQ29kZSA6ICJQODQyNDMiLAogICAgICAgIHNlcXVlbmNlIDogIk1BUlRLUVRBUktTVEdHS0FQUktRTEFUS0FBUktTQVBTVEdHVktLUEhSWVJQR1RWQUxSRUlSUllRS1NURUxMSVJLTFBGUVJMVlJFSUFRREZLVERMUkZRU0FBSUdBTFFFQVNFQVlMVkdMRkVEVE5MQ0FJSEFLUlZUSU1QS0RJUUxBUlJJUkdFUkEiCiAgICB9LCB7CiAgICAgICAgbmFtZSA6ICJIMy5DIiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlE2TlhUMiIsCiAgICAgICAgc2VxdWVuY2UgOiAiTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NUUFNUQ0dWS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGTlRETFJGUVNBQVZHQUxRRUFTRUFZTFZHTExFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBIgogICAgfSwgewogICAgICAgIG5hbWUgOiAiSDQiLAogICAgICAgIGFjY2Vzc2lvbkNvZGUgOiAiUDYyODA1IiwKICAgICAgICBzZXF1ZW5jZSA6ICJNU0dSR0tHR0tHTEdLR0dBS1JIUktWTFJETklRR0lUS1BBSVJSTEFSUkdHVktSSVNHTElZRUVUUkdWTEtWRkxFTlZJUkRBVlRZVEVIQUtSS1RWVEFNRFZWWUFMS1JRR1JUTFlHRkdHIgogICAgfV0KfSk7CgovLyA+c3B8UDY4NDMxfEgzMV9IVU1BTiBIaXN0b25lIEgzLjEgT1M9SG9tbyBzYXBpZW5zIEdOPUhJU1QxSDNBIFBFPTEgU1Y9MgovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQQVRHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNTQVZNQUxRRUFDRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCi8vID5zcHxRMTY2OTV8SDMxVF9IVU1BTiBIaXN0b25lIEgzLjF0IE9TPUhvbW8gc2FwaWVucyBHTj1ISVNUM0gzIFBFPTEgU1Y9MwovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtWQVJLU0FQQVRHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTE1SRUlBUURGS1RETFJGUVNTQVZNQUxRRUFDRVNZTFZHTEZFRFROTENWSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCgovLyA+c3B8UTcxREkzfEgzMl9IVU1BTiBIaXN0b25lIEgzLjIgT1M9SG9tbyBzYXBpZW5zIEdOPUhJU1QySDNBIFBFPTEgU1Y9MwovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQQVRHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNTQVZNQUxRRUFTRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCgovLyA+c3B8UDg0MjQzfEgzM19IVU1BTiBIaXN0b25lIEgzLjMgT1M9SG9tbyBzYXBpZW5zIEdOPUgzRjNBIFBFPTEgU1Y9MgovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQU1RHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNBQUlHQUxRRUFTRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCi8vID5zcHxRNk5YVDJ8SDNDX0hVTUFOIEhpc3RvbmUgSDMuM0MgT1M9SG9tbyBzYXBpZW5zIEdOPUgzRjNDIFBFPTEgU1Y9MwovLyBNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU1RQU1RDR1ZLUEhSWVJQR1RWQUxSRUlSUllRS1NURUxMSVJLTFBGUVJMVlJFSUFRREZOVERMUkZRU0FBVkdBTFFFQVNFQVlMVkdMTEVEVE5MQ0FJSEFLUlZUSU1QS0RJUUxBUlJJUkdFUkEKLy8KLy8gPnNwfFA2MjgwNXxINF9IVU1BTiBIaXN0b25lIEg0IE9TPUhvbW8gc2FwaWVucyBHTj1ISVNUMUg0QSBQRT0xIFNWPTIKLy8gTVNHUkdLR0dLR0xHS0dHQUtSSFJLVkxSRE5JUUdJVEtQQUlSUkxBUlJHR1ZLUklTR0xJWUVFVFJHVkxLVkZMRU5WSVJEQVZUWVRFSEFLUktUVlRBTURWVllBTEtSUUdSVExZR0ZHRwo7Ci8qCiAqIEEgc2luZ2xldG9uIGRpY3Rpb25hcnkgZm9yIGEgZmV3IHByb3RlaW4gc2VxdWVuY2VzIChtYWlubHkgaGlzdG9uZSB0YWlscywgYnV0IGFkZCB5b3VyIG93bi4uLikKICogaXQgYWxsb3cgdG8gZ2V0IGEgbmFtZSB0byBhIHNlcXVlbmNlLCBidXQgYWxzbywgaWYgYSB0cnlwdGljIHBlcHRpZGUgc2VxdWVuY2UgaXMgdW5pcXVlIGFjcm9zcyB0aGUgZGlmZmVyZW50IEFBU2VxdWVuY2UsCiAqIHdlIGNhbiByZWZlciB0byBpdCBsaWtlIEgzLjNLMjcKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQUFTZXF1ZW5jZURpY3Rpb25hcnknLFsnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvQUFTZXF1ZW5jZScsICdmaXNodG9uZXMvZGF0YS9hYVNlcXVlbmNlcyddLCBmdW5jdGlvbihCYWNrYm9uZSwgQUFTZXF1ZW5jZSwgYnNfc2VxdWVuY2VzKSB7CiAgICB2YXIgQUFTZXF1ZW5jZURpY3Rpb25hcnkgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICAgICAgbW9kZWwgOiBBQVNlcXVlbmNlLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmFkZChic19zZXF1ZW5jZXMpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG5ldyBBQVNlcXVlbmNlRGljdGlvbmFyeSgpOwp9KTsKCi8qCiAqIGEgQUFTZXF1ZW5jZVBlcHRpZGVQdHIgb2JqZWN0IHRyYW5zZm9ybXMgcGVwdGlkZSBzZXF1ZW5jZSBpbnRvIGEgc2hvcnRlciBwb2ludGVyIHRvIHRoZSBwcm90ZWlucy4KICogVGhpcyBhbGlhcyBzaG91bGQgYmUgdW5lcXVpdm9jYWwgcmVnYXJkaW5nIHRvIHRoZSBsaXN0IG9mIGtub3duIHByb3RlaW5zIChBQVNlcXVlbmNlRGljdGlvbmFyeSkKICoKICogVGhpcyBjbGFzcyBpcyB1c2VkIGFzIGEgdXRpbGl0eSBieSBSdWljaFNlcXVlbmNlU2hvcnRjdXRlcgogKgogKiBXZSB3YW50IHRvIGdpdmUgSDNLNCBhbmQgdGhpcyBraW5kIG9mIHNob3J0Y3V0LCBnaXZlbiBhbiBlbnp5bWUsIGFuZCBpdCByZXR1cm5zIGEgdW5hbWJpZ3VvdXMgcGVwdGlkZQogKiBBbmQgdmljZSB2ZXJzYSwgZ2l2ZW4gYSBwZXB0aWRlLCBpdCBnaXZlcyBiYWNrIHRoZSBzaG9ydGVzdCBwb3NzaWJsZSBwb2ludGVyCiAqCiAqIEZvciBleGFtcGxlLCBTZWUgQUFTZXF1ZW5jZVBlcHRpZGVQdHItdGVzdC5qcyBmb3IgZXhhbXBsZXMKICoKICogUHJvcGVydGllczoKICogLSBjbGVhdmFnZUVuenltZTogZWl0aGVyIGEgbmFtZSByZWZlcmluZyB0byB0aGUgZGljdGlvbmFyeSBvciBhbiBvYmplY3QKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL2RyeS9BQVNlcXVlbmNlUGVwdGlkZVB0cicsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQ2xlYXZhZ2VFbnp5bWVEaWN0aW9uYXJ5JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQUFTZXF1ZW5jZURpY3Rpb25hcnknXSwgZnVuY3Rpb24gKF8sIEJhY2tib25lLCBkaWNvQ0UsIGRpY29TZXEpIHsKICAgIHZhciBBQVNlcXVlbmNlUGVwdGlkZVB0ciA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICAgICAgY2xlYXZhZ2VFbnp5bWU6IG51bGwsCiAgICAgICAgICAgIHBlcHRpZGVJbmRleDoge30KICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNlID0gbnVsbDsKICAgICAgICAgICAgaWYgKGF0dHJzID09ICdjbGVhdmFnZUVuenltZScpIHsKICAgICAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKG9wdGlvbnMpKSB7CiAgICAgICAgICAgICAgICAgICAgY2UgPSBvcHRpb25zID0gZGljb0NFLmdldChvcHRpb25zKQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zIGluc3RhbmNlb2YgQ2xlYXZhZ2VFbnp5bWUpIHsKICAgICAgICAgICAgICAgICAgICBjZSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhhdHRycy5jbGVhdmFnZUVuenltZSkpIHsKICAgICAgICAgICAgICAgIGNlID0gYXR0cnMuY2xlYXZhZ2VFbnp5bWUgPSBkaWNvQ0UuZ2V0KGF0dHJzLmNsZWF2YWdlRW56eW1lKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhdHRycy5jbGVhdmFnZUVuenltZSkgewogICAgICAgICAgICAgICAgY2UgPSBhdHRycy5jbGVhdmFnZUVuenltZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2UgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VsZi5wX3JlYnVpbGRQZXB0aWRlSW5kZXgoY2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5wcm90b3R5cGUuc2V0LmNhbGwoc2VsZiwgYXR0cnMsIG9wdGlvbnMpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIHJlYnVpbGQgdGhlIGluZGV4IHBlcHRpZGUgLT4gc2VxdWVuY2UgKyBwb3NpdGlvbnMKICAgICAgICAgKiBAcGFyYW0ge0NsZWF2YWdlRW56eW1lfSBvcHRpb25hbCBwYXJhbXMgKGRlZmF1bHQgaXMgdGhlIGNsZWF2YWdlRW56eW1lIHByb3BlcnR5KS4gV2UgY2FuIHBhc3MgaXQgaW4gY2FzZSB0aGUgZW56eW1lIHBybyBoYXMgbm90IGJlZSBzZXQgeWV0IChzZXR0ZXIgb3ZlcmlkaW5nKQogICAgICAgICAqLwogICAgICAgIHBfcmVidWlsZFBlcHRpZGVJbmRleDogZnVuY3Rpb24gKGNlKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHBpbmRleCA9IHt9OwoKICAgICAgICAgICAgY2UgPSBjZSB8fCBzZWxmLmdldCgnY2xlYXZhZ2VFbnp5bWUnKTsKICAgICAgICAgICAgaWYgKGNlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbiA9IDA7CiAgICAgICAgICAgIF8uZWFjaChkaWNvU2VxLm1vZGVscywgZnVuY3Rpb24gKGFhU2VxKSB7CiAgICAgICAgICAgICAgICB2YXIgcG9zID0gMDsKICAgICAgICAgICAgICAgIF8uZWFjaChjZS5jbGVhdmUoYWFTZXEuZ2V0KCdzZXF1ZW5jZScpKSwgZnVuY3Rpb24gKHBlcHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGxpc3QgPSBwaW5kZXhbcGVwdF07CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwbGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBwaW5kZXhbcGVwdF0gPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgcGxpc3QgPSBwaW5kZXhbcGVwdF0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGxpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGFhU2VxOiBhYVNlcSwKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBwb3MKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIHBvcyArPSBwZXB0Lmxlbmd0aDsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBuKysKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGYuc2V0KCdwZXB0aWRlSW5kZXgnLCBwaW5kZXgpOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiB0YW5zZm9ybQogICAgICAgICAqIEgzLlsxLDFULDJdIC0+IEgzLjEKICAgICAgICAgKiBIMy4xIC0+IEgzLjEKICAgICAgICAgKi8KICAgICAgICBwdHJUcmltOiBmdW5jdGlvbiAocHRyKSB7CgogICAgICAgICAgICBpZiAobSA9IC8oLispXFsoLis/KSwuKj9dKC4qKS8uZXhlYyhwdHIpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbVsxXSArIG1bMl0gKyBtWzNdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gdGhlIHNlcXVlbmNlIHBvaW50ZXIsIGV4dHJhY3QgdGhlIGxpc3Qgb2YgcHJvdGVpbnMgbWF0Y2hpbmcKICAgICAgICAgKiBIM0s0ID0+IGFsbCB0aGUgcHJvdCBzdGF0aW5nIHdpdGggYSBuYW1lIEgzCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHB0cgogICAgICAgICAqLwogICAgICAgIHB0cjJBQVNlcXVlbmNlczogZnVuY3Rpb24gKHB0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBzZXFQdHIgPSBzZWxmLnBfcHRyMnNlcUFuZFBlcHRBbmNob3Ioc2VsZi5wdHJUcmltKHB0cikpLnNlcVB0cjsKCiAgICAgICAgICAgIGlmIChkaWNvU2VxLmdldChzZXFQdHIpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBbZGljb1NlcS5nZXQoc2VxUHRyKV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsID0gXy5maWx0ZXIoZGljb1NlcS5tb2RlbHMsIGZ1bmN0aW9uIChhYXNlcSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFhc2VxLmdldCgnbmFtZScpLmluZGV4T2Yoc2VxUHRyKSA9PSAwCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGwubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnSWxsZWdhbHNlcXVlbmNlUHRyRXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnY2Fubm90IGZpbmQgbWF0Y2hpbmcgQUFTZXF1ZW5jZSBbJyArIHB0ciArICddL1snICsgc2VxUHRyICsgJ10nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbDsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gdGhlIHNlcXVlbmNlIHBvaW50ZXIsIHJldHVybiBvbmUgbWFwIGZvciB0aGUgcGVwdGlkZToge3NlcXVlbmNlOiAuLi4gLCBvZmZzZXQ6Li4ufQogICAgICAgICAqIEl0IHdpbGwgdGhlIGJlIHBhc3NlZCB0byBSaWNoU2VxdWVuY2VTaG9ydGN1dGVyIGZvciB0aGUgYWN0dWFsUmljaFNlcXVlbmNlIGNyZWF0aW9uCiAgICAgICAgICoKICAgICAgICAgKiBJZiB0aGUgYW5zd2VyIGlzIGFtYmlndW91cywgYW4gZXhjcGV0aW9uSGFuZGxlci5yYWlzZShleGNwZXRpb24pIGlzIHJhaXNlZAogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHB0cgogICAgICAgICAqLwogICAgICAgIHB0cjJwZXB0aWRlOiBmdW5jdGlvbiAocHRyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGxTZXF1ZW5jZXMgPSBzZWxmLnB0cjJBQVNlcXVlbmNlcyhwdHIpOwoKICAgICAgICAgICAgdmFyIGFhcHRyID0gc2VsZi5wX3B0cjJzZXFBbmRQZXB0QW5jaG9yKHB0cikuYWFQdHI7CiAgICAgICAgICAgIHZhciBtID0gYWFwdHIubWF0Y2goLyhbQS1aXSkoXGQrKS8pCiAgICAgICAgICAgIHZhciBhbmNob3JBQSA9IG1bMV07CiAgICAgICAgICAgIHZhciBhbmNob3JQb3MgPSBwYXJzZUludChtWzJdKTsKCiAgICAgICAgICAgIHZhciBscGVwdCA9IF8uY2hhaW4obFNlcXVlbmNlcykuY29sbGVjdChmdW5jdGlvbiAoYWFTZXEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnBfY2xlYXZlZFBlcHRpZGVBdChhYVNlcSwgYW5jaG9yUG9zKTsKICAgICAgICAgICAgfSkudW5pcSgpLmdyb3VwQnkoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLnNlcXVlbmNlICsgJ3wnICsgcC5vZmZzZXQKICAgICAgICAgICAgfSkudmFsdWVzKCkuY29sbGVjdChmdW5jdGlvbiAobCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxbMF0KICAgICAgICAgICAgfSkudmFsdWUoKTsKCiAgICAgICAgICAgIGlmIChscGVwdC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0FtYmlndW91c1B0ckV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3BvaW50ZXIgJyArIHB0ciArICcgcG9pbnRzIHRvIG11bHRpcGxlIHBlcHRpZGVzOiAnICsgXy5jb2xsZWN0KGxwZXB0LCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcC5zZXF1ZW5jZSArICdAJyArIHAub2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgfSkuam9pbignLCAnKSArICIuXG5DaG9vc2UgYSBsZXNzIGFtYmlndW91cyBwcm90ZWluIG5hbWUgYW1vbmc6ICIgKyBfLmNvbGxlY3QobFNlcXVlbmNlcywgZnVuY3Rpb24gKGFhU2VxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhYVNlcS5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCcsICcpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXQgPSBscGVwdFswXTsKCiAgICAgICAgICAgIGlmIChyZXQuc2VxdWVuY2UuY2hhckF0KGFuY2hvclBvcyAtIHJldC5vZmZzZXQpICE9IGFuY2hvckFBKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0ludmFsaWRQdHJFeGNlcHRpb24nLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdwb2ludGVyICcgKyBwdHIgKyAnIGRvZXMgbm90IHBvaW50IHRvIGFtaW5vYWNpZDogJyArIGFuY2hvckFBICsgJyBhdCBwb3NpdGlvbiAnICsgYW5jaG9yUG9zICsgJyAoaW4gZmFjdDonICsgcmV0LnNlcXVlbmNlLmNoYXJBdChhbmNob3JQb3MgLSByZXQub2Zmc2V0KSArICcpJwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJldAoKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIGEgbGlzdCBvZiBBQVNlcXVlbmNlIG9yIG5hbWVzLCBidWlsZCBhIHNob3J0IGNvbmNhdGVuYXRpb24gb24gdGhlbQogICAgICAgICAqLwogICAgICAgIGNvbmNhdGVuYXRlTmFtZXM6IGZ1bmN0aW9uIChsc2VxKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGxOYW1lcyA9IF8uY29sbGVjdChsc2VxLCBmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgaWYgKF8uaXNTdHJpbmcobikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG4uZ2V0KCduYW1lJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsTmFtZXMgPSBsTmFtZXMuc29ydCgpOwoKICAgICAgICAgICAgaWYgKGxOYW1lcy5sZW5ndGggPD0gMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxOYW1lc1swXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGlDb21tb24gPSAxOwogICAgICAgICAgICB3aGlsZSAoaUNvbW1vbiA8PSBsTmFtZXNbMF0ubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJlZiA9IGxOYW1lc1swXS5zdWJzdHIoMCwgaUNvbW1vbik7CgogICAgICAgICAgICAgICAgaWYgKF8uYW55KGxOYW1lcywgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5zdWJzdHIoMCwgaUNvbW1vbikgIT0gcHJlZjsKICAgICAgICAgICAgICAgIH0pKSB7CgogICAgICAgICAgICAgICAgICAgIGlDb21tb24tLTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlDb21tb24rKwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjb21tb24gPSBsTmFtZXNbMF0uc3Vic3RyKDAsIGlDb21tb24pOwoKICAgICAgICAgICAgdmFyIGFsbE5hbWVzNGNvbW1vbiA9IF8uY2hhaW4oZGljb1NlcS5tb2RlbHMpLmNvbGxlY3QoZnVuY3Rpb24gKGFhc2VxKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWFzZXEuZ2V0KCduYW1lJykKICAgICAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbi5pbmRleE9mKGNvbW1vbikgPT0gMAogICAgICAgICAgICB9KS52YWx1ZSgpLnNvcnQoKQogICAgICAgICAgICBpZiAoYWxsTmFtZXM0Y29tbW9uLmxlbmd0aCA9PSBsTmFtZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5wX3Nob3J0ZW5OYW1lKGNvbW1vbikKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY29tbW9uICsgbE5hbWVzWzBdLnN1YnN0cihpQ29tbW9uKTsKCiAgICAgICAgICAgIC8vIHJldHVybiBjb21tb24gKyAnWycgKyBfLmNvbGxlY3QobE5hbWVzLCBmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIC8vIHJldHVybiBuLnN1YnN0cihpQ29tbW9uKTsKICAgICAgICAgICAgLy8gfSkuam9pbignLCcpICsgJ10nCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogZnJvbSBhIHNlcXVlbmNlLCByZXR1cm4gdGhlIGNsZWF2ZWQgcGVwdGlkZSBjb250YWluZWluZyBwb3NpdGlvbiBwb3MKICAgICAgICAgKiBAcGFyYW0ge0FBU2VxdWVuY2V9IGFhU2VxCiAgICAgICAgICogQHBhcmFtIHtpbnR9IHBvcwogICAgICAgICAqLwogICAgICAgIHBfY2xlYXZlZFBlcHRpZGVBdDogZnVuY3Rpb24gKGFhU2VxLCBwb3MpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAocG9zID49IGFhU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdJbGxlZ2FsUG9zaXRpb25PblNlcXVlbmNlJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAncG9zaXRpb24gJyArIHBvcyArICcgZXhjZWVkIHNpemUgJyArIGFhU2VxLnNpemUoKSArICcgZm9yIHNlcSAnICsgZ2V0LmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHAgPSAwOwoKICAgICAgICAgICAgdmFyIHJlZ2V4cCA9IHNlbGYuZ2V0KCdjbGVhdmFnZUVuenltZScpLmdldCgncnVsZScpOwogICAgICAgICAgICByZWdleHAubGFzdEluZGV4ID0gMDsKICAgICAgICAgICAgd2hpbGUgKG0gPSByZWdleHAuZXhlYyhhYVNlcS5nZXQoJ3NlcXVlbmNlJykpKSB7CiAgICAgICAgICAgICAgICB2YXIgcGVwdCA9IG1bMF0KICAgICAgICAgICAgICAgIHAgKz0gcGVwdC5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAocCA+IHBvcykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlOiBwZXB0LAogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IHAgLSBwZXB0Lmxlbmd0aAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogZnJvbSBIMkFLMjdBY0szNk1lIC0+IHtzZXFQdHI6J0gyQScsIGFhUHRyOidLMjcnfQogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwdHIKICAgICAgICAgKi8KICAgICAgICBwX3B0cjJzZXFBbmRQZXB0QW5jaG9yOiBmdW5jdGlvbiAocHRyKSB7CiAgICAgICAgICAgIHZhciByZSA9IC9eXHMqKFtBLVpdKy4qPykoW0EtWl1cZCspLzsKICAgICAgICAgICAgdmFyIG0gPSBwdHIubWF0Y2gocmUpOwogICAgICAgICAgICBpZiAoIW0pIHsKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnSWxsZWdhbHNlcXVlbmNlUHRyRXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnIGNhbm5vdCBleHRyYWN0IHNlcXVlbmNlIG5hbWUgaGVhZCAgLyBBQSBwb3MgZnJvbSBbJyArIHB0ciArICddIHdpdGggJyArIHJlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHNlcVB0cjogbVsxXSwKICAgICAgICAgICAgICAgIGFhUHRyOiBtWzJdCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICAvLyBjaGVjayBpZiBoYXZlIHRoZW0gYWxsIHN0YXRpbmcgd2l0aCBjb21tb24gKGluIHRoaXMgY2FzZSwgd2UgY2FuIHJldHVybiBvbmx5IHRoZSBjb21tb24gcGFydCkKICAgICAgICBwX3Nob3J0ZW5OYW1lOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICB2YXIgYWxsTmFtZXMgPSBfLmNvbGxlY3QoZGljb1NlcS5tb2RlbHMsIGZ1bmN0aW9uIChhYXNlcSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFhc2VxLmdldCgnbmFtZScpOwogICAgICAgICAgICB9KQogICAgICAgICAgICB2YXIgY3VyTmFtZSA9IG5hbWU7CiAgICAgICAgICAgIHZhciBpID0gbmFtZS5sZW5ndGggLSAxOwogICAgICAgICAgICB3aGlsZSAoaSA+IDApIHsKICAgICAgICAgICAgICAgIHZhciB0cnVuY2F0ZWQgPSBuYW1lLnN1YnN0cigwLCBpKTsKICAgICAgICAgICAgICAgIGlmIChfLmFueShhbGxOYW1lcywgZnVuY3Rpb24gKG4pIHsKCiAgICAgICAgICAgICAgICAgICAgdmFyIG9rRnVsbCA9IG4uc3Vic3RyKDAsIG5hbWUubGVuZ3RoKSA9PSBuYW1lOwogICAgICAgICAgICAgICAgICAgIHZhciBva1RydW5jID0gbi5zdWJzdHIoMCwgdHJ1bmNhdGVkLmxlbmd0aCkgPT0gdHJ1bmNhdGVkOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoIW9rRnVsbCAmJiBva1RydW5jKSB8fCAob2tGdWxsICYmICFva1RydW5jKTsKICAgICAgICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpLS07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5hbWUuc3Vic3RyKDAsIGkgKyAxKQogICAgICAgIH0sCgogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdjbGVhdmFnZUVuenltZScpICsgJyAjIHBlcHRpZGVzOiAnICsgXy5zaXplKHNlbGYuZ2V0KCdwZXB0aWRlSW5kZXgnKSk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gQUFTZXF1ZW5jZVBlcHRpZGVQdHI7Cn0pOwoKLyoKICogQnVpbGRzIGFuZCB1bmJ1aWxkcyBwZXB0aWRlIHNlcXVlbmNlIGF0bGFzIGNvbXBvc2luZwogKiBJbXBsaWNpdE1vZGlmaWVyIGZvciBsYWJlbHMKICogQUFTZXF1ZW5jZVBlcHRpZGVQdHIgdG8gcG9pbnQgYSB0cnlwdGljIHBlcHRpZGUgdG8gYW4gdW5hbWJpZ3VvdXMgcHJvdGVpbiBzZXF1ZW5jZSBhbiBwb3NpdGlvbgogKiB0cmFuc2Zvcm0gY29tbW9uIG1vZGlkaWZpY2F0aW9ucyBpbnRvIGEgc2hvcnRjdXQgQUNEe1Bob3NwaG99RUZ7RGltZXRoeWx9RyAtPiBBQ0RQb0VGTWUyRwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L0FBU2VxdWVuY2VQZXB0aWRlUHRyJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5JywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvSW1wbGljaXRNb2RpZmllciddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgUmljaFNlcXVlbmNlLCBBQVNlcXVlbmNlUGVwdGlkZVB0ciwgZGljb0FBLCBkaWNvUmVzTW9kLCBpbXBsaWNpdE1vZGlmaWVyKSB7CgogICAgdmFyIFJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBtb2RpZjJzaG9ydCA6IHsKICAgICAgICAgICAgICAgIC8vICdMYWJlbDoxM0MoNikxNU4oMiknOidTaWxhY2snLAogICAgICAgICAgICAgICAgLy8gJ0xhYmVsOjEzQyg2KTE1Tig0KSc6J1NpbGFjcicsCiAgICAgICAgICAgICAgICBQcm9waW9ueWwgOiAiUHJvcCIsCiAgICAgICAgICAgICAgICAnUHJvcGlvbnlsOjJIKDUpJyA6ICdQcm9wZDUnLAogICAgICAgICAgICAgICAgTWV0aHlsIDogWydNZScsICdNZTEnXSwKICAgICAgICAgICAgICAgIERpbWV0aHlsIDogJ01lMicsCiAgICAgICAgICAgICAgICBUcmltZXRoeWwgOiAnTWUzJywKICAgICAgICAgICAgICAgIEFjZXR5bCA6ICdBYycsCiAgICAgICAgICAgICAgICBQaG9zcGhvIDogJ1BvJywKICAgICAgICAgICAgICAgIEdseUdseSA6ICdVYicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVSZXZlcnNlIDogLyhbQS1aXSkoKD86W0EtWl1bYS16MC05XSspKikvZywKICAgICAgICAgICAgcmVSZXZTcGxpdE1vZGlmIDogLyg/OltBLVpdW2EtejAtOV0rKS9nCgogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7Y2xlYXZhZ2VFbnp5bWU6ICdhcmctYyd9OwogICAgICAgICAgICBzZWxmLnNldCgnYWFTZXF1ZW5jZVBlcHRpZGVQdHInLCBuZXcgQUFTZXF1ZW5jZVBlcHRpZGVQdHIoKSk7CiAgICAgICAgICAgIHNlbGYuZ2V0KCdhYVNlcXVlbmNlUGVwdGlkZVB0cicpLnNldCgnY2xlYXZhZ2VFbnp5bWUnLCBvcHRpb25zLmNsZWF2YWdlRW56eW1lKTsKICAgICAgICB9LAogICAgICAgIHNldCA6IGZ1bmN0aW9uKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKGF0dHJzLm1vZGlmMnNob3J0KSB7CiAgICAgICAgICAgICAgICBzZWxmLnBfaW5pdF9zaG9ydDJtb2RpZihhdHRycy5tb2RpZjJzaG9ydCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIEJhY2tib25lLk1vZGVsLnByb3RvdHlwZS5zZXQuY2FsbCh0aGlzLCBhdHRycywgb3B0aW9ucyk7CiAgICAgICAgfSwKCiAgICAgICAgLy8gdGhpcy5zaG9ydDJtb2RpZiA9IG51bGw7CiAgICAgICAgLy8gdGhpcy5wX2luaXRfc2hvcnQybW9kaWYgPSBwX2luaXRfc2hvcnQybW9kaWY7CiAgICAgICAgc2hvcnQybW9kaWYgOiBmdW5jdGlvbihtb2RpZlNob3JjdHV0KSB7CiAgICAgICAgICAgIHZhciBybSA9IHRoaXMuZ2V0KCdzaG9ydDJtb2RpZicpW21vZGlmU2hvcmN0dXRdOwogICAgICAgICAgICBpZiAoIXJtKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmtub3duU2hvcnRNb2RpZk5hbWUnLCBtb2RpZlNob3JjdHV0LCB0aGlzLmdldCgnc2hvcnQybW9kaWYnKSkKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lIDogJ1Vua25vd25TaG9ydE1vZGlmTmFtZScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA6IG1vZGlmU2hvcmN0dXQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcm07CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIG9uZSBvZGlmLCByZXR1cm4gdGhlIHNob3J0IGZvcm0gb2YgaXQuCiAgICAgICAgICogVGhlIG9ubHkgdHJpY2sgaXMgdGhhdCBvbmUgbW9kaWYgY2FuIGhhdmUgc2V2ZXJhbCBzaG9ydCBmb3JtcyAoTWV0aHlsIC0+IE1lIGFuZCBNZTEpCiAgICAgICAgICogYW5kIHdlIHBpY2sgdGhlIGZpcnN0IGluIHRoZSBsaXN0CiAgICAgICAgICovCiAgICAgICAgbW9kaWYyc2hvcnQgOiBmdW5jdGlvbihyZXNtb2QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgc2hvcnQgPSBzZWxmLmdldCgnbW9kaWYyc2hvcnQnKVtyZXNtb2QuZ2V0KCduYW1lJyldOwogICAgICAgICAgICBpZiAoIXNob3J0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzbW9kLmdldCgnbmFtZScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoIHNob3J0IGluc3RhbmNlb2YgQXJyYXkpID8gc2hvcnRbMF0gOiBzaG9ydDsKICAgICAgICB9LAoKICAgICAgICAvKgogICAgICAgICAqIGNvbnN0cnVjdCBhIG1hcCBmcm9tIHNob3J0IG5hbWUgdG8gbW9kaWYgb2JqZWN0LiBJbiBjYXNlIDIgc2hvcnRjdXQgcG9pbnQKICAgICAgICAgKiB0byB0aGUgc2FtZSBtb2RpZiwgd2UgdGFrZSB0aGUgb25lIHdpdGggdGhlIHNob3J0ZXN0IG5hbWUKICAgICAgICAgKi8KICAgICAgICBwX2luaXRfc2hvcnQybW9kaWYgOiBmdW5jdGlvbihuZXdWYWwpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgdG1wX3Nob3J0Mm1vZGlmID0ge307CiAgICAgICAgICAgIHZhciB0bXBfbW9kaWYyc2hvcnQgPSBuZXdWYWwgfHwgc2VsZi5nZXQoJ21vZGlmMnNob3J0Jyk7CiAgICAgICAgICAgIGZvciAobW9kIGluIHRtcF9tb2RpZjJzaG9ydCkgewogICAgICAgICAgICAgICAgdmFyIHZhbHMgPSB0bXBfbW9kaWYyc2hvcnRbbW9kXQogICAgICAgICAgICAgICAgdmFyIGxzaG9ydHMgPSAoIHZhbHMgaW5zdGFuY2VvZiBBcnJheSkgPyB2YWxzIDogW3ZhbHNdOwogICAgICAgICAgICAgICAgXy5lYWNoKGxzaG9ydHMsIGZ1bmN0aW9uKHNob3J0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRtcF9zaG9ydDJtb2RpZltzaG9ydF0gJiYgdG1wX3Nob3J0Mm1vZGlmW3Nob3J0XS5nZXQoJ25hbWUnKS5sZW5ndGggPCBtb2QubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdG1wX3Nob3J0Mm1vZGlmW3Nob3J0XSA9IGRpY29SZXNNb2QuZ2V0KG1vZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYuc2V0KCdzaG9ydDJtb2RpZicsIHRtcF9zaG9ydDJtb2RpZik7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGV4dHJhY3QgbGFiZWwgYXQgdGhlIGVuZCBiZXRld3dlbiBjdXJseSBicmFja2V0IGlmIGFueQogICAgICAgICAqIHJldHVybiBhbiBhcnJheSB3aXRoIHR3byBlbGVtZW50CiAgICAgICAgICogWzBdOiBwZXB0aWRlIHN0cmluZyB3aXRob3V0IGFueSB0cmVhdG1lbnQKICAgICAgICAgKiBbMV06IGFuIGFycmF5LCBtYXliZSBlbXB0eSB3aXRoIHRoZSBsYWJlbHMgaW4gYW4gYWxwaGFudW1lcmljYWwgb3JkZXIKICAgICAgICAgKi8KICAgICAgICBzdHJpbmcycGVwdGlkZUFuZExhYmVscyA6IGZ1bmN0aW9uKHN0cikgewogICAgICAgICAgICB2YXIgcmUgPSAvKC4rKVxbKC4qKVxdXHMqJC87CiAgICAgICAgICAgIHZhciBtID0gcmUuZXhlYyhzdHIpOwogICAgICAgICAgICBpZiAoIW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBbc3RyLnRyaW0oKSwgW11dCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFttWzFdLnRyaW0oKSwgbVsyXS50cmltKCkuc3BsaXQoJywnKS5zb3J0KCldCgogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gYSBtaW5pZmllZCBzdHJpbmcsIGJ1aWxkIGEgZnVsbCBSaWNoU2VxdWVuY2UgcGJqZWN0CiAgICAgICAgICovCiAgICAgICAgcmljaFNlcUZyb21TdHJpbmcgOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHQgPSBzZWxmLnN0cmluZzJwZXB0aWRlQW5kTGFiZWxzKHN0cikKICAgICAgICAgICAgc3RyID0gdFswXQogICAgICAgICAgICB2YXIgbW9kaWZMYWJlbHMgPSB0WzFdOwoKICAgICAgICAgICAgdmFyIHJzOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcnMgPSBuZXcgUmljaFNlcXVlbmNlKCkuZnJvbVN0cmluZyhzdHIpCiAgICAgICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICAgICAgdmFyIHRtcF9zZXEgPSBbXQogICAgICAgICAgICAgICAgdmFyIHRtcF9yZVJldlNwbGl0TW9kaWYgPSBzZWxmLmdldCgncmVSZXZTcGxpdE1vZGlmJyk7CiAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IG5ldyBSZWdFeHBGdWxsU3BsaXRlcigpLnNwbGl0KHNlbGYuZ2V0KCdyZVJldmVyc2UnKSwgc3RyLnRyaW0oKSkKCiAgICAgICAgICAgICAgICBfLmVhY2gobWF0Y2hlcywgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgICAgIHZhciByYWEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFhIDogZGljb0FBLmdldChtWzFdKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGlmU3RyID0gbVsyXTsKICAgICAgICAgICAgICAgICAgICBpZiAobW9kaWZTdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmFhLm1vZGlmaWNhdGlvbnMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKG1vZGlmU3RyLm1hdGNoKHRtcF9yZVJldlNwbGl0TW9kaWYpLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWEubW9kaWZpY2F0aW9ucy5wdXNoKHNlbGYuc2hvcnQybW9kaWYobSkgfHwgZGljb1Jlc01vZC5nZXQobSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0bXBfc2VxLnB1c2gocmFhKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHJzID0gbmV3IFJpY2hTZXF1ZW5jZSh7CiAgICAgICAgICAgICAgICAgICAgc2VxdWVuY2UgOiB0bXBfc2VxCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbXBsaWNpdE1vZGlmaWVyLmxhYmVsKG1vZGlmTGFiZWxzLCBycykKICAgICAgICAgICAgcmV0dXJuIHJzOwoKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgaW52ZXJzZSBvZiByaWNoU2VxRnJvbVN0cmluZwogICAgICAgICAqLwogICAgICAgIHJpY2hTZXFUb1N0cmluZyA6IGZ1bmN0aW9uKHJpY2hTZXEpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcyA9ICcnOwoKICAgICAgICAgICAgcmljaFNlcSA9IHJpY2hTZXEuY2xvbmUoKQogICAgICAgICAgICB2YXIgbGFiZWxzID0gaW1wbGljaXRNb2RpZmllci5nZXRMYWJlbHNBbmRDbGVhbihyaWNoU2VxKQoKICAgICAgICAgICAgdmFyIHRtcF9zZXEgPSByaWNoU2VxLmdldCgnc2VxdWVuY2UnKTsKICAgICAgICAgICAgdmFyIHRtcF9tb2RpZjJzaG9ydCA9IHNlbGYuZ2V0KCdtb2RpZjJzaG9ydCcpOwoKICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCB0bXBfc2VxLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzICs9IHRtcF9zZXFbaV0uYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICAgICAgaWYgKHRtcF9zZXFbaV0ubW9kaWZpY2F0aW9ucykgewoKICAgICAgICAgICAgICAgICAgICBzICs9IF8uY29sbGVjdCh0bXBfc2VxW2ldLm1vZGlmaWNhdGlvbnMsIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1uYW1lID0gc2VsZi5tb2RpZjJzaG9ydChtKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1uYW1lID09IG0uZ2V0KCduYW1lJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoJ3snICsgbW5hbWUgKyAnfScpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybiAodG1wX21vZGlmMnNob3J0W20uZ2V0KCduYW1lJyldICE9IHVuZGVmaW5lZCkgPyB0bXBfbW9kaWYyc2hvcnRbbS5nZXQoJ25hbWUnKV0gOiAoJ3snICsgbS5uYW1lICsgJ30nKQogICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsYWJlbHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcyArPSAnIFsnICsgbGFiZWxzLmpvaW4oJywnKSArICddJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gczsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqICdIMy4xSzlNZScsICdIM0s0JywgJ0gzLkNLOU1lQWMnLCAnSDNLOU1lSzE0QUMnLCAgJ0gzLkNLOU1lQWMgW3Byb3BfZDEwXScsIHJldHVybiB0aGUgbW9kaWZpZWQgZnVsbCBSaWNoU2VxCiAgICAgICAgICoKICAgICAgICAgKi8KICAgICAgICByaWNoU2VxRnJvbVNlcXVlbmNlUHRyIDogZnVuY3Rpb24ocHRyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciB0ID0gc2VsZi5zdHJpbmcycGVwdGlkZUFuZExhYmVscyhwdHIpCiAgICAgICAgICAgIHB0ciA9IHRbMF0KICAgICAgICAgICAgdmFyIG1vZGlmTGFiZWxzID0gdFsxXTsKCiAgICAgICAgICAgIHZhciBwZXB0ID0gc2VsZi5nZXQoJ2FhU2VxdWVuY2VQZXB0aWRlUHRyJykucHRyMnBlcHRpZGUocHRyKTsKCiAgICAgICAgICAgIGlmIChwZXB0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBhYSA9IHBlcHQuc2VxdWVuY2Uuc3BsaXQoJycpOwogICAgICAgICAgICB2YXIgcmUgPSAvKFtBLVpdKShcZCspKCg/OltBLVpdW2Etel1bYS16MC05XSopKikvZzsKCiAgICAgICAgICAgIHdoaWxlICggbSA9IHJlLmV4ZWMocHRyKSkgewogICAgICAgICAgICAgICAgdmFyIGkgPSBwYXJzZUludChtWzJdKSAtIHBlcHQub2Zmc2V0CiAgICAgICAgICAgICAgICBhYVtpXSArPSBtWzNdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHNlcXBwID0gYWEuam9pbignJykKCiAgICAgICAgICAgIHZhciByaWNoU2VxID0gc2VsZi5yaWNoU2VxRnJvbVN0cmluZyhzZXFwcCkKICAgICAgICAgICAgaW1wbGljaXRNb2RpZmllci5sYWJlbChtb2RpZkxhYmVscywgcmljaFNlcSkKICAgICAgICAgICAgcmV0dXJuIHJpY2hTZXE7CgogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFdlbGwsIHRoYXQncyB0aGUgcmV2ZXJzZSBvZiByaWNoU2VxRnJvbVNlcXVlbmNlUHRyLgogICAgICAgICAqIGZyb20gYSByaWNoIHNlcXVlbmNlLCB3ZSB0cnkgdG8gZmluZCB0aGUgc2hvcnRlc3QgcG9zc2libGUgcHRyCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcmljaFNlcQogICAgICAgICAqLwogICAgICAgIHJpY2hTZXFUb1NlcXVlbmNlUHRyIDogZnVuY3Rpb24ocmljaFNlcU9yaWcpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHJpY2hTZXEgPSByaWNoU2VxT3JpZy5jbG9uZSgpCiAgICAgICAgICAgIHZhciBsYWJlbHMgPSBpbXBsaWNpdE1vZGlmaWVyLmdldExhYmVsc0FuZENsZWFuKHJpY2hTZXEpCiAgICAgICAgICAgIGlmIChsYWJlbHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgbGFiZWxzID0gJyBbJyArIGxhYmVscy5qb2luKCcsJykgKyAnXSc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsYWJlbHMgPSAnJwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYWFzZXEgPSBfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJhYS5hYS5nZXQoJ2NvZGUxJyk7CiAgICAgICAgICAgIH0pLmpvaW4oJycpOwoKICAgICAgICAgICAgdmFyIHJlZ1NlcUxpc3QgPSBzZWxmLmdldCgnYWFTZXF1ZW5jZVBlcHRpZGVQdHInKS5nZXQoJ3BlcHRpZGVJbmRleCcpW2Fhc2VxXTsKCiAgICAgICAgICAgIGlmICghcmVnU2VxTGlzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcVRvU3RyaW5nKHJpY2hTZXEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc2VxUHRyID0gc2VsZi5nZXQoJ2FhU2VxdWVuY2VQZXB0aWRlUHRyJykuY29uY2F0ZW5hdGVOYW1lcyhfLmNvbGxlY3QocmVnU2VxTGlzdCwgZnVuY3Rpb24ocHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwcC5hYVNlcS5nZXQoJ25hbWUnKQogICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAvL2NhcHV0cmUgdGhlIHN0YXJ0aW5nIHBvc2l0aW9uLiBtdXN0IHRoZSBzYW1lIGZvciBhbGwgcGVwdGlkZXMKICAgICAgICAgICAgdmFyIG9mZnNldCA9IF8uY2hhaW4ocmVnU2VxTGlzdCkuY29sbGVjdChmdW5jdGlvbihwcCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBwLm9mZnNldAogICAgICAgICAgICB9KS51bmlxKCkudmFsdWUoKTsKICAgICAgICAgICAgaWYgKG9mZnNldC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAvL3dlIGhhdmUgZGlmZmVyZW50IHNpemVzCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5yaWNoU2VxVG9TdHJpbmcocmljaFNlcSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0WzBdCgogICAgICAgICAgICB2YXIgbWluaVN0ciA9ICcnOwogICAgICAgICAgICBfLmVhY2gocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSwgaSkgewogICAgICAgICAgICAgICAgdmFyIG1vZHMgPSBfLmNoYWluKHJhYS5tb2RpZmljYXRpb25zKS5jb2xsZWN0KGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5tb2RpZjJzaG9ydChtKTsKICAgICAgICAgICAgICAgIH0pLnZhbHVlKCkuam9pbignJyk7CiAgICAgICAgICAgICAgICBpZiAobW9kcyAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICBtaW5pU3RyICs9IHJhYS5hYS5nZXQoJ2NvZGUxJykgKyAoaSArIG9mZnNldCkgKyBtb2RzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAobWluaVN0ciA9PT0gJycpIHsKICAgICAgICAgICAgICAgIC8vZmluZCBhdCBsZWFzdCBvbmUgbHlzaW5lCiAgICAgICAgICAgICAgICB2YXIgaWsgPSBfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpCiAgICAgICAgICAgICAgICB9KS5qb2luKCcnKS5pbmRleE9mKCdLJyk7CiAgICAgICAgICAgICAgICBpZiAoaWsgPj0gMCkgewogICAgICAgICAgICAgICAgICAgIG1pbmlTdHIgPSAnSycgKyAoaWsgKyBvZmZzZXQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1pbmlTdHIgPT09ICcnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5yaWNoU2VxVG9TdHJpbmcocmljaFNlcSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vYmFjayBjaGVjayB0aGF0IHRoZSByZXZlcnNlIGlzIGdpdmUgdGhlIHNhbWUKICAgICAgICAgICAgbWluaVN0ciA9IHNlcVB0ciArIG1pbmlTdHIgKyBsYWJlbHM7CiAgICAgICAgICAgIHZhciBiYWNrUGVwdCA9IHNlbGYucmljaFNlcUZyb21TZXF1ZW5jZVB0cihtaW5pU3RyLCB0cnVlKTsKCiAgICAgICAgICAgIGlmICghYmFja1BlcHQuZXF1YWxzVG8ocmljaFNlcU9yaWcpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5yaWNoU2VxVG9TdHJpbmcocmljaFNlcU9yaWcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtaW5pU3RyCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBXaWxsIHRyeSB0byBidWlsZCB0aGUgc2VxdWVuY2UgZnJvbSBhIHNlcXVlbmNlUHRyIG9yIGEgY2xhc3NpYyBzZXF1ZW5jZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdHIKICAgICAgICAgKiBAcGFyYW0ge1JpY2hTZXF1ZW5jZX0gaXBSaWNoU2VxLCBmb3IgaW5wbGFjZSByZXBsYWNlbWVudCBpbnN0ZWFkIG9mIGNyZWF0aW5nIGEgbmV3IG9uZS4uLgogICAgICAgICAqLwogICAgICAgIHJpY2hTZXFGcm9tIDogZnVuY3Rpb24oc3RyLCBpcFJpY2hTZXEpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAzKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCczIHBhcmFtZXRlcnMsIG5vIGdvb2QhIScpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL15cd1wuLywgJycpOwogICAgICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvXC5cdyQvLCAnJyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJpY2hTZXF1ZW5jZSgpLmZyb21TdHJpbmcoc3RyKTsKICAgICAgICAgICAgfSBjYXRjaChleGMpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcUZyb21TZXF1ZW5jZVB0cihzdHIpCiAgICAgICAgICAgICAgICB9IGNhdGNoKGV4YykgewogICAgICAgICAgICAgICAgICAgIHZhciBycyA9IHNlbGYucmljaFNlcUZyb21TdHJpbmcoc3RyKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBycwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogV2lsbCB0cnkgdG8gYnVpbGQgdGhlIHNlcXVlbmNlIGZyb20gYSBzZXF1ZW5jZVB0ciBvciBhIGNsYXNzaWMgc2VxdWVuY2UKICAgICAgICAgKiBjb21wYXJlZCB0byByaWNoU2VxRnJvbSwgaW5wbGFjZSByZXBsYWNlbWVudCBvZiBpcFJpY2hTZXEsIGluc3RlYWQgb2YgcmVhdGluZyBhIG5ldyBvbmUuLi4KICAgICAgICAgKiBAcGFyYW0ge1JpY2hTZXF1ZW5jZX0gaXBSaWNoU2VxLAogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdHIKICAgICAgICAgKi8KICAgICAgICByaWNoU2VxUmVhZEZyb20gOiBmdW5jdGlvbihpcFJpY2hTZXEsIHN0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBycyA9IHNlbGYucmljaFNlcUZyb20oc3RyKTsKCiAgICAgICAgICAgIC8vb2ssIHdlIGNhbiBkbyBiZXR0ZXIsIGJ1IHRoYXQgd2lsbCBmbHkgZm9yIHRoZSBtb21lbnQKICAgICAgICAgICAgaXBSaWNoU2VxLmZyb21TdHJpbmcocnMudG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXI7Cn0pOwoKLyohCiAqIEJvb3RzdHJhcCB2My4xLjEgKGh0dHA6Ly9nZXRib290c3RyYXAuY29tKQogKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICovCmlmKCJ1bmRlZmluZWQiPT10eXBlb2YgalF1ZXJ5KXRocm93IG5ldyBFcnJvcigiQm9vdHN0cmFwJ3MgSmF2YVNjcmlwdCByZXF1aXJlcyBqUXVlcnkiKTsrZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYigpe3ZhciBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJvb3RzdHJhcCIpLGI9e1dlYmtpdFRyYW5zaXRpb246IndlYmtpdFRyYW5zaXRpb25FbmQiLE1velRyYW5zaXRpb246InRyYW5zaXRpb25lbmQiLE9UcmFuc2l0aW9uOiJvVHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCIsdHJhbnNpdGlvbjoidHJhbnNpdGlvbmVuZCJ9O2Zvcih2YXIgYyBpbiBiKWlmKHZvaWQgMCE9PWEuc3R5bGVbY10pcmV0dXJue2VuZDpiW2NdfTtyZXR1cm4hMX1hLmZuLmVtdWxhdGVUcmFuc2l0aW9uRW5kPWZ1bmN0aW9uKGIpe3ZhciBjPSExLGQ9dGhpczthKHRoaXMpLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZnVuY3Rpb24oKXtjPSEwfSk7dmFyIGU9ZnVuY3Rpb24oKXtjfHxhKGQpLnRyaWdnZXIoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kKX07cmV0dXJuIHNldFRpbWVvdXQoZSxiKSx0aGlzfSxhKGZ1bmN0aW9uKCl7YS5zdXBwb3J0LnRyYW5zaXRpb249YigpfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPSdbZGF0YS1kaXNtaXNzPSJhbGVydCJdJyxjPWZ1bmN0aW9uKGMpe2EoYykub24oImNsaWNrIixiLHRoaXMuY2xvc2UpfTtjLnByb3RvdHlwZS5jbG9zZT1mdW5jdGlvbihiKXtmdW5jdGlvbiBjKCl7Zi50cmlnZ2VyKCJjbG9zZWQuYnMuYWxlcnQiKS5yZW1vdmUoKX12YXIgZD1hKHRoaXMpLGU9ZC5hdHRyKCJkYXRhLXRhcmdldCIpO2V8fChlPWQuYXR0cigiaHJlZiIpLGU9ZSYmZS5yZXBsYWNlKC8uKig/PSNbXlxzXSokKS8sIiIpKTt2YXIgZj1hKGUpO2ImJmIucHJldmVudERlZmF1bHQoKSxmLmxlbmd0aHx8KGY9ZC5oYXNDbGFzcygiYWxlcnQiKT9kOmQucGFyZW50KCkpLGYudHJpZ2dlcihiPWEuRXZlbnQoImNsb3NlLmJzLmFsZXJ0IikpLGIuaXNEZWZhdWx0UHJldmVudGVkKCl8fChmLnJlbW92ZUNsYXNzKCJpbiIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZmLmhhc0NsYXNzKCJmYWRlIik/Zi5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGMpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCk6YygpKX07dmFyIGQ9YS5mbi5hbGVydDthLmZuLmFsZXJ0PWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5hbGVydCIpO2V8fGQuZGF0YSgiYnMuYWxlcnQiLGU9bmV3IGModGhpcykpLCJzdHJpbmciPT10eXBlb2YgYiYmZVtiXS5jYWxsKGQpfSl9LGEuZm4uYWxlcnQuQ29uc3RydWN0b3I9YyxhLmZuLmFsZXJ0Lm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5hbGVydD1kLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5hbGVydC5kYXRhLWFwaSIsYixjLnByb3RvdHlwZS5jbG9zZSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGMsZCl7dGhpcy4kZWxlbWVudD1hKGMpLHRoaXMub3B0aW9ucz1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQpLHRoaXMuaXNMb2FkaW5nPSExfTtiLkRFRkFVTFRTPXtsb2FkaW5nVGV4dDoibG9hZGluZy4uLiJ9LGIucHJvdG90eXBlLnNldFN0YXRlPWZ1bmN0aW9uKGIpe3ZhciBjPSJkaXNhYmxlZCIsZD10aGlzLiRlbGVtZW50LGU9ZC5pcygiaW5wdXQiKT8idmFsIjoiaHRtbCIsZj1kLmRhdGEoKTtiKz0iVGV4dCIsZi5yZXNldFRleHR8fGQuZGF0YSgicmVzZXRUZXh0IixkW2VdKCkpLGRbZV0oZltiXXx8dGhpcy5vcHRpb25zW2JdKSxzZXRUaW1lb3V0KGEucHJveHkoZnVuY3Rpb24oKXsibG9hZGluZ1RleHQiPT1iPyh0aGlzLmlzTG9hZGluZz0hMCxkLmFkZENsYXNzKGMpLmF0dHIoYyxjKSk6dGhpcy5pc0xvYWRpbmcmJih0aGlzLmlzTG9hZGluZz0hMSxkLnJlbW92ZUNsYXNzKGMpLnJlbW92ZUF0dHIoYykpfSx0aGlzKSwwKX0sYi5wcm90b3R5cGUudG9nZ2xlPWZ1bmN0aW9uKCl7dmFyIGE9ITAsYj10aGlzLiRlbGVtZW50LmNsb3Nlc3QoJ1tkYXRhLXRvZ2dsZT0iYnV0dG9ucyJdJyk7aWYoYi5sZW5ndGgpe3ZhciBjPXRoaXMuJGVsZW1lbnQuZmluZCgiaW5wdXQiKTsicmFkaW8iPT1jLnByb3AoInR5cGUiKSYmKGMucHJvcCgiY2hlY2tlZCIpJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJhY3RpdmUiKT9hPSExOmIuZmluZCgiLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSksYSYmYy5wcm9wKCJjaGVja2VkIiwhdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiYWN0aXZlIikpLnRyaWdnZXIoImNoYW5nZSIpfWEmJnRoaXMuJGVsZW1lbnQudG9nZ2xlQ2xhc3MoImFjdGl2ZSIpfTt2YXIgYz1hLmZuLmJ1dHRvbjthLmZuLmJ1dHRvbj1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMuYnV0dG9uIiksZj0ib2JqZWN0Ij09dHlwZW9mIGMmJmM7ZXx8ZC5kYXRhKCJicy5idXR0b24iLGU9bmV3IGIodGhpcyxmKSksInRvZ2dsZSI9PWM/ZS50b2dnbGUoKTpjJiZlLnNldFN0YXRlKGMpfSl9LGEuZm4uYnV0dG9uLkNvbnN0cnVjdG9yPWIsYS5mbi5idXR0b24ubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLmJ1dHRvbj1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5idXR0b24uZGF0YS1hcGkiLCJbZGF0YS10b2dnbGVePWJ1dHRvbl0iLGZ1bmN0aW9uKGIpe3ZhciBjPWEoYi50YXJnZXQpO2MuaGFzQ2xhc3MoImJ0biIpfHwoYz1jLmNsb3Nlc3QoIi5idG4iKSksYy5idXR0b24oInRvZ2dsZSIpLGIucHJldmVudERlZmF1bHQoKX0pfShqUXVlcnkpLCtmdW5jdGlvbihhKXt2YXIgYj1mdW5jdGlvbihiLGMpe3RoaXMuJGVsZW1lbnQ9YShiKSx0aGlzLiRpbmRpY2F0b3JzPXRoaXMuJGVsZW1lbnQuZmluZCgiLmNhcm91c2VsLWluZGljYXRvcnMiKSx0aGlzLm9wdGlvbnM9Yyx0aGlzLnBhdXNlZD10aGlzLnNsaWRpbmc9dGhpcy5pbnRlcnZhbD10aGlzLiRhY3RpdmU9dGhpcy4kaXRlbXM9bnVsbCwiaG92ZXIiPT10aGlzLm9wdGlvbnMucGF1c2UmJnRoaXMuJGVsZW1lbnQub24oIm1vdXNlZW50ZXIiLGEucHJveHkodGhpcy5wYXVzZSx0aGlzKSkub24oIm1vdXNlbGVhdmUiLGEucHJveHkodGhpcy5jeWNsZSx0aGlzKSl9O2IuREVGQVVMVFM9e2ludGVydmFsOjVlMyxwYXVzZToiaG92ZXIiLHdyYXA6ITB9LGIucHJvdG90eXBlLmN5Y2xlPWZ1bmN0aW9uKGIpe3JldHVybiBifHwodGhpcy5wYXVzZWQ9ITEpLHRoaXMuaW50ZXJ2YWwmJmNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCksdGhpcy5vcHRpb25zLmludGVydmFsJiYhdGhpcy5wYXVzZWQmJih0aGlzLmludGVydmFsPXNldEludGVydmFsKGEucHJveHkodGhpcy5uZXh0LHRoaXMpLHRoaXMub3B0aW9ucy5pbnRlcnZhbCkpLHRoaXN9LGIucHJvdG90eXBlLmdldEFjdGl2ZUluZGV4PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJGFjdGl2ZT10aGlzLiRlbGVtZW50LmZpbmQoIi5pdGVtLmFjdGl2ZSIpLHRoaXMuJGl0ZW1zPXRoaXMuJGFjdGl2ZS5wYXJlbnQoKS5jaGlsZHJlbigpLHRoaXMuJGl0ZW1zLmluZGV4KHRoaXMuJGFjdGl2ZSl9LGIucHJvdG90eXBlLnRvPWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMsZD10aGlzLmdldEFjdGl2ZUluZGV4KCk7cmV0dXJuIGI+dGhpcy4kaXRlbXMubGVuZ3RoLTF8fDA+Yj92b2lkIDA6dGhpcy5zbGlkaW5nP3RoaXMuJGVsZW1lbnQub25lKCJzbGlkLmJzLmNhcm91c2VsIixmdW5jdGlvbigpe2MudG8oYil9KTpkPT1iP3RoaXMucGF1c2UoKS5jeWNsZSgpOnRoaXMuc2xpZGUoYj5kPyJuZXh0IjoicHJldiIsYSh0aGlzLiRpdGVtc1tiXSkpfSxiLnByb3RvdHlwZS5wYXVzZT1mdW5jdGlvbihiKXtyZXR1cm4gYnx8KHRoaXMucGF1c2VkPSEwKSx0aGlzLiRlbGVtZW50LmZpbmQoIi5uZXh0LCAucHJldiIpLmxlbmd0aCYmYS5zdXBwb3J0LnRyYW5zaXRpb24mJih0aGlzLiRlbGVtZW50LnRyaWdnZXIoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kKSx0aGlzLmN5Y2xlKCEwKSksdGhpcy5pbnRlcnZhbD1jbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpLHRoaXN9LGIucHJvdG90eXBlLm5leHQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zbGlkaW5nP3ZvaWQgMDp0aGlzLnNsaWRlKCJuZXh0Iil9LGIucHJvdG90eXBlLnByZXY9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zbGlkaW5nP3ZvaWQgMDp0aGlzLnNsaWRlKCJwcmV2Iil9LGIucHJvdG90eXBlLnNsaWRlPWZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy4kZWxlbWVudC5maW5kKCIuaXRlbS5hY3RpdmUiKSxlPWN8fGRbYl0oKSxmPXRoaXMuaW50ZXJ2YWwsZz0ibmV4dCI9PWI/ImxlZnQiOiJyaWdodCIsaD0ibmV4dCI9PWI/ImZpcnN0IjoibGFzdCIsaT10aGlzO2lmKCFlLmxlbmd0aCl7aWYoIXRoaXMub3B0aW9ucy53cmFwKXJldHVybjtlPXRoaXMuJGVsZW1lbnQuZmluZCgiLml0ZW0iKVtoXSgpfWlmKGUuaGFzQ2xhc3MoImFjdGl2ZSIpKXJldHVybiB0aGlzLnNsaWRpbmc9ITE7dmFyIGo9YS5FdmVudCgic2xpZGUuYnMuY2Fyb3VzZWwiLHtyZWxhdGVkVGFyZ2V0OmVbMF0sZGlyZWN0aW9uOmd9KTtyZXR1cm4gdGhpcy4kZWxlbWVudC50cmlnZ2VyKGopLGouaXNEZWZhdWx0UHJldmVudGVkKCk/dm9pZCAwOih0aGlzLnNsaWRpbmc9ITAsZiYmdGhpcy5wYXVzZSgpLHRoaXMuJGluZGljYXRvcnMubGVuZ3RoJiYodGhpcy4kaW5kaWNhdG9ycy5maW5kKCIuYWN0aXZlIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpLHRoaXMuJGVsZW1lbnQub25lKCJzbGlkLmJzLmNhcm91c2VsIixmdW5jdGlvbigpe3ZhciBiPWEoaS4kaW5kaWNhdG9ycy5jaGlsZHJlbigpW2kuZ2V0QWN0aXZlSW5kZXgoKV0pO2ImJmIuYWRkQ2xhc3MoImFjdGl2ZSIpfSkpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJzbGlkZSIpPyhlLmFkZENsYXNzKGIpLGVbMF0ub2Zmc2V0V2lkdGgsZC5hZGRDbGFzcyhnKSxlLmFkZENsYXNzKGcpLGQub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxmdW5jdGlvbigpe2UucmVtb3ZlQ2xhc3MoW2IsZ10uam9pbigiICIpKS5hZGRDbGFzcygiYWN0aXZlIiksZC5yZW1vdmVDbGFzcyhbImFjdGl2ZSIsZ10uam9pbigiICIpKSxpLnNsaWRpbmc9ITEsc2V0VGltZW91dChmdW5jdGlvbigpe2kuJGVsZW1lbnQudHJpZ2dlcigic2xpZC5icy5jYXJvdXNlbCIpfSwwKX0pLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDFlMypkLmNzcygidHJhbnNpdGlvbi1kdXJhdGlvbiIpLnNsaWNlKDAsLTEpKSk6KGQucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpLGUuYWRkQ2xhc3MoImFjdGl2ZSIpLHRoaXMuc2xpZGluZz0hMSx0aGlzLiRlbGVtZW50LnRyaWdnZXIoInNsaWQuYnMuY2Fyb3VzZWwiKSksZiYmdGhpcy5jeWNsZSgpLHRoaXMpfTt2YXIgYz1hLmZuLmNhcm91c2VsO2EuZm4uY2Fyb3VzZWw9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLmNhcm91c2VsIiksZj1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQuZGF0YSgpLCJvYmplY3QiPT10eXBlb2YgYyYmYyksZz0ic3RyaW5nIj09dHlwZW9mIGM/YzpmLnNsaWRlO2V8fGQuZGF0YSgiYnMuY2Fyb3VzZWwiLGU9bmV3IGIodGhpcyxmKSksIm51bWJlciI9PXR5cGVvZiBjP2UudG8oYyk6Zz9lW2ddKCk6Zi5pbnRlcnZhbCYmZS5wYXVzZSgpLmN5Y2xlKCl9KX0sYS5mbi5jYXJvdXNlbC5Db25zdHJ1Y3Rvcj1iLGEuZm4uY2Fyb3VzZWwubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLmNhcm91c2VsPWMsdGhpc30sYShkb2N1bWVudCkub24oImNsaWNrLmJzLmNhcm91c2VsLmRhdGEtYXBpIiwiW2RhdGEtc2xpZGVdLCBbZGF0YS1zbGlkZS10b10iLGZ1bmN0aW9uKGIpe3ZhciBjLGQ9YSh0aGlzKSxlPWEoZC5hdHRyKCJkYXRhLXRhcmdldCIpfHwoYz1kLmF0dHIoImhyZWYiKSkmJmMucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCIiKSksZj1hLmV4dGVuZCh7fSxlLmRhdGEoKSxkLmRhdGEoKSksZz1kLmF0dHIoImRhdGEtc2xpZGUtdG8iKTtnJiYoZi5pbnRlcnZhbD0hMSksZS5jYXJvdXNlbChmKSwoZz1kLmF0dHIoImRhdGEtc2xpZGUtdG8iKSkmJmUuZGF0YSgiYnMuY2Fyb3VzZWwiKS50byhnKSxiLnByZXZlbnREZWZhdWx0KCl9KSxhKHdpbmRvdykub24oImxvYWQiLGZ1bmN0aW9uKCl7YSgnW2RhdGEtcmlkZT0iY2Fyb3VzZWwiXScpLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1hKHRoaXMpO2IuY2Fyb3VzZWwoYi5kYXRhKCkpfSl9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYyxkKXt0aGlzLiRlbGVtZW50PWEoYyksdGhpcy5vcHRpb25zPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZCksdGhpcy50cmFuc2l0aW9uaW5nPW51bGwsdGhpcy5vcHRpb25zLnBhcmVudCYmKHRoaXMuJHBhcmVudD1hKHRoaXMub3B0aW9ucy5wYXJlbnQpKSx0aGlzLm9wdGlvbnMudG9nZ2xlJiZ0aGlzLnRvZ2dsZSgpfTtiLkRFRkFVTFRTPXt0b2dnbGU6ITB9LGIucHJvdG90eXBlLmRpbWVuc2lvbj1mdW5jdGlvbigpe3ZhciBhPXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoIndpZHRoIik7cmV0dXJuIGE/IndpZHRoIjoiaGVpZ2h0In0sYi5wcm90b3R5cGUuc2hvdz1mdW5jdGlvbigpe2lmKCF0aGlzLnRyYW5zaXRpb25pbmcmJiF0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJpbiIpKXt2YXIgYj1hLkV2ZW50KCJzaG93LmJzLmNvbGxhcHNlIik7aWYodGhpcy4kZWxlbWVudC50cmlnZ2VyKGIpLCFiLmlzRGVmYXVsdFByZXZlbnRlZCgpKXt2YXIgYz10aGlzLiRwYXJlbnQmJnRoaXMuJHBhcmVudC5maW5kKCI+IC5wYW5lbCA+IC5pbiIpO2lmKGMmJmMubGVuZ3RoKXt2YXIgZD1jLmRhdGEoImJzLmNvbGxhcHNlIik7aWYoZCYmZC50cmFuc2l0aW9uaW5nKXJldHVybjtjLmNvbGxhcHNlKCJoaWRlIiksZHx8Yy5kYXRhKCJicy5jb2xsYXBzZSIsbnVsbCl9dmFyIGU9dGhpcy5kaW1lbnNpb24oKTt0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJjb2xsYXBzZSIpLmFkZENsYXNzKCJjb2xsYXBzaW5nIilbZV0oMCksdGhpcy50cmFuc2l0aW9uaW5nPTE7dmFyIGY9ZnVuY3Rpb24oKXt0aGlzLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJjb2xsYXBzaW5nIikuYWRkQ2xhc3MoImNvbGxhcHNlIGluIilbZV0oImF1dG8iKSx0aGlzLnRyYW5zaXRpb25pbmc9MCx0aGlzLiRlbGVtZW50LnRyaWdnZXIoInNob3duLmJzLmNvbGxhcHNlIil9O2lmKCFhLnN1cHBvcnQudHJhbnNpdGlvbilyZXR1cm4gZi5jYWxsKHRoaXMpO3ZhciBnPWEuY2FtZWxDYXNlKFsic2Nyb2xsIixlXS5qb2luKCItIikpO3RoaXMuJGVsZW1lbnQub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxhLnByb3h5KGYsdGhpcykpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDM1MClbZV0odGhpcy4kZWxlbWVudFswXVtnXSl9fX0sYi5wcm90b3R5cGUuaGlkZT1mdW5jdGlvbigpe2lmKCF0aGlzLnRyYW5zaXRpb25pbmcmJnRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImluIikpe3ZhciBiPWEuRXZlbnQoImhpZGUuYnMuY29sbGFwc2UiKTtpZih0aGlzLiRlbGVtZW50LnRyaWdnZXIoYiksIWIuaXNEZWZhdWx0UHJldmVudGVkKCkpe3ZhciBjPXRoaXMuZGltZW5zaW9uKCk7dGhpcy4kZWxlbWVudFtjXSh0aGlzLiRlbGVtZW50W2NdKCkpWzBdLm9mZnNldEhlaWdodCx0aGlzLiRlbGVtZW50LmFkZENsYXNzKCJjb2xsYXBzaW5nIikucmVtb3ZlQ2xhc3MoImNvbGxhcHNlIikucmVtb3ZlQ2xhc3MoImluIiksdGhpcy50cmFuc2l0aW9uaW5nPTE7dmFyIGQ9ZnVuY3Rpb24oKXt0aGlzLnRyYW5zaXRpb25pbmc9MCx0aGlzLiRlbGVtZW50LnRyaWdnZXIoImhpZGRlbi5icy5jb2xsYXBzZSIpLnJlbW92ZUNsYXNzKCJjb2xsYXBzaW5nIikuYWRkQ2xhc3MoImNvbGxhcHNlIil9O3JldHVybiBhLnN1cHBvcnQudHJhbnNpdGlvbj92b2lkIHRoaXMuJGVsZW1lbnRbY10oMCkub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxhLnByb3h5KGQsdGhpcykpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDM1MCk6ZC5jYWxsKHRoaXMpfX19LGIucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbigpe3RoaXNbdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiaW4iKT8iaGlkZSI6InNob3ciXSgpfTt2YXIgYz1hLmZuLmNvbGxhcHNlO2EuZm4uY29sbGFwc2U9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLmNvbGxhcHNlIiksZj1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQuZGF0YSgpLCJvYmplY3QiPT10eXBlb2YgYyYmYyk7IWUmJmYudG9nZ2xlJiYic2hvdyI9PWMmJihjPSFjKSxlfHxkLmRhdGEoImJzLmNvbGxhcHNlIixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4uY29sbGFwc2UuQ29uc3RydWN0b3I9YixhLmZuLmNvbGxhcHNlLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5jb2xsYXBzZT1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5jb2xsYXBzZS5kYXRhLWFwaSIsIltkYXRhLXRvZ2dsZT1jb2xsYXBzZV0iLGZ1bmN0aW9uKGIpe3ZhciBjLGQ9YSh0aGlzKSxlPWQuYXR0cigiZGF0YS10YXJnZXQiKXx8Yi5wcmV2ZW50RGVmYXVsdCgpfHwoYz1kLmF0dHIoImhyZWYiKSkmJmMucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCIiKSxmPWEoZSksZz1mLmRhdGEoImJzLmNvbGxhcHNlIiksaD1nPyJ0b2dnbGUiOmQuZGF0YSgpLGk9ZC5hdHRyKCJkYXRhLXBhcmVudCIpLGo9aSYmYShpKTtnJiZnLnRyYW5zaXRpb25pbmd8fChqJiZqLmZpbmQoJ1tkYXRhLXRvZ2dsZT1jb2xsYXBzZV1bZGF0YS1wYXJlbnQ9IicraSsnIl0nKS5ub3QoZCkuYWRkQ2xhc3MoImNvbGxhcHNlZCIpLGRbZi5oYXNDbGFzcygiaW4iKT8iYWRkQ2xhc3MiOiJyZW1vdmVDbGFzcyJdKCJjb2xsYXBzZWQiKSksZi5jb2xsYXBzZShoKX0pfShqUXVlcnkpLCtmdW5jdGlvbihhKXtmdW5jdGlvbiBiKGIpe2EoZCkucmVtb3ZlKCksYShlKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YyhhKHRoaXMpKSxlPXtyZWxhdGVkVGFyZ2V0OnRoaXN9O2QuaGFzQ2xhc3MoIm9wZW4iKSYmKGQudHJpZ2dlcihiPWEuRXZlbnQoImhpZGUuYnMuZHJvcGRvd24iLGUpKSxiLmlzRGVmYXVsdFByZXZlbnRlZCgpfHxkLnJlbW92ZUNsYXNzKCJvcGVuIikudHJpZ2dlcigiaGlkZGVuLmJzLmRyb3Bkb3duIixlKSl9KX1mdW5jdGlvbiBjKGIpe3ZhciBjPWIuYXR0cigiZGF0YS10YXJnZXQiKTtjfHwoYz1iLmF0dHIoImhyZWYiKSxjPWMmJi8jW0EtWmEtel0vLnRlc3QoYykmJmMucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCIiKSk7dmFyIGQ9YyYmYShjKTtyZXR1cm4gZCYmZC5sZW5ndGg/ZDpiLnBhcmVudCgpfXZhciBkPSIuZHJvcGRvd24tYmFja2Ryb3AiLGU9IltkYXRhLXRvZ2dsZT1kcm9wZG93bl0iLGY9ZnVuY3Rpb24oYil7YShiKS5vbigiY2xpY2suYnMuZHJvcGRvd24iLHRoaXMudG9nZ2xlKX07Zi5wcm90b3R5cGUudG9nZ2xlPWZ1bmN0aW9uKGQpe3ZhciBlPWEodGhpcyk7aWYoIWUuaXMoIi5kaXNhYmxlZCwgOmRpc2FibGVkIikpe3ZhciBmPWMoZSksZz1mLmhhc0NsYXNzKCJvcGVuIik7aWYoYigpLCFnKXsib250b3VjaHN0YXJ0ImluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCYmIWYuY2xvc2VzdCgiLm5hdmJhci1uYXYiKS5sZW5ndGgmJmEoJzxkaXYgY2xhc3M9ImRyb3Bkb3duLWJhY2tkcm9wIi8+JykuaW5zZXJ0QWZ0ZXIoYSh0aGlzKSkub24oImNsaWNrIixiKTt2YXIgaD17cmVsYXRlZFRhcmdldDp0aGlzfTtpZihmLnRyaWdnZXIoZD1hLkV2ZW50KCJzaG93LmJzLmRyb3Bkb3duIixoKSksZC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSlyZXR1cm47Zi50b2dnbGVDbGFzcygib3BlbiIpLnRyaWdnZXIoInNob3duLmJzLmRyb3Bkb3duIixoKSxlLmZvY3VzKCl9cmV0dXJuITF9fSxmLnByb3RvdHlwZS5rZXlkb3duPWZ1bmN0aW9uKGIpe2lmKC8oMzh8NDB8MjcpLy50ZXN0KGIua2V5Q29kZSkpe3ZhciBkPWEodGhpcyk7aWYoYi5wcmV2ZW50RGVmYXVsdCgpLGIuc3RvcFByb3BhZ2F0aW9uKCksIWQuaXMoIi5kaXNhYmxlZCwgOmRpc2FibGVkIikpe3ZhciBmPWMoZCksZz1mLmhhc0NsYXNzKCJvcGVuIik7aWYoIWd8fGcmJjI3PT1iLmtleUNvZGUpcmV0dXJuIDI3PT1iLndoaWNoJiZmLmZpbmQoZSkuZm9jdXMoKSxkLmNsaWNrKCk7dmFyIGg9IiBsaTpub3QoLmRpdmlkZXIpOnZpc2libGUgYSIsaT1mLmZpbmQoIltyb2xlPW1lbnVdIitoKyIsIFtyb2xlPWxpc3Rib3hdIitoKTtpZihpLmxlbmd0aCl7dmFyIGo9aS5pbmRleChpLmZpbHRlcigiOmZvY3VzIikpOzM4PT1iLmtleUNvZGUmJmo+MCYmai0tLDQwPT1iLmtleUNvZGUmJmo8aS5sZW5ndGgtMSYmaisrLH5qfHwoaj0wKSxpLmVxKGopLmZvY3VzKCl9fX19O3ZhciBnPWEuZm4uZHJvcGRvd247YS5mbi5kcm9wZG93bj1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxkPWMuZGF0YSgiYnMuZHJvcGRvd24iKTtkfHxjLmRhdGEoImJzLmRyb3Bkb3duIixkPW5ldyBmKHRoaXMpKSwic3RyaW5nIj09dHlwZW9mIGImJmRbYl0uY2FsbChjKX0pfSxhLmZuLmRyb3Bkb3duLkNvbnN0cnVjdG9yPWYsYS5mbi5kcm9wZG93bi5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uZHJvcGRvd249Zyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuZHJvcGRvd24uZGF0YS1hcGkiLGIpLm9uKCJjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaSIsIi5kcm9wZG93biBmb3JtIixmdW5jdGlvbihhKXthLnN0b3BQcm9wYWdhdGlvbigpfSkub24oImNsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpIixlLGYucHJvdG90eXBlLnRvZ2dsZSkub24oImtleWRvd24uYnMuZHJvcGRvd24uZGF0YS1hcGkiLGUrIiwgW3JvbGU9bWVudV0sIFtyb2xlPWxpc3Rib3hdIixmLnByb3RvdHlwZS5rZXlkb3duKX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYixjKXt0aGlzLm9wdGlvbnM9Yyx0aGlzLiRlbGVtZW50PWEoYiksdGhpcy4kYmFja2Ryb3A9dGhpcy5pc1Nob3duPW51bGwsdGhpcy5vcHRpb25zLnJlbW90ZSYmdGhpcy4kZWxlbWVudC5maW5kKCIubW9kYWwtY29udGVudCIpLmxvYWQodGhpcy5vcHRpb25zLnJlbW90ZSxhLnByb3h5KGZ1bmN0aW9uKCl7dGhpcy4kZWxlbWVudC50cmlnZ2VyKCJsb2FkZWQuYnMubW9kYWwiKX0sdGhpcykpfTtiLkRFRkFVTFRTPXtiYWNrZHJvcDohMCxrZXlib2FyZDohMCxzaG93OiEwfSxiLnByb3RvdHlwZS50b2dnbGU9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXNbdGhpcy5pc1Nob3duPyJoaWRlIjoic2hvdyJdKGEpfSxiLnByb3RvdHlwZS5zaG93PWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMsZD1hLkV2ZW50KCJzaG93LmJzLm1vZGFsIix7cmVsYXRlZFRhcmdldDpifSk7dGhpcy4kZWxlbWVudC50cmlnZ2VyKGQpLHRoaXMuaXNTaG93bnx8ZC5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8KHRoaXMuaXNTaG93bj0hMCx0aGlzLmVzY2FwZSgpLHRoaXMuJGVsZW1lbnQub24oImNsaWNrLmRpc21pc3MuYnMubW9kYWwiLCdbZGF0YS1kaXNtaXNzPSJtb2RhbCJdJyxhLnByb3h5KHRoaXMuaGlkZSx0aGlzKSksdGhpcy5iYWNrZHJvcChmdW5jdGlvbigpe3ZhciBkPWEuc3VwcG9ydC50cmFuc2l0aW9uJiZjLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik7Yy4kZWxlbWVudC5wYXJlbnQoKS5sZW5ndGh8fGMuJGVsZW1lbnQuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSksYy4kZWxlbWVudC5zaG93KCkuc2Nyb2xsVG9wKDApLGQmJmMuJGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGgsYy4kZWxlbWVudC5hZGRDbGFzcygiaW4iKS5hdHRyKCJhcmlhLWhpZGRlbiIsITEpLGMuZW5mb3JjZUZvY3VzKCk7dmFyIGU9YS5FdmVudCgic2hvd24uYnMubW9kYWwiLHtyZWxhdGVkVGFyZ2V0OmJ9KTtkP2MuJGVsZW1lbnQuZmluZCgiLm1vZGFsLWRpYWxvZyIpLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZnVuY3Rpb24oKXtjLiRlbGVtZW50LmZvY3VzKCkudHJpZ2dlcihlKX0pLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDMwMCk6Yy4kZWxlbWVudC5mb2N1cygpLnRyaWdnZXIoZSl9KSl9LGIucHJvdG90eXBlLmhpZGU9ZnVuY3Rpb24oYil7YiYmYi5wcmV2ZW50RGVmYXVsdCgpLGI9YS5FdmVudCgiaGlkZS5icy5tb2RhbCIpLHRoaXMuJGVsZW1lbnQudHJpZ2dlcihiKSx0aGlzLmlzU2hvd24mJiFiLmlzRGVmYXVsdFByZXZlbnRlZCgpJiYodGhpcy5pc1Nob3duPSExLHRoaXMuZXNjYXBlKCksYShkb2N1bWVudCkub2ZmKCJmb2N1c2luLmJzLm1vZGFsIiksdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygiaW4iKS5hdHRyKCJhcmlhLWhpZGRlbiIsITApLm9mZigiY2xpY2suZGlzbWlzcy5icy5tb2RhbCIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik/dGhpcy4kZWxlbWVudC5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGEucHJveHkodGhpcy5oaWRlTW9kYWwsdGhpcykpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKDMwMCk6dGhpcy5oaWRlTW9kYWwoKSl9LGIucHJvdG90eXBlLmVuZm9yY2VGb2N1cz1mdW5jdGlvbigpe2EoZG9jdW1lbnQpLm9mZigiZm9jdXNpbi5icy5tb2RhbCIpLm9uKCJmb2N1c2luLmJzLm1vZGFsIixhLnByb3h5KGZ1bmN0aW9uKGEpe3RoaXMuJGVsZW1lbnRbMF09PT1hLnRhcmdldHx8dGhpcy4kZWxlbWVudC5oYXMoYS50YXJnZXQpLmxlbmd0aHx8dGhpcy4kZWxlbWVudC5mb2N1cygpfSx0aGlzKSl9LGIucHJvdG90eXBlLmVzY2FwZT1mdW5jdGlvbigpe3RoaXMuaXNTaG93biYmdGhpcy5vcHRpb25zLmtleWJvYXJkP3RoaXMuJGVsZW1lbnQub24oImtleXVwLmRpc21pc3MuYnMubW9kYWwiLGEucHJveHkoZnVuY3Rpb24oYSl7Mjc9PWEud2hpY2gmJnRoaXMuaGlkZSgpfSx0aGlzKSk6dGhpcy5pc1Nob3dufHx0aGlzLiRlbGVtZW50Lm9mZigia2V5dXAuZGlzbWlzcy5icy5tb2RhbCIpfSxiLnByb3RvdHlwZS5oaWRlTW9kYWw9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3RoaXMuJGVsZW1lbnQuaGlkZSgpLHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24oKXthLnJlbW92ZUJhY2tkcm9wKCksYS4kZWxlbWVudC50cmlnZ2VyKCJoaWRkZW4uYnMubW9kYWwiKX0pfSxiLnByb3RvdHlwZS5yZW1vdmVCYWNrZHJvcD1mdW5jdGlvbigpe3RoaXMuJGJhY2tkcm9wJiZ0aGlzLiRiYWNrZHJvcC5yZW1vdmUoKSx0aGlzLiRiYWNrZHJvcD1udWxsfSxiLnByb3RvdHlwZS5iYWNrZHJvcD1mdW5jdGlvbihiKXt2YXIgYz10aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik/ImZhZGUiOiIiO2lmKHRoaXMuaXNTaG93biYmdGhpcy5vcHRpb25zLmJhY2tkcm9wKXt2YXIgZD1hLnN1cHBvcnQudHJhbnNpdGlvbiYmYztpZih0aGlzLiRiYWNrZHJvcD1hKCc8ZGl2IGNsYXNzPSJtb2RhbC1iYWNrZHJvcCAnK2MrJyIgLz4nKS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KSx0aGlzLiRlbGVtZW50Lm9uKCJjbGljay5kaXNtaXNzLmJzLm1vZGFsIixhLnByb3h5KGZ1bmN0aW9uKGEpe2EudGFyZ2V0PT09YS5jdXJyZW50VGFyZ2V0JiYoInN0YXRpYyI9PXRoaXMub3B0aW9ucy5iYWNrZHJvcD90aGlzLiRlbGVtZW50WzBdLmZvY3VzLmNhbGwodGhpcy4kZWxlbWVudFswXSk6dGhpcy5oaWRlLmNhbGwodGhpcykpfSx0aGlzKSksZCYmdGhpcy4kYmFja2Ryb3BbMF0ub2Zmc2V0V2lkdGgsdGhpcy4kYmFja2Ryb3AuYWRkQ2xhc3MoImluIiksIWIpcmV0dXJuO2Q/dGhpcy4kYmFja2Ryb3Aub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxiKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmIoKX1lbHNlIXRoaXMuaXNTaG93biYmdGhpcy4kYmFja2Ryb3A/KHRoaXMuJGJhY2tkcm9wLnJlbW92ZUNsYXNzKCJpbiIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJmYWRlIik/dGhpcy4kYmFja2Ryb3Aub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxiKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmIoKSk6YiYmYigpfTt2YXIgYz1hLmZuLm1vZGFsO2EuZm4ubW9kYWw9ZnVuY3Rpb24oYyxkKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGU9YSh0aGlzKSxmPWUuZGF0YSgiYnMubW9kYWwiKSxnPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZS5kYXRhKCksIm9iamVjdCI9PXR5cGVvZiBjJiZjKTtmfHxlLmRhdGEoImJzLm1vZGFsIixmPW5ldyBiKHRoaXMsZykpLCJzdHJpbmciPT10eXBlb2YgYz9mW2NdKGQpOmcuc2hvdyYmZi5zaG93KGQpfSl9LGEuZm4ubW9kYWwuQ29uc3RydWN0b3I9YixhLmZuLm1vZGFsLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5tb2RhbD1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5tb2RhbC5kYXRhLWFwaSIsJ1tkYXRhLXRvZ2dsZT0ibW9kYWwiXScsZnVuY3Rpb24oYil7dmFyIGM9YSh0aGlzKSxkPWMuYXR0cigiaHJlZiIpLGU9YShjLmF0dHIoImRhdGEtdGFyZ2V0Iil8fGQmJmQucmVwbGFjZSgvLiooPz0jW15cc10rJCkvLCIiKSksZj1lLmRhdGEoImJzLm1vZGFsIik/InRvZ2dsZSI6YS5leHRlbmQoe3JlbW90ZTohLyMvLnRlc3QoZCkmJmR9LGUuZGF0YSgpLGMuZGF0YSgpKTtjLmlzKCJhIikmJmIucHJldmVudERlZmF1bHQoKSxlLm1vZGFsKGYsdGhpcykub25lKCJoaWRlIixmdW5jdGlvbigpe2MuaXMoIjp2aXNpYmxlIikmJmMuZm9jdXMoKX0pfSksYShkb2N1bWVudCkub24oInNob3cuYnMubW9kYWwiLCIubW9kYWwiLGZ1bmN0aW9uKCl7YShkb2N1bWVudC5ib2R5KS5hZGRDbGFzcygibW9kYWwtb3BlbiIpfSkub24oImhpZGRlbi5icy5tb2RhbCIsIi5tb2RhbCIsZnVuY3Rpb24oKXthKGRvY3VtZW50LmJvZHkpLnJlbW92ZUNsYXNzKCJtb2RhbC1vcGVuIil9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYSxiKXt0aGlzLnR5cGU9dGhpcy5vcHRpb25zPXRoaXMuZW5hYmxlZD10aGlzLnRpbWVvdXQ9dGhpcy5ob3ZlclN0YXRlPXRoaXMuJGVsZW1lbnQ9bnVsbCx0aGlzLmluaXQoInRvb2x0aXAiLGEsYil9O2IuREVGQVVMVFM9e2FuaW1hdGlvbjohMCxwbGFjZW1lbnQ6InRvcCIsc2VsZWN0b3I6ITEsdGVtcGxhdGU6JzxkaXYgY2xhc3M9InRvb2x0aXAiPjxkaXYgY2xhc3M9InRvb2x0aXAtYXJyb3ciPjwvZGl2PjxkaXYgY2xhc3M9InRvb2x0aXAtaW5uZXIiPjwvZGl2PjwvZGl2PicsdHJpZ2dlcjoiaG92ZXIgZm9jdXMiLHRpdGxlOiIiLGRlbGF5OjAsaHRtbDohMSxjb250YWluZXI6ITF9LGIucHJvdG90eXBlLmluaXQ9ZnVuY3Rpb24oYixjLGQpe3RoaXMuZW5hYmxlZD0hMCx0aGlzLnR5cGU9Yix0aGlzLiRlbGVtZW50PWEoYyksdGhpcy5vcHRpb25zPXRoaXMuZ2V0T3B0aW9ucyhkKTtmb3IodmFyIGU9dGhpcy5vcHRpb25zLnRyaWdnZXIuc3BsaXQoIiAiKSxmPWUubGVuZ3RoO2YtLTspe3ZhciBnPWVbZl07aWYoImNsaWNrIj09Zyl0aGlzLiRlbGVtZW50Lm9uKCJjbGljay4iK3RoaXMudHlwZSx0aGlzLm9wdGlvbnMuc2VsZWN0b3IsYS5wcm94eSh0aGlzLnRvZ2dsZSx0aGlzKSk7ZWxzZSBpZigibWFudWFsIiE9Zyl7dmFyIGg9ImhvdmVyIj09Zz8ibW91c2VlbnRlciI6ImZvY3VzaW4iLGk9ImhvdmVyIj09Zz8ibW91c2VsZWF2ZSI6ImZvY3Vzb3V0Ijt0aGlzLiRlbGVtZW50Lm9uKGgrIi4iK3RoaXMudHlwZSx0aGlzLm9wdGlvbnMuc2VsZWN0b3IsYS5wcm94eSh0aGlzLmVudGVyLHRoaXMpKSx0aGlzLiRlbGVtZW50Lm9uKGkrIi4iK3RoaXMudHlwZSx0aGlzLm9wdGlvbnMuc2VsZWN0b3IsYS5wcm94eSh0aGlzLmxlYXZlLHRoaXMpKX19dGhpcy5vcHRpb25zLnNlbGVjdG9yP3RoaXMuX29wdGlvbnM9YS5leHRlbmQoe30sdGhpcy5vcHRpb25zLHt0cmlnZ2VyOiJtYW51YWwiLHNlbGVjdG9yOiIifSk6dGhpcy5maXhUaXRsZSgpfSxiLnByb3RvdHlwZS5nZXREZWZhdWx0cz1mdW5jdGlvbigpe3JldHVybiBiLkRFRkFVTFRTfSxiLnByb3RvdHlwZS5nZXRPcHRpb25zPWZ1bmN0aW9uKGIpe3JldHVybiBiPWEuZXh0ZW5kKHt9LHRoaXMuZ2V0RGVmYXVsdHMoKSx0aGlzLiRlbGVtZW50LmRhdGEoKSxiKSxiLmRlbGF5JiYibnVtYmVyIj09dHlwZW9mIGIuZGVsYXkmJihiLmRlbGF5PXtzaG93OmIuZGVsYXksaGlkZTpiLmRlbGF5fSksYn0sYi5wcm90b3R5cGUuZ2V0RGVsZWdhdGVPcHRpb25zPWZ1bmN0aW9uKCl7dmFyIGI9e30sYz10aGlzLmdldERlZmF1bHRzKCk7cmV0dXJuIHRoaXMuX29wdGlvbnMmJmEuZWFjaCh0aGlzLl9vcHRpb25zLGZ1bmN0aW9uKGEsZCl7Y1thXSE9ZCYmKGJbYV09ZCl9KSxifSxiLnByb3RvdHlwZS5lbnRlcj1mdW5jdGlvbihiKXt2YXIgYz1iIGluc3RhbmNlb2YgdGhpcy5jb25zdHJ1Y3Rvcj9iOmEoYi5jdXJyZW50VGFyZ2V0KVt0aGlzLnR5cGVdKHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpLmRhdGEoImJzLiIrdGhpcy50eXBlKTtyZXR1cm4gY2xlYXJUaW1lb3V0KGMudGltZW91dCksYy5ob3ZlclN0YXRlPSJpbiIsYy5vcHRpb25zLmRlbGF5JiZjLm9wdGlvbnMuZGVsYXkuc2hvdz92b2lkKGMudGltZW91dD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ImluIj09Yy5ob3ZlclN0YXRlJiZjLnNob3coKX0sYy5vcHRpb25zLmRlbGF5LnNob3cpKTpjLnNob3coKX0sYi5wcm90b3R5cGUubGVhdmU9ZnVuY3Rpb24oYil7dmFyIGM9YiBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3I/YjphKGIuY3VycmVudFRhcmdldClbdGhpcy50eXBlXSh0aGlzLmdldERlbGVnYXRlT3B0aW9ucygpKS5kYXRhKCJicy4iK3RoaXMudHlwZSk7cmV0dXJuIGNsZWFyVGltZW91dChjLnRpbWVvdXQpLGMuaG92ZXJTdGF0ZT0ib3V0IixjLm9wdGlvbnMuZGVsYXkmJmMub3B0aW9ucy5kZWxheS5oaWRlP3ZvaWQoYy50aW1lb3V0PXNldFRpbWVvdXQoZnVuY3Rpb24oKXsib3V0Ij09Yy5ob3ZlclN0YXRlJiZjLmhpZGUoKX0sYy5vcHRpb25zLmRlbGF5LmhpZGUpKTpjLmhpZGUoKX0sYi5wcm90b3R5cGUuc2hvdz1mdW5jdGlvbigpe3ZhciBiPWEuRXZlbnQoInNob3cuYnMuIit0aGlzLnR5cGUpO2lmKHRoaXMuaGFzQ29udGVudCgpJiZ0aGlzLmVuYWJsZWQpe2lmKHRoaXMuJGVsZW1lbnQudHJpZ2dlcihiKSxiLmlzRGVmYXVsdFByZXZlbnRlZCgpKXJldHVybjt2YXIgYz10aGlzLGQ9dGhpcy50aXAoKTt0aGlzLnNldENvbnRlbnQoKSx0aGlzLm9wdGlvbnMuYW5pbWF0aW9uJiZkLmFkZENsYXNzKCJmYWRlIik7dmFyIGU9ImZ1bmN0aW9uIj09dHlwZW9mIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQ/dGhpcy5vcHRpb25zLnBsYWNlbWVudC5jYWxsKHRoaXMsZFswXSx0aGlzLiRlbGVtZW50WzBdKTp0aGlzLm9wdGlvbnMucGxhY2VtZW50LGY9L1xzP2F1dG8/XHM/L2ksZz1mLnRlc3QoZSk7ZyYmKGU9ZS5yZXBsYWNlKGYsIiIpfHwidG9wIiksZC5kZXRhY2goKS5jc3Moe3RvcDowLGxlZnQ6MCxkaXNwbGF5OiJibG9jayJ9KS5hZGRDbGFzcyhlKSx0aGlzLm9wdGlvbnMuY29udGFpbmVyP2QuYXBwZW5kVG8odGhpcy5vcHRpb25zLmNvbnRhaW5lcik6ZC5pbnNlcnRBZnRlcih0aGlzLiRlbGVtZW50KTt2YXIgaD10aGlzLmdldFBvc2l0aW9uKCksaT1kWzBdLm9mZnNldFdpZHRoLGo9ZFswXS5vZmZzZXRIZWlnaHQ7aWYoZyl7dmFyIGs9dGhpcy4kZWxlbWVudC5wYXJlbnQoKSxsPWUsbT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wfHxkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCxuPSJib2R5Ij09dGhpcy5vcHRpb25zLmNvbnRhaW5lcj93aW5kb3cuaW5uZXJXaWR0aDprLm91dGVyV2lkdGgoKSxvPSJib2R5Ij09dGhpcy5vcHRpb25zLmNvbnRhaW5lcj93aW5kb3cuaW5uZXJIZWlnaHQ6ay5vdXRlckhlaWdodCgpLHA9ImJvZHkiPT10aGlzLm9wdGlvbnMuY29udGFpbmVyPzA6ay5vZmZzZXQoKS5sZWZ0O2U9ImJvdHRvbSI9PWUmJmgudG9wK2guaGVpZ2h0K2otbT5vPyJ0b3AiOiJ0b3AiPT1lJiZoLnRvcC1tLWo8MD8iYm90dG9tIjoicmlnaHQiPT1lJiZoLnJpZ2h0K2k+bj8ibGVmdCI6ImxlZnQiPT1lJiZoLmxlZnQtaTxwPyJyaWdodCI6ZSxkLnJlbW92ZUNsYXNzKGwpLmFkZENsYXNzKGUpfXZhciBxPXRoaXMuZ2V0Q2FsY3VsYXRlZE9mZnNldChlLGgsaSxqKTt0aGlzLmFwcGx5UGxhY2VtZW50KHEsZSksdGhpcy5ob3ZlclN0YXRlPW51bGw7dmFyIHI9ZnVuY3Rpb24oKXtjLiRlbGVtZW50LnRyaWdnZXIoInNob3duLmJzLiIrYy50eXBlKX07YS5zdXBwb3J0LnRyYW5zaXRpb24mJnRoaXMuJHRpcC5oYXNDbGFzcygiZmFkZSIpP2Qub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxyKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOnIoKX19LGIucHJvdG90eXBlLmFwcGx5UGxhY2VtZW50PWZ1bmN0aW9uKGIsYyl7dmFyIGQsZT10aGlzLnRpcCgpLGY9ZVswXS5vZmZzZXRXaWR0aCxnPWVbMF0ub2Zmc2V0SGVpZ2h0LGg9cGFyc2VJbnQoZS5jc3MoIm1hcmdpbi10b3AiKSwxMCksaT1wYXJzZUludChlLmNzcygibWFyZ2luLWxlZnQiKSwxMCk7aXNOYU4oaCkmJihoPTApLGlzTmFOKGkpJiYoaT0wKSxiLnRvcD1iLnRvcCtoLGIubGVmdD1iLmxlZnQraSxhLm9mZnNldC5zZXRPZmZzZXQoZVswXSxhLmV4dGVuZCh7dXNpbmc6ZnVuY3Rpb24oYSl7ZS5jc3Moe3RvcDpNYXRoLnJvdW5kKGEudG9wKSxsZWZ0Ok1hdGgucm91bmQoYS5sZWZ0KX0pfX0sYiksMCksZS5hZGRDbGFzcygiaW4iKTt2YXIgaj1lWzBdLm9mZnNldFdpZHRoLGs9ZVswXS5vZmZzZXRIZWlnaHQ7aWYoInRvcCI9PWMmJmshPWcmJihkPSEwLGIudG9wPWIudG9wK2ctayksL2JvdHRvbXx0b3AvLnRlc3QoYykpe3ZhciBsPTA7Yi5sZWZ0PDAmJihsPS0yKmIubGVmdCxiLmxlZnQ9MCxlLm9mZnNldChiKSxqPWVbMF0ub2Zmc2V0V2lkdGgsaz1lWzBdLm9mZnNldEhlaWdodCksdGhpcy5yZXBsYWNlQXJyb3cobC1mK2osaiwibGVmdCIpfWVsc2UgdGhpcy5yZXBsYWNlQXJyb3coay1nLGssInRvcCIpO2QmJmUub2Zmc2V0KGIpfSxiLnByb3RvdHlwZS5yZXBsYWNlQXJyb3c9ZnVuY3Rpb24oYSxiLGMpe3RoaXMuYXJyb3coKS5jc3MoYyxhPzUwKigxLWEvYikrIiUiOiIiKX0sYi5wcm90b3R5cGUuc2V0Q29udGVudD1mdW5jdGlvbigpe3ZhciBhPXRoaXMudGlwKCksYj10aGlzLmdldFRpdGxlKCk7YS5maW5kKCIudG9vbHRpcC1pbm5lciIpW3RoaXMub3B0aW9ucy5odG1sPyJodG1sIjoidGV4dCJdKGIpLGEucmVtb3ZlQ2xhc3MoImZhZGUgaW4gdG9wIGJvdHRvbSBsZWZ0IHJpZ2h0Iil9LGIucHJvdG90eXBlLmhpZGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBiKCl7ImluIiE9Yy5ob3ZlclN0YXRlJiZkLmRldGFjaCgpLGMuJGVsZW1lbnQudHJpZ2dlcigiaGlkZGVuLmJzLiIrYy50eXBlKX12YXIgYz10aGlzLGQ9dGhpcy50aXAoKSxlPWEuRXZlbnQoImhpZGUuYnMuIit0aGlzLnR5cGUpO3JldHVybiB0aGlzLiRlbGVtZW50LnRyaWdnZXIoZSksZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKT92b2lkIDA6KGQucmVtb3ZlQ2xhc3MoImluIiksYS5zdXBwb3J0LnRyYW5zaXRpb24mJnRoaXMuJHRpcC5oYXNDbGFzcygiZmFkZSIpP2Qub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxiKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmIoKSx0aGlzLmhvdmVyU3RhdGU9bnVsbCx0aGlzKX0sYi5wcm90b3R5cGUuZml4VGl0bGU9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLiRlbGVtZW50OyhhLmF0dHIoInRpdGxlIil8fCJzdHJpbmciIT10eXBlb2YgYS5hdHRyKCJkYXRhLW9yaWdpbmFsLXRpdGxlIikpJiZhLmF0dHIoImRhdGEtb3JpZ2luYWwtdGl0bGUiLGEuYXR0cigidGl0bGUiKXx8IiIpLmF0dHIoInRpdGxlIiwiIil9LGIucHJvdG90eXBlLmhhc0NvbnRlbnQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaXRsZSgpfSxiLnByb3RvdHlwZS5nZXRQb3NpdGlvbj1mdW5jdGlvbigpe3ZhciBiPXRoaXMuJGVsZW1lbnRbMF07cmV0dXJuIGEuZXh0ZW5kKHt9LCJmdW5jdGlvbiI9PXR5cGVvZiBiLmdldEJvdW5kaW5nQ2xpZW50UmVjdD9iLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOnt3aWR0aDpiLm9mZnNldFdpZHRoLGhlaWdodDpiLm9mZnNldEhlaWdodH0sdGhpcy4kZWxlbWVudC5vZmZzZXQoKSl9LGIucHJvdG90eXBlLmdldENhbGN1bGF0ZWRPZmZzZXQ9ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuImJvdHRvbSI9PWE/e3RvcDpiLnRvcCtiLmhlaWdodCxsZWZ0OmIubGVmdCtiLndpZHRoLzItYy8yfToidG9wIj09YT97dG9wOmIudG9wLWQsbGVmdDpiLmxlZnQrYi53aWR0aC8yLWMvMn06ImxlZnQiPT1hP3t0b3A6Yi50b3ArYi5oZWlnaHQvMi1kLzIsbGVmdDpiLmxlZnQtY306e3RvcDpiLnRvcCtiLmhlaWdodC8yLWQvMixsZWZ0OmIubGVmdCtiLndpZHRofX0sYi5wcm90b3R5cGUuZ2V0VGl0bGU9ZnVuY3Rpb24oKXt2YXIgYSxiPXRoaXMuJGVsZW1lbnQsYz10aGlzLm9wdGlvbnM7cmV0dXJuIGE9Yi5hdHRyKCJkYXRhLW9yaWdpbmFsLXRpdGxlIil8fCgiZnVuY3Rpb24iPT10eXBlb2YgYy50aXRsZT9jLnRpdGxlLmNhbGwoYlswXSk6Yy50aXRsZSl9LGIucHJvdG90eXBlLnRpcD1mdW5jdGlvbigpe3JldHVybiB0aGlzLiR0aXA9dGhpcy4kdGlwfHxhKHRoaXMub3B0aW9ucy50ZW1wbGF0ZSl9LGIucHJvdG90eXBlLmFycm93PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJGFycm93PXRoaXMuJGFycm93fHx0aGlzLnRpcCgpLmZpbmQoIi50b29sdGlwLWFycm93Iil9LGIucHJvdG90eXBlLnZhbGlkYXRlPWZ1bmN0aW9uKCl7dGhpcy4kZWxlbWVudFswXS5wYXJlbnROb2RlfHwodGhpcy5oaWRlKCksdGhpcy4kZWxlbWVudD1udWxsLHRoaXMub3B0aW9ucz1udWxsKX0sYi5wcm90b3R5cGUuZW5hYmxlPWZ1bmN0aW9uKCl7dGhpcy5lbmFibGVkPSEwfSxiLnByb3RvdHlwZS5kaXNhYmxlPWZ1bmN0aW9uKCl7dGhpcy5lbmFibGVkPSExfSxiLnByb3RvdHlwZS50b2dnbGVFbmFibGVkPWZ1bmN0aW9uKCl7dGhpcy5lbmFibGVkPSF0aGlzLmVuYWJsZWR9LGIucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbihiKXt2YXIgYz1iP2EoYi5jdXJyZW50VGFyZ2V0KVt0aGlzLnR5cGVdKHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpLmRhdGEoImJzLiIrdGhpcy50eXBlKTp0aGlzO2MudGlwKCkuaGFzQ2xhc3MoImluIik/Yy5sZWF2ZShjKTpjLmVudGVyKGMpfSxiLnByb3RvdHlwZS5kZXN0cm95PWZ1bmN0aW9uKCl7Y2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCksdGhpcy5oaWRlKCkuJGVsZW1lbnQub2ZmKCIuIit0aGlzLnR5cGUpLnJlbW92ZURhdGEoImJzLiIrdGhpcy50eXBlKX07dmFyIGM9YS5mbi50b29sdGlwO2EuZm4udG9vbHRpcD1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMudG9vbHRpcCIpLGY9Im9iamVjdCI9PXR5cGVvZiBjJiZjOyhlfHwiZGVzdHJveSIhPWMpJiYoZXx8ZC5kYXRhKCJicy50b29sdGlwIixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpKX0pfSxhLmZuLnRvb2x0aXAuQ29uc3RydWN0b3I9YixhLmZuLnRvb2x0aXAubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLnRvb2x0aXA9Yyx0aGlzfX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYSxiKXt0aGlzLmluaXQoInBvcG92ZXIiLGEsYil9O2lmKCFhLmZuLnRvb2x0aXApdGhyb3cgbmV3IEVycm9yKCJQb3BvdmVyIHJlcXVpcmVzIHRvb2x0aXAuanMiKTtiLkRFRkFVTFRTPWEuZXh0ZW5kKHt9LGEuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvci5ERUZBVUxUUyx7cGxhY2VtZW50OiJyaWdodCIsdHJpZ2dlcjoiY2xpY2siLGNvbnRlbnQ6IiIsdGVtcGxhdGU6JzxkaXYgY2xhc3M9InBvcG92ZXIiPjxkaXYgY2xhc3M9ImFycm93Ij48L2Rpdj48aDMgY2xhc3M9InBvcG92ZXItdGl0bGUiPjwvaDM+PGRpdiBjbGFzcz0icG9wb3Zlci1jb250ZW50Ij48L2Rpdj48L2Rpdj4nfSksYi5wcm90b3R5cGU9YS5leHRlbmQoe30sYS5mbi50b29sdGlwLkNvbnN0cnVjdG9yLnByb3RvdHlwZSksYi5wcm90b3R5cGUuY29uc3RydWN0b3I9YixiLnByb3RvdHlwZS5nZXREZWZhdWx0cz1mdW5jdGlvbigpe3JldHVybiBiLkRFRkFVTFRTfSxiLnByb3RvdHlwZS5zZXRDb250ZW50PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy50aXAoKSxiPXRoaXMuZ2V0VGl0bGUoKSxjPXRoaXMuZ2V0Q29udGVudCgpO2EuZmluZCgiLnBvcG92ZXItdGl0bGUiKVt0aGlzLm9wdGlvbnMuaHRtbD8iaHRtbCI6InRleHQiXShiKSxhLmZpbmQoIi5wb3BvdmVyLWNvbnRlbnQiKVt0aGlzLm9wdGlvbnMuaHRtbD8ic3RyaW5nIj09dHlwZW9mIGM/Imh0bWwiOiJhcHBlbmQiOiJ0ZXh0Il0oYyksYS5yZW1vdmVDbGFzcygiZmFkZSB0b3AgYm90dG9tIGxlZnQgcmlnaHQgaW4iKSxhLmZpbmQoIi5wb3BvdmVyLXRpdGxlIikuaHRtbCgpfHxhLmZpbmQoIi5wb3BvdmVyLXRpdGxlIikuaGlkZSgpfSxiLnByb3RvdHlwZS5oYXNDb250ZW50PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0VGl0bGUoKXx8dGhpcy5nZXRDb250ZW50KCl9LGIucHJvdG90eXBlLmdldENvbnRlbnQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLiRlbGVtZW50LGI9dGhpcy5vcHRpb25zO3JldHVybiBhLmF0dHIoImRhdGEtY29udGVudCIpfHwoImZ1bmN0aW9uIj09dHlwZW9mIGIuY29udGVudD9iLmNvbnRlbnQuY2FsbChhWzBdKTpiLmNvbnRlbnQpfSxiLnByb3RvdHlwZS5hcnJvdz1mdW5jdGlvbigpe3JldHVybiB0aGlzLiRhcnJvdz10aGlzLiRhcnJvd3x8dGhpcy50aXAoKS5maW5kKCIuYXJyb3ciKX0sYi5wcm90b3R5cGUudGlwPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJHRpcHx8KHRoaXMuJHRpcD1hKHRoaXMub3B0aW9ucy50ZW1wbGF0ZSkpLHRoaXMuJHRpcH07dmFyIGM9YS5mbi5wb3BvdmVyO2EuZm4ucG9wb3Zlcj1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMucG9wb3ZlciIpLGY9Im9iamVjdCI9PXR5cGVvZiBjJiZjOyhlfHwiZGVzdHJveSIhPWMpJiYoZXx8ZC5kYXRhKCJicy5wb3BvdmVyIixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpKX0pfSxhLmZuLnBvcG92ZXIuQ29uc3RydWN0b3I9YixhLmZuLnBvcG92ZXIubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLnBvcG92ZXI9Yyx0aGlzfX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihjLGQpe3ZhciBlLGY9YS5wcm94eSh0aGlzLnByb2Nlc3MsdGhpcyk7dGhpcy4kZWxlbWVudD1hKGEoYykuaXMoImJvZHkiKT93aW5kb3c6YyksdGhpcy4kYm9keT1hKCJib2R5IiksdGhpcy4kc2Nyb2xsRWxlbWVudD10aGlzLiRlbGVtZW50Lm9uKCJzY3JvbGwuYnMuc2Nyb2xsLXNweS5kYXRhLWFwaSIsZiksdGhpcy5vcHRpb25zPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZCksdGhpcy5zZWxlY3Rvcj0odGhpcy5vcHRpb25zLnRhcmdldHx8KGU9YShjKS5hdHRyKCJocmVmIikpJiZlLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIil8fCIiKSsiIC5uYXYgbGkgPiBhIix0aGlzLm9mZnNldHM9YShbXSksdGhpcy50YXJnZXRzPWEoW10pLHRoaXMuYWN0aXZlVGFyZ2V0PW51bGwsdGhpcy5yZWZyZXNoKCksdGhpcy5wcm9jZXNzKCl9Yi5ERUZBVUxUUz17b2Zmc2V0OjEwfSxiLnByb3RvdHlwZS5yZWZyZXNoPWZ1bmN0aW9uKCl7dmFyIGI9dGhpcy4kZWxlbWVudFswXT09d2luZG93PyJvZmZzZXQiOiJwb3NpdGlvbiI7dGhpcy5vZmZzZXRzPWEoW10pLHRoaXMudGFyZ2V0cz1hKFtdKTt7dmFyIGM9dGhpczt0aGlzLiRib2R5LmZpbmQodGhpcy5zZWxlY3RvcikubWFwKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgidGFyZ2V0Iil8fGQuYXR0cigiaHJlZiIpLGY9L14jLi8udGVzdChlKSYmYShlKTtyZXR1cm4gZiYmZi5sZW5ndGgmJmYuaXMoIjp2aXNpYmxlIikmJltbZltiXSgpLnRvcCsoIWEuaXNXaW5kb3coYy4kc2Nyb2xsRWxlbWVudC5nZXQoMCkpJiZjLiRzY3JvbGxFbGVtZW50LnNjcm9sbFRvcCgpKSxlXV18fG51bGx9KS5zb3J0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIGFbMF0tYlswXX0pLmVhY2goZnVuY3Rpb24oKXtjLm9mZnNldHMucHVzaCh0aGlzWzBdKSxjLnRhcmdldHMucHVzaCh0aGlzWzFdKX0pfX0sYi5wcm90b3R5cGUucHJvY2Vzcz1mdW5jdGlvbigpe3ZhciBhLGI9dGhpcy4kc2Nyb2xsRWxlbWVudC5zY3JvbGxUb3AoKSt0aGlzLm9wdGlvbnMub2Zmc2V0LGM9dGhpcy4kc2Nyb2xsRWxlbWVudFswXS5zY3JvbGxIZWlnaHR8fHRoaXMuJGJvZHlbMF0uc2Nyb2xsSGVpZ2h0LGQ9Yy10aGlzLiRzY3JvbGxFbGVtZW50LmhlaWdodCgpLGU9dGhpcy5vZmZzZXRzLGY9dGhpcy50YXJnZXRzLGc9dGhpcy5hY3RpdmVUYXJnZXQ7aWYoYj49ZClyZXR1cm4gZyE9KGE9Zi5sYXN0KClbMF0pJiZ0aGlzLmFjdGl2YXRlKGEpO2lmKGcmJmI8PWVbMF0pcmV0dXJuIGchPShhPWZbMF0pJiZ0aGlzLmFjdGl2YXRlKGEpO2ZvcihhPWUubGVuZ3RoO2EtLTspZyE9ZlthXSYmYj49ZVthXSYmKCFlW2ErMV18fGI8PWVbYSsxXSkmJnRoaXMuYWN0aXZhdGUoZlthXSl9LGIucHJvdG90eXBlLmFjdGl2YXRlPWZ1bmN0aW9uKGIpe3RoaXMuYWN0aXZlVGFyZ2V0PWIsYSh0aGlzLnNlbGVjdG9yKS5wYXJlbnRzVW50aWwodGhpcy5vcHRpb25zLnRhcmdldCwiLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKTt2YXIgYz10aGlzLnNlbGVjdG9yKydbZGF0YS10YXJnZXQ9IicrYisnIl0sJyt0aGlzLnNlbGVjdG9yKydbaHJlZj0iJytiKyciXScsZD1hKGMpLnBhcmVudHMoImxpIikuYWRkQ2xhc3MoImFjdGl2ZSIpO2QucGFyZW50KCIuZHJvcGRvd24tbWVudSIpLmxlbmd0aCYmKGQ9ZC5jbG9zZXN0KCJsaS5kcm9wZG93biIpLmFkZENsYXNzKCJhY3RpdmUiKSksZC50cmlnZ2VyKCJhY3RpdmF0ZS5icy5zY3JvbGxzcHkiKX07dmFyIGM9YS5mbi5zY3JvbGxzcHk7YS5mbi5zY3JvbGxzcHk9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLnNjcm9sbHNweSIpLGY9Im9iamVjdCI9PXR5cGVvZiBjJiZjO2V8fGQuZGF0YSgiYnMuc2Nyb2xsc3B5IixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4uc2Nyb2xsc3B5LkNvbnN0cnVjdG9yPWIsYS5mbi5zY3JvbGxzcHkubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLnNjcm9sbHNweT1jLHRoaXN9LGEod2luZG93KS5vbigibG9hZCIsZnVuY3Rpb24oKXthKCdbZGF0YS1zcHk9InNjcm9sbCJdJykuZWFjaChmdW5jdGlvbigpe3ZhciBiPWEodGhpcyk7Yi5zY3JvbGxzcHkoYi5kYXRhKCkpfSl9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYil7dGhpcy5lbGVtZW50PWEoYil9O2IucHJvdG90eXBlLnNob3c9ZnVuY3Rpb24oKXt2YXIgYj10aGlzLmVsZW1lbnQsYz1iLmNsb3Nlc3QoInVsOm5vdCguZHJvcGRvd24tbWVudSkiKSxkPWIuZGF0YSgidGFyZ2V0Iik7aWYoZHx8KGQ9Yi5hdHRyKCJocmVmIiksZD1kJiZkLnJlcGxhY2UoLy4qKD89I1teXHNdKiQpLywiIikpLCFiLnBhcmVudCgibGkiKS5oYXNDbGFzcygiYWN0aXZlIikpe3ZhciBlPWMuZmluZCgiLmFjdGl2ZTpsYXN0IGEiKVswXSxmPWEuRXZlbnQoInNob3cuYnMudGFiIix7cmVsYXRlZFRhcmdldDplfSk7aWYoYi50cmlnZ2VyKGYpLCFmLmlzRGVmYXVsdFByZXZlbnRlZCgpKXt2YXIgZz1hKGQpO3RoaXMuYWN0aXZhdGUoYi5wYXJlbnQoImxpIiksYyksdGhpcy5hY3RpdmF0ZShnLGcucGFyZW50KCksZnVuY3Rpb24oKXtiLnRyaWdnZXIoe3R5cGU6InNob3duLmJzLnRhYiIscmVsYXRlZFRhcmdldDplfSl9KX19fSxiLnByb3RvdHlwZS5hY3RpdmF0ZT1mdW5jdGlvbihiLGMsZCl7ZnVuY3Rpb24gZSgpe2YucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpLmZpbmQoIj4gLmRyb3Bkb3duLW1lbnUgPiAuYWN0aXZlIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpLGIuYWRkQ2xhc3MoImFjdGl2ZSIpLGc/KGJbMF0ub2Zmc2V0V2lkdGgsYi5hZGRDbGFzcygiaW4iKSk6Yi5yZW1vdmVDbGFzcygiZmFkZSIpLGIucGFyZW50KCIuZHJvcGRvd24tbWVudSIpJiZiLmNsb3Nlc3QoImxpLmRyb3Bkb3duIikuYWRkQ2xhc3MoImFjdGl2ZSIpLGQmJmQoKX12YXIgZj1jLmZpbmQoIj4gLmFjdGl2ZSIpLGc9ZCYmYS5zdXBwb3J0LnRyYW5zaXRpb24mJmYuaGFzQ2xhc3MoImZhZGUiKTtnP2Yub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxlKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmUoKSxmLnJlbW92ZUNsYXNzKCJpbiIpfTt2YXIgYz1hLmZuLnRhYjthLmZuLnRhYj1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMudGFiIik7ZXx8ZC5kYXRhKCJicy50YWIiLGU9bmV3IGIodGhpcykpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4udGFiLkNvbnN0cnVjdG9yPWIsYS5mbi50YWIubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLnRhYj1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy50YWIuZGF0YS1hcGkiLCdbZGF0YS10b2dnbGU9InRhYiJdLCBbZGF0YS10b2dnbGU9InBpbGwiXScsZnVuY3Rpb24oYil7Yi5wcmV2ZW50RGVmYXVsdCgpLGEodGhpcykudGFiKCJzaG93Iil9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYyxkKXt0aGlzLm9wdGlvbnM9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkKSx0aGlzLiR3aW5kb3c9YSh3aW5kb3cpLm9uKCJzY3JvbGwuYnMuYWZmaXguZGF0YS1hcGkiLGEucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uLHRoaXMpKS5vbigiY2xpY2suYnMuYWZmaXguZGF0YS1hcGkiLGEucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uV2l0aEV2ZW50TG9vcCx0aGlzKSksdGhpcy4kZWxlbWVudD1hKGMpLHRoaXMuYWZmaXhlZD10aGlzLnVucGluPXRoaXMucGlubmVkT2Zmc2V0PW51bGwsdGhpcy5jaGVja1Bvc2l0aW9uKCl9O2IuUkVTRVQ9ImFmZml4IGFmZml4LXRvcCBhZmZpeC1ib3R0b20iLGIuREVGQVVMVFM9e29mZnNldDowfSxiLnByb3RvdHlwZS5nZXRQaW5uZWRPZmZzZXQ9ZnVuY3Rpb24oKXtpZih0aGlzLnBpbm5lZE9mZnNldClyZXR1cm4gdGhpcy5waW5uZWRPZmZzZXQ7dGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcyhiLlJFU0VUKS5hZGRDbGFzcygiYWZmaXgiKTt2YXIgYT10aGlzLiR3aW5kb3cuc2Nyb2xsVG9wKCksYz10aGlzLiRlbGVtZW50Lm9mZnNldCgpO3JldHVybiB0aGlzLnBpbm5lZE9mZnNldD1jLnRvcC1hfSxiLnByb3RvdHlwZS5jaGVja1Bvc2l0aW9uV2l0aEV2ZW50TG9vcD1mdW5jdGlvbigpe3NldFRpbWVvdXQoYS5wcm94eSh0aGlzLmNoZWNrUG9zaXRpb24sdGhpcyksMSl9LGIucHJvdG90eXBlLmNoZWNrUG9zaXRpb249ZnVuY3Rpb24oKXtpZih0aGlzLiRlbGVtZW50LmlzKCI6dmlzaWJsZSIpKXt2YXIgYz1hKGRvY3VtZW50KS5oZWlnaHQoKSxkPXRoaXMuJHdpbmRvdy5zY3JvbGxUb3AoKSxlPXRoaXMuJGVsZW1lbnQub2Zmc2V0KCksZj10aGlzLm9wdGlvbnMub2Zmc2V0LGc9Zi50b3AsaD1mLmJvdHRvbTsidG9wIj09dGhpcy5hZmZpeGVkJiYoZS50b3ArPWQpLCJvYmplY3QiIT10eXBlb2YgZiYmKGg9Zz1mKSwiZnVuY3Rpb24iPT10eXBlb2YgZyYmKGc9Zi50b3AodGhpcy4kZWxlbWVudCkpLCJmdW5jdGlvbiI9PXR5cGVvZiBoJiYoaD1mLmJvdHRvbSh0aGlzLiRlbGVtZW50KSk7dmFyIGk9bnVsbCE9dGhpcy51bnBpbiYmZCt0aGlzLnVucGluPD1lLnRvcD8hMTpudWxsIT1oJiZlLnRvcCt0aGlzLiRlbGVtZW50LmhlaWdodCgpPj1jLWg/ImJvdHRvbSI6bnVsbCE9ZyYmZz49ZD8idG9wIjohMTtpZih0aGlzLmFmZml4ZWQhPT1pKXt0aGlzLnVucGluJiZ0aGlzLiRlbGVtZW50LmNzcygidG9wIiwiIik7dmFyIGo9ImFmZml4IisoaT8iLSIraToiIiksaz1hLkV2ZW50KGorIi5icy5hZmZpeCIpO3RoaXMuJGVsZW1lbnQudHJpZ2dlcihrKSxrLmlzRGVmYXVsdFByZXZlbnRlZCgpfHwodGhpcy5hZmZpeGVkPWksdGhpcy51bnBpbj0iYm90dG9tIj09aT90aGlzLmdldFBpbm5lZE9mZnNldCgpOm51bGwsdGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcyhiLlJFU0VUKS5hZGRDbGFzcyhqKS50cmlnZ2VyKGEuRXZlbnQoai5yZXBsYWNlKCJhZmZpeCIsImFmZml4ZWQiKSkpLCJib3R0b20iPT1pJiZ0aGlzLiRlbGVtZW50Lm9mZnNldCh7dG9wOmMtaC10aGlzLiRlbGVtZW50LmhlaWdodCgpfSkpfX19O3ZhciBjPWEuZm4uYWZmaXg7YS5mbi5hZmZpeD1mdW5jdGlvbihjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMuYWZmaXgiKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYztlfHxkLmRhdGEoImJzLmFmZml4IixlPW5ldyBiKHRoaXMsZikpLCJzdHJpbmciPT10eXBlb2YgYyYmZVtjXSgpfSl9LGEuZm4uYWZmaXguQ29uc3RydWN0b3I9YixhLmZuLmFmZml4Lm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5hZmZpeD1jLHRoaXN9LGEod2luZG93KS5vbigibG9hZCIsZnVuY3Rpb24oKXthKCdbZGF0YS1zcHk9ImFmZml4Il0nKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKSxjPWIuZGF0YSgpO2Mub2Zmc2V0PWMub2Zmc2V0fHx7fSxjLm9mZnNldEJvdHRvbSYmKGMub2Zmc2V0LmJvdHRvbT1jLm9mZnNldEJvdHRvbSksYy5vZmZzZXRUb3AmJihjLm9mZnNldC50b3A9Yy5vZmZzZXRUb3ApLGIuYWZmaXgoYyl9KX0pfShqUXVlcnkpOwpkZWZpbmUoImJvb3RzdHJhcCIsIFsianF1ZXJ5Il0sIChmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBnbG9iYWwuYm9vdHN0cmFwOwogICAgfQp9KHRoaXMpKSk7CgovKiEKICogdHlwZWFoZWFkLmpzIDAuMTAuMgogKiBodHRwczovL2dpdGh1Yi5jb20vdHdpdHRlci90eXBlYWhlYWQuanMKICogQ29weXJpZ2h0IDIwMTMtMjAxNCBUd2l0dGVyLCBJbmMuIGFuZCBvdGhlciBjb250cmlidXRvcnM7IExpY2Vuc2VkIE1JVAogKi8KCihmdW5jdGlvbigkKSB7CiAgICB2YXIgXyA9IHsKICAgICAgICBpc01zaWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gLyhtc2llfHRyaWRlbnQpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSA/IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLyhtc2llIHxydjopKFxkKyguXGQrKT8pL2kpWzJdIDogZmFsc2U7CiAgICAgICAgfSwKICAgICAgICBpc0JsYW5rU3RyaW5nOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgcmV0dXJuICFzdHIgfHwgL15ccyokLy50ZXN0KHN0cik7CiAgICAgICAgfSwKICAgICAgICBlc2NhcGVSZWdFeENoYXJzOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bXC1cW1xdXC9ce1x9XChcKVwqXCtcP1wuXFxcXlwkXHxdL2csICJcXCQmIik7CiAgICAgICAgfSwKICAgICAgICBpc1N0cmluZzogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAic3RyaW5nIjsKICAgICAgICB9LAogICAgICAgIGlzTnVtYmVyOiBmdW5jdGlvbihvYmopIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJudW1iZXIiOwogICAgICAgIH0sCiAgICAgICAgaXNBcnJheTogJC5pc0FycmF5LAogICAgICAgIGlzRnVuY3Rpb246ICQuaXNGdW5jdGlvbiwKICAgICAgICBpc09iamVjdDogJC5pc1BsYWluT2JqZWN0LAogICAgICAgIGlzVW5kZWZpbmVkOiBmdW5jdGlvbihvYmopIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJ1bmRlZmluZWQiOwogICAgICAgIH0sCiAgICAgICAgYmluZDogJC5wcm94eSwKICAgICAgICBlYWNoOiBmdW5jdGlvbihjb2xsZWN0aW9uLCBjYikgewogICAgICAgICAgICAkLmVhY2goY29sbGVjdGlvbiwgcmV2ZXJzZUFyZ3MpOwogICAgICAgICAgICBmdW5jdGlvbiByZXZlcnNlQXJncyhpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYih2YWx1ZSwgaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBtYXA6ICQubWFwLAogICAgICAgIGZpbHRlcjogJC5ncmVwLAogICAgICAgIGV2ZXJ5OiBmdW5jdGlvbihvYmosIHRlc3QpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICAgICAgICAgIGlmICghb2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uKGtleSwgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoIShyZXN1bHQgPSB0ZXN0LmNhbGwobnVsbCwgdmFsLCBrZXksIG9iaikpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuICEhcmVzdWx0OwogICAgICAgIH0sCiAgICAgICAgc29tZTogZnVuY3Rpb24ob2JqLCB0ZXN0KSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKCFvYmopIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJC5lYWNoKG9iaiwgZnVuY3Rpb24oa2V5LCB2YWwpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPSB0ZXN0LmNhbGwobnVsbCwgdmFsLCBrZXksIG9iaikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gISFyZXN1bHQ7CiAgICAgICAgfSwKICAgICAgICBtaXhpbjogJC5leHRlbmQsCiAgICAgICAgZ2V0VW5pcXVlSWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgY291bnRlciA9IDA7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjb3VudGVyKys7CiAgICAgICAgICAgIH07CiAgICAgICAgfSgpLAogICAgICAgIHRlbXBsYXRpZnk6IGZ1bmN0aW9uIHRlbXBsYXRpZnkob2JqKSB7CiAgICAgICAgICAgIHJldHVybiAkLmlzRnVuY3Rpb24ob2JqKSA/IG9iaiA6IHRlbXBsYXRlOwogICAgICAgICAgICBmdW5jdGlvbiB0ZW1wbGF0ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcob2JqKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZGVmZXI6IGZ1bmN0aW9uKGZuKSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZm4sIDApOwogICAgICAgIH0sCiAgICAgICAgZGVib3VuY2U6IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgICAgICAgICB2YXIgdGltZW91dCwgcmVzdWx0OwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHMsIGxhdGVyLCBjYWxsTm93OwogICAgICAgICAgICAgICAgbGF0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoIWltbWVkaWF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0OwogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpOwogICAgICAgICAgICAgICAgaWYgKGNhbGxOb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIHRocm90dGxlOiBmdW5jdGlvbihmdW5jLCB3YWl0KSB7CiAgICAgICAgICAgIHZhciBjb250ZXh0LCBhcmdzLCB0aW1lb3V0LCByZXN1bHQsIHByZXZpb3VzLCBsYXRlcjsKICAgICAgICAgICAgcHJldmlvdXMgPSAwOwogICAgICAgICAgICBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcHJldmlvdXMgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKSwgcmVtYWluaW5nID0gd2FpdCAtIChub3cgLSBwcmV2aW91cyk7CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gdGhpczsKICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXMgPSBub3c7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQpIHsKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBub29wOiBmdW5jdGlvbigpIHt9CiAgICB9OwogICAgdmFyIGh0bWwgPSB7CiAgICAgICAgd3JhcHBlcjogJzxzcGFuIGNsYXNzPSJ0d2l0dGVyLXR5cGVhaGVhZCI+PC9zcGFuPicsCiAgICAgICAgZHJvcGRvd246ICc8c3BhbiBjbGFzcz0idHQtZHJvcGRvd24tbWVudSI+PC9zcGFuPicsCiAgICAgICAgZGF0YXNldDogJzxkaXYgY2xhc3M9InR0LWRhdGFzZXQtJUNMQVNTJSI+PC9kaXY+JywKICAgICAgICBzdWdnZXN0aW9uczogJzxzcGFuIGNsYXNzPSJ0dC1zdWdnZXN0aW9ucyI+PC9zcGFuPicsCiAgICAgICAgc3VnZ2VzdGlvbjogJzxkaXYgY2xhc3M9InR0LXN1Z2dlc3Rpb24iPjwvZGl2PicKICAgIH07CiAgICB2YXIgY3NzID0gewogICAgICAgIHdyYXBwZXI6IHsKICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUtYmxvY2siCiAgICAgICAgfSwKICAgICAgICBoaW50OiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICB0b3A6ICIwIiwKICAgICAgICAgICAgbGVmdDogIjAiLAogICAgICAgICAgICBib3JkZXJDb2xvcjogInRyYW5zcGFyZW50IiwKICAgICAgICAgICAgYm94U2hhZG93OiAibm9uZSIKICAgICAgICB9LAogICAgICAgIGlucHV0OiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAidG9wIiwKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAidHJhbnNwYXJlbnQiCiAgICAgICAgfSwKICAgICAgICBpbnB1dFdpdGhOb0hpbnQ6IHsKICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICJ0b3AiCiAgICAgICAgfSwKICAgICAgICBkcm9wZG93bjogewogICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgdG9wOiAiMTAwJSIsCiAgICAgICAgICAgIGxlZnQ6ICIwIiwKICAgICAgICAgICAgekluZGV4OiAiMTAwIiwKICAgICAgICAgICAgZGlzcGxheTogIm5vbmUiCiAgICAgICAgfSwKICAgICAgICBzdWdnZXN0aW9uczogewogICAgICAgICAgICBkaXNwbGF5OiAiYmxvY2siCiAgICAgICAgfSwKICAgICAgICBzdWdnZXN0aW9uOiB7CiAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJub3dyYXAiLAogICAgICAgICAgICBjdXJzb3I6ICJwb2ludGVyIgogICAgICAgIH0sCiAgICAgICAgc3VnZ2VzdGlvbkNoaWxkOiB7CiAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJub3JtYWwiCiAgICAgICAgfSwKICAgICAgICBsdHI6IHsKICAgICAgICAgICAgbGVmdDogIjAiLAogICAgICAgICAgICByaWdodDogImF1dG8iCiAgICAgICAgfSwKICAgICAgICBydGw6IHsKICAgICAgICAgICAgbGVmdDogImF1dG8iLAogICAgICAgICAgICByaWdodDogIiAwIgogICAgICAgIH0KICAgIH07CiAgICBpZiAoXy5pc01zaWUoKSkgewogICAgICAgIF8ubWl4aW4oY3NzLmlucHV0LCB7CiAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogInVybChkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUlBQUFBQUFBUC8vL3lINUJBRUFBQUFBTEFBQUFBQUJBQUVBQUFJQlJBQTcpIgogICAgICAgIH0pOwogICAgfQogICAgaWYgKF8uaXNNc2llKCkgJiYgXy5pc01zaWUoKSA8PSA3KSB7CiAgICAgICAgXy5taXhpbihjc3MuaW5wdXQsIHsKICAgICAgICAgICAgbWFyZ2luVG9wOiAiLTFweCIKICAgICAgICB9KTsKICAgIH0KICAgIHZhciBFdmVudEJ1cyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBuYW1lc3BhY2UgPSAidHlwZWFoZWFkOiI7CiAgICAgICAgZnVuY3Rpb24gRXZlbnRCdXMobykgewogICAgICAgICAgICBpZiAoIW8gfHwgIW8uZWwpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoIkV2ZW50QnVzIGluaXRpYWxpemVkIHdpdGhvdXQgZWwiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiRlbCA9ICQoby5lbCk7CiAgICAgICAgfQogICAgICAgIF8ubWl4aW4oRXZlbnRCdXMucHJvdG90eXBlLCB7CiAgICAgICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwudHJpZ2dlcihuYW1lc3BhY2UgKyB0eXBlLCBhcmdzKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBFdmVudEJ1czsKICAgIH0oKTsKICAgIHZhciBFdmVudEVtaXR0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc3BsaXR0ZXIgPSAvXHMrLywgbmV4dFRpY2sgPSBnZXROZXh0VGljaygpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9uU3luYzogb25TeW5jLAogICAgICAgICAgICBvbkFzeW5jOiBvbkFzeW5jLAogICAgICAgICAgICBvZmY6IG9mZiwKICAgICAgICAgICAgdHJpZ2dlcjogdHJpZ2dlcgogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gb24obWV0aG9kLCB0eXBlcywgY2IsIGNvbnRleHQpIHsKICAgICAgICAgICAgdmFyIHR5cGU7CiAgICAgICAgICAgIGlmICghY2IpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGVzID0gdHlwZXMuc3BsaXQoc3BsaXR0ZXIpOwogICAgICAgICAgICBjYiA9IGNvbnRleHQgPyBiaW5kQ29udGV4dChjYiwgY29udGV4dCkgOiBjYjsKICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzIHx8IHt9OwogICAgICAgICAgICB3aGlsZSAodHlwZSA9IHR5cGVzLnNoaWZ0KCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrc1t0eXBlXSA9IHRoaXMuX2NhbGxiYWNrc1t0eXBlXSB8fCB7CiAgICAgICAgICAgICAgICAgICAgc3luYzogW10sCiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IFtdCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tzW3R5cGVdW21ldGhvZF0ucHVzaChjYik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9uQXN5bmModHlwZXMsIGNiLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBvbi5jYWxsKHRoaXMsICJhc3luYyIsIHR5cGVzLCBjYiwgY29udGV4dCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9uU3luYyh0eXBlcywgY2IsIGNvbnRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIG9uLmNhbGwodGhpcywgInN5bmMiLCB0eXBlcywgY2IsIGNvbnRleHQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvZmYodHlwZXMpIHsKICAgICAgICAgICAgdmFyIHR5cGU7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlcyA9IHR5cGVzLnNwbGl0KHNwbGl0dGVyKTsKICAgICAgICAgICAgd2hpbGUgKHR5cGUgPSB0eXBlcy5zaGlmdCgpKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fY2FsbGJhY2tzW3R5cGVdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0cmlnZ2VyKHR5cGVzKSB7CiAgICAgICAgICAgIHZhciB0eXBlLCBjYWxsYmFja3MsIGFyZ3MsIHN5bmNGbHVzaCwgYXN5bmNGbHVzaDsKICAgICAgICAgICAgaWYgKCF0aGlzLl9jYWxsYmFja3MpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGVzID0gdHlwZXMuc3BsaXQoc3BsaXR0ZXIpOwogICAgICAgICAgICBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICAgICAgICB3aGlsZSAoKHR5cGUgPSB0eXBlcy5zaGlmdCgpKSAmJiAoY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzW3R5cGVdKSkgewogICAgICAgICAgICAgICAgc3luY0ZsdXNoID0gZ2V0Rmx1c2goY2FsbGJhY2tzLnN5bmMsIHRoaXMsIFsgdHlwZSBdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgICAgICAgICBhc3luY0ZsdXNoID0gZ2V0Rmx1c2goY2FsbGJhY2tzLmFzeW5jLCB0aGlzLCBbIHR5cGUgXS5jb25jYXQoYXJncykpOwogICAgICAgICAgICAgICAgc3luY0ZsdXNoKCkgJiYgbmV4dFRpY2soYXN5bmNGbHVzaCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldEZsdXNoKGNhbGxiYWNrcywgY29udGV4dCwgYXJncykgewogICAgICAgICAgICByZXR1cm4gZmx1c2g7CiAgICAgICAgICAgIGZ1bmN0aW9uIGZsdXNoKCkgewogICAgICAgICAgICAgICAgdmFyIGNhbmNlbGxlZDsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyAhY2FuY2VsbGVkICYmIGkgPCBjYWxsYmFja3MubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBjYW5jZWxsZWQgPSBjYWxsYmFja3NbaV0uYXBwbHkoY29udGV4dCwgYXJncykgPT09IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICFjYW5jZWxsZWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ2V0TmV4dFRpY2soKSB7CiAgICAgICAgICAgIHZhciBuZXh0VGlja0ZuOwogICAgICAgICAgICBpZiAod2luZG93LnNldEltbWVkaWF0ZSkgewogICAgICAgICAgICAgICAgbmV4dFRpY2tGbiA9IGZ1bmN0aW9uIG5leHRUaWNrU2V0SW1tZWRpYXRlKGZuKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0SW1tZWRpYXRlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmbigpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHRUaWNrRm4gPSBmdW5jdGlvbiBuZXh0VGlja1NldFRpbWVvdXQoZm4pIHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmbigpOwogICAgICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV4dFRpY2tGbjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmluZENvbnRleHQoZm4sIGNvbnRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIGZuLmJpbmQgPyBmbi5iaW5kKGNvbnRleHQpIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmbi5hcHBseShjb250ZXh0LCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCkpOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBoaWdobGlnaHQgPSBmdW5jdGlvbihkb2MpIHsKICAgICAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgICAgIG5vZGU6IG51bGwsCiAgICAgICAgICAgIHBhdHRlcm46IG51bGwsCiAgICAgICAgICAgIHRhZ05hbWU6ICJzdHJvbmciLAogICAgICAgICAgICBjbGFzc05hbWU6IG51bGwsCiAgICAgICAgICAgIHdvcmRzT25seTogZmFsc2UsCiAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gaGlnaHRsaWdodChvKSB7CiAgICAgICAgICAgIHZhciByZWdleDsKICAgICAgICAgICAgbyA9IF8ubWl4aW4oe30sIGRlZmF1bHRzLCBvKTsKICAgICAgICAgICAgaWYgKCFvLm5vZGUgfHwgIW8ucGF0dGVybikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG8ucGF0dGVybiA9IF8uaXNBcnJheShvLnBhdHRlcm4pID8gby5wYXR0ZXJuIDogWyBvLnBhdHRlcm4gXTsKICAgICAgICAgICAgcmVnZXggPSBnZXRSZWdleChvLnBhdHRlcm4sIG8uY2FzZVNlbnNpdGl2ZSwgby53b3Jkc09ubHkpOwogICAgICAgICAgICB0cmF2ZXJzZShvLm5vZGUsIGhpZ2h0bGlnaHRUZXh0Tm9kZSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGhpZ2h0bGlnaHRUZXh0Tm9kZSh0ZXh0Tm9kZSkgewogICAgICAgICAgICAgICAgdmFyIG1hdGNoLCBwYXR0ZXJuTm9kZTsKICAgICAgICAgICAgICAgIGlmIChtYXRjaCA9IHJlZ2V4LmV4ZWModGV4dE5vZGUuZGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICB3cmFwcGVyTm9kZSA9IGRvYy5jcmVhdGVFbGVtZW50KG8udGFnTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgby5jbGFzc05hbWUgJiYgKHdyYXBwZXJOb2RlLmNsYXNzTmFtZSA9IG8uY2xhc3NOYW1lKTsKICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuTm9kZSA9IHRleHROb2RlLnNwbGl0VGV4dChtYXRjaC5pbmRleCk7CiAgICAgICAgICAgICAgICAgICAgcGF0dGVybk5vZGUuc3BsaXRUZXh0KG1hdGNoWzBdLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgd3JhcHBlck5vZGUuYXBwZW5kQ2hpbGQocGF0dGVybk5vZGUuY2xvbmVOb2RlKHRydWUpKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0Tm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCh3cmFwcGVyTm9kZSwgcGF0dGVybk5vZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICEhbWF0Y2g7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdHJhdmVyc2UoZWwsIGhpZ2h0bGlnaHRUZXh0Tm9kZSkgewogICAgICAgICAgICAgICAgdmFyIGNoaWxkTm9kZSwgVEVYVF9OT0RFX1RZUEUgPSAzOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbC5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGROb2RlID0gZWwuY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGROb2RlLm5vZGVUeXBlID09PSBURVhUX05PREVfVFlQRSkgewogICAgICAgICAgICAgICAgICAgICAgICBpICs9IGhpZ2h0bGlnaHRUZXh0Tm9kZShjaGlsZE5vZGUpID8gMSA6IDA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJhdmVyc2UoY2hpbGROb2RlLCBoaWdodGxpZ2h0VGV4dE5vZGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gZ2V0UmVnZXgocGF0dGVybnMsIGNhc2VTZW5zaXRpdmUsIHdvcmRzT25seSkgewogICAgICAgICAgICB2YXIgZXNjYXBlZFBhdHRlcm5zID0gW10sIHJlZ2V4U3RyOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdHRlcm5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBlc2NhcGVkUGF0dGVybnMucHVzaChfLmVzY2FwZVJlZ0V4Q2hhcnMocGF0dGVybnNbaV0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWdleFN0ciA9IHdvcmRzT25seSA/ICJcXGIoIiArIGVzY2FwZWRQYXR0ZXJucy5qb2luKCJ8IikgKyAiKVxcYiIgOiAiKCIgKyBlc2NhcGVkUGF0dGVybnMuam9pbigifCIpICsgIikiOwogICAgICAgICAgICByZXR1cm4gY2FzZVNlbnNpdGl2ZSA/IG5ldyBSZWdFeHAocmVnZXhTdHIpIDogbmV3IFJlZ0V4cChyZWdleFN0ciwgImkiKTsKICAgICAgICB9CiAgICB9KHdpbmRvdy5kb2N1bWVudCk7CiAgICB2YXIgSW5wdXQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc3BlY2lhbEtleUNvZGVNYXA7CiAgICAgICAgc3BlY2lhbEtleUNvZGVNYXAgPSB7CiAgICAgICAgICAgIDk6ICJ0YWIiLAogICAgICAgICAgICAyNzogImVzYyIsCiAgICAgICAgICAgIDM3OiAibGVmdCIsCiAgICAgICAgICAgIDM5OiAicmlnaHQiLAogICAgICAgICAgICAxMzogImVudGVyIiwKICAgICAgICAgICAgMzg6ICJ1cCIsCiAgICAgICAgICAgIDQwOiAiZG93biIKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIElucHV0KG8pIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvbkJsdXIsIG9uRm9jdXMsIG9uS2V5ZG93biwgb25JbnB1dDsKICAgICAgICAgICAgbyA9IG8gfHwge307CiAgICAgICAgICAgIGlmICghby5pbnB1dCkgewogICAgICAgICAgICAgICAgJC5lcnJvcigiaW5wdXQgaXMgbWlzc2luZyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9uQmx1ciA9IF8uYmluZCh0aGlzLl9vbkJsdXIsIHRoaXMpOwogICAgICAgICAgICBvbkZvY3VzID0gXy5iaW5kKHRoaXMuX29uRm9jdXMsIHRoaXMpOwogICAgICAgICAgICBvbktleWRvd24gPSBfLmJpbmQodGhpcy5fb25LZXlkb3duLCB0aGlzKTsKICAgICAgICAgICAgb25JbnB1dCA9IF8uYmluZCh0aGlzLl9vbklucHV0LCB0aGlzKTsKICAgICAgICAgICAgdGhpcy4kaGludCA9ICQoby5oaW50KTsKICAgICAgICAgICAgdGhpcy4kaW5wdXQgPSAkKG8uaW5wdXQpLm9uKCJibHVyLnR0Iiwgb25CbHVyKS5vbigiZm9jdXMudHQiLCBvbkZvY3VzKS5vbigia2V5ZG93bi50dCIsIG9uS2V5ZG93bik7CiAgICAgICAgICAgIGlmICh0aGlzLiRoaW50Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRIaW50ID0gdGhpcy5nZXRIaW50ID0gdGhpcy5jbGVhckhpbnQgPSB0aGlzLmNsZWFySGludElmSW52YWxpZCA9IF8ubm9vcDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIV8uaXNNc2llKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCJpbnB1dC50dCIsIG9uSW5wdXQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQub24oImtleWRvd24udHQga2V5cHJlc3MudHQgY3V0LnR0IHBhc3RlLnR0IiwgZnVuY3Rpb24oJGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3BlY2lhbEtleUNvZGVNYXBbJGUud2hpY2ggfHwgJGUua2V5Q29kZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfLmRlZmVyKF8uYmluZCh0aGF0Ll9vbklucHV0LCB0aGF0LCAkZSkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHRoaXMuJGlucHV0LnZhbCgpOwogICAgICAgICAgICB0aGlzLiRvdmVyZmxvd0hlbHBlciA9IGJ1aWxkT3ZlcmZsb3dIZWxwZXIodGhpcy4kaW5wdXQpOwogICAgICAgIH0KICAgICAgICBJbnB1dC5ub3JtYWxpemVRdWVyeSA9IGZ1bmN0aW9uKHN0cikgewogICAgICAgICAgICByZXR1cm4gKHN0ciB8fCAiIikucmVwbGFjZSgvXlxzKi9nLCAiIikucmVwbGFjZSgvXHN7Mix9L2csICIgIik7CiAgICAgICAgfTsKICAgICAgICBfLm1peGluKElucHV0LnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9vbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImJsdXJyZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRm9jdXM6IGZ1bmN0aW9uIG9uRm9jdXMoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImZvY3VzZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uS2V5ZG93bjogZnVuY3Rpb24gb25LZXlkb3duKCRlKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5TmFtZSA9IHNwZWNpYWxLZXlDb2RlTWFwWyRlLndoaWNoIHx8ICRlLmtleUNvZGVdOwogICAgICAgICAgICAgICAgdGhpcy5fbWFuYWdlUHJldmVudERlZmF1bHQoa2V5TmFtZSwgJGUpOwogICAgICAgICAgICAgICAgaWYgKGtleU5hbWUgJiYgdGhpcy5fc2hvdWxkVHJpZ2dlcihrZXlOYW1lLCAkZSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoa2V5TmFtZSArICJLZXllZCIsICRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uSW5wdXQ6IGZ1bmN0aW9uIG9uSW5wdXQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsdWUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX21hbmFnZVByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiBtYW5hZ2VQcmV2ZW50RGVmYXVsdChrZXlOYW1lLCAkZSkgewogICAgICAgICAgICAgICAgdmFyIHByZXZlbnREZWZhdWx0LCBoaW50VmFsdWUsIGlucHV0VmFsdWU7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtleU5hbWUpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAidGFiIjoKICAgICAgICAgICAgICAgICAgICBoaW50VmFsdWUgPSB0aGlzLmdldEhpbnQoKTsKICAgICAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSBoaW50VmFsdWUgJiYgaGludFZhbHVlICE9PSBpbnB1dFZhbHVlICYmICF3aXRoTW9kaWZpZXIoJGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAidXAiOgogICAgICAgICAgICAgICAgICBjYXNlICJkb3duIjoKICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdCA9ICF3aXRoTW9kaWZpZXIoJGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgJiYgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3Nob3VsZFRyaWdnZXI6IGZ1bmN0aW9uIHNob3VsZFRyaWdnZXIoa2V5TmFtZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciB0cmlnZ2VyOwogICAgICAgICAgICAgICAgc3dpdGNoIChrZXlOYW1lKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgInRhYiI6CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlciA9ICF3aXRoTW9kaWZpZXIoJGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cmlnZ2VyOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfY2hlY2tJbnB1dFZhbHVlOiBmdW5jdGlvbiBjaGVja0lucHV0VmFsdWUoKSB7CiAgICAgICAgICAgICAgICB2YXIgaW5wdXRWYWx1ZSwgYXJlRXF1aXZhbGVudCwgaGFzRGlmZmVyZW50V2hpdGVzcGFjZTsKICAgICAgICAgICAgICAgIGlucHV0VmFsdWUgPSB0aGlzLmdldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGFyZUVxdWl2YWxlbnQgPSBhcmVRdWVyaWVzRXF1aXZhbGVudChpbnB1dFZhbHVlLCB0aGlzLnF1ZXJ5KTsKICAgICAgICAgICAgICAgIGhhc0RpZmZlcmVudFdoaXRlc3BhY2UgPSBhcmVFcXVpdmFsZW50ID8gdGhpcy5xdWVyeS5sZW5ndGggIT09IGlucHV0VmFsdWUubGVuZ3RoIDogZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIWFyZUVxdWl2YWxlbnQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoInF1ZXJ5Q2hhbmdlZCIsIHRoaXMucXVlcnkgPSBpbnB1dFZhbHVlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzRGlmZmVyZW50V2hpdGVzcGFjZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigid2hpdGVzcGFjZUNoYW5nZWQiLCB0aGlzLnF1ZXJ5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uIGZvY3VzKCkgewogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYmx1cjogZnVuY3Rpb24gYmx1cigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LmJsdXIoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0UXVlcnk6IGZ1bmN0aW9uIGdldFF1ZXJ5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVlcnk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldFF1ZXJ5OiBmdW5jdGlvbiBzZXRRdWVyeShxdWVyeSkgewogICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5OwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRJbnB1dFZhbHVlOiBmdW5jdGlvbiBnZXRJbnB1dFZhbHVlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGlucHV0LnZhbCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRJbnB1dFZhbHVlOiBmdW5jdGlvbiBzZXRJbnB1dFZhbHVlKHZhbHVlLCBzaWxlbnQpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LnZhbCh2YWx1ZSk7CiAgICAgICAgICAgICAgICBzaWxlbnQgPyB0aGlzLmNsZWFySGludCgpIDogdGhpcy5fY2hlY2tJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlc2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gcmVzZXRJbnB1dFZhbHVlKCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRJbnB1dFZhbHVlKHRoaXMucXVlcnksIHRydWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRIaW50OiBmdW5jdGlvbiBnZXRIaW50KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGhpbnQudmFsKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldEhpbnQ6IGZ1bmN0aW9uIHNldEhpbnQodmFsdWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGhpbnQudmFsKHZhbHVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xlYXJIaW50OiBmdW5jdGlvbiBjbGVhckhpbnQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldEhpbnQoIiIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGVhckhpbnRJZkludmFsaWQ6IGZ1bmN0aW9uIGNsZWFySGludElmSW52YWxpZCgpIHsKICAgICAgICAgICAgICAgIHZhciB2YWwsIGhpbnQsIHZhbElzUHJlZml4T2ZIaW50LCBpc1ZhbGlkOwogICAgICAgICAgICAgICAgdmFsID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICBoaW50ID0gdGhpcy5nZXRIaW50KCk7CiAgICAgICAgICAgICAgICB2YWxJc1ByZWZpeE9mSGludCA9IHZhbCAhPT0gaGludCAmJiBoaW50LmluZGV4T2YodmFsKSA9PT0gMDsKICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgIT09ICIiICYmIHZhbElzUHJlZml4T2ZIaW50ICYmICF0aGlzLmhhc092ZXJmbG93KCk7CiAgICAgICAgICAgICAgICAhaXNWYWxpZCAmJiB0aGlzLmNsZWFySGludCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRMYW5ndWFnZURpcmVjdGlvbjogZnVuY3Rpb24gZ2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHRoaXMuJGlucHV0LmNzcygiZGlyZWN0aW9uIikgfHwgImx0ciIpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhhc092ZXJmbG93OiBmdW5jdGlvbiBoYXNPdmVyZmxvdygpIHsKICAgICAgICAgICAgICAgIHZhciBjb25zdHJhaW50ID0gdGhpcy4kaW5wdXQud2lkdGgoKSAtIDI7CiAgICAgICAgICAgICAgICB0aGlzLiRvdmVyZmxvd0hlbHBlci50ZXh0KHRoaXMuZ2V0SW5wdXRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRvdmVyZmxvd0hlbHBlci53aWR0aCgpID49IGNvbnN0cmFpbnQ7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzQ3Vyc29yQXRFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlTGVuZ3RoLCBzZWxlY3Rpb25TdGFydCwgcmFuZ2U7CiAgICAgICAgICAgICAgICB2YWx1ZUxlbmd0aCA9IHRoaXMuJGlucHV0LnZhbCgpLmxlbmd0aDsKICAgICAgICAgICAgICAgIHNlbGVjdGlvblN0YXJ0ID0gdGhpcy4kaW5wdXRbMF0uc2VsZWN0aW9uU3RhcnQ7CiAgICAgICAgICAgICAgICBpZiAoXy5pc051bWJlcihzZWxlY3Rpb25TdGFydCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0aW9uU3RhcnQgPT09IHZhbHVlTGVuZ3RoOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICByYW5nZSA9IGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpOwogICAgICAgICAgICAgICAgICAgIHJhbmdlLm1vdmVTdGFydCgiY2hhcmFjdGVyIiwgLXZhbHVlTGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVMZW5ndGggPT09IHJhbmdlLnRleHQubGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRoaW50Lm9mZigiLnR0Iik7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5vZmYoIi50dCIpOwogICAgICAgICAgICAgICAgdGhpcy4kaGludCA9IHRoaXMuJGlucHV0ID0gdGhpcy4kb3ZlcmZsb3dIZWxwZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIElucHV0OwogICAgICAgIGZ1bmN0aW9uIGJ1aWxkT3ZlcmZsb3dIZWxwZXIoJGlucHV0KSB7CiAgICAgICAgICAgIHJldHVybiAkKCc8cHJlIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3ByZT4nKS5jc3MoewogICAgICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiAiaGlkZGVuIiwKICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJwcmUiLAogICAgICAgICAgICAgICAgZm9udEZhbWlseTogJGlucHV0LmNzcygiZm9udC1mYW1pbHkiKSwKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAkaW5wdXQuY3NzKCJmb250LXNpemUiKSwKICAgICAgICAgICAgICAgIGZvbnRTdHlsZTogJGlucHV0LmNzcygiZm9udC1zdHlsZSIpLAogICAgICAgICAgICAgICAgZm9udFZhcmlhbnQ6ICRpbnB1dC5jc3MoImZvbnQtdmFyaWFudCIpLAogICAgICAgICAgICAgICAgZm9udFdlaWdodDogJGlucHV0LmNzcygiZm9udC13ZWlnaHQiKSwKICAgICAgICAgICAgICAgIHdvcmRTcGFjaW5nOiAkaW5wdXQuY3NzKCJ3b3JkLXNwYWNpbmciKSwKICAgICAgICAgICAgICAgIGxldHRlclNwYWNpbmc6ICRpbnB1dC5jc3MoImxldHRlci1zcGFjaW5nIiksCiAgICAgICAgICAgICAgICB0ZXh0SW5kZW50OiAkaW5wdXQuY3NzKCJ0ZXh0LWluZGVudCIpLAogICAgICAgICAgICAgICAgdGV4dFJlbmRlcmluZzogJGlucHV0LmNzcygidGV4dC1yZW5kZXJpbmciKSwKICAgICAgICAgICAgICAgIHRleHRUcmFuc2Zvcm06ICRpbnB1dC5jc3MoInRleHQtdHJhbnNmb3JtIikKICAgICAgICAgICAgfSkuaW5zZXJ0QWZ0ZXIoJGlucHV0KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYXJlUXVlcmllc0VxdWl2YWxlbnQoYSwgYikgewogICAgICAgICAgICByZXR1cm4gSW5wdXQubm9ybWFsaXplUXVlcnkoYSkgPT09IElucHV0Lm5vcm1hbGl6ZVF1ZXJ5KGIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB3aXRoTW9kaWZpZXIoJGUpIHsKICAgICAgICAgICAgcmV0dXJuICRlLmFsdEtleSB8fCAkZS5jdHJsS2V5IHx8ICRlLm1ldGFLZXkgfHwgJGUuc2hpZnRLZXk7CiAgICAgICAgfQogICAgfSgpOwogICAgdmFyIERhdGFzZXQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZGF0YXNldEtleSA9ICJ0dERhdGFzZXQiLCB2YWx1ZUtleSA9ICJ0dFZhbHVlIiwgZGF0dW1LZXkgPSAidHREYXR1bSI7CiAgICAgICAgZnVuY3Rpb24gRGF0YXNldChvKSB7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBvLnRlbXBsYXRlcyA9IG8udGVtcGxhdGVzIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8uc291cmNlKSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJtaXNzaW5nIHNvdXJjZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvLm5hbWUgJiYgIWlzVmFsaWROYW1lKG8ubmFtZSkpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoImludmFsaWQgZGF0YXNldCBuYW1lOiAiICsgby5uYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5oaWdobGlnaHQgPSAhIW8uaGlnaGxpZ2h0OwogICAgICAgICAgICB0aGlzLm5hbWUgPSBvLm5hbWUgfHwgXy5nZXRVbmlxdWVJZCgpOwogICAgICAgICAgICB0aGlzLnNvdXJjZSA9IG8uc291cmNlOwogICAgICAgICAgICB0aGlzLmRpc3BsYXlGbiA9IGdldERpc3BsYXlGbihvLmRpc3BsYXkgfHwgby5kaXNwbGF5S2V5KTsKICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZXMgPSBnZXRUZW1wbGF0ZXMoby50ZW1wbGF0ZXMsIHRoaXMuZGlzcGxheUZuKTsKICAgICAgICAgICAgdGhpcy4kZWwgPSAkKGh0bWwuZGF0YXNldC5yZXBsYWNlKCIlQ0xBU1MlIiwgdGhpcy5uYW1lKSk7CiAgICAgICAgfQogICAgICAgIERhdGFzZXQuZXh0cmFjdERhdGFzZXROYW1lID0gZnVuY3Rpb24gZXh0cmFjdERhdGFzZXROYW1lKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKGRhdGFzZXRLZXkpOwogICAgICAgIH07CiAgICAgICAgRGF0YXNldC5leHRyYWN0VmFsdWUgPSBmdW5jdGlvbiBleHRyYWN0RGF0dW0oZWwpIHsKICAgICAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEodmFsdWVLZXkpOwogICAgICAgIH07CiAgICAgICAgRGF0YXNldC5leHRyYWN0RGF0dW0gPSBmdW5jdGlvbiBleHRyYWN0RGF0dW0oZWwpIHsKICAgICAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEoZGF0dW1LZXkpOwogICAgICAgIH07CiAgICAgICAgXy5taXhpbihEYXRhc2V0LnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9yZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihxdWVyeSwgc3VnZ2VzdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy4kZWwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGhhc1N1Z2dlc3Rpb25zOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZW1wdHkoKTsKICAgICAgICAgICAgICAgIGhhc1N1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnMgJiYgc3VnZ2VzdGlvbnMubGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKCFoYXNTdWdnZXN0aW9ucyAmJiB0aGlzLnRlbXBsYXRlcy5lbXB0eSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoZ2V0RW1wdHlIdG1sKCkpLnByZXBlbmQodGhhdC50ZW1wbGF0ZXMuaGVhZGVyID8gZ2V0SGVhZGVySHRtbCgpIDogbnVsbCkuYXBwZW5kKHRoYXQudGVtcGxhdGVzLmZvb3RlciA/IGdldEZvb3Rlckh0bWwoKSA6IG51bGwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNTdWdnZXN0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoZ2V0U3VnZ2VzdGlvbnNIdG1sKCkpLnByZXBlbmQodGhhdC50ZW1wbGF0ZXMuaGVhZGVyID8gZ2V0SGVhZGVySHRtbCgpIDogbnVsbCkuYXBwZW5kKHRoYXQudGVtcGxhdGVzLmZvb3RlciA/IGdldEZvb3Rlckh0bWwoKSA6IG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJyZW5kZXJlZCIpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RW1wdHlIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGF0LnRlbXBsYXRlcy5lbXB0eSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbXB0eTogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U3VnZ2VzdGlvbnNIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkc3VnZ2VzdGlvbnMsIG5vZGVzOwogICAgICAgICAgICAgICAgICAgICRzdWdnZXN0aW9ucyA9ICQoaHRtbC5zdWdnZXN0aW9ucykuY3NzKGNzcy5zdWdnZXN0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgbm9kZXMgPSBfLm1hcChzdWdnZXN0aW9ucywgZ2V0U3VnZ2VzdGlvbk5vZGUpOwogICAgICAgICAgICAgICAgICAgICRzdWdnZXN0aW9ucy5hcHBlbmQuYXBwbHkoJHN1Z2dlc3Rpb25zLCBub2Rlcyk7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5oaWdobGlnaHQgJiYgaGlnaGxpZ2h0KHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogJHN1Z2dlc3Rpb25zWzBdLAogICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuOiBxdWVyeQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3VnZ2VzdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U3VnZ2VzdGlvbk5vZGUoc3VnZ2VzdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGVsOwogICAgICAgICAgICAgICAgICAgICAgICAkZWwgPSAkKGh0bWwuc3VnZ2VzdGlvbikuYXBwZW5kKHRoYXQudGVtcGxhdGVzLnN1Z2dlc3Rpb24oc3VnZ2VzdGlvbikpLmRhdGEoZGF0YXNldEtleSwgdGhhdC5uYW1lKS5kYXRhKHZhbHVlS2V5LCB0aGF0LmRpc3BsYXlGbihzdWdnZXN0aW9uKSkuZGF0YShkYXR1bUtleSwgc3VnZ2VzdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICRlbC5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhjc3Muc3VnZ2VzdGlvbkNoaWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZWw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0SGVhZGVySHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC50ZW1wbGF0ZXMuaGVhZGVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICBpc0VtcHR5OiAhaGFzU3VnZ2VzdGlvbnMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZvb3Rlckh0bWwoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQudGVtcGxhdGVzLmZvb3Rlcih7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbXB0eTogIWhhc1N1Z2dlc3Rpb25zCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFJvb3Q6IGZ1bmN0aW9uIGdldFJvb3QoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZWw7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gcXVlcnk7CiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZShxdWVyeSwgcmVuZGVyKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlcihzdWdnZXN0aW9ucykgewogICAgICAgICAgICAgICAgICAgIGlmICghdGhhdC5jYW5jZWxlZCAmJiBxdWVyeSA9PT0gdGhhdC5xdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9yZW5kZXIocXVlcnksIHN1Z2dlc3Rpb25zKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24gY2FuY2VsKCkgewogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxlZCA9IHRydWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsZWFyOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5lbXB0eSgpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJyZW5kZXJlZCIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0VtcHR5OiBmdW5jdGlvbiBpc0VtcHR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsLmlzKCI6ZW1wdHkiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBEYXRhc2V0OwogICAgICAgIGZ1bmN0aW9uIGdldERpc3BsYXlGbihkaXNwbGF5KSB7CiAgICAgICAgICAgIGRpc3BsYXkgPSBkaXNwbGF5IHx8ICJ2YWx1ZSI7CiAgICAgICAgICAgIHJldHVybiBfLmlzRnVuY3Rpb24oZGlzcGxheSkgPyBkaXNwbGF5IDogZGlzcGxheUZuOwogICAgICAgICAgICBmdW5jdGlvbiBkaXNwbGF5Rm4ob2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JqW2Rpc3BsYXldOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldFRlbXBsYXRlcyh0ZW1wbGF0ZXMsIGRpc3BsYXlGbikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgZW1wdHk6IHRlbXBsYXRlcy5lbXB0eSAmJiBfLnRlbXBsYXRpZnkodGVtcGxhdGVzLmVtcHR5KSwKICAgICAgICAgICAgICAgIGhlYWRlcjogdGVtcGxhdGVzLmhlYWRlciAmJiBfLnRlbXBsYXRpZnkodGVtcGxhdGVzLmhlYWRlciksCiAgICAgICAgICAgICAgICBmb290ZXI6IHRlbXBsYXRlcy5mb290ZXIgJiYgXy50ZW1wbGF0aWZ5KHRlbXBsYXRlcy5mb290ZXIpLAogICAgICAgICAgICAgICAgc3VnZ2VzdGlvbjogdGVtcGxhdGVzLnN1Z2dlc3Rpb24gfHwgc3VnZ2VzdGlvblRlbXBsYXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGZ1bmN0aW9uIHN1Z2dlc3Rpb25UZW1wbGF0ZShjb250ZXh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIjxwPiIgKyBkaXNwbGF5Rm4oY29udGV4dCkgKyAiPC9wPiI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNWYWxpZE5hbWUoc3RyKSB7CiAgICAgICAgICAgIHJldHVybiAvXltfYS16QS1aMC05LV0rJC8udGVzdChzdHIpOwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBEcm9wZG93biA9IGZ1bmN0aW9uKCkgewogICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duKG8pIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvblN1Z2dlc3Rpb25DbGljaywgb25TdWdnZXN0aW9uTW91c2VFbnRlciwgb25TdWdnZXN0aW9uTW91c2VMZWF2ZTsKICAgICAgICAgICAgbyA9IG8gfHwge307CiAgICAgICAgICAgIGlmICghby5tZW51KSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJtZW51IGlzIHJlcXVpcmVkIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5kYXRhc2V0cyA9IF8ubWFwKG8uZGF0YXNldHMsIGluaXRpYWxpemVEYXRhc2V0KTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uQ2xpY2sgPSBfLmJpbmQodGhpcy5fb25TdWdnZXN0aW9uQ2xpY2ssIHRoaXMpOwogICAgICAgICAgICBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyID0gXy5iaW5kKHRoaXMuX29uU3VnZ2VzdGlvbk1vdXNlRW50ZXIsIHRoaXMpOwogICAgICAgICAgICBvblN1Z2dlc3Rpb25Nb3VzZUxlYXZlID0gXy5iaW5kKHRoaXMuX29uU3VnZ2VzdGlvbk1vdXNlTGVhdmUsIHRoaXMpOwogICAgICAgICAgICB0aGlzLiRtZW51ID0gJChvLm1lbnUpLm9uKCJjbGljay50dCIsICIudHQtc3VnZ2VzdGlvbiIsIG9uU3VnZ2VzdGlvbkNsaWNrKS5vbigibW91c2VlbnRlci50dCIsICIudHQtc3VnZ2VzdGlvbiIsIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIpLm9uKCJtb3VzZWxlYXZlLnR0IiwgIi50dC1zdWdnZXN0aW9uIiwgb25TdWdnZXN0aW9uTW91c2VMZWF2ZSk7CiAgICAgICAgICAgIF8uZWFjaCh0aGlzLmRhdGFzZXRzLCBmdW5jdGlvbihkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICB0aGF0LiRtZW51LmFwcGVuZChkYXRhc2V0LmdldFJvb3QoKSk7CiAgICAgICAgICAgICAgICBkYXRhc2V0Lm9uU3luYygicmVuZGVyZWQiLCB0aGF0Ll9vblJlbmRlcmVkLCB0aGF0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIF8ubWl4aW4oRHJvcGRvd24ucHJvdG90eXBlLCBFdmVudEVtaXR0ZXIsIHsKICAgICAgICAgICAgX29uU3VnZ2VzdGlvbkNsaWNrOiBmdW5jdGlvbiBvblN1Z2dlc3Rpb25DbGljaygkZSkgewogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJzdWdnZXN0aW9uQ2xpY2tlZCIsICQoJGUuY3VycmVudFRhcmdldCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25TdWdnZXN0aW9uTW91c2VFbnRlcjogZnVuY3Rpb24gb25TdWdnZXN0aW9uTW91c2VFbnRlcigkZSkgewogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRDdXJzb3IoJCgkZS5jdXJyZW50VGFyZ2V0KSwgdHJ1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25Nb3VzZUxlYXZlOiBmdW5jdGlvbiBvblN1Z2dlc3Rpb25Nb3VzZUxlYXZlKCkgewogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3Vyc29yKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblJlbmRlcmVkOiBmdW5jdGlvbiBvblJlbmRlcmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID0gXy5ldmVyeSh0aGlzLmRhdGFzZXRzLCBpc0RhdGFzZXRFbXB0eSk7CiAgICAgICAgICAgICAgICB0aGlzLmlzRW1wdHkgPyB0aGlzLl9oaWRlKCkgOiB0aGlzLmlzT3BlbiAmJiB0aGlzLl9zaG93KCk7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImRhdGFzZXRSZW5kZXJlZCIpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gaXNEYXRhc2V0RW1wdHkoZGF0YXNldCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2V0LmlzRW1wdHkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2hpZGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy4kbWVudS5oaWRlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zaG93OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUuY3NzKCJkaXNwbGF5IiwgImJsb2NrIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9nZXRTdWdnZXN0aW9uczogZnVuY3Rpb24gZ2V0U3VnZ2VzdGlvbnMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVudS5maW5kKCIudHQtc3VnZ2VzdGlvbiIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfZ2V0Q3Vyc29yOiBmdW5jdGlvbiBnZXRDdXJzb3IoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVudS5maW5kKCIudHQtY3Vyc29yIikuZmlyc3QoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3NldEN1cnNvcjogZnVuY3Rpb24gc2V0Q3Vyc29yKCRlbCwgc2lsZW50KSB7CiAgICAgICAgICAgICAgICAkZWwuZmlyc3QoKS5hZGRDbGFzcygidHQtY3Vyc29yIik7CiAgICAgICAgICAgICAgICAhc2lsZW50ICYmIHRoaXMudHJpZ2dlcigiY3Vyc29yTW92ZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3JlbW92ZUN1cnNvcjogZnVuY3Rpb24gcmVtb3ZlQ3Vyc29yKCkgewogICAgICAgICAgICAgICAgdGhpcy5fZ2V0Q3Vyc29yKCkucmVtb3ZlQ2xhc3MoInR0LWN1cnNvciIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfbW92ZUN1cnNvcjogZnVuY3Rpb24gbW92ZUN1cnNvcihpbmNyZW1lbnQpIHsKICAgICAgICAgICAgICAgIHZhciAkc3VnZ2VzdGlvbnMsICRvbGRDdXJzb3IsIG5ld0N1cnNvckluZGV4LCAkbmV3Q3Vyc29yOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzT3BlbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRvbGRDdXJzb3IgPSB0aGlzLl9nZXRDdXJzb3IoKTsKICAgICAgICAgICAgICAgICRzdWdnZXN0aW9ucyA9IHRoaXMuX2dldFN1Z2dlc3Rpb25zKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDdXJzb3IoKTsKICAgICAgICAgICAgICAgIG5ld0N1cnNvckluZGV4ID0gJHN1Z2dlc3Rpb25zLmluZGV4KCRvbGRDdXJzb3IpICsgaW5jcmVtZW50OwogICAgICAgICAgICAgICAgbmV3Q3Vyc29ySW5kZXggPSAobmV3Q3Vyc29ySW5kZXggKyAxKSAlICgkc3VnZ2VzdGlvbnMubGVuZ3RoICsgMSkgLSAxOwogICAgICAgICAgICAgICAgaWYgKG5ld0N1cnNvckluZGV4ID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigiY3Vyc29yUmVtb3ZlZCIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3Q3Vyc29ySW5kZXggPCAtMSkgewogICAgICAgICAgICAgICAgICAgIG5ld0N1cnNvckluZGV4ID0gJHN1Z2dlc3Rpb25zLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRDdXJzb3IoJG5ld0N1cnNvciA9ICRzdWdnZXN0aW9ucy5lcShuZXdDdXJzb3JJbmRleCkpOwogICAgICAgICAgICAgICAgdGhpcy5fZW5zdXJlVmlzaWJsZSgkbmV3Q3Vyc29yKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2Vuc3VyZVZpc2libGU6IGZ1bmN0aW9uIGVuc3VyZVZpc2libGUoJGVsKSB7CiAgICAgICAgICAgICAgICB2YXIgZWxUb3AsIGVsQm90dG9tLCBtZW51U2Nyb2xsVG9wLCBtZW51SGVpZ2h0OwogICAgICAgICAgICAgICAgZWxUb3AgPSAkZWwucG9zaXRpb24oKS50b3A7CiAgICAgICAgICAgICAgICBlbEJvdHRvbSA9IGVsVG9wICsgJGVsLm91dGVySGVpZ2h0KHRydWUpOwogICAgICAgICAgICAgICAgbWVudVNjcm9sbFRvcCA9IHRoaXMuJG1lbnUuc2Nyb2xsVG9wKCk7CiAgICAgICAgICAgICAgICBtZW51SGVpZ2h0ID0gdGhpcy4kbWVudS5oZWlnaHQoKSArIHBhcnNlSW50KHRoaXMuJG1lbnUuY3NzKCJwYWRkaW5nVG9wIiksIDEwKSArIHBhcnNlSW50KHRoaXMuJG1lbnUuY3NzKCJwYWRkaW5nQm90dG9tIiksIDEwKTsKICAgICAgICAgICAgICAgIGlmIChlbFRvcCA8IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZW51LnNjcm9sbFRvcChtZW51U2Nyb2xsVG9wICsgZWxUb3ApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZW51SGVpZ2h0IDwgZWxCb3R0b20pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZW51LnNjcm9sbFRvcChtZW51U2Nyb2xsVG9wICsgKGVsQm90dG9tIC0gbWVudUhlaWdodCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpZGUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImNsb3NlZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzT3BlbikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAhdGhpcy5pc0VtcHR5ICYmIHRoaXMuX3Nob3coKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoIm9wZW5lZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRMYW5ndWFnZURpcmVjdGlvbjogZnVuY3Rpb24gc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oZGlyKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZW51LmNzcyhkaXIgPT09ICJsdHIiID8gY3NzLmx0ciA6IGNzcy5ydGwpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBtb3ZlQ3Vyc29yVXA6IGZ1bmN0aW9uIG1vdmVDdXJzb3JVcCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX21vdmVDdXJzb3IoLTEpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBtb3ZlQ3Vyc29yRG93bjogZnVuY3Rpb24gbW92ZUN1cnNvckRvd24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlQ3Vyc29yKCsxKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uOiBmdW5jdGlvbiBnZXREYXR1bUZvclN1Z2dlc3Rpb24oJGVsKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW0gPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKCRlbC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBkYXR1bSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmF3OiBEYXRhc2V0LmV4dHJhY3REYXR1bSgkZWwpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogRGF0YXNldC5leHRyYWN0VmFsdWUoJGVsKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNldE5hbWU6IERhdGFzZXQuZXh0cmFjdERhdGFzZXROYW1lKCRlbCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdHVtOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXREYXR1bUZvckN1cnNvcjogZnVuY3Rpb24gZ2V0RGF0dW1Gb3JDdXJzb3IoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXREYXR1bUZvclN1Z2dlc3Rpb24odGhpcy5fZ2V0Q3Vyc29yKCkuZmlyc3QoKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbjogZnVuY3Rpb24gZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKHRoaXMuX2dldFN1Z2dlc3Rpb25zKCkuZmlyc3QoKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgdXBkYXRlRGF0YXNldCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVEYXRhc2V0KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LnVwZGF0ZShxdWVyeSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVtcHR5OiBmdW5jdGlvbiBlbXB0eSgpIHsKICAgICAgICAgICAgICAgIF8uZWFjaCh0aGlzLmRhdGFzZXRzLCBjbGVhckRhdGFzZXQpOwogICAgICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNsZWFyRGF0YXNldChkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YXNldC5jbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBpc1Zpc2libGU6IGZ1bmN0aW9uIGlzVmlzaWJsZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzT3BlbiAmJiAhdGhpcy5pc0VtcHR5OwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgICAgdGhpcy4kbWVudS5vZmYoIi50dCIpOwogICAgICAgICAgICAgICAgdGhpcy4kbWVudSA9IG51bGw7CiAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgZGVzdHJveURhdGFzZXQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gZGVzdHJveURhdGFzZXQoZGF0YXNldCkgewogICAgICAgICAgICAgICAgICAgIGRhdGFzZXQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIERyb3Bkb3duOwogICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemVEYXRhc2V0KG9EYXRhc2V0KSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0YXNldChvRGF0YXNldCk7CiAgICAgICAgfQogICAgfSgpOwogICAgdmFyIFR5cGVhaGVhZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhdHRyc0tleSA9ICJ0dEF0dHJzIjsKICAgICAgICBmdW5jdGlvbiBUeXBlYWhlYWQobykgewogICAgICAgICAgICB2YXIgJG1lbnUsICRpbnB1dCwgJGhpbnQ7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8uaW5wdXQpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoIm1pc3NpbmcgaW5wdXQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmlzQWN0aXZhdGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuYXV0b3NlbGVjdCA9ICEhby5hdXRvc2VsZWN0OwogICAgICAgICAgICB0aGlzLm1pbkxlbmd0aCA9IF8uaXNOdW1iZXIoby5taW5MZW5ndGgpID8gby5taW5MZW5ndGggOiAxOwogICAgICAgICAgICB0aGlzLiRub2RlID0gYnVpbGREb21TdHJ1Y3R1cmUoby5pbnB1dCwgby53aXRoSGludCk7CiAgICAgICAgICAgICRtZW51ID0gdGhpcy4kbm9kZS5maW5kKCIudHQtZHJvcGRvd24tbWVudSIpOwogICAgICAgICAgICAkaW5wdXQgPSB0aGlzLiRub2RlLmZpbmQoIi50dC1pbnB1dCIpOwogICAgICAgICAgICAkaGludCA9IHRoaXMuJG5vZGUuZmluZCgiLnR0LWhpbnQiKTsKICAgICAgICAgICAgJGlucHV0Lm9uKCJibHVyLnR0IiwgZnVuY3Rpb24oJGUpIHsKICAgICAgICAgICAgICAgIHZhciBhY3RpdmUsIGlzQWN0aXZlLCBoYXNBY3RpdmU7CiAgICAgICAgICAgICAgICBhY3RpdmUgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OwogICAgICAgICAgICAgICAgaXNBY3RpdmUgPSAkbWVudS5pcyhhY3RpdmUpOwogICAgICAgICAgICAgICAgaGFzQWN0aXZlID0gJG1lbnUuaGFzKGFjdGl2ZSkubGVuZ3RoID4gMDsKICAgICAgICAgICAgICAgIGlmIChfLmlzTXNpZSgpICYmIChpc0FjdGl2ZSB8fCBoYXNBY3RpdmUpKSB7CiAgICAgICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAkZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRtZW51Lm9uKCJtb3VzZWRvd24udHQiLCBmdW5jdGlvbigkZSkgewogICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMgPSBvLmV2ZW50QnVzIHx8IG5ldyBFdmVudEJ1cyh7CiAgICAgICAgICAgICAgICBlbDogJGlucHV0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmRyb3Bkb3duID0gbmV3IERyb3Bkb3duKHsKICAgICAgICAgICAgICAgIG1lbnU6ICRtZW51LAogICAgICAgICAgICAgICAgZGF0YXNldHM6IG8uZGF0YXNldHMKICAgICAgICAgICAgfSkub25TeW5jKCJzdWdnZXN0aW9uQ2xpY2tlZCIsIHRoaXMuX29uU3VnZ2VzdGlvbkNsaWNrZWQsIHRoaXMpLm9uU3luYygiY3Vyc29yTW92ZWQiLCB0aGlzLl9vbkN1cnNvck1vdmVkLCB0aGlzKS5vblN5bmMoImN1cnNvclJlbW92ZWQiLCB0aGlzLl9vbkN1cnNvclJlbW92ZWQsIHRoaXMpLm9uU3luYygib3BlbmVkIiwgdGhpcy5fb25PcGVuZWQsIHRoaXMpLm9uU3luYygiY2xvc2VkIiwgdGhpcy5fb25DbG9zZWQsIHRoaXMpLm9uQXN5bmMoImRhdGFzZXRSZW5kZXJlZCIsIHRoaXMuX29uRGF0YXNldFJlbmRlcmVkLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5pbnB1dCA9IG5ldyBJbnB1dCh7CiAgICAgICAgICAgICAgICBpbnB1dDogJGlucHV0LAogICAgICAgICAgICAgICAgaGludDogJGhpbnQKICAgICAgICAgICAgfSkub25TeW5jKCJmb2N1c2VkIiwgdGhpcy5fb25Gb2N1c2VkLCB0aGlzKS5vblN5bmMoImJsdXJyZWQiLCB0aGlzLl9vbkJsdXJyZWQsIHRoaXMpLm9uU3luYygiZW50ZXJLZXllZCIsIHRoaXMuX29uRW50ZXJLZXllZCwgdGhpcykub25TeW5jKCJ0YWJLZXllZCIsIHRoaXMuX29uVGFiS2V5ZWQsIHRoaXMpLm9uU3luYygiZXNjS2V5ZWQiLCB0aGlzLl9vbkVzY0tleWVkLCB0aGlzKS5vblN5bmMoInVwS2V5ZWQiLCB0aGlzLl9vblVwS2V5ZWQsIHRoaXMpLm9uU3luYygiZG93bktleWVkIiwgdGhpcy5fb25Eb3duS2V5ZWQsIHRoaXMpLm9uU3luYygibGVmdEtleWVkIiwgdGhpcy5fb25MZWZ0S2V5ZWQsIHRoaXMpLm9uU3luYygicmlnaHRLZXllZCIsIHRoaXMuX29uUmlnaHRLZXllZCwgdGhpcykub25TeW5jKCJxdWVyeUNoYW5nZWQiLCB0aGlzLl9vblF1ZXJ5Q2hhbmdlZCwgdGhpcykub25TeW5jKCJ3aGl0ZXNwYWNlQ2hhbmdlZCIsIHRoaXMuX29uV2hpdGVzcGFjZUNoYW5nZWQsIHRoaXMpOwogICAgICAgICAgICB0aGlzLl9zZXRMYW5ndWFnZURpcmVjdGlvbigpOwogICAgICAgIH0KICAgICAgICBfLm1peGluKFR5cGVhaGVhZC5wcm90b3R5cGUsIHsKICAgICAgICAgICAgX29uU3VnZ2VzdGlvbkNsaWNrZWQ6IGZ1bmN0aW9uIG9uU3VnZ2VzdGlvbkNsaWNrZWQodHlwZSwgJGVsKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW07CiAgICAgICAgICAgICAgICBpZiAoZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yU3VnZ2VzdGlvbigkZWwpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0KGRhdHVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uQ3Vyc29yTW92ZWQ6IGZ1bmN0aW9uIG9uQ3Vyc29yTW92ZWQoKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldElucHV0VmFsdWUoZGF0dW0udmFsdWUsIHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJjdXJzb3JjaGFuZ2VkIiwgZGF0dW0ucmF3LCBkYXR1bS5kYXRhc2V0TmFtZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkN1cnNvclJlbW92ZWQ6IGZ1bmN0aW9uIG9uQ3Vyc29yUmVtb3ZlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQucmVzZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIaW50KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkRhdGFzZXRSZW5kZXJlZDogZnVuY3Rpb24gb25EYXRhc2V0UmVuZGVyZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIaW50KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbk9wZW5lZDogZnVuY3Rpb24gb25PcGVuZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIaW50KCk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoIm9wZW5lZCIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25DbG9zZWQ6IGZ1bmN0aW9uIG9uQ2xvc2VkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5jbGVhckhpbnQoKTsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigiY2xvc2VkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkZvY3VzZWQ6IGZ1bmN0aW9uIG9uRm9jdXNlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNBY3RpdmF0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkJsdXJyZWQ6IGZ1bmN0aW9uIG9uQmx1cnJlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNBY3RpdmF0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uZW1wdHkoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uY2xvc2UoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRW50ZXJLZXllZDogZnVuY3Rpb24gb25FbnRlcktleWVkKHR5cGUsICRlKSB7CiAgICAgICAgICAgICAgICB2YXIgY3Vyc29yRGF0dW0sIHRvcFN1Z2dlc3Rpb25EYXR1bTsKICAgICAgICAgICAgICAgIGN1cnNvckRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvckN1cnNvcigpOwogICAgICAgICAgICAgICAgdG9wU3VnZ2VzdGlvbkRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclRvcFN1Z2dlc3Rpb24oKTsKICAgICAgICAgICAgICAgIGlmIChjdXJzb3JEYXR1bSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdChjdXJzb3JEYXR1bSk7CiAgICAgICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hdXRvc2VsZWN0ICYmIHRvcFN1Z2dlc3Rpb25EYXR1bSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdCh0b3BTdWdnZXN0aW9uRGF0dW0pOwogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblRhYktleWVkOiBmdW5jdGlvbiBvblRhYktleWVkKHR5cGUsICRlKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW07CiAgICAgICAgICAgICAgICBpZiAoZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yQ3Vyc29yKCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QoZGF0dW0pOwogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2F1dG9jb21wbGV0ZSh0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRXNjS2V5ZWQ6IGZ1bmN0aW9uIG9uRXNjS2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnJlc2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25VcEtleWVkOiBmdW5jdGlvbiBvblVwS2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLmlucHV0LmdldFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmlzRW1wdHkgJiYgcXVlcnkubGVuZ3RoID49IHRoaXMubWluTGVuZ3RoID8gdGhpcy5kcm9wZG93bi51cGRhdGUocXVlcnkpIDogdGhpcy5kcm9wZG93bi5tb3ZlQ3Vyc29yVXAoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25Eb3duS2V5ZWQ6IGZ1bmN0aW9uIG9uRG93bktleWVkKCkgewogICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5pbnB1dC5nZXRRdWVyeSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5pc0VtcHR5ICYmIHF1ZXJ5Lmxlbmd0aCA+PSB0aGlzLm1pbkxlbmd0aCA/IHRoaXMuZHJvcGRvd24udXBkYXRlKHF1ZXJ5KSA6IHRoaXMuZHJvcGRvd24ubW92ZUN1cnNvckRvd24oKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25MZWZ0S2V5ZWQ6IGZ1bmN0aW9uIG9uTGVmdEtleWVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5kaXIgPT09ICJydGwiICYmIHRoaXMuX2F1dG9jb21wbGV0ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25SaWdodEtleWVkOiBmdW5jdGlvbiBvblJpZ2h0S2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRpciA9PT0gImx0ciIgJiYgdGhpcy5fYXV0b2NvbXBsZXRlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblF1ZXJ5Q2hhbmdlZDogZnVuY3Rpb24gb25RdWVyeUNoYW5nZWQoZSwgcXVlcnkpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuY2xlYXJIaW50SWZJbnZhbGlkKCk7CiAgICAgICAgICAgICAgICBxdWVyeS5sZW5ndGggPj0gdGhpcy5taW5MZW5ndGggPyB0aGlzLmRyb3Bkb3duLnVwZGF0ZShxdWVyeSkgOiB0aGlzLmRyb3Bkb3duLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbldoaXRlc3BhY2VDaGFuZ2VkOiBmdW5jdGlvbiBvbldoaXRlc3BhY2VDaGFuZ2VkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zZXRMYW5ndWFnZURpcmVjdGlvbjogZnVuY3Rpb24gc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgZGlyOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyICE9PSAoZGlyID0gdGhpcy5pbnB1dC5nZXRMYW5ndWFnZURpcmVjdGlvbigpKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGlyID0gZGlyOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJG5vZGUuY3NzKCJkaXJlY3Rpb24iLCBkaXIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oZGlyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3VwZGF0ZUhpbnQ6IGZ1bmN0aW9uIHVwZGF0ZUhpbnQoKSB7CiAgICAgICAgICAgICAgICB2YXIgZGF0dW0sIHZhbCwgcXVlcnksIGVzY2FwZWRRdWVyeSwgZnJvbnRNYXRjaFJlZ0V4LCBtYXRjaDsKICAgICAgICAgICAgICAgIGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclRvcFN1Z2dlc3Rpb24oKTsKICAgICAgICAgICAgICAgIGlmIChkYXR1bSAmJiB0aGlzLmRyb3Bkb3duLmlzVmlzaWJsZSgpICYmICF0aGlzLmlucHV0Lmhhc092ZXJmbG93KCkpIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSB0aGlzLmlucHV0LmdldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICBxdWVyeSA9IElucHV0Lm5vcm1hbGl6ZVF1ZXJ5KHZhbCk7CiAgICAgICAgICAgICAgICAgICAgZXNjYXBlZFF1ZXJ5ID0gXy5lc2NhcGVSZWdFeENoYXJzKHF1ZXJ5KTsKICAgICAgICAgICAgICAgICAgICBmcm9udE1hdGNoUmVnRXggPSBuZXcgUmVnRXhwKCJeKD86IiArIGVzY2FwZWRRdWVyeSArICIpKC4rJCkiLCAiaSIpOwogICAgICAgICAgICAgICAgICAgIG1hdGNoID0gZnJvbnRNYXRjaFJlZ0V4LmV4ZWMoZGF0dW0udmFsdWUpOwogICAgICAgICAgICAgICAgICAgIG1hdGNoID8gdGhpcy5pbnB1dC5zZXRIaW50KHZhbCArIG1hdGNoWzFdKSA6IHRoaXMuaW5wdXQuY2xlYXJIaW50KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuY2xlYXJIaW50KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9hdXRvY29tcGxldGU6IGZ1bmN0aW9uIGF1dG9jb21wbGV0ZShsYXhDdXJzb3IpIHsKICAgICAgICAgICAgICAgIHZhciBoaW50LCBxdWVyeSwgaXNDdXJzb3JBdEVuZCwgZGF0dW07CiAgICAgICAgICAgICAgICBoaW50ID0gdGhpcy5pbnB1dC5nZXRIaW50KCk7CiAgICAgICAgICAgICAgICBxdWVyeSA9IHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgICAgIGlzQ3Vyc29yQXRFbmQgPSBsYXhDdXJzb3IgfHwgdGhpcy5pbnB1dC5pc0N1cnNvckF0RW5kKCk7CiAgICAgICAgICAgICAgICBpZiAoaGludCAmJiBxdWVyeSAhPT0gaGludCAmJiBpc0N1cnNvckF0RW5kKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpOwogICAgICAgICAgICAgICAgICAgIGRhdHVtICYmIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZShkYXR1bS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJhdXRvY29tcGxldGVkIiwgZGF0dW0ucmF3LCBkYXR1bS5kYXRhc2V0TmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zZWxlY3Q6IGZ1bmN0aW9uIHNlbGVjdChkYXR1bSkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRRdWVyeShkYXR1bS52YWx1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldElucHV0VmFsdWUoZGF0dW0udmFsdWUsIHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKTsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigic2VsZWN0ZWQiLCBkYXR1bS5yYXcsIGRhdHVtLmRhdGFzZXROYW1lKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uY2xvc2UoKTsKICAgICAgICAgICAgICAgIF8uZGVmZXIoXy5iaW5kKHRoaXMuZHJvcGRvd24uZW1wdHksIHRoaXMuZHJvcGRvd24pKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldFZhbDogZnVuY3Rpb24gc2V0VmFsKHZhbCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNBY3RpdmF0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldElucHV0VmFsdWUodmFsKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRRdWVyeSh2YWwpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZSh2YWwsIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0VmFsOiBmdW5jdGlvbiBnZXRWYWwoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbnB1dC5nZXRRdWVyeSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIGRlc3Ryb3lEb21TdHJ1Y3R1cmUodGhpcy4kbm9kZSk7CiAgICAgICAgICAgICAgICB0aGlzLiRub2RlID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBUeXBlYWhlYWQ7CiAgICAgICAgZnVuY3Rpb24gYnVpbGREb21TdHJ1Y3R1cmUoaW5wdXQsIHdpdGhIaW50KSB7CiAgICAgICAgICAgIHZhciAkaW5wdXQsICR3cmFwcGVyLCAkZHJvcGRvd24sICRoaW50OwogICAgICAgICAgICAkaW5wdXQgPSAkKGlucHV0KTsKICAgICAgICAgICAgJHdyYXBwZXIgPSAkKGh0bWwud3JhcHBlcikuY3NzKGNzcy53cmFwcGVyKTsKICAgICAgICAgICAgJGRyb3Bkb3duID0gJChodG1sLmRyb3Bkb3duKS5jc3MoY3NzLmRyb3Bkb3duKTsKICAgICAgICAgICAgJGhpbnQgPSAkaW5wdXQuY2xvbmUoKS5jc3MoY3NzLmhpbnQpLmNzcyhnZXRCYWNrZ3JvdW5kU3R5bGVzKCRpbnB1dCkpOwogICAgICAgICAgICAkaGludC52YWwoIiIpLnJlbW92ZURhdGEoKS5hZGRDbGFzcygidHQtaGludCIpLnJlbW92ZUF0dHIoImlkIG5hbWUgcGxhY2Vob2xkZXIiKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpLmF0dHIoewogICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlOiAib2ZmIiwKICAgICAgICAgICAgICAgIHNwZWxsY2hlY2s6ICJmYWxzZSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRpbnB1dC5kYXRhKGF0dHJzS2V5LCB7CiAgICAgICAgICAgICAgICBkaXI6ICRpbnB1dC5hdHRyKCJkaXIiKSwKICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogJGlucHV0LmF0dHIoImF1dG9jb21wbGV0ZSIpLAogICAgICAgICAgICAgICAgc3BlbGxjaGVjazogJGlucHV0LmF0dHIoInNwZWxsY2hlY2siKSwKICAgICAgICAgICAgICAgIHN0eWxlOiAkaW5wdXQuYXR0cigic3R5bGUiKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGlucHV0LmFkZENsYXNzKCJ0dC1pbnB1dCIpLmF0dHIoewogICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlOiAib2ZmIiwKICAgICAgICAgICAgICAgIHNwZWxsY2hlY2s6IGZhbHNlCiAgICAgICAgICAgIH0pLmNzcyh3aXRoSGludCA/IGNzcy5pbnB1dCA6IGNzcy5pbnB1dFdpdGhOb0hpbnQpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgISRpbnB1dC5hdHRyKCJkaXIiKSAmJiAkaW5wdXQuYXR0cigiZGlyIiwgImF1dG8iKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgcmV0dXJuICRpbnB1dC53cmFwKCR3cmFwcGVyKS5wYXJlbnQoKS5wcmVwZW5kKHdpdGhIaW50ID8gJGhpbnQgOiBudWxsKS5hcHBlbmQoJGRyb3Bkb3duKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ2V0QmFja2dyb3VuZFN0eWxlcygkZWwpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmRBdHRhY2htZW50OiAkZWwuY3NzKCJiYWNrZ3JvdW5kLWF0dGFjaG1lbnQiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDbGlwOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLWNsaXAiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJGVsLmNzcygiYmFja2dyb3VuZC1jb2xvciIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLWltYWdlIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kT3JpZ2luOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLW9yaWdpbiIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLXBvc2l0aW9uIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiAkZWwuY3NzKCJiYWNrZ3JvdW5kLXJlcGVhdCIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICRlbC5jc3MoImJhY2tncm91bmQtc2l6ZSIpCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lEb21TdHJ1Y3R1cmUoJG5vZGUpIHsKICAgICAgICAgICAgdmFyICRpbnB1dCA9ICRub2RlLmZpbmQoIi50dC1pbnB1dCIpOwogICAgICAgICAgICBfLmVhY2goJGlucHV0LmRhdGEoYXR0cnNLZXkpLCBmdW5jdGlvbih2YWwsIGtleSkgewogICAgICAgICAgICAgICAgXy5pc1VuZGVmaW5lZCh2YWwpID8gJGlucHV0LnJlbW92ZUF0dHIoa2V5KSA6ICRpbnB1dC5hdHRyKGtleSwgdmFsKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRpbnB1dC5kZXRhY2goKS5yZW1vdmVEYXRhKGF0dHJzS2V5KS5yZW1vdmVDbGFzcygidHQtaW5wdXQiKS5pbnNlcnRBZnRlcigkbm9kZSk7CiAgICAgICAgICAgICRub2RlLnJlbW92ZSgpOwogICAgICAgIH0KICAgIH0oKTsKICAgIChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgb2xkLCB0eXBlYWhlYWRLZXksIG1ldGhvZHM7CiAgICAgICAgb2xkID0gJC5mbi50eXBlYWhlYWQ7CiAgICAgICAgdHlwZWFoZWFkS2V5ID0gInR0VHlwZWFoZWFkIjsKICAgICAgICBtZXRob2RzID0gewogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG8sIGRhdGFzZXRzKSB7CiAgICAgICAgICAgICAgICBkYXRhc2V0cyA9IF8uaXNBcnJheShkYXRhc2V0cykgPyBkYXRhc2V0cyA6IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChhdHRhY2gpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gYXR0YWNoKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCBldmVudEJ1cywgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIF8uZWFjaChkYXRhc2V0cywgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgICAgICBkLmhpZ2hsaWdodCA9ICEhby5oaWdobGlnaHQ7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkID0gbmV3IFR5cGVhaGVhZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiAkaW5wdXQsCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50QnVzOiBldmVudEJ1cyA9IG5ldyBFdmVudEJ1cyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDogJGlucHV0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICB3aXRoSGludDogXy5pc1VuZGVmaW5lZChvLmhpbnQpID8gdHJ1ZSA6ICEhby5oaW50LAogICAgICAgICAgICAgICAgICAgICAgICBtaW5MZW5ndGg6IG8ubWluTGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBhdXRvc2VsZWN0OiBvLmF1dG9zZWxlY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBkYXRhc2V0cwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSwgdHlwZWFoZWFkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2gob3BlblR5cGVhaGVhZCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBvcGVuVHlwZWFoZWFkKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLm9wZW4oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goY2xvc2VUeXBlYWhlYWQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VUeXBlYWhlYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZhbDogZnVuY3Rpb24gdmFsKG5ld1ZhbCkgewogICAgICAgICAgICAgICAgcmV0dXJuICFhcmd1bWVudHMubGVuZ3RoID8gZ2V0VmFsKHRoaXMuZmlyc3QoKSkgOiB0aGlzLmVhY2goc2V0VmFsKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNldFZhbCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5zZXRWYWwobmV3VmFsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRWYWwoJGlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVhaGVhZCwgcXVlcnk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSB0eXBlYWhlYWQuZ2V0VmFsKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2godW5hdHRhY2gpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gdW5hdHRhY2goKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgICAgICAkaW5wdXQucmVtb3ZlRGF0YSh0eXBlYWhlYWRLZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgJC5mbi50eXBlYWhlYWQgPSBmdW5jdGlvbihtZXRob2QpIHsKICAgICAgICAgICAgaWYgKG1ldGhvZHNbbWV0aG9kXSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHNbbWV0aG9kXS5hcHBseSh0aGlzLCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAkLmZuLnR5cGVhaGVhZC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gbm9Db25mbGljdCgpIHsKICAgICAgICAgICAgJC5mbi50eXBlYWhlYWQgPSBvbGQ7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CiAgICB9KSgpOwp9KSh3aW5kb3cualF1ZXJ5KTsKZGVmaW5lKCJ0eXBlYWhlYWQiLCBmdW5jdGlvbigpe30pOwoKLyohCiAqIGpRdWVyeSBDb29raWUgUGx1Z2luIHYxLjQuMAogKiBodHRwczovL2dpdGh1Yi5jb20vY2FyaGFydGwvanF1ZXJ5LWNvb2tpZQogKgogKiBDb3B5cmlnaHQgMjAxMyBLbGF1cyBIYXJ0bAogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICovCihmdW5jdGlvbiAoZmFjdG9yeSkgewoJaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewoJCS8vIEFNRC4gUmVnaXN0ZXIgYXMgYW5vbnltb3VzIG1vZHVsZS4KCQlkZWZpbmUoJ2pRdWVyeUNvb2tpZScsWydqcXVlcnknXSwgZmFjdG9yeSk7Cgl9IGVsc2UgewoJCS8vIEJyb3dzZXIgZ2xvYmFscy4KCQlmYWN0b3J5KGpRdWVyeSk7Cgl9Cn0oZnVuY3Rpb24gKCQpIHsKCgl2YXIgcGx1c2VzID0gL1wrL2c7CgoJZnVuY3Rpb24gZW5jb2RlKHMpIHsKCQlyZXR1cm4gY29uZmlnLnJhdyA/IHMgOiBlbmNvZGVVUklDb21wb25lbnQocyk7Cgl9CgoJZnVuY3Rpb24gZGVjb2RlKHMpIHsKCQlyZXR1cm4gY29uZmlnLnJhdyA/IHMgOiBkZWNvZGVVUklDb21wb25lbnQocyk7Cgl9CgoJZnVuY3Rpb24gc3RyaW5naWZ5Q29va2llVmFsdWUodmFsdWUpIHsKCQlyZXR1cm4gZW5jb2RlKGNvbmZpZy5qc29uID8gSlNPTi5zdHJpbmdpZnkodmFsdWUpIDogU3RyaW5nKHZhbHVlKSk7Cgl9CgoJZnVuY3Rpb24gcGFyc2VDb29raWVWYWx1ZShzKSB7CgkJaWYgKHMuaW5kZXhPZignIicpID09PSAwKSB7CgkJCS8vIFRoaXMgaXMgYSBxdW90ZWQgY29va2llIGFzIGFjY29yZGluZyB0byBSRkMyMDY4LCB1bmVzY2FwZS4uLgoJCQlzID0gcy5zbGljZSgxLCAtMSkucmVwbGFjZSgvXFwiL2csICciJykucmVwbGFjZSgvXFxcXC9nLCAnXFwnKTsKCQl9CgoJCXRyeSB7CgkJCS8vIFJlcGxhY2Ugc2VydmVyLXNpZGUgd3JpdHRlbiBwbHVzZXMgd2l0aCBzcGFjZXMuCgkJCS8vIElmIHdlIGNhbid0IGRlY29kZSB0aGUgY29va2llLCBpZ25vcmUgaXQsIGl0J3MgdW51c2FibGUuCgkJCXMgPSBkZWNvZGVVUklDb21wb25lbnQocy5yZXBsYWNlKHBsdXNlcywgJyAnKSk7CgkJfSBjYXRjaChlKSB7CgkJCXJldHVybjsKCQl9CgoJCXRyeSB7CgkJCS8vIElmIHdlIGNhbid0IHBhcnNlIHRoZSBjb29raWUsIGlnbm9yZSBpdCwgaXQncyB1bnVzYWJsZS4KCQkJcmV0dXJuIGNvbmZpZy5qc29uID8gSlNPTi5wYXJzZShzKSA6IHM7CgkJfSBjYXRjaChlKSB7fQoJfQoKCWZ1bmN0aW9uIHJlYWQocywgY29udmVydGVyKSB7CgkJdmFyIHZhbHVlID0gY29uZmlnLnJhdyA/IHMgOiBwYXJzZUNvb2tpZVZhbHVlKHMpOwoJCXJldHVybiAkLmlzRnVuY3Rpb24oY29udmVydGVyKSA/IGNvbnZlcnRlcih2YWx1ZSkgOiB2YWx1ZTsKCX0KCgl2YXIgY29uZmlnID0gJC5jb29raWUgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgb3B0aW9ucykgewoKCQkvLyBXcml0ZQoJCWlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmICEkLmlzRnVuY3Rpb24odmFsdWUpKSB7CgkJCW9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgY29uZmlnLmRlZmF1bHRzLCBvcHRpb25zKTsKCgkJCWlmICh0eXBlb2Ygb3B0aW9ucy5leHBpcmVzID09PSAnbnVtYmVyJykgewoJCQkJdmFyIGRheXMgPSBvcHRpb25zLmV4cGlyZXMsIHQgPSBvcHRpb25zLmV4cGlyZXMgPSBuZXcgRGF0ZSgpOwoJCQkJdC5zZXREYXRlKHQuZ2V0RGF0ZSgpICsgZGF5cyk7CgkJCX0KCgkJCXJldHVybiAoZG9jdW1lbnQuY29va2llID0gWwoJCQkJZW5jb2RlKGtleSksICc9Jywgc3RyaW5naWZ5Q29va2llVmFsdWUodmFsdWUpLAoJCQkJb3B0aW9ucy5leHBpcmVzID8gJzsgZXhwaXJlcz0nICsgb3B0aW9ucy5leHBpcmVzLnRvVVRDU3RyaW5nKCkgOiAnJywgLy8gdXNlIGV4cGlyZXMgYXR0cmlidXRlLCBtYXgtYWdlIGlzIG5vdCBzdXBwb3J0ZWQgYnkgSUUKCQkJCW9wdGlvbnMucGF0aCAgICA/ICc7IHBhdGg9JyArIG9wdGlvbnMucGF0aCA6ICcnLAoJCQkJb3B0aW9ucy5kb21haW4gID8gJzsgZG9tYWluPScgKyBvcHRpb25zLmRvbWFpbiA6ICcnLAoJCQkJb3B0aW9ucy5zZWN1cmUgID8gJzsgc2VjdXJlJyA6ICcnCgkJCV0uam9pbignJykpOwoJCX0KCgkJLy8gUmVhZAoKCQl2YXIgcmVzdWx0ID0ga2V5ID8gdW5kZWZpbmVkIDoge307CgoJCS8vIFRvIHByZXZlbnQgdGhlIGZvciBsb29wIGluIHRoZSBmaXJzdCBwbGFjZSBhc3NpZ24gYW4gZW1wdHkgYXJyYXkKCQkvLyBpbiBjYXNlIHRoZXJlIGFyZSBubyBjb29raWVzIGF0IGFsbC4gQWxzbyBwcmV2ZW50cyBvZGQgcmVzdWx0IHdoZW4KCQkvLyBjYWxsaW5nICQuY29va2llKCkuCgkJdmFyIGNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUgPyBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsgJykgOiBbXTsKCgkJZm9yICh2YXIgaSA9IDAsIGwgPSBjb29raWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewoJCQl2YXIgcGFydHMgPSBjb29raWVzW2ldLnNwbGl0KCc9Jyk7CgkJCXZhciBuYW1lID0gZGVjb2RlKHBhcnRzLnNoaWZ0KCkpOwoJCQl2YXIgY29va2llID0gcGFydHMuam9pbignPScpOwoKCQkJaWYgKGtleSAmJiBrZXkgPT09IG5hbWUpIHsKCQkJCS8vIElmIHNlY29uZCBhcmd1bWVudCAodmFsdWUpIGlzIGEgZnVuY3Rpb24gaXQncyBhIGNvbnZlcnRlci4uLgoJCQkJcmVzdWx0ID0gcmVhZChjb29raWUsIHZhbHVlKTsKCQkJCWJyZWFrOwoJCQl9CgoJCQkvLyBQcmV2ZW50IHN0b3JpbmcgYSBjb29raWUgdGhhdCB3ZSBjb3VsZG4ndCBkZWNvZGUuCgkJCWlmICgha2V5ICYmIChjb29raWUgPSByZWFkKGNvb2tpZSkpICE9PSB1bmRlZmluZWQpIHsKCQkJCXJlc3VsdFtuYW1lXSA9IGNvb2tpZTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJlc3VsdDsKCX07CgoJY29uZmlnLmRlZmF1bHRzID0ge307CgoJJC5yZW1vdmVDb29raWUgPSBmdW5jdGlvbiAoa2V5LCBvcHRpb25zKSB7CgkJaWYgKCQuY29va2llKGtleSkgIT09IHVuZGVmaW5lZCkgewoJCQkvLyBNdXN0IG5vdCBhbHRlciBvcHRpb25zLCB0aHVzIGV4dGVuZGluZyBhIGZyZXNoIG9iamVjdC4uLgoJCQkkLmNvb2tpZShrZXksICcnLCAkLmV4dGVuZCh7fSwgb3B0aW9ucywgeyBleHBpcmVzOiAtMSB9KSk7CgkJCXJldHVybiB0cnVlOwoJCX0KCQlyZXR1cm4gZmFsc2U7Cgl9OwoKfSkpOwoKLyoKICogZ2l2ZW4gYSBwYXJ0aWFsIFJpY2hTZXF1ZW5jZSBzdHJpbmcsIHJldHVybiB2YWx1ZSBhdXRvY29tcGxldGlvbiB2YWx1ZXMuCiAqIFRoaXMgY2FuIGNvdmVyOgogKiAtIGdpdmUgbWUgYSBudW1lcmljYWwgdmFsdWUsIEknbGwgcmV0dXJuIGNsb3NlIG1vZGlmaWNhdGlvbiBsaXN0CiAqIC0gZ2l2ZSBtZSBhIHBhcnRpYWwgbW9kaWZpY2F0aW9uIG5hbWUsIEknbGwgc2hvb3QgdGhlIG1hdGNoaW5nIG1vZGlmaWNhdGlvbnMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9SaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5J10sIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgZGljb0FBLCBkaWNvUmVzTW9kKSB7CgogICAgdmFyIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYubW9kaWZOYW1lcyA9IF8uY2hhaW4oZGljb1Jlc01vZC5tb2RlbHMpLmNvbGxlY3QoZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgIHJldHVybiBybS5nZXQoJ25hbWUnKQogICAgICAgIH0pLnNvcnQoKS52YWx1ZSgpOwoKICAgICAgICBzZWxmLm1vZGlmMm1hc3MgPSB7fQogICAgICAgIF8uZWFjaChkaWNvUmVzTW9kLm1vZGVscywgZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgIHNlbGYubW9kaWYybWFzc1tybS5nZXQoJ25hbWUnKV0gPSBybS5nZXQoJ21hc3MnKQogICAgICAgIH0pCiAgICB9OwoKICAgIC8qKgogICAgICogcmV0dXJuIGEgdHJ1ZSB2YWx1ZSBpZiB0aGUgY3VycmVudCB0aGVyZSBpcyBub3QgY2xvc2VlZCBjdXJseSBicmFja2V0IGJlZm9yZSB0aGUgbmV4dCBvcGVuIG9yIHRoZSBlbmQKICAgICAqIChpLmUuLCBpZiB3ZSBjYWxsIHRoYXQgZnVuY2l0b24gZnRlciBvcGVuaW5nIGEgY3VscnksIGl0IHdpbGwgdXMgaWYgd2Ugc2hhbGwgYWRkIGEgY29zZSBvbmUpCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdHh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9zCiAgICAgKi8KICAgIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIucHJvdG90eXBlLmNsb3NlQ3VybHkgPSBmdW5jdGlvbiAodHh0LCBwb3MpIHsKICAgICAgICB2YXIgdGFpbCA9IHR4dC5zdWJzdHJpbmcocG9zKQogICAgICAgIGlmICh0YWlsLmluZGV4T2YoJ30nKSA8IDAgfHwgKHRhaWwuaW5kZXhPZigneycpID4gMCkgJiYgKHRhaWwuaW5kZXhPZignfScpID4gdGFpbC5pbmRleE9mKCd7JykpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICAvKioKICAgICAqIGdpdmVuIGEgdGV4dCBhbmQgYSBwb3N0aW9uLCBleHRyYWN0IHRoZSBwcmVmaXggdGhhdCB3aWxsIGJlIHVzZWQgYXMgYSBhbmNob3IgZm9yIGF1dG9jb21wbGV0aW9uLCBhcyB3ZWxsIGFzIHRoZSB0ZXh0IHBvc2l0aW9uIHRvIGJlIHJlcGxhY2VkIGJ5IHRoZSBhdXRvY29tcGxldGlvbmVyCiAgICAgKiBUaGluayB0aGF0IHdlIGNhbiBjb21lIGJhY2sgaW50byAgY3VybHkgYnJhY2tldHMgYW5kIHdlIHN0aWxsIHdhbnQgc29tZSBjb21wbGV0aW9uCiAgICAgKiByZXR1cm4gbnVsbCBpcyB3ZSBhcmUgbm90IGF0IGEgcG9zaXRpb24gdG8gZ2V0IGFueSByZXBsYWNlbWVudAogICAgICoKICAgICAqIGdvIGNoZWNrIGphc21pbmUgUmljaFNlcXVlbmNlQXV0b0NvbXBsZXRpb25lciUyMHJlcGxhY2VhYmxlIHRvIGdldCB0b25zIG9mIGV4YW1wbGVzCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdHh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9zCiAgICAgKi8KICAgIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIucHJvdG90eXBlLnJlcGxhY2VhYmxlID0gZnVuY3Rpb24gKHR4dCwgcG9zKSB7CiAgICAgICAgdmFyIGJlZm9yZSA9IHR4dC5zdWJzdHJpbmcoMCwgcG9zKQogICAgICAgIHZhciBhZnRlciA9IHR4dC5zdWJzdHJpbmcocG9zKQoKICAgICAgICBpZiAoYmVmb3JlLmluZGV4T2YoJ3snKSA8IDApIHsKICAgICAgICAgICAgLy9ub3QgZXZlbiBhbiBvcGVuIGN1cmx5LCBkb24ndCB3YXN0ZSBteSB0aW1lCiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQoKICAgICAgICBiZWZvcmUgPSBiZWZvcmUucmVwbGFjZSgvLipcfS8sICcnKTsKICAgICAgICBpZiAoYmVmb3JlLmluZGV4T2YoJ3snKSA8IDApIHsKICAgICAgICAgICAgLy93ZSBhcmUgbm90IGFmdGVyIGFuIG9wZW4gY3VybHkgYnJhY2tldAogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgYmVmb3JlID0gYmVmb3JlLnJlcGxhY2UoLy4qW1x7LF0vLCAnJyk7CgogICAgICAgIGFmdGVyID0gYWZ0ZXIucmVwbGFjZSgvW1x9LF0uKi8sICcnKTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlZml4OiBiZWZvcmUsCiAgICAgICAgICAgIHBvc1N0YXJ0OiBwb3MgLSBiZWZvcmUubGVuZ3RoLAogICAgICAgICAgICBwb3NFbmQ6IHBvcyArIGFmdGVyLmxlbmd0aAogICAgICAgIH0KCiAgICB9OwoKICAgIC8qKgogICAgICogZ2V0IHRoZSBsaXN0IG9mIG1vZGlmY2F0aW9uIG1hYXRjaGluZyB0aGUgcHJlZml4LiBpLmUuCiAgICAgKiBzdGFydGluZyB3aXRoIHRoZSBwcmVmaXgKICAgICAqIGNhc2UgaXMgbm90IGltcG9ydGFudAogICAgICogcHJlZml4IGNhbiBiZSBhIG1hc3MgKCsvLSAxIERhKQogICAgICogQHBhcmFtIHtPYmplY3R9IHByZWZpeAogICAgICovCiAgICBSaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyLnByb3RvdHlwZS5nZXRMaXN0ID0gZnVuY3Rpb24gKHByZWZpeCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIG1hc3MgPSBwYXJzZUZsb2F0KHByZWZpeCkKICAgICAgICBpZiAoXy5pc0Zpbml0ZShtYXNzKSkgewogICAgICAgICAgICB2YXIgbUluZiA9IG1hc3MgLSAxLjAKICAgICAgICAgICAgdmFyIG1TdXAgPSBtYXNzICsgMS4wCiAgICAgICAgICAgIHJldHVybiBfLmNoYWluKHNlbGYubW9kaWYybWFzcykuY29sbGVjdChmdW5jdGlvbiAobWFzcywgbmFtZSkgewogICAgICAgICAgICAgICAgaWYgKG1hc3MgPCBtSW5mIHx8IG1hc3MgPiBtU3VwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuYW1lCiAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgcmV0dXJuIG4gIT0gbnVsbAogICAgICAgICAgICB9KS52YWx1ZSgpCiAgICAgICAgfQoKICAgICAgICBwcmVmaXggPSBwcmVmaXgudG9Mb3dlckNhc2UoKTsKICAgICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5tb2RpZk5hbWVzLCBmdW5jdGlvbiAobikgewogICAgICAgICAgICByZXR1cm4gbi50b0xvd2VyQ2FzZSgpLmluZGV4T2YocHJlZml4KSA9PSAwCiAgICAgICAgfSkKICAgIH0KICAgIHJldHVybiBSaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyOwp9KTsKCi8qCiBSZXF1aXJlSlMgdGV4dCAwLjI3LjAgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KIEF2YWlsYWJsZSB2aWEgdGhlIE1JVCBvciBuZXcgQlNEIGxpY2Vuc2UuCiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvcmVxdWlyZWpzIGZvciBkZXRhaWxzCiovCihmdW5jdGlvbigpe3ZhciBrPVsiTXN4bWwyLlhNTEhUVFAiLCJNaWNyb3NvZnQuWE1MSFRUUCIsIk1zeG1sMi5YTUxIVFRQLjQuMCJdLG49L15ccyo8XD94bWwoXHMpK3ZlcnNpb249W1wnXCJdKFxkKSouKFxkKSpbXCdcIl0oXHMpKlw/Pi9pbSxvPS88Ym9keVtePl0qPlxzKihbXHNcU10rKVxzKjxcL2JvZHk+L2ltLGk9dHlwZW9mIGxvY2F0aW9uIT09InVuZGVmaW5lZCImJmxvY2F0aW9uLmhyZWYscD1pJiZsb2NhdGlvbi5wcm90b2NvbCYmbG9jYXRpb24ucHJvdG9jb2wucmVwbGFjZSgvXDovLCIiKSxxPWkmJmxvY2F0aW9uLmhvc3RuYW1lLHI9aSYmKGxvY2F0aW9uLnBvcnR8fHZvaWQgMCksaj1bXTtkZWZpbmUoJ3RleHQnLFtdLGZ1bmN0aW9uKCl7dmFyIGcsaCxsO3R5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIiYmd2luZG93Lm5hdmlnYXRvciYmd2luZG93LmRvY3VtZW50P2g9ZnVuY3Rpb24oYSxiKXt2YXIgYz1nLmNyZWF0ZVhocigpO2Mub3BlbigiR0VUIixhLCEwKTtjLm9ucmVhZHlzdGF0ZWNoYW5nZT0KZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU9PT00JiZiKGMucmVzcG9uc2VUZXh0KX07Yy5zZW5kKG51bGwpfTp0eXBlb2YgcHJvY2VzcyE9PSJ1bmRlZmluZWQiJiZwcm9jZXNzLnZlcnNpb25zJiZwcm9jZXNzLnZlcnNpb25zLm5vZGU/KGw9cmVxdWlyZS5ub2RlUmVxdWlyZSgiZnMiKSxoPWZ1bmN0aW9uKGEsYil7YihsLnJlYWRGaWxlU3luYyhhLCJ1dGY4IikpfSk6dHlwZW9mIFBhY2thZ2VzIT09InVuZGVmaW5lZCImJihoPWZ1bmN0aW9uKGEsYil7dmFyIGM9bmV3IGphdmEuaW8uRmlsZShhKSxlPWphdmEubGFuZy5TeXN0ZW0uZ2V0UHJvcGVydHkoImxpbmUuc2VwYXJhdG9yIiksYz1uZXcgamF2YS5pby5CdWZmZXJlZFJlYWRlcihuZXcgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRlcihuZXcgamF2YS5pby5GaWxlSW5wdXRTdHJlYW0oYyksInV0Zi04IikpLGQsZixnPSIiO3RyeXtkPW5ldyBqYXZhLmxhbmcuU3RyaW5nQnVmZmVyOyhmPWMucmVhZExpbmUoKSkmJmYubGVuZ3RoKCkmJgpmLmNoYXJBdCgwKT09PTY1Mjc5JiYoZj1mLnN1YnN0cmluZygxKSk7Zm9yKGQuYXBwZW5kKGYpOyhmPWMucmVhZExpbmUoKSkhPT1udWxsOylkLmFwcGVuZChlKSxkLmFwcGVuZChmKTtnPVN0cmluZyhkLnRvU3RyaW5nKCkpfWZpbmFsbHl7Yy5jbG9zZSgpfWIoZyl9KTtyZXR1cm4gZz17dmVyc2lvbjoiMC4yNy4wIixzdHJpcDpmdW5jdGlvbihhKXtpZihhKXt2YXIgYT1hLnJlcGxhY2UobiwiIiksYj1hLm1hdGNoKG8pO2ImJihhPWJbMV0pfWVsc2UgYT0iIjtyZXR1cm4gYX0sanNFc2NhcGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvKFsnXFxdKS9nLCJcXCQxIikucmVwbGFjZSgvW1xmXS9nLCJcXGYiKS5yZXBsYWNlKC9bXGJdL2csIlxcYiIpLnJlcGxhY2UoL1tcbl0vZywiXFxuIikucmVwbGFjZSgvW1x0XS9nLCJcXHQiKS5yZXBsYWNlKC9bXHJdL2csIlxcciIpfSxjcmVhdGVYaHI6ZnVuY3Rpb24oKXt2YXIgYSxiLGM7aWYodHlwZW9mIFhNTEh0dHBSZXF1ZXN0IT09CiJ1bmRlZmluZWQiKXJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3Q7ZWxzZSBmb3IoYj0wO2I8MztiKyspe2M9a1tiXTt0cnl7YT1uZXcgQWN0aXZlWE9iamVjdChjKX1jYXRjaChlKXt9aWYoYSl7az1bY107YnJlYWt9fWlmKCFhKXRocm93IEVycm9yKCJjcmVhdGVYaHIoKTogWE1MSHR0cFJlcXVlc3Qgbm90IGF2YWlsYWJsZSIpO3JldHVybiBhfSxnZXQ6aCxwYXJzZU5hbWU6ZnVuY3Rpb24oYSl7dmFyIGI9ITEsYz1hLmluZGV4T2YoIi4iKSxlPWEuc3Vic3RyaW5nKDAsYyksYT1hLnN1YnN0cmluZyhjKzEsYS5sZW5ndGgpLGM9YS5pbmRleE9mKCIhIik7YyE9PS0xJiYoYj1hLnN1YnN0cmluZyhjKzEsYS5sZW5ndGgpLGI9Yj09PSJzdHJpcCIsYT1hLnN1YnN0cmluZygwLGMpKTtyZXR1cm57bW9kdWxlTmFtZTplLGV4dDphLHN0cmlwOmJ9fSx4ZFJlZ0V4cDovXigoXHcrKVw6KT9cL1wvKFteXC9cXF0rKS8sdXNlWGhyOmZ1bmN0aW9uKGEsYixjLGUpe3ZhciBkPWcueGRSZWdFeHAuZXhlYyhhKSwKZjtpZighZClyZXR1cm4hMDthPWRbMl07ZD1kWzNdO2Q9ZC5zcGxpdCgiOiIpO2Y9ZFsxXTtkPWRbMF07cmV0dXJuKCFhfHxhPT09YikmJighZHx8ZD09PWMpJiYoIWYmJiFkfHxmPT09ZSl9LGZpbmlzaExvYWQ6ZnVuY3Rpb24oYSxiLGMsZSxkKXtjPWI/Zy5zdHJpcChjKTpjO2QuaXNCdWlsZCYmZC5pbmxpbmVUZXh0JiYoalthXT1jKTtlKGMpfSxsb2FkOmZ1bmN0aW9uKGEsYixjLGUpe3ZhciBkPWcucGFyc2VOYW1lKGEpLGY9ZC5tb2R1bGVOYW1lKyIuIitkLmV4dCxtPWIudG9VcmwoZiksaD1lJiZlLnRleHQmJmUudGV4dC51c2VYaHJ8fGcudXNlWGhyOyFpfHxoKG0scCxxLHIpP2cuZ2V0KG0sZnVuY3Rpb24oYil7Zy5maW5pc2hMb2FkKGEsZC5zdHJpcCxiLGMsZSl9KTpiKFtmXSxmdW5jdGlvbihhKXtnLmZpbmlzaExvYWQoZC5tb2R1bGVOYW1lKyIuIitkLmV4dCxkLnN0cmlwLGEsYyxlKX0pfSx3cml0ZTpmdW5jdGlvbihhLGIsYyl7aWYoYiBpbiBqKXt2YXIgZT1nLmpzRXNjYXBlKGpbYl0pOwpjLmFzTW9kdWxlKGErIiEiK2IsImRlZmluZShmdW5jdGlvbiAoKSB7IHJldHVybiAnIitlKyInO30pO1xuIil9fSx3cml0ZUZpbGU6ZnVuY3Rpb24oYSxiLGMsZSxkKXt2YXIgYj1nLnBhcnNlTmFtZShiKSxmPWIubW9kdWxlTmFtZSsiLiIrYi5leHQsaD1jLnRvVXJsKGIubW9kdWxlTmFtZSsiLiIrYi5leHQpKyIuanMiO2cubG9hZChmLGMsZnVuY3Rpb24oKXt2YXIgYj1mdW5jdGlvbihhKXtyZXR1cm4gZShoLGEpfTtiLmFzTW9kdWxlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGUuYXNNb2R1bGUoYSxoLGIpfTtnLndyaXRlKGEsZixiLGQpfSxkKX19fSl9KSgpOwoKZGVmaW5lKCd0ZXh0IWZpc2h0b25lcy10ZW1wbGF0ZXMvZHJ5L2Zvcm1zL3JpY2hzZXF1ZW5jZS1pbnB1dC5odG1sJyxbXSxmdW5jdGlvbiAoKSB7IHJldHVybiAnPGRpdiBjbGFzcz0iaW5wdXQtYXBwZW5kIiBzdHlsZT0id2lkdGg6MTAwJSI+XG4gICAgPHNwYW4gY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tcXVlc3Rpb24tc2lnbiI+PC9zcGFuPlxuICAgIDxpbnB1dCBpZD0ie3tpbnB1dElkfX0iIHR5cGU9InRleHQiIGNsYXNzPSJ7e2lucHV0Q2xhc3N9fSIgcGxhY2Vob2xkZXI9Int7cGxhY2Vob2xkZXJ9fSJcbiAgICAgICAgICAgdmFsdWU9Int7dmFsdWV9fSIvPlxuXG4gICAgPGJ1dHRvbiBpZD0ie3tidXR0b25JZH19IiBjbGFzcz0ie3tidXR0b25DbGFzc319IiB0eXBlPSJidXR0b24iPnt7YnV0dG9uVGV4dH19PC9idXR0b24+XG4gICAgPHNwYW4gaWQ9Int7dmFsaWRJbmRpY2F0b3JJZH19IiBjbGFzcz0iYmFkZ2UgYmFkZ2UtaW1wb3J0YW50Ij5YPC9zcGFuPlxuPC9kaXY+Jzt9KTsKCi8qKgogKiBJbnB1dCBmaWVsZCBmb3IgIFJpY2hTZXF1ZW5jZSwgd2l0aCBhdXRvY29tcGxldGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvZHJ5L2Zvcm1zL1JpY2hTZXF1ZW5jZUlucHV0JyxbJ2pxdWVyeS1wbHVzJywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvUmljaFNlcXVlbmNlU2hvcnRjdXRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXInLCAndGV4dCFmaXNodG9uZXMtdGVtcGxhdGVzL2RyeS9mb3Jtcy9yaWNoc2VxdWVuY2UtaW5wdXQuaHRtbCddLAogICAgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBSaWNoU2VxdWVuY2UsIFJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIsIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIsIHRtcGwpIHsKCiAgICAgICAgUmljaFNlcXVlbmNlSW5wdXQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAgICAgaWYgKCFzZWxmLm1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2RlbCA9IG5ldyBSaWNoU2VxdWVuY2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vaW5pdGlhbGl6YXRpb24gcGVyIHNlCiAgICAgICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIgPSBuZXcgUmljaFNlcXVlbmNlU2hvcnRjdXRlcigpOwogICAgICAgICAgICAgICAgc2VsZi5hdXRvQ29tcGxldGlvbmVyID0gbmV3IFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIoKQogICAgICAgICAgICAgICAgc2VsZi5jYWxsYmFja3NJbnZhbGlkID0gW107CiAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrc1ZhbGlkID0gW107CiAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrc0NsZWFyID0gW107CgogICAgICAgICAgICAgICAgc2VsZi5hY3Rpb24gPSBvcHRpb25zICYmIG9wdGlvbnMuYWN0aW9uOwoKICAgICAgICAgICAgICAgIC8vZG9tIGNvbnN0cnVjdGlvbgogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSAkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdIM0s0LCBIMy4xSzE4QWMsIEgzLjFLMThBY0syM01lMiwgS1FUQVIsIEtBY1FUQVIsIEt7QWNldHlsYXRpb24sTWV0aHlsYXRpb259UVRBUntNZXRoeWxhdGlvbn0nLAogICAgICAgICAgICAgICAgICAgIGlucHV0Q2xhc3M6ICdmb3JtLWNvbnRyb2wnLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgICAgICAgICAgICBpbnB1dElkOiAncnNpLWlucHV0LScgKyBzZWxmLmNpZCwKICAgICAgICAgICAgICAgICAgICBidXR0b25DbGFzczogJ2J0bicsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uSWQ6ICdyc2ktYnV0LScgKyBzZWxmLmNpZCwKICAgICAgICAgICAgICAgICAgICBidXR0b25UZXh0OiAnYWN0aW9uJywKICAgICAgICAgICAgICAgICAgICBoaWRlQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBoaWRlVmFsaWRJbmRpY2F0b3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdmFsaWRJbmRpY2F0b3JJZDogJ3JzaS1iYWRnZS0nICsgc2VsZi5jaWQKICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMpOwoKICAgICAgICAgICAgICAgIHZhciBjb250ID0gJChzZWxmLmVsKS5hcHBlbmQoJChfLnRlbXBsYXRlKHRtcGwsIGFyZ3MpKSk7CiAgICAgICAgICAgICAgICBzZWxmLmVsSW5wdXQgPSBjb250LmZpbmQoJ2lucHV0Jyk7CiAgICAgICAgICAgICAgICBzZWxmLmVsQnV0dG9uID0gY29udC5maW5kKCdidXR0b24nKTsKICAgICAgICAgICAgICAgIHNlbGYuaGlkZUluZGljYXRvciA9IGNvbnQuZmluZCgnc3Bhbi5iYWRnZScpCgoKICAgICAgICAgICAgICAgIGlmIChhcmdzLmhpZGVCdXR0b24pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmVsQnV0dG9uLmhpZGUoKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGlkZVZhbGlkSW5kaWNhdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oaWRlSW5kaWNhdG9yLmhpZGUoKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHNlbGYuZWxJY29uID0gY29udC5maW5kKCdzcGFuLmdseXBoaWNvbicpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHZhciB0b3RhbFdpZHRoID0gJChzZWxmLmVsKS53aWR0aCgpOwogICAgICAgICAgICAgICAgICAgIHRvdGFsV2lkdGgtPXNlbGYuZWxCdXR0b24ub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT1zZWxmLmhpZGVJbmRpY2F0b3Iub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT0gc2VsZi5lbEljb24ub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT0yMAoKICAgICAgICAgICAgICAgICAgICBzZWxmLmVsSW5wdXQud2lkdGgoJycrdG90YWxXaWR0aCsncHgnKTsKICAgICAgICAgICAgICAgIH0sMCk7CgogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnZhbChzZWxmLm1vZGVsLnRvU3RyaW5nKCkpCgogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnR5cGVhaGVhZCh7CiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBmdW5jdGlvbiAodHh0LCBwcm9jZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQucmVwbGFjZUNvbnRleHQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcENhcmV0ID0gc2VsZi5lbElucHV0WzBdLnNlbGVjdGlvblN0YXJ0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnNlcnRlZENoYXIgPSB0eHQuY2hhckF0KHBDYXJldCAtIDEpCgogICAgICAgICAgICAgICAgICAgICAgICAvL2Nsb3NlIHRoZSBjdXJseSBicmFja2V0IGlmIG5lZWRlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zZXJ0ZWRDaGFyID09ICd7JyAmJiBzZWxmLmF1dG9Db21wbGV0aW9uZXIuY2xvc2VDdXJseSh0eHQsIHBDYXJldCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWxJbnB1dC52YWwodHh0LnN1YnN0cmluZygwLCBwQ2FyZXQpICsgJ30nICsgdHh0LnN1YnN0cmluZyhwQ2FyZXQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRDYXJldEF0KHBDYXJldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcGxhY2UgPSBzZWxmLmF1dG9Db21wbGV0aW9uZXIucmVwbGFjZWFibGUodHh0LCBwQ2FyZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlLnByZWZpeC5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dCA9IHJlcGxhY2UKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYXV0b0NvbXBsZXRpb25lci5nZXRMaXN0KHJlcGxhY2UucHJlZml4KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZXI6IGZ1bmN0aW9uICh0eHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVhaGVhZCA9IHRoaXM7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5lbElucHV0LnZhbCgpLnN1YnN0cmluZygwLCB0eXBlYWhlYWQucmVwbGFjZUNvbnRleHQucG9zU3RhcnQpICsgJzxiPicgKyB0eHQgKyAnPC9iPicgKyBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NFbmQpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB1cGRhdGVyOiBmdW5jdGlvbiAodHh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldENhcmV0U2VsZWN0aW9uKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NTdGFydCwgdHlwZWFoZWFkLnJlcGxhY2VDb250ZXh0LnBvc0VuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdWYWwgPSBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKDAsIHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NTdGFydCkgKyB0eHQgKyBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NFbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWxJbnB1dC52YWwobmV3VmFsKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdWYWwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIHZhciBwb3AgPSBzZWxmLmVsSWNvbi5wb3BvdmVyKHsKICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6ICJib3R0b20iLAogICAgICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ2hvdmVyJywKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0hvdyB0byBlbnRlciBhIHBlcHRpZGUgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0ibW9kYWwiIGFyaWEtaGlkZGVuPSJ0cnVlIicsCgogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICJUaGVyZSBpcyBtb3JlIHRoYW4gb25lIHdheSB0byBkbyBpdDo8dWw+IDxsaT5zaG9ydGN1dCBhcyA8Y29kZT5IM0s5PC9jb2RlPiBvciA8Y29kZT5IMy4xSzI3PC9jb2RlPjwvbGk+PGxpPnNob3J0Y3V0IHdpdGggbW9kaWZpY2F0aW9uIGFzIDxjb2RlPkgzSzlNZTI8L2NvZGU+PC9saT48bGk+YXMgc2VxdWVuY2Ugd2l0aCBzaG9ydCBtb2RpZmljYXRpb24gPGNvZGU+UUtBY1RBUk1lPC9jb2RlPjwvbGk+PGxpPndpdGggbG9uZyB2ZXJzaW9uIG1vZGlmaWNhdGlvbiA8Y29kZT5RS3tBY2V0eWx9VEFSPC9jb2RlPjwvbGk+PGxpPndpdGggZXhwbGljaXQgbWFzcyA8Y29kZT5QRVB7MTIzNC41Njd9VElERU1lPC9jb2RlPjwvbGk+PGxpPmluIGNvbnRleHQgPGNvZGU+Ui5RS1RBUi5LPC9jb2RlPjwvbGk+PC91bD5UaGUgbW9kaWZpY2F0aW9uIGxpc3QgY2FuIGJlIGZvdW5kIDxhIGhyZWY9Jyc+c29vbjwvYT4iCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnZhbChzZWxmLm1vZGVsLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgc2VsZi5kZWxlZ2F0ZUV2ZW50cyh7CiAgICAgICAgICAgICAgICAgICAgJ2lucHV0JzogJ3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgJ2tleXByZXNzIGlucHV0JzogJ2lucHV0S2V5UHJlc3NlZCcsCiAgICAgICAgICAgICAgICAgICAgJ2NsaWNrIGJ1dHRvbic6ICdjYWxsQWN0aW9uJwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIHNlbGYub24oJ2NoYW5nZTppbnB1dCcsIGZ1bmN0aW9uKCl7c2VsZi51cGRhdGUoKX0pOwogICAgICAgICAgICAgICAgLy8gc2VsZi5vbigna2V5cHJlc3M6aW5wdXQnLCBmdW5jdGlvbigpe3NlbGYuaW5wdXRLZXlQcmVzc2VkKCl9KTsKICAgICAgICAgICAgICAgIC8vIHNlbGYub24oJ2J1dHRvbjpjbGljaycsIGZ1bmN0aW9uKCl7c2VsZi5jYWxsQWN0aW9uKCl9KTsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBldmVudHMgOiB7CiAgICAgICAgICAgIC8vICdpbnB1dCcgOiAndXBkYXRlJywKICAgICAgICAgICAgLy8gJ2tleXByZXNzIGlucHV0JyA6ICdpbnB1dEtleVByZXNzZWQnLAogICAgICAgICAgICAvLyAnY2xpY2sgYnV0dG9uJyA6ICdjYWxsQWN0aW9uJwogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGluU3RyID0gc2VsZi5lbElucHV0LnZhbCgpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5TdHIgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuY2FsbGJhY2tzQ2xlYXIsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmKHNlbGYubW9kZWwpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIucmljaFNlcVJlYWRGcm9tKHNlbGYubW9kZWwsIGluU3RyKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaXNWYWxpZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbEJ1dHRvbi5yZW1vdmVDbGFzcygnYnRuLXdhcm5pbmcnKS5hZGRDbGFzcygnYnRuLXN1Y2Nlc3MnKS5hdHRyKCdkaXNhYmxlZCcsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHNlbGYuaGlkZUluZGljYXRvci5yZW1vdmVDbGFzcygnYmFkZ2UtaW1wb3J0YW50JykuYWRkQ2xhc3MoJ2JhZGdlLXN1Y2Nlc3MnKS5odG1sKCcmcmFkaWM7Jyk7CiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuY2FsbGJhY2tzVmFsaWQsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYoc2VsZi5tb2RlbCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4YykgewogICAgICAgICAgICAgICAgICAgIHNlbGYuaXNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHNlbGYuZWxCdXR0b24uYWRkQ2xhc3MoJ2J0bi13YXJuaW5nJykucmVtb3ZlQ2xhc3MoJ2J0bi1zdWNjZXNzJykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTsKICAgICAgICAgICAgICAgICAgICBzZWxmLmhpZGVJbmRpY2F0b3IucmVtb3ZlQ2xhc3MoJ2JhZGdlLXN1Y2Nlc3MnKS5hZGRDbGFzcygnYmFkZ2UtaW1wb3J0YW50JykuaHRtbCgnWCcpOwogICAgICAgICAgICAgICAgICAgIF8uZWFjaChzZWxmLmNhbGxiYWNrc0ludmFsaWQsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYoZXhjKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGNsaWNrIGJ1dHRvbiBpZiBlbnRlciBrZXkgaXMgcHJlc3NlZAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaW5wdXRLZXlQcmVzc2VkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoZXZ0LmNoYXJDb2RlID09IDEzKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsQWN0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgYSBmdW5jaXRvbiB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIGZpZWxkIGlzIGEgdmFsaWQgUmljaFNlcXVlbmNlIGRlc2NyaXB0b3IKICAgICAgICAgICAgICogYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBmdW5jdGlvbiB3aWxsIGEgUmljaFNlcXVlbmNlICh0aGUgUlNJIG1vZGVsKQogICAgICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBhZGRDYWxsYmFja1ZhbGlkOiBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NWYWxpZC5wdXNoKGYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgYSBmdW5jaXRvbiB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIGZpZWxkIGlzIGEgSU52YWxpZCBSaWNoU2VxdWVuY2UgZGVzY3JpcHRvcgogICAgICAgICAgICAgKiBhcmcgcGFzc2VkIHRvIGZ1bmN0aW9uIGlzIHRoZSBjdXJyZW50IGV4Y2VwdGlvbgogICAgICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBhZGRDYWxsYmFja0ludmFsaWQ6IGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrc0ludmFsaWQucHVzaChmKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhZGRDYWxsYmFja0NsZWFyOiBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NDbGVhci5wdXNoKGYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbGxBY3Rpb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmFjdGlvbiA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmFjdGlvbihzZWxmLm1vZGVsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRDYXJldEF0OiBmdW5jdGlvbiAocG9zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHNlbGYuZWxJbnB1dFswXTsKICAgICAgICAgICAgICAgIG5vZGUuc2V0U2VsZWN0aW9uUmFuZ2UocG9zLCBwb3MpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRDYXJldFNlbGVjdGlvbjogZnVuY3Rpb24gKHBTdGFydCwgcEVuZCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBzZWxmLmVsSW5wdXRbMF07CiAgICAgICAgICAgICAgICBub2RlLnNldFNlbGVjdGlvblJhbmdlKHBTdGFydCwgcEVuZCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBqdXN0IHJldHVybiB0aGUgdGV4dCBpbiB0aGUgaW5wdXQgZmllbGQKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGlucHV0U2VxdWVuY2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmVsSW5wdXQudmFsKCkudHJpbSgpCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIHJldHVybiBSaWNoU2VxdWVuY2VJbnB1dDsKICAgIH0pOwoKLyoKICogU1ZHIHJlbmRlciBvZiB0aGVvcmV0aWNhbCBmcmFnbWVudCBvbiBhIHNlcXVlbmNlCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBkMykgewoKICAgIFRoZW9PblNlcXVlbmNlVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAoKICAgICAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHRoZW9TcGVjdHJ1bSA9IHNlbGYubW9kZWw7CgogICAgICAgICAgICB2YXIgd1VuaXQgPSA2NTsKICAgICAgICAgICAgdmFyIGhVbml0ID0gMTU7CgogICAgICAgICAgICB2YXIgd2lkdGggPSAodGhlb1NwZWN0cnVtLmdldCgncmljaFNlcXVlbmNlJykuc2l6ZSgpICsgMSkgKiB3VW5pdDsKICAgICAgICAgICAgdmFyIGhlaWdodCA9ICh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoICsgMiApICogaFVuaXQ7CgogICAgICAgICAgICBzZWxmLnZpeiA9IGQzLnNlbGVjdChzZWxmLmVsKS5hcHBlbmQoInN2ZyIpLmF0dHIoJ2NsYXNzJywgJ2QzLXdpZGdldC10aGVvLW9uLXNlcXVlbmNlJykuYXR0cigid2lkdGgiLCB3aWR0aCkuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0KTsKCiAgICAgICAgICAgIHZhciBzZXJpZXMyaSA9IHt9OwogICAgICAgICAgICB2YXIgaV9jID0gMDsKICAgICAgICAgICAgdmFyIGlfbiA9IDA7CiAgICAgICAgICAgIF8uZWFjaCh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJyksIGZ1bmN0aW9uKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoZnMgPCAnbScpIHsvLyBudGVybQogICAgICAgICAgICAgICAgICAgIGlfbiA9IGlfbiAtIDE7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9uOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpX2MgPSBpX2MgKyAxCiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9jOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaV9uIC09IDAuNTsKCiAgICAgICAgICAgIHZhciByaWNoU2VxID0gdGhlb1NwZWN0cnVtLmdldCgncmljaFNlcXVlbmNlJyk7CiAgICAgICAgICAgIHNlbGYudml6LmFwcGVuZCgnZycpLnNlbGVjdEFsbCgndGV4dC5hYScpLmRhdGEocmljaFNlcS5nZXQoJ3NlcXVlbmNlJykpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnYWEnKS5hdHRyKCd4JywgZnVuY3Rpb24oYWEsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoaSArIDEpICogd1VuaXQ7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCAoLWlfbiArIDAuNSkgKiBoVW5pdCkudGV4dChmdW5jdGlvbihyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBzaXplID0gcmljaFNlcS5zaXplKCk7CiAgICAgICAgICAgIHZhciBtb2RpZnMgPSBbcmljaFNlcS5nZXRNb2RpZmljYXRpb25BcnJheSgtMSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJhYS5tb2RpZmljYXRpb25zCiAgICAgICAgICAgIH0pKS5jb25jYXQoW3JpY2hTZXEuZ2V0TW9kaWZpY2F0aW9uQXJyYXkoc2l6ZSldKTsKICAgICAgICAgICAgc2VsZi52aXouYXBwZW5kKCdnJykuc2VsZWN0QWxsKCd0ZXh0LmFhLW1vZGlmJykuZGF0YShtb2RpZnMpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnYWEtbW9kaWYnKS5hdHRyKCd4JywgZnVuY3Rpb24obW9kcywgaSkgewogICAgICAgICAgICAgICAgaWYoaT09MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdVbml0ICowLjQ1OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoaT09c2l6ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpLTAuNDUpKndVbml0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGkgKiB3VW5pdDsKICAgICAgICAgICAgfSkuYXR0cigneScsICgtaV9uICsgMC41KSAqIGhVbml0ICsgMTApLnRleHQoZnVuY3Rpb24obW9kcykgewogICAgICAgICAgICAgICAgaWYgKG1vZHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KG1vZHMsIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJywnKTsKCiAgICAgICAgICAgIH0pLnN0eWxlKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uKG1vZHMsIGkpewogICAgICAgICAgICAgICAgaWYoaT09MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdlbmQnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoaT09c2l6ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdzdGFydCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ21pZGRsZScKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgcGVhazJwb3MgPSBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VyaWVzID0gcC5zZXJpZXM7CiAgICAgICAgICAgICAgICBpZiAoc2VyaWVzIDwgJ20nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNOdGVybSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHggOiB3VW5pdCAqIChwLnBvcyArIDEuNSkgLSA3LAogICAgICAgICAgICAgICAgICAgICAgICB5IDogKHNlcmllczJpW3Nlcmllc10gLSBpX24pICogaFVuaXQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlzTnRlcm0gOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB4IDogd1VuaXQgKiAocC5wb3MgKyAuNSkgKyA3LAogICAgICAgICAgICAgICAgICAgIHkgOiAoc2VyaWVzMmlbc2VyaWVzXSAtIGlfbiArIDEpICogaFVuaXQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3BhdGguZnJhZ21lbnQnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ3BlYWtzJykpLmVudGVyKCkuYXBwZW5kKCdwYXRoJykuYXR0cignY2xhc3MnLCAnZnJhZ21lbnQnKS5hdHRyKCdkJywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgdmFyIHNlcmllcyA9IHAuc2VyaWVzOwogICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBlYWsycG9zKHApCiAgICAgICAgICAgICAgICBpZiAocG9zLmlzTnRlcm0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ00nICsgcG9zLnggKyAnLCcgKyBwb3MueSArICdsNywzIGwwLCcgKyAoaFVuaXQgLSA1KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdNJyArIHBvcy54ICsgJywnICsgcG9zLnkgKyAnbC03LC0zIGwwLCcgKyAoLWhVbml0ICsgNSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3RleHQuZnJhZy1tb3oucGVha3MnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ3BlYWtzJykpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnZnJhZy1tb3ogcGVha3MnKS5hdHRyKCd4JywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBlYWsycG9zKHApOwogICAgICAgICAgICAgICAgcmV0dXJuIHBvcy54ICsgKHBvcy5pc050ZXJtID8gLTMgOiArMyk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGVhazJwb3MocCkueSArIDM7CiAgICAgICAgICAgIH0pLnN0eWxlKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwZWFrMnBvcyhwKS5pc050ZXJtID8gJ2VuZCcgOiAnc3RhcnQnOwogICAgICAgICAgICB9KS50ZXh0KGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLm1vei50b0ZpeGVkKDQpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy9hZGQgZnJhZ3NlcmllcyBuYW1lIG9uIGxlZnQvcmlnaHQgY29sdW1uCiAgICAgICAgICAgIHZhciBkU2VyaWVzTmFtZXMgPSBfLnppcChfLmtleXMoc2VyaWVzMmkpLCBfLnZhbHVlcyhzZXJpZXMyaSkpOwogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3RleHQuZnJhZy1tb3oubGVnZW5kJykuZGF0YShkU2VyaWVzTmFtZXMpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnZnJhZy1tb3ogbGVnZW5kJykuYXR0cigneCcsIGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiAocFswXSA8ICdtJykgPyA1IDogKHdpZHRoIC0gNSk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICB2YXIgcGsgPSB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzIDogcFswXSwKICAgICAgICAgICAgICAgICAgICBwb3MgOiAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcGVhazJwb3MocGspLnkgKyAzOwogICAgICAgICAgICB9KS5zdHlsZSgndGV4dC1hbmNob3InLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHBbMF0gPiAnbScpID8gJ2VuZCcgOiAnc3RhcnQnOwogICAgICAgICAgICB9KS50ZXh0KGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwWzBdOwogICAgICAgICAgICB9KTsKCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFRoZW9PblNlcXVlbmNlVmlldzsKfSk7CgovKioKICogRXh0ZW5kcyBQZWFrTGlzdFBhaXJBbGlnbm1lbnQgZm9yIGEgcGFpciBvZiB0d28gRXhwU3BlY3RydW0KICogUHJvcGVydGllcyBhcmUKICogLSBzcGVjdHJ1bUEKICogLSBzcGVjdHJ1bUIKICoKICogYWxpZ25tZW50IGlzIHJlY29tcHV0ZWQgaWYgYW55IG9mIHRoZW0gdHJpZ2dlIGEgJ2NoYW5nZScgZXZlbnQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLFsndW5kZXJzY29yZScsICcuL1BlYWtMaXN0UGFpckFsaWdubWVudCddLCBmdW5jdGlvbihfLCBQZWFrTGlzdFBhaXJBbGlnbm1lbnQpIHsKCiAgICAvKioKICAgICAqIGJ1aWxkIHRoZSBhbGlnbm1lbnQgd2l0aCBvcHRpb25zIHtyaWNoU2VxdWVuY2U6Li4uLCBleHBTcGVjdHJ1bTouLi59CiAgICAgKi8KICAgIHZhciBQU01BbGlnbm1lbnQgPSBQZWFrTGlzdFBhaXJBbGlnbm1lbnQuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIFBTTUFsaWdubWVudC5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIHt9KTsKICAgICAgICAgICAgc2VsZi5idWlsZCgpCgogICAgICAgICAgICBzZWxmLmdldCgnc3BlY3RydW1BJykub24oImNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2VsZi5idWlsZCgpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuZ2V0KCdzcGVjdHJ1bUInKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgYnVpbGQgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zZXQoJ3BrbEEnLCBzZWxmLmdldCgnc3BlY3RydW1BJykpCiAgICAgICAgICAgIHNlbGYuc2V0KCdwa2xCJywgc2VsZi5nZXQoJ3NwZWN0cnVtQicpKQoKICAgICAgICAgICAgdmFyIG1hdGNoSW5kaWNlcyA9IHNlbGYubWF0Y2hJbmRpY2VzKCk7CgogICAgICAgICAgICB2YXIgeHBlYWtzQSA9IHNlbGYuZ2V0KCdzcGVjdHJ1bUEnKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllc0EgPSBzZWxmLmdldCgnc3BlY3RydW1BJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwogICAgICAgICAgICB2YXIgeHBlYWtzQiA9IHNlbGYuZ2V0KCdzcGVjdHJ1bUInKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllc0IgPSBzZWxmLmdldCgnc3BlY3RydW1CJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwoKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBfLm1hcChtYXRjaEluZGljZXMsIGZ1bmN0aW9uKG1pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHBrQiA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggOiBtaS5pQiwKICAgICAgICAgICAgICAgICAgICAgICAgbW96IDogeHBlYWtzQlttaS5pQl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNCW21pLmlCXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBrQSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggOiBtaS5pQSwKICAgICAgICAgICAgICAgICAgICAgICAgbW96IDogeHBlYWtzQVttaS5pQV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNBW21pLmlBXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGVycm9yUFBNIDogbWkuZXJyb3JQUE0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5zZXQoJ21hdGNoZXMnLCBtYXRjaGVzKTsKCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybiBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGV4cGVyaW1lbnRhbCBhbmQgdGhlIHRoZW9yZXRpY2FsIHByZWN1cnNvcnMgKE1IKQogICAgICAgICAqLwogICAgICAgIGRlbHRhUHJlY01venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeiA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgncHJlY0NoYXJnZScpOwogICAgICAgICAgICB2YXIgdGhlbyA9IG1hc3NCdWlsZGVyLmNvbXB1dGVNYXNzUmljaFNlcXVlbmNlKHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKSwgeikKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKSAtIHRoZW8pICogegogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHt7fX0gcmVhZHkgZm9yIEpTT04KICAgICAgICAgKi8KICAgICAgICBzZXJpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcmV0ID0ge307CiAgICAgICAgICAgIHJldC5leHBTcGVjdHJ1bSA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLnRvSlNPTigpCgogICAgICAgICAgICB2YXIgcnNlcSA9IHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKS50b1N0cmluZygpOwogICAgICAgICAgICByZXQucmljaFNlcXVlbmNlID0gcnNlcQoKICAgICAgICAgICAgcmV0LmlkID0gc2VsZi5jb21wdXRlSWQoKTsKICAgICAgICAgICAgcmV0LmFhU2VxdWVuY2UgPSBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9BQVN0cmluZygpOwoKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9LAogICAgICAgIGNvbXB1dGVJZCA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2lkJykgKyAnfCcgKyBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKQoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIHJldHVybiB0aGUgbnVtYmVyIG9mIHVubWFjdGhlZCBleHBlcmltZW50YWwgcGVhaywgd2l0aCBhIG1hc3MgZ3JlYXRlciB0aGFuIHRoZSBwcmVjdXJzb3IsCiAgICAgICAgICogaW50ZW5zaXR5IDwgaW5GaXJzdCBhbmQgd2l0aCB0b2wgZXJyb3IKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdG9sCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGluRmlyc3QKICAgICAgICAgKi8KICAgICAgICB1bm1hdGNoZWRGYWN0b3IgOiBmdW5jdGlvbih0b2wsIGluRmlyc3QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHNlbGYuY2xvc2VyVGhhblBQTSh0b2wpOwoKICAgICAgICAgICAgdmFyIHBrcyA9IF8uZmlsdGVyKF8uemlwKHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnbW96cycpLCBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2ludGVuc2l0eVJhbmtzJykpLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFsxXSA8IGluRmlyc3QKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbVByZWMgPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKQogICAgICAgICAgICByZXR1cm4gXy5maWx0ZXIocGtzLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFswXSA+IG1QcmVjOwogICAgICAgICAgICB9KS5sZW5ndGggLSBfLmZpbHRlcihtYXRjaGVzLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKG0uZXhwLmludGVuc2l0eVJhbmsgPCBpbkZpcnN0KSAmJiAobS5leHAubW96ID4gbVByZWMpOwogICAgICAgICAgICB9KS5sZW5ndGgKCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFBTTUFsaWdubWVudDsKfSk7CgovKgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uKF8sIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CiAgLyoKICAgKiBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgNCB2YWx1ZXM6CiAgICoKICAgKiAwOiBtb3oKICAgKiAxOmludGVuc2l0eQogICAqIDI6IGludGVuc2l0eSByYW5rcwogICAqIDM6IGlzTWF0aGNpbmcgKCBjb25zdHJ1Y3RlZCBhdCB0aGUgYnVpbGREYXRhIHN0ZXApCiAgICovCiAgdmFyIHByb2plY3RTcGVjdHJ1bSA9IGZ1bmN0aW9uKGV4cFNwKSB7CiAgICByZXR1cm4gewogICAgICBwcmVjdXJzb3IgOiB7CiAgICAgICAgc2Nhbk51bWJlciA6IGV4cFNwLmdldCgnc2Nhbk51bWJlcicpLAogICAgICAgIGlkIDogZXhwU3AuZ2V0KCdpZCcpCiAgICAgIH0sCiAgICAgIHBlYWtzIDogXy5jaGFpbihleHBTcC5nZXQoJ21venMnKSkuemlwKGV4cFNwLmdldCgnaW50ZW5zaXRpZXMnKSwgZXhwU3AuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKS52YWx1ZSgpCiAgICB9CiAgfQogIHZhciBwZWFrUmFua0NsYXNzID0gZnVuY3Rpb24ocGspIHsKICAgIHZhciBpcmsgPSBwa1syXTsKICAgIHJldHVybiAncmstJyArICgoaXJrIDwgNDApID8gTWF0aC5mbG9vcihpcmsgLyAxMCkgOiAneCcpOwogIH0KICB2YXIgU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgZGVmYXVsdHMgOiB7CiAgICB9LAogICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucykKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLmlzRW5oYW5jZWQgPSBvcHRpb25zLmVuaGFuY2VkOwogICAgICBzZWxmLm1heFJhbmtNYXRjaGluZ1BlYWtzID0gb3B0aW9ucy5tYXhQZWFrcyB8fCAxMDAwOwogICAgICBzZWxmLmluZGVwZW5kZW50WVNjYWxlcyA9IG9wdGlvbnMuaW5kZXBlbmRlbnRZU2NhbGVzOwogICAgICBzZWxmLmNvbG9yUGVha3MgPSBvcHRpb25zLmNvbG9yUGVha3M7CgogICAgICBzZWxmLmZyYWdUb2wgPSBvcHRpb25zLmZyYWdUb2wgfHwgMjA7CiAgICAgIHNlbGYuaGVpZ2h0TWlkZGxlWm9uZSA9IChzZWxmLmlzRW5oYW5jZWQpID8gKHNlbGYuaGVpZ2h0KCkgKiAwLjEpIDogMAoKICAgICAgc2VsZi5idWlsZCgpOwogICAgICBzZWxmLm1vZGVsLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZWxmLmJ1aWxkKCkucmVuZGVyKCk7CiAgICAgIH0pCiAgICB9LAoKICAgIGJ1aWxkIDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1aWxkRGF0YSgpLmJ1aWxkQ29udGV4dCgpLmJ1aWxkRDMoKTsKICAgIH0sCiAgICBidWlsZERhdGEgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLnNwQSA9IHByb2plY3RTcGVjdHJ1bShzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1BJykpOwogICAgICBzZWxmLnNwQiA9IHByb2plY3RTcGVjdHJ1bShzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1CJykpOwoKICAgICAgaWYgKHNlbGYuaXNFbmhhbmNlZCkgewogICAgICAgIF8uZWFjaChzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi5mcmFnVG9sKSwgZnVuY3Rpb24ocCkgewogICAgICAgICAgc2VsZi5zcEEucGVha3NbcC5wa0EuaW5kZXhdWzNdID0gdHJ1ZTsKICAgICAgICAgIHNlbGYuc3BCLnBlYWtzW3AucGtCLmluZGV4XVszXSA9IHRydWU7CiAgICAgICAgfSkKICAgICAgfQoKICAgICAgc2VsZi5hbGxQZWFrcyA9IHNlbGYuc3BBLnBlYWtzLm1hcChmdW5jdGlvbihwKSB7CiAgICAgICAgcFs0XSA9IDAKICAgICAgICByZXR1cm4gcDsKICAgICAgfSkuY29uY2F0KHNlbGYuc3BCLnBlYWtzLm1hcChmdW5jdGlvbihwKSB7CiAgICAgICAgcFs0XSA9IDEKICAgICAgICByZXR1cm4gcDsKICAgICAgfSkpCgogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICBidWlsZENvbnRleHQgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIHhNYXggPSBNYXRoLm1heChzZWxmLnNwQS5wZWFrc1tzZWxmLnNwQS5wZWFrcy5sZW5ndGgtMV1bMF0sIHNlbGYuc3BCLnBlYWtzW3NlbGYuc3BCLnBlYWtzLmxlbmd0aC0xXVswXSkgKiAxLjE7CiAgICAgIHZhciB4TWluID0gTWF0aC5tYXgoc2VsZi5zcEEucGVha3NbMF1bMF0sIHNlbGYuc3BCLnBlYWtzWzBdWzBdKSAqIDAuNTsKICAgICAgdmFyIHlNYXggPSBNYXRoLm1heChfLm1heChzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1BJykuZ2V0KCdpbnRlbnNpdGllcycpKSwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3NwZWN0cnVtQicpLmdldCgnaW50ZW5zaXRpZXMnKSkpICogMS4wNTsKCiAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgeERvbWFpbiA6IFt4TWluLCB4TWF4XSwKICAgICAgICB5RG9tYWluIDogWzAsIHlNYXhdLAogICAgICAgIGhlaWdodCA6IChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRNaWRkbGVab25lKSAvIDIsCiAgICAgICAgd2lkdGggOiBzZWxmLndpZHRoKCkKICAgICAgfSkKCiAgICAgIHJldHVybiBzZWxmOwogICAgfSwKICAgIGJ1aWxkRDMgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgc2VsZi52aXMgPSBzZWxmLmVsLmFwcGVuZCgnc3ZnJyk7CiAgICAgIHNlbGYudmlzLmF0dHIoJ3dpZHRoJywgc2VsZi53aWR0aCgpKS5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCgpKS5hdHRyKCdjbGFzcycsICdzcGVjdHJhLXBhaXItYWxpZ25tZW50Jyk7CiAgICAgIHNlbGYudmlzLmFwcGVuZCgnbGluZScpLmF0dHIoJ3kxJywgc2VsZi5oZWlnaHQoKSAvIDIpLmF0dHIoJ3kyJywgc2VsZi5oZWlnaHQoKSAvIDIpLmF0dHIoJ3gxJywgMCkuYXR0cigneDInLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2NsYXNzJywgJ2F4aXMnKQoKICAgICAgdmFyIHlzID0gW3NlbGYuc2NhbGluZ0NvbnRleHQueSgpLCBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKV0KCiAgICAgIHlzWzFdLnJhbmdlKFsoc2VsZi5oZWlnaHQoKSArIHNlbGYuaGVpZ2h0TWlkZGxlWm9uZSkgLyAyLCBzZWxmLmhlaWdodCgpXSk7CiAgICAgIGlmIChzZWxmLmluZGVwZW5kZW50WVNjYWxlcykgewogICAgICAgIHlzWzBdLmRvbWFpbihbMCwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3NwZWN0cnVtQScpLmdldCgnaW50ZW5zaXRpZXMnKSkgKiAxLjA1XSkKICAgICAgICB5c1sxXS5kb21haW4oWzAsIF8ubWF4KHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUInKS5nZXQoJ2ludGVuc2l0aWVzJykpICogMS4wNV0pCiAgICAgIH0KCiAgICAgIHZhciBqMHVwID0gKHNlbGYuaGVpZ2h0KCkgLSBzZWxmLmhlaWdodE1pZGRsZVpvbmUpIC8gMjsKICAgICAgdmFyIGowZG93biA9IChzZWxmLmhlaWdodCgpICsgc2VsZi5oZWlnaHRNaWRkbGVab25lKSAvIDI7CgogICAgICBzZWxmLnBlYWtzSG9sZGVyID0gc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsnKS5kYXRhKHNlbGYuYWxsUGVha3MpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihwaykgewogICAgICAgIHZhciBjbCA9ICdwZWFrICBwZWFrLXgnOwogICAgICAgIGlmIChzZWxmLmNvbG9yUGVha3MpIHsKICAgICAgICAgIGNsICs9ICcgJyArIHBlYWtSYW5rQ2xhc3MocGspOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5pc0VuaGFuY2VkKSB7CiAgICAgICAgICBjbCArPSBwa1szXSA/ICIgbWF0Y2hlZCIgOiAiIHVubWF0Y2hlZCI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjbDsKICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbihwaykgewogICAgICAgIHJldHVybiB5c1twa1s0XV0oMCk7CiAgICAgICAgLy8ocGtbMV0gPiAwKSA/IGowdXAgOiBqMGRvd247CiAgICAgIH0pLmF0dHIoJ3kyJywgZnVuY3Rpb24ocGspIHsKICAgICAgICByZXR1cm4geXNbcGtbNF1dKHBrWzFdKS8vKHBrWzFdID4gMCkgPyAoajB1cCAtIHkocGtbMV0pKSA6IChqMGRvd24gKyB5KC1wa1sxXSkpOwogICAgICB9KTsKCiAgICAgIGlmIChzZWxmLmlzRW5oYW5jZWQpIHsKICAgICAgICBzZWxmLnZpcy5zZWxlY3RBbGwoJ2xpbmUucGVhay1tYXRjaCcpLmRhdGEoXy5maWx0ZXIoc2VsZi5zcEEucGVha3MuY29uY2F0KHNlbGYuc3BCLnBlYWtzKSwgZnVuY3Rpb24ocGspIHsKICAgICAgICAgIHJldHVybiBwa1szXSAmJiAocGtbMl0gPCBzZWxmLm1heFJhbmtNYXRjaGluZ1BlYWtzICk7CiAgICAgICAgfSkpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihwaykgewogICAgICAgICAgdmFyIGNsID0gJ3BlYWsgcGVhay1tYXRjaCBwZWFrLXgnOwogICAgICAgICAgY2wgKz0gJyAnICsgcGVha1JhbmtDbGFzcyhwayk7CiAgICAgICAgICByZXR1cm4gY2wKICAgICAgICB9KS5hdHRyKCd5MScsIHNlbGYuaGVpZ2h0KCkgLyAyKS5hdHRyKCd5MicsIGZ1bmN0aW9uKHBrKSB7CiAgICAgICAgICByZXR1cm4gKHBrWzRdID09IDApID8gajB1cCA6IGowZG93bjsKICAgICAgICB9KQogICAgICB9CgogICAgICB2YXIgZ3RpdGxlcyA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3RpdGxlcycpCiAgICAgIGd0aXRsZXMuYXBwZW5kKCd0ZXh0JykudGV4dCgnIycgKyBzZWxmLnNwQS5wcmVjdXJzb3Iuc2Nhbk51bWJlcikuYXR0cigneCcsIHNlbGYud2lkdGgoKSAtIDUpLmF0dHIoJ3knLCAzMCkuYXR0cignY2xhc3MnLCAnc2NhbiB0b3AnKQogICAgICBndGl0bGVzLmFwcGVuZCgndGV4dCcpLnRleHQoJyMnICsgc2VsZi5zcEIucHJlY3Vyc29yLnNjYW5OdW1iZXIpLmF0dHIoJ3gnLCBzZWxmLndpZHRoKCkgLSA1KS5hdHRyKCd5Jywgc2VsZi5oZWlnaHQoKSAtIDMwKS5hdHRyKCdjbGFzcycsICdzY2FuIGJvdHRvbScpCgogICAgICBzZWxmLmF4aXNDb250YWluZXIgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdheGlzJyk7CgogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgeCA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwoKICAgICAgc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsteCcpLmF0dHIoJ3gxJywgZnVuY3Rpb24ocGspIHsKICAgICAgICByZXR1cm4geChwa1swXSkKICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbihwaykgewogICAgICAgIHJldHVybiB4KHBrWzBdKQogICAgICB9KTsKICAgICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS50aWNrU2l6ZSg2LCAwLCAwKS50aWNrcygzKS8vIiIudGlja0Zvcm1hdChkMy5mb3JtYXQoImQiKSk7CiAgICAgIHNlbGYuYXhpc0NvbnRhaW5lci5jYWxsKHhBeGlzKTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIFNwZWN0cmFQYWlyQWxpZ25tZW50VmlldzsKCn0pCjsKLyoqCiAqIHRoaXMgaXMgYSBncmlkIGZvciBkaXNwbGF5aW5nIGEgc3BlY3RydW0vcGVwdGlkZSBtYXRjaC4gVGhlIGNsYXNzaWMgc3R1ZmYsIGFzCiAqIGEgaHRtbCB0YWJsZSwgYWRkaW5nIGNvbG9yIGFuZCBzby4uLgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hHcmlkVmFsdWVzVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldyddLCBmdW5jdGlvbiAoXywgQmFja2JvbmUsIENvbW1vbldpZGdldFZpZXcpIHsKCiAgICBNYXRjaEdyaWRWYWx1ZXNWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgTWF0Y2hHcmlkVmFsdWVzVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cykKCiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNDAwOwogICAgICAgICAgICBzZWxmLndpZHRoID0gb3B0aW9ucy53aWR0aCB8fCAzMDA7CiAgICAgICAgICAgIHNlbGYudG9sID0gb3B0aW9ucy50b2wgfHwgNTAwOwoKICAgICAgICAgICAgc2VsZi5lbC5jbGFzc2VkKCdkMy13aWRnZXQtbWF0Y2gtZ3JpZC12YWx1ZXMnLCB0cnVlKQogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgdGhlb1NwZWN0cnVtID0gc2VsZi5tb2RlbC5nZXQoJ3RoZW9TcGVjdHJ1bScpOwogICAgICAgICAgICB2YXIgbmJTZXJpZXMgPSB0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoCgogICAgICAgICAgICBzZWxmLmVsLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCd3aWR0aCcsIHNlbGYud2lkdGgpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KQogICAgICAgICAgICAvLyBnZXQgZnJhZyBzZXJpZXMgLT4gb3JkaW5hdGUKICAgICAgICAgICAgdmFyIHNlcmllczJpID0ge307CiAgICAgICAgICAgIHZhciBpX2MgPSAwOwogICAgICAgICAgICB2YXIgaV9uID0gMDsKICAgICAgICAgICAgXy5lYWNoKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSwgZnVuY3Rpb24gKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoZnMgPCAnbScpIHsvLyBudGVybQogICAgICAgICAgICAgICAgICAgIGlfbiA9IGlfbiAtIDM7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9uICsgMjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaV9jID0gaV9jICsgMwogICAgICAgICAgICAgICAgICAgIHNlcmllczJpW2ZzXSA9IGlfYyArIDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byBzY2FsZSBbMDood2lkdGggLSAyKjEwKV0geCBbMC1oZWlnaHRdIHRvIFtpX246aV9jKzFdIHgKICAgICAgICAgICAgLy8gWy0xOiB0aGVvU3BlY3RydW0ucmljaFNlcXVlbmNlLnNpemUoKV0KICAgICAgICAgICAgdmFyIHJpY2hTZXEgPSB0aGVvU3BlY3RydW0uZ2V0KCdyaWNoU2VxdWVuY2UnKTsKICAgICAgICAgICAgdmFyIHNpemUgPSByaWNoU2VxLnNpemUoKTsKCiAgICAgICAgICAgIHZhciBzY2FsZSA9IE1hdGgubWluKCgoc2VsZi53aWR0aCkgLyAoaV9jICsgMSAtIGlfbiArIDMpKSwgKHNlbGYuaGVpZ2h0IC8gKHNpemUgKyAxKSkpOwogICAgICAgICAgICB2YXIgdHJhbnNmID0gJ3NjYWxlKCcgKyBzY2FsZSArICcsJyArIHNjYWxlICsgJyksdHJhbnNsYXRlKCcgKyAoLWlfbiArIDEpICsgJywxLjcpJzsKCiAgICAgICAgICAgIHZhciBnQ29udCA9IHNlbGYuZWwuYXBwZW5kKCdnJykuYXR0cigndHJhbnNmb3JtJywgdHJhbnNmKTsKCiAgICAgICAgICAgIHZhciBmczJpID0gZnVuY3Rpb24gKGZzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWVzMmlbZnNdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRhdGEgbWF0Y2hlcwogICAgICAgICAgICB2YXIgZG1hdGNoZXMgPSBzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi50b2wpOwoKICAgICAgICAgICAgZ0NvbnQuc2VsZWN0QWxsKCd0ZXh0LmFhJykuZGF0YShyaWNoU2VxLmdldCgnc2VxdWVuY2UnKSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS5hdHRyKCdjbGFzcycsICdhYScpLmF0dHIoJ3gnLCAxKS5hdHRyKCd5JywgZnVuY3Rpb24gKGQsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpICsgMC41CiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkLmFhLmdldCgnY29kZTEnKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBtb2RpZnMgPSBbcmljaFNlcS5nZXRNb2RpZmljYXRpb25BcnJheSgtMSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uIChyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEubW9kaWZpY2F0aW9ucwogICAgICAgICAgICB9KSkuY29uY2F0KFtyaWNoU2VxLmdldE1vZGlmaWNhdGlvbkFycmF5KHNpemUpXSk7CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5hYS1tb2RpZicpLmRhdGEobW9kaWZzKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ2FhLW1vZGlmJykuYXR0cigneCcsIDEpLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCwgaSkgewogICAgICAgICAgICAgICAgaWYgKGkgPT0gc2l6ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpICsgMC4zMiAtIDAuNSArIDAuNQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGkgKyAwLjMyIC0gMSArIDAuNTsKICAgICAgICAgICAgfSkudGV4dChmdW5jdGlvbiAobW9kcykgewogICAgICAgICAgICAgICAgaWYgKG1vZHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KG1vZHMsIGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uZ2V0KCduYW1lJyk7CiAgICAgICAgICAgICAgICB9KS5qb2luKCcsJyk7CgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5zZXJpZXMnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS5hdHRyKCdjbGFzcycsICdzZXJpZXMnKS5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZXJpZXMyaVtkXTsKICAgICAgICAgICAgfSkuYXR0cigneScsIC0xKS50ZXh0KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgcG9zbGFiID0gW107CiAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBwb3NsYWIucHVzaChpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5wb3NsYWJlbC5udGVybScpLmRhdGEocG9zbGFiKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3Bvc2xhYmVsIG50ZXJtJykuYXR0cigneCcsIGlfbiAtIDAuOSkuYXR0cigneScsIGZ1bmN0aW9uIChkLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaSArIDEKICAgICAgICAgICAgfSkudGV4dChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5wb3NsYWJlbC5jdGVybScpLmRhdGEocG9zbGFiKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3Bvc2xhYmVsIGN0ZXJtJykuYXR0cigneCcsIGlfYyArIDIuOSkuYXR0cigneScsIGZ1bmN0aW9uIChkLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZSAtIGkgLSAxCiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZ0NvbnQuc2VsZWN0QWxsKCd0ZXh0LnRoZW9mcmFnJykuZGF0YSh0aGVvU3BlY3RydW0uZ2V0KCdwZWFrcycpKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3RoZW9mcmFnJykuYXR0cigneCcsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWVzMmlbcC5zZXJpZXNdCiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIChwLnNlcmllcyA8ICdnJykgPyAocC5wb3MgKyAxKSA6IHAucG9zCiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLm1vei50b0ZpeGVkKDIpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgncmVjdC5tYXRjaGluZycpLmRhdGEoZG1hdGNoZXMpLmVudGVyKCkuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgdmFyIGlyayA9IGQuZXhwLmludGVuc2l0eVJhbms7CiAgICAgICAgICAgICAgICByZXR1cm4gIm1hdGNoaW5nIHJrLSIgKyAoKGlyayA8IDQwKSA/IE1hdGguZmxvb3IoaXJrIC8gMTApIDogJ3gnKQogICAgICAgICAgICB9KS5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZXJpZXMyaVtkLnRoZW8uc2VyaWVzXSAtIDIuOAogICAgICAgICAgICB9KS5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoZC50aGVvLnNlcmllcyA8ICdnJykgPyAoZC50aGVvLnBvcyAtIDAuNyArIDEpIDogKGQudGhlby5wb3MgLSAwLjcpOwogICAgICAgICAgICB9KS5hdHRyKCd3aWR0aCcsIDMpLmF0dHIoJ2hlaWdodCcsIDEpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBNYXRjaEdyaWRWYWx1ZXNWaWV3Owp9KTsKCi8qCiAqIGEgY29tcGFjdCBpY29uaWMgdmlldyBvZiBTcGVjdHJ1bS9TcGVjdHJ1bSBhbGlnbm1lbnQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50SWNvbicsWyd1bmRlcnNjb3JlJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uIChfLCBkMywgQ29tbW9uV2lkZ2V0VmlldywgRGVsdGFNYXNzLCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CgogICAgdmFyIHByb2plY3RTcGVjdHJ1bSA9IGZ1bmN0aW9uIChleHBTcCwgc2FtcGxlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlY3Vyc29yOiB7CiAgICAgICAgICAgICAgICBzY2FuTnVtYmVyOiBleHBTcC5nZXQoJ3NjYW5OdW1iZXInKSwKICAgICAgICAgICAgICAgIGlkOiBleHBTcC5nZXQoJ2lkJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcGVha3M6IF8uY2hhaW4oZXhwU3AuZ2V0KCdtb3pzJykpLnppcChleHBTcC5nZXQoJ2ludGVuc2l0aWVzJyksIGV4cFNwLmdldCgnaW50ZW5zaXR5UmFua3MnKSkubWFwKGZ1bmN0aW9uIChwLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIG1vejogcFswXSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rOiBwWzJdLAogICAgICAgICAgICAgICAgICAgIG9yaWdJbmRleDogaSwKICAgICAgICAgICAgICAgICAgICBzYW1wbGU6IHNhbXBsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkudmFsdWUoKQogICAgICAgIH0KICAgIH0KICAgIHZhciBTcGVjdHJhUGFpckFsaWdubWVudEljb24gPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIFNwZWN0cmFQYWlyQWxpZ25tZW50SWNvbi5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpCiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYubWF4UGVha3MgPSBvcHRpb25zLm1heFBlYWtzIHx8IDUwOwogICAgICAgICAgICBzZWxmLmZyYWdUb2wgPSBvcHRpb25zLmZyYWdUb2wgfHwgMjA7CgogICAgICAgICAgICBzZWxmLmJ1aWxkKCk7CiAgICAgICAgICAgIHNlbGYubW9kZWwub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuYnVpbGQoKS5yZW5kZXIoKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGJ1aWxkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkRGF0YSgpLmJ1aWxkQ29udGV4dCgpLmJ1aWxkRDMoKTsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRGF0YTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuc3BBID0gcHJvamVjdFNwZWN0cnVtKHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUEnKSwgMCk7CiAgICAgICAgICAgIHNlbGYuc3BCID0gcHJvamVjdFNwZWN0cnVtKHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUInKSwgMSk7CgogICAgICAgICAgICAvL2xhYmVsIHRoZSBwZWFrcwogICAgICAgICAgICB2YXIgcGtCaW5zID0gWwogICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICBbXQogICAgICAgICAgICBdCgogICAgICAgICAgICAvL29uZSBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgW21veiwgaW50ZW5zaXR5LCBpbnRlbnNpdHlSYW5rLCBpc01hdGNoaW5nLCBzYW1wbGVOYW1lLCBvdmVyYWxsTnVtYmVyXQoKICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3MgPSBfLmNoYWluKHNlbGYuc3BBLnBlYWtzLmNvbmNhdChzZWxmLnNwQi5wZWFrcykpLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAuaW50ZW5zaXR5UmFuayA8IHNlbGYubWF4UGVha3M7CiAgICAgICAgICAgIH0pLnNvcnRCeShmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAubW96OwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHAsIGkpIHsKICAgICAgICAgICAgICAgIHAuYmluSW5kZXggPSBpOwogICAgICAgICAgICAgICAgcC5tYXRjaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBwa0JpbnNbcC5zYW1wbGVdW3Aub3JpZ0luZGV4XSA9IGk7CiAgICAgICAgICAgICAgICByZXR1cm4gcDsKICAgICAgICAgICAgfSkudmFsdWUoKTsKCiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gc2VsZi5tb2RlbC5jbG9zZXJUaGFuUFBNKHNlbGYuZnJhZ1RvbCk7CiAgICAgICAgICAgIF8uZWFjaChtYXRjaGVzLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgaWYgKChtLnBrQi5pbnRlbnNpdHlSYW5rID49IHNlbGYubWF4UGVha3MpIHx8IChtLnBrQS5pbnRlbnNpdHlSYW5rID49IHNlbGYubWF4UGVha3MpKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIHNlbGYuc29ydGVkTWF0Y2hlZFBlYWtzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHNhbXBsZTogMSwKICAgICAgICAgICAgICAgICAgICBiaW5JbmRleDogcGtCaW5zWzBdW20ucGtBLmluZGV4XSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rOiBtLnBrQi5pbnRlbnNpdHlSYW5rLAogICAgICAgICAgICAgICAgICAgIG1hdGNoZWQ6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgc2FtcGxlOiAwLAogICAgICAgICAgICAgICAgICAgIGJpbkluZGV4OiBwa0JpbnNbMV1bbS5wa0IuaW5kZXhdLAogICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbms6IG0ucGtBLmludGVuc2l0eVJhbmssCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZDogdHJ1ZQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBzZWxmLnNvcnRlZE1hdGNoZWRQZWFrc1twa0JpbnNbMV1bbS5wa0IuaW5kZXhdXS5tYXRjaGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3NbcGtCaW5zWzBdW20ucGtBLmluZGV4XV0ubWF0Y2hlZCA9IHRydWUKCgogICAgICAgICAgICB9KQoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICBidWlsZENvbnRleHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dCA9IG5ldyBEM1NjYWxpbmdDb250ZXh0KHsKICAgICAgICAgICAgICAgIHhEb21haW46IFswLCAyICogc2VsZi5tYXhQZWFrc10sCiAgICAgICAgICAgICAgICB5RG9tYWluOiBbMiwgMF0sCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNlbGYuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRDM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLnZpcyA9IHNlbGYuZWwuYXBwZW5kKCdzdmcnKTsKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KCkpLmF0dHIoJ2NsYXNzJywgJ3NwZWN0cmEtcGFpci1pY29uJyk7CiAgICAgICAgICAgIHNlbGYudmlzLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ3dpZHRoJywgJzEwMCUnKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIgPSBzZWxmLnZpcy5zZWxlY3RBbGwoJ3JlY3QucGVhay1iaW4nKS5kYXRhKHNlbGYuc29ydGVkTWF0Y2hlZFBlYWtzKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ3BlYWstYmluJyk7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsKICAgICAgICAgICAgdmFyIHkgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIuYXR0cigneCcsIGZ1bmN0aW9uIChwaykgewogICAgICAgICAgICAgICAgLy8gaWYocGtbNF09PSdCJyAmJiBwWzNdKXsKICAgICAgICAgICAgICAgIC8vIHJldHVybiB4KHBrWzVdLTEpCiAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICByZXR1cm4geChway5iaW5JbmRleCkKICAgICAgICAgICAgfSkuYXR0cignd2lkdGgnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB4KDEpCiAgICAgICAgICAgIH0pLmF0dHIoJ2hlaWdodCcsIHkoMSkpLmF0dHIoJ3knLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB5KHBrLnNhbXBsZSkKICAgICAgICAgICAgfSkuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHZhciBpcmsgPSBway5pbnRlbnNpdHlSYW5rOwogICAgICAgICAgICAgICAgdmFyIGNsID0gJ3NwZWN0cmEtcGFpci1pY29uLWJpbiByay0nICsgKChpcmsgPCA0MCkgPyBNYXRoLmZsb29yKGlyayAvIDEwKSA6ICd4Jyk7CiAgICAgICAgICAgICAgICBpZiAocGsubWF0Y2hlZCkKICAgICAgICAgICAgICAgICAgICBjbCArPSAiIG1hdGNoZWQiCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY2wgKz0gIiB1bm1hdGNoZWQiCiAgICAgICAgICAgICAgICByZXR1cm4gY2w7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBTcGVjdHJhUGFpckFsaWdubWVudEljb247Cgp9KTsKLyoqCiAqIHdyYXBwIGFsbCBleHBvc2VkIGZ1bmN0aW9uIGhhbmRsZXJzIGFuZCBwcm90b3R5cGVzCiAqCiAqIHRoZXJlIGlzIHNvbWUgcmVwZXRpdGlvbiBhbmQgc29tZSBvcmRlci4gQnV0IEkgY2Fubm90IGZpZ3VyZSBvdXQgd2hhdCBpcyBoYXBwZW5pbmcgd2l0aCBhbG1vbmQsIHdoaWNoIGxvb2sgbGlrZSBpdCBkb2VzIG5vdCBpbnRlcnByZXQgJ2RlZmluZScgaW4gc29tZSBjYXNzaWMgd2F5Li4uCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKKGZ1bmN0aW9uICgpIHsKICAgIGRlZmluZSgnanF1ZXJ5LXBsdXMnLCBbJ2pxdWVyeScsICdib290c3RyYXAnLCAndHlwZWFoZWFkJywgJ2pRdWVyeUNvb2tpZSddLCBmdW5jdGlvbiAoJCkgewogICAgICAgIHJldHVybiAkOwogICAgfSk7CgogICAgdmFyIGV4cG9ydGVkID0gewogICAgICAgIHdldDogWydDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwTVNNU1NwZWN0cnVtJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9NU01TUnVuJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L0luamVjdGlvbicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9FeHBlcmltZW50JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsICdmaXNodG9uZXMvdmlld3Mvd2V0L1hJQ1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9NdWx0aVhJQ1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNNdWx0aVBhbmVWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvU3BlY3RydW1WaWV3J10sCiAgICAgICAgZHJ5OiBbJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9NYXNzQnVpbGRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL3ZpZXdzL2RyeS9mb3Jtcy9SaWNoU2VxdWVuY2VJbnB1dCcsICdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldyddLAogICAgICAgIG1hdGNoOiBbJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50VmlldycsICdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsICdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoR3JpZFZhbHVlc1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFNsaW1WaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9TcGVjdHJhUGFpckFsaWdubWVudEljb24nXSwKICAgICAgICB1dGlsczogWydmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJ10KICAgIH0KCiAgICBjb25zdCBjbGFzc1BhdGhzID0gW107CiAgICB2YXIgYWxsID0gW107CiAgICB2YXIgdHlwZTJjYXQgPSB7fTsKCiAgICBbJ3dldCcsICdkcnknLCAnbWF0Y2gnLCAndXRpbHMnXS5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHsKICAgICAgICB2YXIgbCA9IGV4cG9ydGVkW2NhdF07CiAgICAgICAgZm9yIChpIGluIGwpIHsKICAgICAgICAgICAgdmFyIHR5cGUgPSBsW2ldOwogICAgICAgICAgICB0eXBlMmNhdFt0eXBlXSA9IGNhdDsKICAgICAgICAgICAgYWxsLnB1c2godHlwZSk7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyIGJ1aWxkRXhwb3J0ID0gZnVuY3Rpb24gKF8pIHsKICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgdmFyICQgPSBhcmdzLnNoaWZ0KCk7CiAgICAgICAgdmFyIGV4cCA9IHt9CiAgICAgICAgZm9yIChpIGluIGFsbCkgewogICAgICAgICAgICB2YXIgYXJnID0gYXJnc1tpXTsKICAgICAgICAgICAgdmFyIHR5cGUgPSBhbGxbaV0KICAgICAgICAgICAgdmFyIHNpbXBsZU5hbWUgPSB0eXBlLnJlcGxhY2UoLy4qXC8vLCAnJyk7CiAgICAgICAgICAgIHZhciBjYXQgPSB0eXBlMmNhdFt0eXBlXTsKCiAgICAgICAgICAgIGlmIChleHBbY2F0XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBleHBbY2F0XSA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV4cFtjYXRdW3NpbXBsZU5hbWVdID0gYXJnc1tpXTsKICAgICAgICB9CiAgICAgICAgZXhwLmRlcHMgPSB7CiAgICAgICAgICAgICckJzogJAogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH07CgogICAgZGVmaW5lKCdNU01TSlNFeHBvcnQnLFsKICAgICAgICAnanF1ZXJ5JywKICAgICAgICAnQ29uZmlnJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L0V4cE1TTVNTcGVjdHJ1bScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvTVNNU1J1bicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9JbmplY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwZXJpbWVudCcsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L1hJQ0NvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvTXVsdGlYSUNWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvWElDTXVsdGlQYW5lVmlldycsICdmaXNodG9uZXMvdmlld3Mvd2V0L1NwZWN0cnVtVmlldycsCiAgICAgICAgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9NYXNzQnVpbGRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL3ZpZXdzL2RyeS9mb3Jtcy9SaWNoU2VxdWVuY2VJbnB1dCcsICdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldycsCiAgICAgICAgJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50VmlldycsICdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsICdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoR3JpZFZhbHVlc1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFNsaW1WaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9TcGVjdHJhUGFpckFsaWdubWVudEljb24nLAogICAgICAgICdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJywKICAgIF0sIGJ1aWxkRXhwb3J0KTsKCn0pKCk7CgogICAgcmV0dXJuIHJlcXVpcmUoJ01TTVNKU0V4cG9ydCcpOwp9KSk7",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 00:21:24 GMT",
                    "Content-Length": "899145",
                    "Date": "Fri, 07 Nov 2014 00:21:25 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}