{
    "url": "http://localhost:9999/foam-framework/foam/core/TemplateUtil.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>self.name</b> and written to <b>the 'open()' function of an XMLHttpRequest object</b> via the following statements:<ul><li>path += self.name + '_' + t.name + '.ft';</li><li>xhr.open(\"GET\", path);</li></ul><b>Note:</b> The name of the current window is a valid attack vector for DOM-based vulnerabilities. An attacker can directly control the name of the targeted application's window by using code on their own domain to load the targeted page using either window.open() or an iframe tag, and specifying the desired window name. ",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/foam-framework/foam/core/TemplateUtil.js",
                "path": "/foam-framework/foam/core/TemplateUtil.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9mb2FtLWZyYW1ld29yay9mb2FtL2NvcmUvVGVtcGxhdGVVdGlsLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTIxMzgNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDA6MzY6NTcgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDAwOjM2OjU2IEdNVA0KDQovKioKICogQGxpY2Vuc2UKICogQ29weXJpZ2h0IDIwMTMgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCgovKioKICogU2ltcGxlIHRlbXBsYXRlIHN5c3RlbSBtb2RlbGxlZCBhZnRlciBKU1Ancy4KICoKICogU3ludGF4OgogKiAgICA8JSBjb2RlICU+OiBjb2RlIGluc2VydGVkIGludG8gdGVtcGxhdGUsIGJ1dCBub3RoaW5nIGltcGxpY2l0bHkgb3V0cHV0CiAqICAgIDwlPSBjb21tYS1zZXBhcmF0ZWQtdmFsdWVzICU+OiBhbGwgdmFsdWVzIGFyZSBhcHBlbmRlZCB0byB0ZW1wbGF0ZSBvdXRwdXQKICogICAgPCUjIGV4cHJlc3Npb24gJT46IGR5bmFtaWMgKGF1dG8tdXBkYXRpbmcpIGV4cHJlc3Npb24gaXMgb3V0cHV0CiAqICAgIFw8bmV3LWxpbmU+OiBpZ25vcmVkCiAqICAgICUldmFsdWUoPHdoaXRlc3BhY2U+fDwpOiBvdXRwdXQgYSBzaW5nbGUgdmFsdWUgdG8gdGhlIHRlbXBsYXRlIG91dHB1dAogKiAgICAkJGZlYXR1cmUoPHdoaXRlc3BhY2U+fDwpOiBvdXRwdXQgdGhlIFZpZXcgb3IgQWN0aW9uIGZvciB0aGUgY3VycmVudCBWYWx1ZQogKi8KCnZhciBGT0FNVGFnUGFyc2VyID0gewogIF9fcHJvdG9fXzogZ3JhbW1hciwKCiAgY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB7CiAgICAgIF9fcHJvdG9fXzogdGhpcywKICAgICAgaHRtbDogICAgICBIVE1MUGFyc2VyLmNyZWF0ZSgpLmV4cG9ydCgnU1RBUlQnKQogICAgfTsKICB9LAoKICBTVEFSVDogc3ltKCd0YWcnKSwKCiAgdGFnOiBzZXEoCiAgICAnPCcsCiAgICBsaXRlcmFsX2ljKCdmb2FtJyksCiAgICBzeW0oJ3doaXRlc3BhY2UnKSwKICAgIHN5bSgnYXR0cmlidXRlcycpLAogICAgc3ltKCd3aGl0ZXNwYWNlJyksCiAgICBhbHQoc3ltKCdjbG9zZWQnKSwgc3ltKCdtYXRjaGluZycpKQogICksCgogIGNsb3NlZDogbGl0ZXJhbCgnLz4nKSwKCiAgbWF0Y2hpbmc6IHNlcTEoMSwnPicsIHN5bSgnaHRtbCcpLCBzeW0oJ2VuZFRhZycpKSwKCiAgZW5kVGFnOiBzZXExKDEsICc8LycsIGxpdGVyYWxfaWMoJ2ZvYW0nKSwgJz4nKSwKCiAgbGFiZWw6IHN0cihwbHVzKG5vdENoYXJzKCcgPS9cdFxyXG48PlwnIicpKSksCgogIGF0dHJpYnV0ZXM6IHJlcGVhdChzeW0oJ2F0dHJpYnV0ZScpLCBzeW0oJ3doaXRlc3BhY2UnKSksCgogIGF0dHJpYnV0ZTogc2VxKHN5bSgnbGFiZWwnKSwgJz0nLCBzeW0oJ3ZhbHVlJykpLAoKICB2YWx1ZTogc3RyKGFsdCgKICAgIHBsdXMoYWx0KHJhbmdlKCdhJywneicpLCByYW5nZSgnQScsICdaJyksIHJhbmdlKCcwJywgJzknKSkpLAogICAgc2VxMSgxLCAnIicsIHJlcGVhdChub3RDaGFyKCciJykpLCAnIicpCiAgKSksCgogIHdoaXRlc3BhY2U6IHJlcGVhdChhbHQoJyAnLCAnXHQnLCAnXHInLCAnXG4nKSkKCn0uYWRkQWN0aW9ucyh7CiAgYXR0cmlidXRlczogZnVuY3Rpb24oeHMpIHsKICAgIHZhciBhdHRycyA9IHt9OwogICAgeHMuZm9yRWFjaChmdW5jdGlvbihhdHRyKSB7IGF0dHJzW2F0dHJbMF1dID0gYXR0clsyXTsgfSk7CiAgICByZXR1cm4gYXR0cnM7CiAgfSwKICB0YWc6ICAgICAgZnVuY3Rpb24oeHMpIHsgcmV0dXJuIFRhZy5jcmVhdGUoeHNbMV0sIHhzWzNdLCB4c1s1XSk7IH0sCiAgY2xvc2VkOiAgIGZ1bmN0aW9uKCkgICB7IHJldHVybiBbXTsgfSwKICBtYXRjaGluZzogZnVuY3Rpb24oeHMpIHsgcmV0dXJuIHhzLmNoaWxkcmVuOyB9Cn0pOwoKCnZhciBUZW1wbGF0ZVBhcnNlciA9IHsKICBfX3Byb3RvX186IGdyYW1tYXIsCgogIFNUQVJUOiBzeW0oJ21hcmt1cCcpLAoKICBtYXJrdXA6IHJlcGVhdDAoYWx0KAogICAgc3ltKCdmb2FtVGFnJyksCiAgICBzeW0oJ2NyZWF0ZSBjaGlsZCcpLAogICAgc3ltKCdzaW1wbGUgdmFsdWUnKSwKICAgIHN5bSgnbGl2ZSB2YWx1ZSB0YWcnKSwKICAgIHN5bSgncmF3IHZhbHVlcyB0YWcnKSwKICAgIHN5bSgndmFsdWVzIHRhZycpLAogICAgc3ltKCdjb2RlIHRhZycpLAogICAgc3ltKCdpZ25vcmVkIG5ld2xpbmUnKSwKICAgIHN5bSgnbmV3bGluZScpLAogICAgc3ltKCdzaW5nbGUgcXVvdGUnKSwKICAgIHN5bSgndGV4dCcpCiAgKSksCgogICdmb2FtVGFnJzogRk9BTVRhZ1BhcnNlci5jcmVhdGUoKS5leHBvcnQoJ1NUQVJUJyksCgogICdjcmVhdGUgY2hpbGQnOiBzZXEoJyQkJywgcmVwZWF0KG5vdENoYXJzKCcgJFxuPHsnKSksCiAgICAgICAgICAgICAgICAgICAgICBvcHRpb25hbChKU09OUGFyc2VyLmV4cG9ydCgnb2JqQXNTdHJpbmcnKSkpLAoKICAnc2ltcGxlIHZhbHVlJzogc2VxKCclJScsIHJlcGVhdChub3RDaGFycygnICJcbjwnKSkpLAoKICAnbGl2ZSB2YWx1ZSB0YWcnOiBzZXEoJzwlIycsIHJlcGVhdChub3QoJyU+JywgYW55Q2hhcikpLCAnJT4nKSwKCiAgJ3JhdyB2YWx1ZXMgdGFnJzogYWx0KAogICAgc2VxKCc8JT0nLCByZXBlYXQobm90KCclPicsIGFueUNoYXIpKSwgJyU+JyksCiAgICBzZXEoJ3t7eycsIHJlcGVhdChub3QoJ319fScsIGFueUNoYXIpKSwgJ319fScpCiAgKSwKCiAgJ3ZhbHVlcyB0YWcnOiBzZXEoJ3t7JywgcmVwZWF0KG5vdCgnfX0nLCBhbnlDaGFyKSksICd9fScpLAoKICAnY29kZSB0YWcnOiBzZXEoJzwlJywgcmVwZWF0KG5vdCgnJT4nLCBhbnlDaGFyKSksICclPicpLAogICdpZ25vcmVkIG5ld2xpbmUnOiBsaXRlcmFsKCdcXFxuJyksCiAgbmV3bGluZTogbGl0ZXJhbCgnXG4nKSwKICAnc2luZ2xlIHF1b3RlJzogbGl0ZXJhbCgiJyIpLAogIHRleHQ6IGFueUNoYXIKfTsKCgp2YXIgVGVtcGxhdGVPdXRwdXQgPSB7CiAgLyoqCiAgICogb2JqIC0gUGFyZW50IG9iamVjdC4gIElmIG9iamVjdHMgYXJlIG91dHB1dCBhbmQgaGF2ZSBhbiBpbml0SFRNTCgpIG1ldGhvZCwgdGhlbiB0aGV5CiAgICogYXJlIGFkZGVkIHRvIHRoZSBwYXJlbnQgYnkgY2FsbGluZyBvYmouYWRkQ2hpbGQoKS4KICAgKiovCiAgLy8gVE9ETyhrZ3IpOiByZWRlc2lnbiwgSSB0aGluayB0aGlzIGlzIGFjdHVhbGx5IGJyb2tlbi4gIElmIHdlIGNhbGwgYXBwZW5kSFRNTCgpIG9mCiAgLy8gYSBzdWItdmlldyB0aGVuIGl0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIHdyb25nIHBhcmVudC4KICBjcmVhdGU6IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGJ1ZiA9ICcnOwogICAgdmFyIGYgPSBmdW5jdGlvbigvKiBhcmd1bWVudHMgKi8pIHsKICAgICAgZm9yICggdmFyIGkgPSAwIDsgaSA8IGFyZ3VtZW50cy5sZW5ndGggOyBpKysgKSB7CiAgICAgICAgdmFyIG8gPSBhcmd1bWVudHNbaV07CiAgICAgICAgaWYgKCBvICYmIG8udG9WaWV3XyApIG8gPSBvLnRvVmlld18oKTsKICAgICAgICBpZiAoICEgKCBvID09PSBudWxsIHx8IG8gPT09IHVuZGVmaW5lZCApICkgewogICAgICAgICAgaWYgKCBvLmFwcGVuZEhUTUwgKSB7CiAgICAgICAgICAgIG8uYXBwZW5kSFRNTCh0aGlzKTsKICAgICAgICAgIH0gZWxzZSBpZiAoIG8udG9IVE1MICkgewogICAgICAgICAgICBidWYgKz0gby50b0hUTUwoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJ1ZiArPSBvOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCBvLmluaXRIVE1MICYmIG9iai5hZGRDaGlsZCApIG9iai5hZGRDaGlsZChvKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgZi50b1N0cmluZyA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gYnVmOyB9OwoKICAgIHJldHVybiBmOwogIH0KfTsKCgp2YXIgVGVtcGxhdGVDb21waWxlciA9IHsKICBfX3Byb3RvX186IFRlbXBsYXRlUGFyc2VyLAoKICBvdXQ6IFtdLAoKICBwdXNoOiBmdW5jdGlvbigpIHsgdGhpcy5vdXQucHVzaC5hcHBseSh0aGlzLm91dCwgYXJndW1lbnRzKTsgfSwKCiAgaGVhZGVyOiAndmFyIHNlbGYgPSB0aGlzOyB2YXIgWCA9IHRoaXMuWDsgdmFyIGVzY2FwZUhUTUwgPSBYTUxVdGlsLmVzY2FwZTsgdmFyIG91dCA9IG9wdF9vdXQgPyBvcHRfb3V0IDogVGVtcGxhdGVPdXRwdXQuY3JlYXRlKHRoaXMpOycgKwogICAgIm91dCgnIiwKCiAgZm9vdGVyOiAiJyk7IiArCiAgICAicmV0dXJuIG91dC50b1N0cmluZygpOyIKCn0uYWRkQWN0aW9ucyh7CiAgbWFya3VwOiBmdW5jdGlvbiAodikgewogICAgdmFyIHJldCA9IHRoaXMuaGVhZGVyICsgdGhpcy5vdXQuam9pbignJykgKyB0aGlzLmZvb3RlcjsKICAgIHRoaXMub3V0ID0gW107CiAgICByZXR1cm4gcmV0OwogIH0sCiAgJ2NyZWF0ZSBjaGlsZCc6IGZ1bmN0aW9uKHYpIHsKICAgIHZhciBuYW1lID0gdlsxXS5qb2luKCcnKS5jb25zdGFudGl6ZSgpOwogICAgdGhpcy5wdXNoKCInLCBzZWxmLmNyZWF0ZVRlbXBsYXRlVmlldygnIiwgbmFtZSwgIiciLAogICAgICAgICAgICAgIHZbMl0gPyAnLCAnICsgdlsyXSA6ICcnLAogICAgICAgICAgICAgICIpLFxuJyIpOwogIH0sCiAgZm9hbVRhZzogZnVuY3Rpb24odCkgewogICAgaWYgKCB0LmF0dHJzLmYgKSB7CiAgICAgIHZhciBuYW1lID0gdC5hdHRycy5mLmNvbnN0YW50aXplKCk7CiAgICAgIHZhciBhdHRycyA9IHQuYXR0cnMuY2xvbmUoKTsKICAgICAgZGVsZXRlIGF0dHJzWydmJ107CgogICAgICBmb3IgKCB2YXIgaSA9IDAgOyBpIDwgdC5jaGlsZHJlbi5sZW5ndGggOyBpKysgKSB7CiAgICAgICAgdmFyIGMgPSB0LmNoaWxkcmVuW2ldOwogICAgICAgIGlmICggdHlwZW9mIGMgIT09ICdzdHJpbmcnICkgYXR0cnNbYy50YWddID0gYy5pbm5lckhUTUwoKTsKICAgICAgfQoKICAgICAgdGhpcy5wdXNoKCInLCBzZWxmLmNyZWF0ZVRlbXBsYXRlVmlldygnIiwgbmFtZSwgIicsIik7CiAgICAgIHRoaXMucHVzaChKU09OLnN0cmluZ2lmeShhdHRycykpOwogICAgICB0aGlzLnB1c2goIiksXG4nIik7CiAgICB9IGVsc2UgaWYgKCB0LmF0dHJzLm1vZGVsICkgewogICAgICB2YXIgbW9kZWxOYW1lID0gdC5hdHRycy5tb2RlbDsKICAgICAgdmFyIGF0dHJzID0gdC5hdHRycy5jbG9uZSgpOwogICAgICBkZWxldGUgYXR0cnNbJ21vZGVsJ107CgogICAgICBmb3IgKCB2YXIgaSA9IDAgOyBpIDwgdC5jaGlsZHJlbi5sZW5ndGggOyBpKysgKSB7CiAgICAgICAgdmFyIGMgPSB0LmNoaWxkcmVuW2ldOwogICAgICAgIGlmICggdHlwZW9mIGMgIT09ICdzdHJpbmcnICkgYXR0cnNbYy50YWddID0gYy5pbm5lckhUTUwoKTsKICAgICAgfQoKICAgICAgdGhpcy5wdXNoKCInLCBYLiIsIG1vZGVsTmFtZSwgJy5jcmVhdGUoJyk7CiAgICAgIHRoaXMucHVzaChKU09OLnN0cmluZ2lmeShhdHRycykpOwogICAgICB0aGlzLnB1c2goIiksXG4nIik7CgogICAgfQogIH0sCiAgJ3NpbXBsZSB2YWx1ZSc6IGZ1bmN0aW9uKHYpIHsgdGhpcy5wdXNoKCInLFxuIHNlbGYuIiwgdlsxXS5qb2luKCcnKSwgIixcbiciKTsgfSwKICAncmF3IHZhbHVlcyB0YWcnOiBmdW5jdGlvbiAodikgeyB0aGlzLnB1c2goIicsXG4iLCB2WzFdLmpvaW4oJycpLCAiLFxuJyIpOyB9LAogICd2YWx1ZXMgdGFnJzogZnVuY3Rpb24gKHYpIHsgdGhpcy5wdXNoKCInLFxuZXNjYXBlSFRNTCgiLCB2WzFdLmpvaW4oJycpLCAiKSxcbiciKTsgfSwKICAnbGl2ZSB2YWx1ZSB0YWcnOiBmdW5jdGlvbiAodikgeyB0aGlzLnB1c2goIicsXG5zZWxmLmR5bmFtaWNUYWcoJ3NwYW4nLCBmdW5jdGlvbigpIHsgcmV0dXJuICIsIHZbMV0uam9pbignJyksICI7IH0uYmluZCh0aGlzKSksXG4nIik7IH0sCiAgJ2NvZGUgdGFnJzogZnVuY3Rpb24gKHYpIHsgdGhpcy5wdXNoKCInKTtcbiIsIHZbMV0uam9pbignJyksICI7b3V0KCciKTsgfSwKICAnc2luZ2xlIHF1b3RlJzogZnVuY3Rpb24gKCkgeyB0aGlzLnB1c2goIlxcJyIpOyB9LAogIG5ld2xpbmU6IGZ1bmN0aW9uICgpIHsgdGhpcy5wdXNoKCJcXG4iKTsgfSwKICB0ZXh0OiBmdW5jdGlvbih2KSB7IHRoaXMucHVzaCh2KTsgfQp9KTsKCgp2YXIgVGVtcGxhdGVVdGlsID0gewoKICAgLyoqIENyZWF0ZSBhIG1ldGhvZCB3aGljaCBvbmx5IGNvbXBpbGVzIHRoZSB0ZW1wbGF0ZSB3aGVuIGZpcnN0IHVzZWQuICoqLwogICBsYXp5Q29tcGlsZTogZnVuY3Rpb24odCkgewogICAgIHZhciBkZWxlZ2F0ZTsKCiAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgaWYgKCAhIGRlbGVnYXRlICkgewogICAgICAgICBpZiAoICEgdC50ZW1wbGF0ZSApCiAgICAgICAgICAgdGhyb3cgJ011c3QgYXJlcXVpcmUoKSB0ZW1wbGF0ZSBtb2RlbCBiZWZvcmUgdXNlIGZvciAnICsgdGhpcy5uYW1lXyArICcuJyArIHQubmFtZTsKICAgICAgICAgZGVsZWdhdGUgPSBUZW1wbGF0ZVV0aWwuY29tcGlsZShUZW1wbGF0ZS5pc0luc3RhbmNlKHQpID8gdCA6IFRlbXBsYXRlLmNyZWF0ZSh0KSk7CiAgICAgICB9CgogICAgICAgcmV0dXJuIGRlbGVnYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgfTsKICAgfSwKCiAgIGNvbXBpbGU6IHdpbmRvdy5jaHJvbWUgJiYgd2luZG93LmNocm9tZS5hcHAgJiYgd2luZG93LmNocm9tZS5hcHAucnVudGltZSA/CiAgICAgZnVuY3Rpb24oKSB7CiAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgIHJldHVybiB0aGlzLm5hbWVfICsgIiB3YXNuJ3QgcmVxdWlyZWQuICBNb2RlbHMgbXVzdCBiZSBhcmVxdWlyZWQoKSdlZCBmb3IgVGVtcGxhdGVzIHRvIGJlIGNvbXBpbGVkIGluIFBhY2thZ2VkIEFwcHMuIjsKICAgICAgIH07CiAgICAgfSA6CiAgICAgZnVuY3Rpb24odCkgewogICAgICAgdmFyIGNvZGUgPSBUZW1wbGF0ZUNvbXBpbGVyLnBhcnNlU3RyaW5nKHQudGVtcGxhdGUpOwoKICAgICAgIHRyeSB7CiAgICAgICAgIHZhciBhcmdzID0gWydvcHRfb3V0J107CiAgICAgICAgIGZvciAoIHZhciBpID0gMCA7IGkgPCB0LmFyZ3MubGVuZ3RoIDsgaSsrICkgewogICAgICAgICAgIGFyZ3MucHVzaCh0LmFyZ3NbaV0ubmFtZSk7CiAgICAgICAgIH0KICAgICAgICAgYXJncy5wdXNoKGNvZGUpOwogICAgICAgICByZXR1cm4gRnVuY3Rpb24uYXBwbHkobnVsbCwgYXJncyk7CiAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgY29uc29sZS5sb2coJ1RlbXBsYXRlIEVycm9yOiAnLCBlcnIpOwogICAgICAgICBjb25zb2xlLmxvZyhjb2RlKTsKICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge307CiAgICAgICB9CiAgICAgfSwKCiAgIC8qKgogICAgKiBDb21iaW5hdG9yIHdoaWNoIHRha2VzIGEgdGVtcGxhdGUgd2hpY2ggZXhwZWN0cyBhbiBvdXRwdXQgcGFyYW1ldGVyIGFuZAogICAgKiBjb252ZXJ0cyBpdCBpbnRvIGEgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyBhIHN0cmluZy4KICAgICovCiAgIHN0cmluZ2lmeVRlbXBsYXRlOiBmdW5jdGlvbiAodGVtcGxhdGUpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICB2YXIgYnVmID0gW107CgogICAgICAgICB0aGlzLm91dHB1dChidWYucHVzaC5iaW5kKGJ1ZiksIG9iaik7CgogICAgICAgICByZXR1cm4gYnVmLmpvaW4oJycpOwogICAgICB9OwogICB9LAoKICAgLy8gVE9ETzogYWRkIGRvY3MgdG8gZXhwbGFpbiB3aGF0IHRoaXMgbWV0aG9kIGRvZXMuCiAgIHRlbXBsYXRlTWVtYmVyRXhwYW5kZXI6IGZ1bmN0aW9uKHQsIG9wdF9YKSB7CiAgICAgLy8gTG9hZCB0ZW1wbGF0ZXMgZnJvbSBhbiBleHRlcm5hbCBmaWxlCiAgICAgLy8gaWYgdGhlaXIgJ3RlbXBsYXRlJyBwcm9wZXJ0eSBpc24ndCBzZXQKICAgICB2YXIgaSA9IDA7CiAgICAgdmFyIFggPSBvcHRfWD8gb3B0X1ggOiB3aW5kb3cuWDsKICAgICBpZiAoIHR5cGVvZiB0ID09PSAnZnVuY3Rpb24nICkgewogICAgICAgdCA9IGRvY1RlbXBsYXRlID0gWC5UZW1wbGF0ZS5jcmVhdGUoewogICAgICAgICBuYW1lOiB0Lm5hbWUsCiAgICAgICAgIC8vIGlnbm9yZSBmaXJzdCBhcmd1bWVudCwgd2hpY2ggc2hvdWxkIGJlICdvcHRfb3V0JwogICAgICAgICBhcmdzOiB0LnRvU3RyaW5nKCkubWF0Y2goL1woKC4qKVwpLylbMV0uc3BsaXQoJywnKS5zbGljZSgxKS5maWx0ZXIoZnVuY3Rpb24oYSkgewogICAgICAgICAgIHJldHVybiBYLkFyZy5jcmVhdGUoe25hbWU6IGF9KTsKICAgICAgICAgfSksCiAgICAgICAgIHRlbXBsYXRlOiBtdWx0aWxpbmUodCl9KTsKICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgdCA9PT0gJ3N0cmluZycgKSB7CiAgICAgICB0ID0gZG9jVGVtcGxhdGUgPSBYLlRlbXBsYXRlLmNyZWF0ZSh7CiAgICAgICAgIG5hbWU6ICdib2R5JywKICAgICAgICAgdGVtcGxhdGU6IHQKICAgICAgIH0pOwogICAgIH0gZWxzZSBpZiAoICEgdC50ZW1wbGF0ZSApIHsKICAgICAgIC8vIGNvbnNvbGUubG9nKCdsb2FkaW5nOiAnKyB0aGlzLm5hbWUgKyAnICcgKyB0Lm5hbWUpOwoKICAgICAgIHZhciBmdXR1cmUgPSBhZnV0dXJlKCk7CiAgICAgICB2YXIgcGF0aCA9IHRoaXMuc291cmNlUGF0aDsKCiAgICAgICB0LmZ1dHVyZVRlbXBsYXRlID0gZnV0dXJlLmdldDsKICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygwLCBwYXRoLmxhc3RJbmRleE9mKCcvJykrMSk7CiAgICAgICBwYXRoICs9IHRoaXMubmFtZSArICdfJyArIHQubmFtZSArICcuZnQnOwoKICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgIHhoci5vcGVuKCJHRVQiLCBwYXRoKTsKICAgICAgIHhoci5hc2VuZChmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgIHQudGVtcGxhdGUgPSBkYXRhOwogICAgICAgICBmdXR1cmUuc2V0KFguVGVtcGxhdGUuY3JlYXRlKHQpKTsKICAgICAgICAgdC5mdXR1cmVUZW1wbGF0ZSA9IHVuZGVmaW5lZDsKICAgICAgIH0pOwogICAgIH0gZWxzZSBpZiAoIHR5cGVvZiB0LnRlbXBsYXRlID09PSAnZnVuY3Rpb24nICkgewogICAgICAgdC50ZW1wbGF0ZSA9IG11bHRpbGluZSh0LnRlbXBsYXRlKTsKICAgICB9CiAgICAgLy8gVE9ETzogZG8gd2UgbmVlZCB0aGUgY2FzZSB3aGVyZSB5b3Ugc3BlY2lmeSBhIFRlbXBsYXRlIGRlZi4gd2l0aAogICAgIC8vIC50ZW1wbGF0ZSA9ICdzdHJpbmcnPyBVbmlmeSB0aGlzIHdpdGggbW9kZWxFeHBhbmRUZW1wbGF0ZXMuCiAgICAgcmV0dXJuIHQ7CiAgIH0sCgogICBtb2RlbEV4cGFuZFRlbXBsYXRlczogZnVuY3Rpb24oc2VsZiwgdGVtcGxhdGVzKSB7CiAgICAgLy8gTG9hZCB0ZW1wbGF0ZXMgZnJvbSBhbiBleHRlcm5hbCBmaWxlCiAgICAgLy8gaWYgdGhlaXIgJ3RlbXBsYXRlJyBwcm9wZXJ0eSBpc24ndCBzZXQKICAgICB2YXIgaSA9IDA7CiAgICAgdGVtcGxhdGVzLmZvckVhY2goZnVuY3Rpb24odCkgewogICAgICAgaWYgKCB0eXBlb2YgdCA9PT0gJ2Z1bmN0aW9uJyApIHsKICAgICAgICAgdCA9IHRlbXBsYXRlc1tpXSA9IFRlbXBsYXRlLmNyZWF0ZSh7CiAgICAgICAgICAgbmFtZTogdC5uYW1lLAogICAgICAgICAgIC8vIGlnbm9yZSBmaXJzdCBhcmd1bWVudCwgd2hpY2ggc2hvdWxkIGJlICdvcHRfb3V0JwogICAgICAgICAgIGFyZ3M6IHQudG9TdHJpbmcoKS5tYXRjaCgvXCgoLio/KVwpLylbMV0uc3BsaXQoJywnKS5zbGljZSgxKS5tYXAoZnVuY3Rpb24oYSkgewogICAgICAgICAgICAgcmV0dXJuIEFyZy5jcmVhdGUoe25hbWU6IGEudHJpbSgpfSk7CiAgICAgICAgICAgfSksCiAgICAgICAgICAgdGVtcGxhdGU6IG11bHRpbGluZSh0KX0pOwogICAgICAgfSBlbHNlIGlmICggISB0LnRlbXBsYXRlICkgewogICAgICAgICAvLyBjb25zb2xlLmxvZygnbG9hZGluZzogJysgc2VsZi5uYW1lICsgJyAnICsgdC5uYW1lKTsKCiAgICAgICAgIHZhciBmdXR1cmUgPSBhZnV0dXJlKCk7CiAgICAgICAgIHZhciBwYXRoID0gdGhpcy5zb3VyY2VQYXRoOwoKICAgICAgICAgdC5mdXR1cmVUZW1wbGF0ZSA9IGZ1dHVyZS5nZXQ7CiAgICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygwLCBwYXRoLmxhc3RJbmRleE9mKCcvJykrMSk7CiAgICAgICAgIHBhdGggKz0gc2VsZi5uYW1lICsgJ18nICsgdC5uYW1lICsgJy5mdCc7CgogICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgIHhoci5vcGVuKCJHRVQiLCBwYXRoKTsKICAgICAgICAgeGhyLmFzZW5kKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICB0LnRlbXBsYXRlID0gZGF0YTsKICAgICAgICAgICBmdXR1cmUuc2V0KFRlbXBsYXRlLmNyZWF0ZSh0KSk7CiAgICAgICAgICAgdC5mdXR1cmVUZW1wbGF0ZSA9IHVuZGVmaW5lZDsKICAgICAgICAgfSk7CiAgICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgdC50ZW1wbGF0ZSA9PT0gJ2Z1bmN0aW9uJyApIHsKICAgICAgICAgdC50ZW1wbGF0ZSA9IG11bHRpbGluZSh0LnRlbXBsYXRlKTsKICAgICAgIH0gZWxzZSBpZiAoIXQudGVtcGxhdGUkKSB7CiAgICAgICAgIC8vIHdlIGhhdmVuJ3QgRk9BTWFsaXplZCB0aGUgdGVtcGxhdGUsIGFuZCB0aGVyZSdzIG5vIGNyYXp5IG11bHRpbGluZSBmdW5jdGlvbnMuCiAgICAgICAgIC8vIE5vdGUgdGhhdCBNb2RlbCBhbmQgYm9vc3RyYXBweSBtb2RlbHMgbXVzdCB1c2UgdGhpcyBjYXNlLCBhcyBUZW1wbGF0ZSBpcyBub3QKICAgICAgICAgLy8geWV0IGRlZmluZWQgYXQgYm9vdHN0cmFwIHRpbWUuIFVzZSBhIFRlbXBsYXRlIG9iamVjdCBkZWZpbml0aW9uIHdpdGggYSBiYXJlCiAgICAgICAgIC8vIHN0cmluZyB0ZW1wbGF0ZSBib2R5IGluIHRob3NlIGNhc2VzLgogICAgICAgICBpZiAodHlwZW9mIFRlbXBsYXRlICE9ICJ1bmRlZmluZWQiKQogICAgICAgICAgIHQgPSB0ZW1wbGF0ZXNbaV0gPSBKU09OVXRpbC5tYXBUb09iaihzZWxmLlgsIHQsIFRlbXBsYXRlKTsKICAgICAgICAgZWxzZQogICAgICAgICAgIHQgPSB0ZW1wbGF0ZXNbaV0gPSBKU09OVXRpbC5tYXBUb09iaihzZWxmLlgsIHQpOyAvLyBzYWZlIGZvciBib290c3RyYXAsIGJ1dCB3b24ndCBkbyBhbnl0aGluZyBpbiB0aGF0IGNhc2UuCiAgICAgICB9CiAgICAgICBpKys7CiAgICAgfS5iaW5kKHNlbGYpKQogIH0KfTsKCgovKiogSXMgYWN0dWFsbHkgc3luY2hyb25vdXMgYnV0IGlzIHJlcGxhY2VkIGluIENocm9tZUFwcCB3aXRoIGFuIGFzeW5jIHZlcnNpb24uICoqLwp2YXIgYWV2YWwgPSBmdW5jdGlvbihzcmMpIHsKICByZXR1cm4gYWNvbnN0YW50KGV2YWwoJygnICsgc3JjICsgJyknKSk7Cn07CgoKdmFyIGFldmFsVGVtcGxhdGUgPSBmdW5jdGlvbih0KSB7CiAgdmFyIGRvRXZhbCA9IGZ1bmN0aW9uKHQpIHsKICAgIHZhciBjb2RlID0gVGVtcGxhdGVDb21waWxlci5wYXJzZVN0cmluZyh0LnRlbXBsYXRlKTsKCiAgICB0cnkgewogICAgICB2YXIgYXJncyA9IFsnb3B0X291dCddOwogICAgICBmb3IgKCB2YXIgaSA9IDAgOyBpIDwgdC5hcmdzLmxlbmd0aCA7IGkrKyApIHsKICAgICAgICBhcmdzLnB1c2godC5hcmdzW2ldLm5hbWUpOwogICAgICB9CiAgICAgIHJldHVybiBhZXZhbCgnZnVuY3Rpb24oJyArIGFyZ3Muam9pbignLCcpICsgJyl7JyArIGNvZGUgKyAnfScpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIGNvbnNvbGUubG9nKCdUZW1wbGF0ZSBFcnJvcjogJywgZXJyKTsKICAgICAgY29uc29sZS5sb2coY29kZSk7CiAgICAgIHJldHVybiBhY29uc3RhbnQoZnVuY3Rpb24oKXtyZXR1cm4gJ1RlbXBsYXRlRXJyb3I6IENoZWNrIGNvbnNvbGUuJzt9KTsKICAgIH0KICB9CgogIGlmICggdC50ZW1wbGF0ZSApIHsKICAgIHJldHVybiBkb0V2YWwodCk7CiAgfQoKICByZXR1cm4gYXNlcSgKICAgIHQuZnV0dXJlVGVtcGxhdGUsCiAgICBmdW5jdGlvbihyZXQsIHQpIHsKICAgICAgZG9FdmFsKHQpKHJldCk7CiAgICB9KTsKfTsKCgo=",
                "body": "LyoqCiAqIEBsaWNlbnNlCiAqIENvcHlyaWdodCAyMDEzIEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKLyoqCiAqIFNpbXBsZSB0ZW1wbGF0ZSBzeXN0ZW0gbW9kZWxsZWQgYWZ0ZXIgSlNQJ3MuCiAqCiAqIFN5bnRheDoKICogICAgPCUgY29kZSAlPjogY29kZSBpbnNlcnRlZCBpbnRvIHRlbXBsYXRlLCBidXQgbm90aGluZyBpbXBsaWNpdGx5IG91dHB1dAogKiAgICA8JT0gY29tbWEtc2VwYXJhdGVkLXZhbHVlcyAlPjogYWxsIHZhbHVlcyBhcmUgYXBwZW5kZWQgdG8gdGVtcGxhdGUgb3V0cHV0CiAqICAgIDwlIyBleHByZXNzaW9uICU+OiBkeW5hbWljIChhdXRvLXVwZGF0aW5nKSBleHByZXNzaW9uIGlzIG91dHB1dAogKiAgICBcPG5ldy1saW5lPjogaWdub3JlZAogKiAgICAlJXZhbHVlKDx3aGl0ZXNwYWNlPnw8KTogb3V0cHV0IGEgc2luZ2xlIHZhbHVlIHRvIHRoZSB0ZW1wbGF0ZSBvdXRwdXQKICogICAgJCRmZWF0dXJlKDx3aGl0ZXNwYWNlPnw8KTogb3V0cHV0IHRoZSBWaWV3IG9yIEFjdGlvbiBmb3IgdGhlIGN1cnJlbnQgVmFsdWUKICovCgp2YXIgRk9BTVRhZ1BhcnNlciA9IHsKICBfX3Byb3RvX186IGdyYW1tYXIsCgogIGNyZWF0ZTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gewogICAgICBfX3Byb3RvX186IHRoaXMsCiAgICAgIGh0bWw6ICAgICAgSFRNTFBhcnNlci5jcmVhdGUoKS5leHBvcnQoJ1NUQVJUJykKICAgIH07CiAgfSwKCiAgU1RBUlQ6IHN5bSgndGFnJyksCgogIHRhZzogc2VxKAogICAgJzwnLAogICAgbGl0ZXJhbF9pYygnZm9hbScpLAogICAgc3ltKCd3aGl0ZXNwYWNlJyksCiAgICBzeW0oJ2F0dHJpYnV0ZXMnKSwKICAgIHN5bSgnd2hpdGVzcGFjZScpLAogICAgYWx0KHN5bSgnY2xvc2VkJyksIHN5bSgnbWF0Y2hpbmcnKSkKICApLAoKICBjbG9zZWQ6IGxpdGVyYWwoJy8+JyksCgogIG1hdGNoaW5nOiBzZXExKDEsJz4nLCBzeW0oJ2h0bWwnKSwgc3ltKCdlbmRUYWcnKSksCgogIGVuZFRhZzogc2VxMSgxLCAnPC8nLCBsaXRlcmFsX2ljKCdmb2FtJyksICc+JyksCgogIGxhYmVsOiBzdHIocGx1cyhub3RDaGFycygnID0vXHRcclxuPD5cJyInKSkpLAoKICBhdHRyaWJ1dGVzOiByZXBlYXQoc3ltKCdhdHRyaWJ1dGUnKSwgc3ltKCd3aGl0ZXNwYWNlJykpLAoKICBhdHRyaWJ1dGU6IHNlcShzeW0oJ2xhYmVsJyksICc9Jywgc3ltKCd2YWx1ZScpKSwKCiAgdmFsdWU6IHN0cihhbHQoCiAgICBwbHVzKGFsdChyYW5nZSgnYScsJ3onKSwgcmFuZ2UoJ0EnLCAnWicpLCByYW5nZSgnMCcsICc5JykpKSwKICAgIHNlcTEoMSwgJyInLCByZXBlYXQobm90Q2hhcignIicpKSwgJyInKQogICkpLAoKICB3aGl0ZXNwYWNlOiByZXBlYXQoYWx0KCcgJywgJ1x0JywgJ1xyJywgJ1xuJykpCgp9LmFkZEFjdGlvbnMoewogIGF0dHJpYnV0ZXM6IGZ1bmN0aW9uKHhzKSB7CiAgICB2YXIgYXR0cnMgPSB7fTsKICAgIHhzLmZvckVhY2goZnVuY3Rpb24oYXR0cikgeyBhdHRyc1thdHRyWzBdXSA9IGF0dHJbMl07IH0pOwogICAgcmV0dXJuIGF0dHJzOwogIH0sCiAgdGFnOiAgICAgIGZ1bmN0aW9uKHhzKSB7IHJldHVybiBUYWcuY3JlYXRlKHhzWzFdLCB4c1szXSwgeHNbNV0pOyB9LAogIGNsb3NlZDogICBmdW5jdGlvbigpICAgeyByZXR1cm4gW107IH0sCiAgbWF0Y2hpbmc6IGZ1bmN0aW9uKHhzKSB7IHJldHVybiB4cy5jaGlsZHJlbjsgfQp9KTsKCgp2YXIgVGVtcGxhdGVQYXJzZXIgPSB7CiAgX19wcm90b19fOiBncmFtbWFyLAoKICBTVEFSVDogc3ltKCdtYXJrdXAnKSwKCiAgbWFya3VwOiByZXBlYXQwKGFsdCgKICAgIHN5bSgnZm9hbVRhZycpLAogICAgc3ltKCdjcmVhdGUgY2hpbGQnKSwKICAgIHN5bSgnc2ltcGxlIHZhbHVlJyksCiAgICBzeW0oJ2xpdmUgdmFsdWUgdGFnJyksCiAgICBzeW0oJ3JhdyB2YWx1ZXMgdGFnJyksCiAgICBzeW0oJ3ZhbHVlcyB0YWcnKSwKICAgIHN5bSgnY29kZSB0YWcnKSwKICAgIHN5bSgnaWdub3JlZCBuZXdsaW5lJyksCiAgICBzeW0oJ25ld2xpbmUnKSwKICAgIHN5bSgnc2luZ2xlIHF1b3RlJyksCiAgICBzeW0oJ3RleHQnKQogICkpLAoKICAnZm9hbVRhZyc6IEZPQU1UYWdQYXJzZXIuY3JlYXRlKCkuZXhwb3J0KCdTVEFSVCcpLAoKICAnY3JlYXRlIGNoaWxkJzogc2VxKCckJCcsIHJlcGVhdChub3RDaGFycygnICRcbjx7JykpLAogICAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWwoSlNPTlBhcnNlci5leHBvcnQoJ29iakFzU3RyaW5nJykpKSwKCiAgJ3NpbXBsZSB2YWx1ZSc6IHNlcSgnJSUnLCByZXBlYXQobm90Q2hhcnMoJyAiXG48JykpKSwKCiAgJ2xpdmUgdmFsdWUgdGFnJzogc2VxKCc8JSMnLCByZXBlYXQobm90KCclPicsIGFueUNoYXIpKSwgJyU+JyksCgogICdyYXcgdmFsdWVzIHRhZyc6IGFsdCgKICAgIHNlcSgnPCU9JywgcmVwZWF0KG5vdCgnJT4nLCBhbnlDaGFyKSksICclPicpLAogICAgc2VxKCd7e3snLCByZXBlYXQobm90KCd9fX0nLCBhbnlDaGFyKSksICd9fX0nKQogICksCgogICd2YWx1ZXMgdGFnJzogc2VxKCd7eycsIHJlcGVhdChub3QoJ319JywgYW55Q2hhcikpLCAnfX0nKSwKCiAgJ2NvZGUgdGFnJzogc2VxKCc8JScsIHJlcGVhdChub3QoJyU+JywgYW55Q2hhcikpLCAnJT4nKSwKICAnaWdub3JlZCBuZXdsaW5lJzogbGl0ZXJhbCgnXFxcbicpLAogIG5ld2xpbmU6IGxpdGVyYWwoJ1xuJyksCiAgJ3NpbmdsZSBxdW90ZSc6IGxpdGVyYWwoIiciKSwKICB0ZXh0OiBhbnlDaGFyCn07CgoKdmFyIFRlbXBsYXRlT3V0cHV0ID0gewogIC8qKgogICAqIG9iaiAtIFBhcmVudCBvYmplY3QuICBJZiBvYmplY3RzIGFyZSBvdXRwdXQgYW5kIGhhdmUgYW4gaW5pdEhUTUwoKSBtZXRob2QsIHRoZW4gdGhleQogICAqIGFyZSBhZGRlZCB0byB0aGUgcGFyZW50IGJ5IGNhbGxpbmcgb2JqLmFkZENoaWxkKCkuCiAgICoqLwogIC8vIFRPRE8oa2dyKTogcmVkZXNpZ24sIEkgdGhpbmsgdGhpcyBpcyBhY3R1YWxseSBicm9rZW4uICBJZiB3ZSBjYWxsIGFwcGVuZEhUTUwoKSBvZgogIC8vIGEgc3ViLXZpZXcgdGhlbiBpdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSB3cm9uZyBwYXJlbnQuCiAgY3JlYXRlOiBmdW5jdGlvbihvYmopIHsKICAgIHZhciBidWYgPSAnJzsKICAgIHZhciBmID0gZnVuY3Rpb24oLyogYXJndW1lbnRzICovKSB7CiAgICAgIGZvciAoIHZhciBpID0gMCA7IGkgPCBhcmd1bWVudHMubGVuZ3RoIDsgaSsrICkgewogICAgICAgIHZhciBvID0gYXJndW1lbnRzW2ldOwogICAgICAgIGlmICggbyAmJiBvLnRvVmlld18gKSBvID0gby50b1ZpZXdfKCk7CiAgICAgICAgaWYgKCAhICggbyA9PT0gbnVsbCB8fCBvID09PSB1bmRlZmluZWQgKSApIHsKICAgICAgICAgIGlmICggby5hcHBlbmRIVE1MICkgewogICAgICAgICAgICBvLmFwcGVuZEhUTUwodGhpcyk7CiAgICAgICAgICB9IGVsc2UgaWYgKCBvLnRvSFRNTCApIHsKICAgICAgICAgICAgYnVmICs9IG8udG9IVE1MKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWYgKz0gbzsKICAgICAgICAgIH0KICAgICAgICAgIGlmICggby5pbml0SFRNTCAmJiBvYmouYWRkQ2hpbGQgKSBvYmouYWRkQ2hpbGQobyk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIGYudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsgcmV0dXJuIGJ1ZjsgfTsKCiAgICByZXR1cm4gZjsKICB9Cn07CgoKdmFyIFRlbXBsYXRlQ29tcGlsZXIgPSB7CiAgX19wcm90b19fOiBUZW1wbGF0ZVBhcnNlciwKCiAgb3V0OiBbXSwKCiAgcHVzaDogZnVuY3Rpb24oKSB7IHRoaXMub3V0LnB1c2guYXBwbHkodGhpcy5vdXQsIGFyZ3VtZW50cyk7IH0sCgogIGhlYWRlcjogJ3ZhciBzZWxmID0gdGhpczsgdmFyIFggPSB0aGlzLlg7IHZhciBlc2NhcGVIVE1MID0gWE1MVXRpbC5lc2NhcGU7IHZhciBvdXQgPSBvcHRfb3V0ID8gb3B0X291dCA6IFRlbXBsYXRlT3V0cHV0LmNyZWF0ZSh0aGlzKTsnICsKICAgICJvdXQoJyIsCgogIGZvb3RlcjogIicpOyIgKwogICAgInJldHVybiBvdXQudG9TdHJpbmcoKTsiCgp9LmFkZEFjdGlvbnMoewogIG1hcmt1cDogZnVuY3Rpb24gKHYpIHsKICAgIHZhciByZXQgPSB0aGlzLmhlYWRlciArIHRoaXMub3V0LmpvaW4oJycpICsgdGhpcy5mb290ZXI7CiAgICB0aGlzLm91dCA9IFtdOwogICAgcmV0dXJuIHJldDsKICB9LAogICdjcmVhdGUgY2hpbGQnOiBmdW5jdGlvbih2KSB7CiAgICB2YXIgbmFtZSA9IHZbMV0uam9pbignJykuY29uc3RhbnRpemUoKTsKICAgIHRoaXMucHVzaCgiJywgc2VsZi5jcmVhdGVUZW1wbGF0ZVZpZXcoJyIsIG5hbWUsICInIiwKICAgICAgICAgICAgICB2WzJdID8gJywgJyArIHZbMl0gOiAnJywKICAgICAgICAgICAgICAiKSxcbiciKTsKICB9LAogIGZvYW1UYWc6IGZ1bmN0aW9uKHQpIHsKICAgIGlmICggdC5hdHRycy5mICkgewogICAgICB2YXIgbmFtZSA9IHQuYXR0cnMuZi5jb25zdGFudGl6ZSgpOwogICAgICB2YXIgYXR0cnMgPSB0LmF0dHJzLmNsb25lKCk7CiAgICAgIGRlbGV0ZSBhdHRyc1snZiddOwoKICAgICAgZm9yICggdmFyIGkgPSAwIDsgaSA8IHQuY2hpbGRyZW4ubGVuZ3RoIDsgaSsrICkgewogICAgICAgIHZhciBjID0gdC5jaGlsZHJlbltpXTsKICAgICAgICBpZiAoIHR5cGVvZiBjICE9PSAnc3RyaW5nJyApIGF0dHJzW2MudGFnXSA9IGMuaW5uZXJIVE1MKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucHVzaCgiJywgc2VsZi5jcmVhdGVUZW1wbGF0ZVZpZXcoJyIsIG5hbWUsICInLCIpOwogICAgICB0aGlzLnB1c2goSlNPTi5zdHJpbmdpZnkoYXR0cnMpKTsKICAgICAgdGhpcy5wdXNoKCIpLFxuJyIpOwogICAgfSBlbHNlIGlmICggdC5hdHRycy5tb2RlbCApIHsKICAgICAgdmFyIG1vZGVsTmFtZSA9IHQuYXR0cnMubW9kZWw7CiAgICAgIHZhciBhdHRycyA9IHQuYXR0cnMuY2xvbmUoKTsKICAgICAgZGVsZXRlIGF0dHJzWydtb2RlbCddOwoKICAgICAgZm9yICggdmFyIGkgPSAwIDsgaSA8IHQuY2hpbGRyZW4ubGVuZ3RoIDsgaSsrICkgewogICAgICAgIHZhciBjID0gdC5jaGlsZHJlbltpXTsKICAgICAgICBpZiAoIHR5cGVvZiBjICE9PSAnc3RyaW5nJyApIGF0dHJzW2MudGFnXSA9IGMuaW5uZXJIVE1MKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucHVzaCgiJywgWC4iLCBtb2RlbE5hbWUsICcuY3JlYXRlKCcpOwogICAgICB0aGlzLnB1c2goSlNPTi5zdHJpbmdpZnkoYXR0cnMpKTsKICAgICAgdGhpcy5wdXNoKCIpLFxuJyIpOwoKICAgIH0KICB9LAogICdzaW1wbGUgdmFsdWUnOiBmdW5jdGlvbih2KSB7IHRoaXMucHVzaCgiJyxcbiBzZWxmLiIsIHZbMV0uam9pbignJyksICIsXG4nIik7IH0sCiAgJ3JhdyB2YWx1ZXMgdGFnJzogZnVuY3Rpb24gKHYpIHsgdGhpcy5wdXNoKCInLFxuIiwgdlsxXS5qb2luKCcnKSwgIixcbiciKTsgfSwKICAndmFsdWVzIHRhZyc6IGZ1bmN0aW9uICh2KSB7IHRoaXMucHVzaCgiJyxcbmVzY2FwZUhUTUwoIiwgdlsxXS5qb2luKCcnKSwgIiksXG4nIik7IH0sCiAgJ2xpdmUgdmFsdWUgdGFnJzogZnVuY3Rpb24gKHYpIHsgdGhpcy5wdXNoKCInLFxuc2VsZi5keW5hbWljVGFnKCdzcGFuJywgZnVuY3Rpb24oKSB7IHJldHVybiAiLCB2WzFdLmpvaW4oJycpLCAiOyB9LmJpbmQodGhpcykpLFxuJyIpOyB9LAogICdjb2RlIHRhZyc6IGZ1bmN0aW9uICh2KSB7IHRoaXMucHVzaCgiJyk7XG4iLCB2WzFdLmpvaW4oJycpLCAiO291dCgnIik7IH0sCiAgJ3NpbmdsZSBxdW90ZSc6IGZ1bmN0aW9uICgpIHsgdGhpcy5wdXNoKCJcXCciKTsgfSwKICBuZXdsaW5lOiBmdW5jdGlvbiAoKSB7IHRoaXMucHVzaCgiXFxuIik7IH0sCiAgdGV4dDogZnVuY3Rpb24odikgeyB0aGlzLnB1c2godik7IH0KfSk7CgoKdmFyIFRlbXBsYXRlVXRpbCA9IHsKCiAgIC8qKiBDcmVhdGUgYSBtZXRob2Qgd2hpY2ggb25seSBjb21waWxlcyB0aGUgdGVtcGxhdGUgd2hlbiBmaXJzdCB1c2VkLiAqKi8KICAgbGF6eUNvbXBpbGU6IGZ1bmN0aW9uKHQpIHsKICAgICB2YXIgZGVsZWdhdGU7CgogICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgIGlmICggISBkZWxlZ2F0ZSApIHsKICAgICAgICAgaWYgKCAhIHQudGVtcGxhdGUgKQogICAgICAgICAgIHRocm93ICdNdXN0IGFyZXF1aXJlKCkgdGVtcGxhdGUgbW9kZWwgYmVmb3JlIHVzZSBmb3IgJyArIHRoaXMubmFtZV8gKyAnLicgKyB0Lm5hbWU7CiAgICAgICAgIGRlbGVnYXRlID0gVGVtcGxhdGVVdGlsLmNvbXBpbGUoVGVtcGxhdGUuaXNJbnN0YW5jZSh0KSA/IHQgOiBUZW1wbGF0ZS5jcmVhdGUodCkpOwogICAgICAgfQoKICAgICAgIHJldHVybiBkZWxlZ2F0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgIH07CiAgIH0sCgogICBjb21waWxlOiB3aW5kb3cuY2hyb21lICYmIHdpbmRvdy5jaHJvbWUuYXBwICYmIHdpbmRvdy5jaHJvbWUuYXBwLnJ1bnRpbWUgPwogICAgIGZ1bmN0aW9uKCkgewogICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICByZXR1cm4gdGhpcy5uYW1lXyArICIgd2Fzbid0IHJlcXVpcmVkLiAgTW9kZWxzIG11c3QgYmUgYXJlcXVpcmVkKCknZWQgZm9yIFRlbXBsYXRlcyB0byBiZSBjb21waWxlZCBpbiBQYWNrYWdlZCBBcHBzLiI7CiAgICAgICB9OwogICAgIH0gOgogICAgIGZ1bmN0aW9uKHQpIHsKICAgICAgIHZhciBjb2RlID0gVGVtcGxhdGVDb21waWxlci5wYXJzZVN0cmluZyh0LnRlbXBsYXRlKTsKCiAgICAgICB0cnkgewogICAgICAgICB2YXIgYXJncyA9IFsnb3B0X291dCddOwogICAgICAgICBmb3IgKCB2YXIgaSA9IDAgOyBpIDwgdC5hcmdzLmxlbmd0aCA7IGkrKyApIHsKICAgICAgICAgICBhcmdzLnB1c2godC5hcmdzW2ldLm5hbWUpOwogICAgICAgICB9CiAgICAgICAgIGFyZ3MucHVzaChjb2RlKTsKICAgICAgICAgcmV0dXJuIEZ1bmN0aW9uLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgIGNvbnNvbGUubG9nKCdUZW1wbGF0ZSBFcnJvcjogJywgZXJyKTsKICAgICAgICAgY29uc29sZS5sb2coY29kZSk7CiAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHt9OwogICAgICAgfQogICAgIH0sCgogICAvKioKICAgICogQ29tYmluYXRvciB3aGljaCB0YWtlcyBhIHRlbXBsYXRlIHdoaWNoIGV4cGVjdHMgYW4gb3V0cHV0IHBhcmFtZXRlciBhbmQKICAgICogY29udmVydHMgaXQgaW50byBhIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgYSBzdHJpbmcuCiAgICAqLwogICBzdHJpbmdpZnlUZW1wbGF0ZTogZnVuY3Rpb24gKHRlbXBsYXRlKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgdmFyIGJ1ZiA9IFtdOwoKICAgICAgICAgdGhpcy5vdXRwdXQoYnVmLnB1c2guYmluZChidWYpLCBvYmopOwoKICAgICAgICAgcmV0dXJuIGJ1Zi5qb2luKCcnKTsKICAgICAgfTsKICAgfSwKCiAgIC8vIFRPRE86IGFkZCBkb2NzIHRvIGV4cGxhaW4gd2hhdCB0aGlzIG1ldGhvZCBkb2VzLgogICB0ZW1wbGF0ZU1lbWJlckV4cGFuZGVyOiBmdW5jdGlvbih0LCBvcHRfWCkgewogICAgIC8vIExvYWQgdGVtcGxhdGVzIGZyb20gYW4gZXh0ZXJuYWwgZmlsZQogICAgIC8vIGlmIHRoZWlyICd0ZW1wbGF0ZScgcHJvcGVydHkgaXNuJ3Qgc2V0CiAgICAgdmFyIGkgPSAwOwogICAgIHZhciBYID0gb3B0X1g/IG9wdF9YIDogd2luZG93Llg7CiAgICAgaWYgKCB0eXBlb2YgdCA9PT0gJ2Z1bmN0aW9uJyApIHsKICAgICAgIHQgPSBkb2NUZW1wbGF0ZSA9IFguVGVtcGxhdGUuY3JlYXRlKHsKICAgICAgICAgbmFtZTogdC5uYW1lLAogICAgICAgICAvLyBpZ25vcmUgZmlyc3QgYXJndW1lbnQsIHdoaWNoIHNob3VsZCBiZSAnb3B0X291dCcKICAgICAgICAgYXJnczogdC50b1N0cmluZygpLm1hdGNoKC9cKCguKilcKS8pWzFdLnNwbGl0KCcsJykuc2xpY2UoMSkuZmlsdGVyKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICByZXR1cm4gWC5BcmcuY3JlYXRlKHtuYW1lOiBhfSk7CiAgICAgICAgIH0pLAogICAgICAgICB0ZW1wbGF0ZTogbXVsdGlsaW5lKHQpfSk7CiAgICAgfSBlbHNlIGlmICggdHlwZW9mIHQgPT09ICdzdHJpbmcnICkgewogICAgICAgdCA9IGRvY1RlbXBsYXRlID0gWC5UZW1wbGF0ZS5jcmVhdGUoewogICAgICAgICBuYW1lOiAnYm9keScsCiAgICAgICAgIHRlbXBsYXRlOiB0CiAgICAgICB9KTsKICAgICB9IGVsc2UgaWYgKCAhIHQudGVtcGxhdGUgKSB7CiAgICAgICAvLyBjb25zb2xlLmxvZygnbG9hZGluZzogJysgdGhpcy5uYW1lICsgJyAnICsgdC5uYW1lKTsKCiAgICAgICB2YXIgZnV0dXJlID0gYWZ1dHVyZSgpOwogICAgICAgdmFyIHBhdGggPSB0aGlzLnNvdXJjZVBhdGg7CgogICAgICAgdC5mdXR1cmVUZW1wbGF0ZSA9IGZ1dHVyZS5nZXQ7CiAgICAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoMCwgcGF0aC5sYXN0SW5kZXhPZignLycpKzEpOwogICAgICAgcGF0aCArPSB0aGlzLm5hbWUgKyAnXycgKyB0Lm5hbWUgKyAnLmZ0JzsKCiAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICB4aHIub3BlbigiR0VUIiwgcGF0aCk7CiAgICAgICB4aHIuYXNlbmQoZnVuY3Rpb24oZGF0YSkgewogICAgICAgICB0LnRlbXBsYXRlID0gZGF0YTsKICAgICAgICAgZnV0dXJlLnNldChYLlRlbXBsYXRlLmNyZWF0ZSh0KSk7CiAgICAgICAgIHQuZnV0dXJlVGVtcGxhdGUgPSB1bmRlZmluZWQ7CiAgICAgICB9KTsKICAgICB9IGVsc2UgaWYgKCB0eXBlb2YgdC50ZW1wbGF0ZSA9PT0gJ2Z1bmN0aW9uJyApIHsKICAgICAgIHQudGVtcGxhdGUgPSBtdWx0aWxpbmUodC50ZW1wbGF0ZSk7CiAgICAgfQogICAgIC8vIFRPRE86IGRvIHdlIG5lZWQgdGhlIGNhc2Ugd2hlcmUgeW91IHNwZWNpZnkgYSBUZW1wbGF0ZSBkZWYuIHdpdGgKICAgICAvLyAudGVtcGxhdGUgPSAnc3RyaW5nJz8gVW5pZnkgdGhpcyB3aXRoIG1vZGVsRXhwYW5kVGVtcGxhdGVzLgogICAgIHJldHVybiB0OwogICB9LAoKICAgbW9kZWxFeHBhbmRUZW1wbGF0ZXM6IGZ1bmN0aW9uKHNlbGYsIHRlbXBsYXRlcykgewogICAgIC8vIExvYWQgdGVtcGxhdGVzIGZyb20gYW4gZXh0ZXJuYWwgZmlsZQogICAgIC8vIGlmIHRoZWlyICd0ZW1wbGF0ZScgcHJvcGVydHkgaXNuJ3Qgc2V0CiAgICAgdmFyIGkgPSAwOwogICAgIHRlbXBsYXRlcy5mb3JFYWNoKGZ1bmN0aW9uKHQpIHsKICAgICAgIGlmICggdHlwZW9mIHQgPT09ICdmdW5jdGlvbicgKSB7CiAgICAgICAgIHQgPSB0ZW1wbGF0ZXNbaV0gPSBUZW1wbGF0ZS5jcmVhdGUoewogICAgICAgICAgIG5hbWU6IHQubmFtZSwKICAgICAgICAgICAvLyBpZ25vcmUgZmlyc3QgYXJndW1lbnQsIHdoaWNoIHNob3VsZCBiZSAnb3B0X291dCcKICAgICAgICAgICBhcmdzOiB0LnRvU3RyaW5nKCkubWF0Y2goL1woKC4qPylcKS8pWzFdLnNwbGl0KCcsJykuc2xpY2UoMSkubWFwKGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgIHJldHVybiBBcmcuY3JlYXRlKHtuYW1lOiBhLnRyaW0oKX0pOwogICAgICAgICAgIH0pLAogICAgICAgICAgIHRlbXBsYXRlOiBtdWx0aWxpbmUodCl9KTsKICAgICAgIH0gZWxzZSBpZiAoICEgdC50ZW1wbGF0ZSApIHsKICAgICAgICAgLy8gY29uc29sZS5sb2coJ2xvYWRpbmc6ICcrIHNlbGYubmFtZSArICcgJyArIHQubmFtZSk7CgogICAgICAgICB2YXIgZnV0dXJlID0gYWZ1dHVyZSgpOwogICAgICAgICB2YXIgcGF0aCA9IHRoaXMuc291cmNlUGF0aDsKCiAgICAgICAgIHQuZnV0dXJlVGVtcGxhdGUgPSBmdXR1cmUuZ2V0OwogICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoMCwgcGF0aC5sYXN0SW5kZXhPZignLycpKzEpOwogICAgICAgICBwYXRoICs9IHNlbGYubmFtZSArICdfJyArIHQubmFtZSArICcuZnQnOwoKICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICB4aHIub3BlbigiR0VUIiwgcGF0aCk7CiAgICAgICAgIHhoci5hc2VuZChmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgdC50ZW1wbGF0ZSA9IGRhdGE7CiAgICAgICAgICAgZnV0dXJlLnNldChUZW1wbGF0ZS5jcmVhdGUodCkpOwogICAgICAgICAgIHQuZnV0dXJlVGVtcGxhdGUgPSB1bmRlZmluZWQ7CiAgICAgICAgIH0pOwogICAgICAgfSBlbHNlIGlmICggdHlwZW9mIHQudGVtcGxhdGUgPT09ICdmdW5jdGlvbicgKSB7CiAgICAgICAgIHQudGVtcGxhdGUgPSBtdWx0aWxpbmUodC50ZW1wbGF0ZSk7CiAgICAgICB9IGVsc2UgaWYgKCF0LnRlbXBsYXRlJCkgewogICAgICAgICAvLyB3ZSBoYXZlbid0IEZPQU1hbGl6ZWQgdGhlIHRlbXBsYXRlLCBhbmQgdGhlcmUncyBubyBjcmF6eSBtdWx0aWxpbmUgZnVuY3Rpb25zLgogICAgICAgICAvLyBOb3RlIHRoYXQgTW9kZWwgYW5kIGJvb3N0cmFwcHkgbW9kZWxzIG11c3QgdXNlIHRoaXMgY2FzZSwgYXMgVGVtcGxhdGUgaXMgbm90CiAgICAgICAgIC8vIHlldCBkZWZpbmVkIGF0IGJvb3RzdHJhcCB0aW1lLiBVc2UgYSBUZW1wbGF0ZSBvYmplY3QgZGVmaW5pdGlvbiB3aXRoIGEgYmFyZQogICAgICAgICAvLyBzdHJpbmcgdGVtcGxhdGUgYm9keSBpbiB0aG9zZSBjYXNlcy4KICAgICAgICAgaWYgKHR5cGVvZiBUZW1wbGF0ZSAhPSAidW5kZWZpbmVkIikKICAgICAgICAgICB0ID0gdGVtcGxhdGVzW2ldID0gSlNPTlV0aWwubWFwVG9PYmooc2VsZi5YLCB0LCBUZW1wbGF0ZSk7CiAgICAgICAgIGVsc2UKICAgICAgICAgICB0ID0gdGVtcGxhdGVzW2ldID0gSlNPTlV0aWwubWFwVG9PYmooc2VsZi5YLCB0KTsgLy8gc2FmZSBmb3IgYm9vdHN0cmFwLCBidXQgd29uJ3QgZG8gYW55dGhpbmcgaW4gdGhhdCBjYXNlLgogICAgICAgfQogICAgICAgaSsrOwogICAgIH0uYmluZChzZWxmKSkKICB9Cn07CgoKLyoqIElzIGFjdHVhbGx5IHN5bmNocm9ub3VzIGJ1dCBpcyByZXBsYWNlZCBpbiBDaHJvbWVBcHAgd2l0aCBhbiBhc3luYyB2ZXJzaW9uLiAqKi8KdmFyIGFldmFsID0gZnVuY3Rpb24oc3JjKSB7CiAgcmV0dXJuIGFjb25zdGFudChldmFsKCcoJyArIHNyYyArICcpJykpOwp9OwoKCnZhciBhZXZhbFRlbXBsYXRlID0gZnVuY3Rpb24odCkgewogIHZhciBkb0V2YWwgPSBmdW5jdGlvbih0KSB7CiAgICB2YXIgY29kZSA9IFRlbXBsYXRlQ29tcGlsZXIucGFyc2VTdHJpbmcodC50ZW1wbGF0ZSk7CgogICAgdHJ5IHsKICAgICAgdmFyIGFyZ3MgPSBbJ29wdF9vdXQnXTsKICAgICAgZm9yICggdmFyIGkgPSAwIDsgaSA8IHQuYXJncy5sZW5ndGggOyBpKysgKSB7CiAgICAgICAgYXJncy5wdXNoKHQuYXJnc1tpXS5uYW1lKTsKICAgICAgfQogICAgICByZXR1cm4gYWV2YWwoJ2Z1bmN0aW9uKCcgKyBhcmdzLmpvaW4oJywnKSArICcpeycgKyBjb2RlICsgJ30nKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICBjb25zb2xlLmxvZygnVGVtcGxhdGUgRXJyb3I6ICcsIGVycik7CiAgICAgIGNvbnNvbGUubG9nKGNvZGUpOwogICAgICByZXR1cm4gYWNvbnN0YW50KGZ1bmN0aW9uKCl7cmV0dXJuICdUZW1wbGF0ZUVycm9yOiBDaGVjayBjb25zb2xlLic7fSk7CiAgICB9CiAgfQoKICBpZiAoIHQudGVtcGxhdGUgKSB7CiAgICByZXR1cm4gZG9FdmFsKHQpOwogIH0KCiAgcmV0dXJuIGFzZXEoCiAgICB0LmZ1dHVyZVRlbXBsYXRlLAogICAgZnVuY3Rpb24ocmV0LCB0KSB7CiAgICAgIGRvRXZhbCh0KShyZXQpOwogICAgfSk7Cn07CgoK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 00:36:56 GMT",
                    "Content-Length": "12138",
                    "Date": "Fri, 07 Nov 2014 00:36:57 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}