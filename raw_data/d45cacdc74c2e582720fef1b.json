{
    "url": "http://localhost:9999/Igosuki/gepsens-ng-utils/node_modules/grunt-ngdocs/src/ngdoc.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>self.name</b> and written to <b>the 'text()' function of JQuery</b> via the following statement:<ul><li>dom.text(self.name);</li></ul><b>Note:</b> The name of the current window is a valid attack vector for DOM-based vulnerabilities. An attacker can directly control the name of the targeted application's window by using code on their own domain to load the targeted page using either window.open() or an iframe tag, and specifying the desired window name. ",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/Igosuki/gepsens-ng-utils/node_modules/grunt-ngdocs/src/ngdoc.js",
                "path": "/Igosuki/gepsens-ng-utils/node_modules/grunt-ngdocs/src/ngdoc.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9JZ29zdWtpL2dlcHNlbnMtbmctdXRpbHMvbm9kZV9tb2R1bGVzL2dydW50LW5nZG9jcy9zcmMvbmdkb2MuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMzE4MzENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDI6MTY6NTQgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDAyOjE2OjQ2IEdNVA0KDQovKioKICogQWxsIHBhcnNpbmcvdHJhbnNmb3JtYXRpb24gY29kZSBnb2VzIGhlcmUuIEFsbCBjb2RlIGhlcmUgc2hvdWxkIGJlIHN5bmMgdG8gZWFzZSB0ZXN0aW5nLgogKi8KCnZhciBTaG93ZG93biA9IHJlcXVpcmUoJ3Nob3dkb3duJyk7CnZhciBET00gPSByZXF1aXJlKCcuL2RvbS5qcycpLkRPTTsKdmFyIGh0bWxFc2NhcGUgPSByZXF1aXJlKCcuL2RvbS5qcycpLmh0bWxFc2NhcGU7CnZhciBFeGFtcGxlID0gcmVxdWlyZSgnLi9leGFtcGxlLmpzJykuRXhhbXBsZTsKdmFyIE5FV19MSU5FID0gL1xuXHI/LzsKdmFyIGdsb2JhbElEID0gMDsKdmFyIGZzID0gcmVxdWlyZSgnZnMnKTsKdmFyIGZzcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsKCmV4cG9ydHMudHJpbSA9IHRyaW07CmV4cG9ydHMubWV0YWRhdGEgPSBtZXRhZGF0YTsKZXhwb3J0cy5zY2VuYXJpb3MgPSBzY2VuYXJpb3M7CmV4cG9ydHMubWVyZ2UgPSBtZXJnZTsKZXhwb3J0cy5Eb2MgPSBEb2M7Cgp2YXIgQk9PTEVBTl9BVFRSID0ge307ClsnbXVsdGlwbGUnLCAnc2VsZWN0ZWQnLCAnY2hlY2tlZCcsICdkaXNhYmxlZCcsICdyZWFkT25seScsICdyZXF1aXJlZCddLmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHsKICBCT09MRUFOX0FUVFJbdmFsdWVdID0gdHJ1ZTsKfSk7CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCmZ1bmN0aW9uIERvYyh0ZXh0LCBmaWxlLCBsaW5lLCBvcHRpb25zKSB7CiAgaWYgKHR5cGVvZiB0ZXh0ID09ICdvYmplY3QnKSB7CiAgICBmb3IgKCB2YXIga2V5IGluIHRleHQpIHsKICAgICAgdGhpc1trZXldID0gdGV4dFtrZXldOwogICAgfQogIH0gZWxzZSB7CiAgICB0aGlzLnRleHQgPSB0ZXh0OwogICAgdGhpcy5maWxlID0gZmlsZTsKICAgIHRoaXMubGluZSA9IGxpbmU7CiAgfQogIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgdGhpcy5zY2VuYXJpb3MgPSB0aGlzLnNjZW5hcmlvcyB8fCBbXTsKICB0aGlzLnJlcXVpcmVzID0gdGhpcy5yZXF1aXJlcyB8fCBbXTsKICB0aGlzLnBhcmFtID0gdGhpcy5wYXJhbSB8fCBbXTsKICB0aGlzLnByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXMgfHwgW107CiAgdGhpcy5tZXRob2RzID0gdGhpcy5tZXRob2RzIHx8IFtdOwogIHRoaXMuZXZlbnRzID0gdGhpcy5ldmVudHMgfHwgW107CiAgdGhpcy5saW5rcyA9IHRoaXMubGlua3MgfHwgW107Cn0KRG9jLk1FVEFEQVRBX0lHTk9SRSA9IChmdW5jdGlvbigpIHsKICB2YXIgd29yZHMgPSByZXF1aXJlKCdmcycpLnJlYWRGaWxlU3luYyhfX2Rpcm5hbWUgKyAnL2lnbm9yZS53b3JkcycsICd1dGY4Jyk7CiAgcmV0dXJuIHdvcmRzLnRvU3RyaW5nKCkuc3BsaXQoL1ssXHNcblxyXSsvZ20pOwp9KSgpOwoKCkRvYy5wcm90b3R5cGUgPSB7CiAga2V5d29yZHM6IGZ1bmN0aW9uIGtleXdvcmRzKCkgewogICAgdmFyIGtleXdvcmRzID0ge307CiAgICB2YXIgd29yZHMgPSBbXTsKICAgIERvYy5NRVRBREFUQV9JR05PUkUuZm9yRWFjaChmdW5jdGlvbihpZ25vcmUpeyBrZXl3b3Jkc1tpZ25vcmVdID0gdHJ1ZTsgfSk7CgogICAgZnVuY3Rpb24gZXh0cmFjdFdvcmRzKHRleHQpIHsKICAgICAgdmFyIHRva2VucyA9IHRleHQudG9Mb3dlckNhc2UoKS5zcGxpdCgvW1wuXHMsYCciI10rL21nKTsKICAgICAgdG9rZW5zLmZvckVhY2goZnVuY3Rpb24oa2V5KXsKICAgICAgICB2YXIgbWF0Y2ggPSBrZXkubWF0Y2goL14oKG5nOnxbXCRfYS16XSlbXHdcLV9dKykvKTsKICAgICAgICBpZiAobWF0Y2gpewogICAgICAgICAga2V5ID0gbWF0Y2hbMV07CiAgICAgICAgICBpZiAoIWtleXdvcmRzW2tleV0pIHsKICAgICAgICAgICAga2V5d29yZHNba2V5XSA9IHRydWU7CiAgICAgICAgICAgIHdvcmRzLnB1c2goa2V5KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGV4dHJhY3RXb3Jkcyh0aGlzLnRleHQpOwogICAgdGhpcy5wcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkgewogICAgICBleHRyYWN0V29yZHMocHJvcC50ZXh0IHx8IHByb3AuZGVzY3JpcHRpb24gfHwgJycpOwogICAgfSk7CiAgICB0aGlzLm1ldGhvZHMuZm9yRWFjaChmdW5jdGlvbihtZXRob2QpIHsKICAgICAgZXh0cmFjdFdvcmRzKG1ldGhvZC50ZXh0IHx8IG1ldGhvZC5kZXNjcmlwdGlvbiB8fCAnJyk7CiAgICB9KTsKICAgIHdvcmRzLnNvcnQoKTsKICAgIHJldHVybiB3b3Jkcy5qb2luKCcgJyk7CiAgfSwKCiAgLyoqCiAgICogQ29udmVydHMgcmVsYXRpdmUgdXJscyAod2l0aG91dCBzZWN0aW9uKSBpbnRvIGFic29sdXRlCiAgICogQWJzb2x1dGUgdXJsIG1lYW5zIHVybCB3aXRoIHNlY3Rpb24KICAgKgogICAqIEBleGFtcGxlCiAgICogLSBpZiB0aGUgbGluayBpcyBpbnNpZGUgYW55IGFwaSBkb2M6CiAgICogYW5ndWxhci53aWRnZXQgLT4gYXBpL2FuZ3VsYXIud2lkZ2V0CiAgICoKICAgKiAtIGlmIHRoZSBsaW5rIGlzIGluc2lkZSBhbnkgZ3VpZCBkb2M6CiAgICogaW50cm8gLT4gZ3VpZGUvaW50cm8KICAgKgogICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQWJzb2x1dGUgb3IgcmVsYXRpdmUgdXJsCiAgICogQHJldHVybnMge3N0cmluZ30gQWJzb2x1dGUgdXJsCiAgICovCiAgY29udmVydFVybFRvQWJzb2x1dGU6IGZ1bmN0aW9uKHVybCkgewogICAgdmFyIHByZWZpeCA9IHRoaXMub3B0aW9ucy5odG1sNU1vZGUgPyAnJyA6ICcjLyc7CiAgICBpZiAodXJsLnN1YnN0cigtMSkgPT0gJy8nKSByZXR1cm4gdXJsICsgJ2luZGV4JzsKICAgIGlmICh1cmwubWF0Y2goL1wvLykpIHJldHVybiBwcmVmaXggKyB1cmw7CiAgICByZXR1cm4gcHJlZml4ICsgdGhpcy5zZWN0aW9uICsgJy8nICsgdXJsOwogIH0sCgogIG1hcmtkb3duOiBmdW5jdGlvbih0ZXh0KSB7CiAgICBpZiAoIXRleHQpIHJldHVybiB0ZXh0OwoKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgSVNfVVJMID0gL14oaHR0cHM/OlwvXC98ZnRwcz86XC9cL3xtYWlsdG86fFwufFwvKS8sCiAgICAgIElTX0FOR1VMQVIgPSAvXihhcGlcLyk/KGFuZ3VsYXJ8bmd8QVVUTylcLi8sCiAgICAgIElTX0hBU0ggPSAvXiMvLAogICAgICBwYXJ0cyA9IHRyaW0odGV4dCkuc3BsaXQoLyg8cHJlPltcc1xTXSo/PFwvcHJlPnw8ZG9jOmV4YW1wbGUoXFMqKS4qPz5bXHNcU10qPzxcL2RvYzpleGFtcGxlPnw8ZXhhbXBsZVtePl0qPltcc1xTXSo/PFwvZXhhbXBsZT4pLyksCiAgICAgIHNlcSA9IDAsCiAgICAgIHBsYWNlaG9sZGVyTWFwID0ge307CgogICAgZnVuY3Rpb24gcGxhY2Vob2xkZXIodGV4dCkgewogICAgICB2YXIgaWQgPSAnUkVQTEFDRU1FJyArIChzZXErKyk7CiAgICAgIHBsYWNlaG9sZGVyTWFwW2lkXSA9IHRleHQ7CiAgICAgIHJldHVybiBpZDsKICAgIH0KCiAgICBmdW5jdGlvbiBleHRyYWN0SW5saW5lRG9jQ29kZSh0ZXh0LCB0YWcpIHsKICAgICAgaWYodGFnID09ICdhbGwnKSB7CiAgICAgICAgLy91c2UgYSBncmVlZHkgb3BlcmF0b3IgdG8gbWF0Y2ggdGhlIGxhc3QgPC9kb2NzPiB0YWcKICAgICAgICByZWdleCA9IC9cL1wvPGRvY3MuKj8+KFsuXHNcU10rKVwvXC88XC9kb2NzPi9pbTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICAvL3VzZSBhIG5vbi1ncmVlZHkgb3BlcmF0b3IgdG8gbWF0Y2ggdGhlIG5leHQgPC9kb2NzPiB0YWcKICAgICAgICByZWdleCA9IG5ldyBSZWdFeHAoIlwvXC88ZG9jc1xccyp0YWc9XCIiICsgdGFnICsgIlwiLio/PihbLlxcc1xcU10rPylcL1wvPFwvZG9jcz4iLCJpbSIpOwogICAgICB9CiAgICAgIHZhciBtYXRjaGVzID0gcmVnZXguZXhlYyh0ZXh0LnRvU3RyaW5nKCkpOwogICAgICByZXR1cm4gbWF0Y2hlcyAmJiBtYXRjaGVzLmxlbmd0aCA+IDEgPyBtYXRjaGVzWzFdIDogIiI7CiAgICB9CgogICAgcGFydHMuZm9yRWFjaChmdW5jdGlvbih0ZXh0LCBpKSB7CiAgICAgIHBhcnRzW2ldID0gKHRleHQgfHwgJycpLgogICAgICAgIHJlcGxhY2UoLzxleGFtcGxlKD86XHMrbW9kdWxlPSIoW14iXSopIik/KD86XHMrZGVwcz0iKFteIl0qKSIpPyhccythbmltYXRpb25zPSJ0cnVlIik/PihbXHNcU10qPyk8XC9leGFtcGxlPi9nbWksCiAgICAgICAgICBmdW5jdGlvbihfLCBtb2R1bGUsIGRlcHMsIGFuaW1hdGlvbnMsIGNvbnRlbnQpIHsKCiAgICAgICAgICB2YXIgZXhhbXBsZSA9IG5ldyBFeGFtcGxlKHNlbGYuc2NlbmFyaW9zKTsKICAgICAgICAgIGlmKGFuaW1hdGlvbnMpIHsKICAgICAgICAgICAgZXhhbXBsZS5lbmFibGVBbmltYXRpb25zKCk7CiAgICAgICAgICB9CgogICAgICAgICAgZXhhbXBsZS5zZXRNb2R1bGUobW9kdWxlKTsKICAgICAgICAgIGV4YW1wbGUuYWRkRGVwcyhkZXBzKTsKICAgICAgICAgIGNvbnRlbnQucmVwbGFjZSgvPGZpbGVccytuYW1lPSIoW14iXSopIlxzKj4oW1xzXFNdKj8pPFwvZmlsZT4vZ21pLCBmdW5jdGlvbihfLCBuYW1lLCBjb250ZW50KSB7CiAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKG5hbWUsIGNvbnRlbnQpOwogICAgICAgICAgfSk7CiAgICAgICAgICBjb250ZW50LnJlcGxhY2UoLzxmaWxlXHMrc3JjPSIoW14iXSspIig/OlxzK3RhZz0iKFteIl0rKSIpPyg/OlxzK25hbWU9IihbXiJdKykiKT9ccypcLz8+L2dtaSwgZnVuY3Rpb24oXywgZmlsZSwgdGFnLCBuYW1lKSB7CiAgICAgICAgICAgIGlmKGZzcGF0aC5leGlzdHNTeW5jKGZpbGUpKSB7CiAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZSwgJ3V0ZjgnKTsKICAgICAgICAgICAgICBpZihjb250ZW50ICYmIGNvbnRlbnQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgaWYodGFnICYmIHRhZy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBleHRyYWN0SW5saW5lRG9jQ29kZShjb250ZW50LCB0YWcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUgJiYgbmFtZS5sZW5ndGggPiAwID8gbmFtZSA6IGZzcGF0aC5iYXNlbmFtZShmaWxlKTsKICAgICAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKG5hbWUsIGNvbnRlbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICB9KQogICAgICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyKGV4YW1wbGUudG9IdG1sKCkpOwogICAgICAgIH0pLgogICAgICAgIHJlcGxhY2UoLyg/OlwqXHMrKT88ZmlsZS4rP3NyYz0iKFteIl0rKSIoPzpccyt0YWc9IihbXiJdKykiKT9ccypcLz8+L2ksIGZ1bmN0aW9uKF8sIGZpbGUsIHRhZykgewogICAgICAgICAgaWYoZnNwYXRoLmV4aXN0c1N5bmMoZmlsZSkpIHsKICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZSwgJ3V0ZjgnKTsKICAgICAgICAgICAgaWYodGFnICYmIHRhZy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgY29udGVudCA9IGV4dHJhY3RJbmxpbmVEb2NDb2RlKGNvbnRlbnQsIHRhZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7CiAgICAgICAgICB9CiAgICAgICAgfSkuCiAgICAgICAgcmVwbGFjZSgvXjxkb2M6ZXhhbXBsZShccytbXj5dKik/PihbXHNcU10qKTxcL2RvYzpleGFtcGxlPi9taSwgZnVuY3Rpb24oXywgYXR0cnMsIGNvbnRlbnQpIHsKICAgICAgICAgIHZhciBodG1sLCBzY3JpcHQsIHNjZW5hcmlvLAogICAgICAgICAgICBleGFtcGxlID0gbmV3IEV4YW1wbGUoc2VsZi5zY2VuYXJpb3MpOwoKICAgICAgICAgIGV4YW1wbGUuc2V0TW9kdWxlKChhdHRyc3x8J21vZHVsZT0iIicpLm1hdGNoKC9eXHMqbW9kdWxlPVsiJ10oLiopWyInXVxzKiQvKVsxXSk7CiAgICAgICAgICBjb250ZW50LgogICAgICAgICAgICByZXBsYWNlKC88ZG9jOnNvdXJjZShccytbXj5dKik/PihbXHNcU10qKTxcL2RvYzpzb3VyY2U+L21pLCBmdW5jdGlvbihfLCBhdHRycywgY29udGVudCkgewogICAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKCdpbmRleC5odG1sJywgY29udGVudC4KICAgICAgICAgICAgICAgIHJlcGxhY2UoLzxzY3JpcHQ+KFtcc1xTXSopPFwvc2NyaXB0Pi9taSwgZnVuY3Rpb24oXywgc2NyaXB0KSB7CiAgICAgICAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKCdzY3JpcHQuanMnLCBzY3JpcHQpOwogICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICB9KS4KICAgICAgICAgICAgICAgIHJlcGxhY2UoLzxzdHlsZT4oW1xzXFNdKik8XC9zdHlsZT4vbWksIGZ1bmN0aW9uKF8sIHN0eWxlKSB7CiAgICAgICAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKCdzdHlsZS5jc3MnLCBzdHlsZSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSkuCiAgICAgICAgICAgIHJlcGxhY2UoLyg8ZG9jOnNjZW5hcmlvPikoW1xzXFNdKikoPFwvZG9jOnNjZW5hcmlvPikvbWksIGZ1bmN0aW9uKF8sIGJlZm9yZSwgY29udGVudCl7CiAgICAgICAgICAgICAgZXhhbXBsZS5hZGRTb3VyY2UoJ3NjZW5hcmlvLmpzJywgY29udGVudCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiBwbGFjZWhvbGRlcihleGFtcGxlLnRvSHRtbCgpKTsKICAgICAgICB9KS4KICAgICAgICByZXBsYWNlKC9ePHByZT4oW1xzXFNdKj8pPFwvcHJlPi9taSwgZnVuY3Rpb24oXywgY29udGVudCl7CiAgICAgICAgICByZXR1cm4gcGxhY2Vob2xkZXIoCiAgICAgICAgICAgICc8cHJlIGNsYXNzPSJwcmV0dHlwcmludCBsaW5lbnVtcyI+JyArCiAgICAgICAgICAgICAgY29udGVudC5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvPi9nLCAnJmd0OycpICsKICAgICAgICAgICAgICAnPC9wcmU+Jyk7CiAgICAgICAgfSkuCiAgICAgICAgcmVwbGFjZSgvPGRpdihbXj5dKik+PFwvZGl2Pi8sICc8ZGl2JDE+XG48XC9kaXY+JykuCiAgICAgICAgcmVwbGFjZSgve0BsaW5rXHMrKFteXHN9XSspXHMqKFtefV0qPylccyp9L2csIGZ1bmN0aW9uKF9hbGwsIHVybCwgdGl0bGUpewogICAgICAgICAgdmFyIGlzRnVsbFVybCA9IHVybC5tYXRjaChJU19VUkwpLAogICAgICAgICAgICBpc0FuZ3VsYXIgPSB1cmwubWF0Y2goSVNfQU5HVUxBUiksCiAgICAgICAgICAgIGlzSGFzaCA9IHVybC5tYXRjaChJU19IQVNIKSwKICAgICAgICAgICAgYWJzVXJsID0gaXNIYXNoCiAgICAgICAgICAgICAgPyB1cmwKICAgICAgICAgICAgICA6IChpc0Z1bGxVcmwgPyB1cmwgOiBzZWxmLmNvbnZlcnRVcmxUb0Fic29sdXRlKHVybCkpOwoKICAgICAgICAgIGlmICghaXNGdWxsVXJsKSBzZWxmLmxpbmtzLnB1c2goYWJzVXJsKTsKCiAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgKyBhYnNVcmwgKyAnIj4nICsKICAgICAgICAgICAgKGlzQW5ndWxhciA/ICc8Y29kZT4nIDogJycpICsKICAgICAgICAgICAgKHRpdGxlIHx8IHVybCkucmVwbGFjZSgvXiMvZywgJycpLnJlcGxhY2UoL1xuL2csICcgJykgKwogICAgICAgICAgICAoaXNBbmd1bGFyID8gJzwvY29kZT4nIDogJycpICsKICAgICAgICAgICAgJzwvYT4nOwogICAgICAgIH0pOwogICAgfSk7CiAgICB0ZXh0ID0gcGFydHMuam9pbignJyk7CiAgICB0ZXh0ID0gbmV3IFNob3dkb3duLmNvbnZlcnRlcih7IGV4dGVuc2lvbnMgOiBbJ3RhYmxlJ10gfSkubWFrZUh0bWwodGV4dCk7CiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8oPzo8cD4pPyhSRVBMQUNFTUVcZCspKD86PFwvcD4pPy9nLCBmdW5jdGlvbihfLCBpZCkgewogICAgICByZXR1cm4gcGxhY2Vob2xkZXJNYXBbaWRdOwogICAgfSk7CiAgICByZXR1cm4gdGV4dDsKICB9LAoKICBwYXJzZTogZnVuY3Rpb24oKSB7CiAgICB2YXIgYXROYW1lOwogICAgdmFyIGF0VGV4dDsKICAgIHZhciBtYXRjaDsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHNlbGYudGV4dC5zcGxpdChORVdfTElORSkuZm9yRWFjaChmdW5jdGlvbihsaW5lKXsKICAgICAgaWYgKChtYXRjaCA9IGxpbmUubWF0Y2goL15ccypAKFx3KykoXHMrKC4qKSk/LykpKSB7CiAgICAgICAgLy8gd2UgZm91bmQgQG5hbWUgLi4uCiAgICAgICAgLy8gaWYgd2UgaGF2ZSBleGlzdGluZyBuYW1lCiAgICAgICAgZmx1c2goKTsKICAgICAgICBhdE5hbWUgPSBtYXRjaFsxXTsKICAgICAgICBhdFRleHQgPSBbXTsKICAgICAgICBpZihtYXRjaFszXSkgYXRUZXh0LnB1c2gobWF0Y2hbM10pOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChhdE5hbWUpIHsKICAgICAgICAgIGF0VGV4dC5wdXNoKGxpbmUpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICBmbHVzaCgpOwogICAgdGhpcy5zaG9ydE5hbWUgPSB0aGlzLm5hbWUuc3BsaXQoL1tcLjojXS8pLnBvcCgpLnRyaW0oKTsKICAgIHRoaXMuaWQgPSB0aGlzLmlkIHx8IC8vIGlmIHdlIGhhdmUgYW4gaWQganVzdCB1c2UgaXQKICAgICAgKCgodGhpcy5maWxlfHwnJykubWF0Y2goLy4qKFwvfFxcKShbXihcL3xcXCldKilcLm5nZG9jLyl8fHt9KVsyXSkgfHwgLy8gdHJ5IHRvIGV4dHJhY3QgaXQgZnJvbSBmaWxlIG5hbWUKICAgICAgdGhpcy5uYW1lOyAvLyBkZWZhdWx0IHRvIG5hbWUKICAgIHRoaXMuZGVzY3JpcHRpb24gPSB0aGlzLm1hcmtkb3duKHRoaXMuZGVzY3JpcHRpb24pOwogICAgdGhpcy5leGFtcGxlID0gdGhpcy5tYXJrZG93bih0aGlzLmV4YW1wbGUpOwogICAgdGhpc1sndGhpcyddID0gdGhpcy5tYXJrZG93bih0aGlzWyd0aGlzJ10pOwogICAgcmV0dXJuIHRoaXM7CgogICAgZnVuY3Rpb24gZmx1c2goKSB7CiAgICAgIGlmIChhdE5hbWUpIHsKICAgICAgICB2YXIgdGV4dCA9IHRyaW0oYXRUZXh0LmpvaW4oJ1xuJykpLCBtYXRjaDsKICAgICAgICBpZiAoYXROYW1lID09ICdwYXJhbScpIHsKICAgICAgICAgIG1hdGNoID0gdGV4dC5tYXRjaCgvXlx7KFtefV0rKVx9XHMrKChbXlxzPV0rKXxcWyhcUyspPShbXlxdXSspXF0pXHMrKC4qKS8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAxICAgICAgMSAgICAyMyAgICAgICAzICAgNCAgIDQgNSAgICAgIDUgIDIgICA2ICA2CiAgICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgdmFsaWQgJ3BhcmFtJyBmb3JtYXQ6ICIgKyB0ZXh0ICsgJyAoZm91bmQgaW46ICcgKyBzZWxmLmZpbGUgKyAnOicgKyBzZWxmLmxpbmUgKyAnKScpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvcHRpb25hbCA9IChtYXRjaFsxXS5zbGljZSgtMSkgPT09ICc9Jyk7CiAgICAgICAgICB2YXIgcGFyYW0gPSB7CiAgICAgICAgICAgIG5hbWU6IG1hdGNoWzRdIHx8IG1hdGNoWzNdLAogICAgICAgICAgICBkZXNjcmlwdGlvbjpzZWxmLm1hcmtkb3duKHRleHQucmVwbGFjZShtYXRjaFswXSwgbWF0Y2hbNl0pKSwKICAgICAgICAgICAgdHlwZTogb3B0aW9uYWwgPyBtYXRjaFsxXS5zdWJzdHJpbmcoMCwgbWF0Y2hbMV0ubGVuZ3RoLTEpIDogbWF0Y2hbMV0sCiAgICAgICAgICAgIG9wdGlvbmFsOiBvcHRpb25hbCwKICAgICAgICAgICAgJ2RlZmF1bHQnOm1hdGNoWzVdCiAgICAgICAgICB9OwogICAgICAgICAgCiAgICAgICAgICAvL2lmIHBhcmFtIG5hbWUgaXMgYSBwYXJ0IG9mIGFuIG9iamVjdCBwYXNzZWQgdG8gYSBtZXRob2QKICAgICAgICAgIC8vbWFyayBpdCwgc28gaXQncyBub3QgaW5jbHVkZWQgaW4gdGhlIHJlbmRlcmluZyBsYXRlcgogICAgICAgICAgaWYocGFyYW0ubmFtZS5pbmRleE9mKCIuIikgPiAwKXsKICAgICAgICAgICAgICBwYXJhbS5pc1Byb3BlcnR5ID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIAogICAgICAgICAgc2VsZi5wYXJhbS5wdXNoKHBhcmFtKTsKICAgICAgICB9IGVsc2UgaWYgKGF0TmFtZSA9PSAncmV0dXJucycgfHwgYXROYW1lID09ICdyZXR1cm4nKSB7CiAgICAgICAgICBtYXRjaCA9IHRleHQubWF0Y2goL15ceyhbXn1dKylcfVxzKyguKikvKTsKICAgICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgYSB2YWxpZCAncmV0dXJucycgZm9ybWF0OiAiICsgdGV4dCArICcgKGZvdW5kIGluOiAnICsgc2VsZi5maWxlICsgJzonICsgc2VsZi5saW5lICsgJyknKTsKICAgICAgICAgIH0KICAgICAgICAgIHNlbGYucmV0dXJucyA9IHsKICAgICAgICAgICAgdHlwZTogbWF0Y2hbMV0sCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBzZWxmLm1hcmtkb3duKHRleHQucmVwbGFjZShtYXRjaFswXSwgbWF0Y2hbMl0pKQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYoYXROYW1lID09ICdyZXF1aXJlcycpIHsKICAgICAgICAgIG1hdGNoID0gdGV4dC5tYXRjaCgvXihbXlxzXSopXHMqKFtcU1xzXSopLyk7CiAgICAgICAgICBzZWxmLnJlcXVpcmVzLnB1c2goewogICAgICAgICAgICBuYW1lOiBtYXRjaFsxXSwKICAgICAgICAgICAgdGV4dDogc2VsZi5tYXJrZG93bihtYXRjaFsyXSkKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZihhdE5hbWUgPT0gJ3Byb3BlcnR5JykgewogICAgICAgICAgbWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eXHsoXFMrKVx9XHMrKFxTKykoXHMrKC4qKSk/Lyk7CiAgICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgdmFsaWQgJ3Byb3BlcnR5JyBmb3JtYXQ6ICIgKyB0ZXh0ICsgJyAoZm91bmQgaW46ICcgKyBzZWxmLmZpbGUgKyAnOicgKyBzZWxmLmxpbmUgKyAnKScpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHByb3BlcnR5ID0gbmV3IERvYyh7CiAgICAgICAgICAgIHR5cGU6IG1hdGNoWzFdLAogICAgICAgICAgICBuYW1lOiBtYXRjaFsyXSwKICAgICAgICAgICAgc2hvcnROYW1lOiBtYXRjaFsyXSwKICAgICAgICAgICAgZGVzY3JpcHRpb246IHNlbGYubWFya2Rvd24odGV4dC5yZXBsYWNlKG1hdGNoWzBdLCBtYXRjaFs0XSkpCiAgICAgICAgICB9KTsKICAgICAgICAgIHNlbGYucHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTsKICAgICAgICB9IGVsc2UgaWYoYXROYW1lID09ICdldmVudFR5cGUnKSB7CiAgICAgICAgICBtYXRjaCA9IHRleHQubWF0Y2goL14oW15cc10qKVxzK29uXHMrKFtcU1xzXSopLyk7CiAgICAgICAgICBzZWxmLnR5cGUgPSBtYXRjaFsxXTsKICAgICAgICAgIHNlbGYudGFyZ2V0ID0gbWF0Y2hbMl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlbGZbYXROYW1lXSA9IHRleHQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKCiAgaHRtbDogZnVuY3Rpb24oKSB7CiAgICB2YXIgZG9tID0gbmV3IERPTSgpLAogICAgICBzZWxmID0gdGhpczsKCiAgICBkb20uaCh0aXRsZSh0aGlzLm5hbWUsIHRoaXMubmdkb2MgPT0gJ292ZXJ2aWV3JyksIGZ1bmN0aW9uKCkgewoKICAgICAgbm90aWNlKCdkZXByZWNhdGVkJywgJ0RlcHJlY2F0ZWQgQVBJJywgc2VsZi5kZXByZWNhdGVkKTsKICAgICAgaWYgKHNlbGYubmdkb2MgIT0gJ292ZXJ2aWV3JykgewogICAgICAgIGRvbS5oKCdEZXNjcmlwdGlvbicsIHNlbGYuZGVzY3JpcHRpb24sIGRvbS5odG1sKTsKICAgICAgfQogICAgICBkb20uaCgnRGVwZW5kZW5jaWVzJywgc2VsZi5yZXF1aXJlcywgZnVuY3Rpb24ocmVxdWlyZSl7CiAgICAgICAgZG9tLnRhZygnY29kZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGlkID0gL1tcLlwvXS8udGVzdChyZXF1aXJlLm5hbWUpID8gcmVxdWlyZS5uYW1lIDogJ25nLicgKyByZXF1aXJlLm5hbWUsCiAgICAgICAgICAgICAgbmFtZSA9IHJlcXVpcmUubmFtZS5zcGxpdCgvW1wuOiNcL10vKS5wb3AoKTsKICAgICAgICAgIGRvbS50YWcoJ2EnLCB7aHJlZjogc2VsZi5jb252ZXJ0VXJsVG9BYnNvbHV0ZShpZCl9LCBuYW1lKTsKICAgICAgICB9KTsKICAgICAgICBkb20uaHRtbChyZXF1aXJlLnRleHQpOwogICAgICB9KTsKCiAgICAgIChzZWxmWydodG1sX3VzYWdlXycgKyBzZWxmLm5nZG9jXSB8fCBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkRvbid0IGtub3cgaG93IHRvIGZvcm1hdCBAbmdkb2M6ICIgKyBzZWxmLm5nZG9jKTsKICAgICAgfSkuY2FsbChzZWxmLCBkb20pOwoKICAgICAgZG9tLmgoJ0V4YW1wbGUnLCBzZWxmLmV4YW1wbGUsIGRvbS5odG1sKTsKICAgIH0pOwoKICAgIHJldHVybiBkb20udG9TdHJpbmcoKTsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIG5vdGljZShuYW1lLCBsZWdlbmQsIG1zZyl7CiAgICAgIGlmIChzZWxmW25hbWVdID09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgICBkb20udGFnKCdmaWVsZHNldCcsIHsnY2xhc3MnOm5hbWV9LCBmdW5jdGlvbihkb20pewogICAgICAgIGRvbS50YWcoJ2xlZ2VuZCcsIGxlZ2VuZCk7CiAgICAgICAgZG9tLnRleHQobXNnKTsKICAgICAgfSk7CiAgICB9CgogIH0sCgogIGh0bWxfdXNhZ2VfcGFyYW1ldGVyczogZnVuY3Rpb24oZG9tKSB7CiAgICBkb20uaCgnUGFyYW1ldGVycycsIHRoaXMucGFyYW0sIGZ1bmN0aW9uKHBhcmFtKXsKICAgICAgZG9tLnRhZygnY29kZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvbS50ZXh0KHBhcmFtLm5hbWUpOwogICAgICAgIGlmIChwYXJhbS5vcHRpb25hbCkgewogICAgICAgICAgZG9tLnRhZygnaScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBkb20udGV4dCgnKG9wdGlvbmFsJyk7CiAgICAgICAgICAgIGlmKHBhcmFtWydkZWZhdWx0J10pIHsKICAgICAgICAgICAgICBkb20udGV4dCgnPScgKyBwYXJhbVsnZGVmYXVsdCddKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkb20udGV4dCgnKScpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGRvbS50ZXh0KCcg4oCTIHsnKTsKICAgICAgICBkb20udGV4dChwYXJhbS50eXBlKTsKICAgICAgICBpZiAocGFyYW0ub3B0aW9uYWwpIHsKICAgICAgICAgIGRvbS50ZXh0KCc9Jyk7CiAgICAgICAgfQogICAgICAgIGRvbS50ZXh0KCd9IOKAkyAnKTsKICAgICAgfSk7CiAgICAgIGRvbS5odG1sKHBhcmFtLmRlc2NyaXB0aW9uKTsKICAgIH0pOwogICAgaWYodGhpcy5hbmltYXRpb25zKSB7CiAgICAgIGRvbS5oKCdBbmltYXRpb25zJywgdGhpcy5hbmltYXRpb25zLCBmdW5jdGlvbihhbmltYXRpb25zKXsKICAgICAgICBkb20uaHRtbCgnPHVsPicpOwogICAgICAgIHZhciBhbmltYXRpb25zID0gYW5pbWF0aW9ucy5zcGxpdCgiXG4iKTsKICAgICAgICBhbmltYXRpb25zLmZvckVhY2goZnVuY3Rpb24oYW5pKSB7CiAgICAgICAgICBkb20uaHRtbCgnPGxpPicpOwogICAgICAgICAgZG9tLnRleHQoYW5pKTsKICAgICAgICAgIGRvbS5odG1sKCc8L2xpPicpOwogICAgICAgIH0pOwogICAgICAgIGRvbS5odG1sKCc8L3VsPicpOwogICAgICB9KTsKICAgIH0KICB9LAoKICBodG1sX3VzYWdlX3JldHVybnM6IGZ1bmN0aW9uKGRvbSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKHNlbGYucmV0dXJucykgewogICAgICBkb20uaCgnUmV0dXJucycsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvbS50YWcoJ2NvZGUnLCAneycgKyBzZWxmLnJldHVybnMudHlwZSArICd9Jyk7CiAgICAgICAgZG9tLnRleHQoJ+KAkyAnKTsKICAgICAgICBkb20uaHRtbChzZWxmLnJldHVybnMuZGVzY3JpcHRpb24pOwogICAgICB9KTsKICAgIH0KICB9LAoKICBodG1sX3VzYWdlX3RoaXM6IGZ1bmN0aW9uKGRvbSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKHNlbGZbJ3RoaXMnXSkgewogICAgICBkb20uaChmdW5jdGlvbihkb20pewogICAgICAgIGRvbS5odG1sKCJNZXRob2QncyA8Y29kZT50aGlzPC9jb2RlPiIpOwogICAgICB9LCBmdW5jdGlvbihkb20pewogICAgICAgIGRvbS5odG1sKHNlbGZbJ3RoaXMnXSk7CiAgICAgIH0pOwogICAgfQogIH0sCgogIGh0bWxfdXNhZ2VfZnVuY3Rpb246IGZ1bmN0aW9uKGRvbSl7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgbmFtZSA9IHNlbGYubmFtZS5tYXRjaCgvXmFuZ3VsYXIoXC5tb2NrKT9cLihcdyspJC8pID8gc2VsZi5uYW1lIDogc2VsZi5uYW1lLnNwbGl0KC9cLi8pLnBvcCgpOwoKICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICBkb20udGV4dChuYW1lLnNwbGl0KCc6JykucG9wKCkpOwogICAgICAgIGRvbS50ZXh0KCcoJyk7CiAgICAgICAgc2VsZi5wYXJhbWV0ZXJzKGRvbSwgJywgJyk7CiAgICAgICAgZG9tLnRleHQoJyk7Jyk7CiAgICAgIH0pOwoKICAgICAgc2VsZi5odG1sX3VzYWdlX3BhcmFtZXRlcnMoZG9tKTsKICAgICAgc2VsZi5odG1sX3VzYWdlX3RoaXMoZG9tKTsKICAgICAgc2VsZi5odG1sX3VzYWdlX3JldHVybnMoZG9tKTsKICAgIH0pOwogICAgdGhpcy5tZXRob2RfcHJvcGVydGllc19ldmVudHMoZG9tKTsKICB9LAoKICBodG1sX3VzYWdlX3Byb3BlcnR5OiBmdW5jdGlvbihkb20pewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgZG9tLmgoJ1VzYWdlJywgZnVuY3Rpb24oKSB7CiAgICAgIGRvbS5jb2RlKGZ1bmN0aW9uKCkgewogICAgICAgIGRvbS50ZXh0KHNlbGYubmFtZSk7CiAgICAgIH0pOwoKICAgICAgc2VsZi5odG1sX3VzYWdlX3JldHVybnMoZG9tKTsKICAgIH0pOwogIH0sCgogIGh0bWxfdXNhZ2VfZGlyZWN0aXZlOiBmdW5jdGlvbihkb20pewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgZG9tLmgoJ1VzYWdlJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciByZXN0cmljdCA9IHNlbGYucmVzdHJpY3QgfHwgJ0FDJzsKCiAgICAgIC8qaWYgKHJlc3RyaWN0Lm1hdGNoKC9FLykpIHsKICAgICAgICBkb20uaHRtbCgnPHA+Jyk7CiAgICAgICAgZG9tLnRleHQoJ1RoaXMgZGlyZWN0aXZlIGNhbiBiZSB1c2VkIGFzIGN1c3RvbSBlbGVtZW50LCBidXQgYmUgYXdhcmUgb2YgJyk7CiAgICAgICAgZG9tLnRhZygnYScsIHtocmVmOidodHRwOi8vZG9jcy5hbmd1bGFyanMub3JnL2d1aWRlL2llJ30sICdJRSByZXN0cmljdGlvbnMnKTsKICAgICAgICBkb20udGV4dCgnLicpOwogICAgICAgIGRvbS5odG1sKCc8L3A+Jyk7CiAgICAgIH0qLwoKICAgICAgaWYgKHNlbGYudXNhZ2UpIHsKICAgICAgICBkb20udGFnKCdwcmUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGRvbS50YWcoJ2NvZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoc2VsZi51c2FnZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocmVzdHJpY3QubWF0Y2goL0UvKSkgewogICAgICAgICAgZG9tLnRleHQoJ2FzIGVsZW1lbnQ6Jyk7CiAgICAgICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoJzwnKTsKICAgICAgICAgICAgZG9tLnRleHQoZGFzaENhc2Uoc2VsZi5zaG9ydE5hbWUpKTsKICAgICAgICAgICAgcmVuZGVyUGFyYW1zKCdcbiAgICAgICAnLCAnPSInLCAnIicpOwogICAgICAgICAgICBkb20udGV4dCgnPlxuPC8nKTsKICAgICAgICAgICAgZG9tLnRleHQoZGFzaENhc2Uoc2VsZi5zaG9ydE5hbWUpKTsKICAgICAgICAgICAgZG9tLnRleHQoJz4nKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAocmVzdHJpY3QubWF0Y2goL0EvKSkgewogICAgICAgICAgdmFyIGVsZW1lbnQgPSBzZWxmLmVsZW1lbnQgfHwgJ0FOWSc7CiAgICAgICAgICBkb20udGV4dCgnYXMgYXR0cmlidXRlJyk7CiAgICAgICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoJzwnICsgZWxlbWVudCArICcgJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KGRhc2hDYXNlKHNlbGYuc2hvcnROYW1lKSk7CiAgICAgICAgICAgIHJlbmRlclBhcmFtcygnXG4gICAgICcsICc9IicsICciJywgdHJ1ZSk7CiAgICAgICAgICAgIGRvbS50ZXh0KCc+XG4gICAuLi5cbicpOwogICAgICAgICAgICBkb20udGV4dCgnPC8nICsgZWxlbWVudCArICc+Jyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlc3RyaWN0Lm1hdGNoKC9DLykpIHsKICAgICAgICAgIGRvbS50ZXh0KCdhcyBjbGFzcycpOwogICAgICAgICAgdmFyIGVsZW1lbnQgPSBzZWxmLmVsZW1lbnQgfHwgJ0FOWSc7CiAgICAgICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoJzwnICsgZWxlbWVudCArICcgY2xhc3M9IicpOwogICAgICAgICAgICBkb20udGV4dChkYXNoQ2FzZShzZWxmLnNob3J0TmFtZSkpOwogICAgICAgICAgICByZW5kZXJQYXJhbXMoJyAnLCAnOiAnLCAnOycsIHRydWUpOwogICAgICAgICAgICBkb20udGV4dCgnIj5cbiAgIC4uLlxuJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KCc8LycgKyBlbGVtZW50ICsgJz4nKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZihzZWxmLmFuaW1hdGlvbnMpIHsKICAgICAgICAgIHZhciBhbmltYXRpb25zID0gW10sIG1hdGNoZXMgPSBzZWxmLmFuaW1hdGlvbnMuc3BsaXQoIlxuIik7CiAgICAgICAgICBtYXRjaGVzLmZvckVhY2goZnVuY3Rpb24oYW5pKSB7CiAgICAgICAgICAgIHZhciBuYW1lID0gYW5pLm1hdGNoKC9eXHMqKC4rPylccyotLylbMV07CiAgICAgICAgICAgIGFuaW1hdGlvbnMucHVzaChuYW1lKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGRvbS5odG1sKCd3aXRoIDxzcGFuIGlkPSJhbmltYXRpb25zIj5hbmltYXRpb25zPC9zcGFuPicpOwogICAgICAgICAgdmFyIGNvbW1lbnQ7CiAgICAgICAgICBpZihhbmltYXRpb25zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgIGNvbW1lbnQgPSAnVGhlICcgKyBhbmltYXRpb25zWzBdICsgJyBhbmltYXRpb24gaXMgc3VwcG9ydGVkJzsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgcmhzID0gYW5pbWF0aW9uc1thbmltYXRpb25zLmxlbmd0aC0xXTsKICAgICAgICAgICAgdmFyIGxocyA9ICcnOwogICAgICAgICAgICBmb3IodmFyIGk9MDtpPGFuaW1hdGlvbnMubGVuZ3RoLTE7aSsrKSB7CiAgICAgICAgICAgICAgaWYoaT4wKSB7CiAgICAgICAgICAgICAgICBsaHMgKz0gJywgJzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbGhzICs9IGFuaW1hdGlvbnNbaV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29tbWVudCA9ICdUaGUgJyArIGxocyArICcgYW5kICcgKyByaHMgKyAnIGFuaW1hdGlvbnMgYXJlIHN1cHBvcnRlZCc7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZWxlbWVudCA9IHNlbGYuZWxlbWVudCB8fCAnQU5ZJzsKICAgICAgICAgIGRvbS5jb2RlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBkb20udGV4dCgnLy8nICsgY29tbWVudCArICJcbiIpOwogICAgICAgICAgICBkb20udGV4dCgnPCcgKyBlbGVtZW50ICsgJyAnKTsKICAgICAgICAgICAgZG9tLnRleHQoZGFzaENhc2Uoc2VsZi5zaG9ydE5hbWUpKTsKICAgICAgICAgICAgcmVuZGVyUGFyYW1zKCdcbiAgICAgJywgJz0iJywgJyInLCB0cnVlKTsKICAgICAgICAgICAgZG9tLnRleHQoJyBuZy1hbmltYXRlPSJ7Jyk7CiAgICAgICAgICAgIGFuaW1hdGlvbnMuZm9yRWFjaChmdW5jdGlvbihhbmksIGluZGV4KSB7CiAgICAgICAgICAgICAgaWYgKGluZGV4KSB7CiAgICAgICAgICAgICAgICBkb20udGV4dCgnLCAnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZG9tLnRleHQoYW5pICsgJzogXCcnICsgYW5pICsgJy1hbmltYXRpb25cJycpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZG9tLnRleHQoJ30iPlxuICAgLi4uXG4nKTsKICAgICAgICAgICAgZG9tLnRleHQoJzwvJyArIGVsZW1lbnQgKyAnPicpOwogICAgICAgICAgfSk7CgogICAgICAgICAgZG9tLmh0bWwoJzxhIGhyZWY9ImFwaS9uZy4kYW5pbWF0b3IjTWV0aG9kcyI+Q2xpY2sgaGVyZTwvYT4gdG8gbGVhcm4gbW9yZSBhYm91dCB0aGUgc3RlcHMgaW52b2x2ZWQgaW4gdGhlIGFuaW1hdGlvbi4nKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc2VsZi5odG1sX3VzYWdlX2RpcmVjdGl2ZUluZm8oZG9tKTsKICAgICAgc2VsZi5odG1sX3VzYWdlX3BhcmFtZXRlcnMoZG9tKTsKICAgIH0pOwoKICAgIHNlbGYubWV0aG9kX3Byb3BlcnRpZXNfZXZlbnRzKGRvbSk7CgogICAgZnVuY3Rpb24gcmVuZGVyUGFyYW1zKHByZWZpeCwgaW5maXgsIHN1ZmZpeCwgc2tpcFNlbGYpIHsKICAgICAgKHNlbGYucGFyYW18fFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHBhcmFtKSB7CiAgICAgICAgdmFyIHNraXAgPSBza2lwU2VsZiAmJiAocGFyYW0ubmFtZSA9PSBzZWxmLnNob3J0TmFtZSB8fCBwYXJhbS5uYW1lLmluZGV4T2Yoc2VsZi5zaG9ydE5hbWUgKyAnfCcpID09IDApOwogICAgICAgIGlmICghc2tpcCkgewogICAgICAgICAgZG9tLnRleHQocHJlZml4KTsKICAgICAgICAgIGRvbS50ZXh0KHBhcmFtLm9wdGlvbmFsID8gJ1snIDogJycpOwogICAgICAgICAgdmFyIHBhcnRzID0gcGFyYW0ubmFtZS5zcGxpdCgnfCcpOwogICAgICAgICAgZG9tLnRleHQocGFydHNbc2tpcFNlbGYgPyAwIDogMV0gfHwgcGFydHNbMF0pOwogICAgICAgIH0KICAgICAgICBpZiAoQk9PTEVBTl9BVFRSW3BhcmFtLm5hbWVdKSB7CiAgICAgICAgICBkb20udGV4dChwYXJhbS5vcHRpb25hbCA/ICddJyA6ICcnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZG9tLnRleHQoQk9PTEVBTl9BVFRSW3BhcmFtLm5hbWVdID8gJycgOiBpbmZpeCApOwogICAgICAgICAgZG9tLnRleHQoKCd7JyArIHBhcmFtLnR5cGUgKyAnfScpLnJlcGxhY2UoL15ce1wnKC4qKVwnXH0kLywgJyQxJykpOwogICAgICAgICAgZG9tLnRleHQoc3VmZml4KTsKICAgICAgICAgIGRvbS50ZXh0KHBhcmFtLm9wdGlvbmFsICYmICFza2lwID8gJ10nIDogJycpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogIH0sCgogIGh0bWxfdXNhZ2VfZmlsdGVyOiBmdW5jdGlvbihkb20pewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgZG9tLmgoJ1VzYWdlJywgZnVuY3Rpb24oKSB7CiAgICAgIGRvbS5oKCdJbiBIVE1MIFRlbXBsYXRlIEJpbmRpbmcnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb20udGFnKCdjb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoc2VsZi51c2FnZSkgewogICAgICAgICAgICBkb20udGV4dChzZWxmLnVzYWdlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvbS50ZXh0KCd7eyAnKTsKICAgICAgICAgICAgZG9tLnRleHQoc2VsZi5zaG9ydE5hbWUpOwogICAgICAgICAgICBkb20udGV4dCgnX2V4cHJlc3Npb24gfCAnKTsKICAgICAgICAgICAgZG9tLnRleHQoc2VsZi5zaG9ydE5hbWUpOwogICAgICAgICAgICBzZWxmLnBhcmFtZXRlcnMoZG9tLCAnOicsIHRydWUpOwogICAgICAgICAgICBkb20udGV4dCgnIH19Jyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgZG9tLmgoJ0luIEphdmFTY3JpcHQnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb20udGFnKCdjb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBkb20udGV4dCgnJGZpbHRlcihcJycpOwogICAgICAgICAgZG9tLnRleHQoc2VsZi5zaG9ydE5hbWUpOwogICAgICAgICAgZG9tLnRleHQoJ1wnKSgnKTsKICAgICAgICAgIHNlbGYucGFyYW1ldGVycyhkb20sICcsICcpOwogICAgICAgICAgZG9tLnRleHQoJyknKTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBzZWxmLmh0bWxfdXNhZ2VfcGFyYW1ldGVycyhkb20pOwogICAgICBzZWxmLmh0bWxfdXNhZ2VfdGhpcyhkb20pOwogICAgICBzZWxmLmh0bWxfdXNhZ2VfcmV0dXJucyhkb20pOwogICAgfSk7CiAgfSwKCiAgaHRtbF91c2FnZV9pbnB1dFR5cGU6IGZ1bmN0aW9uKGRvbSl7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBkb20uaCgnVXNhZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnRleHQoJzxpbnB1dCB0eXBlPSInICsgc2VsZi5zaG9ydE5hbWUgKyAnIicpOwogICAgICAgIChzZWxmLnBhcmFtfHxbXSkuZm9yRWFjaChmdW5jdGlvbihwYXJhbSl7CiAgICAgICAgICBkb20udGV4dCgnXG4gICAgICAnKTsKICAgICAgICAgIGRvbS50ZXh0KHBhcmFtLm9wdGlvbmFsID8gJyBbJyA6ICcgJyk7CiAgICAgICAgICBkb20udGV4dChkYXNoQ2FzZShwYXJhbS5uYW1lKSk7CiAgICAgICAgICBkb20udGV4dChCT09MRUFOX0FUVFJbcGFyYW0ubmFtZV0gPyAnJyA6ICc9InsnICsgcGFyYW0udHlwZSArICd9IicpOwogICAgICAgICAgZG9tLnRleHQocGFyYW0ub3B0aW9uYWwgPyAnXScgOiAnJyk7CiAgICAgICAgfSk7CiAgICAgICAgZG9tLnRleHQoJz4nKTsKICAgICAgfSk7CiAgICAgIHNlbGYuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICB9KTsKICB9LAoKICBodG1sX3VzYWdlX2RpcmVjdGl2ZUluZm86IGZ1bmN0aW9uKGRvbSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGxpc3QgPSBbXTsKCgogICAgaWYgKHNlbGYuc2NvcGUgIT09IHVuZGVmaW5lZCkgewogICAgICBsaXN0LnB1c2goJ1RoaXMgZGlyZWN0aXZlIGNyZWF0ZXMgbmV3IHNjb3BlLicpOwogICAgfQogICAgaWYgKHNlbGYucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgewogICAgICBsaXN0LnB1c2goJ1RoaXMgZGlyZWN0aXZlIGV4ZWN1dGVzIGF0IHByaW9yaXR5IGxldmVsICcgKyBzZWxmLnByaW9yaXR5ICsgJy4nKTsKICAgIH0KCiAgICBpZiAobGlzdC5sZW5ndGgpIHsKICAgICAgZG9tLmgoJ0RpcmVjdGl2ZSBpbmZvJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnVsKGxpc3QpOwogICAgICB9KTsKICAgIH0KICB9LAoKICBodG1sX3VzYWdlX292ZXJ2aWV3OiBmdW5jdGlvbihkb20pewogICAgZG9tLmh0bWwodGhpcy5kZXNjcmlwdGlvbik7CiAgfSwKCiAgaHRtbF91c2FnZV9pbnRlcmZhY2U6IGZ1bmN0aW9uKGRvbSl7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgaWYgKHRoaXMucGFyYW0ubGVuZ3RoKSB7CiAgICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvbS5jb2RlKGZ1bmN0aW9uKCkgewogICAgICAgICAgZG9tLnRleHQoc2VsZi5uYW1lLnNwbGl0KCcuJykucG9wKCkpOwogICAgICAgICAgZG9tLnRleHQoJygnKTsKICAgICAgICAgIHNlbGYucGFyYW1ldGVycyhkb20sICcsICcpOwogICAgICAgICAgZG9tLnRleHQoJyk7Jyk7CiAgICAgICAgfSk7CgogICAgICAgIHNlbGYuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICAgICAgc2VsZi5odG1sX3VzYWdlX3RoaXMoZG9tKTsKICAgICAgICBzZWxmLmh0bWxfdXNhZ2VfcmV0dXJucyhkb20pOwogICAgICB9KTsKICAgIH0KICAgIHRoaXMubWV0aG9kX3Byb3BlcnRpZXNfZXZlbnRzKGRvbSk7CiAgfSwKCiAgaHRtbF91c2FnZV9zZXJ2aWNlOiBmdW5jdGlvbihkb20pIHsKICAgIHRoaXMuaHRtbF91c2FnZV9pbnRlcmZhY2UoZG9tKQogIH0sCgogIGh0bWxfdXNhZ2Vfb2JqZWN0OiBmdW5jdGlvbihkb20pIHsKICAgIHRoaXMuaHRtbF91c2FnZV9pbnRlcmZhY2UoZG9tKQogIH0sCgogIG1ldGhvZF9wcm9wZXJ0aWVzX2V2ZW50czogZnVuY3Rpb24oZG9tKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBpZiAoc2VsZi5tZXRob2RzLmxlbmd0aCkgewogICAgICBkb20uZGl2KHtjbGFzczonbWVtYmVyIG1ldGhvZCd9LCBmdW5jdGlvbigpewogICAgICAgIGRvbS5oKCdNZXRob2RzJywgc2VsZi5tZXRob2RzLCBmdW5jdGlvbihtZXRob2QpewogICAgICAgICAgLy9maWx0ZXJzIG91dCAuSXNQcm9wZXJ0eSBwYXJhbWV0ZXJzIGZyb20gdGhlIG1ldGhvZCBzaWduYXR1cmUKICAgICAgICAgIHZhciBzaWduYXR1cmUgPSAobWV0aG9kLnBhcmFtIHx8IFtdKS5maWx0ZXIoZnVuY3Rpb24oZSkgeyByZXR1cm4gZS5pc1Byb3BlcnR5ICE9PSB0cnVlfSkubWFwKHByb3BlcnR5KCduYW1lJykpOwogICAgICAgICAgCiAgICAgICAgICBkb20uaChtZXRob2Quc2hvcnROYW1lICsgJygnICsgc2lnbmF0dXJlLmpvaW4oJywgJykgKyAnKScsIG1ldGhvZCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS5odG1sKG1ldGhvZC5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgIG1ldGhvZC5odG1sX3VzYWdlX3BhcmFtZXRlcnMoZG9tKTsKICAgICAgICAgICAgc2VsZi5odG1sX3VzYWdlX3RoaXMoZG9tKTsKICAgICAgICAgICAgbWV0aG9kLmh0bWxfdXNhZ2VfcmV0dXJucyhkb20pOwoKICAgICAgICAgICAgZG9tLmgoJ0V4YW1wbGUnLCBtZXRob2QuZXhhbXBsZSwgZG9tLmh0bWwpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgaWYgKHNlbGYucHJvcGVydGllcy5sZW5ndGgpIHsKICAgICAgZG9tLmRpdih7Y2xhc3M6J21lbWJlciBwcm9wZXJ0eSd9LCBmdW5jdGlvbigpewogICAgICAgIGRvbS5oKCdQcm9wZXJ0aWVzJywgc2VsZi5wcm9wZXJ0aWVzLCBmdW5jdGlvbihwcm9wZXJ0eSl7CiAgICAgICAgICBkb20uaChwcm9wZXJ0eS5zaG9ydE5hbWUsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBkb20uaHRtbChwcm9wZXJ0eS5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgIGlmICghcHJvcGVydHkuaHRtbF91c2FnZV9yZXR1cm5zKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2cocHJvcGVydHkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHByb3BlcnR5Lmh0bWxfdXNhZ2VfcmV0dXJucyhkb20pOwogICAgICAgICAgICBkb20uaCgnRXhhbXBsZScsIHByb3BlcnR5LmV4YW1wbGUsIGRvbS5odG1sKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIGlmIChzZWxmLmV2ZW50cy5sZW5ndGgpIHsKICAgICAgZG9tLmRpdih7Y2xhc3M6J21lbWJlciBldmVudCd9LCBmdW5jdGlvbigpewogICAgICAgIGRvbS5oKCdFdmVudHMnLCBzZWxmLmV2ZW50cywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgZG9tLmgoZXZlbnQuc2hvcnROYW1lLCBldmVudCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS5odG1sKGV2ZW50LmRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT0gJ2xpc3RlbicpIHsKICAgICAgICAgICAgICBkb20udGFnKCdkaXYnLCB7Y2xhc3M6J2lubGluZSd9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvbS5oKCdMaXN0ZW4gb246JywgZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBkb20udGFnKCdkaXYnLCB7Y2xhc3M6J2lubGluZSd9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvbS5oKCdUeXBlOicsIGV2ZW50LnR5cGUpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGRvbS50YWcoJ2RpdicsIHtjbGFzczonaW5saW5lJ30sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZG9tLmgoJ1RhcmdldDonLCBldmVudC50YXJnZXQpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV2ZW50Lmh0bWxfdXNhZ2VfcGFyYW1ldGVycyhkb20pOwogICAgICAgICAgICBzZWxmLmh0bWxfdXNhZ2VfdGhpcyhkb20pOwoKICAgICAgICAgICAgZG9tLmgoJ0V4YW1wbGUnLCBldmVudC5leGFtcGxlLCBkb20uaHRtbCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwKCiAgcGFyYW1ldGVyczogZnVuY3Rpb24oZG9tLCBzZXBhcmF0b3IsIHNraXBGaXJzdCwgcHJlZml4KSB7CiAgICB2YXIgc2VwID0gcHJlZml4ID8gc2VwYXJhdG9yIDogJyc7CiAgICAodGhpcy5wYXJhbXx8W10pLmZvckVhY2goZnVuY3Rpb24ocGFyYW0sIGkpewogICAgICBpZiAoIShza2lwRmlyc3QgJiYgaT09MCkpIHsKICAgICAgICBpZiAocGFyYW0ub3B0aW9uYWwpIHsKICAgICAgICAgIGRvbS50ZXh0KCdbJyArIHNlcCArIHBhcmFtLm5hbWUgKyAnXScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkb20udGV4dChzZXAgKyBwYXJhbS5uYW1lKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc2VwID0gc2VwYXJhdG9yOwogICAgfSk7CiAgfQoKfTsKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KdmFyIEdMT0JBTFMgPSAvXmFuZ3VsYXJcLihbXlwuXSspJC8sCiAgICBNT0RVTEUgPSAvXihbXlwuXSspJC8sCiAgICBNT0RVTEVfTU9DSyA9IC9eYW5ndWxhclwubW9ja1wuKFteXC5dKykkLywKICAgIE1PRFVMRV9ESVJFQ1RJVkUgPSAvXiguKylcLmRpcmVjdGl2ZTooW15cLl0rKSQvLAogICAgTU9EVUxFX0RJUkVDVElWRV9JTlBVVCA9IC9eKC4rKVwuZGlyZWN0aXZlOmlucHV0XC4oW15cLl0rKSQvLAogICAgTU9EVUxFX0NVU1RPTSA9IC9eKC4rKVwuKFteXC5dKyk6KFteXC5dKykkLywKICAgIE1PRFVMRV9TRVJWSUNFID0gL14oLispXC4oW15cLl0rPykoUHJvdmlkZXIpPyQvLAogICAgTU9EVUxFX1RZUEUgPSAvXihbXlwuXSspXC4uK1wuKFtBLVpdW15cLl0rKSQvOwoKCmZ1bmN0aW9uIHRpdGxlKHRleHQsIG92ZXJ2aWV3KSB7CiAgaWYgKCF0ZXh0KSByZXR1cm4gdGV4dDsKICB2YXIgbWF0Y2gsCiAgICBtb2R1bGUsCiAgICB0eXBlLAogICAgbmFtZTsKCiAgaWYgKHRleHQgPT0gJ2FuZ3VsYXIuTW9kdWxlJykgewogICAgbW9kdWxlID0gJ25nJzsKICAgIG5hbWUgPSAnTW9kdWxlJzsKICAgIHR5cGUgPSAnVHlwZSc7CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goR0xPQkFMUykpIHsKICAgIG1vZHVsZSA9ICduZyc7CiAgICBuYW1lID0gJ2FuZ3VsYXIuJyArIG1hdGNoWzFdOwogICAgdHlwZSA9ICdBUEknOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKE1PRFVMRSkpIHsKICAgIG1vZHVsZSA9IG1hdGNoWzFdOwogICAgaWYgKCFvdmVydmlldykgeyBuYW1lID0gbWF0Y2hbMV07IH0KICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChNT0RVTEVfTU9DSykpIHsKICAgIG1vZHVsZSA9ICduZyc7CiAgICBuYW1lID0gJ2FuZ3VsYXIubW9jay4nICsgbWF0Y2hbMV07CiAgICB0eXBlID0gJ0FQSSc7CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFX0RJUkVDVElWRSkpIHsKICAgIG1vZHVsZSA9IG1hdGNoWzFdOwogICAgbmFtZSA9IG1hdGNoWzJdOwogICAgdHlwZSA9ICdkaXJlY3RpdmUnOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKE1PRFVMRV9ESVJFQ1RJVkVfSU5QVVQpKSB7CiAgICBtb2R1bGUgPSBtYXRjaFsxXTsKICAgIG5hbWUgPSAnaW5wdXQgWycgKyBtYXRjaFsyXSArICddJzsKICAgIHR5cGUgPSAnZGlyZWN0aXZlJzsKICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChNT0RVTEVfQ1VTVE9NKSkgewogICAgbW9kdWxlID0gbWF0Y2hbMV07CiAgICBuYW1lID0gbWF0Y2hbM107CiAgICB0eXBlID0gbWF0Y2hbMl07CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFX1RZUEUpKSB7CiAgICBtb2R1bGUgPSBtYXRjaFsxXTsKICAgIG5hbWUgPSBtYXRjaFsyXTsKICAgIHR5cGUgPSAndHlwZSc7CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFX1NFUlZJQ0UpKSB7CiAgICBpZiAob3ZlcnZpZXcpIHsKICAgICAgLy8gbW9kdWxlIG5hbWUgd2l0aCBkb3RzIGxvb2tzIGxpa2UgYSBzZXJ2aWNlCiAgICAgIG1vZHVsZSA9IHRleHQ7CiAgICB9IGVsc2UgewogICAgICBtb2R1bGUgPSBtYXRjaFsxXTsKICAgICAgbmFtZSA9IG1hdGNoWzJdICsgKG1hdGNoWzNdIHx8ICcnKTsKICAgICAgdHlwZSA9ICdzZXJ2aWNlJzsKICAgIH0KICB9IGVsc2UgewogICAgcmV0dXJuIHRleHQ7CiAgfQogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHRoaXMudGFnKCdjb2RlJywgbmFtZSk7CiAgICB0aGlzLnRhZygnc3BhbicsIHsgY2xhc3M6ICdoaW50J30sIGZ1bmN0aW9uKCkgewogICAgICBpZiAodHlwZSkgewogICAgICAgIHRoaXMudGV4dCgnKCcpOwogICAgICAgIHRoaXMudGV4dCh0eXBlKTsKICAgICAgICB0aGlzLnRleHQoJyBpbiBtb2R1bGUgJyk7CiAgICAgICAgdGhpcy50YWcoJ2NvZGUnLCBtb2R1bGUpOwogICAgICAgIHRoaXMudGV4dCgnKScpOwogICAgICB9CiAgICB9KTsKICB9Owp9CgoKZnVuY3Rpb24gc2NlbmFyaW9zKGRvY3MpewogIHZhciBzcGVjcyA9IFtdOwoKICBzcGVjcy5wdXNoKCdkZXNjcmliZSgiYW5ndWxhcitqcWxpdGUiLCBmdW5jdGlvbigpIHsnKTsKICBhcHBlbmRTcGVjcygnaW5kZXgtbm9jYWNoZS5odG1sIyEvJyk7CiAgc3BlY3MucHVzaCgnfSk7Jyk7CgogIHNwZWNzLnB1c2goJycpOwogIHNwZWNzLnB1c2goJycpOwoKICBzcGVjcy5wdXNoKCdkZXNjcmliZSgiYW5ndWxhcitqcXVlcnkiLCBmdW5jdGlvbigpIHsnKTsKICBhcHBlbmRTcGVjcygnaW5kZXgtanEtbm9jYWNoZS5odG1sIyEvJyk7CiAgc3BlY3MucHVzaCgnfSk7Jyk7CgogIHJldHVybiBzcGVjcy5qb2luKCdcbicpOwoKICBmdW5jdGlvbiBhcHBlbmRTcGVjcyh1cmxQcmVmaXgpIHsKICAgIGRvY3MuZm9yRWFjaChmdW5jdGlvbihkb2MpewogICAgICBzcGVjcy5wdXNoKCcgIGRlc2NyaWJlKCInICsgZG9jLnNlY3Rpb24gKyAnLycgKyBkb2MuaWQgKyAnIiwgZnVuY3Rpb24oKSB7Jyk7CiAgICAgIHNwZWNzLnB1c2goJyAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgeycpOwogICAgICBzcGVjcy5wdXNoKCcgICAgICBicm93c2VyKCkubmF2aWdhdGVUbygiJyArIHVybFByZWZpeCArIGRvYy5zZWN0aW9uICsgJy8nICsgZG9jLmlkICsgJyIpOycpOwogICAgICBzcGVjcy5wdXNoKCcgICAgfSk7Jyk7CiAgICAgIHNwZWNzLnB1c2goJyAgJyk7CiAgICAgIGRvYy5zY2VuYXJpb3MuZm9yRWFjaChmdW5jdGlvbihzY2VuYXJpbyl7CiAgICAgICAgc3BlY3MucHVzaChpbmRlbnRDb2RlKHRyaW0oc2NlbmFyaW8pLCA0KSk7CiAgICAgICAgc3BlY3MucHVzaCgnJyk7CiAgICAgIH0pOwogICAgICBzcGVjcy5wdXNoKCd9KTsnKTsKICAgICAgc3BlY3MucHVzaCgnJyk7CiAgICB9KTsKICB9Cn0KCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCmZ1bmN0aW9uIG1ldGFkYXRhKGRvY3MpewogIHZhciBwYWdlcyA9IFtdOwogIGRvY3MuZm9yRWFjaChmdW5jdGlvbihkb2MpewogICAgdmFyIHBhdGggPSAoZG9jLm5hbWUgfHwgJycpLnNwbGl0KC8oXC58XDpccyopLyk7CiAgICBmb3IgKCB2YXIgaSA9IDE7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgIHBhdGguc3BsaWNlKGksIDEpOwogICAgfQogICAgdmFyIHNob3J0TmFtZSA9IHBhdGgucG9wKCkudHJpbSgpOwoKICAgIGlmIChwYXRoLnBvcCgpID09ICdpbnB1dCcpIHsKICAgICAgc2hvcnROYW1lID0gJ2lucHV0IFsnICsgc2hvcnROYW1lICsgJ10nOwogICAgfQoKICAgIHBhZ2VzLnB1c2goewogICAgICBzZWN0aW9uOiBkb2Muc2VjdGlvbiwKICAgICAgaWQ6IGRvYy5pZCwKICAgICAgbmFtZTogdGl0bGUoZG9jLm5hbWUpLAogICAgICBzaG9ydE5hbWU6IHNob3J0TmFtZSwKICAgICAgdHlwZTogZG9jLm5nZG9jLAogICAgICBrZXl3b3Jkczpkb2Mua2V5d29yZHMoKQogICAgfSk7CiAgfSk7CiAgcGFnZXMuc29ydChrZXl3b3JkU29ydCk7CiAgcmV0dXJuIHBhZ2VzOwp9Cgp2YXIgS0VZV09SRF9QUklPUklUWSA9IHsKICAnLmluZGV4JzogMSwKICAnLm92ZXJ2aWV3JzogMSwKICAnLmJvb3RzdHJhcCc6IDIsCiAgJy5tdmMnOiAzLAogICcuc2NvcGVzJzogNCwKICAnLmNvbXBpbGVyJzogNSwKICAnLnRlbXBsYXRlcyc6IDYsCiAgJy5zZXJ2aWNlcyc6IDcsCiAgJy5kaSc6IDgsCiAgJy51bml0LXRlc3RpbmcnOiA5LAogICcuZGV2X2d1aWRlJzogOSwKICAnLmRldl9ndWlkZS5vdmVydmlldyc6IDEsCiAgJy5kZXZfZ3VpZGUuYm9vdHN0cmFwJzogMiwKICAnLmRldl9ndWlkZS5ib290c3RyYXAuYXV0b19ib290c3RyYXAnOiAxLAogICcuZGV2X2d1aWRlLmJvb3RzdHJhcC5tYW51YWxfYm9vdHN0cmFwJzogMiwKICAnLmRldl9ndWlkZS5tdmMnOiAzLAogICcuZGV2X2d1aWRlLm12Yy51bmRlcnN0YW5kaW5nX21vZGVsJzogMSwKICAnLmRldl9ndWlkZS5tdmMudW5kZXJzdGFuZGluZ19jb250cm9sbGVyJzogMiwKICAnLmRldl9ndWlkZS5tdmMudW5kZXJzdGFuZGluZ192aWV3JzogMywKICAnLmRldl9ndWlkZS5zY29wZXMnOiA0LAogICcuZGV2X2d1aWRlLnNjb3Blcy51bmRlcnN0YW5kaW5nX3Njb3Blcyc6IDEsCiAgJy5kZXZfZ3VpZGUuc2NvcGVzLmludGVybmFscyc6IDIsCiAgJy5kZXZfZ3VpZGUuY29tcGlsZXInOiA1LAogICcuZGV2X2d1aWRlLnRlbXBsYXRlcyc6IDYsCiAgJy5kZXZfZ3VpZGUuc2VydmljZXMnOiA3LAogICcuZGV2X2d1aWRlLmRpJzogOCwKICAnLmRldl9ndWlkZS51bml0LXRlc3RpbmcnOiA5Cn07CmZ1bmN0aW9uIGtleXdvcmRTb3J0KGEsIGIpewogIGZ1bmN0aW9uIG1hbmdsZU5hbWUoZG9jKSB7CiAgICB2YXIgcGF0aCA9IGRvYy5pZC5zcGxpdCgvXC4vKTsKICAgIHZhciBtYW5nbGVkID0gW107CiAgICB2YXIgcGFydGlhbE5hbWUgPSAnJzsKICAgIHBhdGguZm9yRWFjaChmdW5jdGlvbihuYW1lKXsKICAgICAgcGFydGlhbE5hbWUgKz0gJy4nICsgbmFtZTsKICAgICAgbWFuZ2xlZC5wdXNoKEtFWVdPUkRfUFJJT1JJVFlbcGFydGlhbE5hbWVdIHx8IDUpOwogICAgICBtYW5nbGVkLnB1c2gobmFtZSk7CiAgICB9KTsKICAgIHJldHVybiAoZG9jLnNlY3Rpb24gKyAnLycgKyBtYW5nbGVkLmpvaW4oJy4nKSkudG9Mb3dlckNhc2UoKTsKICB9CiAgdmFyIG5hbWVBID0gbWFuZ2xlTmFtZShhKTsKICB2YXIgbmFtZUIgPSBtYW5nbGVOYW1lKGIpOwogIHJldHVybiBuYW1lQSA8IG5hbWVCID8gLTEgOiAobmFtZUEgPiBuYW1lQiA/IDEgOiAwKTsKfQoKCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KZnVuY3Rpb24gdHJpbSh0ZXh0KSB7CiAgdmFyIE1BWF9JTkRFTlQgPSA5OTk5OwogIHZhciBlbXB0eSA9IFJlZ0V4cC5wcm90b3R5cGUudGVzdC5iaW5kKC9eXHMqJC8pOwogIHZhciBsaW5lcyA9IHRleHQuc3BsaXQoJ1xuJyk7CiAgdmFyIG1pbkluZGVudCA9IE1BWF9JTkRFTlQ7CiAgdmFyIGluZGVudFJlZ0V4cDsKICB2YXIgaWdub3JlTGluZSA9IChsaW5lc1swXVswXSAhPSAnICcgICYmIGxpbmVzLmxlbmd0aCA+IDEpOwogIC8vIGlnbm9yZSBmaXJzdCBsaW5lIGlmIGl0IGhhcyBubyBpbmRlbnRhdGlvbiBhbmQgdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSBsaW5lCgogIGxpbmVzLmZvckVhY2goZnVuY3Rpb24obGluZSl7CiAgICBpZiAoaWdub3JlTGluZSkgewogICAgICBpZ25vcmVMaW5lID0gZmFsc2U7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgaW5kZW50ID0gbGluZS5tYXRjaCgvXlxzKi8pWzBdLmxlbmd0aDsKICAgIGlmIChpbmRlbnQgPiAwIHx8IG1pbkluZGVudCA9PSBNQVhfSU5ERU5UKSB7CiAgICAgIG1pbkluZGVudCA9IE1hdGgubWluKG1pbkluZGVudCwgaW5kZW50KTsKICAgIH0KICB9KTsKCiAgaW5kZW50UmVnRXhwID0gbmV3IFJlZ0V4cCgnXlxcc3swLCcgKyBtaW5JbmRlbnQgKyAnfScpOwoKICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykgewogICAgbGluZXNbaV0gPSBsaW5lc1tpXS5yZXBsYWNlKGluZGVudFJlZ0V4cCwgJycpOwogIH0KCiAgLy8gcmVtb3ZlIGxlYWRpbmcgbGluZXMKICB3aGlsZSAoZW1wdHkobGluZXNbMF0pKSB7CiAgICBsaW5lcy5zaGlmdCgpOwogIH0KCiAgLy8gcmVtb3ZlIHRyYWlsaW5nCiAgd2hpbGUgKGVtcHR5KGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdKSkgewogICAgbGluZXMucG9wKCk7CiAgfQogIHJldHVybiBsaW5lcy5qb2luKCdcbicpOwp9CgpmdW5jdGlvbiBpbmRlbnRDb2RlKHRleHQsIHNwYWNlQ291bnQpIHsKICB2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KCdcbicpLAogICAgaW5kZW50ID0gJycsCiAgICBmaXhlZExpbmVzID0gW107CgogIHdoaWxlKHNwYWNlQ291bnQtLSkgaW5kZW50ICs9ICcgJzsKCiAgbGluZXMuZm9yRWFjaChmdW5jdGlvbihsaW5lKSB7CiAgICBmaXhlZExpbmVzLnB1c2goaW5kZW50ICsgbGluZSk7CiAgfSk7CgogIHJldHVybiBmaXhlZExpbmVzLmpvaW4oJ1xuJyk7Cn0KCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KZnVuY3Rpb24gbWVyZ2UoZG9jcyl7CiAgdmFyIGJ5RnVsbElkID0ge307CgogIGRvY3MuZm9yRWFjaChmdW5jdGlvbihkb2MpIHsKICAgIGJ5RnVsbElkW2RvYy5zZWN0aW9uICsgJy8nICsgZG9jLmlkXSA9IGRvYzsKICB9KTsKCiAgZm9yKHZhciBpID0gMDsgaSA8IGRvY3MubGVuZ3RoOykgewogICAgdmFyIGRvYyA9IGRvY3NbaV07CgogICAgLy8gY2hlY2sgbGlua3MgLSBkbyB0aGV5IGV4aXN0ID8KICAgIGRvYy5saW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHsKICAgICAgLy8gY29udmVydCAjaWQgdG8gcGF0aCNpZAogICAgICBpZiAobGlua1swXSA9PSAnIycpIHsKICAgICAgICBsaW5rID0gZG9jLnNlY3Rpb24gKyAnLycgKyBkb2MuaWQuc3BsaXQoJyMnKS5zaGlmdCgpICsgbGluazsKICAgICAgfQogICAgICBsaW5rID0gbGluay5zcGxpdCgnIycpLnNoaWZ0KCk7CiAgICAgIGlmICghYnlGdWxsSWRbbGlua10pIHsKICAgICAgICBjb25zb2xlLmxvZygnV0FSTklORzogSW4gJyArIGRvYy5zZWN0aW9uICsgJy8nICsgZG9jLmlkICsgJywgbm9uIGV4aXN0aW5nIGxpbms6ICInICsgbGluayArICciJyk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIG1lcmdlIGludG8gcGFyZW50cwogICAgaWYgKGZpbmRQYXJlbnQoZG9jLCAnbWV0aG9kJykgfHwgZmluZFBhcmVudChkb2MsICdwcm9wZXJ0eScpIHx8IGZpbmRQYXJlbnQoZG9jLCAnZXZlbnQnKSkgewogICAgICBkb2NzLnNwbGljZShpLCAxKTsKICAgIH0gZWxzZSB7CiAgICAgIGkrKzsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGZpbmRQYXJlbnQoZG9jLCBuYW1lKSB7CiAgICB2YXIgcGFyZW50TmFtZSA9IGRvY1tuYW1lICsgJ09mJ107CiAgICBpZiAoIXBhcmVudE5hbWUpIHJldHVybiBmYWxzZTsKCiAgICB2YXIgcGFyZW50ID0gYnlGdWxsSWRbZG9jLnNlY3Rpb24gKyAnLycgKyBwYXJlbnROYW1lXTsKICAgIGlmICghcGFyZW50KQogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHBhcmVudCBuYW1lZCAnIiArIHBhcmVudE5hbWUgKyAiJyBmb3IgJyIgKwogICAgICAgIGRvYy5uYW1lICsgIicgaW4gQCIgKyBuYW1lICsgIk9mLiIpOwoKICAgIHZhciBsaXN0TmFtZSA9IChuYW1lICsgJ3MnKS5yZXBsYWNlKC95cyQvLCAnaWVzJyk7CiAgICB2YXIgbGlzdCA9IHBhcmVudFtsaXN0TmFtZV0gPSAocGFyZW50W2xpc3ROYW1lXSB8fCBbXSk7CiAgICBsaXN0LnB1c2goZG9jKTsKICAgIGxpc3Quc29ydChvcmRlckJ5TmFtZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIG9yZGVyQnlOYW1lKGEsIGIpewogICAgcmV0dXJuIGEubmFtZSA8IGIubmFtZSA/IC0xIDogKGEubmFtZSA+IGIubmFtZSA/IDEgOiAwKTsKICB9Cn0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKZnVuY3Rpb24gcHJvcGVydHkobmFtZSkgewogIHJldHVybiBmdW5jdGlvbih2YWx1ZSl7CiAgICByZXR1cm4gdmFsdWVbbmFtZV07CiAgfTsKfQoKCnZhciBEQVNIX0NBU0VfUkVHRVhQID0gL1tBLVpdL2c7CmZ1bmN0aW9uIGRhc2hDYXNlKG5hbWUpewogIHJldHVybiBuYW1lLnJlcGxhY2UoREFTSF9DQVNFX1JFR0VYUCwgZnVuY3Rpb24obGV0dGVyLCBwb3MpIHsKICAgIHJldHVybiAocG9zID8gJy0nIDogJycpICsgbGV0dGVyLnRvTG93ZXJDYXNlKCk7CiAgfSk7Cn0K",
                "body": "LyoqCiAqIEFsbCBwYXJzaW5nL3RyYW5zZm9ybWF0aW9uIGNvZGUgZ29lcyBoZXJlLiBBbGwgY29kZSBoZXJlIHNob3VsZCBiZSBzeW5jIHRvIGVhc2UgdGVzdGluZy4KICovCgp2YXIgU2hvd2Rvd24gPSByZXF1aXJlKCdzaG93ZG93bicpOwp2YXIgRE9NID0gcmVxdWlyZSgnLi9kb20uanMnKS5ET007CnZhciBodG1sRXNjYXBlID0gcmVxdWlyZSgnLi9kb20uanMnKS5odG1sRXNjYXBlOwp2YXIgRXhhbXBsZSA9IHJlcXVpcmUoJy4vZXhhbXBsZS5qcycpLkV4YW1wbGU7CnZhciBORVdfTElORSA9IC9cblxyPy87CnZhciBnbG9iYWxJRCA9IDA7CnZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7CnZhciBmc3BhdGggPSByZXF1aXJlKCdwYXRoJyk7CgpleHBvcnRzLnRyaW0gPSB0cmltOwpleHBvcnRzLm1ldGFkYXRhID0gbWV0YWRhdGE7CmV4cG9ydHMuc2NlbmFyaW9zID0gc2NlbmFyaW9zOwpleHBvcnRzLm1lcmdlID0gbWVyZ2U7CmV4cG9ydHMuRG9jID0gRG9jOwoKdmFyIEJPT0xFQU5fQVRUUiA9IHt9OwpbJ211bHRpcGxlJywgJ3NlbGVjdGVkJywgJ2NoZWNrZWQnLCAnZGlzYWJsZWQnLCAncmVhZE9ubHknLCAncmVxdWlyZWQnXS5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlKSB7CiAgQk9PTEVBTl9BVFRSW3ZhbHVlXSA9IHRydWU7Cn0pOwoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwpmdW5jdGlvbiBEb2ModGV4dCwgZmlsZSwgbGluZSwgb3B0aW9ucykgewogIGlmICh0eXBlb2YgdGV4dCA9PSAnb2JqZWN0JykgewogICAgZm9yICggdmFyIGtleSBpbiB0ZXh0KSB7CiAgICAgIHRoaXNba2V5XSA9IHRleHRba2V5XTsKICAgIH0KICB9IGVsc2UgewogICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgIHRoaXMuZmlsZSA9IGZpbGU7CiAgICB0aGlzLmxpbmUgPSBsaW5lOwogIH0KICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogIHRoaXMuc2NlbmFyaW9zID0gdGhpcy5zY2VuYXJpb3MgfHwgW107CiAgdGhpcy5yZXF1aXJlcyA9IHRoaXMucmVxdWlyZXMgfHwgW107CiAgdGhpcy5wYXJhbSA9IHRoaXMucGFyYW0gfHwgW107CiAgdGhpcy5wcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzIHx8IFtdOwogIHRoaXMubWV0aG9kcyA9IHRoaXMubWV0aG9kcyB8fCBbXTsKICB0aGlzLmV2ZW50cyA9IHRoaXMuZXZlbnRzIHx8IFtdOwogIHRoaXMubGlua3MgPSB0aGlzLmxpbmtzIHx8IFtdOwp9CkRvYy5NRVRBREFUQV9JR05PUkUgPSAoZnVuY3Rpb24oKSB7CiAgdmFyIHdvcmRzID0gcmVxdWlyZSgnZnMnKS5yZWFkRmlsZVN5bmMoX19kaXJuYW1lICsgJy9pZ25vcmUud29yZHMnLCAndXRmOCcpOwogIHJldHVybiB3b3Jkcy50b1N0cmluZygpLnNwbGl0KC9bLFxzXG5ccl0rL2dtKTsKfSkoKTsKCgpEb2MucHJvdG90eXBlID0gewogIGtleXdvcmRzOiBmdW5jdGlvbiBrZXl3b3JkcygpIHsKICAgIHZhciBrZXl3b3JkcyA9IHt9OwogICAgdmFyIHdvcmRzID0gW107CiAgICBEb2MuTUVUQURBVEFfSUdOT1JFLmZvckVhY2goZnVuY3Rpb24oaWdub3JlKXsga2V5d29yZHNbaWdub3JlXSA9IHRydWU7IH0pOwoKICAgIGZ1bmN0aW9uIGV4dHJhY3RXb3Jkcyh0ZXh0KSB7CiAgICAgIHZhciB0b2tlbnMgPSB0ZXh0LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1tcLlxzLGAnIiNdKy9tZyk7CiAgICAgIHRva2Vucy5mb3JFYWNoKGZ1bmN0aW9uKGtleSl7CiAgICAgICAgdmFyIG1hdGNoID0ga2V5Lm1hdGNoKC9eKChuZzp8W1wkX2Etel0pW1x3XC1fXSspLyk7CiAgICAgICAgaWYgKG1hdGNoKXsKICAgICAgICAgIGtleSA9IG1hdGNoWzFdOwogICAgICAgICAgaWYgKCFrZXl3b3Jkc1trZXldKSB7CiAgICAgICAgICAgIGtleXdvcmRzW2tleV0gPSB0cnVlOwogICAgICAgICAgICB3b3Jkcy5wdXNoKGtleSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBleHRyYWN0V29yZHModGhpcy50ZXh0KTsKICAgIHRoaXMucHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHsKICAgICAgZXh0cmFjdFdvcmRzKHByb3AudGV4dCB8fCBwcm9wLmRlc2NyaXB0aW9uIHx8ICcnKTsKICAgIH0pOwogICAgdGhpcy5tZXRob2RzLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgIGV4dHJhY3RXb3JkcyhtZXRob2QudGV4dCB8fCBtZXRob2QuZGVzY3JpcHRpb24gfHwgJycpOwogICAgfSk7CiAgICB3b3Jkcy5zb3J0KCk7CiAgICByZXR1cm4gd29yZHMuam9pbignICcpOwogIH0sCgogIC8qKgogICAqIENvbnZlcnRzIHJlbGF0aXZlIHVybHMgKHdpdGhvdXQgc2VjdGlvbikgaW50byBhYnNvbHV0ZQogICAqIEFic29sdXRlIHVybCBtZWFucyB1cmwgd2l0aCBzZWN0aW9uCiAgICoKICAgKiBAZXhhbXBsZQogICAqIC0gaWYgdGhlIGxpbmsgaXMgaW5zaWRlIGFueSBhcGkgZG9jOgogICAqIGFuZ3VsYXIud2lkZ2V0IC0+IGFwaS9hbmd1bGFyLndpZGdldAogICAqCiAgICogLSBpZiB0aGUgbGluayBpcyBpbnNpZGUgYW55IGd1aWQgZG9jOgogICAqIGludHJvIC0+IGd1aWRlL2ludHJvCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIEFic29sdXRlIG9yIHJlbGF0aXZlIHVybAogICAqIEByZXR1cm5zIHtzdHJpbmd9IEFic29sdXRlIHVybAogICAqLwogIGNvbnZlcnRVcmxUb0Fic29sdXRlOiBmdW5jdGlvbih1cmwpIHsKICAgIHZhciBwcmVmaXggPSB0aGlzLm9wdGlvbnMuaHRtbDVNb2RlID8gJycgOiAnIy8nOwogICAgaWYgKHVybC5zdWJzdHIoLTEpID09ICcvJykgcmV0dXJuIHVybCArICdpbmRleCc7CiAgICBpZiAodXJsLm1hdGNoKC9cLy8pKSByZXR1cm4gcHJlZml4ICsgdXJsOwogICAgcmV0dXJuIHByZWZpeCArIHRoaXMuc2VjdGlvbiArICcvJyArIHVybDsKICB9LAoKICBtYXJrZG93bjogZnVuY3Rpb24odGV4dCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gdGV4dDsKCiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgIElTX1VSTCA9IC9eKGh0dHBzPzpcL1wvfGZ0cHM/OlwvXC98bWFpbHRvOnxcLnxcLykvLAogICAgICBJU19BTkdVTEFSID0gL14oYXBpXC8pPyhhbmd1bGFyfG5nfEFVVE8pXC4vLAogICAgICBJU19IQVNIID0gL14jLywKICAgICAgcGFydHMgPSB0cmltKHRleHQpLnNwbGl0KC8oPHByZT5bXHNcU10qPzxcL3ByZT58PGRvYzpleGFtcGxlKFxTKikuKj8+W1xzXFNdKj88XC9kb2M6ZXhhbXBsZT58PGV4YW1wbGVbXj5dKj5bXHNcU10qPzxcL2V4YW1wbGU+KS8pLAogICAgICBzZXEgPSAwLAogICAgICBwbGFjZWhvbGRlck1hcCA9IHt9OwoKICAgIGZ1bmN0aW9uIHBsYWNlaG9sZGVyKHRleHQpIHsKICAgICAgdmFyIGlkID0gJ1JFUExBQ0VNRScgKyAoc2VxKyspOwogICAgICBwbGFjZWhvbGRlck1hcFtpZF0gPSB0ZXh0OwogICAgICByZXR1cm4gaWQ7CiAgICB9CgogICAgZnVuY3Rpb24gZXh0cmFjdElubGluZURvY0NvZGUodGV4dCwgdGFnKSB7CiAgICAgIGlmKHRhZyA9PSAnYWxsJykgewogICAgICAgIC8vdXNlIGEgZ3JlZWR5IG9wZXJhdG9yIHRvIG1hdGNoIHRoZSBsYXN0IDwvZG9jcz4gdGFnCiAgICAgICAgcmVnZXggPSAvXC9cLzxkb2NzLio/PihbLlxzXFNdKylcL1wvPFwvZG9jcz4vaW07CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgLy91c2UgYSBub24tZ3JlZWR5IG9wZXJhdG9yIHRvIG1hdGNoIHRoZSBuZXh0IDwvZG9jcz4gdGFnCiAgICAgICAgcmVnZXggPSBuZXcgUmVnRXhwKCJcL1wvPGRvY3NcXHMqdGFnPVwiIiArIHRhZyArICJcIi4qPz4oWy5cXHNcXFNdKz8pXC9cLzxcL2RvY3M+IiwiaW0iKTsKICAgICAgfQogICAgICB2YXIgbWF0Y2hlcyA9IHJlZ2V4LmV4ZWModGV4dC50b1N0cmluZygpKTsKICAgICAgcmV0dXJuIG1hdGNoZXMgJiYgbWF0Y2hlcy5sZW5ndGggPiAxID8gbWF0Y2hlc1sxXSA6ICIiOwogICAgfQoKICAgIHBhcnRzLmZvckVhY2goZnVuY3Rpb24odGV4dCwgaSkgewogICAgICBwYXJ0c1tpXSA9ICh0ZXh0IHx8ICcnKS4KICAgICAgICByZXBsYWNlKC88ZXhhbXBsZSg/OlxzK21vZHVsZT0iKFteIl0qKSIpPyg/OlxzK2RlcHM9IihbXiJdKikiKT8oXHMrYW5pbWF0aW9ucz0idHJ1ZSIpPz4oW1xzXFNdKj8pPFwvZXhhbXBsZT4vZ21pLAogICAgICAgICAgZnVuY3Rpb24oXywgbW9kdWxlLCBkZXBzLCBhbmltYXRpb25zLCBjb250ZW50KSB7CgogICAgICAgICAgdmFyIGV4YW1wbGUgPSBuZXcgRXhhbXBsZShzZWxmLnNjZW5hcmlvcyk7CiAgICAgICAgICBpZihhbmltYXRpb25zKSB7CiAgICAgICAgICAgIGV4YW1wbGUuZW5hYmxlQW5pbWF0aW9ucygpOwogICAgICAgICAgfQoKICAgICAgICAgIGV4YW1wbGUuc2V0TW9kdWxlKG1vZHVsZSk7CiAgICAgICAgICBleGFtcGxlLmFkZERlcHMoZGVwcyk7CiAgICAgICAgICBjb250ZW50LnJlcGxhY2UoLzxmaWxlXHMrbmFtZT0iKFteIl0qKSJccyo+KFtcc1xTXSo/KTxcL2ZpbGU+L2dtaSwgZnVuY3Rpb24oXywgbmFtZSwgY29udGVudCkgewogICAgICAgICAgICBleGFtcGxlLmFkZFNvdXJjZShuYW1lLCBjb250ZW50KTsKICAgICAgICAgIH0pOwogICAgICAgICAgY29udGVudC5yZXBsYWNlKC88ZmlsZVxzK3NyYz0iKFteIl0rKSIoPzpccyt0YWc9IihbXiJdKykiKT8oPzpccytuYW1lPSIoW14iXSspIik/XHMqXC8/Pi9nbWksIGZ1bmN0aW9uKF8sIGZpbGUsIHRhZywgbmFtZSkgewogICAgICAgICAgICBpZihmc3BhdGguZXhpc3RzU3luYyhmaWxlKSkgewogICAgICAgICAgICAgIHZhciBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGUsICd1dGY4Jyk7CiAgICAgICAgICAgICAgaWYoY29udGVudCAmJiBjb250ZW50Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGlmKHRhZyAmJiB0YWcubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBjb250ZW50ID0gZXh0cmFjdElubGluZURvY0NvZGUoY29udGVudCwgdGFnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICYmIG5hbWUubGVuZ3RoID4gMCA/IG5hbWUgOiBmc3BhdGguYmFzZW5hbWUoZmlsZSk7CiAgICAgICAgICAgICAgICBleGFtcGxlLmFkZFNvdXJjZShuYW1lLCBjb250ZW50KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybiBwbGFjZWhvbGRlcihleGFtcGxlLnRvSHRtbCgpKTsKICAgICAgICB9KS4KICAgICAgICByZXBsYWNlKC8oPzpcKlxzKyk/PGZpbGUuKz9zcmM9IihbXiJdKykiKD86XHMrdGFnPSIoW14iXSspIik/XHMqXC8/Pi9pLCBmdW5jdGlvbihfLCBmaWxlLCB0YWcpIHsKICAgICAgICAgIGlmKGZzcGF0aC5leGlzdHNTeW5jKGZpbGUpKSB7CiAgICAgICAgICAgIHZhciBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGUsICd1dGY4Jyk7CiAgICAgICAgICAgIGlmKHRhZyAmJiB0YWcubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGNvbnRlbnQgPSBleHRyYWN0SW5saW5lRG9jQ29kZShjb250ZW50LCB0YWcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb250ZW50OwogICAgICAgICAgfQogICAgICAgIH0pLgogICAgICAgIHJlcGxhY2UoL148ZG9jOmV4YW1wbGUoXHMrW14+XSopPz4oW1xzXFNdKik8XC9kb2M6ZXhhbXBsZT4vbWksIGZ1bmN0aW9uKF8sIGF0dHJzLCBjb250ZW50KSB7CiAgICAgICAgICB2YXIgaHRtbCwgc2NyaXB0LCBzY2VuYXJpbywKICAgICAgICAgICAgZXhhbXBsZSA9IG5ldyBFeGFtcGxlKHNlbGYuc2NlbmFyaW9zKTsKCiAgICAgICAgICBleGFtcGxlLnNldE1vZHVsZSgoYXR0cnN8fCdtb2R1bGU9IiInKS5tYXRjaCgvXlxzKm1vZHVsZT1bIiddKC4qKVsiJ11ccyokLylbMV0pOwogICAgICAgICAgY29udGVudC4KICAgICAgICAgICAgcmVwbGFjZSgvPGRvYzpzb3VyY2UoXHMrW14+XSopPz4oW1xzXFNdKik8XC9kb2M6c291cmNlPi9taSwgZnVuY3Rpb24oXywgYXR0cnMsIGNvbnRlbnQpIHsKICAgICAgICAgICAgICBleGFtcGxlLmFkZFNvdXJjZSgnaW5kZXguaHRtbCcsIGNvbnRlbnQuCiAgICAgICAgICAgICAgICByZXBsYWNlKC88c2NyaXB0PihbXHNcU10qKTxcL3NjcmlwdD4vbWksIGZ1bmN0aW9uKF8sIHNjcmlwdCkgewogICAgICAgICAgICAgICAgICBleGFtcGxlLmFkZFNvdXJjZSgnc2NyaXB0LmpzJywgc2NyaXB0KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICAgICAgfSkuCiAgICAgICAgICAgICAgICByZXBsYWNlKC88c3R5bGU+KFtcc1xTXSopPFwvc3R5bGU+L21pLCBmdW5jdGlvbihfLCBzdHlsZSkgewogICAgICAgICAgICAgICAgICBleGFtcGxlLmFkZFNvdXJjZSgnc3R5bGUuY3NzJywgc3R5bGUpOwogICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0pLgogICAgICAgICAgICByZXBsYWNlKC8oPGRvYzpzY2VuYXJpbz4pKFtcc1xTXSopKDxcL2RvYzpzY2VuYXJpbz4pL21pLCBmdW5jdGlvbihfLCBiZWZvcmUsIGNvbnRlbnQpewogICAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKCdzY2VuYXJpby5qcycsIGNvbnRlbnQpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm4gcGxhY2Vob2xkZXIoZXhhbXBsZS50b0h0bWwoKSk7CiAgICAgICAgfSkuCiAgICAgICAgcmVwbGFjZSgvXjxwcmU+KFtcc1xTXSo/KTxcL3ByZT4vbWksIGZ1bmN0aW9uKF8sIGNvbnRlbnQpewogICAgICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyKAogICAgICAgICAgICAnPHByZSBjbGFzcz0icHJldHR5cHJpbnQgbGluZW51bXMiPicgKwogICAgICAgICAgICAgIGNvbnRlbnQucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKSArCiAgICAgICAgICAgICAgJzwvcHJlPicpOwogICAgICAgIH0pLgogICAgICAgIHJlcGxhY2UoLzxkaXYoW14+XSopPjxcL2Rpdj4vLCAnPGRpdiQxPlxuPFwvZGl2PicpLgogICAgICAgIHJlcGxhY2UoL3tAbGlua1xzKyhbXlxzfV0rKVxzKihbXn1dKj8pXHMqfS9nLCBmdW5jdGlvbihfYWxsLCB1cmwsIHRpdGxlKXsKICAgICAgICAgIHZhciBpc0Z1bGxVcmwgPSB1cmwubWF0Y2goSVNfVVJMKSwKICAgICAgICAgICAgaXNBbmd1bGFyID0gdXJsLm1hdGNoKElTX0FOR1VMQVIpLAogICAgICAgICAgICBpc0hhc2ggPSB1cmwubWF0Y2goSVNfSEFTSCksCiAgICAgICAgICAgIGFic1VybCA9IGlzSGFzaAogICAgICAgICAgICAgID8gdXJsCiAgICAgICAgICAgICAgOiAoaXNGdWxsVXJsID8gdXJsIDogc2VsZi5jb252ZXJ0VXJsVG9BYnNvbHV0ZSh1cmwpKTsKCiAgICAgICAgICBpZiAoIWlzRnVsbFVybCkgc2VsZi5saW5rcy5wdXNoKGFic1VybCk7CgogICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInICsgYWJzVXJsICsgJyI+JyArCiAgICAgICAgICAgIChpc0FuZ3VsYXIgPyAnPGNvZGU+JyA6ICcnKSArCiAgICAgICAgICAgICh0aXRsZSB8fCB1cmwpLnJlcGxhY2UoL14jL2csICcnKS5yZXBsYWNlKC9cbi9nLCAnICcpICsKICAgICAgICAgICAgKGlzQW5ndWxhciA/ICc8L2NvZGU+JyA6ICcnKSArCiAgICAgICAgICAgICc8L2E+JzsKICAgICAgICB9KTsKICAgIH0pOwogICAgdGV4dCA9IHBhcnRzLmpvaW4oJycpOwogICAgdGV4dCA9IG5ldyBTaG93ZG93bi5jb252ZXJ0ZXIoeyBleHRlbnNpb25zIDogWyd0YWJsZSddIH0pLm1ha2VIdG1sKHRleHQpOwogICAgdGV4dCA9IHRleHQucmVwbGFjZSgvKD86PHA+KT8oUkVQTEFDRU1FXGQrKSg/OjxcL3A+KT8vZywgZnVuY3Rpb24oXywgaWQpIHsKICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyTWFwW2lkXTsKICAgIH0pOwogICAgcmV0dXJuIHRleHQ7CiAgfSwKCiAgcGFyc2U6IGZ1bmN0aW9uKCkgewogICAgdmFyIGF0TmFtZTsKICAgIHZhciBhdFRleHQ7CiAgICB2YXIgbWF0Y2g7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLnRleHQuc3BsaXQoTkVXX0xJTkUpLmZvckVhY2goZnVuY3Rpb24obGluZSl7CiAgICAgIGlmICgobWF0Y2ggPSBsaW5lLm1hdGNoKC9eXHMqQChcdyspKFxzKyguKikpPy8pKSkgewogICAgICAgIC8vIHdlIGZvdW5kIEBuYW1lIC4uLgogICAgICAgIC8vIGlmIHdlIGhhdmUgZXhpc3RpbmcgbmFtZQogICAgICAgIGZsdXNoKCk7CiAgICAgICAgYXROYW1lID0gbWF0Y2hbMV07CiAgICAgICAgYXRUZXh0ID0gW107CiAgICAgICAgaWYobWF0Y2hbM10pIGF0VGV4dC5wdXNoKG1hdGNoWzNdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoYXROYW1lKSB7CiAgICAgICAgICBhdFRleHQucHVzaChsaW5lKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgZmx1c2goKTsKICAgIHRoaXMuc2hvcnROYW1lID0gdGhpcy5uYW1lLnNwbGl0KC9bXC46I10vKS5wb3AoKS50cmltKCk7CiAgICB0aGlzLmlkID0gdGhpcy5pZCB8fCAvLyBpZiB3ZSBoYXZlIGFuIGlkIGp1c3QgdXNlIGl0CiAgICAgICgoKHRoaXMuZmlsZXx8JycpLm1hdGNoKC8uKihcL3xcXCkoW14oXC98XFwpXSopXC5uZ2RvYy8pfHx7fSlbMl0pIHx8IC8vIHRyeSB0byBleHRyYWN0IGl0IGZyb20gZmlsZSBuYW1lCiAgICAgIHRoaXMubmFtZTsgLy8gZGVmYXVsdCB0byBuYW1lCiAgICB0aGlzLmRlc2NyaXB0aW9uID0gdGhpcy5tYXJrZG93bih0aGlzLmRlc2NyaXB0aW9uKTsKICAgIHRoaXMuZXhhbXBsZSA9IHRoaXMubWFya2Rvd24odGhpcy5leGFtcGxlKTsKICAgIHRoaXNbJ3RoaXMnXSA9IHRoaXMubWFya2Rvd24odGhpc1sndGhpcyddKTsKICAgIHJldHVybiB0aGlzOwoKICAgIGZ1bmN0aW9uIGZsdXNoKCkgewogICAgICBpZiAoYXROYW1lKSB7CiAgICAgICAgdmFyIHRleHQgPSB0cmltKGF0VGV4dC5qb2luKCdcbicpKSwgbWF0Y2g7CiAgICAgICAgaWYgKGF0TmFtZSA9PSAncGFyYW0nKSB7CiAgICAgICAgICBtYXRjaCA9IHRleHQubWF0Y2goL15ceyhbXn1dKylcfVxzKygoW15ccz1dKyl8XFsoXFMrKT0oW15cXV0rKVxdKVxzKyguKikvKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgMSAgICAgIDEgICAgMjMgICAgICAgMyAgIDQgICA0IDUgICAgICA1ICAyICAgNiAgNgogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBhIHZhbGlkICdwYXJhbScgZm9ybWF0OiAiICsgdGV4dCArICcgKGZvdW5kIGluOiAnICsgc2VsZi5maWxlICsgJzonICsgc2VsZi5saW5lICsgJyknKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb3B0aW9uYWwgPSAobWF0Y2hbMV0uc2xpY2UoLTEpID09PSAnPScpOwogICAgICAgICAgdmFyIHBhcmFtID0gewogICAgICAgICAgICBuYW1lOiBtYXRjaFs0XSB8fCBtYXRjaFszXSwKICAgICAgICAgICAgZGVzY3JpcHRpb246c2VsZi5tYXJrZG93bih0ZXh0LnJlcGxhY2UobWF0Y2hbMF0sIG1hdGNoWzZdKSksCiAgICAgICAgICAgIHR5cGU6IG9wdGlvbmFsID8gbWF0Y2hbMV0uc3Vic3RyaW5nKDAsIG1hdGNoWzFdLmxlbmd0aC0xKSA6IG1hdGNoWzFdLAogICAgICAgICAgICBvcHRpb25hbDogb3B0aW9uYWwsCiAgICAgICAgICAgICdkZWZhdWx0JzptYXRjaFs1XQogICAgICAgICAgfTsKICAgICAgICAgIAogICAgICAgICAgLy9pZiBwYXJhbSBuYW1lIGlzIGEgcGFydCBvZiBhbiBvYmplY3QgcGFzc2VkIHRvIGEgbWV0aG9kCiAgICAgICAgICAvL21hcmsgaXQsIHNvIGl0J3Mgbm90IGluY2x1ZGVkIGluIHRoZSByZW5kZXJpbmcgbGF0ZXIKICAgICAgICAgIGlmKHBhcmFtLm5hbWUuaW5kZXhPZigiLiIpID4gMCl7CiAgICAgICAgICAgICAgcGFyYW0uaXNQcm9wZXJ0eSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICAKICAgICAgICAgIHNlbGYucGFyYW0ucHVzaChwYXJhbSk7CiAgICAgICAgfSBlbHNlIGlmIChhdE5hbWUgPT0gJ3JldHVybnMnIHx8IGF0TmFtZSA9PSAncmV0dXJuJykgewogICAgICAgICAgbWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eXHsoW159XSspXH1ccysoLiopLyk7CiAgICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgdmFsaWQgJ3JldHVybnMnIGZvcm1hdDogIiArIHRleHQgKyAnIChmb3VuZCBpbjogJyArIHNlbGYuZmlsZSArICc6JyArIHNlbGYubGluZSArICcpJyk7CiAgICAgICAgICB9CiAgICAgICAgICBzZWxmLnJldHVybnMgPSB7CiAgICAgICAgICAgIHR5cGU6IG1hdGNoWzFdLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogc2VsZi5tYXJrZG93bih0ZXh0LnJlcGxhY2UobWF0Y2hbMF0sIG1hdGNoWzJdKSkKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmKGF0TmFtZSA9PSAncmVxdWlyZXMnKSB7CiAgICAgICAgICBtYXRjaCA9IHRleHQubWF0Y2goL14oW15cc10qKVxzKihbXFNcc10qKS8pOwogICAgICAgICAgc2VsZi5yZXF1aXJlcy5wdXNoKHsKICAgICAgICAgICAgbmFtZTogbWF0Y2hbMV0sCiAgICAgICAgICAgIHRleHQ6IHNlbGYubWFya2Rvd24obWF0Y2hbMl0pCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYoYXROYW1lID09ICdwcm9wZXJ0eScpIHsKICAgICAgICAgIG1hdGNoID0gdGV4dC5tYXRjaCgvXlx7KFxTKylcfVxzKyhcUyspKFxzKyguKikpPy8pOwogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBhIHZhbGlkICdwcm9wZXJ0eScgZm9ybWF0OiAiICsgdGV4dCArICcgKGZvdW5kIGluOiAnICsgc2VsZi5maWxlICsgJzonICsgc2VsZi5saW5lICsgJyknKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBwcm9wZXJ0eSA9IG5ldyBEb2MoewogICAgICAgICAgICB0eXBlOiBtYXRjaFsxXSwKICAgICAgICAgICAgbmFtZTogbWF0Y2hbMl0sCiAgICAgICAgICAgIHNob3J0TmFtZTogbWF0Y2hbMl0sCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBzZWxmLm1hcmtkb3duKHRleHQucmVwbGFjZShtYXRjaFswXSwgbWF0Y2hbNF0pKQogICAgICAgICAgfSk7CiAgICAgICAgICBzZWxmLnByb3BlcnRpZXMucHVzaChwcm9wZXJ0eSk7CiAgICAgICAgfSBlbHNlIGlmKGF0TmFtZSA9PSAnZXZlbnRUeXBlJykgewogICAgICAgICAgbWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eKFteXHNdKilccytvblxzKyhbXFNcc10qKS8pOwogICAgICAgICAgc2VsZi50eXBlID0gbWF0Y2hbMV07CiAgICAgICAgICBzZWxmLnRhcmdldCA9IG1hdGNoWzJdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWxmW2F0TmFtZV0gPSB0ZXh0OwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCgogIGh0bWw6IGZ1bmN0aW9uKCkgewogICAgdmFyIGRvbSA9IG5ldyBET00oKSwKICAgICAgc2VsZiA9IHRoaXM7CgogICAgZG9tLmgodGl0bGUodGhpcy5uYW1lLCB0aGlzLm5nZG9jID09ICdvdmVydmlldycpLCBmdW5jdGlvbigpIHsKCiAgICAgIG5vdGljZSgnZGVwcmVjYXRlZCcsICdEZXByZWNhdGVkIEFQSScsIHNlbGYuZGVwcmVjYXRlZCk7CiAgICAgIGlmIChzZWxmLm5nZG9jICE9ICdvdmVydmlldycpIHsKICAgICAgICBkb20uaCgnRGVzY3JpcHRpb24nLCBzZWxmLmRlc2NyaXB0aW9uLCBkb20uaHRtbCk7CiAgICAgIH0KICAgICAgZG9tLmgoJ0RlcGVuZGVuY2llcycsIHNlbGYucmVxdWlyZXMsIGZ1bmN0aW9uKHJlcXVpcmUpewogICAgICAgIGRvbS50YWcoJ2NvZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBpZCA9IC9bXC5cL10vLnRlc3QocmVxdWlyZS5uYW1lKSA/IHJlcXVpcmUubmFtZSA6ICduZy4nICsgcmVxdWlyZS5uYW1lLAogICAgICAgICAgICAgIG5hbWUgPSByZXF1aXJlLm5hbWUuc3BsaXQoL1tcLjojXC9dLykucG9wKCk7CiAgICAgICAgICBkb20udGFnKCdhJywge2hyZWY6IHNlbGYuY29udmVydFVybFRvQWJzb2x1dGUoaWQpfSwgbmFtZSk7CiAgICAgICAgfSk7CiAgICAgICAgZG9tLmh0bWwocmVxdWlyZS50ZXh0KTsKICAgICAgfSk7CgogICAgICAoc2VsZlsnaHRtbF91c2FnZV8nICsgc2VsZi5uZ2RvY10gfHwgZnVuY3Rpb24oKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJEb24ndCBrbm93IGhvdyB0byBmb3JtYXQgQG5nZG9jOiAiICsgc2VsZi5uZ2RvYyk7CiAgICAgIH0pLmNhbGwoc2VsZiwgZG9tKTsKCiAgICAgIGRvbS5oKCdFeGFtcGxlJywgc2VsZi5leGFtcGxlLCBkb20uaHRtbCk7CiAgICB9KTsKCiAgICByZXR1cm4gZG9tLnRvU3RyaW5nKCk7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiBub3RpY2UobmFtZSwgbGVnZW5kLCBtc2cpewogICAgICBpZiAoc2VsZltuYW1lXSA9PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgZG9tLnRhZygnZmllbGRzZXQnLCB7J2NsYXNzJzpuYW1lfSwgZnVuY3Rpb24oZG9tKXsKICAgICAgICBkb20udGFnKCdsZWdlbmQnLCBsZWdlbmQpOwogICAgICAgIGRvbS50ZXh0KG1zZyk7CiAgICAgIH0pOwogICAgfQoKICB9LAoKICBodG1sX3VzYWdlX3BhcmFtZXRlcnM6IGZ1bmN0aW9uKGRvbSkgewogICAgZG9tLmgoJ1BhcmFtZXRlcnMnLCB0aGlzLnBhcmFtLCBmdW5jdGlvbihwYXJhbSl7CiAgICAgIGRvbS50YWcoJ2NvZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb20udGV4dChwYXJhbS5uYW1lKTsKICAgICAgICBpZiAocGFyYW0ub3B0aW9uYWwpIHsKICAgICAgICAgIGRvbS50YWcoJ2knLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoJyhvcHRpb25hbCcpOwogICAgICAgICAgICBpZihwYXJhbVsnZGVmYXVsdCddKSB7CiAgICAgICAgICAgICAgZG9tLnRleHQoJz0nICsgcGFyYW1bJ2RlZmF1bHQnXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZG9tLnRleHQoJyknKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBkb20udGV4dCgnIOKAkyB7Jyk7CiAgICAgICAgZG9tLnRleHQocGFyYW0udHlwZSk7CiAgICAgICAgaWYgKHBhcmFtLm9wdGlvbmFsKSB7CiAgICAgICAgICBkb20udGV4dCgnPScpOwogICAgICAgIH0KICAgICAgICBkb20udGV4dCgnfSDigJMgJyk7CiAgICAgIH0pOwogICAgICBkb20uaHRtbChwYXJhbS5kZXNjcmlwdGlvbik7CiAgICB9KTsKICAgIGlmKHRoaXMuYW5pbWF0aW9ucykgewogICAgICBkb20uaCgnQW5pbWF0aW9ucycsIHRoaXMuYW5pbWF0aW9ucywgZnVuY3Rpb24oYW5pbWF0aW9ucyl7CiAgICAgICAgZG9tLmh0bWwoJzx1bD4nKTsKICAgICAgICB2YXIgYW5pbWF0aW9ucyA9IGFuaW1hdGlvbnMuc3BsaXQoIlxuIik7CiAgICAgICAgYW5pbWF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGFuaSkgewogICAgICAgICAgZG9tLmh0bWwoJzxsaT4nKTsKICAgICAgICAgIGRvbS50ZXh0KGFuaSk7CiAgICAgICAgICBkb20uaHRtbCgnPC9saT4nKTsKICAgICAgICB9KTsKICAgICAgICBkb20uaHRtbCgnPC91bD4nKTsKICAgICAgfSk7CiAgICB9CiAgfSwKCiAgaHRtbF91c2FnZV9yZXR1cm5zOiBmdW5jdGlvbihkb20pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGlmIChzZWxmLnJldHVybnMpIHsKICAgICAgZG9tLmgoJ1JldHVybnMnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb20udGFnKCdjb2RlJywgJ3snICsgc2VsZi5yZXR1cm5zLnR5cGUgKyAnfScpOwogICAgICAgIGRvbS50ZXh0KCfigJMgJyk7CiAgICAgICAgZG9tLmh0bWwoc2VsZi5yZXR1cm5zLmRlc2NyaXB0aW9uKTsKICAgICAgfSk7CiAgICB9CiAgfSwKCiAgaHRtbF91c2FnZV90aGlzOiBmdW5jdGlvbihkb20pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGlmIChzZWxmWyd0aGlzJ10pIHsKICAgICAgZG9tLmgoZnVuY3Rpb24oZG9tKXsKICAgICAgICBkb20uaHRtbCgiTWV0aG9kJ3MgPGNvZGU+dGhpczwvY29kZT4iKTsKICAgICAgfSwgZnVuY3Rpb24oZG9tKXsKICAgICAgICBkb20uaHRtbChzZWxmWyd0aGlzJ10pOwogICAgICB9KTsKICAgIH0KICB9LAoKICBodG1sX3VzYWdlX2Z1bmN0aW9uOiBmdW5jdGlvbihkb20pewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIG5hbWUgPSBzZWxmLm5hbWUubWF0Y2goL15hbmd1bGFyKFwubW9jayk/XC4oXHcrKSQvKSA/IHNlbGYubmFtZSA6IHNlbGYubmFtZS5zcGxpdCgvXC4vKS5wb3AoKTsKCiAgICBkb20uaCgnVXNhZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnRleHQobmFtZS5zcGxpdCgnOicpLnBvcCgpKTsKICAgICAgICBkb20udGV4dCgnKCcpOwogICAgICAgIHNlbGYucGFyYW1ldGVycyhkb20sICcsICcpOwogICAgICAgIGRvbS50ZXh0KCcpOycpOwogICAgICB9KTsKCiAgICAgIHNlbGYuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICAgIHNlbGYuaHRtbF91c2FnZV90aGlzKGRvbSk7CiAgICAgIHNlbGYuaHRtbF91c2FnZV9yZXR1cm5zKGRvbSk7CiAgICB9KTsKICAgIHRoaXMubWV0aG9kX3Byb3BlcnRpZXNfZXZlbnRzKGRvbSk7CiAgfSwKCiAgaHRtbF91c2FnZV9wcm9wZXJ0eTogZnVuY3Rpb24oZG9tKXsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICBkb20udGV4dChzZWxmLm5hbWUpOwogICAgICB9KTsKCiAgICAgIHNlbGYuaHRtbF91c2FnZV9yZXR1cm5zKGRvbSk7CiAgICB9KTsKICB9LAoKICBodG1sX3VzYWdlX2RpcmVjdGl2ZTogZnVuY3Rpb24oZG9tKXsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgcmVzdHJpY3QgPSBzZWxmLnJlc3RyaWN0IHx8ICdBQyc7CgogICAgICAvKmlmIChyZXN0cmljdC5tYXRjaCgvRS8pKSB7CiAgICAgICAgZG9tLmh0bWwoJzxwPicpOwogICAgICAgIGRvbS50ZXh0KCdUaGlzIGRpcmVjdGl2ZSBjYW4gYmUgdXNlZCBhcyBjdXN0b20gZWxlbWVudCwgYnV0IGJlIGF3YXJlIG9mICcpOwogICAgICAgIGRvbS50YWcoJ2EnLCB7aHJlZjonaHR0cDovL2RvY3MuYW5ndWxhcmpzLm9yZy9ndWlkZS9pZSd9LCAnSUUgcmVzdHJpY3Rpb25zJyk7CiAgICAgICAgZG9tLnRleHQoJy4nKTsKICAgICAgICBkb20uaHRtbCgnPC9wPicpOwogICAgICB9Ki8KCiAgICAgIGlmIChzZWxmLnVzYWdlKSB7CiAgICAgICAgZG9tLnRhZygncHJlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBkb20udGFnKCdjb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS50ZXh0KHNlbGYudXNhZ2UpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHJlc3RyaWN0Lm1hdGNoKC9FLykpIHsKICAgICAgICAgIGRvbS50ZXh0KCdhcyBlbGVtZW50OicpOwogICAgICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS50ZXh0KCc8Jyk7CiAgICAgICAgICAgIGRvbS50ZXh0KGRhc2hDYXNlKHNlbGYuc2hvcnROYW1lKSk7CiAgICAgICAgICAgIHJlbmRlclBhcmFtcygnXG4gICAgICAgJywgJz0iJywgJyInKTsKICAgICAgICAgICAgZG9tLnRleHQoJz5cbjwvJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KGRhc2hDYXNlKHNlbGYuc2hvcnROYW1lKSk7CiAgICAgICAgICAgIGRvbS50ZXh0KCc+Jyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlc3RyaWN0Lm1hdGNoKC9BLykpIHsKICAgICAgICAgIHZhciBlbGVtZW50ID0gc2VsZi5lbGVtZW50IHx8ICdBTlknOwogICAgICAgICAgZG9tLnRleHQoJ2FzIGF0dHJpYnV0ZScpOwogICAgICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS50ZXh0KCc8JyArIGVsZW1lbnQgKyAnICcpOwogICAgICAgICAgICBkb20udGV4dChkYXNoQ2FzZShzZWxmLnNob3J0TmFtZSkpOwogICAgICAgICAgICByZW5kZXJQYXJhbXMoJ1xuICAgICAnLCAnPSInLCAnIicsIHRydWUpOwogICAgICAgICAgICBkb20udGV4dCgnPlxuICAgLi4uXG4nKTsKICAgICAgICAgICAgZG9tLnRleHQoJzwvJyArIGVsZW1lbnQgKyAnPicpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChyZXN0cmljdC5tYXRjaCgvQy8pKSB7CiAgICAgICAgICBkb20udGV4dCgnYXMgY2xhc3MnKTsKICAgICAgICAgIHZhciBlbGVtZW50ID0gc2VsZi5lbGVtZW50IHx8ICdBTlknOwogICAgICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS50ZXh0KCc8JyArIGVsZW1lbnQgKyAnIGNsYXNzPSInKTsKICAgICAgICAgICAgZG9tLnRleHQoZGFzaENhc2Uoc2VsZi5zaG9ydE5hbWUpKTsKICAgICAgICAgICAgcmVuZGVyUGFyYW1zKCcgJywgJzogJywgJzsnLCB0cnVlKTsKICAgICAgICAgICAgZG9tLnRleHQoJyI+XG4gICAuLi5cbicpOwogICAgICAgICAgICBkb20udGV4dCgnPC8nICsgZWxlbWVudCArICc+Jyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYoc2VsZi5hbmltYXRpb25zKSB7CiAgICAgICAgICB2YXIgYW5pbWF0aW9ucyA9IFtdLCBtYXRjaGVzID0gc2VsZi5hbmltYXRpb25zLnNwbGl0KCJcbiIpOwogICAgICAgICAgbWF0Y2hlcy5mb3JFYWNoKGZ1bmN0aW9uKGFuaSkgewogICAgICAgICAgICB2YXIgbmFtZSA9IGFuaS5tYXRjaCgvXlxzKiguKz8pXHMqLS8pWzFdOwogICAgICAgICAgICBhbmltYXRpb25zLnB1c2gobmFtZSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBkb20uaHRtbCgnd2l0aCA8c3BhbiBpZD0iYW5pbWF0aW9ucyI+YW5pbWF0aW9uczwvc3Bhbj4nKTsKICAgICAgICAgIHZhciBjb21tZW50OwogICAgICAgICAgaWYoYW5pbWF0aW9ucy5sZW5ndGggPT0gMSkgewogICAgICAgICAgICBjb21tZW50ID0gJ1RoZSAnICsgYW5pbWF0aW9uc1swXSArICcgYW5pbWF0aW9uIGlzIHN1cHBvcnRlZCc7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIHJocyA9IGFuaW1hdGlvbnNbYW5pbWF0aW9ucy5sZW5ndGgtMV07CiAgICAgICAgICAgIHZhciBsaHMgPSAnJzsKICAgICAgICAgICAgZm9yKHZhciBpPTA7aTxhbmltYXRpb25zLmxlbmd0aC0xO2krKykgewogICAgICAgICAgICAgIGlmKGk+MCkgewogICAgICAgICAgICAgICAgbGhzICs9ICcsICc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxocyArPSBhbmltYXRpb25zW2ldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbW1lbnQgPSAnVGhlICcgKyBsaHMgKyAnIGFuZCAnICsgcmhzICsgJyBhbmltYXRpb25zIGFyZSBzdXBwb3J0ZWQnOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGVsZW1lbnQgPSBzZWxmLmVsZW1lbnQgfHwgJ0FOWSc7CiAgICAgICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoJy8vJyArIGNvbW1lbnQgKyAiXG4iKTsKICAgICAgICAgICAgZG9tLnRleHQoJzwnICsgZWxlbWVudCArICcgJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KGRhc2hDYXNlKHNlbGYuc2hvcnROYW1lKSk7CiAgICAgICAgICAgIHJlbmRlclBhcmFtcygnXG4gICAgICcsICc9IicsICciJywgdHJ1ZSk7CiAgICAgICAgICAgIGRvbS50ZXh0KCcgbmctYW5pbWF0ZT0ieycpOwogICAgICAgICAgICBhbmltYXRpb25zLmZvckVhY2goZnVuY3Rpb24oYW5pLCBpbmRleCkgewogICAgICAgICAgICAgIGlmIChpbmRleCkgewogICAgICAgICAgICAgICAgZG9tLnRleHQoJywgJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGRvbS50ZXh0KGFuaSArICc6IFwnJyArIGFuaSArICctYW5pbWF0aW9uXCcnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRvbS50ZXh0KCd9Ij5cbiAgIC4uLlxuJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KCc8LycgKyBlbGVtZW50ICsgJz4nKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGRvbS5odG1sKCc8YSBocmVmPSJhcGkvbmcuJGFuaW1hdG9yI01ldGhvZHMiPkNsaWNrIGhlcmU8L2E+IHRvIGxlYXJuIG1vcmUgYWJvdXQgdGhlIHN0ZXBzIGludm9sdmVkIGluIHRoZSBhbmltYXRpb24uJyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHNlbGYuaHRtbF91c2FnZV9kaXJlY3RpdmVJbmZvKGRvbSk7CiAgICAgIHNlbGYuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICB9KTsKCiAgICBzZWxmLm1ldGhvZF9wcm9wZXJ0aWVzX2V2ZW50cyhkb20pOwoKICAgIGZ1bmN0aW9uIHJlbmRlclBhcmFtcyhwcmVmaXgsIGluZml4LCBzdWZmaXgsIHNraXBTZWxmKSB7CiAgICAgIChzZWxmLnBhcmFtfHxbXSkuZm9yRWFjaChmdW5jdGlvbihwYXJhbSkgewogICAgICAgIHZhciBza2lwID0gc2tpcFNlbGYgJiYgKHBhcmFtLm5hbWUgPT0gc2VsZi5zaG9ydE5hbWUgfHwgcGFyYW0ubmFtZS5pbmRleE9mKHNlbGYuc2hvcnROYW1lICsgJ3wnKSA9PSAwKTsKICAgICAgICBpZiAoIXNraXApIHsKICAgICAgICAgIGRvbS50ZXh0KHByZWZpeCk7CiAgICAgICAgICBkb20udGV4dChwYXJhbS5vcHRpb25hbCA/ICdbJyA6ICcnKTsKICAgICAgICAgIHZhciBwYXJ0cyA9IHBhcmFtLm5hbWUuc3BsaXQoJ3wnKTsKICAgICAgICAgIGRvbS50ZXh0KHBhcnRzW3NraXBTZWxmID8gMCA6IDFdIHx8IHBhcnRzWzBdKTsKICAgICAgICB9CiAgICAgICAgaWYgKEJPT0xFQU5fQVRUUltwYXJhbS5uYW1lXSkgewogICAgICAgICAgZG9tLnRleHQocGFyYW0ub3B0aW9uYWwgPyAnXScgOiAnJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRvbS50ZXh0KEJPT0xFQU5fQVRUUltwYXJhbS5uYW1lXSA/ICcnIDogaW5maXggKTsKICAgICAgICAgIGRvbS50ZXh0KCgneycgKyBwYXJhbS50eXBlICsgJ30nKS5yZXBsYWNlKC9eXHtcJyguKilcJ1x9JC8sICckMScpKTsKICAgICAgICAgIGRvbS50ZXh0KHN1ZmZpeCk7CiAgICAgICAgICBkb20udGV4dChwYXJhbS5vcHRpb25hbCAmJiAhc2tpcCA/ICddJyA6ICcnKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICB9LAoKICBodG1sX3VzYWdlX2ZpbHRlcjogZnVuY3Rpb24oZG9tKXsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICBkb20uaCgnSW4gSFRNTCBUZW1wbGF0ZSBCaW5kaW5nJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnRhZygnY29kZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHNlbGYudXNhZ2UpIHsKICAgICAgICAgICAgZG9tLnRleHQoc2VsZi51c2FnZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkb20udGV4dCgne3sgJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KHNlbGYuc2hvcnROYW1lKTsKICAgICAgICAgICAgZG9tLnRleHQoJ19leHByZXNzaW9uIHwgJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KHNlbGYuc2hvcnROYW1lKTsKICAgICAgICAgICAgc2VsZi5wYXJhbWV0ZXJzKGRvbSwgJzonLCB0cnVlKTsKICAgICAgICAgICAgZG9tLnRleHQoJyB9fScpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIGRvbS5oKCdJbiBKYXZhU2NyaXB0JywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnRhZygnY29kZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgZG9tLnRleHQoJyRmaWx0ZXIoXCcnKTsKICAgICAgICAgIGRvbS50ZXh0KHNlbGYuc2hvcnROYW1lKTsKICAgICAgICAgIGRvbS50ZXh0KCdcJykoJyk7CiAgICAgICAgICBzZWxmLnBhcmFtZXRlcnMoZG9tLCAnLCAnKTsKICAgICAgICAgIGRvbS50ZXh0KCcpJyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgc2VsZi5odG1sX3VzYWdlX3BhcmFtZXRlcnMoZG9tKTsKICAgICAgc2VsZi5odG1sX3VzYWdlX3RoaXMoZG9tKTsKICAgICAgc2VsZi5odG1sX3VzYWdlX3JldHVybnMoZG9tKTsKICAgIH0pOwogIH0sCgogIGh0bWxfdXNhZ2VfaW5wdXRUeXBlOiBmdW5jdGlvbihkb20pewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgZG9tLmgoJ1VzYWdlJywgZnVuY3Rpb24oKSB7CiAgICAgIGRvbS5jb2RlKGZ1bmN0aW9uKCkgewogICAgICAgIGRvbS50ZXh0KCc8aW5wdXQgdHlwZT0iJyArIHNlbGYuc2hvcnROYW1lICsgJyInKTsKICAgICAgICAoc2VsZi5wYXJhbXx8W10pLmZvckVhY2goZnVuY3Rpb24ocGFyYW0pewogICAgICAgICAgZG9tLnRleHQoJ1xuICAgICAgJyk7CiAgICAgICAgICBkb20udGV4dChwYXJhbS5vcHRpb25hbCA/ICcgWycgOiAnICcpOwogICAgICAgICAgZG9tLnRleHQoZGFzaENhc2UocGFyYW0ubmFtZSkpOwogICAgICAgICAgZG9tLnRleHQoQk9PTEVBTl9BVFRSW3BhcmFtLm5hbWVdID8gJycgOiAnPSJ7JyArIHBhcmFtLnR5cGUgKyAnfSInKTsKICAgICAgICAgIGRvbS50ZXh0KHBhcmFtLm9wdGlvbmFsID8gJ10nIDogJycpOwogICAgICAgIH0pOwogICAgICAgIGRvbS50ZXh0KCc+Jyk7CiAgICAgIH0pOwogICAgICBzZWxmLmh0bWxfdXNhZ2VfcGFyYW1ldGVycyhkb20pOwogICAgfSk7CiAgfSwKCiAgaHRtbF91c2FnZV9kaXJlY3RpdmVJbmZvOiBmdW5jdGlvbihkb20pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBsaXN0ID0gW107CgoKICAgIGlmIChzZWxmLnNjb3BlICE9PSB1bmRlZmluZWQpIHsKICAgICAgbGlzdC5wdXNoKCdUaGlzIGRpcmVjdGl2ZSBjcmVhdGVzIG5ldyBzY29wZS4nKTsKICAgIH0KICAgIGlmIChzZWxmLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgbGlzdC5wdXNoKCdUaGlzIGRpcmVjdGl2ZSBleGVjdXRlcyBhdCBwcmlvcml0eSBsZXZlbCAnICsgc2VsZi5wcmlvcml0eSArICcuJyk7CiAgICB9CgogICAgaWYgKGxpc3QubGVuZ3RoKSB7CiAgICAgIGRvbS5oKCdEaXJlY3RpdmUgaW5mbycsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvbS51bChsaXN0KTsKICAgICAgfSk7CiAgICB9CiAgfSwKCiAgaHRtbF91c2FnZV9vdmVydmlldzogZnVuY3Rpb24oZG9tKXsKICAgIGRvbS5odG1sKHRoaXMuZGVzY3JpcHRpb24pOwogIH0sCgogIGh0bWxfdXNhZ2VfaW50ZXJmYWNlOiBmdW5jdGlvbihkb20pewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGlmICh0aGlzLnBhcmFtLmxlbmd0aCkgewogICAgICBkb20uaCgnVXNhZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICAgIGRvbS50ZXh0KHNlbGYubmFtZS5zcGxpdCgnLicpLnBvcCgpKTsKICAgICAgICAgIGRvbS50ZXh0KCcoJyk7CiAgICAgICAgICBzZWxmLnBhcmFtZXRlcnMoZG9tLCAnLCAnKTsKICAgICAgICAgIGRvbS50ZXh0KCcpOycpOwogICAgICAgIH0pOwoKICAgICAgICBzZWxmLmh0bWxfdXNhZ2VfcGFyYW1ldGVycyhkb20pOwogICAgICAgIHNlbGYuaHRtbF91c2FnZV90aGlzKGRvbSk7CiAgICAgICAgc2VsZi5odG1sX3VzYWdlX3JldHVybnMoZG9tKTsKICAgICAgfSk7CiAgICB9CiAgICB0aGlzLm1ldGhvZF9wcm9wZXJ0aWVzX2V2ZW50cyhkb20pOwogIH0sCgogIGh0bWxfdXNhZ2Vfc2VydmljZTogZnVuY3Rpb24oZG9tKSB7CiAgICB0aGlzLmh0bWxfdXNhZ2VfaW50ZXJmYWNlKGRvbSkKICB9LAoKICBodG1sX3VzYWdlX29iamVjdDogZnVuY3Rpb24oZG9tKSB7CiAgICB0aGlzLmh0bWxfdXNhZ2VfaW50ZXJmYWNlKGRvbSkKICB9LAoKICBtZXRob2RfcHJvcGVydGllc19ldmVudHM6IGZ1bmN0aW9uKGRvbSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKHNlbGYubWV0aG9kcy5sZW5ndGgpIHsKICAgICAgZG9tLmRpdih7Y2xhc3M6J21lbWJlciBtZXRob2QnfSwgZnVuY3Rpb24oKXsKICAgICAgICBkb20uaCgnTWV0aG9kcycsIHNlbGYubWV0aG9kcywgZnVuY3Rpb24obWV0aG9kKXsKICAgICAgICAgIC8vZmlsdGVycyBvdXQgLklzUHJvcGVydHkgcGFyYW1ldGVycyBmcm9tIHRoZSBtZXRob2Qgc2lnbmF0dXJlCiAgICAgICAgICB2YXIgc2lnbmF0dXJlID0gKG1ldGhvZC5wYXJhbSB8fCBbXSkuZmlsdGVyKGZ1bmN0aW9uKGUpIHsgcmV0dXJuIGUuaXNQcm9wZXJ0eSAhPT0gdHJ1ZX0pLm1hcChwcm9wZXJ0eSgnbmFtZScpKTsKICAgICAgICAgIAogICAgICAgICAgZG9tLmgobWV0aG9kLnNob3J0TmFtZSArICcoJyArIHNpZ25hdHVyZS5qb2luKCcsICcpICsgJyknLCBtZXRob2QsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBkb20uaHRtbChtZXRob2QuZGVzY3JpcHRpb24pOwogICAgICAgICAgICBtZXRob2QuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICAgICAgICAgIHNlbGYuaHRtbF91c2FnZV90aGlzKGRvbSk7CiAgICAgICAgICAgIG1ldGhvZC5odG1sX3VzYWdlX3JldHVybnMoZG9tKTsKCiAgICAgICAgICAgIGRvbS5oKCdFeGFtcGxlJywgbWV0aG9kLmV4YW1wbGUsIGRvbS5odG1sKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIGlmIChzZWxmLnByb3BlcnRpZXMubGVuZ3RoKSB7CiAgICAgIGRvbS5kaXYoe2NsYXNzOidtZW1iZXIgcHJvcGVydHknfSwgZnVuY3Rpb24oKXsKICAgICAgICBkb20uaCgnUHJvcGVydGllcycsIHNlbGYucHJvcGVydGllcywgZnVuY3Rpb24ocHJvcGVydHkpewogICAgICAgICAgZG9tLmgocHJvcGVydHkuc2hvcnROYW1lLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLmh0bWwocHJvcGVydHkuZGVzY3JpcHRpb24pOwogICAgICAgICAgICBpZiAoIXByb3BlcnR5Lmh0bWxfdXNhZ2VfcmV0dXJucykgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb3BlcnR5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwcm9wZXJ0eS5odG1sX3VzYWdlX3JldHVybnMoZG9tKTsKICAgICAgICAgICAgZG9tLmgoJ0V4YW1wbGUnLCBwcm9wZXJ0eS5leGFtcGxlLCBkb20uaHRtbCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICBpZiAoc2VsZi5ldmVudHMubGVuZ3RoKSB7CiAgICAgIGRvbS5kaXYoe2NsYXNzOidtZW1iZXIgZXZlbnQnfSwgZnVuY3Rpb24oKXsKICAgICAgICBkb20uaCgnRXZlbnRzJywgc2VsZi5ldmVudHMsIGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgIGRvbS5oKGV2ZW50LnNob3J0TmFtZSwgZXZlbnQsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBkb20uaHRtbChldmVudC5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgIGlmIChldmVudC50eXBlID09ICdsaXN0ZW4nKSB7CiAgICAgICAgICAgICAgZG9tLnRhZygnZGl2Jywge2NsYXNzOidpbmxpbmUnfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkb20uaCgnTGlzdGVuIG9uOicsIGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZG9tLnRhZygnZGl2Jywge2NsYXNzOidpbmxpbmUnfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkb20uaCgnVHlwZTonLCBldmVudC50eXBlKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBkb20udGFnKCdkaXYnLCB7Y2xhc3M6J2lubGluZSd9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvbS5oKCdUYXJnZXQ6JywgZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBldmVudC5odG1sX3VzYWdlX3BhcmFtZXRlcnMoZG9tKTsKICAgICAgICAgICAgc2VsZi5odG1sX3VzYWdlX3RoaXMoZG9tKTsKCiAgICAgICAgICAgIGRvbS5oKCdFeGFtcGxlJywgZXZlbnQuZXhhbXBsZSwgZG9tLmh0bWwpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sCgogIHBhcmFtZXRlcnM6IGZ1bmN0aW9uKGRvbSwgc2VwYXJhdG9yLCBza2lwRmlyc3QsIHByZWZpeCkgewogICAgdmFyIHNlcCA9IHByZWZpeCA/IHNlcGFyYXRvciA6ICcnOwogICAgKHRoaXMucGFyYW18fFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHBhcmFtLCBpKXsKICAgICAgaWYgKCEoc2tpcEZpcnN0ICYmIGk9PTApKSB7CiAgICAgICAgaWYgKHBhcmFtLm9wdGlvbmFsKSB7CiAgICAgICAgICBkb20udGV4dCgnWycgKyBzZXAgKyBwYXJhbS5uYW1lICsgJ10nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZG9tLnRleHQoc2VwICsgcGFyYW0ubmFtZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHNlcCA9IHNlcGFyYXRvcjsKICAgIH0pOwogIH0KCn07Ci8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCnZhciBHTE9CQUxTID0gL15hbmd1bGFyXC4oW15cLl0rKSQvLAogICAgTU9EVUxFID0gL14oW15cLl0rKSQvLAogICAgTU9EVUxFX01PQ0sgPSAvXmFuZ3VsYXJcLm1vY2tcLihbXlwuXSspJC8sCiAgICBNT0RVTEVfRElSRUNUSVZFID0gL14oLispXC5kaXJlY3RpdmU6KFteXC5dKykkLywKICAgIE1PRFVMRV9ESVJFQ1RJVkVfSU5QVVQgPSAvXiguKylcLmRpcmVjdGl2ZTppbnB1dFwuKFteXC5dKykkLywKICAgIE1PRFVMRV9DVVNUT00gPSAvXiguKylcLihbXlwuXSspOihbXlwuXSspJC8sCiAgICBNT0RVTEVfU0VSVklDRSA9IC9eKC4rKVwuKFteXC5dKz8pKFByb3ZpZGVyKT8kLywKICAgIE1PRFVMRV9UWVBFID0gL14oW15cLl0rKVwuLitcLihbQS1aXVteXC5dKykkLzsKCgpmdW5jdGlvbiB0aXRsZSh0ZXh0LCBvdmVydmlldykgewogIGlmICghdGV4dCkgcmV0dXJuIHRleHQ7CiAgdmFyIG1hdGNoLAogICAgbW9kdWxlLAogICAgdHlwZSwKICAgIG5hbWU7CgogIGlmICh0ZXh0ID09ICdhbmd1bGFyLk1vZHVsZScpIHsKICAgIG1vZHVsZSA9ICduZyc7CiAgICBuYW1lID0gJ01vZHVsZSc7CiAgICB0eXBlID0gJ1R5cGUnOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKEdMT0JBTFMpKSB7CiAgICBtb2R1bGUgPSAnbmcnOwogICAgbmFtZSA9ICdhbmd1bGFyLicgKyBtYXRjaFsxXTsKICAgIHR5cGUgPSAnQVBJJzsKICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChNT0RVTEUpKSB7CiAgICBtb2R1bGUgPSBtYXRjaFsxXTsKICAgIGlmICghb3ZlcnZpZXcpIHsgbmFtZSA9IG1hdGNoWzFdOyB9CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFX01PQ0spKSB7CiAgICBtb2R1bGUgPSAnbmcnOwogICAgbmFtZSA9ICdhbmd1bGFyLm1vY2suJyArIG1hdGNoWzFdOwogICAgdHlwZSA9ICdBUEknOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKE1PRFVMRV9ESVJFQ1RJVkUpKSB7CiAgICBtb2R1bGUgPSBtYXRjaFsxXTsKICAgIG5hbWUgPSBtYXRjaFsyXTsKICAgIHR5cGUgPSAnZGlyZWN0aXZlJzsKICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChNT0RVTEVfRElSRUNUSVZFX0lOUFVUKSkgewogICAgbW9kdWxlID0gbWF0Y2hbMV07CiAgICBuYW1lID0gJ2lucHV0IFsnICsgbWF0Y2hbMl0gKyAnXSc7CiAgICB0eXBlID0gJ2RpcmVjdGl2ZSc7CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFX0NVU1RPTSkpIHsKICAgIG1vZHVsZSA9IG1hdGNoWzFdOwogICAgbmFtZSA9IG1hdGNoWzNdOwogICAgdHlwZSA9IG1hdGNoWzJdOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKE1PRFVMRV9UWVBFKSkgewogICAgbW9kdWxlID0gbWF0Y2hbMV07CiAgICBuYW1lID0gbWF0Y2hbMl07CiAgICB0eXBlID0gJ3R5cGUnOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKE1PRFVMRV9TRVJWSUNFKSkgewogICAgaWYgKG92ZXJ2aWV3KSB7CiAgICAgIC8vIG1vZHVsZSBuYW1lIHdpdGggZG90cyBsb29rcyBsaWtlIGEgc2VydmljZQogICAgICBtb2R1bGUgPSB0ZXh0OwogICAgfSBlbHNlIHsKICAgICAgbW9kdWxlID0gbWF0Y2hbMV07CiAgICAgIG5hbWUgPSBtYXRjaFsyXSArIChtYXRjaFszXSB8fCAnJyk7CiAgICAgIHR5cGUgPSAnc2VydmljZSc7CiAgICB9CiAgfSBlbHNlIHsKICAgIHJldHVybiB0ZXh0OwogIH0KICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICB0aGlzLnRhZygnY29kZScsIG5hbWUpOwogICAgdGhpcy50YWcoJ3NwYW4nLCB7IGNsYXNzOiAnaGludCd9LCBmdW5jdGlvbigpIHsKICAgICAgaWYgKHR5cGUpIHsKICAgICAgICB0aGlzLnRleHQoJygnKTsKICAgICAgICB0aGlzLnRleHQodHlwZSk7CiAgICAgICAgdGhpcy50ZXh0KCcgaW4gbW9kdWxlICcpOwogICAgICAgIHRoaXMudGFnKCdjb2RlJywgbW9kdWxlKTsKICAgICAgICB0aGlzLnRleHQoJyknKTsKICAgICAgfQogICAgfSk7CiAgfTsKfQoKCmZ1bmN0aW9uIHNjZW5hcmlvcyhkb2NzKXsKICB2YXIgc3BlY3MgPSBbXTsKCiAgc3BlY3MucHVzaCgnZGVzY3JpYmUoImFuZ3VsYXIranFsaXRlIiwgZnVuY3Rpb24oKSB7Jyk7CiAgYXBwZW5kU3BlY3MoJ2luZGV4LW5vY2FjaGUuaHRtbCMhLycpOwogIHNwZWNzLnB1c2goJ30pOycpOwoKICBzcGVjcy5wdXNoKCcnKTsKICBzcGVjcy5wdXNoKCcnKTsKCiAgc3BlY3MucHVzaCgnZGVzY3JpYmUoImFuZ3VsYXIranF1ZXJ5IiwgZnVuY3Rpb24oKSB7Jyk7CiAgYXBwZW5kU3BlY3MoJ2luZGV4LWpxLW5vY2FjaGUuaHRtbCMhLycpOwogIHNwZWNzLnB1c2goJ30pOycpOwoKICByZXR1cm4gc3BlY3Muam9pbignXG4nKTsKCiAgZnVuY3Rpb24gYXBwZW5kU3BlY3ModXJsUHJlZml4KSB7CiAgICBkb2NzLmZvckVhY2goZnVuY3Rpb24oZG9jKXsKICAgICAgc3BlY3MucHVzaCgnICBkZXNjcmliZSgiJyArIGRvYy5zZWN0aW9uICsgJy8nICsgZG9jLmlkICsgJyIsIGZ1bmN0aW9uKCkgeycpOwogICAgICBzcGVjcy5wdXNoKCcgICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsnKTsKICAgICAgc3BlY3MucHVzaCgnICAgICAgYnJvd3NlcigpLm5hdmlnYXRlVG8oIicgKyB1cmxQcmVmaXggKyBkb2Muc2VjdGlvbiArICcvJyArIGRvYy5pZCArICciKTsnKTsKICAgICAgc3BlY3MucHVzaCgnICAgIH0pOycpOwogICAgICBzcGVjcy5wdXNoKCcgICcpOwogICAgICBkb2Muc2NlbmFyaW9zLmZvckVhY2goZnVuY3Rpb24oc2NlbmFyaW8pewogICAgICAgIHNwZWNzLnB1c2goaW5kZW50Q29kZSh0cmltKHNjZW5hcmlvKSwgNCkpOwogICAgICAgIHNwZWNzLnB1c2goJycpOwogICAgICB9KTsKICAgICAgc3BlY3MucHVzaCgnfSk7Jyk7CiAgICAgIHNwZWNzLnB1c2goJycpOwogICAgfSk7CiAgfQp9CgoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwpmdW5jdGlvbiBtZXRhZGF0YShkb2NzKXsKICB2YXIgcGFnZXMgPSBbXTsKICBkb2NzLmZvckVhY2goZnVuY3Rpb24oZG9jKXsKICAgIHZhciBwYXRoID0gKGRvYy5uYW1lIHx8ICcnKS5zcGxpdCgvKFwufFw6XHMqKS8pOwogICAgZm9yICggdmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykgewogICAgICBwYXRoLnNwbGljZShpLCAxKTsKICAgIH0KICAgIHZhciBzaG9ydE5hbWUgPSBwYXRoLnBvcCgpLnRyaW0oKTsKCiAgICBpZiAocGF0aC5wb3AoKSA9PSAnaW5wdXQnKSB7CiAgICAgIHNob3J0TmFtZSA9ICdpbnB1dCBbJyArIHNob3J0TmFtZSArICddJzsKICAgIH0KCiAgICBwYWdlcy5wdXNoKHsKICAgICAgc2VjdGlvbjogZG9jLnNlY3Rpb24sCiAgICAgIGlkOiBkb2MuaWQsCiAgICAgIG5hbWU6IHRpdGxlKGRvYy5uYW1lKSwKICAgICAgc2hvcnROYW1lOiBzaG9ydE5hbWUsCiAgICAgIHR5cGU6IGRvYy5uZ2RvYywKICAgICAga2V5d29yZHM6ZG9jLmtleXdvcmRzKCkKICAgIH0pOwogIH0pOwogIHBhZ2VzLnNvcnQoa2V5d29yZFNvcnQpOwogIHJldHVybiBwYWdlczsKfQoKdmFyIEtFWVdPUkRfUFJJT1JJVFkgPSB7CiAgJy5pbmRleCc6IDEsCiAgJy5vdmVydmlldyc6IDEsCiAgJy5ib290c3RyYXAnOiAyLAogICcubXZjJzogMywKICAnLnNjb3Blcyc6IDQsCiAgJy5jb21waWxlcic6IDUsCiAgJy50ZW1wbGF0ZXMnOiA2LAogICcuc2VydmljZXMnOiA3LAogICcuZGknOiA4LAogICcudW5pdC10ZXN0aW5nJzogOSwKICAnLmRldl9ndWlkZSc6IDksCiAgJy5kZXZfZ3VpZGUub3ZlcnZpZXcnOiAxLAogICcuZGV2X2d1aWRlLmJvb3RzdHJhcCc6IDIsCiAgJy5kZXZfZ3VpZGUuYm9vdHN0cmFwLmF1dG9fYm9vdHN0cmFwJzogMSwKICAnLmRldl9ndWlkZS5ib290c3RyYXAubWFudWFsX2Jvb3RzdHJhcCc6IDIsCiAgJy5kZXZfZ3VpZGUubXZjJzogMywKICAnLmRldl9ndWlkZS5tdmMudW5kZXJzdGFuZGluZ19tb2RlbCc6IDEsCiAgJy5kZXZfZ3VpZGUubXZjLnVuZGVyc3RhbmRpbmdfY29udHJvbGxlcic6IDIsCiAgJy5kZXZfZ3VpZGUubXZjLnVuZGVyc3RhbmRpbmdfdmlldyc6IDMsCiAgJy5kZXZfZ3VpZGUuc2NvcGVzJzogNCwKICAnLmRldl9ndWlkZS5zY29wZXMudW5kZXJzdGFuZGluZ19zY29wZXMnOiAxLAogICcuZGV2X2d1aWRlLnNjb3Blcy5pbnRlcm5hbHMnOiAyLAogICcuZGV2X2d1aWRlLmNvbXBpbGVyJzogNSwKICAnLmRldl9ndWlkZS50ZW1wbGF0ZXMnOiA2LAogICcuZGV2X2d1aWRlLnNlcnZpY2VzJzogNywKICAnLmRldl9ndWlkZS5kaSc6IDgsCiAgJy5kZXZfZ3VpZGUudW5pdC10ZXN0aW5nJzogOQp9OwpmdW5jdGlvbiBrZXl3b3JkU29ydChhLCBiKXsKICBmdW5jdGlvbiBtYW5nbGVOYW1lKGRvYykgewogICAgdmFyIHBhdGggPSBkb2MuaWQuc3BsaXQoL1wuLyk7CiAgICB2YXIgbWFuZ2xlZCA9IFtdOwogICAgdmFyIHBhcnRpYWxOYW1lID0gJyc7CiAgICBwYXRoLmZvckVhY2goZnVuY3Rpb24obmFtZSl7CiAgICAgIHBhcnRpYWxOYW1lICs9ICcuJyArIG5hbWU7CiAgICAgIG1hbmdsZWQucHVzaChLRVlXT1JEX1BSSU9SSVRZW3BhcnRpYWxOYW1lXSB8fCA1KTsKICAgICAgbWFuZ2xlZC5wdXNoKG5hbWUpOwogICAgfSk7CiAgICByZXR1cm4gKGRvYy5zZWN0aW9uICsgJy8nICsgbWFuZ2xlZC5qb2luKCcuJykpLnRvTG93ZXJDYXNlKCk7CiAgfQogIHZhciBuYW1lQSA9IG1hbmdsZU5hbWUoYSk7CiAgdmFyIG5hbWVCID0gbWFuZ2xlTmFtZShiKTsKICByZXR1cm4gbmFtZUEgPCBuYW1lQiA/IC0xIDogKG5hbWVBID4gbmFtZUIgPyAxIDogMCk7Cn0KCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCmZ1bmN0aW9uIHRyaW0odGV4dCkgewogIHZhciBNQVhfSU5ERU5UID0gOTk5OTsKICB2YXIgZW1wdHkgPSBSZWdFeHAucHJvdG90eXBlLnRlc3QuYmluZCgvXlxzKiQvKTsKICB2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KCdcbicpOwogIHZhciBtaW5JbmRlbnQgPSBNQVhfSU5ERU5UOwogIHZhciBpbmRlbnRSZWdFeHA7CiAgdmFyIGlnbm9yZUxpbmUgPSAobGluZXNbMF1bMF0gIT0gJyAnICAmJiBsaW5lcy5sZW5ndGggPiAxKTsKICAvLyBpZ25vcmUgZmlyc3QgbGluZSBpZiBpdCBoYXMgbm8gaW5kZW50YXRpb24gYW5kIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgbGluZQoKICBsaW5lcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmUpewogICAgaWYgKGlnbm9yZUxpbmUpIHsKICAgICAgaWdub3JlTGluZSA9IGZhbHNlOwogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGluZGVudCA9IGxpbmUubWF0Y2goL15ccyovKVswXS5sZW5ndGg7CiAgICBpZiAoaW5kZW50ID4gMCB8fCBtaW5JbmRlbnQgPT0gTUFYX0lOREVOVCkgewogICAgICBtaW5JbmRlbnQgPSBNYXRoLm1pbihtaW5JbmRlbnQsIGluZGVudCk7CiAgICB9CiAgfSk7CgogIGluZGVudFJlZ0V4cCA9IG5ldyBSZWdFeHAoJ15cXHN7MCwnICsgbWluSW5kZW50ICsgJ30nKTsKCiAgZm9yICggdmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHsKICAgIGxpbmVzW2ldID0gbGluZXNbaV0ucmVwbGFjZShpbmRlbnRSZWdFeHAsICcnKTsKICB9CgogIC8vIHJlbW92ZSBsZWFkaW5nIGxpbmVzCiAgd2hpbGUgKGVtcHR5KGxpbmVzWzBdKSkgewogICAgbGluZXMuc2hpZnQoKTsKICB9CgogIC8vIHJlbW92ZSB0cmFpbGluZwogIHdoaWxlIChlbXB0eShsaW5lc1tsaW5lcy5sZW5ndGggLSAxXSkpIHsKICAgIGxpbmVzLnBvcCgpOwogIH0KICByZXR1cm4gbGluZXMuam9pbignXG4nKTsKfQoKZnVuY3Rpb24gaW5kZW50Q29kZSh0ZXh0LCBzcGFjZUNvdW50KSB7CiAgdmFyIGxpbmVzID0gdGV4dC5zcGxpdCgnXG4nKSwKICAgIGluZGVudCA9ICcnLAogICAgZml4ZWRMaW5lcyA9IFtdOwoKICB3aGlsZShzcGFjZUNvdW50LS0pIGluZGVudCArPSAnICc7CgogIGxpbmVzLmZvckVhY2goZnVuY3Rpb24obGluZSkgewogICAgZml4ZWRMaW5lcy5wdXNoKGluZGVudCArIGxpbmUpOwogIH0pOwoKICByZXR1cm4gZml4ZWRMaW5lcy5qb2luKCdcbicpOwp9CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCmZ1bmN0aW9uIG1lcmdlKGRvY3MpewogIHZhciBieUZ1bGxJZCA9IHt9OwoKICBkb2NzLmZvckVhY2goZnVuY3Rpb24oZG9jKSB7CiAgICBieUZ1bGxJZFtkb2Muc2VjdGlvbiArICcvJyArIGRvYy5pZF0gPSBkb2M7CiAgfSk7CgogIGZvcih2YXIgaSA9IDA7IGkgPCBkb2NzLmxlbmd0aDspIHsKICAgIHZhciBkb2MgPSBkb2NzW2ldOwoKICAgIC8vIGNoZWNrIGxpbmtzIC0gZG8gdGhleSBleGlzdCA/CiAgICBkb2MubGlua3MuZm9yRWFjaChmdW5jdGlvbihsaW5rKSB7CiAgICAgIC8vIGNvbnZlcnQgI2lkIHRvIHBhdGgjaWQKICAgICAgaWYgKGxpbmtbMF0gPT0gJyMnKSB7CiAgICAgICAgbGluayA9IGRvYy5zZWN0aW9uICsgJy8nICsgZG9jLmlkLnNwbGl0KCcjJykuc2hpZnQoKSArIGxpbms7CiAgICAgIH0KICAgICAgbGluayA9IGxpbmsuc3BsaXQoJyMnKS5zaGlmdCgpOwogICAgICBpZiAoIWJ5RnVsbElkW2xpbmtdKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1dBUk5JTkc6IEluICcgKyBkb2Muc2VjdGlvbiArICcvJyArIGRvYy5pZCArICcsIG5vbiBleGlzdGluZyBsaW5rOiAiJyArIGxpbmsgKyAnIicpOwogICAgICB9CiAgICB9KTsKCiAgICAvLyBtZXJnZSBpbnRvIHBhcmVudHMKICAgIGlmIChmaW5kUGFyZW50KGRvYywgJ21ldGhvZCcpIHx8IGZpbmRQYXJlbnQoZG9jLCAncHJvcGVydHknKSB8fCBmaW5kUGFyZW50KGRvYywgJ2V2ZW50JykpIHsKICAgICAgZG9jcy5zcGxpY2UoaSwgMSk7CiAgICB9IGVsc2UgewogICAgICBpKys7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBmaW5kUGFyZW50KGRvYywgbmFtZSkgewogICAgdmFyIHBhcmVudE5hbWUgPSBkb2NbbmFtZSArICdPZiddOwogICAgaWYgKCFwYXJlbnROYW1lKSByZXR1cm4gZmFsc2U7CgogICAgdmFyIHBhcmVudCA9IGJ5RnVsbElkW2RvYy5zZWN0aW9uICsgJy8nICsgcGFyZW50TmFtZV07CiAgICBpZiAoIXBhcmVudCkKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBwYXJlbnQgbmFtZWQgJyIgKyBwYXJlbnROYW1lICsgIicgZm9yICciICsKICAgICAgICBkb2MubmFtZSArICInIGluIEAiICsgbmFtZSArICJPZi4iKTsKCiAgICB2YXIgbGlzdE5hbWUgPSAobmFtZSArICdzJykucmVwbGFjZSgveXMkLywgJ2llcycpOwogICAgdmFyIGxpc3QgPSBwYXJlbnRbbGlzdE5hbWVdID0gKHBhcmVudFtsaXN0TmFtZV0gfHwgW10pOwogICAgbGlzdC5wdXNoKGRvYyk7CiAgICBsaXN0LnNvcnQob3JkZXJCeU5hbWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBvcmRlckJ5TmFtZShhLCBiKXsKICAgIHJldHVybiBhLm5hbWUgPCBiLm5hbWUgPyAtMSA6IChhLm5hbWUgPiBiLm5hbWUgPyAxIDogMCk7CiAgfQp9Ci8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCmZ1bmN0aW9uIHByb3BlcnR5KG5hbWUpIHsKICByZXR1cm4gZnVuY3Rpb24odmFsdWUpewogICAgcmV0dXJuIHZhbHVlW25hbWVdOwogIH07Cn0KCgp2YXIgREFTSF9DQVNFX1JFR0VYUCA9IC9bQS1aXS9nOwpmdW5jdGlvbiBkYXNoQ2FzZShuYW1lKXsKICByZXR1cm4gbmFtZS5yZXBsYWNlKERBU0hfQ0FTRV9SRUdFWFAsIGZ1bmN0aW9uKGxldHRlciwgcG9zKSB7CiAgICByZXR1cm4gKHBvcyA/ICctJyA6ICcnKSArIGxldHRlci50b0xvd2VyQ2FzZSgpOwogIH0pOwp9Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 02:16:46 GMT",
                    "Content-Length": "31831",
                    "Date": "Fri, 07 Nov 2014 02:16:54 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}