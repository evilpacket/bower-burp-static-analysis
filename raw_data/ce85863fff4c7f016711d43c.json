{
    "url": "http://localhost:9999/oyvindkinsey/easyXDM/src/tests/tests.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.href</b> via the following statements:<ul><li>var remote = location.href;</li><li>location.href = remote.replace(\"provider\", \"consumer\");</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/oyvindkinsey/easyXDM/src/tests/tests.js",
                "path": "/oyvindkinsey/easyXDM/src/tests/tests.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9veXZpbmRraW5zZXkvZWFzeVhETS9zcmMvdGVzdHMvdGVzdHMuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMzE5MTMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMjI6MjM6MTIgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDIyOjIzOjExIEdNVA0KDQovKmpzbGludCBldmlsOiB0cnVlLCBicm93c2VyOiB0cnVlLCBpbW1lZDogdHJ1ZSwgcGFzc2ZhaWw6IHRydWUsIHVuZGVmOiB0cnVlLCBuZXdjYXA6IHRydWUqLwovKmdsb2JhbCBlYXN5VGVzdCwgZWFzeVhETSwgd2luZG93LCBtb2R1bGVzKi8KdmFyIFJFTU9URSA9IChmdW5jdGlvbigpewogICAgdmFyIHJlbW90ZSA9IGxvY2F0aW9uLmhyZWY7CiAgICBzd2l0Y2ggKGxvY2F0aW9uLmhvc3QpIHsKICAgICAgICBjYXNlICJwcm92aWRlci5lYXN5eGRtLm5ldCI6CiAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSByZW1vdGUucmVwbGFjZSgicHJvdmlkZXIiLCAiY29uc3VtZXIiKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZWFzeXhkbS5uZXQiOgogICAgICAgICAgICByZW1vdGUgPSByZW1vdGUucmVwbGFjZSgiZWFzeXhkbS5uZXQiLCAiY29uc3VtZXIuZWFzeXhkbS5uZXQiKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY29uc3VtZXIuZWFzeXhkbS5uZXQiOgogICAgICAgICAgICByZW1vdGUgPSByZW1vdGUucmVwbGFjZSgiY29uc3VtZXIiLCAicHJvdmlkZXIiKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAieGRtMSI6CiAgICAgICAgICAgIHJlbW90ZSA9IHJlbW90ZS5yZXBsYWNlKCJ4ZG0xIiwgInhkbTIiKTsKICAgICAgICAgICAgYnJlYWs7CiAgICB9CiAgICByZXR1cm4gcmVtb3RlLnN1YnN0cmluZygwLCByZW1vdGUubGFzdEluZGV4T2YoIi8iKSk7Cn0oKSk7Cgp2YXIgTE9DQUwgPSBsb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyBsb2NhdGlvbi5ob3N0ICsgbG9jYXRpb24ucGF0aG5hbWUuc3Vic3RyaW5nKDAsIGxvY2F0aW9uLnBhdGhuYW1lLmxhc3RJbmRleE9mKCIvIikpOwoKZnVuY3Rpb24gcnVuVGVzdHMoKXsKICAgIHZhciBpID0gMDsKICAgIGVhc3lUZXN0LnRlc3QoWy8qKlRlc3RzIGZvciB0aGUgcHJlc2VuY2Ugb2YgbmFtZXNwYWNlcyBhbmQgY2xhc3NlcyovewogICAgICAgIG5hbWU6ICJDaGVjayB0aGF0IHRoZSBsaWJyYXJ5IGlzIGNvbXBsZXRlIiwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETSIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGlmICh0aGlzLkFzc2VydC5pc09iamVjdChlYXN5WERNKSAmJiB0aGlzLkFzc2VydC5pc1N0cmluZyhlYXN5WERNLnZlcnNpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2coImZvdW5kIGVhc3lYRE0sIHZlcnNpb249IiArIGVhc3lYRE0udmVyc2lvbik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0uRG9tSGVscGVyIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzT2JqZWN0KGVhc3lYRE0uRG9tSGVscGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5Tb2NrZXQiLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Bc3NlcnQuaXNGdW5jdGlvbihlYXN5WERNLlNvY2tldCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0uUnBjIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5ScGMpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiY2hlY2sgZm9yIHRoZSBwcmVzZW5jZSBvZiBlYXN5WERNLnN0YWNrIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzT2JqZWN0KGVhc3lYRE0uc3RhY2spOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiY2hlY2sgZm9yIHRoZSBwcmVzZW5jZSBvZiBlYXN5WERNLnN0YWNrLlNhbWVPcmlnaW5UcmFuc3BvcnQiLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Bc3NlcnQuaXNGdW5jdGlvbihlYXN5WERNLnN0YWNrLlNhbWVPcmlnaW5UcmFuc3BvcnQpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiY2hlY2sgZm9yIHRoZSBwcmVzZW5jZSBvZiBlYXN5WERNLnN0YWNrLlBvc3RNZXNzYWdlVHJhbnNwb3J0IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5zdGFjay5Qb3N0TWVzc2FnZVRyYW5zcG9ydCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0uc3RhY2suRmxhc2hUcmFuc3BvcnQiLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Bc3NlcnQuaXNGdW5jdGlvbihlYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5zdGFjay5OYW1lVHJhbnNwb3J0IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5zdGFjay5OYW1lVHJhbnNwb3J0KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5zdGFjay5IYXNoVHJhbnNwb3J0IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5zdGFjay5IYXNoVHJhbnNwb3J0KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5zdGFjay5SZWxpYWJsZUJlaGF2aW9yIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5zdGFjay5SZWxpYWJsZUJlaGF2aW9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5zdGFjay5RdWV1ZUJlaGF2aW9yIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5zdGFjay5RdWV1ZUJlaGF2aW9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5zdGFjay5WZXJpZnlCZWhhdmlvciIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc0Z1bmN0aW9uKGVhc3lYRE0uc3RhY2suVmVyaWZ5QmVoYXZpb3IpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiY2hlY2sgZm9yIHRoZSBwcmVzZW5jZSBvZiBlYXN5WERNLnN0YWNrLlJwY0JlaGF2aW9yIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5zdGFjay5ScGNCZWhhdmlvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJDaGVjayBoZWxwZXIgZnVuY3Rpb25zIiwKICAgICAgICBydW5JZjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmhyZWYuaW5kZXhPZigiL3NyYy8iKSA9PSAtMSkgewogICAgICAgICAgICAgICAgcmV0dXJuICJUaGlzIGNhbiBvbmx5IGJlIHJ1biBpbiBkZXZlbG9wbWVudC4iOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy51cmwxID0gImh0dHA6Ly9mb28uYmFyL2EvYi9jP2Q9ZSNmIjsKICAgICAgICAgICAgdGhpcy51cmwyID0gImh0dHA6Ly9mb28uYmFyOjgwL2EvYi9jP2Q9ZSNmIjsKICAgICAgICAgICAgdGhpcy51cmwzID0gImh0dHA6Ly9mb28uYmFyOjg4L2EvYi9jP2Q9ZSNmIjsKICAgICAgICAgICAgdGhpcy51cmw0ID0gImhUdHA6Ly9Gb28uQmFyOjg4L2EvYi9jP2Q9ZSNmIjsKICAgICAgICAgICAgCiAgICAgICAgfSwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogImdldERvbWFpbk5hbWUiLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXR1cm4gZWFzeVhETS5nZXREb21haW5OYW1lKHRoaXMudXJsMSkgPT09ICJmb28uYmFyIjsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImdldExvY2F0aW9uIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIGVhc3lYRE0uZ2V0TG9jYXRpb24odGhpcy51cmwxKSA9PT0gImh0dHA6Ly9mb28uYmFyIjsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImdldExvY2F0aW9uIHdpdGggc3RhbmRhcmQgcG9ydCIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiBlYXN5WERNLmdldExvY2F0aW9uKHRoaXMudXJsMikgPT09ICJodHRwOi8vZm9vLmJhciI7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJnZXRMb2NhdGlvbiB3aXRoIG5vbi1zdGFuZGFyZCBwb3J0IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIGVhc3lYRE0uZ2V0TG9jYXRpb24odGhpcy51cmwzKSA9PT0gImh0dHA6Ly9mb28uYmFyOjg4IjsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImdldExvY2F0aW9uIHdpdGggY2FwaXRhbHMiLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXR1cm4gZWFzeVhETS5nZXRMb2NhdGlvbih0aGlzLnVybDQpID09PSAiaHR0cDovL2Zvby5iYXI6ODgiOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiYXBwZW5kUXVlcnlQYXJhbWV0ZXJzIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIGVhc3lYRE0uYXBwZW5kUXVlcnlQYXJhbWV0ZXJzKHRoaXMudXJsMiwgewogICAgICAgICAgICAgICAgICAgIGc6ICJoIgogICAgICAgICAgICAgICAgfSkgPT09CiAgICAgICAgICAgICAgICAiaHR0cDovL2Zvby5iYXI6ODAvYS9iL2M/ZD1lJmc9aCNmIjsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogIkNoZWNrIHRoZSBBQ0wgZmVhdHVyZSIsCiAgICAgICAgcnVuSWY6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGlmIChsb2NhdGlvbi5ocmVmLmluZGV4T2YoIi9zcmMvIikgPT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVybiAiVGhpcyBjYW4gb25seSBiZSBydW4gaW4gZGV2ZWxvcG1lbnQuIjsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuYWNsID0gWyJodHRwOi8vd3d3LmRvbWFpbi5pbnZhbGlkIiwgIiouZG9tYWluYS5jb20iLCAiaHR0cDovL2RvbT9pbmIuY29tIiwgIl5odHRwOi8vZG9tY3szfWFpblxcLmNvbSQiXTsKICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAiTWF0Y2ggY29tcGxldGUgc3RyaW5nIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIGVhc3lYRE0uY2hlY2tBY2wodGhpcy5hY2wsICJodHRwOi8vd3d3LmRvbWFpbi5pbnZhbGlkIik7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJNYXRjaCAqIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIGVhc3lYRE0uY2hlY2tBY2wodGhpcy5hY2wsICJodHRwOi8vd3d3LmRvbWFpbmEuY29tIik7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJNYXRjaCA/IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIGVhc3lYRE0uY2hlY2tBY2wodGhpcy5hY2wsICJodHRwOi8vZG9tYWluYi5jb20iKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIk1hdGNoIFJlZ0V4cCIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiBlYXN5WERNLmNoZWNrQWNsKHRoaXMuYWNsLCAiaHR0cDovL2RvbWNjY2Fpbi5jb20iKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIk5vIG1hdGNoIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuICFlYXN5WERNLmNoZWNrQWNsKHRoaXMuYWNsLCAiaHR0cDovL2Zvby5jb20iKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7U2FtZU9yaWdpblRyYW5zcG9ydH0iLAogICAgICAgIHNldFVwOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLmV4cGVjdGVkTWVzc2FnZSA9ICsraSArICJfYWJjZDEyMzQlQMKkLyI7CiAgICAgICAgfSwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogIm9uUmVhZHkgaXMgZmlyZWQiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VzID0gMDsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbmV3IGVhc3lYRE0uU29ja2V0KHsKICAgICAgICAgICAgICAgICAgICBwcm90b2NvbDogIjQiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogTE9DQUwgKyAiL3Rlc3RfdHJhbnNwb3J0Lmh0bWwiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsrbWVzc2FnZXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2siLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJkZXN0cm95IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgcmV0dXJuICgoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpLmxlbmd0aCA9PT0gMCkpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAidGVzdCBlYXN5WERNLlNvY2tldHtQb3N0TWVzc2FnZVRyYW5zcG9ydH0iLAogICAgICAgIHJ1bklmOiBmdW5jdGlvbigpewogICAgICAgICAgICBpZiAoISgicG9zdE1lc3NhZ2UiIGluIHdpbmRvdyB8fCAicG9zdE1lc3NhZ2UiIGluIGRvY3VtZW50KSkgewogICAgICAgICAgICAgICAgcmV0dXJuICJUaGlzIHRlc3QgcmVxdWlyZXMgdGhlIEhUTUw1IHBvc3RNZXNzYWdlIGludGVyZmFjZS4iOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBlYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICIxIiwKICAgICAgICAgICAgICAgICAgICBsb2NhbDogIi4uL25hbWUuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiBSRU1PVEUgKyAiL3Rlc3RfdHJhbnNwb3J0Lmh0bWwiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsrbWVzc2FnZXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2siLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJkZXN0cm95IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgcmV0dXJuICgoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpLmxlbmd0aCA9PT0gMCkpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAidGVzdCBlYXN5WERNLlNvY2tldHtGbGFzaFRyYW5zcG9ydH0iLAogICAgICAgIHNldFVwOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLmV4cGVjdGVkTWVzc2FnZSA9ICsraSArICJfYWJjZDEyMzQlQMKkLyI7CiAgICAgICAgfSwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogIm9uUmVhZHkgaXMgZmlyZWQiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VzID0gMDsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbmV3IGVhc3lYRE0uU29ja2V0KHsKICAgICAgICAgICAgICAgICAgICBwcm90b2NvbDogIjYiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICBzd2Y6IFJFTU9URSArICIvLi4vZWFzeXhkbS5zd2YiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsrbWVzc2FnZXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogImVtYmVkZGVkIiwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJtZXNzYWdlIGlzIGVjaG9lZCBiYWNrIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiZGVzdHJveSIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIHJldHVybiAoKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggPT09IDApKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7RnJhbWVFbGVtZW50VHJhbnNwb3J0fSIsCiAgICAgICAgcnVuSWY6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGlmICghKG5hdmlnYXRvci5wcm9kdWN0ID09PSAiR2Vja28iICYmICJmcmFtZUVsZW1lbnQiIGluIHdpbmRvdyAmJiAhKCJwb3N0TWVzc2FnZSIgaW4gd2luZG93KSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1dlYktpdCcpID09IC0xKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICJUaGlzIHRlc3QgcmVxdWlyZXMgYW4gb2xkZXIgR2Vja28gYnJvd3NlciBhbmQgdGhlIHByZXNlbmNlIG9mIHRoZSBmcmFtZUVsZW1lbnQgb2JqZWN0IjsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoewogICAgICAgICAgICAgICAgICAgIHByb3RvY29sOiAiNSIsCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiBSRU1PVEUgKyAiL3Rlc3RfdHJhbnNwb3J0Lmh0bWwiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsrbWVzc2FnZXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2siLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJkZXN0cm95IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgcmV0dXJuICgoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpLmxlbmd0aCA9PT0gMCkpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAidGVzdCBlYXN5WERNLlNvY2tldHtOYW1lVHJhbnNwb3J0fSIsCiAgICAgICAgZmFpbGVkTWVzc2FnZTogIlRoaXMgbWlnaHQgZmFpbCBpbiBtb2Rlcm4gYnJvd3NlcnMgZHVlIHRvIHJlc3RyaWN0aW9ucyBpbiByZWZlcmVuY2luZyBleGlzdGluZyB3aW5kb3dzIiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgdGVhckRvd246IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWZyYW1lIHN0aWxsIHByZXNlbnQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBlYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICIyIiwgLy8gVGhpcyBpcyBqdXN0IHRvIG92ZXJyaWRlIHRoZSBhdXRvbWF0aWMgc2VsZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgbG9jYWw6ICIuLi9uYW1lLmh0bWwiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICByZW1vdGVIZWxwZXI6IFJFTU9URSArICIvLi4vbmFtZS5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK21lc3NhZ2VzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbWJlZGRlZCIpLAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2siLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJ0ZXN0IGVhc3lYRE0uU29ja2V0e0hhc2hUcmFuc3BvcnR9IHVzaW5nIHdpbmRvdyIsCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHRlYXJEb3duOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5kZXN0cm95KCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlmcmFtZSBzdGlsbCBwcmVzZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoewogICAgICAgICAgICAgICAgICAgIHByb3RvY29sOiAiMCIsIC8vIFRoaXMgaXMganVzdCB0byBvdmVycmlkZSB0aGUgYXV0b21hdGljIHNlbGVjdGlvbgogICAgICAgICAgICAgICAgICAgIGxvY2FsOiB3aW5kb3csCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiBSRU1PVEUgKyAiL3Rlc3RfdHJhbnNwb3J0Lmh0bWwiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsrbWVzc2FnZXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVtYmVkZGVkIiksCiAgICAgICAgICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAibWVzc2FnZSBpcyBlY2hvZWQgYmFjayIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7SGFzaFRyYW5zcG9ydH0gd2l0aCBubyBibGFuayBsb2NhbCwgYXZhaWxhYmxlIGltYWdlIGFuZCByZXNpemUiLAogICAgICAgIGZhaWxlZE1lc3NhZ2U6ICJUaGlzIG1pZ2h0IGZhaWwgaW4gbW9kZXJuIGJyb3dzZXJzIGR1ZSB0byByZXN0cmljdGlvbnMgaW4gcmVmZXJlbmNpbmcgZXhpc3Rpbmcgd2luZG93cyIsCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICAgICAgdGhpcy5pbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgICAgICAgICAgdGhpcy5pbWcuc3JjID0gInMuZ2lmIjsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmltZyk7CiAgICAgICAgfSwKICAgICAgICB0ZWFyRG93bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmltZyk7CiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWZyYW1lIHN0aWxsIHByZXNlbnQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBlYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICIwIiwgLy8gVGhpcyBpcyBqdXN0IHRvIG92ZXJyaWRlIHRoZSBhdXRvbWF0aWMgc2VsZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiBSRU1PVEUgKyAiL3Rlc3RfdHJhbnNwb3J0Lmh0bWwiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsrbWVzc2FnZXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAibWVzc2FnZSBpcyBlY2hvZWQgYmFjayIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7SGFzaFRyYW5zcG9ydH0gd2l0aCBzLmdpZiBhbmQgcG9sbGluZyIsCiAgICAgICAgZmFpbGVkTWVzc2FnZTogIlRoaXMgbWlnaHQgZmFpbCBpbiBtb2Rlcm4gYnJvd3NlcnMgZHVlIHRvIHJlc3RyaWN0aW9ucyBpbiByZWZlcmVuY2luZyBleGlzdGluZyB3aW5kb3dzIiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgdGVhckRvd246IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWZyYW1lIHN0aWxsIHByZXNlbnQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBlYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICIwIiwgLy8gVGhpcyBpcyBqdXN0IHRvIG92ZXJyaWRlIHRoZSBhdXRvbWF0aWMgc2VsZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgbG9jYWw6ICJzLmdpZiIsCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiBSRU1PVEUgKyAiL3Rlc3RfdHJhbnNwb3J0Lmh0bWwiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsrbWVzc2FnZXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW1iZWRkZWQiKSwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJtZXNzYWdlIGlzIGVjaG9lZCBiYWNrIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAidGVzdCBlYXN5WERNLlNvY2tldHtIYXNoVHJhbnNwb3J0fSB3aXRoIGZyYWdtZW50YXRpb24gKDgxOTIpIiwKICAgICAgICBmYWlsZWRNZXNzYWdlOiAiVGhpcyBtaWdodCBmYWlsIGluIG1vZGVybiBicm93c2VycyBkdWUgdG8gcmVzdHJpY3Rpb25zIGluIHJlZmVyZW5jaW5nIGV4aXN0aW5nIHdpbmRvd3MiLAogICAgICAgIHNldFVwOiBmdW5jdGlvbigpewogICAgICAgICAgICB2YXIgaSA9IDExOwogICAgICAgICAgICB0aGlzLmV4cGVjdGVkTWVzc2FnZSA9ICJhYWFhIjsKICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgKz0gdGhpcy5leHBlY3RlZE1lc3NhZ2U7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHRlYXJEb3duOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5kZXN0cm95KCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlmcmFtZSBzdGlsbCBwcmVzZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBlYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICIwIiwgLy8gVGhpcyBpcyBqdXN0IHRvIG92ZXJyaWRlIHRoZSBhdXRvbWF0aWMgc2VsZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgbG9jYWw6ICIuLi9uYW1lLmh0bWwiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW1iZWRkZWQiKSwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJtZXNzYWdlIGlzIGVjaG9lZCBiYWNrIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAidGVzdCBlYXN5WERNLm5vQ29uZmxpY3Qge1NhbWVPcmlnaW5UcmFuc3BvcnR9IiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJ3aW5kb3cuZWFzeVhETSBpcyByZWxlYXNlZCB7bmFtZXNwYWNlfSIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5UmVzdWx0KHdpbmRvdy5lYXN5WERNLl90ZXN0X2dsb2JhbCAmJiAhbW9kdWxlcy5lYXN5WERNLl90ZXN0X2dsb2JhbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIHtuYW1lc3BhY2V9IiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBtb2R1bGVzLmVhc3lYRE0uU29ja2V0KHsKICAgICAgICAgICAgICAgICAgICBwcm90b2NvbDogIjQiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogTE9DQUwgKyAiL3Rlc3RfbmFtZXNwYWNlLmh0bWwiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCsrbWVzc2FnZXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2sge25hbWVzcGFjZX0iLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJkZXN0cm95IHtuYW1lc3BhY2V9IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgcmV0dXJuICgoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpLmxlbmd0aCA9PT0gMCkpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAidGVzdCBlYXN5WERNLlNvY2tldHt9IiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgdGVhckRvd246IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWZyYW1lIHN0aWxsIHByZXNlbnQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbmV3IGVhc3lYRE0uU29ja2V0KHsKICAgICAgICAgICAgICAgICAgICBsb2NhbDogIi4uL25hbWUuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgc3dmOiBSRU1PVEUgKyAiLy4uL2Vhc3l4ZG0uc3dmIiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IFJFTU9URSArICIvdGVzdF90cmFuc3BvcnQuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgb25NZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlLCBvcmlnaW4pewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQoKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAibWVzc2FnZSBpcyBlY2hvZWQgYmFjayIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7fSB1c2luZyBoYXNoIGZvciBwYXNzaW5nIGRhdGEiLAogICAgICAgIHNldFVwOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLmV4cGVjdGVkTWVzc2FnZSA9ICsraSArICJfYWJjZDEyMzQlQMKkLyI7CiAgICAgICAgfSwKICAgICAgICB0ZWFyRG93bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuZGVzdHJveSgpOwogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpZnJhbWUgc3RpbGwgcHJlc2VudCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogIm9uUmVhZHkgaXMgZmlyZWQiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoewogICAgICAgICAgICAgICAgICAgIGxvY2FsOiAiLi4vbmFtZS5odG1sIiwKICAgICAgICAgICAgICAgICAgICBzd2Y6IFJFTU9URSArICIvLi4vZWFzeXhkbS5zd2YiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sP2Zvbz1iYXIiLAogICAgICAgICAgICAgICAgICAgIGhhc2g6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgb25NZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlLCBvcmlnaW4pewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQoKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAibWVzc2FnZSBpcyBlY2hvZWQgYmFjayIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7fSB3aXRoIGJ1ZmZlcmluZyIsCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHRlYXJEb3duOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5kZXN0cm95KCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlmcmFtZSBzdGlsbCBwcmVzZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAiQnVmZmVyZWQgbWVzc2FnZXMgYXJlIHNlbnQiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoewogICAgICAgICAgICAgICAgICAgIGxvY2FsOiAiLi4vbmFtZS5odG1sIiwKICAgICAgICAgICAgICAgICAgICBzd2Y6IFJFTU9URSArICIvLi4vZWFzeXhkbS5zd2YiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCgoc2NvcGUuZXhwZWN0ZWRNZXNzYWdlID09PSBtZXNzYWdlKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJ0ZXN0IGVhc3lYRE0uU29ja2V0e30gd2l0aCBxdWVyeSBwYXJhbWV0ZXJzIiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgdGVhckRvd246IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWZyYW1lIHN0aWxsIHByZXNlbnQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbmV3IGVhc3lYRE0uU29ja2V0KHsKICAgICAgICAgICAgICAgICAgICBsb2NhbDogIi4uL25hbWUuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgc3dmOiBSRU1PVEUgKyAiLy4uL2Vhc3l4ZG0uc3dmIiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IFJFTU9URSArICIvdGVzdF90cmFuc3BvcnQuaHRtbD9hPWImYz1kI2ZvbyxmYWEiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2siLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJ0ZXN0IGVhc3lYRE0uUnBjIiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgdGVhckRvd246IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMucmVtb3RlLmRlc3Ryb3koKTsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWZyYW1lIHN0aWxsIHByZXNlbnQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlID0gbmV3IGVhc3lYRE0uUnBjKHsKICAgICAgICAgICAgICAgICAgICBsb2NhbDogIi4uL25hbWUuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgc3dmOiBSRU1PVEUgKyAiLy4uL2Vhc3l4ZG0uc3dmIiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IFJFTU9URSArICIvdGVzdF9ycGMuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlSGVscGVyOiBSRU1PVEUgKyAiLy4uL25hbWUuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW1iZWRkZWQiKSwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogewogICAgICAgICAgICAgICAgICAgICAgICB2b2lkTWV0aG9kOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmNNZXRob2Q6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIG5vbmV4aXN0ZW50OiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZWRQYXJhbXNNZXRob2Q6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVkUGFyYW1zOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGxvY2FsOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZvaWRDYWxsYmFjazogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBmdW5jdGlvbihtZXNzYWdlKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQoKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJ2b2lkIG1ldGhvZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlLnZvaWRNZXRob2QodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiYXN5bmMgbWV0aG9kIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlLmFzeW5jTWV0aG9kKHRoaXMuZXhwZWN0ZWRNZXNzYWdlLCBmdW5jdGlvbihtZXNzYWdlKXsKICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQoKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJyZWd1bGFyIG1ldGhvZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW90ZS5tZXRob2QodGhpcy5leHBlY3RlZE1lc3NhZ2UsIGZ1bmN0aW9uKG1lc3NhZ2UpewogICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCgoc2NvcGUuZXhwZWN0ZWRNZXNzYWdlID09PSBtZXNzYWdlKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIndpdGggZXJyb3IiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy5yZW1vdGUuZXJyb3IodGhpcy5leHBlY3RlZE1lc3NhZ2UsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlSZXN1bHQoZmFsc2UsICJzdWNjZXNzIGhhbmRsZXIgY2FsbGVkIik7CiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihtZXNzYWdlKXsKICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNhbGxpbmcgbm9uZXhpc3RlbnQgbWV0aG9kIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlLm5vbmV4aXN0ZW50KHRoaXMuZXhwZWN0ZWRNZXNzYWdlLCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5UmVzdWx0KGZhbHNlLCAic3VjY2VzcyBoYW5kbGVyIGNhbGxlZCIpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24obWVzc2FnZSl7CiAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJ1c2luZyBuYW1lZCBwYXJhbWV0ZXJzIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlLm5hbWVkUGFyYW1zTWV0aG9kKHsKICAgICAgICAgICAgICAgICAgICBtc2c6IHRoaXMuZXhwZWN0ZWRNZXNzYWdlCiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihtZXNzYWdlKXsKICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQoKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfV0pOwp9Cg==",
                "body": "Lypqc2xpbnQgZXZpbDogdHJ1ZSwgYnJvd3NlcjogdHJ1ZSwgaW1tZWQ6IHRydWUsIHBhc3NmYWlsOiB0cnVlLCB1bmRlZjogdHJ1ZSwgbmV3Y2FwOiB0cnVlKi8KLypnbG9iYWwgZWFzeVRlc3QsIGVhc3lYRE0sIHdpbmRvdywgbW9kdWxlcyovCnZhciBSRU1PVEUgPSAoZnVuY3Rpb24oKXsKICAgIHZhciByZW1vdGUgPSBsb2NhdGlvbi5ocmVmOwogICAgc3dpdGNoIChsb2NhdGlvbi5ob3N0KSB7CiAgICAgICAgY2FzZSAicHJvdmlkZXIuZWFzeXhkbS5uZXQiOgogICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gcmVtb3RlLnJlcGxhY2UoInByb3ZpZGVyIiwgImNvbnN1bWVyIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImVhc3l4ZG0ubmV0IjoKICAgICAgICAgICAgcmVtb3RlID0gcmVtb3RlLnJlcGxhY2UoImVhc3l4ZG0ubmV0IiwgImNvbnN1bWVyLmVhc3l4ZG0ubmV0Iik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImNvbnN1bWVyLmVhc3l4ZG0ubmV0IjoKICAgICAgICAgICAgcmVtb3RlID0gcmVtb3RlLnJlcGxhY2UoImNvbnN1bWVyIiwgInByb3ZpZGVyIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInhkbTEiOgogICAgICAgICAgICByZW1vdGUgPSByZW1vdGUucmVwbGFjZSgieGRtMSIsICJ4ZG0yIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgfQogICAgcmV0dXJuIHJlbW90ZS5zdWJzdHJpbmcoMCwgcmVtb3RlLmxhc3RJbmRleE9mKCIvIikpOwp9KCkpOwoKdmFyIExPQ0FMID0gbG9jYXRpb24ucHJvdG9jb2wgKyAiLy8iICsgbG9jYXRpb24uaG9zdCArIGxvY2F0aW9uLnBhdGhuYW1lLnN1YnN0cmluZygwLCBsb2NhdGlvbi5wYXRobmFtZS5sYXN0SW5kZXhPZigiLyIpKTsKCmZ1bmN0aW9uIHJ1blRlc3RzKCl7CiAgICB2YXIgaSA9IDA7CiAgICBlYXN5VGVzdC50ZXN0KFsvKipUZXN0cyBmb3IgdGhlIHByZXNlbmNlIG9mIG5hbWVzcGFjZXMgYW5kIGNsYXNzZXMqL3sKICAgICAgICBuYW1lOiAiQ2hlY2sgdGhhdCB0aGUgbGlicmFyeSBpcyBjb21wbGV0ZSIsCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0iLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5Bc3NlcnQuaXNPYmplY3QoZWFzeVhETSkgJiYgdGhpcy5Bc3NlcnQuaXNTdHJpbmcoZWFzeVhETS52ZXJzaW9uKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nKCJmb3VuZCBlYXN5WERNLCB2ZXJzaW9uPSIgKyBlYXN5WERNLnZlcnNpb24pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiY2hlY2sgZm9yIHRoZSBwcmVzZW5jZSBvZiBlYXN5WERNLkRvbUhlbHBlciIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc09iamVjdChlYXN5WERNLkRvbUhlbHBlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0uU29ja2V0IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5Tb2NrZXQpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiY2hlY2sgZm9yIHRoZSBwcmVzZW5jZSBvZiBlYXN5WERNLlJwYyIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc0Z1bmN0aW9uKGVhc3lYRE0uUnBjKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5zdGFjayIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc09iamVjdChlYXN5WERNLnN0YWNrKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5zdGFjay5TYW1lT3JpZ2luVHJhbnNwb3J0IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5zdGFjay5TYW1lT3JpZ2luVHJhbnNwb3J0KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5zdGFjay5Qb3N0TWVzc2FnZVRyYW5zcG9ydCIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc0Z1bmN0aW9uKGVhc3lYRE0uc3RhY2suUG9zdE1lc3NhZ2VUcmFuc3BvcnQpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiY2hlY2sgZm9yIHRoZSBwcmVzZW5jZSBvZiBlYXN5WERNLnN0YWNrLkZsYXNoVHJhbnNwb3J0IiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXNzZXJ0LmlzRnVuY3Rpb24oZWFzeVhETS5zdGFjay5GbGFzaFRyYW5zcG9ydCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0uc3RhY2suTmFtZVRyYW5zcG9ydCIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc0Z1bmN0aW9uKGVhc3lYRE0uc3RhY2suTmFtZVRyYW5zcG9ydCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0uc3RhY2suSGFzaFRyYW5zcG9ydCIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc0Z1bmN0aW9uKGVhc3lYRE0uc3RhY2suSGFzaFRyYW5zcG9ydCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0uc3RhY2suUmVsaWFibGVCZWhhdmlvciIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc0Z1bmN0aW9uKGVhc3lYRE0uc3RhY2suUmVsaWFibGVCZWhhdmlvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0uc3RhY2suUXVldWVCZWhhdmlvciIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc0Z1bmN0aW9uKGVhc3lYRE0uc3RhY2suUXVldWVCZWhhdmlvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGVhc3lYRE0uc3RhY2suVmVyaWZ5QmVoYXZpb3IiLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Bc3NlcnQuaXNGdW5jdGlvbihlYXN5WERNLnN0YWNrLlZlcmlmeUJlaGF2aW9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImNoZWNrIGZvciB0aGUgcHJlc2VuY2Ugb2YgZWFzeVhETS5zdGFjay5ScGNCZWhhdmlvciIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2VydC5pc0Z1bmN0aW9uKGVhc3lYRE0uc3RhY2suUnBjQmVoYXZpb3IpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAiQ2hlY2sgaGVscGVyIGZ1bmN0aW9ucyIsCiAgICAgICAgcnVuSWY6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGlmIChsb2NhdGlvbi5ocmVmLmluZGV4T2YoIi9zcmMvIikgPT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVybiAiVGhpcyBjYW4gb25seSBiZSBydW4gaW4gZGV2ZWxvcG1lbnQuIjsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMudXJsMSA9ICJodHRwOi8vZm9vLmJhci9hL2IvYz9kPWUjZiI7CiAgICAgICAgICAgIHRoaXMudXJsMiA9ICJodHRwOi8vZm9vLmJhcjo4MC9hL2IvYz9kPWUjZiI7CiAgICAgICAgICAgIHRoaXMudXJsMyA9ICJodHRwOi8vZm9vLmJhcjo4OC9hL2IvYz9kPWUjZiI7CiAgICAgICAgICAgIHRoaXMudXJsNCA9ICJoVHRwOi8vRm9vLkJhcjo4OC9hL2IvYz9kPWUjZiI7CiAgICAgICAgICAgIAogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJnZXREb21haW5OYW1lIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIGVhc3lYRE0uZ2V0RG9tYWluTmFtZSh0aGlzLnVybDEpID09PSAiZm9vLmJhciI7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJnZXRMb2NhdGlvbiIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiBlYXN5WERNLmdldExvY2F0aW9uKHRoaXMudXJsMSkgPT09ICJodHRwOi8vZm9vLmJhciI7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJnZXRMb2NhdGlvbiB3aXRoIHN0YW5kYXJkIHBvcnQiLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXR1cm4gZWFzeVhETS5nZXRMb2NhdGlvbih0aGlzLnVybDIpID09PSAiaHR0cDovL2Zvby5iYXIiOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiZ2V0TG9jYXRpb24gd2l0aCBub24tc3RhbmRhcmQgcG9ydCIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiBlYXN5WERNLmdldExvY2F0aW9uKHRoaXMudXJsMykgPT09ICJodHRwOi8vZm9vLmJhcjo4OCI7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJnZXRMb2NhdGlvbiB3aXRoIGNhcGl0YWxzIiwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmV0dXJuIGVhc3lYRE0uZ2V0TG9jYXRpb24odGhpcy51cmw0KSA9PT0gImh0dHA6Ly9mb28uYmFyOjg4IjsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImFwcGVuZFF1ZXJ5UGFyYW1ldGVycyIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiBlYXN5WERNLmFwcGVuZFF1ZXJ5UGFyYW1ldGVycyh0aGlzLnVybDIsIHsKICAgICAgICAgICAgICAgICAgICBnOiAiaCIKICAgICAgICAgICAgICAgIH0pID09PQogICAgICAgICAgICAgICAgImh0dHA6Ly9mb28uYmFyOjgwL2EvYi9jP2Q9ZSZnPWgjZiI7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJDaGVjayB0aGUgQUNMIGZlYXR1cmUiLAogICAgICAgIHJ1bklmOiBmdW5jdGlvbigpewogICAgICAgICAgICBpZiAobG9jYXRpb24uaHJlZi5pbmRleE9mKCIvc3JjLyIpID09IC0xKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIlRoaXMgY2FuIG9ubHkgYmUgcnVuIGluIGRldmVsb3BtZW50LiI7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldFVwOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLmFjbCA9IFsiaHR0cDovL3d3dy5kb21haW4uaW52YWxpZCIsICIqLmRvbWFpbmEuY29tIiwgImh0dHA6Ly9kb20/aW5iLmNvbSIsICJeaHR0cDovL2RvbWN7M31haW5cXC5jb20kIl07CiAgICAgICAgfSwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogIk1hdGNoIGNvbXBsZXRlIHN0cmluZyIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiBlYXN5WERNLmNoZWNrQWNsKHRoaXMuYWNsLCAiaHR0cDovL3d3dy5kb21haW4uaW52YWxpZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiTWF0Y2ggKiIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiBlYXN5WERNLmNoZWNrQWNsKHRoaXMuYWNsLCAiaHR0cDovL3d3dy5kb21haW5hLmNvbSIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiTWF0Y2ggPyIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiBlYXN5WERNLmNoZWNrQWNsKHRoaXMuYWNsLCAiaHR0cDovL2RvbWFpbmIuY29tIik7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJNYXRjaCBSZWdFeHAiLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICByZXR1cm4gZWFzeVhETS5jaGVja0FjbCh0aGlzLmFjbCwgImh0dHA6Ly9kb21jY2NhaW4uY29tIik7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJObyBtYXRjaCIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHJldHVybiAhZWFzeVhETS5jaGVja0FjbCh0aGlzLmFjbCwgImh0dHA6Ly9mb28uY29tIik7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJ0ZXN0IGVhc3lYRE0uU29ja2V0e1NhbWVPcmlnaW5UcmFuc3BvcnR9IiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBlYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICI0IiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IExPQ0FMICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK21lc3NhZ2VzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJtZXNzYWdlIGlzIGVjaG9lZCBiYWNrIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiZGVzdHJveSIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIHJldHVybiAoKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggPT09IDApKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7UG9zdE1lc3NhZ2VUcmFuc3BvcnR9IiwKICAgICAgICBydW5JZjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgaWYgKCEoInBvc3RNZXNzYWdlIiBpbiB3aW5kb3cgfHwgInBvc3RNZXNzYWdlIiBpbiBkb2N1bWVudCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAiVGhpcyB0ZXN0IHJlcXVpcmVzIHRoZSBIVE1MNSBwb3N0TWVzc2FnZSBpbnRlcmZhY2UuIjsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoewogICAgICAgICAgICAgICAgICAgIHByb3RvY29sOiAiMSIsCiAgICAgICAgICAgICAgICAgICAgbG9jYWw6ICIuLi9uYW1lLmh0bWwiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK21lc3NhZ2VzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJtZXNzYWdlIGlzIGVjaG9lZCBiYWNrIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiZGVzdHJveSIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIHJldHVybiAoKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggPT09IDApKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7Rmxhc2hUcmFuc3BvcnR9IiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBlYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICI2IiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IFJFTU9URSArICIvdGVzdF90cmFuc3BvcnQuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgc3dmOiBSRU1PVEUgKyAiLy4uL2Vhc3l4ZG0uc3dmIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK21lc3NhZ2VzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6ICJlbWJlZGRlZCIsCiAgICAgICAgICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAibWVzc2FnZSBpcyBlY2hvZWQgYmFjayIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImRlc3Ryb3kiLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gKChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoID09PSAwKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJ0ZXN0IGVhc3lYRE0uU29ja2V0e0ZyYW1lRWxlbWVudFRyYW5zcG9ydH0iLAogICAgICAgIHJ1bklmOiBmdW5jdGlvbigpewogICAgICAgICAgICBpZiAoIShuYXZpZ2F0b3IucHJvZHVjdCA9PT0gIkdlY2tvIiAmJiAiZnJhbWVFbGVtZW50IiBpbiB3aW5kb3cgJiYgISgicG9zdE1lc3NhZ2UiIGluIHdpbmRvdykgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdXZWJLaXQnKSA9PSAtMSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAiVGhpcyB0ZXN0IHJlcXVpcmVzIGFuIG9sZGVyIEdlY2tvIGJyb3dzZXIgYW5kIHRoZSBwcmVzZW5jZSBvZiB0aGUgZnJhbWVFbGVtZW50IG9iamVjdCI7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldFVwOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLmV4cGVjdGVkTWVzc2FnZSA9ICsraSArICJfYWJjZDEyMzQlQMKkLyI7CiAgICAgICAgfSwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogIm9uUmVhZHkgaXMgZmlyZWQiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VzID0gMDsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbmV3IGVhc3lYRE0uU29ja2V0KHsKICAgICAgICAgICAgICAgICAgICBwcm90b2NvbDogIjUiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK21lc3NhZ2VzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJtZXNzYWdlIGlzIGVjaG9lZCBiYWNrIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiZGVzdHJveSIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIHJldHVybiAoKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggPT09IDApKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7TmFtZVRyYW5zcG9ydH0iLAogICAgICAgIGZhaWxlZE1lc3NhZ2U6ICJUaGlzIG1pZ2h0IGZhaWwgaW4gbW9kZXJuIGJyb3dzZXJzIGR1ZSB0byByZXN0cmljdGlvbnMgaW4gcmVmZXJlbmNpbmcgZXhpc3Rpbmcgd2luZG93cyIsCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHRlYXJEb3duOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5kZXN0cm95KCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlmcmFtZSBzdGlsbCBwcmVzZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoewogICAgICAgICAgICAgICAgICAgIHByb3RvY29sOiAiMiIsIC8vIFRoaXMgaXMganVzdCB0byBvdmVycmlkZSB0aGUgYXV0b21hdGljIHNlbGVjdGlvbgogICAgICAgICAgICAgICAgICAgIGxvY2FsOiAiLi4vbmFtZS5odG1sIiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IFJFTU9URSArICIvdGVzdF90cmFuc3BvcnQuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlSGVscGVyOiBSRU1PVEUgKyAiLy4uL25hbWUuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgb25NZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlLCBvcmlnaW4pewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZXhwZWN0ZWRNZXNzYWdlID09PSBtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKyttZXNzYWdlcyA9PT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZW1iZWRkZWQiKSwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJtZXNzYWdlIGlzIGVjaG9lZCBiYWNrIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAidGVzdCBlYXN5WERNLlNvY2tldHtIYXNoVHJhbnNwb3J0fSB1c2luZyB3aW5kb3ciLAogICAgICAgIHNldFVwOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLmV4cGVjdGVkTWVzc2FnZSA9ICsraSArICJfYWJjZDEyMzQlQMKkLyI7CiAgICAgICAgfSwKICAgICAgICB0ZWFyRG93bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuZGVzdHJveSgpOwogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpZnJhbWUgc3RpbGwgcHJlc2VudCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogIm9uUmVhZHkgaXMgZmlyZWQiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VzID0gMDsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbmV3IGVhc3lYRE0uU29ja2V0KHsKICAgICAgICAgICAgICAgICAgICBwcm90b2NvbDogIjAiLCAvLyBUaGlzIGlzIGp1c3QgdG8gb3ZlcnJpZGUgdGhlIGF1dG9tYXRpYyBzZWxlY3Rpb24KICAgICAgICAgICAgICAgICAgICBsb2NhbDogd2luZG93LAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK21lc3NhZ2VzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlbWJlZGRlZCIpLAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2siLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJ0ZXN0IGVhc3lYRE0uU29ja2V0e0hhc2hUcmFuc3BvcnR9IHdpdGggbm8gYmxhbmsgbG9jYWwsIGF2YWlsYWJsZSBpbWFnZSBhbmQgcmVzaXplIiwKICAgICAgICBmYWlsZWRNZXNzYWdlOiAiVGhpcyBtaWdodCBmYWlsIGluIG1vZGVybiBicm93c2VycyBkdWUgdG8gcmVzdHJpY3Rpb25zIGluIHJlZmVyZW5jaW5nIGV4aXN0aW5nIHdpbmRvd3MiLAogICAgICAgIHNldFVwOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLmV4cGVjdGVkTWVzc2FnZSA9ICsraSArICJfYWJjZDEyMzQlQMKkLyI7CiAgICAgICAgICAgIHRoaXMuaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7CiAgICAgICAgICAgIHRoaXMuaW1nLnNyYyA9ICJzLmdpZiI7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5pbWcpOwogICAgICAgIH0sCiAgICAgICAgdGVhckRvd246IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5pbWcpOwogICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5kZXN0cm95KCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlmcmFtZSBzdGlsbCBwcmVzZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoewogICAgICAgICAgICAgICAgICAgIHByb3RvY29sOiAiMCIsIC8vIFRoaXMgaXMganVzdCB0byBvdmVycmlkZSB0aGUgYXV0b21hdGljIHNlbGVjdGlvbgogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK21lc3NhZ2VzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2siLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJ0ZXN0IGVhc3lYRE0uU29ja2V0e0hhc2hUcmFuc3BvcnR9IHdpdGggcy5naWYgYW5kIHBvbGxpbmciLAogICAgICAgIGZhaWxlZE1lc3NhZ2U6ICJUaGlzIG1pZ2h0IGZhaWwgaW4gbW9kZXJuIGJyb3dzZXJzIGR1ZSB0byByZXN0cmljdGlvbnMgaW4gcmVmZXJlbmNpbmcgZXhpc3Rpbmcgd2luZG93cyIsCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHRlYXJEb3duOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5kZXN0cm95KCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlmcmFtZSBzdGlsbCBwcmVzZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoewogICAgICAgICAgICAgICAgICAgIHByb3RvY29sOiAiMCIsIC8vIFRoaXMgaXMganVzdCB0byBvdmVycmlkZSB0aGUgYXV0b21hdGljIHNlbGVjdGlvbgogICAgICAgICAgICAgICAgICAgIGxvY2FsOiAicy5naWYiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZTogUkVNT1RFICsgIi90ZXN0X3RyYW5zcG9ydC5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK21lc3NhZ2VzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVtYmVkZGVkIiksCiAgICAgICAgICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAibWVzc2FnZSBpcyBlY2hvZWQgYmFjayIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7SGFzaFRyYW5zcG9ydH0gd2l0aCBmcmFnbWVudGF0aW9uICg4MTkyKSIsCiAgICAgICAgZmFpbGVkTWVzc2FnZTogIlRoaXMgbWlnaHQgZmFpbCBpbiBtb2Rlcm4gYnJvd3NlcnMgZHVlIHRvIHJlc3RyaWN0aW9ucyBpbiByZWZlcmVuY2luZyBleGlzdGluZyB3aW5kb3dzIiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdmFyIGkgPSAxMTsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSAiYWFhYSI7CiAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlICs9IHRoaXMuZXhwZWN0ZWRNZXNzYWdlOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB0ZWFyRG93bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuZGVzdHJveSgpOwogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpZnJhbWUgc3RpbGwgcHJlc2VudCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogIm9uUmVhZHkgaXMgZmlyZWQiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgZWFzeVhETS5Tb2NrZXQoewogICAgICAgICAgICAgICAgICAgIHByb3RvY29sOiAiMCIsIC8vIFRoaXMgaXMganVzdCB0byBvdmVycmlkZSB0aGUgYXV0b21hdGljIHNlbGVjdGlvbgogICAgICAgICAgICAgICAgICAgIGxvY2FsOiAiLi4vbmFtZS5odG1sIiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IFJFTU9URSArICIvdGVzdF90cmFuc3BvcnQuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgb25NZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlLCBvcmlnaW4pewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQoc2NvcGUuZXhwZWN0ZWRNZXNzYWdlID09PSBtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVtYmVkZGVkIiksCiAgICAgICAgICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAibWVzc2FnZSBpcyBlY2hvZWQgYmFjayIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LnBvc3RNZXNzYWdlKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5ub0NvbmZsaWN0IHtTYW1lT3JpZ2luVHJhbnNwb3J0fSIsCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAid2luZG93LmVhc3lYRE0gaXMgcmVsZWFzZWQge25hbWVzcGFjZX0iLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVJlc3VsdCh3aW5kb3cuZWFzeVhETS5fdGVzdF9nbG9iYWwgJiYgIW1vZHVsZXMuZWFzeVhETS5fdGVzdF9nbG9iYWwpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCB7bmFtZXNwYWNlfSIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQgPSBuZXcgbW9kdWxlcy5lYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICI0IiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IExPQ0FMICsgIi90ZXN0X25hbWVzcGFjZS5odG1sIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgrK21lc3NhZ2VzID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJtZXNzYWdlIGlzIGVjaG9lZCBiYWNrIHtuYW1lc3BhY2V9IiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiZGVzdHJveSB7bmFtZXNwYWNlfSIsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIHJldHVybiAoKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggPT09IDApKTsKICAgICAgICAgICAgfQogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgbmFtZTogInRlc3QgZWFzeVhETS5Tb2NrZXR7fSIsCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHRlYXJEb3duOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5kZXN0cm95KCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlmcmFtZSBzdGlsbCBwcmVzZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBlYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgbG9jYWw6ICIuLi9uYW1lLmh0bWwiLAogICAgICAgICAgICAgICAgICAgIHN3ZjogUkVNT1RFICsgIi8uLi9lYXN5eGRtLnN3ZiIsCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiBSRU1PVEUgKyAiL3Rlc3RfdHJhbnNwb3J0Lmh0bWwiLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2siLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJ0ZXN0IGVhc3lYRE0uU29ja2V0e30gdXNpbmcgaGFzaCBmb3IgcGFzc2luZyBkYXRhIiwKICAgICAgICBzZXRVcDogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5leHBlY3RlZE1lc3NhZ2UgPSArK2kgKyAiX2FiY2QxMjM0JUDCpC8iOwogICAgICAgIH0sCiAgICAgICAgdGVhckRvd246IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0LmRlc3Ryb3koKTsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpZnJhbWUiKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWZyYW1lIHN0aWxsIHByZXNlbnQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RlcHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJvblJlYWR5IGlzIGZpcmVkIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbmV3IGVhc3lYRE0uU29ja2V0KHsKICAgICAgICAgICAgICAgICAgICBsb2NhbDogIi4uL25hbWUuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgc3dmOiBSRU1PVEUgKyAiLy4uL2Vhc3l4ZG0uc3dmIiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IFJFTU9URSArICIvdGVzdF90cmFuc3BvcnQuaHRtbD9mb289YmFyIiwKICAgICAgICAgICAgICAgICAgICBoYXNoOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSwgb3JpZ2luKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogIm1lc3NhZ2UgaXMgZWNob2VkIGJhY2siLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5wb3N0TWVzc2FnZSh0aGlzLmV4cGVjdGVkTWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9XQogICAgfSwgewogICAgICAgIG5hbWU6ICJ0ZXN0IGVhc3lYRE0uU29ja2V0e30gd2l0aCBidWZmZXJpbmciLAogICAgICAgIHNldFVwOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLmV4cGVjdGVkTWVzc2FnZSA9ICsraSArICJfYWJjZDEyMzQlQMKkLyI7CiAgICAgICAgfSwKICAgICAgICB0ZWFyRG93bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQuZGVzdHJveSgpOwogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpZnJhbWUgc3RpbGwgcHJlc2VudCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzdGVwczogW3sKICAgICAgICAgICAgbmFtZTogIkJ1ZmZlcmVkIG1lc3NhZ2VzIGFyZSBzZW50IiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNwb3J0ID0gbmV3IGVhc3lYRE0uU29ja2V0KHsKICAgICAgICAgICAgICAgICAgICBsb2NhbDogIi4uL25hbWUuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgc3dmOiBSRU1PVEUgKyAiLy4uL2Vhc3l4ZG0uc3dmIiwKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IFJFTU9URSArICIvdGVzdF90cmFuc3BvcnQuaHRtbCIsCiAgICAgICAgICAgICAgICAgICAgb25NZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlLCBvcmlnaW4pewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQoKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAidGVzdCBlYXN5WERNLlNvY2tldHt9IHdpdGggcXVlcnkgcGFyYW1ldGVycyIsCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHRlYXJEb3duOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLnRyYW5zcG9ydC5kZXN0cm95KCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlmcmFtZSBzdGlsbCBwcmVzZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zcG9ydCA9IG5ldyBlYXN5WERNLlNvY2tldCh7CiAgICAgICAgICAgICAgICAgICAgbG9jYWw6ICIuLi9uYW1lLmh0bWwiLAogICAgICAgICAgICAgICAgICAgIHN3ZjogUkVNT1RFICsgIi8uLi9lYXN5eGRtLnN3ZiIsCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiBSRU1PVEUgKyAiL3Rlc3RfdHJhbnNwb3J0Lmh0bWw/YT1iJmM9ZCNmb28sZmFhIiwKICAgICAgICAgICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIG9yaWdpbil7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCgoc2NvcGUuZXhwZWN0ZWRNZXNzYWdlID09PSBtZXNzYWdlKSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJtZXNzYWdlIGlzIGVjaG9lZCBiYWNrIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnQucG9zdE1lc3NhZ2UodGhpcy5leHBlY3RlZE1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBuYW1lOiAidGVzdCBlYXN5WERNLlJwYyIsCiAgICAgICAgc2V0VXA6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHRoaXMuZXhwZWN0ZWRNZXNzYWdlID0gKytpICsgIl9hYmNkMTIzNCVAwqQvIjsKICAgICAgICB9LAogICAgICAgIHRlYXJEb3duOiBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLnJlbW90ZS5kZXN0cm95KCk7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaWZyYW1lIikubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlmcmFtZSBzdGlsbCBwcmVzZW50Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0ZXBzOiBbewogICAgICAgICAgICBuYW1lOiAib25SZWFkeSBpcyBmaXJlZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW90ZSA9IG5ldyBlYXN5WERNLlJwYyh7CiAgICAgICAgICAgICAgICAgICAgbG9jYWw6ICIuLi9uYW1lLmh0bWwiLAogICAgICAgICAgICAgICAgICAgIHN3ZjogUkVNT1RFICsgIi8uLi9lYXN5eGRtLnN3ZiIsCiAgICAgICAgICAgICAgICAgICAgcmVtb3RlOiBSRU1PVEUgKyAiL3Rlc3RfcnBjLmh0bWwiLAogICAgICAgICAgICAgICAgICAgIHJlbW90ZUhlbHBlcjogUkVNT1RFICsgIi8uLi9uYW1lLmh0bWwiLAogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVtYmVkZGVkIiksCiAgICAgICAgICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICByZW1vdGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgdm9pZE1ldGhvZDoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jTWV0aG9kOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBub25leGlzdGVudDoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVkUGFyYW1zTWV0aG9kOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lZFBhcmFtczogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBsb2NhbDogewogICAgICAgICAgICAgICAgICAgICAgICB2b2lkQ2FsbGJhY2s6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogZnVuY3Rpb24obWVzc2FnZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAidm9pZCBtZXRob2QiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW90ZS52b2lkTWV0aG9kKHRoaXMuZXhwZWN0ZWRNZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImFzeW5jIG1ldGhvZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW90ZS5hc3luY01ldGhvZCh0aGlzLmV4cGVjdGVkTWVzc2FnZSwgZnVuY3Rpb24obWVzc2FnZSl7CiAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAicmVndWxhciBtZXRob2QiLAogICAgICAgICAgICB0aW1lb3V0OiA1MDAwLAogICAgICAgICAgICBydW46IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy5yZW1vdGUubWV0aG9kKHRoaXMuZXhwZWN0ZWRNZXNzYWdlLCBmdW5jdGlvbihtZXNzYWdlKXsKICAgICAgICAgICAgICAgICAgICBzY29wZS5ub3RpZnlSZXN1bHQoKHNjb3BlLmV4cGVjdGVkTWVzc2FnZSA9PT0gbWVzc2FnZSkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJ3aXRoIGVycm9yIiwKICAgICAgICAgICAgdGltZW91dDogNTAwMCwKICAgICAgICAgICAgcnVuOiBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3RlLmVycm9yKHRoaXMuZXhwZWN0ZWRNZXNzYWdlLCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5UmVzdWx0KGZhbHNlLCAic3VjY2VzcyBoYW5kbGVyIGNhbGxlZCIpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24obWVzc2FnZSl7CiAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KHRydWUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJjYWxsaW5nIG5vbmV4aXN0ZW50IG1ldGhvZCIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW90ZS5ub25leGlzdGVudCh0aGlzLmV4cGVjdGVkTWVzc2FnZSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeVJlc3VsdChmYWxzZSwgInN1Y2Nlc3MgaGFuZGxlciBjYWxsZWQiKTsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKG1lc3NhZ2UpewogICAgICAgICAgICAgICAgICAgIHNjb3BlLm5vdGlmeVJlc3VsdCh0cnVlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAidXNpbmcgbmFtZWQgcGFyYW1ldGVycyIsCiAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgIHJ1bjogZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW90ZS5uYW1lZFBhcmFtc01ldGhvZCh7CiAgICAgICAgICAgICAgICAgICAgbXNnOiB0aGlzLmV4cGVjdGVkTWVzc2FnZQogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24obWVzc2FnZSl7CiAgICAgICAgICAgICAgICAgICAgc2NvcGUubm90aWZ5UmVzdWx0KChzY29wZS5leHBlY3RlZE1lc3NhZ2UgPT09IG1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfV0KICAgIH1dKTsKfQo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 22:23:11 GMT",
                    "Content-Length": "31913",
                    "Date": "Thu, 06 Nov 2014 22:23:12 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}