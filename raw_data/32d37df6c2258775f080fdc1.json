{
    "url": "http://localhost:9999/MotifFramework/Motif/js/ui/motif.tabs.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location.hash</b> and written to <b>$()</b> via the following statement:<ul><li>elem = location.hash !== \"\" ? $(\"[href='\" + location.hash + \"']\") : false;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/MotifFramework/Motif/js/ui/motif.tabs.js",
                "path": "/MotifFramework/Motif/js/ui/motif.tabs.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9Nb3RpZkZyYW1ld29yay9Nb3RpZi9qcy91aS9tb3RpZi50YWJzLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTExMDUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMTY6MzI6MDUgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDE2OjMyOjA1IEdNVA0KDQovKiEKICogTW90aWYgVGFicyB2MC4yLjAgKDIwMTQtMDQtMzApCiAqIFJlcXVpcmVzIE1vdGlmIFJldmVhbAogKiBodHRwOi8vZ2V0bW90aWYuY29tCiAqIAogKiBAYXV0aG9yIEpvbmF0aGFuIFBhY2hlY28gPGpvbmF0aGFuQGxpZmVibHVlLmNvbT4KICogQHRvZG8gQXV0b2dlbmVyYXRlIFRhYnMgTmF2LCBhZGQgYmV0dGVyIEhpc3Rvcnkgc3VwcG9ydCwgYWRkIGJldHRlciBkb2NzCiAqLwooZnVuY3Rpb24gKCAkLCB3aW5kb3csIGRvY3VtZW50LCBNb3RpZiwgdW5kZWZpbmVkICkgewoKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAvKioKICAgICAqIEBtb2R1bGUgTW90aWYKICAgICAqIEBzdWJtb2R1bGUgYXBwcwogICAgICogQGNsYXNzIFRhYnMKICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICogQHBhcmFtIGVsZW0ge09iamVjdH0KICAgICAqIEBwYXJhbSBbdXNlck9wdGlvbnNdIHtPYmplY3R9CiAgICAgKi8KICAgIHZhciBUYWJzID0gZnVuY3Rpb24gKCBlbGVtLCB1c2VyT3B0aW9ucyApIHsKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBAcHJvcGVydHkgJGVsZW0KICAgICAgICAgICAgICogQHR5cGUgT2JqZWN0CiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0aGlzLiRlbGVtID0gJCggZWxlbSApOwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBlbGVtCiAgICAgICAgICAgICAqIEB0eXBlIE9iamVjdAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdGhpcy5lbGVtID0gdGhpcy4kZWxlbVswXTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgbG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24sCiAgICAgICAgJGRvY3VtZW50ID0gJCggZG9jdW1lbnQgKTsKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSBjb3VudGVyCiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgVGFicy5jb3VudGVyID0gMDsKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSBoYXNoQ2hhbmdlQm91bmQKICAgICAqIEB0eXBlIEJvb2xlYW4KICAgICAqLwogICAgVGFicy5oYXNoQ2hhbmdlQm91bmQgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSBvbkhhc2hDaGFuZ2UKICAgICAqIEB0eXBlIEJvb2xlYW4KICAgICAqLwogICAgVGFicy5vbkhhc2hDaGFuZ2UgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSBhbmltYXRpb25GcmFtZQogICAgICogQHR5cGUgQm9vbGVhbgogICAgICovCiAgICBUYWJzLmFuaW1hdGlvbkZyYW1lID0gdHlwZW9mIHdpbmRvdy5yZXF1ZXN0QW5pbUZyYW1lID09PSAiZnVuY3Rpb24iID8gdHJ1ZSA6IGZhbHNlOwoKICAgIFRhYnMucHJvdG90eXBlID0gewoKICAgICAgICAvKioKICAgICAgICAgKiBAcHJvcGVydHkgZGVmYXVsdHMKICAgICAgICAgKiBAdHlwZSBPYmplY3QKICAgICAgICAgKi8KICAgICAgICAiZGVmYXVsdHMiOiB7CiAgICAgICAgICAgICJhbmltYXRlIjogdHJ1ZSwKICAgICAgICAgICAgImNzc1RyYW5zaXRpb24iOiB0cnVlLAogICAgICAgICAgICAic3BlZWQiOiAzMDAsCiAgICAgICAgICAgICJlYXNpbmciOiAic3dpbmciLAogICAgICAgICAgICAiaGlzdG9yeSI6IGZhbHNlLAogICAgICAgICAgICAidGFic0dyb3VwIjogIi50YWJzX19zZWN0aW9uIiwKICAgICAgICAgICAgInJldmVhbE9wdGlvbnMiOiB7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJyYWRpbyIsCiAgICAgICAgICAgICAgICAiYWN0aXZlQ2xhc3MiOiAiaXMtY3VycmVudCIKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgaW5pdAogICAgICAgICAqIEBwYXJhbSBbdXNlck9wdGlvbnNdIHtPYmplY3R9CiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICAgICAqLwogICAgICAgICJpbml0IjogZnVuY3Rpb24gKCB1c2VyT3B0aW9ucyApIHsKICAgICAgICAgICAgaWYgKCAhdGhpcy4kZWxlbS5sZW5ndGggKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuaW5pdFZhcnMoIHVzZXJPcHRpb25zICk7CiAgICAgICAgICAgIHRoaXMuYmluZEV2ZW50cygpOwogICAgICAgICAgICB0aGlzLmluaXRSZXZlYWwoKTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgaW5pdFZhcnMKICAgICAgICAgKiBAcGFyYW0gW3VzZXJPcHRpb25zXSB7T2JqZWN0fQogICAgICAgICAqLwogICAgICAgICJpbml0VmFycyI6IGZ1bmN0aW9uICggdXNlck9wdGlvbnMgKSB7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHByb3BlcnR5IGNvbmZpZwogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMuY29uZmlnID0gdXNlck9wdGlvbnM7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHByb3BlcnR5IG1ldGFkYXRhCiAgICAgICAgICAgICAqIEB0eXBlIE9iamVjdAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdGhpcy5tZXRhZGF0YSA9IHRoaXMuJGVsZW0uZGF0YSgidGFicy1vcHRpb25zIik7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHByb3BlcnR5IG9wdGlvbnMKICAgICAgICAgICAgICogQHR5cGUgT2JqZWN0CiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCggdHJ1ZSwge30sIHRoaXMuZGVmYXVsdHMsIHRoaXMuY29uZmlnLCB0aGlzLm1ldGFkYXRhICk7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHByb3BlcnR5ICR0cmlnZ2VycwogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMuJHRyaWdnZXJzID0gdGhpcy5nYXRoZXJUcmlnZ2Vycy5jYWxsKCB0aGlzICk7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHByb3BlcnR5ICR0YWJzCiAgICAgICAgICAgICAqIEB0eXBlIE9iamVjdAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdGhpcy4kdGFicyA9IHRoaXMuJGVsZW0uZmluZCggdGhpcy5vcHRpb25zLnRhYnNHcm91cCApLmxlbmd0aCA/IHRoaXMuJGVsZW0uZmluZCggdGhpcy5vcHRpb25zLnRhYnNHcm91cCApIDogdGhpcy4kZWxlbS5maW5kKCJuYXYgKyAqIik7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHByb3BlcnR5IGdyb3VwCiAgICAgICAgICAgICAqIEB0eXBlIFN0cmluZwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdGhpcy5ncm91cCA9ICJ0YWJzLWdyb3VwLSIgKyBUYWJzLmNvdW50ZXI7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHByb3BlcnR5IGluaXRpYWxpemVkCiAgICAgICAgICAgICAqIEB0eXBlIEJvb2xlYW4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIGdhdGhlclRyaWdnZXJzCiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICAgICAqLwogICAgICAgICJnYXRoZXJUcmlnZ2VycyI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsZW0uZmluZCgibmF2IGEiKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIGJpbmRFdmVudHMKICAgICAgICAgKi8KICAgICAgICAiYmluZEV2ZW50cyI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgaWYgKCBzZWxmLm9wdGlvbnMuaGlzdG9yeSApIHsgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJGRvY3VtZW50Lm9uKCJyZXZlYWwvcXVldWUvZG9uZSIsIGZ1bmN0aW9uIHRhYnNJbml0aWFsaXplZCAoKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5pbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmICggIVRhYnMuaGFzaENoYW5nZUJvdW5kICkgeyAgICAgCiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9uaGFzaGNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hY3RpdmF0ZUZyb21VcmwuY2FsbCggc2VsZiApOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgVGFicy5oYXNoQ2hhbmdlQm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQG1ldGhvZCBhY3RpdmF0ZUZyb21VcmwKICAgICAgICAgKi8KICAgICAgICAiYWN0aXZhdGVGcm9tVXJsIjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZWxlbSwKICAgICAgICAgICAgICAgIGluc3RhbmNlOwoKICAgICAgICAgICAgaWYgKCAhVGFicy5vbkhhc2hDaGFuZ2UgKSB7CiAgICAgICAgICAgICAgICBUYWJzLm9uSGFzaENoYW5nZSA9IHRydWU7CiAgICAgICAgICAgICAgICBlbGVtID0gbG9jYXRpb24uaGFzaCAhPT0gIiIgPyAkKCJbaHJlZj0nIiArIGxvY2F0aW9uLmhhc2ggKyAiJ10iKSA6IGZhbHNlOwogICAgICAgICAgICAgICAgaW5zdGFuY2UgPSBlbGVtLmxlbmd0aCA/ICQuZGF0YSggZWxlbVswXSwgInJldmVhbCIgKSA6IGZhbHNlOwoKICAgICAgICAgICAgICAgIGlmICggaW5zdGFuY2UgKSB7CiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UucHJvY2Vzc1RyaWdnZXIuY2FsbCggaW5zdGFuY2UgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFRhYnMub25IYXNoQ2hhbmdlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBJbml0aWFsaXplIHRoZSBNb3RpZiBSZXZlYWwgcGx1Z2luIHdpdGggVGFiLXNwZWNpZmljIGNvbmZpZwogICAgICAgICAqIEBtZXRob2QgZ2F0aGVyVHJpZ2dlcnMKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICAgICAgICovCiAgICAgICAgImluaXRSZXZlYWwiOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuJHRyaWdnZXJzLnJldmVhbCggdGhpcy5jcmVhdGVSZXZlYWxDb25maWcoKSApOwoKICAgICAgICAgICAgVGFicy5jb3VudGVyICs9IDE7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogU3VwcGxlbWVudCBSZXZlYWwgb3B0aW9ucyBmb3IgVGFiLXNwZWNpZmljIHRhc2tzCiAgICAgICAgICogQG1ldGhvZCBjcmVhdGVSZXZlYWxDb25maWcKICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICAgICAgICovCiAgICAgICAgImNyZWF0ZVJldmVhbENvbmZpZyI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5vcHRpb25zLnJldmVhbE9wdGlvbnMudGFyZ2V0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2F0aGVyVGFyZ2V0cy5jYWxsKCB0aGlzICk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHNlbGYub3B0aW9ucy5yZXZlYWxPcHRpb25zLm9uSW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYucHJlcFRhYnMuY2FsbCggc2VsZiwgdGhpcyApOwogICAgICAgICAgICB9OwogICAgICAgICAgICBzZWxmLm9wdGlvbnMucmV2ZWFsT3B0aW9ucy5vblNob3cgPSBmdW5jdGlvbiAoIGVsZW0gKSB7CiAgICAgICAgICAgICAgICBpZiAoIHNlbGYub3B0aW9ucy5oaXN0b3J5ICkgewogICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlTG9jYXRpb24uY2FsbCggc2VsZiwgdGhpcyApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCBzZWxmLm9wdGlvbnMuYW5pbWF0ZSApIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmFuaW1hdGVUYWJzLmNhbGwoIHNlbGYsIHRoaXMgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgc2VsZi5vcHRpb25zLnJldmVhbE9wdGlvbnMuYmVmb3JlSGlkZSA9IGZ1bmN0aW9uICggZWxlbSApIHsKICAgICAgICAgICAgICAgIGlmICggc2VsZi5vcHRpb25zLmhpc3RvcnkgJiYgbG9jYXRpb24uaGFzaCA9PT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi51cGRhdGVMb2NhdGlvbi5jYWxsKCBzZWxmLCB0aGlzICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIHNlbGYub3B0aW9ucy5hbmltYXRlICkgewogICAgICAgICAgICAgICAgICAgIHNlbGYucHJlcFRyYW5zaXRpb24uY2FsbCggc2VsZiwgdGhpcyApOyAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gc2VsZi5vcHRpb25zLnJldmVhbE9wdGlvbnM7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQG1ldGhvZCBnYXRoZXJUYXJnZXRzCiAgICAgICAgICogQHJldHVybiB7QXJyYXl9CiAgICAgICAgICovCiAgICAgICAgImdhdGhlclRhcmdldHMiOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB0YXJnZXRzID0gW107CgogICAgICAgICAgICB0YXJnZXRzLnB1c2goICQoIHRoaXMuJGVsZW0uYXR0cigiaHJlZiIpICkgKTsKCiAgICAgICAgICAgIHJldHVybiB0YXJnZXRzOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgcHJlcFRhYnMKICAgICAgICAgKi8KICAgICAgICAicHJlcFRhYnMiOiBmdW5jdGlvbiAoIGluc3RhbmNlICkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICBzZWxmLmNyZWF0ZUdyb3VwLmNhbGwoIHNlbGYsIGluc3RhbmNlICk7CiAgICAgICAgICAgIHNlbGYuZ2V0Q3VycmVudFRhYi5jYWxsKCBzZWxmLCBpbnN0YW5jZSApOwoKICAgICAgICAgICAgaWYgKCBzZWxmLm9wdGlvbnMuYW5pbWF0ZSApIHsKICAgICAgICAgICAgICAgIGlmICggc2VsZi5vcHRpb25zLmNzc1RyYW5zaXRpb24gKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAhc2VsZi4kdGFicy5oYXNDbGFzcygidHJhbnNpdGlvbi1ib3VuZCIpICkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRyYW5zaXRpb25FbmRDc3MoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNlbGYuJHRhYnMuYWRkQ2xhc3MoIm5vLXRyYW5zaXRpb24iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgY3JlYXRlR3JvdXAKICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBpZGVudGlmeWluZyBncm91cCBuYW1lCiAgICAgICAgICovCiAgICAgICAgImNyZWF0ZUdyb3VwIjogZnVuY3Rpb24gKCBpbnN0YW5jZSApIHsKICAgICAgICAgICAgaW5zdGFuY2UuZ3JvdXAgPSB0aGlzLmdyb3VwOwogICAgICAgICAgICBpbnN0YW5jZS51cGRhdGVSZWZlcmVuY2UuY2FsbCggaW5zdGFuY2UgKTsKCiAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZS5ncm91cDsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIGdldEN1cnJlbnRUYWIKICAgICAgICAgKi8KICAgICAgICAiZ2V0Q3VycmVudFRhYiI6IGZ1bmN0aW9uICggaW5zdGFuY2UgKSB7CiAgICAgICAgICAgIHZhciBxdWV1ZSA9IHdpbmRvdy5SZXZlYWwucXVldWUsCiAgICAgICAgICAgICAgICBncm91cHMgPSB3aW5kb3cuUmV2ZWFsLmdyb3VwcywKICAgICAgICAgICAgICAgIGZpcnN0VHJpZ2dlciA9IGdyb3Vwc1sgaW5zdGFuY2UuZ3JvdXAgXS50cmlnZ2Vyc1sgMCBdOwoKICAgICAgICAgICAgaWYgKCB0aGlzLm9wdGlvbnMuaGlzdG9yeSAmJiBsb2NhdGlvbi5oYXNoID09PSBpbnN0YW5jZS4kZWxlbS5hdHRyKCJocmVmIikgKSB7CiAgICAgICAgICAgICAgICBpZiAoICQuaW5BcnJheSggZmlyc3RUcmlnZ2VyLCBxdWV1ZSApID4gLTEgKSB7CiAgICAgICAgICAgICAgICAgICAgcXVldWUuc3BsaWNlKCAkLmluQXJyYXkoIGluc3RhbmNlLmlkZW50aXR5LCBxdWV1ZSApLCAxICk7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LlJldmVhbC5xdWV1ZSA9IHF1ZXVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5zdGFuY2Uuc2V0Q3VycmVudCgpOwoKICAgICAgICAgICAgfSBlbHNlIGlmICggaW5zdGFuY2UuaWRlbnRpdHkgPT09IGZpcnN0VHJpZ2dlciApIHsKICAgICAgICAgICAgICAgIGluc3RhbmNlLnNldEN1cnJlbnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgdHJhbnNpdGlvbkVuZENzcwogICAgICAgICAqLwogICAgICAgICJ0cmFuc2l0aW9uRW5kQ3NzIjogZnVuY3Rpb24gKCBlICkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICBzZWxmLiR0YWJzLm9uKCJ3ZWJraXRUcmFuc2l0aW9uRW5kIG90cmFuc2l0aW9uZW5kIG9UcmFuc2l0aW9uRW5kIG1zVHJhbnNpdGlvbkVuZCB0cmFuc2l0aW9uZW5kIiwgZnVuY3Rpb24gYWZ0ZXJBbmltYXRlVGFicyAoIGUgKSB7CgogICAgICAgICAgICAgICAgaWYgKCBlLm9yaWdpbmFsRXZlbnQudGFyZ2V0ID09PSBzZWxmLiR0YWJzWyAwIF0gKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi4kdGFicy5yZW1vdmVBdHRyKCJzdHlsZSIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSkuYWRkQ2xhc3MoInRyYW5zaXRpb24tYm91bmQiKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIHByZXBUcmFuc2l0aW9uCiAgICAgICAgICovCiAgICAgICAgInByZXBUcmFuc2l0aW9uIjogZnVuY3Rpb24gKCBpbnN0YW5jZSApIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRUYWIgPSBpbnN0YW5jZS5yZWZlcmVuY2UudGFyZ2V0c1swXSwKICAgICAgICAgICAgICAgIHRhYnNTdHlsZSA9IHRoaXMuJHRhYnMuYXR0cigic3R5bGUiKTsKCiAgICAgICAgICAgIGlmICggIXRhYnNTdHlsZSApIHsKICAgICAgICAgICAgICAgIHRoaXMuJHRhYnMub3V0ZXJIZWlnaHQoIGN1cnJlbnRUYWIub3V0ZXJIZWlnaHQoKSApOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQG1ldGhvZCB1cGRhdGVMb2NhdGlvbgogICAgICAgICAqLwogICAgICAgICJ1cGRhdGVMb2NhdGlvbiI6IGZ1bmN0aW9uICggaW5zdGFuY2UgKSB7CiAgICAgICAgICAgIGlmICggdGhpcy5pbml0aWFsaXplZCAmJiAhVGFicy5vbkhhc2hDaGFuZ2UgKSB7CiAgICAgICAgICAgICAgICBUYWJzLm9uSGFzaENoYW5nZSA9IHRydWU7CiAgICAgICAgICAgICAgICBsb2NhdGlvbi5oYXNoID0gaW5zdGFuY2UuJGVsZW0uYXR0cigiaHJlZiIpOwogICAgICAgICAgICAgICAgVGFicy5vbkhhc2hDaGFuZ2UgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgYW5pbWF0ZVRhYnMKICAgICAgICAgKi8KICAgICAgICAiYW5pbWF0ZVRhYnMiOiBmdW5jdGlvbiAoIGluc3RhbmNlICkgewogICAgICAgICAgICB2YXIgY3VycmVudFRhYiA9IGluc3RhbmNlLnJlZmVyZW5jZS50YXJnZXRzWyAwIF0sCiAgICAgICAgICAgICAgICBjdXJyZW50VGFiSGVpZ2h0ID0gY3VycmVudFRhYi5vdXRlckhlaWdodCgpOwoKICAgICAgICAgICAgaWYgKCB0aGlzLm9wdGlvbnMuY3NzVHJhbnNpdGlvbiApIHsKICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0ZVRhYnNDc3MoIGN1cnJlbnRUYWJIZWlnaHQgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuYW5pbWF0ZVRhYnNKcyggY3VycmVudFRhYkhlaWdodCApOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQG1ldGhvZCBhbmltYXRlVGFic0NzcwogICAgICAgICAqLwogICAgICAgICJhbmltYXRlVGFic0NzcyI6IGZ1bmN0aW9uICggY3VycmVudFRhYkhlaWdodCApIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgaWYgKCBzZWxmLiR0YWJzLm91dGVySGVpZ2h0KCkgIT09IGN1cnJlbnRUYWJIZWlnaHQgKSB7CiAgICAgICAgICAgICAgICBpZiAoIFRhYnMuYW5pbWF0aW9uRnJhbWUgKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1GcmFtZSggZnVuY3Rpb24gc2V0VGFic0hlaWdodCAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuJHRhYnMub3V0ZXJIZWlnaHQoIGN1cnJlbnRUYWJIZWlnaHQgKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLiR0YWJzLm91dGVySGVpZ2h0KCBjdXJyZW50VGFiSGVpZ2h0ICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWxmLiR0YWJzLnJlbW92ZUF0dHIoInN0eWxlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIGFuaW1hdGVUYWJzSnMKICAgICAgICAgKi8KICAgICAgICAiYW5pbWF0ZVRhYnNKcyI6IGZ1bmN0aW9uICggY3VycmVudFRhYkhlaWdodCApIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi4kdGFicy5zdG9wKCkuYW5pbWF0ZSh7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IGN1cnJlbnRUYWJIZWlnaHQKICAgICAgICAgICAgfSwgc2VsZi5vcHRpb25zLnNwZWVkLCBzZWxmLm9wdGlvbnMuZWFzaW5nLCBmdW5jdGlvbiBhZnRlckFuaW1hdGVUYWJzSnMgKCkgewogICAgICAgICAgICAgICAgc2VsZi4kdGFicy5yZW1vdmVBdHRyKCJzdHlsZSIpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIFRhYnMuZGVmYXVsdHMgPSBUYWJzLnByb3RvdHlwZS5kZWZhdWx0czsKCiAgICBNb3RpZi5hcHBzLlRhYnMgPSBUYWJzOwoKfSggalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50LCB3aW5kb3cuTW90aWYgPSB3aW5kb3cuTW90aWYgfHwgewogICAgInV0aWxzIjoge30sCiAgICAiYXBwcyI6IHt9Cn0gKSApOwoKJC5jcmVhdGVQbHVnaW4oICJ0YWJzIiwgd2luZG93Lk1vdGlmLmFwcHMuVGFicyApOw==",
                "body": "LyohCiAqIE1vdGlmIFRhYnMgdjAuMi4wICgyMDE0LTA0LTMwKQogKiBSZXF1aXJlcyBNb3RpZiBSZXZlYWwKICogaHR0cDovL2dldG1vdGlmLmNvbQogKiAKICogQGF1dGhvciBKb25hdGhhbiBQYWNoZWNvIDxqb25hdGhhbkBsaWZlYmx1ZS5jb20+CiAqIEB0b2RvIEF1dG9nZW5lcmF0ZSBUYWJzIE5hdiwgYWRkIGJldHRlciBIaXN0b3J5IHN1cHBvcnQsIGFkZCBiZXR0ZXIgZG9jcwogKi8KKGZ1bmN0aW9uICggJCwgd2luZG93LCBkb2N1bWVudCwgTW90aWYsIHVuZGVmaW5lZCApIHsKCiAgICAidXNlIHN0cmljdCI7CgogICAgLyoqCiAgICAgKiBAbW9kdWxlIE1vdGlmCiAgICAgKiBAc3VibW9kdWxlIGFwcHMKICAgICAqIEBjbGFzcyBUYWJzCiAgICAgKiBAY29uc3RydWN0b3IKICAgICAqIEBwYXJhbSBlbGVtIHtPYmplY3R9CiAgICAgKiBAcGFyYW0gW3VzZXJPcHRpb25zXSB7T2JqZWN0fQogICAgICovCiAgICB2YXIgVGFicyA9IGZ1bmN0aW9uICggZWxlbSwgdXNlck9wdGlvbnMgKSB7CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHByb3BlcnR5ICRlbGVtCiAgICAgICAgICAgICAqIEB0eXBlIE9iamVjdAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdGhpcy4kZWxlbSA9ICQoIGVsZW0gKTsKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBAcHJvcGVydHkgZWxlbQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMuZWxlbSA9IHRoaXMuJGVsZW1bMF07CgogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAogICAgICAgIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLAogICAgICAgICRkb2N1bWVudCA9ICQoIGRvY3VtZW50ICk7CgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkgY291bnRlcgogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIFRhYnMuY291bnRlciA9IDA7CgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkgaGFzaENoYW5nZUJvdW5kCiAgICAgKiBAdHlwZSBCb29sZWFuCiAgICAgKi8KICAgIFRhYnMuaGFzaENoYW5nZUJvdW5kID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkgb25IYXNoQ2hhbmdlCiAgICAgKiBAdHlwZSBCb29sZWFuCiAgICAgKi8KICAgIFRhYnMub25IYXNoQ2hhbmdlID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkgYW5pbWF0aW9uRnJhbWUKICAgICAqIEB0eXBlIEJvb2xlYW4KICAgICAqLwogICAgVGFicy5hbmltYXRpb25GcmFtZSA9IHR5cGVvZiB3aW5kb3cucmVxdWVzdEFuaW1GcmFtZSA9PT0gImZ1bmN0aW9uIiA/IHRydWUgOiBmYWxzZTsKCiAgICBUYWJzLnByb3RvdHlwZSA9IHsKCiAgICAgICAgLyoqCiAgICAgICAgICogQHByb3BlcnR5IGRlZmF1bHRzCiAgICAgICAgICogQHR5cGUgT2JqZWN0CiAgICAgICAgICovCiAgICAgICAgImRlZmF1bHRzIjogewogICAgICAgICAgICAiYW5pbWF0ZSI6IHRydWUsCiAgICAgICAgICAgICJjc3NUcmFuc2l0aW9uIjogdHJ1ZSwKICAgICAgICAgICAgInNwZWVkIjogMzAwLAogICAgICAgICAgICAiZWFzaW5nIjogInN3aW5nIiwKICAgICAgICAgICAgImhpc3RvcnkiOiBmYWxzZSwKICAgICAgICAgICAgInRhYnNHcm91cCI6ICIudGFic19fc2VjdGlvbiIsCiAgICAgICAgICAgICJyZXZlYWxPcHRpb25zIjogewogICAgICAgICAgICAgICAgInR5cGUiOiAicmFkaW8iLAogICAgICAgICAgICAgICAgImFjdGl2ZUNsYXNzIjogImlzLWN1cnJlbnQiCiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIGluaXQKICAgICAgICAgKiBAcGFyYW0gW3VzZXJPcHRpb25zXSB7T2JqZWN0fQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0KICAgICAgICAgKi8KICAgICAgICAiaW5pdCI6IGZ1bmN0aW9uICggdXNlck9wdGlvbnMgKSB7CiAgICAgICAgICAgIGlmICggIXRoaXMuJGVsZW0ubGVuZ3RoICkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmluaXRWYXJzKCB1c2VyT3B0aW9ucyApOwogICAgICAgICAgICB0aGlzLmJpbmRFdmVudHMoKTsKICAgICAgICAgICAgdGhpcy5pbml0UmV2ZWFsKCk7CgogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIGluaXRWYXJzCiAgICAgICAgICogQHBhcmFtIFt1c2VyT3B0aW9uc10ge09iamVjdH0KICAgICAgICAgKi8KICAgICAgICAiaW5pdFZhcnMiOiBmdW5jdGlvbiAoIHVzZXJPcHRpb25zICkgewoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBjb25maWcKICAgICAgICAgICAgICogQHR5cGUgT2JqZWN0CiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0aGlzLmNvbmZpZyA9IHVzZXJPcHRpb25zOwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBtZXRhZGF0YQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMubWV0YWRhdGEgPSB0aGlzLiRlbGVtLmRhdGEoInRhYnMtb3B0aW9ucyIpOwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBvcHRpb25zCiAgICAgICAgICAgICAqIEB0eXBlIE9iamVjdAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoIHRydWUsIHt9LCB0aGlzLmRlZmF1bHRzLCB0aGlzLmNvbmZpZywgdGhpcy5tZXRhZGF0YSApOwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSAkdHJpZ2dlcnMKICAgICAgICAgICAgICogQHR5cGUgT2JqZWN0CiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0aGlzLiR0cmlnZ2VycyA9IHRoaXMuZ2F0aGVyVHJpZ2dlcnMuY2FsbCggdGhpcyApOwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSAkdGFicwogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMuJHRhYnMgPSB0aGlzLiRlbGVtLmZpbmQoIHRoaXMub3B0aW9ucy50YWJzR3JvdXAgKS5sZW5ndGggPyB0aGlzLiRlbGVtLmZpbmQoIHRoaXMub3B0aW9ucy50YWJzR3JvdXAgKSA6IHRoaXMuJGVsZW0uZmluZCgibmF2ICsgKiIpOwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBncm91cAogICAgICAgICAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMuZ3JvdXAgPSAidGFicy1ncm91cC0iICsgVGFicy5jb3VudGVyOwoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBpbml0aWFsaXplZAogICAgICAgICAgICAgKiBAdHlwZSBCb29sZWFuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQG1ldGhvZCBnYXRoZXJUcmlnZ2VycwogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0KICAgICAgICAgKi8KICAgICAgICAiZ2F0aGVyVHJpZ2dlcnMiOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbGVtLmZpbmQoIm5hdiBhIik7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQG1ldGhvZCBiaW5kRXZlbnRzCiAgICAgICAgICovCiAgICAgICAgImJpbmRFdmVudHMiOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIGlmICggc2VsZi5vcHRpb25zLmhpc3RvcnkgKSB7ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRkb2N1bWVudC5vbigicmV2ZWFsL3F1ZXVlL2RvbmUiLCBmdW5jdGlvbiB0YWJzSW5pdGlhbGl6ZWQgKCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoICFUYWJzLmhhc2hDaGFuZ2VCb3VuZCApIHsgICAgIAogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbmhhc2hjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWN0aXZhdGVGcm9tVXJsLmNhbGwoIHNlbGYgKTsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIFRhYnMuaGFzaENoYW5nZUJvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgYWN0aXZhdGVGcm9tVXJsCiAgICAgICAgICovCiAgICAgICAgImFjdGl2YXRlRnJvbVVybCI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGVsZW0sCiAgICAgICAgICAgICAgICBpbnN0YW5jZTsKCiAgICAgICAgICAgIGlmICggIVRhYnMub25IYXNoQ2hhbmdlICkgewogICAgICAgICAgICAgICAgVGFicy5vbkhhc2hDaGFuZ2UgPSB0cnVlOwogICAgICAgICAgICAgICAgZWxlbSA9IGxvY2F0aW9uLmhhc2ggIT09ICIiID8gJCgiW2hyZWY9JyIgKyBsb2NhdGlvbi5oYXNoICsgIiddIikgOiBmYWxzZTsKICAgICAgICAgICAgICAgIGluc3RhbmNlID0gZWxlbS5sZW5ndGggPyAkLmRhdGEoIGVsZW1bMF0sICJyZXZlYWwiICkgOiBmYWxzZTsKCiAgICAgICAgICAgICAgICBpZiAoIGluc3RhbmNlICkgewogICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnByb2Nlc3NUcmlnZ2VyLmNhbGwoIGluc3RhbmNlICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBUYWJzLm9uSGFzaENoYW5nZSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogSW5pdGlhbGl6ZSB0aGUgTW90aWYgUmV2ZWFsIHBsdWdpbiB3aXRoIFRhYi1zcGVjaWZpYyBjb25maWcKICAgICAgICAgKiBAbWV0aG9kIGdhdGhlclRyaWdnZXJzCiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICAgICAqLwogICAgICAgICJpbml0UmV2ZWFsIjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLiR0cmlnZ2Vycy5yZXZlYWwoIHRoaXMuY3JlYXRlUmV2ZWFsQ29uZmlnKCkgKTsKCiAgICAgICAgICAgIFRhYnMuY291bnRlciArPSAxOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFN1cHBsZW1lbnQgUmV2ZWFsIG9wdGlvbnMgZm9yIFRhYi1zcGVjaWZpYyB0YXNrcwogICAgICAgICAqIEBtZXRob2QgY3JlYXRlUmV2ZWFsQ29uZmlnCiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICAgICAqLwogICAgICAgICJjcmVhdGVSZXZlYWxDb25maWciOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYub3B0aW9ucy5yZXZlYWxPcHRpb25zLnRhcmdldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmdhdGhlclRhcmdldHMuY2FsbCggdGhpcyApOwogICAgICAgICAgICB9OwogICAgICAgICAgICBzZWxmLm9wdGlvbnMucmV2ZWFsT3B0aW9ucy5vbkluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLnByZXBUYWJzLmNhbGwoIHNlbGYsIHRoaXMgKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgc2VsZi5vcHRpb25zLnJldmVhbE9wdGlvbnMub25TaG93ID0gZnVuY3Rpb24gKCBlbGVtICkgewogICAgICAgICAgICAgICAgaWYgKCBzZWxmLm9wdGlvbnMuaGlzdG9yeSApIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZUxvY2F0aW9uLmNhbGwoIHNlbGYsIHRoaXMgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICggc2VsZi5vcHRpb25zLmFuaW1hdGUgKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5hbmltYXRlVGFicy5jYWxsKCBzZWxmLCB0aGlzICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHNlbGYub3B0aW9ucy5yZXZlYWxPcHRpb25zLmJlZm9yZUhpZGUgPSBmdW5jdGlvbiAoIGVsZW0gKSB7CiAgICAgICAgICAgICAgICBpZiAoIHNlbGYub3B0aW9ucy5oaXN0b3J5ICYmIGxvY2F0aW9uLmhhc2ggPT09ICIiICkgewogICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlTG9jYXRpb24uY2FsbCggc2VsZiwgdGhpcyApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCBzZWxmLm9wdGlvbnMuYW5pbWF0ZSApIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnByZXBUcmFuc2l0aW9uLmNhbGwoIHNlbGYsIHRoaXMgKTsgICAgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuIHNlbGYub3B0aW9ucy5yZXZlYWxPcHRpb25zOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgZ2F0aGVyVGFyZ2V0cwogICAgICAgICAqIEByZXR1cm4ge0FycmF5fQogICAgICAgICAqLwogICAgICAgICJnYXRoZXJUYXJnZXRzIjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgdGFyZ2V0cyA9IFtdOwoKICAgICAgICAgICAgdGFyZ2V0cy5wdXNoKCAkKCB0aGlzLiRlbGVtLmF0dHIoImhyZWYiKSApICk7CgogICAgICAgICAgICByZXR1cm4gdGFyZ2V0czsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIHByZXBUYWJzCiAgICAgICAgICovCiAgICAgICAgInByZXBUYWJzIjogZnVuY3Rpb24gKCBpbnN0YW5jZSApIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5jcmVhdGVHcm91cC5jYWxsKCBzZWxmLCBpbnN0YW5jZSApOwogICAgICAgICAgICBzZWxmLmdldEN1cnJlbnRUYWIuY2FsbCggc2VsZiwgaW5zdGFuY2UgKTsKCiAgICAgICAgICAgIGlmICggc2VsZi5vcHRpb25zLmFuaW1hdGUgKSB7CiAgICAgICAgICAgICAgICBpZiAoIHNlbGYub3B0aW9ucy5jc3NUcmFuc2l0aW9uICkgewogICAgICAgICAgICAgICAgICAgIGlmICggIXNlbGYuJHRhYnMuaGFzQ2xhc3MoInRyYW5zaXRpb24tYm91bmQiKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmFuc2l0aW9uRW5kQ3NzKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLiR0YWJzLmFkZENsYXNzKCJuby10cmFuc2l0aW9uIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIGNyZWF0ZUdyb3VwCiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgaWRlbnRpZnlpbmcgZ3JvdXAgbmFtZQogICAgICAgICAqLwogICAgICAgICJjcmVhdGVHcm91cCI6IGZ1bmN0aW9uICggaW5zdGFuY2UgKSB7CiAgICAgICAgICAgIGluc3RhbmNlLmdyb3VwID0gdGhpcy5ncm91cDsKICAgICAgICAgICAgaW5zdGFuY2UudXBkYXRlUmVmZXJlbmNlLmNhbGwoIGluc3RhbmNlICk7CgogICAgICAgICAgICByZXR1cm4gaW5zdGFuY2UuZ3JvdXA7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQG1ldGhvZCBnZXRDdXJyZW50VGFiCiAgICAgICAgICovCiAgICAgICAgImdldEN1cnJlbnRUYWIiOiBmdW5jdGlvbiAoIGluc3RhbmNlICkgewogICAgICAgICAgICB2YXIgcXVldWUgPSB3aW5kb3cuUmV2ZWFsLnF1ZXVlLAogICAgICAgICAgICAgICAgZ3JvdXBzID0gd2luZG93LlJldmVhbC5ncm91cHMsCiAgICAgICAgICAgICAgICBmaXJzdFRyaWdnZXIgPSBncm91cHNbIGluc3RhbmNlLmdyb3VwIF0udHJpZ2dlcnNbIDAgXTsKCiAgICAgICAgICAgIGlmICggdGhpcy5vcHRpb25zLmhpc3RvcnkgJiYgbG9jYXRpb24uaGFzaCA9PT0gaW5zdGFuY2UuJGVsZW0uYXR0cigiaHJlZiIpICkgewogICAgICAgICAgICAgICAgaWYgKCAkLmluQXJyYXkoIGZpcnN0VHJpZ2dlciwgcXVldWUgKSA+IC0xICkgewogICAgICAgICAgICAgICAgICAgIHF1ZXVlLnNwbGljZSggJC5pbkFycmF5KCBpbnN0YW5jZS5pZGVudGl0eSwgcXVldWUgKSwgMSApOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5SZXZlYWwucXVldWUgPSBxdWV1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGluc3RhbmNlLnNldEN1cnJlbnQoKTsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIGluc3RhbmNlLmlkZW50aXR5ID09PSBmaXJzdFRyaWdnZXIgKSB7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5zZXRDdXJyZW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIHRyYW5zaXRpb25FbmRDc3MKICAgICAgICAgKi8KICAgICAgICAidHJhbnNpdGlvbkVuZENzcyI6IGZ1bmN0aW9uICggZSApIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi4kdGFicy5vbigid2Via2l0VHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCBvVHJhbnNpdGlvbkVuZCBtc1RyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCIsIGZ1bmN0aW9uIGFmdGVyQW5pbWF0ZVRhYnMgKCBlICkgewoKICAgICAgICAgICAgICAgIGlmICggZS5vcmlnaW5hbEV2ZW50LnRhcmdldCA9PT0gc2VsZi4kdGFic1sgMCBdICkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuJHRhYnMucmVtb3ZlQXR0cigic3R5bGUiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0pLmFkZENsYXNzKCJ0cmFuc2l0aW9uLWJvdW5kIik7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQG1ldGhvZCBwcmVwVHJhbnNpdGlvbgogICAgICAgICAqLwogICAgICAgICJwcmVwVHJhbnNpdGlvbiI6IGZ1bmN0aW9uICggaW5zdGFuY2UgKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50VGFiID0gaW5zdGFuY2UucmVmZXJlbmNlLnRhcmdldHNbMF0sCiAgICAgICAgICAgICAgICB0YWJzU3R5bGUgPSB0aGlzLiR0YWJzLmF0dHIoInN0eWxlIik7CgogICAgICAgICAgICBpZiAoICF0YWJzU3R5bGUgKSB7CiAgICAgICAgICAgICAgICB0aGlzLiR0YWJzLm91dGVySGVpZ2h0KCBjdXJyZW50VGFiLm91dGVySGVpZ2h0KCkgKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgdXBkYXRlTG9jYXRpb24KICAgICAgICAgKi8KICAgICAgICAidXBkYXRlTG9jYXRpb24iOiBmdW5jdGlvbiAoIGluc3RhbmNlICkgewogICAgICAgICAgICBpZiAoIHRoaXMuaW5pdGlhbGl6ZWQgJiYgIVRhYnMub25IYXNoQ2hhbmdlICkgewogICAgICAgICAgICAgICAgVGFicy5vbkhhc2hDaGFuZ2UgPSB0cnVlOwogICAgICAgICAgICAgICAgbG9jYXRpb24uaGFzaCA9IGluc3RhbmNlLiRlbGVtLmF0dHIoImhyZWYiKTsKICAgICAgICAgICAgICAgIFRhYnMub25IYXNoQ2hhbmdlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBAbWV0aG9kIGFuaW1hdGVUYWJzCiAgICAgICAgICovCiAgICAgICAgImFuaW1hdGVUYWJzIjogZnVuY3Rpb24gKCBpbnN0YW5jZSApIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRUYWIgPSBpbnN0YW5jZS5yZWZlcmVuY2UudGFyZ2V0c1sgMCBdLAogICAgICAgICAgICAgICAgY3VycmVudFRhYkhlaWdodCA9IGN1cnJlbnRUYWIub3V0ZXJIZWlnaHQoKTsKCiAgICAgICAgICAgIGlmICggdGhpcy5vcHRpb25zLmNzc1RyYW5zaXRpb24gKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGVUYWJzQ3NzKCBjdXJyZW50VGFiSGVpZ2h0ICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGVUYWJzSnMoIGN1cnJlbnRUYWJIZWlnaHQgKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBtZXRob2QgYW5pbWF0ZVRhYnNDc3MKICAgICAgICAgKi8KICAgICAgICAiYW5pbWF0ZVRhYnNDc3MiOiBmdW5jdGlvbiAoIGN1cnJlbnRUYWJIZWlnaHQgKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIGlmICggc2VsZi4kdGFicy5vdXRlckhlaWdodCgpICE9PSBjdXJyZW50VGFiSGVpZ2h0ICkgewogICAgICAgICAgICAgICAgaWYgKCBUYWJzLmFuaW1hdGlvbkZyYW1lICkgewogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltRnJhbWUoIGZ1bmN0aW9uIHNldFRhYnNIZWlnaHQgKCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLiR0YWJzLm91dGVySGVpZ2h0KCBjdXJyZW50VGFiSGVpZ2h0ICkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi4kdGFicy5vdXRlckhlaWdodCggY3VycmVudFRhYkhlaWdodCApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZi4kdGFicy5yZW1vdmVBdHRyKCJzdHlsZSIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQG1ldGhvZCBhbmltYXRlVGFic0pzCiAgICAgICAgICovCiAgICAgICAgImFuaW1hdGVUYWJzSnMiOiBmdW5jdGlvbiAoIGN1cnJlbnRUYWJIZWlnaHQgKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYuJHRhYnMuc3RvcCgpLmFuaW1hdGUoewogICAgICAgICAgICAgICAgaGVpZ2h0OiBjdXJyZW50VGFiSGVpZ2h0CiAgICAgICAgICAgIH0sIHNlbGYub3B0aW9ucy5zcGVlZCwgc2VsZi5vcHRpb25zLmVhc2luZywgZnVuY3Rpb24gYWZ0ZXJBbmltYXRlVGFic0pzICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuJHRhYnMucmVtb3ZlQXR0cigic3R5bGUiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKCiAgICBUYWJzLmRlZmF1bHRzID0gVGFicy5wcm90b3R5cGUuZGVmYXVsdHM7CgogICAgTW90aWYuYXBwcy5UYWJzID0gVGFiczsKCn0oIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCwgd2luZG93Lk1vdGlmID0gd2luZG93Lk1vdGlmIHx8IHsKICAgICJ1dGlscyI6IHt9LAogICAgImFwcHMiOiB7fQp9ICkgKTsKCiQuY3JlYXRlUGx1Z2luKCAidGFicyIsIHdpbmRvdy5Nb3RpZi5hcHBzLlRhYnMgKTs=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 16:32:05 GMT",
                    "Content-Length": "11105",
                    "Date": "Fri, 07 Nov 2014 16:32:05 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}