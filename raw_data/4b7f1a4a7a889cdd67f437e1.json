{
    "url": "http://localhost:9999/ariya/phantomjs/src/qt/qtwebkit/Source/WebCore/inspector/front-end/Script.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location</b> and written to <b>the 'add()' function of JQuery</b> via the following statement:<ul><li>this._locations.add(location);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ariya/phantomjs/src/qt/qtwebkit/Source/WebCore/inspector/front-end/Script.js",
                "path": "/ariya/phantomjs/src/qt/qtwebkit/Source/WebCore/inspector/front-end/Script.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hcml5YS9waGFudG9tanMvc3JjL3F0L3F0d2Via2l0L1NvdXJjZS9XZWJDb3JlL2luc3BlY3Rvci9mcm9udC1lbmQvU2NyaXB0LmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogOTIyMA0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAyMTo1MDo0NyBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMjE6NDk6NTggR01UDQoNCi8qCiAqIENvcHlyaWdodCAoQykgMjAwOCBBcHBsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAqCiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMKICogYXJlIG1ldDoKICogMS4gUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKICogICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogKiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlCiAqICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgQVBQTEUgSU5DLiBgYEFTIElTJycgQU5EIEFOWQogKiBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIKICogUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gIElOIE5PIEVWRU5UIFNIQUxMIEFQUExFIElOQy4gT1IKICogQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsCiAqIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywKICogUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SCiAqIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkKICogT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUCiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRQogKiBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogKi8KCi8qKgogKiBAY29uc3RydWN0b3IKICogQGV4dGVuZHMge1dlYkluc3BlY3Rvci5PYmplY3R9CiAqIEBpbXBsZW1lbnRzIHtXZWJJbnNwZWN0b3IuQ29udGVudFByb3ZpZGVyfQogKiBAcGFyYW0ge3N0cmluZ30gc2NyaXB0SWQKICogQHBhcmFtIHtzdHJpbmd9IHNvdXJjZVVSTAogKiBAcGFyYW0ge251bWJlcn0gc3RhcnRMaW5lCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydENvbHVtbgogKiBAcGFyYW0ge251bWJlcn0gZW5kTGluZQogKiBAcGFyYW0ge251bWJlcn0gZW5kQ29sdW1uCiAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNDb250ZW50U2NyaXB0CiAqIEBwYXJhbSB7c3RyaW5nPX0gc291cmNlTWFwVVJMCiAqIEBwYXJhbSB7Ym9vbGVhbj19IGhhc1NvdXJjZVVSTAogKi8KV2ViSW5zcGVjdG9yLlNjcmlwdCA9IGZ1bmN0aW9uKHNjcmlwdElkLCBzb3VyY2VVUkwsIHN0YXJ0TGluZSwgc3RhcnRDb2x1bW4sIGVuZExpbmUsIGVuZENvbHVtbiwgaXNDb250ZW50U2NyaXB0LCBzb3VyY2VNYXBVUkwsIGhhc1NvdXJjZVVSTCkKewogICAgdGhpcy5zY3JpcHRJZCA9IHNjcmlwdElkOwogICAgdGhpcy5zb3VyY2VVUkwgPSBzb3VyY2VVUkw7CiAgICB0aGlzLmxpbmVPZmZzZXQgPSBzdGFydExpbmU7CiAgICB0aGlzLmNvbHVtbk9mZnNldCA9IHN0YXJ0Q29sdW1uOwogICAgdGhpcy5lbmRMaW5lID0gZW5kTGluZTsKICAgIHRoaXMuZW5kQ29sdW1uID0gZW5kQ29sdW1uOwogICAgdGhpcy5pc0NvbnRlbnRTY3JpcHQgPSBpc0NvbnRlbnRTY3JpcHQ7CiAgICB0aGlzLnNvdXJjZU1hcFVSTCA9IHNvdXJjZU1hcFVSTDsKICAgIHRoaXMuaGFzU291cmNlVVJMID0gaGFzU291cmNlVVJMOwogICAgdGhpcy5fbG9jYXRpb25zID0gbmV3IFNldCgpOwogICAgdGhpcy5fc291cmNlTWFwcGluZ3MgPSBbXTsKfQoKV2ViSW5zcGVjdG9yLlNjcmlwdC5FdmVudHMgPSB7CiAgICBTY3JpcHRFZGl0ZWQ6ICJTY3JpcHRFZGl0ZWQiLAp9CgpXZWJJbnNwZWN0b3IuU2NyaXB0LnNuaXBwZXRTb3VyY2VVUkxQcmVmaXggPSAic25pcHBldHM6Ly8vIjsKCldlYkluc3BlY3Rvci5TY3JpcHQucHJvdG90eXBlID0gewogICAgLyoqCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9CiAgICAgKi8KICAgIGNvbnRlbnRVUkw6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2VVUkw7CiAgICB9LAoKICAgIC8qKgogICAgICogQHJldHVybiB7V2ViSW5zcGVjdG9yLlJlc291cmNlVHlwZX0KICAgICAqLwogICAgY29udGVudFR5cGU6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgICByZXR1cm4gV2ViSW5zcGVjdG9yLnJlc291cmNlVHlwZXMuU2NyaXB0OwogICAgfSwKCiAgICAvKioKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oP3N0cmluZyxib29sZWFuLHN0cmluZyl9IGNhbGxiYWNrCiAgICAgKi8KICAgIHJlcXVlc3RDb250ZW50OiBmdW5jdGlvbihjYWxsYmFjaykKICAgIHsKICAgICAgICBpZiAodGhpcy5fc291cmNlKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKHRoaXMuX3NvdXJjZSwgZmFsc2UsICJ0ZXh0L2phdmFzY3JpcHQiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQHRoaXMge1dlYkluc3BlY3Rvci5TY3JpcHR9CiAgICAgICAgICogQHBhcmFtIHs/UHJvdG9jb2wuRXJyb3J9IGVycm9yCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHNvdXJjZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGRpZEdldFNjcmlwdFNvdXJjZShlcnJvciwgc291cmNlKQogICAgICAgIHsKICAgICAgICAgICAgdGhpcy5fc291cmNlID0gZXJyb3IgPyAiIiA6IHNvdXJjZTsKICAgICAgICAgICAgY2FsbGJhY2sodGhpcy5fc291cmNlLCBmYWxzZSwgInRleHQvamF2YXNjcmlwdCIpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5zY3JpcHRJZCkgewogICAgICAgICAgICAvLyBTY3JpcHQgZmFpbGVkIHRvIHBhcnNlLgogICAgICAgICAgICBEZWJ1Z2dlckFnZW50LmdldFNjcmlwdFNvdXJjZSh0aGlzLnNjcmlwdElkLCBkaWRHZXRTY3JpcHRTb3VyY2UuYmluZCh0aGlzKSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNhbGxiYWNrKCIiLCBmYWxzZSwgInRleHQvamF2YXNjcmlwdCIpOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBxdWVyeQogICAgICogQHBhcmFtIHtib29sZWFufSBjYXNlU2Vuc2l0aXZlCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzUmVnZXgKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oQXJyYXkuPFBhZ2VBZ2VudC5TZWFyY2hNYXRjaD4pfSBjYWxsYmFjawogICAgICovCiAgICBzZWFyY2hJbkNvbnRlbnQ6IGZ1bmN0aW9uKHF1ZXJ5LCBjYXNlU2Vuc2l0aXZlLCBpc1JlZ2V4LCBjYWxsYmFjaykKICAgIHsKICAgICAgICAvKioKICAgICAgICAgKiBAdGhpcyB7V2ViSW5zcGVjdG9yLlNjcmlwdH0KICAgICAgICAgKiBAcGFyYW0gez9Qcm90b2NvbC5FcnJvcn0gZXJyb3IKICAgICAgICAgKiBAcGFyYW0ge0FycmF5LjxQYWdlQWdlbnQuU2VhcmNoTWF0Y2g+fSBzZWFyY2hNYXRjaGVzCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gaW5uZXJDYWxsYmFjayhlcnJvciwgc2VhcmNoTWF0Y2hlcykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChlcnJvcikKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VhcmNoTWF0Y2hlcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgdmFyIHNlYXJjaE1hdGNoID0gbmV3IFdlYkluc3BlY3Rvci5Db250ZW50UHJvdmlkZXIuU2VhcmNoTWF0Y2goc2VhcmNoTWF0Y2hlc1tpXS5saW5lTnVtYmVyLCBzZWFyY2hNYXRjaGVzW2ldLmxpbmVDb250ZW50KTsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNlYXJjaE1hdGNoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYWxsYmFjayhyZXN1bHQgfHwgW10pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuc2NyaXB0SWQpIHsKICAgICAgICAgICAgLy8gU2NyaXB0IGZhaWxlZCB0byBwYXJzZS4KICAgICAgICAgICAgRGVidWdnZXJBZ2VudC5zZWFyY2hJbkNvbnRlbnQodGhpcy5zY3JpcHRJZCwgcXVlcnksIGNhc2VTZW5zaXRpdmUsIGlzUmVnZXgsIGlubmVyQ2FsbGJhY2suYmluZCh0aGlzKSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNhbGxiYWNrKFtdKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmV3U291cmNlCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKD9Qcm90b2NvbC5FcnJvciwgQXJyYXkuPERlYnVnZ2VyQWdlbnQuQ2FsbEZyYW1lPj0pfSBjYWxsYmFjawogICAgICovCiAgICBlZGl0U291cmNlOiBmdW5jdGlvbihuZXdTb3VyY2UsIGNhbGxiYWNrKQogICAgewogICAgICAgIC8qKgogICAgICAgICAqIEB0aGlzIHtXZWJJbnNwZWN0b3IuU2NyaXB0fQogICAgICAgICAqIEBwYXJhbSB7P1Byb3RvY29sLkVycm9yfSBlcnJvcgogICAgICAgICAqIEBwYXJhbSB7QXJyYXkuPERlYnVnZ2VyQWdlbnQuQ2FsbEZyYW1lPj19IGNhbGxGcmFtZXMKICAgICAgICAgKiBAcGFyYW0ge09iamVjdD19IGRlYnVnRGF0YQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGRpZEVkaXRTY3JpcHRTb3VyY2UoZXJyb3IsIGNhbGxGcmFtZXMsIGRlYnVnRGF0YSkKICAgICAgICB7CiAgICAgICAgICAgIC8vIEZJWE1FOiBzdXBwb3J0IGRlYnVnRGF0YS5zdGFja191cGRhdGVfbmVlZHNfc3RlcF9pbiBmbGFnIGJ5IGNhbGxpbmcgV2ViSW5zcGVjdG9yLmRlYnVnZ2VyX21vZGVsLmNhbGxTdGFja01vZGlmaWVkCiAgICAgICAgICAgIGlmICghZXJyb3IpCiAgICAgICAgICAgICAgICB0aGlzLl9zb3VyY2UgPSBuZXdTb3VyY2U7CiAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBjYWxsRnJhbWVzKTsKICAgICAgICAgICAgaWYgKCFlcnJvcikKICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudFRvTGlzdGVuZXJzKFdlYkluc3BlY3Rvci5TY3JpcHQuRXZlbnRzLlNjcmlwdEVkaXRlZCwgbmV3U291cmNlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc2NyaXB0SWQpIHsKICAgICAgICAgICAgLy8gU2NyaXB0IGZhaWxlZCB0byBwYXJzZS4KICAgICAgICAgICAgRGVidWdnZXJBZ2VudC5zZXRTY3JpcHRTb3VyY2UodGhpcy5zY3JpcHRJZCwgbmV3U291cmNlLCB1bmRlZmluZWQsIGRpZEVkaXRTY3JpcHRTb3VyY2UuYmluZCh0aGlzKSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGNhbGxiYWNrKCJTY3JpcHQgZmFpbGVkIHRvIHBhcnNlIik7CiAgICB9LAoKICAgIC8qKgogICAgICogQHJldHVybiB7Ym9vbGVhbn0KICAgICAqLwogICAgaXNJbmxpbmVTY3JpcHQ6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgICB2YXIgc3RhcnRzQXRaZXJvID0gIXRoaXMubGluZU9mZnNldCAmJiAhdGhpcy5jb2x1bW5PZmZzZXQ7CiAgICAgICAgcmV0dXJuICEhdGhpcy5zb3VyY2VVUkwgJiYgIXN0YXJ0c0F0WmVybzsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHtib29sZWFufQogICAgICovCiAgICBpc0Fub255bW91c1NjcmlwdDogZnVuY3Rpb24oKQogICAgewogICAgICAgIHJldHVybiAhdGhpcy5zb3VyY2VVUkw7CiAgICB9LAoKICAgIC8qKgogICAgICogQHBhcmFtIHtib29sZWFufSBpc0R5bmFtaWNTY3JpcHQKICAgICAqLwogICAgc2V0SXNEeW5hbWljU2NyaXB0OiBmdW5jdGlvbihpc0R5bmFtaWNTY3JpcHQpCiAgICB7CiAgICAgICAgdGhpcy5faXNEeW5hbWljU2NyaXB0ID0gaXNEeW5hbWljU2NyaXB0OwogICAgfSwKCiAgICAvKioKICAgICAqIEByZXR1cm4ge2Jvb2xlYW59CiAgICAgKi8KICAgIGlzRHluYW1pY1NjcmlwdDogZnVuY3Rpb24oKQogICAgewogICAgICAgIHJldHVybiAhIXRoaXMuX2lzRHluYW1pY1NjcmlwdDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHtib29sZWFufQogICAgICovCiAgICBpc1NuaXBwZXQ6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2VVUkwgJiYgdGhpcy5zb3VyY2VVUkwuc3RhcnRzV2l0aChXZWJJbnNwZWN0b3IuU2NyaXB0LnNuaXBwZXRTb3VyY2VVUkxQcmVmaXgpOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBsaW5lTnVtYmVyCiAgICAgKiBAcGFyYW0ge251bWJlcj19IGNvbHVtbk51bWJlcgogICAgICogQHJldHVybiB7V2ViSW5zcGVjdG9yLlVJTG9jYXRpb259CiAgICAgKi8KICAgIHJhd0xvY2F0aW9uVG9VSUxvY2F0aW9uOiBmdW5jdGlvbihsaW5lTnVtYmVyLCBjb2x1bW5OdW1iZXIpCiAgICB7CiAgICAgICAgdmFyIHVpTG9jYXRpb247CiAgICAgICAgdmFyIHJhd0xvY2F0aW9uID0gbmV3IFdlYkluc3BlY3Rvci5EZWJ1Z2dlck1vZGVsLkxvY2F0aW9uKHRoaXMuc2NyaXB0SWQsIGxpbmVOdW1iZXIsIGNvbHVtbk51bWJlciB8fCAwKTsKICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fc291cmNlTWFwcGluZ3MubGVuZ3RoIC0gMTsgIXVpTG9jYXRpb24gJiYgaSA+PSAwOyAtLWkpCiAgICAgICAgICAgIHVpTG9jYXRpb24gPSB0aGlzLl9zb3VyY2VNYXBwaW5nc1tpXS5yYXdMb2NhdGlvblRvVUlMb2NhdGlvbihyYXdMb2NhdGlvbik7CiAgICAgICAgY29uc29sZS5hc3NlcnQodWlMb2NhdGlvbiwgIlNjcmlwdCByYXcgbG9jYXRpb24gY2FuIG5vdCBiZSBtYXBwZWQgdG8gYW55IHVpIGxvY2F0aW9uLiIpOwogICAgICAgIHJldHVybiB1aUxvY2F0aW9uLnVpU291cmNlQ29kZS5vdmVycmlkZUxvY2F0aW9uKHVpTG9jYXRpb24pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwYXJhbSB7V2ViSW5zcGVjdG9yLlNvdXJjZU1hcHBpbmd9IHNvdXJjZU1hcHBpbmcKICAgICAqLwogICAgcHVzaFNvdXJjZU1hcHBpbmc6IGZ1bmN0aW9uKHNvdXJjZU1hcHBpbmcpCiAgICB7CiAgICAgICAgdGhpcy5fc291cmNlTWFwcGluZ3MucHVzaChzb3VyY2VNYXBwaW5nKTsKICAgICAgICB0aGlzLnVwZGF0ZUxvY2F0aW9ucygpOwogICAgfSwKCiAgICBwb3BTb3VyY2VNYXBwaW5nOiBmdW5jdGlvbigpCiAgICB7CiAgICAgICAgdGhpcy5fc291cmNlTWFwcGluZ3MucG9wKCk7CiAgICAgICAgdGhpcy51cGRhdGVMb2NhdGlvbnMoKTsKICAgIH0sCgogICAgdXBkYXRlTG9jYXRpb25zOiBmdW5jdGlvbigpCiAgICB7CiAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5fbG9jYXRpb25zLml0ZW1zKCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7ICsraSkKICAgICAgICAgICAgaXRlbXNbaV0udXBkYXRlKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHBhcmFtIHtXZWJJbnNwZWN0b3IuRGVidWdnZXJNb2RlbC5Mb2NhdGlvbn0gcmF3TG9jYXRpb24KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oV2ViSW5zcGVjdG9yLlVJTG9jYXRpb24pOihib29sZWFufHVuZGVmaW5lZCl9IHVwZGF0ZURlbGVnYXRlCiAgICAgKiBAcmV0dXJuIHtXZWJJbnNwZWN0b3IuU2NyaXB0LkxvY2F0aW9ufQogICAgICovCiAgICBjcmVhdGVMaXZlTG9jYXRpb246IGZ1bmN0aW9uKHJhd0xvY2F0aW9uLCB1cGRhdGVEZWxlZ2F0ZSkKICAgIHsKICAgICAgICBjb25zb2xlLmFzc2VydChyYXdMb2NhdGlvbi5zY3JpcHRJZCA9PT0gdGhpcy5zY3JpcHRJZCk7CiAgICAgICAgdmFyIGxvY2F0aW9uID0gbmV3IFdlYkluc3BlY3Rvci5TY3JpcHQuTG9jYXRpb24odGhpcywgcmF3TG9jYXRpb24sIHVwZGF0ZURlbGVnYXRlKTsKICAgICAgICB0aGlzLl9sb2NhdGlvbnMuYWRkKGxvY2F0aW9uKTsKICAgICAgICBsb2NhdGlvbi51cGRhdGUoKTsKICAgICAgICByZXR1cm4gbG9jYXRpb247CiAgICB9LAoKICAgIF9fcHJvdG9fXzogV2ViSW5zcGVjdG9yLk9iamVjdC5wcm90b3R5cGUKfQoKLyoqCiAqIEBjb25zdHJ1Y3RvcgogKiBAZXh0ZW5kcyB7V2ViSW5zcGVjdG9yLkxpdmVMb2NhdGlvbn0KICogQHBhcmFtIHtXZWJJbnNwZWN0b3IuU2NyaXB0fSBzY3JpcHQKICogQHBhcmFtIHtXZWJJbnNwZWN0b3IuRGVidWdnZXJNb2RlbC5Mb2NhdGlvbn0gcmF3TG9jYXRpb24KICogQHBhcmFtIHtmdW5jdGlvbihXZWJJbnNwZWN0b3IuVUlMb2NhdGlvbik6KGJvb2xlYW58dW5kZWZpbmVkKX0gdXBkYXRlRGVsZWdhdGUKICovCldlYkluc3BlY3Rvci5TY3JpcHQuTG9jYXRpb24gPSBmdW5jdGlvbihzY3JpcHQsIHJhd0xvY2F0aW9uLCB1cGRhdGVEZWxlZ2F0ZSkKewogICAgV2ViSW5zcGVjdG9yLkxpdmVMb2NhdGlvbi5jYWxsKHRoaXMsIHJhd0xvY2F0aW9uLCB1cGRhdGVEZWxlZ2F0ZSk7CiAgICB0aGlzLl9zY3JpcHQgPSBzY3JpcHQ7Cn0KCldlYkluc3BlY3Rvci5TY3JpcHQuTG9jYXRpb24ucHJvdG90eXBlID0gewogICAgLyoqCiAgICAgKiBAcmV0dXJuIHtXZWJJbnNwZWN0b3IuVUlMb2NhdGlvbn0KICAgICAqLwogICAgdWlMb2NhdGlvbjogZnVuY3Rpb24oKQogICAgewogICAgICAgIHZhciBkZWJ1Z2dlck1vZGVsTG9jYXRpb24gPSAvKiogQHR5cGUge1dlYkluc3BlY3Rvci5EZWJ1Z2dlck1vZGVsLkxvY2F0aW9ufSAqLyAodGhpcy5yYXdMb2NhdGlvbigpKTsKICAgICAgICByZXR1cm4gdGhpcy5fc2NyaXB0LnJhd0xvY2F0aW9uVG9VSUxvY2F0aW9uKGRlYnVnZ2VyTW9kZWxMb2NhdGlvbi5saW5lTnVtYmVyLCBkZWJ1Z2dlck1vZGVsTG9jYXRpb24uY29sdW1uTnVtYmVyKTsKICAgIH0sCgogICAgZGlzcG9zZTogZnVuY3Rpb24oKQogICAgewogICAgICAgIFdlYkluc3BlY3Rvci5MaXZlTG9jYXRpb24ucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTsKICAgICAgICB0aGlzLl9zY3JpcHQuX2xvY2F0aW9ucy5yZW1vdmUodGhpcyk7CiAgICB9LAoKICAgIF9fcHJvdG9fXzogV2ViSW5zcGVjdG9yLkxpdmVMb2NhdGlvbi5wcm90b3R5cGUKfQo=",
                "body": "LyoKICogQ29weXJpZ2h0IChDKSAyMDA4IEFwcGxlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KICoKICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucwogKiBhcmUgbWV0OgogKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAogKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0CiAqICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUKICogICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICoKICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBBUFBMRSBJTkMuIGBgQVMgSVMnJyBBTkQgQU5ZCiAqIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUgogKiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiAgSU4gTk8gRVZFTlQgU0hBTEwgQVBQTEUgSU5DLiBPUgogKiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwKICogRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLAogKiBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IKICogUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWQogKiBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQKICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFCiAqIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqLwoKLyoqCiAqIEBjb25zdHJ1Y3RvcgogKiBAZXh0ZW5kcyB7V2ViSW5zcGVjdG9yLk9iamVjdH0KICogQGltcGxlbWVudHMge1dlYkluc3BlY3Rvci5Db250ZW50UHJvdmlkZXJ9CiAqIEBwYXJhbSB7c3RyaW5nfSBzY3JpcHRJZAogKiBAcGFyYW0ge3N0cmluZ30gc291cmNlVVJMCiAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydExpbmUKICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0Q29sdW1uCiAqIEBwYXJhbSB7bnVtYmVyfSBlbmRMaW5lCiAqIEBwYXJhbSB7bnVtYmVyfSBlbmRDb2x1bW4KICogQHBhcmFtIHtib29sZWFufSBpc0NvbnRlbnRTY3JpcHQKICogQHBhcmFtIHtzdHJpbmc9fSBzb3VyY2VNYXBVUkwKICogQHBhcmFtIHtib29sZWFuPX0gaGFzU291cmNlVVJMCiAqLwpXZWJJbnNwZWN0b3IuU2NyaXB0ID0gZnVuY3Rpb24oc2NyaXB0SWQsIHNvdXJjZVVSTCwgc3RhcnRMaW5lLCBzdGFydENvbHVtbiwgZW5kTGluZSwgZW5kQ29sdW1uLCBpc0NvbnRlbnRTY3JpcHQsIHNvdXJjZU1hcFVSTCwgaGFzU291cmNlVVJMKQp7CiAgICB0aGlzLnNjcmlwdElkID0gc2NyaXB0SWQ7CiAgICB0aGlzLnNvdXJjZVVSTCA9IHNvdXJjZVVSTDsKICAgIHRoaXMubGluZU9mZnNldCA9IHN0YXJ0TGluZTsKICAgIHRoaXMuY29sdW1uT2Zmc2V0ID0gc3RhcnRDb2x1bW47CiAgICB0aGlzLmVuZExpbmUgPSBlbmRMaW5lOwogICAgdGhpcy5lbmRDb2x1bW4gPSBlbmRDb2x1bW47CiAgICB0aGlzLmlzQ29udGVudFNjcmlwdCA9IGlzQ29udGVudFNjcmlwdDsKICAgIHRoaXMuc291cmNlTWFwVVJMID0gc291cmNlTWFwVVJMOwogICAgdGhpcy5oYXNTb3VyY2VVUkwgPSBoYXNTb3VyY2VVUkw7CiAgICB0aGlzLl9sb2NhdGlvbnMgPSBuZXcgU2V0KCk7CiAgICB0aGlzLl9zb3VyY2VNYXBwaW5ncyA9IFtdOwp9CgpXZWJJbnNwZWN0b3IuU2NyaXB0LkV2ZW50cyA9IHsKICAgIFNjcmlwdEVkaXRlZDogIlNjcmlwdEVkaXRlZCIsCn0KCldlYkluc3BlY3Rvci5TY3JpcHQuc25pcHBldFNvdXJjZVVSTFByZWZpeCA9ICJzbmlwcGV0czovLy8iOwoKV2ViSW5zcGVjdG9yLlNjcmlwdC5wcm90b3R5cGUgPSB7CiAgICAvKioKICAgICAqIEByZXR1cm4ge3N0cmluZ30KICAgICAqLwogICAgY29udGVudFVSTDogZnVuY3Rpb24oKQogICAgewogICAgICAgIHJldHVybiB0aGlzLnNvdXJjZVVSTDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHtXZWJJbnNwZWN0b3IuUmVzb3VyY2VUeXBlfQogICAgICovCiAgICBjb250ZW50VHlwZTogZnVuY3Rpb24oKQogICAgewogICAgICAgIHJldHVybiBXZWJJbnNwZWN0b3IucmVzb3VyY2VUeXBlcy5TY3JpcHQ7CiAgICB9LAoKICAgIC8qKgogICAgICogQHBhcmFtIHtmdW5jdGlvbig/c3RyaW5nLGJvb2xlYW4sc3RyaW5nKX0gY2FsbGJhY2sKICAgICAqLwogICAgcmVxdWVzdENvbnRlbnQ6IGZ1bmN0aW9uKGNhbGxiYWNrKQogICAgewogICAgICAgIGlmICh0aGlzLl9zb3VyY2UpIHsKICAgICAgICAgICAgY2FsbGJhY2sodGhpcy5fc291cmNlLCBmYWxzZSwgInRleHQvamF2YXNjcmlwdCIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBAdGhpcyB7V2ViSW5zcGVjdG9yLlNjcmlwdH0KICAgICAgICAgKiBAcGFyYW0gez9Qcm90b2NvbC5FcnJvcn0gZXJyb3IKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gZGlkR2V0U2NyaXB0U291cmNlKGVycm9yLCBzb3VyY2UpCiAgICAgICAgewogICAgICAgICAgICB0aGlzLl9zb3VyY2UgPSBlcnJvciA/ICIiIDogc291cmNlOwogICAgICAgICAgICBjYWxsYmFjayh0aGlzLl9zb3VyY2UsIGZhbHNlLCAidGV4dC9qYXZhc2NyaXB0Iik7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnNjcmlwdElkKSB7CiAgICAgICAgICAgIC8vIFNjcmlwdCBmYWlsZWQgdG8gcGFyc2UuCiAgICAgICAgICAgIERlYnVnZ2VyQWdlbnQuZ2V0U2NyaXB0U291cmNlKHRoaXMuc2NyaXB0SWQsIGRpZEdldFNjcmlwdFNvdXJjZS5iaW5kKHRoaXMpKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgY2FsbGJhY2soIiIsIGZhbHNlLCAidGV4dC9qYXZhc2NyaXB0Iik7CiAgICB9LAoKICAgIC8qKgogICAgICogQHBhcmFtIHtzdHJpbmd9IHF1ZXJ5CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGNhc2VTZW5zaXRpdmUKICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNSZWdleAogICAgICogQHBhcmFtIHtmdW5jdGlvbihBcnJheS48UGFnZUFnZW50LlNlYXJjaE1hdGNoPil9IGNhbGxiYWNrCiAgICAgKi8KICAgIHNlYXJjaEluQ29udGVudDogZnVuY3Rpb24ocXVlcnksIGNhc2VTZW5zaXRpdmUsIGlzUmVnZXgsIGNhbGxiYWNrKQogICAgewogICAgICAgIC8qKgogICAgICAgICAqIEB0aGlzIHtXZWJJbnNwZWN0b3IuU2NyaXB0fQogICAgICAgICAqIEBwYXJhbSB7P1Byb3RvY29sLkVycm9yfSBlcnJvcgogICAgICAgICAqIEBwYXJhbSB7QXJyYXkuPFBhZ2VBZ2VudC5TZWFyY2hNYXRjaD59IHNlYXJjaE1hdGNoZXMKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBpbm5lckNhbGxiYWNrKGVycm9yLCBzZWFyY2hNYXRjaGVzKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGVycm9yKQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWFyY2hNYXRjaGVzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoTWF0Y2ggPSBuZXcgV2ViSW5zcGVjdG9yLkNvbnRlbnRQcm92aWRlci5TZWFyY2hNYXRjaChzZWFyY2hNYXRjaGVzW2ldLmxpbmVOdW1iZXIsIHNlYXJjaE1hdGNoZXNbaV0ubGluZUNvbnRlbnQpOwogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc2VhcmNoTWF0Y2gpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3VsdCB8fCBbXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5zY3JpcHRJZCkgewogICAgICAgICAgICAvLyBTY3JpcHQgZmFpbGVkIHRvIHBhcnNlLgogICAgICAgICAgICBEZWJ1Z2dlckFnZW50LnNlYXJjaEluQ29udGVudCh0aGlzLnNjcmlwdElkLCBxdWVyeSwgY2FzZVNlbnNpdGl2ZSwgaXNSZWdleCwgaW5uZXJDYWxsYmFjay5iaW5kKHRoaXMpKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgY2FsbGJhY2soW10pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdTb3VyY2UKICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oP1Byb3RvY29sLkVycm9yLCBBcnJheS48RGVidWdnZXJBZ2VudC5DYWxsRnJhbWU+PSl9IGNhbGxiYWNrCiAgICAgKi8KICAgIGVkaXRTb3VyY2U6IGZ1bmN0aW9uKG5ld1NvdXJjZSwgY2FsbGJhY2spCiAgICB7CiAgICAgICAgLyoqCiAgICAgICAgICogQHRoaXMge1dlYkluc3BlY3Rvci5TY3JpcHR9CiAgICAgICAgICogQHBhcmFtIHs/UHJvdG9jb2wuRXJyb3J9IGVycm9yCiAgICAgICAgICogQHBhcmFtIHtBcnJheS48RGVidWdnZXJBZ2VudC5DYWxsRnJhbWU+PX0gY2FsbEZyYW1lcwogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0PX0gZGVidWdEYXRhCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gZGlkRWRpdFNjcmlwdFNvdXJjZShlcnJvciwgY2FsbEZyYW1lcywgZGVidWdEYXRhKQogICAgICAgIHsKICAgICAgICAgICAgLy8gRklYTUU6IHN1cHBvcnQgZGVidWdEYXRhLnN0YWNrX3VwZGF0ZV9uZWVkc19zdGVwX2luIGZsYWcgYnkgY2FsbGluZyBXZWJJbnNwZWN0b3IuZGVidWdnZXJfbW9kZWwuY2FsbFN0YWNrTW9kaWZpZWQKICAgICAgICAgICAgaWYgKCFlcnJvcikKICAgICAgICAgICAgICAgIHRoaXMuX3NvdXJjZSA9IG5ld1NvdXJjZTsKICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIGNhbGxGcmFtZXMpOwogICAgICAgICAgICBpZiAoIWVycm9yKQogICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50VG9MaXN0ZW5lcnMoV2ViSW5zcGVjdG9yLlNjcmlwdC5FdmVudHMuU2NyaXB0RWRpdGVkLCBuZXdTb3VyY2UpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5zY3JpcHRJZCkgewogICAgICAgICAgICAvLyBTY3JpcHQgZmFpbGVkIHRvIHBhcnNlLgogICAgICAgICAgICBEZWJ1Z2dlckFnZW50LnNldFNjcmlwdFNvdXJjZSh0aGlzLnNjcmlwdElkLCBuZXdTb3VyY2UsIHVuZGVmaW5lZCwgZGlkRWRpdFNjcmlwdFNvdXJjZS5iaW5kKHRoaXMpKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgY2FsbGJhY2soIlNjcmlwdCBmYWlsZWQgdG8gcGFyc2UiKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHtib29sZWFufQogICAgICovCiAgICBpc0lubGluZVNjcmlwdDogZnVuY3Rpb24oKQogICAgewogICAgICAgIHZhciBzdGFydHNBdFplcm8gPSAhdGhpcy5saW5lT2Zmc2V0ICYmICF0aGlzLmNvbHVtbk9mZnNldDsKICAgICAgICByZXR1cm4gISF0aGlzLnNvdXJjZVVSTCAmJiAhc3RhcnRzQXRaZXJvOwogICAgfSwKCiAgICAvKioKICAgICAqIEByZXR1cm4ge2Jvb2xlYW59CiAgICAgKi8KICAgIGlzQW5vbnltb3VzU2NyaXB0OiBmdW5jdGlvbigpCiAgICB7CiAgICAgICAgcmV0dXJuICF0aGlzLnNvdXJjZVVSTDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzRHluYW1pY1NjcmlwdAogICAgICovCiAgICBzZXRJc0R5bmFtaWNTY3JpcHQ6IGZ1bmN0aW9uKGlzRHluYW1pY1NjcmlwdCkKICAgIHsKICAgICAgICB0aGlzLl9pc0R5bmFtaWNTY3JpcHQgPSBpc0R5bmFtaWNTY3JpcHQ7CiAgICB9LAoKICAgIC8qKgogICAgICogQHJldHVybiB7Ym9vbGVhbn0KICAgICAqLwogICAgaXNEeW5hbWljU2NyaXB0OiBmdW5jdGlvbigpCiAgICB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5faXNEeW5hbWljU2NyaXB0OwogICAgfSwKCiAgICAvKioKICAgICAqIEByZXR1cm4ge2Jvb2xlYW59CiAgICAgKi8KICAgIGlzU25pcHBldDogZnVuY3Rpb24oKQogICAgewogICAgICAgIHJldHVybiB0aGlzLnNvdXJjZVVSTCAmJiB0aGlzLnNvdXJjZVVSTC5zdGFydHNXaXRoKFdlYkluc3BlY3Rvci5TY3JpcHQuc25pcHBldFNvdXJjZVVSTFByZWZpeCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHBhcmFtIHtudW1iZXJ9IGxpbmVOdW1iZXIKICAgICAqIEBwYXJhbSB7bnVtYmVyPX0gY29sdW1uTnVtYmVyCiAgICAgKiBAcmV0dXJuIHtXZWJJbnNwZWN0b3IuVUlMb2NhdGlvbn0KICAgICAqLwogICAgcmF3TG9jYXRpb25Ub1VJTG9jYXRpb246IGZ1bmN0aW9uKGxpbmVOdW1iZXIsIGNvbHVtbk51bWJlcikKICAgIHsKICAgICAgICB2YXIgdWlMb2NhdGlvbjsKICAgICAgICB2YXIgcmF3TG9jYXRpb24gPSBuZXcgV2ViSW5zcGVjdG9yLkRlYnVnZ2VyTW9kZWwuTG9jYXRpb24odGhpcy5zY3JpcHRJZCwgbGluZU51bWJlciwgY29sdW1uTnVtYmVyIHx8IDApOwogICAgICAgIGZvciAodmFyIGkgPSB0aGlzLl9zb3VyY2VNYXBwaW5ncy5sZW5ndGggLSAxOyAhdWlMb2NhdGlvbiAmJiBpID49IDA7IC0taSkKICAgICAgICAgICAgdWlMb2NhdGlvbiA9IHRoaXMuX3NvdXJjZU1hcHBpbmdzW2ldLnJhd0xvY2F0aW9uVG9VSUxvY2F0aW9uKHJhd0xvY2F0aW9uKTsKICAgICAgICBjb25zb2xlLmFzc2VydCh1aUxvY2F0aW9uLCAiU2NyaXB0IHJhdyBsb2NhdGlvbiBjYW4gbm90IGJlIG1hcHBlZCB0byBhbnkgdWkgbG9jYXRpb24uIik7CiAgICAgICAgcmV0dXJuIHVpTG9jYXRpb24udWlTb3VyY2VDb2RlLm92ZXJyaWRlTG9jYXRpb24odWlMb2NhdGlvbik7CiAgICB9LAoKICAgIC8qKgogICAgICogQHBhcmFtIHtXZWJJbnNwZWN0b3IuU291cmNlTWFwcGluZ30gc291cmNlTWFwcGluZwogICAgICovCiAgICBwdXNoU291cmNlTWFwcGluZzogZnVuY3Rpb24oc291cmNlTWFwcGluZykKICAgIHsKICAgICAgICB0aGlzLl9zb3VyY2VNYXBwaW5ncy5wdXNoKHNvdXJjZU1hcHBpbmcpOwogICAgICAgIHRoaXMudXBkYXRlTG9jYXRpb25zKCk7CiAgICB9LAoKICAgIHBvcFNvdXJjZU1hcHBpbmc6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgICB0aGlzLl9zb3VyY2VNYXBwaW5ncy5wb3AoKTsKICAgICAgICB0aGlzLnVwZGF0ZUxvY2F0aW9ucygpOwogICAgfSwKCiAgICB1cGRhdGVMb2NhdGlvbnM6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLl9sb2NhdGlvbnMuaXRlbXMoKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgKytpKQogICAgICAgICAgICBpdGVtc1tpXS51cGRhdGUoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcGFyYW0ge1dlYkluc3BlY3Rvci5EZWJ1Z2dlck1vZGVsLkxvY2F0aW9ufSByYXdMb2NhdGlvbgogICAgICogQHBhcmFtIHtmdW5jdGlvbihXZWJJbnNwZWN0b3IuVUlMb2NhdGlvbik6KGJvb2xlYW58dW5kZWZpbmVkKX0gdXBkYXRlRGVsZWdhdGUKICAgICAqIEByZXR1cm4ge1dlYkluc3BlY3Rvci5TY3JpcHQuTG9jYXRpb259CiAgICAgKi8KICAgIGNyZWF0ZUxpdmVMb2NhdGlvbjogZnVuY3Rpb24ocmF3TG9jYXRpb24sIHVwZGF0ZURlbGVnYXRlKQogICAgewogICAgICAgIGNvbnNvbGUuYXNzZXJ0KHJhd0xvY2F0aW9uLnNjcmlwdElkID09PSB0aGlzLnNjcmlwdElkKTsKICAgICAgICB2YXIgbG9jYXRpb24gPSBuZXcgV2ViSW5zcGVjdG9yLlNjcmlwdC5Mb2NhdGlvbih0aGlzLCByYXdMb2NhdGlvbiwgdXBkYXRlRGVsZWdhdGUpOwogICAgICAgIHRoaXMuX2xvY2F0aW9ucy5hZGQobG9jYXRpb24pOwogICAgICAgIGxvY2F0aW9uLnVwZGF0ZSgpOwogICAgICAgIHJldHVybiBsb2NhdGlvbjsKICAgIH0sCgogICAgX19wcm90b19fOiBXZWJJbnNwZWN0b3IuT2JqZWN0LnByb3RvdHlwZQp9CgovKioKICogQGNvbnN0cnVjdG9yCiAqIEBleHRlbmRzIHtXZWJJbnNwZWN0b3IuTGl2ZUxvY2F0aW9ufQogKiBAcGFyYW0ge1dlYkluc3BlY3Rvci5TY3JpcHR9IHNjcmlwdAogKiBAcGFyYW0ge1dlYkluc3BlY3Rvci5EZWJ1Z2dlck1vZGVsLkxvY2F0aW9ufSByYXdMb2NhdGlvbgogKiBAcGFyYW0ge2Z1bmN0aW9uKFdlYkluc3BlY3Rvci5VSUxvY2F0aW9uKTooYm9vbGVhbnx1bmRlZmluZWQpfSB1cGRhdGVEZWxlZ2F0ZQogKi8KV2ViSW5zcGVjdG9yLlNjcmlwdC5Mb2NhdGlvbiA9IGZ1bmN0aW9uKHNjcmlwdCwgcmF3TG9jYXRpb24sIHVwZGF0ZURlbGVnYXRlKQp7CiAgICBXZWJJbnNwZWN0b3IuTGl2ZUxvY2F0aW9uLmNhbGwodGhpcywgcmF3TG9jYXRpb24sIHVwZGF0ZURlbGVnYXRlKTsKICAgIHRoaXMuX3NjcmlwdCA9IHNjcmlwdDsKfQoKV2ViSW5zcGVjdG9yLlNjcmlwdC5Mb2NhdGlvbi5wcm90b3R5cGUgPSB7CiAgICAvKioKICAgICAqIEByZXR1cm4ge1dlYkluc3BlY3Rvci5VSUxvY2F0aW9ufQogICAgICovCiAgICB1aUxvY2F0aW9uOiBmdW5jdGlvbigpCiAgICB7CiAgICAgICAgdmFyIGRlYnVnZ2VyTW9kZWxMb2NhdGlvbiA9IC8qKiBAdHlwZSB7V2ViSW5zcGVjdG9yLkRlYnVnZ2VyTW9kZWwuTG9jYXRpb259ICovICh0aGlzLnJhd0xvY2F0aW9uKCkpOwogICAgICAgIHJldHVybiB0aGlzLl9zY3JpcHQucmF3TG9jYXRpb25Ub1VJTG9jYXRpb24oZGVidWdnZXJNb2RlbExvY2F0aW9uLmxpbmVOdW1iZXIsIGRlYnVnZ2VyTW9kZWxMb2NhdGlvbi5jb2x1bW5OdW1iZXIpOwogICAgfSwKCiAgICBkaXNwb3NlOiBmdW5jdGlvbigpCiAgICB7CiAgICAgICAgV2ViSW5zcGVjdG9yLkxpdmVMb2NhdGlvbi5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpOwogICAgICAgIHRoaXMuX3NjcmlwdC5fbG9jYXRpb25zLnJlbW92ZSh0aGlzKTsKICAgIH0sCgogICAgX19wcm90b19fOiBXZWJJbnNwZWN0b3IuTGl2ZUxvY2F0aW9uLnByb3RvdHlwZQp9Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:49:58 GMT",
                    "Content-Length": "9220",
                    "Date": "Fri, 07 Nov 2014 21:50:47 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}