{
    "url": "http://localhost:9999/kissyteam/router/lib/router.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>location.hash</b> and written to <b>history.replaceState()</b> via the following statements:<ul><li>var tmp = location.hash.substring(2);</li><li>history.replaceState({}, '', href = location.protocol + '//' + location.host + location.pathname + tmp);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/kissyteam/router/lib/router.js",
                "path": "/kissyteam/router/lib/router.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9raXNzeXRlYW0vcm91dGVyL2xpYi9yb3V0ZXIuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTM1MDcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMTY6MjI6NDkgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDE2OjIyOjQ5IEdNVA0KDQovKioKICogQSBleHByZXNzLWxpa2Ugcm91dGVyCiAqIEBhdXRob3IgeWltaW5naGVAZ21haWwuY29tCiAqLwp2YXIgbWlkZGxld2FyZXMgPSBbXTsKdmFyIHJvdXRlcyA9IFtdOwp2YXIgdXRpbHMgPSByZXF1aXJlKCcuL3JvdXRlci91dGlscycpOwp2YXIgUm91dGUgPSByZXF1aXJlKCcuL3JvdXRlci9yb3V0ZScpOwp2YXIgdXJsID0gcmVxdWlyZSgndXJsJyk7CnZhciBSZXF1ZXN0ID0gcmVxdWlyZSgnLi9yb3V0ZXIvcmVxdWVzdCcpOwp2YXIgRG9tRXZlbnQgPSByZXF1aXJlKCdldmVudC1kb20nKTsKLypnbG9iYWwgQ3VzdG9tRXZlbnQ6dHJ1ZSwgaGlzdG9yeTp0cnVlKi8KdmFyIEN1c3RvbUV2ZW50ID0gcmVxdWlyZSgnZXZlbnQtY3VzdG9tJyk7CnZhciBnZXRWaWRGcm9tVXJsV2l0aEhhc2ggPSB1dGlscy5nZXRWaWRGcm9tVXJsV2l0aEhhc2g7CnZhciB3aW4gPSB3aW5kb3c7CnZhciBoaXN0b3J5ID0gd2luLmhpc3Rvcnk7CnZhciBzdXBwb3J0TmF0aXZlSGFzaENoYW5nZSA9IHJlcXVpcmUoJ2ZlYXR1cmUnKS5pc0hhc2hDaGFuZ2VTdXBwb3J0ZWQoKTsKdmFyIHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlID0gISEoaGlzdG9yeSAmJiBoaXN0b3J5LnB1c2hTdGF0ZSk7Ci8vIHRha2UgYSBicmVhdGggdG8gYXZvaWQgZHVwbGljYXRlIGhhc2hjaGFuZ2UKdmFyIEJSRUFUSF9JTlRFUlZBTCA9IDEwMDsKLy8gZm9yIGp1ZGdpbmcgYmFja3dhcmQgb3IgZm9yd2FyZAp2YXIgdmlld1VuaXF1ZUlkID0gMTA7CnZhciB2aWV3c0hpc3RvcnkgPSBbdmlld1VuaXF1ZUlkXTsKdmFyIGdsb2JhbENvbmZpZyA9IHsKICAgIHVybFJvb3Q6ICcnLAogICAgdXNlSGFzaDogIXN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlCn07CgpmdW5jdGlvbiBzZXRQYXRoQnlIYXNoKHBhdGgsIHJlcGxhY2UpIHsKICAgIHZhciBoYXNoID0gdXRpbHMuYWRkVmlkKCcjIScgKyBwYXRoICsKICAgICAgICAgICAgLy8gYWRkIGhpc3RvcnkgaGFjayBmb3IgaWU2NwogICAgICAgICAgICAoc3VwcG9ydE5hdGl2ZUhhc2hDaGFuZ2UgPyAnJyA6IChyZXBsYWNlID8gRG9tRXZlbnQuUkVQTEFDRV9ISVNUT1JZIDogJycpKSwKICAgICAgICB2aWV3VW5pcXVlSWQpOwogICAgaWYgKHJlcGxhY2UpIHsKICAgICAgICBsb2NhdGlvbi5yZXBsYWNlKGhhc2gpOwogICAgfSBlbHNlIHsKICAgICAgICBsb2NhdGlvbi5oYXNoID0gaGFzaDsKICAgIH0KfQoKLy8gZ2V0IHVybCBwYXRoIGZvciByb3V0ZXIgZGlzcGF0Y2gKZnVuY3Rpb24gZ2V0VXJsRm9yUm91dGVyKHVybFN0cikgewogICAgdXJsU3RyID0gdXJsU3RyIHx8IGxvY2F0aW9uLmhyZWY7CiAgICB2YXIgdXJpID0gdXJsLnBhcnNlKHVybFN0cik7CiAgICBpZiAoIWdsb2JhbENvbmZpZy51c2VIYXNoICYmIHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlKSB7CiAgICAgICAgcmV0dXJuIHVyaS5wYXRobmFtZS5zdWJzdHIoZ2xvYmFsQ29uZmlnLnVybFJvb3QubGVuZ3RoKSArICh1cmkuc2VhcmNoIHx8ICcnKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHV0aWxzLmdldEhhc2godXJsU3RyKTsKICAgIH0KfQoKZnVuY3Rpb24gZmlyZU1pZGRsZVdhcmUocmVxdWVzdCwgcmVzcG9uc2UsIGNiKSB7CiAgICB2YXIgaW5kZXggPSAtMTsKICAgIHZhciBsZW4gPSBtaWRkbGV3YXJlcy5sZW5ndGg7CgogICAgZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICBpbmRleCsrOwogICAgICAgIGlmIChpbmRleCA9PT0gbGVuKSB7CiAgICAgICAgICAgIGNiKHJlcXVlc3QsIHJlc3BvbnNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbWlkZGxld2FyZSA9IG1pZGRsZXdhcmVzW2luZGV4XTsKICAgICAgICAgICAgaWYgKHV0aWxzLnN0YXJ0c1dpdGgocmVxdWVzdC5wYXRoICsgJy8nLCBtaWRkbGV3YXJlWzBdICsgJy8nKSkgewogICAgICAgICAgICAgICAgdmFyIHByZWZpeExlbiA9IG1pZGRsZXdhcmVbMF0ubGVuZ3RoOwogICAgICAgICAgICAgICAgcmVxdWVzdC51cmwgPSByZXF1ZXN0LnVybC5zbGljZShwcmVmaXhMZW4pOwogICAgICAgICAgICAgICAgdmFyIHBhdGggPSByZXF1ZXN0LnBhdGg7CiAgICAgICAgICAgICAgICByZXF1ZXN0LnBhdGggPSByZXF1ZXN0LnBhdGguc2xpY2UocHJlZml4TGVuKTsKICAgICAgICAgICAgICAgIG1pZGRsZXdhcmVbMV0ocmVxdWVzdCwgbmV4dCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0LnVybCA9IHJlcXVlc3Qub3JpZ2luYWxVcmw7CiAgICAgICAgICAgICAgICByZXF1ZXN0LnBhdGggPSBwYXRoOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG5leHQoKTsKfQoKZnVuY3Rpb24gZmlyZVJvdXRlcyhyZXF1ZXN0LCByZXNwb25zZSkgewogICAgdmFyIGluZGV4ID0gLTE7CiAgICB2YXIgbGVuID0gcm91dGVzLmxlbmd0aDsKCiAgICBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgIGluZGV4Kys7CiAgICAgICAgaWYgKGluZGV4ICE9PSBsZW4pIHsKICAgICAgICAgICAgdmFyIHJvdXRlID0gcm91dGVzW2luZGV4XTsKICAgICAgICAgICAgaWYgKChyZXF1ZXN0LnBhcmFtcyA9IHJvdXRlLm1hdGNoKHJlcXVlc3QucGF0aCkpKSB7CiAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2tJbmRleCA9IC0xOwogICAgICAgICAgICAgICAgdmFyIGNhbGxiYWNrcyA9IHJvdXRlLmNhbGxiYWNrczsKICAgICAgICAgICAgICAgIHZhciBjYWxsYmFja3NMZW4gPSBjYWxsYmFja3MubGVuZ3RoOwogICAgICAgICAgICAgICAgdmFyIG5leHRDYWxsYmFjayA9IGZ1bmN0aW9uIChjYXVzZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjYXVzZSA9PT0gJ3JvdXRlJykgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0Q2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tJbmRleCsrOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2tJbmRleCAhPT0gY2FsbGJhY2tzTGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnJvdXRlID0gcm91dGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3NbY2FsbGJhY2tJbmRleF0ocmVxdWVzdCwgcmVzcG9uc2UsIG5leHRDYWxsYmFjayk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgbmV4dENhbGxiYWNrKCcnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBuZXh0KCk7Cn0KCmZ1bmN0aW9uIGRpc3BhdGNoKGJhY2t3YXJkLCByZXBsYWNlKSB7CiAgICB2YXIgdXJsU3RyID0gZ2V0VXJsRm9yUm91dGVyKCk7CiAgICB2YXIgdXJpID0gdXJsLnBhcnNlKHVybFN0ciwgdHJ1ZSk7CiAgICB2YXIgcXVlcnkgPSB1cmkucXVlcnk7CiAgICB1cmkuc2VhcmNoID0gJyc7CiAgICB1cmkucXVlcnkgPSB7fTsKICAgIC8vIG5vcm1hbGl6ZSB0byAnLycKICAgIHZhciBwYXRoID0gdXJsLnN0cmluZ2lmeSh1cmkpIHx8ICcvJzsKICAgIHZhciByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoewogICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAvLyBiYWNrd2FyZCBvciBmb3J3YXJkCiAgICAgICAgYmFja3dhcmQ6IGJhY2t3YXJkID09PSB0cnVlLAogICAgICAgIC8vIHJlcGxhY2UgaGlzdG9yeQogICAgICAgIHJlcGxhY2U6IHJlcGxhY2UgPT09IHRydWUsCiAgICAgICAgZm9yd2FyZDogKGJhY2t3YXJkID09PSBmYWxzZSAmJiByZXBsYWNlID09PSBmYWxzZSksCiAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICB1cmw6IHVybFN0ciwKICAgICAgICBvcmlnaW5hbFVybDogdXJsU3RyCiAgICB9KTsKICAgIHZhciByZXNwb25zZSA9IHsKICAgICAgICByZWRpcmVjdDogZXhwb3J0cy5uYXZpZ2F0ZQogICAgfTsKICAgIGV4cG9ydHMuZmlyZSgnZGlzcGF0Y2gnLCB7CiAgICAgICAgcmVxdWVzdDogcmVxdWVzdCwKICAgICAgICByZXNwb25zZTogcmVzcG9uc2UKICAgIH0pOwogICAgZmlyZU1pZGRsZVdhcmUocmVxdWVzdCwgcmVzcG9uc2UsIGZpcmVSb3V0ZXMpOwp9CgovKioKICogUm91dGVyIHVzaW5nIGhhc2ggb3IgaHRtbDUgaGlzdG9yeQogKiBAY2xhc3MgS0lTU1kuUm91dGVyCiAqIEBzaW5nbGV0b24KICovCgp1dGlscy5taXgoZXhwb3J0cywgQ3VzdG9tRXZlbnQuVGFyZ2V0KTsKCi8qKgogKiBjb25maWcgbWlkZGxld2FyZSBmb3Igcm91dGVyCiAqIEBwYXJhbSB7U3RyaW5nfSBwcmVmaXggY29uZmlnIHByZWZpeCB0byBkZWNpZGUgd2hpY2ggcGF0aCBpcyBwcm9jZXNzZWQKICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgbWlkZGxld2FyZSBsb2dpYyBmdW5jdGlvbgogKi8KZXhwb3J0cy51c2UgPSBmdW5jdGlvbiAocHJlZml4LCBjYWxsYmFjaykgewogICAgaWYgKHR5cGVvZiBwcmVmaXggIT09ICdzdHJpbmcnKSB7CiAgICAgICAgY2FsbGJhY2sgPSBwcmVmaXg7CiAgICAgICAgcHJlZml4ID0gJyc7CiAgICB9CiAgICBtaWRkbGV3YXJlcy5wdXNoKFtwcmVmaXgsIGNhbGxiYWNrXSk7Cn07CgovKioKICogTmF2aWdhdGUgdG8gc3BlY2lmaWVkIHBhdGguCiAqIEBzdGF0aWMKICogQG1lbWJlciBLSVNTWS5Sb3V0ZXIKICogQHBhcmFtIHtTdHJpbmd9IHBhdGggRGVzdGluYXRpb24gcGF0aC4KICogQHBhcmFtIHtPYmplY3R9IFtvcHRzXSBDb25maWcgZm9yIGN1cnJlbnQgbmF2aWdhdGlvbi4KICogQHBhcmFtIHtCb29sZWFufSBvcHRzLnRyaWdnZXJSb3V0ZSBXaGV0aGVyIHRvIHRyaWdnZXIgcmVzcG9uZGluZyBhY3Rpb24KICogICAgICAgICAgICAgICAgICBldmVuIGN1cnJlbnQgcGF0aCBpcyBzYW1lIGFzIHBhcmFtZXRlcgogKi8KZXhwb3J0cy5uYXZpZ2F0ZSA9IGZ1bmN0aW9uIChwYXRoLCBvcHRzKSB7CiAgICBvcHRzID0gb3B0cyB8fCB7fTsKICAgIHZhciByZXBsYWNlID0gb3B0cy5yZXBsYWNlIHx8IGZhbHNlOwogICAgdmFyIHVybFN0ciA9IGdldFVybEZvclJvdXRlcigpOwogICAgdmFyIHVyaSA9IHVybC5wYXJzZSh1cmxTdHIpOwogICAgaWYgKHBhdGguY2hhckF0KDApID09PSAnPycpIHsKICAgICAgICB1cmkuc2VhcmNoID0gcGF0aDsKICAgICAgICBwYXRoID0gdXJsLnN0cmluZ2lmeSh1cmkpOwogICAgfQogICAgaWYgKHVybFN0ciAhPT0gcGF0aCkgewogICAgICAgIGlmICghcmVwbGFjZSkgewogICAgICAgICAgICB2aWV3VW5pcXVlSWQrKzsKICAgICAgICAgICAgdmlld3NIaXN0b3J5LnB1c2godmlld1VuaXF1ZUlkKTsKICAgICAgICB9CiAgICAgICAgLy9TLmxvZygnY3VycmVudDogJyArIHZpZXdzSGlzdG9yeSk7CiAgICAgICAgaWYgKCFnbG9iYWxDb25maWcudXNlSGFzaCAmJiBzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSkgewogICAgICAgICAgICBoaXN0b3J5W3JlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7CiAgICAgICAgICAgICAgICB2aWQ6IHZpZXdVbmlxdWVJZAogICAgICAgICAgICB9LCAnJywgdXRpbHMuZ2V0RnVsbFBhdGgocGF0aCwgZ2xvYmFsQ29uZmlnLnVybFJvb3QpKTsKICAgICAgICAgICAgLy8gcHVzaFN0YXRlIGRvZXMgbm90IGZpcmUgcG9wc3RhdGUgZXZlbnQgKHVubGlrZSBoYXNoY2hhbmdlKQogICAgICAgICAgICAvLyBzbyBwb3BzdGF0ZSBpcyBub3Qgc3RhdGVjaGFuZ2UKICAgICAgICAgICAgLy8gZmlyZSBtYW51YWxseQogICAgICAgICAgICBkaXNwYXRjaChmYWxzZSwgcmVwbGFjZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlKSB7CiAgICAgICAgICAgICAgICBoaXN0b3J5W3JlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7CiAgICAgICAgICAgICAgICAgICAgdmlkOiB2aWV3VW5pcXVlSWQKICAgICAgICAgICAgICAgIH0sICcnLCAnIyEnICsgcGF0aCk7CiAgICAgICAgICAgICAgICBkaXNwYXRjaChmYWxzZSwgcmVwbGFjZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZXRQYXRoQnlIYXNoKHBhdGgsIHJlcGxhY2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChvcHRzICYmIG9wdHMudHJpZ2dlclJvdXRlKSB7CiAgICAgICAgZGlzcGF0Y2goZmFsc2UsIHRydWUpOwogICAgfQp9OwoKLyoqCiAqIGFkZCByb3V0ZSBhbmQgaXRzIGNhbGxiYWNrcwogKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IHJvdXRlUGF0aCByb3V0ZSBzdHJpbmcgb3IgcmVnZXhwCiAqLwpleHBvcnRzLmdldCA9IGZ1bmN0aW9uIChyb3V0ZVBhdGgpIHsKICAgIHZhciBjYWxsYmFja3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTsKICAgIHJvdXRlcy5wdXNoKG5ldyBSb3V0ZShyb3V0ZVBhdGgsIGNhbGxiYWNrcywgZ2xvYmFsQ29uZmlnKSk7Cn07CgovKioKICogd2hldGhlciB1cmwgcGF0aCBtYXRjaCBjb25maWcgcm91dGVzCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoIHVybCBwYXRoCiAqIEByZXR1cm5zIHtCb29sZWFufQogKi8KZXhwb3J0cy5tYXRjaFJvdXRlID0gZnVuY3Rpb24gKHBhdGgpIHsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcm91dGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGlmIChyb3V0ZXNbaV0ubWF0Y2gocGF0aCkpIHsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlc1tpXTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn07CgovKioKICogcmVtb3ZlIHNwZWNpZmllZCByb3V0ZQogKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IHJvdXRlUGF0aCByb3V0ZSBzdHJpbmcgb3IgcmVnZXhwCiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gcm91dGVyIGNhbGxiYWNrCiAqLwpleHBvcnRzLnJlbW92ZVJvdXRlID0gZnVuY3Rpb24gKHJvdXRlUGF0aCwgY2FsbGJhY2spIHsKICAgIGZvciAodmFyIGkgPSByb3V0ZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB2YXIgciA9IHJvdXRlc1tpXTsKICAgICAgICBpZiAoci5wYXRoID09PSByb3V0ZVBhdGgpIHsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICByLnJlbW92ZUNhbGxiYWNrKGNhbGxiYWNrKTsKICAgICAgICAgICAgICAgIGlmICghci5jYWxsYmFja3MubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgcm91dGVzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJvdXRlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn07CgovLyBwcml2YXRlCmV4cG9ydHMuY2xlYXJSb3V0ZXMgPSBmdW5jdGlvbiAoKSB7CiAgICBtaWRkbGV3YXJlcyA9IFtdOwogICAgcm91dGVzID0gW107Cn07CgovKioKICogd2hldGhlciBoYXMgc3BlY2lmaWVkIHJvdXRlCiAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gcm91dGVQYXRoIHJvdXRlIHN0cmluZyBvciByZWdleHAKICogQHJldHVybnMge0Jvb2xlYW59CiAqLwpleHBvcnRzLmhhc1JvdXRlID0gZnVuY3Rpb24gKHJvdXRlUGF0aCkgewogICAgZm9yICh2YXIgaSA9IDAsIGwgPSByb3V0ZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgaWYgKHJvdXRlc1tpXS5wYXRoID09PSByb3V0ZVBhdGgpIHsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlc1tpXTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn07CgpmdW5jdGlvbiBkaXNwYXRjaEJ5VmlkKHZpZCkgewogICAgdmFyIGJhY2t3YXJkID0gZmFsc2U7CiAgICB2YXIgcmVwbGFjZSA9IGZhbHNlOwoKICAgIGlmICh2aWQgPT09IHZpZXdzSGlzdG9yeVt2aWV3c0hpc3RvcnkubGVuZ3RoIC0gMl0pIHsKICAgICAgICBiYWNrd2FyZCA9IHRydWU7CiAgICAgICAgdmlld3NIaXN0b3J5LnBvcCgpOwogICAgfSBlbHNlIGlmICgKICAgIC8vICB3aGVuIGhhc2hjaGFuZ2UgbW9kZSBhbHJlYWR5IHB1c2ggdmlkIGJ5IG5hdmlnYXRlCiAgICAgICAgdmlkICE9PSB2aWV3c0hpc3Rvcnlbdmlld3NIaXN0b3J5Lmxlbmd0aCAtIDFdKSB7CiAgICAgICAgdmlld3NIaXN0b3J5LnB1c2godmlkKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmVwbGFjZSA9IHRydWU7CiAgICB9CgogICAgZGlzcGF0Y2goYmFja3dhcmQsIHJlcGxhY2UpOwp9CgpmdW5jdGlvbiBvblBvcFN0YXRlKGUpIHsKICAgIC8vIHBhZ2UgdG8gYmUgcmVuZGVyZWQKICAgIHZhciBzdGF0ZSA9IGUub3JpZ2luYWxFdmVudC5zdGF0ZTsKICAgIC8vIGlucHV0IHVybCBkaXJlY3RseQogICAgaWYgKCFzdGF0ZSkgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGRpc3BhdGNoQnlWaWQoc3RhdGUudmlkKTsKfQoKZnVuY3Rpb24gb25IYXNoQ2hhbmdlKGUpIHsKICAgIC8vUy5sb2coJ29uSGFzaENoYW5nZScpOwogICAgLy8gbm8gdmlldyBpZCwganVzdCByZXR1cm4KICAgIHZhciBuZXdVUkwgPSBlLm5ld1VSTCB8fCBsb2NhdGlvbi5ocmVmOwogICAgdmFyIHZpZCA9IGdldFZpZEZyb21VcmxXaXRoSGFzaChuZXdVUkwpOwogICAgaWYgKCF2aWQpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBkaXNwYXRjaEJ5VmlkKHZpZCk7Cn0KCi8qKgogKiBDb25maWcgcm91dGVyCiAqIEBzdGF0aWMKICogQG1lbWJlciBLSVNTWS5Sb3V0ZXIKICogQHBhcmFtIHtPYmplY3R9IFtvcHRzXQogKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRzLmNhc2VTZW5zaXRpdmVdIGVuYWJsZSBjYXNlLXNlbnNpdGl2ZSByb3V0ZXMKICogQHBhcmFtIHtCb29sZWFufSBbb3B0cy5zdHJpY3RdIGVuYWJsZSBzdHJpY3QgbWF0Y2hpbmcgZm9yIHRyYWlsaW5nIHNsYXNoZXMKICogQHBhcmFtIHtTdHJpbmd9IFtvcHRzLnVybFJvb3RdIFNwZWNpZnkgdXJsIHJvb3QgZm9yIGh0bWw1IGhpc3RvcnkgbWFuYWdlbWVudC4KICogQHBhcmFtIHtCb29sZWFufSBbb3B0cy51c2VIYXNoXSBmb3JjZSB0byB1c2UgaGFzaCB1cmwgZm9yIG5hdmlnYXRpb24gZXZlbiBmb3IgYnJvd3NlciB3aGljaCBzdXBwb3J0IGh0bWw1IGhpc3RvcnkuCiAqIGZhbHNlIGlzIG9ubHkgaW52YWxpZCBmb3IgaHRtbCBoaXN0b3J5IHN1cHBvcnRlZCBicm93c2VycwogKi8KZXhwb3J0cy5jb25maWcgPSBmdW5jdGlvbiAob3B0cykgewogICAgaWYgKG9wdHMudXJsUm9vdCkgewogICAgICAgIG9wdHMudXJsUm9vdCA9IG9wdHMudXJsUm9vdC5yZXBsYWNlKC9cLyQvLCAnJyk7CiAgICB9CiAgICB1dGlscy5taXgoZ2xvYmFsQ29uZmlnLCBvcHRzKTsKfTsKCnZhciBzdGFydGVkOwoKLyoqCiAqIFN0YXJ0IHJvdXRlciAodXJsIG1vbml0b3IpLgogKiBAc3RhdGljCiAqIEBtZW1iZXIgS0lTU1kuUm91dGVyCiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGFmdGVyIHJvdXRlciBpcyBzdGFydGVkLgogKi8KZXhwb3J0cy5zdGFydCA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgaWYgKHN0YXJ0ZWQpIHsKICAgICAgICByZXR1cm4gY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbChleHBvcnRzKTsKICAgIH0KICAgIHZhciB1c2VIYXNoID0gZ2xvYmFsQ29uZmlnLnVzZUhhc2gsIHVybFJvb3QgPSBnbG9iYWxDb25maWcudXJsUm9vdCwgdHJpZ2dlclJvdXRlID0gZ2xvYmFsQ29uZmlnLnRyaWdnZXJSb3V0ZSwgbG9jUGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lLCBocmVmID0gbG9jYXRpb24uaHJlZiwgaGFzaCA9IGdldFVybEZvclJvdXRlcigpLCBoYXNoSXNWYWxpZCA9IGxvY2F0aW9uLmhhc2gubWF0Y2goLyMhLisvKTsKICAgIGlmICghdXNlSGFzaCkgewogICAgICAgIGlmIChzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSkgewogICAgICAgICAgICAvLyBodHRwOi8veC5jb20vIyEveC95CiAgICAgICAgICAgIC8vID0+CiAgICAgICAgICAgIC8vIGh0dHA6Ly94LmNvbS94L3kKICAgICAgICAgICAgLy8gPT4KICAgICAgICAgICAgLy8gcHJvY2VzcyB3aXRob3V0IHJlZnJlc2ggcGFnZSBhbmQgYWRkIGhpc3RvcnkgZW50cnkKICAgICAgICAgICAgaWYgKGhhc2hJc1ZhbGlkKSB7CiAgICAgICAgICAgICAgICAvLyBodHRwOi8veC5jb20jIS8/dD0xIC0+IGh0dHA6Ly94LmNvbT90PTEKICAgICAgICAgICAgICAgIGlmICghdXJsUm9vdCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygyKTsKICAgICAgICAgICAgICAgICAgICBpZiAodG1wWzBdID09PSAnLycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gdG1wLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sICcnLCBocmVmID0gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdCArIGxvY2F0aW9uLnBhdGhuYW1lICsgdG1wKTsKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyUm91dGUgPSAxOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1dGlscy5lcXVhbHNJZ25vcmVTbGFzaChsb2NQYXRoLCB1cmxSb290KSkgewogICAgICAgICAgICAgICAgICAgIC8vIHB1dCBoYXNoIHRvIHBhdGgKICAgICAgICAgICAgICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgJycsIGhyZWYgPSB1dGlscy5nZXRGdWxsUGF0aChoYXNoLCB1cmxSb290KSk7CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlclJvdXRlID0gMTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigncm91dGVyOiBsb2NhdGlvbiBwYXRoIG11c3QgYmUgc2FtZSB3aXRoIHVybFJvb3QhJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCF1dGlscy5lcXVhbHNJZ25vcmVTbGFzaChsb2NQYXRoLCB1cmxSb290KSkgewogICAgICAgICAgICAvLyBodHRwOi8veC5jb20veC95CiAgICAgICAgICAgIC8vID0+CiAgICAgICAgICAgIC8vIGh0dHA6Ly94LmNvbS8jIS94L3kKICAgICAgICAgICAgLy8gPT4KICAgICAgICAgICAgLy8gcmVmcmVzaCBwYWdlIHdpdGhvdXQgYWRkIGhpc3RvcnkgZW50cnkKICAgICAgICAgICAgbG9jYXRpb24ucmVwbGFjZSh1dGlscy5hZGRFbmRTbGFzaCh1cmxSb290KSArICcjIScgKyBoYXNoKTsKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1c2VIYXNoID0gdHJ1ZTsKICAgICAgICB9CiAgICB9ICAgIC8vIHByZXZlbnQgaGFzaENoYW5nZSB0cmlnZ2VyIG9uIHN0YXJ0CiAgICAvLyBwcmV2ZW50IGhhc2hDaGFuZ2UgdHJpZ2dlciBvbiBzdGFydAogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIG5lZWRSZXBsYWNlSGlzdG9yeSA9IHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlOwogICAgICAgIGlmIChzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSkgewogICAgICAgICAgICBEb21FdmVudC5vbih3aW4sICdwb3BzdGF0ZScsIG9uUG9wU3RhdGUpOyAgICAvLyBodG1sNSB0cmlnZ2VyUm91dGUgaXMgbGVhdmVkIHRvIHVzZXIgZGVjaXNpb24KICAgICAgICAgICAgLy8gaWYgcHJvdmlkZSBubyAjISBoYXNoCiAgICAgICAgfSBlbHNlCiAgICAgICAgLy8gaHRtbDUgdHJpZ2dlclJvdXRlIGlzIGxlYXZlZCB0byB1c2VyIGRlY2lzaW9uCiAgICAgICAgLy8gaWYgcHJvdmlkZSBubyAjISBoYXNoCiAgICAgICAgewogICAgICAgICAgICBEb21FdmVudC5vbih3aW4sICdoYXNoY2hhbmdlJywgb25IYXNoQ2hhbmdlKTsgICAgLy8gaGFzaC1iYXNlZCBicm93c2VyIGlzIGZvcmNlZCB0byB0cmlnZ2VyIHJvdXRlCiAgICAgICAgICAgIC8vIGhhc2gtYmFzZWQgYnJvd3NlciBpcyBmb3JjZWQgdG8gdHJpZ2dlciByb3V0ZQogICAgICAgICAgICB0cmlnZ2VyUm91dGUgPSAxOwogICAgICAgIH0KICAgICAgICBpZiAodXNlSGFzaCkgewogICAgICAgICAgICBpZiAoIWdldFVybEZvclJvdXRlcigpKSB7CiAgICAgICAgICAgICAgICBleHBvcnRzLm5hdmlnYXRlKCcvJywgewogICAgICAgICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdHJpZ2dlclJvdXRlID0gMDsKICAgICAgICAgICAgICAgIG5lZWRSZXBsYWNlSGlzdG9yeSA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSAmJiBnZXRWaWRGcm9tVXJsV2l0aEhhc2goaHJlZikgIT09IHZpZXdVbmlxdWVJZCkgewogICAgICAgICAgICAgICAgc2V0UGF0aEJ5SGFzaCh1dGlscy5nZXRIYXNoKGhyZWYpLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRyaWdnZXJSb3V0ZSA9IDA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUgJiYgdXRpbHMuaGFzVmlkKGhyZWYpKSB7CiAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZXBsYWNlKGhyZWYgPSB1dGlscy5yZW1vdmVWaWQoaHJlZikpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChuZWVkUmVwbGFjZUhpc3RvcnkpIHsKICAgICAgICAgICAgLy8gZmlsbCBpbiBmaXJzdCBzdGF0ZQogICAgICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSh7dmlkOiB2aWV3VW5pcXVlSWR9LCAnJywgaHJlZik7CiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIGluaXRpYWwgaGFzaCBvbiBzdGFydAogICAgICAgIC8vIGluIGNhc2Ugc2VydmVyIGRvZXMgbm90IHJlbmRlciBpbml0aWFsIHN0YXRlIGNvcnJlY3RseQogICAgICAgIC8vIHdoZW4gbW9uaXRvciBoYXNoY2hhbmdlICxjbGllbnQgbXVzdCBiZSByZXNwb25zaWJsZSBmb3IgZGlzcGF0Y2hpbmcgYW5kIHJlbmRlcmluZy4KICAgICAgICAvLyBjaGVjayBpbml0aWFsIGhhc2ggb24gc3RhcnQKICAgICAgICAvLyBpbiBjYXNlIHNlcnZlciBkb2VzIG5vdCByZW5kZXIgaW5pdGlhbCBzdGF0ZSBjb3JyZWN0bHkKICAgICAgICAvLyB3aGVuIG1vbml0b3IgaGFzaGNoYW5nZSAsY2xpZW50IG11c3QgYmUgcmVzcG9uc2libGUgZm9yIGRpc3BhdGNoaW5nIGFuZCByZW5kZXJpbmcuCiAgICAgICAgaWYgKHRyaWdnZXJSb3V0ZSkgewogICAgICAgICAgICBkaXNwYXRjaChmYWxzZSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICBjYWxsYmFjayhleHBvcnRzKTsKICAgICAgICB9CiAgICB9LCBCUkVBVEhfSU5URVJWQUwpOwogICAgc3RhcnRlZCA9IHRydWU7CiAgICByZXR1cm4gZXhwb3J0czsKfTsKCmV4cG9ydHMuVXRpbHMgPSB1dGlsczsKCmV4cG9ydHMudmVyc2lvbiA9ICdAVkVSU0lPTkAnOwoKLy8gcHJpdmF0ZQpleHBvcnRzLnN0b3AgPSBmdW5jdGlvbiAoKSB7CiAgICBzdGFydGVkID0gZmFsc2U7CiAgICBEb21FdmVudC5kZXRhY2god2luLCAnaGFzaGNoYW5nZScsIG9uSGFzaENoYW5nZSk7CiAgICBEb21FdmVudC5kZXRhY2god2luLCAncG9wc3RhdGUnLCBvblBvcFN0YXRlKTsKfTsK",
                "body": "LyoqCiAqIEEgZXhwcmVzcy1saWtlIHJvdXRlcgogKiBAYXV0aG9yIHlpbWluZ2hlQGdtYWlsLmNvbQogKi8KdmFyIG1pZGRsZXdhcmVzID0gW107CnZhciByb3V0ZXMgPSBbXTsKdmFyIHV0aWxzID0gcmVxdWlyZSgnLi9yb3V0ZXIvdXRpbHMnKTsKdmFyIFJvdXRlID0gcmVxdWlyZSgnLi9yb3V0ZXIvcm91dGUnKTsKdmFyIHVybCA9IHJlcXVpcmUoJ3VybCcpOwp2YXIgUmVxdWVzdCA9IHJlcXVpcmUoJy4vcm91dGVyL3JlcXVlc3QnKTsKdmFyIERvbUV2ZW50ID0gcmVxdWlyZSgnZXZlbnQtZG9tJyk7Ci8qZ2xvYmFsIEN1c3RvbUV2ZW50OnRydWUsIGhpc3Rvcnk6dHJ1ZSovCnZhciBDdXN0b21FdmVudCA9IHJlcXVpcmUoJ2V2ZW50LWN1c3RvbScpOwp2YXIgZ2V0VmlkRnJvbVVybFdpdGhIYXNoID0gdXRpbHMuZ2V0VmlkRnJvbVVybFdpdGhIYXNoOwp2YXIgd2luID0gd2luZG93Owp2YXIgaGlzdG9yeSA9IHdpbi5oaXN0b3J5Owp2YXIgc3VwcG9ydE5hdGl2ZUhhc2hDaGFuZ2UgPSByZXF1aXJlKCdmZWF0dXJlJykuaXNIYXNoQ2hhbmdlU3VwcG9ydGVkKCk7CnZhciBzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSA9ICEhKGhpc3RvcnkgJiYgaGlzdG9yeS5wdXNoU3RhdGUpOwovLyB0YWtlIGEgYnJlYXRoIHRvIGF2b2lkIGR1cGxpY2F0ZSBoYXNoY2hhbmdlCnZhciBCUkVBVEhfSU5URVJWQUwgPSAxMDA7Ci8vIGZvciBqdWRnaW5nIGJhY2t3YXJkIG9yIGZvcndhcmQKdmFyIHZpZXdVbmlxdWVJZCA9IDEwOwp2YXIgdmlld3NIaXN0b3J5ID0gW3ZpZXdVbmlxdWVJZF07CnZhciBnbG9iYWxDb25maWcgPSB7CiAgICB1cmxSb290OiAnJywKICAgIHVzZUhhc2g6ICFzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZQp9OwoKZnVuY3Rpb24gc2V0UGF0aEJ5SGFzaChwYXRoLCByZXBsYWNlKSB7CiAgICB2YXIgaGFzaCA9IHV0aWxzLmFkZFZpZCgnIyEnICsgcGF0aCArCiAgICAgICAgICAgIC8vIGFkZCBoaXN0b3J5IGhhY2sgZm9yIGllNjcKICAgICAgICAgICAgKHN1cHBvcnROYXRpdmVIYXNoQ2hhbmdlID8gJycgOiAocmVwbGFjZSA/IERvbUV2ZW50LlJFUExBQ0VfSElTVE9SWSA6ICcnKSksCiAgICAgICAgdmlld1VuaXF1ZUlkKTsKICAgIGlmIChyZXBsYWNlKSB7CiAgICAgICAgbG9jYXRpb24ucmVwbGFjZShoYXNoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbG9jYXRpb24uaGFzaCA9IGhhc2g7CiAgICB9Cn0KCi8vIGdldCB1cmwgcGF0aCBmb3Igcm91dGVyIGRpc3BhdGNoCmZ1bmN0aW9uIGdldFVybEZvclJvdXRlcih1cmxTdHIpIHsKICAgIHVybFN0ciA9IHVybFN0ciB8fCBsb2NhdGlvbi5ocmVmOwogICAgdmFyIHVyaSA9IHVybC5wYXJzZSh1cmxTdHIpOwogICAgaWYgKCFnbG9iYWxDb25maWcudXNlSGFzaCAmJiBzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSkgewogICAgICAgIHJldHVybiB1cmkucGF0aG5hbWUuc3Vic3RyKGdsb2JhbENvbmZpZy51cmxSb290Lmxlbmd0aCkgKyAodXJpLnNlYXJjaCB8fCAnJyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB1dGlscy5nZXRIYXNoKHVybFN0cik7CiAgICB9Cn0KCmZ1bmN0aW9uIGZpcmVNaWRkbGVXYXJlKHJlcXVlc3QsIHJlc3BvbnNlLCBjYikgewogICAgdmFyIGluZGV4ID0gLTE7CiAgICB2YXIgbGVuID0gbWlkZGxld2FyZXMubGVuZ3RoOwoKICAgIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgICBpZiAoaW5kZXggPT09IGxlbikgewogICAgICAgICAgICBjYihyZXF1ZXN0LCByZXNwb25zZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG1pZGRsZXdhcmUgPSBtaWRkbGV3YXJlc1tpbmRleF07CiAgICAgICAgICAgIGlmICh1dGlscy5zdGFydHNXaXRoKHJlcXVlc3QucGF0aCArICcvJywgbWlkZGxld2FyZVswXSArICcvJykpIHsKICAgICAgICAgICAgICAgIHZhciBwcmVmaXhMZW4gPSBtaWRkbGV3YXJlWzBdLmxlbmd0aDsKICAgICAgICAgICAgICAgIHJlcXVlc3QudXJsID0gcmVxdWVzdC51cmwuc2xpY2UocHJlZml4TGVuKTsKICAgICAgICAgICAgICAgIHZhciBwYXRoID0gcmVxdWVzdC5wYXRoOwogICAgICAgICAgICAgICAgcmVxdWVzdC5wYXRoID0gcmVxdWVzdC5wYXRoLnNsaWNlKHByZWZpeExlbik7CiAgICAgICAgICAgICAgICBtaWRkbGV3YXJlWzFdKHJlcXVlc3QsIG5leHQpOwogICAgICAgICAgICAgICAgcmVxdWVzdC51cmwgPSByZXF1ZXN0Lm9yaWdpbmFsVXJsOwogICAgICAgICAgICAgICAgcmVxdWVzdC5wYXRoID0gcGF0aDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBuZXh0KCk7Cn0KCmZ1bmN0aW9uIGZpcmVSb3V0ZXMocmVxdWVzdCwgcmVzcG9uc2UpIHsKICAgIHZhciBpbmRleCA9IC0xOwogICAgdmFyIGxlbiA9IHJvdXRlcy5sZW5ndGg7CgogICAgZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICBpbmRleCsrOwogICAgICAgIGlmIChpbmRleCAhPT0gbGVuKSB7CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHJvdXRlc1tpbmRleF07CiAgICAgICAgICAgIGlmICgocmVxdWVzdC5wYXJhbXMgPSByb3V0ZS5tYXRjaChyZXF1ZXN0LnBhdGgpKSkgewogICAgICAgICAgICAgICAgdmFyIGNhbGxiYWNrSW5kZXggPSAtMTsKICAgICAgICAgICAgICAgIHZhciBjYWxsYmFja3MgPSByb3V0ZS5jYWxsYmFja3M7CiAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2tzTGVuID0gY2FsbGJhY2tzLmxlbmd0aDsKICAgICAgICAgICAgICAgIHZhciBuZXh0Q2FsbGJhY2sgPSBmdW5jdGlvbiAoY2F1c2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY2F1c2UgPT09ICdyb3V0ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dENhbGxiYWNrID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrSW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrSW5kZXggIT09IGNhbGxiYWNrc0xlbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yb3V0ZSA9IHJvdXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzW2NhbGxiYWNrSW5kZXhdKHJlcXVlc3QsIHJlc3BvbnNlLCBuZXh0Q2FsbGJhY2spOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIG5leHRDYWxsYmFjaygnJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgbmV4dCgpOwp9CgpmdW5jdGlvbiBkaXNwYXRjaChiYWNrd2FyZCwgcmVwbGFjZSkgewogICAgdmFyIHVybFN0ciA9IGdldFVybEZvclJvdXRlcigpOwogICAgdmFyIHVyaSA9IHVybC5wYXJzZSh1cmxTdHIsIHRydWUpOwogICAgdmFyIHF1ZXJ5ID0gdXJpLnF1ZXJ5OwogICAgdXJpLnNlYXJjaCA9ICcnOwogICAgdXJpLnF1ZXJ5ID0ge307CiAgICAvLyBub3JtYWxpemUgdG8gJy8nCiAgICB2YXIgcGF0aCA9IHVybC5zdHJpbmdpZnkodXJpKSB8fCAnLyc7CiAgICB2YXIgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KHsKICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgLy8gYmFja3dhcmQgb3IgZm9yd2FyZAogICAgICAgIGJhY2t3YXJkOiBiYWNrd2FyZCA9PT0gdHJ1ZSwKICAgICAgICAvLyByZXBsYWNlIGhpc3RvcnkKICAgICAgICByZXBsYWNlOiByZXBsYWNlID09PSB0cnVlLAogICAgICAgIGZvcndhcmQ6IChiYWNrd2FyZCA9PT0gZmFsc2UgJiYgcmVwbGFjZSA9PT0gZmFsc2UpLAogICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgdXJsOiB1cmxTdHIsCiAgICAgICAgb3JpZ2luYWxVcmw6IHVybFN0cgogICAgfSk7CiAgICB2YXIgcmVzcG9uc2UgPSB7CiAgICAgICAgcmVkaXJlY3Q6IGV4cG9ydHMubmF2aWdhdGUKICAgIH07CiAgICBleHBvcnRzLmZpcmUoJ2Rpc3BhdGNoJywgewogICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsCiAgICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlCiAgICB9KTsKICAgIGZpcmVNaWRkbGVXYXJlKHJlcXVlc3QsIHJlc3BvbnNlLCBmaXJlUm91dGVzKTsKfQoKLyoqCiAqIFJvdXRlciB1c2luZyBoYXNoIG9yIGh0bWw1IGhpc3RvcnkKICogQGNsYXNzIEtJU1NZLlJvdXRlcgogKiBAc2luZ2xldG9uCiAqLwoKdXRpbHMubWl4KGV4cG9ydHMsIEN1c3RvbUV2ZW50LlRhcmdldCk7CgovKioKICogY29uZmlnIG1pZGRsZXdhcmUgZm9yIHJvdXRlcgogKiBAcGFyYW0ge1N0cmluZ30gcHJlZml4IGNvbmZpZyBwcmVmaXggdG8gZGVjaWRlIHdoaWNoIHBhdGggaXMgcHJvY2Vzc2VkCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIG1pZGRsZXdhcmUgbG9naWMgZnVuY3Rpb24KICovCmV4cG9ydHMudXNlID0gZnVuY3Rpb24gKHByZWZpeCwgY2FsbGJhY2spIHsKICAgIGlmICh0eXBlb2YgcHJlZml4ICE9PSAnc3RyaW5nJykgewogICAgICAgIGNhbGxiYWNrID0gcHJlZml4OwogICAgICAgIHByZWZpeCA9ICcnOwogICAgfQogICAgbWlkZGxld2FyZXMucHVzaChbcHJlZml4LCBjYWxsYmFja10pOwp9OwoKLyoqCiAqIE5hdmlnYXRlIHRvIHNwZWNpZmllZCBwYXRoLgogKiBAc3RhdGljCiAqIEBtZW1iZXIgS0lTU1kuUm91dGVyCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoIERlc3RpbmF0aW9uIHBhdGguCiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0c10gQ29uZmlnIGZvciBjdXJyZW50IG5hdmlnYXRpb24uCiAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0cy50cmlnZ2VyUm91dGUgV2hldGhlciB0byB0cmlnZ2VyIHJlc3BvbmRpbmcgYWN0aW9uCiAqICAgICAgICAgICAgICAgICAgZXZlbiBjdXJyZW50IHBhdGggaXMgc2FtZSBhcyBwYXJhbWV0ZXIKICovCmV4cG9ydHMubmF2aWdhdGUgPSBmdW5jdGlvbiAocGF0aCwgb3B0cykgewogICAgb3B0cyA9IG9wdHMgfHwge307CiAgICB2YXIgcmVwbGFjZSA9IG9wdHMucmVwbGFjZSB8fCBmYWxzZTsKICAgIHZhciB1cmxTdHIgPSBnZXRVcmxGb3JSb3V0ZXIoKTsKICAgIHZhciB1cmkgPSB1cmwucGFyc2UodXJsU3RyKTsKICAgIGlmIChwYXRoLmNoYXJBdCgwKSA9PT0gJz8nKSB7CiAgICAgICAgdXJpLnNlYXJjaCA9IHBhdGg7CiAgICAgICAgcGF0aCA9IHVybC5zdHJpbmdpZnkodXJpKTsKICAgIH0KICAgIGlmICh1cmxTdHIgIT09IHBhdGgpIHsKICAgICAgICBpZiAoIXJlcGxhY2UpIHsKICAgICAgICAgICAgdmlld1VuaXF1ZUlkKys7CiAgICAgICAgICAgIHZpZXdzSGlzdG9yeS5wdXNoKHZpZXdVbmlxdWVJZCk7CiAgICAgICAgfQogICAgICAgIC8vUy5sb2coJ2N1cnJlbnQ6ICcgKyB2aWV3c0hpc3RvcnkpOwogICAgICAgIGlmICghZ2xvYmFsQ29uZmlnLnVzZUhhc2ggJiYgc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUpIHsKICAgICAgICAgICAgaGlzdG9yeVtyZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oewogICAgICAgICAgICAgICAgdmlkOiB2aWV3VW5pcXVlSWQKICAgICAgICAgICAgfSwgJycsIHV0aWxzLmdldEZ1bGxQYXRoKHBhdGgsIGdsb2JhbENvbmZpZy51cmxSb290KSk7CiAgICAgICAgICAgIC8vIHB1c2hTdGF0ZSBkb2VzIG5vdCBmaXJlIHBvcHN0YXRlIGV2ZW50ICh1bmxpa2UgaGFzaGNoYW5nZSkKICAgICAgICAgICAgLy8gc28gcG9wc3RhdGUgaXMgbm90IHN0YXRlY2hhbmdlCiAgICAgICAgICAgIC8vIGZpcmUgbWFudWFsbHkKICAgICAgICAgICAgZGlzcGF0Y2goZmFsc2UsIHJlcGxhY2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZSkgewogICAgICAgICAgICAgICAgaGlzdG9yeVtyZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oewogICAgICAgICAgICAgICAgICAgIHZpZDogdmlld1VuaXF1ZUlkCiAgICAgICAgICAgICAgICB9LCAnJywgJyMhJyArIHBhdGgpOwogICAgICAgICAgICAgICAgZGlzcGF0Y2goZmFsc2UsIHJlcGxhY2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2V0UGF0aEJ5SGFzaChwYXRoLCByZXBsYWNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAob3B0cyAmJiBvcHRzLnRyaWdnZXJSb3V0ZSkgewogICAgICAgIGRpc3BhdGNoKGZhbHNlLCB0cnVlKTsKICAgIH0KfTsKCi8qKgogKiBhZGQgcm91dGUgYW5kIGl0cyBjYWxsYmFja3MKICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSByb3V0ZVBhdGggcm91dGUgc3RyaW5nIG9yIHJlZ2V4cAogKi8KZXhwb3J0cy5nZXQgPSBmdW5jdGlvbiAocm91dGVQYXRoKSB7CiAgICB2YXIgY2FsbGJhY2tzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7CiAgICByb3V0ZXMucHVzaChuZXcgUm91dGUocm91dGVQYXRoLCBjYWxsYmFja3MsIGdsb2JhbENvbmZpZykpOwp9OwoKLyoqCiAqIHdoZXRoZXIgdXJsIHBhdGggbWF0Y2ggY29uZmlnIHJvdXRlcwogKiBAcGFyYW0ge1N0cmluZ30gcGF0aCB1cmwgcGF0aAogKiBAcmV0dXJucyB7Qm9vbGVhbn0KICovCmV4cG9ydHMubWF0Y2hSb3V0ZSA9IGZ1bmN0aW9uIChwYXRoKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHJvdXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBpZiAocm91dGVzW2ldLm1hdGNoKHBhdGgpKSB7CiAgICAgICAgICAgIHJldHVybiByb3V0ZXNbaV07CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9OwoKLyoqCiAqIHJlbW92ZSBzcGVjaWZpZWQgcm91dGUKICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSByb3V0ZVBhdGggcm91dGUgc3RyaW5nIG9yIHJlZ2V4cAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2tdIHJvdXRlciBjYWxsYmFjawogKi8KZXhwb3J0cy5yZW1vdmVSb3V0ZSA9IGZ1bmN0aW9uIChyb3V0ZVBhdGgsIGNhbGxiYWNrKSB7CiAgICBmb3IgKHZhciBpID0gcm91dGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgdmFyIHIgPSByb3V0ZXNbaV07CiAgICAgICAgaWYgKHIucGF0aCA9PT0gcm91dGVQYXRoKSB7CiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgci5yZW1vdmVDYWxsYmFjayhjYWxsYmFjayk7CiAgICAgICAgICAgICAgICBpZiAoIXIuY2FsbGJhY2tzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHJvdXRlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByb3V0ZXMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9OwoKLy8gcHJpdmF0ZQpleHBvcnRzLmNsZWFyUm91dGVzID0gZnVuY3Rpb24gKCkgewogICAgbWlkZGxld2FyZXMgPSBbXTsKICAgIHJvdXRlcyA9IFtdOwp9OwoKLyoqCiAqIHdoZXRoZXIgaGFzIHNwZWNpZmllZCByb3V0ZQogKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IHJvdXRlUGF0aCByb3V0ZSBzdHJpbmcgb3IgcmVnZXhwCiAqIEByZXR1cm5zIHtCb29sZWFufQogKi8KZXhwb3J0cy5oYXNSb3V0ZSA9IGZ1bmN0aW9uIChyb3V0ZVBhdGgpIHsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcm91dGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGlmIChyb3V0ZXNbaV0ucGF0aCA9PT0gcm91dGVQYXRoKSB7CiAgICAgICAgICAgIHJldHVybiByb3V0ZXNbaV07CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9OwoKZnVuY3Rpb24gZGlzcGF0Y2hCeVZpZCh2aWQpIHsKICAgIHZhciBiYWNrd2FyZCA9IGZhbHNlOwogICAgdmFyIHJlcGxhY2UgPSBmYWxzZTsKCiAgICBpZiAodmlkID09PSB2aWV3c0hpc3Rvcnlbdmlld3NIaXN0b3J5Lmxlbmd0aCAtIDJdKSB7CiAgICAgICAgYmFja3dhcmQgPSB0cnVlOwogICAgICAgIHZpZXdzSGlzdG9yeS5wb3AoKTsKICAgIH0gZWxzZSBpZiAoCiAgICAvLyAgd2hlbiBoYXNoY2hhbmdlIG1vZGUgYWxyZWFkeSBwdXNoIHZpZCBieSBuYXZpZ2F0ZQogICAgICAgIHZpZCAhPT0gdmlld3NIaXN0b3J5W3ZpZXdzSGlzdG9yeS5sZW5ndGggLSAxXSkgewogICAgICAgIHZpZXdzSGlzdG9yeS5wdXNoKHZpZCk7CiAgICB9IGVsc2UgewogICAgICAgIHJlcGxhY2UgPSB0cnVlOwogICAgfQoKICAgIGRpc3BhdGNoKGJhY2t3YXJkLCByZXBsYWNlKTsKfQoKZnVuY3Rpb24gb25Qb3BTdGF0ZShlKSB7CiAgICAvLyBwYWdlIHRvIGJlIHJlbmRlcmVkCiAgICB2YXIgc3RhdGUgPSBlLm9yaWdpbmFsRXZlbnQuc3RhdGU7CiAgICAvLyBpbnB1dCB1cmwgZGlyZWN0bHkKICAgIGlmICghc3RhdGUpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBkaXNwYXRjaEJ5VmlkKHN0YXRlLnZpZCk7Cn0KCmZ1bmN0aW9uIG9uSGFzaENoYW5nZShlKSB7CiAgICAvL1MubG9nKCdvbkhhc2hDaGFuZ2UnKTsKICAgIC8vIG5vIHZpZXcgaWQsIGp1c3QgcmV0dXJuCiAgICB2YXIgbmV3VVJMID0gZS5uZXdVUkwgfHwgbG9jYXRpb24uaHJlZjsKICAgIHZhciB2aWQgPSBnZXRWaWRGcm9tVXJsV2l0aEhhc2gobmV3VVJMKTsKICAgIGlmICghdmlkKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZGlzcGF0Y2hCeVZpZCh2aWQpOwp9CgovKioKICogQ29uZmlnIHJvdXRlcgogKiBAc3RhdGljCiAqIEBtZW1iZXIgS0lTU1kuUm91dGVyCiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0c10KICogQHBhcmFtIHtCb29sZWFufSBbb3B0cy5jYXNlU2Vuc2l0aXZlXSBlbmFibGUgY2FzZS1zZW5zaXRpdmUgcm91dGVzCiAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdHMuc3RyaWN0XSBlbmFibGUgc3RyaWN0IG1hdGNoaW5nIGZvciB0cmFpbGluZyBzbGFzaGVzCiAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0cy51cmxSb290XSBTcGVjaWZ5IHVybCByb290IGZvciBodG1sNSBoaXN0b3J5IG1hbmFnZW1lbnQuCiAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdHMudXNlSGFzaF0gZm9yY2UgdG8gdXNlIGhhc2ggdXJsIGZvciBuYXZpZ2F0aW9uIGV2ZW4gZm9yIGJyb3dzZXIgd2hpY2ggc3VwcG9ydCBodG1sNSBoaXN0b3J5LgogKiBmYWxzZSBpcyBvbmx5IGludmFsaWQgZm9yIGh0bWwgaGlzdG9yeSBzdXBwb3J0ZWQgYnJvd3NlcnMKICovCmV4cG9ydHMuY29uZmlnID0gZnVuY3Rpb24gKG9wdHMpIHsKICAgIGlmIChvcHRzLnVybFJvb3QpIHsKICAgICAgICBvcHRzLnVybFJvb3QgPSBvcHRzLnVybFJvb3QucmVwbGFjZSgvXC8kLywgJycpOwogICAgfQogICAgdXRpbHMubWl4KGdsb2JhbENvbmZpZywgb3B0cyk7Cn07Cgp2YXIgc3RhcnRlZDsKCi8qKgogKiBTdGFydCByb3V0ZXIgKHVybCBtb25pdG9yKS4KICogQHN0YXRpYwogKiBAbWVtYmVyIEtJU1NZLlJvdXRlcgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2tdIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBhZnRlciByb3V0ZXIgaXMgc3RhcnRlZC4KICovCmV4cG9ydHMuc3RhcnQgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgIGlmIChzdGFydGVkKSB7CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoZXhwb3J0cyk7CiAgICB9CiAgICB2YXIgdXNlSGFzaCA9IGdsb2JhbENvbmZpZy51c2VIYXNoLCB1cmxSb290ID0gZ2xvYmFsQ29uZmlnLnVybFJvb3QsIHRyaWdnZXJSb3V0ZSA9IGdsb2JhbENvbmZpZy50cmlnZ2VyUm91dGUsIGxvY1BhdGggPSBsb2NhdGlvbi5wYXRobmFtZSwgaHJlZiA9IGxvY2F0aW9uLmhyZWYsIGhhc2ggPSBnZXRVcmxGb3JSb3V0ZXIoKSwgaGFzaElzVmFsaWQgPSBsb2NhdGlvbi5oYXNoLm1hdGNoKC8jIS4rLyk7CiAgICBpZiAoIXVzZUhhc2gpIHsKICAgICAgICBpZiAoc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUpIHsKICAgICAgICAgICAgLy8gaHR0cDovL3guY29tLyMhL3gveQogICAgICAgICAgICAvLyA9PgogICAgICAgICAgICAvLyBodHRwOi8veC5jb20veC95CiAgICAgICAgICAgIC8vID0+CiAgICAgICAgICAgIC8vIHByb2Nlc3Mgd2l0aG91dCByZWZyZXNoIHBhZ2UgYW5kIGFkZCBoaXN0b3J5IGVudHJ5CiAgICAgICAgICAgIGlmIChoYXNoSXNWYWxpZCkgewogICAgICAgICAgICAgICAgLy8gaHR0cDovL3guY29tIyEvP3Q9MSAtPiBodHRwOi8veC5jb20/dD0xCiAgICAgICAgICAgICAgICBpZiAoIXVybFJvb3QpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gbG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRtcFswXSA9PT0gJy8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IHRtcC5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCAnJywgaHJlZiA9IGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3QgKyBsb2NhdGlvbi5wYXRobmFtZSArIHRtcCk7CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlclJvdXRlID0gMTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXRpbHMuZXF1YWxzSWdub3JlU2xhc2gobG9jUGF0aCwgdXJsUm9vdCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBwdXQgaGFzaCB0byBwYXRoCiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sICcnLCBocmVmID0gdXRpbHMuZ2V0RnVsbFBhdGgoaGFzaCwgdXJsUm9vdCkpOwogICAgICAgICAgICAgICAgICAgIHRyaWdnZXJSb3V0ZSA9IDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3JvdXRlcjogbG9jYXRpb24gcGF0aCBtdXN0IGJlIHNhbWUgd2l0aCB1cmxSb290IScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghdXRpbHMuZXF1YWxzSWdub3JlU2xhc2gobG9jUGF0aCwgdXJsUm9vdCkpIHsKICAgICAgICAgICAgLy8gaHR0cDovL3guY29tL3gveQogICAgICAgICAgICAvLyA9PgogICAgICAgICAgICAvLyBodHRwOi8veC5jb20vIyEveC95CiAgICAgICAgICAgIC8vID0+CiAgICAgICAgICAgIC8vIHJlZnJlc2ggcGFnZSB3aXRob3V0IGFkZCBoaXN0b3J5IGVudHJ5CiAgICAgICAgICAgIGxvY2F0aW9uLnJlcGxhY2UodXRpbHMuYWRkRW5kU2xhc2godXJsUm9vdCkgKyAnIyEnICsgaGFzaCk7CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdXNlSGFzaCA9IHRydWU7CiAgICAgICAgfQogICAgfSAgICAvLyBwcmV2ZW50IGhhc2hDaGFuZ2UgdHJpZ2dlciBvbiBzdGFydAogICAgLy8gcHJldmVudCBoYXNoQ2hhbmdlIHRyaWdnZXIgb24gc3RhcnQKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBuZWVkUmVwbGFjZUhpc3RvcnkgPSBzdXBwb3J0SGlzdG9yeVB1c2hTdGF0ZTsKICAgICAgICBpZiAoc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUpIHsKICAgICAgICAgICAgRG9tRXZlbnQub24od2luLCAncG9wc3RhdGUnLCBvblBvcFN0YXRlKTsgICAgLy8gaHRtbDUgdHJpZ2dlclJvdXRlIGlzIGxlYXZlZCB0byB1c2VyIGRlY2lzaW9uCiAgICAgICAgICAgIC8vIGlmIHByb3ZpZGUgbm8gIyEgaGFzaAogICAgICAgIH0gZWxzZQogICAgICAgIC8vIGh0bWw1IHRyaWdnZXJSb3V0ZSBpcyBsZWF2ZWQgdG8gdXNlciBkZWNpc2lvbgogICAgICAgIC8vIGlmIHByb3ZpZGUgbm8gIyEgaGFzaAogICAgICAgIHsKICAgICAgICAgICAgRG9tRXZlbnQub24od2luLCAnaGFzaGNoYW5nZScsIG9uSGFzaENoYW5nZSk7ICAgIC8vIGhhc2gtYmFzZWQgYnJvd3NlciBpcyBmb3JjZWQgdG8gdHJpZ2dlciByb3V0ZQogICAgICAgICAgICAvLyBoYXNoLWJhc2VkIGJyb3dzZXIgaXMgZm9yY2VkIHRvIHRyaWdnZXIgcm91dGUKICAgICAgICAgICAgdHJpZ2dlclJvdXRlID0gMTsKICAgICAgICB9CiAgICAgICAgaWYgKHVzZUhhc2gpIHsKICAgICAgICAgICAgaWYgKCFnZXRVcmxGb3JSb3V0ZXIoKSkgewogICAgICAgICAgICAgICAgZXhwb3J0cy5uYXZpZ2F0ZSgnLycsIHsKICAgICAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRyaWdnZXJSb3V0ZSA9IDA7CiAgICAgICAgICAgICAgICBuZWVkUmVwbGFjZUhpc3RvcnkgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmICghc3VwcG9ydEhpc3RvcnlQdXNoU3RhdGUgJiYgZ2V0VmlkRnJvbVVybFdpdGhIYXNoKGhyZWYpICE9PSB2aWV3VW5pcXVlSWQpIHsKICAgICAgICAgICAgICAgIHNldFBhdGhCeUhhc2godXRpbHMuZ2V0SGFzaChocmVmKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB0cmlnZ2VyUm91dGUgPSAwOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnRIaXN0b3J5UHVzaFN0YXRlICYmIHV0aWxzLmhhc1ZpZChocmVmKSkgewogICAgICAgICAgICAgICAgbG9jYXRpb24ucmVwbGFjZShocmVmID0gdXRpbHMucmVtb3ZlVmlkKGhyZWYpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAobmVlZFJlcGxhY2VIaXN0b3J5KSB7CiAgICAgICAgICAgIC8vIGZpbGwgaW4gZmlyc3Qgc3RhdGUKICAgICAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoe3ZpZDogdmlld1VuaXF1ZUlkfSwgJycsIGhyZWYpOwogICAgICAgIH0KICAgICAgICAvLyBjaGVjayBpbml0aWFsIGhhc2ggb24gc3RhcnQKICAgICAgICAvLyBpbiBjYXNlIHNlcnZlciBkb2VzIG5vdCByZW5kZXIgaW5pdGlhbCBzdGF0ZSBjb3JyZWN0bHkKICAgICAgICAvLyB3aGVuIG1vbml0b3IgaGFzaGNoYW5nZSAsY2xpZW50IG11c3QgYmUgcmVzcG9uc2libGUgZm9yIGRpc3BhdGNoaW5nIGFuZCByZW5kZXJpbmcuCiAgICAgICAgLy8gY2hlY2sgaW5pdGlhbCBoYXNoIG9uIHN0YXJ0CiAgICAgICAgLy8gaW4gY2FzZSBzZXJ2ZXIgZG9lcyBub3QgcmVuZGVyIGluaXRpYWwgc3RhdGUgY29ycmVjdGx5CiAgICAgICAgLy8gd2hlbiBtb25pdG9yIGhhc2hjaGFuZ2UgLGNsaWVudCBtdXN0IGJlIHJlc3BvbnNpYmxlIGZvciBkaXNwYXRjaGluZyBhbmQgcmVuZGVyaW5nLgogICAgICAgIGlmICh0cmlnZ2VyUm91dGUpIHsKICAgICAgICAgICAgZGlzcGF0Y2goZmFsc2UsIHRydWUpOwogICAgICAgIH0KICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgY2FsbGJhY2soZXhwb3J0cyk7CiAgICAgICAgfQogICAgfSwgQlJFQVRIX0lOVEVSVkFMKTsKICAgIHN0YXJ0ZWQgPSB0cnVlOwogICAgcmV0dXJuIGV4cG9ydHM7Cn07CgpleHBvcnRzLlV0aWxzID0gdXRpbHM7CgpleHBvcnRzLnZlcnNpb24gPSAnQFZFUlNJT05AJzsKCi8vIHByaXZhdGUKZXhwb3J0cy5zdG9wID0gZnVuY3Rpb24gKCkgewogICAgc3RhcnRlZCA9IGZhbHNlOwogICAgRG9tRXZlbnQuZGV0YWNoKHdpbiwgJ2hhc2hjaGFuZ2UnLCBvbkhhc2hDaGFuZ2UpOwogICAgRG9tRXZlbnQuZGV0YWNoKHdpbiwgJ3BvcHN0YXRlJywgb25Qb3BTdGF0ZSk7Cn07Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 16:22:49 GMT",
                    "Content-Length": "13507",
                    "Date": "Fri, 07 Nov 2014 16:22:49 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}