{
    "url": "http://localhost:9999/blacklocus/jquery-impression/jquery.impression.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>window.location.href</b> and written to <b>the 'href' property of a DOM element</b> via the following statement:<ul><li>id.href = window.location.href;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/blacklocus/jquery-impression/jquery.impression.js",
                "path": "/blacklocus/jquery-impression/jquery.impression.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9ibGFja2xvY3VzL2pxdWVyeS1pbXByZXNzaW9uL2pxdWVyeS5pbXByZXNzaW9uLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNjUxOA0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAwNjozNDoxMCBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMDY6MzQ6MTAgR01UDQoNCihmdW5jdGlvbiAoJCkgewoKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFV0aWxpdHkKCiAgICBTdHJpbmcucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL3soXGQrKX0vZywgZnVuY3Rpb24obWF0Y2gsIG51bWJlcikgewogICAgICAgICAgICByZXR1cm4gdHlwZW9mIGFyZ3NbbnVtYmVyXSAhPSAndW5kZWZpbmVkJyA/IGFyZ3NbbnVtYmVyXSA6IG1hdGNoOwogICAgICAgIH0pOwogICAgfTsKCiAgICAvKioKICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IHRoYXQgaXMgdGhlIGhhc2hjb2RlIG9mIHNvbWUgc3RyaW5nCiAgICAgKi8KICAgIFN0cmluZy5wcm90b3R5cGUuaGFzaENvZGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaGFzaCA9IDAsIGksICRjaGFyOwogICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PSAwKSByZXR1cm4gaGFzaDsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgJGNoYXIgID0gdGhpcy5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgICBoYXNoICA9ICgoaGFzaDw8NSktaGFzaCkrJGNoYXI7CiAgICAgICAgICAgIGhhc2ggfD0gMDsgLy8gQ29udmVydCB0byAzMmJpdCBpbnRlZ2VyCiAgICAgICAgfQogICAgICAgIHJldHVybiBoYXNoOwogICAgfTsKCiAgICAvKiogdHVybiBhIGZvcm0gaW50byBhIGpzIG9iamVjdCAqLwogICAgJC5mbi5zZXJpYWxpemVPYmplY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIG8gPSB7fTsKICAgICAgICB2YXIgYSA9IHRoaXMuc2VyaWFsaXplQXJyYXkoKTsKICAgICAgICAkLmVhY2goYSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAob1t0aGlzLm5hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGlmICghb1t0aGlzLm5hbWVdLnB1c2gpIHsKICAgICAgICAgICAgICAgICAgICBvW3RoaXMubmFtZV0gPSBbb1t0aGlzLm5hbWVdXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9bdGhpcy5uYW1lXS5wdXNoKHRoaXMudmFsdWUgfHwgJycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgb1t0aGlzLm5hbWVdID0gdGhpcy52YWx1ZSB8fCAnJzsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBvOwogICAgfTsKCgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBqUXVlcnkuaW1wcmVzc2lvbgoKICAgIHZhciBrZXlQcmVmaXggPSAnanF1ZXJ5LmltcHJlc3Npb246JzsKCiAgICAvLyAkLnNlcmlhbGl6ZUFycmF5IChvbiB3aGljaCAkLnNlcmlhbGl6ZU9iamVjdCBpcyBiYXNlZCkgb25seSBwdWxscyBpbiB3aGF0IHdlIGNhcmUgYWJvdXQgZm9yIHRoZSBtb3N0IHBhcnQsCiAgICAvLyB3aGljaCBpcyBhYnNvbHV0ZWx5IGZhbnRhc3RpYyBhbmQgc3Vic2lkaXplcyBhIGxvdCBvZiB3b3JrLiBUaGVyZSBhcmUgYSBmZXcgZXhjbHVkZXMgbm9uZXRoZWxlc3MsIG5hbWVseSwKICAgIC8vIHBhc3N3b3JkIGZpZWxkcy4KICAgIHZhciBleGNsdWRlVHlwZXMgPSBbCiAgICAgICAgJ3Bhc3N3b3JkJwogICAgXTsKCiAgICAkLmZuLmltcHJlc3Npb24gPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgICAgICAvLyBub24temVybyBzZXQgb2YgaWRGaWVsZHMsIG90aGVyd2lzZSBpbmNsdWRlIGFsbAogICAgICAgIHZhciBpZEZpZWxkcyA9IG9wdGlvbnMuaWRGaWVsZHMgJiYgb3B0aW9ucy5pZEZpZWxkcy5sZW5ndGggJiYgb3B0aW9ucy5pZEZpZWxkcyB8fCBbJ2Zvcm1JZCcsICdmaWVsZEhhc2gnLCAnaHJlZiddOwogICAgICAgIHZhciBpZEZpZWxkc1NldCA9IHt9OwogICAgICAgICQuZWFjaChpZEZpZWxkcywgZnVuY3Rpb24oaWR4LCBlbCkgewogICAgICAgICAgICBpZEZpZWxkc1NldFtlbF0gPSB7fTsKICAgICAgICB9KTsKCgogICAgICAgIC8vIGRhdGEgZnVuY3Rpb25zCgogICAgICAgIGZ1bmN0aW9uIHByZXBhcmVJbXBEYXRhKGZvcm0pIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSBmb3JtLnNlcmlhbGl6ZU9iamVjdCgpOwoKICAgICAgICAgICAgLy8gRmlsdGVyIG91dCBleGNsdWRlZCB0eXBlcwogICAgICAgICAgICAkLmVhY2goZXhjbHVkZVR5cGVzLCBmdW5jdGlvbihpZHgsIGV4Y2x1ZGVUeXBlKSB7CiAgICAgICAgICAgICAgICB2YXIgaW5wdXRzID0gZm9ybS5maW5kKCdpbnB1dFt0eXBlPSJ7MH0iXVtuYW1lXScuZm9ybWF0KGV4Y2x1ZGVUeXBlKSk7CiAgICAgICAgICAgICAgICBpbnB1dHMuZWFjaChmdW5jdGlvbiAoaWR4LCBpbnB1dCkgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhWyQoaW5wdXQpLmF0dHIoJ25hbWUnKV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldFN0b3JhZ2VJZChmb3JtKSB7CiAgICAgICAgICAgIHZhciBpZCA9IHt9OwogICAgICAgICAgICBpZiAoaWRGaWVsZHNTZXQuZm9ybUlkKSB7CiAgICAgICAgICAgICAgICBpZC5mb3JtSWQgPSBmb3JtLmF0dHIoJ2lkJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlkRmllbGRzU2V0LmZpZWxkSGFzaCkgewogICAgICAgICAgICAgICAgaWQuZmllbGRIYXNoID0gSlNPTi5zdHJpbmdpZnkocHJlcGFyZUltcERhdGEoZm9ybSkpLmhhc2hDb2RlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlkRmllbGRzU2V0LmhyZWYpIHsKICAgICAgICAgICAgICAgIGlkLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4ga2V5UHJlZml4ICsgJC5wYXJhbShpZCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRJbXBEYXRhKHN0b3JhZ2VJZCkgewogICAgICAgICAgICB2YXIgaW1wRGF0YUpzb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShzdG9yYWdlSWQpOwogICAgICAgICAgICByZXR1cm4gaW1wRGF0YUpzb24gPyBKU09OLnBhcnNlKGltcERhdGFKc29uKSA6IHt9OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2F2ZUltcERhdGEoc3RvcmFnZUlkLCBmb3JtKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoJ3NhdmluZyAnICsgc3RvcmFnZUlkKTsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oc3RvcmFnZUlkLCBKU09OLnN0cmluZ2lmeShwcmVwYXJlSW1wRGF0YShmb3JtKSkpOwogICAgICAgIH0KCgoKICAgICAgICAvLyBjb3JlIGxvZ2ljCgogICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CiAgICAgICAgICAgIHZhciBzdG9yYWdlSWQgPSBnZXRTdG9yYWdlSWQoJHRoaXMpOwogICAgICAgICAgICB2YXIgaW1wRGF0YSA9IGdldEltcERhdGEoc3RvcmFnZUlkKTsKCiAgICAgICAgICAgICQuaW1wcmVzc2lvbi5hcHBseUZvcm0oJHRoaXMsIGltcERhdGEpOwoKICAgICAgICAgICAgJHRoaXMuY2hhbmdlKGZ1bmN0aW9uKGpxRXZlbnQpewogICAgICAgICAgICAgICAgc2F2ZUltcERhdGEoc3RvcmFnZUlkLCAkdGhpcyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJCh3aW5kb3cpLmJpbmQoImJlZm9yZXVubG9hZCIsIGZ1bmN0aW9uKGpxRXZlbnQpIHsKICAgICAgICAgICAgICAgIHNhdmVJbXBEYXRhKHN0b3JhZ2VJZCwgJHRoaXMpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgoKCiAgICAvLyBwdWJsaWMgZnVuY3Rpb25zCgogICAgJC5pbXByZXNzaW9uID0gewogICAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IGxvY2FsU3RvcmFnZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgdmFyIGtleSA9IGxvY2FsU3RvcmFnZS5rZXkoaSk7CiAgICAgICAgICAgICAgICBpZiAoa2V5LmluZGV4T2Yoa2V5UHJlZml4KSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoJ2RlbGV0aW5nICcgKyBrZXkpOwogICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkZm9ybSB0byBwb3B1bGF0ZQogICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXMgdG8gYXBwbHkgdG8gZm9ybQogICAgICAgICAqLwogICAgICAgIGFwcGx5Rm9ybTogZnVuY3Rpb24oJGZvcm0sIHZhbHVlcykgewogICAgICAgICAgICAkZm9ybVswXS5yZXNldCgpOwogICAgICAgICAgICAkLmVhY2godmFsdWVzLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWVzID0gW10uY29uY2F0KHZhbHVlKTsKICAgICAgICAgICAgICAgIHZhciBpbnB1dHMgPSAkZm9ybS5maW5kKCdbbmFtZT0iezB9Il0nLmZvcm1hdChrZXkpKTsKCiAgICAgICAgICAgICAgICAvLyByZXN0b3JlIGFueSBwcmV2aW91c2x5IGlucHV0IHZhbHVlcwogICAgICAgICAgICAgICAgaWYgKGlucHV0cy5pcygnW3R5cGU9Y2hlY2tib3hdJykpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjaGVja2JveGVzIHJlbWFpbiBhbm5veWluZyB0byB0aGlzIGRheQoKICAgICAgICAgICAgICAgICAgICB2YXIgc2Vjb25kYXJ5RmlsbCA9IFtdOwoKICAgICAgICAgICAgICAgICAgICAvLyBGaXJzdCB0aWNrIHZhbHVlZCBjaGVja2JveGVzLgogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZUF0dHIgPSB2YWx1ZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5wdXRzLmZpbHRlcignW3ZhbHVlPSJ7MH0iXTpub3QoOmNoZWNrZWQpOmZpcnN0Jy5mb3JtYXQodmFsdWVBdHRyKSkucHJvcCgnY2hlY2tlZCcsIHRydWUpLnNpemUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gbWF0Y2gsIGFkZCBpdCB0byBzZWNvbmRhcnkgZmlsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kYXJ5RmlsbC5wdXNoKHZhbHVlQXR0cik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFRoZW4gdGljayBhbnkgdW4tdmFsdWVkIGNoZWNrYm94ZXMgd2l0aCByZW1haW5pbmcgc2xvdHMuCiAgICAgICAgICAgICAgICAgICAgdmFyIG5vblZhbHVlID0gJCgnW3R5cGU9Y2hlY2tib3hdOm5vdChbdmFsdWVdKScpOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2Vjb25kYXJ5RmlsbC5sZW5ndGggJiYgaiA8IG5vblZhbHVlLnNpemUoKTsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQobm9uVmFsdWVbal0pLnByb3AoJ2NoZWNrZWQnLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbnB1dHMuaXMoJ1t0eXBlPXJhZGlvXScpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcmFkaW9zIHJlbWFpbiBhbm5veWluZyB0byB0aGlzIGRheQogICAgICAgICAgICAgICAgICAgIGlucHV0cy5maWx0ZXIoJ1t2YWx1ZT0iezB9Il0nLmZvcm1hdCh2YWx1ZSkpLnByb3AoJ2NoZWNrZWQnLCB0cnVlKTsKCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0cy5pcygnc2VsZWN0W211bHRpcGxlXScpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTXVsdGlwbGUgc2VsZWN0IGNhbiB0YWtlIGFuIGFycmF5IGRpcmVjdGx5LiBJbiBhZGRpdGlvbiBpZiBmb3Igc29tZSByZWFzb24gdGhlcmUgYXJlIG11bHRpcGxlCiAgICAgICAgICAgICAgICAgICAgLy8gbXVsdGlwbGUgc2VsZWN0cyBieSB0aGUgc2FtZSBuYW1lLCB0aGlzIHdpbGwgYWxzbyB0YWtlIGNhcmUgb2YgdGhhdC4KICAgICAgICAgICAgICAgICAgICBpbnB1dHMudmFsKHZhbHVlcyk7CgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dHMudmFsKGZ1bmN0aW9uKGlkeCwgb2xkVmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZXMubGVuZ3RoID4gaWR4ID8gdmFsdWVzW2lkeF0gOiBudWxsOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKCn0pKGpRdWVyeSk7",
                "body": "KGZ1bmN0aW9uICgkKSB7CgoKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gVXRpbGl0eQoKICAgIFN0cmluZy5wcm90b3R5cGUuZm9ybWF0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHRoaXMucmVwbGFjZSgveyhcZCspfS9nLCBmdW5jdGlvbihtYXRjaCwgbnVtYmVyKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgYXJnc1tudW1iZXJdICE9ICd1bmRlZmluZWQnID8gYXJnc1tudW1iZXJdIDogbWF0Y2g7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIC8qKgogICAgICogQHJldHVybnMge251bWJlcn0gdGhhdCBpcyB0aGUgaGFzaGNvZGUgb2Ygc29tZSBzdHJpbmcKICAgICAqLwogICAgU3RyaW5nLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBoYXNoID0gMCwgaSwgJGNoYXI7CiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09IDApIHJldHVybiBoYXNoOwogICAgICAgIGZvciAoaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAkY2hhciAgPSB0aGlzLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgICAgIGhhc2ggID0gKChoYXNoPDw1KS1oYXNoKSskY2hhcjsKICAgICAgICAgICAgaGFzaCB8PSAwOyAvLyBDb252ZXJ0IHRvIDMyYml0IGludGVnZXIKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhhc2g7CiAgICB9OwoKICAgIC8qKiB0dXJuIGEgZm9ybSBpbnRvIGEganMgb2JqZWN0ICovCiAgICAkLmZuLnNlcmlhbGl6ZU9iamVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbyA9IHt9OwogICAgICAgIHZhciBhID0gdGhpcy5zZXJpYWxpemVBcnJheSgpOwogICAgICAgICQuZWFjaChhLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChvW3RoaXMubmFtZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgaWYgKCFvW3RoaXMubmFtZV0ucHVzaCkgewogICAgICAgICAgICAgICAgICAgIG9bdGhpcy5uYW1lXSA9IFtvW3RoaXMubmFtZV1dOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb1t0aGlzLm5hbWVdLnB1c2godGhpcy52YWx1ZSB8fCAnJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvW3RoaXMubmFtZV0gPSB0aGlzLnZhbHVlIHx8ICcnOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG87CiAgICB9OwoKCgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIGpRdWVyeS5pbXByZXNzaW9uCgogICAgdmFyIGtleVByZWZpeCA9ICdqcXVlcnkuaW1wcmVzc2lvbjonOwoKICAgIC8vICQuc2VyaWFsaXplQXJyYXkgKG9uIHdoaWNoICQuc2VyaWFsaXplT2JqZWN0IGlzIGJhc2VkKSBvbmx5IHB1bGxzIGluIHdoYXQgd2UgY2FyZSBhYm91dCBmb3IgdGhlIG1vc3QgcGFydCwKICAgIC8vIHdoaWNoIGlzIGFic29sdXRlbHkgZmFudGFzdGljIGFuZCBzdWJzaWRpemVzIGEgbG90IG9mIHdvcmsuIFRoZXJlIGFyZSBhIGZldyBleGNsdWRlcyBub25ldGhlbGVzcywgbmFtZWx5LAogICAgLy8gcGFzc3dvcmQgZmllbGRzLgogICAgdmFyIGV4Y2x1ZGVUeXBlcyA9IFsKICAgICAgICAncGFzc3dvcmQnCiAgICBdOwoKICAgICQuZm4uaW1wcmVzc2lvbiA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICAgIC8vIG5vbi16ZXJvIHNldCBvZiBpZEZpZWxkcywgb3RoZXJ3aXNlIGluY2x1ZGUgYWxsCiAgICAgICAgdmFyIGlkRmllbGRzID0gb3B0aW9ucy5pZEZpZWxkcyAmJiBvcHRpb25zLmlkRmllbGRzLmxlbmd0aCAmJiBvcHRpb25zLmlkRmllbGRzIHx8IFsnZm9ybUlkJywgJ2ZpZWxkSGFzaCcsICdocmVmJ107CiAgICAgICAgdmFyIGlkRmllbGRzU2V0ID0ge307CiAgICAgICAgJC5lYWNoKGlkRmllbGRzLCBmdW5jdGlvbihpZHgsIGVsKSB7CiAgICAgICAgICAgIGlkRmllbGRzU2V0W2VsXSA9IHt9OwogICAgICAgIH0pOwoKCiAgICAgICAgLy8gZGF0YSBmdW5jdGlvbnMKCiAgICAgICAgZnVuY3Rpb24gcHJlcGFyZUltcERhdGEoZm9ybSkgewogICAgICAgICAgICB2YXIgZGF0YSA9IGZvcm0uc2VyaWFsaXplT2JqZWN0KCk7CgogICAgICAgICAgICAvLyBGaWx0ZXIgb3V0IGV4Y2x1ZGVkIHR5cGVzCiAgICAgICAgICAgICQuZWFjaChleGNsdWRlVHlwZXMsIGZ1bmN0aW9uKGlkeCwgZXhjbHVkZVR5cGUpIHsKICAgICAgICAgICAgICAgIHZhciBpbnB1dHMgPSBmb3JtLmZpbmQoJ2lucHV0W3R5cGU9InswfSJdW25hbWVdJy5mb3JtYXQoZXhjbHVkZVR5cGUpKTsKICAgICAgICAgICAgICAgIGlucHV0cy5lYWNoKGZ1bmN0aW9uIChpZHgsIGlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGRhdGFbJChpbnB1dCkuYXR0cignbmFtZScpXTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0U3RvcmFnZUlkKGZvcm0pIHsKICAgICAgICAgICAgdmFyIGlkID0ge307CiAgICAgICAgICAgIGlmIChpZEZpZWxkc1NldC5mb3JtSWQpIHsKICAgICAgICAgICAgICAgIGlkLmZvcm1JZCA9IGZvcm0uYXR0cignaWQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaWRGaWVsZHNTZXQuZmllbGRIYXNoKSB7CiAgICAgICAgICAgICAgICBpZC5maWVsZEhhc2ggPSBKU09OLnN0cmluZ2lmeShwcmVwYXJlSW1wRGF0YShmb3JtKSkuaGFzaENvZGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaWRGaWVsZHNTZXQuaHJlZikgewogICAgICAgICAgICAgICAgaWQuaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBrZXlQcmVmaXggKyAkLnBhcmFtKGlkKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldEltcERhdGEoc3RvcmFnZUlkKSB7CiAgICAgICAgICAgIHZhciBpbXBEYXRhSnNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VJZCk7CiAgICAgICAgICAgIHJldHVybiBpbXBEYXRhSnNvbiA/IEpTT04ucGFyc2UoaW1wRGF0YUpzb24pIDoge307CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzYXZlSW1wRGF0YShzdG9yYWdlSWQsIGZvcm0pIHsKICAgICAgICAgICAgY29uc29sZS5kZWJ1Zygnc2F2aW5nICcgKyBzdG9yYWdlSWQpOwogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yYWdlSWQsIEpTT04uc3RyaW5naWZ5KHByZXBhcmVJbXBEYXRhKGZvcm0pKSk7CiAgICAgICAgfQoKCgogICAgICAgIC8vIGNvcmUgbG9naWMKCiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsKICAgICAgICAgICAgdmFyIHN0b3JhZ2VJZCA9IGdldFN0b3JhZ2VJZCgkdGhpcyk7CiAgICAgICAgICAgIHZhciBpbXBEYXRhID0gZ2V0SW1wRGF0YShzdG9yYWdlSWQpOwoKICAgICAgICAgICAgJC5pbXByZXNzaW9uLmFwcGx5Rm9ybSgkdGhpcywgaW1wRGF0YSk7CgogICAgICAgICAgICAkdGhpcy5jaGFuZ2UoZnVuY3Rpb24oanFFdmVudCl7CiAgICAgICAgICAgICAgICBzYXZlSW1wRGF0YShzdG9yYWdlSWQsICR0aGlzKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkKHdpbmRvdykuYmluZCgiYmVmb3JldW5sb2FkIiwgZnVuY3Rpb24oanFFdmVudCkgewogICAgICAgICAgICAgICAgc2F2ZUltcERhdGEoc3RvcmFnZUlkLCAkdGhpcyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKCgoKICAgIC8vIHB1YmxpYyBmdW5jdGlvbnMKCiAgICAkLmltcHJlc3Npb24gPSB7CiAgICAgICAgY2xlYXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gbG9jYWxTdG9yYWdlLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gbG9jYWxTdG9yYWdlLmtleShpKTsKICAgICAgICAgICAgICAgIGlmIChrZXkuaW5kZXhPZihrZXlQcmVmaXgpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygnZGVsZXRpbmcgJyArIGtleSk7CiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9ICRmb3JtIHRvIHBvcHVsYXRlCiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IHZhbHVlcyB0byBhcHBseSB0byBmb3JtCiAgICAgICAgICovCiAgICAgICAgYXBwbHlGb3JtOiBmdW5jdGlvbigkZm9ybSwgdmFsdWVzKSB7CiAgICAgICAgICAgICRmb3JtWzBdLnJlc2V0KCk7CiAgICAgICAgICAgICQuZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZXMgPSBbXS5jb25jYXQodmFsdWUpOwogICAgICAgICAgICAgICAgdmFyIGlucHV0cyA9ICRmb3JtLmZpbmQoJ1tuYW1lPSJ7MH0iXScuZm9ybWF0KGtleSkpOwoKICAgICAgICAgICAgICAgIC8vIHJlc3RvcmUgYW55IHByZXZpb3VzbHkgaW5wdXQgdmFsdWVzCiAgICAgICAgICAgICAgICBpZiAoaW5wdXRzLmlzKCdbdHlwZT1jaGVja2JveF0nKSkgewogICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrYm94ZXMgcmVtYWluIGFubm95aW5nIHRvIHRoaXMgZGF5CgogICAgICAgICAgICAgICAgICAgIHZhciBzZWNvbmRhcnlGaWxsID0gW107CgogICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IHRpY2sgdmFsdWVkIGNoZWNrYm94ZXMuCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlQXR0ciA9IHZhbHVlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbnB1dHMuZmlsdGVyKCdbdmFsdWU9InswfSJdOm5vdCg6Y2hlY2tlZCk6Zmlyc3QnLmZvcm1hdCh2YWx1ZUF0dHIpKS5wcm9wKCdjaGVja2VkJywgdHJ1ZSkuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBtYXRjaCwgYWRkIGl0IHRvIHNlY29uZGFyeSBmaWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRhcnlGaWxsLnB1c2godmFsdWVBdHRyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlbiB0aWNrIGFueSB1bi12YWx1ZWQgY2hlY2tib3hlcyB3aXRoIHJlbWFpbmluZyBzbG90cy4KICAgICAgICAgICAgICAgICAgICB2YXIgbm9uVmFsdWUgPSAkKCdbdHlwZT1jaGVja2JveF06bm90KFt2YWx1ZV0pJyk7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWNvbmRhcnlGaWxsLmxlbmd0aCAmJiBqIDwgbm9uVmFsdWUuc2l6ZSgpOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgJChub25WYWx1ZVtqXSkucHJvcCgnY2hlY2tlZCcsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0cy5pcygnW3R5cGU9cmFkaW9dJykpIHsKICAgICAgICAgICAgICAgICAgICAvLyByYWRpb3MgcmVtYWluIGFubm95aW5nIHRvIHRoaXMgZGF5CiAgICAgICAgICAgICAgICAgICAgaW5wdXRzLmZpbHRlcignW3ZhbHVlPSJ7MH0iXScuZm9ybWF0KHZhbHVlKSkucHJvcCgnY2hlY2tlZCcsIHRydWUpOwoKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5wdXRzLmlzKCdzZWxlY3RbbXVsdGlwbGVdJykpIHsKICAgICAgICAgICAgICAgICAgICAvLyBNdWx0aXBsZSBzZWxlY3QgY2FuIHRha2UgYW4gYXJyYXkgZGlyZWN0bHkuIEluIGFkZGl0aW9uIGlmIGZvciBzb21lIHJlYXNvbiB0aGVyZSBhcmUgbXVsdGlwbGUKICAgICAgICAgICAgICAgICAgICAvLyBtdWx0aXBsZSBzZWxlY3RzIGJ5IHRoZSBzYW1lIG5hbWUsIHRoaXMgd2lsbCBhbHNvIHRha2UgY2FyZSBvZiB0aGF0LgogICAgICAgICAgICAgICAgICAgIGlucHV0cy52YWwodmFsdWVzKTsKCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlucHV0cy52YWwoZnVuY3Rpb24oaWR4LCBvbGRWYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlcy5sZW5ndGggPiBpZHggPyB2YWx1ZXNbaWR4XSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07CgoKfSkoalF1ZXJ5KTs=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 06:34:10 GMT",
                    "Content-Length": "6518",
                    "Date": "Fri, 07 Nov 2014 06:34:10 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}