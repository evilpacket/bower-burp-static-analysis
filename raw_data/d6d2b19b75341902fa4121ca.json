{
    "url": "http://localhost:9999/jcoglan/sylvester/node_modules/jsclass/src/console.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Denial of service (DOM-based)",
    "issueType": 5246208,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based denial of service vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and passes this data to a problematic platform API in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a denial of service condition on the user's computer when the relevant API is invoked. Depending on the nature of the API, the invocation may cause the user's computer to consume excessive amounts of CPU or disk space.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based denial of service vulnerabilities is not to dynamically pass data into problematic platform APIs that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from causing a denial of service condition. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe.",
    "issueDetail": "The application may be vulnerable to DOM-based denial of service. Data is read from <b>window.location.href</b> and written to <b>the RegExp() constructor</b> via the following statement:<ul><li>var cwd = new RegExp(window.location.href.replace(/(\\/[^\\/]+)/g, '($1)?') + '/?', 'g');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/jcoglan/sylvester/node_modules/jsclass/src/console.js",
                "path": "/jcoglan/sylvester/node_modules/jsclass/src/console.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9qY29nbGFuL3N5bHZlc3Rlci9ub2RlX21vZHVsZXMvanNjbGFzcy9zcmMvY29uc29sZS5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogOTQ3Mg0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogU2F0LCAwOCBOb3YgMjAxNCAxNToxNDowMiBHTVQNCkxhc3QtTW9kaWZpZWQ6IFNhdCwgMDggTm92IDIwMTQgMTU6MTQ6MDEgR01UDQoNCkpTLkNvbnNvbGUgPSBuZXcgSlMuTW9kdWxlKCdDb25zb2xlJywgewogIGV4dGVuZDogewogICAgbmFtZU9mOiBmdW5jdGlvbihvYmplY3QsIHJvb3QpIHsKICAgICAgdmFyIHJlc3VsdHMgPSBbXSwgaSwgbiwgZmllbGQsIGw7CiAgICAgIAogICAgICBpZiAoSlMuaXNUeXBlKG9iamVjdCwgQXJyYXkpKSB7CiAgICAgICAgZm9yIChpID0gMCwgbiA9IG9iamVjdC5sZW5ndGg7IGkgPCBuOyBpKyspCiAgICAgICAgICByZXN1bHRzLnB1c2godGhpcy5uYW1lT2Yob2JqZWN0W2ldKSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgIH0KICAgICAgCiAgICAgIGlmIChvYmplY3QuZGlzcGxheU5hbWUpIHJldHVybiBvYmplY3QuZGlzcGxheU5hbWU7CiAgICAgIAogICAgICBmaWVsZCA9IFt7bmFtZTogbnVsbCwgbzogcm9vdCB8fCBKUy5FTlZ9XTsKICAgICAgbCA9IDA7CiAgICAgIHdoaWxlICh0eXBlb2YgZmllbGQgPT09ICdvYmplY3QnICYmIGwgPCB0aGlzLk1BWF9ERVBUSCkgewogICAgICAgIGwgKz0gMTsKICAgICAgICBmaWVsZCA9IHRoaXMuZGVzY2VuZChmaWVsZCwgb2JqZWN0KTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGZpZWxkID09ICdzdHJpbmcnKSB7CiAgICAgICAgZmllbGQgPSBmaWVsZC5yZXBsYWNlKC9cLnByb3RvdHlwZVwuL2csICcjJyk7CiAgICAgICAgb2JqZWN0LmRpc3BsYXlOYW1lID0gZmllbGQ7CiAgICAgICAgaWYgKG9iamVjdC5fX21ldGFfXykgb2JqZWN0Ll9fbWV0YV9fLmRpc3BsYXlOYW1lID0gZmllbGQgKyAnLl9fbWV0YV9fJzsKICAgICAgfQogICAgICByZXR1cm4gb2JqZWN0LmRpc3BsYXlOYW1lOwogICAgfSwKICAgIAogICAgZGVzY2VuZDogZnVuY3Rpb24obGlzdCwgbmVlZGxlKSB7CiAgICAgIHZhciByZXN1bHRzID0gW10sCiAgICAgICAgICBuICAgICAgID0gbGlzdC5sZW5ndGgsCiAgICAgICAgICBpICAgICAgID0gbiwKICAgICAgICAgIGtleSwgaXRlbSwgbmFtZTsKICAgICAgCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICBpdGVtID0gbGlzdFtpXTsKICAgICAgICBpZiAoSlMuaXNUeXBlKGl0ZW0ubywgQXJyYXkpKSBjb250aW51ZTsKICAgICAgICBuYW1lID0gaXRlbS5uYW1lID8gaXRlbS5uYW1lICsgJy4nIDogJyc7CiAgICAgICAgZm9yIChrZXkgaW4gaXRlbS5vKSB7CiAgICAgICAgICBpZiAobmVlZGxlICYmIGl0ZW0ub1trZXldID09PSBuZWVkbGUpIHJldHVybiBuYW1lICsga2V5OwogICAgICAgICAgcmVzdWx0cy5wdXNoKHtuYW1lOiBuYW1lICsga2V5LCBvOiBpdGVtLm9ba2V5XX0pOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0sCiAgICAKICAgIE1BWF9ERVBUSDogNCwKICAgIAogICAgY29udmVydDogZnVuY3Rpb24ob2JqZWN0LCBzdGFjaykgewogICAgICBpZiAob2JqZWN0ID09PSBudWxsIHx8IG9iamVjdCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gU3RyaW5nKG9iamVjdCk7CiAgICAgIHZhciBFID0gSlMuRW51bWVyYWJsZSwgc3RhY2sgPSBzdGFjayB8fCBbXSwgaXRlbXM7CiAgICAgIAogICAgICBpZiAoSlMuaW5kZXhPZihzdGFjaywgb2JqZWN0KSA+PSAwKSByZXR1cm4gJyNjaXJjdWxhcic7CiAgICAgIAogICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICByZXR1cm4gKHR5cGVvZiBvYmplY3QubWVzc2FnZSA9PT0gJ3N0cmluZycgJiYgIW9iamVjdC5tZXNzYWdlKQogICAgICAgICAgICAgPyBvYmplY3QubmFtZQogICAgICAgICAgICAgOiBvYmplY3QubmFtZSArIChvYmplY3QubWVzc2FnZSA/ICc6ICcgKyBvYmplY3QubWVzc2FnZSA6ICcnKTsKICAgICAgfQogICAgICAKICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgc3RhY2sucHVzaChvYmplY3QpOwogICAgICAgIGl0ZW1zID0gbmV3IEUuQ29sbGVjdGlvbihvYmplY3QpLm1hcChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnQoaXRlbSwgc3RhY2spOwogICAgICAgICAgfSwgdGhpcykuam9pbignLCAnKTsKICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICByZXR1cm4gaXRlbXMgPyAnWyAnICsgaXRlbXMgKyAnIF0nIDogJ1tdJzsKICAgICAgfQogICAgICAKICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIFN0cmluZyB8fCB0eXBlb2Ygb2JqZWN0ID09PSAnc3RyaW5nJykKICAgICAgICByZXR1cm4gJyInICsgb2JqZWN0ICsgJyInOwogICAgICAKICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIEZ1bmN0aW9uKQogICAgICAgIHJldHVybiBvYmplY3QuZGlzcGxheU5hbWUgfHwKICAgICAgICAgICAgICAgb2JqZWN0Lm5hbWUgfHwKICAgICAgICAgICAgICAob2JqZWN0LnRvU3RyaW5nKCkubWF0Y2goL15ccypmdW5jdGlvbiAoW15cKF0rKVwoLykgfHwgW10pWzFdIHx8CiAgICAgICAgICAgICAgICcjZnVuY3Rpb24nOwogICAgICAKICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIERhdGUpCiAgICAgICAgcmV0dXJuIG9iamVjdC50b0dNVFN0cmluZygpOwogICAgICAKICAgICAgaWYgKG9iamVjdC50b1N0cmluZyAmJgogICAgICAgICAgb2JqZWN0LnRvU3RyaW5nICE9PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nICYmCiAgICAgICAgICAhb2JqZWN0LnRvU3RyaW5nLl9fdHJhY2VkX18pCiAgICAgICAgcmV0dXJuIG9iamVjdC50b1N0cmluZygpOwogICAgICAKICAgICAgaWYgKG9iamVjdC5ub2RlVHlwZSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gb2JqZWN0LnRvU3RyaW5nKCk7CiAgICAgIAogICAgICBzdGFjay5wdXNoKG9iamVjdCk7CiAgICAgIGl0ZW1zID0gbmV3IEUuQ29sbGVjdGlvbihFLm9iamVjdEtleXMob2JqZWN0LCBmYWxzZSkuc29ydCgpKS5tYXAoZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0KGtleSwgc3RhY2spICsgJzogJyArIHRoaXMuY29udmVydChvYmplY3Rba2V5XSwgc3RhY2spOwogICAgICAgIH0sIHRoaXMpLmpvaW4oJywgJyk7CiAgICAgIHN0YWNrLnBvcCgpOwogICAgICByZXR1cm4gaXRlbXMgPyAneyAnICsgaXRlbXMgKyAnIH0nIDogJ3t9JzsKICAgIH0sCiAgICAKICAgIGZpbHRlckJhY2t0cmFjZTogZnVuY3Rpb24oc3RhY2spIHsKICAgICAgaWYgKHRoaXMuQlJPV1NFUikgewogICAgICAgIHZhciBjd2QgPSBuZXcgUmVnRXhwKHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyhcL1teXC9dKykvZywgJygkMSk/JykgKyAnLz8nLCAnZycpOwogICAgICAgIHJldHVybiBzdGFjay5yZXBsYWNlKGN3ZCwgJycpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoaXMuUkhJTk8pIHsKICAgICAgICB2YXIgY3dkID0gamF2YS5sYW5nLlN5c3RlbS5nZXRQcm9wZXJ0eSgndXNlci5kaXInKSArICcvJzsKICAgICAgICByZXR1cm4gc3RhY2sucmVwbGFjZShuZXcgUmVnRXhwKGN3ZCwgJ2cnKSwgJycpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoaXMuTk9ERSkgewogICAgICAgIHZhciBjd2QgPSBwcm9jZXNzLmN3ZCgpICsgJy8nOwogICAgICAgIHJldHVybiBzdGFjay5yZXBsYWNlKG5ldyBSZWdFeHAoY3dkLCAnZycpLCAnJyk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodHlwZW9mIHZlcnNpb24gPT09ICdmdW5jdGlvbicgJiYgdmVyc2lvbigpID4gMTAwKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHJldHVybiBzdGFjazsKICAgICAgfQogICAgfSwKICAgIAogICAgQU5TSV9DU0k6IFN0cmluZy5mcm9tQ2hhckNvZGUoMHgxQikgKyAnWycsCiAgICBNQVhfQlVGRkVSX0xFTkdUSDogNzgsCiAgICAKICAgIEJST1dTRVI6ICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyksCiAgICBOT0RFOiAgICAodHlwZW9mIHByb2Nlc3MgPT09ICdvYmplY3QnKSwKICAgIFJISU5POiAgICh0eXBlb2YgamF2YSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGphdmEubGFuZyAhPT0gJ3VuZGVmaW5lZCcpLAogICAgV0lORE9aRTogKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBXU2NyaXB0ICE9PSAndW5kZWZpbmVkJyksCiAgICBXU0g6ICAgICAodHlwZW9mIFdTY3JpcHQgIT09ICd1bmRlZmluZWQnKSwKICAgIAogICAgY29sb3Jpbmc6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gISh0aGlzLkJST1dTRVIgJiYgIXdpbmRvdy5ydW50aW1lKSAmJiAhdGhpcy5XSU5ET1pFOwogICAgfSwKICAgIAogICAgX19idWZmZXJfXzogJycsCiAgICBfX2Zvcm1hdF9fOiAnJywKICAgIAogICAgRVNDQVBFX0NPREVTOiB7CiAgICAgIHJlc2V0OiAgICAgIDAsCiAgICAgIGJvbGQ6ICAgICAgIDEsICAgIG5vcm1hbDogICAgICAgMjIsCiAgICAgIHVuZGVybGluZTogIDQsICAgIG5vbGluZTogICAgICAgMjQsCiAgICAgIGJsaW5rOiAgICAgIDUsICAgIG5vYmxpbms6ICAgICAgMjUsCiAgICAgIAogICAgICBibGFjazogICAgICAzMCwgICBiZ2JsYWNrOiAgICAgIDQwLAogICAgICByZWQ6ICAgICAgICAzMSwgICBiZ3JlZDogICAgICAgIDQxLAogICAgICBncmVlbjogICAgICAzMiwgICBiZ2dyZWVuOiAgICAgIDQyLAogICAgICB5ZWxsb3c6ICAgICAzMywgICBiZ3llbGxvdzogICAgIDQzLAogICAgICBibHVlOiAgICAgICAzNCwgICBiZ2JsdWU6ICAgICAgIDQ0LAogICAgICBtYWdlbnRhOiAgICAzNSwgICBiZ21hZ2VudGE6ICAgIDQ1LAogICAgICBjeWFuOiAgICAgICAzNiwgICBiZ2N5YW46ICAgICAgIDQ2LAogICAgICB3aGl0ZTogICAgICAzNywgICBiZ3doaXRlOiAgICAgIDQ3LAogICAgICBub2NvbG9yOiAgICAzOSwgICBiZ25vY29sb3I6ICAgIDQ5CiAgICB9LAogICAgCiAgICBlc2NhcGU6IGZ1bmN0aW9uKHN0cmluZykgewogICAgICByZXR1cm4gdGhpcy5BTlNJX0NTSSArIHN0cmluZzsKICAgIH0sCiAgICAKICAgIHJlcGVhdDogZnVuY3Rpb24oc3RyaW5nLCBuKSB7CiAgICAgIHZhciByZXN1bHQgPSAnJzsKICAgICAgd2hpbGUgKG4tLSkgcmVzdWx0ICs9IHN0cmluZzsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCiAgICAKICAgIHBhZDogZnVuY3Rpb24oc3RyaW5nLCB3aWR0aCkgewogICAgICBzdHJpbmcgPSAoc3RyaW5nID09PSB1bmRlZmluZWQgPyAnJyA6IHN0cmluZykudG9TdHJpbmcoKTsKICAgICAgcmV0dXJuIHN0cmluZyArIHRoaXMucmVwZWF0KCcgJywgd2lkdGggLSBzdHJpbmcubGVuZ3RoKTsKICAgIH0sCiAgICAKICAgIGZsdXNoRm9ybWF0OiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGZvcm1hdCA9IHRoaXMuX19mb3JtYXRfXzsKICAgICAgdGhpcy5fX2Zvcm1hdF9fID0gJyc7CiAgICAgIHJldHVybiBmb3JtYXQ7CiAgICB9LAogICAgCiAgICBvdXRwdXQ6IGZ1bmN0aW9uKHN0cmluZywgZm9sbG93b24pIHsKICAgICAgd2hpbGUgKHN0cmluZy5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIGxlbmd0aCAgPSB0aGlzLl9fYnVmZmVyX18ubGVuZ3RoLAogICAgICAgICAgICBtYXggICAgID0gdGhpcy5CUk9XU0VSID8gMTAwMCA6IHRoaXMuTUFYX0JVRkZFUl9MRU5HVEgsCiAgICAgICAgICAgIG1vdmFibGUgPSAobGVuZ3RoID4gMCAmJiB0aGlzLmNvbG9yaW5nKCkpLAogICAgICAgICAgICBlc2NhcGUgID0gbW92YWJsZSA/IHRoaXMuZXNjYXBlKCcxRicpICsgdGhpcy5lc2NhcGUoKGxlbmd0aCArIDEpICsgJ0cnKSA6ICcnLAogICAgICAgICAgICBsaW5lICAgID0gc3RyaW5nLnN1YnN0cigwLCBtYXggLSBsZW5ndGgpOwogICAgICAgIAogICAgICAgIHRoaXMuX19idWZmZXJfXyArPSBsaW5lOwogICAgICAgIAogICAgICAgIGlmICh0aGlzLmNvbG9yaW5nKCkpCiAgICAgICAgICB0aGlzLndyaXRlVG9TdGRvdXQoZXNjYXBlICsgdGhpcy5mbHVzaEZvcm1hdCgpICsgbGluZSk7CiAgICAgICAgZWxzZSBpZiAodGhpcy5fX2J1ZmZlcl9fLmxlbmd0aCA9PT0gbWF4KQogICAgICAgICAgdGhpcy53cml0ZVRvU3Rkb3V0KHRoaXMuX19idWZmZXJfXyk7CiAgICAgICAgCiAgICAgICAgaWYgKHRoaXMuX19idWZmZXJfXy5sZW5ndGggPT09IG1heCkKICAgICAgICAgIHRoaXMuX19idWZmZXJfXyA9ICcnOwogICAgICAgIAogICAgICAgIHN0cmluZyA9IHN0cmluZy5zdWJzdHIobWF4IC0gbGVuZ3RoKTsKICAgICAgfQogICAgICBpZiAoIWZvbGxvd29uKSB7CiAgICAgICAgaWYgKHN0cmluZyA9PT0gJycgJiYgIXRoaXMuX19idWZmZXJfXykKICAgICAgICAgIHRoaXMud3JpdGVUb1N0ZG91dCh0aGlzLmZsdXNoRm9ybWF0KCkgKyAnJyk7CiAgICAgICAgCiAgICAgICAgaWYgKCF0aGlzLmNvbG9yaW5nKCkgJiYgdGhpcy5fX2J1ZmZlcl9fKQogICAgICAgICAgdGhpcy53cml0ZVRvU3Rkb3V0KHRoaXMuX19idWZmZXJfXyk7CiAgICAgICAgCiAgICAgICAgdGhpcy5fX2J1ZmZlcl9fID0gJyc7CiAgICAgIH0KICAgIH0sCiAgICAKICAgIHdyaXRlVG9TdGRvdXQ6IGZ1bmN0aW9uKHN0cmluZykgewogICAgICBpZiAodGhpcy5CUk9XU0VSICYmIHdpbmRvdy5ydW50aW1lKSByZXR1cm4gd2luZG93LnJ1bnRpbWUudHJhY2Uoc3RyaW5nKTsKICAgICAgaWYgKHRoaXMuTk9ERSkgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybihzdHJpbmcpOwogICAgICBpZiAodGhpcy5SSElOTykgICAgICAgICAgICAgICAgICAgICByZXR1cm4gamF2YS5sYW5nLlN5c3RlbS5vdXQucHJpbnRsbihzdHJpbmcpOwogICAgICBpZiAodGhpcy5XU0gpICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gV1NjcmlwdC5FY2hvKHN0cmluZyk7CiAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcpIHJldHVybiBjb25zb2xlLmxvZyhzdHJpbmcpOwogICAgICBpZiAodHlwZW9mIGFsZXJ0ID09PSAnZnVuY3Rpb24nKSAgICByZXR1cm4gYWxlcnQoc3RyaW5nKTsKICAgICAgaWYgKHR5cGVvZiBwcmludCA9PT0gJ2Z1bmN0aW9uJykgICAgcmV0dXJuIHByaW50KHN0cmluZyk7CiAgICB9CiAgfSwKICAKICBjb25zb2xlRm9ybWF0OiBmdW5jdGlvbigpIHsKICAgIGlmICghSlMuQ29uc29sZS5jb2xvcmluZygpKSByZXR1cm47CiAgICB0aGlzLnJlc2V0KCk7CiAgICB2YXIgaSA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICB3aGlsZSAoaS0tKSB0aGlzW2FyZ3VtZW50c1tpXV0oKTsKICB9LAogIAogIHB1dHM6IGZ1bmN0aW9uKHN0cmluZykgewogICAgc3RyaW5nID0gKHN0cmluZyA9PT0gdW5kZWZpbmVkID8gJycgOiBzdHJpbmcpLnRvU3RyaW5nKCk7CiAgICB2YXIgQyA9IEpTLkNvbnNvbGU7CiAgICBpZiAoQy5OT0RFIHx8IEMuUkhJTk8pIHsKICAgICAgQy53cml0ZVRvU3Rkb3V0KEMuZmx1c2hGb3JtYXQoKSArIHN0cmluZyk7CiAgICAgIEMuX19wcmludF9fID0gZmFsc2U7CiAgICB9CiAgICBlbHNlIHsKICAgICAgQy5vdXRwdXQoc3RyaW5nLCBmYWxzZSk7CiAgICB9CiAgfSwKICAKICBwcmludDogZnVuY3Rpb24oc3RyaW5nKSB7CiAgICBzdHJpbmcgPSAoc3RyaW5nID09PSB1bmRlZmluZWQgPyAnJyA6IHN0cmluZykudG9TdHJpbmcoKTsKICAgIHZhciBDID0gSlMuQ29uc29sZSwgc3lzOwogICAgCiAgICBpZiAoQy5OT0RFKSB7CiAgICAgIHRyeSB7IHN5cyA9IHJlcXVpcmUoJ3V0aWwnKSB9CiAgICAgIGNhdGNoIChlKSB7IHN5cyA9IHJlcXVpcmUoJ3N5cycpIH0KICAgICAgc3lzLnByaW50KEMuZmx1c2hGb3JtYXQoKSArIHN0cmluZyk7CiAgICAgIEMuX19wcmludF9fID0gdHJ1ZTsKICAgIH0KICAgIGVsc2UgaWYgKEMuUkhJTk8pIHsKICAgICAgamF2YS5sYW5nLlN5c3RlbS5vdXQucHJpbnQoQy5mbHVzaEZvcm1hdCgpICsgc3RyaW5nKTsKICAgICAgQy5fX3ByaW50X18gPSB0cnVlOwogICAgfQogICAgZWxzZSB7CiAgICAgIEMub3V0cHV0KHN0cmluZywgdHJ1ZSk7CiAgICB9CiAgfSwKICAKICBwcmludFRhYmxlOiBmdW5jdGlvbih0YWJsZSwgZm9ybWF0dGVyKSB7CiAgICB2YXIgd2lkdGhzID0gW10sCiAgICAgICAgdGFibGUgID0gW1snTWV0aG9kJywgJ0NhbGxzJ11dLmNvbmNhdCh0YWJsZSksCiAgICAgICAgQyA9IEpTLkNvbnNvbGUsCiAgICAgICAgaSA9IHRhYmxlLmxlbmd0aCwKICAgICAgICBqLCBzdHJpbmc7CiAgICAKICAgIHdoaWxlIChpLS0pIHsKICAgICAgaiA9IHRhYmxlW2ldLmxlbmd0aDsKICAgICAgd2hpbGUgKGotLSkgewogICAgICAgIHdpZHRoc1tqXSA9IHdpZHRoc1tqXSB8fCAwOwogICAgICAgIHN0cmluZyA9ICh0YWJsZVtpXVtqXSA9PT0gdW5kZWZpbmVkID8gJycgOiB0YWJsZVtpXVtqXSkudG9TdHJpbmcoKTsKICAgICAgICB3aWR0aHNbal0gPSBNYXRoLm1heChzdHJpbmcubGVuZ3RoLCB3aWR0aHNbal0pOwogICAgICB9CiAgICB9CiAgICAKICAgIHZhciBkaXZpZGVyID0gJysnLCBqID0gd2lkdGhzLmxlbmd0aDsKICAgIHdoaWxlIChqLS0pIGRpdmlkZXIgPSAnKycgKyBDLnJlcGVhdCgnLScsIHdpZHRoc1tqXSArIDIpICsgZGl2aWRlcjsKICAgIGRpdmlkZXIgPSAnICAnICsgZGl2aWRlcjsKICAgIHRoaXMucmVzZXQoKTsKICAgIHRoaXMucHV0cygpOwogICAgdGhpcy5wdXRzKGRpdmlkZXIpOwogICAgCiAgICB2YXIgcHJpbnRSb3cgPSBmdW5jdGlvbihyb3csIGZvcm1hdCkgewogICAgICB2YXIgZGF0YSA9IHRhYmxlW3Jvd107CiAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgdGhpcy5wcmludCgnICAnKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBkYXRhLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICB0aGlzLnByaW50KCd8Jyk7CiAgICAgICAgdGhpcy5jb25zb2xlRm9ybWF0LmFwcGx5KHRoaXMsIGZvcm1hdCk7CiAgICAgICAgdGhpcy5wcmludCgnICcgKyBDLnBhZChkYXRhW2ldLCB3aWR0aHNbaV0pICsgJyAnKTsKICAgICAgfQogICAgICB0aGlzLnJlc2V0KCk7CiAgICAgIHRoaXMucHV0cygnfCcpOwogICAgfTsKICAgIHByaW50Um93LmNhbGwodGhpcywgMCwgWydib2xkJ10pOwogICAgdGhpcy5yZXNldCgpOwogICAgdGhpcy5wdXRzKGRpdmlkZXIpOwogICAgCiAgICBmb3IgKHZhciBpID0gMSwgbiA9IHRhYmxlLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICB2YXIgZm9ybWF0ID0gZm9ybWF0dGVyID8gZm9ybWF0dGVyKHRhYmxlW2ldLCBpKSA6IFtdOwogICAgICBwcmludFJvdy5jYWxsKHRoaXMsIGksIGZvcm1hdCk7CiAgICB9CiAgICB0aGlzLnJlc2V0KCk7CiAgICB0aGlzLnB1dHMoZGl2aWRlcik7CiAgfQp9KTsKCihmdW5jdGlvbigpIHsKICB2YXIgQyA9IEpTLkNvbnNvbGU7CiAgCiAgZm9yICh2YXIga2V5IGluIEMuRVNDQVBFX0NPREVTKSAoZnVuY3Rpb24oa2V5KSB7CiAgICBDLmRlZmluZShrZXksIGZ1bmN0aW9uKCkgewogICAgICBpZiAoIUpTLkNvbnNvbGUuY29sb3JpbmcoKSkgcmV0dXJuOwogICAgICB2YXIgZXNjYXBlID0gQy5FU0NBUEVfQ09ERVNba2V5XTsKICAgICAgQy5fX2Zvcm1hdF9fICs9IEMuZXNjYXBlKGVzY2FwZSArICdtJyk7CiAgICB9KTsKICB9KShrZXkpOwogIAogIEMuZXh0ZW5kKEMpOwp9KSgpOwo=",
                "body": "SlMuQ29uc29sZSA9IG5ldyBKUy5Nb2R1bGUoJ0NvbnNvbGUnLCB7CiAgZXh0ZW5kOiB7CiAgICBuYW1lT2Y6IGZ1bmN0aW9uKG9iamVjdCwgcm9vdCkgewogICAgICB2YXIgcmVzdWx0cyA9IFtdLCBpLCBuLCBmaWVsZCwgbDsKICAgICAgCiAgICAgIGlmIChKUy5pc1R5cGUob2JqZWN0LCBBcnJheSkpIHsKICAgICAgICBmb3IgKGkgPSAwLCBuID0gb2JqZWN0Lmxlbmd0aDsgaSA8IG47IGkrKykKICAgICAgICAgIHJlc3VsdHMucHVzaCh0aGlzLm5hbWVPZihvYmplY3RbaV0pKTsKICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgfQogICAgICAKICAgICAgaWYgKG9iamVjdC5kaXNwbGF5TmFtZSkgcmV0dXJuIG9iamVjdC5kaXNwbGF5TmFtZTsKICAgICAgCiAgICAgIGZpZWxkID0gW3tuYW1lOiBudWxsLCBvOiByb290IHx8IEpTLkVOVn1dOwogICAgICBsID0gMDsKICAgICAgd2hpbGUgKHR5cGVvZiBmaWVsZCA9PT0gJ29iamVjdCcgJiYgbCA8IHRoaXMuTUFYX0RFUFRIKSB7CiAgICAgICAgbCArPSAxOwogICAgICAgIGZpZWxkID0gdGhpcy5kZXNjZW5kKGZpZWxkLCBvYmplY3QpOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgZmllbGQgPT0gJ3N0cmluZycpIHsKICAgICAgICBmaWVsZCA9IGZpZWxkLnJlcGxhY2UoL1wucHJvdG90eXBlXC4vZywgJyMnKTsKICAgICAgICBvYmplY3QuZGlzcGxheU5hbWUgPSBmaWVsZDsKICAgICAgICBpZiAob2JqZWN0Ll9fbWV0YV9fKSBvYmplY3QuX19tZXRhX18uZGlzcGxheU5hbWUgPSBmaWVsZCArICcuX19tZXRhX18nOwogICAgICB9CiAgICAgIHJldHVybiBvYmplY3QuZGlzcGxheU5hbWU7CiAgICB9LAogICAgCiAgICBkZXNjZW5kOiBmdW5jdGlvbihsaXN0LCBuZWVkbGUpIHsKICAgICAgdmFyIHJlc3VsdHMgPSBbXSwKICAgICAgICAgIG4gICAgICAgPSBsaXN0Lmxlbmd0aCwKICAgICAgICAgIGkgICAgICAgPSBuLAogICAgICAgICAga2V5LCBpdGVtLCBuYW1lOwogICAgICAKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIGl0ZW0gPSBsaXN0W2ldOwogICAgICAgIGlmIChKUy5pc1R5cGUoaXRlbS5vLCBBcnJheSkpIGNvbnRpbnVlOwogICAgICAgIG5hbWUgPSBpdGVtLm5hbWUgPyBpdGVtLm5hbWUgKyAnLicgOiAnJzsKICAgICAgICBmb3IgKGtleSBpbiBpdGVtLm8pIHsKICAgICAgICAgIGlmIChuZWVkbGUgJiYgaXRlbS5vW2tleV0gPT09IG5lZWRsZSkgcmV0dXJuIG5hbWUgKyBrZXk7CiAgICAgICAgICByZXN1bHRzLnB1c2goe25hbWU6IG5hbWUgKyBrZXksIG86IGl0ZW0ub1trZXldfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZXN1bHRzOwogICAgfSwKICAgIAogICAgTUFYX0RFUFRIOiA0LAogICAgCiAgICBjb252ZXJ0OiBmdW5jdGlvbihvYmplY3QsIHN0YWNrKSB7CiAgICAgIGlmIChvYmplY3QgPT09IG51bGwgfHwgb2JqZWN0ID09PSB1bmRlZmluZWQpIHJldHVybiBTdHJpbmcob2JqZWN0KTsKICAgICAgdmFyIEUgPSBKUy5FbnVtZXJhYmxlLCBzdGFjayA9IHN0YWNrIHx8IFtdLCBpdGVtczsKICAgICAgCiAgICAgIGlmIChKUy5pbmRleE9mKHN0YWNrLCBvYmplY3QpID49IDApIHJldHVybiAnI2NpcmN1bGFyJzsKICAgICAgCiAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBFcnJvcikgewogICAgICAgIHJldHVybiAodHlwZW9mIG9iamVjdC5tZXNzYWdlID09PSAnc3RyaW5nJyAmJiAhb2JqZWN0Lm1lc3NhZ2UpCiAgICAgICAgICAgICA/IG9iamVjdC5uYW1lCiAgICAgICAgICAgICA6IG9iamVjdC5uYW1lICsgKG9iamVjdC5tZXNzYWdlID8gJzogJyArIG9iamVjdC5tZXNzYWdlIDogJycpOwogICAgICB9CiAgICAgIAogICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICBzdGFjay5wdXNoKG9iamVjdCk7CiAgICAgICAgaXRlbXMgPSBuZXcgRS5Db2xsZWN0aW9uKG9iamVjdCkubWFwKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydChpdGVtLCBzdGFjayk7CiAgICAgICAgICB9LCB0aGlzKS5qb2luKCcsICcpOwogICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgIHJldHVybiBpdGVtcyA/ICdbICcgKyBpdGVtcyArICcgXScgOiAnW10nOwogICAgICB9CiAgICAgIAogICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgU3RyaW5nIHx8IHR5cGVvZiBvYmplY3QgPT09ICdzdHJpbmcnKQogICAgICAgIHJldHVybiAnIicgKyBvYmplY3QgKyAnIic7CiAgICAgIAogICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRnVuY3Rpb24pCiAgICAgICAgcmV0dXJuIG9iamVjdC5kaXNwbGF5TmFtZSB8fAogICAgICAgICAgICAgICBvYmplY3QubmFtZSB8fAogICAgICAgICAgICAgIChvYmplY3QudG9TdHJpbmcoKS5tYXRjaCgvXlxzKmZ1bmN0aW9uIChbXlwoXSspXCgvKSB8fCBbXSlbMV0gfHwKICAgICAgICAgICAgICAgJyNmdW5jdGlvbic7CiAgICAgIAogICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRGF0ZSkKICAgICAgICByZXR1cm4gb2JqZWN0LnRvR01UU3RyaW5nKCk7CiAgICAgIAogICAgICBpZiAob2JqZWN0LnRvU3RyaW5nICYmCiAgICAgICAgICBvYmplY3QudG9TdHJpbmcgIT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcgJiYKICAgICAgICAgICFvYmplY3QudG9TdHJpbmcuX190cmFjZWRfXykKICAgICAgICByZXR1cm4gb2JqZWN0LnRvU3RyaW5nKCk7CiAgICAgIAogICAgICBpZiAob2JqZWN0Lm5vZGVUeXBlICE9PSB1bmRlZmluZWQpIHJldHVybiBvYmplY3QudG9TdHJpbmcoKTsKICAgICAgCiAgICAgIHN0YWNrLnB1c2gob2JqZWN0KTsKICAgICAgaXRlbXMgPSBuZXcgRS5Db2xsZWN0aW9uKEUub2JqZWN0S2V5cyhvYmplY3QsIGZhbHNlKS5zb3J0KCkpLm1hcChmdW5jdGlvbihrZXkpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnQoa2V5LCBzdGFjaykgKyAnOiAnICsgdGhpcy5jb252ZXJ0KG9iamVjdFtrZXldLCBzdGFjayk7CiAgICAgICAgfSwgdGhpcykuam9pbignLCAnKTsKICAgICAgc3RhY2sucG9wKCk7CiAgICAgIHJldHVybiBpdGVtcyA/ICd7ICcgKyBpdGVtcyArICcgfScgOiAne30nOwogICAgfSwKICAgIAogICAgZmlsdGVyQmFja3RyYWNlOiBmdW5jdGlvbihzdGFjaykgewogICAgICBpZiAodGhpcy5CUk9XU0VSKSB7CiAgICAgICAgdmFyIGN3ZCA9IG5ldyBSZWdFeHAod2luZG93LmxvY2F0aW9uLmhyZWYucmVwbGFjZSgvKFwvW15cL10rKS9nLCAnKCQxKT8nKSArICcvPycsICdnJyk7CiAgICAgICAgcmV0dXJuIHN0YWNrLnJlcGxhY2UoY3dkLCAnJyk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhpcy5SSElOTykgewogICAgICAgIHZhciBjd2QgPSBqYXZhLmxhbmcuU3lzdGVtLmdldFByb3BlcnR5KCd1c2VyLmRpcicpICsgJy8nOwogICAgICAgIHJldHVybiBzdGFjay5yZXBsYWNlKG5ldyBSZWdFeHAoY3dkLCAnZycpLCAnJyk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhpcy5OT0RFKSB7CiAgICAgICAgdmFyIGN3ZCA9IHByb2Nlc3MuY3dkKCkgKyAnLyc7CiAgICAgICAgcmV0dXJuIHN0YWNrLnJlcGxhY2UobmV3IFJlZ0V4cChjd2QsICdnJyksICcnKTsKICAgICAgfQogICAgICBlbHNlIGlmICh0eXBlb2YgdmVyc2lvbiA9PT0gJ2Z1bmN0aW9uJyAmJiB2ZXJzaW9uKCkgPiAxMDApIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgcmV0dXJuIHN0YWNrOwogICAgICB9CiAgICB9LAogICAgCiAgICBBTlNJX0NTSTogU3RyaW5nLmZyb21DaGFyQ29kZSgweDFCKSArICdbJywKICAgIE1BWF9CVUZGRVJfTEVOR1RIOiA3OCwKICAgIAogICAgQlJPV1NFUjogKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSwKICAgIE5PREU6ICAgICh0eXBlb2YgcHJvY2VzcyA9PT0gJ29iamVjdCcpLAogICAgUkhJTk86ICAgKHR5cGVvZiBqYXZhICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgamF2YS5sYW5nICE9PSAndW5kZWZpbmVkJyksCiAgICBXSU5ET1pFOiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIFdTY3JpcHQgIT09ICd1bmRlZmluZWQnKSwKICAgIFdTSDogICAgICh0eXBlb2YgV1NjcmlwdCAhPT0gJ3VuZGVmaW5lZCcpLAogICAgCiAgICBjb2xvcmluZzogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAhKHRoaXMuQlJPV1NFUiAmJiAhd2luZG93LnJ1bnRpbWUpICYmICF0aGlzLldJTkRPWkU7CiAgICB9LAogICAgCiAgICBfX2J1ZmZlcl9fOiAnJywKICAgIF9fZm9ybWF0X186ICcnLAogICAgCiAgICBFU0NBUEVfQ09ERVM6IHsKICAgICAgcmVzZXQ6ICAgICAgMCwKICAgICAgYm9sZDogICAgICAgMSwgICAgbm9ybWFsOiAgICAgICAyMiwKICAgICAgdW5kZXJsaW5lOiAgNCwgICAgbm9saW5lOiAgICAgICAyNCwKICAgICAgYmxpbms6ICAgICAgNSwgICAgbm9ibGluazogICAgICAyNSwKICAgICAgCiAgICAgIGJsYWNrOiAgICAgIDMwLCAgIGJnYmxhY2s6ICAgICAgNDAsCiAgICAgIHJlZDogICAgICAgIDMxLCAgIGJncmVkOiAgICAgICAgNDEsCiAgICAgIGdyZWVuOiAgICAgIDMyLCAgIGJnZ3JlZW46ICAgICAgNDIsCiAgICAgIHllbGxvdzogICAgIDMzLCAgIGJneWVsbG93OiAgICAgNDMsCiAgICAgIGJsdWU6ICAgICAgIDM0LCAgIGJnYmx1ZTogICAgICAgNDQsCiAgICAgIG1hZ2VudGE6ICAgIDM1LCAgIGJnbWFnZW50YTogICAgNDUsCiAgICAgIGN5YW46ICAgICAgIDM2LCAgIGJnY3lhbjogICAgICAgNDYsCiAgICAgIHdoaXRlOiAgICAgIDM3LCAgIGJnd2hpdGU6ICAgICAgNDcsCiAgICAgIG5vY29sb3I6ICAgIDM5LCAgIGJnbm9jb2xvcjogICAgNDkKICAgIH0sCiAgICAKICAgIGVzY2FwZTogZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgIHJldHVybiB0aGlzLkFOU0lfQ1NJICsgc3RyaW5nOwogICAgfSwKICAgIAogICAgcmVwZWF0OiBmdW5jdGlvbihzdHJpbmcsIG4pIHsKICAgICAgdmFyIHJlc3VsdCA9ICcnOwogICAgICB3aGlsZSAobi0tKSByZXN1bHQgKz0gc3RyaW5nOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKICAgIAogICAgcGFkOiBmdW5jdGlvbihzdHJpbmcsIHdpZHRoKSB7CiAgICAgIHN0cmluZyA9IChzdHJpbmcgPT09IHVuZGVmaW5lZCA/ICcnIDogc3RyaW5nKS50b1N0cmluZygpOwogICAgICByZXR1cm4gc3RyaW5nICsgdGhpcy5yZXBlYXQoJyAnLCB3aWR0aCAtIHN0cmluZy5sZW5ndGgpOwogICAgfSwKICAgIAogICAgZmx1c2hGb3JtYXQ6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgZm9ybWF0ID0gdGhpcy5fX2Zvcm1hdF9fOwogICAgICB0aGlzLl9fZm9ybWF0X18gPSAnJzsKICAgICAgcmV0dXJuIGZvcm1hdDsKICAgIH0sCiAgICAKICAgIG91dHB1dDogZnVuY3Rpb24oc3RyaW5nLCBmb2xsb3dvbikgewogICAgICB3aGlsZSAoc3RyaW5nLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgbGVuZ3RoICA9IHRoaXMuX19idWZmZXJfXy5sZW5ndGgsCiAgICAgICAgICAgIG1heCAgICAgPSB0aGlzLkJST1dTRVIgPyAxMDAwIDogdGhpcy5NQVhfQlVGRkVSX0xFTkdUSCwKICAgICAgICAgICAgbW92YWJsZSA9IChsZW5ndGggPiAwICYmIHRoaXMuY29sb3JpbmcoKSksCiAgICAgICAgICAgIGVzY2FwZSAgPSBtb3ZhYmxlID8gdGhpcy5lc2NhcGUoJzFGJykgKyB0aGlzLmVzY2FwZSgobGVuZ3RoICsgMSkgKyAnRycpIDogJycsCiAgICAgICAgICAgIGxpbmUgICAgPSBzdHJpbmcuc3Vic3RyKDAsIG1heCAtIGxlbmd0aCk7CiAgICAgICAgCiAgICAgICAgdGhpcy5fX2J1ZmZlcl9fICs9IGxpbmU7CiAgICAgICAgCiAgICAgICAgaWYgKHRoaXMuY29sb3JpbmcoKSkKICAgICAgICAgIHRoaXMud3JpdGVUb1N0ZG91dChlc2NhcGUgKyB0aGlzLmZsdXNoRm9ybWF0KCkgKyBsaW5lKTsKICAgICAgICBlbHNlIGlmICh0aGlzLl9fYnVmZmVyX18ubGVuZ3RoID09PSBtYXgpCiAgICAgICAgICB0aGlzLndyaXRlVG9TdGRvdXQodGhpcy5fX2J1ZmZlcl9fKTsKICAgICAgICAKICAgICAgICBpZiAodGhpcy5fX2J1ZmZlcl9fLmxlbmd0aCA9PT0gbWF4KQogICAgICAgICAgdGhpcy5fX2J1ZmZlcl9fID0gJyc7CiAgICAgICAgCiAgICAgICAgc3RyaW5nID0gc3RyaW5nLnN1YnN0cihtYXggLSBsZW5ndGgpOwogICAgICB9CiAgICAgIGlmICghZm9sbG93b24pIHsKICAgICAgICBpZiAoc3RyaW5nID09PSAnJyAmJiAhdGhpcy5fX2J1ZmZlcl9fKQogICAgICAgICAgdGhpcy53cml0ZVRvU3Rkb3V0KHRoaXMuZmx1c2hGb3JtYXQoKSArICcnKTsKICAgICAgICAKICAgICAgICBpZiAoIXRoaXMuY29sb3JpbmcoKSAmJiB0aGlzLl9fYnVmZmVyX18pCiAgICAgICAgICB0aGlzLndyaXRlVG9TdGRvdXQodGhpcy5fX2J1ZmZlcl9fKTsKICAgICAgICAKICAgICAgICB0aGlzLl9fYnVmZmVyX18gPSAnJzsKICAgICAgfQogICAgfSwKICAgIAogICAgd3JpdGVUb1N0ZG91dDogZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgIGlmICh0aGlzLkJST1dTRVIgJiYgd2luZG93LnJ1bnRpbWUpIHJldHVybiB3aW5kb3cucnVudGltZS50cmFjZShzdHJpbmcpOwogICAgICBpZiAodGhpcy5OT0RFKSAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKHN0cmluZyk7CiAgICAgIGlmICh0aGlzLlJISU5PKSAgICAgICAgICAgICAgICAgICAgIHJldHVybiBqYXZhLmxhbmcuU3lzdGVtLm91dC5wcmludGxuKHN0cmluZyk7CiAgICAgIGlmICh0aGlzLldTSCkgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBXU2NyaXB0LkVjaG8oc3RyaW5nKTsKICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgcmV0dXJuIGNvbnNvbGUubG9nKHN0cmluZyk7CiAgICAgIGlmICh0eXBlb2YgYWxlcnQgPT09ICdmdW5jdGlvbicpICAgIHJldHVybiBhbGVydChzdHJpbmcpOwogICAgICBpZiAodHlwZW9mIHByaW50ID09PSAnZnVuY3Rpb24nKSAgICByZXR1cm4gcHJpbnQoc3RyaW5nKTsKICAgIH0KICB9LAogIAogIGNvbnNvbGVGb3JtYXQ6IGZ1bmN0aW9uKCkgewogICAgaWYgKCFKUy5Db25zb2xlLmNvbG9yaW5nKCkpIHJldHVybjsKICAgIHRoaXMucmVzZXQoKTsKICAgIHZhciBpID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIHdoaWxlIChpLS0pIHRoaXNbYXJndW1lbnRzW2ldXSgpOwogIH0sCiAgCiAgcHV0czogZnVuY3Rpb24oc3RyaW5nKSB7CiAgICBzdHJpbmcgPSAoc3RyaW5nID09PSB1bmRlZmluZWQgPyAnJyA6IHN0cmluZykudG9TdHJpbmcoKTsKICAgIHZhciBDID0gSlMuQ29uc29sZTsKICAgIGlmIChDLk5PREUgfHwgQy5SSElOTykgewogICAgICBDLndyaXRlVG9TdGRvdXQoQy5mbHVzaEZvcm1hdCgpICsgc3RyaW5nKTsKICAgICAgQy5fX3ByaW50X18gPSBmYWxzZTsKICAgIH0KICAgIGVsc2UgewogICAgICBDLm91dHB1dChzdHJpbmcsIGZhbHNlKTsKICAgIH0KICB9LAogIAogIHByaW50OiBmdW5jdGlvbihzdHJpbmcpIHsKICAgIHN0cmluZyA9IChzdHJpbmcgPT09IHVuZGVmaW5lZCA/ICcnIDogc3RyaW5nKS50b1N0cmluZygpOwogICAgdmFyIEMgPSBKUy5Db25zb2xlLCBzeXM7CiAgICAKICAgIGlmIChDLk5PREUpIHsKICAgICAgdHJ5IHsgc3lzID0gcmVxdWlyZSgndXRpbCcpIH0KICAgICAgY2F0Y2ggKGUpIHsgc3lzID0gcmVxdWlyZSgnc3lzJykgfQogICAgICBzeXMucHJpbnQoQy5mbHVzaEZvcm1hdCgpICsgc3RyaW5nKTsKICAgICAgQy5fX3ByaW50X18gPSB0cnVlOwogICAgfQogICAgZWxzZSBpZiAoQy5SSElOTykgewogICAgICBqYXZhLmxhbmcuU3lzdGVtLm91dC5wcmludChDLmZsdXNoRm9ybWF0KCkgKyBzdHJpbmcpOwogICAgICBDLl9fcHJpbnRfXyA9IHRydWU7CiAgICB9CiAgICBlbHNlIHsKICAgICAgQy5vdXRwdXQoc3RyaW5nLCB0cnVlKTsKICAgIH0KICB9LAogIAogIHByaW50VGFibGU6IGZ1bmN0aW9uKHRhYmxlLCBmb3JtYXR0ZXIpIHsKICAgIHZhciB3aWR0aHMgPSBbXSwKICAgICAgICB0YWJsZSAgPSBbWydNZXRob2QnLCAnQ2FsbHMnXV0uY29uY2F0KHRhYmxlKSwKICAgICAgICBDID0gSlMuQ29uc29sZSwKICAgICAgICBpID0gdGFibGUubGVuZ3RoLAogICAgICAgIGosIHN0cmluZzsKICAgIAogICAgd2hpbGUgKGktLSkgewogICAgICBqID0gdGFibGVbaV0ubGVuZ3RoOwogICAgICB3aGlsZSAoai0tKSB7CiAgICAgICAgd2lkdGhzW2pdID0gd2lkdGhzW2pdIHx8IDA7CiAgICAgICAgc3RyaW5nID0gKHRhYmxlW2ldW2pdID09PSB1bmRlZmluZWQgPyAnJyA6IHRhYmxlW2ldW2pdKS50b1N0cmluZygpOwogICAgICAgIHdpZHRoc1tqXSA9IE1hdGgubWF4KHN0cmluZy5sZW5ndGgsIHdpZHRoc1tqXSk7CiAgICAgIH0KICAgIH0KICAgIAogICAgdmFyIGRpdmlkZXIgPSAnKycsIGogPSB3aWR0aHMubGVuZ3RoOwogICAgd2hpbGUgKGotLSkgZGl2aWRlciA9ICcrJyArIEMucmVwZWF0KCctJywgd2lkdGhzW2pdICsgMikgKyBkaXZpZGVyOwogICAgZGl2aWRlciA9ICcgICcgKyBkaXZpZGVyOwogICAgdGhpcy5yZXNldCgpOwogICAgdGhpcy5wdXRzKCk7CiAgICB0aGlzLnB1dHMoZGl2aWRlcik7CiAgICAKICAgIHZhciBwcmludFJvdyA9IGZ1bmN0aW9uKHJvdywgZm9ybWF0KSB7CiAgICAgIHZhciBkYXRhID0gdGFibGVbcm93XTsKICAgICAgdGhpcy5yZXNldCgpOwogICAgICB0aGlzLnByaW50KCcgICcpOwogICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGRhdGEubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgIHRoaXMucHJpbnQoJ3wnKTsKICAgICAgICB0aGlzLmNvbnNvbGVGb3JtYXQuYXBwbHkodGhpcywgZm9ybWF0KTsKICAgICAgICB0aGlzLnByaW50KCcgJyArIEMucGFkKGRhdGFbaV0sIHdpZHRoc1tpXSkgKyAnICcpOwogICAgICB9CiAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgdGhpcy5wdXRzKCd8Jyk7CiAgICB9OwogICAgcHJpbnRSb3cuY2FsbCh0aGlzLCAwLCBbJ2JvbGQnXSk7CiAgICB0aGlzLnJlc2V0KCk7CiAgICB0aGlzLnB1dHMoZGl2aWRlcik7CiAgICAKICAgIGZvciAodmFyIGkgPSAxLCBuID0gdGFibGUubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIHZhciBmb3JtYXQgPSBmb3JtYXR0ZXIgPyBmb3JtYXR0ZXIodGFibGVbaV0sIGkpIDogW107CiAgICAgIHByaW50Um93LmNhbGwodGhpcywgaSwgZm9ybWF0KTsKICAgIH0KICAgIHRoaXMucmVzZXQoKTsKICAgIHRoaXMucHV0cyhkaXZpZGVyKTsKICB9Cn0pOwoKKGZ1bmN0aW9uKCkgewogIHZhciBDID0gSlMuQ29uc29sZTsKICAKICBmb3IgKHZhciBrZXkgaW4gQy5FU0NBUEVfQ09ERVMpIChmdW5jdGlvbihrZXkpIHsKICAgIEMuZGVmaW5lKGtleSwgZnVuY3Rpb24oKSB7CiAgICAgIGlmICghSlMuQ29uc29sZS5jb2xvcmluZygpKSByZXR1cm47CiAgICAgIHZhciBlc2NhcGUgPSBDLkVTQ0FQRV9DT0RFU1trZXldOwogICAgICBDLl9fZm9ybWF0X18gKz0gQy5lc2NhcGUoZXNjYXBlICsgJ20nKTsKICAgIH0pOwogIH0pKGtleSk7CiAgCiAgQy5leHRlbmQoQyk7Cn0pKCk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 15:14:01 GMT",
                    "Content-Length": "9472",
                    "Date": "Sat, 08 Nov 2014 15:14:02 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}