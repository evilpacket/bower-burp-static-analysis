{
    "url": "http://localhost:9999/oieduardorabelo/sawpf/src/js/datatables/1.9.3/jquery.dataTables.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cookie manipulation (DOM-based)",
    "issueType": 5245696,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based cookie manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the value of a cookie in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will set an arbitrary value in the user's cookie.<br><br>The potential impact of the vulnerability depends on the role that the cookie plays within the application. If the cookie is used to control the behavior that results from certain user actions (for example, a 'production' versus 'demo' mode setting), then the attacker may be able to cause the user to perform unintended actions by manipulating the cookie's value. If the cookie is used to track the user's session, then the attacker may be able to perform a session fixation attack, in which they set the cookie's value to a valid token that they have obtained from the application, and then hijack the session during the victim user's subsequent interaction with the application.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cookie manipulation vulnerabilities is not to dynamically write to cookies using data that originated from any untrusted source. This behavior should never be implemented for cookies that have any role in controlling privileged actions or user sessions within the application.",
    "issueDetail": "The application may be vulnerable to DOM-based cookie manipulation. Data is read from <b>window.location.pathname</b> and written to <b>document.cookie</b> via the following statements:<ul><li>var aParts = window.location.pathname.split('/');</li><li>document.cookie = sOldName+\"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=\"+       aParts.join('/') + \"/\";</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/oieduardorabelo/sawpf/src/js/datatables/1.9.3/jquery.dataTables.js",
                "path": "/oieduardorabelo/sawpf/src/js/datatables/1.9.3/jquery.dataTables.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9vaWVkdWFyZG9yYWJlbG8vc2F3cGYvc3JjL2pzL2RhdGF0YWJsZXMvMS45LjMvanF1ZXJ5LmRhdGFUYWJsZXMuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMzc3Njc2DQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBTYXQsIDA4IE5vdiAyMDE0IDAzOjU1OjA5IEdNVA0KTGFzdC1Nb2RpZmllZDogU2F0LCAwOCBOb3YgMjAxNCAwMzo1NDo1NSBHTVQNCg0KLyoqCiAqIEBzdW1tYXJ5ICAgICBEYXRhVGFibGVzCiAqIEBkZXNjcmlwdGlvbiBQYWdpbmF0ZSwgc2VhcmNoIGFuZCBzb3J0IEhUTUwgdGFibGVzCiAqIEB2ZXJzaW9uICAgICAxLjkuMwogKiBAZmlsZSAgICAgICAganF1ZXJ5LmRhdGFUYWJsZXMuanMKICogQGF1dGhvciAgICAgIEFsbGFuIEphcmRpbmUgKHd3dy5zcHJ5bWVkaWEuY28udWspCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QKICoKICogQGNvcHlyaWdodCBDb3B5cmlnaHQgMjAwOC0yMDEyIEFsbGFuIEphcmRpbmUsIGFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZnJlZSBzb2Z0d2FyZSwgdW5kZXIgZWl0aGVyIHRoZSBHUEwgdjIgbGljZW5zZSBvciBhCiAqIEJTRCBzdHlsZSBsaWNlbnNlLCBhdmFpbGFibGUgYXQ6CiAqICAgaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2VfZ3BsMgogKiAgIGh0dHA6Ly9kYXRhdGFibGVzLm5ldC9saWNlbnNlX2JzZAogKiAKICogVGhpcyBzb3VyY2UgZmlsZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIAogKiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLgogKiAKICogRm9yIGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvOiBodHRwOi8vd3d3LmRhdGF0YWJsZXMubmV0CiAqLwoKLypqc2xpbnQgZXZpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIGJyb3dzZXI6IHRydWUgKi8KLypnbG9iYWxzICQsIGpRdWVyeSxfZm5FeHRlcm5BcGlGdW5jLF9mbkluaXRpYWxpc2UsX2ZuSW5pdENvbXBsZXRlLF9mbkxhbmd1YWdlQ29tcGF0LF9mbkFkZENvbHVtbixfZm5Db2x1bW5PcHRpb25zLF9mbkFkZERhdGEsX2ZuQ3JlYXRlVHIsX2ZuR2F0aGVyRGF0YSxfZm5CdWlsZEhlYWQsX2ZuRHJhd0hlYWQsX2ZuRHJhdyxfZm5SZURyYXcsX2ZuQWpheFVwZGF0ZSxfZm5BamF4UGFyYW1ldGVycyxfZm5BamF4VXBkYXRlRHJhdyxfZm5TZXJ2ZXJQYXJhbXMsX2ZuQWRkT3B0aW9uc0h0bWwsX2ZuRmVhdHVyZUh0bWxUYWJsZSxfZm5TY3JvbGxEcmF3LF9mbkFkanVzdENvbHVtblNpemluZyxfZm5GZWF0dXJlSHRtbEZpbHRlcixfZm5GaWx0ZXJDb21wbGV0ZSxfZm5GaWx0ZXJDdXN0b20sX2ZuRmlsdGVyQ29sdW1uLF9mbkZpbHRlcixfZm5CdWlsZFNlYXJjaEFycmF5LF9mbkJ1aWxkU2VhcmNoUm93LF9mbkZpbHRlckNyZWF0ZVNlYXJjaCxfZm5EYXRhVG9TZWFyY2gsX2ZuU29ydCxfZm5Tb3J0QXR0YWNoTGlzdGVuZXIsX2ZuU29ydGluZ0NsYXNzZXMsX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSxfZm5QYWdlQ2hhbmdlLF9mbkZlYXR1cmVIdG1sSW5mbyxfZm5VcGRhdGVJbmZvLF9mbkZlYXR1cmVIdG1sTGVuZ3RoLF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyxfZm5Qcm9jZXNzaW5nRGlzcGxheSxfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCxfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSxfZm5Ob2RlVG9EYXRhSW5kZXgsX2ZuVmlzYmxlQ29sdW1ucyxfZm5DYWxjdWxhdGVFbmQsX2ZuQ29udmVydFRvV2lkdGgsX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0LF9mbkdldFdpZGVzdE5vZGUsX2ZuR2V0TWF4TGVuU3RyaW5nLF9mblN0cmluZ1RvQ3NzLF9mbkRldGVjdFR5cGUsX2ZuU2V0dGluZ3NGcm9tTm9kZSxfZm5HZXREYXRhTWFzdGVyLF9mbkdldFRyTm9kZXMsX2ZuR2V0VGROb2RlcyxfZm5Fc2NhcGVSZWdleCxfZm5EZWxldGVJbmRleCxfZm5SZU9yZGVySW5kZXgsX2ZuQ29sdW1uT3JkZXJpbmcsX2ZuTG9nLF9mbkNsZWFyVGFibGUsX2ZuU2F2ZVN0YXRlLF9mbkxvYWRTdGF0ZSxfZm5DcmVhdGVDb29raWUsX2ZuUmVhZENvb2tpZSxfZm5EZXRlY3RIZWFkZXIsX2ZuR2V0VW5pcXVlVGhzLF9mblNjcm9sbEJhcldpZHRoLF9mbkFwcGx5VG9DaGlsZHJlbixfZm5NYXAsX2ZuR2V0Um93RGF0YSxfZm5HZXRDZWxsRGF0YSxfZm5TZXRDZWxsRGF0YSxfZm5HZXRPYmplY3REYXRhRm4sX2ZuU2V0T2JqZWN0RGF0YUZuLF9mbkFwcGx5Q29sdW1uRGVmcyxfZm5CaW5kQWN0aW9uLF9mbkNhbGxiYWNrUmVnLF9mbkNhbGxiYWNrRmlyZSxfZm5Kc29uU3RyaW5nLF9mblJlbmRlcixfZm5Ob2RlVG9Db2x1bW5JbmRleCxfZm5JbmZvTWFjcm9zLF9mbkJyb3dzZXJEZXRlY3QsX2ZuR2V0Q29sdW1ucyovCgooLyoqIEBsZW5kcyA8Z2xvYmFsPiAqL2Z1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewoJLyoqIAoJICogRGF0YVRhYmxlcyBpcyBhIHBsdWctaW4gZm9yIHRoZSBqUXVlcnkgSmF2YXNjcmlwdCBsaWJyYXJ5LiBJdCBpcyBhIAoJICogaGlnaGx5IGZsZXhpYmxlIHRvb2wsIGJhc2VkIHVwb24gdGhlIGZvdW5kYXRpb25zIG9mIHByb2dyZXNzaXZlIAoJICogZW5oYW5jZW1lbnQsIHdoaWNoIHdpbGwgYWRkIGFkdmFuY2VkIGludGVyYWN0aW9uIGNvbnRyb2xzIHRvIGFueSAKCSAqIEhUTUwgdGFibGUuIEZvciBhIGZ1bGwgbGlzdCBvZiBmZWF0dXJlcyBwbGVhc2UgcmVmZXIgdG8KCSAqIDxhIGhyZWY9Imh0dHA6Ly9kYXRhdGFibGVzLm5ldCI+RGF0YVRhYmxlcy5uZXQ8L2E+LgoJICoKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlPC9pPiBvYmplY3QgaXMgbm90IGEgZ2xvYmFsIHZhcmlhYmxlIGJ1dCBpcwoJICogYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uRGF0YVRhYmxlPC9pPiBhbmQgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZTwvaT4gdGhyb3VnaCB3aGljaCAKCSAqIGl0IG1heSBiZSAgYWNjZXNzZWQuCgkgKgoJICogIEBjbGFzcwoJICogIEBwYXJhbSB7b2JqZWN0fSBbb0luaXQ9e31dIENvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciBEYXRhVGFibGVzLiBPcHRpb25zCgkgKiAgICBhcmUgZGVmaW5lZCBieSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfQoJICogIEByZXF1aXJlcyBqUXVlcnkgMS4zKwoJICogCgkgKiAgQGV4YW1wbGUKCSAqICAgIC8vIEJhc2ljIGluaXRpYWxpc2F0aW9uCgkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gewoJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJICogICAgfSApOwoJICogIAoJICogIEBleGFtcGxlCgkgKiAgICAvLyBJbml0aWFsaXNhdGlvbiB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyAtIGluIHRoaXMgY2FzZSwgZGlzYWJsZQoJICogICAgLy8gcGFnaW5hdGlvbiBhbmQgc29ydGluZy4KCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiB7CgkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlLAoJICogICAgICAgICJiU29ydCI6IGZhbHNlIAoJICogICAgICB9ICk7CgkgKiAgICB9ICk7CgkgKi8KCXZhciBEYXRhVGFibGUgPSBmdW5jdGlvbiggb0luaXQgKQoJewoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhIGNvbHVtbiB0byB0aGUgbGlzdCB1c2VkIGZvciB0aGUgdGFibGUgd2l0aCBkZWZhdWx0IHZhbHVlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gblRoIFRoZSB0aCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncywgblRoICkKCQl7CgkJCXZhciBvRGVmYXVsdHMgPSBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uczsKCQkJdmFyIGlDb2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9Db2wgPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiwgb0RlZmF1bHRzLCB7CgkJCQkic1NvcnRpbmdDbGFzcyI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQkic1NvcnRpbmdDbGFzc0pVSSI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSSwKCQkJCSJuVGgiOiBuVGggPyBuVGggOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpLAoJCQkJInNUaXRsZSI6ICAgIG9EZWZhdWx0cy5zVGl0bGUgICAgPyBvRGVmYXVsdHMuc1RpdGxlICAgIDogblRoID8gblRoLmlubmVySFRNTCA6ICcnLAoJCQkJImFEYXRhU29ydCI6IG9EZWZhdWx0cy5hRGF0YVNvcnQgPyBvRGVmYXVsdHMuYURhdGFTb3J0IDogW2lDb2xdLAoJCQkJIm1EYXRhIjogb0RlZmF1bHRzLm1EYXRhID8gb0RlZmF1bHRzLm9EZWZhdWx0cyA6IGlDb2wKCQkJfSApOwoJCQlvU2V0dGluZ3MuYW9Db2x1bW5zLnB1c2goIG9Db2wgKTsKCQkJCgkJCS8qIEFkZCBhIGNvbHVtbiBzcGVjaWZpYyBmaWx0ZXIgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPT09IHVuZGVmaW5lZCB8fCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPT09IG51bGwgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJdmFyIG9QcmUgPSBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF07CgkJCQkKCQkJCS8qIERvbid0IHJlcXVpcmUgdGhhdCB0aGUgdXNlciBtdXN0IHNwZWNpZnkgYlJlZ2V4LCBiU21hcnQgb3IgYkNhc2VJbnNlbnNpdGl2ZSAqLwoJCQkJaWYgKCBvUHJlLmJSZWdleCA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJSZWdleCA9IHRydWU7CgkJCQl9CgkJCQkKCQkJCWlmICggb1ByZS5iU21hcnQgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1ByZS5iU21hcnQgPSB0cnVlOwoJCQkJfQoJCQkJCgkJCQlpZiAoIG9QcmUuYkNhc2VJbnNlbnNpdGl2ZSA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJDYXNlSW5zZW5zaXRpdmUgPSB0cnVlOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBVc2UgdGhlIGNvbHVtbiBvcHRpb25zIGZ1bmN0aW9uIHRvIGluaXRpYWxpc2UgY2xhc3NlcyBldGMgKi8KCQkJX2ZuQ29sdW1uT3B0aW9ucyggb1NldHRpbmdzLCBpQ29sLCBudWxsICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFwcGx5IG9wdGlvbnMgZm9yIGEgY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgY29sdW1uIGluZGV4IHRvIGNvbnNpZGVyCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvT3B0aW9ucyBvYmplY3Qgd2l0aCBzVHlwZSwgYlZpc2libGUgYW5kIGJTZWFyY2hhYmxlIGV0YwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG9PcHRpb25zICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbCBdOwoJCQkKCQkJLyogVXNlciBzcGVjaWZpZWQgY29sdW1uIG9wdGlvbnMgKi8KCQkJaWYgKCBvT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIG9PcHRpb25zICE9PSBudWxsICkKCQkJewoJCQkJLyogQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZm9yIG1EYXRhUHJvcCAqLwoJCQkJaWYgKCBvT3B0aW9ucy5tRGF0YVByb3AgJiYgIW9PcHRpb25zLm1EYXRhICkKCQkJCXsKCQkJCQlvT3B0aW9ucy5tRGF0YSA9IG9PcHRpb25zLm1EYXRhUHJvcDsKCQkJCX0KCQkKCQkJCWlmICggb09wdGlvbnMuc1R5cGUgIT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb0NvbC5zVHlwZSA9IG9PcHRpb25zLnNUeXBlOwoJCQkJCW9Db2wuX2JBdXRvVHlwZSA9IGZhbHNlOwoJCQkJfQoJCQkJCgkJCQkkLmV4dGVuZCggb0NvbCwgb09wdGlvbnMgKTsKCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJzV2lkdGgiLCAic1dpZHRoT3JpZyIgKTsKCQkKCQkJCS8qIGlEYXRhU29ydCB0byBiZSBhcHBsaWVkIChiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSksIGJ1dCBhRGF0YVNvcnQgd2lsbCB0YWtlCgkJCQkgKiBwcmlvcml0eSBpZiBkZWZpbmVkCgkJCQkgKi8KCQkJCWlmICggb09wdGlvbnMuaURhdGFTb3J0ICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9Db2wuYURhdGFTb3J0ID0gWyBvT3B0aW9ucy5pRGF0YVNvcnQgXTsKCQkJCX0KCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJhRGF0YVNvcnQiICk7CgkJCX0KCQkKCQkJLyogQ2FjaGUgdGhlIGRhdGEgZ2V0IGFuZCBzZXQgZnVuY3Rpb25zIGZvciBzcGVlZCAqLwoJCQl2YXIgbVJlbmRlciA9IG9Db2wubVJlbmRlciA/IF9mbkdldE9iamVjdERhdGFGbiggb0NvbC5tUmVuZGVyICkgOiBudWxsOwoJCQl2YXIgbURhdGEgPSBfZm5HZXRPYmplY3REYXRhRm4oIG9Db2wubURhdGEgKTsKCQkKCQkJb0NvbC5mbkdldERhdGEgPSBmdW5jdGlvbiAob0RhdGEsIHNTcGVjaWZpYykgewoJCQkJdmFyIGlubmVyRGF0YSA9IG1EYXRhKCBvRGF0YSwgc1NwZWNpZmljICk7CgkJCgkJCQlpZiAoIG9Db2wubVJlbmRlciAmJiAoc1NwZWNpZmljICYmIHNTcGVjaWZpYyAhPT0gJycpICkKCQkJCXsKCQkJCQlyZXR1cm4gbVJlbmRlciggaW5uZXJEYXRhLCBzU3BlY2lmaWMsIG9EYXRhICk7CgkJCQl9CgkJCQlyZXR1cm4gaW5uZXJEYXRhOwoJCQl9OwoJCQlvQ29sLmZuU2V0RGF0YSA9IF9mblNldE9iamVjdERhdGFGbiggb0NvbC5tRGF0YSApOwoJCQkKCQkJLyogRmVhdHVyZSBzb3J0aW5nIG92ZXJyaWRlcyBjb2x1bW4gc3BlY2lmaWMgd2hlbiBvZmYgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCW9Db2wuYlNvcnRhYmxlID0gZmFsc2U7CgkJCX0KCQkJCgkJCS8qIENoZWNrIHRoYXQgdGhlIGNsYXNzIGFzc2lnbm1lbnQgaXMgY29ycmVjdCBmb3Igc29ydGluZyAqLwoJCQlpZiAoICFvQ29sLmJTb3J0YWJsZSB8fAoJCQkJICgkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEpICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZU5vbmU7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSAiIjsKCQkJfQoJCQllbHNlIGlmICggb0NvbC5iU29ydGFibGUgfHwKCQkJICAgICAgICAgICgkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEpICkKCQkJewoJCQkgIG9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGU7CgkJCSAgb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJOwoJCQl9CgkJCWVsc2UgaWYgKCAkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSAhPSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgKQoJCQl7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3MgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlQXNjOwoJCQkJb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJQXNjQWxsb3dlZDsKCQkJfQoJCQllbHNlIGlmICggJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpICE9IC0xICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZURlc2M7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUlEZXNjQWxsb3dlZDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGp1c3QgdGhlIHRhYmxlIGNvbHVtbiB3aWR0aHMgZm9yIG5ldyBkYXRhLiBOb3RlOiB5b3Ugd291bGQgcHJvYmFibHkgd2FudCB0byAKCQkgKiBkbyBhIHJlZHJhdyBhZnRlciBjYWxsaW5nIHRoaXMgZnVuY3Rpb24hCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWRqdXN0Q29sdW1uU2l6aW5nICggb1NldHRpbmdzICkKCQl7CgkJCS8qIE5vdCBpbnRlcmVzdGVkIGluIGRvaW5nIGNvbHVtbiB3aWR0aCBjYWxjdWxhdGlvbiBpZiBhdXRvLXdpZHRoIGlzIGRpc2FibGVkICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iQXV0b1dpZHRoID09PSBmYWxzZSApCgkJCXsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQkKCQkJX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzKCBvU2V0dGluZ3MgKTsKCQkJZm9yICggdmFyIGk9MCAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaC5zdHlsZS53aWR0aCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvdmVydCB0aGUgaW5kZXggb2YgYSB2aXNpYmxlIGNvbHVtbiB0byB0aGUgaW5kZXggaW4gdGhlIGRhdGEgYXJyYXkgKHRha2UgYWNjb3VudAoJCSAqIG9mIGhpZGRlbiBjb2x1bW5zKQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWF0Y2ggVmlzaWJsZSBjb2x1bW4gaW5kZXggdG8gbG9va3VwCgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIGRhdGEgaW5kZXgKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaU1hdGNoICkKCQl7CgkJCXZhciBhaVZpcyA9IF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgJ2JWaXNpYmxlJyApOwoJCQoJCQlyZXR1cm4gdHlwZW9mIGFpVmlzW2lNYXRjaF0gPT09ICdudW1iZXInID8KCQkJCWFpVmlzW2lNYXRjaF0gOgoJCQkJbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogQ292ZXJ0IHRoZSBpbmRleCBvZiBhbiBpbmRleCBpbiB0aGUgZGF0YSBhcnJheSBhbmQgY29udmVydCBpdCB0byB0aGUgdmlzaWJsZQoJCSAqICAgY29sdW1uIGluZGV4ICh0YWtlIGFjY291bnQgb2YgaGlkZGVuIGNvbHVtbnMpCgkJICogIEBwYXJhbSB7aW50fSBpTWF0Y2ggQ29sdW1uIGluZGV4IHRvIGxvb2t1cAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIGRhdGEgaW5kZXgKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUoIG9TZXR0aW5ncywgaU1hdGNoICkKCQl7CgkJCXZhciBhaVZpcyA9IF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgJ2JWaXNpYmxlJyApOwoJCQl2YXIgaVBvcyA9ICQuaW5BcnJheSggaU1hdGNoLCBhaVZpcyApOwoJCQoJCQlyZXR1cm4gaVBvcyAhPT0gLTEgPyBpUG9zIDogbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgdmlzaWJsZSBjb2x1bW5zCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2ludH0gaSB0aGUgbnVtYmVyIG9mIHZpc2libGUgY29sdW1ucwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKQoJCXsKCQkJcmV0dXJuIF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgJ2JWaXNpYmxlJyApLmxlbmd0aDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IGFuIGFycmF5IG9mIGNvbHVtbiBpbmRleGVzIHRoYXQgbWF0Y2ggYSBnaXZlbiBwcm9wZXJ0eQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUGFyYW0gUGFyYW1ldGVyIGluIGFvQ29sdW1ucyB0byBsb29rIGZvciAtIHR5cGljYWxseSAKCQkgKiAgICBiVmlzaWJsZSBvciBiU2VhcmNoYWJsZQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IEFycmF5IG9mIGluZGV4ZXMgd2l0aCBtYXRjaGVkIHByb3BlcnRpZXMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Q29sdW1ucyggb1NldHRpbmdzLCBzUGFyYW0gKQoJCXsKCQkJdmFyIGEgPSBbXTsKCQkKCQkJJC5tYXAoIG9TZXR0aW5ncy5hb0NvbHVtbnMsIGZ1bmN0aW9uKHZhbCwgaSkgewoJCQkJaWYgKCB2YWxbc1BhcmFtXSApIHsKCQkJCQlhLnB1c2goIGkgKTsKCQkJCX0KCQkJfSApOwoJCQoJCQlyZXR1cm4gYTsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBzb3J0IHR5cGUgYmFzZWQgb24gYW4gaW5wdXQgc3RyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRGF0YSBkYXRhIHdlIHdpc2ggdG8ga25vdyB0aGUgdHlwZSBvZgoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSB0eXBlIChkZWZhdWx0cyB0byAnc3RyaW5nJyBpZiBubyB0eXBlIGNhbiBiZSBkZXRlY3RlZCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRGV0ZWN0VHlwZSggc0RhdGEgKQoJCXsKCQkJdmFyIGFUeXBlcyA9IERhdGFUYWJsZS5leHQuYVR5cGVzOwoJCQl2YXIgaUxlbiA9IGFUeXBlcy5sZW5ndGg7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJdmFyIHNUeXBlID0gYVR5cGVzW2ldKCBzRGF0YSApOwoJCQkJaWYgKCBzVHlwZSAhPT0gbnVsbCApCgkJCQl7CgkJCQkJcmV0dXJuIHNUeXBlOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gJ3N0cmluZyc7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpZ3VyZSBvdXQgaG93IHRvIHJlb3JkZXIgYSBkaXNwbGF5IGxpc3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyBhcnJheSB7aW50fSBhaVJldHVybiBpbmRleCBsaXN0IGZvciByZW9yZGVyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlT3JkZXJJbmRleCAoIG9TZXR0aW5ncywgc0NvbHVtbnMgKQoJCXsKCQkJdmFyIGFDb2x1bW5zID0gc0NvbHVtbnMuc3BsaXQoJywnKTsKCQkJdmFyIGFpUmV0dXJuID0gW107CgkJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggdmFyIGo9MCA7IGo8aUxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNOYW1lID09IGFDb2x1bW5zW2pdICkKCQkJCQl7CgkJCQkJCWFpUmV0dXJuLnB1c2goIGogKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gYWlSZXR1cm47CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgY29sdW1uIG9yZGVyaW5nIHRoYXQgRGF0YVRhYmxlcyBleHBlY3RzCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge3N0cmluZ30gY29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgbmFtZXMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29sdW1uT3JkZXJpbmcgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIHNOYW1lcyA9ICcnOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJc05hbWVzICs9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc05hbWUrJywnOwoJCQl9CgkJCWlmICggc05hbWVzLmxlbmd0aCA9PSBpTGVuICkKCQkJewoJCQkJcmV0dXJuICIiOwoJCQl9CgkJCXJldHVybiBzTmFtZXMuc2xpY2UoMCwgLTEpOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBUYWtlIHRoZSBjb2x1bW4gZGVmaW5pdGlvbnMgYW5kIHN0YXRpYyBjb2x1bW5zIGFycmF5cyBhbmQgY2FsY3VsYXRlIGhvdwoJCSAqIHRoZXkgcmVsYXRlIHRvIGNvbHVtbiBpbmRleGVzLiBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gd2lsbCB0aGVuIGFwcGx5IHRoZQoJCSAqIGRlZmluaXRpb24gZm91bmQgZm9yIGEgY29sdW1uIHRvIGEgc3VpdGFibGUgY29uZmlndXJhdGlvbiBvYmplY3QuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHthcnJheX0gYW9Db2xEZWZzIFRoZSBhb0NvbHVtbkRlZnMgYXJyYXkgdGhhdCBpcyB0byBiZSBhcHBsaWVkCgkJICogIEBwYXJhbSB7YXJyYXl9IGFvQ29scyBUaGUgYW9Db2x1bW5zIGFycmF5IHRoYXQgZGVmaW5lcyBjb2x1bW5zIGluZGl2aWR1YWxseQoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBmbiBDYWxsYmFjayBmdW5jdGlvbiAtIHRha2VzIHR3byBwYXJhbWV0ZXJzLCB0aGUgY2FsY3VsYXRlZAoJCSAqICAgIGNvbHVtbiBpbmRleCBhbmQgdGhlIGRlZmluaXRpb24gZm9yIHRoYXQgY29sdW1uLgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BcHBseUNvbHVtbkRlZnMoIG9TZXR0aW5ncywgYW9Db2xEZWZzLCBhb0NvbHMsIGZuICkKCQl7CgkJCXZhciBpLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuOwoJCQoJCQkvLyBDb2x1bW4gZGVmaW5pdGlvbnMgd2l0aCBhVGFyZ2V0cwoJCQlpZiAoIGFvQ29sRGVmcyApCgkJCXsKCQkJCS8qIExvb3Agb3ZlciB0aGUgZGVmaW5pdGlvbnMgYXJyYXkgLSBsb29wIGluIHJldmVyc2Ugc28gZmlyc3QgaW5zdGFuY2UgaGFzIHByaW9yaXR5ICovCgkJCQlmb3IgKCBpPWFvQ29sRGVmcy5sZW5ndGgtMSA7IGk+PTAgOyBpLS0gKQoJCQkJewoJCQkJCS8qIEVhY2ggZGVmaW5pdGlvbiBjYW4gdGFyZ2V0IG11bHRpcGxlIGNvbHVtbnMsIGFzIGl0IGlzIGFuIGFycmF5ICovCgkJCQkJdmFyIGFUYXJnZXRzID0gYW9Db2xEZWZzW2ldLmFUYXJnZXRzOwoJCQkJCWlmICggISQuaXNBcnJheSggYVRhcmdldHMgKSApCgkJCQkJewoJCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMSwgJ2FUYXJnZXRzIG11c3QgYmUgYW4gYXJyYXkgb2YgdGFyZ2V0cywgbm90IGEgJysodHlwZW9mIGFUYXJnZXRzKSApOwoJCQkJCX0KCQkKCQkJCQlmb3IgKCBqPTAsIGpMZW49YVRhcmdldHMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQl7CgkJCQkJCWlmICggdHlwZW9mIGFUYXJnZXRzW2pdID09PSAnbnVtYmVyJyAmJiBhVGFyZ2V0c1tqXSA+PSAwICkKCQkJCQkJewoJCQkJCQkJLyogQWRkIGNvbHVtbnMgdGhhdCB3ZSBkb24ndCB5ZXQga25vdyBhYm91dCAqLwoJCQkJCQkJd2hpbGUoIG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDw9IGFUYXJnZXRzW2pdICkKCQkJCQkJCXsKCQkJCQkJCQlfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncyApOwoJCQkJCQkJfQoJCQoJCQkJCQkJLyogSW50ZWdlciwgYmFzaWMgaW5kZXggKi8KCQkJCQkJCWZuKCBhVGFyZ2V0c1tqXSwgYW9Db2xEZWZzW2ldICk7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHR5cGVvZiBhVGFyZ2V0c1tqXSA9PT0gJ251bWJlcicgJiYgYVRhcmdldHNbal0gPCAwICkKCQkJCQkJewoJCQkJCQkJLyogTmVnYXRpdmUgaW50ZWdlciwgcmlnaHQgdG8gbGVmdCBjb2x1bW4gY291bnRpbmcgKi8KCQkJCQkJCWZuKCBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCthVGFyZ2V0c1tqXSwgYW9Db2xEZWZzW2ldICk7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHR5cGVvZiBhVGFyZ2V0c1tqXSA9PT0gJ3N0cmluZycgKQoJCQkJCQl7CgkJCQkJCQkvKiBDbGFzcyBuYW1lIG1hdGNoaW5nIG9uIFRIIGVsZW1lbnQgKi8KCQkJCQkJCWZvciAoIGs9MCwga0xlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGs8a0xlbiA7IGsrKyApCgkJCQkJCQl7CgkJCQkJCQkJaWYgKCBhVGFyZ2V0c1tqXSA9PSAiX2FsbCIgfHwKCQkJCQkJCQkgICAgICQob1NldHRpbmdzLmFvQ29sdW1uc1trXS5uVGgpLmhhc0NsYXNzKCBhVGFyZ2V0c1tqXSApICkKCQkJCQkJCQl7CgkJCQkJCQkJCWZuKCBrLCBhb0NvbERlZnNbaV0gKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJLy8gU3RhdGljYWxseSBkZWZpbmVkIGNvbHVtbnMgYXJyYXkKCQkJaWYgKCBhb0NvbHMgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9Db2xzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJZm4oIGksIGFvQ29sc1tpXSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhIGRhdGEgYXJyYXkgdG8gdGhlIHRhYmxlLCBjcmVhdGluZyBET00gbm9kZSBldGMuIFRoaXMgaXMgdGhlIHBhcmFsbGVsIHRvIAoJCSAqIF9mbkdhdGhlckRhdGEsIGJ1dCBmb3IgYWRkaW5nIHJvd3MgZnJvbSBhIEphdmFzY3JpcHQgc291cmNlLCByYXRoZXIgdGhhbiBhCgkJICogRE9NIHNvdXJjZS4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBkYXRhIGFycmF5IHRvIGJlIGFkZGVkCgkJICogIEByZXR1cm5zIHtpbnR9ID49MCBpZiBzdWNjZXNzZnVsIChpbmRleCBvZiBuZXcgYW9EYXRhIGVudHJ5KSwgLTEgaWYgZmFpbGVkCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkZERhdGEgKCBvU2V0dGluZ3MsIGFEYXRhU3VwcGxpZWQgKQoJCXsKCQkJdmFyIG9Db2w7CgkJCQoJCQkvKiBUYWtlIGFuIGluZGVwZW5kZW50IGNvcHkgb2YgdGhlIGRhdGEgc291cmNlIHNvIHdlIGNhbiBiYXNoIGl0IGFib3V0IGFzIHdlIHdpc2ggKi8KCQkJdmFyIGFEYXRhSW4gPSAoJC5pc0FycmF5KGFEYXRhU3VwcGxpZWQpKSA/CgkJCQlhRGF0YVN1cHBsaWVkLnNsaWNlKCkgOgoJCQkJJC5leHRlbmQoIHRydWUsIHt9LCBhRGF0YVN1cHBsaWVkICk7CgkJCQoJCQkvKiBDcmVhdGUgdGhlIG9iamVjdCBmb3Igc3RvcmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGlzIG5ldyByb3cgKi8KCQkJdmFyIGlSb3cgPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJdmFyIG9EYXRhID0gJC5leHRlbmQoIHRydWUsIHt9LCBEYXRhVGFibGUubW9kZWxzLm9Sb3cgKTsKCQkJb0RhdGEuX2FEYXRhID0gYURhdGFJbjsKCQkJb1NldHRpbmdzLmFvRGF0YS5wdXNoKCBvRGF0YSApOwoJCQoJCQkvKiBDcmVhdGUgdGhlIGNlbGxzICovCgkJCXZhciBuVGQsIHNUaGlzVHlwZTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldOwoJCQoJCQkJLyogVXNlIHJlbmRlcmVkIGRhdGEgZm9yIGZpbHRlcmluZyAvIHNvcnRpbmcgKi8KCQkJCWlmICggdHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgb0NvbC5iVXNlUmVuZGVyZWQgJiYgb0NvbC5tRGF0YSAhPT0gbnVsbCApCgkJCQl7CgkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgX2ZuUmVuZGVyKG9TZXR0aW5ncywgaVJvdywgaSkgKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICkgKTsKCQkJCX0KCQkJCQoJCQkJLyogU2VlIGlmIHdlIHNob3VsZCBhdXRvLWRldGVjdCB0aGUgY29sdW1uIHR5cGUgKi8KCQkJCWlmICggb0NvbC5fYkF1dG9UeXBlICYmIG9Db2wuc1R5cGUgIT0gJ3N0cmluZycgKQoJCQkJewoJCQkJCS8qIEF0dGVtcHQgdG8gYXV0byBkZXRlY3QgdGhlIHR5cGUgLSBzYW1lIGFzIF9mbkdhdGhlckRhdGEoKSAqLwoJCQkJCXZhciBzVmFyVHlwZSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksICd0eXBlJyApOwoJCQkJCWlmICggc1ZhclR5cGUgIT09IG51bGwgJiYgc1ZhclR5cGUgIT09ICcnICkKCQkJCQl7CgkJCQkJCXNUaGlzVHlwZSA9IF9mbkRldGVjdFR5cGUoIHNWYXJUeXBlICk7CgkJCQkJCWlmICggb0NvbC5zVHlwZSA9PT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuc1R5cGUgPSBzVGhpc1R5cGU7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIG9Db2wuc1R5cGUgIT0gc1RoaXNUeXBlICYmIG9Db2wuc1R5cGUgIT0gImh0bWwiICkKCQkJCQkJewoJCQkJCQkJLyogU3RyaW5nIGlzIGFsd2F5cyB0aGUgJ2ZhbGxiYWNrJyBvcHRpb24gKi8KCQkJCQkJCW9Db2wuc1R5cGUgPSAnc3RyaW5nJzsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogQWRkIHRvIHRoZSBkaXNwbGF5IGFycmF5ICovCgkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVJvdyApOwoJCQoJCQkvKiBDcmVhdGUgdGhlIERPTSBpbWZvcm1hdGlvbiAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mbkNyZWF0ZVRyKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkJfQoJCQoJCQlyZXR1cm4gaVJvdzsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVhZCBpbiB0aGUgZGF0YSBmcm9tIHRoZSB0YXJnZXQgdGFibGUgZnJvbSB0aGUgRE9NCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2F0aGVyRGF0YSggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpTG9vcCwgaSwgaUxlbiwgaiwgakxlbiwgaklubmVyLAoJCQkgCW5UZHMsIG5UcnMsIG5UZCwgYUxvY2FsRGF0YSwgaVRoaXNJbmRleCwKCQkJCWlSb3csIGlSb3dzLCBpQ29sdW1uLCBpQ29sdW1ucywgc05vZGVOYW1lLAoJCQkJb0NvbCwgb0RhdGE7CgkJCQoJCQkvKgoJCQkgKiBQcm9jZXNzIGJ5IHJvdyBmaXJzdAoJCQkgKiBBZGQgdGhlIGRhdGEgb2JqZWN0IGZvciB0aGUgd2hvbGUgdGFibGUgLSBzdG9yaW5nIHRoZSB0ciBub2RlLiBOb3RlIC0gbm8gcG9pbnQgaW4gZ2V0dGluZwoJCQkgKiBET00gYmFzZWQgZGF0YSBpZiB3ZSBhcmUgZ29pbmcgdG8gZ28gYW5kIHJlcGxhY2UgaXQgd2l0aCBBamF4IHNvdXJjZSBkYXRhLgoJCQkgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyB8fCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UgPT09IG51bGwgKQoJCQl7CgkJCQluVHJzID0gb1NldHRpbmdzLm5UQm9keS5jaGlsZE5vZGVzOwoJCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG5UcnNbaV0ubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVFIiICkKCQkJCQl7CgkJCQkJCWlUaGlzSW5kZXggPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJCQkJblRyc1tpXS5fRFRfUm93SW5kZXggPSBpVGhpc0luZGV4OwoJCQkJCQlvU2V0dGluZ3MuYW9EYXRhLnB1c2goICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vUm93LCB7CgkJCQkJCQkiblRyIjogblRyc1tpXQoJCQkJCQl9ICkgKTsKCQkJCQkJCgkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVRoaXNJbmRleCApOwoJCQkJCQluVGRzID0gblRyc1tpXS5jaGlsZE5vZGVzOwoJCQkJCQlqSW5uZXIgPSAwOwoJCQkJCQkKCQkJCQkJZm9yICggaj0wLCBqTGVuPW5UZHMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQkJewoJCQkJCQkJc05vZGVOYW1lID0gblRkc1tqXS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpOwoJCQkJCQkJaWYgKCBzTm9kZU5hbWUgPT0gIlREIiB8fCBzTm9kZU5hbWUgPT0gIlRIIiApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVRoaXNJbmRleCwgaklubmVyLCAkLnRyaW0oblRkc1tqXS5pbm5lckhUTUwpICk7CgkJCQkJCQkJaklubmVyKys7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEdhdGhlciBpbiB0aGUgVEQgZWxlbWVudHMgb2YgdGhlIFRhYmxlIC0gbm90ZSB0aGF0IHRoaXMgaXMgYmFzaWNhbGx5IHRoZSBzYW1lIGFzCgkJCSAqIGZuR2V0VGROb2RlcywgYnV0IHRoYXQgZnVuY3Rpb24gdGFrZXMgYWNjb3VudCBvZiBoaWRkZW4gY29sdW1ucywgd2hpY2ggd2UgaGF2ZW4ndCB5ZXQKCQkJICogc2V0dXAhCgkJCSAqLwoJCQluVHJzID0gX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICk7CgkJCW5UZHMgPSBbXTsKCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggaj0wLCBqTGVuPW5UcnNbaV0uY2hpbGROb2Rlcy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCW5UZCA9IG5UcnNbaV0uY2hpbGROb2Rlc1tqXTsKCQkJCQlzTm9kZU5hbWUgPSBuVGQubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVEQiIHx8IHNOb2RlTmFtZSA9PSAiVEgiICkKCQkJCQl7CgkJCQkJCW5UZHMucHVzaCggblRkICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBOb3cgcHJvY2VzcyBieSBjb2x1bW4gKi8KCQkJZm9yICggaUNvbHVtbj0wLCBpQ29sdW1ucz1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGlDb2x1bW48aUNvbHVtbnMgOyBpQ29sdW1uKysgKQoJCQl7CgkJCQlvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkKCQkJCS8qIEdldCB0aGUgdGl0bGUgb2YgdGhlIGNvbHVtbiAtIHVubGVzcyB0aGVyZSBpcyBhIHVzZXIgc2V0IG9uZSAqLwoJCQkJaWYgKCBvQ29sLnNUaXRsZSA9PT0gbnVsbCApCgkJCQl7CgkJCQkJb0NvbC5zVGl0bGUgPSBvQ29sLm5UaC5pbm5lckhUTUw7CgkJCQl9CgkJCQkKCQkJCXZhcgoJCQkJCWJBdXRvVHlwZSA9IG9Db2wuX2JBdXRvVHlwZSwKCQkJCQliUmVuZGVyID0gdHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicsCgkJCQkJYkNsYXNzID0gb0NvbC5zQ2xhc3MgIT09IG51bGwsCgkJCQkJYlZpc2libGUgPSBvQ29sLmJWaXNpYmxlLAoJCQkJCW5DZWxsLCBzVGhpc1R5cGUsIHNSZW5kZXJlZCwgc1ZhbFR5cGU7CgkJCQkKCQkJCS8qIEEgc2luZ2xlIGxvb3AgdG8gcnVsZSB0aGVtIGFsbCAoYW5kIGJlIG1vcmUgZWZmaWNpZW50KSAqLwoJCQkJaWYgKCBiQXV0b1R5cGUgfHwgYlJlbmRlciB8fCBiQ2xhc3MgfHwgIWJWaXNpYmxlICkKCQkJCXsKCQkJCQlmb3IgKCBpUm93PTAsIGlSb3dzPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaVJvdzxpUm93cyA7IGlSb3crKyApCgkJCQkJewoJCQkJCQlvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCQkJCW5DZWxsID0gblRkc1sgKGlSb3cqaUNvbHVtbnMpICsgaUNvbHVtbiBdOwoJCQkJCQkKCQkJCQkJLyogVHlwZSBkZXRlY3Rpb24gKi8KCQkJCQkJaWYgKCBiQXV0b1R5cGUgJiYgb0NvbC5zVHlwZSAhPSAnc3RyaW5nJyApCgkJCQkJCXsKCQkJCQkJCXNWYWxUeXBlID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ3R5cGUnICk7CgkJCQkJCQlpZiAoIHNWYWxUeXBlICE9PSAnJyApCgkJCQkJCQl7CgkJCQkJCQkJc1RoaXNUeXBlID0gX2ZuRGV0ZWN0VHlwZSggc1ZhbFR5cGUgKTsKCQkJCQkJCQlpZiAoIG9Db2wuc1R5cGUgPT09IG51bGwgKQoJCQkJCQkJCXsKCQkJCQkJCQkJb0NvbC5zVHlwZSA9IHNUaGlzVHlwZTsKCQkJCQkJCQl9CgkJCQkJCQkJZWxzZSBpZiAoIG9Db2wuc1R5cGUgIT0gc1RoaXNUeXBlICYmIAoJCQkJCQkJCSAgICAgICAgICBvQ29sLnNUeXBlICE9ICJodG1sIiApCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBTdHJpbmcgaXMgYWx3YXlzIHRoZSAnZmFsbGJhY2snIG9wdGlvbiAqLwoJCQkJCQkJCQlvQ29sLnNUeXBlID0gJ3N0cmluZyc7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCgkJCQkJCWlmICggdHlwZW9mIG9Db2wubURhdGEgPT09ICdmdW5jdGlvbicgKQoJCQkJCQl7CgkJCQkJCQluQ2VsbC5pbm5lckhUTUwgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKTsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogUmVuZGVyaW5nICovCgkJCQkJCWlmICggYlJlbmRlciApCgkJCQkJCXsKCQkJCQkJCXNSZW5kZXJlZCA9IF9mblJlbmRlciggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uICk7CgkJCQkJCQluQ2VsbC5pbm5lckhUTUwgPSBzUmVuZGVyZWQ7CgkJCQkJCQlpZiAoIG9Db2wuYlVzZVJlbmRlcmVkICkKCQkJCQkJCXsKCQkJCQkJCQkvKiBVc2UgdGhlIHJlbmRlcmVkIGRhdGEgZm9yIGZpbHRlcmluZyAvIHNvcnRpbmcgKi8KCQkJCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCBzUmVuZGVyZWQgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogQ2xhc3NlcyAqLwoJCQkJCQlpZiAoIGJDbGFzcyApCgkJCQkJCXsKCQkJCQkJCW5DZWxsLmNsYXNzTmFtZSArPSAnICcrb0NvbC5zQ2xhc3M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIENvbHVtbiB2aXNpYmlsaXR5ICovCgkJCQkJCWlmICggIWJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbkNlbGw7CgkJCQkJCQluQ2VsbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuQ2VsbCApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbnVsbDsKCQkJCQkJfQoJCQoJCQkJCQlpZiAoIG9Db2wuZm5DcmVhdGVkQ2VsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJCW5DZWxsLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpQ29sdW1uCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8qIFJvdyBjcmVhdGVkIGNhbGxiYWNrcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5hb1Jvd0NyZWF0ZWRDYWxsYmFjay5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpXTsKCQkJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUm93Q3JlYXRlZENhbGxiYWNrJywgbnVsbCwgW29EYXRhLm5Uciwgb0RhdGEuX2FEYXRhLCBpXSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFRha2UgYSBUUiBlbGVtZW50IGFuZCBjb252ZXJ0IGl0IHRvIGFuIGluZGV4IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0aGUgVFIgZWxlbWVudCB0byBmaW5kCgkJICogIEByZXR1cm5zIHtpbnR9IGluZGV4IGlmIHRoZSBub2RlIGlzIGZvdW5kLCBudWxsIGlmIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ob2RlVG9EYXRhSW5kZXgoIG9TZXR0aW5ncywgbiApCgkJewoJCQlyZXR1cm4gKG4uX0RUX1Jvd0luZGV4IT09dW5kZWZpbmVkKSA/IG4uX0RUX1Jvd0luZGV4IDogbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSBhIFREIGVsZW1lbnQgYW5kIGNvbnZlcnQgaXQgaW50byBhIGNvbHVtbiBkYXRhIGluZGV4IChub3QgdGhlIHZpc2libGUgaW5kZXgpCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBudW1iZXIgdGhlIFREL1RIIGNhbiBiZSBmb3VuZCBpbgoJCSAqICBAcGFyYW0ge25vZGV9IG4gVGhlIFREL1RIIGVsZW1lbnQgdG8gZmluZAoJCSAqICBAcmV0dXJucyB7aW50fSBpbmRleCBpZiB0aGUgbm9kZSBpcyBmb3VuZCwgLTEgaWYgbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk5vZGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlSb3csIG4gKQoJCXsKCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5DZWxsc1tpXSA9PT0gbiApCgkJCQl7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIC0xOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgZGF0YSBmb3IgYSBnaXZlbiByb3cgZnJvbSB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgndHlwZScgJ2ZpbHRlcicgJ3NvcnQnKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhaUNvbHVtbnMgQXJyYXkgb2YgY29sdW1uIGluZGV4ZXMgdG8gZ2V0IGRhdGEgZnJvbQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpUm93LCBzU3BlY2lmaWMsIGFpQ29sdW1ucyApCgkJewoJCQl2YXIgb3V0ID0gW107CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YWlDb2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW91dC5wdXNoKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBhaUNvbHVtbnNbaV0sIHNTcGVjaWZpYyApICk7CgkJCX0KCQkJcmV0dXJuIG91dDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBkYXRhIGZvciBhIGdpdmVuIGNlbGwgZnJvbSB0aGUgaW50ZXJuYWwgY2FjaGUsIHRha2luZyBpbnRvIGFjY291bnQgZGF0YSBtYXBwaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIHJvdyBpZAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBDb2x1bW4gaW5kZXgKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgnZGlzcGxheScsICd0eXBlJyAnZmlsdGVyJyAnc29ydCcpCgkJICogIEByZXR1cm5zIHsqfSBDZWxsIGRhdGEKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgc1NwZWNpZmljICkKCQl7CgkJCXZhciBzRGF0YTsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJaWYgKCAoc0RhdGE9b0NvbC5mbkdldERhdGEoIG9EYXRhLCBzU3BlY2lmaWMgKSkgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmlEcmF3RXJyb3IgIT0gb1NldHRpbmdzLmlEcmF3ICYmIG9Db2wuc0RlZmF1bHRDb250ZW50ID09PSBudWxsICkKCQkJCXsKCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJlcXVlc3RlZCB1bmtub3duIHBhcmFtZXRlciAiKwoJCQkJCQkodHlwZW9mIG9Db2wubURhdGE9PSdmdW5jdGlvbicgPyAne21EYXRhIGZ1bmN0aW9ufScgOiAiJyIrb0NvbC5tRGF0YSsiJyIpKwoJCQkJCQkiIGZyb20gdGhlIGRhdGEgc291cmNlIGZvciByb3cgIitpUm93ICk7CgkJCQkJb1NldHRpbmdzLmlEcmF3RXJyb3IgPSBvU2V0dGluZ3MuaURyYXc7CgkJCQl9CgkJCQlyZXR1cm4gb0NvbC5zRGVmYXVsdENvbnRlbnQ7CgkJCX0KCQkKCQkJLyogV2hlbiB0aGUgZGF0YSBzb3VyY2UgaXMgbnVsbCwgd2UgY2FuIHVzZSBkZWZhdWx0IGNvbHVtbiBkYXRhICovCgkJCWlmICggc0RhdGEgPT09IG51bGwgJiYgb0NvbC5zRGVmYXVsdENvbnRlbnQgIT09IG51bGwgKQoJCQl7CgkJCQlzRGF0YSA9IG9Db2wuc0RlZmF1bHRDb250ZW50OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICdmdW5jdGlvbicgKQoJCQl7CgkJCQkvKiBJZiB0aGUgZGF0YSBzb3VyY2UgaXMgYSBmdW5jdGlvbiwgdGhlbiB3ZSBydW4gaXQgYW5kIHVzZSB0aGUgcmV0dXJuICovCgkJCQlyZXR1cm4gc0RhdGEoKTsKCQkJfQoJCQoJCQlpZiAoIHNTcGVjaWZpYyA9PSAnZGlzcGxheScgJiYgc0RhdGEgPT09IG51bGwgKQoJCQl7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQkJcmV0dXJuIHNEYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZXQgdGhlIHZhbHVlIGZvciBhIHNwZWNpZmljIGNlbGwsIGludG8gdGhlIGludGVybmFsIGRhdGEgY2FjaGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgcm93IGlkCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIENvbHVtbiBpbmRleAoJCSAqICBAcGFyYW0geyp9IHZhbCBWYWx1ZSB0byBzZXQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgdmFsICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sXTsKCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGE7CgkJCgkJCW9Db2wuZm5TZXREYXRhKCBvRGF0YSwgdmFsICk7CgkJfQoJCQoJCQoJCS8vIFByaXZhdGUgdmFyaWFibGUgdGhhdCBpcyB1c2VkIHRvIG1hdGNoIGFycmF5IHN5bnRheCBpbiB0aGUgZGF0YSBwcm9wZXJ0eSBvYmplY3QKCQl2YXIgX19yZUFycmF5ID0gL1xbLio/XF0kLzsKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGdldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIGdldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogR2l2ZSBhbiBlbXB0eSBzdHJpbmcgZm9yIHJlbmRlcmluZyAvIHNvcnRpbmcgZXRjICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHR5cGUpIHsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX07CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBleHRyYSkgewoJCQkJCXJldHVybiBtU291cmNlKCBkYXRhLCB0eXBlLCBleHRyYSApOwoJCQkJfTsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIG1Tb3VyY2UgPT09ICdzdHJpbmcnICYmIChtU291cmNlLmluZGV4T2YoJy4nKSAhPT0gLTEgfHwgbVNvdXJjZS5pbmRleE9mKCdbJykgIT09IC0xKSApCgkJCXsKCQkJCS8qIElmIHRoZXJlIGlzIGEgLiBpbiB0aGUgc291cmNlIHN0cmluZyB0aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBpbiBhIAoJCQkJICogbmVzdGVkIG9iamVjdCBzbyB3ZSBsb29wIG92ZXIgdGhlIGRhdGEgZm9yIGVhY2ggbGV2ZWwgdG8gZ2V0IHRoZSBuZXh0CgkJCQkgKiBsZXZlbCBkb3duLiBPbiBlYWNoIGxvb3Agd2UgdGVzdCBmb3IgdW5kZWZpbmVkLCBhbmQgaWYgZm91bmQgaW1tZWRpYXRlbHkKCQkJCSAqIHJldHVybi4gVGhpcyBhbGxvd3MgZW50aXJlIG9iamVjdHMgdG8gYmUgbWlzc2luZyBhbmQgc0RlZmF1bHRDb250ZW50IHRvCgkJCQkgKiBiZSB1c2VkIGlmIGRlZmluZWQsIHJhdGhlciB0aGFuIHRocm93aW5nIGFuIGVycm9yCgkJCQkgKi8KCQkJCXZhciBmZXRjaERhdGEgPSBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgc3JjKSB7CgkJCQkJdmFyIGEgPSBzcmMuc3BsaXQoJy4nKTsKCQkJCQl2YXIgYXJyYXlOb3RhdGlvbiwgb3V0LCBpbm5lclNyYzsKCQkKCQkJCQlpZiAoIHNyYyAhPT0gIiIgKQoJCQkJCXsKCQkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCS8vIENoZWNrIGlmIHdlIGFyZSBkZWFsaW5nIHdpdGggYW4gYXJyYXkgbm90YXRpb24gcmVxdWVzdAoJCQkJCQkJYXJyYXlOb3RhdGlvbiA9IGFbaV0ubWF0Y2goX19yZUFycmF5KTsKCQkKCQkJCQkJCWlmICggYXJyYXlOb3RhdGlvbiApIHsKCQkJCQkJCQlhW2ldID0gYVtpXS5yZXBsYWNlKF9fcmVBcnJheSwgJycpOwoJCQoJCQkJCQkJCS8vIENvbmRpdGlvbiBhbGxvd3Mgc2ltcGx5IFtdIHRvIGJlIHBhc3NlZCBpbgoJCQkJCQkJCWlmICggYVtpXSAhPT0gIiIgKSB7CgkJCQkJCQkJCWRhdGEgPSBkYXRhWyBhW2ldIF07CgkJCQkJCQkJfQoJCQkJCQkJCW91dCA9IFtdOwoJCQkJCQkJCQoJCQkJCQkJCS8vIEdldCB0aGUgcmVtYWluZGVyIG9mIHRoZSBuZXN0ZWQgb2JqZWN0IHRvIGdldAoJCQkJCQkJCWEuc3BsaWNlKCAwLCBpKzEgKTsKCQkJCQkJCQlpbm5lclNyYyA9IGEuam9pbignLicpOwoJCQoJCQkJCQkJCS8vIFRyYXZlcnNlIGVhY2ggZW50cnkgaW4gdGhlIGFycmF5IGdldHRpbmcgdGhlIHByb3BlcnRpZXMgcmVxdWVzdGVkCgkJCQkJCQkJZm9yICggdmFyIGo9MCwgakxlbj1kYXRhLmxlbmd0aCA7IGo8akxlbiA7IGorKyApIHsKCQkJCQkJCQkJb3V0LnB1c2goIGZldGNoRGF0YSggZGF0YVtqXSwgdHlwZSwgaW5uZXJTcmMgKSApOwoJCQkJCQkJCX0KCQkKCQkJCQkJCQkvLyBJZiBhIHN0cmluZyBpcyBnaXZlbiBpbiBiZXR3ZWVuIHRoZSBhcnJheSBub3RhdGlvbiBpbmRpY2F0b3JzLCB0aGF0CgkJCQkJCQkJLy8gaXMgdXNlZCB0byBqb2luIHRoZSBzdHJpbmdzIHRvZ2V0aGVyLCBvdGhlcndpc2UgYW4gYXJyYXkgaXMgcmV0dXJuZWQKCQkJCQkJCQl2YXIgam9pbiA9IGFycmF5Tm90YXRpb25bMF0uc3Vic3RyaW5nKDEsIGFycmF5Tm90YXRpb25bMF0ubGVuZ3RoLTEpOwoJCQkJCQkJCWRhdGEgPSAoam9pbj09PSIiKSA/IG91dCA6IG91dC5qb2luKGpvaW4pOwoJCQoJCQkJCQkJCS8vIFRoZSBpbm5lciBjYWxsIHRvIGZldGNoRGF0YSBoYXMgYWxyZWFkeSB0cmF2ZXJzZWQgdGhyb3VnaCB0aGUgcmVtYWluZGVyCgkJCQkJCQkJLy8gb2YgdGhlIHNvdXJjZSByZXF1ZXN0ZWQsIHNvIHdlIGV4aXQgZnJvbSB0aGUgbG9vcAoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQoJCQkJCQkJaWYgKCBkYXRhID09PSBudWxsIHx8IGRhdGFbIGFbaV0gXSA9PT0gdW5kZWZpbmVkICkKCQkJCQkJCXsKCQkJCQkJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCQkJCQkJfQoJCQkJCQkJZGF0YSA9IGRhdGFbIGFbaV0gXTsKCQkJCQkJfQoJCQkJCX0KCQkKCQkJCQlyZXR1cm4gZGF0YTsKCQkJCX07CgkJCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHR5cGUpIHsKCQkJCQlyZXR1cm4gZmV0Y2hEYXRhKCBkYXRhLCB0eXBlLCBtU291cmNlICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIGRhdGFbbVNvdXJjZV07CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHNldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIHNldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogTm90aGluZyB0byBkbyB3aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkge307CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQltU291cmNlKCBkYXRhLCAnc2V0JywgdmFsICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgKG1Tb3VyY2UuaW5kZXhPZignLicpICE9PSAtMSB8fCBtU291cmNlLmluZGV4T2YoJ1snKSAhPT0gLTEpICkKCQkJewoJCQkJLyogTGlrZSB0aGUgZ2V0LCB3ZSBuZWVkIHRvIGdldCBkYXRhIGZyb20gYSBuZXN0ZWQgb2JqZWN0ICovCgkJCQl2YXIgc2V0RGF0YSA9IGZ1bmN0aW9uIChkYXRhLCB2YWwsIHNyYykgewoJCQkJCXZhciBhID0gc3JjLnNwbGl0KCcuJyksIGI7CgkJCQkJdmFyIGFycmF5Tm90YXRpb24sIG8sIGlubmVyU3JjOwoJCQoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGgtMSA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQkvLyBDaGVjayBpZiB3ZSBhcmUgZGVhbGluZyB3aXRoIGFuIGFycmF5IG5vdGF0aW9uIHJlcXVlc3QKCQkJCQkJYXJyYXlOb3RhdGlvbiA9IGFbaV0ubWF0Y2goX19yZUFycmF5KTsKCQkKCQkJCQkJaWYgKCBhcnJheU5vdGF0aW9uICkKCQkJCQkJewoJCQkJCQkJYVtpXSA9IGFbaV0ucmVwbGFjZShfX3JlQXJyYXksICcnKTsKCQkJCQkJCWRhdGFbIGFbaV0gXSA9IFtdOwoJCQkJCQkJCgkJCQkJCQkvLyBHZXQgdGhlIHJlbWFpbmRlciBvZiB0aGUgbmVzdGVkIG9iamVjdCB0byBzZXQgc28gd2UgY2FuIHJlY3Vyc2UKCQkJCQkJCWIgPSBhLnNsaWNlKCk7CgkJCQkJCQliLnNwbGljZSggMCwgaSsxICk7CgkJCQkJCQlpbm5lclNyYyA9IGIuam9pbignLicpOwoJCQoJCQkJCQkJLy8gVHJhdmVyc2UgZWFjaCBlbnRyeSBpbiB0aGUgYXJyYXkgc2V0dGluZyB0aGUgcHJvcGVydGllcyByZXF1ZXN0ZWQKCQkJCQkJCWZvciAoIHZhciBqPTAsIGpMZW49dmFsLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJbyA9IHt9OwoJCQkJCQkJCXNldERhdGEoIG8sIHZhbFtqXSwgaW5uZXJTcmMgKTsKCQkJCQkJCQlkYXRhWyBhW2ldIF0ucHVzaCggbyApOwoJCQkJCQkJfQoJCQoJCQkJCQkJLy8gVGhlIGlubmVyIGNhbGwgdG8gc2V0RGF0YSBoYXMgYWxyZWFkeSB0cmF2ZXJzZWQgdGhyb3VnaCB0aGUgcmVtYWluZGVyCgkJCQkJCQkvLyBvZiB0aGUgc291cmNlIGFuZCBoYXMgc2V0IHRoZSBkYXRhLCB0aHVzIHdlIGNhbiBleGl0IGhlcmUKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQoJCQkJCQkvLyBJZiB0aGUgbmVzdGVkIG9iamVjdCBkb2Vzbid0IGN1cnJlbnRseSBleGlzdCAtIHNpbmNlIHdlIGFyZQoJCQkJCQkvLyB0cnlpbmcgdG8gc2V0IHRoZSB2YWx1ZSAtIGNyZWF0ZSBpdAoJCQkJCQlpZiAoIGRhdGFbIGFbaV0gXSA9PT0gbnVsbCB8fCBkYXRhWyBhW2ldIF0gPT09IHVuZGVmaW5lZCApCgkJCQkJCXsKCQkJCQkJCWRhdGFbIGFbaV0gXSA9IHt9OwoJCQkJCQl9CgkJCQkJCWRhdGEgPSBkYXRhWyBhW2ldIF07CgkJCQkJfQoJCQoJCQkJCS8vIElmIGFycmF5IG5vdGF0aW9uIGlzIHVzZWQsIHdlIGp1c3Qgd2FudCB0byBzdHJpcCBpdCBhbmQgdXNlIHRoZSBwcm9wZXJ0eSBuYW1lCgkJCQkJLy8gYW5kIGFzc2lnbiB0aGUgdmFsdWUuIElmIGl0IGlzbid0IHVzZWQsIHRoZW4gd2UgZ2V0IHRoZSByZXN1bHQgd2Ugd2FudCBhbnl3YXkKCQkJCQlkYXRhWyBhW2EubGVuZ3RoLTFdLnJlcGxhY2UoX19yZUFycmF5LCAnJykgXSA9IHZhbDsKCQkJCX07CgkJCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCXJldHVybiBzZXREYXRhKCBkYXRhLCB2YWwsIG1Tb3VyY2UgKTsKCQkJCX07CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBBcnJheSBvciBmbGF0IG9iamVjdCBtYXBwaW5nICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCWRhdGFbbVNvdXJjZV0gPSB2YWw7CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gYXJyYXkgd2l0aCB0aGUgZnVsbCB0YWJsZSBkYXRhCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMgYXJyYXkge2FycmF5fSBhRGF0YSBNYXN0ZXIgZGF0YSBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXREYXRhTWFzdGVyICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhRGF0YSA9IFtdOwoJCQl2YXIgaUxlbiA9IG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxpTGVuOyBpKysgKQoJCQl7CgkJCQlhRGF0YS5wdXNoKCBvU2V0dGluZ3MuYW9EYXRhW2ldLl9hRGF0YSApOwoJCQl9CgkJCXJldHVybiBhRGF0YTsKCQl9CgkJCgkJCgkJLyoqCgkJICogTnVrZSB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKQoJCXsKCQkJb1NldHRpbmdzLmFvRGF0YS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoICk7CgkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCApOwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggMCwgb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggKTsKCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQl9CgkJCgkJCgkJIC8qKgoJCSAqIFRha2UgYW4gYXJyYXkgb2YgaW50ZWdlcnMgKGluZGV4IGFycmF5KSBhbmQgcmVtb3ZlIGEgdGFyZ2V0IGludGVnZXIgKHZhbHVlIC0gbm90IAoJCSAqIHRoZSBrZXkhKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhIEluZGV4IGFycmF5IHRvIHRhcmdldAoJCSAqICBAcGFyYW0ge2ludH0gaVRhcmdldCB2YWx1ZSB0byBmaW5kCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRlbGV0ZUluZGV4KCBhLCBpVGFyZ2V0ICkKCQl7CgkJCXZhciBpVGFyZ2V0SW5kZXggPSAtMTsKCQkJCgkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGFbaV0gPT0gaVRhcmdldCApCgkJCQl7CgkJCQkJaVRhcmdldEluZGV4ID0gaTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBhW2ldID4gaVRhcmdldCApCgkJCQl7CgkJCQkJYVtpXS0tOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIGlUYXJnZXRJbmRleCAhPSAtMSApCgkJCXsKCQkJCWEuc3BsaWNlKCBpVGFyZ2V0SW5kZXgsIDEgKTsKCQkJfQoJCX0KCQkKCQkKCQkgLyoqCgkJICogQ2FsbCB0aGUgZGV2ZWxvcGVyIGRlZmluZWQgZm5SZW5kZXIgZnVuY3Rpb24gZm9yIGEgZ2l2ZW4gY2VsbCAocm93L2NvbHVtbikgd2l0aAoJCSAqIHRoZSByZXF1aXJlZCBwYXJhbWV0ZXJzIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgaW5kZXggZm9yIHRoZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgYW9Db2x1bW5zIGluZGV4IGZvciB0aGUgY29sdW1uCgkJICogIEByZXR1cm5zIHsqfSBSZXR1cm4gb2YgdGhlIGRldmVsb3BlcidzIGZuUmVuZGVyIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlbmRlciggb1NldHRpbmdzLCBpUm93LCBpQ29sICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sXTsKCQkKCQkJcmV0dXJuIG9Db2wuZm5SZW5kZXIoIHsKCQkJCSJpRGF0YVJvdyI6ICAgIGlSb3csCgkJCQkiaURhdGFDb2x1bW4iOiBpQ29sLAoJCQkJIm9TZXR0aW5ncyI6ICAgb1NldHRpbmdzLAoJCQkJImFEYXRhIjogICAgICAgb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEsCgkJCQkibURhdGFQcm9wIjogICBvQ29sLm1EYXRhCgkJCX0sIF9mbkdldENlbGxEYXRhKG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJ2Rpc3BsYXknKSApOwoJCX0KCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgVFIgZWxlbWVudCAoYW5kIGl0J3MgVEQgY2hpbGRyZW4pIGZvciBhIHJvdwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFJvdyB0byBjb25zaWRlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVUciAoIG9TZXR0aW5ncywgaVJvdyApCgkJewoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQl2YXIgblRkOwoJCQoJCQlpZiAoIG9EYXRhLm5UciA9PT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhLm5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CgkJCgkJCQkvKiBVc2UgYSBwcml2YXRlIHByb3BlcnR5IG9uIHRoZSBub2RlIHRvIGFsbG93IHJlc2VydmUgbWFwcGluZyBmcm9tIHRoZSBub2RlCgkJCQkgKiB0byB0aGUgYW9EYXRhIGFycmF5IGZvciBmYXN0IGxvb2sgdXAKCQkJCSAqLwoJCQkJb0RhdGEublRyLl9EVF9Sb3dJbmRleCA9IGlSb3c7CgkJCgkJCQkvKiBTcGVjaWFsIHBhcmFtZXRlcnMgY2FuIGJlIGdpdmVuIGJ5IHRoZSBkYXRhIHNvdXJjZSB0byBiZSB1c2VkIG9uIHRoZSByb3cgKi8KCQkJCWlmICggb0RhdGEuX2FEYXRhLkRUX1Jvd0lkICkKCQkJCXsKCQkJCQlvRGF0YS5uVHIuaWQgPSBvRGF0YS5fYURhdGEuRFRfUm93SWQ7CgkJCQl9CgkJCgkJCQlpZiAoIG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzcyApCgkJCQl7CgkJCQkJJChvRGF0YS5uVHIpLmFkZENsYXNzKCBvRGF0YS5fYURhdGEuRFRfUm93Q2xhc3MgKTsKCQkJCX0KCQkKCQkJCS8qIFByb2Nlc3MgZWFjaCBjb2x1bW4gKi8KCQkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkJCQluVGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBvQ29sLnNDZWxsVHlwZSApOwoJCQoJCQkJCS8qIFJlbmRlciBpZiBuZWVkZWQgLSBpZiBiVXNlUmVuZGVyZWQgaXMgdHJ1ZSB0aGVuIHdlIGFscmVhZHkgaGF2ZSB0aGUgcmVuZGVyZWQKCQkJCQkgKiB2YWx1ZSBpbiB0aGUgZGF0YSBzb3VyY2UgLSBzbyBjYW4ganVzdCB1c2UgdGhhdAoJCQkJCSAqLwoJCQkJCW5UZC5pbm5lckhUTUwgPSAodHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgKCFvQ29sLmJVc2VSZW5kZXJlZCB8fCBvQ29sLm1EYXRhID09PSBudWxsKSkgPwoJCQkJCQlfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaSApIDoKCQkJCQkJX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCQkvKiBBZGQgdXNlciBkZWZpbmVkIGNsYXNzICovCgkJCQkJaWYgKCBvQ29sLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQuY2xhc3NOYW1lID0gb0NvbC5zQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggb0NvbC5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlvRGF0YS5uVHIuYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBudWxsOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBuVGQ7CgkJCQkJfQoJCQoJCQkJCWlmICggb0NvbC5mbkNyZWF0ZWRDZWxsICkKCQkJCQl7CgkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJblRkLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpCgkJCQkJCSk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG51bGwsIFtvRGF0YS5uVHIsIG9EYXRhLl9hRGF0YSwgaVJvd10gKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgdGhlIEhUTUwgaGVhZGVyIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZEhlYWQoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaSwgblRoLCBpTGVuLCBqLCBqTGVuOwoJCQl2YXIgaVRocyA9IG9TZXR0aW5ncy5uVEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJykubGVuZ3RoOwoJCQl2YXIgaUNvcnJlY3RvciA9IDA7CgkJCXZhciBqcUNoaWxkcmVuOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYSBoZWFkZXIgaW4gcGxhY2UgLSB0aGVuIHVzZSBpdCAtIG90aGVyd2lzZSBpdCdzIGdvaW5nIHRvIGdldCBudWtlZC4uLiAqLwoJCQlpZiAoIGlUaHMgIT09IDAgKQoJCQl7CgkJCQkvKiBXZSd2ZSBnb3QgYSB0aGVhZCBmcm9tIHRoZSBET00sIHNvIHJlbW92ZSBoaWRkZW4gY29sdW1ucyBhbmQgYXBwbHkgd2lkdGggdG8gdmlzIGNvbHMgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJblRoID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGg7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgncm9sZScsICdjb2x1bW5oZWFkZXInKTsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4Jywgb1NldHRpbmdzLmlUYWJJbmRleCk7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBvU2V0dGluZ3Muc1RhYmxlSWQpOwoJCQkJCX0KCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCSQoblRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogU2V0IHRoZSB0aXRsZSBvZiB0aGUgY29sdW1uIGlmIGl0IGlzIHVzZXIgZGVmaW5lZCAobm90IHdoYXQgd2FzIGF1dG8gZGV0ZWN0ZWQpICovCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZSAhPSBuVGguaW5uZXJIVE1MICkKCQkJCQl7CgkJCQkJCW5UaC5pbm5lckhUTUwgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBXZSBkb24ndCBoYXZlIGEgaGVhZGVyIGluIHRoZSBET00gLSBzbyB3ZSBhcmUgZ29pbmcgdG8gaGF2ZSB0byBjcmVhdGUgb25lICovCgkJCQl2YXIgblRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInRyIiApOwoJCQkJCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5UaCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoOwoJCQkJCW5UaC5pbm5lckhUTUwgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZTsKCQkJCQluVGguc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQkkKG5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICk7CgkJCQkJfQoJCQkJCQoJCQkJCW5Uci5hcHBlbmRDaGlsZCggblRoICk7CgkJCQl9CgkJCQkkKG9TZXR0aW5ncy5uVEhlYWQpLmh0bWwoICcnIClbMF0uYXBwZW5kQ2hpbGQoIG5UciApOwoJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBvU2V0dGluZ3MuYW9IZWFkZXIsIG9TZXR0aW5ncy5uVEhlYWQgKTsKCQkJfQoJCQkKCQkJLyogQVJJQSByb2xlIGZvciB0aGUgcm93cyAqLwkKCQkJJChvU2V0dGluZ3MublRIZWFkKS5jaGlsZHJlbigndHInKS5hdHRyKCdyb2xlJywgJ3JvdycpOwoJCQkKCQkJLyogQWRkIHRoZSBleHRyYSBtYXJrdXAgbmVlZGVkIGJ5IGpRdWVyeSBVSSdzIHRoZW1lcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluVGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaDsKCQkJCQkKCQkJCQl2YXIgbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJCW5EaXYuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJV3JhcHBlcjsKCQkJCQkkKG5UaCkuY29udGVudHMoKS5hcHBlbmRUbyhuRGl2KTsKCQkJCQkKCQkJCQl2YXIgblNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CgkJCQkJblNwYW4uY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SWNvbjsKCQkJCQluRGl2LmFwcGVuZENoaWxkKCBuU3BhbiApOwoJCQkJCW5UaC5hcHBlbmRDaGlsZCggbkRpdiApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICE9PSBmYWxzZSApCgkJCQkJewoJCQkJCQlfZm5Tb3J0QXR0YWNoTGlzdGVuZXIoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgsIGkgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBEZWFsIHdpdGggdGhlIGZvb3RlciAtIGFkZCBjbGFzc2VzIGlmIHJlcXVpcmVkICovCgkJCWlmICggb1NldHRpbmdzLm9DbGFzc2VzLnNGb290ZXJUSCAhPT0gIiIgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVEZvb3QpLmNoaWxkcmVuKCd0cicpLmNoaWxkcmVuKCd0aCcpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc0Zvb3RlclRIICk7CgkJCX0KCQkJCgkJCS8qIENhY2hlIHRoZSBmb290ZXIgZWxlbWVudHMgKi8KCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncywgbnVsbCwgb1NldHRpbmdzLmFvRm9vdGVyICk7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5DZWxsc1tpXSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UZiA9IGFuQ2VsbHNbaV07CgkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKQoJCQkJCQl7CgkJCQkJCQkkKGFuQ2VsbHNbaV0pLmFkZENsYXNzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIGhlYWRlciAob3IgZm9vdGVyKSBlbGVtZW50IGJhc2VkIG9uIHRoZSBjb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZXMuIFRoZQoJCSAqIG1ldGhvZG9sb2d5IGhlcmUgaXMgdG8gdXNlIHRoZSBsYXlvdXQgYXJyYXkgZnJvbSBfZm5EZXRlY3RIZWFkZXIsIG1vZGlmaWVkIGZvcgoJCSAqIHRoZSBpbnN0YW50YW5lb3VzIGNvbHVtbiB2aXNpYmlsaXR5LCB0byBjb25zdHJ1Y3QgdGhlIG5ldyBsYXlvdXQuIFRoZSBncmlkIGlzCgkJICogdHJhdmVyc2VkIG92ZXIgY2VsbCBhdCBhIHRpbWUgaW4gYSByb3dzIHggY29sdW1ucyBncmlkIGZhc2hpb24sIGFsdGhvdWdoIGVhY2ggCgkJICogY2VsbCBpbnNlcnQgY2FuIGNvdmVyIG11bHRpcGxlIGVsZW1lbnRzIGluIHRoZSBncmlkIC0gd2hpY2ggaXMgdHJhY2tzIHVzaW5nIHRoZQoJCSAqIGFBcHBsaWVkIGFycmF5LiBDZWxsIGluc2VydHMgaW4gdGhlIGdyaWQgd2lsbCBvbmx5IG9jY3VyIHdoZXJlIHRoZXJlIGlzbid0CgkJICogYWxyZWFkeSBhIGNlbGwgaW4gdGhhdCBwb3NpdGlvbi4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0gYXJyYXkge29iamVjdHN9IGFvU291cmNlIExheW91dCBhcnJheSBmcm9tIF9mbkRldGVjdEhlYWRlcgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiSW5jbHVkZUhpZGRlbj1mYWxzZV0gSWYgdHJ1ZSB0aGVuIGluY2x1ZGUgdGhlIGhpZGRlbiBjb2x1bW5zIGluIHRoZSBjYWxjLCAKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgYW9Tb3VyY2UsIGJJbmNsdWRlSGlkZGVuICkKCQl7CgkJCXZhciBpLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuLCBuLCBuTG9jYWxUcjsKCQkJdmFyIGFvTG9jYWwgPSBbXTsKCQkJdmFyIGFBcHBsaWVkID0gW107CgkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgaVJvd3NwYW4sIGlDb2xzcGFuOwoJCQoJCQlpZiAoICBiSW5jbHVkZUhpZGRlbiA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJYkluY2x1ZGVIaWRkZW4gPSBmYWxzZTsKCQkJfQoJCQoJCQkvKiBNYWtlIGEgY29weSBvZiB0aGUgbWFzdGVyIGxheW91dCBhcnJheSwgYnV0IHdpdGhvdXQgdGhlIHZpc2libGUgY29sdW1ucyBpbiBpdCAqLwoJCQlmb3IgKCBpPTAsIGlMZW49YW9Tb3VyY2UubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYW9Mb2NhbFtpXSA9IGFvU291cmNlW2ldLnNsaWNlKCk7CgkJCQlhb0xvY2FsW2ldLm5UciA9IGFvU291cmNlW2ldLm5UcjsKCQkKCQkJCS8qIFJlbW92ZSBhbnkgY29sdW1ucyB3aGljaCBhcmUgY3VycmVudGx5IGhpZGRlbiAqLwoJCQkJZm9yICggaj1pQ29sdW1ucy0xIDsgaj49MCA7IGotLSApCgkJCQl7CgkJCQkJaWYgKCAhb1NldHRpbmdzLmFvQ29sdW1uc1tqXS5iVmlzaWJsZSAmJiAhYkluY2x1ZGVIaWRkZW4gKQoJCQkJCXsKCQkJCQkJYW9Mb2NhbFtpXS5zcGxpY2UoIGosIDEgKTsKCQkJCQl9CgkJCQl9CgkJCgkJCQkvKiBQcmVwIHRoZSBhcHBsaWVkIGFycmF5IC0gaXQgbmVlZHMgYW4gZWxlbWVudCBmb3IgZWFjaCByb3cgKi8KCQkJCWFBcHBsaWVkLnB1c2goIFtdICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPWFvTG9jYWwubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJbkxvY2FsVHIgPSBhb0xvY2FsW2ldLm5UcjsKCQkJCQoJCQkJLyogQWxsIGNlbGxzIGFyZSBnb2luZyB0byBiZSByZXBsYWNlZCwgc28gZW1wdHkgb3V0IHRoZSByb3cgKi8KCQkJCWlmICggbkxvY2FsVHIgKQoJCQkJewoJCQkJCXdoaWxlKCAobiA9IG5Mb2NhbFRyLmZpcnN0Q2hpbGQpICkKCQkJCQl7CgkJCQkJCW5Mb2NhbFRyLnJlbW92ZUNoaWxkKCBuICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJZm9yICggaj0wLCBqTGVuPWFvTG9jYWxbaV0ubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpUm93c3BhbiA9IDE7CgkJCQkJaUNvbHNwYW4gPSAxOwoJCQoJCQkJCS8qIENoZWNrIHRvIHNlZSBpZiB0aGVyZSBpcyBhbHJlYWR5IGEgY2VsbCAocm93L2NvbHNwYW4pIGNvdmVyaW5nIG91ciB0YXJnZXQKCQkJCQkgKiBpbnNlcnQgcG9pbnQuIElmIHRoZXJlIGlzLCB0aGVuIHRoZXJlIGlzIG5vdGhpbmcgdG8gZG8uCgkJCQkJICovCgkJCQkJaWYgKCBhQXBwbGllZFtpXVtqXSA9PT0gdW5kZWZpbmVkICkKCQkJCQl7CgkJCQkJCW5Mb2NhbFRyLmFwcGVuZENoaWxkKCBhb0xvY2FsW2ldW2pdLmNlbGwgKTsKCQkJCQkJYUFwcGxpZWRbaV1bal0gPSAxOwoJCQoJCQkJCQkvKiBFeHBhbmQgdGhlIGNlbGwgdG8gY292ZXIgYXMgbWFueSByb3dzIGFzIG5lZWRlZCAqLwoJCQkJCQl3aGlsZSAoIGFvTG9jYWxbaStpUm93c3Bhbl0gIT09IHVuZGVmaW5lZCAmJgoJCQkJCQkgICAgICAgIGFvTG9jYWxbaV1bal0uY2VsbCA9PSBhb0xvY2FsW2kraVJvd3NwYW5dW2pdLmNlbGwgKQoJCQkJCQl7CgkJCQkJCQlhQXBwbGllZFtpK2lSb3dzcGFuXVtqXSA9IDE7CgkJCQkJCQlpUm93c3BhbisrOwoJCQkJCQl9CgkJCgkJCQkJCS8qIEV4cGFuZCB0aGUgY2VsbCB0byBjb3ZlciBhcyBtYW55IGNvbHVtbnMgYXMgbmVlZGVkICovCgkJCQkJCXdoaWxlICggYW9Mb2NhbFtpXVtqK2lDb2xzcGFuXSAhPT0gdW5kZWZpbmVkICYmCgkJCQkJCSAgICAgICAgYW9Mb2NhbFtpXVtqXS5jZWxsID09IGFvTG9jYWxbaV1baitpQ29sc3Bhbl0uY2VsbCApCgkJCQkJCXsKCQkJCQkJCS8qIE11c3QgdXBkYXRlIHRoZSBhcHBsaWVkIGFycmF5IG92ZXIgdGhlIHJvd3MgZm9yIHRoZSBjb2x1bW5zICovCgkJCQkJCQlmb3IgKCBrPTAgOyBrPGlSb3dzcGFuIDsgaysrICkKCQkJCQkJCXsKCQkJCQkJCQlhQXBwbGllZFtpK2tdW2oraUNvbHNwYW5dID0gMTsKCQkJCQkJCX0KCQkJCQkJCWlDb2xzcGFuKys7CgkJCQkJCX0KCQkKCQkJCQkJLyogRG8gdGhlIGFjdHVhbCBleHBhbnNpb24gaW4gdGhlIERPTSAqLwoJCQkJCQlhb0xvY2FsW2ldW2pdLmNlbGwucm93U3BhbiA9IGlSb3dzcGFuOwoJCQkJCQlhb0xvY2FsW2ldW2pdLmNlbGwuY29sU3BhbiA9IGlDb2xzcGFuOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBJbnNlcnQgdGhlIHJlcXVpcmVkIFRSIG5vZGVzIGludG8gdGhlIHRhYmxlIGZvciBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRHJhdyggb1NldHRpbmdzICkKCQl7CgkJCS8qIFByb3ZpZGUgYSBwcmUtY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZSBkcmF3IGlzIGZhbHNlIGlzIHJldHVybmVkICovCgkJCXZhciBhUHJlRHJhdyA9IF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAncHJlRHJhdycsIFtvU2V0dGluZ3NdICk7CgkJCWlmICggJC5pbkFycmF5KCBmYWxzZSwgYVByZURyYXcgKSAhPT0gLTEgKQoJCQl7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIgaSwgaUxlbiwgbjsKCQkJdmFyIGFuUm93cyA9IFtdOwoJCQl2YXIgaVJvd0NvdW50ID0gMDsKCQkJdmFyIGlTdHJpcGVzID0gb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlcy5sZW5ndGg7CgkJCXZhciBpT3BlblJvd3MgPSBvU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGg7CgkJCQoJCQlvU2V0dGluZ3MuYkRyYXdpbmcgPSB0cnVlOwoJCQkKCQkJLyogQ2hlY2sgYW5kIHNlZSBpZiB3ZSBoYXZlIGFuIGluaXRpYWwgZHJhdyBwb3NpdGlvbiBmcm9tIHN0YXRlIHNhdmluZyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCAhPT0gdW5kZWZpbmVkICYmIG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCAhPSAtMSApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IChvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPj0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSkgPwoJCQkJCQkwIDogb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkJfQoJCQkJb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID0gLTE7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIGRyYXcgaW50ZXJjZXB0ICovCgkJCWlmICggb1NldHRpbmdzLmJEZWZlckxvYWRpbmcgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyA9IGZhbHNlOwoJCQkJb1NldHRpbmdzLmlEcmF3Kys7CgkJCX0KCQkJZWxzZSBpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJb1NldHRpbmdzLmlEcmF3Kys7CgkJCX0KCQkJZWxzZSBpZiAoICFvU2V0dGluZ3MuYkRlc3Ryb3lpbmcgJiYgIV9mbkFqYXhVcGRhdGUoIG9TZXR0aW5ncyApICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoICE9PSAwICkKCQkJewoJCQkJdmFyIGlTdGFydCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydDsKCQkJCXZhciBpRW5kID0gb1NldHRpbmdzLl9pRGlzcGxheUVuZDsKCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJCXsKCQkJCQlpU3RhcnQgPSAwOwoJCQkJCWlFbmQgPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJCX0KCQkJCQoJCQkJZm9yICggdmFyIGo9aVN0YXJ0IDsgajxpRW5kIDsgaisrICkKCQkJCXsKCQkJCQl2YXIgYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVsgb1NldHRpbmdzLmFpRGlzcGxheVtqXSBdOwoJCQkJCWlmICggYW9EYXRhLm5UciA9PT0gbnVsbCApCgkJCQkJewoJCQkJCQlfZm5DcmVhdGVUciggb1NldHRpbmdzLCBvU2V0dGluZ3MuYWlEaXNwbGF5W2pdICk7CgkJCQkJfQoJCQoJCQkJCXZhciBuUm93ID0gYW9EYXRhLm5UcjsKCQkJCQkKCQkJCQkvKiBSZW1vdmUgdGhlIG9sZCBzdHJpcGluZyBjbGFzc2VzIGFuZCB0aGVuIGFkZCB0aGUgbmV3IG9uZSAqLwoJCQkJCWlmICggaVN0cmlwZXMgIT09IDAgKQoJCQkJCXsKCQkJCQkJdmFyIHNTdHJpcGUgPSBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWyBpUm93Q291bnQgJSBpU3RyaXBlcyBdOwoJCQkJCQlpZiAoIGFvRGF0YS5fc1Jvd1N0cmlwZSAhPSBzU3RyaXBlICkKCQkJCQkJewoJCQkJCQkJJChuUm93KS5yZW1vdmVDbGFzcyggYW9EYXRhLl9zUm93U3RyaXBlICkuYWRkQ2xhc3MoIHNTdHJpcGUgKTsKCQkJCQkJCWFvRGF0YS5fc1Jvd1N0cmlwZSA9IHNTdHJpcGU7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJLyogUm93IGNhbGxiYWNrIGZ1bmN0aW9ucyAtIG1pZ2h0IHdhbnQgdG8gbWFuaXB1bGF0ZSB0aGUgcm93ICovCgkJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NhbGxiYWNrJywgbnVsbCwgCgkJCQkJCVtuUm93LCBvU2V0dGluZ3MuYW9EYXRhWyBvU2V0dGluZ3MuYWlEaXNwbGF5W2pdIF0uX2FEYXRhLCBpUm93Q291bnQsIGpdICk7CgkJCQkJCgkJCQkJYW5Sb3dzLnB1c2goIG5Sb3cgKTsKCQkJCQlpUm93Q291bnQrKzsKCQkJCQkKCQkJCQkvKiBJZiB0aGVyZSBpcyBhbiBvcGVuIHJvdyAtIGFuZCBpdCBpcyBhdHRhY2hlZCB0byB0aGlzIHBhcmVudCAtIGF0dGFjaCBpdCBvbiByZWRyYXcgKi8KCQkJCQlpZiAoIGlPcGVuUm93cyAhPT0gMCApCgkJCQkJewoJCQkJCQlmb3IgKCB2YXIgaz0wIDsgazxpT3BlblJvd3MgOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG5Sb3cgPT0gb1NldHRpbmdzLmFvT3BlblJvd3Nba10ublBhcmVudCApCgkJCQkJCQl7CgkJCQkJCQkJYW5Sb3dzLnB1c2goIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2tdLm5UciApOwoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogVGFibGUgaXMgZW1wdHkgLSBjcmVhdGUgYSByb3cgd2l0aCBhbiBlbXB0eSBtZXNzYWdlIGluIGl0ICovCgkJCQlhblJvd3NbIDAgXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0cicgKTsKCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWzBdICkKCQkJCXsKCQkJCQlhblJvd3NbIDAgXS5jbGFzc05hbWUgPSBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWzBdOwoJCQkJfQoJCQoJCQkJdmFyIG9MYW5nID0gb1NldHRpbmdzLm9MYW5ndWFnZTsKCQkJCXZhciBzWmVybyA9IG9MYW5nLnNaZXJvUmVjb3JkczsKCQkJCWlmICggb1NldHRpbmdzLmlEcmF3ID09IDEgJiYgb1NldHRpbmdzLnNBamF4U291cmNlICE9PSBudWxsICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJCXsKCQkJCQlzWmVybyA9IG9MYW5nLnNMb2FkaW5nUmVjb3JkczsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvTGFuZy5zRW1wdHlUYWJsZSAmJiBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSA9PT0gMCApCgkJCQl7CgkJCQkJc1plcm8gPSBvTGFuZy5zRW1wdHlUYWJsZTsKCQkJCX0KCQkKCQkJCXZhciBuVGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGQnICk7CgkJCQluVGQuc2V0QXR0cmlidXRlKCAndmFsaWduJywgInRvcCIgKTsKCQkJCW5UZC5jb2xTcGFuID0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICk7CgkJCQluVGQuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNSb3dFbXB0eTsKCQkJCW5UZC5pbm5lckhUTUwgPSBfZm5JbmZvTWFjcm9zKCBvU2V0dGluZ3MsIHNaZXJvICk7CgkJCQkKCQkJCWFuUm93c1sgaVJvd0NvdW50IF0uYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQl9CgkJCQoJCQkvKiBIZWFkZXIgYW5kIGZvb3RlciBjYWxsYmFja3MgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0hlYWRlckNhbGxiYWNrJywgJ2hlYWRlcicsIFsgJChvU2V0dGluZ3MublRIZWFkKS5jaGlsZHJlbigndHInKVswXSwgCgkJCQlfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKSwgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksIG9TZXR0aW5ncy5haURpc3BsYXkgXSApOwoJCQkKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0Zvb3RlckNhbGxiYWNrJywgJ2Zvb3RlcicsIFsgJChvU2V0dGluZ3MublRGb290KS5jaGlsZHJlbigndHInKVswXSwgCgkJCQlfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKSwgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksIG9TZXR0aW5ncy5haURpc3BsYXkgXSApOwoJCQkKCQkJLyogCgkJCSAqIE5lZWQgdG8gcmVtb3ZlIGFueSBvbGQgcm93IGZyb20gdGhlIGRpc3BsYXkgLSBub3RlIHdlIGNhbid0IGp1c3QgZW1wdHkgdGhlIHRib2R5IHVzaW5nCgkJCSAqICQoKS5odG1sKCcnKSBzaW5jZSB0aGlzIHdpbGwgdW5iaW5kIHRoZSBqUXVlcnkgZXZlbnQgaGFuZGxlcnMgKGV2ZW4gYWx0aG91Z2ggdGhlIG5vZGUgCgkJCSAqIHN0aWxsIGV4aXN0cyEpIC0gZXF1YWxseSB3ZSBjYW4ndCB1c2UgaW5uZXJIVE1MLCBzaW5jZSBJRSB0aHJvd3MgYW4gZXhjZXB0aW9uLgoJCQkgKi8KCQkJdmFyCgkJCQluQWRkRnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKCQkJCW5SZW1vdmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAoJCQkJbkJvZHlQYXIsIG5UcnM7CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5uVEJvZHkgKQoJCQl7CgkJCQluQm9keVBhciA9IG9TZXR0aW5ncy5uVEJvZHkucGFyZW50Tm9kZTsKCQkJCW5SZW1vdmVGcmFnLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRCb2R5ICk7CgkJCQkKCQkJCS8qIFdoZW4gZG9pbmcgaW5maW5pdGUgc2Nyb2xsaW5nLCBvbmx5IHJlbW92ZSBjaGlsZCByb3dzIHdoZW4gc29ydGluZywgZmlsdGVyaW5nIG9yIHN0YXJ0CgkJCQkgKiB1cC4gV2hlbiBub3QgaW5maW5pdGUgc2Nyb2xsLCBhbHdheXMgZG8gaXQuCgkJCQkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSB8fCAhb1NldHRpbmdzLl9iSW5pdENvbXBsZXRlIHx8CgkJCQkgCW9TZXR0aW5ncy5iU29ydGVkIHx8IG9TZXR0aW5ncy5iRmlsdGVyZWQgKQoJCQkJewoJCQkJCXdoaWxlKCAobiA9IG9TZXR0aW5ncy5uVEJvZHkuZmlyc3RDaGlsZCkgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLm5UQm9keS5yZW1vdmVDaGlsZCggbiApOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogUHV0IHRoZSBkcmF3IHRhYmxlIGludG8gdGhlIGRvbSAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuUm93cy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5BZGRGcmFnLmFwcGVuZENoaWxkKCBhblJvd3NbaV0gKTsKCQkJCX0KCQkJCQoJCQkJb1NldHRpbmdzLm5UQm9keS5hcHBlbmRDaGlsZCggbkFkZEZyYWcgKTsKCQkJCWlmICggbkJvZHlQYXIgIT09IG51bGwgKQoJCQkJewoJCQkJCW5Cb2R5UGFyLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRCb2R5ICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIENhbGwgYWxsIHJlcXVpcmVkIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgdGhlIGVuZCBvZiBhIGRyYXcgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICdkcmF3JywgW29TZXR0aW5nc10gKTsKCQkJCgkJCS8qIERyYXcgaXMgY29tcGxldGUsIHNvcnRpbmcgYW5kIGZpbHRlcmluZyBtdXN0IGJlIGFzIHdlbGwgKi8KCQkJb1NldHRpbmdzLmJTb3J0ZWQgPSBmYWxzZTsKCQkJb1NldHRpbmdzLmJGaWx0ZXJlZCA9IGZhbHNlOwoJCQlvU2V0dGluZ3MuYkRyYXdpbmcgPSBmYWxzZTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlpZiAoICFvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgKQoJCQkJewoJCQkJCV9mbkluaXRDb21wbGV0ZSggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogUmVkcmF3IHRoZSB0YWJsZSAtIHRha2luZyBhY2NvdW50IG9mIHRoZSB2YXJpb3VzIGZlYXR1cmVzIHdoaWNoIGFyZSBlbmFibGVkCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJLyogU29ydGluZyB3aWxsIHJlZmlsdGVyIGFuZCBkcmF3IGZvciB1cyAqLwoJCQkJX2ZuU29ydCggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCXsKCQkJCS8qIEZpbHRlcmluZyB3aWxsIHJlZHJhdyBmb3IgdXMgKi8KCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2ggKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGQgdGhlIG9wdGlvbnMgdG8gdGhlIHBhZ2UgSFRNTCBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWRkT3B0aW9uc0h0bWwgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyoKCQkJICogQ3JlYXRlIGEgdGVtcG9yYXJ5LCBlbXB0eSwgZGl2IHdoaWNoIHdlIGNhbiBsYXRlciBvbiByZXBsYWNlIHdpdGggd2hhdCB3ZSBoYXZlIGdlbmVyYXRlZAoJCQkgKiB3ZSBkbyBpdCB0aGlzIHdheSB0byByZW5kZXJpbmcgdGhlICdvcHRpb25zJyBodG1sIG9mZmxpbmUgLSBzcGVlZCA6LSkKCQkJICovCgkJCXZhciBuSG9sZGluZyA9ICQoJzxkaXY+PC9kaXY+JylbMF07CgkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIG5Ib2xkaW5nLCBvU2V0dGluZ3MublRhYmxlICk7CgkJCQoJCQkvKiAKCQkJICogQWxsIERhdGFUYWJsZXMgYXJlIHdyYXBwZWQgaW4gYSBkaXYKCQkJICovCgkJCW9TZXR0aW5ncy5uVGFibGVXcmFwcGVyID0gJCgnPGRpdiBpZD0iJytvU2V0dGluZ3Muc1RhYmxlSWQrJ193cmFwcGVyIiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1dyYXBwZXIrJyIgcm9sZT0iZ3JpZCI+PC9kaXY+JylbMF07CgkJCW9TZXR0aW5ncy5uVGFibGVSZWluc2VydEJlZm9yZSA9IG9TZXR0aW5ncy5uVGFibGUubmV4dFNpYmxpbmc7CgkJCgkJCS8qIFRyYWNrIHdoZXJlIHdlIHdhbnQgdG8gaW5zZXJ0IHRoZSBvcHRpb24gKi8KCQkJdmFyIG5JbnNlcnROb2RlID0gb1NldHRpbmdzLm5UYWJsZVdyYXBwZXI7CgkJCQoJCQkvKiBMb29wIG92ZXIgdGhlIHVzZXIgc2V0IHBvc2l0aW9uaW5nIGFuZCBwbGFjZSB0aGUgZWxlbWVudHMgYXMgbmVlZGVkICovCgkJCXZhciBhRG9tID0gb1NldHRpbmdzLnNEb20uc3BsaXQoJycpOwoJCQl2YXIgblRtcCwgaVB1c2hGZWF0dXJlLCBjT3B0aW9uLCBuTmV3Tm9kZSwgY05leHQsIHNBdHRyLCBqOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxhRG9tLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlQdXNoRmVhdHVyZSA9IDA7CgkJCQljT3B0aW9uID0gYURvbVtpXTsKCQkJCQoJCQkJaWYgKCBjT3B0aW9uID09ICc8JyApCgkJCQl7CgkJCQkJLyogTmV3IGNvbnRhaW5lciBkaXYgKi8KCQkJCQluTmV3Tm9kZSA9ICQoJzxkaXY+PC9kaXY+JylbMF07CgkJCQkJCgkJCQkJLyogQ2hlY2sgdG8gc2VlIGlmIHdlIHNob3VsZCBhcHBlbmQgYW4gaWQgYW5kL29yIGEgY2xhc3MgbmFtZSB0byB0aGUgY29udGFpbmVyICovCgkJCQkJY05leHQgPSBhRG9tW2krMV07CgkJCQkJaWYgKCBjTmV4dCA9PSAiJyIgfHwgY05leHQgPT0gJyInICkKCQkJCQl7CgkJCQkJCXNBdHRyID0gIiI7CgkJCQkJCWogPSAyOwoJCQkJCQl3aGlsZSAoIGFEb21baStqXSAhPSBjTmV4dCApCgkJCQkJCXsKCQkJCQkJCXNBdHRyICs9IGFEb21baStqXTsKCQkJCQkJCWorKzsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogUmVwbGFjZSBqUXVlcnkgVUkgY29uc3RhbnRzICovCgkJCQkJCWlmICggc0F0dHIgPT0gIkgiICkKCQkJCQkJewoJCQkJCQkJc0F0dHIgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0pVSUhlYWRlcjsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggc0F0dHIgPT0gIkYiICkKCQkJCQkJewoJCQkJCQkJc0F0dHIgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0pVSUZvb3RlcjsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogVGhlIGF0dHJpYnV0ZSBjYW4gYmUgaW4gdGhlIGZvcm1hdCBvZiAiI2lkLmNsYXNzIiwgIiNpZCIgb3IgImNsYXNzIiBUaGlzIGxvZ2ljCgkJCQkJCSAqIGJyZWFrcyB0aGUgc3RyaW5nIGludG8gcGFydHMgYW5kIGFwcGxpZXMgdGhlbSBhcyBuZWVkZWQKCQkJCQkJICovCgkJCQkJCWlmICggc0F0dHIuaW5kZXhPZignLicpICE9IC0xICkKCQkJCQkJewoJCQkJCQkJdmFyIGFTcGxpdCA9IHNBdHRyLnNwbGl0KCcuJyk7CgkJCQkJCQluTmV3Tm9kZS5pZCA9IGFTcGxpdFswXS5zdWJzdHIoMSwgYVNwbGl0WzBdLmxlbmd0aC0xKTsKCQkJCQkJCW5OZXdOb2RlLmNsYXNzTmFtZSA9IGFTcGxpdFsxXTsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggc0F0dHIuY2hhckF0KDApID09ICIjIiApCgkJCQkJCXsKCQkJCQkJCW5OZXdOb2RlLmlkID0gc0F0dHIuc3Vic3RyKDEsIHNBdHRyLmxlbmd0aC0xKTsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCW5OZXdOb2RlLmNsYXNzTmFtZSA9IHNBdHRyOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQlpICs9IGo7IC8qIE1vdmUgYWxvbmcgdGhlIHBvc2l0aW9uIGFycmF5ICovCgkJCQkJfQoJCQkJCQoJCQkJCW5JbnNlcnROb2RlLmFwcGVuZENoaWxkKCBuTmV3Tm9kZSApOwoJCQkJCW5JbnNlcnROb2RlID0gbk5ld05vZGU7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAnPicgKQoJCQkJewoJCQkJCS8qIEVuZCBjb250YWluZXIgZGl2ICovCgkJCQkJbkluc2VydE5vZGUgPSBuSW5zZXJ0Tm9kZS5wYXJlbnROb2RlOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ2wnICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlBhZ2luYXRlICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkxlbmd0aENoYW5nZSApCgkJCQl7CgkJCQkJLyogTGVuZ3RoICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sTGVuZ3RoKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ2YnICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCQl7CgkJCQkJLyogRmlsdGVyICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sRmlsdGVyKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ3InICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlByb2Nlc3NpbmcgKQoJCQkJewoJCQkJCS8qIHBSb2Nlc3NpbmcgKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ3QnICkKCQkJCXsKCQkJCQkvKiBUYWJsZSAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbFRhYmxlKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gICdpJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJJbmZvICkKCQkJCXsKCQkJCQkvKiBJbmZvICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sSW5mbyggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdwJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSApCgkJCQl7CgkJCQkJLyogUGFnaW5hdGlvbiAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbFBhZ2luYXRlKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIERhdGFUYWJsZS5leHQuYW9GZWF0dXJlcy5sZW5ndGggIT09IDAgKQoJCQkJewoJCQkJCS8qIFBsdWctaW4gZmVhdHVyZXMgKi8KCQkJCQl2YXIgYW9GZWF0dXJlcyA9IERhdGFUYWJsZS5leHQuYW9GZWF0dXJlczsKCQkJCQlmb3IgKCB2YXIgaz0wLCBrTGVuPWFvRmVhdHVyZXMubGVuZ3RoIDsgazxrTGVuIDsgaysrICkKCQkJCQl7CgkJCQkJCWlmICggY09wdGlvbiA9PSBhb0ZlYXR1cmVzW2tdLmNGZWF0dXJlICkKCQkJCQkJewoJCQkJCQkJblRtcCA9IGFvRmVhdHVyZXNba10uZm5Jbml0KCBvU2V0dGluZ3MgKTsKCQkJCQkJCWlmICggblRtcCApCgkJCQkJCQl7CgkJCQkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBBZGQgdG8gdGhlIDJEIGZlYXR1cmVzIGFycmF5ICovCgkJCQlpZiAoIGlQdXNoRmVhdHVyZSA9PSAxICYmIG5UbXAgIT09IG51bGwgKQoJCQkJewoJCQkJCWlmICggdHlwZW9mIG9TZXR0aW5ncy5hYW5GZWF0dXJlc1tjT3B0aW9uXSAhPT0gJ29iamVjdCcgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFhbkZlYXR1cmVzW2NPcHRpb25dID0gW107CgkJCQkJfQoJCQkJCW9TZXR0aW5ncy5hYW5GZWF0dXJlc1tjT3B0aW9uXS5wdXNoKCBuVG1wICk7CgkJCQkJbkluc2VydE5vZGUuYXBwZW5kQ2hpbGQoIG5UbXAgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogQnVpbHQgb3VyIERPTSBzdHJ1Y3R1cmUgLSByZXBsYWNlIHRoZSBob2xkaW5nIGRpdiB3aXRoIHdoYXQgd2Ugd2FudCAqLwoJCQluSG9sZGluZy5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCggb1NldHRpbmdzLm5UYWJsZVdyYXBwZXIsIG5Ib2xkaW5nICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFVzZSB0aGUgRE9NIHNvdXJjZSB0byBjcmVhdGUgdXAgYW4gYXJyYXkgb2YgaGVhZGVyIGNlbGxzLiBUaGUgaWRlYSBoZXJlIGlzIHRvCgkJICogY3JlYXRlIGEgbGF5b3V0IGdyaWQgKGFycmF5KSBvZiByb3dzIHggY29sdW1ucywgd2hpY2ggY29udGFpbnMgYSByZWZlcmVuY2UKCQkgKiB0byB0aGUgY2VsbCB0aGF0IHRoYXQgcG9pbnQgaW4gdGhlIGdyaWQgKHJlZ2FyZGxlc3Mgb2YgY29sL3Jvd3NwYW4pLCBzdWNoIHRoYXQKCQkgKiBhbnkgY29sdW1uIC8gcm93IGNvdWxkIGJlIHJlbW92ZWQgYW5kIHRoZSBuZXcgZ3JpZCBjb25zdHJ1Y3RlZAoJCSAqICBAcGFyYW0gYXJyYXkge29iamVjdH0gYUxheW91dCBBcnJheSB0byBzdG9yZSB0aGUgY2FsY3VsYXRlZCBsYXlvdXQgaW4KCQkgKiAgQHBhcmFtIHtub2RlfSBuVGhlYWQgVGhlIGhlYWRlci9mb290ZXIgZWxlbWVudCBmb3IgdGhlIHRhYmxlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRldGVjdEhlYWRlciAoIGFMYXlvdXQsIG5UaGVhZCApCgkJewoJCQl2YXIgblRycyA9ICQoblRoZWFkKS5jaGlsZHJlbigndHInKTsKCQkJdmFyIG5DZWxsOwoJCQl2YXIgaSwgaiwgaywgbCwgaUxlbiwgakxlbiwgaUNvbFNoaWZ0ZWQ7CgkJCXZhciBmblNoaWZ0Q29sID0gZnVuY3Rpb24gKCBhLCBpLCBqICkgewoJCQkJd2hpbGUgKCBhW2ldW2pdICkgewoJCQkJCWorKzsKCQkJCX0KCQkJCXJldHVybiBqOwoJCQl9OwoJCQoJCQlhTGF5b3V0LnNwbGljZSggMCwgYUxheW91dC5sZW5ndGggKTsKCQkJCgkJCS8qIFdlIGtub3cgaG93IG1hbnkgcm93cyB0aGVyZSBhcmUgaW4gdGhlIGxheW91dCAtIHNvIHByZXAgaXQgKi8KCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYUxheW91dC5wdXNoKCBbXSApOwoJCQl9CgkJCQoJCQkvKiBDYWxjdWxhdGUgYSBsYXlvdXQgYXJyYXkgKi8KCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJdmFyIGlDb2x1bW4gPSAwOwoJCQkJCgkJCQkvKiBGb3IgZXZlcnkgY2VsbCBpbiB0aGUgcm93Li4uICovCgkJCQlmb3IgKCBqPTAsIGpMZW49blRyc1tpXS5jaGlsZE5vZGVzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJbkNlbGwgPSBuVHJzW2ldLmNoaWxkTm9kZXNbal07CgkJCgkJCQkJaWYgKCBuQ2VsbC5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09ICJURCIgfHwKCQkJCQkgICAgIG5DZWxsLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT0gIlRIIiApCgkJCQkJewoJCQkJCQkvKiBHZXQgdGhlIGNvbCBhbmQgcm93c3BhbiBhdHRyaWJ1dGVzIGZyb20gdGhlIERPTSBhbmQgc2FuaXRpc2UgdGhlbSAqLwoJCQkJCQl2YXIgaUNvbHNwYW4gPSBuQ2VsbC5nZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nKSAqIDE7CgkJCQkJCXZhciBpUm93c3BhbiA9IG5DZWxsLmdldEF0dHJpYnV0ZSgncm93c3BhbicpICogMTsKCQkJCQkJaUNvbHNwYW4gPSAoIWlDb2xzcGFuIHx8IGlDb2xzcGFuPT09MCB8fCBpQ29sc3Bhbj09PTEpID8gMSA6IGlDb2xzcGFuOwoJCQkJCQlpUm93c3BhbiA9ICghaVJvd3NwYW4gfHwgaVJvd3NwYW49PT0wIHx8IGlSb3dzcGFuPT09MSkgPyAxIDogaVJvd3NwYW47CgkJCgkJCQkJCS8qIFRoZXJlIG1pZ2h0IGJlIGNvbHNwYW4gY2VsbHMgYWxyZWFkeSBpbiB0aGlzIHJvdywgc28gc2hpZnQgb3VyIHRhcmdldCAKCQkJCQkJICogYWNjb3JkaW5nbHkKCQkJCQkJICovCgkJCQkJCWlDb2xTaGlmdGVkID0gZm5TaGlmdENvbCggYUxheW91dCwgaSwgaUNvbHVtbiApOwoJCQkJCQkKCQkJCQkJLyogSWYgdGhlcmUgaXMgY29sIC8gcm93c3BhbiwgY29weSB0aGUgaW5mb3JtYXRpb24gaW50byB0aGUgbGF5b3V0IGdyaWQgKi8KCQkJCQkJZm9yICggbD0wIDsgbDxpQ29sc3BhbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGs9MCA7IGs8aVJvd3NwYW4gOyBrKysgKQoJCQkJCQkJewoJCQkJCQkJCWFMYXlvdXRbaStrXVtpQ29sU2hpZnRlZCtsXSA9IHsKCQkJCQkJCQkJImNlbGwiOiBuQ2VsbCwKCQkJCQkJCQkJInVuaXF1ZSI6IGlDb2xzcGFuID09IDEgPyB0cnVlIDogZmFsc2UKCQkJCQkJCQl9OwoJCQkJCQkJCWFMYXlvdXRbaStrXS5uVHIgPSBuVHJzW2ldOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiB1bmlxdWUgdGggZWxlbWVudHMsIG9uZSBmb3IgZWFjaCBjb2x1bW4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge25vZGV9IG5IZWFkZXIgYXV0b21hdGljYWxseSBkZXRlY3QgdGhlIGxheW91dCBmcm9tIHRoaXMgbm9kZSAtIG9wdGlvbmFsCgkJICogIEBwYXJhbSB7YXJyYXl9IGFMYXlvdXQgdGhlYWQvdGZvb3QgbGF5b3V0IGZyb20gX2ZuRGV0ZWN0SGVhZGVyIC0gb3B0aW9uYWwKCQkgKiAgQHJldHVybnMgYXJyYXkge25vZGV9IGFSZXR1cm4gbGlzdCBvZiB1bmlxdWUgdGgncwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRVbmlxdWVUaHMgKCBvU2V0dGluZ3MsIG5IZWFkZXIsIGFMYXlvdXQgKQoJCXsKCQkJdmFyIGFSZXR1cm4gPSBbXTsKCQkJaWYgKCAhYUxheW91dCApCgkJCXsKCQkJCWFMYXlvdXQgPSBvU2V0dGluZ3MuYW9IZWFkZXI7CgkJCQlpZiAoIG5IZWFkZXIgKQoJCQkJewoJCQkJCWFMYXlvdXQgPSBbXTsKCQkJCQlfZm5EZXRlY3RIZWFkZXIoIGFMYXlvdXQsIG5IZWFkZXIgKTsKCQkJCX0KCQkJfQoJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFMYXlvdXQubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1hTGF5b3V0W2ldLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBhTGF5b3V0W2ldW2pdLnVuaXF1ZSAmJiAKCQkJCQkJICghYVJldHVybltqXSB8fCAhb1NldHRpbmdzLmJTb3J0Q2VsbHNUb3ApICkKCQkJCQl7CgkJCQkJCWFSZXR1cm5bal0gPSBhTGF5b3V0W2ldW2pdLmNlbGw7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gYVJldHVybjsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIHRoZSB0YWJsZSB1c2luZyBhbiBBamF4IGNhbGwKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gQmxvY2sgdGhlIHRhYmxlIGRyYXdpbmcgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFqYXhVcGRhdGUoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5iQWpheERhdGFHZXQgKQoJCQl7CgkJCQlvU2V0dGluZ3MuaURyYXcrKzsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQkJdmFyIGFvRGF0YSA9IF9mbkFqYXhQYXJhbWV0ZXJzKCBvU2V0dGluZ3MgKTsKCQkJCV9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKTsKCQkJCQoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwKCQkJCQlmdW5jdGlvbihqc29uKSB7CgkJCQkJCV9mbkFqYXhVcGRhdGVEcmF3KCBvU2V0dGluZ3MsIGpzb24gKTsKCQkJCQl9LCBvU2V0dGluZ3MgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEJ1aWxkIHVwIHRoZSBwYXJhbWV0ZXJzIGluIGFuIG9iamVjdCBuZWVkZWQgZm9yIGEgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyByZXF1ZXN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2Jvb2x9IGJsb2NrIHRoZSB0YWJsZSBkcmF3aW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BamF4UGFyYW1ldGVycyggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgYW9EYXRhID0gW10sIG1EYXRhUHJvcCwgYWFTb3J0LCBhRGF0YVNvcnQ7CgkJCXZhciBpLCBqOwoJCQkKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic0VjaG8iLCAgICAgICAgICAidmFsdWUiOiBvU2V0dGluZ3MuaURyYXcgfSApOwoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpQ29sdW1ucyIsICAgICAgICJ2YWx1ZSI6IGlDb2x1bW5zIH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic0NvbHVtbnMiLCAgICAgICAidmFsdWUiOiBfZm5Db2x1bW5PcmRlcmluZyhvU2V0dGluZ3MpIH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaURpc3BsYXlTdGFydCIsICAidmFsdWUiOiBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgfSApOwoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpRGlzcGxheUxlbmd0aCIsICJ2YWx1ZSI6IG9TZXR0aW5ncy5vRmVhdHVyZXMuYlBhZ2luYXRlICE9PSBmYWxzZSA/CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDogLTEgfSApOwoJCQkJCgkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQl7CgkJCSAgbURhdGFQcm9wID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5tRGF0YTsKCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogIm1EYXRhUHJvcF8iK2ksICJ2YWx1ZSI6IHR5cGVvZihtRGF0YVByb3ApPT09ImZ1bmN0aW9uIiA/ICdmdW5jdGlvbicgOiBtRGF0YVByb3AgfSApOwoJCQl9CgkJCQoJCQkvKiBGaWx0ZXJpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgIT09IGZhbHNlICkKCQkJewoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NlYXJjaCIsICJ2YWx1ZSI6IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2guc1NlYXJjaCB9ICk7CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiUmVnZXgiLCAgInZhbHVlIjogb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaC5iUmVnZXggfSApOwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCQl7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NlYXJjaF8iK2ksICAgICAidmFsdWUiOiBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzW2ldLnNTZWFyY2ggfSApOwoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJSZWdleF8iK2ksICAgICAgInZhbHVlIjogb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1tpXS5iUmVnZXggfSApOwoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJTZWFyY2hhYmxlXyIraSwgInZhbHVlIjogb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU2VhcmNoYWJsZSB9ICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFNvcnRpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICE9PSBmYWxzZSApCgkJCXsKCQkJCXZhciBpQ291bnRlciA9IDA7CgkJCgkJCQlhYVNvcnQgPSAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApID8KCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICkgOgoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJCQoJCQkJZm9yICggaT0wIDsgaTxhYVNvcnQubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlhRGF0YVNvcnQgPSBvU2V0dGluZ3MuYW9Db2x1bW5zWyBhYVNvcnRbaV1bMF0gXS5hRGF0YVNvcnQ7CgkJCQkJCgkJCQkJZm9yICggaj0wIDsgajxhRGF0YVNvcnQubGVuZ3RoIDsgaisrICkKCQkJCQl7CgkJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlTb3J0Q29sXyIraUNvdW50ZXIsICAidmFsdWUiOiBhRGF0YVNvcnRbal0gfSApOwoJCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzU29ydERpcl8iK2lDb3VudGVyLCAgInZhbHVlIjogYWFTb3J0W2ldWzFdIH0gKTsKCQkJCQkJaUNvdW50ZXIrKzsKCQkJCQl9CgkJCQl9CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpU29ydGluZ0NvbHMiLCAgICJ2YWx1ZSI6IGlDb3VudGVyIH0gKTsKCQkJCQoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCQl7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiYlNvcnRhYmxlXyIraSwgICJ2YWx1ZSI6IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlIH0gKTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFvRGF0YTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQWRkIEFqYXggcGFyYW1ldGVycyBmcm9tIHBsdWctaW5zCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3RzfSBhb0RhdGEgbmFtZS92YWx1ZSBwYWlycyB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApCgkJewoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU2VydmVyUGFyYW1zJywgJ3NlcnZlclBhcmFtcycsIFthb0RhdGFdICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERhdGEgdGhlIGRhdGEgZnJvbSB0aGUgc2VydmVyIChudWtpbmcgdGhlIG9sZCkgYW5kIHJlZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBqc29uIGRhdGEgcmV0dXJuIGZyb20gdGhlIHNlcnZlci4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IGpzb24uc0VjaG8gVHJhY2tpbmcgZmxhZyBmb3IgRGF0YVRhYmxlcyB0byBtYXRjaCByZXF1ZXN0cwoJCSAqICBAcGFyYW0ge2ludH0ganNvbi5pVG90YWxSZWNvcmRzIE51bWJlciBvZiByZWNvcmRzIGluIHRoZSBkYXRhIHNldCwgbm90IGFjY291bnRpbmcgZm9yIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge2ludH0ganNvbi5pVG90YWxEaXNwbGF5UmVjb3JkcyBOdW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgZGF0YSBzZXQsIGFjY291bnRpbmcgZm9yIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge2FycmF5fSBqc29uLmFhRGF0YSBUaGUgZGF0YSB0byBkaXNwbGF5IG9uIHRoaXMgcGFnZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gW2pzb24uc0NvbHVtbnNdIENvbHVtbiBvcmRlcmluZyAoc05hbWUsIGNvbW1hIHNlcGFyYXRlZCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWpheFVwZGF0ZURyYXcgKCBvU2V0dGluZ3MsIGpzb24gKQoJCXsKCQkJaWYgKCBqc29uLnNFY2hvICE9PSB1bmRlZmluZWQgKQoJCQl7CgkJCQkvKiBQcm90ZWN0IGFnYWluc3Qgb2xkIHJldHVybnMgb3Zlci13cml0aW5nIGEgbmV3IG9uZS4gUG9zc2libGUgd2hlbiB5b3UgZ2V0CgkJCQkgKiB2ZXJ5IGZhc3QgaW50ZXJhY3Rpb24sIGFuZCBsYXRlciBxdWVyaWVzIGFyZSBjb21wbGV0ZWQgbXVjaCBmYXN0ZXIKCQkJCSAqLwoJCQkJaWYgKCBqc29uLnNFY2hvKjEgPCBvU2V0dGluZ3MuaURyYXcgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuaURyYXcgPSBqc29uLnNFY2hvICogMTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlIHx8CgkJCQkgICAob1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlICYmIChvU2V0dGluZ3MuYlNvcnRlZCB8fCBvU2V0dGluZ3MuYkZpbHRlcmVkKSkgKQoJCQl7CgkJCQlfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlvU2V0dGluZ3MuX2lSZWNvcmRzVG90YWwgPSBwYXJzZUludChqc29uLmlUb3RhbFJlY29yZHMsIDEwKTsKCQkJb1NldHRpbmdzLl9pUmVjb3Jkc0Rpc3BsYXkgPSBwYXJzZUludChqc29uLmlUb3RhbERpc3BsYXlSZWNvcmRzLCAxMCk7CgkJCQoJCQkvKiBEZXRlcm1pbmUgaWYgcmVvcmRlcmluZyBpcyByZXF1aXJlZCAqLwoJCQl2YXIgc09yZGVyaW5nID0gX2ZuQ29sdW1uT3JkZXJpbmcob1NldHRpbmdzKTsKCQkJdmFyIGJSZU9yZGVyID0gKGpzb24uc0NvbHVtbnMgIT09IHVuZGVmaW5lZCAmJiBzT3JkZXJpbmcgIT09ICIiICYmIGpzb24uc0NvbHVtbnMgIT0gc09yZGVyaW5nICk7CgkJCXZhciBhaUluZGV4OwoJCQlpZiAoIGJSZU9yZGVyICkKCQkJewoJCQkJYWlJbmRleCA9IF9mblJlT3JkZXJJbmRleCggb1NldHRpbmdzLCBqc29uLnNDb2x1bW5zICk7CgkJCX0KCQkJCgkJCXZhciBhRGF0YSA9IF9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKSgganNvbiApOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFEYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYlJlT3JkZXIgKQoJCQkJewoJCQkJCS8qIElmIHdlIG5lZWQgdG8gcmUtb3JkZXIsIHRoZW4gY3JlYXRlIGEgbmV3IGFycmF5IHdpdGggdGhlIGNvcnJlY3Qgb3JkZXIgYW5kIGFkZCBpdCAqLwoJCQkJCXZhciBhRGF0YVNvcnRlZCA9IFtdOwoJCQkJCWZvciAoIHZhciBqPTAsIGpMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCXsKCQkJCQkJYURhdGFTb3J0ZWQucHVzaCggYURhdGFbaV1bIGFpSW5kZXhbal0gXSApOwoJCQkJCX0KCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhU29ydGVkICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJLyogTm8gcmUtb3JkZXIgcmVxdWlyZWQsIHNldmVyIGdvdCBpdCAicmlnaHQiIC0ganVzdCBzdHJhaWdodCBhZGQgKi8KCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhW2ldICk7CgkJCQl9CgkJCX0KCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCgkJCW9TZXR0aW5ncy5iQWpheERhdGFHZXQgPSBmYWxzZTsKCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCW9TZXR0aW5ncy5iQWpheERhdGFHZXQgPSB0cnVlOwoJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgZmlsdGVyaW5nIHRleHQKCQkgKiAgQHJldHVybnMge25vZGV9IEZpbHRlciBjb250cm9sIGVsZW1lbnQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbEZpbHRlciAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgb1ByZXZpb3VzU2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCXZhciBzU2VhcmNoU3RyID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zU2VhcmNoOwoJCQlzU2VhcmNoU3RyID0gKHNTZWFyY2hTdHIuaW5kZXhPZignX0lOUFVUXycpICE9PSAtMSkgPwoJCQkgIHNTZWFyY2hTdHIucmVwbGFjZSgnX0lOUFVUXycsICc8aW5wdXQgdHlwZT0idGV4dCIgLz4nKSA6CgkJCSAgc1NlYXJjaFN0cj09PSIiID8gJzxpbnB1dCB0eXBlPSJ0ZXh0IiAvPicgOiBzU2VhcmNoU3RyKycgPGlucHV0IHR5cGU9InRleHQiIC8+JzsKCQkJCgkJCXZhciBuRmlsdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJbkZpbHRlci5jbGFzc05hbWUgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0ZpbHRlcjsKCQkJbkZpbHRlci5pbm5lckhUTUwgPSAnPGxhYmVsPicrc1NlYXJjaFN0cisnPC9sYWJlbD4nOwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuZiApCgkJCXsKCQkJCW5GaWx0ZXIuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19maWx0ZXInOwoJCQl9CgkJCQoJCQl2YXIganFGaWx0ZXIgPSAkKCdpbnB1dFt0eXBlPSJ0ZXh0Il0nLCBuRmlsdGVyKTsKCQkKCQkJLy8gU3RvcmUgYSByZWZlcmVuY2UgdG8gdGhlIGlucHV0IGVsZW1lbnQsIHNvIG90aGVyIGlucHV0IGVsZW1lbnRzIGNvdWxkIGJlCgkJCS8vIGFkZGVkIHRvIHRoZSBmaWx0ZXIgd3JhcHBlciBpZiBuZWVkZWQgKHN1Ym1pdCBidXR0b24gZm9yIGV4YW1wbGUpCgkJCW5GaWx0ZXIuX0RUX0lucHV0ID0ganFGaWx0ZXJbMF07CgkJCgkJCWpxRmlsdGVyLnZhbCggb1ByZXZpb3VzU2VhcmNoLnNTZWFyY2gucmVwbGFjZSgnIicsJyZxdW90OycpICk7CgkJCWpxRmlsdGVyLmJpbmQoICdrZXl1cC5EVCcsIGZ1bmN0aW9uKGUpIHsKCQkJCS8qIFVwZGF0ZSBhbGwgb3RoZXIgZmlsdGVyIGlucHV0IGVsZW1lbnRzIGZvciB0aGUgbmV3IGRpc3BsYXkgKi8KCQkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmY7CgkJCQl2YXIgdmFsID0gdGhpcy52YWx1ZT09PSIiID8gIiIgOiB0aGlzLnZhbHVlOyAvLyBtZW50YWwgSUU4IGZpeCA6LSgKCQkKCQkJCWZvciAoIHZhciBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggbltpXSAhPSAkKHRoaXMpLnBhcmVudHMoJ2Rpdi5kYXRhVGFibGVzX2ZpbHRlcicpWzBdICkKCQkJCQl7CgkJCQkJCSQobltpXS5fRFRfSW5wdXQpLnZhbCggdmFsICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBOb3cgZG8gdGhlIGZpbHRlciAqLwoJCQkJaWYgKCB2YWwgIT0gb1ByZXZpb3VzU2VhcmNoLnNTZWFyY2ggKQoJCQkJewoJCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIHsgCgkJCQkJCSJzU2VhcmNoIjogdmFsLCAKCQkJCQkJImJSZWdleCI6IG9QcmV2aW91c1NlYXJjaC5iUmVnZXgsCgkJCQkJCSJiU21hcnQiOiBvUHJldmlvdXNTZWFyY2guYlNtYXJ0ICwKCQkJCQkJImJDYXNlSW5zZW5zaXRpdmUiOiBvUHJldmlvdXNTZWFyY2guYkNhc2VJbnNlbnNpdGl2ZSAKCQkJCQl9ICk7CgkJCQl9CgkJCX0gKTsKCQkKCQkJanFGaWx0ZXIKCQkJCS5hdHRyKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKQoJCQkJLmJpbmQoICdrZXlwcmVzcy5EVCcsIGZ1bmN0aW9uKGUpIHsKCQkJCQkvKiBQcmV2ZW50IGZvcm0gc3VibWlzc2lvbiAqLwoJCQkJCWlmICggZS5rZXlDb2RlID09IDEzICkKCQkJCQl7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQl9CgkJCSk7CgkJCQoJCQlyZXR1cm4gbkZpbHRlcjsKCQl9CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSB0YWJsZSB1c2luZyBib3RoIHRoZSBnbG9iYWwgZmlsdGVyIGFuZCBjb2x1bW4gYmFzZWQgZmlsdGVyaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZWFyY2ggc2VhcmNoIGluZm9ybWF0aW9uCgkJICogIEBwYXJhbSB7aW50fSBbaUZvcmNlXSBmb3JjZSBhIHJlc2VhcmNoIG9mIHRoZSBtYXN0ZXIgYXJyYXkgKDEpIG9yIG5vdCAodW5kZWZpbmVkIG9yIDApCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZpbHRlckNvbXBsZXRlICggb1NldHRpbmdzLCBvSW5wdXQsIGlGb3JjZSApCgkJewoJCQl2YXIgb1ByZXZTZWFyY2ggPSBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoOwoJCQl2YXIgYW9QcmV2U2VhcmNoID0gb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sczsKCQkJdmFyIGZuU2F2ZUZpbHRlciA9IGZ1bmN0aW9uICggb0ZpbHRlciApIHsKCQkJCS8qIFNhdmUgdGhlIGZpbHRlcmluZyB2YWx1ZXMgKi8KCQkJCW9QcmV2U2VhcmNoLnNTZWFyY2ggPSBvRmlsdGVyLnNTZWFyY2g7CgkJCQlvUHJldlNlYXJjaC5iUmVnZXggPSBvRmlsdGVyLmJSZWdleDsKCQkJCW9QcmV2U2VhcmNoLmJTbWFydCA9IG9GaWx0ZXIuYlNtYXJ0OwoJCQkJb1ByZXZTZWFyY2guYkNhc2VJbnNlbnNpdGl2ZSA9IG9GaWx0ZXIuYkNhc2VJbnNlbnNpdGl2ZTsKCQkJfTsKCQkKCQkJLyogSW4gc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBhbGwgZmlsdGVyaW5nIGlzIGRvbmUgYnkgdGhlIHNlcnZlciwgc28gbm8gcG9pbnQgaGFuZ2luZyBhcm91bmQgaGVyZSAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJLyogR2xvYmFsIGZpbHRlciAqLwoJCQkJX2ZuRmlsdGVyKCBvU2V0dGluZ3MsIG9JbnB1dC5zU2VhcmNoLCBpRm9yY2UsIG9JbnB1dC5iUmVnZXgsIG9JbnB1dC5iU21hcnQsIG9JbnB1dC5iQ2FzZUluc2Vuc2l0aXZlICk7CgkJCQlmblNhdmVGaWx0ZXIoIG9JbnB1dCApOwoJCQoJCQkJLyogTm93IGRvIHRoZSBpbmRpdmlkdWFsIGNvbHVtbiBmaWx0ZXIgKi8KCQkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlfZm5GaWx0ZXJDb2x1bW4oIG9TZXR0aW5ncywgYW9QcmV2U2VhcmNoW2ldLnNTZWFyY2gsIGksIGFvUHJldlNlYXJjaFtpXS5iUmVnZXgsIAoJCQkJCQlhb1ByZXZTZWFyY2hbaV0uYlNtYXJ0LCBhb1ByZXZTZWFyY2hbaV0uYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQkJfQoJCQkJCgkJCQkvKiBDdXN0b20gZmlsdGVyaW5nICovCgkJCQlfZm5GaWx0ZXJDdXN0b20oIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJZm5TYXZlRmlsdGVyKCBvSW5wdXQgKTsKCQkJfQoJCQkKCQkJLyogVGVsbCB0aGUgZHJhdyBmdW5jdGlvbiB3ZSBoYXZlIGJlZW4gZmlsdGVyaW5nICovCgkJCW9TZXR0aW5ncy5iRmlsdGVyZWQgPSB0cnVlOwoJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoJ2ZpbHRlcicsIG9TZXR0aW5ncyk7CgkJCQoJCQkvKiBSZWRyYXcgdGhlIHRhYmxlICovCgkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQkKCQkJLyogUmVidWlsZCBzZWFyY2ggYXJyYXkgJ29mZmxpbmUnICovCgkJCV9mbkJ1aWxkU2VhcmNoQXJyYXkoIG9TZXR0aW5ncywgMCApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBseSBjdXN0b20gZmlsdGVyaW5nIGZ1bmN0aW9ucwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZpbHRlckN1c3RvbSggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhZm5GaWx0ZXJzID0gRGF0YVRhYmxlLmV4dC5hZm5GaWx0ZXJpbmc7CgkJCXZhciBhaUZpbHRlckNvbHVtbnMgPSBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiU2VhcmNoYWJsZScgKTsKCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hZm5GaWx0ZXJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXZhciBpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIHZhciBqPTAsIGpMZW49b1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCXZhciBpRGlzSW5kZXggPSBvU2V0dGluZ3MuYWlEaXNwbGF5W2otaUNvcnJlY3Rvcl07CgkJCQkJdmFyIGJUZXN0ID0gYWZuRmlsdGVyc1tpXSgKCQkJCQkJb1NldHRpbmdzLAoJCQkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGlEaXNJbmRleCwgJ2ZpbHRlcicsIGFpRmlsdGVyQ29sdW1ucyApLAoJCQkJCQlpRGlzSW5kZXgKCQkJCQkpOwoJCQkJCQoJCQkJCS8qIENoZWNrIGlmIHdlIHNob3VsZCB1c2UgdGhpcyByb3cgYmFzZWQgb24gdGhlIGZpbHRlcmluZyBmdW5jdGlvbiAqLwoJCQkJCWlmICggIWJUZXN0ICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCBqLWlDb3JyZWN0b3IsIDEgKTsKCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIHRhYmxlIG9uIGEgcGVyLWNvbHVtbiBiYXNpcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzSW5wdXQgc3RyaW5nIHRvIGZpbHRlciBvbgoJCSAqICBAcGFyYW0ge2ludH0gaUNvbHVtbiBjb2x1bW4gdG8gZmlsdGVyCgkJICogIEBwYXJhbSB7Ym9vbH0gYlJlZ2V4IHRyZWF0IHNlYXJjaCBzdHJpbmcgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNtYXJ0IHVzZSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc3RpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZpbHRlckNvbHVtbiAoIG9TZXR0aW5ncywgc0lucHV0LCBpQ29sdW1uLCBiUmVnZXgsIGJTbWFydCwgYkNhc2VJbnNlbnNpdGl2ZSApCgkJewoJCQlpZiAoIHNJbnB1dCA9PT0gIiIgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCXZhciBpSW5kZXhDb3JyZWN0b3IgPSAwOwoJCQl2YXIgcnBTZWFyY2ggPSBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNJbnB1dCwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJCgkJCWZvciAoIHZhciBpPW9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJewoJCQkJdmFyIHNEYXRhID0gX2ZuRGF0YVRvU2VhcmNoKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBvU2V0dGluZ3MuYWlEaXNwbGF5W2ldLCBpQ29sdW1uLCAnZmlsdGVyJyApLAoJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uc1R5cGUgKTsKCQkJCWlmICggISBycFNlYXJjaC50ZXN0KCBzRGF0YSApICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggaSwgMSApOwoJCQkJCWlJbmRleENvcnJlY3RvcisrOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgZGF0YSB0YWJsZSBiYXNlZCBvbiB1c2VyIGlucHV0IGFuZCBkcmF3IHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzSW5wdXQgc3RyaW5nIHRvIGZpbHRlciBvbgoJCSAqICBAcGFyYW0ge2ludH0gaUZvcmNlIG9wdGlvbmFsIC0gZm9yY2UgYSByZXNlYXJjaCBvZiB0aGUgbWFzdGVyIGFycmF5ICgxKSBvciBub3QgKHVuZGVmaW5lZCBvciAwKQoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU21hcnQgcGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc3RpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZpbHRlciggb1NldHRpbmdzLCBzSW5wdXQsIGlGb3JjZSwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJdmFyIGk7CgkJCXZhciBycFNlYXJjaCA9IF9mbkZpbHRlckNyZWF0ZVNlYXJjaCggc0lucHV0LCBiUmVnZXgsIGJTbWFydCwgYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQl2YXIgb1ByZXZTZWFyY2ggPSBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoOwoJCQkKCQkJLyogQ2hlY2sgaWYgd2UgYXJlIGZvcmNpbmcgb3Igbm90IC0gb3B0aW9uYWwgcGFyYW1ldGVyICovCgkJCWlmICggIWlGb3JjZSApCgkJCXsKCQkJCWlGb3JjZSA9IDA7CgkJCX0KCQkJCgkJCS8qIE5lZWQgdG8gdGFrZSBhY2NvdW50IG9mIGN1c3RvbSBmaWx0ZXJpbmcgZnVuY3Rpb25zIC0gYWx3YXlzIGZpbHRlciAqLwoJCQlpZiAoIERhdGFUYWJsZS5leHQuYWZuRmlsdGVyaW5nLmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCWlGb3JjZSA9IDE7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIElmIHRoZSBpbnB1dCBpcyBibGFuayAtIHdlIHdhbnQgdGhlIGZ1bGwgZGF0YSBzZXQKCQkJICovCgkJCWlmICggc0lucHV0Lmxlbmd0aCA8PSAwICkKCQkJewoJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoKTsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKgoJCQkJICogV2UgYXJlIHN0YXJ0aW5nIGEgbmV3IHNlYXJjaCBvciB0aGUgbmV3IHNlYXJjaCBzdHJpbmcgaXMgc21hbGxlciAKCQkJCSAqIHRoZW4gdGhlIG9sZCBvbmUgKGkuZS4gZGVsZXRlKS4gU2VhcmNoIGZyb20gdGhlIG1hc3RlciBhcnJheQoJCQkgCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCA9PSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCB8fAoJCQkJCSAgIG9QcmV2U2VhcmNoLnNTZWFyY2gubGVuZ3RoID4gc0lucHV0Lmxlbmd0aCB8fCBpRm9yY2UgPT0gMSB8fAoJCQkJCSAgIHNJbnB1dC5pbmRleE9mKG9QcmV2U2VhcmNoLnNTZWFyY2gpICE9PSAwICkKCQkJCXsKCQkJCQkvKiBOdWtlIHRoZSBvbGQgZGlzcGxheSBhcnJheSAtIHdlIGFyZSBnb2luZyB0byByZWJ1aWxkIGl0ICovCgkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoKTsKCQkJCQkKCQkJCQkvKiBGb3JjZSBhIHJlYnVpbGQgb2YgdGhlIHNlYXJjaCBhcnJheSAqLwoJCQkJCV9mbkJ1aWxkU2VhcmNoQXJyYXkoIG9TZXR0aW5ncywgMSApOwoJCQkJCQoJCQkJCS8qIFNlYXJjaCB0aHJvdWdoIGFsbCByZWNvcmRzIHRvIHBvcHVsYXRlIHRoZSBzZWFyY2ggYXJyYXkKCQkJCQkgKiBUaGUgdGhlIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIgYW5kIGFzRGF0YVNlYXJjaCBhcnJheXMgaGF2ZSAxIHRvIDEgCgkJCQkJICogbWFwcGluZwoJCQkJCSAqLwoJCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBycFNlYXJjaC50ZXN0KG9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0pICkKCQkJCQkJewoJCQkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5wdXNoKCBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyW2ldICk7CgkJCQkJCX0KCQkJCQl9CgkJCSAgfQoJCQkgIGVsc2UKCQkJCXsKCQkJICAJLyogVXNpbmcgb2xkIHNlYXJjaCBhcnJheSAtIHJlZmluZSBpdCAtIGRvIGl0IHRoaXMgd2F5IGZvciBzcGVlZAoJCQkgIAkgKiBEb24ndCBoYXZlIHRvIHNlYXJjaCB0aGUgd2hvbGUgbWFzdGVyIGFycmF5IGFnYWluCgkJCQkJICovCgkJCSAgCXZhciBpSW5kZXhDb3JyZWN0b3IgPSAwOwoJCQkgIAkKCQkJICAJLyogU2VhcmNoIHRoZSBjdXJyZW50IHJlc3VsdHMgKi8KCQkJICAJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYXNEYXRhU2VhcmNoLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkgIAkJaWYgKCAhIHJwU2VhcmNoLnRlc3Qob1NldHRpbmdzLmFzRGF0YVNlYXJjaFtpXSkgKQoJCQkJCQl7CgkJCSAgCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIGktaUluZGV4Q29ycmVjdG9yLCAxICk7CgkJCSAgCQkJaUluZGV4Q29ycmVjdG9yKys7CgkJCSAgCQl9CgkJCSAgCX0KCQkJICB9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGFuIGFycmF5IHdoaWNoIGNhbiBiZSBxdWlja2x5IHNlYXJjaCB0aHJvdWdoCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXN0ZXIgdXNlIHRoZSBtYXN0ZXIgZGF0YSBhcnJheSAtIG9wdGlvbmFsCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkJ1aWxkU2VhcmNoQXJyYXkgKCBvU2V0dGluZ3MsIGlNYXN0ZXIgKQoJCXsKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCS8qIENsZWFyIG91dCB0aGUgb2xkIGRhdGEgKi8KCQkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2ggPSBbXTsKCQkKCQkJCXZhciBhaUZpbHRlckNvbHVtbnMgPSBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiU2VhcmNoYWJsZScgKTsKCQkJCXZhciBhaUluZGV4ID0gKGlNYXN0ZXI9PT0xKSA/CgkJCQkgCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIgOgoJCQkJIAlvU2V0dGluZ3MuYWlEaXNwbGF5OwoJCQkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFpSW5kZXgubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2ldID0gX2ZuQnVpbGRTZWFyY2hSb3coCgkJCQkJCW9TZXR0aW5ncywKCQkJCQkJX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBhaUluZGV4W2ldLCAnZmlsdGVyJywgYWlGaWx0ZXJDb2x1bW5zICkKCQkJCQkpOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIHNlYXJjaGFibGUgc3RyaW5nIGZyb20gYSBzaW5nbGUgZGF0YSByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSb3cgZGF0YSBhcnJheSB0byB1c2UgZm9yIHRoZSBkYXRhIHRvIHNlYXJjaAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLCBhRGF0YSApCgkJewoJCQl2YXIgc1NlYXJjaCA9IGFEYXRhLmpvaW4oJyAgJyk7CgkJCQoJCQkvKiBJZiBpdCBsb29rcyBsaWtlIHRoZXJlIGlzIGFuIEhUTUwgZW50aXR5IGluIHRoZSBzdHJpbmcsIGF0dGVtcHQgdG8gZGVjb2RlIGl0ICovCgkJCWlmICggc1NlYXJjaC5pbmRleE9mKCcmJykgIT09IC0xICkKCQkJewoJCQkJc1NlYXJjaCA9ICQoJzxkaXY+JykuaHRtbChzU2VhcmNoKS50ZXh0KCk7CgkJCX0KCQkJCgkJCS8vIFN0cmlwIG5ld2xpbmUgY2hhcmFjdGVycwoJCQlyZXR1cm4gc1NlYXJjaC5yZXBsYWNlKCAvW1xuXHJdL2csICIgIiApOwoJCX0KCQkKCQkvKioKCQkgKiBCdWlsZCBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvYmplY3Qgc3VpdGFibGUgZm9yIHNlYXJjaGluZyBhIHRhYmxlCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU2VhcmNoIHN0cmluZyB0byBzZWFyY2ggZm9yCgkJICogIEBwYXJhbSB7Ym9vbH0gYlJlZ2V4IHRyZWF0IGFzIGEgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTbWFydCBwZXJmb3JtIHNtYXJ0IGZpbHRlcmluZyBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiQ2FzZUluc2Vuc2l0aXZlIERvIGNhc2UgaW5zZW5zaXRpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEByZXR1cm5zIHtSZWdFeHB9IGNvbnN0cnVjdGVkIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNTZWFyY2gsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBhc1NlYXJjaCwgc1JlZ0V4cFN0cmluZzsKCQkJCgkJCWlmICggYlNtYXJ0ICkKCQkJewoJCQkJLyogR2VuZXJhdGUgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byB1c2UuIFNvbWV0aGluZyBhbG9uZyB0aGUgbGluZXMgb2Y6CgkJCQkgKiBeKD89Lio/XGJvbmVcYikoPz0uKj9cYnR3b1xiKSg/PS4qP1xidGhyZWVcYikuKiQKCQkJCSAqLwoJCQkJYXNTZWFyY2ggPSBiUmVnZXggPyBzU2VhcmNoLnNwbGl0KCAnICcgKSA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICkuc3BsaXQoICcgJyApOwoJCQkJc1JlZ0V4cFN0cmluZyA9ICdeKD89Lio/Jythc1NlYXJjaC5qb2luKCAnKSg/PS4qPycgKSsnKS4qJCc7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1JlZ0V4cFN0cmluZywgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlzU2VhcmNoID0gYlJlZ2V4ID8gc1NlYXJjaCA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICk7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1NlYXJjaCwgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ29udmVydCByYXcgZGF0YSBpbnRvIHNvbWV0aGluZyB0aGF0IHRoZSB1c2VyIGNhbiBzZWFyY2ggb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNEYXRhIGRhdGEgdG8gYmUgbW9kaWZpZWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUeXBlIGRhdGEgdHlwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBzZWFyY2ggc3RyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRhdGFUb1NlYXJjaCAoIHNEYXRhLCBzVHlwZSApCgkJewoJCQlpZiAoIHR5cGVvZiBEYXRhVGFibGUuZXh0Lm9mblNlYXJjaFtzVHlwZV0gPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlyZXR1cm4gRGF0YVRhYmxlLmV4dC5vZm5TZWFyY2hbc1R5cGVdKCBzRGF0YSApOwoJCQl9CgkJCWVsc2UgaWYgKCBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQllbHNlIGlmICggc1R5cGUgPT0gImh0bWwiICkKCQkJewoJCQkJcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1tcclxuXS9nLCIgIikucmVwbGFjZSggLzwuKj8+L2csICIiICk7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSA9PT0gInN0cmluZyIgKQoJCQl7CgkJCQlyZXR1cm4gc0RhdGEucmVwbGFjZSgvW1xyXG5dL2csIiAiKTsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIHNjYXBlIGEgc3RyaW5nIHN1Y2ggdGhhdCBpdCBjYW4gYmUgdXNlZCBpbiBhIHJlZ3VsYXIgZXhwcmVzc2lvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZhbCBzdHJpbmcgdG8gZXNjYXBlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGVzY2FwZWQgc3RyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkVzY2FwZVJlZ2V4ICggc1ZhbCApCgkJewoJCQl2YXIgYWNFc2NhcGUgPSBbICcvJywgJy4nLCAnKicsICcrJywgJz8nLCAnfCcsICcoJywgJyknLCAnWycsICddJywgJ3snLCAnfScsICdcXCcsICckJywgJ14nLCAnLScgXTsKCQkJdmFyIHJlUmVwbGFjZSA9IG5ldyBSZWdFeHAoICcoXFwnICsgYWNFc2NhcGUuam9pbignfFxcJykgKyAnKScsICdnJyApOwoJCQlyZXR1cm4gc1ZhbC5yZXBsYWNlKHJlUmVwbGFjZSwgJ1xcJDEnKTsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIHRoZSBpbmZvIGRpc3BsYXkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gSW5mb3JtYXRpb24gZWxlbWVudAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbEluZm8gKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIG5JbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJbkluZm8uY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNJbmZvOwoJCQkKCQkJLyogQWN0aW9ucyB0aGF0IGFyZSB0byBiZSB0YWtlbiBvbmNlIG9ubHkgZm9yIHRoaXMgZmVhdHVyZSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuaSApCgkJCXsKCQkJCS8qIEFkZCBkcmF3IGNhbGxiYWNrICovCgkJCQlvU2V0dGluZ3MuYW9EcmF3Q2FsbGJhY2sucHVzaCggewoJCQkJCSJmbiI6IF9mblVwZGF0ZUluZm8sCgkJCQkJInNOYW1lIjogImluZm9ybWF0aW9uIgoJCQkJfSApOwoJCQkJCgkJCQkvKiBBZGQgaWQgKi8KCQkJCW5JbmZvLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfaW5mbyc7CgkJCX0KCQkJb1NldHRpbmdzLm5UYWJsZS5zZXRBdHRyaWJ1dGUoICdhcmlhLWRlc2NyaWJlZGJ5Jywgb1NldHRpbmdzLnNUYWJsZUlkKydfaW5mbycgKTsKCQkJCgkJCXJldHVybiBuSW5mbzsKCQl9CgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50cyBpbiB0aGUgZGlzcGxheQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblVwZGF0ZUluZm8gKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogU2hvdyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGFibGUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iSW5mbyB8fCBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuaS5sZW5ndGggPT09IDAgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCXZhcgoJCQkJb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLAoJCQkJaVN0YXJ0ID0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0KzEsCgkJCQlpRW5kID0gb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpLAoJCQkJaU1heCA9IG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpLAoJCQkJaVRvdGFsID0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSwKCQkJCXNPdXQ7CgkJCQoJCQlpZiAoIGlUb3RhbCA9PT0gMCAmJiBpVG90YWwgPT0gaU1heCApCgkJCXsKCQkJCS8qIEVtcHR5IHJlY29yZCBzZXQgKi8KCQkJCXNPdXQgPSBvTGFuZy5zSW5mb0VtcHR5OwoJCQl9CgkJCWVsc2UgaWYgKCBpVG90YWwgPT09IDAgKQoJCQl7CgkJCQkvKiBFbXB0eSByZWNvcmQgc2V0IGFmdGVyIGZpbHRlcmluZyAqLwoJCQkJc091dCA9IG9MYW5nLnNJbmZvRW1wdHkgKycgJysgb0xhbmcuc0luZm9GaWx0ZXJlZDsKCQkJfQoJCQllbHNlIGlmICggaVRvdGFsID09IGlNYXggKQoJCQl7CgkJCQkvKiBOb3JtYWwgcmVjb3JkIHNldCAqLwoJCQkJc091dCA9IG9MYW5nLnNJbmZvOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogUmVjb3JkIHNldCBhZnRlciBmaWx0ZXJpbmcgKi8KCQkJCXNPdXQgPSBvTGFuZy5zSW5mbyArJyAnKyBvTGFuZy5zSW5mb0ZpbHRlcmVkOwoJCQl9CgkJCgkJCS8vIENvbnZlcnQgdGhlIG1hY3JvcwoJCQlzT3V0ICs9IG9MYW5nLnNJbmZvUG9zdEZpeDsKCQkJc091dCA9IF9mbkluZm9NYWNyb3MoIG9TZXR0aW5ncywgc091dCApOwoJCQkKCQkJaWYgKCBvTGFuZy5mbkluZm9DYWxsYmFjayAhPT0gbnVsbCApCgkJCXsKCQkJCXNPdXQgPSBvTGFuZy5mbkluZm9DYWxsYmFjay5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCAKCQkJCQlvU2V0dGluZ3MsIGlTdGFydCwgaUVuZCwgaU1heCwgaVRvdGFsLCBzT3V0ICk7CgkJCX0KCQkJCgkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmk7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkkKG5baV0pLmh0bWwoIHNPdXQgKTsKCQkJfQoJCX0KCQkKCQkKCQlmdW5jdGlvbiBfZm5JbmZvTWFjcm9zICggb1NldHRpbmdzLCBzdHIgKQoJCXsKCQkJdmFyCgkJCQlpU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQrMSwKCQkJCXNTdGFydCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaVN0YXJ0ICksCgkJCQlpRW5kID0gb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpLAoJCQkJc0VuZCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaUVuZCApLAoJCQkJaVRvdGFsID0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSwKCQkJCXNUb3RhbCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaVRvdGFsICksCgkJCQlpTWF4ID0gb1NldHRpbmdzLmZuUmVjb3Jkc1RvdGFsKCksCgkJCQlzTWF4ID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpTWF4ICk7CgkJCgkJCS8vIFdoZW4gaW5maW5pdGUgc2Nyb2xsaW5nLCB3ZSBhcmUgYWx3YXlzIHN0YXJ0aW5nIGF0IDEuIF9pRGlzcGxheVN0YXJ0IGlzIHVzZWQgb25seQoJCQkvLyBpbnRlcm5hbGx5CgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlICkKCQkJewoJCQkJc1N0YXJ0ID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCAxICk7CgkJCX0KCQkKCQkJcmV0dXJuIHN0ci4KCQkJCXJlcGxhY2UoJ19TVEFSVF8nLCBzU3RhcnQpLgoJCQkJcmVwbGFjZSgnX0VORF8nLCAgIHNFbmQpLgoJCQkJcmVwbGFjZSgnX1RPVEFMXycsIHNUb3RhbCkuCgkJCQlyZXBsYWNlKCdfTUFYXycsICAgc01heCk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRpYWxpc2UgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGlBamF4U3RhcnQ9b1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkKCQkJLyogRW5zdXJlIHRoYXQgdGhlIHRhYmxlIGRhdGEgaXMgZnVsbHkgaW5pdGlhbGlzZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkluaXRpYWxpc2VkID09PSBmYWxzZSApCgkJCXsKCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7IF9mbkluaXRpYWxpc2UoIG9TZXR0aW5ncyApOyB9LCAyMDAgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgZGlzcGxheSBIVE1MIG9wdGlvbnMgKi8KCQkJX2ZuQWRkT3B0aW9uc0h0bWwoIG9TZXR0aW5ncyApOwoJCQkKCQkJLyogQnVpbGQgYW5kIGRyYXcgdGhlIGhlYWRlciAvIGZvb3RlciBmb3IgdGhlIHRhYmxlICovCgkJCV9mbkJ1aWxkSGVhZCggb1NldHRpbmdzICk7CgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQoJCQkvKiBPa2F5IHRvIHNob3cgdGhhdCBzb21ldGhpbmcgaXMgZ29pbmcgb24gbm93ICovCgkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCgkJCS8qIENhbGN1bGF0ZSBzaXplcyBmb3IgY29sdW1ucyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggIT09IG51bGwgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIElmIHRoZXJlIGlzIGRlZmF1bHQgc29ydGluZyByZXF1aXJlZCAtIGxldCdzIGRvIGl0LiBUaGUgc29ydCBmdW5jdGlvbiB3aWxsIGRvIHRoZQoJCQkgKiBkcmF3aW5nIGZvciB1cy4gT3RoZXJ3aXNlIHdlIGRyYXcgdGhlIHRhYmxlIHJlZ2FyZGxlc3Mgb2YgdGhlIEFqYXggc291cmNlIC0gdGhpcyBhbGxvd3MKCQkJICogdGhlIHRhYmxlIHRvIGxvb2sgaW5pdGlhbGlzZWQgZm9yIEFqYXggc291cmNpbmcgZGF0YSAoc2hvdyAnbG9hZGluZycgbWVzc2FnZSBwb3NzaWJseSkKCQkJICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBpZiB0aGVyZSBpcyBhbiBhamF4IHNvdXJjZSBsb2FkIHRoZSBkYXRhICovCgkJCWlmICggb1NldHRpbmdzLnNBamF4U291cmNlICE9PSBudWxsICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJdmFyIGFvRGF0YSA9IFtdOwoJCQkJX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApOwoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwgZnVuY3Rpb24oanNvbikgewoJCQkJCXZhciBhRGF0YSA9IChvU2V0dGluZ3Muc0FqYXhEYXRhUHJvcCAhPT0gIiIpID8KCQkJCQkgCV9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKShqc29uKSA6IGpzb247CgkJCgkJCQkJLyogR290IHRoZSBkYXRhIC0gYWRkIGl0IHRvIHRoZSB0YWJsZSAqLwoJCQkJCWZvciAoIGk9MCA7IGk8YURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCV9mbkFkZERhdGEoIG9TZXR0aW5ncywgYURhdGFbaV0gKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogUmVzZXQgdGhlIGluaXQgZGlzcGxheSBmb3IgY29va2llIHNhdmluZy4gV2UndmUgYWxyZWFkeSBkb25lIGEgZmlsdGVyLCBhbmQKCQkJCQkgKiB0aGVyZWZvcmUgY2xlYXJlZCBpdCBiZWZvcmUuIFNvIHdlIG5lZWQgdG8gbWFrZSBpdCBhcHBlYXIgJ2ZyZXNoJwoJCQkJCSAqLwoJCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IGlBamF4U3RhcnQ7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJCQl7CgkJCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncywganNvbiApOwoJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgaW5pdGlhbGlzYXRpb24gY29tcGxldGUgaXMgZG9uZSBhdCB0aGUgZW5kIG9mIF9mbkRyYXcgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBbanNvbl0gSlNPTiBmcm9tIHRoZSBzZXJ2ZXIgdGhhdCBjb21wbGV0ZWQgdGhlIHRhYmxlLCBpZiB1c2luZyBBamF4IHNvdXJjZQoJCSAqICAgIHdpdGggY2xpZW50LXNpZGUgcHJvY2Vzc2luZyAob3B0aW9uYWwpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRDb21wbGV0ZSAoIG9TZXR0aW5ncywganNvbiApCgkJewoJCQlvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgPSB0cnVlOwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvSW5pdENvbXBsZXRlJywgJ2luaXQnLCBbb1NldHRpbmdzLCBqc29uXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBjb21wYXRpYmlsaXR5IC0gd2hlbiBjZXJ0YWluIG9wdGlvbnMgYXJlIGdpdmVuLCBhbmQgb3RoZXJzIGFyZW4ndCwgd2UKCQkgKiBuZWVkIHRvIGR1cGxpY2F0ZSB0aGUgdmFsdWVzIG92ZXIsIGluIG9yZGVyIHRvIHByb3ZpZGUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCQkgKiB3aXRoIG9sZGVyIGxhbmd1YWdlIGZpbGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxhbmd1YWdlQ29tcGF0KCBvTGFuZ3VhZ2UgKQoJCXsKCQkJdmFyIG9EZWZhdWx0cyA9IERhdGFUYWJsZS5kZWZhdWx0cy5vTGFuZ3VhZ2U7CgkJCgkJCS8qIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IC0gaWYgdGhlcmUgaXMgbm8gc0VtcHR5VGFibGUgZ2l2ZW4sIHRoZW4gdXNlIHRoZSBzYW1lIGFzCgkJCSAqIHNaZXJvUmVjb3JkcyAtIGFzc3VtaW5nIHRoYXQgaXMgZ2l2ZW4uCgkJCSAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0VtcHR5VGFibGUgJiYgb0xhbmd1YWdlLnNaZXJvUmVjb3JkcyAmJgoJCQkJb0RlZmF1bHRzLnNFbXB0eVRhYmxlID09PSAiTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGUiICkKCQkJewoJCQkJX2ZuTWFwKCBvTGFuZ3VhZ2UsIG9MYW5ndWFnZSwgJ3NaZXJvUmVjb3JkcycsICdzRW1wdHlUYWJsZScgKTsKCQkJfQoJCQoJCQkvKiBMaWtld2lzZSB3aXRoIGxvYWRpbmcgcmVjb3JkcyAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0xvYWRpbmdSZWNvcmRzICYmIG9MYW5ndWFnZS5zWmVyb1JlY29yZHMgJiYKCQkJCW9EZWZhdWx0cy5zTG9hZGluZ1JlY29yZHMgPT09ICJMb2FkaW5nLi4uIiApCgkJCXsKCQkJCV9mbk1hcCggb0xhbmd1YWdlLCBvTGFuZ3VhZ2UsICdzWmVyb1JlY29yZHMnLCAnc0xvYWRpbmdSZWNvcmRzJyApOwoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciB1c2VyIGRpc3BsYXkgbGVuZ3RoIGNoYW5naW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge25vZGV9IERpc3BsYXkgbGVuZ3RoIGZlYXR1cmUgbm9kZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbExlbmd0aCAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQkvKiBUaGlzIGNhbiBiZSBvdmVycnVsZWQgYnkgbm90IHVzaW5nIHRoZSBfTUVOVV8gdmFyL21hY3JvIGluIHRoZSBsYW5ndWFnZSB2YXJpYWJsZSAqLwoJCQl2YXIgc05hbWUgPSAnbmFtZT0iJytvU2V0dGluZ3Muc1RhYmxlSWQrJ19sZW5ndGgiJzsKCQkJdmFyIHNTdGRNZW51ID0gJzxzZWxlY3Qgc2l6ZT0iMSIgJytzTmFtZSsnPic7CgkJCXZhciBpLCBpTGVuOwoJCQl2YXIgYUxlbmd0aE1lbnUgPSBvU2V0dGluZ3MuYUxlbmd0aE1lbnU7CgkJCQoJCQlpZiAoIGFMZW5ndGhNZW51Lmxlbmd0aCA9PSAyICYmIHR5cGVvZiBhTGVuZ3RoTWVudVswXSA9PT0gJ29iamVjdCcgJiYgCgkJCQkJdHlwZW9mIGFMZW5ndGhNZW51WzFdID09PSAnb2JqZWN0JyApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hTGVuZ3RoTWVudVswXS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXNTdGRNZW51ICs9ICc8b3B0aW9uIHZhbHVlPSInK2FMZW5ndGhNZW51WzBdW2ldKyciPicrYUxlbmd0aE1lbnVbMV1baV0rJzwvb3B0aW9uPic7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YUxlbmd0aE1lbnUubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlzU3RkTWVudSArPSAnPG9wdGlvbiB2YWx1ZT0iJythTGVuZ3RoTWVudVtpXSsnIj4nK2FMZW5ndGhNZW51W2ldKyc8L29wdGlvbj4nOwoJCQkJfQoJCQl9CgkJCXNTdGRNZW51ICs9ICc8L3NlbGVjdD4nOwoJCQkKCQkJdmFyIG5MZW5ndGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMubCApCgkJCXsKCQkJCW5MZW5ndGguaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19sZW5ndGgnOwoJCQl9CgkJCW5MZW5ndGguY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNMZW5ndGg7CgkJCW5MZW5ndGguaW5uZXJIVE1MID0gJzxsYWJlbD4nK29TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0xlbmd0aE1lbnUucmVwbGFjZSggJ19NRU5VXycsIHNTdGRNZW51ICkrJzwvbGFiZWw+JzsKCQkJCgkJCS8qCgkJCSAqIFNldCB0aGUgbGVuZ3RoIHRvIHRoZSBjdXJyZW50IGRpc3BsYXkgbGVuZ3RoIC0gdGhhbmtzIHRvIEFuZHJlYSBQYXZsb3ZpYyBmb3IgdGhpcyBmaXgsCgkJCSAqIGFuZCBTdGVmYW4gU2tvcG5payBmb3IgZml4aW5nIHRoZSBmaXghCgkJCSAqLwoJCQkkKCdzZWxlY3Qgb3B0aW9uW3ZhbHVlPSInK29TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgrJyJdJywgbkxlbmd0aCkuYXR0cigic2VsZWN0ZWQiLCB0cnVlKTsKCQkJCgkJCSQoJ3NlbGVjdCcsIG5MZW5ndGgpLmJpbmQoICdjaGFuZ2UuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQl2YXIgaVZhbCA9ICQodGhpcykudmFsKCk7CgkJCQkKCQkJCS8qIFVwZGF0ZSBhbGwgb3RoZXIgbGVuZ3RoIG9wdGlvbnMgZm9yIHRoZSBuZXcgZGlzcGxheSAqLwoJCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMubDsKCQkJCWZvciAoIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBuW2ldICE9IHRoaXMucGFyZW50Tm9kZSApCgkJCQkJewoJCQkJCQkkKCdzZWxlY3QnLCBuW2ldKS52YWwoIGlWYWwgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIFJlZHJhdyB0aGUgdGFibGUgKi8KCQkJCW9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPSBwYXJzZUludChpVmFsLCAxMCk7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCgkJCQkvKiBJZiB3ZSBoYXZlIHNwYWNlIHRvIHNob3cgZXh0cmEgcm93cyAoYmFja2luZyB1cCBmcm9tIHRoZSBlbmQgcG9pbnQgLSB0aGVuIGRvIHNvICovCgkJCQlpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQkJCgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfSApOwoJCQoJCQoJCQkkKCdzZWxlY3QnLCBuTGVuZ3RoKS5hdHRyKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCgkJCXJldHVybiBuTGVuZ3RoOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWNhbGN1bGF0ZSB0aGUgZW5kIHBvaW50IGJhc2VkIG9uIHRoZSBzdGFydCBwb2ludAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2V0IHRoZSBlbmQgcG9pbnQgb2YgdGhlIGRpc3BsYXkgLSBiYXNlZCBvbiBob3cgbWFueSBlbGVtZW50cyB0aGVyZSBhcmUKCQkJCSAqIHN0aWxsIHRvIGRpc3BsYXkKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID4gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggfHwKCQkJCQkgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kID0gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCArIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCQkgKiBOb3RlIHRoYXQgbW9zdCBvZiB0aGUgcGFnaW5nIGxvZ2ljIGlzIGRvbmUgaW4gCgkJICogRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciBkZWZhdWx0IHBhZ2luYXRpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUGFnaW5hdGlvbiBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgblBhZ2luYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJblBhZ2luYXRlLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnaW5nK29TZXR0aW5ncy5zUGFnaW5hdGlvblR5cGU7CgkJCQoJCQlEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uWyBvU2V0dGluZ3Muc1BhZ2luYXRpb25UeXBlIF0uZm5Jbml0KCBvU2V0dGluZ3MsIG5QYWdpbmF0ZSwgCgkJCQlmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQl9CgkJCSk7CgkJCQoJCQkvKiBBZGQgYSBkcmF3IGNhbGxiYWNrIGZvciB0aGUgcGFnaW5hdGlvbiBvbiBmaXJzdCBpbnN0YW5jZSwgdG8gdXBkYXRlIHRoZSBwYWdpbmcgZGlzcGxheSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkJCQkJRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvblsgb1NldHRpbmdzLnNQYWdpbmF0aW9uVHlwZSBdLmZuVXBkYXRlKCBvU2V0dGluZ3MsIGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCX0gKTsKCQkJCQl9LAoJCQkJCSJzTmFtZSI6ICJwYWdpbmF0aW9uIgoJCQkJfSApOwoJCQl9CgkJCXJldHVybiBuUGFnaW5hdGU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFsdGVyIHRoZSBkaXNwbGF5IHNldHRpbmdzIHRvIGNoYW5nZSB0aGUgcGFnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKQoJCSAqICBAcmV0dXJucyB7Ym9vbH0gdHJ1ZSBwYWdlIGhhcyBjaGFuZ2VkLCBmYWxzZSAtIG5vIGNoYW5nZSAobm8gZWZmZWN0KSBlZyAnZmlyc3QnIG9uIHBhZ2UgMQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5QYWdlQ2hhbmdlICggb1NldHRpbmdzLCBtQWN0aW9uICkKCQl7CgkJCXZhciBpT2xkU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQoJCQlpZiAoIHR5cGVvZiBtQWN0aW9uID09PSAibnVtYmVyIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG1BY3Rpb24gKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPiBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJmaXJzdCIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJwcmV2aW91cyIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoPj0wID8KCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDoKCQkJCQkwOwoJCQkJCgkJCQkvKiBDb3JyZWN0IGZvciB1bmRlci1ydW4gKi8KCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQl7CgkJCQkgIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG1BY3Rpb24gPT0gIm5leHQiICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID49IDAgKQoJCQkJewoJCQkJCS8qIE1ha2Ugc3VyZSB3ZSBhcmUgbm90IG92ZXIgcnVubmluZyB0aGUgZGlzcGxheSBhcnJheSAqLwoJCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICsgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA8IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICs9IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG1BY3Rpb24gPT0gImxhc3QiICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID49IDAgKQoJCQkJewoJCQkJCXZhciBpUGFnZXMgPSBwYXJzZUludCggKG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCktMSkgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoLCAxMCApICsgMTsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAoaVBhZ2VzLTEpICogb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDAsICJVbmtub3duIHBhZ2luZyBhY3Rpb246ICIrbUFjdGlvbiApOwoJCQl9CgkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigncGFnZScsIG9TZXR0aW5ncyk7CgkJCQoJCQlyZXR1cm4gaU9sZFN0YXJ0ICE9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydDsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIHRoZSBwcm9jZXNzaW5nIG5vZGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUHJvY2Vzc2luZyBlbGVtZW50CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgblByb2Nlc3NpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnIgKQoJCQl7CgkJCQluUHJvY2Vzc2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3Byb2Nlc3NpbmcnOwoJCQl9CgkJCW5Qcm9jZXNzaW5nLmlubmVySFRNTCA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1Byb2Nlc3Npbmc7CgkJCW5Qcm9jZXNzaW5nLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUHJvY2Vzc2luZzsKCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggblByb2Nlc3NpbmcsIG9TZXR0aW5ncy5uVGFibGUgKTsKCQkJCgkJCXJldHVybiBuUHJvY2Vzc2luZzsKCQl9CgkJCgkJCgkJLyoqCgkJICogRGlzcGxheSBvciBoaWRlIHRoZSBwcm9jZXNzaW5nIGluZGljYXRvcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNob3cgU2hvdyB0aGUgcHJvY2Vzc2luZyBpbmRpY2F0b3IgKHRydWUpIG9yIG5vdCAoZmFsc2UpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblByb2Nlc3NpbmdEaXNwbGF5ICggb1NldHRpbmdzLCBiU2hvdyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlByb2Nlc3NpbmcgKQoJCQl7CgkJCQl2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucjsKCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhbltpXS5zdHlsZS52aXNpYmlsaXR5ID0gYlNob3cgPyAidmlzaWJsZSIgOiAiaGlkZGVuIjsKCQkJCX0KCQkJfQoJCQoJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoJ3Byb2Nlc3NpbmcnLCBbb1NldHRpbmdzLCBiU2hvd10pOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBBZGQgYW55IGNvbnRyb2wgZWxlbWVudHMgZm9yIHRoZSB0YWJsZSAtIHNwZWNpZmljYWxseSBzY3JvbGxpbmcKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gTm9kZSB0byBhZGQgdG8gdGhlIERPTQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbFRhYmxlICggb1NldHRpbmdzICkKCQl7CgkJCS8qIENoZWNrIGlmIHNjcm9sbGluZyBpcyBlbmFibGVkIG9yIG5vdCAtIGlmIG5vdCB0aGVuIGxlYXZlIHRoZSBET00gdW5hbHRlcmVkICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZID09PSAiIiApCgkJCXsKCQkJCXJldHVybiBvU2V0dGluZ3MublRhYmxlOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBUaGUgSFRNTCBzdHJ1Y3R1cmUgdGhhdCB3ZSB3YW50IHRvIGdlbmVyYXRlIGluIHRoaXMgZnVuY3Rpb24gaXM6CgkJCSAqICBkaXYgLSBuU2Nyb2xsZXIKCQkJICogICAgZGl2IC0gblNjcm9sbEhlYWQKCQkJICogICAgICBkaXYgLSBuU2Nyb2xsSGVhZElubmVyCgkJCSAqICAgICAgICB0YWJsZSAtIG5TY3JvbGxIZWFkVGFibGUKCQkJICogICAgICAgICAgdGhlYWQgLSBuVGhlYWQKCQkJICogICAgZGl2IC0gblNjcm9sbEJvZHkKCQkJICogICAgICB0YWJsZSAtIG9TZXR0aW5ncy5uVGFibGUKCQkJICogICAgICAgIHRoZWFkIC0gblRoZWFkU2l6ZQoJCQkgKiAgICAgICAgdGJvZHkgLSBuVGJvZHkKCQkJICogICAgZGl2IC0gblNjcm9sbEZvb3QKCQkJICogICAgICBkaXYgLSBuU2Nyb2xsRm9vdElubmVyCgkJCSAqICAgICAgICB0YWJsZSAtIG5TY3JvbGxGb290VGFibGUKCQkJICogICAgICAgICAgdGZvb3QgLSBuVGZvb3QKCQkJICovCgkJCXZhcgoJCQkgCW5TY3JvbGxlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxIZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWRJbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxCb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEZvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsRm9vdElubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWRUYWJsZSA9IG9TZXR0aW5ncy5uVGFibGUuY2xvbmVOb2RlKGZhbHNlKSwKCQkJIAluU2Nyb2xsRm9vdFRhYmxlID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoZmFsc2UpLAoJCQkJblRoZWFkID0gb1NldHRpbmdzLm5UYWJsZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGhlYWQnKVswXSwKCQkJIAluVGZvb3QgPSBvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Zm9vdCcpLmxlbmd0aCA9PT0gMCA/IG51bGwgOiAKCQkJCQlvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Zm9vdCcpWzBdLAoJCQkJb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQoJCQluU2Nyb2xsSGVhZC5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWRJbm5lciApOwoJCQluU2Nyb2xsRm9vdC5hcHBlbmRDaGlsZCggblNjcm9sbEZvb3RJbm5lciApOwoJCQluU2Nyb2xsQm9keS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQluU2Nyb2xsZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxIZWFkICk7CgkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEJvZHkgKTsKCQkJblNjcm9sbEhlYWRJbm5lci5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWRUYWJsZSApOwoJCQluU2Nyb2xsSGVhZFRhYmxlLmFwcGVuZENoaWxkKCBuVGhlYWQgKTsKCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQluU2Nyb2xsZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxGb290ICk7CgkJCQluU2Nyb2xsRm9vdElubmVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsRm9vdFRhYmxlICk7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLmFwcGVuZENoaWxkKCBuVGZvb3QgKTsKCQkJfQoJCQkKCQkJblNjcm9sbGVyLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxXcmFwcGVyOwoJCQluU2Nyb2xsSGVhZC5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsSGVhZDsKCQkJblNjcm9sbEhlYWRJbm5lci5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsSGVhZElubmVyOwoJCQluU2Nyb2xsQm9keS5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsQm9keTsKCQkJblNjcm9sbEZvb3QuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbEZvb3Q7CgkJCW5TY3JvbGxGb290SW5uZXIuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbEZvb3RJbm5lcjsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuYkF1dG9Dc3MgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQkJblNjcm9sbEhlYWQuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwoJCQkJblNjcm9sbEZvb3Quc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLm92ZXJmbG93ID0gImF1dG8iOwoJCQl9CgkJCQoJCQluU2Nyb2xsSGVhZC5zdHlsZS5ib3JkZXIgPSAiMCI7CgkJCW5TY3JvbGxIZWFkLnN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQluU2Nyb2xsRm9vdC5zdHlsZS5ib3JkZXIgPSAiMCI7CgkJCW5TY3JvbGxIZWFkSW5uZXIuc3R5bGUud2lkdGggPSBvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyICE9PSAiIiA/CgkJCQlvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyIDogIjEwMCUiOyAvKiB3aWxsIGJlIG92ZXJ3cml0dGVuICovCgkJCQoJCQkvKiBNb2RpZnkgYXR0cmlidXRlcyB0byByZXNwZWN0IHRoZSBjbG9uZXMgKi8KCQkJblNjcm9sbEhlYWRUYWJsZS5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7CgkJCW5TY3JvbGxIZWFkVGFibGUuc3R5bGUubWFyZ2luTGVmdCA9ICIwIjsKCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5TY3JvbGxGb290VGFibGUucmVtb3ZlQXR0cmlidXRlKCdpZCcpOwoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQl9CgkJCQoJCQkvKiBNb3ZlIGNhcHRpb24gZWxlbWVudHMgZnJvbSB0aGUgYm9keSB0byB0aGUgaGVhZGVyLCBmb290ZXIgb3IgbGVhdmUgd2hlcmUgaXQgaXMKCQkJICogZGVwZW5kaW5nIG9uIHRoZSBjb25maWd1cmF0aW9uLiBOb3RlIHRoYXQgdGhlIERURCBzYXlzIHRoZXJlIGNhbiBiZSBvbmx5IG9uZSBjYXB0aW9uICovCgkJCXZhciBuQ2FwdGlvbiA9ICQob1NldHRpbmdzLm5UYWJsZSkuY2hpbGRyZW4oJ2NhcHRpb24nKTsKCQkJaWYgKCBuQ2FwdGlvbi5sZW5ndGggPiAwICkKCQkJewoJCQkJbkNhcHRpb24gPSBuQ2FwdGlvblswXTsKCQkJCWlmICggbkNhcHRpb24uX2NhcHRpb25TaWRlID09PSAidG9wIiApCgkJCQl7CgkJCQkJblNjcm9sbEhlYWRUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb24gKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBuQ2FwdGlvbi5fY2FwdGlvblNpZGUgPT09ICJib3R0b20iICYmIG5UZm9vdCApCgkJCQl7CgkJCQkJblNjcm9sbEZvb3RUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb24gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyoKCQkJICogU2l6aW5nCgkJCSAqLwoJCQkvKiBXaGVuIHgtc2Nyb2xsaW5nIGFkZCB0aGUgd2lkdGggYW5kIGEgc2Nyb2xsZXIgdG8gbW92ZSB0aGUgaGVhZGVyIHdpdGggdGhlIGJvZHkgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCApOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb1NldHRpbmdzLm9TY3JvbGwuc1ggKTsKCQkJCQoJCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICk7CQoJCQkJfQoJCQkJCgkJCQkvKiBXaGVuIHRoZSBib2R5IGlzIHNjcm9sbGVkLCB0aGVuIHdlIGFsc28gd2FudCB0byBzY3JvbGwgdGhlIGhlYWRlcnMgKi8KCQkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCggZnVuY3Rpb24gKGUpIHsKCQkJCQluU2Nyb2xsSGVhZC5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0OwoJCQkJCQoJCQkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW5TY3JvbGxGb290LnNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBXaGVuIHlzY3JvbGxpbmcsIGFkZCB0aGUgaGVpZ2h0ICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICk7CgkJCX0KCQkJCgkJCS8qIFJlZHJhdyAtIGFsaWduIGNvbHVtbnMgYWNyb3NzIHRoZSB0YWJsZXMgKi8KCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCSJmbiI6IF9mblNjcm9sbERyYXcsCgkJCQkic05hbWUiOiAic2Nyb2xsaW5nIgoJCQl9ICk7CgkJCQoJCQkvKiBJbmZpbml0ZSBzY3JvbGxpbmcgZXZlbnQgaGFuZGxlcnMgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoIGZ1bmN0aW9uKCkgewoJCQkJCS8qIFVzZSBhIGJsb2NrZXIgdG8gc3RvcCBzY3JvbGxpbmcgZnJvbSBsb2FkaW5nIG1vcmUgZGF0YSB3aGlsZSBvdGhlciBkYXRhIGlzIHN0aWxsIGxvYWRpbmcgKi8KCQkJCQlpZiAoICFvU2V0dGluZ3MuYkRyYXdpbmcgJiYgJCh0aGlzKS5zY3JvbGxUb3AoKSAhPT0gMCApCgkJCQkJewoJCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgbG9hZCB0aGUgbmV4dCBkYXRhIHNldCAqLwoJCQkJCQlpZiAoICQodGhpcykuc2Nyb2xsVG9wKCkgKyAkKHRoaXMpLmhlaWdodCgpID4gCgkJCQkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmhlaWdodCgpIC0gb1NldHRpbmdzLm9TY3JvbGwuaUxvYWRHYXAgKQoJCQkJCQl7CgkJCQkJCQkvKiBPbmx5IGRvIHRoZSByZWRyYXcgaWYgd2UgaGF2ZSB0byAtIHdlIG1pZ2h0IGJlIGF0IHRoZSBlbmQgb2YgdGhlIGRhdGEgKi8KCQkJCQkJCWlmICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAnbmV4dCcgKTsKCQkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MublNjcm9sbEhlYWQgPSBuU2Nyb2xsSGVhZDsKCQkJb1NldHRpbmdzLm5TY3JvbGxGb290ID0gblNjcm9sbEZvb3Q7CgkJCQoJCQlyZXR1cm4gblNjcm9sbGVyOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgdGhlIHZhcmlvdXMgdGFibGVzIGZvciByZXNpemluZy4gSXQncyBhIGJpdCBvZiBhIHBpZyB0aGlzIGZ1bmN0aW9uLCBidXQKCQkgKiBiYXNpY2FsbHkgdGhlIGlkZWEgdG86CgkJICogICAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCSAqICAgMi4gVGFrZSBsaXZlIG1lYXN1cmVtZW50cyBmcm9tIHRoZSBET00KCQkgKiAgIDMuIEFwcGx5IHRoZSBtZWFzdXJlbWVudHMKCQkgKiAgIDQuIENsZWFuIHVwCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbERyYXcgKCBvICkKCQl7CgkJCXZhcgoJCQkJblNjcm9sbEhlYWRJbm5lciA9IG8ublNjcm9sbEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdLAoJCQkJblNjcm9sbEhlYWRUYWJsZSA9IG5TY3JvbGxIZWFkSW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0sCgkJCQluU2Nyb2xsQm9keSA9IG8ublRhYmxlLnBhcmVudE5vZGUsCgkJCQlpLCBpTGVuLCBqLCBqTGVuLCBhbkhlYWRUb1NpemUsIGFuSGVhZFNpemVycywgYW5Gb290U2l6ZXJzLCBhbkZvb3RUb1NpemUsIG9TdHlsZSwgaVZpcywKCQkJCW5UaGVhZFNpemUsIG5UZm9vdFNpemUsCgkJCQlpV2lkdGgsIGFBcHBsaWVkPVtdLCBpU2FuaXR5V2lkdGgsCgkJCQluU2Nyb2xsRm9vdElubmVyID0gKG8ublRGb290ICE9PSBudWxsKSA/IG8ublNjcm9sbEZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdIDogbnVsbCwKCQkJCW5TY3JvbGxGb290VGFibGUgPSAoby5uVEZvb3QgIT09IG51bGwpID8gblNjcm9sbEZvb3RJbm5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGFibGUnKVswXSA6IG51bGwsCgkJCQlpZTY3ID0gby5vQnJvd3Nlci5iU2Nyb2xsT3ZlcnNpemU7CgkJCQoJCQkvKgoJCQkgKiAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSB0aGUgb2xkIG1pbmltaXNlZCB0aGVhZCBhbmQgdGZvb3QgZWxlbWVudHMgaW4gdGhlIGlubmVyIHRhYmxlICovCgkJCSQoby5uVGFibGUpLmNoaWxkcmVuKCd0aGVhZCwgdGZvb3QnKS5yZW1vdmUoKTsKCQkKCQkJLyogQ2xvbmUgdGhlIGN1cnJlbnQgaGVhZGVyIGFuZCBmb290ZXIgZWxlbWVudHMgYW5kIHRoZW4gcGxhY2UgaXQgaW50byB0aGUgaW5uZXIgdGFibGUgKi8KCQkJblRoZWFkU2l6ZSA9ICQoby5uVEhlYWQpLmNsb25lKClbMF07CgkJCW8ublRhYmxlLmluc2VydEJlZm9yZSggblRoZWFkU2l6ZSwgby5uVGFibGUuY2hpbGROb2Rlc1swXSApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5UZm9vdFNpemUgPSAkKG8ublRGb290KS5jbG9uZSgpWzBdOwoJCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGZvb3RTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzFdICk7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIDIuIFRha2UgbGl2ZSBtZWFzdXJlbWVudHMgZnJvbSB0aGUgRE9NIC0gZG8gbm90IGFsdGVyIHRoZSBET00gaXRzZWxmIQoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSBvbGQgc2l6aW5nIGFuZCBhcHBseSB0aGUgY2FsY3VsYXRlZCBjb2x1bW4gd2lkdGhzCgkJCSAqIEdldCB0aGUgdW5pcXVlIGNvbHVtbiBoZWFkZXJzIGluIHRoZSBuZXdseSBjcmVhdGVkIChjbG9uZWQpIGhlYWRlci4gV2Ugd2FudCB0byBhcHBseSB0aGUKCQkJICogY2FsY3VsYXRlZCBzaXplcyB0byB0aGlzIGhlYWRlcgoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCX0KCQkJCgkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvLCBuVGhlYWRTaXplICk7CgkJCWZvciAoIGk9MCwgaUxlbj1uVGhzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlWaXMgPSBfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCggbywgaSApOwoJCQkJblRoc1tpXS5zdHlsZS53aWR0aCA9IG8uYW9Db2x1bW5zW2lWaXNdLnNXaWR0aDsKCQkJfQoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24obikgewoJCQkJCW4uc3R5bGUud2lkdGggPSAiIjsKCQkJCX0sIG5UZm9vdFNpemUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJykgKTsKCQkJfQoJCQoJCQkvLyBJZiBzY3JvbGwgY29sbGFwc2UgaXMgZW5hYmxlZCwgd2hlbiB3ZSBwdXQgdGhlIGhlYWRlcnMgYmFjayBpbnRvIHRoZSBib2R5IGZvciBzaXppbmcsIHdlCgkJCS8vIHdpbGwgZW5kIHVwIGZvcmNpbmcgdGhlIHNjcm9sbGJhciB0byBhcHBlYXIsIG1ha2luZyBvdXIgbWVhc3VyZW1lbnRzIHdyb25nIGZvciB3aGVuIHdlCgkJCS8vIHRoZW4gaGlkZSBpdCAoZW5kIG9mIHRoaXMgZnVuY3Rpb24pLCBzbyBhZGQgdGhlIGhlYWRlciBoZWlnaHQgdG8gdGhlIGJvZHkgc2Nyb2xsZXIuCgkJCWlmICggby5vU2Nyb2xsLmJDb2xsYXBzZSAmJiBvLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gKG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCArIG8ublRIZWFkLm9mZnNldEhlaWdodCkrInB4IjsKCQkJfQoJCQkKCQkJLyogU2l6ZSB0aGUgdGFibGUgYXMgYSB3aG9sZSAqLwoJCQlpU2FuaXR5V2lkdGggPSAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCk7CgkJCWlmICggby5vU2Nyb2xsLnNYID09PSAiIiApCgkJCXsKCQkJCS8qIE5vIHggc2Nyb2xsaW5nICovCgkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9ICIxMDAlIjsKCQkJCQoJCQkJLyogSSBrbm93IHRoaXMgaXMgcnViYmlzaCAtIGJ1dCBJRTcgd2lsbCBtYWtlIHRoZSB3aWR0aCBvZiB0aGUgdGFibGUgd2hlbiAxMDAlIGluY2x1ZGUKCQkJCSAqIHRoZSBzY3JvbGxiYXIgLSB3aGljaCBpcyBzaG91bGRuJ3QuIFdoZW4gdGhlcmUgaXMgYSBzY3JvbGxiYXIgd2UgbmVlZCB0byB0YWtlIHRoaXMKCQkJCSAqIGludG8gYWNjb3VudC4KCQkJCSAqLwoJCQkJaWYgKCBpZTY3ICYmICgkKCd0Ym9keScsIG5TY3JvbGxCb2R5KS5oZWlnaHQoKSA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikgICkKCQkJCXsKCQkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgLSBvLm9TY3JvbGwuaUJhcldpZHRoKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCWlmICggby5vU2Nyb2xsLnNYSW5uZXIgIT09ICIiICkKCQkJCXsKCQkJCQkvKiB4IHNjcm9sbCBpbm5lciBoYXMgYmVlbiBnaXZlbiAtIHVzZSBpdCAqLwoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3Moby5vU2Nyb2xsLnNYSW5uZXIpOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGlTYW5pdHlXaWR0aCA9PSAkKG5TY3JvbGxCb2R5KS53aWR0aCgpICYmCgkJCQkgICAkKG5TY3JvbGxCb2R5KS5oZWlnaHQoKSA8ICQoby5uVGFibGUpLmhlaWdodCgpICkKCQkJCXsKCQkJCQkvKiBUaGVyZSBpcyB5LXNjcm9sbGluZyAtIHRyeSB0byB0YWtlIGFjY291bnQgb2YgdGhlIHkgc2Nyb2xsIGJhciAqLwoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlTYW5pdHlXaWR0aC1vLm9TY3JvbGwuaUJhcldpZHRoICk7CgkJCQkJaWYgKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgPiBpU2FuaXR5V2lkdGgtby5vU2Nyb2xsLmlCYXJXaWR0aCApCgkJCQkJewoJCQkJCQkvKiBOb3QgcG9zc2libGUgdG8gdGFrZSBhY2NvdW50IG9mIGl0ICovCgkJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlTYW5pdHlXaWR0aCApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQkvKiBBbGwgZWxzZSBmYWlscyAqLwoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlTYW5pdHlXaWR0aCApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBSZWNhbGN1bGF0ZSB0aGUgc2FuaXR5IHdpZHRoIC0gbm93IHRoYXQgd2UndmUgYXBwbGllZCB0aGUgcmVxdWlyZWQgd2lkdGgsIGJlZm9yZSBpdCB3YXMKCQkJICogYSB0ZW1wb3JhcnkgdmFyaWFibGUuIFRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSB0aGUgY29sdW1uIHdpZHRoIGNhbGN1bGF0aW9uIGlzIGRvbmUKCQkJICogYmVmb3JlIHRoaXMgdGFibGUgRE9NIGlzIGNyZWF0ZWQuCgkJCSAqLwoJCQlpU2FuaXR5V2lkdGggPSAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCk7CgkJCQoJCQkvKiBXZSB3YW50IHRoZSBoaWRkZW4gaGVhZGVyIHRvIGhhdmUgemVybyBoZWlnaHQsIHNvIHJlbW92ZSBwYWRkaW5nIGFuZCBib3JkZXJzLiBUaGVuCgkJCSAqIHNldCB0aGUgd2lkdGggYmFzZWQgb24gdGhlIHJlYWwgaGVhZGVycwoJCQkgKi8KCQkJYW5IZWFkVG9TaXplID0gby5uVEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCWFuSGVhZFNpemVycyA9IG5UaGVhZFNpemUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCQoJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplciwgblRvU2l6ZSkgewoJCQkJb1N0eWxlID0gblNpemVyLnN0eWxlOwoJCQkJb1N0eWxlLnBhZGRpbmdUb3AgPSAiMCI7CgkJCQlvU3R5bGUucGFkZGluZ0JvdHRvbSA9ICIwIjsKCQkJCW9TdHlsZS5ib3JkZXJUb3BXaWR0aCA9ICIwIjsKCQkJCW9TdHlsZS5ib3JkZXJCb3R0b21XaWR0aCA9ICIwIjsKCQkJCW9TdHlsZS5oZWlnaHQgPSAwOwoJCQkJCgkJCQlpV2lkdGggPSAkKG5TaXplcikud2lkdGgoKTsKCQkJCW5Ub1NpemUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVdpZHRoICk7CgkJCQlhQXBwbGllZC5wdXNoKCBpV2lkdGggKTsKCQkJfSwgYW5IZWFkU2l6ZXJzLCBhbkhlYWRUb1NpemUgKTsKCQkJJChhbkhlYWRTaXplcnMpLmhlaWdodCgwKTsKCQkJCgkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQkvKiBDbG9uZSB0aGUgY3VycmVudCBmb290ZXIgYW5kIHRoZW4gcGxhY2UgaXQgaW50byB0aGUgYm9keSB0YWJsZSBhcyBhICJoaWRkZW4gaGVhZGVyIiAqLwoJCQkJYW5Gb290U2l6ZXJzID0gblRmb290U2l6ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJCWFuRm9vdFRvU2l6ZSA9IG8ublRGb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQkJCgkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplciwgblRvU2l6ZSkgewoJCQkJCW9TdHlsZSA9IG5TaXplci5zdHlsZTsKCQkJCQlvU3R5bGUucGFkZGluZ1RvcCA9ICIwIjsKCQkJCQlvU3R5bGUucGFkZGluZ0JvdHRvbSA9ICIwIjsKCQkJCQlvU3R5bGUuYm9yZGVyVG9wV2lkdGggPSAiMCI7CgkJCQkJb1N0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gIjAiOwoJCQkJCW9TdHlsZS5oZWlnaHQgPSAwOwoJCQkJCQoJCQkJCWlXaWR0aCA9ICQoblNpemVyKS53aWR0aCgpOwoJCQkJCW5Ub1NpemUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVdpZHRoICk7CgkJCQkJYUFwcGxpZWQucHVzaCggaVdpZHRoICk7CgkJCQl9LCBhbkZvb3RTaXplcnMsIGFuRm9vdFRvU2l6ZSApOwoJCQkJJChhbkZvb3RTaXplcnMpLmhlaWdodCgwKTsKCQkJfQoJCQkKCQkJLyoKCQkJICogMy4gQXBwbHkgdGhlIG1lYXN1cmVtZW50cwoJCQkgKi8KCQkJCgkJCS8qICJIaWRlIiB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdGhhdCB3ZSB1c2VkIGZvciB0aGUgc2l6aW5nLiBXZSB3YW50IHRvIGFsc28gZml4IHRoZWlyIHdpZHRoCgkJCSAqIHRvIHdoYXQgdGhleSBjdXJyZW50bHkgYXJlCgkJCSAqLwoJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplcikgewoJCQkJblNpemVyLmlubmVySFRNTCA9ICIiOwoJCQkJblNpemVyLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGFBcHBsaWVkLnNoaWZ0KCkgKTsKCQkJfSwgYW5IZWFkU2l6ZXJzICk7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuU2l6ZXIpIHsKCQkJCQluU2l6ZXIuaW5uZXJIVE1MID0gIiI7CgkJCQkJblNpemVyLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGFBcHBsaWVkLnNoaWZ0KCkgKTsKCQkJCX0sIGFuRm9vdFNpemVycyApOwoJCQl9CgkJCQoJCQkvKiBTYW5pdHkgY2hlY2sgdGhhdCB0aGUgdGFibGUgaXMgb2YgYSBzZW5zaWJsZSB3aWR0aC4gSWYgbm90IHRoZW4gd2UgYXJlIGdvaW5nIHRvIGdldAoJCQkgKiBtaXNhbGlnbm1lbnQgLSB0cnkgdG8gcHJldmVudCB0aGlzIGJ5IG5vdCBhbGxvd2luZyB0aGUgdGFibGUgdG8gc2hyaW5rIGJlbG93IGl0cyBtaW4gd2lkdGgKCQkJICovCgkJCWlmICggJChvLm5UYWJsZSkub3V0ZXJXaWR0aCgpIDwgaVNhbml0eVdpZHRoICkKCQkJewoJCQkJLyogVGhlIG1pbiB3aWR0aCBkZXBlbmRzIHVwb24gaWYgd2UgaGF2ZSBhIHZlcnRpY2FsIHNjcm9sbGJhciB2aXNpYmxlIG9yIG5vdCAqLwoJCQkJdmFyIGlDb3JyZWN0aW9uID0gKChuU2Nyb2xsQm9keS5zY3JvbGxIZWlnaHQgPiBuU2Nyb2xsQm9keS5vZmZzZXRIZWlnaHQgfHwgCgkJCQkJJChuU2Nyb2xsQm9keSkuY3NzKCdvdmVyZmxvdy15JykgPT0gInNjcm9sbCIpKSA/CgkJCQkJCWlTYW5pdHlXaWR0aCtvLm9TY3JvbGwuaUJhcldpZHRoIDogaVNhbml0eVdpZHRoOwoJCQkJCgkJCQkvKiBJRTYvNyBhcmUgYSBsYXcgdW50byB0aGVtc2VsdmVzLi4uICovCgkJCQlpZiAoIGllNjcgJiYgKG5TY3JvbGxCb2R5LnNjcm9sbEhlaWdodCA+IAoJCQkJCW5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikgICkKCQkJCXsKCQkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpQ29ycmVjdGlvbi1vLm9TY3JvbGwuaUJhcldpZHRoICk7CgkJCQl9CgkJCQkKCQkJCS8qIEFwcGx5IHRoZSBjYWxjdWxhdGVkIG1pbmltdW0gd2lkdGggdG8gdGhlIHRhYmxlIHdyYXBwZXJzICovCgkJCQluU2Nyb2xsQm9keS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpQ29ycmVjdGlvbiApOwoJCQkJblNjcm9sbEhlYWRJbm5lci5wYXJlbnROb2RlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290SW5uZXIucGFyZW50Tm9kZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpQ29ycmVjdGlvbiApOwoJCQkJfQoJCQkJCgkJCQkvKiBBbmQgZ2l2ZSB0aGUgdXNlciBhIHdhcm5pbmcgdGhhdCB3ZSd2ZSBzdG9wcGVkIHRoZSB0YWJsZSBnZXR0aW5nIHRvbyBzbWFsbCAqLwoJCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJCXsKCQkJCQlfZm5Mb2coIG8sIDEsICJUaGUgdGFibGUgY2Fubm90IGZpdCBpbnRvIHRoZSBjdXJyZW50IGVsZW1lbnQgd2hpY2ggd2lsbCBjYXVzZSBjb2x1bW4iKwoJCQkJCQkiIG1pc2FsaWdubWVudC4gVGhlIHRhYmxlIGhhcyBiZWVuIGRyYXduIGF0IGl0cyBtaW5pbXVtIHBvc3NpYmxlIHdpZHRoLiIgKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCV9mbkxvZyggbywgMSwgIlRoZSB0YWJsZSBjYW5ub3QgZml0IGludG8gdGhlIGN1cnJlbnQgZWxlbWVudCB3aGljaCB3aWxsIGNhdXNlIGNvbHVtbiIrCgkJCQkJCSIgbWlzYWxpZ25tZW50LiBJbmNyZWFzZSB0aGUgc1Njcm9sbFhJbm5lciB2YWx1ZSBvciByZW1vdmUgaXQgdG8gYWxsb3cgYXV0b21hdGljIisKCQkJCQkJIiBjYWxjdWxhdGlvbiIgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICcxMDAlJyApOwoJCQkJblNjcm9sbEhlYWRJbm5lci5wYXJlbnROb2RlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICcxMDAlJyApOwoJCQkJCgkJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJCXsKCQkJCQluU2Nyb2xsRm9vdElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQl9CgkJCX0KCQkJCgkJCQoJCQkvKgoJCQkgKiA0LiBDbGVhbiB1cAoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJLyogSUU3PCBwdXRzIGEgdmVydGljYWwgc2Nyb2xsYmFyIGluIHBsYWNlICh3aGVuIGl0IHNob3VsZG4ndCBiZSkgZHVlIHRvIHN1YnRyYWN0aW5nCgkJCQkgKiB0aGUgc2Nyb2xsYmFyIGhlaWdodCBmcm9tIHRoZSB2aXNpYmxlIGRpc3BsYXksIHJhdGhlciB0aGFuIGFkZGluZyBpdCBvbi4gV2UgbmVlZCB0bwoJCQkJICogc2V0IHRoZSBoZWlnaHQgaW4gb3JkZXIgdG8gc29ydCB0aGlzLiBEb24ndCB3YW50IHRvIGRvIGl0IGluIGFueSBvdGhlciBicm93c2Vycy4KCQkJCSAqLwoJCQkJaWYgKCBpZTY3ICkKCQkJCXsKCQkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSBfZm5TdHJpbmdUb0Nzcyggby5uVGFibGUub2Zmc2V0SGVpZ2h0K28ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvLm9TY3JvbGwuc1kgIT09ICIiICYmIG8ub1Njcm9sbC5iQ29sbGFwc2UgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSBfZm5TdHJpbmdUb0Nzcyggby5vU2Nyb2xsLnNZICk7CgkJCQkKCQkJCXZhciBpRXh0cmEgPSAoby5vU2Nyb2xsLnNYICE9PSAiIiAmJiBvLm5UYWJsZS5vZmZzZXRXaWR0aCA+IG5TY3JvbGxCb2R5Lm9mZnNldFdpZHRoKSA/CgkJCQkgCW8ub1Njcm9sbC5pQmFyV2lkdGggOiAwOwoJCQkJaWYgKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQgPCBuU2Nyb2xsQm9keS5vZmZzZXRIZWlnaHQgKQoJCQkJewoJCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQraUV4dHJhICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEZpbmFsbHkgc2V0IHRoZSB3aWR0aCdzIG9mIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0YWJsZXMgKi8KCQkJdmFyIGlPdXRlcldpZHRoID0gJChvLm5UYWJsZSkub3V0ZXJXaWR0aCgpOwoJCQluU2Nyb2xsSGVhZFRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCW5TY3JvbGxIZWFkSW5uZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaU91dGVyV2lkdGggKTsKCQkKCQkJLy8gRmlndXJlIG91dCBpZiB0aGVyZSBhcmUgc2Nyb2xsYmFyIHByZXNlbnQgLSBpZiBzbyB0aGVuIHdlIG5lZWQgYSB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdG8KCQkJLy8gcHJvdmlkZSBhIGJpdCBtb3JlIHNwYWNlIHRvIGFsbG93ICJvdmVyZmxvdyIgc2Nyb2xsaW5nIChpLmUuIHBhc3QgdGhlIHNjcm9sbGJhcikKCQkJdmFyIGJTY3JvbGxpbmcgPSAkKG8ublRhYmxlKS5oZWlnaHQoKSA+IG5TY3JvbGxCb2R5LmNsaWVudEhlaWdodCB8fCAkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIjsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS5wYWRkaW5nUmlnaHQgPSBiU2Nyb2xsaW5nID8gby5vU2Nyb2xsLmlCYXJXaWR0aCsicHgiIDogIjBweCI7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS5wYWRkaW5nUmlnaHQgPSBiU2Nyb2xsaW5nID8gby5vU2Nyb2xsLmlCYXJXaWR0aCsicHgiIDogIjBweCI7CgkJCX0KCQkKCQkJLyogQWRqdXN0IHRoZSBwb3NpdGlvbiBvZiB0aGUgaGVhZGVyIGluIGNhc2Ugd2UgbG9vc2UgdGhlIHktc2Nyb2xsYmFyICovCgkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCgpOwoJCQkKCQkJLyogSWYgc29ydGluZyBvciBmaWx0ZXJpbmcgaGFzIG9jY3VycmVkLCBqdW1wIHRoZSBzY3JvbGxpbmcgYmFjayB0byB0aGUgdG9wICovCgkJCWlmICggby5iU29ydGVkIHx8IG8uYkZpbHRlcmVkICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc2Nyb2xsVG9wID0gMDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBseSBhIGdpdmVuIGZ1bmN0aW9uIHRvIHRoZSBkaXNwbGF5IGNoaWxkIG5vZGVzIG9mIGFuIGVsZW1lbnQgYXJyYXkgKHR5cGljYWxseQoJCSAqIFREIGNoaWxkcmVuIG9mIFRSIHJvd3MKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gTWV0aG9kIHRvIGFwcGx5IHRvIHRoZSBvYmplY3RzCgkJICogIEBwYXJhbSBhcnJheSB7bm9kZXN9IGFuMSBMaXN0IG9mIGVsZW1lbnRzIHRvIGxvb2sgdGhyb3VnaCBmb3IgZGlzcGxheSBjaGlsZHJlbgoJCSAqICBAcGFyYW0gYXJyYXkge25vZGVzfSBhbjIgQW5vdGhlciBsaXN0IChpZGVudGljYWwgc3RydWN0dXJlIHRvIHRoZSBmaXJzdCkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BcHBseVRvQ2hpbGRyZW4oIGZuLCBhbjEsIGFuMiApCgkJewoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFuMS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPWFuMVtpXS5jaGlsZE5vZGVzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBhbjFbaV0uY2hpbGROb2Rlc1tqXS5ub2RlVHlwZSA9PSAxICkKCQkJCQl7CgkJCQkJCWlmICggYW4yICkKCQkJCQkJewoJCQkJCQkJZm4oIGFuMVtpXS5jaGlsZE5vZGVzW2pdLCBhbjJbaV0uY2hpbGROb2Rlc1tqXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJZm4oIGFuMVtpXS5jaGlsZE5vZGVzW2pdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogQ29udmVydCBhIENTUyB1bml0IHdpZHRoIHRvIHBpeGVscyAoZS5nLiAyZW0pCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzV2lkdGggd2lkdGggdG8gYmUgY29udmVydGVkCgkJICogIEBwYXJhbSB7bm9kZX0gblBhcmVudCBwYXJlbnQgdG8gZ2V0IHRoZSB3aXRoIGZvciAocmVxdWlyZWQgZm9yIHJlbGF0aXZlIHdpZHRocykgLSBvcHRpb25hbAoJCSAqICBAcmV0dXJucyB7aW50fSBpV2lkdGggd2lkdGggaW4gcGl4ZWxzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbnZlcnRUb1dpZHRoICggc1dpZHRoLCBuUGFyZW50ICkKCQl7CgkJCWlmICggIXNXaWR0aCB8fCBzV2lkdGggPT09IG51bGwgfHwgc1dpZHRoID09PSAnJyApCgkJCXsKCQkJCXJldHVybiAwOwoJCQl9CgkJCQoJCQlpZiAoICFuUGFyZW50ICkKCQkJewoJCQkJblBhcmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF07CgkJCX0KCQkJCgkJCXZhciBpV2lkdGg7CgkJCXZhciBuVG1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKTsKCQkJblRtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBzV2lkdGggKTsKCQkJCgkJCW5QYXJlbnQuYXBwZW5kQ2hpbGQoIG5UbXAgKTsKCQkJaVdpZHRoID0gblRtcC5vZmZzZXRXaWR0aDsKCQkJblBhcmVudC5yZW1vdmVDaGlsZCggblRtcCApOwoJCQkKCQkJcmV0dXJuICggaVdpZHRoICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENhbGN1bGF0ZSB0aGUgd2lkdGggb2YgY29sdW1ucyBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpVGFibGVXaWR0aCA9IG9TZXR0aW5ncy5uVGFibGUub2Zmc2V0V2lkdGg7CgkJCXZhciBpVXNlcklucHV0cyA9IDA7CgkJCXZhciBpVG1wV2lkdGg7CgkJCXZhciBpVmlzaWJsZUNvbHVtbnMgPSAwOwoJCQl2YXIgaUNvbHVtcyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgaSwgaUluZGV4LCBpQ29ycmVjdG9yLCBpV2lkdGg7CgkJCXZhciBvSGVhZGVycyA9ICQoJ3RoJywgb1NldHRpbmdzLm5USGVhZCk7CgkJCXZhciB3aWR0aEF0dHIgPSBvU2V0dGluZ3MublRhYmxlLmdldEF0dHJpYnV0ZSgnd2lkdGgnKTsKCQkJCgkJCS8qIENvbnZlcnQgYW55IHVzZXIgaW5wdXQgc2l6ZXMgaW50byBwaXhlbCBzaXplcyAqLwoJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bXMgOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJewoJCQkJCWlWaXNpYmxlQ29sdW1ucysrOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJaVRtcFdpZHRoID0gX2ZuQ29udmVydFRvV2lkdGgoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoT3JpZywgCgkJCQkJCQlvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGUgKTsKCQkJCQkJaWYgKCBpVG1wV2lkdGggIT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG1wV2lkdGggKTsKCQkJCQkJfQoJCQkJCQkJCgkJCQkJCWlVc2VySW5wdXRzKys7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIERPTSBlcXVhbHMgdGhlIG51bWJlciB0aGF0IHdlIGhhdmUgdG8gcHJvY2VzcyBpbiAKCQkJICogRGF0YVRhYmxlcywgdGhlbiB3ZSBjYW4gdXNlIHRoZSBvZmZzZXRzIHRoYXQgYXJlIGNyZWF0ZWQgYnkgdGhlIHdlYi1icm93c2VyLiBObyBjdXN0b20gCgkJCSAqIHNpemVzIGNhbiBiZSBzZXQgaW4gb3JkZXIgZm9yIHRoaXMgdG8gaGFwcGVuLCBub3Igc2Nyb2xsaW5nIHVzZWQKCQkJICovCgkJCWlmICggaUNvbHVtcyA9PSBvSGVhZGVycy5sZW5ndGggJiYgaVVzZXJJbnB1dHMgPT09IDAgJiYgaVZpc2libGVDb2x1bW5zID09IGlDb2x1bXMgJiYKCQkJCW9TZXR0aW5ncy5vU2Nyb2xsLnNYID09PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWSA9PT0gIiIgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVG1wV2lkdGggPSAkKG9IZWFkZXJzW2ldKS53aWR0aCgpOwoJCQkJCWlmICggaVRtcFdpZHRoICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUbXBXaWR0aCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIE90aGVyd2lzZSB3ZSBhcmUgZ29pbmcgdG8gaGF2ZSB0byBkbyBzb21lIGNhbGN1bGF0aW9ucyB0byBnZXQgdGhlIHdpZHRoIG9mIGVhY2ggY29sdW1uLgoJCQkJICogQ29uc3RydWN0IGEgMSByb3cgdGFibGUgd2l0aCB0aGUgd2lkZXN0IG5vZGUgaW4gdGhlIGRhdGEsIGFuZCBhbnkgdXNlciBkZWZpbmVkIHdpZHRocywKCQkJCSAqIHRoZW4gaW5zZXJ0IGl0IGludG8gdGhlIERPTSBhbmQgYWxsb3cgdGhlIGJyb3dzZXIgdG8gZG8gYWxsIHRoZSBoYXJkIHdvcmsgb2YKCQkJCSAqIGNhbGN1bGF0aW5nIHRhYmxlIHdpZHRocy4KCQkJCSAqLwoJCQkJdmFyCgkJCQkJbkNhbGNUbXAgPSBvU2V0dGluZ3MublRhYmxlLmNsb25lTm9kZSggZmFsc2UgKSwKCQkJCQluVGhlYWRDbG9uZSA9IG9TZXR0aW5ncy5uVEhlYWQuY2xvbmVOb2RlKHRydWUpLAoJCQkJCW5Cb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3Rib2R5JyApLAoJCQkJCW5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0cicgKSwKCQkJCQluRGl2U2l6aW5nOwoJCQkJCgkJCQluQ2FsY1RtcC5yZW1vdmVBdHRyaWJ1dGUoICJpZCIgKTsKCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBuVGhlYWRDbG9uZSApOwoJCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICE9PSBudWxsICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5URm9vdC5jbG9uZU5vZGUodHJ1ZSkgKTsKCQkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG4pIHsKCQkJCQkJbi5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCX0sIG5DYWxjVG1wLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpICk7CgkJCQl9CgkJCQkKCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBuQm9keSApOwoJCQkJbkJvZHkuYXBwZW5kQ2hpbGQoIG5UciApOwoJCQkJCgkJCQkvKiBSZW1vdmUgYW55IHNpemluZyB0aGF0IHdhcyBwcmV2aW91c2x5IGFwcGxpZWQgYnkgdGhlIHN0eWxlcyAqLwoJCQkJdmFyIGpxQ29sU2l6aW5nID0gJCgndGhlYWQgdGgnLCBuQ2FsY1RtcCk7CgkJCQlpZiAoIGpxQ29sU2l6aW5nLmxlbmd0aCA9PT0gMCApCgkJCQl7CgkJCQkJanFDb2xTaXppbmcgPSAkKCd0Ym9keSB0cjplcSgwKT50ZCcsIG5DYWxjVG1wKTsKCQkJCX0KCQkKCQkJCS8qIEFwcGx5IGN1c3RvbSBzaXppbmcgdG8gdGhlIGNsb25lZCBoZWFkZXIgKi8KCQkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsIG5UaGVhZENsb25lICk7CgkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtcyA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIG9Db2x1bW4gPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldOwoJCQkJCWlmICggb0NvbHVtbi5iVmlzaWJsZSAmJiBvQ29sdW1uLnNXaWR0aE9yaWcgIT09IG51bGwgJiYgb0NvbHVtbi5zV2lkdGhPcmlnICE9PSAiIiApCgkJCQkJewoJCQkJCQluVGhzW2ktaUNvcnJlY3Rvcl0uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb0NvbHVtbi5zV2lkdGhPcmlnICk7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKCBvQ29sdW1uLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCW5UaHNbaS1pQ29ycmVjdG9yXS5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJfQoJCQkJfQoJCQoJCQkJLyogRmluZCB0aGUgYmlnZ2VzdCB0ZCBmb3IgZWFjaCBjb2x1bW4gYW5kIHB1dCBpdCBpbnRvIHRoZSB0YWJsZSAqLwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJdmFyIG5UZCA9IF9mbkdldFdpZGVzdE5vZGUoIG9TZXR0aW5ncywgaSApOwoJCQkJCQlpZiAoIG5UZCAhPT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW5UZCA9IG5UZC5jbG9uZU5vZGUodHJ1ZSk7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NvbnRlbnRQYWRkaW5nICE9PSAiIiApCgkJCQkJCQl7CgkJCQkJCQkJblRkLmlubmVySFRNTCArPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDb250ZW50UGFkZGluZzsKCQkJCQkJCX0KCQkJCQkJCW5Uci5hcHBlbmRDaGlsZCggblRkICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSB0YWJsZSBhbmQgJ2Rpc3BsYXknIGl0ICovCgkJCQl2YXIgbldyYXBwZXIgPSBvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGU7CgkJCQluV3JhcHBlci5hcHBlbmRDaGlsZCggbkNhbGNUbXAgKTsKCQkJCQoJCQkJLyogV2hlbiBzY3JvbGxpbmcgKFggb3IgWSkgd2Ugd2FudCB0byBzZXQgdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSBhcyBhcHByb3ByaWF0ZS4gSG93ZXZlciwKCQkJCSAqIHdoZW4gbm90IHNjcm9sbGluZyBsZWF2ZSB0aGUgdGFibGUgd2lkdGggYXMgaXQgaXMuIFRoaXMgcmVzdWx0cyBpbiBzbGlnaHRseSBkaWZmZXJlbnQsCgkJCQkgKiBidXQgSSB0aGluayBjb3JyZWN0IGJlaGF2aW91cgoJCQkJICovCgkJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyICE9PSAiIiApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gIiI7CgkJCQkJaWYgKCAkKG5DYWxjVG1wKS53aWR0aCgpIDwgbldyYXBwZXIub2Zmc2V0V2lkdGggKQoJCQkJCXsKCQkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggbldyYXBwZXIub2Zmc2V0V2lkdGggKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBuV3JhcHBlci5vZmZzZXRXaWR0aCApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIHdpZHRoQXR0ciApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggd2lkdGhBdHRyICk7CgkJCQl9CgkJCQluQ2FsY1RtcC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CgkJCQkKCQkJCS8qIFNjcm9sbGluZyBjb25zaWRlcmF0aW9ucyAqLwoJCQkJX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QoIG9TZXR0aW5ncywgbkNhbGNUbXAgKTsKCQkJCQoJCQkJLyogUmVhZCB0aGUgd2lkdGgncyBjYWxjdWxhdGVkIGJ5IHRoZSBicm93c2VyIGFuZCBzdG9yZSB0aGVtIGZvciB1c2UgYnkgdGhlIGNhbGxlci4gV2UKCQkJCSAqIGZpcnN0IG9mIGFsbCB0cnkgdG8gdXNlIHRoZSBlbGVtZW50cyBpbiB0aGUgYm9keSwgYnV0IGl0IGlzIHBvc3NpYmxlIHRoYXQgdGhlcmUgYXJlCgkJCQkgKiBubyBlbGVtZW50cyB0aGVyZSwgdW5kZXIgd2hpY2ggY2lyY3Vtc3RhbmNlcyB3ZSB1c2UgdGhlIGhlYWRlciBlbGVtZW50cwoJCQkJICovCgkJCQl2YXIgb05vZGVzID0gJCgidGJvZHkgdHI6ZXEoMCkiLCBuQ2FsY1RtcCkuY2hpbGRyZW4oKTsKCQkJCWlmICggb05vZGVzLmxlbmd0aCA9PT0gMCApCgkJCQl7CgkJCQkJb05vZGVzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsICQoJ3RoZWFkJywgbkNhbGNUbXApWzBdICk7CgkJCQl9CgkJCgkJCQkvKiBCcm93c2VycyBuZWVkIGEgYml0IG9mIGEgaGFuZCB3aGVuIGEgd2lkdGggaXMgYXNzaWduZWQgdG8gYW55IGNvbHVtbnMgd2hlbiAKCQkJCSAqIHgtc2Nyb2xsaW5nIGFzIHRoZXkgdGVuZCB0byBjb2xsYXBzZSB0aGUgdGFibGUgdG8gdGhlIG1pbi13aWR0aCwgZXZlbiBpZgoJCQkJICogd2Ugc2VudCB0aGUgY29sdW1uIHdpZHRocy4gU28gd2UgbmVlZCB0byBrZWVwIHRyYWNrIG9mIHdoYXQgdGhlIHRhYmxlIHdpZHRoCgkJCQkgKiBzaG91bGQgYmUgYnkgc3VtbWluZyB0aGUgdXNlciBnaXZlbiB2YWx1ZXMsIGFuZCB0aGUgYXV0b21hdGljIHZhbHVlcwoJCQkJICovCgkJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCQl7CgkJCQkJdmFyIGlUb3RhbCA9IDA7CgkJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoT3JpZyA9PT0gbnVsbCApCgkJCQkJCQl7CgkJCQkJCQkJaVRvdGFsICs9ICQob05vZGVzW2lDb3JyZWN0b3JdKS5vdXRlcldpZHRoKCk7CgkJCQkJCQl9CgkJCQkJCQllbHNlCgkJCQkJCQl7CgkJCQkJCQkJaVRvdGFsICs9IHBhcnNlSW50KG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoLnJlcGxhY2UoJ3B4JywnJyksIDEwKSArCgkJCQkJCQkJCSgkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkub3V0ZXJXaWR0aCgpIC0gJChvTm9kZXNbaUNvcnJlY3Rvcl0pLndpZHRoKCkpOwoJCQkJCQkJfQoJCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUb3RhbCApOwoJCQkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRvdGFsICk7CgkJCQl9CgkJCgkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlpV2lkdGggPSAkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkud2lkdGgoKTsKCQkJCQkJaWYgKCBpV2lkdGggIT09IG51bGwgJiYgaVdpZHRoID4gMCApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlXaWR0aCApOwoJCQkJCQl9CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCgkJCQl2YXIgY3NzV2lkdGggPSAkKG5DYWxjVG1wKS5jc3MoJ3dpZHRoJyk7CgkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gKGNzc1dpZHRoLmluZGV4T2YoJyUnKSAhPT0gLTEpID8KCQkJCSAgICBjc3NXaWR0aCA6IF9mblN0cmluZ1RvQ3NzKCAkKG5DYWxjVG1wKS5vdXRlcldpZHRoKCkgKTsKCQkJCW5DYWxjVG1wLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5DYWxjVG1wICk7CgkJCX0KCQkKCQkJaWYgKCB3aWR0aEF0dHIgKQoJCQl7CgkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHdpZHRoQXR0ciApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkanVzdCBhIHRhYmxlJ3Mgd2lkdGggdG8gdGFrZSBhY2NvdW50IG9mIHNjcm9sbGluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0YWJsZSBub2RlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0ICggb1NldHRpbmdzLCBuICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCS8qIFdoZW4geS1zY3JvbGxpbmcgb25seSwgd2Ugd2FudCB0byByZW1vdmUgdGhlIHdpZHRoIG9mIHRoZSBzY3JvbGwgYmFyIHNvIHRoZSB0YWJsZQoJCQkJICogKyBzY3JvbGwgYmFyIHdpbGwgZml0IGludG8gdGhlIGFyZWEgYXZhaWFsYmxlLgoJCQkJICovCgkJCQl2YXIgaU9yaWdXaWR0aCA9ICQobikud2lkdGgoKTsKCQkJCW4uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJChuKS5vdXRlcldpZHRoKCktb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCXsKCQkJCS8qIFdoZW4geC1zY3JvbGxpbmcgYm90aCB3YXlzLCBmaXggdGhlIHRhYmxlIGF0IGl0J3MgY3VycmVudCBzaXplLCB3aXRob3V0IGFkanVzdGluZyAqLwoJCQkJbi5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG4pLm91dGVyV2lkdGgoKSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgd2lkZXN0IG5vZGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gb2YgaW50ZXJlc3QKCQkgKiAgQHJldHVybnMge3N0cmluZ30gbWF4IHN0cmluZyBsZW5ndGggZm9yIGVhY2ggY29sdW1uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFdpZGVzdE5vZGUoIG9TZXR0aW5ncywgaUNvbCApCgkJewoJCQl2YXIgaU1heEluZGV4ID0gX2ZuR2V0TWF4TGVuU3RyaW5nKCBvU2V0dGluZ3MsIGlDb2wgKTsKCQkJaWYgKCBpTWF4SW5kZXggPCAwICkKCQkJewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCQkKCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2lNYXhJbmRleF0ublRyID09PSBudWxsICkKCQkJewoJCQkJdmFyIG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwoJCQkJbi5pbm5lckhUTUwgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpTWF4SW5kZXgsIGlDb2wsICcnICk7CgkJCQlyZXR1cm4gbjsKCQkJfQoJCQlyZXR1cm4gX2ZuR2V0VGROb2RlcyhvU2V0dGluZ3MsIGlNYXhJbmRleClbaUNvbF07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbWF4aW11bSBzdHJsZW4gZm9yIGVhY2ggZGF0YSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gb2YgaW50ZXJlc3QKCQkgKiAgQHJldHVybnMge3N0cmluZ30gbWF4IHN0cmluZyBsZW5ndGggZm9yIGVhY2ggY29sdW1uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldE1heExlblN0cmluZyggb1NldHRpbmdzLCBpQ29sICkKCQl7CgkJCXZhciBpTWF4ID0gLTE7CgkJCXZhciBpTWF4SW5kZXggPSAtMTsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJdmFyIHMgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBpQ29sLCAnZGlzcGxheScgKSsiIjsKCQkJCXMgPSBzLnJlcGxhY2UoIC88Lio/Pi9nLCAiIiApOwoJCQkJaWYgKCBzLmxlbmd0aCA+IGlNYXggKQoJCQkJewoJCQkJCWlNYXggPSBzLmxlbmd0aDsKCQkJCQlpTWF4SW5kZXggPSBpOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gaU1heEluZGV4OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBlbmQgYSBDU1MgdW5pdCAob25seSBpZiByZXF1aXJlZCkgdG8gYSBzdHJpbmcKCQkgKiAgQHBhcmFtIHthcnJheX0gYUFycmF5MSBmaXJzdCBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJyYXkyIHNlY29uZCBhcnJheQoJCSAqICBAcmV0dXJucyB7aW50fSAwIGlmIG1hdGNoLCAxIGlmIGxlbmd0aCBpcyBkaWZmZXJlbnQsIDIgaWYgbm8gbWF0Y2gKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU3RyaW5nVG9Dc3MoIHMgKQoJCXsKCQkJaWYgKCBzID09PSBudWxsICkKCQkJewoJCQkJcmV0dXJuICIwcHgiOwoJCQl9CgkJCQoJCQlpZiAoIHR5cGVvZiBzID09ICdudW1iZXInICkKCQkJewoJCQkJaWYgKCBzIDwgMCApCgkJCQl7CgkJCQkJcmV0dXJuICIwcHgiOwoJCQkJfQoJCQkJcmV0dXJuIHMrInB4IjsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgaWYgdGhlIGxhc3QgY2hhcmFjdGVyIGlzIG5vdCAwLTkgKi8KCQkJdmFyIGMgPSBzLmNoYXJDb2RlQXQoIHMubGVuZ3RoLTEgKTsKCQkJaWYgKGMgPCAweDMwIHx8IGMgPiAweDM5KQoJCQl7CgkJCQlyZXR1cm4gczsKCQkJfQoJCQlyZXR1cm4gcysicHgiOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHdpZHRoIG9mIGEgc2Nyb2xsIGJhciBpbiB0aGlzIGJyb3dzZXIgYmVpbmcgdXNlZAoJCSAqICBAcmV0dXJucyB7aW50fSB3aWR0aCBpbiBwaXhlbHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2Nyb2xsQmFyV2lkdGggKCkKCQl7ICAKCQkJdmFyIGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOwoJCQl2YXIgc3R5bGUgPSBpbm5lci5zdHlsZTsKCQkJc3R5bGUud2lkdGggPSAiMTAwJSI7CgkJCXN0eWxlLmhlaWdodCA9ICIyMDBweCI7CgkJCXN0eWxlLnBhZGRpbmcgPSAiMHB4IjsKCQkJCgkJCXZhciBvdXRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlzdHlsZSA9IG91dGVyLnN0eWxlOwoJCQlzdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CgkJCXN0eWxlLnRvcCA9ICIwcHgiOwoJCQlzdHlsZS5sZWZ0ID0gIjBweCI7CgkJCXN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKCQkJc3R5bGUud2lkdGggPSAiMjAwcHgiOwoJCQlzdHlsZS5oZWlnaHQgPSAiMTUwcHgiOwoJCQlzdHlsZS5wYWRkaW5nID0gIjBweCI7CgkJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJCW91dGVyLmFwcGVuZENoaWxkKGlubmVyKTsKCQkJCgkJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3V0ZXIpOwoJCQl2YXIgdzEgPSBpbm5lci5vZmZzZXRXaWR0aDsKCQkJb3V0ZXIuc3R5bGUub3ZlcmZsb3cgPSAnc2Nyb2xsJzsKCQkJdmFyIHcyID0gaW5uZXIub2Zmc2V0V2lkdGg7CgkJCWlmICggdzEgPT0gdzIgKQoJCQl7CgkJCQl3MiA9IG91dGVyLmNsaWVudFdpZHRoOwoJCQl9CgkJCQoJCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG91dGVyKTsKCQkJcmV0dXJuICh3MSAtIHcyKTsgIAoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIG9yZGVyIG9mIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7Ym9vbH0gYkFwcGx5Q2xhc3NlcyBvcHRpb25hbCAtIHNob3VsZCB3ZSBhcHBseSBjbGFzc2VzIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Tb3J0ICggb1NldHRpbmdzLCBiQXBwbHlDbGFzc2VzICkKCQl7CgkJCXZhcgoJCQkJaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbiwKCQkJCXNEYXRhVHlwZSwgblRoLAoJCQkJYWFTb3J0ID0gW10sCgkJCSAJYWlPcmlnID0gW10sCgkJCQlvU29ydCA9IERhdGFUYWJsZS5leHQub1NvcnQsCgkJCQlhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhLAoJCQkJYW9Db2x1bW5zID0gb1NldHRpbmdzLmFvQ29sdW1ucywKCQkJCW9BcmlhID0gb1NldHRpbmdzLm9MYW5ndWFnZS5vQXJpYTsKCQkJCgkJCS8qIE5vIHNvcnRpbmcgcmVxdWlyZWQgaWYgc2VydmVyLXNpZGUgb3Igbm8gc29ydGluZyBhcnJheSAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICYmIAoJCQkJKG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoICE9PSAwIHx8IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCkgKQoJCQl7CgkJCQlhYVNvcnQgPSAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApID8KCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICkgOgoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJCQoJCQkJLyogSWYgdGhlcmUgaXMgYSBzb3J0aW5nIGRhdGEgdHlwZSwgYW5kIGEgZnVuY3Rpb24gYmVsb25naW5nIHRvIGl0LCB0aGVuIHdlIG5lZWQgdG8KCQkJCSAqIGdldCB0aGUgZGF0YSBmcm9tIHRoZSBkZXZlbG9wZXIncyBmdW5jdGlvbiBhbmQgYXBwbHkgaXQgZm9yIHRoaXMgY29sdW1uCgkJCQkgKi8KCQkJCWZvciAoIGk9MCA7IGk8YWFTb3J0Lmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIGlDb2x1bW4gPSBhYVNvcnRbaV1bMF07CgkJCQkJdmFyIGlWaXNDb2x1bW4gPSBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSggb1NldHRpbmdzLCBpQ29sdW1uICk7CgkJCQkJc0RhdGFUeXBlID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbHVtbiBdLnNTb3J0RGF0YVR5cGU7CgkJCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmblNvcnREYXRhW3NEYXRhVHlwZV0gKQoJCQkJCXsKCQkJCQkJdmFyIGFEYXRhID0gRGF0YVRhYmxlLmV4dC5hZm5Tb3J0RGF0YVtzRGF0YVR5cGVdLmNhbGwoIAoJCQkJCQkJb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLCBpQ29sdW1uLCBpVmlzQ29sdW1uCgkJCQkJCSk7CgkJCQkJCWlmICggYURhdGEubGVuZ3RoID09PSBhb0RhdGEubGVuZ3RoICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPWFvRGF0YS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGosIGlDb2x1bW4sIGFEYXRhW2pdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJldHVybmVkIGRhdGEgc29ydCBhcnJheSAoY29sICIraUNvbHVtbisiKSBpcyB0aGUgd3JvbmcgbGVuZ3RoIiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBDcmVhdGUgYSB2YWx1ZSAtIGtleSBhcnJheSBvZiB0aGUgY3VycmVudCByb3cgcG9zaXRpb25zIHN1Y2ggdGhhdCB3ZSBjYW4gdXNlIHRoZWlyCgkJCQkgKiBjdXJyZW50IHBvc2l0aW9uIGR1cmluZyB0aGUgc29ydCwgaWYgdmFsdWVzIG1hdGNoLCBpbiBvcmRlciB0byBwZXJmb3JtIHN0YWJsZSBzb3J0aW5nCgkJCQkgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYWlPcmlnWyBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyW2ldIF0gPSBpOwoJCQkJfQoJCQoJCQkJLyogQnVpbGQgYW4gaW50ZXJuYWwgZGF0YSBhcnJheSB3aGljaCBpcyBzcGVjaWZpYyB0byB0aGUgc29ydCwgc28gd2UgY2FuIGdldCBhbmQgcHJlcAoJCQkJICogdGhlIGRhdGEgdG8gYmUgc29ydGVkIG9ubHkgb25jZSwgcmF0aGVyIHRoYW4gbmVlZGluZyB0byBkbyBpdCBldmVyeSB0aW1lIHRoZSBzb3J0aW5nCgkJCQkgKiBmdW5jdGlvbiBydW5zLiBUaGlzIG1ha2UgdGhlIHNvcnRpbmcgZnVuY3Rpb24gYSB2ZXJ5IHNpbXBsZSBjb21wYXJpc29uCgkJCQkgKi8KCQkJCXZhciBpU29ydExlbiA9IGFhU29ydC5sZW5ndGg7CgkJCQl2YXIgZm5Tb3J0Rm9ybWF0LCBhRGF0YVNvcnQ7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJZm9yICggaj0wIDsgajxpU29ydExlbiA7IGorKyApCgkJCQkJewoJCQkJCQlhRGF0YVNvcnQgPSBhb0NvbHVtbnNbIGFhU29ydFtqXVswXSBdLmFEYXRhU29ydDsKCQkKCQkJCQkJZm9yICggaz0wLCBrTGVuPWFEYXRhU29ydC5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlzRGF0YVR5cGUgPSBhb0NvbHVtbnNbIGFEYXRhU29ydFtrXSBdLnNUeXBlOwoJCQkJCQkJZm5Tb3J0Rm9ybWF0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi1wcmUiIF07CgkJCQkJCQkKCQkJCQkJCWFvRGF0YVtpXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRba10gXSA9IGZuU29ydEZvcm1hdCA/CgkJCQkJCQkJZm5Tb3J0Rm9ybWF0KCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBhRGF0YVNvcnRba10sICdzb3J0JyApICkgOgoJCQkJCQkJCV9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGksIGFEYXRhU29ydFtrXSwgJ3NvcnQnICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIERvIHRoZSBzb3J0IC0gaGVyZSB3ZSB3YW50IG11bHRpLWNvbHVtbiBzb3J0aW5nIGJhc2VkIG9uIGEgZ2l2ZW4gZGF0YSBzb3VyY2UgKGNvbHVtbikKCQkJCSAqIGFuZCBzb3J0aW5nIGZ1bmN0aW9uIChmcm9tIG9Tb3J0KSBpbiBhIGNlcnRhaW4gZGlyZWN0aW9uLiBJdCdzIHJlYXNvbmFibHkgY29tcGxleCB0bwoJCQkJICogZm9sbG93IG9uIGl0J3Mgb3duLCBidXQgdGhpcyBpcyB3aGF0IHdlIHdhbnQgKGV4YW1wbGUgdHdvIGNvbHVtbiBzb3J0aW5nKToKCQkJCSAqICBmbkxvY2FsU29ydGluZyA9IGZ1bmN0aW9uKGEsYil7CgkJCQkgKiAgCXZhciBpVGVzdDsKCQkJCSAqICAJaVRlc3QgPSBvU29ydFsnc3RyaW5nLWFzYyddKCdkYXRhMTEnLCAnZGF0YTEyJyk7CgkJCQkgKiAgCWlmIChpVGVzdCAhPT0gMCkKCQkJCSAqICAJCXJldHVybiBpVGVzdDsKCQkJCSAqICAgIGlUZXN0ID0gb1NvcnRbJ251bWVyaWMtZGVzYyddKCdkYXRhMjEnLCAnZGF0YTIyJyk7CgkJCQkgKiAgICBpZiAoaVRlc3QgIT09IDApCgkJCQkgKiAgCQlyZXR1cm4gaVRlc3Q7CgkJCQkgKiAgCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCSAqICB9CgkJCQkgKiBCYXNpY2FsbHkgd2UgaGF2ZSBhIHRlc3QgZm9yIGVhY2ggc29ydGluZyBjb2x1bW4sIGlmIHRoZSBkYXRhIGluIHRoYXQgY29sdW1uIGlzIGVxdWFsLAoJCQkJICogdGVzdCB0aGUgbmV4dCBjb2x1bW4uIElmIGFsbCBjb2x1bW5zIG1hdGNoLCB0aGVuIHdlIHVzZSBhIG51bWVyaWMgc29ydCBvbiB0aGUgcm93IAoJCQkJICogcG9zaXRpb25zIGluIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5IHRvIHByb3ZpZGUgYSBzdGFibGUgc29ydC4KCQkJCSAqLwoJCQkJb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zb3J0KCBmdW5jdGlvbiAoIGEsIGIgKSB7CgkJCQkJdmFyIGssIGwsIGxMZW4sIGlUZXN0LCBhRGF0YVNvcnQsIHNEYXRhVHlwZTsKCQkJCQlmb3IgKCBrPTAgOyBrPGlTb3J0TGVuIDsgaysrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydCA9IGFvQ29sdW1uc1sgYWFTb3J0W2tdWzBdIF0uYURhdGFTb3J0OwoJCQoJCQkJCQlmb3IgKCBsPTAsIGxMZW49YURhdGFTb3J0Lmxlbmd0aCA7IGw8bExlbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCXNEYXRhVHlwZSA9IGFvQ29sdW1uc1sgYURhdGFTb3J0W2xdIF0uc1R5cGU7CgkJCQkJCQkKCQkJCQkJCWlUZXN0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi0iK2FhU29ydFtrXVsxXSBdKAoJCQkJCQkJCWFvRGF0YVthXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRbbF0gXSwKCQkJCQkJCQlhb0RhdGFbYl0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2xdIF0KCQkJCQkJCSk7CgkJCQkJCQoJCQkJCQkJaWYgKCBpVGVzdCAhPT0gMCApCgkJCQkJCQl7CgkJCQkJCQkJcmV0dXJuIGlUZXN0OwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWx0ZXIgdGhlIHNvcnRpbmcgY2xhc3NlcyB0byB0YWtlIGFjY291bnQgb2YgdGhlIGNoYW5nZXMgKi8KCQkJaWYgKCAoYkFwcGx5Q2xhc3NlcyA9PT0gdW5kZWZpbmVkIHx8IGJBcHBseUNsYXNzZXMpICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgc1RpdGxlID0gYW9Db2x1bW5zW2ldLnNUaXRsZS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJCW5UaCA9IGFvQ29sdW1uc1tpXS5uVGg7CgkJCQluVGgucmVtb3ZlQXR0cmlidXRlKCdhcmlhLXNvcnQnKTsKCQkJCW5UaC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKTsKCQkJCQoJCQkJLyogSW4gQVJJQSBvbmx5IHRoZSBmaXJzdCBzb3J0aW5nIGNvbHVtbiBjYW4gYmUgbWFya2VkIGFzIHNvcnRpbmcgLSBubyBtdWx0aS1zb3J0IG9wdGlvbiAqLwoJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCXsKCQkJCQlpZiAoIGFhU29ydC5sZW5ndGggPiAwICYmIGFhU29ydFswXVswXSA9PSBpICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc29ydCcsIGFhU29ydFswXVsxXT09ImFzYyIgPyAiYXNjZW5kaW5nIiA6ICJkZXNjZW5kaW5nIiApOwoJCQkJCQkKCQkJCQkJdmFyIG5leHRTb3J0ID0gKGFvQ29sdW1uc1tpXS5hc1NvcnRpbmdbIGFhU29ydFswXVsyXSsxIF0pID8gCgkJCQkJCQlhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWyBhYVNvcnRbMF1bMl0rMSBdIDogYW9Db2x1bW5zW2ldLmFzU29ydGluZ1swXTsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShuZXh0U29ydD09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWzBdPT0iYXNjIiA/IG9BcmlhLnNTb3J0QXNjZW5kaW5nIDogb0FyaWEuc1NvcnREZXNjZW5kaW5nKSApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgc1RpdGxlKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogVGVsbCB0aGUgZHJhdyBmdW5jdGlvbiB0aGF0IHdlIGhhdmUgc29ydGVkIHRoZSBkYXRhICovCgkJCW9TZXR0aW5ncy5iU29ydGVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdzb3J0Jywgb1NldHRpbmdzKTsKCQkJCgkJCS8qIENvcHkgdGhlIG1hc3RlciBkYXRhIGludG8gdGhlIGRyYXcgYXJyYXkgYW5kIHJlLWRyYXcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQkvKiBfZm5GaWx0ZXIoKSB3aWxsIHJlZHJhdyB0aGUgdGFibGUgZm9yIHVzICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsgLyogcmVzZXQgZGlzcGxheSBiYWNrIHRvIHBhZ2UgMCAqLwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGFjaCBhIHNvcnQgaGFuZGxlciAoY2xpY2spIHRvIGEgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgbm9kZSB0byBhdHRhY2ggdGhlIGhhbmRsZXIgdG8KCQkgKiAgQHBhcmFtIHtpbnR9IGlEYXRhSW5kZXggY29sdW1uIHNvcnRpbmcgaW5kZXgKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRBdHRhY2hMaXN0ZW5lciAoIG9TZXR0aW5ncywgbk5vZGUsIGlEYXRhSW5kZXgsIGZuQ2FsbGJhY2sgKQoJCXsKCQkJX2ZuQmluZEFjdGlvbiggbk5vZGUsIHt9LCBmdW5jdGlvbiAoZSkgewoJCQkJLyogSWYgdGhlIGNvbHVtbiBpcyBub3Qgc29ydGFibGUgLSBkb24ndCB0byBhbnl0aGluZyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmJTb3J0YWJsZSA9PT0gZmFsc2UgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJLyoKCQkJCSAqIFRoaXMgaXMgYSBsaXR0bGUgYml0IG9kZCBJIGFkbWl0Li4uIEkgZGVjbGFyZSBhIHRlbXBvcmFyeSBmdW5jdGlvbiBpbnNpZGUgdGhlIHNjb3BlIG9mCgkJCQkgKiBfZm5CdWlsZEhlYWQgYW5kIHRoZSBjbGljayBoYW5kbGVyIGluIG9yZGVyIHRoYXQgdGhlIGNvZGUgcHJlc2VudGVkIGhlcmUgY2FuIGJlIHVzZWQgCgkJCQkgKiB0d2ljZSAtIG9uY2UgZm9yIHdoZW4gYlByb2Nlc3NpbmcgaXMgZW5hYmxlZCwgYW5kIGFub3RoZXIgdGltZSBmb3Igd2hlbiBpdCBpcyAKCQkJCSAqIGRpc2FibGVkLCBhcyB3ZSBuZWVkIHRvIHBlcmZvcm0gc2xpZ2h0bHkgZGlmZmVyZW50IGFjdGlvbnMuCgkJCQkgKiAgIEJhc2ljYWxseSB0aGUgaXNzdWUgaGVyZSBpcyB0aGF0IHRoZSBKYXZhc2NyaXB0IGVuZ2luZSBpbiBtb2Rlcm4gYnJvd3NlcnMgZG9uJ3QgCgkJCQkgKiBhcHBlYXIgdG8gYWxsb3cgdGhlIHJlbmRlcmluZyBlbmdpbmUgdG8gdXBkYXRlIHRoZSBkaXNwbGF5IHdoaWxlIGl0IGlzIHN0aWxsIGV4ZWN1dGluZwoJCQkJICogaXQncyB0aHJlYWQgKHdlbGwgLSBpdCBkb2VzIGJ1dCBvbmx5IGFmdGVyIGxvbmcgaW50ZXJ2YWxzKS4gVGhpcyBtZWFucyB0aGF0IHRoZSAKCQkJCSAqICdwcm9jZXNzaW5nJyBkaXNwbGF5IGRvZXNuJ3QgYXBwZWFyIGZvciBhIHRhYmxlIHNvcnQuIFRvIGJyZWFrIHRoZSBqcyB0aHJlYWQgdXAgYSBiaXQKCQkJCSAqIEkgZm9yY2UgYW4gZXhlY3V0aW9uIGJyZWFrIGJ5IHVzaW5nIHNldFRpbWVvdXQgLSBidXQgdGhpcyBicmVha3MgdGhlIGV4cGVjdGVkIAoJCQkJICogdGhyZWFkIGNvbnRpbnVhdGlvbiBmb3IgdGhlIGVuZC1kZXZlbG9wZXIncyBwb2ludCBvZiB2aWV3ICh0aGVpciBjb2RlIHdvdWxkIGV4ZWN1dGUKCQkJCSAqIHRvbyBlYXJseSksIHNvIHdlIG9ubHkgZG8gaXQgd2hlbiB3ZSBhYnNvbHV0ZWx5IGhhdmUgdG8uCgkJCQkgKi8KCQkJCXZhciBmbklubmVyU29ydGluZyA9IGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIgaUNvbHVtbiwgaU5leHRTb3J0OwoJCQkJCQoJCQkJCS8qIElmIHRoZSBzaGlmdCBrZXkgaXMgcHJlc3NlZCB0aGVuIHdlIGFyZSBtdWx0aXBsZSBjb2x1bW4gc29ydGluZyAqLwoJCQkJCWlmICggZS5zaGlmdEtleSApCgkJCQkJewoJCQkJCQkvKiBBcmUgd2UgYWxyZWFkeSBkb2luZyBzb21lIGtpbmQgb2Ygc29ydCBvbiB0aGlzIGNvbHVtbj8gKi8KCQkJCQkJdmFyIGJGb3VuZCA9IGZhbHNlOwoJCQkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA9PSBpRGF0YUluZGV4ICkKCQkJCQkJCXsKCQkJCQkJCQliRm91bmQgPSB0cnVlOwoJCQkJCQkJCWlDb2x1bW4gPSBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdOwoJCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0rMTsKCQkJCQkJCQkKCQkJCQkJCQlpZiAoICFvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmFzU29ydGluZ1tpTmV4dFNvcnRdICkKCQkJCQkJCQl7CgkJCQkJCQkJCS8qIFJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgc29ydGluZyBvcHRpb25zLCByZW1vdmUgZnJvbSBtdWx0aS1jb2wgc29ydCAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggaSwgMSApOwoJCQkJCQkJCX0KCQkJCQkJCQllbHNlCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBNb3ZlIG9udG8gbmV4dCBzb3J0aW5nIGRpcmVjdGlvbiAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGlOZXh0U29ydDsKCQkJCQkJCQl9CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIE5vIHNvcnQgeWV0IC0gYWRkIGl0IGluICovCgkJCQkJCWlmICggYkZvdW5kID09PSBmYWxzZSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJLyogSWYgbm8gc2hpZnQga2V5IHRoZW4gc2luZ2xlIGNvbHVtbiBzb3J0ICovCgkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggPT0gMSAmJiBvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzBdID09IGlEYXRhSW5kZXggKQoJCQkJCQl7CgkJCQkJCQlpQ29sdW1uID0gb1NldHRpbmdzLmFhU29ydGluZ1swXVswXTsKCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0rMTsKCQkJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF0gKQoJCQkJCQkJewoJCQkJCQkJCWlOZXh0U29ydCA9IDA7CgkJCQkJCQl9CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0gPSBpTmV4dFNvcnQ7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggMCwgb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggKTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJLyogUnVuIHRoZSBzb3J0ICovCgkJCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJCQl9OyAvKiAvZm5Jbm5lclNvcnRpbmcgKi8KCQkJCQoJCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCQl7CgkJCQkJZm5Jbm5lclNvcnRpbmcoKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQkJc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJCWZuSW5uZXJTb3J0aW5nKCk7CgkJCQkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJCQl7CgkJCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJCQl9CgkJCQkJfSwgMCApOwoJCQkJfQoJCQkJCgkJCQkvKiBDYWxsIHRoZSB1c2VyIHNwZWNpZmllZCBjYWxsYmFjayBmdW5jdGlvbiAtIHVzZWQgZm9yIGFzeW5jIHVzZXIgaW50ZXJhY3Rpb24gKi8KCQkJCWlmICggdHlwZW9mIGZuQ2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJyApCgkJCQl7CgkJCQkJZm5DYWxsYmFjayggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogU2V0IHRoZSBzb3J0aW5nIGNsYXNzZXMgb24gdGhlIGhlYWRlciwgTm90ZTogaXQgaXMgc2FmZSB0byBjYWxsIHRoaXMgZnVuY3Rpb24gCgkJICogd2hlbiBiU29ydCBhbmQgYlNvcnRDbGFzc2VzIGFyZSBmYWxzZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGosIGpMZW4sIGlGb3VuZDsKCQkJdmFyIGFhU29ydCwgc0NsYXNzOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkKCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zU29ydEFzYyArIiAiKyBvQ2xhc3Nlcy5zU29ydERlc2MgKwoJCQkJCQkiICIrIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzcyApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZC5jb25jYXQoIG9TZXR0aW5ncy5hYVNvcnRpbmcgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJfQoJCQkKCQkJLyogQXBwbHkgdGhlIHJlcXVpcmVkIGNsYXNzZXMgdG8gdGhlIGhlYWRlciAqLwoJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQl7CgkJCQkJc0NsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzOwoJCQkJCWlGb3VuZCA9IC0xOwoJCQkJCWZvciAoIGo9MCA7IGo8YWFTb3J0Lmxlbmd0aCA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIGFhU29ydFtqXVswXSA9PSBpICkKCQkJCQkJewoJCQkJCQkJc0NsYXNzID0gKCBhYVNvcnRbal1bMV0gPT0gImFzYyIgKSA/CgkJCQkJCQkJb0NsYXNzZXMuc1NvcnRBc2MgOiBvQ2xhc3Nlcy5zU29ydERlc2M7CgkJCQkJCQlpRm91bmQgPSBqOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIHNDbGFzcyApOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQkJCXsKCQkJCQkJLyogalF1ZXJ5IFVJIHVzZXMgZXh0cmEgbWFya3VwICovCgkJCQkJCXZhciBqcVNwYW4gPSAkKCJzcGFuLiIrb0NsYXNzZXMuc1NvcnRJY29uLCAgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpOwoJCQkJCQlqcVNwYW4ucmVtb3ZlQ2xhc3Mob0NsYXNzZXMuc1NvcnRKVUlBc2MgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlEZXNjICsiICIrIAoJCQkJCQkJb0NsYXNzZXMuc1NvcnRKVUkgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlBc2NBbGxvd2VkICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQgKTsKCQkJCQkJCgkJCQkJCXZhciBzU3BhbkNsYXNzOwoJCQkJCQlpZiAoIGlGb3VuZCA9PSAtMSApCgkJCQkJCXsKCQkJCQkJIAlzU3BhbkNsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzSlVJOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBhYVNvcnRbaUZvdW5kXVsxXSA9PSAiYXNjIiApCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSUFzYzsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSURlc2M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCWpxU3Bhbi5hZGRDbGFzcyggc1NwYW5DbGFzcyApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQkvKiBObyBzb3J0aW5nIG9uIHRoaXMgY29sdW1uLCBzbyBhZGQgdGhlIGJhc2UgY2xhc3MuIFRoaXMgd2lsbCBoYXZlIGJlZW4gYXNzaWduZWQgYnkKCQkJCQkgKiBfZm5BZGRDb2x1bW4KCQkJCQkgKi8KCQkJCQkkKG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIAoJCQkgKiBBcHBseSB0aGUgcmVxdWlyZWQgY2xhc3NlcyB0byB0aGUgdGFibGUgYm9keQoJCQkgKiBOb3RlIHRoYXQgdGhpcyBpcyBnaXZlbiBhcyBhIGZlYXR1cmUgc3dpdGNoIHNpbmNlIGl0IGNhbiBzaWduaWZpY2FudGx5IHNsb3cgZG93biBhIHNvcnQKCQkJICogb24gbGFyZ2UgZGF0YSBzZXRzIChhZGRpbmcgYW5kIHJlbW92aW5nIG9mIGNsYXNzZXMgaXMgYWx3YXlzIHNsb3cgYXQgdGhlIGJlc3Qgb2YgdGltZXMuLikKCQkJICogRnVydGhlciB0byB0aGlzLCBub3RlIHRoYXQgdGhpcyBjb2RlIGlzIGFkbWl0dGVkbHkgZmFpcmx5IHVnbHkuIEl0IGNvdWxkIGJlIG1hZGUgYSBsb3QgCgkJCSAqIHNpbXBsZXIgdXNpbmcgalF1ZXJ5IHNlbGVjdG9ycyBhbmQgYWRkL3JlbW92ZUNsYXNzLCBidXQgdGhhdCBpcyBzaWduaWZpY2FudGx5IHNsb3dlcgoJCQkgKiAob24gdGhlIG9yZGVyIG9mIDUgdGltZXMgc2xvd2VyKSAtIGhlbmNlIHRoZSBkaXJlY3QgRE9NIG1hbmlwdWxhdGlvbiBoZXJlLgoJCQkgKiBOb3RlIHRoYXQgZm9yIGRlZmVycmVkIGRyYXdpbmcgd2UgZG8gdXNlIGpRdWVyeSAtIHRoZSByZWFzb24gYmVpbmcgdGhhdCB0YWtpbmcgdGhlIGZpcnN0CgkJCSAqIHJvdyBmb3VuZCB0byBzZWUgaWYgdGhlIHdob2xlIGNvbHVtbiBuZWVkcyBwcm9jZXNzZWQgY2FuIG1pc3MgY2xhc3NlcyBzaW5jZSB0aGUgZmlyc3QKCQkJICogY29sdW1uIG1pZ2h0IGJlIG5ldy4KCQkJICovCgkJCXNDbGFzcyA9IG9DbGFzc2VzLnNTb3J0Q29sdW1uOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnRDbGFzc2VzICkKCQkJewoJCQkJdmFyIG5UZHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MgKTsKCQkKCQkJCS8qIFJlbW92ZSB0aGUgb2xkIGNsYXNzZXMgKi8KCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQkJewoJCQkJCSQoblRkcykucmVtb3ZlQ2xhc3Moc0NsYXNzKycxICcrc0NsYXNzKycyICcrc0NsYXNzKyczJyk7CgkJCQl9CgkJCQllbHNlIGlmICggblRkcy5sZW5ndGggPj0gaUNvbHVtbnMgKQoJCQkJewoJCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBuVGRzW2ldLmNsYXNzTmFtZS5pbmRleE9mKHNDbGFzcysiMSIpICE9IC0xICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPShuVGRzLmxlbmd0aC9pQ29sdW1ucykgOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCW5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZSA9IAoJCQkJCQkJCQkkLnRyaW0oIG5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZS5yZXBsYWNlKCBzQ2xhc3MrIjEiLCAiIiApICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIG5UZHNbaV0uY2xhc3NOYW1lLmluZGV4T2Yoc0NsYXNzKyIyIikgIT0gLTEgKQoJCQkJCQl7CgkJCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lID0gCgkJCQkJCQkJCSQudHJpbSggblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lLnJlcGxhY2UoIHNDbGFzcysiMiIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQllbHNlIGlmICggblRkc1tpXS5jbGFzc05hbWUuaW5kZXhPZihzQ2xhc3MrIjMiKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGo9MCwgakxlbj0oblRkcy5sZW5ndGgvaUNvbHVtbnMpIDsgajxqTGVuIDsgaisrICkKCQkJCQkJCXsKCQkJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUgPSAKCQkJCQkJCQkJJC50cmltKCBuVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUucmVwbGFjZSggIiAiK3NDbGFzcysiMyIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQWRkIHRoZSBuZXcgY2xhc3NlcyB0byB0aGUgdGFibGUgKi8KCQkJCXZhciBpQ2xhc3MgPSAxLCBpVGFyZ2V0Q29sOwoJCQkJZm9yICggaT0wIDsgaTxhYVNvcnQubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVGFyZ2V0Q29sID0gcGFyc2VJbnQoIGFhU29ydFtpXVswXSwgMTAgKTsKCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJewoJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpVGFyZ2V0Q29sXS5jbGFzc05hbWUgKz0gIiAiK3NDbGFzcytpQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggaUNsYXNzIDwgMyApCgkJCQkJewoJCQkJCQlpQ2xhc3MrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogU2F2ZSB0aGUgc3RhdGUgb2YgYSB0YWJsZSBpbiBhIGNvb2tpZSBzdWNoIHRoYXQgdGhlIHBhZ2UgY2FuIGJlIHJlbG9hZGVkCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2F2ZVN0YXRlICggb1NldHRpbmdzICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSB8fCBvU2V0dGluZ3MuYkRlc3Ryb3lpbmcgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkKCQkJLyogU3RvcmUgdGhlIGludGVyZXN0aW5nIHZhcmlhYmxlcyAqLwoJCQl2YXIgaSwgaUxlbiwgYkluZmluaXRlPW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZTsKCQkJdmFyIG9TdGF0ZSA9IHsKCQkJCSJpQ3JlYXRlIjogICAgICBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKCQkJCSJpU3RhcnQiOiAgICAgICAoYkluZmluaXRlID8gMCA6IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCksCgkJCQkiaUVuZCI6ICAgICAgICAgKGJJbmZpbml0ZSA/IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggOiBvU2V0dGluZ3MuX2lEaXNwbGF5RW5kKSwKCQkJCSJpTGVuZ3RoIjogICAgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoLAoJCQkJImFhU29ydGluZyI6ICAgICQuZXh0ZW5kKCB0cnVlLCBbXSwgb1NldHRpbmdzLmFhU29ydGluZyApLAoJCQkJIm9TZWFyY2giOiAgICAgICQuZXh0ZW5kKCB0cnVlLCB7fSwgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApLAoJCQkJImFvU2VhcmNoQ29scyI6ICQuZXh0ZW5kKCB0cnVlLCBbXSwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29scyApLAoJCQkJImFiVmlzQ29scyI6ICAgIFtdCgkJCX07CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9TdGF0ZS5hYlZpc0NvbHMucHVzaCggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApOwoJCQl9CgkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAiYW9TdGF0ZVNhdmVQYXJhbXMiLCAnc3RhdGVTYXZlUGFyYW1zJywgW29TZXR0aW5ncywgb1N0YXRlXSApOwoJCQkKCQkJb1NldHRpbmdzLmZuU3RhdGVTYXZlLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIG9TZXR0aW5ncywgb1N0YXRlICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGVtcHQgdG8gbG9hZCBhIHNhdmVkIHRhYmxlIHN0YXRlIGZyb20gYSBjb29raWUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0luaXQgRGF0YVRhYmxlcyBpbml0IG9iamVjdCBzbyB3ZSBjYW4gb3ZlcnJpZGUgc2V0dGluZ3MKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTG9hZFN0YXRlICggb1NldHRpbmdzLCBvSW5pdCApCgkJewoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTdGF0ZVNhdmUgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkKCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmZuU3RhdGVMb2FkLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIG9TZXR0aW5ncyApOwoJCQlpZiAoICFvRGF0YSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogQWxsb3cgY3VzdG9tIGFuZCBwbHVnLWluIG1hbmlwdWxhdGlvbiBmdW5jdGlvbnMgdG8gYWx0ZXIgdGhlIHNhdmVkIGRhdGEgc2V0IGFuZAoJCQkgKiBjYW5jZWxsaW5nIG9mIGxvYWRpbmcgYnkgcmV0dXJuaW5nIGZhbHNlCgkJCSAqLwoJCQl2YXIgYWJTdGF0ZUxvYWQgPSBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU3RhdGVMb2FkUGFyYW1zJywgJ3N0YXRlTG9hZFBhcmFtcycsIFtvU2V0dGluZ3MsIG9EYXRhXSApOwoJCQlpZiAoICQuaW5BcnJheSggZmFsc2UsIGFiU3RhdGVMb2FkICkgIT09IC0xICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBTdG9yZSB0aGUgc2F2ZWQgc3RhdGUgc28gaXQgbWlnaHQgYmUgYWNjZXNzZWQgYXQgYW55IHRpbWUgKi8KCQkJb1NldHRpbmdzLm9Mb2FkZWRTdGF0ZSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgb0RhdGEgKTsKCQkJCgkJCS8qIFJlc3RvcmUga2V5IGZlYXR1cmVzICovCgkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCAgICA9IG9EYXRhLmlTdGFydDsKCQkJb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID0gb0RhdGEuaVN0YXJ0OwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kICAgICAgPSBvRGF0YS5pRW5kOwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoICAgPSBvRGF0YS5pTGVuZ3RoOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nICAgICAgICAgPSBvRGF0YS5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJb1NldHRpbmdzLnNhdmVkX2FhU29ydGluZyAgID0gb0RhdGEuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCQoJCQkvKiBTZWFyY2ggZmlsdGVyaW5nICAqLwoJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCwgb0RhdGEub1NlYXJjaCApOwoJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29scywgb0RhdGEuYW9TZWFyY2hDb2xzICk7CgkJCQoJCQkvKiBDb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZQoJCQkgKiBQYXNzIGJhY2sgdmlzaWJpbGl0eSBzZXR0aW5ncyB0byB0aGUgaW5pdCBoYW5kbGVyLCBidXQgdG8gZG8gbm90IGhlcmUgb3ZlcnJpZGUKCQkJICogdGhlIGluaXQgb2JqZWN0IHRoYXQgdGhlIHVzZXIgbWlnaHQgaGF2ZSBwYXNzZWQgaW4KCQkJICovCgkJCW9Jbml0LnNhdmVkX2FvQ29sdW1ucyA9IFtdOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvRGF0YS5hYlZpc0NvbHMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJb0luaXQuc2F2ZWRfYW9Db2x1bW5zW2ldID0ge307CgkJCQlvSW5pdC5zYXZlZF9hb0NvbHVtbnNbaV0uYlZpc2libGUgPSBvRGF0YS5hYlZpc0NvbHNbaV07CgkJCX0KCQkKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZGVkJywgJ3N0YXRlTG9hZGVkJywgW29TZXR0aW5ncywgb0RhdGFdICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIG5ldyBjb29raWUgd2l0aCBhIHZhbHVlIHRvIHN0b3JlIHRoZSBzdGF0ZSBvZiBhIHRhYmxlCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBuYW1lIG9mIHRoZSBjb29raWUgdG8gY3JlYXRlCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmFsdWUgdGhlIHZhbHVlIHRoZSBjb29raWUgc2hvdWxkIHRha2UKCQkgKiAgQHBhcmFtIHtpbnR9IGlTZWNzIGR1cmF0aW9uIG9mIHRoZSBjb29raWUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNCYXNlTmFtZSBzTmFtZSBpcyBtYWRlIHVwIG9mIHRoZSBiYXNlICsgZmlsZSBuYW1lIC0gdGhpcyBpcyB0aGUgYmFzZQoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBmbkNhbGxiYWNrIFVzZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRvIG1vZGlmeSB0aGUgY29va2llCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNyZWF0ZUNvb2tpZSAoIHNOYW1lLCBzVmFsdWUsIGlTZWNzLCBzQmFzZU5hbWUsIGZuQ2FsbGJhY2sgKQoJCXsKCQkJdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwoJCQlkYXRlLnNldFRpbWUoIGRhdGUuZ2V0VGltZSgpKyhpU2VjcyoxMDAwKSApOwoJCQkKCQkJLyogCgkJCSAqIFNob2NraW5nIGJ1dCB0cnVlIC0gaXQgd291bGQgYXBwZWFyIElFIGhhcyBtYWpvciBpc3N1ZXMgd2l0aCBoYXZpbmcgdGhlIHBhdGggbm90IGhhdmluZwoJCQkgKiBhIHRyYWlsaW5nIHNsYXNoIG9uIGl0LiBXZSBuZWVkIHRoZSBjb29raWUgdG8gYmUgYXZhaWxhYmxlIGJhc2VkIG9uIHRoZSBwYXRoLCBzbyB3ZQoJCQkgKiBoYXZlIHRvIGFwcGVuZCB0aGUgZmlsZSBuYW1lIHRvIHRoZSBjb29raWUgbmFtZS4gQXBwYWxsaW5nLiBUaGFua3MgdG8gdmV4IGZvciBhZGRpbmcgdGhlCgkJCSAqIHBhdGNoIHRvIHVzZSBhdCBsZWFzdCBzb21lIG9mIHRoZSBwYXRoCgkJCSAqLwoJCQl2YXIgYVBhcnRzID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJyk7CgkJCXZhciBzTmFtZUZpbGUgPSBzTmFtZSArICdfJyArIGFQYXJ0cy5wb3AoKS5yZXBsYWNlKC9bXC86XS9nLCIiKS50b0xvd2VyQ2FzZSgpOwoJCQl2YXIgc0Z1bGxDb29raWUsIG9EYXRhOwoJCQkKCQkJaWYgKCBmbkNhbGxiYWNrICE9PSBudWxsICkKCQkJewoJCQkJb0RhdGEgPSAodHlwZW9mICQucGFyc2VKU09OID09PSAnZnVuY3Rpb24nKSA/IAoJCQkJCSQucGFyc2VKU09OKCBzVmFsdWUgKSA6IGV2YWwoICcoJytzVmFsdWUrJyknICk7CgkJCQlzRnVsbENvb2tpZSA9IGZuQ2FsbGJhY2soIHNOYW1lRmlsZSwgb0RhdGEsIGRhdGUudG9HTVRTdHJpbmcoKSwKCQkJCQlhUGFydHMuam9pbignLycpKyIvIiApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJc0Z1bGxDb29raWUgPSBzTmFtZUZpbGUgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQoc1ZhbHVlKSArCgkJCQkJIjsgZXhwaXJlcz0iICsgZGF0ZS50b0dNVFN0cmluZygpICsiOyBwYXRoPSIgKyBhUGFydHMuam9pbignLycpKyIvIjsKCQkJfQoJCQkKCQkJLyogQXJlIHdlIGdvaW5nIHRvIGdvIG92ZXIgdGhlIGNvb2tpZSBsaW1pdCBvZiA0S2lCPyBJZiBzbywgdHJ5IHRvIGRlbGV0ZSBhIGNvb2tpZXMKCQkJICogYmVsb25naW5nIHRvIERhdGFUYWJsZXMuIFRoaXMgaXMgRkFSIGZyb20gYnVsbGV0IHByb29mCgkJCSAqLwoJCQl2YXIgc09sZE5hbWU9IiIsIGlPbGRUaW1lPTk5OTk5OTk5OTk5OTk7CgkJCXZhciBpTGVuZ3RoID0gX2ZuUmVhZENvb2tpZSggc05hbWVGaWxlICkhPT1udWxsID8gZG9jdW1lbnQuY29va2llLmxlbmd0aCA6IAoJCQkJc0Z1bGxDb29raWUubGVuZ3RoICsgZG9jdW1lbnQuY29va2llLmxlbmd0aDsKCQkJCgkJCWlmICggaUxlbmd0aCsxMCA+IDQwOTYgKSAvKiBNYWdpYyAxMCBmb3IgcGFkZGluZyAqLwoJCQl7CgkJCQl2YXIgYUNvb2tpZXMgPWRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpOwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hQ29va2llcy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYUNvb2tpZXNbaV0uaW5kZXhPZiggc0Jhc2VOYW1lICkgIT0gLTEgKQoJCQkJCXsKCQkJCQkJLyogSXQncyBhIERhdGFUYWJsZXMgY29va2llLCBzbyBldmFsIGl0IGFuZCBjaGVjayB0aGUgdGltZSBzdGFtcCAqLwoJCQkJCQl2YXIgYVNwbGl0Q29va2llID0gYUNvb2tpZXNbaV0uc3BsaXQoJz0nKTsKCQkJCQkJdHJ5IHsgb0RhdGEgPSBldmFsKCAnKCcrZGVjb2RlVVJJQ29tcG9uZW50KGFTcGxpdENvb2tpZVsxXSkrJyknICk7IH0KCQkJCQkJY2F0Y2goIGUgKSB7IGNvbnRpbnVlOyB9CgkJCQkJCQoJCQkJCQlpZiAoIG9EYXRhLmlDcmVhdGUgJiYgb0RhdGEuaUNyZWF0ZSA8IGlPbGRUaW1lICkKCQkJCQkJewoJCQkJCQkJc09sZE5hbWUgPSBhU3BsaXRDb29raWVbMF07CgkJCQkJCQlpT2xkVGltZSA9IG9EYXRhLmlDcmVhdGU7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggc09sZE5hbWUgIT09ICIiICkKCQkJCXsKCQkJCQlkb2N1bWVudC5jb29raWUgPSBzT2xkTmFtZSsiPTsgZXhwaXJlcz1UaHUsIDAxLUphbi0xOTcwIDAwOjAwOjAxIEdNVDsgcGF0aD0iKwoJCQkJCQlhUGFydHMuam9pbignLycpICsgIi8iOwoJCQkJfQoJCQl9CgkJCQoJCQlkb2N1bWVudC5jb29raWUgPSBzRnVsbENvb2tpZTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVhZCBhbiBvbGQgY29va2llIHRvIGdldCBhIGNvb2tpZSB3aXRoIGFuIG9sZCB0YWJsZSBzdGF0ZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgbmFtZSBvZiB0aGUgY29va2llIHRvIHJlYWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gY29udGVudHMgb2YgdGhlIGNvb2tpZSAtIG9yIG51bGwgaWYgbm8gY29va2llIHdpdGggdGhhdCBuYW1lIGZvdW5kCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlYWRDb29raWUgKCBzTmFtZSApCgkJewoJCQl2YXIKCQkJCWFQYXJ0cyA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpLAoJCQkJc05hbWVFUSA9IHNOYW1lICsgJ18nICsgYVBhcnRzW2FQYXJ0cy5sZW5ndGgtMV0ucmVwbGFjZSgvW1wvOl0vZywiIikudG9Mb3dlckNhc2UoKSArICc9JywKCQkJIAlzQ29va2llQ29udGVudHMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsKCQkJCgkJCWZvciggdmFyIGk9MCA7IGk8c0Nvb2tpZUNvbnRlbnRzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCXZhciBjID0gc0Nvb2tpZUNvbnRlbnRzW2ldOwoJCQkJCgkJCQl3aGlsZSAoYy5jaGFyQXQoMCk9PScgJykKCQkJCXsKCQkJCQljID0gYy5zdWJzdHJpbmcoMSxjLmxlbmd0aCk7CgkJCQl9CgkJCQkKCQkJCWlmIChjLmluZGV4T2Yoc05hbWVFUSkgPT09IDApCgkJCQl7CgkJCQkJcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCggYy5zdWJzdHJpbmcoc05hbWVFUS5sZW5ndGgsYy5sZW5ndGgpICk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiB0aGUgc2V0dGluZ3Mgb2JqZWN0IGZvciBhIHBhcnRpY3VsYXIgdGFibGUKCQkgKiAgQHBhcmFtIHtub2RlfSBuVGFibGUgdGFibGUgd2UgYXJlIHVzaW5nIGFzIGEgZGF0YVRhYmxlCgkJICogIEByZXR1cm5zIHtvYmplY3R9IFNldHRpbmdzIG9iamVjdCAtIG9yIG51bGwgaWYgbm90IGZvdW5kCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNldHRpbmdzRnJvbU5vZGUgKCBuVGFibGUgKQoJCXsKCQkJZm9yICggdmFyIGk9MCA7IGk8RGF0YVRhYmxlLnNldHRpbmdzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggRGF0YVRhYmxlLnNldHRpbmdzW2ldLm5UYWJsZSA9PT0gblRhYmxlICkKCQkJCXsKCQkJCQlyZXR1cm4gRGF0YVRhYmxlLnNldHRpbmdzW2ldOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGFuIGFycmF5IHdpdGggdGhlIFRSIG5vZGVzIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7YXJyYXl9IFRSIGFycmF5CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFRyTm9kZXMgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGFOb2RlcyA9IFtdOwoJCQl2YXIgYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBhb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCXsKCQkJCQlhTm9kZXMucHVzaCggYW9EYXRhW2ldLm5UciApOwoJCQkJfQoJCQl9CgkJCXJldHVybiBhTm9kZXM7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiBhbiBmbGF0IGFycmF5IHdpdGggYWxsIFREIG5vZGVzIGZvciB0aGUgdGFibGUsIG9yIHJvdwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBbaUluZGl2aWR1YWxSb3ddIGFvRGF0YSBpbmRleCB0byBnZXQgdGhlIG5vZGVzIGZvciAtIG9wdGlvbmFsIAoJCSAqICAgIGlmIG5vdCBnaXZlbiB0aGVuIHRoZSByZXR1cm4gYXJyYXkgd2lsbCBjb250YWluIGFsbCBub2RlcyBmb3IgdGhlIHRhYmxlCgkJICogIEByZXR1cm5zIHthcnJheX0gVEQgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0VGROb2RlcyAoIG9TZXR0aW5ncywgaUluZGl2aWR1YWxSb3cgKQoJCXsKCQkJdmFyIGFuUmV0dXJuID0gW107CgkJCXZhciBpQ29ycmVjdG9yOwoJCQl2YXIgYW5UZHM7CgkJCXZhciBpUm93LCBpUm93cz1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCwKCQkJCWlDb2x1bW4sIGlDb2x1bW5zLCBvRGF0YSwgc05vZGVOYW1lLCBpU3RhcnQ9MCwgaUVuZD1pUm93czsKCQkJCgkJCS8qIEFsbG93IHRoZSBjb2xsZWN0aW9uIHRvIGJlIGxpbWl0ZWQgdG8ganVzdCBvbmUgcm93ICovCgkJCWlmICggaUluZGl2aWR1YWxSb3cgIT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlTdGFydCA9IGlJbmRpdmlkdWFsUm93OwoJCQkJaUVuZCA9IGlJbmRpdmlkdWFsUm93KzE7CgkJCX0KCQkKCQkJZm9yICggaVJvdz1pU3RhcnQgOyBpUm93PGlFbmQgOyBpUm93KysgKQoJCQl7CgkJCQlvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCQlpZiAoIG9EYXRhLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJLyogZ2V0IHRoZSBURCBjaGlsZCBub2RlcyAtIHRha2luZyBpbnRvIGFjY291bnQgdGV4dCBldGMgbm9kZXMgKi8KCQkJCQlhblRkcyA9IFtdOwoJCQkJCWZvciAoIGlDb2x1bW49MCwgaUNvbHVtbnM9b0RhdGEublRyLmNoaWxkTm9kZXMubGVuZ3RoIDsgaUNvbHVtbjxpQ29sdW1ucyA7IGlDb2x1bW4rKyApCgkJCQkJewoJCQkJCQlzTm9kZU5hbWUgPSBvRGF0YS5uVHIuY2hpbGROb2Rlc1tpQ29sdW1uXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAndGQnIHx8IHNOb2RlTmFtZSA9PSAndGgnICkKCQkJCQkJewoJCQkJCQkJYW5UZHMucHVzaCggb0RhdGEublRyLmNoaWxkTm9kZXNbaUNvbHVtbl0gKTsKCQkJCQkJfQoJCQkJCX0KCQkKCQkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCQlmb3IgKCBpQ29sdW1uPTAsIGlDb2x1bW5zPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaUNvbHVtbjxpQ29sdW1ucyA7IGlDb2x1bW4rKyApCgkJCQkJewoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlhblJldHVybi5wdXNoKCBhblRkc1tpQ29sdW1uLWlDb3JyZWN0b3JdICk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlhblJldHVybi5wdXNoKCBvRGF0YS5fYW5IaWRkZW5baUNvbHVtbl0gKTsKCQkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQlyZXR1cm4gYW5SZXR1cm47CgkJfQoJCQoJCQoJCS8qKgoJCSAqIExvZyBhbiBlcnJvciBtZXNzYWdlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlMZXZlbCBsb2cgZXJyb3IgbWVzc2FnZXMsIG9yIGRpc3BsYXkgdGhlbSB0byB0aGUgdXNlcgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc01lc2cgZXJyb3IgbWVzc2FnZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Mb2coIG9TZXR0aW5ncywgaUxldmVsLCBzTWVzZyApCgkJewoJCQl2YXIgc0FsZXJ0ID0gKG9TZXR0aW5ncz09PW51bGwpID8KCQkJCSJEYXRhVGFibGVzIHdhcm5pbmc6ICIrc01lc2cgOgoJCQkJIkRhdGFUYWJsZXMgd2FybmluZyAodGFibGUgaWQgPSAnIitvU2V0dGluZ3Muc1RhYmxlSWQrIicpOiAiK3NNZXNnOwoJCQkKCQkJaWYgKCBpTGV2ZWwgPT09IDAgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5leHQuc0Vyck1vZGUgPT0gJ2FsZXJ0JyApCgkJCQl7CgkJCQkJYWxlcnQoIHNBbGVydCApOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCXRocm93IG5ldyBFcnJvcihzQWxlcnQpOwoJCQkJfQoJCQkJcmV0dXJuOwoJCQl9CgkJCWVsc2UgaWYgKCB3aW5kb3cuY29uc29sZSAmJiBjb25zb2xlLmxvZyApCgkJCXsKCQkJCWNvbnNvbGUubG9nKCBzQWxlcnQgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZWUgaWYgYSBwcm9wZXJ0eSBpcyBkZWZpbmVkIG9uIG9uZSBvYmplY3QsIGlmIHNvIGFzc2lnbiBpdCB0byB0aGUgb3RoZXIgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvUmV0IHRhcmdldCBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TcmMgc291cmNlIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgcHJvcGVydHkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtzTWFwcGVkTmFtZV0gbmFtZSB0byBtYXAgdG9vIC0gb3B0aW9uYWwsIHNOYW1lIHVzZWQgaWYgbm90IGdpdmVuCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk1hcCggb1JldCwgb1NyYywgc05hbWUsIHNNYXBwZWROYW1lICkKCQl7CgkJCWlmICggc01hcHBlZE5hbWUgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXNNYXBwZWROYW1lID0gc05hbWU7CgkJCX0KCQkJaWYgKCBvU3JjW3NOYW1lXSAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJb1JldFtzTWFwcGVkTmFtZV0gPSBvU3JjW3NOYW1lXTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBFeHRlbmQgb2JqZWN0cyAtIHZlcnkgc2ltaWxhciB0byBqUXVlcnkuZXh0ZW5kLCBidXQgZGVlcCBjb3B5IG9iamVjdHMsIGFuZCBzaGFsbG93CgkJICogY29weSBhcnJheXMuIFRoZSByZWFzb24gd2UgbmVlZCB0byBkbyB0aGlzLCBpcyB0aGF0IHdlIGRvbid0IHdhbnQgdG8gZGVlcCBjb3B5IGFycmF5CgkJICogaW5pdCB2YWx1ZXMgKHN1Y2ggYXMgYWFTb3J0aW5nKSBzaW5jZSB0aGUgZGV2IHdvdWxkbid0IGJlIGFibGUgdG8gb3ZlcnJpZGUgdGhlbSwgYnV0CgkJICogd2UgZG8gd2FudCB0byBkZWVwIGNvcHkgYXJyYXlzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb091dCBPYmplY3QgdG8gZXh0ZW5kCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRXh0ZW5kZXIgT2JqZWN0IGZyb20gd2hpY2ggdGhlIHByb3BlcnRpZXMgd2lsbCBiZSBhcHBsaWVkIHRvIG9PdXQKCQkgKiAgQHJldHVybnMge29iamVjdH0gb091dCBSZWZlcmVuY2UsIGp1c3QgZm9yIGNvbnZlbmllbmNlIC0gb091dCA9PT0gdGhlIHJldHVybi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICogIEB0b2RvIFRoaXMgZG9lc24ndCB0YWtlIGFjY291bnQgb2YgYXJyYXlzIGluc2lkZSB0aGUgZGVlcCBjb3BpZWQgb2JqZWN0cy4KCQkgKi8KCQlmdW5jdGlvbiBfZm5FeHRlbmQoIG9PdXQsIG9FeHRlbmRlciApCgkJewoJCQl2YXIgdmFsOwoJCQkKCQkJZm9yICggdmFyIHByb3AgaW4gb0V4dGVuZGVyICkKCQkJewoJCQkJaWYgKCBvRXh0ZW5kZXIuaGFzT3duUHJvcGVydHkocHJvcCkgKQoJCQkJewoJCQkJCXZhbCA9IG9FeHRlbmRlcltwcm9wXTsKCQkKCQkJCQlpZiAoIHR5cGVvZiBvSW5pdFtwcm9wXSA9PT0gJ29iamVjdCcgJiYgdmFsICE9PSBudWxsICYmICQuaXNBcnJheSh2YWwpID09PSBmYWxzZSApCgkJCQkJewoJCQkJCQkkLmV4dGVuZCggdHJ1ZSwgb091dFtwcm9wXSwgdmFsICk7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCW9PdXRbcHJvcF0gPSB2YWw7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCXJldHVybiBvT3V0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBCaW5kIGFuIGV2ZW50IGhhbmRlcnMgdG8gYWxsb3cgYSBjbGljayBvciByZXR1cm4ga2V5IHRvIGFjdGl2YXRlIHRoZSBjYWxsYmFjay4KCQkgKiBUaGlzIGlzIGdvb2QgZm9yIGFjY2Vzc2liaWxpdHkgc2luY2UgYSByZXR1cm4gb24gdGhlIGtleWJvYXJkIHdpbGwgaGF2ZSB0aGUKCQkgKiBzYW1lIGVmZmVjdCBhcyBhIGNsaWNrLCBpZiB0aGUgZWxlbWVudCBoYXMgZm9jdXMuCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gbiBFbGVtZW50IHRvIGJpbmQgdGhlIGFjdGlvbiB0bwoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgRGF0YSBvYmplY3QgdG8gcGFzcyB0byB0aGUgdHJpZ2dlcmVkIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIENhbGxiYWNrIGZ1bmN0aW9uIGZvciB3aGVuIHRoZSBldmVudCBpcyB0cmlnZ2VyZWQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQmluZEFjdGlvbiggbiwgb0RhdGEsIGZuICkKCQl7CgkJCSQobikKCQkJCS5iaW5kKCAnY2xpY2suRFQnLCBvRGF0YSwgZnVuY3Rpb24gKGUpIHsKCQkJCQkJbi5ibHVyKCk7IC8vIFJlbW92ZSBmb2N1cyBvdXRsaW5lIGZvciBtb3VzZSB1c2VycwoJCQkJCQlmbihlKTsKCQkJCQl9ICkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBvRGF0YSwgZnVuY3Rpb24gKGUpewoJCQkJCWlmICggZS53aGljaCA9PT0gMTMgKSB7CgkJCQkJCWZuKGUpOwoJCQkJCX0gfSApCgkJCQkuYmluZCggJ3NlbGVjdHN0YXJ0LkRUJywgZnVuY3Rpb24gKCkgewoJCQkJCS8qIFRha2UgdGhlIGJydXRhbCBhcHByb2FjaCB0byBjYW5jZWxsaW5nIHRleHQgc2VsZWN0aW9uICovCgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVnaXN0ZXIgYSBjYWxsYmFjayBmdW5jdGlvbi4gRWFzaWx5IGFsbG93cyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGFkZGVkIHRvCgkJICogYW4gYXJyYXkgc3RvcmUgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIHRoYXQgY2FuIHRoZW4gYWxsIGJlIGNhbGxlZCB0b2dldGhlci4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1N0b3JlIE5hbWUgb2YgdGhlIGFycmF5IHN0b3JhZ2UgZm9yIHRoZSBjYWxsYmFja3MgaW4gb1NldHRpbmdzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiYWNrCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBJZGVudGlmeWluZyBuYW1lIGZvciB0aGUgY2FsbGJhY2sgKGkuZS4gYSBsYWJlbCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgc1N0b3JlLCBmbiwgc05hbWUgKQoJCXsKCQkJaWYgKCBmbiApCgkJCXsKCQkJCW9TZXR0aW5nc1tzU3RvcmVdLnB1c2goIHsKCQkJCQkiZm4iOiBmbiwKCQkJCQkic05hbWUiOiBzTmFtZQoJCQkJfSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpcmUgY2FsbGJhY2sgZnVuY3Rpb25zIGFuZCB0cmlnZ2VyIGV2ZW50cy4gTm90ZSB0aGF0IHRoZSBsb29wIG92ZXIgdGhlIGNhbGxiYWNrCgkJICogYXJyYXkgc3RvcmUgaXMgZG9uZSBiYWNrd2FyZHMhIEZ1cnRoZXIgbm90ZSB0aGF0IHlvdSBkbyBub3Qgd2FudCB0byBmaXJlIG9mZiB0cmlnZ2VycwoJCSAqIGluIHRpbWUgc2Vuc2l0aXZlIGFwcGxpY2F0aW9ucyAoZm9yIGV4YW1wbGUgY2VsbCBjcmVhdGlvbikgYXMgaXRzIHNsb3cuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTdG9yZSBOYW1lIG9mIHRoZSBhcnJheSBzdG9yYWdlIGZvciB0aGUgY2FsbGJhY2tzIGluIG9TZXR0aW5ncwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1RyaWdnZXIgTmFtZSBvZiB0aGUgalF1ZXJ5IGN1c3RvbSBldmVudCB0byB0cmlnZ2VyLiBJZiBudWxsIG5vIHRyaWdnZXIKCQkgKiAgICBpcyBmaXJlZAoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJncyBBcnJheSBvZiBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gLyB0cmlnZ2VyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCBzU3RvcmUsIHNUcmlnZ2VyLCBhQXJncyApCgkJewoJCQl2YXIgYW9TdG9yZSA9IG9TZXR0aW5nc1tzU3RvcmVdOwoJCQl2YXIgYVJldCA9W107CgkJCgkJCWZvciAoIHZhciBpPWFvU3RvcmUubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJewoJCQkJYVJldC5wdXNoKCBhb1N0b3JlW2ldLmZuLmFwcGx5KCBvU2V0dGluZ3Mub0luc3RhbmNlLCBhQXJncyApICk7CgkJCX0KCQkKCQkJaWYgKCBzVHJpZ2dlciAhPT0gbnVsbCApCgkJCXsKCQkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcihzVHJpZ2dlciwgYUFyZ3MpOwoJCQl9CgkJCgkJCXJldHVybiBhUmV0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBKU09OIHN0cmluZ2lmeS4gSWYgSlNPTi5zdHJpbmdpZnkgaXQgcHJvdmlkZWQgYnkgdGhlIGJyb3dzZXIsIGpzb24yLmpzIG9yIGFueSBvdGhlcgoJCSAqIGxpYnJhcnksIHRoZW4gd2UgdXNlIHRoYXQgYXMgaXQgaXMgZmFzdCwgc2FmZSBhbmQgYWNjdXJhdGUuIElmIHRoZSBmdW5jdGlvbiBpc24ndCAKCQkgKiBhdmFpbGFibGUgdGhlbiB3ZSBuZWVkIHRvIGJ1aWx0IGl0IG91cnNlbHZlcyAtIHRoZSBpbnNwaXJhdGlvbiBmb3IgdGhpcyBmdW5jdGlvbiBjb21lcwoJCSAqIGZyb20gQ3JhaWcgQnVja2xlciAoIGh0dHA6Ly93d3cuc2l0ZXBvaW50LmNvbS9qYXZhc2NyaXB0LWpzb24tc2VyaWFsaXphdGlvbi8gKS4gSXQgaXMKCQkgKiBub3QgcGVyZmVjdCBhbmQgYWJzb2x1dGVseSBzaG91bGQgbm90IGJlIHVzZWQgYXMgYSByZXBsYWNlbWVudCB0byBqc29uMi5qcyAtIGJ1dCBpdCBkb2VzCgkJICogZG8gd2hhdCB3ZSBuZWVkLCB3aXRob3V0IHJlcXVpcmluZyBhIGRlcGVuZGVuY3kgZm9yIERhdGFUYWJsZXMuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIEpTT04gb2JqZWN0IHRvIGJlIGNvbnZlcnRlZAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBKU09OIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQl2YXIgX2ZuSnNvblN0cmluZyA9ICh3aW5kb3cuSlNPTikgPyBKU09OLnN0cmluZ2lmeSA6IGZ1bmN0aW9uKCBvICkKCQl7CgkJCS8qIE5vdCBhbiBvYmplY3Qgb3IgYXJyYXkgKi8KCQkJdmFyIHNUeXBlID0gdHlwZW9mIG87CgkJCWlmIChzVHlwZSAhPT0gIm9iamVjdCIgfHwgbyA9PT0gbnVsbCkKCQkJewoJCQkJLy8gc2ltcGxlIGRhdGEgdHlwZQoJCQkJaWYgKHNUeXBlID09PSAic3RyaW5nIikKCQkJCXsKCQkJCQlvID0gJyInK28rJyInOwoJCQkJfQoJCQkJcmV0dXJuIG8rIiI7CgkJCX0KCQkKCQkJLyogSWYgb2JqZWN0IG9yIGFycmF5LCBuZWVkIHRvIHJlY3Vyc2Ugb3ZlciBpdCAqLwoJCQl2YXIKCQkJCXNQcm9wLCBtVmFsdWUsCgkJCQlqc29uID0gW10sCgkJCQliQXJyID0gJC5pc0FycmF5KG8pOwoJCQkKCQkJZm9yIChzUHJvcCBpbiBvKQoJCQl7CgkJCQltVmFsdWUgPSBvW3NQcm9wXTsKCQkJCXNUeXBlID0gdHlwZW9mIG1WYWx1ZTsKCQkKCQkJCWlmIChzVHlwZSA9PT0gInN0cmluZyIpCgkJCQl7CgkJCQkJbVZhbHVlID0gJyInK21WYWx1ZSsnIic7CgkJCQl9CgkJCQllbHNlIGlmIChzVHlwZSA9PT0gIm9iamVjdCIgJiYgbVZhbHVlICE9PSBudWxsKQoJCQkJewoJCQkJCW1WYWx1ZSA9IF9mbkpzb25TdHJpbmcobVZhbHVlKTsKCQkJCX0KCQkKCQkJCWpzb24ucHVzaCgoYkFyciA/ICIiIDogJyInK3NQcm9wKyciOicpICsgbVZhbHVlKTsKCQkJfQoJCQoJCQlyZXR1cm4gKGJBcnIgPyAiWyIgOiAieyIpICsganNvbiArIChiQXJyID8gIl0iIDogIn0iKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEZyb20gc29tZSBicm93c2VycyAoc3BlY2lmaWNhbGx5IElFNi83KSB3ZSBuZWVkIHNwZWNpYWwgaGFuZGxpbmcgdG8gd29yayBhcm91bmQgYnJvd3NlcgoJCSAqIGJ1Z3MgLSB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZGV0ZWN0IHdoZW4gdGhlc2Ugd29ya2Fyb3VuZHMgYXJlIG5lZWRlZC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ccm93c2VyRGV0ZWN0KCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogSUU2Lzcgd2lsbCBvdmVyc2l6ZSBhIHdpZHRoIDEwMCUgZWxlbWVudCBpbnNpZGUgYSBzY3JvbGxpbmcgZWxlbWVudCwgdG8gaW5jbHVkZSB0aGUKCQkJICogd2lkdGggb2YgdGhlIHNjcm9sbGJhciwgd2hpbGUgb3RoZXIgYnJvd3NlcnMgZW5zdXJlIHRoZSBpbm5lciBlbGVtZW50IGlzIGNvbnRhaW5lZAoJCQkgKiB3aXRob3V0IGZvcmNpbmcgc2Nyb2xsaW5nCgkJCSAqLwoJCQl2YXIgbiA9ICQoCgkJCQknPGRpdiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7IHRvcDowOyBsZWZ0OjA7IGhlaWdodDoxcHg7IHdpZHRoOjFweDsgb3ZlcmZsb3c6aGlkZGVuIj4nKwoJCQkJCSc8ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjFweDsgbGVmdDoxcHg7IHdpZHRoOjEwMHB4OyBoZWlnaHQ6NTBweDsgb3ZlcmZsb3c6c2Nyb2xsOyI+JysKCQkJCQkJJzxkaXYgaWQ9IkRUX0Jyb3dzZXJUZXN0IiBzdHlsZT0id2lkdGg6MTAwJTsgaGVpZ2h0OjEwcHg7Ij48L2Rpdj4nKwoJCQkJCSc8L2Rpdj4nKwoJCQkJJzwvZGl2PicpWzBdOwoJCQoJCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCBuICk7CgkJCW9TZXR0aW5ncy5vQnJvd3Nlci5iU2Nyb2xsT3ZlcnNpemUgPSAkKCcjRFRfQnJvd3NlclRlc3QnLCBuKVswXS5vZmZzZXRXaWR0aCA9PT0gMTAwID8gdHJ1ZSA6IGZhbHNlOwoJCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKCBuICk7CgkJfQoJCQoKCQkKCQkKCQkvKioKCQkgKiBQZXJmb3JtIGEgalF1ZXJ5IHNlbGVjdG9yIGFjdGlvbiBvbiB0aGUgdGFibGUncyBUUiBlbGVtZW50cyAoZnJvbSB0aGUgdGJvZHkpIGFuZAoJCSAqIHJldHVybiB0aGUgcmVzdWx0aW5nIGpRdWVyeSBvYmplY3QuCgkJICogIEBwYXJhbSB7c3RyaW5nfG5vZGV8alF1ZXJ5fSBzU2VsZWN0b3IgalF1ZXJ5IHNlbGVjdG9yIG9yIG5vZGUgY29sbGVjdGlvbiB0byBhY3Qgb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IFtvT3B0c10gT3B0aW9uYWwgcGFyYW1ldGVycyBmb3IgbW9kaWZ5aW5nIHRoZSByb3dzIHRvIGJlIGluY2x1ZGVkCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMuZmlsdGVyPW5vbmVdIFNlbGVjdCBUUiBlbGVtZW50cyB0aGF0IG1lZXQgdGhlIGN1cnJlbnQgZmlsdGVyCgkJICogICAgY3JpdGVyaW9uICgiYXBwbGllZCIpIG9yIGFsbCBUUiBlbGVtZW50cyAoaS5lLiBubyBmaWx0ZXIpLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLm9yZGVyPWN1cnJlbnRdIE9yZGVyIG9mIHRoZSBUUiBlbGVtZW50cyBpbiB0aGUgcHJvY2Vzc2VkIGFycmF5LgoJCSAqICAgIENhbiBiZSBlaXRoZXIgJ2N1cnJlbnQnLCB3aGVyZWJ5IHRoZSBjdXJyZW50IHNvcnRpbmcgb2YgdGhlIHRhYmxlIGlzIHVzZWQsIG9yCgkJICogICAgJ29yaWdpbmFsJyB3aGVyZWJ5IHRoZSBvcmlnaW5hbCBvcmRlciB0aGUgZGF0YSB3YXMgcmVhZCBpbnRvIHRoZSB0YWJsZSBpcyB1c2VkLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLnBhZ2U9YWxsXSBMaW1pdCB0aGUgc2VsZWN0aW9uIHRvIHRoZSBjdXJyZW50bHkgZGlzcGxheWVkIHBhZ2UKCQkgKiAgICAoImN1cnJlbnQiKSBvciBub3QgKCJhbGwiKS4gSWYgJ2N1cnJlbnQnIGlzIGdpdmVuLCB0aGVuIG9yZGVyIGlzIGFzc3VtZWQgdG8gYmUgCgkJICogICAgJ2N1cnJlbnQnIGFuZCBmaWx0ZXIgaXMgJ2FwcGxpZWQnLCByZWdhcmRsZXNzIG9mIHdoYXQgdGhleSBtaWdodCBiZSBnaXZlbiBhcy4KCQkgKiAgQHJldHVybnMge29iamVjdH0galF1ZXJ5IG9iamVjdCwgZmlsdGVyZWQgYnkgdGhlIGdpdmVuIHNlbGVjdG9yLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICAvLyBIaWdobGlnaHQgZXZlcnkgc2Vjb25kIHJvdwoJCSAqICAgICAgb1RhYmxlLiQoJ3RyOm9kZCcpLmNzcygnYmFja2dyb3VuZENvbG9yJywgJ2JsdWUnKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICAvLyBGaWx0ZXIgdG8gcm93cyB3aXRoICdXZWJraXQnIGluIHRoZW0sIGFkZCBhIGJhY2tncm91bmQgY29sb3VyIGFuZCB0aGVuCgkJICogICAgICAvLyByZW1vdmUgdGhlIGZpbHRlciwgdGh1cyBoaWdobGlnaHRpbmcgdGhlICdXZWJraXQnIHJvd3Mgb25seS4KCQkgKiAgICAgIG9UYWJsZS5mbkZpbHRlcignV2Via2l0Jyk7CgkJICogICAgICBvVGFibGUuJCgndHInLCB7ImZpbHRlciI6ICJhcHBsaWVkIn0pLmNzcygnYmFja2dyb3VuZENvbG9yJywgJ2JsdWUnKTsKCQkgKiAgICAgIG9UYWJsZS5mbkZpbHRlcignJyk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuJCA9IGZ1bmN0aW9uICggc1NlbGVjdG9yLCBvT3B0cyApCgkJewoJCQl2YXIgaSwgaUxlbiwgYSA9IFtdLCB0cjsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhOwoJCQl2YXIgYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheTsKCQkJdmFyIGFpRGlzcGxheU1hc3RlciA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXI7CgkJCgkJCWlmICggIW9PcHRzICkKCQkJewoJCQkJb09wdHMgPSB7fTsKCQkJfQoJCQoJCQlvT3B0cyA9ICQuZXh0ZW5kKCB7fSwgewoJCQkJImZpbHRlciI6ICJub25lIiwgLy8gYXBwbGllZAoJCQkJIm9yZGVyIjogImN1cnJlbnQiLCAvLyAib3JpZ2luYWwiCgkJCQkicGFnZSI6ICJhbGwiIC8vIGN1cnJlbnQKCQkJfSwgb09wdHMgKTsKCQkKCQkJLy8gQ3VycmVudCBwYWdlIGltcGxpZXMgdGhhdCBvcmRlcj1jdXJyZW50IGFuZCBmaXRsZXI9YXBwbGllZCwgc2luY2UgaXQgaXMgZmFpcmx5CgkJCS8vIHNlbnNlbGVzcyBvdGhlcndpc2UKCQkJaWYgKCBvT3B0cy5wYWdlID09ICdjdXJyZW50JyApCgkJCXsKCQkJCWZvciAoIGk9b1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBpTGVuPW9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGFpRGlzcGxheVtpXSBdLm5UcjsKCQkJCQlpZiAoIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJjdXJyZW50IiAmJiBvT3B0cy5maWx0ZXIgPT0gIm5vbmUiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFpRGlzcGxheU1hc3Rlci5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBhaURpc3BsYXlNYXN0ZXJbaV0gXS5uVHI7CgkJCQkJaWYgKCB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAiY3VycmVudCIgJiYgb09wdHMuZmlsdGVyID09ICJhcHBsaWVkIiApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1haURpc3BsYXkubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgYWlEaXNwbGF5W2ldIF0ublRyOwoJCQkJCWlmICggdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gIm9yaWdpbmFsIiAmJiBvT3B0cy5maWx0ZXIgPT0gIm5vbmUiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBpIF0ublRyIDsKCQkJCQlpZiAoIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJvcmlnaW5hbCIgJiYgb09wdHMuZmlsdGVyID09ICJhcHBsaWVkIiApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgaSBdLm5UcjsKCQkJCQlpZiAoICQuaW5BcnJheSggaSwgYWlEaXNwbGF5ICkgIT09IC0xICYmIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMSwgIlVua25vd24gc2VsZWN0aW9uIG9wdGlvbnMiICk7CgkJCX0KCQkKCQkJLyogV2UgbmVlZCB0byBmaWx0ZXIgb24gdGhlIFRSIGVsZW1lbnRzIGFuZCBhbHNvICdmaW5kJyBpbiB0aGVpciBkZXNjZW5kYW50cwoJCQkgKiB0byBtYWtlIHRoZSBzZWxlY3RvciBhY3QgbGlrZSBpdCB3b3VsZCBpbiBhIGZ1bGwgdGFibGUgLSBzbyB3ZSBuZWVkCgkJCSAqIHRvIGJ1aWxkIGJvdGggcmVzdWx0cyBhbmQgdGhlbiBjb21iaW5lIHRoZW0gdG9nZXRoZXIKCQkJICovCgkJCXZhciBqcUEgPSAkKGEpOwoJCQl2YXIganFUUnMgPSBqcUEuZmlsdGVyKCBzU2VsZWN0b3IgKTsKCQkJdmFyIGpxRGVzY2VuZGFudHMgPSBqcUEuZmluZCggc1NlbGVjdG9yICk7CgkJCgkJCXJldHVybiAkKCBbXS5jb25jYXQoJC5tYWtlQXJyYXkoanFUUnMpLCAkLm1ha2VBcnJheShqcURlc2NlbmRhbnRzKSkgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEFsbW9zdCBpZGVudGljYWwgdG8gJCBpbiBvcGVyYXRpb24sIGJ1dCBpbiB0aGlzIGNhc2UgcmV0dXJucyB0aGUgZGF0YSBmb3IgdGhlIG1hdGNoZWQKCQkgKiByb3dzIC0gYXMgc3VjaCwgdGhlIGpRdWVyeSBzZWxlY3RvciB1c2VkIHNob3VsZCBtYXRjaCBUUiByb3cgbm9kZXMgb3IgVEQvVEggY2VsbCBub2RlcwoJCSAqIHJhdGhlciB0aGFuIGFueSBkZXNjZW5kYW50cywgc28gdGhlIGRhdGEgY2FuIGJlIG9idGFpbmVkIGZvciB0aGUgcm93L2NlbGwuIElmIG1hdGNoaW5nCgkJICogcm93cyBhcmUgZm91bmQsIHRoZSBkYXRhIHJldHVybmVkIGlzIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5L29iamVjdCB0aGF0IHdhcyB1c2VkIHRvICAKCQkgKiBjcmVhdGUgdGhlIHJvdyAob3IgYSBnZW5lcmF0ZWQgYXJyYXkgaWYgZnJvbSBhIERPTSBzb3VyY2UpLgoJCSAqCgkJICogVGhpcyBtZXRob2QgaXMgb2Z0ZW4gdXNlZnVsIGluLWNvbWJpbmF0aW9uIHdpdGggJCB3aGVyZSBib3RoIGZ1bmN0aW9ucyBhcmUgZ2l2ZW4gdGhlCgkJICogc2FtZSBwYXJhbWV0ZXJzIGFuZCB0aGUgYXJyYXkgaW5kZXhlcyB3aWxsIG1hdGNoIGlkZW50aWNhbGx5LgoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gc1NlbGVjdG9yIGpRdWVyeSBzZWxlY3RvciBvciBub2RlIGNvbGxlY3Rpb24gdG8gYWN0IG9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBbb09wdHNdIE9wdGlvbmFsIHBhcmFtZXRlcnMgZm9yIG1vZGlmeWluZyB0aGUgcm93cyB0byBiZSBpbmNsdWRlZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLmZpbHRlcj1ub25lXSBTZWxlY3QgZWxlbWVudHMgdGhhdCBtZWV0IHRoZSBjdXJyZW50IGZpbHRlcgoJCSAqICAgIGNyaXRlcmlvbiAoImFwcGxpZWQiKSBvciBhbGwgZWxlbWVudHMgKGkuZS4gbm8gZmlsdGVyKS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5vcmRlcj1jdXJyZW50XSBPcmRlciBvZiB0aGUgZGF0YSBpbiB0aGUgcHJvY2Vzc2VkIGFycmF5LgoJCSAqICAgIENhbiBiZSBlaXRoZXIgJ2N1cnJlbnQnLCB3aGVyZWJ5IHRoZSBjdXJyZW50IHNvcnRpbmcgb2YgdGhlIHRhYmxlIGlzIHVzZWQsIG9yCgkJICogICAgJ29yaWdpbmFsJyB3aGVyZWJ5IHRoZSBvcmlnaW5hbCBvcmRlciB0aGUgZGF0YSB3YXMgcmVhZCBpbnRvIHRoZSB0YWJsZSBpcyB1c2VkLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLnBhZ2U9YWxsXSBMaW1pdCB0aGUgc2VsZWN0aW9uIHRvIHRoZSBjdXJyZW50bHkgZGlzcGxheWVkIHBhZ2UKCQkgKiAgICAoImN1cnJlbnQiKSBvciBub3QgKCJhbGwiKS4gSWYgJ2N1cnJlbnQnIGlzIGdpdmVuLCB0aGVuIG9yZGVyIGlzIGFzc3VtZWQgdG8gYmUgCgkJICogICAgJ2N1cnJlbnQnIGFuZCBmaWx0ZXIgaXMgJ2FwcGxpZWQnLCByZWdhcmRsZXNzIG9mIHdoYXQgdGhleSBtaWdodCBiZSBnaXZlbiBhcy4KCQkgKiAgQHJldHVybnMge2FycmF5fSBEYXRhIGZvciB0aGUgbWF0Y2hlZCBlbGVtZW50cy4gSWYgYW55IGVsZW1lbnRzLCBhcyBhIHJlc3VsdCBvZiB0aGUKCQkgKiAgICBzZWxlY3Rvciwgd2VyZSBub3QgVFIsIFREIG9yIFRIIGVsZW1lbnRzIGluIHRoZSBEYXRhVGFibGUsIHRoZXkgd2lsbCBoYXZlIGEgbnVsbCAKCQkgKiAgICBlbnRyeSBpbiB0aGUgYXJyYXkuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIC8vIEdldCB0aGUgZGF0YSBmcm9tIHRoZSBmaXJzdCByb3cgaW4gdGhlIHRhYmxlCgkJICogICAgICB2YXIgZGF0YSA9IG9UYWJsZS5fKCd0cjpmaXJzdCcpOwoJCSAqCgkJICogICAgICAvLyBEbyBzb21ldGhpbmcgdXNlZnVsIHdpdGggdGhlIGRhdGEKCQkgKiAgICAgIGFsZXJ0KCAiRmlyc3QgY2VsbCBpczogIitkYXRhWzBdICk7CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gRmlsdGVyIHRvICdXZWJraXQnIGFuZCBnZXQgYWxsIGRhdGEgZm9yIAoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCdXZWJraXQnKTsKCQkgKiAgICAgIHZhciBkYXRhID0gb1RhYmxlLl8oJ3RyJywgeyJmaWx0ZXIiOiAiYXBwbGllZCJ9KTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gRG8gc29tZXRoaW5nIHdpdGggdGhlIGRhdGEKCQkgKiAgICAgIGFsZXJ0KCBkYXRhLmxlbmd0aCsiIHJvd3MgbWF0Y2hlZCB0aGUgZmlsdGVyIiApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLl8gPSBmdW5jdGlvbiAoIHNTZWxlY3Rvciwgb09wdHMgKQoJCXsKCQkJdmFyIGFPdXQgPSBbXTsKCQkJdmFyIGksIGlMZW4sIGlJbmRleDsKCQkJdmFyIGFUcnMgPSB0aGlzLiQoIHNTZWxlY3Rvciwgb09wdHMgKTsKCQkKCQkJZm9yICggaT0wLCBpTGVuPWFUcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYU91dC5wdXNoKCB0aGlzLmZuR2V0RGF0YShhVHJzW2ldKSApOwoJCQl9CgkJCgkJCXJldHVybiBhT3V0OwoJCX07CgkJCgkJCgkJLyoqCgkJICogQWRkIGEgc2luZ2xlIG5ldyByb3cgb3IgbXVsdGlwbGUgcm93cyBvZiBkYXRhIHRvIHRoZSB0YWJsZS4gUGxlYXNlIG5vdGUKCQkgKiB0aGF0IHRoaXMgaXMgc3VpdGFibGUgZm9yIGNsaWVudC1zaWRlIHByb2Nlc3Npbmcgb25seSAtIGlmIHlvdSBhcmUgdXNpbmcgCgkJICogc2VydmVyLXNpZGUgcHJvY2Vzc2luZyAoaS5lLiAiYlNlcnZlclNpZGUiOiB0cnVlKSwgdGhlbiB0byBhZGQgZGF0YSwgeW91CgkJICogbXVzdCBhZGQgaXQgdG8gdGhlIGRhdGEgc291cmNlLCBpLmUuIHRoZSBzZXJ2ZXItc2lkZSwgdGhyb3VnaCBhbiBBamF4IGNhbGwuCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBtRGF0YSBUaGUgZGF0YSB0byBiZSBhZGRlZCB0byB0aGUgdGFibGUuIFRoaXMgY2FuIGJlOgoJCSAqICAgIDx1bD4KCQkgKiAgICAgIDxsaT4xRCBhcnJheSBvZiBkYXRhIC0gYWRkIGEgc2luZ2xlIHJvdyB3aXRoIHRoZSBkYXRhIHByb3ZpZGVkPC9saT4KCQkgKiAgICAgIDxsaT4yRCBhcnJheSBvZiBhcnJheXMgLSBhZGQgbXVsdGlwbGUgcm93cyBpbiBhIHNpbmdsZSBjYWxsPC9saT4KCQkgKiAgICAgIDxsaT5vYmplY3QgLSBkYXRhIG9iamVjdCB3aGVuIHVzaW5nIDxpPm1EYXRhPC9pPjwvbGk+CgkJICogICAgICA8bGk+YXJyYXkgb2Ygb2JqZWN0cyAtIG11bHRpcGxlIGRhdGEgb2JqZWN0cyB3aGVuIHVzaW5nIDxpPm1EYXRhPC9pPjwvbGk+CgkJICogICAgPC91bD4KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSByZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAcmV0dXJucyB7YXJyYXl9IEFuIGFycmF5IG9mIGludGVnZXJzLCByZXByZXNlbnRpbmcgdGhlIGxpc3Qgb2YgaW5kZXhlcyBpbiAKCQkgKiAgICA8aT5hb0RhdGE8L2k+ICh7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9KSB0aGF0IGhhdmUgYmVlbiBhZGRlZCB0byAKCQkgKiAgICB0aGUgdGFibGUuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEdsb2JhbCB2YXIgZm9yIGNvdW50ZXIKCQkgKiAgICB2YXIgZ2lDb3VudCA9IDI7CgkJICogICAgCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICBmdW5jdGlvbiBmbkNsaWNrQWRkUm93KCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKS5mbkFkZERhdGEoIFsKCQkgKiAgICAgICAgZ2lDb3VudCsiLjEiLAoJCSAqICAgICAgICBnaUNvdW50KyIuMiIsCgkJICogICAgICAgIGdpQ291bnQrIi4zIiwKCQkgKiAgICAgICAgZ2lDb3VudCsiLjQiIF0KCQkgKiAgICAgICk7CgkJICogICAgICAgIAoJCSAqICAgICAgZ2lDb3VudCsrOwoJCSAqICAgIH0KCQkgKi8KCQl0aGlzLmZuQWRkRGF0YSA9IGZ1bmN0aW9uKCBtRGF0YSwgYlJlZHJhdyApCgkJewoJCQlpZiAoIG1EYXRhLmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXJldHVybiBbXTsKCQkJfQoJCQkKCQkJdmFyIGFpUmV0dXJuID0gW107CgkJCXZhciBpVGVzdDsKCQkJCgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJLyogQ2hlY2sgaWYgd2Ugd2FudCB0byBhZGQgbXVsdGlwbGUgcm93cyBvciBub3QgKi8KCQkJaWYgKCB0eXBlb2YgbURhdGFbMF0gPT09ICJvYmplY3QiICYmIG1EYXRhWzBdICE9PSBudWxsICkKCQkJewoJCQkJZm9yICggdmFyIGk9MCA7IGk8bURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVGVzdCA9IF9mbkFkZERhdGEoIG9TZXR0aW5ncywgbURhdGFbaV0gKTsKCQkJCQlpZiAoIGlUZXN0ID09IC0xICkKCQkJCQl7CgkJCQkJCXJldHVybiBhaVJldHVybjsKCQkJCQl9CgkJCQkJYWlSZXR1cm4ucHVzaCggaVRlc3QgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCWlUZXN0ID0gX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBtRGF0YSApOwoJCQkJaWYgKCBpVGVzdCA9PSAtMSApCgkJCQl7CgkJCQkJcmV0dXJuIGFpUmV0dXJuOwoJCQkJfQoJCQkJYWlSZXR1cm4ucHVzaCggaVRlc3QgKTsKCQkJfQoJCQkKCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5SZURyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCXJldHVybiBhaVJldHVybjsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gd2lsbCBtYWtlIERhdGFUYWJsZXMgcmVjYWxjdWxhdGUgdGhlIGNvbHVtbiBzaXplcywgYmFzZWQgb24gdGhlIGRhdGEgCgkJICogY29udGFpbmVkIGluIHRoZSB0YWJsZSBhbmQgdGhlIHNpemVzIGFwcGxpZWQgdG8gdGhlIGNvbHVtbnMgKGluIHRoZSBET00sIENTUyBvciAKCQkgKiB0aHJvdWdoIHRoZSBzV2lkdGggcGFyYW1ldGVyKS4gVGhpcyBjYW4gYmUgdXNlZnVsIHdoZW4gdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSdzIAoJCSAqIHBhcmVudCBlbGVtZW50IGNoYW5nZXMgKGZvciBleGFtcGxlIGEgd2luZG93IHJlc2l6ZSkuCgkJICogIEBwYXJhbSB7Ym9vbGVhbn0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QsIHlvdSB3aWxsIHR5cGljYWxseSB3YW50IHRvCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAkKHdpbmRvdykuYmluZCgncmVzaXplJywgZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBvVGFibGUuZm5BZGp1c3RDb2x1bW5TaXppbmcoKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkFkanVzdENvbHVtblNpemluZyA9IGZ1bmN0aW9uICggYlJlZHJhdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSh0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSk7CgkJCV9mbkFkanVzdENvbHVtblNpemluZyggb1NldHRpbmdzICk7CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJdGhpcy5mbkRyYXcoIGZhbHNlICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiB8fCBvU2V0dGluZ3Mub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQl7CgkJCQkvKiBJZiBub3QgcmVkcmF3aW5nLCBidXQgc2Nyb2xsaW5nLCB3ZSB3YW50IHRvIGFwcGx5IHRoZSBuZXcgY29sdW1uIHNpemVzIGFueXdheSAqLwoJCQkJdGhpcy5vQXBpLl9mblNjcm9sbERyYXcob1NldHRpbmdzKTsKCQkJfQoJCX07CgkJCgkJCgkJLyoqCgkJICogUXVpY2tseSBhbmQgc2ltcGx5IGNsZWFyIGEgdGFibGUKCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSByZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBJbW1lZGlhdGVseSAnbnVrZScgdGhlIGN1cnJlbnQgcm93cyAocGVyaGFwcyB3YWl0aW5nIGZvciBhbiBBamF4IGNhbGxiYWNrLi4uKQoJCSAqICAgICAgb1RhYmxlLmZuQ2xlYXJUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuQ2xlYXJUYWJsZSA9IGZ1bmN0aW9uKCBiUmVkcmF3ICkKCQl7CgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX07CgkJCgkJCgkJLyoqCgkJICogVGhlIGV4YWN0IG9wcG9zaXRlIG9mICdvcGVuaW5nJyBhIHJvdywgdGhpcyBmdW5jdGlvbiB3aWxsIGNsb3NlIGFueSByb3dzIHdoaWNoIAoJCSAqIGFyZSBjdXJyZW50bHkgJ29wZW4nLgoJCSAqICBAcGFyYW0ge25vZGV9IG5UciB0aGUgdGFibGUgcm93IHRvICdjbG9zZScKCQkgKiAgQHJldHVybnMge2ludH0gMCBvbiBzdWNjZXNzLCBvciAxIGlmIGZhaWxlZCAoY2FuJ3QgZmluZCB0aGUgcm93KQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGU7CgkJICogICAgICAKCQkgKiAgICAgIC8vICdvcGVuJyBhbiBpbmZvcm1hdGlvbiByb3cgd2hlbiBhIHJvdyBpcyBjbGlja2VkIG9uCgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGlmICggb1RhYmxlLmZuSXNPcGVuKHRoaXMpICkgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbkNsb3NlKCB0aGlzICk7CgkJICogICAgICAgIH0gZWxzZSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuT3BlbiggdGhpcywgIlRlbXBvcmFyeSByb3cgb3BlbmVkIiwgImluZm9fcm93IiApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5DbG9zZSA9IGZ1bmN0aW9uKCBuVHIgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5QYXJlbnQgPT0gblRyICkKCQkJCXsKCQkJCQl2YXIgblRyUGFyZW50ID0gb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublRyLnBhcmVudE5vZGU7CgkJCQkJaWYgKCBuVHJQYXJlbnQgKQoJCQkJCXsKCQkJCQkJLyogUmVtb3ZlIGl0IGlmIGl0IGlzIGN1cnJlbnRseSBvbiBkaXNwbGF5ICovCgkJCQkJCW5UclBhcmVudC5yZW1vdmVDaGlsZCggb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublRyICk7CgkJCQkJfQoJCQkJCW9TZXR0aW5ncy5hb09wZW5Sb3dzLnNwbGljZSggaSwgMSApOwoJCQkJCXJldHVybiAwOwoJCQkJfQoJCQl9CgkJCXJldHVybiAxOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUmVtb3ZlIGEgcm93IGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHttaXhlZH0gbVRhcmdldCBUaGUgaW5kZXggb2YgdGhlIHJvdyBmcm9tIGFvRGF0YSB0byBiZSBkZWxldGVkLCBvcgoJCSAqICAgIHRoZSBUUiBlbGVtZW50IHlvdSB3YW50IHRvIGRlbGV0ZQoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufG51bGx9IFtmbkNhbGxCYWNrXSBDYWxsYmFjayBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEByZXR1cm5zIHthcnJheX0gVGhlIHJvdyB0aGF0IHdhcyBkZWxldGVkCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEltbWVkaWF0ZWx5IHJlbW92ZSB0aGUgZmlyc3Qgcm93CgkJICogICAgICBvVGFibGUuZm5EZWxldGVSb3coIDAgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkRlbGV0ZVJvdyA9IGZ1bmN0aW9uKCBtVGFyZ2V0LCBmbkNhbGxCYWNrLCBiUmVkcmF3ICkKCQl7CgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgaSwgaUxlbiwgaUFPRGF0YUluZGV4OwoJCQkKCQkJaUFPRGF0YUluZGV4ID0gKHR5cGVvZiBtVGFyZ2V0ID09PSAnb2JqZWN0JykgPyAKCQkJCV9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1UYXJnZXQpIDogbVRhcmdldDsKCQkJCgkJCS8qIFJldHVybiB0aGUgZGF0YSBhcnJheSBmcm9tIHRoaXMgcm93ICovCgkJCXZhciBvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGEuc3BsaWNlKCBpQU9EYXRhSW5kZXgsIDEgKTsKCQkKCQkJLyogVXBkYXRlIHRoZSBfRFRfUm93SW5kZXggcGFyYW1ldGVyICovCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hb0RhdGFbaV0ublRyLl9EVF9Sb3dJbmRleCA9IGk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlbW92ZSB0aGUgdGFyZ2V0IHJvdyBmcm9tIHRoZSBzZWFyY2ggYXJyYXkgKi8KCQkJdmFyIGlEaXNwbGF5SW5kZXggPSAkLmluQXJyYXkoIGlBT0RhdGFJbmRleCwgb1NldHRpbmdzLmFpRGlzcGxheSApOwoJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoLnNwbGljZSggaURpc3BsYXlJbmRleCwgMSApOwoJCQkKCQkJLyogRGVsZXRlIGZyb20gdGhlIGRpc3BsYXkgYXJyYXlzICovCgkJCV9mbkRlbGV0ZUluZGV4KCBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLCBpQU9EYXRhSW5kZXggKTsKCQkJX2ZuRGVsZXRlSW5kZXgoIG9TZXR0aW5ncy5haURpc3BsYXksIGlBT0RhdGFJbmRleCApOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYSB1c2VyIGNhbGxiYWNrIGZ1bmN0aW9uIC0gY2FsbCBpdCAqLwoJCQlpZiAoIHR5cGVvZiBmbkNhbGxCYWNrID09PSAiZnVuY3Rpb24iICkKCQkJewoJCQkJZm5DYWxsQmFjay5jYWxsKCB0aGlzLCBvU2V0dGluZ3MsIG9EYXRhICk7CgkJCX0KCQkJCgkJCS8qIENoZWNrIGZvciBhbiAnb3ZlcmZsb3cnIHRoZXkgY2FzZSBmb3IgZGlzcGxheWluZyB0aGUgdGFibGUgKi8KCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPj0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCAtPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPCAwICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQlyZXR1cm4gb0RhdGE7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBSZXN0b3JlIHRoZSB0YWJsZSB0byBpdCdzIG9yaWdpbmFsIHN0YXRlIGluIHRoZSBET00gYnkgcmVtb3ZpbmcgYWxsIG9mIERhdGFUYWJsZXMgCgkJICogZW5oYW5jZW1lbnRzLCBhbHRlcmF0aW9ucyB0byB0aGUgRE9NIHN0cnVjdHVyZSBvZiB0aGUgdGFibGUgYW5kIGV2ZW50IGxpc3RlbmVycy4KCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYlJlbW92ZT1mYWxzZV0gQ29tcGxldGVseSByZW1vdmUgdGhlIHRhYmxlIGZyb20gdGhlIERPTQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIC8vIFRoaXMgZXhhbXBsZSBpcyBmYWlybHkgcG9pbnRsZXNzIGluIHJlYWxpdHksIGJ1dCBzaG93cyBob3cgZm5EZXN0cm95IGNhbiBiZSB1c2VkCgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIG9UYWJsZS5mbkRlc3Ryb3koKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkRlc3Ryb3kgPSBmdW5jdGlvbiAoIGJSZW1vdmUgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBuT3JpZyA9IG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyLnBhcmVudE5vZGU7CgkJCXZhciBuQm9keSA9IG9TZXR0aW5ncy5uVEJvZHk7CgkJCXZhciBpLCBpTGVuOwoJCQoJCQliUmVtb3ZlID0gKGJSZW1vdmU9PT11bmRlZmluZWQpID8gZmFsc2UgOiB0cnVlOwoJCQkKCQkJLyogRmxhZyB0byBub3RlIHRoYXQgdGhlIHRhYmxlIGlzIGN1cnJlbnRseSBiZWluZyBkZXN0cm95ZWQgLSBubyBhY3Rpb24gc2hvdWxkIGJlIHRha2VuICovCgkJCW9TZXR0aW5ncy5iRGVzdHJveWluZyA9IHRydWU7CgkJCQoJCQkvKiBGaXJlIG9mZiB0aGUgZGVzdHJveSBjYWxsYmFja3MgZm9yIHBsdWctaW5zIGV0YyAqLwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgImFvRGVzdHJveUNhbGxiYWNrIiwgImRlc3Ryb3kiLCBbb1NldHRpbmdzXSApOwoJCQkKCQkJLyogUmVzdG9yZSBoaWRkZW4gY29sdW1ucyAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgPT09IGZhbHNlICkKCQkJCXsKCQkJCQl0aGlzLmZuU2V0Q29sdW1uVmlzKCBpLCB0cnVlICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEJsaXR6IGFsbCBEVCBldmVudHMgKi8KCQkJJChvU2V0dGluZ3MublRhYmxlV3JhcHBlcikuZmluZCgnKicpLmFuZFNlbGYoKS51bmJpbmQoJy5EVCcpOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYW4gJ2VtcHR5JyBpbmRpY2F0b3Igcm93LCByZW1vdmUgaXQgKi8KCQkJJCgndGJvZHk+dHI+dGQuJytvU2V0dGluZ3Mub0NsYXNzZXMuc1Jvd0VtcHR5LCBvU2V0dGluZ3MublRhYmxlKS5wYXJlbnQoKS5yZW1vdmUoKTsKCQkJCgkJCS8qIFdoZW4gc2Nyb2xsaW5nIHdlIGhhZCB0byBicmVhayB0aGUgdGFibGUgdXAgLSByZXN0b3JlIGl0ICovCgkJCWlmICggb1NldHRpbmdzLm5UYWJsZSAhPSBvU2V0dGluZ3MublRIZWFkLnBhcmVudE5vZGUgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmNoaWxkcmVuKCd0aGVhZCcpLnJlbW92ZSgpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5USGVhZCApOwoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgJiYgb1NldHRpbmdzLm5UYWJsZSAhPSBvU2V0dGluZ3MublRGb290LnBhcmVudE5vZGUgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmNoaWxkcmVuKCd0Zm9vdCcpLnJlbW92ZSgpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5URm9vdCApOwoJCQl9CgkJCQoJCQkvKiBSZW1vdmUgdGhlIERhdGFUYWJsZXMgZ2VuZXJhdGVkIG5vZGVzLCBldmVudHMgYW5kIGNsYXNzZXMgKi8KCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCSQob1NldHRpbmdzLm5UYWJsZVdyYXBwZXIpLnJlbW92ZSgpOwoJCQkKCQkJb1NldHRpbmdzLmFhU29ydGluZyA9IFtdOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgPSBbXTsKCQkJX2ZuU29ydGluZ0NsYXNzZXMoIG9TZXR0aW5ncyApOwoJCQkKCQkJJChfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKSkucmVtb3ZlQ2xhc3MoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMuam9pbignICcpICk7CgkJCQoJCQkkKCd0aCwgdGQnLCBvU2V0dGluZ3MublRIZWFkKS5yZW1vdmVDbGFzcyggWwoJCQkJb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZSwKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVBc2MsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlRGVzYywKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lIF0uam9pbignICcpCgkJCSk7CgkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQl7CgkJCQkkKCd0aCBzcGFuLicrb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SWNvbgoJCQkJCSsgJywgdGQgc3Bhbi4nK29TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb24sIG9TZXR0aW5ncy5uVEhlYWQpLnJlbW92ZSgpOwoJCQoJCQkJJCgndGgsIHRkJywgb1NldHRpbmdzLm5USGVhZCkuZWFjaCggZnVuY3Rpb24gKCkgewoJCQkJCXZhciBqcVdyYXBwZXIgPSAkKCdkaXYuJytvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUlXcmFwcGVyLCB0aGlzKTsKCQkJCQl2YXIga2lkcyA9IGpxV3JhcHBlci5jb250ZW50cygpOwoJCQkJCSQodGhpcykuYXBwZW5kKCBraWRzICk7CgkJCQkJanFXcmFwcGVyLnJlbW92ZSgpOwoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBBZGQgdGhlIFRSIGVsZW1lbnRzIGJhY2sgaW50byB0aGUgdGFibGUgaW4gdGhlaXIgb3JpZ2luYWwgb3JkZXIgKi8KCQkJaWYgKCAhYlJlbW92ZSAmJiBvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgKQoJCQl7CgkJCQluT3JpZy5pbnNlcnRCZWZvcmUoIG9TZXR0aW5ncy5uVGFibGUsIG9TZXR0aW5ncy5uVGFibGVSZWluc2VydEJlZm9yZSApOwoJCQl9CgkJCWVsc2UgaWYgKCAhYlJlbW92ZSApCgkJCXsKCQkJCW5PcmlnLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJbkJvZHkuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5hb0RhdGFbaV0ublRyICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlc3RvcmUgdGhlIHdpZHRoIG9mIHRoZSBvcmlnaW5hbCB0YWJsZSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCA9PT0gdHJ1ZSApCgkJCXsKCQkJICBvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3Mob1NldHRpbmdzLnNEZXN0cm95V2lkdGgpOwoJCQl9CgkJCQoJCQkvKiBJZiB0aGUgd2VyZSBvcmlnaW5hbGx5IG9kZC9ldmVuIHR5cGUgY2xhc3NlcyAtIHRoZW4gd2UgYWRkIHRoZW0gYmFjayBoZXJlLiBOb3RlCgkJCSAqIHRoaXMgaXMgbm90IGZvb2wgcHJvb2YgKGZvciBleGFtcGxlIGlmIG5vdCBhbGwgcm93cyBhcyBvZGQvZXZlbiBjbGFzc2VzIC0gYnV0IAoJCQkgKiBpdCdzIGEgZ29vZCBlZmZvcnQgd2l0aG91dCBnZXR0aW5nIGNhcnJpZWQgYXdheQoJCQkgKi8KCQkJJChuQm9keSkuY2hpbGRyZW4oJ3RyOmV2ZW4nKS5hZGRDbGFzcyggb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKTsKCQkJJChuQm9keSkuY2hpbGRyZW4oJ3RyOm9kZCcpLmFkZENsYXNzKCBvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSApOwoJCQkKCQkJLyogUmVtb3ZlIHRoZSBzZXR0aW5ncyBvYmplY3QgZnJvbSB0aGUgc2V0dGluZ3MgYXJyYXkgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXSA9PSBvU2V0dGluZ3MgKQoJCQkJewoJCQkJCURhdGFUYWJsZS5zZXR0aW5ncy5zcGxpY2UoIGksIDEgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRW5kIGl0IGFsbCAqLwoJCQlvU2V0dGluZ3MgPSBudWxsOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUmVkcmF3IHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiQ29tcGxldGU9dHJ1ZV0gUmUtZmlsdGVyIGFuZCByZXNvcnQgKGlmIGVuYWJsZWQpIHRoZSB0YWJsZSBiZWZvcmUgdGhlIGRyYXcuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFJlLWRyYXcgdGhlIHRhYmxlIC0geW91IHdvdWxkbid0IHdhbnQgdG8gZG8gaXQgaGVyZSwgYnV0IGl0J3MgYW4gZXhhbXBsZSA6LSkKCQkgKiAgICAgIG9UYWJsZS5mbkRyYXcoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkRyYXcgPSBmdW5jdGlvbiggYkNvbXBsZXRlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlpZiAoIGJDb21wbGV0ZSA9PT0gZmFsc2UgKQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5SZURyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIGlucHV0IGJhc2VkIG9uIGRhdGEKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNJbnB1dCBTdHJpbmcgdG8gZmlsdGVyIHRoZSB0YWJsZSBvbgoJCSAqICBAcGFyYW0ge2ludHxudWxsfSBbaUNvbHVtbl0gQ29sdW1uIHRvIGxpbWl0IGZpbHRlcmluZyB0bwoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVnZXg9ZmFsc2VdIFRyZWF0IGFzIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBbYlNtYXJ0PXRydWVdIFBlcmZvcm0gc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiU2hvd0dsb2JhbD10cnVlXSBTaG93IHRoZSBpbnB1dCBnbG9iYWwgZmlsdGVyIGluIGl0J3MgaW5wdXQgYm94KGVzKQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiQ2FzZUluc2Vuc2l0aXZlPXRydWVdIERvIGNhc2UtaW5zZW5zaXRpdmUgbWF0Y2hpbmcgKHRydWUpIG9yIG5vdCAoZmFsc2UpCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFNvbWV0aW1lIGxhdGVyIC0gZmlsdGVyLi4uCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoICd0ZXN0IHN0cmluZycgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkZpbHRlciA9IGZ1bmN0aW9uKCBzSW5wdXQsIGlDb2x1bW4sIGJSZWdleCwgYlNtYXJ0LCBiU2hvd0dsb2JhbCwgYkNhc2VJbnNlbnNpdGl2ZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJaWYgKCBiUmVnZXggPT09IHVuZGVmaW5lZCB8fCBiUmVnZXggPT09IG51bGwgKQoJCQl7CgkJCQliUmVnZXggPSBmYWxzZTsKCQkJfQoJCQkKCQkJaWYgKCBiU21hcnQgPT09IHVuZGVmaW5lZCB8fCBiU21hcnQgPT09IG51bGwgKQoJCQl7CgkJCQliU21hcnQgPSB0cnVlOwoJCQl9CgkJCQoJCQlpZiAoIGJTaG93R2xvYmFsID09PSB1bmRlZmluZWQgfHwgYlNob3dHbG9iYWwgPT09IG51bGwgKQoJCQl7CgkJCQliU2hvd0dsb2JhbCA9IHRydWU7CgkJCX0KCQkJCgkJCWlmICggYkNhc2VJbnNlbnNpdGl2ZSA9PT0gdW5kZWZpbmVkIHx8IGJDYXNlSW5zZW5zaXRpdmUgPT09IG51bGwgKQoJCQl7CgkJCQliQ2FzZUluc2Vuc2l0aXZlID0gdHJ1ZTsKCQkJfQoJCQkKCQkJaWYgKCBpQ29sdW1uID09PSB1bmRlZmluZWQgfHwgaUNvbHVtbiA9PT0gbnVsbCApCgkJCXsKCQkJCS8qIEdsb2JhbCBmaWx0ZXIgKi8KCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIHsKCQkJCQkic1NlYXJjaCI6c0lucHV0KyIiLAoJCQkJCSJiUmVnZXgiOiBiUmVnZXgsCgkJCQkJImJTbWFydCI6IGJTbWFydCwKCQkJCQkiYkNhc2VJbnNlbnNpdGl2ZSI6IGJDYXNlSW5zZW5zaXRpdmUKCQkJCX0sIDEgKTsKCQkJCQoJCQkJaWYgKCBiU2hvd0dsb2JhbCAmJiBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuZiApCgkJCQl7CgkJCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuZjsKCQkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCQl7CgkJCQkJCSQobltpXS5fRFRfSW5wdXQpLnZhbCggc0lucHV0ICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2luZ2xlIGNvbHVtbiBmaWx0ZXIgKi8KCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sdW1uIF0sIHsKCQkJCQkic1NlYXJjaCI6IHNJbnB1dCsiIiwKCQkJCQkiYlJlZ2V4IjogYlJlZ2V4LAoJCQkJCSJiU21hcnQiOiBiU21hcnQsCgkJCQkJImJDYXNlSW5zZW5zaXRpdmUiOiBiQ2FzZUluc2Vuc2l0aXZlCgkJCQl9ICk7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgZGF0YSBmb3IgdGhlIHdob2xlIHRhYmxlLCBhbiBpbmRpdmlkdWFsIHJvdyBvciBhbiBpbmRpdmlkdWFsIGNlbGwgYmFzZWQgb24gdGhlIAoJCSAqIHByb3ZpZGVkIHBhcmFtZXRlcnMuCgkJICogIEBwYXJhbSB7aW50fG5vZGV9IFttUm93XSBBIFRSIHJvdyBub2RlLCBURC9USCBjZWxsIG5vZGUgb3IgYW4gaW50ZWdlci4gSWYgZ2l2ZW4gYXMKCQkgKiAgICBhIFRSIG5vZGUgdGhlbiB0aGUgZGF0YSBzb3VyY2UgZm9yIHRoZSB3aG9sZSByb3cgd2lsbCBiZSByZXR1cm5lZC4gSWYgZ2l2ZW4gYXMgYQoJCSAqICAgIFREL1RIIGNlbGwgbm9kZSB0aGVuIGlDb2wgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQgYW5kIHRoZSBkYXRhIGZvciB0aGUKCQkgKiAgICBjZWxsIHJldHVybmVkLiBJZiBnaXZlbiBhcyBhbiBpbnRlZ2VyLCB0aGVuIHRoaXMgaXMgdHJlYXRlZCBhcyB0aGUgYW9EYXRhIGludGVybmFsCgkJICogICAgZGF0YSBpbmRleCBmb3IgdGhlIHJvdyAoc2VlIGZuR2V0UG9zaXRpb24pIGFuZCB0aGUgZGF0YSBmb3IgdGhhdCByb3cgdXNlZC4KCQkgKiAgQHBhcmFtIHtpbnR9IFtpQ29sXSBPcHRpb25hbCBjb2x1bW4gaW5kZXggdGhhdCB5b3Ugd2FudCB0aGUgZGF0YSBvZi4KCQkgKiAgQHJldHVybnMge2FycmF5fG9iamVjdHxzdHJpbmd9IElmIG1Sb3cgaXMgdW5kZWZpbmVkLCB0aGVuIHRoZSBkYXRhIGZvciBhbGwgcm93cyBpcwoJCSAqICAgIHJldHVybmVkLiBJZiBtUm93IGlzIGRlZmluZWQsIGp1c3QgZGF0YSBmb3IgdGhhdCByb3csIGFuZCBpcyBpQ29sIGlzCgkJICogICAgZGVmaW5lZCwgb25seSBkYXRhIGZvciB0aGUgZGVzaWduYXRlZCBjZWxsIGlzIHJldHVybmVkLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSb3cgZGF0YQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgb1RhYmxlLiQoJ3RyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgdmFyIGRhdGEgPSBvVGFibGUuZm5HZXREYXRhKCB0aGlzICk7CgkJICogICAgICAgIC8vIC4uLiBkbyBzb21ldGhpbmcgd2l0aCB0aGUgYXJyYXkgLyBvYmplY3Qgb2YgZGF0YSBmb3IgdGhlIHJvdwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEluZGl2aWR1YWwgY2VsbCBkYXRhCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICBvVGFibGUuJCgndGQnKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICB2YXIgc0RhdGEgPSBvVGFibGUuZm5HZXREYXRhKCB0aGlzICk7CgkJICogICAgICAgIGFsZXJ0KCAnVGhlIGNlbGwgY2xpY2tlZCBvbiBoYWQgdGhlIHZhbHVlIG9mICcrc0RhdGEgKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkdldERhdGEgPSBmdW5jdGlvbiggbVJvdywgaUNvbCApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggbVJvdyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJdmFyIGlSb3cgPSBtUm93OwoJCQkJaWYgKCB0eXBlb2YgbVJvdyA9PT0gJ29iamVjdCcgKQoJCQkJewoJCQkJCXZhciBzTm9kZSA9IG1Sb3cubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJCQlpZiAoc05vZGUgPT09ICJ0ciIgKQoJCQkJCXsKCQkJCQkJaVJvdyA9IF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1Sb3cpOwoJCQkJCX0KCQkJCQllbHNlIGlmICggc05vZGUgPT09ICJ0ZCIgKQoJCQkJCXsKCQkJCQkJaVJvdyA9IF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1Sb3cucGFyZW50Tm9kZSk7CgkJCQkJCWlDb2wgPSBfZm5Ob2RlVG9Db2x1bW5JbmRleCggb1NldHRpbmdzLCBpUm93LCBtUm93ICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJaWYgKCBpQ29sICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCXJldHVybiBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCAnJyApOwoJCQkJfQoJCQkJcmV0dXJuIChvU2V0dGluZ3MuYW9EYXRhW2lSb3ddIT09dW5kZWZpbmVkKSA/CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgOiBudWxsOwoJCQl9CgkJCXJldHVybiBfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiB0aGUgVFIgbm9kZXMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUncyBib2R5LiBOb3RlIHRoYXQgeW91IHdpbGwgCgkJICogdHlwaWNhbGx5IHdhbnQgdG8gdXNlIHRoZSAnJCcgQVBJIG1ldGhvZCBpbiBwcmVmZXJlbmNlIHRvIHRoaXMgYXMgaXQgaXMgbW9yZSAKCQkgKiBmbGV4aWJsZS4KCQkgKiAgQHBhcmFtIHtpbnR9IFtpUm93XSBPcHRpb25hbCByb3cgaW5kZXggZm9yIHRoZSBUUiBlbGVtZW50IHlvdSB3YW50CgkJICogIEByZXR1cm5zIHthcnJheXxub2RlfSBJZiBpUm93IGlzIHVuZGVmaW5lZCwgcmV0dXJucyBhbiBhcnJheSBvZiBhbGwgVFIgZWxlbWVudHMKCQkgKiAgICBpbiB0aGUgdGFibGUncyBib2R5LCBvciBpUm93IGlzIGRlZmluZWQsIGp1c3QgdGhlIFRSIGVsZW1lbnQgcmVxdWVzdGVkLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBHZXQgdGhlIG5vZGVzIGZyb20gdGhlIHRhYmxlCgkJICogICAgICB2YXIgbk5vZGVzID0gb1RhYmxlLmZuR2V0Tm9kZXMoICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXROb2RlcyA9IGZ1bmN0aW9uKCBpUm93ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJaWYgKCBpUm93ICE9PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gKG9TZXR0aW5ncy5hb0RhdGFbaVJvd10hPT11bmRlZmluZWQpID8KCQkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLm5UciA6IG51bGw7CgkJCX0KCQkJcmV0dXJuIF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBhcnJheSBpbmRleGVzIG9mIGEgcGFydGljdWxhciBjZWxsIGZyb20gaXQncyBET00gZWxlbWVudAoJCSAqIGFuZCBjb2x1bW4gaW5kZXggaW5jbHVkaW5nIGhpZGRlbiBjb2x1bW5zCgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgdGhpcyBjYW4gZWl0aGVyIGJlIGEgVFIsIFREIG9yIFRIIGluIHRoZSB0YWJsZSdzIGJvZHkKCQkgKiAgQHJldHVybnMge2ludH0gSWYgbk5vZGUgaXMgZ2l2ZW4gYXMgYSBUUiwgdGhlbiBhIHNpbmdsZSBpbmRleCBpcyByZXR1cm5lZCwgb3IKCQkgKiAgICBpZiBnaXZlbiBhcyBhIGNlbGwsIGFuIGFycmF5IG9mIFtyb3cgaW5kZXgsIGNvbHVtbiBpbmRleCAodmlzaWJsZSldIGlzIGdpdmVuLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRkJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgLy8gR2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgY3VycmVudCBkYXRhIGZyb20gdGhlIG5vZGUKCQkgKiAgICAgICAgdmFyIGFQb3MgPSBvVGFibGUuZm5HZXRQb3NpdGlvbiggdGhpcyApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gR2V0IHRoZSBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICAgICAgICB2YXIgYURhdGEgPSBvVGFibGUuZm5HZXREYXRhKCBhUG9zWzBdICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBVcGRhdGUgdGhlIGRhdGEgYXJyYXkgYW5kIHJldHVybiB0aGUgdmFsdWUKCQkgKiAgICAgICAgYURhdGFbIGFQb3NbMV0gXSA9ICdjbGlja2VkJzsKCQkgKiAgICAgICAgdGhpcy5pbm5lckhUTUwgPSAnY2xpY2tlZCc7CgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEluaXQgRGF0YVRhYmxlcwoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkdldFBvc2l0aW9uID0gZnVuY3Rpb24oIG5Ob2RlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgc05vZGVOYW1lID0gbk5vZGUubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCgkJCWlmICggc05vZGVOYW1lID09ICJUUiIgKQoJCQl7CgkJCQlyZXR1cm4gX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbk5vZGUpOwoJCQl9CgkJCWVsc2UgaWYgKCBzTm9kZU5hbWUgPT0gIlREIiB8fCBzTm9kZU5hbWUgPT0gIlRIIiApCgkJCXsKCQkJCXZhciBpRGF0YUluZGV4ID0gX2ZuTm9kZVRvRGF0YUluZGV4KCBvU2V0dGluZ3MsIG5Ob2RlLnBhcmVudE5vZGUgKTsKCQkJCXZhciBpQ29sdW1uSW5kZXggPSBfZm5Ob2RlVG9Db2x1bW5JbmRleCggb1NldHRpbmdzLCBpRGF0YUluZGV4LCBuTm9kZSApOwoJCQkJcmV0dXJuIFsgaURhdGFJbmRleCwgX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUob1NldHRpbmdzLCBpQ29sdW1uSW5kZXggKSwgaUNvbHVtbkluZGV4IF07CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBDaGVjayB0byBzZWUgaWYgYSByb3cgaXMgJ29wZW4nIG9yIG5vdC4KCQkgKiAgQHBhcmFtIHtub2RlfSBuVHIgdGhlIHRhYmxlIHJvdyB0byBjaGVjawoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGUgcm93IGlzIGN1cnJlbnRseSBvcGVuLCBmYWxzZSBvdGhlcndpc2UKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlOwoJCSAqICAgICAgCgkJICogICAgICAvLyAnb3BlbicgYW4gaW5mb3JtYXRpb24gcm93IHdoZW4gYSByb3cgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdHInKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBpZiAoIG9UYWJsZS5mbklzT3Blbih0aGlzKSApIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5DbG9zZSggdGhpcyApOwoJCSAqICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbk9wZW4oIHRoaXMsICJUZW1wb3Jhcnkgcm93IG9wZW5lZCIsICJpbmZvX3JvdyIgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuSXNPcGVuID0gZnVuY3Rpb24oIG5UciApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGFvT3BlblJvd3MgPSBvU2V0dGluZ3MuYW9PcGVuUm93czsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublBhcmVudCA9PSBuVHIgKQoJCQkJewoJCQkJCXJldHVybiB0cnVlOwoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gd2lsbCBwbGFjZSBhIG5ldyByb3cgZGlyZWN0bHkgYWZ0ZXIgYSByb3cgd2hpY2ggaXMgY3VycmVudGx5IAoJCSAqIG9uIGRpc3BsYXkgb24gdGhlIHBhZ2UsIHdpdGggdGhlIEhUTUwgY29udGVudHMgdGhhdCBpcyBwYXNzZWQgaW50byB0aGUgCgkJICogZnVuY3Rpb24uIFRoaXMgY2FuIGJlIHVzZWQsIGZvciBleGFtcGxlLCB0byBhc2sgZm9yIGNvbmZpcm1hdGlvbiB0aGF0IGEgCgkJICogcGFydGljdWxhciByZWNvcmQgc2hvdWxkIGJlIGRlbGV0ZWQuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIFRoZSB0YWJsZSByb3cgdG8gJ29wZW4nCgkJICogIEBwYXJhbSB7c3RyaW5nfG5vZGV8alF1ZXJ5fSBtSHRtbCBUaGUgSFRNTCB0byBwdXQgaW50byB0aGUgcm93CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzQ2xhc3MgQ2xhc3MgdG8gZ2l2ZSB0aGUgbmV3IFREIGNlbGwKCQkgKiAgQHJldHVybnMge25vZGV9IFRoZSByb3cgb3BlbmVkLiBOb3RlIHRoYXQgaWYgdGhlIHRhYmxlIHJvdyBwYXNzZWQgaW4gYXMgdGhlCgkJICogICAgZmlyc3QgcGFyYW1ldGVyLCBpcyBub3QgZm91bmQgaW4gdGhlIHRhYmxlLCB0aGlzIG1ldGhvZCB3aWxsIHNpbGVudGx5CgkJICogICAgcmV0dXJuLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGU7CgkJICogICAgICAKCQkgKiAgICAgIC8vICdvcGVuJyBhbiBpbmZvcm1hdGlvbiByb3cgd2hlbiBhIHJvdyBpcyBjbGlja2VkIG9uCgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGlmICggb1RhYmxlLmZuSXNPcGVuKHRoaXMpICkgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbkNsb3NlKCB0aGlzICk7CgkJICogICAgICAgIH0gZWxzZSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuT3BlbiggdGhpcywgIlRlbXBvcmFyeSByb3cgb3BlbmVkIiwgImluZm9fcm93IiApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5PcGVuID0gZnVuY3Rpb24oIG5UciwgbUh0bWwsIHNDbGFzcyApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkKCQkJLyogQ2hlY2sgdGhhdCB0aGUgcm93IGdpdmVuIGlzIGluIHRoZSB0YWJsZSAqLwoJCQl2YXIgblRhYmxlUm93cyA9IF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCQlpZiAoICQuaW5BcnJheShuVHIsIG5UYWJsZVJvd3MpID09PSAtMSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogdGhlIG9sZCBvcGVuIG9uZSBpZiB0aGVyZSBpcyBvbmUgKi8KCQkJdGhpcy5mbkNsb3NlKCBuVHIgKTsKCQkJCgkJCXZhciBuTmV3Um93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHIiKTsKCQkJdmFyIG5OZXdDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsKCQkJbk5ld1Jvdy5hcHBlbmRDaGlsZCggbk5ld0NlbGwgKTsKCQkJbk5ld0NlbGwuY2xhc3NOYW1lID0gc0NsYXNzOwoJCQluTmV3Q2VsbC5jb2xTcGFuID0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICk7CgkJCgkJCWlmICh0eXBlb2YgbUh0bWwgPT09ICJzdHJpbmciKQoJCQl7CgkJCQluTmV3Q2VsbC5pbm5lckhUTUwgPSBtSHRtbDsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQobk5ld0NlbGwpLmh0bWwoIG1IdG1sICk7CgkJCX0KCQkKCQkJLyogSWYgdGhlIG5UciBpc24ndCBvbiB0aGUgcGFnZSBhdCB0aGUgbW9tZW50IC0gdGhlbiB3ZSBkb24ndCBpbnNlcnQgYXQgdGhlIG1vbWVudCAqLwoJCQl2YXIgblRycyA9ICQoJ3RyJywgb1NldHRpbmdzLm5UQm9keSk7CgkJCWlmICggJC5pbkFycmF5KG5UciwgblRycykgIT0gLTEgICkKCQkJewoJCQkJJChuTmV3Um93KS5pbnNlcnRBZnRlcihuVHIpOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MuYW9PcGVuUm93cy5wdXNoKCB7CgkJCQkiblRyIjogbk5ld1JvdywKCQkJCSJuUGFyZW50IjogblRyCgkJCX0gKTsKCQkJCgkJCXJldHVybiBuTmV3Um93OwoJCX07CgkJCgkJCgkJLyoqCgkJICogQ2hhbmdlIHRoZSBwYWdpbmF0aW9uIC0gcHJvdmlkZXMgdGhlIGludGVybmFsIGxvZ2ljIGZvciBwYWdpbmF0aW9uIGluIGEgc2ltcGxlIEFQSSAKCQkgKiBmdW5jdGlvbi4gV2l0aCB0aGlzIGZ1bmN0aW9uIHlvdSBjYW4gaGF2ZSBhIERhdGFUYWJsZXMgdGFibGUgZ28gdG8gdGhlIG5leHQsIAoJCSAqIHByZXZpb3VzLCBmaXJzdCBvciBsYXN0IHBhZ2VzLgoJCSAqICBAcGFyYW0ge3N0cmluZ3xpbnR9IG1BY3Rpb24gUGFnaW5nIGFjdGlvbiB0byB0YWtlOiAiZmlyc3QiLCAicHJldmlvdXMiLCAibmV4dCIgb3IgImxhc3QiCgkJICogICAgb3IgcGFnZSBudW1iZXIgdG8ganVtcCB0byAoaW50ZWdlciksIG5vdGUgdGhhdCBwYWdlIDAgaXMgdGhlIGZpcnN0IHBhZ2UuCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIG9UYWJsZS5mblBhZ2VDaGFuZ2UoICduZXh0JyApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuUGFnZUNoYW5nZSA9IGZ1bmN0aW9uICggbUFjdGlvbiwgYlJlZHJhdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBtQWN0aW9uICk7CgkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFNob3cgYSBwYXJ0aWN1bGFyIGNvbHVtbgoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBUaGUgY29sdW1uIHdob3NlIGRpc3BsYXkgc2hvdWxkIGJlIGNoYW5nZWQKCQkgKiAgQHBhcmFtIHtib29sfSBiU2hvdyBTaG93ICh0cnVlKSBvciBoaWRlIChmYWxzZSkgdGhlIGNvbHVtbgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEhpZGUgdGhlIHNlY29uZCBjb2x1bW4gYWZ0ZXIgaW5pdGlhbGlzYXRpb24KCQkgKiAgICAgIG9UYWJsZS5mblNldENvbHVtblZpcyggMSwgZmFsc2UgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblNldENvbHVtblZpcyA9IGZ1bmN0aW9uICggaUNvbCwgYlNob3csIGJSZWRyYXcgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuOwoJCQl2YXIgYW9Db2x1bW5zID0gb1NldHRpbmdzLmFvQ29sdW1uczsKCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGE7CgkJCXZhciBuVGQsIGJBcHBlbmQsIGlCZWZvcmU7CgkJCQoJCQkvKiBObyBwb2ludCBpbiBkb2luZyBhbnl0aGluZyBpZiB3ZSBhcmUgcmVxdWVzdGluZyB3aGF0IGlzIGFscmVhZHkgdHJ1ZSAqLwoJCQlpZiAoIGFvQ29sdW1uc1tpQ29sXS5iVmlzaWJsZSA9PSBiU2hvdyApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgY29sdW1uICovCgkJCWlmICggYlNob3cgKQoJCQl7CgkJCQl2YXIgaUluc2VydCA9IDA7CgkJCQlmb3IgKCBpPTAgOyBpPGlDb2wgOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCWlJbnNlcnQrKzsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIE5lZWQgdG8gZGVjaWRlIGlmIHdlIHNob3VsZCB1c2UgYXBwZW5kQ2hpbGQgb3IgaW5zZXJ0QmVmb3JlICovCgkJCQliQXBwZW5kID0gKGlJbnNlcnQgPj0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICkpOwoJCQoJCQkJLyogV2hpY2ggY29sb3VtbiBzaG91bGQgd2UgYmUgaW5zZXJ0aW5nIGJlZm9yZT8gKi8KCQkJCWlmICggIWJBcHBlbmQgKQoJCQkJewoJCQkJCWZvciAoIGk9aUNvbCA7IGk8YW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIGFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJCXsKCQkJCQkJCWlCZWZvcmUgPSBpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCWlmICggYkFwcGVuZCApCgkJCQkJCXsKCQkJCQkJCWFvRGF0YVtpXS5uVHIuYXBwZW5kQ2hpbGQoIAoJCQkJCQkJCWFvRGF0YVtpXS5fYW5IaWRkZW5baUNvbF0KCQkJCQkJCSk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlhb0RhdGFbaV0ublRyLmluc2VydEJlZm9yZSgKCQkJCQkJCQlhb0RhdGFbaV0uX2FuSGlkZGVuW2lDb2xdLCAKCQkJCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGkgKVtpQmVmb3JlXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogUmVtb3ZlIGEgY29sdW1uIGZyb20gZGlzcGxheSAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGkgKVtpQ29sXTsKCQkJCQkJYW9EYXRhW2ldLl9hbkhpZGRlbltpQ29sXSA9IG5UZDsKCQkJCQkJblRkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5UZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQkvKiBDbGVhciB0byBzZXQgdGhlIHZpc2libGUgZmxhZyAqLwoJCQlhb0NvbHVtbnNbaUNvbF0uYlZpc2libGUgPSBiU2hvdzsKCQkKCQkJLyogUmVkcmF3IHRoZSBoZWFkZXIgYW5kIGZvb3RlciBiYXNlZCBvbiB0aGUgbmV3IGNvbHVtbiB2aXNpYmlsaXR5ICovCgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQkKCQkJLyogSWYgdGhlcmUgYXJlIGFueSAnb3Blbicgcm93cywgdGhlbiB3ZSBuZWVkIHRvIGFsdGVyIHRoZSBjb2xzcGFuIGZvciB0aGlzIGNvbCBjaGFuZ2UgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5Uci5jb2xTcGFuID0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIERvIGEgcmVkcmF3IGluY2FzZSBhbnl0aGluZyBkZXBlbmRpbmcgb24gdGhlIHRhYmxlIGNvbHVtbnMgbmVlZHMgaXQgCgkJCSAqIChidWlsdC1pbjogc2Nyb2xsaW5nKSAKCQkJICovCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5BZGp1c3RDb2x1bW5TaXppbmcoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCV9mblNhdmVTdGF0ZSggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHNldHRpbmdzIGZvciBhIHBhcnRpY3VsYXIgdGFibGUgZm9yIGV4dGVybmFsIG1hbmlwdWxhdGlvbgoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdC4gU2VlIAoJCSAqICAgIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIHZhciBvU2V0dGluZ3MgPSBvVGFibGUuZm5TZXR0aW5ncygpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTaG93IGFuIGV4YW1wbGUgcGFyYW1ldGVyIGZyb20gdGhlIHNldHRpbmdzCgkJICogICAgICBhbGVydCggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5TZXR0aW5ncyA9IGZ1bmN0aW9uKCkKCQl7CgkJCXJldHVybiBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogU29ydCB0aGUgdGFibGUgYnkgYSBwYXJ0aWN1bGFyIGNvbHVtbgoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCB0aGUgZGF0YSBpbmRleCB0byBzb3J0IG9uLiBOb3RlIHRoYXQgdGhpcyB3aWxsIG5vdCBtYXRjaCB0aGUgCgkJICogICAgJ2Rpc3BsYXkgaW5kZXgnIGlmIHlvdSBoYXZlIGhpZGRlbiBkYXRhIGVudHJpZXMKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29ydCBpbW1lZGlhdGVseSB3aXRoIGNvbHVtbnMgMCBhbmQgMQoJCSAqICAgICAgb1RhYmxlLmZuU29ydCggWyBbMCwnYXNjJ10sIFsxLCdhc2MnXSBdICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5Tb3J0ID0gZnVuY3Rpb24oIGFhU29ydCApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJb1NldHRpbmdzLmFhU29ydGluZyA9IGFhU29ydDsKCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBdHRhY2ggYSBzb3J0IGxpc3RlbmVyIHRvIGFuIGVsZW1lbnQgZm9yIGEgZ2l2ZW4gY29sdW1uCgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgdGhlIGVsZW1lbnQgdG8gYXR0YWNoIHRoZSBzb3J0IGxpc3RlbmVyIHRvCgkJICogIEBwYXJhbSB7aW50fSBpQ29sdW1uIHRoZSBjb2x1bW4gdGhhdCBhIGNsaWNrIG9uIHRoaXMgbm9kZSB3aWxsIHNvcnQgb24KCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gc29ydCBpcyBydW4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29ydCBvbiBjb2x1bW4gMSwgd2hlbiAnc29ydGVyJyBpcyBjbGlja2VkIG9uCgkJICogICAgICBvVGFibGUuZm5Tb3J0TGlzdGVuZXIoIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3J0ZXInKSwgMSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU29ydExpc3RlbmVyID0gZnVuY3Rpb24oIG5Ob2RlLCBpQ29sdW1uLCBmbkNhbGxiYWNrICkKCQl7CgkJCV9mblNvcnRBdHRhY2hMaXN0ZW5lciggX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKSwgbk5vZGUsIGlDb2x1bW4sCgkJCSAJZm5DYWxsYmFjayApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIGEgdGFibGUgY2VsbCBvciByb3cgLSB0aGlzIG1ldGhvZCB3aWxsIGFjY2VwdCBlaXRoZXIgYSBzaW5nbGUgdmFsdWUgdG8KCQkgKiB1cGRhdGUgdGhlIGNlbGwgd2l0aCwgYW4gYXJyYXkgb2YgdmFsdWVzIHdpdGggb25lIGVsZW1lbnQgZm9yIGVhY2ggY29sdW1uIG9yCgkJICogYW4gb2JqZWN0IGluIHRoZSBzYW1lIGZvcm1hdCBhcyB0aGUgb3JpZ2luYWwgZGF0YSBzb3VyY2UuIFRoZSBmdW5jdGlvbiBpcwoJCSAqIHNlbGYtcmVmZXJlbmNpbmcgaW4gb3JkZXIgdG8gbWFrZSB0aGUgbXVsdGkgY29sdW1uIHVwZGF0ZXMgZWFzaWVyLgoJCSAqICBAcGFyYW0ge29iamVjdHxhcnJheXxzdHJpbmd9IG1EYXRhIERhdGEgdG8gdXBkYXRlIHRoZSBjZWxsL3JvdyB3aXRoCgkJICogIEBwYXJhbSB7bm9kZXxpbnR9IG1Sb3cgVFIgZWxlbWVudCB5b3Ugd2FudCB0byB1cGRhdGUgb3IgdGhlIGFvRGF0YSBpbmRleAoJCSAqICBAcGFyYW0ge2ludH0gW2lDb2x1bW5dIFRoZSBjb2x1bW4gdG8gdXBkYXRlIChub3QgdXNlZCBvZiBtRGF0YSBpcyBhbiBhcnJheSBvciBvYmplY3QpCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBbYkFjdGlvbj10cnVlXSBQZXJmb3JtIHByZS1kcmF3IGFjdGlvbnMgb3Igbm90CgkJICogIEByZXR1cm5zIHtpbnR9IDAgb24gc3VjY2VzcywgMSBvbiBlcnJvcgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuVXBkYXRlKCAnRXhhbXBsZSB1cGRhdGUnLCAwLCAwICk7IC8vIFNpbmdsZSBjZWxsCgkJICogICAgICBvVGFibGUuZm5VcGRhdGUoIFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ10sIDEsIDAgKTsgLy8gUm93CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5VcGRhdGUgPSBmdW5jdGlvbiggbURhdGEsIG1Sb3csIGlDb2x1bW4sIGJSZWRyYXcsIGJBY3Rpb24gKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuLCBzRGlzcGxheTsKCQkJdmFyIGlSb3cgPSAodHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVJvdykgOiBtUm93OwoJCQkKCQkJaWYgKCAkLmlzQXJyYXkobURhdGEpICYmIGlDb2x1bW4gPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIEFycmF5IHVwZGF0ZSAtIHVwZGF0ZSB0aGUgd2hvbGUgcm93ICovCgkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YSA9IG1EYXRhLnNsaWNlKCk7CgkJCQkKCQkJCS8qIEZsYWcgdG8gdGhlIGZ1bmN0aW9uIHRoYXQgd2UgYXJlIHJlY3Vyc2luZyAqLwoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdGhpcy5mblVwZGF0ZSggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSApLCBpUm93LCBpLCBmYWxzZSwgZmFsc2UgKTsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggJC5pc1BsYWluT2JqZWN0KG1EYXRhKSAmJiBpQ29sdW1uID09PSB1bmRlZmluZWQgKQoJCQl7CgkJCQkvKiBPYmplY3QgdXBkYXRlIC0gdXBkYXRlIHRoZSB3aG9sZSByb3cgLSBhc3N1bWUgdGhlIGRldmVsb3BlciBnZXRzIHRoZSBvYmplY3QgcmlnaHQgKi8KCQkJCW9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhID0gJC5leHRlbmQoIHRydWUsIHt9LCBtRGF0YSApOwoJCQoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdGhpcy5mblVwZGF0ZSggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSApLCBpUm93LCBpLCBmYWxzZSwgZmFsc2UgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIEluZGl2aWR1YWwgY2VsbCB1cGRhdGUgKi8KCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sIG1EYXRhICk7CgkJCQlzRGlzcGxheSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICdkaXNwbGF5JyApOwoJCQkJCgkJCQl2YXIgb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl07CgkJCQlpZiAoIG9Db2wuZm5SZW5kZXIgIT09IG51bGwgKQoJCQkJewoJCQkJCXNEaXNwbGF5ID0gX2ZuUmVuZGVyKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4gKTsKCQkJCQlpZiAoIG9Db2wuYlVzZVJlbmRlcmVkICkKCQkJCQl7CgkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sIHNEaXNwbGF5ICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQlpZiAoIG9TZXR0aW5ncy5hb0RhdGFbaVJvd10ublRyICE9PSBudWxsICkKCQkJCXsKCQkJCQkvKiBEbyB0aGUgYWN0dWFsIEhUTUwgdXBkYXRlICovCgkJCQkJX2ZuR2V0VGROb2Rlcyggb1NldHRpbmdzLCBpUm93IClbaUNvbHVtbl0uaW5uZXJIVE1MID0gc0Rpc3BsYXk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIE1vZGlmeSB0aGUgc2VhcmNoIGluZGV4IGZvciB0aGlzIHJvdyAoc3RyaWN0bHkgdGhpcyBpcyBsaWtlbHkgbm90IG5lZWRlZCwgc2luY2UgZm5SZURyYXcKCQkJICogd2lsbCByZWJ1aWxkIHRoZSBzZWFyY2ggYXJyYXkgLSBob3dldmVyLCB0aGUgcmVkcmF3IG1pZ2h0IGJlIGRpc2FibGVkIGJ5IHRoZSB1c2VyKQoJCQkgKi8KCQkJdmFyIGlEaXNwbGF5SW5kZXggPSAkLmluQXJyYXkoIGlSb3csIG9TZXR0aW5ncy5haURpc3BsYXkgKTsKCQkJb1NldHRpbmdzLmFzRGF0YVNlYXJjaFtpRGlzcGxheUluZGV4XSA9IF9mbkJ1aWxkU2VhcmNoUm93KAoJCQkJb1NldHRpbmdzLCAKCQkJCV9mbkdldFJvd0RhdGEoIG9TZXR0aW5ncywgaVJvdywgJ2ZpbHRlcicsIF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgJ2JTZWFyY2hhYmxlJyApICkKCQkJKTsKCQkJCgkJCS8qIFBlcmZvcm0gcHJlLWRyYXcgYWN0aW9ucyAqLwoJCQlpZiAoIGJBY3Rpb24gPT09IHVuZGVmaW5lZCB8fCBiQWN0aW9uICkKCQkJewoJCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlyZXR1cm4gMDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIGluIG9yZGVyCgkJICogdG8gZW5zdXJlIGNvbXBhdGliaWxpdHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJCSAqICAgIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSByZXF1aXJlZAoJCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICogIEBtZXRob2QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIGFsZXJ0KCBvVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuVmVyc2lvbkNoZWNrID0gRGF0YVRhYmxlLmV4dC5mblZlcnNpb25DaGVjazsKCQkKCQkKCQkvKgoJCSAqIFRoaXMgaXMgcmVhbGx5IGEgZ29vZCBiaXQgcnViYmlzaCB0aGlzIG1ldGhvZCBvZiBleHBvc2luZyB0aGUgaW50ZXJuYWwgbWV0aG9kcwoJCSAqIHB1YmxpY2x5Li4uIC0gVG8gYmUgZml4ZWQgaW4gMi4wIHVzaW5nIG1ldGhvZHMgb24gdGhlIHByb3RvdHlwZQoJCSAqLwoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIHdyYXBwZXIgZnVuY3Rpb24gZm9yIGV4cG9ydGluZyBhbiBpbnRlcm5hbCBmdW5jdGlvbnMgdG8gYW4gZXh0ZXJuYWwgQVBJLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0Z1bmMgQVBJIGZ1bmN0aW9uIG5hbWUKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSB3cmFwcGVkIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkV4dGVybkFwaUZ1bmMgKHNGdW5jKQoJCXsKCQkJcmV0dXJuIGZ1bmN0aW9uKCkgewoJCQkJdmFyIGFBcmdzID0gW19mblNldHRpbmdzRnJvbU5vZGUodGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0pXS5jb25jYXQoIAoJCQkJCUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykgKTsKCQkJCXJldHVybiBEYXRhVGFibGUuZXh0Lm9BcGlbc0Z1bmNdLmFwcGx5KCB0aGlzLCBhQXJncyApOwoJCQl9OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWZlcmVuY2UgdG8gaW50ZXJuYWwgZnVuY3Rpb25zIGZvciB1c2UgYnkgcGx1Zy1pbiBkZXZlbG9wZXJzLiBOb3RlIHRoYXQgdGhlc2UKCQkgKiBtZXRob2RzIGFyZSByZWZlcmVuY2VzIHRvIGludGVybmFsIGZ1bmN0aW9ucyBhbmQgYXJlIGNvbnNpZGVyZWQgdG8gYmUgcHJpdmF0ZS4KCQkgKiBJZiB5b3UgdXNlIHRoZXNlIG1ldGhvZHMsIGJlIGF3YXJlIHRoYXQgdGhleSBhcmUgbGlhYmxlIHRvIGNoYW5nZSBiZXR3ZWVuIHZlcnNpb25zCgkJICogKGNoZWNrIHRoZSB1cGdyYWRlIG5vdGVzKS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCXRoaXMub0FwaSA9IHsKCQkJIl9mbkV4dGVybkFwaUZ1bmMiOiBfZm5FeHRlcm5BcGlGdW5jLAoJCQkiX2ZuSW5pdGlhbGlzZSI6IF9mbkluaXRpYWxpc2UsCgkJCSJfZm5Jbml0Q29tcGxldGUiOiBfZm5Jbml0Q29tcGxldGUsCgkJCSJfZm5MYW5ndWFnZUNvbXBhdCI6IF9mbkxhbmd1YWdlQ29tcGF0LAoJCQkiX2ZuQWRkQ29sdW1uIjogX2ZuQWRkQ29sdW1uLAoJCQkiX2ZuQ29sdW1uT3B0aW9ucyI6IF9mbkNvbHVtbk9wdGlvbnMsCgkJCSJfZm5BZGREYXRhIjogX2ZuQWRkRGF0YSwKCQkJIl9mbkNyZWF0ZVRyIjogX2ZuQ3JlYXRlVHIsCgkJCSJfZm5HYXRoZXJEYXRhIjogX2ZuR2F0aGVyRGF0YSwKCQkJIl9mbkJ1aWxkSGVhZCI6IF9mbkJ1aWxkSGVhZCwKCQkJIl9mbkRyYXdIZWFkIjogX2ZuRHJhd0hlYWQsCgkJCSJfZm5EcmF3IjogX2ZuRHJhdywKCQkJIl9mblJlRHJhdyI6IF9mblJlRHJhdywKCQkJIl9mbkFqYXhVcGRhdGUiOiBfZm5BamF4VXBkYXRlLAoJCQkiX2ZuQWpheFBhcmFtZXRlcnMiOiBfZm5BamF4UGFyYW1ldGVycywKCQkJIl9mbkFqYXhVcGRhdGVEcmF3IjogX2ZuQWpheFVwZGF0ZURyYXcsCgkJCSJfZm5TZXJ2ZXJQYXJhbXMiOiBfZm5TZXJ2ZXJQYXJhbXMsCgkJCSJfZm5BZGRPcHRpb25zSHRtbCI6IF9mbkFkZE9wdGlvbnNIdG1sLAoJCQkiX2ZuRmVhdHVyZUh0bWxUYWJsZSI6IF9mbkZlYXR1cmVIdG1sVGFibGUsCgkJCSJfZm5TY3JvbGxEcmF3IjogX2ZuU2Nyb2xsRHJhdywKCQkJIl9mbkFkanVzdENvbHVtblNpemluZyI6IF9mbkFkanVzdENvbHVtblNpemluZywKCQkJIl9mbkZlYXR1cmVIdG1sRmlsdGVyIjogX2ZuRmVhdHVyZUh0bWxGaWx0ZXIsCgkJCSJfZm5GaWx0ZXJDb21wbGV0ZSI6IF9mbkZpbHRlckNvbXBsZXRlLAoJCQkiX2ZuRmlsdGVyQ3VzdG9tIjogX2ZuRmlsdGVyQ3VzdG9tLAoJCQkiX2ZuRmlsdGVyQ29sdW1uIjogX2ZuRmlsdGVyQ29sdW1uLAoJCQkiX2ZuRmlsdGVyIjogX2ZuRmlsdGVyLAoJCQkiX2ZuQnVpbGRTZWFyY2hBcnJheSI6IF9mbkJ1aWxkU2VhcmNoQXJyYXksCgkJCSJfZm5CdWlsZFNlYXJjaFJvdyI6IF9mbkJ1aWxkU2VhcmNoUm93LAoJCQkiX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoIjogX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoLAoJCQkiX2ZuRGF0YVRvU2VhcmNoIjogX2ZuRGF0YVRvU2VhcmNoLAoJCQkiX2ZuU29ydCI6IF9mblNvcnQsCgkJCSJfZm5Tb3J0QXR0YWNoTGlzdGVuZXIiOiBfZm5Tb3J0QXR0YWNoTGlzdGVuZXIsCgkJCSJfZm5Tb3J0aW5nQ2xhc3NlcyI6IF9mblNvcnRpbmdDbGFzc2VzLAoJCQkiX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSI6IF9mbkZlYXR1cmVIdG1sUGFnaW5hdGUsCgkJCSJfZm5QYWdlQ2hhbmdlIjogX2ZuUGFnZUNoYW5nZSwKCQkJIl9mbkZlYXR1cmVIdG1sSW5mbyI6IF9mbkZlYXR1cmVIdG1sSW5mbywKCQkJIl9mblVwZGF0ZUluZm8iOiBfZm5VcGRhdGVJbmZvLAoJCQkiX2ZuRmVhdHVyZUh0bWxMZW5ndGgiOiBfZm5GZWF0dXJlSHRtbExlbmd0aCwKCQkJIl9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyI6IF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZywKCQkJIl9mblByb2Nlc3NpbmdEaXNwbGF5IjogX2ZuUHJvY2Vzc2luZ0Rpc3BsYXksCgkJCSJfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCI6IF9mblZpc2libGVUb0NvbHVtbkluZGV4LAoJCQkiX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUiOiBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSwKCQkJIl9mbk5vZGVUb0RhdGFJbmRleCI6IF9mbk5vZGVUb0RhdGFJbmRleCwKCQkJIl9mblZpc2JsZUNvbHVtbnMiOiBfZm5WaXNibGVDb2x1bW5zLAoJCQkiX2ZuQ2FsY3VsYXRlRW5kIjogX2ZuQ2FsY3VsYXRlRW5kLAoJCQkiX2ZuQ29udmVydFRvV2lkdGgiOiBfZm5Db252ZXJ0VG9XaWR0aCwKCQkJIl9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyI6IF9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocywKCQkJIl9mblNjcm9sbGluZ1dpZHRoQWRqdXN0IjogX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QsCgkJCSJfZm5HZXRXaWRlc3ROb2RlIjogX2ZuR2V0V2lkZXN0Tm9kZSwKCQkJIl9mbkdldE1heExlblN0cmluZyI6IF9mbkdldE1heExlblN0cmluZywKCQkJIl9mblN0cmluZ1RvQ3NzIjogX2ZuU3RyaW5nVG9Dc3MsCgkJCSJfZm5EZXRlY3RUeXBlIjogX2ZuRGV0ZWN0VHlwZSwKCQkJIl9mblNldHRpbmdzRnJvbU5vZGUiOiBfZm5TZXR0aW5nc0Zyb21Ob2RlLAoJCQkiX2ZuR2V0RGF0YU1hc3RlciI6IF9mbkdldERhdGFNYXN0ZXIsCgkJCSJfZm5HZXRUck5vZGVzIjogX2ZuR2V0VHJOb2RlcywKCQkJIl9mbkdldFRkTm9kZXMiOiBfZm5HZXRUZE5vZGVzLAoJCQkiX2ZuRXNjYXBlUmVnZXgiOiBfZm5Fc2NhcGVSZWdleCwKCQkJIl9mbkRlbGV0ZUluZGV4IjogX2ZuRGVsZXRlSW5kZXgsCgkJCSJfZm5SZU9yZGVySW5kZXgiOiBfZm5SZU9yZGVySW5kZXgsCgkJCSJfZm5Db2x1bW5PcmRlcmluZyI6IF9mbkNvbHVtbk9yZGVyaW5nLAoJCQkiX2ZuTG9nIjogX2ZuTG9nLAoJCQkiX2ZuQ2xlYXJUYWJsZSI6IF9mbkNsZWFyVGFibGUsCgkJCSJfZm5TYXZlU3RhdGUiOiBfZm5TYXZlU3RhdGUsCgkJCSJfZm5Mb2FkU3RhdGUiOiBfZm5Mb2FkU3RhdGUsCgkJCSJfZm5DcmVhdGVDb29raWUiOiBfZm5DcmVhdGVDb29raWUsCgkJCSJfZm5SZWFkQ29va2llIjogX2ZuUmVhZENvb2tpZSwKCQkJIl9mbkRldGVjdEhlYWRlciI6IF9mbkRldGVjdEhlYWRlciwKCQkJIl9mbkdldFVuaXF1ZVRocyI6IF9mbkdldFVuaXF1ZVRocywKCQkJIl9mblNjcm9sbEJhcldpZHRoIjogX2ZuU2Nyb2xsQmFyV2lkdGgsCgkJCSJfZm5BcHBseVRvQ2hpbGRyZW4iOiBfZm5BcHBseVRvQ2hpbGRyZW4sCgkJCSJfZm5NYXAiOiBfZm5NYXAsCgkJCSJfZm5HZXRSb3dEYXRhIjogX2ZuR2V0Um93RGF0YSwKCQkJIl9mbkdldENlbGxEYXRhIjogX2ZuR2V0Q2VsbERhdGEsCgkJCSJfZm5TZXRDZWxsRGF0YSI6IF9mblNldENlbGxEYXRhLAoJCQkiX2ZuR2V0T2JqZWN0RGF0YUZuIjogX2ZuR2V0T2JqZWN0RGF0YUZuLAoJCQkiX2ZuU2V0T2JqZWN0RGF0YUZuIjogX2ZuU2V0T2JqZWN0RGF0YUZuLAoJCQkiX2ZuQXBwbHlDb2x1bW5EZWZzIjogX2ZuQXBwbHlDb2x1bW5EZWZzLAoJCQkiX2ZuQmluZEFjdGlvbiI6IF9mbkJpbmRBY3Rpb24sCgkJCSJfZm5FeHRlbmQiOiBfZm5FeHRlbmQsCgkJCSJfZm5DYWxsYmFja1JlZyI6IF9mbkNhbGxiYWNrUmVnLAoJCQkiX2ZuQ2FsbGJhY2tGaXJlIjogX2ZuQ2FsbGJhY2tGaXJlLAoJCQkiX2ZuSnNvblN0cmluZyI6IF9mbkpzb25TdHJpbmcsCgkJCSJfZm5SZW5kZXIiOiBfZm5SZW5kZXIsCgkJCSJfZm5Ob2RlVG9Db2x1bW5JbmRleCI6IF9mbk5vZGVUb0NvbHVtbkluZGV4LAoJCQkiX2ZuSW5mb01hY3JvcyI6IF9mbkluZm9NYWNyb3MsCgkJCSJfZm5Ccm93c2VyRGV0ZWN0IjogX2ZuQnJvd3NlckRldGVjdCwKCQkJIl9mbkdldENvbHVtbnMiOiBfZm5HZXRDb2x1bW5zCgkJfTsKCQkKCQkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vQXBpLCB0aGlzLm9BcGkgKTsKCQkKCQlmb3IgKCB2YXIgc0Z1bmMgaW4gRGF0YVRhYmxlLmV4dC5vQXBpICkKCQl7CgkJCWlmICggc0Z1bmMgKQoJCQl7CgkJCQl0aGlzW3NGdW5jXSA9IF9mbkV4dGVybkFwaUZ1bmMoc0Z1bmMpOwoJCQl9CgkJfQoJCQoJCQoJCXZhciBfdGhhdCA9IHRoaXM7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCgkJCXZhciBpPTAsIGlMZW4sIGosIGpMZW4sIGssIGtMZW47CgkJCXZhciBzSWQgPSB0aGlzLmdldEF0dHJpYnV0ZSggJ2lkJyApOwoJCQl2YXIgYkluaXRIYW5kZWRPZmYgPSBmYWxzZTsKCQkJdmFyIGJVc2VQYXNzZWREYXRhID0gZmFsc2U7CgkJCQoJCQkKCQkJLyogU2FuaXR5IGNoZWNrICovCgkJCWlmICggdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9ICd0YWJsZScgKQoJCQl7CgkJCQlfZm5Mb2coIG51bGwsIDAsICJBdHRlbXB0ZWQgdG8gaW5pdGlhbGlzZSBEYXRhVGFibGVzIG9uIGEgbm9kZSB3aGljaCBpcyBub3QgYSAiKwoJCQkJCSJ0YWJsZTogIit0aGlzLm5vZGVOYW1lICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIENoZWNrIHRvIHNlZSBpZiB3ZSBhcmUgcmUtaW5pdGlhbGlzaW5nIGEgdGFibGUgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkvKiBCYXNlIGNoZWNrIG9uIHRhYmxlIG5vZGUgKi8KCQkJCWlmICggRGF0YVRhYmxlLnNldHRpbmdzW2ldLm5UYWJsZSA9PSB0aGlzICkKCQkJCXsKCQkJCQlpZiAoIG9Jbml0ID09PSB1bmRlZmluZWQgfHwgb0luaXQuYlJldHJpZXZlICkKCQkJCQl7CgkJCQkJCXJldHVybiBEYXRhVGFibGUuc2V0dGluZ3NbaV0ub0luc3RhbmNlOwoJCQkJCX0KCQkJCQllbHNlIGlmICggb0luaXQuYkRlc3Ryb3kgKQoJCQkJCXsKCQkJCQkJRGF0YVRhYmxlLnNldHRpbmdzW2ldLm9JbnN0YW5jZS5mbkRlc3Ryb3koKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCV9mbkxvZyggRGF0YVRhYmxlLnNldHRpbmdzW2ldLCAwLCAiQ2Fubm90IHJlaW5pdGlhbGlzZSBEYXRhVGFibGUuXG5cbiIrCgkJCQkJCQkiVG8gcmV0cmlldmUgdGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGlzIHRhYmxlLCBwYXNzIG5vIGFyZ3VtZW50cyBvciBzZWUgIisKCQkJCQkJCSJ0aGUgZG9jcyBmb3IgYlJldHJpZXZlIGFuZCBiRGVzdHJveSIgKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogSWYgdGhlIGVsZW1lbnQgd2UgYXJlIGluaXRpYWxpc2luZyBoYXMgdGhlIHNhbWUgSUQgYXMgYSB0YWJsZSB3aGljaCB3YXMgcHJldmlvdXNseQoJCQkJICogaW5pdGlhbGlzZWQsIGJ1dCB0aGUgdGFibGUgbm9kZXMgZG9uJ3QgbWF0Y2ggKGZyb20gYmVmb3JlKSB0aGVuIHdlIGRlc3Ryb3kgdGhlIG9sZAoJCQkJICogaW5zdGFuY2UgYnkgc2ltcGx5IGRlbGV0aW5nIGl0LiBUaGlzIGlzIHVuZGVyIHRoZSBhc3N1bXB0aW9uIHRoYXQgdGhlIHRhYmxlIGhhcyBiZWVuCgkJCQkgKiBkZXN0cm95ZWQgYnkgb3RoZXIgbWV0aG9kcy4gQW55b25lIHVzaW5nIG5vbi1pZCBzZWxlY3RvcnMgd2lsbCBuZWVkIHRvIGRvIHRoaXMgbWFudWFsbHkKCQkJCSAqLwoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0uc1RhYmxlSWQgPT0gdGhpcy5pZCApCgkJCQl7CgkJCQkJRGF0YVRhYmxlLnNldHRpbmdzLnNwbGljZSggaSwgMSApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBFbnN1cmUgdGhlIHRhYmxlIGhhcyBhbiBJRCAtIHJlcXVpcmVkIGZvciBhY2Nlc3NpYmlsaXR5ICovCgkJCWlmICggc0lkID09PSBudWxsIHx8IHNJZCA9PT0gIiIgKQoJCQl7CgkJCQlzSWQgPSAiRGF0YVRhYmxlc19UYWJsZV8iKyhEYXRhVGFibGUuZXh0Ll9vRXh0ZXJuQ29uZmlnLmlOZXh0VW5pcXVlKyspOwoJCQkJdGhpcy5pZCA9IHNJZDsKCQkJfQoJCQkKCQkJLyogQ3JlYXRlIHRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgdGFibGUgYW5kIHNldCBzb21lIG9mIHRoZSBkZWZhdWx0IHBhcmFtZXRlcnMgKi8KCQkJdmFyIG9TZXR0aW5ncyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MsIHsKCQkJCSJuVGFibGUiOiAgICAgICAgdGhpcywKCQkJCSJvQXBpIjogICAgICAgICAgX3RoYXQub0FwaSwKCQkJCSJvSW5pdCI6ICAgICAgICAgb0luaXQsCgkJCQkic0Rlc3Ryb3lXaWR0aCI6ICQodGhpcykud2lkdGgoKSwKCQkJCSJzSW5zdGFuY2UiOiAgICAgc0lkLAoJCQkJInNUYWJsZUlkIjogICAgICBzSWQKCQkJfSApOwoJCQlEYXRhVGFibGUuc2V0dGluZ3MucHVzaCggb1NldHRpbmdzICk7CgkJCQoJCQkvLyBOZWVkIHRvIGFkZCB0aGUgaW5zdGFuY2UgYWZ0ZXIgdGhlIGluc3RhbmNlIGFmdGVyIHRoZSBzZXR0aW5ncyBvYmplY3QgaGFzIGJlZW4gYWRkZWQKCQkJLy8gdG8gdGhlIHNldHRpbmdzIGFycmF5LCBzbyB3ZSBjYW4gc2VsZiByZWZlcmVuY2UgdGhlIHRhYmxlIGluc3RhbmNlIGlmIG1vcmUgdGhhbiBvbmUKCQkJb1NldHRpbmdzLm9JbnN0YW5jZSA9IChfdGhhdC5sZW5ndGg9PT0xKSA/IF90aGF0IDogJCh0aGlzKS5kYXRhVGFibGUoKTsKCQkJCgkJCS8qIFNldHRpbmcgdXAgdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdCAqLwoJCQlpZiAoICFvSW5pdCApCgkJCXsKCQkJCW9Jbml0ID0ge307CgkJCX0KCQkJCgkJCS8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBiZWZvcmUgd2UgYXBwbHkgYWxsIHRoZSBkZWZhdWx0cwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZSApCgkJCXsKCQkJCV9mbkxhbmd1YWdlQ29tcGF0KCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJb0luaXQgPSBfZm5FeHRlbmQoICQuZXh0ZW5kKHRydWUsIHt9LCBEYXRhVGFibGUuZGVmYXVsdHMpLCBvSW5pdCApOwoJCQkKCQkJLy8gTWFwIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zIG9udG8gdGhlIHNldHRpbmdzIG9iamVjdAoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlBhZ2luYXRlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkxlbmd0aENoYW5nZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJGaWx0ZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiU29ydCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJJbmZvIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlByb2Nlc3NpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiQXV0b1dpZHRoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNvcnRDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNlcnZlclNpZGUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiRGVmZXJSZW5kZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFgiLCAic1giICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFhJbm5lciIsICJzWElubmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxZIiwgInNZIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgImJTY3JvbGxDb2xsYXBzZSIsICJiQ29sbGFwc2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiYlNjcm9sbEluZmluaXRlIiwgImJJbmZpbml0ZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJpU2Nyb2xsTG9hZEdhcCIsICJpTG9hZEdhcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJiU2Nyb2xsQXV0b0NzcyIsICJiQXV0b0NzcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcGVDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhc1N0cmlwQ2xhc3NlcyIsICJhc1N0cmlwZUNsYXNzZXMiICk7IC8vIGxlZ2FjeQoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblNlcnZlckRhdGEiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImZuRm9ybWF0TnVtYmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzU2VydmVyTWV0aG9kIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhYVNvcnRpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImFhU29ydGluZ0ZpeGVkIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhTGVuZ3RoTWVudSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic1BhZ2luYXRpb25UeXBlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQWpheFNvdXJjZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0FqYXhEYXRhUHJvcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaUNvb2tpZUR1cmF0aW9uIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQ29va2llUHJlZml4IiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzRG9tIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJiU29ydENlbGxzVG9wIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpVGFiSW5kZXgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgIm9TZWFyY2giLCAib1ByZXZpb3VzU2VhcmNoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhb1NlYXJjaENvbHMiLCAiYW9QcmVTZWFyY2hDb2xzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpRGlzcGxheUxlbmd0aCIsICJfaURpc3BsYXlMZW5ndGgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImJKUXVlcnlVSSIsICJiSlVJIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmbkNvb2tpZUNhbGxiYWNrIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblN0YXRlTG9hZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TdGF0ZVNhdmUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQsICJmbkluZm9DYWxsYmFjayIgKTsKCQkJCgkJCS8qIENhbGxiYWNrIGZ1bmN0aW9ucyB3aGljaCBhcmUgYXJyYXkgZHJpdmVuICovCgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICAgICAgIG9Jbml0LmZuRHJhd0NhbGxiYWNrLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TZXJ2ZXJQYXJhbXMnLCAgICAgICBvSW5pdC5mblNlcnZlclBhcmFtcywgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU3RhdGVTYXZlUGFyYW1zJywgICAgb0luaXQuZm5TdGF0ZVNhdmVQYXJhbXMsICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZFBhcmFtcycsICAgIG9Jbml0LmZuU3RhdGVMb2FkUGFyYW1zLCAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICAgICAgICBvSW5pdC5mblN0YXRlTG9hZGVkLCAgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvUm93Q2FsbGJhY2snLCAgICAgICAgb0luaXQuZm5Sb3dDYWxsYmFjaywgICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG9Jbml0LmZuQ3JlYXRlZFJvdywgICAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9IZWFkZXJDYWxsYmFjaycsICAgICBvSW5pdC5mbkhlYWRlckNhbGxiYWNrLCAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRm9vdGVyQ2FsbGJhY2snLCAgICAgb0luaXQuZm5Gb290ZXJDYWxsYmFjaywgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0luaXRDb21wbGV0ZScsICAgICAgIG9Jbml0LmZuSW5pdENvbXBsZXRlLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAgICBvSW5pdC5mblByZURyYXdDYWxsYmFjaywgICAndXNlcicgKTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmCgkJCQkgICBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0Q2xhc3NlcyApCgkJCXsKCQkJCS8qIEVuYWJsZSBzb3J0IGNsYXNzZXMgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIFNhZmUgdG8gZG8gaXQgaGVyZSwgc2luY2Ugc2VydmVyLXNpZGUKCQkJCSAqIHByb2Nlc3NpbmcgbXVzdCBiZSBlbmFibGVkIGJ5IHRoZSBkZXZlbG9wZXIKCQkJCSAqLwoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdzZXJ2ZXJfc2lkZV9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkRlZmVyUmVuZGVyICkKCQkJewoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdkZWZlcl9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYkpRdWVyeVVJICkKCQkJewoJCQkJLyogVXNlIHRoZSBKVUkgY2xhc3NlcyBvYmplY3QgZm9yIGRpc3BsYXkuIFlvdSBjb3VsZCBjbG9uZSB0aGUgb1N0ZENsYXNzZXMgb2JqZWN0IGlmIAoJCQkJICogeW91IHdhbnQgdG8gaGF2ZSBtdWx0aXBsZSB0YWJsZXMgd2l0aCBtdWx0aXBsZSBpbmRlcGVuZGVudCBjbGFzc2VzIAoJCQkJICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9DbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9KVUlDbGFzc2VzICk7CgkJCQkKCQkJCWlmICggb0luaXQuc0RvbSA9PT0gRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gJiYgRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gPT09ICJsZnJ0aXAiICkKCQkJCXsKCQkJCQkvKiBTZXQgdGhlIERPTSB0byB1c2UgYSBsYXlvdXQgc3VpdGFibGUgZm9yIGpRdWVyeSBVSSdzIHRoZW1pbmcgKi8KCQkJCQlvU2V0dGluZ3Muc0RvbSA9ICc8IkgibGZyPnQ8IkYiaXA+JzsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3Mub0NsYXNzZXMsIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMgKTsKCQkJfQoJCQkkKHRoaXMpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1RhYmxlICk7CgkJCQoJCQkvKiBDYWxjdWxhdGUgdGhlIHNjcm9sbCBiYXIgd2lkdGggYW5kIGNhY2hlIGl0IGZvciB1c2UgbGF0ZXIgb24gKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoID0gX2ZuU2Nyb2xsQmFyV2lkdGgoKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIERpc3BsYXkgc3RhcnQgcG9pbnQsIHRha2luZyBpbnRvIGFjY291bnQgdGhlIHNhdmUgc2F2aW5nICovCgkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBvSW5pdC5pRGlzcGxheVN0YXJ0OwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb0luaXQuaURpc3BsYXlTdGFydDsKCQkJfQoJCQkKCQkJLyogTXVzdCBiZSBkb25lIGFmdGVyIGV2ZXJ5dGhpbmcgd2hpY2ggY2FuIGJlIG92ZXJyaWRkZW4gYnkgYSBjb29raWUhICovCgkJCWlmICggb0luaXQuYlN0YXRlU2F2ZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSA9IHRydWU7CgkJCQlfZm5Mb2FkU3RhdGUoIG9TZXR0aW5ncywgb0luaXQgKTsKCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNhdmVTdGF0ZSwgJ3N0YXRlX3NhdmUnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuaURlZmVyTG9hZGluZyAhPT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nID0gdHJ1ZTsKCQkJCXZhciB0bXAgPSAkLmlzQXJyYXkoIG9Jbml0LmlEZWZlckxvYWRpbmcgKTsKCQkJCW9TZXR0aW5ncy5faVJlY29yZHNEaXNwbGF5ID0gdG1wID8gb0luaXQuaURlZmVyTG9hZGluZ1swXSA6IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCQlvU2V0dGluZ3MuX2lSZWNvcmRzVG90YWwgPSB0bXAgPyBvSW5pdC5pRGVmZXJMb2FkaW5nWzFdIDogb0luaXQuaURlZmVyTG9hZGluZzsKCQkJfQoJCQkKCQkJaWYgKCBvSW5pdC5hYURhdGEgIT09IG51bGwgKQoJCQl7CgkJCQliVXNlUGFzc2VkRGF0YSA9IHRydWU7CgkJCX0KCQkJCgkJCS8qIExhbmd1YWdlIGRlZmluaXRpb25zICovCgkJCWlmICggb0luaXQub0xhbmd1YWdlLnNVcmwgIT09ICIiICkKCQkJewoJCQkJLyogR2V0IHRoZSBsYW5ndWFnZSBkZWZpbml0aW9ucyBmcm9tIGEgZmlsZSAtIGJlY2F1c2UgdGhpcyBBamF4IGNhbGwgbWFrZXMgdGhlIGxhbmd1YWdlCgkJCQkgKiBnZXQgYXN5bmMgdG8gdGhlIHJlbWFpbmRlciBvZiB0aGlzIGZ1bmN0aW9uIHdlIHVzZSBiSW5pdEhhbmRlZE9mZiB0byBpbmRpY2F0ZSB0aGF0IAoJCQkJICogX2ZuSW5pdGlhbGlzZSB3aWxsIGJlIGZpcmVkIGJ5IHRoZSByZXR1cm5lZCBBamF4IGhhbmRsZXIsIHJhdGhlciB0aGFuIHRoZSBjb25zdHJ1Y3RvcgoJCQkJICovCgkJCQlvU2V0dGluZ3Mub0xhbmd1YWdlLnNVcmwgPSBvSW5pdC5vTGFuZ3VhZ2Uuc1VybDsKCQkJCSQuZ2V0SlNPTiggb1NldHRpbmdzLm9MYW5ndWFnZS5zVXJsLCBudWxsLCBmdW5jdGlvbigganNvbiApIHsKCQkJCQlfZm5MYW5ndWFnZUNvbXBhdCgganNvbiApOwoJCQkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3Mub0xhbmd1YWdlLCBvSW5pdC5vTGFuZ3VhZ2UsIGpzb24gKTsKCQkJCQlfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsKCQkJCX0gKTsKCQkJCWJJbml0SGFuZGVkT2ZmID0gdHJ1ZTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3Mub0xhbmd1YWdlLCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIFN0cmlwZXMKCQkJICovCgkJCWlmICggb0luaXQuYXNTdHJpcGVDbGFzc2VzID09PSBudWxsICkKCQkJewoJCQkJb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3NlcyA9WwoJCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkLAoJCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlRXZlbgoJCQkJXTsKCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHJvdyBzdHJpcGUgY2xhc3NlcyBpZiB0aGV5IGFyZSBhbHJlYWR5IG9uIHRoZSB0YWJsZSByb3cgKi8KCQkJdmFyIGJTdHJpcGVSZW1vdmUgPSBmYWxzZTsKCQkJdmFyIGFuUm93cyA9ICQodGhpcykuY2hpbGRyZW4oJ3Rib2R5JykuY2hpbGRyZW4oJ3RyJyk7CgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5Sb3dzLmZpbHRlcigiOmx0KDIpIikuaGFzQ2xhc3MoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbaV0pICkKCQkJCXsKCQkJCQliU3RyaXBlUmVtb3ZlID0gdHJ1ZTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCQkJCQoJCQlpZiAoIGJTdHJpcGVSZW1vdmUgKQoJCQl7CgkJCQkvKiBTdG9yZSB0aGUgY2xhc3NlcyB3aGljaCB3ZSBhcmUgYWJvdXQgdG8gcmVtb3ZlIHNvIHRoZXkgY2FuIGJlIHJlLWFkZGVkIG9uIGRlc3Ryb3kgKi8KCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzID0gWyAnJywgJycgXTsKCQkJCWlmICggJChhblJvd3NbMF0pLmhhc0NsYXNzKG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKz0gb1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQrIiAiOwoJCQkJfQoJCQkJaWYgKCAkKGFuUm93c1swXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVFdmVuKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKz0gb1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVFdmVuOwoJCQkJfQoJCQkJaWYgKCAkKGFuUm93c1sxXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCsiICI7CgkJCQl9CgkJCQlpZiAoICQoYW5Sb3dzWzFdKS5oYXNDbGFzcyhvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW4pICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW47CgkJCQl9CgkJCQkKCQkJCWFuUm93cy5yZW1vdmVDbGFzcyggb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlcy5qb2luKCcgJykgKTsKCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIENvbHVtbnMKCQkJICogU2VlIGlmIHdlIHNob3VsZCBsb2FkIGNvbHVtbnMgYXV0b21hdGljYWxseSBvciB1c2UgZGVmaW5lZCBvbmVzCgkJCSAqLwoJCQl2YXIgYW5UaHMgPSBbXTsKCQkJdmFyIGFvQ29sdW1uc0luaXQ7CgkJCXZhciBuVGhlYWQgPSB0aGlzLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpOwoJCQlpZiAoIG5UaGVhZC5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlfZm5EZXRlY3RIZWFkZXIoIG9TZXR0aW5ncy5hb0hlYWRlciwgblRoZWFkWzBdICk7CgkJCQlhblRocyA9IF9mbkdldFVuaXF1ZVRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIElmIG5vdCBnaXZlbiBhIGNvbHVtbiBhcnJheSwgZ2VuZXJhdGUgb25lIHdpdGggbnVsbHMgKi8KCQkJaWYgKCBvSW5pdC5hb0NvbHVtbnMgPT09IG51bGwgKQoJCQl7CgkJCQlhb0NvbHVtbnNJbml0ID0gW107CgkJCQlmb3IgKCBpPTAsIGlMZW49YW5UaHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhb0NvbHVtbnNJbml0LnB1c2goIG51bGwgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFvQ29sdW1uc0luaXQgPSBvSW5pdC5hb0NvbHVtbnM7CgkJCX0KCQkJCgkJCS8qIEFkZCB0aGUgY29sdW1ucyAqLwoJCQlmb3IgKCBpPTAsIGlMZW49YW9Db2x1bW5zSW5pdC5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkvKiBTaG9ydCBjdXQgLSB1c2UgdGhlIGxvb3AgdG8gY2hlY2sgaWYgd2UgaGF2ZSBjb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZSB0byByZXN0b3JlICovCgkJCQlpZiAoIG9Jbml0LnNhdmVkX2FvQ29sdW1ucyAhPT0gdW5kZWZpbmVkICYmIG9Jbml0LnNhdmVkX2FvQ29sdW1ucy5sZW5ndGggPT0gaUxlbiApCgkJCQl7CgkJCQkJaWYgKCBhb0NvbHVtbnNJbml0W2ldID09PSBudWxsICkKCQkJCQl7CgkJCQkJCWFvQ29sdW1uc0luaXRbaV0gPSB7fTsKCQkJCQl9CgkJCQkJYW9Db2x1bW5zSW5pdFtpXS5iVmlzaWJsZSA9IG9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXS5iVmlzaWJsZTsKCQkJCX0KCQkJCQoJCQkJX2ZuQWRkQ29sdW1uKCBvU2V0dGluZ3MsIGFuVGhzID8gYW5UaHNbaV0gOiBudWxsICk7CgkJCX0KCQkJCgkJCS8qIEFwcGx5IHRoZSBjb2x1bW4gZGVmaW5pdGlvbnMgKi8KCQkJX2ZuQXBwbHlDb2x1bW5EZWZzKCBvU2V0dGluZ3MsIG9Jbml0LmFvQ29sdW1uRGVmcywgYW9Db2x1bW5zSW5pdCwgZnVuY3Rpb24gKGlDb2wsIG9EZWYpIHsKCQkJCV9mbkNvbHVtbk9wdGlvbnMoIG9TZXR0aW5ncywgaUNvbCwgb0RlZiApOwoJCQl9ICk7CgkJCQoJCQkKCQkJLyoKCQkJICogU29ydGluZwoJCQkgKiBDaGVjayB0aGUgYWFTb3J0aW5nIGFycmF5CgkJCSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPj0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPSAwOwoJCQkJfQoJCQkJdmFyIG9Db2x1bW4gPSBvU2V0dGluZ3MuYW9Db2x1bW5zWyBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdIF07CgkJCQkKCQkJCS8qIEFkZCBhIGRlZmF1bHQgc29ydGluZyBpbmRleCAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPSAwOwoJCQkJfQoJCQkJCgkJCQkvKiBJZiBhYVNvcnRpbmcgaXMgbm90IGRlZmluZWQsIHRoZW4gd2UgdXNlIHRoZSBmaXJzdCBpbmRpY2F0b3IgaW4gYXNTb3J0aW5nICovCgkJCQlpZiAoIG9Jbml0LmFhU29ydGluZyA9PT0gdW5kZWZpbmVkICYmIG9TZXR0aW5ncy5zYXZlZF9hYVNvcnRpbmcgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSA9IG9Db2x1bW4uYXNTb3J0aW5nWzBdOwoJCQkJfQoJCQkJCgkJCQkvKiBTZXQgdGhlIGN1cnJlbnQgc29ydGluZyBpbmRleCBiYXNlZCBvbiBhb0NvbHVtbnMuYXNTb3J0aW5nICovCgkJCQlmb3IgKCBqPTAsIGpMZW49b0NvbHVtbi5hc1NvcnRpbmcubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMV0gPT0gb0NvbHVtbi5hc1NvcnRpbmdbal0gKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGo7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkJCgkJCS8qIERvIGEgZmlyc3QgcGFzcyBvbiB0aGUgc29ydGluZyBjbGFzc2VzIChhbGxvd3MgYW55IHNpemUgY2hhbmdlcyB0byBiZSB0YWtlbiBpbnRvCgkJCSAqIGFjY291bnQsIGFuZCBhbHNvIHdpbGwgYXBwbHkgc29ydGluZyBkaXNhYmxlZCBjbGFzc2VzIGlmIGRpc2FibGVkCgkJCSAqLwoJCQlfZm5Tb3J0aW5nQ2xhc3Nlcyggb1NldHRpbmdzICk7CgkJCQoJCQkKCQkJLyoKCQkJICogRmluYWwgaW5pdAoJCQkgKiBDYWNoZSB0aGUgaGVhZGVyLCBib2R5IGFuZCBmb290ZXIgYXMgcmVxdWlyZWQsIGNyZWF0aW5nIHRoZW0gaWYgbmVlZGVkCgkJCSAqLwoJCQkKCQkJLyogQnJvd3NlciBzdXBwb3J0IGRldGVjdGlvbiAqLwoJCQlfZm5Ccm93c2VyRGV0ZWN0KCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8vIFdvcmsgYXJvdW5kIGZvciBXZWJraXQgYnVnIDgzODY3IC0gc3RvcmUgdGhlIGNhcHRpb24tc2lkZSBiZWZvcmUgcmVtb3ZpbmcgZnJvbSBkb2MKCQkJdmFyIGNhcHRpb25zID0gJCh0aGlzKS5jaGlsZHJlbignY2FwdGlvbicpLmVhY2goIGZ1bmN0aW9uICgpIHsKCQkJCXRoaXMuX2NhcHRpb25TaWRlID0gJCh0aGlzKS5jc3MoJ2NhcHRpb24tc2lkZScpOwoJCQl9ICk7CgkJCQoJCQl2YXIgdGhlYWQgPSAkKHRoaXMpLmNoaWxkcmVuKCd0aGVhZCcpOwoJCQlpZiAoIHRoZWFkLmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXRoZWFkID0gWyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGhlYWQnICkgXTsKCQkJCXRoaXMuYXBwZW5kQ2hpbGQoIHRoZWFkWzBdICk7CgkJCX0KCQkJb1NldHRpbmdzLm5USGVhZCA9IHRoZWFkWzBdOwoJCQkKCQkJdmFyIHRib2R5ID0gJCh0aGlzKS5jaGlsZHJlbigndGJvZHknKTsKCQkJaWYgKCB0Ym9keS5sZW5ndGggPT09IDAgKQoJCQl7CgkJCQl0Ym9keSA9IFsgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3Rib2R5JyApIF07CgkJCQl0aGlzLmFwcGVuZENoaWxkKCB0Ym9keVswXSApOwoJCQl9CgkJCW9TZXR0aW5ncy5uVEJvZHkgPSB0Ym9keVswXTsKCQkJb1NldHRpbmdzLm5UQm9keS5zZXRBdHRyaWJ1dGUoICJyb2xlIiwgImFsZXJ0IiApOwoJCQlvU2V0dGluZ3MublRCb2R5LnNldEF0dHJpYnV0ZSggImFyaWEtbGl2ZSIsICJwb2xpdGUiICk7CgkJCW9TZXR0aW5ncy5uVEJvZHkuc2V0QXR0cmlidXRlKCAiYXJpYS1yZWxldmFudCIsICJhbGwiICk7CgkJCQoJCQl2YXIgdGZvb3QgPSAkKHRoaXMpLmNoaWxkcmVuKCd0Zm9vdCcpOwoJCQlpZiAoIHRmb290Lmxlbmd0aCA9PT0gMCAmJiBjYXB0aW9ucy5sZW5ndGggPiAwICYmIChvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiKSApCgkJCXsKCQkJCS8vIElmIHdlIGFyZSBhIHNjcm9sbGluZyB0YWJsZSwgYW5kIG5vIGZvb3RlciBoYXMgYmVlbiBnaXZlbiwgdGhlbiB3ZSBuZWVkIHRvIGNyZWF0ZQoJCQkJLy8gYSB0Zm9vdCBlbGVtZW50IGZvciB0aGUgY2FwdGlvbiBlbGVtZW50IHRvIGJlIGFwcGVuZGVkIHRvCgkJCQl0Zm9vdCA9IFsgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3Rmb290JyApIF07CgkJCQl0aGlzLmFwcGVuZENoaWxkKCB0Zm9vdFswXSApOwoJCQl9CgkJCQoJCQlpZiAoIHRmb290Lmxlbmd0aCA+IDAgKQoJCQl7CgkJCQlvU2V0dGluZ3MublRGb290ID0gdGZvb3RbMF07CgkJCQlfZm5EZXRlY3RIZWFkZXIoIG9TZXR0aW5ncy5hb0Zvb3Rlciwgb1NldHRpbmdzLm5URm9vdCApOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBpZiB0aGVyZSBpcyBkYXRhIHBhc3NpbmcgaW50byB0aGUgY29uc3RydWN0b3IgKi8KCQkJaWYgKCBiVXNlUGFzc2VkRGF0YSApCgkJCXsKCQkJCWZvciAoIGk9MCA7IGk8b0luaXQuYWFEYXRhLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBvSW5pdC5hYURhdGFbIGkgXSApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogR3JhYiB0aGUgZGF0YSBmcm9tIHRoZSBwYWdlICovCgkJCQlfZm5HYXRoZXJEYXRhKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogQ29weSB0aGUgZGF0YSBpbmRleCBhcnJheSAqLwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkKCQkJLyogSW5pdGlhbGlzYXRpb24gY29tcGxldGUgLSB0YWJsZSBjYW4gYmUgZHJhd24gKi8KCQkJb1NldHRpbmdzLmJJbml0aWFsaXNlZCA9IHRydWU7CgkJCQoJCQkvKiBDaGVjayBpZiB3ZSBuZWVkIHRvIGluaXRpYWxpc2UgdGhlIHRhYmxlIChpdCBtaWdodCBub3QgaGF2ZSBiZWVuIGhhbmRlZCBvZmYgdG8gdGhlCgkJCSAqIGxhbmd1YWdlIHByb2Nlc3NvcikKCQkJICovCgkJCWlmICggYkluaXRIYW5kZWRPZmYgPT09IGZhbHNlICkKCQkJewoJCQkJX2ZuSW5pdGlhbGlzZSggb1NldHRpbmdzICk7CgkJCX0KCQl9ICk7Cgl9OwoKCQoJCgkvKioKCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIGluIG9yZGVyCgkgKiB0byBlbnN1cmUgY29tcGF0aWJpbGl0eS4KCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZlcnNpb24gVmVyc2lvbiBzdHJpbmcgdG8gY2hlY2sgZm9yLCBpbiB0aGUgZm9ybWF0ICJYLlkuWiIuIE5vdGUgdGhhdCB0aGUKCSAqICAgIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIHJlcXVpcmVkCgkgKiAgICB2ZXJzaW9uLCBvciBmYWxzZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhbGVzIGlzIG5vdCBzdWl0YWJsZQoJICogIEBzdGF0aWMKCSAqICBAZHRvcHQgQVBJLVN0YXRpYwoJICoKCSAqICBAZXhhbXBsZQoJICogICAgYWxlcnQoICQuZm4uZGF0YVRhYmxlLmZuVmVyc2lvbkNoZWNrKCAnMS45LjAnICkgKTsKCSAqLwoJRGF0YVRhYmxlLmZuVmVyc2lvbkNoZWNrID0gZnVuY3Rpb24oIHNWZXJzaW9uICkKCXsKCQkvKiBUaGlzIGlzIGNoZWFwLCBidXQgZWZmZWN0aXZlICovCgkJdmFyIGZuWlBhZCA9IGZ1bmN0aW9uIChacGFkLCBjb3VudCkKCQl7CgkJCXdoaWxlKFpwYWQubGVuZ3RoIDwgY291bnQpIHsKCQkJCVpwYWQgKz0gJzAnOwoJCQl9CgkJCXJldHVybiBacGFkOwoJCX07CgkJdmFyIGFUaGlzID0gRGF0YVRhYmxlLmV4dC5zVmVyc2lvbi5zcGxpdCgnLicpOwoJCXZhciBhVGhhdCA9IHNWZXJzaW9uLnNwbGl0KCcuJyk7CgkJdmFyIHNUaGlzID0gJycsIHNUaGF0ID0gJyc7CgkJCgkJZm9yICggdmFyIGk9MCwgaUxlbj1hVGhhdC5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCXsKCQkJc1RoaXMgKz0gZm5aUGFkKCBhVGhpc1tpXSwgMyApOwoJCQlzVGhhdCArPSBmblpQYWQoIGFUaGF0W2ldLCAzICk7CgkJfQoJCQoJCXJldHVybiBwYXJzZUludChzVGhpcywgMTApID49IHBhcnNlSW50KHNUaGF0LCAxMCk7Cgl9OwoJCgkKCS8qKgoJICogQ2hlY2sgaWYgYSBUQUJMRSBub2RlIGlzIGEgRGF0YVRhYmxlIHRhYmxlIGFscmVhZHkgb3Igbm90LgoJICogIEBwYXJhbSB7bm9kZX0gblRhYmxlIFRoZSBUQUJMRSBub2RlIHRvIGNoZWNrIGlmIGl0IGlzIGEgRGF0YVRhYmxlIG9yIG5vdCAobm90ZSB0aGF0IG90aGVyCgkgKiAgICBub2RlIHR5cGVzIGNhbiBiZSBwYXNzZWQgaW4sIGJ1dCB3aWxsIGFsd2F5cyByZXR1cm4gZmFsc2UpLgoJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIHRoZSB0YWJsZSBnaXZlbiBpcyBhIERhdGFUYWJsZSwgb3IgZmFsc2Ugb3RoZXJ3aXNlCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICB2YXIgZXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhhbXBsZScpOwoJICogICAgaWYgKCAhICQuZm4uRGF0YVRhYmxlLmZuSXNEYXRhVGFibGUoIGV4ICkgKSB7CgkgKiAgICAgICQoZXgpLmRhdGFUYWJsZSgpOwoJICogICAgfQoJICovCglEYXRhVGFibGUuZm5Jc0RhdGFUYWJsZSA9IGZ1bmN0aW9uICggblRhYmxlICkKCXsKCQl2YXIgbyA9IERhdGFUYWJsZS5zZXR0aW5nczsKCQoJCWZvciAoIHZhciBpPTAgOyBpPG8ubGVuZ3RoIDsgaSsrICkKCQl7CgkJCWlmICggb1tpXS5uVGFibGUgPT09IG5UYWJsZSB8fCBvW2ldLm5TY3JvbGxIZWFkID09PSBuVGFibGUgfHwgb1tpXS5uU2Nyb2xsRm9vdCA9PT0gblRhYmxlICkKCQkJewoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQl9CgkKCQlyZXR1cm4gZmFsc2U7Cgl9OwoJCgkKCS8qKgoJICogR2V0IGFsbCBEYXRhVGFibGUgdGFibGVzIHRoYXQgaGF2ZSBiZWVuIGluaXRpYWxpc2VkIC0gb3B0aW9uYWxseSB5b3UgY2FuIHNlbGVjdCB0bwoJICogZ2V0IG9ubHkgY3VycmVudGx5IHZpc2libGUgdGFibGVzLgoJICogIEBwYXJhbSB7Ym9vbGVhbn0gW2JWaXNpYmxlPWZhbHNlXSBGbGFnIHRvIGluZGljYXRlIGlmIHlvdSB3YW50IGFsbCAoZGVmYXVsdCkgb3IgCgkgKiAgICB2aXNpYmxlIHRhYmxlcyBvbmx5LgoJICogIEByZXR1cm5zIHthcnJheX0gQXJyYXkgb2YgVEFCTEUgbm9kZXMgKG5vdCBEYXRhVGFibGUgaW5zdGFuY2VzKSB3aGljaCBhcmUgRGF0YVRhYmxlcwoJICogIEBzdGF0aWMKCSAqICBAZHRvcHQgQVBJLVN0YXRpYwoJICoKCSAqICBAZXhhbXBsZQoJICogICAgdmFyIHRhYmxlID0gJC5mbi5kYXRhVGFibGUuZm5UYWJsZXModHJ1ZSk7CgkgKiAgICBpZiAoIHRhYmxlLmxlbmd0aCA+IDAgKSB7CgkgKiAgICAgICQodGFibGUpLmRhdGFUYWJsZSgpLmZuQWRqdXN0Q29sdW1uU2l6aW5nKCk7CgkgKiAgICB9CgkgKi8KCURhdGFUYWJsZS5mblRhYmxlcyA9IGZ1bmN0aW9uICggYlZpc2libGUgKQoJewoJCXZhciBvdXQgPSBbXTsKCQoJCWpRdWVyeS5lYWNoKCBEYXRhVGFibGUuc2V0dGluZ3MsIGZ1bmN0aW9uIChpLCBvKSB7CgkJCWlmICggIWJWaXNpYmxlIHx8IChiVmlzaWJsZSA9PT0gdHJ1ZSAmJiAkKG8ublRhYmxlKS5pcygnOnZpc2libGUnKSkgKQoJCQl7CgkJCQlvdXQucHVzaCggby5uVGFibGUgKTsKCQkJfQoJCX0gKTsKCQoJCXJldHVybiBvdXQ7Cgl9OwoJCgoJLyoqCgkgKiBWZXJzaW9uIHN0cmluZyBmb3IgcGx1Zy1pbnMgdG8gY2hlY2sgY29tcGF0aWJpbGl0eS4gQWxsb3dlZCBmb3JtYXQgaXMKCSAqIGEuYi5jLmQuZSB3aGVyZTogYTppbnQsIGI6aW50LCBjOmludCwgZDpzdHJpbmcoZGV2fGJldGEpLCBlOmludC4gZCBhbmQKCSAqIGUgYXJlIG9wdGlvbmFsCgkgKiAgQG1lbWJlcgoJICogIEB0eXBlIHN0cmluZwoJICogIEBkZWZhdWx0IFZlcnNpb24gbnVtYmVyCgkgKi8KCURhdGFUYWJsZS52ZXJzaW9uID0gIjEuOS4zIjsKCgkvKioKCSAqIFByaXZhdGUgZGF0YSBzdG9yZSwgY29udGFpbmluZyBhbGwgb2YgdGhlIHNldHRpbmdzIG9iamVjdHMgdGhhdCBhcmUgY3JlYXRlZCBmb3IgdGhlCgkgKiB0YWJsZXMgb24gYSBnaXZlbiBwYWdlLgoJICogCgkgKiBOb3RlIHRoYXQgdGhlIDxpPkRhdGFUYWJsZS5zZXR0aW5nczwvaT4gb2JqZWN0IGlzIGFsaWFzZWQgdG8gPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZUV4dDwvaT4gCgkgKiB0aHJvdWdoIHdoaWNoIGl0IG1heSBiZSBhY2Nlc3NlZCBhbmQgbWFuaXB1bGF0ZWQsIG9yIDxpPmpRdWVyeS5mbi5kYXRhVGFibGUuc2V0dGluZ3M8L2k+LgoJICogIEBtZW1iZXIKCSAqICBAdHlwZSBhcnJheQoJICogIEBkZWZhdWx0IFtdCgkgKiAgQHByaXZhdGUKCSAqLwoJRGF0YVRhYmxlLnNldHRpbmdzID0gW107CgoJLyoqCgkgKiBPYmplY3QgbW9kZWxzIGNvbnRhaW5lciwgZm9yIHRoZSB2YXJpb3VzIG1vZGVscyB0aGF0IERhdGFUYWJsZXMgaGFzIGF2YWlsYWJsZQoJICogdG8gaXQuIFRoZXNlIG1vZGVscyBkZWZpbmUgdGhlIG9iamVjdHMgdGhhdCBhcmUgdXNlZCB0byBob2xkIHRoZSBhY3RpdmUgc3RhdGUgCgkgKiBhbmQgY29uZmlndXJhdGlvbiBvZiB0aGUgdGFibGUuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzID0ge307CgkKCQoJLyoqCgkgKiBEYXRhVGFibGVzIGV4dGVuc2lvbiBvcHRpb25zIGFuZCBwbHVnLWlucy4gVGhpcyBuYW1lc3BhY2UgYWN0cyBhcyBhIGNvbGxlY3Rpb24gImFyZWEiCgkgKiBmb3IgcGx1Zy1pbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBleHRlbmQgdGhlIGRlZmF1bHQgRGF0YVRhYmxlcyBiZWhhdmlvdXIgLSBpbmRlZWQgbWFueQoJICogb2YgdGhlIGJ1aWxkIGluIG1ldGhvZHMgdXNlIHRoaXMgbWV0aG9kIHRvIHByb3ZpZGUgdGhlaXIgb3duIGNhcGFiaWxpdGllcyAoc29ydGluZyBtZXRob2RzCgkgKiBmb3IgZXhhbXBsZSkuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG5hbWVzcGFjZSBpcyBhbGlhc2VkIHRvIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQgc28gaXQgY2FuIGJlIHJlYWRpbHkgYWNjZXNzZWQKCSAqIGFuZCBtb2RpZmllZCBieSBwbHVnLWlucy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMuZXh0ID0gewoJCS8qKgoJCSAqIFBsdWctaW4gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIHRoaXMgbWV0aG9kIG9mIGZpbHRlcmluZyBpcyBjb21wbGltZW50YXJ5IHRvIHRoZSBkZWZhdWx0CgkJICogdHlwZSBiYXNlZCBmaWx0ZXJpbmcsIGFuZCBhIGxvdCBtb3JlIGNvbXByZWhlbnNpdmUgYXMgaXQgYWxsb3dzIHlvdSBjb21wbGV0ZSBjb250cm9sCgkJICogb3ZlciB0aGUgZmlsdGVyaW5nIGxvZ2ljLiBFYWNoIGVsZW1lbnQgaW4gdGhpcyBhcnJheSBpcyBhIGZ1bmN0aW9uIChwYXJhbWV0ZXJzCgkJICogZGVzY3JpYmVkIGJlbG93KSB0aGF0IGlzIGNhbGxlZCBmb3IgZXZlcnkgcm93IGluIHRoZSB0YWJsZSwgYW5kIHlvdXIgbG9naWMgZGVjaWRlcyBpZgoJCSAqIGl0IHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgZmlsdGVyZWQgZGF0YSBzZXQgb3Igbm90LgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICA8bGk+e2FycmF5fG9iamVjdH0gRGF0YSBmb3IgdGhlIHJvdyB0byBiZSBwcm9jZXNzZWQgKHNhbWUgYXMgdGhlIG9yaWdpbmFsIGZvcm1hdAoJCSAqICAgICAgICAgICB0aGF0IHdhcyBwYXNzZWQgaW4gYXMgdGhlIGRhdGEgc291cmNlLCBvciBhbiBhcnJheSBmcm9tIGEgRE9NIGRhdGEgc291cmNlPC9saT4KCQkgKiAgICAgICAgIDxsaT57aW50fSBSb3cgaW5kZXggaW4gYW9EYXRhICh7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MuYW9EYXRhfSksIHdoaWNoIGNhbgoJCSAqICAgICAgICAgICBiZSB1c2VmdWwgdG8gcmV0cmlldmUgdGhlIFRSIGVsZW1lbnQgaWYgeW91IG5lZWQgRE9NIGludGVyYWN0aW9uLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2Jvb2xlYW59IEluY2x1ZGUgdGhlIHJvdyBpbiB0aGUgZmlsdGVyZWQgcmVzdWx0IHNldCAodHJ1ZSkgb3Igbm90IChmYWxzZSk8L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVGhlIGZvbGxvd2luZyBleGFtcGxlIHNob3dzIGN1c3RvbSBmaWx0ZXJpbmcgYmVpbmcgYXBwbGllZCB0byB0aGUgZm91cnRoIGNvbHVtbiAoaS5lLgoJCSAqICAgIC8vIHRoZSBhRGF0YVszXSBpbmRleCkgYmFzZWQgb24gdHdvIGlucHV0IHZhbHVlcyBmcm9tIHRoZSBlbmQtdXNlciwgbWF0Y2hpbmcgdGhlIGRhdGEgaW4gCgkJICogICAgLy8gYSBjZXJ0YWluIHJhbmdlLgoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0LmFmbkZpbHRlcmluZy5wdXNoKAoJCSAqICAgICAgZnVuY3Rpb24oIG9TZXR0aW5ncywgYURhdGEsIGlEYXRhSW5kZXggKSB7CgkJICogICAgICAgIHZhciBpTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pbicpLnZhbHVlICogMTsKCQkgKiAgICAgICAgdmFyIGlNYXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF4JykudmFsdWUgKiAxOwoJCSAqICAgICAgICB2YXIgaVZlcnNpb24gPSBhRGF0YVszXSA9PSAiLSIgPyAwIDogYURhdGFbM10qMTsKCQkgKiAgICAgICAgaWYgKCBpTWluID09ICIiICYmIGlNYXggPT0gIiIgKSB7CgkJICogICAgICAgICAgcmV0dXJuIHRydWU7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgZWxzZSBpZiAoIGlNaW4gPT0gIiIgJiYgaVZlcnNpb24gPCBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIGVsc2UgaWYgKCBpTWluIDwgaVZlcnNpb24gJiYgIiIgPT0gaU1heCApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICBlbHNlIGlmICggaU1pbiA8IGlWZXJzaW9uICYmIGlWZXJzaW9uIDwgaU1heCApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICB9CgkJICogICAgKTsKCQkgKi8KCQkiYWZuRmlsdGVyaW5nIjogW10sCgkKCQoJCS8qKgoJCSAqIFBsdWctaW4gc29ydGluZyBmdW5jdGlvbnMgLSB0aGlzIG1ldGhvZCBvZiBzb3J0aW5nIGlzIGNvbXBsaW1lbnRhcnkgdG8gdGhlIGRlZmF1bHQgdHlwZQoJCSAqIGJhc2VkIHNvcnRpbmcgdGhhdCBEYXRhVGFibGVzIGRvZXMgYXV0b21hdGljYWxseSwgYWxsb3dpbmcgbXVjaCBncmVhdGVyIGNvbnRyb2wgb3ZlciB0aGUKCQkgKiB0aGUgZGF0YSB0aGF0IGlzIGJlaW5nIHVzZWQgdG8gc29ydCBhIGNvbHVtbi4gVGhpcyBpcyB1c2VmdWwgaWYgeW91IHdhbnQgdG8gZG8gc29ydGluZwoJCSAqIGJhc2VkIG9uIGxpdmUgZGF0YSAoZm9yIGV4YW1wbGUgdGhlIGNvbnRlbnRzIG9mIGFuICdpbnB1dCcgZWxlbWVudCkgcmF0aGVyIHRoYW4ganVzdCB0aGUKCQkgKiBzdGF0aWMgc3RyaW5nIHRoYXQgRGF0YVRhYmxlcyBrbm93cyBvZi4gVGhlIHdheSB0aGVzZSBwbHVnLWlucyB3b3JrIGlzIHRoYXQgeW91IGNyZWF0ZQoJCSAqIGFuIGFycmF5IG9mIHRoZSB2YWx1ZXMgeW91IHdpc2ggdG8gYmUgc29ydGVkIGZvciB0aGUgY29sdW1uIGluIHF1ZXN0aW9uIGFuZCB0aGVuIHJldHVybgoJCSAqIHRoYXQgYXJyYXkuIFdoaWNoIHByZS1zb3J0aW5nIGZ1bmN0aW9uIGlzIHJ1biBoZXJlIGRlcGVuZHMgb24gdGhlIHNTb3J0RGF0YVR5cGUgcGFyYW1ldGVyCgkJICogdGhhdCBpcyB1c2VkIGZvciB0aGUgY29sdW1uIChpZiBhbnkpLiBUaGlzIGlzIHRoZSBjb3JvbGxhcnkgb2YgPGk+b2ZuU2VhcmNoPC9pPiBmb3Igc29ydCAKCQkgKiBkYXRhLgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkgICAgICogICAgICAgICA8bGk+e2ludH0gVGFyZ2V0IGNvbHVtbiBpbmRleDwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2FycmF5fSBEYXRhIGZvciB0aGUgY29sdW1uIHRvIGJlIHNvcnRlZCB1cG9uPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgCgkJICogTm90ZSB0aGF0IGFzIG9mIHYxLjksIGl0IGlzIHR5cGljYWxseSBwcmVmZXJhYmxlIHRvIHVzZSA8aT5tRGF0YTwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhPC9pPiB3aGVuCgkJICogdXNlZCBhcyBhIGZ1bmN0aW9uIHdpbGwgZ2l2ZSB5b3UgYSAndHlwZScgKHNvcnRpbmcsIGZpbHRlcmluZyBldGMpIHRoYXQgeW91IGNhbiB1c2UgdG8gCgkJICogcHJlcGFyZSB0aGUgZGF0YSBhcyByZXF1aXJlZCBmb3IgdGhlIGRpZmZlcmVudCB0eXBlcy4gQXMgc3VjaCwgdGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVwZGF0aW5nIHRoZSBjYWNoZWQgc29ydGluZyBpbmZvcm1hdGlvbiB3aXRoIHVzZXIgZW50ZXJlZCB2YWx1ZXMgaW4gSFRNTCBpbnB1dCBlbGVtZW50cwoJCSAqICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQuYWZuU29ydERhdGFbJ2RvbS10ZXh0J10gPSBmdW5jdGlvbiAoIG9TZXR0aW5ncywgaUNvbHVtbiApCgkJICogICAgewoJCSAqICAgICAgdmFyIGFEYXRhID0gW107CgkJICogICAgICAkKCAndGQ6ZXEoJytpQ29sdW1uKycpIGlucHV0Jywgb1NldHRpbmdzLm9BcGkuX2ZuR2V0VHJOb2RlcyhvU2V0dGluZ3MpICkuZWFjaCggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBhRGF0YS5wdXNoKCB0aGlzLnZhbHVlICk7CgkJICogICAgICB9ICk7CgkJICogICAgICByZXR1cm4gYURhdGE7CgkJICogICAgfQoJCSAqLwoJCSJhZm5Tb3J0RGF0YSI6IFtdLAoJCgkKCQkvKioKCQkgKiBGZWF0dXJlIHBsdWctaW5zIC0gVGhpcyBpcyBhbiBhcnJheSBvZiBvYmplY3RzIHdoaWNoIGRlc2NyaWJlIHRoZSBmZWF0dXJlIHBsdWctaW5zIHRoYXQgYXJlCgkJICogYXZhaWxhYmxlIHRvIERhdGFUYWJsZXMuIFRoZXNlIGZlYXR1cmUgcGx1Zy1pbnMgYXJlIGFjY2Vzc2libGUgdGhyb3VnaCB0aGUgc0RvbSBpbml0aWFsaXNhdGlvbgoJCSAqIG9wdGlvbi4gQXMgc3VjaCwgZWFjaCBmZWF0dXJlIHBsdWctaW4gbXVzdCBkZXNjcmliZSBhIGZ1bmN0aW9uIHRoYXQgaXMgdXNlZCB0byBpbml0aWFsaXNlCgkJICogaXRzZWxmIChmbkluaXQpLCBhIGNoYXJhY3RlciBzbyB0aGUgZmVhdHVyZSBjYW4gYmUgZW5hYmxlZCBieSBzRG9tIChjRmVhdHVyZSkgYW5kIHRoZSBuYW1lCgkJICogb2YgdGhlIGZlYXR1cmUgKHNGZWF0dXJlKS4gVGh1cyB0aGUgb2JqZWN0cyBhdHRhY2hlZCB0byB0aGlzIG1ldGhvZCBtdXN0IHByb3ZpZGU6CgkJICogICA8dWw+CgkJICogICAgIDxsaT57ZnVuY3Rpb259IGZuSW5pdCBJbml0aWFsaXNhdGlvbiBvZiB0aGUgcGx1Zy1pbgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCSAgICAgKiAgICAgICAgICAgPC91bD4KCSAgICAgKiAgICAgICAgIDwvbGk+CgkJICogICAgICAgICA8bGk+CgkJICogICAgICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57bm9kZXxudWxsfSBUaGUgZWxlbWVudCB3aGljaCBjb250YWlucyB5b3VyIGZlYXR1cmUuIE5vdGUgdGhhdCB0aGUgcmV0dXJuCgkJICogICAgICAgICAgICAgICAgbWF5IGFsc28gYmUgdm9pZCBpZiB5b3VyIHBsdWctaW4gZG9lcyBub3QgcmVxdWlyZSB0byBpbmplY3QgYW55IERPTSBlbGVtZW50cyAKCQkgKiAgICAgICAgICAgICAgICBpbnRvIERhdGFUYWJsZXMgY29udHJvbCAoc0RvbSkgLSBmb3IgZXhhbXBsZSB0aGlzIG1pZ2h0IGJlIHVzZWZ1bCB3aGVuIAoJCSAqICAgICAgICAgICAgICAgIGRldmVsb3BpbmcgYSBwbHVnLWluIHdoaWNoIGFsbG93cyB0YWJsZSBjb250cm9sIHZpYSBrZXlib2FyZCBlbnRyeS48L2xpPgoJCSAqICAgICAgICAgICA8L3VsPgoJCSAqICAgICAgICAgPC9pbD4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+e2NoYXJhY3Rlcn0gY0ZlYXR1cmUgQ2hhcmFjdGVyIHRoYXQgd2lsbCBiZSBtYXRjaGVkIGluIHNEb20gLSBjYXNlIHNlbnNpdGl2ZTwvbGk+CgkJICogICAgIDxsaT57c3RyaW5nfSBzRmVhdHVyZSBGZWF0dXJlIG5hbWU8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBIb3cgVGFibGVUb29scyBpbml0aWFsaXNlcyBpdHNlbGYuCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQuYW9GZWF0dXJlcy5wdXNoKCB7CgkJICogICAgICAiZm5Jbml0IjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgcmV0dXJuIG5ldyBUYWJsZVRvb2xzKCB7ICJvRFRTZXR0aW5ncyI6IG9TZXR0aW5ncyB9ICk7CgkJICogICAgICB9LAoJCSAqICAgICAgImNGZWF0dXJlIjogIlQiLAoJCSAqICAgICAgInNGZWF0dXJlIjogIlRhYmxlVG9vbHMiCgkJICogICAgfSApOwoJCSAqLwoJCSJhb0ZlYXR1cmVzIjogW10sCgkKCQoJCS8qKgoJCSAqIFR5cGUgZGV0ZWN0aW9uIHBsdWctaW4gZnVuY3Rpb25zIC0gRGF0YVRhYmxlcyB1dGlsaXNlcyB0eXBlcyB0byBkZWZpbmUgaG93IHNvcnRpbmcgYW5kCgkJICogZmlsdGVyaW5nIGJlaGF2ZSwgYW5kIHR5cGVzIGNhbiBiZSBlaXRoZXIgIGJlIGRlZmluZWQgYnkgdGhlIGRldmVsb3BlciAoc1R5cGUgZm9yIHRoZQoJCSAqIGNvbHVtbikgb3IgdGhleSBjYW4gYmUgYXV0b21hdGljYWxseSBkZXRlY3RlZCBieSB0aGUgbWV0aG9kcyBpbiB0aGlzIGFycmF5LiBUaGUgZnVuY3Rpb25zCgkJICogZGVmaW5lZCBpbiB0aGUgYXJyYXkgYXJlIHF1aXRlIHNpbXBsZSwgdGFraW5nIGEgc2luZ2xlIHBhcmFtZXRlciAodGhlIGRhdGEgdG8gYW5hbHlzZSkgCgkJICogYW5kIHJldHVybmluZyB0aGUgdHlwZSBpZiBpdCBpcyBhIGtub3duIHR5cGUsIG9yIG51bGwgb3RoZXJ3aXNlLgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+eyp9IERhdGEgZnJvbSB0aGUgY29sdW1uIGNlbGwgdG8gYmUgYW5hbHlzZWQ8L2xpPgoJICAgICAqICAgICAgIDwvdWw+CgkgICAgICogICAgIDwvbGk+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBGdW5jdGlvbiByZXR1cm46CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd8bnVsbH0gRGF0YSB0eXBlIGRldGVjdGVkLCBvciBudWxsIGlmIHVua25vd24gKGFuZCB0aHVzIHBhc3MgaXQKCQkgKiAgICAgICAgICAgb24gdG8gdGhlIG90aGVyIHR5cGUgZGV0ZWN0aW9uIGZ1bmN0aW9ucy48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDdXJyZW5jeSB0eXBlIGRldGVjdGlvbiBwbHVnLWluOgoJCSAqICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQuYVR5cGVzLnB1c2goCgkJICogICAgICBmdW5jdGlvbiAoIHNEYXRhICkgewoJCSAqICAgICAgICB2YXIgc1ZhbGlkQ2hhcnMgPSAiMDEyMzQ1Njc4OS4tIjsKCQkgKiAgICAgICAgdmFyIENoYXI7CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBDaGVjayB0aGUgbnVtZXJpYyBwYXJ0CgkJICogICAgICAgIGZvciAoIGk9MSA7IGk8c0RhdGEubGVuZ3RoIDsgaSsrICkgewoJCSAqICAgICAgICAgIENoYXIgPSBzRGF0YS5jaGFyQXQoaSk7IAoJCSAqICAgICAgICAgIGlmIChzVmFsaWRDaGFycy5pbmRleE9mKENoYXIpID09IC0xKSB7CgkJICogICAgICAgICAgICByZXR1cm4gbnVsbDsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIENoZWNrIHByZWZpeGVkIGJ5IGN1cnJlbmN5CgkJICogICAgICAgIGlmICggc0RhdGEuY2hhckF0KDApID09ICckJyB8fCBzRGF0YS5jaGFyQXQoMCkgPT0gJyZwb3VuZDsnICkgewoJCSAqICAgICAgICAgIHJldHVybiAnY3VycmVuY3knOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIHJldHVybiBudWxsOwoJCSAqICAgICAgfQoJCSAqICAgICk7CgkJICovCgkJImFUeXBlcyI6IFtdLAoJCgkKCQkvKioKCQkgKiBQcm92aWRlIGEgY29tbW9uIG1ldGhvZCBmb3IgcGx1Zy1pbnMgdG8gY2hlY2sgdGhlIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBiZWluZyB1c2VkLCAKCQkgKiBpbiBvcmRlciB0byBlbnN1cmUgY29tcGF0aWJpbGl0eS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWZXJzaW9uIFZlcnNpb24gc3RyaW5nIHRvIGNoZWNrIGZvciwgaW4gdGhlIGZvcm1hdCAiWC5ZLloiLiBOb3RlIAoJCSAqICAgIHRoYXQgdGhlIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSAKCQkgKiAgICByZXF1aXJlZCB2ZXJzaW9uLCBvciBmYWxzZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhbGVzIGlzIG5vdCBzdWl0YWJsZQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIGFsZXJ0KCBvVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5WZXJzaW9uQ2hlY2siOiBEYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2ssCgkKCQoJCS8qKgoJCSAqIEluZGV4IGZvciB3aGF0ICd0aGlzJyBpbmRleCBBUEkgZnVuY3Rpb25zIHNob3VsZCB1c2UKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiaUFwaUluZGV4IjogMCwKCQoJCgkJLyoqCgkJICogUHJlLXByb2Nlc3Npbmcgb2YgZmlsdGVyaW5nIGRhdGEgcGx1Zy1pbnMgLSBXaGVuIHlvdSBhc3NpZ24gdGhlIHNUeXBlIGZvciBhIGNvbHVtbgoJCSAqIChvciBoYXZlIGl0IGF1dG9tYXRpY2FsbHkgZGV0ZWN0ZWQgZm9yIHlvdSBieSBEYXRhVGFibGVzIG9yIGEgdHlwZSBkZXRlY3Rpb24gcGx1Zy1pbiksIAoJCSAqIHlvdSB3aWxsIHR5cGljYWxseSBiZSB1c2luZyB0aGlzIGZvciBjdXN0b20gc29ydGluZywgYnV0IGl0IGNhbiBhbHNvIGJlIHVzZWQgdG8gcHJvdmlkZSAKCQkgKiBjdXN0b20gZmlsdGVyaW5nIGJ5IGFsbG93aW5nIHlvdSB0byBwcmUtcHJvY2Vzc2luZyB0aGUgZGF0YSBhbmQgcmV0dXJuaW5nIHRoZSBkYXRhIGluCgkJICogdGhlIGZvcm1hdCB0aGF0IHNob3VsZCBiZSBmaWx0ZXJlZCB1cG9uLiBUaGlzIGlzIGRvbmUgYnkgYWRkaW5nIGZ1bmN0aW9ucyB0aGlzIG9iamVjdCAKCQkgKiB3aXRoIGEgcGFyYW1ldGVyIG5hbWUgd2hpY2ggbWF0Y2hlcyB0aGUgc1R5cGUgZm9yIHRoYXQgdGFyZ2V0IGNvbHVtbi4gVGhpcyBpcyB0aGUKCQkgKiBjb3JvbGxhcnkgb2YgPGk+YWZuU29ydERhdGE8L2k+IGZvciBmaWx0ZXJpbmcgZGF0YS4KCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIGZyb20gdGhlIGNvbHVtbiBjZWxsIHRvIGJlIHByZXBhcmVkIGZvciBmaWx0ZXJpbmc8L2xpPgoJICAgICAqICAgICAgIDwvdWw+CgkgICAgICogICAgIDwvbGk+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBGdW5jdGlvbiByZXR1cm46CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd8bnVsbH0gRm9ybWF0dGVkIHN0cmluZyB0aGF0IHdpbGwgYmUgdXNlZCBmb3IgdGhlIGZpbHRlcmluZy48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqIAoJCSAqIE5vdGUgdGhhdCBhcyBvZiB2MS45LCBpdCBpcyB0eXBpY2FsbHkgcHJlZmVyYWJsZSB0byB1c2UgPGk+bURhdGE8L2k+IHRvIHByZXBhcmUgZGF0YSBmb3IKCQkgKiB0aGUgZGlmZmVyZW50IHVzZXMgdGhhdCBEYXRhVGFibGVzIGNhbiBwdXQgdGhlIGRhdGEgdG8uIFNwZWNpZmljYWxseSA8aT5tRGF0YTwvaT4gd2hlbgoJCSAqIHVzZWQgYXMgYSBmdW5jdGlvbiB3aWxsIGdpdmUgeW91IGEgJ3R5cGUnIChzb3J0aW5nLCBmaWx0ZXJpbmcgZXRjKSB0aGF0IHlvdSBjYW4gdXNlIHRvIAoJCSAqIHByZXBhcmUgdGhlIGRhdGEgYXMgcmVxdWlyZWQgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMuIEFzIHN1Y2gsIHRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQub2ZuU2VhcmNoWyd0aXRsZS1udW1lcmljJ10gPSBmdW5jdGlvbiAoIHNEYXRhICkgewoJCSAqICAgICAgcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1xuL2csIiAiKS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkgKiAgICB9CgkJICovCgkJIm9mblNlYXJjaCI6IHt9LAoJCgkKCQkvKioKCQkgKiBDb250YWluZXIgZm9yIGFsbCBwcml2YXRlIGZ1bmN0aW9ucyBpbiBEYXRhVGFibGVzIHNvIHRoZXkgY2FuIGJlIGV4cG9zZWQgZXh0ZXJuYWxseQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0FwaSI6IHt9LAoJCgkKCQkvKioKCQkgKiBTdG9yYWdlIGZvciB0aGUgdmFyaW91cyBjbGFzc2VzIHRoYXQgRGF0YVRhYmxlcyB1c2VzCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvU3RkQ2xhc3NlcyI6IHt9LAoJCQoJCgkJLyoqCgkJICogU3RvcmFnZSBmb3IgdGhlIHZhcmlvdXMgY2xhc3NlcyB0aGF0IERhdGFUYWJsZXMgdXNlcyAtIGpRdWVyeSBVSSBzdWl0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0pVSUNsYXNzZXMiOiB7fSwKCQoJCgkJLyoqCgkJICogUGFnaW5hdGlvbiBwbHVnLWluIG1ldGhvZHMgLSBUaGUgc3R5bGUgYW5kIGNvbnRyb2xzIG9mIHRoZSBwYWdpbmF0aW9uIGNhbiBzaWduaWZpY2FudGx5IAoJCSAqIGltcGFjdCBvbiBob3cgdGhlIGVuZCB1c2VyIGludGVyYWN0cyB3aXRoIHRoZSBkYXRhIGluIHlvdXIgdGFibGUsIGFuZCBEYXRhVGFibGVzIGFsbG93cyAKCQkgKiB0aGUgYWRkaXRpb24gb2YgcGFnaW5hdGlvbiBjb250cm9scyBieSBleHRlbmRpbmcgdGhpcyBvYmplY3QsIHdoaWNoIGNhbiB0aGVuIGJlIGVuYWJsZWQKCQkgKiB0aHJvdWdoIHRoZSA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IGluaXRpYWxpc2F0aW9uIHBhcmFtZXRlci4gRWFjaCBwYWdpbmF0aW9uIHR5cGUgdGhhdAoJCSAqIGlzIGFkZGVkIGlzIGFuIG9iamVjdCAodGhlIHByb3BlcnR5IG5hbWUgb2Ygd2hpY2ggaXMgd2hhdCA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IHJlZmVycwoJCSAqIHRvKSB0aGF0IGhhcyB0d28gcHJvcGVydGllcywgYm90aCBtZXRob2RzIHRoYXQgYXJlIHVzZWQgYnkgRGF0YVRhYmxlcyB0byB1cGRhdGUgdGhlCgkJICogY29udHJvbCdzIHN0YXRlLgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwYWdpbmcgY29udHJvbHMuIENhbGxlZCBvbmx5IGR1cmluZyBpbml0aWFsaXNhdGlvbiAKCQkgKiAgICAgICAgIG9mIHRoZSB0YWJsZS4gSXQgaXMgZXhwZWN0ZWQgdGhhdCB0aGlzIGZ1bmN0aW9uIHdpbGwgYWRkIHRoZSByZXF1aXJlZCBET00gZWxlbWVudHMgCgkJICogICAgICAgICB0byB0aGUgcGFnZSBmb3IgdGhlIHBhZ2luZyBjb250cm9scyB0byB3b3JrLiBUaGUgZWxlbWVudCBwb2ludGVyIAoJCSAqICAgICAgICAgJ29TZXR0aW5ncy5hYW5GZWF0dXJlcy5wJyBhcnJheSBpcyBwcm92aWRlZCBieSBEYXRhVGFibGVzIHRvIGNvbnRhaW4gdGhlIHBhZ2luZyAKCQkgKiAgICAgICAgIGNvbnRyb2xzIChub3RlIHRoYXQgdGhpcyBpcyBhIDJEIGFycmF5IHRvIGFsbG93IGZvciBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgZWFjaCAKCQkgKiAgICAgICAgIERhdGFUYWJsZXMgRE9NIGVsZW1lbnQpLiBJdCBpcyBzdWdnZXN0ZWQgdGhhdCB5b3UgYWRkIHRoZSBjb250cm9scyB0byB0aGlzIGVsZW1lbnQgCgkJICogICAgICAgICBhcyBjaGlsZHJlbgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgICAgICA8bGk+e25vZGV9IENvbnRhaW5lciBpbnRvIHdoaWNoIHRoZSBwYWdpbmF0aW9uIGNvbnRyb2xzIG11c3QgYmUgaW5zZXJ0ZWQ8L2xpPgoJCSAqICAgICAgICAgICAgIDxsaT57ZnVuY3Rpb259IERyYXcgY2FsbGJhY2sgZnVuY3Rpb24gLSB3aGVuZXZlciB0aGUgY29udHJvbHMgY2F1c2UgYSBwYWdlCgkJICogICAgICAgICAgICAgICBjaGFuZ2UsIHRoaXMgbWV0aG9kIG11c3QgYmUgY2FsbGVkIHRvIHJlZHJhdyB0aGUgdGFibGUuPC9saT4KCSAgICAgKiAgICAgICAgICAgPC91bD4KCSAgICAgKiAgICAgICAgIDwvbGk+CgkJICogICAgICAgICA8bGk+CgkJICogICAgICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT5ObyByZXR1cm4gcmVxdWlyZWQ8L2xpPgoJCSAqICAgICAgICAgICA8L3VsPgoJCSAqICAgICAgICAgPC9pbD4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyIHRoZSBwYWdpbmcgc3RhdHVzIG9mIHRoZSB0YWJsZSBjaGFuZ2VzIGFuZCBpcwoJCSAqICAgICAgICAgdHlwaWNhbGx5IHVzZWQgdG8gdXBkYXRlIGNsYXNzZXMgYW5kL29yIHRleHQgb2YgdGhlIHBhZ2luZyBjb250cm9scyB0byByZWZsZXggdGhlIG5ldyAKCQkgKiAgICAgICAgIHN0YXR1cy4KCQkgKiAgICAgICA8dWw+CgkgICAgICogICAgICAgICA8bGk+CgkgICAgICogICAgICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICAgICAgPGxpPntmdW5jdGlvbn0gRHJhdyBjYWxsYmFjayBmdW5jdGlvbiAtIGluIGNhc2UgeW91IG5lZWQgdG8gcmVkcmF3IHRoZSB0YWJsZSBhZ2FpbgoJCSAqICAgICAgICAgICAgICAgb3IgYXR0YWNoIG5ldyBldmVudCBsaXN0ZW5lcnM8L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPk5vIHJldHVybiByZXF1aXJlZDwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uLmZvdXJfYnV0dG9uID0gewoJCSAqICAgICAgImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgbkZpcnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5QcmV2aW91cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTmV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTGFzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0ZpcnN0ICkgKTsKCQkgKiAgICAgICAgblByZXZpb3VzLmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc1ByZXZpb3VzICkgKTsKCQkgKiAgICAgICAgbk5leHQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zTmV4dCApICk7CgkJICogICAgICAgIG5MYXN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0xhc3QgKSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9idXR0b24gZmlyc3QiOwoJCSAqICAgICAgICBuUHJldmlvdXMuY2xhc3NOYW1lID0gInBhZ2luYXRlX2J1dHRvbiBwcmV2aW91cyI7CgkJICogICAgICAgIG5OZXh0LmNsYXNzTmFtZT0icGFnaW5hdGVfYnV0dG9uIG5leHQiOwoJCSAqICAgICAgICBuTGFzdC5jbGFzc05hbWUgPSAicGFnaW5hdGVfYnV0dG9uIGxhc3QiOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgblBhZ2luZy5hcHBlbmRDaGlsZCggbkZpcnN0ICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5QcmV2aW91cyApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTmV4dCApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTGFzdCApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuRmlyc3QpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAiZmlyc3QiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5QcmV2aW91cykuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgInByZXZpb3VzIiApOwoJCSAqICAgICAgICAgIGZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkgKiAgICAgICAgfSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuTmV4dCkuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgIm5leHQiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5MYXN0KS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAibGFzdCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQobkZpcnN0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5QcmV2aW91cykuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTmV4dCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTGFzdCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAKCQkgKiAgICAgICJmblVwZGF0ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKSB7CgkJICogICAgICAgICAgcmV0dXJuOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBMb29wIG92ZXIgZWFjaCBpbnN0YW5jZSBvZiB0aGUgcGFnZXIKCQkgKiAgICAgICAgdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJICogICAgICAgIGZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkgewoJCSAqICAgICAgICAgIHZhciBidXR0b25zID0gYW5baV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKTsKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMF0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzBdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkgewoJCSAqICAgICAgICAgICAgYnV0dG9uc1syXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfbmV4dCI7CgkJICogICAgICAgICAgICBidXR0b25zWzNdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzJdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1szXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZW5hYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0KCQkgKiAgICB9OwoJCSAqLwoJCSJvUGFnaW5hdGlvbiI6IHt9LAoJCgkKCQkvKioKCQkgKiBTb3J0aW5nIHBsdWctaW4gbWV0aG9kcyAtIFNvcnRpbmcgaW4gRGF0YVRhYmxlcyBpcyBiYXNlZCBvbiB0aGUgZGV0ZWN0ZWQgdHlwZSBvZiB0aGUKCQkgKiBkYXRhIGNvbHVtbiAoeW91IGNhbiBhZGQgeW91ciBvd24gdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLCBvciBvdmVycmlkZSBhdXRvbWF0aWMgCgkJICogZGV0ZWN0aW9uIHVzaW5nIHNUeXBlKS4gV2l0aCB0aGlzIHNwZWNpZmljIHR5cGUgZ2l2ZW4gdG8gdGhlIGNvbHVtbiwgRGF0YVRhYmxlcyB3aWxsIAoJCSAqIGFwcGx5IHRoZSByZXF1aXJlZCBzb3J0IGZyb20gdGhlIGZ1bmN0aW9ucyBpbiB0aGUgb2JqZWN0LiBFYWNoIHNvcnQgdHlwZSBtdXN0IHByb3ZpZGUKCQkgKiB0d28gbWFuZGF0b3J5IG1ldGhvZHMsIG9uZSBlYWNoIGZvciBhc2NlbmRpbmcgYW5kIGRlc2NlbmRpbmcgc29ydGluZywgYW5kIGNhbiBvcHRpb25hbGx5CgkJICogcHJvdmlkZSBhIHByZS1mb3JtYXR0aW5nIG1ldGhvZCB0aGF0IHdpbGwgaGVscCBzcGVlZCB1cCBzb3J0aW5nIGJ5IGFsbG93aW5nIERhdGFUYWJsZXMKCQkgKiB0byBwcmUtZm9ybWF0IHRoZSBzb3J0IGRhdGEgb25seSBvbmNlIChyYXRoZXIgdGhhbiBldmVyeSB0aW1lIHRoZSBhY3R1YWwgc29ydCBmdW5jdGlvbnMKCQkgKiBhcmUgcnVuKS4gVGhlIHR3byBzb3J0aW5nIGZ1bmN0aW9ucyBhcmUgdHlwaWNhbCBKYXZhc2NyaXB0IHNvcnQgbWV0aG9kczoKCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIHNlY29uZCBwYXJhbWV0ZXI8L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIGZpcnN0IHBhcmFtZXRlcjwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2ludH0gU29ydGluZyBtYXRjaDogPDAgaWYgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgbG93ZXIgdGhhbgoJCSAqICAgICAgICAgICB0aGUgc2Vjb25kIHBhcmFtZXRlciwgPT09MCBpZiB0aGUgdHdvIHBhcmFtZXRlcnMgYXJlIGVxdWFsIGFuZCA+MCBpZgoJCSAqICAgICAgICAgICB0aGUgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgaGVpZ2h0IHRoYW4gdGhlIHNlY29uZCBwYXJhbWV0ZXIuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDYXNlLXNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBubyBwcmUtZm9ybWF0dGluZyBtZXRob2QKCQkgKiAgICAkLmV4dGVuZCggJC5mbi5kYXRhVGFibGVFeHQub1NvcnQsIHsKCQkgKiAgICAgICJzdHJpbmctY2FzZS1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1jYXNlLWRlc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJICogICAgICB9CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gQ2FzZS1pbnNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBwcmUtZm9ybWF0dGluZwoJCSAqICAgICQuZXh0ZW5kKCAkLmZuLmRhdGFUYWJsZUV4dC5vU29ydCwgewoJCSAqICAgICAgInN0cmluZy1wcmUiOiBmdW5jdGlvbih4KSB7CgkJICogICAgICAgIHJldHVybiB4LnRvTG93ZXJDYXNlKCk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1kZXNjIjogZnVuY3Rpb24oeCx5KSB7CgkJICogICAgICAgIHJldHVybiAoKHggPCB5KSA/IDEgOiAoKHggPiB5KSA/IC0xIDogMCkpOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkib1NvcnQiOiB7fSwKCQoJCgkJLyoqCgkJICogVmVyc2lvbiBzdHJpbmcgZm9yIHBsdWctaW5zIHRvIGNoZWNrIGNvbXBhdGliaWxpdHkuIEFsbG93ZWQgZm9ybWF0IGlzCgkJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJCSAqIGUgYXJlIG9wdGlvbmFsCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBWZXJzaW9uIG51bWJlcgoJCSAqLwoJCSJzVmVyc2lvbiI6IERhdGFUYWJsZS52ZXJzaW9uLAoJCgkKCQkvKioKCQkgKiBIb3cgc2hvdWxkIERhdGFUYWJsZXMgcmVwb3J0IGFuIGVycm9yLiBDYW4gdGFrZSB0aGUgdmFsdWUgJ2FsZXJ0JyBvciAndGhyb3cnCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhbGVydAoJCSAqLwoJCSJzRXJyTW9kZSI6ICJhbGVydCIsCgkKCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGZvciBEYXRhVGFibGVzIHRvIGFjY2VzcyBnbG9iYWxseSBhYm91dCBvdGhlciBpbnN0YW5jZXMKCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfb0V4dGVybkNvbmZpZyI6IHsKCQkJLyogaW50OmlOZXh0VW5pcXVlIC0gbmV4dCB1bmlxdWUgbnVtYmVyIGZvciBhbiBpbnN0YW5jZSAqLwoJCQkiaU5leHRVbmlxdWUiOiAwCgkJfQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogc2VhcmNoIGluZm9ybWF0aW9uIGZvciB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVycy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCA9IHsKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBmaWx0ZXJpbmcgc2hvdWxkIGJlIGNhc2UgaW5zZW5zaXRpdmUgb3Igbm90CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiQ2FzZUluc2Vuc2l0aXZlIjogdHJ1ZSwKCQoJCS8qKgoJCSAqIEFwcGxpZWQgc2VhcmNoIHRlcm0KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic1NlYXJjaCI6ICIiLAoJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgc2VhcmNoIHRlcm0gc2hvdWxkIGJlIGludGVycHJldGVkIGFzIGEKCQkgKiByZWd1bGFyIGV4cHJlc3Npb24gKHRydWUpIG9yIG5vdCAoZmFsc2UpIGFuZCB0aGVyZWZvcmUgYW5kIHNwZWNpYWwKCQkgKiByZWdleCBjaGFyYWN0ZXJzIGVzY2FwZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYlJlZ2V4IjogZmFsc2UsCgkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIERhdGFUYWJsZXMgaXMgdG8gdXNlIGl0cyBzbWFydCBmaWx0ZXJpbmcgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYlNtYXJ0IjogdHJ1ZQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogZWFjaCBpbmRpdmlkdWFsIHJvdy4gVGhpcyBpcyB0aGUgb2JqZWN0IGZvcm1hdCB1c2VkIGZvciB0aGUgc2V0dGluZ3MgCgkgKiBhb0RhdGEgYXJyYXkuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzLm9Sb3cgPSB7CgkJLyoqCgkJICogVFIgZWxlbWVudCBmb3IgdGhlIHJvdwoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRyIjogbnVsbCwKCQoJCS8qKgoJCSAqIERhdGEgb2JqZWN0IGZyb20gdGhlIG9yaWdpbmFsIGRhdGEgc291cmNlIGZvciB0aGUgcm93LiBUaGlzIGlzIGVpdGhlcgoJCSAqIGFuIGFycmF5IGlmIHVzaW5nIHRoZSB0cmFkaXRpb25hbCBmb3JtIG9mIERhdGFUYWJsZXMsIG9yIGFuIG9iamVjdCBpZgoJCSAqIHVzaW5nIG1EYXRhIG9wdGlvbnMuIFRoZSBleGFjdCB0eXBlIHdpbGwgZGVwZW5kIG9uIHRoZSBwYXNzZWQgaW4KCQkgKiBkYXRhIGZyb20gdGhlIGRhdGEgc291cmNlLCBvciB3aWxsIGJlIGFuIGFycmF5IGlmIHVzaW5nIERPTSBhIGRhdGEgCgkJICogc291cmNlLgoJCSAqICBAdHlwZSBhcnJheXxvYmplY3QKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiX2FEYXRhIjogW10sCgkKCQkvKioKCQkgKiBTb3J0aW5nIGRhdGEgY2FjaGUgLSB0aGlzIGFycmF5IGlzIG9zdGVuc2libHkgdGhlIHNhbWUgbGVuZ3RoIGFzIHRoZQoJCSAqIG51bWJlciBvZiBjb2x1bW5zIChhbHRob3VnaCBlYWNoIGluZGV4IGlzIGdlbmVyYXRlZCBvbmx5IGFzIGl0IGlzIAoJCSAqIG5lZWRlZCksIGFuZCBob2xkcyB0aGUgZGF0YSB0aGF0IGlzIHVzZWQgZm9yIHNvcnRpbmcgZWFjaCBjb2x1bW4gaW4gdGhlCgkJICogcm93LiBXZSBkbyB0aGlzIGNhY2hlIGdlbmVyYXRpb24gYXQgdGhlIHN0YXJ0IG9mIHRoZSBzb3J0IGluIG9yZGVyIHRoYXQKCQkgKiB0aGUgZm9ybWF0dGluZyBvZiB0aGUgc29ydCBkYXRhIG5lZWQgYmUgZG9uZSBvbmx5IG9uY2UgZm9yIGVhY2ggY2VsbAoJCSAqIHBlciBzb3J0LiBUaGlzIGFycmF5IHNob3VsZCBub3QgYmUgcmVhZCBmcm9tIG9yIHdyaXR0ZW4gdG8gYnkgYW55dGhpbmcKCQkgKiBvdGhlciB0aGFuIHRoZSBtYXN0ZXIgc29ydGluZyBtZXRob2RzLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYVNvcnREYXRhIjogW10sCgkKCQkvKioKCQkgKiBBcnJheSBvZiBURCBlbGVtZW50cyB0aGF0IGFyZSBjYWNoZWQgZm9yIGhpZGRlbiByb3dzLCBzbyB0aGV5IGNhbiBiZQoJCSAqIHJlaW5zZXJ0ZWQgaW50byB0aGUgdGFibGUgaWYgYSBjb2x1bW4gaXMgbWFkZSB2aXNpYmxlIGFnYWluIChvciB0byBhY3QKCQkgKiBhcyBhIHN0b3JlIGlmIGEgY29sdW1uIGlzIG1hZGUgaGlkZGVuKS4gT25seSBoaWRkZW4gY29sdW1ucyBoYXZlIGEgCgkJICogcmVmZXJlbmNlIGluIHRoZSBhcnJheS4gRm9yIG5vbi1oaWRkZW4gY29sdW1ucyB0aGUgdmFsdWUgaXMgZWl0aGVyCgkJICogdW5kZWZpbmVkIG9yIG51bGwuCgkJICogIEB0eXBlIGFycmF5IG5vZGVzCgkJICogIEBkZWZhdWx0IFtdCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9hbkhpZGRlbiI6IFtdLAoJCgkJLyoqCgkJICogQ2FjaGUgb2YgdGhlIGNsYXNzIG5hbWUgdGhhdCBEYXRhVGFibGVzIGhhcyBhcHBsaWVkIHRvIHRoZSByb3csIHNvIHdlCgkJICogY2FuIHF1aWNrbHkgbG9vayBhdCB0aGlzIHZhcmlhYmxlIHJhdGhlciB0aGFuIG5lZWRpbmcgdG8gZG8gYSBET00gY2hlY2sKCQkgKiBvbiBjbGFzc05hbWUgZm9yIHRoZSBuVHIgcHJvcGVydHkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBwcml2YXRlCgkJICovCgkJIl9zUm93U3RyaXBlIjogIiIKCX07CgkKCQoJCgkvKioKCSAqIFRlbXBsYXRlIG9iamVjdCBmb3IgdGhlIGNvbHVtbiBpbmZvcm1hdGlvbiBvYmplY3QgaW4gRGF0YVRhYmxlcy4gVGhpcyBvYmplY3QKCSAqIGlzIGhlbGQgaW4gdGhlIHNldHRpbmdzIGFvQ29sdW1ucyBhcnJheSBhbmQgY29udGFpbnMgYWxsIHRoZSBpbmZvcm1hdGlvbiB0aGF0CgkgKiBEYXRhVGFibGVzIG5lZWRzIGFib3V0IGVhY2ggaW5kaXZpZHVhbCBjb2x1bW4uCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG9iamVjdCBpcyByZWxhdGVkIHRvIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uc30gCgkgKiBidXQgdGhpcyBvbmUgaXMgdGhlIGludGVybmFsIGRhdGEgc3RvcmUgZm9yIERhdGFUYWJsZXMncyBjYWNoZSBvZiBjb2x1bW5zLgoJICogSXQgc2hvdWxkIE5PVCBiZSBtYW5pcHVsYXRlZCBvdXRzaWRlIG9mIERhdGFUYWJsZXMuIEFueSBjb25maWd1cmF0aW9uIHNob3VsZAoJICogYmUgZG9uZSB0aHJvdWdoIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5vQ29sdW1uID0gewoJCS8qKgoJCSAqIEEgbGlzdCBvZiB0aGUgY29sdW1ucyB0aGF0IHNvcnRpbmcgc2hvdWxkIG9jY3VyIG9uIHdoZW4gdGhpcyBjb2x1bW4KCQkgKiBpcyBzb3J0ZWQuIFRoYXQgdGhpcyBwcm9wZXJ0eSBpcyBhbiBhcnJheSBhbGxvd3MgbXVsdGktY29sdW1uIHNvcnRpbmcKCQkgKiB0byBiZSBkZWZpbmVkIGZvciBhIGNvbHVtbiAoZm9yIGV4YW1wbGUgZmlyc3QgbmFtZSAvIGxhc3QgbmFtZSBjb2x1bW5zCgkJICogd291bGQgYmVuZWZpdCBmcm9tIHRoaXMpLiBUaGUgdmFsdWVzIGFyZSBpbnRlZ2VycyBwb2ludGluZyB0byB0aGUKCQkgKiBjb2x1bW5zIHRvIGJlIHNvcnRlZCBvbiAodHlwaWNhbGx5IGl0IHdpbGwgYmUgYSBzaW5nbGUgaW50ZWdlciBwb2ludGluZwoJCSAqIGF0IGl0c2VsZiwgYnV0IHRoYXQgZG9lc24ndCBuZWVkIHRvIGJlIHRoZSBjYXNlKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKi8KCQkiYURhdGFTb3J0IjogbnVsbCwKCQoJCS8qKgoJCSAqIERlZmluZSB0aGUgc29ydGluZyBkaXJlY3Rpb25zIHRoYXQgYXJlIGFwcGxpZWQgdG8gdGhlIGNvbHVtbiwgaW4gc2VxdWVuY2UKCQkgKiBhcyB0aGUgY29sdW1uIGlzIHJlcGVhdGVkbHkgc29ydGVkIHVwb24gLSBpLmUuIHRoZSBmaXJzdCB2YWx1ZSBpcyB1c2VkCgkJICogYXMgdGhlIHNvcnRpbmcgZGlyZWN0aW9uIHdoZW4gdGhlIGNvbHVtbiBpZiBmaXJzdCBzb3J0ZWQgKGNsaWNrZWQgb24pLgoJCSAqIFNvcnQgaXQgYWdhaW4gKGNsaWNrIGFnYWluKSBhbmQgaXQgd2lsbCBtb3ZlIG9uIHRvIHRoZSBuZXh0IGluZGV4LgoJCSAqIFJlcGVhdCB1bnRpbCBsb29wLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqLwoJCSJhc1NvcnRpbmciOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgdGhlIGNvbHVtbiBpcyBzZWFyY2hhYmxlLCBhbmQgdGh1cyBzaG91bGQgYmUgaW5jbHVkZWQKCQkgKiBpbiB0aGUgZmlsdGVyaW5nIG9yIG5vdC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiU2VhcmNoYWJsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgY29sdW1uIGlzIHNvcnRhYmxlIG9yIG5vdC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiU29ydGFibGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoZW4gdXNpbmcgZm5SZW5kZXIsIHlvdSBoYXZlIHR3byBvcHRpb25zIGZvciB3aGF0IHRvIGRvIHdpdGggdGhlIGRhdGEsCgkJICogYW5kIHRoaXMgcHJvcGVydHkgc2VydmVzIGFzIHRoZSBzd2l0Y2guIEZpcnN0bHksIHlvdSBjYW4gaGF2ZSB0aGUgc29ydGluZwoJCSAqIGFuZCBmaWx0ZXJpbmcgdXNlIHRoZSByZW5kZXJlZCB2YWx1ZSAodHJ1ZSAtIGRlZmF1bHQpLCBvciB5b3UgY2FuIGhhdmUKCQkgKiB0aGUgc29ydGluZyBhbmQgZmlsdGVyaW5nIHVzIHRoZSBvcmlnaW5hbCB2YWx1ZSAoZmFsc2UpLgoJCSAqIAoJCSAqICpOT1RFKiBJdCBpcyBpdCBpcyBhZHZpc2FibGUgbm93IHRvIHVzZSBtRGF0YSBhcyBhIGZ1bmN0aW9uIGFuZCBtYWtlIAoJCSAqIHVzZSBvZiB0aGUgJ3R5cGUnIHRoYXQgaXQgZ2l2ZXMsIGFsbG93aW5nIChwb3RlbnRpYWxseSkgZGlmZmVyZW50IGRhdGEgdG8KCQkgKiBiZSB1c2VkIGZvciBzb3J0aW5nLCBmaWx0ZXJpbmcsIGRpc3BsYXkgYW5kIHR5cGUgZGV0ZWN0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImJVc2VSZW5kZXJlZCI6IG51bGwsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgY29sdW1uIGlzIGN1cnJlbnRseSB2aXNpYmxlIGluIHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiVmlzaWJsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSB0byB0aGUgdHlwZSBkZXRlY3Rpb24gbWV0aG9kIGlmIHRoZSBhdXRvbWF0aWMgdHlwZQoJCSAqIGRldGVjdGlvbiBzaG91bGQgYmUgdXNlZCwgb3IgaWYgYSBjb2x1bW4gdHlwZSAoc1R5cGUpIGhhcyBiZWVuIHNwZWNpZmllZAoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2JBdXRvVHlwZSI6IHRydWUsCgkJCgkJLyoqCgkJICogRGV2ZWxvcGVyIGRlZmluYWJsZSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuZXZlciBhIGNlbGwgaXMgY3JlYXRlZCAoQWpheCBzb3VyY2UsCgkJICogZXRjKSBvciBwcm9jZXNzZWQgZm9yIGlucHV0IChET00gc291cmNlKS4gVGhpcyBjYW4gYmUgdXNlZCBhcyBhIGNvbXBsaW1lbnQgdG8gZm5SZW5kZXIKCQkgKiBhbGxvd2luZyB5b3UgdG8gbW9kaWZ5IHRoZSBET00gZWxlbWVudCAoYWRkIGJhY2tncm91bmQgY29sb3VyIGZvciBleGFtcGxlKSB3aGVuIHRoZQoJCSAqIGVsZW1lbnQgaXMgYXZhaWxhYmxlIChzaW5jZSBpdCBpcyBub3Qgd2hlbiBmblJlbmRlciBpcyBjYWxsZWQpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge2VsZW1lbnR9IG5UZCBUaGUgVEQgbm9kZSB0aGF0IGhhcyBiZWVuIGNyZWF0ZWQKCQkgKiAgQHBhcmFtIHsqfSBzRGF0YSBUaGUgRGF0YSBmb3IgdGhlIGNlbGwKCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGZvciB0aGUgd2hvbGUgcm93CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFRoZSByb3cgaW5kZXggZm9yIHRoZSBhb0RhdGEgZGF0YSBzdG9yZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuQ3JlYXRlZENlbGwiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIGdldCBkYXRhIGZyb20gYSBjZWxsIGluIGEgY29sdW1uLiBZb3Ugc2hvdWxkIDxiPm5ldmVyPC9iPgoJCSAqIGFjY2VzcyBkYXRhIGRpcmVjdGx5IHRocm91Z2ggX2FEYXRhIGludGVybmFsbHkgaW4gRGF0YVRhYmxlcyAtIGFsd2F5cyB1c2UKCQkgKiB0aGUgbWV0aG9kIGF0dGFjaGVkIHRvIHRoaXMgcHJvcGVydHkuIEl0IGFsbG93cyBtRGF0YSB0byBmdW5jdGlvbiBhcwoJCSAqIHJlcXVpcmVkLiBUaGlzIGZ1bmN0aW9uIGlzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgYnkgdGhlIGNvbHVtbiAKCQkgKiBpbml0aWFsaXNhdGlvbiBtZXRob2QKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGFycmF5L29iamVjdCBmb3IgdGhlIGFycmF5IAoJCSAqICAgIChpLmUuIGFvRGF0YVtdLl9hRGF0YSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBUaGUgc3BlY2lmaWMgZGF0YSB0eXBlIHlvdSB3YW50IHRvIGdldCAtIAoJCSAqICAgICdkaXNwbGF5JywgJ3R5cGUnICdmaWx0ZXInICdzb3J0JwoJCSAqICBAcmV0dXJucyB7Kn0gVGhlIGRhdGEgZm9yIHRoZSBjZWxsIGZyb20gdGhlIGdpdmVuIHJvdydzIGRhdGEKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkdldERhdGEiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCAKCQkgKiBpbiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8gT2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YVJvdyBUaGUgcm93IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YUNvbHVtbiBUaGUgY29sdW1uIGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl9ICBvLmFEYXRhIFRoZSBkYXRhIGZvciB0aGUgcm93IGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvLm9TZXR0aW5ncyBUaGUgc2V0dGluZ3Mgb2JqZWN0IGZvciB0aGlzIERhdGFUYWJsZXMgaW5zdGFuY2UKCQkgKiAgQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyB5b3Ugd2hpY2ggdG8gdXNlIGluIHRoZSBkaXNwbGF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5SZW5kZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIHNldCBkYXRhIGZvciBhIGNlbGwgaW4gdGhlIGNvbHVtbi4gWW91IHNob3VsZCA8Yj5uZXZlcjwvYj4gCgkJICogc2V0IHRoZSBkYXRhIGRpcmVjdGx5IHRvIF9hRGF0YSBpbnRlcm5hbGx5IGluIERhdGFUYWJsZXMgLSBhbHdheXMgdXNlCgkJICogdGhpcyBtZXRob2QuIEl0IGFsbG93cyBtRGF0YSB0byBmdW5jdGlvbiBhcyByZXF1aXJlZC4gVGhpcyBmdW5jdGlvbgoJCSAqIGlzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgYnkgdGhlIGNvbHVtbiBpbml0aWFsaXNhdGlvbiBtZXRob2QKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGFycmF5L29iamVjdCBmb3IgdGhlIGFycmF5IAoJCSAqICAgIChpLmUuIGFvRGF0YVtdLl9hRGF0YSkKCQkgKiAgQHBhcmFtIHsqfSBzVmFsdWUgVmFsdWUgdG8gc2V0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5TZXREYXRhIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQcm9wZXJ0eSB0byByZWFkIHRoZSB2YWx1ZSBmb3IgdGhlIGNlbGxzIGluIHRoZSBjb2x1bW4gZnJvbSB0aGUgZGF0YSAKCQkgKiBzb3VyY2UgYXJyYXkgLyBvYmplY3QuIElmIG51bGwsIHRoZW4gdGhlIGRlZmF1bHQgY29udGVudCBpcyB1c2VkLCBpZiBhCgkJICogZnVuY3Rpb24gaXMgZ2l2ZW4gdGhlbiB0aGUgcmV0dXJuIGZyb20gdGhlIGZ1bmN0aW9uIGlzIHVzZWQuCgkJICogIEB0eXBlIGZ1bmN0aW9ufGludHxzdHJpbmd8bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm1EYXRhIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQYXJ0bmVyIHByb3BlcnR5IHRvIG1EYXRhIHdoaWNoIGlzIHVzZWQgKG9ubHkgd2hlbiBkZWZpbmVkKSB0byBnZXQKCQkgKiB0aGUgZGF0YSAtIGkuZS4gaXQgaXMgYmFzaWNhbGx5IHRoZSBzYW1lIGFzIG1EYXRhLCBidXQgd2l0aG91dCB0aGUKCQkgKiAnc2V0JyBvcHRpb24sIGFuZCBhbHNvIHRoZSBkYXRhIGZlZCB0byBpdCBpcyB0aGUgcmVzdWx0IGZyb20gbURhdGEuCgkJICogVGhpcyBpcyB0aGUgcmVuZGVyaW5nIG1ldGhvZCB0byBtYXRjaCB0aGUgZGF0YSBtZXRob2Qgb2YgbURhdGEuCgkJICogIEB0eXBlIGZ1bmN0aW9ufGludHxzdHJpbmd8bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm1SZW5kZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBoZWFkZXIgVEgvVEQgZWxlbWVudCBmb3IgdGhpcyBjb2x1bW4gLSB0aGlzIGlzIHdoYXQgdGhlIHNvcnRpbmcKCQkgKiBsaXN0ZW5lciBpcyBhdHRhY2hlZCB0byAoaWYgc29ydGluZyBpcyBlbmFibGVkLikKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UaCI6IG51bGwsCgkJCgkJLyoqCgkJICogVW5pcXVlIGZvb3RlciBUSC9URCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbiAoaWYgdGhlcmUgaXMgb25lKS4gTm90IHVzZWQgCgkJICogaW4gRGF0YVRhYmxlcyBhcyBzdWNoLCBidXQgY2FuIGJlIHVzZWQgZm9yIHBsdWctaW5zIHRvIHJlZmVyZW5jZSB0aGUgCgkJICogZm9vdGVyIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UZiI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzIHRvIGFwcGx5IHRvIGFsbCBURCBlbGVtZW50cyBpbiB0aGUgdGFibGUncyBUQk9EWSBmb3IgdGhlIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzQ2xhc3MiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoZW4gRGF0YVRhYmxlcyBjYWxjdWxhdGVzIHRoZSBjb2x1bW4gd2lkdGhzIHRvIGFzc2lnbiB0byBlYWNoIGNvbHVtbiwKCQkgKiBpdCBmaW5kcyB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gZWFjaCBjb2x1bW4gYW5kIHRoZW4gY29uc3RydWN0cyBhCgkJICogdGVtcG9yYXJ5IHRhYmxlIGFuZCByZWFkcyB0aGUgd2lkdGhzIGZyb20gdGhhdC4gVGhlIHByb2JsZW0gd2l0aCB0aGlzCgkJICogaXMgdGhhdCAibW1tIiBpcyBtdWNoIHdpZGVyIHRoZW4gImlpaWkiLCBidXQgdGhlIGxhdHRlciBpcyBhIGxvbmdlciAKCQkgKiBzdHJpbmcgLSB0aHVzIHRoZSBjYWxjdWxhdGlvbiBjYW4gZ28gd3JvbmcgKGRvaW5nIGl0IHByb3Blcmx5IGFuZCBwdXR0aW5nCgkJICogaXQgaW50byBhbiBET00gb2JqZWN0IGFuZCBtZWFzdXJpbmcgdGhhdCBpcyBob3JyaWJseSghKSBzbG93KS4gVGh1cyBhcwoJCSAqIGEgIndvcmsgYXJvdW5kIiB3ZSBwcm92aWRlIHRoaXMgb3B0aW9uLiBJdCB3aWxsIGFwcGVuZCBpdHMgdmFsdWUgdG8gdGhlCgkJICogdGV4dCB0aGF0IGlzIGZvdW5kIHRvIGJlIHRoZSBsb25nZXN0IHN0cmluZyBmb3IgdGhlIGNvbHVtbiAtIGkuZS4gcGFkZGluZy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNDb250ZW50UGFkZGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogQWxsb3dzIGEgZGVmYXVsdCB2YWx1ZSB0byBiZSBnaXZlbiBmb3IgYSBjb2x1bW4ncyBkYXRhLCBhbmQgd2lsbCBiZSB1c2VkCgkJICogd2hlbmV2ZXIgYSBudWxsIGRhdGEgc291cmNlIGlzIGVuY291bnRlcmVkICh0aGlzIGNhbiBiZSBiZWNhdXNlIG1EYXRhCgkJICogaXMgc2V0IHRvIG51bGwsIG9yIGJlY2F1c2UgdGhlIGRhdGEgc291cmNlIGl0c2VsZiBpcyBudWxsKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0RlZmF1bHRDb250ZW50IjogbnVsbCwKCQkKCQkvKioKCQkgKiBOYW1lIGZvciB0aGUgY29sdW1uLCBhbGxvd2luZyByZWZlcmVuY2UgdG8gdGhlIGNvbHVtbiBieSBuYW1lIGFzIHdlbGwgYXMKCQkgKiBieSBpbmRleCAobmVlZHMgYSBsb29rdXAgdG8gd29yayBieSBuYW1lKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNOYW1lIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDdXN0b20gc29ydGluZyBkYXRhIHR5cGUgLSBkZWZpbmVzIHdoaWNoIG9mIHRoZSBhdmFpbGFibGUgcGx1Zy1pbnMgaW4KCQkgKiBhZm5Tb3J0RGF0YSB0aGUgY3VzdG9tIHNvcnRpbmcgd2lsbCB1c2UgLSBpZiBhbnkgaXMgZGVmaW5lZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IHN0ZAoJCSAqLwoJCSJzU29ydERhdGFUeXBlIjogJ3N0ZCcsCgkJCgkJLyoqCgkJICogQ2xhc3MgdG8gYmUgYXBwbGllZCB0byB0aGUgaGVhZGVyIGVsZW1lbnQgd2hlbiBzb3J0aW5nIG9uIHRoaXMgY29sdW1uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNTb3J0aW5nQ2xhc3MiOiBudWxsLAoJCQoJCS8qKgoJCSAqIENsYXNzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGhlYWRlciBlbGVtZW50IHdoZW4gc29ydGluZyBvbiB0aGlzIGNvbHVtbiAtCgkJICogd2hlbiBqUXVlcnkgVUkgdGhlbWluZyBpcyB1c2VkLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzU29ydGluZ0NsYXNzSlVJIjogbnVsbCwKCQkKCQkvKioKCQkgKiBUaXRsZSBvZiB0aGUgY29sdW1uIC0gd2hhdCBpcyBzZWVuIGluIHRoZSBUSCBlbGVtZW50IChuVGgpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKi8KCQkic1RpdGxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDb2x1bW4gc29ydGluZyBhbmQgZmlsdGVyaW5nIHR5cGUKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1R5cGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdpZHRoIG9mIHRoZSBjb2x1bW4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1dpZHRoIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaWR0aCBvZiB0aGUgY29sdW1uIHdoZW4gaXQgd2FzIGZpcnN0ICJlbmNvdW50ZXJlZCIKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1dpZHRoT3JpZyI6IG51bGwKCX07CgkKCQoJCgkvKioKCSAqIEluaXRpYWxpc2F0aW9uIG9wdGlvbnMgdGhhdCBjYW4gYmUgZ2l2ZW4gdG8gRGF0YVRhYmxlcyBhdCBpbml0aWFsaXNhdGlvbiAKCSAqIHRpbWUuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUuZGVmYXVsdHMgPSB7CgkJLyoqCgkJICogQW4gYXJyYXkgb2YgZGF0YSB0byB1c2UgZm9yIHRoZSB0YWJsZSwgcGFzc2VkIGluIGF0IGluaXRpYWxpc2F0aW9uIHdoaWNoIAoJCSAqIHdpbGwgYmUgdXNlZCBpbiBwcmVmZXJlbmNlIHRvIGFueSBkYXRhIHdoaWNoIGlzIGFscmVhZHkgaW4gdGhlIERPTS4gVGhpcyBpcwoJCSAqIHBhcnRpY3VsYXJseSB1c2VmdWwgZm9yIGNvbnN0cnVjdGluZyB0YWJsZXMgcHVyZWx5IGluIEphdmFzY3JpcHQsIGZvcgoJCSAqIGV4YW1wbGUgd2l0aCBhIGN1c3RvbSBBamF4IGNhbGwuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGEgMkQgYXJyYXkgZGF0YSBzb3VyY2UKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFhRGF0YSI6IFsKCQkgKiAgICAgICAgICBbJ1RyaWRlbnQnLCAnSW50ZXJuZXQgRXhwbG9yZXIgNC4wJywgJ1dpbiA5NSsnLCA0LCAnWCddLAoJCSAqICAgICAgICAgIFsnVHJpZGVudCcsICdJbnRlcm5ldCBFeHBsb3JlciA1LjAnLCAnV2luIDk1KycsIDUsICdDJ10sCgkJICogICAgICAgIF0sCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiQnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiUGxhdGZvcm0iIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlZlcnNpb24iIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW4gYXJyYXkgb2Ygb2JqZWN0cyBhcyBhIGRhdGEgc291cmNlIChtRGF0YSkKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFhRGF0YSI6IFsKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAiZW5naW5lIjogICAiVHJpZGVudCIsCgkJICogICAgICAgICAgICAiYnJvd3NlciI6ICAiSW50ZXJuZXQgRXhwbG9yZXIgNC4wIiwKCQkgKiAgICAgICAgICAgICJwbGF0Zm9ybSI6ICJXaW4gOTUrIiwKCQkgKiAgICAgICAgICAgICJ2ZXJzaW9uIjogIDQsCgkJICogICAgICAgICAgICAiZ3JhZGUiOiAgICAiWCIKCQkgKiAgICAgICAgICB9LAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJlbmdpbmUiOiAgICJUcmlkZW50IiwKCQkgKiAgICAgICAgICAgICJicm93c2VyIjogICJJbnRlcm5ldCBFeHBsb3JlciA1LjAiLAoJCSAqICAgICAgICAgICAgInBsYXRmb3JtIjogIldpbiA5NSsiLAoJCSAqICAgICAgICAgICAgInZlcnNpb24iOiAgNSwKCQkgKiAgICAgICAgICAgICJncmFkZSI6ICAgICJDIgoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXSwKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiRW5naW5lIiwgICAibURhdGEiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJCcm93c2VyIiwgICJtRGF0YSI6ICJicm93c2VyIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJQbGF0Zm9ybSIsICJtRGF0YSI6ICJwbGF0Zm9ybSIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiVmVyc2lvbiIsICAibURhdGEiOiAidmVyc2lvbiIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiR3JhZGUiLCAgICAibURhdGEiOiAiZ3JhZGUiIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYWFEYXRhIjogbnVsbCwKCQoJCgkJLyoqCgkJICogSWYgc29ydGluZyBpcyBlbmFibGVkLCB0aGVuIERhdGFUYWJsZXMgd2lsbCBwZXJmb3JtIGEgZmlyc3QgcGFzcyBzb3J0IG9uIAoJCSAqIGluaXRpYWxpc2F0aW9uLiBZb3UgY2FuIGRlZmluZSB3aGljaCBjb2x1bW4ocykgdGhlIHNvcnQgaXMgcGVyZm9ybWVkIHVwb24sIAoJCSAqIGFuZCB0aGUgc29ydGluZyBkaXJlY3Rpb24sIHdpdGggdGhpcyB2YXJpYWJsZS4gVGhlIGFhU29ydGluZyBhcnJheSBzaG91bGQgCgkJICogY29udGFpbiBhbiBhcnJheSBmb3IgZWFjaCBjb2x1bW4gdG8gYmUgc29ydGVkIGluaXRpYWxseSBjb250YWluaW5nIHRoZSAKCQkgKiBjb2x1bW4ncyBpbmRleCBhbmQgYSBkaXJlY3Rpb24gc3RyaW5nICgnYXNjJyBvciAnZGVzYycpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbWzAsJ2FzYyddXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gU29ydCBieSAzcmQgY29sdW1uIGZpcnN0LCBhbmQgdGhlbiA0dGggY29sdW1uCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFhU29ydGluZyI6IFtbMiwnYXNjJ10sIFszLCdkZXNjJ11dCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIC8vIE5vIGluaXRpYWwgc29ydGluZwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmciOiBbXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYWFTb3J0aW5nIjogW1swLCdhc2MnXV0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGlzIGJhc2ljYWxseSBpZGVudGljYWwgdG8gdGhlIGFhU29ydGluZyBwYXJhbWV0ZXIsIGJ1dCAKCQkgKiBjYW5ub3QgYmUgb3ZlcnJpZGRlbiBieSB1c2VyIGludGVyYWN0aW9uIHdpdGggdGhlIHRhYmxlLiBXaGF0IHRoaXMgbWVhbnMgCgkJICogaXMgdGhhdCB5b3UgY291bGQgaGF2ZSBhIGNvbHVtbiAodmlzaWJsZSBvciBoaWRkZW4pIHdoaWNoIHRoZSBzb3J0aW5nIHdpbGwgCgkJICogYWx3YXlzIGJlIGZvcmNlZCBvbiBmaXJzdCAtIGFueSBzb3J0aW5nIGFmdGVyIHRoYXQgKGZyb20gdGhlIHVzZXIpIHdpbGwgCgkJICogdGhlbiBiZSBwZXJmb3JtZWQgYXMgcmVxdWlyZWQuIFRoaXMgY2FuIGJlIHVzZWZ1bCBmb3IgZ3JvdXBpbmcgcm93cyAKCQkgKiB0b2dldGhlci4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFhU29ydGluZ0ZpeGVkIjogW1swLCdhc2MnXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiYWFTb3J0aW5nRml4ZWQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBhbGxvd3MgeW91IHRvIHJlYWRpbHkgc3BlY2lmeSB0aGUgZW50cmllcyBpbiB0aGUgbGVuZ3RoIGRyb3AKCQkgKiBkb3duIG1lbnUgdGhhdCBEYXRhVGFibGVzIHNob3dzIHdoZW4gcGFnaW5hdGlvbiBpcyBlbmFibGVkLiBJdCBjYW4gYmUgCgkJICogZWl0aGVyIGEgMUQgYXJyYXkgb2Ygb3B0aW9ucyB3aGljaCB3aWxsIGJlIHVzZWQgZm9yIGJvdGggdGhlIGRpc3BsYXllZCAKCQkgKiBvcHRpb24gYW5kIHRoZSB2YWx1ZSwgb3IgYSAyRCBhcnJheSB3aGljaCB3aWxsIHVzZSB0aGUgYXJyYXkgaW4gdGhlIGZpcnN0IAoJCSAqIHBvc2l0aW9uIGFzIHRoZSB2YWx1ZSwgYW5kIHRoZSBhcnJheSBpbiB0aGUgc2Vjb25kIHBvc2l0aW9uIGFzIHRoZSAKCQkgKiBkaXNwbGF5ZWQgb3B0aW9ucyAodXNlZnVsIGZvciBsYW5ndWFnZSBzdHJpbmdzIHN1Y2ggYXMgJ0FsbCcpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbIDEwLCAyNSwgNTAsIDEwMCBdCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzEwLCAyNSwgNTAsIC0xXSwgWzEwLCAyNSwgNTAsICJBbGwiXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNldHRpbmcgdGhlIGRlZmF1bHQgZGlzcGxheSBsZW5ndGggYXMgd2VsbCBhcyBsZW5ndGggbWVudQoJCSAqICAgIC8vIFRoaXMgaXMgbGlrZWx5IHRvIGJlIHdhbnRlZCBpZiB5b3UgcmVtb3ZlIHRoZSAnMTAnIG9wdGlvbiB3aGljaAoJCSAqICAgIC8vIGlzIHRoZSBpRGlzcGxheUxlbmd0aCBkZWZhdWx0LgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDI1LAoJCSAqICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzI1LCA1MCwgMTAwLCAtMV0sIFsyNSwgNTAsIDEwMCwgIkFsbCJdXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYUxlbmd0aE1lbnUiOiBbIDEwLCAyNSwgNTAsIDEwMCBdLAoJCgkKCQkvKioKCQkgKiBUaGUgYW9Db2x1bW5zIG9wdGlvbiBpbiB0aGUgaW5pdGlhbGlzYXRpb24gcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gZGVmaW5lCgkJICogZGV0YWlscyBhYm91dCB0aGUgd2F5IGluZGl2aWR1YWwgY29sdW1ucyBiZWhhdmUuIEZvciBhIGZ1bGwgbGlzdCBvZgoJCSAqIGNvbHVtbiBvcHRpb25zIHRoYXQgY2FuIGJlIHNldCwgcGxlYXNlIHNlZSAKCQkgKiB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnN9LiBOb3RlIHRoYXQgaWYgeW91IHVzZSBhb0NvbHVtbnMgdG8KCQkgKiBkZWZpbmUgeW91ciBjb2x1bW5zLCB5b3UgbXVzdCBoYXZlIGFuIGVudHJ5IGluIHRoZSBhcnJheSBmb3IgZXZlcnkgc2luZ2xlCgkJICogY29sdW1uIHRoYXQgeW91IGhhdmUgaW4geW91ciB0YWJsZSAodGhlc2UgY2FuIGJlIG51bGwgaWYgeW91IGRvbid0IHdoaWNoCgkJICogdG8gc3BlY2lmeSBhbnkgb3B0aW9ucykuCgkJICogIEBtZW1iZXIKCQkgKi8KCQkiYW9Db2x1bW5zIjogbnVsbCwKCQoJCS8qKgoJCSAqIFZlcnkgc2ltaWxhciB0byBhb0NvbHVtbnMsIGFvQ29sdW1uRGVmcyBhbGxvd3MgeW91IHRvIHRhcmdldCBhIHNwZWNpZmljIAoJCSAqIGNvbHVtbiwgbXVsdGlwbGUgY29sdW1ucywgb3IgYWxsIGNvbHVtbnMsIHVzaW5nIHRoZSBhVGFyZ2V0cyBwcm9wZXJ0eSBvZiAKCQkgKiBlYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkuIFRoaXMgYWxsb3dzIGdyZWF0IGZsZXhpYmlsaXR5IHdoZW4gY3JlYXRpbmcgCgkJICogdGFibGVzLCBhcyB0aGUgYW9Db2x1bW5EZWZzIGFycmF5cyBjYW4gYmUgb2YgYW55IGxlbmd0aCwgdGFyZ2V0aW5nIHRoZSAKCQkgKiBjb2x1bW5zIHlvdSBzcGVjaWZpY2FsbHkgd2FudC4gYW9Db2x1bW5EZWZzIG1heSB1c2UgYW55IG9mIHRoZSBjb2x1bW4gCgkJICogb3B0aW9ucyBhdmFpbGFibGU6IHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uc30sIGJ1dCBpdCBfbXVzdF8KCQkgKiBoYXZlIGFUYXJnZXRzIGRlZmluZWQgaW4gZWFjaCBvYmplY3QgaW4gdGhlIGFycmF5LiBWYWx1ZXMgaW4gdGhlIGFUYXJnZXRzCgkJICogYXJyYXkgbWF5IGJlOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+YSBzdHJpbmcgLSBjbGFzcyBuYW1lIHdpbGwgYmUgbWF0Y2hlZCBvbiB0aGUgVEggZm9yIHRoZSBjb2x1bW48L2xpPgoJCSAqICAgICA8bGk+MCBvciBhIHBvc2l0aXZlIGludGVnZXIgLSBjb2x1bW4gaW5kZXggY291bnRpbmcgZnJvbSB0aGUgbGVmdDwvbGk+CgkJICogICAgIDxsaT5hIG5lZ2F0aXZlIGludGVnZXIgLSBjb2x1bW4gaW5kZXggY291bnRpbmcgZnJvbSB0aGUgcmlnaHQ8L2xpPgoJCSAqICAgICA8bGk+dGhlIHN0cmluZyAiX2FsbCIgLSBhbGwgY29sdW1ucyAoaS5lLiBhc3NpZ24gYSBkZWZhdWx0KTwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAbWVtYmVyCgkJICovCgkJImFvQ29sdW1uRGVmcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEJhc2ljYWxseSB0aGUgc2FtZSBhcyBvU2VhcmNoLCB0aGlzIHBhcmFtZXRlciBkZWZpbmVzIHRoZSBpbmRpdmlkdWFsIGNvbHVtbgoJCSAqIGZpbHRlcmluZyBzdGF0ZSBhdCBpbml0aWFsaXNhdGlvbiB0aW1lLiBUaGUgYXJyYXkgbXVzdCBiZSBvZiB0aGUgc2FtZSBzaXplIAoJCSAqIGFzIHRoZSBudW1iZXIgb2YgY29sdW1ucywgYW5kIGVhY2ggZWxlbWVudCBiZSBhbiBvYmplY3Qgd2l0aCB0aGUgcGFyYW1ldGVycwoJCSAqICJzU2VhcmNoIiBhbmQgImJFc2NhcGVSZWdleCIgKHRoZSBsYXR0ZXIgaXMgb3B0aW9uYWwpLiAnbnVsbCcgaXMgYWxzbwoJCSAqIGFjY2VwdGVkIGFuZCB0aGUgZGVmYXVsdCB3aWxsIGJlIHVzZWQuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9TZWFyY2hDb2xzIjogWwoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgeyAic1NlYXJjaCI6ICJNeSBmaWx0ZXIiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJzU2VhcmNoIjogIl5bMC05XSIsICJiRXNjYXBlUmVnZXgiOiBmYWxzZSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiYW9TZWFyY2hDb2xzIjogW10sCgkKCQoJCS8qKgoJCSAqIEFuIGFycmF5IG9mIENTUyBjbGFzc2VzIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gZGlzcGxheWVkIHJvd3MuIFRoaXMgCgkJICogYXJyYXkgbWF5IGJlIG9mIGFueSBsZW5ndGgsIGFuZCBEYXRhVGFibGVzIHdpbGwgYXBwbHkgZWFjaCBjbGFzcyAKCQkgKiBzZXF1ZW50aWFsbHksIGxvb3Bpbmcgd2hlbiByZXF1aXJlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5XaWxsIHRha2UgdGhlIHZhbHVlcyBkZXRlcm1pbmVkIGJ5IHRoZSBvQ2xhc3Nlcy5zU3RyaXBlKgoJCSAqICAgIG9wdGlvbnM8L2k+CgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYXNTdHJpcGVDbGFzc2VzIjogWyAnc3RyaXAxJywgJ3N0cmlwMicsICdzdHJpcDMnIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiYXNTdHJpcGVDbGFzc2VzIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgYXV0b21hdGljIGNvbHVtbiB3aWR0aCBjYWxjdWxhdGlvbi4gVGhpcyBjYW4gYmUgZGlzYWJsZWQKCQkgKiBhcyBhbiBvcHRpbWlzYXRpb24gKGl0IHRha2VzIHNvbWUgdGltZSB0byBjYWxjdWxhdGUgdGhlIHdpZHRocykgaWYgdGhlCgkJICogdGFibGVzIHdpZHRocyBhcmUgcGFzc2VkIGluIHVzaW5nIGFvQ29sdW1ucy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkF1dG9XaWR0aCI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiQXV0b1dpZHRoIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRGVmZXJyZWQgcmVuZGVyaW5nIGNhbiBwcm92aWRlIERhdGFUYWJsZXMgd2l0aCBhIGh1Z2Ugc3BlZWQgYm9vc3Qgd2hlbiB5b3UKCQkgKiBhcmUgdXNpbmcgYW4gQWpheCBvciBKUyBkYXRhIHNvdXJjZSBmb3IgdGhlIHRhYmxlLiBUaGlzIG9wdGlvbiwgd2hlbiBzZXQgdG8KCQkgKiB0cnVlLCB3aWxsIGNhdXNlIERhdGFUYWJsZXMgdG8gZGVmZXIgdGhlIGNyZWF0aW9uIG9mIHRoZSB0YWJsZSBlbGVtZW50cyBmb3IKCQkgKiBlYWNoIHJvdyB1bnRpbCB0aGV5IGFyZSBuZWVkZWQgZm9yIGEgZHJhdyAtIHNhdmluZyBhIHNpZ25pZmljYW50IGFtb3VudCBvZgoJCSAqIHRpbWUuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2FycmF5cy50eHQiLAoJCSAqICAgICAgICAiYkRlZmVyUmVuZGVyIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkRlZmVyUmVuZGVyIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIFJlcGxhY2UgYSBEYXRhVGFibGUgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gc2VsZWN0b3IgYW5kIHJlcGxhY2UgaXQgd2l0aCAKCQkgKiBvbmUgd2hpY2ggaGFzIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBuZXcgaW5pdGlhbGlzYXRpb24gb2JqZWN0IHBhc3NlZC4gSWYgbm8KCQkgKiB0YWJsZSBtYXRjaGVzIHRoZSBzZWxlY3RvciwgdGhlbiB0aGUgbmV3IERhdGFUYWJsZSB3aWxsIGJlIGNvbnN0cnVjdGVkIGFzCgkJICogcGVyIG5vcm1hbC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb21lIHRpbWUgbGF0ZXIuLi4uCgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkZpbHRlciI6IGZhbHNlLAoJCSAqICAgICAgICAiYkRlc3Ryb3kiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRGVzdHJveSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBmaWx0ZXJpbmcgb2YgZGF0YS4gRmlsdGVyaW5nIGluIERhdGFUYWJsZXMgaXMgInNtYXJ0IiBpbgoJCSAqIHRoYXQgaXQgYWxsb3dzIHRoZSBlbmQgdXNlciB0byBpbnB1dCBtdWx0aXBsZSB3b3JkcyAoc3BhY2Ugc2VwYXJhdGVkKSBhbmQKCQkgKiB3aWxsIG1hdGNoIGEgcm93IGNvbnRhaW5pbmcgdGhvc2Ugd29yZHMsIGV2ZW4gaWYgbm90IGluIHRoZSBvcmRlciB0aGF0IHdhcwoJCSAqIHNwZWNpZmllZCAodGhpcyBhbGxvdyBtYXRjaGluZyBhY3Jvc3MgbXVsdGlwbGUgY29sdW1ucykuIE5vdGUgdGhhdCBpZiB5b3UKCQkgKiB3aXNoIHRvIHVzZSBmaWx0ZXJpbmcgaW4gRGF0YVRhYmxlcyB0aGlzIG11c3QgcmVtYWluICd0cnVlJyAtIHRvIHJlbW92ZSB0aGUKCQkgKiBkZWZhdWx0IGZpbHRlcmluZyBpbnB1dCBib3ggYW5kIHJldGFpbiBmaWx0ZXJpbmcgYWJpbGl0aWVzLCBwbGVhc2UgdXNlCgkJICoge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5zRG9tfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkZpbHRlciI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRmlsdGVyIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIHRhYmxlIGluZm9ybWF0aW9uIGRpc3BsYXkuIFRoaXMgc2hvd3MgaW5mb3JtYXRpb24gCgkJICogYWJvdXQgdGhlIGRhdGEgdGhhdCBpcyBjdXJyZW50bHkgdmlzaWJsZSBvbiB0aGUgcGFnZSwgaW5jbHVkaW5nIGluZm9ybWF0aW9uCgkJICogYWJvdXQgZmlsdGVyZWQgZGF0YSBpZiB0aGF0IGFjdGlvbiBpcyBiZWluZyBwZXJmb3JtZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJJbmZvIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJJbmZvIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGpRdWVyeSBVSSBUaGVtZVJvbGxlciBzdXBwb3J0IChyZXF1aXJlZCBhcyBUaGVtZVJvbGxlciByZXF1aXJlcyBzb21lCgkJICogc2xpZ2h0bHkgZGlmZmVyZW50IGFuZCBhZGRpdGlvbmFsIG1hcmstdXAgZnJvbSB3aGF0IERhdGFUYWJsZXMgaGFzCgkJICogdHJhZGl0aW9uYWxseSB1c2VkKS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkpRdWVyeVVJIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkpRdWVyeVVJIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEFsbG93cyB0aGUgZW5kIHVzZXIgdG8gc2VsZWN0IHRoZSBzaXplIG9mIGEgZm9ybWF0dGVkIHBhZ2UgZnJvbSBhIHNlbGVjdAoJCSAqIG1lbnUgKHNpemVzIGFyZSAxMCwgMjUsIDUwIGFuZCAxMDApLiBSZXF1aXJlcyBwYWdpbmF0aW9uIChiUGFnaW5hdGUpLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBwYWdpbmF0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlBhZ2luYXRlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgYSAncHJvY2Vzc2luZycgaW5kaWNhdG9yIHdoZW4gdGhlIHRhYmxlIGlzCgkJICogYmVpbmcgcHJvY2Vzc2VkIChlLmcuIGEgc29ydCkuIFRoaXMgaXMgcGFydGljdWxhcmx5IHVzZWZ1bCBmb3IgdGFibGVzIHdpdGgKCQkgKiBsYXJnZSBhbW91bnRzIG9mIGRhdGEgd2hlcmUgaXQgY2FuIHRha2UgYSBub3RpY2VhYmxlIGFtb3VudCBvZiB0aW1lIHRvIHNvcnQKCQkgKiB0aGUgZW50cmllcy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlByb2Nlc3NpbmciOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogUmV0cmlldmUgdGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gc2VsZWN0b3IuIE5vdGUgdGhhdCBpZiB0aGUKCQkgKiB0YWJsZSBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYWxpc2VkLCB0aGlzIHBhcmFtZXRlciB3aWxsIGNhdXNlIERhdGFUYWJsZXMKCQkgKiB0byBzaW1wbHkgcmV0dXJuIHRoZSBvYmplY3QgdGhhdCBoYXMgYWxyZWFkeSBiZWVuIHNldCB1cCAtIGl0IHdpbGwgbm90IHRha2UKCQkgKiBhY2NvdW50IG9mIGFueSBjaGFuZ2VzIHlvdSBtaWdodCBoYXZlIG1hZGUgdG8gdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdAoJCSAqIHBhc3NlZCB0byBEYXRhVGFibGVzIChzZXR0aW5nIHRoaXMgcGFyYW1ldGVyIHRvIHRydWUgaXMgYW4gYWNrbm93bGVkZ2VtZW50CgkJICogdGhhdCB5b3UgdW5kZXJzdGFuZCB0aGlzKS4gYkRlc3Ryb3kgY2FuIGJlIHVzZWQgdG8gcmVpbml0aWFsaXNlIGEgdGFibGUgaWYKCQkgKiB5b3UgbmVlZC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIGluaXRUYWJsZSgpOwoJCSAqICAgICAgdGFibGVBY3Rpb25zKCk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIGluaXRUYWJsZSAoKQoJCSAqICAgIHsKCQkgKiAgICAgIHJldHVybiAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UsCgkJICogICAgICAgICJiUmV0cmlldmUiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfQoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIHRhYmxlQWN0aW9ucyAoKQoJCSAqICAgIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSBpbml0VGFibGUoKTsKCQkgKiAgICAgIC8vIHBlcmZvcm0gQVBJIG9wZXJhdGlvbnMgd2l0aCBvVGFibGUgCgkJICogICAgfQoJCSAqLwoJCSJiUmV0cmlldmUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgRGF0YVRhYmxlcyBzaG91bGQgYmUgYWxsb3dlZCB0byBzZXQgdGhlIHBhZGRpbmcgLyBtYXJnaW4KCQkgKiBldGMgZm9yIHRoZSBzY3JvbGxpbmcgaGVhZGVyIGVsZW1lbnRzIG9yIG5vdC4gVHlwaWNhbGx5IHlvdSB3aWxsIHdhbnQKCQkgKiB0aGlzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNjcm9sbEF1dG9Dc3MiOiBmYWxzZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNjcm9sbEF1dG9Dc3MiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBXaGVuIHZlcnRpY2FsICh5KSBzY3JvbGxpbmcgaXMgZW5hYmxlZCwgRGF0YVRhYmxlcyB3aWxsIGZvcmNlIHRoZSBoZWlnaHQgb2YKCQkgKiB0aGUgdGFibGUncyB2aWV3cG9ydCB0byB0aGUgZ2l2ZW4gaGVpZ2h0IGF0IGFsbCB0aW1lcyAodXNlZnVsIGZvciBsYXlvdXQpLgoJCSAqIEhvd2V2ZXIsIHRoaXMgY2FuIGxvb2sgb2RkIHdoZW4gZmlsdGVyaW5nIGRhdGEgZG93biB0byBhIHNtYWxsIGRhdGEgc2V0LAoJCSAqIGFuZCB0aGUgZm9vdGVyIGlzIGxlZnQgImZsb2F0aW5nIiBmdXJ0aGVyIGRvd24uIFRoaXMgcGFyYW1ldGVyICh3aGVuCgkJICogZW5hYmxlZCkgd2lsbCBjYXVzZSBEYXRhVGFibGVzIHRvIGNvbGxhcHNlIHRoZSB0YWJsZSdzIHZpZXdwb3J0IGRvd24gd2hlbgoJCSAqIHRoZSByZXN1bHQgc2V0IHdpbGwgZml0IHdpdGhpbiB0aGUgZ2l2ZW4gWSBoZWlnaHQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwIiwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxDb2xsYXBzZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgaW5maW5pdGUgc2Nyb2xsaW5nIGZvciBEYXRhVGFibGVzICh0byBiZSB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGgKCQkgKiBzU2Nyb2xsWSkuIEluZmluaXRlIHNjcm9sbGluZyBtZWFucyB0aGF0IERhdGFUYWJsZXMgd2lsbCBjb250aW51YWxseSBsb2FkCgkJICogZGF0YSBhcyBhIHVzZXIgc2Nyb2xscyB0aHJvdWdoIGEgdGFibGUsIHdoaWNoIGlzIHZlcnkgdXNlZnVsIGZvciBsYXJnZQoJCSAqIGRhdGFzZXQuIFRoaXMgY2Fubm90IGJlIHVzZWQgd2l0aCBwYWdpbmF0aW9uLCB3aGljaCBpcyBhdXRvbWF0aWNhbGx5CgkJICogZGlzYWJsZWQuIE5vdGUgLSB0aGUgU2Nyb2xsZXIgZXh0cmEgZm9yIERhdGFUYWJsZXMgaXMgcmVjb21tZW5kZWQgaW4KCQkgKiBpbiBwcmVmZXJlbmNlIHRvIHRoaXMgb3B0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNjcm9sbEluZmluaXRlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIENvbmZpZ3VyZSBEYXRhVGFibGVzIHRvIHVzZSBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nLiBOb3RlIHRoYXQgdGhlCgkJICogc0FqYXhTb3VyY2UgcGFyYW1ldGVyIG11c3QgYWxzbyBiZSBnaXZlbiBpbiBvcmRlciB0byBnaXZlIERhdGFUYWJsZXMgYQoJCSAqIHNvdXJjZSB0byBvYnRhaW4gdGhlIHJlcXVpcmVkIGRhdGEgZm9yIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJ4aHIucGhwIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNlcnZlclNpZGUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgc29ydGluZyBvZiBjb2x1bW5zLiBTb3J0aW5nIG9mIGluZGl2aWR1YWwgY29sdW1ucyBjYW4gYmUKCQkgKiBkaXNhYmxlZCBieSB0aGUgImJTb3J0YWJsZSIgb3B0aW9uIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNvcnQiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnQiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgY29udHJvbCBvdmVyIHdoZXRoZXIgRGF0YVRhYmxlcyBzaG91bGQgdXNlIHRoZSB0b3AgKHRydWUpIHVuaXF1ZQoJCSAqIGNlbGwgdGhhdCBpcyBmb3VuZCBmb3IgYSBzaW5nbGUgY29sdW1uLCBvciB0aGUgYm90dG9tIChmYWxzZSAtIGRlZmF1bHQpLgoJCSAqIFRoaXMgaXMgdXNlZnVsIHdoZW4gdXNpbmcgY29tcGxleCBoZWFkZXJzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTb3J0Q2VsbHNUb3AiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU29ydENlbGxzVG9wIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBhZGRpdGlvbiBvZiB0aGUgY2xhc3NlcyAnc29ydGluZ18xJywgJ3NvcnRpbmdfMicgYW5kCgkJICogJ3NvcnRpbmdfMycgdG8gdGhlIGNvbHVtbnMgd2hpY2ggYXJlIGN1cnJlbnRseSBiZWluZyBzb3J0ZWQgb24uIFRoaXMgaXMKCQkgKiBwcmVzZW50ZWQgYXMgYSBmZWF0dXJlIHN3aXRjaCBhcyBpdCBjYW4gaW5jcmVhc2UgcHJvY2Vzc2luZyB0aW1lICh3aGlsZQoJCSAqIGNsYXNzZXMgYXJlIHJlbW92ZWQgYW5kIGFkZGVkKSBzbyBmb3IgbGFyZ2UgZGF0YSBzZXRzIHlvdSBtaWdodCB3YW50IHRvCgkJICogdHVybiB0aGlzIG9mZi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNvcnRDbGFzc2VzIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTb3J0Q2xhc3NlcyI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHN0YXRlIHNhdmluZy4gV2hlbiBlbmFibGVkIGEgY29va2llIHdpbGwgYmUgdXNlZCB0byBzYXZlCgkJICogdGFibGUgZGlzcGxheSBpbmZvcm1hdGlvbiBzdWNoIGFzIHBhZ2luYXRpb24gaW5mb3JtYXRpb24sIGRpc3BsYXkgbGVuZ3RoLAoJCSAqIGZpbHRlcmluZyBhbmQgc29ydGluZy4gQXMgc3VjaCB3aGVuIHRoZSBlbmQgdXNlciByZWxvYWRzIHRoZSBwYWdlIHRoZQoJCSAqIGRpc3BsYXkgZGlzcGxheSB3aWxsIG1hdGNoIHdoYXQgdGh5IGhhZCBwcmV2aW91c2x5IHNldCB1cC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU3RhdGVTYXZlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEN1c3RvbWlzZSB0aGUgY29va2llIGFuZCAvIG9yIHRoZSBwYXJhbWV0ZXJzIGJlaW5nIHN0b3JlZCB3aGVuIHVzaW5nCgkJICogRGF0YVRhYmxlcyB3aXRoIHN0YXRlIHNhdmluZyBlbmFibGVkLiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuZXZlcgoJCSAqIHRoZSBjb29raWUgaXMgbW9kaWZpZWQsIGFuZCBpdCBleHBlY3RzIGEgZnVsbHkgZm9ybWVkIGNvb2tpZSBzdHJpbmcgdG8gYmUKCQkgKiByZXR1cm5lZC4gTm90ZSB0aGF0IHRoZSBkYXRhIG9iamVjdCBwYXNzZWQgaW4gaXMgYSBKYXZhc2NyaXB0IG9iamVjdCB3aGljaAoJCSAqIG11c3QgYmUgY29udmVydGVkIHRvIGEgc3RyaW5nIChKU09OLnN0cmluZ2lmeSBmb3IgZXhhbXBsZSkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBOYW1lIG9mIHRoZSBjb29raWUgZGVmaW5lZCBieSBEYXRhVGFibGVzCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBEYXRhIHRvIGJlIHN0b3JlZCBpbiB0aGUgY29va2llCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRXhwaXJlcyBDb29raWUgZXhwaXJlcyBzdHJpbmcKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNQYXRoIFBhdGggb2YgdGhlIGNvb2tpZSB0byBzZXQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gQ29va2llIGZvcm1hdHRlZCBzdHJpbmcgKHdoaWNoIHNob3VsZCBiZSBlbmNvZGVkIGJ5CgkJICogICAgdXNpbmcgZW5jb2RlVVJJQ29tcG9uZW50KCkpCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuQ29va2llQ2FsbGJhY2siOiBmdW5jdGlvbiAoc05hbWUsIG9EYXRhLCBzRXhwaXJlcywgc1BhdGgpIHsKCQkgKiAgICAgICAgICAvLyBDdXN0b21pc2Ugb0RhdGEgb3Igc05hbWUgb3Igd2hhdGV2ZXIgZWxzZSBoZXJlCgkJICogICAgICAgICAgcmV0dXJuIHNOYW1lICsgIj0iK0pTT04uc3RyaW5naWZ5KG9EYXRhKSsiOyBleHBpcmVzPSIgKyBzRXhwaXJlcyArIjsgcGF0aD0iICsgc1BhdGg7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuQ29va2llQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIGEgVFIgZWxlbWVudCBpcyBjcmVhdGVkIChhbmQgYWxsIFREIGNoaWxkCgkJICogZWxlbWVudHMgaGF2ZSBiZWVuIGluc2VydGVkKSwgb3IgcmVnaXN0ZXJlZCBpZiB1c2luZyBhIERPTSBzb3VyY2UsIGFsbG93aW5nCgkJICogbWFuaXB1bGF0aW9uIG9mIHRoZSBUUiBlbGVtZW50IChhZGRpbmcgY2xhc3NlcyBldGMpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Sb3cgIlRSIiBlbGVtZW50IGZvciB0aGUgY3VycmVudCByb3cKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgUmF3IGRhdGEgYXJyYXkgZm9yIHRoaXMgcm93CgkJICogIEBwYXJhbSB7aW50fSBpRGF0YUluZGV4IFRoZSBpbmRleCBvZiB0aGlzIHJvdyBpbiBhb0RhdGEKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkNyZWF0ZWRSb3ciOiBmdW5jdGlvbiggblJvdywgYURhdGEsIGlEYXRhSW5kZXggKSB7CgkJICogICAgICAgICAgLy8gQm9sZCB0aGUgZ3JhZGUgZm9yIGFsbCAnQScgZ3JhZGUgYnJvd3NlcnMKCQkgKiAgICAgICAgICBpZiAoIGFEYXRhWzRdID09ICJBIiApCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgJCgndGQ6ZXEoNCknLCBuUm93KS5odG1sKCAnPGI+QTwvYj4nICk7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNyZWF0ZWRSb3ciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBldmVyeSAnZHJhdycgZXZlbnQsIGFuZCBhbGxvd3MgeW91IHRvCgkJICogZHluYW1pY2FsbHkgbW9kaWZ5IGFueSBhc3BlY3QgeW91IHdhbnQgYWJvdXQgdGhlIGNyZWF0ZWQgRE9NLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5EcmF3Q2FsbGJhY2siOiBmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCSAqICAgICAgICAgIGFsZXJ0KCAnRGF0YVRhYmxlcyBoYXMgcmVkcmF3biB0aGUgdGFibGUnICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuRHJhd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogSWRlbnRpY2FsIHRvIGZuSGVhZGVyQ2FsbGJhY2soKSBidXQgZm9yIHRoZSB0YWJsZSBmb290ZXIgdGhpcyBmdW5jdGlvbgoJCSAqIGFsbG93cyB5b3UgdG8gbW9kaWZ5IHRoZSB0YWJsZSBmb290ZXIgb24gZXZlcnkgJ2RyYXcnIGV2ZW4uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7bm9kZX0gbkZvb3QgIlRSIiBlbGVtZW50IGZvciB0aGUgZm9vdGVyCgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIEZ1bGwgdGFibGUgZGF0YSAoYXMgZGVyaXZlZCBmcm9tIHRoZSBvcmlnaW5hbCBIVE1MKQoJCSAqICBAcGFyYW0ge2ludH0gaVN0YXJ0IEluZGV4IGZvciB0aGUgY3VycmVudCBkaXNwbGF5IHN0YXJ0aW5nIHBvaW50IGluIHRoZSAKCQkgKiAgICBkaXNwbGF5IGFycmF5CgkJICogIEBwYXJhbSB7aW50fSBpRW5kIEluZGV4IGZvciB0aGUgY3VycmVudCBkaXNwbGF5IGVuZGluZyBwb2ludCBpbiB0aGUgCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5IGludH0gYWlEaXNwbGF5IEluZGV4IGFycmF5IHRvIHRyYW5zbGF0ZSB0aGUgdmlzdWFsIHBvc2l0aW9uCgkJICogICAgdG8gdGhlIGZ1bGwgZGF0YSBhcnJheQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRm9vdGVyQ2FsbGJhY2siOiBmdW5jdGlvbiggbkZvb3QsIGFEYXRhLCBpU3RhcnQsIGlFbmQsIGFpRGlzcGxheSApIHsKCQkgKiAgICAgICAgICBuRm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGgnKVswXS5pbm5lckhUTUwgPSAiU3RhcnRpbmcgaW5kZXggaXMgIitpU3RhcnQ7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiZm5Gb290ZXJDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFdoZW4gcmVuZGVyaW5nIGxhcmdlIG51bWJlcnMgaW4gdGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgZm9yIHRoZSB0YWJsZQoJCSAqIChpLmUuICJTaG93aW5nIDEgdG8gMTAgb2YgNTcgZW50cmllcyIpIERhdGFUYWJsZXMgd2lsbCByZW5kZXIgbGFyZ2UgbnVtYmVycwoJCSAqIHRvIGhhdmUgYSBjb21tYSBzZXBhcmF0b3IgZm9yIHRoZSAndGhvdXNhbmRzJyB1bml0cyAoZS5nLiAxIG1pbGxpb24gaXMKCQkgKiByZW5kZXJlZCBhcyAiMSwwMDAsMDAwIikgdG8gaGVscCByZWFkYWJpbGl0eSBmb3IgdGhlIGVuZCB1c2VyLiBUaGlzCgkJICogZnVuY3Rpb24gd2lsbCBvdmVycmlkZSB0aGUgZGVmYXVsdCBtZXRob2QgRGF0YVRhYmxlcyB1c2VzLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7aW50fSBpSW4gbnVtYmVyIHRvIGJlIGZvcm1hdHRlZAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBmb3JtYXR0ZWQgc3RyaW5nIGZvciBEYXRhVGFibGVzIHRvIHNob3cgdGhlIG51bWJlcgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRm9ybWF0TnVtYmVyIjogZnVuY3Rpb24gKCBpSW4gKSB7CgkJICogICAgICAgICAgaWYgKCBpSW4gJmx0OyAxMDAwICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIGlJbjsKCQkgKiAgICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgICAgdmFyIAoJCSAqICAgICAgICAgICAgICBzPShpSW4rIiIpLCAKCQkgKiAgICAgICAgICAgICAgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCAKCQkgKiAgICAgICAgICAgICAgaUxlbj1zLmxlbmd0aDsKCQkgKiAgICAgICAgICAgIAoJCSAqICAgICAgICAgICAgZm9yICggdmFyIGk9MCA7IGkmbHQ7aUxlbiA7IGkrKyApIHsKCQkgKiAgICAgICAgICAgICAgaWYgKCBpJTMgPT09IDAgJmFtcDsmYW1wOyBpICE9PSAwICkgewoJCSAqICAgICAgICAgICAgICAgIG91dCA9ICInIitvdXQ7CgkJICogICAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgICAgb3V0ID0gYVtpTGVuLWktMV0rb3V0OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICByZXR1cm4gb3V0OwoJCSAqICAgICAgICB9OwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Gb3JtYXROdW1iZXIiOiBmdW5jdGlvbiAoIGlJbiApIHsKCQkJaWYgKCBpSW4gPCAxMDAwICkKCQkJewoJCQkJLy8gQSBzbWFsbCBvcHRpbWlzYXRpb24gZm9yIHdoYXQgaXMgbGlrZWx5IHRvIGJlIHRoZSBtYWpvcml0eSBvZiB1c2UgY2FzZXMKCQkJCXJldHVybiBpSW47CgkJCX0KCQoJCQl2YXIgcz0oaUluKyIiKSwgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCBpTGVuPXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggaSUzID09PSAwICYmIGkgIT09IDAgKQoJCQkJewoJCQkJCW91dCA9IHRoaXMub0xhbmd1YWdlLnNJbmZvVGhvdXNhbmRzK291dDsKCQkJCX0KCQkJCW91dCA9IGFbaUxlbi1pLTFdK291dDsKCQkJfQoJCQlyZXR1cm4gb3V0OwoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIG9uIGV2ZXJ5ICdkcmF3JyBldmVudCwgYW5kIGFsbG93cyB5b3UgdG8KCQkgKiBkeW5hbWljYWxseSBtb2RpZnkgdGhlIGhlYWRlciByb3cuIFRoaXMgY2FuIGJlIHVzZWQgdG8gY2FsY3VsYXRlIGFuZAoJCSAqIGRpc3BsYXkgdXNlZnVsIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZCAiVFIiIGVsZW1lbnQgZm9yIHRoZSBoZWFkZXIKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgRnVsbCB0YWJsZSBkYXRhIChhcyBkZXJpdmVkIGZyb20gdGhlIG9yaWdpbmFsIEhUTUwpCgkJICogIEBwYXJhbSB7aW50fSBpU3RhcnQgSW5kZXggZm9yIHRoZSBjdXJyZW50IGRpc3BsYXkgc3RhcnRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5IGludH0gYWlEaXNwbGF5IEluZGV4IGFycmF5IHRvIHRyYW5zbGF0ZSB0aGUgdmlzdWFsIHBvc2l0aW9uCgkJICogICAgdG8gdGhlIGZ1bGwgZGF0YSBhcnJheQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSGVhZGVyQ2FsbGJhY2siOiBmdW5jdGlvbiggbkhlYWQsIGFEYXRhLCBpU3RhcnQsIGlFbmQsIGFpRGlzcGxheSApIHsKCQkgKiAgICAgICAgICBuSGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGgnKVswXS5pbm5lckhUTUwgPSAiRGlzcGxheWluZyAiKyhpRW5kLWlTdGFydCkrIiByZWNvcmRzIjsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJmbkhlYWRlckNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgY2FuIGJlIHVzZWQgdG8gY29udmV5IGluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50CgkJICogc3RhdGUgb2YgdGhlIHRhYmxlLiBBbHRob3VnaCB0aGUgaW50ZXJuYXRpb25hbGlzYXRpb24gb3B0aW9ucyBwcmVzZW50ZWQgYnkKCQkgKiBEYXRhVGFibGVzIGFyZSBxdWl0ZSBjYXBhYmxlIG9mIGRlYWxpbmcgd2l0aCBtb3N0IGN1c3RvbWlzYXRpb25zLCB0aGVyZSBtYXkKCQkgKiBiZSB0aW1lcyB3aGVyZSB5b3Ugd2lzaCB0byBjdXN0b21pc2UgdGhlIHN0cmluZyBmdXJ0aGVyLiBUaGlzIGNhbGxiYWNrCgkJICogYWxsb3dzIHlvdSB0byBkbyBleGFjdGx5IHRoYXQuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBTdGFydGluZyBwb3NpdGlvbiBpbiBkYXRhIGZvciB0aGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBFbmQgcG9zaXRpb24gaW4gZGF0YSBmb3IgdGhlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXggVG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHRhYmxlIChyZWdhcmRsZXNzIG9mCgkJICogICAgZmlsdGVyaW5nKQoJCSAqICBAcGFyYW0ge2ludH0gaVRvdGFsIFRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSBkYXRhIHNldCwgYWZ0ZXIgZmlsdGVyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUHJlIFRoZSBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGhhcyBmb3JtYXR0ZWQgdXNpbmcgaXQncwoJCSAqICAgIG93biBydWxlcwoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc3RyaW5nIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgaW5mb3JtYXRpb24gZWxlbWVudC4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAiZm5JbmZvQ2FsbGJhY2siOiBmdW5jdGlvbiggb1NldHRpbmdzLCBpU3RhcnQsIGlFbmQsIGlNYXgsIGlUb3RhbCwgc1ByZSApIHsKCQkgKiAgICAgICAgcmV0dXJuIGlTdGFydCArIiB0byAiKyBpRW5kOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5JbmZvQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgaGFzIGJlZW4gaW5pdGlhbGlzZWQuIE5vcm1hbGx5IERhdGFUYWJsZXMgd2lsbAoJCSAqIGluaXRpYWxpc2Ugc2VxdWVudGlhbGx5IGFuZCB0aGVyZSB3aWxsIGJlIG5vIG5lZWQgZm9yIHRoaXMgZnVuY3Rpb24sCgkJICogaG93ZXZlciwgdGhpcyBkb2VzIG5vdCBob2xkIHRydWUgd2hlbiB1c2luZyBleHRlcm5hbCBsYW5ndWFnZSBpbmZvcm1hdGlvbgoJCSAqIHNpbmNlIHRoYXQgaXMgb2J0YWluZWQgdXNpbmcgYW4gYXN5bmMgWEhSIGNhbGwuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CgkJICogICAgICAgICAgYWxlcnQoICdEYXRhVGFibGVzIGhhcyBmaW5pc2hlZCBpdHMgaW5pdGlhbGlzYXRpb24uJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuSW5pdENvbXBsZXRlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGVkIGF0IHRoZSB2ZXJ5IHN0YXJ0IG9mIGVhY2ggdGFibGUgZHJhdyBhbmQgY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZQoJCSAqIGRyYXcgYnkgcmV0dXJuaW5nIGZhbHNlLCBhbnkgb3RoZXIgcmV0dXJuIChpbmNsdWRpbmcgdW5kZWZpbmVkKSByZXN1bHRzIGluCgkJICogdGhlIGZ1bGwgZHJhdyBvY2N1cnJpbmcpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sZWFufSBGYWxzZSB3aWxsIGNhbmNlbCB0aGUgZHJhdywgYW55dGhpbmcgZWxzZSAoaW5jbHVkaW5nIG5vCgkJICogICAgcmV0dXJuKSB3aWxsIGFsbG93IGl0IHRvIGNvbXBsZXRlLgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuUHJlRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBpZiAoICQoJyN0ZXN0JykudmFsKCkgPT0gMSApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUHJlRHJhd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvICdwb3N0IHByb2Nlc3MnIGVhY2ggcm93IGFmdGVyIGl0IGhhdmUgYmVlbgoJCSAqIGdlbmVyYXRlZCBmb3IgZWFjaCB0YWJsZSBkcmF3LCBidXQgYmVmb3JlIGl0IGlzIHJlbmRlcmVkIG9uIHNjcmVlbi4gVGhpcwoJCSAqIGZ1bmN0aW9uIG1pZ2h0IGJlIHVzZWQgZm9yIHNldHRpbmcgdGhlIHJvdyBjbGFzcyBuYW1lIGV0Yy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleCBUaGUgZGlzcGxheSBpbmRleCBmb3IgdGhlIGN1cnJlbnQgdGFibGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleEZ1bGwgVGhlIGluZGV4IG9mIHRoZSBkYXRhIGluIHRoZSBmdWxsIGxpc3Qgb2YKCQkgKiAgICByb3dzIChhZnRlciBmaWx0ZXJpbmcpCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5Sb3dDYWxsYmFjayI6IGZ1bmN0aW9uKCBuUm93LCBhRGF0YSwgaURpc3BsYXlJbmRleCwgaURpc3BsYXlJbmRleEZ1bGwgKSB7CgkJICogICAgICAgICAgLy8gQm9sZCB0aGUgZ3JhZGUgZm9yIGFsbCAnQScgZ3JhZGUgYnJvd3NlcnMKCQkgKiAgICAgICAgICBpZiAoIGFEYXRhWzRdID09ICJBIiApCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgJCgndGQ6ZXEoNCknLCBuUm93KS5odG1sKCAnPGI+QTwvYj4nICk7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblJvd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBmdW5jdGlvbiB3aGljaCBvYnRhaW5zCgkJICogdGhlIGRhdGEgZnJvbSB0aGUgc2VydmVyICgkLmdldEpTT04pIHNvIHNvbWV0aGluZyBtb3JlIHN1aXRhYmxlIGZvciB5b3VyCgkJICogYXBwbGljYXRpb24uIEZvciBleGFtcGxlIHlvdSBjb3VsZCB1c2UgUE9TVCBkYXRhLCBvciBwdWxsIGluZm9ybWF0aW9uIGZyb20KCQkgKiBhIEdlYXJzIG9yIEFJUiBkYXRhYmFzZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NvdXJjZSBIVFRQIHNvdXJjZSB0byBvYnRhaW4gdGhlIGRhdGEgZnJvbSAoc0FqYXhTb3VyY2UpCgkJICogIEBwYXJhbSB7YXJyYXl9IGFvRGF0YSBBIGtleS92YWx1ZSBwYWlyIG9iamVjdCBjb250YWluaW5nIHRoZSBkYXRhIHRvIHNlbmQKCQkgKiAgICB0byB0aGUgc2VydmVyCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuQ2FsbGJhY2sgdG8gYmUgY2FsbGVkIG9uIGNvbXBsZXRpb24gb2YgdGhlIGRhdGEgZ2V0CgkJICogICAgcHJvY2VzcyB0aGF0IHdpbGwgZHJhdyB0aGUgZGF0YSBvbiB0aGUgcGFnZS4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogIEBkdG9wdCBTZXJ2ZXItc2lkZQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFBPU1QgZGF0YSB0byBzZXJ2ZXIKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAieGhyLnBocCIsCgkJICogICAgICAgICJmblNlcnZlckRhdGEiOiBmdW5jdGlvbiAoIHNTb3VyY2UsIGFvRGF0YSwgZm5DYWxsYmFjaywgb1NldHRpbmdzICkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5qcVhIUiA9ICQuYWpheCggewoJCSAqICAgICAgICAgICAgImRhdGFUeXBlIjogJ2pzb24nLCAKCQkgKiAgICAgICAgICAgICJ0eXBlIjogIlBPU1QiLCAKCQkgKiAgICAgICAgICAgICJ1cmwiOiBzU291cmNlLCAKCQkgKiAgICAgICAgICAgICJkYXRhIjogYW9EYXRhLCAKCQkgKiAgICAgICAgICAgICJzdWNjZXNzIjogZm5DYWxsYmFjawoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TZXJ2ZXJEYXRhIjogZnVuY3Rpb24gKCBzVXJsLCBhb0RhdGEsIGZuQ2FsbGJhY2ssIG9TZXR0aW5ncyApIHsKCQkJb1NldHRpbmdzLmpxWEhSID0gJC5hamF4KCB7CgkJCQkidXJsIjogIHNVcmwsCgkJCQkiZGF0YSI6IGFvRGF0YSwKCQkJCSJzdWNjZXNzIjogZnVuY3Rpb24gKGpzb24pIHsKCQkJCQlpZiAoIGpzb24uc0Vycm9yICkgewoJCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5Mb2coIG9TZXR0aW5ncywgMCwganNvbi5zRXJyb3IgKTsKCQkJCQl9CgkJCQkJCgkJCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCd4aHInLCBbb1NldHRpbmdzLCBqc29uXSk7CgkJCQkJZm5DYWxsYmFjaygganNvbiApOwoJCQkJfSwKCQkJCSJkYXRhVHlwZSI6ICJqc29uIiwKCQkJCSJjYWNoZSI6IGZhbHNlLAoJCQkJInR5cGUiOiBvU2V0dGluZ3Muc1NlcnZlck1ldGhvZCwKCQkJCSJlcnJvciI6IGZ1bmN0aW9uICh4aHIsIGVycm9yLCB0aHJvd24pIHsKCQkJCQlpZiAoIGVycm9yID09ICJwYXJzZXJlcnJvciIgKSB7CgkJCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkxvZyggb1NldHRpbmdzLCAwLCAiRGF0YVRhYmxlcyB3YXJuaW5nOiBKU09OIGRhdGEgZnJvbSAiKwoJCQkJCQkJInNlcnZlciBjb3VsZCBub3QgYmUgcGFyc2VkLiBUaGlzIGlzIGNhdXNlZCBieSBhIEpTT04gZm9ybWF0dGluZyBlcnJvci4iICk7CgkJCQkJfQoJCQkJfQoJCQl9ICk7CgkJfSwKCQoJCgkJLyoqCgkJICogSXQgaXMgb2Z0ZW4gdXNlZnVsIHRvIHNlbmQgZXh0cmEgZGF0YSB0byB0aGUgc2VydmVyIHdoZW4gbWFraW5nIGFuIEFqYXgKCQkgKiByZXF1ZXN0IC0gZm9yIGV4YW1wbGUgY3VzdG9tIGZpbHRlcmluZyBpbmZvcm1hdGlvbiwgYW5kIHRoaXMgY2FsbGJhY2sKCQkgKiBmdW5jdGlvbiBtYWtlcyBpdCB0cml2aWFsIHRvIHNlbmQgZXh0cmEgaW5mb3JtYXRpb24gdG8gdGhlIHNlcnZlci4gVGhlCgkJICogcGFzc2VkIGluIHBhcmFtZXRlciBpcyB0aGUgZGF0YSBzZXQgdGhhdCBoYXMgYmVlbiBjb25zdHJ1Y3RlZCBieQoJCSAqIERhdGFUYWJsZXMsIGFuZCB5b3UgY2FuIGFkZCB0byB0aGlzIG9yIG1vZGlmeSBpdCBhcyB5b3UgcmVxdWlyZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gYW9EYXRhIERhdGEgYXJyYXkgKGFycmF5IG9mIG9iamVjdHMgd2hpY2ggYXJlIG5hbWUvdmFsdWUKCQkgKiAgICBwYWlycykgdGhhdCBoYXMgYmVlbiBjb25zdHJ1Y3RlZCBieSBEYXRhVGFibGVzIGFuZCB3aWxsIGJlIHNlbnQgdG8gdGhlCgkJICogICAgc2VydmVyLiBJbiB0aGUgY2FzZSBvZiBBamF4IHNvdXJjZWQgZGF0YSB3aXRoIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcKCQkgKiAgICB0aGlzIHdpbGwgYmUgYW4gZW1wdHkgYXJyYXksIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRoZXJlIHdpbGwgYmUgYQoJCSAqICAgIHNpZ25pZmljYW50IG51bWJlciBvZiBwYXJhbWV0ZXJzIQoJCSAqICBAcmV0dXJucyB7dW5kZWZpbmVkfSBFbnN1cmUgdGhhdCB5b3UgbW9kaWZ5IHRoZSBhb0RhdGEgYXJyYXkgcGFzc2VkIGluLAoJCSAqICAgIGFzIHRoaXMgaXMgcGFzc2VkIGJ5IHJlZmVyZW5jZS4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJQYXJhbXMiOiBmdW5jdGlvbiAoIGFvRGF0YSApIHsKCQkgKiAgICAgICAgICBhb0RhdGEucHVzaCggeyAibmFtZSI6ICJtb3JlX2RhdGEiLCAidmFsdWUiOiAibXlfdmFsdWUiIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TZXJ2ZXJQYXJhbXMiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBMb2FkIHRoZSB0YWJsZSBzdGF0ZS4gV2l0aCB0aGlzIGZ1bmN0aW9uIHlvdSBjYW4gZGVmaW5lIGZyb20gd2hlcmUsIGFuZCBob3csIHRoZQoJCSAqIHN0YXRlIG9mIGEgdGFibGUgaXMgbG9hZGVkLiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgd2lsbCBsb2FkIGZyb20gaXRzIHN0YXRlIHNhdmluZwoJCSAqIGNvb2tpZSwgYnV0IHlvdSBtaWdodCB3aXNoIHRvIHVzZSBsb2NhbCBzdG9yYWdlIChIVE1MNSkgb3IgYSBzZXJ2ZXItc2lkZSBkYXRhYmFzZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm4ge29iamVjdH0gVGhlIERhdGFUYWJsZXMgc3RhdGUgb2JqZWN0IHRvIGJlIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZUxvYWQiOiBmdW5jdGlvbiAob1NldHRpbmdzKSB7CgkJICogICAgICAgICAgdmFyIG87CgkJICogICAgICAgICAgCgkJICogICAgICAgICAgLy8gU2VuZCBhbiBBamF4IHJlcXVlc3QgdG8gdGhlIHNlcnZlciB0byBnZXQgdGhlIGRhdGEuIE5vdGUgdGhhdAoJCSAqICAgICAgICAgIC8vIHRoaXMgaXMgYSBzeW5jaHJvbm91cyByZXF1ZXN0LgoJCSAqICAgICAgICAgICQuYWpheCggewoJCSAqICAgICAgICAgICAgInVybCI6ICIvc3RhdGVfbG9hZCIsCgkJICogICAgICAgICAgICAiYXN5bmMiOiBmYWxzZSwKCQkgKiAgICAgICAgICAgICJkYXRhVHlwZSI6ICJqc29uIiwKCQkgKiAgICAgICAgICAgICJzdWNjZXNzIjogZnVuY3Rpb24gKGpzb24pIHsKCQkgKiAgICAgICAgICAgICAgbyA9IGpzb247CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgfSApOwoJCSAqICAgICAgICAgIAoJCSAqICAgICAgICAgIHJldHVybiBvOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlTG9hZCI6IGZ1bmN0aW9uICggb1NldHRpbmdzICkgewoJCQl2YXIgc0RhdGEgPSB0aGlzLm9BcGkuX2ZuUmVhZENvb2tpZSggb1NldHRpbmdzLnNDb29raWVQcmVmaXgrb1NldHRpbmdzLnNJbnN0YW5jZSApOwoJCQl2YXIgb0RhdGE7CgkKCQkJdHJ5IHsKCQkJCW9EYXRhID0gKHR5cGVvZiAkLnBhcnNlSlNPTiA9PT0gJ2Z1bmN0aW9uJykgPyAKCQkJCQkkLnBhcnNlSlNPTihzRGF0YSkgOiBldmFsKCAnKCcrc0RhdGErJyknICk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCW9EYXRhID0gbnVsbDsKCQkJfQoJCgkJCXJldHVybiBvRGF0YTsKCQl9LAoJCgkKCQkvKioKCQkgKiBDYWxsYmFjayB3aGljaCBhbGxvd3MgbW9kaWZpY2F0aW9uIG9mIHRoZSBzYXZlZCBzdGF0ZSBwcmlvciB0byBsb2FkaW5nIHRoYXQgc3RhdGUuCgkJICogVGhpcyBjYWxsYmFjayBpcyBjYWxsZWQgd2hlbiB0aGUgdGFibGUgaXMgbG9hZGluZyBzdGF0ZSBmcm9tIHRoZSBzdG9yZWQgZGF0YSwgYnV0CgkJICogcHJpb3IgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBiZWluZyBtb2RpZmllZCBieSB0aGUgc2F2ZWQgc3RhdGUuIE5vdGUgdGhhdCBmb3IgCgkJICogcGx1Zy1pbiBhdXRob3JzLCB5b3Ugc2hvdWxkIHVzZSB0aGUgJ3N0YXRlTG9hZFBhcmFtcycgZXZlbnQgdG8gbG9hZCBwYXJhbWV0ZXJzIGZvciAKCQkgKiBhIHBsdWctaW4uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdGhhdCBpcyB0byBiZSBsb2FkZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFJlbW92ZSBhIHNhdmVkIGZpbHRlciwgc28gZmlsdGVyaW5nIGlzIG5ldmVyIGxvYWRlZAoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBvRGF0YS5vU2VhcmNoLnNTZWFyY2ggPSAiIjsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBEaXNhbGxvdyBzdGF0ZSBsb2FkaW5nIGJ5IHJldHVybmluZyBmYWxzZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVMb2FkUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgdGhhdCBpcyBjYWxsZWQgd2hlbiB0aGUgc3RhdGUgaGFzIGJlZW4gbG9hZGVkIGZyb20gdGhlIHN0YXRlIHNhdmluZyBtZXRob2QKCQkgKiBhbmQgdGhlIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IGhhcyBiZWVuIG1vZGlmaWVkIGFzIGEgcmVzdWx0IG9mIHRoZSBsb2FkZWQgc3RhdGUuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdGhhdCB3YXMgbG9hZGVkCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBTaG93IGFuIGFsZXJ0IHdpdGggdGhlIGZpbHRlcmluZyB2YWx1ZSB0aGF0IHdhcyBzYXZlZAoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkZWQiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIGFsZXJ0KCAnU2F2ZWQgZmlsdGVyIHdhczogJytvRGF0YS5vU2VhcmNoLnNTZWFyY2ggKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZUxvYWRlZCI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFNhdmUgdGhlIHRhYmxlIHN0YXRlLiBUaGlzIGZ1bmN0aW9uIGFsbG93cyB5b3UgdG8gZGVmaW5lIHdoZXJlIGFuZCBob3cgdGhlIHN0YXRlCgkJICogaW5mb3JtYXRpb24gZm9yIHRoZSB0YWJsZSBpcyBzdG9yZWQgLSBieSBkZWZhdWx0IGl0IHdpbGwgdXNlIGEgY29va2llLCBidXQgeW91CgkJICogbWlnaHQgd2FudCB0byB1c2UgbG9jYWwgc3RvcmFnZSAoSFRNTDUpIG9yIGEgc2VydmVyLXNpZGUgZGF0YWJhc2UuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBtZW1iZXIKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0byBiZSBzYXZlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIC8vIFNlbmQgYW4gQWpheCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgd2l0aCB0aGUgc3RhdGUgb2JqZWN0CgkJICogICAgICAgICAgJC5hamF4KCB7CgkJICogICAgICAgICAgICAidXJsIjogIi9zdGF0ZV9zYXZlIiwKCQkgKiAgICAgICAgICAgICJkYXRhIjogb0RhdGEsCgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAianNvbiIsCgkJICogICAgICAgICAgICAibWV0aG9kIjogIlBPU1QiCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZ1bmN0aW9uICgpIHt9CgkJICogICAgICAgICAgfSApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlU2F2ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBvRGF0YSApIHsKCQkJdGhpcy5vQXBpLl9mbkNyZWF0ZUNvb2tpZSggCgkJCQlvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCtvU2V0dGluZ3Muc0luc3RhbmNlLCAKCQkJCXRoaXMub0FwaS5fZm5Kc29uU3RyaW5nKG9EYXRhKSwgCgkJCQlvU2V0dGluZ3MuaUNvb2tpZUR1cmF0aW9uLCAKCQkJCW9TZXR0aW5ncy5zQ29va2llUHJlZml4LCAKCQkJCW9TZXR0aW5ncy5mbkNvb2tpZUNhbGxiYWNrCgkJCSk7CgkJfSwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgd2hpY2ggYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc3RhdGUgdG8gYmUgc2F2ZWQuIENhbGxlZCB3aGVuIHRoZSB0YWJsZSAKCQkgKiBoYXMgY2hhbmdlZCBzdGF0ZSBhIG5ldyBzdGF0ZSBzYXZlIGlzIHJlcXVpcmVkLiBUaGlzIG1ldGhvZCBhbGxvd3MgbW9kaWZpY2F0aW9uIG9mCgkJICogdGhlIHN0YXRlIHNhdmluZyBvYmplY3QgcHJpb3IgdG8gYWN0dWFsbHkgZG9pbmcgdGhlIHNhdmUsIGluY2x1ZGluZyBhZGRpdGlvbiBvciAKCQkgKiBvdGhlciBzdGF0ZSBwcm9wZXJ0aWVzIG9yIG1vZGlmaWNhdGlvbi4gTm90ZSB0aGF0IGZvciBwbHVnLWluIGF1dGhvcnMsIHlvdSBzaG91bGQgCgkJICogdXNlIHRoZSAnc3RhdGVTYXZlUGFyYW1zJyBldmVudCB0byBzYXZlIHBhcmFtZXRlcnMgZm9yIGEgcGx1Zy1pbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0byBiZSBzYXZlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUmVtb3ZlIGEgc2F2ZWQgZmlsdGVyLCBzbyBmaWx0ZXJpbmcgaXMgbmV2ZXIgc2F2ZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlU2F2ZVBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgb0RhdGEub1NlYXJjaC5zU2VhcmNoID0gIiI7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVTYXZlUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRHVyYXRpb24gb2YgdGhlIGNvb2tpZSB3aGljaCBpcyB1c2VkIGZvciBzdG9yaW5nIHNlc3Npb24gaW5mb3JtYXRpb24uIFRoaXMKCQkgKiB2YWx1ZSBpcyBnaXZlbiBpbiBzZWNvbmRzLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgNzIwMCA8aT4oMiBob3Vycyk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlDb29raWVEdXJhdGlvbiI6IDYwKjYwKjI0OyAvLyAxIGRheQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJpQ29va2llRHVyYXRpb24iOiA3MjAwLAoJCgkKCQkvKioKCQkgKiBXaGVuIGVuYWJsZWQgRGF0YVRhYmxlcyB3aWxsIG5vdCBtYWtlIGEgcmVxdWVzdCB0byB0aGUgc2VydmVyIGZvciB0aGUgZmlyc3QKCQkgKiBwYWdlIGRyYXcgLSByYXRoZXIgaXQgd2lsbCB1c2UgdGhlIGRhdGEgYWxyZWFkeSBvbiB0aGUgcGFnZSAobm8gc29ydGluZyBldGMKCQkgKiB3aWxsIGJlIGFwcGxpZWQgdG8gaXQpLCB0aHVzIHNhdmluZyBvbiBhbiBYSFIgYXQgbG9hZCB0aW1lLiBpRGVmZXJMb2FkaW5nCgkJICogaXMgdXNlZCB0byBpbmRpY2F0ZSB0aGF0IGRlZmVycmVkIGxvYWRpbmcgaXMgcmVxdWlyZWQsIGJ1dCBpdCBpcyBhbHNvIHVzZWQKCQkgKiB0byB0ZWxsIERhdGFUYWJsZXMgaG93IG1hbnkgcmVjb3JkcyB0aGVyZSBhcmUgaW4gdGhlIGZ1bGwgdGFibGUgKGFsbG93aW5nCgkJICogdGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgYW5kIHBhZ2luYXRpb24gdG8gYmUgZGlzcGxheWVkIGNvcnJlY3RseSkuIEluIHRoZSBjYXNlCgkJICogd2hlcmUgYSBmaWx0ZXJpbmcgaXMgYXBwbGllZCB0byB0aGUgdGFibGUgb24gaW5pdGlhbCBsb2FkLCB0aGlzIGNhbiBiZQoJCSAqIGluZGljYXRlZCBieSBnaXZpbmcgdGhlIHBhcmFtZXRlciBhcyBhbiBhcnJheSwgd2hlcmUgdGhlIGZpcnN0IGVsZW1lbnQgaXMKCQkgKiB0aGUgbnVtYmVyIG9mIHJlY29yZHMgYXZhaWxhYmxlIGFmdGVyIGZpbHRlcmluZyBhbmQgdGhlIHNlY29uZCBlbGVtZW50IGlzIHRoZQoJCSAqIG51bWJlciBvZiByZWNvcmRzIHdpdGhvdXQgZmlsdGVyaW5nIChhbGxvd2luZyB0aGUgdGFibGUgaW5mb3JtYXRpb24gZWxlbWVudAoJCSAqIHRvIGJlIHNob3duIGNvcnJlY3RseSkuCgkJICogIEB0eXBlIGludCB8IGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyA1NyByZWNvcmRzIGF2YWlsYWJsZSBpbiB0aGUgdGFibGUsIG5vIGZpbHRlcmluZyBhcHBsaWVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNjcmlwdHMvc2VydmVyX3Byb2Nlc3NpbmcucGhwIiwKCQkgKiAgICAgICAgImlEZWZlckxvYWRpbmciOiA1NwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyA1NyByZWNvcmRzIGFmdGVyIGZpbHRlcmluZywgMTAwIHdpdGhvdXQgZmlsdGVyaW5nIChhbiBpbml0aWFsIGZpbHRlciBhcHBsaWVkKQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3NlcnZlcl9wcm9jZXNzaW5nLnBocCIsCgkJICogICAgICAgICJpRGVmZXJMb2FkaW5nIjogWyA1NywgMTAwIF0sCgkJICogICAgICAgICJvU2VhcmNoIjogewoJCSAqICAgICAgICAgICJzU2VhcmNoIjogIm15X2ZpbHRlciIKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiaURlZmVyTG9hZGluZyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIE51bWJlciBvZiByb3dzIHRvIGRpc3BsYXkgb24gYSBzaW5nbGUgcGFnZSB3aGVuIHVzaW5nIHBhZ2luYXRpb24uIElmCgkJICogZmVhdHVyZSBlbmFibGVkIChiTGVuZ3RoQ2hhbmdlKSB0aGVuIHRoZSBlbmQgdXNlciB3aWxsIGJlIGFibGUgdG8gb3ZlcnJpZGUKCQkgKiB0aGlzIHRvIGEgY3VzdG9tIHNldHRpbmcgdXNpbmcgYSBwb3AtdXAgbWVudS4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDEwCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogNTAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaURpc3BsYXlMZW5ndGgiOiAxMCwKCQoJCgkJLyoqCgkJICogRGVmaW5lIHRoZSBzdGFydGluZyBwb2ludCBmb3IgZGF0YSBkaXNwbGF5IHdoZW4gdXNpbmcgRGF0YVRhYmxlcyB3aXRoCgkJICogcGFnaW5hdGlvbi4gTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIGlzIHRoZSBudW1iZXIgb2YgcmVjb3JkcywgcmF0aGVyIHRoYW4KCQkgKiB0aGUgcGFnZSBudW1iZXIsIHNvIGlmIHlvdSBoYXZlIDEwIHJlY29yZHMgcGVyIHBhZ2UgYW5kIHdhbnQgdG8gc3RhcnQgb24KCQkgKiB0aGUgdGhpcmQgcGFnZSwgaXQgc2hvdWxkIGJlICIyMCIuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlEaXNwbGF5U3RhcnQiOiAyMAoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJpRGlzcGxheVN0YXJ0IjogMCwKCQoJCgkJLyoqCgkJICogVGhlIHNjcm9sbCBnYXAgaXMgdGhlIGFtb3VudCBvZiBzY3JvbGxpbmcgdGhhdCBpcyBsZWZ0IHRvIGdvIGJlZm9yZQoJCSAqIERhdGFUYWJsZXMgd2lsbCBsb2FkIHRoZSBuZXh0ICdwYWdlJyBvZiBkYXRhIGF1dG9tYXRpY2FsbHkuIFlvdSB0eXBpY2FsbHkKCQkgKiB3YW50IGEgZ2FwIHdoaWNoIGlzIGJpZyBlbm91Z2ggdGhhdCB0aGUgc2Nyb2xsaW5nIHdpbGwgYmUgc21vb3RoIGZvciB0aGUKCQkgKiB1c2VyLCB3aGlsZSBub3Qgc28gbGFyZ2UgdGhhdCBpdCB3aWxsIGxvYWQgbW9yZSBkYXRhIHRoYW4gbmVlZC4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDEwMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImlTY3JvbGxMb2FkR2FwIjogNTAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlTY3JvbGxMb2FkR2FwIjogMTAwLAoJCgkKCQkvKioKCQkgKiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgYWxsb3dzIGtleWJvYXJkIG5hdmlnYXRpb24gb2YgdGhlIHRhYmxlIChzb3J0aW5nLCBwYWdpbmcsCgkJICogYW5kIGZpbHRlcmluZykgYnkgYWRkaW5nIGEgdGFiaW5kZXggYXR0cmlidXRlIHRvIHRoZSByZXF1aXJlZCBlbGVtZW50cy4gVGhpcwoJCSAqIGFsbG93cyB5b3UgdG8gdGFiIHRocm91Z2ggdGhlIGNvbnRyb2xzIGFuZCBwcmVzcyB0aGUgZW50ZXIga2V5IHRvIGFjdGl2YXRlIHRoZW0uCgkJICogVGhlIHRhYmluZGV4IGlzIGRlZmF1bHQgMCwgbWVhbmluZyB0aGF0IHRoZSB0YWIgZm9sbG93cyB0aGUgZmxvdyBvZiB0aGUgZG9jdW1lbnQuCgkJICogWW91IGNhbiBvdmVycnVsZSB0aGlzIHVzaW5nIHRoaXMgcGFyYW1ldGVyIGlmIHlvdSB3aXNoLiBVc2UgYSB2YWx1ZSBvZiAtMSB0bwoJCSAqIGRpc2FibGUgYnVpbHQtaW4ga2V5Ym9hcmQgbmF2aWdhdGlvbi4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiaVRhYkluZGV4IjogMQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiaVRhYkluZGV4IjogMCwKCQoJCgkJLyoqCgkJICogQWxsIHN0cmluZ3MgdGhhdCBEYXRhVGFibGVzIHVzZXMgaW4gdGhlIHVzZXIgaW50ZXJmYWNlIHRoYXQgaXQgY3JlYXRlcwoJCSAqIGFyZSBkZWZpbmVkIGluIHRoaXMgb2JqZWN0LCBhbGxvd2luZyB5b3UgdG8gbW9kaWZpZWQgdGhlbSBpbmRpdmlkdWFsbHkgb3IKCQkgKiBjb21wbGV0ZWx5IHJlcGxhY2UgdGhlbSBhbGwgYXMgcmVxdWlyZWQuCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib0xhbmd1YWdlIjogewoJCQkvKioKCQkJICogU3RyaW5ncyB0aGF0IGFyZSB1c2VkIGZvciBXQUktQVJJQSBsYWJlbHMgYW5kIGNvbnRyb2xzIG9ubHkgKHRoZXNlIGFyZSBub3QKCQkJICogYWN0dWFsbHkgdmlzaWJsZSBvbiB0aGUgcGFnZSwgYnV0IHdpbGwgYmUgcmVhZCBieSBzY3JlZW5yZWFkZXJzLCBhbmQgdGh1cwoJCQkgKiBtdXN0IGJlIGludGVybmF0aW9uYWxpc2VkIGFzIHdlbGwpLgoJCQkgKiAgQG5hbWVzcGFjZQoJCQkgKi8KCQkJIm9BcmlhIjogewoJCQkJLyoqCgkJCQkgKiBBUklBIGxhYmVsIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHRhYmxlIGhlYWRlcnMgd2hlbiB0aGUgY29sdW1uIG1heSBiZQoJCQkJICogc29ydGVkIGFzY2VuZGluZyBieSBhY3RpdmluZyB0aGUgY29sdW1uIChjbGljayBvciByZXR1cm4gd2hlbiBmb2N1c2VkKS4KCQkJCSAqIE5vdGUgdGhhdCB0aGUgY29sdW1uIGhlYWRlciBpcyBwcmVmaXhlZCB0byB0aGlzIHN0cmluZy4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCA6IGFjdGl2YXRlIHRvIHNvcnQgY29sdW1uIGFzY2VuZGluZwoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9BcmlhIjogewoJCQkJICogICAgICAgICAgICAic1NvcnRBc2NlbmRpbmciOiAiIC0gY2xpY2svcmV0dXJuIHRvIHNvcnQgYXNjZW5kaW5nIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic1NvcnRBc2NlbmRpbmciOiAiOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmciLAoJCgkJCQkvKioKCQkJCSAqIEFSSUEgbGFiZWwgdGhhdCBpcyBhZGRlZCB0byB0aGUgdGFibGUgaGVhZGVycyB3aGVuIHRoZSBjb2x1bW4gbWF5IGJlCgkJCQkgKiBzb3J0ZWQgZGVzY2VuZGluZyBieSBhY3RpdmluZyB0aGUgY29sdW1uIChjbGljayBvciByZXR1cm4gd2hlbiBmb2N1c2VkKS4KCQkJCSAqIE5vdGUgdGhhdCB0aGUgY29sdW1uIGhlYWRlciBpcyBwcmVmaXhlZCB0byB0aGlzIHN0cmluZy4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCA6IGFjdGl2YXRlIHRvIHNvcnQgY29sdW1uIGFzY2VuZGluZwoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9BcmlhIjogewoJCQkJICogICAgICAgICAgICAic1NvcnREZXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGRlc2NlbmRpbmciCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzU29ydERlc2NlbmRpbmciOiAiOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBkZXNjZW5kaW5nIgoJCQl9LAoJCgkJCS8qKgoJCQkgKiBQYWdpbmF0aW9uIHN0cmluZyB1c2VkIGJ5IERhdGFUYWJsZXMgZm9yIHRoZSB0d28gYnVpbHQtaW4gcGFnaW5hdGlvbgoJCQkgKiBjb250cm9sIHR5cGVzICgidHdvX2J1dHRvbiIgYW5kICJmdWxsX251bWJlcnMiKQoJCQkgKiAgQG5hbWVzcGFjZQoJCQkgKi8KCQkJIm9QYWdpbmF0ZSI6IHsKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBmaXJzdCBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IEZpcnN0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic0ZpcnN0IjogIkZpcnN0IHBhZ2UiCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzRmlyc3QiOiAiRmlyc3QiLAoJCQkKCQkJCgkJCQkvKioKCQkJCSAqIFRleHQgdG8gdXNlIHdoZW4gdXNpbmcgdGhlICdmdWxsX251bWJlcnMnIHR5cGUgb2YgcGFnaW5hdGlvbiBmb3IgdGhlCgkJCQkgKiBidXR0b24gdG8gdGFrZSB0aGUgdXNlciB0byB0aGUgbGFzdCBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IExhc3QKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzTGFzdCI6ICJMYXN0IHBhZ2UiCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzTGFzdCI6ICJMYXN0IiwKCQkJCgkJCQoJCQkJLyoqCgkJCQkgKiBUZXh0IHRvIHVzZSB3aGVuIHVzaW5nIHRoZSAnZnVsbF9udW1iZXJzJyB0eXBlIG9mIHBhZ2luYXRpb24gZm9yIHRoZQoJCQkJICogYnV0dG9uIHRvIHRha2UgdGhlIHVzZXIgdG8gdGhlIG5leHQgcGFnZS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBOZXh0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic05leHQiOiAiTmV4dCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic05leHQiOiAiTmV4dCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBwcmV2aW91cyBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IFByZXZpb3VzCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic1ByZXZpb3VzIjogIlByZXZpb3VzIHBhZ2UiCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzUHJldmlvdXMiOiAiUHJldmlvdXMiCgkJCX0sCgkJCgkJCS8qKgoJCQkgKiBUaGlzIHN0cmluZyBpcyBzaG93biBpbiBwcmVmZXJlbmNlIHRvIHNaZXJvUmVjb3JkcyB3aGVuIHRoZSB0YWJsZSBpcwoJCQkgKiBlbXB0eSBvZiBkYXRhIChyZWdhcmRsZXNzIG9mIGZpbHRlcmluZykuIE5vdGUgdGhhdCB0aGlzIGlzIGFuIG9wdGlvbmFsCgkJCSAqIHBhcmFtZXRlciAtIGlmIGl0IGlzIG5vdCBnaXZlbiwgdGhlIHZhbHVlIG9mIHNaZXJvUmVjb3JkcyB3aWxsIGJlIHVzZWQKCQkJICogaW5zdGVhZCAoZWl0aGVyIHRoZSBkZWZhdWx0IG9yIGdpdmVuIHZhbHVlKS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGUKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNFbXB0eVRhYmxlIjogIk5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNFbXB0eVRhYmxlIjogIk5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFRoaXMgc3RyaW5nIGdpdmVzIGluZm9ybWF0aW9uIHRvIHRoZSBlbmQgdXNlciBhYm91dCB0aGUgaW5mb3JtYXRpb24gdGhhdCAKCQkJICogaXMgY3VycmVudCBvbiBkaXNwbGF5IG9uIHRoZSBwYWdlLiBUaGUgX1NUQVJUXywgX0VORF8gYW5kIF9UT1RBTF8gCgkJCSAqIHZhcmlhYmxlcyBhcmUgYWxsIGR5bmFtaWNhbGx5IHJlcGxhY2VkIGFzIHRoZSB0YWJsZSBkaXNwbGF5IHVwZGF0ZXMsIGFuZCAKCQkJICogY2FuIGJlIGZyZWVseSBtb3ZlZCBvciByZW1vdmVkIGFzIHRoZSBsYW5ndWFnZSByZXF1aXJlbWVudHMgY2hhbmdlLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBTaG93aW5nIF9TVEFSVF8gdG8gX0VORF8gb2YgX1RPVEFMXyBlbnRyaWVzCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mbyI6ICJHb3QgYSB0b3RhbCBvZiBfVE9UQUxfIGVudHJpZXMgdG8gc2hvdyAoX1NUQVJUXyB0byBfRU5EXykiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm8iOiAiU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEaXNwbGF5IGluZm9ybWF0aW9uIHN0cmluZyBmb3Igd2hlbiB0aGUgdGFibGUgaXMgZW1wdHkuIFR5cGljYWxseSB0aGUgCgkJCSAqIGZvcm1hdCBvZiB0aGlzIHN0cmluZyBzaG91bGQgbWF0Y2ggc0luZm8uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0luZm9FbXB0eSI6ICJObyBlbnRyaWVzIHRvIHNob3ciCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9FbXB0eSI6ICJTaG93aW5nIDAgdG8gMCBvZiAwIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogV2hlbiBhIHVzZXIgZmlsdGVycyB0aGUgaW5mb3JtYXRpb24gaW4gYSB0YWJsZSwgdGhpcyBzdHJpbmcgaXMgYXBwZW5kZWQgCgkJCSAqIHRvIHRoZSBpbmZvcm1hdGlvbiAoc0luZm8pIHRvIGdpdmUgYW4gaWRlYSBvZiBob3cgc3Ryb25nIHRoZSBmaWx0ZXJpbmcgCgkJCSAqIGlzLiBUaGUgdmFyaWFibGUgX01BWF8gaXMgZHluYW1pY2FsbHkgdXBkYXRlZC4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgKGZpbHRlcmVkIGZyb20gX01BWF8gdG90YWwgZW50cmllcykKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNJbmZvRmlsdGVyZWQiOiAiIC0gZmlsdGVyaW5nIGZyb20gX01BWF8gcmVjb3JkcyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb0ZpbHRlcmVkIjogIihmaWx0ZXJlZCBmcm9tIF9NQVhfIHRvdGFsIGVudHJpZXMpIiwKCQkKCQkKCQkJLyoqCgkJCSAqIElmIGNhbiBiZSB1c2VmdWwgdG8gYXBwZW5kIGV4dHJhIGluZm9ybWF0aW9uIHRvIHRoZSBpbmZvIHN0cmluZyBhdCB0aW1lcywKCQkJICogYW5kIHRoaXMgdmFyaWFibGUgZG9lcyBleGFjdGx5IHRoYXQuIFRoaXMgaW5mb3JtYXRpb24gd2lsbCBiZSBhcHBlbmRlZCB0bwoJCQkgKiB0aGUgc0luZm8gKHNJbmZvRW1wdHkgYW5kIHNJbmZvRmlsdGVyZWQgaW4gd2hhdGV2ZXIgY29tYmluYXRpb24gdGhleSBhcmUKCQkJICogYmVpbmcgdXNlZCkgYXQgYWxsIHRpbWVzLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb1Bvc3RGaXgiOiAiQWxsIHJlY29yZHMgc2hvd24gYXJlIGRlcml2ZWQgZnJvbSByZWFsIGluZm9ybWF0aW9uLiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb1Bvc3RGaXgiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERhdGFUYWJsZXMgaGFzIGEgYnVpbGQgaW4gbnVtYmVyIGZvcm1hdHRlciAoZm5Gb3JtYXROdW1iZXIpIHdoaWNoIGlzIHVzZWQKCQkJICogdG8gZm9ybWF0IGxhcmdlIG51bWJlcnMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUgaW5mb3JtYXRpb24uIEJ5CgkJCSAqIGRlZmF1bHQgYSBjb21tYSBpcyB1c2VkLCBidXQgdGhpcyBjYW4gYmUgdHJpdmlhbGx5IGNoYW5nZWQgdG8gYW55CgkJCSAqIGNoYXJhY3RlciB5b3Ugd2lzaCB3aXRoIHRoaXMgcGFyYW1ldGVyLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAsCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb1Rob3VzYW5kcyI6ICInIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNJbmZvVGhvdXNhbmRzIjogIiwiLAoJCQoJCQoJCQkvKioKCQkJICogRGV0YWlsIHRoZSBhY3Rpb24gdGhhdCB3aWxsIGJlIHRha2VuIHdoZW4gdGhlIGRyb3AgZG93biBtZW51IGZvciB0aGUKCQkJICogcGFnaW5hdGlvbiBsZW5ndGggb3B0aW9uIGlzIGNoYW5nZWQuIFRoZSAnX01FTlVfJyB2YXJpYWJsZSBpcyByZXBsYWNlZAoJCQkgKiB3aXRoIGEgZGVmYXVsdCBzZWxlY3QgbGlzdCBvZiAxMCwgMjUsIDUwIGFuZCAxMDAsIGFuZCBjYW4gYmUgcmVwbGFjZWQKCQkJICogd2l0aCBhIGN1c3RvbSBzZWxlY3QgYm94IGlmIHJlcXVpcmVkLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBTaG93IF9NRU5VXyBlbnRyaWVzCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBMYW5ndWFnZSBjaGFuZ2Ugb25seQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTGVuZ3RoTWVudSI6ICJEaXNwbGF5IF9NRU5VXyByZWNvcmRzIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKiAgICAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIExhbmd1YWdlIGFuZCBvcHRpb25zIGNoYW5nZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTGVuZ3RoTWVudSI6ICdEaXNwbGF5IDxzZWxlY3Q+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMTAiPjEwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMjAiPjIwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMzAiPjMwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNDAiPjQwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNTAiPjUwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iLTEiPkFsbDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzwvc2VsZWN0PiByZWNvcmRzJwoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNMZW5ndGhNZW51IjogIlNob3cgX01FTlVfIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogV2hlbiB1c2luZyBBamF4IHNvdXJjZWQgZGF0YSBhbmQgZHVyaW5nIHRoZSBmaXJzdCBkcmF3IHdoZW4gRGF0YVRhYmxlcyBpcwoJCQkgKiBnYXRoZXJpbmcgdGhlIGRhdGEsIHRoaXMgbWVzc2FnZSBpcyBzaG93biBpbiBhbiBlbXB0eSByb3cgaW4gdGhlIHRhYmxlIHRvCgkJCSAqIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGUgdGhlIGRhdGEgaXMgYmVpbmcgbG9hZGVkLiBOb3RlIHRoYXQgdGhpcwoJCQkgKiBwYXJhbWV0ZXIgaXMgbm90IHVzZWQgd2hlbiBsb2FkaW5nIGRhdGEgYnkgc2VydmVyLXNpZGUgcHJvY2Vzc2luZywganVzdAoJCQkgKiBBamF4IHNvdXJjZWQgZGF0YSB3aXRoIGNsaWVudC1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IExvYWRpbmcuLi4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNMb2FkaW5nUmVjb3JkcyI6ICJQbGVhc2Ugd2FpdCAtIGxvYWRpbmcuLi4iCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0xvYWRpbmdSZWNvcmRzIjogIkxvYWRpbmcuLi4iLAoJCQoJCQoJCQkvKioKCQkJICogVGV4dCB3aGljaCBpcyBkaXNwbGF5ZWQgd2hlbiB0aGUgdGFibGUgaXMgcHJvY2Vzc2luZyBhIHVzZXIgYWN0aW9uCgkJCSAqICh1c3VhbGx5IGEgc29ydCBjb21tYW5kIG9yIHNpbWlsYXIpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBQcm9jZXNzaW5nLi4uCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzUHJvY2Vzc2luZyI6ICJEYXRhVGFibGVzIGlzIGN1cnJlbnRseSBidXN5IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNQcm9jZXNzaW5nIjogIlByb2Nlc3NpbmcuLi4iLAoJCQoJCQoJCQkvKioKCQkJICogRGV0YWlscyB0aGUgYWN0aW9ucyB0aGF0IHdpbGwgYmUgdGFrZW4gd2hlbiB0aGUgdXNlciB0eXBlcyBpbnRvIHRoZQoJCQkgKiBmaWx0ZXJpbmcgaW5wdXQgdGV4dCBib3guIFRoZSB2YXJpYWJsZSAiX0lOUFVUXyIsIGlmIHVzZWQgaW4gdGhlIHN0cmluZywKCQkJICogaXMgcmVwbGFjZWQgd2l0aCB0aGUgSFRNTCB0ZXh0IGJveCBmb3IgdGhlIGZpbHRlcmluZyBpbnB1dCBhbGxvd2luZwoJCQkgKiBjb250cm9sIG92ZXIgd2hlcmUgaXQgYXBwZWFycyBpbiB0aGUgc3RyaW5nLiBJZiAiX0lOUFVUXyIgaXMgbm90IGdpdmVuCgkJCSAqIHRoZW4gdGhlIGlucHV0IGJveCBpcyBhcHBlbmRlZCB0byB0aGUgc3RyaW5nIGF1dG9tYXRpY2FsbHkuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNlYXJjaDoKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIElucHV0IHRleHQgYm94IHdpbGwgYmUgYXBwZW5kZWQgYXQgdGhlIGVuZCBhdXRvbWF0aWNhbGx5CgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNTZWFyY2giOiAiRmlsdGVyIHJlY29yZHM6IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKiAgICAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIFNwZWNpZnkgd2hlcmUgdGhlIGZpbHRlciBzaG91bGQgYXBwZWFyCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNTZWFyY2giOiAiQXBwbHkgZmlsdGVyIF9JTlBVVF8gdG8gdGFibGUiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1NlYXJjaCI6ICJTZWFyY2g6IiwKCQkKCQkKCQkJLyoqCgkJCSAqIEFsbCBvZiB0aGUgbGFuZ3VhZ2UgaW5mb3JtYXRpb24gY2FuIGJlIHN0b3JlZCBpbiBhIGZpbGUgb24gdGhlCgkJCSAqIHNlcnZlci1zaWRlLCB3aGljaCBEYXRhVGFibGVzIHdpbGwgbG9vayB1cCBpZiB0aGlzIHBhcmFtZXRlciBpcyBwYXNzZWQuCgkJCSAqIEl0IG11c3Qgc3RvcmUgdGhlIFVSTCBvZiB0aGUgbGFuZ3VhZ2UgZmlsZSwgd2hpY2ggaXMgaW4gYSBKU09OIGZvcm1hdCwKCQkJICogYW5kIHRoZSBvYmplY3QgaGFzIHRoZSBzYW1lIHByb3BlcnRpZXMgYXMgdGhlIG9MYW5ndWFnZSBvYmplY3QgaW4gdGhlCgkJCSAqIGluaXRpYWxpc2VyIG9iamVjdCAoaS5lLiB0aGUgYWJvdmUgcGFyYW1ldGVycykuIFBsZWFzZSByZWZlciB0byBvbmUgb2YKCQkJICogdGhlIGV4YW1wbGUgbGFuZ3VhZ2UgZmlsZXMgdG8gc2VlIGhvdyB0aGlzIHdvcmtzIGluIGFjdGlvbi4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNVcmwiOiAiaHR0cDovL3d3dy5zcHJ5bWVkaWEuY28udWsvZGF0YVRhYmxlcy9sYW5nLnR4dCIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzVXJsIjogIiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBUZXh0IHNob3duIGluc2lkZSB0aGUgdGFibGUgcmVjb3JkcyB3aGVuIHRoZSBpcyBubyBpbmZvcm1hdGlvbiB0byBiZQoJCQkgKiBkaXNwbGF5ZWQgYWZ0ZXIgZmlsdGVyaW5nLiBzRW1wdHlUYWJsZSBpcyBzaG93biB3aGVuIHRoZXJlIGlzIHNpbXBseSBubwoJCQkgKiBpbmZvcm1hdGlvbiBpbiB0aGUgdGFibGUgYXQgYWxsIChyZWdhcmRsZXNzIG9mIGZpbHRlcmluZykuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IE5vIG1hdGNoaW5nIHJlY29yZHMgZm91bmQKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNaZXJvUmVjb3JkcyI6ICJObyByZWNvcmRzIHRvIGRpc3BsYXkiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1plcm9SZWNvcmRzIjogIk5vIG1hdGNoaW5nIHJlY29yZHMgZm91bmQiCgkJfSwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byBoYXZlIGRlZmluZSB0aGUgZ2xvYmFsIGZpbHRlcmluZyBzdGF0ZSBhdAoJCSAqIGluaXRpYWxpc2F0aW9uIHRpbWUuIEFzIGFuIG9iamVjdCB0aGUgInNTZWFyY2giIHBhcmFtZXRlciBtdXN0IGJlCgkJICogZGVmaW5lZCwgYnV0IGFsbCBvdGhlciBwYXJhbWV0ZXJzIGFyZSBvcHRpb25hbC4gV2hlbiAiYlJlZ2V4IiBpcyB0cnVlLAoJCSAqIHRoZSBzZWFyY2ggc3RyaW5nIHdpbGwgYmUgdHJlYXRlZCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgd2hlbiBmYWxzZQoJCSAqIChkZWZhdWx0KSBpdCB3aWxsIGJlIHRyZWF0ZWQgYXMgYSBzdHJhaWdodCBzdHJpbmcuIFdoZW4gImJTbWFydCIKCQkgKiBEYXRhVGFibGVzIHdpbGwgdXNlIGl0J3Mgc21hcnQgZmlsdGVyaW5nIG1ldGhvZHMgKHRvIHdvcmQgbWF0Y2ggYXQKCQkgKiBhbnkgcG9pbnQgaW4gdGhlIGRhdGEpLCB3aGVuIGZhbHNlIHRoaXMgd2lsbCBub3QgYmUgZG9uZS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAZXh0ZW5kcyBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2gKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAib1NlYXJjaCI6IHsic1NlYXJjaCI6ICJJbml0aWFsIHNlYXJjaCJ9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJIm9TZWFyY2giOiAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCApLAoJCgkKCQkvKioKCQkgKiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgd2lsbCBsb29rIGZvciB0aGUgcHJvcGVydHkgJ2FhRGF0YScgd2hlbiBvYnRhaW5pbmcKCQkgKiBkYXRhIGZyb20gYW4gQWpheCBzb3VyY2Ugb3IgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgLSB0aGlzIHBhcmFtZXRlcgoJCSAqIGFsbG93cyB0aGF0IHByb3BlcnR5IHRvIGJlIGNoYW5nZWQuIFlvdSBjYW4gdXNlIEphdmFzY3JpcHQgZG90dGVkIG9iamVjdAoJCSAqIG5vdGF0aW9uIHRvIGdldCBhIGRhdGEgc291cmNlIGZvciBtdWx0aXBsZSBsZXZlbHMgb2YgbmVzdGluZy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGFhRGF0YQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBHZXQgZGF0YSBmcm9tIHsgImRhdGEiOiBbLi4uXSB9CgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RhdGEudHh0IiwKCQkgKiAgICAgICAgInNBamF4RGF0YVByb3AiOiAiZGF0YSIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogeyAiaW5uZXIiOiBbLi4uXSB9IH0KCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNvdXJjZXMvZGF0YS50eHQiLAoJCSAqICAgICAgICAic0FqYXhEYXRhUHJvcCI6ICJkYXRhLmlubmVyIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0FqYXhEYXRhUHJvcCI6ICJhYURhdGEiLAoJCgkKCQkvKioKCQkgKiBZb3UgY2FuIGluc3RydWN0IERhdGFUYWJsZXMgdG8gbG9hZCBkYXRhIGZyb20gYW4gZXh0ZXJuYWwgc291cmNlIHVzaW5nIHRoaXMKCQkgKiBwYXJhbWV0ZXIgKHVzZSBhRGF0YSBpZiB5b3Ugd2FudCB0byBwYXNzIGRhdGEgaW4geW91IGFscmVhZHkgaGF2ZSkuIFNpbXBseQoJCSAqIHByb3ZpZGUgYSB1cmwgYSBKU09OIG9iamVjdCBjYW4gYmUgb2J0YWluZWQgZnJvbS4gVGhpcyBvYmplY3QgbXVzdCBpbmNsdWRlCgkJICogdGhlIHBhcmFtZXRlciAnYWFEYXRhJyB3aGljaCBpcyB0aGUgZGF0YSBzb3VyY2UgZm9yIHRoZSB0YWJsZS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogImh0dHA6Ly93d3cuc3ByeW1lZGlhLmNvLnVrL2RhdGFUYWJsZXMvanNvbi5waHAiCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJInNBamF4U291cmNlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgY2FuIGJlIHVzZWQgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgcHJlZml4IHRoYXQgRGF0YVRhYmxlcwoJCSAqIGFzc2lnbnMgdG8gYSBjb29raWUgd2hlbiBzdGF0ZSBzYXZpbmcgaXMgZW5hYmxlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IFNwcnlNZWRpYV9EYXRhVGFibGVzXwoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQ29va2llUHJlZml4IjogIm15X2RhdGF0YWJsZV8iLAoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0Nvb2tpZVByZWZpeCI6ICJTcHJ5TWVkaWFfRGF0YVRhYmxlc18iLAoJCgkKCQkvKioKCQkgKiBUaGlzIGluaXRpYWxpc2F0aW9uIHZhcmlhYmxlIGFsbG93cyB5b3UgdG8gc3BlY2lmeSBleGFjdGx5IHdoZXJlIGluIHRoZQoJCSAqIERPTSB5b3Ugd2FudCBEYXRhVGFibGVzIHRvIGluamVjdCB0aGUgdmFyaW91cyBjb250cm9scyBpdCBhZGRzIHRvIHRoZSBwYWdlCgkJICogKGZvciBleGFtcGxlIHlvdSBtaWdodCB3YW50IHRoZSBwYWdpbmF0aW9uIGNvbnRyb2xzIGF0IHRoZSB0b3Agb2YgdGhlCgkJICogdGFibGUpLiBESVYgZWxlbWVudHMgKHdpdGggb3Igd2l0aG91dCBhIGN1c3RvbSBjbGFzcykgY2FuIGFsc28gYmUgYWRkZWQgdG8KCQkgKiBhaWQgc3R5bGluZy4gVGhlIGZvbGxvdyBzeW50YXggaXMgdXNlZDoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgb3B0aW9ucyBhcmUgYWxsb3dlZDoJCgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPidsJyAtIExlbmd0aCBjaGFuZ2luZzwvbGkKCQkgKiAgICAgICAgIDxsaT4nZicgLSBGaWx0ZXJpbmcgaW5wdXQ8L2xpPgoJCSAqICAgICAgICAgPGxpPid0JyAtIFRoZSB0YWJsZSE8L2xpPgoJCSAqICAgICAgICAgPGxpPidpJyAtIEluZm9ybWF0aW9uPC9saT4KCQkgKiAgICAgICAgIDxsaT4ncCcgLSBQYWdpbmF0aW9uPC9saT4KCQkgKiAgICAgICAgIDxsaT4ncicgLSBwUm9jZXNzaW5nPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+VGhlIGZvbGxvd2luZyBjb25zdGFudHMgYXJlIGFsbG93ZWQ6CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPidIJyAtIGpRdWVyeVVJIHRoZW1lICJoZWFkZXIiIGNsYXNzZXMgKCdmZy10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLXRsIHVpLWNvcm5lci10ciB1aS1oZWxwZXItY2xlYXJmaXgnKTwvbGk+CgkJICogICAgICAgICA8bGk+J0YnIC0galF1ZXJ5VUkgdGhlbWUgImZvb3RlciIgY2xhc3NlcyAoJ2ZnLXRvb2xiYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYmwgdWktY29ybmVyLWJyIHVpLWhlbHBlci1jbGVhcmZpeCcpPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+VGhlIGZvbGxvd2luZyBzeW50YXggaXMgZXhwZWN0ZWQ6CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPicmbHQ7JyBhbmQgJyZndDsnIC0gZGl2IGVsZW1lbnRzPC9saT4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyJjbGFzcyIgYW5kICcmZ3Q7JyAtIGRpdiB3aXRoIGEgY2xhc3M8L2xpPgoJCSAqICAgICAgICAgPGxpPicmbHQ7IiNpZCIgYW5kICcmZ3Q7JyAtIGRpdiB3aXRoIGFuIElEPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+RXhhbXBsZXM6CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPicmbHQ7IndyYXBwZXIiZmxpcHQmZ3Q7JzwvbGk+CgkJICogICAgICAgICA8bGk+JyZsdDtsZiZsdDt0Jmd0O2lwJmd0Oyc8L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbGZydGlwIDxpPih3aGVuIGJKUXVlcnlVSSBpcyBmYWxzZSk8L2k+IDxiPm9yPC9iPiAKCQkgKiAgICA8IkgibGZyPnQ8IkYiaXA+IDxpPih3aGVuIGJKUXVlcnlVSSBpcyB0cnVlKTwvaT4KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0RvbSI6ICcmbHQ7InRvcCJpJmd0O3J0Jmx0OyJib3R0b20iZmxwJmd0OyZsdDsiY2xlYXIiJmd0OycKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNEb20iOiAibGZydGlwIiwKCQoJCgkJLyoqCgkJICogRGF0YVRhYmxlcyBmZWF0dXJlcyB0d28gZGlmZmVyZW50IGJ1aWx0LWluIHBhZ2luYXRpb24gaW50ZXJhY3Rpb24gbWV0aG9kcwoJCSAqICgndHdvX2J1dHRvbicgb3IgJ2Z1bGxfbnVtYmVycycpIHdoaWNoIHByZXNlbnQgZGlmZmVyZW50IHBhZ2UgY29udHJvbHMgdG8KCQkgKiB0aGUgZW5kIHVzZXIuIEZ1cnRoZXIgbWV0aG9kcyBjYW4gYmUgYWRkZWQgdXNpbmcgdGhlIEFQSSAoc2VlIGJlbG93KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IHR3b19idXR0b24KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1BhZ2luYXRpb25UeXBlIjogImZ1bGxfbnVtYmVycyIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkic1BhZ2luYXRpb25UeXBlIjogInR3b19idXR0b24iLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgaG9yaXpvbnRhbCBzY3JvbGxpbmcuIFdoZW4gYSB0YWJsZSBpcyB0b28gd2lkZSB0byBmaXQgaW50byBhIGNlcnRhaW4KCQkgKiBsYXlvdXQsIG9yIHlvdSBoYXZlIGEgbGFyZ2UgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIHRhYmxlLCB5b3UgY2FuIGVuYWJsZQoJCSAqIHgtc2Nyb2xsaW5nIHRvIHNob3cgdGhlIHRhYmxlIGluIGEgdmlld3BvcnQsIHdoaWNoIGNhbiBiZSBzY3JvbGxlZC4gVGhpcwoJCSAqIHByb3BlcnR5IGNhbiBiZSBhbnkgQ1NTIHVuaXQsIG9yIGEgbnVtYmVyIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZAoJCSAqIGFzIGEgcGl4ZWwgbWVhc3VyZW1lbnQpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+Ymxhbmsgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxYIjogIjEwMCUiLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1Njcm9sbFgiOiAiIiwKCQoJCgkJLyoqCgkJICogVGhpcyBwcm9wZXJ0eSBjYW4gYmUgdXNlZCB0byBmb3JjZSBhIERhdGFUYWJsZSB0byB1c2UgbW9yZSB3aWR0aCB0aGFuIGl0CgkJICogbWlnaHQgb3RoZXJ3aXNlIGRvIHdoZW4geC1zY3JvbGxpbmcgaXMgZW5hYmxlZC4gRm9yIGV4YW1wbGUgaWYgeW91IGhhdmUgYQoJCSAqIHRhYmxlIHdoaWNoIHJlcXVpcmVzIHRvIGJlIHdlbGwgc3BhY2VkLCB0aGlzIHBhcmFtZXRlciBpcyB1c2VmdWwgZm9yCgkJICogIm92ZXItc2l6aW5nIiB0aGUgdGFibGUsIGFuZCB0aHVzIGZvcmNpbmcgc2Nyb2xsaW5nLiBUaGlzIHByb3BlcnR5IGNhbiBieQoJCSAqIGFueSBDU1MgdW5pdCwgb3IgYSBudW1iZXIgKGluIHdoaWNoIGNhc2UgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgcGl4ZWwKCQkgKiBtZWFzdXJlbWVudCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5ibGFuayBzdHJpbmcgLSBpLmUuIGRpc2FibGVkPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWCI6ICIxMDAlIiwKCQkgKiAgICAgICAgInNTY3JvbGxYSW5uZXIiOiAiMTEwJSIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTY3JvbGxYSW5uZXIiOiAiIiwKCQoJCgkJLyoqCgkJICogRW5hYmxlIHZlcnRpY2FsIHNjcm9sbGluZy4gVmVydGljYWwgc2Nyb2xsaW5nIHdpbGwgY29uc3RyYWluIHRoZSBEYXRhVGFibGUKCQkgKiB0byB0aGUgZ2l2ZW4gaGVpZ2h0LCBhbmQgZW5hYmxlIHNjcm9sbGluZyBmb3IgYW55IGRhdGEgd2hpY2ggb3ZlcmZsb3dzIHRoZQoJCSAqIGN1cnJlbnQgdmlld3BvcnQuIFRoaXMgY2FuIGJlIHVzZWQgYXMgYW4gYWx0ZXJuYXRpdmUgdG8gcGFnaW5nIHRvIGRpc3BsYXkKCQkgKiBhIGxvdCBvZiBkYXRhIGluIGEgc21hbGwgYXJlYSAoYWx0aG91Z2ggcGFnaW5nIGFuZCBzY3JvbGxpbmcgY2FuIGJvdGggYmUKCQkgKiBlbmFibGVkIGF0IHRoZSBzYW1lIHRpbWUpLiBUaGlzIHByb3BlcnR5IGNhbiBiZSBhbnkgQ1NTIHVuaXQsIG9yIGEgbnVtYmVyCgkJICogKGluIHdoaWNoIGNhc2UgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgcGl4ZWwgbWVhc3VyZW1lbnQpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+Ymxhbmsgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWSI6ICIiLAoJCgkKCQkvKioKCQkgKiBTZXQgdGhlIEhUVFAgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBtYWtlIHRoZSBBamF4IGNhbGwgZm9yIHNlcnZlci1zaWRlCgkJICogcHJvY2Vzc2luZyBvciBBamF4IHNvdXJjZWQgZGF0YS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IEdFVAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9wb3N0LnBocCIsCgkJICogICAgICAgICJzU2VydmVyTWV0aG9kIjogIlBPU1QiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2VydmVyTWV0aG9kIjogIkdFVCIKCX07CgkKCQoJCgkvKioKCSAqIENvbHVtbiBvcHRpb25zIHRoYXQgY2FuIGJlIGdpdmVuIHRvIERhdGFUYWJsZXMgYXQgaW5pdGlhbGlzYXRpb24gdGltZS4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zID0gewoJCS8qKgoJCSAqIEFsbG93cyBhIGNvbHVtbidzIHNvcnRpbmcgdG8gdGFrZSBtdWx0aXBsZSBjb2x1bW5zIGludG8gYWNjb3VudCB3aGVuIAoJCSAqIGRvaW5nIGEgc29ydC4gRm9yIGV4YW1wbGUgZmlyc3QgbmFtZSAvIGxhc3QgbmFtZSBjb2x1bW5zIG1ha2Ugc2Vuc2UgdG8gCgkJICogZG8gYSBtdWx0aS1jb2x1bW4gc29ydCBvdmVyIHRoZSB0d28gY29sdW1ucy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5UYWtlcyB0aGUgdmFsdWUgb2YgdGhlIGNvbHVtbiBpbmRleCBhdXRvbWF0aWNhbGx5PC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAwLCAxIF0sICJhVGFyZ2V0cyI6IFsgMCBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAxLCAwIF0sICJhVGFyZ2V0cyI6IFsgMSBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAyLCAzLCA0IF0sICJhVGFyZ2V0cyI6IFsgMiBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAxLCAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJhRGF0YVNvcnQiOiBbIDIsIDMsIDQgXSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhRGF0YVNvcnQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBZb3UgY2FuIGNvbnRyb2wgdGhlIGRlZmF1bHQgc29ydGluZyBkaXJlY3Rpb24sIGFuZCBldmVuIGFsdGVyIHRoZSBiZWhhdmlvdXIKCQkgKiBvZiB0aGUgc29ydCBoYW5kbGVyIChpLmUuIG9ubHkgYWxsb3cgYXNjZW5kaW5nIHNvcnRpbmcgZXRjKSB1c2luZyB0aGlzCgkJICogcGFyYW1ldGVyLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbICdhc2MnLCAnZGVzYycgXQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAiYXNTb3J0aW5nIjogWyAiYXNjIiBdLCAiYVRhcmdldHMiOiBbIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiLCAiYXNjIiwgImFzYyIgXSwgImFUYXJnZXRzIjogWyAyIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiBdLCAiYVRhcmdldHMiOiBbIDMgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImFzYyIgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiLCAiYXNjIiwgImFzYyIgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiIF0gfSwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFzU29ydGluZyI6IFsgJ2FzYycsICdkZXNjJyBdLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBmaWx0ZXJpbmcgb24gdGhlIGRhdGEgaW4gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTZWFyY2hhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTZWFyY2hhYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNlYXJjaGFibGUiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBzb3J0aW5nIG9uIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJiU29ydGFibGUiOiBmYWxzZSwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRhYmxlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB1c2luZyBmblJlbmRlcigpIGZvciBhIGNvbHVtbiwgeW91IG1heSB3aXNoIHRvIHVzZSB0aGUgb3JpZ2luYWwgZGF0YQoJCSAqIChiZWZvcmUgcmVuZGVyaW5nKSBmb3Igc29ydGluZyBhbmQgZmlsdGVyaW5nICh0aGUgZGVmYXVsdCBpcyB0byB1c2VkIHRoZQoJCSAqIHJlbmRlcmVkIGRhdGEgdGhhdCB0aGUgdXNlciBjYW4gc2VlKS4gVGhpcyBtYXkgYmUgdXNlZnVsIGZvciBkYXRlcyBldGMuCgkJICogCgkJICogKk5PVEUqIFRoaXMgcHJvcGVydHkgaXMgbm93IGRlcHJlY2F0ZWQsIGFuZCBpdCBpcyBzdWdnZXN0ZWQgdGhhdCB5b3UgdXNlCgkJICogbURhdGEgYW5kIC8gb3IgbVJlbmRlciB0byByZW5kZXIgZGF0YSBmb3IgdGhlIERhdGFUYWJsZS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogIEBkZXByZWNhdGVkCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImZuUmVuZGVyIjogZnVuY3Rpb24gKCBvT2JqICkgewoJCSAqICAgICAgICAgICAgICByZXR1cm4gb09iai5hRGF0YVswXSArJyAnKyBvT2JqLmFEYXRhWzNdOwoJCSAqICAgICAgICAgICAgfSwKCQkgKiAgICAgICAgICAgICJiVXNlUmVuZGVyZWQiOiBmYWxzZSwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UKCQkgKiAgICAgICAgICB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJWaXNpYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJWaXNpYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlZpc2libGUiOiB0cnVlLAoJCQoJCQoJCS8qKgoJCSAqIERldmVsb3BlciBkZWZpbmFibGUgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbmV2ZXIgYSBjZWxsIGlzIGNyZWF0ZWQgKEFqYXggc291cmNlLAoJCSAqIGV0Yykgb3IgcHJvY2Vzc2VkIGZvciBpbnB1dCAoRE9NIHNvdXJjZSkuIFRoaXMgY2FuIGJlIHVzZWQgYXMgYSBjb21wbGltZW50IHRvIGZuUmVuZGVyCgkJICogYWxsb3dpbmcgeW91IHRvIG1vZGlmeSB0aGUgRE9NIGVsZW1lbnQgKGFkZCBiYWNrZ3JvdW5kIGNvbG91ciBmb3IgZXhhbXBsZSkgd2hlbiB0aGUKCQkgKiBlbGVtZW50IGlzIGF2YWlsYWJsZSAoc2luY2UgaXQgaXMgbm90IHdoZW4gZm5SZW5kZXIgaXMgY2FsbGVkKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtlbGVtZW50fSBuVGQgVGhlIFREIG5vZGUgdGhhdCBoYXMgYmVlbiBjcmVhdGVkCgkJICogIEBwYXJhbSB7Kn0gc0RhdGEgVGhlIERhdGEgZm9yIHRoZSBjZWxsCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBmb3IgdGhlIHdob2xlIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBUaGUgcm93IGluZGV4IGZvciB0aGUgYW9EYXRhIGRhdGEgc3RvcmUKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgVGhlIGNvbHVtbiBpbmRleCBmb3IgYW9Db2x1bW5zCgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFszXSwKCQkgKiAgICAgICAgICAiZm5DcmVhdGVkQ2VsbCI6IGZ1bmN0aW9uIChuVGQsIHNEYXRhLCBvRGF0YSwgaVJvdywgaUNvbCkgewoJCSAqICAgICAgICAgICAgaWYgKCBzRGF0YSA9PSAiMS43IiApIHsKCQkgKiAgICAgICAgICAgICAgJChuVGQpLmNzcygnY29sb3InLCAnYmx1ZScpCgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9IF0KCQkgKiAgICAgIH0pOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCBpbgoJCSAqIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBPYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhUm93IFRoZSByb3cgaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhQ29sdW1uIFRoZSBjb2x1bW4gaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gIG8uYURhdGEgVGhlIGRhdGEgZm9yIHRoZSByb3cgaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8ub1NldHRpbmdzIFRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgRGF0YVRhYmxlcyBpbnN0YW5jZQoJCSAqICBAcGFyYW0ge29iamVjdH0gby5tRGF0YVByb3AgVGhlIGRhdGEgcHJvcGVydHkgdXNlZCBmb3IgdGhpcyBjb2x1bW4KCQkgKiAgQHBhcmFtIHsqfSAgICAgIHZhbCBUaGUgY3VycmVudCBjZWxsIHZhbHVlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggbywgdmFsICkgewoJCSAqICAgICAgICAgICAgICByZXR1cm4gby5hRGF0YVswXSArJyAnKyBvLmFEYXRhWzNdOwoJCSAqICAgICAgICAgICAgfSwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImZuUmVuZGVyIjogZnVuY3Rpb24gKCBvLCB2YWwgKSB7CgkJICogICAgICAgICAgICByZXR1cm4gby5hRGF0YVswXSArJyAnKyBvLmFEYXRhWzNdOwoJCSAqICAgICAgICAgIH0gfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUmVuZGVyIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhlIGNvbHVtbiBpbmRleCAoc3RhcnRpbmcgZnJvbSAwISkgdGhhdCB5b3Ugd2lzaCBhIHNvcnQgdG8gYmUgcGVyZm9ybWVkCgkJICogdXBvbiB3aGVuIHRoaXMgY29sdW1uIGlzIHNlbGVjdGVkIGZvciBzb3J0aW5nLiBUaGlzIGNhbiBiZSB1c2VkIGZvciBzb3J0aW5nCgkJICogb24gaGlkZGVuIGNvbHVtbnMgZm9yIGV4YW1wbGUuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAtMSA8aT5Vc2UgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGNvbHVtbiBpbmRleDwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiaURhdGFTb3J0IjogMSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiaURhdGFTb3J0IjogLTEsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGhhcyBiZWVuIHJlcGxhY2VkIGJ5IG1EYXRhIGluIERhdGFUYWJsZXMgdG8gZW5zdXJlIG5hbWluZwoJCSAqIGNvbnNpc3RlbmN5LiBtRGF0YVByb3AgY2FuIHN0aWxsIGJlIHVzZWQsIGFzIHRoZXJlIGlzIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CgkJICogaW4gRGF0YVRhYmxlcyBmb3IgdGhpcyBvcHRpb24sIGJ1dCBpdCBpcyBzdHJvbmdseSByZWNvbW1lbmRlZCB0aGF0IHlvdSB1c2UKCQkgKiBtRGF0YSBpbiBwcmVmZXJlbmNlIHRvIG1EYXRhUHJvcC4KCQkgKiAgQG5hbWUgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnMubURhdGFQcm9wCgkJICovCgkKCQoJCS8qKgoJCSAqIFRoaXMgcHJvcGVydHkgY2FuIGJlIHVzZWQgdG8gcmVhZCBkYXRhIGZyb20gYW55IEpTT04gZGF0YSBzb3VyY2UgcHJvcGVydHksCgkJICogaW5jbHVkaW5nIGRlZXBseSBuZXN0ZWQgb2JqZWN0cyAvIHByb3BlcnRpZXMuIG1EYXRhIGNhbiBiZSBnaXZlbiBpbiBhCgkJICogbnVtYmVyIG9mIGRpZmZlcmVudCB3YXlzIHdoaWNoIGVmZmVjdCBpdHMgYmVoYXZpb3VyOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+aW50ZWdlciAtIHRyZWF0ZWQgYXMgYW4gYXJyYXkgaW5kZXggZm9yIHRoZSBkYXRhIHNvdXJjZS4gVGhpcyBpcyB0aGUKCQkgKiAgICAgICBkZWZhdWx0IHRoYXQgRGF0YVRhYmxlcyB1c2VzIChpbmNyZW1lbnRhbGx5IGluY3JlYXNlZCBmb3IgZWFjaCBjb2x1bW4pLjwvbGk+CgkJICogICAgIDxsaT5zdHJpbmcgLSByZWFkIGFuIG9iamVjdCBwcm9wZXJ0eSBmcm9tIHRoZSBkYXRhIHNvdXJjZS4gTm90ZSB0aGF0IHlvdSBjYW4KCQkgKiAgICAgICB1c2UgSmF2YXNjcmlwdCBkb3R0ZWQgbm90YXRpb24gdG8gcmVhZCBkZWVwIHByb3BlcnRpZXMgLyBhcnJheXMgZnJvbSB0aGUKCQkgKiAgICAgICBkYXRhIHNvdXJjZS48L2xpPgoJCSAqICAgICA8bGk+bnVsbCAtIHRoZSBzRGVmYXVsdENvbnRlbnQgb3B0aW9uIHdpbGwgYmUgdXNlZCBmb3IgdGhlIGNlbGwgKG51bGwKCQkgKiAgICAgICBieSBkZWZhdWx0LCBzbyB5b3Ugd2lsbCBuZWVkIHRvIHNwZWNpZnkgdGhlIGRlZmF1bHQgY29udGVudCB5b3Ugd2FudCAtCgkJICogICAgICAgdHlwaWNhbGx5IGFuIGVtcHR5IHN0cmluZykuIFRoaXMgY2FuIGJlIHVzZWZ1bCBvbiBnZW5lcmF0ZWQgY29sdW1ucyBzdWNoIAoJCSAqICAgICAgIGFzIGVkaXQgLyBkZWxldGUgYWN0aW9uIGNvbHVtbnMuPC9saT4KCQkgKiAgICAgPGxpPmZ1bmN0aW9uIC0gdGhlIGZ1bmN0aW9uIGdpdmVuIHdpbGwgYmUgZXhlY3V0ZWQgd2hlbmV2ZXIgRGF0YVRhYmxlcyAKCQkgKiAgICAgICBuZWVkcyB0byBzZXQgb3IgZ2V0IHRoZSBkYXRhIGZvciBhIGNlbGwgaW4gdGhlIGNvbHVtbi4gVGhlIGZ1bmN0aW9uIAoJCSAqICAgICAgIHRha2VzIHRocmVlIHBhcmFtZXRlcnM6CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnthcnJheXxvYmplY3R9IFRoZSBkYXRhIHNvdXJjZSBmb3IgdGhlIHJvdzwvbGk+CgkJICogICAgICAgICA8bGk+e3N0cmluZ30gVGhlIHR5cGUgY2FsbCBkYXRhIHJlcXVlc3RlZCAtIHRoaXMgd2lsbCBiZSAnc2V0JyB3aGVuCgkJICogICAgICAgICAgIHNldHRpbmcgZGF0YSBvciAnZmlsdGVyJywgJ2Rpc3BsYXknLCAndHlwZScsICdzb3J0JyBvciB1bmRlZmluZWQgd2hlbiAKCQkgKiAgICAgICAgICAgZ2F0aGVyaW5nIGRhdGEuIE5vdGUgdGhhdCB3aGVuIDxpPnVuZGVmaW5lZDwvaT4gaXMgZ2l2ZW4gZm9yIHRoZSB0eXBlCgkJICogICAgICAgICAgIERhdGFUYWJsZXMgZXhwZWN0cyB0byBnZXQgdGhlIHJhdyBkYXRhIGZvciB0aGUgb2JqZWN0IGJhY2s8L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIHNldCB3aGVuIHRoZSBzZWNvbmQgcGFyYW1ldGVyIGlzICdzZXQnLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgICBUaGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uIGlzIG5vdCByZXF1aXJlZCB3aGVuICdzZXQnIGlzIHRoZSB0eXBlCgkJICogICAgICAgb2YgY2FsbCwgYnV0IG90aGVyd2lzZSB0aGUgcmV0dXJuIGlzIHdoYXQgd2lsbCBiZSB1c2VkIGZvciB0aGUgZGF0YQoJCSAqICAgICAgIHJlcXVlc3RlZC48L2xpPgoJCSAqICAgIDwvdWw+CgkJICoKCQkgKiBOb3RlIHRoYXQgcHJpb3IgdG8gRGF0YVRhYmxlcyAxLjkuMiBtRGF0YSB3YXMgY2FsbGVkIG1EYXRhUHJvcC4gVGhlIG5hbWUgY2hhbmdlCgkJICogcmVmbGVjdHMgdGhlIGZsZXhpYmlsaXR5IG9mIHRoaXMgcHJvcGVydHkgYW5kIGlzIGNvbnNpc3RlbnQgd2l0aCB0aGUgbmFtaW5nIG9mCgkJICogbVJlbmRlci4gSWYgJ21EYXRhUHJvcCcgaXMgZ2l2ZW4sIHRoZW4gaXQgd2lsbCBzdGlsbCBiZSB1c2VkIGJ5IERhdGFUYWJsZXMsIGFzCgkJICogaXQgYXV0b21hdGljYWxseSBtYXBzIHRoZSBvbGQgbmFtZSB0byB0aGUgbmV3IGlmIHJlcXVpcmVkLgoJCSAqICBAdHlwZSBzdHJpbmd8aW50fGZ1bmN0aW9ufG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5Vc2UgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGNvbHVtbiBpbmRleDwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSZWFkIHRhYmxlIGRhdGEgZnJvbSBvYmplY3RzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RlZXAudHh0IiwKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICB7ICJtRGF0YSI6ICJlbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAibURhdGEiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YSI6ICJwbGF0Zm9ybS5pbm5lciIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YSI6ICJwbGF0Zm9ybS5kZXRhaWxzLjAiIH0sCgkJICogICAgICAgICAgeyAibURhdGEiOiAicGxhdGZvcm0uZGV0YWlscy4xIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgbURhdGEgYXMgYSBmdW5jdGlvbiB0byBwcm92aWRlIGRpZmZlcmVudCBpbmZvcm1hdGlvbiBmb3IKCQkgKiAgICAvLyBzb3J0aW5nLCBmaWx0ZXJpbmcgYW5kIGRpc3BsYXkuIEluIHRoaXMgY2FzZSwgY3VycmVuY3kgKHByaWNlKQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0sCgkJICogICAgICAgICAgIm1EYXRhIjogZnVuY3Rpb24gKCBzb3VyY2UsIHR5cGUsIHZhbCApIHsKCQkgKiAgICAgICAgICAgIGlmICh0eXBlID09PSAnc2V0JykgewoJCSAqICAgICAgICAgICAgICBzb3VyY2UucHJpY2UgPSB2YWw7CgkJICogICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBjb21wdXRlZCBkaXNsYXkgYW5kIGZpbHRlciB2YWx1ZXMgZm9yIGVmZmljaWVuY3kKCQkgKiAgICAgICAgICAgICAgc291cmNlLnByaWNlX2Rpc3BsYXkgPSB2YWw9PSIiID8gIiIgOiAiJCIrbnVtYmVyRm9ybWF0KHZhbCk7CgkJICogICAgICAgICAgICAgIHNvdXJjZS5wcmljZV9maWx0ZXIgID0gdmFsPT0iIiA/ICIiIDogIiQiK251bWJlckZvcm1hdCh2YWwpKyIgIit2YWw7CgkJICogICAgICAgICAgICAgIHJldHVybjsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdkaXNwbGF5JykgewoJCSAqICAgICAgICAgICAgICByZXR1cm4gc291cmNlLnByaWNlX2Rpc3BsYXk7CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnZmlsdGVyJykgewoJCSAqICAgICAgICAgICAgICByZXR1cm4gc291cmNlLnByaWNlX2ZpbHRlcjsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgIC8vICdzb3J0JywgJ3R5cGUnIGFuZCB1bmRlZmluZWQgYWxsIGp1c3QgdXNlIHRoZSBpbnRlZ2VyCgkJICogICAgICAgICAgICByZXR1cm4gc291cmNlLnByaWNlOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfSBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJtRGF0YSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcHJvcGVydHkgaXMgdGhlIHJlbmRlcmluZyBwYXJ0bmVyIHRvIG1EYXRhIGFuZCBpdCBpcyBzdWdnZXN0ZWQgdGhhdAoJCSAqIHdoZW4geW91IHdhbnQgdG8gbWFuaXB1bGF0ZSBkYXRhIGZvciBkaXNwbGF5IChpbmNsdWRpbmcgZmlsdGVyaW5nLCBzb3J0aW5nIGV0YykKCQkgKiBidXQgbm90IGFsdGVyaW5nIHRoZSB1bmRlcmx5aW5nIGRhdGEgZm9yIHRoZSB0YWJsZSwgdXNlIHRoaXMgcHJvcGVydHkuIG1EYXRhCgkJICogY2FuIGFjdHVhbGx5IGRvIGV2ZXJ5dGhpbmcgdGhpcyBwcm9wZXJ0eSBjYW4gYW5kIG1vcmUsIGJ1dCB0aGlzIHBhcmFtZXRlciBpcwoJCSAqIGVhc2llciB0byB1c2Ugc2luY2UgdGhlcmUgaXMgbm8gJ3NldCcgb3B0aW9uLiBMaWtlIG1EYXRhIGlzIGNhbiBiZSBnaXZlbgoJCSAqIGluIGEgbnVtYmVyIG9mIGRpZmZlcmVudCB3YXlzIHRvIGVmZmVjdCBpdHMgYmVoYXZpb3VyLCB3aXRoIHRoZSBhZGRpdGlvbiBvZiAKCQkgKiBzdXBwb3J0aW5nIGFycmF5IHN5bnRheCBmb3IgZWFzeSBvdXRwdXR0aW5nIG9mIGFycmF5cyAoaW5jbHVkaW5nIGFycmF5cyBvZgoJCSAqIG9iamVjdHMpOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+aW50ZWdlciAtIHRyZWF0ZWQgYXMgYW4gYXJyYXkgaW5kZXggZm9yIHRoZSBkYXRhIHNvdXJjZS4gVGhpcyBpcyB0aGUKCQkgKiAgICAgICBkZWZhdWx0IHRoYXQgRGF0YVRhYmxlcyB1c2VzIChpbmNyZW1lbnRhbGx5IGluY3JlYXNlZCBmb3IgZWFjaCBjb2x1bW4pLjwvbGk+CgkJICogICAgIDxsaT5zdHJpbmcgLSByZWFkIGFuIG9iamVjdCBwcm9wZXJ0eSBmcm9tIHRoZSBkYXRhIHNvdXJjZS4gTm90ZSB0aGF0IHlvdSBjYW4KCQkgKiAgICAgICB1c2UgSmF2YXNjcmlwdCBkb3R0ZWQgbm90YXRpb24gdG8gcmVhZCBkZWVwIHByb3BlcnRpZXMgLyBhcnJheXMgZnJvbSB0aGUKCQkgKiAgICAgICBkYXRhIHNvdXJjZSBhbmQgYWxzbyBhcnJheSBicmFja2V0cyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBkYXRhIHJlYWRlciBzaG91bGQKCQkgKiAgICAgICBsb29wIG92ZXIgdGhlIGRhdGEgc291cmNlIGFycmF5LiBXaGVuIGNoYXJhY3RlcnMgYXJlIGdpdmVuIGJldHdlZW4gdGhlIGFycmF5CgkJICogICAgICAgYnJhY2tldHMsIHRoZXNlIGNoYXJhY3RlcnMgYXJlIHVzZWQgdG8gam9pbiB0aGUgZGF0YSBzb3VyY2UgYXJyYXkgdG9nZXRoZXIuCgkJICogICAgICAgRm9yIGV4YW1wbGU6ICJhY2NvdW50c1ssIF0ubmFtZSIgd291bGQgcmVzdWx0IGluIGEgY29tbWEgc2VwYXJhdGVkIGxpc3Qgd2l0aAoJCSAqICAgICAgIHRoZSAnbmFtZScgdmFsdWUgZnJvbSB0aGUgJ2FjY291bnRzJyBhcnJheSBvZiBvYmplY3RzLjwvbGk+CgkJICogICAgIDxsaT5mdW5jdGlvbiAtIHRoZSBmdW5jdGlvbiBnaXZlbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW5ldmVyIERhdGFUYWJsZXMgCgkJICogICAgICAgbmVlZHMgdG8gc2V0IG9yIGdldCB0aGUgZGF0YSBmb3IgYSBjZWxsIGluIHRoZSBjb2x1bW4uIFRoZSBmdW5jdGlvbiAKCQkgKiAgICAgICB0YWtlcyB0aHJlZSBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSByb3cgKGJhc2VkIG9uIG1EYXRhKTwvbGk+CgkJICogICAgICAgICA8bGk+e3N0cmluZ30gVGhlIHR5cGUgY2FsbCBkYXRhIHJlcXVlc3RlZCAtIHRoaXMgd2lsbCBiZSAnZmlsdGVyJywgJ2Rpc3BsYXknLCAKCQkgKiAgICAgICAgICAgJ3R5cGUnIG9yICdzb3J0Jy48L2xpPgoJCSAqICAgICAgICAgPGxpPnthcnJheXxvYmplY3R9IFRoZSBmdWxsIGRhdGEgc291cmNlIGZvciB0aGUgcm93IChub3QgYmFzZWQgb24gbURhdGEpPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICAgIFRoZSByZXR1cm4gdmFsdWUgZnJvbSB0aGUgZnVuY3Rpb24gaXMgd2hhdCB3aWxsIGJlIHVzZWQgZm9yIHRoZSBkYXRhCgkJICogICAgICAgcmVxdWVzdGVkLjwvbGk+CgkJICogICAgPC91bD4KCQkgKiAgQHR5cGUgc3RyaW5nfGludHxmdW5jdGlvbnxudWxsCgkJICogIEBkZWZhdWx0IG51bGwgPGk+VXNlIG1EYXRhPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIENyZWF0ZSBhIGNvbW1hIHNlcGFyYXRlZCBsaXN0IGZyb20gYW4gYXJyYXkgb2Ygb2JqZWN0cwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kZWVwLnR4dCIsCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAibURhdGEiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgIm1EYXRhIjogImJyb3dzZXIiIH0sCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgIm1EYXRhIjogInBsYXRmb3JtIiwKCQkgKiAgICAgICAgICAgICJtUmVuZGVyIjogIlssIF0ubmFtZSIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNlIGFzIGEgZnVuY3Rpb24gdG8gY3JlYXRlIGEgbGluayBmcm9tIHRoZSBkYXRhIHNvdXJjZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0sCgkJICogICAgICAgICAgIm1EYXRhIjogImRvd25sb2FkX2xpbmsiLAoJCSAqICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKCBkYXRhLCB0eXBlLCBmdWxsICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInK2RhdGErJyI+RG93bmxvYWQ8L2E+JzsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJIm1SZW5kZXIiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIGNlbGwgdHlwZSBjcmVhdGVkIGZvciB0aGUgY29sdW1uIC0gZWl0aGVyIFREIGNlbGxzIG9yIFRIIGNlbGxzLiBUaGlzCgkJICogY2FuIGJlIHVzZWZ1bCBhcyBUSCBjZWxscyBoYXZlIHNlbWFudGljIG1lYW5pbmcgaW4gdGhlIHRhYmxlIGJvZHksIGFsbG93aW5nIHRoZW0KCQkgKiB0byBhY3QgYXMgYSBoZWFkZXIgZm9yIGEgcm93ICh5b3UgbWF5IHdpc2ggdG8gYWRkIHNjb3BlPSdyb3cnIHRvIHRoZSBUSCBlbGVtZW50cykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCB0ZAoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIE1ha2UgdGhlIGZpcnN0IGNvbHVtbiB1c2UgVEggY2VsbHMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdLAoJCSAqICAgICAgICAgICJzQ2VsbFR5cGUiOiAidGgiCgkJICogICAgICAgIH0gXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0NlbGxUeXBlIjogInRkIiwKCQoJCgkJLyoqCgkJICogQ2xhc3MgdG8gZ2l2ZSB0byBlYWNoIGNlbGwgaW4gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic0NsYXNzIjogIm15X2NsYXNzIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNDbGFzcyI6ICJteV9jbGFzcyIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDbGFzcyI6ICIiLAoJCQoJCS8qKgoJCSAqIFdoZW4gRGF0YVRhYmxlcyBjYWxjdWxhdGVzIHRoZSBjb2x1bW4gd2lkdGhzIHRvIGFzc2lnbiB0byBlYWNoIGNvbHVtbiwKCQkgKiBpdCBmaW5kcyB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gZWFjaCBjb2x1bW4gYW5kIHRoZW4gY29uc3RydWN0cyBhCgkJICogdGVtcG9yYXJ5IHRhYmxlIGFuZCByZWFkcyB0aGUgd2lkdGhzIGZyb20gdGhhdC4gVGhlIHByb2JsZW0gd2l0aCB0aGlzCgkJICogaXMgdGhhdCAibW1tIiBpcyBtdWNoIHdpZGVyIHRoZW4gImlpaWkiLCBidXQgdGhlIGxhdHRlciBpcyBhIGxvbmdlciAKCQkgKiBzdHJpbmcgLSB0aHVzIHRoZSBjYWxjdWxhdGlvbiBjYW4gZ28gd3JvbmcgKGRvaW5nIGl0IHByb3Blcmx5IGFuZCBwdXR0aW5nCgkJICogaXQgaW50byBhbiBET00gb2JqZWN0IGFuZCBtZWFzdXJpbmcgdGhhdCBpcyBob3JyaWJseSghKSBzbG93KS4gVGh1cyBhcwoJCSAqIGEgIndvcmsgYXJvdW5kIiB3ZSBwcm92aWRlIHRoaXMgb3B0aW9uLiBJdCB3aWxsIGFwcGVuZCBpdHMgdmFsdWUgdG8gdGhlCgkJICogdGV4dCB0aGF0IGlzIGZvdW5kIHRvIGJlIHRoZSBsb25nZXN0IHN0cmluZyBmb3IgdGhlIGNvbHVtbiAtIGkuZS4gcGFkZGluZy4KCQkgKiBHZW5lcmFsbHkgeW91IHNob3VsZG4ndCBuZWVkIHRoaXMsIGFuZCBpdCBpcyBub3QgZG9jdW1lbnRlZCBvbiB0aGUgCgkJICogZ2VuZXJhbCBEYXRhVGFibGVzLm5ldCBkb2N1bWVudGF0aW9uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8aT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAic0NvbnRlbnRQYWRkaW5nIjogIm1tbSIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb250ZW50UGFkZGluZyI6ICIiLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgYSBkZWZhdWx0IHZhbHVlIHRvIGJlIGdpdmVuIGZvciBhIGNvbHVtbidzIGRhdGEsIGFuZCB3aWxsIGJlIHVzZWQKCQkgKiB3aGVuZXZlciBhIG51bGwgZGF0YSBzb3VyY2UgaXMgZW5jb3VudGVyZWQgKHRoaXMgY2FuIGJlIGJlY2F1c2UgbURhdGEKCQkgKiBpcyBzZXQgdG8gbnVsbCwgb3IgYmVjYXVzZSB0aGUgZGF0YSBzb3VyY2UgaXRzZWxmIGlzIG51bGwpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YSI6IG51bGwsCgkJICogICAgICAgICAgICAic0RlZmF1bHRDb250ZW50IjogIkVkaXQiLAoJCSAqICAgICAgICAgICAgImFUYXJnZXRzIjogWyAtMSBdCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YSI6IG51bGwsCgkJICogICAgICAgICAgICAic0RlZmF1bHRDb250ZW50IjogIkVkaXQiCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzRGVmYXVsdENvbnRlbnQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBpcyBvbmx5IHVzZWQgaW4gRGF0YVRhYmxlcycgc2VydmVyLXNpZGUgcHJvY2Vzc2luZy4gSXQgY2FuCgkJICogYmUgZXhjZXB0aW9uYWxseSB1c2VmdWwgdG8ga25vdyB3aGF0IGNvbHVtbnMgYXJlIGJlaW5nIGRpc3BsYXllZCBvbiB0aGUKCQkgKiBjbGllbnQgc2lkZSwgYW5kIHRvIG1hcCB0aGVzZSB0byBkYXRhYmFzZSBmaWVsZHMuIFdoZW4gZGVmaW5lZCwgdGhlIG5hbWVzCgkJICogYWxzbyBhbGxvdyBEYXRhVGFibGVzIHRvIHJlb3JkZXIgaW5mb3JtYXRpb24gZnJvbSB0aGUgc2VydmVyIGlmIGl0IGNvbWVzCgkJICogYmFjayBpbiBhbiB1bmV4cGVjdGVkIG9yZGVyIChpLmUuIGlmIHlvdSBzd2l0Y2ggeW91ciBjb2x1bW5zIGFyb3VuZCBvbiB0aGUKCQkgKiBjbGllbnQtc2lkZSwgeW91ciBzZXJ2ZXItc2lkZSBjb2RlIGRvZXMgbm90IGFsc28gbmVlZCB1cGRhdGluZykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZW5naW5lIiwgImFUYXJnZXRzIjogWyAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJicm93c2VyIiwgImFUYXJnZXRzIjogWyAxIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIsICJhVGFyZ2V0cyI6IFsgMiBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAidmVyc2lvbiIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZ3JhZGUiLCAiYVRhcmdldHMiOiBbIDQgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAicGxhdGZvcm0iIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAidmVyc2lvbiIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJncmFkZSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzTmFtZSI6ICIiLAoJCgkKCQkvKioKCQkgKiBEZWZpbmVzIGEgZGF0YSBzb3VyY2UgdHlwZSBmb3IgdGhlIHNvcnRpbmcgd2hpY2ggY2FuIGJlIHVzZWQgdG8gcmVhZAoJCSAqIHJlYWwtdGltZSBpbmZvcm1hdGlvbiBmcm9tIHRoZSB0YWJsZSAodXBkYXRpbmcgdGhlIGludGVybmFsbHkgY2FjaGVkCgkJICogdmVyc2lvbikgcHJpb3IgdG8gc29ydGluZy4gVGhpcyBhbGxvd3Mgc29ydGluZyB0byBvY2N1ciBvbiB1c2VyIGVkaXRhYmxlCgkJICogZWxlbWVudHMgc3VjaCBhcyBmb3JtIGlucHV0cy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IHN0ZAoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJhVGFyZ2V0cyI6IFsgMiwgMyBdIH0sCgkJICogICAgICAgICAgeyAic1R5cGUiOiAibnVtZXJpYyIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tc2VsZWN0IiwgImFUYXJnZXRzIjogWyA0IF0gfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIsICJhVGFyZ2V0cyI6IFsgNSBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS10ZXh0IiB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXRleHQiLCAic1R5cGUiOiAibnVtZXJpYyIgfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1zZWxlY3QiIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tY2hlY2tib3giIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1NvcnREYXRhVHlwZSI6ICJzdGQiLAoJCgkKCQkvKioKCQkgKiBUaGUgdGl0bGUgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsIDxpPkRlcml2ZWQgZnJvbSB0aGUgJ1RIJyB2YWx1ZSBmb3IgdGhpcyBjb2x1bW4gaW4gdGhlIAoJCSAqICAgIG9yaWdpbmFsIEhUTUwgdGFibGUuPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJNeSBjb2x1bW4gdGl0bGUiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIk15IGNvbHVtbiB0aXRsZSIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSB0eXBlIGFsbG93cyB5b3UgdG8gc3BlY2lmeSBob3cgdGhlIGRhdGEgZm9yIHRoaXMgY29sdW1uIHdpbGwgYmUgc29ydGVkLgoJCSAqIEZvdXIgdHlwZXMgKHN0cmluZywgbnVtZXJpYywgZGF0ZSBhbmQgaHRtbCAod2hpY2ggd2lsbCBzdHJpcCBIVE1MIHRhZ3MKCQkgKiBiZWZvcmUgc29ydGluZykpIGFyZSBjdXJyZW50bHkgYXZhaWxhYmxlLiBOb3RlIHRoYXQgb25seSBkYXRlIGZvcm1hdHMKCQkgKiB1bmRlcnN0b29kIGJ5IEphdmFzY3JpcHQncyBEYXRlKCkgb2JqZWN0IHdpbGwgYmUgYWNjZXB0ZWQgYXMgdHlwZSBkYXRlLiBGb3IKCQkgKiBleGFtcGxlOiAiTWFyIDI2LCAyMDA4IDU6MDMgUE0iLiBNYXkgdGFrZSB0aGUgdmFsdWVzOiAnc3RyaW5nJywgJ251bWVyaWMnLAoJCSAqICdkYXRlJyBvciAnaHRtbCcgKGJ5IGRlZmF1bHQpLiBGdXJ0aGVyIHR5cGVzIGNhbiBiZSBhZGRpbmcgdGhyb3VnaAoJCSAqIHBsdWctaW5zLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5BdXRvLWRldGVjdGVkIGZyb20gcmF3IGRhdGE8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic1R5cGUiOiAiaHRtbCIsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzVHlwZSI6ICJodG1sIiB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1R5cGUiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBEZWZpbmluZyB0aGUgd2lkdGggb2YgdGhlIGNvbHVtbiwgdGhpcyBwYXJhbWV0ZXIgbWF5IHRha2UgYW55IENTUyB2YWx1ZQoJCSAqICgzZW0sIDIwcHggZXRjKS4gRGF0YVRhYmxlcyBhcHBsZXMgJ3NtYXJ0JyB3aWR0aHMgdG8gY29sdW1ucyB3aGljaCBoYXZlIG5vdAoJCSAqIGJlZW4gZ2l2ZW4gYSBzcGVjaWZpYyB3aWR0aCB0aHJvdWdoIHRoaXMgaW50ZXJmYWNlIGVuc3VyaW5nIHRoYXQgdGhlIHRhYmxlCgkJICogcmVtYWlucyByZWFkYWJsZS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwgPGk+QXV0b21hdGljPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNXaWR0aCI6ICIyMCUiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1dpZHRoIjogIjIwJSIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNXaWR0aCI6IG51bGwKCX07CgkKCQoJCgkvKioKCSAqIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IC0gdGhpcyBob2xkcyBhbGwgdGhlIGluZm9ybWF0aW9uIG5lZWRlZCBmb3IgYQoJICogZ2l2ZW4gdGFibGUsIGluY2x1ZGluZyBjb25maWd1cmF0aW9uLCBkYXRhIGFuZCBjdXJyZW50IGFwcGxpY2F0aW9uIG9mIHRoZQoJICogdGFibGUgb3B0aW9ucy4gRGF0YVRhYmxlcyBkb2VzIG5vdCBoYXZlIGEgc2luZ2xlIGluc3RhbmNlIGZvciBlYWNoIERhdGFUYWJsZQoJICogd2l0aCB0aGUgc2V0dGluZ3MgYXR0YWNoZWQgdG8gdGhhdCBpbnN0YW5jZSwgYnV0IHJhdGhlciBpbnN0YW5jZXMgb2YgdGhlCgkgKiBEYXRhVGFibGUgImNsYXNzIiBhcmUgY3JlYXRlZCBvbi10aGUtZmx5IGFzIG5lZWRlZCAodHlwaWNhbGx5IGJ5IGEgCgkgKiAkKCkuZGF0YVRhYmxlKCkgY2FsbCkgYW5kIHRoZSBzZXR0aW5ncyBvYmplY3QgaXMgdGhlbiBhcHBsaWVkIHRvIHRoYXQKCSAqIGluc3RhbmNlLgoJICogCgkgKiBOb3RlIHRoYXQgdGhpcyBvYmplY3QgaXMgcmVsYXRlZCB0byB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfSBidXQgdGhpcyAKCSAqIG9uZSBpcyB0aGUgaW50ZXJuYWwgZGF0YSBzdG9yZSBmb3IgRGF0YVRhYmxlcydzIGNhY2hlIG9mIGNvbHVtbnMuIEl0IHNob3VsZAoJICogTk9UIGJlIG1hbmlwdWxhdGVkIG91dHNpZGUgb2YgRGF0YVRhYmxlcy4gQW55IGNvbmZpZ3VyYXRpb24gc2hvdWxkIGJlIGRvbmUKCSAqIHRocm91Z2ggdGhlIGluaXRpYWxpc2F0aW9uIG9wdGlvbnMuCgkgKiAgQG5hbWVzcGFjZQoJICogIEB0b2RvIFJlYWxseSBzaG91bGQgYXR0YWNoIHRoZSBzZXR0aW5ncyBvYmplY3QgdG8gaW5kaXZpZHVhbCBpbnN0YW5jZXMgc28gd2UKCSAqICAgIGRvbid0IG5lZWQgdG8gY3JlYXRlIG5ldyBpbnN0YW5jZXMgb24gZWFjaCAkKCkuZGF0YVRhYmxlKCkgY2FsbCAoaWYgdGhlCgkgKiAgICB0YWJsZSBhbHJlYWR5IGV4aXN0cykuIEl0IHdvdWxkIGFsc28gc2F2ZSBwYXNzaW5nIG9TZXR0aW5ncyBhcm91bmQgYW5kCgkgKiAgICBpbnRvIGV2ZXJ5IHNpbmdsZSBmdW5jdGlvbi4gSG93ZXZlciwgdGhpcyBpcyBhIHZlcnkgc2lnbmlmaWNhbnQgCgkgKiAgICBhcmNoaXRlY3R1cmUgY2hhbmdlIGZvciBEYXRhVGFibGVzIGFuZCB3aWxsIGFsbW9zdCBjZXJ0YWlubHkgYnJlYWsKCSAqICAgIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHdpdGggb2xkZXIgaW5zdGFsbGF0aW9ucy4gVGhpcyBpcyBzb21ldGhpbmcgdGhhdAoJICogICAgd2lsbCBiZSBkb25lIGluIDIuMC4KCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MgPSB7CgkJLyoqCgkJICogUHJpbWFyeSBmZWF0dXJlcyBvZiBEYXRhVGFibGVzIGFuZCB0aGVpciBlbmFibGVtZW50IHN0YXRlLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJIm9GZWF0dXJlcyI6IHsKCQkJCgkJCS8qKgoJCQkgKiBGbGFnIHRvIHNheSBpZiBEYXRhVGFibGVzIHNob3VsZCBhdXRvbWF0aWNhbGx5IHRyeSB0byBjYWxjdWxhdGUgdGhlCgkJCSAqIG9wdGltdW0gdGFibGUgYW5kIGNvbHVtbnMgd2lkdGhzICh0cnVlKSBvciBub3QgKGZhbHNlKS4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiQXV0b1dpZHRoIjogbnVsbCwKCQoJCQkvKioKCQkJICogRGVsYXkgdGhlIGNyZWF0aW9uIG9mIFRSIGFuZCBURCBlbGVtZW50cyB1bnRpbCB0aGV5IGFyZSBhY3R1YWxseQoJCQkgKiBuZWVkZWQgYnkgYSBkcml2ZW4gcGFnZSBkcmF3LiBUaGlzIGNhbiBnaXZlIGEgc2lnbmlmaWNhbnQgc3BlZWQKCQkJICogaW5jcmVhc2UgZm9yIEFqYXggc291cmNlIGFuZCBKYXZhc2NyaXB0IHNvdXJjZSBkYXRhLCBidXQgbWFrZXMgbm8KCQkJICogZGlmZmVyZW5jZSBhdCBhbGwgZnJvIERPTSBhbmQgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyB0YWJsZXMuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkRlZmVyUmVuZGVyIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBFbmFibGUgZmlsdGVyaW5nIG9uIHRoZSB0YWJsZSBvciBub3QuIE5vdGUgdGhhdCBpZiB0aGlzIGlzIGRpc2FibGVkCgkJCSAqIHRoZW4gdGhlcmUgaXMgbm8gZmlsdGVyaW5nIGF0IGFsbCBvbiB0aGUgdGFibGUsIGluY2x1ZGluZyBmbkZpbHRlci4KCQkJICogVG8ganVzdCByZW1vdmUgdGhlIGZpbHRlcmluZyBpbnB1dCB1c2Ugc0RvbSBhbmQgcmVtb3ZlIHRoZSAnZicgb3B0aW9uLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJGaWx0ZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFRhYmxlIGluZm9ybWF0aW9uIGVsZW1lbnQgKHRoZSAnU2hvd2luZyB4IG9mIHkgcmVjb3JkcycgZGl2KSBlbmFibGUKCQkJICogZmxhZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiSW5mbyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogUHJlc2VudCBhIHVzZXIgY29udHJvbCBhbGxvd2luZyB0aGUgZW5kIHVzZXIgdG8gY2hhbmdlIHRoZSBwYWdlIHNpemUKCQkJICogd2hlbiBwYWdpbmF0aW9uIGlzIGVuYWJsZWQuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkxlbmd0aENoYW5nZSI6IG51bGwsCgkKCQkJLyoqCgkJCSAqIFBhZ2luYXRpb24gZW5hYmxlZCBvciBub3QuIE5vdGUgdGhhdCBpZiB0aGlzIGlzIGRpc2FibGVkIHRoZW4gbGVuZ3RoCgkJCSAqIGNoYW5naW5nIG11c3QgYWxzbyBiZSBkaXNhYmxlZC4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiUGFnaW5hdGUiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFByb2Nlc3NpbmcgaW5kaWNhdG9yIGVuYWJsZSBmbGFnIHdoZW5ldmVyIERhdGFUYWJsZXMgaXMgZW5hY3RpbmcgYQoJCQkgKiB1c2VyIHJlcXVlc3QgLSB0eXBpY2FsbHkgYW4gQWpheCByZXF1ZXN0IGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJQcm9jZXNzaW5nIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIGVuYWJsZWQgZmxhZyAtIHdoZW4gZW5hYmxlZCBEYXRhVGFibGVzIHdpbGwKCQkJICogZ2V0IGFsbCBkYXRhIGZyb20gdGhlIHNlcnZlciBmb3IgZXZlcnkgZHJhdyAtIHRoZXJlIGlzIG5vIGZpbHRlcmluZywKCQkJICogc29ydGluZyBvciBwYWdpbmcgZG9uZSBvbiB0aGUgY2xpZW50LXNpZGUuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlNlcnZlclNpZGUiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFNvcnRpbmcgZW5hYmxlbWVudCBmbGFnLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJTb3J0IjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBBcHBseSBhIGNsYXNzIHRvIHRoZSBjb2x1bW5zIHdoaWNoIGFyZSBiZWluZyBzb3J0ZWQgdG8gcHJvdmlkZSBhCgkJCSAqIHZpc3VhbCBoaWdobGlnaHQgb3Igbm90LiBUaGlzIGNhbiBzbG93IHRoaW5ncyBkb3duIHdoZW4gZW5hYmxlZCBzaW5jZQoJCQkgKiB0aGVyZSBpcyBhIGxvdCBvZiBET00gaW50ZXJhY3Rpb24uCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlNvcnRDbGFzc2VzIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBTdGF0ZSBzYXZpbmcgZW5hYmxlbWVudCBmbGFnLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJTdGF0ZVNhdmUiOiBudWxsCgkJfSwKCQkKCQoJCS8qKgoJCSAqIFNjcm9sbGluZyBzZXR0aW5ncyBmb3IgYSB0YWJsZS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvU2Nyb2xsIjogewoJCQkvKioKCQkJICogSW5kaWNhdGUgaWYgRGF0YVRhYmxlcyBzaG91bGQgYmUgYWxsb3dlZCB0byBzZXQgdGhlIHBhZGRpbmcgLyBtYXJnaW4KCQkJICogZXRjIGZvciB0aGUgc2Nyb2xsaW5nIGhlYWRlciBlbGVtZW50cyBvciBub3QuIFR5cGljYWxseSB5b3Ugd2lsbCB3YW50CgkJCSAqIHRoaXMuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkF1dG9Dc3MiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFdoZW4gdGhlIHRhYmxlIGlzIHNob3J0ZXIgaW4gaGVpZ2h0IHRoYW4gc1Njcm9sbFksIGNvbGxhcHNlIHRoZQoJCQkgKiB0YWJsZSBjb250YWluZXIgZG93biB0byB0aGUgaGVpZ2h0IG9mIHRoZSB0YWJsZSAod2hlbiB0cnVlKS4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiQ29sbGFwc2UiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEluZmluaXRlIHNjcm9sbGluZyBlbmFibGVtZW50IGZsYWcuIE5vdyBkZXByZWNhdGVkIGluIGZhdm91ciBvZgoJCQkgKiB1c2luZyB0aGUgU2Nyb2xsZXIgcGx1Zy1pbi4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiSW5maW5pdGUiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFdpZHRoIG9mIHRoZSBzY3JvbGxiYXIgZm9yIHRoZSB3ZWItYnJvd3NlcidzIHBsYXRmb3JtLiBDYWxjdWxhdGVkCgkJCSAqIGR1cmluZyB0YWJsZSBpbml0aWFsaXNhdGlvbi4KCQkJICogIEB0eXBlIGludAoJCQkgKiAgQGRlZmF1bHQgMAoJCQkgKi8KCQkJImlCYXJXaWR0aCI6IDAsCgkJCQoJCQkvKioKCQkJICogU3BhY2UgKGluIHBpeGVscykgYmV0d2VlbiB0aGUgYm90dG9tIG9mIHRoZSBzY3JvbGxpbmcgY29udGFpbmVyIGFuZCAKCQkJICogdGhlIGJvdHRvbSBvZiB0aGUgc2Nyb2xsaW5nIHZpZXdwb3J0IGJlZm9yZSB0aGUgbmV4dCBwYWdlIGlzIGxvYWRlZAoJCQkgKiB3aGVuIHVzaW5nIGluZmluaXRlIHNjcm9sbGluZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGludAoJCQkgKi8KCQkJImlMb2FkR2FwIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBWaWV3cG9ydCB3aWR0aCBmb3IgaG9yaXpvbnRhbCBzY3JvbGxpbmcuIEhvcml6b250YWwgc2Nyb2xsaW5nIGlzIAoJCQkgKiBkaXNhYmxlZCBpZiBhbiBlbXB0eSBzdHJpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICovCgkJCSJzWCI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2lkdGggdG8gZXhwYW5kIHRoZSB0YWJsZSB0byB3aGVuIHVzaW5nIHgtc2Nyb2xsaW5nLiBUeXBpY2FsbHkgeW91CgkJCSAqIHNob3VsZCBub3QgbmVlZCB0byB1c2UgdGhpcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlcHJlY2F0ZWQKCQkJICovCgkJCSJzWElubmVyIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBWaWV3cG9ydCBoZWlnaHQgZm9yIHZlcnRpY2FsIHNjcm9sbGluZy4gVmVydGljYWwgc2Nyb2xsaW5nIGlzIGRpc2FibGVkCgkJCSAqIGlmIGFuIGVtcHR5IHN0cmluZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKi8KCQkJInNZIjogbnVsbAoJCX0sCgkJCgkJLyoqCgkJICogTGFuZ3VhZ2UgaW5mb3JtYXRpb24gZm9yIHRoZSB0YWJsZS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAZXh0ZW5kcyBEYXRhVGFibGUuZGVmYXVsdHMub0xhbmd1YWdlCgkJICovCgkJIm9MYW5ndWFnZSI6IHsKCQkJLyoqCgkJCSAqIEluZm9ybWF0aW9uIGNhbGxiYWNrIGZ1bmN0aW9uLiBTZWUgCgkJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuZm5JbmZvQ2FsbGJhY2t9CgkJCSAqICBAdHlwZSBmdW5jdGlvbgoJCQkgKiAgQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJImZuSW5mb0NhbGxiYWNrIjogbnVsbAoJCX0sCgkJCgkJLyoqCgkJICogQnJvd3NlciBzdXBwb3J0IHBhcmFtZXRlcnMKCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvQnJvd3NlciI6IHsKCQkJLyoqCgkJCSAqIEluZGljYXRlIGlmIHRoZSBicm93c2VyIGluY29ycmVjdGx5IGNhbGN1bGF0ZXMgd2lkdGg6MTAwJSBpbnNpZGUgYQoJCQkgKiBzY3JvbGxpbmcgZWxlbWVudCAoSUU2LzcpCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqICBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJImJTY3JvbGxPdmVyc2l6ZSI6IGZhbHNlCgkJfSwKCQkKCQkvKioKCQkgKiBBcnJheSByZWZlcmVuY2luZyB0aGUgbm9kZXMgd2hpY2ggYXJlIHVzZWQgZm9yIHRoZSBmZWF0dXJlcy4gVGhlIAoJCSAqIHBhcmFtZXRlcnMgb2YgdGhpcyBvYmplY3QgbWF0Y2ggd2hhdCBpcyBhbGxvd2VkIGJ5IHNEb20gLSBpLmUuCgkJICogICA8dWw+CgkJICogICAgIDxsaT4nbCcgLSBMZW5ndGggY2hhbmdpbmc8L2xpPgoJCSAqICAgICA8bGk+J2YnIC0gRmlsdGVyaW5nIGlucHV0PC9saT4KCQkgKiAgICAgPGxpPid0JyAtIFRoZSB0YWJsZSE8L2xpPgoJCSAqICAgICA8bGk+J2knIC0gSW5mb3JtYXRpb248L2xpPgoJCSAqICAgICA8bGk+J3AnIC0gUGFnaW5hdGlvbjwvbGk+CgkJICogICAgIDxsaT4ncicgLSBwUm9jZXNzaW5nPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFhbkZlYXR1cmVzIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgZGF0YSBpbmZvcm1hdGlvbiAtIHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vUm93fSBmb3IgZGV0YWlsZWQKCQkgKiBpbmZvcm1hdGlvbi4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9EYXRhIjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgaW5kZXhlcyB3aGljaCBhcmUgaW4gdGhlIGN1cnJlbnQgZGlzcGxheSAoYWZ0ZXIgZmlsdGVyaW5nIGV0YykKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYWlEaXNwbGF5IjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgaW5kZXhlcyBmb3IgZGlzcGxheSAtIG5vIGZpbHRlcmluZwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhaURpc3BsYXlNYXN0ZXIiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBpbmZvcm1hdGlvbiBhYm91dCBlYWNoIGNvbHVtbiB0aGF0IGlzIGluIHVzZQoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0NvbHVtbnMiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGFibGUncyBoZWFkZXIKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9IZWFkZXIiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGFibGUncyBmb290ZXIKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Gb290ZXIiOiBbXSwKCQkKCQkvKioKCQkgKiBTZWFyY2ggZGF0YSBhcnJheSBmb3IgcmVndWxhciBleHByZXNzaW9uIHNlYXJjaGluZwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc0RhdGFTZWFyY2giOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSB0aGUgYXBwbGllZCBnbG9iYWwgc2VhcmNoIGluZm9ybWF0aW9uIGluIGNhc2Ugd2Ugd2FudCB0byBmb3JjZSBhIAoJCSAqIHJlc2VhcmNoIG9yIGNvbXBhcmUgdGhlIG9sZCBzZWFyY2ggdG8gYSBuZXcgb25lLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAZXh0ZW5kcyBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2gKCQkgKi8KCQkib1ByZXZpb3VzU2VhcmNoIjoge30sCgkJCgkJLyoqCgkJICogU3RvcmUgdGhlIGFwcGxpZWQgc2VhcmNoIGZvciBlYWNoIGNvbHVtbiAtIHNlZSAKCQkgKiB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNofSBmb3IgdGhlIGZvcm1hdCB0aGF0IGlzIHVzZWQgZm9yIHRoZQoJCSAqIGZpbHRlcmluZyBpbmZvcm1hdGlvbiBmb3IgZWFjaCBjb2x1bW4uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUHJlU2VhcmNoQ29scyI6IFtdLAoJCQoJCS8qKgoJCSAqIFNvcnRpbmcgdGhhdCBpcyBhcHBsaWVkIHRvIHRoZSB0YWJsZS4gTm90ZSB0aGF0IHRoZSBpbm5lciBhcnJheXMgYXJlCgkJICogdXNlZCBpbiB0aGUgZm9sbG93aW5nIG1hbm5lcjoKCQkgKiA8dWw+CgkJICogICA8bGk+SW5kZXggMCAtIGNvbHVtbiBudW1iZXI8L2xpPgoJCSAqICAgPGxpPkluZGV4IDEgLSBjdXJyZW50IHNvcnRpbmcgZGlyZWN0aW9uPC9saT4KCQkgKiAgIDxsaT5JbmRleCAyIC0gaW5kZXggb2YgYXNTb3J0aW5nIGZvciB0aGlzIGNvbHVtbjwvbGk+CgkJICogPC91bD4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEB0b2RvIFRoZXNlIGlubmVyIGFycmF5cyBzaG91bGQgcmVhbGx5IGJlIG9iamVjdHMKCQkgKi8KCQkiYWFTb3J0aW5nIjogbnVsbCwKCQkKCQkvKioKCQkgKiBTb3J0aW5nIHRoYXQgaXMgYWx3YXlzIGFwcGxpZWQgdG8gdGhlIHRhYmxlIChpLmUuIHByZWZpeGVkIGluIGZyb250IG9mCgkJICogYWFTb3J0aW5nKS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5fG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJhYVNvcnRpbmdGaXhlZCI6IG51bGwsCgkJCgkJLyoqCgkJICogQ2xhc3NlcyB0byB1c2UgZm9yIHRoZSBzdHJpcGluZyBvZiBhIHRhYmxlLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYXNTdHJpcGVDbGFzc2VzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBJZiByZXN0b3JpbmcgYSB0YWJsZSAtIHdlIHNob3VsZCByZXN0b3JlIGl0cyBzdHJpcGluZyBjbGFzc2VzIGFzIHdlbGwKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYXNEZXN0cm95U3RyaXBlcyI6IFtdLAoJCQoJCS8qKgoJCSAqIElmIHJlc3RvcmluZyBhIHRhYmxlIC0gd2Ugc2hvdWxkIHJlc3RvcmUgaXRzIHdpZHRoIAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJzRGVzdHJveVdpZHRoIjogMCwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgYXJyYXkgZm9yIGV2ZXJ5IHRpbWUgYSByb3cgaXMgaW5zZXJ0ZWQgKGkuZS4gb24gYSBkcmF3KS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Sb3dDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgdGhlIGhlYWRlciBvbiBlYWNoIGRyYXcuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvSGVhZGVyQ2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbiBmb3IgdGhlIGZvb3RlciBvbiBlYWNoIGRyYXcuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRm9vdGVyQ2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIGRyYXcgY2FsbGJhY2sgZnVuY3Rpb25zCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRHJhd0NhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciByb3cgY3JlYXRlZCBmdW5jdGlvbgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1Jvd0NyZWF0ZWRDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBmb3IganVzdCBiZWZvcmUgdGhlIHRhYmxlIGlzIHJlZHJhd24uIEEgcmV0dXJuIG9mIAoJCSAqIGZhbHNlIHdpbGwgYmUgdXNlZCB0byBjYW5jZWwgdGhlIGRyYXcuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUHJlRHJhd0NhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciB3aGVuIHRoZSB0YWJsZSBoYXMgYmVlbiBpbml0aWFsaXNlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Jbml0Q29tcGxldGUiOiBbXSwKCQoJCQoJCS8qKgoJCSAqIENhbGxiYWNrcyBmb3IgbW9kaWZ5aW5nIHRoZSBzZXR0aW5ncyB0byBiZSBzdG9yZWQgZm9yIHN0YXRlIHNhdmluZywgcHJpb3IgdG8KCQkgKiBzYXZpbmcgc3RhdGUuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVTYXZlUGFyYW1zIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2tzIGZvciBtb2RpZnlpbmcgdGhlIHNldHRpbmdzIHRoYXQgaGF2ZSBiZWVuIHN0b3JlZCBmb3Igc3RhdGUgc2F2aW5nCgkJICogcHJpb3IgdG8gdXNpbmcgdGhlIHN0b3JlZCB2YWx1ZXMgdG8gcmVzdG9yZSB0aGUgc3RhdGUuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVMb2FkUGFyYW1zIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2tzIGZvciBvcGVyYXRpbmcgb24gdGhlIHNldHRpbmdzIG9iamVjdCBvbmNlIHRoZSBzYXZlZCBzdGF0ZSBoYXMgYmVlbgoJCSAqIGxvYWRlZAoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlTG9hZGVkIjogW10sCgkJCgkJLyoqCgkJICogQ2FjaGUgdGhlIHRhYmxlIElEIGZvciBxdWljayBhY2Nlc3MKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic1RhYmxlSWQiOiAiIiwKCQkKCQkvKioKCQkgKiBUaGUgVEFCTEUgbm9kZSBmb3IgdGhlIG1haW4gdGFibGUKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UYWJsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogUGVybWFuZW50IHJlZiB0byB0aGUgdGhlYWQgZWxlbWVudAoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRIZWFkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQZXJtYW5lbnQgcmVmIHRvIHRoZSB0Zm9vdCBlbGVtZW50IC0gaWYgaXQgZXhpc3RzCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVEZvb3QiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFBlcm1hbmVudCByZWYgdG8gdGhlIHRib2R5IGVsZW1lbnQKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UQm9keSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ2FjaGUgdGhlIHdyYXBwZXIgbm9kZSAoY29udGFpbnMgYWxsIERhdGFUYWJsZXMgY29udHJvbGxlZCBlbGVtZW50cykKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UYWJsZVdyYXBwZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIHdoZW4gdXNpbmcgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyB0aGUgbG9hZGluZyBvZiBkYXRhIAoJCSAqIHNob3VsZCBiZSBkZWZlcnJlZCB1bnRpbCB0aGUgc2Vjb25kIGRyYXcuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICovCgkJImJEZWZlckxvYWRpbmciOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiBhbGwgcmVxdWlyZWQgaW5mb3JtYXRpb24gaGFzIGJlZW4gcmVhZCBpbgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICovCgkJImJJbml0aWFsaXNlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZm9ybWF0aW9uIGFib3V0IG9wZW4gcm93cy4gRWFjaCBvYmplY3QgaW4gdGhlIGFycmF5IGhhcyB0aGUgcGFyYW1ldGVycwoJCSAqICduVHInIGFuZCAnblBhcmVudCcKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9PcGVuUm93cyI6IFtdLAoJCQoJCS8qKgoJCSAqIERpY3RhdGUgdGhlIHBvc2l0aW9uaW5nIG9mIERhdGFUYWJsZXMnIGNvbnRyb2wgZWxlbWVudHMgLSBzZWUKCQkgKiB7QGxpbmsgRGF0YVRhYmxlLm1vZGVsLm9Jbml0LnNEb219LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0RvbSI6IG51bGwsCgkJCgkJLyoqCgkJICogV2hpY2ggdHlwZSBvZiBwYWdpbmF0aW9uIHNob3VsZCBiZSB1c2VkLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nIAoJCSAqICBAZGVmYXVsdCB0d29fYnV0dG9uCgkJICovCgkJInNQYWdpbmF0aW9uVHlwZSI6ICJ0d29fYnV0dG9uIiwKCQkKCQkvKioKCQkgKiBUaGUgY29va2llIGR1cmF0aW9uIChmb3IgYlN0YXRlU2F2ZSkgaW4gc2Vjb25kcy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlDb29raWVEdXJhdGlvbiI6IDAsCgkJCgkJLyoqCgkJICogVGhlIGNvb2tpZSBuYW1lIHByZWZpeC4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICovCgkJInNDb29raWVQcmVmaXgiOiAiIiwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbiBmb3IgY29va2llIGNyZWF0aW9uLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkNvb2tpZUNhbGxiYWNrIjogbnVsbCwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHN0YXRlIHNhdmluZy4gRWFjaCBhcnJheSBlbGVtZW50IGlzIGFuIAoJCSAqIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmZ1bmN0aW9uOmZuIC0gZnVuY3Rpb24gdG8gY2FsbC4gVGFrZXMgdHdvIHBhcmFtZXRlcnMsIG9TZXR0aW5ncwoJCSAqICAgICAgIGFuZCB0aGUgSlNPTiBzdHJpbmcgdG8gc2F2ZSB0aGF0IGhhcyBiZWVuIHRodXMgZmFyIGNyZWF0ZWQuIFJldHVybnMKCQkgKiAgICAgICBhIEpTT04gc3RyaW5nIHRvIGJlIGluc2VydGVkIGludG8gYSBqc29uIG9iamVjdCAKCQkgKiAgICAgICAoaS5lLiAnInBhcmFtIjogWyAwLCAxLCAyXScpPC9saT4KCQkgKiAgICAgPGxpPnN0cmluZzpzTmFtZSAtIG5hbWUgb2YgY2FsbGJhY2s8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZVNhdmUiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHN0YXRlIGxvYWRpbmcuIEVhY2ggYXJyYXkgZWxlbWVudCBpcyBhbiAKCQkgKiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5mdW5jdGlvbjpmbiAtIGZ1bmN0aW9uIHRvIGNhbGwuIFRha2VzIHR3byBwYXJhbWV0ZXJzLCBvU2V0dGluZ3MgCgkJICogICAgICAgYW5kIHRoZSBvYmplY3Qgc3RvcmVkLiBNYXkgcmV0dXJuIGZhbHNlIHRvIGNhbmNlbCBzdGF0ZSBsb2FkaW5nPC9saT4KCQkgKiAgICAgPGxpPnN0cmluZzpzTmFtZSAtIG5hbWUgb2YgY2FsbGJhY2s8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZUxvYWQiOiBbXSwKCQkKCQkvKioKCQkgKiBTdGF0ZSB0aGF0IHdhcyBsb2FkZWQgZnJvbSB0aGUgY29va2llLiBVc2VmdWwgZm9yIGJhY2sgcmVmZXJlbmNlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm9Mb2FkZWRTdGF0ZSI6IG51bGwsCgkJCgkJLyoqCgkJICogU291cmNlIHVybCBmb3IgQUpBWCBkYXRhIGZvciB0aGUgdGFibGUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzQWpheFNvdXJjZSI6IG51bGwsCgkJCgkJLyoqCgkJICogUHJvcGVydHkgZnJvbSBhIGdpdmVuIG9iamVjdCBmcm9tIHdoaWNoIHRvIHJlYWQgdGhlIHRhYmxlIGRhdGEgZnJvbS4gVGhpcwoJCSAqIGNhbiBiZSBhbiBlbXB0eSBzdHJpbmcgKHdoZW4gbm90IHNlcnZlci1zaWRlIHByb2Nlc3NpbmcpLCBpbiB3aGljaCBjYXNlIAoJCSAqIGl0IGlzICBhc3N1bWVkIGFuIGFuIGFycmF5IGlzIGdpdmVuIGRpcmVjdGx5LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNBamF4RGF0YVByb3AiOiBudWxsLAoJCQoJCS8qKgoJCSAqIE5vdGUgaWYgZHJhdyBzaG91bGQgYmUgYmxvY2tlZCB3aGlsZSBnZXR0aW5nIGRhdGEKCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICovCgkJImJBamF4RGF0YUdldCI6IHRydWUsCgkJCgkJLyoqCgkJICogVGhlIGxhc3QgalF1ZXJ5IFhIUiBvYmplY3QgdGhhdCB3YXMgdXNlZCBmb3Igc2VydmVyLXNpZGUgZGF0YSBnYXRoZXJpbmcuIAoJCSAqIFRoaXMgY2FuIGJlIHVzZWQgZm9yIHdvcmtpbmcgd2l0aCB0aGUgWEhSIGluZm9ybWF0aW9uIGluIG9uZSBvZiB0aGUgCgkJICogY2FsbGJhY2tzCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImpxWEhSIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGdW5jdGlvbiB0byBnZXQgdGhlIHNlcnZlci1zaWRlIGRhdGEuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqLwoJCSJmblNlcnZlckRhdGEiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9ucyB3aGljaCBhcmUgY2FsbGVkIHByaW9yIHRvIHNlbmRpbmcgYW4gQWpheCByZXF1ZXN0IHNvIGV4dHJhIAoJCSAqIHBhcmFtZXRlcnMgY2FuIGVhc2lseSBiZSBzZW50IHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TZXJ2ZXJQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBTZW5kIHRoZSBYSFIgSFRUUCBtZXRob2QgLSBHRVQgb3IgUE9TVCAoY291bGQgYmUgUFVUIG9yIERFTEVURSBpZiAKCQkgKiByZXF1aXJlZCkuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKi8KCQkic1NlcnZlck1ldGhvZCI6IG51bGwsCgkJCgkJLyoqCgkJICogRm9ybWF0IG51bWJlcnMgZm9yIGRpc3BsYXkuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqLwoJCSJmbkZvcm1hdE51bWJlciI6IG51bGwsCgkJCgkJLyoqCgkJICogTGlzdCBvZiBvcHRpb25zIHRoYXQgY2FuIGJlIHVzZWQgZm9yIHRoZSB1c2VyIHNlbGVjdGFibGUgbGVuZ3RoIG1lbnUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhTGVuZ3RoTWVudSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ291bnRlciBmb3IgdGhlIGRyYXdzIHRoYXQgdGhlIHRhYmxlIGRvZXMuIEFsc28gdXNlZCBhcyBhIHRyYWNrZXIgZm9yCgkJICogc2VydmVyLXNpZGUgcHJvY2Vzc2luZwoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJpRHJhdyI6IDAsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgYSByZWRyYXcgaXMgYmVpbmcgZG9uZSAtIHVzZWZ1bCBmb3IgQWpheAoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICovCgkJImJEcmF3aW5nIjogZmFsc2UsCgkJCgkJLyoqCgkJICogRHJhdyBpbmRleCAoaURyYXcpIG9mIHRoZSBsYXN0IGVycm9yIHdoZW4gcGFyc2luZyB0aGUgcmV0dXJuZWQgZGF0YQoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgLTEKCQkgKi8KCQkiaURyYXdFcnJvciI6IC0xLAoJCQoJCS8qKgoJCSAqIFBhZ2luZyBkaXNwbGF5IGxlbmd0aAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMTAKCQkgKi8KCQkiX2lEaXNwbGF5TGVuZ3RoIjogMTAsCgkKCQkvKioKCQkgKiBQYWdpbmcgc3RhcnQgcG9pbnQgLSBhaURpc3BsYXkgaW5kZXgKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiX2lEaXNwbGF5U3RhcnQiOiAwLAoJCgkJLyoqCgkJICogUGFnaW5nIGVuZCBwb2ludCAtIGFpRGlzcGxheSBpbmRleC4gVXNlIGZuRGlzcGxheUVuZCByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSBlbmQgcG9pbnQKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDEwCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9pRGlzcGxheUVuZCI6IDEwLAoJCQoJCS8qKgoJCSAqIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgLSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgcmVzdWx0IHNldAoJCSAqIChpLmUuIGJlZm9yZSBmaWx0ZXJpbmcpLCBVc2UgZm5SZWNvcmRzVG90YWwgcmF0aGVyIHRoYW4KCQkgKiB0aGlzIHByb3BlcnR5IHRvIGdldCB0aGUgdmFsdWUgb2YgdGhlIG51bWJlciBvZiByZWNvcmRzLCByZWdhcmRsZXNzIG9mCgkJICogdGhlIHNlcnZlci1zaWRlIHByb2Nlc3Npbmcgc2V0dGluZy4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lSZWNvcmRzVG90YWwiOiAwLAoJCgkJLyoqCgkJICogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyAtIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSBjdXJyZW50IGRpc3BsYXkgc2V0CgkJICogKGkuZS4gYWZ0ZXIgZmlsdGVyaW5nKS4gVXNlIGZuUmVjb3Jkc0Rpc3BsYXkgcmF0aGVyIHRoYW4KCQkgKiB0aGlzIHByb3BlcnR5IHRvIGdldCB0aGUgdmFsdWUgb2YgdGhlIG51bWJlciBvZiByZWNvcmRzLCByZWdhcmRsZXNzIG9mCgkJICogdGhlIHNlcnZlci1zaWRlIHByb2Nlc3Npbmcgc2V0dGluZy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCAwCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9pUmVjb3Jkc0Rpc3BsYXkiOiAwLAoJCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgalF1ZXJ5IFVJIG1hcmtpbmcgYW5kIGNsYXNzZXMgc2hvdWxkIGJlIHVzZWQuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJKVUkiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFRoZSBjbGFzc2VzIHRvIHVzZSBmb3IgdGhlIHRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvQ2xhc3NlcyI6IHt9LAoJCQoJCS8qKgoJCSAqIEZsYWcgYXR0YWNoZWQgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBzbyB5b3UgY2FuIGNoZWNrIGluIHRoZSBkcmF3IAoJCSAqIGNhbGxiYWNrIGlmIGZpbHRlcmluZyBoYXMgYmVlbiBkb25lIGluIHRoZSBkcmF3LiBEZXByZWNhdGVkIGluIGZhdm91ciBvZgoJCSAqIGV2ZW50cy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqLwoJCSJiRmlsdGVyZWQiOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBGbGFnIGF0dGFjaGVkIHRvIHRoZSBzZXR0aW5ncyBvYmplY3Qgc28geW91IGNhbiBjaGVjayBpbiB0aGUgZHJhdyAKCQkgKiBjYWxsYmFjayBpZiBzb3J0aW5nIGhhcyBiZWVuIGRvbmUgaW4gdGhlIGRyYXcuIERlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJICogZXZlbnRzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImJTb3J0ZWQiOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSB0aGF0IGlmIG11bHRpcGxlIHJvd3MgYXJlIGluIHRoZSBoZWFkZXIgYW5kIHRoZXJlIGlzIG1vcmUgdGhhbiAKCQkgKiBvbmUgdW5pcXVlIGNlbGwgcGVyIGNvbHVtbiwgaWYgdGhlIHRvcCBvbmUgKHRydWUpIG9yIGJvdHRvbSBvbmUgKGZhbHNlKSAKCQkgKiBzaG91bGQgYmUgdXNlZCBmb3Igc29ydGluZyAvIHRpdGxlIGJ5IERhdGFUYWJsZXMuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJTb3J0Q2VsbHNUb3AiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEluaXRpYWxpc2F0aW9uIG9iamVjdCB0aGF0IGlzIHVzZWQgZm9yIHRoZSB0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJvSW5pdCI6IG51bGwsCgkJCgkJLyoqCgkJICogRGVzdHJveSBjYWxsYmFjayBmdW5jdGlvbnMgLSBmb3IgcGx1Zy1pbnMgdG8gYXR0YWNoIHRoZW1zZWx2ZXMgdG8gdGhlCgkJICogZGVzdHJveSBzbyB0aGV5IGNhbiBjbGVhbiB1cCBtYXJrdXAgYW5kIGV2ZW50cy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9EZXN0cm95Q2FsbGJhY2siOiBbXSwKCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGN1cnJlbnQgcmVjb3JkIHNldCwgYmVmb3JlIGZpbHRlcmluZwoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqLwoJCSJmblJlY29yZHNUb3RhbCI6IGZ1bmN0aW9uICgpCgkJewoJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkgewoJCQkJcmV0dXJuIHBhcnNlSW50KHRoaXMuX2lSZWNvcmRzVG90YWwsIDEwKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGg7CgkJCX0KCQl9LAoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGN1cnJlbnQgcmVjb3JkIHNldCwgYWZ0ZXIgZmlsdGVyaW5nCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuUmVjb3Jkc0Rpc3BsYXkiOiBmdW5jdGlvbiAoKQoJCXsKCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApIHsKCQkJCXJldHVybiBwYXJzZUludCh0aGlzLl9pUmVjb3Jkc0Rpc3BsYXksIDEwKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmFpRGlzcGxheS5sZW5ndGg7CgkJCX0KCQl9LAoJCQoJCS8qKgoJCSAqIFNldCB0aGUgZGlzcGxheSBlbmQgcG9pbnQgLSBhaURpc3BsYXkgaW5kZXgKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHRvZG8gU2hvdWxkIGRvIGF3YXkgd2l0aCBfaURpc3BsYXlFbmQgYW5kIGNhbGN1bGF0ZSBpdCBvbi10aGUtZmx5IGhlcmUKCQkgKi8KCQkiZm5EaXNwbGF5RW5kIjogZnVuY3Rpb24gKCkKCQl7CgkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKSB7CgkJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJQYWdpbmF0ZSA9PT0gZmFsc2UgfHwgdGhpcy5faURpc3BsYXlMZW5ndGggPT0gLTEgKSB7CgkJCQkJcmV0dXJuIHRoaXMuX2lEaXNwbGF5U3RhcnQrdGhpcy5haURpc3BsYXkubGVuZ3RoOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gTWF0aC5taW4oIHRoaXMuX2lEaXNwbGF5U3RhcnQrdGhpcy5faURpc3BsYXlMZW5ndGgsIAoJCQkJCQl0aGlzLl9pUmVjb3Jkc0Rpc3BsYXkgKTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLl9pRGlzcGxheUVuZDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogVGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGlzIHRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm9JbnN0YW5jZSI6IG51bGwsCgkJCgkJLyoqCgkJICogVW5pcXVlIGlkZW50aWZpZXIgZm9yIGVhY2ggaW5zdGFuY2Ugb2YgdGhlIERhdGFUYWJsZXMgb2JqZWN0LiBJZiB0aGVyZQoJCSAqIGlzIGFuIElEIG9uIHRoZSB0YWJsZSBub2RlLCB0aGVuIGl0IHRha2VzIHRoYXQgdmFsdWUsIG90aGVyd2lzZSBhbgoJCSAqIGluY3JlbWVudGluZyBpbnRlcm5hbCBjb3VudGVyIGlzIHVzZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNJbnN0YW5jZSI6IG51bGwsCgkKCQkvKioKCQkgKiB0YWJpbmRleCBhdHRyaWJ1dGUgdmFsdWUgdGhhdCBpcyBhZGRlZCB0byBEYXRhVGFibGVzIGNvbnRyb2wgZWxlbWVudHMsIGFsbG93aW5nCgkJICoga2V5Ym9hcmQgbmF2aWdhdGlvbiBvZiB0aGUgdGFibGUgYW5kIGl0cyBjb250cm9scy4KCQkgKi8KCQkiaVRhYkluZGV4IjogMCwKCQoJCS8qKgoJCSAqIERJViBjb250YWluZXIgZm9yIHRoZSBmb290ZXIgc2Nyb2xsaW5nIHRhYmxlIGlmIHNjcm9sbGluZwoJCSAqLwoJCSJuU2Nyb2xsSGVhZCI6IG51bGwsCgkKCQkvKioKCQkgKiBESVYgY29udGFpbmVyIGZvciB0aGUgZm9vdGVyIHNjcm9sbGluZyB0YWJsZSBpZiBzY3JvbGxpbmcKCQkgKi8KCQkiblNjcm9sbEZvb3QiOiBudWxsCgl9OwoKCS8qKgoJICogRXh0ZW5zaW9uIG9iamVjdCBmb3IgRGF0YVRhYmxlcyB0aGF0IGlzIHVzZWQgdG8gcHJvdmlkZSBhbGwgZXh0ZW5zaW9uIG9wdGlvbnMuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlLmV4dDwvaT4gb2JqZWN0IGlzIGF2YWlsYWJsZSB0aHJvdWdoCgkgKiA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlLmV4dDwvaT4gd2hlcmUgaXQgbWF5IGJlIGFjY2Vzc2VkIGFuZCBtYW5pcHVsYXRlZC4gSXQgaXMKCSAqIGFsc28gYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlRXh0PC9pPiBmb3IgaGlzdG9yaWMgcmVhc29ucy4KCSAqICBAbmFtZXNwYWNlCgkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5leHQKCSAqLwoJRGF0YVRhYmxlLmV4dCA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5leHQgKTsKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMsIHsKCQkic1RhYmxlIjogImRhdGFUYWJsZSIsCgkKCQkvKiBUd28gYnV0dG9ucyBidXR0b25zICovCgkJInNQYWdlUHJldkVuYWJsZWQiOiAicGFnaW5hdGVfZW5hYmxlZF9wcmV2aW91cyIsCgkJInNQYWdlUHJldkRpc2FibGVkIjogInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIiwKCQkic1BhZ2VOZXh0RW5hYmxlZCI6ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiLAoJCSJzUGFnZU5leHREaXNhYmxlZCI6ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IiwKCQkic1BhZ2VKVUlOZXh0IjogIiIsCgkJInNQYWdlSlVJUHJldiI6ICIiLAoJCQoJCS8qIEZ1bGwgbnVtYmVycyBwYWdpbmcgYnV0dG9ucyAqLwoJCSJzUGFnZUJ1dHRvbiI6ICJwYWdpbmF0ZV9idXR0b24iLAoJCSJzUGFnZUJ1dHRvbkFjdGl2ZSI6ICJwYWdpbmF0ZV9hY3RpdmUiLAoJCSJzUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIjogInBhZ2luYXRlX2J1dHRvbiBwYWdpbmF0ZV9idXR0b25fZGlzYWJsZWQiLAoJCSJzUGFnZUZpcnN0IjogImZpcnN0IiwKCQkic1BhZ2VQcmV2aW91cyI6ICJwcmV2aW91cyIsCgkJInNQYWdlTmV4dCI6ICJuZXh0IiwKCQkic1BhZ2VMYXN0IjogImxhc3QiLAoJCQoJCS8qIFN0cmlwaW5nIGNsYXNzZXMgKi8KCQkic1N0cmlwZU9kZCI6ICJvZGQiLAoJCSJzU3RyaXBlRXZlbiI6ICJldmVuIiwKCQkKCQkvKiBFbXB0eSByb3cgKi8KCQkic1Jvd0VtcHR5IjogImRhdGFUYWJsZXNfZW1wdHkiLAoJCQoJCS8qIEZlYXR1cmVzICovCgkJInNXcmFwcGVyIjogImRhdGFUYWJsZXNfd3JhcHBlciIsCgkJInNGaWx0ZXIiOiAiZGF0YVRhYmxlc19maWx0ZXIiLAoJCSJzSW5mbyI6ICJkYXRhVGFibGVzX2luZm8iLAoJCSJzUGFnaW5nIjogImRhdGFUYWJsZXNfcGFnaW5hdGUgcGFnaW5nXyIsIC8qIE5vdGUgdGhhdCB0aGUgdHlwZSBpcyBwb3N0Zml4ZWQgKi8KCQkic0xlbmd0aCI6ICJkYXRhVGFibGVzX2xlbmd0aCIsCgkJInNQcm9jZXNzaW5nIjogImRhdGFUYWJsZXNfcHJvY2Vzc2luZyIsCgkJCgkJLyogU29ydGluZyAqLwoJCSJzU29ydEFzYyI6ICJzb3J0aW5nX2FzYyIsCgkJInNTb3J0RGVzYyI6ICJzb3J0aW5nX2Rlc2MiLAoJCSJzU29ydGFibGUiOiAic29ydGluZyIsIC8qIFNvcnRhYmxlIGluIGJvdGggZGlyZWN0aW9ucyAqLwoJCSJzU29ydGFibGVBc2MiOiAic29ydGluZ19hc2NfZGlzYWJsZWQiLAoJCSJzU29ydGFibGVEZXNjIjogInNvcnRpbmdfZGVzY19kaXNhYmxlZCIsCgkJInNTb3J0YWJsZU5vbmUiOiAic29ydGluZ19kaXNhYmxlZCIsCgkJInNTb3J0Q29sdW1uIjogInNvcnRpbmdfIiwgLyogTm90ZSB0aGF0IGFuIGludCBpcyBwb3N0Zml4ZWQgZm9yIHRoZSBzb3J0aW5nIG9yZGVyICovCgkJInNTb3J0SlVJQXNjIjogIiIsCgkJInNTb3J0SlVJRGVzYyI6ICIiLAoJCSJzU29ydEpVSSI6ICIiLAoJCSJzU29ydEpVSUFzY0FsbG93ZWQiOiAiIiwKCQkic1NvcnRKVUlEZXNjQWxsb3dlZCI6ICIiLAoJCSJzU29ydEpVSVdyYXBwZXIiOiAiIiwKCQkic1NvcnRJY29uIjogIiIsCgkJCgkJLyogU2Nyb2xsaW5nICovCgkJInNTY3JvbGxXcmFwcGVyIjogImRhdGFUYWJsZXNfc2Nyb2xsIiwKCQkic1Njcm9sbEhlYWQiOiAiZGF0YVRhYmxlc19zY3JvbGxIZWFkIiwKCQkic1Njcm9sbEhlYWRJbm5lciI6ICJkYXRhVGFibGVzX3Njcm9sbEhlYWRJbm5lciIsCgkJInNTY3JvbGxCb2R5IjogImRhdGFUYWJsZXNfc2Nyb2xsQm9keSIsCgkJInNTY3JvbGxGb290IjogImRhdGFUYWJsZXNfc2Nyb2xsRm9vdCIsCgkJInNTY3JvbGxGb290SW5uZXIiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290SW5uZXIiLAoJCQoJCS8qIE1pc2MgKi8KCQkic0Zvb3RlclRIIjogIiIsCgkJInNKVUlIZWFkZXIiOiAiIiwKCQkic0pVSUZvb3RlciI6ICIiCgl9ICk7CgkKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub0pVSUNsYXNzZXMsIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMsIHsKCQkvKiBUd28gYnV0dG9ucyBidXR0b25zICovCgkJInNQYWdlUHJldkVuYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1sZWZ0IiwKCQkic1BhZ2VQcmV2RGlzYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1sZWZ0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VOZXh0RW5hYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXJpZ2h0IiwKCQkic1BhZ2VOZXh0RGlzYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1yaWdodCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlSlVJTmV4dCI6ICJ1aS1pY29uIHVpLWljb24tY2lyY2xlLWFycm93LWUiLAoJCSJzUGFnZUpVSVByZXYiOiAidWktaWNvbiB1aS1pY29uLWNpcmNsZS1hcnJvdy13IiwKCQkKCQkvKiBGdWxsIG51bWJlcnMgcGFnaW5nIGJ1dHRvbnMgKi8KCQkic1BhZ2VCdXR0b24iOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1BhZ2VCdXR0b25BY3RpdmUiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VCdXR0b25TdGF0aWNEaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZUZpcnN0IjogImZpcnN0IHVpLWNvcm5lci10bCB1aS1jb3JuZXItYmwiLAoJCSJzUGFnZUxhc3QiOiAibGFzdCB1aS1jb3JuZXItdHIgdWktY29ybmVyLWJyIiwKCQkKCQkvKiBGZWF0dXJlcyAqLwoJCSJzUGFnaW5nIjogImRhdGFUYWJsZXNfcGFnaW5hdGUgZmctYnV0dG9uc2V0IHVpLWJ1dHRvbnNldCBmZy1idXR0b25zZXQtbXVsdGkgIisKCQkJInVpLWJ1dHRvbnNldC1tdWx0aSBwYWdpbmdfIiwgLyogTm90ZSB0aGF0IHRoZSB0eXBlIGlzIHBvc3RmaXhlZCAqLwoJCQoJCS8qIFNvcnRpbmcgKi8KCQkic1NvcnRBc2MiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0RGVzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGVBc2MiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZURlc2MiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZU5vbmUiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0SlVJQXNjIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tdHJpYW5nbGUtMS1uIiwKCQkic1NvcnRKVUlEZXNjIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tdHJpYW5nbGUtMS1zIiwKCQkic1NvcnRKVUkiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi1jYXJhdC0yLW4tcyIsCgkJInNTb3J0SlVJQXNjQWxsb3dlZCI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTEtbiIsCgkJInNTb3J0SlVJRGVzY0FsbG93ZWQiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi1jYXJhdC0xLXMiLAoJCSJzU29ydEpVSVdyYXBwZXIiOiAiRGF0YVRhYmxlc19zb3J0X3dyYXBwZXIiLAoJCSJzU29ydEljb24iOiAiRGF0YVRhYmxlc19zb3J0X2ljb24iLAoJCQoJCS8qIFNjcm9sbGluZyAqLwoJCSJzU2Nyb2xsSGVhZCI6ICJkYXRhVGFibGVzX3Njcm9sbEhlYWQgdWktc3RhdGUtZGVmYXVsdCIsCgkJInNTY3JvbGxGb290IjogImRhdGFUYWJsZXNfc2Nyb2xsRm9vdCB1aS1zdGF0ZS1kZWZhdWx0IiwKCQkKCQkvKiBNaXNjICovCgkJInNGb290ZXJUSCI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic0pVSUhlYWRlciI6ICJmZy10b29sYmFyIHVpLXRvb2xiYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItdGwgdWktY29ybmVyLXRyIHVpLWhlbHBlci1jbGVhcmZpeCIsCgkJInNKVUlGb290ZXIiOiAiZmctdG9vbGJhciB1aS10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWJsIHVpLWNvcm5lci1iciB1aS1oZWxwZXItY2xlYXJmaXgiCgl9ICk7CgkKCQoJLyoKCSAqIFZhcmlhYmxlOiBvUGFnaW5hdGlvbgoJICogUHVycG9zZTogIAoJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQKCSAqLwoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1BhZ2luYXRpb24sIHsKCQkvKgoJCSAqIFZhcmlhYmxlOiB0d29fYnV0dG9uCgkJICogUHVycG9zZTogIFN0YW5kYXJkIHR3byBidXR0b24gKGZvcndhcmQvYmFjaykgcGFnaW5hdGlvbgoJCSAqIFNjb3BlOiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uCgkJICovCgkJInR3b19idXR0b24iOiB7CgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi50d29fYnV0dG9uLmZuSW5pdAoJCQkgKiBQdXJwb3NlOiAgSW5pdGlhbGlzZSBkb20gZWxlbWVudHMgcmVxdWlyZWQgZm9yIHBhZ2luYXRpb24gd2l0aCBmb3J3YXJkL2JhY2sgYnV0dG9ucyBvbmx5CgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIG5vZGU6blBhZ2luZyAtIHRoZSBESVYgd2hpY2ggY29udGFpbnMgdGhpcyBwYWdpbmF0aW9uIGNvbnRyb2wKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB3aGljaCBtdXN0IGJlIGNhbGxlZCBvbiB1cGRhdGUKCQkJICovCgkJCSJmbkluaXQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgblBhZ2luZywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQl2YXIgb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZTsKCQkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCXZhciBmbkNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICggZSApIHsKCQkJCQlpZiAoIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLmFjdGlvbiApICkKCQkJCQl7CgkJCQkJCWZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQl9OwoJCgkJCQl2YXIgc0FwcGVuZCA9ICghb1NldHRpbmdzLmJKVUkpID8KCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj4nK29MYW5nLnNQcmV2aW91cysnPC9hPicrCgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+JytvTGFuZy5zTmV4dCsnPC9hPicKCQkJCQk6CgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZVByZXZEaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+PHNwYW4gY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlSlVJUHJldisnIj48L3NwYW4+PC9hPicrCgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+PHNwYW4gY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlSlVJTmV4dCsnIj48L3NwYW4+PC9hPic7CgkJCQkkKG5QYWdpbmcpLmFwcGVuZCggc0FwcGVuZCApOwoJCQkJCgkJCQl2YXIgZWxzID0gJCgnYScsIG5QYWdpbmcpOwoJCQkJdmFyIG5QcmV2aW91cyA9IGVsc1swXSwKCQkJCQluTmV4dCA9IGVsc1sxXTsKCQkJCQoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggblByZXZpb3VzLCB7YWN0aW9uOiAicHJldmlvdXMifSwgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5OZXh0LCAgICAge2FjdGlvbjogIm5leHQifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQkKCQkJCS8qIElEIHRoZSBmaXJzdCBlbGVtZW50cyBvbmx5ICovCgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJblBhZ2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3BhZ2luYXRlJzsKCQkJCQluUHJldmlvdXMuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19wcmV2aW91cyc7CgkJCQkJbk5leHQuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19uZXh0JzsKCQoJCQkJCW5QcmV2aW91cy5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBvU2V0dGluZ3Muc1RhYmxlSWQpOwoJCQkJCW5OZXh0LnNldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24udHdvX2J1dHRvbi5mblVwZGF0ZQoJCQkgKiBQdXJwb3NlOiAgVXBkYXRlIHRoZSB0d28gYnV0dG9uIHBhZ2luYXRpb24gYXQgdGhlIGVuZCBvZiB0aGUgZHJhdwoJCQkgKiBSZXR1cm5zOiAgLQoJCQkgKiBJbnB1dHM6ICAgb2JqZWN0Om9TZXR0aW5ncyAtIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJCSAqICAgICAgICAgICBmdW5jdGlvbjpmbkNhbGxiYWNrRHJhdyAtIGRyYXcgZnVuY3Rpb24gdG8gY2FsbCBvbiBwYWdlIGNoYW5nZQoJCQkgKi8KCQkJImZuVXBkYXRlIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGZuQ2FsbGJhY2tEcmF3ICkKCQkJewoJCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5baV0uY2hpbGROb2Rlcy5sZW5ndGggIT09IDAgKQoJCQkJCXsKCQkJCQkJYW5baV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUgPSAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApID8gCgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZVByZXZEaXNhYmxlZCA6IG9DbGFzc2VzLnNQYWdlUHJldkVuYWJsZWQ7CgkJCQkJCQoJCQkJCQlhbltpXS5jaGlsZE5vZGVzWzFdLmNsYXNzTmFtZSA9ICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpID09IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKSA/IAoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VOZXh0RGlzYWJsZWQgOiBvQ2xhc3Nlcy5zUGFnZU5leHRFbmFibGVkOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0sCgkJCgkJCgkJLyoKCQkgKiBWYXJpYWJsZTogaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzCgkJICogUHVycG9zZTogIENoYW5nZSB0aGUgbnVtYmVyIG9mIHBhZ2VzIHdoaWNoIGNhbiBiZSBzZWVuCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkiaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzIjogNSwKCQkKCQkvKgoJCSAqIFZhcmlhYmxlOiBmdWxsX251bWJlcnMKCQkgKiBQdXJwb3NlOiAgRnVsbCBudW1iZXJzIHBhZ2luYXRpb24KCQkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCSJmdWxsX251bWJlcnMiOiB7CgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi5mdWxsX251bWJlcnMuZm5Jbml0CgkJCSAqIFB1cnBvc2U6ICBJbml0aWFsaXNlIGRvbSBlbGVtZW50cyByZXF1aXJlZCBmb3IgcGFnaW5hdGlvbiB3aXRoIGEgbGlzdCBvZiB0aGUgcGFnZXMKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgbm9kZTpuUGFnaW5nIC0gdGhlIERJViB3aGljaCBjb250YWlucyB0aGlzIHBhZ2luYXRpb24gY29udHJvbAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIG9uIHVwZGF0ZQoJCQkgKi8KCQkJImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGZuQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKCBlICkgewoJCQkJCWlmICggb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEuYWN0aW9uICkgKQoJCQkJCXsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCX07CgkKCQkJCSQoblBhZ2luZykuYXBwZW5kKAoJCQkJCSc8YSAgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VGaXJzdCsnIj4nK29MYW5nLnNGaXJzdCsnPC9hPicrCgkJCQkJJzxhICB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZVByZXZpb3VzKyciPicrb0xhbmcuc1ByZXZpb3VzKyc8L2E+JysKCQkJCQknPHNwYW4+PC9zcGFuPicrCgkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlTmV4dCsnIj4nK29MYW5nLnNOZXh0Kyc8L2E+JysKCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VMYXN0KyciPicrb0xhbmcuc0xhc3QrJzwvYT4nCgkJCQkpOwoJCQkJdmFyIGVscyA9ICQoJ2EnLCBuUGFnaW5nKTsKCQkJCXZhciBuRmlyc3QgPSBlbHNbMF0sCgkJCQkJblByZXYgPSBlbHNbMV0sCgkJCQkJbk5leHQgPSBlbHNbMl0sCgkJCQkJbkxhc3QgPSBlbHNbM107CgkJCQkKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5GaXJzdCwge2FjdGlvbjogImZpcnN0In0sICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuUHJldiwgIHthY3Rpb246ICJwcmV2aW91cyJ9LCBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbk5leHQsICB7YWN0aW9uOiAibmV4dCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5MYXN0LCAge2FjdGlvbjogImxhc3QifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQkKCQkJCS8qIElEIHRoZSBmaXJzdCBlbGVtZW50cyBvbmx5ICovCgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJblBhZ2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3BhZ2luYXRlJzsKCQkJCQluRmlyc3QuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX2ZpcnN0JzsKCQkJCQluUHJldi5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfcHJldmlvdXMnOwoJCQkJCW5OZXh0LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19uZXh0JzsKCQkJCQluTGFzdC5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfbGFzdCc7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24uZnVsbF9udW1iZXJzLmZuVXBkYXRlCgkJCSAqIFB1cnBvc2U6ICBVcGRhdGUgdGhlIGxpc3Qgb2YgcGFnZSBidXR0b25zIHNob3dzCgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB0byBjYWxsIG9uIHBhZ2UgY2hhbmdlCgkJCSAqLwoJCQkiZm5VcGRhdGUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQl2YXIgaVBhZ2VDb3VudCA9IERhdGFUYWJsZS5leHQub1BhZ2luYXRpb24uaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzOwoJCQkJdmFyIGlQYWdlQ291bnRIYWxmID0gTWF0aC5mbG9vcihpUGFnZUNvdW50IC8gMik7CgkJCQl2YXIgaVBhZ2VzID0gTWF0aC5jZWlsKChvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpKSAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgpOwoJCQkJdmFyIGlDdXJyZW50UGFnZSA9IE1hdGguY2VpbChvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKSArIDE7CgkJCQl2YXIgc0xpc3QgPSAiIjsKCQkJCXZhciBpU3RhcnRCdXR0b24sIGlFbmRCdXR0b24sIGksIGlMZW47CgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgYW5CdXR0b25zLCBhblN0YXRpYywgblBhZ2luYXRlTGlzdDsKCQkJCXZhciBhbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wOwoJCQkJdmFyIGZuQmluZCA9IGZ1bmN0aW9uIChqKSB7CgkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggdGhpcywgeyJwYWdlIjogaitpU3RhcnRCdXR0b24tMX0sIGZ1bmN0aW9uKGUpIHsKCQkJCQkJLyogVXNlIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgZWxlbWVudCB0byBqdW1wIHRvIHRoZSByZXF1aXJlZCBwYWdlICovCgkJCQkJCW9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLnBhZ2UgKTsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJfSApOwoJCQkJfTsKCQkJCQoJCQkJLyogUGFnZXMgY2FsY3VsYXRpb24gKi8KCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA9PT0gLTEgKQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IDE7CgkJCQkJaUVuZEJ1dHRvbiA9IDE7CgkJCQkJaUN1cnJlbnRQYWdlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKGlQYWdlcyA8IGlQYWdlQ291bnQpCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gaVBhZ2VzOwoJCQkJfQoJCQkJZWxzZSBpZiAoaUN1cnJlbnRQYWdlIDw9IGlQYWdlQ291bnRIYWxmKQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlQYWdlQ291bnQ7CgkJCQl9CgkJCQllbHNlIGlmIChpQ3VycmVudFBhZ2UgPj0gKGlQYWdlcyAtIGlQYWdlQ291bnRIYWxmKSkKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSBpUGFnZXMgLSBpUGFnZUNvdW50ICsgMTsKCQkJCQlpRW5kQnV0dG9uID0gaVBhZ2VzOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IGlDdXJyZW50UGFnZSAtIE1hdGguY2VpbChpUGFnZUNvdW50IC8gMikgKyAxOwoJCQkJCWlFbmRCdXR0b24gPSBpU3RhcnRCdXR0b24gKyBpUGFnZUNvdW50IC0gMTsKCQkJCX0KCQoJCQkJCgkJCQkvKiBCdWlsZCB0aGUgZHluYW1pYyBsaXN0ICovCgkJCQlmb3IgKCBpPWlTdGFydEJ1dHRvbiA7IGk8PWlFbmRCdXR0b24gOyBpKysgKQoJCQkJewoJCQkJCXNMaXN0ICs9IChpQ3VycmVudFBhZ2UgIT09IGkpID8KCQkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rJyI+JytvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoaSkrJzwvYT4nIDoKCQkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b25BY3RpdmUrJyI+JytvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoaSkrJzwvYT4nOwoJCQkJfQoJCQkJCgkJCQkvKiBMb29wIG92ZXIgZWFjaCBpbnN0YW5jZSBvZiB0aGUgcGFnZXIgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5baV0uY2hpbGROb2Rlcy5sZW5ndGggPT09IDAgKQoJCQkJCXsKCQkJCQkJY29udGludWU7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIEJ1aWxkIHVwIHRoZSBkeW5hbWljIGxpc3QgZmlyc3QgLSBodG1sIGFuZCBsaXN0ZW5lcnMgKi8KCQkJCQkkKCdzcGFuOmVxKDApJywgYW5baV0pCgkJCQkJCS5odG1sKCBzTGlzdCApCgkJCQkJCS5jaGlsZHJlbignYScpLmVhY2goIGZuQmluZCApOwoJCQkJCQoJCQkJCS8qIFVwZGF0ZSB0aGUgcGVybWFuZW50IGJ1dHRvbidzIGNsYXNzZXMgKi8KCQkJCQlhbkJ1dHRvbnMgPSBhbltpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpOwoJCQkJCWFuU3RhdGljID0gWwoJCQkJCQlhbkJ1dHRvbnNbMF0sIGFuQnV0dG9uc1sxXSwgCgkJCQkJCWFuQnV0dG9uc1thbkJ1dHRvbnMubGVuZ3RoLTJdLCBhbkJ1dHRvbnNbYW5CdXR0b25zLmxlbmd0aC0xXQoJCQkJCV07CgkKCQkJCQkkKGFuU3RhdGljKS5yZW1vdmVDbGFzcyggb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlQnV0dG9uQWN0aXZlKyIgIitvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkICk7CgkJCQkJJChbYW5TdGF0aWNbMF0sIGFuU3RhdGljWzFdXSkuYWRkQ2xhc3MoIAoJCQkJCQkoaUN1cnJlbnRQYWdlPT0xKSA/CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIDoKCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uCgkJCQkJKTsKCQkJCQkkKFthblN0YXRpY1syXSwgYW5TdGF0aWNbM11dKS5hZGRDbGFzcygKCQkJCQkJKGlQYWdlcz09PTAgfHwgaUN1cnJlbnRQYWdlPT09aVBhZ2VzIHx8IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg9PT0tMSkgPwoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VCdXR0b25TdGF0aWNEaXNhYmxlZCA6CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvbgoJCQkJCSk7CgkJCQl9CgkJCX0KCQl9Cgl9ICk7CgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9Tb3J0LCB7CgkJLyoKCQkgKiB0ZXh0IHNvcnRpbmcKCQkgKi8KCQkic3RyaW5nLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQlpZiAoIHR5cGVvZiBhICE9ICdzdHJpbmcnICkgewoJCQkJYSA9IChhICE9PSBudWxsICYmIGEudG9TdHJpbmcpID8gYS50b1N0cmluZygpIDogJyc7CgkJCX0KCQkJcmV0dXJuIGEudG9Mb3dlckNhc2UoKTsKCQl9LAoJCgkJInN0cmluZy1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJfSwKCQkKCQkic3RyaW5nLWRlc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIGh0bWwgc29ydGluZyAoaWdub3JlIGh0bWwgdGFncykKCQkgKi8KCQkiaHRtbC1wcmUiOiBmdW5jdGlvbiAoIGEgKQoJCXsKCQkJcmV0dXJuIGEucmVwbGFjZSggLzwuKj8+L2csICIiICkudG9Mb3dlckNhc2UoKTsKCQl9LAoJCQoJCSJodG1sLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQl9LAoJCQoJCSJodG1sLWRlc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIGRhdGUgc29ydGluZwoJCSAqLwoJCSJkYXRlLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQl2YXIgeCA9IERhdGUucGFyc2UoIGEgKTsKCQkJCgkJCWlmICggaXNOYU4oeCkgfHwgeD09PSIiICkKCQkJewoJCQkJeCA9IERhdGUucGFyc2UoICIwMS8wMS8xOTcwIDAwOjAwOjAwIiApOwoJCQl9CgkJCXJldHVybiB4OwoJCX0sCgkKCQkiZGF0ZS1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuIHggLSB5OwoJCX0sCgkJCgkJImRhdGUtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geSAtIHg7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIG51bWVyaWNhbCBzb3J0aW5nCgkJICovCgkJIm51bWVyaWMtcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCXJldHVybiAoYT09Ii0iIHx8IGE9PT0iIikgPyAwIDogYSoxOwoJCX0sCgkKCQkibnVtZXJpYy1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuIHggLSB5OwoJCX0sCgkJCgkJIm51bWVyaWMtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geSAtIHg7CgkJfQoJfSApOwoJCgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0LmFUeXBlcywgWwoJCS8qCgkJICogRnVuY3Rpb246IC0KCQkgKiBQdXJwb3NlOiAgQ2hlY2sgdG8gc2VlIGlmIGEgc3RyaW5nIGlzIG51bWVyaWMKCQkgKiBSZXR1cm5zOiAgc3RyaW5nOidudW1lcmljJyBvciBudWxsCgkJICogSW5wdXRzOiAgIG1peGVkOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQkvKiBBbGxvdyB6ZXJvIGxlbmd0aCBzdHJpbmdzIGFzIGEgbnVtYmVyICovCgkJCWlmICggdHlwZW9mIHNEYXRhID09PSAnbnVtYmVyJyApCgkJCXsKCQkJCXJldHVybiAnbnVtZXJpYyc7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSAhPT0gJ3N0cmluZycgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJdmFyIHNWYWxpZEZpcnN0Q2hhcnMgPSAiMDEyMzQ1Njc4OS0iOwoJCQl2YXIgc1ZhbGlkQ2hhcnMgPSAiMDEyMzQ1Njc4OS4iOwoJCQl2YXIgQ2hhcjsKCQkJdmFyIGJEZWNpbWFsID0gZmFsc2U7CgkJCQoJCQkvKiBDaGVjayBmb3IgYSB2YWxpZCBmaXJzdCBjaGFyIChubyBwZXJpb2QgYW5kIGFsbG93IG5lZ2F0aXZlcykgKi8KCQkJQ2hhciA9IHNEYXRhLmNoYXJBdCgwKTsgCgkJCWlmIChzVmFsaWRGaXJzdENoYXJzLmluZGV4T2YoQ2hhcikgPT0gLTEpIAoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgYWxsIHRoZSBvdGhlciBjaGFyYWN0ZXJzIGFyZSB2YWxpZCAqLwoJCQlmb3IgKCB2YXIgaT0xIDsgaTxzRGF0YS5sZW5ndGggOyBpKysgKSAKCQkJewoJCQkJQ2hhciA9IHNEYXRhLmNoYXJBdChpKTsgCgkJCQlpZiAoc1ZhbGlkQ2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgCgkJCQl7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgkJCQkKCQkJCS8qIE9ubHkgYWxsb3dlZCBvbmUgZGVjaW1hbCBwbGFjZS4uLiAqLwoJCQkJaWYgKCBDaGFyID09ICIuIiApCgkJCQl7CgkJCQkJaWYgKCBiRGVjaW1hbCApCgkJCQkJewoJCQkJCQlyZXR1cm4gbnVsbDsKCQkJCQl9CgkJCQkJYkRlY2ltYWwgPSB0cnVlOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gJ251bWVyaWMnOwoJCX0sCgkJCgkJLyoKCQkgKiBGdW5jdGlvbjogLQoJCSAqIFB1cnBvc2U6ICBDaGVjayB0byBzZWUgaWYgYSBzdHJpbmcgaXMgYWN0dWFsbHkgYSBmb3JtYXR0ZWQgZGF0ZQoJCSAqIFJldHVybnM6ICBzdHJpbmc6J2RhdGUnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgc3RyaW5nOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQl2YXIgaVBhcnNlID0gRGF0ZS5wYXJzZShzRGF0YSk7CgkJCWlmICggKGlQYXJzZSAhPT0gbnVsbCAmJiAhaXNOYU4oaVBhcnNlKSkgfHwgKHR5cGVvZiBzRGF0YSA9PT0gJ3N0cmluZycgJiYgc0RhdGEubGVuZ3RoID09PSAwKSApCgkJCXsKCQkJCXJldHVybiAnZGF0ZSc7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfSwKCQkKCQkvKgoJCSAqIEZ1bmN0aW9uOiAtCgkJICogUHVycG9zZTogIENoZWNrIHRvIHNlZSBpZiBhIHN0cmluZyBzaG91bGQgYmUgdHJlYXRlZCBhcyBhbiBIVE1MIHN0cmluZwoJCSAqIFJldHVybnM6ICBzdHJpbmc6J2h0bWwnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgc3RyaW5nOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQlpZiAoIHR5cGVvZiBzRGF0YSA9PT0gJ3N0cmluZycgJiYgc0RhdGEuaW5kZXhPZignPCcpICE9IC0xICYmIHNEYXRhLmluZGV4T2YoJz4nKSAhPSAtMSApCgkJCXsKCQkJCXJldHVybiAnaHRtbCc7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoJXSApOwoJCgoJLy8galF1ZXJ5IGFsaWFzZXMKCSQuZm4uRGF0YVRhYmxlID0gRGF0YVRhYmxlOwoJJC5mbi5kYXRhVGFibGUgPSBEYXRhVGFibGU7CgkkLmZuLmRhdGFUYWJsZVNldHRpbmdzID0gRGF0YVRhYmxlLnNldHRpbmdzOwoJJC5mbi5kYXRhVGFibGVFeHQgPSBEYXRhVGFibGUuZXh0OwoKCgkvLyBJbmZvcm1hdGlvbiBhYm91dCBldmVudHMgZmlyZWQgYnkgRGF0YVRhYmxlcyAtIGZvciBkb2N1bWVudGF0aW9uLgoJLyoqCgkgKiBEcmF3IGV2ZW50LCBmaXJlZCB3aGVuZXZlciB0aGUgdGFibGUgaXMgcmVkcmF3biBvbiB0aGUgcGFnZSwgYXQgdGhlIHNhbWUgcG9pbnQgYXMKCSAqIGZuRHJhd0NhbGxiYWNrLiBUaGlzIG1heSBiZSB1c2VmdWwgZm9yIGJpbmRpbmcgZXZlbnRzIG9yIHBlcmZvcm1pbmcgY2FsY3VsYXRpb25zIHdoZW4KCSAqIHRoZSB0YWJsZSBpcyBhbHRlcmVkIGF0IGFsbC4KCSAqICBAbmFtZSBEYXRhVGFibGUjZHJhdwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogRmlsdGVyIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSBmaWx0ZXJpbmcgYXBwbGllZCB0byB0aGUgdGFibGUgKHVzaW5nIHRoZSBidWlsZCBpbiBnbG9iYWwKCSAqIGdsb2JhbCBmaWx0ZXIsIG9yIGNvbHVtbiBmaWx0ZXJzKSBpcyBhbHRlcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNmaWx0ZXIKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIFBhZ2UgY2hhbmdlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSBwYWdpbmcgb2YgdGhlIHRhYmxlIGlzIGFsdGVyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3BhZ2UKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIFNvcnQgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHNvcnRpbmcgYXBwbGllZCB0byB0aGUgdGFibGUgaXMgYWx0ZXJlZC4KCSAqICBAbmFtZSBEYXRhVGFibGUjc29ydAoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogRGF0YVRhYmxlcyBpbml0aWFsaXNhdGlvbiBjb21wbGV0ZSBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaXMgZnVsbHkgZHJhd24sCgkgKiBpbmNsdWRpbmcgQWpheCBkYXRhIGxvYWRlZCwgaWYgQWpheCBkYXRhIGlzIHJlcXVpcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNpbml0CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBKU09OIG9iamVjdCByZXF1ZXN0IGZyb20gdGhlIHNlcnZlciAtIG9ubHkKCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZDwvbGk+PC9vbD4KCSAqLwoKCS8qKgoJICogU3RhdGUgc2F2ZSBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaGFzIGNoYW5nZWQgc3RhdGUgYSBuZXcgc3RhdGUgc2F2ZSBpcyByZXF1aXJlZC4KCSAqIFRoaXMgbWV0aG9kIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHN0YXRlIHNhdmluZyBvYmplY3QgcHJpb3IgdG8gYWN0dWFsbHkgZG9pbmcgdGhlCgkgKiBzYXZlLCBpbmNsdWRpbmcgYWRkaXRpb24gb3Igb3RoZXIgc3RhdGUgcHJvcGVydGllcyAoZm9yIHBsdWctaW5zKSBvciBtb2RpZmljYXRpb24KCSAqIG9mIGEgRGF0YVRhYmxlcyBjb3JlIHByb3BlcnR5LgoJICogIEBuYW1lIERhdGFUYWJsZSNzdGF0ZVNhdmVQYXJhbXMKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIHN0YXRlIGluZm9ybWF0aW9uIHRvIGJlIHNhdmVkCgkgKi8KCgkvKioKCSAqIFN0YXRlIGxvYWQgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHRhYmxlIGlzIGxvYWRpbmcgc3RhdGUgZnJvbSB0aGUgc3RvcmVkIGRhdGEsIGJ1dAoJICogcHJpb3IgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBiZWluZyBtb2RpZmllZCBieSB0aGUgc2F2ZWQgc3RhdGUgLSBhbGxvd2luZyBtb2RpZmljYXRpb24KCSAqIG9mIHRoZSBzYXZlZCBzdGF0ZSBpcyByZXF1aXJlZCBvciBsb2FkaW5nIG9mIHN0YXRlIGZvciBhIHBsdWctaW4uCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlTG9hZFBhcmFtcwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBUaGUgc2F2ZWQgc3RhdGUgaW5mb3JtYXRpb24KCSAqLwoKCS8qKgoJICogU3RhdGUgbG9hZGVkIGV2ZW50LCBmaXJlZCB3aGVuIHN0YXRlIGhhcyBiZWVuIGxvYWRlZCBmcm9tIHN0b3JlZCBkYXRhIGFuZCB0aGUgc2V0dGluZ3MKCSAqIG9iamVjdCBoYXMgYmVlbiBtb2RpZmllZCBieSB0aGUgbG9hZGVkIGRhdGEuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlTG9hZGVkCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBzYXZlZCBzdGF0ZSBpbmZvcm1hdGlvbgoJICovCgoJLyoqCgkgKiBQcm9jZXNzaW5nIGV2ZW50LCBmaXJlZCB3aGVuIERhdGFUYWJsZXMgaXMgZG9pbmcgc29tZSBraW5kIG9mIHByb2Nlc3NpbmcgKGJlIGl0LAoJICogc29ydCwgZmlsdGVyIG9yIGFueXRoaW5nIGVsc2UpLiBDYW4gYmUgdXNlZCB0byBpbmRpY2F0ZSB0byB0aGUgZW5kIHVzZXIgdGhhdAoJICogdGhlcmUgaXMgc29tZXRoaW5nIGhhcHBlbmluZywgb3IgdGhhdCBzb21ldGhpbmcgaGFzIGZpbmlzaGVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNwcm9jZXNzaW5nCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7Ym9vbGVhbn0gYlNob3cgRmxhZyBmb3IgaWYgRGF0YVRhYmxlcyBpcyBkb2luZyBwcm9jZXNzaW5nIG9yIG5vdAoJICovCgoJLyoqCgkgKiBBamF4IChYSFIpIGV2ZW50LCBmaXJlZCB3aGVuZXZlciBhbiBBamF4IHJlcXVlc3QgaXMgY29tcGxldGVkIGZyb20gYSByZXF1ZXN0IHRvIAoJICogbWFkZSB0byB0aGUgc2VydmVyIGZvciBuZXcgZGF0YSAobm90ZSB0aGF0IHRoaXMgdHJpZ2dlciBpcyBjYWxsZWQgaW4gZm5TZXJ2ZXJEYXRhLAoJICogaWYgeW91IG92ZXJyaWRlIGZuU2VydmVyRGF0YSBhbmQgd2hpY2ggdG8gdXNlIHRoaXMgZXZlbnQsIHlvdSBuZWVkIHRvIHRyaWdnZXIgaXQgaW4KCSAqIHlvdSBzdWNjZXNzIGZ1bmN0aW9uKS4KCSAqICBAbmFtZSBEYXRhVGFibGUjeGhyCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIEpTT04gcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyCgkgKi8KCgkvKioKCSAqIERlc3Ryb3kgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIERhdGFUYWJsZSBpcyBkZXN0cm95ZWQgYnkgY2FsbGluZyBmbkRlc3Ryb3kgb3IgcGFzc2luZwoJICogdGhlIGJEZXN0cm95OnRydWUgcGFyYW1ldGVyIGluIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QuIFRoaXMgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlCgkgKiBib3VuZCBldmVudHMsIGFkZGVkIERPTSBub2RlcywgZXRjLgoJICogIEBuYW1lIERhdGFUYWJsZSNkZXN0cm95CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCn0oalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpKTsK",
                "body": "LyoqCiAqIEBzdW1tYXJ5ICAgICBEYXRhVGFibGVzCiAqIEBkZXNjcmlwdGlvbiBQYWdpbmF0ZSwgc2VhcmNoIGFuZCBzb3J0IEhUTUwgdGFibGVzCiAqIEB2ZXJzaW9uICAgICAxLjkuMwogKiBAZmlsZSAgICAgICAganF1ZXJ5LmRhdGFUYWJsZXMuanMKICogQGF1dGhvciAgICAgIEFsbGFuIEphcmRpbmUgKHd3dy5zcHJ5bWVkaWEuY28udWspCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QKICoKICogQGNvcHlyaWdodCBDb3B5cmlnaHQgMjAwOC0yMDEyIEFsbGFuIEphcmRpbmUsIGFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZnJlZSBzb2Z0d2FyZSwgdW5kZXIgZWl0aGVyIHRoZSBHUEwgdjIgbGljZW5zZSBvciBhCiAqIEJTRCBzdHlsZSBsaWNlbnNlLCBhdmFpbGFibGUgYXQ6CiAqICAgaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2VfZ3BsMgogKiAgIGh0dHA6Ly9kYXRhdGFibGVzLm5ldC9saWNlbnNlX2JzZAogKiAKICogVGhpcyBzb3VyY2UgZmlsZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIAogKiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLgogKiAKICogRm9yIGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvOiBodHRwOi8vd3d3LmRhdGF0YWJsZXMubmV0CiAqLwoKLypqc2xpbnQgZXZpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIGJyb3dzZXI6IHRydWUgKi8KLypnbG9iYWxzICQsIGpRdWVyeSxfZm5FeHRlcm5BcGlGdW5jLF9mbkluaXRpYWxpc2UsX2ZuSW5pdENvbXBsZXRlLF9mbkxhbmd1YWdlQ29tcGF0LF9mbkFkZENvbHVtbixfZm5Db2x1bW5PcHRpb25zLF9mbkFkZERhdGEsX2ZuQ3JlYXRlVHIsX2ZuR2F0aGVyRGF0YSxfZm5CdWlsZEhlYWQsX2ZuRHJhd0hlYWQsX2ZuRHJhdyxfZm5SZURyYXcsX2ZuQWpheFVwZGF0ZSxfZm5BamF4UGFyYW1ldGVycyxfZm5BamF4VXBkYXRlRHJhdyxfZm5TZXJ2ZXJQYXJhbXMsX2ZuQWRkT3B0aW9uc0h0bWwsX2ZuRmVhdHVyZUh0bWxUYWJsZSxfZm5TY3JvbGxEcmF3LF9mbkFkanVzdENvbHVtblNpemluZyxfZm5GZWF0dXJlSHRtbEZpbHRlcixfZm5GaWx0ZXJDb21wbGV0ZSxfZm5GaWx0ZXJDdXN0b20sX2ZuRmlsdGVyQ29sdW1uLF9mbkZpbHRlcixfZm5CdWlsZFNlYXJjaEFycmF5LF9mbkJ1aWxkU2VhcmNoUm93LF9mbkZpbHRlckNyZWF0ZVNlYXJjaCxfZm5EYXRhVG9TZWFyY2gsX2ZuU29ydCxfZm5Tb3J0QXR0YWNoTGlzdGVuZXIsX2ZuU29ydGluZ0NsYXNzZXMsX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSxfZm5QYWdlQ2hhbmdlLF9mbkZlYXR1cmVIdG1sSW5mbyxfZm5VcGRhdGVJbmZvLF9mbkZlYXR1cmVIdG1sTGVuZ3RoLF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyxfZm5Qcm9jZXNzaW5nRGlzcGxheSxfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCxfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSxfZm5Ob2RlVG9EYXRhSW5kZXgsX2ZuVmlzYmxlQ29sdW1ucyxfZm5DYWxjdWxhdGVFbmQsX2ZuQ29udmVydFRvV2lkdGgsX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0LF9mbkdldFdpZGVzdE5vZGUsX2ZuR2V0TWF4TGVuU3RyaW5nLF9mblN0cmluZ1RvQ3NzLF9mbkRldGVjdFR5cGUsX2ZuU2V0dGluZ3NGcm9tTm9kZSxfZm5HZXREYXRhTWFzdGVyLF9mbkdldFRyTm9kZXMsX2ZuR2V0VGROb2RlcyxfZm5Fc2NhcGVSZWdleCxfZm5EZWxldGVJbmRleCxfZm5SZU9yZGVySW5kZXgsX2ZuQ29sdW1uT3JkZXJpbmcsX2ZuTG9nLF9mbkNsZWFyVGFibGUsX2ZuU2F2ZVN0YXRlLF9mbkxvYWRTdGF0ZSxfZm5DcmVhdGVDb29raWUsX2ZuUmVhZENvb2tpZSxfZm5EZXRlY3RIZWFkZXIsX2ZuR2V0VW5pcXVlVGhzLF9mblNjcm9sbEJhcldpZHRoLF9mbkFwcGx5VG9DaGlsZHJlbixfZm5NYXAsX2ZuR2V0Um93RGF0YSxfZm5HZXRDZWxsRGF0YSxfZm5TZXRDZWxsRGF0YSxfZm5HZXRPYmplY3REYXRhRm4sX2ZuU2V0T2JqZWN0RGF0YUZuLF9mbkFwcGx5Q29sdW1uRGVmcyxfZm5CaW5kQWN0aW9uLF9mbkNhbGxiYWNrUmVnLF9mbkNhbGxiYWNrRmlyZSxfZm5Kc29uU3RyaW5nLF9mblJlbmRlcixfZm5Ob2RlVG9Db2x1bW5JbmRleCxfZm5JbmZvTWFjcm9zLF9mbkJyb3dzZXJEZXRlY3QsX2ZuR2V0Q29sdW1ucyovCgooLyoqIEBsZW5kcyA8Z2xvYmFsPiAqL2Z1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewoJLyoqIAoJICogRGF0YVRhYmxlcyBpcyBhIHBsdWctaW4gZm9yIHRoZSBqUXVlcnkgSmF2YXNjcmlwdCBsaWJyYXJ5LiBJdCBpcyBhIAoJICogaGlnaGx5IGZsZXhpYmxlIHRvb2wsIGJhc2VkIHVwb24gdGhlIGZvdW5kYXRpb25zIG9mIHByb2dyZXNzaXZlIAoJICogZW5oYW5jZW1lbnQsIHdoaWNoIHdpbGwgYWRkIGFkdmFuY2VkIGludGVyYWN0aW9uIGNvbnRyb2xzIHRvIGFueSAKCSAqIEhUTUwgdGFibGUuIEZvciBhIGZ1bGwgbGlzdCBvZiBmZWF0dXJlcyBwbGVhc2UgcmVmZXIgdG8KCSAqIDxhIGhyZWY9Imh0dHA6Ly9kYXRhdGFibGVzLm5ldCI+RGF0YVRhYmxlcy5uZXQ8L2E+LgoJICoKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlPC9pPiBvYmplY3QgaXMgbm90IGEgZ2xvYmFsIHZhcmlhYmxlIGJ1dCBpcwoJICogYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uRGF0YVRhYmxlPC9pPiBhbmQgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZTwvaT4gdGhyb3VnaCB3aGljaCAKCSAqIGl0IG1heSBiZSAgYWNjZXNzZWQuCgkgKgoJICogIEBjbGFzcwoJICogIEBwYXJhbSB7b2JqZWN0fSBbb0luaXQ9e31dIENvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciBEYXRhVGFibGVzLiBPcHRpb25zCgkgKiAgICBhcmUgZGVmaW5lZCBieSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfQoJICogIEByZXF1aXJlcyBqUXVlcnkgMS4zKwoJICogCgkgKiAgQGV4YW1wbGUKCSAqICAgIC8vIEJhc2ljIGluaXRpYWxpc2F0aW9uCgkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gewoJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJICogICAgfSApOwoJICogIAoJICogIEBleGFtcGxlCgkgKiAgICAvLyBJbml0aWFsaXNhdGlvbiB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyAtIGluIHRoaXMgY2FzZSwgZGlzYWJsZQoJICogICAgLy8gcGFnaW5hdGlvbiBhbmQgc29ydGluZy4KCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiB7CgkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlLAoJICogICAgICAgICJiU29ydCI6IGZhbHNlIAoJICogICAgICB9ICk7CgkgKiAgICB9ICk7CgkgKi8KCXZhciBEYXRhVGFibGUgPSBmdW5jdGlvbiggb0luaXQgKQoJewoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhIGNvbHVtbiB0byB0aGUgbGlzdCB1c2VkIGZvciB0aGUgdGFibGUgd2l0aCBkZWZhdWx0IHZhbHVlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gblRoIFRoZSB0aCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncywgblRoICkKCQl7CgkJCXZhciBvRGVmYXVsdHMgPSBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uczsKCQkJdmFyIGlDb2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9Db2wgPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiwgb0RlZmF1bHRzLCB7CgkJCQkic1NvcnRpbmdDbGFzcyI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQkic1NvcnRpbmdDbGFzc0pVSSI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSSwKCQkJCSJuVGgiOiBuVGggPyBuVGggOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpLAoJCQkJInNUaXRsZSI6ICAgIG9EZWZhdWx0cy5zVGl0bGUgICAgPyBvRGVmYXVsdHMuc1RpdGxlICAgIDogblRoID8gblRoLmlubmVySFRNTCA6ICcnLAoJCQkJImFEYXRhU29ydCI6IG9EZWZhdWx0cy5hRGF0YVNvcnQgPyBvRGVmYXVsdHMuYURhdGFTb3J0IDogW2lDb2xdLAoJCQkJIm1EYXRhIjogb0RlZmF1bHRzLm1EYXRhID8gb0RlZmF1bHRzLm9EZWZhdWx0cyA6IGlDb2wKCQkJfSApOwoJCQlvU2V0dGluZ3MuYW9Db2x1bW5zLnB1c2goIG9Db2wgKTsKCQkJCgkJCS8qIEFkZCBhIGNvbHVtbiBzcGVjaWZpYyBmaWx0ZXIgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPT09IHVuZGVmaW5lZCB8fCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPT09IG51bGwgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF0gPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJdmFyIG9QcmUgPSBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sIF07CgkJCQkKCQkJCS8qIERvbid0IHJlcXVpcmUgdGhhdCB0aGUgdXNlciBtdXN0IHNwZWNpZnkgYlJlZ2V4LCBiU21hcnQgb3IgYkNhc2VJbnNlbnNpdGl2ZSAqLwoJCQkJaWYgKCBvUHJlLmJSZWdleCA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJSZWdleCA9IHRydWU7CgkJCQl9CgkJCQkKCQkJCWlmICggb1ByZS5iU21hcnQgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1ByZS5iU21hcnQgPSB0cnVlOwoJCQkJfQoJCQkJCgkJCQlpZiAoIG9QcmUuYkNhc2VJbnNlbnNpdGl2ZSA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJDYXNlSW5zZW5zaXRpdmUgPSB0cnVlOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBVc2UgdGhlIGNvbHVtbiBvcHRpb25zIGZ1bmN0aW9uIHRvIGluaXRpYWxpc2UgY2xhc3NlcyBldGMgKi8KCQkJX2ZuQ29sdW1uT3B0aW9ucyggb1NldHRpbmdzLCBpQ29sLCBudWxsICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFwcGx5IG9wdGlvbnMgZm9yIGEgY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgY29sdW1uIGluZGV4IHRvIGNvbnNpZGVyCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvT3B0aW9ucyBvYmplY3Qgd2l0aCBzVHlwZSwgYlZpc2libGUgYW5kIGJTZWFyY2hhYmxlIGV0YwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG9PcHRpb25zICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbCBdOwoJCQkKCQkJLyogVXNlciBzcGVjaWZpZWQgY29sdW1uIG9wdGlvbnMgKi8KCQkJaWYgKCBvT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIG9PcHRpb25zICE9PSBudWxsICkKCQkJewoJCQkJLyogQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZm9yIG1EYXRhUHJvcCAqLwoJCQkJaWYgKCBvT3B0aW9ucy5tRGF0YVByb3AgJiYgIW9PcHRpb25zLm1EYXRhICkKCQkJCXsKCQkJCQlvT3B0aW9ucy5tRGF0YSA9IG9PcHRpb25zLm1EYXRhUHJvcDsKCQkJCX0KCQkKCQkJCWlmICggb09wdGlvbnMuc1R5cGUgIT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb0NvbC5zVHlwZSA9IG9PcHRpb25zLnNUeXBlOwoJCQkJCW9Db2wuX2JBdXRvVHlwZSA9IGZhbHNlOwoJCQkJfQoJCQkJCgkJCQkkLmV4dGVuZCggb0NvbCwgb09wdGlvbnMgKTsKCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJzV2lkdGgiLCAic1dpZHRoT3JpZyIgKTsKCQkKCQkJCS8qIGlEYXRhU29ydCB0byBiZSBhcHBsaWVkIChiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSksIGJ1dCBhRGF0YVNvcnQgd2lsbCB0YWtlCgkJCQkgKiBwcmlvcml0eSBpZiBkZWZpbmVkCgkJCQkgKi8KCQkJCWlmICggb09wdGlvbnMuaURhdGFTb3J0ICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9Db2wuYURhdGFTb3J0ID0gWyBvT3B0aW9ucy5pRGF0YVNvcnQgXTsKCQkJCX0KCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJhRGF0YVNvcnQiICk7CgkJCX0KCQkKCQkJLyogQ2FjaGUgdGhlIGRhdGEgZ2V0IGFuZCBzZXQgZnVuY3Rpb25zIGZvciBzcGVlZCAqLwoJCQl2YXIgbVJlbmRlciA9IG9Db2wubVJlbmRlciA/IF9mbkdldE9iamVjdERhdGFGbiggb0NvbC5tUmVuZGVyICkgOiBudWxsOwoJCQl2YXIgbURhdGEgPSBfZm5HZXRPYmplY3REYXRhRm4oIG9Db2wubURhdGEgKTsKCQkKCQkJb0NvbC5mbkdldERhdGEgPSBmdW5jdGlvbiAob0RhdGEsIHNTcGVjaWZpYykgewoJCQkJdmFyIGlubmVyRGF0YSA9IG1EYXRhKCBvRGF0YSwgc1NwZWNpZmljICk7CgkJCgkJCQlpZiAoIG9Db2wubVJlbmRlciAmJiAoc1NwZWNpZmljICYmIHNTcGVjaWZpYyAhPT0gJycpICkKCQkJCXsKCQkJCQlyZXR1cm4gbVJlbmRlciggaW5uZXJEYXRhLCBzU3BlY2lmaWMsIG9EYXRhICk7CgkJCQl9CgkJCQlyZXR1cm4gaW5uZXJEYXRhOwoJCQl9OwoJCQlvQ29sLmZuU2V0RGF0YSA9IF9mblNldE9iamVjdERhdGFGbiggb0NvbC5tRGF0YSApOwoJCQkKCQkJLyogRmVhdHVyZSBzb3J0aW5nIG92ZXJyaWRlcyBjb2x1bW4gc3BlY2lmaWMgd2hlbiBvZmYgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCW9Db2wuYlNvcnRhYmxlID0gZmFsc2U7CgkJCX0KCQkJCgkJCS8qIENoZWNrIHRoYXQgdGhlIGNsYXNzIGFzc2lnbm1lbnQgaXMgY29ycmVjdCBmb3Igc29ydGluZyAqLwoJCQlpZiAoICFvQ29sLmJTb3J0YWJsZSB8fAoJCQkJICgkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEpICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZU5vbmU7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSAiIjsKCQkJfQoJCQllbHNlIGlmICggb0NvbC5iU29ydGFibGUgfHwKCQkJICAgICAgICAgICgkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEpICkKCQkJewoJCQkgIG9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGU7CgkJCSAgb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJOwoJCQl9CgkJCWVsc2UgaWYgKCAkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSAhPSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgKQoJCQl7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3MgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlQXNjOwoJCQkJb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJQXNjQWxsb3dlZDsKCQkJfQoJCQllbHNlIGlmICggJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpICE9IC0xICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZURlc2M7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUlEZXNjQWxsb3dlZDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGp1c3QgdGhlIHRhYmxlIGNvbHVtbiB3aWR0aHMgZm9yIG5ldyBkYXRhLiBOb3RlOiB5b3Ugd291bGQgcHJvYmFibHkgd2FudCB0byAKCQkgKiBkbyBhIHJlZHJhdyBhZnRlciBjYWxsaW5nIHRoaXMgZnVuY3Rpb24hCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWRqdXN0Q29sdW1uU2l6aW5nICggb1NldHRpbmdzICkKCQl7CgkJCS8qIE5vdCBpbnRlcmVzdGVkIGluIGRvaW5nIGNvbHVtbiB3aWR0aCBjYWxjdWxhdGlvbiBpZiBhdXRvLXdpZHRoIGlzIGRpc2FibGVkICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iQXV0b1dpZHRoID09PSBmYWxzZSApCgkJCXsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQkKCQkJX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzKCBvU2V0dGluZ3MgKTsKCQkJZm9yICggdmFyIGk9MCAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaC5zdHlsZS53aWR0aCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvdmVydCB0aGUgaW5kZXggb2YgYSB2aXNpYmxlIGNvbHVtbiB0byB0aGUgaW5kZXggaW4gdGhlIGRhdGEgYXJyYXkgKHRha2UgYWNjb3VudAoJCSAqIG9mIGhpZGRlbiBjb2x1bW5zKQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWF0Y2ggVmlzaWJsZSBjb2x1bW4gaW5kZXggdG8gbG9va3VwCgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIGRhdGEgaW5kZXgKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaU1hdGNoICkKCQl7CgkJCXZhciBhaVZpcyA9IF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgJ2JWaXNpYmxlJyApOwoJCQoJCQlyZXR1cm4gdHlwZW9mIGFpVmlzW2lNYXRjaF0gPT09ICdudW1iZXInID8KCQkJCWFpVmlzW2lNYXRjaF0gOgoJCQkJbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogQ292ZXJ0IHRoZSBpbmRleCBvZiBhbiBpbmRleCBpbiB0aGUgZGF0YSBhcnJheSBhbmQgY29udmVydCBpdCB0byB0aGUgdmlzaWJsZQoJCSAqICAgY29sdW1uIGluZGV4ICh0YWtlIGFjY291bnQgb2YgaGlkZGVuIGNvbHVtbnMpCgkJICogIEBwYXJhbSB7aW50fSBpTWF0Y2ggQ29sdW1uIGluZGV4IHRvIGxvb2t1cAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIGRhdGEgaW5kZXgKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUoIG9TZXR0aW5ncywgaU1hdGNoICkKCQl7CgkJCXZhciBhaVZpcyA9IF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgJ2JWaXNpYmxlJyApOwoJCQl2YXIgaVBvcyA9ICQuaW5BcnJheSggaU1hdGNoLCBhaVZpcyApOwoJCQoJCQlyZXR1cm4gaVBvcyAhPT0gLTEgPyBpUG9zIDogbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgdmlzaWJsZSBjb2x1bW5zCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2ludH0gaSB0aGUgbnVtYmVyIG9mIHZpc2libGUgY29sdW1ucwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKQoJCXsKCQkJcmV0dXJuIF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgJ2JWaXNpYmxlJyApLmxlbmd0aDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IGFuIGFycmF5IG9mIGNvbHVtbiBpbmRleGVzIHRoYXQgbWF0Y2ggYSBnaXZlbiBwcm9wZXJ0eQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUGFyYW0gUGFyYW1ldGVyIGluIGFvQ29sdW1ucyB0byBsb29rIGZvciAtIHR5cGljYWxseSAKCQkgKiAgICBiVmlzaWJsZSBvciBiU2VhcmNoYWJsZQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IEFycmF5IG9mIGluZGV4ZXMgd2l0aCBtYXRjaGVkIHByb3BlcnRpZXMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Q29sdW1ucyggb1NldHRpbmdzLCBzUGFyYW0gKQoJCXsKCQkJdmFyIGEgPSBbXTsKCQkKCQkJJC5tYXAoIG9TZXR0aW5ncy5hb0NvbHVtbnMsIGZ1bmN0aW9uKHZhbCwgaSkgewoJCQkJaWYgKCB2YWxbc1BhcmFtXSApIHsKCQkJCQlhLnB1c2goIGkgKTsKCQkJCX0KCQkJfSApOwoJCQoJCQlyZXR1cm4gYTsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBzb3J0IHR5cGUgYmFzZWQgb24gYW4gaW5wdXQgc3RyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRGF0YSBkYXRhIHdlIHdpc2ggdG8ga25vdyB0aGUgdHlwZSBvZgoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSB0eXBlIChkZWZhdWx0cyB0byAnc3RyaW5nJyBpZiBubyB0eXBlIGNhbiBiZSBkZXRlY3RlZCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRGV0ZWN0VHlwZSggc0RhdGEgKQoJCXsKCQkJdmFyIGFUeXBlcyA9IERhdGFUYWJsZS5leHQuYVR5cGVzOwoJCQl2YXIgaUxlbiA9IGFUeXBlcy5sZW5ndGg7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJdmFyIHNUeXBlID0gYVR5cGVzW2ldKCBzRGF0YSApOwoJCQkJaWYgKCBzVHlwZSAhPT0gbnVsbCApCgkJCQl7CgkJCQkJcmV0dXJuIHNUeXBlOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gJ3N0cmluZyc7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpZ3VyZSBvdXQgaG93IHRvIHJlb3JkZXIgYSBkaXNwbGF5IGxpc3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyBhcnJheSB7aW50fSBhaVJldHVybiBpbmRleCBsaXN0IGZvciByZW9yZGVyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlT3JkZXJJbmRleCAoIG9TZXR0aW5ncywgc0NvbHVtbnMgKQoJCXsKCQkJdmFyIGFDb2x1bW5zID0gc0NvbHVtbnMuc3BsaXQoJywnKTsKCQkJdmFyIGFpUmV0dXJuID0gW107CgkJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggdmFyIGo9MCA7IGo8aUxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNOYW1lID09IGFDb2x1bW5zW2pdICkKCQkJCQl7CgkJCQkJCWFpUmV0dXJuLnB1c2goIGogKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gYWlSZXR1cm47CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgY29sdW1uIG9yZGVyaW5nIHRoYXQgRGF0YVRhYmxlcyBleHBlY3RzCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge3N0cmluZ30gY29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgbmFtZXMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29sdW1uT3JkZXJpbmcgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIHNOYW1lcyA9ICcnOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJc05hbWVzICs9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc05hbWUrJywnOwoJCQl9CgkJCWlmICggc05hbWVzLmxlbmd0aCA9PSBpTGVuICkKCQkJewoJCQkJcmV0dXJuICIiOwoJCQl9CgkJCXJldHVybiBzTmFtZXMuc2xpY2UoMCwgLTEpOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBUYWtlIHRoZSBjb2x1bW4gZGVmaW5pdGlvbnMgYW5kIHN0YXRpYyBjb2x1bW5zIGFycmF5cyBhbmQgY2FsY3VsYXRlIGhvdwoJCSAqIHRoZXkgcmVsYXRlIHRvIGNvbHVtbiBpbmRleGVzLiBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gd2lsbCB0aGVuIGFwcGx5IHRoZQoJCSAqIGRlZmluaXRpb24gZm91bmQgZm9yIGEgY29sdW1uIHRvIGEgc3VpdGFibGUgY29uZmlndXJhdGlvbiBvYmplY3QuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHthcnJheX0gYW9Db2xEZWZzIFRoZSBhb0NvbHVtbkRlZnMgYXJyYXkgdGhhdCBpcyB0byBiZSBhcHBsaWVkCgkJICogIEBwYXJhbSB7YXJyYXl9IGFvQ29scyBUaGUgYW9Db2x1bW5zIGFycmF5IHRoYXQgZGVmaW5lcyBjb2x1bW5zIGluZGl2aWR1YWxseQoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBmbiBDYWxsYmFjayBmdW5jdGlvbiAtIHRha2VzIHR3byBwYXJhbWV0ZXJzLCB0aGUgY2FsY3VsYXRlZAoJCSAqICAgIGNvbHVtbiBpbmRleCBhbmQgdGhlIGRlZmluaXRpb24gZm9yIHRoYXQgY29sdW1uLgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BcHBseUNvbHVtbkRlZnMoIG9TZXR0aW5ncywgYW9Db2xEZWZzLCBhb0NvbHMsIGZuICkKCQl7CgkJCXZhciBpLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuOwoJCQoJCQkvLyBDb2x1bW4gZGVmaW5pdGlvbnMgd2l0aCBhVGFyZ2V0cwoJCQlpZiAoIGFvQ29sRGVmcyApCgkJCXsKCQkJCS8qIExvb3Agb3ZlciB0aGUgZGVmaW5pdGlvbnMgYXJyYXkgLSBsb29wIGluIHJldmVyc2Ugc28gZmlyc3QgaW5zdGFuY2UgaGFzIHByaW9yaXR5ICovCgkJCQlmb3IgKCBpPWFvQ29sRGVmcy5sZW5ndGgtMSA7IGk+PTAgOyBpLS0gKQoJCQkJewoJCQkJCS8qIEVhY2ggZGVmaW5pdGlvbiBjYW4gdGFyZ2V0IG11bHRpcGxlIGNvbHVtbnMsIGFzIGl0IGlzIGFuIGFycmF5ICovCgkJCQkJdmFyIGFUYXJnZXRzID0gYW9Db2xEZWZzW2ldLmFUYXJnZXRzOwoJCQkJCWlmICggISQuaXNBcnJheSggYVRhcmdldHMgKSApCgkJCQkJewoJCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMSwgJ2FUYXJnZXRzIG11c3QgYmUgYW4gYXJyYXkgb2YgdGFyZ2V0cywgbm90IGEgJysodHlwZW9mIGFUYXJnZXRzKSApOwoJCQkJCX0KCQkKCQkJCQlmb3IgKCBqPTAsIGpMZW49YVRhcmdldHMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQl7CgkJCQkJCWlmICggdHlwZW9mIGFUYXJnZXRzW2pdID09PSAnbnVtYmVyJyAmJiBhVGFyZ2V0c1tqXSA+PSAwICkKCQkJCQkJewoJCQkJCQkJLyogQWRkIGNvbHVtbnMgdGhhdCB3ZSBkb24ndCB5ZXQga25vdyBhYm91dCAqLwoJCQkJCQkJd2hpbGUoIG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDw9IGFUYXJnZXRzW2pdICkKCQkJCQkJCXsKCQkJCQkJCQlfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncyApOwoJCQkJCQkJfQoJCQoJCQkJCQkJLyogSW50ZWdlciwgYmFzaWMgaW5kZXggKi8KCQkJCQkJCWZuKCBhVGFyZ2V0c1tqXSwgYW9Db2xEZWZzW2ldICk7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHR5cGVvZiBhVGFyZ2V0c1tqXSA9PT0gJ251bWJlcicgJiYgYVRhcmdldHNbal0gPCAwICkKCQkJCQkJewoJCQkJCQkJLyogTmVnYXRpdmUgaW50ZWdlciwgcmlnaHQgdG8gbGVmdCBjb2x1bW4gY291bnRpbmcgKi8KCQkJCQkJCWZuKCBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCthVGFyZ2V0c1tqXSwgYW9Db2xEZWZzW2ldICk7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHR5cGVvZiBhVGFyZ2V0c1tqXSA9PT0gJ3N0cmluZycgKQoJCQkJCQl7CgkJCQkJCQkvKiBDbGFzcyBuYW1lIG1hdGNoaW5nIG9uIFRIIGVsZW1lbnQgKi8KCQkJCQkJCWZvciAoIGs9MCwga0xlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGs8a0xlbiA7IGsrKyApCgkJCQkJCQl7CgkJCQkJCQkJaWYgKCBhVGFyZ2V0c1tqXSA9PSAiX2FsbCIgfHwKCQkJCQkJCQkgICAgICQob1NldHRpbmdzLmFvQ29sdW1uc1trXS5uVGgpLmhhc0NsYXNzKCBhVGFyZ2V0c1tqXSApICkKCQkJCQkJCQl7CgkJCQkJCQkJCWZuKCBrLCBhb0NvbERlZnNbaV0gKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJLy8gU3RhdGljYWxseSBkZWZpbmVkIGNvbHVtbnMgYXJyYXkKCQkJaWYgKCBhb0NvbHMgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9Db2xzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJZm4oIGksIGFvQ29sc1tpXSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhIGRhdGEgYXJyYXkgdG8gdGhlIHRhYmxlLCBjcmVhdGluZyBET00gbm9kZSBldGMuIFRoaXMgaXMgdGhlIHBhcmFsbGVsIHRvIAoJCSAqIF9mbkdhdGhlckRhdGEsIGJ1dCBmb3IgYWRkaW5nIHJvd3MgZnJvbSBhIEphdmFzY3JpcHQgc291cmNlLCByYXRoZXIgdGhhbiBhCgkJICogRE9NIHNvdXJjZS4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBkYXRhIGFycmF5IHRvIGJlIGFkZGVkCgkJICogIEByZXR1cm5zIHtpbnR9ID49MCBpZiBzdWNjZXNzZnVsIChpbmRleCBvZiBuZXcgYW9EYXRhIGVudHJ5KSwgLTEgaWYgZmFpbGVkCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkZERhdGEgKCBvU2V0dGluZ3MsIGFEYXRhU3VwcGxpZWQgKQoJCXsKCQkJdmFyIG9Db2w7CgkJCQoJCQkvKiBUYWtlIGFuIGluZGVwZW5kZW50IGNvcHkgb2YgdGhlIGRhdGEgc291cmNlIHNvIHdlIGNhbiBiYXNoIGl0IGFib3V0IGFzIHdlIHdpc2ggKi8KCQkJdmFyIGFEYXRhSW4gPSAoJC5pc0FycmF5KGFEYXRhU3VwcGxpZWQpKSA/CgkJCQlhRGF0YVN1cHBsaWVkLnNsaWNlKCkgOgoJCQkJJC5leHRlbmQoIHRydWUsIHt9LCBhRGF0YVN1cHBsaWVkICk7CgkJCQoJCQkvKiBDcmVhdGUgdGhlIG9iamVjdCBmb3Igc3RvcmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGlzIG5ldyByb3cgKi8KCQkJdmFyIGlSb3cgPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJdmFyIG9EYXRhID0gJC5leHRlbmQoIHRydWUsIHt9LCBEYXRhVGFibGUubW9kZWxzLm9Sb3cgKTsKCQkJb0RhdGEuX2FEYXRhID0gYURhdGFJbjsKCQkJb1NldHRpbmdzLmFvRGF0YS5wdXNoKCBvRGF0YSApOwoJCQoJCQkvKiBDcmVhdGUgdGhlIGNlbGxzICovCgkJCXZhciBuVGQsIHNUaGlzVHlwZTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldOwoJCQoJCQkJLyogVXNlIHJlbmRlcmVkIGRhdGEgZm9yIGZpbHRlcmluZyAvIHNvcnRpbmcgKi8KCQkJCWlmICggdHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgb0NvbC5iVXNlUmVuZGVyZWQgJiYgb0NvbC5tRGF0YSAhPT0gbnVsbCApCgkJCQl7CgkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgX2ZuUmVuZGVyKG9TZXR0aW5ncywgaVJvdywgaSkgKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICkgKTsKCQkJCX0KCQkJCQoJCQkJLyogU2VlIGlmIHdlIHNob3VsZCBhdXRvLWRldGVjdCB0aGUgY29sdW1uIHR5cGUgKi8KCQkJCWlmICggb0NvbC5fYkF1dG9UeXBlICYmIG9Db2wuc1R5cGUgIT0gJ3N0cmluZycgKQoJCQkJewoJCQkJCS8qIEF0dGVtcHQgdG8gYXV0byBkZXRlY3QgdGhlIHR5cGUgLSBzYW1lIGFzIF9mbkdhdGhlckRhdGEoKSAqLwoJCQkJCXZhciBzVmFyVHlwZSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksICd0eXBlJyApOwoJCQkJCWlmICggc1ZhclR5cGUgIT09IG51bGwgJiYgc1ZhclR5cGUgIT09ICcnICkKCQkJCQl7CgkJCQkJCXNUaGlzVHlwZSA9IF9mbkRldGVjdFR5cGUoIHNWYXJUeXBlICk7CgkJCQkJCWlmICggb0NvbC5zVHlwZSA9PT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuc1R5cGUgPSBzVGhpc1R5cGU7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIG9Db2wuc1R5cGUgIT0gc1RoaXNUeXBlICYmIG9Db2wuc1R5cGUgIT0gImh0bWwiICkKCQkJCQkJewoJCQkJCQkJLyogU3RyaW5nIGlzIGFsd2F5cyB0aGUgJ2ZhbGxiYWNrJyBvcHRpb24gKi8KCQkJCQkJCW9Db2wuc1R5cGUgPSAnc3RyaW5nJzsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogQWRkIHRvIHRoZSBkaXNwbGF5IGFycmF5ICovCgkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVJvdyApOwoJCQoJCQkvKiBDcmVhdGUgdGhlIERPTSBpbWZvcm1hdGlvbiAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mbkNyZWF0ZVRyKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkJfQoJCQoJCQlyZXR1cm4gaVJvdzsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVhZCBpbiB0aGUgZGF0YSBmcm9tIHRoZSB0YXJnZXQgdGFibGUgZnJvbSB0aGUgRE9NCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2F0aGVyRGF0YSggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpTG9vcCwgaSwgaUxlbiwgaiwgakxlbiwgaklubmVyLAoJCQkgCW5UZHMsIG5UcnMsIG5UZCwgYUxvY2FsRGF0YSwgaVRoaXNJbmRleCwKCQkJCWlSb3csIGlSb3dzLCBpQ29sdW1uLCBpQ29sdW1ucywgc05vZGVOYW1lLAoJCQkJb0NvbCwgb0RhdGE7CgkJCQoJCQkvKgoJCQkgKiBQcm9jZXNzIGJ5IHJvdyBmaXJzdAoJCQkgKiBBZGQgdGhlIGRhdGEgb2JqZWN0IGZvciB0aGUgd2hvbGUgdGFibGUgLSBzdG9yaW5nIHRoZSB0ciBub2RlLiBOb3RlIC0gbm8gcG9pbnQgaW4gZ2V0dGluZwoJCQkgKiBET00gYmFzZWQgZGF0YSBpZiB3ZSBhcmUgZ29pbmcgdG8gZ28gYW5kIHJlcGxhY2UgaXQgd2l0aCBBamF4IHNvdXJjZSBkYXRhLgoJCQkgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyB8fCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UgPT09IG51bGwgKQoJCQl7CgkJCQluVHJzID0gb1NldHRpbmdzLm5UQm9keS5jaGlsZE5vZGVzOwoJCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG5UcnNbaV0ubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVFIiICkKCQkJCQl7CgkJCQkJCWlUaGlzSW5kZXggPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJCQkJblRyc1tpXS5fRFRfUm93SW5kZXggPSBpVGhpc0luZGV4OwoJCQkJCQlvU2V0dGluZ3MuYW9EYXRhLnB1c2goICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vUm93LCB7CgkJCQkJCQkiblRyIjogblRyc1tpXQoJCQkJCQl9ICkgKTsKCQkJCQkJCgkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVRoaXNJbmRleCApOwoJCQkJCQluVGRzID0gblRyc1tpXS5jaGlsZE5vZGVzOwoJCQkJCQlqSW5uZXIgPSAwOwoJCQkJCQkKCQkJCQkJZm9yICggaj0wLCBqTGVuPW5UZHMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQkJewoJCQkJCQkJc05vZGVOYW1lID0gblRkc1tqXS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpOwoJCQkJCQkJaWYgKCBzTm9kZU5hbWUgPT0gIlREIiB8fCBzTm9kZU5hbWUgPT0gIlRIIiApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVRoaXNJbmRleCwgaklubmVyLCAkLnRyaW0oblRkc1tqXS5pbm5lckhUTUwpICk7CgkJCQkJCQkJaklubmVyKys7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEdhdGhlciBpbiB0aGUgVEQgZWxlbWVudHMgb2YgdGhlIFRhYmxlIC0gbm90ZSB0aGF0IHRoaXMgaXMgYmFzaWNhbGx5IHRoZSBzYW1lIGFzCgkJCSAqIGZuR2V0VGROb2RlcywgYnV0IHRoYXQgZnVuY3Rpb24gdGFrZXMgYWNjb3VudCBvZiBoaWRkZW4gY29sdW1ucywgd2hpY2ggd2UgaGF2ZW4ndCB5ZXQKCQkJICogc2V0dXAhCgkJCSAqLwoJCQluVHJzID0gX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICk7CgkJCW5UZHMgPSBbXTsKCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggaj0wLCBqTGVuPW5UcnNbaV0uY2hpbGROb2Rlcy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCW5UZCA9IG5UcnNbaV0uY2hpbGROb2Rlc1tqXTsKCQkJCQlzTm9kZU5hbWUgPSBuVGQubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVEQiIHx8IHNOb2RlTmFtZSA9PSAiVEgiICkKCQkJCQl7CgkJCQkJCW5UZHMucHVzaCggblRkICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBOb3cgcHJvY2VzcyBieSBjb2x1bW4gKi8KCQkJZm9yICggaUNvbHVtbj0wLCBpQ29sdW1ucz1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGlDb2x1bW48aUNvbHVtbnMgOyBpQ29sdW1uKysgKQoJCQl7CgkJCQlvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkKCQkJCS8qIEdldCB0aGUgdGl0bGUgb2YgdGhlIGNvbHVtbiAtIHVubGVzcyB0aGVyZSBpcyBhIHVzZXIgc2V0IG9uZSAqLwoJCQkJaWYgKCBvQ29sLnNUaXRsZSA9PT0gbnVsbCApCgkJCQl7CgkJCQkJb0NvbC5zVGl0bGUgPSBvQ29sLm5UaC5pbm5lckhUTUw7CgkJCQl9CgkJCQkKCQkJCXZhcgoJCQkJCWJBdXRvVHlwZSA9IG9Db2wuX2JBdXRvVHlwZSwKCQkJCQliUmVuZGVyID0gdHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicsCgkJCQkJYkNsYXNzID0gb0NvbC5zQ2xhc3MgIT09IG51bGwsCgkJCQkJYlZpc2libGUgPSBvQ29sLmJWaXNpYmxlLAoJCQkJCW5DZWxsLCBzVGhpc1R5cGUsIHNSZW5kZXJlZCwgc1ZhbFR5cGU7CgkJCQkKCQkJCS8qIEEgc2luZ2xlIGxvb3AgdG8gcnVsZSB0aGVtIGFsbCAoYW5kIGJlIG1vcmUgZWZmaWNpZW50KSAqLwoJCQkJaWYgKCBiQXV0b1R5cGUgfHwgYlJlbmRlciB8fCBiQ2xhc3MgfHwgIWJWaXNpYmxlICkKCQkJCXsKCQkJCQlmb3IgKCBpUm93PTAsIGlSb3dzPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaVJvdzxpUm93cyA7IGlSb3crKyApCgkJCQkJewoJCQkJCQlvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCQkJCW5DZWxsID0gblRkc1sgKGlSb3cqaUNvbHVtbnMpICsgaUNvbHVtbiBdOwoJCQkJCQkKCQkJCQkJLyogVHlwZSBkZXRlY3Rpb24gKi8KCQkJCQkJaWYgKCBiQXV0b1R5cGUgJiYgb0NvbC5zVHlwZSAhPSAnc3RyaW5nJyApCgkJCQkJCXsKCQkJCQkJCXNWYWxUeXBlID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ3R5cGUnICk7CgkJCQkJCQlpZiAoIHNWYWxUeXBlICE9PSAnJyApCgkJCQkJCQl7CgkJCQkJCQkJc1RoaXNUeXBlID0gX2ZuRGV0ZWN0VHlwZSggc1ZhbFR5cGUgKTsKCQkJCQkJCQlpZiAoIG9Db2wuc1R5cGUgPT09IG51bGwgKQoJCQkJCQkJCXsKCQkJCQkJCQkJb0NvbC5zVHlwZSA9IHNUaGlzVHlwZTsKCQkJCQkJCQl9CgkJCQkJCQkJZWxzZSBpZiAoIG9Db2wuc1R5cGUgIT0gc1RoaXNUeXBlICYmIAoJCQkJCQkJCSAgICAgICAgICBvQ29sLnNUeXBlICE9ICJodG1sIiApCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBTdHJpbmcgaXMgYWx3YXlzIHRoZSAnZmFsbGJhY2snIG9wdGlvbiAqLwoJCQkJCQkJCQlvQ29sLnNUeXBlID0gJ3N0cmluZyc7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCgkJCQkJCWlmICggdHlwZW9mIG9Db2wubURhdGEgPT09ICdmdW5jdGlvbicgKQoJCQkJCQl7CgkJCQkJCQluQ2VsbC5pbm5lckhUTUwgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKTsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogUmVuZGVyaW5nICovCgkJCQkJCWlmICggYlJlbmRlciApCgkJCQkJCXsKCQkJCQkJCXNSZW5kZXJlZCA9IF9mblJlbmRlciggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uICk7CgkJCQkJCQluQ2VsbC5pbm5lckhUTUwgPSBzUmVuZGVyZWQ7CgkJCQkJCQlpZiAoIG9Db2wuYlVzZVJlbmRlcmVkICkKCQkJCQkJCXsKCQkJCQkJCQkvKiBVc2UgdGhlIHJlbmRlcmVkIGRhdGEgZm9yIGZpbHRlcmluZyAvIHNvcnRpbmcgKi8KCQkJCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCBzUmVuZGVyZWQgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogQ2xhc3NlcyAqLwoJCQkJCQlpZiAoIGJDbGFzcyApCgkJCQkJCXsKCQkJCQkJCW5DZWxsLmNsYXNzTmFtZSArPSAnICcrb0NvbC5zQ2xhc3M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIENvbHVtbiB2aXNpYmlsaXR5ICovCgkJCQkJCWlmICggIWJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbkNlbGw7CgkJCQkJCQluQ2VsbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuQ2VsbCApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbnVsbDsKCQkJCQkJfQoJCQoJCQkJCQlpZiAoIG9Db2wuZm5DcmVhdGVkQ2VsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJCW5DZWxsLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpQ29sdW1uCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8qIFJvdyBjcmVhdGVkIGNhbGxiYWNrcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5hb1Jvd0NyZWF0ZWRDYWxsYmFjay5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpXTsKCQkJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUm93Q3JlYXRlZENhbGxiYWNrJywgbnVsbCwgW29EYXRhLm5Uciwgb0RhdGEuX2FEYXRhLCBpXSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFRha2UgYSBUUiBlbGVtZW50IGFuZCBjb252ZXJ0IGl0IHRvIGFuIGluZGV4IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0aGUgVFIgZWxlbWVudCB0byBmaW5kCgkJICogIEByZXR1cm5zIHtpbnR9IGluZGV4IGlmIHRoZSBub2RlIGlzIGZvdW5kLCBudWxsIGlmIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ob2RlVG9EYXRhSW5kZXgoIG9TZXR0aW5ncywgbiApCgkJewoJCQlyZXR1cm4gKG4uX0RUX1Jvd0luZGV4IT09dW5kZWZpbmVkKSA/IG4uX0RUX1Jvd0luZGV4IDogbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSBhIFREIGVsZW1lbnQgYW5kIGNvbnZlcnQgaXQgaW50byBhIGNvbHVtbiBkYXRhIGluZGV4IChub3QgdGhlIHZpc2libGUgaW5kZXgpCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBudW1iZXIgdGhlIFREL1RIIGNhbiBiZSBmb3VuZCBpbgoJCSAqICBAcGFyYW0ge25vZGV9IG4gVGhlIFREL1RIIGVsZW1lbnQgdG8gZmluZAoJCSAqICBAcmV0dXJucyB7aW50fSBpbmRleCBpZiB0aGUgbm9kZSBpcyBmb3VuZCwgLTEgaWYgbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk5vZGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlSb3csIG4gKQoJCXsKCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5DZWxsc1tpXSA9PT0gbiApCgkJCQl7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIC0xOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgZGF0YSBmb3IgYSBnaXZlbiByb3cgZnJvbSB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgndHlwZScgJ2ZpbHRlcicgJ3NvcnQnKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhaUNvbHVtbnMgQXJyYXkgb2YgY29sdW1uIGluZGV4ZXMgdG8gZ2V0IGRhdGEgZnJvbQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpUm93LCBzU3BlY2lmaWMsIGFpQ29sdW1ucyApCgkJewoJCQl2YXIgb3V0ID0gW107CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YWlDb2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW91dC5wdXNoKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBhaUNvbHVtbnNbaV0sIHNTcGVjaWZpYyApICk7CgkJCX0KCQkJcmV0dXJuIG91dDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBkYXRhIGZvciBhIGdpdmVuIGNlbGwgZnJvbSB0aGUgaW50ZXJuYWwgY2FjaGUsIHRha2luZyBpbnRvIGFjY291bnQgZGF0YSBtYXBwaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIHJvdyBpZAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBDb2x1bW4gaW5kZXgKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgnZGlzcGxheScsICd0eXBlJyAnZmlsdGVyJyAnc29ydCcpCgkJICogIEByZXR1cm5zIHsqfSBDZWxsIGRhdGEKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgc1NwZWNpZmljICkKCQl7CgkJCXZhciBzRGF0YTsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJaWYgKCAoc0RhdGE9b0NvbC5mbkdldERhdGEoIG9EYXRhLCBzU3BlY2lmaWMgKSkgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmlEcmF3RXJyb3IgIT0gb1NldHRpbmdzLmlEcmF3ICYmIG9Db2wuc0RlZmF1bHRDb250ZW50ID09PSBudWxsICkKCQkJCXsKCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJlcXVlc3RlZCB1bmtub3duIHBhcmFtZXRlciAiKwoJCQkJCQkodHlwZW9mIG9Db2wubURhdGE9PSdmdW5jdGlvbicgPyAne21EYXRhIGZ1bmN0aW9ufScgOiAiJyIrb0NvbC5tRGF0YSsiJyIpKwoJCQkJCQkiIGZyb20gdGhlIGRhdGEgc291cmNlIGZvciByb3cgIitpUm93ICk7CgkJCQkJb1NldHRpbmdzLmlEcmF3RXJyb3IgPSBvU2V0dGluZ3MuaURyYXc7CgkJCQl9CgkJCQlyZXR1cm4gb0NvbC5zRGVmYXVsdENvbnRlbnQ7CgkJCX0KCQkKCQkJLyogV2hlbiB0aGUgZGF0YSBzb3VyY2UgaXMgbnVsbCwgd2UgY2FuIHVzZSBkZWZhdWx0IGNvbHVtbiBkYXRhICovCgkJCWlmICggc0RhdGEgPT09IG51bGwgJiYgb0NvbC5zRGVmYXVsdENvbnRlbnQgIT09IG51bGwgKQoJCQl7CgkJCQlzRGF0YSA9IG9Db2wuc0RlZmF1bHRDb250ZW50OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICdmdW5jdGlvbicgKQoJCQl7CgkJCQkvKiBJZiB0aGUgZGF0YSBzb3VyY2UgaXMgYSBmdW5jdGlvbiwgdGhlbiB3ZSBydW4gaXQgYW5kIHVzZSB0aGUgcmV0dXJuICovCgkJCQlyZXR1cm4gc0RhdGEoKTsKCQkJfQoJCQoJCQlpZiAoIHNTcGVjaWZpYyA9PSAnZGlzcGxheScgJiYgc0RhdGEgPT09IG51bGwgKQoJCQl7CgkJCQlyZXR1cm4gJyc7CgkJCX0KCQkJcmV0dXJuIHNEYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZXQgdGhlIHZhbHVlIGZvciBhIHNwZWNpZmljIGNlbGwsIGludG8gdGhlIGludGVybmFsIGRhdGEgY2FjaGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgcm93IGlkCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIENvbHVtbiBpbmRleAoJCSAqICBAcGFyYW0geyp9IHZhbCBWYWx1ZSB0byBzZXQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgdmFsICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sXTsKCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGE7CgkJCgkJCW9Db2wuZm5TZXREYXRhKCBvRGF0YSwgdmFsICk7CgkJfQoJCQoJCQoJCS8vIFByaXZhdGUgdmFyaWFibGUgdGhhdCBpcyB1c2VkIHRvIG1hdGNoIGFycmF5IHN5bnRheCBpbiB0aGUgZGF0YSBwcm9wZXJ0eSBvYmplY3QKCQl2YXIgX19yZUFycmF5ID0gL1xbLio/XF0kLzsKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGdldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIGdldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogR2l2ZSBhbiBlbXB0eSBzdHJpbmcgZm9yIHJlbmRlcmluZyAvIHNvcnRpbmcgZXRjICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHR5cGUpIHsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX07CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBleHRyYSkgewoJCQkJCXJldHVybiBtU291cmNlKCBkYXRhLCB0eXBlLCBleHRyYSApOwoJCQkJfTsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIG1Tb3VyY2UgPT09ICdzdHJpbmcnICYmIChtU291cmNlLmluZGV4T2YoJy4nKSAhPT0gLTEgfHwgbVNvdXJjZS5pbmRleE9mKCdbJykgIT09IC0xKSApCgkJCXsKCQkJCS8qIElmIHRoZXJlIGlzIGEgLiBpbiB0aGUgc291cmNlIHN0cmluZyB0aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBpbiBhIAoJCQkJICogbmVzdGVkIG9iamVjdCBzbyB3ZSBsb29wIG92ZXIgdGhlIGRhdGEgZm9yIGVhY2ggbGV2ZWwgdG8gZ2V0IHRoZSBuZXh0CgkJCQkgKiBsZXZlbCBkb3duLiBPbiBlYWNoIGxvb3Agd2UgdGVzdCBmb3IgdW5kZWZpbmVkLCBhbmQgaWYgZm91bmQgaW1tZWRpYXRlbHkKCQkJCSAqIHJldHVybi4gVGhpcyBhbGxvd3MgZW50aXJlIG9iamVjdHMgdG8gYmUgbWlzc2luZyBhbmQgc0RlZmF1bHRDb250ZW50IHRvCgkJCQkgKiBiZSB1c2VkIGlmIGRlZmluZWQsIHJhdGhlciB0aGFuIHRocm93aW5nIGFuIGVycm9yCgkJCQkgKi8KCQkJCXZhciBmZXRjaERhdGEgPSBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgc3JjKSB7CgkJCQkJdmFyIGEgPSBzcmMuc3BsaXQoJy4nKTsKCQkJCQl2YXIgYXJyYXlOb3RhdGlvbiwgb3V0LCBpbm5lclNyYzsKCQkKCQkJCQlpZiAoIHNyYyAhPT0gIiIgKQoJCQkJCXsKCQkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCS8vIENoZWNrIGlmIHdlIGFyZSBkZWFsaW5nIHdpdGggYW4gYXJyYXkgbm90YXRpb24gcmVxdWVzdAoJCQkJCQkJYXJyYXlOb3RhdGlvbiA9IGFbaV0ubWF0Y2goX19yZUFycmF5KTsKCQkKCQkJCQkJCWlmICggYXJyYXlOb3RhdGlvbiApIHsKCQkJCQkJCQlhW2ldID0gYVtpXS5yZXBsYWNlKF9fcmVBcnJheSwgJycpOwoJCQoJCQkJCQkJCS8vIENvbmRpdGlvbiBhbGxvd3Mgc2ltcGx5IFtdIHRvIGJlIHBhc3NlZCBpbgoJCQkJCQkJCWlmICggYVtpXSAhPT0gIiIgKSB7CgkJCQkJCQkJCWRhdGEgPSBkYXRhWyBhW2ldIF07CgkJCQkJCQkJfQoJCQkJCQkJCW91dCA9IFtdOwoJCQkJCQkJCQoJCQkJCQkJCS8vIEdldCB0aGUgcmVtYWluZGVyIG9mIHRoZSBuZXN0ZWQgb2JqZWN0IHRvIGdldAoJCQkJCQkJCWEuc3BsaWNlKCAwLCBpKzEgKTsKCQkJCQkJCQlpbm5lclNyYyA9IGEuam9pbignLicpOwoJCQoJCQkJCQkJCS8vIFRyYXZlcnNlIGVhY2ggZW50cnkgaW4gdGhlIGFycmF5IGdldHRpbmcgdGhlIHByb3BlcnRpZXMgcmVxdWVzdGVkCgkJCQkJCQkJZm9yICggdmFyIGo9MCwgakxlbj1kYXRhLmxlbmd0aCA7IGo8akxlbiA7IGorKyApIHsKCQkJCQkJCQkJb3V0LnB1c2goIGZldGNoRGF0YSggZGF0YVtqXSwgdHlwZSwgaW5uZXJTcmMgKSApOwoJCQkJCQkJCX0KCQkKCQkJCQkJCQkvLyBJZiBhIHN0cmluZyBpcyBnaXZlbiBpbiBiZXR3ZWVuIHRoZSBhcnJheSBub3RhdGlvbiBpbmRpY2F0b3JzLCB0aGF0CgkJCQkJCQkJLy8gaXMgdXNlZCB0byBqb2luIHRoZSBzdHJpbmdzIHRvZ2V0aGVyLCBvdGhlcndpc2UgYW4gYXJyYXkgaXMgcmV0dXJuZWQKCQkJCQkJCQl2YXIgam9pbiA9IGFycmF5Tm90YXRpb25bMF0uc3Vic3RyaW5nKDEsIGFycmF5Tm90YXRpb25bMF0ubGVuZ3RoLTEpOwoJCQkJCQkJCWRhdGEgPSAoam9pbj09PSIiKSA/IG91dCA6IG91dC5qb2luKGpvaW4pOwoJCQoJCQkJCQkJCS8vIFRoZSBpbm5lciBjYWxsIHRvIGZldGNoRGF0YSBoYXMgYWxyZWFkeSB0cmF2ZXJzZWQgdGhyb3VnaCB0aGUgcmVtYWluZGVyCgkJCQkJCQkJLy8gb2YgdGhlIHNvdXJjZSByZXF1ZXN0ZWQsIHNvIHdlIGV4aXQgZnJvbSB0aGUgbG9vcAoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQoJCQkJCQkJaWYgKCBkYXRhID09PSBudWxsIHx8IGRhdGFbIGFbaV0gXSA9PT0gdW5kZWZpbmVkICkKCQkJCQkJCXsKCQkJCQkJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCQkJCQkJfQoJCQkJCQkJZGF0YSA9IGRhdGFbIGFbaV0gXTsKCQkJCQkJfQoJCQkJCX0KCQkKCQkJCQlyZXR1cm4gZGF0YTsKCQkJCX07CgkJCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHR5cGUpIHsKCQkJCQlyZXR1cm4gZmV0Y2hEYXRhKCBkYXRhLCB0eXBlLCBtU291cmNlICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIGRhdGFbbVNvdXJjZV07CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHNldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIHNldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogTm90aGluZyB0byBkbyB3aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkge307CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQltU291cmNlKCBkYXRhLCAnc2V0JywgdmFsICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgKG1Tb3VyY2UuaW5kZXhPZignLicpICE9PSAtMSB8fCBtU291cmNlLmluZGV4T2YoJ1snKSAhPT0gLTEpICkKCQkJewoJCQkJLyogTGlrZSB0aGUgZ2V0LCB3ZSBuZWVkIHRvIGdldCBkYXRhIGZyb20gYSBuZXN0ZWQgb2JqZWN0ICovCgkJCQl2YXIgc2V0RGF0YSA9IGZ1bmN0aW9uIChkYXRhLCB2YWwsIHNyYykgewoJCQkJCXZhciBhID0gc3JjLnNwbGl0KCcuJyksIGI7CgkJCQkJdmFyIGFycmF5Tm90YXRpb24sIG8sIGlubmVyU3JjOwoJCQoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGgtMSA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQkvLyBDaGVjayBpZiB3ZSBhcmUgZGVhbGluZyB3aXRoIGFuIGFycmF5IG5vdGF0aW9uIHJlcXVlc3QKCQkJCQkJYXJyYXlOb3RhdGlvbiA9IGFbaV0ubWF0Y2goX19yZUFycmF5KTsKCQkKCQkJCQkJaWYgKCBhcnJheU5vdGF0aW9uICkKCQkJCQkJewoJCQkJCQkJYVtpXSA9IGFbaV0ucmVwbGFjZShfX3JlQXJyYXksICcnKTsKCQkJCQkJCWRhdGFbIGFbaV0gXSA9IFtdOwoJCQkJCQkJCgkJCQkJCQkvLyBHZXQgdGhlIHJlbWFpbmRlciBvZiB0aGUgbmVzdGVkIG9iamVjdCB0byBzZXQgc28gd2UgY2FuIHJlY3Vyc2UKCQkJCQkJCWIgPSBhLnNsaWNlKCk7CgkJCQkJCQliLnNwbGljZSggMCwgaSsxICk7CgkJCQkJCQlpbm5lclNyYyA9IGIuam9pbignLicpOwoJCQoJCQkJCQkJLy8gVHJhdmVyc2UgZWFjaCBlbnRyeSBpbiB0aGUgYXJyYXkgc2V0dGluZyB0aGUgcHJvcGVydGllcyByZXF1ZXN0ZWQKCQkJCQkJCWZvciAoIHZhciBqPTAsIGpMZW49dmFsLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJbyA9IHt9OwoJCQkJCQkJCXNldERhdGEoIG8sIHZhbFtqXSwgaW5uZXJTcmMgKTsKCQkJCQkJCQlkYXRhWyBhW2ldIF0ucHVzaCggbyApOwoJCQkJCQkJfQoJCQoJCQkJCQkJLy8gVGhlIGlubmVyIGNhbGwgdG8gc2V0RGF0YSBoYXMgYWxyZWFkeSB0cmF2ZXJzZWQgdGhyb3VnaCB0aGUgcmVtYWluZGVyCgkJCQkJCQkvLyBvZiB0aGUgc291cmNlIGFuZCBoYXMgc2V0IHRoZSBkYXRhLCB0aHVzIHdlIGNhbiBleGl0IGhlcmUKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQoJCQkJCQkvLyBJZiB0aGUgbmVzdGVkIG9iamVjdCBkb2Vzbid0IGN1cnJlbnRseSBleGlzdCAtIHNpbmNlIHdlIGFyZQoJCQkJCQkvLyB0cnlpbmcgdG8gc2V0IHRoZSB2YWx1ZSAtIGNyZWF0ZSBpdAoJCQkJCQlpZiAoIGRhdGFbIGFbaV0gXSA9PT0gbnVsbCB8fCBkYXRhWyBhW2ldIF0gPT09IHVuZGVmaW5lZCApCgkJCQkJCXsKCQkJCQkJCWRhdGFbIGFbaV0gXSA9IHt9OwoJCQkJCQl9CgkJCQkJCWRhdGEgPSBkYXRhWyBhW2ldIF07CgkJCQkJfQoJCQoJCQkJCS8vIElmIGFycmF5IG5vdGF0aW9uIGlzIHVzZWQsIHdlIGp1c3Qgd2FudCB0byBzdHJpcCBpdCBhbmQgdXNlIHRoZSBwcm9wZXJ0eSBuYW1lCgkJCQkJLy8gYW5kIGFzc2lnbiB0aGUgdmFsdWUuIElmIGl0IGlzbid0IHVzZWQsIHRoZW4gd2UgZ2V0IHRoZSByZXN1bHQgd2Ugd2FudCBhbnl3YXkKCQkJCQlkYXRhWyBhW2EubGVuZ3RoLTFdLnJlcGxhY2UoX19yZUFycmF5LCAnJykgXSA9IHZhbDsKCQkJCX07CgkJCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCXJldHVybiBzZXREYXRhKCBkYXRhLCB2YWwsIG1Tb3VyY2UgKTsKCQkJCX07CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBBcnJheSBvciBmbGF0IG9iamVjdCBtYXBwaW5nICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCWRhdGFbbVNvdXJjZV0gPSB2YWw7CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gYXJyYXkgd2l0aCB0aGUgZnVsbCB0YWJsZSBkYXRhCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMgYXJyYXkge2FycmF5fSBhRGF0YSBNYXN0ZXIgZGF0YSBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXREYXRhTWFzdGVyICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhRGF0YSA9IFtdOwoJCQl2YXIgaUxlbiA9IG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxpTGVuOyBpKysgKQoJCQl7CgkJCQlhRGF0YS5wdXNoKCBvU2V0dGluZ3MuYW9EYXRhW2ldLl9hRGF0YSApOwoJCQl9CgkJCXJldHVybiBhRGF0YTsKCQl9CgkJCgkJCgkJLyoqCgkJICogTnVrZSB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKQoJCXsKCQkJb1NldHRpbmdzLmFvRGF0YS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoICk7CgkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCApOwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggMCwgb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggKTsKCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQl9CgkJCgkJCgkJIC8qKgoJCSAqIFRha2UgYW4gYXJyYXkgb2YgaW50ZWdlcnMgKGluZGV4IGFycmF5KSBhbmQgcmVtb3ZlIGEgdGFyZ2V0IGludGVnZXIgKHZhbHVlIC0gbm90IAoJCSAqIHRoZSBrZXkhKQoJCSAqICBAcGFyYW0ge2FycmF5fSBhIEluZGV4IGFycmF5IHRvIHRhcmdldAoJCSAqICBAcGFyYW0ge2ludH0gaVRhcmdldCB2YWx1ZSB0byBmaW5kCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRlbGV0ZUluZGV4KCBhLCBpVGFyZ2V0ICkKCQl7CgkJCXZhciBpVGFyZ2V0SW5kZXggPSAtMTsKCQkJCgkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGFbaV0gPT0gaVRhcmdldCApCgkJCQl7CgkJCQkJaVRhcmdldEluZGV4ID0gaTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBhW2ldID4gaVRhcmdldCApCgkJCQl7CgkJCQkJYVtpXS0tOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIGlUYXJnZXRJbmRleCAhPSAtMSApCgkJCXsKCQkJCWEuc3BsaWNlKCBpVGFyZ2V0SW5kZXgsIDEgKTsKCQkJfQoJCX0KCQkKCQkKCQkgLyoqCgkJICogQ2FsbCB0aGUgZGV2ZWxvcGVyIGRlZmluZWQgZm5SZW5kZXIgZnVuY3Rpb24gZm9yIGEgZ2l2ZW4gY2VsbCAocm93L2NvbHVtbikgd2l0aAoJCSAqIHRoZSByZXF1aXJlZCBwYXJhbWV0ZXJzIGFuZCByZXR1cm4gdGhlIHJlc3VsdC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgaW5kZXggZm9yIHRoZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgYW9Db2x1bW5zIGluZGV4IGZvciB0aGUgY29sdW1uCgkJICogIEByZXR1cm5zIHsqfSBSZXR1cm4gb2YgdGhlIGRldmVsb3BlcidzIGZuUmVuZGVyIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlbmRlciggb1NldHRpbmdzLCBpUm93LCBpQ29sICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sXTsKCQkKCQkJcmV0dXJuIG9Db2wuZm5SZW5kZXIoIHsKCQkJCSJpRGF0YVJvdyI6ICAgIGlSb3csCgkJCQkiaURhdGFDb2x1bW4iOiBpQ29sLAoJCQkJIm9TZXR0aW5ncyI6ICAgb1NldHRpbmdzLAoJCQkJImFEYXRhIjogICAgICAgb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEsCgkJCQkibURhdGFQcm9wIjogICBvQ29sLm1EYXRhCgkJCX0sIF9mbkdldENlbGxEYXRhKG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJ2Rpc3BsYXknKSApOwoJCX0KCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgVFIgZWxlbWVudCAoYW5kIGl0J3MgVEQgY2hpbGRyZW4pIGZvciBhIHJvdwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFJvdyB0byBjb25zaWRlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVUciAoIG9TZXR0aW5ncywgaVJvdyApCgkJewoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQl2YXIgblRkOwoJCQoJCQlpZiAoIG9EYXRhLm5UciA9PT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhLm5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CgkJCgkJCQkvKiBVc2UgYSBwcml2YXRlIHByb3BlcnR5IG9uIHRoZSBub2RlIHRvIGFsbG93IHJlc2VydmUgbWFwcGluZyBmcm9tIHRoZSBub2RlCgkJCQkgKiB0byB0aGUgYW9EYXRhIGFycmF5IGZvciBmYXN0IGxvb2sgdXAKCQkJCSAqLwoJCQkJb0RhdGEublRyLl9EVF9Sb3dJbmRleCA9IGlSb3c7CgkJCgkJCQkvKiBTcGVjaWFsIHBhcmFtZXRlcnMgY2FuIGJlIGdpdmVuIGJ5IHRoZSBkYXRhIHNvdXJjZSB0byBiZSB1c2VkIG9uIHRoZSByb3cgKi8KCQkJCWlmICggb0RhdGEuX2FEYXRhLkRUX1Jvd0lkICkKCQkJCXsKCQkJCQlvRGF0YS5uVHIuaWQgPSBvRGF0YS5fYURhdGEuRFRfUm93SWQ7CgkJCQl9CgkJCgkJCQlpZiAoIG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzcyApCgkJCQl7CgkJCQkJJChvRGF0YS5uVHIpLmFkZENsYXNzKCBvRGF0YS5fYURhdGEuRFRfUm93Q2xhc3MgKTsKCQkJCX0KCQkKCQkJCS8qIFByb2Nlc3MgZWFjaCBjb2x1bW4gKi8KCQkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkJCQluVGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBvQ29sLnNDZWxsVHlwZSApOwoJCQoJCQkJCS8qIFJlbmRlciBpZiBuZWVkZWQgLSBpZiBiVXNlUmVuZGVyZWQgaXMgdHJ1ZSB0aGVuIHdlIGFscmVhZHkgaGF2ZSB0aGUgcmVuZGVyZWQKCQkJCQkgKiB2YWx1ZSBpbiB0aGUgZGF0YSBzb3VyY2UgLSBzbyBjYW4ganVzdCB1c2UgdGhhdAoJCQkJCSAqLwoJCQkJCW5UZC5pbm5lckhUTUwgPSAodHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgKCFvQ29sLmJVc2VSZW5kZXJlZCB8fCBvQ29sLm1EYXRhID09PSBudWxsKSkgPwoJCQkJCQlfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaSApIDoKCQkJCQkJX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCQkvKiBBZGQgdXNlciBkZWZpbmVkIGNsYXNzICovCgkJCQkJaWYgKCBvQ29sLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQuY2xhc3NOYW1lID0gb0NvbC5zQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggb0NvbC5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlvRGF0YS5uVHIuYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBudWxsOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBuVGQ7CgkJCQkJfQoJCQoJCQkJCWlmICggb0NvbC5mbkNyZWF0ZWRDZWxsICkKCQkJCQl7CgkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJblRkLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpCgkJCQkJCSk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG51bGwsIFtvRGF0YS5uVHIsIG9EYXRhLl9hRGF0YSwgaVJvd10gKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgdGhlIEhUTUwgaGVhZGVyIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZEhlYWQoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaSwgblRoLCBpTGVuLCBqLCBqTGVuOwoJCQl2YXIgaVRocyA9IG9TZXR0aW5ncy5uVEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJykubGVuZ3RoOwoJCQl2YXIgaUNvcnJlY3RvciA9IDA7CgkJCXZhciBqcUNoaWxkcmVuOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYSBoZWFkZXIgaW4gcGxhY2UgLSB0aGVuIHVzZSBpdCAtIG90aGVyd2lzZSBpdCdzIGdvaW5nIHRvIGdldCBudWtlZC4uLiAqLwoJCQlpZiAoIGlUaHMgIT09IDAgKQoJCQl7CgkJCQkvKiBXZSd2ZSBnb3QgYSB0aGVhZCBmcm9tIHRoZSBET00sIHNvIHJlbW92ZSBoaWRkZW4gY29sdW1ucyBhbmQgYXBwbHkgd2lkdGggdG8gdmlzIGNvbHMgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJblRoID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGg7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgncm9sZScsICdjb2x1bW5oZWFkZXInKTsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4Jywgb1NldHRpbmdzLmlUYWJJbmRleCk7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBvU2V0dGluZ3Muc1RhYmxlSWQpOwoJCQkJCX0KCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCSQoblRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogU2V0IHRoZSB0aXRsZSBvZiB0aGUgY29sdW1uIGlmIGl0IGlzIHVzZXIgZGVmaW5lZCAobm90IHdoYXQgd2FzIGF1dG8gZGV0ZWN0ZWQpICovCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZSAhPSBuVGguaW5uZXJIVE1MICkKCQkJCQl7CgkJCQkJCW5UaC5pbm5lckhUTUwgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBXZSBkb24ndCBoYXZlIGEgaGVhZGVyIGluIHRoZSBET00gLSBzbyB3ZSBhcmUgZ29pbmcgdG8gaGF2ZSB0byBjcmVhdGUgb25lICovCgkJCQl2YXIgblRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInRyIiApOwoJCQkJCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5UaCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoOwoJCQkJCW5UaC5pbm5lckhUTUwgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZTsKCQkJCQluVGguc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQkkKG5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICk7CgkJCQkJfQoJCQkJCQoJCQkJCW5Uci5hcHBlbmRDaGlsZCggblRoICk7CgkJCQl9CgkJCQkkKG9TZXR0aW5ncy5uVEhlYWQpLmh0bWwoICcnIClbMF0uYXBwZW5kQ2hpbGQoIG5UciApOwoJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBvU2V0dGluZ3MuYW9IZWFkZXIsIG9TZXR0aW5ncy5uVEhlYWQgKTsKCQkJfQoJCQkKCQkJLyogQVJJQSByb2xlIGZvciB0aGUgcm93cyAqLwkKCQkJJChvU2V0dGluZ3MublRIZWFkKS5jaGlsZHJlbigndHInKS5hdHRyKCdyb2xlJywgJ3JvdycpOwoJCQkKCQkJLyogQWRkIHRoZSBleHRyYSBtYXJrdXAgbmVlZGVkIGJ5IGpRdWVyeSBVSSdzIHRoZW1lcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluVGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaDsKCQkJCQkKCQkJCQl2YXIgbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJCW5EaXYuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJV3JhcHBlcjsKCQkJCQkkKG5UaCkuY29udGVudHMoKS5hcHBlbmRUbyhuRGl2KTsKCQkJCQkKCQkJCQl2YXIgblNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CgkJCQkJblNwYW4uY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SWNvbjsKCQkJCQluRGl2LmFwcGVuZENoaWxkKCBuU3BhbiApOwoJCQkJCW5UaC5hcHBlbmRDaGlsZCggbkRpdiApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICE9PSBmYWxzZSApCgkJCQkJewoJCQkJCQlfZm5Tb3J0QXR0YWNoTGlzdGVuZXIoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgsIGkgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBEZWFsIHdpdGggdGhlIGZvb3RlciAtIGFkZCBjbGFzc2VzIGlmIHJlcXVpcmVkICovCgkJCWlmICggb1NldHRpbmdzLm9DbGFzc2VzLnNGb290ZXJUSCAhPT0gIiIgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVEZvb3QpLmNoaWxkcmVuKCd0cicpLmNoaWxkcmVuKCd0aCcpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc0Zvb3RlclRIICk7CgkJCX0KCQkJCgkJCS8qIENhY2hlIHRoZSBmb290ZXIgZWxlbWVudHMgKi8KCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncywgbnVsbCwgb1NldHRpbmdzLmFvRm9vdGVyICk7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5DZWxsc1tpXSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UZiA9IGFuQ2VsbHNbaV07CgkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKQoJCQkJCQl7CgkJCQkJCQkkKGFuQ2VsbHNbaV0pLmFkZENsYXNzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIGhlYWRlciAob3IgZm9vdGVyKSBlbGVtZW50IGJhc2VkIG9uIHRoZSBjb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZXMuIFRoZQoJCSAqIG1ldGhvZG9sb2d5IGhlcmUgaXMgdG8gdXNlIHRoZSBsYXlvdXQgYXJyYXkgZnJvbSBfZm5EZXRlY3RIZWFkZXIsIG1vZGlmaWVkIGZvcgoJCSAqIHRoZSBpbnN0YW50YW5lb3VzIGNvbHVtbiB2aXNpYmlsaXR5LCB0byBjb25zdHJ1Y3QgdGhlIG5ldyBsYXlvdXQuIFRoZSBncmlkIGlzCgkJICogdHJhdmVyc2VkIG92ZXIgY2VsbCBhdCBhIHRpbWUgaW4gYSByb3dzIHggY29sdW1ucyBncmlkIGZhc2hpb24sIGFsdGhvdWdoIGVhY2ggCgkJICogY2VsbCBpbnNlcnQgY2FuIGNvdmVyIG11bHRpcGxlIGVsZW1lbnRzIGluIHRoZSBncmlkIC0gd2hpY2ggaXMgdHJhY2tzIHVzaW5nIHRoZQoJCSAqIGFBcHBsaWVkIGFycmF5LiBDZWxsIGluc2VydHMgaW4gdGhlIGdyaWQgd2lsbCBvbmx5IG9jY3VyIHdoZXJlIHRoZXJlIGlzbid0CgkJICogYWxyZWFkeSBhIGNlbGwgaW4gdGhhdCBwb3NpdGlvbi4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0gYXJyYXkge29iamVjdHN9IGFvU291cmNlIExheW91dCBhcnJheSBmcm9tIF9mbkRldGVjdEhlYWRlcgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiSW5jbHVkZUhpZGRlbj1mYWxzZV0gSWYgdHJ1ZSB0aGVuIGluY2x1ZGUgdGhlIGhpZGRlbiBjb2x1bW5zIGluIHRoZSBjYWxjLCAKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgYW9Tb3VyY2UsIGJJbmNsdWRlSGlkZGVuICkKCQl7CgkJCXZhciBpLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuLCBuLCBuTG9jYWxUcjsKCQkJdmFyIGFvTG9jYWwgPSBbXTsKCQkJdmFyIGFBcHBsaWVkID0gW107CgkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgaVJvd3NwYW4sIGlDb2xzcGFuOwoJCQoJCQlpZiAoICBiSW5jbHVkZUhpZGRlbiA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJYkluY2x1ZGVIaWRkZW4gPSBmYWxzZTsKCQkJfQoJCQoJCQkvKiBNYWtlIGEgY29weSBvZiB0aGUgbWFzdGVyIGxheW91dCBhcnJheSwgYnV0IHdpdGhvdXQgdGhlIHZpc2libGUgY29sdW1ucyBpbiBpdCAqLwoJCQlmb3IgKCBpPTAsIGlMZW49YW9Tb3VyY2UubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYW9Mb2NhbFtpXSA9IGFvU291cmNlW2ldLnNsaWNlKCk7CgkJCQlhb0xvY2FsW2ldLm5UciA9IGFvU291cmNlW2ldLm5UcjsKCQkKCQkJCS8qIFJlbW92ZSBhbnkgY29sdW1ucyB3aGljaCBhcmUgY3VycmVudGx5IGhpZGRlbiAqLwoJCQkJZm9yICggaj1pQ29sdW1ucy0xIDsgaj49MCA7IGotLSApCgkJCQl7CgkJCQkJaWYgKCAhb1NldHRpbmdzLmFvQ29sdW1uc1tqXS5iVmlzaWJsZSAmJiAhYkluY2x1ZGVIaWRkZW4gKQoJCQkJCXsKCQkJCQkJYW9Mb2NhbFtpXS5zcGxpY2UoIGosIDEgKTsKCQkJCQl9CgkJCQl9CgkJCgkJCQkvKiBQcmVwIHRoZSBhcHBsaWVkIGFycmF5IC0gaXQgbmVlZHMgYW4gZWxlbWVudCBmb3IgZWFjaCByb3cgKi8KCQkJCWFBcHBsaWVkLnB1c2goIFtdICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPWFvTG9jYWwubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJbkxvY2FsVHIgPSBhb0xvY2FsW2ldLm5UcjsKCQkJCQoJCQkJLyogQWxsIGNlbGxzIGFyZSBnb2luZyB0byBiZSByZXBsYWNlZCwgc28gZW1wdHkgb3V0IHRoZSByb3cgKi8KCQkJCWlmICggbkxvY2FsVHIgKQoJCQkJewoJCQkJCXdoaWxlKCAobiA9IG5Mb2NhbFRyLmZpcnN0Q2hpbGQpICkKCQkJCQl7CgkJCQkJCW5Mb2NhbFRyLnJlbW92ZUNoaWxkKCBuICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJZm9yICggaj0wLCBqTGVuPWFvTG9jYWxbaV0ubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpUm93c3BhbiA9IDE7CgkJCQkJaUNvbHNwYW4gPSAxOwoJCQoJCQkJCS8qIENoZWNrIHRvIHNlZSBpZiB0aGVyZSBpcyBhbHJlYWR5IGEgY2VsbCAocm93L2NvbHNwYW4pIGNvdmVyaW5nIG91ciB0YXJnZXQKCQkJCQkgKiBpbnNlcnQgcG9pbnQuIElmIHRoZXJlIGlzLCB0aGVuIHRoZXJlIGlzIG5vdGhpbmcgdG8gZG8uCgkJCQkJICovCgkJCQkJaWYgKCBhQXBwbGllZFtpXVtqXSA9PT0gdW5kZWZpbmVkICkKCQkJCQl7CgkJCQkJCW5Mb2NhbFRyLmFwcGVuZENoaWxkKCBhb0xvY2FsW2ldW2pdLmNlbGwgKTsKCQkJCQkJYUFwcGxpZWRbaV1bal0gPSAxOwoJCQoJCQkJCQkvKiBFeHBhbmQgdGhlIGNlbGwgdG8gY292ZXIgYXMgbWFueSByb3dzIGFzIG5lZWRlZCAqLwoJCQkJCQl3aGlsZSAoIGFvTG9jYWxbaStpUm93c3Bhbl0gIT09IHVuZGVmaW5lZCAmJgoJCQkJCQkgICAgICAgIGFvTG9jYWxbaV1bal0uY2VsbCA9PSBhb0xvY2FsW2kraVJvd3NwYW5dW2pdLmNlbGwgKQoJCQkJCQl7CgkJCQkJCQlhQXBwbGllZFtpK2lSb3dzcGFuXVtqXSA9IDE7CgkJCQkJCQlpUm93c3BhbisrOwoJCQkJCQl9CgkJCgkJCQkJCS8qIEV4cGFuZCB0aGUgY2VsbCB0byBjb3ZlciBhcyBtYW55IGNvbHVtbnMgYXMgbmVlZGVkICovCgkJCQkJCXdoaWxlICggYW9Mb2NhbFtpXVtqK2lDb2xzcGFuXSAhPT0gdW5kZWZpbmVkICYmCgkJCQkJCSAgICAgICAgYW9Mb2NhbFtpXVtqXS5jZWxsID09IGFvTG9jYWxbaV1baitpQ29sc3Bhbl0uY2VsbCApCgkJCQkJCXsKCQkJCQkJCS8qIE11c3QgdXBkYXRlIHRoZSBhcHBsaWVkIGFycmF5IG92ZXIgdGhlIHJvd3MgZm9yIHRoZSBjb2x1bW5zICovCgkJCQkJCQlmb3IgKCBrPTAgOyBrPGlSb3dzcGFuIDsgaysrICkKCQkJCQkJCXsKCQkJCQkJCQlhQXBwbGllZFtpK2tdW2oraUNvbHNwYW5dID0gMTsKCQkJCQkJCX0KCQkJCQkJCWlDb2xzcGFuKys7CgkJCQkJCX0KCQkKCQkJCQkJLyogRG8gdGhlIGFjdHVhbCBleHBhbnNpb24gaW4gdGhlIERPTSAqLwoJCQkJCQlhb0xvY2FsW2ldW2pdLmNlbGwucm93U3BhbiA9IGlSb3dzcGFuOwoJCQkJCQlhb0xvY2FsW2ldW2pdLmNlbGwuY29sU3BhbiA9IGlDb2xzcGFuOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBJbnNlcnQgdGhlIHJlcXVpcmVkIFRSIG5vZGVzIGludG8gdGhlIHRhYmxlIGZvciBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRHJhdyggb1NldHRpbmdzICkKCQl7CgkJCS8qIFByb3ZpZGUgYSBwcmUtY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZSBkcmF3IGlzIGZhbHNlIGlzIHJldHVybmVkICovCgkJCXZhciBhUHJlRHJhdyA9IF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAncHJlRHJhdycsIFtvU2V0dGluZ3NdICk7CgkJCWlmICggJC5pbkFycmF5KCBmYWxzZSwgYVByZURyYXcgKSAhPT0gLTEgKQoJCQl7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIgaSwgaUxlbiwgbjsKCQkJdmFyIGFuUm93cyA9IFtdOwoJCQl2YXIgaVJvd0NvdW50ID0gMDsKCQkJdmFyIGlTdHJpcGVzID0gb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlcy5sZW5ndGg7CgkJCXZhciBpT3BlblJvd3MgPSBvU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGg7CgkJCQoJCQlvU2V0dGluZ3MuYkRyYXdpbmcgPSB0cnVlOwoJCQkKCQkJLyogQ2hlY2sgYW5kIHNlZSBpZiB3ZSBoYXZlIGFuIGluaXRpYWwgZHJhdyBwb3NpdGlvbiBmcm9tIHN0YXRlIHNhdmluZyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCAhPT0gdW5kZWZpbmVkICYmIG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCAhPSAtMSApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IChvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPj0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSkgPwoJCQkJCQkwIDogb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkJfQoJCQkJb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID0gLTE7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIGRyYXcgaW50ZXJjZXB0ICovCgkJCWlmICggb1NldHRpbmdzLmJEZWZlckxvYWRpbmcgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyA9IGZhbHNlOwoJCQkJb1NldHRpbmdzLmlEcmF3Kys7CgkJCX0KCQkJZWxzZSBpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJb1NldHRpbmdzLmlEcmF3Kys7CgkJCX0KCQkJZWxzZSBpZiAoICFvU2V0dGluZ3MuYkRlc3Ryb3lpbmcgJiYgIV9mbkFqYXhVcGRhdGUoIG9TZXR0aW5ncyApICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoICE9PSAwICkKCQkJewoJCQkJdmFyIGlTdGFydCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydDsKCQkJCXZhciBpRW5kID0gb1NldHRpbmdzLl9pRGlzcGxheUVuZDsKCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJCXsKCQkJCQlpU3RhcnQgPSAwOwoJCQkJCWlFbmQgPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJCX0KCQkJCQoJCQkJZm9yICggdmFyIGo9aVN0YXJ0IDsgajxpRW5kIDsgaisrICkKCQkJCXsKCQkJCQl2YXIgYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVsgb1NldHRpbmdzLmFpRGlzcGxheVtqXSBdOwoJCQkJCWlmICggYW9EYXRhLm5UciA9PT0gbnVsbCApCgkJCQkJewoJCQkJCQlfZm5DcmVhdGVUciggb1NldHRpbmdzLCBvU2V0dGluZ3MuYWlEaXNwbGF5W2pdICk7CgkJCQkJfQoJCQoJCQkJCXZhciBuUm93ID0gYW9EYXRhLm5UcjsKCQkJCQkKCQkJCQkvKiBSZW1vdmUgdGhlIG9sZCBzdHJpcGluZyBjbGFzc2VzIGFuZCB0aGVuIGFkZCB0aGUgbmV3IG9uZSAqLwoJCQkJCWlmICggaVN0cmlwZXMgIT09IDAgKQoJCQkJCXsKCQkJCQkJdmFyIHNTdHJpcGUgPSBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWyBpUm93Q291bnQgJSBpU3RyaXBlcyBdOwoJCQkJCQlpZiAoIGFvRGF0YS5fc1Jvd1N0cmlwZSAhPSBzU3RyaXBlICkKCQkJCQkJewoJCQkJCQkJJChuUm93KS5yZW1vdmVDbGFzcyggYW9EYXRhLl9zUm93U3RyaXBlICkuYWRkQ2xhc3MoIHNTdHJpcGUgKTsKCQkJCQkJCWFvRGF0YS5fc1Jvd1N0cmlwZSA9IHNTdHJpcGU7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJLyogUm93IGNhbGxiYWNrIGZ1bmN0aW9ucyAtIG1pZ2h0IHdhbnQgdG8gbWFuaXB1bGF0ZSB0aGUgcm93ICovCgkJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NhbGxiYWNrJywgbnVsbCwgCgkJCQkJCVtuUm93LCBvU2V0dGluZ3MuYW9EYXRhWyBvU2V0dGluZ3MuYWlEaXNwbGF5W2pdIF0uX2FEYXRhLCBpUm93Q291bnQsIGpdICk7CgkJCQkJCgkJCQkJYW5Sb3dzLnB1c2goIG5Sb3cgKTsKCQkJCQlpUm93Q291bnQrKzsKCQkJCQkKCQkJCQkvKiBJZiB0aGVyZSBpcyBhbiBvcGVuIHJvdyAtIGFuZCBpdCBpcyBhdHRhY2hlZCB0byB0aGlzIHBhcmVudCAtIGF0dGFjaCBpdCBvbiByZWRyYXcgKi8KCQkJCQlpZiAoIGlPcGVuUm93cyAhPT0gMCApCgkJCQkJewoJCQkJCQlmb3IgKCB2YXIgaz0wIDsgazxpT3BlblJvd3MgOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG5Sb3cgPT0gb1NldHRpbmdzLmFvT3BlblJvd3Nba10ublBhcmVudCApCgkJCQkJCQl7CgkJCQkJCQkJYW5Sb3dzLnB1c2goIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2tdLm5UciApOwoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogVGFibGUgaXMgZW1wdHkgLSBjcmVhdGUgYSByb3cgd2l0aCBhbiBlbXB0eSBtZXNzYWdlIGluIGl0ICovCgkJCQlhblJvd3NbIDAgXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0cicgKTsKCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWzBdICkKCQkJCXsKCQkJCQlhblJvd3NbIDAgXS5jbGFzc05hbWUgPSBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWzBdOwoJCQkJfQoJCQoJCQkJdmFyIG9MYW5nID0gb1NldHRpbmdzLm9MYW5ndWFnZTsKCQkJCXZhciBzWmVybyA9IG9MYW5nLnNaZXJvUmVjb3JkczsKCQkJCWlmICggb1NldHRpbmdzLmlEcmF3ID09IDEgJiYgb1NldHRpbmdzLnNBamF4U291cmNlICE9PSBudWxsICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJCXsKCQkJCQlzWmVybyA9IG9MYW5nLnNMb2FkaW5nUmVjb3JkczsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvTGFuZy5zRW1wdHlUYWJsZSAmJiBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSA9PT0gMCApCgkJCQl7CgkJCQkJc1plcm8gPSBvTGFuZy5zRW1wdHlUYWJsZTsKCQkJCX0KCQkKCQkJCXZhciBuVGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGQnICk7CgkJCQluVGQuc2V0QXR0cmlidXRlKCAndmFsaWduJywgInRvcCIgKTsKCQkJCW5UZC5jb2xTcGFuID0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICk7CgkJCQluVGQuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNSb3dFbXB0eTsKCQkJCW5UZC5pbm5lckhUTUwgPSBfZm5JbmZvTWFjcm9zKCBvU2V0dGluZ3MsIHNaZXJvICk7CgkJCQkKCQkJCWFuUm93c1sgaVJvd0NvdW50IF0uYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQl9CgkJCQoJCQkvKiBIZWFkZXIgYW5kIGZvb3RlciBjYWxsYmFja3MgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0hlYWRlckNhbGxiYWNrJywgJ2hlYWRlcicsIFsgJChvU2V0dGluZ3MublRIZWFkKS5jaGlsZHJlbigndHInKVswXSwgCgkJCQlfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKSwgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksIG9TZXR0aW5ncy5haURpc3BsYXkgXSApOwoJCQkKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0Zvb3RlckNhbGxiYWNrJywgJ2Zvb3RlcicsIFsgJChvU2V0dGluZ3MublRGb290KS5jaGlsZHJlbigndHInKVswXSwgCgkJCQlfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKSwgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksIG9TZXR0aW5ncy5haURpc3BsYXkgXSApOwoJCQkKCQkJLyogCgkJCSAqIE5lZWQgdG8gcmVtb3ZlIGFueSBvbGQgcm93IGZyb20gdGhlIGRpc3BsYXkgLSBub3RlIHdlIGNhbid0IGp1c3QgZW1wdHkgdGhlIHRib2R5IHVzaW5nCgkJCSAqICQoKS5odG1sKCcnKSBzaW5jZSB0aGlzIHdpbGwgdW5iaW5kIHRoZSBqUXVlcnkgZXZlbnQgaGFuZGxlcnMgKGV2ZW4gYWx0aG91Z2ggdGhlIG5vZGUgCgkJCSAqIHN0aWxsIGV4aXN0cyEpIC0gZXF1YWxseSB3ZSBjYW4ndCB1c2UgaW5uZXJIVE1MLCBzaW5jZSBJRSB0aHJvd3MgYW4gZXhjZXB0aW9uLgoJCQkgKi8KCQkJdmFyCgkJCQluQWRkRnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKCQkJCW5SZW1vdmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAoJCQkJbkJvZHlQYXIsIG5UcnM7CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5uVEJvZHkgKQoJCQl7CgkJCQluQm9keVBhciA9IG9TZXR0aW5ncy5uVEJvZHkucGFyZW50Tm9kZTsKCQkJCW5SZW1vdmVGcmFnLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRCb2R5ICk7CgkJCQkKCQkJCS8qIFdoZW4gZG9pbmcgaW5maW5pdGUgc2Nyb2xsaW5nLCBvbmx5IHJlbW92ZSBjaGlsZCByb3dzIHdoZW4gc29ydGluZywgZmlsdGVyaW5nIG9yIHN0YXJ0CgkJCQkgKiB1cC4gV2hlbiBub3QgaW5maW5pdGUgc2Nyb2xsLCBhbHdheXMgZG8gaXQuCgkJCQkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSB8fCAhb1NldHRpbmdzLl9iSW5pdENvbXBsZXRlIHx8CgkJCQkgCW9TZXR0aW5ncy5iU29ydGVkIHx8IG9TZXR0aW5ncy5iRmlsdGVyZWQgKQoJCQkJewoJCQkJCXdoaWxlKCAobiA9IG9TZXR0aW5ncy5uVEJvZHkuZmlyc3RDaGlsZCkgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLm5UQm9keS5yZW1vdmVDaGlsZCggbiApOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogUHV0IHRoZSBkcmF3IHRhYmxlIGludG8gdGhlIGRvbSAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuUm93cy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5BZGRGcmFnLmFwcGVuZENoaWxkKCBhblJvd3NbaV0gKTsKCQkJCX0KCQkJCQoJCQkJb1NldHRpbmdzLm5UQm9keS5hcHBlbmRDaGlsZCggbkFkZEZyYWcgKTsKCQkJCWlmICggbkJvZHlQYXIgIT09IG51bGwgKQoJCQkJewoJCQkJCW5Cb2R5UGFyLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRCb2R5ICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIENhbGwgYWxsIHJlcXVpcmVkIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgdGhlIGVuZCBvZiBhIGRyYXcgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICdkcmF3JywgW29TZXR0aW5nc10gKTsKCQkJCgkJCS8qIERyYXcgaXMgY29tcGxldGUsIHNvcnRpbmcgYW5kIGZpbHRlcmluZyBtdXN0IGJlIGFzIHdlbGwgKi8KCQkJb1NldHRpbmdzLmJTb3J0ZWQgPSBmYWxzZTsKCQkJb1NldHRpbmdzLmJGaWx0ZXJlZCA9IGZhbHNlOwoJCQlvU2V0dGluZ3MuYkRyYXdpbmcgPSBmYWxzZTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlpZiAoICFvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgKQoJCQkJewoJCQkJCV9mbkluaXRDb21wbGV0ZSggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogUmVkcmF3IHRoZSB0YWJsZSAtIHRha2luZyBhY2NvdW50IG9mIHRoZSB2YXJpb3VzIGZlYXR1cmVzIHdoaWNoIGFyZSBlbmFibGVkCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJLyogU29ydGluZyB3aWxsIHJlZmlsdGVyIGFuZCBkcmF3IGZvciB1cyAqLwoJCQkJX2ZuU29ydCggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCXsKCQkJCS8qIEZpbHRlcmluZyB3aWxsIHJlZHJhdyBmb3IgdXMgKi8KCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2ggKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGQgdGhlIG9wdGlvbnMgdG8gdGhlIHBhZ2UgSFRNTCBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWRkT3B0aW9uc0h0bWwgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyoKCQkJICogQ3JlYXRlIGEgdGVtcG9yYXJ5LCBlbXB0eSwgZGl2IHdoaWNoIHdlIGNhbiBsYXRlciBvbiByZXBsYWNlIHdpdGggd2hhdCB3ZSBoYXZlIGdlbmVyYXRlZAoJCQkgKiB3ZSBkbyBpdCB0aGlzIHdheSB0byByZW5kZXJpbmcgdGhlICdvcHRpb25zJyBodG1sIG9mZmxpbmUgLSBzcGVlZCA6LSkKCQkJICovCgkJCXZhciBuSG9sZGluZyA9ICQoJzxkaXY+PC9kaXY+JylbMF07CgkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIG5Ib2xkaW5nLCBvU2V0dGluZ3MublRhYmxlICk7CgkJCQoJCQkvKiAKCQkJICogQWxsIERhdGFUYWJsZXMgYXJlIHdyYXBwZWQgaW4gYSBkaXYKCQkJICovCgkJCW9TZXR0aW5ncy5uVGFibGVXcmFwcGVyID0gJCgnPGRpdiBpZD0iJytvU2V0dGluZ3Muc1RhYmxlSWQrJ193cmFwcGVyIiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1dyYXBwZXIrJyIgcm9sZT0iZ3JpZCI+PC9kaXY+JylbMF07CgkJCW9TZXR0aW5ncy5uVGFibGVSZWluc2VydEJlZm9yZSA9IG9TZXR0aW5ncy5uVGFibGUubmV4dFNpYmxpbmc7CgkJCgkJCS8qIFRyYWNrIHdoZXJlIHdlIHdhbnQgdG8gaW5zZXJ0IHRoZSBvcHRpb24gKi8KCQkJdmFyIG5JbnNlcnROb2RlID0gb1NldHRpbmdzLm5UYWJsZVdyYXBwZXI7CgkJCQoJCQkvKiBMb29wIG92ZXIgdGhlIHVzZXIgc2V0IHBvc2l0aW9uaW5nIGFuZCBwbGFjZSB0aGUgZWxlbWVudHMgYXMgbmVlZGVkICovCgkJCXZhciBhRG9tID0gb1NldHRpbmdzLnNEb20uc3BsaXQoJycpOwoJCQl2YXIgblRtcCwgaVB1c2hGZWF0dXJlLCBjT3B0aW9uLCBuTmV3Tm9kZSwgY05leHQsIHNBdHRyLCBqOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxhRG9tLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlQdXNoRmVhdHVyZSA9IDA7CgkJCQljT3B0aW9uID0gYURvbVtpXTsKCQkJCQoJCQkJaWYgKCBjT3B0aW9uID09ICc8JyApCgkJCQl7CgkJCQkJLyogTmV3IGNvbnRhaW5lciBkaXYgKi8KCQkJCQluTmV3Tm9kZSA9ICQoJzxkaXY+PC9kaXY+JylbMF07CgkJCQkJCgkJCQkJLyogQ2hlY2sgdG8gc2VlIGlmIHdlIHNob3VsZCBhcHBlbmQgYW4gaWQgYW5kL29yIGEgY2xhc3MgbmFtZSB0byB0aGUgY29udGFpbmVyICovCgkJCQkJY05leHQgPSBhRG9tW2krMV07CgkJCQkJaWYgKCBjTmV4dCA9PSAiJyIgfHwgY05leHQgPT0gJyInICkKCQkJCQl7CgkJCQkJCXNBdHRyID0gIiI7CgkJCQkJCWogPSAyOwoJCQkJCQl3aGlsZSAoIGFEb21baStqXSAhPSBjTmV4dCApCgkJCQkJCXsKCQkJCQkJCXNBdHRyICs9IGFEb21baStqXTsKCQkJCQkJCWorKzsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogUmVwbGFjZSBqUXVlcnkgVUkgY29uc3RhbnRzICovCgkJCQkJCWlmICggc0F0dHIgPT0gIkgiICkKCQkJCQkJewoJCQkJCQkJc0F0dHIgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0pVSUhlYWRlcjsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggc0F0dHIgPT0gIkYiICkKCQkJCQkJewoJCQkJCQkJc0F0dHIgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0pVSUZvb3RlcjsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogVGhlIGF0dHJpYnV0ZSBjYW4gYmUgaW4gdGhlIGZvcm1hdCBvZiAiI2lkLmNsYXNzIiwgIiNpZCIgb3IgImNsYXNzIiBUaGlzIGxvZ2ljCgkJCQkJCSAqIGJyZWFrcyB0aGUgc3RyaW5nIGludG8gcGFydHMgYW5kIGFwcGxpZXMgdGhlbSBhcyBuZWVkZWQKCQkJCQkJICovCgkJCQkJCWlmICggc0F0dHIuaW5kZXhPZignLicpICE9IC0xICkKCQkJCQkJewoJCQkJCQkJdmFyIGFTcGxpdCA9IHNBdHRyLnNwbGl0KCcuJyk7CgkJCQkJCQluTmV3Tm9kZS5pZCA9IGFTcGxpdFswXS5zdWJzdHIoMSwgYVNwbGl0WzBdLmxlbmd0aC0xKTsKCQkJCQkJCW5OZXdOb2RlLmNsYXNzTmFtZSA9IGFTcGxpdFsxXTsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggc0F0dHIuY2hhckF0KDApID09ICIjIiApCgkJCQkJCXsKCQkJCQkJCW5OZXdOb2RlLmlkID0gc0F0dHIuc3Vic3RyKDEsIHNBdHRyLmxlbmd0aC0xKTsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCW5OZXdOb2RlLmNsYXNzTmFtZSA9IHNBdHRyOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQlpICs9IGo7IC8qIE1vdmUgYWxvbmcgdGhlIHBvc2l0aW9uIGFycmF5ICovCgkJCQkJfQoJCQkJCQoJCQkJCW5JbnNlcnROb2RlLmFwcGVuZENoaWxkKCBuTmV3Tm9kZSApOwoJCQkJCW5JbnNlcnROb2RlID0gbk5ld05vZGU7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAnPicgKQoJCQkJewoJCQkJCS8qIEVuZCBjb250YWluZXIgZGl2ICovCgkJCQkJbkluc2VydE5vZGUgPSBuSW5zZXJ0Tm9kZS5wYXJlbnROb2RlOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ2wnICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlBhZ2luYXRlICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkxlbmd0aENoYW5nZSApCgkJCQl7CgkJCQkJLyogTGVuZ3RoICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sTGVuZ3RoKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ2YnICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCQl7CgkJCQkJLyogRmlsdGVyICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sRmlsdGVyKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ3InICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlByb2Nlc3NpbmcgKQoJCQkJewoJCQkJCS8qIHBSb2Nlc3NpbmcgKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ3QnICkKCQkJCXsKCQkJCQkvKiBUYWJsZSAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbFRhYmxlKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gICdpJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJJbmZvICkKCQkJCXsKCQkJCQkvKiBJbmZvICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sSW5mbyggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdwJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSApCgkJCQl7CgkJCQkJLyogUGFnaW5hdGlvbiAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbFBhZ2luYXRlKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIERhdGFUYWJsZS5leHQuYW9GZWF0dXJlcy5sZW5ndGggIT09IDAgKQoJCQkJewoJCQkJCS8qIFBsdWctaW4gZmVhdHVyZXMgKi8KCQkJCQl2YXIgYW9GZWF0dXJlcyA9IERhdGFUYWJsZS5leHQuYW9GZWF0dXJlczsKCQkJCQlmb3IgKCB2YXIgaz0wLCBrTGVuPWFvRmVhdHVyZXMubGVuZ3RoIDsgazxrTGVuIDsgaysrICkKCQkJCQl7CgkJCQkJCWlmICggY09wdGlvbiA9PSBhb0ZlYXR1cmVzW2tdLmNGZWF0dXJlICkKCQkJCQkJewoJCQkJCQkJblRtcCA9IGFvRmVhdHVyZXNba10uZm5Jbml0KCBvU2V0dGluZ3MgKTsKCQkJCQkJCWlmICggblRtcCApCgkJCQkJCQl7CgkJCQkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBBZGQgdG8gdGhlIDJEIGZlYXR1cmVzIGFycmF5ICovCgkJCQlpZiAoIGlQdXNoRmVhdHVyZSA9PSAxICYmIG5UbXAgIT09IG51bGwgKQoJCQkJewoJCQkJCWlmICggdHlwZW9mIG9TZXR0aW5ncy5hYW5GZWF0dXJlc1tjT3B0aW9uXSAhPT0gJ29iamVjdCcgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFhbkZlYXR1cmVzW2NPcHRpb25dID0gW107CgkJCQkJfQoJCQkJCW9TZXR0aW5ncy5hYW5GZWF0dXJlc1tjT3B0aW9uXS5wdXNoKCBuVG1wICk7CgkJCQkJbkluc2VydE5vZGUuYXBwZW5kQ2hpbGQoIG5UbXAgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogQnVpbHQgb3VyIERPTSBzdHJ1Y3R1cmUgLSByZXBsYWNlIHRoZSBob2xkaW5nIGRpdiB3aXRoIHdoYXQgd2Ugd2FudCAqLwoJCQluSG9sZGluZy5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCggb1NldHRpbmdzLm5UYWJsZVdyYXBwZXIsIG5Ib2xkaW5nICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFVzZSB0aGUgRE9NIHNvdXJjZSB0byBjcmVhdGUgdXAgYW4gYXJyYXkgb2YgaGVhZGVyIGNlbGxzLiBUaGUgaWRlYSBoZXJlIGlzIHRvCgkJICogY3JlYXRlIGEgbGF5b3V0IGdyaWQgKGFycmF5KSBvZiByb3dzIHggY29sdW1ucywgd2hpY2ggY29udGFpbnMgYSByZWZlcmVuY2UKCQkgKiB0byB0aGUgY2VsbCB0aGF0IHRoYXQgcG9pbnQgaW4gdGhlIGdyaWQgKHJlZ2FyZGxlc3Mgb2YgY29sL3Jvd3NwYW4pLCBzdWNoIHRoYXQKCQkgKiBhbnkgY29sdW1uIC8gcm93IGNvdWxkIGJlIHJlbW92ZWQgYW5kIHRoZSBuZXcgZ3JpZCBjb25zdHJ1Y3RlZAoJCSAqICBAcGFyYW0gYXJyYXkge29iamVjdH0gYUxheW91dCBBcnJheSB0byBzdG9yZSB0aGUgY2FsY3VsYXRlZCBsYXlvdXQgaW4KCQkgKiAgQHBhcmFtIHtub2RlfSBuVGhlYWQgVGhlIGhlYWRlci9mb290ZXIgZWxlbWVudCBmb3IgdGhlIHRhYmxlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRldGVjdEhlYWRlciAoIGFMYXlvdXQsIG5UaGVhZCApCgkJewoJCQl2YXIgblRycyA9ICQoblRoZWFkKS5jaGlsZHJlbigndHInKTsKCQkJdmFyIG5DZWxsOwoJCQl2YXIgaSwgaiwgaywgbCwgaUxlbiwgakxlbiwgaUNvbFNoaWZ0ZWQ7CgkJCXZhciBmblNoaWZ0Q29sID0gZnVuY3Rpb24gKCBhLCBpLCBqICkgewoJCQkJd2hpbGUgKCBhW2ldW2pdICkgewoJCQkJCWorKzsKCQkJCX0KCQkJCXJldHVybiBqOwoJCQl9OwoJCQoJCQlhTGF5b3V0LnNwbGljZSggMCwgYUxheW91dC5sZW5ndGggKTsKCQkJCgkJCS8qIFdlIGtub3cgaG93IG1hbnkgcm93cyB0aGVyZSBhcmUgaW4gdGhlIGxheW91dCAtIHNvIHByZXAgaXQgKi8KCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYUxheW91dC5wdXNoKCBbXSApOwoJCQl9CgkJCQoJCQkvKiBDYWxjdWxhdGUgYSBsYXlvdXQgYXJyYXkgKi8KCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJdmFyIGlDb2x1bW4gPSAwOwoJCQkJCgkJCQkvKiBGb3IgZXZlcnkgY2VsbCBpbiB0aGUgcm93Li4uICovCgkJCQlmb3IgKCBqPTAsIGpMZW49blRyc1tpXS5jaGlsZE5vZGVzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJbkNlbGwgPSBuVHJzW2ldLmNoaWxkTm9kZXNbal07CgkJCgkJCQkJaWYgKCBuQ2VsbC5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09ICJURCIgfHwKCQkJCQkgICAgIG5DZWxsLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT0gIlRIIiApCgkJCQkJewoJCQkJCQkvKiBHZXQgdGhlIGNvbCBhbmQgcm93c3BhbiBhdHRyaWJ1dGVzIGZyb20gdGhlIERPTSBhbmQgc2FuaXRpc2UgdGhlbSAqLwoJCQkJCQl2YXIgaUNvbHNwYW4gPSBuQ2VsbC5nZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nKSAqIDE7CgkJCQkJCXZhciBpUm93c3BhbiA9IG5DZWxsLmdldEF0dHJpYnV0ZSgncm93c3BhbicpICogMTsKCQkJCQkJaUNvbHNwYW4gPSAoIWlDb2xzcGFuIHx8IGlDb2xzcGFuPT09MCB8fCBpQ29sc3Bhbj09PTEpID8gMSA6IGlDb2xzcGFuOwoJCQkJCQlpUm93c3BhbiA9ICghaVJvd3NwYW4gfHwgaVJvd3NwYW49PT0wIHx8IGlSb3dzcGFuPT09MSkgPyAxIDogaVJvd3NwYW47CgkJCgkJCQkJCS8qIFRoZXJlIG1pZ2h0IGJlIGNvbHNwYW4gY2VsbHMgYWxyZWFkeSBpbiB0aGlzIHJvdywgc28gc2hpZnQgb3VyIHRhcmdldCAKCQkJCQkJICogYWNjb3JkaW5nbHkKCQkJCQkJICovCgkJCQkJCWlDb2xTaGlmdGVkID0gZm5TaGlmdENvbCggYUxheW91dCwgaSwgaUNvbHVtbiApOwoJCQkJCQkKCQkJCQkJLyogSWYgdGhlcmUgaXMgY29sIC8gcm93c3BhbiwgY29weSB0aGUgaW5mb3JtYXRpb24gaW50byB0aGUgbGF5b3V0IGdyaWQgKi8KCQkJCQkJZm9yICggbD0wIDsgbDxpQ29sc3BhbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGs9MCA7IGs8aVJvd3NwYW4gOyBrKysgKQoJCQkJCQkJewoJCQkJCQkJCWFMYXlvdXRbaStrXVtpQ29sU2hpZnRlZCtsXSA9IHsKCQkJCQkJCQkJImNlbGwiOiBuQ2VsbCwKCQkJCQkJCQkJInVuaXF1ZSI6IGlDb2xzcGFuID09IDEgPyB0cnVlIDogZmFsc2UKCQkJCQkJCQl9OwoJCQkJCQkJCWFMYXlvdXRbaStrXS5uVHIgPSBuVHJzW2ldOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiB1bmlxdWUgdGggZWxlbWVudHMsIG9uZSBmb3IgZWFjaCBjb2x1bW4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge25vZGV9IG5IZWFkZXIgYXV0b21hdGljYWxseSBkZXRlY3QgdGhlIGxheW91dCBmcm9tIHRoaXMgbm9kZSAtIG9wdGlvbmFsCgkJICogIEBwYXJhbSB7YXJyYXl9IGFMYXlvdXQgdGhlYWQvdGZvb3QgbGF5b3V0IGZyb20gX2ZuRGV0ZWN0SGVhZGVyIC0gb3B0aW9uYWwKCQkgKiAgQHJldHVybnMgYXJyYXkge25vZGV9IGFSZXR1cm4gbGlzdCBvZiB1bmlxdWUgdGgncwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRVbmlxdWVUaHMgKCBvU2V0dGluZ3MsIG5IZWFkZXIsIGFMYXlvdXQgKQoJCXsKCQkJdmFyIGFSZXR1cm4gPSBbXTsKCQkJaWYgKCAhYUxheW91dCApCgkJCXsKCQkJCWFMYXlvdXQgPSBvU2V0dGluZ3MuYW9IZWFkZXI7CgkJCQlpZiAoIG5IZWFkZXIgKQoJCQkJewoJCQkJCWFMYXlvdXQgPSBbXTsKCQkJCQlfZm5EZXRlY3RIZWFkZXIoIGFMYXlvdXQsIG5IZWFkZXIgKTsKCQkJCX0KCQkJfQoJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFMYXlvdXQubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1hTGF5b3V0W2ldLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBhTGF5b3V0W2ldW2pdLnVuaXF1ZSAmJiAKCQkJCQkJICghYVJldHVybltqXSB8fCAhb1NldHRpbmdzLmJTb3J0Q2VsbHNUb3ApICkKCQkJCQl7CgkJCQkJCWFSZXR1cm5bal0gPSBhTGF5b3V0W2ldW2pdLmNlbGw7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gYVJldHVybjsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIHRoZSB0YWJsZSB1c2luZyBhbiBBamF4IGNhbGwKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gQmxvY2sgdGhlIHRhYmxlIGRyYXdpbmcgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFqYXhVcGRhdGUoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5iQWpheERhdGFHZXQgKQoJCQl7CgkJCQlvU2V0dGluZ3MuaURyYXcrKzsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQkJdmFyIGFvRGF0YSA9IF9mbkFqYXhQYXJhbWV0ZXJzKCBvU2V0dGluZ3MgKTsKCQkJCV9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKTsKCQkJCQoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwKCQkJCQlmdW5jdGlvbihqc29uKSB7CgkJCQkJCV9mbkFqYXhVcGRhdGVEcmF3KCBvU2V0dGluZ3MsIGpzb24gKTsKCQkJCQl9LCBvU2V0dGluZ3MgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEJ1aWxkIHVwIHRoZSBwYXJhbWV0ZXJzIGluIGFuIG9iamVjdCBuZWVkZWQgZm9yIGEgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyByZXF1ZXN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2Jvb2x9IGJsb2NrIHRoZSB0YWJsZSBkcmF3aW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BamF4UGFyYW1ldGVycyggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgYW9EYXRhID0gW10sIG1EYXRhUHJvcCwgYWFTb3J0LCBhRGF0YVNvcnQ7CgkJCXZhciBpLCBqOwoJCQkKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic0VjaG8iLCAgICAgICAgICAidmFsdWUiOiBvU2V0dGluZ3MuaURyYXcgfSApOwoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpQ29sdW1ucyIsICAgICAgICJ2YWx1ZSI6IGlDb2x1bW5zIH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic0NvbHVtbnMiLCAgICAgICAidmFsdWUiOiBfZm5Db2x1bW5PcmRlcmluZyhvU2V0dGluZ3MpIH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaURpc3BsYXlTdGFydCIsICAidmFsdWUiOiBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgfSApOwoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpRGlzcGxheUxlbmd0aCIsICJ2YWx1ZSI6IG9TZXR0aW5ncy5vRmVhdHVyZXMuYlBhZ2luYXRlICE9PSBmYWxzZSA/CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDogLTEgfSApOwoJCQkJCgkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQl7CgkJCSAgbURhdGFQcm9wID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5tRGF0YTsKCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogIm1EYXRhUHJvcF8iK2ksICJ2YWx1ZSI6IHR5cGVvZihtRGF0YVByb3ApPT09ImZ1bmN0aW9uIiA/ICdmdW5jdGlvbicgOiBtRGF0YVByb3AgfSApOwoJCQl9CgkJCQoJCQkvKiBGaWx0ZXJpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgIT09IGZhbHNlICkKCQkJewoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NlYXJjaCIsICJ2YWx1ZSI6IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2guc1NlYXJjaCB9ICk7CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiUmVnZXgiLCAgInZhbHVlIjogb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaC5iUmVnZXggfSApOwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCQl7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NlYXJjaF8iK2ksICAgICAidmFsdWUiOiBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzW2ldLnNTZWFyY2ggfSApOwoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJSZWdleF8iK2ksICAgICAgInZhbHVlIjogb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1tpXS5iUmVnZXggfSApOwoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJTZWFyY2hhYmxlXyIraSwgInZhbHVlIjogb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU2VhcmNoYWJsZSB9ICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFNvcnRpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICE9PSBmYWxzZSApCgkJCXsKCQkJCXZhciBpQ291bnRlciA9IDA7CgkJCgkJCQlhYVNvcnQgPSAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApID8KCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICkgOgoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJCQoJCQkJZm9yICggaT0wIDsgaTxhYVNvcnQubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlhRGF0YVNvcnQgPSBvU2V0dGluZ3MuYW9Db2x1bW5zWyBhYVNvcnRbaV1bMF0gXS5hRGF0YVNvcnQ7CgkJCQkJCgkJCQkJZm9yICggaj0wIDsgajxhRGF0YVNvcnQubGVuZ3RoIDsgaisrICkKCQkJCQl7CgkJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlTb3J0Q29sXyIraUNvdW50ZXIsICAidmFsdWUiOiBhRGF0YVNvcnRbal0gfSApOwoJCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzU29ydERpcl8iK2lDb3VudGVyLCAgInZhbHVlIjogYWFTb3J0W2ldWzFdIH0gKTsKCQkJCQkJaUNvdW50ZXIrKzsKCQkJCQl9CgkJCQl9CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpU29ydGluZ0NvbHMiLCAgICJ2YWx1ZSI6IGlDb3VudGVyIH0gKTsKCQkJCQoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCQl7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiYlNvcnRhYmxlXyIraSwgICJ2YWx1ZSI6IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlIH0gKTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFvRGF0YTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQWRkIEFqYXggcGFyYW1ldGVycyBmcm9tIHBsdWctaW5zCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3RzfSBhb0RhdGEgbmFtZS92YWx1ZSBwYWlycyB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApCgkJewoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU2VydmVyUGFyYW1zJywgJ3NlcnZlclBhcmFtcycsIFthb0RhdGFdICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERhdGEgdGhlIGRhdGEgZnJvbSB0aGUgc2VydmVyIChudWtpbmcgdGhlIG9sZCkgYW5kIHJlZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBqc29uIGRhdGEgcmV0dXJuIGZyb20gdGhlIHNlcnZlci4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IGpzb24uc0VjaG8gVHJhY2tpbmcgZmxhZyBmb3IgRGF0YVRhYmxlcyB0byBtYXRjaCByZXF1ZXN0cwoJCSAqICBAcGFyYW0ge2ludH0ganNvbi5pVG90YWxSZWNvcmRzIE51bWJlciBvZiByZWNvcmRzIGluIHRoZSBkYXRhIHNldCwgbm90IGFjY291bnRpbmcgZm9yIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge2ludH0ganNvbi5pVG90YWxEaXNwbGF5UmVjb3JkcyBOdW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgZGF0YSBzZXQsIGFjY291bnRpbmcgZm9yIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge2FycmF5fSBqc29uLmFhRGF0YSBUaGUgZGF0YSB0byBkaXNwbGF5IG9uIHRoaXMgcGFnZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gW2pzb24uc0NvbHVtbnNdIENvbHVtbiBvcmRlcmluZyAoc05hbWUsIGNvbW1hIHNlcGFyYXRlZCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWpheFVwZGF0ZURyYXcgKCBvU2V0dGluZ3MsIGpzb24gKQoJCXsKCQkJaWYgKCBqc29uLnNFY2hvICE9PSB1bmRlZmluZWQgKQoJCQl7CgkJCQkvKiBQcm90ZWN0IGFnYWluc3Qgb2xkIHJldHVybnMgb3Zlci13cml0aW5nIGEgbmV3IG9uZS4gUG9zc2libGUgd2hlbiB5b3UgZ2V0CgkJCQkgKiB2ZXJ5IGZhc3QgaW50ZXJhY3Rpb24sIGFuZCBsYXRlciBxdWVyaWVzIGFyZSBjb21wbGV0ZWQgbXVjaCBmYXN0ZXIKCQkJCSAqLwoJCQkJaWYgKCBqc29uLnNFY2hvKjEgPCBvU2V0dGluZ3MuaURyYXcgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuaURyYXcgPSBqc29uLnNFY2hvICogMTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlIHx8CgkJCQkgICAob1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlICYmIChvU2V0dGluZ3MuYlNvcnRlZCB8fCBvU2V0dGluZ3MuYkZpbHRlcmVkKSkgKQoJCQl7CgkJCQlfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlvU2V0dGluZ3MuX2lSZWNvcmRzVG90YWwgPSBwYXJzZUludChqc29uLmlUb3RhbFJlY29yZHMsIDEwKTsKCQkJb1NldHRpbmdzLl9pUmVjb3Jkc0Rpc3BsYXkgPSBwYXJzZUludChqc29uLmlUb3RhbERpc3BsYXlSZWNvcmRzLCAxMCk7CgkJCQoJCQkvKiBEZXRlcm1pbmUgaWYgcmVvcmRlcmluZyBpcyByZXF1aXJlZCAqLwoJCQl2YXIgc09yZGVyaW5nID0gX2ZuQ29sdW1uT3JkZXJpbmcob1NldHRpbmdzKTsKCQkJdmFyIGJSZU9yZGVyID0gKGpzb24uc0NvbHVtbnMgIT09IHVuZGVmaW5lZCAmJiBzT3JkZXJpbmcgIT09ICIiICYmIGpzb24uc0NvbHVtbnMgIT0gc09yZGVyaW5nICk7CgkJCXZhciBhaUluZGV4OwoJCQlpZiAoIGJSZU9yZGVyICkKCQkJewoJCQkJYWlJbmRleCA9IF9mblJlT3JkZXJJbmRleCggb1NldHRpbmdzLCBqc29uLnNDb2x1bW5zICk7CgkJCX0KCQkJCgkJCXZhciBhRGF0YSA9IF9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKSgganNvbiApOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFEYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYlJlT3JkZXIgKQoJCQkJewoJCQkJCS8qIElmIHdlIG5lZWQgdG8gcmUtb3JkZXIsIHRoZW4gY3JlYXRlIGEgbmV3IGFycmF5IHdpdGggdGhlIGNvcnJlY3Qgb3JkZXIgYW5kIGFkZCBpdCAqLwoJCQkJCXZhciBhRGF0YVNvcnRlZCA9IFtdOwoJCQkJCWZvciAoIHZhciBqPTAsIGpMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCXsKCQkJCQkJYURhdGFTb3J0ZWQucHVzaCggYURhdGFbaV1bIGFpSW5kZXhbal0gXSApOwoJCQkJCX0KCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhU29ydGVkICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJLyogTm8gcmUtb3JkZXIgcmVxdWlyZWQsIHNldmVyIGdvdCBpdCAicmlnaHQiIC0ganVzdCBzdHJhaWdodCBhZGQgKi8KCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhW2ldICk7CgkJCQl9CgkJCX0KCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCgkJCW9TZXR0aW5ncy5iQWpheERhdGFHZXQgPSBmYWxzZTsKCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCW9TZXR0aW5ncy5iQWpheERhdGFHZXQgPSB0cnVlOwoJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgZmlsdGVyaW5nIHRleHQKCQkgKiAgQHJldHVybnMge25vZGV9IEZpbHRlciBjb250cm9sIGVsZW1lbnQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbEZpbHRlciAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgb1ByZXZpb3VzU2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCXZhciBzU2VhcmNoU3RyID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zU2VhcmNoOwoJCQlzU2VhcmNoU3RyID0gKHNTZWFyY2hTdHIuaW5kZXhPZignX0lOUFVUXycpICE9PSAtMSkgPwoJCQkgIHNTZWFyY2hTdHIucmVwbGFjZSgnX0lOUFVUXycsICc8aW5wdXQgdHlwZT0idGV4dCIgLz4nKSA6CgkJCSAgc1NlYXJjaFN0cj09PSIiID8gJzxpbnB1dCB0eXBlPSJ0ZXh0IiAvPicgOiBzU2VhcmNoU3RyKycgPGlucHV0IHR5cGU9InRleHQiIC8+JzsKCQkJCgkJCXZhciBuRmlsdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJbkZpbHRlci5jbGFzc05hbWUgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0ZpbHRlcjsKCQkJbkZpbHRlci5pbm5lckhUTUwgPSAnPGxhYmVsPicrc1NlYXJjaFN0cisnPC9sYWJlbD4nOwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuZiApCgkJCXsKCQkJCW5GaWx0ZXIuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19maWx0ZXInOwoJCQl9CgkJCQoJCQl2YXIganFGaWx0ZXIgPSAkKCdpbnB1dFt0eXBlPSJ0ZXh0Il0nLCBuRmlsdGVyKTsKCQkKCQkJLy8gU3RvcmUgYSByZWZlcmVuY2UgdG8gdGhlIGlucHV0IGVsZW1lbnQsIHNvIG90aGVyIGlucHV0IGVsZW1lbnRzIGNvdWxkIGJlCgkJCS8vIGFkZGVkIHRvIHRoZSBmaWx0ZXIgd3JhcHBlciBpZiBuZWVkZWQgKHN1Ym1pdCBidXR0b24gZm9yIGV4YW1wbGUpCgkJCW5GaWx0ZXIuX0RUX0lucHV0ID0ganFGaWx0ZXJbMF07CgkJCgkJCWpxRmlsdGVyLnZhbCggb1ByZXZpb3VzU2VhcmNoLnNTZWFyY2gucmVwbGFjZSgnIicsJyZxdW90OycpICk7CgkJCWpxRmlsdGVyLmJpbmQoICdrZXl1cC5EVCcsIGZ1bmN0aW9uKGUpIHsKCQkJCS8qIFVwZGF0ZSBhbGwgb3RoZXIgZmlsdGVyIGlucHV0IGVsZW1lbnRzIGZvciB0aGUgbmV3IGRpc3BsYXkgKi8KCQkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmY7CgkJCQl2YXIgdmFsID0gdGhpcy52YWx1ZT09PSIiID8gIiIgOiB0aGlzLnZhbHVlOyAvLyBtZW50YWwgSUU4IGZpeCA6LSgKCQkKCQkJCWZvciAoIHZhciBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggbltpXSAhPSAkKHRoaXMpLnBhcmVudHMoJ2Rpdi5kYXRhVGFibGVzX2ZpbHRlcicpWzBdICkKCQkJCQl7CgkJCQkJCSQobltpXS5fRFRfSW5wdXQpLnZhbCggdmFsICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBOb3cgZG8gdGhlIGZpbHRlciAqLwoJCQkJaWYgKCB2YWwgIT0gb1ByZXZpb3VzU2VhcmNoLnNTZWFyY2ggKQoJCQkJewoJCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIHsgCgkJCQkJCSJzU2VhcmNoIjogdmFsLCAKCQkJCQkJImJSZWdleCI6IG9QcmV2aW91c1NlYXJjaC5iUmVnZXgsCgkJCQkJCSJiU21hcnQiOiBvUHJldmlvdXNTZWFyY2guYlNtYXJ0ICwKCQkJCQkJImJDYXNlSW5zZW5zaXRpdmUiOiBvUHJldmlvdXNTZWFyY2guYkNhc2VJbnNlbnNpdGl2ZSAKCQkJCQl9ICk7CgkJCQl9CgkJCX0gKTsKCQkKCQkJanFGaWx0ZXIKCQkJCS5hdHRyKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKQoJCQkJLmJpbmQoICdrZXlwcmVzcy5EVCcsIGZ1bmN0aW9uKGUpIHsKCQkJCQkvKiBQcmV2ZW50IGZvcm0gc3VibWlzc2lvbiAqLwoJCQkJCWlmICggZS5rZXlDb2RlID09IDEzICkKCQkJCQl7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQl9CgkJCSk7CgkJCQoJCQlyZXR1cm4gbkZpbHRlcjsKCQl9CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSB0YWJsZSB1c2luZyBib3RoIHRoZSBnbG9iYWwgZmlsdGVyIGFuZCBjb2x1bW4gYmFzZWQgZmlsdGVyaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZWFyY2ggc2VhcmNoIGluZm9ybWF0aW9uCgkJICogIEBwYXJhbSB7aW50fSBbaUZvcmNlXSBmb3JjZSBhIHJlc2VhcmNoIG9mIHRoZSBtYXN0ZXIgYXJyYXkgKDEpIG9yIG5vdCAodW5kZWZpbmVkIG9yIDApCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZpbHRlckNvbXBsZXRlICggb1NldHRpbmdzLCBvSW5wdXQsIGlGb3JjZSApCgkJewoJCQl2YXIgb1ByZXZTZWFyY2ggPSBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoOwoJCQl2YXIgYW9QcmV2U2VhcmNoID0gb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sczsKCQkJdmFyIGZuU2F2ZUZpbHRlciA9IGZ1bmN0aW9uICggb0ZpbHRlciApIHsKCQkJCS8qIFNhdmUgdGhlIGZpbHRlcmluZyB2YWx1ZXMgKi8KCQkJCW9QcmV2U2VhcmNoLnNTZWFyY2ggPSBvRmlsdGVyLnNTZWFyY2g7CgkJCQlvUHJldlNlYXJjaC5iUmVnZXggPSBvRmlsdGVyLmJSZWdleDsKCQkJCW9QcmV2U2VhcmNoLmJTbWFydCA9IG9GaWx0ZXIuYlNtYXJ0OwoJCQkJb1ByZXZTZWFyY2guYkNhc2VJbnNlbnNpdGl2ZSA9IG9GaWx0ZXIuYkNhc2VJbnNlbnNpdGl2ZTsKCQkJfTsKCQkKCQkJLyogSW4gc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBhbGwgZmlsdGVyaW5nIGlzIGRvbmUgYnkgdGhlIHNlcnZlciwgc28gbm8gcG9pbnQgaGFuZ2luZyBhcm91bmQgaGVyZSAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJLyogR2xvYmFsIGZpbHRlciAqLwoJCQkJX2ZuRmlsdGVyKCBvU2V0dGluZ3MsIG9JbnB1dC5zU2VhcmNoLCBpRm9yY2UsIG9JbnB1dC5iUmVnZXgsIG9JbnB1dC5iU21hcnQsIG9JbnB1dC5iQ2FzZUluc2Vuc2l0aXZlICk7CgkJCQlmblNhdmVGaWx0ZXIoIG9JbnB1dCApOwoJCQoJCQkJLyogTm93IGRvIHRoZSBpbmRpdmlkdWFsIGNvbHVtbiBmaWx0ZXIgKi8KCQkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlfZm5GaWx0ZXJDb2x1bW4oIG9TZXR0aW5ncywgYW9QcmV2U2VhcmNoW2ldLnNTZWFyY2gsIGksIGFvUHJldlNlYXJjaFtpXS5iUmVnZXgsIAoJCQkJCQlhb1ByZXZTZWFyY2hbaV0uYlNtYXJ0LCBhb1ByZXZTZWFyY2hbaV0uYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQkJfQoJCQkJCgkJCQkvKiBDdXN0b20gZmlsdGVyaW5nICovCgkJCQlfZm5GaWx0ZXJDdXN0b20oIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJZm5TYXZlRmlsdGVyKCBvSW5wdXQgKTsKCQkJfQoJCQkKCQkJLyogVGVsbCB0aGUgZHJhdyBmdW5jdGlvbiB3ZSBoYXZlIGJlZW4gZmlsdGVyaW5nICovCgkJCW9TZXR0aW5ncy5iRmlsdGVyZWQgPSB0cnVlOwoJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoJ2ZpbHRlcicsIG9TZXR0aW5ncyk7CgkJCQoJCQkvKiBSZWRyYXcgdGhlIHRhYmxlICovCgkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQkKCQkJLyogUmVidWlsZCBzZWFyY2ggYXJyYXkgJ29mZmxpbmUnICovCgkJCV9mbkJ1aWxkU2VhcmNoQXJyYXkoIG9TZXR0aW5ncywgMCApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBseSBjdXN0b20gZmlsdGVyaW5nIGZ1bmN0aW9ucwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZpbHRlckN1c3RvbSggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhZm5GaWx0ZXJzID0gRGF0YVRhYmxlLmV4dC5hZm5GaWx0ZXJpbmc7CgkJCXZhciBhaUZpbHRlckNvbHVtbnMgPSBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiU2VhcmNoYWJsZScgKTsKCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hZm5GaWx0ZXJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXZhciBpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIHZhciBqPTAsIGpMZW49b1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCXZhciBpRGlzSW5kZXggPSBvU2V0dGluZ3MuYWlEaXNwbGF5W2otaUNvcnJlY3Rvcl07CgkJCQkJdmFyIGJUZXN0ID0gYWZuRmlsdGVyc1tpXSgKCQkJCQkJb1NldHRpbmdzLAoJCQkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGlEaXNJbmRleCwgJ2ZpbHRlcicsIGFpRmlsdGVyQ29sdW1ucyApLAoJCQkJCQlpRGlzSW5kZXgKCQkJCQkpOwoJCQkJCQoJCQkJCS8qIENoZWNrIGlmIHdlIHNob3VsZCB1c2UgdGhpcyByb3cgYmFzZWQgb24gdGhlIGZpbHRlcmluZyBmdW5jdGlvbiAqLwoJCQkJCWlmICggIWJUZXN0ICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCBqLWlDb3JyZWN0b3IsIDEgKTsKCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIHRhYmxlIG9uIGEgcGVyLWNvbHVtbiBiYXNpcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzSW5wdXQgc3RyaW5nIHRvIGZpbHRlciBvbgoJCSAqICBAcGFyYW0ge2ludH0gaUNvbHVtbiBjb2x1bW4gdG8gZmlsdGVyCgkJICogIEBwYXJhbSB7Ym9vbH0gYlJlZ2V4IHRyZWF0IHNlYXJjaCBzdHJpbmcgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNtYXJ0IHVzZSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc3RpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZpbHRlckNvbHVtbiAoIG9TZXR0aW5ncywgc0lucHV0LCBpQ29sdW1uLCBiUmVnZXgsIGJTbWFydCwgYkNhc2VJbnNlbnNpdGl2ZSApCgkJewoJCQlpZiAoIHNJbnB1dCA9PT0gIiIgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCXZhciBpSW5kZXhDb3JyZWN0b3IgPSAwOwoJCQl2YXIgcnBTZWFyY2ggPSBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNJbnB1dCwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJCgkJCWZvciAoIHZhciBpPW9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJewoJCQkJdmFyIHNEYXRhID0gX2ZuRGF0YVRvU2VhcmNoKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBvU2V0dGluZ3MuYWlEaXNwbGF5W2ldLCBpQ29sdW1uLCAnZmlsdGVyJyApLAoJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uc1R5cGUgKTsKCQkJCWlmICggISBycFNlYXJjaC50ZXN0KCBzRGF0YSApICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggaSwgMSApOwoJCQkJCWlJbmRleENvcnJlY3RvcisrOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgZGF0YSB0YWJsZSBiYXNlZCBvbiB1c2VyIGlucHV0IGFuZCBkcmF3IHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzSW5wdXQgc3RyaW5nIHRvIGZpbHRlciBvbgoJCSAqICBAcGFyYW0ge2ludH0gaUZvcmNlIG9wdGlvbmFsIC0gZm9yY2UgYSByZXNlYXJjaCBvZiB0aGUgbWFzdGVyIGFycmF5ICgxKSBvciBub3QgKHVuZGVmaW5lZCBvciAwKQoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU21hcnQgcGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc3RpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZpbHRlciggb1NldHRpbmdzLCBzSW5wdXQsIGlGb3JjZSwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJdmFyIGk7CgkJCXZhciBycFNlYXJjaCA9IF9mbkZpbHRlckNyZWF0ZVNlYXJjaCggc0lucHV0LCBiUmVnZXgsIGJTbWFydCwgYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQl2YXIgb1ByZXZTZWFyY2ggPSBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoOwoJCQkKCQkJLyogQ2hlY2sgaWYgd2UgYXJlIGZvcmNpbmcgb3Igbm90IC0gb3B0aW9uYWwgcGFyYW1ldGVyICovCgkJCWlmICggIWlGb3JjZSApCgkJCXsKCQkJCWlGb3JjZSA9IDA7CgkJCX0KCQkJCgkJCS8qIE5lZWQgdG8gdGFrZSBhY2NvdW50IG9mIGN1c3RvbSBmaWx0ZXJpbmcgZnVuY3Rpb25zIC0gYWx3YXlzIGZpbHRlciAqLwoJCQlpZiAoIERhdGFUYWJsZS5leHQuYWZuRmlsdGVyaW5nLmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCWlGb3JjZSA9IDE7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIElmIHRoZSBpbnB1dCBpcyBibGFuayAtIHdlIHdhbnQgdGhlIGZ1bGwgZGF0YSBzZXQKCQkJICovCgkJCWlmICggc0lucHV0Lmxlbmd0aCA8PSAwICkKCQkJewoJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoKTsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKgoJCQkJICogV2UgYXJlIHN0YXJ0aW5nIGEgbmV3IHNlYXJjaCBvciB0aGUgbmV3IHNlYXJjaCBzdHJpbmcgaXMgc21hbGxlciAKCQkJCSAqIHRoZW4gdGhlIG9sZCBvbmUgKGkuZS4gZGVsZXRlKS4gU2VhcmNoIGZyb20gdGhlIG1hc3RlciBhcnJheQoJCQkgCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCA9PSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCB8fAoJCQkJCSAgIG9QcmV2U2VhcmNoLnNTZWFyY2gubGVuZ3RoID4gc0lucHV0Lmxlbmd0aCB8fCBpRm9yY2UgPT0gMSB8fAoJCQkJCSAgIHNJbnB1dC5pbmRleE9mKG9QcmV2U2VhcmNoLnNTZWFyY2gpICE9PSAwICkKCQkJCXsKCQkJCQkvKiBOdWtlIHRoZSBvbGQgZGlzcGxheSBhcnJheSAtIHdlIGFyZSBnb2luZyB0byByZWJ1aWxkIGl0ICovCgkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoKTsKCQkJCQkKCQkJCQkvKiBGb3JjZSBhIHJlYnVpbGQgb2YgdGhlIHNlYXJjaCBhcnJheSAqLwoJCQkJCV9mbkJ1aWxkU2VhcmNoQXJyYXkoIG9TZXR0aW5ncywgMSApOwoJCQkJCQoJCQkJCS8qIFNlYXJjaCB0aHJvdWdoIGFsbCByZWNvcmRzIHRvIHBvcHVsYXRlIHRoZSBzZWFyY2ggYXJyYXkKCQkJCQkgKiBUaGUgdGhlIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIgYW5kIGFzRGF0YVNlYXJjaCBhcnJheXMgaGF2ZSAxIHRvIDEgCgkJCQkJICogbWFwcGluZwoJCQkJCSAqLwoJCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBycFNlYXJjaC50ZXN0KG9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0pICkKCQkJCQkJewoJCQkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5wdXNoKCBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyW2ldICk7CgkJCQkJCX0KCQkJCQl9CgkJCSAgfQoJCQkgIGVsc2UKCQkJCXsKCQkJICAJLyogVXNpbmcgb2xkIHNlYXJjaCBhcnJheSAtIHJlZmluZSBpdCAtIGRvIGl0IHRoaXMgd2F5IGZvciBzcGVlZAoJCQkgIAkgKiBEb24ndCBoYXZlIHRvIHNlYXJjaCB0aGUgd2hvbGUgbWFzdGVyIGFycmF5IGFnYWluCgkJCQkJICovCgkJCSAgCXZhciBpSW5kZXhDb3JyZWN0b3IgPSAwOwoJCQkgIAkKCQkJICAJLyogU2VhcmNoIHRoZSBjdXJyZW50IHJlc3VsdHMgKi8KCQkJICAJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYXNEYXRhU2VhcmNoLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkgIAkJaWYgKCAhIHJwU2VhcmNoLnRlc3Qob1NldHRpbmdzLmFzRGF0YVNlYXJjaFtpXSkgKQoJCQkJCQl7CgkJCSAgCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIGktaUluZGV4Q29ycmVjdG9yLCAxICk7CgkJCSAgCQkJaUluZGV4Q29ycmVjdG9yKys7CgkJCSAgCQl9CgkJCSAgCX0KCQkJICB9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGFuIGFycmF5IHdoaWNoIGNhbiBiZSBxdWlja2x5IHNlYXJjaCB0aHJvdWdoCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXN0ZXIgdXNlIHRoZSBtYXN0ZXIgZGF0YSBhcnJheSAtIG9wdGlvbmFsCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkJ1aWxkU2VhcmNoQXJyYXkgKCBvU2V0dGluZ3MsIGlNYXN0ZXIgKQoJCXsKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCS8qIENsZWFyIG91dCB0aGUgb2xkIGRhdGEgKi8KCQkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2ggPSBbXTsKCQkKCQkJCXZhciBhaUZpbHRlckNvbHVtbnMgPSBfZm5HZXRDb2x1bW5zKCBvU2V0dGluZ3MsICdiU2VhcmNoYWJsZScgKTsKCQkJCXZhciBhaUluZGV4ID0gKGlNYXN0ZXI9PT0xKSA/CgkJCQkgCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIgOgoJCQkJIAlvU2V0dGluZ3MuYWlEaXNwbGF5OwoJCQkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFpSW5kZXgubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2ldID0gX2ZuQnVpbGRTZWFyY2hSb3coCgkJCQkJCW9TZXR0aW5ncywKCQkJCQkJX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBhaUluZGV4W2ldLCAnZmlsdGVyJywgYWlGaWx0ZXJDb2x1bW5zICkKCQkJCQkpOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIHNlYXJjaGFibGUgc3RyaW5nIGZyb20gYSBzaW5nbGUgZGF0YSByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSb3cgZGF0YSBhcnJheSB0byB1c2UgZm9yIHRoZSBkYXRhIHRvIHNlYXJjaAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLCBhRGF0YSApCgkJewoJCQl2YXIgc1NlYXJjaCA9IGFEYXRhLmpvaW4oJyAgJyk7CgkJCQoJCQkvKiBJZiBpdCBsb29rcyBsaWtlIHRoZXJlIGlzIGFuIEhUTUwgZW50aXR5IGluIHRoZSBzdHJpbmcsIGF0dGVtcHQgdG8gZGVjb2RlIGl0ICovCgkJCWlmICggc1NlYXJjaC5pbmRleE9mKCcmJykgIT09IC0xICkKCQkJewoJCQkJc1NlYXJjaCA9ICQoJzxkaXY+JykuaHRtbChzU2VhcmNoKS50ZXh0KCk7CgkJCX0KCQkJCgkJCS8vIFN0cmlwIG5ld2xpbmUgY2hhcmFjdGVycwoJCQlyZXR1cm4gc1NlYXJjaC5yZXBsYWNlKCAvW1xuXHJdL2csICIgIiApOwoJCX0KCQkKCQkvKioKCQkgKiBCdWlsZCBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvYmplY3Qgc3VpdGFibGUgZm9yIHNlYXJjaGluZyBhIHRhYmxlCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU2VhcmNoIHN0cmluZyB0byBzZWFyY2ggZm9yCgkJICogIEBwYXJhbSB7Ym9vbH0gYlJlZ2V4IHRyZWF0IGFzIGEgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTbWFydCBwZXJmb3JtIHNtYXJ0IGZpbHRlcmluZyBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiQ2FzZUluc2Vuc2l0aXZlIERvIGNhc2UgaW5zZW5zaXRpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEByZXR1cm5zIHtSZWdFeHB9IGNvbnN0cnVjdGVkIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNTZWFyY2gsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBhc1NlYXJjaCwgc1JlZ0V4cFN0cmluZzsKCQkJCgkJCWlmICggYlNtYXJ0ICkKCQkJewoJCQkJLyogR2VuZXJhdGUgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byB1c2UuIFNvbWV0aGluZyBhbG9uZyB0aGUgbGluZXMgb2Y6CgkJCQkgKiBeKD89Lio/XGJvbmVcYikoPz0uKj9cYnR3b1xiKSg/PS4qP1xidGhyZWVcYikuKiQKCQkJCSAqLwoJCQkJYXNTZWFyY2ggPSBiUmVnZXggPyBzU2VhcmNoLnNwbGl0KCAnICcgKSA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICkuc3BsaXQoICcgJyApOwoJCQkJc1JlZ0V4cFN0cmluZyA9ICdeKD89Lio/Jythc1NlYXJjaC5qb2luKCAnKSg/PS4qPycgKSsnKS4qJCc7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1JlZ0V4cFN0cmluZywgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlzU2VhcmNoID0gYlJlZ2V4ID8gc1NlYXJjaCA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICk7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1NlYXJjaCwgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ29udmVydCByYXcgZGF0YSBpbnRvIHNvbWV0aGluZyB0aGF0IHRoZSB1c2VyIGNhbiBzZWFyY2ggb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNEYXRhIGRhdGEgdG8gYmUgbW9kaWZpZWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUeXBlIGRhdGEgdHlwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBzZWFyY2ggc3RyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRhdGFUb1NlYXJjaCAoIHNEYXRhLCBzVHlwZSApCgkJewoJCQlpZiAoIHR5cGVvZiBEYXRhVGFibGUuZXh0Lm9mblNlYXJjaFtzVHlwZV0gPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlyZXR1cm4gRGF0YVRhYmxlLmV4dC5vZm5TZWFyY2hbc1R5cGVdKCBzRGF0YSApOwoJCQl9CgkJCWVsc2UgaWYgKCBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQllbHNlIGlmICggc1R5cGUgPT0gImh0bWwiICkKCQkJewoJCQkJcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1tcclxuXS9nLCIgIikucmVwbGFjZSggLzwuKj8+L2csICIiICk7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSA9PT0gInN0cmluZyIgKQoJCQl7CgkJCQlyZXR1cm4gc0RhdGEucmVwbGFjZSgvW1xyXG5dL2csIiAiKTsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIHNjYXBlIGEgc3RyaW5nIHN1Y2ggdGhhdCBpdCBjYW4gYmUgdXNlZCBpbiBhIHJlZ3VsYXIgZXhwcmVzc2lvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZhbCBzdHJpbmcgdG8gZXNjYXBlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGVzY2FwZWQgc3RyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkVzY2FwZVJlZ2V4ICggc1ZhbCApCgkJewoJCQl2YXIgYWNFc2NhcGUgPSBbICcvJywgJy4nLCAnKicsICcrJywgJz8nLCAnfCcsICcoJywgJyknLCAnWycsICddJywgJ3snLCAnfScsICdcXCcsICckJywgJ14nLCAnLScgXTsKCQkJdmFyIHJlUmVwbGFjZSA9IG5ldyBSZWdFeHAoICcoXFwnICsgYWNFc2NhcGUuam9pbignfFxcJykgKyAnKScsICdnJyApOwoJCQlyZXR1cm4gc1ZhbC5yZXBsYWNlKHJlUmVwbGFjZSwgJ1xcJDEnKTsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIHRoZSBpbmZvIGRpc3BsYXkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gSW5mb3JtYXRpb24gZWxlbWVudAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbEluZm8gKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIG5JbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJbkluZm8uY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNJbmZvOwoJCQkKCQkJLyogQWN0aW9ucyB0aGF0IGFyZSB0byBiZSB0YWtlbiBvbmNlIG9ubHkgZm9yIHRoaXMgZmVhdHVyZSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuaSApCgkJCXsKCQkJCS8qIEFkZCBkcmF3IGNhbGxiYWNrICovCgkJCQlvU2V0dGluZ3MuYW9EcmF3Q2FsbGJhY2sucHVzaCggewoJCQkJCSJmbiI6IF9mblVwZGF0ZUluZm8sCgkJCQkJInNOYW1lIjogImluZm9ybWF0aW9uIgoJCQkJfSApOwoJCQkJCgkJCQkvKiBBZGQgaWQgKi8KCQkJCW5JbmZvLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfaW5mbyc7CgkJCX0KCQkJb1NldHRpbmdzLm5UYWJsZS5zZXRBdHRyaWJ1dGUoICdhcmlhLWRlc2NyaWJlZGJ5Jywgb1NldHRpbmdzLnNUYWJsZUlkKydfaW5mbycgKTsKCQkJCgkJCXJldHVybiBuSW5mbzsKCQl9CgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50cyBpbiB0aGUgZGlzcGxheQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblVwZGF0ZUluZm8gKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogU2hvdyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGFibGUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iSW5mbyB8fCBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuaS5sZW5ndGggPT09IDAgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCXZhcgoJCQkJb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLAoJCQkJaVN0YXJ0ID0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0KzEsCgkJCQlpRW5kID0gb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpLAoJCQkJaU1heCA9IG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpLAoJCQkJaVRvdGFsID0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSwKCQkJCXNPdXQ7CgkJCQoJCQlpZiAoIGlUb3RhbCA9PT0gMCAmJiBpVG90YWwgPT0gaU1heCApCgkJCXsKCQkJCS8qIEVtcHR5IHJlY29yZCBzZXQgKi8KCQkJCXNPdXQgPSBvTGFuZy5zSW5mb0VtcHR5OwoJCQl9CgkJCWVsc2UgaWYgKCBpVG90YWwgPT09IDAgKQoJCQl7CgkJCQkvKiBFbXB0eSByZWNvcmQgc2V0IGFmdGVyIGZpbHRlcmluZyAqLwoJCQkJc091dCA9IG9MYW5nLnNJbmZvRW1wdHkgKycgJysgb0xhbmcuc0luZm9GaWx0ZXJlZDsKCQkJfQoJCQllbHNlIGlmICggaVRvdGFsID09IGlNYXggKQoJCQl7CgkJCQkvKiBOb3JtYWwgcmVjb3JkIHNldCAqLwoJCQkJc091dCA9IG9MYW5nLnNJbmZvOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogUmVjb3JkIHNldCBhZnRlciBmaWx0ZXJpbmcgKi8KCQkJCXNPdXQgPSBvTGFuZy5zSW5mbyArJyAnKyBvTGFuZy5zSW5mb0ZpbHRlcmVkOwoJCQl9CgkJCgkJCS8vIENvbnZlcnQgdGhlIG1hY3JvcwoJCQlzT3V0ICs9IG9MYW5nLnNJbmZvUG9zdEZpeDsKCQkJc091dCA9IF9mbkluZm9NYWNyb3MoIG9TZXR0aW5ncywgc091dCApOwoJCQkKCQkJaWYgKCBvTGFuZy5mbkluZm9DYWxsYmFjayAhPT0gbnVsbCApCgkJCXsKCQkJCXNPdXQgPSBvTGFuZy5mbkluZm9DYWxsYmFjay5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCAKCQkJCQlvU2V0dGluZ3MsIGlTdGFydCwgaUVuZCwgaU1heCwgaVRvdGFsLCBzT3V0ICk7CgkJCX0KCQkJCgkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmk7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkkKG5baV0pLmh0bWwoIHNPdXQgKTsKCQkJfQoJCX0KCQkKCQkKCQlmdW5jdGlvbiBfZm5JbmZvTWFjcm9zICggb1NldHRpbmdzLCBzdHIgKQoJCXsKCQkJdmFyCgkJCQlpU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQrMSwKCQkJCXNTdGFydCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaVN0YXJ0ICksCgkJCQlpRW5kID0gb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpLAoJCQkJc0VuZCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaUVuZCApLAoJCQkJaVRvdGFsID0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSwKCQkJCXNUb3RhbCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaVRvdGFsICksCgkJCQlpTWF4ID0gb1NldHRpbmdzLmZuUmVjb3Jkc1RvdGFsKCksCgkJCQlzTWF4ID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpTWF4ICk7CgkJCgkJCS8vIFdoZW4gaW5maW5pdGUgc2Nyb2xsaW5nLCB3ZSBhcmUgYWx3YXlzIHN0YXJ0aW5nIGF0IDEuIF9pRGlzcGxheVN0YXJ0IGlzIHVzZWQgb25seQoJCQkvLyBpbnRlcm5hbGx5CgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlICkKCQkJewoJCQkJc1N0YXJ0ID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCAxICk7CgkJCX0KCQkKCQkJcmV0dXJuIHN0ci4KCQkJCXJlcGxhY2UoJ19TVEFSVF8nLCBzU3RhcnQpLgoJCQkJcmVwbGFjZSgnX0VORF8nLCAgIHNFbmQpLgoJCQkJcmVwbGFjZSgnX1RPVEFMXycsIHNUb3RhbCkuCgkJCQlyZXBsYWNlKCdfTUFYXycsICAgc01heCk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRpYWxpc2UgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGlBamF4U3RhcnQ9b1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkKCQkJLyogRW5zdXJlIHRoYXQgdGhlIHRhYmxlIGRhdGEgaXMgZnVsbHkgaW5pdGlhbGlzZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkluaXRpYWxpc2VkID09PSBmYWxzZSApCgkJCXsKCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7IF9mbkluaXRpYWxpc2UoIG9TZXR0aW5ncyApOyB9LCAyMDAgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgZGlzcGxheSBIVE1MIG9wdGlvbnMgKi8KCQkJX2ZuQWRkT3B0aW9uc0h0bWwoIG9TZXR0aW5ncyApOwoJCQkKCQkJLyogQnVpbGQgYW5kIGRyYXcgdGhlIGhlYWRlciAvIGZvb3RlciBmb3IgdGhlIHRhYmxlICovCgkJCV9mbkJ1aWxkSGVhZCggb1NldHRpbmdzICk7CgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQoJCQkvKiBPa2F5IHRvIHNob3cgdGhhdCBzb21ldGhpbmcgaXMgZ29pbmcgb24gbm93ICovCgkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCgkJCS8qIENhbGN1bGF0ZSBzaXplcyBmb3IgY29sdW1ucyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggIT09IG51bGwgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIElmIHRoZXJlIGlzIGRlZmF1bHQgc29ydGluZyByZXF1aXJlZCAtIGxldCdzIGRvIGl0LiBUaGUgc29ydCBmdW5jdGlvbiB3aWxsIGRvIHRoZQoJCQkgKiBkcmF3aW5nIGZvciB1cy4gT3RoZXJ3aXNlIHdlIGRyYXcgdGhlIHRhYmxlIHJlZ2FyZGxlc3Mgb2YgdGhlIEFqYXggc291cmNlIC0gdGhpcyBhbGxvd3MKCQkJICogdGhlIHRhYmxlIHRvIGxvb2sgaW5pdGlhbGlzZWQgZm9yIEFqYXggc291cmNpbmcgZGF0YSAoc2hvdyAnbG9hZGluZycgbWVzc2FnZSBwb3NzaWJseSkKCQkJICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBpZiB0aGVyZSBpcyBhbiBhamF4IHNvdXJjZSBsb2FkIHRoZSBkYXRhICovCgkJCWlmICggb1NldHRpbmdzLnNBamF4U291cmNlICE9PSBudWxsICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJdmFyIGFvRGF0YSA9IFtdOwoJCQkJX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApOwoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwgZnVuY3Rpb24oanNvbikgewoJCQkJCXZhciBhRGF0YSA9IChvU2V0dGluZ3Muc0FqYXhEYXRhUHJvcCAhPT0gIiIpID8KCQkJCQkgCV9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKShqc29uKSA6IGpzb247CgkJCgkJCQkJLyogR290IHRoZSBkYXRhIC0gYWRkIGl0IHRvIHRoZSB0YWJsZSAqLwoJCQkJCWZvciAoIGk9MCA7IGk8YURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCV9mbkFkZERhdGEoIG9TZXR0aW5ncywgYURhdGFbaV0gKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogUmVzZXQgdGhlIGluaXQgZGlzcGxheSBmb3IgY29va2llIHNhdmluZy4gV2UndmUgYWxyZWFkeSBkb25lIGEgZmlsdGVyLCBhbmQKCQkJCQkgKiB0aGVyZWZvcmUgY2xlYXJlZCBpdCBiZWZvcmUuIFNvIHdlIG5lZWQgdG8gbWFrZSBpdCBhcHBlYXIgJ2ZyZXNoJwoJCQkJCSAqLwoJCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IGlBamF4U3RhcnQ7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJCQl7CgkJCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncywganNvbiApOwoJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgaW5pdGlhbGlzYXRpb24gY29tcGxldGUgaXMgZG9uZSBhdCB0aGUgZW5kIG9mIF9mbkRyYXcgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBbanNvbl0gSlNPTiBmcm9tIHRoZSBzZXJ2ZXIgdGhhdCBjb21wbGV0ZWQgdGhlIHRhYmxlLCBpZiB1c2luZyBBamF4IHNvdXJjZQoJCSAqICAgIHdpdGggY2xpZW50LXNpZGUgcHJvY2Vzc2luZyAob3B0aW9uYWwpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRDb21wbGV0ZSAoIG9TZXR0aW5ncywganNvbiApCgkJewoJCQlvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgPSB0cnVlOwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvSW5pdENvbXBsZXRlJywgJ2luaXQnLCBbb1NldHRpbmdzLCBqc29uXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBjb21wYXRpYmlsaXR5IC0gd2hlbiBjZXJ0YWluIG9wdGlvbnMgYXJlIGdpdmVuLCBhbmQgb3RoZXJzIGFyZW4ndCwgd2UKCQkgKiBuZWVkIHRvIGR1cGxpY2F0ZSB0aGUgdmFsdWVzIG92ZXIsIGluIG9yZGVyIHRvIHByb3ZpZGUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCQkgKiB3aXRoIG9sZGVyIGxhbmd1YWdlIGZpbGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxhbmd1YWdlQ29tcGF0KCBvTGFuZ3VhZ2UgKQoJCXsKCQkJdmFyIG9EZWZhdWx0cyA9IERhdGFUYWJsZS5kZWZhdWx0cy5vTGFuZ3VhZ2U7CgkJCgkJCS8qIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IC0gaWYgdGhlcmUgaXMgbm8gc0VtcHR5VGFibGUgZ2l2ZW4sIHRoZW4gdXNlIHRoZSBzYW1lIGFzCgkJCSAqIHNaZXJvUmVjb3JkcyAtIGFzc3VtaW5nIHRoYXQgaXMgZ2l2ZW4uCgkJCSAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0VtcHR5VGFibGUgJiYgb0xhbmd1YWdlLnNaZXJvUmVjb3JkcyAmJgoJCQkJb0RlZmF1bHRzLnNFbXB0eVRhYmxlID09PSAiTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGUiICkKCQkJewoJCQkJX2ZuTWFwKCBvTGFuZ3VhZ2UsIG9MYW5ndWFnZSwgJ3NaZXJvUmVjb3JkcycsICdzRW1wdHlUYWJsZScgKTsKCQkJfQoJCQoJCQkvKiBMaWtld2lzZSB3aXRoIGxvYWRpbmcgcmVjb3JkcyAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0xvYWRpbmdSZWNvcmRzICYmIG9MYW5ndWFnZS5zWmVyb1JlY29yZHMgJiYKCQkJCW9EZWZhdWx0cy5zTG9hZGluZ1JlY29yZHMgPT09ICJMb2FkaW5nLi4uIiApCgkJCXsKCQkJCV9mbk1hcCggb0xhbmd1YWdlLCBvTGFuZ3VhZ2UsICdzWmVyb1JlY29yZHMnLCAnc0xvYWRpbmdSZWNvcmRzJyApOwoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciB1c2VyIGRpc3BsYXkgbGVuZ3RoIGNoYW5naW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge25vZGV9IERpc3BsYXkgbGVuZ3RoIGZlYXR1cmUgbm9kZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbExlbmd0aCAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQkvKiBUaGlzIGNhbiBiZSBvdmVycnVsZWQgYnkgbm90IHVzaW5nIHRoZSBfTUVOVV8gdmFyL21hY3JvIGluIHRoZSBsYW5ndWFnZSB2YXJpYWJsZSAqLwoJCQl2YXIgc05hbWUgPSAnbmFtZT0iJytvU2V0dGluZ3Muc1RhYmxlSWQrJ19sZW5ndGgiJzsKCQkJdmFyIHNTdGRNZW51ID0gJzxzZWxlY3Qgc2l6ZT0iMSIgJytzTmFtZSsnPic7CgkJCXZhciBpLCBpTGVuOwoJCQl2YXIgYUxlbmd0aE1lbnUgPSBvU2V0dGluZ3MuYUxlbmd0aE1lbnU7CgkJCQoJCQlpZiAoIGFMZW5ndGhNZW51Lmxlbmd0aCA9PSAyICYmIHR5cGVvZiBhTGVuZ3RoTWVudVswXSA9PT0gJ29iamVjdCcgJiYgCgkJCQkJdHlwZW9mIGFMZW5ndGhNZW51WzFdID09PSAnb2JqZWN0JyApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hTGVuZ3RoTWVudVswXS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXNTdGRNZW51ICs9ICc8b3B0aW9uIHZhbHVlPSInK2FMZW5ndGhNZW51WzBdW2ldKyciPicrYUxlbmd0aE1lbnVbMV1baV0rJzwvb3B0aW9uPic7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YUxlbmd0aE1lbnUubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlzU3RkTWVudSArPSAnPG9wdGlvbiB2YWx1ZT0iJythTGVuZ3RoTWVudVtpXSsnIj4nK2FMZW5ndGhNZW51W2ldKyc8L29wdGlvbj4nOwoJCQkJfQoJCQl9CgkJCXNTdGRNZW51ICs9ICc8L3NlbGVjdD4nOwoJCQkKCQkJdmFyIG5MZW5ndGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMubCApCgkJCXsKCQkJCW5MZW5ndGguaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19sZW5ndGgnOwoJCQl9CgkJCW5MZW5ndGguY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNMZW5ndGg7CgkJCW5MZW5ndGguaW5uZXJIVE1MID0gJzxsYWJlbD4nK29TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0xlbmd0aE1lbnUucmVwbGFjZSggJ19NRU5VXycsIHNTdGRNZW51ICkrJzwvbGFiZWw+JzsKCQkJCgkJCS8qCgkJCSAqIFNldCB0aGUgbGVuZ3RoIHRvIHRoZSBjdXJyZW50IGRpc3BsYXkgbGVuZ3RoIC0gdGhhbmtzIHRvIEFuZHJlYSBQYXZsb3ZpYyBmb3IgdGhpcyBmaXgsCgkJCSAqIGFuZCBTdGVmYW4gU2tvcG5payBmb3IgZml4aW5nIHRoZSBmaXghCgkJCSAqLwoJCQkkKCdzZWxlY3Qgb3B0aW9uW3ZhbHVlPSInK29TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgrJyJdJywgbkxlbmd0aCkuYXR0cigic2VsZWN0ZWQiLCB0cnVlKTsKCQkJCgkJCSQoJ3NlbGVjdCcsIG5MZW5ndGgpLmJpbmQoICdjaGFuZ2UuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQl2YXIgaVZhbCA9ICQodGhpcykudmFsKCk7CgkJCQkKCQkJCS8qIFVwZGF0ZSBhbGwgb3RoZXIgbGVuZ3RoIG9wdGlvbnMgZm9yIHRoZSBuZXcgZGlzcGxheSAqLwoJCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMubDsKCQkJCWZvciAoIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBuW2ldICE9IHRoaXMucGFyZW50Tm9kZSApCgkJCQkJewoJCQkJCQkkKCdzZWxlY3QnLCBuW2ldKS52YWwoIGlWYWwgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIFJlZHJhdyB0aGUgdGFibGUgKi8KCQkJCW9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPSBwYXJzZUludChpVmFsLCAxMCk7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCgkJCQkvKiBJZiB3ZSBoYXZlIHNwYWNlIHRvIHNob3cgZXh0cmEgcm93cyAoYmFja2luZyB1cCBmcm9tIHRoZSBlbmQgcG9pbnQgLSB0aGVuIGRvIHNvICovCgkJCQlpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQkJCgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfSApOwoJCQoJCQoJCQkkKCdzZWxlY3QnLCBuTGVuZ3RoKS5hdHRyKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCgkJCXJldHVybiBuTGVuZ3RoOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWNhbGN1bGF0ZSB0aGUgZW5kIHBvaW50IGJhc2VkIG9uIHRoZSBzdGFydCBwb2ludAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2V0IHRoZSBlbmQgcG9pbnQgb2YgdGhlIGRpc3BsYXkgLSBiYXNlZCBvbiBob3cgbWFueSBlbGVtZW50cyB0aGVyZSBhcmUKCQkJCSAqIHN0aWxsIHRvIGRpc3BsYXkKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID4gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggfHwKCQkJCQkgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kID0gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCArIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCQkgKiBOb3RlIHRoYXQgbW9zdCBvZiB0aGUgcGFnaW5nIGxvZ2ljIGlzIGRvbmUgaW4gCgkJICogRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciBkZWZhdWx0IHBhZ2luYXRpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUGFnaW5hdGlvbiBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgblBhZ2luYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJblBhZ2luYXRlLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnaW5nK29TZXR0aW5ncy5zUGFnaW5hdGlvblR5cGU7CgkJCQoJCQlEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uWyBvU2V0dGluZ3Muc1BhZ2luYXRpb25UeXBlIF0uZm5Jbml0KCBvU2V0dGluZ3MsIG5QYWdpbmF0ZSwgCgkJCQlmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQl9CgkJCSk7CgkJCQoJCQkvKiBBZGQgYSBkcmF3IGNhbGxiYWNrIGZvciB0aGUgcGFnaW5hdGlvbiBvbiBmaXJzdCBpbnN0YW5jZSwgdG8gdXBkYXRlIHRoZSBwYWdpbmcgZGlzcGxheSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkJCQkJRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvblsgb1NldHRpbmdzLnNQYWdpbmF0aW9uVHlwZSBdLmZuVXBkYXRlKCBvU2V0dGluZ3MsIGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCX0gKTsKCQkJCQl9LAoJCQkJCSJzTmFtZSI6ICJwYWdpbmF0aW9uIgoJCQkJfSApOwoJCQl9CgkJCXJldHVybiBuUGFnaW5hdGU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFsdGVyIHRoZSBkaXNwbGF5IHNldHRpbmdzIHRvIGNoYW5nZSB0aGUgcGFnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKQoJCSAqICBAcmV0dXJucyB7Ym9vbH0gdHJ1ZSBwYWdlIGhhcyBjaGFuZ2VkLCBmYWxzZSAtIG5vIGNoYW5nZSAobm8gZWZmZWN0KSBlZyAnZmlyc3QnIG9uIHBhZ2UgMQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5QYWdlQ2hhbmdlICggb1NldHRpbmdzLCBtQWN0aW9uICkKCQl7CgkJCXZhciBpT2xkU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQoJCQlpZiAoIHR5cGVvZiBtQWN0aW9uID09PSAibnVtYmVyIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG1BY3Rpb24gKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPiBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJmaXJzdCIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJwcmV2aW91cyIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoPj0wID8KCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDoKCQkJCQkwOwoJCQkJCgkJCQkvKiBDb3JyZWN0IGZvciB1bmRlci1ydW4gKi8KCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQl7CgkJCQkgIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG1BY3Rpb24gPT0gIm5leHQiICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID49IDAgKQoJCQkJewoJCQkJCS8qIE1ha2Ugc3VyZSB3ZSBhcmUgbm90IG92ZXIgcnVubmluZyB0aGUgZGlzcGxheSBhcnJheSAqLwoJCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICsgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA8IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICs9IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG1BY3Rpb24gPT0gImxhc3QiICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID49IDAgKQoJCQkJewoJCQkJCXZhciBpUGFnZXMgPSBwYXJzZUludCggKG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCktMSkgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoLCAxMCApICsgMTsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAoaVBhZ2VzLTEpICogb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDAsICJVbmtub3duIHBhZ2luZyBhY3Rpb246ICIrbUFjdGlvbiApOwoJCQl9CgkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigncGFnZScsIG9TZXR0aW5ncyk7CgkJCQoJCQlyZXR1cm4gaU9sZFN0YXJ0ICE9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydDsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIHRoZSBwcm9jZXNzaW5nIG5vZGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUHJvY2Vzc2luZyBlbGVtZW50CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgblByb2Nlc3NpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnIgKQoJCQl7CgkJCQluUHJvY2Vzc2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3Byb2Nlc3NpbmcnOwoJCQl9CgkJCW5Qcm9jZXNzaW5nLmlubmVySFRNTCA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1Byb2Nlc3Npbmc7CgkJCW5Qcm9jZXNzaW5nLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUHJvY2Vzc2luZzsKCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggblByb2Nlc3NpbmcsIG9TZXR0aW5ncy5uVGFibGUgKTsKCQkJCgkJCXJldHVybiBuUHJvY2Vzc2luZzsKCQl9CgkJCgkJCgkJLyoqCgkJICogRGlzcGxheSBvciBoaWRlIHRoZSBwcm9jZXNzaW5nIGluZGljYXRvcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNob3cgU2hvdyB0aGUgcHJvY2Vzc2luZyBpbmRpY2F0b3IgKHRydWUpIG9yIG5vdCAoZmFsc2UpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblByb2Nlc3NpbmdEaXNwbGF5ICggb1NldHRpbmdzLCBiU2hvdyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlByb2Nlc3NpbmcgKQoJCQl7CgkJCQl2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucjsKCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhbltpXS5zdHlsZS52aXNpYmlsaXR5ID0gYlNob3cgPyAidmlzaWJsZSIgOiAiaGlkZGVuIjsKCQkJCX0KCQkJfQoJCQoJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoJ3Byb2Nlc3NpbmcnLCBbb1NldHRpbmdzLCBiU2hvd10pOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBBZGQgYW55IGNvbnRyb2wgZWxlbWVudHMgZm9yIHRoZSB0YWJsZSAtIHNwZWNpZmljYWxseSBzY3JvbGxpbmcKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gTm9kZSB0byBhZGQgdG8gdGhlIERPTQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbFRhYmxlICggb1NldHRpbmdzICkKCQl7CgkJCS8qIENoZWNrIGlmIHNjcm9sbGluZyBpcyBlbmFibGVkIG9yIG5vdCAtIGlmIG5vdCB0aGVuIGxlYXZlIHRoZSBET00gdW5hbHRlcmVkICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZID09PSAiIiApCgkJCXsKCQkJCXJldHVybiBvU2V0dGluZ3MublRhYmxlOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBUaGUgSFRNTCBzdHJ1Y3R1cmUgdGhhdCB3ZSB3YW50IHRvIGdlbmVyYXRlIGluIHRoaXMgZnVuY3Rpb24gaXM6CgkJCSAqICBkaXYgLSBuU2Nyb2xsZXIKCQkJICogICAgZGl2IC0gblNjcm9sbEhlYWQKCQkJICogICAgICBkaXYgLSBuU2Nyb2xsSGVhZElubmVyCgkJCSAqICAgICAgICB0YWJsZSAtIG5TY3JvbGxIZWFkVGFibGUKCQkJICogICAgICAgICAgdGhlYWQgLSBuVGhlYWQKCQkJICogICAgZGl2IC0gblNjcm9sbEJvZHkKCQkJICogICAgICB0YWJsZSAtIG9TZXR0aW5ncy5uVGFibGUKCQkJICogICAgICAgIHRoZWFkIC0gblRoZWFkU2l6ZQoJCQkgKiAgICAgICAgdGJvZHkgLSBuVGJvZHkKCQkJICogICAgZGl2IC0gblNjcm9sbEZvb3QKCQkJICogICAgICBkaXYgLSBuU2Nyb2xsRm9vdElubmVyCgkJCSAqICAgICAgICB0YWJsZSAtIG5TY3JvbGxGb290VGFibGUKCQkJICogICAgICAgICAgdGZvb3QgLSBuVGZvb3QKCQkJICovCgkJCXZhcgoJCQkgCW5TY3JvbGxlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxIZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWRJbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxCb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEZvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsRm9vdElubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWRUYWJsZSA9IG9TZXR0aW5ncy5uVGFibGUuY2xvbmVOb2RlKGZhbHNlKSwKCQkJIAluU2Nyb2xsRm9vdFRhYmxlID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoZmFsc2UpLAoJCQkJblRoZWFkID0gb1NldHRpbmdzLm5UYWJsZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGhlYWQnKVswXSwKCQkJIAluVGZvb3QgPSBvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Zm9vdCcpLmxlbmd0aCA9PT0gMCA/IG51bGwgOiAKCQkJCQlvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Zm9vdCcpWzBdLAoJCQkJb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQoJCQluU2Nyb2xsSGVhZC5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWRJbm5lciApOwoJCQluU2Nyb2xsRm9vdC5hcHBlbmRDaGlsZCggblNjcm9sbEZvb3RJbm5lciApOwoJCQluU2Nyb2xsQm9keS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQluU2Nyb2xsZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxIZWFkICk7CgkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEJvZHkgKTsKCQkJblNjcm9sbEhlYWRJbm5lci5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWRUYWJsZSApOwoJCQluU2Nyb2xsSGVhZFRhYmxlLmFwcGVuZENoaWxkKCBuVGhlYWQgKTsKCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQluU2Nyb2xsZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxGb290ICk7CgkJCQluU2Nyb2xsRm9vdElubmVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsRm9vdFRhYmxlICk7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLmFwcGVuZENoaWxkKCBuVGZvb3QgKTsKCQkJfQoJCQkKCQkJblNjcm9sbGVyLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxXcmFwcGVyOwoJCQluU2Nyb2xsSGVhZC5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsSGVhZDsKCQkJblNjcm9sbEhlYWRJbm5lci5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsSGVhZElubmVyOwoJCQluU2Nyb2xsQm9keS5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsQm9keTsKCQkJblNjcm9sbEZvb3QuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbEZvb3Q7CgkJCW5TY3JvbGxGb290SW5uZXIuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbEZvb3RJbm5lcjsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuYkF1dG9Dc3MgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQkJblNjcm9sbEhlYWQuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwoJCQkJblNjcm9sbEZvb3Quc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLm92ZXJmbG93ID0gImF1dG8iOwoJCQl9CgkJCQoJCQluU2Nyb2xsSGVhZC5zdHlsZS5ib3JkZXIgPSAiMCI7CgkJCW5TY3JvbGxIZWFkLnN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQluU2Nyb2xsRm9vdC5zdHlsZS5ib3JkZXIgPSAiMCI7CgkJCW5TY3JvbGxIZWFkSW5uZXIuc3R5bGUud2lkdGggPSBvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyICE9PSAiIiA/CgkJCQlvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyIDogIjEwMCUiOyAvKiB3aWxsIGJlIG92ZXJ3cml0dGVuICovCgkJCQoJCQkvKiBNb2RpZnkgYXR0cmlidXRlcyB0byByZXNwZWN0IHRoZSBjbG9uZXMgKi8KCQkJblNjcm9sbEhlYWRUYWJsZS5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7CgkJCW5TY3JvbGxIZWFkVGFibGUuc3R5bGUubWFyZ2luTGVmdCA9ICIwIjsKCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5TY3JvbGxGb290VGFibGUucmVtb3ZlQXR0cmlidXRlKCdpZCcpOwoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQl9CgkJCQoJCQkvKiBNb3ZlIGNhcHRpb24gZWxlbWVudHMgZnJvbSB0aGUgYm9keSB0byB0aGUgaGVhZGVyLCBmb290ZXIgb3IgbGVhdmUgd2hlcmUgaXQgaXMKCQkJICogZGVwZW5kaW5nIG9uIHRoZSBjb25maWd1cmF0aW9uLiBOb3RlIHRoYXQgdGhlIERURCBzYXlzIHRoZXJlIGNhbiBiZSBvbmx5IG9uZSBjYXB0aW9uICovCgkJCXZhciBuQ2FwdGlvbiA9ICQob1NldHRpbmdzLm5UYWJsZSkuY2hpbGRyZW4oJ2NhcHRpb24nKTsKCQkJaWYgKCBuQ2FwdGlvbi5sZW5ndGggPiAwICkKCQkJewoJCQkJbkNhcHRpb24gPSBuQ2FwdGlvblswXTsKCQkJCWlmICggbkNhcHRpb24uX2NhcHRpb25TaWRlID09PSAidG9wIiApCgkJCQl7CgkJCQkJblNjcm9sbEhlYWRUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb24gKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBuQ2FwdGlvbi5fY2FwdGlvblNpZGUgPT09ICJib3R0b20iICYmIG5UZm9vdCApCgkJCQl7CgkJCQkJblNjcm9sbEZvb3RUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb24gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyoKCQkJICogU2l6aW5nCgkJCSAqLwoJCQkvKiBXaGVuIHgtc2Nyb2xsaW5nIGFkZCB0aGUgd2lkdGggYW5kIGEgc2Nyb2xsZXIgdG8gbW92ZSB0aGUgaGVhZGVyIHdpdGggdGhlIGJvZHkgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCApOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb1NldHRpbmdzLm9TY3JvbGwuc1ggKTsKCQkJCQoJCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICk7CQoJCQkJfQoJCQkJCgkJCQkvKiBXaGVuIHRoZSBib2R5IGlzIHNjcm9sbGVkLCB0aGVuIHdlIGFsc28gd2FudCB0byBzY3JvbGwgdGhlIGhlYWRlcnMgKi8KCQkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCggZnVuY3Rpb24gKGUpIHsKCQkJCQluU2Nyb2xsSGVhZC5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0OwoJCQkJCQoJCQkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW5TY3JvbGxGb290LnNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBXaGVuIHlzY3JvbGxpbmcsIGFkZCB0aGUgaGVpZ2h0ICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICk7CgkJCX0KCQkJCgkJCS8qIFJlZHJhdyAtIGFsaWduIGNvbHVtbnMgYWNyb3NzIHRoZSB0YWJsZXMgKi8KCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCSJmbiI6IF9mblNjcm9sbERyYXcsCgkJCQkic05hbWUiOiAic2Nyb2xsaW5nIgoJCQl9ICk7CgkJCQoJCQkvKiBJbmZpbml0ZSBzY3JvbGxpbmcgZXZlbnQgaGFuZGxlcnMgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoIGZ1bmN0aW9uKCkgewoJCQkJCS8qIFVzZSBhIGJsb2NrZXIgdG8gc3RvcCBzY3JvbGxpbmcgZnJvbSBsb2FkaW5nIG1vcmUgZGF0YSB3aGlsZSBvdGhlciBkYXRhIGlzIHN0aWxsIGxvYWRpbmcgKi8KCQkJCQlpZiAoICFvU2V0dGluZ3MuYkRyYXdpbmcgJiYgJCh0aGlzKS5zY3JvbGxUb3AoKSAhPT0gMCApCgkJCQkJewoJCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgbG9hZCB0aGUgbmV4dCBkYXRhIHNldCAqLwoJCQkJCQlpZiAoICQodGhpcykuc2Nyb2xsVG9wKCkgKyAkKHRoaXMpLmhlaWdodCgpID4gCgkJCQkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmhlaWdodCgpIC0gb1NldHRpbmdzLm9TY3JvbGwuaUxvYWRHYXAgKQoJCQkJCQl7CgkJCQkJCQkvKiBPbmx5IGRvIHRoZSByZWRyYXcgaWYgd2UgaGF2ZSB0byAtIHdlIG1pZ2h0IGJlIGF0IHRoZSBlbmQgb2YgdGhlIGRhdGEgKi8KCQkJCQkJCWlmICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAnbmV4dCcgKTsKCQkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MublNjcm9sbEhlYWQgPSBuU2Nyb2xsSGVhZDsKCQkJb1NldHRpbmdzLm5TY3JvbGxGb290ID0gblNjcm9sbEZvb3Q7CgkJCQoJCQlyZXR1cm4gblNjcm9sbGVyOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgdGhlIHZhcmlvdXMgdGFibGVzIGZvciByZXNpemluZy4gSXQncyBhIGJpdCBvZiBhIHBpZyB0aGlzIGZ1bmN0aW9uLCBidXQKCQkgKiBiYXNpY2FsbHkgdGhlIGlkZWEgdG86CgkJICogICAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCSAqICAgMi4gVGFrZSBsaXZlIG1lYXN1cmVtZW50cyBmcm9tIHRoZSBET00KCQkgKiAgIDMuIEFwcGx5IHRoZSBtZWFzdXJlbWVudHMKCQkgKiAgIDQuIENsZWFuIHVwCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbERyYXcgKCBvICkKCQl7CgkJCXZhcgoJCQkJblNjcm9sbEhlYWRJbm5lciA9IG8ublNjcm9sbEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdLAoJCQkJblNjcm9sbEhlYWRUYWJsZSA9IG5TY3JvbGxIZWFkSW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0sCgkJCQluU2Nyb2xsQm9keSA9IG8ublRhYmxlLnBhcmVudE5vZGUsCgkJCQlpLCBpTGVuLCBqLCBqTGVuLCBhbkhlYWRUb1NpemUsIGFuSGVhZFNpemVycywgYW5Gb290U2l6ZXJzLCBhbkZvb3RUb1NpemUsIG9TdHlsZSwgaVZpcywKCQkJCW5UaGVhZFNpemUsIG5UZm9vdFNpemUsCgkJCQlpV2lkdGgsIGFBcHBsaWVkPVtdLCBpU2FuaXR5V2lkdGgsCgkJCQluU2Nyb2xsRm9vdElubmVyID0gKG8ublRGb290ICE9PSBudWxsKSA/IG8ublNjcm9sbEZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdIDogbnVsbCwKCQkJCW5TY3JvbGxGb290VGFibGUgPSAoby5uVEZvb3QgIT09IG51bGwpID8gblNjcm9sbEZvb3RJbm5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGFibGUnKVswXSA6IG51bGwsCgkJCQlpZTY3ID0gby5vQnJvd3Nlci5iU2Nyb2xsT3ZlcnNpemU7CgkJCQoJCQkvKgoJCQkgKiAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSB0aGUgb2xkIG1pbmltaXNlZCB0aGVhZCBhbmQgdGZvb3QgZWxlbWVudHMgaW4gdGhlIGlubmVyIHRhYmxlICovCgkJCSQoby5uVGFibGUpLmNoaWxkcmVuKCd0aGVhZCwgdGZvb3QnKS5yZW1vdmUoKTsKCQkKCQkJLyogQ2xvbmUgdGhlIGN1cnJlbnQgaGVhZGVyIGFuZCBmb290ZXIgZWxlbWVudHMgYW5kIHRoZW4gcGxhY2UgaXQgaW50byB0aGUgaW5uZXIgdGFibGUgKi8KCQkJblRoZWFkU2l6ZSA9ICQoby5uVEhlYWQpLmNsb25lKClbMF07CgkJCW8ublRhYmxlLmluc2VydEJlZm9yZSggblRoZWFkU2l6ZSwgby5uVGFibGUuY2hpbGROb2Rlc1swXSApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5UZm9vdFNpemUgPSAkKG8ublRGb290KS5jbG9uZSgpWzBdOwoJCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGZvb3RTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzFdICk7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIDIuIFRha2UgbGl2ZSBtZWFzdXJlbWVudHMgZnJvbSB0aGUgRE9NIC0gZG8gbm90IGFsdGVyIHRoZSBET00gaXRzZWxmIQoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSBvbGQgc2l6aW5nIGFuZCBhcHBseSB0aGUgY2FsY3VsYXRlZCBjb2x1bW4gd2lkdGhzCgkJCSAqIEdldCB0aGUgdW5pcXVlIGNvbHVtbiBoZWFkZXJzIGluIHRoZSBuZXdseSBjcmVhdGVkIChjbG9uZWQpIGhlYWRlci4gV2Ugd2FudCB0byBhcHBseSB0aGUKCQkJICogY2FsY3VsYXRlZCBzaXplcyB0byB0aGlzIGhlYWRlcgoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCX0KCQkJCgkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvLCBuVGhlYWRTaXplICk7CgkJCWZvciAoIGk9MCwgaUxlbj1uVGhzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlWaXMgPSBfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCggbywgaSApOwoJCQkJblRoc1tpXS5zdHlsZS53aWR0aCA9IG8uYW9Db2x1bW5zW2lWaXNdLnNXaWR0aDsKCQkJfQoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24obikgewoJCQkJCW4uc3R5bGUud2lkdGggPSAiIjsKCQkJCX0sIG5UZm9vdFNpemUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJykgKTsKCQkJfQoJCQoJCQkvLyBJZiBzY3JvbGwgY29sbGFwc2UgaXMgZW5hYmxlZCwgd2hlbiB3ZSBwdXQgdGhlIGhlYWRlcnMgYmFjayBpbnRvIHRoZSBib2R5IGZvciBzaXppbmcsIHdlCgkJCS8vIHdpbGwgZW5kIHVwIGZvcmNpbmcgdGhlIHNjcm9sbGJhciB0byBhcHBlYXIsIG1ha2luZyBvdXIgbWVhc3VyZW1lbnRzIHdyb25nIGZvciB3aGVuIHdlCgkJCS8vIHRoZW4gaGlkZSBpdCAoZW5kIG9mIHRoaXMgZnVuY3Rpb24pLCBzbyBhZGQgdGhlIGhlYWRlciBoZWlnaHQgdG8gdGhlIGJvZHkgc2Nyb2xsZXIuCgkJCWlmICggby5vU2Nyb2xsLmJDb2xsYXBzZSAmJiBvLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gKG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCArIG8ublRIZWFkLm9mZnNldEhlaWdodCkrInB4IjsKCQkJfQoJCQkKCQkJLyogU2l6ZSB0aGUgdGFibGUgYXMgYSB3aG9sZSAqLwoJCQlpU2FuaXR5V2lkdGggPSAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCk7CgkJCWlmICggby5vU2Nyb2xsLnNYID09PSAiIiApCgkJCXsKCQkJCS8qIE5vIHggc2Nyb2xsaW5nICovCgkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9ICIxMDAlIjsKCQkJCQoJCQkJLyogSSBrbm93IHRoaXMgaXMgcnViYmlzaCAtIGJ1dCBJRTcgd2lsbCBtYWtlIHRoZSB3aWR0aCBvZiB0aGUgdGFibGUgd2hlbiAxMDAlIGluY2x1ZGUKCQkJCSAqIHRoZSBzY3JvbGxiYXIgLSB3aGljaCBpcyBzaG91bGRuJ3QuIFdoZW4gdGhlcmUgaXMgYSBzY3JvbGxiYXIgd2UgbmVlZCB0byB0YWtlIHRoaXMKCQkJCSAqIGludG8gYWNjb3VudC4KCQkJCSAqLwoJCQkJaWYgKCBpZTY3ICYmICgkKCd0Ym9keScsIG5TY3JvbGxCb2R5KS5oZWlnaHQoKSA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikgICkKCQkJCXsKCQkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgLSBvLm9TY3JvbGwuaUJhcldpZHRoKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCWlmICggby5vU2Nyb2xsLnNYSW5uZXIgIT09ICIiICkKCQkJCXsKCQkJCQkvKiB4IHNjcm9sbCBpbm5lciBoYXMgYmVlbiBnaXZlbiAtIHVzZSBpdCAqLwoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3Moby5vU2Nyb2xsLnNYSW5uZXIpOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGlTYW5pdHlXaWR0aCA9PSAkKG5TY3JvbGxCb2R5KS53aWR0aCgpICYmCgkJCQkgICAkKG5TY3JvbGxCb2R5KS5oZWlnaHQoKSA8ICQoby5uVGFibGUpLmhlaWdodCgpICkKCQkJCXsKCQkJCQkvKiBUaGVyZSBpcyB5LXNjcm9sbGluZyAtIHRyeSB0byB0YWtlIGFjY291bnQgb2YgdGhlIHkgc2Nyb2xsIGJhciAqLwoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlTYW5pdHlXaWR0aC1vLm9TY3JvbGwuaUJhcldpZHRoICk7CgkJCQkJaWYgKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgPiBpU2FuaXR5V2lkdGgtby5vU2Nyb2xsLmlCYXJXaWR0aCApCgkJCQkJewoJCQkJCQkvKiBOb3QgcG9zc2libGUgdG8gdGFrZSBhY2NvdW50IG9mIGl0ICovCgkJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlTYW5pdHlXaWR0aCApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQkvKiBBbGwgZWxzZSBmYWlscyAqLwoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlTYW5pdHlXaWR0aCApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBSZWNhbGN1bGF0ZSB0aGUgc2FuaXR5IHdpZHRoIC0gbm93IHRoYXQgd2UndmUgYXBwbGllZCB0aGUgcmVxdWlyZWQgd2lkdGgsIGJlZm9yZSBpdCB3YXMKCQkJICogYSB0ZW1wb3JhcnkgdmFyaWFibGUuIFRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSB0aGUgY29sdW1uIHdpZHRoIGNhbGN1bGF0aW9uIGlzIGRvbmUKCQkJICogYmVmb3JlIHRoaXMgdGFibGUgRE9NIGlzIGNyZWF0ZWQuCgkJCSAqLwoJCQlpU2FuaXR5V2lkdGggPSAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCk7CgkJCQoJCQkvKiBXZSB3YW50IHRoZSBoaWRkZW4gaGVhZGVyIHRvIGhhdmUgemVybyBoZWlnaHQsIHNvIHJlbW92ZSBwYWRkaW5nIGFuZCBib3JkZXJzLiBUaGVuCgkJCSAqIHNldCB0aGUgd2lkdGggYmFzZWQgb24gdGhlIHJlYWwgaGVhZGVycwoJCQkgKi8KCQkJYW5IZWFkVG9TaXplID0gby5uVEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCWFuSGVhZFNpemVycyA9IG5UaGVhZFNpemUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCQoJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplciwgblRvU2l6ZSkgewoJCQkJb1N0eWxlID0gblNpemVyLnN0eWxlOwoJCQkJb1N0eWxlLnBhZGRpbmdUb3AgPSAiMCI7CgkJCQlvU3R5bGUucGFkZGluZ0JvdHRvbSA9ICIwIjsKCQkJCW9TdHlsZS5ib3JkZXJUb3BXaWR0aCA9ICIwIjsKCQkJCW9TdHlsZS5ib3JkZXJCb3R0b21XaWR0aCA9ICIwIjsKCQkJCW9TdHlsZS5oZWlnaHQgPSAwOwoJCQkJCgkJCQlpV2lkdGggPSAkKG5TaXplcikud2lkdGgoKTsKCQkJCW5Ub1NpemUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVdpZHRoICk7CgkJCQlhQXBwbGllZC5wdXNoKCBpV2lkdGggKTsKCQkJfSwgYW5IZWFkU2l6ZXJzLCBhbkhlYWRUb1NpemUgKTsKCQkJJChhbkhlYWRTaXplcnMpLmhlaWdodCgwKTsKCQkJCgkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQkvKiBDbG9uZSB0aGUgY3VycmVudCBmb290ZXIgYW5kIHRoZW4gcGxhY2UgaXQgaW50byB0aGUgYm9keSB0YWJsZSBhcyBhICJoaWRkZW4gaGVhZGVyIiAqLwoJCQkJYW5Gb290U2l6ZXJzID0gblRmb290U2l6ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJCWFuRm9vdFRvU2l6ZSA9IG8ublRGb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQkJCgkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplciwgblRvU2l6ZSkgewoJCQkJCW9TdHlsZSA9IG5TaXplci5zdHlsZTsKCQkJCQlvU3R5bGUucGFkZGluZ1RvcCA9ICIwIjsKCQkJCQlvU3R5bGUucGFkZGluZ0JvdHRvbSA9ICIwIjsKCQkJCQlvU3R5bGUuYm9yZGVyVG9wV2lkdGggPSAiMCI7CgkJCQkJb1N0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gIjAiOwoJCQkJCW9TdHlsZS5oZWlnaHQgPSAwOwoJCQkJCQoJCQkJCWlXaWR0aCA9ICQoblNpemVyKS53aWR0aCgpOwoJCQkJCW5Ub1NpemUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVdpZHRoICk7CgkJCQkJYUFwcGxpZWQucHVzaCggaVdpZHRoICk7CgkJCQl9LCBhbkZvb3RTaXplcnMsIGFuRm9vdFRvU2l6ZSApOwoJCQkJJChhbkZvb3RTaXplcnMpLmhlaWdodCgwKTsKCQkJfQoJCQkKCQkJLyoKCQkJICogMy4gQXBwbHkgdGhlIG1lYXN1cmVtZW50cwoJCQkgKi8KCQkJCgkJCS8qICJIaWRlIiB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdGhhdCB3ZSB1c2VkIGZvciB0aGUgc2l6aW5nLiBXZSB3YW50IHRvIGFsc28gZml4IHRoZWlyIHdpZHRoCgkJCSAqIHRvIHdoYXQgdGhleSBjdXJyZW50bHkgYXJlCgkJCSAqLwoJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplcikgewoJCQkJblNpemVyLmlubmVySFRNTCA9ICIiOwoJCQkJblNpemVyLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGFBcHBsaWVkLnNoaWZ0KCkgKTsKCQkJfSwgYW5IZWFkU2l6ZXJzICk7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuU2l6ZXIpIHsKCQkJCQluU2l6ZXIuaW5uZXJIVE1MID0gIiI7CgkJCQkJblNpemVyLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGFBcHBsaWVkLnNoaWZ0KCkgKTsKCQkJCX0sIGFuRm9vdFNpemVycyApOwoJCQl9CgkJCQoJCQkvKiBTYW5pdHkgY2hlY2sgdGhhdCB0aGUgdGFibGUgaXMgb2YgYSBzZW5zaWJsZSB3aWR0aC4gSWYgbm90IHRoZW4gd2UgYXJlIGdvaW5nIHRvIGdldAoJCQkgKiBtaXNhbGlnbm1lbnQgLSB0cnkgdG8gcHJldmVudCB0aGlzIGJ5IG5vdCBhbGxvd2luZyB0aGUgdGFibGUgdG8gc2hyaW5rIGJlbG93IGl0cyBtaW4gd2lkdGgKCQkJICovCgkJCWlmICggJChvLm5UYWJsZSkub3V0ZXJXaWR0aCgpIDwgaVNhbml0eVdpZHRoICkKCQkJewoJCQkJLyogVGhlIG1pbiB3aWR0aCBkZXBlbmRzIHVwb24gaWYgd2UgaGF2ZSBhIHZlcnRpY2FsIHNjcm9sbGJhciB2aXNpYmxlIG9yIG5vdCAqLwoJCQkJdmFyIGlDb3JyZWN0aW9uID0gKChuU2Nyb2xsQm9keS5zY3JvbGxIZWlnaHQgPiBuU2Nyb2xsQm9keS5vZmZzZXRIZWlnaHQgfHwgCgkJCQkJJChuU2Nyb2xsQm9keSkuY3NzKCdvdmVyZmxvdy15JykgPT0gInNjcm9sbCIpKSA/CgkJCQkJCWlTYW5pdHlXaWR0aCtvLm9TY3JvbGwuaUJhcldpZHRoIDogaVNhbml0eVdpZHRoOwoJCQkJCgkJCQkvKiBJRTYvNyBhcmUgYSBsYXcgdW50byB0aGVtc2VsdmVzLi4uICovCgkJCQlpZiAoIGllNjcgJiYgKG5TY3JvbGxCb2R5LnNjcm9sbEhlaWdodCA+IAoJCQkJCW5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikgICkKCQkJCXsKCQkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpQ29ycmVjdGlvbi1vLm9TY3JvbGwuaUJhcldpZHRoICk7CgkJCQl9CgkJCQkKCQkJCS8qIEFwcGx5IHRoZSBjYWxjdWxhdGVkIG1pbmltdW0gd2lkdGggdG8gdGhlIHRhYmxlIHdyYXBwZXJzICovCgkJCQluU2Nyb2xsQm9keS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpQ29ycmVjdGlvbiApOwoJCQkJblNjcm9sbEhlYWRJbm5lci5wYXJlbnROb2RlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290SW5uZXIucGFyZW50Tm9kZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpQ29ycmVjdGlvbiApOwoJCQkJfQoJCQkJCgkJCQkvKiBBbmQgZ2l2ZSB0aGUgdXNlciBhIHdhcm5pbmcgdGhhdCB3ZSd2ZSBzdG9wcGVkIHRoZSB0YWJsZSBnZXR0aW5nIHRvbyBzbWFsbCAqLwoJCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJCXsKCQkJCQlfZm5Mb2coIG8sIDEsICJUaGUgdGFibGUgY2Fubm90IGZpdCBpbnRvIHRoZSBjdXJyZW50IGVsZW1lbnQgd2hpY2ggd2lsbCBjYXVzZSBjb2x1bW4iKwoJCQkJCQkiIG1pc2FsaWdubWVudC4gVGhlIHRhYmxlIGhhcyBiZWVuIGRyYXduIGF0IGl0cyBtaW5pbXVtIHBvc3NpYmxlIHdpZHRoLiIgKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCV9mbkxvZyggbywgMSwgIlRoZSB0YWJsZSBjYW5ub3QgZml0IGludG8gdGhlIGN1cnJlbnQgZWxlbWVudCB3aGljaCB3aWxsIGNhdXNlIGNvbHVtbiIrCgkJCQkJCSIgbWlzYWxpZ25tZW50LiBJbmNyZWFzZSB0aGUgc1Njcm9sbFhJbm5lciB2YWx1ZSBvciByZW1vdmUgaXQgdG8gYWxsb3cgYXV0b21hdGljIisKCQkJCQkJIiBjYWxjdWxhdGlvbiIgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICcxMDAlJyApOwoJCQkJblNjcm9sbEhlYWRJbm5lci5wYXJlbnROb2RlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICcxMDAlJyApOwoJCQkJCgkJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJCXsKCQkJCQluU2Nyb2xsRm9vdElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQl9CgkJCX0KCQkJCgkJCQoJCQkvKgoJCQkgKiA0LiBDbGVhbiB1cAoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJLyogSUU3PCBwdXRzIGEgdmVydGljYWwgc2Nyb2xsYmFyIGluIHBsYWNlICh3aGVuIGl0IHNob3VsZG4ndCBiZSkgZHVlIHRvIHN1YnRyYWN0aW5nCgkJCQkgKiB0aGUgc2Nyb2xsYmFyIGhlaWdodCBmcm9tIHRoZSB2aXNpYmxlIGRpc3BsYXksIHJhdGhlciB0aGFuIGFkZGluZyBpdCBvbi4gV2UgbmVlZCB0bwoJCQkJICogc2V0IHRoZSBoZWlnaHQgaW4gb3JkZXIgdG8gc29ydCB0aGlzLiBEb24ndCB3YW50IHRvIGRvIGl0IGluIGFueSBvdGhlciBicm93c2Vycy4KCQkJCSAqLwoJCQkJaWYgKCBpZTY3ICkKCQkJCXsKCQkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSBfZm5TdHJpbmdUb0Nzcyggby5uVGFibGUub2Zmc2V0SGVpZ2h0K28ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvLm9TY3JvbGwuc1kgIT09ICIiICYmIG8ub1Njcm9sbC5iQ29sbGFwc2UgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSBfZm5TdHJpbmdUb0Nzcyggby5vU2Nyb2xsLnNZICk7CgkJCQkKCQkJCXZhciBpRXh0cmEgPSAoby5vU2Nyb2xsLnNYICE9PSAiIiAmJiBvLm5UYWJsZS5vZmZzZXRXaWR0aCA+IG5TY3JvbGxCb2R5Lm9mZnNldFdpZHRoKSA/CgkJCQkgCW8ub1Njcm9sbC5pQmFyV2lkdGggOiAwOwoJCQkJaWYgKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQgPCBuU2Nyb2xsQm9keS5vZmZzZXRIZWlnaHQgKQoJCQkJewoJCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQraUV4dHJhICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEZpbmFsbHkgc2V0IHRoZSB3aWR0aCdzIG9mIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0YWJsZXMgKi8KCQkJdmFyIGlPdXRlcldpZHRoID0gJChvLm5UYWJsZSkub3V0ZXJXaWR0aCgpOwoJCQluU2Nyb2xsSGVhZFRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCW5TY3JvbGxIZWFkSW5uZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaU91dGVyV2lkdGggKTsKCQkKCQkJLy8gRmlndXJlIG91dCBpZiB0aGVyZSBhcmUgc2Nyb2xsYmFyIHByZXNlbnQgLSBpZiBzbyB0aGVuIHdlIG5lZWQgYSB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdG8KCQkJLy8gcHJvdmlkZSBhIGJpdCBtb3JlIHNwYWNlIHRvIGFsbG93ICJvdmVyZmxvdyIgc2Nyb2xsaW5nIChpLmUuIHBhc3QgdGhlIHNjcm9sbGJhcikKCQkJdmFyIGJTY3JvbGxpbmcgPSAkKG8ublRhYmxlKS5oZWlnaHQoKSA+IG5TY3JvbGxCb2R5LmNsaWVudEhlaWdodCB8fCAkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIjsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS5wYWRkaW5nUmlnaHQgPSBiU2Nyb2xsaW5nID8gby5vU2Nyb2xsLmlCYXJXaWR0aCsicHgiIDogIjBweCI7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS5wYWRkaW5nUmlnaHQgPSBiU2Nyb2xsaW5nID8gby5vU2Nyb2xsLmlCYXJXaWR0aCsicHgiIDogIjBweCI7CgkJCX0KCQkKCQkJLyogQWRqdXN0IHRoZSBwb3NpdGlvbiBvZiB0aGUgaGVhZGVyIGluIGNhc2Ugd2UgbG9vc2UgdGhlIHktc2Nyb2xsYmFyICovCgkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCgpOwoJCQkKCQkJLyogSWYgc29ydGluZyBvciBmaWx0ZXJpbmcgaGFzIG9jY3VycmVkLCBqdW1wIHRoZSBzY3JvbGxpbmcgYmFjayB0byB0aGUgdG9wICovCgkJCWlmICggby5iU29ydGVkIHx8IG8uYkZpbHRlcmVkICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc2Nyb2xsVG9wID0gMDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBseSBhIGdpdmVuIGZ1bmN0aW9uIHRvIHRoZSBkaXNwbGF5IGNoaWxkIG5vZGVzIG9mIGFuIGVsZW1lbnQgYXJyYXkgKHR5cGljYWxseQoJCSAqIFREIGNoaWxkcmVuIG9mIFRSIHJvd3MKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gTWV0aG9kIHRvIGFwcGx5IHRvIHRoZSBvYmplY3RzCgkJICogIEBwYXJhbSBhcnJheSB7bm9kZXN9IGFuMSBMaXN0IG9mIGVsZW1lbnRzIHRvIGxvb2sgdGhyb3VnaCBmb3IgZGlzcGxheSBjaGlsZHJlbgoJCSAqICBAcGFyYW0gYXJyYXkge25vZGVzfSBhbjIgQW5vdGhlciBsaXN0IChpZGVudGljYWwgc3RydWN0dXJlIHRvIHRoZSBmaXJzdCkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BcHBseVRvQ2hpbGRyZW4oIGZuLCBhbjEsIGFuMiApCgkJewoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFuMS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPWFuMVtpXS5jaGlsZE5vZGVzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBhbjFbaV0uY2hpbGROb2Rlc1tqXS5ub2RlVHlwZSA9PSAxICkKCQkJCQl7CgkJCQkJCWlmICggYW4yICkKCQkJCQkJewoJCQkJCQkJZm4oIGFuMVtpXS5jaGlsZE5vZGVzW2pdLCBhbjJbaV0uY2hpbGROb2Rlc1tqXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJZm4oIGFuMVtpXS5jaGlsZE5vZGVzW2pdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogQ29udmVydCBhIENTUyB1bml0IHdpZHRoIHRvIHBpeGVscyAoZS5nLiAyZW0pCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzV2lkdGggd2lkdGggdG8gYmUgY29udmVydGVkCgkJICogIEBwYXJhbSB7bm9kZX0gblBhcmVudCBwYXJlbnQgdG8gZ2V0IHRoZSB3aXRoIGZvciAocmVxdWlyZWQgZm9yIHJlbGF0aXZlIHdpZHRocykgLSBvcHRpb25hbAoJCSAqICBAcmV0dXJucyB7aW50fSBpV2lkdGggd2lkdGggaW4gcGl4ZWxzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbnZlcnRUb1dpZHRoICggc1dpZHRoLCBuUGFyZW50ICkKCQl7CgkJCWlmICggIXNXaWR0aCB8fCBzV2lkdGggPT09IG51bGwgfHwgc1dpZHRoID09PSAnJyApCgkJCXsKCQkJCXJldHVybiAwOwoJCQl9CgkJCQoJCQlpZiAoICFuUGFyZW50ICkKCQkJewoJCQkJblBhcmVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF07CgkJCX0KCQkJCgkJCXZhciBpV2lkdGg7CgkJCXZhciBuVG1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKTsKCQkJblRtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBzV2lkdGggKTsKCQkJCgkJCW5QYXJlbnQuYXBwZW5kQ2hpbGQoIG5UbXAgKTsKCQkJaVdpZHRoID0gblRtcC5vZmZzZXRXaWR0aDsKCQkJblBhcmVudC5yZW1vdmVDaGlsZCggblRtcCApOwoJCQkKCQkJcmV0dXJuICggaVdpZHRoICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENhbGN1bGF0ZSB0aGUgd2lkdGggb2YgY29sdW1ucyBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpVGFibGVXaWR0aCA9IG9TZXR0aW5ncy5uVGFibGUub2Zmc2V0V2lkdGg7CgkJCXZhciBpVXNlcklucHV0cyA9IDA7CgkJCXZhciBpVG1wV2lkdGg7CgkJCXZhciBpVmlzaWJsZUNvbHVtbnMgPSAwOwoJCQl2YXIgaUNvbHVtcyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgaSwgaUluZGV4LCBpQ29ycmVjdG9yLCBpV2lkdGg7CgkJCXZhciBvSGVhZGVycyA9ICQoJ3RoJywgb1NldHRpbmdzLm5USGVhZCk7CgkJCXZhciB3aWR0aEF0dHIgPSBvU2V0dGluZ3MublRhYmxlLmdldEF0dHJpYnV0ZSgnd2lkdGgnKTsKCQkJCgkJCS8qIENvbnZlcnQgYW55IHVzZXIgaW5wdXQgc2l6ZXMgaW50byBwaXhlbCBzaXplcyAqLwoJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bXMgOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJewoJCQkJCWlWaXNpYmxlQ29sdW1ucysrOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJaVRtcFdpZHRoID0gX2ZuQ29udmVydFRvV2lkdGgoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoT3JpZywgCgkJCQkJCQlvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGUgKTsKCQkJCQkJaWYgKCBpVG1wV2lkdGggIT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG1wV2lkdGggKTsKCQkJCQkJfQoJCQkJCQkJCgkJCQkJCWlVc2VySW5wdXRzKys7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIERPTSBlcXVhbHMgdGhlIG51bWJlciB0aGF0IHdlIGhhdmUgdG8gcHJvY2VzcyBpbiAKCQkJICogRGF0YVRhYmxlcywgdGhlbiB3ZSBjYW4gdXNlIHRoZSBvZmZzZXRzIHRoYXQgYXJlIGNyZWF0ZWQgYnkgdGhlIHdlYi1icm93c2VyLiBObyBjdXN0b20gCgkJCSAqIHNpemVzIGNhbiBiZSBzZXQgaW4gb3JkZXIgZm9yIHRoaXMgdG8gaGFwcGVuLCBub3Igc2Nyb2xsaW5nIHVzZWQKCQkJICovCgkJCWlmICggaUNvbHVtcyA9PSBvSGVhZGVycy5sZW5ndGggJiYgaVVzZXJJbnB1dHMgPT09IDAgJiYgaVZpc2libGVDb2x1bW5zID09IGlDb2x1bXMgJiYKCQkJCW9TZXR0aW5ncy5vU2Nyb2xsLnNYID09PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWSA9PT0gIiIgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVG1wV2lkdGggPSAkKG9IZWFkZXJzW2ldKS53aWR0aCgpOwoJCQkJCWlmICggaVRtcFdpZHRoICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUbXBXaWR0aCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIE90aGVyd2lzZSB3ZSBhcmUgZ29pbmcgdG8gaGF2ZSB0byBkbyBzb21lIGNhbGN1bGF0aW9ucyB0byBnZXQgdGhlIHdpZHRoIG9mIGVhY2ggY29sdW1uLgoJCQkJICogQ29uc3RydWN0IGEgMSByb3cgdGFibGUgd2l0aCB0aGUgd2lkZXN0IG5vZGUgaW4gdGhlIGRhdGEsIGFuZCBhbnkgdXNlciBkZWZpbmVkIHdpZHRocywKCQkJCSAqIHRoZW4gaW5zZXJ0IGl0IGludG8gdGhlIERPTSBhbmQgYWxsb3cgdGhlIGJyb3dzZXIgdG8gZG8gYWxsIHRoZSBoYXJkIHdvcmsgb2YKCQkJCSAqIGNhbGN1bGF0aW5nIHRhYmxlIHdpZHRocy4KCQkJCSAqLwoJCQkJdmFyCgkJCQkJbkNhbGNUbXAgPSBvU2V0dGluZ3MublRhYmxlLmNsb25lTm9kZSggZmFsc2UgKSwKCQkJCQluVGhlYWRDbG9uZSA9IG9TZXR0aW5ncy5uVEhlYWQuY2xvbmVOb2RlKHRydWUpLAoJCQkJCW5Cb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3Rib2R5JyApLAoJCQkJCW5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0cicgKSwKCQkJCQluRGl2U2l6aW5nOwoJCQkJCgkJCQluQ2FsY1RtcC5yZW1vdmVBdHRyaWJ1dGUoICJpZCIgKTsKCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBuVGhlYWRDbG9uZSApOwoJCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICE9PSBudWxsICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5URm9vdC5jbG9uZU5vZGUodHJ1ZSkgKTsKCQkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG4pIHsKCQkJCQkJbi5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCX0sIG5DYWxjVG1wLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpICk7CgkJCQl9CgkJCQkKCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBuQm9keSApOwoJCQkJbkJvZHkuYXBwZW5kQ2hpbGQoIG5UciApOwoJCQkJCgkJCQkvKiBSZW1vdmUgYW55IHNpemluZyB0aGF0IHdhcyBwcmV2aW91c2x5IGFwcGxpZWQgYnkgdGhlIHN0eWxlcyAqLwoJCQkJdmFyIGpxQ29sU2l6aW5nID0gJCgndGhlYWQgdGgnLCBuQ2FsY1RtcCk7CgkJCQlpZiAoIGpxQ29sU2l6aW5nLmxlbmd0aCA9PT0gMCApCgkJCQl7CgkJCQkJanFDb2xTaXppbmcgPSAkKCd0Ym9keSB0cjplcSgwKT50ZCcsIG5DYWxjVG1wKTsKCQkJCX0KCQkKCQkJCS8qIEFwcGx5IGN1c3RvbSBzaXppbmcgdG8gdGhlIGNsb25lZCBoZWFkZXIgKi8KCQkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsIG5UaGVhZENsb25lICk7CgkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtcyA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIG9Db2x1bW4gPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldOwoJCQkJCWlmICggb0NvbHVtbi5iVmlzaWJsZSAmJiBvQ29sdW1uLnNXaWR0aE9yaWcgIT09IG51bGwgJiYgb0NvbHVtbi5zV2lkdGhPcmlnICE9PSAiIiApCgkJCQkJewoJCQkJCQluVGhzW2ktaUNvcnJlY3Rvcl0uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb0NvbHVtbi5zV2lkdGhPcmlnICk7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKCBvQ29sdW1uLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCW5UaHNbaS1pQ29ycmVjdG9yXS5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJfQoJCQkJfQoJCQoJCQkJLyogRmluZCB0aGUgYmlnZ2VzdCB0ZCBmb3IgZWFjaCBjb2x1bW4gYW5kIHB1dCBpdCBpbnRvIHRoZSB0YWJsZSAqLwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJdmFyIG5UZCA9IF9mbkdldFdpZGVzdE5vZGUoIG9TZXR0aW5ncywgaSApOwoJCQkJCQlpZiAoIG5UZCAhPT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW5UZCA9IG5UZC5jbG9uZU5vZGUodHJ1ZSk7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NvbnRlbnRQYWRkaW5nICE9PSAiIiApCgkJCQkJCQl7CgkJCQkJCQkJblRkLmlubmVySFRNTCArPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDb250ZW50UGFkZGluZzsKCQkJCQkJCX0KCQkJCQkJCW5Uci5hcHBlbmRDaGlsZCggblRkICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSB0YWJsZSBhbmQgJ2Rpc3BsYXknIGl0ICovCgkJCQl2YXIgbldyYXBwZXIgPSBvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGU7CgkJCQluV3JhcHBlci5hcHBlbmRDaGlsZCggbkNhbGNUbXAgKTsKCQkJCQoJCQkJLyogV2hlbiBzY3JvbGxpbmcgKFggb3IgWSkgd2Ugd2FudCB0byBzZXQgdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSBhcyBhcHByb3ByaWF0ZS4gSG93ZXZlciwKCQkJCSAqIHdoZW4gbm90IHNjcm9sbGluZyBsZWF2ZSB0aGUgdGFibGUgd2lkdGggYXMgaXQgaXMuIFRoaXMgcmVzdWx0cyBpbiBzbGlnaHRseSBkaWZmZXJlbnQsCgkJCQkgKiBidXQgSSB0aGluayBjb3JyZWN0IGJlaGF2aW91cgoJCQkJICovCgkJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyICE9PSAiIiApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvU2V0dGluZ3Mub1Njcm9sbC5zWElubmVyKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gIiI7CgkJCQkJaWYgKCAkKG5DYWxjVG1wKS53aWR0aCgpIDwgbldyYXBwZXIub2Zmc2V0V2lkdGggKQoJCQkJCXsKCQkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggbldyYXBwZXIub2Zmc2V0V2lkdGggKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBuV3JhcHBlci5vZmZzZXRXaWR0aCApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIHdpZHRoQXR0ciApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggd2lkdGhBdHRyICk7CgkJCQl9CgkJCQluQ2FsY1RtcC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CgkJCQkKCQkJCS8qIFNjcm9sbGluZyBjb25zaWRlcmF0aW9ucyAqLwoJCQkJX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QoIG9TZXR0aW5ncywgbkNhbGNUbXAgKTsKCQkJCQoJCQkJLyogUmVhZCB0aGUgd2lkdGgncyBjYWxjdWxhdGVkIGJ5IHRoZSBicm93c2VyIGFuZCBzdG9yZSB0aGVtIGZvciB1c2UgYnkgdGhlIGNhbGxlci4gV2UKCQkJCSAqIGZpcnN0IG9mIGFsbCB0cnkgdG8gdXNlIHRoZSBlbGVtZW50cyBpbiB0aGUgYm9keSwgYnV0IGl0IGlzIHBvc3NpYmxlIHRoYXQgdGhlcmUgYXJlCgkJCQkgKiBubyBlbGVtZW50cyB0aGVyZSwgdW5kZXIgd2hpY2ggY2lyY3Vtc3RhbmNlcyB3ZSB1c2UgdGhlIGhlYWRlciBlbGVtZW50cwoJCQkJICovCgkJCQl2YXIgb05vZGVzID0gJCgidGJvZHkgdHI6ZXEoMCkiLCBuQ2FsY1RtcCkuY2hpbGRyZW4oKTsKCQkJCWlmICggb05vZGVzLmxlbmd0aCA9PT0gMCApCgkJCQl7CgkJCQkJb05vZGVzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsICQoJ3RoZWFkJywgbkNhbGNUbXApWzBdICk7CgkJCQl9CgkJCgkJCQkvKiBCcm93c2VycyBuZWVkIGEgYml0IG9mIGEgaGFuZCB3aGVuIGEgd2lkdGggaXMgYXNzaWduZWQgdG8gYW55IGNvbHVtbnMgd2hlbiAKCQkJCSAqIHgtc2Nyb2xsaW5nIGFzIHRoZXkgdGVuZCB0byBjb2xsYXBzZSB0aGUgdGFibGUgdG8gdGhlIG1pbi13aWR0aCwgZXZlbiBpZgoJCQkJICogd2Ugc2VudCB0aGUgY29sdW1uIHdpZHRocy4gU28gd2UgbmVlZCB0byBrZWVwIHRyYWNrIG9mIHdoYXQgdGhlIHRhYmxlIHdpZHRoCgkJCQkgKiBzaG91bGQgYmUgYnkgc3VtbWluZyB0aGUgdXNlciBnaXZlbiB2YWx1ZXMsIGFuZCB0aGUgYXV0b21hdGljIHZhbHVlcwoJCQkJICovCgkJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCQl7CgkJCQkJdmFyIGlUb3RhbCA9IDA7CgkJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoT3JpZyA9PT0gbnVsbCApCgkJCQkJCQl7CgkJCQkJCQkJaVRvdGFsICs9ICQob05vZGVzW2lDb3JyZWN0b3JdKS5vdXRlcldpZHRoKCk7CgkJCQkJCQl9CgkJCQkJCQllbHNlCgkJCQkJCQl7CgkJCQkJCQkJaVRvdGFsICs9IHBhcnNlSW50KG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoLnJlcGxhY2UoJ3B4JywnJyksIDEwKSArCgkJCQkJCQkJCSgkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkub3V0ZXJXaWR0aCgpIC0gJChvTm9kZXNbaUNvcnJlY3Rvcl0pLndpZHRoKCkpOwoJCQkJCQkJfQoJCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUb3RhbCApOwoJCQkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRvdGFsICk7CgkJCQl9CgkJCgkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlpV2lkdGggPSAkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkud2lkdGgoKTsKCQkJCQkJaWYgKCBpV2lkdGggIT09IG51bGwgJiYgaVdpZHRoID4gMCApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlXaWR0aCApOwoJCQkJCQl9CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCgkJCQl2YXIgY3NzV2lkdGggPSAkKG5DYWxjVG1wKS5jc3MoJ3dpZHRoJyk7CgkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gKGNzc1dpZHRoLmluZGV4T2YoJyUnKSAhPT0gLTEpID8KCQkJCSAgICBjc3NXaWR0aCA6IF9mblN0cmluZ1RvQ3NzKCAkKG5DYWxjVG1wKS5vdXRlcldpZHRoKCkgKTsKCQkJCW5DYWxjVG1wLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5DYWxjVG1wICk7CgkJCX0KCQkKCQkJaWYgKCB3aWR0aEF0dHIgKQoJCQl7CgkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHdpZHRoQXR0ciApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkanVzdCBhIHRhYmxlJ3Mgd2lkdGggdG8gdGFrZSBhY2NvdW50IG9mIHNjcm9sbGluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0YWJsZSBub2RlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0ICggb1NldHRpbmdzLCBuICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCS8qIFdoZW4geS1zY3JvbGxpbmcgb25seSwgd2Ugd2FudCB0byByZW1vdmUgdGhlIHdpZHRoIG9mIHRoZSBzY3JvbGwgYmFyIHNvIHRoZSB0YWJsZQoJCQkJICogKyBzY3JvbGwgYmFyIHdpbGwgZml0IGludG8gdGhlIGFyZWEgYXZhaWFsYmxlLgoJCQkJICovCgkJCQl2YXIgaU9yaWdXaWR0aCA9ICQobikud2lkdGgoKTsKCQkJCW4uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJChuKS5vdXRlcldpZHRoKCktb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCXsKCQkJCS8qIFdoZW4geC1zY3JvbGxpbmcgYm90aCB3YXlzLCBmaXggdGhlIHRhYmxlIGF0IGl0J3MgY3VycmVudCBzaXplLCB3aXRob3V0IGFkanVzdGluZyAqLwoJCQkJbi5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG4pLm91dGVyV2lkdGgoKSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgd2lkZXN0IG5vZGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gb2YgaW50ZXJlc3QKCQkgKiAgQHJldHVybnMge3N0cmluZ30gbWF4IHN0cmluZyBsZW5ndGggZm9yIGVhY2ggY29sdW1uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFdpZGVzdE5vZGUoIG9TZXR0aW5ncywgaUNvbCApCgkJewoJCQl2YXIgaU1heEluZGV4ID0gX2ZuR2V0TWF4TGVuU3RyaW5nKCBvU2V0dGluZ3MsIGlDb2wgKTsKCQkJaWYgKCBpTWF4SW5kZXggPCAwICkKCQkJewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCQkKCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2lNYXhJbmRleF0ublRyID09PSBudWxsICkKCQkJewoJCQkJdmFyIG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwoJCQkJbi5pbm5lckhUTUwgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpTWF4SW5kZXgsIGlDb2wsICcnICk7CgkJCQlyZXR1cm4gbjsKCQkJfQoJCQlyZXR1cm4gX2ZuR2V0VGROb2RlcyhvU2V0dGluZ3MsIGlNYXhJbmRleClbaUNvbF07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbWF4aW11bSBzdHJsZW4gZm9yIGVhY2ggZGF0YSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gb2YgaW50ZXJlc3QKCQkgKiAgQHJldHVybnMge3N0cmluZ30gbWF4IHN0cmluZyBsZW5ndGggZm9yIGVhY2ggY29sdW1uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldE1heExlblN0cmluZyggb1NldHRpbmdzLCBpQ29sICkKCQl7CgkJCXZhciBpTWF4ID0gLTE7CgkJCXZhciBpTWF4SW5kZXggPSAtMTsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJdmFyIHMgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBpQ29sLCAnZGlzcGxheScgKSsiIjsKCQkJCXMgPSBzLnJlcGxhY2UoIC88Lio/Pi9nLCAiIiApOwoJCQkJaWYgKCBzLmxlbmd0aCA+IGlNYXggKQoJCQkJewoJCQkJCWlNYXggPSBzLmxlbmd0aDsKCQkJCQlpTWF4SW5kZXggPSBpOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gaU1heEluZGV4OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBlbmQgYSBDU1MgdW5pdCAob25seSBpZiByZXF1aXJlZCkgdG8gYSBzdHJpbmcKCQkgKiAgQHBhcmFtIHthcnJheX0gYUFycmF5MSBmaXJzdCBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJyYXkyIHNlY29uZCBhcnJheQoJCSAqICBAcmV0dXJucyB7aW50fSAwIGlmIG1hdGNoLCAxIGlmIGxlbmd0aCBpcyBkaWZmZXJlbnQsIDIgaWYgbm8gbWF0Y2gKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU3RyaW5nVG9Dc3MoIHMgKQoJCXsKCQkJaWYgKCBzID09PSBudWxsICkKCQkJewoJCQkJcmV0dXJuICIwcHgiOwoJCQl9CgkJCQoJCQlpZiAoIHR5cGVvZiBzID09ICdudW1iZXInICkKCQkJewoJCQkJaWYgKCBzIDwgMCApCgkJCQl7CgkJCQkJcmV0dXJuICIwcHgiOwoJCQkJfQoJCQkJcmV0dXJuIHMrInB4IjsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgaWYgdGhlIGxhc3QgY2hhcmFjdGVyIGlzIG5vdCAwLTkgKi8KCQkJdmFyIGMgPSBzLmNoYXJDb2RlQXQoIHMubGVuZ3RoLTEgKTsKCQkJaWYgKGMgPCAweDMwIHx8IGMgPiAweDM5KQoJCQl7CgkJCQlyZXR1cm4gczsKCQkJfQoJCQlyZXR1cm4gcysicHgiOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHdpZHRoIG9mIGEgc2Nyb2xsIGJhciBpbiB0aGlzIGJyb3dzZXIgYmVpbmcgdXNlZAoJCSAqICBAcmV0dXJucyB7aW50fSB3aWR0aCBpbiBwaXhlbHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2Nyb2xsQmFyV2lkdGggKCkKCQl7ICAKCQkJdmFyIGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOwoJCQl2YXIgc3R5bGUgPSBpbm5lci5zdHlsZTsKCQkJc3R5bGUud2lkdGggPSAiMTAwJSI7CgkJCXN0eWxlLmhlaWdodCA9ICIyMDBweCI7CgkJCXN0eWxlLnBhZGRpbmcgPSAiMHB4IjsKCQkJCgkJCXZhciBvdXRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlzdHlsZSA9IG91dGVyLnN0eWxlOwoJCQlzdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CgkJCXN0eWxlLnRvcCA9ICIwcHgiOwoJCQlzdHlsZS5sZWZ0ID0gIjBweCI7CgkJCXN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKCQkJc3R5bGUud2lkdGggPSAiMjAwcHgiOwoJCQlzdHlsZS5oZWlnaHQgPSAiMTUwcHgiOwoJCQlzdHlsZS5wYWRkaW5nID0gIjBweCI7CgkJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJCW91dGVyLmFwcGVuZENoaWxkKGlubmVyKTsKCQkJCgkJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3V0ZXIpOwoJCQl2YXIgdzEgPSBpbm5lci5vZmZzZXRXaWR0aDsKCQkJb3V0ZXIuc3R5bGUub3ZlcmZsb3cgPSAnc2Nyb2xsJzsKCQkJdmFyIHcyID0gaW5uZXIub2Zmc2V0V2lkdGg7CgkJCWlmICggdzEgPT0gdzIgKQoJCQl7CgkJCQl3MiA9IG91dGVyLmNsaWVudFdpZHRoOwoJCQl9CgkJCQoJCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG91dGVyKTsKCQkJcmV0dXJuICh3MSAtIHcyKTsgIAoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIG9yZGVyIG9mIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7Ym9vbH0gYkFwcGx5Q2xhc3NlcyBvcHRpb25hbCAtIHNob3VsZCB3ZSBhcHBseSBjbGFzc2VzIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Tb3J0ICggb1NldHRpbmdzLCBiQXBwbHlDbGFzc2VzICkKCQl7CgkJCXZhcgoJCQkJaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbiwKCQkJCXNEYXRhVHlwZSwgblRoLAoJCQkJYWFTb3J0ID0gW10sCgkJCSAJYWlPcmlnID0gW10sCgkJCQlvU29ydCA9IERhdGFUYWJsZS5leHQub1NvcnQsCgkJCQlhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhLAoJCQkJYW9Db2x1bW5zID0gb1NldHRpbmdzLmFvQ29sdW1ucywKCQkJCW9BcmlhID0gb1NldHRpbmdzLm9MYW5ndWFnZS5vQXJpYTsKCQkJCgkJCS8qIE5vIHNvcnRpbmcgcmVxdWlyZWQgaWYgc2VydmVyLXNpZGUgb3Igbm8gc29ydGluZyBhcnJheSAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICYmIAoJCQkJKG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoICE9PSAwIHx8IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCkgKQoJCQl7CgkJCQlhYVNvcnQgPSAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApID8KCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICkgOgoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJCQoJCQkJLyogSWYgdGhlcmUgaXMgYSBzb3J0aW5nIGRhdGEgdHlwZSwgYW5kIGEgZnVuY3Rpb24gYmVsb25naW5nIHRvIGl0LCB0aGVuIHdlIG5lZWQgdG8KCQkJCSAqIGdldCB0aGUgZGF0YSBmcm9tIHRoZSBkZXZlbG9wZXIncyBmdW5jdGlvbiBhbmQgYXBwbHkgaXQgZm9yIHRoaXMgY29sdW1uCgkJCQkgKi8KCQkJCWZvciAoIGk9MCA7IGk8YWFTb3J0Lmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIGlDb2x1bW4gPSBhYVNvcnRbaV1bMF07CgkJCQkJdmFyIGlWaXNDb2x1bW4gPSBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSggb1NldHRpbmdzLCBpQ29sdW1uICk7CgkJCQkJc0RhdGFUeXBlID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbHVtbiBdLnNTb3J0RGF0YVR5cGU7CgkJCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmblNvcnREYXRhW3NEYXRhVHlwZV0gKQoJCQkJCXsKCQkJCQkJdmFyIGFEYXRhID0gRGF0YVRhYmxlLmV4dC5hZm5Tb3J0RGF0YVtzRGF0YVR5cGVdLmNhbGwoIAoJCQkJCQkJb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLCBpQ29sdW1uLCBpVmlzQ29sdW1uCgkJCQkJCSk7CgkJCQkJCWlmICggYURhdGEubGVuZ3RoID09PSBhb0RhdGEubGVuZ3RoICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPWFvRGF0YS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGosIGlDb2x1bW4sIGFEYXRhW2pdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJldHVybmVkIGRhdGEgc29ydCBhcnJheSAoY29sICIraUNvbHVtbisiKSBpcyB0aGUgd3JvbmcgbGVuZ3RoIiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBDcmVhdGUgYSB2YWx1ZSAtIGtleSBhcnJheSBvZiB0aGUgY3VycmVudCByb3cgcG9zaXRpb25zIHN1Y2ggdGhhdCB3ZSBjYW4gdXNlIHRoZWlyCgkJCQkgKiBjdXJyZW50IHBvc2l0aW9uIGR1cmluZyB0aGUgc29ydCwgaWYgdmFsdWVzIG1hdGNoLCBpbiBvcmRlciB0byBwZXJmb3JtIHN0YWJsZSBzb3J0aW5nCgkJCQkgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYWlPcmlnWyBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyW2ldIF0gPSBpOwoJCQkJfQoJCQoJCQkJLyogQnVpbGQgYW4gaW50ZXJuYWwgZGF0YSBhcnJheSB3aGljaCBpcyBzcGVjaWZpYyB0byB0aGUgc29ydCwgc28gd2UgY2FuIGdldCBhbmQgcHJlcAoJCQkJICogdGhlIGRhdGEgdG8gYmUgc29ydGVkIG9ubHkgb25jZSwgcmF0aGVyIHRoYW4gbmVlZGluZyB0byBkbyBpdCBldmVyeSB0aW1lIHRoZSBzb3J0aW5nCgkJCQkgKiBmdW5jdGlvbiBydW5zLiBUaGlzIG1ha2UgdGhlIHNvcnRpbmcgZnVuY3Rpb24gYSB2ZXJ5IHNpbXBsZSBjb21wYXJpc29uCgkJCQkgKi8KCQkJCXZhciBpU29ydExlbiA9IGFhU29ydC5sZW5ndGg7CgkJCQl2YXIgZm5Tb3J0Rm9ybWF0LCBhRGF0YVNvcnQ7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJZm9yICggaj0wIDsgajxpU29ydExlbiA7IGorKyApCgkJCQkJewoJCQkJCQlhRGF0YVNvcnQgPSBhb0NvbHVtbnNbIGFhU29ydFtqXVswXSBdLmFEYXRhU29ydDsKCQkKCQkJCQkJZm9yICggaz0wLCBrTGVuPWFEYXRhU29ydC5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlzRGF0YVR5cGUgPSBhb0NvbHVtbnNbIGFEYXRhU29ydFtrXSBdLnNUeXBlOwoJCQkJCQkJZm5Tb3J0Rm9ybWF0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi1wcmUiIF07CgkJCQkJCQkKCQkJCQkJCWFvRGF0YVtpXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRba10gXSA9IGZuU29ydEZvcm1hdCA/CgkJCQkJCQkJZm5Tb3J0Rm9ybWF0KCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBhRGF0YVNvcnRba10sICdzb3J0JyApICkgOgoJCQkJCQkJCV9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGksIGFEYXRhU29ydFtrXSwgJ3NvcnQnICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIERvIHRoZSBzb3J0IC0gaGVyZSB3ZSB3YW50IG11bHRpLWNvbHVtbiBzb3J0aW5nIGJhc2VkIG9uIGEgZ2l2ZW4gZGF0YSBzb3VyY2UgKGNvbHVtbikKCQkJCSAqIGFuZCBzb3J0aW5nIGZ1bmN0aW9uIChmcm9tIG9Tb3J0KSBpbiBhIGNlcnRhaW4gZGlyZWN0aW9uLiBJdCdzIHJlYXNvbmFibHkgY29tcGxleCB0bwoJCQkJICogZm9sbG93IG9uIGl0J3Mgb3duLCBidXQgdGhpcyBpcyB3aGF0IHdlIHdhbnQgKGV4YW1wbGUgdHdvIGNvbHVtbiBzb3J0aW5nKToKCQkJCSAqICBmbkxvY2FsU29ydGluZyA9IGZ1bmN0aW9uKGEsYil7CgkJCQkgKiAgCXZhciBpVGVzdDsKCQkJCSAqICAJaVRlc3QgPSBvU29ydFsnc3RyaW5nLWFzYyddKCdkYXRhMTEnLCAnZGF0YTEyJyk7CgkJCQkgKiAgCWlmIChpVGVzdCAhPT0gMCkKCQkJCSAqICAJCXJldHVybiBpVGVzdDsKCQkJCSAqICAgIGlUZXN0ID0gb1NvcnRbJ251bWVyaWMtZGVzYyddKCdkYXRhMjEnLCAnZGF0YTIyJyk7CgkJCQkgKiAgICBpZiAoaVRlc3QgIT09IDApCgkJCQkgKiAgCQlyZXR1cm4gaVRlc3Q7CgkJCQkgKiAgCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCSAqICB9CgkJCQkgKiBCYXNpY2FsbHkgd2UgaGF2ZSBhIHRlc3QgZm9yIGVhY2ggc29ydGluZyBjb2x1bW4sIGlmIHRoZSBkYXRhIGluIHRoYXQgY29sdW1uIGlzIGVxdWFsLAoJCQkJICogdGVzdCB0aGUgbmV4dCBjb2x1bW4uIElmIGFsbCBjb2x1bW5zIG1hdGNoLCB0aGVuIHdlIHVzZSBhIG51bWVyaWMgc29ydCBvbiB0aGUgcm93IAoJCQkJICogcG9zaXRpb25zIGluIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5IHRvIHByb3ZpZGUgYSBzdGFibGUgc29ydC4KCQkJCSAqLwoJCQkJb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zb3J0KCBmdW5jdGlvbiAoIGEsIGIgKSB7CgkJCQkJdmFyIGssIGwsIGxMZW4sIGlUZXN0LCBhRGF0YVNvcnQsIHNEYXRhVHlwZTsKCQkJCQlmb3IgKCBrPTAgOyBrPGlTb3J0TGVuIDsgaysrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydCA9IGFvQ29sdW1uc1sgYWFTb3J0W2tdWzBdIF0uYURhdGFTb3J0OwoJCQoJCQkJCQlmb3IgKCBsPTAsIGxMZW49YURhdGFTb3J0Lmxlbmd0aCA7IGw8bExlbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCXNEYXRhVHlwZSA9IGFvQ29sdW1uc1sgYURhdGFTb3J0W2xdIF0uc1R5cGU7CgkJCQkJCQkKCQkJCQkJCWlUZXN0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi0iK2FhU29ydFtrXVsxXSBdKAoJCQkJCQkJCWFvRGF0YVthXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRbbF0gXSwKCQkJCQkJCQlhb0RhdGFbYl0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2xdIF0KCQkJCQkJCSk7CgkJCQkJCQoJCQkJCQkJaWYgKCBpVGVzdCAhPT0gMCApCgkJCQkJCQl7CgkJCQkJCQkJcmV0dXJuIGlUZXN0OwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWx0ZXIgdGhlIHNvcnRpbmcgY2xhc3NlcyB0byB0YWtlIGFjY291bnQgb2YgdGhlIGNoYW5nZXMgKi8KCQkJaWYgKCAoYkFwcGx5Q2xhc3NlcyA9PT0gdW5kZWZpbmVkIHx8IGJBcHBseUNsYXNzZXMpICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgc1RpdGxlID0gYW9Db2x1bW5zW2ldLnNUaXRsZS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJCW5UaCA9IGFvQ29sdW1uc1tpXS5uVGg7CgkJCQluVGgucmVtb3ZlQXR0cmlidXRlKCdhcmlhLXNvcnQnKTsKCQkJCW5UaC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKTsKCQkJCQoJCQkJLyogSW4gQVJJQSBvbmx5IHRoZSBmaXJzdCBzb3J0aW5nIGNvbHVtbiBjYW4gYmUgbWFya2VkIGFzIHNvcnRpbmcgLSBubyBtdWx0aS1zb3J0IG9wdGlvbiAqLwoJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCXsKCQkJCQlpZiAoIGFhU29ydC5sZW5ndGggPiAwICYmIGFhU29ydFswXVswXSA9PSBpICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc29ydCcsIGFhU29ydFswXVsxXT09ImFzYyIgPyAiYXNjZW5kaW5nIiA6ICJkZXNjZW5kaW5nIiApOwoJCQkJCQkKCQkJCQkJdmFyIG5leHRTb3J0ID0gKGFvQ29sdW1uc1tpXS5hc1NvcnRpbmdbIGFhU29ydFswXVsyXSsxIF0pID8gCgkJCQkJCQlhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWyBhYVNvcnRbMF1bMl0rMSBdIDogYW9Db2x1bW5zW2ldLmFzU29ydGluZ1swXTsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShuZXh0U29ydD09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWzBdPT0iYXNjIiA/IG9BcmlhLnNTb3J0QXNjZW5kaW5nIDogb0FyaWEuc1NvcnREZXNjZW5kaW5nKSApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgc1RpdGxlKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogVGVsbCB0aGUgZHJhdyBmdW5jdGlvbiB0aGF0IHdlIGhhdmUgc29ydGVkIHRoZSBkYXRhICovCgkJCW9TZXR0aW5ncy5iU29ydGVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdzb3J0Jywgb1NldHRpbmdzKTsKCQkJCgkJCS8qIENvcHkgdGhlIG1hc3RlciBkYXRhIGludG8gdGhlIGRyYXcgYXJyYXkgYW5kIHJlLWRyYXcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQkvKiBfZm5GaWx0ZXIoKSB3aWxsIHJlZHJhdyB0aGUgdGFibGUgZm9yIHVzICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsgLyogcmVzZXQgZGlzcGxheSBiYWNrIHRvIHBhZ2UgMCAqLwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGFjaCBhIHNvcnQgaGFuZGxlciAoY2xpY2spIHRvIGEgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgbm9kZSB0byBhdHRhY2ggdGhlIGhhbmRsZXIgdG8KCQkgKiAgQHBhcmFtIHtpbnR9IGlEYXRhSW5kZXggY29sdW1uIHNvcnRpbmcgaW5kZXgKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRBdHRhY2hMaXN0ZW5lciAoIG9TZXR0aW5ncywgbk5vZGUsIGlEYXRhSW5kZXgsIGZuQ2FsbGJhY2sgKQoJCXsKCQkJX2ZuQmluZEFjdGlvbiggbk5vZGUsIHt9LCBmdW5jdGlvbiAoZSkgewoJCQkJLyogSWYgdGhlIGNvbHVtbiBpcyBub3Qgc29ydGFibGUgLSBkb24ndCB0byBhbnl0aGluZyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmJTb3J0YWJsZSA9PT0gZmFsc2UgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJLyoKCQkJCSAqIFRoaXMgaXMgYSBsaXR0bGUgYml0IG9kZCBJIGFkbWl0Li4uIEkgZGVjbGFyZSBhIHRlbXBvcmFyeSBmdW5jdGlvbiBpbnNpZGUgdGhlIHNjb3BlIG9mCgkJCQkgKiBfZm5CdWlsZEhlYWQgYW5kIHRoZSBjbGljayBoYW5kbGVyIGluIG9yZGVyIHRoYXQgdGhlIGNvZGUgcHJlc2VudGVkIGhlcmUgY2FuIGJlIHVzZWQgCgkJCQkgKiB0d2ljZSAtIG9uY2UgZm9yIHdoZW4gYlByb2Nlc3NpbmcgaXMgZW5hYmxlZCwgYW5kIGFub3RoZXIgdGltZSBmb3Igd2hlbiBpdCBpcyAKCQkJCSAqIGRpc2FibGVkLCBhcyB3ZSBuZWVkIHRvIHBlcmZvcm0gc2xpZ2h0bHkgZGlmZmVyZW50IGFjdGlvbnMuCgkJCQkgKiAgIEJhc2ljYWxseSB0aGUgaXNzdWUgaGVyZSBpcyB0aGF0IHRoZSBKYXZhc2NyaXB0IGVuZ2luZSBpbiBtb2Rlcm4gYnJvd3NlcnMgZG9uJ3QgCgkJCQkgKiBhcHBlYXIgdG8gYWxsb3cgdGhlIHJlbmRlcmluZyBlbmdpbmUgdG8gdXBkYXRlIHRoZSBkaXNwbGF5IHdoaWxlIGl0IGlzIHN0aWxsIGV4ZWN1dGluZwoJCQkJICogaXQncyB0aHJlYWQgKHdlbGwgLSBpdCBkb2VzIGJ1dCBvbmx5IGFmdGVyIGxvbmcgaW50ZXJ2YWxzKS4gVGhpcyBtZWFucyB0aGF0IHRoZSAKCQkJCSAqICdwcm9jZXNzaW5nJyBkaXNwbGF5IGRvZXNuJ3QgYXBwZWFyIGZvciBhIHRhYmxlIHNvcnQuIFRvIGJyZWFrIHRoZSBqcyB0aHJlYWQgdXAgYSBiaXQKCQkJCSAqIEkgZm9yY2UgYW4gZXhlY3V0aW9uIGJyZWFrIGJ5IHVzaW5nIHNldFRpbWVvdXQgLSBidXQgdGhpcyBicmVha3MgdGhlIGV4cGVjdGVkIAoJCQkJICogdGhyZWFkIGNvbnRpbnVhdGlvbiBmb3IgdGhlIGVuZC1kZXZlbG9wZXIncyBwb2ludCBvZiB2aWV3ICh0aGVpciBjb2RlIHdvdWxkIGV4ZWN1dGUKCQkJCSAqIHRvbyBlYXJseSksIHNvIHdlIG9ubHkgZG8gaXQgd2hlbiB3ZSBhYnNvbHV0ZWx5IGhhdmUgdG8uCgkJCQkgKi8KCQkJCXZhciBmbklubmVyU29ydGluZyA9IGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIgaUNvbHVtbiwgaU5leHRTb3J0OwoJCQkJCQoJCQkJCS8qIElmIHRoZSBzaGlmdCBrZXkgaXMgcHJlc3NlZCB0aGVuIHdlIGFyZSBtdWx0aXBsZSBjb2x1bW4gc29ydGluZyAqLwoJCQkJCWlmICggZS5zaGlmdEtleSApCgkJCQkJewoJCQkJCQkvKiBBcmUgd2UgYWxyZWFkeSBkb2luZyBzb21lIGtpbmQgb2Ygc29ydCBvbiB0aGlzIGNvbHVtbj8gKi8KCQkJCQkJdmFyIGJGb3VuZCA9IGZhbHNlOwoJCQkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA9PSBpRGF0YUluZGV4ICkKCQkJCQkJCXsKCQkJCQkJCQliRm91bmQgPSB0cnVlOwoJCQkJCQkJCWlDb2x1bW4gPSBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdOwoJCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0rMTsKCQkJCQkJCQkKCQkJCQkJCQlpZiAoICFvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmFzU29ydGluZ1tpTmV4dFNvcnRdICkKCQkJCQkJCQl7CgkJCQkJCQkJCS8qIFJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgc29ydGluZyBvcHRpb25zLCByZW1vdmUgZnJvbSBtdWx0aS1jb2wgc29ydCAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggaSwgMSApOwoJCQkJCQkJCX0KCQkJCQkJCQllbHNlCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBNb3ZlIG9udG8gbmV4dCBzb3J0aW5nIGRpcmVjdGlvbiAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGlOZXh0U29ydDsKCQkJCQkJCQl9CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIE5vIHNvcnQgeWV0IC0gYWRkIGl0IGluICovCgkJCQkJCWlmICggYkZvdW5kID09PSBmYWxzZSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJLyogSWYgbm8gc2hpZnQga2V5IHRoZW4gc2luZ2xlIGNvbHVtbiBzb3J0ICovCgkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggPT0gMSAmJiBvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzBdID09IGlEYXRhSW5kZXggKQoJCQkJCQl7CgkJCQkJCQlpQ29sdW1uID0gb1NldHRpbmdzLmFhU29ydGluZ1swXVswXTsKCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0rMTsKCQkJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF0gKQoJCQkJCQkJewoJCQkJCQkJCWlOZXh0U29ydCA9IDA7CgkJCQkJCQl9CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0gPSBpTmV4dFNvcnQ7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggMCwgb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggKTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJLyogUnVuIHRoZSBzb3J0ICovCgkJCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJCQl9OyAvKiAvZm5Jbm5lclNvcnRpbmcgKi8KCQkJCQoJCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCQl7CgkJCQkJZm5Jbm5lclNvcnRpbmcoKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQkJc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJCWZuSW5uZXJTb3J0aW5nKCk7CgkJCQkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJCQl7CgkJCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJCQl9CgkJCQkJfSwgMCApOwoJCQkJfQoJCQkJCgkJCQkvKiBDYWxsIHRoZSB1c2VyIHNwZWNpZmllZCBjYWxsYmFjayBmdW5jdGlvbiAtIHVzZWQgZm9yIGFzeW5jIHVzZXIgaW50ZXJhY3Rpb24gKi8KCQkJCWlmICggdHlwZW9mIGZuQ2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJyApCgkJCQl7CgkJCQkJZm5DYWxsYmFjayggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogU2V0IHRoZSBzb3J0aW5nIGNsYXNzZXMgb24gdGhlIGhlYWRlciwgTm90ZTogaXQgaXMgc2FmZSB0byBjYWxsIHRoaXMgZnVuY3Rpb24gCgkJICogd2hlbiBiU29ydCBhbmQgYlNvcnRDbGFzc2VzIGFyZSBmYWxzZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGosIGpMZW4sIGlGb3VuZDsKCQkJdmFyIGFhU29ydCwgc0NsYXNzOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkKCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zU29ydEFzYyArIiAiKyBvQ2xhc3Nlcy5zU29ydERlc2MgKwoJCQkJCQkiICIrIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzcyApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZC5jb25jYXQoIG9TZXR0aW5ncy5hYVNvcnRpbmcgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJfQoJCQkKCQkJLyogQXBwbHkgdGhlIHJlcXVpcmVkIGNsYXNzZXMgdG8gdGhlIGhlYWRlciAqLwoJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQl7CgkJCQkJc0NsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzOwoJCQkJCWlGb3VuZCA9IC0xOwoJCQkJCWZvciAoIGo9MCA7IGo8YWFTb3J0Lmxlbmd0aCA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIGFhU29ydFtqXVswXSA9PSBpICkKCQkJCQkJewoJCQkJCQkJc0NsYXNzID0gKCBhYVNvcnRbal1bMV0gPT0gImFzYyIgKSA/CgkJCQkJCQkJb0NsYXNzZXMuc1NvcnRBc2MgOiBvQ2xhc3Nlcy5zU29ydERlc2M7CgkJCQkJCQlpRm91bmQgPSBqOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIHNDbGFzcyApOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQkJCXsKCQkJCQkJLyogalF1ZXJ5IFVJIHVzZXMgZXh0cmEgbWFya3VwICovCgkJCQkJCXZhciBqcVNwYW4gPSAkKCJzcGFuLiIrb0NsYXNzZXMuc1NvcnRJY29uLCAgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpOwoJCQkJCQlqcVNwYW4ucmVtb3ZlQ2xhc3Mob0NsYXNzZXMuc1NvcnRKVUlBc2MgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlEZXNjICsiICIrIAoJCQkJCQkJb0NsYXNzZXMuc1NvcnRKVUkgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlBc2NBbGxvd2VkICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQgKTsKCQkJCQkJCgkJCQkJCXZhciBzU3BhbkNsYXNzOwoJCQkJCQlpZiAoIGlGb3VuZCA9PSAtMSApCgkJCQkJCXsKCQkJCQkJIAlzU3BhbkNsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzSlVJOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBhYVNvcnRbaUZvdW5kXVsxXSA9PSAiYXNjIiApCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSUFzYzsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSURlc2M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCWpxU3Bhbi5hZGRDbGFzcyggc1NwYW5DbGFzcyApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQkvKiBObyBzb3J0aW5nIG9uIHRoaXMgY29sdW1uLCBzbyBhZGQgdGhlIGJhc2UgY2xhc3MuIFRoaXMgd2lsbCBoYXZlIGJlZW4gYXNzaWduZWQgYnkKCQkJCQkgKiBfZm5BZGRDb2x1bW4KCQkJCQkgKi8KCQkJCQkkKG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIAoJCQkgKiBBcHBseSB0aGUgcmVxdWlyZWQgY2xhc3NlcyB0byB0aGUgdGFibGUgYm9keQoJCQkgKiBOb3RlIHRoYXQgdGhpcyBpcyBnaXZlbiBhcyBhIGZlYXR1cmUgc3dpdGNoIHNpbmNlIGl0IGNhbiBzaWduaWZpY2FudGx5IHNsb3cgZG93biBhIHNvcnQKCQkJICogb24gbGFyZ2UgZGF0YSBzZXRzIChhZGRpbmcgYW5kIHJlbW92aW5nIG9mIGNsYXNzZXMgaXMgYWx3YXlzIHNsb3cgYXQgdGhlIGJlc3Qgb2YgdGltZXMuLikKCQkJICogRnVydGhlciB0byB0aGlzLCBub3RlIHRoYXQgdGhpcyBjb2RlIGlzIGFkbWl0dGVkbHkgZmFpcmx5IHVnbHkuIEl0IGNvdWxkIGJlIG1hZGUgYSBsb3QgCgkJCSAqIHNpbXBsZXIgdXNpbmcgalF1ZXJ5IHNlbGVjdG9ycyBhbmQgYWRkL3JlbW92ZUNsYXNzLCBidXQgdGhhdCBpcyBzaWduaWZpY2FudGx5IHNsb3dlcgoJCQkgKiAob24gdGhlIG9yZGVyIG9mIDUgdGltZXMgc2xvd2VyKSAtIGhlbmNlIHRoZSBkaXJlY3QgRE9NIG1hbmlwdWxhdGlvbiBoZXJlLgoJCQkgKiBOb3RlIHRoYXQgZm9yIGRlZmVycmVkIGRyYXdpbmcgd2UgZG8gdXNlIGpRdWVyeSAtIHRoZSByZWFzb24gYmVpbmcgdGhhdCB0YWtpbmcgdGhlIGZpcnN0CgkJCSAqIHJvdyBmb3VuZCB0byBzZWUgaWYgdGhlIHdob2xlIGNvbHVtbiBuZWVkcyBwcm9jZXNzZWQgY2FuIG1pc3MgY2xhc3NlcyBzaW5jZSB0aGUgZmlyc3QKCQkJICogY29sdW1uIG1pZ2h0IGJlIG5ldy4KCQkJICovCgkJCXNDbGFzcyA9IG9DbGFzc2VzLnNTb3J0Q29sdW1uOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnRDbGFzc2VzICkKCQkJewoJCQkJdmFyIG5UZHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MgKTsKCQkKCQkJCS8qIFJlbW92ZSB0aGUgb2xkIGNsYXNzZXMgKi8KCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQkJewoJCQkJCSQoblRkcykucmVtb3ZlQ2xhc3Moc0NsYXNzKycxICcrc0NsYXNzKycyICcrc0NsYXNzKyczJyk7CgkJCQl9CgkJCQllbHNlIGlmICggblRkcy5sZW5ndGggPj0gaUNvbHVtbnMgKQoJCQkJewoJCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBuVGRzW2ldLmNsYXNzTmFtZS5pbmRleE9mKHNDbGFzcysiMSIpICE9IC0xICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPShuVGRzLmxlbmd0aC9pQ29sdW1ucykgOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCW5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZSA9IAoJCQkJCQkJCQkkLnRyaW0oIG5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZS5yZXBsYWNlKCBzQ2xhc3MrIjEiLCAiIiApICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIG5UZHNbaV0uY2xhc3NOYW1lLmluZGV4T2Yoc0NsYXNzKyIyIikgIT0gLTEgKQoJCQkJCQl7CgkJCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lID0gCgkJCQkJCQkJCSQudHJpbSggblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lLnJlcGxhY2UoIHNDbGFzcysiMiIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQllbHNlIGlmICggblRkc1tpXS5jbGFzc05hbWUuaW5kZXhPZihzQ2xhc3MrIjMiKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGo9MCwgakxlbj0oblRkcy5sZW5ndGgvaUNvbHVtbnMpIDsgajxqTGVuIDsgaisrICkKCQkJCQkJCXsKCQkJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUgPSAKCQkJCQkJCQkJJC50cmltKCBuVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUucmVwbGFjZSggIiAiK3NDbGFzcysiMyIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQWRkIHRoZSBuZXcgY2xhc3NlcyB0byB0aGUgdGFibGUgKi8KCQkJCXZhciBpQ2xhc3MgPSAxLCBpVGFyZ2V0Q29sOwoJCQkJZm9yICggaT0wIDsgaTxhYVNvcnQubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVGFyZ2V0Q29sID0gcGFyc2VJbnQoIGFhU29ydFtpXVswXSwgMTAgKTsKCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJewoJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpVGFyZ2V0Q29sXS5jbGFzc05hbWUgKz0gIiAiK3NDbGFzcytpQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggaUNsYXNzIDwgMyApCgkJCQkJewoJCQkJCQlpQ2xhc3MrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogU2F2ZSB0aGUgc3RhdGUgb2YgYSB0YWJsZSBpbiBhIGNvb2tpZSBzdWNoIHRoYXQgdGhlIHBhZ2UgY2FuIGJlIHJlbG9hZGVkCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2F2ZVN0YXRlICggb1NldHRpbmdzICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSB8fCBvU2V0dGluZ3MuYkRlc3Ryb3lpbmcgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkKCQkJLyogU3RvcmUgdGhlIGludGVyZXN0aW5nIHZhcmlhYmxlcyAqLwoJCQl2YXIgaSwgaUxlbiwgYkluZmluaXRlPW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZTsKCQkJdmFyIG9TdGF0ZSA9IHsKCQkJCSJpQ3JlYXRlIjogICAgICBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKCQkJCSJpU3RhcnQiOiAgICAgICAoYkluZmluaXRlID8gMCA6IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCksCgkJCQkiaUVuZCI6ICAgICAgICAgKGJJbmZpbml0ZSA/IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggOiBvU2V0dGluZ3MuX2lEaXNwbGF5RW5kKSwKCQkJCSJpTGVuZ3RoIjogICAgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoLAoJCQkJImFhU29ydGluZyI6ICAgICQuZXh0ZW5kKCB0cnVlLCBbXSwgb1NldHRpbmdzLmFhU29ydGluZyApLAoJCQkJIm9TZWFyY2giOiAgICAgICQuZXh0ZW5kKCB0cnVlLCB7fSwgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApLAoJCQkJImFvU2VhcmNoQ29scyI6ICQuZXh0ZW5kKCB0cnVlLCBbXSwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29scyApLAoJCQkJImFiVmlzQ29scyI6ICAgIFtdCgkJCX07CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9TdGF0ZS5hYlZpc0NvbHMucHVzaCggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApOwoJCQl9CgkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAiYW9TdGF0ZVNhdmVQYXJhbXMiLCAnc3RhdGVTYXZlUGFyYW1zJywgW29TZXR0aW5ncywgb1N0YXRlXSApOwoJCQkKCQkJb1NldHRpbmdzLmZuU3RhdGVTYXZlLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIG9TZXR0aW5ncywgb1N0YXRlICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGVtcHQgdG8gbG9hZCBhIHNhdmVkIHRhYmxlIHN0YXRlIGZyb20gYSBjb29raWUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0luaXQgRGF0YVRhYmxlcyBpbml0IG9iamVjdCBzbyB3ZSBjYW4gb3ZlcnJpZGUgc2V0dGluZ3MKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTG9hZFN0YXRlICggb1NldHRpbmdzLCBvSW5pdCApCgkJewoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTdGF0ZVNhdmUgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkKCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmZuU3RhdGVMb2FkLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIG9TZXR0aW5ncyApOwoJCQlpZiAoICFvRGF0YSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogQWxsb3cgY3VzdG9tIGFuZCBwbHVnLWluIG1hbmlwdWxhdGlvbiBmdW5jdGlvbnMgdG8gYWx0ZXIgdGhlIHNhdmVkIGRhdGEgc2V0IGFuZAoJCQkgKiBjYW5jZWxsaW5nIG9mIGxvYWRpbmcgYnkgcmV0dXJuaW5nIGZhbHNlCgkJCSAqLwoJCQl2YXIgYWJTdGF0ZUxvYWQgPSBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU3RhdGVMb2FkUGFyYW1zJywgJ3N0YXRlTG9hZFBhcmFtcycsIFtvU2V0dGluZ3MsIG9EYXRhXSApOwoJCQlpZiAoICQuaW5BcnJheSggZmFsc2UsIGFiU3RhdGVMb2FkICkgIT09IC0xICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBTdG9yZSB0aGUgc2F2ZWQgc3RhdGUgc28gaXQgbWlnaHQgYmUgYWNjZXNzZWQgYXQgYW55IHRpbWUgKi8KCQkJb1NldHRpbmdzLm9Mb2FkZWRTdGF0ZSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgb0RhdGEgKTsKCQkJCgkJCS8qIFJlc3RvcmUga2V5IGZlYXR1cmVzICovCgkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCAgICA9IG9EYXRhLmlTdGFydDsKCQkJb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID0gb0RhdGEuaVN0YXJ0OwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kICAgICAgPSBvRGF0YS5pRW5kOwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoICAgPSBvRGF0YS5pTGVuZ3RoOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nICAgICAgICAgPSBvRGF0YS5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJb1NldHRpbmdzLnNhdmVkX2FhU29ydGluZyAgID0gb0RhdGEuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCQoJCQkvKiBTZWFyY2ggZmlsdGVyaW5nICAqLwoJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCwgb0RhdGEub1NlYXJjaCApOwoJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29scywgb0RhdGEuYW9TZWFyY2hDb2xzICk7CgkJCQoJCQkvKiBDb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZQoJCQkgKiBQYXNzIGJhY2sgdmlzaWJpbGl0eSBzZXR0aW5ncyB0byB0aGUgaW5pdCBoYW5kbGVyLCBidXQgdG8gZG8gbm90IGhlcmUgb3ZlcnJpZGUKCQkJICogdGhlIGluaXQgb2JqZWN0IHRoYXQgdGhlIHVzZXIgbWlnaHQgaGF2ZSBwYXNzZWQgaW4KCQkJICovCgkJCW9Jbml0LnNhdmVkX2FvQ29sdW1ucyA9IFtdOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvRGF0YS5hYlZpc0NvbHMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJb0luaXQuc2F2ZWRfYW9Db2x1bW5zW2ldID0ge307CgkJCQlvSW5pdC5zYXZlZF9hb0NvbHVtbnNbaV0uYlZpc2libGUgPSBvRGF0YS5hYlZpc0NvbHNbaV07CgkJCX0KCQkKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZGVkJywgJ3N0YXRlTG9hZGVkJywgW29TZXR0aW5ncywgb0RhdGFdICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIG5ldyBjb29raWUgd2l0aCBhIHZhbHVlIHRvIHN0b3JlIHRoZSBzdGF0ZSBvZiBhIHRhYmxlCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBuYW1lIG9mIHRoZSBjb29raWUgdG8gY3JlYXRlCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmFsdWUgdGhlIHZhbHVlIHRoZSBjb29raWUgc2hvdWxkIHRha2UKCQkgKiAgQHBhcmFtIHtpbnR9IGlTZWNzIGR1cmF0aW9uIG9mIHRoZSBjb29raWUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNCYXNlTmFtZSBzTmFtZSBpcyBtYWRlIHVwIG9mIHRoZSBiYXNlICsgZmlsZSBuYW1lIC0gdGhpcyBpcyB0aGUgYmFzZQoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBmbkNhbGxiYWNrIFVzZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRvIG1vZGlmeSB0aGUgY29va2llCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNyZWF0ZUNvb2tpZSAoIHNOYW1lLCBzVmFsdWUsIGlTZWNzLCBzQmFzZU5hbWUsIGZuQ2FsbGJhY2sgKQoJCXsKCQkJdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwoJCQlkYXRlLnNldFRpbWUoIGRhdGUuZ2V0VGltZSgpKyhpU2VjcyoxMDAwKSApOwoJCQkKCQkJLyogCgkJCSAqIFNob2NraW5nIGJ1dCB0cnVlIC0gaXQgd291bGQgYXBwZWFyIElFIGhhcyBtYWpvciBpc3N1ZXMgd2l0aCBoYXZpbmcgdGhlIHBhdGggbm90IGhhdmluZwoJCQkgKiBhIHRyYWlsaW5nIHNsYXNoIG9uIGl0LiBXZSBuZWVkIHRoZSBjb29raWUgdG8gYmUgYXZhaWxhYmxlIGJhc2VkIG9uIHRoZSBwYXRoLCBzbyB3ZQoJCQkgKiBoYXZlIHRvIGFwcGVuZCB0aGUgZmlsZSBuYW1lIHRvIHRoZSBjb29raWUgbmFtZS4gQXBwYWxsaW5nLiBUaGFua3MgdG8gdmV4IGZvciBhZGRpbmcgdGhlCgkJCSAqIHBhdGNoIHRvIHVzZSBhdCBsZWFzdCBzb21lIG9mIHRoZSBwYXRoCgkJCSAqLwoJCQl2YXIgYVBhcnRzID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJyk7CgkJCXZhciBzTmFtZUZpbGUgPSBzTmFtZSArICdfJyArIGFQYXJ0cy5wb3AoKS5yZXBsYWNlKC9bXC86XS9nLCIiKS50b0xvd2VyQ2FzZSgpOwoJCQl2YXIgc0Z1bGxDb29raWUsIG9EYXRhOwoJCQkKCQkJaWYgKCBmbkNhbGxiYWNrICE9PSBudWxsICkKCQkJewoJCQkJb0RhdGEgPSAodHlwZW9mICQucGFyc2VKU09OID09PSAnZnVuY3Rpb24nKSA/IAoJCQkJCSQucGFyc2VKU09OKCBzVmFsdWUgKSA6IGV2YWwoICcoJytzVmFsdWUrJyknICk7CgkJCQlzRnVsbENvb2tpZSA9IGZuQ2FsbGJhY2soIHNOYW1lRmlsZSwgb0RhdGEsIGRhdGUudG9HTVRTdHJpbmcoKSwKCQkJCQlhUGFydHMuam9pbignLycpKyIvIiApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJc0Z1bGxDb29raWUgPSBzTmFtZUZpbGUgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQoc1ZhbHVlKSArCgkJCQkJIjsgZXhwaXJlcz0iICsgZGF0ZS50b0dNVFN0cmluZygpICsiOyBwYXRoPSIgKyBhUGFydHMuam9pbignLycpKyIvIjsKCQkJfQoJCQkKCQkJLyogQXJlIHdlIGdvaW5nIHRvIGdvIG92ZXIgdGhlIGNvb2tpZSBsaW1pdCBvZiA0S2lCPyBJZiBzbywgdHJ5IHRvIGRlbGV0ZSBhIGNvb2tpZXMKCQkJICogYmVsb25naW5nIHRvIERhdGFUYWJsZXMuIFRoaXMgaXMgRkFSIGZyb20gYnVsbGV0IHByb29mCgkJCSAqLwoJCQl2YXIgc09sZE5hbWU9IiIsIGlPbGRUaW1lPTk5OTk5OTk5OTk5OTk7CgkJCXZhciBpTGVuZ3RoID0gX2ZuUmVhZENvb2tpZSggc05hbWVGaWxlICkhPT1udWxsID8gZG9jdW1lbnQuY29va2llLmxlbmd0aCA6IAoJCQkJc0Z1bGxDb29raWUubGVuZ3RoICsgZG9jdW1lbnQuY29va2llLmxlbmd0aDsKCQkJCgkJCWlmICggaUxlbmd0aCsxMCA+IDQwOTYgKSAvKiBNYWdpYyAxMCBmb3IgcGFkZGluZyAqLwoJCQl7CgkJCQl2YXIgYUNvb2tpZXMgPWRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpOwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hQ29va2llcy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYUNvb2tpZXNbaV0uaW5kZXhPZiggc0Jhc2VOYW1lICkgIT0gLTEgKQoJCQkJCXsKCQkJCQkJLyogSXQncyBhIERhdGFUYWJsZXMgY29va2llLCBzbyBldmFsIGl0IGFuZCBjaGVjayB0aGUgdGltZSBzdGFtcCAqLwoJCQkJCQl2YXIgYVNwbGl0Q29va2llID0gYUNvb2tpZXNbaV0uc3BsaXQoJz0nKTsKCQkJCQkJdHJ5IHsgb0RhdGEgPSBldmFsKCAnKCcrZGVjb2RlVVJJQ29tcG9uZW50KGFTcGxpdENvb2tpZVsxXSkrJyknICk7IH0KCQkJCQkJY2F0Y2goIGUgKSB7IGNvbnRpbnVlOyB9CgkJCQkJCQoJCQkJCQlpZiAoIG9EYXRhLmlDcmVhdGUgJiYgb0RhdGEuaUNyZWF0ZSA8IGlPbGRUaW1lICkKCQkJCQkJewoJCQkJCQkJc09sZE5hbWUgPSBhU3BsaXRDb29raWVbMF07CgkJCQkJCQlpT2xkVGltZSA9IG9EYXRhLmlDcmVhdGU7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggc09sZE5hbWUgIT09ICIiICkKCQkJCXsKCQkJCQlkb2N1bWVudC5jb29raWUgPSBzT2xkTmFtZSsiPTsgZXhwaXJlcz1UaHUsIDAxLUphbi0xOTcwIDAwOjAwOjAxIEdNVDsgcGF0aD0iKwoJCQkJCQlhUGFydHMuam9pbignLycpICsgIi8iOwoJCQkJfQoJCQl9CgkJCQoJCQlkb2N1bWVudC5jb29raWUgPSBzRnVsbENvb2tpZTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVhZCBhbiBvbGQgY29va2llIHRvIGdldCBhIGNvb2tpZSB3aXRoIGFuIG9sZCB0YWJsZSBzdGF0ZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgbmFtZSBvZiB0aGUgY29va2llIHRvIHJlYWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gY29udGVudHMgb2YgdGhlIGNvb2tpZSAtIG9yIG51bGwgaWYgbm8gY29va2llIHdpdGggdGhhdCBuYW1lIGZvdW5kCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblJlYWRDb29raWUgKCBzTmFtZSApCgkJewoJCQl2YXIKCQkJCWFQYXJ0cyA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpLAoJCQkJc05hbWVFUSA9IHNOYW1lICsgJ18nICsgYVBhcnRzW2FQYXJ0cy5sZW5ndGgtMV0ucmVwbGFjZSgvW1wvOl0vZywiIikudG9Mb3dlckNhc2UoKSArICc9JywKCQkJIAlzQ29va2llQ29udGVudHMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsKCQkJCgkJCWZvciggdmFyIGk9MCA7IGk8c0Nvb2tpZUNvbnRlbnRzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCXZhciBjID0gc0Nvb2tpZUNvbnRlbnRzW2ldOwoJCQkJCgkJCQl3aGlsZSAoYy5jaGFyQXQoMCk9PScgJykKCQkJCXsKCQkJCQljID0gYy5zdWJzdHJpbmcoMSxjLmxlbmd0aCk7CgkJCQl9CgkJCQkKCQkJCWlmIChjLmluZGV4T2Yoc05hbWVFUSkgPT09IDApCgkJCQl7CgkJCQkJcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCggYy5zdWJzdHJpbmcoc05hbWVFUS5sZW5ndGgsYy5sZW5ndGgpICk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiB0aGUgc2V0dGluZ3Mgb2JqZWN0IGZvciBhIHBhcnRpY3VsYXIgdGFibGUKCQkgKiAgQHBhcmFtIHtub2RlfSBuVGFibGUgdGFibGUgd2UgYXJlIHVzaW5nIGFzIGEgZGF0YVRhYmxlCgkJICogIEByZXR1cm5zIHtvYmplY3R9IFNldHRpbmdzIG9iamVjdCAtIG9yIG51bGwgaWYgbm90IGZvdW5kCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNldHRpbmdzRnJvbU5vZGUgKCBuVGFibGUgKQoJCXsKCQkJZm9yICggdmFyIGk9MCA7IGk8RGF0YVRhYmxlLnNldHRpbmdzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggRGF0YVRhYmxlLnNldHRpbmdzW2ldLm5UYWJsZSA9PT0gblRhYmxlICkKCQkJCXsKCQkJCQlyZXR1cm4gRGF0YVRhYmxlLnNldHRpbmdzW2ldOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGFuIGFycmF5IHdpdGggdGhlIFRSIG5vZGVzIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7YXJyYXl9IFRSIGFycmF5CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFRyTm9kZXMgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGFOb2RlcyA9IFtdOwoJCQl2YXIgYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBhb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCXsKCQkJCQlhTm9kZXMucHVzaCggYW9EYXRhW2ldLm5UciApOwoJCQkJfQoJCQl9CgkJCXJldHVybiBhTm9kZXM7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiBhbiBmbGF0IGFycmF5IHdpdGggYWxsIFREIG5vZGVzIGZvciB0aGUgdGFibGUsIG9yIHJvdwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBbaUluZGl2aWR1YWxSb3ddIGFvRGF0YSBpbmRleCB0byBnZXQgdGhlIG5vZGVzIGZvciAtIG9wdGlvbmFsIAoJCSAqICAgIGlmIG5vdCBnaXZlbiB0aGVuIHRoZSByZXR1cm4gYXJyYXkgd2lsbCBjb250YWluIGFsbCBub2RlcyBmb3IgdGhlIHRhYmxlCgkJICogIEByZXR1cm5zIHthcnJheX0gVEQgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0VGROb2RlcyAoIG9TZXR0aW5ncywgaUluZGl2aWR1YWxSb3cgKQoJCXsKCQkJdmFyIGFuUmV0dXJuID0gW107CgkJCXZhciBpQ29ycmVjdG9yOwoJCQl2YXIgYW5UZHM7CgkJCXZhciBpUm93LCBpUm93cz1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCwKCQkJCWlDb2x1bW4sIGlDb2x1bW5zLCBvRGF0YSwgc05vZGVOYW1lLCBpU3RhcnQ9MCwgaUVuZD1pUm93czsKCQkJCgkJCS8qIEFsbG93IHRoZSBjb2xsZWN0aW9uIHRvIGJlIGxpbWl0ZWQgdG8ganVzdCBvbmUgcm93ICovCgkJCWlmICggaUluZGl2aWR1YWxSb3cgIT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlTdGFydCA9IGlJbmRpdmlkdWFsUm93OwoJCQkJaUVuZCA9IGlJbmRpdmlkdWFsUm93KzE7CgkJCX0KCQkKCQkJZm9yICggaVJvdz1pU3RhcnQgOyBpUm93PGlFbmQgOyBpUm93KysgKQoJCQl7CgkJCQlvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCQlpZiAoIG9EYXRhLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJLyogZ2V0IHRoZSBURCBjaGlsZCBub2RlcyAtIHRha2luZyBpbnRvIGFjY291bnQgdGV4dCBldGMgbm9kZXMgKi8KCQkJCQlhblRkcyA9IFtdOwoJCQkJCWZvciAoIGlDb2x1bW49MCwgaUNvbHVtbnM9b0RhdGEublRyLmNoaWxkTm9kZXMubGVuZ3RoIDsgaUNvbHVtbjxpQ29sdW1ucyA7IGlDb2x1bW4rKyApCgkJCQkJewoJCQkJCQlzTm9kZU5hbWUgPSBvRGF0YS5uVHIuY2hpbGROb2Rlc1tpQ29sdW1uXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAndGQnIHx8IHNOb2RlTmFtZSA9PSAndGgnICkKCQkJCQkJewoJCQkJCQkJYW5UZHMucHVzaCggb0RhdGEublRyLmNoaWxkTm9kZXNbaUNvbHVtbl0gKTsKCQkJCQkJfQoJCQkJCX0KCQkKCQkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCQlmb3IgKCBpQ29sdW1uPTAsIGlDb2x1bW5zPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaUNvbHVtbjxpQ29sdW1ucyA7IGlDb2x1bW4rKyApCgkJCQkJewoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlhblJldHVybi5wdXNoKCBhblRkc1tpQ29sdW1uLWlDb3JyZWN0b3JdICk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlhblJldHVybi5wdXNoKCBvRGF0YS5fYW5IaWRkZW5baUNvbHVtbl0gKTsKCQkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQlyZXR1cm4gYW5SZXR1cm47CgkJfQoJCQoJCQoJCS8qKgoJCSAqIExvZyBhbiBlcnJvciBtZXNzYWdlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlMZXZlbCBsb2cgZXJyb3IgbWVzc2FnZXMsIG9yIGRpc3BsYXkgdGhlbSB0byB0aGUgdXNlcgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc01lc2cgZXJyb3IgbWVzc2FnZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Mb2coIG9TZXR0aW5ncywgaUxldmVsLCBzTWVzZyApCgkJewoJCQl2YXIgc0FsZXJ0ID0gKG9TZXR0aW5ncz09PW51bGwpID8KCQkJCSJEYXRhVGFibGVzIHdhcm5pbmc6ICIrc01lc2cgOgoJCQkJIkRhdGFUYWJsZXMgd2FybmluZyAodGFibGUgaWQgPSAnIitvU2V0dGluZ3Muc1RhYmxlSWQrIicpOiAiK3NNZXNnOwoJCQkKCQkJaWYgKCBpTGV2ZWwgPT09IDAgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5leHQuc0Vyck1vZGUgPT0gJ2FsZXJ0JyApCgkJCQl7CgkJCQkJYWxlcnQoIHNBbGVydCApOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCXRocm93IG5ldyBFcnJvcihzQWxlcnQpOwoJCQkJfQoJCQkJcmV0dXJuOwoJCQl9CgkJCWVsc2UgaWYgKCB3aW5kb3cuY29uc29sZSAmJiBjb25zb2xlLmxvZyApCgkJCXsKCQkJCWNvbnNvbGUubG9nKCBzQWxlcnQgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZWUgaWYgYSBwcm9wZXJ0eSBpcyBkZWZpbmVkIG9uIG9uZSBvYmplY3QsIGlmIHNvIGFzc2lnbiBpdCB0byB0aGUgb3RoZXIgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvUmV0IHRhcmdldCBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TcmMgc291cmNlIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgcHJvcGVydHkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtzTWFwcGVkTmFtZV0gbmFtZSB0byBtYXAgdG9vIC0gb3B0aW9uYWwsIHNOYW1lIHVzZWQgaWYgbm90IGdpdmVuCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk1hcCggb1JldCwgb1NyYywgc05hbWUsIHNNYXBwZWROYW1lICkKCQl7CgkJCWlmICggc01hcHBlZE5hbWUgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXNNYXBwZWROYW1lID0gc05hbWU7CgkJCX0KCQkJaWYgKCBvU3JjW3NOYW1lXSAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJb1JldFtzTWFwcGVkTmFtZV0gPSBvU3JjW3NOYW1lXTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBFeHRlbmQgb2JqZWN0cyAtIHZlcnkgc2ltaWxhciB0byBqUXVlcnkuZXh0ZW5kLCBidXQgZGVlcCBjb3B5IG9iamVjdHMsIGFuZCBzaGFsbG93CgkJICogY29weSBhcnJheXMuIFRoZSByZWFzb24gd2UgbmVlZCB0byBkbyB0aGlzLCBpcyB0aGF0IHdlIGRvbid0IHdhbnQgdG8gZGVlcCBjb3B5IGFycmF5CgkJICogaW5pdCB2YWx1ZXMgKHN1Y2ggYXMgYWFTb3J0aW5nKSBzaW5jZSB0aGUgZGV2IHdvdWxkbid0IGJlIGFibGUgdG8gb3ZlcnJpZGUgdGhlbSwgYnV0CgkJICogd2UgZG8gd2FudCB0byBkZWVwIGNvcHkgYXJyYXlzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb091dCBPYmplY3QgdG8gZXh0ZW5kCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRXh0ZW5kZXIgT2JqZWN0IGZyb20gd2hpY2ggdGhlIHByb3BlcnRpZXMgd2lsbCBiZSBhcHBsaWVkIHRvIG9PdXQKCQkgKiAgQHJldHVybnMge29iamVjdH0gb091dCBSZWZlcmVuY2UsIGp1c3QgZm9yIGNvbnZlbmllbmNlIC0gb091dCA9PT0gdGhlIHJldHVybi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICogIEB0b2RvIFRoaXMgZG9lc24ndCB0YWtlIGFjY291bnQgb2YgYXJyYXlzIGluc2lkZSB0aGUgZGVlcCBjb3BpZWQgb2JqZWN0cy4KCQkgKi8KCQlmdW5jdGlvbiBfZm5FeHRlbmQoIG9PdXQsIG9FeHRlbmRlciApCgkJewoJCQl2YXIgdmFsOwoJCQkKCQkJZm9yICggdmFyIHByb3AgaW4gb0V4dGVuZGVyICkKCQkJewoJCQkJaWYgKCBvRXh0ZW5kZXIuaGFzT3duUHJvcGVydHkocHJvcCkgKQoJCQkJewoJCQkJCXZhbCA9IG9FeHRlbmRlcltwcm9wXTsKCQkKCQkJCQlpZiAoIHR5cGVvZiBvSW5pdFtwcm9wXSA9PT0gJ29iamVjdCcgJiYgdmFsICE9PSBudWxsICYmICQuaXNBcnJheSh2YWwpID09PSBmYWxzZSApCgkJCQkJewoJCQkJCQkkLmV4dGVuZCggdHJ1ZSwgb091dFtwcm9wXSwgdmFsICk7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCW9PdXRbcHJvcF0gPSB2YWw7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCXJldHVybiBvT3V0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBCaW5kIGFuIGV2ZW50IGhhbmRlcnMgdG8gYWxsb3cgYSBjbGljayBvciByZXR1cm4ga2V5IHRvIGFjdGl2YXRlIHRoZSBjYWxsYmFjay4KCQkgKiBUaGlzIGlzIGdvb2QgZm9yIGFjY2Vzc2liaWxpdHkgc2luY2UgYSByZXR1cm4gb24gdGhlIGtleWJvYXJkIHdpbGwgaGF2ZSB0aGUKCQkgKiBzYW1lIGVmZmVjdCBhcyBhIGNsaWNrLCBpZiB0aGUgZWxlbWVudCBoYXMgZm9jdXMuCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gbiBFbGVtZW50IHRvIGJpbmQgdGhlIGFjdGlvbiB0bwoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgRGF0YSBvYmplY3QgdG8gcGFzcyB0byB0aGUgdHJpZ2dlcmVkIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIENhbGxiYWNrIGZ1bmN0aW9uIGZvciB3aGVuIHRoZSBldmVudCBpcyB0cmlnZ2VyZWQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQmluZEFjdGlvbiggbiwgb0RhdGEsIGZuICkKCQl7CgkJCSQobikKCQkJCS5iaW5kKCAnY2xpY2suRFQnLCBvRGF0YSwgZnVuY3Rpb24gKGUpIHsKCQkJCQkJbi5ibHVyKCk7IC8vIFJlbW92ZSBmb2N1cyBvdXRsaW5lIGZvciBtb3VzZSB1c2VycwoJCQkJCQlmbihlKTsKCQkJCQl9ICkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBvRGF0YSwgZnVuY3Rpb24gKGUpewoJCQkJCWlmICggZS53aGljaCA9PT0gMTMgKSB7CgkJCQkJCWZuKGUpOwoJCQkJCX0gfSApCgkJCQkuYmluZCggJ3NlbGVjdHN0YXJ0LkRUJywgZnVuY3Rpb24gKCkgewoJCQkJCS8qIFRha2UgdGhlIGJydXRhbCBhcHByb2FjaCB0byBjYW5jZWxsaW5nIHRleHQgc2VsZWN0aW9uICovCgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVnaXN0ZXIgYSBjYWxsYmFjayBmdW5jdGlvbi4gRWFzaWx5IGFsbG93cyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGFkZGVkIHRvCgkJICogYW4gYXJyYXkgc3RvcmUgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIHRoYXQgY2FuIHRoZW4gYWxsIGJlIGNhbGxlZCB0b2dldGhlci4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1N0b3JlIE5hbWUgb2YgdGhlIGFycmF5IHN0b3JhZ2UgZm9yIHRoZSBjYWxsYmFja3MgaW4gb1NldHRpbmdzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiYWNrCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBJZGVudGlmeWluZyBuYW1lIGZvciB0aGUgY2FsbGJhY2sgKGkuZS4gYSBsYWJlbCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgc1N0b3JlLCBmbiwgc05hbWUgKQoJCXsKCQkJaWYgKCBmbiApCgkJCXsKCQkJCW9TZXR0aW5nc1tzU3RvcmVdLnB1c2goIHsKCQkJCQkiZm4iOiBmbiwKCQkJCQkic05hbWUiOiBzTmFtZQoJCQkJfSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpcmUgY2FsbGJhY2sgZnVuY3Rpb25zIGFuZCB0cmlnZ2VyIGV2ZW50cy4gTm90ZSB0aGF0IHRoZSBsb29wIG92ZXIgdGhlIGNhbGxiYWNrCgkJICogYXJyYXkgc3RvcmUgaXMgZG9uZSBiYWNrd2FyZHMhIEZ1cnRoZXIgbm90ZSB0aGF0IHlvdSBkbyBub3Qgd2FudCB0byBmaXJlIG9mZiB0cmlnZ2VycwoJCSAqIGluIHRpbWUgc2Vuc2l0aXZlIGFwcGxpY2F0aW9ucyAoZm9yIGV4YW1wbGUgY2VsbCBjcmVhdGlvbikgYXMgaXRzIHNsb3cuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTdG9yZSBOYW1lIG9mIHRoZSBhcnJheSBzdG9yYWdlIGZvciB0aGUgY2FsbGJhY2tzIGluIG9TZXR0aW5ncwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1RyaWdnZXIgTmFtZSBvZiB0aGUgalF1ZXJ5IGN1c3RvbSBldmVudCB0byB0cmlnZ2VyLiBJZiBudWxsIG5vIHRyaWdnZXIKCQkgKiAgICBpcyBmaXJlZAoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJncyBBcnJheSBvZiBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gLyB0cmlnZ2VyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCBzU3RvcmUsIHNUcmlnZ2VyLCBhQXJncyApCgkJewoJCQl2YXIgYW9TdG9yZSA9IG9TZXR0aW5nc1tzU3RvcmVdOwoJCQl2YXIgYVJldCA9W107CgkJCgkJCWZvciAoIHZhciBpPWFvU3RvcmUubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJewoJCQkJYVJldC5wdXNoKCBhb1N0b3JlW2ldLmZuLmFwcGx5KCBvU2V0dGluZ3Mub0luc3RhbmNlLCBhQXJncyApICk7CgkJCX0KCQkKCQkJaWYgKCBzVHJpZ2dlciAhPT0gbnVsbCApCgkJCXsKCQkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcihzVHJpZ2dlciwgYUFyZ3MpOwoJCQl9CgkJCgkJCXJldHVybiBhUmV0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBKU09OIHN0cmluZ2lmeS4gSWYgSlNPTi5zdHJpbmdpZnkgaXQgcHJvdmlkZWQgYnkgdGhlIGJyb3dzZXIsIGpzb24yLmpzIG9yIGFueSBvdGhlcgoJCSAqIGxpYnJhcnksIHRoZW4gd2UgdXNlIHRoYXQgYXMgaXQgaXMgZmFzdCwgc2FmZSBhbmQgYWNjdXJhdGUuIElmIHRoZSBmdW5jdGlvbiBpc24ndCAKCQkgKiBhdmFpbGFibGUgdGhlbiB3ZSBuZWVkIHRvIGJ1aWx0IGl0IG91cnNlbHZlcyAtIHRoZSBpbnNwaXJhdGlvbiBmb3IgdGhpcyBmdW5jdGlvbiBjb21lcwoJCSAqIGZyb20gQ3JhaWcgQnVja2xlciAoIGh0dHA6Ly93d3cuc2l0ZXBvaW50LmNvbS9qYXZhc2NyaXB0LWpzb24tc2VyaWFsaXphdGlvbi8gKS4gSXQgaXMKCQkgKiBub3QgcGVyZmVjdCBhbmQgYWJzb2x1dGVseSBzaG91bGQgbm90IGJlIHVzZWQgYXMgYSByZXBsYWNlbWVudCB0byBqc29uMi5qcyAtIGJ1dCBpdCBkb2VzCgkJICogZG8gd2hhdCB3ZSBuZWVkLCB3aXRob3V0IHJlcXVpcmluZyBhIGRlcGVuZGVuY3kgZm9yIERhdGFUYWJsZXMuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIEpTT04gb2JqZWN0IHRvIGJlIGNvbnZlcnRlZAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBKU09OIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQl2YXIgX2ZuSnNvblN0cmluZyA9ICh3aW5kb3cuSlNPTikgPyBKU09OLnN0cmluZ2lmeSA6IGZ1bmN0aW9uKCBvICkKCQl7CgkJCS8qIE5vdCBhbiBvYmplY3Qgb3IgYXJyYXkgKi8KCQkJdmFyIHNUeXBlID0gdHlwZW9mIG87CgkJCWlmIChzVHlwZSAhPT0gIm9iamVjdCIgfHwgbyA9PT0gbnVsbCkKCQkJewoJCQkJLy8gc2ltcGxlIGRhdGEgdHlwZQoJCQkJaWYgKHNUeXBlID09PSAic3RyaW5nIikKCQkJCXsKCQkJCQlvID0gJyInK28rJyInOwoJCQkJfQoJCQkJcmV0dXJuIG8rIiI7CgkJCX0KCQkKCQkJLyogSWYgb2JqZWN0IG9yIGFycmF5LCBuZWVkIHRvIHJlY3Vyc2Ugb3ZlciBpdCAqLwoJCQl2YXIKCQkJCXNQcm9wLCBtVmFsdWUsCgkJCQlqc29uID0gW10sCgkJCQliQXJyID0gJC5pc0FycmF5KG8pOwoJCQkKCQkJZm9yIChzUHJvcCBpbiBvKQoJCQl7CgkJCQltVmFsdWUgPSBvW3NQcm9wXTsKCQkJCXNUeXBlID0gdHlwZW9mIG1WYWx1ZTsKCQkKCQkJCWlmIChzVHlwZSA9PT0gInN0cmluZyIpCgkJCQl7CgkJCQkJbVZhbHVlID0gJyInK21WYWx1ZSsnIic7CgkJCQl9CgkJCQllbHNlIGlmIChzVHlwZSA9PT0gIm9iamVjdCIgJiYgbVZhbHVlICE9PSBudWxsKQoJCQkJewoJCQkJCW1WYWx1ZSA9IF9mbkpzb25TdHJpbmcobVZhbHVlKTsKCQkJCX0KCQkKCQkJCWpzb24ucHVzaCgoYkFyciA/ICIiIDogJyInK3NQcm9wKyciOicpICsgbVZhbHVlKTsKCQkJfQoJCQoJCQlyZXR1cm4gKGJBcnIgPyAiWyIgOiAieyIpICsganNvbiArIChiQXJyID8gIl0iIDogIn0iKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEZyb20gc29tZSBicm93c2VycyAoc3BlY2lmaWNhbGx5IElFNi83KSB3ZSBuZWVkIHNwZWNpYWwgaGFuZGxpbmcgdG8gd29yayBhcm91bmQgYnJvd3NlcgoJCSAqIGJ1Z3MgLSB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZGV0ZWN0IHdoZW4gdGhlc2Ugd29ya2Fyb3VuZHMgYXJlIG5lZWRlZC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ccm93c2VyRGV0ZWN0KCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogSUU2Lzcgd2lsbCBvdmVyc2l6ZSBhIHdpZHRoIDEwMCUgZWxlbWVudCBpbnNpZGUgYSBzY3JvbGxpbmcgZWxlbWVudCwgdG8gaW5jbHVkZSB0aGUKCQkJICogd2lkdGggb2YgdGhlIHNjcm9sbGJhciwgd2hpbGUgb3RoZXIgYnJvd3NlcnMgZW5zdXJlIHRoZSBpbm5lciBlbGVtZW50IGlzIGNvbnRhaW5lZAoJCQkgKiB3aXRob3V0IGZvcmNpbmcgc2Nyb2xsaW5nCgkJCSAqLwoJCQl2YXIgbiA9ICQoCgkJCQknPGRpdiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7IHRvcDowOyBsZWZ0OjA7IGhlaWdodDoxcHg7IHdpZHRoOjFweDsgb3ZlcmZsb3c6aGlkZGVuIj4nKwoJCQkJCSc8ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjFweDsgbGVmdDoxcHg7IHdpZHRoOjEwMHB4OyBoZWlnaHQ6NTBweDsgb3ZlcmZsb3c6c2Nyb2xsOyI+JysKCQkJCQkJJzxkaXYgaWQ9IkRUX0Jyb3dzZXJUZXN0IiBzdHlsZT0id2lkdGg6MTAwJTsgaGVpZ2h0OjEwcHg7Ij48L2Rpdj4nKwoJCQkJCSc8L2Rpdj4nKwoJCQkJJzwvZGl2PicpWzBdOwoJCQoJCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCBuICk7CgkJCW9TZXR0aW5ncy5vQnJvd3Nlci5iU2Nyb2xsT3ZlcnNpemUgPSAkKCcjRFRfQnJvd3NlclRlc3QnLCBuKVswXS5vZmZzZXRXaWR0aCA9PT0gMTAwID8gdHJ1ZSA6IGZhbHNlOwoJCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKCBuICk7CgkJfQoJCQoKCQkKCQkKCQkvKioKCQkgKiBQZXJmb3JtIGEgalF1ZXJ5IHNlbGVjdG9yIGFjdGlvbiBvbiB0aGUgdGFibGUncyBUUiBlbGVtZW50cyAoZnJvbSB0aGUgdGJvZHkpIGFuZAoJCSAqIHJldHVybiB0aGUgcmVzdWx0aW5nIGpRdWVyeSBvYmplY3QuCgkJICogIEBwYXJhbSB7c3RyaW5nfG5vZGV8alF1ZXJ5fSBzU2VsZWN0b3IgalF1ZXJ5IHNlbGVjdG9yIG9yIG5vZGUgY29sbGVjdGlvbiB0byBhY3Qgb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IFtvT3B0c10gT3B0aW9uYWwgcGFyYW1ldGVycyBmb3IgbW9kaWZ5aW5nIHRoZSByb3dzIHRvIGJlIGluY2x1ZGVkCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMuZmlsdGVyPW5vbmVdIFNlbGVjdCBUUiBlbGVtZW50cyB0aGF0IG1lZXQgdGhlIGN1cnJlbnQgZmlsdGVyCgkJICogICAgY3JpdGVyaW9uICgiYXBwbGllZCIpIG9yIGFsbCBUUiBlbGVtZW50cyAoaS5lLiBubyBmaWx0ZXIpLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLm9yZGVyPWN1cnJlbnRdIE9yZGVyIG9mIHRoZSBUUiBlbGVtZW50cyBpbiB0aGUgcHJvY2Vzc2VkIGFycmF5LgoJCSAqICAgIENhbiBiZSBlaXRoZXIgJ2N1cnJlbnQnLCB3aGVyZWJ5IHRoZSBjdXJyZW50IHNvcnRpbmcgb2YgdGhlIHRhYmxlIGlzIHVzZWQsIG9yCgkJICogICAgJ29yaWdpbmFsJyB3aGVyZWJ5IHRoZSBvcmlnaW5hbCBvcmRlciB0aGUgZGF0YSB3YXMgcmVhZCBpbnRvIHRoZSB0YWJsZSBpcyB1c2VkLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLnBhZ2U9YWxsXSBMaW1pdCB0aGUgc2VsZWN0aW9uIHRvIHRoZSBjdXJyZW50bHkgZGlzcGxheWVkIHBhZ2UKCQkgKiAgICAoImN1cnJlbnQiKSBvciBub3QgKCJhbGwiKS4gSWYgJ2N1cnJlbnQnIGlzIGdpdmVuLCB0aGVuIG9yZGVyIGlzIGFzc3VtZWQgdG8gYmUgCgkJICogICAgJ2N1cnJlbnQnIGFuZCBmaWx0ZXIgaXMgJ2FwcGxpZWQnLCByZWdhcmRsZXNzIG9mIHdoYXQgdGhleSBtaWdodCBiZSBnaXZlbiBhcy4KCQkgKiAgQHJldHVybnMge29iamVjdH0galF1ZXJ5IG9iamVjdCwgZmlsdGVyZWQgYnkgdGhlIGdpdmVuIHNlbGVjdG9yLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICAvLyBIaWdobGlnaHQgZXZlcnkgc2Vjb25kIHJvdwoJCSAqICAgICAgb1RhYmxlLiQoJ3RyOm9kZCcpLmNzcygnYmFja2dyb3VuZENvbG9yJywgJ2JsdWUnKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICAvLyBGaWx0ZXIgdG8gcm93cyB3aXRoICdXZWJraXQnIGluIHRoZW0sIGFkZCBhIGJhY2tncm91bmQgY29sb3VyIGFuZCB0aGVuCgkJICogICAgICAvLyByZW1vdmUgdGhlIGZpbHRlciwgdGh1cyBoaWdobGlnaHRpbmcgdGhlICdXZWJraXQnIHJvd3Mgb25seS4KCQkgKiAgICAgIG9UYWJsZS5mbkZpbHRlcignV2Via2l0Jyk7CgkJICogICAgICBvVGFibGUuJCgndHInLCB7ImZpbHRlciI6ICJhcHBsaWVkIn0pLmNzcygnYmFja2dyb3VuZENvbG9yJywgJ2JsdWUnKTsKCQkgKiAgICAgIG9UYWJsZS5mbkZpbHRlcignJyk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuJCA9IGZ1bmN0aW9uICggc1NlbGVjdG9yLCBvT3B0cyApCgkJewoJCQl2YXIgaSwgaUxlbiwgYSA9IFtdLCB0cjsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhOwoJCQl2YXIgYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheTsKCQkJdmFyIGFpRGlzcGxheU1hc3RlciA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXI7CgkJCgkJCWlmICggIW9PcHRzICkKCQkJewoJCQkJb09wdHMgPSB7fTsKCQkJfQoJCQoJCQlvT3B0cyA9ICQuZXh0ZW5kKCB7fSwgewoJCQkJImZpbHRlciI6ICJub25lIiwgLy8gYXBwbGllZAoJCQkJIm9yZGVyIjogImN1cnJlbnQiLCAvLyAib3JpZ2luYWwiCgkJCQkicGFnZSI6ICJhbGwiIC8vIGN1cnJlbnQKCQkJfSwgb09wdHMgKTsKCQkKCQkJLy8gQ3VycmVudCBwYWdlIGltcGxpZXMgdGhhdCBvcmRlcj1jdXJyZW50IGFuZCBmaXRsZXI9YXBwbGllZCwgc2luY2UgaXQgaXMgZmFpcmx5CgkJCS8vIHNlbnNlbGVzcyBvdGhlcndpc2UKCQkJaWYgKCBvT3B0cy5wYWdlID09ICdjdXJyZW50JyApCgkJCXsKCQkJCWZvciAoIGk9b1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBpTGVuPW9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGFpRGlzcGxheVtpXSBdLm5UcjsKCQkJCQlpZiAoIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJjdXJyZW50IiAmJiBvT3B0cy5maWx0ZXIgPT0gIm5vbmUiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFpRGlzcGxheU1hc3Rlci5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBhaURpc3BsYXlNYXN0ZXJbaV0gXS5uVHI7CgkJCQkJaWYgKCB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAiY3VycmVudCIgJiYgb09wdHMuZmlsdGVyID09ICJhcHBsaWVkIiApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1haURpc3BsYXkubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgYWlEaXNwbGF5W2ldIF0ublRyOwoJCQkJCWlmICggdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gIm9yaWdpbmFsIiAmJiBvT3B0cy5maWx0ZXIgPT0gIm5vbmUiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBpIF0ublRyIDsKCQkJCQlpZiAoIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJvcmlnaW5hbCIgJiYgb09wdHMuZmlsdGVyID09ICJhcHBsaWVkIiApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgaSBdLm5UcjsKCQkJCQlpZiAoICQuaW5BcnJheSggaSwgYWlEaXNwbGF5ICkgIT09IC0xICYmIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMSwgIlVua25vd24gc2VsZWN0aW9uIG9wdGlvbnMiICk7CgkJCX0KCQkKCQkJLyogV2UgbmVlZCB0byBmaWx0ZXIgb24gdGhlIFRSIGVsZW1lbnRzIGFuZCBhbHNvICdmaW5kJyBpbiB0aGVpciBkZXNjZW5kYW50cwoJCQkgKiB0byBtYWtlIHRoZSBzZWxlY3RvciBhY3QgbGlrZSBpdCB3b3VsZCBpbiBhIGZ1bGwgdGFibGUgLSBzbyB3ZSBuZWVkCgkJCSAqIHRvIGJ1aWxkIGJvdGggcmVzdWx0cyBhbmQgdGhlbiBjb21iaW5lIHRoZW0gdG9nZXRoZXIKCQkJICovCgkJCXZhciBqcUEgPSAkKGEpOwoJCQl2YXIganFUUnMgPSBqcUEuZmlsdGVyKCBzU2VsZWN0b3IgKTsKCQkJdmFyIGpxRGVzY2VuZGFudHMgPSBqcUEuZmluZCggc1NlbGVjdG9yICk7CgkJCgkJCXJldHVybiAkKCBbXS5jb25jYXQoJC5tYWtlQXJyYXkoanFUUnMpLCAkLm1ha2VBcnJheShqcURlc2NlbmRhbnRzKSkgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEFsbW9zdCBpZGVudGljYWwgdG8gJCBpbiBvcGVyYXRpb24sIGJ1dCBpbiB0aGlzIGNhc2UgcmV0dXJucyB0aGUgZGF0YSBmb3IgdGhlIG1hdGNoZWQKCQkgKiByb3dzIC0gYXMgc3VjaCwgdGhlIGpRdWVyeSBzZWxlY3RvciB1c2VkIHNob3VsZCBtYXRjaCBUUiByb3cgbm9kZXMgb3IgVEQvVEggY2VsbCBub2RlcwoJCSAqIHJhdGhlciB0aGFuIGFueSBkZXNjZW5kYW50cywgc28gdGhlIGRhdGEgY2FuIGJlIG9idGFpbmVkIGZvciB0aGUgcm93L2NlbGwuIElmIG1hdGNoaW5nCgkJICogcm93cyBhcmUgZm91bmQsIHRoZSBkYXRhIHJldHVybmVkIGlzIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5L29iamVjdCB0aGF0IHdhcyB1c2VkIHRvICAKCQkgKiBjcmVhdGUgdGhlIHJvdyAob3IgYSBnZW5lcmF0ZWQgYXJyYXkgaWYgZnJvbSBhIERPTSBzb3VyY2UpLgoJCSAqCgkJICogVGhpcyBtZXRob2QgaXMgb2Z0ZW4gdXNlZnVsIGluLWNvbWJpbmF0aW9uIHdpdGggJCB3aGVyZSBib3RoIGZ1bmN0aW9ucyBhcmUgZ2l2ZW4gdGhlCgkJICogc2FtZSBwYXJhbWV0ZXJzIGFuZCB0aGUgYXJyYXkgaW5kZXhlcyB3aWxsIG1hdGNoIGlkZW50aWNhbGx5LgoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gc1NlbGVjdG9yIGpRdWVyeSBzZWxlY3RvciBvciBub2RlIGNvbGxlY3Rpb24gdG8gYWN0IG9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBbb09wdHNdIE9wdGlvbmFsIHBhcmFtZXRlcnMgZm9yIG1vZGlmeWluZyB0aGUgcm93cyB0byBiZSBpbmNsdWRlZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLmZpbHRlcj1ub25lXSBTZWxlY3QgZWxlbWVudHMgdGhhdCBtZWV0IHRoZSBjdXJyZW50IGZpbHRlcgoJCSAqICAgIGNyaXRlcmlvbiAoImFwcGxpZWQiKSBvciBhbGwgZWxlbWVudHMgKGkuZS4gbm8gZmlsdGVyKS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5vcmRlcj1jdXJyZW50XSBPcmRlciBvZiB0aGUgZGF0YSBpbiB0aGUgcHJvY2Vzc2VkIGFycmF5LgoJCSAqICAgIENhbiBiZSBlaXRoZXIgJ2N1cnJlbnQnLCB3aGVyZWJ5IHRoZSBjdXJyZW50IHNvcnRpbmcgb2YgdGhlIHRhYmxlIGlzIHVzZWQsIG9yCgkJICogICAgJ29yaWdpbmFsJyB3aGVyZWJ5IHRoZSBvcmlnaW5hbCBvcmRlciB0aGUgZGF0YSB3YXMgcmVhZCBpbnRvIHRoZSB0YWJsZSBpcyB1c2VkLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLnBhZ2U9YWxsXSBMaW1pdCB0aGUgc2VsZWN0aW9uIHRvIHRoZSBjdXJyZW50bHkgZGlzcGxheWVkIHBhZ2UKCQkgKiAgICAoImN1cnJlbnQiKSBvciBub3QgKCJhbGwiKS4gSWYgJ2N1cnJlbnQnIGlzIGdpdmVuLCB0aGVuIG9yZGVyIGlzIGFzc3VtZWQgdG8gYmUgCgkJICogICAgJ2N1cnJlbnQnIGFuZCBmaWx0ZXIgaXMgJ2FwcGxpZWQnLCByZWdhcmRsZXNzIG9mIHdoYXQgdGhleSBtaWdodCBiZSBnaXZlbiBhcy4KCQkgKiAgQHJldHVybnMge2FycmF5fSBEYXRhIGZvciB0aGUgbWF0Y2hlZCBlbGVtZW50cy4gSWYgYW55IGVsZW1lbnRzLCBhcyBhIHJlc3VsdCBvZiB0aGUKCQkgKiAgICBzZWxlY3Rvciwgd2VyZSBub3QgVFIsIFREIG9yIFRIIGVsZW1lbnRzIGluIHRoZSBEYXRhVGFibGUsIHRoZXkgd2lsbCBoYXZlIGEgbnVsbCAKCQkgKiAgICBlbnRyeSBpbiB0aGUgYXJyYXkuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIC8vIEdldCB0aGUgZGF0YSBmcm9tIHRoZSBmaXJzdCByb3cgaW4gdGhlIHRhYmxlCgkJICogICAgICB2YXIgZGF0YSA9IG9UYWJsZS5fKCd0cjpmaXJzdCcpOwoJCSAqCgkJICogICAgICAvLyBEbyBzb21ldGhpbmcgdXNlZnVsIHdpdGggdGhlIGRhdGEKCQkgKiAgICAgIGFsZXJ0KCAiRmlyc3QgY2VsbCBpczogIitkYXRhWzBdICk7CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gRmlsdGVyIHRvICdXZWJraXQnIGFuZCBnZXQgYWxsIGRhdGEgZm9yIAoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCdXZWJraXQnKTsKCQkgKiAgICAgIHZhciBkYXRhID0gb1RhYmxlLl8oJ3RyJywgeyJmaWx0ZXIiOiAiYXBwbGllZCJ9KTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gRG8gc29tZXRoaW5nIHdpdGggdGhlIGRhdGEKCQkgKiAgICAgIGFsZXJ0KCBkYXRhLmxlbmd0aCsiIHJvd3MgbWF0Y2hlZCB0aGUgZmlsdGVyIiApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLl8gPSBmdW5jdGlvbiAoIHNTZWxlY3Rvciwgb09wdHMgKQoJCXsKCQkJdmFyIGFPdXQgPSBbXTsKCQkJdmFyIGksIGlMZW4sIGlJbmRleDsKCQkJdmFyIGFUcnMgPSB0aGlzLiQoIHNTZWxlY3Rvciwgb09wdHMgKTsKCQkKCQkJZm9yICggaT0wLCBpTGVuPWFUcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYU91dC5wdXNoKCB0aGlzLmZuR2V0RGF0YShhVHJzW2ldKSApOwoJCQl9CgkJCgkJCXJldHVybiBhT3V0OwoJCX07CgkJCgkJCgkJLyoqCgkJICogQWRkIGEgc2luZ2xlIG5ldyByb3cgb3IgbXVsdGlwbGUgcm93cyBvZiBkYXRhIHRvIHRoZSB0YWJsZS4gUGxlYXNlIG5vdGUKCQkgKiB0aGF0IHRoaXMgaXMgc3VpdGFibGUgZm9yIGNsaWVudC1zaWRlIHByb2Nlc3Npbmcgb25seSAtIGlmIHlvdSBhcmUgdXNpbmcgCgkJICogc2VydmVyLXNpZGUgcHJvY2Vzc2luZyAoaS5lLiAiYlNlcnZlclNpZGUiOiB0cnVlKSwgdGhlbiB0byBhZGQgZGF0YSwgeW91CgkJICogbXVzdCBhZGQgaXQgdG8gdGhlIGRhdGEgc291cmNlLCBpLmUuIHRoZSBzZXJ2ZXItc2lkZSwgdGhyb3VnaCBhbiBBamF4IGNhbGwuCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBtRGF0YSBUaGUgZGF0YSB0byBiZSBhZGRlZCB0byB0aGUgdGFibGUuIFRoaXMgY2FuIGJlOgoJCSAqICAgIDx1bD4KCQkgKiAgICAgIDxsaT4xRCBhcnJheSBvZiBkYXRhIC0gYWRkIGEgc2luZ2xlIHJvdyB3aXRoIHRoZSBkYXRhIHByb3ZpZGVkPC9saT4KCQkgKiAgICAgIDxsaT4yRCBhcnJheSBvZiBhcnJheXMgLSBhZGQgbXVsdGlwbGUgcm93cyBpbiBhIHNpbmdsZSBjYWxsPC9saT4KCQkgKiAgICAgIDxsaT5vYmplY3QgLSBkYXRhIG9iamVjdCB3aGVuIHVzaW5nIDxpPm1EYXRhPC9pPjwvbGk+CgkJICogICAgICA8bGk+YXJyYXkgb2Ygb2JqZWN0cyAtIG11bHRpcGxlIGRhdGEgb2JqZWN0cyB3aGVuIHVzaW5nIDxpPm1EYXRhPC9pPjwvbGk+CgkJICogICAgPC91bD4KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSByZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAcmV0dXJucyB7YXJyYXl9IEFuIGFycmF5IG9mIGludGVnZXJzLCByZXByZXNlbnRpbmcgdGhlIGxpc3Qgb2YgaW5kZXhlcyBpbiAKCQkgKiAgICA8aT5hb0RhdGE8L2k+ICh7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9KSB0aGF0IGhhdmUgYmVlbiBhZGRlZCB0byAKCQkgKiAgICB0aGUgdGFibGUuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEdsb2JhbCB2YXIgZm9yIGNvdW50ZXIKCQkgKiAgICB2YXIgZ2lDb3VudCA9IDI7CgkJICogICAgCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICBmdW5jdGlvbiBmbkNsaWNrQWRkUm93KCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKS5mbkFkZERhdGEoIFsKCQkgKiAgICAgICAgZ2lDb3VudCsiLjEiLAoJCSAqICAgICAgICBnaUNvdW50KyIuMiIsCgkJICogICAgICAgIGdpQ291bnQrIi4zIiwKCQkgKiAgICAgICAgZ2lDb3VudCsiLjQiIF0KCQkgKiAgICAgICk7CgkJICogICAgICAgIAoJCSAqICAgICAgZ2lDb3VudCsrOwoJCSAqICAgIH0KCQkgKi8KCQl0aGlzLmZuQWRkRGF0YSA9IGZ1bmN0aW9uKCBtRGF0YSwgYlJlZHJhdyApCgkJewoJCQlpZiAoIG1EYXRhLmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXJldHVybiBbXTsKCQkJfQoJCQkKCQkJdmFyIGFpUmV0dXJuID0gW107CgkJCXZhciBpVGVzdDsKCQkJCgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJLyogQ2hlY2sgaWYgd2Ugd2FudCB0byBhZGQgbXVsdGlwbGUgcm93cyBvciBub3QgKi8KCQkJaWYgKCB0eXBlb2YgbURhdGFbMF0gPT09ICJvYmplY3QiICYmIG1EYXRhWzBdICE9PSBudWxsICkKCQkJewoJCQkJZm9yICggdmFyIGk9MCA7IGk8bURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVGVzdCA9IF9mbkFkZERhdGEoIG9TZXR0aW5ncywgbURhdGFbaV0gKTsKCQkJCQlpZiAoIGlUZXN0ID09IC0xICkKCQkJCQl7CgkJCQkJCXJldHVybiBhaVJldHVybjsKCQkJCQl9CgkJCQkJYWlSZXR1cm4ucHVzaCggaVRlc3QgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCWlUZXN0ID0gX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBtRGF0YSApOwoJCQkJaWYgKCBpVGVzdCA9PSAtMSApCgkJCQl7CgkJCQkJcmV0dXJuIGFpUmV0dXJuOwoJCQkJfQoJCQkJYWlSZXR1cm4ucHVzaCggaVRlc3QgKTsKCQkJfQoJCQkKCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5SZURyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCXJldHVybiBhaVJldHVybjsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gd2lsbCBtYWtlIERhdGFUYWJsZXMgcmVjYWxjdWxhdGUgdGhlIGNvbHVtbiBzaXplcywgYmFzZWQgb24gdGhlIGRhdGEgCgkJICogY29udGFpbmVkIGluIHRoZSB0YWJsZSBhbmQgdGhlIHNpemVzIGFwcGxpZWQgdG8gdGhlIGNvbHVtbnMgKGluIHRoZSBET00sIENTUyBvciAKCQkgKiB0aHJvdWdoIHRoZSBzV2lkdGggcGFyYW1ldGVyKS4gVGhpcyBjYW4gYmUgdXNlZnVsIHdoZW4gdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSdzIAoJCSAqIHBhcmVudCBlbGVtZW50IGNoYW5nZXMgKGZvciBleGFtcGxlIGEgd2luZG93IHJlc2l6ZSkuCgkJICogIEBwYXJhbSB7Ym9vbGVhbn0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QsIHlvdSB3aWxsIHR5cGljYWxseSB3YW50IHRvCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAkKHdpbmRvdykuYmluZCgncmVzaXplJywgZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBvVGFibGUuZm5BZGp1c3RDb2x1bW5TaXppbmcoKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkFkanVzdENvbHVtblNpemluZyA9IGZ1bmN0aW9uICggYlJlZHJhdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSh0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSk7CgkJCV9mbkFkanVzdENvbHVtblNpemluZyggb1NldHRpbmdzICk7CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJdGhpcy5mbkRyYXcoIGZhbHNlICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiB8fCBvU2V0dGluZ3Mub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQl7CgkJCQkvKiBJZiBub3QgcmVkcmF3aW5nLCBidXQgc2Nyb2xsaW5nLCB3ZSB3YW50IHRvIGFwcGx5IHRoZSBuZXcgY29sdW1uIHNpemVzIGFueXdheSAqLwoJCQkJdGhpcy5vQXBpLl9mblNjcm9sbERyYXcob1NldHRpbmdzKTsKCQkJfQoJCX07CgkJCgkJCgkJLyoqCgkJICogUXVpY2tseSBhbmQgc2ltcGx5IGNsZWFyIGEgdGFibGUKCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSByZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBJbW1lZGlhdGVseSAnbnVrZScgdGhlIGN1cnJlbnQgcm93cyAocGVyaGFwcyB3YWl0aW5nIGZvciBhbiBBamF4IGNhbGxiYWNrLi4uKQoJCSAqICAgICAgb1RhYmxlLmZuQ2xlYXJUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuQ2xlYXJUYWJsZSA9IGZ1bmN0aW9uKCBiUmVkcmF3ICkKCQl7CgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX07CgkJCgkJCgkJLyoqCgkJICogVGhlIGV4YWN0IG9wcG9zaXRlIG9mICdvcGVuaW5nJyBhIHJvdywgdGhpcyBmdW5jdGlvbiB3aWxsIGNsb3NlIGFueSByb3dzIHdoaWNoIAoJCSAqIGFyZSBjdXJyZW50bHkgJ29wZW4nLgoJCSAqICBAcGFyYW0ge25vZGV9IG5UciB0aGUgdGFibGUgcm93IHRvICdjbG9zZScKCQkgKiAgQHJldHVybnMge2ludH0gMCBvbiBzdWNjZXNzLCBvciAxIGlmIGZhaWxlZCAoY2FuJ3QgZmluZCB0aGUgcm93KQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGU7CgkJICogICAgICAKCQkgKiAgICAgIC8vICdvcGVuJyBhbiBpbmZvcm1hdGlvbiByb3cgd2hlbiBhIHJvdyBpcyBjbGlja2VkIG9uCgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGlmICggb1RhYmxlLmZuSXNPcGVuKHRoaXMpICkgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbkNsb3NlKCB0aGlzICk7CgkJICogICAgICAgIH0gZWxzZSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuT3BlbiggdGhpcywgIlRlbXBvcmFyeSByb3cgb3BlbmVkIiwgImluZm9fcm93IiApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5DbG9zZSA9IGZ1bmN0aW9uKCBuVHIgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5QYXJlbnQgPT0gblRyICkKCQkJCXsKCQkJCQl2YXIgblRyUGFyZW50ID0gb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublRyLnBhcmVudE5vZGU7CgkJCQkJaWYgKCBuVHJQYXJlbnQgKQoJCQkJCXsKCQkJCQkJLyogUmVtb3ZlIGl0IGlmIGl0IGlzIGN1cnJlbnRseSBvbiBkaXNwbGF5ICovCgkJCQkJCW5UclBhcmVudC5yZW1vdmVDaGlsZCggb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublRyICk7CgkJCQkJfQoJCQkJCW9TZXR0aW5ncy5hb09wZW5Sb3dzLnNwbGljZSggaSwgMSApOwoJCQkJCXJldHVybiAwOwoJCQkJfQoJCQl9CgkJCXJldHVybiAxOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUmVtb3ZlIGEgcm93IGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHttaXhlZH0gbVRhcmdldCBUaGUgaW5kZXggb2YgdGhlIHJvdyBmcm9tIGFvRGF0YSB0byBiZSBkZWxldGVkLCBvcgoJCSAqICAgIHRoZSBUUiBlbGVtZW50IHlvdSB3YW50IHRvIGRlbGV0ZQoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufG51bGx9IFtmbkNhbGxCYWNrXSBDYWxsYmFjayBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEByZXR1cm5zIHthcnJheX0gVGhlIHJvdyB0aGF0IHdhcyBkZWxldGVkCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEltbWVkaWF0ZWx5IHJlbW92ZSB0aGUgZmlyc3Qgcm93CgkJICogICAgICBvVGFibGUuZm5EZWxldGVSb3coIDAgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkRlbGV0ZVJvdyA9IGZ1bmN0aW9uKCBtVGFyZ2V0LCBmbkNhbGxCYWNrLCBiUmVkcmF3ICkKCQl7CgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgaSwgaUxlbiwgaUFPRGF0YUluZGV4OwoJCQkKCQkJaUFPRGF0YUluZGV4ID0gKHR5cGVvZiBtVGFyZ2V0ID09PSAnb2JqZWN0JykgPyAKCQkJCV9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1UYXJnZXQpIDogbVRhcmdldDsKCQkJCgkJCS8qIFJldHVybiB0aGUgZGF0YSBhcnJheSBmcm9tIHRoaXMgcm93ICovCgkJCXZhciBvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGEuc3BsaWNlKCBpQU9EYXRhSW5kZXgsIDEgKTsKCQkKCQkJLyogVXBkYXRlIHRoZSBfRFRfUm93SW5kZXggcGFyYW1ldGVyICovCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hb0RhdGFbaV0ublRyLl9EVF9Sb3dJbmRleCA9IGk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlbW92ZSB0aGUgdGFyZ2V0IHJvdyBmcm9tIHRoZSBzZWFyY2ggYXJyYXkgKi8KCQkJdmFyIGlEaXNwbGF5SW5kZXggPSAkLmluQXJyYXkoIGlBT0RhdGFJbmRleCwgb1NldHRpbmdzLmFpRGlzcGxheSApOwoJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoLnNwbGljZSggaURpc3BsYXlJbmRleCwgMSApOwoJCQkKCQkJLyogRGVsZXRlIGZyb20gdGhlIGRpc3BsYXkgYXJyYXlzICovCgkJCV9mbkRlbGV0ZUluZGV4KCBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLCBpQU9EYXRhSW5kZXggKTsKCQkJX2ZuRGVsZXRlSW5kZXgoIG9TZXR0aW5ncy5haURpc3BsYXksIGlBT0RhdGFJbmRleCApOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYSB1c2VyIGNhbGxiYWNrIGZ1bmN0aW9uIC0gY2FsbCBpdCAqLwoJCQlpZiAoIHR5cGVvZiBmbkNhbGxCYWNrID09PSAiZnVuY3Rpb24iICkKCQkJewoJCQkJZm5DYWxsQmFjay5jYWxsKCB0aGlzLCBvU2V0dGluZ3MsIG9EYXRhICk7CgkJCX0KCQkJCgkJCS8qIENoZWNrIGZvciBhbiAnb3ZlcmZsb3cnIHRoZXkgY2FzZSBmb3IgZGlzcGxheWluZyB0aGUgdGFibGUgKi8KCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPj0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCAtPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPCAwICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQlyZXR1cm4gb0RhdGE7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBSZXN0b3JlIHRoZSB0YWJsZSB0byBpdCdzIG9yaWdpbmFsIHN0YXRlIGluIHRoZSBET00gYnkgcmVtb3ZpbmcgYWxsIG9mIERhdGFUYWJsZXMgCgkJICogZW5oYW5jZW1lbnRzLCBhbHRlcmF0aW9ucyB0byB0aGUgRE9NIHN0cnVjdHVyZSBvZiB0aGUgdGFibGUgYW5kIGV2ZW50IGxpc3RlbmVycy4KCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYlJlbW92ZT1mYWxzZV0gQ29tcGxldGVseSByZW1vdmUgdGhlIHRhYmxlIGZyb20gdGhlIERPTQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIC8vIFRoaXMgZXhhbXBsZSBpcyBmYWlybHkgcG9pbnRsZXNzIGluIHJlYWxpdHksIGJ1dCBzaG93cyBob3cgZm5EZXN0cm95IGNhbiBiZSB1c2VkCgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIG9UYWJsZS5mbkRlc3Ryb3koKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkRlc3Ryb3kgPSBmdW5jdGlvbiAoIGJSZW1vdmUgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBuT3JpZyA9IG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyLnBhcmVudE5vZGU7CgkJCXZhciBuQm9keSA9IG9TZXR0aW5ncy5uVEJvZHk7CgkJCXZhciBpLCBpTGVuOwoJCQoJCQliUmVtb3ZlID0gKGJSZW1vdmU9PT11bmRlZmluZWQpID8gZmFsc2UgOiB0cnVlOwoJCQkKCQkJLyogRmxhZyB0byBub3RlIHRoYXQgdGhlIHRhYmxlIGlzIGN1cnJlbnRseSBiZWluZyBkZXN0cm95ZWQgLSBubyBhY3Rpb24gc2hvdWxkIGJlIHRha2VuICovCgkJCW9TZXR0aW5ncy5iRGVzdHJveWluZyA9IHRydWU7CgkJCQoJCQkvKiBGaXJlIG9mZiB0aGUgZGVzdHJveSBjYWxsYmFja3MgZm9yIHBsdWctaW5zIGV0YyAqLwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgImFvRGVzdHJveUNhbGxiYWNrIiwgImRlc3Ryb3kiLCBbb1NldHRpbmdzXSApOwoJCQkKCQkJLyogUmVzdG9yZSBoaWRkZW4gY29sdW1ucyAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgPT09IGZhbHNlICkKCQkJCXsKCQkJCQl0aGlzLmZuU2V0Q29sdW1uVmlzKCBpLCB0cnVlICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEJsaXR6IGFsbCBEVCBldmVudHMgKi8KCQkJJChvU2V0dGluZ3MublRhYmxlV3JhcHBlcikuZmluZCgnKicpLmFuZFNlbGYoKS51bmJpbmQoJy5EVCcpOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYW4gJ2VtcHR5JyBpbmRpY2F0b3Igcm93LCByZW1vdmUgaXQgKi8KCQkJJCgndGJvZHk+dHI+dGQuJytvU2V0dGluZ3Mub0NsYXNzZXMuc1Jvd0VtcHR5LCBvU2V0dGluZ3MublRhYmxlKS5wYXJlbnQoKS5yZW1vdmUoKTsKCQkJCgkJCS8qIFdoZW4gc2Nyb2xsaW5nIHdlIGhhZCB0byBicmVhayB0aGUgdGFibGUgdXAgLSByZXN0b3JlIGl0ICovCgkJCWlmICggb1NldHRpbmdzLm5UYWJsZSAhPSBvU2V0dGluZ3MublRIZWFkLnBhcmVudE5vZGUgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmNoaWxkcmVuKCd0aGVhZCcpLnJlbW92ZSgpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5USGVhZCApOwoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgJiYgb1NldHRpbmdzLm5UYWJsZSAhPSBvU2V0dGluZ3MublRGb290LnBhcmVudE5vZGUgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmNoaWxkcmVuKCd0Zm9vdCcpLnJlbW92ZSgpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5URm9vdCApOwoJCQl9CgkJCQoJCQkvKiBSZW1vdmUgdGhlIERhdGFUYWJsZXMgZ2VuZXJhdGVkIG5vZGVzLCBldmVudHMgYW5kIGNsYXNzZXMgKi8KCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCSQob1NldHRpbmdzLm5UYWJsZVdyYXBwZXIpLnJlbW92ZSgpOwoJCQkKCQkJb1NldHRpbmdzLmFhU29ydGluZyA9IFtdOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgPSBbXTsKCQkJX2ZuU29ydGluZ0NsYXNzZXMoIG9TZXR0aW5ncyApOwoJCQkKCQkJJChfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKSkucmVtb3ZlQ2xhc3MoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMuam9pbignICcpICk7CgkJCQoJCQkkKCd0aCwgdGQnLCBvU2V0dGluZ3MublRIZWFkKS5yZW1vdmVDbGFzcyggWwoJCQkJb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZSwKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVBc2MsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlRGVzYywKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lIF0uam9pbignICcpCgkJCSk7CgkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQl7CgkJCQkkKCd0aCBzcGFuLicrb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SWNvbgoJCQkJCSsgJywgdGQgc3Bhbi4nK29TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb24sIG9TZXR0aW5ncy5uVEhlYWQpLnJlbW92ZSgpOwoJCQoJCQkJJCgndGgsIHRkJywgb1NldHRpbmdzLm5USGVhZCkuZWFjaCggZnVuY3Rpb24gKCkgewoJCQkJCXZhciBqcVdyYXBwZXIgPSAkKCdkaXYuJytvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUlXcmFwcGVyLCB0aGlzKTsKCQkJCQl2YXIga2lkcyA9IGpxV3JhcHBlci5jb250ZW50cygpOwoJCQkJCSQodGhpcykuYXBwZW5kKCBraWRzICk7CgkJCQkJanFXcmFwcGVyLnJlbW92ZSgpOwoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBBZGQgdGhlIFRSIGVsZW1lbnRzIGJhY2sgaW50byB0aGUgdGFibGUgaW4gdGhlaXIgb3JpZ2luYWwgb3JkZXIgKi8KCQkJaWYgKCAhYlJlbW92ZSAmJiBvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgKQoJCQl7CgkJCQluT3JpZy5pbnNlcnRCZWZvcmUoIG9TZXR0aW5ncy5uVGFibGUsIG9TZXR0aW5ncy5uVGFibGVSZWluc2VydEJlZm9yZSApOwoJCQl9CgkJCWVsc2UgaWYgKCAhYlJlbW92ZSApCgkJCXsKCQkJCW5PcmlnLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJbkJvZHkuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5hb0RhdGFbaV0ublRyICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlc3RvcmUgdGhlIHdpZHRoIG9mIHRoZSBvcmlnaW5hbCB0YWJsZSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCA9PT0gdHJ1ZSApCgkJCXsKCQkJICBvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3Mob1NldHRpbmdzLnNEZXN0cm95V2lkdGgpOwoJCQl9CgkJCQoJCQkvKiBJZiB0aGUgd2VyZSBvcmlnaW5hbGx5IG9kZC9ldmVuIHR5cGUgY2xhc3NlcyAtIHRoZW4gd2UgYWRkIHRoZW0gYmFjayBoZXJlLiBOb3RlCgkJCSAqIHRoaXMgaXMgbm90IGZvb2wgcHJvb2YgKGZvciBleGFtcGxlIGlmIG5vdCBhbGwgcm93cyBhcyBvZGQvZXZlbiBjbGFzc2VzIC0gYnV0IAoJCQkgKiBpdCdzIGEgZ29vZCBlZmZvcnQgd2l0aG91dCBnZXR0aW5nIGNhcnJpZWQgYXdheQoJCQkgKi8KCQkJJChuQm9keSkuY2hpbGRyZW4oJ3RyOmV2ZW4nKS5hZGRDbGFzcyggb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKTsKCQkJJChuQm9keSkuY2hpbGRyZW4oJ3RyOm9kZCcpLmFkZENsYXNzKCBvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSApOwoJCQkKCQkJLyogUmVtb3ZlIHRoZSBzZXR0aW5ncyBvYmplY3QgZnJvbSB0aGUgc2V0dGluZ3MgYXJyYXkgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXSA9PSBvU2V0dGluZ3MgKQoJCQkJewoJCQkJCURhdGFUYWJsZS5zZXR0aW5ncy5zcGxpY2UoIGksIDEgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRW5kIGl0IGFsbCAqLwoJCQlvU2V0dGluZ3MgPSBudWxsOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUmVkcmF3IHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiQ29tcGxldGU9dHJ1ZV0gUmUtZmlsdGVyIGFuZCByZXNvcnQgKGlmIGVuYWJsZWQpIHRoZSB0YWJsZSBiZWZvcmUgdGhlIGRyYXcuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFJlLWRyYXcgdGhlIHRhYmxlIC0geW91IHdvdWxkbid0IHdhbnQgdG8gZG8gaXQgaGVyZSwgYnV0IGl0J3MgYW4gZXhhbXBsZSA6LSkKCQkgKiAgICAgIG9UYWJsZS5mbkRyYXcoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkRyYXcgPSBmdW5jdGlvbiggYkNvbXBsZXRlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlpZiAoIGJDb21wbGV0ZSA9PT0gZmFsc2UgKQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5SZURyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIGlucHV0IGJhc2VkIG9uIGRhdGEKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNJbnB1dCBTdHJpbmcgdG8gZmlsdGVyIHRoZSB0YWJsZSBvbgoJCSAqICBAcGFyYW0ge2ludHxudWxsfSBbaUNvbHVtbl0gQ29sdW1uIHRvIGxpbWl0IGZpbHRlcmluZyB0bwoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVnZXg9ZmFsc2VdIFRyZWF0IGFzIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBbYlNtYXJ0PXRydWVdIFBlcmZvcm0gc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiU2hvd0dsb2JhbD10cnVlXSBTaG93IHRoZSBpbnB1dCBnbG9iYWwgZmlsdGVyIGluIGl0J3MgaW5wdXQgYm94KGVzKQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiQ2FzZUluc2Vuc2l0aXZlPXRydWVdIERvIGNhc2UtaW5zZW5zaXRpdmUgbWF0Y2hpbmcgKHRydWUpIG9yIG5vdCAoZmFsc2UpCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFNvbWV0aW1lIGxhdGVyIC0gZmlsdGVyLi4uCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoICd0ZXN0IHN0cmluZycgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkZpbHRlciA9IGZ1bmN0aW9uKCBzSW5wdXQsIGlDb2x1bW4sIGJSZWdleCwgYlNtYXJ0LCBiU2hvd0dsb2JhbCwgYkNhc2VJbnNlbnNpdGl2ZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJaWYgKCBiUmVnZXggPT09IHVuZGVmaW5lZCB8fCBiUmVnZXggPT09IG51bGwgKQoJCQl7CgkJCQliUmVnZXggPSBmYWxzZTsKCQkJfQoJCQkKCQkJaWYgKCBiU21hcnQgPT09IHVuZGVmaW5lZCB8fCBiU21hcnQgPT09IG51bGwgKQoJCQl7CgkJCQliU21hcnQgPSB0cnVlOwoJCQl9CgkJCQoJCQlpZiAoIGJTaG93R2xvYmFsID09PSB1bmRlZmluZWQgfHwgYlNob3dHbG9iYWwgPT09IG51bGwgKQoJCQl7CgkJCQliU2hvd0dsb2JhbCA9IHRydWU7CgkJCX0KCQkJCgkJCWlmICggYkNhc2VJbnNlbnNpdGl2ZSA9PT0gdW5kZWZpbmVkIHx8IGJDYXNlSW5zZW5zaXRpdmUgPT09IG51bGwgKQoJCQl7CgkJCQliQ2FzZUluc2Vuc2l0aXZlID0gdHJ1ZTsKCQkJfQoJCQkKCQkJaWYgKCBpQ29sdW1uID09PSB1bmRlZmluZWQgfHwgaUNvbHVtbiA9PT0gbnVsbCApCgkJCXsKCQkJCS8qIEdsb2JhbCBmaWx0ZXIgKi8KCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIHsKCQkJCQkic1NlYXJjaCI6c0lucHV0KyIiLAoJCQkJCSJiUmVnZXgiOiBiUmVnZXgsCgkJCQkJImJTbWFydCI6IGJTbWFydCwKCQkJCQkiYkNhc2VJbnNlbnNpdGl2ZSI6IGJDYXNlSW5zZW5zaXRpdmUKCQkJCX0sIDEgKTsKCQkJCQoJCQkJaWYgKCBiU2hvd0dsb2JhbCAmJiBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuZiApCgkJCQl7CgkJCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuZjsKCQkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCQl7CgkJCQkJCSQobltpXS5fRFRfSW5wdXQpLnZhbCggc0lucHV0ICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2luZ2xlIGNvbHVtbiBmaWx0ZXIgKi8KCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzWyBpQ29sdW1uIF0sIHsKCQkJCQkic1NlYXJjaCI6IHNJbnB1dCsiIiwKCQkJCQkiYlJlZ2V4IjogYlJlZ2V4LAoJCQkJCSJiU21hcnQiOiBiU21hcnQsCgkJCQkJImJDYXNlSW5zZW5zaXRpdmUiOiBiQ2FzZUluc2Vuc2l0aXZlCgkJCQl9ICk7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgZGF0YSBmb3IgdGhlIHdob2xlIHRhYmxlLCBhbiBpbmRpdmlkdWFsIHJvdyBvciBhbiBpbmRpdmlkdWFsIGNlbGwgYmFzZWQgb24gdGhlIAoJCSAqIHByb3ZpZGVkIHBhcmFtZXRlcnMuCgkJICogIEBwYXJhbSB7aW50fG5vZGV9IFttUm93XSBBIFRSIHJvdyBub2RlLCBURC9USCBjZWxsIG5vZGUgb3IgYW4gaW50ZWdlci4gSWYgZ2l2ZW4gYXMKCQkgKiAgICBhIFRSIG5vZGUgdGhlbiB0aGUgZGF0YSBzb3VyY2UgZm9yIHRoZSB3aG9sZSByb3cgd2lsbCBiZSByZXR1cm5lZC4gSWYgZ2l2ZW4gYXMgYQoJCSAqICAgIFREL1RIIGNlbGwgbm9kZSB0aGVuIGlDb2wgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQgYW5kIHRoZSBkYXRhIGZvciB0aGUKCQkgKiAgICBjZWxsIHJldHVybmVkLiBJZiBnaXZlbiBhcyBhbiBpbnRlZ2VyLCB0aGVuIHRoaXMgaXMgdHJlYXRlZCBhcyB0aGUgYW9EYXRhIGludGVybmFsCgkJICogICAgZGF0YSBpbmRleCBmb3IgdGhlIHJvdyAoc2VlIGZuR2V0UG9zaXRpb24pIGFuZCB0aGUgZGF0YSBmb3IgdGhhdCByb3cgdXNlZC4KCQkgKiAgQHBhcmFtIHtpbnR9IFtpQ29sXSBPcHRpb25hbCBjb2x1bW4gaW5kZXggdGhhdCB5b3Ugd2FudCB0aGUgZGF0YSBvZi4KCQkgKiAgQHJldHVybnMge2FycmF5fG9iamVjdHxzdHJpbmd9IElmIG1Sb3cgaXMgdW5kZWZpbmVkLCB0aGVuIHRoZSBkYXRhIGZvciBhbGwgcm93cyBpcwoJCSAqICAgIHJldHVybmVkLiBJZiBtUm93IGlzIGRlZmluZWQsIGp1c3QgZGF0YSBmb3IgdGhhdCByb3csIGFuZCBpcyBpQ29sIGlzCgkJICogICAgZGVmaW5lZCwgb25seSBkYXRhIGZvciB0aGUgZGVzaWduYXRlZCBjZWxsIGlzIHJldHVybmVkLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSb3cgZGF0YQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgb1RhYmxlLiQoJ3RyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgdmFyIGRhdGEgPSBvVGFibGUuZm5HZXREYXRhKCB0aGlzICk7CgkJICogICAgICAgIC8vIC4uLiBkbyBzb21ldGhpbmcgd2l0aCB0aGUgYXJyYXkgLyBvYmplY3Qgb2YgZGF0YSBmb3IgdGhlIHJvdwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEluZGl2aWR1YWwgY2VsbCBkYXRhCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICBvVGFibGUuJCgndGQnKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICB2YXIgc0RhdGEgPSBvVGFibGUuZm5HZXREYXRhKCB0aGlzICk7CgkJICogICAgICAgIGFsZXJ0KCAnVGhlIGNlbGwgY2xpY2tlZCBvbiBoYWQgdGhlIHZhbHVlIG9mICcrc0RhdGEgKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkdldERhdGEgPSBmdW5jdGlvbiggbVJvdywgaUNvbCApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggbVJvdyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJdmFyIGlSb3cgPSBtUm93OwoJCQkJaWYgKCB0eXBlb2YgbVJvdyA9PT0gJ29iamVjdCcgKQoJCQkJewoJCQkJCXZhciBzTm9kZSA9IG1Sb3cubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJCQlpZiAoc05vZGUgPT09ICJ0ciIgKQoJCQkJCXsKCQkJCQkJaVJvdyA9IF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1Sb3cpOwoJCQkJCX0KCQkJCQllbHNlIGlmICggc05vZGUgPT09ICJ0ZCIgKQoJCQkJCXsKCQkJCQkJaVJvdyA9IF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG1Sb3cucGFyZW50Tm9kZSk7CgkJCQkJCWlDb2wgPSBfZm5Ob2RlVG9Db2x1bW5JbmRleCggb1NldHRpbmdzLCBpUm93LCBtUm93ICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJaWYgKCBpQ29sICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCXJldHVybiBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCAnJyApOwoJCQkJfQoJCQkJcmV0dXJuIChvU2V0dGluZ3MuYW9EYXRhW2lSb3ddIT09dW5kZWZpbmVkKSA/CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgOiBudWxsOwoJCQl9CgkJCXJldHVybiBfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiB0aGUgVFIgbm9kZXMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUncyBib2R5LiBOb3RlIHRoYXQgeW91IHdpbGwgCgkJICogdHlwaWNhbGx5IHdhbnQgdG8gdXNlIHRoZSAnJCcgQVBJIG1ldGhvZCBpbiBwcmVmZXJlbmNlIHRvIHRoaXMgYXMgaXQgaXMgbW9yZSAKCQkgKiBmbGV4aWJsZS4KCQkgKiAgQHBhcmFtIHtpbnR9IFtpUm93XSBPcHRpb25hbCByb3cgaW5kZXggZm9yIHRoZSBUUiBlbGVtZW50IHlvdSB3YW50CgkJICogIEByZXR1cm5zIHthcnJheXxub2RlfSBJZiBpUm93IGlzIHVuZGVmaW5lZCwgcmV0dXJucyBhbiBhcnJheSBvZiBhbGwgVFIgZWxlbWVudHMKCQkgKiAgICBpbiB0aGUgdGFibGUncyBib2R5LCBvciBpUm93IGlzIGRlZmluZWQsIGp1c3QgdGhlIFRSIGVsZW1lbnQgcmVxdWVzdGVkLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBHZXQgdGhlIG5vZGVzIGZyb20gdGhlIHRhYmxlCgkJICogICAgICB2YXIgbk5vZGVzID0gb1RhYmxlLmZuR2V0Tm9kZXMoICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXROb2RlcyA9IGZ1bmN0aW9uKCBpUm93ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJaWYgKCBpUm93ICE9PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gKG9TZXR0aW5ncy5hb0RhdGFbaVJvd10hPT11bmRlZmluZWQpID8KCQkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLm5UciA6IG51bGw7CgkJCX0KCQkJcmV0dXJuIF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBhcnJheSBpbmRleGVzIG9mIGEgcGFydGljdWxhciBjZWxsIGZyb20gaXQncyBET00gZWxlbWVudAoJCSAqIGFuZCBjb2x1bW4gaW5kZXggaW5jbHVkaW5nIGhpZGRlbiBjb2x1bW5zCgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgdGhpcyBjYW4gZWl0aGVyIGJlIGEgVFIsIFREIG9yIFRIIGluIHRoZSB0YWJsZSdzIGJvZHkKCQkgKiAgQHJldHVybnMge2ludH0gSWYgbk5vZGUgaXMgZ2l2ZW4gYXMgYSBUUiwgdGhlbiBhIHNpbmdsZSBpbmRleCBpcyByZXR1cm5lZCwgb3IKCQkgKiAgICBpZiBnaXZlbiBhcyBhIGNlbGwsIGFuIGFycmF5IG9mIFtyb3cgaW5kZXgsIGNvbHVtbiBpbmRleCAodmlzaWJsZSldIGlzIGdpdmVuLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRkJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgLy8gR2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgY3VycmVudCBkYXRhIGZyb20gdGhlIG5vZGUKCQkgKiAgICAgICAgdmFyIGFQb3MgPSBvVGFibGUuZm5HZXRQb3NpdGlvbiggdGhpcyApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gR2V0IHRoZSBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICAgICAgICB2YXIgYURhdGEgPSBvVGFibGUuZm5HZXREYXRhKCBhUG9zWzBdICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBVcGRhdGUgdGhlIGRhdGEgYXJyYXkgYW5kIHJldHVybiB0aGUgdmFsdWUKCQkgKiAgICAgICAgYURhdGFbIGFQb3NbMV0gXSA9ICdjbGlja2VkJzsKCQkgKiAgICAgICAgdGhpcy5pbm5lckhUTUwgPSAnY2xpY2tlZCc7CgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEluaXQgRGF0YVRhYmxlcwoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkdldFBvc2l0aW9uID0gZnVuY3Rpb24oIG5Ob2RlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgc05vZGVOYW1lID0gbk5vZGUubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCgkJCWlmICggc05vZGVOYW1lID09ICJUUiIgKQoJCQl7CgkJCQlyZXR1cm4gX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbk5vZGUpOwoJCQl9CgkJCWVsc2UgaWYgKCBzTm9kZU5hbWUgPT0gIlREIiB8fCBzTm9kZU5hbWUgPT0gIlRIIiApCgkJCXsKCQkJCXZhciBpRGF0YUluZGV4ID0gX2ZuTm9kZVRvRGF0YUluZGV4KCBvU2V0dGluZ3MsIG5Ob2RlLnBhcmVudE5vZGUgKTsKCQkJCXZhciBpQ29sdW1uSW5kZXggPSBfZm5Ob2RlVG9Db2x1bW5JbmRleCggb1NldHRpbmdzLCBpRGF0YUluZGV4LCBuTm9kZSApOwoJCQkJcmV0dXJuIFsgaURhdGFJbmRleCwgX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUob1NldHRpbmdzLCBpQ29sdW1uSW5kZXggKSwgaUNvbHVtbkluZGV4IF07CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBDaGVjayB0byBzZWUgaWYgYSByb3cgaXMgJ29wZW4nIG9yIG5vdC4KCQkgKiAgQHBhcmFtIHtub2RlfSBuVHIgdGhlIHRhYmxlIHJvdyB0byBjaGVjawoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGUgcm93IGlzIGN1cnJlbnRseSBvcGVuLCBmYWxzZSBvdGhlcndpc2UKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlOwoJCSAqICAgICAgCgkJICogICAgICAvLyAnb3BlbicgYW4gaW5mb3JtYXRpb24gcm93IHdoZW4gYSByb3cgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdHInKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBpZiAoIG9UYWJsZS5mbklzT3Blbih0aGlzKSApIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5DbG9zZSggdGhpcyApOwoJCSAqICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbk9wZW4oIHRoaXMsICJUZW1wb3Jhcnkgcm93IG9wZW5lZCIsICJpbmZvX3JvdyIgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuSXNPcGVuID0gZnVuY3Rpb24oIG5UciApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGFvT3BlblJvd3MgPSBvU2V0dGluZ3MuYW9PcGVuUm93czsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublBhcmVudCA9PSBuVHIgKQoJCQkJewoJCQkJCXJldHVybiB0cnVlOwoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gd2lsbCBwbGFjZSBhIG5ldyByb3cgZGlyZWN0bHkgYWZ0ZXIgYSByb3cgd2hpY2ggaXMgY3VycmVudGx5IAoJCSAqIG9uIGRpc3BsYXkgb24gdGhlIHBhZ2UsIHdpdGggdGhlIEhUTUwgY29udGVudHMgdGhhdCBpcyBwYXNzZWQgaW50byB0aGUgCgkJICogZnVuY3Rpb24uIFRoaXMgY2FuIGJlIHVzZWQsIGZvciBleGFtcGxlLCB0byBhc2sgZm9yIGNvbmZpcm1hdGlvbiB0aGF0IGEgCgkJICogcGFydGljdWxhciByZWNvcmQgc2hvdWxkIGJlIGRlbGV0ZWQuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIFRoZSB0YWJsZSByb3cgdG8gJ29wZW4nCgkJICogIEBwYXJhbSB7c3RyaW5nfG5vZGV8alF1ZXJ5fSBtSHRtbCBUaGUgSFRNTCB0byBwdXQgaW50byB0aGUgcm93CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzQ2xhc3MgQ2xhc3MgdG8gZ2l2ZSB0aGUgbmV3IFREIGNlbGwKCQkgKiAgQHJldHVybnMge25vZGV9IFRoZSByb3cgb3BlbmVkLiBOb3RlIHRoYXQgaWYgdGhlIHRhYmxlIHJvdyBwYXNzZWQgaW4gYXMgdGhlCgkJICogICAgZmlyc3QgcGFyYW1ldGVyLCBpcyBub3QgZm91bmQgaW4gdGhlIHRhYmxlLCB0aGlzIG1ldGhvZCB3aWxsIHNpbGVudGx5CgkJICogICAgcmV0dXJuLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGU7CgkJICogICAgICAKCQkgKiAgICAgIC8vICdvcGVuJyBhbiBpbmZvcm1hdGlvbiByb3cgd2hlbiBhIHJvdyBpcyBjbGlja2VkIG9uCgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGlmICggb1RhYmxlLmZuSXNPcGVuKHRoaXMpICkgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbkNsb3NlKCB0aGlzICk7CgkJICogICAgICAgIH0gZWxzZSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuT3BlbiggdGhpcywgIlRlbXBvcmFyeSByb3cgb3BlbmVkIiwgImluZm9fcm93IiApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5PcGVuID0gZnVuY3Rpb24oIG5UciwgbUh0bWwsIHNDbGFzcyApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkKCQkJLyogQ2hlY2sgdGhhdCB0aGUgcm93IGdpdmVuIGlzIGluIHRoZSB0YWJsZSAqLwoJCQl2YXIgblRhYmxlUm93cyA9IF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCQlpZiAoICQuaW5BcnJheShuVHIsIG5UYWJsZVJvd3MpID09PSAtMSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogdGhlIG9sZCBvcGVuIG9uZSBpZiB0aGVyZSBpcyBvbmUgKi8KCQkJdGhpcy5mbkNsb3NlKCBuVHIgKTsKCQkJCgkJCXZhciBuTmV3Um93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHIiKTsKCQkJdmFyIG5OZXdDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsKCQkJbk5ld1Jvdy5hcHBlbmRDaGlsZCggbk5ld0NlbGwgKTsKCQkJbk5ld0NlbGwuY2xhc3NOYW1lID0gc0NsYXNzOwoJCQluTmV3Q2VsbC5jb2xTcGFuID0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICk7CgkJCgkJCWlmICh0eXBlb2YgbUh0bWwgPT09ICJzdHJpbmciKQoJCQl7CgkJCQluTmV3Q2VsbC5pbm5lckhUTUwgPSBtSHRtbDsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQobk5ld0NlbGwpLmh0bWwoIG1IdG1sICk7CgkJCX0KCQkKCQkJLyogSWYgdGhlIG5UciBpc24ndCBvbiB0aGUgcGFnZSBhdCB0aGUgbW9tZW50IC0gdGhlbiB3ZSBkb24ndCBpbnNlcnQgYXQgdGhlIG1vbWVudCAqLwoJCQl2YXIgblRycyA9ICQoJ3RyJywgb1NldHRpbmdzLm5UQm9keSk7CgkJCWlmICggJC5pbkFycmF5KG5UciwgblRycykgIT0gLTEgICkKCQkJewoJCQkJJChuTmV3Um93KS5pbnNlcnRBZnRlcihuVHIpOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MuYW9PcGVuUm93cy5wdXNoKCB7CgkJCQkiblRyIjogbk5ld1JvdywKCQkJCSJuUGFyZW50IjogblRyCgkJCX0gKTsKCQkJCgkJCXJldHVybiBuTmV3Um93OwoJCX07CgkJCgkJCgkJLyoqCgkJICogQ2hhbmdlIHRoZSBwYWdpbmF0aW9uIC0gcHJvdmlkZXMgdGhlIGludGVybmFsIGxvZ2ljIGZvciBwYWdpbmF0aW9uIGluIGEgc2ltcGxlIEFQSSAKCQkgKiBmdW5jdGlvbi4gV2l0aCB0aGlzIGZ1bmN0aW9uIHlvdSBjYW4gaGF2ZSBhIERhdGFUYWJsZXMgdGFibGUgZ28gdG8gdGhlIG5leHQsIAoJCSAqIHByZXZpb3VzLCBmaXJzdCBvciBsYXN0IHBhZ2VzLgoJCSAqICBAcGFyYW0ge3N0cmluZ3xpbnR9IG1BY3Rpb24gUGFnaW5nIGFjdGlvbiB0byB0YWtlOiAiZmlyc3QiLCAicHJldmlvdXMiLCAibmV4dCIgb3IgImxhc3QiCgkJICogICAgb3IgcGFnZSBudW1iZXIgdG8ganVtcCB0byAoaW50ZWdlciksIG5vdGUgdGhhdCBwYWdlIDAgaXMgdGhlIGZpcnN0IHBhZ2UuCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIG9UYWJsZS5mblBhZ2VDaGFuZ2UoICduZXh0JyApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuUGFnZUNoYW5nZSA9IGZ1bmN0aW9uICggbUFjdGlvbiwgYlJlZHJhdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBtQWN0aW9uICk7CgkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFNob3cgYSBwYXJ0aWN1bGFyIGNvbHVtbgoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBUaGUgY29sdW1uIHdob3NlIGRpc3BsYXkgc2hvdWxkIGJlIGNoYW5nZWQKCQkgKiAgQHBhcmFtIHtib29sfSBiU2hvdyBTaG93ICh0cnVlKSBvciBoaWRlIChmYWxzZSkgdGhlIGNvbHVtbgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEhpZGUgdGhlIHNlY29uZCBjb2x1bW4gYWZ0ZXIgaW5pdGlhbGlzYXRpb24KCQkgKiAgICAgIG9UYWJsZS5mblNldENvbHVtblZpcyggMSwgZmFsc2UgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblNldENvbHVtblZpcyA9IGZ1bmN0aW9uICggaUNvbCwgYlNob3csIGJSZWRyYXcgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuOwoJCQl2YXIgYW9Db2x1bW5zID0gb1NldHRpbmdzLmFvQ29sdW1uczsKCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGE7CgkJCXZhciBuVGQsIGJBcHBlbmQsIGlCZWZvcmU7CgkJCQoJCQkvKiBObyBwb2ludCBpbiBkb2luZyBhbnl0aGluZyBpZiB3ZSBhcmUgcmVxdWVzdGluZyB3aGF0IGlzIGFscmVhZHkgdHJ1ZSAqLwoJCQlpZiAoIGFvQ29sdW1uc1tpQ29sXS5iVmlzaWJsZSA9PSBiU2hvdyApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgY29sdW1uICovCgkJCWlmICggYlNob3cgKQoJCQl7CgkJCQl2YXIgaUluc2VydCA9IDA7CgkJCQlmb3IgKCBpPTAgOyBpPGlDb2wgOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCWlJbnNlcnQrKzsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIE5lZWQgdG8gZGVjaWRlIGlmIHdlIHNob3VsZCB1c2UgYXBwZW5kQ2hpbGQgb3IgaW5zZXJ0QmVmb3JlICovCgkJCQliQXBwZW5kID0gKGlJbnNlcnQgPj0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICkpOwoJCQoJCQkJLyogV2hpY2ggY29sb3VtbiBzaG91bGQgd2UgYmUgaW5zZXJ0aW5nIGJlZm9yZT8gKi8KCQkJCWlmICggIWJBcHBlbmQgKQoJCQkJewoJCQkJCWZvciAoIGk9aUNvbCA7IGk8YW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIGFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJCXsKCQkJCQkJCWlCZWZvcmUgPSBpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCWlmICggYkFwcGVuZCApCgkJCQkJCXsKCQkJCQkJCWFvRGF0YVtpXS5uVHIuYXBwZW5kQ2hpbGQoIAoJCQkJCQkJCWFvRGF0YVtpXS5fYW5IaWRkZW5baUNvbF0KCQkJCQkJCSk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlhb0RhdGFbaV0ublRyLmluc2VydEJlZm9yZSgKCQkJCQkJCQlhb0RhdGFbaV0uX2FuSGlkZGVuW2lDb2xdLCAKCQkJCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGkgKVtpQmVmb3JlXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogUmVtb3ZlIGEgY29sdW1uIGZyb20gZGlzcGxheSAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGkgKVtpQ29sXTsKCQkJCQkJYW9EYXRhW2ldLl9hbkhpZGRlbltpQ29sXSA9IG5UZDsKCQkJCQkJblRkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5UZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQkvKiBDbGVhciB0byBzZXQgdGhlIHZpc2libGUgZmxhZyAqLwoJCQlhb0NvbHVtbnNbaUNvbF0uYlZpc2libGUgPSBiU2hvdzsKCQkKCQkJLyogUmVkcmF3IHRoZSBoZWFkZXIgYW5kIGZvb3RlciBiYXNlZCBvbiB0aGUgbmV3IGNvbHVtbiB2aXNpYmlsaXR5ICovCgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQkKCQkJLyogSWYgdGhlcmUgYXJlIGFueSAnb3Blbicgcm93cywgdGhlbiB3ZSBuZWVkIHRvIGFsdGVyIHRoZSBjb2xzcGFuIGZvciB0aGlzIGNvbCBjaGFuZ2UgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5Uci5jb2xTcGFuID0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIERvIGEgcmVkcmF3IGluY2FzZSBhbnl0aGluZyBkZXBlbmRpbmcgb24gdGhlIHRhYmxlIGNvbHVtbnMgbmVlZHMgaXQgCgkJCSAqIChidWlsdC1pbjogc2Nyb2xsaW5nKSAKCQkJICovCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5BZGp1c3RDb2x1bW5TaXppbmcoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCV9mblNhdmVTdGF0ZSggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHNldHRpbmdzIGZvciBhIHBhcnRpY3VsYXIgdGFibGUgZm9yIGV4dGVybmFsIG1hbmlwdWxhdGlvbgoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdC4gU2VlIAoJCSAqICAgIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIHZhciBvU2V0dGluZ3MgPSBvVGFibGUuZm5TZXR0aW5ncygpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTaG93IGFuIGV4YW1wbGUgcGFyYW1ldGVyIGZyb20gdGhlIHNldHRpbmdzCgkJICogICAgICBhbGVydCggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5TZXR0aW5ncyA9IGZ1bmN0aW9uKCkKCQl7CgkJCXJldHVybiBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogU29ydCB0aGUgdGFibGUgYnkgYSBwYXJ0aWN1bGFyIGNvbHVtbgoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCB0aGUgZGF0YSBpbmRleCB0byBzb3J0IG9uLiBOb3RlIHRoYXQgdGhpcyB3aWxsIG5vdCBtYXRjaCB0aGUgCgkJICogICAgJ2Rpc3BsYXkgaW5kZXgnIGlmIHlvdSBoYXZlIGhpZGRlbiBkYXRhIGVudHJpZXMKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29ydCBpbW1lZGlhdGVseSB3aXRoIGNvbHVtbnMgMCBhbmQgMQoJCSAqICAgICAgb1RhYmxlLmZuU29ydCggWyBbMCwnYXNjJ10sIFsxLCdhc2MnXSBdICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5Tb3J0ID0gZnVuY3Rpb24oIGFhU29ydCApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJb1NldHRpbmdzLmFhU29ydGluZyA9IGFhU29ydDsKCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBdHRhY2ggYSBzb3J0IGxpc3RlbmVyIHRvIGFuIGVsZW1lbnQgZm9yIGEgZ2l2ZW4gY29sdW1uCgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgdGhlIGVsZW1lbnQgdG8gYXR0YWNoIHRoZSBzb3J0IGxpc3RlbmVyIHRvCgkJICogIEBwYXJhbSB7aW50fSBpQ29sdW1uIHRoZSBjb2x1bW4gdGhhdCBhIGNsaWNrIG9uIHRoaXMgbm9kZSB3aWxsIHNvcnQgb24KCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gc29ydCBpcyBydW4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29ydCBvbiBjb2x1bW4gMSwgd2hlbiAnc29ydGVyJyBpcyBjbGlja2VkIG9uCgkJICogICAgICBvVGFibGUuZm5Tb3J0TGlzdGVuZXIoIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3J0ZXInKSwgMSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU29ydExpc3RlbmVyID0gZnVuY3Rpb24oIG5Ob2RlLCBpQ29sdW1uLCBmbkNhbGxiYWNrICkKCQl7CgkJCV9mblNvcnRBdHRhY2hMaXN0ZW5lciggX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKSwgbk5vZGUsIGlDb2x1bW4sCgkJCSAJZm5DYWxsYmFjayApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIGEgdGFibGUgY2VsbCBvciByb3cgLSB0aGlzIG1ldGhvZCB3aWxsIGFjY2VwdCBlaXRoZXIgYSBzaW5nbGUgdmFsdWUgdG8KCQkgKiB1cGRhdGUgdGhlIGNlbGwgd2l0aCwgYW4gYXJyYXkgb2YgdmFsdWVzIHdpdGggb25lIGVsZW1lbnQgZm9yIGVhY2ggY29sdW1uIG9yCgkJICogYW4gb2JqZWN0IGluIHRoZSBzYW1lIGZvcm1hdCBhcyB0aGUgb3JpZ2luYWwgZGF0YSBzb3VyY2UuIFRoZSBmdW5jdGlvbiBpcwoJCSAqIHNlbGYtcmVmZXJlbmNpbmcgaW4gb3JkZXIgdG8gbWFrZSB0aGUgbXVsdGkgY29sdW1uIHVwZGF0ZXMgZWFzaWVyLgoJCSAqICBAcGFyYW0ge29iamVjdHxhcnJheXxzdHJpbmd9IG1EYXRhIERhdGEgdG8gdXBkYXRlIHRoZSBjZWxsL3JvdyB3aXRoCgkJICogIEBwYXJhbSB7bm9kZXxpbnR9IG1Sb3cgVFIgZWxlbWVudCB5b3Ugd2FudCB0byB1cGRhdGUgb3IgdGhlIGFvRGF0YSBpbmRleAoJCSAqICBAcGFyYW0ge2ludH0gW2lDb2x1bW5dIFRoZSBjb2x1bW4gdG8gdXBkYXRlIChub3QgdXNlZCBvZiBtRGF0YSBpcyBhbiBhcnJheSBvciBvYmplY3QpCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBbYkFjdGlvbj10cnVlXSBQZXJmb3JtIHByZS1kcmF3IGFjdGlvbnMgb3Igbm90CgkJICogIEByZXR1cm5zIHtpbnR9IDAgb24gc3VjY2VzcywgMSBvbiBlcnJvcgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuVXBkYXRlKCAnRXhhbXBsZSB1cGRhdGUnLCAwLCAwICk7IC8vIFNpbmdsZSBjZWxsCgkJICogICAgICBvVGFibGUuZm5VcGRhdGUoIFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ10sIDEsIDAgKTsgLy8gUm93CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5VcGRhdGUgPSBmdW5jdGlvbiggbURhdGEsIG1Sb3csIGlDb2x1bW4sIGJSZWRyYXcsIGJBY3Rpb24gKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuLCBzRGlzcGxheTsKCQkJdmFyIGlSb3cgPSAodHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVJvdykgOiBtUm93OwoJCQkKCQkJaWYgKCAkLmlzQXJyYXkobURhdGEpICYmIGlDb2x1bW4gPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIEFycmF5IHVwZGF0ZSAtIHVwZGF0ZSB0aGUgd2hvbGUgcm93ICovCgkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YSA9IG1EYXRhLnNsaWNlKCk7CgkJCQkKCQkJCS8qIEZsYWcgdG8gdGhlIGZ1bmN0aW9uIHRoYXQgd2UgYXJlIHJlY3Vyc2luZyAqLwoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdGhpcy5mblVwZGF0ZSggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSApLCBpUm93LCBpLCBmYWxzZSwgZmFsc2UgKTsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggJC5pc1BsYWluT2JqZWN0KG1EYXRhKSAmJiBpQ29sdW1uID09PSB1bmRlZmluZWQgKQoJCQl7CgkJCQkvKiBPYmplY3QgdXBkYXRlIC0gdXBkYXRlIHRoZSB3aG9sZSByb3cgLSBhc3N1bWUgdGhlIGRldmVsb3BlciBnZXRzIHRoZSBvYmplY3QgcmlnaHQgKi8KCQkJCW9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhID0gJC5leHRlbmQoIHRydWUsIHt9LCBtRGF0YSApOwoJCQoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdGhpcy5mblVwZGF0ZSggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSApLCBpUm93LCBpLCBmYWxzZSwgZmFsc2UgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIEluZGl2aWR1YWwgY2VsbCB1cGRhdGUgKi8KCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sIG1EYXRhICk7CgkJCQlzRGlzcGxheSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICdkaXNwbGF5JyApOwoJCQkJCgkJCQl2YXIgb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl07CgkJCQlpZiAoIG9Db2wuZm5SZW5kZXIgIT09IG51bGwgKQoJCQkJewoJCQkJCXNEaXNwbGF5ID0gX2ZuUmVuZGVyKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4gKTsKCQkJCQlpZiAoIG9Db2wuYlVzZVJlbmRlcmVkICkKCQkJCQl7CgkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sIHNEaXNwbGF5ICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQlpZiAoIG9TZXR0aW5ncy5hb0RhdGFbaVJvd10ublRyICE9PSBudWxsICkKCQkJCXsKCQkJCQkvKiBEbyB0aGUgYWN0dWFsIEhUTUwgdXBkYXRlICovCgkJCQkJX2ZuR2V0VGROb2Rlcyggb1NldHRpbmdzLCBpUm93IClbaUNvbHVtbl0uaW5uZXJIVE1MID0gc0Rpc3BsYXk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIE1vZGlmeSB0aGUgc2VhcmNoIGluZGV4IGZvciB0aGlzIHJvdyAoc3RyaWN0bHkgdGhpcyBpcyBsaWtlbHkgbm90IG5lZWRlZCwgc2luY2UgZm5SZURyYXcKCQkJICogd2lsbCByZWJ1aWxkIHRoZSBzZWFyY2ggYXJyYXkgLSBob3dldmVyLCB0aGUgcmVkcmF3IG1pZ2h0IGJlIGRpc2FibGVkIGJ5IHRoZSB1c2VyKQoJCQkgKi8KCQkJdmFyIGlEaXNwbGF5SW5kZXggPSAkLmluQXJyYXkoIGlSb3csIG9TZXR0aW5ncy5haURpc3BsYXkgKTsKCQkJb1NldHRpbmdzLmFzRGF0YVNlYXJjaFtpRGlzcGxheUluZGV4XSA9IF9mbkJ1aWxkU2VhcmNoUm93KAoJCQkJb1NldHRpbmdzLCAKCQkJCV9mbkdldFJvd0RhdGEoIG9TZXR0aW5ncywgaVJvdywgJ2ZpbHRlcicsIF9mbkdldENvbHVtbnMoIG9TZXR0aW5ncywgJ2JTZWFyY2hhYmxlJyApICkKCQkJKTsKCQkJCgkJCS8qIFBlcmZvcm0gcHJlLWRyYXcgYWN0aW9ucyAqLwoJCQlpZiAoIGJBY3Rpb24gPT09IHVuZGVmaW5lZCB8fCBiQWN0aW9uICkKCQkJewoJCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlyZXR1cm4gMDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIGluIG9yZGVyCgkJICogdG8gZW5zdXJlIGNvbXBhdGliaWxpdHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJCSAqICAgIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSByZXF1aXJlZAoJCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICogIEBtZXRob2QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIGFsZXJ0KCBvVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuVmVyc2lvbkNoZWNrID0gRGF0YVRhYmxlLmV4dC5mblZlcnNpb25DaGVjazsKCQkKCQkKCQkvKgoJCSAqIFRoaXMgaXMgcmVhbGx5IGEgZ29vZCBiaXQgcnViYmlzaCB0aGlzIG1ldGhvZCBvZiBleHBvc2luZyB0aGUgaW50ZXJuYWwgbWV0aG9kcwoJCSAqIHB1YmxpY2x5Li4uIC0gVG8gYmUgZml4ZWQgaW4gMi4wIHVzaW5nIG1ldGhvZHMgb24gdGhlIHByb3RvdHlwZQoJCSAqLwoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIHdyYXBwZXIgZnVuY3Rpb24gZm9yIGV4cG9ydGluZyBhbiBpbnRlcm5hbCBmdW5jdGlvbnMgdG8gYW4gZXh0ZXJuYWwgQVBJLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0Z1bmMgQVBJIGZ1bmN0aW9uIG5hbWUKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSB3cmFwcGVkIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkV4dGVybkFwaUZ1bmMgKHNGdW5jKQoJCXsKCQkJcmV0dXJuIGZ1bmN0aW9uKCkgewoJCQkJdmFyIGFBcmdzID0gW19mblNldHRpbmdzRnJvbU5vZGUodGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0pXS5jb25jYXQoIAoJCQkJCUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykgKTsKCQkJCXJldHVybiBEYXRhVGFibGUuZXh0Lm9BcGlbc0Z1bmNdLmFwcGx5KCB0aGlzLCBhQXJncyApOwoJCQl9OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWZlcmVuY2UgdG8gaW50ZXJuYWwgZnVuY3Rpb25zIGZvciB1c2UgYnkgcGx1Zy1pbiBkZXZlbG9wZXJzLiBOb3RlIHRoYXQgdGhlc2UKCQkgKiBtZXRob2RzIGFyZSByZWZlcmVuY2VzIHRvIGludGVybmFsIGZ1bmN0aW9ucyBhbmQgYXJlIGNvbnNpZGVyZWQgdG8gYmUgcHJpdmF0ZS4KCQkgKiBJZiB5b3UgdXNlIHRoZXNlIG1ldGhvZHMsIGJlIGF3YXJlIHRoYXQgdGhleSBhcmUgbGlhYmxlIHRvIGNoYW5nZSBiZXR3ZWVuIHZlcnNpb25zCgkJICogKGNoZWNrIHRoZSB1cGdyYWRlIG5vdGVzKS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCXRoaXMub0FwaSA9IHsKCQkJIl9mbkV4dGVybkFwaUZ1bmMiOiBfZm5FeHRlcm5BcGlGdW5jLAoJCQkiX2ZuSW5pdGlhbGlzZSI6IF9mbkluaXRpYWxpc2UsCgkJCSJfZm5Jbml0Q29tcGxldGUiOiBfZm5Jbml0Q29tcGxldGUsCgkJCSJfZm5MYW5ndWFnZUNvbXBhdCI6IF9mbkxhbmd1YWdlQ29tcGF0LAoJCQkiX2ZuQWRkQ29sdW1uIjogX2ZuQWRkQ29sdW1uLAoJCQkiX2ZuQ29sdW1uT3B0aW9ucyI6IF9mbkNvbHVtbk9wdGlvbnMsCgkJCSJfZm5BZGREYXRhIjogX2ZuQWRkRGF0YSwKCQkJIl9mbkNyZWF0ZVRyIjogX2ZuQ3JlYXRlVHIsCgkJCSJfZm5HYXRoZXJEYXRhIjogX2ZuR2F0aGVyRGF0YSwKCQkJIl9mbkJ1aWxkSGVhZCI6IF9mbkJ1aWxkSGVhZCwKCQkJIl9mbkRyYXdIZWFkIjogX2ZuRHJhd0hlYWQsCgkJCSJfZm5EcmF3IjogX2ZuRHJhdywKCQkJIl9mblJlRHJhdyI6IF9mblJlRHJhdywKCQkJIl9mbkFqYXhVcGRhdGUiOiBfZm5BamF4VXBkYXRlLAoJCQkiX2ZuQWpheFBhcmFtZXRlcnMiOiBfZm5BamF4UGFyYW1ldGVycywKCQkJIl9mbkFqYXhVcGRhdGVEcmF3IjogX2ZuQWpheFVwZGF0ZURyYXcsCgkJCSJfZm5TZXJ2ZXJQYXJhbXMiOiBfZm5TZXJ2ZXJQYXJhbXMsCgkJCSJfZm5BZGRPcHRpb25zSHRtbCI6IF9mbkFkZE9wdGlvbnNIdG1sLAoJCQkiX2ZuRmVhdHVyZUh0bWxUYWJsZSI6IF9mbkZlYXR1cmVIdG1sVGFibGUsCgkJCSJfZm5TY3JvbGxEcmF3IjogX2ZuU2Nyb2xsRHJhdywKCQkJIl9mbkFkanVzdENvbHVtblNpemluZyI6IF9mbkFkanVzdENvbHVtblNpemluZywKCQkJIl9mbkZlYXR1cmVIdG1sRmlsdGVyIjogX2ZuRmVhdHVyZUh0bWxGaWx0ZXIsCgkJCSJfZm5GaWx0ZXJDb21wbGV0ZSI6IF9mbkZpbHRlckNvbXBsZXRlLAoJCQkiX2ZuRmlsdGVyQ3VzdG9tIjogX2ZuRmlsdGVyQ3VzdG9tLAoJCQkiX2ZuRmlsdGVyQ29sdW1uIjogX2ZuRmlsdGVyQ29sdW1uLAoJCQkiX2ZuRmlsdGVyIjogX2ZuRmlsdGVyLAoJCQkiX2ZuQnVpbGRTZWFyY2hBcnJheSI6IF9mbkJ1aWxkU2VhcmNoQXJyYXksCgkJCSJfZm5CdWlsZFNlYXJjaFJvdyI6IF9mbkJ1aWxkU2VhcmNoUm93LAoJCQkiX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoIjogX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoLAoJCQkiX2ZuRGF0YVRvU2VhcmNoIjogX2ZuRGF0YVRvU2VhcmNoLAoJCQkiX2ZuU29ydCI6IF9mblNvcnQsCgkJCSJfZm5Tb3J0QXR0YWNoTGlzdGVuZXIiOiBfZm5Tb3J0QXR0YWNoTGlzdGVuZXIsCgkJCSJfZm5Tb3J0aW5nQ2xhc3NlcyI6IF9mblNvcnRpbmdDbGFzc2VzLAoJCQkiX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSI6IF9mbkZlYXR1cmVIdG1sUGFnaW5hdGUsCgkJCSJfZm5QYWdlQ2hhbmdlIjogX2ZuUGFnZUNoYW5nZSwKCQkJIl9mbkZlYXR1cmVIdG1sSW5mbyI6IF9mbkZlYXR1cmVIdG1sSW5mbywKCQkJIl9mblVwZGF0ZUluZm8iOiBfZm5VcGRhdGVJbmZvLAoJCQkiX2ZuRmVhdHVyZUh0bWxMZW5ndGgiOiBfZm5GZWF0dXJlSHRtbExlbmd0aCwKCQkJIl9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyI6IF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZywKCQkJIl9mblByb2Nlc3NpbmdEaXNwbGF5IjogX2ZuUHJvY2Vzc2luZ0Rpc3BsYXksCgkJCSJfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCI6IF9mblZpc2libGVUb0NvbHVtbkluZGV4LAoJCQkiX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUiOiBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSwKCQkJIl9mbk5vZGVUb0RhdGFJbmRleCI6IF9mbk5vZGVUb0RhdGFJbmRleCwKCQkJIl9mblZpc2JsZUNvbHVtbnMiOiBfZm5WaXNibGVDb2x1bW5zLAoJCQkiX2ZuQ2FsY3VsYXRlRW5kIjogX2ZuQ2FsY3VsYXRlRW5kLAoJCQkiX2ZuQ29udmVydFRvV2lkdGgiOiBfZm5Db252ZXJ0VG9XaWR0aCwKCQkJIl9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyI6IF9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocywKCQkJIl9mblNjcm9sbGluZ1dpZHRoQWRqdXN0IjogX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QsCgkJCSJfZm5HZXRXaWRlc3ROb2RlIjogX2ZuR2V0V2lkZXN0Tm9kZSwKCQkJIl9mbkdldE1heExlblN0cmluZyI6IF9mbkdldE1heExlblN0cmluZywKCQkJIl9mblN0cmluZ1RvQ3NzIjogX2ZuU3RyaW5nVG9Dc3MsCgkJCSJfZm5EZXRlY3RUeXBlIjogX2ZuRGV0ZWN0VHlwZSwKCQkJIl9mblNldHRpbmdzRnJvbU5vZGUiOiBfZm5TZXR0aW5nc0Zyb21Ob2RlLAoJCQkiX2ZuR2V0RGF0YU1hc3RlciI6IF9mbkdldERhdGFNYXN0ZXIsCgkJCSJfZm5HZXRUck5vZGVzIjogX2ZuR2V0VHJOb2RlcywKCQkJIl9mbkdldFRkTm9kZXMiOiBfZm5HZXRUZE5vZGVzLAoJCQkiX2ZuRXNjYXBlUmVnZXgiOiBfZm5Fc2NhcGVSZWdleCwKCQkJIl9mbkRlbGV0ZUluZGV4IjogX2ZuRGVsZXRlSW5kZXgsCgkJCSJfZm5SZU9yZGVySW5kZXgiOiBfZm5SZU9yZGVySW5kZXgsCgkJCSJfZm5Db2x1bW5PcmRlcmluZyI6IF9mbkNvbHVtbk9yZGVyaW5nLAoJCQkiX2ZuTG9nIjogX2ZuTG9nLAoJCQkiX2ZuQ2xlYXJUYWJsZSI6IF9mbkNsZWFyVGFibGUsCgkJCSJfZm5TYXZlU3RhdGUiOiBfZm5TYXZlU3RhdGUsCgkJCSJfZm5Mb2FkU3RhdGUiOiBfZm5Mb2FkU3RhdGUsCgkJCSJfZm5DcmVhdGVDb29raWUiOiBfZm5DcmVhdGVDb29raWUsCgkJCSJfZm5SZWFkQ29va2llIjogX2ZuUmVhZENvb2tpZSwKCQkJIl9mbkRldGVjdEhlYWRlciI6IF9mbkRldGVjdEhlYWRlciwKCQkJIl9mbkdldFVuaXF1ZVRocyI6IF9mbkdldFVuaXF1ZVRocywKCQkJIl9mblNjcm9sbEJhcldpZHRoIjogX2ZuU2Nyb2xsQmFyV2lkdGgsCgkJCSJfZm5BcHBseVRvQ2hpbGRyZW4iOiBfZm5BcHBseVRvQ2hpbGRyZW4sCgkJCSJfZm5NYXAiOiBfZm5NYXAsCgkJCSJfZm5HZXRSb3dEYXRhIjogX2ZuR2V0Um93RGF0YSwKCQkJIl9mbkdldENlbGxEYXRhIjogX2ZuR2V0Q2VsbERhdGEsCgkJCSJfZm5TZXRDZWxsRGF0YSI6IF9mblNldENlbGxEYXRhLAoJCQkiX2ZuR2V0T2JqZWN0RGF0YUZuIjogX2ZuR2V0T2JqZWN0RGF0YUZuLAoJCQkiX2ZuU2V0T2JqZWN0RGF0YUZuIjogX2ZuU2V0T2JqZWN0RGF0YUZuLAoJCQkiX2ZuQXBwbHlDb2x1bW5EZWZzIjogX2ZuQXBwbHlDb2x1bW5EZWZzLAoJCQkiX2ZuQmluZEFjdGlvbiI6IF9mbkJpbmRBY3Rpb24sCgkJCSJfZm5FeHRlbmQiOiBfZm5FeHRlbmQsCgkJCSJfZm5DYWxsYmFja1JlZyI6IF9mbkNhbGxiYWNrUmVnLAoJCQkiX2ZuQ2FsbGJhY2tGaXJlIjogX2ZuQ2FsbGJhY2tGaXJlLAoJCQkiX2ZuSnNvblN0cmluZyI6IF9mbkpzb25TdHJpbmcsCgkJCSJfZm5SZW5kZXIiOiBfZm5SZW5kZXIsCgkJCSJfZm5Ob2RlVG9Db2x1bW5JbmRleCI6IF9mbk5vZGVUb0NvbHVtbkluZGV4LAoJCQkiX2ZuSW5mb01hY3JvcyI6IF9mbkluZm9NYWNyb3MsCgkJCSJfZm5Ccm93c2VyRGV0ZWN0IjogX2ZuQnJvd3NlckRldGVjdCwKCQkJIl9mbkdldENvbHVtbnMiOiBfZm5HZXRDb2x1bW5zCgkJfTsKCQkKCQkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vQXBpLCB0aGlzLm9BcGkgKTsKCQkKCQlmb3IgKCB2YXIgc0Z1bmMgaW4gRGF0YVRhYmxlLmV4dC5vQXBpICkKCQl7CgkJCWlmICggc0Z1bmMgKQoJCQl7CgkJCQl0aGlzW3NGdW5jXSA9IF9mbkV4dGVybkFwaUZ1bmMoc0Z1bmMpOwoJCQl9CgkJfQoJCQoJCQoJCXZhciBfdGhhdCA9IHRoaXM7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCgkJCXZhciBpPTAsIGlMZW4sIGosIGpMZW4sIGssIGtMZW47CgkJCXZhciBzSWQgPSB0aGlzLmdldEF0dHJpYnV0ZSggJ2lkJyApOwoJCQl2YXIgYkluaXRIYW5kZWRPZmYgPSBmYWxzZTsKCQkJdmFyIGJVc2VQYXNzZWREYXRhID0gZmFsc2U7CgkJCQoJCQkKCQkJLyogU2FuaXR5IGNoZWNrICovCgkJCWlmICggdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9ICd0YWJsZScgKQoJCQl7CgkJCQlfZm5Mb2coIG51bGwsIDAsICJBdHRlbXB0ZWQgdG8gaW5pdGlhbGlzZSBEYXRhVGFibGVzIG9uIGEgbm9kZSB3aGljaCBpcyBub3QgYSAiKwoJCQkJCSJ0YWJsZTogIit0aGlzLm5vZGVOYW1lICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIENoZWNrIHRvIHNlZSBpZiB3ZSBhcmUgcmUtaW5pdGlhbGlzaW5nIGEgdGFibGUgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkvKiBCYXNlIGNoZWNrIG9uIHRhYmxlIG5vZGUgKi8KCQkJCWlmICggRGF0YVRhYmxlLnNldHRpbmdzW2ldLm5UYWJsZSA9PSB0aGlzICkKCQkJCXsKCQkJCQlpZiAoIG9Jbml0ID09PSB1bmRlZmluZWQgfHwgb0luaXQuYlJldHJpZXZlICkKCQkJCQl7CgkJCQkJCXJldHVybiBEYXRhVGFibGUuc2V0dGluZ3NbaV0ub0luc3RhbmNlOwoJCQkJCX0KCQkJCQllbHNlIGlmICggb0luaXQuYkRlc3Ryb3kgKQoJCQkJCXsKCQkJCQkJRGF0YVRhYmxlLnNldHRpbmdzW2ldLm9JbnN0YW5jZS5mbkRlc3Ryb3koKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCV9mbkxvZyggRGF0YVRhYmxlLnNldHRpbmdzW2ldLCAwLCAiQ2Fubm90IHJlaW5pdGlhbGlzZSBEYXRhVGFibGUuXG5cbiIrCgkJCQkJCQkiVG8gcmV0cmlldmUgdGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGlzIHRhYmxlLCBwYXNzIG5vIGFyZ3VtZW50cyBvciBzZWUgIisKCQkJCQkJCSJ0aGUgZG9jcyBmb3IgYlJldHJpZXZlIGFuZCBiRGVzdHJveSIgKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogSWYgdGhlIGVsZW1lbnQgd2UgYXJlIGluaXRpYWxpc2luZyBoYXMgdGhlIHNhbWUgSUQgYXMgYSB0YWJsZSB3aGljaCB3YXMgcHJldmlvdXNseQoJCQkJICogaW5pdGlhbGlzZWQsIGJ1dCB0aGUgdGFibGUgbm9kZXMgZG9uJ3QgbWF0Y2ggKGZyb20gYmVmb3JlKSB0aGVuIHdlIGRlc3Ryb3kgdGhlIG9sZAoJCQkJICogaW5zdGFuY2UgYnkgc2ltcGx5IGRlbGV0aW5nIGl0LiBUaGlzIGlzIHVuZGVyIHRoZSBhc3N1bXB0aW9uIHRoYXQgdGhlIHRhYmxlIGhhcyBiZWVuCgkJCQkgKiBkZXN0cm95ZWQgYnkgb3RoZXIgbWV0aG9kcy4gQW55b25lIHVzaW5nIG5vbi1pZCBzZWxlY3RvcnMgd2lsbCBuZWVkIHRvIGRvIHRoaXMgbWFudWFsbHkKCQkJCSAqLwoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0uc1RhYmxlSWQgPT0gdGhpcy5pZCApCgkJCQl7CgkJCQkJRGF0YVRhYmxlLnNldHRpbmdzLnNwbGljZSggaSwgMSApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBFbnN1cmUgdGhlIHRhYmxlIGhhcyBhbiBJRCAtIHJlcXVpcmVkIGZvciBhY2Nlc3NpYmlsaXR5ICovCgkJCWlmICggc0lkID09PSBudWxsIHx8IHNJZCA9PT0gIiIgKQoJCQl7CgkJCQlzSWQgPSAiRGF0YVRhYmxlc19UYWJsZV8iKyhEYXRhVGFibGUuZXh0Ll9vRXh0ZXJuQ29uZmlnLmlOZXh0VW5pcXVlKyspOwoJCQkJdGhpcy5pZCA9IHNJZDsKCQkJfQoJCQkKCQkJLyogQ3JlYXRlIHRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgdGFibGUgYW5kIHNldCBzb21lIG9mIHRoZSBkZWZhdWx0IHBhcmFtZXRlcnMgKi8KCQkJdmFyIG9TZXR0aW5ncyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MsIHsKCQkJCSJuVGFibGUiOiAgICAgICAgdGhpcywKCQkJCSJvQXBpIjogICAgICAgICAgX3RoYXQub0FwaSwKCQkJCSJvSW5pdCI6ICAgICAgICAgb0luaXQsCgkJCQkic0Rlc3Ryb3lXaWR0aCI6ICQodGhpcykud2lkdGgoKSwKCQkJCSJzSW5zdGFuY2UiOiAgICAgc0lkLAoJCQkJInNUYWJsZUlkIjogICAgICBzSWQKCQkJfSApOwoJCQlEYXRhVGFibGUuc2V0dGluZ3MucHVzaCggb1NldHRpbmdzICk7CgkJCQoJCQkvLyBOZWVkIHRvIGFkZCB0aGUgaW5zdGFuY2UgYWZ0ZXIgdGhlIGluc3RhbmNlIGFmdGVyIHRoZSBzZXR0aW5ncyBvYmplY3QgaGFzIGJlZW4gYWRkZWQKCQkJLy8gdG8gdGhlIHNldHRpbmdzIGFycmF5LCBzbyB3ZSBjYW4gc2VsZiByZWZlcmVuY2UgdGhlIHRhYmxlIGluc3RhbmNlIGlmIG1vcmUgdGhhbiBvbmUKCQkJb1NldHRpbmdzLm9JbnN0YW5jZSA9IChfdGhhdC5sZW5ndGg9PT0xKSA/IF90aGF0IDogJCh0aGlzKS5kYXRhVGFibGUoKTsKCQkJCgkJCS8qIFNldHRpbmcgdXAgdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdCAqLwoJCQlpZiAoICFvSW5pdCApCgkJCXsKCQkJCW9Jbml0ID0ge307CgkJCX0KCQkJCgkJCS8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBiZWZvcmUgd2UgYXBwbHkgYWxsIHRoZSBkZWZhdWx0cwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZSApCgkJCXsKCQkJCV9mbkxhbmd1YWdlQ29tcGF0KCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJb0luaXQgPSBfZm5FeHRlbmQoICQuZXh0ZW5kKHRydWUsIHt9LCBEYXRhVGFibGUuZGVmYXVsdHMpLCBvSW5pdCApOwoJCQkKCQkJLy8gTWFwIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zIG9udG8gdGhlIHNldHRpbmdzIG9iamVjdAoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlBhZ2luYXRlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkxlbmd0aENoYW5nZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJGaWx0ZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiU29ydCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJJbmZvIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlByb2Nlc3NpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiQXV0b1dpZHRoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNvcnRDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNlcnZlclNpZGUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiRGVmZXJSZW5kZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFgiLCAic1giICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFhJbm5lciIsICJzWElubmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxZIiwgInNZIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgImJTY3JvbGxDb2xsYXBzZSIsICJiQ29sbGFwc2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiYlNjcm9sbEluZmluaXRlIiwgImJJbmZpbml0ZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJpU2Nyb2xsTG9hZEdhcCIsICJpTG9hZEdhcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJiU2Nyb2xsQXV0b0NzcyIsICJiQXV0b0NzcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcGVDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhc1N0cmlwQ2xhc3NlcyIsICJhc1N0cmlwZUNsYXNzZXMiICk7IC8vIGxlZ2FjeQoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblNlcnZlckRhdGEiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImZuRm9ybWF0TnVtYmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzU2VydmVyTWV0aG9kIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhYVNvcnRpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImFhU29ydGluZ0ZpeGVkIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhTGVuZ3RoTWVudSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic1BhZ2luYXRpb25UeXBlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQWpheFNvdXJjZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0FqYXhEYXRhUHJvcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaUNvb2tpZUR1cmF0aW9uIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQ29va2llUHJlZml4IiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzRG9tIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJiU29ydENlbGxzVG9wIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpVGFiSW5kZXgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgIm9TZWFyY2giLCAib1ByZXZpb3VzU2VhcmNoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhb1NlYXJjaENvbHMiLCAiYW9QcmVTZWFyY2hDb2xzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpRGlzcGxheUxlbmd0aCIsICJfaURpc3BsYXlMZW5ndGgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImJKUXVlcnlVSSIsICJiSlVJIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmbkNvb2tpZUNhbGxiYWNrIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblN0YXRlTG9hZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TdGF0ZVNhdmUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQsICJmbkluZm9DYWxsYmFjayIgKTsKCQkJCgkJCS8qIENhbGxiYWNrIGZ1bmN0aW9ucyB3aGljaCBhcmUgYXJyYXkgZHJpdmVuICovCgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICAgICAgIG9Jbml0LmZuRHJhd0NhbGxiYWNrLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TZXJ2ZXJQYXJhbXMnLCAgICAgICBvSW5pdC5mblNlcnZlclBhcmFtcywgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU3RhdGVTYXZlUGFyYW1zJywgICAgb0luaXQuZm5TdGF0ZVNhdmVQYXJhbXMsICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZFBhcmFtcycsICAgIG9Jbml0LmZuU3RhdGVMb2FkUGFyYW1zLCAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICAgICAgICBvSW5pdC5mblN0YXRlTG9hZGVkLCAgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvUm93Q2FsbGJhY2snLCAgICAgICAgb0luaXQuZm5Sb3dDYWxsYmFjaywgICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG9Jbml0LmZuQ3JlYXRlZFJvdywgICAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9IZWFkZXJDYWxsYmFjaycsICAgICBvSW5pdC5mbkhlYWRlckNhbGxiYWNrLCAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRm9vdGVyQ2FsbGJhY2snLCAgICAgb0luaXQuZm5Gb290ZXJDYWxsYmFjaywgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0luaXRDb21wbGV0ZScsICAgICAgIG9Jbml0LmZuSW5pdENvbXBsZXRlLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAgICBvSW5pdC5mblByZURyYXdDYWxsYmFjaywgICAndXNlcicgKTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmCgkJCQkgICBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0Q2xhc3NlcyApCgkJCXsKCQkJCS8qIEVuYWJsZSBzb3J0IGNsYXNzZXMgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIFNhZmUgdG8gZG8gaXQgaGVyZSwgc2luY2Ugc2VydmVyLXNpZGUKCQkJCSAqIHByb2Nlc3NpbmcgbXVzdCBiZSBlbmFibGVkIGJ5IHRoZSBkZXZlbG9wZXIKCQkJCSAqLwoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdzZXJ2ZXJfc2lkZV9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkRlZmVyUmVuZGVyICkKCQkJewoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdkZWZlcl9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYkpRdWVyeVVJICkKCQkJewoJCQkJLyogVXNlIHRoZSBKVUkgY2xhc3NlcyBvYmplY3QgZm9yIGRpc3BsYXkuIFlvdSBjb3VsZCBjbG9uZSB0aGUgb1N0ZENsYXNzZXMgb2JqZWN0IGlmIAoJCQkJICogeW91IHdhbnQgdG8gaGF2ZSBtdWx0aXBsZSB0YWJsZXMgd2l0aCBtdWx0aXBsZSBpbmRlcGVuZGVudCBjbGFzc2VzIAoJCQkJICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9DbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9KVUlDbGFzc2VzICk7CgkJCQkKCQkJCWlmICggb0luaXQuc0RvbSA9PT0gRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gJiYgRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gPT09ICJsZnJ0aXAiICkKCQkJCXsKCQkJCQkvKiBTZXQgdGhlIERPTSB0byB1c2UgYSBsYXlvdXQgc3VpdGFibGUgZm9yIGpRdWVyeSBVSSdzIHRoZW1pbmcgKi8KCQkJCQlvU2V0dGluZ3Muc0RvbSA9ICc8IkgibGZyPnQ8IkYiaXA+JzsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3Mub0NsYXNzZXMsIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMgKTsKCQkJfQoJCQkkKHRoaXMpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1RhYmxlICk7CgkJCQoJCQkvKiBDYWxjdWxhdGUgdGhlIHNjcm9sbCBiYXIgd2lkdGggYW5kIGNhY2hlIGl0IGZvciB1c2UgbGF0ZXIgb24gKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoID0gX2ZuU2Nyb2xsQmFyV2lkdGgoKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIERpc3BsYXkgc3RhcnQgcG9pbnQsIHRha2luZyBpbnRvIGFjY291bnQgdGhlIHNhdmUgc2F2aW5nICovCgkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBvSW5pdC5pRGlzcGxheVN0YXJ0OwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb0luaXQuaURpc3BsYXlTdGFydDsKCQkJfQoJCQkKCQkJLyogTXVzdCBiZSBkb25lIGFmdGVyIGV2ZXJ5dGhpbmcgd2hpY2ggY2FuIGJlIG92ZXJyaWRkZW4gYnkgYSBjb29raWUhICovCgkJCWlmICggb0luaXQuYlN0YXRlU2F2ZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSA9IHRydWU7CgkJCQlfZm5Mb2FkU3RhdGUoIG9TZXR0aW5ncywgb0luaXQgKTsKCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNhdmVTdGF0ZSwgJ3N0YXRlX3NhdmUnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuaURlZmVyTG9hZGluZyAhPT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nID0gdHJ1ZTsKCQkJCXZhciB0bXAgPSAkLmlzQXJyYXkoIG9Jbml0LmlEZWZlckxvYWRpbmcgKTsKCQkJCW9TZXR0aW5ncy5faVJlY29yZHNEaXNwbGF5ID0gdG1wID8gb0luaXQuaURlZmVyTG9hZGluZ1swXSA6IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCQlvU2V0dGluZ3MuX2lSZWNvcmRzVG90YWwgPSB0bXAgPyBvSW5pdC5pRGVmZXJMb2FkaW5nWzFdIDogb0luaXQuaURlZmVyTG9hZGluZzsKCQkJfQoJCQkKCQkJaWYgKCBvSW5pdC5hYURhdGEgIT09IG51bGwgKQoJCQl7CgkJCQliVXNlUGFzc2VkRGF0YSA9IHRydWU7CgkJCX0KCQkJCgkJCS8qIExhbmd1YWdlIGRlZmluaXRpb25zICovCgkJCWlmICggb0luaXQub0xhbmd1YWdlLnNVcmwgIT09ICIiICkKCQkJewoJCQkJLyogR2V0IHRoZSBsYW5ndWFnZSBkZWZpbml0aW9ucyBmcm9tIGEgZmlsZSAtIGJlY2F1c2UgdGhpcyBBamF4IGNhbGwgbWFrZXMgdGhlIGxhbmd1YWdlCgkJCQkgKiBnZXQgYXN5bmMgdG8gdGhlIHJlbWFpbmRlciBvZiB0aGlzIGZ1bmN0aW9uIHdlIHVzZSBiSW5pdEhhbmRlZE9mZiB0byBpbmRpY2F0ZSB0aGF0IAoJCQkJICogX2ZuSW5pdGlhbGlzZSB3aWxsIGJlIGZpcmVkIGJ5IHRoZSByZXR1cm5lZCBBamF4IGhhbmRsZXIsIHJhdGhlciB0aGFuIHRoZSBjb25zdHJ1Y3RvcgoJCQkJICovCgkJCQlvU2V0dGluZ3Mub0xhbmd1YWdlLnNVcmwgPSBvSW5pdC5vTGFuZ3VhZ2Uuc1VybDsKCQkJCSQuZ2V0SlNPTiggb1NldHRpbmdzLm9MYW5ndWFnZS5zVXJsLCBudWxsLCBmdW5jdGlvbigganNvbiApIHsKCQkJCQlfZm5MYW5ndWFnZUNvbXBhdCgganNvbiApOwoJCQkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3Mub0xhbmd1YWdlLCBvSW5pdC5vTGFuZ3VhZ2UsIGpzb24gKTsKCQkJCQlfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsKCQkJCX0gKTsKCQkJCWJJbml0SGFuZGVkT2ZmID0gdHJ1ZTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3Mub0xhbmd1YWdlLCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIFN0cmlwZXMKCQkJICovCgkJCWlmICggb0luaXQuYXNTdHJpcGVDbGFzc2VzID09PSBudWxsICkKCQkJewoJCQkJb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3NlcyA9WwoJCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkLAoJCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlRXZlbgoJCQkJXTsKCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHJvdyBzdHJpcGUgY2xhc3NlcyBpZiB0aGV5IGFyZSBhbHJlYWR5IG9uIHRoZSB0YWJsZSByb3cgKi8KCQkJdmFyIGJTdHJpcGVSZW1vdmUgPSBmYWxzZTsKCQkJdmFyIGFuUm93cyA9ICQodGhpcykuY2hpbGRyZW4oJ3Rib2R5JykuY2hpbGRyZW4oJ3RyJyk7CgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5Sb3dzLmZpbHRlcigiOmx0KDIpIikuaGFzQ2xhc3MoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbaV0pICkKCQkJCXsKCQkJCQliU3RyaXBlUmVtb3ZlID0gdHJ1ZTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCQkJCQoJCQlpZiAoIGJTdHJpcGVSZW1vdmUgKQoJCQl7CgkJCQkvKiBTdG9yZSB0aGUgY2xhc3NlcyB3aGljaCB3ZSBhcmUgYWJvdXQgdG8gcmVtb3ZlIHNvIHRoZXkgY2FuIGJlIHJlLWFkZGVkIG9uIGRlc3Ryb3kgKi8KCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzID0gWyAnJywgJycgXTsKCQkJCWlmICggJChhblJvd3NbMF0pLmhhc0NsYXNzKG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKz0gb1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQrIiAiOwoJCQkJfQoJCQkJaWYgKCAkKGFuUm93c1swXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVFdmVuKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKz0gb1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVFdmVuOwoJCQkJfQoJCQkJaWYgKCAkKGFuUm93c1sxXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCsiICI7CgkJCQl9CgkJCQlpZiAoICQoYW5Sb3dzWzFdKS5oYXNDbGFzcyhvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW4pICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW47CgkJCQl9CgkJCQkKCQkJCWFuUm93cy5yZW1vdmVDbGFzcyggb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlcy5qb2luKCcgJykgKTsKCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIENvbHVtbnMKCQkJICogU2VlIGlmIHdlIHNob3VsZCBsb2FkIGNvbHVtbnMgYXV0b21hdGljYWxseSBvciB1c2UgZGVmaW5lZCBvbmVzCgkJCSAqLwoJCQl2YXIgYW5UaHMgPSBbXTsKCQkJdmFyIGFvQ29sdW1uc0luaXQ7CgkJCXZhciBuVGhlYWQgPSB0aGlzLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpOwoJCQlpZiAoIG5UaGVhZC5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlfZm5EZXRlY3RIZWFkZXIoIG9TZXR0aW5ncy5hb0hlYWRlciwgblRoZWFkWzBdICk7CgkJCQlhblRocyA9IF9mbkdldFVuaXF1ZVRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIElmIG5vdCBnaXZlbiBhIGNvbHVtbiBhcnJheSwgZ2VuZXJhdGUgb25lIHdpdGggbnVsbHMgKi8KCQkJaWYgKCBvSW5pdC5hb0NvbHVtbnMgPT09IG51bGwgKQoJCQl7CgkJCQlhb0NvbHVtbnNJbml0ID0gW107CgkJCQlmb3IgKCBpPTAsIGlMZW49YW5UaHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhb0NvbHVtbnNJbml0LnB1c2goIG51bGwgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFvQ29sdW1uc0luaXQgPSBvSW5pdC5hb0NvbHVtbnM7CgkJCX0KCQkJCgkJCS8qIEFkZCB0aGUgY29sdW1ucyAqLwoJCQlmb3IgKCBpPTAsIGlMZW49YW9Db2x1bW5zSW5pdC5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkvKiBTaG9ydCBjdXQgLSB1c2UgdGhlIGxvb3AgdG8gY2hlY2sgaWYgd2UgaGF2ZSBjb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZSB0byByZXN0b3JlICovCgkJCQlpZiAoIG9Jbml0LnNhdmVkX2FvQ29sdW1ucyAhPT0gdW5kZWZpbmVkICYmIG9Jbml0LnNhdmVkX2FvQ29sdW1ucy5sZW5ndGggPT0gaUxlbiApCgkJCQl7CgkJCQkJaWYgKCBhb0NvbHVtbnNJbml0W2ldID09PSBudWxsICkKCQkJCQl7CgkJCQkJCWFvQ29sdW1uc0luaXRbaV0gPSB7fTsKCQkJCQl9CgkJCQkJYW9Db2x1bW5zSW5pdFtpXS5iVmlzaWJsZSA9IG9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXS5iVmlzaWJsZTsKCQkJCX0KCQkJCQoJCQkJX2ZuQWRkQ29sdW1uKCBvU2V0dGluZ3MsIGFuVGhzID8gYW5UaHNbaV0gOiBudWxsICk7CgkJCX0KCQkJCgkJCS8qIEFwcGx5IHRoZSBjb2x1bW4gZGVmaW5pdGlvbnMgKi8KCQkJX2ZuQXBwbHlDb2x1bW5EZWZzKCBvU2V0dGluZ3MsIG9Jbml0LmFvQ29sdW1uRGVmcywgYW9Db2x1bW5zSW5pdCwgZnVuY3Rpb24gKGlDb2wsIG9EZWYpIHsKCQkJCV9mbkNvbHVtbk9wdGlvbnMoIG9TZXR0aW5ncywgaUNvbCwgb0RlZiApOwoJCQl9ICk7CgkJCQoJCQkKCQkJLyoKCQkJICogU29ydGluZwoJCQkgKiBDaGVjayB0aGUgYWFTb3J0aW5nIGFycmF5CgkJCSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPj0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPSAwOwoJCQkJfQoJCQkJdmFyIG9Db2x1bW4gPSBvU2V0dGluZ3MuYW9Db2x1bW5zWyBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdIF07CgkJCQkKCQkJCS8qIEFkZCBhIGRlZmF1bHQgc29ydGluZyBpbmRleCAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPSAwOwoJCQkJfQoJCQkJCgkJCQkvKiBJZiBhYVNvcnRpbmcgaXMgbm90IGRlZmluZWQsIHRoZW4gd2UgdXNlIHRoZSBmaXJzdCBpbmRpY2F0b3IgaW4gYXNTb3J0aW5nICovCgkJCQlpZiAoIG9Jbml0LmFhU29ydGluZyA9PT0gdW5kZWZpbmVkICYmIG9TZXR0aW5ncy5zYXZlZF9hYVNvcnRpbmcgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSA9IG9Db2x1bW4uYXNTb3J0aW5nWzBdOwoJCQkJfQoJCQkJCgkJCQkvKiBTZXQgdGhlIGN1cnJlbnQgc29ydGluZyBpbmRleCBiYXNlZCBvbiBhb0NvbHVtbnMuYXNTb3J0aW5nICovCgkJCQlmb3IgKCBqPTAsIGpMZW49b0NvbHVtbi5hc1NvcnRpbmcubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMV0gPT0gb0NvbHVtbi5hc1NvcnRpbmdbal0gKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGo7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkJCgkJCS8qIERvIGEgZmlyc3QgcGFzcyBvbiB0aGUgc29ydGluZyBjbGFzc2VzIChhbGxvd3MgYW55IHNpemUgY2hhbmdlcyB0byBiZSB0YWtlbiBpbnRvCgkJCSAqIGFjY291bnQsIGFuZCBhbHNvIHdpbGwgYXBwbHkgc29ydGluZyBkaXNhYmxlZCBjbGFzc2VzIGlmIGRpc2FibGVkCgkJCSAqLwoJCQlfZm5Tb3J0aW5nQ2xhc3Nlcyggb1NldHRpbmdzICk7CgkJCQoJCQkKCQkJLyoKCQkJICogRmluYWwgaW5pdAoJCQkgKiBDYWNoZSB0aGUgaGVhZGVyLCBib2R5IGFuZCBmb290ZXIgYXMgcmVxdWlyZWQsIGNyZWF0aW5nIHRoZW0gaWYgbmVlZGVkCgkJCSAqLwoJCQkKCQkJLyogQnJvd3NlciBzdXBwb3J0IGRldGVjdGlvbiAqLwoJCQlfZm5Ccm93c2VyRGV0ZWN0KCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8vIFdvcmsgYXJvdW5kIGZvciBXZWJraXQgYnVnIDgzODY3IC0gc3RvcmUgdGhlIGNhcHRpb24tc2lkZSBiZWZvcmUgcmVtb3ZpbmcgZnJvbSBkb2MKCQkJdmFyIGNhcHRpb25zID0gJCh0aGlzKS5jaGlsZHJlbignY2FwdGlvbicpLmVhY2goIGZ1bmN0aW9uICgpIHsKCQkJCXRoaXMuX2NhcHRpb25TaWRlID0gJCh0aGlzKS5jc3MoJ2NhcHRpb24tc2lkZScpOwoJCQl9ICk7CgkJCQoJCQl2YXIgdGhlYWQgPSAkKHRoaXMpLmNoaWxkcmVuKCd0aGVhZCcpOwoJCQlpZiAoIHRoZWFkLmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXRoZWFkID0gWyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGhlYWQnICkgXTsKCQkJCXRoaXMuYXBwZW5kQ2hpbGQoIHRoZWFkWzBdICk7CgkJCX0KCQkJb1NldHRpbmdzLm5USGVhZCA9IHRoZWFkWzBdOwoJCQkKCQkJdmFyIHRib2R5ID0gJCh0aGlzKS5jaGlsZHJlbigndGJvZHknKTsKCQkJaWYgKCB0Ym9keS5sZW5ndGggPT09IDAgKQoJCQl7CgkJCQl0Ym9keSA9IFsgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3Rib2R5JyApIF07CgkJCQl0aGlzLmFwcGVuZENoaWxkKCB0Ym9keVswXSApOwoJCQl9CgkJCW9TZXR0aW5ncy5uVEJvZHkgPSB0Ym9keVswXTsKCQkJb1NldHRpbmdzLm5UQm9keS5zZXRBdHRyaWJ1dGUoICJyb2xlIiwgImFsZXJ0IiApOwoJCQlvU2V0dGluZ3MublRCb2R5LnNldEF0dHJpYnV0ZSggImFyaWEtbGl2ZSIsICJwb2xpdGUiICk7CgkJCW9TZXR0aW5ncy5uVEJvZHkuc2V0QXR0cmlidXRlKCAiYXJpYS1yZWxldmFudCIsICJhbGwiICk7CgkJCQoJCQl2YXIgdGZvb3QgPSAkKHRoaXMpLmNoaWxkcmVuKCd0Zm9vdCcpOwoJCQlpZiAoIHRmb290Lmxlbmd0aCA9PT0gMCAmJiBjYXB0aW9ucy5sZW5ndGggPiAwICYmIChvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiKSApCgkJCXsKCQkJCS8vIElmIHdlIGFyZSBhIHNjcm9sbGluZyB0YWJsZSwgYW5kIG5vIGZvb3RlciBoYXMgYmVlbiBnaXZlbiwgdGhlbiB3ZSBuZWVkIHRvIGNyZWF0ZQoJCQkJLy8gYSB0Zm9vdCBlbGVtZW50IGZvciB0aGUgY2FwdGlvbiBlbGVtZW50IHRvIGJlIGFwcGVuZGVkIHRvCgkJCQl0Zm9vdCA9IFsgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3Rmb290JyApIF07CgkJCQl0aGlzLmFwcGVuZENoaWxkKCB0Zm9vdFswXSApOwoJCQl9CgkJCQoJCQlpZiAoIHRmb290Lmxlbmd0aCA+IDAgKQoJCQl7CgkJCQlvU2V0dGluZ3MublRGb290ID0gdGZvb3RbMF07CgkJCQlfZm5EZXRlY3RIZWFkZXIoIG9TZXR0aW5ncy5hb0Zvb3Rlciwgb1NldHRpbmdzLm5URm9vdCApOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBpZiB0aGVyZSBpcyBkYXRhIHBhc3NpbmcgaW50byB0aGUgY29uc3RydWN0b3IgKi8KCQkJaWYgKCBiVXNlUGFzc2VkRGF0YSApCgkJCXsKCQkJCWZvciAoIGk9MCA7IGk8b0luaXQuYWFEYXRhLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBvSW5pdC5hYURhdGFbIGkgXSApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogR3JhYiB0aGUgZGF0YSBmcm9tIHRoZSBwYWdlICovCgkJCQlfZm5HYXRoZXJEYXRhKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogQ29weSB0aGUgZGF0YSBpbmRleCBhcnJheSAqLwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkKCQkJLyogSW5pdGlhbGlzYXRpb24gY29tcGxldGUgLSB0YWJsZSBjYW4gYmUgZHJhd24gKi8KCQkJb1NldHRpbmdzLmJJbml0aWFsaXNlZCA9IHRydWU7CgkJCQoJCQkvKiBDaGVjayBpZiB3ZSBuZWVkIHRvIGluaXRpYWxpc2UgdGhlIHRhYmxlIChpdCBtaWdodCBub3QgaGF2ZSBiZWVuIGhhbmRlZCBvZmYgdG8gdGhlCgkJCSAqIGxhbmd1YWdlIHByb2Nlc3NvcikKCQkJICovCgkJCWlmICggYkluaXRIYW5kZWRPZmYgPT09IGZhbHNlICkKCQkJewoJCQkJX2ZuSW5pdGlhbGlzZSggb1NldHRpbmdzICk7CgkJCX0KCQl9ICk7Cgl9OwoKCQoJCgkvKioKCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIGluIG9yZGVyCgkgKiB0byBlbnN1cmUgY29tcGF0aWJpbGl0eS4KCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZlcnNpb24gVmVyc2lvbiBzdHJpbmcgdG8gY2hlY2sgZm9yLCBpbiB0aGUgZm9ybWF0ICJYLlkuWiIuIE5vdGUgdGhhdCB0aGUKCSAqICAgIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIHJlcXVpcmVkCgkgKiAgICB2ZXJzaW9uLCBvciBmYWxzZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhbGVzIGlzIG5vdCBzdWl0YWJsZQoJICogIEBzdGF0aWMKCSAqICBAZHRvcHQgQVBJLVN0YXRpYwoJICoKCSAqICBAZXhhbXBsZQoJICogICAgYWxlcnQoICQuZm4uZGF0YVRhYmxlLmZuVmVyc2lvbkNoZWNrKCAnMS45LjAnICkgKTsKCSAqLwoJRGF0YVRhYmxlLmZuVmVyc2lvbkNoZWNrID0gZnVuY3Rpb24oIHNWZXJzaW9uICkKCXsKCQkvKiBUaGlzIGlzIGNoZWFwLCBidXQgZWZmZWN0aXZlICovCgkJdmFyIGZuWlBhZCA9IGZ1bmN0aW9uIChacGFkLCBjb3VudCkKCQl7CgkJCXdoaWxlKFpwYWQubGVuZ3RoIDwgY291bnQpIHsKCQkJCVpwYWQgKz0gJzAnOwoJCQl9CgkJCXJldHVybiBacGFkOwoJCX07CgkJdmFyIGFUaGlzID0gRGF0YVRhYmxlLmV4dC5zVmVyc2lvbi5zcGxpdCgnLicpOwoJCXZhciBhVGhhdCA9IHNWZXJzaW9uLnNwbGl0KCcuJyk7CgkJdmFyIHNUaGlzID0gJycsIHNUaGF0ID0gJyc7CgkJCgkJZm9yICggdmFyIGk9MCwgaUxlbj1hVGhhdC5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCXsKCQkJc1RoaXMgKz0gZm5aUGFkKCBhVGhpc1tpXSwgMyApOwoJCQlzVGhhdCArPSBmblpQYWQoIGFUaGF0W2ldLCAzICk7CgkJfQoJCQoJCXJldHVybiBwYXJzZUludChzVGhpcywgMTApID49IHBhcnNlSW50KHNUaGF0LCAxMCk7Cgl9OwoJCgkKCS8qKgoJICogQ2hlY2sgaWYgYSBUQUJMRSBub2RlIGlzIGEgRGF0YVRhYmxlIHRhYmxlIGFscmVhZHkgb3Igbm90LgoJICogIEBwYXJhbSB7bm9kZX0gblRhYmxlIFRoZSBUQUJMRSBub2RlIHRvIGNoZWNrIGlmIGl0IGlzIGEgRGF0YVRhYmxlIG9yIG5vdCAobm90ZSB0aGF0IG90aGVyCgkgKiAgICBub2RlIHR5cGVzIGNhbiBiZSBwYXNzZWQgaW4sIGJ1dCB3aWxsIGFsd2F5cyByZXR1cm4gZmFsc2UpLgoJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIHRoZSB0YWJsZSBnaXZlbiBpcyBhIERhdGFUYWJsZSwgb3IgZmFsc2Ugb3RoZXJ3aXNlCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICB2YXIgZXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhhbXBsZScpOwoJICogICAgaWYgKCAhICQuZm4uRGF0YVRhYmxlLmZuSXNEYXRhVGFibGUoIGV4ICkgKSB7CgkgKiAgICAgICQoZXgpLmRhdGFUYWJsZSgpOwoJICogICAgfQoJICovCglEYXRhVGFibGUuZm5Jc0RhdGFUYWJsZSA9IGZ1bmN0aW9uICggblRhYmxlICkKCXsKCQl2YXIgbyA9IERhdGFUYWJsZS5zZXR0aW5nczsKCQoJCWZvciAoIHZhciBpPTAgOyBpPG8ubGVuZ3RoIDsgaSsrICkKCQl7CgkJCWlmICggb1tpXS5uVGFibGUgPT09IG5UYWJsZSB8fCBvW2ldLm5TY3JvbGxIZWFkID09PSBuVGFibGUgfHwgb1tpXS5uU2Nyb2xsRm9vdCA9PT0gblRhYmxlICkKCQkJewoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQl9CgkKCQlyZXR1cm4gZmFsc2U7Cgl9OwoJCgkKCS8qKgoJICogR2V0IGFsbCBEYXRhVGFibGUgdGFibGVzIHRoYXQgaGF2ZSBiZWVuIGluaXRpYWxpc2VkIC0gb3B0aW9uYWxseSB5b3UgY2FuIHNlbGVjdCB0bwoJICogZ2V0IG9ubHkgY3VycmVudGx5IHZpc2libGUgdGFibGVzLgoJICogIEBwYXJhbSB7Ym9vbGVhbn0gW2JWaXNpYmxlPWZhbHNlXSBGbGFnIHRvIGluZGljYXRlIGlmIHlvdSB3YW50IGFsbCAoZGVmYXVsdCkgb3IgCgkgKiAgICB2aXNpYmxlIHRhYmxlcyBvbmx5LgoJICogIEByZXR1cm5zIHthcnJheX0gQXJyYXkgb2YgVEFCTEUgbm9kZXMgKG5vdCBEYXRhVGFibGUgaW5zdGFuY2VzKSB3aGljaCBhcmUgRGF0YVRhYmxlcwoJICogIEBzdGF0aWMKCSAqICBAZHRvcHQgQVBJLVN0YXRpYwoJICoKCSAqICBAZXhhbXBsZQoJICogICAgdmFyIHRhYmxlID0gJC5mbi5kYXRhVGFibGUuZm5UYWJsZXModHJ1ZSk7CgkgKiAgICBpZiAoIHRhYmxlLmxlbmd0aCA+IDAgKSB7CgkgKiAgICAgICQodGFibGUpLmRhdGFUYWJsZSgpLmZuQWRqdXN0Q29sdW1uU2l6aW5nKCk7CgkgKiAgICB9CgkgKi8KCURhdGFUYWJsZS5mblRhYmxlcyA9IGZ1bmN0aW9uICggYlZpc2libGUgKQoJewoJCXZhciBvdXQgPSBbXTsKCQoJCWpRdWVyeS5lYWNoKCBEYXRhVGFibGUuc2V0dGluZ3MsIGZ1bmN0aW9uIChpLCBvKSB7CgkJCWlmICggIWJWaXNpYmxlIHx8IChiVmlzaWJsZSA9PT0gdHJ1ZSAmJiAkKG8ublRhYmxlKS5pcygnOnZpc2libGUnKSkgKQoJCQl7CgkJCQlvdXQucHVzaCggby5uVGFibGUgKTsKCQkJfQoJCX0gKTsKCQoJCXJldHVybiBvdXQ7Cgl9OwoJCgoJLyoqCgkgKiBWZXJzaW9uIHN0cmluZyBmb3IgcGx1Zy1pbnMgdG8gY2hlY2sgY29tcGF0aWJpbGl0eS4gQWxsb3dlZCBmb3JtYXQgaXMKCSAqIGEuYi5jLmQuZSB3aGVyZTogYTppbnQsIGI6aW50LCBjOmludCwgZDpzdHJpbmcoZGV2fGJldGEpLCBlOmludC4gZCBhbmQKCSAqIGUgYXJlIG9wdGlvbmFsCgkgKiAgQG1lbWJlcgoJICogIEB0eXBlIHN0cmluZwoJICogIEBkZWZhdWx0IFZlcnNpb24gbnVtYmVyCgkgKi8KCURhdGFUYWJsZS52ZXJzaW9uID0gIjEuOS4zIjsKCgkvKioKCSAqIFByaXZhdGUgZGF0YSBzdG9yZSwgY29udGFpbmluZyBhbGwgb2YgdGhlIHNldHRpbmdzIG9iamVjdHMgdGhhdCBhcmUgY3JlYXRlZCBmb3IgdGhlCgkgKiB0YWJsZXMgb24gYSBnaXZlbiBwYWdlLgoJICogCgkgKiBOb3RlIHRoYXQgdGhlIDxpPkRhdGFUYWJsZS5zZXR0aW5nczwvaT4gb2JqZWN0IGlzIGFsaWFzZWQgdG8gPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZUV4dDwvaT4gCgkgKiB0aHJvdWdoIHdoaWNoIGl0IG1heSBiZSBhY2Nlc3NlZCBhbmQgbWFuaXB1bGF0ZWQsIG9yIDxpPmpRdWVyeS5mbi5kYXRhVGFibGUuc2V0dGluZ3M8L2k+LgoJICogIEBtZW1iZXIKCSAqICBAdHlwZSBhcnJheQoJICogIEBkZWZhdWx0IFtdCgkgKiAgQHByaXZhdGUKCSAqLwoJRGF0YVRhYmxlLnNldHRpbmdzID0gW107CgoJLyoqCgkgKiBPYmplY3QgbW9kZWxzIGNvbnRhaW5lciwgZm9yIHRoZSB2YXJpb3VzIG1vZGVscyB0aGF0IERhdGFUYWJsZXMgaGFzIGF2YWlsYWJsZQoJICogdG8gaXQuIFRoZXNlIG1vZGVscyBkZWZpbmUgdGhlIG9iamVjdHMgdGhhdCBhcmUgdXNlZCB0byBob2xkIHRoZSBhY3RpdmUgc3RhdGUgCgkgKiBhbmQgY29uZmlndXJhdGlvbiBvZiB0aGUgdGFibGUuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzID0ge307CgkKCQoJLyoqCgkgKiBEYXRhVGFibGVzIGV4dGVuc2lvbiBvcHRpb25zIGFuZCBwbHVnLWlucy4gVGhpcyBuYW1lc3BhY2UgYWN0cyBhcyBhIGNvbGxlY3Rpb24gImFyZWEiCgkgKiBmb3IgcGx1Zy1pbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBleHRlbmQgdGhlIGRlZmF1bHQgRGF0YVRhYmxlcyBiZWhhdmlvdXIgLSBpbmRlZWQgbWFueQoJICogb2YgdGhlIGJ1aWxkIGluIG1ldGhvZHMgdXNlIHRoaXMgbWV0aG9kIHRvIHByb3ZpZGUgdGhlaXIgb3duIGNhcGFiaWxpdGllcyAoc29ydGluZyBtZXRob2RzCgkgKiBmb3IgZXhhbXBsZSkuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG5hbWVzcGFjZSBpcyBhbGlhc2VkIHRvIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQgc28gaXQgY2FuIGJlIHJlYWRpbHkgYWNjZXNzZWQKCSAqIGFuZCBtb2RpZmllZCBieSBwbHVnLWlucy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMuZXh0ID0gewoJCS8qKgoJCSAqIFBsdWctaW4gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIHRoaXMgbWV0aG9kIG9mIGZpbHRlcmluZyBpcyBjb21wbGltZW50YXJ5IHRvIHRoZSBkZWZhdWx0CgkJICogdHlwZSBiYXNlZCBmaWx0ZXJpbmcsIGFuZCBhIGxvdCBtb3JlIGNvbXByZWhlbnNpdmUgYXMgaXQgYWxsb3dzIHlvdSBjb21wbGV0ZSBjb250cm9sCgkJICogb3ZlciB0aGUgZmlsdGVyaW5nIGxvZ2ljLiBFYWNoIGVsZW1lbnQgaW4gdGhpcyBhcnJheSBpcyBhIGZ1bmN0aW9uIChwYXJhbWV0ZXJzCgkJICogZGVzY3JpYmVkIGJlbG93KSB0aGF0IGlzIGNhbGxlZCBmb3IgZXZlcnkgcm93IGluIHRoZSB0YWJsZSwgYW5kIHlvdXIgbG9naWMgZGVjaWRlcyBpZgoJCSAqIGl0IHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgZmlsdGVyZWQgZGF0YSBzZXQgb3Igbm90LgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICA8bGk+e2FycmF5fG9iamVjdH0gRGF0YSBmb3IgdGhlIHJvdyB0byBiZSBwcm9jZXNzZWQgKHNhbWUgYXMgdGhlIG9yaWdpbmFsIGZvcm1hdAoJCSAqICAgICAgICAgICB0aGF0IHdhcyBwYXNzZWQgaW4gYXMgdGhlIGRhdGEgc291cmNlLCBvciBhbiBhcnJheSBmcm9tIGEgRE9NIGRhdGEgc291cmNlPC9saT4KCQkgKiAgICAgICAgIDxsaT57aW50fSBSb3cgaW5kZXggaW4gYW9EYXRhICh7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MuYW9EYXRhfSksIHdoaWNoIGNhbgoJCSAqICAgICAgICAgICBiZSB1c2VmdWwgdG8gcmV0cmlldmUgdGhlIFRSIGVsZW1lbnQgaWYgeW91IG5lZWQgRE9NIGludGVyYWN0aW9uLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2Jvb2xlYW59IEluY2x1ZGUgdGhlIHJvdyBpbiB0aGUgZmlsdGVyZWQgcmVzdWx0IHNldCAodHJ1ZSkgb3Igbm90IChmYWxzZSk8L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVGhlIGZvbGxvd2luZyBleGFtcGxlIHNob3dzIGN1c3RvbSBmaWx0ZXJpbmcgYmVpbmcgYXBwbGllZCB0byB0aGUgZm91cnRoIGNvbHVtbiAoaS5lLgoJCSAqICAgIC8vIHRoZSBhRGF0YVszXSBpbmRleCkgYmFzZWQgb24gdHdvIGlucHV0IHZhbHVlcyBmcm9tIHRoZSBlbmQtdXNlciwgbWF0Y2hpbmcgdGhlIGRhdGEgaW4gCgkJICogICAgLy8gYSBjZXJ0YWluIHJhbmdlLgoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0LmFmbkZpbHRlcmluZy5wdXNoKAoJCSAqICAgICAgZnVuY3Rpb24oIG9TZXR0aW5ncywgYURhdGEsIGlEYXRhSW5kZXggKSB7CgkJICogICAgICAgIHZhciBpTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pbicpLnZhbHVlICogMTsKCQkgKiAgICAgICAgdmFyIGlNYXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF4JykudmFsdWUgKiAxOwoJCSAqICAgICAgICB2YXIgaVZlcnNpb24gPSBhRGF0YVszXSA9PSAiLSIgPyAwIDogYURhdGFbM10qMTsKCQkgKiAgICAgICAgaWYgKCBpTWluID09ICIiICYmIGlNYXggPT0gIiIgKSB7CgkJICogICAgICAgICAgcmV0dXJuIHRydWU7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgZWxzZSBpZiAoIGlNaW4gPT0gIiIgJiYgaVZlcnNpb24gPCBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIGVsc2UgaWYgKCBpTWluIDwgaVZlcnNpb24gJiYgIiIgPT0gaU1heCApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICBlbHNlIGlmICggaU1pbiA8IGlWZXJzaW9uICYmIGlWZXJzaW9uIDwgaU1heCApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICB9CgkJICogICAgKTsKCQkgKi8KCQkiYWZuRmlsdGVyaW5nIjogW10sCgkKCQoJCS8qKgoJCSAqIFBsdWctaW4gc29ydGluZyBmdW5jdGlvbnMgLSB0aGlzIG1ldGhvZCBvZiBzb3J0aW5nIGlzIGNvbXBsaW1lbnRhcnkgdG8gdGhlIGRlZmF1bHQgdHlwZQoJCSAqIGJhc2VkIHNvcnRpbmcgdGhhdCBEYXRhVGFibGVzIGRvZXMgYXV0b21hdGljYWxseSwgYWxsb3dpbmcgbXVjaCBncmVhdGVyIGNvbnRyb2wgb3ZlciB0aGUKCQkgKiB0aGUgZGF0YSB0aGF0IGlzIGJlaW5nIHVzZWQgdG8gc29ydCBhIGNvbHVtbi4gVGhpcyBpcyB1c2VmdWwgaWYgeW91IHdhbnQgdG8gZG8gc29ydGluZwoJCSAqIGJhc2VkIG9uIGxpdmUgZGF0YSAoZm9yIGV4YW1wbGUgdGhlIGNvbnRlbnRzIG9mIGFuICdpbnB1dCcgZWxlbWVudCkgcmF0aGVyIHRoYW4ganVzdCB0aGUKCQkgKiBzdGF0aWMgc3RyaW5nIHRoYXQgRGF0YVRhYmxlcyBrbm93cyBvZi4gVGhlIHdheSB0aGVzZSBwbHVnLWlucyB3b3JrIGlzIHRoYXQgeW91IGNyZWF0ZQoJCSAqIGFuIGFycmF5IG9mIHRoZSB2YWx1ZXMgeW91IHdpc2ggdG8gYmUgc29ydGVkIGZvciB0aGUgY29sdW1uIGluIHF1ZXN0aW9uIGFuZCB0aGVuIHJldHVybgoJCSAqIHRoYXQgYXJyYXkuIFdoaWNoIHByZS1zb3J0aW5nIGZ1bmN0aW9uIGlzIHJ1biBoZXJlIGRlcGVuZHMgb24gdGhlIHNTb3J0RGF0YVR5cGUgcGFyYW1ldGVyCgkJICogdGhhdCBpcyB1c2VkIGZvciB0aGUgY29sdW1uIChpZiBhbnkpLiBUaGlzIGlzIHRoZSBjb3JvbGxhcnkgb2YgPGk+b2ZuU2VhcmNoPC9pPiBmb3Igc29ydCAKCQkgKiBkYXRhLgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkgICAgICogICAgICAgICA8bGk+e2ludH0gVGFyZ2V0IGNvbHVtbiBpbmRleDwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2FycmF5fSBEYXRhIGZvciB0aGUgY29sdW1uIHRvIGJlIHNvcnRlZCB1cG9uPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgCgkJICogTm90ZSB0aGF0IGFzIG9mIHYxLjksIGl0IGlzIHR5cGljYWxseSBwcmVmZXJhYmxlIHRvIHVzZSA8aT5tRGF0YTwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhPC9pPiB3aGVuCgkJICogdXNlZCBhcyBhIGZ1bmN0aW9uIHdpbGwgZ2l2ZSB5b3UgYSAndHlwZScgKHNvcnRpbmcsIGZpbHRlcmluZyBldGMpIHRoYXQgeW91IGNhbiB1c2UgdG8gCgkJICogcHJlcGFyZSB0aGUgZGF0YSBhcyByZXF1aXJlZCBmb3IgdGhlIGRpZmZlcmVudCB0eXBlcy4gQXMgc3VjaCwgdGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVwZGF0aW5nIHRoZSBjYWNoZWQgc29ydGluZyBpbmZvcm1hdGlvbiB3aXRoIHVzZXIgZW50ZXJlZCB2YWx1ZXMgaW4gSFRNTCBpbnB1dCBlbGVtZW50cwoJCSAqICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQuYWZuU29ydERhdGFbJ2RvbS10ZXh0J10gPSBmdW5jdGlvbiAoIG9TZXR0aW5ncywgaUNvbHVtbiApCgkJICogICAgewoJCSAqICAgICAgdmFyIGFEYXRhID0gW107CgkJICogICAgICAkKCAndGQ6ZXEoJytpQ29sdW1uKycpIGlucHV0Jywgb1NldHRpbmdzLm9BcGkuX2ZuR2V0VHJOb2RlcyhvU2V0dGluZ3MpICkuZWFjaCggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBhRGF0YS5wdXNoKCB0aGlzLnZhbHVlICk7CgkJICogICAgICB9ICk7CgkJICogICAgICByZXR1cm4gYURhdGE7CgkJICogICAgfQoJCSAqLwoJCSJhZm5Tb3J0RGF0YSI6IFtdLAoJCgkKCQkvKioKCQkgKiBGZWF0dXJlIHBsdWctaW5zIC0gVGhpcyBpcyBhbiBhcnJheSBvZiBvYmplY3RzIHdoaWNoIGRlc2NyaWJlIHRoZSBmZWF0dXJlIHBsdWctaW5zIHRoYXQgYXJlCgkJICogYXZhaWxhYmxlIHRvIERhdGFUYWJsZXMuIFRoZXNlIGZlYXR1cmUgcGx1Zy1pbnMgYXJlIGFjY2Vzc2libGUgdGhyb3VnaCB0aGUgc0RvbSBpbml0aWFsaXNhdGlvbgoJCSAqIG9wdGlvbi4gQXMgc3VjaCwgZWFjaCBmZWF0dXJlIHBsdWctaW4gbXVzdCBkZXNjcmliZSBhIGZ1bmN0aW9uIHRoYXQgaXMgdXNlZCB0byBpbml0aWFsaXNlCgkJICogaXRzZWxmIChmbkluaXQpLCBhIGNoYXJhY3RlciBzbyB0aGUgZmVhdHVyZSBjYW4gYmUgZW5hYmxlZCBieSBzRG9tIChjRmVhdHVyZSkgYW5kIHRoZSBuYW1lCgkJICogb2YgdGhlIGZlYXR1cmUgKHNGZWF0dXJlKS4gVGh1cyB0aGUgb2JqZWN0cyBhdHRhY2hlZCB0byB0aGlzIG1ldGhvZCBtdXN0IHByb3ZpZGU6CgkJICogICA8dWw+CgkJICogICAgIDxsaT57ZnVuY3Rpb259IGZuSW5pdCBJbml0aWFsaXNhdGlvbiBvZiB0aGUgcGx1Zy1pbgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCSAgICAgKiAgICAgICAgICAgPC91bD4KCSAgICAgKiAgICAgICAgIDwvbGk+CgkJICogICAgICAgICA8bGk+CgkJICogICAgICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57bm9kZXxudWxsfSBUaGUgZWxlbWVudCB3aGljaCBjb250YWlucyB5b3VyIGZlYXR1cmUuIE5vdGUgdGhhdCB0aGUgcmV0dXJuCgkJICogICAgICAgICAgICAgICAgbWF5IGFsc28gYmUgdm9pZCBpZiB5b3VyIHBsdWctaW4gZG9lcyBub3QgcmVxdWlyZSB0byBpbmplY3QgYW55IERPTSBlbGVtZW50cyAKCQkgKiAgICAgICAgICAgICAgICBpbnRvIERhdGFUYWJsZXMgY29udHJvbCAoc0RvbSkgLSBmb3IgZXhhbXBsZSB0aGlzIG1pZ2h0IGJlIHVzZWZ1bCB3aGVuIAoJCSAqICAgICAgICAgICAgICAgIGRldmVsb3BpbmcgYSBwbHVnLWluIHdoaWNoIGFsbG93cyB0YWJsZSBjb250cm9sIHZpYSBrZXlib2FyZCBlbnRyeS48L2xpPgoJCSAqICAgICAgICAgICA8L3VsPgoJCSAqICAgICAgICAgPC9pbD4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+e2NoYXJhY3Rlcn0gY0ZlYXR1cmUgQ2hhcmFjdGVyIHRoYXQgd2lsbCBiZSBtYXRjaGVkIGluIHNEb20gLSBjYXNlIHNlbnNpdGl2ZTwvbGk+CgkJICogICAgIDxsaT57c3RyaW5nfSBzRmVhdHVyZSBGZWF0dXJlIG5hbWU8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBIb3cgVGFibGVUb29scyBpbml0aWFsaXNlcyBpdHNlbGYuCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQuYW9GZWF0dXJlcy5wdXNoKCB7CgkJICogICAgICAiZm5Jbml0IjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgcmV0dXJuIG5ldyBUYWJsZVRvb2xzKCB7ICJvRFRTZXR0aW5ncyI6IG9TZXR0aW5ncyB9ICk7CgkJICogICAgICB9LAoJCSAqICAgICAgImNGZWF0dXJlIjogIlQiLAoJCSAqICAgICAgInNGZWF0dXJlIjogIlRhYmxlVG9vbHMiCgkJICogICAgfSApOwoJCSAqLwoJCSJhb0ZlYXR1cmVzIjogW10sCgkKCQoJCS8qKgoJCSAqIFR5cGUgZGV0ZWN0aW9uIHBsdWctaW4gZnVuY3Rpb25zIC0gRGF0YVRhYmxlcyB1dGlsaXNlcyB0eXBlcyB0byBkZWZpbmUgaG93IHNvcnRpbmcgYW5kCgkJICogZmlsdGVyaW5nIGJlaGF2ZSwgYW5kIHR5cGVzIGNhbiBiZSBlaXRoZXIgIGJlIGRlZmluZWQgYnkgdGhlIGRldmVsb3BlciAoc1R5cGUgZm9yIHRoZQoJCSAqIGNvbHVtbikgb3IgdGhleSBjYW4gYmUgYXV0b21hdGljYWxseSBkZXRlY3RlZCBieSB0aGUgbWV0aG9kcyBpbiB0aGlzIGFycmF5LiBUaGUgZnVuY3Rpb25zCgkJICogZGVmaW5lZCBpbiB0aGUgYXJyYXkgYXJlIHF1aXRlIHNpbXBsZSwgdGFraW5nIGEgc2luZ2xlIHBhcmFtZXRlciAodGhlIGRhdGEgdG8gYW5hbHlzZSkgCgkJICogYW5kIHJldHVybmluZyB0aGUgdHlwZSBpZiBpdCBpcyBhIGtub3duIHR5cGUsIG9yIG51bGwgb3RoZXJ3aXNlLgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+eyp9IERhdGEgZnJvbSB0aGUgY29sdW1uIGNlbGwgdG8gYmUgYW5hbHlzZWQ8L2xpPgoJICAgICAqICAgICAgIDwvdWw+CgkgICAgICogICAgIDwvbGk+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBGdW5jdGlvbiByZXR1cm46CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd8bnVsbH0gRGF0YSB0eXBlIGRldGVjdGVkLCBvciBudWxsIGlmIHVua25vd24gKGFuZCB0aHVzIHBhc3MgaXQKCQkgKiAgICAgICAgICAgb24gdG8gdGhlIG90aGVyIHR5cGUgZGV0ZWN0aW9uIGZ1bmN0aW9ucy48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDdXJyZW5jeSB0eXBlIGRldGVjdGlvbiBwbHVnLWluOgoJCSAqICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQuYVR5cGVzLnB1c2goCgkJICogICAgICBmdW5jdGlvbiAoIHNEYXRhICkgewoJCSAqICAgICAgICB2YXIgc1ZhbGlkQ2hhcnMgPSAiMDEyMzQ1Njc4OS4tIjsKCQkgKiAgICAgICAgdmFyIENoYXI7CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBDaGVjayB0aGUgbnVtZXJpYyBwYXJ0CgkJICogICAgICAgIGZvciAoIGk9MSA7IGk8c0RhdGEubGVuZ3RoIDsgaSsrICkgewoJCSAqICAgICAgICAgIENoYXIgPSBzRGF0YS5jaGFyQXQoaSk7IAoJCSAqICAgICAgICAgIGlmIChzVmFsaWRDaGFycy5pbmRleE9mKENoYXIpID09IC0xKSB7CgkJICogICAgICAgICAgICByZXR1cm4gbnVsbDsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIENoZWNrIHByZWZpeGVkIGJ5IGN1cnJlbmN5CgkJICogICAgICAgIGlmICggc0RhdGEuY2hhckF0KDApID09ICckJyB8fCBzRGF0YS5jaGFyQXQoMCkgPT0gJyZwb3VuZDsnICkgewoJCSAqICAgICAgICAgIHJldHVybiAnY3VycmVuY3knOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIHJldHVybiBudWxsOwoJCSAqICAgICAgfQoJCSAqICAgICk7CgkJICovCgkJImFUeXBlcyI6IFtdLAoJCgkKCQkvKioKCQkgKiBQcm92aWRlIGEgY29tbW9uIG1ldGhvZCBmb3IgcGx1Zy1pbnMgdG8gY2hlY2sgdGhlIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBiZWluZyB1c2VkLCAKCQkgKiBpbiBvcmRlciB0byBlbnN1cmUgY29tcGF0aWJpbGl0eS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWZXJzaW9uIFZlcnNpb24gc3RyaW5nIHRvIGNoZWNrIGZvciwgaW4gdGhlIGZvcm1hdCAiWC5ZLloiLiBOb3RlIAoJCSAqICAgIHRoYXQgdGhlIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSAKCQkgKiAgICByZXF1aXJlZCB2ZXJzaW9uLCBvciBmYWxzZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhbGVzIGlzIG5vdCBzdWl0YWJsZQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIGFsZXJ0KCBvVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5WZXJzaW9uQ2hlY2siOiBEYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2ssCgkKCQoJCS8qKgoJCSAqIEluZGV4IGZvciB3aGF0ICd0aGlzJyBpbmRleCBBUEkgZnVuY3Rpb25zIHNob3VsZCB1c2UKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiaUFwaUluZGV4IjogMCwKCQoJCgkJLyoqCgkJICogUHJlLXByb2Nlc3Npbmcgb2YgZmlsdGVyaW5nIGRhdGEgcGx1Zy1pbnMgLSBXaGVuIHlvdSBhc3NpZ24gdGhlIHNUeXBlIGZvciBhIGNvbHVtbgoJCSAqIChvciBoYXZlIGl0IGF1dG9tYXRpY2FsbHkgZGV0ZWN0ZWQgZm9yIHlvdSBieSBEYXRhVGFibGVzIG9yIGEgdHlwZSBkZXRlY3Rpb24gcGx1Zy1pbiksIAoJCSAqIHlvdSB3aWxsIHR5cGljYWxseSBiZSB1c2luZyB0aGlzIGZvciBjdXN0b20gc29ydGluZywgYnV0IGl0IGNhbiBhbHNvIGJlIHVzZWQgdG8gcHJvdmlkZSAKCQkgKiBjdXN0b20gZmlsdGVyaW5nIGJ5IGFsbG93aW5nIHlvdSB0byBwcmUtcHJvY2Vzc2luZyB0aGUgZGF0YSBhbmQgcmV0dXJuaW5nIHRoZSBkYXRhIGluCgkJICogdGhlIGZvcm1hdCB0aGF0IHNob3VsZCBiZSBmaWx0ZXJlZCB1cG9uLiBUaGlzIGlzIGRvbmUgYnkgYWRkaW5nIGZ1bmN0aW9ucyB0aGlzIG9iamVjdCAKCQkgKiB3aXRoIGEgcGFyYW1ldGVyIG5hbWUgd2hpY2ggbWF0Y2hlcyB0aGUgc1R5cGUgZm9yIHRoYXQgdGFyZ2V0IGNvbHVtbi4gVGhpcyBpcyB0aGUKCQkgKiBjb3JvbGxhcnkgb2YgPGk+YWZuU29ydERhdGE8L2k+IGZvciBmaWx0ZXJpbmcgZGF0YS4KCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIGZyb20gdGhlIGNvbHVtbiBjZWxsIHRvIGJlIHByZXBhcmVkIGZvciBmaWx0ZXJpbmc8L2xpPgoJICAgICAqICAgICAgIDwvdWw+CgkgICAgICogICAgIDwvbGk+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBGdW5jdGlvbiByZXR1cm46CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd8bnVsbH0gRm9ybWF0dGVkIHN0cmluZyB0aGF0IHdpbGwgYmUgdXNlZCBmb3IgdGhlIGZpbHRlcmluZy48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqIAoJCSAqIE5vdGUgdGhhdCBhcyBvZiB2MS45LCBpdCBpcyB0eXBpY2FsbHkgcHJlZmVyYWJsZSB0byB1c2UgPGk+bURhdGE8L2k+IHRvIHByZXBhcmUgZGF0YSBmb3IKCQkgKiB0aGUgZGlmZmVyZW50IHVzZXMgdGhhdCBEYXRhVGFibGVzIGNhbiBwdXQgdGhlIGRhdGEgdG8uIFNwZWNpZmljYWxseSA8aT5tRGF0YTwvaT4gd2hlbgoJCSAqIHVzZWQgYXMgYSBmdW5jdGlvbiB3aWxsIGdpdmUgeW91IGEgJ3R5cGUnIChzb3J0aW5nLCBmaWx0ZXJpbmcgZXRjKSB0aGF0IHlvdSBjYW4gdXNlIHRvIAoJCSAqIHByZXBhcmUgdGhlIGRhdGEgYXMgcmVxdWlyZWQgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMuIEFzIHN1Y2gsIHRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQub2ZuU2VhcmNoWyd0aXRsZS1udW1lcmljJ10gPSBmdW5jdGlvbiAoIHNEYXRhICkgewoJCSAqICAgICAgcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1xuL2csIiAiKS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkgKiAgICB9CgkJICovCgkJIm9mblNlYXJjaCI6IHt9LAoJCgkKCQkvKioKCQkgKiBDb250YWluZXIgZm9yIGFsbCBwcml2YXRlIGZ1bmN0aW9ucyBpbiBEYXRhVGFibGVzIHNvIHRoZXkgY2FuIGJlIGV4cG9zZWQgZXh0ZXJuYWxseQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0FwaSI6IHt9LAoJCgkKCQkvKioKCQkgKiBTdG9yYWdlIGZvciB0aGUgdmFyaW91cyBjbGFzc2VzIHRoYXQgRGF0YVRhYmxlcyB1c2VzCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvU3RkQ2xhc3NlcyI6IHt9LAoJCQoJCgkJLyoqCgkJICogU3RvcmFnZSBmb3IgdGhlIHZhcmlvdXMgY2xhc3NlcyB0aGF0IERhdGFUYWJsZXMgdXNlcyAtIGpRdWVyeSBVSSBzdWl0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0pVSUNsYXNzZXMiOiB7fSwKCQoJCgkJLyoqCgkJICogUGFnaW5hdGlvbiBwbHVnLWluIG1ldGhvZHMgLSBUaGUgc3R5bGUgYW5kIGNvbnRyb2xzIG9mIHRoZSBwYWdpbmF0aW9uIGNhbiBzaWduaWZpY2FudGx5IAoJCSAqIGltcGFjdCBvbiBob3cgdGhlIGVuZCB1c2VyIGludGVyYWN0cyB3aXRoIHRoZSBkYXRhIGluIHlvdXIgdGFibGUsIGFuZCBEYXRhVGFibGVzIGFsbG93cyAKCQkgKiB0aGUgYWRkaXRpb24gb2YgcGFnaW5hdGlvbiBjb250cm9scyBieSBleHRlbmRpbmcgdGhpcyBvYmplY3QsIHdoaWNoIGNhbiB0aGVuIGJlIGVuYWJsZWQKCQkgKiB0aHJvdWdoIHRoZSA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IGluaXRpYWxpc2F0aW9uIHBhcmFtZXRlci4gRWFjaCBwYWdpbmF0aW9uIHR5cGUgdGhhdAoJCSAqIGlzIGFkZGVkIGlzIGFuIG9iamVjdCAodGhlIHByb3BlcnR5IG5hbWUgb2Ygd2hpY2ggaXMgd2hhdCA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IHJlZmVycwoJCSAqIHRvKSB0aGF0IGhhcyB0d28gcHJvcGVydGllcywgYm90aCBtZXRob2RzIHRoYXQgYXJlIHVzZWQgYnkgRGF0YVRhYmxlcyB0byB1cGRhdGUgdGhlCgkJICogY29udHJvbCdzIHN0YXRlLgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwYWdpbmcgY29udHJvbHMuIENhbGxlZCBvbmx5IGR1cmluZyBpbml0aWFsaXNhdGlvbiAKCQkgKiAgICAgICAgIG9mIHRoZSB0YWJsZS4gSXQgaXMgZXhwZWN0ZWQgdGhhdCB0aGlzIGZ1bmN0aW9uIHdpbGwgYWRkIHRoZSByZXF1aXJlZCBET00gZWxlbWVudHMgCgkJICogICAgICAgICB0byB0aGUgcGFnZSBmb3IgdGhlIHBhZ2luZyBjb250cm9scyB0byB3b3JrLiBUaGUgZWxlbWVudCBwb2ludGVyIAoJCSAqICAgICAgICAgJ29TZXR0aW5ncy5hYW5GZWF0dXJlcy5wJyBhcnJheSBpcyBwcm92aWRlZCBieSBEYXRhVGFibGVzIHRvIGNvbnRhaW4gdGhlIHBhZ2luZyAKCQkgKiAgICAgICAgIGNvbnRyb2xzIChub3RlIHRoYXQgdGhpcyBpcyBhIDJEIGFycmF5IHRvIGFsbG93IGZvciBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgZWFjaCAKCQkgKiAgICAgICAgIERhdGFUYWJsZXMgRE9NIGVsZW1lbnQpLiBJdCBpcyBzdWdnZXN0ZWQgdGhhdCB5b3UgYWRkIHRoZSBjb250cm9scyB0byB0aGlzIGVsZW1lbnQgCgkJICogICAgICAgICBhcyBjaGlsZHJlbgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgICAgICA8bGk+e25vZGV9IENvbnRhaW5lciBpbnRvIHdoaWNoIHRoZSBwYWdpbmF0aW9uIGNvbnRyb2xzIG11c3QgYmUgaW5zZXJ0ZWQ8L2xpPgoJCSAqICAgICAgICAgICAgIDxsaT57ZnVuY3Rpb259IERyYXcgY2FsbGJhY2sgZnVuY3Rpb24gLSB3aGVuZXZlciB0aGUgY29udHJvbHMgY2F1c2UgYSBwYWdlCgkJICogICAgICAgICAgICAgICBjaGFuZ2UsIHRoaXMgbWV0aG9kIG11c3QgYmUgY2FsbGVkIHRvIHJlZHJhdyB0aGUgdGFibGUuPC9saT4KCSAgICAgKiAgICAgICAgICAgPC91bD4KCSAgICAgKiAgICAgICAgIDwvbGk+CgkJICogICAgICAgICA8bGk+CgkJICogICAgICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT5ObyByZXR1cm4gcmVxdWlyZWQ8L2xpPgoJCSAqICAgICAgICAgICA8L3VsPgoJCSAqICAgICAgICAgPC9pbD4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyIHRoZSBwYWdpbmcgc3RhdHVzIG9mIHRoZSB0YWJsZSBjaGFuZ2VzIGFuZCBpcwoJCSAqICAgICAgICAgdHlwaWNhbGx5IHVzZWQgdG8gdXBkYXRlIGNsYXNzZXMgYW5kL29yIHRleHQgb2YgdGhlIHBhZ2luZyBjb250cm9scyB0byByZWZsZXggdGhlIG5ldyAKCQkgKiAgICAgICAgIHN0YXR1cy4KCQkgKiAgICAgICA8dWw+CgkgICAgICogICAgICAgICA8bGk+CgkgICAgICogICAgICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICAgICAgPGxpPntmdW5jdGlvbn0gRHJhdyBjYWxsYmFjayBmdW5jdGlvbiAtIGluIGNhc2UgeW91IG5lZWQgdG8gcmVkcmF3IHRoZSB0YWJsZSBhZ2FpbgoJCSAqICAgICAgICAgICAgICAgb3IgYXR0YWNoIG5ldyBldmVudCBsaXN0ZW5lcnM8L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPk5vIHJldHVybiByZXF1aXJlZDwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uLmZvdXJfYnV0dG9uID0gewoJCSAqICAgICAgImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgbkZpcnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5QcmV2aW91cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTmV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTGFzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0ZpcnN0ICkgKTsKCQkgKiAgICAgICAgblByZXZpb3VzLmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc1ByZXZpb3VzICkgKTsKCQkgKiAgICAgICAgbk5leHQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zTmV4dCApICk7CgkJICogICAgICAgIG5MYXN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0xhc3QgKSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9idXR0b24gZmlyc3QiOwoJCSAqICAgICAgICBuUHJldmlvdXMuY2xhc3NOYW1lID0gInBhZ2luYXRlX2J1dHRvbiBwcmV2aW91cyI7CgkJICogICAgICAgIG5OZXh0LmNsYXNzTmFtZT0icGFnaW5hdGVfYnV0dG9uIG5leHQiOwoJCSAqICAgICAgICBuTGFzdC5jbGFzc05hbWUgPSAicGFnaW5hdGVfYnV0dG9uIGxhc3QiOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgblBhZ2luZy5hcHBlbmRDaGlsZCggbkZpcnN0ICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5QcmV2aW91cyApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTmV4dCApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTGFzdCApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuRmlyc3QpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAiZmlyc3QiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5QcmV2aW91cykuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgInByZXZpb3VzIiApOwoJCSAqICAgICAgICAgIGZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkgKiAgICAgICAgfSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuTmV4dCkuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgIm5leHQiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5MYXN0KS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAibGFzdCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQobkZpcnN0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5QcmV2aW91cykuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTmV4dCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTGFzdCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAKCQkgKiAgICAgICJmblVwZGF0ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKSB7CgkJICogICAgICAgICAgcmV0dXJuOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBMb29wIG92ZXIgZWFjaCBpbnN0YW5jZSBvZiB0aGUgcGFnZXIKCQkgKiAgICAgICAgdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJICogICAgICAgIGZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkgewoJCSAqICAgICAgICAgIHZhciBidXR0b25zID0gYW5baV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKTsKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMF0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzBdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkgewoJCSAqICAgICAgICAgICAgYnV0dG9uc1syXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfbmV4dCI7CgkJICogICAgICAgICAgICBidXR0b25zWzNdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzJdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1szXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZW5hYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0KCQkgKiAgICB9OwoJCSAqLwoJCSJvUGFnaW5hdGlvbiI6IHt9LAoJCgkKCQkvKioKCQkgKiBTb3J0aW5nIHBsdWctaW4gbWV0aG9kcyAtIFNvcnRpbmcgaW4gRGF0YVRhYmxlcyBpcyBiYXNlZCBvbiB0aGUgZGV0ZWN0ZWQgdHlwZSBvZiB0aGUKCQkgKiBkYXRhIGNvbHVtbiAoeW91IGNhbiBhZGQgeW91ciBvd24gdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLCBvciBvdmVycmlkZSBhdXRvbWF0aWMgCgkJICogZGV0ZWN0aW9uIHVzaW5nIHNUeXBlKS4gV2l0aCB0aGlzIHNwZWNpZmljIHR5cGUgZ2l2ZW4gdG8gdGhlIGNvbHVtbiwgRGF0YVRhYmxlcyB3aWxsIAoJCSAqIGFwcGx5IHRoZSByZXF1aXJlZCBzb3J0IGZyb20gdGhlIGZ1bmN0aW9ucyBpbiB0aGUgb2JqZWN0LiBFYWNoIHNvcnQgdHlwZSBtdXN0IHByb3ZpZGUKCQkgKiB0d28gbWFuZGF0b3J5IG1ldGhvZHMsIG9uZSBlYWNoIGZvciBhc2NlbmRpbmcgYW5kIGRlc2NlbmRpbmcgc29ydGluZywgYW5kIGNhbiBvcHRpb25hbGx5CgkJICogcHJvdmlkZSBhIHByZS1mb3JtYXR0aW5nIG1ldGhvZCB0aGF0IHdpbGwgaGVscCBzcGVlZCB1cCBzb3J0aW5nIGJ5IGFsbG93aW5nIERhdGFUYWJsZXMKCQkgKiB0byBwcmUtZm9ybWF0IHRoZSBzb3J0IGRhdGEgb25seSBvbmNlIChyYXRoZXIgdGhhbiBldmVyeSB0aW1lIHRoZSBhY3R1YWwgc29ydCBmdW5jdGlvbnMKCQkgKiBhcmUgcnVuKS4gVGhlIHR3byBzb3J0aW5nIGZ1bmN0aW9ucyBhcmUgdHlwaWNhbCBKYXZhc2NyaXB0IHNvcnQgbWV0aG9kczoKCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIHNlY29uZCBwYXJhbWV0ZXI8L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIGZpcnN0IHBhcmFtZXRlcjwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2ludH0gU29ydGluZyBtYXRjaDogPDAgaWYgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgbG93ZXIgdGhhbgoJCSAqICAgICAgICAgICB0aGUgc2Vjb25kIHBhcmFtZXRlciwgPT09MCBpZiB0aGUgdHdvIHBhcmFtZXRlcnMgYXJlIGVxdWFsIGFuZCA+MCBpZgoJCSAqICAgICAgICAgICB0aGUgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgaGVpZ2h0IHRoYW4gdGhlIHNlY29uZCBwYXJhbWV0ZXIuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDYXNlLXNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBubyBwcmUtZm9ybWF0dGluZyBtZXRob2QKCQkgKiAgICAkLmV4dGVuZCggJC5mbi5kYXRhVGFibGVFeHQub1NvcnQsIHsKCQkgKiAgICAgICJzdHJpbmctY2FzZS1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1jYXNlLWRlc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJICogICAgICB9CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gQ2FzZS1pbnNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBwcmUtZm9ybWF0dGluZwoJCSAqICAgICQuZXh0ZW5kKCAkLmZuLmRhdGFUYWJsZUV4dC5vU29ydCwgewoJCSAqICAgICAgInN0cmluZy1wcmUiOiBmdW5jdGlvbih4KSB7CgkJICogICAgICAgIHJldHVybiB4LnRvTG93ZXJDYXNlKCk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1kZXNjIjogZnVuY3Rpb24oeCx5KSB7CgkJICogICAgICAgIHJldHVybiAoKHggPCB5KSA/IDEgOiAoKHggPiB5KSA/IC0xIDogMCkpOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkib1NvcnQiOiB7fSwKCQoJCgkJLyoqCgkJICogVmVyc2lvbiBzdHJpbmcgZm9yIHBsdWctaW5zIHRvIGNoZWNrIGNvbXBhdGliaWxpdHkuIEFsbG93ZWQgZm9ybWF0IGlzCgkJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJCSAqIGUgYXJlIG9wdGlvbmFsCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBWZXJzaW9uIG51bWJlcgoJCSAqLwoJCSJzVmVyc2lvbiI6IERhdGFUYWJsZS52ZXJzaW9uLAoJCgkKCQkvKioKCQkgKiBIb3cgc2hvdWxkIERhdGFUYWJsZXMgcmVwb3J0IGFuIGVycm9yLiBDYW4gdGFrZSB0aGUgdmFsdWUgJ2FsZXJ0JyBvciAndGhyb3cnCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhbGVydAoJCSAqLwoJCSJzRXJyTW9kZSI6ICJhbGVydCIsCgkKCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGZvciBEYXRhVGFibGVzIHRvIGFjY2VzcyBnbG9iYWxseSBhYm91dCBvdGhlciBpbnN0YW5jZXMKCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfb0V4dGVybkNvbmZpZyI6IHsKCQkJLyogaW50OmlOZXh0VW5pcXVlIC0gbmV4dCB1bmlxdWUgbnVtYmVyIGZvciBhbiBpbnN0YW5jZSAqLwoJCQkiaU5leHRVbmlxdWUiOiAwCgkJfQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogc2VhcmNoIGluZm9ybWF0aW9uIGZvciB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVycy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCA9IHsKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBmaWx0ZXJpbmcgc2hvdWxkIGJlIGNhc2UgaW5zZW5zaXRpdmUgb3Igbm90CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiQ2FzZUluc2Vuc2l0aXZlIjogdHJ1ZSwKCQoJCS8qKgoJCSAqIEFwcGxpZWQgc2VhcmNoIHRlcm0KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic1NlYXJjaCI6ICIiLAoJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgc2VhcmNoIHRlcm0gc2hvdWxkIGJlIGludGVycHJldGVkIGFzIGEKCQkgKiByZWd1bGFyIGV4cHJlc3Npb24gKHRydWUpIG9yIG5vdCAoZmFsc2UpIGFuZCB0aGVyZWZvcmUgYW5kIHNwZWNpYWwKCQkgKiByZWdleCBjaGFyYWN0ZXJzIGVzY2FwZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYlJlZ2V4IjogZmFsc2UsCgkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIERhdGFUYWJsZXMgaXMgdG8gdXNlIGl0cyBzbWFydCBmaWx0ZXJpbmcgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYlNtYXJ0IjogdHJ1ZQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogZWFjaCBpbmRpdmlkdWFsIHJvdy4gVGhpcyBpcyB0aGUgb2JqZWN0IGZvcm1hdCB1c2VkIGZvciB0aGUgc2V0dGluZ3MgCgkgKiBhb0RhdGEgYXJyYXkuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzLm9Sb3cgPSB7CgkJLyoqCgkJICogVFIgZWxlbWVudCBmb3IgdGhlIHJvdwoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRyIjogbnVsbCwKCQoJCS8qKgoJCSAqIERhdGEgb2JqZWN0IGZyb20gdGhlIG9yaWdpbmFsIGRhdGEgc291cmNlIGZvciB0aGUgcm93LiBUaGlzIGlzIGVpdGhlcgoJCSAqIGFuIGFycmF5IGlmIHVzaW5nIHRoZSB0cmFkaXRpb25hbCBmb3JtIG9mIERhdGFUYWJsZXMsIG9yIGFuIG9iamVjdCBpZgoJCSAqIHVzaW5nIG1EYXRhIG9wdGlvbnMuIFRoZSBleGFjdCB0eXBlIHdpbGwgZGVwZW5kIG9uIHRoZSBwYXNzZWQgaW4KCQkgKiBkYXRhIGZyb20gdGhlIGRhdGEgc291cmNlLCBvciB3aWxsIGJlIGFuIGFycmF5IGlmIHVzaW5nIERPTSBhIGRhdGEgCgkJICogc291cmNlLgoJCSAqICBAdHlwZSBhcnJheXxvYmplY3QKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiX2FEYXRhIjogW10sCgkKCQkvKioKCQkgKiBTb3J0aW5nIGRhdGEgY2FjaGUgLSB0aGlzIGFycmF5IGlzIG9zdGVuc2libHkgdGhlIHNhbWUgbGVuZ3RoIGFzIHRoZQoJCSAqIG51bWJlciBvZiBjb2x1bW5zIChhbHRob3VnaCBlYWNoIGluZGV4IGlzIGdlbmVyYXRlZCBvbmx5IGFzIGl0IGlzIAoJCSAqIG5lZWRlZCksIGFuZCBob2xkcyB0aGUgZGF0YSB0aGF0IGlzIHVzZWQgZm9yIHNvcnRpbmcgZWFjaCBjb2x1bW4gaW4gdGhlCgkJICogcm93LiBXZSBkbyB0aGlzIGNhY2hlIGdlbmVyYXRpb24gYXQgdGhlIHN0YXJ0IG9mIHRoZSBzb3J0IGluIG9yZGVyIHRoYXQKCQkgKiB0aGUgZm9ybWF0dGluZyBvZiB0aGUgc29ydCBkYXRhIG5lZWQgYmUgZG9uZSBvbmx5IG9uY2UgZm9yIGVhY2ggY2VsbAoJCSAqIHBlciBzb3J0LiBUaGlzIGFycmF5IHNob3VsZCBub3QgYmUgcmVhZCBmcm9tIG9yIHdyaXR0ZW4gdG8gYnkgYW55dGhpbmcKCQkgKiBvdGhlciB0aGFuIHRoZSBtYXN0ZXIgc29ydGluZyBtZXRob2RzLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYVNvcnREYXRhIjogW10sCgkKCQkvKioKCQkgKiBBcnJheSBvZiBURCBlbGVtZW50cyB0aGF0IGFyZSBjYWNoZWQgZm9yIGhpZGRlbiByb3dzLCBzbyB0aGV5IGNhbiBiZQoJCSAqIHJlaW5zZXJ0ZWQgaW50byB0aGUgdGFibGUgaWYgYSBjb2x1bW4gaXMgbWFkZSB2aXNpYmxlIGFnYWluIChvciB0byBhY3QKCQkgKiBhcyBhIHN0b3JlIGlmIGEgY29sdW1uIGlzIG1hZGUgaGlkZGVuKS4gT25seSBoaWRkZW4gY29sdW1ucyBoYXZlIGEgCgkJICogcmVmZXJlbmNlIGluIHRoZSBhcnJheS4gRm9yIG5vbi1oaWRkZW4gY29sdW1ucyB0aGUgdmFsdWUgaXMgZWl0aGVyCgkJICogdW5kZWZpbmVkIG9yIG51bGwuCgkJICogIEB0eXBlIGFycmF5IG5vZGVzCgkJICogIEBkZWZhdWx0IFtdCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9hbkhpZGRlbiI6IFtdLAoJCgkJLyoqCgkJICogQ2FjaGUgb2YgdGhlIGNsYXNzIG5hbWUgdGhhdCBEYXRhVGFibGVzIGhhcyBhcHBsaWVkIHRvIHRoZSByb3csIHNvIHdlCgkJICogY2FuIHF1aWNrbHkgbG9vayBhdCB0aGlzIHZhcmlhYmxlIHJhdGhlciB0aGFuIG5lZWRpbmcgdG8gZG8gYSBET00gY2hlY2sKCQkgKiBvbiBjbGFzc05hbWUgZm9yIHRoZSBuVHIgcHJvcGVydHkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBwcml2YXRlCgkJICovCgkJIl9zUm93U3RyaXBlIjogIiIKCX07CgkKCQoJCgkvKioKCSAqIFRlbXBsYXRlIG9iamVjdCBmb3IgdGhlIGNvbHVtbiBpbmZvcm1hdGlvbiBvYmplY3QgaW4gRGF0YVRhYmxlcy4gVGhpcyBvYmplY3QKCSAqIGlzIGhlbGQgaW4gdGhlIHNldHRpbmdzIGFvQ29sdW1ucyBhcnJheSBhbmQgY29udGFpbnMgYWxsIHRoZSBpbmZvcm1hdGlvbiB0aGF0CgkgKiBEYXRhVGFibGVzIG5lZWRzIGFib3V0IGVhY2ggaW5kaXZpZHVhbCBjb2x1bW4uCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG9iamVjdCBpcyByZWxhdGVkIHRvIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uc30gCgkgKiBidXQgdGhpcyBvbmUgaXMgdGhlIGludGVybmFsIGRhdGEgc3RvcmUgZm9yIERhdGFUYWJsZXMncyBjYWNoZSBvZiBjb2x1bW5zLgoJICogSXQgc2hvdWxkIE5PVCBiZSBtYW5pcHVsYXRlZCBvdXRzaWRlIG9mIERhdGFUYWJsZXMuIEFueSBjb25maWd1cmF0aW9uIHNob3VsZAoJICogYmUgZG9uZSB0aHJvdWdoIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5vQ29sdW1uID0gewoJCS8qKgoJCSAqIEEgbGlzdCBvZiB0aGUgY29sdW1ucyB0aGF0IHNvcnRpbmcgc2hvdWxkIG9jY3VyIG9uIHdoZW4gdGhpcyBjb2x1bW4KCQkgKiBpcyBzb3J0ZWQuIFRoYXQgdGhpcyBwcm9wZXJ0eSBpcyBhbiBhcnJheSBhbGxvd3MgbXVsdGktY29sdW1uIHNvcnRpbmcKCQkgKiB0byBiZSBkZWZpbmVkIGZvciBhIGNvbHVtbiAoZm9yIGV4YW1wbGUgZmlyc3QgbmFtZSAvIGxhc3QgbmFtZSBjb2x1bW5zCgkJICogd291bGQgYmVuZWZpdCBmcm9tIHRoaXMpLiBUaGUgdmFsdWVzIGFyZSBpbnRlZ2VycyBwb2ludGluZyB0byB0aGUKCQkgKiBjb2x1bW5zIHRvIGJlIHNvcnRlZCBvbiAodHlwaWNhbGx5IGl0IHdpbGwgYmUgYSBzaW5nbGUgaW50ZWdlciBwb2ludGluZwoJCSAqIGF0IGl0c2VsZiwgYnV0IHRoYXQgZG9lc24ndCBuZWVkIHRvIGJlIHRoZSBjYXNlKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKi8KCQkiYURhdGFTb3J0IjogbnVsbCwKCQoJCS8qKgoJCSAqIERlZmluZSB0aGUgc29ydGluZyBkaXJlY3Rpb25zIHRoYXQgYXJlIGFwcGxpZWQgdG8gdGhlIGNvbHVtbiwgaW4gc2VxdWVuY2UKCQkgKiBhcyB0aGUgY29sdW1uIGlzIHJlcGVhdGVkbHkgc29ydGVkIHVwb24gLSBpLmUuIHRoZSBmaXJzdCB2YWx1ZSBpcyB1c2VkCgkJICogYXMgdGhlIHNvcnRpbmcgZGlyZWN0aW9uIHdoZW4gdGhlIGNvbHVtbiBpZiBmaXJzdCBzb3J0ZWQgKGNsaWNrZWQgb24pLgoJCSAqIFNvcnQgaXQgYWdhaW4gKGNsaWNrIGFnYWluKSBhbmQgaXQgd2lsbCBtb3ZlIG9uIHRvIHRoZSBuZXh0IGluZGV4LgoJCSAqIFJlcGVhdCB1bnRpbCBsb29wLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqLwoJCSJhc1NvcnRpbmciOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgdGhlIGNvbHVtbiBpcyBzZWFyY2hhYmxlLCBhbmQgdGh1cyBzaG91bGQgYmUgaW5jbHVkZWQKCQkgKiBpbiB0aGUgZmlsdGVyaW5nIG9yIG5vdC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiU2VhcmNoYWJsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgY29sdW1uIGlzIHNvcnRhYmxlIG9yIG5vdC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiU29ydGFibGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoZW4gdXNpbmcgZm5SZW5kZXIsIHlvdSBoYXZlIHR3byBvcHRpb25zIGZvciB3aGF0IHRvIGRvIHdpdGggdGhlIGRhdGEsCgkJICogYW5kIHRoaXMgcHJvcGVydHkgc2VydmVzIGFzIHRoZSBzd2l0Y2guIEZpcnN0bHksIHlvdSBjYW4gaGF2ZSB0aGUgc29ydGluZwoJCSAqIGFuZCBmaWx0ZXJpbmcgdXNlIHRoZSByZW5kZXJlZCB2YWx1ZSAodHJ1ZSAtIGRlZmF1bHQpLCBvciB5b3UgY2FuIGhhdmUKCQkgKiB0aGUgc29ydGluZyBhbmQgZmlsdGVyaW5nIHVzIHRoZSBvcmlnaW5hbCB2YWx1ZSAoZmFsc2UpLgoJCSAqIAoJCSAqICpOT1RFKiBJdCBpcyBpdCBpcyBhZHZpc2FibGUgbm93IHRvIHVzZSBtRGF0YSBhcyBhIGZ1bmN0aW9uIGFuZCBtYWtlIAoJCSAqIHVzZSBvZiB0aGUgJ3R5cGUnIHRoYXQgaXQgZ2l2ZXMsIGFsbG93aW5nIChwb3RlbnRpYWxseSkgZGlmZmVyZW50IGRhdGEgdG8KCQkgKiBiZSB1c2VkIGZvciBzb3J0aW5nLCBmaWx0ZXJpbmcsIGRpc3BsYXkgYW5kIHR5cGUgZGV0ZWN0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImJVc2VSZW5kZXJlZCI6IG51bGwsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgY29sdW1uIGlzIGN1cnJlbnRseSB2aXNpYmxlIGluIHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqLwoJCSJiVmlzaWJsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSB0byB0aGUgdHlwZSBkZXRlY3Rpb24gbWV0aG9kIGlmIHRoZSBhdXRvbWF0aWMgdHlwZQoJCSAqIGRldGVjdGlvbiBzaG91bGQgYmUgdXNlZCwgb3IgaWYgYSBjb2x1bW4gdHlwZSAoc1R5cGUpIGhhcyBiZWVuIHNwZWNpZmllZAoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2JBdXRvVHlwZSI6IHRydWUsCgkJCgkJLyoqCgkJICogRGV2ZWxvcGVyIGRlZmluYWJsZSBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuZXZlciBhIGNlbGwgaXMgY3JlYXRlZCAoQWpheCBzb3VyY2UsCgkJICogZXRjKSBvciBwcm9jZXNzZWQgZm9yIGlucHV0IChET00gc291cmNlKS4gVGhpcyBjYW4gYmUgdXNlZCBhcyBhIGNvbXBsaW1lbnQgdG8gZm5SZW5kZXIKCQkgKiBhbGxvd2luZyB5b3UgdG8gbW9kaWZ5IHRoZSBET00gZWxlbWVudCAoYWRkIGJhY2tncm91bmQgY29sb3VyIGZvciBleGFtcGxlKSB3aGVuIHRoZQoJCSAqIGVsZW1lbnQgaXMgYXZhaWxhYmxlIChzaW5jZSBpdCBpcyBub3Qgd2hlbiBmblJlbmRlciBpcyBjYWxsZWQpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge2VsZW1lbnR9IG5UZCBUaGUgVEQgbm9kZSB0aGF0IGhhcyBiZWVuIGNyZWF0ZWQKCQkgKiAgQHBhcmFtIHsqfSBzRGF0YSBUaGUgRGF0YSBmb3IgdGhlIGNlbGwKCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGZvciB0aGUgd2hvbGUgcm93CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFRoZSByb3cgaW5kZXggZm9yIHRoZSBhb0RhdGEgZGF0YSBzdG9yZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuQ3JlYXRlZENlbGwiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIGdldCBkYXRhIGZyb20gYSBjZWxsIGluIGEgY29sdW1uLiBZb3Ugc2hvdWxkIDxiPm5ldmVyPC9iPgoJCSAqIGFjY2VzcyBkYXRhIGRpcmVjdGx5IHRocm91Z2ggX2FEYXRhIGludGVybmFsbHkgaW4gRGF0YVRhYmxlcyAtIGFsd2F5cyB1c2UKCQkgKiB0aGUgbWV0aG9kIGF0dGFjaGVkIHRvIHRoaXMgcHJvcGVydHkuIEl0IGFsbG93cyBtRGF0YSB0byBmdW5jdGlvbiBhcwoJCSAqIHJlcXVpcmVkLiBUaGlzIGZ1bmN0aW9uIGlzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgYnkgdGhlIGNvbHVtbiAKCQkgKiBpbml0aWFsaXNhdGlvbiBtZXRob2QKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGFycmF5L29iamVjdCBmb3IgdGhlIGFycmF5IAoJCSAqICAgIChpLmUuIGFvRGF0YVtdLl9hRGF0YSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBUaGUgc3BlY2lmaWMgZGF0YSB0eXBlIHlvdSB3YW50IHRvIGdldCAtIAoJCSAqICAgICdkaXNwbGF5JywgJ3R5cGUnICdmaWx0ZXInICdzb3J0JwoJCSAqICBAcmV0dXJucyB7Kn0gVGhlIGRhdGEgZm9yIHRoZSBjZWxsIGZyb20gdGhlIGdpdmVuIHJvdydzIGRhdGEKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkdldERhdGEiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCAKCQkgKiBpbiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8gT2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YVJvdyBUaGUgcm93IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YUNvbHVtbiBUaGUgY29sdW1uIGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl9ICBvLmFEYXRhIFRoZSBkYXRhIGZvciB0aGUgcm93IGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvLm9TZXR0aW5ncyBUaGUgc2V0dGluZ3Mgb2JqZWN0IGZvciB0aGlzIERhdGFUYWJsZXMgaW5zdGFuY2UKCQkgKiAgQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyB5b3Ugd2hpY2ggdG8gdXNlIGluIHRoZSBkaXNwbGF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5SZW5kZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIHNldCBkYXRhIGZvciBhIGNlbGwgaW4gdGhlIGNvbHVtbi4gWW91IHNob3VsZCA8Yj5uZXZlcjwvYj4gCgkJICogc2V0IHRoZSBkYXRhIGRpcmVjdGx5IHRvIF9hRGF0YSBpbnRlcm5hbGx5IGluIERhdGFUYWJsZXMgLSBhbHdheXMgdXNlCgkJICogdGhpcyBtZXRob2QuIEl0IGFsbG93cyBtRGF0YSB0byBmdW5jdGlvbiBhcyByZXF1aXJlZC4gVGhpcyBmdW5jdGlvbgoJCSAqIGlzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgYnkgdGhlIGNvbHVtbiBpbml0aWFsaXNhdGlvbiBtZXRob2QKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGFycmF5L29iamVjdCBmb3IgdGhlIGFycmF5IAoJCSAqICAgIChpLmUuIGFvRGF0YVtdLl9hRGF0YSkKCQkgKiAgQHBhcmFtIHsqfSBzVmFsdWUgVmFsdWUgdG8gc2V0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5TZXREYXRhIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQcm9wZXJ0eSB0byByZWFkIHRoZSB2YWx1ZSBmb3IgdGhlIGNlbGxzIGluIHRoZSBjb2x1bW4gZnJvbSB0aGUgZGF0YSAKCQkgKiBzb3VyY2UgYXJyYXkgLyBvYmplY3QuIElmIG51bGwsIHRoZW4gdGhlIGRlZmF1bHQgY29udGVudCBpcyB1c2VkLCBpZiBhCgkJICogZnVuY3Rpb24gaXMgZ2l2ZW4gdGhlbiB0aGUgcmV0dXJuIGZyb20gdGhlIGZ1bmN0aW9uIGlzIHVzZWQuCgkJICogIEB0eXBlIGZ1bmN0aW9ufGludHxzdHJpbmd8bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm1EYXRhIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQYXJ0bmVyIHByb3BlcnR5IHRvIG1EYXRhIHdoaWNoIGlzIHVzZWQgKG9ubHkgd2hlbiBkZWZpbmVkKSB0byBnZXQKCQkgKiB0aGUgZGF0YSAtIGkuZS4gaXQgaXMgYmFzaWNhbGx5IHRoZSBzYW1lIGFzIG1EYXRhLCBidXQgd2l0aG91dCB0aGUKCQkgKiAnc2V0JyBvcHRpb24sIGFuZCBhbHNvIHRoZSBkYXRhIGZlZCB0byBpdCBpcyB0aGUgcmVzdWx0IGZyb20gbURhdGEuCgkJICogVGhpcyBpcyB0aGUgcmVuZGVyaW5nIG1ldGhvZCB0byBtYXRjaCB0aGUgZGF0YSBtZXRob2Qgb2YgbURhdGEuCgkJICogIEB0eXBlIGZ1bmN0aW9ufGludHxzdHJpbmd8bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm1SZW5kZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBoZWFkZXIgVEgvVEQgZWxlbWVudCBmb3IgdGhpcyBjb2x1bW4gLSB0aGlzIGlzIHdoYXQgdGhlIHNvcnRpbmcKCQkgKiBsaXN0ZW5lciBpcyBhdHRhY2hlZCB0byAoaWYgc29ydGluZyBpcyBlbmFibGVkLikKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UaCI6IG51bGwsCgkJCgkJLyoqCgkJICogVW5pcXVlIGZvb3RlciBUSC9URCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbiAoaWYgdGhlcmUgaXMgb25lKS4gTm90IHVzZWQgCgkJICogaW4gRGF0YVRhYmxlcyBhcyBzdWNoLCBidXQgY2FuIGJlIHVzZWQgZm9yIHBsdWctaW5zIHRvIHJlZmVyZW5jZSB0aGUgCgkJICogZm9vdGVyIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UZiI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzIHRvIGFwcGx5IHRvIGFsbCBURCBlbGVtZW50cyBpbiB0aGUgdGFibGUncyBUQk9EWSBmb3IgdGhlIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzQ2xhc3MiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoZW4gRGF0YVRhYmxlcyBjYWxjdWxhdGVzIHRoZSBjb2x1bW4gd2lkdGhzIHRvIGFzc2lnbiB0byBlYWNoIGNvbHVtbiwKCQkgKiBpdCBmaW5kcyB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gZWFjaCBjb2x1bW4gYW5kIHRoZW4gY29uc3RydWN0cyBhCgkJICogdGVtcG9yYXJ5IHRhYmxlIGFuZCByZWFkcyB0aGUgd2lkdGhzIGZyb20gdGhhdC4gVGhlIHByb2JsZW0gd2l0aCB0aGlzCgkJICogaXMgdGhhdCAibW1tIiBpcyBtdWNoIHdpZGVyIHRoZW4gImlpaWkiLCBidXQgdGhlIGxhdHRlciBpcyBhIGxvbmdlciAKCQkgKiBzdHJpbmcgLSB0aHVzIHRoZSBjYWxjdWxhdGlvbiBjYW4gZ28gd3JvbmcgKGRvaW5nIGl0IHByb3Blcmx5IGFuZCBwdXR0aW5nCgkJICogaXQgaW50byBhbiBET00gb2JqZWN0IGFuZCBtZWFzdXJpbmcgdGhhdCBpcyBob3JyaWJseSghKSBzbG93KS4gVGh1cyBhcwoJCSAqIGEgIndvcmsgYXJvdW5kIiB3ZSBwcm92aWRlIHRoaXMgb3B0aW9uLiBJdCB3aWxsIGFwcGVuZCBpdHMgdmFsdWUgdG8gdGhlCgkJICogdGV4dCB0aGF0IGlzIGZvdW5kIHRvIGJlIHRoZSBsb25nZXN0IHN0cmluZyBmb3IgdGhlIGNvbHVtbiAtIGkuZS4gcGFkZGluZy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNDb250ZW50UGFkZGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogQWxsb3dzIGEgZGVmYXVsdCB2YWx1ZSB0byBiZSBnaXZlbiBmb3IgYSBjb2x1bW4ncyBkYXRhLCBhbmQgd2lsbCBiZSB1c2VkCgkJICogd2hlbmV2ZXIgYSBudWxsIGRhdGEgc291cmNlIGlzIGVuY291bnRlcmVkICh0aGlzIGNhbiBiZSBiZWNhdXNlIG1EYXRhCgkJICogaXMgc2V0IHRvIG51bGwsIG9yIGJlY2F1c2UgdGhlIGRhdGEgc291cmNlIGl0c2VsZiBpcyBudWxsKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0RlZmF1bHRDb250ZW50IjogbnVsbCwKCQkKCQkvKioKCQkgKiBOYW1lIGZvciB0aGUgY29sdW1uLCBhbGxvd2luZyByZWZlcmVuY2UgdG8gdGhlIGNvbHVtbiBieSBuYW1lIGFzIHdlbGwgYXMKCQkgKiBieSBpbmRleCAobmVlZHMgYSBsb29rdXAgdG8gd29yayBieSBuYW1lKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNOYW1lIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDdXN0b20gc29ydGluZyBkYXRhIHR5cGUgLSBkZWZpbmVzIHdoaWNoIG9mIHRoZSBhdmFpbGFibGUgcGx1Zy1pbnMgaW4KCQkgKiBhZm5Tb3J0RGF0YSB0aGUgY3VzdG9tIHNvcnRpbmcgd2lsbCB1c2UgLSBpZiBhbnkgaXMgZGVmaW5lZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IHN0ZAoJCSAqLwoJCSJzU29ydERhdGFUeXBlIjogJ3N0ZCcsCgkJCgkJLyoqCgkJICogQ2xhc3MgdG8gYmUgYXBwbGllZCB0byB0aGUgaGVhZGVyIGVsZW1lbnQgd2hlbiBzb3J0aW5nIG9uIHRoaXMgY29sdW1uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNTb3J0aW5nQ2xhc3MiOiBudWxsLAoJCQoJCS8qKgoJCSAqIENsYXNzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGhlYWRlciBlbGVtZW50IHdoZW4gc29ydGluZyBvbiB0aGlzIGNvbHVtbiAtCgkJICogd2hlbiBqUXVlcnkgVUkgdGhlbWluZyBpcyB1c2VkLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzU29ydGluZ0NsYXNzSlVJIjogbnVsbCwKCQkKCQkvKioKCQkgKiBUaXRsZSBvZiB0aGUgY29sdW1uIC0gd2hhdCBpcyBzZWVuIGluIHRoZSBUSCBlbGVtZW50IChuVGgpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKi8KCQkic1RpdGxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDb2x1bW4gc29ydGluZyBhbmQgZmlsdGVyaW5nIHR5cGUKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1R5cGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdpZHRoIG9mIHRoZSBjb2x1bW4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1dpZHRoIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaWR0aCBvZiB0aGUgY29sdW1uIHdoZW4gaXQgd2FzIGZpcnN0ICJlbmNvdW50ZXJlZCIKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1dpZHRoT3JpZyI6IG51bGwKCX07CgkKCQoJCgkvKioKCSAqIEluaXRpYWxpc2F0aW9uIG9wdGlvbnMgdGhhdCBjYW4gYmUgZ2l2ZW4gdG8gRGF0YVRhYmxlcyBhdCBpbml0aWFsaXNhdGlvbiAKCSAqIHRpbWUuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUuZGVmYXVsdHMgPSB7CgkJLyoqCgkJICogQW4gYXJyYXkgb2YgZGF0YSB0byB1c2UgZm9yIHRoZSB0YWJsZSwgcGFzc2VkIGluIGF0IGluaXRpYWxpc2F0aW9uIHdoaWNoIAoJCSAqIHdpbGwgYmUgdXNlZCBpbiBwcmVmZXJlbmNlIHRvIGFueSBkYXRhIHdoaWNoIGlzIGFscmVhZHkgaW4gdGhlIERPTS4gVGhpcyBpcwoJCSAqIHBhcnRpY3VsYXJseSB1c2VmdWwgZm9yIGNvbnN0cnVjdGluZyB0YWJsZXMgcHVyZWx5IGluIEphdmFzY3JpcHQsIGZvcgoJCSAqIGV4YW1wbGUgd2l0aCBhIGN1c3RvbSBBamF4IGNhbGwuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGEgMkQgYXJyYXkgZGF0YSBzb3VyY2UKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFhRGF0YSI6IFsKCQkgKiAgICAgICAgICBbJ1RyaWRlbnQnLCAnSW50ZXJuZXQgRXhwbG9yZXIgNC4wJywgJ1dpbiA5NSsnLCA0LCAnWCddLAoJCSAqICAgICAgICAgIFsnVHJpZGVudCcsICdJbnRlcm5ldCBFeHBsb3JlciA1LjAnLCAnV2luIDk1KycsIDUsICdDJ10sCgkJICogICAgICAgIF0sCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiQnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiUGxhdGZvcm0iIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlZlcnNpb24iIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW4gYXJyYXkgb2Ygb2JqZWN0cyBhcyBhIGRhdGEgc291cmNlIChtRGF0YSkKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFhRGF0YSI6IFsKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAiZW5naW5lIjogICAiVHJpZGVudCIsCgkJICogICAgICAgICAgICAiYnJvd3NlciI6ICAiSW50ZXJuZXQgRXhwbG9yZXIgNC4wIiwKCQkgKiAgICAgICAgICAgICJwbGF0Zm9ybSI6ICJXaW4gOTUrIiwKCQkgKiAgICAgICAgICAgICJ2ZXJzaW9uIjogIDQsCgkJICogICAgICAgICAgICAiZ3JhZGUiOiAgICAiWCIKCQkgKiAgICAgICAgICB9LAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJlbmdpbmUiOiAgICJUcmlkZW50IiwKCQkgKiAgICAgICAgICAgICJicm93c2VyIjogICJJbnRlcm5ldCBFeHBsb3JlciA1LjAiLAoJCSAqICAgICAgICAgICAgInBsYXRmb3JtIjogIldpbiA5NSsiLAoJCSAqICAgICAgICAgICAgInZlcnNpb24iOiAgNSwKCQkgKiAgICAgICAgICAgICJncmFkZSI6ICAgICJDIgoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXSwKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiRW5naW5lIiwgICAibURhdGEiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJCcm93c2VyIiwgICJtRGF0YSI6ICJicm93c2VyIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJQbGF0Zm9ybSIsICJtRGF0YSI6ICJwbGF0Zm9ybSIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiVmVyc2lvbiIsICAibURhdGEiOiAidmVyc2lvbiIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiR3JhZGUiLCAgICAibURhdGEiOiAiZ3JhZGUiIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYWFEYXRhIjogbnVsbCwKCQoJCgkJLyoqCgkJICogSWYgc29ydGluZyBpcyBlbmFibGVkLCB0aGVuIERhdGFUYWJsZXMgd2lsbCBwZXJmb3JtIGEgZmlyc3QgcGFzcyBzb3J0IG9uIAoJCSAqIGluaXRpYWxpc2F0aW9uLiBZb3UgY2FuIGRlZmluZSB3aGljaCBjb2x1bW4ocykgdGhlIHNvcnQgaXMgcGVyZm9ybWVkIHVwb24sIAoJCSAqIGFuZCB0aGUgc29ydGluZyBkaXJlY3Rpb24sIHdpdGggdGhpcyB2YXJpYWJsZS4gVGhlIGFhU29ydGluZyBhcnJheSBzaG91bGQgCgkJICogY29udGFpbiBhbiBhcnJheSBmb3IgZWFjaCBjb2x1bW4gdG8gYmUgc29ydGVkIGluaXRpYWxseSBjb250YWluaW5nIHRoZSAKCQkgKiBjb2x1bW4ncyBpbmRleCBhbmQgYSBkaXJlY3Rpb24gc3RyaW5nICgnYXNjJyBvciAnZGVzYycpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbWzAsJ2FzYyddXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gU29ydCBieSAzcmQgY29sdW1uIGZpcnN0LCBhbmQgdGhlbiA0dGggY29sdW1uCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFhU29ydGluZyI6IFtbMiwnYXNjJ10sIFszLCdkZXNjJ11dCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIC8vIE5vIGluaXRpYWwgc29ydGluZwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmciOiBbXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYWFTb3J0aW5nIjogW1swLCdhc2MnXV0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGlzIGJhc2ljYWxseSBpZGVudGljYWwgdG8gdGhlIGFhU29ydGluZyBwYXJhbWV0ZXIsIGJ1dCAKCQkgKiBjYW5ub3QgYmUgb3ZlcnJpZGRlbiBieSB1c2VyIGludGVyYWN0aW9uIHdpdGggdGhlIHRhYmxlLiBXaGF0IHRoaXMgbWVhbnMgCgkJICogaXMgdGhhdCB5b3UgY291bGQgaGF2ZSBhIGNvbHVtbiAodmlzaWJsZSBvciBoaWRkZW4pIHdoaWNoIHRoZSBzb3J0aW5nIHdpbGwgCgkJICogYWx3YXlzIGJlIGZvcmNlZCBvbiBmaXJzdCAtIGFueSBzb3J0aW5nIGFmdGVyIHRoYXQgKGZyb20gdGhlIHVzZXIpIHdpbGwgCgkJICogdGhlbiBiZSBwZXJmb3JtZWQgYXMgcmVxdWlyZWQuIFRoaXMgY2FuIGJlIHVzZWZ1bCBmb3IgZ3JvdXBpbmcgcm93cyAKCQkgKiB0b2dldGhlci4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFhU29ydGluZ0ZpeGVkIjogW1swLCdhc2MnXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiYWFTb3J0aW5nRml4ZWQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBhbGxvd3MgeW91IHRvIHJlYWRpbHkgc3BlY2lmeSB0aGUgZW50cmllcyBpbiB0aGUgbGVuZ3RoIGRyb3AKCQkgKiBkb3duIG1lbnUgdGhhdCBEYXRhVGFibGVzIHNob3dzIHdoZW4gcGFnaW5hdGlvbiBpcyBlbmFibGVkLiBJdCBjYW4gYmUgCgkJICogZWl0aGVyIGEgMUQgYXJyYXkgb2Ygb3B0aW9ucyB3aGljaCB3aWxsIGJlIHVzZWQgZm9yIGJvdGggdGhlIGRpc3BsYXllZCAKCQkgKiBvcHRpb24gYW5kIHRoZSB2YWx1ZSwgb3IgYSAyRCBhcnJheSB3aGljaCB3aWxsIHVzZSB0aGUgYXJyYXkgaW4gdGhlIGZpcnN0IAoJCSAqIHBvc2l0aW9uIGFzIHRoZSB2YWx1ZSwgYW5kIHRoZSBhcnJheSBpbiB0aGUgc2Vjb25kIHBvc2l0aW9uIGFzIHRoZSAKCQkgKiBkaXNwbGF5ZWQgb3B0aW9ucyAodXNlZnVsIGZvciBsYW5ndWFnZSBzdHJpbmdzIHN1Y2ggYXMgJ0FsbCcpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbIDEwLCAyNSwgNTAsIDEwMCBdCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzEwLCAyNSwgNTAsIC0xXSwgWzEwLCAyNSwgNTAsICJBbGwiXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNldHRpbmcgdGhlIGRlZmF1bHQgZGlzcGxheSBsZW5ndGggYXMgd2VsbCBhcyBsZW5ndGggbWVudQoJCSAqICAgIC8vIFRoaXMgaXMgbGlrZWx5IHRvIGJlIHdhbnRlZCBpZiB5b3UgcmVtb3ZlIHRoZSAnMTAnIG9wdGlvbiB3aGljaAoJCSAqICAgIC8vIGlzIHRoZSBpRGlzcGxheUxlbmd0aCBkZWZhdWx0LgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDI1LAoJCSAqICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzI1LCA1MCwgMTAwLCAtMV0sIFsyNSwgNTAsIDEwMCwgIkFsbCJdXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYUxlbmd0aE1lbnUiOiBbIDEwLCAyNSwgNTAsIDEwMCBdLAoJCgkKCQkvKioKCQkgKiBUaGUgYW9Db2x1bW5zIG9wdGlvbiBpbiB0aGUgaW5pdGlhbGlzYXRpb24gcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gZGVmaW5lCgkJICogZGV0YWlscyBhYm91dCB0aGUgd2F5IGluZGl2aWR1YWwgY29sdW1ucyBiZWhhdmUuIEZvciBhIGZ1bGwgbGlzdCBvZgoJCSAqIGNvbHVtbiBvcHRpb25zIHRoYXQgY2FuIGJlIHNldCwgcGxlYXNlIHNlZSAKCQkgKiB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnN9LiBOb3RlIHRoYXQgaWYgeW91IHVzZSBhb0NvbHVtbnMgdG8KCQkgKiBkZWZpbmUgeW91ciBjb2x1bW5zLCB5b3UgbXVzdCBoYXZlIGFuIGVudHJ5IGluIHRoZSBhcnJheSBmb3IgZXZlcnkgc2luZ2xlCgkJICogY29sdW1uIHRoYXQgeW91IGhhdmUgaW4geW91ciB0YWJsZSAodGhlc2UgY2FuIGJlIG51bGwgaWYgeW91IGRvbid0IHdoaWNoCgkJICogdG8gc3BlY2lmeSBhbnkgb3B0aW9ucykuCgkJICogIEBtZW1iZXIKCQkgKi8KCQkiYW9Db2x1bW5zIjogbnVsbCwKCQoJCS8qKgoJCSAqIFZlcnkgc2ltaWxhciB0byBhb0NvbHVtbnMsIGFvQ29sdW1uRGVmcyBhbGxvd3MgeW91IHRvIHRhcmdldCBhIHNwZWNpZmljIAoJCSAqIGNvbHVtbiwgbXVsdGlwbGUgY29sdW1ucywgb3IgYWxsIGNvbHVtbnMsIHVzaW5nIHRoZSBhVGFyZ2V0cyBwcm9wZXJ0eSBvZiAKCQkgKiBlYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkuIFRoaXMgYWxsb3dzIGdyZWF0IGZsZXhpYmlsaXR5IHdoZW4gY3JlYXRpbmcgCgkJICogdGFibGVzLCBhcyB0aGUgYW9Db2x1bW5EZWZzIGFycmF5cyBjYW4gYmUgb2YgYW55IGxlbmd0aCwgdGFyZ2V0aW5nIHRoZSAKCQkgKiBjb2x1bW5zIHlvdSBzcGVjaWZpY2FsbHkgd2FudC4gYW9Db2x1bW5EZWZzIG1heSB1c2UgYW55IG9mIHRoZSBjb2x1bW4gCgkJICogb3B0aW9ucyBhdmFpbGFibGU6IHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uc30sIGJ1dCBpdCBfbXVzdF8KCQkgKiBoYXZlIGFUYXJnZXRzIGRlZmluZWQgaW4gZWFjaCBvYmplY3QgaW4gdGhlIGFycmF5LiBWYWx1ZXMgaW4gdGhlIGFUYXJnZXRzCgkJICogYXJyYXkgbWF5IGJlOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+YSBzdHJpbmcgLSBjbGFzcyBuYW1lIHdpbGwgYmUgbWF0Y2hlZCBvbiB0aGUgVEggZm9yIHRoZSBjb2x1bW48L2xpPgoJCSAqICAgICA8bGk+MCBvciBhIHBvc2l0aXZlIGludGVnZXIgLSBjb2x1bW4gaW5kZXggY291bnRpbmcgZnJvbSB0aGUgbGVmdDwvbGk+CgkJICogICAgIDxsaT5hIG5lZ2F0aXZlIGludGVnZXIgLSBjb2x1bW4gaW5kZXggY291bnRpbmcgZnJvbSB0aGUgcmlnaHQ8L2xpPgoJCSAqICAgICA8bGk+dGhlIHN0cmluZyAiX2FsbCIgLSBhbGwgY29sdW1ucyAoaS5lLiBhc3NpZ24gYSBkZWZhdWx0KTwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAbWVtYmVyCgkJICovCgkJImFvQ29sdW1uRGVmcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEJhc2ljYWxseSB0aGUgc2FtZSBhcyBvU2VhcmNoLCB0aGlzIHBhcmFtZXRlciBkZWZpbmVzIHRoZSBpbmRpdmlkdWFsIGNvbHVtbgoJCSAqIGZpbHRlcmluZyBzdGF0ZSBhdCBpbml0aWFsaXNhdGlvbiB0aW1lLiBUaGUgYXJyYXkgbXVzdCBiZSBvZiB0aGUgc2FtZSBzaXplIAoJCSAqIGFzIHRoZSBudW1iZXIgb2YgY29sdW1ucywgYW5kIGVhY2ggZWxlbWVudCBiZSBhbiBvYmplY3Qgd2l0aCB0aGUgcGFyYW1ldGVycwoJCSAqICJzU2VhcmNoIiBhbmQgImJFc2NhcGVSZWdleCIgKHRoZSBsYXR0ZXIgaXMgb3B0aW9uYWwpLiAnbnVsbCcgaXMgYWxzbwoJCSAqIGFjY2VwdGVkIGFuZCB0aGUgZGVmYXVsdCB3aWxsIGJlIHVzZWQuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9TZWFyY2hDb2xzIjogWwoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgeyAic1NlYXJjaCI6ICJNeSBmaWx0ZXIiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJzU2VhcmNoIjogIl5bMC05XSIsICJiRXNjYXBlUmVnZXgiOiBmYWxzZSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiYW9TZWFyY2hDb2xzIjogW10sCgkKCQoJCS8qKgoJCSAqIEFuIGFycmF5IG9mIENTUyBjbGFzc2VzIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gZGlzcGxheWVkIHJvd3MuIFRoaXMgCgkJICogYXJyYXkgbWF5IGJlIG9mIGFueSBsZW5ndGgsIGFuZCBEYXRhVGFibGVzIHdpbGwgYXBwbHkgZWFjaCBjbGFzcyAKCQkgKiBzZXF1ZW50aWFsbHksIGxvb3Bpbmcgd2hlbiByZXF1aXJlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5XaWxsIHRha2UgdGhlIHZhbHVlcyBkZXRlcm1pbmVkIGJ5IHRoZSBvQ2xhc3Nlcy5zU3RyaXBlKgoJCSAqICAgIG9wdGlvbnM8L2k+CgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYXNTdHJpcGVDbGFzc2VzIjogWyAnc3RyaXAxJywgJ3N0cmlwMicsICdzdHJpcDMnIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiYXNTdHJpcGVDbGFzc2VzIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgYXV0b21hdGljIGNvbHVtbiB3aWR0aCBjYWxjdWxhdGlvbi4gVGhpcyBjYW4gYmUgZGlzYWJsZWQKCQkgKiBhcyBhbiBvcHRpbWlzYXRpb24gKGl0IHRha2VzIHNvbWUgdGltZSB0byBjYWxjdWxhdGUgdGhlIHdpZHRocykgaWYgdGhlCgkJICogdGFibGVzIHdpZHRocyBhcmUgcGFzc2VkIGluIHVzaW5nIGFvQ29sdW1ucy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkF1dG9XaWR0aCI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiQXV0b1dpZHRoIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRGVmZXJyZWQgcmVuZGVyaW5nIGNhbiBwcm92aWRlIERhdGFUYWJsZXMgd2l0aCBhIGh1Z2Ugc3BlZWQgYm9vc3Qgd2hlbiB5b3UKCQkgKiBhcmUgdXNpbmcgYW4gQWpheCBvciBKUyBkYXRhIHNvdXJjZSBmb3IgdGhlIHRhYmxlLiBUaGlzIG9wdGlvbiwgd2hlbiBzZXQgdG8KCQkgKiB0cnVlLCB3aWxsIGNhdXNlIERhdGFUYWJsZXMgdG8gZGVmZXIgdGhlIGNyZWF0aW9uIG9mIHRoZSB0YWJsZSBlbGVtZW50cyBmb3IKCQkgKiBlYWNoIHJvdyB1bnRpbCB0aGV5IGFyZSBuZWVkZWQgZm9yIGEgZHJhdyAtIHNhdmluZyBhIHNpZ25pZmljYW50IGFtb3VudCBvZgoJCSAqIHRpbWUuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2FycmF5cy50eHQiLAoJCSAqICAgICAgICAiYkRlZmVyUmVuZGVyIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkRlZmVyUmVuZGVyIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIFJlcGxhY2UgYSBEYXRhVGFibGUgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gc2VsZWN0b3IgYW5kIHJlcGxhY2UgaXQgd2l0aCAKCQkgKiBvbmUgd2hpY2ggaGFzIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBuZXcgaW5pdGlhbGlzYXRpb24gb2JqZWN0IHBhc3NlZC4gSWYgbm8KCQkgKiB0YWJsZSBtYXRjaGVzIHRoZSBzZWxlY3RvciwgdGhlbiB0aGUgbmV3IERhdGFUYWJsZSB3aWxsIGJlIGNvbnN0cnVjdGVkIGFzCgkJICogcGVyIG5vcm1hbC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb21lIHRpbWUgbGF0ZXIuLi4uCgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkZpbHRlciI6IGZhbHNlLAoJCSAqICAgICAgICAiYkRlc3Ryb3kiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRGVzdHJveSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBmaWx0ZXJpbmcgb2YgZGF0YS4gRmlsdGVyaW5nIGluIERhdGFUYWJsZXMgaXMgInNtYXJ0IiBpbgoJCSAqIHRoYXQgaXQgYWxsb3dzIHRoZSBlbmQgdXNlciB0byBpbnB1dCBtdWx0aXBsZSB3b3JkcyAoc3BhY2Ugc2VwYXJhdGVkKSBhbmQKCQkgKiB3aWxsIG1hdGNoIGEgcm93IGNvbnRhaW5pbmcgdGhvc2Ugd29yZHMsIGV2ZW4gaWYgbm90IGluIHRoZSBvcmRlciB0aGF0IHdhcwoJCSAqIHNwZWNpZmllZCAodGhpcyBhbGxvdyBtYXRjaGluZyBhY3Jvc3MgbXVsdGlwbGUgY29sdW1ucykuIE5vdGUgdGhhdCBpZiB5b3UKCQkgKiB3aXNoIHRvIHVzZSBmaWx0ZXJpbmcgaW4gRGF0YVRhYmxlcyB0aGlzIG11c3QgcmVtYWluICd0cnVlJyAtIHRvIHJlbW92ZSB0aGUKCQkgKiBkZWZhdWx0IGZpbHRlcmluZyBpbnB1dCBib3ggYW5kIHJldGFpbiBmaWx0ZXJpbmcgYWJpbGl0aWVzLCBwbGVhc2UgdXNlCgkJICoge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5zRG9tfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkZpbHRlciI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRmlsdGVyIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIHRhYmxlIGluZm9ybWF0aW9uIGRpc3BsYXkuIFRoaXMgc2hvd3MgaW5mb3JtYXRpb24gCgkJICogYWJvdXQgdGhlIGRhdGEgdGhhdCBpcyBjdXJyZW50bHkgdmlzaWJsZSBvbiB0aGUgcGFnZSwgaW5jbHVkaW5nIGluZm9ybWF0aW9uCgkJICogYWJvdXQgZmlsdGVyZWQgZGF0YSBpZiB0aGF0IGFjdGlvbiBpcyBiZWluZyBwZXJmb3JtZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJJbmZvIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJJbmZvIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGpRdWVyeSBVSSBUaGVtZVJvbGxlciBzdXBwb3J0IChyZXF1aXJlZCBhcyBUaGVtZVJvbGxlciByZXF1aXJlcyBzb21lCgkJICogc2xpZ2h0bHkgZGlmZmVyZW50IGFuZCBhZGRpdGlvbmFsIG1hcmstdXAgZnJvbSB3aGF0IERhdGFUYWJsZXMgaGFzCgkJICogdHJhZGl0aW9uYWxseSB1c2VkKS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkpRdWVyeVVJIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkpRdWVyeVVJIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEFsbG93cyB0aGUgZW5kIHVzZXIgdG8gc2VsZWN0IHRoZSBzaXplIG9mIGEgZm9ybWF0dGVkIHBhZ2UgZnJvbSBhIHNlbGVjdAoJCSAqIG1lbnUgKHNpemVzIGFyZSAxMCwgMjUsIDUwIGFuZCAxMDApLiBSZXF1aXJlcyBwYWdpbmF0aW9uIChiUGFnaW5hdGUpLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBwYWdpbmF0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlBhZ2luYXRlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgYSAncHJvY2Vzc2luZycgaW5kaWNhdG9yIHdoZW4gdGhlIHRhYmxlIGlzCgkJICogYmVpbmcgcHJvY2Vzc2VkIChlLmcuIGEgc29ydCkuIFRoaXMgaXMgcGFydGljdWxhcmx5IHVzZWZ1bCBmb3IgdGFibGVzIHdpdGgKCQkgKiBsYXJnZSBhbW91bnRzIG9mIGRhdGEgd2hlcmUgaXQgY2FuIHRha2UgYSBub3RpY2VhYmxlIGFtb3VudCBvZiB0aW1lIHRvIHNvcnQKCQkgKiB0aGUgZW50cmllcy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlByb2Nlc3NpbmciOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogUmV0cmlldmUgdGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gc2VsZWN0b3IuIE5vdGUgdGhhdCBpZiB0aGUKCQkgKiB0YWJsZSBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYWxpc2VkLCB0aGlzIHBhcmFtZXRlciB3aWxsIGNhdXNlIERhdGFUYWJsZXMKCQkgKiB0byBzaW1wbHkgcmV0dXJuIHRoZSBvYmplY3QgdGhhdCBoYXMgYWxyZWFkeSBiZWVuIHNldCB1cCAtIGl0IHdpbGwgbm90IHRha2UKCQkgKiBhY2NvdW50IG9mIGFueSBjaGFuZ2VzIHlvdSBtaWdodCBoYXZlIG1hZGUgdG8gdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdAoJCSAqIHBhc3NlZCB0byBEYXRhVGFibGVzIChzZXR0aW5nIHRoaXMgcGFyYW1ldGVyIHRvIHRydWUgaXMgYW4gYWNrbm93bGVkZ2VtZW50CgkJICogdGhhdCB5b3UgdW5kZXJzdGFuZCB0aGlzKS4gYkRlc3Ryb3kgY2FuIGJlIHVzZWQgdG8gcmVpbml0aWFsaXNlIGEgdGFibGUgaWYKCQkgKiB5b3UgbmVlZC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIGluaXRUYWJsZSgpOwoJCSAqICAgICAgdGFibGVBY3Rpb25zKCk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIGluaXRUYWJsZSAoKQoJCSAqICAgIHsKCQkgKiAgICAgIHJldHVybiAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UsCgkJICogICAgICAgICJiUmV0cmlldmUiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfQoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIHRhYmxlQWN0aW9ucyAoKQoJCSAqICAgIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSBpbml0VGFibGUoKTsKCQkgKiAgICAgIC8vIHBlcmZvcm0gQVBJIG9wZXJhdGlvbnMgd2l0aCBvVGFibGUgCgkJICogICAgfQoJCSAqLwoJCSJiUmV0cmlldmUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgRGF0YVRhYmxlcyBzaG91bGQgYmUgYWxsb3dlZCB0byBzZXQgdGhlIHBhZGRpbmcgLyBtYXJnaW4KCQkgKiBldGMgZm9yIHRoZSBzY3JvbGxpbmcgaGVhZGVyIGVsZW1lbnRzIG9yIG5vdC4gVHlwaWNhbGx5IHlvdSB3aWxsIHdhbnQKCQkgKiB0aGlzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNjcm9sbEF1dG9Dc3MiOiBmYWxzZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNjcm9sbEF1dG9Dc3MiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBXaGVuIHZlcnRpY2FsICh5KSBzY3JvbGxpbmcgaXMgZW5hYmxlZCwgRGF0YVRhYmxlcyB3aWxsIGZvcmNlIHRoZSBoZWlnaHQgb2YKCQkgKiB0aGUgdGFibGUncyB2aWV3cG9ydCB0byB0aGUgZ2l2ZW4gaGVpZ2h0IGF0IGFsbCB0aW1lcyAodXNlZnVsIGZvciBsYXlvdXQpLgoJCSAqIEhvd2V2ZXIsIHRoaXMgY2FuIGxvb2sgb2RkIHdoZW4gZmlsdGVyaW5nIGRhdGEgZG93biB0byBhIHNtYWxsIGRhdGEgc2V0LAoJCSAqIGFuZCB0aGUgZm9vdGVyIGlzIGxlZnQgImZsb2F0aW5nIiBmdXJ0aGVyIGRvd24uIFRoaXMgcGFyYW1ldGVyICh3aGVuCgkJICogZW5hYmxlZCkgd2lsbCBjYXVzZSBEYXRhVGFibGVzIHRvIGNvbGxhcHNlIHRoZSB0YWJsZSdzIHZpZXdwb3J0IGRvd24gd2hlbgoJCSAqIHRoZSByZXN1bHQgc2V0IHdpbGwgZml0IHdpdGhpbiB0aGUgZ2l2ZW4gWSBoZWlnaHQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwIiwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxDb2xsYXBzZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgaW5maW5pdGUgc2Nyb2xsaW5nIGZvciBEYXRhVGFibGVzICh0byBiZSB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGgKCQkgKiBzU2Nyb2xsWSkuIEluZmluaXRlIHNjcm9sbGluZyBtZWFucyB0aGF0IERhdGFUYWJsZXMgd2lsbCBjb250aW51YWxseSBsb2FkCgkJICogZGF0YSBhcyBhIHVzZXIgc2Nyb2xscyB0aHJvdWdoIGEgdGFibGUsIHdoaWNoIGlzIHZlcnkgdXNlZnVsIGZvciBsYXJnZQoJCSAqIGRhdGFzZXQuIFRoaXMgY2Fubm90IGJlIHVzZWQgd2l0aCBwYWdpbmF0aW9uLCB3aGljaCBpcyBhdXRvbWF0aWNhbGx5CgkJICogZGlzYWJsZWQuIE5vdGUgLSB0aGUgU2Nyb2xsZXIgZXh0cmEgZm9yIERhdGFUYWJsZXMgaXMgcmVjb21tZW5kZWQgaW4KCQkgKiBpbiBwcmVmZXJlbmNlIHRvIHRoaXMgb3B0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNjcm9sbEluZmluaXRlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIENvbmZpZ3VyZSBEYXRhVGFibGVzIHRvIHVzZSBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nLiBOb3RlIHRoYXQgdGhlCgkJICogc0FqYXhTb3VyY2UgcGFyYW1ldGVyIG11c3QgYWxzbyBiZSBnaXZlbiBpbiBvcmRlciB0byBnaXZlIERhdGFUYWJsZXMgYQoJCSAqIHNvdXJjZSB0byBvYnRhaW4gdGhlIHJlcXVpcmVkIGRhdGEgZm9yIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJ4aHIucGhwIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNlcnZlclNpZGUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgc29ydGluZyBvZiBjb2x1bW5zLiBTb3J0aW5nIG9mIGluZGl2aWR1YWwgY29sdW1ucyBjYW4gYmUKCQkgKiBkaXNhYmxlZCBieSB0aGUgImJTb3J0YWJsZSIgb3B0aW9uIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNvcnQiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnQiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgY29udHJvbCBvdmVyIHdoZXRoZXIgRGF0YVRhYmxlcyBzaG91bGQgdXNlIHRoZSB0b3AgKHRydWUpIHVuaXF1ZQoJCSAqIGNlbGwgdGhhdCBpcyBmb3VuZCBmb3IgYSBzaW5nbGUgY29sdW1uLCBvciB0aGUgYm90dG9tIChmYWxzZSAtIGRlZmF1bHQpLgoJCSAqIFRoaXMgaXMgdXNlZnVsIHdoZW4gdXNpbmcgY29tcGxleCBoZWFkZXJzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTb3J0Q2VsbHNUb3AiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU29ydENlbGxzVG9wIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBhZGRpdGlvbiBvZiB0aGUgY2xhc3NlcyAnc29ydGluZ18xJywgJ3NvcnRpbmdfMicgYW5kCgkJICogJ3NvcnRpbmdfMycgdG8gdGhlIGNvbHVtbnMgd2hpY2ggYXJlIGN1cnJlbnRseSBiZWluZyBzb3J0ZWQgb24uIFRoaXMgaXMKCQkgKiBwcmVzZW50ZWQgYXMgYSBmZWF0dXJlIHN3aXRjaCBhcyBpdCBjYW4gaW5jcmVhc2UgcHJvY2Vzc2luZyB0aW1lICh3aGlsZQoJCSAqIGNsYXNzZXMgYXJlIHJlbW92ZWQgYW5kIGFkZGVkKSBzbyBmb3IgbGFyZ2UgZGF0YSBzZXRzIHlvdSBtaWdodCB3YW50IHRvCgkJICogdHVybiB0aGlzIG9mZi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNvcnRDbGFzc2VzIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTb3J0Q2xhc3NlcyI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHN0YXRlIHNhdmluZy4gV2hlbiBlbmFibGVkIGEgY29va2llIHdpbGwgYmUgdXNlZCB0byBzYXZlCgkJICogdGFibGUgZGlzcGxheSBpbmZvcm1hdGlvbiBzdWNoIGFzIHBhZ2luYXRpb24gaW5mb3JtYXRpb24sIGRpc3BsYXkgbGVuZ3RoLAoJCSAqIGZpbHRlcmluZyBhbmQgc29ydGluZy4gQXMgc3VjaCB3aGVuIHRoZSBlbmQgdXNlciByZWxvYWRzIHRoZSBwYWdlIHRoZQoJCSAqIGRpc3BsYXkgZGlzcGxheSB3aWxsIG1hdGNoIHdoYXQgdGh5IGhhZCBwcmV2aW91c2x5IHNldCB1cC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU3RhdGVTYXZlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEN1c3RvbWlzZSB0aGUgY29va2llIGFuZCAvIG9yIHRoZSBwYXJhbWV0ZXJzIGJlaW5nIHN0b3JlZCB3aGVuIHVzaW5nCgkJICogRGF0YVRhYmxlcyB3aXRoIHN0YXRlIHNhdmluZyBlbmFibGVkLiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuZXZlcgoJCSAqIHRoZSBjb29raWUgaXMgbW9kaWZpZWQsIGFuZCBpdCBleHBlY3RzIGEgZnVsbHkgZm9ybWVkIGNvb2tpZSBzdHJpbmcgdG8gYmUKCQkgKiByZXR1cm5lZC4gTm90ZSB0aGF0IHRoZSBkYXRhIG9iamVjdCBwYXNzZWQgaW4gaXMgYSBKYXZhc2NyaXB0IG9iamVjdCB3aGljaAoJCSAqIG11c3QgYmUgY29udmVydGVkIHRvIGEgc3RyaW5nIChKU09OLnN0cmluZ2lmeSBmb3IgZXhhbXBsZSkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBOYW1lIG9mIHRoZSBjb29raWUgZGVmaW5lZCBieSBEYXRhVGFibGVzCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBEYXRhIHRvIGJlIHN0b3JlZCBpbiB0aGUgY29va2llCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRXhwaXJlcyBDb29raWUgZXhwaXJlcyBzdHJpbmcKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNQYXRoIFBhdGggb2YgdGhlIGNvb2tpZSB0byBzZXQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gQ29va2llIGZvcm1hdHRlZCBzdHJpbmcgKHdoaWNoIHNob3VsZCBiZSBlbmNvZGVkIGJ5CgkJICogICAgdXNpbmcgZW5jb2RlVVJJQ29tcG9uZW50KCkpCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuQ29va2llQ2FsbGJhY2siOiBmdW5jdGlvbiAoc05hbWUsIG9EYXRhLCBzRXhwaXJlcywgc1BhdGgpIHsKCQkgKiAgICAgICAgICAvLyBDdXN0b21pc2Ugb0RhdGEgb3Igc05hbWUgb3Igd2hhdGV2ZXIgZWxzZSBoZXJlCgkJICogICAgICAgICAgcmV0dXJuIHNOYW1lICsgIj0iK0pTT04uc3RyaW5naWZ5KG9EYXRhKSsiOyBleHBpcmVzPSIgKyBzRXhwaXJlcyArIjsgcGF0aD0iICsgc1BhdGg7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuQ29va2llQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIGEgVFIgZWxlbWVudCBpcyBjcmVhdGVkIChhbmQgYWxsIFREIGNoaWxkCgkJICogZWxlbWVudHMgaGF2ZSBiZWVuIGluc2VydGVkKSwgb3IgcmVnaXN0ZXJlZCBpZiB1c2luZyBhIERPTSBzb3VyY2UsIGFsbG93aW5nCgkJICogbWFuaXB1bGF0aW9uIG9mIHRoZSBUUiBlbGVtZW50IChhZGRpbmcgY2xhc3NlcyBldGMpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Sb3cgIlRSIiBlbGVtZW50IGZvciB0aGUgY3VycmVudCByb3cKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgUmF3IGRhdGEgYXJyYXkgZm9yIHRoaXMgcm93CgkJICogIEBwYXJhbSB7aW50fSBpRGF0YUluZGV4IFRoZSBpbmRleCBvZiB0aGlzIHJvdyBpbiBhb0RhdGEKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkNyZWF0ZWRSb3ciOiBmdW5jdGlvbiggblJvdywgYURhdGEsIGlEYXRhSW5kZXggKSB7CgkJICogICAgICAgICAgLy8gQm9sZCB0aGUgZ3JhZGUgZm9yIGFsbCAnQScgZ3JhZGUgYnJvd3NlcnMKCQkgKiAgICAgICAgICBpZiAoIGFEYXRhWzRdID09ICJBIiApCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgJCgndGQ6ZXEoNCknLCBuUm93KS5odG1sKCAnPGI+QTwvYj4nICk7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNyZWF0ZWRSb3ciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBldmVyeSAnZHJhdycgZXZlbnQsIGFuZCBhbGxvd3MgeW91IHRvCgkJICogZHluYW1pY2FsbHkgbW9kaWZ5IGFueSBhc3BlY3QgeW91IHdhbnQgYWJvdXQgdGhlIGNyZWF0ZWQgRE9NLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5EcmF3Q2FsbGJhY2siOiBmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCSAqICAgICAgICAgIGFsZXJ0KCAnRGF0YVRhYmxlcyBoYXMgcmVkcmF3biB0aGUgdGFibGUnICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuRHJhd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogSWRlbnRpY2FsIHRvIGZuSGVhZGVyQ2FsbGJhY2soKSBidXQgZm9yIHRoZSB0YWJsZSBmb290ZXIgdGhpcyBmdW5jdGlvbgoJCSAqIGFsbG93cyB5b3UgdG8gbW9kaWZ5IHRoZSB0YWJsZSBmb290ZXIgb24gZXZlcnkgJ2RyYXcnIGV2ZW4uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7bm9kZX0gbkZvb3QgIlRSIiBlbGVtZW50IGZvciB0aGUgZm9vdGVyCgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIEZ1bGwgdGFibGUgZGF0YSAoYXMgZGVyaXZlZCBmcm9tIHRoZSBvcmlnaW5hbCBIVE1MKQoJCSAqICBAcGFyYW0ge2ludH0gaVN0YXJ0IEluZGV4IGZvciB0aGUgY3VycmVudCBkaXNwbGF5IHN0YXJ0aW5nIHBvaW50IGluIHRoZSAKCQkgKiAgICBkaXNwbGF5IGFycmF5CgkJICogIEBwYXJhbSB7aW50fSBpRW5kIEluZGV4IGZvciB0aGUgY3VycmVudCBkaXNwbGF5IGVuZGluZyBwb2ludCBpbiB0aGUgCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5IGludH0gYWlEaXNwbGF5IEluZGV4IGFycmF5IHRvIHRyYW5zbGF0ZSB0aGUgdmlzdWFsIHBvc2l0aW9uCgkJICogICAgdG8gdGhlIGZ1bGwgZGF0YSBhcnJheQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRm9vdGVyQ2FsbGJhY2siOiBmdW5jdGlvbiggbkZvb3QsIGFEYXRhLCBpU3RhcnQsIGlFbmQsIGFpRGlzcGxheSApIHsKCQkgKiAgICAgICAgICBuRm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGgnKVswXS5pbm5lckhUTUwgPSAiU3RhcnRpbmcgaW5kZXggaXMgIitpU3RhcnQ7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiZm5Gb290ZXJDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFdoZW4gcmVuZGVyaW5nIGxhcmdlIG51bWJlcnMgaW4gdGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgZm9yIHRoZSB0YWJsZQoJCSAqIChpLmUuICJTaG93aW5nIDEgdG8gMTAgb2YgNTcgZW50cmllcyIpIERhdGFUYWJsZXMgd2lsbCByZW5kZXIgbGFyZ2UgbnVtYmVycwoJCSAqIHRvIGhhdmUgYSBjb21tYSBzZXBhcmF0b3IgZm9yIHRoZSAndGhvdXNhbmRzJyB1bml0cyAoZS5nLiAxIG1pbGxpb24gaXMKCQkgKiByZW5kZXJlZCBhcyAiMSwwMDAsMDAwIikgdG8gaGVscCByZWFkYWJpbGl0eSBmb3IgdGhlIGVuZCB1c2VyLiBUaGlzCgkJICogZnVuY3Rpb24gd2lsbCBvdmVycmlkZSB0aGUgZGVmYXVsdCBtZXRob2QgRGF0YVRhYmxlcyB1c2VzLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7aW50fSBpSW4gbnVtYmVyIHRvIGJlIGZvcm1hdHRlZAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBmb3JtYXR0ZWQgc3RyaW5nIGZvciBEYXRhVGFibGVzIHRvIHNob3cgdGhlIG51bWJlcgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRm9ybWF0TnVtYmVyIjogZnVuY3Rpb24gKCBpSW4gKSB7CgkJICogICAgICAgICAgaWYgKCBpSW4gJmx0OyAxMDAwICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIGlJbjsKCQkgKiAgICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgICAgdmFyIAoJCSAqICAgICAgICAgICAgICBzPShpSW4rIiIpLCAKCQkgKiAgICAgICAgICAgICAgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCAKCQkgKiAgICAgICAgICAgICAgaUxlbj1zLmxlbmd0aDsKCQkgKiAgICAgICAgICAgIAoJCSAqICAgICAgICAgICAgZm9yICggdmFyIGk9MCA7IGkmbHQ7aUxlbiA7IGkrKyApIHsKCQkgKiAgICAgICAgICAgICAgaWYgKCBpJTMgPT09IDAgJmFtcDsmYW1wOyBpICE9PSAwICkgewoJCSAqICAgICAgICAgICAgICAgIG91dCA9ICInIitvdXQ7CgkJICogICAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgICAgb3V0ID0gYVtpTGVuLWktMV0rb3V0OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICByZXR1cm4gb3V0OwoJCSAqICAgICAgICB9OwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Gb3JtYXROdW1iZXIiOiBmdW5jdGlvbiAoIGlJbiApIHsKCQkJaWYgKCBpSW4gPCAxMDAwICkKCQkJewoJCQkJLy8gQSBzbWFsbCBvcHRpbWlzYXRpb24gZm9yIHdoYXQgaXMgbGlrZWx5IHRvIGJlIHRoZSBtYWpvcml0eSBvZiB1c2UgY2FzZXMKCQkJCXJldHVybiBpSW47CgkJCX0KCQoJCQl2YXIgcz0oaUluKyIiKSwgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCBpTGVuPXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggaSUzID09PSAwICYmIGkgIT09IDAgKQoJCQkJewoJCQkJCW91dCA9IHRoaXMub0xhbmd1YWdlLnNJbmZvVGhvdXNhbmRzK291dDsKCQkJCX0KCQkJCW91dCA9IGFbaUxlbi1pLTFdK291dDsKCQkJfQoJCQlyZXR1cm4gb3V0OwoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIG9uIGV2ZXJ5ICdkcmF3JyBldmVudCwgYW5kIGFsbG93cyB5b3UgdG8KCQkgKiBkeW5hbWljYWxseSBtb2RpZnkgdGhlIGhlYWRlciByb3cuIFRoaXMgY2FuIGJlIHVzZWQgdG8gY2FsY3VsYXRlIGFuZAoJCSAqIGRpc3BsYXkgdXNlZnVsIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZCAiVFIiIGVsZW1lbnQgZm9yIHRoZSBoZWFkZXIKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgRnVsbCB0YWJsZSBkYXRhIChhcyBkZXJpdmVkIGZyb20gdGhlIG9yaWdpbmFsIEhUTUwpCgkJICogIEBwYXJhbSB7aW50fSBpU3RhcnQgSW5kZXggZm9yIHRoZSBjdXJyZW50IGRpc3BsYXkgc3RhcnRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5IGludH0gYWlEaXNwbGF5IEluZGV4IGFycmF5IHRvIHRyYW5zbGF0ZSB0aGUgdmlzdWFsIHBvc2l0aW9uCgkJICogICAgdG8gdGhlIGZ1bGwgZGF0YSBhcnJheQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSGVhZGVyQ2FsbGJhY2siOiBmdW5jdGlvbiggbkhlYWQsIGFEYXRhLCBpU3RhcnQsIGlFbmQsIGFpRGlzcGxheSApIHsKCQkgKiAgICAgICAgICBuSGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGgnKVswXS5pbm5lckhUTUwgPSAiRGlzcGxheWluZyAiKyhpRW5kLWlTdGFydCkrIiByZWNvcmRzIjsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJmbkhlYWRlckNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgY2FuIGJlIHVzZWQgdG8gY29udmV5IGluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50CgkJICogc3RhdGUgb2YgdGhlIHRhYmxlLiBBbHRob3VnaCB0aGUgaW50ZXJuYXRpb25hbGlzYXRpb24gb3B0aW9ucyBwcmVzZW50ZWQgYnkKCQkgKiBEYXRhVGFibGVzIGFyZSBxdWl0ZSBjYXBhYmxlIG9mIGRlYWxpbmcgd2l0aCBtb3N0IGN1c3RvbWlzYXRpb25zLCB0aGVyZSBtYXkKCQkgKiBiZSB0aW1lcyB3aGVyZSB5b3Ugd2lzaCB0byBjdXN0b21pc2UgdGhlIHN0cmluZyBmdXJ0aGVyLiBUaGlzIGNhbGxiYWNrCgkJICogYWxsb3dzIHlvdSB0byBkbyBleGFjdGx5IHRoYXQuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBTdGFydGluZyBwb3NpdGlvbiBpbiBkYXRhIGZvciB0aGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBFbmQgcG9zaXRpb24gaW4gZGF0YSBmb3IgdGhlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXggVG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHRhYmxlIChyZWdhcmRsZXNzIG9mCgkJICogICAgZmlsdGVyaW5nKQoJCSAqICBAcGFyYW0ge2ludH0gaVRvdGFsIFRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSBkYXRhIHNldCwgYWZ0ZXIgZmlsdGVyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUHJlIFRoZSBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGhhcyBmb3JtYXR0ZWQgdXNpbmcgaXQncwoJCSAqICAgIG93biBydWxlcwoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc3RyaW5nIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgaW5mb3JtYXRpb24gZWxlbWVudC4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAiZm5JbmZvQ2FsbGJhY2siOiBmdW5jdGlvbiggb1NldHRpbmdzLCBpU3RhcnQsIGlFbmQsIGlNYXgsIGlUb3RhbCwgc1ByZSApIHsKCQkgKiAgICAgICAgcmV0dXJuIGlTdGFydCArIiB0byAiKyBpRW5kOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5JbmZvQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgaGFzIGJlZW4gaW5pdGlhbGlzZWQuIE5vcm1hbGx5IERhdGFUYWJsZXMgd2lsbAoJCSAqIGluaXRpYWxpc2Ugc2VxdWVudGlhbGx5IGFuZCB0aGVyZSB3aWxsIGJlIG5vIG5lZWQgZm9yIHRoaXMgZnVuY3Rpb24sCgkJICogaG93ZXZlciwgdGhpcyBkb2VzIG5vdCBob2xkIHRydWUgd2hlbiB1c2luZyBleHRlcm5hbCBsYW5ndWFnZSBpbmZvcm1hdGlvbgoJCSAqIHNpbmNlIHRoYXQgaXMgb2J0YWluZWQgdXNpbmcgYW4gYXN5bmMgWEhSIGNhbGwuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CgkJICogICAgICAgICAgYWxlcnQoICdEYXRhVGFibGVzIGhhcyBmaW5pc2hlZCBpdHMgaW5pdGlhbGlzYXRpb24uJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuSW5pdENvbXBsZXRlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGVkIGF0IHRoZSB2ZXJ5IHN0YXJ0IG9mIGVhY2ggdGFibGUgZHJhdyBhbmQgY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZQoJCSAqIGRyYXcgYnkgcmV0dXJuaW5nIGZhbHNlLCBhbnkgb3RoZXIgcmV0dXJuIChpbmNsdWRpbmcgdW5kZWZpbmVkKSByZXN1bHRzIGluCgkJICogdGhlIGZ1bGwgZHJhdyBvY2N1cnJpbmcpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sZWFufSBGYWxzZSB3aWxsIGNhbmNlbCB0aGUgZHJhdywgYW55dGhpbmcgZWxzZSAoaW5jbHVkaW5nIG5vCgkJICogICAgcmV0dXJuKSB3aWxsIGFsbG93IGl0IHRvIGNvbXBsZXRlLgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuUHJlRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBpZiAoICQoJyN0ZXN0JykudmFsKCkgPT0gMSApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUHJlRHJhd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvICdwb3N0IHByb2Nlc3MnIGVhY2ggcm93IGFmdGVyIGl0IGhhdmUgYmVlbgoJCSAqIGdlbmVyYXRlZCBmb3IgZWFjaCB0YWJsZSBkcmF3LCBidXQgYmVmb3JlIGl0IGlzIHJlbmRlcmVkIG9uIHNjcmVlbi4gVGhpcwoJCSAqIGZ1bmN0aW9uIG1pZ2h0IGJlIHVzZWQgZm9yIHNldHRpbmcgdGhlIHJvdyBjbGFzcyBuYW1lIGV0Yy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleCBUaGUgZGlzcGxheSBpbmRleCBmb3IgdGhlIGN1cnJlbnQgdGFibGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleEZ1bGwgVGhlIGluZGV4IG9mIHRoZSBkYXRhIGluIHRoZSBmdWxsIGxpc3Qgb2YKCQkgKiAgICByb3dzIChhZnRlciBmaWx0ZXJpbmcpCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5Sb3dDYWxsYmFjayI6IGZ1bmN0aW9uKCBuUm93LCBhRGF0YSwgaURpc3BsYXlJbmRleCwgaURpc3BsYXlJbmRleEZ1bGwgKSB7CgkJICogICAgICAgICAgLy8gQm9sZCB0aGUgZ3JhZGUgZm9yIGFsbCAnQScgZ3JhZGUgYnJvd3NlcnMKCQkgKiAgICAgICAgICBpZiAoIGFEYXRhWzRdID09ICJBIiApCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgJCgndGQ6ZXEoNCknLCBuUm93KS5odG1sKCAnPGI+QTwvYj4nICk7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblJvd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBmdW5jdGlvbiB3aGljaCBvYnRhaW5zCgkJICogdGhlIGRhdGEgZnJvbSB0aGUgc2VydmVyICgkLmdldEpTT04pIHNvIHNvbWV0aGluZyBtb3JlIHN1aXRhYmxlIGZvciB5b3VyCgkJICogYXBwbGljYXRpb24uIEZvciBleGFtcGxlIHlvdSBjb3VsZCB1c2UgUE9TVCBkYXRhLCBvciBwdWxsIGluZm9ybWF0aW9uIGZyb20KCQkgKiBhIEdlYXJzIG9yIEFJUiBkYXRhYmFzZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NvdXJjZSBIVFRQIHNvdXJjZSB0byBvYnRhaW4gdGhlIGRhdGEgZnJvbSAoc0FqYXhTb3VyY2UpCgkJICogIEBwYXJhbSB7YXJyYXl9IGFvRGF0YSBBIGtleS92YWx1ZSBwYWlyIG9iamVjdCBjb250YWluaW5nIHRoZSBkYXRhIHRvIHNlbmQKCQkgKiAgICB0byB0aGUgc2VydmVyCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuQ2FsbGJhY2sgdG8gYmUgY2FsbGVkIG9uIGNvbXBsZXRpb24gb2YgdGhlIGRhdGEgZ2V0CgkJICogICAgcHJvY2VzcyB0aGF0IHdpbGwgZHJhdyB0aGUgZGF0YSBvbiB0aGUgcGFnZS4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogIEBkdG9wdCBTZXJ2ZXItc2lkZQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFBPU1QgZGF0YSB0byBzZXJ2ZXIKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAieGhyLnBocCIsCgkJICogICAgICAgICJmblNlcnZlckRhdGEiOiBmdW5jdGlvbiAoIHNTb3VyY2UsIGFvRGF0YSwgZm5DYWxsYmFjaywgb1NldHRpbmdzICkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5qcVhIUiA9ICQuYWpheCggewoJCSAqICAgICAgICAgICAgImRhdGFUeXBlIjogJ2pzb24nLCAKCQkgKiAgICAgICAgICAgICJ0eXBlIjogIlBPU1QiLCAKCQkgKiAgICAgICAgICAgICJ1cmwiOiBzU291cmNlLCAKCQkgKiAgICAgICAgICAgICJkYXRhIjogYW9EYXRhLCAKCQkgKiAgICAgICAgICAgICJzdWNjZXNzIjogZm5DYWxsYmFjawoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TZXJ2ZXJEYXRhIjogZnVuY3Rpb24gKCBzVXJsLCBhb0RhdGEsIGZuQ2FsbGJhY2ssIG9TZXR0aW5ncyApIHsKCQkJb1NldHRpbmdzLmpxWEhSID0gJC5hamF4KCB7CgkJCQkidXJsIjogIHNVcmwsCgkJCQkiZGF0YSI6IGFvRGF0YSwKCQkJCSJzdWNjZXNzIjogZnVuY3Rpb24gKGpzb24pIHsKCQkJCQlpZiAoIGpzb24uc0Vycm9yICkgewoJCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5Mb2coIG9TZXR0aW5ncywgMCwganNvbi5zRXJyb3IgKTsKCQkJCQl9CgkJCQkJCgkJCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCd4aHInLCBbb1NldHRpbmdzLCBqc29uXSk7CgkJCQkJZm5DYWxsYmFjaygganNvbiApOwoJCQkJfSwKCQkJCSJkYXRhVHlwZSI6ICJqc29uIiwKCQkJCSJjYWNoZSI6IGZhbHNlLAoJCQkJInR5cGUiOiBvU2V0dGluZ3Muc1NlcnZlck1ldGhvZCwKCQkJCSJlcnJvciI6IGZ1bmN0aW9uICh4aHIsIGVycm9yLCB0aHJvd24pIHsKCQkJCQlpZiAoIGVycm9yID09ICJwYXJzZXJlcnJvciIgKSB7CgkJCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkxvZyggb1NldHRpbmdzLCAwLCAiRGF0YVRhYmxlcyB3YXJuaW5nOiBKU09OIGRhdGEgZnJvbSAiKwoJCQkJCQkJInNlcnZlciBjb3VsZCBub3QgYmUgcGFyc2VkLiBUaGlzIGlzIGNhdXNlZCBieSBhIEpTT04gZm9ybWF0dGluZyBlcnJvci4iICk7CgkJCQkJfQoJCQkJfQoJCQl9ICk7CgkJfSwKCQoJCgkJLyoqCgkJICogSXQgaXMgb2Z0ZW4gdXNlZnVsIHRvIHNlbmQgZXh0cmEgZGF0YSB0byB0aGUgc2VydmVyIHdoZW4gbWFraW5nIGFuIEFqYXgKCQkgKiByZXF1ZXN0IC0gZm9yIGV4YW1wbGUgY3VzdG9tIGZpbHRlcmluZyBpbmZvcm1hdGlvbiwgYW5kIHRoaXMgY2FsbGJhY2sKCQkgKiBmdW5jdGlvbiBtYWtlcyBpdCB0cml2aWFsIHRvIHNlbmQgZXh0cmEgaW5mb3JtYXRpb24gdG8gdGhlIHNlcnZlci4gVGhlCgkJICogcGFzc2VkIGluIHBhcmFtZXRlciBpcyB0aGUgZGF0YSBzZXQgdGhhdCBoYXMgYmVlbiBjb25zdHJ1Y3RlZCBieQoJCSAqIERhdGFUYWJsZXMsIGFuZCB5b3UgY2FuIGFkZCB0byB0aGlzIG9yIG1vZGlmeSBpdCBhcyB5b3UgcmVxdWlyZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gYW9EYXRhIERhdGEgYXJyYXkgKGFycmF5IG9mIG9iamVjdHMgd2hpY2ggYXJlIG5hbWUvdmFsdWUKCQkgKiAgICBwYWlycykgdGhhdCBoYXMgYmVlbiBjb25zdHJ1Y3RlZCBieSBEYXRhVGFibGVzIGFuZCB3aWxsIGJlIHNlbnQgdG8gdGhlCgkJICogICAgc2VydmVyLiBJbiB0aGUgY2FzZSBvZiBBamF4IHNvdXJjZWQgZGF0YSB3aXRoIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcKCQkgKiAgICB0aGlzIHdpbGwgYmUgYW4gZW1wdHkgYXJyYXksIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRoZXJlIHdpbGwgYmUgYQoJCSAqICAgIHNpZ25pZmljYW50IG51bWJlciBvZiBwYXJhbWV0ZXJzIQoJCSAqICBAcmV0dXJucyB7dW5kZWZpbmVkfSBFbnN1cmUgdGhhdCB5b3UgbW9kaWZ5IHRoZSBhb0RhdGEgYXJyYXkgcGFzc2VkIGluLAoJCSAqICAgIGFzIHRoaXMgaXMgcGFzc2VkIGJ5IHJlZmVyZW5jZS4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJQYXJhbXMiOiBmdW5jdGlvbiAoIGFvRGF0YSApIHsKCQkgKiAgICAgICAgICBhb0RhdGEucHVzaCggeyAibmFtZSI6ICJtb3JlX2RhdGEiLCAidmFsdWUiOiAibXlfdmFsdWUiIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TZXJ2ZXJQYXJhbXMiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBMb2FkIHRoZSB0YWJsZSBzdGF0ZS4gV2l0aCB0aGlzIGZ1bmN0aW9uIHlvdSBjYW4gZGVmaW5lIGZyb20gd2hlcmUsIGFuZCBob3csIHRoZQoJCSAqIHN0YXRlIG9mIGEgdGFibGUgaXMgbG9hZGVkLiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgd2lsbCBsb2FkIGZyb20gaXRzIHN0YXRlIHNhdmluZwoJCSAqIGNvb2tpZSwgYnV0IHlvdSBtaWdodCB3aXNoIHRvIHVzZSBsb2NhbCBzdG9yYWdlIChIVE1MNSkgb3IgYSBzZXJ2ZXItc2lkZSBkYXRhYmFzZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm4ge29iamVjdH0gVGhlIERhdGFUYWJsZXMgc3RhdGUgb2JqZWN0IHRvIGJlIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZUxvYWQiOiBmdW5jdGlvbiAob1NldHRpbmdzKSB7CgkJICogICAgICAgICAgdmFyIG87CgkJICogICAgICAgICAgCgkJICogICAgICAgICAgLy8gU2VuZCBhbiBBamF4IHJlcXVlc3QgdG8gdGhlIHNlcnZlciB0byBnZXQgdGhlIGRhdGEuIE5vdGUgdGhhdAoJCSAqICAgICAgICAgIC8vIHRoaXMgaXMgYSBzeW5jaHJvbm91cyByZXF1ZXN0LgoJCSAqICAgICAgICAgICQuYWpheCggewoJCSAqICAgICAgICAgICAgInVybCI6ICIvc3RhdGVfbG9hZCIsCgkJICogICAgICAgICAgICAiYXN5bmMiOiBmYWxzZSwKCQkgKiAgICAgICAgICAgICJkYXRhVHlwZSI6ICJqc29uIiwKCQkgKiAgICAgICAgICAgICJzdWNjZXNzIjogZnVuY3Rpb24gKGpzb24pIHsKCQkgKiAgICAgICAgICAgICAgbyA9IGpzb247CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgfSApOwoJCSAqICAgICAgICAgIAoJCSAqICAgICAgICAgIHJldHVybiBvOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlTG9hZCI6IGZ1bmN0aW9uICggb1NldHRpbmdzICkgewoJCQl2YXIgc0RhdGEgPSB0aGlzLm9BcGkuX2ZuUmVhZENvb2tpZSggb1NldHRpbmdzLnNDb29raWVQcmVmaXgrb1NldHRpbmdzLnNJbnN0YW5jZSApOwoJCQl2YXIgb0RhdGE7CgkKCQkJdHJ5IHsKCQkJCW9EYXRhID0gKHR5cGVvZiAkLnBhcnNlSlNPTiA9PT0gJ2Z1bmN0aW9uJykgPyAKCQkJCQkkLnBhcnNlSlNPTihzRGF0YSkgOiBldmFsKCAnKCcrc0RhdGErJyknICk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCW9EYXRhID0gbnVsbDsKCQkJfQoJCgkJCXJldHVybiBvRGF0YTsKCQl9LAoJCgkKCQkvKioKCQkgKiBDYWxsYmFjayB3aGljaCBhbGxvd3MgbW9kaWZpY2F0aW9uIG9mIHRoZSBzYXZlZCBzdGF0ZSBwcmlvciB0byBsb2FkaW5nIHRoYXQgc3RhdGUuCgkJICogVGhpcyBjYWxsYmFjayBpcyBjYWxsZWQgd2hlbiB0aGUgdGFibGUgaXMgbG9hZGluZyBzdGF0ZSBmcm9tIHRoZSBzdG9yZWQgZGF0YSwgYnV0CgkJICogcHJpb3IgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBiZWluZyBtb2RpZmllZCBieSB0aGUgc2F2ZWQgc3RhdGUuIE5vdGUgdGhhdCBmb3IgCgkJICogcGx1Zy1pbiBhdXRob3JzLCB5b3Ugc2hvdWxkIHVzZSB0aGUgJ3N0YXRlTG9hZFBhcmFtcycgZXZlbnQgdG8gbG9hZCBwYXJhbWV0ZXJzIGZvciAKCQkgKiBhIHBsdWctaW4uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdGhhdCBpcyB0byBiZSBsb2FkZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFJlbW92ZSBhIHNhdmVkIGZpbHRlciwgc28gZmlsdGVyaW5nIGlzIG5ldmVyIGxvYWRlZAoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBvRGF0YS5vU2VhcmNoLnNTZWFyY2ggPSAiIjsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBEaXNhbGxvdyBzdGF0ZSBsb2FkaW5nIGJ5IHJldHVybmluZyBmYWxzZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVMb2FkUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgdGhhdCBpcyBjYWxsZWQgd2hlbiB0aGUgc3RhdGUgaGFzIGJlZW4gbG9hZGVkIGZyb20gdGhlIHN0YXRlIHNhdmluZyBtZXRob2QKCQkgKiBhbmQgdGhlIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IGhhcyBiZWVuIG1vZGlmaWVkIGFzIGEgcmVzdWx0IG9mIHRoZSBsb2FkZWQgc3RhdGUuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdGhhdCB3YXMgbG9hZGVkCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBTaG93IGFuIGFsZXJ0IHdpdGggdGhlIGZpbHRlcmluZyB2YWx1ZSB0aGF0IHdhcyBzYXZlZAoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkZWQiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIGFsZXJ0KCAnU2F2ZWQgZmlsdGVyIHdhczogJytvRGF0YS5vU2VhcmNoLnNTZWFyY2ggKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZUxvYWRlZCI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFNhdmUgdGhlIHRhYmxlIHN0YXRlLiBUaGlzIGZ1bmN0aW9uIGFsbG93cyB5b3UgdG8gZGVmaW5lIHdoZXJlIGFuZCBob3cgdGhlIHN0YXRlCgkJICogaW5mb3JtYXRpb24gZm9yIHRoZSB0YWJsZSBpcyBzdG9yZWQgLSBieSBkZWZhdWx0IGl0IHdpbGwgdXNlIGEgY29va2llLCBidXQgeW91CgkJICogbWlnaHQgd2FudCB0byB1c2UgbG9jYWwgc3RvcmFnZSAoSFRNTDUpIG9yIGEgc2VydmVyLXNpZGUgZGF0YWJhc2UuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBtZW1iZXIKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0byBiZSBzYXZlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIC8vIFNlbmQgYW4gQWpheCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgd2l0aCB0aGUgc3RhdGUgb2JqZWN0CgkJICogICAgICAgICAgJC5hamF4KCB7CgkJICogICAgICAgICAgICAidXJsIjogIi9zdGF0ZV9zYXZlIiwKCQkgKiAgICAgICAgICAgICJkYXRhIjogb0RhdGEsCgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAianNvbiIsCgkJICogICAgICAgICAgICAibWV0aG9kIjogIlBPU1QiCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZ1bmN0aW9uICgpIHt9CgkJICogICAgICAgICAgfSApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlU2F2ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBvRGF0YSApIHsKCQkJdGhpcy5vQXBpLl9mbkNyZWF0ZUNvb2tpZSggCgkJCQlvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCtvU2V0dGluZ3Muc0luc3RhbmNlLCAKCQkJCXRoaXMub0FwaS5fZm5Kc29uU3RyaW5nKG9EYXRhKSwgCgkJCQlvU2V0dGluZ3MuaUNvb2tpZUR1cmF0aW9uLCAKCQkJCW9TZXR0aW5ncy5zQ29va2llUHJlZml4LCAKCQkJCW9TZXR0aW5ncy5mbkNvb2tpZUNhbGxiYWNrCgkJCSk7CgkJfSwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgd2hpY2ggYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc3RhdGUgdG8gYmUgc2F2ZWQuIENhbGxlZCB3aGVuIHRoZSB0YWJsZSAKCQkgKiBoYXMgY2hhbmdlZCBzdGF0ZSBhIG5ldyBzdGF0ZSBzYXZlIGlzIHJlcXVpcmVkLiBUaGlzIG1ldGhvZCBhbGxvd3MgbW9kaWZpY2F0aW9uIG9mCgkJICogdGhlIHN0YXRlIHNhdmluZyBvYmplY3QgcHJpb3IgdG8gYWN0dWFsbHkgZG9pbmcgdGhlIHNhdmUsIGluY2x1ZGluZyBhZGRpdGlvbiBvciAKCQkgKiBvdGhlciBzdGF0ZSBwcm9wZXJ0aWVzIG9yIG1vZGlmaWNhdGlvbi4gTm90ZSB0aGF0IGZvciBwbHVnLWluIGF1dGhvcnMsIHlvdSBzaG91bGQgCgkJICogdXNlIHRoZSAnc3RhdGVTYXZlUGFyYW1zJyBldmVudCB0byBzYXZlIHBhcmFtZXRlcnMgZm9yIGEgcGx1Zy1pbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0byBiZSBzYXZlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUmVtb3ZlIGEgc2F2ZWQgZmlsdGVyLCBzbyBmaWx0ZXJpbmcgaXMgbmV2ZXIgc2F2ZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlU2F2ZVBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgb0RhdGEub1NlYXJjaC5zU2VhcmNoID0gIiI7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVTYXZlUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRHVyYXRpb24gb2YgdGhlIGNvb2tpZSB3aGljaCBpcyB1c2VkIGZvciBzdG9yaW5nIHNlc3Npb24gaW5mb3JtYXRpb24uIFRoaXMKCQkgKiB2YWx1ZSBpcyBnaXZlbiBpbiBzZWNvbmRzLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgNzIwMCA8aT4oMiBob3Vycyk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlDb29raWVEdXJhdGlvbiI6IDYwKjYwKjI0OyAvLyAxIGRheQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJpQ29va2llRHVyYXRpb24iOiA3MjAwLAoJCgkKCQkvKioKCQkgKiBXaGVuIGVuYWJsZWQgRGF0YVRhYmxlcyB3aWxsIG5vdCBtYWtlIGEgcmVxdWVzdCB0byB0aGUgc2VydmVyIGZvciB0aGUgZmlyc3QKCQkgKiBwYWdlIGRyYXcgLSByYXRoZXIgaXQgd2lsbCB1c2UgdGhlIGRhdGEgYWxyZWFkeSBvbiB0aGUgcGFnZSAobm8gc29ydGluZyBldGMKCQkgKiB3aWxsIGJlIGFwcGxpZWQgdG8gaXQpLCB0aHVzIHNhdmluZyBvbiBhbiBYSFIgYXQgbG9hZCB0aW1lLiBpRGVmZXJMb2FkaW5nCgkJICogaXMgdXNlZCB0byBpbmRpY2F0ZSB0aGF0IGRlZmVycmVkIGxvYWRpbmcgaXMgcmVxdWlyZWQsIGJ1dCBpdCBpcyBhbHNvIHVzZWQKCQkgKiB0byB0ZWxsIERhdGFUYWJsZXMgaG93IG1hbnkgcmVjb3JkcyB0aGVyZSBhcmUgaW4gdGhlIGZ1bGwgdGFibGUgKGFsbG93aW5nCgkJICogdGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgYW5kIHBhZ2luYXRpb24gdG8gYmUgZGlzcGxheWVkIGNvcnJlY3RseSkuIEluIHRoZSBjYXNlCgkJICogd2hlcmUgYSBmaWx0ZXJpbmcgaXMgYXBwbGllZCB0byB0aGUgdGFibGUgb24gaW5pdGlhbCBsb2FkLCB0aGlzIGNhbiBiZQoJCSAqIGluZGljYXRlZCBieSBnaXZpbmcgdGhlIHBhcmFtZXRlciBhcyBhbiBhcnJheSwgd2hlcmUgdGhlIGZpcnN0IGVsZW1lbnQgaXMKCQkgKiB0aGUgbnVtYmVyIG9mIHJlY29yZHMgYXZhaWxhYmxlIGFmdGVyIGZpbHRlcmluZyBhbmQgdGhlIHNlY29uZCBlbGVtZW50IGlzIHRoZQoJCSAqIG51bWJlciBvZiByZWNvcmRzIHdpdGhvdXQgZmlsdGVyaW5nIChhbGxvd2luZyB0aGUgdGFibGUgaW5mb3JtYXRpb24gZWxlbWVudAoJCSAqIHRvIGJlIHNob3duIGNvcnJlY3RseSkuCgkJICogIEB0eXBlIGludCB8IGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyA1NyByZWNvcmRzIGF2YWlsYWJsZSBpbiB0aGUgdGFibGUsIG5vIGZpbHRlcmluZyBhcHBsaWVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNjcmlwdHMvc2VydmVyX3Byb2Nlc3NpbmcucGhwIiwKCQkgKiAgICAgICAgImlEZWZlckxvYWRpbmciOiA1NwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyA1NyByZWNvcmRzIGFmdGVyIGZpbHRlcmluZywgMTAwIHdpdGhvdXQgZmlsdGVyaW5nIChhbiBpbml0aWFsIGZpbHRlciBhcHBsaWVkKQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3NlcnZlcl9wcm9jZXNzaW5nLnBocCIsCgkJICogICAgICAgICJpRGVmZXJMb2FkaW5nIjogWyA1NywgMTAwIF0sCgkJICogICAgICAgICJvU2VhcmNoIjogewoJCSAqICAgICAgICAgICJzU2VhcmNoIjogIm15X2ZpbHRlciIKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiaURlZmVyTG9hZGluZyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIE51bWJlciBvZiByb3dzIHRvIGRpc3BsYXkgb24gYSBzaW5nbGUgcGFnZSB3aGVuIHVzaW5nIHBhZ2luYXRpb24uIElmCgkJICogZmVhdHVyZSBlbmFibGVkIChiTGVuZ3RoQ2hhbmdlKSB0aGVuIHRoZSBlbmQgdXNlciB3aWxsIGJlIGFibGUgdG8gb3ZlcnJpZGUKCQkgKiB0aGlzIHRvIGEgY3VzdG9tIHNldHRpbmcgdXNpbmcgYSBwb3AtdXAgbWVudS4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDEwCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogNTAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaURpc3BsYXlMZW5ndGgiOiAxMCwKCQoJCgkJLyoqCgkJICogRGVmaW5lIHRoZSBzdGFydGluZyBwb2ludCBmb3IgZGF0YSBkaXNwbGF5IHdoZW4gdXNpbmcgRGF0YVRhYmxlcyB3aXRoCgkJICogcGFnaW5hdGlvbi4gTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIGlzIHRoZSBudW1iZXIgb2YgcmVjb3JkcywgcmF0aGVyIHRoYW4KCQkgKiB0aGUgcGFnZSBudW1iZXIsIHNvIGlmIHlvdSBoYXZlIDEwIHJlY29yZHMgcGVyIHBhZ2UgYW5kIHdhbnQgdG8gc3RhcnQgb24KCQkgKiB0aGUgdGhpcmQgcGFnZSwgaXQgc2hvdWxkIGJlICIyMCIuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlEaXNwbGF5U3RhcnQiOiAyMAoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJpRGlzcGxheVN0YXJ0IjogMCwKCQoJCgkJLyoqCgkJICogVGhlIHNjcm9sbCBnYXAgaXMgdGhlIGFtb3VudCBvZiBzY3JvbGxpbmcgdGhhdCBpcyBsZWZ0IHRvIGdvIGJlZm9yZQoJCSAqIERhdGFUYWJsZXMgd2lsbCBsb2FkIHRoZSBuZXh0ICdwYWdlJyBvZiBkYXRhIGF1dG9tYXRpY2FsbHkuIFlvdSB0eXBpY2FsbHkKCQkgKiB3YW50IGEgZ2FwIHdoaWNoIGlzIGJpZyBlbm91Z2ggdGhhdCB0aGUgc2Nyb2xsaW5nIHdpbGwgYmUgc21vb3RoIGZvciB0aGUKCQkgKiB1c2VyLCB3aGlsZSBub3Qgc28gbGFyZ2UgdGhhdCBpdCB3aWxsIGxvYWQgbW9yZSBkYXRhIHRoYW4gbmVlZC4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDEwMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImlTY3JvbGxMb2FkR2FwIjogNTAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlTY3JvbGxMb2FkR2FwIjogMTAwLAoJCgkKCQkvKioKCQkgKiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgYWxsb3dzIGtleWJvYXJkIG5hdmlnYXRpb24gb2YgdGhlIHRhYmxlIChzb3J0aW5nLCBwYWdpbmcsCgkJICogYW5kIGZpbHRlcmluZykgYnkgYWRkaW5nIGEgdGFiaW5kZXggYXR0cmlidXRlIHRvIHRoZSByZXF1aXJlZCBlbGVtZW50cy4gVGhpcwoJCSAqIGFsbG93cyB5b3UgdG8gdGFiIHRocm91Z2ggdGhlIGNvbnRyb2xzIGFuZCBwcmVzcyB0aGUgZW50ZXIga2V5IHRvIGFjdGl2YXRlIHRoZW0uCgkJICogVGhlIHRhYmluZGV4IGlzIGRlZmF1bHQgMCwgbWVhbmluZyB0aGF0IHRoZSB0YWIgZm9sbG93cyB0aGUgZmxvdyBvZiB0aGUgZG9jdW1lbnQuCgkJICogWW91IGNhbiBvdmVycnVsZSB0aGlzIHVzaW5nIHRoaXMgcGFyYW1ldGVyIGlmIHlvdSB3aXNoLiBVc2UgYSB2YWx1ZSBvZiAtMSB0bwoJCSAqIGRpc2FibGUgYnVpbHQtaW4ga2V5Ym9hcmQgbmF2aWdhdGlvbi4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiaVRhYkluZGV4IjogMQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiaVRhYkluZGV4IjogMCwKCQoJCgkJLyoqCgkJICogQWxsIHN0cmluZ3MgdGhhdCBEYXRhVGFibGVzIHVzZXMgaW4gdGhlIHVzZXIgaW50ZXJmYWNlIHRoYXQgaXQgY3JlYXRlcwoJCSAqIGFyZSBkZWZpbmVkIGluIHRoaXMgb2JqZWN0LCBhbGxvd2luZyB5b3UgdG8gbW9kaWZpZWQgdGhlbSBpbmRpdmlkdWFsbHkgb3IKCQkgKiBjb21wbGV0ZWx5IHJlcGxhY2UgdGhlbSBhbGwgYXMgcmVxdWlyZWQuCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib0xhbmd1YWdlIjogewoJCQkvKioKCQkJICogU3RyaW5ncyB0aGF0IGFyZSB1c2VkIGZvciBXQUktQVJJQSBsYWJlbHMgYW5kIGNvbnRyb2xzIG9ubHkgKHRoZXNlIGFyZSBub3QKCQkJICogYWN0dWFsbHkgdmlzaWJsZSBvbiB0aGUgcGFnZSwgYnV0IHdpbGwgYmUgcmVhZCBieSBzY3JlZW5yZWFkZXJzLCBhbmQgdGh1cwoJCQkgKiBtdXN0IGJlIGludGVybmF0aW9uYWxpc2VkIGFzIHdlbGwpLgoJCQkgKiAgQG5hbWVzcGFjZQoJCQkgKi8KCQkJIm9BcmlhIjogewoJCQkJLyoqCgkJCQkgKiBBUklBIGxhYmVsIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHRhYmxlIGhlYWRlcnMgd2hlbiB0aGUgY29sdW1uIG1heSBiZQoJCQkJICogc29ydGVkIGFzY2VuZGluZyBieSBhY3RpdmluZyB0aGUgY29sdW1uIChjbGljayBvciByZXR1cm4gd2hlbiBmb2N1c2VkKS4KCQkJCSAqIE5vdGUgdGhhdCB0aGUgY29sdW1uIGhlYWRlciBpcyBwcmVmaXhlZCB0byB0aGlzIHN0cmluZy4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCA6IGFjdGl2YXRlIHRvIHNvcnQgY29sdW1uIGFzY2VuZGluZwoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9BcmlhIjogewoJCQkJICogICAgICAgICAgICAic1NvcnRBc2NlbmRpbmciOiAiIC0gY2xpY2svcmV0dXJuIHRvIHNvcnQgYXNjZW5kaW5nIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic1NvcnRBc2NlbmRpbmciOiAiOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmciLAoJCgkJCQkvKioKCQkJCSAqIEFSSUEgbGFiZWwgdGhhdCBpcyBhZGRlZCB0byB0aGUgdGFibGUgaGVhZGVycyB3aGVuIHRoZSBjb2x1bW4gbWF5IGJlCgkJCQkgKiBzb3J0ZWQgZGVzY2VuZGluZyBieSBhY3RpdmluZyB0aGUgY29sdW1uIChjbGljayBvciByZXR1cm4gd2hlbiBmb2N1c2VkKS4KCQkJCSAqIE5vdGUgdGhhdCB0aGUgY29sdW1uIGhlYWRlciBpcyBwcmVmaXhlZCB0byB0aGlzIHN0cmluZy4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCA6IGFjdGl2YXRlIHRvIHNvcnQgY29sdW1uIGFzY2VuZGluZwoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9BcmlhIjogewoJCQkJICogICAgICAgICAgICAic1NvcnREZXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGRlc2NlbmRpbmciCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzU29ydERlc2NlbmRpbmciOiAiOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBkZXNjZW5kaW5nIgoJCQl9LAoJCgkJCS8qKgoJCQkgKiBQYWdpbmF0aW9uIHN0cmluZyB1c2VkIGJ5IERhdGFUYWJsZXMgZm9yIHRoZSB0d28gYnVpbHQtaW4gcGFnaW5hdGlvbgoJCQkgKiBjb250cm9sIHR5cGVzICgidHdvX2J1dHRvbiIgYW5kICJmdWxsX251bWJlcnMiKQoJCQkgKiAgQG5hbWVzcGFjZQoJCQkgKi8KCQkJIm9QYWdpbmF0ZSI6IHsKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBmaXJzdCBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IEZpcnN0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic0ZpcnN0IjogIkZpcnN0IHBhZ2UiCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzRmlyc3QiOiAiRmlyc3QiLAoJCQkKCQkJCgkJCQkvKioKCQkJCSAqIFRleHQgdG8gdXNlIHdoZW4gdXNpbmcgdGhlICdmdWxsX251bWJlcnMnIHR5cGUgb2YgcGFnaW5hdGlvbiBmb3IgdGhlCgkJCQkgKiBidXR0b24gdG8gdGFrZSB0aGUgdXNlciB0byB0aGUgbGFzdCBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IExhc3QKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzTGFzdCI6ICJMYXN0IHBhZ2UiCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzTGFzdCI6ICJMYXN0IiwKCQkJCgkJCQoJCQkJLyoqCgkJCQkgKiBUZXh0IHRvIHVzZSB3aGVuIHVzaW5nIHRoZSAnZnVsbF9udW1iZXJzJyB0eXBlIG9mIHBhZ2luYXRpb24gZm9yIHRoZQoJCQkJICogYnV0dG9uIHRvIHRha2UgdGhlIHVzZXIgdG8gdGhlIG5leHQgcGFnZS4KCQkJCSAqICBAdHlwZSBzdHJpbmcKCQkJCSAqICBAZGVmYXVsdCBOZXh0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic05leHQiOiAiTmV4dCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic05leHQiOiAiTmV4dCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBwcmV2aW91cyBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IFByZXZpb3VzCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic1ByZXZpb3VzIjogIlByZXZpb3VzIHBhZ2UiCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzUHJldmlvdXMiOiAiUHJldmlvdXMiCgkJCX0sCgkJCgkJCS8qKgoJCQkgKiBUaGlzIHN0cmluZyBpcyBzaG93biBpbiBwcmVmZXJlbmNlIHRvIHNaZXJvUmVjb3JkcyB3aGVuIHRoZSB0YWJsZSBpcwoJCQkgKiBlbXB0eSBvZiBkYXRhIChyZWdhcmRsZXNzIG9mIGZpbHRlcmluZykuIE5vdGUgdGhhdCB0aGlzIGlzIGFuIG9wdGlvbmFsCgkJCSAqIHBhcmFtZXRlciAtIGlmIGl0IGlzIG5vdCBnaXZlbiwgdGhlIHZhbHVlIG9mIHNaZXJvUmVjb3JkcyB3aWxsIGJlIHVzZWQKCQkJICogaW5zdGVhZCAoZWl0aGVyIHRoZSBkZWZhdWx0IG9yIGdpdmVuIHZhbHVlKS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGUKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNFbXB0eVRhYmxlIjogIk5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNFbXB0eVRhYmxlIjogIk5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFRoaXMgc3RyaW5nIGdpdmVzIGluZm9ybWF0aW9uIHRvIHRoZSBlbmQgdXNlciBhYm91dCB0aGUgaW5mb3JtYXRpb24gdGhhdCAKCQkJICogaXMgY3VycmVudCBvbiBkaXNwbGF5IG9uIHRoZSBwYWdlLiBUaGUgX1NUQVJUXywgX0VORF8gYW5kIF9UT1RBTF8gCgkJCSAqIHZhcmlhYmxlcyBhcmUgYWxsIGR5bmFtaWNhbGx5IHJlcGxhY2VkIGFzIHRoZSB0YWJsZSBkaXNwbGF5IHVwZGF0ZXMsIGFuZCAKCQkJICogY2FuIGJlIGZyZWVseSBtb3ZlZCBvciByZW1vdmVkIGFzIHRoZSBsYW5ndWFnZSByZXF1aXJlbWVudHMgY2hhbmdlLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBTaG93aW5nIF9TVEFSVF8gdG8gX0VORF8gb2YgX1RPVEFMXyBlbnRyaWVzCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mbyI6ICJHb3QgYSB0b3RhbCBvZiBfVE9UQUxfIGVudHJpZXMgdG8gc2hvdyAoX1NUQVJUXyB0byBfRU5EXykiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm8iOiAiU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEaXNwbGF5IGluZm9ybWF0aW9uIHN0cmluZyBmb3Igd2hlbiB0aGUgdGFibGUgaXMgZW1wdHkuIFR5cGljYWxseSB0aGUgCgkJCSAqIGZvcm1hdCBvZiB0aGlzIHN0cmluZyBzaG91bGQgbWF0Y2ggc0luZm8uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0luZm9FbXB0eSI6ICJObyBlbnRyaWVzIHRvIHNob3ciCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9FbXB0eSI6ICJTaG93aW5nIDAgdG8gMCBvZiAwIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogV2hlbiBhIHVzZXIgZmlsdGVycyB0aGUgaW5mb3JtYXRpb24gaW4gYSB0YWJsZSwgdGhpcyBzdHJpbmcgaXMgYXBwZW5kZWQgCgkJCSAqIHRvIHRoZSBpbmZvcm1hdGlvbiAoc0luZm8pIHRvIGdpdmUgYW4gaWRlYSBvZiBob3cgc3Ryb25nIHRoZSBmaWx0ZXJpbmcgCgkJCSAqIGlzLiBUaGUgdmFyaWFibGUgX01BWF8gaXMgZHluYW1pY2FsbHkgdXBkYXRlZC4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgKGZpbHRlcmVkIGZyb20gX01BWF8gdG90YWwgZW50cmllcykKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNJbmZvRmlsdGVyZWQiOiAiIC0gZmlsdGVyaW5nIGZyb20gX01BWF8gcmVjb3JkcyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb0ZpbHRlcmVkIjogIihmaWx0ZXJlZCBmcm9tIF9NQVhfIHRvdGFsIGVudHJpZXMpIiwKCQkKCQkKCQkJLyoqCgkJCSAqIElmIGNhbiBiZSB1c2VmdWwgdG8gYXBwZW5kIGV4dHJhIGluZm9ybWF0aW9uIHRvIHRoZSBpbmZvIHN0cmluZyBhdCB0aW1lcywKCQkJICogYW5kIHRoaXMgdmFyaWFibGUgZG9lcyBleGFjdGx5IHRoYXQuIFRoaXMgaW5mb3JtYXRpb24gd2lsbCBiZSBhcHBlbmRlZCB0bwoJCQkgKiB0aGUgc0luZm8gKHNJbmZvRW1wdHkgYW5kIHNJbmZvRmlsdGVyZWQgaW4gd2hhdGV2ZXIgY29tYmluYXRpb24gdGhleSBhcmUKCQkJICogYmVpbmcgdXNlZCkgYXQgYWxsIHRpbWVzLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb1Bvc3RGaXgiOiAiQWxsIHJlY29yZHMgc2hvd24gYXJlIGRlcml2ZWQgZnJvbSByZWFsIGluZm9ybWF0aW9uLiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb1Bvc3RGaXgiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERhdGFUYWJsZXMgaGFzIGEgYnVpbGQgaW4gbnVtYmVyIGZvcm1hdHRlciAoZm5Gb3JtYXROdW1iZXIpIHdoaWNoIGlzIHVzZWQKCQkJICogdG8gZm9ybWF0IGxhcmdlIG51bWJlcnMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUgaW5mb3JtYXRpb24uIEJ5CgkJCSAqIGRlZmF1bHQgYSBjb21tYSBpcyB1c2VkLCBidXQgdGhpcyBjYW4gYmUgdHJpdmlhbGx5IGNoYW5nZWQgdG8gYW55CgkJCSAqIGNoYXJhY3RlciB5b3Ugd2lzaCB3aXRoIHRoaXMgcGFyYW1ldGVyLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAsCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb1Rob3VzYW5kcyI6ICInIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNJbmZvVGhvdXNhbmRzIjogIiwiLAoJCQoJCQoJCQkvKioKCQkJICogRGV0YWlsIHRoZSBhY3Rpb24gdGhhdCB3aWxsIGJlIHRha2VuIHdoZW4gdGhlIGRyb3AgZG93biBtZW51IGZvciB0aGUKCQkJICogcGFnaW5hdGlvbiBsZW5ndGggb3B0aW9uIGlzIGNoYW5nZWQuIFRoZSAnX01FTlVfJyB2YXJpYWJsZSBpcyByZXBsYWNlZAoJCQkgKiB3aXRoIGEgZGVmYXVsdCBzZWxlY3QgbGlzdCBvZiAxMCwgMjUsIDUwIGFuZCAxMDAsIGFuZCBjYW4gYmUgcmVwbGFjZWQKCQkJICogd2l0aCBhIGN1c3RvbSBzZWxlY3QgYm94IGlmIHJlcXVpcmVkLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBTaG93IF9NRU5VXyBlbnRyaWVzCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBMYW5ndWFnZSBjaGFuZ2Ugb25seQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTGVuZ3RoTWVudSI6ICJEaXNwbGF5IF9NRU5VXyByZWNvcmRzIgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKiAgICAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIExhbmd1YWdlIGFuZCBvcHRpb25zIGNoYW5nZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTGVuZ3RoTWVudSI6ICdEaXNwbGF5IDxzZWxlY3Q+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMTAiPjEwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMjAiPjIwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMzAiPjMwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNDAiPjQwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNTAiPjUwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iLTEiPkFsbDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzwvc2VsZWN0PiByZWNvcmRzJwoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNMZW5ndGhNZW51IjogIlNob3cgX01FTlVfIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogV2hlbiB1c2luZyBBamF4IHNvdXJjZWQgZGF0YSBhbmQgZHVyaW5nIHRoZSBmaXJzdCBkcmF3IHdoZW4gRGF0YVRhYmxlcyBpcwoJCQkgKiBnYXRoZXJpbmcgdGhlIGRhdGEsIHRoaXMgbWVzc2FnZSBpcyBzaG93biBpbiBhbiBlbXB0eSByb3cgaW4gdGhlIHRhYmxlIHRvCgkJCSAqIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGUgdGhlIGRhdGEgaXMgYmVpbmcgbG9hZGVkLiBOb3RlIHRoYXQgdGhpcwoJCQkgKiBwYXJhbWV0ZXIgaXMgbm90IHVzZWQgd2hlbiBsb2FkaW5nIGRhdGEgYnkgc2VydmVyLXNpZGUgcHJvY2Vzc2luZywganVzdAoJCQkgKiBBamF4IHNvdXJjZWQgZGF0YSB3aXRoIGNsaWVudC1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IExvYWRpbmcuLi4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNMb2FkaW5nUmVjb3JkcyI6ICJQbGVhc2Ugd2FpdCAtIGxvYWRpbmcuLi4iCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0xvYWRpbmdSZWNvcmRzIjogIkxvYWRpbmcuLi4iLAoJCQoJCQoJCQkvKioKCQkJICogVGV4dCB3aGljaCBpcyBkaXNwbGF5ZWQgd2hlbiB0aGUgdGFibGUgaXMgcHJvY2Vzc2luZyBhIHVzZXIgYWN0aW9uCgkJCSAqICh1c3VhbGx5IGEgc29ydCBjb21tYW5kIG9yIHNpbWlsYXIpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBQcm9jZXNzaW5nLi4uCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzUHJvY2Vzc2luZyI6ICJEYXRhVGFibGVzIGlzIGN1cnJlbnRseSBidXN5IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNQcm9jZXNzaW5nIjogIlByb2Nlc3NpbmcuLi4iLAoJCQoJCQoJCQkvKioKCQkJICogRGV0YWlscyB0aGUgYWN0aW9ucyB0aGF0IHdpbGwgYmUgdGFrZW4gd2hlbiB0aGUgdXNlciB0eXBlcyBpbnRvIHRoZQoJCQkgKiBmaWx0ZXJpbmcgaW5wdXQgdGV4dCBib3guIFRoZSB2YXJpYWJsZSAiX0lOUFVUXyIsIGlmIHVzZWQgaW4gdGhlIHN0cmluZywKCQkJICogaXMgcmVwbGFjZWQgd2l0aCB0aGUgSFRNTCB0ZXh0IGJveCBmb3IgdGhlIGZpbHRlcmluZyBpbnB1dCBhbGxvd2luZwoJCQkgKiBjb250cm9sIG92ZXIgd2hlcmUgaXQgYXBwZWFycyBpbiB0aGUgc3RyaW5nLiBJZiAiX0lOUFVUXyIgaXMgbm90IGdpdmVuCgkJCSAqIHRoZW4gdGhlIGlucHV0IGJveCBpcyBhcHBlbmRlZCB0byB0aGUgc3RyaW5nIGF1dG9tYXRpY2FsbHkuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNlYXJjaDoKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIElucHV0IHRleHQgYm94IHdpbGwgYmUgYXBwZW5kZWQgYXQgdGhlIGVuZCBhdXRvbWF0aWNhbGx5CgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNTZWFyY2giOiAiRmlsdGVyIHJlY29yZHM6IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKiAgICAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIFNwZWNpZnkgd2hlcmUgdGhlIGZpbHRlciBzaG91bGQgYXBwZWFyCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNTZWFyY2giOiAiQXBwbHkgZmlsdGVyIF9JTlBVVF8gdG8gdGFibGUiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1NlYXJjaCI6ICJTZWFyY2g6IiwKCQkKCQkKCQkJLyoqCgkJCSAqIEFsbCBvZiB0aGUgbGFuZ3VhZ2UgaW5mb3JtYXRpb24gY2FuIGJlIHN0b3JlZCBpbiBhIGZpbGUgb24gdGhlCgkJCSAqIHNlcnZlci1zaWRlLCB3aGljaCBEYXRhVGFibGVzIHdpbGwgbG9vayB1cCBpZiB0aGlzIHBhcmFtZXRlciBpcyBwYXNzZWQuCgkJCSAqIEl0IG11c3Qgc3RvcmUgdGhlIFVSTCBvZiB0aGUgbGFuZ3VhZ2UgZmlsZSwgd2hpY2ggaXMgaW4gYSBKU09OIGZvcm1hdCwKCQkJICogYW5kIHRoZSBvYmplY3QgaGFzIHRoZSBzYW1lIHByb3BlcnRpZXMgYXMgdGhlIG9MYW5ndWFnZSBvYmplY3QgaW4gdGhlCgkJCSAqIGluaXRpYWxpc2VyIG9iamVjdCAoaS5lLiB0aGUgYWJvdmUgcGFyYW1ldGVycykuIFBsZWFzZSByZWZlciB0byBvbmUgb2YKCQkJICogdGhlIGV4YW1wbGUgbGFuZ3VhZ2UgZmlsZXMgdG8gc2VlIGhvdyB0aGlzIHdvcmtzIGluIGFjdGlvbi4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNVcmwiOiAiaHR0cDovL3d3dy5zcHJ5bWVkaWEuY28udWsvZGF0YVRhYmxlcy9sYW5nLnR4dCIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzVXJsIjogIiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBUZXh0IHNob3duIGluc2lkZSB0aGUgdGFibGUgcmVjb3JkcyB3aGVuIHRoZSBpcyBubyBpbmZvcm1hdGlvbiB0byBiZQoJCQkgKiBkaXNwbGF5ZWQgYWZ0ZXIgZmlsdGVyaW5nLiBzRW1wdHlUYWJsZSBpcyBzaG93biB3aGVuIHRoZXJlIGlzIHNpbXBseSBubwoJCQkgKiBpbmZvcm1hdGlvbiBpbiB0aGUgdGFibGUgYXQgYWxsIChyZWdhcmRsZXNzIG9mIGZpbHRlcmluZykuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IE5vIG1hdGNoaW5nIHJlY29yZHMgZm91bmQKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNaZXJvUmVjb3JkcyI6ICJObyByZWNvcmRzIHRvIGRpc3BsYXkiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1plcm9SZWNvcmRzIjogIk5vIG1hdGNoaW5nIHJlY29yZHMgZm91bmQiCgkJfSwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byBoYXZlIGRlZmluZSB0aGUgZ2xvYmFsIGZpbHRlcmluZyBzdGF0ZSBhdAoJCSAqIGluaXRpYWxpc2F0aW9uIHRpbWUuIEFzIGFuIG9iamVjdCB0aGUgInNTZWFyY2giIHBhcmFtZXRlciBtdXN0IGJlCgkJICogZGVmaW5lZCwgYnV0IGFsbCBvdGhlciBwYXJhbWV0ZXJzIGFyZSBvcHRpb25hbC4gV2hlbiAiYlJlZ2V4IiBpcyB0cnVlLAoJCSAqIHRoZSBzZWFyY2ggc3RyaW5nIHdpbGwgYmUgdHJlYXRlZCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgd2hlbiBmYWxzZQoJCSAqIChkZWZhdWx0KSBpdCB3aWxsIGJlIHRyZWF0ZWQgYXMgYSBzdHJhaWdodCBzdHJpbmcuIFdoZW4gImJTbWFydCIKCQkgKiBEYXRhVGFibGVzIHdpbGwgdXNlIGl0J3Mgc21hcnQgZmlsdGVyaW5nIG1ldGhvZHMgKHRvIHdvcmQgbWF0Y2ggYXQKCQkgKiBhbnkgcG9pbnQgaW4gdGhlIGRhdGEpLCB3aGVuIGZhbHNlIHRoaXMgd2lsbCBub3QgYmUgZG9uZS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAZXh0ZW5kcyBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2gKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAib1NlYXJjaCI6IHsic1NlYXJjaCI6ICJJbml0aWFsIHNlYXJjaCJ9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJIm9TZWFyY2giOiAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCApLAoJCgkKCQkvKioKCQkgKiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgd2lsbCBsb29rIGZvciB0aGUgcHJvcGVydHkgJ2FhRGF0YScgd2hlbiBvYnRhaW5pbmcKCQkgKiBkYXRhIGZyb20gYW4gQWpheCBzb3VyY2Ugb3IgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgLSB0aGlzIHBhcmFtZXRlcgoJCSAqIGFsbG93cyB0aGF0IHByb3BlcnR5IHRvIGJlIGNoYW5nZWQuIFlvdSBjYW4gdXNlIEphdmFzY3JpcHQgZG90dGVkIG9iamVjdAoJCSAqIG5vdGF0aW9uIHRvIGdldCBhIGRhdGEgc291cmNlIGZvciBtdWx0aXBsZSBsZXZlbHMgb2YgbmVzdGluZy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGFhRGF0YQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBHZXQgZGF0YSBmcm9tIHsgImRhdGEiOiBbLi4uXSB9CgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RhdGEudHh0IiwKCQkgKiAgICAgICAgInNBamF4RGF0YVByb3AiOiAiZGF0YSIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogeyAiaW5uZXIiOiBbLi4uXSB9IH0KCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNvdXJjZXMvZGF0YS50eHQiLAoJCSAqICAgICAgICAic0FqYXhEYXRhUHJvcCI6ICJkYXRhLmlubmVyIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0FqYXhEYXRhUHJvcCI6ICJhYURhdGEiLAoJCgkKCQkvKioKCQkgKiBZb3UgY2FuIGluc3RydWN0IERhdGFUYWJsZXMgdG8gbG9hZCBkYXRhIGZyb20gYW4gZXh0ZXJuYWwgc291cmNlIHVzaW5nIHRoaXMKCQkgKiBwYXJhbWV0ZXIgKHVzZSBhRGF0YSBpZiB5b3Ugd2FudCB0byBwYXNzIGRhdGEgaW4geW91IGFscmVhZHkgaGF2ZSkuIFNpbXBseQoJCSAqIHByb3ZpZGUgYSB1cmwgYSBKU09OIG9iamVjdCBjYW4gYmUgb2J0YWluZWQgZnJvbS4gVGhpcyBvYmplY3QgbXVzdCBpbmNsdWRlCgkJICogdGhlIHBhcmFtZXRlciAnYWFEYXRhJyB3aGljaCBpcyB0aGUgZGF0YSBzb3VyY2UgZm9yIHRoZSB0YWJsZS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogImh0dHA6Ly93d3cuc3ByeW1lZGlhLmNvLnVrL2RhdGFUYWJsZXMvanNvbi5waHAiCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJInNBamF4U291cmNlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgY2FuIGJlIHVzZWQgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgcHJlZml4IHRoYXQgRGF0YVRhYmxlcwoJCSAqIGFzc2lnbnMgdG8gYSBjb29raWUgd2hlbiBzdGF0ZSBzYXZpbmcgaXMgZW5hYmxlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IFNwcnlNZWRpYV9EYXRhVGFibGVzXwoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQ29va2llUHJlZml4IjogIm15X2RhdGF0YWJsZV8iLAoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0Nvb2tpZVByZWZpeCI6ICJTcHJ5TWVkaWFfRGF0YVRhYmxlc18iLAoJCgkKCQkvKioKCQkgKiBUaGlzIGluaXRpYWxpc2F0aW9uIHZhcmlhYmxlIGFsbG93cyB5b3UgdG8gc3BlY2lmeSBleGFjdGx5IHdoZXJlIGluIHRoZQoJCSAqIERPTSB5b3Ugd2FudCBEYXRhVGFibGVzIHRvIGluamVjdCB0aGUgdmFyaW91cyBjb250cm9scyBpdCBhZGRzIHRvIHRoZSBwYWdlCgkJICogKGZvciBleGFtcGxlIHlvdSBtaWdodCB3YW50IHRoZSBwYWdpbmF0aW9uIGNvbnRyb2xzIGF0IHRoZSB0b3Agb2YgdGhlCgkJICogdGFibGUpLiBESVYgZWxlbWVudHMgKHdpdGggb3Igd2l0aG91dCBhIGN1c3RvbSBjbGFzcykgY2FuIGFsc28gYmUgYWRkZWQgdG8KCQkgKiBhaWQgc3R5bGluZy4gVGhlIGZvbGxvdyBzeW50YXggaXMgdXNlZDoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgb3B0aW9ucyBhcmUgYWxsb3dlZDoJCgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPidsJyAtIExlbmd0aCBjaGFuZ2luZzwvbGkKCQkgKiAgICAgICAgIDxsaT4nZicgLSBGaWx0ZXJpbmcgaW5wdXQ8L2xpPgoJCSAqICAgICAgICAgPGxpPid0JyAtIFRoZSB0YWJsZSE8L2xpPgoJCSAqICAgICAgICAgPGxpPidpJyAtIEluZm9ybWF0aW9uPC9saT4KCQkgKiAgICAgICAgIDxsaT4ncCcgLSBQYWdpbmF0aW9uPC9saT4KCQkgKiAgICAgICAgIDxsaT4ncicgLSBwUm9jZXNzaW5nPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+VGhlIGZvbGxvd2luZyBjb25zdGFudHMgYXJlIGFsbG93ZWQ6CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPidIJyAtIGpRdWVyeVVJIHRoZW1lICJoZWFkZXIiIGNsYXNzZXMgKCdmZy10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLXRsIHVpLWNvcm5lci10ciB1aS1oZWxwZXItY2xlYXJmaXgnKTwvbGk+CgkJICogICAgICAgICA8bGk+J0YnIC0galF1ZXJ5VUkgdGhlbWUgImZvb3RlciIgY2xhc3NlcyAoJ2ZnLXRvb2xiYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYmwgdWktY29ybmVyLWJyIHVpLWhlbHBlci1jbGVhcmZpeCcpPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+VGhlIGZvbGxvd2luZyBzeW50YXggaXMgZXhwZWN0ZWQ6CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPicmbHQ7JyBhbmQgJyZndDsnIC0gZGl2IGVsZW1lbnRzPC9saT4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyJjbGFzcyIgYW5kICcmZ3Q7JyAtIGRpdiB3aXRoIGEgY2xhc3M8L2xpPgoJCSAqICAgICAgICAgPGxpPicmbHQ7IiNpZCIgYW5kICcmZ3Q7JyAtIGRpdiB3aXRoIGFuIElEPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+RXhhbXBsZXM6CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPicmbHQ7IndyYXBwZXIiZmxpcHQmZ3Q7JzwvbGk+CgkJICogICAgICAgICA8bGk+JyZsdDtsZiZsdDt0Jmd0O2lwJmd0Oyc8L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbGZydGlwIDxpPih3aGVuIGJKUXVlcnlVSSBpcyBmYWxzZSk8L2k+IDxiPm9yPC9iPiAKCQkgKiAgICA8IkgibGZyPnQ8IkYiaXA+IDxpPih3aGVuIGJKUXVlcnlVSSBpcyB0cnVlKTwvaT4KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0RvbSI6ICcmbHQ7InRvcCJpJmd0O3J0Jmx0OyJib3R0b20iZmxwJmd0OyZsdDsiY2xlYXIiJmd0OycKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNEb20iOiAibGZydGlwIiwKCQoJCgkJLyoqCgkJICogRGF0YVRhYmxlcyBmZWF0dXJlcyB0d28gZGlmZmVyZW50IGJ1aWx0LWluIHBhZ2luYXRpb24gaW50ZXJhY3Rpb24gbWV0aG9kcwoJCSAqICgndHdvX2J1dHRvbicgb3IgJ2Z1bGxfbnVtYmVycycpIHdoaWNoIHByZXNlbnQgZGlmZmVyZW50IHBhZ2UgY29udHJvbHMgdG8KCQkgKiB0aGUgZW5kIHVzZXIuIEZ1cnRoZXIgbWV0aG9kcyBjYW4gYmUgYWRkZWQgdXNpbmcgdGhlIEFQSSAoc2VlIGJlbG93KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IHR3b19idXR0b24KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1BhZ2luYXRpb25UeXBlIjogImZ1bGxfbnVtYmVycyIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkic1BhZ2luYXRpb25UeXBlIjogInR3b19idXR0b24iLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgaG9yaXpvbnRhbCBzY3JvbGxpbmcuIFdoZW4gYSB0YWJsZSBpcyB0b28gd2lkZSB0byBmaXQgaW50byBhIGNlcnRhaW4KCQkgKiBsYXlvdXQsIG9yIHlvdSBoYXZlIGEgbGFyZ2UgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIHRhYmxlLCB5b3UgY2FuIGVuYWJsZQoJCSAqIHgtc2Nyb2xsaW5nIHRvIHNob3cgdGhlIHRhYmxlIGluIGEgdmlld3BvcnQsIHdoaWNoIGNhbiBiZSBzY3JvbGxlZC4gVGhpcwoJCSAqIHByb3BlcnR5IGNhbiBiZSBhbnkgQ1NTIHVuaXQsIG9yIGEgbnVtYmVyIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZAoJCSAqIGFzIGEgcGl4ZWwgbWVhc3VyZW1lbnQpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+Ymxhbmsgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxYIjogIjEwMCUiLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1Njcm9sbFgiOiAiIiwKCQoJCgkJLyoqCgkJICogVGhpcyBwcm9wZXJ0eSBjYW4gYmUgdXNlZCB0byBmb3JjZSBhIERhdGFUYWJsZSB0byB1c2UgbW9yZSB3aWR0aCB0aGFuIGl0CgkJICogbWlnaHQgb3RoZXJ3aXNlIGRvIHdoZW4geC1zY3JvbGxpbmcgaXMgZW5hYmxlZC4gRm9yIGV4YW1wbGUgaWYgeW91IGhhdmUgYQoJCSAqIHRhYmxlIHdoaWNoIHJlcXVpcmVzIHRvIGJlIHdlbGwgc3BhY2VkLCB0aGlzIHBhcmFtZXRlciBpcyB1c2VmdWwgZm9yCgkJICogIm92ZXItc2l6aW5nIiB0aGUgdGFibGUsIGFuZCB0aHVzIGZvcmNpbmcgc2Nyb2xsaW5nLiBUaGlzIHByb3BlcnR5IGNhbiBieQoJCSAqIGFueSBDU1MgdW5pdCwgb3IgYSBudW1iZXIgKGluIHdoaWNoIGNhc2UgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgcGl4ZWwKCQkgKiBtZWFzdXJlbWVudCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5ibGFuayBzdHJpbmcgLSBpLmUuIGRpc2FibGVkPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWCI6ICIxMDAlIiwKCQkgKiAgICAgICAgInNTY3JvbGxYSW5uZXIiOiAiMTEwJSIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTY3JvbGxYSW5uZXIiOiAiIiwKCQoJCgkJLyoqCgkJICogRW5hYmxlIHZlcnRpY2FsIHNjcm9sbGluZy4gVmVydGljYWwgc2Nyb2xsaW5nIHdpbGwgY29uc3RyYWluIHRoZSBEYXRhVGFibGUKCQkgKiB0byB0aGUgZ2l2ZW4gaGVpZ2h0LCBhbmQgZW5hYmxlIHNjcm9sbGluZyBmb3IgYW55IGRhdGEgd2hpY2ggb3ZlcmZsb3dzIHRoZQoJCSAqIGN1cnJlbnQgdmlld3BvcnQuIFRoaXMgY2FuIGJlIHVzZWQgYXMgYW4gYWx0ZXJuYXRpdmUgdG8gcGFnaW5nIHRvIGRpc3BsYXkKCQkgKiBhIGxvdCBvZiBkYXRhIGluIGEgc21hbGwgYXJlYSAoYWx0aG91Z2ggcGFnaW5nIGFuZCBzY3JvbGxpbmcgY2FuIGJvdGggYmUKCQkgKiBlbmFibGVkIGF0IHRoZSBzYW1lIHRpbWUpLiBUaGlzIHByb3BlcnR5IGNhbiBiZSBhbnkgQ1NTIHVuaXQsIG9yIGEgbnVtYmVyCgkJICogKGluIHdoaWNoIGNhc2UgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgcGl4ZWwgbWVhc3VyZW1lbnQpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+Ymxhbmsgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWSI6ICIiLAoJCgkKCQkvKioKCQkgKiBTZXQgdGhlIEhUVFAgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBtYWtlIHRoZSBBamF4IGNhbGwgZm9yIHNlcnZlci1zaWRlCgkJICogcHJvY2Vzc2luZyBvciBBamF4IHNvdXJjZWQgZGF0YS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IEdFVAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9wb3N0LnBocCIsCgkJICogICAgICAgICJzU2VydmVyTWV0aG9kIjogIlBPU1QiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2VydmVyTWV0aG9kIjogIkdFVCIKCX07CgkKCQoJCgkvKioKCSAqIENvbHVtbiBvcHRpb25zIHRoYXQgY2FuIGJlIGdpdmVuIHRvIERhdGFUYWJsZXMgYXQgaW5pdGlhbGlzYXRpb24gdGltZS4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zID0gewoJCS8qKgoJCSAqIEFsbG93cyBhIGNvbHVtbidzIHNvcnRpbmcgdG8gdGFrZSBtdWx0aXBsZSBjb2x1bW5zIGludG8gYWNjb3VudCB3aGVuIAoJCSAqIGRvaW5nIGEgc29ydC4gRm9yIGV4YW1wbGUgZmlyc3QgbmFtZSAvIGxhc3QgbmFtZSBjb2x1bW5zIG1ha2Ugc2Vuc2UgdG8gCgkJICogZG8gYSBtdWx0aS1jb2x1bW4gc29ydCBvdmVyIHRoZSB0d28gY29sdW1ucy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5UYWtlcyB0aGUgdmFsdWUgb2YgdGhlIGNvbHVtbiBpbmRleCBhdXRvbWF0aWNhbGx5PC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAwLCAxIF0sICJhVGFyZ2V0cyI6IFsgMCBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAxLCAwIF0sICJhVGFyZ2V0cyI6IFsgMSBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAyLCAzLCA0IF0sICJhVGFyZ2V0cyI6IFsgMiBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAxLCAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJhRGF0YVNvcnQiOiBbIDIsIDMsIDQgXSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhRGF0YVNvcnQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBZb3UgY2FuIGNvbnRyb2wgdGhlIGRlZmF1bHQgc29ydGluZyBkaXJlY3Rpb24sIGFuZCBldmVuIGFsdGVyIHRoZSBiZWhhdmlvdXIKCQkgKiBvZiB0aGUgc29ydCBoYW5kbGVyIChpLmUuIG9ubHkgYWxsb3cgYXNjZW5kaW5nIHNvcnRpbmcgZXRjKSB1c2luZyB0aGlzCgkJICogcGFyYW1ldGVyLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbICdhc2MnLCAnZGVzYycgXQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAiYXNTb3J0aW5nIjogWyAiYXNjIiBdLCAiYVRhcmdldHMiOiBbIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiLCAiYXNjIiwgImFzYyIgXSwgImFUYXJnZXRzIjogWyAyIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiBdLCAiYVRhcmdldHMiOiBbIDMgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImFzYyIgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiLCAiYXNjIiwgImFzYyIgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiIF0gfSwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFzU29ydGluZyI6IFsgJ2FzYycsICdkZXNjJyBdLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBmaWx0ZXJpbmcgb24gdGhlIGRhdGEgaW4gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTZWFyY2hhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTZWFyY2hhYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNlYXJjaGFibGUiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBzb3J0aW5nIG9uIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJiU29ydGFibGUiOiBmYWxzZSwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRhYmxlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB1c2luZyBmblJlbmRlcigpIGZvciBhIGNvbHVtbiwgeW91IG1heSB3aXNoIHRvIHVzZSB0aGUgb3JpZ2luYWwgZGF0YQoJCSAqIChiZWZvcmUgcmVuZGVyaW5nKSBmb3Igc29ydGluZyBhbmQgZmlsdGVyaW5nICh0aGUgZGVmYXVsdCBpcyB0byB1c2VkIHRoZQoJCSAqIHJlbmRlcmVkIGRhdGEgdGhhdCB0aGUgdXNlciBjYW4gc2VlKS4gVGhpcyBtYXkgYmUgdXNlZnVsIGZvciBkYXRlcyBldGMuCgkJICogCgkJICogKk5PVEUqIFRoaXMgcHJvcGVydHkgaXMgbm93IGRlcHJlY2F0ZWQsIGFuZCBpdCBpcyBzdWdnZXN0ZWQgdGhhdCB5b3UgdXNlCgkJICogbURhdGEgYW5kIC8gb3IgbVJlbmRlciB0byByZW5kZXIgZGF0YSBmb3IgdGhlIERhdGFUYWJsZS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogIEBkZXByZWNhdGVkCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImZuUmVuZGVyIjogZnVuY3Rpb24gKCBvT2JqICkgewoJCSAqICAgICAgICAgICAgICByZXR1cm4gb09iai5hRGF0YVswXSArJyAnKyBvT2JqLmFEYXRhWzNdOwoJCSAqICAgICAgICAgICAgfSwKCQkgKiAgICAgICAgICAgICJiVXNlUmVuZGVyZWQiOiBmYWxzZSwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UKCQkgKiAgICAgICAgICB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJWaXNpYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJWaXNpYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlZpc2libGUiOiB0cnVlLAoJCQoJCQoJCS8qKgoJCSAqIERldmVsb3BlciBkZWZpbmFibGUgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbmV2ZXIgYSBjZWxsIGlzIGNyZWF0ZWQgKEFqYXggc291cmNlLAoJCSAqIGV0Yykgb3IgcHJvY2Vzc2VkIGZvciBpbnB1dCAoRE9NIHNvdXJjZSkuIFRoaXMgY2FuIGJlIHVzZWQgYXMgYSBjb21wbGltZW50IHRvIGZuUmVuZGVyCgkJICogYWxsb3dpbmcgeW91IHRvIG1vZGlmeSB0aGUgRE9NIGVsZW1lbnQgKGFkZCBiYWNrZ3JvdW5kIGNvbG91ciBmb3IgZXhhbXBsZSkgd2hlbiB0aGUKCQkgKiBlbGVtZW50IGlzIGF2YWlsYWJsZSAoc2luY2UgaXQgaXMgbm90IHdoZW4gZm5SZW5kZXIgaXMgY2FsbGVkKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtlbGVtZW50fSBuVGQgVGhlIFREIG5vZGUgdGhhdCBoYXMgYmVlbiBjcmVhdGVkCgkJICogIEBwYXJhbSB7Kn0gc0RhdGEgVGhlIERhdGEgZm9yIHRoZSBjZWxsCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBmb3IgdGhlIHdob2xlIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBUaGUgcm93IGluZGV4IGZvciB0aGUgYW9EYXRhIGRhdGEgc3RvcmUKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgVGhlIGNvbHVtbiBpbmRleCBmb3IgYW9Db2x1bW5zCgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFszXSwKCQkgKiAgICAgICAgICAiZm5DcmVhdGVkQ2VsbCI6IGZ1bmN0aW9uIChuVGQsIHNEYXRhLCBvRGF0YSwgaVJvdywgaUNvbCkgewoJCSAqICAgICAgICAgICAgaWYgKCBzRGF0YSA9PSAiMS43IiApIHsKCQkgKiAgICAgICAgICAgICAgJChuVGQpLmNzcygnY29sb3InLCAnYmx1ZScpCgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9IF0KCQkgKiAgICAgIH0pOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCBpbgoJCSAqIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBPYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhUm93IFRoZSByb3cgaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhQ29sdW1uIFRoZSBjb2x1bW4gaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gIG8uYURhdGEgVGhlIGRhdGEgZm9yIHRoZSByb3cgaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8ub1NldHRpbmdzIFRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgRGF0YVRhYmxlcyBpbnN0YW5jZQoJCSAqICBAcGFyYW0ge29iamVjdH0gby5tRGF0YVByb3AgVGhlIGRhdGEgcHJvcGVydHkgdXNlZCBmb3IgdGhpcyBjb2x1bW4KCQkgKiAgQHBhcmFtIHsqfSAgICAgIHZhbCBUaGUgY3VycmVudCBjZWxsIHZhbHVlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggbywgdmFsICkgewoJCSAqICAgICAgICAgICAgICByZXR1cm4gby5hRGF0YVswXSArJyAnKyBvLmFEYXRhWzNdOwoJCSAqICAgICAgICAgICAgfSwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgImZuUmVuZGVyIjogZnVuY3Rpb24gKCBvLCB2YWwgKSB7CgkJICogICAgICAgICAgICByZXR1cm4gby5hRGF0YVswXSArJyAnKyBvLmFEYXRhWzNdOwoJCSAqICAgICAgICAgIH0gfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUmVuZGVyIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhlIGNvbHVtbiBpbmRleCAoc3RhcnRpbmcgZnJvbSAwISkgdGhhdCB5b3Ugd2lzaCBhIHNvcnQgdG8gYmUgcGVyZm9ybWVkCgkJICogdXBvbiB3aGVuIHRoaXMgY29sdW1uIGlzIHNlbGVjdGVkIGZvciBzb3J0aW5nLiBUaGlzIGNhbiBiZSB1c2VkIGZvciBzb3J0aW5nCgkJICogb24gaGlkZGVuIGNvbHVtbnMgZm9yIGV4YW1wbGUuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAtMSA8aT5Vc2UgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGNvbHVtbiBpbmRleDwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiaURhdGFTb3J0IjogMSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiaURhdGFTb3J0IjogLTEsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGhhcyBiZWVuIHJlcGxhY2VkIGJ5IG1EYXRhIGluIERhdGFUYWJsZXMgdG8gZW5zdXJlIG5hbWluZwoJCSAqIGNvbnNpc3RlbmN5LiBtRGF0YVByb3AgY2FuIHN0aWxsIGJlIHVzZWQsIGFzIHRoZXJlIGlzIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CgkJICogaW4gRGF0YVRhYmxlcyBmb3IgdGhpcyBvcHRpb24sIGJ1dCBpdCBpcyBzdHJvbmdseSByZWNvbW1lbmRlZCB0aGF0IHlvdSB1c2UKCQkgKiBtRGF0YSBpbiBwcmVmZXJlbmNlIHRvIG1EYXRhUHJvcC4KCQkgKiAgQG5hbWUgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnMubURhdGFQcm9wCgkJICovCgkKCQoJCS8qKgoJCSAqIFRoaXMgcHJvcGVydHkgY2FuIGJlIHVzZWQgdG8gcmVhZCBkYXRhIGZyb20gYW55IEpTT04gZGF0YSBzb3VyY2UgcHJvcGVydHksCgkJICogaW5jbHVkaW5nIGRlZXBseSBuZXN0ZWQgb2JqZWN0cyAvIHByb3BlcnRpZXMuIG1EYXRhIGNhbiBiZSBnaXZlbiBpbiBhCgkJICogbnVtYmVyIG9mIGRpZmZlcmVudCB3YXlzIHdoaWNoIGVmZmVjdCBpdHMgYmVoYXZpb3VyOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+aW50ZWdlciAtIHRyZWF0ZWQgYXMgYW4gYXJyYXkgaW5kZXggZm9yIHRoZSBkYXRhIHNvdXJjZS4gVGhpcyBpcyB0aGUKCQkgKiAgICAgICBkZWZhdWx0IHRoYXQgRGF0YVRhYmxlcyB1c2VzIChpbmNyZW1lbnRhbGx5IGluY3JlYXNlZCBmb3IgZWFjaCBjb2x1bW4pLjwvbGk+CgkJICogICAgIDxsaT5zdHJpbmcgLSByZWFkIGFuIG9iamVjdCBwcm9wZXJ0eSBmcm9tIHRoZSBkYXRhIHNvdXJjZS4gTm90ZSB0aGF0IHlvdSBjYW4KCQkgKiAgICAgICB1c2UgSmF2YXNjcmlwdCBkb3R0ZWQgbm90YXRpb24gdG8gcmVhZCBkZWVwIHByb3BlcnRpZXMgLyBhcnJheXMgZnJvbSB0aGUKCQkgKiAgICAgICBkYXRhIHNvdXJjZS48L2xpPgoJCSAqICAgICA8bGk+bnVsbCAtIHRoZSBzRGVmYXVsdENvbnRlbnQgb3B0aW9uIHdpbGwgYmUgdXNlZCBmb3IgdGhlIGNlbGwgKG51bGwKCQkgKiAgICAgICBieSBkZWZhdWx0LCBzbyB5b3Ugd2lsbCBuZWVkIHRvIHNwZWNpZnkgdGhlIGRlZmF1bHQgY29udGVudCB5b3Ugd2FudCAtCgkJICogICAgICAgdHlwaWNhbGx5IGFuIGVtcHR5IHN0cmluZykuIFRoaXMgY2FuIGJlIHVzZWZ1bCBvbiBnZW5lcmF0ZWQgY29sdW1ucyBzdWNoIAoJCSAqICAgICAgIGFzIGVkaXQgLyBkZWxldGUgYWN0aW9uIGNvbHVtbnMuPC9saT4KCQkgKiAgICAgPGxpPmZ1bmN0aW9uIC0gdGhlIGZ1bmN0aW9uIGdpdmVuIHdpbGwgYmUgZXhlY3V0ZWQgd2hlbmV2ZXIgRGF0YVRhYmxlcyAKCQkgKiAgICAgICBuZWVkcyB0byBzZXQgb3IgZ2V0IHRoZSBkYXRhIGZvciBhIGNlbGwgaW4gdGhlIGNvbHVtbi4gVGhlIGZ1bmN0aW9uIAoJCSAqICAgICAgIHRha2VzIHRocmVlIHBhcmFtZXRlcnM6CgkJICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnthcnJheXxvYmplY3R9IFRoZSBkYXRhIHNvdXJjZSBmb3IgdGhlIHJvdzwvbGk+CgkJICogICAgICAgICA8bGk+e3N0cmluZ30gVGhlIHR5cGUgY2FsbCBkYXRhIHJlcXVlc3RlZCAtIHRoaXMgd2lsbCBiZSAnc2V0JyB3aGVuCgkJICogICAgICAgICAgIHNldHRpbmcgZGF0YSBvciAnZmlsdGVyJywgJ2Rpc3BsYXknLCAndHlwZScsICdzb3J0JyBvciB1bmRlZmluZWQgd2hlbiAKCQkgKiAgICAgICAgICAgZ2F0aGVyaW5nIGRhdGEuIE5vdGUgdGhhdCB3aGVuIDxpPnVuZGVmaW5lZDwvaT4gaXMgZ2l2ZW4gZm9yIHRoZSB0eXBlCgkJICogICAgICAgICAgIERhdGFUYWJsZXMgZXhwZWN0cyB0byBnZXQgdGhlIHJhdyBkYXRhIGZvciB0aGUgb2JqZWN0IGJhY2s8L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIHNldCB3aGVuIHRoZSBzZWNvbmQgcGFyYW1ldGVyIGlzICdzZXQnLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgICBUaGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uIGlzIG5vdCByZXF1aXJlZCB3aGVuICdzZXQnIGlzIHRoZSB0eXBlCgkJICogICAgICAgb2YgY2FsbCwgYnV0IG90aGVyd2lzZSB0aGUgcmV0dXJuIGlzIHdoYXQgd2lsbCBiZSB1c2VkIGZvciB0aGUgZGF0YQoJCSAqICAgICAgIHJlcXVlc3RlZC48L2xpPgoJCSAqICAgIDwvdWw+CgkJICoKCQkgKiBOb3RlIHRoYXQgcHJpb3IgdG8gRGF0YVRhYmxlcyAxLjkuMiBtRGF0YSB3YXMgY2FsbGVkIG1EYXRhUHJvcC4gVGhlIG5hbWUgY2hhbmdlCgkJICogcmVmbGVjdHMgdGhlIGZsZXhpYmlsaXR5IG9mIHRoaXMgcHJvcGVydHkgYW5kIGlzIGNvbnNpc3RlbnQgd2l0aCB0aGUgbmFtaW5nIG9mCgkJICogbVJlbmRlci4gSWYgJ21EYXRhUHJvcCcgaXMgZ2l2ZW4sIHRoZW4gaXQgd2lsbCBzdGlsbCBiZSB1c2VkIGJ5IERhdGFUYWJsZXMsIGFzCgkJICogaXQgYXV0b21hdGljYWxseSBtYXBzIHRoZSBvbGQgbmFtZSB0byB0aGUgbmV3IGlmIHJlcXVpcmVkLgoJCSAqICBAdHlwZSBzdHJpbmd8aW50fGZ1bmN0aW9ufG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5Vc2UgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGNvbHVtbiBpbmRleDwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSZWFkIHRhYmxlIGRhdGEgZnJvbSBvYmplY3RzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RlZXAudHh0IiwKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsKCQkgKiAgICAgICAgICB7ICJtRGF0YSI6ICJlbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAibURhdGEiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YSI6ICJwbGF0Zm9ybS5pbm5lciIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YSI6ICJwbGF0Zm9ybS5kZXRhaWxzLjAiIH0sCgkJICogICAgICAgICAgeyAibURhdGEiOiAicGxhdGZvcm0uZGV0YWlscy4xIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgbURhdGEgYXMgYSBmdW5jdGlvbiB0byBwcm92aWRlIGRpZmZlcmVudCBpbmZvcm1hdGlvbiBmb3IKCQkgKiAgICAvLyBzb3J0aW5nLCBmaWx0ZXJpbmcgYW5kIGRpc3BsYXkuIEluIHRoaXMgY2FzZSwgY3VycmVuY3kgKHByaWNlKQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0sCgkJICogICAgICAgICAgIm1EYXRhIjogZnVuY3Rpb24gKCBzb3VyY2UsIHR5cGUsIHZhbCApIHsKCQkgKiAgICAgICAgICAgIGlmICh0eXBlID09PSAnc2V0JykgewoJCSAqICAgICAgICAgICAgICBzb3VyY2UucHJpY2UgPSB2YWw7CgkJICogICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBjb21wdXRlZCBkaXNsYXkgYW5kIGZpbHRlciB2YWx1ZXMgZm9yIGVmZmljaWVuY3kKCQkgKiAgICAgICAgICAgICAgc291cmNlLnByaWNlX2Rpc3BsYXkgPSB2YWw9PSIiID8gIiIgOiAiJCIrbnVtYmVyRm9ybWF0KHZhbCk7CgkJICogICAgICAgICAgICAgIHNvdXJjZS5wcmljZV9maWx0ZXIgID0gdmFsPT0iIiA/ICIiIDogIiQiK251bWJlckZvcm1hdCh2YWwpKyIgIit2YWw7CgkJICogICAgICAgICAgICAgIHJldHVybjsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdkaXNwbGF5JykgewoJCSAqICAgICAgICAgICAgICByZXR1cm4gc291cmNlLnByaWNlX2Rpc3BsYXk7CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnZmlsdGVyJykgewoJCSAqICAgICAgICAgICAgICByZXR1cm4gc291cmNlLnByaWNlX2ZpbHRlcjsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgIC8vICdzb3J0JywgJ3R5cGUnIGFuZCB1bmRlZmluZWQgYWxsIGp1c3QgdXNlIHRoZSBpbnRlZ2VyCgkJICogICAgICAgICAgICByZXR1cm4gc291cmNlLnByaWNlOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfSBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJtRGF0YSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgcHJvcGVydHkgaXMgdGhlIHJlbmRlcmluZyBwYXJ0bmVyIHRvIG1EYXRhIGFuZCBpdCBpcyBzdWdnZXN0ZWQgdGhhdAoJCSAqIHdoZW4geW91IHdhbnQgdG8gbWFuaXB1bGF0ZSBkYXRhIGZvciBkaXNwbGF5IChpbmNsdWRpbmcgZmlsdGVyaW5nLCBzb3J0aW5nIGV0YykKCQkgKiBidXQgbm90IGFsdGVyaW5nIHRoZSB1bmRlcmx5aW5nIGRhdGEgZm9yIHRoZSB0YWJsZSwgdXNlIHRoaXMgcHJvcGVydHkuIG1EYXRhCgkJICogY2FuIGFjdHVhbGx5IGRvIGV2ZXJ5dGhpbmcgdGhpcyBwcm9wZXJ0eSBjYW4gYW5kIG1vcmUsIGJ1dCB0aGlzIHBhcmFtZXRlciBpcwoJCSAqIGVhc2llciB0byB1c2Ugc2luY2UgdGhlcmUgaXMgbm8gJ3NldCcgb3B0aW9uLiBMaWtlIG1EYXRhIGlzIGNhbiBiZSBnaXZlbgoJCSAqIGluIGEgbnVtYmVyIG9mIGRpZmZlcmVudCB3YXlzIHRvIGVmZmVjdCBpdHMgYmVoYXZpb3VyLCB3aXRoIHRoZSBhZGRpdGlvbiBvZiAKCQkgKiBzdXBwb3J0aW5nIGFycmF5IHN5bnRheCBmb3IgZWFzeSBvdXRwdXR0aW5nIG9mIGFycmF5cyAoaW5jbHVkaW5nIGFycmF5cyBvZgoJCSAqIG9iamVjdHMpOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+aW50ZWdlciAtIHRyZWF0ZWQgYXMgYW4gYXJyYXkgaW5kZXggZm9yIHRoZSBkYXRhIHNvdXJjZS4gVGhpcyBpcyB0aGUKCQkgKiAgICAgICBkZWZhdWx0IHRoYXQgRGF0YVRhYmxlcyB1c2VzIChpbmNyZW1lbnRhbGx5IGluY3JlYXNlZCBmb3IgZWFjaCBjb2x1bW4pLjwvbGk+CgkJICogICAgIDxsaT5zdHJpbmcgLSByZWFkIGFuIG9iamVjdCBwcm9wZXJ0eSBmcm9tIHRoZSBkYXRhIHNvdXJjZS4gTm90ZSB0aGF0IHlvdSBjYW4KCQkgKiAgICAgICB1c2UgSmF2YXNjcmlwdCBkb3R0ZWQgbm90YXRpb24gdG8gcmVhZCBkZWVwIHByb3BlcnRpZXMgLyBhcnJheXMgZnJvbSB0aGUKCQkgKiAgICAgICBkYXRhIHNvdXJjZSBhbmQgYWxzbyBhcnJheSBicmFja2V0cyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBkYXRhIHJlYWRlciBzaG91bGQKCQkgKiAgICAgICBsb29wIG92ZXIgdGhlIGRhdGEgc291cmNlIGFycmF5LiBXaGVuIGNoYXJhY3RlcnMgYXJlIGdpdmVuIGJldHdlZW4gdGhlIGFycmF5CgkJICogICAgICAgYnJhY2tldHMsIHRoZXNlIGNoYXJhY3RlcnMgYXJlIHVzZWQgdG8gam9pbiB0aGUgZGF0YSBzb3VyY2UgYXJyYXkgdG9nZXRoZXIuCgkJICogICAgICAgRm9yIGV4YW1wbGU6ICJhY2NvdW50c1ssIF0ubmFtZSIgd291bGQgcmVzdWx0IGluIGEgY29tbWEgc2VwYXJhdGVkIGxpc3Qgd2l0aAoJCSAqICAgICAgIHRoZSAnbmFtZScgdmFsdWUgZnJvbSB0aGUgJ2FjY291bnRzJyBhcnJheSBvZiBvYmplY3RzLjwvbGk+CgkJICogICAgIDxsaT5mdW5jdGlvbiAtIHRoZSBmdW5jdGlvbiBnaXZlbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW5ldmVyIERhdGFUYWJsZXMgCgkJICogICAgICAgbmVlZHMgdG8gc2V0IG9yIGdldCB0aGUgZGF0YSBmb3IgYSBjZWxsIGluIHRoZSBjb2x1bW4uIFRoZSBmdW5jdGlvbiAKCQkgKiAgICAgICB0YWtlcyB0aHJlZSBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSByb3cgKGJhc2VkIG9uIG1EYXRhKTwvbGk+CgkJICogICAgICAgICA8bGk+e3N0cmluZ30gVGhlIHR5cGUgY2FsbCBkYXRhIHJlcXVlc3RlZCAtIHRoaXMgd2lsbCBiZSAnZmlsdGVyJywgJ2Rpc3BsYXknLCAKCQkgKiAgICAgICAgICAgJ3R5cGUnIG9yICdzb3J0Jy48L2xpPgoJCSAqICAgICAgICAgPGxpPnthcnJheXxvYmplY3R9IFRoZSBmdWxsIGRhdGEgc291cmNlIGZvciB0aGUgcm93IChub3QgYmFzZWQgb24gbURhdGEpPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICAgIFRoZSByZXR1cm4gdmFsdWUgZnJvbSB0aGUgZnVuY3Rpb24gaXMgd2hhdCB3aWxsIGJlIHVzZWQgZm9yIHRoZSBkYXRhCgkJICogICAgICAgcmVxdWVzdGVkLjwvbGk+CgkJICogICAgPC91bD4KCQkgKiAgQHR5cGUgc3RyaW5nfGludHxmdW5jdGlvbnxudWxsCgkJICogIEBkZWZhdWx0IG51bGwgPGk+VXNlIG1EYXRhPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIENyZWF0ZSBhIGNvbW1hIHNlcGFyYXRlZCBsaXN0IGZyb20gYW4gYXJyYXkgb2Ygb2JqZWN0cwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kZWVwLnR4dCIsCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAibURhdGEiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgIm1EYXRhIjogImJyb3dzZXIiIH0sCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgIm1EYXRhIjogInBsYXRmb3JtIiwKCQkgKiAgICAgICAgICAgICJtUmVuZGVyIjogIlssIF0ubmFtZSIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNlIGFzIGEgZnVuY3Rpb24gdG8gY3JlYXRlIGEgbGluayBmcm9tIHRoZSBkYXRhIHNvdXJjZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0sCgkJICogICAgICAgICAgIm1EYXRhIjogImRvd25sb2FkX2xpbmsiLAoJCSAqICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKCBkYXRhLCB0eXBlLCBmdWxsICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInK2RhdGErJyI+RG93bmxvYWQ8L2E+JzsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJIm1SZW5kZXIiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIGNlbGwgdHlwZSBjcmVhdGVkIGZvciB0aGUgY29sdW1uIC0gZWl0aGVyIFREIGNlbGxzIG9yIFRIIGNlbGxzLiBUaGlzCgkJICogY2FuIGJlIHVzZWZ1bCBhcyBUSCBjZWxscyBoYXZlIHNlbWFudGljIG1lYW5pbmcgaW4gdGhlIHRhYmxlIGJvZHksIGFsbG93aW5nIHRoZW0KCQkgKiB0byBhY3QgYXMgYSBoZWFkZXIgZm9yIGEgcm93ICh5b3UgbWF5IHdpc2ggdG8gYWRkIHNjb3BlPSdyb3cnIHRvIHRoZSBUSCBlbGVtZW50cykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCB0ZAoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIE1ha2UgdGhlIGZpcnN0IGNvbHVtbiB1c2UgVEggY2VsbHMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdLAoJCSAqICAgICAgICAgICJzQ2VsbFR5cGUiOiAidGgiCgkJICogICAgICAgIH0gXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0NlbGxUeXBlIjogInRkIiwKCQoJCgkJLyoqCgkJICogQ2xhc3MgdG8gZ2l2ZSB0byBlYWNoIGNlbGwgaW4gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic0NsYXNzIjogIm15X2NsYXNzIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNDbGFzcyI6ICJteV9jbGFzcyIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDbGFzcyI6ICIiLAoJCQoJCS8qKgoJCSAqIFdoZW4gRGF0YVRhYmxlcyBjYWxjdWxhdGVzIHRoZSBjb2x1bW4gd2lkdGhzIHRvIGFzc2lnbiB0byBlYWNoIGNvbHVtbiwKCQkgKiBpdCBmaW5kcyB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gZWFjaCBjb2x1bW4gYW5kIHRoZW4gY29uc3RydWN0cyBhCgkJICogdGVtcG9yYXJ5IHRhYmxlIGFuZCByZWFkcyB0aGUgd2lkdGhzIGZyb20gdGhhdC4gVGhlIHByb2JsZW0gd2l0aCB0aGlzCgkJICogaXMgdGhhdCAibW1tIiBpcyBtdWNoIHdpZGVyIHRoZW4gImlpaWkiLCBidXQgdGhlIGxhdHRlciBpcyBhIGxvbmdlciAKCQkgKiBzdHJpbmcgLSB0aHVzIHRoZSBjYWxjdWxhdGlvbiBjYW4gZ28gd3JvbmcgKGRvaW5nIGl0IHByb3Blcmx5IGFuZCBwdXR0aW5nCgkJICogaXQgaW50byBhbiBET00gb2JqZWN0IGFuZCBtZWFzdXJpbmcgdGhhdCBpcyBob3JyaWJseSghKSBzbG93KS4gVGh1cyBhcwoJCSAqIGEgIndvcmsgYXJvdW5kIiB3ZSBwcm92aWRlIHRoaXMgb3B0aW9uLiBJdCB3aWxsIGFwcGVuZCBpdHMgdmFsdWUgdG8gdGhlCgkJICogdGV4dCB0aGF0IGlzIGZvdW5kIHRvIGJlIHRoZSBsb25nZXN0IHN0cmluZyBmb3IgdGhlIGNvbHVtbiAtIGkuZS4gcGFkZGluZy4KCQkgKiBHZW5lcmFsbHkgeW91IHNob3VsZG4ndCBuZWVkIHRoaXMsIGFuZCBpdCBpcyBub3QgZG9jdW1lbnRlZCBvbiB0aGUgCgkJICogZ2VuZXJhbCBEYXRhVGFibGVzLm5ldCBkb2N1bWVudGF0aW9uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8aT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAic0NvbnRlbnRQYWRkaW5nIjogIm1tbSIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb250ZW50UGFkZGluZyI6ICIiLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgYSBkZWZhdWx0IHZhbHVlIHRvIGJlIGdpdmVuIGZvciBhIGNvbHVtbidzIGRhdGEsIGFuZCB3aWxsIGJlIHVzZWQKCQkgKiB3aGVuZXZlciBhIG51bGwgZGF0YSBzb3VyY2UgaXMgZW5jb3VudGVyZWQgKHRoaXMgY2FuIGJlIGJlY2F1c2UgbURhdGEKCQkgKiBpcyBzZXQgdG8gbnVsbCwgb3IgYmVjYXVzZSB0aGUgZGF0YSBzb3VyY2UgaXRzZWxmIGlzIG51bGwpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YSI6IG51bGwsCgkJICogICAgICAgICAgICAic0RlZmF1bHRDb250ZW50IjogIkVkaXQiLAoJCSAqICAgICAgICAgICAgImFUYXJnZXRzIjogWyAtMSBdCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YSI6IG51bGwsCgkJICogICAgICAgICAgICAic0RlZmF1bHRDb250ZW50IjogIkVkaXQiCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzRGVmYXVsdENvbnRlbnQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBpcyBvbmx5IHVzZWQgaW4gRGF0YVRhYmxlcycgc2VydmVyLXNpZGUgcHJvY2Vzc2luZy4gSXQgY2FuCgkJICogYmUgZXhjZXB0aW9uYWxseSB1c2VmdWwgdG8ga25vdyB3aGF0IGNvbHVtbnMgYXJlIGJlaW5nIGRpc3BsYXllZCBvbiB0aGUKCQkgKiBjbGllbnQgc2lkZSwgYW5kIHRvIG1hcCB0aGVzZSB0byBkYXRhYmFzZSBmaWVsZHMuIFdoZW4gZGVmaW5lZCwgdGhlIG5hbWVzCgkJICogYWxzbyBhbGxvdyBEYXRhVGFibGVzIHRvIHJlb3JkZXIgaW5mb3JtYXRpb24gZnJvbSB0aGUgc2VydmVyIGlmIGl0IGNvbWVzCgkJICogYmFjayBpbiBhbiB1bmV4cGVjdGVkIG9yZGVyIChpLmUuIGlmIHlvdSBzd2l0Y2ggeW91ciBjb2x1bW5zIGFyb3VuZCBvbiB0aGUKCQkgKiBjbGllbnQtc2lkZSwgeW91ciBzZXJ2ZXItc2lkZSBjb2RlIGRvZXMgbm90IGFsc28gbmVlZCB1cGRhdGluZykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZW5naW5lIiwgImFUYXJnZXRzIjogWyAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJicm93c2VyIiwgImFUYXJnZXRzIjogWyAxIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIsICJhVGFyZ2V0cyI6IFsgMiBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAidmVyc2lvbiIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZ3JhZGUiLCAiYVRhcmdldHMiOiBbIDQgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAicGxhdGZvcm0iIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAidmVyc2lvbiIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJncmFkZSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzTmFtZSI6ICIiLAoJCgkKCQkvKioKCQkgKiBEZWZpbmVzIGEgZGF0YSBzb3VyY2UgdHlwZSBmb3IgdGhlIHNvcnRpbmcgd2hpY2ggY2FuIGJlIHVzZWQgdG8gcmVhZAoJCSAqIHJlYWwtdGltZSBpbmZvcm1hdGlvbiBmcm9tIHRoZSB0YWJsZSAodXBkYXRpbmcgdGhlIGludGVybmFsbHkgY2FjaGVkCgkJICogdmVyc2lvbikgcHJpb3IgdG8gc29ydGluZy4gVGhpcyBhbGxvd3Mgc29ydGluZyB0byBvY2N1ciBvbiB1c2VyIGVkaXRhYmxlCgkJICogZWxlbWVudHMgc3VjaCBhcyBmb3JtIGlucHV0cy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IHN0ZAoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJhVGFyZ2V0cyI6IFsgMiwgMyBdIH0sCgkJICogICAgICAgICAgeyAic1R5cGUiOiAibnVtZXJpYyIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tc2VsZWN0IiwgImFUYXJnZXRzIjogWyA0IF0gfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIsICJhVGFyZ2V0cyI6IFsgNSBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS10ZXh0IiB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXRleHQiLCAic1R5cGUiOiAibnVtZXJpYyIgfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1zZWxlY3QiIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tY2hlY2tib3giIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1NvcnREYXRhVHlwZSI6ICJzdGQiLAoJCgkKCQkvKioKCQkgKiBUaGUgdGl0bGUgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsIDxpPkRlcml2ZWQgZnJvbSB0aGUgJ1RIJyB2YWx1ZSBmb3IgdGhpcyBjb2x1bW4gaW4gdGhlIAoJCSAqICAgIG9yaWdpbmFsIEhUTUwgdGFibGUuPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJNeSBjb2x1bW4gdGl0bGUiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIk15IGNvbHVtbiB0aXRsZSIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSB0eXBlIGFsbG93cyB5b3UgdG8gc3BlY2lmeSBob3cgdGhlIGRhdGEgZm9yIHRoaXMgY29sdW1uIHdpbGwgYmUgc29ydGVkLgoJCSAqIEZvdXIgdHlwZXMgKHN0cmluZywgbnVtZXJpYywgZGF0ZSBhbmQgaHRtbCAod2hpY2ggd2lsbCBzdHJpcCBIVE1MIHRhZ3MKCQkgKiBiZWZvcmUgc29ydGluZykpIGFyZSBjdXJyZW50bHkgYXZhaWxhYmxlLiBOb3RlIHRoYXQgb25seSBkYXRlIGZvcm1hdHMKCQkgKiB1bmRlcnN0b29kIGJ5IEphdmFzY3JpcHQncyBEYXRlKCkgb2JqZWN0IHdpbGwgYmUgYWNjZXB0ZWQgYXMgdHlwZSBkYXRlLiBGb3IKCQkgKiBleGFtcGxlOiAiTWFyIDI2LCAyMDA4IDU6MDMgUE0iLiBNYXkgdGFrZSB0aGUgdmFsdWVzOiAnc3RyaW5nJywgJ251bWVyaWMnLAoJCSAqICdkYXRlJyBvciAnaHRtbCcgKGJ5IGRlZmF1bHQpLiBGdXJ0aGVyIHR5cGVzIGNhbiBiZSBhZGRpbmcgdGhyb3VnaAoJCSAqIHBsdWctaW5zLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5BdXRvLWRldGVjdGVkIGZyb20gcmF3IGRhdGE8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic1R5cGUiOiAiaHRtbCIsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzVHlwZSI6ICJodG1sIiB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1R5cGUiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBEZWZpbmluZyB0aGUgd2lkdGggb2YgdGhlIGNvbHVtbiwgdGhpcyBwYXJhbWV0ZXIgbWF5IHRha2UgYW55IENTUyB2YWx1ZQoJCSAqICgzZW0sIDIwcHggZXRjKS4gRGF0YVRhYmxlcyBhcHBsZXMgJ3NtYXJ0JyB3aWR0aHMgdG8gY29sdW1ucyB3aGljaCBoYXZlIG5vdAoJCSAqIGJlZW4gZ2l2ZW4gYSBzcGVjaWZpYyB3aWR0aCB0aHJvdWdoIHRoaXMgaW50ZXJmYWNlIGVuc3VyaW5nIHRoYXQgdGhlIHRhYmxlCgkJICogcmVtYWlucyByZWFkYWJsZS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwgPGk+QXV0b21hdGljPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNXaWR0aCI6ICIyMCUiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1dpZHRoIjogIjIwJSIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNXaWR0aCI6IG51bGwKCX07CgkKCQoJCgkvKioKCSAqIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IC0gdGhpcyBob2xkcyBhbGwgdGhlIGluZm9ybWF0aW9uIG5lZWRlZCBmb3IgYQoJICogZ2l2ZW4gdGFibGUsIGluY2x1ZGluZyBjb25maWd1cmF0aW9uLCBkYXRhIGFuZCBjdXJyZW50IGFwcGxpY2F0aW9uIG9mIHRoZQoJICogdGFibGUgb3B0aW9ucy4gRGF0YVRhYmxlcyBkb2VzIG5vdCBoYXZlIGEgc2luZ2xlIGluc3RhbmNlIGZvciBlYWNoIERhdGFUYWJsZQoJICogd2l0aCB0aGUgc2V0dGluZ3MgYXR0YWNoZWQgdG8gdGhhdCBpbnN0YW5jZSwgYnV0IHJhdGhlciBpbnN0YW5jZXMgb2YgdGhlCgkgKiBEYXRhVGFibGUgImNsYXNzIiBhcmUgY3JlYXRlZCBvbi10aGUtZmx5IGFzIG5lZWRlZCAodHlwaWNhbGx5IGJ5IGEgCgkgKiAkKCkuZGF0YVRhYmxlKCkgY2FsbCkgYW5kIHRoZSBzZXR0aW5ncyBvYmplY3QgaXMgdGhlbiBhcHBsaWVkIHRvIHRoYXQKCSAqIGluc3RhbmNlLgoJICogCgkgKiBOb3RlIHRoYXQgdGhpcyBvYmplY3QgaXMgcmVsYXRlZCB0byB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfSBidXQgdGhpcyAKCSAqIG9uZSBpcyB0aGUgaW50ZXJuYWwgZGF0YSBzdG9yZSBmb3IgRGF0YVRhYmxlcydzIGNhY2hlIG9mIGNvbHVtbnMuIEl0IHNob3VsZAoJICogTk9UIGJlIG1hbmlwdWxhdGVkIG91dHNpZGUgb2YgRGF0YVRhYmxlcy4gQW55IGNvbmZpZ3VyYXRpb24gc2hvdWxkIGJlIGRvbmUKCSAqIHRocm91Z2ggdGhlIGluaXRpYWxpc2F0aW9uIG9wdGlvbnMuCgkgKiAgQG5hbWVzcGFjZQoJICogIEB0b2RvIFJlYWxseSBzaG91bGQgYXR0YWNoIHRoZSBzZXR0aW5ncyBvYmplY3QgdG8gaW5kaXZpZHVhbCBpbnN0YW5jZXMgc28gd2UKCSAqICAgIGRvbid0IG5lZWQgdG8gY3JlYXRlIG5ldyBpbnN0YW5jZXMgb24gZWFjaCAkKCkuZGF0YVRhYmxlKCkgY2FsbCAoaWYgdGhlCgkgKiAgICB0YWJsZSBhbHJlYWR5IGV4aXN0cykuIEl0IHdvdWxkIGFsc28gc2F2ZSBwYXNzaW5nIG9TZXR0aW5ncyBhcm91bmQgYW5kCgkgKiAgICBpbnRvIGV2ZXJ5IHNpbmdsZSBmdW5jdGlvbi4gSG93ZXZlciwgdGhpcyBpcyBhIHZlcnkgc2lnbmlmaWNhbnQgCgkgKiAgICBhcmNoaXRlY3R1cmUgY2hhbmdlIGZvciBEYXRhVGFibGVzIGFuZCB3aWxsIGFsbW9zdCBjZXJ0YWlubHkgYnJlYWsKCSAqICAgIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHdpdGggb2xkZXIgaW5zdGFsbGF0aW9ucy4gVGhpcyBpcyBzb21ldGhpbmcgdGhhdAoJICogICAgd2lsbCBiZSBkb25lIGluIDIuMC4KCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MgPSB7CgkJLyoqCgkJICogUHJpbWFyeSBmZWF0dXJlcyBvZiBEYXRhVGFibGVzIGFuZCB0aGVpciBlbmFibGVtZW50IHN0YXRlLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJIm9GZWF0dXJlcyI6IHsKCQkJCgkJCS8qKgoJCQkgKiBGbGFnIHRvIHNheSBpZiBEYXRhVGFibGVzIHNob3VsZCBhdXRvbWF0aWNhbGx5IHRyeSB0byBjYWxjdWxhdGUgdGhlCgkJCSAqIG9wdGltdW0gdGFibGUgYW5kIGNvbHVtbnMgd2lkdGhzICh0cnVlKSBvciBub3QgKGZhbHNlKS4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiQXV0b1dpZHRoIjogbnVsbCwKCQoJCQkvKioKCQkJICogRGVsYXkgdGhlIGNyZWF0aW9uIG9mIFRSIGFuZCBURCBlbGVtZW50cyB1bnRpbCB0aGV5IGFyZSBhY3R1YWxseQoJCQkgKiBuZWVkZWQgYnkgYSBkcml2ZW4gcGFnZSBkcmF3LiBUaGlzIGNhbiBnaXZlIGEgc2lnbmlmaWNhbnQgc3BlZWQKCQkJICogaW5jcmVhc2UgZm9yIEFqYXggc291cmNlIGFuZCBKYXZhc2NyaXB0IHNvdXJjZSBkYXRhLCBidXQgbWFrZXMgbm8KCQkJICogZGlmZmVyZW5jZSBhdCBhbGwgZnJvIERPTSBhbmQgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyB0YWJsZXMuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkRlZmVyUmVuZGVyIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBFbmFibGUgZmlsdGVyaW5nIG9uIHRoZSB0YWJsZSBvciBub3QuIE5vdGUgdGhhdCBpZiB0aGlzIGlzIGRpc2FibGVkCgkJCSAqIHRoZW4gdGhlcmUgaXMgbm8gZmlsdGVyaW5nIGF0IGFsbCBvbiB0aGUgdGFibGUsIGluY2x1ZGluZyBmbkZpbHRlci4KCQkJICogVG8ganVzdCByZW1vdmUgdGhlIGZpbHRlcmluZyBpbnB1dCB1c2Ugc0RvbSBhbmQgcmVtb3ZlIHRoZSAnZicgb3B0aW9uLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJGaWx0ZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFRhYmxlIGluZm9ybWF0aW9uIGVsZW1lbnQgKHRoZSAnU2hvd2luZyB4IG9mIHkgcmVjb3JkcycgZGl2KSBlbmFibGUKCQkJICogZmxhZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiSW5mbyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogUHJlc2VudCBhIHVzZXIgY29udHJvbCBhbGxvd2luZyB0aGUgZW5kIHVzZXIgdG8gY2hhbmdlIHRoZSBwYWdlIHNpemUKCQkJICogd2hlbiBwYWdpbmF0aW9uIGlzIGVuYWJsZWQuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkxlbmd0aENoYW5nZSI6IG51bGwsCgkKCQkJLyoqCgkJCSAqIFBhZ2luYXRpb24gZW5hYmxlZCBvciBub3QuIE5vdGUgdGhhdCBpZiB0aGlzIGlzIGRpc2FibGVkIHRoZW4gbGVuZ3RoCgkJCSAqIGNoYW5naW5nIG11c3QgYWxzbyBiZSBkaXNhYmxlZC4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiUGFnaW5hdGUiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFByb2Nlc3NpbmcgaW5kaWNhdG9yIGVuYWJsZSBmbGFnIHdoZW5ldmVyIERhdGFUYWJsZXMgaXMgZW5hY3RpbmcgYQoJCQkgKiB1c2VyIHJlcXVlc3QgLSB0eXBpY2FsbHkgYW4gQWpheCByZXF1ZXN0IGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJQcm9jZXNzaW5nIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIGVuYWJsZWQgZmxhZyAtIHdoZW4gZW5hYmxlZCBEYXRhVGFibGVzIHdpbGwKCQkJICogZ2V0IGFsbCBkYXRhIGZyb20gdGhlIHNlcnZlciBmb3IgZXZlcnkgZHJhdyAtIHRoZXJlIGlzIG5vIGZpbHRlcmluZywKCQkJICogc29ydGluZyBvciBwYWdpbmcgZG9uZSBvbiB0aGUgY2xpZW50LXNpZGUuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlNlcnZlclNpZGUiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFNvcnRpbmcgZW5hYmxlbWVudCBmbGFnLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJTb3J0IjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBBcHBseSBhIGNsYXNzIHRvIHRoZSBjb2x1bW5zIHdoaWNoIGFyZSBiZWluZyBzb3J0ZWQgdG8gcHJvdmlkZSBhCgkJCSAqIHZpc3VhbCBoaWdobGlnaHQgb3Igbm90LiBUaGlzIGNhbiBzbG93IHRoaW5ncyBkb3duIHdoZW4gZW5hYmxlZCBzaW5jZQoJCQkgKiB0aGVyZSBpcyBhIGxvdCBvZiBET00gaW50ZXJhY3Rpb24uCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlNvcnRDbGFzc2VzIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBTdGF0ZSBzYXZpbmcgZW5hYmxlbWVudCBmbGFnLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJTdGF0ZVNhdmUiOiBudWxsCgkJfSwKCQkKCQoJCS8qKgoJCSAqIFNjcm9sbGluZyBzZXR0aW5ncyBmb3IgYSB0YWJsZS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvU2Nyb2xsIjogewoJCQkvKioKCQkJICogSW5kaWNhdGUgaWYgRGF0YVRhYmxlcyBzaG91bGQgYmUgYWxsb3dlZCB0byBzZXQgdGhlIHBhZGRpbmcgLyBtYXJnaW4KCQkJICogZXRjIGZvciB0aGUgc2Nyb2xsaW5nIGhlYWRlciBlbGVtZW50cyBvciBub3QuIFR5cGljYWxseSB5b3Ugd2lsbCB3YW50CgkJCSAqIHRoaXMuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkF1dG9Dc3MiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFdoZW4gdGhlIHRhYmxlIGlzIHNob3J0ZXIgaW4gaGVpZ2h0IHRoYW4gc1Njcm9sbFksIGNvbGxhcHNlIHRoZQoJCQkgKiB0YWJsZSBjb250YWluZXIgZG93biB0byB0aGUgaGVpZ2h0IG9mIHRoZSB0YWJsZSAod2hlbiB0cnVlKS4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiQ29sbGFwc2UiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEluZmluaXRlIHNjcm9sbGluZyBlbmFibGVtZW50IGZsYWcuIE5vdyBkZXByZWNhdGVkIGluIGZhdm91ciBvZgoJCQkgKiB1c2luZyB0aGUgU2Nyb2xsZXIgcGx1Zy1pbi4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiSW5maW5pdGUiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFdpZHRoIG9mIHRoZSBzY3JvbGxiYXIgZm9yIHRoZSB3ZWItYnJvd3NlcidzIHBsYXRmb3JtLiBDYWxjdWxhdGVkCgkJCSAqIGR1cmluZyB0YWJsZSBpbml0aWFsaXNhdGlvbi4KCQkJICogIEB0eXBlIGludAoJCQkgKiAgQGRlZmF1bHQgMAoJCQkgKi8KCQkJImlCYXJXaWR0aCI6IDAsCgkJCQoJCQkvKioKCQkJICogU3BhY2UgKGluIHBpeGVscykgYmV0d2VlbiB0aGUgYm90dG9tIG9mIHRoZSBzY3JvbGxpbmcgY29udGFpbmVyIGFuZCAKCQkJICogdGhlIGJvdHRvbSBvZiB0aGUgc2Nyb2xsaW5nIHZpZXdwb3J0IGJlZm9yZSB0aGUgbmV4dCBwYWdlIGlzIGxvYWRlZAoJCQkgKiB3aGVuIHVzaW5nIGluZmluaXRlIHNjcm9sbGluZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGludAoJCQkgKi8KCQkJImlMb2FkR2FwIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBWaWV3cG9ydCB3aWR0aCBmb3IgaG9yaXpvbnRhbCBzY3JvbGxpbmcuIEhvcml6b250YWwgc2Nyb2xsaW5nIGlzIAoJCQkgKiBkaXNhYmxlZCBpZiBhbiBlbXB0eSBzdHJpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICovCgkJCSJzWCI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2lkdGggdG8gZXhwYW5kIHRoZSB0YWJsZSB0byB3aGVuIHVzaW5nIHgtc2Nyb2xsaW5nLiBUeXBpY2FsbHkgeW91CgkJCSAqIHNob3VsZCBub3QgbmVlZCB0byB1c2UgdGhpcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlcHJlY2F0ZWQKCQkJICovCgkJCSJzWElubmVyIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBWaWV3cG9ydCBoZWlnaHQgZm9yIHZlcnRpY2FsIHNjcm9sbGluZy4gVmVydGljYWwgc2Nyb2xsaW5nIGlzIGRpc2FibGVkCgkJCSAqIGlmIGFuIGVtcHR5IHN0cmluZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKi8KCQkJInNZIjogbnVsbAoJCX0sCgkJCgkJLyoqCgkJICogTGFuZ3VhZ2UgaW5mb3JtYXRpb24gZm9yIHRoZSB0YWJsZS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAZXh0ZW5kcyBEYXRhVGFibGUuZGVmYXVsdHMub0xhbmd1YWdlCgkJICovCgkJIm9MYW5ndWFnZSI6IHsKCQkJLyoqCgkJCSAqIEluZm9ybWF0aW9uIGNhbGxiYWNrIGZ1bmN0aW9uLiBTZWUgCgkJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuZm5JbmZvQ2FsbGJhY2t9CgkJCSAqICBAdHlwZSBmdW5jdGlvbgoJCQkgKiAgQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJImZuSW5mb0NhbGxiYWNrIjogbnVsbAoJCX0sCgkJCgkJLyoqCgkJICogQnJvd3NlciBzdXBwb3J0IHBhcmFtZXRlcnMKCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvQnJvd3NlciI6IHsKCQkJLyoqCgkJCSAqIEluZGljYXRlIGlmIHRoZSBicm93c2VyIGluY29ycmVjdGx5IGNhbGN1bGF0ZXMgd2lkdGg6MTAwJSBpbnNpZGUgYQoJCQkgKiBzY3JvbGxpbmcgZWxlbWVudCAoSUU2LzcpCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqICBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJImJTY3JvbGxPdmVyc2l6ZSI6IGZhbHNlCgkJfSwKCQkKCQkvKioKCQkgKiBBcnJheSByZWZlcmVuY2luZyB0aGUgbm9kZXMgd2hpY2ggYXJlIHVzZWQgZm9yIHRoZSBmZWF0dXJlcy4gVGhlIAoJCSAqIHBhcmFtZXRlcnMgb2YgdGhpcyBvYmplY3QgbWF0Y2ggd2hhdCBpcyBhbGxvd2VkIGJ5IHNEb20gLSBpLmUuCgkJICogICA8dWw+CgkJICogICAgIDxsaT4nbCcgLSBMZW5ndGggY2hhbmdpbmc8L2xpPgoJCSAqICAgICA8bGk+J2YnIC0gRmlsdGVyaW5nIGlucHV0PC9saT4KCQkgKiAgICAgPGxpPid0JyAtIFRoZSB0YWJsZSE8L2xpPgoJCSAqICAgICA8bGk+J2knIC0gSW5mb3JtYXRpb248L2xpPgoJCSAqICAgICA8bGk+J3AnIC0gUGFnaW5hdGlvbjwvbGk+CgkJICogICAgIDxsaT4ncicgLSBwUm9jZXNzaW5nPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFhbkZlYXR1cmVzIjogW10sCgkJCgkJLyoqCgkJICogU3RvcmUgZGF0YSBpbmZvcm1hdGlvbiAtIHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vUm93fSBmb3IgZGV0YWlsZWQKCQkgKiBpbmZvcm1hdGlvbi4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9EYXRhIjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgaW5kZXhlcyB3aGljaCBhcmUgaW4gdGhlIGN1cnJlbnQgZGlzcGxheSAoYWZ0ZXIgZmlsdGVyaW5nIGV0YykKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYWlEaXNwbGF5IjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgaW5kZXhlcyBmb3IgZGlzcGxheSAtIG5vIGZpbHRlcmluZwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhaURpc3BsYXlNYXN0ZXIiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBpbmZvcm1hdGlvbiBhYm91dCBlYWNoIGNvbHVtbiB0aGF0IGlzIGluIHVzZQoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0NvbHVtbnMiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGFibGUncyBoZWFkZXIKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9IZWFkZXIiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGFibGUncyBmb290ZXIKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Gb290ZXIiOiBbXSwKCQkKCQkvKioKCQkgKiBTZWFyY2ggZGF0YSBhcnJheSBmb3IgcmVndWxhciBleHByZXNzaW9uIHNlYXJjaGluZwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc0RhdGFTZWFyY2giOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSB0aGUgYXBwbGllZCBnbG9iYWwgc2VhcmNoIGluZm9ybWF0aW9uIGluIGNhc2Ugd2Ugd2FudCB0byBmb3JjZSBhIAoJCSAqIHJlc2VhcmNoIG9yIGNvbXBhcmUgdGhlIG9sZCBzZWFyY2ggdG8gYSBuZXcgb25lLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAZXh0ZW5kcyBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2gKCQkgKi8KCQkib1ByZXZpb3VzU2VhcmNoIjoge30sCgkJCgkJLyoqCgkJICogU3RvcmUgdGhlIGFwcGxpZWQgc2VhcmNoIGZvciBlYWNoIGNvbHVtbiAtIHNlZSAKCQkgKiB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNofSBmb3IgdGhlIGZvcm1hdCB0aGF0IGlzIHVzZWQgZm9yIHRoZQoJCSAqIGZpbHRlcmluZyBpbmZvcm1hdGlvbiBmb3IgZWFjaCBjb2x1bW4uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUHJlU2VhcmNoQ29scyI6IFtdLAoJCQoJCS8qKgoJCSAqIFNvcnRpbmcgdGhhdCBpcyBhcHBsaWVkIHRvIHRoZSB0YWJsZS4gTm90ZSB0aGF0IHRoZSBpbm5lciBhcnJheXMgYXJlCgkJICogdXNlZCBpbiB0aGUgZm9sbG93aW5nIG1hbm5lcjoKCQkgKiA8dWw+CgkJICogICA8bGk+SW5kZXggMCAtIGNvbHVtbiBudW1iZXI8L2xpPgoJCSAqICAgPGxpPkluZGV4IDEgLSBjdXJyZW50IHNvcnRpbmcgZGlyZWN0aW9uPC9saT4KCQkgKiAgIDxsaT5JbmRleCAyIC0gaW5kZXggb2YgYXNTb3J0aW5nIGZvciB0aGlzIGNvbHVtbjwvbGk+CgkJICogPC91bD4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEB0b2RvIFRoZXNlIGlubmVyIGFycmF5cyBzaG91bGQgcmVhbGx5IGJlIG9iamVjdHMKCQkgKi8KCQkiYWFTb3J0aW5nIjogbnVsbCwKCQkKCQkvKioKCQkgKiBTb3J0aW5nIHRoYXQgaXMgYWx3YXlzIGFwcGxpZWQgdG8gdGhlIHRhYmxlIChpLmUuIHByZWZpeGVkIGluIGZyb250IG9mCgkJICogYWFTb3J0aW5nKS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5fG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJhYVNvcnRpbmdGaXhlZCI6IG51bGwsCgkJCgkJLyoqCgkJICogQ2xhc3NlcyB0byB1c2UgZm9yIHRoZSBzdHJpcGluZyBvZiBhIHRhYmxlLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYXNTdHJpcGVDbGFzc2VzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBJZiByZXN0b3JpbmcgYSB0YWJsZSAtIHdlIHNob3VsZCByZXN0b3JlIGl0cyBzdHJpcGluZyBjbGFzc2VzIGFzIHdlbGwKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYXNEZXN0cm95U3RyaXBlcyI6IFtdLAoJCQoJCS8qKgoJCSAqIElmIHJlc3RvcmluZyBhIHRhYmxlIC0gd2Ugc2hvdWxkIHJlc3RvcmUgaXRzIHdpZHRoIAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJzRGVzdHJveVdpZHRoIjogMCwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgYXJyYXkgZm9yIGV2ZXJ5IHRpbWUgYSByb3cgaXMgaW5zZXJ0ZWQgKGkuZS4gb24gYSBkcmF3KS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Sb3dDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgdGhlIGhlYWRlciBvbiBlYWNoIGRyYXcuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvSGVhZGVyQ2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbiBmb3IgdGhlIGZvb3RlciBvbiBlYWNoIGRyYXcuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRm9vdGVyQ2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIGRyYXcgY2FsbGJhY2sgZnVuY3Rpb25zCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvRHJhd0NhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQXJyYXkgb2YgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciByb3cgY3JlYXRlZCBmdW5jdGlvbgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1Jvd0NyZWF0ZWRDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBmb3IganVzdCBiZWZvcmUgdGhlIHRhYmxlIGlzIHJlZHJhd24uIEEgcmV0dXJuIG9mIAoJCSAqIGZhbHNlIHdpbGwgYmUgdXNlZCB0byBjYW5jZWwgdGhlIGRyYXcuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUHJlRHJhd0NhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciB3aGVuIHRoZSB0YWJsZSBoYXMgYmVlbiBpbml0aWFsaXNlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Jbml0Q29tcGxldGUiOiBbXSwKCQoJCQoJCS8qKgoJCSAqIENhbGxiYWNrcyBmb3IgbW9kaWZ5aW5nIHRoZSBzZXR0aW5ncyB0byBiZSBzdG9yZWQgZm9yIHN0YXRlIHNhdmluZywgcHJpb3IgdG8KCQkgKiBzYXZpbmcgc3RhdGUuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVTYXZlUGFyYW1zIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2tzIGZvciBtb2RpZnlpbmcgdGhlIHNldHRpbmdzIHRoYXQgaGF2ZSBiZWVuIHN0b3JlZCBmb3Igc3RhdGUgc2F2aW5nCgkJICogcHJpb3IgdG8gdXNpbmcgdGhlIHN0b3JlZCB2YWx1ZXMgdG8gcmVzdG9yZSB0aGUgc3RhdGUuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVMb2FkUGFyYW1zIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2tzIGZvciBvcGVyYXRpbmcgb24gdGhlIHNldHRpbmdzIG9iamVjdCBvbmNlIHRoZSBzYXZlZCBzdGF0ZSBoYXMgYmVlbgoJCSAqIGxvYWRlZAoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlTG9hZGVkIjogW10sCgkJCgkJLyoqCgkJICogQ2FjaGUgdGhlIHRhYmxlIElEIGZvciBxdWljayBhY2Nlc3MKCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic1RhYmxlSWQiOiAiIiwKCQkKCQkvKioKCQkgKiBUaGUgVEFCTEUgbm9kZSBmb3IgdGhlIG1haW4gdGFibGUKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UYWJsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogUGVybWFuZW50IHJlZiB0byB0aGUgdGhlYWQgZWxlbWVudAoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRIZWFkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQZXJtYW5lbnQgcmVmIHRvIHRoZSB0Zm9vdCBlbGVtZW50IC0gaWYgaXQgZXhpc3RzCgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVEZvb3QiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFBlcm1hbmVudCByZWYgdG8gdGhlIHRib2R5IGVsZW1lbnQKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UQm9keSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ2FjaGUgdGhlIHdyYXBwZXIgbm9kZSAoY29udGFpbnMgYWxsIERhdGFUYWJsZXMgY29udHJvbGxlZCBlbGVtZW50cykKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UYWJsZVdyYXBwZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIHdoZW4gdXNpbmcgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyB0aGUgbG9hZGluZyBvZiBkYXRhIAoJCSAqIHNob3VsZCBiZSBkZWZlcnJlZCB1bnRpbCB0aGUgc2Vjb25kIGRyYXcuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICovCgkJImJEZWZlckxvYWRpbmciOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiBhbGwgcmVxdWlyZWQgaW5mb3JtYXRpb24gaGFzIGJlZW4gcmVhZCBpbgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICovCgkJImJJbml0aWFsaXNlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZm9ybWF0aW9uIGFib3V0IG9wZW4gcm93cy4gRWFjaCBvYmplY3QgaW4gdGhlIGFycmF5IGhhcyB0aGUgcGFyYW1ldGVycwoJCSAqICduVHInIGFuZCAnblBhcmVudCcKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9PcGVuUm93cyI6IFtdLAoJCQoJCS8qKgoJCSAqIERpY3RhdGUgdGhlIHBvc2l0aW9uaW5nIG9mIERhdGFUYWJsZXMnIGNvbnRyb2wgZWxlbWVudHMgLSBzZWUKCQkgKiB7QGxpbmsgRGF0YVRhYmxlLm1vZGVsLm9Jbml0LnNEb219LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0RvbSI6IG51bGwsCgkJCgkJLyoqCgkJICogV2hpY2ggdHlwZSBvZiBwYWdpbmF0aW9uIHNob3VsZCBiZSB1c2VkLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nIAoJCSAqICBAZGVmYXVsdCB0d29fYnV0dG9uCgkJICovCgkJInNQYWdpbmF0aW9uVHlwZSI6ICJ0d29fYnV0dG9uIiwKCQkKCQkvKioKCQkgKiBUaGUgY29va2llIGR1cmF0aW9uIChmb3IgYlN0YXRlU2F2ZSkgaW4gc2Vjb25kcy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlDb29raWVEdXJhdGlvbiI6IDAsCgkJCgkJLyoqCgkJICogVGhlIGNvb2tpZSBuYW1lIHByZWZpeC4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICovCgkJInNDb29raWVQcmVmaXgiOiAiIiwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbiBmb3IgY29va2llIGNyZWF0aW9uLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkNvb2tpZUNhbGxiYWNrIjogbnVsbCwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHN0YXRlIHNhdmluZy4gRWFjaCBhcnJheSBlbGVtZW50IGlzIGFuIAoJCSAqIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmZ1bmN0aW9uOmZuIC0gZnVuY3Rpb24gdG8gY2FsbC4gVGFrZXMgdHdvIHBhcmFtZXRlcnMsIG9TZXR0aW5ncwoJCSAqICAgICAgIGFuZCB0aGUgSlNPTiBzdHJpbmcgdG8gc2F2ZSB0aGF0IGhhcyBiZWVuIHRodXMgZmFyIGNyZWF0ZWQuIFJldHVybnMKCQkgKiAgICAgICBhIEpTT04gc3RyaW5nIHRvIGJlIGluc2VydGVkIGludG8gYSBqc29uIG9iamVjdCAKCQkgKiAgICAgICAoaS5lLiAnInBhcmFtIjogWyAwLCAxLCAyXScpPC9saT4KCQkgKiAgICAgPGxpPnN0cmluZzpzTmFtZSAtIG5hbWUgb2YgY2FsbGJhY2s8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZVNhdmUiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHN0YXRlIGxvYWRpbmcuIEVhY2ggYXJyYXkgZWxlbWVudCBpcyBhbiAKCQkgKiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5mdW5jdGlvbjpmbiAtIGZ1bmN0aW9uIHRvIGNhbGwuIFRha2VzIHR3byBwYXJhbWV0ZXJzLCBvU2V0dGluZ3MgCgkJICogICAgICAgYW5kIHRoZSBvYmplY3Qgc3RvcmVkLiBNYXkgcmV0dXJuIGZhbHNlIHRvIGNhbmNlbCBzdGF0ZSBsb2FkaW5nPC9saT4KCQkgKiAgICAgPGxpPnN0cmluZzpzTmFtZSAtIG5hbWUgb2YgY2FsbGJhY2s8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZUxvYWQiOiBbXSwKCQkKCQkvKioKCQkgKiBTdGF0ZSB0aGF0IHdhcyBsb2FkZWQgZnJvbSB0aGUgY29va2llLiBVc2VmdWwgZm9yIGJhY2sgcmVmZXJlbmNlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm9Mb2FkZWRTdGF0ZSI6IG51bGwsCgkJCgkJLyoqCgkJICogU291cmNlIHVybCBmb3IgQUpBWCBkYXRhIGZvciB0aGUgdGFibGUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzQWpheFNvdXJjZSI6IG51bGwsCgkJCgkJLyoqCgkJICogUHJvcGVydHkgZnJvbSBhIGdpdmVuIG9iamVjdCBmcm9tIHdoaWNoIHRvIHJlYWQgdGhlIHRhYmxlIGRhdGEgZnJvbS4gVGhpcwoJCSAqIGNhbiBiZSBhbiBlbXB0eSBzdHJpbmcgKHdoZW4gbm90IHNlcnZlci1zaWRlIHByb2Nlc3NpbmcpLCBpbiB3aGljaCBjYXNlIAoJCSAqIGl0IGlzICBhc3N1bWVkIGFuIGFuIGFycmF5IGlzIGdpdmVuIGRpcmVjdGx5LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNBamF4RGF0YVByb3AiOiBudWxsLAoJCQoJCS8qKgoJCSAqIE5vdGUgaWYgZHJhdyBzaG91bGQgYmUgYmxvY2tlZCB3aGlsZSBnZXR0aW5nIGRhdGEKCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICovCgkJImJBamF4RGF0YUdldCI6IHRydWUsCgkJCgkJLyoqCgkJICogVGhlIGxhc3QgalF1ZXJ5IFhIUiBvYmplY3QgdGhhdCB3YXMgdXNlZCBmb3Igc2VydmVyLXNpZGUgZGF0YSBnYXRoZXJpbmcuIAoJCSAqIFRoaXMgY2FuIGJlIHVzZWQgZm9yIHdvcmtpbmcgd2l0aCB0aGUgWEhSIGluZm9ybWF0aW9uIGluIG9uZSBvZiB0aGUgCgkJICogY2FsbGJhY2tzCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImpxWEhSIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGdW5jdGlvbiB0byBnZXQgdGhlIHNlcnZlci1zaWRlIGRhdGEuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqLwoJCSJmblNlcnZlckRhdGEiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9ucyB3aGljaCBhcmUgY2FsbGVkIHByaW9yIHRvIHNlbmRpbmcgYW4gQWpheCByZXF1ZXN0IHNvIGV4dHJhIAoJCSAqIHBhcmFtZXRlcnMgY2FuIGVhc2lseSBiZSBzZW50IHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TZXJ2ZXJQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBTZW5kIHRoZSBYSFIgSFRUUCBtZXRob2QgLSBHRVQgb3IgUE9TVCAoY291bGQgYmUgUFVUIG9yIERFTEVURSBpZiAKCQkgKiByZXF1aXJlZCkuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKi8KCQkic1NlcnZlck1ldGhvZCI6IG51bGwsCgkJCgkJLyoqCgkJICogRm9ybWF0IG51bWJlcnMgZm9yIGRpc3BsYXkuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqLwoJCSJmbkZvcm1hdE51bWJlciI6IG51bGwsCgkJCgkJLyoqCgkJICogTGlzdCBvZiBvcHRpb25zIHRoYXQgY2FuIGJlIHVzZWQgZm9yIHRoZSB1c2VyIHNlbGVjdGFibGUgbGVuZ3RoIG1lbnUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhTGVuZ3RoTWVudSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ291bnRlciBmb3IgdGhlIGRyYXdzIHRoYXQgdGhlIHRhYmxlIGRvZXMuIEFsc28gdXNlZCBhcyBhIHRyYWNrZXIgZm9yCgkJICogc2VydmVyLXNpZGUgcHJvY2Vzc2luZwoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJpRHJhdyI6IDAsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgYSByZWRyYXcgaXMgYmVpbmcgZG9uZSAtIHVzZWZ1bCBmb3IgQWpheAoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICovCgkJImJEcmF3aW5nIjogZmFsc2UsCgkJCgkJLyoqCgkJICogRHJhdyBpbmRleCAoaURyYXcpIG9mIHRoZSBsYXN0IGVycm9yIHdoZW4gcGFyc2luZyB0aGUgcmV0dXJuZWQgZGF0YQoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgLTEKCQkgKi8KCQkiaURyYXdFcnJvciI6IC0xLAoJCQoJCS8qKgoJCSAqIFBhZ2luZyBkaXNwbGF5IGxlbmd0aAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMTAKCQkgKi8KCQkiX2lEaXNwbGF5TGVuZ3RoIjogMTAsCgkKCQkvKioKCQkgKiBQYWdpbmcgc3RhcnQgcG9pbnQgLSBhaURpc3BsYXkgaW5kZXgKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiX2lEaXNwbGF5U3RhcnQiOiAwLAoJCgkJLyoqCgkJICogUGFnaW5nIGVuZCBwb2ludCAtIGFpRGlzcGxheSBpbmRleC4gVXNlIGZuRGlzcGxheUVuZCByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSBlbmQgcG9pbnQKCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDEwCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9pRGlzcGxheUVuZCI6IDEwLAoJCQoJCS8qKgoJCSAqIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgLSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgcmVzdWx0IHNldAoJCSAqIChpLmUuIGJlZm9yZSBmaWx0ZXJpbmcpLCBVc2UgZm5SZWNvcmRzVG90YWwgcmF0aGVyIHRoYW4KCQkgKiB0aGlzIHByb3BlcnR5IHRvIGdldCB0aGUgdmFsdWUgb2YgdGhlIG51bWJlciBvZiByZWNvcmRzLCByZWdhcmRsZXNzIG9mCgkJICogdGhlIHNlcnZlci1zaWRlIHByb2Nlc3Npbmcgc2V0dGluZy4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lSZWNvcmRzVG90YWwiOiAwLAoJCgkJLyoqCgkJICogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyAtIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSBjdXJyZW50IGRpc3BsYXkgc2V0CgkJICogKGkuZS4gYWZ0ZXIgZmlsdGVyaW5nKS4gVXNlIGZuUmVjb3Jkc0Rpc3BsYXkgcmF0aGVyIHRoYW4KCQkgKiB0aGlzIHByb3BlcnR5IHRvIGdldCB0aGUgdmFsdWUgb2YgdGhlIG51bWJlciBvZiByZWNvcmRzLCByZWdhcmRsZXNzIG9mCgkJICogdGhlIHNlcnZlci1zaWRlIHByb2Nlc3Npbmcgc2V0dGluZy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCAwCgkJICogIEBwcml2YXRlCgkJICovCgkJIl9pUmVjb3Jkc0Rpc3BsYXkiOiAwLAoJCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgalF1ZXJ5IFVJIG1hcmtpbmcgYW5kIGNsYXNzZXMgc2hvdWxkIGJlIHVzZWQuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJKVUkiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFRoZSBjbGFzc2VzIHRvIHVzZSBmb3IgdGhlIHRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvQ2xhc3NlcyI6IHt9LAoJCQoJCS8qKgoJCSAqIEZsYWcgYXR0YWNoZWQgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBzbyB5b3UgY2FuIGNoZWNrIGluIHRoZSBkcmF3IAoJCSAqIGNhbGxiYWNrIGlmIGZpbHRlcmluZyBoYXMgYmVlbiBkb25lIGluIHRoZSBkcmF3LiBEZXByZWNhdGVkIGluIGZhdm91ciBvZgoJCSAqIGV2ZW50cy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqLwoJCSJiRmlsdGVyZWQiOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBGbGFnIGF0dGFjaGVkIHRvIHRoZSBzZXR0aW5ncyBvYmplY3Qgc28geW91IGNhbiBjaGVjayBpbiB0aGUgZHJhdyAKCQkgKiBjYWxsYmFjayBpZiBzb3J0aW5nIGhhcyBiZWVuIGRvbmUgaW4gdGhlIGRyYXcuIERlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJICogZXZlbnRzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImJTb3J0ZWQiOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSB0aGF0IGlmIG11bHRpcGxlIHJvd3MgYXJlIGluIHRoZSBoZWFkZXIgYW5kIHRoZXJlIGlzIG1vcmUgdGhhbiAKCQkgKiBvbmUgdW5pcXVlIGNlbGwgcGVyIGNvbHVtbiwgaWYgdGhlIHRvcCBvbmUgKHRydWUpIG9yIGJvdHRvbSBvbmUgKGZhbHNlKSAKCQkgKiBzaG91bGQgYmUgdXNlZCBmb3Igc29ydGluZyAvIHRpdGxlIGJ5IERhdGFUYWJsZXMuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJTb3J0Q2VsbHNUb3AiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEluaXRpYWxpc2F0aW9uIG9iamVjdCB0aGF0IGlzIHVzZWQgZm9yIHRoZSB0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJvSW5pdCI6IG51bGwsCgkJCgkJLyoqCgkJICogRGVzdHJveSBjYWxsYmFjayBmdW5jdGlvbnMgLSBmb3IgcGx1Zy1pbnMgdG8gYXR0YWNoIHRoZW1zZWx2ZXMgdG8gdGhlCgkJICogZGVzdHJveSBzbyB0aGV5IGNhbiBjbGVhbiB1cCBtYXJrdXAgYW5kIGV2ZW50cy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9EZXN0cm95Q2FsbGJhY2siOiBbXSwKCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGN1cnJlbnQgcmVjb3JkIHNldCwgYmVmb3JlIGZpbHRlcmluZwoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqLwoJCSJmblJlY29yZHNUb3RhbCI6IGZ1bmN0aW9uICgpCgkJewoJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkgewoJCQkJcmV0dXJuIHBhcnNlSW50KHRoaXMuX2lSZWNvcmRzVG90YWwsIDEwKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGg7CgkJCX0KCQl9LAoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGN1cnJlbnQgcmVjb3JkIHNldCwgYWZ0ZXIgZmlsdGVyaW5nCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuUmVjb3Jkc0Rpc3BsYXkiOiBmdW5jdGlvbiAoKQoJCXsKCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApIHsKCQkJCXJldHVybiBwYXJzZUludCh0aGlzLl9pUmVjb3Jkc0Rpc3BsYXksIDEwKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmFpRGlzcGxheS5sZW5ndGg7CgkJCX0KCQl9LAoJCQoJCS8qKgoJCSAqIFNldCB0aGUgZGlzcGxheSBlbmQgcG9pbnQgLSBhaURpc3BsYXkgaW5kZXgKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHRvZG8gU2hvdWxkIGRvIGF3YXkgd2l0aCBfaURpc3BsYXlFbmQgYW5kIGNhbGN1bGF0ZSBpdCBvbi10aGUtZmx5IGhlcmUKCQkgKi8KCQkiZm5EaXNwbGF5RW5kIjogZnVuY3Rpb24gKCkKCQl7CgkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKSB7CgkJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJQYWdpbmF0ZSA9PT0gZmFsc2UgfHwgdGhpcy5faURpc3BsYXlMZW5ndGggPT0gLTEgKSB7CgkJCQkJcmV0dXJuIHRoaXMuX2lEaXNwbGF5U3RhcnQrdGhpcy5haURpc3BsYXkubGVuZ3RoOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gTWF0aC5taW4oIHRoaXMuX2lEaXNwbGF5U3RhcnQrdGhpcy5faURpc3BsYXlMZW5ndGgsIAoJCQkJCQl0aGlzLl9pUmVjb3Jkc0Rpc3BsYXkgKTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLl9pRGlzcGxheUVuZDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogVGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGlzIHRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm9JbnN0YW5jZSI6IG51bGwsCgkJCgkJLyoqCgkJICogVW5pcXVlIGlkZW50aWZpZXIgZm9yIGVhY2ggaW5zdGFuY2Ugb2YgdGhlIERhdGFUYWJsZXMgb2JqZWN0LiBJZiB0aGVyZQoJCSAqIGlzIGFuIElEIG9uIHRoZSB0YWJsZSBub2RlLCB0aGVuIGl0IHRha2VzIHRoYXQgdmFsdWUsIG90aGVyd2lzZSBhbgoJCSAqIGluY3JlbWVudGluZyBpbnRlcm5hbCBjb3VudGVyIGlzIHVzZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNJbnN0YW5jZSI6IG51bGwsCgkKCQkvKioKCQkgKiB0YWJpbmRleCBhdHRyaWJ1dGUgdmFsdWUgdGhhdCBpcyBhZGRlZCB0byBEYXRhVGFibGVzIGNvbnRyb2wgZWxlbWVudHMsIGFsbG93aW5nCgkJICoga2V5Ym9hcmQgbmF2aWdhdGlvbiBvZiB0aGUgdGFibGUgYW5kIGl0cyBjb250cm9scy4KCQkgKi8KCQkiaVRhYkluZGV4IjogMCwKCQoJCS8qKgoJCSAqIERJViBjb250YWluZXIgZm9yIHRoZSBmb290ZXIgc2Nyb2xsaW5nIHRhYmxlIGlmIHNjcm9sbGluZwoJCSAqLwoJCSJuU2Nyb2xsSGVhZCI6IG51bGwsCgkKCQkvKioKCQkgKiBESVYgY29udGFpbmVyIGZvciB0aGUgZm9vdGVyIHNjcm9sbGluZyB0YWJsZSBpZiBzY3JvbGxpbmcKCQkgKi8KCQkiblNjcm9sbEZvb3QiOiBudWxsCgl9OwoKCS8qKgoJICogRXh0ZW5zaW9uIG9iamVjdCBmb3IgRGF0YVRhYmxlcyB0aGF0IGlzIHVzZWQgdG8gcHJvdmlkZSBhbGwgZXh0ZW5zaW9uIG9wdGlvbnMuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlLmV4dDwvaT4gb2JqZWN0IGlzIGF2YWlsYWJsZSB0aHJvdWdoCgkgKiA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlLmV4dDwvaT4gd2hlcmUgaXQgbWF5IGJlIGFjY2Vzc2VkIGFuZCBtYW5pcHVsYXRlZC4gSXQgaXMKCSAqIGFsc28gYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlRXh0PC9pPiBmb3IgaGlzdG9yaWMgcmVhc29ucy4KCSAqICBAbmFtZXNwYWNlCgkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5leHQKCSAqLwoJRGF0YVRhYmxlLmV4dCA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5leHQgKTsKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMsIHsKCQkic1RhYmxlIjogImRhdGFUYWJsZSIsCgkKCQkvKiBUd28gYnV0dG9ucyBidXR0b25zICovCgkJInNQYWdlUHJldkVuYWJsZWQiOiAicGFnaW5hdGVfZW5hYmxlZF9wcmV2aW91cyIsCgkJInNQYWdlUHJldkRpc2FibGVkIjogInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIiwKCQkic1BhZ2VOZXh0RW5hYmxlZCI6ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiLAoJCSJzUGFnZU5leHREaXNhYmxlZCI6ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IiwKCQkic1BhZ2VKVUlOZXh0IjogIiIsCgkJInNQYWdlSlVJUHJldiI6ICIiLAoJCQoJCS8qIEZ1bGwgbnVtYmVycyBwYWdpbmcgYnV0dG9ucyAqLwoJCSJzUGFnZUJ1dHRvbiI6ICJwYWdpbmF0ZV9idXR0b24iLAoJCSJzUGFnZUJ1dHRvbkFjdGl2ZSI6ICJwYWdpbmF0ZV9hY3RpdmUiLAoJCSJzUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIjogInBhZ2luYXRlX2J1dHRvbiBwYWdpbmF0ZV9idXR0b25fZGlzYWJsZWQiLAoJCSJzUGFnZUZpcnN0IjogImZpcnN0IiwKCQkic1BhZ2VQcmV2aW91cyI6ICJwcmV2aW91cyIsCgkJInNQYWdlTmV4dCI6ICJuZXh0IiwKCQkic1BhZ2VMYXN0IjogImxhc3QiLAoJCQoJCS8qIFN0cmlwaW5nIGNsYXNzZXMgKi8KCQkic1N0cmlwZU9kZCI6ICJvZGQiLAoJCSJzU3RyaXBlRXZlbiI6ICJldmVuIiwKCQkKCQkvKiBFbXB0eSByb3cgKi8KCQkic1Jvd0VtcHR5IjogImRhdGFUYWJsZXNfZW1wdHkiLAoJCQoJCS8qIEZlYXR1cmVzICovCgkJInNXcmFwcGVyIjogImRhdGFUYWJsZXNfd3JhcHBlciIsCgkJInNGaWx0ZXIiOiAiZGF0YVRhYmxlc19maWx0ZXIiLAoJCSJzSW5mbyI6ICJkYXRhVGFibGVzX2luZm8iLAoJCSJzUGFnaW5nIjogImRhdGFUYWJsZXNfcGFnaW5hdGUgcGFnaW5nXyIsIC8qIE5vdGUgdGhhdCB0aGUgdHlwZSBpcyBwb3N0Zml4ZWQgKi8KCQkic0xlbmd0aCI6ICJkYXRhVGFibGVzX2xlbmd0aCIsCgkJInNQcm9jZXNzaW5nIjogImRhdGFUYWJsZXNfcHJvY2Vzc2luZyIsCgkJCgkJLyogU29ydGluZyAqLwoJCSJzU29ydEFzYyI6ICJzb3J0aW5nX2FzYyIsCgkJInNTb3J0RGVzYyI6ICJzb3J0aW5nX2Rlc2MiLAoJCSJzU29ydGFibGUiOiAic29ydGluZyIsIC8qIFNvcnRhYmxlIGluIGJvdGggZGlyZWN0aW9ucyAqLwoJCSJzU29ydGFibGVBc2MiOiAic29ydGluZ19hc2NfZGlzYWJsZWQiLAoJCSJzU29ydGFibGVEZXNjIjogInNvcnRpbmdfZGVzY19kaXNhYmxlZCIsCgkJInNTb3J0YWJsZU5vbmUiOiAic29ydGluZ19kaXNhYmxlZCIsCgkJInNTb3J0Q29sdW1uIjogInNvcnRpbmdfIiwgLyogTm90ZSB0aGF0IGFuIGludCBpcyBwb3N0Zml4ZWQgZm9yIHRoZSBzb3J0aW5nIG9yZGVyICovCgkJInNTb3J0SlVJQXNjIjogIiIsCgkJInNTb3J0SlVJRGVzYyI6ICIiLAoJCSJzU29ydEpVSSI6ICIiLAoJCSJzU29ydEpVSUFzY0FsbG93ZWQiOiAiIiwKCQkic1NvcnRKVUlEZXNjQWxsb3dlZCI6ICIiLAoJCSJzU29ydEpVSVdyYXBwZXIiOiAiIiwKCQkic1NvcnRJY29uIjogIiIsCgkJCgkJLyogU2Nyb2xsaW5nICovCgkJInNTY3JvbGxXcmFwcGVyIjogImRhdGFUYWJsZXNfc2Nyb2xsIiwKCQkic1Njcm9sbEhlYWQiOiAiZGF0YVRhYmxlc19zY3JvbGxIZWFkIiwKCQkic1Njcm9sbEhlYWRJbm5lciI6ICJkYXRhVGFibGVzX3Njcm9sbEhlYWRJbm5lciIsCgkJInNTY3JvbGxCb2R5IjogImRhdGFUYWJsZXNfc2Nyb2xsQm9keSIsCgkJInNTY3JvbGxGb290IjogImRhdGFUYWJsZXNfc2Nyb2xsRm9vdCIsCgkJInNTY3JvbGxGb290SW5uZXIiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290SW5uZXIiLAoJCQoJCS8qIE1pc2MgKi8KCQkic0Zvb3RlclRIIjogIiIsCgkJInNKVUlIZWFkZXIiOiAiIiwKCQkic0pVSUZvb3RlciI6ICIiCgl9ICk7CgkKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub0pVSUNsYXNzZXMsIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMsIHsKCQkvKiBUd28gYnV0dG9ucyBidXR0b25zICovCgkJInNQYWdlUHJldkVuYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1sZWZ0IiwKCQkic1BhZ2VQcmV2RGlzYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1sZWZ0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VOZXh0RW5hYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXJpZ2h0IiwKCQkic1BhZ2VOZXh0RGlzYWJsZWQiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1yaWdodCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlSlVJTmV4dCI6ICJ1aS1pY29uIHVpLWljb24tY2lyY2xlLWFycm93LWUiLAoJCSJzUGFnZUpVSVByZXYiOiAidWktaWNvbiB1aS1pY29uLWNpcmNsZS1hcnJvdy13IiwKCQkKCQkvKiBGdWxsIG51bWJlcnMgcGFnaW5nIGJ1dHRvbnMgKi8KCQkic1BhZ2VCdXR0b24iOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1BhZ2VCdXR0b25BY3RpdmUiOiAiZmctYnV0dG9uIHVpLWJ1dHRvbiB1aS1zdGF0ZS1kZWZhdWx0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VCdXR0b25TdGF0aWNEaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZUZpcnN0IjogImZpcnN0IHVpLWNvcm5lci10bCB1aS1jb3JuZXItYmwiLAoJCSJzUGFnZUxhc3QiOiAibGFzdCB1aS1jb3JuZXItdHIgdWktY29ybmVyLWJyIiwKCQkKCQkvKiBGZWF0dXJlcyAqLwoJCSJzUGFnaW5nIjogImRhdGFUYWJsZXNfcGFnaW5hdGUgZmctYnV0dG9uc2V0IHVpLWJ1dHRvbnNldCBmZy1idXR0b25zZXQtbXVsdGkgIisKCQkJInVpLWJ1dHRvbnNldC1tdWx0aSBwYWdpbmdfIiwgLyogTm90ZSB0aGF0IHRoZSB0eXBlIGlzIHBvc3RmaXhlZCAqLwoJCQoJCS8qIFNvcnRpbmcgKi8KCQkic1NvcnRBc2MiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0RGVzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGVBc2MiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZURlc2MiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZU5vbmUiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0SlVJQXNjIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tdHJpYW5nbGUtMS1uIiwKCQkic1NvcnRKVUlEZXNjIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tdHJpYW5nbGUtMS1zIiwKCQkic1NvcnRKVUkiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi1jYXJhdC0yLW4tcyIsCgkJInNTb3J0SlVJQXNjQWxsb3dlZCI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTEtbiIsCgkJInNTb3J0SlVJRGVzY0FsbG93ZWQiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi1jYXJhdC0xLXMiLAoJCSJzU29ydEpVSVdyYXBwZXIiOiAiRGF0YVRhYmxlc19zb3J0X3dyYXBwZXIiLAoJCSJzU29ydEljb24iOiAiRGF0YVRhYmxlc19zb3J0X2ljb24iLAoJCQoJCS8qIFNjcm9sbGluZyAqLwoJCSJzU2Nyb2xsSGVhZCI6ICJkYXRhVGFibGVzX3Njcm9sbEhlYWQgdWktc3RhdGUtZGVmYXVsdCIsCgkJInNTY3JvbGxGb290IjogImRhdGFUYWJsZXNfc2Nyb2xsRm9vdCB1aS1zdGF0ZS1kZWZhdWx0IiwKCQkKCQkvKiBNaXNjICovCgkJInNGb290ZXJUSCI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic0pVSUhlYWRlciI6ICJmZy10b29sYmFyIHVpLXRvb2xiYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItdGwgdWktY29ybmVyLXRyIHVpLWhlbHBlci1jbGVhcmZpeCIsCgkJInNKVUlGb290ZXIiOiAiZmctdG9vbGJhciB1aS10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWJsIHVpLWNvcm5lci1iciB1aS1oZWxwZXItY2xlYXJmaXgiCgl9ICk7CgkKCQoJLyoKCSAqIFZhcmlhYmxlOiBvUGFnaW5hdGlvbgoJICogUHVycG9zZTogIAoJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQKCSAqLwoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1BhZ2luYXRpb24sIHsKCQkvKgoJCSAqIFZhcmlhYmxlOiB0d29fYnV0dG9uCgkJICogUHVycG9zZTogIFN0YW5kYXJkIHR3byBidXR0b24gKGZvcndhcmQvYmFjaykgcGFnaW5hdGlvbgoJCSAqIFNjb3BlOiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uCgkJICovCgkJInR3b19idXR0b24iOiB7CgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi50d29fYnV0dG9uLmZuSW5pdAoJCQkgKiBQdXJwb3NlOiAgSW5pdGlhbGlzZSBkb20gZWxlbWVudHMgcmVxdWlyZWQgZm9yIHBhZ2luYXRpb24gd2l0aCBmb3J3YXJkL2JhY2sgYnV0dG9ucyBvbmx5CgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIG5vZGU6blBhZ2luZyAtIHRoZSBESVYgd2hpY2ggY29udGFpbnMgdGhpcyBwYWdpbmF0aW9uIGNvbnRyb2wKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB3aGljaCBtdXN0IGJlIGNhbGxlZCBvbiB1cGRhdGUKCQkJICovCgkJCSJmbkluaXQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgblBhZ2luZywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQl2YXIgb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZTsKCQkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCXZhciBmbkNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICggZSApIHsKCQkJCQlpZiAoIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLmFjdGlvbiApICkKCQkJCQl7CgkJCQkJCWZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQl9OwoJCgkJCQl2YXIgc0FwcGVuZCA9ICghb1NldHRpbmdzLmJKVUkpID8KCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj4nK29MYW5nLnNQcmV2aW91cysnPC9hPicrCgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+JytvTGFuZy5zTmV4dCsnPC9hPicKCQkJCQk6CgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZVByZXZEaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+PHNwYW4gY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlSlVJUHJldisnIj48L3NwYW4+PC9hPicrCgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+PHNwYW4gY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlSlVJTmV4dCsnIj48L3NwYW4+PC9hPic7CgkJCQkkKG5QYWdpbmcpLmFwcGVuZCggc0FwcGVuZCApOwoJCQkJCgkJCQl2YXIgZWxzID0gJCgnYScsIG5QYWdpbmcpOwoJCQkJdmFyIG5QcmV2aW91cyA9IGVsc1swXSwKCQkJCQluTmV4dCA9IGVsc1sxXTsKCQkJCQoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggblByZXZpb3VzLCB7YWN0aW9uOiAicHJldmlvdXMifSwgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5OZXh0LCAgICAge2FjdGlvbjogIm5leHQifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQkKCQkJCS8qIElEIHRoZSBmaXJzdCBlbGVtZW50cyBvbmx5ICovCgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJblBhZ2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3BhZ2luYXRlJzsKCQkJCQluUHJldmlvdXMuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19wcmV2aW91cyc7CgkJCQkJbk5leHQuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19uZXh0JzsKCQoJCQkJCW5QcmV2aW91cy5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBvU2V0dGluZ3Muc1RhYmxlSWQpOwoJCQkJCW5OZXh0LnNldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24udHdvX2J1dHRvbi5mblVwZGF0ZQoJCQkgKiBQdXJwb3NlOiAgVXBkYXRlIHRoZSB0d28gYnV0dG9uIHBhZ2luYXRpb24gYXQgdGhlIGVuZCBvZiB0aGUgZHJhdwoJCQkgKiBSZXR1cm5zOiAgLQoJCQkgKiBJbnB1dHM6ICAgb2JqZWN0Om9TZXR0aW5ncyAtIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJCSAqICAgICAgICAgICBmdW5jdGlvbjpmbkNhbGxiYWNrRHJhdyAtIGRyYXcgZnVuY3Rpb24gdG8gY2FsbCBvbiBwYWdlIGNoYW5nZQoJCQkgKi8KCQkJImZuVXBkYXRlIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGZuQ2FsbGJhY2tEcmF3ICkKCQkJewoJCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5baV0uY2hpbGROb2Rlcy5sZW5ndGggIT09IDAgKQoJCQkJCXsKCQkJCQkJYW5baV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUgPSAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApID8gCgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZVByZXZEaXNhYmxlZCA6IG9DbGFzc2VzLnNQYWdlUHJldkVuYWJsZWQ7CgkJCQkJCQoJCQkJCQlhbltpXS5jaGlsZE5vZGVzWzFdLmNsYXNzTmFtZSA9ICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpID09IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKSA/IAoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VOZXh0RGlzYWJsZWQgOiBvQ2xhc3Nlcy5zUGFnZU5leHRFbmFibGVkOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0sCgkJCgkJCgkJLyoKCQkgKiBWYXJpYWJsZTogaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzCgkJICogUHVycG9zZTogIENoYW5nZSB0aGUgbnVtYmVyIG9mIHBhZ2VzIHdoaWNoIGNhbiBiZSBzZWVuCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkiaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzIjogNSwKCQkKCQkvKgoJCSAqIFZhcmlhYmxlOiBmdWxsX251bWJlcnMKCQkgKiBQdXJwb3NlOiAgRnVsbCBudW1iZXJzIHBhZ2luYXRpb24KCQkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCSJmdWxsX251bWJlcnMiOiB7CgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi5mdWxsX251bWJlcnMuZm5Jbml0CgkJCSAqIFB1cnBvc2U6ICBJbml0aWFsaXNlIGRvbSBlbGVtZW50cyByZXF1aXJlZCBmb3IgcGFnaW5hdGlvbiB3aXRoIGEgbGlzdCBvZiB0aGUgcGFnZXMKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgbm9kZTpuUGFnaW5nIC0gdGhlIERJViB3aGljaCBjb250YWlucyB0aGlzIHBhZ2luYXRpb24gY29udHJvbAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIG9uIHVwZGF0ZQoJCQkgKi8KCQkJImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGZuQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKCBlICkgewoJCQkJCWlmICggb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEuYWN0aW9uICkgKQoJCQkJCXsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCX07CgkKCQkJCSQoblBhZ2luZykuYXBwZW5kKAoJCQkJCSc8YSAgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VGaXJzdCsnIj4nK29MYW5nLnNGaXJzdCsnPC9hPicrCgkJCQkJJzxhICB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZVByZXZpb3VzKyciPicrb0xhbmcuc1ByZXZpb3VzKyc8L2E+JysKCQkJCQknPHNwYW4+PC9zcGFuPicrCgkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlTmV4dCsnIj4nK29MYW5nLnNOZXh0Kyc8L2E+JysKCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VMYXN0KyciPicrb0xhbmcuc0xhc3QrJzwvYT4nCgkJCQkpOwoJCQkJdmFyIGVscyA9ICQoJ2EnLCBuUGFnaW5nKTsKCQkJCXZhciBuRmlyc3QgPSBlbHNbMF0sCgkJCQkJblByZXYgPSBlbHNbMV0sCgkJCQkJbk5leHQgPSBlbHNbMl0sCgkJCQkJbkxhc3QgPSBlbHNbM107CgkJCQkKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5GaXJzdCwge2FjdGlvbjogImZpcnN0In0sICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuUHJldiwgIHthY3Rpb246ICJwcmV2aW91cyJ9LCBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbk5leHQsICB7YWN0aW9uOiAibmV4dCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5MYXN0LCAge2FjdGlvbjogImxhc3QifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQkKCQkJCS8qIElEIHRoZSBmaXJzdCBlbGVtZW50cyBvbmx5ICovCgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJblBhZ2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3BhZ2luYXRlJzsKCQkJCQluRmlyc3QuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX2ZpcnN0JzsKCQkJCQluUHJldi5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfcHJldmlvdXMnOwoJCQkJCW5OZXh0LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19uZXh0JzsKCQkJCQluTGFzdC5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfbGFzdCc7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24uZnVsbF9udW1iZXJzLmZuVXBkYXRlCgkJCSAqIFB1cnBvc2U6ICBVcGRhdGUgdGhlIGxpc3Qgb2YgcGFnZSBidXR0b25zIHNob3dzCgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB0byBjYWxsIG9uIHBhZ2UgY2hhbmdlCgkJCSAqLwoJCQkiZm5VcGRhdGUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQl2YXIgaVBhZ2VDb3VudCA9IERhdGFUYWJsZS5leHQub1BhZ2luYXRpb24uaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzOwoJCQkJdmFyIGlQYWdlQ291bnRIYWxmID0gTWF0aC5mbG9vcihpUGFnZUNvdW50IC8gMik7CgkJCQl2YXIgaVBhZ2VzID0gTWF0aC5jZWlsKChvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpKSAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgpOwoJCQkJdmFyIGlDdXJyZW50UGFnZSA9IE1hdGguY2VpbChvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKSArIDE7CgkJCQl2YXIgc0xpc3QgPSAiIjsKCQkJCXZhciBpU3RhcnRCdXR0b24sIGlFbmRCdXR0b24sIGksIGlMZW47CgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgYW5CdXR0b25zLCBhblN0YXRpYywgblBhZ2luYXRlTGlzdDsKCQkJCXZhciBhbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wOwoJCQkJdmFyIGZuQmluZCA9IGZ1bmN0aW9uIChqKSB7CgkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggdGhpcywgeyJwYWdlIjogaitpU3RhcnRCdXR0b24tMX0sIGZ1bmN0aW9uKGUpIHsKCQkJCQkJLyogVXNlIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgZWxlbWVudCB0byBqdW1wIHRvIHRoZSByZXF1aXJlZCBwYWdlICovCgkJCQkJCW9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLnBhZ2UgKTsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJfSApOwoJCQkJfTsKCQkJCQoJCQkJLyogUGFnZXMgY2FsY3VsYXRpb24gKi8KCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA9PT0gLTEgKQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IDE7CgkJCQkJaUVuZEJ1dHRvbiA9IDE7CgkJCQkJaUN1cnJlbnRQYWdlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKGlQYWdlcyA8IGlQYWdlQ291bnQpCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gaVBhZ2VzOwoJCQkJfQoJCQkJZWxzZSBpZiAoaUN1cnJlbnRQYWdlIDw9IGlQYWdlQ291bnRIYWxmKQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlQYWdlQ291bnQ7CgkJCQl9CgkJCQllbHNlIGlmIChpQ3VycmVudFBhZ2UgPj0gKGlQYWdlcyAtIGlQYWdlQ291bnRIYWxmKSkKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSBpUGFnZXMgLSBpUGFnZUNvdW50ICsgMTsKCQkJCQlpRW5kQnV0dG9uID0gaVBhZ2VzOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IGlDdXJyZW50UGFnZSAtIE1hdGguY2VpbChpUGFnZUNvdW50IC8gMikgKyAxOwoJCQkJCWlFbmRCdXR0b24gPSBpU3RhcnRCdXR0b24gKyBpUGFnZUNvdW50IC0gMTsKCQkJCX0KCQoJCQkJCgkJCQkvKiBCdWlsZCB0aGUgZHluYW1pYyBsaXN0ICovCgkJCQlmb3IgKCBpPWlTdGFydEJ1dHRvbiA7IGk8PWlFbmRCdXR0b24gOyBpKysgKQoJCQkJewoJCQkJCXNMaXN0ICs9IChpQ3VycmVudFBhZ2UgIT09IGkpID8KCQkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rJyI+JytvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoaSkrJzwvYT4nIDoKCQkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b25BY3RpdmUrJyI+JytvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoaSkrJzwvYT4nOwoJCQkJfQoJCQkJCgkJCQkvKiBMb29wIG92ZXIgZWFjaCBpbnN0YW5jZSBvZiB0aGUgcGFnZXIgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5baV0uY2hpbGROb2Rlcy5sZW5ndGggPT09IDAgKQoJCQkJCXsKCQkJCQkJY29udGludWU7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIEJ1aWxkIHVwIHRoZSBkeW5hbWljIGxpc3QgZmlyc3QgLSBodG1sIGFuZCBsaXN0ZW5lcnMgKi8KCQkJCQkkKCdzcGFuOmVxKDApJywgYW5baV0pCgkJCQkJCS5odG1sKCBzTGlzdCApCgkJCQkJCS5jaGlsZHJlbignYScpLmVhY2goIGZuQmluZCApOwoJCQkJCQoJCQkJCS8qIFVwZGF0ZSB0aGUgcGVybWFuZW50IGJ1dHRvbidzIGNsYXNzZXMgKi8KCQkJCQlhbkJ1dHRvbnMgPSBhbltpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpOwoJCQkJCWFuU3RhdGljID0gWwoJCQkJCQlhbkJ1dHRvbnNbMF0sIGFuQnV0dG9uc1sxXSwgCgkJCQkJCWFuQnV0dG9uc1thbkJ1dHRvbnMubGVuZ3RoLTJdLCBhbkJ1dHRvbnNbYW5CdXR0b25zLmxlbmd0aC0xXQoJCQkJCV07CgkKCQkJCQkkKGFuU3RhdGljKS5yZW1vdmVDbGFzcyggb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlQnV0dG9uQWN0aXZlKyIgIitvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkICk7CgkJCQkJJChbYW5TdGF0aWNbMF0sIGFuU3RhdGljWzFdXSkuYWRkQ2xhc3MoIAoJCQkJCQkoaUN1cnJlbnRQYWdlPT0xKSA/CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIDoKCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uCgkJCQkJKTsKCQkJCQkkKFthblN0YXRpY1syXSwgYW5TdGF0aWNbM11dKS5hZGRDbGFzcygKCQkJCQkJKGlQYWdlcz09PTAgfHwgaUN1cnJlbnRQYWdlPT09aVBhZ2VzIHx8IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg9PT0tMSkgPwoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VCdXR0b25TdGF0aWNEaXNhYmxlZCA6CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvbgoJCQkJCSk7CgkJCQl9CgkJCX0KCQl9Cgl9ICk7CgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9Tb3J0LCB7CgkJLyoKCQkgKiB0ZXh0IHNvcnRpbmcKCQkgKi8KCQkic3RyaW5nLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQlpZiAoIHR5cGVvZiBhICE9ICdzdHJpbmcnICkgewoJCQkJYSA9IChhICE9PSBudWxsICYmIGEudG9TdHJpbmcpID8gYS50b1N0cmluZygpIDogJyc7CgkJCX0KCQkJcmV0dXJuIGEudG9Mb3dlckNhc2UoKTsKCQl9LAoJCgkJInN0cmluZy1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJfSwKCQkKCQkic3RyaW5nLWRlc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIGh0bWwgc29ydGluZyAoaWdub3JlIGh0bWwgdGFncykKCQkgKi8KCQkiaHRtbC1wcmUiOiBmdW5jdGlvbiAoIGEgKQoJCXsKCQkJcmV0dXJuIGEucmVwbGFjZSggLzwuKj8+L2csICIiICkudG9Mb3dlckNhc2UoKTsKCQl9LAoJCQoJCSJodG1sLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQl9LAoJCQoJCSJodG1sLWRlc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIGRhdGUgc29ydGluZwoJCSAqLwoJCSJkYXRlLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQl2YXIgeCA9IERhdGUucGFyc2UoIGEgKTsKCQkJCgkJCWlmICggaXNOYU4oeCkgfHwgeD09PSIiICkKCQkJewoJCQkJeCA9IERhdGUucGFyc2UoICIwMS8wMS8xOTcwIDAwOjAwOjAwIiApOwoJCQl9CgkJCXJldHVybiB4OwoJCX0sCgkKCQkiZGF0ZS1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuIHggLSB5OwoJCX0sCgkJCgkJImRhdGUtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geSAtIHg7CgkJfSwKCQkKCQkKCQkvKgoJCSAqIG51bWVyaWNhbCBzb3J0aW5nCgkJICovCgkJIm51bWVyaWMtcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCXJldHVybiAoYT09Ii0iIHx8IGE9PT0iIikgPyAwIDogYSoxOwoJCX0sCgkKCQkibnVtZXJpYy1hc2MiOiBmdW5jdGlvbiAoIHgsIHkgKQoJCXsKCQkJcmV0dXJuIHggLSB5OwoJCX0sCgkJCgkJIm51bWVyaWMtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geSAtIHg7CgkJfQoJfSApOwoJCgkKCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0LmFUeXBlcywgWwoJCS8qCgkJICogRnVuY3Rpb246IC0KCQkgKiBQdXJwb3NlOiAgQ2hlY2sgdG8gc2VlIGlmIGEgc3RyaW5nIGlzIG51bWVyaWMKCQkgKiBSZXR1cm5zOiAgc3RyaW5nOidudW1lcmljJyBvciBudWxsCgkJICogSW5wdXRzOiAgIG1peGVkOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQkvKiBBbGxvdyB6ZXJvIGxlbmd0aCBzdHJpbmdzIGFzIGEgbnVtYmVyICovCgkJCWlmICggdHlwZW9mIHNEYXRhID09PSAnbnVtYmVyJyApCgkJCXsKCQkJCXJldHVybiAnbnVtZXJpYyc7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSAhPT0gJ3N0cmluZycgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJdmFyIHNWYWxpZEZpcnN0Q2hhcnMgPSAiMDEyMzQ1Njc4OS0iOwoJCQl2YXIgc1ZhbGlkQ2hhcnMgPSAiMDEyMzQ1Njc4OS4iOwoJCQl2YXIgQ2hhcjsKCQkJdmFyIGJEZWNpbWFsID0gZmFsc2U7CgkJCQoJCQkvKiBDaGVjayBmb3IgYSB2YWxpZCBmaXJzdCBjaGFyIChubyBwZXJpb2QgYW5kIGFsbG93IG5lZ2F0aXZlcykgKi8KCQkJQ2hhciA9IHNEYXRhLmNoYXJBdCgwKTsgCgkJCWlmIChzVmFsaWRGaXJzdENoYXJzLmluZGV4T2YoQ2hhcikgPT0gLTEpIAoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgYWxsIHRoZSBvdGhlciBjaGFyYWN0ZXJzIGFyZSB2YWxpZCAqLwoJCQlmb3IgKCB2YXIgaT0xIDsgaTxzRGF0YS5sZW5ndGggOyBpKysgKSAKCQkJewoJCQkJQ2hhciA9IHNEYXRhLmNoYXJBdChpKTsgCgkJCQlpZiAoc1ZhbGlkQ2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgCgkJCQl7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9CgkJCQkKCQkJCS8qIE9ubHkgYWxsb3dlZCBvbmUgZGVjaW1hbCBwbGFjZS4uLiAqLwoJCQkJaWYgKCBDaGFyID09ICIuIiApCgkJCQl7CgkJCQkJaWYgKCBiRGVjaW1hbCApCgkJCQkJewoJCQkJCQlyZXR1cm4gbnVsbDsKCQkJCQl9CgkJCQkJYkRlY2ltYWwgPSB0cnVlOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gJ251bWVyaWMnOwoJCX0sCgkJCgkJLyoKCQkgKiBGdW5jdGlvbjogLQoJCSAqIFB1cnBvc2U6ICBDaGVjayB0byBzZWUgaWYgYSBzdHJpbmcgaXMgYWN0dWFsbHkgYSBmb3JtYXR0ZWQgZGF0ZQoJCSAqIFJldHVybnM6ICBzdHJpbmc6J2RhdGUnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgc3RyaW5nOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQl2YXIgaVBhcnNlID0gRGF0ZS5wYXJzZShzRGF0YSk7CgkJCWlmICggKGlQYXJzZSAhPT0gbnVsbCAmJiAhaXNOYU4oaVBhcnNlKSkgfHwgKHR5cGVvZiBzRGF0YSA9PT0gJ3N0cmluZycgJiYgc0RhdGEubGVuZ3RoID09PSAwKSApCgkJCXsKCQkJCXJldHVybiAnZGF0ZSc7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfSwKCQkKCQkvKgoJCSAqIEZ1bmN0aW9uOiAtCgkJICogUHVycG9zZTogIENoZWNrIHRvIHNlZSBpZiBhIHN0cmluZyBzaG91bGQgYmUgdHJlYXRlZCBhcyBhbiBIVE1MIHN0cmluZwoJCSAqIFJldHVybnM6ICBzdHJpbmc6J2h0bWwnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgc3RyaW5nOnNUZXh0IC0gc3RyaW5nIHRvIGNoZWNrCgkJICovCgkJZnVuY3Rpb24gKCBzRGF0YSApCgkJewoJCQlpZiAoIHR5cGVvZiBzRGF0YSA9PT0gJ3N0cmluZycgJiYgc0RhdGEuaW5kZXhPZignPCcpICE9IC0xICYmIHNEYXRhLmluZGV4T2YoJz4nKSAhPSAtMSApCgkJCXsKCQkJCXJldHVybiAnaHRtbCc7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoJXSApOwoJCgoJLy8galF1ZXJ5IGFsaWFzZXMKCSQuZm4uRGF0YVRhYmxlID0gRGF0YVRhYmxlOwoJJC5mbi5kYXRhVGFibGUgPSBEYXRhVGFibGU7CgkkLmZuLmRhdGFUYWJsZVNldHRpbmdzID0gRGF0YVRhYmxlLnNldHRpbmdzOwoJJC5mbi5kYXRhVGFibGVFeHQgPSBEYXRhVGFibGUuZXh0OwoKCgkvLyBJbmZvcm1hdGlvbiBhYm91dCBldmVudHMgZmlyZWQgYnkgRGF0YVRhYmxlcyAtIGZvciBkb2N1bWVudGF0aW9uLgoJLyoqCgkgKiBEcmF3IGV2ZW50LCBmaXJlZCB3aGVuZXZlciB0aGUgdGFibGUgaXMgcmVkcmF3biBvbiB0aGUgcGFnZSwgYXQgdGhlIHNhbWUgcG9pbnQgYXMKCSAqIGZuRHJhd0NhbGxiYWNrLiBUaGlzIG1heSBiZSB1c2VmdWwgZm9yIGJpbmRpbmcgZXZlbnRzIG9yIHBlcmZvcm1pbmcgY2FsY3VsYXRpb25zIHdoZW4KCSAqIHRoZSB0YWJsZSBpcyBhbHRlcmVkIGF0IGFsbC4KCSAqICBAbmFtZSBEYXRhVGFibGUjZHJhdwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogRmlsdGVyIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSBmaWx0ZXJpbmcgYXBwbGllZCB0byB0aGUgdGFibGUgKHVzaW5nIHRoZSBidWlsZCBpbiBnbG9iYWwKCSAqIGdsb2JhbCBmaWx0ZXIsIG9yIGNvbHVtbiBmaWx0ZXJzKSBpcyBhbHRlcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNmaWx0ZXIKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIFBhZ2UgY2hhbmdlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSBwYWdpbmcgb2YgdGhlIHRhYmxlIGlzIGFsdGVyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3BhZ2UKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIFNvcnQgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHNvcnRpbmcgYXBwbGllZCB0byB0aGUgdGFibGUgaXMgYWx0ZXJlZC4KCSAqICBAbmFtZSBEYXRhVGFibGUjc29ydAoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogRGF0YVRhYmxlcyBpbml0aWFsaXNhdGlvbiBjb21wbGV0ZSBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaXMgZnVsbHkgZHJhd24sCgkgKiBpbmNsdWRpbmcgQWpheCBkYXRhIGxvYWRlZCwgaWYgQWpheCBkYXRhIGlzIHJlcXVpcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNpbml0CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBKU09OIG9iamVjdCByZXF1ZXN0IGZyb20gdGhlIHNlcnZlciAtIG9ubHkKCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZDwvbGk+PC9vbD4KCSAqLwoKCS8qKgoJICogU3RhdGUgc2F2ZSBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaGFzIGNoYW5nZWQgc3RhdGUgYSBuZXcgc3RhdGUgc2F2ZSBpcyByZXF1aXJlZC4KCSAqIFRoaXMgbWV0aG9kIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHN0YXRlIHNhdmluZyBvYmplY3QgcHJpb3IgdG8gYWN0dWFsbHkgZG9pbmcgdGhlCgkgKiBzYXZlLCBpbmNsdWRpbmcgYWRkaXRpb24gb3Igb3RoZXIgc3RhdGUgcHJvcGVydGllcyAoZm9yIHBsdWctaW5zKSBvciBtb2RpZmljYXRpb24KCSAqIG9mIGEgRGF0YVRhYmxlcyBjb3JlIHByb3BlcnR5LgoJICogIEBuYW1lIERhdGFUYWJsZSNzdGF0ZVNhdmVQYXJhbXMKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIHN0YXRlIGluZm9ybWF0aW9uIHRvIGJlIHNhdmVkCgkgKi8KCgkvKioKCSAqIFN0YXRlIGxvYWQgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHRhYmxlIGlzIGxvYWRpbmcgc3RhdGUgZnJvbSB0aGUgc3RvcmVkIGRhdGEsIGJ1dAoJICogcHJpb3IgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBiZWluZyBtb2RpZmllZCBieSB0aGUgc2F2ZWQgc3RhdGUgLSBhbGxvd2luZyBtb2RpZmljYXRpb24KCSAqIG9mIHRoZSBzYXZlZCBzdGF0ZSBpcyByZXF1aXJlZCBvciBsb2FkaW5nIG9mIHN0YXRlIGZvciBhIHBsdWctaW4uCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlTG9hZFBhcmFtcwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBUaGUgc2F2ZWQgc3RhdGUgaW5mb3JtYXRpb24KCSAqLwoKCS8qKgoJICogU3RhdGUgbG9hZGVkIGV2ZW50LCBmaXJlZCB3aGVuIHN0YXRlIGhhcyBiZWVuIGxvYWRlZCBmcm9tIHN0b3JlZCBkYXRhIGFuZCB0aGUgc2V0dGluZ3MKCSAqIG9iamVjdCBoYXMgYmVlbiBtb2RpZmllZCBieSB0aGUgbG9hZGVkIGRhdGEuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlTG9hZGVkCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBzYXZlZCBzdGF0ZSBpbmZvcm1hdGlvbgoJICovCgoJLyoqCgkgKiBQcm9jZXNzaW5nIGV2ZW50LCBmaXJlZCB3aGVuIERhdGFUYWJsZXMgaXMgZG9pbmcgc29tZSBraW5kIG9mIHByb2Nlc3NpbmcgKGJlIGl0LAoJICogc29ydCwgZmlsdGVyIG9yIGFueXRoaW5nIGVsc2UpLiBDYW4gYmUgdXNlZCB0byBpbmRpY2F0ZSB0byB0aGUgZW5kIHVzZXIgdGhhdAoJICogdGhlcmUgaXMgc29tZXRoaW5nIGhhcHBlbmluZywgb3IgdGhhdCBzb21ldGhpbmcgaGFzIGZpbmlzaGVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNwcm9jZXNzaW5nCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7Ym9vbGVhbn0gYlNob3cgRmxhZyBmb3IgaWYgRGF0YVRhYmxlcyBpcyBkb2luZyBwcm9jZXNzaW5nIG9yIG5vdAoJICovCgoJLyoqCgkgKiBBamF4IChYSFIpIGV2ZW50LCBmaXJlZCB3aGVuZXZlciBhbiBBamF4IHJlcXVlc3QgaXMgY29tcGxldGVkIGZyb20gYSByZXF1ZXN0IHRvIAoJICogbWFkZSB0byB0aGUgc2VydmVyIGZvciBuZXcgZGF0YSAobm90ZSB0aGF0IHRoaXMgdHJpZ2dlciBpcyBjYWxsZWQgaW4gZm5TZXJ2ZXJEYXRhLAoJICogaWYgeW91IG92ZXJyaWRlIGZuU2VydmVyRGF0YSBhbmQgd2hpY2ggdG8gdXNlIHRoaXMgZXZlbnQsIHlvdSBuZWVkIHRvIHRyaWdnZXIgaXQgaW4KCSAqIHlvdSBzdWNjZXNzIGZ1bmN0aW9uKS4KCSAqICBAbmFtZSBEYXRhVGFibGUjeGhyCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIEpTT04gcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyCgkgKi8KCgkvKioKCSAqIERlc3Ryb3kgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIERhdGFUYWJsZSBpcyBkZXN0cm95ZWQgYnkgY2FsbGluZyBmbkRlc3Ryb3kgb3IgcGFzc2luZwoJICogdGhlIGJEZXN0cm95OnRydWUgcGFyYW1ldGVyIGluIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QuIFRoaXMgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlCgkgKiBib3VuZCBldmVudHMsIGFkZGVkIERPTSBub2RlcywgZXRjLgoJICogIEBuYW1lIERhdGFUYWJsZSNkZXN0cm95CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCn0oalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpKTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 03:54:55 GMT",
                    "Content-Length": "377676",
                    "Date": "Sat, 08 Nov 2014 03:55:09 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}