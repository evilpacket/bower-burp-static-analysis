{
    "url": "http://localhost:9999/pqe/widgetfly/dist/widgetfly.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Client-side JSON injection (DOM-based)",
    "issueType": 2098032,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based JSON injection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and incorporates this into a string that is parsed as a JSON data structure and then processed by the application. An attacker may be able to use this behavior to construct a URL which, if visited by another application user, will cause arbitrary JSON data to be processed. Depending on the purpose for which this data is used, it may be possible to subvert the application's logic, or cause unintended actions on behalf of the user.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based JSON injection vulnerabilities is not to parse as JSON any string containing data that originated from an untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from modifying the JSON structure in inappropriate ways. This may involve strict validation of specific items to ensure they do not contain any characters that may interfere with the structure of the JSON when it is parsed.",
    "issueDetail": "The application may be vulnerable to DOM-based client-side JSON injection. Data is read from <b>window.location.hash</b> and written to <b>JSON.parse()</b> via the following statements:<ul><li>var self = this, paramData = decodeURIComponent(window.location.hash.substring(1));</li><li>this.options = JSON.parse(paramData);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/pqe/widgetfly/dist/widgetfly.js",
                "path": "/pqe/widgetfly/dist/widgetfly.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9wcWUvd2lkZ2V0Zmx5L2Rpc3Qvd2lkZ2V0Zmx5LmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNTE0OTMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFN1biwgMDkgTm92IDIwMTQgMDI6NTY6MDAgR01UDQpMYXN0LU1vZGlmaWVkOiBTdW4sIDA5IE5vdiAyMDE0IDAyOjU2OjAwIEdNVA0KDQovKgogKiBXaWRnZXRmbHkKICogQSBqYXZhc2NyaXB0IGxpYnJhcnkgZm9yIGJ1aWxkaW5nIGNyb3NzLXNpdGUgd2ViIHdpZGdldHMuCiAqIEBsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9xcGUvd2lkZ2V0Zmx5CiAqIEBhdXRob3IgaHNmZW5nCiAqIEB2ZXJzaW9uIDAuMS4zCiAqIEBsaWNlbnNlIGh0dHBzOi8vZ2l0aHViLmNvbS9xcGUvd2lkZ2V0Zmx5L2Jsb2IvbWFzdGVyL0xJQ0VOU0UKICogQGNvcHlyaWdodCBoc2ZlbmcKICovCihmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7J3VzZSBzdHJpY3QnOwoJCWlmICggdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CgkJCS8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KCQkJZGVmaW5lKFtdLCBmdW5jdGlvbigpIHsKCQkJCS8vIEFsc28gY3JlYXRlIGEgZ2xvYmFsIGluIGNhc2Ugc29tZSBzY3JpcHRzCgkJCQkvLyB0aGF0IGFyZSBsb2FkZWQgc3RpbGwgYXJlIGxvb2tpbmcgZm9yCgkJCQkvLyBhIGdsb2JhbCBldmVuIHdoZW4gYW4gQU1EIGxvYWRlciBpcyBpbiB1c2UuCgkJCQlyZXR1cm4gKHJvb3QuV2lkZ2V0Zmx5ID0gZmFjdG9yeShyb290KSk7CgkJCX0pOwoJCX0gZWxzZSB7CgkJCS8vIEJyb3dzZXIgZ2xvYmFscwoJCQlyb290LldpZGdldGZseSA9IGZhY3Rvcnkocm9vdCk7CgkJfQoJfSh0aGlzLCBmdW5jdGlvbihnbG9iYWwpIHsKCQkndXNlIHN0cmljdCc7CgkJdmFyIFdpZGdldGZseSA9IChmdW5jdGlvbihnbG9iYWwpewoJCQkndXNlIHN0cmljdCc7CgkJCXZhciBXaWRnZXRmbHk7CgkJCQoJCQlpZihnbG9iYWwuV2lkZ2V0Zmx5KXsKCQkJCVdpZGdldGZseSA9IGdsb2JhbC5XaWRnZXRmbHk7CgkJCQlXaWRnZXRmbHkuaW5pdCgpOwoJCQl9ZWxzZXsKCQkJCVdpZGdldGZseSA9IHt9OwoJCQkJCgkJCQkoZnVuY3Rpb24gKCkgewoJCQkJICAgIC8vIHdpZGdldGZseS5jc3MKCQkJCSAgICB2YXIgY3NzVGV4dCA9ICIiICsKCQkJCSIud2lkZ2V0Zmx5IC53Zi1zaG93LC53aWRnZXRmbHkud2Ytc2hvd3tkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnR9LndpZGdldGZseSAud2YtaGlkZSwud2lkZ2V0Zmx5LndmLWhpZGV7ZGlzcGxheTpub25lICFpbXBvcnRhbnR9LndpZGdldGZseSAud2Ytcm9vdCwud2lkZ2V0Zmx5LndmLXJvb3R7cG9zaXRpb246YWJzb2x1dGU7bGVmdDowcHg7dG9wOi05OTk5cHg7d2lkdGg6NDdweDtoZWlnaHQ6MjlweDt6LWluZGV4Ojk5OTk5OTk5OX0ud2lkZ2V0Zmx5IC53Zi1zcGlubmVyLC53aWRnZXRmbHkud2Ytc3Bpbm5lcnttYXJnaW46MTZweCBhdXRvO3dpZHRoOjUwcHg7aGVpZ2h0OjMwcHg7dGV4dC1hbGlnbjpjZW50ZXI7Zm9udC1zaXplOjEwcHh9LndpZGdldGZseSAud2Ytc3Bpbm5lcj5kaXYsLndpZGdldGZseS53Zi1zcGlubmVyPmRpdntiYWNrZ3JvdW5kLWNvbG9yOiM2NjY7aGVpZ2h0OjEwMCU7d2lkdGg6NnB4O2Rpc3BsYXk6aW5saW5lLWJsb2NrO21hcmdpbjowIDNweCAwIDA7LXdlYmtpdC1hbmltYXRpb246d2Ytc3RyZXRjaGRlbGF5IDEuMnMgaW5maW5pdGUgZWFzZS1pbi1vdXQ7YW5pbWF0aW9uOndmLXN0cmV0Y2hkZWxheSAxLjJzIGluZmluaXRlIGVhc2UtaW4tb3V0fS53aWRnZXRmbHkgLndmLXNwaW5uZXI+LnJlY3QyLC53aWRnZXRmbHkud2Ytc3Bpbm5lcj4ucmVjdDJ7LXdlYmtpdC1hbmltYXRpb24tZGVsYXk6LTEuMXM7YW5pbWF0aW9uLWRlbGF5Oi0xLjFzfS53aWRnZXRmbHkgLndmLXNwaW5uZXI+LnJlY3QzLC53aWRnZXRmbHkud2Ytc3Bpbm5lcj4ucmVjdDN7LXdlYmtpdC1hbmltYXRpb24tZGVsYXk6LTFzO2FuaW1hdGlvbi1kZWxheTotMXN9LndpZGdldGZseSAud2Ytc3Bpbm5lcj4ucmVjdDQsLndpZGdldGZseS53Zi1zcGlubmVyPi5yZWN0NHstd2Via2l0LWFuaW1hdGlvbi1kZWxheTotMC45czthbmltYXRpb24tZGVsYXk6LTAuOXN9LndpZGdldGZseSAud2Ytc3Bpbm5lcj4ucmVjdDUsLndpZGdldGZseS53Zi1zcGlubmVyPi5yZWN0NXstd2Via2l0LWFuaW1hdGlvbi1kZWxheTotMC44czthbmltYXRpb24tZGVsYXk6LTAuOHN9QC13ZWJraXQta2V5ZnJhbWVzIHdmLXN0cmV0Y2hkZWxheXswJSw0MCUsMTAwJXstd2Via2l0LXRyYW5zZm9ybTpzY2FsZVkoLjQpfTIwJXstd2Via2l0LXRyYW5zZm9ybTpzY2FsZVkoMSl9fUBrZXlmcmFtZXMgd2Ytc3RyZXRjaGRlbGF5ezAlLDQwJSwxMDAle3RyYW5zZm9ybTpzY2FsZVkoLjQpOy13ZWJraXQtdHJhbnNmb3JtOnNjYWxlWSguNCl9MjAle3RyYW5zZm9ybTpzY2FsZVkoMSk7LXdlYmtpdC10cmFuc2Zvcm06c2NhbGVZKDEpfX0ud2lkZ2V0Zmx5IC53Zi1wYW5lbCwud2lkZ2V0Zmx5LndmLXBhbmVse3dpZHRoOjEwMCUgIWltcG9ydGFudDtib3JkZXI6bm9uZSAhaW1wb3J0YW50O292ZXJmbG93OmhpZGRlbiAhaW1wb3J0YW50fS53aWRnZXRmbHkgLndmLWFuaW1hdGVkLW1vZGFsLC53aWRnZXRmbHkud2YtYW5pbWF0ZWQtbW9kYWx7LXdlYmtpdC1hbmltYXRpb24tZHVyYXRpb246MC4yczthbmltYXRpb24tZHVyYXRpb246MC4yczstd2Via2l0LWFuaW1hdGlvbi1maWxsLW1vZGU6Ym90aDthbmltYXRpb24tZmlsbC1tb2RlOmJvdGh9QC13ZWJraXQta2V5ZnJhbWVzIHdmLWZhZGVJblVwQmlnezAle29wYWNpdHk6MDstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLCAyMDAwcHgsIDApO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLCAyMDAwcHgsIDApfTEwMCV7b3BhY2l0eToxOy13ZWJraXQtdHJhbnNmb3JtOm5vbmU7dHJhbnNmb3JtOm5vbmV9fUBrZXlmcmFtZXMgd2YtZmFkZUluVXBCaWd7MCV7b3BhY2l0eTowOy13ZWJraXQtdHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsIDIwMDBweCwgMCk7LW1zLXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLCAyMDAwcHgsIDApO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLCAyMDAwcHgsIDApfTEwMCV7b3BhY2l0eToxOy13ZWJraXQtdHJhbnNmb3JtOm5vbmU7LW1zLXRyYW5zZm9ybTpub25lO3RyYW5zZm9ybTpub25lfX0ud2lkZ2V0Zmx5IC53Zi1hbmltYXRlZC1mYWRlSW5VcEJpZ3std2Via2l0LWFuaW1hdGlvbi1uYW1lOndmLWZhZGVJblVwQmlnO2FuaW1hdGlvbi1uYW1lOndmLWZhZGVJblVwQmlnfS53aWRnZXRmbHkgLndmLW1vZGFsLC53aWRnZXRmbHkud2YtbW9kYWx7cG9zaXRpb246Zml4ZWQ7aGVpZ2h0OjEwMCU7dG9wOjA7cmlnaHQ6MDtib3R0b206MDtsZWZ0OjA7ei1pbmRleDoxMDUwO292ZXJmbG93OmhpZGRlbjstd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzp0b3VjaDtvdXRsaW5lOjA7b3BhY2l0eToxfS53aWRnZXRmbHkgLndmLW1vZGFsIC53Zi1tb2RhbC1kaWFsb2csLndpZGdldGZseS53Zi1tb2RhbCAud2YtbW9kYWwtZGlhbG9ney13ZWJraXQtdHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsIDAsIDApOy1vLXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLCAwLCAwKTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwgMCwgMCk7cG9zaXRpb246cmVsYXRpdmU7bWFyZ2luOjMwcHggYXV0bzttaW4td2lkdGg6MjQwcHh9LndpZGdldGZseSAud2YtbW9kYWwgLndmLW1vZGFsLWRpYWxvZyAud2YtbW9kYWwtY29udGVudCwud2lkZ2V0Zmx5LndmLW1vZGFsIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnR7cG9zaXRpb246cmVsYXRpdmU7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JvcmRlcjoxcHggc29saWQgI2NjYztib3JkZXI6MXB4IHNvbGlkIHJnYmEoMCwwLDAsMC4yNik7Ym9yZGVyLXJhZGl1czozcHg7LXdlYmtpdC1ib3gtc2hhZG93OjAgMnB4IDVweCByZ2JhKDAsMCwwLDAuMjYpO2JveC1zaGFkb3c6MCAycHggNXB4IHJnYmEoMCwwLDAsMC4yNik7YmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94O291dGxpbmU6MDtoZWlnaHQ6MTAwJTtvdmVyZmxvdzpoaWRkZW59LndpZGdldGZseSAud2YtbW9kYWwgLndmLW1vZGFsLWRpYWxvZyAud2YtbW9kYWwtY29udGVudCAud2YtbW9kYWwtYm9keSwud2lkZ2V0Zmx5LndmLW1vZGFsIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnQgLndmLW1vZGFsLWJvZHl7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjEwMCV9LndpZGdldGZseSAud2YtbW9kYWwgLndmLW1vZGFsLWRpYWxvZyAud2YtbW9kYWwtY29udGVudCAud2YtY2xvc2UsLndpZGdldGZseS53Zi1tb2RhbCAud2YtbW9kYWwtZGlhbG9nIC53Zi1tb2RhbC1jb250ZW50IC53Zi1jbG9zZXtwb3NpdGlvbjphYnNvbHV0ZTtyaWdodDowcHg7bWFyZ2luLXRvcDotMnB4O21hcmdpbi1yaWdodDo0cHg7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Zm9udC1zaXplOjIxcHg7Zm9udC13ZWlnaHQ6NjAwO2xpbmUtaGVpZ2h0OjFlbTtjb2xvcjojMDAwO3RleHQtc2hhZG93OjAgMXB4IDAgI2ZmZjtjdXJzb3I6cG9pbnRlcjtmaWx0ZXI6YWxwaGEob3BhY2l0eT01MCk7b3BhY2l0eTouNTtmb250LWZhbWlseTpcIkhlbHZldGljYSBOZXVlXCIsSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWY7ei1pbmRleDoxMDUwfS53aWRnZXRmbHkgLndmLW1vZGFsLndmLW1vZGFsLWxnIC53Zi1tb2RhbC1kaWFsb2csLndpZGdldGZseS53Zi1tb2RhbC53Zi1tb2RhbC1sZyAud2YtbW9kYWwtZGlhbG9ne21heC13aWR0aDo4MCU7aGVpZ2h0OjgwJX0ud2lkZ2V0Zmx5IC53Zi1tb2RhbC53Zi1tb2RhbC1tZCAud2YtbW9kYWwtZGlhbG9nLC53aWRnZXRmbHkud2YtbW9kYWwud2YtbW9kYWwtbWQgLndmLW1vZGFsLWRpYWxvZ3ttYXgtd2lkdGg6NTAlO2hlaWdodDo2MCV9LndpZGdldGZseSAud2YtbW9kYWwud2YtbW9kYWwtc20gLndmLW1vZGFsLWRpYWxvZywud2lkZ2V0Zmx5LndmLW1vZGFsLndmLW1vZGFsLXNtIC53Zi1tb2RhbC1kaWFsb2d7bWF4LXdpZHRoOjMwJTtoZWlnaHQ6MzAlfS53aWRnZXRmbHkgLndmLW1vZGFsLWJhY2tkcm9wLC53aWRnZXRmbHkud2YtbW9kYWwtYmFja2Ryb3B7cG9zaXRpb246Zml4ZWQ7dG9wOjA7cmlnaHQ6MDtib3R0b206MDtsZWZ0OjA7ei1pbmRleDoxMDQwO2JhY2tncm91bmQtY29sb3I6IzAwMDtmaWx0ZXI6YWxwaGEob3BhY2l0eT01MCk7b3BhY2l0eTouNX1AbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOjY0MHB4KXsud2lkZ2V0Zmx5LndmLW1vZGFsIC53Zi1tb2RhbC1kaWFsb2csLndpZGdldGZseS53Zi1tb2RhbC1sZyAud2YtbW9kYWwtZGlhbG9nLC53aWRnZXRmbHkud2YtbW9kYWwtbWQgLndmLW1vZGFsLWRpYWxvZywud2lkZ2V0Zmx5LndmLW1vZGFsLXNtIC53Zi1tb2RhbC1kaWFsb2d7d2lkdGg6MTAwJTttaW4td2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTttaW4taGVpZ2h0OjEwMCU7cGFkZGluZzowO21hcmdpbjowfS53aWRnZXRmbHkud2YtbW9kYWwgLndmLW1vZGFsLWRpYWxvZyAud2YtbW9kYWwtY29udGVudCwud2lkZ2V0Zmx5LndmLW1vZGFsLWxnIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnQsLndpZGdldGZseS53Zi1tb2RhbC1tZCAud2YtbW9kYWwtZGlhbG9nIC53Zi1tb2RhbC1jb250ZW50LC53aWRnZXRmbHkud2YtbW9kYWwtc20gLndmLW1vZGFsLWRpYWxvZyAud2YtbW9kYWwtY29udGVudHtwb3NpdGlvbjpmaXhlZDt0b3A6MHB4O3dpZHRoOjEwMCU7bWluLXdpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7bWluLWhlaWdodDoxMDAlOy13ZWJraXQtYW5pbWF0aW9uLW5hbWU6bm9uZTthbmltYXRpb24tbmFtZTpub25lO2JvcmRlcjowO2JvcmRlci1yYWRpdXM6MH0ud2lkZ2V0Zmx5LndmLW1vZGFsIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnQgLndmLWNsb3NlLC53aWRnZXRmbHkud2YtbW9kYWwtbGcgLndmLW1vZGFsLWRpYWxvZyAud2YtbW9kYWwtY29udGVudCAud2YtY2xvc2UsLndpZGdldGZseS53Zi1tb2RhbC1tZCAud2YtbW9kYWwtZGlhbG9nIC53Zi1tb2RhbC1jb250ZW50IC53Zi1jbG9zZSwud2lkZ2V0Zmx5LndmLW1vZGFsLXNtIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnQgLndmLWNsb3Nle3JpZ2h0OjBweDttYXJnaW4tdG9wOjEwcHg7bWFyZ2luLXJpZ2h0OjEwcHg7Zm9udC1zaXplOjI4cHg7Zm9udC13ZWlnaHQ6ODAwO2JvcmRlci1yYWRpdXM6NTAlO3dpZHRoOjM1cHg7aGVpZ2h0OjM1cHg7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MjNweDtib3JkZXI6NXB4IHNvbGlkICMwMDA7dGV4dC1zaGFkb3c6bm9uZX19LndpZGdldGZseSAud2YtYW5pbWF0ZWQtcG9wb3Zlciwud2lkZ2V0Zmx5LndmLWFuaW1hdGVkLXBvcG92ZXJ7LXdlYmtpdC1hbmltYXRpb24tZHVyYXRpb246MC41czthbmltYXRpb24tZHVyYXRpb246MC41czstd2Via2l0LWFuaW1hdGlvbi1maWxsLW1vZGU6Ym90aDthbmltYXRpb24tZmlsbC1tb2RlOmJvdGh9QC13ZWJraXQta2V5ZnJhbWVzIHdmLWZhZGVJbnswJXtvcGFjaXR5OjB9MTAwJXtvcGFjaXR5OjF9fUBrZXlmcmFtZXMgd2YtZmFkZUluezAle29wYWNpdHk6MH0xMDAle29wYWNpdHk6MX19LndpZGdldGZseSAud2YtYW5pbWF0ZWQtZmFkZUluLC53aWRnZXRmbHkud2YtYW5pbWF0ZWQtZmFkZUluey13ZWJraXQtYW5pbWF0aW9uLW5hbWU6d2YtZmFkZUluO2FuaW1hdGlvbi1uYW1lOndmLWZhZGVJbn0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLC53aWRnZXRmbHkud2YtcG9wb3Zlcnt0b3A6MDtsZWZ0OjA7ei1pbmRleDoxMDEwO3BhZGRpbmc6MXB4O3RleHQtYWxpZ246bGVmdDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7YmFja2dyb3VuZC1jbGlwOnBhZGRpbmctYm94O2JvcmRlcjoxcHggc29saWQgI2NjYztib3JkZXI6MXB4IHNvbGlkIHJnYmEoMCwwLDAsMC4yNik7Ym9yZGVyLXJhZGl1czozcHg7LXdlYmtpdC1ib3gtc2hhZG93OjAgMnB4IDVweCByZ2JhKDAsMCwwLDAuMjYpO2JveC1zaGFkb3c6MCAycHggNXB4IHJnYmEoMCwwLDAsMC4yNik7d2hpdGUtc3BhY2U6bm9ybWFsO3Bvc2l0aW9uOmFic29sdXRlO2Rpc3BsYXk6YmxvY2s7ZmxvYXQ6bGVmdDttaW4td2lkdGg6MjQwcHg7d2lkdGg6MjgwcHh9LndpZGdldGZseSAud2YtcG9wb3ZlciAud2YtYXJyb3csLndpZGdldGZseS53Zi1wb3BvdmVyIC53Zi1hcnJvd3tib3JkZXItd2lkdGg6MTFweH0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyIC53Zi1hcnJvdywud2lkZ2V0Zmx5LndmLXBvcG92ZXIgLndmLWFycm93LC53aWRnZXRmbHkgLndmLXBvcG92ZXIgLndmLWFycm93OmFmdGVyLC53aWRnZXRmbHkud2YtcG9wb3ZlciAud2YtYXJyb3c6YWZ0ZXJ7cG9zaXRpb246YWJzb2x1dGU7ZGlzcGxheTpibG9jazt3aWR0aDowO2hlaWdodDowO2JvcmRlci1jb2xvcjp0cmFuc3BhcmVudDtib3JkZXItc3R5bGU6c29saWQ7Y29udGVudDpcIlwiO2JvcmRlci13aWR0aDoxMHB4fS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtdG9wLC53aWRnZXRmbHkud2YtcG9wb3Zlci53Zi10b3B7bWFyZ2luLWJvdHRvbToxMHB4fS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtdG9wIC53Zi1hcnJvdywud2lkZ2V0Zmx5LndmLXBvcG92ZXIud2YtdG9wIC53Zi1hcnJvd3tib3R0b206LTExcHg7bGVmdDo1MCU7bWFyZ2luLWxlZnQ6LTExcHg7Ym9yZGVyLXRvcC1jb2xvcjojOTk5O2JvcmRlci10b3AtY29sb3I6cmdiYSgwLDAsMCwwLjI1KTtib3JkZXItYm90dG9tLXdpZHRoOjB9LndpZGdldGZseSAud2YtcG9wb3Zlci53Zi10b3AgLndmLWFycm93OmFmdGVyLC53aWRnZXRmbHkud2YtcG9wb3Zlci53Zi10b3AgLndmLWFycm93OmFmdGVye2JvdHRvbToxcHg7bWFyZ2luLWxlZnQ6LTEwcHg7Y29udGVudDpcIiBcIjtib3JkZXItdG9wLWNvbG9yOiNmZmY7Ym9yZGVyLWJvdHRvbS13aWR0aDowfS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtbGVmdCwud2lkZ2V0Zmx5LndmLXBvcG92ZXIud2YtbGVmdHttYXJnaW4tcmlnaHQ6MTBweH0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLndmLWxlZnQgLndmLWFycm93LC53aWRnZXRmbHkud2YtcG9wb3Zlci53Zi1sZWZ0IC53Zi1hcnJvd3t0b3A6NTAlO3JpZ2h0Oi0xMXB4O21hcmdpbi10b3A6LTExcHg7Ym9yZGVyLXJpZ2h0LXdpZHRoOjA7Ym9yZGVyLWxlZnQtY29sb3I6Izk5OTtib3JkZXItbGVmdC1jb2xvcjpyZ2JhKDAsMCwwLDAuMjUpfS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtbGVmdCAud2YtYXJyb3c6YWZ0ZXIsLndpZGdldGZseS53Zi1wb3BvdmVyLndmLWxlZnQgLndmLWFycm93OmFmdGVye3JpZ2h0OjFweDtib3R0b206LTEwcHg7Y29udGVudDpcIiBcIjtib3JkZXItcmlnaHQtd2lkdGg6MDtib3JkZXItbGVmdC1jb2xvcjojZmZmfS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtYm90dG9tLC53aWRnZXRmbHkud2YtcG9wb3Zlci53Zi1ib3R0b217bWFyZ2luLXRvcDoxMHB4fS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtYm90dG9tIC53Zi1hcnJvdywud2lkZ2V0Zmx5LndmLXBvcG92ZXIud2YtYm90dG9tIC53Zi1hcnJvd3t0b3A6LTExcHg7bGVmdDo1MCU7bWFyZ2luLWxlZnQ6LTExcHg7Ym9yZGVyLXRvcC13aWR0aDowO2JvcmRlci1ib3R0b20tY29sb3I6Izk5OTtib3JkZXItYm90dG9tLWNvbG9yOnJnYmEoMCwwLDAsMC4yNSl9LndpZGdldGZseSAud2YtcG9wb3Zlci53Zi1ib3R0b20gLndmLWFycm93OmFmdGVyLC53aWRnZXRmbHkud2YtcG9wb3Zlci53Zi1ib3R0b20gLndmLWFycm93OmFmdGVye3RvcDoxcHg7bWFyZ2luLWxlZnQ6LTEwcHg7Y29udGVudDpcIiBcIjtib3JkZXItdG9wLXdpZHRoOjA7Ym9yZGVyLWJvdHRvbS1jb2xvcjojZmZmfS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtcmlnaHQsLndpZGdldGZseS53Zi1wb3BvdmVyLndmLXJpZ2h0e21hcmdpbi1sZWZ0OjEwcHh9LndpZGdldGZseSAud2YtcG9wb3Zlci53Zi1yaWdodCAud2YtYXJyb3csLndpZGdldGZseS53Zi1wb3BvdmVyLndmLXJpZ2h0IC53Zi1hcnJvd3t0b3A6NTAlO2xlZnQ6LTExcHg7bWFyZ2luLXRvcDotMTFweDtib3JkZXItcmlnaHQtY29sb3I6Izk5OTtib3JkZXItcmlnaHQtY29sb3I6cmdiYSgwLDAsMCwwLjI1KTtib3JkZXItbGVmdC13aWR0aDowfS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtcmlnaHQgLndmLWFycm93OmFmdGVyLC53aWRnZXRmbHkud2YtcG9wb3Zlci53Zi1yaWdodCAud2YtYXJyb3c6YWZ0ZXJ7Ym90dG9tOi0xMHB4O2xlZnQ6MXB4O2NvbnRlbnQ6XCIgXCI7Ym9yZGVyLXJpZ2h0LWNvbG9yOiNmZmY7Ym9yZGVyLWxlZnQtd2lkdGg6MH0iOwoJCQkJICAgIC8vIGNzc1RleHQgZW5kCgkJCQkKCQkJCSAgICB2YXIgc3R5bGVFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7CgkJCQkgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXS5hcHBlbmRDaGlsZChzdHlsZUVsKTsKCQkJCSAgICBpZiAoc3R5bGVFbC5zdHlsZVNoZWV0KSB7CgkJCQkgICAgICAgIGlmICghc3R5bGVFbC5zdHlsZVNoZWV0LmRpc2FibGVkKSB7CgkJCQkgICAgICAgICAgICBzdHlsZUVsLnN0eWxlU2hlZXQuY3NzVGV4dCA9IGNzc1RleHQ7CgkJCQkgICAgICAgIH0KCQkJCSAgICB9IGVsc2UgewoJCQkJICAgICAgICB0cnkgewoJCQkJICAgICAgICAgICAgc3R5bGVFbC5pbm5lckhUTUwgPSBjc3NUZXh0CgkJCQkgICAgICAgIH0gY2F0Y2goZSkgewoJCQkJICAgICAgICAgICAgc3R5bGVFbC5pbm5lclRleHQgPSBjc3NUZXh0OwoJCQkJICAgICAgICB9CgkJCQkgICAgfQoJCQkJfSgpKTsKCQkJCQoJCQkJV2lkZ2V0Zmx5LlV0aWxzID0gKGZ1bmN0aW9uKGdsb2JhbCkgeyd1c2Ugc3RyaWN0JzsKCQkJCQkvLyBVdGlsaXRpZXMKCQkJCQkvLyAtLS0tLS0tLS0tLS0tCgkJCQkKCQkJCQl2YXIgaWRDb3VudGVyID0gMCwgVXRpbHMgPSB7CgkJCQkKCQkJCQkJaGFzIDogZnVuY3Rpb24ob2JqLCBrZXkpIHsKCQkJCQkJCXJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpOwoJCQkJCQl9LAoJCQkJCgkJCQkJCS8qKgoJCQkJCQkgKglUaGUgY29ybmVyc3RvbmUsIGFuIGBlYWNoYCBpbXBsZW1lbnRhdGlvbiwgYWthIGBmb3JFYWNoYC4KCQkJCQkJICoJSGFuZGxlcyByYXcgb2JqZWN0cyBpbiBhZGRpdGlvbiB0byBhcnJheS1saWtlcy4gVHJlYXRzIGFsbAoJCQkJCQkgKglzcGFyc2UgYXJyYXktbGlrZXMgYXMgaWYgdGhleSB3ZXJlIGRlbnNlLgoJCQkJCQkgKglCb3Jyb3dpbmcgdGhpcyBjb2RlIGZyb20gdW5kZXJzY29yZToKCQkJCQkJKglodHRwczovL2dpdGh1Yi5jb20vamFzaGtlbmFzL3VuZGVyc2NvcmUKCQkJCQkJICovCgkJCQkJCWVhY2ggOiBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CgkJCQkJCQl2YXIgaSwgbCwga2V5OwoJCQkJCgkJCQkJCQlpZiAob2JqID09PSBudWxsKSB7CgkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJfQoJCQkJCgkJCQkJCQlpZiAoQXJyYXkucHJvdG90eXBlLmZvckVhY2ggJiYgb2JqLmZvckVhY2ggPT09IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoKSB7CgkJCQkJCQkJb2JqLmZvckVhY2goaXRlcmF0b3IsIGNvbnRleHQpOwoJCQkJCQkJfSBlbHNlIGlmICggdHlwZW9mIG9iai5sZW5ndGggPT09ICdudW1iZXInKSB7CgkJCQkJCQkJZm9yICggaSA9IDAsIGwgPSBvYmoubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CgkJCQkJCQkJCWlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtpXSwgaSwgb2JqKSA9PT0ge30pIHsKCQkJCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJZm9yIChrZXkgaW4gb2JqKSB7CgkJCQkJCQkJCWlmIChXaWRnZXRmbHkuVXRpbHMuaGFzKG9iaiwga2V5KSkgewoJCQkJCQkJCQkJaWYgKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqW2tleV0sIGtleSwgb2JqKSA9PT0ge30pIHsKCQkJCQkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0sCgkJCQkKCQkJCQkJLyoqCgkJCQkJCSAqCUlzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5PwoJCQkJCQkgKglBbiAiZW1wdHkiIG9iamVjdCBoYXMgbm8gZW51bWVyYWJsZSBvd24tcHJvcGVydGllcy4KCQkJCQkJICoJQm9ycm93aW5nIHRoaXMgY29kZSBmcm9tIHVuZGVyc2NvcmU6CgkJCQkJCSAqCWh0dHBzOi8vZ2l0aHViLmNvbS9qYXNoa2VuYXMvdW5kZXJzY29yZQoJCQkJCQkgKi8KCQkJCQkJaXNFbXB0eSA6IGZ1bmN0aW9uKG9iaikgewoJCQkJCQkJLy8gbnVsbCBhbmQgdW5kZWZpbmVkIGFyZSAiZW1wdHkiCgkJCQkJCQlpZiAob2JqID09PSBudWxsKSB7CgkJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCQl9CgkJCQkKCQkJCQkJCS8vIEFzc3VtZSBpZiBpdCBoYXMgYSBsZW5ndGggcHJvcGVydHkgd2l0aCBhIG5vbi16ZXJvIHZhbHVlCgkJCQkJCQkvLyB0aGF0IHRoYXQgcHJvcGVydHkgaXMgY29ycmVjdC4KCQkJCQkJCWlmIChvYmoubGVuZ3RoID4gMCkgewoJCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJCX0KCQkJCQoJCQkJCQkJaWYgKG9iai5sZW5ndGggPT09IDApIHsKCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCX0KCQkJCQoJCQkJCQkJLy8gT3RoZXJ3aXNlLCBkb2VzIGl0IGhhdmUgYW55IHByb3BlcnRpZXMgb2YgaXRzIG93bj8KCQkJCQkJCS8vIE5vdGUgdGhhdCB0aGlzIGRvZXNuJ3QgaGFuZGxlCgkJCQkJCQkvLyB0b1N0cmluZyBhbmQgdmFsdWVPZiBlbnVtZXJhdGlvbiBidWdzIGluIElFIDwgOQoJCQkJCQkJZm9yICh2YXIga2V5IGluIG9iaikgewoJCQkJCQkJCWlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewoJCQkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCX0sCgkJCQkKCQkJCQkJLyoKCQkJCQkJICoJRXh0ZW5kIGEgZ2l2ZW4gb2JqZWN0IHdpdGggYWxsIHRoZSBwcm9wZXJ0aWVzIGluIHBhc3NlZC1pbiBvYmplY3QocykuCgkJCQkJCSAqCUJvcnJvd2luZyB0aGlzIGNvZGUgZnJvbSB1bmRlcnNjb3JlOgoJCQkJCQkgKglodHRwczovL2dpdGh1Yi5jb20vamFzaGtlbmFzL3VuZGVyc2NvcmUKCQkJCQkJICovCgkJCQkJCWV4dGVuZCA6IGZ1bmN0aW9uKG9iaikgewoJCQkJCQkJdGhpcy5lYWNoKEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewoJCQkJCQkJCWlmIChzb3VyY2UpIHsKCQkJCQkJCQkJZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHsKCQkJCQkJCQkJCW9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0pOwoJCQkJCQkJcmV0dXJuIG9iajsKCQkJCQkJfSwKCQkJCQoJCQkJCQlpbmhlcml0IDogZnVuY3Rpb24oQ2hpbGQsIFBhcmVudCkgewoJCQkJCQkJdmFyIEYgPSBmdW5jdGlvbigpIHsKCQkJCQkJCX07CgkJCQkJCQlGLnByb3RvdHlwZSA9IFBhcmVudC5wcm90b3R5cGU7CgkJCQkJCQlDaGlsZC5wcm90b3R5cGUgPSBuZXcgRigpOwoJCQkJCQkJQ2hpbGQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2hpbGQ7CgkJCQkJCQlDaGlsZC51YmVyID0gUGFyZW50LnByb3RvdHlwZTsKCQkJCQkJfSwKCQkJCQoJCQkJCQkvKioKCQkJCQkJICogUGFyc2UgYW5kIHN0cmluZ2lmeSBVUkwgcXVlcnkgc3RyaW5ncwoJCQkJCQkgKiBvcnJvd2luZyB0aGlzIGNvZGUgZnJvbSA6CgkJCQkJCSAqIGh0dHBzOi8vZ2l0aHViLmNvbS9zaW5kcmVzb3JodXMvcXVlcnktc3RyaW5nYnkKCQkJCQkJICovCgkJCQkJCXBhcmFtcyA6IGZ1bmN0aW9uIChzdHIpIHsKCQkJCQkJCWlmICh0eXBlb2Ygc3RyICE9PSAnc3RyaW5nJykgewoJCQkJCQkJCXJldHVybiB7fTsKCQkJCQkJCX0KCQkJCQoJCQkJCQkJc3RyID0gc3RyLnRyaW0oKS5yZXBsYWNlKC9eKFw/fCMpLywgJycpOwoJCQkJCgkJCQkJCQlpZiAoIXN0cikgewoJCQkJCQkJCXJldHVybiB7fTsKCQkJCQkJCX0KCQkJCQoJCQkJCQkJcmV0dXJuIHN0ci50cmltKCkuc3BsaXQoJyYnKS5yZWR1Y2UoZnVuY3Rpb24gKHJldCwgcGFyYW0pIHsKCQkJCQkJCQl2YXIgcGFydHMgPSBwYXJhbS5yZXBsYWNlKC9cKy9nLCAnICcpLnNwbGl0KCc9JyksCgkJCQkJCQkJCWtleSA9IHBhcnRzWzBdLAoJCQkJCQkJCQl2YWwgPSBwYXJ0c1sxXTsKCQkJCQoJCQkJCQkJCWtleSA9IGRlY29kZVVSSUNvbXBvbmVudChrZXkpOwoJCQkJCQkJCS8vIG1pc3NpbmcgYD1gIHNob3VsZCBiZSBgbnVsbGA6CgkJCQkJCQkJLy8gaHR0cDovL3czLm9yZy9UUi8yMDEyL1dELXVybC0yMDEyMDUyNC8jY29sbGVjdC11cmwtcGFyYW1ldGVycwoJCQkJCQkJCXZhbCA9IHZhbCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IGRlY29kZVVSSUNvbXBvbmVudCh2YWwpOwoJCQkJCgkJCQkJCQkJaWYgKCFyZXQuaGFzT3duUHJvcGVydHkoa2V5KSkgewoJCQkJCQkJCQlyZXRba2V5XSA9IHZhbDsKCQkJCQkJCQl9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocmV0W2tleV0pKSB7CgkJCQkJCQkJCXJldFtrZXldLnB1c2godmFsKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlyZXRba2V5XSA9IFtyZXRba2V5XSwgdmFsXTsKCQkJCQkJCQl9CgkJCQkKCQkJCQkJCQlyZXR1cm4gcmV0OwoJCQkJCQkJfSwge30pOwoJCQkJCQl9LAoJCQkJCgkJCQkJCS8qKgoJCQkJCQkgKiBHZW5lcmF0ZSBhIHVuaXF1ZSBpbnRlZ2VyIGlkICh1bmlxdWUgd2l0aGluIHRoZSBlbnRpcmUgY2xpZW50IHNlc3Npb24pLgoJCQkJCQkgKiBVc2VmdWwgZm9yIHRlbXBvcmFyeSBET00gaWRzLgoJCQkJCQkgKiBCb3Jyb3dpbmcgdGhpcyBjb2RlIGZyb20gdW5kZXJzY29yZToKCQkJCQkJICogaHR0cHM6Ly9naXRodWIuY29tL2phc2hrZW5hcy91bmRlcnNjb3JlCgkJCQkJCSAqLwoJCQkJCQl1bmlxdWVJZCA6IGZ1bmN0aW9uKHByZWZpeCkgewoJCQkJCQkJdmFyIGlkID0gU3RyaW5nKCsraWRDb3VudGVyKTsKCQkJCQkJCXJldHVybiBwcmVmaXggPyBwcmVmaXggKyBpZCA6IGlkOwoJCQkJCQl9LAoJCQkJCgkJCQkJCWlzVHJ1ZSA6IGZ1bmN0aW9uKHZhbHVlKXsKCQkJCQkJCWlmKHZhbHVlID09PSB0cnVlIHx8IHZhbHVlID09PSAndHJ1ZScpewoJCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQkJfWVsc2V7CgkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJfQoJCQkJCQl9LAoJCQkJCgkJCQkJCWluSWZyYW1lIDogZnVuY3Rpb24oKSB7CgkJCQkJCQl0cnkgewoJCQkJCQkJCXJldHVybiB3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcDsKCQkJCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCX0KCQkJCQkJfSwKCQkJCQoJCQkJCQlpc0Z1bmN0aW9uIDogZnVuY3Rpb24ob2JqKSB7CgkJCQkJCQlyZXR1cm4gdHlwZW9mIG9iaiA9PT0gJ2Z1bmN0aW9uJzsKCQkJCQkJfSwKCQkJCQoJCQkJCQlpc0VsZW1lbnQgOiBmdW5jdGlvbihvKSB7CgkJCQkJCQlyZXR1cm4gKCB0eXBlb2YgSFRNTEVsZW1lbnQgPT09ICdvYmplY3QnID8gbyBpbnN0YW5jZW9mIEhUTUxFbGVtZW50IDogbyAmJiB0eXBlb2YgbyA9PT0gJ29iamVjdCcgJiYgbyAhPT0gbnVsbCAmJiBvLm5vZGVUeXBlID09PSAxICYmIHR5cGVvZiBvLm5vZGVOYW1lID09PSAnc3RyaW5nJyk7CgkJCQkJCX0sCgkJCQkKCQkJCQkJaGFzQ2xhc3MgOiBmdW5jdGlvbihlbGVtZW50LCBjbHMpIHsKCQkJCQkJCXJldHVybiAoJyAnICsgZWxlbWVudC5jbGFzc05hbWUgKyAnICcpLmluZGV4T2YoJyAnICsgY2xzICsgJyAnKSA+IC0xOwoJCQkJCQl9LAoJCQkJCgkJCQkJCWFkZENsYXNzIDogZnVuY3Rpb24oZWxlbWVudCwgY2xhc3NOYW1lKSB7CgkJCQkJCQl2YXIgYSwgYWQgPSBjbGFzc05hbWUuc3BsaXQoJyAnKTsKCQkJCQkJCWZvcihhIGluIGFkKXsKCQkJCQkJCQlpZiAoIXRoaXMuaGFzQ2xhc3MoZWxlbWVudCwgYWRbYV0pKSB7CgkJCQkJCQkJCWVsZW1lbnQuY2xhc3NOYW1lICs9ICcgJyArIGFkW2FdOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCXRoaXMuaW5uZXJTdHlsZShlbGVtZW50KTsKCQkJCQkJfSwKCQkJCQoJCQkJCQlyZW1vdmVDbGFzcyA6IGZ1bmN0aW9uKGVsZW1lbnQsIHJtQ2xhc3MpIHsKCQkJCQkJCXZhciBuZXdDbGFzcywgciwgcm0gPSBybUNsYXNzLnNwbGl0KCcgJyk7CgkJCQkJCQlpZiAoZWxlbWVudCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuaXNFbGVtZW50KGVsZW1lbnQpKSB7CgkJCQkJCQkJbmV3Q2xhc3MgPSAnICcgKyBlbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKC9bXHRcclxuXS9nLCAnICcpICsgJyAnOwoJCQkJCQkJCWZvcihyIGluIHJtKXsKCQkJCQkJCQkJaWYgKHRoaXMuaGFzQ2xhc3MoZWxlbWVudCwgcm1bcl0pKSB7CgkJCQkJCQkJCQl3aGlsZSAobmV3Q2xhc3MuaW5kZXhPZignICcgKyBybVtyXSArICcgJykgPj0gMCkgewoJCQkJCQkJCQkJCW5ld0NsYXNzID0gbmV3Q2xhc3MucmVwbGFjZSgnICcgKyBybVtyXSArICcgJywgJyAnKTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCWVsZW1lbnQuY2xhc3NOYW1lID0gbmV3Q2xhc3MucmVwbGFjZSgvXlxzK3xccyskL2csICcnKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCXRoaXMuaW5uZXJTdHlsZShlbGVtZW50KTsKCQkJCQkJfSwKCQkJCQoJCQkJCQl0b2dnbGVDbGFzcyA6IGZ1bmN0aW9uKGVsZW1lbnQsIGNsYXNzTmFtZSkgewoJCQkJCQkJdmFyIG5ld0NsYXNzOwoJCQkJCQkJaWYgKGVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmlzRWxlbWVudChlbGVtZW50KSkgewoJCQkJCQkJCW5ld0NsYXNzID0gJyAnICsgZWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgvW1x0XHJcbl0vZywgJyAnKSArICcgJzsKCQkJCQkJCQlpZiAodGhpcy5oYXNDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpKSB7CgkJCQkJCQkJCXdoaWxlIChuZXdDbGFzcy5pbmRleE9mKCcgJyArIGNsYXNzTmFtZSArICcgJykgPj0gMCkgewoJCQkJCQkJCQkJbmV3Q2xhc3MgPSBuZXdDbGFzcy5yZXBsYWNlKCcgJyArIGNsYXNzTmFtZSArICcgJywgJyAnKTsKCQkJCQkJCQkJfQoJCQkJCQkJCQllbGVtZW50LmNsYXNzTmFtZSA9IG5ld0NsYXNzLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJZWxlbWVudC5jbGFzc05hbWUgKz0gJyAnICsgY2xhc3NOYW1lOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCXRoaXMuaW5uZXJTdHlsZShlbGVtZW50KTsKCQkJCQkJfSwKCQkJCQoJCQkJCQlpbm5lclN0eWxlIDogZnVuY3Rpb24gY3NzKGEsIG9wdGlvbnMpIHsKCQkJCQkJICAgIHZhciBpLHIscmEsbXIsY3MsbWF0Y2gsIHJ1bGVFeHAsIHJlc3VsdCxzdHlsZXMgPSBbXSxydWxlcyxtZWRpYVJ1bGVzLCBtZWRpYVRleHQsIHNoZWV0cyA9IGRvY3VtZW50LnN0eWxlU2hlZXRzLCBvID0gW10sIGV4dFN0eWxlcyA9ICcnOwoJCQkJCQkgICAgYS5tYXRjaGVzID0gYS5tYXRjaGVzIHx8IGEud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8IGEubW96TWF0Y2hlc1NlbGVjdG9yIHx8IGEubXNNYXRjaGVzU2VsZWN0b3IgfHwgYS5vTWF0Y2hlc1NlbGVjdG9yOwoJCQkJCQkgICAgZm9yIChpIGluIHNoZWV0cykgewoJCQkJCQkJCQkJaWYoc2hlZXRzW2ldLmhyZWYpewoJCQkJCQkJCQkJCWNvbnRpbnVlOwoJCQkJCQkJCQkJfQoJCQkJCQkgICAgICAgIHJ1bGVzID0gc2hlZXRzW2ldLnJ1bGVzIHx8IHNoZWV0c1tpXS5jc3NSdWxlczsKCQkJCQoJCQkJCQkgICAgICAgIGZvciAociBpbiBydWxlcykgewoJCQkJCgkJCQkJCQkJCQkJaWYocnVsZXNbcl0udHlwZSA9PT0gNCB8fCBydWxlc1tyXS5wYXJlbnRSdWxlKXsKCQkJCQkJCQkJCQkJaWYocnVsZXNbcl0ubWVkaWEpewoJCQkJCQkJCQkJCQkJbWVkaWFUZXh0ICA9IHJ1bGVzW3JdLm1lZGlhLm1lZGlhVGV4dDsKCQkJCQkJCQkJCQkJfWVsc2V7CgkJCQkJCQkJCQkJCQltZWRpYVRleHQgPSBydWxlc1tyXS5wYXJlbnRSdWxlLm1lZGlhLm1lZGlhVGV4dDsKCQkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCQlpZih3aW5kb3cubWF0Y2hNZWRpYShtZWRpYVRleHQpLm1hdGNoZXMpewoJCQkJCQkJCQkJCQkJbWVkaWFSdWxlcyA9IHJ1bGVzW3JdLnJ1bGVzIHx8IHJ1bGVzW3JdLmNzc1J1bGVzIHx8IHJ1bGVzW3JdLnBhcmVudFJ1bGUucnVsZXMgfHwgcnVsZXNbcl0ucGFyZW50UnVsZS5jc3NSdWxlczsKCQkJCQkJCQkJCQkJCWZvciAobXIgaW4gbWVkaWFSdWxlcykgewoJCQkJCQkJCQkJCQkJCQlpZiAoYS5tYXRjaGVzKG1lZGlhUnVsZXNbbXJdLnNlbGVjdG9yVGV4dCkpIHsKCQkJCQkJCQkJCQkJCQkJCQljb25zb2xlLmxvZyhtZWRpYVJ1bGVzW21yXS5jc3NUZXh0KTsKCQkJCQkJCQkJCQkJCQkJCQlvLnB1c2gobWVkaWFSdWxlc1ttcl0uY3NzVGV4dCk7CgkJCQkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCX1lbHNlewoJCQkJCQkJCQkJCQlpZiAoYS5tYXRjaGVzKHJ1bGVzW3JdLnNlbGVjdG9yVGV4dCkpIHsKCQkJCQkJCQkJCQkJCQlvLnB1c2gocnVsZXNbcl0uY3NzVGV4dCk7CgkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQl9CgkJCQkJCSAgICAgICAgfQoJCQkJCQkgICAgfQoJCQkJCgkJCQkJCSAgICBmb3IgKGkgaW4gbyl7CgkJCQkJCQkJCXIgPSBvW2ldOwoJCQkJCQkJCQlyYSA9IHIuc3BsaXQoJyAnKTsKCQkJCQkJCQkJaWYociAmJiB0eXBlb2YocikgPT09ICdzdHJpbmcnICYmIHJhWzBdLmluZGV4T2YoJy53aWRnZXRmbHknKSA+IC0xKXsKCQkJCQkJCQkJCXJ1bGVFeHAgPSAvXHtccyooW15cfV0rKVxzXH0vZzsKCQkJCQkJCQkJCW1hdGNoID0gcnVsZUV4cC5leGVjKHIpOwoJCQkJCQkJCQkJaWYobWF0Y2gpewoJCQkJCQkJCQkJCWNzID0gci5zcGxpdCgnICcpWzFdOwoJCQkJCQkJCQkJCWlmKGNzLmluZGV4T2YoJy53Zi0nKSA9PT0gMCAmJiBjcy5pbmRleE9mKCcud2YtYW5pbWF0ZWQtJykgIT09IDApewoJCQkJCQkJCQkJCQlzdHlsZXMucHVzaChtYXRjaFsxXSk7CgkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkgICAgcmVzdWx0ID0gc3R5bGVzLmpvaW4oJyAnKTsKCQkJCQkJICAgIGlmKG9wdGlvbnMpewoJCQkJCQkJCQlmb3IoaSBpbiBvcHRpb25zKXsKCQkJCQkJCQkJCWV4dFN0eWxlcyA9IGV4dFN0eWxlcyArIG9wdGlvbnNbaV07CgkJCQkJCQkJCX0KCQkJCQkJCQkJYS5zZXRBdHRyaWJ1dGUoJ2RhdGEtZXh0LXN0eWxlJywgZXh0U3R5bGVzKTsKCQkJCQkJCQkJcmVzdWx0ID0gcmVzdWx0ICsgJyAnICsgZXh0U3R5bGVzOwoJCQkJCQkJCX1lbHNlewoJCQkJCQkJCQlpZihhLmdldEF0dHJpYnV0ZSgnZGF0YS1leHQtc3R5bGUnKSl7CgkJCQkJCQkJCQlyZXN1bHQgPSByZXN1bHQgKyAnICcgKyBhLmdldEF0dHJpYnV0ZSgnZGF0YS1leHQtc3R5bGUnKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCQlhLnN0eWxlLmNzc1RleHQgPSByZXN1bHQ7CgkJCQkJCX0sCgkJCQkKCQkJCQkJYWN0dWFsIDogZnVuY3Rpb24oZWwpewoJCQkJCQkJdmFyIGVsV2lkdGgsZWxIZWlnaHQsc3R5bGUsCgkJCQkJCQlmaXhTdHlsZSA9ICcgdmlzaWJpbGl0eTogaGlkZGVuICFpbXBvcnRhbnQ7IGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7IHBvc2l0aW9uOiBhYnNvbHV0ZSAhaW1wb3J0YW50OycsCgkJCQkKCQkJCQkJCXNpemUgPSBmdW5jdGlvbihzKXsKCQkJCQkJCQkJaWYoQm9vbGVhbihzKSl7CgkJCQkJCQkJCQlyZXR1cm4gcGFyc2VJbnQocy5zdWJzdHJpbmcoMCxzLmluZGV4T2YoJ3B4JykpLDEwKTsKCQkJCQkJCQkJfWVsc2V7CgkJCQkJCQkJCQlyZXR1cm4gMDsKCQkJCQkJCQkJfQoJCQkJCQkJfTsKCQkJCQoJCQkJCQkJc3R5bGUgPSBlbC5nZXRBdHRyaWJ1dGUoJ3N0eWxlJyk7CgkJCQkKCQkJCQkJCS8vaWYgKGVsLm9mZnNldFBhcmVudCA9PT0gbnVsbCkgewoJCQkJCQkJCWVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAoc3R5bGUgPyBzdHlsZSA6ICcnKSArIGZpeFN0eWxlKTsKCQkJCQkJCS8vfQoJCQkJCgkJCQkJCQllbFdpZHRoID0gZWwub2Zmc2V0V2lkdGg7CgkJCQkKCQkJCQkJCWVsSGVpZ2h0ID0gZWwub2Zmc2V0SGVpZ2h0OwoJCQkJCgkJCQkJCQllbC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgKHN0eWxlID8gc3R5bGUgOiAnJykpOwoJCQkJCgkJCQkJCQlyZXR1cm4gewoJCQkJCQkJCXdpZHRoIDogZWxXaWR0aCArIHNpemUoZWwuc3R5bGUubWFyZ2luTGVmdCkgKyBzaXplKGVsLnN0eWxlLm1hcmdpblJpZ2h0KSwKCQkJCQkJCQloZWlnaHQgOiBlbEhlaWdodCArIHNpemUoZWwuc3R5bGUubWFyZ2luVG9wKSArIHNpemUoZWwuc3R5bGUubWFyZ2luQm90dG9tKQoJCQkJCQkJfTsKCQkJCQkJfSwKCQkJCQoJCQkJCQkvKioKCQkJCQkJICogR2V0IHRoZSBjdXJyZW50IGNvb3JkaW5hdGVzIG9mIHRoZSBmaXJzdCBlbGVtZW50LCBvciBzZXQgdGhlIGNvb3JkaW5hdGVzIG9mIGV2ZXJ5IGVsZW1lbnQsIGluIHRoZSBzZXQgb2YgbWF0Y2hlZCBlbGVtZW50cywgcmVsYXRpdmUgdG8gdGhlIGRvY3VtZW50LgoJCQkJCQkgKiBCb3Jyb3dpbmcgdGhpcyBjb2RlIGZyb20ganF1ZXJ5OgoJCQkJCQkgKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeQoJCQkJCQkgKi8KCQkJCQkJb2Zmc2V0OiBmdW5jdGlvbihlbCkgewoJCQkJCQkJdmFyIGRvY0VsZW0sIHdpbiwKCQkJCQkJCWVsZW0gPSBlbCwKCQkJCQkJCWJveCA9IHsgdG9wOiAwLCBsZWZ0OiAwIH0sCgkJCQkJCQlkb2MgPSBlbGVtICYmIGVsZW0ub3duZXJEb2N1bWVudDsKCQkJCQoJCQkJCQkJaWYgKCAhZG9jICkgewoJCQkJCQkJCXJldHVybjsKCQkJCQkJCX0KCQkJCQoJCQkJCQkJZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CgkJCQkJCQkvLyBJZiB3ZSBkb24ndCBoYXZlIGdCQ1IsIGp1c3QgdXNlIDAsMCByYXRoZXIgdGhhbiBlcnJvcgoJCQkJCQkJLy8gQmxhY2tCZXJyeSA1LCBpT1MgMyAob3JpZ2luYWwgaVBob25lKQoJCQkJCQkJaWYgKCB0eXBlb2YgZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QgIT09IHVuZGVmaW5lZCApIHsKCQkJCQkJCQlib3ggPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoJCQkJCQkJfQoJCQkJCQkJd2luID0gd2luZG93OwoJCQkJCQkJcmV0dXJuIHsKCQkJCQkJCQl0b3A6IGJveC50b3AgKyB3aW4ucGFnZVlPZmZzZXQgLSBkb2NFbGVtLmNsaWVudFRvcCwKCQkJCQkJCQlsZWZ0OiBib3gubGVmdCArIHdpbi5wYWdlWE9mZnNldCAtIGRvY0VsZW0uY2xpZW50TGVmdAoJCQkJCQkJfTsKCQkJCQkJfSwKCQkJCQoJCQkJCQl0b0VsZW1lbnQgOiBmdW5jdGlvbihjb250ZW50KXsKCQkJCQkJCXZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJCQkJZWwuaW5uZXJIVE1MID0gY29udGVudDsKCQkJCQkJCXJldHVybiBlbC5maXJzdENoaWxkOwoJCQkJCQl9LAoJCQkJCgkJCQkJCXRocm90dGxlIDogZnVuY3Rpb24obWV0aG9kLCBzY29wZSkgewoJCQkJCQkJCWNsZWFyVGltZW91dChzY29wZS5fdElkKTsKCQkJCQkJCQlzY29wZS5fdElkID0gc2V0VGltZW91dChmdW5jdGlvbigpewoJCQkJCQkJCQkJbWV0aG9kLmNhbGwoc2NvcGUpOwoJCQkJCQkJCX0sIDEwMCk7CgkJCQkJCX0KCQkJCQoJCQkJCX07CgkJCQkKCQkJCQlyZXR1cm4gVXRpbHM7CgkJCQl9KSh0aGlzKTsKCQkJCQoJCQkJV2lkZ2V0Zmx5LkV2ZW50cyA9IChmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7CgkJCQkJLy8gRXZlbnRzCgkJCQkJLy8gLS0tLS0tLS0tLS0tLQoJCQkJCXZhciBFdmVudHMgPSBmdW5jdGlvbigpIHsKCQkJCQl9OwoJCQkJCgkJCQkJRXZlbnRzLnByb3RvdHlwZS50cmlnZ2VyID0gZnVuY3Rpb24oYWN0aW9uLCBkYXRhKSB7CgkJCQkJCVdpZGdldGZseS5NZWRpYXRvci5zZW5kKHRoaXMuaWQsIGFjdGlvbiwgZGF0YSk7CgkJCQkJfTsKCQkJCQoJCQkJCUV2ZW50cy5wcm90b3R5cGUub24gPSBmdW5jdGlvbihhY3Rpb24sIGNhbGxiYWNrKSB7CgkJCQkJCVdpZGdldGZseS5NZWRpYXRvci5iaW5kKHRoaXMuaWQsIGFjdGlvbiwgY2FsbGJhY2spOwoJCQkJCX07CgkJCQkKCQkJCQlFdmVudHMucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uKGFjdGlvbikgewoJCQkJCQlXaWRnZXRmbHkuTWVkaWF0b3IudW5iaW5kKHRoaXMuaWQsIGFjdGlvbik7CgkJCQkJfTsKCQkJCQoJCQkJCXJldHVybiBFdmVudHM7CgkJCQl9KSh0aGlzKTsKCQkJCQoJCQkJV2lkZ2V0Zmx5Lk1lZGlhdG9yID0gKGZ1bmN0aW9uKGdsb2JhbCkgeyd1c2Ugc3RyaWN0JzsKCQkJCQkvLyBNZWRpYXRvcgoJCQkJCS8vIC0tLS0tLS0tLS0tLS0KCQkJCQl2YXIgTWVkaWF0b3IgPSB7CgkJCQkKCQkJCQkJd2lkZ2V0cyA6IHt9LAoJCQkJCgkJCQkJCWFjdGlvbkhhbmRsZXJzIDoge30sCgkJCQkKCQkJCQkJaW5pdCA6IGZ1bmN0aW9uKCkgewoJCQkJCQkJdmFyIHNlbGYgPSB0aGlzOwoJCQkJCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbihtc2dPYmopIHsKCQkJCQkJCQlzZWxmLnJlY2VpdmUobXNnT2JqKTsKCQkJCQkJCX0sIGZhbHNlKTsKCQkJCQkJfSwKCQkJCQoJCQkJCQlnZXRXaWRnZXQgOiBmdW5jdGlvbihpZCkgewoJCQkJCQkJcmV0dXJuIHRoaXMud2lkZ2V0c1tpZF07CgkJCQkJCX0sCgkJCQkKCQkJCQkJZ2V0QWN0aW9uSGFuZGxlcnMgOiBmdW5jdGlvbihpZCkgewoJCQkJCQkJcmV0dXJuIHRoaXMuYWN0aW9uSGFuZGxlcnNbaWRdOwoJCQkJCQl9LAoJCQkJCgkJCQkJCXJlZ2lzdGVyIDogZnVuY3Rpb24oaWQsIHdpZGdldCkgewoJCQkJCQkJdGhpcy53aWRnZXRzW3dpZGdldC5pZF0gPSB3aWRnZXQ7CgkJCQkJCQl3aWRnZXQubWVkaWF0b3IgPSB0aGlzOwoJCQkJCQkJdGhpcy5hY3Rpb25IYW5kbGVyc1t3aWRnZXQuaWRdID0ge307CgkJCQkJCX0sCgkJCQkKCQkJCQkJdW5yZWdpc3RlciA6IGZ1bmN0aW9uKGlkLCBjYWxsYmFjaykgewoJCQkJCQkJaWYgKHRoaXMuYWN0aW9uSGFuZGxlcnNbaWRdICE9PSB1bmRlZmluZWQpIHsKCQkJCQkJCQl2YXIgc2VsZiA9IHRoaXM7CgkJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmVhY2godGhpcy5hY3Rpb25IYW5kbGVyc1tpZF0sIGZ1bmN0aW9uKGtleSkgewoJCQkJCQkJCQlkZWxldGUgc2VsZi5hY3Rpb25IYW5kbGVyc1tpZF1ba2V5XTsKCQkJCQkJCQl9KTsKCQkJCQkJCX0KCQkJCQkJCWRlbGV0ZSB0aGlzLndpZGdldHNbaWRdOwoJCQkJCQkJaWYoY2FsbGJhY2spIHsKCQkJCQkJCQljYWxsYmFjayh0cnVlKTsKCQkJCQkJCX0KCQkJCQkJfSwKCQkJCQoJCQkJCQlzZW5kIDogZnVuY3Rpb24oaWQsIGFjdGlvbiwgZGF0YSkgewoJCQkJCQkJLy9jb25zb2xlLmxvZygnTWVkaWF0b3Iuc2VuZCcpOwoJCQkJCgkJCQkJCQl2YXIgcGFyc2VyLCB0YXJnZXRPcmlnaW4sIGNvcnNPYmogPSB7CgkJCQkJCQkJbXNnIDogZGF0YSwKCQkJCQkJCQlhY3Rpb24gOiBhY3Rpb24sCgkJCQkJCQkJaWQgOiBpZAoJCQkJCQkJfSwgd2lkZ2V0ID0gdGhpcy53aWRnZXRzW2lkXTsKCQkJCQoJCQkJCQkJaWYgKHdpZGdldCkgewoJCQkJCQkJCXBhcnNlciA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CgkJCQkJCQkJcGFyc2VyLmhyZWYgPSB3aWRnZXQuaWZyYW1lLnNyYzsKCQkJCQkJCQl0YXJnZXRPcmlnaW4gPSBwYXJzZXIucHJvdG9jb2wgKyAnLy8nICsgcGFyc2VyLmhvc3RuYW1lICsgKHBhcnNlci5wb3J0ICYmICBwYXJzZUludChwYXJzZXIucG9ydCwxMCkgIT09IDgwID8gKCc6JyArIHBhcnNlci5wb3J0KSA6ICcnKTsKCQkJCQkJCQl3aWRnZXQuaWZyYW1lLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoY29yc09iaiwgdGFyZ2V0T3JpZ2luKTsKCQkJCQkJCX0KCQkJCQkJfSwKCQkJCQoJCQkJCQliaW5kIDogZnVuY3Rpb24oaWQsIGFjdGlvbiwgY2FsbGJhY2spIHsKCQkJCQkJCS8vY29uc29sZS5sb2coJ01lZGlhdG9yLmJpbmQ6ICcgKyBhY3Rpb24pOwoJCQkJCQkJaWYgKHRoaXMuYWN0aW9uSGFuZGxlcnNbaWRdID09PSB1bmRlZmluZWQpIHsKCQkJCQkJCQl0aGlzLmFjdGlvbkhhbmRsZXJzW2lkXSA9IHt9OwoJCQkJCQkJfQoJCQkJCQkJdGhpcy5hY3Rpb25IYW5kbGVyc1tpZF1bYWN0aW9uXSA9IGNhbGxiYWNrOwoJCQkJCQl9LAoJCQkJCgkJCQkJCXVuYmluZCA6IGZ1bmN0aW9uKGlkLCBhY3Rpb24pIHsKCQkJCQkJCS8vY29uc29sZS5sb2coJ01lZGlhdG9yLnVuYmluZCcpOwoJCQkJCQkJZGVsZXRlIHRoaXMuYWN0aW9uSGFuZGxlcnNbaWRdW2FjdGlvbl07CgkJCQkJCQlpZiAoT2JqZWN0LmtleXModGhpcy5hY3Rpb25IYW5kbGVyc1tpZF0pLmxlbmd0aCA8PSAwKSB7CgkJCQkJCQkJZGVsZXRlIHRoaXMuYWN0aW9uSGFuZGxlcnNbaWRdOwoJCQkJCQkJfQoJCQkJCQl9LAoJCQkJCgkJCQkJCXJlY2VpdmUgOiBmdW5jdGlvbihtc2dPYmopIHsKCQkJCQkJCS8vY29uc29sZS5sb2coJ01lZGlhdG9yLnJlY2VpdmUnKTsKCQkJCQoJCQkJCQkJdmFyIG9yaWdpbiwgcGFyc2VyLCB3aWRnZXRJZCA9IG1zZ09iai5kYXRhLmlkLCB3aWRnZXQgPSB0aGlzLndpZGdldHNbd2lkZ2V0SWRdLCBteUFjdGlvbkhhbmRsZXJzID0gdGhpcy5hY3Rpb25IYW5kbGVyc1t3aWRnZXRJZF0sIGFjdGlvbiA9IG1zZ09iai5kYXRhLmFjdGlvbjsKCQkJCQoJCQkJCQkJaWYgKHdpZGdldCkgewoJCQkJCQkJCXBhcnNlciA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CgkJCQkJCQkJcGFyc2VyLmhyZWYgPSB3aWRnZXQuaWZyYW1lLnNyYzsKCQkJCQkJCQlvcmlnaW4gPSBwYXJzZXIucHJvdG9jb2wgKyAnLy8nICsgcGFyc2VyLmhvc3RuYW1lICsgKHBhcnNlci5wb3J0ICYmICBwYXJzZUludChwYXJzZXIucG9ydCwxMCkgIT09IDgwID8gKCc6JyArIHBhcnNlci5wb3J0KSA6ICcnKTsKCQkJCQoJCQkJCQkJCWlmIChvcmlnaW4gIT09IG1zZ09iai5vcmlnaW4pIHsKCQkJCQkJCQkJLy9jb25zb2xlLmxvZygnV2lkZ2V0IGlnbm9yZSBtZXNzYWdlIGZyb20gJyArIG1zZ09iai5vcmlnaW4pOwoJCQkJCQkJCQlyZXR1cm47CgkJCQkJCQkJfQoJCQkJCgkJCQkJCQkJaWYgKHdpZGdldCAmJiBXaWRnZXRmbHkuVXRpbHMuaXNGdW5jdGlvbih3aWRnZXRbYWN0aW9uXSkpIHsKCQkJCQkJCQkJd2lkZ2V0W2FjdGlvbl0obXNnT2JqLmRhdGEubXNnKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlpZiAoIVdpZGdldGZseS5VdGlscy5pc0VtcHR5KG15QWN0aW9uSGFuZGxlcnMpICYmIFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKG15QWN0aW9uSGFuZGxlcnNbYWN0aW9uXSkpIHsKCQkJCQkJCQkJCS8vbXlBY3Rpb25IYW5kbGVyc1thY3Rpb25dKG1zZ09iai5kYXRhLm1zZyk7CgkJCQkJCQkJCQlteUFjdGlvbkhhbmRsZXJzW2FjdGlvbl0uYXBwbHkod2lkZ2V0LFttc2dPYmouZGF0YS5tc2ddKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlyZXR1cm4gTWVkaWF0b3I7CgkJCQl9KSh0aGlzKTsKCQkJCQoJCQkJV2lkZ2V0Zmx5LlNlcnZlciA9IChmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7CgkJCQkJLy8gU2VydmVyCgkJCQkJLy8gLS0tLS0tLS0tLS0tLQoJCQkJCXZhciBTZXJ2ZXIgPSBmdW5jdGlvbigpIHsKCQkJCQkJdGhpcy5pZCA9IHdpbmRvdy5uYW1lOwoJCQkJCQl0aGlzLmV2ZW50cyA9IHt9OwoJCQkJCQl0aGlzLmluaXQoKTsKCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmluaGVyaXQoU2VydmVyLCBXaWRnZXRmbHkuRXZlbnRzKTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgc2VsZiA9IHRoaXMsIHBhcmFtRGF0YSA9IGRlY29kZVVSSUNvbXBvbmVudCh3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSkpOwoJCQkJCQl0aGlzLm9wdGlvbnMgPSBKU09OLnBhcnNlKHBhcmFtRGF0YSk7CgkJCQkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24obXNnT2JqKSB7CgkJCQkJCQlpZih3aW5kb3cucGFyZW50KXsKCQkJCQkJCQl2YXIgYWN0aW9uLCBvcmlnaW4sIHBhcnNlcjsKCQkJCQoJCQkJCQkJCXBhcnNlciA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CgkJCQkJCQkJcGFyc2VyLmhyZWYgPSBzZWxmLm9wdGlvbnMub3JpZ2luOwoJCQkJCQkJCW9yaWdpbiA9IHBhcnNlci5wcm90b2NvbCArICcvLycgKyBwYXJzZXIuaG9zdG5hbWUgKyAocGFyc2VyLnBvcnQgJiYgIHBhcnNlSW50KHBhcnNlci5wb3J0LDEwKSAhPT0gODAgPyAoJzonICsgcGFyc2VyLnBvcnQpIDogJycpOwoJCQkJCgkJCQkJCQkJaWYob3JpZ2luICE9PSAnZmlsZTovLycgJiYgb3JpZ2luICE9PSBtc2dPYmoub3JpZ2luKXsKCQkJCQkJCQkJLy9jb25zb2xlLmxvZygnU2VydmVyIGlnbm9yZSBtZXNzYWdlIGZyb20gJyArIG1zZ09iai5vcmlnaW4pOwoJCQkJCQkJCQlyZXR1cm47CgkJCQkJCQkJfQoJCQkJCgkJCQkJCQkJYWN0aW9uID0gbXNnT2JqLmRhdGEuYWN0aW9uOwoJCQkJCQkJCWlmIChXaWRnZXRmbHkuVXRpbHMuaXNGdW5jdGlvbihzZWxmW2FjdGlvbl0pKSB7CgkJCQkJCQkJCXNlbGZbYWN0aW9uXShtc2dPYmouZGF0YS5tc2cpOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCWlmICghV2lkZ2V0Zmx5LlV0aWxzLmlzRW1wdHkoc2VsZi5ldmVudHMpICYmIFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKHNlbGYuZXZlbnRzW2FjdGlvbl0pKSB7CgkJCQkJCQkJCQlzZWxmLmV2ZW50c1thY3Rpb25dKG1zZ09iai5kYXRhLm1zZyk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0sIGZhbHNlKTsKCQkJCQoJCQkJCQlpZih0aGlzLm9wdGlvbnMuYXV0b1N0YXJ0KXsKCQkJCQkJCXRoaXMudHJpZ2dlcignc3RhcnQnKTsKCQkJCQkJfQoJCQkJCgkJCQkJCWlmKHRoaXMub3B0aW9ucy5hdXRvR3Jvdyl7CgkJCQkJCQl0aGlzLmlzU2hvdyhmdW5jdGlvbih2YWx1ZSl7CgkJCQkJCQkJaWYodmFsdWUpewoJCQkJCQkJCQlzZWxmLmV4cGFuZCgpOwoJCQkJCQkJCX0KCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUub24gPSBmdW5jdGlvbihrZXksIGNhbGxiYWNrKSB7CgkJCQkJCXRoaXMuZXZlbnRzW2tleV0gPSBjYWxsYmFjazsKCQkJCQl9OwoJCQkJCgkJCQkJU2VydmVyLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbihrZXkpIHsKCQkJCQkJZGVsZXRlIHRoaXMuZXZlbnRzW2tleV07CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUudHJpZ2dlciA9IGZ1bmN0aW9uKGFjdGlvbiwgZGF0YSkgewoJCQkJCQkvL2NvbnNvbGUubG9nKCdTZXJ2ZXIudHJpZ2dlcicpOwoJCQkJCQl2YXIgY29yc09iaiA9IHsKCQkJCQkJCW1zZyA6IGRhdGEsCgkJCQkJCQlhY3Rpb24gOiBhY3Rpb24sCgkJCQkJCQlpZCA6IHRoaXMuaWQKCQkJCQkJfTsKCQkJCQoJCQkJCQkvL2NvbnNvbGUubG9nKGNvcnNPYmopOwoJCQkJCQlwYXJlbnQucG9zdE1lc3NhZ2UoY29yc09iaiwgdGhpcy5vcHRpb25zLm9yaWdpbik7CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUuaXNTaG93ID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKCQkJCQkJdmFyIHNlbGYgPSB0aGlzLCB3cmFwcGVyID0gZnVuY3Rpb24oZGF0YSl7CgkJCQkJCQlzZWxmLm9mZignX2lzU2hvdycsIHdyYXBwZXIpOwoJCQkJCQkJY2FsbGJhY2soZGF0YSk7CgkJCQkJCX07CgkJCQkJCXRoaXMub24oJ19pc1Nob3cnLCB3cmFwcGVyKTsKCQkJCQkJdGhpcy50cmlnZ2VyKCdpc1Nob3cnKTsKCQkJCQl9OwoJCQkJCgkJCQkJU2VydmVyLnByb3RvdHlwZS5vblNob3cgPSBmdW5jdGlvbihjYWxsYmFjaykgewoJCQkJCQl0aGlzLm9uKCdfb25TaG93JywgY2FsbGJhY2spOwoJCQkJCX07CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHsKCQkJCQkJdGhpcy50cmlnZ2VyKCdzaG93Jyk7CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUuYWNrID0gZnVuY3Rpb24oKSB7CgkJCQkJCXRoaXMudHJpZ2dlcignYWNrJyk7CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbigpewoJCQkJCQl2YXIgc2VsZiA9IHRoaXM7CgkJCQkJCXRoaXMudHJpZ2dlcignc3RhcnQnKTsKCQkJCQkJaWYodGhpcy5vcHRpb25zLmF1dG9Hcm93KXsKCQkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKXsKCQkJCQkJCQlzZWxmLmV4cGFuZCgpOwoJCQkJCQkJfSwxMDApOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQl0aGlzLnRyaWdnZXIoJ2hpZGUnKTsKCQkJCQl9OwoJCQkJCgkJCQkJU2VydmVyLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbigpIHsKCQkJCQkJdGhpcy50cmlnZ2VyKCd0b2dnbGUnKTsKCQkJCQl9OwoJCQkJCgkJCQkJU2VydmVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQkvL2NvbnNvbGUubG9nKCdQcmVwYXJlIHNlcnZlciBjbG9zZSBhY3Rpb24nKTsKCQkJCQkJdmFyIHNlbGYgPSB0aGlzOwoJCQkJCQlXaWRnZXRmbHkuVXRpbHMuZWFjaCh0aGlzLmV2ZW50cywgZnVuY3Rpb24oa2V5KSB7CgkJCQkJCQlkZWxldGUgc2VsZi5ldmVudHNba2V5XTsKCQkJCQkJfSk7CgkJCQkJCXRoaXMudHJpZ2dlcignY2xvc2UnKTsKCQkJCQoJCQkJCX07CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLmV4cGFuZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgc2VsZiA9IHRoaXMsY29tcGFjdCA9IGZ1bmN0aW9uKCl7CgkJCQkJCQlpZihkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKXsKCQkJCQkJCQl2YXIgYm9keSA9IGRvY3VtZW50LmJvZHksCgkJCQkJCQkJCWh0bWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsCgkJCQkJCQkJCWhlaWdodCA9IE1hdGgubWF4KCBib2R5LnNjcm9sbEhlaWdodCwgYm9keS5vZmZzZXRIZWlnaHQsCgkJCQkJCQkJCQkJCQlodG1sLmNsaWVudEhlaWdodCwgaHRtbC5zY3JvbGxIZWlnaHQsIGh0bWwub2Zmc2V0SGVpZ2h0ICk7CgkJCQkJCQkJc2VsZi50cmlnZ2VyKCdzaXplQ2hhbmdlJywge2hlaWdodCA6IGhlaWdodH0pOwoJCQkJCQkJfWVsc2V7CgkJCQkJCQkJY29tcGFjdC5faWQgPSBzZXRUaW1lb3V0KGNvbXBhY3QsMTAwKTsKCQkJCQkJCX0KCQkJCQkJfTsKCQkJCQkJY29tcGFjdCgpOwoJCQkJCX07CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLmNvbXBhY3QgPSBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIHNlbGYgPSB0aGlzLHJlc2l6ZSA9IGZ1bmN0aW9uKCl7CgkJCQkJCQkJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHJlc2l6ZSwgZmFsc2UpOwoJCQkJCQkJCXZhciBib2R5ID0gZG9jdW1lbnQuYm9keSwKCQkJCQkJCQkJaHRtbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwKCQkJCQkJCQkJaGVpZ2h0ID0gTWF0aC5tYXgoIGJvZHkuc2Nyb2xsSGVpZ2h0LCBib2R5Lm9mZnNldEhlaWdodCwKCQkJCQkJCQkJCQkJCWh0bWwuY2xpZW50SGVpZ2h0LCBodG1sLnNjcm9sbEhlaWdodCwgaHRtbC5vZmZzZXRIZWlnaHQgKTsKCQkJCQkJCQlzZWxmLnRyaWdnZXIoJ3NpemVDaGFuZ2UnLCB7aGVpZ2h0IDogaGVpZ2h0fSk7CgkJCQkJCQl9LCBjb21wYWN0ID0gZnVuY3Rpb24oKXsKCQkJCQkJCWlmKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpewoJCQkJCQkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCByZXNpemUsIGZhbHNlKTsKCQkJCQkJCQlzZWxmLnRyaWdnZXIoJ3NpemVDaGFuZ2UnLCB7aGVpZ2h0IDogMH0pOwoJCQkJCQkJfWVsc2V7CgkJCQkJCQkJY29tcGFjdC5faWQgPSBzZXRUaW1lb3V0KGNvbXBhY3QsMTAwKTsKCQkJCQkJCX0KCQkJCQkJfTsKCQkJCQkJY29tcGFjdCgpOwoJCQkJCX07CgkJCQkKCQkJCQlyZXR1cm4gU2VydmVyOwoJCQkJCgkJCQl9KSh0aGlzKTsKCQkJCQoJCQkJV2lkZ2V0Zmx5LldpZGdldCA9IChmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7CgkJCQkJLy8gV2lkZ2V0CgkJCQkJLy8gLS0tLS0tLS0tLS0tLQoJCQkJCXZhciBXaWRnZXQgPSBmdW5jdGlvbihvcHRpb25zKSB7CgkJCQkJCXRoaXMuaWQgPSBXaWRnZXRmbHkuVXRpbHMudW5pcXVlSWQoJ3dpZGdldCcpOwoJCQkJCQl0aGlzLnN0YXJ0ZWQgPSBmYWxzZTsKCQkJCQkJcmV0dXJuIHRoaXM7CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5ERUZBVUxUUyA9IFdpZGdldGZseS5VdGlscy5leHRlbmQoe30sewoJCQkJCQlhdXRvR3JvdyA6IGZhbHNlLAoJCQkJCQlhdXRvU3RhcnQ6IHRydWUsCgkJCQkJCXNob3cgOiB0cnVlLAoJCQkJCQlzcGlubmVyIDogJzxkaXYgY2xhc3M9IndpZGdldGZseSB3Zi1zcGlubmVyIj48ZGl2IGNsYXNzPSJyZWN0MSI+PC9kaXY+PGRpdiBjbGFzcz0icmVjdDIiPjwvZGl2PjxkaXYgY2xhc3M9InJlY3QzIj48L2Rpdj48ZGl2IGNsYXNzPSJyZWN0NCI+PC9kaXY+PGRpdiBjbGFzcz0icmVjdDUiPjwvZGl2PjwvZGl2PicKCQkJCQl9KTsKCQkJCQoJCQkJCVdpZGdldGZseS5VdGlscy5pbmhlcml0KFdpZGdldCwgV2lkZ2V0Zmx5LkV2ZW50cyk7CgkJCQkKCQkJCQlXaWRnZXQucHJvdG90eXBlLmdldElkID0gZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiB0aGlzLmlkOwoJCQkJCX07CgkJCQkKCQkJCQlXaWRnZXQucHJvdG90eXBlLnN0eWxlID0gZnVuY3Rpb24oKSB7CgkJCQkJCXZhciByID0gZnVuY3Rpb24oZWwpewoJCQkJCQkJaWYoZWwuY2xhc3NOYW1lKXsKCQkJCQkJCQlXaWRnZXRmbHkuVXRpbHMuYWRkQ2xhc3MoZWwsIGVsLmNsYXNzTmFtZSk7CgkJCQkJCQl9CgkJCQkJCQl2YXIgaSxqLCBub2RlcyA9IGVsLmNoaWxkTm9kZXM7CgkJCQkJCQlmb3IoaSBpbiBub2Rlcyl7CgkJCQkJCQkJaWYobm9kZXNbaV0uY2xhc3NOYW1lICYmIChub2Rlc1tpXS5jbGFzc05hbWUuaW5kZXhPZignd2lkZ2V0Zmx5JykgPT09IDAgfHwgbm9kZXNbaV0uY2xhc3NOYW1lLmluZGV4T2YoJ3dmLScpID09PSAwKSl7CgkJCQkKCQkJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmFkZENsYXNzKG5vZGVzW2ldLCBub2Rlc1tpXS5jbGFzc05hbWUpOwoJCQkJCQkJCX0KCQkJCQkJCQlpZihub2Rlc1tpXS5jaGlsZE5vZGVzKXsKCQkJCQkJCQkJZm9yKGogaW4gbm9kZXNbaV0uY2hpbGROb2Rlcyl7CgkJCQkJCQkJCQlyKG5vZGVzW2ldLmNoaWxkTm9kZXNbal0pOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9OwoJCQkJCQlyKHRoaXMuZWwpOwoJCQkJCX07CgkJCQkKCQkJCQlXaWRnZXQucHJvdG90eXBlLmdldElmcmFtZSA9IGZ1bmN0aW9uKCl7CgkJCQkJCXZhciBpZnJhbWUgPSB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpOwoJCQkJCQlpZighaWZyYW1lKXsKCQkJCQkJCWlmKHRoaXMuZWwudGFnTmFtZSA9PT0gJ0lGUkFNRScpewoJCQkJCQkJCWlmcmFtZSA9IHRoaXMuZWw7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJcmV0dXJuIGlmcmFtZTsKCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5vblN0YXJ0ID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKCQkJCQkJaWYgKFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgewoJCQkJCQkJdGhpcy5vbignb25TdGFydCcsIGNhbGxiYWNrKTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlXaWRnZXQucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oKSB7CgkJCQkJCS8vY29uc29sZS5sb2coJ1dpZGdldC5BY3Rpb24gc3RhcnQnKTsKCQkJCQkJaWYodGhpcy5zdGFydGVkKXsgcmV0dXJuOyB9CgkJCQkKCQkJCQkJdmFyIGhhbmRsZXJzID0gV2lkZ2V0Zmx5Lk1lZGlhdG9yLmdldEFjdGlvbkhhbmRsZXJzKHRoaXMuaWQpOwoJCQkJCQlpZiAoaGFuZGxlcnMgJiYgV2lkZ2V0Zmx5LlV0aWxzLmlzRnVuY3Rpb24oaGFuZGxlcnMub25TdGFydCkpIHsKCQkJCQkJCWhhbmRsZXJzLm9uU3RhcnQuYXBwbHkodGhpcyxhcmd1bWVudHMpOwoJCQkJCQl9CgkJCQkKCQkJCQkJaWYodGhpcy5zcGlubmVyKXsKCQkJCQkJCWlmKHRoaXMuc3Bpbm5lci5wYXJlbnROb2RlKXsKCQkJCQkJCQl0aGlzLnNwaW5uZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnNwaW5uZXIpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkKCQkJCQkJaWYoV2lkZ2V0Zmx5LlV0aWxzLmlzVHJ1ZSh0aGlzLm9wdGlvbnMuc2hvdykpewoJCQkJCQkJdGhpcy5zaG93KCk7CgkJCQkJCX1lbHNlewoJCQkJCQkJdGhpcy5oaWRlKCk7CgkJCQkJCX0KCQkJCQkJdGhpcy5zdGFydGVkID0gdHJ1ZTsKCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5vbkhpZGUgPSBmdW5jdGlvbihjYWxsYmFjaykgewoJCQkJCQlpZiAoV2lkZ2V0Zmx5LlV0aWxzLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7CgkJCQkJCQl0aGlzLm9uKCdvbkhpZGUnLCBjYWxsYmFjayk7CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oKSB7CgkJCQkJCS8vY29uc29sZS5sb2coJ1dpZGdldC5BY3Rpb24gaGlkZScpOwoJCQkJCQlXaWRnZXRmbHkuVXRpbHMucmVtb3ZlQ2xhc3ModGhpcy5lbCwgJ3dmLXNob3cgd2YtaGlkZScpOwoJCQkJCQlXaWRnZXRmbHkuVXRpbHMuYWRkQ2xhc3ModGhpcy5lbCwgJ3dmLWhpZGUnKTsKCQkJCQkJdmFyIGhhbmRsZXJzID0gV2lkZ2V0Zmx5Lk1lZGlhdG9yLmdldEFjdGlvbkhhbmRsZXJzKHRoaXMuaWQpOwoJCQkJCQlpZiAoaGFuZGxlcnMgJiYgV2lkZ2V0Zmx5LlV0aWxzLmlzRnVuY3Rpb24oaGFuZGxlcnMub25IaWRlKSkgewoJCQkJCQkJaGFuZGxlcnMub25IaWRlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlXaWRnZXQucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJaWYodGhpcy5pc1Nob3coKSl7CgkJCQkJCQkJdGhpcy5oaWRlKCk7CgkJCQkJCQl9ZWxzZXsKCQkJCQkJCQl0aGlzLnNob3coKTsKCQkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5vblNob3cgPSBmdW5jdGlvbihjYWxsYmFjaykgewoJCQkJCQlpZiAoV2lkZ2V0Zmx5LlV0aWxzLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7CgkJCQkJCQl0aGlzLm9uKCdvblNob3cnLCBjYWxsYmFjayk7CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5pc1Nob3cgPSBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIHJlc3VsdCA9IFdpZGdldGZseS5VdGlscy5oYXNDbGFzcyh0aGlzLmVsLCd3Zi1zaG93Jyk7CgkJCQkJCXRoaXMudHJpZ2dlcignX2lzU2hvdycscmVzdWx0KTsKCQkJCQkJcmV0dXJuIHJlc3VsdDsKCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKSB7CgkJCQkJCS8vY29uc29sZS5sb2coJ1dpZGdldC5BY3Rpb24gc2hvdycpOwoJCQkJCQl2YXIgaGFuZGxlcnM7CgkJCQkJCVdpZGdldGZseS5VdGlscy5yZW1vdmVDbGFzcyh0aGlzLmVsLCAnd2Ytc2hvdyB3Zi1oaWRlJyk7CgkJCQkJCVdpZGdldGZseS5VdGlscy5hZGRDbGFzcyh0aGlzLmVsLCAnd2Ytc2hvdycpOwoJCQkJCQloYW5kbGVycyA9IFdpZGdldGZseS5NZWRpYXRvci5nZXRBY3Rpb25IYW5kbGVycyh0aGlzLmlkKTsKCQkJCQkJaWYgKGhhbmRsZXJzICYmIFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKGhhbmRsZXJzLm9uU2hvdykpIHsKCQkJCQkJCWhhbmRsZXJzLm9uU2hvdy5hcHBseSh0aGlzLGFyZ3VtZW50cyk7CgkJCQkJCX0KCQkJCQkJdGhpcy50cmlnZ2VyKCdfb25TaG93Jyk7CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUub25CZWZvcmVDbG9zZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJCQkJCWlmIChXaWRnZXRmbHkuVXRpbHMuaXNGdW5jdGlvbihjYWxsYmFjaykpIHsKCQkJCQkJCXRoaXMub24oJ29uQmVmb3JlQ2xvc2UnLCBjYWxsYmFjayk7CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQkvL2NvbnNvbGUubG9nKCdXaWRnZXQuQWN0aW9uIGNsb3NlJyk7CgkJCQkJCXZhciByLCBzZWxmID0gdGhpcywgaGFuZGxlcnM7CgkJCQkJCWhhbmRsZXJzID0gV2lkZ2V0Zmx5Lk1lZGlhdG9yLmdldEFjdGlvbkhhbmRsZXJzKHRoaXMuaWQpOwoJCQkJCQlpZiAoaGFuZGxlcnMgJiYgV2lkZ2V0Zmx5LlV0aWxzLmlzRnVuY3Rpb24oaGFuZGxlcnMub25CZWZvcmVDbG9zZSkpIHsKCQkJCQkJCXIgPSBoYW5kbGVycy5vbkJlZm9yZUNsb3NlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTsKCQkJCQkJfQoJCQkJCQlpZihyICE9PSBmYWxzZSl7CgkJCQkJCQl0aGlzLnRyaWdnZXIoJ19vbkNsb3NlJyk7CgkJCQkJCQlXaWRnZXRmbHkuTWVkaWF0b3IudW5yZWdpc3Rlcih0aGlzLmlkLCBmdW5jdGlvbigpIHsKCQkJCQkJCQlzZWxmLmNvbnRhaW5lci5yZW1vdmVDaGlsZChzZWxmLmVsKTsKCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIG5vd1NjcmlwdHMgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0OwoJCQkJCQkvL2NvbnNvbGUubG9nKHRoaXMpOwoJCQkJCQlXaWRnZXRmbHkuTWVkaWF0b3IucmVnaXN0ZXIodGhpcy5pZCwgdGhpcyk7CgkJCQkJCWlmKG5vd1NjcmlwdHMpewoJCQkJCQkJbm93U2NyaXB0cy5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCB0aGlzLmlkKTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlXaWRnZXQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgc2VsZiA9IHRoaXMsIHNyYywgaWZyYW1lLCBvcmlnaW4sIHVybE9wdGlvbnM7CgkJCQkJCWlmICh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICdmaWxlOicpIHsKCQkJCQkJCW9yaWdpbiA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlvcmlnaW4gPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICsgKHBhcnNlSW50KHdpbmRvdy5sb2NhdGlvbi5wb3J0LDEwKSAmJiAgd2luZG93LmxvY2F0aW9uLnBvcnQgIT09IDgwID8gKCc6JyArIHdpbmRvdy5sb2NhdGlvbi5wb3J0KSA6ICcnKTsKCQkJCQkJfQoJCQkJCgkJCQkJCXVybE9wdGlvbnMgPSB7CgkJCQkJCQlvcmlnaW4gOiBvcmlnaW4sCgkJCQkJCQlvcHRpb25zIDogdGhpcy5vcHRpb25zLm9wdGlvbnMsCgkJCQkJCQlhdXRvR3JvdyA6IHRoaXMub3B0aW9ucy5hdXRvR3JvdywKCQkJCQkJCWF1dG9TdGFydCA6IHRoaXMub3B0aW9ucy5hdXRvU3RhcnQKCQkJCQkJfTsKCQkJCQoJCQkJCQl0aGlzLnNwaW5uZXIgPSBXaWRnZXRmbHkuVXRpbHMudG9FbGVtZW50KHRoaXMub3B0aW9ucy5zcGlubmVyKTsKCQkJCQoJCQkJCQl0aGlzLmVsID0gV2lkZ2V0Zmx5LlV0aWxzLnRvRWxlbWVudCh0aGlzLm9wdGlvbnMudGVtcGxhdGUpOwoJCQkJCgkJCQkJCWlmcmFtZSA9IHRoaXMuZ2V0SWZyYW1lKCk7CgkJCQkKCQkJCQkJaWZyYW1lLnNldEF0dHJpYnV0ZSgnbmFtZScsIHRoaXMuaWQpOwoJCQkJCgkJCQkJCWlmICh0aGlzLm9wdGlvbnMuc3JjLmluZGV4T2YoJyMnKSA9PT0gLTEpIHsKCQkJCQkJCXNyYyA9IHRoaXMub3B0aW9ucy5zcmMgKyAnIyc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlzcmMgPSB0aGlzLm9wdGlvbnMuc3JjLnN1YnN0cmluZygwLHRoaXMub3B0aW9ucy5zcmMuaW5kZXhPZignIycpKSArICcjJzsKCQkJCQkJfQoJCQkJCgkJCQkJCXNyYyA9IHNyYyArIGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeSh1cmxPcHRpb25zKSk7CgkJCQkKCQkJCQkJaWZyYW1lLm9ubG9hZCA9IGZ1bmN0aW9uKGUpewoJCQkJCQkJaWYoV2lkZ2V0Zmx5LlV0aWxzLmlzVHJ1ZShzZWxmLm9wdGlvbnMuYXV0b1N0YXJ0KSl7CgkJCQkJCQkJdmFyIHRpbWVySWQsIHJ1biA9IDAsIGFjayA9IGZhbHNlOwoJCQkJCgkJCQkJCQkJc2VsZi5vbignYWNrJyxmdW5jdGlvbigpewoJCQkJCQkJCQlhY2sgPSB0cnVlOwoJCQkJCQkJCQljbGVhckludGVydmFsKHRpbWVySWQpOwoJCQkJCQkJCX0pOwoJCQkJCgkJCQkJCQkJdGltZXJJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7CgkJCQkJCQkJCXJ1bisrOwoJCQkJCQkJCQlpZihydW4gPiAzKSB7CgkJCQkJCQkJCQljbGVhckludGVydmFsKHRpbWVySWQpOwoJCQkJCQkJCQkJaWYoIWFjayl7CgkJCQkJCQkJCQkJc2VsZi5zdGFydCgpOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9ZWxzZXsKCQkJCQkJCQkJCWlmKGFjayl7CgkJCQkJCQkJCQkJY2xlYXJJbnRlcnZhbCh0aW1lcklkKTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfQoJCQkJCQkJCQlzZWxmLnRyaWdnZXIoJ2FjaycpOwoJCQkJCQkJCX0sNDAwKTsKCQkJCQoJCQkJCQkJfQoJCQkJCQl9OwoJCQkJCgkJCQkJCWlmcmFtZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIHNyYyk7CgkJCQkKCQkJCQkJcmV0dXJuIGlmcmFtZTsKCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5zaXplQ2hhbmdlID0gZnVuY3Rpb24oc2l6ZSl7CgkJCQkJCWlmKHRoaXMuaXNTaG93KCkpewoJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmlubmVyU3R5bGUodGhpcy5pZnJhbWUse3NpemU6ICdoZWlnaHQ6JyArICgodHlwZW9mIHNpemUuaGVpZ2h0ID09PSAnc3RyaW5nJykgPyBzaXplLmhlaWdodCA6IChTdHJpbmcoc2l6ZS5oZWlnaHQpICsgJ3B4JykpfSk7CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJcmV0dXJuIFdpZGdldDsKCQkJCX0pKHRoaXMpOwoJCQkJCgkJCQlXaWRnZXRmbHkuUGFuZWwgPSAoZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnOwoJCQkJCgkJCQkJLy8gV2lkZ2V0Zmx5LlBhbmVsCgkJCQkJLy8gLS0tLS0tLS0tLS0tLQoJCQkJCXZhciBQYW5lbCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKCQkJCQoJCQkJCQlXaWRnZXRmbHkuV2lkZ2V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkKCQkJCQkJdGhpcy5vcHRpb25zID0gV2lkZ2V0Zmx5LlV0aWxzLmV4dGVuZCh7fSwgUGFuZWwuREVGQVVMVFMsb3B0aW9ucyk7CgkJCQkKCQkJCQkJaWYgKG9wdGlvbnMgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLmNvbnRhaW5lciA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMuY29udGFpbmVyID09PSBudWxsKSB7CgkJCQkJCQkvL2NvbnNvbGUubG9nKCdjb250YWluZXIgbm90IGRlZmluZWQuJyk7CgkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCX0KCQkJCQoJCQkJCQlpZih0eXBlb2Ygb3B0aW9ucy5jb250YWluZXIgPT09ICdzdHJpbmcnKXsKCQkJCQkJCXRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmNvbnRhaW5lcik7CgkJCQkJCX1lbHNlIGlmKHR5cGVvZiBvcHRpb25zLmNvbnRhaW5lciA9PT0gJ29iamVjdCcpewoJCQkJCQkJdGhpcy5jb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lcjsKCQkJCQkJfQoJCQkJCgkJCQkJCWlmICh0aGlzLmNvbnRhaW5lciAmJiB0aGlzLmNvbnRhaW5lci5sZW5ndGggPD0gMCkgewoJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQl9CgkJCQkKCQkJCQkJdGhpcy5yZWdpc3Rlcih0aGlzLmlkKTsKCQkJCQoJCQkJCQl0aGlzLnJlbmRlcigpOwoJCQkJCgkJCQkJCXRoaXMuaWZyYW1lID0gdGhpcy5nZXRJZnJhbWUoKTsKCQkJCQoJCQkJCQl0aGlzLnN0eWxlKCk7CgkJCQkKCQkJCQkJaWYgKHRoaXMuY29udGFpbmVyKSB7CgkJCQkJCQlmb3IgKHZhciBuIGluIHRoaXMuY29udGFpbmVyLmNoaWxkTm9kZXMpIHsKCQkJCQkJCQlpZih0aGlzLmNvbnRhaW5lci5jaGlsZE5vZGVzW25dLm5vZGVOYW1lICE9PSAnU0NSSVBUJyAmJiB0aGlzLmNvbnRhaW5lci5jaGlsZE5vZGVzW25dLnBhcmVudE5vZGUgPT09IHRoaXMuY29udGFpbmVyKXsKCQkJCQkJCQkJdGhpcy5jb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5jb250YWluZXIuY2hpbGROb2Rlc1tuXSk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5zcGlubmVyKTsKCQkJCQkJCXRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZWwpOwoJCQkJCQl9CgkJCQkKCQkJCQkJcmV0dXJuIHRoaXM7CgkJCQkJfTsKCQkJCQoJCQkJCVBhbmVsLkRFRkFVTFRTID0gV2lkZ2V0Zmx5LlV0aWxzLmV4dGVuZCh7fSwgV2lkZ2V0Zmx5LldpZGdldC5ERUZBVUxUUyx7CgkJCQkJCXRlbXBsYXRlIDogJzxpZnJhbWUgYWxsb3d0cmFuc3BhcmVuY3k9InRydWUiIGZyYW1lYm9yZGVyPSIwIiB0YWJpbmRleD0iMCIgdGl0bGU9IldpZGdldGZseSBXaWRnZXQiIHdpZHRoPSIxMDAlIiBjbGFzcz0id2lkZ2V0Zmx5IHdmLXBhbmVsIHdmLWhpZGUiPjwvaWZyYW1lPicsCgkJCQkJCW9wdGlvbnMgOiB7CgkJCQkKCQkJCQkJfQoJCQkJCX0pOwoJCQkJCgkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmluaGVyaXQoUGFuZWwsIFdpZGdldGZseS5XaWRnZXQpOwoJCQkJCgkJCQkJUGFuZWwucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24oKSB7CgkJCQkJCS8vY29uc29sZS5sb2coJ1dpZGdldC5BY3Rpb24gY2xvc2UnKTsKCQkJCQkJdmFyIHIsIHNlbGYgPSB0aGlzLCBoYW5kbGVyczsKCQkJCQkJaGFuZGxlcnMgPSBXaWRnZXRmbHkuTWVkaWF0b3IuZ2V0QWN0aW9uSGFuZGxlcnModGhpcy5pZCk7CgkJCQkJCWlmIChoYW5kbGVycyAmJiBXaWRnZXRmbHkuVXRpbHMuaXNGdW5jdGlvbihoYW5kbGVycy5vbkJlZm9yZUNsb3NlKSkgewoJCQkJCQkJciA9IGhhbmRsZXJzLm9uQmVmb3JlQ2xvc2UoKTsKCQkJCQkJfQoJCQkJCQlpZiAociAhPT0gZmFsc2UpIHsKCQkJCQkJCVdpZGdldGZseS5NZWRpYXRvci51bnJlZ2lzdGVyKHRoaXMuaWQsIGZ1bmN0aW9uKCkgewoJCQkJCQkJCXNlbGYuY29udGFpbmVyLnJlbW92ZSgwKTsKCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCXJldHVybiBQYW5lbDsKCQkJCX0pKHRoaXMpOwoJCQkJCgkJCQlXaWRnZXRmbHkuTW9kYWwgPSAoZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnOwoJCQkJCS8vIFdpZGdldGZseS5Nb2RhbAoJCQkJCS8vIC0tLS0tLS0tLS0tLS0KCQkJCQl2YXIgTW9kYWwgPSBmdW5jdGlvbihvcHRpb25zKSB7CgkJCQkJCXZhciBzZWxmID0gdGhpcywgc2l6ZUNsYXNzLCBhdywgdzsKCQkJCQoJCQkJCQlXaWRnZXRmbHkuV2lkZ2V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJCXRoaXMub3B0aW9ucyA9IFdpZGdldGZseS5VdGlscy5leHRlbmQoe30sIE1vZGFsLkRFRkFVTFRTLG9wdGlvbnMpOwoJCQkJCQl0aGlzLmNvbnRhaW5lciA9IHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7CgkJCQkKCQkJCQkJaWYgKG9wdGlvbnMgPT09IHVuZGVmaW5lZCkgewoJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQl9CgkJCQkKCQkJCQkJYXcgPSBXaWRnZXRmbHkuTWVkaWF0b3Iud2lkZ2V0czsKCQkJCQkJZm9yKHcgaW4gYXcpewoJCQkJCQkJaWYoYXdbd10gaW5zdGFuY2VvZiBXaWRnZXRmbHkuTW9kYWwpewoJCQkJCQkJCWF3W3ddLmNsb3NlKCk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQoJCQkJCQl0aGlzLnJlZ2lzdGVyKHRoaXMuaWQpOwoJCQkJCgkJCQkJCWlmICh0aGlzLmNvbnRhaW5lcikgewoJCQkJCQkJdGhpcy5yZW5kZXIoKTsKCQkJCQoJCQkJCQkJdGhpcy5pZnJhbWUgPSB0aGlzLmdldElmcmFtZSgpOwoJCQkJCgkJCQkJCQl0aGlzLmJhY2tkcm9wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCQkKCQkJCQkJCWlmKHRoaXMub3B0aW9ucy5zaXplID09PSAnbGFyZ2UnKXsKCQkJCQkJCQlzaXplQ2xhc3MgPSAnd2YtbW9kYWwtbGcnOwoJCQkJCQkJfWVsc2UgaWYodGhpcy5vcHRpb25zLnNpemUgPT09ICdzbWFsbCcpewoJCQkJCQkJCXNpemVDbGFzcyA9ICd3Zi1tb2RhbC1zbSc7CgkJCQkJCQl9ZWxzZXsKCQkJCQkJCQlzaXplQ2xhc3MgPSAnd2YtbW9kYWwtbWQnOwoJCQkJCQkJfQoJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmFkZENsYXNzKHRoaXMuZWwsc2l6ZUNsYXNzKTsKCQkJCQoJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmFkZENsYXNzKHRoaXMuYmFja2Ryb3AsJ3dpZGdldGZseSB3Zi1tb2RhbC1iYWNrZHJvcCB3Zi1oaWRlJyk7CgkJCQkKCQkJCQkJCS8vYmluZCBjbG9zZSBldmVudAoJCQkJCQkJdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcud2YtY2xvc2UnKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJc2VsZi5oaWRlKCk7CgkJCQkJCQl9OwoJCQkJCgkJCQkJCQl0aGlzLmVsLm9uY2xpY2sgPSBmdW5jdGlvbihlKXsKCQkJCQkJCQlpZihlLnRhcmdldCA9PT0gc2VsZi5lbCl7CgkJCQkJCQkJCXNlbGYuaGlkZSgpOwoJCQkJCQkJCX0KCQkJCQkJCX07CgkJCQkKCQkJCQkJCWlmKHRoaXMub3B0aW9ucy5iYWNrZHJvcCl7CgkJCQkJCQkJdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5iYWNrZHJvcCk7CgkJCQkJCQl9CgkJCQkKCQkJCQkJCXRoaXMuc3R5bGUoKTsKCQkJCQoJCQkJCQkJdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcud2YtbW9kYWwtY29udGVudCcpLmluc2VydEJlZm9yZSh0aGlzLnNwaW5uZXIsdGhpcy5pZnJhbWUpOwoJCQkJCQkJdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5lbCk7CgkJCQkKCQkJCQkJfQoJCQkJCgkJCQkJCXRoaXMucmVzaXplQ2FsbGJhY2sgPSBmdW5jdGlvbihlKXsKCQkJCQkJCWlmKHNlbGYuaXNTaG93KCkpewoJCQkJCQkJCVdpZGdldGZseS5VdGlscy50aHJvdHRsZShzZWxmLnN0eWxlLCBzZWxmKTsKCQkJCQkJCX0KCQkJCQkJfTsKCQkJCQoJCQkJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5yZXNpemVDYWxsYmFjaywgZmFsc2UpOwoJCQkJCgkJCQkJCXJldHVybiB0aGlzOwoJCQkJCX07CgkJCQkKCQkJCQlNb2RhbC5ERUZBVUxUUyA9IFdpZGdldGZseS5VdGlscy5leHRlbmQoe30sIFdpZGdldGZseS5XaWRnZXQuREVGQVVMVFMsewoJCQkJCQlzaG93IDogZmFsc2UsCgkJCQkJCWJhY2tkcm9wIDogdHJ1ZSwKCQkJCQkJdGVtcGxhdGUgOiAnPGRpdiBjbGFzcz0id2lkZ2V0Zmx5IHdmLW1vZGFsIHdmLWhpZGUiPjxkaXYgY2xhc3M9IndmLW1vZGFsLWRpYWxvZyI+PGRpdiBjbGFzcz0id2YtbW9kYWwtY29udGVudCB3Zi1hbmltYXRlZC1mYWRlSW5VcEJpZyB3Zi1hbmltYXRlZC1tb2RhbCI+PGEgY2xhc3M9IndmLWNsb3NlIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiPiYjMjE1PC9hPjxpZnJhbWUgYWxsb3d0cmFuc3BhcmVuY3k9InRydWUiIGZyYW1lYm9yZGVyPSIwIiB0YWJpbmRleD0iMCIgdGl0bGU9IldpZGdldGZseSBXaWRnZXQiIHdpZHRoPSIxMDAlIiBjbGFzcz0id2YtbW9kYWwtYm9keSB3Zi1zaG93Ij48L2lmcmFtZT48L2Rpdj48L2Rpdj48L2Rpdj4nLAoJCQkJCQlvcHRpb25zIDogewoJCQkJCgkJCQkJCX0KCQkJCQl9KTsKCQkJCQoJCQkJCVdpZGdldGZseS5VdGlscy5pbmhlcml0KE1vZGFsLCBXaWRnZXRmbHkuV2lkZ2V0KTsKCQkJCQoJCQkJCU1vZGFsLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKSB7CgkJCQkJCS8vc2hvdyBvbmx5IG9uZSBtb2RhbCBhdCBhIHRpbWUKCQkJCQkJZm9yKHZhciBpIGluIHRoaXMubWVkaWF0b3Iud2lkZ2V0cyl7CgkJCQkJCQlpZih0aGlzLm1lZGlhdG9yLndpZGdldHNbaV0gaW5zdGFuY2VvZiBXaWRnZXRmbHkuTW9kYWwpewoJCQkJCQkJCWlmKHRoaXMubWVkaWF0b3Iud2lkZ2V0c1tpXS5pc1Nob3coKSl7CgkJCQkJCQkJCXRoaXMubWVkaWF0b3Iud2lkZ2V0c1tpXS5oaWRlKCk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXRoaXMuc3R5bGUoKTsKCQkJCQkJV2lkZ2V0Zmx5LldpZGdldC5wcm90b3R5cGUuc2hvdy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQlpZihXaWRnZXRmbHkuVXRpbHMuaXNUcnVlKHRoaXMub3B0aW9ucy5iYWNrZHJvcCkpewoJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLnJlbW92ZUNsYXNzKHRoaXMuYmFja2Ryb3AsICd3Zi1zaG93IHdmLWhpZGUnKTsKCQkJCQkJCVdpZGdldGZseS5VdGlscy5hZGRDbGFzcyh0aGlzLmJhY2tkcm9wLCAnd2Ytc2hvdycpOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCU1vZGFsLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oKSB7CgkJCQkJCVdpZGdldGZseS5XaWRnZXQucHJvdG90eXBlLmhpZGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJaWYoV2lkZ2V0Zmx5LlV0aWxzLmlzVHJ1ZSh0aGlzLm9wdGlvbnMuYmFja2Ryb3ApKXsKCQkJCQkJCVdpZGdldGZseS5VdGlscy5yZW1vdmVDbGFzcyh0aGlzLmJhY2tkcm9wLCAnd2Ytc2hvdyB3Zi1oaWRlJyk7CgkJCQkJCQlXaWRnZXRmbHkuVXRpbHMuYWRkQ2xhc3ModGhpcy5iYWNrZHJvcCwgJ3dmLWhpZGUnKTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlNb2RhbC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHsKCQkJCQkJLy9jb25zb2xlLmxvZygnV2lkZ2V0LkFjdGlvbiBjbG9zZScpOwoJCQkJCQl2YXIgciwgc2VsZiA9IHRoaXMsIGhhbmRsZXJzOwoJCQkJCQloYW5kbGVycyA9IFdpZGdldGZseS5NZWRpYXRvci5nZXRBY3Rpb25IYW5kbGVycyh0aGlzLmlkKTsKCQkJCQkJaWYgKGhhbmRsZXJzICYmIFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKGhhbmRsZXJzLm9uQmVmb3JlQ2xvc2UpKSB7CgkJCQkJCQlyID0gaGFuZGxlcnMub25CZWZvcmVDbG9zZSgpOwoJCQkJCQl9CgkJCQkJCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnJlc2l6ZUNhbGxiYWNrLCBmYWxzZSk7CgkJCQkJCWlmKHIgIT09IGZhbHNlKXsKCQkJCQkJCVdpZGdldGZseS5NZWRpYXRvci51bnJlZ2lzdGVyKHRoaXMuaWQsIGZ1bmN0aW9uKCkgewoJCQkJCQkJCXNlbGYuY29udGFpbmVyLnJlbW92ZUNoaWxkKHNlbGYuZWwpOwoJCQkJCQkJCWlmKFdpZGdldGZseS5VdGlscy5pc1RydWUoc2VsZi5vcHRpb25zLmJhY2tkcm9wKSl7CgkJCQkJCQkJCXNlbGYuY29udGFpbmVyLnJlbW92ZUNoaWxkKHNlbGYuYmFja2Ryb3ApOwoJCQkJCQkJCX0KCQkJCQkJCX0pOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCU1vZGFsLnByb3RvdHlwZS5zaXplQ2hhbmdlID0gZnVuY3Rpb24oc2l6ZSl7CgkJCQkJCWlmKHRoaXMuaXNTaG93KCkpewoJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmlubmVyU3R5bGUodGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcud2YtbW9kYWwtZGlhbG9nJykse3NpemU6ICdoZWlnaHQ6JyArICgodHlwZW9mIHNpemUuaGVpZ2h0ID09PSAnc3RyaW5nJykgPyBzaXplLmhlaWdodCA6IChTdHJpbmcoc2l6ZS5oZWlnaHQpICsgJ3B4JykpfSk7CgkJCQkJCQlXaWRnZXRmbHkuV2lkZ2V0LnByb3RvdHlwZS5zaXplQ2hhbmdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJcmV0dXJuIE1vZGFsOwoJCQkJCgkJCQl9KSh0aGlzKTsKCQkJCQoJCQkJV2lkZ2V0Zmx5LlBvcG92ZXIgPSAoZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnOwoJCQkJCS8vIFdpZGdldGZseS5Qb3BvdmVyCgkJCQkJLy8gLS0tLS0tLS0tLS0tLQoJCQkJCXZhciBQb3BvdmVyID0gZnVuY3Rpb24ob3B0aW9ucykgewoJCQkJCQl2YXIgc2VsZiA9IHRoaXM7CgkJCQkKCQkJCQkJV2lkZ2V0Zmx5LldpZGdldC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl0aGlzLm9wdGlvbnMgPSBXaWRnZXRmbHkuVXRpbHMuZXh0ZW5kKHt9LCBQb3BvdmVyLkRFRkFVTFRTLG9wdGlvbnMpOwoJCQkJCgkJCQkJCXRoaXMuc3R5bGVzID0ge307CgkJCQkJCWlmKG9wdGlvbnMuc3R5bGVzKXsKCQkJCQkJCXRoaXMuc3R5bGVzLmV4dHJhID0gb3B0aW9ucy5zdHlsZXM7CgkJCQkJCX0KCQkJCQoJCQkJCQl0aGlzLmNvbnRhaW5lciA9IHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7CgkJCQkKCQkJCQkJaWYgKG9wdGlvbnMgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLnRhcmdldCA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMudGFyZ2V0ID09PSBudWxsKSB7CgkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCX0KCQkJCQoJCQkJCQl0aGlzLnJlZ2lzdGVyKHRoaXMuaWQpOwoJCQkJCgkJCQkJCWlmKHR5cGVvZiBvcHRpb25zLnRhcmdldCA9PT0gJ3N0cmluZycpewoJCQkJCQkJdGhpcy50YXJnZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMudGFyZ2V0KTsKCQkJCQkJfWVsc2UgaWYodHlwZW9mIG9wdGlvbnMudGFyZ2V0ID09PSAnb2JqZWN0Jyl7CgkJCQkJCQl0aGlzLnRhcmdldCA9IG9wdGlvbnMudGFyZ2V0OwoJCQkJCQl9CgkJCQkKCQkJCQkJaWYgKHRoaXMudGFyZ2V0ICYmIHRoaXMudGFyZ2V0Lmxlbmd0aCA8PSAwKSB7CgkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCX0KCQkJCQoJCQkJCQl0aGlzLnJlbmRlcigpOwoJCQkJCgkJCQkJCWlmKHRoaXMub3B0aW9ucy5zaXplKXsKCQkJCQkJCXRoaXMuc3R5bGVzLnNpemUgPSAnaGVpZ2h0OicgKyB0aGlzLm9wdGlvbnMuc2l6ZS5oZWlnaHQgKyAnOyB3aWR0aDonICsgdGhpcy5vcHRpb25zLnNpemUud2lkdGg7CgkJCQkJCX0KCQkJCQoJCQkJCQl0aGlzLmlmcmFtZSA9IHRoaXMuZ2V0SWZyYW1lKCk7CgkJCQkKCQkJCQkJdGhpcy5zdHlsZSgpOwoJCQkJCgkJCQkJCWlmICh0aGlzLmNvbnRhaW5lcikgewoJCQkJCQkJdGhpcy5lbC5pbnNlcnRCZWZvcmUodGhpcy5zcGlubmVyLHRoaXMuaWZyYW1lKTsKCQkJCQkJCXRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZWwpOwoJCQkJCQl9CgkJCQkKCQkJCQkJdGhpcy5yZXNpemVDYWxsYmFjayA9IGZ1bmN0aW9uKGUpewoJCQkJCQkJaWYoc2VsZi5pc1Nob3coKSl7CgkJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLnRocm90dGxlKHNlbGYuc3R5bGUsIHNlbGYpOwoJCQkJCQkJfQoJCQkJCQl9OwoJCQkJCgkJCQkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnJlc2l6ZUNhbGxiYWNrLCBmYWxzZSk7CgkJCQkKCQkJCQkJcmV0dXJuIHRoaXM7CgkJCQkJfTsKCQkJCQoJCQkJCVBvcG92ZXIuREVGQVVMVFMgPSBXaWRnZXRmbHkuVXRpbHMuZXh0ZW5kKHt9LCBXaWRnZXRmbHkuV2lkZ2V0LkRFRkFVTFRTLHsKCQkJCQkJc2hvdyA6IGZhbHNlLAoJCQkJCQlwbGFjZW1lbnQgOiAncmlnaHQnLAoJCQkJCQl0ZW1wbGF0ZSA6ICc8ZGl2IGNsYXNzPSJ3aWRnZXRmbHkgd2YtcG9wb3ZlciB3Zi1oaWRlIHdmLWFuaW1hdGVkLWZhZGVJbiB3Zi1hbmltYXRlZC1wb3BvdmVyIj48ZGl2IGNsYXNzPSJ3Zi1hcnJvdyI+PC9kaXY+PGlmcmFtZSBhbGxvd3RyYW5zcGFyZW5jeT0idHJ1ZSIgZnJhbWVib3JkZXI9IjAiIHRhYmluZGV4PSIwIiB0aXRsZT0iV2lkZ2V0Zmx5IFdpZGdldCIgd2lkdGg9IjEwMCUiIGNsYXNzPSJ3Zi1wb3BvdmVyLWNvbnRlbnQiPjwvaWZyYW1lPjwvZGl2PicsCgkJCQkJCW9wdGlvbnMgOiB7CgkJCQkKCQkJCQkJfQoJCQkJCX0pOwoJCQkJCgkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmluaGVyaXQoUG9wb3ZlciwgV2lkZ2V0Zmx5LldpZGdldCk7CgkJCQkKCQkJCQlQb3BvdmVyLnByb3RvdHlwZS5zdHlsZSA9IGZ1bmN0aW9uKCkgewoJCQkJCgkJCQkJCXZhciB2dyx2aCx2ZXJ0LHZlcnRQbGFjZW1lbnQsaG9yaXosaG9yaXpQbGFjZW1lbnQsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWlnaHQsc2l6ZSA9IFdpZGdldGZseS5VdGlscy5hY3R1YWwodGhpcy5lbCk7CgkJCQkJCXRoaXMucGxhY2VtZW50ID0gdGhpcy5vcHRpb25zLnBsYWNlbWVudDsKCQkJCQoJCQkJCQlpZih0aGlzLm9wdGlvbnMucGxhY2VtZW50ID09PSAnYXV0bycgfHwgIUJvb2xlYW4odGhpcy5vcHRpb25zLnBsYWNlbWVudCkpewoJCQkJCQkJCXZ3ID0gTWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLCB3aW5kb3cuaW5uZXJXaWR0aCB8fCAwKTsKCQkJCQkJCQl2aCA9IE1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsIHdpbmRvdy5pbm5lckhlaWdodCB8fCAwKTsKCQkJCQkJCQl2ZXJ0ID0gMC41ICogdmggLSBzaXplLndpZHRoOwoJCQkJCQkgICAgdmVydFBsYWNlbWVudCA9IHZlcnQgPiAwID8gJ2JvdHRvbScgOiAndG9wJzsKCQkJCQkJICAgIGhvcml6ID0gMC41ICogdncgLSBzaXplLmhlaWdodDsKCQkJCQkJICAgIGhvcml6UGxhY2VtZW50ID0gaG9yaXogPiAwID8gJ3JpZ2h0JyA6ICdsZWZ0JzsKCQkJCQkJICAgIHRoaXMucGxhY2VtZW50ID0gTWF0aC5hYnMoaG9yaXopID4gTWF0aC5hYnModmVydCkgPyAgaG9yaXpQbGFjZW1lbnQgOiB2ZXJ0UGxhY2VtZW50OwoJCQkJCQl9CgkJCQkKCQkJCQkJaWYod2luZG93LmlubmVyV2lkdGggPD0gNjQwICYmIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQgPT09ICdsZWZ0Jyl7CgkJCQkJCQl0aGlzLnBsYWNlbWVudCA9ICd0b3AnOwoJCQkJCQl9ZWxzZSBpZih3aW5kb3cuaW5uZXJXaWR0aCA8PSA2NDAgJiYgdGhpcy5vcHRpb25zLnBsYWNlbWVudCA9PT0gJ3JpZ2h0Jyl7CgkJCQkJCQl0aGlzLnBsYWNlbWVudCA9ICdib3R0b20nOwoJCQkJCQl9CgkJCQkKCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLnJlbW92ZUNsYXNzKHRoaXMuZWwsICd3Zi10b3Agd2YtcmlnaHQgd2YtYm90dG9tIHdmLWxlZnQnKTsKCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmFkZENsYXNzKHRoaXMuZWwsICd3Zi0nICsgdGhpcy5wbGFjZW1lbnQpOwoJCQkJCgkJCQkJCVdpZGdldGZseS5XaWRnZXQucHJvdG90eXBlLnN0eWxlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkKCQkJCQkJdGhpcy5hcHBseVBsYWNlbWVudCgpOwoJCQkJCX07CgkJCQkKCQkJCQlQb3BvdmVyLnByb3RvdHlwZS5hcHBseVBsYWNlbWVudCA9IGZ1bmN0aW9uICgpIHsKCQkJCQoJCQkJCQlXaWRnZXRmbHkuVXRpbHMuaW5uZXJTdHlsZSh0aGlzLmVsLHRoaXMuc3R5bGVzKTsKCQkJCQoJCQkJCQl2YXIgdG9wLGxlZnQscmlnaHQsIGFycm93T2Zmc2V0LCBvZmZzZXQgPSBXaWRnZXRmbHkuVXRpbHMub2Zmc2V0KHRoaXMudGFyZ2V0KSwKCQkJCQkJCXRnICA9IFdpZGdldGZseS5VdGlscy5hY3R1YWwodGhpcy50YXJnZXQpLAoJCQkJCQkJZWwgPSBXaWRnZXRmbHkuVXRpbHMuYWN0dWFsKHRoaXMuZWwpOwoJCQkJCgkJCQkJCWlmKHRoaXMucGxhY2VtZW50ID09PSAnbGVmdCcpewoJCQkJCQkJdG9wID0gb2Zmc2V0LnRvcCArIE1hdGgucm91bmQodGcuaGVpZ2h0IC8gMikgLSBNYXRoLnJvdW5kKGVsLmhlaWdodCAvIDIpOwoJCQkJCQkJbGVmdCA9IG9mZnNldC5sZWZ0IC0gZWwud2lkdGg7CgkJCQkJCX1lbHNlIGlmKHRoaXMucGxhY2VtZW50ID09PSAndG9wJyl7CgkJCQkJCQl0b3AgPSAgb2Zmc2V0LnRvcCAtIGVsLmhlaWdodDsKCQkJCQkJCWxlZnQgPSBvZmZzZXQubGVmdCArIE1hdGgucm91bmQodGcud2lkdGggLyAyKSAtIE1hdGgucm91bmQoZWwud2lkdGggLyAyKTsKCQkJCQoJCQkJCQkJaWYobGVmdCA8IDApewoJCQkJCQkJCWFycm93T2Zmc2V0ID0gTWF0aC5yb3VuZCh0Zy53aWR0aCAvIDIpICsgb2Zmc2V0LmxlZnQ7CgkJCQkJCQkJbGVmdCA9IDU7CgkJCQkJCQl9ZWxzZSBpZihsZWZ0ICsgZWwud2lkdGggPiB3aW5kb3cuaW5uZXJXaWR0aCl7CgkJCQkJCQkJbGVmdCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gZWwud2lkdGggLSA1OwoJCQkJCQkJCWFycm93T2Zmc2V0ID0gb2Zmc2V0LmxlZnQgLSBsZWZ0ICsgTWF0aC5yb3VuZCh0Zy53aWR0aCAvIDIpOwoJCQkJCQkJfQoJCQkJCgkJCQkJCX1lbHNlIGlmKHRoaXMucGxhY2VtZW50ID09PSAnYm90dG9tJyl7CgkJCQkJCQl0b3AgPSAgb2Zmc2V0LnRvcCArIHRnLmhlaWdodDsKCQkJCQkJCWxlZnQgPSBvZmZzZXQubGVmdCArIE1hdGgucm91bmQodGcud2lkdGggLyAyKSAtIE1hdGgucm91bmQoZWwud2lkdGggLyAyKTsKCQkJCQoJCQkJCQkJaWYobGVmdCA8IDApewoJCQkJCQkJCWFycm93T2Zmc2V0ID0gTWF0aC5yb3VuZCh0Zy53aWR0aCAvIDIpICsgb2Zmc2V0LmxlZnQ7CgkJCQkJCQkJbGVmdCA9IDU7CgkJCQkJCQl9ZWxzZSBpZihsZWZ0ICsgZWwud2lkdGggPiB3aW5kb3cuaW5uZXJXaWR0aCl7CgkJCQkJCQkJbGVmdCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gZWwud2lkdGggLSA1OwoJCQkJCQkJCWFycm93T2Zmc2V0ID0gb2Zmc2V0LmxlZnQgLSBsZWZ0ICsgTWF0aC5yb3VuZCh0Zy53aWR0aCAvIDIpOwoJCQkJCQkJfQoJCQkJCgkJCQkJCX1lbHNlewoJCQkJCQkJLy9kZWZhdWx0OiByaWdodAoJCQkJCQkJdG9wID0gb2Zmc2V0LnRvcCArIE1hdGgucm91bmQodGcuaGVpZ2h0IC8gMikgLSBNYXRoLnJvdW5kKGVsLmhlaWdodCAvIDIpOwoJCQkJCQkJbGVmdCA9IG9mZnNldC5sZWZ0ICsgdGcud2lkdGg7CgkJCQkJCX0KCQkJCQkJdGhpcy5zdHlsZXMub2Zmc2V0ID0gJ3RvcDogJyArICgodHlwZW9mIHRvcCA9PT0gJ3N0cmluZycpID8gdG9wIDogKFN0cmluZyh0b3ApICsgJ3B4JykpICsgJzsgbGVmdDonICsgKCh0eXBlb2YgbGVmdCA9PT0gJ3N0cmluZycpID8gbGVmdCA6IChTdHJpbmcobGVmdCkgKyAncHg7JykpOwoJCQkJCQlXaWRnZXRmbHkuVXRpbHMuaW5uZXJTdHlsZSh0aGlzLmVsLCB0aGlzLnN0eWxlcyk7CgkJCQkJCWlmKGFycm93T2Zmc2V0KXsKCQkJCQkJCVdpZGdldGZseS5VdGlscy5pbm5lclN0eWxlKHRoaXMuZWwucXVlcnlTZWxlY3RvcignLndmLWFycm93JyksIHsgb2Zmc2V0IDogJ2xlZnQ6JyArICgodHlwZW9mIGFycm93T2Zmc2V0ID09PSAnc3RyaW5nJykgPyBhcnJvd09mZnNldCA6IChTdHJpbmcoYXJyb3dPZmZzZXQpICsgJ3B4OycpKSB9KTsKCQkJCQkJfWVsc2V7CgkJCQkJCQlXaWRnZXRmbHkuVXRpbHMuaW5uZXJTdHlsZSh0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy53Zi1hcnJvdycpLCB7IG9mZnNldCA6ICcnIH0pOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCVBvcG92ZXIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpewoJCQkJCQl2YXIgc2VsZiA9IHRoaXM7CgkJCQkJCS8qCgkJCQkJCWlmKHRoaXMuaW50ZXJ2YWwpIHsKCQkJCQkJCWNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7CgkJCQkJCX0qLwoJCQkJCgkJCQkJCXRoaXMuc3R5bGUoKTsKCQkJCQoJCQkJCQkvKnRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpewoJCQkJCQkJc2VsZi5hcHBseVBsYWNlbWVudCgpOwoJCQkJCQl9LDUwMCk7Ki8KCQkJCQoJCQkJCQlXaWRnZXRmbHkuV2lkZ2V0LnByb3RvdHlwZS5zaG93LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJfTsKCQkJCQoJCQkJCS8qUG9wb3Zlci5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCl7CgkJCQkJCWlmKHRoaXMuaW50ZXJ2YWwpIHsKCQkJCQkJCWNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7CgkJCQkJCX0KCQkJCQkJV2lkZ2V0Zmx5LldpZGdldC5wcm90b3R5cGUuaGlkZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCX07CgkJCQkJKi8KCQkJCQoJCQkJCVBvcG92ZXIucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24oKXsKCQkJCQkJd2luZG93LndpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnJlc2l6ZUNhbGxiYWNrLCBmYWxzZSk7CgkJCQkKCQkJCQkJV2lkZ2V0Zmx5LldpZGdldC5wcm90b3R5cGUuY2xvc2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJCgkJCQkJcmV0dXJuIFBvcG92ZXI7CgkJCQkKCQkJCX0pKHRoaXMpOwoJCQkJCgkJCQkoZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnOwoJCQkJCgkJCQkJdmFyIGV4dGVuZCA9IGZ1bmN0aW9uKHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CgkJCQkJCXZhciBjaGlsZCxwYXJlbnQgPSB0aGlzLCBTdXJyb2dhdGU7CgkJCQkKCQkJCQkJLy8gVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciB0aGUgbmV3IHN1YmNsYXNzIGlzIGVpdGhlciBkZWZpbmVkIGJ5IHlvdQoJCQkJCQkvLyAodGhlICJjb25zdHJ1Y3RvciIgcHJvcGVydHkgaW4geW91ciBgZXh0ZW5kYCBkZWZpbml0aW9uKSwgb3IgZGVmYXVsdGVkCgkJCQkJCS8vIGJ5IHVzIHRvIHNpbXBseSBjYWxsIHRoZSBwYXJlbnQncyBjb25zdHJ1Y3Rvci4KCQkJCQkJaWYgKHByb3RvUHJvcHMgJiYgKFdpZGdldGZseS5VdGlscy5oYXMocHJvdG9Qcm9wcywgJ2NvbnN0cnVjdG9yJykpKSB7CgkJCQkJCQljaGlsZCA9IHByb3RvUHJvcHMuY29uc3RydWN0b3I7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQljaGlsZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJCXJldHVybiBwYXJlbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJCX07CgkJCQkJCX0KCQkJCQoJCQkJCQkvLyBBZGQgc3RhdGljIHByb3BlcnRpZXMgdG8gdGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uLCBpZiBzdXBwbGllZC4KCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmV4dGVuZChjaGlsZCwgcGFyZW50LCBzdGF0aWNQcm9wcyk7CgkJCQkKCQkJCQkJLy8gU2V0IHRoZSBwcm90b3R5cGUgY2hhaW4gdG8gaW5oZXJpdCBmcm9tIGBwYXJlbnRgLCB3aXRob3V0IGNhbGxpbmcKCQkJCQkJLy8gYHBhcmVudGAncyBjb25zdHJ1Y3RvciBmdW5jdGlvbi4KCQkJCQkJU3Vycm9nYXRlID0gZnVuY3Rpb24oKSB7CgkJCQkJCQl0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7CgkJCQkJCX07CgkJCQkJCVN1cnJvZ2F0ZS5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOwoJCQkJCQljaGlsZC5wcm90b3R5cGUgPSBuZXcgU3Vycm9nYXRlKCk7CgkJCQkKCQkJCQkJLy8gQWRkIHByb3RvdHlwZSBwcm9wZXJ0aWVzIChpbnN0YW5jZSBwcm9wZXJ0aWVzKSB0byB0aGUgc3ViY2xhc3MsCgkJCQkJCS8vIGlmIHN1cHBsaWVkLgoJCQkJCQlpZiAocHJvdG9Qcm9wcykgewoJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmV4dGVuZChjaGlsZC5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwoJCQkJCQl9CgkJCQkKCQkJCQkJLy8gU2V0IGEgY29udmVuaWVuY2UgcHJvcGVydHkgaW4gY2FzZSB0aGUgcGFyZW50J3MgcHJvdG90eXBlIGlzIG5lZWRlZAoJCQkJCQkvLyBsYXRlci4KCQkJCQkJY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsKCQkJCQoJCQkJCQlyZXR1cm4gY2hpbGQ7CgkJCQkJfSxub3dTY3JpcHRzLCBpbnN0YW5jZSwgcGFyYW1zLCBwYXJzZXI7CgkJCQkKCQkJCQlXaWRnZXRmbHkuUGFuZWwuZXh0ZW5kID0gV2lkZ2V0Zmx5Lk1vZGFsLmV4dGVuZCA9IFdpZGdldGZseS5Qb3BvdmVyLmV4dGVuZCA9IFdpZGdldGZseS5TZXJ2ZXIuZXh0ZW5kID0gZXh0ZW5kOwoJCQkJCgkJCQkJLy8gSW5pdGlhbGl6ZSBmb3IgRE9NIHByZXBhcmUKCQkJCQkvLyAtLS0tLS0tLS0tLS0tCgkJCQkJV2lkZ2V0Zmx5LmluaXQgPSBmdW5jdGlvbigpewoJCQkJCgkJCQkJCWlmICghV2lkZ2V0Zmx5LlV0aWxzLmluSWZyYW1lKCkpIHsKCQkJCQkJCS8vY29uc29sZS5sb2coJ05vdyBpcyBXaWRnZXRzIGluaXRpYWxpemUnKTsKCQkJCQkJCVdpZGdldGZseS5NZWRpYXRvci5pbml0KCk7CgkJCQkKCQkJCQkJCW5vd1NjcmlwdHMgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0OwoJCQkJCQkJaWYobm93U2NyaXB0cyl7CgkJCQkJCQkJcGFyc2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJCQkJCQkJCXBhcnNlci5ocmVmID0gbm93U2NyaXB0cy5nZXRBdHRyaWJ1dGUoJ3NyYycpOwoJCQkJCQkJCXBhcmFtcyAgPSBXaWRnZXRmbHkuVXRpbHMucGFyYW1zKHBhcnNlci5oYXNoKTsKCQkJCQoJCQkJCQkJCWlmICghV2lkZ2V0Zmx5LlV0aWxzLmlzRW1wdHkocGFyYW1zKSkgewoJCQkJCgkJCQkJCQkJCWlmKHBhcmFtcy50eXBlID09PSAnbW9kYWwnKXsKCQkJCQkJCQkJCWRlbGV0ZSBwYXJhbXMuY29udGFpbmVyOwoJCQkJCQkJCQkJbmV3IChXaWRnZXRmbHkuTW9kYWwuZXh0ZW5kKHt9KSkocGFyYW1zKTsKCQkJCQkJCQkJfWVsc2UgaWYocGFyYW1zLnR5cGUgPT09ICdwb3BvdmVyJyl7CgkJCQkJCQkJCQlpZighcGFyYW1zLnRhcmdldCl7CgkJCQkJCQkJCQkJcGFyYW1zLnRhcmdldCA9IG5vd1NjcmlwdHMucGFyZW50Tm9kZTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCW5ldyAoV2lkZ2V0Zmx5LlBvcG92ZXIuZXh0ZW5kKHt9KSkocGFyYW1zKTsKCQkJCQkJCQkJfWVsc2V7CgkJCQkJCQkJCQlpZighcGFyYW1zLmNvbnRhaW5lcil7CgkJCQkJCQkJCQkJcGFyYW1zLmNvbnRhaW5lciA9IG5vd1NjcmlwdHMucGFyZW50Tm9kZTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCW5ldyAoV2lkZ2V0Zmx5LlBhbmVsLmV4dGVuZCh7fSkpKHBhcmFtcyk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkKCQkJCQkJCVdpZGdldGZseS5TZXJ2ZXIuZ2V0ID0gZnVuY3Rpb24oKXsKCQkJCQkJCQl0aHJvdyAnV2lkZ2V0Zmx5LlNlcnZlciBpcyBub3Qgc3VwcG9ydGVkIG91dHNpZGUgaWZyYW1lLic7CgkJCQkJCQl9OwoJCQkJCgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvL2NvbnNvbGUubG9nKCdOb3cgaXMgU2VydmVyIGluaXRpYWxpemUnKTsKCQkJCQkJCS8vIHdpZGdldAoJCQkJCQkJV2lkZ2V0Zmx5LlNlcnZlci5fZGVmYXVsdCA9IG5ldyBXaWRnZXRmbHkuU2VydmVyKHt9KTsKCQkJCQkJCVdpZGdldGZseS5TZXJ2ZXIuZ2V0ID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJcmV0dXJuIFdpZGdldGZseS5TZXJ2ZXIuX2RlZmF1bHQ7CgkJCQkJCQl9OwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldGZseS5pbml0KCk7CgkJCQkKCQkJCX0pKHRoaXMpOwoJCQkJCgkJCX0KCQkKCQkJcmV0dXJuIFdpZGdldGZseTsKCQl9KSh3aW5kb3cpOwoJCQoJCXJldHVybiBXaWRnZXRmbHk7Cn0pKTsK",
                "body": "LyoKICogV2lkZ2V0Zmx5CiAqIEEgamF2YXNjcmlwdCBsaWJyYXJ5IGZvciBidWlsZGluZyBjcm9zcy1zaXRlIHdlYiB3aWRnZXRzLgogKiBAbGluayBodHRwczovL2dpdGh1Yi5jb20vcXBlL3dpZGdldGZseQogKiBAYXV0aG9yIGhzZmVuZwogKiBAdmVyc2lvbiAwLjEuMwogKiBAbGljZW5zZSBodHRwczovL2dpdGh1Yi5jb20vcXBlL3dpZGdldGZseS9ibG9iL21hc3Rlci9MSUNFTlNFCiAqIEBjb3B5cmlnaHQgaHNmZW5nCiAqLwooZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkgeyd1c2Ugc3RyaWN0JzsKCQlpZiAoIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewoJCQkvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuCgkJCWRlZmluZShbXSwgZnVuY3Rpb24oKSB7CgkJCQkvLyBBbHNvIGNyZWF0ZSBhIGdsb2JhbCBpbiBjYXNlIHNvbWUgc2NyaXB0cwoJCQkJLy8gdGhhdCBhcmUgbG9hZGVkIHN0aWxsIGFyZSBsb29raW5nIGZvcgoJCQkJLy8gYSBnbG9iYWwgZXZlbiB3aGVuIGFuIEFNRCBsb2FkZXIgaXMgaW4gdXNlLgoJCQkJcmV0dXJuIChyb290LldpZGdldGZseSA9IGZhY3Rvcnkocm9vdCkpOwoJCQl9KTsKCQl9IGVsc2UgewoJCQkvLyBCcm93c2VyIGdsb2JhbHMKCQkJcm9vdC5XaWRnZXRmbHkgPSBmYWN0b3J5KHJvb3QpOwoJCX0KCX0odGhpcywgZnVuY3Rpb24oZ2xvYmFsKSB7CgkJJ3VzZSBzdHJpY3QnOwoJCXZhciBXaWRnZXRmbHkgPSAoZnVuY3Rpb24oZ2xvYmFsKXsKCQkJJ3VzZSBzdHJpY3QnOwoJCQl2YXIgV2lkZ2V0Zmx5OwoJCQkKCQkJaWYoZ2xvYmFsLldpZGdldGZseSl7CgkJCQlXaWRnZXRmbHkgPSBnbG9iYWwuV2lkZ2V0Zmx5OwoJCQkJV2lkZ2V0Zmx5LmluaXQoKTsKCQkJfWVsc2V7CgkJCQlXaWRnZXRmbHkgPSB7fTsKCQkJCQoJCQkJKGZ1bmN0aW9uICgpIHsKCQkJCSAgICAvLyB3aWRnZXRmbHkuY3NzCgkJCQkgICAgdmFyIGNzc1RleHQgPSAiIiArCgkJCQkiLndpZGdldGZseSAud2Ytc2hvdywud2lkZ2V0Zmx5LndmLXNob3d7ZGlzcGxheTpibG9jayAhaW1wb3J0YW50fS53aWRnZXRmbHkgLndmLWhpZGUsLndpZGdldGZseS53Zi1oaWRle2Rpc3BsYXk6bm9uZSAhaW1wb3J0YW50fS53aWRnZXRmbHkgLndmLXJvb3QsLndpZGdldGZseS53Zi1yb290e3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MHB4O3RvcDotOTk5OXB4O3dpZHRoOjQ3cHg7aGVpZ2h0OjI5cHg7ei1pbmRleDo5OTk5OTk5OTl9LndpZGdldGZseSAud2Ytc3Bpbm5lciwud2lkZ2V0Zmx5LndmLXNwaW5uZXJ7bWFyZ2luOjE2cHggYXV0bzt3aWR0aDo1MHB4O2hlaWdodDozMHB4O3RleHQtYWxpZ246Y2VudGVyO2ZvbnQtc2l6ZToxMHB4fS53aWRnZXRmbHkgLndmLXNwaW5uZXI+ZGl2LC53aWRnZXRmbHkud2Ytc3Bpbm5lcj5kaXZ7YmFja2dyb3VuZC1jb2xvcjojNjY2O2hlaWdodDoxMDAlO3dpZHRoOjZweDtkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW46MCAzcHggMCAwOy13ZWJraXQtYW5pbWF0aW9uOndmLXN0cmV0Y2hkZWxheSAxLjJzIGluZmluaXRlIGVhc2UtaW4tb3V0O2FuaW1hdGlvbjp3Zi1zdHJldGNoZGVsYXkgMS4ycyBpbmZpbml0ZSBlYXNlLWluLW91dH0ud2lkZ2V0Zmx5IC53Zi1zcGlubmVyPi5yZWN0Miwud2lkZ2V0Zmx5LndmLXNwaW5uZXI+LnJlY3Qyey13ZWJraXQtYW5pbWF0aW9uLWRlbGF5Oi0xLjFzO2FuaW1hdGlvbi1kZWxheTotMS4xc30ud2lkZ2V0Zmx5IC53Zi1zcGlubmVyPi5yZWN0Mywud2lkZ2V0Zmx5LndmLXNwaW5uZXI+LnJlY3Qzey13ZWJraXQtYW5pbWF0aW9uLWRlbGF5Oi0xczthbmltYXRpb24tZGVsYXk6LTFzfS53aWRnZXRmbHkgLndmLXNwaW5uZXI+LnJlY3Q0LC53aWRnZXRmbHkud2Ytc3Bpbm5lcj4ucmVjdDR7LXdlYmtpdC1hbmltYXRpb24tZGVsYXk6LTAuOXM7YW5pbWF0aW9uLWRlbGF5Oi0wLjlzfS53aWRnZXRmbHkgLndmLXNwaW5uZXI+LnJlY3Q1LC53aWRnZXRmbHkud2Ytc3Bpbm5lcj4ucmVjdDV7LXdlYmtpdC1hbmltYXRpb24tZGVsYXk6LTAuOHM7YW5pbWF0aW9uLWRlbGF5Oi0wLjhzfUAtd2Via2l0LWtleWZyYW1lcyB3Zi1zdHJldGNoZGVsYXl7MCUsNDAlLDEwMCV7LXdlYmtpdC10cmFuc2Zvcm06c2NhbGVZKC40KX0yMCV7LXdlYmtpdC10cmFuc2Zvcm06c2NhbGVZKDEpfX1Aa2V5ZnJhbWVzIHdmLXN0cmV0Y2hkZWxheXswJSw0MCUsMTAwJXt0cmFuc2Zvcm06c2NhbGVZKC40KTstd2Via2l0LXRyYW5zZm9ybTpzY2FsZVkoLjQpfTIwJXt0cmFuc2Zvcm06c2NhbGVZKDEpOy13ZWJraXQtdHJhbnNmb3JtOnNjYWxlWSgxKX19LndpZGdldGZseSAud2YtcGFuZWwsLndpZGdldGZseS53Zi1wYW5lbHt3aWR0aDoxMDAlICFpbXBvcnRhbnQ7Ym9yZGVyOm5vbmUgIWltcG9ydGFudDtvdmVyZmxvdzpoaWRkZW4gIWltcG9ydGFudH0ud2lkZ2V0Zmx5IC53Zi1hbmltYXRlZC1tb2RhbCwud2lkZ2V0Zmx5LndmLWFuaW1hdGVkLW1vZGFsey13ZWJraXQtYW5pbWF0aW9uLWR1cmF0aW9uOjAuMnM7YW5pbWF0aW9uLWR1cmF0aW9uOjAuMnM7LXdlYmtpdC1hbmltYXRpb24tZmlsbC1tb2RlOmJvdGg7YW5pbWF0aW9uLWZpbGwtbW9kZTpib3RofUAtd2Via2l0LWtleWZyYW1lcyB3Zi1mYWRlSW5VcEJpZ3swJXtvcGFjaXR5OjA7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwgMjAwMHB4LCAwKTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwgMjAwMHB4LCAwKX0xMDAle29wYWNpdHk6MTstd2Via2l0LXRyYW5zZm9ybTpub25lO3RyYW5zZm9ybTpub25lfX1Aa2V5ZnJhbWVzIHdmLWZhZGVJblVwQmlnezAle29wYWNpdHk6MDstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLCAyMDAwcHgsIDApOy1tcy10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwgMjAwMHB4LCAwKTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwgMjAwMHB4LCAwKX0xMDAle29wYWNpdHk6MTstd2Via2l0LXRyYW5zZm9ybTpub25lOy1tcy10cmFuc2Zvcm06bm9uZTt0cmFuc2Zvcm06bm9uZX19LndpZGdldGZseSAud2YtYW5pbWF0ZWQtZmFkZUluVXBCaWd7LXdlYmtpdC1hbmltYXRpb24tbmFtZTp3Zi1mYWRlSW5VcEJpZzthbmltYXRpb24tbmFtZTp3Zi1mYWRlSW5VcEJpZ30ud2lkZ2V0Zmx5IC53Zi1tb2RhbCwud2lkZ2V0Zmx5LndmLW1vZGFse3Bvc2l0aW9uOmZpeGVkO2hlaWdodDoxMDAlO3RvcDowO3JpZ2h0OjA7Ym90dG9tOjA7bGVmdDowO3otaW5kZXg6MTA1MDtvdmVyZmxvdzpoaWRkZW47LXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6dG91Y2g7b3V0bGluZTowO29wYWNpdHk6MX0ud2lkZ2V0Zmx5IC53Zi1tb2RhbCAud2YtbW9kYWwtZGlhbG9nLC53aWRnZXRmbHkud2YtbW9kYWwgLndmLW1vZGFsLWRpYWxvZ3std2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLCAwLCAwKTstby10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwgMCwgMCk7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsIDAsIDApO3Bvc2l0aW9uOnJlbGF0aXZlO21hcmdpbjozMHB4IGF1dG87bWluLXdpZHRoOjI0MHB4fS53aWRnZXRmbHkgLndmLW1vZGFsIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnQsLndpZGdldGZseS53Zi1tb2RhbCAud2YtbW9kYWwtZGlhbG9nIC53Zi1tb2RhbC1jb250ZW50e3Bvc2l0aW9uOnJlbGF0aXZlO2JhY2tncm91bmQtY29sb3I6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICNjY2M7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDAsMCwwLDAuMjYpO2JvcmRlci1yYWRpdXM6M3B4Oy13ZWJraXQtYm94LXNoYWRvdzowIDJweCA1cHggcmdiYSgwLDAsMCwwLjI2KTtib3gtc2hhZG93OjAgMnB4IDVweCByZ2JhKDAsMCwwLDAuMjYpO2JhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDtvdXRsaW5lOjA7aGVpZ2h0OjEwMCU7b3ZlcmZsb3c6aGlkZGVufS53aWRnZXRmbHkgLndmLW1vZGFsIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnQgLndmLW1vZGFsLWJvZHksLndpZGdldGZseS53Zi1tb2RhbCAud2YtbW9kYWwtZGlhbG9nIC53Zi1tb2RhbC1jb250ZW50IC53Zi1tb2RhbC1ib2R5e3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDoxMDAlfS53aWRnZXRmbHkgLndmLW1vZGFsIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnQgLndmLWNsb3NlLC53aWRnZXRmbHkud2YtbW9kYWwgLndmLW1vZGFsLWRpYWxvZyAud2YtbW9kYWwtY29udGVudCAud2YtY2xvc2V7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MHB4O21hcmdpbi10b3A6LTJweDttYXJnaW4tcmlnaHQ6NHB4O3RleHQtZGVjb3JhdGlvbjpub25lO2ZvbnQtc2l6ZToyMXB4O2ZvbnQtd2VpZ2h0OjYwMDtsaW5lLWhlaWdodDoxZW07Y29sb3I6IzAwMDt0ZXh0LXNoYWRvdzowIDFweCAwICNmZmY7Y3Vyc29yOnBvaW50ZXI7ZmlsdGVyOmFscGhhKG9wYWNpdHk9NTApO29wYWNpdHk6LjU7Zm9udC1mYW1pbHk6XCJIZWx2ZXRpY2EgTmV1ZVwiLEhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmO3otaW5kZXg6MTA1MH0ud2lkZ2V0Zmx5IC53Zi1tb2RhbC53Zi1tb2RhbC1sZyAud2YtbW9kYWwtZGlhbG9nLC53aWRnZXRmbHkud2YtbW9kYWwud2YtbW9kYWwtbGcgLndmLW1vZGFsLWRpYWxvZ3ttYXgtd2lkdGg6ODAlO2hlaWdodDo4MCV9LndpZGdldGZseSAud2YtbW9kYWwud2YtbW9kYWwtbWQgLndmLW1vZGFsLWRpYWxvZywud2lkZ2V0Zmx5LndmLW1vZGFsLndmLW1vZGFsLW1kIC53Zi1tb2RhbC1kaWFsb2d7bWF4LXdpZHRoOjUwJTtoZWlnaHQ6NjAlfS53aWRnZXRmbHkgLndmLW1vZGFsLndmLW1vZGFsLXNtIC53Zi1tb2RhbC1kaWFsb2csLndpZGdldGZseS53Zi1tb2RhbC53Zi1tb2RhbC1zbSAud2YtbW9kYWwtZGlhbG9ne21heC13aWR0aDozMCU7aGVpZ2h0OjMwJX0ud2lkZ2V0Zmx5IC53Zi1tb2RhbC1iYWNrZHJvcCwud2lkZ2V0Zmx5LndmLW1vZGFsLWJhY2tkcm9we3Bvc2l0aW9uOmZpeGVkO3RvcDowO3JpZ2h0OjA7Ym90dG9tOjA7bGVmdDowO3otaW5kZXg6MTA0MDtiYWNrZ3JvdW5kLWNvbG9yOiMwMDA7ZmlsdGVyOmFscGhhKG9wYWNpdHk9NTApO29wYWNpdHk6LjV9QG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDo2NDBweCl7LndpZGdldGZseS53Zi1tb2RhbCAud2YtbW9kYWwtZGlhbG9nLC53aWRnZXRmbHkud2YtbW9kYWwtbGcgLndmLW1vZGFsLWRpYWxvZywud2lkZ2V0Zmx5LndmLW1vZGFsLW1kIC53Zi1tb2RhbC1kaWFsb2csLndpZGdldGZseS53Zi1tb2RhbC1zbSAud2YtbW9kYWwtZGlhbG9ne3dpZHRoOjEwMCU7bWluLXdpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7bWluLWhlaWdodDoxMDAlO3BhZGRpbmc6MDttYXJnaW46MH0ud2lkZ2V0Zmx5LndmLW1vZGFsIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnQsLndpZGdldGZseS53Zi1tb2RhbC1sZyAud2YtbW9kYWwtZGlhbG9nIC53Zi1tb2RhbC1jb250ZW50LC53aWRnZXRmbHkud2YtbW9kYWwtbWQgLndmLW1vZGFsLWRpYWxvZyAud2YtbW9kYWwtY29udGVudCwud2lkZ2V0Zmx5LndmLW1vZGFsLXNtIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnR7cG9zaXRpb246Zml4ZWQ7dG9wOjBweDt3aWR0aDoxMDAlO21pbi13aWR0aDoxMDAlO2hlaWdodDoxMDAlO21pbi1oZWlnaHQ6MTAwJTstd2Via2l0LWFuaW1hdGlvbi1uYW1lOm5vbmU7YW5pbWF0aW9uLW5hbWU6bm9uZTtib3JkZXI6MDtib3JkZXItcmFkaXVzOjB9LndpZGdldGZseS53Zi1tb2RhbCAud2YtbW9kYWwtZGlhbG9nIC53Zi1tb2RhbC1jb250ZW50IC53Zi1jbG9zZSwud2lkZ2V0Zmx5LndmLW1vZGFsLWxnIC53Zi1tb2RhbC1kaWFsb2cgLndmLW1vZGFsLWNvbnRlbnQgLndmLWNsb3NlLC53aWRnZXRmbHkud2YtbW9kYWwtbWQgLndmLW1vZGFsLWRpYWxvZyAud2YtbW9kYWwtY29udGVudCAud2YtY2xvc2UsLndpZGdldGZseS53Zi1tb2RhbC1zbSAud2YtbW9kYWwtZGlhbG9nIC53Zi1tb2RhbC1jb250ZW50IC53Zi1jbG9zZXtyaWdodDowcHg7bWFyZ2luLXRvcDoxMHB4O21hcmdpbi1yaWdodDoxMHB4O2ZvbnQtc2l6ZToyOHB4O2ZvbnQtd2VpZ2h0OjgwMDtib3JkZXItcmFkaXVzOjUwJTt3aWR0aDozNXB4O2hlaWdodDozNXB4O3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjIzcHg7Ym9yZGVyOjVweCBzb2xpZCAjMDAwO3RleHQtc2hhZG93Om5vbmV9fS53aWRnZXRmbHkgLndmLWFuaW1hdGVkLXBvcG92ZXIsLndpZGdldGZseS53Zi1hbmltYXRlZC1wb3BvdmVyey13ZWJraXQtYW5pbWF0aW9uLWR1cmF0aW9uOjAuNXM7YW5pbWF0aW9uLWR1cmF0aW9uOjAuNXM7LXdlYmtpdC1hbmltYXRpb24tZmlsbC1tb2RlOmJvdGg7YW5pbWF0aW9uLWZpbGwtbW9kZTpib3RofUAtd2Via2l0LWtleWZyYW1lcyB3Zi1mYWRlSW57MCV7b3BhY2l0eTowfTEwMCV7b3BhY2l0eToxfX1Aa2V5ZnJhbWVzIHdmLWZhZGVJbnswJXtvcGFjaXR5OjB9MTAwJXtvcGFjaXR5OjF9fS53aWRnZXRmbHkgLndmLWFuaW1hdGVkLWZhZGVJbiwud2lkZ2V0Zmx5LndmLWFuaW1hdGVkLWZhZGVJbnstd2Via2l0LWFuaW1hdGlvbi1uYW1lOndmLWZhZGVJbjthbmltYXRpb24tbmFtZTp3Zi1mYWRlSW59LndpZGdldGZseSAud2YtcG9wb3Zlciwud2lkZ2V0Zmx5LndmLXBvcG92ZXJ7dG9wOjA7bGVmdDowO3otaW5kZXg6MTAxMDtwYWRkaW5nOjFweDt0ZXh0LWFsaWduOmxlZnQ7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JhY2tncm91bmQtY2xpcDpwYWRkaW5nLWJveDtib3JkZXI6MXB4IHNvbGlkICNjY2M7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDAsMCwwLDAuMjYpO2JvcmRlci1yYWRpdXM6M3B4Oy13ZWJraXQtYm94LXNoYWRvdzowIDJweCA1cHggcmdiYSgwLDAsMCwwLjI2KTtib3gtc2hhZG93OjAgMnB4IDVweCByZ2JhKDAsMCwwLDAuMjYpO3doaXRlLXNwYWNlOm5vcm1hbDtwb3NpdGlvbjphYnNvbHV0ZTtkaXNwbGF5OmJsb2NrO2Zsb2F0OmxlZnQ7bWluLXdpZHRoOjI0MHB4O3dpZHRoOjI4MHB4fS53aWRnZXRmbHkgLndmLXBvcG92ZXIgLndmLWFycm93LC53aWRnZXRmbHkud2YtcG9wb3ZlciAud2YtYXJyb3d7Ym9yZGVyLXdpZHRoOjExcHh9LndpZGdldGZseSAud2YtcG9wb3ZlciAud2YtYXJyb3csLndpZGdldGZseS53Zi1wb3BvdmVyIC53Zi1hcnJvdywud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyIC53Zi1hcnJvdzphZnRlciwud2lkZ2V0Zmx5LndmLXBvcG92ZXIgLndmLWFycm93OmFmdGVye3Bvc2l0aW9uOmFic29sdXRlO2Rpc3BsYXk6YmxvY2s7d2lkdGg6MDtoZWlnaHQ6MDtib3JkZXItY29sb3I6dHJhbnNwYXJlbnQ7Ym9yZGVyLXN0eWxlOnNvbGlkO2NvbnRlbnQ6XCJcIjtib3JkZXItd2lkdGg6MTBweH0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLndmLXRvcCwud2lkZ2V0Zmx5LndmLXBvcG92ZXIud2YtdG9we21hcmdpbi1ib3R0b206MTBweH0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLndmLXRvcCAud2YtYXJyb3csLndpZGdldGZseS53Zi1wb3BvdmVyLndmLXRvcCAud2YtYXJyb3d7Ym90dG9tOi0xMXB4O2xlZnQ6NTAlO21hcmdpbi1sZWZ0Oi0xMXB4O2JvcmRlci10b3AtY29sb3I6Izk5OTtib3JkZXItdG9wLWNvbG9yOnJnYmEoMCwwLDAsMC4yNSk7Ym9yZGVyLWJvdHRvbS13aWR0aDowfS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtdG9wIC53Zi1hcnJvdzphZnRlciwud2lkZ2V0Zmx5LndmLXBvcG92ZXIud2YtdG9wIC53Zi1hcnJvdzphZnRlcntib3R0b206MXB4O21hcmdpbi1sZWZ0Oi0xMHB4O2NvbnRlbnQ6XCIgXCI7Ym9yZGVyLXRvcC1jb2xvcjojZmZmO2JvcmRlci1ib3R0b20td2lkdGg6MH0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLndmLWxlZnQsLndpZGdldGZseS53Zi1wb3BvdmVyLndmLWxlZnR7bWFyZ2luLXJpZ2h0OjEwcHh9LndpZGdldGZseSAud2YtcG9wb3Zlci53Zi1sZWZ0IC53Zi1hcnJvdywud2lkZ2V0Zmx5LndmLXBvcG92ZXIud2YtbGVmdCAud2YtYXJyb3d7dG9wOjUwJTtyaWdodDotMTFweDttYXJnaW4tdG9wOi0xMXB4O2JvcmRlci1yaWdodC13aWR0aDowO2JvcmRlci1sZWZ0LWNvbG9yOiM5OTk7Ym9yZGVyLWxlZnQtY29sb3I6cmdiYSgwLDAsMCwwLjI1KX0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLndmLWxlZnQgLndmLWFycm93OmFmdGVyLC53aWRnZXRmbHkud2YtcG9wb3Zlci53Zi1sZWZ0IC53Zi1hcnJvdzphZnRlcntyaWdodDoxcHg7Ym90dG9tOi0xMHB4O2NvbnRlbnQ6XCIgXCI7Ym9yZGVyLXJpZ2h0LXdpZHRoOjA7Ym9yZGVyLWxlZnQtY29sb3I6I2ZmZn0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLndmLWJvdHRvbSwud2lkZ2V0Zmx5LndmLXBvcG92ZXIud2YtYm90dG9te21hcmdpbi10b3A6MTBweH0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLndmLWJvdHRvbSAud2YtYXJyb3csLndpZGdldGZseS53Zi1wb3BvdmVyLndmLWJvdHRvbSAud2YtYXJyb3d7dG9wOi0xMXB4O2xlZnQ6NTAlO21hcmdpbi1sZWZ0Oi0xMXB4O2JvcmRlci10b3Atd2lkdGg6MDtib3JkZXItYm90dG9tLWNvbG9yOiM5OTk7Ym9yZGVyLWJvdHRvbS1jb2xvcjpyZ2JhKDAsMCwwLDAuMjUpfS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtYm90dG9tIC53Zi1hcnJvdzphZnRlciwud2lkZ2V0Zmx5LndmLXBvcG92ZXIud2YtYm90dG9tIC53Zi1hcnJvdzphZnRlcnt0b3A6MXB4O21hcmdpbi1sZWZ0Oi0xMHB4O2NvbnRlbnQ6XCIgXCI7Ym9yZGVyLXRvcC13aWR0aDowO2JvcmRlci1ib3R0b20tY29sb3I6I2ZmZn0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLndmLXJpZ2h0LC53aWRnZXRmbHkud2YtcG9wb3Zlci53Zi1yaWdodHttYXJnaW4tbGVmdDoxMHB4fS53aWRnZXRmbHkgLndmLXBvcG92ZXIud2YtcmlnaHQgLndmLWFycm93LC53aWRnZXRmbHkud2YtcG9wb3Zlci53Zi1yaWdodCAud2YtYXJyb3d7dG9wOjUwJTtsZWZ0Oi0xMXB4O21hcmdpbi10b3A6LTExcHg7Ym9yZGVyLXJpZ2h0LWNvbG9yOiM5OTk7Ym9yZGVyLXJpZ2h0LWNvbG9yOnJnYmEoMCwwLDAsMC4yNSk7Ym9yZGVyLWxlZnQtd2lkdGg6MH0ud2lkZ2V0Zmx5IC53Zi1wb3BvdmVyLndmLXJpZ2h0IC53Zi1hcnJvdzphZnRlciwud2lkZ2V0Zmx5LndmLXBvcG92ZXIud2YtcmlnaHQgLndmLWFycm93OmFmdGVye2JvdHRvbTotMTBweDtsZWZ0OjFweDtjb250ZW50OlwiIFwiO2JvcmRlci1yaWdodC1jb2xvcjojZmZmO2JvcmRlci1sZWZ0LXdpZHRoOjB9IjsKCQkJCSAgICAvLyBjc3NUZXh0IGVuZAoJCQkJCgkJCQkgICAgdmFyIHN0eWxlRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOwoJCQkJICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0uYXBwZW5kQ2hpbGQoc3R5bGVFbCk7CgkJCQkgICAgaWYgKHN0eWxlRWwuc3R5bGVTaGVldCkgewoJCQkJICAgICAgICBpZiAoIXN0eWxlRWwuc3R5bGVTaGVldC5kaXNhYmxlZCkgewoJCQkJICAgICAgICAgICAgc3R5bGVFbC5zdHlsZVNoZWV0LmNzc1RleHQgPSBjc3NUZXh0OwoJCQkJICAgICAgICB9CgkJCQkgICAgfSBlbHNlIHsKCQkJCSAgICAgICAgdHJ5IHsKCQkJCSAgICAgICAgICAgIHN0eWxlRWwuaW5uZXJIVE1MID0gY3NzVGV4dAoJCQkJICAgICAgICB9IGNhdGNoKGUpIHsKCQkJCSAgICAgICAgICAgIHN0eWxlRWwuaW5uZXJUZXh0ID0gY3NzVGV4dDsKCQkJCSAgICAgICAgfQoJCQkJICAgIH0KCQkJCX0oKSk7CgkJCQkKCQkJCVdpZGdldGZseS5VdGlscyA9IChmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7CgkJCQkJLy8gVXRpbGl0aWVzCgkJCQkJLy8gLS0tLS0tLS0tLS0tLQoJCQkJCgkJCQkJdmFyIGlkQ291bnRlciA9IDAsIFV0aWxzID0gewoJCQkJCgkJCQkJCWhhcyA6IGZ1bmN0aW9uKG9iaiwga2V5KSB7CgkJCQkJCQlyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKCQkJCQkJfSwKCQkJCQoJCQkJCQkvKioKCQkJCQkJICoJVGhlIGNvcm5lcnN0b25lLCBhbiBgZWFjaGAgaW1wbGVtZW50YXRpb24sIGFrYSBgZm9yRWFjaGAuCgkJCQkJCSAqCUhhbmRsZXMgcmF3IG9iamVjdHMgaW4gYWRkaXRpb24gdG8gYXJyYXktbGlrZXMuIFRyZWF0cyBhbGwKCQkJCQkJICoJc3BhcnNlIGFycmF5LWxpa2VzIGFzIGlmIHRoZXkgd2VyZSBkZW5zZS4KCQkJCQkJICoJQm9ycm93aW5nIHRoaXMgY29kZSBmcm9tIHVuZGVyc2NvcmU6CgkJCQkJCSoJaHR0cHM6Ly9naXRodWIuY29tL2phc2hrZW5hcy91bmRlcnNjb3JlCgkJCQkJCSAqLwoJCQkJCQllYWNoIDogZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewoJCQkJCQkJdmFyIGksIGwsIGtleTsKCQkJCQoJCQkJCQkJaWYgKG9iaiA9PT0gbnVsbCkgewoJCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJCX0KCQkJCQoJCQkJCQkJaWYgKEFycmF5LnByb3RvdHlwZS5mb3JFYWNoICYmIG9iai5mb3JFYWNoID09PSBBcnJheS5wcm90b3R5cGUuZm9yRWFjaCkgewoJCQkJCQkJCW9iai5mb3JFYWNoKGl0ZXJhdG9yLCBjb250ZXh0KTsKCQkJCQkJCX0gZWxzZSBpZiAoIHR5cGVvZiBvYmoubGVuZ3RoID09PSAnbnVtYmVyJykgewoJCQkJCQkJCWZvciAoIGkgPSAwLCBsID0gb2JqLmxlbmd0aDsgaSA8IGw7IGkrKykgewoJCQkJCQkJCQlpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaikgPT09IHt9KSB7CgkJCQkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWZvciAoa2V5IGluIG9iaikgewoJCQkJCQkJCQlpZiAoV2lkZ2V0Zmx5LlV0aWxzLmhhcyhvYmosIGtleSkpIHsKCQkJCQkJCQkJCWlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtrZXldLCBrZXksIG9iaikgPT09IHt9KSB7CgkJCQkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9LAoJCQkJCgkJCQkJCS8qKgoJCQkJCQkgKglJcyBhIGdpdmVuIGFycmF5LCBzdHJpbmcsIG9yIG9iamVjdCBlbXB0eT8KCQkJCQkJICoJQW4gImVtcHR5IiBvYmplY3QgaGFzIG5vIGVudW1lcmFibGUgb3duLXByb3BlcnRpZXMuCgkJCQkJCSAqCUJvcnJvd2luZyB0aGlzIGNvZGUgZnJvbSB1bmRlcnNjb3JlOgoJCQkJCQkgKglodHRwczovL2dpdGh1Yi5jb20vamFzaGtlbmFzL3VuZGVyc2NvcmUKCQkJCQkJICovCgkJCQkJCWlzRW1wdHkgOiBmdW5jdGlvbihvYmopIHsKCQkJCQkJCS8vIG51bGwgYW5kIHVuZGVmaW5lZCBhcmUgImVtcHR5IgoJCQkJCQkJaWYgKG9iaiA9PT0gbnVsbCkgewoJCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQkJfQoJCQkJCgkJCQkJCQkvLyBBc3N1bWUgaWYgaXQgaGFzIGEgbGVuZ3RoIHByb3BlcnR5IHdpdGggYSBub24temVybyB2YWx1ZQoJCQkJCQkJLy8gdGhhdCB0aGF0IHByb3BlcnR5IGlzIGNvcnJlY3QuCgkJCQkJCQlpZiAob2JqLmxlbmd0aCA+IDApIHsKCQkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCQl9CgkJCQkKCQkJCQkJCWlmIChvYmoubGVuZ3RoID09PSAwKSB7CgkJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCQl9CgkJCQkKCQkJCQkJCS8vIE90aGVyd2lzZSwgZG9lcyBpdCBoYXZlIGFueSBwcm9wZXJ0aWVzIG9mIGl0cyBvd24/CgkJCQkJCQkvLyBOb3RlIHRoYXQgdGhpcyBkb2Vzbid0IGhhbmRsZQoJCQkJCQkJLy8gdG9TdHJpbmcgYW5kIHZhbHVlT2YgZW51bWVyYXRpb24gYnVncyBpbiBJRSA8IDkKCQkJCQkJCWZvciAodmFyIGtleSBpbiBvYmopIHsKCQkJCQkJCQlpZiAoaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKCQkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9LAoJCQkJCgkJCQkJCS8qCgkJCQkJCSAqCUV4dGVuZCBhIGdpdmVuIG9iamVjdCB3aXRoIGFsbCB0aGUgcHJvcGVydGllcyBpbiBwYXNzZWQtaW4gb2JqZWN0KHMpLgoJCQkJCQkgKglCb3Jyb3dpbmcgdGhpcyBjb2RlIGZyb20gdW5kZXJzY29yZToKCQkJCQkJICoJaHR0cHM6Ly9naXRodWIuY29tL2phc2hrZW5hcy91bmRlcnNjb3JlCgkJCQkJCSAqLwoJCQkJCQlleHRlbmQgOiBmdW5jdGlvbihvYmopIHsKCQkJCQkJCXRoaXMuZWFjaChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBmdW5jdGlvbihzb3VyY2UpIHsKCQkJCQkJCQlpZiAoc291cmNlKSB7CgkJCQkJCQkJCWZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CgkJCQkJCQkJCQlvYmpbcHJvcF0gPSBzb3VyY2VbcHJvcF07CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJCXJldHVybiBvYmo7CgkJCQkJCX0sCgkJCQkKCQkJCQkJaW5oZXJpdCA6IGZ1bmN0aW9uKENoaWxkLCBQYXJlbnQpIHsKCQkJCQkJCXZhciBGID0gZnVuY3Rpb24oKSB7CgkJCQkJCQl9OwoJCQkJCQkJRi5wcm90b3R5cGUgPSBQYXJlbnQucHJvdG90eXBlOwoJCQkJCQkJQ2hpbGQucHJvdG90eXBlID0gbmV3IEYoKTsKCQkJCQkJCUNoaWxkLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENoaWxkOwoJCQkJCQkJQ2hpbGQudWJlciA9IFBhcmVudC5wcm90b3R5cGU7CgkJCQkJCX0sCgkJCQkKCQkJCQkJLyoqCgkJCQkJCSAqIFBhcnNlIGFuZCBzdHJpbmdpZnkgVVJMIHF1ZXJ5IHN0cmluZ3MKCQkJCQkJICogb3Jyb3dpbmcgdGhpcyBjb2RlIGZyb20gOgoJCQkJCQkgKiBodHRwczovL2dpdGh1Yi5jb20vc2luZHJlc29yaHVzL3F1ZXJ5LXN0cmluZ2J5CgkJCQkJCSAqLwoJCQkJCQlwYXJhbXMgOiBmdW5jdGlvbiAoc3RyKSB7CgkJCQkJCQlpZiAodHlwZW9mIHN0ciAhPT0gJ3N0cmluZycpIHsKCQkJCQkJCQlyZXR1cm4ge307CgkJCQkJCQl9CgkJCQkKCQkJCQkJCXN0ciA9IHN0ci50cmltKCkucmVwbGFjZSgvXihcP3wjKS8sICcnKTsKCQkJCQoJCQkJCQkJaWYgKCFzdHIpIHsKCQkJCQkJCQlyZXR1cm4ge307CgkJCQkJCQl9CgkJCQkKCQkJCQkJCXJldHVybiBzdHIudHJpbSgpLnNwbGl0KCcmJykucmVkdWNlKGZ1bmN0aW9uIChyZXQsIHBhcmFtKSB7CgkJCQkJCQkJdmFyIHBhcnRzID0gcGFyYW0ucmVwbGFjZSgvXCsvZywgJyAnKS5zcGxpdCgnPScpLAoJCQkJCQkJCQlrZXkgPSBwYXJ0c1swXSwKCQkJCQkJCQkJdmFsID0gcGFydHNbMV07CgkJCQkKCQkJCQkJCQlrZXkgPSBkZWNvZGVVUklDb21wb25lbnQoa2V5KTsKCQkJCQkJCQkvLyBtaXNzaW5nIGA9YCBzaG91bGQgYmUgYG51bGxgOgoJCQkJCQkJCS8vIGh0dHA6Ly93My5vcmcvVFIvMjAxMi9XRC11cmwtMjAxMjA1MjQvI2NvbGxlY3QtdXJsLXBhcmFtZXRlcnMKCQkJCQkJCQl2YWwgPSB2YWwgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBkZWNvZGVVUklDb21wb25lbnQodmFsKTsKCQkJCQoJCQkJCQkJCWlmICghcmV0Lmhhc093blByb3BlcnR5KGtleSkpIHsKCQkJCQkJCQkJcmV0W2tleV0gPSB2YWw7CgkJCQkJCQkJfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHJldFtrZXldKSkgewoJCQkJCQkJCQlyZXRba2V5XS5wdXNoKHZhbCk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJcmV0W2tleV0gPSBbcmV0W2tleV0sIHZhbF07CgkJCQkJCQkJfQoJCQkJCgkJCQkJCQkJcmV0dXJuIHJldDsKCQkJCQkJCX0sIHt9KTsKCQkJCQkJfSwKCQkJCQoJCQkJCQkvKioKCQkJCQkJICogR2VuZXJhdGUgYSB1bmlxdWUgaW50ZWdlciBpZCAodW5pcXVlIHdpdGhpbiB0aGUgZW50aXJlIGNsaWVudCBzZXNzaW9uKS4KCQkJCQkJICogVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy4KCQkJCQkJICogQm9ycm93aW5nIHRoaXMgY29kZSBmcm9tIHVuZGVyc2NvcmU6CgkJCQkJCSAqIGh0dHBzOi8vZ2l0aHViLmNvbS9qYXNoa2VuYXMvdW5kZXJzY29yZQoJCQkJCQkgKi8KCQkJCQkJdW5pcXVlSWQgOiBmdW5jdGlvbihwcmVmaXgpIHsKCQkJCQkJCXZhciBpZCA9IFN0cmluZygrK2lkQ291bnRlcik7CgkJCQkJCQlyZXR1cm4gcHJlZml4ID8gcHJlZml4ICsgaWQgOiBpZDsKCQkJCQkJfSwKCQkJCQoJCQkJCQlpc1RydWUgOiBmdW5jdGlvbih2YWx1ZSl7CgkJCQkJCQlpZih2YWx1ZSA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gJ3RydWUnKXsKCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCX1lbHNlewoJCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJCX0KCQkJCQkJfSwKCQkJCQoJCQkJCQlpbklmcmFtZSA6IGZ1bmN0aW9uKCkgewoJCQkJCQkJdHJ5IHsKCQkJCQkJCQlyZXR1cm4gd2luZG93LnNlbGYgIT09IHdpbmRvdy50b3A7CgkJCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCQl9CgkJCQkJCX0sCgkJCQkKCQkJCQkJaXNGdW5jdGlvbiA6IGZ1bmN0aW9uKG9iaikgewoJCQkJCQkJcmV0dXJuIHR5cGVvZiBvYmogPT09ICdmdW5jdGlvbic7CgkJCQkJCX0sCgkJCQkKCQkJCQkJaXNFbGVtZW50IDogZnVuY3Rpb24obykgewoJCQkJCQkJcmV0dXJuICggdHlwZW9mIEhUTUxFbGVtZW50ID09PSAnb2JqZWN0JyA/IG8gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA6IG8gJiYgdHlwZW9mIG8gPT09ICdvYmplY3QnICYmIG8gIT09IG51bGwgJiYgby5ub2RlVHlwZSA9PT0gMSAmJiB0eXBlb2Ygby5ub2RlTmFtZSA9PT0gJ3N0cmluZycpOwoJCQkJCQl9LAoJCQkJCgkJCQkJCWhhc0NsYXNzIDogZnVuY3Rpb24oZWxlbWVudCwgY2xzKSB7CgkJCQkJCQlyZXR1cm4gKCcgJyArIGVsZW1lbnQuY2xhc3NOYW1lICsgJyAnKS5pbmRleE9mKCcgJyArIGNscyArICcgJykgPiAtMTsKCQkJCQkJfSwKCQkJCQoJCQkJCQlhZGRDbGFzcyA6IGZ1bmN0aW9uKGVsZW1lbnQsIGNsYXNzTmFtZSkgewoJCQkJCQkJdmFyIGEsIGFkID0gY2xhc3NOYW1lLnNwbGl0KCcgJyk7CgkJCQkJCQlmb3IoYSBpbiBhZCl7CgkJCQkJCQkJaWYgKCF0aGlzLmhhc0NsYXNzKGVsZW1lbnQsIGFkW2FdKSkgewoJCQkJCQkJCQllbGVtZW50LmNsYXNzTmFtZSArPSAnICcgKyBhZFthXTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQl0aGlzLmlubmVyU3R5bGUoZWxlbWVudCk7CgkJCQkJCX0sCgkJCQkKCQkJCQkJcmVtb3ZlQ2xhc3MgOiBmdW5jdGlvbihlbGVtZW50LCBybUNsYXNzKSB7CgkJCQkJCQl2YXIgbmV3Q2xhc3MsIHIsIHJtID0gcm1DbGFzcy5zcGxpdCgnICcpOwoJCQkJCQkJaWYgKGVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmlzRWxlbWVudChlbGVtZW50KSkgewoJCQkJCQkJCW5ld0NsYXNzID0gJyAnICsgZWxlbWVudC5jbGFzc05hbWUucmVwbGFjZSgvW1x0XHJcbl0vZywgJyAnKSArICcgJzsKCQkJCQkJCQlmb3IociBpbiBybSl7CgkJCQkJCQkJCWlmICh0aGlzLmhhc0NsYXNzKGVsZW1lbnQsIHJtW3JdKSkgewoJCQkJCQkJCQkJd2hpbGUgKG5ld0NsYXNzLmluZGV4T2YoJyAnICsgcm1bcl0gKyAnICcpID49IDApIHsKCQkJCQkJCQkJCQluZXdDbGFzcyA9IG5ld0NsYXNzLnJlcGxhY2UoJyAnICsgcm1bcl0gKyAnICcsICcgJyk7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQllbGVtZW50LmNsYXNzTmFtZSA9IG5ld0NsYXNzLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQl0aGlzLmlubmVyU3R5bGUoZWxlbWVudCk7CgkJCQkJCX0sCgkJCQkKCQkJCQkJdG9nZ2xlQ2xhc3MgOiBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHsKCQkJCQkJCXZhciBuZXdDbGFzczsKCQkJCQkJCWlmIChlbGVtZW50ICE9PSB1bmRlZmluZWQgJiYgdGhpcy5pc0VsZW1lbnQoZWxlbWVudCkpIHsKCQkJCQkJCQluZXdDbGFzcyA9ICcgJyArIGVsZW1lbnQuY2xhc3NOYW1lLnJlcGxhY2UoL1tcdFxyXG5dL2csICcgJykgKyAnICc7CgkJCQkJCQkJaWYgKHRoaXMuaGFzQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSkgewoJCQkJCQkJCQl3aGlsZSAobmV3Q2xhc3MuaW5kZXhPZignICcgKyBjbGFzc05hbWUgKyAnICcpID49IDApIHsKCQkJCQkJCQkJCW5ld0NsYXNzID0gbmV3Q2xhc3MucmVwbGFjZSgnICcgKyBjbGFzc05hbWUgKyAnICcsICcgJyk7CgkJCQkJCQkJCX0KCQkJCQkJCQkJZWxlbWVudC5jbGFzc05hbWUgPSBuZXdDbGFzcy5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCWVsZW1lbnQuY2xhc3NOYW1lICs9ICcgJyArIGNsYXNzTmFtZTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQl0aGlzLmlubmVyU3R5bGUoZWxlbWVudCk7CgkJCQkJCX0sCgkJCQkKCQkJCQkJaW5uZXJTdHlsZSA6IGZ1bmN0aW9uIGNzcyhhLCBvcHRpb25zKSB7CgkJCQkJCSAgICB2YXIgaSxyLHJhLG1yLGNzLG1hdGNoLCBydWxlRXhwLCByZXN1bHQsc3R5bGVzID0gW10scnVsZXMsbWVkaWFSdWxlcywgbWVkaWFUZXh0LCBzaGVldHMgPSBkb2N1bWVudC5zdHlsZVNoZWV0cywgbyA9IFtdLCBleHRTdHlsZXMgPSAnJzsKCQkJCQkJICAgIGEubWF0Y2hlcyA9IGEubWF0Y2hlcyB8fCBhLndlYmtpdE1hdGNoZXNTZWxlY3RvciB8fCBhLm1vek1hdGNoZXNTZWxlY3RvciB8fCBhLm1zTWF0Y2hlc1NlbGVjdG9yIHx8IGEub01hdGNoZXNTZWxlY3RvcjsKCQkJCQkJICAgIGZvciAoaSBpbiBzaGVldHMpIHsKCQkJCQkJCQkJCWlmKHNoZWV0c1tpXS5ocmVmKXsKCQkJCQkJCQkJCQljb250aW51ZTsKCQkJCQkJCQkJCX0KCQkJCQkJICAgICAgICBydWxlcyA9IHNoZWV0c1tpXS5ydWxlcyB8fCBzaGVldHNbaV0uY3NzUnVsZXM7CgkJCQkKCQkJCQkJICAgICAgICBmb3IgKHIgaW4gcnVsZXMpIHsKCQkJCQoJCQkJCQkJCQkJCWlmKHJ1bGVzW3JdLnR5cGUgPT09IDQgfHwgcnVsZXNbcl0ucGFyZW50UnVsZSl7CgkJCQkJCQkJCQkJCWlmKHJ1bGVzW3JdLm1lZGlhKXsKCQkJCQkJCQkJCQkJCW1lZGlhVGV4dCAgPSBydWxlc1tyXS5tZWRpYS5tZWRpYVRleHQ7CgkJCQkJCQkJCQkJCX1lbHNlewoJCQkJCQkJCQkJCQkJbWVkaWFUZXh0ID0gcnVsZXNbcl0ucGFyZW50UnVsZS5tZWRpYS5tZWRpYVRleHQ7CgkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQkJaWYod2luZG93Lm1hdGNoTWVkaWEobWVkaWFUZXh0KS5tYXRjaGVzKXsKCQkJCQkJCQkJCQkJCW1lZGlhUnVsZXMgPSBydWxlc1tyXS5ydWxlcyB8fCBydWxlc1tyXS5jc3NSdWxlcyB8fCBydWxlc1tyXS5wYXJlbnRSdWxlLnJ1bGVzIHx8IHJ1bGVzW3JdLnBhcmVudFJ1bGUuY3NzUnVsZXM7CgkJCQkJCQkJCQkJCQlmb3IgKG1yIGluIG1lZGlhUnVsZXMpIHsKCQkJCQkJCQkJCQkJCQkJaWYgKGEubWF0Y2hlcyhtZWRpYVJ1bGVzW21yXS5zZWxlY3RvclRleHQpKSB7CgkJCQkJCQkJCQkJCQkJCQkJY29uc29sZS5sb2cobWVkaWFSdWxlc1ttcl0uY3NzVGV4dCk7CgkJCQkJCQkJCQkJCQkJCQkJby5wdXNoKG1lZGlhUnVsZXNbbXJdLmNzc1RleHQpOwoJCQkJCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQl9ZWxzZXsKCQkJCQkJCQkJCQkJaWYgKGEubWF0Y2hlcyhydWxlc1tyXS5zZWxlY3RvclRleHQpKSB7CgkJCQkJCQkJCQkJCQkJby5wdXNoKHJ1bGVzW3JdLmNzc1RleHQpOwoJCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJfQoJCQkJCQkgICAgICAgIH0KCQkJCQkJICAgIH0KCQkJCQoJCQkJCQkgICAgZm9yIChpIGluIG8pewoJCQkJCQkJCQlyID0gb1tpXTsKCQkJCQkJCQkJcmEgPSByLnNwbGl0KCcgJyk7CgkJCQkJCQkJCWlmKHIgJiYgdHlwZW9mKHIpID09PSAnc3RyaW5nJyAmJiByYVswXS5pbmRleE9mKCcud2lkZ2V0Zmx5JykgPiAtMSl7CgkJCQkJCQkJCQlydWxlRXhwID0gL1x7XHMqKFteXH1dKylcc1x9L2c7CgkJCQkJCQkJCQltYXRjaCA9IHJ1bGVFeHAuZXhlYyhyKTsKCQkJCQkJCQkJCWlmKG1hdGNoKXsKCQkJCQkJCQkJCQljcyA9IHIuc3BsaXQoJyAnKVsxXTsKCQkJCQkJCQkJCQlpZihjcy5pbmRleE9mKCcud2YtJykgPT09IDAgJiYgY3MuaW5kZXhPZignLndmLWFuaW1hdGVkLScpICE9PSAwKXsKCQkJCQkJCQkJCQkJc3R5bGVzLnB1c2gobWF0Y2hbMV0pOwoJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCX0KCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJICAgIHJlc3VsdCA9IHN0eWxlcy5qb2luKCcgJyk7CgkJCQkJCSAgICBpZihvcHRpb25zKXsKCQkJCQkJCQkJZm9yKGkgaW4gb3B0aW9ucyl7CgkJCQkJCQkJCQlleHRTdHlsZXMgPSBleHRTdHlsZXMgKyBvcHRpb25zW2ldOwoJCQkJCQkJCQl9CgkJCQkJCQkJCWEuc2V0QXR0cmlidXRlKCdkYXRhLWV4dC1zdHlsZScsIGV4dFN0eWxlcyk7CgkJCQkJCQkJCXJlc3VsdCA9IHJlc3VsdCArICcgJyArIGV4dFN0eWxlczsKCQkJCQkJCQl9ZWxzZXsKCQkJCQkJCQkJaWYoYS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZXh0LXN0eWxlJykpewoJCQkJCQkJCQkJcmVzdWx0ID0gcmVzdWx0ICsgJyAnICsgYS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZXh0LXN0eWxlJyk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJYS5zdHlsZS5jc3NUZXh0ID0gcmVzdWx0OwoJCQkJCQl9LAoJCQkJCgkJCQkJCWFjdHVhbCA6IGZ1bmN0aW9uKGVsKXsKCQkJCQkJCXZhciBlbFdpZHRoLGVsSGVpZ2h0LHN0eWxlLAoJCQkJCQkJZml4U3R5bGUgPSAnIHZpc2liaWxpdHk6IGhpZGRlbiAhaW1wb3J0YW50OyBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OyBwb3NpdGlvbjogYWJzb2x1dGUgIWltcG9ydGFudDsnLAoJCQkJCgkJCQkJCQlzaXplID0gZnVuY3Rpb24ocyl7CgkJCQkJCQkJCWlmKEJvb2xlYW4ocykpewoJCQkJCQkJCQkJcmV0dXJuIHBhcnNlSW50KHMuc3Vic3RyaW5nKDAscy5pbmRleE9mKCdweCcpKSwxMCk7CgkJCQkJCQkJCX1lbHNlewoJCQkJCQkJCQkJcmV0dXJuIDA7CgkJCQkJCQkJCX0KCQkJCQkJCX07CgkJCQkKCQkJCQkJCXN0eWxlID0gZWwuZ2V0QXR0cmlidXRlKCdzdHlsZScpOwoJCQkJCgkJCQkJCQkvL2lmIChlbC5vZmZzZXRQYXJlbnQgPT09IG51bGwpIHsKCQkJCQkJCQllbC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgKHN0eWxlID8gc3R5bGUgOiAnJykgKyBmaXhTdHlsZSk7CgkJCQkJCQkvL30KCQkJCQoJCQkJCQkJZWxXaWR0aCA9IGVsLm9mZnNldFdpZHRoOwoJCQkJCgkJCQkJCQllbEhlaWdodCA9IGVsLm9mZnNldEhlaWdodDsKCQkJCQoJCQkJCQkJZWwuc2V0QXR0cmlidXRlKCdzdHlsZScsIChzdHlsZSA/IHN0eWxlIDogJycpKTsKCQkJCQoJCQkJCQkJcmV0dXJuIHsKCQkJCQkJCQl3aWR0aCA6IGVsV2lkdGggKyBzaXplKGVsLnN0eWxlLm1hcmdpbkxlZnQpICsgc2l6ZShlbC5zdHlsZS5tYXJnaW5SaWdodCksCgkJCQkJCQkJaGVpZ2h0IDogZWxIZWlnaHQgKyBzaXplKGVsLnN0eWxlLm1hcmdpblRvcCkgKyBzaXplKGVsLnN0eWxlLm1hcmdpbkJvdHRvbSkKCQkJCQkJCX07CgkJCQkJCX0sCgkJCQkKCQkJCQkJLyoqCgkJCQkJCSAqIEdldCB0aGUgY3VycmVudCBjb29yZGluYXRlcyBvZiB0aGUgZmlyc3QgZWxlbWVudCwgb3Igc2V0IHRoZSBjb29yZGluYXRlcyBvZiBldmVyeSBlbGVtZW50LCBpbiB0aGUgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMsIHJlbGF0aXZlIHRvIHRoZSBkb2N1bWVudC4KCQkJCQkJICogQm9ycm93aW5nIHRoaXMgY29kZSBmcm9tIGpxdWVyeToKCQkJCQkJICogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnkKCQkJCQkJICovCgkJCQkJCW9mZnNldDogZnVuY3Rpb24oZWwpIHsKCQkJCQkJCXZhciBkb2NFbGVtLCB3aW4sCgkJCQkJCQllbGVtID0gZWwsCgkJCQkJCQlib3ggPSB7IHRvcDogMCwgbGVmdDogMCB9LAoJCQkJCQkJZG9jID0gZWxlbSAmJiBlbGVtLm93bmVyRG9jdW1lbnQ7CgkJCQkKCQkJCQkJCWlmICggIWRvYyApIHsKCQkJCQkJCQlyZXR1cm47CgkJCQkJCQl9CgkJCQkKCQkJCQkJCWRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50OwoJCQkJCQkJLy8gSWYgd2UgZG9uJ3QgaGF2ZSBnQkNSLCBqdXN0IHVzZSAwLDAgcmF0aGVyIHRoYW4gZXJyb3IKCQkJCQkJCS8vIEJsYWNrQmVycnkgNSwgaU9TIDMgKG9yaWdpbmFsIGlQaG9uZSkKCQkJCQkJCWlmICggdHlwZW9mIGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0ICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJCQkJYm94ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQkJCQkJCX0KCQkJCQkJCXdpbiA9IHdpbmRvdzsKCQkJCQkJCXJldHVybiB7CgkJCQkJCQkJdG9wOiBib3gudG9wICsgd2luLnBhZ2VZT2Zmc2V0IC0gZG9jRWxlbS5jbGllbnRUb3AsCgkJCQkJCQkJbGVmdDogYm94LmxlZnQgKyB3aW4ucGFnZVhPZmZzZXQgLSBkb2NFbGVtLmNsaWVudExlZnQKCQkJCQkJCX07CgkJCQkJCX0sCgkJCQkKCQkJCQkJdG9FbGVtZW50IDogZnVuY3Rpb24oY29udGVudCl7CgkJCQkJCQl2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJCQkJCWVsLmlubmVySFRNTCA9IGNvbnRlbnQ7CgkJCQkJCQlyZXR1cm4gZWwuZmlyc3RDaGlsZDsKCQkJCQkJfSwKCQkJCQoJCQkJCQl0aHJvdHRsZSA6IGZ1bmN0aW9uKG1ldGhvZCwgc2NvcGUpIHsKCQkJCQkJCQljbGVhclRpbWVvdXQoc2NvcGUuX3RJZCk7CgkJCQkJCQkJc2NvcGUuX3RJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKCQkJCQkJCQkJCW1ldGhvZC5jYWxsKHNjb3BlKTsKCQkJCQkJCQl9LCAxMDApOwoJCQkJCQl9CgkJCQkKCQkJCQl9OwoJCQkJCgkJCQkJcmV0dXJuIFV0aWxzOwoJCQkJfSkodGhpcyk7CgkJCQkKCQkJCVdpZGdldGZseS5FdmVudHMgPSAoZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnOwoJCQkJCS8vIEV2ZW50cwoJCQkJCS8vIC0tLS0tLS0tLS0tLS0KCQkJCQl2YXIgRXZlbnRzID0gZnVuY3Rpb24oKSB7CgkJCQkJfTsKCQkJCQoJCQkJCUV2ZW50cy5wcm90b3R5cGUudHJpZ2dlciA9IGZ1bmN0aW9uKGFjdGlvbiwgZGF0YSkgewoJCQkJCQlXaWRnZXRmbHkuTWVkaWF0b3Iuc2VuZCh0aGlzLmlkLCBhY3Rpb24sIGRhdGEpOwoJCQkJCX07CgkJCQkKCQkJCQlFdmVudHMucHJvdG90eXBlLm9uID0gZnVuY3Rpb24oYWN0aW9uLCBjYWxsYmFjaykgewoJCQkJCQlXaWRnZXRmbHkuTWVkaWF0b3IuYmluZCh0aGlzLmlkLCBhY3Rpb24sIGNhbGxiYWNrKTsKCQkJCQl9OwoJCQkJCgkJCQkJRXZlbnRzLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbihhY3Rpb24pIHsKCQkJCQkJV2lkZ2V0Zmx5Lk1lZGlhdG9yLnVuYmluZCh0aGlzLmlkLCBhY3Rpb24pOwoJCQkJCX07CgkJCQkKCQkJCQlyZXR1cm4gRXZlbnRzOwoJCQkJfSkodGhpcyk7CgkJCQkKCQkJCVdpZGdldGZseS5NZWRpYXRvciA9IChmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7CgkJCQkJLy8gTWVkaWF0b3IKCQkJCQkvLyAtLS0tLS0tLS0tLS0tCgkJCQkJdmFyIE1lZGlhdG9yID0gewoJCQkJCgkJCQkJCXdpZGdldHMgOiB7fSwKCQkJCQoJCQkJCQlhY3Rpb25IYW5kbGVycyA6IHt9LAoJCQkJCgkJCQkJCWluaXQgOiBmdW5jdGlvbigpIHsKCQkJCQkJCXZhciBzZWxmID0gdGhpczsKCQkJCQkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24obXNnT2JqKSB7CgkJCQkJCQkJc2VsZi5yZWNlaXZlKG1zZ09iaik7CgkJCQkJCQl9LCBmYWxzZSk7CgkJCQkJCX0sCgkJCQkKCQkJCQkJZ2V0V2lkZ2V0IDogZnVuY3Rpb24oaWQpIHsKCQkJCQkJCXJldHVybiB0aGlzLndpZGdldHNbaWRdOwoJCQkJCQl9LAoJCQkJCgkJCQkJCWdldEFjdGlvbkhhbmRsZXJzIDogZnVuY3Rpb24oaWQpIHsKCQkJCQkJCXJldHVybiB0aGlzLmFjdGlvbkhhbmRsZXJzW2lkXTsKCQkJCQkJfSwKCQkJCQoJCQkJCQlyZWdpc3RlciA6IGZ1bmN0aW9uKGlkLCB3aWRnZXQpIHsKCQkJCQkJCXRoaXMud2lkZ2V0c1t3aWRnZXQuaWRdID0gd2lkZ2V0OwoJCQkJCQkJd2lkZ2V0Lm1lZGlhdG9yID0gdGhpczsKCQkJCQkJCXRoaXMuYWN0aW9uSGFuZGxlcnNbd2lkZ2V0LmlkXSA9IHt9OwoJCQkJCQl9LAoJCQkJCgkJCQkJCXVucmVnaXN0ZXIgOiBmdW5jdGlvbihpZCwgY2FsbGJhY2spIHsKCQkJCQkJCWlmICh0aGlzLmFjdGlvbkhhbmRsZXJzW2lkXSAhPT0gdW5kZWZpbmVkKSB7CgkJCQkJCQkJdmFyIHNlbGYgPSB0aGlzOwoJCQkJCQkJCVdpZGdldGZseS5VdGlscy5lYWNoKHRoaXMuYWN0aW9uSGFuZGxlcnNbaWRdLCBmdW5jdGlvbihrZXkpIHsKCQkJCQkJCQkJZGVsZXRlIHNlbGYuYWN0aW9uSGFuZGxlcnNbaWRdW2tleV07CgkJCQkJCQkJfSk7CgkJCQkJCQl9CgkJCQkJCQlkZWxldGUgdGhpcy53aWRnZXRzW2lkXTsKCQkJCQkJCWlmKGNhbGxiYWNrKSB7CgkJCQkJCQkJY2FsbGJhY2sodHJ1ZSk7CgkJCQkJCQl9CgkJCQkJCX0sCgkJCQkKCQkJCQkJc2VuZCA6IGZ1bmN0aW9uKGlkLCBhY3Rpb24sIGRhdGEpIHsKCQkJCQkJCS8vY29uc29sZS5sb2coJ01lZGlhdG9yLnNlbmQnKTsKCQkJCQoJCQkJCQkJdmFyIHBhcnNlciwgdGFyZ2V0T3JpZ2luLCBjb3JzT2JqID0gewoJCQkJCQkJCW1zZyA6IGRhdGEsCgkJCQkJCQkJYWN0aW9uIDogYWN0aW9uLAoJCQkJCQkJCWlkIDogaWQKCQkJCQkJCX0sIHdpZGdldCA9IHRoaXMud2lkZ2V0c1tpZF07CgkJCQkKCQkJCQkJCWlmICh3aWRnZXQpIHsKCQkJCQkJCQlwYXJzZXIgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJCQkJCQkJCXBhcnNlci5ocmVmID0gd2lkZ2V0LmlmcmFtZS5zcmM7CgkJCQkJCQkJdGFyZ2V0T3JpZ2luID0gcGFyc2VyLnByb3RvY29sICsgJy8vJyArIHBhcnNlci5ob3N0bmFtZSArIChwYXJzZXIucG9ydCAmJiAgcGFyc2VJbnQocGFyc2VyLnBvcnQsMTApICE9PSA4MCA/ICgnOicgKyBwYXJzZXIucG9ydCkgOiAnJyk7CgkJCQkJCQkJd2lkZ2V0LmlmcmFtZS5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKGNvcnNPYmosIHRhcmdldE9yaWdpbik7CgkJCQkJCQl9CgkJCQkJCX0sCgkJCQkKCQkJCQkJYmluZCA6IGZ1bmN0aW9uKGlkLCBhY3Rpb24sIGNhbGxiYWNrKSB7CgkJCQkJCQkvL2NvbnNvbGUubG9nKCdNZWRpYXRvci5iaW5kOiAnICsgYWN0aW9uKTsKCQkJCQkJCWlmICh0aGlzLmFjdGlvbkhhbmRsZXJzW2lkXSA9PT0gdW5kZWZpbmVkKSB7CgkJCQkJCQkJdGhpcy5hY3Rpb25IYW5kbGVyc1tpZF0gPSB7fTsKCQkJCQkJCX0KCQkJCQkJCXRoaXMuYWN0aW9uSGFuZGxlcnNbaWRdW2FjdGlvbl0gPSBjYWxsYmFjazsKCQkJCQkJfSwKCQkJCQoJCQkJCQl1bmJpbmQgOiBmdW5jdGlvbihpZCwgYWN0aW9uKSB7CgkJCQkJCQkvL2NvbnNvbGUubG9nKCdNZWRpYXRvci51bmJpbmQnKTsKCQkJCQkJCWRlbGV0ZSB0aGlzLmFjdGlvbkhhbmRsZXJzW2lkXVthY3Rpb25dOwoJCQkJCQkJaWYgKE9iamVjdC5rZXlzKHRoaXMuYWN0aW9uSGFuZGxlcnNbaWRdKS5sZW5ndGggPD0gMCkgewoJCQkJCQkJCWRlbGV0ZSB0aGlzLmFjdGlvbkhhbmRsZXJzW2lkXTsKCQkJCQkJCX0KCQkJCQkJfSwKCQkJCQoJCQkJCQlyZWNlaXZlIDogZnVuY3Rpb24obXNnT2JqKSB7CgkJCQkJCQkvL2NvbnNvbGUubG9nKCdNZWRpYXRvci5yZWNlaXZlJyk7CgkJCQkKCQkJCQkJCXZhciBvcmlnaW4sIHBhcnNlciwgd2lkZ2V0SWQgPSBtc2dPYmouZGF0YS5pZCwgd2lkZ2V0ID0gdGhpcy53aWRnZXRzW3dpZGdldElkXSwgbXlBY3Rpb25IYW5kbGVycyA9IHRoaXMuYWN0aW9uSGFuZGxlcnNbd2lkZ2V0SWRdLCBhY3Rpb24gPSBtc2dPYmouZGF0YS5hY3Rpb247CgkJCQkKCQkJCQkJCWlmICh3aWRnZXQpIHsKCQkJCQkJCQlwYXJzZXIgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJCQkJCQkJCXBhcnNlci5ocmVmID0gd2lkZ2V0LmlmcmFtZS5zcmM7CgkJCQkJCQkJb3JpZ2luID0gcGFyc2VyLnByb3RvY29sICsgJy8vJyArIHBhcnNlci5ob3N0bmFtZSArIChwYXJzZXIucG9ydCAmJiAgcGFyc2VJbnQocGFyc2VyLnBvcnQsMTApICE9PSA4MCA/ICgnOicgKyBwYXJzZXIucG9ydCkgOiAnJyk7CgkJCQkKCQkJCQkJCQlpZiAob3JpZ2luICE9PSBtc2dPYmoub3JpZ2luKSB7CgkJCQkJCQkJCS8vY29uc29sZS5sb2coJ1dpZGdldCBpZ25vcmUgbWVzc2FnZSBmcm9tICcgKyBtc2dPYmoub3JpZ2luKTsKCQkJCQkJCQkJcmV0dXJuOwoJCQkJCQkJCX0KCQkJCQoJCQkJCQkJCWlmICh3aWRnZXQgJiYgV2lkZ2V0Zmx5LlV0aWxzLmlzRnVuY3Rpb24od2lkZ2V0W2FjdGlvbl0pKSB7CgkJCQkJCQkJCXdpZGdldFthY3Rpb25dKG1zZ09iai5kYXRhLm1zZyk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJaWYgKCFXaWRnZXRmbHkuVXRpbHMuaXNFbXB0eShteUFjdGlvbkhhbmRsZXJzKSAmJiBXaWRnZXRmbHkuVXRpbHMuaXNGdW5jdGlvbihteUFjdGlvbkhhbmRsZXJzW2FjdGlvbl0pKSB7CgkJCQkJCQkJCQkvL215QWN0aW9uSGFuZGxlcnNbYWN0aW9uXShtc2dPYmouZGF0YS5tc2cpOwoJCQkJCQkJCQkJbXlBY3Rpb25IYW5kbGVyc1thY3Rpb25dLmFwcGx5KHdpZGdldCxbbXNnT2JqLmRhdGEubXNnXSk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJcmV0dXJuIE1lZGlhdG9yOwoJCQkJfSkodGhpcyk7CgkJCQkKCQkJCVdpZGdldGZseS5TZXJ2ZXIgPSAoZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnOwoJCQkJCS8vIFNlcnZlcgoJCQkJCS8vIC0tLS0tLS0tLS0tLS0KCQkJCQl2YXIgU2VydmVyID0gZnVuY3Rpb24oKSB7CgkJCQkJCXRoaXMuaWQgPSB3aW5kb3cubmFtZTsKCQkJCQkJdGhpcy5ldmVudHMgPSB7fTsKCQkJCQkJdGhpcy5pbml0KCk7CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldGZseS5VdGlscy5pbmhlcml0KFNlcnZlciwgV2lkZ2V0Zmx5LkV2ZW50cyk7CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIHNlbGYgPSB0aGlzLCBwYXJhbURhdGEgPSBkZWNvZGVVUklDb21wb25lbnQod2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyaW5nKDEpKTsKCQkJCQkJdGhpcy5vcHRpb25zID0gSlNPTi5wYXJzZShwYXJhbURhdGEpOwoJCQkJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKG1zZ09iaikgewoJCQkJCQkJaWYod2luZG93LnBhcmVudCl7CgkJCQkJCQkJdmFyIGFjdGlvbiwgb3JpZ2luLCBwYXJzZXI7CgkJCQkKCQkJCQkJCQlwYXJzZXIgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJCQkJCQkJCXBhcnNlci5ocmVmID0gc2VsZi5vcHRpb25zLm9yaWdpbjsKCQkJCQkJCQlvcmlnaW4gPSBwYXJzZXIucHJvdG9jb2wgKyAnLy8nICsgcGFyc2VyLmhvc3RuYW1lICsgKHBhcnNlci5wb3J0ICYmICBwYXJzZUludChwYXJzZXIucG9ydCwxMCkgIT09IDgwID8gKCc6JyArIHBhcnNlci5wb3J0KSA6ICcnKTsKCQkJCQoJCQkJCQkJCWlmKG9yaWdpbiAhPT0gJ2ZpbGU6Ly8nICYmIG9yaWdpbiAhPT0gbXNnT2JqLm9yaWdpbil7CgkJCQkJCQkJCS8vY29uc29sZS5sb2coJ1NlcnZlciBpZ25vcmUgbWVzc2FnZSBmcm9tICcgKyBtc2dPYmoub3JpZ2luKTsKCQkJCQkJCQkJcmV0dXJuOwoJCQkJCQkJCX0KCQkJCQoJCQkJCQkJCWFjdGlvbiA9IG1zZ09iai5kYXRhLmFjdGlvbjsKCQkJCQkJCQlpZiAoV2lkZ2V0Zmx5LlV0aWxzLmlzRnVuY3Rpb24oc2VsZlthY3Rpb25dKSkgewoJCQkJCQkJCQlzZWxmW2FjdGlvbl0obXNnT2JqLmRhdGEubXNnKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlpZiAoIVdpZGdldGZseS5VdGlscy5pc0VtcHR5KHNlbGYuZXZlbnRzKSAmJiBXaWRnZXRmbHkuVXRpbHMuaXNGdW5jdGlvbihzZWxmLmV2ZW50c1thY3Rpb25dKSkgewoJCQkJCQkJCQkJc2VsZi5ldmVudHNbYWN0aW9uXShtc2dPYmouZGF0YS5tc2cpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9LCBmYWxzZSk7CgkJCQkKCQkJCQkJaWYodGhpcy5vcHRpb25zLmF1dG9TdGFydCl7CgkJCQkJCQl0aGlzLnRyaWdnZXIoJ3N0YXJ0Jyk7CgkJCQkJCX0KCQkJCQoJCQkJCQlpZih0aGlzLm9wdGlvbnMuYXV0b0dyb3cpewoJCQkJCQkJdGhpcy5pc1Nob3coZnVuY3Rpb24odmFsdWUpewoJCQkJCQkJCWlmKHZhbHVlKXsKCQkJCQkJCQkJc2VsZi5leHBhbmQoKTsKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24oa2V5LCBjYWxsYmFjaykgewoJCQkJCQl0aGlzLmV2ZW50c1trZXldID0gY2FsbGJhY2s7CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24oa2V5KSB7CgkJCQkJCWRlbGV0ZSB0aGlzLmV2ZW50c1trZXldOwoJCQkJCX07CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLnRyaWdnZXIgPSBmdW5jdGlvbihhY3Rpb24sIGRhdGEpIHsKCQkJCQkJLy9jb25zb2xlLmxvZygnU2VydmVyLnRyaWdnZXInKTsKCQkJCQkJdmFyIGNvcnNPYmogPSB7CgkJCQkJCQltc2cgOiBkYXRhLAoJCQkJCQkJYWN0aW9uIDogYWN0aW9uLAoJCQkJCQkJaWQgOiB0aGlzLmlkCgkJCQkJCX07CgkJCQkKCQkJCQkJLy9jb25zb2xlLmxvZyhjb3JzT2JqKTsKCQkJCQkJcGFyZW50LnBvc3RNZXNzYWdlKGNvcnNPYmosIHRoaXMub3B0aW9ucy5vcmlnaW4pOwoJCQkJCX07CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLmlzU2hvdyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJCQkJCXZhciBzZWxmID0gdGhpcywgd3JhcHBlciA9IGZ1bmN0aW9uKGRhdGEpewoJCQkJCQkJc2VsZi5vZmYoJ19pc1Nob3cnLCB3cmFwcGVyKTsKCQkJCQkJCWNhbGxiYWNrKGRhdGEpOwoJCQkJCQl9OwoJCQkJCQl0aGlzLm9uKCdfaXNTaG93Jywgd3JhcHBlcik7CgkJCQkJCXRoaXMudHJpZ2dlcignaXNTaG93Jyk7CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUub25TaG93ID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKCQkJCQkJdGhpcy5vbignX29uU2hvdycsIGNhbGxiYWNrKTsKCQkJCQl9OwoJCQkJCgkJCQkJU2VydmVyLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKSB7CgkJCQkJCXRoaXMudHJpZ2dlcignc2hvdycpOwoJCQkJCX07CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLmFjayA9IGZ1bmN0aW9uKCkgewoJCQkJCQl0aGlzLnRyaWdnZXIoJ2FjaycpOwoJCQkJCX07CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oKXsKCQkJCQkJdmFyIHNlbGYgPSB0aGlzOwoJCQkJCQl0aGlzLnRyaWdnZXIoJ3N0YXJ0Jyk7CgkJCQkJCWlmKHRoaXMub3B0aW9ucy5hdXRvR3Jvdyl7CgkJCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CgkJCQkJCQkJc2VsZi5leHBhbmQoKTsKCQkJCQkJCX0sMTAwKTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlTZXJ2ZXIucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbigpIHsKCQkJCQkJdGhpcy50cmlnZ2VyKCdoaWRlJyk7CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24oKSB7CgkJCQkJCXRoaXMudHJpZ2dlcigndG9nZ2xlJyk7CgkJCQkJfTsKCQkJCQoJCQkJCVNlcnZlci5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHsKCQkJCQkJLy9jb25zb2xlLmxvZygnUHJlcGFyZSBzZXJ2ZXIgY2xvc2UgYWN0aW9uJyk7CgkJCQkJCXZhciBzZWxmID0gdGhpczsKCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmVhY2godGhpcy5ldmVudHMsIGZ1bmN0aW9uKGtleSkgewoJCQkJCQkJZGVsZXRlIHNlbGYuZXZlbnRzW2tleV07CgkJCQkJCX0pOwoJCQkJCQl0aGlzLnRyaWdnZXIoJ2Nsb3NlJyk7CgkJCQkKCQkJCQl9OwoJCQkJCgkJCQkJU2VydmVyLnByb3RvdHlwZS5leHBhbmQgPSBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIHNlbGYgPSB0aGlzLGNvbXBhY3QgPSBmdW5jdGlvbigpewoJCQkJCQkJaWYoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJyl7CgkJCQkJCQkJdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5LAoJCQkJCQkJCQlodG1sID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LAoJCQkJCQkJCQloZWlnaHQgPSBNYXRoLm1heCggYm9keS5zY3JvbGxIZWlnaHQsIGJvZHkub2Zmc2V0SGVpZ2h0LAoJCQkJCQkJCQkJCQkJaHRtbC5jbGllbnRIZWlnaHQsIGh0bWwuc2Nyb2xsSGVpZ2h0LCBodG1sLm9mZnNldEhlaWdodCApOwoJCQkJCQkJCXNlbGYudHJpZ2dlcignc2l6ZUNoYW5nZScsIHtoZWlnaHQgOiBoZWlnaHR9KTsKCQkJCQkJCX1lbHNlewoJCQkJCQkJCWNvbXBhY3QuX2lkID0gc2V0VGltZW91dChjb21wYWN0LDEwMCk7CgkJCQkJCQl9CgkJCQkJCX07CgkJCQkJCWNvbXBhY3QoKTsKCQkJCQl9OwoJCQkJCgkJCQkJU2VydmVyLnByb3RvdHlwZS5jb21wYWN0ID0gZnVuY3Rpb24oKSB7CgkJCQkJCXZhciBzZWxmID0gdGhpcyxyZXNpemUgPSBmdW5jdGlvbigpewoJCQkJCQkJCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCByZXNpemUsIGZhbHNlKTsKCQkJCQkJCQl2YXIgYm9keSA9IGRvY3VtZW50LmJvZHksCgkJCQkJCQkJCWh0bWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsCgkJCQkJCQkJCWhlaWdodCA9IE1hdGgubWF4KCBib2R5LnNjcm9sbEhlaWdodCwgYm9keS5vZmZzZXRIZWlnaHQsCgkJCQkJCQkJCQkJCQlodG1sLmNsaWVudEhlaWdodCwgaHRtbC5zY3JvbGxIZWlnaHQsIGh0bWwub2Zmc2V0SGVpZ2h0ICk7CgkJCQkJCQkJc2VsZi50cmlnZ2VyKCdzaXplQ2hhbmdlJywge2hlaWdodCA6IGhlaWdodH0pOwoJCQkJCQkJfSwgY29tcGFjdCA9IGZ1bmN0aW9uKCl7CgkJCQkJCQlpZihkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKXsKCQkJCQkJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgcmVzaXplLCBmYWxzZSk7CgkJCQkJCQkJc2VsZi50cmlnZ2VyKCdzaXplQ2hhbmdlJywge2hlaWdodCA6IDB9KTsKCQkJCQkJCX1lbHNlewoJCQkJCQkJCWNvbXBhY3QuX2lkID0gc2V0VGltZW91dChjb21wYWN0LDEwMCk7CgkJCQkJCQl9CgkJCQkJCX07CgkJCQkJCWNvbXBhY3QoKTsKCQkJCQl9OwoJCQkJCgkJCQkJcmV0dXJuIFNlcnZlcjsKCQkJCQoJCQkJfSkodGhpcyk7CgkJCQkKCQkJCVdpZGdldGZseS5XaWRnZXQgPSAoZnVuY3Rpb24oZ2xvYmFsKSB7J3VzZSBzdHJpY3QnOwoJCQkJCS8vIFdpZGdldAoJCQkJCS8vIC0tLS0tLS0tLS0tLS0KCQkJCQl2YXIgV2lkZ2V0ID0gZnVuY3Rpb24ob3B0aW9ucykgewoJCQkJCQl0aGlzLmlkID0gV2lkZ2V0Zmx5LlV0aWxzLnVuaXF1ZUlkKCd3aWRnZXQnKTsKCQkJCQkJdGhpcy5zdGFydGVkID0gZmFsc2U7CgkJCQkJCXJldHVybiB0aGlzOwoJCQkJCX07CgkJCQkKCQkJCQlXaWRnZXQuREVGQVVMVFMgPSBXaWRnZXRmbHkuVXRpbHMuZXh0ZW5kKHt9LHsKCQkJCQkJYXV0b0dyb3cgOiBmYWxzZSwKCQkJCQkJYXV0b1N0YXJ0OiB0cnVlLAoJCQkJCQlzaG93IDogdHJ1ZSwKCQkJCQkJc3Bpbm5lciA6ICc8ZGl2IGNsYXNzPSJ3aWRnZXRmbHkgd2Ytc3Bpbm5lciI+PGRpdiBjbGFzcz0icmVjdDEiPjwvZGl2PjxkaXYgY2xhc3M9InJlY3QyIj48L2Rpdj48ZGl2IGNsYXNzPSJyZWN0MyI+PC9kaXY+PGRpdiBjbGFzcz0icmVjdDQiPjwvZGl2PjxkaXYgY2xhc3M9InJlY3Q1Ij48L2Rpdj48L2Rpdj4nCgkJCQkJfSk7CgkJCQkKCQkJCQlXaWRnZXRmbHkuVXRpbHMuaW5oZXJpdChXaWRnZXQsIFdpZGdldGZseS5FdmVudHMpOwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5nZXRJZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gdGhpcy5pZDsKCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5zdHlsZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgciA9IGZ1bmN0aW9uKGVsKXsKCQkJCQkJCWlmKGVsLmNsYXNzTmFtZSl7CgkJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmFkZENsYXNzKGVsLCBlbC5jbGFzc05hbWUpOwoJCQkJCQkJfQoJCQkJCQkJdmFyIGksaiwgbm9kZXMgPSBlbC5jaGlsZE5vZGVzOwoJCQkJCQkJZm9yKGkgaW4gbm9kZXMpewoJCQkJCQkJCWlmKG5vZGVzW2ldLmNsYXNzTmFtZSAmJiAobm9kZXNbaV0uY2xhc3NOYW1lLmluZGV4T2YoJ3dpZGdldGZseScpID09PSAwIHx8IG5vZGVzW2ldLmNsYXNzTmFtZS5pbmRleE9mKCd3Zi0nKSA9PT0gMCkpewoJCQkJCgkJCQkJCQkJCVdpZGdldGZseS5VdGlscy5hZGRDbGFzcyhub2Rlc1tpXSwgbm9kZXNbaV0uY2xhc3NOYW1lKTsKCQkJCQkJCQl9CgkJCQkJCQkJaWYobm9kZXNbaV0uY2hpbGROb2Rlcyl7CgkJCQkJCQkJCWZvcihqIGluIG5vZGVzW2ldLmNoaWxkTm9kZXMpewoJCQkJCQkJCQkJcihub2Rlc1tpXS5jaGlsZE5vZGVzW2pdKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfTsKCQkJCQkJcih0aGlzLmVsKTsKCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5nZXRJZnJhbWUgPSBmdW5jdGlvbigpewoJCQkJCQl2YXIgaWZyYW1lID0gdGhpcy5lbC5xdWVyeVNlbGVjdG9yKCdpZnJhbWUnKTsKCQkJCQkJaWYoIWlmcmFtZSl7CgkJCQkJCQlpZih0aGlzLmVsLnRhZ05hbWUgPT09ICdJRlJBTUUnKXsKCQkJCQkJCQlpZnJhbWUgPSB0aGlzLmVsOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXJldHVybiBpZnJhbWU7CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUub25TdGFydCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJCQkJCWlmIChXaWRnZXRmbHkuVXRpbHMuaXNGdW5jdGlvbihjYWxsYmFjaykpIHsKCQkJCQkJCXRoaXMub24oJ29uU3RhcnQnLCBjYWxsYmFjayk7CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKCkgewoJCQkJCQkvL2NvbnNvbGUubG9nKCdXaWRnZXQuQWN0aW9uIHN0YXJ0Jyk7CgkJCQkJCWlmKHRoaXMuc3RhcnRlZCl7IHJldHVybjsgfQoJCQkJCgkJCQkJCXZhciBoYW5kbGVycyA9IFdpZGdldGZseS5NZWRpYXRvci5nZXRBY3Rpb25IYW5kbGVycyh0aGlzLmlkKTsKCQkJCQkJaWYgKGhhbmRsZXJzICYmIFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKGhhbmRsZXJzLm9uU3RhcnQpKSB7CgkJCQkJCQloYW5kbGVycy5vblN0YXJ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKTsKCQkJCQkJfQoJCQkJCgkJCQkJCWlmKHRoaXMuc3Bpbm5lcil7CgkJCQkJCQlpZih0aGlzLnNwaW5uZXIucGFyZW50Tm9kZSl7CgkJCQkJCQkJdGhpcy5zcGlubmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5zcGlubmVyKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCgkJCQkJCWlmKFdpZGdldGZseS5VdGlscy5pc1RydWUodGhpcy5vcHRpb25zLnNob3cpKXsKCQkJCQkJCXRoaXMuc2hvdygpOwoJCQkJCQl9ZWxzZXsKCQkJCQkJCXRoaXMuaGlkZSgpOwoJCQkJCQl9CgkJCQkJCXRoaXMuc3RhcnRlZCA9IHRydWU7CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUub25IaWRlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKCQkJCQkJaWYgKFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgewoJCQkJCQkJdGhpcy5vbignb25IaWRlJywgY2FsbGJhY2spOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQkvL2NvbnNvbGUubG9nKCdXaWRnZXQuQWN0aW9uIGhpZGUnKTsKCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLnJlbW92ZUNsYXNzKHRoaXMuZWwsICd3Zi1zaG93IHdmLWhpZGUnKTsKCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmFkZENsYXNzKHRoaXMuZWwsICd3Zi1oaWRlJyk7CgkJCQkJCXZhciBoYW5kbGVycyA9IFdpZGdldGZseS5NZWRpYXRvci5nZXRBY3Rpb25IYW5kbGVycyh0aGlzLmlkKTsKCQkJCQkJaWYgKGhhbmRsZXJzICYmIFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKGhhbmRsZXJzLm9uSGlkZSkpIHsKCQkJCQkJCWhhbmRsZXJzLm9uSGlkZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbigpIHsKCQkJCQkJCWlmKHRoaXMuaXNTaG93KCkpewoJCQkJCQkJCXRoaXMuaGlkZSgpOwoJCQkJCQkJfWVsc2V7CgkJCQkJCQkJdGhpcy5zaG93KCk7CgkJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUub25TaG93ID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKCQkJCQkJaWYgKFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgewoJCQkJCQkJdGhpcy5vbignb25TaG93JywgY2FsbGJhY2spOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUuaXNTaG93ID0gZnVuY3Rpb24oKSB7CgkJCQkJCXZhciByZXN1bHQgPSBXaWRnZXRmbHkuVXRpbHMuaGFzQ2xhc3ModGhpcy5lbCwnd2Ytc2hvdycpOwoJCQkJCQl0aGlzLnRyaWdnZXIoJ19pc1Nob3cnLHJlc3VsdCk7CgkJCQkJCXJldHVybiByZXN1bHQ7CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCkgewoJCQkJCQkvL2NvbnNvbGUubG9nKCdXaWRnZXQuQWN0aW9uIHNob3cnKTsKCQkJCQkJdmFyIGhhbmRsZXJzOwoJCQkJCQlXaWRnZXRmbHkuVXRpbHMucmVtb3ZlQ2xhc3ModGhpcy5lbCwgJ3dmLXNob3cgd2YtaGlkZScpOwoJCQkJCQlXaWRnZXRmbHkuVXRpbHMuYWRkQ2xhc3ModGhpcy5lbCwgJ3dmLXNob3cnKTsKCQkJCQkJaGFuZGxlcnMgPSBXaWRnZXRmbHkuTWVkaWF0b3IuZ2V0QWN0aW9uSGFuZGxlcnModGhpcy5pZCk7CgkJCQkJCWlmIChoYW5kbGVycyAmJiBXaWRnZXRmbHkuVXRpbHMuaXNGdW5jdGlvbihoYW5kbGVycy5vblNob3cpKSB7CgkJCQkJCQloYW5kbGVycy5vblNob3cuYXBwbHkodGhpcyxhcmd1bWVudHMpOwoJCQkJCQl9CgkJCQkJCXRoaXMudHJpZ2dlcignX29uU2hvdycpOwoJCQkJCX07CgkJCQkKCQkJCQlXaWRnZXQucHJvdG90eXBlLm9uQmVmb3JlQ2xvc2UgPSBmdW5jdGlvbihjYWxsYmFjaykgewoJCQkJCQlpZiAoV2lkZ2V0Zmx5LlV0aWxzLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7CgkJCQkJCQl0aGlzLm9uKCdvbkJlZm9yZUNsb3NlJywgY2FsbGJhY2spOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHsKCQkJCQkJLy9jb25zb2xlLmxvZygnV2lkZ2V0LkFjdGlvbiBjbG9zZScpOwoJCQkJCQl2YXIgciwgc2VsZiA9IHRoaXMsIGhhbmRsZXJzOwoJCQkJCQloYW5kbGVycyA9IFdpZGdldGZseS5NZWRpYXRvci5nZXRBY3Rpb25IYW5kbGVycyh0aGlzLmlkKTsKCQkJCQkJaWYgKGhhbmRsZXJzICYmIFdpZGdldGZseS5VdGlscy5pc0Z1bmN0aW9uKGhhbmRsZXJzLm9uQmVmb3JlQ2xvc2UpKSB7CgkJCQkJCQlyID0gaGFuZGxlcnMub25CZWZvcmVDbG9zZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7CgkJCQkJCX0KCQkJCQkJaWYociAhPT0gZmFsc2UpewoJCQkJCQkJdGhpcy50cmlnZ2VyKCdfb25DbG9zZScpOwoJCQkJCQkJV2lkZ2V0Zmx5Lk1lZGlhdG9yLnVucmVnaXN0ZXIodGhpcy5pZCwgZnVuY3Rpb24oKSB7CgkJCQkJCQkJc2VsZi5jb250YWluZXIucmVtb3ZlQ2hpbGQoc2VsZi5lbCk7CgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlXaWRnZXQucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24oKSB7CgkJCQkJCXZhciBub3dTY3JpcHRzID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdDsKCQkJCQkJLy9jb25zb2xlLmxvZyh0aGlzKTsKCQkJCQkJV2lkZ2V0Zmx5Lk1lZGlhdG9yLnJlZ2lzdGVyKHRoaXMuaWQsIHRoaXMpOwoJCQkJCQlpZihub3dTY3JpcHRzKXsKCQkJCQkJCW5vd1NjcmlwdHMuc2V0QXR0cmlidXRlKCdkYXRhLWlkJywgdGhpcy5pZCk7CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJV2lkZ2V0LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIHNlbGYgPSB0aGlzLCBzcmMsIGlmcmFtZSwgb3JpZ2luLCB1cmxPcHRpb25zOwoJCQkJCQlpZiAod2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSAnZmlsZTonKSB7CgkJCQkJCQlvcmlnaW4gPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJb3JpZ2luID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSArIChwYXJzZUludCh3aW5kb3cubG9jYXRpb24ucG9ydCwxMCkgJiYgIHdpbmRvdy5sb2NhdGlvbi5wb3J0ICE9PSA4MCA/ICgnOicgKyB3aW5kb3cubG9jYXRpb24ucG9ydCkgOiAnJyk7CgkJCQkJCX0KCQkJCQoJCQkJCQl1cmxPcHRpb25zID0gewoJCQkJCQkJb3JpZ2luIDogb3JpZ2luLAoJCQkJCQkJb3B0aW9ucyA6IHRoaXMub3B0aW9ucy5vcHRpb25zLAoJCQkJCQkJYXV0b0dyb3cgOiB0aGlzLm9wdGlvbnMuYXV0b0dyb3csCgkJCQkJCQlhdXRvU3RhcnQgOiB0aGlzLm9wdGlvbnMuYXV0b1N0YXJ0CgkJCQkJCX07CgkJCQkKCQkJCQkJdGhpcy5zcGlubmVyID0gV2lkZ2V0Zmx5LlV0aWxzLnRvRWxlbWVudCh0aGlzLm9wdGlvbnMuc3Bpbm5lcik7CgkJCQkKCQkJCQkJdGhpcy5lbCA9IFdpZGdldGZseS5VdGlscy50b0VsZW1lbnQodGhpcy5vcHRpb25zLnRlbXBsYXRlKTsKCQkJCQoJCQkJCQlpZnJhbWUgPSB0aGlzLmdldElmcmFtZSgpOwoJCQkJCgkJCQkJCWlmcmFtZS5zZXRBdHRyaWJ1dGUoJ25hbWUnLCB0aGlzLmlkKTsKCQkJCQoJCQkJCQlpZiAodGhpcy5vcHRpb25zLnNyYy5pbmRleE9mKCcjJykgPT09IC0xKSB7CgkJCQkJCQlzcmMgPSB0aGlzLm9wdGlvbnMuc3JjICsgJyMnOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJc3JjID0gdGhpcy5vcHRpb25zLnNyYy5zdWJzdHJpbmcoMCx0aGlzLm9wdGlvbnMuc3JjLmluZGV4T2YoJyMnKSkgKyAnIyc7CgkJCQkJCX0KCQkJCQoJCQkJCQlzcmMgPSBzcmMgKyBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkodXJsT3B0aW9ucykpOwoJCQkJCgkJCQkJCWlmcmFtZS5vbmxvYWQgPSBmdW5jdGlvbihlKXsKCQkJCQkJCWlmKFdpZGdldGZseS5VdGlscy5pc1RydWUoc2VsZi5vcHRpb25zLmF1dG9TdGFydCkpewoJCQkJCQkJCXZhciB0aW1lcklkLCBydW4gPSAwLCBhY2sgPSBmYWxzZTsKCQkJCQoJCQkJCQkJCXNlbGYub24oJ2FjaycsZnVuY3Rpb24oKXsKCQkJCQkJCQkJYWNrID0gdHJ1ZTsKCQkJCQkJCQkJY2xlYXJJbnRlcnZhbCh0aW1lcklkKTsKCQkJCQkJCQl9KTsKCQkJCQoJCQkJCQkJCXRpbWVySWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpewoJCQkJCQkJCQlydW4rKzsKCQkJCQkJCQkJaWYocnVuID4gMykgewoJCQkJCQkJCQkJY2xlYXJJbnRlcnZhbCh0aW1lcklkKTsKCQkJCQkJCQkJCWlmKCFhY2spewoJCQkJCQkJCQkJCXNlbGYuc3RhcnQoKTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfWVsc2V7CgkJCQkJCQkJCQlpZihhY2spewoJCQkJCQkJCQkJCWNsZWFySW50ZXJ2YWwodGltZXJJZCk7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQkJc2VsZi50cmlnZ2VyKCdhY2snKTsKCQkJCQkJCQl9LDQwMCk7CgkJCQkKCQkJCQkJCX0KCQkJCQkJfTsKCQkJCQoJCQkJCQlpZnJhbWUuc2V0QXR0cmlidXRlKCdzcmMnLCBzcmMpOwoJCQkJCgkJCQkJCXJldHVybiBpZnJhbWU7CgkJCQkJfTsKCQkJCQoJCQkJCVdpZGdldC5wcm90b3R5cGUuc2l6ZUNoYW5nZSA9IGZ1bmN0aW9uKHNpemUpewoJCQkJCQlpZih0aGlzLmlzU2hvdygpKXsKCQkJCQkJCVdpZGdldGZseS5VdGlscy5pbm5lclN0eWxlKHRoaXMuaWZyYW1lLHtzaXplOiAnaGVpZ2h0OicgKyAoKHR5cGVvZiBzaXplLmhlaWdodCA9PT0gJ3N0cmluZycpID8gc2l6ZS5oZWlnaHQgOiAoU3RyaW5nKHNpemUuaGVpZ2h0KSArICdweCcpKX0pOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCXJldHVybiBXaWRnZXQ7CgkJCQl9KSh0aGlzKTsKCQkJCQoJCQkJV2lkZ2V0Zmx5LlBhbmVsID0gKGZ1bmN0aW9uKGdsb2JhbCkgeyd1c2Ugc3RyaWN0JzsKCQkJCQoJCQkJCS8vIFdpZGdldGZseS5QYW5lbAoJCQkJCS8vIC0tLS0tLS0tLS0tLS0KCQkJCQl2YXIgUGFuZWwgPSBmdW5jdGlvbihvcHRpb25zKSB7CgkJCQkKCQkJCQkJV2lkZ2V0Zmx5LldpZGdldC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCgkJCQkJCXRoaXMub3B0aW9ucyA9IFdpZGdldGZseS5VdGlscy5leHRlbmQoe30sIFBhbmVsLkRFRkFVTFRTLG9wdGlvbnMpOwoJCQkJCgkJCQkJCWlmIChvcHRpb25zID09PSB1bmRlZmluZWQgfHwgb3B0aW9ucy5jb250YWluZXIgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLmNvbnRhaW5lciA9PT0gbnVsbCkgewoJCQkJCQkJLy9jb25zb2xlLmxvZygnY29udGFpbmVyIG5vdCBkZWZpbmVkLicpOwoJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQl9CgkJCQkKCQkJCQkJaWYodHlwZW9mIG9wdGlvbnMuY29udGFpbmVyID09PSAnc3RyaW5nJyl7CgkJCQkJCQl0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5jb250YWluZXIpOwoJCQkJCQl9ZWxzZSBpZih0eXBlb2Ygb3B0aW9ucy5jb250YWluZXIgPT09ICdvYmplY3QnKXsKCQkJCQkJCXRoaXMuY29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXI7CgkJCQkJCX0KCQkJCQoJCQkJCQlpZiAodGhpcy5jb250YWluZXIgJiYgdGhpcy5jb250YWluZXIubGVuZ3RoIDw9IDApIHsKCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJfQoJCQkJCgkJCQkJCXRoaXMucmVnaXN0ZXIodGhpcy5pZCk7CgkJCQkKCQkJCQkJdGhpcy5yZW5kZXIoKTsKCQkJCQoJCQkJCQl0aGlzLmlmcmFtZSA9IHRoaXMuZ2V0SWZyYW1lKCk7CgkJCQkKCQkJCQkJdGhpcy5zdHlsZSgpOwoJCQkJCgkJCQkJCWlmICh0aGlzLmNvbnRhaW5lcikgewoJCQkJCQkJZm9yICh2YXIgbiBpbiB0aGlzLmNvbnRhaW5lci5jaGlsZE5vZGVzKSB7CgkJCQkJCQkJaWYodGhpcy5jb250YWluZXIuY2hpbGROb2Rlc1tuXS5ub2RlTmFtZSAhPT0gJ1NDUklQVCcgJiYgdGhpcy5jb250YWluZXIuY2hpbGROb2Rlc1tuXS5wYXJlbnROb2RlID09PSB0aGlzLmNvbnRhaW5lcil7CgkJCQkJCQkJCXRoaXMuY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuY29udGFpbmVyLmNoaWxkTm9kZXNbbl0pOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCXRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuc3Bpbm5lcik7CgkJCQkJCQl0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmVsKTsKCQkJCQkJfQoJCQkJCgkJCQkJCXJldHVybiB0aGlzOwoJCQkJCX07CgkJCQkKCQkJCQlQYW5lbC5ERUZBVUxUUyA9IFdpZGdldGZseS5VdGlscy5leHRlbmQoe30sIFdpZGdldGZseS5XaWRnZXQuREVGQVVMVFMsewoJCQkJCQl0ZW1wbGF0ZSA6ICc8aWZyYW1lIGFsbG93dHJhbnNwYXJlbmN5PSJ0cnVlIiBmcmFtZWJvcmRlcj0iMCIgdGFiaW5kZXg9IjAiIHRpdGxlPSJXaWRnZXRmbHkgV2lkZ2V0IiB3aWR0aD0iMTAwJSIgY2xhc3M9IndpZGdldGZseSB3Zi1wYW5lbCB3Zi1oaWRlIj48L2lmcmFtZT4nLAoJCQkJCQlvcHRpb25zIDogewoJCQkJCgkJCQkJCX0KCQkJCQl9KTsKCQkJCQoJCQkJCVdpZGdldGZseS5VdGlscy5pbmhlcml0KFBhbmVsLCBXaWRnZXRmbHkuV2lkZ2V0KTsKCQkJCQoJCQkJCVBhbmVsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQkvL2NvbnNvbGUubG9nKCdXaWRnZXQuQWN0aW9uIGNsb3NlJyk7CgkJCQkJCXZhciByLCBzZWxmID0gdGhpcywgaGFuZGxlcnM7CgkJCQkJCWhhbmRsZXJzID0gV2lkZ2V0Zmx5Lk1lZGlhdG9yLmdldEFjdGlvbkhhbmRsZXJzKHRoaXMuaWQpOwoJCQkJCQlpZiAoaGFuZGxlcnMgJiYgV2lkZ2V0Zmx5LlV0aWxzLmlzRnVuY3Rpb24oaGFuZGxlcnMub25CZWZvcmVDbG9zZSkpIHsKCQkJCQkJCXIgPSBoYW5kbGVycy5vbkJlZm9yZUNsb3NlKCk7CgkJCQkJCX0KCQkJCQkJaWYgKHIgIT09IGZhbHNlKSB7CgkJCQkJCQlXaWRnZXRmbHkuTWVkaWF0b3IudW5yZWdpc3Rlcih0aGlzLmlkLCBmdW5jdGlvbigpIHsKCQkJCQkJCQlzZWxmLmNvbnRhaW5lci5yZW1vdmUoMCk7CgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlyZXR1cm4gUGFuZWw7CgkJCQl9KSh0aGlzKTsKCQkJCQoJCQkJV2lkZ2V0Zmx5Lk1vZGFsID0gKGZ1bmN0aW9uKGdsb2JhbCkgeyd1c2Ugc3RyaWN0JzsKCQkJCQkvLyBXaWRnZXRmbHkuTW9kYWwKCQkJCQkvLyAtLS0tLS0tLS0tLS0tCgkJCQkJdmFyIE1vZGFsID0gZnVuY3Rpb24ob3B0aW9ucykgewoJCQkJCQl2YXIgc2VsZiA9IHRoaXMsIHNpemVDbGFzcywgYXcsIHc7CgkJCQkKCQkJCQkJV2lkZ2V0Zmx5LldpZGdldC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl0aGlzLm9wdGlvbnMgPSBXaWRnZXRmbHkuVXRpbHMuZXh0ZW5kKHt9LCBNb2RhbC5ERUZBVUxUUyxvcHRpb25zKTsKCQkJCQkJdGhpcy5jb250YWluZXIgPSB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpOwoJCQkJCgkJCQkJCWlmIChvcHRpb25zID09PSB1bmRlZmluZWQpIHsKCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJfQoJCQkJCgkJCQkJCWF3ID0gV2lkZ2V0Zmx5Lk1lZGlhdG9yLndpZGdldHM7CgkJCQkJCWZvcih3IGluIGF3KXsKCQkJCQkJCWlmKGF3W3ddIGluc3RhbmNlb2YgV2lkZ2V0Zmx5Lk1vZGFsKXsKCQkJCQkJCQlhd1t3XS5jbG9zZSgpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkKCQkJCQkJdGhpcy5yZWdpc3Rlcih0aGlzLmlkKTsKCQkJCQoJCQkJCQlpZiAodGhpcy5jb250YWluZXIpIHsKCQkJCQkJCXRoaXMucmVuZGVyKCk7CgkJCQkKCQkJCQkJCXRoaXMuaWZyYW1lID0gdGhpcy5nZXRJZnJhbWUoKTsKCQkJCQoJCQkJCQkJdGhpcy5iYWNrZHJvcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJCgkJCQkJCQlpZih0aGlzLm9wdGlvbnMuc2l6ZSA9PT0gJ2xhcmdlJyl7CgkJCQkJCQkJc2l6ZUNsYXNzID0gJ3dmLW1vZGFsLWxnJzsKCQkJCQkJCX1lbHNlIGlmKHRoaXMub3B0aW9ucy5zaXplID09PSAnc21hbGwnKXsKCQkJCQkJCQlzaXplQ2xhc3MgPSAnd2YtbW9kYWwtc20nOwoJCQkJCQkJfWVsc2V7CgkJCQkJCQkJc2l6ZUNsYXNzID0gJ3dmLW1vZGFsLW1kJzsKCQkJCQkJCX0KCQkJCQkJCVdpZGdldGZseS5VdGlscy5hZGRDbGFzcyh0aGlzLmVsLHNpemVDbGFzcyk7CgkJCQkKCQkJCQkJCVdpZGdldGZseS5VdGlscy5hZGRDbGFzcyh0aGlzLmJhY2tkcm9wLCd3aWRnZXRmbHkgd2YtbW9kYWwtYmFja2Ryb3Agd2YtaGlkZScpOwoJCQkJCgkJCQkJCQkvL2JpbmQgY2xvc2UgZXZlbnQKCQkJCQkJCXRoaXMuZWwucXVlcnlTZWxlY3RvcignLndmLWNsb3NlJykub25jbGljayA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJCXNlbGYuaGlkZSgpOwoJCQkJCQkJfTsKCQkJCQoJCQkJCQkJdGhpcy5lbC5vbmNsaWNrID0gZnVuY3Rpb24oZSl7CgkJCQkJCQkJaWYoZS50YXJnZXQgPT09IHNlbGYuZWwpewoJCQkJCQkJCQlzZWxmLmhpZGUoKTsKCQkJCQkJCQl9CgkJCQkJCQl9OwoJCQkJCgkJCQkJCQlpZih0aGlzLm9wdGlvbnMuYmFja2Ryb3ApewoJCQkJCQkJCXRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuYmFja2Ryb3ApOwoJCQkJCQkJfQoJCQkJCgkJCQkJCQl0aGlzLnN0eWxlKCk7CgkJCQkKCQkJCQkJCXRoaXMuZWwucXVlcnlTZWxlY3RvcignLndmLW1vZGFsLWNvbnRlbnQnKS5pbnNlcnRCZWZvcmUodGhpcy5zcGlubmVyLHRoaXMuaWZyYW1lKTsKCQkJCQkJCXRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZWwpOwoJCQkJCgkJCQkJCX0KCQkJCQoJCQkJCQl0aGlzLnJlc2l6ZUNhbGxiYWNrID0gZnVuY3Rpb24oZSl7CgkJCQkJCQlpZihzZWxmLmlzU2hvdygpKXsKCQkJCQkJCQlXaWRnZXRmbHkuVXRpbHMudGhyb3R0bGUoc2VsZi5zdHlsZSwgc2VsZik7CgkJCQkJCQl9CgkJCQkJCX07CgkJCQkKCQkJCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMucmVzaXplQ2FsbGJhY2ssIGZhbHNlKTsKCQkJCQoJCQkJCQlyZXR1cm4gdGhpczsKCQkJCQl9OwoJCQkJCgkJCQkJTW9kYWwuREVGQVVMVFMgPSBXaWRnZXRmbHkuVXRpbHMuZXh0ZW5kKHt9LCBXaWRnZXRmbHkuV2lkZ2V0LkRFRkFVTFRTLHsKCQkJCQkJc2hvdyA6IGZhbHNlLAoJCQkJCQliYWNrZHJvcCA6IHRydWUsCgkJCQkJCXRlbXBsYXRlIDogJzxkaXYgY2xhc3M9IndpZGdldGZseSB3Zi1tb2RhbCB3Zi1oaWRlIj48ZGl2IGNsYXNzPSJ3Zi1tb2RhbC1kaWFsb2ciPjxkaXYgY2xhc3M9IndmLW1vZGFsLWNvbnRlbnQgd2YtYW5pbWF0ZWQtZmFkZUluVXBCaWcgd2YtYW5pbWF0ZWQtbW9kYWwiPjxhIGNsYXNzPSJ3Zi1jbG9zZSIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIj4mIzIxNTwvYT48aWZyYW1lIGFsbG93dHJhbnNwYXJlbmN5PSJ0cnVlIiBmcmFtZWJvcmRlcj0iMCIgdGFiaW5kZXg9IjAiIHRpdGxlPSJXaWRnZXRmbHkgV2lkZ2V0IiB3aWR0aD0iMTAwJSIgY2xhc3M9IndmLW1vZGFsLWJvZHkgd2Ytc2hvdyI+PC9pZnJhbWU+PC9kaXY+PC9kaXY+PC9kaXY+JywKCQkJCQkJb3B0aW9ucyA6IHsKCQkJCQoJCQkJCQl9CgkJCQkJfSk7CgkJCQkKCQkJCQlXaWRnZXRmbHkuVXRpbHMuaW5oZXJpdChNb2RhbCwgV2lkZ2V0Zmx5LldpZGdldCk7CgkJCQkKCQkJCQlNb2RhbC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCkgewoJCQkJCQkvL3Nob3cgb25seSBvbmUgbW9kYWwgYXQgYSB0aW1lCgkJCQkJCWZvcih2YXIgaSBpbiB0aGlzLm1lZGlhdG9yLndpZGdldHMpewoJCQkJCQkJaWYodGhpcy5tZWRpYXRvci53aWRnZXRzW2ldIGluc3RhbmNlb2YgV2lkZ2V0Zmx5Lk1vZGFsKXsKCQkJCQkJCQlpZih0aGlzLm1lZGlhdG9yLndpZGdldHNbaV0uaXNTaG93KCkpewoJCQkJCQkJCQl0aGlzLm1lZGlhdG9yLndpZGdldHNbaV0uaGlkZSgpOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQl0aGlzLnN0eWxlKCk7CgkJCQkJCVdpZGdldGZseS5XaWRnZXQucHJvdG90eXBlLnNob3cuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJaWYoV2lkZ2V0Zmx5LlV0aWxzLmlzVHJ1ZSh0aGlzLm9wdGlvbnMuYmFja2Ryb3ApKXsKCQkJCQkJCVdpZGdldGZseS5VdGlscy5yZW1vdmVDbGFzcyh0aGlzLmJhY2tkcm9wLCAnd2Ytc2hvdyB3Zi1oaWRlJyk7CgkJCQkJCQlXaWRnZXRmbHkuVXRpbHMuYWRkQ2xhc3ModGhpcy5iYWNrZHJvcCwgJ3dmLXNob3cnKTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlNb2RhbC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQlXaWRnZXRmbHkuV2lkZ2V0LnByb3RvdHlwZS5oaWRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJCWlmKFdpZGdldGZseS5VdGlscy5pc1RydWUodGhpcy5vcHRpb25zLmJhY2tkcm9wKSl7CgkJCQkJCQlXaWRnZXRmbHkuVXRpbHMucmVtb3ZlQ2xhc3ModGhpcy5iYWNrZHJvcCwgJ3dmLXNob3cgd2YtaGlkZScpOwoJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmFkZENsYXNzKHRoaXMuYmFja2Ryb3AsICd3Zi1oaWRlJyk7CgkJCQkJCX0KCQkJCQl9OwoJCQkJCgkJCQkJTW9kYWwucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24oKSB7CgkJCQkJCS8vY29uc29sZS5sb2coJ1dpZGdldC5BY3Rpb24gY2xvc2UnKTsKCQkJCQkJdmFyIHIsIHNlbGYgPSB0aGlzLCBoYW5kbGVyczsKCQkJCQkJaGFuZGxlcnMgPSBXaWRnZXRmbHkuTWVkaWF0b3IuZ2V0QWN0aW9uSGFuZGxlcnModGhpcy5pZCk7CgkJCQkJCWlmIChoYW5kbGVycyAmJiBXaWRnZXRmbHkuVXRpbHMuaXNGdW5jdGlvbihoYW5kbGVycy5vbkJlZm9yZUNsb3NlKSkgewoJCQkJCQkJciA9IGhhbmRsZXJzLm9uQmVmb3JlQ2xvc2UoKTsKCQkJCQkJfQoJCQkJCQl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5yZXNpemVDYWxsYmFjaywgZmFsc2UpOwoJCQkJCQlpZihyICE9PSBmYWxzZSl7CgkJCQkJCQlXaWRnZXRmbHkuTWVkaWF0b3IudW5yZWdpc3Rlcih0aGlzLmlkLCBmdW5jdGlvbigpIHsKCQkJCQkJCQlzZWxmLmNvbnRhaW5lci5yZW1vdmVDaGlsZChzZWxmLmVsKTsKCQkJCQkJCQlpZihXaWRnZXRmbHkuVXRpbHMuaXNUcnVlKHNlbGYub3B0aW9ucy5iYWNrZHJvcCkpewoJCQkJCQkJCQlzZWxmLmNvbnRhaW5lci5yZW1vdmVDaGlsZChzZWxmLmJhY2tkcm9wKTsKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlNb2RhbC5wcm90b3R5cGUuc2l6ZUNoYW5nZSA9IGZ1bmN0aW9uKHNpemUpewoJCQkJCQlpZih0aGlzLmlzU2hvdygpKXsKCQkJCQkJCVdpZGdldGZseS5VdGlscy5pbm5lclN0eWxlKHRoaXMuZWwucXVlcnlTZWxlY3RvcignLndmLW1vZGFsLWRpYWxvZycpLHtzaXplOiAnaGVpZ2h0OicgKyAoKHR5cGVvZiBzaXplLmhlaWdodCA9PT0gJ3N0cmluZycpID8gc2l6ZS5oZWlnaHQgOiAoU3RyaW5nKHNpemUuaGVpZ2h0KSArICdweCcpKX0pOwoJCQkJCQkJV2lkZ2V0Zmx5LldpZGdldC5wcm90b3R5cGUuc2l6ZUNoYW5nZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQoJCQkJCXJldHVybiBNb2RhbDsKCQkJCQoJCQkJfSkodGhpcyk7CgkJCQkKCQkJCVdpZGdldGZseS5Qb3BvdmVyID0gKGZ1bmN0aW9uKGdsb2JhbCkgeyd1c2Ugc3RyaWN0JzsKCQkJCQkvLyBXaWRnZXRmbHkuUG9wb3ZlcgoJCQkJCS8vIC0tLS0tLS0tLS0tLS0KCQkJCQl2YXIgUG9wb3ZlciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKCQkJCQkJdmFyIHNlbGYgPSB0aGlzOwoJCQkJCgkJCQkJCVdpZGdldGZseS5XaWRnZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJdGhpcy5vcHRpb25zID0gV2lkZ2V0Zmx5LlV0aWxzLmV4dGVuZCh7fSwgUG9wb3Zlci5ERUZBVUxUUyxvcHRpb25zKTsKCQkJCQoJCQkJCQl0aGlzLnN0eWxlcyA9IHt9OwoJCQkJCQlpZihvcHRpb25zLnN0eWxlcyl7CgkJCQkJCQl0aGlzLnN0eWxlcy5leHRyYSA9IG9wdGlvbnMuc3R5bGVzOwoJCQkJCQl9CgkJCQkKCQkJCQkJdGhpcy5jb250YWluZXIgPSB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpOwoJCQkJCgkJCQkJCWlmIChvcHRpb25zID09PSB1bmRlZmluZWQgfHwgb3B0aW9ucy50YXJnZXQgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLnRhcmdldCA9PT0gbnVsbCkgewoJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQl9CgkJCQkKCQkJCQkJdGhpcy5yZWdpc3Rlcih0aGlzLmlkKTsKCQkJCQoJCQkJCQlpZih0eXBlb2Ygb3B0aW9ucy50YXJnZXQgPT09ICdzdHJpbmcnKXsKCQkJCQkJCXRoaXMudGFyZ2V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLnRhcmdldCk7CgkJCQkJCX1lbHNlIGlmKHR5cGVvZiBvcHRpb25zLnRhcmdldCA9PT0gJ29iamVjdCcpewoJCQkJCQkJdGhpcy50YXJnZXQgPSBvcHRpb25zLnRhcmdldDsKCQkJCQkJfQoJCQkJCgkJCQkJCWlmICh0aGlzLnRhcmdldCAmJiB0aGlzLnRhcmdldC5sZW5ndGggPD0gMCkgewoJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQl9CgkJCQkKCQkJCQkJdGhpcy5yZW5kZXIoKTsKCQkJCQoJCQkJCQlpZih0aGlzLm9wdGlvbnMuc2l6ZSl7CgkJCQkJCQl0aGlzLnN0eWxlcy5zaXplID0gJ2hlaWdodDonICsgdGhpcy5vcHRpb25zLnNpemUuaGVpZ2h0ICsgJzsgd2lkdGg6JyArIHRoaXMub3B0aW9ucy5zaXplLndpZHRoOwoJCQkJCQl9CgkJCQkKCQkJCQkJdGhpcy5pZnJhbWUgPSB0aGlzLmdldElmcmFtZSgpOwoJCQkJCgkJCQkJCXRoaXMuc3R5bGUoKTsKCQkJCQoJCQkJCQlpZiAodGhpcy5jb250YWluZXIpIHsKCQkJCQkJCXRoaXMuZWwuaW5zZXJ0QmVmb3JlKHRoaXMuc3Bpbm5lcix0aGlzLmlmcmFtZSk7CgkJCQkJCQl0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmVsKTsKCQkJCQkJfQoJCQkJCgkJCQkJCXRoaXMucmVzaXplQ2FsbGJhY2sgPSBmdW5jdGlvbihlKXsKCQkJCQkJCWlmKHNlbGYuaXNTaG93KCkpewoJCQkJCQkJCVdpZGdldGZseS5VdGlscy50aHJvdHRsZShzZWxmLnN0eWxlLCBzZWxmKTsKCQkJCQkJCX0KCQkJCQkJfTsKCQkJCQoJCQkJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5yZXNpemVDYWxsYmFjaywgZmFsc2UpOwoJCQkJCgkJCQkJCXJldHVybiB0aGlzOwoJCQkJCX07CgkJCQkKCQkJCQlQb3BvdmVyLkRFRkFVTFRTID0gV2lkZ2V0Zmx5LlV0aWxzLmV4dGVuZCh7fSwgV2lkZ2V0Zmx5LldpZGdldC5ERUZBVUxUUyx7CgkJCQkJCXNob3cgOiBmYWxzZSwKCQkJCQkJcGxhY2VtZW50IDogJ3JpZ2h0JywKCQkJCQkJdGVtcGxhdGUgOiAnPGRpdiBjbGFzcz0id2lkZ2V0Zmx5IHdmLXBvcG92ZXIgd2YtaGlkZSB3Zi1hbmltYXRlZC1mYWRlSW4gd2YtYW5pbWF0ZWQtcG9wb3ZlciI+PGRpdiBjbGFzcz0id2YtYXJyb3ciPjwvZGl2PjxpZnJhbWUgYWxsb3d0cmFuc3BhcmVuY3k9InRydWUiIGZyYW1lYm9yZGVyPSIwIiB0YWJpbmRleD0iMCIgdGl0bGU9IldpZGdldGZseSBXaWRnZXQiIHdpZHRoPSIxMDAlIiBjbGFzcz0id2YtcG9wb3Zlci1jb250ZW50Ij48L2lmcmFtZT48L2Rpdj4nLAoJCQkJCQlvcHRpb25zIDogewoJCQkJCgkJCQkJCX0KCQkJCQl9KTsKCQkJCQoJCQkJCVdpZGdldGZseS5VdGlscy5pbmhlcml0KFBvcG92ZXIsIFdpZGdldGZseS5XaWRnZXQpOwoJCQkJCgkJCQkJUG9wb3Zlci5wcm90b3R5cGUuc3R5bGUgPSBmdW5jdGlvbigpIHsKCQkJCQoJCQkJCQl2YXIgdncsdmgsdmVydCx2ZXJ0UGxhY2VtZW50LGhvcml6LGhvcml6UGxhY2VtZW50LCBhY3R1YWxXaWR0aCwgYWN0dWFsSGVpZ2h0LHNpemUgPSBXaWRnZXRmbHkuVXRpbHMuYWN0dWFsKHRoaXMuZWwpOwoJCQkJCQl0aGlzLnBsYWNlbWVudCA9IHRoaXMub3B0aW9ucy5wbGFjZW1lbnQ7CgkJCQkKCQkJCQkJaWYodGhpcy5vcHRpb25zLnBsYWNlbWVudCA9PT0gJ2F1dG8nIHx8ICFCb29sZWFuKHRoaXMub3B0aW9ucy5wbGFjZW1lbnQpKXsKCQkJCQkJCQl2dyA9IE1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgd2luZG93LmlubmVyV2lkdGggfHwgMCk7CgkJCQkJCQkJdmggPSBNYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LCB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgMCk7CgkJCQkJCQkJdmVydCA9IDAuNSAqIHZoIC0gc2l6ZS53aWR0aDsKCQkJCQkJICAgIHZlcnRQbGFjZW1lbnQgPSB2ZXJ0ID4gMCA/ICdib3R0b20nIDogJ3RvcCc7CgkJCQkJCSAgICBob3JpeiA9IDAuNSAqIHZ3IC0gc2l6ZS5oZWlnaHQ7CgkJCQkJCSAgICBob3JpelBsYWNlbWVudCA9IGhvcml6ID4gMCA/ICdyaWdodCcgOiAnbGVmdCc7CgkJCQkJCSAgICB0aGlzLnBsYWNlbWVudCA9IE1hdGguYWJzKGhvcml6KSA+IE1hdGguYWJzKHZlcnQpID8gIGhvcml6UGxhY2VtZW50IDogdmVydFBsYWNlbWVudDsKCQkJCQkJfQoJCQkJCgkJCQkJCWlmKHdpbmRvdy5pbm5lcldpZHRoIDw9IDY0MCAmJiB0aGlzLm9wdGlvbnMucGxhY2VtZW50ID09PSAnbGVmdCcpewoJCQkJCQkJdGhpcy5wbGFjZW1lbnQgPSAndG9wJzsKCQkJCQkJfWVsc2UgaWYod2luZG93LmlubmVyV2lkdGggPD0gNjQwICYmIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQgPT09ICdyaWdodCcpewoJCQkJCQkJdGhpcy5wbGFjZW1lbnQgPSAnYm90dG9tJzsKCQkJCQkJfQoJCQkJCgkJCQkJCVdpZGdldGZseS5VdGlscy5yZW1vdmVDbGFzcyh0aGlzLmVsLCAnd2YtdG9wIHdmLXJpZ2h0IHdmLWJvdHRvbSB3Zi1sZWZ0Jyk7CgkJCQkJCVdpZGdldGZseS5VdGlscy5hZGRDbGFzcyh0aGlzLmVsLCAnd2YtJyArIHRoaXMucGxhY2VtZW50KTsKCQkJCQoJCQkJCQlXaWRnZXRmbHkuV2lkZ2V0LnByb3RvdHlwZS5zdHlsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCgkJCQkJCXRoaXMuYXBwbHlQbGFjZW1lbnQoKTsKCQkJCQl9OwoJCQkJCgkJCQkJUG9wb3Zlci5wcm90b3R5cGUuYXBwbHlQbGFjZW1lbnQgPSBmdW5jdGlvbiAoKSB7CgkJCQkKCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmlubmVyU3R5bGUodGhpcy5lbCx0aGlzLnN0eWxlcyk7CgkJCQkKCQkJCQkJdmFyIHRvcCxsZWZ0LHJpZ2h0LCBhcnJvd09mZnNldCwgb2Zmc2V0ID0gV2lkZ2V0Zmx5LlV0aWxzLm9mZnNldCh0aGlzLnRhcmdldCksCgkJCQkJCQl0ZyAgPSBXaWRnZXRmbHkuVXRpbHMuYWN0dWFsKHRoaXMudGFyZ2V0KSwKCQkJCQkJCWVsID0gV2lkZ2V0Zmx5LlV0aWxzLmFjdHVhbCh0aGlzLmVsKTsKCQkJCQoJCQkJCQlpZih0aGlzLnBsYWNlbWVudCA9PT0gJ2xlZnQnKXsKCQkJCQkJCXRvcCA9IG9mZnNldC50b3AgKyBNYXRoLnJvdW5kKHRnLmhlaWdodCAvIDIpIC0gTWF0aC5yb3VuZChlbC5oZWlnaHQgLyAyKTsKCQkJCQkJCWxlZnQgPSBvZmZzZXQubGVmdCAtIGVsLndpZHRoOwoJCQkJCQl9ZWxzZSBpZih0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcCcpewoJCQkJCQkJdG9wID0gIG9mZnNldC50b3AgLSBlbC5oZWlnaHQ7CgkJCQkJCQlsZWZ0ID0gb2Zmc2V0LmxlZnQgKyBNYXRoLnJvdW5kKHRnLndpZHRoIC8gMikgLSBNYXRoLnJvdW5kKGVsLndpZHRoIC8gMik7CgkJCQkKCQkJCQkJCWlmKGxlZnQgPCAwKXsKCQkJCQkJCQlhcnJvd09mZnNldCA9IE1hdGgucm91bmQodGcud2lkdGggLyAyKSArIG9mZnNldC5sZWZ0OwoJCQkJCQkJCWxlZnQgPSA1OwoJCQkJCQkJfWVsc2UgaWYobGVmdCArIGVsLndpZHRoID4gd2luZG93LmlubmVyV2lkdGgpewoJCQkJCQkJCWxlZnQgPSB3aW5kb3cuaW5uZXJXaWR0aCAtIGVsLndpZHRoIC0gNTsKCQkJCQkJCQlhcnJvd09mZnNldCA9IG9mZnNldC5sZWZ0IC0gbGVmdCArIE1hdGgucm91bmQodGcud2lkdGggLyAyKTsKCQkJCQkJCX0KCQkJCQoJCQkJCQl9ZWxzZSBpZih0aGlzLnBsYWNlbWVudCA9PT0gJ2JvdHRvbScpewoJCQkJCQkJdG9wID0gIG9mZnNldC50b3AgKyB0Zy5oZWlnaHQ7CgkJCQkJCQlsZWZ0ID0gb2Zmc2V0LmxlZnQgKyBNYXRoLnJvdW5kKHRnLndpZHRoIC8gMikgLSBNYXRoLnJvdW5kKGVsLndpZHRoIC8gMik7CgkJCQkKCQkJCQkJCWlmKGxlZnQgPCAwKXsKCQkJCQkJCQlhcnJvd09mZnNldCA9IE1hdGgucm91bmQodGcud2lkdGggLyAyKSArIG9mZnNldC5sZWZ0OwoJCQkJCQkJCWxlZnQgPSA1OwoJCQkJCQkJfWVsc2UgaWYobGVmdCArIGVsLndpZHRoID4gd2luZG93LmlubmVyV2lkdGgpewoJCQkJCQkJCWxlZnQgPSB3aW5kb3cuaW5uZXJXaWR0aCAtIGVsLndpZHRoIC0gNTsKCQkJCQkJCQlhcnJvd09mZnNldCA9IG9mZnNldC5sZWZ0IC0gbGVmdCArIE1hdGgucm91bmQodGcud2lkdGggLyAyKTsKCQkJCQkJCX0KCQkJCQoJCQkJCQl9ZWxzZXsKCQkJCQkJCS8vZGVmYXVsdDogcmlnaHQKCQkJCQkJCXRvcCA9IG9mZnNldC50b3AgKyBNYXRoLnJvdW5kKHRnLmhlaWdodCAvIDIpIC0gTWF0aC5yb3VuZChlbC5oZWlnaHQgLyAyKTsKCQkJCQkJCWxlZnQgPSBvZmZzZXQubGVmdCArIHRnLndpZHRoOwoJCQkJCQl9CgkJCQkJCXRoaXMuc3R5bGVzLm9mZnNldCA9ICd0b3A6ICcgKyAoKHR5cGVvZiB0b3AgPT09ICdzdHJpbmcnKSA/IHRvcCA6IChTdHJpbmcodG9wKSArICdweCcpKSArICc7IGxlZnQ6JyArICgodHlwZW9mIGxlZnQgPT09ICdzdHJpbmcnKSA/IGxlZnQgOiAoU3RyaW5nKGxlZnQpICsgJ3B4OycpKTsKCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmlubmVyU3R5bGUodGhpcy5lbCwgdGhpcy5zdHlsZXMpOwoJCQkJCQlpZihhcnJvd09mZnNldCl7CgkJCQkJCQlXaWRnZXRmbHkuVXRpbHMuaW5uZXJTdHlsZSh0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJy53Zi1hcnJvdycpLCB7IG9mZnNldCA6ICdsZWZ0OicgKyAoKHR5cGVvZiBhcnJvd09mZnNldCA9PT0gJ3N0cmluZycpID8gYXJyb3dPZmZzZXQgOiAoU3RyaW5nKGFycm93T2Zmc2V0KSArICdweDsnKSkgfSk7CgkJCQkJCX1lbHNlewoJCQkJCQkJV2lkZ2V0Zmx5LlV0aWxzLmlubmVyU3R5bGUodGhpcy5lbC5xdWVyeVNlbGVjdG9yKCcud2YtYXJyb3cnKSwgeyBvZmZzZXQgOiAnJyB9KTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlQb3BvdmVyLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKXsKCQkJCQkJdmFyIHNlbGYgPSB0aGlzOwoJCQkJCQkvKgoJCQkJCQlpZih0aGlzLmludGVydmFsKSB7CgkJCQkJCQljbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpOwoJCQkJCQl9Ki8KCQkJCQoJCQkJCQl0aGlzLnN0eWxlKCk7CgkJCQkKCQkJCQkJLyp0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsKCQkJCQkJCXNlbGYuYXBwbHlQbGFjZW1lbnQoKTsKCQkJCQkJfSw1MDApOyovCgkJCQkKCQkJCQkJV2lkZ2V0Zmx5LldpZGdldC5wcm90b3R5cGUuc2hvdy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCX07CgkJCQkKCQkJCQkvKlBvcG92ZXIucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbigpewoJCQkJCQlpZih0aGlzLmludGVydmFsKSB7CgkJCQkJCQljbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpOwoJCQkJCQl9CgkJCQkJCVdpZGdldGZseS5XaWRnZXQucHJvdG90eXBlLmhpZGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJCSovCgkJCQkKCQkJCQlQb3BvdmVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCl7CgkJCQkJCXdpbmRvdy53aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5yZXNpemVDYWxsYmFjaywgZmFsc2UpOwoJCQkJCgkJCQkJCVdpZGdldGZseS5XaWRnZXQucHJvdG90eXBlLmNsb3NlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJfTsKCQkJCQoJCQkJCXJldHVybiBQb3BvdmVyOwoJCQkJCgkJCQl9KSh0aGlzKTsKCQkJCQoJCQkJKGZ1bmN0aW9uKGdsb2JhbCkgeyd1c2Ugc3RyaWN0JzsKCQkJCQoJCQkJCXZhciBleHRlbmQgPSBmdW5jdGlvbihwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewoJCQkJCQl2YXIgY2hpbGQscGFyZW50ID0gdGhpcywgU3Vycm9nYXRlOwoJCQkJCgkJCQkJCS8vIFRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiBmb3IgdGhlIG5ldyBzdWJjbGFzcyBpcyBlaXRoZXIgZGVmaW5lZCBieSB5b3UKCQkJCQkJLy8gKHRoZSAiY29uc3RydWN0b3IiIHByb3BlcnR5IGluIHlvdXIgYGV4dGVuZGAgZGVmaW5pdGlvbiksIG9yIGRlZmF1bHRlZAoJCQkJCQkvLyBieSB1cyB0byBzaW1wbHkgY2FsbCB0aGUgcGFyZW50J3MgY29uc3RydWN0b3IuCgkJCQkJCWlmIChwcm90b1Byb3BzICYmIChXaWRnZXRmbHkuVXRpbHMuaGFzKHByb3RvUHJvcHMsICdjb25zdHJ1Y3RvcicpKSkgewoJCQkJCQkJY2hpbGQgPSBwcm90b1Byb3BzLmNvbnN0cnVjdG9yOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJY2hpbGQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQlyZXR1cm4gcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJCQl9OwoJCQkJCQl9CgkJCQkKCQkJCQkJLy8gQWRkIHN0YXRpYyBwcm9wZXJ0aWVzIHRvIHRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiwgaWYgc3VwcGxpZWQuCgkJCQkJCVdpZGdldGZseS5VdGlscy5leHRlbmQoY2hpbGQsIHBhcmVudCwgc3RhdGljUHJvcHMpOwoJCQkJCgkJCQkJCS8vIFNldCB0aGUgcHJvdG90eXBlIGNoYWluIHRvIGluaGVyaXQgZnJvbSBgcGFyZW50YCwgd2l0aG91dCBjYWxsaW5nCgkJCQkJCS8vIGBwYXJlbnRgJ3MgY29uc3RydWN0b3IgZnVuY3Rpb24uCgkJCQkJCVN1cnJvZ2F0ZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOwoJCQkJCQl9OwoJCQkJCQlTdXJyb2dhdGUucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsKCQkJCQkJY2hpbGQucHJvdG90eXBlID0gbmV3IFN1cnJvZ2F0ZSgpOwoJCQkJCgkJCQkJCS8vIEFkZCBwcm90b3R5cGUgcHJvcGVydGllcyAoaW5zdGFuY2UgcHJvcGVydGllcykgdG8gdGhlIHN1YmNsYXNzLAoJCQkJCQkvLyBpZiBzdXBwbGllZC4KCQkJCQkJaWYgKHByb3RvUHJvcHMpIHsKCQkJCQkJCVdpZGdldGZseS5VdGlscy5leHRlbmQoY2hpbGQucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKCQkJCQkJfQoJCQkJCgkJCQkJCS8vIFNldCBhIGNvbnZlbmllbmNlIHByb3BlcnR5IGluIGNhc2UgdGhlIHBhcmVudCdzIHByb3RvdHlwZSBpcyBuZWVkZWQKCQkJCQkJLy8gbGF0ZXIuCgkJCQkJCWNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7CgkJCQkKCQkJCQkJcmV0dXJuIGNoaWxkOwoJCQkJCX0sbm93U2NyaXB0cywgaW5zdGFuY2UsIHBhcmFtcywgcGFyc2VyOwoJCQkJCgkJCQkJV2lkZ2V0Zmx5LlBhbmVsLmV4dGVuZCA9IFdpZGdldGZseS5Nb2RhbC5leHRlbmQgPSBXaWRnZXRmbHkuUG9wb3Zlci5leHRlbmQgPSBXaWRnZXRmbHkuU2VydmVyLmV4dGVuZCA9IGV4dGVuZDsKCQkJCQoJCQkJCS8vIEluaXRpYWxpemUgZm9yIERPTSBwcmVwYXJlCgkJCQkJLy8gLS0tLS0tLS0tLS0tLQoJCQkJCVdpZGdldGZseS5pbml0ID0gZnVuY3Rpb24oKXsKCQkJCQoJCQkJCQlpZiAoIVdpZGdldGZseS5VdGlscy5pbklmcmFtZSgpKSB7CgkJCQkJCQkvL2NvbnNvbGUubG9nKCdOb3cgaXMgV2lkZ2V0cyBpbml0aWFsaXplJyk7CgkJCQkJCQlXaWRnZXRmbHkuTWVkaWF0b3IuaW5pdCgpOwoJCQkJCgkJCQkJCQlub3dTY3JpcHRzID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdDsKCQkJCQkJCWlmKG5vd1NjcmlwdHMpewoJCQkJCQkJCXBhcnNlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKCQkJCQkJCQlwYXJzZXIuaHJlZiA9IG5vd1NjcmlwdHMuZ2V0QXR0cmlidXRlKCdzcmMnKTsKCQkJCQkJCQlwYXJhbXMgID0gV2lkZ2V0Zmx5LlV0aWxzLnBhcmFtcyhwYXJzZXIuaGFzaCk7CgkJCQkKCQkJCQkJCQlpZiAoIVdpZGdldGZseS5VdGlscy5pc0VtcHR5KHBhcmFtcykpIHsKCQkJCQoJCQkJCQkJCQlpZihwYXJhbXMudHlwZSA9PT0gJ21vZGFsJyl7CgkJCQkJCQkJCQlkZWxldGUgcGFyYW1zLmNvbnRhaW5lcjsKCQkJCQkJCQkJCW5ldyAoV2lkZ2V0Zmx5Lk1vZGFsLmV4dGVuZCh7fSkpKHBhcmFtcyk7CgkJCQkJCQkJCX1lbHNlIGlmKHBhcmFtcy50eXBlID09PSAncG9wb3ZlcicpewoJCQkJCQkJCQkJaWYoIXBhcmFtcy50YXJnZXQpewoJCQkJCQkJCQkJCXBhcmFtcy50YXJnZXQgPSBub3dTY3JpcHRzLnBhcmVudE5vZGU7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQluZXcgKFdpZGdldGZseS5Qb3BvdmVyLmV4dGVuZCh7fSkpKHBhcmFtcyk7CgkJCQkJCQkJCX1lbHNlewoJCQkJCQkJCQkJaWYoIXBhcmFtcy5jb250YWluZXIpewoJCQkJCQkJCQkJCXBhcmFtcy5jb250YWluZXIgPSBub3dTY3JpcHRzLnBhcmVudE5vZGU7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQluZXcgKFdpZGdldGZseS5QYW5lbC5leHRlbmQoe30pKShwYXJhbXMpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCgkJCQkJCQlXaWRnZXRmbHkuU2VydmVyLmdldCA9IGZ1bmN0aW9uKCl7CgkJCQkJCQkJdGhyb3cgJ1dpZGdldGZseS5TZXJ2ZXIgaXMgbm90IHN1cHBvcnRlZCBvdXRzaWRlIGlmcmFtZS4nOwoJCQkJCQkJfTsKCQkJCQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy9jb25zb2xlLmxvZygnTm93IGlzIFNlcnZlciBpbml0aWFsaXplJyk7CgkJCQkJCQkvLyB3aWRnZXQKCQkJCQkJCVdpZGdldGZseS5TZXJ2ZXIuX2RlZmF1bHQgPSBuZXcgV2lkZ2V0Zmx5LlNlcnZlcih7fSk7CgkJCQkJCQlXaWRnZXRmbHkuU2VydmVyLmdldCA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJCXJldHVybiBXaWRnZXRmbHkuU2VydmVyLl9kZWZhdWx0OwoJCQkJCQkJfTsKCQkJCQkJfQoJCQkJCX07CgkJCQkKCQkJCQlXaWRnZXRmbHkuaW5pdCgpOwoJCQkJCgkJCQl9KSh0aGlzKTsKCQkJCQoJCQl9CgkJCgkJCXJldHVybiBXaWRnZXRmbHk7CgkJfSkod2luZG93KTsKCQkKCQlyZXR1cm4gV2lkZ2V0Zmx5Owp9KSk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 02:56:00 GMT",
                    "Content-Length": "51493",
                    "Date": "Sun, 09 Nov 2014 02:56:00 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}