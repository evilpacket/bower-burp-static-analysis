{
    "url": "http://localhost:9999/david-driscoll/thrust/dist/debug/thrust.dom.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>parent.name</b> and written to <b>the 'name' property of a DOM element</b> via the following statement:<ul><li>this.name = parent.name;</li></ul><b>Note:</b> The name of the current window is a valid attack vector for DOM-based vulnerabilities. An attacker can directly control the name of the targeted application's window by using code on their own domain to load the targeted page using either window.open() or an iframe tag, and specifying the desired window name. ",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/david-driscoll/thrust/dist/debug/thrust.dom.js",
                "path": "/david-driscoll/thrust/dist/debug/thrust.dom.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9kYXZpZC1kcmlzY29sbC90aHJ1c3QvZGlzdC9kZWJ1Zy90aHJ1c3QuZG9tLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjY3ODcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFNhdCwgMDggTm92IDIwMTQgMjA6MDU6MjggR01UDQpMYXN0LU1vZGlmaWVkOiBTYXQsIDA4IE5vdiAyMDE0IDIwOjA1OjI3IEdNVA0KDQovKiEgdGhydXN0LWpzIC0gdjAuMS41IC0gMjAxMy0wMS0yNyAqLwpkZWZpbmUoJ3RocnVzdC9kb20vc3VianF1ZXJ5JyxbInJlcXVpcmUiLCAiZXhwb3J0cyIsICdqcXVlcnknLCAndGhydXN0L3V0aWwnLCAndGhydXN0L2xvZycsICdoYXMnXSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgX19qUXVlcnlfXywgX191dGlsX18sIF9fbG9nX18sIF9faGFzX18pIHsKICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uLy4uL2xpYi9EZWZpbml0ZWx5VHlwZWQvcmVxdWlyZWpzL3JlcXVpcmUuZC50cyIgLz4KICAgIC8vIERpc2FibGVkIHVudGlsIFRTIHN1cHBvcnRzIG1vZHVsZSBwZXIgZmlsZSBpbiBzb21lIHdheSAoaWUgZXhwb3J0cyBpcyBleHBvcnRzLjxleHBvcnQ+IG5vdCAgZXhwb3J0cy5tb2R1bGVOYW1lLjxleHBvcnQ+KQogICAgLypleHBvcnQgbW9kdWxlIGluc3RhbmNlIHsqLwogICAgCiAgICB2YXIgalF1ZXJ5ID0gX19qUXVlcnlfXzsKCiAgICB2YXIgdXRpbCA9IF9fdXRpbF9fOwoKICAgIHZhciBfID0gdXRpbC5fOwogICAgdmFyIGxvZyA9IF9fbG9nX187CgogICAgdmFyIGhhcyA9IF9faGFzX187CgogICAgdmFyIGZvcm1hdCA9IHV0aWwuZm9ybWF0LCBlYWNoID0gXy5lYWNoLCBleHRlbmQgPSBfLmV4dGVuZCwgaXNPYmplY3QgPSBfLmlzT2JqZWN0LCBpc0Z1bmN0aW9uID0gXy5pc0Z1bmN0aW9uLCBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwgR0xPQkFMID0gJy5nbG9iYWwnOwogICAgdmFyIGpRdWVyeUZuTWV0aG9kQmxhY2tMaXN0ID0gWwogICAgICAgICdyZWFkeScsIAogICAgICAgICdleHRlbmQnLCAKICAgICAgICAncXVldWUnLCAKICAgICAgICAnZGVxdWV1ZScsIAogICAgICAgICdjbGVhclF1ZXVlJywgCiAgICAgICAgJ3Byb21pc2UnLCAKICAgICAgICAnYmluZCcsIAogICAgICAgICd1bmJpbmQnLCAKICAgICAgICAnbGl2ZScsIAogICAgICAgICdkaWUnLCAKICAgICAgICAnZGVsZWdhdGUnLCAKICAgICAgICAndW5kZWxlZ2F0ZScsIAogICAgICAgICdibHVyJywgCiAgICAgICAgJ2ZvY3VzJywgCiAgICAgICAgJ2ZvY3VzaW4nLCAKICAgICAgICAnZm9jdXNvdXQnLCAKICAgICAgICAnbG9hZCcsIAogICAgICAgICdyZXNpemUnLCAKICAgICAgICAnc2Nyb2xsJywgCiAgICAgICAgJ3VubG9hZCcsIAogICAgICAgICdjbGljaycsIAogICAgICAgICdkYmxjbGljaycsIAogICAgICAgICdtb3VzZWRvd24nLCAKICAgICAgICAnbW91c2V1cCcsIAogICAgICAgICdtb3VzZW1vdmUnLCAKICAgICAgICAnbW91c2VvdmVyJywgCiAgICAgICAgJ21vdXNlb3V0JywgCiAgICAgICAgJ21vdXNlZW50ZXInLCAKICAgICAgICAnbW91c2VsZWF2ZScsIAogICAgICAgICdjaGFuZ2UnLCAKICAgICAgICAnc2VsZWN0JywgCiAgICAgICAgJ3N1Ym1pdCcsIAogICAgICAgICdrZXlkb3duJywgCiAgICAgICAgJ2tleXByZXNzJywgCiAgICAgICAgJ2tleXVwJywgCiAgICAgICAgJ2Vycm9yJywgCiAgICAgICAgJ3NlcmlhbGl6ZScsIAogICAgICAgICdzZXJpYWxpemVBcnJheScsIAogICAgICAgICdhamF4U3RhcnQnLCAKICAgICAgICAnYWpheFN0b3AnLCAKICAgICAgICAnYWpheENvbXBsZXRlJywgCiAgICAgICAgJ2FqYXhFcnJvcicsIAogICAgICAgICdhamF4U3VjY2VzcycsIAogICAgICAgICdhamF4U2VuZCcsIAogICAgICAgICdfdG9nZ2xlJywgCiAgICAgICAgJ2ZhZGVUbycsIAogICAgICAgICdzdG9wJywgCiAgICAgICAgJ3NsaWRlRG93bicsIAogICAgICAgICdzbGlkZVVwJywgCiAgICAgICAgJ3NsaWRlVG9nZ2xlJywgCiAgICAgICAgJ2ZhZGVJbicsIAogICAgICAgICdmYWRlT3V0JywgCiAgICAgICAgJ2ZhZGVUb2dnbGUnLyosICdvbicsICdvZmYnLCAnb25lJyovIAogICAgXTsKICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZUV2ZW50cyhldmVudHMsIG5hbWVzcGFjZSkgewogICAgICAgIGlmKCFuYW1lc3BhY2UpIHsKICAgICAgICAgICAgcmV0dXJuIGV2ZW50czsKICAgICAgICB9CiAgICAgICAgaWYoaXNPYmplY3QoZXZlbnRzKSkgewogICAgICAgICAgICAvLyBDcmVhdGUgbmV3IG9iamVjdCwgc28gdGhhdCBvcmlnaW5hbCBvYmplY3Qgd2lsbCBub3QgYmUgbW9kaWZpZWQgd2hlbiBiaW5kaW5nLgogICAgICAgICAgICBldmVudHMgPSBleHRlbmQoewogICAgICAgICAgICB9LCBldmVudHMpOwogICAgICAgICAgICBmb3IodmFyIGtleSBpbiBldmVudHMpIHsKICAgICAgICAgICAgICAgIGlmKGtleS5pbmRleE9mKCcuJykgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnRzW2tleSArIG5hbWVzcGFjZV0gPSBldmVudHNba2V5XTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgZXZlbnRzW2tleV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGV2ZW50czsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZighZXZlbnRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZXNwYWNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50cy5zcGxpdCgnICcpOwogICAgICAgICAgICBmb3IodmFyIGkgPSAwLCBpTGVuID0gZXZlbnRzLmxlbmd0aDsgaSA8IGlMZW47IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGV2dCA9IGV2ZW50c1tpXTsKICAgICAgICAgICAgICAgIGlmKGV2dC5pbmRleE9mKCcuJykgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnRzW2ldID0gZXZ0ICsgbmFtZXNwYWNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBldmVudHMuam9pbignICcpOwogICAgICAgIH0KICAgIH0KICAgIC8qCiAgICBDbG9uZSBqcXVlcnkKICAgIFJlbW92ZSBhbGwgZXhjZXNzIG1ldGhvZHMgd2UgZG9uJ3Qgd2FudCB0byBleHBvc2UgbmF0aXZlbHkuCiAgICBvdmVycmxvYWQgYW55IG1ldGhvZHMgd2Ugd2FudCB0byBjaGFuZ2UgYmVoYXZpb3Igb2YgKG5vdGVhYmx5IG9uLCBvbmUsIGFuZCBvZmYpCiAgICAKICAgIEluc3RlYWQgb2YgZHVwbGljYXRpbmcgdGhlIGpxdWVyeSBiZWhhdmlvciB3ZSBpbnN0ZWFkIHJlYWxpZ24gaXQgdG8gb3VyIG93bi4KICAgICovCiAgICAvLyBqUXVlcnkgc3ViCiAgICBmdW5jdGlvbiBzdWJKUXVlcnkoKSB7CiAgICAgICAgdmFyIHRRdWVyeSA9IGZ1bmN0aW9uIChzZWxlY3RvciwgY29udGV4dCwgbmFtZXNwYWNlKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgdFF1ZXJ5LnByb3RvdHlwZS5pbml0KHNlbGVjdG9yLCBjb250ZXh0LCBuYW1lc3BhY2UgfHwgKHRoaXMgJiYgdGhpcy5uYW1lc3BhY2UpKTsKICAgICAgICB9OwogICAgICAgIF8ubWVyZ2UodFF1ZXJ5LCBqUXVlcnkpOwogICAgICAgIC8vIERvIG5vdCBsaWtlCiAgICAgICAgLy8gcHJvYmFibHkgbmVlZGVkIGluIHNvbWUgc3BlY2lhbCB1bmlxdWUgY2FzZXMKICAgICAgICB0UXVlcnkualF1ZXJ5ID0galF1ZXJ5OwogICAgICAgIC8vIGV4cG9zZSBldmVudHMgZm9yIGRvaW5nIHNwZWNpYWwgZXZlbnRzIGFzIHJlcXVpcmVkLgogICAgICAgIHRRdWVyeS5ldmVudCA9IChqUXVlcnkpLmV2ZW50OwogICAgICAgIHRRdWVyeS5mbiA9IHRRdWVyeS5wcm90b3R5cGUgPSBleHRlbmQoewogICAgICAgIH0sIGpRdWVyeS5mbik7CiAgICAgICAgdFF1ZXJ5LmZuLmNvbnN0cnVjdG9yID0gdFF1ZXJ5OwogICAgICAgIHRRdWVyeS5mbi5pbml0ID0gZnVuY3Rpb24gaW5pdChzZWxlY3RvciwgY29udGV4dCwgbmFtZXNwYWNlKSB7CiAgICAgICAgICAgIHZhciBpb0RvbSA9IGNvbnRleHQgaW5zdGFuY2VvZiB0UXVlcnk7CiAgICAgICAgICAgIGlmKGNvbnRleHQgJiYgY29udGV4dCBpbnN0YW5jZW9mIGpRdWVyeSAmJiAhKGlvRG9tKSkgewogICAgICAgICAgICAgICAgY29udGV4dCA9IHRRdWVyeShjb250ZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmVzdWx0ID0galF1ZXJ5LmZuLmluaXQuY2FsbCh0aGlzLCBzZWxlY3RvciwgY29udGV4dCwgdFF1ZXJ5Um9vdCk7CiAgICAgICAgICAgIGlmKG5hbWVzcGFjZSkgewogICAgICAgICAgICAgICAgcmVzdWx0Lm5hbWVzcGFjZSA9IG5hbWVzcGFjZTsKICAgICAgICAgICAgfSBlbHNlIGlmKGlvRG9tKSB7CiAgICAgICAgICAgICAgICByZXN1bHQubmFtZXNwYWNlID0gY29udGV4dC5uYW1lc3BhY2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9OwogICAgICAgIHRRdWVyeS5mbi5pbml0LnByb3RvdHlwZSA9IHRRdWVyeS5mbjsKICAgICAgICB2YXIgdFF1ZXJ5Um9vdCA9IHRRdWVyeShkb2N1bWVudCk7CiAgICAgICAgLy8gcmVtb3ZlIGFsbCBub3QgYXBwbGljYWJsZSBtZXRob2RzIG9mZiBvZiBmbi4KICAgICAgICBlYWNoKGpRdWVyeUZuTWV0aG9kQmxhY2tMaXN0LCBmdW5jdGlvbiAoeCkgewogICAgICAgICAgICBpZih0UXVlcnkuZm5beF0pIHsKICAgICAgICAgICAgICAgIHRRdWVyeS5mblt4XSA9IG51bGw7CiAgICAgICAgICAgICAgICBkZWxldGUgdFF1ZXJ5LmZuW3hdOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgXy5lYWNoKFsKICAgICAgICAgICAgJ29uJywgCiAgICAgICAgICAgICdvbmUnLCAKICAgICAgICAgICAgJ29mZicKICAgICAgICBdLCBmdW5jdGlvbiAoeCkgewogICAgICAgICAgICB0UXVlcnkuZm5beF0gPSBfLndyYXAodFF1ZXJ5LmZuW3hdLCBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCAoYXJndW1lbnRzLmxlbmd0aCAtIDEpOyBfaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2kgKyAxXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRydWUgJiYgbG9nLmRlYnVnKGZvcm1hdCgndFF1ZXJ5W3swfV06IEJpbmRpbmcgJyArIHggKyAnIGV2ZW50cy4uLicsIHRoaXMubmFtZXNwYWNlKSk7CiAgICAgICAgICAgICAgICBhcmdzWzBdID0gbm9ybWFsaXplRXZlbnRzKGFyZ3NbMF0sIHRoaXMubmFtZXNwYWNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBmLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICB0UXVlcnkuZm4ucXVlcnkgPSB0UXVlcnkuZm4uJCA9IHRRdWVyeS5mbi5maW5kOwogICAgICAgIHJldHVybiB0UXVlcnk7CiAgICB9CiAgICBleHBvcnRzLnRRdWVyeSA9IHN1YkpRdWVyeSgpOwp9KQovL0Agc291cmNlTWFwcGluZ1VSTD1zdWJqcXVlcnkuanMubWFwCjsKZGVmaW5lKCd0aHJ1c3QvZG9tL2NvbmZpZycsWyJyZXF1aXJlIiwgImV4cG9ydHMiXSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cykgewogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vLi4vbGliL0RlZmluaXRlbHlUeXBlZC9yZXF1aXJlanMvcmVxdWlyZS5kLnRzIiAvPgogICAgLy8gRGlzYWJsZWQgdW50aWwgVFMgc3VwcG9ydHMgbW9kdWxlIHBlciBmaWxlIGluIHNvbWUgd2F5IChpZSBleHBvcnRzIGlzIGV4cG9ydHMuPGV4cG9ydD4gbm90ICBleHBvcnRzLm1vZHVsZU5hbWUuPGV4cG9ydD4pCiAgICAvKmV4cG9ydCBtb2R1bGUgaW5zdGFuY2UgeyovCiAgICAKICAgIC8qKgogICAgUmVzb2x2ZXMgdGhlIGdpdmVuIHByb3BlcnRpZXMgd2hlbiBjcmVhdGluZyBhbiBpbnN0YW5jZSBvZiB0aGUgcGx1Z2luLgogICAgCiAgICBUaGlzIGlzIGZvciBpbnRlcm5hbCB0aHJ1c3QgdXNlLiAgVGhydXN0IHVzZXMgdGhpcyBhcnJheSB0byBnZW5lcmF0ZSB0aGUgcHJvcGVydGllcyB0aGF0IG5lZWQgdG8gYmUgaGFuZGVkCiAgICB0byB0aGUgcGx1Z2luIGNvbnN0cnVjdG9yIG1ldGhvZC4KICAgIAogICAgQGZvciB0aHJ1c3QuZG9tLmNvbmZpZwogICAgQHByaXZhdGUKICAgIEBwcm9wZXJ0eSByZXNvbHZlCiAgICBAcmVhZE9ubHkKICAgIEB0eXBlIHtBcnJheX0KICAgICoqLwogICAgZXhwb3J0cy5yZXNvbHZlID0gWwogICAgICAgICduYW1lJywgCiAgICAgICAgJ21lZGlhdG9yJwogICAgXTsKICAgIC8qKgogICAgVGhlIHNldCBvZiBjb252ZW50aW9ucyB0byBsb2FkIGludG8gdGhydXN0L2RvbS4KICAgIAogICAgQHByb3BlcnR5IGNvbnZlbnRpb25zCiAgICBAcmVhZE9ubHkKICAgIEB0eXBlIHtBcnJheX0KICAgICoqLwogICAgZXhwb3J0cy5jb252ZW50aW9ucyA9IFsKICAgICAgICAndGhydXN0L2RvbS9jb252ZW50aW9uL2FjdGlvbicsIAogICAgICAgICd0aHJ1c3QvZG9tL2NvbnZlbnRpb24vY29udGV4dCcsIAogICAgICAgICd0aHJ1c3QvZG9tL2NvbnZlbnRpb24vZXZlbnQnCiAgICBdOwp9KQovL0Agc291cmNlTWFwcGluZ1VSTD1jb25maWcuanMubWFwCjsKZGVmaW5lKCd0aHJ1c3QvZG9tL21haW4nLFsicmVxdWlyZSIsICJleHBvcnRzIiwgJy4vc3VianF1ZXJ5JywgJ3RocnVzdC91dGlsJywgJ3RocnVzdC9sb2cnLCAndGhydXN0L2ZhY2FkZScsICdoYXMnLCAndGhydXN0L2luc3RhbmNlJywgJy4vY29uZmlnJ10sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIF9fc3VianF1ZXJ5X18sIF9fdXRpbF9fLCBfX2xvZ19fLCBfX2ZhY2FkZV9fLCBfX2hhc19fLCBfX2luc3RhbmNlX18sIF9fY29uZmlnX18pIHsKICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uL2ludGVyZmFjZXMvZG9tL2RvbS5kLnRzIiAvPgogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vLi4vbGliL0RlZmluaXRlbHlUeXBlZC9yZXF1aXJlanMvcmVxdWlyZS5kLnRzIiAvPgogICAgLy8gRGlzYWJsZWQgdW50aWwgVFMgc3VwcG9ydHMgbW9kdWxlIHBlciBmaWxlIGluIHNvbWUgd2F5IChpZSBleHBvcnRzIGlzIGV4cG9ydHMuPGV4cG9ydD4gbm90ICBleHBvcnRzLm1vZHVsZU5hbWUuPGV4cG9ydD4pCiAgICAvKmV4cG9ydCBtb2R1bGUgaW5zdGFuY2UgeyovCiAgICAKICAgIHZhciBzdWJqcXVlcnkgPSBfX3N1YmpxdWVyeV9fOwoKICAgIHZhciB0UXVlcnkgPSBzdWJqcXVlcnkudFF1ZXJ5OwogICAgdmFyIHV0aWwgPSBfX3V0aWxfXzsKCiAgICB2YXIgXyA9IHV0aWwuXzsKICAgIHZhciBsb2cgPSBfX2xvZ19fOwoKICAgIHZhciBmYWNhZGUgPSBfX2ZhY2FkZV9fOwoKICAgIHZhciBoYXMgPSBfX2hhc19fOwoKICAgIHZhciBpbnN0YW5jZSA9IF9faW5zdGFuY2VfXzsKCiAgICB2YXIgY29uZmlnID0gX19jb25maWdfXzsKCiAgICBleHBvcnRzLmNsYXNzTmFtZSA9ICdEb20nOwogICAgdmFyIGZvcm1hdCA9IHV0aWwuZm9ybWF0LCBleHRlbmQgPSBfLmV4dGVuZCwgYmluZCA9IF8uYmluZCwgaGFzT3duID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwgaXNPYmplY3QgPSBfLmlzT2JqZWN0LCBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwgd2hlbiA9IHV0aWwud2hlbiwgaXNBcnJheSA9IF8uaXNBcnJheTsKICAgIC8vI3JlZ2lvbiBEb21GYWNhZGUKICAgIHZhciBEb21GYWNhZGUgPSAoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkb21GYWNhZGUgPSBmYWNhZGUuY3JlYXRlRmFjYWRlKGZ1bmN0aW9uIChtb2QsIHBhcmVudCkgewogICAgICAgICAgICB0aGlzLm5hbWUgPSBwYXJlbnQubmFtZTsKICAgICAgICAgICAgdGhpcy5fX2NvbnZlbnRpb25zID0gcGFyZW50Ll9fY29udmVudGlvbnM7CiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IHRRdWVyeShkb2N1bWVudCwgdW5kZWZpbmVkLCB0aGlzLm5hbWUpOwogICAgICAgIH0pOwogICAgICAgIGRvbUZhY2FkZS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChmYWtlKSB7CiAgICAgICAgICAgIHRoaXMuX2ludGVybmFsRXZlbnRzID0gdGhpcy5faW50ZXJuYWxFdmVudHMgfHwgW107CiAgICAgICAgICAgIHRydWUgJiYgbG9nLmRlYnVnKGZvcm1hdCgnRG9tW3swfV06IEluaXRhbGl6aW5nIHsxfURvbSBmYWNhZGUnLCB0aGlzLm5hbWUsIGZha2UgPyAnZmFrZSAnIDogJycpKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKICAgICAgICBkb21GYWNhZGUucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgdHJ1ZSAmJiBsb2cuZGVidWcoZm9ybWF0KCdEb21bezB9XTogU3RhcnRpbmcgRG9tIGZhY2FkZScsIHRoaXMubmFtZSkpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwogICAgICAgIGRvbUZhY2FkZS5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgIHRydWUgJiYgbG9nLmRlYnVnKGZvcm1hdCgnRG9tW3swfV06IFN0b3BwaW5nIERvbSBmYWNhZGUnLCB0aGlzLm5hbWUpKTsKICAgICAgICAgICAgZm9yKHZhciBpID0gdGhpcy5faW50ZXJuYWxFdmVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIHZhciBzdWIgPSB0aGlzLl9pbnRlcm5hbEV2ZW50c1tpXTsKICAgICAgICAgICAgICAgIHRoaXMuX2ludGVybmFsRXZlbnRzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgIHN1Yi5jb250ZXh0Lm9mZi5hcHBseSh0aGlzLCAoaXNBcnJheShzdWIpKSA/IHN1YiA6IChpc0FycmF5KHN1Yi5hcmdzKSkgPyBzdWIuYXJncyA6IFtdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwogICAgICAgIGRvbUZhY2FkZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgIHRydWUgJiYgbG9nLmRlYnVnKGZvcm1hdCgnRG9tW3swfV06IERlc3Ryb3lpbmcgRG9tIGZhY2FkZScsIHRoaXMubmFtZSkpOwogICAgICAgICAgICBkZWxldGUgdGhpcy5faW50ZXJuYWxFdmVudHM7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGRvbUZhY2FkZTsKICAgIH0pKCk7CiAgICAvLyNlbmRyZWdpb24KICAgIC8vI3JlZ2lvbiBEb20KICAgIHZhciBEb20gPSAoZnVuY3Rpb24gKCkgewogICAgICAgIC8vI2VuZHJlZ2lvbgogICAgICAgIGZ1bmN0aW9uIERvbShuYW1lLCBtZWRpYXRvcikgewogICAgICAgICAgICBpZighbmFtZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb206IG1vZHVsZSBuYW1lIG11c3QgYmUgZGVmaW5lZC4nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnVlICYmIGxvZy5kZWJ1ZygnRGF0YTogQ3JlYXRpbmcgbmV3IERhdGEnKTsKICAgICAgICAgICAgdGhpcy5tZWRpYXRvciA9IG1lZGlhdG9yOwogICAgICAgICAgICB0aGlzLl9jYWxsYmFja3MgPSAobWVkaWF0b3IpLl9jYWxsYmFja3M7CiAgICAgICAgICAgIHRoaXMuaW5pdEV2ZW50cygpOwogICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgIGluc3RhbmNlLmZldGNoSW5zdGFuY2UobmFtZSkucHJvbWlzZS50aGVuKGZ1bmN0aW9uICh0aHJ1c3QpIHsKICAgICAgICAgICAgICAgIHZhciBtb2QgPSB7CiAgICAgICAgICAgICAgICB9LCBmYWNhZGUgPSB0aGF0LmNyZWF0ZUZhY2FkZSh0aHJ1c3QsIG1vZCwgewogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgRG9tLnByb3RvdHlwZS5pbml0RXZlbnRzID0gLy8jcmVnaW9uIEV2ZW50cwogICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICB9OwogICAgICAgIERvbS5wcm90b3R5cGUuZXh0ZW5kID0gZnVuY3Rpb24gKHRvLCBpbml0KSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH07CiAgICAgICAgRG9tLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoZXZlbnRzLCBjYWxsYmFjaywgY29udGV4dCwgb25jZSkgewogICAgICAgIH07CiAgICAgICAgRG9tLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIChldmVudHMsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICAgICAgfTsKICAgICAgICBEb20ucHJvdG90eXBlLm9uY2UgPSBmdW5jdGlvbiAoZXZlbnRzLCBjYWxsYmFjaywgY29udGV4dCkgewogICAgICAgIH07CiAgICAgICAgRG9tLmNvbmZpZyA9IGNvbmZpZzsKICAgICAgICBEb20ucHJvdG90eXBlLmNyZWF0ZUZhY2FkZSA9IGZ1bmN0aW9uICh0aHJ1c3QsIG1vZCwgZmFjYWRlcykgewogICAgICAgICAgICBpZihmYWNhZGVzLmRvbSAmJiAhKGZhY2FkZXMuZG9tIGluc3RhbmNlb2YgRG9tRmFjYWRlKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCciZG9tIiBpcyBhIHJlc2VydmVkIHByb3BlcnR5Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGRvbTsKICAgICAgICAgICAgaWYoZmFjYWRlcy5kb20pIHsKICAgICAgICAgICAgICAgIGZhY2FkZXMuZG9tLnVwZGF0ZUZhY2FkZShtb2QsIHRoaXMpOwogICAgICAgICAgICAgICAgZG9tID0gZmFjYWRlcy5kb207CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkb20gPSBmYWNhZGVzLmRvbSA9IG5ldyBEb21GYWNhZGUobW9kLCB0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZG9tOwogICAgICAgIH07CiAgICAgICAgcmV0dXJuIERvbTsKICAgIH0pKCk7CiAgICBleHBvcnRzLkRvbSA9IERvbTsgICAgCiAgICAvLyNlbmRyZWdpb24KICAgIH0pCi8vQCBzb3VyY2VNYXBwaW5nVVJMPW1haW4uanMubWFwCjsKZGVmaW5lKCd0aHJ1c3QvZG9tJywgWyd0aHJ1c3QvZG9tL21haW4nXSwgZnVuY3Rpb24gKG1haW4pIHsgcmV0dXJuIG1haW47IH0pOwoKZGVmaW5lKCd0aHJ1c3QvZG9tL2NvbnZlbnRpb24vYWN0aW9uJyxbInJlcXVpcmUiLCAiZXhwb3J0cyIsICd0aHJ1c3QvY29udmVudGlvbicsICd0aHJ1c3QvdXRpbCcsICcuLi9zdWJqcXVlcnknXSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgX19jX18sIF9fdXRpbF9fLCBfX3N1YmpxdWVyeV9fKSB7CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL2RvbS9jb252ZW50aW9uL2FjdGlvbi5kLnRzIiAvPgogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vaW50ZXJmYWNlcy9kb20vZG9tLmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL3RocnVzdC5kLnRzIiAvPgogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vLi4vLi4vbGliL0RlZmluaXRlbHlUeXBlZC9yZXF1aXJlanMvcmVxdWlyZS5kLnRzIiAvPgogICAgLy8gRGlzYWJsZWQgdW50aWwgVFMgc3VwcG9ydHMgbW9kdWxlIHBlciBmaWxlIGluIHNvbWUgd2F5IChpZSBleHBvcnRzIGlzIGV4cG9ydHMuPGV4cG9ydD4gbm90ICBleHBvcnRzLm1vZHVsZU5hbWUuPGV4cG9ydD4pCiAgICAvKmV4cG9ydCBtb2R1bGUgaW5zdGFuY2UgeyovCiAgICAKICAgIHZhciBjID0gX19jX187CgogICAgdmFyIENvbnZlbnRpb24gPSBjLkNvbnZlbnRpb247CiAgICB2YXIgdXRpbCA9IF9fdXRpbF9fOwoKICAgIHZhciBfID0gdXRpbC5fOwogICAgdmFyIHN1YmpxdWVyeSA9IF9fc3VianF1ZXJ5X187CgogICAgdmFyICQgPSBzdWJqcXVlcnkudFF1ZXJ5OwogICAgdmFyIGZvcm1hdCA9IHV0aWwuZm9ybWF0LCBBQ1RJT05TID0gJ2NvbmZpZy5kb20uYWN0aW9ucycsIEFDVElPTlNTSU5HTEUgPSAnYWN0aW9ucycsIFNUUklORyA9ICdzdHJpbmcnLCBSRUdJU1RSQVRJT05TID0gJ19yZWdpc3RyYXRpb25zJywgaXNGdW5jdGlvbiA9IF8uaXNGdW5jdGlvbiwgaXNTdHJpbmcgPSBfLmlzU3RyaW5nLCBpc0FycmF5ID0gXy5pc0FycmF5OwogICAgdmFyIGdldEFjdGlvbkF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChldmVudE5hbWUpIHsKICAgICAgICByZXR1cm4gJ2RhdGEtYWN0aW9uLScgKyBldmVudE5hbWU7CiAgICB9OwogICAgdmFyIEFjdGlvbkhhbmRsZXIgPSAoZnVuY3Rpb24gKCkgewogICAgICAgIGZ1bmN0aW9uIEFjdGlvbkhhbmRsZXIoKSB7CiAgICAgICAgICAgIHRoaXMuZXZlbnRzID0gewogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBBY3Rpb25IYW5kbGVyLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGFjdGlvbk5hbWUsIGFjdGlvbikgewogICAgICAgICAgICB2YXIgZXZlbnRzID0gdGhpcy5ldmVudHM7CiAgICAgICAgICAgIGlmKCFldmVudHNbZXZlbnROYW1lXSkgewogICAgICAgICAgICAgICAgZXZlbnRzW2V2ZW50TmFtZV0gPSB7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCFldmVudHNbZXZlbnROYW1lXVthY3Rpb25OYW1lXSkgewogICAgICAgICAgICAgICAgZXZlbnRzW2V2ZW50TmFtZV1bYWN0aW9uTmFtZV0gPSBhY3Rpb247CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KCdUaGUgYWN0aW9uIHsxfSBoYW5kbGVyICJ7MH0iIGhhcyBhbHJlYWR5IGJlZW4gdGFrZW4hJywgYWN0aW9uTmFtZSwgZXZlbnROYW1lKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIEFjdGlvbkhhbmRsZXIucHJvdG90eXBlLnVucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBhY3Rpb25OYW1lKSB7CiAgICAgICAgICAgIHZhciBldmVudHMgPSB0aGlzLmV2ZW50czsKICAgICAgICAgICAgaWYoZXZlbnRzW2V2ZW50TmFtZV0gJiYgZXZlbnRzW2V2ZW50TmFtZV1bYWN0aW9uTmFtZV0pIHsKICAgICAgICAgICAgICAgIGV2ZW50c1tldmVudE5hbWVdW2FjdGlvbk5hbWVdID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgQWN0aW9uSGFuZGxlci5wcm90b3R5cGUuY2FsbGJhY2tGb3IgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCByZXR1cm5SZXN1bHRzKSB7CiAgICAgICAgICAgIHZhciBldmVudHMgPSB0aGlzLmV2ZW50cywgYWN0aW9uQXR0cmlidXRlID0gZ2V0QWN0aW9uQXR0cmlidXRlKGV2ZW50TmFtZSksIHJldHVyblJlc3VsdHNEZWZpbmVkID0gdHlwZW9mIHJldHVyblJlc3VsdHMgIT09ICd1bmRlZmluZWQnOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZVZhbHVlID0gJCh0aGlzKS5hdHRyKGFjdGlvbkF0dHJpYnV0ZSk7CiAgICAgICAgICAgICAgICBpZih0eXBlb2YgYXR0cmlidXRlVmFsdWUgPT09IFNUUklORykgewogICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSBldmVudHNbZXZlbnROYW1lXVthdHRyaWJ1dGVWYWx1ZV07CiAgICAgICAgICAgICAgICAgICAgaWYoYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbi5oYW5kbGVyLmFwcGx5KGFjdGlvbi5jb250ZXh0IHx8IHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKHJldHVyblJlc3VsdHNEZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5SZXN1bHRzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgICBBY3Rpb25IYW5kbGVyLmFjdGlvbkhhbmRsZXJzID0gewogICAgICAgIH07CiAgICAgICAgQWN0aW9uSGFuZGxlci5nZXRGb3IgPSBmdW5jdGlvbiBnZXRGb3IobmFtZSkgewogICAgICAgICAgICBpZih0aGlzLmFjdGlvbkhhbmRsZXJzW25hbWVdKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25IYW5kbGVyc1tuYW1lXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKHRoaXMuYWN0aW9uSGFuZGxlcnNbbmFtZV0gPSBuZXcgQWN0aW9uSGFuZGxlcigpKTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBBY3Rpb25IYW5kbGVyOwogICAgfSkoKTsgICAgCiAgICB2YXIgZXZlbnRzID0gewogICAgICAgIGNsaWNrOiBbCiAgICAgICAgICAgICdhJywgCiAgICAgICAgICAgICdidXR0b24nLCAKICAgICAgICAgICAgJ2lucHV0W3R5cGU9ImJ1dHRvbiJdJywgCiAgICAgICAgICAgICdpbnB1dFt0eXBlPSJzdWJtaXQiXScKICAgICAgICBdLAogICAgICAgIGRibGNsaWNrOiBbCiAgICAgICAgICAgICdhJywgCiAgICAgICAgICAgICdidXR0b24nLCAKICAgICAgICAgICAgJ2lucHV0W3R5cGU9ImJ1dHRvbiJdJywgCiAgICAgICAgICAgICdpbnB1dFt0eXBlPSJzdWJtaXQiXScKICAgICAgICBdLAogICAgICAgIG1vdXNlZW50ZXI6IFsKICAgICAgICAgICAgJycKICAgICAgICBdLAogICAgICAgIG1vdXNlbGVhdmU6IFsKICAgICAgICAgICAgJycKICAgICAgICBdLAogICAgICAgIGZvY3VzOiBbCiAgICAgICAgICAgICdpbnB1dCcKICAgICAgICBdLAogICAgICAgIGJsdXI6IFsKICAgICAgICAgICAgJ2lucHV0JwogICAgICAgIF0KICAgIH07CiAgICB2YXIgYXJyYXlTaG9ydEhhbmRBcmdzSW5PcmRlciA9IFsKICAgICAgICAnbmFtZScsIAogICAgICAgICdoYW5kbGVyJywgCiAgICAgICAgJ2NvbnRleHQnCiAgICBdOwogICAgdmFyIG1ldGhvZHMgPSB7CiAgICAgICAgcHJvcGVydGllczogWwogICAgICAgICAgICBBQ1RJT05TCiAgICAgICAgXSwKICAgICAgICBpZ25pdGU6IGZ1bmN0aW9uICh0aHJ1c3QpIHsKICAgICAgICAgICAgdmFyIGFjdGlvbkhhbmRsZXIgPSBBY3Rpb25IYW5kbGVyLmdldEZvcih0aHJ1c3QubmFtZSk7CiAgICAgICAgICAgIHRocnVzdC5kb20uYWN0aW9uSGFuZGxlciA9IGFjdGlvbkhhbmRsZXI7CiAgICAgICAgICAgIHZhciAkYm9keSA9ICQod2luZG93LmRvY3VtZW50LmJvZHkpOwogICAgICAgICAgICBfLmVhY2goZXZlbnRzLCBmdW5jdGlvbiAoZXZlbnRTZWxlY3RvcnMsIGV2ZW50TmFtZSkgewogICAgICAgICAgICAgICAgLy8gdXNpbmcgdGhydXN0IG5hbWUsIGFzIGNhbGxiYWNrIG5lZWRzIHRvIGJlIHBlciB0aHJ1c3QgaW5zdGFuY2UKICAgICAgICAgICAgICAgIC8vIGluIHRoZSBldmVudCBvZiBtdWx0aXBsZSB0aHJ1c3QgaW5zdGFuY2VzLgogICAgICAgICAgICAgICAgJGJvZHkub24oZXZlbnROYW1lICsgJy4nICsgQUNUSU9OU1NJTkdMRSArIHRocnVzdC5uYW1lLCBldmVudFNlbGVjdG9ycy5qb2luKGdldEFjdGlvbkF0dHJpYnV0ZShldmVudE5hbWUpICsgJywgJyksIGFjdGlvbkhhbmRsZXIuY2FsbGJhY2tGb3IoZXZlbnROYW1lLCB0cnVlKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZGVvcmJpdDogZnVuY3Rpb24gKHRocnVzdCkgewogICAgICAgICAgICB2YXIgYWN0aW9uSGFuZGxlciA9IEFjdGlvbkhhbmRsZXIuZ2V0Rm9yKHRocnVzdC5uYW1lKTsKICAgICAgICAgICAgdmFyICRib2R5ID0gJCh3aW5kb3cuZG9jdW1lbnQuYm9keSk7CiAgICAgICAgICAgIF8uZWFjaChldmVudHMsIGZ1bmN0aW9uIChldmVudFNlbGVjdG9ycywgZXZlbnROYW1lKSB7CiAgICAgICAgICAgICAgICAkYm9keS5vZmYoJy4nICsgQUNUSU9OU1NJTkdMRSArIHRocnVzdC5uYW1lKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICByZWFkeTogZnVuY3Rpb24gKG1vZCwgZmFjYWRlKSB7CiAgICAgICAgICAgIHZhciBhY3Rpb25zID0gbW9kLmNvbnZlbnRpb24oQUNUSU9OUyksIGFjdGlvbkhhbmRsZXIgPSBBY3Rpb25IYW5kbGVyLmdldEZvcihtb2QudGhydXN0Lm5hbWUpLCBkb20gPSBmYWNhZGUsIG1vZHVsZUluc3RhbmNlID0gbW9kLmluc3RhbmNlOwogICAgICAgICAgICBpZihhY3Rpb25zKSB7CiAgICAgICAgICAgICAgICBfLmZvck93bihhY3Rpb25zLCBmdW5jdGlvbiAoYWN0aW9uQ29sbGVjdGlvbiwgZXZlbnROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoIWlzQXJyYXkoYWN0aW9uQ29sbGVjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQ29sbGVjdGlvbiA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkNvbGxlY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoYWN0aW9uQ29sbGVjdGlvbi5sZW5ndGggJiYgKCFpc0FycmF5KGFjdGlvbkNvbGxlY3Rpb25bMF0pIHx8IGlzU3RyaW5nKGFjdGlvbkNvbGxlY3Rpb25bMF0pKSkgewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25Db2xsZWN0aW9uID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQ29sbGVjdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfLmVhY2goYWN0aW9uQ29sbGVjdGlvbiwgZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBpZihpc0FycmF5KGFjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdBY3Rpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKGFycmF5U2hvcnRIYW5kQXJnc0luT3JkZXIsIGZ1bmN0aW9uICh4LCBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoeCA9PT0gJ2hhbmRsZXInICYmIGlzU3RyaW5nKGFjdGlvbltpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uW2ldID0gbW9kLmluc3RhbmNlW2FjdGlvbltpXV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0FjdGlvblt4XSA9IGFjdGlvbltpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gbmV3QWN0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25OYW1lID0gYWN0aW9uLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFhY3Rpb24uaGFuZGxlciAmJiBhY3Rpb24ubW9kdWxlSGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uLmhhbmRsZXIgPSBtb2QuaW5zdGFuY2VbYWN0aW9uLm1vZHVsZUhhbmRsZXJdOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIWFjdGlvbi5oYW5kbGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ011c3QgZGVmaW5lIGVpdGhlciBhIGhhbmRsZXIgb3IgbW9kdWxlIGhhbmRsZXIuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGFuZGxlci5yZWdpc3RlcihldmVudE5hbWUsIGFjdGlvbk5hbWUsIGFjdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RvcDogZnVuY3Rpb24gKG1vZCwgZmFjYWRlKSB7CiAgICAgICAgICAgIHZhciBhY3Rpb25zID0gbW9kLmNvbnZlbnRpb24oQUNUSU9OUyksIGFjdGlvbkhhbmRsZXIgPSBBY3Rpb25IYW5kbGVyLmdldEZvcihtb2QudGhydXN0Lm5hbWUpLCBtb2R1bGVJbnN0YW5jZSA9IG1vZC5pbnN0YW5jZTsKICAgICAgICAgICAgaWYoYWN0aW9ucykgewogICAgICAgICAgICAgICAgZm9yKHZhciBhY3Rpb25FdmVudCBpbiBhY3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbkNvbGxlY3Rpb24gPSBhY3Rpb25zW2FjdGlvbkV2ZW50XTsKICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGFjdGlvbk5hbWUgaW4gYWN0aW9uQ29sbGVjdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25IYW5kbGVyLnVucmVnaXN0ZXIoYWN0aW9uRXZlbnQsIGFjdGlvbk5hbWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBleHBvcnRzLmFjdGlvbiA9IG5ldyBDb252ZW50aW9uKG1ldGhvZHMpOwp9KQovL0Agc291cmNlTWFwcGluZ1VSTD1hY3Rpb24uanMubWFwCjsKZGVmaW5lKCd0aHJ1c3QvZG9tL2NvbnZlbnRpb24vYW5pbWF0ZS5jb250YWluZXInLFsicmVxdWlyZSIsICJleHBvcnRzIiwgJ3RocnVzdC9jb252ZW50aW9uJywgJ3RocnVzdC91dGlsJ10sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIF9fY19fLCBfX3V0aWxfXykgewogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vaW50ZXJmYWNlcy9kb20vY29udmVudGlvbi9jb250ZXh0LmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL2RvbS9kb20uZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvbWVkaWF0b3IvbWVkaWF0b3IuZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvdGhydXN0LmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi8uLi8uLi9saWIvRGVmaW5pdGVseVR5cGVkL3JlcXVpcmVqcy9yZXF1aXJlLmQudHMiIC8+CiAgICAvLyBEaXNhYmxlZCB1bnRpbCBUUyBzdXBwb3J0cyBtb2R1bGUgcGVyIGZpbGUgaW4gc29tZSB3YXkgKGllIGV4cG9ydHMgaXMgZXhwb3J0cy48ZXhwb3J0PiBub3QgIGV4cG9ydHMubW9kdWxlTmFtZS48ZXhwb3J0PikKICAgIC8qZXhwb3J0IG1vZHVsZSBpbnN0YW5jZSB7Ki8KICAgIAogICAgdmFyIGMgPSBfX2NfXzsKCiAgICB2YXIgQ29udmVudGlvbiA9IGMuQ29udmVudGlvbjsKICAgIHZhciB1dGlsID0gX191dGlsX187CgogICAgdmFyIF8gPSB1dGlsLl87CiAgICB2YXIgZXZlbnQgPSB7CiAgICAgICAgYW55Q29udGFpbmVyOiAndGhydXN0LWNvbnZlbnRpb24tY29udGFpbmVyLWFueScsCiAgICAgICAgY2hhbmdlQ29udGFpbmVyOiAndGhydXN0LWNvbnZlbnRpb24tY29udGFpbmVyLWNoYW5nZScKICAgIH0sIGFueSA9IF8uYW55LCBkZWZlciA9IF8uZGVmZXIsIGJpbmQgPSBfLmJpbmQsIFNUQVJUID0gJ3N0YXJ0LXN0YXR1cycsIEFOSU1BVEUgPSAnYW5pbWF0ZScsIENPTlRBSU5FUiA9ICdjb250YWluZXInLCBDT05URVhUID0gJ2NvbnRleHQnOwogICAgdmFyIG1ldGhvZHMgPSB7CiAgICAgICAgcHJvcGVydGllczogWwogICAgICAgICAgICBBTklNQVRFCiAgICAgICAgXSwKICAgICAgICBpbml0OiBmdW5jdGlvbiAobW9kLCBmYWNhZGUpIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBtZWRpYXRvciA9IG1vZC5pbnN0YW5jZS5tZWRpYXRvcjsKICAgICAgICAgICAgbWVkaWF0b3Iuc3Vic2NyaWJlKGV2ZW50LmNoYW5nZUNvbnRhaW5lciwgYmluZCh0aGF0LmNoYW5nZSwgdGhhdCwgbW9kKSk7CiAgICAgICAgfSwKICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIChtb2R1bGUsIGNvbnRhaW5lcikgewogICAgICAgICAgICBpZihtb2R1bGUuY29udmVudGlvbihDT05UQUlORVIpID09PSBjb250YWluZXIpIHsKICAgICAgICAgICAgICAgIGlmKG1vZHVsZS5jb252ZW50aW9uKFNUQVJUKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBhbmltYXRlID0gbW9kdWxlLmNvbnZlbnRpb24oQU5JTUFURSk7CiAgICAgICAgICAgICAgICAgICAgaWYoYW5pbWF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGV4dE5vZGUgPSBtb2R1bGUuaW5zdGFuY2UuZG9tKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHROb2RlLnJlbW92ZUNsYXNzKGFuaW1hdGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVhZHk6IGZ1bmN0aW9uIChtb2QsIGZhY2FkZSkgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGFuaW1hdGUgPSBtb2QuY29udmVudGlvbihBTklNQVRFKSwgY29udGFpbmVyID0gbW9kLmNvbnZlbnRpb24oQ09OVEFJTkVSKSwgY29udGV4dCA9IG1vZC5jb252ZW50aW9uKENPTlRFWFQpLCBkb20gPSBmYWNhZGU7CiAgICAgICAgICAgIGlmKGFuaW1hdGUgJiYgY29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICB2YXIgY2xvbmUgPSBkb20uY29udGV4dC5jbG9uZSgpLmFwcGVuZFRvKGRvbS5jb250ZXh0LnBhcmVudCgpKTsKICAgICAgICAgICAgICAgIGNsb25lLmFkZENsYXNzKGFuaW1hdGUucmVwbGFjZSgvXC4vZywgJyAnKS50cmltKCkpOwogICAgICAgICAgICAgICAgbW9kLmluc3RhbmNlLmRvbSA9IG1vZC5pbnN0YW5jZS4kID0gY2xvbmU7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGJpbmQodGhhdC5jbGVhbnVwLCB0aGF0LCBkb20uY29udGV4dC5wYXJlbnQoKSwgYW5pbWF0ZSwgY29udGV4dCksIDIwMDApOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjbGVhbnVwOiBmdW5jdGlvbiAoY29udGFpbmVyLCBhbmltYXRlLCBjb250ZXh0KSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKGNvbnRleHQpLmZpbHRlcignOm5vdCgnICsgYW5pbWF0ZSArICcpJykucmVtb3ZlKCk7CiAgICAgICAgfQogICAgfTsKICAgIGV4cG9ydHMuYW5pbWF0ZUNvbnRhaW5lciA9IG5ldyBDb252ZW50aW9uKG1ldGhvZHMpOwp9KQovL0Agc291cmNlTWFwcGluZ1VSTD1hbmltYXRlLmNvbnRhaW5lci5qcy5tYXAKOwpkZWZpbmUoJ3RocnVzdC9kb20vY29udmVudGlvbi9jb250ZXh0JyxbInJlcXVpcmUiLCAiZXhwb3J0cyIsICd0aHJ1c3QvY29udmVudGlvbicsICd0aHJ1c3QvdXRpbCcsICcuLi9zdWJqcXVlcnknXSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgX19jX18sIF9fdXRpbF9fLCBfX3N1YmpxdWVyeV9fKSB7CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL2RvbS9jb252ZW50aW9uL2NvbnRleHQuZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvbWVkaWF0b3IvbWVkaWF0b3IuZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvZG9tL2RvbS5kLnRzIiAvPgogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vaW50ZXJmYWNlcy90aHJ1c3QuZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uLy4uLy4uL2xpYi9EZWZpbml0ZWx5VHlwZWQvcmVxdWlyZWpzL3JlcXVpcmUuZC50cyIgLz4KICAgIC8vIERpc2FibGVkIHVudGlsIFRTIHN1cHBvcnRzIG1vZHVsZSBwZXIgZmlsZSBpbiBzb21lIHdheSAoaWUgZXhwb3J0cyBpcyBleHBvcnRzLjxleHBvcnQ+IG5vdCAgZXhwb3J0cy5tb2R1bGVOYW1lLjxleHBvcnQ+KQogICAgLypleHBvcnQgbW9kdWxlIGluc3RhbmNlIHsqLwogICAgCiAgICB2YXIgYyA9IF9fY19fOwoKICAgIHZhciBDb252ZW50aW9uID0gYy5Db252ZW50aW9uOwogICAgdmFyIHV0aWwgPSBfX3V0aWxfXzsKCiAgICB2YXIgXyA9IHV0aWwuXzsKICAgIHZhciBzdWJqcXVlcnkgPSBfX3N1YmpxdWVyeV9fOwoKICAgIHZhciB0UXVlcnkgPSBzdWJqcXVlcnkudFF1ZXJ5OwogICAgdmFyIENPTlRFWFQgPSAnY29uZmlnLmRvbS5jb250ZXh0JzsKICAgIHZhciBtZXRob2RzID0gewogICAgICAgIHByb3BlcnRpZXM6IFsKICAgICAgICAgICAgQ09OVEVYVAogICAgICAgIF0sCiAgICAgICAgcmVhZHk6IGZ1bmN0aW9uIChtb2QsIGZhY2FkZSkgewogICAgICAgICAgICB2YXIgY29udGV4dCA9IG1vZC5jb252ZW50aW9uKENPTlRFWFQpOwogICAgICAgICAgICBpZihjb250ZXh0KSB7CiAgICAgICAgICAgICAgICBtb2QuaW5zdGFuY2UuZG9tID0gbW9kLmluc3RhbmNlLiQgPSB0UXVlcnkoY29udGV4dCwgZmFjYWRlLmNvbnRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGV4cG9ydHMuY29udGV4dCA9IG5ldyBDb252ZW50aW9uKG1ldGhvZHMpOwp9KQovL0Agc291cmNlTWFwcGluZ1VSTD1jb250ZXh0LmpzLm1hcAo7CmRlZmluZSgndGhydXN0L2RvbS9jb252ZW50aW9uL2V2ZW50JyxbInJlcXVpcmUiLCAiZXhwb3J0cyIsICd0aHJ1c3QvY29udmVudGlvbicsICd0aHJ1c3QvdXRpbCddLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBfX2NfXywgX191dGlsX18pIHsKICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvZG9tL2NvbnZlbnRpb24vZXZlbnQuZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvbWVkaWF0b3IvbWVkaWF0b3IuZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvZG9tL2RvbS5kLnRzIiAvPgogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vaW50ZXJmYWNlcy90aHJ1c3QuZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uLy4uLy4uL2xpYi9EZWZpbml0ZWx5VHlwZWQvcmVxdWlyZWpzL3JlcXVpcmUuZC50cyIgLz4KICAgIC8vIERpc2FibGVkIHVudGlsIFRTIHN1cHBvcnRzIG1vZHVsZSBwZXIgZmlsZSBpbiBzb21lIHdheSAoaWUgZXhwb3J0cyBpcyBleHBvcnRzLjxleHBvcnQ+IG5vdCAgZXhwb3J0cy5tb2R1bGVOYW1lLjxleHBvcnQ+KQogICAgLypleHBvcnQgbW9kdWxlIGluc3RhbmNlIHsqLwogICAgCiAgICB2YXIgYyA9IF9fY19fOwoKICAgIHZhciBDb252ZW50aW9uID0gYy5Db252ZW50aW9uOwogICAgdmFyIHV0aWwgPSBfX3V0aWxfXzsKCiAgICB2YXIgXyA9IHV0aWwuXzsKICAgIHZhciBDT05URVhUID0gJ2NvbmZpZy5kb20uY29udGV4dCcsIEVWRU5UUyA9ICdjb25maWcuZG9tLmV2ZW50cycsIGlzRnVuY3Rpb24gPSBfLmlzRnVuY3Rpb24sIGlzU3RyaW5nID0gXy5pc1N0cmluZywgaXNBcnJheSA9IF8uaXNBcnJheTsKICAgIHZhciBldmVudFByb3BlcnR5TG9hZE9yZGVyID0gWwogICAgICAgICdzZWxlY3RvcicsIAogICAgICAgICdkYXRhJywgCiAgICAgICAgJ2hhbmRsZXInCiAgICBdOwogICAgdmFyIG1ldGhvZHMgPSB7CiAgICAgICAgcHJvcGVydGllczogWwogICAgICAgICAgICBFVkVOVFMKICAgICAgICBdLAogICAgICAgIHJlYWR5OiBmdW5jdGlvbiAobW9kLCBmYWNhZGUpIHsKICAgICAgICAgICAgdmFyIGV2ZW50cyA9IG1vZC5jb252ZW50aW9uKEVWRU5UUyksICRjb250ZXh0ID0gZmFjYWRlLmNvbnRleHQsIG1vZHVsZUluc3RhbmNlID0gbW9kLmluc3RhbmNlOwogICAgICAgICAgICBpZihldmVudHMpIHsKICAgICAgICAgICAgICAgIF8uZm9ySW4oZXZlbnRzLCBmdW5jdGlvbiAoZXZlbnRzQ29sbGVjdGlvbiwgZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAvL3ZhciBldmVudHNDb2xsZWN0aW9uID0gZXZlbnRzW2V2ZW50XTsKICAgICAgICAgICAgICAgICAgICBpZighaXNBcnJheShldmVudHNDb2xsZWN0aW9uKSkgewogICAgICAgICAgICAgICAgICAgICAgICBldmVudHNDb2xsZWN0aW9uID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRzQ29sbGVjdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihldmVudHNDb2xsZWN0aW9uLmxlbmd0aCAmJiAoIWlzQXJyYXkoZXZlbnRzQ29sbGVjdGlvblswXSkgfHwgaXNTdHJpbmcoZXZlbnRzQ29sbGVjdGlvblswXSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50c0NvbGxlY3Rpb24gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudHNDb2xsZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF8uZWFjaChldmVudHNDb2xsZWN0aW9uLCBmdW5jdGlvbiAoZGVmaW5pdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmluZEV2ZW50ID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNBcnJheShkZWZpbml0aW9uKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZEV2ZW50LnB1c2guYXBwbHkoYmluZEV2ZW50LCBkZWZpbml0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgb25lIGVkZ2VjYXNlIGhlcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzaG9ydCBoYW5kIGFycmF5LCBoYXMgYSBjb250ZXh0IHRoYXQgaXMgYSBzdHJpbmcgb3IgZnVuY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCBpdCBkb2VzbnQgaGF2ZSBpbmZvcm1hdGlvbiBmb3IgYm90aCBzZWxlY3RvciBhbmQgZGF0YSwgdGhpcyB3aWxsIGZhaWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGNhbiByZWNvdmVyIHdoZW4gYWxsIDUgcG9zc2libGUgaXRlbXMgYXJlIGRlZmluZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlciA9IGJpbmRFdmVudFtiaW5kRXZlbnQubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSB3ZXJlIGFza2VkIGZvciBhIG1ldGhvZCBvbiB0aGUgbW9kdWxlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNTdHJpbmcoaGFuZGxlcikgJiYgYmluZEV2ZW50Lmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRFdmVudFtiaW5kRXZlbnQubGVuZ3RoIC0gMV0gPSBtb2QuaW5zdGFuY2VbaGFuZGxlcl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgLy8gV2UgZGlkbnQgZmluZCBhIGZ1bmN0aW9uIDooCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgRURHRSBDQVNFOiBJZiBjb250ZXh0IGlzIGEgZnVuY3Rpb24sIHdlIHdpbGwgYXNzdW1lIGFsbCBpcyB3ZWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgRXZlbiBpZiB0aGUgaGFuZGxlciBpcyBhIHN0cmluZyB0aGF0IG5lZWRzIHRvIGJlIHJlZmVyZW5jZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXb3JrIGFycm91bmRzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICBTaG9ydGhhbmQ6IGFkZCBudWxsL2VtcHR5IHZhbHVlcyBmb3Igc2VsZWN0b3IgYW5kIGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgTG9uZ2hhbmQ6IHN3aXRjaCB0byBsb25nIGhhbmQgYXMgaXQgaGFzIG1vcmUgZXhwbGljaXQgc3ludGF4LgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWlzU3RyaW5nKGhhbmRsZXIpICYmICFpc0Z1bmN0aW9uKGhhbmRsZXIpICYmIGJpbmRFdmVudC5sZW5ndGggPiAyIHx8IGJpbmRFdmVudC5sZW5ndGggPT09IDUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyID0gYmluZEV2ZW50W2JpbmRFdmVudC5sZW5ndGggLSAyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpc1N0cmluZyhoYW5kbGVyKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5kRXZlbnRbYmluZEV2ZW50Lmxlbmd0aCAtIDJdID0gbW9kLmluc3RhbmNlW2hhbmRsZXJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5kRXZlbnRbYmluZEV2ZW50Lmxlbmd0aCAtIDJdID0gXy5iaW5kKGJpbmRFdmVudFtiaW5kRXZlbnQubGVuZ3RoIC0gMl0sIGJpbmRFdmVudC5wb3AoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoaXNTdHJpbmcoaGFuZGxlcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5kRXZlbnRbYmluZEV2ZW50Lmxlbmd0aCAtIDFdID0gbW9kLmluc3RhbmNlW2hhbmRsZXJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKGV2ZW50UHJvcGVydHlMb2FkT3JkZXIsIGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGVmaW5pdGlvblt4XSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBkZWZpbml0aW9uW3hdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih4ID09PSAnaGFuZGxlcicgJiYgZGVmaW5pdGlvbi5jb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IF8uYmluZCh2YWx1ZSwgZGVmaW5pdGlvbi5jb250ZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5kRXZlbnQucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsbCB0aGUgb24gbWV0aG9kLCB3aXRoIG91ciBhcmd1bWVudHMuCiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZXh0Lm9uLmFwcGx5KCRjb250ZXh0LCBiaW5kRXZlbnQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0b3A6IGZ1bmN0aW9uIChtb2QsIGZhY2FkZSkgewogICAgICAgICAgICB2YXIgZXZlbnRzID0gbW9kLmNvbnZlbnRpb24oRVZFTlRTKSwgJGNvbnRleHQgPSBmYWNhZGUuY29udGV4dDsKICAgICAgICAgICAgaWYoJGNvbnRleHQpIHsKICAgICAgICAgICAgICAgICRjb250ZXh0Lm9mZigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGV4cG9ydHMuZXZlbnQgPSBuZXcgQ29udmVudGlvbihtZXRob2RzKTsKfSkKLy9AIHNvdXJjZU1hcHBpbmdVUkw9ZXZlbnQuanMubWFwCjs=",
                "body": "LyohIHRocnVzdC1qcyAtIHYwLjEuNSAtIDIwMTMtMDEtMjcgKi8KZGVmaW5lKCd0aHJ1c3QvZG9tL3N1YmpxdWVyeScsWyJyZXF1aXJlIiwgImV4cG9ydHMiLCAnanF1ZXJ5JywgJ3RocnVzdC91dGlsJywgJ3RocnVzdC9sb2cnLCAnaGFzJ10sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIF9falF1ZXJ5X18sIF9fdXRpbF9fLCBfX2xvZ19fLCBfX2hhc19fKSB7CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi8uLi9saWIvRGVmaW5pdGVseVR5cGVkL3JlcXVpcmVqcy9yZXF1aXJlLmQudHMiIC8+CiAgICAvLyBEaXNhYmxlZCB1bnRpbCBUUyBzdXBwb3J0cyBtb2R1bGUgcGVyIGZpbGUgaW4gc29tZSB3YXkgKGllIGV4cG9ydHMgaXMgZXhwb3J0cy48ZXhwb3J0PiBub3QgIGV4cG9ydHMubW9kdWxlTmFtZS48ZXhwb3J0PikKICAgIC8qZXhwb3J0IG1vZHVsZSBpbnN0YW5jZSB7Ki8KICAgIAogICAgdmFyIGpRdWVyeSA9IF9falF1ZXJ5X187CgogICAgdmFyIHV0aWwgPSBfX3V0aWxfXzsKCiAgICB2YXIgXyA9IHV0aWwuXzsKICAgIHZhciBsb2cgPSBfX2xvZ19fOwoKICAgIHZhciBoYXMgPSBfX2hhc19fOwoKICAgIHZhciBmb3JtYXQgPSB1dGlsLmZvcm1hdCwgZWFjaCA9IF8uZWFjaCwgZXh0ZW5kID0gXy5leHRlbmQsIGlzT2JqZWN0ID0gXy5pc09iamVjdCwgaXNGdW5jdGlvbiA9IF8uaXNGdW5jdGlvbiwgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsIEdMT0JBTCA9ICcuZ2xvYmFsJzsKICAgIHZhciBqUXVlcnlGbk1ldGhvZEJsYWNrTGlzdCA9IFsKICAgICAgICAncmVhZHknLCAKICAgICAgICAnZXh0ZW5kJywgCiAgICAgICAgJ3F1ZXVlJywgCiAgICAgICAgJ2RlcXVldWUnLCAKICAgICAgICAnY2xlYXJRdWV1ZScsIAogICAgICAgICdwcm9taXNlJywgCiAgICAgICAgJ2JpbmQnLCAKICAgICAgICAndW5iaW5kJywgCiAgICAgICAgJ2xpdmUnLCAKICAgICAgICAnZGllJywgCiAgICAgICAgJ2RlbGVnYXRlJywgCiAgICAgICAgJ3VuZGVsZWdhdGUnLCAKICAgICAgICAnYmx1cicsIAogICAgICAgICdmb2N1cycsIAogICAgICAgICdmb2N1c2luJywgCiAgICAgICAgJ2ZvY3Vzb3V0JywgCiAgICAgICAgJ2xvYWQnLCAKICAgICAgICAncmVzaXplJywgCiAgICAgICAgJ3Njcm9sbCcsIAogICAgICAgICd1bmxvYWQnLCAKICAgICAgICAnY2xpY2snLCAKICAgICAgICAnZGJsY2xpY2snLCAKICAgICAgICAnbW91c2Vkb3duJywgCiAgICAgICAgJ21vdXNldXAnLCAKICAgICAgICAnbW91c2Vtb3ZlJywgCiAgICAgICAgJ21vdXNlb3ZlcicsIAogICAgICAgICdtb3VzZW91dCcsIAogICAgICAgICdtb3VzZWVudGVyJywgCiAgICAgICAgJ21vdXNlbGVhdmUnLCAKICAgICAgICAnY2hhbmdlJywgCiAgICAgICAgJ3NlbGVjdCcsIAogICAgICAgICdzdWJtaXQnLCAKICAgICAgICAna2V5ZG93bicsIAogICAgICAgICdrZXlwcmVzcycsIAogICAgICAgICdrZXl1cCcsIAogICAgICAgICdlcnJvcicsIAogICAgICAgICdzZXJpYWxpemUnLCAKICAgICAgICAnc2VyaWFsaXplQXJyYXknLCAKICAgICAgICAnYWpheFN0YXJ0JywgCiAgICAgICAgJ2FqYXhTdG9wJywgCiAgICAgICAgJ2FqYXhDb21wbGV0ZScsIAogICAgICAgICdhamF4RXJyb3InLCAKICAgICAgICAnYWpheFN1Y2Nlc3MnLCAKICAgICAgICAnYWpheFNlbmQnLCAKICAgICAgICAnX3RvZ2dsZScsIAogICAgICAgICdmYWRlVG8nLCAKICAgICAgICAnc3RvcCcsIAogICAgICAgICdzbGlkZURvd24nLCAKICAgICAgICAnc2xpZGVVcCcsIAogICAgICAgICdzbGlkZVRvZ2dsZScsIAogICAgICAgICdmYWRlSW4nLCAKICAgICAgICAnZmFkZU91dCcsIAogICAgICAgICdmYWRlVG9nZ2xlJy8qLCAnb24nLCAnb2ZmJywgJ29uZScqLyAKICAgIF07CiAgICBmdW5jdGlvbiBub3JtYWxpemVFdmVudHMoZXZlbnRzLCBuYW1lc3BhY2UpIHsKICAgICAgICBpZighbmFtZXNwYWNlKSB7CiAgICAgICAgICAgIHJldHVybiBldmVudHM7CiAgICAgICAgfQogICAgICAgIGlmKGlzT2JqZWN0KGV2ZW50cykpIHsKICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBvYmplY3QsIHNvIHRoYXQgb3JpZ2luYWwgb2JqZWN0IHdpbGwgbm90IGJlIG1vZGlmaWVkIHdoZW4gYmluZGluZy4KICAgICAgICAgICAgZXZlbnRzID0gZXh0ZW5kKHsKICAgICAgICAgICAgfSwgZXZlbnRzKTsKICAgICAgICAgICAgZm9yKHZhciBrZXkgaW4gZXZlbnRzKSB7CiAgICAgICAgICAgICAgICBpZihrZXkuaW5kZXhPZignLicpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50c1trZXkgKyBuYW1lc3BhY2VdID0gZXZlbnRzW2tleV07CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGV2ZW50c1trZXldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBldmVudHM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYoIWV2ZW50cykgewogICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVzcGFjZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBldmVudHMgPSBldmVudHMuc3BsaXQoJyAnKTsKICAgICAgICAgICAgZm9yKHZhciBpID0gMCwgaUxlbiA9IGV2ZW50cy5sZW5ndGg7IGkgPCBpTGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBldnQgPSBldmVudHNbaV07CiAgICAgICAgICAgICAgICBpZihldnQuaW5kZXhPZignLicpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50c1tpXSA9IGV2dCArIG5hbWVzcGFjZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZXZlbnRzLmpvaW4oJyAnKTsKICAgICAgICB9CiAgICB9CiAgICAvKgogICAgQ2xvbmUganF1ZXJ5CiAgICBSZW1vdmUgYWxsIGV4Y2VzcyBtZXRob2RzIHdlIGRvbid0IHdhbnQgdG8gZXhwb3NlIG5hdGl2ZWx5LgogICAgb3ZlcnJsb2FkIGFueSBtZXRob2RzIHdlIHdhbnQgdG8gY2hhbmdlIGJlaGF2aW9yIG9mIChub3RlYWJseSBvbiwgb25lLCBhbmQgb2ZmKQogICAgCiAgICBJbnN0ZWFkIG9mIGR1cGxpY2F0aW5nIHRoZSBqcXVlcnkgYmVoYXZpb3Igd2UgaW5zdGVhZCByZWFsaWduIGl0IHRvIG91ciBvd24uCiAgICAqLwogICAgLy8galF1ZXJ5IHN1YgogICAgZnVuY3Rpb24gc3ViSlF1ZXJ5KCkgewogICAgICAgIHZhciB0UXVlcnkgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIGNvbnRleHQsIG5hbWVzcGFjZSkgewogICAgICAgICAgICByZXR1cm4gbmV3IHRRdWVyeS5wcm90b3R5cGUuaW5pdChzZWxlY3RvciwgY29udGV4dCwgbmFtZXNwYWNlIHx8ICh0aGlzICYmIHRoaXMubmFtZXNwYWNlKSk7CiAgICAgICAgfTsKICAgICAgICBfLm1lcmdlKHRRdWVyeSwgalF1ZXJ5KTsKICAgICAgICAvLyBEbyBub3QgbGlrZQogICAgICAgIC8vIHByb2JhYmx5IG5lZWRlZCBpbiBzb21lIHNwZWNpYWwgdW5pcXVlIGNhc2VzCiAgICAgICAgdFF1ZXJ5LmpRdWVyeSA9IGpRdWVyeTsKICAgICAgICAvLyBleHBvc2UgZXZlbnRzIGZvciBkb2luZyBzcGVjaWFsIGV2ZW50cyBhcyByZXF1aXJlZC4KICAgICAgICB0UXVlcnkuZXZlbnQgPSAoalF1ZXJ5KS5ldmVudDsKICAgICAgICB0UXVlcnkuZm4gPSB0UXVlcnkucHJvdG90eXBlID0gZXh0ZW5kKHsKICAgICAgICB9LCBqUXVlcnkuZm4pOwogICAgICAgIHRRdWVyeS5mbi5jb25zdHJ1Y3RvciA9IHRRdWVyeTsKICAgICAgICB0UXVlcnkuZm4uaW5pdCA9IGZ1bmN0aW9uIGluaXQoc2VsZWN0b3IsIGNvbnRleHQsIG5hbWVzcGFjZSkgewogICAgICAgICAgICB2YXIgaW9Eb20gPSBjb250ZXh0IGluc3RhbmNlb2YgdFF1ZXJ5OwogICAgICAgICAgICBpZihjb250ZXh0ICYmIGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgJiYgIShpb0RvbSkpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQgPSB0UXVlcnkoY29udGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGpRdWVyeS5mbi5pbml0LmNhbGwodGhpcywgc2VsZWN0b3IsIGNvbnRleHQsIHRRdWVyeVJvb3QpOwogICAgICAgICAgICBpZihuYW1lc3BhY2UpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7CiAgICAgICAgICAgIH0gZWxzZSBpZihpb0RvbSkgewogICAgICAgICAgICAgICAgcmVzdWx0Lm5hbWVzcGFjZSA9IGNvbnRleHQubmFtZXNwYWNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfTsKICAgICAgICB0UXVlcnkuZm4uaW5pdC5wcm90b3R5cGUgPSB0UXVlcnkuZm47CiAgICAgICAgdmFyIHRRdWVyeVJvb3QgPSB0UXVlcnkoZG9jdW1lbnQpOwogICAgICAgIC8vIHJlbW92ZSBhbGwgbm90IGFwcGxpY2FibGUgbWV0aG9kcyBvZmYgb2YgZm4uCiAgICAgICAgZWFjaChqUXVlcnlGbk1ldGhvZEJsYWNrTGlzdCwgZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgaWYodFF1ZXJ5LmZuW3hdKSB7CiAgICAgICAgICAgICAgICB0UXVlcnkuZm5beF0gPSBudWxsOwogICAgICAgICAgICAgICAgZGVsZXRlIHRRdWVyeS5mblt4XTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIF8uZWFjaChbCiAgICAgICAgICAgICdvbicsIAogICAgICAgICAgICAnb25lJywgCiAgICAgICAgICAgICdvZmYnCiAgICAgICAgXSwgZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgdFF1ZXJ5LmZuW3hdID0gXy53cmFwKHRRdWVyeS5mblt4XSwgZnVuY3Rpb24gKGYpIHsKICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgKGFyZ3VtZW50cy5sZW5ndGggLSAxKTsgX2krKykgewogICAgICAgICAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pICsgMV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0cnVlICYmIGxvZy5kZWJ1Zyhmb3JtYXQoJ3RRdWVyeVt7MH1dOiBCaW5kaW5nICcgKyB4ICsgJyBldmVudHMuLi4nLCB0aGlzLm5hbWVzcGFjZSkpOwogICAgICAgICAgICAgICAgYXJnc1swXSA9IG5vcm1hbGl6ZUV2ZW50cyhhcmdzWzBdLCB0aGlzLm5hbWVzcGFjZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZi5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdFF1ZXJ5LmZuLnF1ZXJ5ID0gdFF1ZXJ5LmZuLiQgPSB0UXVlcnkuZm4uZmluZDsKICAgICAgICByZXR1cm4gdFF1ZXJ5OwogICAgfQogICAgZXhwb3J0cy50UXVlcnkgPSBzdWJKUXVlcnkoKTsKfSkKLy9AIHNvdXJjZU1hcHBpbmdVUkw9c3VianF1ZXJ5LmpzLm1hcAo7CmRlZmluZSgndGhydXN0L2RvbS9jb25maWcnLFsicmVxdWlyZSIsICJleHBvcnRzIl0sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMpIHsKICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uLy4uL2xpYi9EZWZpbml0ZWx5VHlwZWQvcmVxdWlyZWpzL3JlcXVpcmUuZC50cyIgLz4KICAgIC8vIERpc2FibGVkIHVudGlsIFRTIHN1cHBvcnRzIG1vZHVsZSBwZXIgZmlsZSBpbiBzb21lIHdheSAoaWUgZXhwb3J0cyBpcyBleHBvcnRzLjxleHBvcnQ+IG5vdCAgZXhwb3J0cy5tb2R1bGVOYW1lLjxleHBvcnQ+KQogICAgLypleHBvcnQgbW9kdWxlIGluc3RhbmNlIHsqLwogICAgCiAgICAvKioKICAgIFJlc29sdmVzIHRoZSBnaXZlbiBwcm9wZXJ0aWVzIHdoZW4gY3JlYXRpbmcgYW4gaW5zdGFuY2Ugb2YgdGhlIHBsdWdpbi4KICAgIAogICAgVGhpcyBpcyBmb3IgaW50ZXJuYWwgdGhydXN0IHVzZS4gIFRocnVzdCB1c2VzIHRoaXMgYXJyYXkgdG8gZ2VuZXJhdGUgdGhlIHByb3BlcnRpZXMgdGhhdCBuZWVkIHRvIGJlIGhhbmRlZAogICAgdG8gdGhlIHBsdWdpbiBjb25zdHJ1Y3RvciBtZXRob2QuCiAgICAKICAgIEBmb3IgdGhydXN0LmRvbS5jb25maWcKICAgIEBwcml2YXRlCiAgICBAcHJvcGVydHkgcmVzb2x2ZQogICAgQHJlYWRPbmx5CiAgICBAdHlwZSB7QXJyYXl9CiAgICAqKi8KICAgIGV4cG9ydHMucmVzb2x2ZSA9IFsKICAgICAgICAnbmFtZScsIAogICAgICAgICdtZWRpYXRvcicKICAgIF07CiAgICAvKioKICAgIFRoZSBzZXQgb2YgY29udmVudGlvbnMgdG8gbG9hZCBpbnRvIHRocnVzdC9kb20uCiAgICAKICAgIEBwcm9wZXJ0eSBjb252ZW50aW9ucwogICAgQHJlYWRPbmx5CiAgICBAdHlwZSB7QXJyYXl9CiAgICAqKi8KICAgIGV4cG9ydHMuY29udmVudGlvbnMgPSBbCiAgICAgICAgJ3RocnVzdC9kb20vY29udmVudGlvbi9hY3Rpb24nLCAKICAgICAgICAndGhydXN0L2RvbS9jb252ZW50aW9uL2NvbnRleHQnLCAKICAgICAgICAndGhydXN0L2RvbS9jb252ZW50aW9uL2V2ZW50JwogICAgXTsKfSkKLy9AIHNvdXJjZU1hcHBpbmdVUkw9Y29uZmlnLmpzLm1hcAo7CmRlZmluZSgndGhydXN0L2RvbS9tYWluJyxbInJlcXVpcmUiLCAiZXhwb3J0cyIsICcuL3N1YmpxdWVyeScsICd0aHJ1c3QvdXRpbCcsICd0aHJ1c3QvbG9nJywgJ3RocnVzdC9mYWNhZGUnLCAnaGFzJywgJ3RocnVzdC9pbnN0YW5jZScsICcuL2NvbmZpZyddLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBfX3N1YmpxdWVyeV9fLCBfX3V0aWxfXywgX19sb2dfXywgX19mYWNhZGVfXywgX19oYXNfXywgX19pbnN0YW5jZV9fLCBfX2NvbmZpZ19fKSB7CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi9pbnRlcmZhY2VzL2RvbS9kb20uZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uLy4uL2xpYi9EZWZpbml0ZWx5VHlwZWQvcmVxdWlyZWpzL3JlcXVpcmUuZC50cyIgLz4KICAgIC8vIERpc2FibGVkIHVudGlsIFRTIHN1cHBvcnRzIG1vZHVsZSBwZXIgZmlsZSBpbiBzb21lIHdheSAoaWUgZXhwb3J0cyBpcyBleHBvcnRzLjxleHBvcnQ+IG5vdCAgZXhwb3J0cy5tb2R1bGVOYW1lLjxleHBvcnQ+KQogICAgLypleHBvcnQgbW9kdWxlIGluc3RhbmNlIHsqLwogICAgCiAgICB2YXIgc3VianF1ZXJ5ID0gX19zdWJqcXVlcnlfXzsKCiAgICB2YXIgdFF1ZXJ5ID0gc3VianF1ZXJ5LnRRdWVyeTsKICAgIHZhciB1dGlsID0gX191dGlsX187CgogICAgdmFyIF8gPSB1dGlsLl87CiAgICB2YXIgbG9nID0gX19sb2dfXzsKCiAgICB2YXIgZmFjYWRlID0gX19mYWNhZGVfXzsKCiAgICB2YXIgaGFzID0gX19oYXNfXzsKCiAgICB2YXIgaW5zdGFuY2UgPSBfX2luc3RhbmNlX187CgogICAgdmFyIGNvbmZpZyA9IF9fY29uZmlnX187CgogICAgZXhwb3J0cy5jbGFzc05hbWUgPSAnRG9tJzsKICAgIHZhciBmb3JtYXQgPSB1dGlsLmZvcm1hdCwgZXh0ZW5kID0gXy5leHRlbmQsIGJpbmQgPSBfLmJpbmQsIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksIGlzT2JqZWN0ID0gXy5pc09iamVjdCwgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsIHdoZW4gPSB1dGlsLndoZW4sIGlzQXJyYXkgPSBfLmlzQXJyYXk7CiAgICAvLyNyZWdpb24gRG9tRmFjYWRlCiAgICB2YXIgRG9tRmFjYWRlID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZG9tRmFjYWRlID0gZmFjYWRlLmNyZWF0ZUZhY2FkZShmdW5jdGlvbiAobW9kLCBwYXJlbnQpIHsKICAgICAgICAgICAgdGhpcy5uYW1lID0gcGFyZW50Lm5hbWU7CiAgICAgICAgICAgIHRoaXMuX19jb252ZW50aW9ucyA9IHBhcmVudC5fX2NvbnZlbnRpb25zOwogICAgICAgICAgICB0aGlzLmNvbnRleHQgPSB0UXVlcnkoZG9jdW1lbnQsIHVuZGVmaW5lZCwgdGhpcy5uYW1lKTsKICAgICAgICB9KTsKICAgICAgICBkb21GYWNhZGUucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoZmFrZSkgewogICAgICAgICAgICB0aGlzLl9pbnRlcm5hbEV2ZW50cyA9IHRoaXMuX2ludGVybmFsRXZlbnRzIHx8IFtdOwogICAgICAgICAgICB0cnVlICYmIGxvZy5kZWJ1Zyhmb3JtYXQoJ0RvbVt7MH1dOiBJbml0YWxpemluZyB7MX1Eb20gZmFjYWRlJywgdGhpcy5uYW1lLCBmYWtlID8gJ2Zha2UgJyA6ICcnKSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CiAgICAgICAgZG9tRmFjYWRlLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgIHRydWUgJiYgbG9nLmRlYnVnKGZvcm1hdCgnRG9tW3swfV06IFN0YXJ0aW5nIERvbSBmYWNhZGUnLCB0aGlzLm5hbWUpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfTsKICAgICAgICBkb21GYWNhZGUucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAobSkgewogICAgICAgICAgICB0cnVlICYmIGxvZy5kZWJ1Zyhmb3JtYXQoJ0RvbVt7MH1dOiBTdG9wcGluZyBEb20gZmFjYWRlJywgdGhpcy5uYW1lKSk7CiAgICAgICAgICAgIGZvcih2YXIgaSA9IHRoaXMuX2ludGVybmFsRXZlbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICB2YXIgc3ViID0gdGhpcy5faW50ZXJuYWxFdmVudHNbaV07CiAgICAgICAgICAgICAgICB0aGlzLl9pbnRlcm5hbEV2ZW50cy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICBzdWIuY29udGV4dC5vZmYuYXBwbHkodGhpcywgKGlzQXJyYXkoc3ViKSkgPyBzdWIgOiAoaXNBcnJheShzdWIuYXJncykpID8gc3ViLmFyZ3MgOiBbXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfTsKICAgICAgICBkb21GYWNhZGUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAobSkgewogICAgICAgICAgICB0cnVlICYmIGxvZy5kZWJ1Zyhmb3JtYXQoJ0RvbVt7MH1dOiBEZXN0cm95aW5nIERvbSBmYWNhZGUnLCB0aGlzLm5hbWUpKTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2ludGVybmFsRXZlbnRzOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwogICAgICAgIHJldHVybiBkb21GYWNhZGU7CiAgICB9KSgpOwogICAgLy8jZW5kcmVnaW9uCiAgICAvLyNyZWdpb24gRG9tCiAgICB2YXIgRG9tID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyNlbmRyZWdpb24KICAgICAgICBmdW5jdGlvbiBEb20obmFtZSwgbWVkaWF0b3IpIHsKICAgICAgICAgICAgaWYoIW5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRG9tOiBtb2R1bGUgbmFtZSBtdXN0IGJlIGRlZmluZWQuJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ1ZSAmJiBsb2cuZGVidWcoJ0RhdGE6IENyZWF0aW5nIG5ldyBEYXRhJyk7CiAgICAgICAgICAgIHRoaXMubWVkaWF0b3IgPSBtZWRpYXRvcjsKICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tzID0gKG1lZGlhdG9yKS5fY2FsbGJhY2tzOwogICAgICAgICAgICB0aGlzLmluaXRFdmVudHMoKTsKICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICBpbnN0YW5jZS5mZXRjaEluc3RhbmNlKG5hbWUpLnByb21pc2UudGhlbihmdW5jdGlvbiAodGhydXN0KSB7CiAgICAgICAgICAgICAgICB2YXIgbW9kID0gewogICAgICAgICAgICAgICAgfSwgZmFjYWRlID0gdGhhdC5jcmVhdGVGYWNhZGUodGhydXN0LCBtb2QsIHsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIERvbS5wcm90b3R5cGUuaW5pdEV2ZW50cyA9IC8vI3JlZ2lvbiBFdmVudHMKICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgfTsKICAgICAgICBEb20ucHJvdG90eXBlLmV4dGVuZCA9IGZ1bmN0aW9uICh0bywgaW5pdCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwogICAgICAgIERvbS5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gKGV2ZW50cywgY2FsbGJhY2ssIGNvbnRleHQsIG9uY2UpIHsKICAgICAgICB9OwogICAgICAgIERvbS5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoZXZlbnRzLCBjYWxsYmFjaywgY29udGV4dCkgewogICAgICAgIH07CiAgICAgICAgRG9tLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24gKGV2ZW50cywgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgICB9OwogICAgICAgIERvbS5jb25maWcgPSBjb25maWc7CiAgICAgICAgRG9tLnByb3RvdHlwZS5jcmVhdGVGYWNhZGUgPSBmdW5jdGlvbiAodGhydXN0LCBtb2QsIGZhY2FkZXMpIHsKICAgICAgICAgICAgaWYoZmFjYWRlcy5kb20gJiYgIShmYWNhZGVzLmRvbSBpbnN0YW5jZW9mIERvbUZhY2FkZSkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignImRvbSIgaXMgYSByZXNlcnZlZCBwcm9wZXJ0eScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBkb207CiAgICAgICAgICAgIGlmKGZhY2FkZXMuZG9tKSB7CiAgICAgICAgICAgICAgICBmYWNhZGVzLmRvbS51cGRhdGVGYWNhZGUobW9kLCB0aGlzKTsKICAgICAgICAgICAgICAgIGRvbSA9IGZhY2FkZXMuZG9tOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZG9tID0gZmFjYWRlcy5kb20gPSBuZXcgRG9tRmFjYWRlKG1vZCwgdGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGRvbTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBEb207CiAgICB9KSgpOwogICAgZXhwb3J0cy5Eb20gPSBEb207ICAgIAogICAgLy8jZW5kcmVnaW9uCiAgICB9KQovL0Agc291cmNlTWFwcGluZ1VSTD1tYWluLmpzLm1hcAo7CmRlZmluZSgndGhydXN0L2RvbScsIFsndGhydXN0L2RvbS9tYWluJ10sIGZ1bmN0aW9uIChtYWluKSB7IHJldHVybiBtYWluOyB9KTsKCmRlZmluZSgndGhydXN0L2RvbS9jb252ZW50aW9uL2FjdGlvbicsWyJyZXF1aXJlIiwgImV4cG9ydHMiLCAndGhydXN0L2NvbnZlbnRpb24nLCAndGhydXN0L3V0aWwnLCAnLi4vc3VianF1ZXJ5J10sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIF9fY19fLCBfX3V0aWxfXywgX19zdWJqcXVlcnlfXykgewogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vaW50ZXJmYWNlcy9kb20vY29udmVudGlvbi9hY3Rpb24uZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvZG9tL2RvbS5kLnRzIiAvPgogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vaW50ZXJmYWNlcy90aHJ1c3QuZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uLy4uLy4uL2xpYi9EZWZpbml0ZWx5VHlwZWQvcmVxdWlyZWpzL3JlcXVpcmUuZC50cyIgLz4KICAgIC8vIERpc2FibGVkIHVudGlsIFRTIHN1cHBvcnRzIG1vZHVsZSBwZXIgZmlsZSBpbiBzb21lIHdheSAoaWUgZXhwb3J0cyBpcyBleHBvcnRzLjxleHBvcnQ+IG5vdCAgZXhwb3J0cy5tb2R1bGVOYW1lLjxleHBvcnQ+KQogICAgLypleHBvcnQgbW9kdWxlIGluc3RhbmNlIHsqLwogICAgCiAgICB2YXIgYyA9IF9fY19fOwoKICAgIHZhciBDb252ZW50aW9uID0gYy5Db252ZW50aW9uOwogICAgdmFyIHV0aWwgPSBfX3V0aWxfXzsKCiAgICB2YXIgXyA9IHV0aWwuXzsKICAgIHZhciBzdWJqcXVlcnkgPSBfX3N1YmpxdWVyeV9fOwoKICAgIHZhciAkID0gc3VianF1ZXJ5LnRRdWVyeTsKICAgIHZhciBmb3JtYXQgPSB1dGlsLmZvcm1hdCwgQUNUSU9OUyA9ICdjb25maWcuZG9tLmFjdGlvbnMnLCBBQ1RJT05TU0lOR0xFID0gJ2FjdGlvbnMnLCBTVFJJTkcgPSAnc3RyaW5nJywgUkVHSVNUUkFUSU9OUyA9ICdfcmVnaXN0cmF0aW9ucycsIGlzRnVuY3Rpb24gPSBfLmlzRnVuY3Rpb24sIGlzU3RyaW5nID0gXy5pc1N0cmluZywgaXNBcnJheSA9IF8uaXNBcnJheTsKICAgIHZhciBnZXRBY3Rpb25BdHRyaWJ1dGUgPSBmdW5jdGlvbiAoZXZlbnROYW1lKSB7CiAgICAgICAgcmV0dXJuICdkYXRhLWFjdGlvbi0nICsgZXZlbnROYW1lOwogICAgfTsKICAgIHZhciBBY3Rpb25IYW5kbGVyID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICBmdW5jdGlvbiBBY3Rpb25IYW5kbGVyKCkgewogICAgICAgICAgICB0aGlzLmV2ZW50cyA9IHsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgQWN0aW9uSGFuZGxlci5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBhY3Rpb25OYW1lLCBhY3Rpb24pIHsKICAgICAgICAgICAgdmFyIGV2ZW50cyA9IHRoaXMuZXZlbnRzOwogICAgICAgICAgICBpZighZXZlbnRzW2V2ZW50TmFtZV0pIHsKICAgICAgICAgICAgICAgIGV2ZW50c1tldmVudE5hbWVdID0gewogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZighZXZlbnRzW2V2ZW50TmFtZV1bYWN0aW9uTmFtZV0pIHsKICAgICAgICAgICAgICAgIGV2ZW50c1tldmVudE5hbWVdW2FjdGlvbk5hbWVdID0gYWN0aW9uOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdCgnVGhlIGFjdGlvbiB7MX0gaGFuZGxlciAiezB9IiBoYXMgYWxyZWFkeSBiZWVuIHRha2VuIScsIGFjdGlvbk5hbWUsIGV2ZW50TmFtZSkpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBBY3Rpb25IYW5kbGVyLnByb3RvdHlwZS51bnJlZ2lzdGVyID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgYWN0aW9uTmFtZSkgewogICAgICAgICAgICB2YXIgZXZlbnRzID0gdGhpcy5ldmVudHM7CiAgICAgICAgICAgIGlmKGV2ZW50c1tldmVudE5hbWVdICYmIGV2ZW50c1tldmVudE5hbWVdW2FjdGlvbk5hbWVdKSB7CiAgICAgICAgICAgICAgICBldmVudHNbZXZlbnROYW1lXVthY3Rpb25OYW1lXSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIEFjdGlvbkhhbmRsZXIucHJvdG90eXBlLmNhbGxiYWNrRm9yID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgcmV0dXJuUmVzdWx0cykgewogICAgICAgICAgICB2YXIgZXZlbnRzID0gdGhpcy5ldmVudHMsIGFjdGlvbkF0dHJpYnV0ZSA9IGdldEFjdGlvbkF0dHJpYnV0ZShldmVudE5hbWUpLCByZXR1cm5SZXN1bHRzRGVmaW5lZCA9IHR5cGVvZiByZXR1cm5SZXN1bHRzICE9PSAndW5kZWZpbmVkJzsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVWYWx1ZSA9ICQodGhpcykuYXR0cihhY3Rpb25BdHRyaWJ1dGUpOwogICAgICAgICAgICAgICAgaWYodHlwZW9mIGF0dHJpYnV0ZVZhbHVlID09PSBTVFJJTkcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gZXZlbnRzW2V2ZW50TmFtZV1bYXR0cmlidXRlVmFsdWVdOwogICAgICAgICAgICAgICAgICAgIGlmKGFjdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24uaGFuZGxlci5hcHBseShhY3Rpb24uY29udGV4dCB8fCB0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZihyZXR1cm5SZXN1bHRzRGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuUmVzdWx0czsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgICAgQWN0aW9uSGFuZGxlci5hY3Rpb25IYW5kbGVycyA9IHsKICAgICAgICB9OwogICAgICAgIEFjdGlvbkhhbmRsZXIuZ2V0Rm9yID0gZnVuY3Rpb24gZ2V0Rm9yKG5hbWUpIHsKICAgICAgICAgICAgaWYodGhpcy5hY3Rpb25IYW5kbGVyc1tuYW1lXSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWN0aW9uSGFuZGxlcnNbbmFtZV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICh0aGlzLmFjdGlvbkhhbmRsZXJzW25hbWVdID0gbmV3IEFjdGlvbkhhbmRsZXIoKSk7CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gQWN0aW9uSGFuZGxlcjsKICAgIH0pKCk7ICAgIAogICAgdmFyIGV2ZW50cyA9IHsKICAgICAgICBjbGljazogWwogICAgICAgICAgICAnYScsIAogICAgICAgICAgICAnYnV0dG9uJywgCiAgICAgICAgICAgICdpbnB1dFt0eXBlPSJidXR0b24iXScsIAogICAgICAgICAgICAnaW5wdXRbdHlwZT0ic3VibWl0Il0nCiAgICAgICAgXSwKICAgICAgICBkYmxjbGljazogWwogICAgICAgICAgICAnYScsIAogICAgICAgICAgICAnYnV0dG9uJywgCiAgICAgICAgICAgICdpbnB1dFt0eXBlPSJidXR0b24iXScsIAogICAgICAgICAgICAnaW5wdXRbdHlwZT0ic3VibWl0Il0nCiAgICAgICAgXSwKICAgICAgICBtb3VzZWVudGVyOiBbCiAgICAgICAgICAgICcnCiAgICAgICAgXSwKICAgICAgICBtb3VzZWxlYXZlOiBbCiAgICAgICAgICAgICcnCiAgICAgICAgXSwKICAgICAgICBmb2N1czogWwogICAgICAgICAgICAnaW5wdXQnCiAgICAgICAgXSwKICAgICAgICBibHVyOiBbCiAgICAgICAgICAgICdpbnB1dCcKICAgICAgICBdCiAgICB9OwogICAgdmFyIGFycmF5U2hvcnRIYW5kQXJnc0luT3JkZXIgPSBbCiAgICAgICAgJ25hbWUnLCAKICAgICAgICAnaGFuZGxlcicsIAogICAgICAgICdjb250ZXh0JwogICAgXTsKICAgIHZhciBtZXRob2RzID0gewogICAgICAgIHByb3BlcnRpZXM6IFsKICAgICAgICAgICAgQUNUSU9OUwogICAgICAgIF0sCiAgICAgICAgaWduaXRlOiBmdW5jdGlvbiAodGhydXN0KSB7CiAgICAgICAgICAgIHZhciBhY3Rpb25IYW5kbGVyID0gQWN0aW9uSGFuZGxlci5nZXRGb3IodGhydXN0Lm5hbWUpOwogICAgICAgICAgICB0aHJ1c3QuZG9tLmFjdGlvbkhhbmRsZXIgPSBhY3Rpb25IYW5kbGVyOwogICAgICAgICAgICB2YXIgJGJvZHkgPSAkKHdpbmRvdy5kb2N1bWVudC5ib2R5KTsKICAgICAgICAgICAgXy5lYWNoKGV2ZW50cywgZnVuY3Rpb24gKGV2ZW50U2VsZWN0b3JzLCBldmVudE5hbWUpIHsKICAgICAgICAgICAgICAgIC8vIHVzaW5nIHRocnVzdCBuYW1lLCBhcyBjYWxsYmFjayBuZWVkcyB0byBiZSBwZXIgdGhydXN0IGluc3RhbmNlCiAgICAgICAgICAgICAgICAvLyBpbiB0aGUgZXZlbnQgb2YgbXVsdGlwbGUgdGhydXN0IGluc3RhbmNlcy4KICAgICAgICAgICAgICAgICRib2R5Lm9uKGV2ZW50TmFtZSArICcuJyArIEFDVElPTlNTSU5HTEUgKyB0aHJ1c3QubmFtZSwgZXZlbnRTZWxlY3RvcnMuam9pbihnZXRBY3Rpb25BdHRyaWJ1dGUoZXZlbnROYW1lKSArICcsICcpLCBhY3Rpb25IYW5kbGVyLmNhbGxiYWNrRm9yKGV2ZW50TmFtZSwgdHJ1ZSkpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGRlb3JiaXQ6IGZ1bmN0aW9uICh0aHJ1c3QpIHsKICAgICAgICAgICAgdmFyIGFjdGlvbkhhbmRsZXIgPSBBY3Rpb25IYW5kbGVyLmdldEZvcih0aHJ1c3QubmFtZSk7CiAgICAgICAgICAgIHZhciAkYm9keSA9ICQod2luZG93LmRvY3VtZW50LmJvZHkpOwogICAgICAgICAgICBfLmVhY2goZXZlbnRzLCBmdW5jdGlvbiAoZXZlbnRTZWxlY3RvcnMsIGV2ZW50TmFtZSkgewogICAgICAgICAgICAgICAgJGJvZHkub2ZmKCcuJyArIEFDVElPTlNTSU5HTEUgKyB0aHJ1c3QubmFtZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgcmVhZHk6IGZ1bmN0aW9uIChtb2QsIGZhY2FkZSkgewogICAgICAgICAgICB2YXIgYWN0aW9ucyA9IG1vZC5jb252ZW50aW9uKEFDVElPTlMpLCBhY3Rpb25IYW5kbGVyID0gQWN0aW9uSGFuZGxlci5nZXRGb3IobW9kLnRocnVzdC5uYW1lKSwgZG9tID0gZmFjYWRlLCBtb2R1bGVJbnN0YW5jZSA9IG1vZC5pbnN0YW5jZTsKICAgICAgICAgICAgaWYoYWN0aW9ucykgewogICAgICAgICAgICAgICAgXy5mb3JPd24oYWN0aW9ucywgZnVuY3Rpb24gKGFjdGlvbkNvbGxlY3Rpb24sIGV2ZW50TmFtZSkgewogICAgICAgICAgICAgICAgICAgIGlmKCFpc0FycmF5KGFjdGlvbkNvbGxlY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkNvbGxlY3Rpb24gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25Db2xsZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGFjdGlvbkNvbGxlY3Rpb24ubGVuZ3RoICYmICghaXNBcnJheShhY3Rpb25Db2xsZWN0aW9uWzBdKSB8fCBpc1N0cmluZyhhY3Rpb25Db2xsZWN0aW9uWzBdKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQ29sbGVjdGlvbiA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkNvbGxlY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKGFjdGlvbkNvbGxlY3Rpb24sIGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNBcnJheShhY3Rpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3QWN0aW9uID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChhcnJheVNob3J0SGFuZEFyZ3NJbk9yZGVyLCBmdW5jdGlvbiAoeCwgaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHggPT09ICdoYW5kbGVyJyAmJiBpc1N0cmluZyhhY3Rpb25baV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbltpXSA9IG1vZC5pbnN0YW5jZVthY3Rpb25baV1dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdBY3Rpb25beF0gPSBhY3Rpb25baV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IG5ld0FjdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uTmFtZSA9IGFjdGlvbi5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBpZighYWN0aW9uLmhhbmRsZXIgJiYgYWN0aW9uLm1vZHVsZUhhbmRsZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbi5oYW5kbGVyID0gbW9kLmluc3RhbmNlW2FjdGlvbi5tb2R1bGVIYW5kbGVyXTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCFhY3Rpb24uaGFuZGxlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNdXN0IGRlZmluZSBlaXRoZXIgYSBoYW5kbGVyIG9yIG1vZHVsZSBoYW5kbGVyLicpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhhbmRsZXIucmVnaXN0ZXIoZXZlbnROYW1lLCBhY3Rpb25OYW1lLCBhY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0b3A6IGZ1bmN0aW9uIChtb2QsIGZhY2FkZSkgewogICAgICAgICAgICB2YXIgYWN0aW9ucyA9IG1vZC5jb252ZW50aW9uKEFDVElPTlMpLCBhY3Rpb25IYW5kbGVyID0gQWN0aW9uSGFuZGxlci5nZXRGb3IobW9kLnRocnVzdC5uYW1lKSwgbW9kdWxlSW5zdGFuY2UgPSBtb2QuaW5zdGFuY2U7CiAgICAgICAgICAgIGlmKGFjdGlvbnMpIHsKICAgICAgICAgICAgICAgIGZvcih2YXIgYWN0aW9uRXZlbnQgaW4gYWN0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25Db2xsZWN0aW9uID0gYWN0aW9uc1thY3Rpb25FdmVudF07CiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBhY3Rpb25OYW1lIGluIGFjdGlvbkNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGFuZGxlci51bnJlZ2lzdGVyKGFjdGlvbkV2ZW50LCBhY3Rpb25OYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgZXhwb3J0cy5hY3Rpb24gPSBuZXcgQ29udmVudGlvbihtZXRob2RzKTsKfSkKLy9AIHNvdXJjZU1hcHBpbmdVUkw9YWN0aW9uLmpzLm1hcAo7CmRlZmluZSgndGhydXN0L2RvbS9jb252ZW50aW9uL2FuaW1hdGUuY29udGFpbmVyJyxbInJlcXVpcmUiLCAiZXhwb3J0cyIsICd0aHJ1c3QvY29udmVudGlvbicsICd0aHJ1c3QvdXRpbCddLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBfX2NfXywgX191dGlsX18pIHsKICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvZG9tL2NvbnZlbnRpb24vY29udGV4dC5kLnRzIiAvPgogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vaW50ZXJmYWNlcy9kb20vZG9tLmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL21lZGlhdG9yL21lZGlhdG9yLmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL3RocnVzdC5kLnRzIiAvPgogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vLi4vLi4vbGliL0RlZmluaXRlbHlUeXBlZC9yZXF1aXJlanMvcmVxdWlyZS5kLnRzIiAvPgogICAgLy8gRGlzYWJsZWQgdW50aWwgVFMgc3VwcG9ydHMgbW9kdWxlIHBlciBmaWxlIGluIHNvbWUgd2F5IChpZSBleHBvcnRzIGlzIGV4cG9ydHMuPGV4cG9ydD4gbm90ICBleHBvcnRzLm1vZHVsZU5hbWUuPGV4cG9ydD4pCiAgICAvKmV4cG9ydCBtb2R1bGUgaW5zdGFuY2UgeyovCiAgICAKICAgIHZhciBjID0gX19jX187CgogICAgdmFyIENvbnZlbnRpb24gPSBjLkNvbnZlbnRpb247CiAgICB2YXIgdXRpbCA9IF9fdXRpbF9fOwoKICAgIHZhciBfID0gdXRpbC5fOwogICAgdmFyIGV2ZW50ID0gewogICAgICAgIGFueUNvbnRhaW5lcjogJ3RocnVzdC1jb252ZW50aW9uLWNvbnRhaW5lci1hbnknLAogICAgICAgIGNoYW5nZUNvbnRhaW5lcjogJ3RocnVzdC1jb252ZW50aW9uLWNvbnRhaW5lci1jaGFuZ2UnCiAgICB9LCBhbnkgPSBfLmFueSwgZGVmZXIgPSBfLmRlZmVyLCBiaW5kID0gXy5iaW5kLCBTVEFSVCA9ICdzdGFydC1zdGF0dXMnLCBBTklNQVRFID0gJ2FuaW1hdGUnLCBDT05UQUlORVIgPSAnY29udGFpbmVyJywgQ09OVEVYVCA9ICdjb250ZXh0JzsKICAgIHZhciBtZXRob2RzID0gewogICAgICAgIHByb3BlcnRpZXM6IFsKICAgICAgICAgICAgQU5JTUFURQogICAgICAgIF0sCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKG1vZCwgZmFjYWRlKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgbWVkaWF0b3IgPSBtb2QuaW5zdGFuY2UubWVkaWF0b3I7CiAgICAgICAgICAgIG1lZGlhdG9yLnN1YnNjcmliZShldmVudC5jaGFuZ2VDb250YWluZXIsIGJpbmQodGhhdC5jaGFuZ2UsIHRoYXQsIG1vZCkpOwogICAgICAgIH0sCiAgICAgICAgY2hhbmdlOiBmdW5jdGlvbiAobW9kdWxlLCBjb250YWluZXIpIHsKICAgICAgICAgICAgaWYobW9kdWxlLmNvbnZlbnRpb24oQ09OVEFJTkVSKSA9PT0gY29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICBpZihtb2R1bGUuY29udmVudGlvbihTVEFSVCkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYW5pbWF0ZSA9IG1vZHVsZS5jb252ZW50aW9uKEFOSU1BVEUpOwogICAgICAgICAgICAgICAgICAgIGlmKGFuaW1hdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRleHROb2RlID0gbW9kdWxlLmluc3RhbmNlLmRvbSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0Tm9kZS5yZW1vdmVDbGFzcyhhbmltYXRlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlYWR5OiBmdW5jdGlvbiAobW9kLCBmYWNhZGUpIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBhbmltYXRlID0gbW9kLmNvbnZlbnRpb24oQU5JTUFURSksIGNvbnRhaW5lciA9IG1vZC5jb252ZW50aW9uKENPTlRBSU5FUiksIGNvbnRleHQgPSBtb2QuY29udmVudGlvbihDT05URVhUKSwgZG9tID0gZmFjYWRlOwogICAgICAgICAgICBpZihhbmltYXRlICYmIGNvbnRhaW5lcikgewogICAgICAgICAgICAgICAgdmFyIGNsb25lID0gZG9tLmNvbnRleHQuY2xvbmUoKS5hcHBlbmRUbyhkb20uY29udGV4dC5wYXJlbnQoKSk7CiAgICAgICAgICAgICAgICBjbG9uZS5hZGRDbGFzcyhhbmltYXRlLnJlcGxhY2UoL1wuL2csICcgJykudHJpbSgpKTsKICAgICAgICAgICAgICAgIG1vZC5pbnN0YW5jZS5kb20gPSBtb2QuaW5zdGFuY2UuJCA9IGNsb25lOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChiaW5kKHRoYXQuY2xlYW51cCwgdGhhdCwgZG9tLmNvbnRleHQucGFyZW50KCksIGFuaW1hdGUsIGNvbnRleHQpLCAyMDAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY2xlYW51cDogZnVuY3Rpb24gKGNvbnRhaW5lciwgYW5pbWF0ZSwgY29udGV4dCkgewogICAgICAgICAgICBjb250YWluZXIuZmluZChjb250ZXh0KS5maWx0ZXIoJzpub3QoJyArIGFuaW1hdGUgKyAnKScpLnJlbW92ZSgpOwogICAgICAgIH0KICAgIH07CiAgICBleHBvcnRzLmFuaW1hdGVDb250YWluZXIgPSBuZXcgQ29udmVudGlvbihtZXRob2RzKTsKfSkKLy9AIHNvdXJjZU1hcHBpbmdVUkw9YW5pbWF0ZS5jb250YWluZXIuanMubWFwCjsKZGVmaW5lKCd0aHJ1c3QvZG9tL2NvbnZlbnRpb24vY29udGV4dCcsWyJyZXF1aXJlIiwgImV4cG9ydHMiLCAndGhydXN0L2NvbnZlbnRpb24nLCAndGhydXN0L3V0aWwnLCAnLi4vc3VianF1ZXJ5J10sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIF9fY19fLCBfX3V0aWxfXywgX19zdWJqcXVlcnlfXykgewogICAgLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi4vLi4vaW50ZXJmYWNlcy9kb20vY29udmVudGlvbi9jb250ZXh0LmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL21lZGlhdG9yL21lZGlhdG9yLmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL2RvbS9kb20uZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvdGhydXN0LmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi8uLi8uLi9saWIvRGVmaW5pdGVseVR5cGVkL3JlcXVpcmVqcy9yZXF1aXJlLmQudHMiIC8+CiAgICAvLyBEaXNhYmxlZCB1bnRpbCBUUyBzdXBwb3J0cyBtb2R1bGUgcGVyIGZpbGUgaW4gc29tZSB3YXkgKGllIGV4cG9ydHMgaXMgZXhwb3J0cy48ZXhwb3J0PiBub3QgIGV4cG9ydHMubW9kdWxlTmFtZS48ZXhwb3J0PikKICAgIC8qZXhwb3J0IG1vZHVsZSBpbnN0YW5jZSB7Ki8KICAgIAogICAgdmFyIGMgPSBfX2NfXzsKCiAgICB2YXIgQ29udmVudGlvbiA9IGMuQ29udmVudGlvbjsKICAgIHZhciB1dGlsID0gX191dGlsX187CgogICAgdmFyIF8gPSB1dGlsLl87CiAgICB2YXIgc3VianF1ZXJ5ID0gX19zdWJqcXVlcnlfXzsKCiAgICB2YXIgdFF1ZXJ5ID0gc3VianF1ZXJ5LnRRdWVyeTsKICAgIHZhciBDT05URVhUID0gJ2NvbmZpZy5kb20uY29udGV4dCc7CiAgICB2YXIgbWV0aG9kcyA9IHsKICAgICAgICBwcm9wZXJ0aWVzOiBbCiAgICAgICAgICAgIENPTlRFWFQKICAgICAgICBdLAogICAgICAgIHJlYWR5OiBmdW5jdGlvbiAobW9kLCBmYWNhZGUpIHsKICAgICAgICAgICAgdmFyIGNvbnRleHQgPSBtb2QuY29udmVudGlvbihDT05URVhUKTsKICAgICAgICAgICAgaWYoY29udGV4dCkgewogICAgICAgICAgICAgICAgbW9kLmluc3RhbmNlLmRvbSA9IG1vZC5pbnN0YW5jZS4kID0gdFF1ZXJ5KGNvbnRleHQsIGZhY2FkZS5jb250ZXh0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBleHBvcnRzLmNvbnRleHQgPSBuZXcgQ29udmVudGlvbihtZXRob2RzKTsKfSkKLy9AIHNvdXJjZU1hcHBpbmdVUkw9Y29udGV4dC5qcy5tYXAKOwpkZWZpbmUoJ3RocnVzdC9kb20vY29udmVudGlvbi9ldmVudCcsWyJyZXF1aXJlIiwgImV4cG9ydHMiLCAndGhydXN0L2NvbnZlbnRpb24nLCAndGhydXN0L3V0aWwnXSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgX19jX18sIF9fdXRpbF9fKSB7CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL2RvbS9jb252ZW50aW9uL2V2ZW50LmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL21lZGlhdG9yL21lZGlhdG9yLmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi9pbnRlcmZhY2VzL2RvbS9kb20uZC50cyIgLz4KICAgIC8vLyA8cmVmZXJlbmNlIHBhdGg9Ii4uLy4uL2ludGVyZmFjZXMvdGhydXN0LmQudHMiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBwYXRoPSIuLi8uLi8uLi8uLi9saWIvRGVmaW5pdGVseVR5cGVkL3JlcXVpcmVqcy9yZXF1aXJlLmQudHMiIC8+CiAgICAvLyBEaXNhYmxlZCB1bnRpbCBUUyBzdXBwb3J0cyBtb2R1bGUgcGVyIGZpbGUgaW4gc29tZSB3YXkgKGllIGV4cG9ydHMgaXMgZXhwb3J0cy48ZXhwb3J0PiBub3QgIGV4cG9ydHMubW9kdWxlTmFtZS48ZXhwb3J0PikKICAgIC8qZXhwb3J0IG1vZHVsZSBpbnN0YW5jZSB7Ki8KICAgIAogICAgdmFyIGMgPSBfX2NfXzsKCiAgICB2YXIgQ29udmVudGlvbiA9IGMuQ29udmVudGlvbjsKICAgIHZhciB1dGlsID0gX191dGlsX187CgogICAgdmFyIF8gPSB1dGlsLl87CiAgICB2YXIgQ09OVEVYVCA9ICdjb25maWcuZG9tLmNvbnRleHQnLCBFVkVOVFMgPSAnY29uZmlnLmRvbS5ldmVudHMnLCBpc0Z1bmN0aW9uID0gXy5pc0Z1bmN0aW9uLCBpc1N0cmluZyA9IF8uaXNTdHJpbmcsIGlzQXJyYXkgPSBfLmlzQXJyYXk7CiAgICB2YXIgZXZlbnRQcm9wZXJ0eUxvYWRPcmRlciA9IFsKICAgICAgICAnc2VsZWN0b3InLCAKICAgICAgICAnZGF0YScsIAogICAgICAgICdoYW5kbGVyJwogICAgXTsKICAgIHZhciBtZXRob2RzID0gewogICAgICAgIHByb3BlcnRpZXM6IFsKICAgICAgICAgICAgRVZFTlRTCiAgICAgICAgXSwKICAgICAgICByZWFkeTogZnVuY3Rpb24gKG1vZCwgZmFjYWRlKSB7CiAgICAgICAgICAgIHZhciBldmVudHMgPSBtb2QuY29udmVudGlvbihFVkVOVFMpLCAkY29udGV4dCA9IGZhY2FkZS5jb250ZXh0LCBtb2R1bGVJbnN0YW5jZSA9IG1vZC5pbnN0YW5jZTsKICAgICAgICAgICAgaWYoZXZlbnRzKSB7CiAgICAgICAgICAgICAgICBfLmZvckluKGV2ZW50cywgZnVuY3Rpb24gKGV2ZW50c0NvbGxlY3Rpb24sIGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgLy92YXIgZXZlbnRzQ29sbGVjdGlvbiA9IGV2ZW50c1tldmVudF07CiAgICAgICAgICAgICAgICAgICAgaWYoIWlzQXJyYXkoZXZlbnRzQ29sbGVjdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRzQ29sbGVjdGlvbiA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50c0NvbGxlY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoZXZlbnRzQ29sbGVjdGlvbi5sZW5ndGggJiYgKCFpc0FycmF5KGV2ZW50c0NvbGxlY3Rpb25bMF0pIHx8IGlzU3RyaW5nKGV2ZW50c0NvbGxlY3Rpb25bMF0pKSkgewogICAgICAgICAgICAgICAgICAgICAgICBldmVudHNDb2xsZWN0aW9uID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRzQ29sbGVjdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfLmVhY2goZXZlbnRzQ29sbGVjdGlvbiwgZnVuY3Rpb24gKGRlZmluaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJpbmRFdmVudCA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50CiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzQXJyYXkoZGVmaW5pdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRFdmVudC5wdXNoLmFwcGx5KGJpbmRFdmVudCwgZGVmaW5pdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIG9uZSBlZGdlY2FzZSBoZXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc2hvcnQgaGFuZCBhcnJheSwgaGFzIGEgY29udGV4dCB0aGF0IGlzIGEgc3RyaW5nIG9yIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgaXQgZG9lc250IGhhdmUgaW5mb3JtYXRpb24gZm9yIGJvdGggc2VsZWN0b3IgYW5kIGRhdGEsIHRoaXMgd2lsbCBmYWlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBjYW4gcmVjb3ZlciB3aGVuIGFsbCA1IHBvc3NpYmxlIGl0ZW1zIGFyZSBkZWZpbmVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBiaW5kRXZlbnRbYmluZEV2ZW50Lmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugd2VyZSBhc2tlZCBmb3IgYSBtZXRob2Qgb24gdGhlIG1vZHVsZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzU3RyaW5nKGhhbmRsZXIpICYmIGJpbmRFdmVudC5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5kRXZlbnRbYmluZEV2ZW50Lmxlbmd0aCAtIDFdID0gbW9kLmluc3RhbmNlW2hhbmRsZXJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIC8vIFdlIGRpZG50IGZpbmQgYSBmdW5jdGlvbiA6KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEVER0UgQ0FTRTogSWYgY29udGV4dCBpcyBhIGZ1bmN0aW9uLCB3ZSB3aWxsIGFzc3VtZSBhbGwgaXMgd2VsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgIEV2ZW4gaWYgdGhlIGhhbmRsZXIgaXMgYSBzdHJpbmcgdGhhdCBuZWVkcyB0byBiZSByZWZlcmVuY2VkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV29yayBhcnJvdW5kczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgU2hvcnRoYW5kOiBhZGQgbnVsbC9lbXB0eSB2YWx1ZXMgZm9yIHNlbGVjdG9yIGFuZCBkYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgIExvbmdoYW5kOiBzd2l0Y2ggdG8gbG9uZyBoYW5kIGFzIGl0IGhhcyBtb3JlIGV4cGxpY2l0IHN5bnRheC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFpc1N0cmluZyhoYW5kbGVyKSAmJiAhaXNGdW5jdGlvbihoYW5kbGVyKSAmJiBiaW5kRXZlbnQubGVuZ3RoID4gMiB8fCBiaW5kRXZlbnQubGVuZ3RoID09PSA1KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlciA9IGJpbmRFdmVudFtiaW5kRXZlbnQubGVuZ3RoIC0gMl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNTdHJpbmcoaGFuZGxlcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZEV2ZW50W2JpbmRFdmVudC5sZW5ndGggLSAyXSA9IG1vZC5pbnN0YW5jZVtoYW5kbGVyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZEV2ZW50W2JpbmRFdmVudC5sZW5ndGggLSAyXSA9IF8uYmluZChiaW5kRXZlbnRbYmluZEV2ZW50Lmxlbmd0aCAtIDJdLCBiaW5kRXZlbnQucG9wKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGlzU3RyaW5nKGhhbmRsZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZEV2ZW50W2JpbmRFdmVudC5sZW5ndGggLSAxXSA9IG1vZC5pbnN0YW5jZVtoYW5kbGVyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChldmVudFByb3BlcnR5TG9hZE9yZGVyLCBmdW5jdGlvbiAoeCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRlZmluaXRpb25beF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZGVmaW5pdGlvblt4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoeCA9PT0gJ2hhbmRsZXInICYmIGRlZmluaXRpb24uY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBfLmJpbmQodmFsdWUsIGRlZmluaXRpb24uY29udGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluZEV2ZW50LnB1c2godmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhbGwgdGhlIG9uIG1ldGhvZCwgd2l0aCBvdXIgYXJndW1lbnRzLgogICAgICAgICAgICAgICAgICAgICAgICAkY29udGV4dC5vbi5hcHBseSgkY29udGV4dCwgYmluZEV2ZW50KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzdG9wOiBmdW5jdGlvbiAobW9kLCBmYWNhZGUpIHsKICAgICAgICAgICAgdmFyIGV2ZW50cyA9IG1vZC5jb252ZW50aW9uKEVWRU5UUyksICRjb250ZXh0ID0gZmFjYWRlLmNvbnRleHQ7CiAgICAgICAgICAgIGlmKCRjb250ZXh0KSB7CiAgICAgICAgICAgICAgICAkY29udGV4dC5vZmYoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBleHBvcnRzLmV2ZW50ID0gbmV3IENvbnZlbnRpb24obWV0aG9kcyk7Cn0pCi8vQCBzb3VyY2VNYXBwaW5nVVJMPWV2ZW50LmpzLm1hcAo7",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 20:05:27 GMT",
                    "Content-Length": "26787",
                    "Date": "Sat, 08 Nov 2014 20:05:28 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}