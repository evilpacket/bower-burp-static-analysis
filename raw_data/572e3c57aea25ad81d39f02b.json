{
    "url": "http://localhost:9999/jsxgraph/jsxgraph/examples/adg/cubic.html",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.href</b> and written to <b>window.location.href</b> via the following statement:<ul><li>window.location.href=window.location.href.split('?')[0]</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/jsxgraph/jsxgraph/examples/adg/cubic.html",
                "path": "/jsxgraph/jsxgraph/examples/adg/cubic.html",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9qc3hncmFwaC9qc3hncmFwaC9leGFtcGxlcy9hZGcvY3ViaWMuaHRtbCBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTAyNDUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IHRleHQvaHRtbDsgY2hhcnNldD11dGYtOA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAwNzo1MTo0MCBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMDc6NTE6NDAgR01UDQoNCjxodG1sPgo8aGVhZD4KICAgPHRpdGxlPkxpbWEmY2NlZGlsO29uIHwgSlNYR3JhcGggRXhhbXBsZTwvdGl0bGU+CiAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIGhyZWY9Ii4uLy4uL2Rpc3RyaWIvanN4Z3JhcGguY3NzIiAvPgogICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSIuLi8uLi9zcmMvbG9hZGpzeGdyYXBoLmpzIj48L3NjcmlwdD4KPC9oZWFkPgo8Ym9keT4KPGRpdiBpZD0iZGVidWciIHN0eWxlPSJkaXNwbGF5OiBub25lIj48L2Rpdj4KPGNlbnRlcj4KPGRpdiBzdHlsZT0id2lkdGg6IDEwMDBweDsiPgogICAgPGRpdiBzdHlsZT0id2lkdGg6NTAwcHg7IGhlaWdodDogNTEwcHg7Ij4KICA8ZGl2IGlkPSJqeGdib3giIGNsYXNzPSJqeGdib3giIHN0eWxlPSJ3aWR0aDo1MDBweDsgaGVpZ2h0OjUwMHB4OyB0ZXh0LWFsaWduOiBsZWZ0OyBmbG9hdDogbGVmdDsiPjwvZGl2PgogIDxkaXYgaWQ9InBvbHlub21pYWxzIiBzdHlsZT0iZGlzcGxheTogbm9uZTsgd2lkdGg6IDUwMHB4OyBoZWlnaHQ6IDUwMHB4OyBtYXJnaW4tbGVmdDogMTBweDsgdGV4dC1hbGlnbjogbGVmdDsgcGFkZGluZy1sZWZ0OiAtMjAwcHg7Ij48L2Rpdj4KICA8L2Rpdj4KCiAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogODAwcHg7IG1hcmdpbi10b3A6IDEwcHg7Ij4KICA8Zm9ybT4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iY2hvb3NlQ29vcmRpbmF0ZVN5c3RlbSgpOyIgdmFsdWU9IkNob29zZSBjb29yZGluYXRlIHN5c3RlbSIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZ2VuZXJhdGVQb2x5bm9taWFscygpOyIgdmFsdWU9IkdlbmVyYXRlIHN5c3RlbSBvZiBwb2x5bm9taWFsIGVxdWF0aW9ucyIgLz4KICAgICAgPGJyIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImNhbGN1bGF0ZUxvY3VzKCk7IiB2YWx1ZT0iQ2FsY3VsYXRlIGxvY3VzIG9mIFQiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9InNob3dMb2N1c0VxdWF0aW9uKCk7IiB2YWx1ZT0iU2hvdyBsb2N1cyBlcXVhdGlvbiIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0ic2hvd0JvYXJkKCk7IiB2YWx1ZT0iU2hvdyBib2FyZCIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0ic2hvd0xvY3VzVGltZShsb2MpIiB2YWx1ZT0iU2hvdyBsb2N1cyB0aW1lIiAvPgogICAgICA8YnIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZXh0ZW5kKCk7IiB2YWx1ZT0iRXh0ZW5kIHRoZSBjb25zdHJ1Y3Rpb24gKHdpdGggZ2xpZGVyKSIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZXh0ZW5kZWRMb2N1cygpOyIgdmFsdWU9IkNhbGN1bGF0ZSBleHRlbmRlZCBsb2N1cyAoYmFzZWQgb24gZ2xpZGVyIEMpIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJzaG93TG9jdXNUaW1lKGxvYzIpIiB2YWx1ZT0iU2hvdyBsb2N1cyB0aW1lIiAvPgogICAgICA8YnIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZXh0ZW5kMigpOyIgdmFsdWU9IkV4dGVuZCB0aGUgY29uc3RydWN0aW9uIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJleHRlbmRlZExvY3VzMigpOyIgdmFsdWU9IkNhbGN1bGF0ZSBleHRlbmRlZCBsb2N1cyIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0ic2hvd0xvY3VzVGltZShsb2MzKSIgdmFsdWU9IlNob3cgbG9jdXMgdGltZSIgLz4KICAgICAgPGJyIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT0iMC4yIiBpZD0iZGltIiBzaXplPSIzIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkaW1Db25zdHJ1Y3Rpb24oKTsiIHZhbHVlPSJEaW0gY29uc3RydWN0aW9uIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkaW1Mb2N1cygpOyIgdmFsdWU9IkRpbSBsb2N1cyIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZGltRXh0ZW5zaW9uKCk7IiB2YWx1ZT0iRGltIGV4dGVuc2lvbiIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZGltRXh0ZW5zaW9uMigpOyIgdmFsdWU9IkRpbSBleHRlbnNpb24gMiIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZGltTG9jdXMyKCk7IiB2YWx1ZT0iRGltIGV4dGVuZGVkIGxvY2kiIC8+CiAgICAgIDxiciAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJydW5Db21wYXJpc29uKCk7IiB2YWx1ZT0iUnVuIGNvbXBhcmlzb24iPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJ3aW5kb3cubG9jYXRpb24uaHJlZj13aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnPycpWzBdIiB2YWx1ZT0iUmVsb2FkIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJ0b2dnbGVPcHRpbWl6ZSgpOyIgaWQ9Im9wdCIgdmFsdWU9Ik9wdGltaXphdGlvbiBpcyBvZmYiPgogIDwvZm9ybT4KICA8L2Rpdj4KPC9kaXY+CjwvY2VudGVyPgogICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CiAgICAvKiA8IVtDREFUQVsgKi8KCiAgICBib2FyZCA9IEpYRy5KU1hHcmFwaC5pbml0Qm9hcmQoJ2p4Z2JveCcsIHtib3VuZGluZ2JveDogWy0xMSwgMTEsIDExLCAtMTFdLCBheGlzOiB0cnVlLCBncmlkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZWVwYXNwZWN0cmF0aW86IHRydWUsIHNob3djb3B5cmlnaHQ6IGZhbHNlfSk7CgovLyAgICBib2FyZC5zdXNwZW5kVXBkYXRlKCk7CiAgICBhID0gYm9hcmQuY3JlYXRlRWxlbWVudCgncG9pbnQnLCBbOCwgLTFdKTsKICAgIGMgPSBib2FyZC5jcmVhdGVFbGVtZW50KCdmdW5jdGlvbmdyYXBoJywgW2Z1bmN0aW9uICh4KSB7IHJldHVybiB4KngqeDsgfV0pOwogICAgYy5nZW5lcmF0ZVBvbHlub21pYWwgPSBmdW5jdGlvbiAocCkgewogICAgCXJldHVybiBbJygnICsgcC5zeW1ib2xpYy54ICsgJyleMyAtICgnICsgcC5zeW1ib2xpYy55ICsgJyknXTsKICAgIH07CgliID0gYm9hcmQuY3JlYXRlKCdnbGlkZXInLCBbY10pOwogICAgZCA9IGJvYXJkLmNyZWF0ZUVsZW1lbnQoJ2NpcmNsZScsIFthLCA0XSk7CiAgICBlID0gYm9hcmQuY3JlYXRlRWxlbWVudCgnY2lyY2xlJywgW2IsIDVdKTsKICAgIGYgPSBib2FyZC5jcmVhdGUoJ2ludGVyc2VjdGlvbicsIFtkLCBlLCAwXSk7CiAgICB6ID0gYm9hcmQuY3JlYXRlKCdtaWRwb2ludCcsIFtiLCBmXSk7CgogICAgbG9jID0gbnVsbDsKCiAgICB0Zz1udWxsOwogICAgdGM9bnVsbDsKICAgIHRpPW51bGw7CiAgICB0bT1udWxsOwogICAgbG9jMiA9IG51bGw7CgogICAgdGMyPW51bGw7CiAgICB0aTI9bnVsbDsKICAgIHRtMj1udWxsOwogICAgbG9jMyA9IG51bGw7CgogICAgb3B0ID0gZmFsc2U7CiAgICAKICAgIC8vYm9hcmQub3B0aW9ucy5sb2N1cy50cmFuc2xhdGVUb09yaWdpbiA9IHRydWU7Ci8vICAgIGJvYXJkLm9wdGlvbnMubG9jdXMudG9PcmlnaW4gPSA7CiAgICAvL2JvYXJkLm9wdGlvbnMubG9jdXMudHJhbnNsYXRlVG8xMCA9IHRydWU7Ci8vICAgIGJvYXJkLm9wdGlvbnMubG9jdXMudG8xMCA9IHA0OwoKICAgIHRsID0gYm9hcmQuY3JlYXRlKCdsb2N1cycsIFt6XSwge3N0cm9rZVdpZHRoOiAnM3B4Jywgc3Ryb2tlT3BhY2l0eTogMC45LCBzdHJva2VDb2xvcjogJ2JsYWNrJ30pOwogICAgCiAgICBpID0gYm9hcmQuY3JlYXRlKCdnbGlkZXInLCBbdGxdKTsKICAgIGogPSBib2FyZC5jcmVhdGUoJ2NpcmNsZScsIFtpLCA0XSk7CiAgICBrID0gYm9hcmQuY3JlYXRlKCdpbnRlcnNlY3Rpb24nLCBbaiwgZSwgMF0pOwogICAgbCA9IGJvYXJkLmNyZWF0ZSgnbWlkcG9pbnQnLCBbaywgYV0pOwogICAgdGwyID0gYm9hcmQuY3JlYXRlKCdsb2N1cycsIFtsXSk7CiAgICAKCiAgICBmdW5jdGlvbiBjaG9vc2VDb29yZGluYXRlU3lzdGVtKCkgewogICAgICAgIHZhciBrLCBvOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIEpYRy5NYXRoLlN5bWJvbGljLmdlbmVyYXRlU3ltYm9saWNDb29yZGluYXRlc1BhcnRpYWwoYm9hcmQsIHAxNF8xLCAndScsICdicmFjZScpOwoKICAgICAgICBmb3IoayBpbiBib2FyZC5vYmplY3RzKSB7CiAgICAgICAgICAgIG8gPSBib2FyZC5vYmplY3RzW2tdOwogICAgICAgICAgICBpZihvLmVsZW1lbnRDbGFzcyA9PSBKWEcuT0JKRUNUX0NMQVNTX1BPSU5UKSB7CiAgICAgICAgICAgICAgICBvLmxhYmVsLmNvbnRlbnQuc2V0VGV4dChvLm5hbWUgKyAnICgnICsgby5zeW1ib2xpYy54ICsgJywgJyArIG8uc3ltYm9saWMueSArICcpJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJvYXJkLnVwZGF0ZSgpOwogICAgICAgIEpYRy5NYXRoLlN5bWJvbGljLmNsZWFyU3ltYm9saWNDb29yZGluYXRlcyhib2FyZCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2VuZXJhdGVQb2x5bm9taWFscygpIHsKICAgICAgICB2YXIgcmVzID0gSlhHLk1hdGguU3ltYm9saWMuZ2VuZXJhdGVQb2x5bm9taWFscyhib2FyZCwgcDE0XzEsIHRydWUpLAogICAgICAgICAgICBpLCBvdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKTsKCiAgICAgICAgb3V0LmlubmVySFRNTCA9ICc8dWw+JzsKICAgICAgICBmb3IoaT0wOyBpPHJlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgb3V0LmlubmVySFRNTCArPSAnPGxpPicgKyByZXNbaV0gKyAnID0gMDwvbGk+JzsKICAgICAgICBvdXQuaW5uZXJIVE1MICs9ICc8L3VsPic7CiAgICAgICAgb3V0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqeGdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUxvY3VzKCkgewogICAgICAgIGxvYyA9IGJvYXJkLmNyZWF0ZSgnbG9jdXMnLCBbcDE0XzFdLCB7c3Ryb2tlQ29sb3I6ICdibGFjaycsIHN0cm9rZVdpZHRoOiAnMnB4J30pOwogICAgfQoKICAgIGZ1bmN0aW9uIHNob3dMb2N1c0VxdWF0aW9uKCkgewogICAgICAgIHZhciBvdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKTsKCiAgICAgICAgb3V0LmlubmVySFRNTCA9ICc8dWw+JzsKICAgICAgICBmb3IoaT0wOyBpPGxvYy5lcS5sZW5ndGg7IGkrKykKICAgICAgICAgICAgb3V0LmlubmVySFRNTCArPSAnPGxpPicgKyBsb2MuZXFbaV0gKyAnID0gMDwvbGk+JzsKICAgICAgICBvdXQuaW5uZXJIVE1MICs9ICc8L3VsPic7CiAgICAgICAgb3V0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqeGdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfQoKICAgIGZ1bmN0aW9uIHNob3dCb2FyZCgpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqeGdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaW1Db25zdHJ1Y3Rpb24oKSB7CiAgICAgICAgdmFyIGMgPSBbcDMsIHA0LCBjMSwgZywgcDYsIGMyLCBwMTRfMV0sIGksIG8gPSBnZXREaW0oKTsKCiAgICAgICAgaWYocDMudmlzUHJvcFsnc3Ryb2tlT3BhY2l0eSddID09IG8pCiAgICAgICAgICAgIG8gPSAxLjA7CgogICAgICAgIGZvcihpPTA7IGk8Yy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjW2ldLnNldFByb3BlcnR5KHtzdHJva2VPcGFjaXR5OiBvLCBmaWxsT3BhY2l0eTogb30pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkaW1Mb2N1cygpIHsKICAgICAgICB2YXIgbyA9IGdldERpbSgpOwoKICAgICAgICBpZihsb2MgIT0gbnVsbCkgewogICAgICAgICAgICBpZihsb2MudmlzUHJvcFsnc3Ryb2tlT3BhY2l0eSddID09IG8pCiAgICAgICAgICAgICAgICBvID0gMS4wOwogICAgICAgICAgICBsb2Muc2V0UHJvcGVydHkoe3N0cm9rZU9wYWNpdHk6IG99KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZGltTG9jdXMyKCkgewogICAgICAgIHZhciBvID0gZ2V0RGltKCk7CgogICAgICAgIGlmKGxvYzIgIT0gbnVsbCkgewogICAgICAgICAgICBpZihsb2MyLnZpc1Byb3BbJ3N0cm9rZU9wYWNpdHknXSA9PSBvKQogICAgICAgICAgICAgICAgbyA9IDEuMDsKICAgICAgICAgICAgbG9jMi5zZXRQcm9wZXJ0eSh7c3Ryb2tlT3BhY2l0eTogb30pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBleHRlbmQoKSB7CiAgICAgICAgaWYobG9jPT1udWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGJvYXJkLnN1c3BlbmRVcGRhdGUoKTsKICAgICAgICB0ZyA9IGJvYXJkLmNyZWF0ZSgnZ2xpZGVyJywgW2xvY10pOwoKICAgICAgICB0YyA9IGJvYXJkLmNyZWF0ZSgnY2lyY2xlJywgW3RnLCAzXSk7CiAgICAgICAgdGkgPSBib2FyZC5jcmVhdGUoJ2ludGVyc2VjdGlvbicsIFt0YywgYzEsIDBdLCB7Y29sb3I6ICdibHVlJ30pOwogICAgICAgIHRtID0gYm9hcmQuY3JlYXRlKCdtaWRwb2ludCcsIFt0ZywgdGldLCB7Y29sb3I6ICdncmVlbid9KTsKICAgICAgICBib2FyZC51bnN1c3BlbmRVcGRhdGUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaW1FeHRlbnNpb24oKSB7CiAgICAgICAgaWYodGcgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICB2YXIgYyA9IFt0ZywgdGMsIHRpLCB0bV0sIGksIG8gPSBnZXREaW0oKTsKCiAgICAgICAgaWYodGcudmlzUHJvcFsnc3Ryb2tlT3BhY2l0eSddID09IG8pCiAgICAgICAgICAgIG8gPSAxLjA7CgogICAgICAgIGZvcihpPTA7IGk8Yy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjW2ldLnNldFByb3BlcnR5KHtzdHJva2VPcGFjaXR5OiBvLCBmaWxsT3BhY2l0eTogb30pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXREaW0oKSB7CiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpbScpLnZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBleHRlbmRlZExvY3VzKCkgewogICAgICAgIGxvYzIgPSBib2FyZC5jcmVhdGUoJ2xvY3VzJywgW3RtXSwge3N0cm9rZUNvbG9yOiAnYmxhY2snLCBzdHJva2VXaWR0aDogJzRweCd9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBleHRlbmQyKCkgewogICAgICAgIGJvYXJkLnN1c3BlbmRVcGRhdGUoKTsKICAgICAgICB0YzIgPSBib2FyZC5jcmVhdGUoJ2NpcmNsZScsIFtwMTRfMSwgM10pOwogICAgICAgIHRpMiA9IGJvYXJkLmNyZWF0ZSgnaW50ZXJzZWN0aW9uJywgW3RjMiwgYzEsIDBdLCB7Y29sb3I6ICdibHVlJ30pOwogICAgICAgIHRtMiA9IGJvYXJkLmNyZWF0ZSgnbWlkcG9pbnQnLCBbcDE0XzEsIHRpMl0sIHtjb2xvcjogJ2dyZWVuJ30pOwogICAgICAgIGJvYXJkLnVuc3VzcGVuZFVwZGF0ZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpbUV4dGVuc2lvbjIoKSB7CiAgICAgICAgaWYodGcgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICB2YXIgYyA9IFt0YzIsIHRpMiwgdG0yXSwgaSwgbyA9IGdldERpbSgpOwoKICAgICAgICBpZih0YzIudmlzUHJvcFsnc3Ryb2tlT3BhY2l0eSddID09IG8pCiAgICAgICAgICAgIG8gPSAxLjA7CgogICAgICAgIGZvcihpPTA7IGk8Yy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjW2ldLnNldFByb3BlcnR5KHtzdHJva2VPcGFjaXR5OiBvLCBmaWxsT3BhY2l0eTogb30pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBleHRlbmRlZExvY3VzMigpIHsKICAgICAgICBsb2MzID0gYm9hcmQuY3JlYXRlKCdsb2N1cycsIFt0bTJdLCB7c3Ryb2tlQ29sb3I6ICdncmVlbicsIHN0cm9rZVdpZHRoOiAnMnB4J30pOwogICAgfQoKICAgIGZ1bmN0aW9uIHNob3dMb2N1c1RpbWUobCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqeGdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKS5pbm5lckhUTUwgPSBsLmN0aW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvZ2dsZU9wdGltaXplKCkgewogICAgICAgIGlmKG9wdCkgewogICAgICAgICAgICBib2FyZC5vcHRpb25zLmxvY3VzLnRyYW5zbGF0ZVRvT3JpZ2luID0gZmFsc2U7CiAgICAgICAgICAgIGJvYXJkLm9wdGlvbnMubG9jdXMudHJhbnNsYXRlVG8xMCA9IGZhbHNlOwogICAgICAgICAgICBvcHQgPSBmYWxzZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wdCcpLnZhbHVlID0gIk9wdGltaXphdGlvbiBpcyBvZmYiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJvYXJkLm9wdGlvbnMubG9jdXMudHJhbnNsYXRlVG9PcmlnaW4gPSB0cnVlOwogICAgICAgICAgICBib2FyZC5vcHRpb25zLmxvY3VzLnRyYW5zbGF0ZVRvMTAgPSB0cnVlOwogICAgICAgICAgICBvcHQgPSB0cnVlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3B0JykudmFsdWUgPSAiT3B0aW1pemF0aW9uIGlzIG9uIjsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcnVuQ29tcGFyaXNvbigpIHsKICAgICAgICBjYWxjdWxhdGVMb2N1cygpOwogICAgICAgIGV4dGVuZCgpOwogICAgICAgIGV4dGVuZGVkTG9jdXMoKTsKCiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZisnP3RpbWUwPScrbG9jLmN0aW1lKycmdGltZTE9Jytsb2MyLmN0aW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIHJ1bkNvbXBhcmlzb24yKCkgewogICAgICAgIGV4dGVuZDIoKTsKICAgICAgICBleHRlbmRlZExvY3VzMigpOwoKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmKycmdGltZTI9Jytsb2MzLmN0aW1lOwogICAgfQoKKGZ1bmN0aW9uKHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewogICAgdmFyIHIsIHRpbWUwLCB0aW1lMSwgdGltZTIsIGk7CiAgICBpZih3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCd0aW1lMScpPi0xKSB7CiAgICAgICAgciA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCc/JylbMV0uc3BsaXQoJyYnKTsKICAgICAgICBmb3IoaT0wOyBpPHIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYocltpXS5zcGxpdCgnPScpWzBdID09ICd0aW1lMCcpCiAgICAgICAgICAgICAgICB0aW1lMCA9IHJbaV0uc3BsaXQoJz0nKVsxXTsKCiAgICAgICAgICAgIGlmKHJbaV0uc3BsaXQoJz0nKVswXSA9PSAndGltZTEnKQogICAgICAgICAgICAgICAgdGltZTEgPSByW2ldLnNwbGl0KCc9JylbMV07CgogICAgICAgICAgICBpZihyW2ldLnNwbGl0KCc9JylbMF0gPT0gJ3RpbWUyJykKICAgICAgICAgICAgICAgIHRpbWUyID0gcltpXS5zcGxpdCgnPScpWzFdOwogICAgICAgIH0KCiAgICAgICAgaWYodGltZTEgPT09IHVuZGVmaW5lZCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZih0aW1lMiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJ1bkNvbXBhcmlzb24yKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqeGdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKS5pbm5lckhUTUwgPSAnY2hhaW5pbmc6ICcgKyAocGFyc2VGbG9hdCh0aW1lMSkrcGFyc2VGbG9hdCh0aW1lMCkpICsgJzxiciAvPmRpcmVjdDogJyArIHRpbWUyOwogICAgfQp9KSh3aW5kb3csIGRvY3VtZW50KTsKCiAgICAKICAvKiBdXT4gKi8KICA8L3NjcmlwdD4KPGJyLz4KPC9ib2R5Pgo8L2h0bWw+Cg==",
                "body": "PGh0bWw+CjxoZWFkPgogICA8dGl0bGU+TGltYSZjY2VkaWw7b24gfCBKU1hHcmFwaCBFeGFtcGxlPC90aXRsZT4KICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgaHJlZj0iLi4vLi4vZGlzdHJpYi9qc3hncmFwaC5jc3MiIC8+CiAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9Ii4uLy4uL3NyYy9sb2FkanN4Z3JhcGguanMiPjwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJkZWJ1ZyIgc3R5bGU9ImRpc3BsYXk6IG5vbmUiPjwvZGl2Pgo8Y2VudGVyPgo8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwMHB4OyI+CiAgICA8ZGl2IHN0eWxlPSJ3aWR0aDo1MDBweDsgaGVpZ2h0OiA1MTBweDsiPgogIDxkaXYgaWQ9Imp4Z2JveCIgY2xhc3M9Imp4Z2JveCIgc3R5bGU9IndpZHRoOjUwMHB4OyBoZWlnaHQ6NTAwcHg7IHRleHQtYWxpZ246IGxlZnQ7IGZsb2F0OiBsZWZ0OyI+PC9kaXY+CiAgPGRpdiBpZD0icG9seW5vbWlhbHMiIHN0eWxlPSJkaXNwbGF5OiBub25lOyB3aWR0aDogNTAwcHg7IGhlaWdodDogNTAwcHg7IG1hcmdpbi1sZWZ0OiAxMHB4OyB0ZXh0LWFsaWduOiBsZWZ0OyBwYWRkaW5nLWxlZnQ6IC0yMDBweDsiPjwvZGl2PgogIDwvZGl2PgoKICAgIDxkaXYgc3R5bGU9IndpZHRoOiA4MDBweDsgbWFyZ2luLXRvcDogMTBweDsiPgogIDxmb3JtPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJjaG9vc2VDb29yZGluYXRlU3lzdGVtKCk7IiB2YWx1ZT0iQ2hvb3NlIGNvb3JkaW5hdGUgc3lzdGVtIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJnZW5lcmF0ZVBvbHlub21pYWxzKCk7IiB2YWx1ZT0iR2VuZXJhdGUgc3lzdGVtIG9mIHBvbHlub21pYWwgZXF1YXRpb25zIiAvPgogICAgICA8YnIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iY2FsY3VsYXRlTG9jdXMoKTsiIHZhbHVlPSJDYWxjdWxhdGUgbG9jdXMgb2YgVCIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0ic2hvd0xvY3VzRXF1YXRpb24oKTsiIHZhbHVlPSJTaG93IGxvY3VzIGVxdWF0aW9uIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJzaG93Qm9hcmQoKTsiIHZhbHVlPSJTaG93IGJvYXJkIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJzaG93TG9jdXNUaW1lKGxvYykiIHZhbHVlPSJTaG93IGxvY3VzIHRpbWUiIC8+CiAgICAgIDxiciAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJleHRlbmQoKTsiIHZhbHVlPSJFeHRlbmQgdGhlIGNvbnN0cnVjdGlvbiAod2l0aCBnbGlkZXIpIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJleHRlbmRlZExvY3VzKCk7IiB2YWx1ZT0iQ2FsY3VsYXRlIGV4dGVuZGVkIGxvY3VzIChiYXNlZCBvbiBnbGlkZXIgQykiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9InNob3dMb2N1c1RpbWUobG9jMikiIHZhbHVlPSJTaG93IGxvY3VzIHRpbWUiIC8+CiAgICAgIDxiciAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJleHRlbmQyKCk7IiB2YWx1ZT0iRXh0ZW5kIHRoZSBjb25zdHJ1Y3Rpb24iIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImV4dGVuZGVkTG9jdXMyKCk7IiB2YWx1ZT0iQ2FsY3VsYXRlIGV4dGVuZGVkIGxvY3VzIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJzaG93TG9jdXNUaW1lKGxvYzMpIiB2YWx1ZT0iU2hvdyBsb2N1cyB0aW1lIiAvPgogICAgICA8YnIgLz4KICAgICAgPGlucHV0IHR5cGU9InRleHQiIHZhbHVlPSIwLjIiIGlkPSJkaW0iIHNpemU9IjMiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRpbUNvbnN0cnVjdGlvbigpOyIgdmFsdWU9IkRpbSBjb25zdHJ1Y3Rpb24iIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRpbUxvY3VzKCk7IiB2YWx1ZT0iRGltIGxvY3VzIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkaW1FeHRlbnNpb24oKTsiIHZhbHVlPSJEaW0gZXh0ZW5zaW9uIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkaW1FeHRlbnNpb24yKCk7IiB2YWx1ZT0iRGltIGV4dGVuc2lvbiAyIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkaW1Mb2N1czIoKTsiIHZhbHVlPSJEaW0gZXh0ZW5kZWQgbG9jaSIgLz4KICAgICAgPGJyIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ1bkNvbXBhcmlzb24oKTsiIHZhbHVlPSJSdW4gY29tcGFyaXNvbiI+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5ocmVmPXdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCc/JylbMF0iIHZhbHVlPSJSZWxvYWQiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9InRvZ2dsZU9wdGltaXplKCk7IiBpZD0ib3B0IiB2YWx1ZT0iT3B0aW1pemF0aW9uIGlzIG9mZiI+CiAgPC9mb3JtPgogIDwvZGl2Pgo8L2Rpdj4KPC9jZW50ZXI+CiAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KICAgIC8qIDwhW0NEQVRBWyAqLwoKICAgIGJvYXJkID0gSlhHLkpTWEdyYXBoLmluaXRCb2FyZCgnanhnYm94Jywge2JvdW5kaW5nYm94OiBbLTExLCAxMSwgMTEsIC0xMV0sIGF4aXM6IHRydWUsIGdyaWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXBhc3BlY3RyYXRpbzogdHJ1ZSwgc2hvd2NvcHlyaWdodDogZmFsc2V9KTsKCi8vICAgIGJvYXJkLnN1c3BlbmRVcGRhdGUoKTsKICAgIGEgPSBib2FyZC5jcmVhdGVFbGVtZW50KCdwb2ludCcsIFs4LCAtMV0pOwogICAgYyA9IGJvYXJkLmNyZWF0ZUVsZW1lbnQoJ2Z1bmN0aW9uZ3JhcGgnLCBbZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgqeCp4OyB9XSk7CiAgICBjLmdlbmVyYXRlUG9seW5vbWlhbCA9IGZ1bmN0aW9uIChwKSB7CiAgICAJcmV0dXJuIFsnKCcgKyBwLnN5bWJvbGljLnggKyAnKV4zIC0gKCcgKyBwLnN5bWJvbGljLnkgKyAnKSddOwogICAgfTsKCWIgPSBib2FyZC5jcmVhdGUoJ2dsaWRlcicsIFtjXSk7CiAgICBkID0gYm9hcmQuY3JlYXRlRWxlbWVudCgnY2lyY2xlJywgW2EsIDRdKTsKICAgIGUgPSBib2FyZC5jcmVhdGVFbGVtZW50KCdjaXJjbGUnLCBbYiwgNV0pOwogICAgZiA9IGJvYXJkLmNyZWF0ZSgnaW50ZXJzZWN0aW9uJywgW2QsIGUsIDBdKTsKICAgIHogPSBib2FyZC5jcmVhdGUoJ21pZHBvaW50JywgW2IsIGZdKTsKCiAgICBsb2MgPSBudWxsOwoKICAgIHRnPW51bGw7CiAgICB0Yz1udWxsOwogICAgdGk9bnVsbDsKICAgIHRtPW51bGw7CiAgICBsb2MyID0gbnVsbDsKCiAgICB0YzI9bnVsbDsKICAgIHRpMj1udWxsOwogICAgdG0yPW51bGw7CiAgICBsb2MzID0gbnVsbDsKCiAgICBvcHQgPSBmYWxzZTsKICAgIAogICAgLy9ib2FyZC5vcHRpb25zLmxvY3VzLnRyYW5zbGF0ZVRvT3JpZ2luID0gdHJ1ZTsKLy8gICAgYm9hcmQub3B0aW9ucy5sb2N1cy50b09yaWdpbiA9IDsKICAgIC8vYm9hcmQub3B0aW9ucy5sb2N1cy50cmFuc2xhdGVUbzEwID0gdHJ1ZTsKLy8gICAgYm9hcmQub3B0aW9ucy5sb2N1cy50bzEwID0gcDQ7CgogICAgdGwgPSBib2FyZC5jcmVhdGUoJ2xvY3VzJywgW3pdLCB7c3Ryb2tlV2lkdGg6ICczcHgnLCBzdHJva2VPcGFjaXR5OiAwLjksIHN0cm9rZUNvbG9yOiAnYmxhY2snfSk7CiAgICAKICAgIGkgPSBib2FyZC5jcmVhdGUoJ2dsaWRlcicsIFt0bF0pOwogICAgaiA9IGJvYXJkLmNyZWF0ZSgnY2lyY2xlJywgW2ksIDRdKTsKICAgIGsgPSBib2FyZC5jcmVhdGUoJ2ludGVyc2VjdGlvbicsIFtqLCBlLCAwXSk7CiAgICBsID0gYm9hcmQuY3JlYXRlKCdtaWRwb2ludCcsIFtrLCBhXSk7CiAgICB0bDIgPSBib2FyZC5jcmVhdGUoJ2xvY3VzJywgW2xdKTsKICAgIAoKICAgIGZ1bmN0aW9uIGNob29zZUNvb3JkaW5hdGVTeXN0ZW0oKSB7CiAgICAgICAgdmFyIGssIG87CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanhnYm94Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgSlhHLk1hdGguU3ltYm9saWMuZ2VuZXJhdGVTeW1ib2xpY0Nvb3JkaW5hdGVzUGFydGlhbChib2FyZCwgcDE0XzEsICd1JywgJ2JyYWNlJyk7CgogICAgICAgIGZvcihrIGluIGJvYXJkLm9iamVjdHMpIHsKICAgICAgICAgICAgbyA9IGJvYXJkLm9iamVjdHNba107CiAgICAgICAgICAgIGlmKG8uZWxlbWVudENsYXNzID09IEpYRy5PQkpFQ1RfQ0xBU1NfUE9JTlQpIHsKICAgICAgICAgICAgICAgIG8ubGFiZWwuY29udGVudC5zZXRUZXh0KG8ubmFtZSArICcgKCcgKyBvLnN5bWJvbGljLnggKyAnLCAnICsgby5zeW1ib2xpYy55ICsgJyknKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYm9hcmQudXBkYXRlKCk7CiAgICAgICAgSlhHLk1hdGguU3ltYm9saWMuY2xlYXJTeW1ib2xpY0Nvb3JkaW5hdGVzKGJvYXJkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVBvbHlub21pYWxzKCkgewogICAgICAgIHZhciByZXMgPSBKWEcuTWF0aC5TeW1ib2xpYy5nZW5lcmF0ZVBvbHlub21pYWxzKGJvYXJkLCBwMTRfMSwgdHJ1ZSksCiAgICAgICAgICAgIGksIG91dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpOwoKICAgICAgICBvdXQuaW5uZXJIVE1MID0gJzx1bD4nOwogICAgICAgIGZvcihpPTA7IGk8cmVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBvdXQuaW5uZXJIVE1MICs9ICc8bGk+JyArIHJlc1tpXSArICcgPSAwPC9saT4nOwogICAgICAgIG91dC5pbm5lckhUTUwgKz0gJzwvdWw+JzsKICAgICAgICBvdXQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY3VsYXRlTG9jdXMoKSB7CiAgICAgICAgbG9jID0gYm9hcmQuY3JlYXRlKCdsb2N1cycsIFtwMTRfMV0sIHtzdHJva2VDb2xvcjogJ2JsYWNrJywgc3Ryb2tlV2lkdGg6ICcycHgnfSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2hvd0xvY3VzRXF1YXRpb24oKSB7CiAgICAgICAgdmFyIG91dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpOwoKICAgICAgICBvdXQuaW5uZXJIVE1MID0gJzx1bD4nOwogICAgICAgIGZvcihpPTA7IGk8bG9jLmVxLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBvdXQuaW5uZXJIVE1MICs9ICc8bGk+JyArIGxvYy5lcVtpXSArICcgPSAwPC9saT4nOwogICAgICAgIG91dC5pbm5lckhUTUwgKz0gJzwvdWw+JzsKICAgICAgICBvdXQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9CgogICAgZnVuY3Rpb24gc2hvd0JvYXJkKCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpbUNvbnN0cnVjdGlvbigpIHsKICAgICAgICB2YXIgYyA9IFtwMywgcDQsIGMxLCBnLCBwNiwgYzIsIHAxNF8xXSwgaSwgbyA9IGdldERpbSgpOwoKICAgICAgICBpZihwMy52aXNQcm9wWydzdHJva2VPcGFjaXR5J10gPT0gbykKICAgICAgICAgICAgbyA9IDEuMDsKCiAgICAgICAgZm9yKGk9MDsgaTxjLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNbaV0uc2V0UHJvcGVydHkoe3N0cm9rZU9wYWNpdHk6IG8sIGZpbGxPcGFjaXR5OiBvfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRpbUxvY3VzKCkgewogICAgICAgIHZhciBvID0gZ2V0RGltKCk7CgogICAgICAgIGlmKGxvYyAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmKGxvYy52aXNQcm9wWydzdHJva2VPcGFjaXR5J10gPT0gbykKICAgICAgICAgICAgICAgIG8gPSAxLjA7CiAgICAgICAgICAgIGxvYy5zZXRQcm9wZXJ0eSh7c3Ryb2tlT3BhY2l0eTogb30pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkaW1Mb2N1czIoKSB7CiAgICAgICAgdmFyIG8gPSBnZXREaW0oKTsKCiAgICAgICAgaWYobG9jMiAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmKGxvYzIudmlzUHJvcFsnc3Ryb2tlT3BhY2l0eSddID09IG8pCiAgICAgICAgICAgICAgICBvID0gMS4wOwogICAgICAgICAgICBsb2MyLnNldFByb3BlcnR5KHtzdHJva2VPcGFjaXR5OiBvfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGV4dGVuZCgpIHsKICAgICAgICBpZihsb2M9PW51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYm9hcmQuc3VzcGVuZFVwZGF0ZSgpOwogICAgICAgIHRnID0gYm9hcmQuY3JlYXRlKCdnbGlkZXInLCBbbG9jXSk7CgogICAgICAgIHRjID0gYm9hcmQuY3JlYXRlKCdjaXJjbGUnLCBbdGcsIDNdKTsKICAgICAgICB0aSA9IGJvYXJkLmNyZWF0ZSgnaW50ZXJzZWN0aW9uJywgW3RjLCBjMSwgMF0sIHtjb2xvcjogJ2JsdWUnfSk7CiAgICAgICAgdG0gPSBib2FyZC5jcmVhdGUoJ21pZHBvaW50JywgW3RnLCB0aV0sIHtjb2xvcjogJ2dyZWVuJ30pOwogICAgICAgIGJvYXJkLnVuc3VzcGVuZFVwZGF0ZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpbUV4dGVuc2lvbigpIHsKICAgICAgICBpZih0ZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIHZhciBjID0gW3RnLCB0YywgdGksIHRtXSwgaSwgbyA9IGdldERpbSgpOwoKICAgICAgICBpZih0Zy52aXNQcm9wWydzdHJva2VPcGFjaXR5J10gPT0gbykKICAgICAgICAgICAgbyA9IDEuMDsKCiAgICAgICAgZm9yKGk9MDsgaTxjLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNbaV0uc2V0UHJvcGVydHkoe3N0cm9rZU9wYWNpdHk6IG8sIGZpbGxPcGFjaXR5OiBvfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldERpbSgpIHsKICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGltJykudmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4dGVuZGVkTG9jdXMoKSB7CiAgICAgICAgbG9jMiA9IGJvYXJkLmNyZWF0ZSgnbG9jdXMnLCBbdG1dLCB7c3Ryb2tlQ29sb3I6ICdibGFjaycsIHN0cm9rZVdpZHRoOiAnNHB4J30pOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4dGVuZDIoKSB7CiAgICAgICAgYm9hcmQuc3VzcGVuZFVwZGF0ZSgpOwogICAgICAgIHRjMiA9IGJvYXJkLmNyZWF0ZSgnY2lyY2xlJywgW3AxNF8xLCAzXSk7CiAgICAgICAgdGkyID0gYm9hcmQuY3JlYXRlKCdpbnRlcnNlY3Rpb24nLCBbdGMyLCBjMSwgMF0sIHtjb2xvcjogJ2JsdWUnfSk7CiAgICAgICAgdG0yID0gYm9hcmQuY3JlYXRlKCdtaWRwb2ludCcsIFtwMTRfMSwgdGkyXSwge2NvbG9yOiAnZ3JlZW4nfSk7CiAgICAgICAgYm9hcmQudW5zdXNwZW5kVXBkYXRlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGltRXh0ZW5zaW9uMigpIHsKICAgICAgICBpZih0ZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIHZhciBjID0gW3RjMiwgdGkyLCB0bTJdLCBpLCBvID0gZ2V0RGltKCk7CgogICAgICAgIGlmKHRjMi52aXNQcm9wWydzdHJva2VPcGFjaXR5J10gPT0gbykKICAgICAgICAgICAgbyA9IDEuMDsKCiAgICAgICAgZm9yKGk9MDsgaTxjLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNbaV0uc2V0UHJvcGVydHkoe3N0cm9rZU9wYWNpdHk6IG8sIGZpbGxPcGFjaXR5OiBvfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGV4dGVuZGVkTG9jdXMyKCkgewogICAgICAgIGxvYzMgPSBib2FyZC5jcmVhdGUoJ2xvY3VzJywgW3RtMl0sIHtzdHJva2VDb2xvcjogJ2dyZWVuJywgc3Ryb2tlV2lkdGg6ICcycHgnfSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2hvd0xvY3VzVGltZShsKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpLmlubmVySFRNTCA9IGwuY3RpbWU7CiAgICB9CgogICAgZnVuY3Rpb24gdG9nZ2xlT3B0aW1pemUoKSB7CiAgICAgICAgaWYob3B0KSB7CiAgICAgICAgICAgIGJvYXJkLm9wdGlvbnMubG9jdXMudHJhbnNsYXRlVG9PcmlnaW4gPSBmYWxzZTsKICAgICAgICAgICAgYm9hcmQub3B0aW9ucy5sb2N1cy50cmFuc2xhdGVUbzEwID0gZmFsc2U7CiAgICAgICAgICAgIG9wdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3B0JykudmFsdWUgPSAiT3B0aW1pemF0aW9uIGlzIG9mZiI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYm9hcmQub3B0aW9ucy5sb2N1cy50cmFuc2xhdGVUb09yaWdpbiA9IHRydWU7CiAgICAgICAgICAgIGJvYXJkLm9wdGlvbnMubG9jdXMudHJhbnNsYXRlVG8xMCA9IHRydWU7CiAgICAgICAgICAgIG9wdCA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcHQnKS52YWx1ZSA9ICJPcHRpbWl6YXRpb24gaXMgb24iOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBydW5Db21wYXJpc29uKCkgewogICAgICAgIGNhbGN1bGF0ZUxvY3VzKCk7CiAgICAgICAgZXh0ZW5kKCk7CiAgICAgICAgZXh0ZW5kZWRMb2N1cygpOwoKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmKyc/dGltZTA9Jytsb2MuY3RpbWUrJyZ0aW1lMT0nK2xvYzIuY3RpbWU7CiAgICB9CgogICAgZnVuY3Rpb24gcnVuQ29tcGFyaXNvbjIoKSB7CiAgICAgICAgZXh0ZW5kMigpOwogICAgICAgIGV4dGVuZGVkTG9jdXMyKCk7CgogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYrJyZ0aW1lMj0nK2xvYzMuY3RpbWU7CiAgICB9CgooZnVuY3Rpb24od2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7CiAgICB2YXIgciwgdGltZTAsIHRpbWUxLCB0aW1lMiwgaTsKICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJ3RpbWUxJyk+LTEpIHsKICAgICAgICByID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJz8nKVsxXS5zcGxpdCgnJicpOwogICAgICAgIGZvcihpPTA7IGk8ci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZihyW2ldLnNwbGl0KCc9JylbMF0gPT0gJ3RpbWUwJykKICAgICAgICAgICAgICAgIHRpbWUwID0gcltpXS5zcGxpdCgnPScpWzFdOwoKICAgICAgICAgICAgaWYocltpXS5zcGxpdCgnPScpWzBdID09ICd0aW1lMScpCiAgICAgICAgICAgICAgICB0aW1lMSA9IHJbaV0uc3BsaXQoJz0nKVsxXTsKCiAgICAgICAgICAgIGlmKHJbaV0uc3BsaXQoJz0nKVswXSA9PSAndGltZTInKQogICAgICAgICAgICAgICAgdGltZTIgPSByW2ldLnNwbGl0KCc9JylbMV07CiAgICAgICAgfQoKICAgICAgICBpZih0aW1lMSA9PT0gdW5kZWZpbmVkKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmKHRpbWUyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcnVuQ29tcGFyaXNvbjIoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpLmlubmVySFRNTCA9ICdjaGFpbmluZzogJyArIChwYXJzZUZsb2F0KHRpbWUxKStwYXJzZUZsb2F0KHRpbWUwKSkgKyAnPGJyIC8+ZGlyZWN0OiAnICsgdGltZTI7CiAgICB9Cn0pKHdpbmRvdywgZG9jdW1lbnQpOwoKICAgIAogIC8qIF1dPiAqLwogIDwvc2NyaXB0Pgo8YnIvPgo8L2JvZHk+CjwvaHRtbD4K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 07:51:40 GMT",
                    "Content-Length": "10245",
                    "Date": "Fri, 07 Nov 2014 07:51:40 GMT",
                    "Content-Type": "text/html; charset=utf-8"
                },
                "cookies": [],
                "mimeType": "HTML",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}