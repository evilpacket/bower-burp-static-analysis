{
    "url": "http://localhost:9999/cheton/webapp-boilerplate/site/webapp-boilerplate/web/libraries/jquery-plugins/jquery-dataTables/1.9.0/jquery.dataTables.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cookie manipulation (DOM-based)",
    "issueType": 5245696,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based cookie manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the value of a cookie in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will set an arbitrary value in the user's cookie.<br><br>The potential impact of the vulnerability depends on the role that the cookie plays within the application. If the cookie is used to control the behavior that results from certain user actions (for example, a 'production' versus 'demo' mode setting), then the attacker may be able to cause the user to perform unintended actions by manipulating the cookie's value. If the cookie is used to track the user's session, then the attacker may be able to perform a session fixation attack, in which they set the cookie's value to a valid token that they have obtained from the application, and then hijack the session during the victim user's subsequent interaction with the application.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cookie manipulation vulnerabilities is not to dynamically write to cookies using data that originated from any untrusted source. This behavior should never be implemented for cookies that have any role in controlling privileged actions or user sessions within the application.",
    "issueDetail": "The application may be vulnerable to DOM-based cookie manipulation. Data is read from <b>window.location.pathname</b> and written to <b>document.cookie</b> via the following statements:<ul><li>var aParts = window.location.pathname.split('/');</li><li>sFullCookie = sNameFile + \"=\" + encodeURIComponent(sValue) +      \"; expires=\" + date.toGMTString() +\"; path=\" + aParts.join('/')+\"/\";</li><li>document.cookie = sFullCookie;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/cheton/webapp-boilerplate/site/webapp-boilerplate/web/libraries/jquery-plugins/jquery-dataTables/1.9.0/jquery.dataTables.js",
                "path": "/cheton/webapp-boilerplate/site/webapp-boilerplate/web/libraries/jquery-plugins/jquery-dataTables/1.9.0/jquery.dataTables.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9jaGV0b24vd2ViYXBwLWJvaWxlcnBsYXRlL3NpdGUvd2ViYXBwLWJvaWxlcnBsYXRlL3dlYi9saWJyYXJpZXMvanF1ZXJ5LXBsdWdpbnMvanF1ZXJ5LWRhdGFUYWJsZXMvMS45LjAvanF1ZXJ5LmRhdGFUYWJsZXMuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMzYxMjM4DQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBTdW4sIDA5IE5vdiAyMDE0IDAyOjE3OjE2IEdNVA0KTGFzdC1Nb2RpZmllZDogU3VuLCAwOSBOb3YgMjAxNCAwMjoxNzoxNSBHTVQNCg0KLyoqCiAqIEBzdW1tYXJ5ICAgICBEYXRhVGFibGVzCiAqIEBkZXNjcmlwdGlvbiBQYWdpbmF0ZSwgc2VhcmNoIGFuZCBzb3J0IEhUTUwgdGFibGVzCiAqIEB2ZXJzaW9uICAgICAxLjkuMAogKiBAZmlsZSAgICAgICAganF1ZXJ5LmRhdGFUYWJsZXMuanMKICogQGF1dGhvciAgICAgIEFsbGFuIEphcmRpbmUgKHd3dy5zcHJ5bWVkaWEuY28udWspCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QKICoKICogQGNvcHlyaWdodCBDb3B5cmlnaHQgMjAwOC0yMDEyIEFsbGFuIEphcmRpbmUsIGFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZnJlZSBzb2Z0d2FyZSwgdW5kZXIgZWl0aGVyIHRoZSBHUEwgdjIgbGljZW5zZSBvciBhCiAqIEJTRCBzdHlsZSBsaWNlbnNlLCBhdmFpbGFibGUgYXQ6CiAqICAgaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2VfZ3BsMgogKiAgIGh0dHA6Ly9kYXRhdGFibGVzLm5ldC9saWNlbnNlX2JzZAogKiAKICogVGhpcyBzb3VyY2UgZmlsZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIAogKiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLgogKiAKICogRm9yIGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvOiBodHRwOi8vd3d3LmRhdGF0YWJsZXMubmV0CiAqLwoKLypqc2xpbnQgZXZpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIGJyb3dzZXI6IHRydWUgKi8KLypnbG9iYWxzICQsIGpRdWVyeSxfZm5FeHRlcm5BcGlGdW5jLF9mbkluaXRpYWxpc2UsX2ZuSW5pdENvbXBsZXRlLF9mbkxhbmd1YWdlQ29tcGF0LF9mbkFkZENvbHVtbixfZm5Db2x1bW5PcHRpb25zLF9mbkFkZERhdGEsX2ZuQ3JlYXRlVHIsX2ZuR2F0aGVyRGF0YSxfZm5CdWlsZEhlYWQsX2ZuRHJhd0hlYWQsX2ZuRHJhdyxfZm5SZURyYXcsX2ZuQWpheFVwZGF0ZSxfZm5BamF4UGFyYW1ldGVycyxfZm5BamF4VXBkYXRlRHJhdyxfZm5TZXJ2ZXJQYXJhbXMsX2ZuQWRkT3B0aW9uc0h0bWwsX2ZuRmVhdHVyZUh0bWxUYWJsZSxfZm5TY3JvbGxEcmF3LF9mbkFkanVzdENvbHVtblNpemluZyxfZm5GZWF0dXJlSHRtbEZpbHRlcixfZm5GaWx0ZXJDb21wbGV0ZSxfZm5GaWx0ZXJDdXN0b20sX2ZuRmlsdGVyQ29sdW1uLF9mbkZpbHRlcixfZm5CdWlsZFNlYXJjaEFycmF5LF9mbkJ1aWxkU2VhcmNoUm93LF9mbkZpbHRlckNyZWF0ZVNlYXJjaCxfZm5EYXRhVG9TZWFyY2gsX2ZuU29ydCxfZm5Tb3J0QXR0YWNoTGlzdGVuZXIsX2ZuU29ydGluZ0NsYXNzZXMsX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSxfZm5QYWdlQ2hhbmdlLF9mbkZlYXR1cmVIdG1sSW5mbyxfZm5VcGRhdGVJbmZvLF9mbkZlYXR1cmVIdG1sTGVuZ3RoLF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyxfZm5Qcm9jZXNzaW5nRGlzcGxheSxfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCxfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSxfZm5Ob2RlVG9EYXRhSW5kZXgsX2ZuVmlzYmxlQ29sdW1ucyxfZm5DYWxjdWxhdGVFbmQsX2ZuQ29udmVydFRvV2lkdGgsX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0LF9mbkdldFdpZGVzdE5vZGUsX2ZuR2V0TWF4TGVuU3RyaW5nLF9mblN0cmluZ1RvQ3NzLF9mbkRldGVjdFR5cGUsX2ZuU2V0dGluZ3NGcm9tTm9kZSxfZm5HZXREYXRhTWFzdGVyLF9mbkdldFRyTm9kZXMsX2ZuR2V0VGROb2RlcyxfZm5Fc2NhcGVSZWdleCxfZm5EZWxldGVJbmRleCxfZm5SZU9yZGVySW5kZXgsX2ZuQ29sdW1uT3JkZXJpbmcsX2ZuTG9nLF9mbkNsZWFyVGFibGUsX2ZuU2F2ZVN0YXRlLF9mbkxvYWRTdGF0ZSxfZm5DcmVhdGVDb29raWUsX2ZuUmVhZENvb2tpZSxfZm5EZXRlY3RIZWFkZXIsX2ZuR2V0VW5pcXVlVGhzLF9mblNjcm9sbEJhcldpZHRoLF9mbkFwcGx5VG9DaGlsZHJlbixfZm5NYXAsX2ZuR2V0Um93RGF0YSxfZm5HZXRDZWxsRGF0YSxfZm5TZXRDZWxsRGF0YSxfZm5HZXRPYmplY3REYXRhRm4sX2ZuU2V0T2JqZWN0RGF0YUZuLF9mbkFwcGx5Q29sdW1uRGVmcyxfZm5CaW5kQWN0aW9uLF9mbkNhbGxiYWNrUmVnLF9mbkNhbGxiYWNrRmlyZSxfZm5Kc29uU3RyaW5nLF9mblJlbmRlcixfZm5Ob2RlVG9Db2x1bW5JbmRleCovCgooLyoqIEBsZW5kcyA8Z2xvYmFsPiAqL2Z1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewoJLyoqIAoJICogRGF0YVRhYmxlcyBpcyBhIHBsdWctaW4gZm9yIHRoZSBqUXVlcnkgSmF2YXNjcmlwdCBsaWJyYXJ5LiBJdCBpcyBhIAoJICogaGlnaGx5IGZsZXhpYmxlIHRvb2wsIGJhc2VkIHVwb24gdGhlIGZvdW5kYXRpb25zIG9mIHByb2dyZXNzaXZlIAoJICogZW5oYW5jZW1lbnQsIHdoaWNoIHdpbGwgYWRkIGFkdmFuY2VkIGludGVyYWN0aW9uIGNvbnRyb2xzIHRvIGFueSAKCSAqIEhUTUwgdGFibGUuIEZvciBhIGZ1bGwgbGlzdCBvZiBmZWF0dXJlcyBwbGVhc2UgcmVmZXIgdG8KCSAqIDxhIGhyZWY9Imh0dHA6Ly9kYXRhdGFibGVzLm5ldCI+RGF0YVRhYmxlcy5uZXQ8L2E+LgoJICoKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlPC9pPiBvYmplY3QgaXMgbm90IGEgZ2xvYmFsIHZhcmlhYmxlIGJ1dCBpcwoJICogYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uRGF0YVRhYmxlPC9pPiBhbmQgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZTwvaT4gdGhyb3VnaCB3aGljaCAKCSAqIGl0IG1heSBiZSAgYWNjZXNzZWQuCgkgKgoJICogIEBjbGFzcwoJICogIEBwYXJhbSB7b2JqZWN0fSBbb0luaXQ9e31dIENvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciBEYXRhVGFibGVzLiBPcHRpb25zCgkgKiAgICBhcmUgZGVmaW5lZCBieSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfQoJICogIEByZXF1aXJlcyBqUXVlcnkgMS4zKwoJICogCgkgKiAgQGV4YW1wbGUKCSAqICAgIC8vIEJhc2ljIGluaXRpYWxpc2F0aW9uCgkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gewoJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJICogICAgfSApOwoJICogIAoJICogIEBleGFtcGxlCgkgKiAgICAvLyBJbml0aWFsaXNhdGlvbiB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyAtIGluIHRoaXMgY2FzZSwgZGlzYWJsZQoJICogICAgLy8gcGFnaW5hdGlvbiBhbmQgc29ydGluZy4KCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiB7CgkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlLAoJICogICAgICAgICJiU29ydCI6IGZhbHNlIAoJICogICAgICB9ICk7CgkgKiAgICB9ICk7CgkgKi8KCXZhciBEYXRhVGFibGUgPSBmdW5jdGlvbiggb0luaXQgKQoJewoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhIGNvbHVtbiB0byB0aGUgbGlzdCB1c2VkIGZvciB0aGUgdGFibGUgd2l0aCBkZWZhdWx0IHZhbHVlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gblRoIFRoZSB0aCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncywgblRoICkKCQl7CgkJCXZhciBvRGVmYXVsdHMgPSBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uczsKCQkJdmFyIGlDb2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9Db2wgPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiwgb0RlZmF1bHRzLCB7CgkJCQkic1NvcnRpbmdDbGFzcyI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQkic1NvcnRpbmdDbGFzc0pVSSI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSSwKCQkJCSJuVGgiOiBuVGggPyBuVGggOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpLAoJCQkJInNUaXRsZSI6ICAgIG9EZWZhdWx0cy5zVGl0bGUgICAgPyBvRGVmYXVsdHMuc1RpdGxlICAgIDogblRoID8gblRoLmlubmVySFRNTCA6ICcnLAoJCQkJImFEYXRhU29ydCI6IG9EZWZhdWx0cy5hRGF0YVNvcnQgPyBvRGVmYXVsdHMuYURhdGFTb3J0IDogW2lDb2xdLAoJCQkJIm1EYXRhUHJvcCI6IG9EZWZhdWx0cy5tRGF0YVByb3AgPyBvRGVmYXVsdHMub0RlZmF1bHRzIDogaUNvbAoJCQl9ICk7CgkJCW9TZXR0aW5ncy5hb0NvbHVtbnMucHVzaCggb0NvbCApOwoJCQkKCQkJLyogQWRkIGEgY29sdW1uIHNwZWNpZmljIGZpbHRlciAqLwoJCQlpZiAoIG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbIGlDb2wgXSA9PT0gdW5kZWZpbmVkIHx8IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbIGlDb2wgXSA9PT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbIGlDb2wgXSA9ICQuZXh0ZW5kKCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQl2YXIgb1ByZSA9IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbIGlDb2wgXTsKCQkJCQoJCQkJLyogRG9uJ3QgcmVxdWlyZSB0aGF0IHRoZSB1c2VyIG11c3Qgc3BlY2lmeSBiUmVnZXgsIGJTbWFydCBvciBiQ2FzZUluc2Vuc2l0aXZlICovCgkJCQlpZiAoIG9QcmUuYlJlZ2V4ID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9QcmUuYlJlZ2V4ID0gdHJ1ZTsKCQkJCX0KCQkJCQoJCQkJaWYgKCBvUHJlLmJTbWFydCA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJTbWFydCA9IHRydWU7CgkJCQl9CgkJCQkKCQkJCWlmICggb1ByZS5iQ2FzZUluc2Vuc2l0aXZlID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9QcmUuYkNhc2VJbnNlbnNpdGl2ZSA9IHRydWU7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFVzZSB0aGUgY29sdW1uIG9wdGlvbnMgZnVuY3Rpb24gdG8gaW5pdGlhbGlzZSBjbGFzc2VzIGV0YyAqLwoJCQlfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG51bGwgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgb3B0aW9ucyBmb3IgYSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gaW5kZXggdG8gY29uc2lkZXIKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9PcHRpb25zIG9iamVjdCB3aXRoIHNUeXBlLCBiVmlzaWJsZSBhbmQgYlNlYXJjaGFibGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29sdW1uT3B0aW9ucyggb1NldHRpbmdzLCBpQ29sLCBvT3B0aW9ucyApCgkJewoJCQl2YXIgb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbIGlDb2wgXTsKCQkJCgkJCS8qIFVzZXIgc3BlY2lmaWVkIGNvbHVtbiBvcHRpb25zICovCgkJCWlmICggb09wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBvT3B0aW9ucyAhPT0gbnVsbCApCgkJCXsKCQkJCWlmICggb09wdGlvbnMuc1R5cGUgIT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb0NvbC5zVHlwZSA9IG9PcHRpb25zLnNUeXBlOwoJCQkJCW9Db2wuX2JBdXRvVHlwZSA9IGZhbHNlOwoJCQkJfQoJCQkJCgkJCQkkLmV4dGVuZCggb0NvbCwgb09wdGlvbnMgKTsKCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJzV2lkdGgiLCAic1dpZHRoT3JpZyIgKTsKCQkKCQkJCS8qIGlEYXRhU29ydCB0byBiZSBhcHBsaWVkIChiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSksIGJ1dCBhRGF0YVNvcnQgd2lsbCB0YWtlCgkJCQkgKiBwcmlvcml0eSBpZiBkZWZpbmVkCgkJCQkgKi8KCQkJCWlmICggb09wdGlvbnMuaURhdGFTb3J0ICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9Db2wuYURhdGFTb3J0ID0gWyBvT3B0aW9ucy5pRGF0YVNvcnQgXTsKCQkJCX0KCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJhRGF0YVNvcnQiICk7CgkJCX0KCQkKCQkJLyogQ2FjaGUgdGhlIGRhdGEgZ2V0IGFuZCBzZXQgZnVuY3Rpb25zIGZvciBzcGVlZCAqLwoJCQlvQ29sLmZuR2V0RGF0YSA9IF9mbkdldE9iamVjdERhdGFGbiggb0NvbC5tRGF0YVByb3AgKTsKCQkJb0NvbC5mblNldERhdGEgPSBfZm5TZXRPYmplY3REYXRhRm4oIG9Db2wubURhdGFQcm9wICk7CgkJCQoJCQkvKiBGZWF0dXJlIHNvcnRpbmcgb3ZlcnJpZGVzIGNvbHVtbiBzcGVjaWZpYyB3aGVuIG9mZiAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJb0NvbC5iU29ydGFibGUgPSBmYWxzZTsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgdGhhdCB0aGUgY2xhc3MgYXNzaWdubWVudCBpcyBjb3JyZWN0IGZvciBzb3J0aW5nICovCgkJCWlmICggIW9Db2wuYlNvcnRhYmxlIHx8CgkJCQkgKCQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSkgKQoJCQl7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3MgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZTsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9ICIiOwoJCQl9CgkJCWVsc2UgaWYgKCBvQ29sLmJTb3J0YWJsZSB8fAoJCQkgICAgICAgICAgKCQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSkgKQoJCQl7CgkJCSAgb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZTsKCQkJICBvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUk7CgkJCX0KCQkJZWxzZSBpZiAoICQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpICE9IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSApCgkJCXsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVBc2M7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUlBc2NBbGxvd2VkOwoJCQl9CgkJCWVsc2UgaWYgKCAkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgIT0gLTEgKQoJCQl7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3MgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlRGVzYzsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSURlc2NBbGxvd2VkOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkanVzdCB0aGUgdGFibGUgY29sdW1uIHdpZHRocyBmb3IgbmV3IGRhdGEuIE5vdGU6IHlvdSB3b3VsZCBwcm9iYWJseSB3YW50IHRvIAoJCSAqIGRvIGEgcmVkcmF3IGFmdGVyIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiEKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGp1c3RDb2x1bW5TaXppbmcgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogTm90IGludGVyZXN0ZWQgaW4gZG9pbmcgY29sdW1uIHdpZHRoIGNhbGN1bGF0aW9uIGlmIGF1dG93aWR0aCBpcyBkaXNhYmxlZCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCA9PT0gZmFsc2UgKQoJCQl7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJCgkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCWZvciAoIHZhciBpPTAgLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGguc3R5bGUud2lkdGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDb3ZlcnQgdGhlIGluZGV4IG9mIGEgdmlzaWJsZSBjb2x1bW4gdG8gdGhlIGluZGV4IGluIHRoZSBkYXRhIGFycmF5ICh0YWtlIGFjY291bnQKCQkgKiBvZiBoaWRkZW4gY29sdW1ucykKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaU1hdGNoIFZpc2libGUgY29sdW1uIGluZGV4IHRvIGxvb2t1cAoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBkYXRhIGluZGV4CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblZpc2libGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlNYXRjaCApCgkJewoJCQl2YXIgaUNvbHVtbiA9IC0xOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgPT09IHRydWUgKQoJCQkJewoJCQkJCWlDb2x1bW4rKzsKCQkJCX0KCQkJCQoJCQkJaWYgKCBpQ29sdW1uID09IGlNYXRjaCApCgkJCQl7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBudWxsOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBDb3ZlcnQgdGhlIGluZGV4IG9mIGFuIGluZGV4IGluIHRoZSBkYXRhIGFycmF5IGFuZCBjb252ZXJ0IGl0IHRvIHRoZSB2aXNpYmxlCgkJICogICBjb2x1bW4gaW5kZXggKHRha2UgYWNjb3VudCBvZiBoaWRkZW4gY29sdW1ucykKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXRjaCBDb2x1bW4gaW5kZXggdG8gbG9va3VwCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2ludH0gaSB0aGUgZGF0YSBpbmRleAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSggb1NldHRpbmdzLCBpTWF0Y2ggKQoJCXsKCQkJdmFyIGlWaXNpYmxlID0gLTE7CgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSB0cnVlICkKCQkJCXsKCQkJCQlpVmlzaWJsZSsrOwoJCQkJfQoJCQkJCgkJCQlpZiAoIGkgPT0gaU1hdGNoICkKCQkJCXsKCQkJCQlyZXR1cm4gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSA9PT0gdHJ1ZSA/IGlWaXNpYmxlIDogbnVsbDsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbnVtYmVyIG9mIHZpc2libGUgY29sdW1ucwoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBudW1iZXIgb2YgdmlzaWJsZSBjb2x1bW5zCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvUyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5WaXNibGVDb2x1bW5zKCBvUyApCgkJewoJCQl2YXIgaVZpcyA9IDA7CgkJCWZvciAoIHZhciBpPTAgOyBpPG9TLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSA9PT0gdHJ1ZSApCgkJCQl7CgkJCQkJaVZpcysrOwoJCQkJfQoJCQl9CgkJCXJldHVybiBpVmlzOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHNvcnQgdHlwZSBiYXNlZCBvbiBhbiBpbnB1dCBzdHJpbmcKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNEYXRhIGRhdGEgd2Ugd2lzaCB0byBrbm93IHRoZSB0eXBlIG9mCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IHR5cGUgKGRlZmF1bHRzIHRvICdzdHJpbmcnIGlmIG5vIHR5cGUgY2FuIGJlIGRldGVjdGVkKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EZXRlY3RUeXBlKCBzRGF0YSApCgkJewoJCQl2YXIgYVR5cGVzID0gRGF0YVRhYmxlLmV4dC5hVHlwZXM7CgkJCXZhciBpTGVuID0gYVR5cGVzLmxlbmd0aDsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgc1R5cGUgPSBhVHlwZXNbaV0oIHNEYXRhICk7CgkJCQlpZiAoIHNUeXBlICE9PSBudWxsICkKCQkJCXsKCQkJCQlyZXR1cm4gc1R5cGU7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiAnc3RyaW5nJzsKCQl9CgkJCgkJCgkJLyoqCgkJICogRmlndXJlIG91dCBob3cgdG8gcmVvcmRlciBhIGRpc3BsYXkgbGlzdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIGFycmF5IHtpbnR9IGFpUmV0dXJuIGluZGV4IGxpc3QgZm9yIHJlb3JkZXJpbmcKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVPcmRlckluZGV4ICggb1NldHRpbmdzLCBzQ29sdW1ucyApCgkJewoJCQl2YXIgYUNvbHVtbnMgPSBzQ29sdW1ucy5zcGxpdCgnLCcpOwoJCQl2YXIgYWlSZXR1cm4gPSBbXTsKCQkJCgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlmb3IgKCB2YXIgaj0wIDsgajxpTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc05hbWUgPT0gYUNvbHVtbnNbal0gKQoJCQkJCXsKCQkJCQkJYWlSZXR1cm4ucHVzaCggaiApOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBhaVJldHVybjsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBjb2x1bW4gb3JkZXJpbmcgdGhhdCBEYXRhVGFibGVzIGV4cGVjdHMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBuYW1lcwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5PcmRlcmluZyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgc05hbWVzID0gJyc7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlzTmFtZXMgKz0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zTmFtZSsnLCc7CgkJCX0KCQkJaWYgKCBzTmFtZXMubGVuZ3RoID09IGlMZW4gKQoJCQl7CgkJCQlyZXR1cm4gIiI7CgkJCX0KCQkJcmV0dXJuIHNOYW1lcy5zbGljZSgwLCAtMSk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFRha2UgdGhlIGNvbHVtbiBkZWZpbml0aW9ucyBhbmQgc3RhdGljIGNvbHVtbnMgYXJyYXlzIGFuZCBjYWxjdWxhdGUgaG93CgkJICogdGhleSByZWxhdGUgdG8gY29sdW1uIGluZGV4ZXMuIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aWxsIHRoZW4gYXBwbHkgdGhlCgkJICogZGVmaW5pdGlvbiBmb3VuZCBmb3IgYSBjb2x1bW4gdG8gYSBzdWl0YWJsZSBjb25maWd1cmF0aW9uIG9iamVjdC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0NvbERlZnMgVGhlIGFvQ29sdW1uRGVmcyBhcnJheSB0aGF0IGlzIHRvIGJlIGFwcGxpZWQKCQkgKiAgQHBhcmFtIHthcnJheX0gYW9Db2xzIFRoZSBhb0NvbHVtbnMgYXJyYXkgdGhhdCBkZWZpbmVzIGNvbHVtbnMgaW5kaXZpZHVhbGx5CgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIENhbGxiYWNrIGZ1bmN0aW9uIC0gdGFrZXMgdHdvIHBhcmFtZXRlcnMsIHRoZSBjYWxjdWxhdGVkCgkJICogICAgY29sdW1uIGluZGV4IGFuZCB0aGUgZGVmaW5pdGlvbiBmb3IgdGhhdCBjb2x1bW4uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFwcGx5Q29sdW1uRGVmcyggb1NldHRpbmdzLCBhb0NvbERlZnMsIGFvQ29scywgZm4gKQoJCXsKCQkJdmFyIGksIGlMZW4sIGosIGpMZW4sIGssIGtMZW47CgkJCgkJCS8vIENvbHVtbiBkZWZpbml0aW9ucyB3aXRoIGFUYXJnZXRzCgkJCWlmICggYW9Db2xEZWZzICkKCQkJewoJCQkJLyogTG9vcCBvdmVyIHRoZSBkZWZpbml0aW9ucyBhcnJheSAtIGxvb3AgaW4gcmV2ZXJzZSBzbyBmaXJzdCBpbnN0YW5jZSBoYXMgcHJpb3JpdHkgKi8KCQkJCWZvciAoIGk9YW9Db2xEZWZzLmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCQl7CgkJCQkJLyogRWFjaCBkZWZpbml0aW9uIGNhbiB0YXJnZXQgbXVsdGlwbGUgY29sdW1ucywgYXMgaXQgaXMgYW4gYXJyYXkgKi8KCQkJCQl2YXIgYVRhcmdldHMgPSBhb0NvbERlZnNbaV0uYVRhcmdldHM7CgkJCQkJaWYgKCAhJC5pc0FycmF5KCBhVGFyZ2V0cyApICkKCQkJCQl7CgkJCQkJCV9mbkxvZyggb1NldHRpbmdzLCAxLCAnYVRhcmdldHMgbXVzdCBiZSBhbiBhcnJheSBvZiB0YXJnZXRzLCBub3QgYSAnKyh0eXBlb2YgYVRhcmdldHMpICk7CgkJCQkJfQoJCQoJCQkJCWZvciAoIGo9MCwgakxlbj1hVGFyZ2V0cy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCXsKCQkJCQkJaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdudW1iZXInICYmIGFUYXJnZXRzW2pdID49IDAgKQoJCQkJCQl7CgkJCQkJCQkvKiBBZGQgY29sdW1ucyB0aGF0IHdlIGRvbid0IHlldCBrbm93IGFib3V0ICovCgkJCQkJCQl3aGlsZSggb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggPD0gYVRhcmdldHNbal0gKQoJCQkJCQkJewoJCQkJCQkJCV9mbkFkZENvbHVtbiggb1NldHRpbmdzICk7CgkJCQkJCQl9CgkJCgkJCQkJCQkvKiBJbnRlZ2VyLCBiYXNpYyBpbmRleCAqLwoJCQkJCQkJZm4oIGFUYXJnZXRzW2pdLCBhb0NvbERlZnNbaV0gKTsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggdHlwZW9mIGFUYXJnZXRzW2pdID09PSAnbnVtYmVyJyAmJiBhVGFyZ2V0c1tqXSA8IDAgKQoJCQkJCQl7CgkJCQkJCQkvKiBOZWdhdGl2ZSBpbnRlZ2VyLCByaWdodCB0byBsZWZ0IGNvbHVtbiBjb3VudGluZyAqLwoJCQkJCQkJZm4oIG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoK2FUYXJnZXRzW2pdLCBhb0NvbERlZnNbaV0gKTsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggdHlwZW9mIGFUYXJnZXRzW2pdID09PSAnc3RyaW5nJyApCgkJCQkJCXsKCQkJCQkJCS8qIENsYXNzIG5hbWUgbWF0Y2hpbmcgb24gVEggZWxlbWVudCAqLwoJCQkJCQkJZm9yICggaz0wLCBrTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgazxrTGVuIDsgaysrICkKCQkJCQkJCXsKCQkJCQkJCQlpZiAoIGFUYXJnZXRzW2pdID09ICJfYWxsIiB8fAoJCQkJCQkJCSAgICAgJChvU2V0dGluZ3MuYW9Db2x1bW5zW2tdLm5UaCkuaGFzQ2xhc3MoIGFUYXJnZXRzW2pdICkgKQoJCQkJCQkJCXsKCQkJCQkJCQkJZm4oIGssIGFvQ29sRGVmc1tpXSApOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQkvLyBTdGF0aWNhbGx5IGRlZmluZWQgY29sdW1ucyBhcnJheQoJCQlpZiAoIGFvQ29scyApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hb0NvbHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlmbiggaSwgYW9Db2xzW2ldICk7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogQWRkIGEgZGF0YSBhcnJheSB0byB0aGUgdGFibGUsIGNyZWF0aW5nIERPTSBub2RlIGV0Yy4gVGhpcyBpcyB0aGUgcGFyYWxsZWwgdG8gCgkJICogX2ZuR2F0aGVyRGF0YSwgYnV0IGZvciBhZGRpbmcgcm93cyBmcm9tIGEgSmF2YXNjcmlwdCBzb3VyY2UsIHJhdGhlciB0aGFuIGEKCQkgKiBET00gc291cmNlLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIGRhdGEgYXJyYXkgdG8gYmUgYWRkZWQKCQkgKiAgQHJldHVybnMge2ludH0gPj0wIGlmIHN1Y2Nlc3NmdWwgKGluZGV4IG9mIG5ldyBhb0RhdGEgZW50cnkpLCAtMSBpZiBmYWlsZWQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWRkRGF0YSAoIG9TZXR0aW5ncywgYURhdGFTdXBwbGllZCApCgkJewoJCQl2YXIgb0NvbDsKCQkJCgkJCS8qIFRha2UgYW4gaW5kZXBlbmRlbnQgY29weSBvZiB0aGUgZGF0YSBzb3VyY2Ugc28gd2UgY2FuIGJhc2ggaXQgYWJvdXQgYXMgd2Ugd2lzaCAqLwoJCQl2YXIgYURhdGFJbiA9ICgkLmlzQXJyYXkoYURhdGFTdXBwbGllZCkpID8KCQkJCWFEYXRhU3VwcGxpZWQuc2xpY2UoKSA6CgkJCQkkLmV4dGVuZCggdHJ1ZSwge30sIGFEYXRhU3VwcGxpZWQgKTsKCQkJCgkJCS8qIENyZWF0ZSB0aGUgb2JqZWN0IGZvciBzdG9yaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgbmV3IHJvdyAqLwoJCQl2YXIgaVJvdyA9IG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoOwoJCQl2YXIgb0RhdGEgPSAkLmV4dGVuZCggdHJ1ZSwge30sIERhdGFUYWJsZS5tb2RlbHMub1JvdywgewoJCQkJIl9hRGF0YSI6IGFEYXRhSW4KCQkJfSApOwoJCQlvU2V0dGluZ3MuYW9EYXRhLnB1c2goIG9EYXRhICk7CgkJCgkJCS8qIENyZWF0ZSB0aGUgY2VsbHMgKi8KCQkJdmFyIG5UZCwgc1RoaXNUeXBlOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV07CgkJCgkJCQkvKiBVc2UgcmVuZGVyZWQgZGF0YSBmb3IgZmlsdGVyaW5nL3NvcnRpbmcgKi8KCQkJCWlmICggdHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgb0NvbC5iVXNlUmVuZGVyZWQgJiYgb0NvbC5tRGF0YVByb3AgIT09IG51bGwgKQoJCQkJewoJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksIF9mblJlbmRlcihvU2V0dGluZ3MsIGlSb3csIGkpICk7CgkJCQl9CgkJCQkKCQkJCS8qIFNlZSBpZiB3ZSBzaG91bGQgYXV0by1kZXRlY3QgdGhlIGNvbHVtbiB0eXBlICovCgkJCQlpZiAoIG9Db2wuX2JBdXRvVHlwZSAmJiBvQ29sLnNUeXBlICE9ICdzdHJpbmcnICkKCQkJCXsKCQkJCQkvKiBBdHRlbXB0IHRvIGF1dG8gZGV0ZWN0IHRoZSB0eXBlIC0gc2FtZSBhcyBfZm5HYXRoZXJEYXRhKCkgKi8KCQkJCQl2YXIgc1ZhclR5cGUgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAndHlwZScgKTsKCQkJCQlpZiAoIHNWYXJUeXBlICE9PSBudWxsICYmIHNWYXJUeXBlICE9PSAnJyApCgkJCQkJewoJCQkJCQlzVGhpc1R5cGUgPSBfZm5EZXRlY3RUeXBlKCBzVmFyVHlwZSApOwoJCQkJCQlpZiAoIG9Db2wuc1R5cGUgPT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQlvQ29sLnNUeXBlID0gc1RoaXNUeXBlOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBvQ29sLnNUeXBlICE9IHNUaGlzVHlwZSAmJiBvQ29sLnNUeXBlICE9ICJodG1sIiApCgkJCQkJCXsKCQkJCQkJCS8qIFN0cmluZyBpcyBhbHdheXMgdGhlICdmYWxsYmFjaycgb3B0aW9uICovCgkJCQkJCQlvQ29sLnNUeXBlID0gJ3N0cmluZyc7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEFkZCB0byB0aGUgZGlzcGxheSBhcnJheSAqLwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnB1c2goIGlSb3cgKTsKCQkKCQkJLyogQ3JlYXRlIHRoZSBET00gaW1mb3JtYXRpb24gKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQl7CgkJCQlfZm5DcmVhdGVUciggb1NldHRpbmdzLCBpUm93ICk7CgkJCX0KCQkKCQkJcmV0dXJuIGlSb3c7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlYWQgaW4gdGhlIGRhdGEgZnJvbSB0aGUgdGFyZ2V0IHRhYmxlIGZyb20gdGhlIERPTQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdhdGhlckRhdGEoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaUxvb3AsIGksIGlMZW4sIGosIGpMZW4sIGpJbm5lciwKCQkJIAluVGRzLCBuVHJzLCBuVGQsIGFMb2NhbERhdGEsIGlUaGlzSW5kZXgsCgkJCQlpUm93LCBpUm93cywgaUNvbHVtbiwgaUNvbHVtbnMsIHNOb2RlTmFtZSwKCQkJCW9Db2wsIG9EYXRhOwoJCQkKCQkJLyoKCQkJICogUHJvY2VzcyBieSByb3cgZmlyc3QKCQkJICogQWRkIHRoZSBkYXRhIG9iamVjdCBmb3IgdGhlIHdob2xlIHRhYmxlIC0gc3RvcmluZyB0aGUgdHIgbm9kZS4gTm90ZSAtIG5vIHBvaW50IGluIGdldHRpbmcKCQkJICogRE9NIGJhc2VkIGRhdGEgaWYgd2UgYXJlIGdvaW5nIHRvIGdvIGFuZCByZXBsYWNlIGl0IHdpdGggQWpheCBzb3VyY2UgZGF0YS4KCQkJICovCgkJCWlmICggb1NldHRpbmdzLmJEZWZlckxvYWRpbmcgfHwgb1NldHRpbmdzLnNBamF4U291cmNlID09PSBudWxsICkKCQkJewoJCQkJblRycyA9IG9TZXR0aW5ncy5uVEJvZHkuY2hpbGROb2RlczsKCQkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBuVHJzW2ldLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT0gIlRSIiApCgkJCQkJewoJCQkJCQlpVGhpc0luZGV4ID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCQkJCW5UcnNbaV0uX0RUX1Jvd0luZGV4ID0gaVRoaXNJbmRleDsKCQkJCQkJb1NldHRpbmdzLmFvRGF0YS5wdXNoKCAkLmV4dGVuZCggdHJ1ZSwge30sIERhdGFUYWJsZS5tb2RlbHMub1JvdywgewoJCQkJCQkJIm5UciI6IG5UcnNbaV0KCQkJCQkJfSApICk7CgkJCQkJCQoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnB1c2goIGlUaGlzSW5kZXggKTsKCQkJCQkJblRkcyA9IG5UcnNbaV0uY2hpbGROb2RlczsKCQkJCQkJaklubmVyID0gMDsKCQkJCQkJCgkJCQkJCWZvciAoIGo9MCwgakxlbj1uVGRzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJCXsKCQkJCQkJCXNOb2RlTmFtZSA9IG5UZHNbal0ubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQkJCWlmICggc05vZGVOYW1lID09ICJURCIgfHwgc05vZGVOYW1lID09ICJUSCIgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlUaGlzSW5kZXgsIGpJbm5lciwgJC50cmltKG5UZHNbal0uaW5uZXJIVE1MKSApOwoJCQkJCQkJCWpJbm5lcisrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBHYXRoZXIgaW4gdGhlIFREIGVsZW1lbnRzIG9mIHRoZSBUYWJsZSAtIG5vdGUgdGhhdCB0aGlzIGlzIGJhc2ljYWxseSB0aGUgc2FtZSBhcwoJCQkgKiBmbkdldFRkTm9kZXMsIGJ1dCB0aGF0IGZ1bmN0aW9uIHRha2VzIGFjY291bnQgb2YgaGlkZGVuIGNvbHVtbnMsIHdoaWNoIHdlIGhhdmVuJ3QgeWV0CgkJCSAqIHNldHVwIQoJCQkgKi8KCQkJblRycyA9IF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCQluVGRzID0gW107CgkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIGo9MCwgakxlbj1uVHJzW2ldLmNoaWxkTm9kZXMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQluVGQgPSBuVHJzW2ldLmNoaWxkTm9kZXNbal07CgkJCQkJc05vZGVOYW1lID0gblRkLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk7CgkJCQkJaWYgKCBzTm9kZU5hbWUgPT0gIlREIiB8fCBzTm9kZU5hbWUgPT0gIlRIIiApCgkJCQkJewoJCQkJCQluVGRzLnB1c2goIG5UZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogTm93IHByb2Nlc3MgYnkgY29sdW1uICovCgkJCWZvciAoIGlDb2x1bW49MCwgaUNvbHVtbnM9b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpQ29sdW1uPGlDb2x1bW5zIDsgaUNvbHVtbisrICkKCQkJewoJCQkJb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl07CgkJCgkJCQkvKiBHZXQgdGhlIHRpdGxlIG9mIHRoZSBjb2x1bW4gLSB1bmxlc3MgdGhlcmUgaXMgYSB1c2VyIHNldCBvbmUgKi8KCQkJCWlmICggb0NvbC5zVGl0bGUgPT09IG51bGwgKQoJCQkJewoJCQkJCW9Db2wuc1RpdGxlID0gb0NvbC5uVGguaW5uZXJIVE1MOwoJCQkJfQoJCQkJCgkJCQl2YXIKCQkJCQliQXV0b1R5cGUgPSBvQ29sLl9iQXV0b1R5cGUsCgkJCQkJYlJlbmRlciA9IHR5cGVvZiBvQ29sLmZuUmVuZGVyID09PSAnZnVuY3Rpb24nLAoJCQkJCWJDbGFzcyA9IG9Db2wuc0NsYXNzICE9PSBudWxsLAoJCQkJCWJWaXNpYmxlID0gb0NvbC5iVmlzaWJsZSwKCQkJCQluQ2VsbCwgc1RoaXNUeXBlLCBzUmVuZGVyZWQsIHNWYWxUeXBlOwoJCQkJCgkJCQkvKiBBIHNpbmdsZSBsb29wIHRvIHJ1bGUgdGhlbSBhbGwgKGFuZCBiZSBtb3JlIGVmZmljaWVudCkgKi8KCQkJCWlmICggYkF1dG9UeXBlIHx8IGJSZW5kZXIgfHwgYkNsYXNzIHx8ICFiVmlzaWJsZSApCgkJCQl7CgkJCQkJZm9yICggaVJvdz0wLCBpUm93cz1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGlSb3c8aVJvd3MgOyBpUm93KysgKQoJCQkJCXsKCQkJCQkJb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQkJCQluQ2VsbCA9IG5UZHNbIChpUm93KmlDb2x1bW5zKSArIGlDb2x1bW4gXTsKCQkJCQkJCgkJCQkJCS8qIFR5cGUgZGV0ZWN0aW9uICovCgkJCQkJCWlmICggYkF1dG9UeXBlICYmIG9Db2wuc1R5cGUgIT0gJ3N0cmluZycgKQoJCQkJCQl7CgkJCQkJCQlzVmFsVHlwZSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICd0eXBlJyApOwoJCQkJCQkJaWYgKCBzVmFsVHlwZSAhPT0gJycgKQoJCQkJCQkJewoJCQkJCQkJCXNUaGlzVHlwZSA9IF9mbkRldGVjdFR5cGUoIHNWYWxUeXBlICk7CgkJCQkJCQkJaWYgKCBvQ29sLnNUeXBlID09PSBudWxsICkKCQkJCQkJCQl7CgkJCQkJCQkJCW9Db2wuc1R5cGUgPSBzVGhpc1R5cGU7CgkJCQkJCQkJfQoJCQkJCQkJCWVsc2UgaWYgKCBvQ29sLnNUeXBlICE9IHNUaGlzVHlwZSAmJiAKCQkJCQkJCQkgICAgICAgICAgb0NvbC5zVHlwZSAhPSAiaHRtbCIgKQoJCQkJCQkJCXsKCQkJCQkJCQkJLyogU3RyaW5nIGlzIGFsd2F5cyB0aGUgJ2ZhbGxiYWNrJyBvcHRpb24gKi8KCQkJCQkJCQkJb0NvbC5zVHlwZSA9ICdzdHJpbmcnOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQoJCQkJCQlpZiAoIHR5cGVvZiBvQ29sLm1EYXRhUHJvcCA9PT0gJ2Z1bmN0aW9uJyApCgkJCQkJCXsKCQkJCQkJCW5DZWxsLmlubmVySFRNTCA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICdkaXNwbGF5JyApOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBSZW5kZXJpbmcgKi8KCQkJCQkJaWYgKCBiUmVuZGVyICkKCQkJCQkJewoJCQkJCQkJc1JlbmRlcmVkID0gX2ZuUmVuZGVyKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4gKTsKCQkJCQkJCW5DZWxsLmlubmVySFRNTCA9IHNSZW5kZXJlZDsKCQkJCQkJCWlmICggb0NvbC5iVXNlUmVuZGVyZWQgKQoJCQkJCQkJewoJCQkJCQkJCS8qIFVzZSB0aGUgcmVuZGVyZWQgZGF0YSBmb3IgZmlsdGVyaW5nL3NvcnRpbmcgKi8KCQkJCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCBzUmVuZGVyZWQgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogQ2xhc3NlcyAqLwoJCQkJCQlpZiAoIGJDbGFzcyApCgkJCQkJCXsKCQkJCQkJCW5DZWxsLmNsYXNzTmFtZSArPSAnICcrb0NvbC5zQ2xhc3M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIENvbHVtbiB2aXNhYmlsaXR5ICovCgkJCQkJCWlmICggIWJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbkNlbGw7CgkJCQkJCQluQ2VsbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuQ2VsbCApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbnVsbDsKCQkJCQkJfQoJCQoJCQkJCQlpZiAoIG9Db2wuZm5DcmVhdGVkQ2VsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJCW5DZWxsLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpQ29sdW1uCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8qIFJvdyBjcmVhdGVkIGNhbGxiYWNrcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5hb1Jvd0NyZWF0ZWRDYWxsYmFjay5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpXTsKCQkJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUm93Q3JlYXRlZENhbGxiYWNrJywgbnVsbCwgW29EYXRhLm5Uciwgb0RhdGEuX2FEYXRhLCBpXSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFRha2UgYSBUUiBlbGVtZW50IGFuZCBjb252ZXJ0IGl0IHRvIGFuIGluZGV4IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0aGUgVFIgZWxlbWVudCB0byBmaW5kCgkJICogIEByZXR1cm5zIHtpbnR9IGluZGV4IGlmIHRoZSBub2RlIGlzIGZvdW5kLCBudWxsIGlmIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ob2RlVG9EYXRhSW5kZXgoIG9TZXR0aW5ncywgbiApCgkJewoJCQlyZXR1cm4gKG4uX0RUX1Jvd0luZGV4IT09dW5kZWZpbmVkKSA/IG4uX0RUX1Jvd0luZGV4IDogbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSBhIFREIGVsZW1lbnQgYW5kIGNvbnZlcnQgaXQgaW50byBhIGNvbHVtbiBkYXRhIGluZGV4IChub3QgdGhlIHZpc2libGUgaW5kZXgpCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBudW1iZXIgdGhlIFREL1RIIGNhbiBiZSBmb3VuZCBpbgoJCSAqICBAcGFyYW0ge25vZGV9IG4gVGhlIFREL1RIIGVsZW1lbnQgdG8gZmluZAoJCSAqICBAcmV0dXJucyB7aW50fSBpbmRleCBpZiB0aGUgbm9kZSBpcyBmb3VuZCwgLTEgaWYgbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk5vZGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlSb3csIG4gKQoJCXsKCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5DZWxsc1tpXSA9PT0gbiApCgkJCQl7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIC0xOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgZGF0YSBmb3IgYSBnaXZlbiByb3cgZnJvbSB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgndHlwZScgJ2ZpbHRlcicgJ3NvcnQnKQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpUm93LCBzU3BlY2lmaWMgKQoJCXsKCQkJdmFyIG91dCA9IFtdOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb3V0LnB1c2goIF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksIHNTcGVjaWZpYyApICk7CgkJCX0KCQkJcmV0dXJuIG91dDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBkYXRhIGZvciBhIGdpdmVuIGNlbGwgZnJvbSB0aGUgaW50ZXJuYWwgY2FjaGUsIHRha2luZyBpbnRvIGFjY291bnQgZGF0YSBtYXBwaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIHJvdyBpZAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBDb2x1bW4gaW5kZXgKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgnZGlzcGxheScsICd0eXBlJyAnZmlsdGVyJyAnc29ydCcpCgkJICogIEByZXR1cm5zIHsqfSBDZWxsIGRhdGEKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgc1NwZWNpZmljICkKCQl7CgkJCXZhciBzRGF0YTsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJaWYgKCAoc0RhdGE9b0NvbC5mbkdldERhdGEoIG9EYXRhLCBzU3BlY2lmaWMgKSkgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmlEcmF3RXJyb3IgIT0gb1NldHRpbmdzLmlEcmF3ICYmIG9Db2wuc0RlZmF1bHRDb250ZW50ID09PSBudWxsICkKCQkJCXsKCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJlcXVlc3RlZCB1bmtub3duIHBhcmFtZXRlciAnIitvQ29sLm1EYXRhUHJvcCsKCQkJCQkJIicgZnJvbSB0aGUgZGF0YSBzb3VyY2UgZm9yIHJvdyAiK2lSb3cgKTsKCQkJCQlvU2V0dGluZ3MuaURyYXdFcnJvciA9IG9TZXR0aW5ncy5pRHJhdzsKCQkJCX0KCQkJCXJldHVybiBvQ29sLnNEZWZhdWx0Q29udGVudDsKCQkJfQoJCQoJCQkvKiBXaGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsLCB3ZSBjYW4gdXNlIGRlZmF1bHQgY29sdW1uIGRhdGEgKi8KCQkJaWYgKCBzRGF0YSA9PT0gbnVsbCAmJiBvQ29sLnNEZWZhdWx0Q29udGVudCAhPT0gbnVsbCApCgkJCXsKCQkJCXNEYXRhID0gb0NvbC5zRGVmYXVsdENvbnRlbnQ7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSA9PT0gJ2Z1bmN0aW9uJyApCgkJCXsKCQkJCS8qIElmIHRoZSBkYXRhIHNvdXJjZSBpcyBhIGZ1bmN0aW9uLCB0aGVuIHdlIHJ1biBpdCBhbmQgdXNlIHRoZSByZXR1cm4gKi8KCQkJCXJldHVybiBzRGF0YSgpOwoJCQl9CgkJCgkJCWlmICggc1NwZWNpZmljID09ICdkaXNwbGF5JyAmJiBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFNldCB0aGUgdmFsdWUgZm9yIGEgc3BlY2lmaWMgY2VsbCwgaW50byB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgQ29sdW1uIGluZGV4CgkJICogIEBwYXJhbSB7Kn0gdmFsIFZhbHVlIHRvIHNldAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCB2YWwgKQoJCXsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJb0NvbC5mblNldERhdGEoIG9EYXRhLCB2YWwgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGEgZnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byBnZXQgZGF0YSBmcm9tIGEgc291cmNlIG9iamVjdCwgdGFraW5nCgkJICogaW50byBhY2NvdW50IHRoZSBhYmlsaXR5IHRvIHVzZSBuZXN0ZWQgb2JqZWN0cyBhcyBhIHNvdXJjZQoJCSAqICBAcGFyYW0ge3N0cmluZ3xpbnR8ZnVuY3Rpb259IG1Tb3VyY2UgVGhlIGRhdGEgc291cmNlIGZvciB0aGUgb2JqZWN0CgkJICogIEByZXR1cm5zIHtmdW5jdGlvbn0gRGF0YSBnZXQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0T2JqZWN0RGF0YUZuKCBtU291cmNlICkKCQl7CgkJCWlmICggbVNvdXJjZSA9PT0gbnVsbCApCgkJCXsKCQkJCS8qIEdpdmUgYW4gZW1wdHkgc3RyaW5nIGZvciByZW5kZXJpbmcgLyBzb3J0aW5nIGV0YyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ2Z1bmN0aW9uJyApCgkJCXsKCQkJCXJldHVybiBmdW5jdGlvbiAoZGF0YSwgdHlwZSkgewoJCQkJCXJldHVybiBtU291cmNlKCBkYXRhLCB0eXBlICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgbVNvdXJjZS5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQl7CgkJCQkvKiBJZiB0aGVyZSBpcyBhIC4gaW4gdGhlIHNvdXJjZSBzdHJpbmcgdGhlbiB0aGUgZGF0YSBzb3VyY2UgaXMgaW4gYSAKCQkJCSAqIG5lc3RlZCBvYmplY3Qgc28gd2UgbG9vcCBvdmVyIHRoZSBkYXRhIGZvciBlYWNoIGxldmVsIHRvIGdldCB0aGUgbmV4dAoJCQkJICogbGV2ZWwgZG93bi4gT24gZWFjaCBsb29wIHdlIHRlc3QgZm9yIHVuZGVmaW5lZCwgYW5kIGlmIGZvdW5kIGltbWVkaWF0bHkKCQkJCSAqIHJldHVybi4gVGhpcyBhbGxvd3MgZW50aXJlIG9iamVjdHMgdG8gYmUgbWlzc2luZyBhbmQgc0RlZmF1bHRDb250ZW50IHRvCgkJCQkgKiBiZSB1c2VkIGlmIGRlZmluZWQsIHJhdGhlciB0aGFuIHRocm93aW5nIGFuIGVycm9yCgkJCQkgKi8KCQkJCXZhciBhID0gbVNvdXJjZS5zcGxpdCgnLicpOwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQlkYXRhID0gZGF0YVsgYVtpXSBdOwoJCQkJCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCApCgkJCQkJCXsKCQkJCQkJCXJldHVybiB1bmRlZmluZWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuIGRhdGE7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIGRhdGFbbVNvdXJjZV07CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHNldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIHNldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogTm90aGluZyB0byBkbyB3aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkge307CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQltU291cmNlKCBkYXRhLCAnc2V0JywgdmFsICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgbVNvdXJjZS5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQl7CgkJCQkvKiBMaWtlIHRoZSBnZXQsIHdlIG5lZWQgdG8gZ2V0IGRhdGEgZnJvbSBhIG5lc3RlZCBvYmplY3QuICAqLwoJCQkJdmFyIGEgPSBtU291cmNlLnNwbGl0KCcuJyk7CgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGgtMSA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQlkYXRhID0gZGF0YVsgYVtpXSBdOwoJCQkJCX0KCQkJCQlkYXRhWyBhW2EubGVuZ3RoLTFdIF0gPSB2YWw7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQlkYXRhW21Tb3VyY2VdID0gdmFsOwkKCQkJCX07CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGFuIGFycmF5IHdpdGggdGhlIGZ1bGwgdGFibGUgZGF0YQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIGFycmF5IHthcnJheX0gYURhdGEgTWFzdGVyIGRhdGEgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0RGF0YU1hc3RlciAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYURhdGEgPSBbXTsKCQkJdmFyIGlMZW4gPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbjsgaSsrICkKCQkJewoJCQkJYURhdGEucHVzaCggb1NldHRpbmdzLmFvRGF0YVtpXS5fYURhdGEgKTsKCQkJfQoJCQlyZXR1cm4gYURhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIE51a2UgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2xlYXJUYWJsZSggb1NldHRpbmdzICkKCQl7CgkJCW9TZXR0aW5ncy5hb0RhdGEuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCApOwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNwbGljZSggMCwgb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggKTsKCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoICk7CgkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJfQoJCQoJCQoJCSAvKioKCQkgKiBUYWtlIGFuIGFycmF5IG9mIGludGVnZXJzIChpbmRleCBhcnJheSkgYW5kIHJlbW92ZSBhIHRhcmdldCBpbnRlZ2VyICh2YWx1ZSAtIG5vdCAKCQkgKiB0aGUga2V5ISkKCQkgKiAgQHBhcmFtIHthcnJheX0gYSBJbmRleCBhcnJheSB0byB0YXJnZXQKCQkgKiAgQHBhcmFtIHtpbnR9IGlUYXJnZXQgdmFsdWUgdG8gZmluZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EZWxldGVJbmRleCggYSwgaVRhcmdldCApCgkJewoJCQl2YXIgaVRhcmdldEluZGV4ID0gLTE7CgkJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBhW2ldID09IGlUYXJnZXQgKQoJCQkJewoJCQkJCWlUYXJnZXRJbmRleCA9IGk7CgkJCQl9CgkJCQllbHNlIGlmICggYVtpXSA+IGlUYXJnZXQgKQoJCQkJewoJCQkJCWFbaV0tLTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBpVGFyZ2V0SW5kZXggIT0gLTEgKQoJCQl7CgkJCQlhLnNwbGljZSggaVRhcmdldEluZGV4LCAxICk7CgkJCX0KCQl9CgkJCgkJCgkJIC8qKgoJCSAqIENhbGwgdGhlIGRldmVsb3BlciBkZWZpbmVkIGZuUmVuZGVyIGZ1bmN0aW9uIGZvciBhIGdpdmVuIGNlbGwgKHJvdy9jb2x1bW4pIHdpdGgKCQkgKiB0aGUgcmVxdWlyZWQgcGFyYW1ldGVycyBhbmQgcmV0dXJuIHRoZSByZXN1bHQuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIGluZGV4IGZvciB0aGUgcm93CgkJICogIEBwYXJhbSB7aW50fSBpQ29sIGFvQ29sdW1ucyBpbmRleCBmb3IgdGhlIGNvbHVtbgoJCSAqICBAcmV0dXJucyB7Kn0gUmV0dXJuIG9mIHRoZSBkZXZlbG9wZXIncyBmblJlbmRlciBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbCApCgkJewoJCQl2YXIgb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbF07CgkJCgkJCXJldHVybiBvQ29sLmZuUmVuZGVyKCB7CgkJCQkiaURhdGFSb3ciOiAgICBpUm93LAoJCQkJImlEYXRhQ29sdW1uIjogaUNvbCwKCQkJCSJvU2V0dGluZ3MiOiAgIG9TZXR0aW5ncywKCQkJCSJhRGF0YSI6ICAgICAgIG9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhLAoJCQkJIm1EYXRhUHJvcCI6ICAgb0NvbC5tRGF0YVByb3AKCQkJfSwgX2ZuR2V0Q2VsbERhdGEob1NldHRpbmdzLCBpUm93LCBpQ29sLCAnZGlzcGxheScpICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIG5ldyBUUiBlbGVtZW50IChhbmQgaXQncyBURCBjaGlsZHJlbikgZm9yIGEgcm93CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgUm93IHRvIGNvbnNpZGVyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNyZWF0ZVRyICggb1NldHRpbmdzLCBpUm93ICkKCQl7CgkJCXZhciBvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCXZhciBuVGQ7CgkJCgkJCWlmICggb0RhdGEublRyID09PSBudWxsICkKCQkJewoJCQkJb0RhdGEublRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKCQkKCQkJCS8qIFVzZSBhIHByaXZhdGUgcHJvcGVydHkgb24gdGhlIG5vZGUgdG8gYWxsb3cgcmVzZXJ2ZSBtYXBwaW5nIGZyb20gdGhlIG5vZGUKCQkJCSAqIHRvIHRoZSBhb0RhdGEgYXJyYXkgZm9yIGZhc3QgbG9vayB1cAoJCQkJICovCgkJCQlvRGF0YS5uVHIuX0RUX1Jvd0luZGV4ID0gaVJvdzsKCQkKCQkJCS8qIFNwZWNpYWwgcGFyYW1ldGVycyBjYW4gYmUgZ2l2ZW4gYnkgdGhlIGRhdGEgc291cmNlIHRvIGJlIHVzZWQgb24gdGhlIHJvdyAqLwoJCQkJaWYgKCBvRGF0YS5fYURhdGEuRFRfUm93SWQgKQoJCQkJewoJCQkJCW9EYXRhLm5Uci5pZCA9IG9EYXRhLl9hRGF0YS5EVF9Sb3dJZDsKCQkJCX0KCQkKCQkJCWlmICggb0RhdGEuX2FEYXRhLkRUX1Jvd0NsYXNzICkKCQkJCXsKCQkJCQkkKG9EYXRhLm5UcikuYWRkQ2xhc3MoIG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzcyApOwoJCQkJfQoJCQoJCQkJLyogUHJvY2VzcyBlYWNoIGNvbHVtbiAqLwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldOwoJCQkJCW5UZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CgkJCgkJCQkJLyogUmVuZGVyIGlmIG5lZWRlZCAtIGlmIGJVc2VSZW5kZXJlZCBpcyB0cnVlIHRoZW4gd2UgYWxyZWFkeSBoYXZlIHRoZSByZW5kZXJlZAoJCQkJCSAqIHZhbHVlIGluIHRoZSBkYXRhIHNvdXJjZSAtIHNvIGNhbiBqdXN0IHVzZSB0aGF0CgkJCQkJICovCgkJCQkJblRkLmlubmVySFRNTCA9ICh0eXBlb2Ygb0NvbC5mblJlbmRlciA9PT0gJ2Z1bmN0aW9uJyAmJiAoIW9Db2wuYlVzZVJlbmRlcmVkIHx8IG9Db2wubURhdGFQcm9wID09PSBudWxsKSkgPwoJCQkJCQlfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaSApIDoKCQkJCQkJX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCQkvKiBBZGQgdXNlciBkZWZpbmVkIGNsYXNzICovCgkJCQkJaWYgKCBvQ29sLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQuY2xhc3NOYW1lID0gb0NvbC5zQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggb0NvbC5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlvRGF0YS5uVHIuYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBudWxsOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBuVGQ7CgkJCQkJfQoJCQoJCQkJCWlmICggb0NvbC5mbkNyZWF0ZWRDZWxsICkKCQkJCQl7CgkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJblRkLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpCgkJCQkJCSk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG51bGwsIFtvRGF0YS5uVHIsIG9EYXRhLl9hRGF0YSwgaVJvd10gKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgdGhlIEhUTUwgaGVhZGVyIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZEhlYWQoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaSwgblRoLCBpTGVuLCBqLCBqTGVuOwoJCQl2YXIgaVRocyA9IG9TZXR0aW5ncy5uVEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJykubGVuZ3RoOwoJCQl2YXIgaUNvcnJlY3RvciA9IDA7CgkJCXZhciBqcUNoaWxkcmVuOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYSBoZWFkZXIgaW4gcGxhY2UgLSB0aGVuIHVzZSBpdCAtIG90aGVyd2lzZSBpdCdzIGdvaW5nIHRvIGdldCBudWtlZC4uLiAqLwoJCQlpZiAoIGlUaHMgIT09IDAgKQoJCQl7CgkJCQkvKiBXZSd2ZSBnb3QgYSB0aGVhZCBmcm9tIHRoZSBET00sIHNvIHJlbW92ZSBoaWRkZW4gY29sdW1ucyBhbmQgYXBwbHkgd2lkdGggdG8gdmlzIGNvbHMgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJblRoID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGg7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgncm9sZScsICdjb2x1bW5oZWFkZXInKTsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4Jywgb1NldHRpbmdzLmlUYWJJbmRleCk7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBvU2V0dGluZ3Muc1RhYmxlSWQpOwoJCQkJCX0KCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCSQoblRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogU2V0IHRoZSB0aXRsZSBvZiB0aGUgY29sdW1uIGlmIGl0IGlzIHVzZXIgZGVmaW5lZCAobm90IHdoYXQgd2FzIGF1dG8gZGV0ZWN0ZWQpICovCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZSAhPSBuVGguaW5uZXJIVE1MICkKCQkJCQl7CgkJCQkJCW5UaC5pbm5lckhUTUwgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBXZSBkb24ndCBoYXZlIGEgaGVhZGVyIGluIHRoZSBET00gLSBzbyB3ZSBhcmUgZ29pbmcgdG8gaGF2ZSB0byBjcmVhdGUgb25lICovCgkJCQl2YXIgblRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInRyIiApOwoJCQkJCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5UaCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoOwoJCQkJCW5UaC5pbm5lckhUTUwgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZTsKCQkJCQluVGguc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQkkKG5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICk7CgkJCQkJfQoJCQkJCQoJCQkJCW5Uci5hcHBlbmRDaGlsZCggblRoICk7CgkJCQl9CgkJCQkkKG9TZXR0aW5ncy5uVEhlYWQpLmh0bWwoICcnIClbMF0uYXBwZW5kQ2hpbGQoIG5UciApOwoJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBvU2V0dGluZ3MuYW9IZWFkZXIsIG9TZXR0aW5ncy5uVEhlYWQgKTsKCQkJfQoJCQkKCQkJLyogQVJJQSByb2xlIGZvciB0aGUgcm93cyAqLwkKCQkJJChvU2V0dGluZ3MublRIZWFkKS5jaGlsZHJlbigndHInKS5hdHRyKCdyb2xlJywgJ3JvdycpOwoJCQkKCQkJLyogQWRkIHRoZSBleHRyYSBtYXJrdXAgbmVlZGVkIGJ5IGpRdWVyeSBVSSdzIHRoZW1lcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluVGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaDsKCQkJCQkKCQkJCQl2YXIgbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJCW5EaXYuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJV3JhcHBlcjsKCQkJCQkkKG5UaCkuY29udGVudHMoKS5hcHBlbmRUbyhuRGl2KTsKCQkJCQkKCQkJCQl2YXIgblNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CgkJCQkJblNwYW4uY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SWNvbjsKCQkJCQluRGl2LmFwcGVuZENoaWxkKCBuU3BhbiApOwoJCQkJCW5UaC5hcHBlbmRDaGlsZCggbkRpdiApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICE9PSBmYWxzZSApCgkJCQkJewoJCQkJCQlfZm5Tb3J0QXR0YWNoTGlzdGVuZXIoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgsIGkgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBEZWFsIHdpdGggdGhlIGZvb3RlciAtIGFkZCBjbGFzc2VzIGlmIHJlcXVpcmVkICovCgkJCWlmICggb1NldHRpbmdzLm9DbGFzc2VzLnNGb290ZXJUSCAhPT0gIiIgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVEZvb3QpLmNoaWxkcmVuKCd0cicpLmNoaWxkcmVuKCd0aCcpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc0Zvb3RlclRIICk7CgkJCX0KCQkJCgkJCS8qIENhY2hlIHRoZSBmb290ZXIgZWxlbWVudHMgKi8KCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncywgbnVsbCwgb1NldHRpbmdzLmFvRm9vdGVyICk7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5DZWxsc1tpXSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UZiA9IGFuQ2VsbHNbaV07CgkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKQoJCQkJCQl7CgkJCQkJCQkkKGFuQ2VsbHNbaV0pLmFkZENsYXNzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIGhlYWRlciAob3IgZm9vdGVyKSBlbGVtZW50IGJhc2VkIG9uIHRoZSBjb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZXMuIFRoZQoJCSAqIG1ldGhvZG9sb2d5IGhlcmUgaXMgdG8gdXNlIHRoZSBsYXlvdXQgYXJyYXkgZnJvbSBfZm5EZXRlY3RIZWFkZXIsIG1vZGlmaWVkIGZvcgoJCSAqIHRoZSBpbnN0YW50YW5lb3VzIGNvbHVtbiB2aXNpYmlsaXR5LCB0byBjb25zdHJ1Y3QgdGhlIG5ldyBsYXlvdXQuIFRoZSBncmlkIGlzCgkJICogdHJhdmVyc2VkIG92ZXIgY2VsbCBhdCBhIHRpbWUgaW4gYSByb3dzIHggY29sdW1ucyBncmlkIGZhc2hpb24sIGFsdGhvdWdoIGVhY2ggCgkJICogY2VsbCBpbnNlcnQgY2FuIGNvdmVyIG11bHRpcGxlIGVsZW1lbnRzIGluIHRoZSBncmlkIC0gd2hpY2ggaXMgdHJhY2tzIHVzaW5nIHRoZQoJCSAqIGFBcHBsaWVkIGFycmF5LiBDZWxsIGluc2VydHMgaW4gdGhlIGdyaWQgd2lsbCBvbmx5IG9jY3VyIHdoZXJlIHRoZXJlIGlzbid0CgkJICogYWxyZWFkeSBhIGNlbGwgaW4gdGhhdCBwb3NpdGlvbi4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0gYXJyYXkge29iamVjdHN9IGFvU291cmNlIExheW91dCBhcnJheSBmcm9tIF9mbkRldGVjdEhlYWRlcgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiSW5jbHVkZUhpZGRlbj1mYWxzZV0gSWYgdHJ1ZSB0aGVuIGluY2x1ZGUgdGhlIGhpZGRlbiBjb2x1bW5zIGluIHRoZSBjYWxjLCAKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgYW9Tb3VyY2UsIGJJbmNsdWRlSGlkZGVuICkKCQl7CgkJCXZhciBpLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuLCBuLCBuTG9jYWxUcjsKCQkJdmFyIGFvTG9jYWwgPSBbXTsKCQkJdmFyIGFBcHBsaWVkID0gW107CgkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgaVJvd3NwYW4sIGlDb2xzcGFuOwoJCQoJCQlpZiAoICBiSW5jbHVkZUhpZGRlbiA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJYkluY2x1ZGVIaWRkZW4gPSBmYWxzZTsKCQkJfQoJCQoJCQkvKiBNYWtlIGEgY29weSBvZiB0aGUgbWFzdGVyIGxheW91dCBhcnJheSwgYnV0IHdpdGhvdXQgdGhlIHZpc2libGUgY29sdW1ucyBpbiBpdCAqLwoJCQlmb3IgKCBpPTAsIGlMZW49YW9Tb3VyY2UubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYW9Mb2NhbFtpXSA9IGFvU291cmNlW2ldLnNsaWNlKCk7CgkJCQlhb0xvY2FsW2ldLm5UciA9IGFvU291cmNlW2ldLm5UcjsKCQkKCQkJCS8qIFJlbW92ZSBhbnkgY29sdW1ucyB3aGljaCBhcmUgY3VycmVudGx5IGhpZGRlbiAqLwoJCQkJZm9yICggaj1pQ29sdW1ucy0xIDsgaj49MCA7IGotLSApCgkJCQl7CgkJCQkJaWYgKCAhb1NldHRpbmdzLmFvQ29sdW1uc1tqXS5iVmlzaWJsZSAmJiAhYkluY2x1ZGVIaWRkZW4gKQoJCQkJCXsKCQkJCQkJYW9Mb2NhbFtpXS5zcGxpY2UoIGosIDEgKTsKCQkJCQl9CgkJCQl9CgkJCgkJCQkvKiBQcmVwIHRoZSBhcHBsaWVkIGFycmF5IC0gaXQgbmVlZHMgYW4gZWxlbWVudCBmb3IgZWFjaCByb3cgKi8KCQkJCWFBcHBsaWVkLnB1c2goIFtdICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPWFvTG9jYWwubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJbkxvY2FsVHIgPSBhb0xvY2FsW2ldLm5UcjsKCQkJCQoJCQkJLyogQWxsIGNlbGxzIGFyZSBnb2luZyB0byBiZSByZXBsYWNlZCwgc28gZW1wdHkgb3V0IHRoZSByb3cgKi8KCQkJCWlmICggbkxvY2FsVHIgKQoJCQkJewoJCQkJCXdoaWxlKCAobiA9IG5Mb2NhbFRyLmZpcnN0Q2hpbGQpICkKCQkJCQl7CgkJCQkJCW5Mb2NhbFRyLnJlbW92ZUNoaWxkKCBuICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJZm9yICggaj0wLCBqTGVuPWFvTG9jYWxbaV0ubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpUm93c3BhbiA9IDE7CgkJCQkJaUNvbHNwYW4gPSAxOwoJCQoJCQkJCS8qIENoZWNrIHRvIHNlZSBpZiB0aGVyZSBpcyBhbHJlYWR5IGEgY2VsbCAocm93L2NvbHNwYW4pIGNvdmVyaW5nIG91ciB0YXJnZXQKCQkJCQkgKiBpbnNlcnQgcG9pbnQuIElmIHRoZXJlIGlzLCB0aGVuIHRoZXJlIGlzIG5vdGhpbmcgdG8gZG8uCgkJCQkJICovCgkJCQkJaWYgKCBhQXBwbGllZFtpXVtqXSA9PT0gdW5kZWZpbmVkICkKCQkJCQl7CgkJCQkJCW5Mb2NhbFRyLmFwcGVuZENoaWxkKCBhb0xvY2FsW2ldW2pdLmNlbGwgKTsKCQkJCQkJYUFwcGxpZWRbaV1bal0gPSAxOwoJCQoJCQkJCQkvKiBFeHBhbmQgdGhlIGNlbGwgdG8gY292ZXIgYXMgbWFueSByb3dzIGFzIG5lZWRlZCAqLwoJCQkJCQl3aGlsZSAoIGFvTG9jYWxbaStpUm93c3Bhbl0gIT09IHVuZGVmaW5lZCAmJgoJCQkJCQkgICAgICAgIGFvTG9jYWxbaV1bal0uY2VsbCA9PSBhb0xvY2FsW2kraVJvd3NwYW5dW2pdLmNlbGwgKQoJCQkJCQl7CgkJCQkJCQlhQXBwbGllZFtpK2lSb3dzcGFuXVtqXSA9IDE7CgkJCQkJCQlpUm93c3BhbisrOwoJCQkJCQl9CgkJCgkJCQkJCS8qIEV4cGFuZCB0aGUgY2VsbCB0byBjb3ZlciBhcyBtYW55IGNvbHVtbnMgYXMgbmVlZGVkICovCgkJCQkJCXdoaWxlICggYW9Mb2NhbFtpXVtqK2lDb2xzcGFuXSAhPT0gdW5kZWZpbmVkICYmCgkJCQkJCSAgICAgICAgYW9Mb2NhbFtpXVtqXS5jZWxsID09IGFvTG9jYWxbaV1baitpQ29sc3Bhbl0uY2VsbCApCgkJCQkJCXsKCQkJCQkJCS8qIE11c3QgdXBkYXRlIHRoZSBhcHBsaWVkIGFycmF5IG92ZXIgdGhlIHJvd3MgZm9yIHRoZSBjb2x1bW5zICovCgkJCQkJCQlmb3IgKCBrPTAgOyBrPGlSb3dzcGFuIDsgaysrICkKCQkJCQkJCXsKCQkJCQkJCQlhQXBwbGllZFtpK2tdW2oraUNvbHNwYW5dID0gMTsKCQkJCQkJCX0KCQkJCQkJCWlDb2xzcGFuKys7CgkJCQkJCX0KCQkKCQkJCQkJLyogRG8gdGhlIGFjdHVhbCBleHBhbnNpb24gaW4gdGhlIERPTSAqLwoJCQkJCQlhb0xvY2FsW2ldW2pdLmNlbGwucm93U3BhbiA9IGlSb3dzcGFuOwoJCQkJCQlhb0xvY2FsW2ldW2pdLmNlbGwuY29sU3BhbiA9IGlDb2xzcGFuOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBJbnNlcnQgdGhlIHJlcXVpcmVkIFRSIG5vZGVzIGludG8gdGhlIHRhYmxlIGZvciBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRHJhdyggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpLCBpTGVuLCBuOwoJCQl2YXIgYW5Sb3dzID0gW107CgkJCXZhciBpUm93Q291bnQgPSAwOwoJCQl2YXIgaVN0cmlwZXMgPSBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmxlbmd0aDsKCQkJdmFyIGlPcGVuUm93cyA9IG9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aDsKCQkJCgkJCS8qIFByb3ZpZGUgYSBwcmUtY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZSBkcmF3IGlzIGZhbHNlIGlzIHJldHVybmVkICovCgkJCXZhciBhUHJlRHJhdyA9IF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAncHJlRHJhdycsIFtvU2V0dGluZ3NdICk7CgkJCWlmICggJC5pbkFycmF5KCBmYWxzZSwgYVByZURyYXcgKSAhPT0gLTEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCW9TZXR0aW5ncy5iRHJhd2luZyA9IHRydWU7CgkJCQoJCQkvKiBDaGVjayBhbmQgc2VlIGlmIHdlIGhhdmUgYW4gaW5pdGlhbCBkcmF3IHBvc2l0aW9uIGZyb20gc3RhdGUgc2F2aW5nICovCgkJCWlmICggb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ICE9PSB1bmRlZmluZWQgJiYgb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ICE9IC0xICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQ7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gKG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA+PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpKSA/CgkJCQkJCTAgOiBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQ7CgkJCQl9CgkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSAtMTsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgZHJhdyBpbnRlcmNlcHQgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyApCgkJCXsKCQkJCW9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nID0gZmFsc2U7CgkJCQlvU2V0dGluZ3MuaURyYXcrKzsKCQkJfQoJCQllbHNlIGlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQlvU2V0dGluZ3MuaURyYXcrKzsKCQkJfQoJCQllbHNlIGlmICggIW9TZXR0aW5ncy5iRGVzdHJveWluZyAmJiAhX2ZuQWpheFVwZGF0ZSggb1NldHRpbmdzICkgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCWlmICggb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQl2YXIgaVN0YXJ0ID0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0OwoJCQkJdmFyIGlFbmQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5RW5kOwoJCQkJCgkJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJewoJCQkJCWlTdGFydCA9IDA7CgkJCQkJaUVuZCA9IG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoOwoJCQkJfQoJCQkJCgkJCQlmb3IgKCB2YXIgaj1pU3RhcnQgOyBqPGlFbmQgOyBqKysgKQoJCQkJewoJCQkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhWyBvU2V0dGluZ3MuYWlEaXNwbGF5W2pdIF07CgkJCQkJaWYgKCBhb0RhdGEublRyID09PSBudWxsICkKCQkJCQl7CgkJCQkJCV9mbkNyZWF0ZVRyKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5haURpc3BsYXlbal0gKTsKCQkJCQl9CgkJCgkJCQkJdmFyIG5Sb3cgPSBhb0RhdGEublRyOwoJCQkJCQoJCQkJCS8qIFJlbW92ZSB0aGUgb2xkIHN0cmlwaW5nIGNsYXNzZXMgYW5kIHRoZW4gYWRkIHRoZSBuZXcgb25lICovCgkJCQkJaWYgKCBpU3RyaXBlcyAhPT0gMCApCgkJCQkJewoJCQkJCQl2YXIgc1N0cmlwZSA9IG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbIGlSb3dDb3VudCAlIGlTdHJpcGVzIF07CgkJCQkJCWlmICggYW9EYXRhLl9zUm93U3RyaXBlICE9IHNTdHJpcGUgKQoJCQkJCQl7CgkJCQkJCQkkKG5Sb3cpLnJlbW92ZUNsYXNzKCBhb0RhdGEuX3NSb3dTdHJpcGUgKS5hZGRDbGFzcyggc1N0cmlwZSApOwoJCQkJCQkJYW9EYXRhLl9zUm93U3RyaXBlID0gc1N0cmlwZTsKCQkJCQkJfQoJCQkJCX0KCQkJCQkKCQkJCQkvKiBSb3cgY2FsbGJhY2sgZnVuY3Rpb25zIC0gbWlnaHQgd2FudCB0byBtYW5pcHVsZSB0aGUgcm93ICovCgkJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NhbGxiYWNrJywgbnVsbCwgCgkJCQkJCVtuUm93LCBvU2V0dGluZ3MuYW9EYXRhWyBvU2V0dGluZ3MuYWlEaXNwbGF5W2pdIF0uX2FEYXRhLCBpUm93Q291bnQsIGpdICk7CgkJCQkJCgkJCQkJYW5Sb3dzLnB1c2goIG5Sb3cgKTsKCQkJCQlpUm93Q291bnQrKzsKCQkJCQkKCQkJCQkvKiBJZiB0aGVyZSBpcyBhbiBvcGVuIHJvdyAtIGFuZCBpdCBpcyBhdHRhY2hlZCB0byB0aGlzIHBhcmVudCAtIGF0dGFjaCBpdCBvbiByZWRyYXcgKi8KCQkJCQlpZiAoIGlPcGVuUm93cyAhPT0gMCApCgkJCQkJewoJCQkJCQlmb3IgKCB2YXIgaz0wIDsgazxpT3BlblJvd3MgOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG5Sb3cgPT0gb1NldHRpbmdzLmFvT3BlblJvd3Nba10ublBhcmVudCApCgkJCQkJCQl7CgkJCQkJCQkJYW5Sb3dzLnB1c2goIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2tdLm5UciApOwoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogVGFibGUgaXMgZW1wdHkgLSBjcmVhdGUgYSByb3cgd2l0aCBhbiBlbXB0eSBtZXNzYWdlIGluIGl0ICovCgkJCQlhblJvd3NbIDAgXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0cicgKTsKCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWzBdICkKCQkJCXsKCQkJCQlhblJvd3NbIDAgXS5jbGFzc05hbWUgPSBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWzBdOwoJCQkJfQoJCQoJCQkJdmFyIHNaZXJvID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zWmVyb1JlY29yZHMucmVwbGFjZSgKCQkJCQknX01BWF8nLCBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIob1NldHRpbmdzLmZuUmVjb3Jkc1RvdGFsKCkpICk7CgkJCQlpZiAoIG9TZXR0aW5ncy5pRHJhdyA9PSAxICYmIG9TZXR0aW5ncy5zQWpheFNvdXJjZSAhPT0gbnVsbCAmJiAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJc1plcm8gPSBvU2V0dGluZ3Mub0xhbmd1YWdlLnNMb2FkaW5nUmVjb3JkczsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0xhbmd1YWdlLnNFbXB0eVRhYmxlICYmIG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpID09PSAwICkKCQkJCXsKCQkJCQlzWmVybyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0VtcHR5VGFibGU7CgkJCQl9CgkJCgkJCQl2YXIgblRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RkJyApOwoJCQkJblRkLnNldEF0dHJpYnV0ZSggJ3ZhbGlnbicsICJ0b3AiICk7CgkJCQluVGQuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQkJblRkLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUm93RW1wdHk7CgkJCQluVGQuaW5uZXJIVE1MID0gc1plcm87CgkJCQkKCQkJCWFuUm93c1sgaVJvd0NvdW50IF0uYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQl9CgkJCQoJCQkvKiBIZWFkZXIgYW5kIGZvb3RlciBjYWxsYmFja3MgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0hlYWRlckNhbGxiYWNrJywgJ2hlYWRlcicsIFsgJChvU2V0dGluZ3MublRIZWFkKS5jaGlsZHJlbigndHInKVswXSwgCgkJCQlfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKSwgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksIG9TZXR0aW5ncy5haURpc3BsYXkgXSApOwoJCQkKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0Zvb3RlckNhbGxiYWNrJywgJ2Zvb3RlcicsIFsgJChvU2V0dGluZ3MublRGb290KS5jaGlsZHJlbigndHInKVswXSwgCgkJCQlfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKSwgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksIG9TZXR0aW5ncy5haURpc3BsYXkgXSApOwoJCQkKCQkJLyogCgkJCSAqIE5lZWQgdG8gcmVtb3ZlIGFueSBvbGQgcm93IGZyb20gdGhlIGRpc3BsYXkgLSBub3RlIHdlIGNhbid0IGp1c3QgZW1wdHkgdGhlIHRib2R5IHVzaW5nCgkJCSAqICQoKS5odG1sKCcnKSBzaW5jZSB0aGlzIHdpbGwgdW5iaW5kIHRoZSBqUXVlcnkgZXZlbnQgaGFuZGxlcnMgKGV2ZW4gYWx0aG91Z2ggdGhlIG5vZGUgCgkJCSAqIHN0aWxsIGV4aXN0cyEpIC0gZXF1YWxseSB3ZSBjYW4ndCB1c2UgaW5uZXJIVE1MLCBzaW5jZSBJRSB0aHJvd3MgYW4gZXhjZXB0aW9uLgoJCQkgKi8KCQkJdmFyCgkJCQluQWRkRnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKCQkJCW5SZW1vdmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAoJCQkJbkJvZHlQYXIsIG5UcnM7CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5uVEJvZHkgKQoJCQl7CgkJCQluQm9keVBhciA9IG9TZXR0aW5ncy5uVEJvZHkucGFyZW50Tm9kZTsKCQkJCW5SZW1vdmVGcmFnLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRCb2R5ICk7CgkJCQkKCQkJCS8qIFdoZW4gZG9pbmcgaW5maW5pdGUgc2Nyb2xsaW5nLCBvbmx5IHJlbW92ZSBjaGlsZCByb3dzIHdoZW4gc29ydGluZywgZmlsdGVyaW5nIG9yIHN0YXJ0CgkJCQkgKiB1cC4gV2hlbiBub3QgaW5maW5pdGUgc2Nyb2xsLCBhbHdheXMgZG8gaXQuCgkJCQkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSB8fCAhb1NldHRpbmdzLl9iSW5pdENvbXBsZXRlIHx8CgkJCQkgCW9TZXR0aW5ncy5iU29ydGVkIHx8IG9TZXR0aW5ncy5iRmlsdGVyZWQgKQoJCQkJewoJCQkJCXdoaWxlKCAobiA9IG9TZXR0aW5ncy5uVEJvZHkuZmlyc3RDaGlsZCkgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLm5UQm9keS5yZW1vdmVDaGlsZCggbiApOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogUHV0IHRoZSBkcmF3IHRhYmxlIGludG8gdGhlIGRvbSAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuUm93cy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5BZGRGcmFnLmFwcGVuZENoaWxkKCBhblJvd3NbaV0gKTsKCQkJCX0KCQkJCQoJCQkJb1NldHRpbmdzLm5UQm9keS5hcHBlbmRDaGlsZCggbkFkZEZyYWcgKTsKCQkJCWlmICggbkJvZHlQYXIgIT09IG51bGwgKQoJCQkJewoJCQkJCW5Cb2R5UGFyLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRCb2R5ICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIENhbGwgYWxsIHJlcXVpcmVkIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgdGhlIGVuZCBvZiBhIGRyYXcgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICdkcmF3JywgW29TZXR0aW5nc10gKTsKCQkJCgkJCS8qIERyYXcgaXMgY29tcGxldGUsIHNvcnRpbmcgYW5kIGZpbHRlcmluZyBtdXN0IGJlIGFzIHdlbGwgKi8KCQkJb1NldHRpbmdzLmJTb3J0ZWQgPSBmYWxzZTsKCQkJb1NldHRpbmdzLmJGaWx0ZXJlZCA9IGZhbHNlOwoJCQlvU2V0dGluZ3MuYkRyYXdpbmcgPSBmYWxzZTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlpZiAoICFvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgKQoJCQkJewoJCQkJCV9mbkluaXRDb21wbGV0ZSggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogUmVkcmF3IHRoZSB0YWJsZSAtIHRha2luZyBhY2NvdW50IG9mIHRoZSB2YXJpb3VzIGZlYXR1cmVzIHdoaWNoIGFyZSBlbmFibGVkCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJLyogU29ydGluZyB3aWxsIHJlZmlsdGVyIGFuZCBkcmF3IGZvciB1cyAqLwoJCQkJX2ZuU29ydCggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCXsKCQkJCS8qIEZpbHRlcmluZyB3aWxsIHJlZHJhdyBmb3IgdXMgKi8KCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2ggKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGQgdGhlIG9wdGlvbnMgdG8gdGhlIHBhZ2UgSFRNTCBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWRkT3B0aW9uc0h0bWwgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyoKCQkJICogQ3JlYXRlIGEgdGVtcG9yYXJ5LCBlbXB0eSwgZGl2IHdoaWNoIHdlIGNhbiBsYXRlciBvbiByZXBsYWNlIHdpdGggd2hhdCB3ZSBoYXZlIGdlbmVyYXRlZAoJCQkgKiB3ZSBkbyBpdCB0aGlzIHdheSB0byByZW5kZXJpbmcgdGhlICdvcHRpb25zJyBodG1sIG9mZmxpbmUgLSBzcGVlZCA6LSkKCQkJICovCgkJCXZhciBuSG9sZGluZyA9ICQoJzxkaXY+PC9kaXY+JylbMF07CgkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIG5Ib2xkaW5nLCBvU2V0dGluZ3MublRhYmxlICk7CgkJCQoJCQkvKiAKCQkJICogQWxsIERhdGFUYWJsZXMgYXJlIHdyYXBwZWQgaW4gYSBkaXYKCQkJICovCgkJCW9TZXR0aW5ncy5uVGFibGVXcmFwcGVyID0gJCgnPGRpdiBpZD0iJytvU2V0dGluZ3Muc1RhYmxlSWQrJ193cmFwcGVyIiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1dyYXBwZXIrJyIgcm9sZT0iZ3JpZCI+PC9kaXY+JylbMF07CgkJCW9TZXR0aW5ncy5uVGFibGVSZWluc2VydEJlZm9yZSA9IG9TZXR0aW5ncy5uVGFibGUubmV4dFNpYmxpbmc7CgkJCgkJCS8qIFRyYWNrIHdoZXJlIHdlIHdhbnQgdG8gaW5zZXJ0IHRoZSBvcHRpb24gKi8KCQkJdmFyIG5JbnNlcnROb2RlID0gb1NldHRpbmdzLm5UYWJsZVdyYXBwZXI7CgkJCQoJCQkvKiBMb29wIG92ZXIgdGhlIHVzZXIgc2V0IHBvc2l0aW9uaW5nIGFuZCBwbGFjZSB0aGUgZWxlbWVudHMgYXMgbmVlZGVkICovCgkJCXZhciBhRG9tID0gb1NldHRpbmdzLnNEb20uc3BsaXQoJycpOwoJCQl2YXIgblRtcCwgaVB1c2hGZWF0dXJlLCBjT3B0aW9uLCBuTmV3Tm9kZSwgY05leHQsIHNBdHRyLCBqOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxhRG9tLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlQdXNoRmVhdHVyZSA9IDA7CgkJCQljT3B0aW9uID0gYURvbVtpXTsKCQkJCQoJCQkJaWYgKCBjT3B0aW9uID09ICc8JyApCgkJCQl7CgkJCQkJLyogTmV3IGNvbnRhaW5lciBkaXYgKi8KCQkJCQluTmV3Tm9kZSA9ICQoJzxkaXY+PC9kaXY+JylbMF07CgkJCQkJCgkJCQkJLyogQ2hlY2sgdG8gc2VlIGlmIHdlIHNob3VsZCBhcHBlbmQgYW4gaWQgYW5kL29yIGEgY2xhc3MgbmFtZSB0byB0aGUgY29udGFpbmVyICovCgkJCQkJY05leHQgPSBhRG9tW2krMV07CgkJCQkJaWYgKCBjTmV4dCA9PSAiJyIgfHwgY05leHQgPT0gJyInICkKCQkJCQl7CgkJCQkJCXNBdHRyID0gIiI7CgkJCQkJCWogPSAyOwoJCQkJCQl3aGlsZSAoIGFEb21baStqXSAhPSBjTmV4dCApCgkJCQkJCXsKCQkJCQkJCXNBdHRyICs9IGFEb21baStqXTsKCQkJCQkJCWorKzsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogUmVwbGFjZSBqUXVlcnkgVUkgY29uc3RhbnRzICovCgkJCQkJCWlmICggc0F0dHIgPT0gIkgiICkKCQkJCQkJewoJCQkJCQkJc0F0dHIgPSAiZmctdG9vbGJhciB1aS10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLXRsIHVpLWNvcm5lci10ciB1aS1oZWxwZXItY2xlYXJmaXgiOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBzQXR0ciA9PSAiRiIgKQoJCQkJCQl7CgkJCQkJCQlzQXR0ciA9ICJmZy10b29sYmFyIHVpLXRvb2xiYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYmwgdWktY29ybmVyLWJyIHVpLWhlbHBlci1jbGVhcmZpeCI7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIFRoZSBhdHRyaWJ1dGUgY2FuIGJlIGluIHRoZSBmb3JtYXQgb2YgIiNpZC5jbGFzcyIsICIjaWQiIG9yICJjbGFzcyIgVGhpcyBsb2dpYwoJCQkJCQkgKiBicmVha3MgdGhlIHN0cmluZyBpbnRvIHBhcnRzIGFuZCBhcHBsaWVzIHRoZW0gYXMgbmVlZGVkCgkJCQkJCSAqLwoJCQkJCQlpZiAoIHNBdHRyLmluZGV4T2YoJy4nKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCXZhciBhU3BsaXQgPSBzQXR0ci5zcGxpdCgnLicpOwoJCQkJCQkJbk5ld05vZGUuaWQgPSBhU3BsaXRbMF0uc3Vic3RyKDEsIGFTcGxpdFswXS5sZW5ndGgtMSk7CgkJCQkJCQluTmV3Tm9kZS5jbGFzc05hbWUgPSBhU3BsaXRbMV07CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHNBdHRyLmNoYXJBdCgwKSA9PSAiIyIgKQoJCQkJCQl7CgkJCQkJCQluTmV3Tm9kZS5pZCA9IHNBdHRyLnN1YnN0cigxLCBzQXR0ci5sZW5ndGgtMSk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQluTmV3Tm9kZS5jbGFzc05hbWUgPSBzQXR0cjsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJaSArPSBqOyAvKiBNb3ZlIGFsb25nIHRoZSBwb3NpdGlvbiBhcnJheSAqLwoJCQkJCX0KCQkJCQkKCQkJCQluSW5zZXJ0Tm9kZS5hcHBlbmRDaGlsZCggbk5ld05vZGUgKTsKCQkJCQluSW5zZXJ0Tm9kZSA9IG5OZXdOb2RlOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJz4nICkKCQkJCXsKCQkJCQkvKiBFbmQgY29udGFpbmVyIGRpdiAqLwoJCQkJCW5JbnNlcnROb2RlID0gbkluc2VydE5vZGUucGFyZW50Tm9kZTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdsJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJMZW5ndGhDaGFuZ2UgKQoJCQkJewoJCQkJCS8qIExlbmd0aCAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbExlbmd0aCggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdmJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQkJewoJCQkJCS8qIEZpbHRlciAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbEZpbHRlciggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdyJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQcm9jZXNzaW5nICkKCQkJCXsKCQkJCQkvKiBwUm9jZXNzaW5nICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICd0JyApCgkJCQl7CgkJCQkJLyogVGFibGUgKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxUYWJsZSggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICAnaScgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iSW5mbyApCgkJCQl7CgkJCQkJLyogSW5mbyAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbEluZm8oIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAncCcgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgKQoJCQkJewoJCQkJCS8qIFBhZ2luYXRpb24gKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBEYXRhVGFibGUuZXh0LmFvRmVhdHVyZXMubGVuZ3RoICE9PSAwICkKCQkJCXsKCQkJCQkvKiBQbHVnLWluIGZlYXR1cmVzICovCgkJCQkJdmFyIGFvRmVhdHVyZXMgPSBEYXRhVGFibGUuZXh0LmFvRmVhdHVyZXM7CgkJCQkJZm9yICggdmFyIGs9MCwga0xlbj1hb0ZlYXR1cmVzLmxlbmd0aCA7IGs8a0xlbiA7IGsrKyApCgkJCQkJewoJCQkJCQlpZiAoIGNPcHRpb24gPT0gYW9GZWF0dXJlc1trXS5jRmVhdHVyZSApCgkJCQkJCXsKCQkJCQkJCW5UbXAgPSBhb0ZlYXR1cmVzW2tdLmZuSW5pdCggb1NldHRpbmdzICk7CgkJCQkJCQlpZiAoIG5UbXAgKQoJCQkJCQkJewoJCQkJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQWRkIHRvIHRoZSAyRCBmZWF0dXJlcyBhcnJheSAqLwoJCQkJaWYgKCBpUHVzaEZlYXR1cmUgPT0gMSAmJiBuVG1wICE9PSBudWxsICkKCQkJCXsKCQkJCQlpZiAoIHR5cGVvZiBvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0gIT09ICdvYmplY3QnICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hYW5GZWF0dXJlc1tjT3B0aW9uXSA9IFtdOwoJCQkJCX0KCQkJCQlvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0ucHVzaCggblRtcCApOwoJCQkJCW5JbnNlcnROb2RlLmFwcGVuZENoaWxkKCBuVG1wICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEJ1aWx0IG91ciBET00gc3RydWN0dXJlIC0gcmVwbGFjZSB0aGUgaG9sZGluZyBkaXYgd2l0aCB3aGF0IHdlIHdhbnQgKi8KCQkJbkhvbGRpbmcucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoIG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyLCBuSG9sZGluZyApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVc2UgdGhlIERPTSBzb3VyY2UgdG8gY3JlYXRlIHVwIGFuIGFycmF5IG9mIGhlYWRlciBjZWxscy4gVGhlIGlkZWEgaGVyZSBpcyB0bwoJCSAqIGNyZWF0ZSBhIGxheW91dCBncmlkIChhcnJheSkgb2Ygcm93cyB4IGNvbHVtbnMsIHdoaWNoIGNvbnRhaW5zIGEgcmVmZXJlbmNlCgkJICogdG8gdGhlIGNlbGwgdGhhdCB0aGF0IHBvaW50IGluIHRoZSBncmlkIChyZWdhcmRsZXNzIG9mIGNvbC9yb3dzcGFuKSwgc3VjaCB0aGF0CgkJICogYW55IGNvbHVtbiAvIHJvdyBjb3VsZCBiZSByZW1vdmVkIGFuZCB0aGUgbmV3IGdyaWQgY29uc3RydWN0ZWQKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3R9IGFMYXlvdXQgQXJyYXkgdG8gc3RvcmUgdGhlIGNhbGN1bGF0ZWQgbGF5b3V0IGluCgkJICogIEBwYXJhbSB7bm9kZX0gblRoZWFkIFRoZSBoZWFkZXIvZm9vdGVyIGVsZW1lbnQgZm9yIHRoZSB0YWJsZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EZXRlY3RIZWFkZXIgKCBhTGF5b3V0LCBuVGhlYWQgKQoJCXsKCQkJdmFyIG5UcnMgPSAkKG5UaGVhZCkuY2hpbGRyZW4oJ3RyJyk7CgkJCXZhciBuQ2VsbDsKCQkJdmFyIGksIGosIGssIGwsIGlMZW4sIGpMZW4sIGlDb2xTaGlmdGVkOwoJCQl2YXIgZm5TaGlmdENvbCA9IGZ1bmN0aW9uICggYSwgaSwgaiApIHsKCQkJCXdoaWxlICggYVtpXVtqXSApIHsKCQkJCQlqKys7CgkJCQl9CgkJCQlyZXR1cm4gajsKCQkJfTsKCQkKCQkJYUxheW91dC5zcGxpY2UoIDAsIGFMYXlvdXQubGVuZ3RoICk7CgkJCQoJCQkvKiBXZSBrbm93IGhvdyBtYW55IHJvd3MgdGhlcmUgYXJlIGluIHRoZSBsYXlvdXQgLSBzbyBwcmVwIGl0ICovCgkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWFMYXlvdXQucHVzaCggW10gKTsKCQkJfQoJCQkKCQkJLyogQ2FsY3VsYXRlIGEgbGF5b3V0IGFycmF5ICovCgkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXZhciBpQ29sdW1uID0gMDsKCQkJCQoJCQkJLyogRm9yIGV2ZXJ5IGNlbGwgaW4gdGhlIHJvdy4uLiAqLwoJCQkJZm9yICggaj0wLCBqTGVuPW5UcnNbaV0uY2hpbGROb2Rlcy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCW5DZWxsID0gblRyc1tpXS5jaGlsZE5vZGVzW2pdOwoJCQoJCQkJCWlmICggbkNlbGwubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVEQiIHx8CgkJCQkJICAgICBuQ2VsbC5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09ICJUSCIgKQoJCQkJCXsKCQkJCQkJLyogR2V0IHRoZSBjb2wgYW5kIHJvd3NwYW4gYXR0cmlidXRlcyBmcm9tIHRoZSBET00gYW5kIHNhbml0aXNlIHRoZW0gKi8KCQkJCQkJdmFyIGlDb2xzcGFuID0gbkNlbGwuZ2V0QXR0cmlidXRlKCdjb2xzcGFuJykgKiAxOwoJCQkJCQl2YXIgaVJvd3NwYW4gPSBuQ2VsbC5nZXRBdHRyaWJ1dGUoJ3Jvd3NwYW4nKSAqIDE7CgkJCQkJCWlDb2xzcGFuID0gKCFpQ29sc3BhbiB8fCBpQ29sc3Bhbj09PTAgfHwgaUNvbHNwYW49PT0xKSA/IDEgOiBpQ29sc3BhbjsKCQkJCQkJaVJvd3NwYW4gPSAoIWlSb3dzcGFuIHx8IGlSb3dzcGFuPT09MCB8fCBpUm93c3Bhbj09PTEpID8gMSA6IGlSb3dzcGFuOwoJCQoJCQkJCQkvKiBUaGVyZSBtaWdodCBiZSBjb2xzcGFuIGNlbGxzIGFscmVhZHkgaW4gdGhpcyByb3csIHNvIHNoaWZ0IG91ciB0YXJnZXQgCgkJCQkJCSAqIGFjY29yZGluZ2x5CgkJCQkJCSAqLwoJCQkJCQlpQ29sU2hpZnRlZCA9IGZuU2hpZnRDb2woIGFMYXlvdXQsIGksIGlDb2x1bW4gKTsKCQkJCQkJCgkJCQkJCS8qIElmIHRoZXJlIGlzIGNvbCAvIHJvd3NwYW4sIGNvcHkgdGhlIGluZm9ybWF0aW9uIGludG8gdGhlIGxheW91dCBncmlkICovCgkJCQkJCWZvciAoIGw9MCA7IGw8aUNvbHNwYW4gOyBsKysgKQoJCQkJCQl7CgkJCQkJCQlmb3IgKCBrPTAgOyBrPGlSb3dzcGFuIDsgaysrICkKCQkJCQkJCXsKCQkJCQkJCQlhTGF5b3V0W2kra11baUNvbFNoaWZ0ZWQrbF0gPSB7CgkJCQkJCQkJCSJjZWxsIjogbkNlbGwsCgkJCQkJCQkJCSJ1bmlxdWUiOiBpQ29sc3BhbiA9PSAxID8gdHJ1ZSA6IGZhbHNlCgkJCQkJCQkJfTsKCQkJCQkJCQlhTGF5b3V0W2kra10ublRyID0gblRyc1tpXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgdW5pcXVlIHRoIGVsZW1lbnRzLCBvbmUgZm9yIGVhY2ggY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZGVyIGF1dG9tYXRpY2FsbHkgZGV0ZWN0IHRoZSBsYXlvdXQgZnJvbSB0aGlzIG5vZGUgLSBvcHRpb25hbAoJCSAqICBAcGFyYW0ge2FycmF5fSBhTGF5b3V0IHRoZWFkL3Rmb290IGxheW91dCBmcm9tIF9mbkRldGVjdEhlYWRlciAtIG9wdGlvbmFsCgkJICogIEByZXR1cm5zIGFycmF5IHtub2RlfSBhUmV0dXJuIGxpc3Qgb2YgdW5pcXVlIHRocwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRVbmlxdWVUaHMgKCBvU2V0dGluZ3MsIG5IZWFkZXIsIGFMYXlvdXQgKQoJCXsKCQkJdmFyIGFSZXR1cm4gPSBbXTsKCQkJaWYgKCAhYUxheW91dCApCgkJCXsKCQkJCWFMYXlvdXQgPSBvU2V0dGluZ3MuYW9IZWFkZXI7CgkJCQlpZiAoIG5IZWFkZXIgKQoJCQkJewoJCQkJCWFMYXlvdXQgPSBbXTsKCQkJCQlfZm5EZXRlY3RIZWFkZXIoIGFMYXlvdXQsIG5IZWFkZXIgKTsKCQkJCX0KCQkJfQoJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFMYXlvdXQubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1hTGF5b3V0W2ldLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBhTGF5b3V0W2ldW2pdLnVuaXF1ZSAmJiAKCQkJCQkJICghYVJldHVybltqXSB8fCAhb1NldHRpbmdzLmJTb3J0Q2VsbHNUb3ApICkKCQkJCQl7CgkJCQkJCWFSZXR1cm5bal0gPSBhTGF5b3V0W2ldW2pdLmNlbGw7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gYVJldHVybjsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIHRoZSB0YWJsZSB1c2luZyBhbiBBamF4IGNhbGwKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gQmxvY2sgdGhlIHRhYmxlIGRyYXdpbmcgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFqYXhVcGRhdGUoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5iQWpheERhdGFHZXQgKQoJCQl7CgkJCQlvU2V0dGluZ3MuaURyYXcrKzsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQkJdmFyIGFvRGF0YSA9IF9mbkFqYXhQYXJhbWV0ZXJzKCBvU2V0dGluZ3MgKTsKCQkJCV9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKTsKCQkJCQoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwKCQkJCQlmdW5jdGlvbihqc29uKSB7CgkJCQkJCV9mbkFqYXhVcGRhdGVEcmF3KCBvU2V0dGluZ3MsIGpzb24gKTsKCQkJCQl9LCBvU2V0dGluZ3MgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEJ1aWxkIHVwIHRoZSBwYXJhbWV0ZXJzIGluIGFuIG9iamVjdCBuZWVkZWQgZm9yIGEgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyByZXF1ZXN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2Jvb2x9IGJsb2NrIHRoZSB0YWJsZSBkcmF3aW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BamF4UGFyYW1ldGVycyggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgYW9EYXRhID0gW10sIG1EYXRhUHJvcDsKCQkJdmFyIGk7CgkJCQoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzRWNobyIsICAgICAgICAgICJ2YWx1ZSI6IG9TZXR0aW5ncy5pRHJhdyB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlDb2x1bW5zIiwgICAgICAgInZhbHVlIjogaUNvbHVtbnMgfSApOwoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzQ29sdW1ucyIsICAgICAgICJ2YWx1ZSI6IF9mbkNvbHVtbk9yZGVyaW5nKG9TZXR0aW5ncykgfSApOwoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpRGlzcGxheVN0YXJ0IiwgICJ2YWx1ZSI6IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlEaXNwbGF5TGVuZ3RoIiwgInZhbHVlIjogb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgIT09IGZhbHNlID8KCQkJCW9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggOiAtMSB9ICk7CgkJCQkKCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCXsKCQkJICBtRGF0YVByb3AgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm1EYXRhUHJvcDsKCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogIm1EYXRhUHJvcF8iK2ksICJ2YWx1ZSI6IHR5cGVvZihtRGF0YVByb3ApPT09ImZ1bmN0aW9uIiA/ICdmdW5jdGlvbicgOiBtRGF0YVByb3AgfSApOwoJCQl9CgkJCQoJCQkvKiBGaWx0ZXJpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgIT09IGZhbHNlICkKCQkJewoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NlYXJjaCIsICJ2YWx1ZSI6IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2guc1NlYXJjaCB9ICk7CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiUmVnZXgiLCAgInZhbHVlIjogb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaC5iUmVnZXggfSApOwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCQl7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NlYXJjaF8iK2ksICAgICAidmFsdWUiOiBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzW2ldLnNTZWFyY2ggfSApOwoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJSZWdleF8iK2ksICAgICAgInZhbHVlIjogb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1tpXS5iUmVnZXggfSApOwoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJTZWFyY2hhYmxlXyIraSwgInZhbHVlIjogb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU2VhcmNoYWJsZSB9ICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFNvcnRpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICE9PSBmYWxzZSApCgkJCXsKCQkJCXZhciBpRml4ZWQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwgPyBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQubGVuZ3RoIDogMDsKCQkJCXZhciBpVXNlciA9IG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoOwoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaVNvcnRpbmdDb2xzIiwgICAidmFsdWUiOiBpRml4ZWQraVVzZXIgfSApOwoJCQkJZm9yICggaT0wIDsgaTxpRml4ZWQgOyBpKysgKQoJCQkJewoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlTb3J0Q29sXyIraSwgICJ2YWx1ZSI6IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZFtpXVswXSB9ICk7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NvcnREaXJfIitpLCAgInZhbHVlIjogb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkW2ldWzFdIH0gKTsKCQkJCX0KCQkJCQoJCQkJZm9yICggaT0wIDsgaTxpVXNlciA7IGkrKyApCgkJCQl7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaVNvcnRDb2xfIisoaStpRml4ZWQpLCAgInZhbHVlIjogb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSB9ICk7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NvcnREaXJfIisoaStpRml4ZWQpLCAgInZhbHVlIjogb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSB9ICk7CgkJCQl9CgkJCQkKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJewoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJTb3J0YWJsZV8iK2ksICAidmFsdWUiOiBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSB9ICk7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBhb0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBBamF4IHBhcmFtZXRlcnMgZnJvbSBwbHVnaW5zCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3RzfSBhb0RhdGEgbmFtZS92YWx1ZSBwYWlycyB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApCgkJewoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU2VydmVyUGFyYW1zJywgJ3NlcnZlclBhcmFtcycsIFthb0RhdGFdICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERhdGEgdGhlIGRhdGEgZnJvbSB0aGUgc2VydmVyIChudWtpbmcgdGhlIG9sZCkgYW5kIHJlZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBqc29uIGRhdGEgcmV0dXJuIGZyb20gdGhlIHNlcnZlci4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IGpzb24uc0VjaG8gVHJhY2tpbmcgZmxhZyBmb3IgRGF0YVRhYmxlcyB0byBtYXRjaCByZXF1ZXN0cwoJCSAqICBAcGFyYW0ge2ludH0ganNvbi5pVG90YWxSZWNvcmRzIE51bWJlciBvZiByZWNvcmRzIGluIHRoZSBkYXRhIHNldCwgbm90IGFjY291bnRpbmcgZm9yIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge2ludH0ganNvbi5pVG90YWxEaXNwbGF5UmVjb3JkcyBOdW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgZGF0YSBzZXQsIGFjY291bnRpbmcgZm9yIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge2FycmF5fSBqc29uLmFhRGF0YSBUaGUgZGF0YSB0byBkaXNwbGF5IG9uIHRoaXMgcGFnZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gW2pzb24uc0NvbHVtbnNdIENvbHVtbiBvcmRlcmluZyAoc05hbWUsIGNvbW1hIHNlcGFyYXRlZCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWpheFVwZGF0ZURyYXcgKCBvU2V0dGluZ3MsIGpzb24gKQoJCXsKCQkJaWYgKCBqc29uLnNFY2hvICE9PSB1bmRlZmluZWQgKQoJCQl7CgkJCQkvKiBQcm90ZWN0IGFnYWluc3Qgb2xkIHJldHVybnMgb3Zlci13cml0aW5nIGEgbmV3IG9uZS4gUG9zc2libGUgd2hlbiB5b3UgZ2V0CgkJCQkgKiB2ZXJ5IGZhc3QgaW50ZXJhY3Rpb24sIGFuZCBsYXRlciBxdWVpcmVzIGFyZSBjb21wbGV0ZWQgbXVjaCBmYXN0ZXIKCQkJCSAqLwoJCQkJaWYgKCBqc29uLnNFY2hvKjEgPCBvU2V0dGluZ3MuaURyYXcgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuaURyYXcgPSBqc29uLnNFY2hvICogMTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlIHx8CgkJCQkgICAob1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlICYmIChvU2V0dGluZ3MuYlNvcnRlZCB8fCBvU2V0dGluZ3MuYkZpbHRlcmVkKSkgKQoJCQl7CgkJCQlfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlvU2V0dGluZ3MuX2lSZWNvcmRzVG90YWwgPSBwYXJzZUludChqc29uLmlUb3RhbFJlY29yZHMsIDEwKTsKCQkJb1NldHRpbmdzLl9pUmVjb3Jkc0Rpc3BsYXkgPSBwYXJzZUludChqc29uLmlUb3RhbERpc3BsYXlSZWNvcmRzLCAxMCk7CgkJCQoJCQkvKiBEZXRlcm1pbmUgaWYgcmVvcmRlcmluZyBpcyByZXF1aXJlZCAqLwoJCQl2YXIgc09yZGVyaW5nID0gX2ZuQ29sdW1uT3JkZXJpbmcob1NldHRpbmdzKTsKCQkJdmFyIGJSZU9yZGVyID0gKGpzb24uc0NvbHVtbnMgIT09IHVuZGVmaW5lZCAmJiBzT3JkZXJpbmcgIT09ICIiICYmIGpzb24uc0NvbHVtbnMgIT0gc09yZGVyaW5nICk7CgkJCXZhciBhaUluZGV4OwoJCQlpZiAoIGJSZU9yZGVyICkKCQkJewoJCQkJYWlJbmRleCA9IF9mblJlT3JkZXJJbmRleCggb1NldHRpbmdzLCBqc29uLnNDb2x1bW5zICk7CgkJCX0KCQkJCgkJCXZhciBhRGF0YSA9IF9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKSgganNvbiApOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFEYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYlJlT3JkZXIgKQoJCQkJewoJCQkJCS8qIElmIHdlIG5lZWQgdG8gcmUtb3JkZXIsIHRoZW4gY3JlYXRlIGEgbmV3IGFycmF5IHdpdGggdGhlIGNvcnJlY3Qgb3JkZXIgYW5kIGFkZCBpdCAqLwoJCQkJCXZhciBhRGF0YVNvcnRlZCA9IFtdOwoJCQkJCWZvciAoIHZhciBqPTAsIGpMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCXsKCQkJCQkJYURhdGFTb3J0ZWQucHVzaCggYURhdGFbaV1bIGFpSW5kZXhbal0gXSApOwoJCQkJCX0KCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhU29ydGVkICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJLyogTm8gcmUtb3JkZXIgcmVxdWlyZWQsIHNldmVyIGdvdCBpdCAicmlnaHQiIC0ganVzdCBzdHJhaWdodCBhZGQgKi8KCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhW2ldICk7CgkJCQl9CgkJCX0KCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCgkJCW9TZXR0aW5ncy5iQWpheERhdGFHZXQgPSBmYWxzZTsKCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCW9TZXR0aW5ncy5iQWpheERhdGFHZXQgPSB0cnVlOwoJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgZmlsdGVyaW5nIHRleHQKCQkgKiAgQHJldHVybnMge25vZGV9IEZpbHRlciBjb250cm9sIGVsZW1lbnQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbEZpbHRlciAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgb1ByZXZpb3VzU2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCXZhciBzU2VhcmNoU3RyID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zU2VhcmNoOwoJCQlzU2VhcmNoU3RyID0gKHNTZWFyY2hTdHIuaW5kZXhPZignX0lOUFVUXycpICE9PSAtMSkgPwoJCQkgIHNTZWFyY2hTdHIucmVwbGFjZSgnX0lOUFVUXycsICc8aW5wdXQgdHlwZT0idGV4dCIgLz4nKSA6CgkJCSAgc1NlYXJjaFN0cj09PSIiID8gJzxpbnB1dCB0eXBlPSJ0ZXh0IiAvPicgOiBzU2VhcmNoU3RyKycgPGlucHV0IHR5cGU9InRleHQiIC8+JzsKCQkJCgkJCXZhciBuRmlsdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJbkZpbHRlci5jbGFzc05hbWUgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0ZpbHRlcjsKCQkJbkZpbHRlci5pbm5lckhUTUwgPSAnPGxhYmVsPicrc1NlYXJjaFN0cisnPC9sYWJlbD4nOwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuZiApCgkJCXsKCQkJCW5GaWx0ZXIuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19maWx0ZXInOwoJCQl9CgkJCQoJCQl2YXIganFGaWx0ZXIgPSAkKCJpbnB1dCIsIG5GaWx0ZXIpOwoJCQlqcUZpbHRlci52YWwoIG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoLnJlcGxhY2UoJyInLCcmcXVvdDsnKSApOwoJCQlqcUZpbHRlci5iaW5kKCAna2V5dXAuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGZpbHRlciBpbnB1dCBlbGVtZW50cyBmb3IgdGhlIG5ldyBkaXNwbGF5ICovCgkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBuW2ldICE9ICQodGhpcykucGFyZW50cygnZGl2LmRhdGFUYWJsZXNfZmlsdGVyJylbMF0gKQoJCQkJCXsKCQkJCQkJJCgnaW5wdXQnLCBuW2ldKS52YWwoIHRoaXMudmFsdWUgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIE5vdyBkbyB0aGUgZmlsdGVyICovCgkJCQlpZiAoIHRoaXMudmFsdWUgIT0gb1ByZXZpb3VzU2VhcmNoLnNTZWFyY2ggKQoJCQkJewoJCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIHsgCgkJCQkJCSJzU2VhcmNoIjogdGhpcy52YWx1ZSwgCgkJCQkJCSJiUmVnZXgiOiBvUHJldmlvdXNTZWFyY2guYlJlZ2V4LAoJCQkJCQkiYlNtYXJ0Ijogb1ByZXZpb3VzU2VhcmNoLmJTbWFydCAsCgkJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogb1ByZXZpb3VzU2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgCgkJCQkJfSApOwoJCQkJfQoJCQl9ICk7CgkJCgkJCWpxRmlsdGVyCgkJCQkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkJLyogUHJldmVudCBmb3JtIHN1Ym1pc3Npb24gKi8KCQkJCQlpZiAoIGUua2V5Q29kZSA9PSAxMyApCgkJCQkJewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQkpOwoJCQkKCQkJcmV0dXJuIG5GaWx0ZXI7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgdGFibGUgdXNpbmcgYm90aCB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgY29sdW1uIGJhc2VkIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2VhcmNoIHNlYXJjaCBpbmZvcm1hdGlvbgoJCSAqICBAcGFyYW0ge2ludH0gW2lGb3JjZV0gZm9yY2UgYSByZXNlYXJjaCBvZiB0aGUgbWFzdGVyIGFycmF5ICgxKSBvciBub3QgKHVuZGVmaW5lZCBvciAwKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb21wbGV0ZSAoIG9TZXR0aW5ncywgb0lucHV0LCBpRm9yY2UgKQoJCXsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJdmFyIGFvUHJldlNlYXJjaCA9IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHM7CgkJCXZhciBmblNhdmVGaWx0ZXIgPSBmdW5jdGlvbiAoIG9GaWx0ZXIgKSB7CgkJCQkvKiBTYXZlIHRoZSBmaWx0ZXJpbmcgdmFsdWVzICovCgkJCQlvUHJldlNlYXJjaC5zU2VhcmNoID0gb0ZpbHRlci5zU2VhcmNoOwoJCQkJb1ByZXZTZWFyY2guYlJlZ2V4ID0gb0ZpbHRlci5iUmVnZXg7CgkJCQlvUHJldlNlYXJjaC5iU21hcnQgPSBvRmlsdGVyLmJTbWFydDsKCQkJCW9QcmV2U2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgPSBvRmlsdGVyLmJDYXNlSW5zZW5zaXRpdmU7CgkJCX07CgkJCgkJCS8qIEluIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgYWxsIGZpbHRlcmluZyBpcyBkb25lIGJ5IHRoZSBzZXJ2ZXIsIHNvIG5vIHBvaW50IGhhbmdpbmcgYXJvdW5kIGhlcmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCS8qIEdsb2JhbCBmaWx0ZXIgKi8KCQkJCV9mbkZpbHRlciggb1NldHRpbmdzLCBvSW5wdXQuc1NlYXJjaCwgaUZvcmNlLCBvSW5wdXQuYlJlZ2V4LCBvSW5wdXQuYlNtYXJ0LCBvSW5wdXQuYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQkJZm5TYXZlRmlsdGVyKCBvSW5wdXQgKTsKCQkKCQkJCS8qIE5vdyBkbyB0aGUgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVyICovCgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJX2ZuRmlsdGVyQ29sdW1uKCBvU2V0dGluZ3MsIGFvUHJldlNlYXJjaFtpXS5zU2VhcmNoLCBpLCBhb1ByZXZTZWFyY2hbaV0uYlJlZ2V4LCAKCQkJCQkJYW9QcmV2U2VhcmNoW2ldLmJTbWFydCwgYW9QcmV2U2VhcmNoW2ldLmJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJCX0KCQkJCQoJCQkJLyogQ3VzdG9tIGZpbHRlcmluZyAqLwoJCQkJX2ZuRmlsdGVyQ3VzdG9tKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWZuU2F2ZUZpbHRlciggb0lucHV0ICk7CgkJCX0KCQkJCgkJCS8qIFRlbGwgdGhlIGRyYXcgZnVuY3Rpb24gd2UgaGF2ZSBiZWVuIGZpbHRlcmluZyAqLwoJCQlvU2V0dGluZ3MuYkZpbHRlcmVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdmaWx0ZXInLCBvU2V0dGluZ3MpOwoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8qIFJlYnVpbGQgc2VhcmNoIGFycmF5ICdvZmZsaW5lJyAqLwoJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDAgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgY3VzdG9tIGZpbHRlcmluZyBmdW5jdGlvbnMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDdXN0b20oIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYWZuRmlsdGVycyA9IERhdGFUYWJsZS5leHQuYWZuRmlsdGVyaW5nOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFmbkZpbHRlcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJdmFyIGlDb3JyZWN0b3IgPSAwOwoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJdmFyIGlEaXNJbmRleCA9IG9TZXR0aW5ncy5haURpc3BsYXlbai1pQ29ycmVjdG9yXTsKCQkJCQkKCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgdXNlIHRoaXMgcm93IGJhc2VkIG9uIHRoZSBmaWx0ZXJpbmcgZnVuY3Rpb24gKi8KCQkJCQlpZiAoICFhZm5GaWx0ZXJzW2ldKCBvU2V0dGluZ3MsIF9mbkdldFJvd0RhdGEoIG9TZXR0aW5ncywgaURpc0luZGV4LCAnZmlsdGVyJyApLCBpRGlzSW5kZXggKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggai1pQ29ycmVjdG9yLCAxICk7CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSB0YWJsZSBvbiBhIHBlci1jb2x1bW4gYmFzaXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2x1bW4gY29sdW1uIHRvIGZpbHRlcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBzZWFyY2ggc3RyaW5nIGFzIGEgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTbWFydCB1c2Ugc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb2x1bW4gKCBvU2V0dGluZ3MsIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJaWYgKCBzSW5wdXQgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJdmFyIHJwU2VhcmNoID0gX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoKCBzSW5wdXQsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICk7CgkJCQoJCQlmb3IgKCB2YXIgaT1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCXZhciBzRGF0YSA9IF9mbkRhdGFUb1NlYXJjaCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtpXSwgaUNvbHVtbiwgJ2ZpbHRlcicgKSwKCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLnNUeXBlICk7CgkJCQlpZiAoICEgcnBTZWFyY2gudGVzdCggc0RhdGEgKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIGksIDEgKTsKCQkJCQlpSW5kZXhDb3JyZWN0b3IrKzsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIGRhdGEgdGFibGUgYmFzZWQgb24gdXNlciBpbnB1dCBhbmQgZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlGb3JjZSBvcHRpb25hbCAtIGZvcmNlIGEgcmVzZWFyY2ggb2YgdGhlIG1hc3RlciBhcnJheSAoMSkgb3Igbm90ICh1bmRlZmluZWQgb3IgMCkKCQkgKiAgQHBhcmFtIHtib29sfSBiUmVnZXggdHJlYXQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNtYXJ0IHBlcmZvcm0gc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXIoIG9TZXR0aW5ncywgc0lucHV0LCBpRm9yY2UsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBpOwoJCQl2YXIgcnBTZWFyY2ggPSBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNJbnB1dCwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIGFyZSBmb3JjaW5nIG9yIG5vdCAtIG9wdGlvbmFsIHBhcmFtZXRlciAqLwoJCQlpZiAoICFpRm9yY2UgKQoJCQl7CgkJCQlpRm9yY2UgPSAwOwoJCQl9CgkJCQoJCQkvKiBOZWVkIHRvIHRha2UgYWNjb3VudCBvZiBjdXN0b20gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIGFsd2F5cyBmaWx0ZXIgKi8KCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmbkZpbHRlcmluZy5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlpRm9yY2UgPSAxOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBJZiB0aGUgaW5wdXQgaXMgYmxhbmsgLSB3ZSB3YW50IHRoZSBmdWxsIGRhdGEgc2V0CgkJCSAqLwoJCQlpZiAoIHNJbnB1dC5sZW5ndGggPD0gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyoKCQkJCSAqIFdlIGFyZSBzdGFydGluZyBhIG5ldyBzZWFyY2ggb3IgdGhlIG5ldyBzZWFyY2ggc3RyaW5nIGlzIHNtYWxsZXIgCgkJCQkgKiB0aGVuIHRoZSBvbGQgb25lIChpLmUuIGRlbGV0ZSkuIFNlYXJjaCBmcm9tIHRoZSBtYXN0ZXIgYXJyYXkKCQkJIAkgKi8KCQkJCWlmICggb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggPT0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggfHwKCQkJCQkgICBvUHJldlNlYXJjaC5zU2VhcmNoLmxlbmd0aCA+IHNJbnB1dC5sZW5ndGggfHwgaUZvcmNlID09IDEgfHwKCQkJCQkgICBzSW5wdXQuaW5kZXhPZihvUHJldlNlYXJjaC5zU2VhcmNoKSAhPT0gMCApCgkJCQl7CgkJCQkJLyogTnVrZSB0aGUgb2xkIGRpc3BsYXkgYXJyYXkgLSB3ZSBhcmUgZ29pbmcgdG8gcmVidWlsZCBpdCAqLwoJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQkJCgkJCQkJLyogRm9yY2UgYSByZWJ1aWxkIG9mIHRoZSBzZWFyY2ggYXJyYXkgKi8KCQkJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDEgKTsKCQkJCQkKCQkJCQkvKiBTZWFyY2ggdGhyb3VnaCBhbGwgcmVjb3JkcyB0byBwb3B1bGF0ZSB0aGUgc2VhcmNoIGFycmF5CgkJCQkJICogVGhlIHRoZSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyIGFuZCBhc0RhdGFTZWFyY2ggYXJyYXlzIGhhdmUgMSB0byAxIAoJCQkJCSAqIG1hcHBpbmcKCQkJCQkgKi8KCQkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggcnBTZWFyY2gudGVzdChvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2ldKSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkucHVzaCggb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcltpXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkgIH0KCQkJICBlbHNlCgkJCQl7CgkJCSAgCS8qIFVzaW5nIG9sZCBzZWFyY2ggYXJyYXkgLSByZWZpbmUgaXQgLSBkbyBpdCB0aGlzIHdheSBmb3Igc3BlZWQKCQkJICAJICogRG9uJ3QgaGF2ZSB0byBzZWFyY2ggdGhlIHdob2xlIG1hc3RlciBhcnJheSBhZ2FpbgoJCQkJCSAqLwoJCQkgIAl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJICAJCgkJCSAgCS8qIFNlYXJjaCB0aGUgY3VycmVudCByZXN1bHRzICovCgkJCSAgCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJICAJCWlmICggISBycFNlYXJjaC50ZXN0KG9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0pICkKCQkJCQkJewoJCQkgIAkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCBpLWlJbmRleENvcnJlY3RvciwgMSApOwoJCQkgIAkJCWlJbmRleENvcnJlY3RvcisrOwoJCQkgIAkJfQoJCQkgIAl9CgkJCSAgfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhbiBhcnJheSB3aGljaCBjYW4gYmUgcXVpY2tseSBzZWFyY2ggdGhyb3VnaAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWFzdGVyIHVzZSB0aGUgbWFzdGVyIGRhdGEgYXJyYXkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaEFycmF5ICggb1NldHRpbmdzLCBpTWFzdGVyICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQkvKiBDbGVhciBvdXQgdGhlIG9sZCBkYXRhICovCgkJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoLnNwbGljZSggMCwgb1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggKTsKCQkJCQoJCQkJdmFyIGFBcnJheSA9IChpTWFzdGVyICYmIGlNYXN0ZXI9PT0xKSA/CgkJCQkgCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIgOiBvU2V0dGluZ3MuYWlEaXNwbGF5OwoJCQkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFBcnJheS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0gPSBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLAoJCQkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGFBcnJheVtpXSwgJ2ZpbHRlcicgKSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIHNlYXJjaGFibGUgc3RyaW5nIGZyb20gYSBzaW5nbGUgZGF0YSByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSb3cgZGF0YSBhcnJheSB0byB1c2UgZm9yIHRoZSBkYXRhIHRvIHNlYXJjaAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLCBhRGF0YSApCgkJewoJCQl2YXIgc1NlYXJjaCA9ICcnOwoJCQlpZiAoIG9TZXR0aW5ncy5fX25UbXBGaWx0ZXIgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCW9TZXR0aW5ncy5fX25UbXBGaWx0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJfQoJCQl2YXIgblRtcCA9IG9TZXR0aW5ncy5fX25UbXBGaWx0ZXI7CgkJCQoJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2pdLmJTZWFyY2hhYmxlICkKCQkJCXsKCQkJCQl2YXIgc0RhdGEgPSBhRGF0YVtqXTsKCQkJCQlzU2VhcmNoICs9IF9mbkRhdGFUb1NlYXJjaCggc0RhdGEsIG9TZXR0aW5ncy5hb0NvbHVtbnNbal0uc1R5cGUgKSsnICAnOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiBpdCBsb29rcyBsaWtlIHRoZXJlIGlzIGFuIEhUTUwgZW50aXR5IGluIHRoZSBzdHJpbmcsIGF0dGVtcHQgdG8gZGVjb2RlIGl0ICovCgkJCWlmICggc1NlYXJjaC5pbmRleE9mKCcmJykgIT09IC0xICkKCQkJewoJCQkJblRtcC5pbm5lckhUTUwgPSBzU2VhcmNoOwoJCQkJc1NlYXJjaCA9IG5UbXAudGV4dENvbnRlbnQgPyBuVG1wLnRleHRDb250ZW50IDogblRtcC5pbm5lclRleHQ7CgkJCQkKCQkJCS8qIElFIGFuZCBPcGVyYSBhcHBlYXIgdG8gcHV0IGFuIG5ld2xpbmUgd2hlcmUgdGhlcmUgaXMgYSA8YnI+IHRhZyAtIHJlbW92ZSBpdCAqLwoJCQkJc1NlYXJjaCA9IHNTZWFyY2gucmVwbGFjZSgvXG4vZywiICIpLnJlcGxhY2UoL1xyL2csIiIpOwoJCQl9CgkJCQoJCQlyZXR1cm4gc1NlYXJjaDsKCQl9CgkJCgkJLyoqCgkJICogQnVpbGQgYSByZWd1bGFyIGV4cHJlc3Npb24gb2JqZWN0IHN1aXRhYmxlIGZvciBzZWFyY2hpbmcgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NlYXJjaCBzdHJpbmcgdG8gc2VhcmNoIGZvcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU21hcnQgcGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc3RpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEByZXR1cm5zIHtSZWdFeHB9IGNvbnN0cnVjdGVkIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNTZWFyY2gsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBhc1NlYXJjaCwgc1JlZ0V4cFN0cmluZzsKCQkJCgkJCWlmICggYlNtYXJ0ICkKCQkJewoJCQkJLyogR2VuZXJhdGUgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byB1c2UuIFNvbWV0aGluZyBhbG9uZyB0aGUgbGluZXMgb2Y6CgkJCQkgKiBeKD89Lio/XGJvbmVcYikoPz0uKj9cYnR3b1xiKSg/PS4qP1xidGhyZWVcYikuKiQKCQkJCSAqLwoJCQkJYXNTZWFyY2ggPSBiUmVnZXggPyBzU2VhcmNoLnNwbGl0KCAnICcgKSA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICkuc3BsaXQoICcgJyApOwoJCQkJc1JlZ0V4cFN0cmluZyA9ICdeKD89Lio/Jythc1NlYXJjaC5qb2luKCAnKSg/PS4qPycgKSsnKS4qJCc7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1JlZ0V4cFN0cmluZywgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlzU2VhcmNoID0gYlJlZ2V4ID8gc1NlYXJjaCA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICk7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1NlYXJjaCwgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ29udmVydCByYXcgZGF0YSBpbnRvIHNvbWV0aGluZyB0aGF0IHRoZSB1c2VyIGNhbiBzZWFyY2ggb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNEYXRhIGRhdGEgdG8gYmUgbW9kaWZpZWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUeXBlIGRhdGEgdHlwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBzZWFyY2ggc3RyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRhdGFUb1NlYXJjaCAoIHNEYXRhLCBzVHlwZSApCgkJewoJCQlpZiAoIHR5cGVvZiBEYXRhVGFibGUuZXh0Lm9mblNlYXJjaFtzVHlwZV0gPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlyZXR1cm4gRGF0YVRhYmxlLmV4dC5vZm5TZWFyY2hbc1R5cGVdKCBzRGF0YSApOwoJCQl9CgkJCWVsc2UgaWYgKCBzVHlwZSA9PSAiaHRtbCIgKQoJCQl7CgkJCQlyZXR1cm4gc0RhdGEucmVwbGFjZSgvW1xyXG5dL2csIiAiKS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIHNEYXRhID09PSAic3RyaW5nIiApCgkJCXsKCQkJCXJldHVybiBzRGF0YS5yZXBsYWNlKC9bXHJcbl0vZywiICIpOwoJCQl9CgkJCWVsc2UgaWYgKCBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIHNjYXBlIGEgc3RyaW5nIHN0dWNoIHRoYXQgaXQgY2FuIGJlIHVzZWQgaW4gYSByZWd1bGFyIGV4cHJlc3Npb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWYWwgc3RyaW5nIHRvIGVzY2FwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBlc2NhcGVkIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Fc2NhcGVSZWdleCAoIHNWYWwgKQoJCXsKCQkJdmFyIGFjRXNjYXBlID0gWyAnLycsICcuJywgJyonLCAnKycsICc/JywgJ3wnLCAnKCcsICcpJywgJ1snLCAnXScsICd7JywgJ30nLCAnXFwnLCAnJCcsICdeJyBdOwoJCQl2YXIgcmVSZXBsYWNlID0gbmV3IFJlZ0V4cCggJyhcXCcgKyBhY0VzY2FwZS5qb2luKCd8XFwnKSArICcpJywgJ2cnICk7CgkJCXJldHVybiBzVmFsLnJlcGxhY2UocmVSZXBsYWNlLCAnXFwkMScpOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdGhlIGluZm8gZGlzcGxheQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBJbmZvcm1hdGlvbiBlbGVtZW50CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sSW5mbyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgbkluZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQluSW5mby5jbGFzc05hbWUgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0luZm87CgkJCQoJCQkvKiBBY3Rpb25zIHRoYXQgYXJlIHRvIGJlIHRha2VuIG9uY2Ugb25seSBmb3IgdGhpcyBmZWF0dXJlICovCgkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5pICkKCQkJewoJCQkJLyogQWRkIGRyYXcgY2FsbGJhY2sgKi8KCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogX2ZuVXBkYXRlSW5mbywKCQkJCQkic05hbWUiOiAiaW5mb3JtYXRpb24iCgkJCQl9ICk7CgkJCQkKCQkJCS8qIEFkZCBpZCAqLwoJCQkJbkluZm8uaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19pbmZvJzsKCQkJfQoJCQlvU2V0dGluZ3MublRhYmxlLnNldEF0dHJpYnV0ZSggJ2FyaWEtZGVzY3JpYmVkYnknLCBvU2V0dGluZ3Muc1RhYmxlSWQrJ19pbmZvJyApOwoJCQkKCQkJcmV0dXJuIG5JbmZvOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgdGhlIGluZm9ybWF0aW9uIGVsZW1lbnRzIGluIHRoZSBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuVXBkYXRlSW5mbyAoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBTaG93IGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJJbmZvIHx8IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5pLmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJdmFyCgkJCQlpU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQrMSwgaUVuZCA9IG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwKCQkJCWlNYXggPSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSwgaVRvdGFsID0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSwKCQkJCXNTdGFydCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaVN0YXJ0ICksIHNFbmQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlFbmQgKSwKCQkJCXNNYXggPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlNYXggKSwgc1RvdGFsID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpVG90YWwgKSwKCQkJCXNPdXQ7CgkJCQoJCQkvKiBXaGVuIGluZmluaXRlIHNjcm9sbGluZywgd2UgYXJlIGFsd2F5cyBzdGFydGluZyBhdCAxLiBfaURpc3BsYXlTdGFydCBpcyB1c2VkIG9ubHkKCQkJICogaW50ZXJuYWxseQoJCQkgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQlzU3RhcnQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIDEgKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpID09PSAwICYmIAoJCQkJICAgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSApCgkJCXsKCQkJCS8qIEVtcHR5IHJlY29yZCBzZXQgKi8KCQkJCXNPdXQgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLnNJbmZvRW1wdHkrIG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0luZm9Qb3N0Rml4OwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpID09PSAwICkKCQkJewoJCQkJLyogUm1wdHkgcmVjb3JkIHNldCBhZnRlciBmaWx0ZXJpbmcgKi8KCQkJCXNPdXQgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLnNJbmZvRW1wdHkgKycgJysgCgkJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zSW5mb0ZpbHRlcmVkLnJlcGxhY2UoJ19NQVhfJywgc01heCkrCgkJCQkJCW9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0luZm9Qb3N0Rml4OwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpID09IG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpICkKCQkJewoJCQkJLyogTm9ybWFsIHJlY29yZCBzZXQgKi8KCQkJCXNPdXQgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLnNJbmZvLgoJCQkJCQlyZXBsYWNlKCdfU1RBUlRfJywgc1N0YXJ0KS4KCQkJCQkJcmVwbGFjZSgnX0VORF8nLCAgIHNFbmQpLgoJCQkJCQlyZXBsYWNlKCdfVE9UQUxfJywgc1RvdGFsKSsgCgkJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zSW5mb1Bvc3RGaXg7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBSZWNvcmQgc2V0IGFmdGVyIGZpbHRlcmluZyAqLwoJCQkJc091dCA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0luZm8uCgkJCQkJCXJlcGxhY2UoJ19TVEFSVF8nLCBzU3RhcnQpLgoJCQkJCQlyZXBsYWNlKCdfRU5EXycsICAgc0VuZCkuCgkJCQkJCXJlcGxhY2UoJ19UT1RBTF8nLCBzVG90YWwpICsnICcrIAoJCQkJCW9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0luZm9GaWx0ZXJlZC5yZXBsYWNlKCdfTUFYXycsIAoJCQkJCQlvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIob1NldHRpbmdzLmZuUmVjb3Jkc1RvdGFsKCkpKSsgCgkJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zSW5mb1Bvc3RGaXg7CgkJCX0KCQkJCgkJCWlmICggb1NldHRpbmdzLm9MYW5ndWFnZS5mbkluZm9DYWxsYmFjayAhPT0gbnVsbCApCgkJCXsKCQkJCXNPdXQgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLmZuSW5mb0NhbGxiYWNrLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIAoJCQkJCW9TZXR0aW5ncywgaVN0YXJ0LCBpRW5kLCBpTWF4LCBpVG90YWwsIHNPdXQgKTsKCQkJfQoJCQkKCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuaTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCSQobltpXSkuaHRtbCggc091dCApOwoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRpYWxpc2UgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGlBamF4U3RhcnQ9b1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkKCQkJLyogRW5zdXJlIHRoYXQgdGhlIHRhYmxlIGRhdGEgaXMgZnVsbHkgaW5pdGlhbGlzZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkluaXRpYWxpc2VkID09PSBmYWxzZSApCgkJCXsKCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7IF9mbkluaXRpYWxpc2UoIG9TZXR0aW5ncyApOyB9LCAyMDAgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgZGlzcGxheSBIVE1MIG9wdGlvbnMgKi8KCQkJX2ZuQWRkT3B0aW9uc0h0bWwoIG9TZXR0aW5ncyApOwoJCQkKCQkJLyogQnVpbGQgYW5kIGRyYXcgdGhlIGhlYWRlciAvIGZvb3RlciBmb3IgdGhlIHRhYmxlICovCgkJCV9mbkJ1aWxkSGVhZCggb1NldHRpbmdzICk7CgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQoJCQkvKiBPa2F5IHRvIHNob3cgdGhhdCBzb21ldGhpbmcgaXMgZ29pbmcgb24gbm93ICovCgkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCgkJCS8qIENhbGN1bGF0ZSBzaXplcyBmb3IgY29sdW1ucyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggIT09IG51bGwgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIElmIHRoZXJlIGlzIGRlZmF1bHQgc29ydGluZyByZXF1aXJlZCAtIGxldCdzIGRvIGl0LiBUaGUgc29ydCBmdW5jdGlvbiB3aWxsIGRvIHRoZQoJCQkgKiBkcmF3aW5nIGZvciB1cy4gT3RoZXJ3aXNlIHdlIGRyYXcgdGhlIHRhYmxlIHJlZ2FyZGxlc3Mgb2YgdGhlIEFqYXggc291cmNlIC0gdGhpcyBhbGxvd3MKCQkJICogdGhlIHRhYmxlIHRvIGxvb2sgaW5pdGlhbGlzZWQgZm9yIEFqYXggc291cmNpbmcgZGF0YSAoc2hvdyAnbG9hZGluZycgbWVzc2FnZSBwb3NzaWJseSkKCQkJICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBpZiB0aGVyZSBpcyBhbiBhamF4IHNvdXJjZSBsb2FkIHRoZSBkYXRhICovCgkJCWlmICggb1NldHRpbmdzLnNBamF4U291cmNlICE9PSBudWxsICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJdmFyIGFvRGF0YSA9IFtdOwoJCQkJX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApOwoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwgZnVuY3Rpb24oanNvbikgewoJCQkJCXZhciBhRGF0YSA9IChvU2V0dGluZ3Muc0FqYXhEYXRhUHJvcCAhPT0gIiIpID8KCQkJCQkgCV9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKShqc29uKSA6IGpzb247CgkJCgkJCQkJLyogR290IHRoZSBkYXRhIC0gYWRkIGl0IHRvIHRoZSB0YWJsZSAqLwoJCQkJCWZvciAoIGk9MCA7IGk8YURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCV9mbkFkZERhdGEoIG9TZXR0aW5ncywgYURhdGFbaV0gKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogUmVzZXQgdGhlIGluaXQgZGlzcGxheSBmb3IgY29va2llIHNhdmluZy4gV2UndmUgYWxyZWFkeSBkb25lIGEgZmlsdGVyLCBhbmQKCQkJCQkgKiB0aGVyZWZvcmUgY2xlYXJlZCBpdCBiZWZvcmUuIFNvIHdlIG5lZWQgdG8gbWFrZSBpdCBhcHBlYXIgJ2ZyZXNoJwoJCQkJCSAqLwoJCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IGlBamF4U3RhcnQ7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJCQl7CgkJCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncywganNvbiApOwoJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgaW5pdGlhbGlzYXRpb24gY29tcGxldGUgaXMgZG9uZSBhdCB0aGUgZW5kIG9mIF9mbkRyYXcgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBbanNvbl0gSlNPTiBmcm9tIHRoZSBzZXJ2ZXIgdGhhdCBjb21wbGV0ZWQgdGhlIHRhYmxlLCBpZiB1c2luZyBBamF4IHNvdXJjZQoJCSAqICAgIHdpdGggY2xpZW50LXNpZGUgcHJvY2Vzc2luZyAob3B0aW9uYWwpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRDb21wbGV0ZSAoIG9TZXR0aW5ncywganNvbiApCgkJewoJCQlvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgPSB0cnVlOwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvSW5pdENvbXBsZXRlJywgJ2luaXQnLCBbb1NldHRpbmdzLCBqc29uXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBjb21wYXRpYmlsaXR5IC0gd2hlbiBjZXJ0YWluIG9wdGlvbnMgYXJlIGdpdmVuLCBhbmQgb3RoZXJzIGFyZW4ndCwgd2UKCQkgKiBuZWVkIHRvIGR1cGxpY2F0ZSB0aGUgdmFsdWVzIG92ZXIsIGluIG9yZGVyIHRvIHByb3ZpZGUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCQkgKiB3aXRoIG9sZGVyIGxhbmd1YWdlIGZpbGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxhbmd1YWdlQ29tcGF0KCBvTGFuZ3VhZ2UgKQoJCXsKCQkJLyogQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgLSBpZiB0aGVyZSBpcyBubyBzRW1wdHlUYWJsZSBnaXZlbiwgdGhlbiB1c2UgdGhlIHNhbWUgYXMKCQkJICogc1plcm9SZWNvcmRzIC0gYXNzdW1pbmcgdGhhdCBpcyBnaXZlbi4KCQkJICovCgkJCWlmICggIW9MYW5ndWFnZS5zRW1wdHlUYWJsZSAmJiBvTGFuZ3VhZ2Uuc1plcm9SZWNvcmRzICkKCQkJewoJCQkJX2ZuTWFwKCBvTGFuZ3VhZ2UsIG9MYW5ndWFnZSwgJ3NaZXJvUmVjb3JkcycsICdzRW1wdHlUYWJsZScgKTsKCQkJfQoJCQoJCQkvKiBMaWtld2lzZSB3aXRoIGxvYWRpbmcgcmVjb3JkcyAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0xvYWRpbmdSZWNvcmRzICYmIG9MYW5ndWFnZS5zWmVyb1JlY29yZHMgKQoJCQl7CgkJCQlfZm5NYXAoIG9MYW5ndWFnZSwgb0xhbmd1YWdlLCAnc1plcm9SZWNvcmRzJywgJ3NMb2FkaW5nUmVjb3JkcycgKTsKCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdXNlciBkaXNwbGF5IGxlbmd0aCBjaGFuZ2luZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBEaXNwbGF5IGxlbmd0aCBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxMZW5ndGggKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJLyogVGhpcyBjYW4gYmUgb3ZlcnJ1bGVkIGJ5IG5vdCB1c2luZyB0aGUgX01FTlVfIHZhci9tYWNybyBpbiB0aGUgbGFuZ3VhZ2UgdmFyaWFibGUgKi8KCQkJdmFyIHNOYW1lID0gJ25hbWU9Iicrb1NldHRpbmdzLnNUYWJsZUlkKydfbGVuZ3RoIic7CgkJCXZhciBzU3RkTWVudSA9ICc8c2VsZWN0IHNpemU9IjEiICcrc05hbWUrJz4nOwoJCQl2YXIgaSwgaUxlbjsKCQkJdmFyIGFMZW5ndGhNZW51ID0gb1NldHRpbmdzLmFMZW5ndGhNZW51OwoJCQkKCQkJaWYgKCBhTGVuZ3RoTWVudS5sZW5ndGggPT0gMiAmJiB0eXBlb2YgYUxlbmd0aE1lbnVbMF0gPT09ICdvYmplY3QnICYmIAoJCQkJCXR5cGVvZiBhTGVuZ3RoTWVudVsxXSA9PT0gJ29iamVjdCcgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YUxlbmd0aE1lbnVbMF0ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlzU3RkTWVudSArPSAnPG9wdGlvbiB2YWx1ZT0iJythTGVuZ3RoTWVudVswXVtpXSsnIj4nK2FMZW5ndGhNZW51WzFdW2ldKyc8L29wdGlvbj4nOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFMZW5ndGhNZW51Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJc1N0ZE1lbnUgKz0gJzxvcHRpb24gdmFsdWU9IicrYUxlbmd0aE1lbnVbaV0rJyI+JythTGVuZ3RoTWVudVtpXSsnPC9vcHRpb24+JzsKCQkJCX0KCQkJfQoJCQlzU3RkTWVudSArPSAnPC9zZWxlY3Q+JzsKCQkJCgkJCXZhciBuTGVuZ3RoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmwgKQoJCQl7CgkJCQluTGVuZ3RoLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfbGVuZ3RoJzsKCQkJfQoJCQluTGVuZ3RoLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zTGVuZ3RoOwoJCQluTGVuZ3RoLmlubmVySFRNTCA9ICc8bGFiZWw+JytvU2V0dGluZ3Mub0xhbmd1YWdlLnNMZW5ndGhNZW51LnJlcGxhY2UoICdfTUVOVV8nLCBzU3RkTWVudSApKyc8L2xhYmVsPic7CgkJCQoJCQkvKgoJCQkgKiBTZXQgdGhlIGxlbmd0aCB0byB0aGUgY3VycmVudCBkaXNwbGF5IGxlbmd0aCAtIHRoYW5rcyB0byBBbmRyZWEgUGF2bG92aWMgZm9yIHRoaXMgZml4LAoJCQkgKiBhbmQgU3RlZmFuIFNrb3BuaWsgZm9yIGZpeGluZyB0aGUgZml4IQoJCQkgKi8KCQkJJCgnc2VsZWN0IG9wdGlvblt2YWx1ZT0iJytvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKyciXScsIG5MZW5ndGgpLmF0dHIoInNlbGVjdGVkIiwgdHJ1ZSk7CgkJCQoJCQkkKCdzZWxlY3QnLCBuTGVuZ3RoKS5iaW5kKCAnY2hhbmdlLkRUJywgZnVuY3Rpb24oZSkgewoJCQkJdmFyIGlWYWwgPSAkKHRoaXMpLnZhbCgpOwoJCQkJCgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGxlbmd0aCBvcHRpb25zIGZvciB0aGUgbmV3IGRpc3BsYXkgKi8KCQkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmw7CgkJCQlmb3IgKCBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggbltpXSAhPSB0aGlzLnBhcmVudE5vZGUgKQoJCQkJCXsKCQkJCQkJJCgnc2VsZWN0JywgbltpXSkudmFsKCBpVmFsICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBSZWRyYXcgdGhlIHRhYmxlICovCgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID0gcGFyc2VJbnQoaVZhbCwgMTApOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCQoJCQkJLyogSWYgd2UgaGF2ZSBzcGFjZSB0byBzaG93IGV4dHJhIHJvd3MgKGJhY2tpbmcgdXAgZnJvbSB0aGUgZW5kIHBvaW50IC0gdGhlbiBkbyBzbyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgPT0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIC0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA8IDAgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA9PSAtMSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJCQoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0gKTsKCQkKCQkKCQkJJCgnc2VsZWN0Jywgbkxlbmd0aCkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQoJCQlyZXR1cm4gbkxlbmd0aDsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmNhbGN1bGF0ZSB0aGUgZW5kIHBvaW50IGJhc2VkIG9uIHRoZSBzdGFydCBwb2ludAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2V0IHRoZSBlbmQgcG9pbnQgb2YgdGhlIGRpc3BsYXkgLSBiYXNlZCBvbiBob3cgbWFueSBlbGVtZW50cyB0aGVyZSBhcmUKCQkJCSAqIHN0aWxsIHRvIGRpc3BsYXkKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID4gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggfHwKCQkJCQkgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kID0gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCArIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCQkgKiBOb3RlIHRoYXQgbW9zdCBvZiB0aGUgcGFnaW5nIGxvZ2ljIGlzIGRvbmUgaW4gCgkJICogRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciBkZWZhdWx0IHBhZ2luYXRpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUGFnaW5hdGlvbiBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgblBhZ2luYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJblBhZ2luYXRlLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnaW5nK29TZXR0aW5ncy5zUGFnaW5hdGlvblR5cGU7CgkJCQoJCQlEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uWyBvU2V0dGluZ3Muc1BhZ2luYXRpb25UeXBlIF0uZm5Jbml0KCBvU2V0dGluZ3MsIG5QYWdpbmF0ZSwgCgkJCQlmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQl9CgkJCSk7CgkJCQoJCQkvKiBBZGQgYSBkcmF3IGNhbGxiYWNrIGZvciB0aGUgcGFnaW5hdGlvbiBvbiBmaXJzdCBpbnN0YW5jZSwgdG8gdXBkYXRlIHRoZSBwYWdpbmcgZGlzcGxheSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkJCQkJRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvblsgb1NldHRpbmdzLnNQYWdpbmF0aW9uVHlwZSBdLmZuVXBkYXRlKCBvU2V0dGluZ3MsIGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCX0gKTsKCQkJCQl9LAoJCQkJCSJzTmFtZSI6ICJwYWdpbmF0aW9uIgoJCQkJfSApOwoJCQl9CgkJCXJldHVybiBuUGFnaW5hdGU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFsdGVyIHRoZSBkaXNwbGF5IHNldHRpbmdzIHRvIGNoYW5nZSB0aGUgcGFnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKQoJCSAqICBAcmV0dXJucyB7Ym9vbH0gdHJ1ZSBwYWdlIGhhcyBjaGFuZ2VkLCBmYWxzZSAtIG5vIGNoYW5nZSAobm8gZWZmZWN0KSBlZyAnZmlyc3QnIG9uIHBhZ2UgMQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5QYWdlQ2hhbmdlICggb1NldHRpbmdzLCBtQWN0aW9uICkKCQl7CgkJCXZhciBpT2xkU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQoJCQlpZiAoIHR5cGVvZiBtQWN0aW9uID09PSAibnVtYmVyIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG1BY3Rpb24gKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPiBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJmaXJzdCIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJwcmV2aW91cyIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoPj0wID8KCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDoKCQkJCQkwOwoJCQkJCgkJCQkvKiBDb3JyZWN0IGZvciB1bmRlcnJ1biAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPCAwICkKCQkJCXsKCQkJCSAgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggbUFjdGlvbiA9PSAibmV4dCIgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPj0gMCApCgkJCQl7CgkJCQkJLyogTWFrZSBzdXJlIHdlIGFyZSBub3Qgb3ZlciBydW5uaW5nIHRoZSBkaXNwbGF5IGFycmF5ICovCgkJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKz0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCQl9CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggbUFjdGlvbiA9PSAibGFzdCIgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPj0gMCApCgkJCQl7CgkJCQkJdmFyIGlQYWdlcyA9IHBhcnNlSW50KCAob1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKS0xKSAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgsIDEwICkgKyAxOwoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IChpUGFnZXMtMSkgKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlVua25vd24gcGFnaW5nIGFjdGlvbjogIittQWN0aW9uICk7CgkJCX0KCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdwYWdlJywgb1NldHRpbmdzKTsKCQkJCgkJCXJldHVybiBpT2xkU3RhcnQgIT0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0OwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdGhlIHByb2Nlc3Npbmcgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBQcm9jZXNzaW5nIGVsZW1lbnQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBuUHJvY2Vzc2luZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCQoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuciApCgkJCXsKCQkJCW5Qcm9jZXNzaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcHJvY2Vzc2luZyc7CgkJCX0KCQkJblByb2Nlc3NpbmcuaW5uZXJIVE1MID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zUHJvY2Vzc2luZzsKCQkJblByb2Nlc3NpbmcuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNQcm9jZXNzaW5nOwoJCQlvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBuUHJvY2Vzc2luZywgb1NldHRpbmdzLm5UYWJsZSApOwoJCQkKCQkJcmV0dXJuIG5Qcm9jZXNzaW5nOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBEaXNwbGF5IG9yIGhpZGUgdGhlIHByb2Nlc3NpbmcgaW5kaWNhdG9yCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU2hvdyBTaG93IHRoZSBwcm9jZXNzaW5nIGluZGljYXRvciAodHJ1ZSkgb3Igbm90IChmYWxzZSkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkgKCBvU2V0dGluZ3MsIGJTaG93ICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCXsKCQkJCXZhciBhbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5yOwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFuW2ldLnN0eWxlLnZpc2liaWxpdHkgPSBiU2hvdyA/ICJ2aXNpYmxlIiA6ICJoaWRkZW4iOwoJCQkJfQoJCQl9CgkJCgkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigncHJvY2Vzc2luZycsIFtvU2V0dGluZ3MsIGJTaG93XSk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhbnkgY29udHJvbCBlbGVtZW50cyBmb3IgdGhlIHRhYmxlIC0gc3BlY2lmaWNhbGx5IHNjcm9sbGluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sVGFibGUgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogQ2hlY2sgaWYgc2Nyb2xsaW5nIGlzIGVuYWJsZWQgb3Igbm90IC0gaWYgbm90IHRoZW4gbGVhdmUgdGhlIERPTSB1bmFsdGVyZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCA9PT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuIG9TZXR0aW5ncy5uVGFibGU7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIFRoZSBIVE1MIHN0cnVjdHVyZSB0aGF0IHdlIHdhbnQgdG8gZ2VuZXJhdGUgaW4gdGhpcyBmdW5jdGlvbiBpczoKCQkJICogIGRpdiAtIG5TY3JvbGxlcgoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsSGVhZAoJCQkgKiAgICAgIGRpdiAtIG5TY3JvbGxIZWFkSW5uZXIKCQkJICogICAgICAgIHRhYmxlIC0gblNjcm9sbEhlYWRUYWJsZQoJCQkgKiAgICAgICAgICB0aGVhZCAtIG5UaGVhZAoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsQm9keQoJCQkgKiAgICAgIHRhYmxlIC0gb1NldHRpbmdzLm5UYWJsZQoJCQkgKiAgICAgICAgdGhlYWQgLSBuVGhlYWRTaXplCgkJCSAqICAgICAgICB0Ym9keSAtIG5UYm9keQoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsRm9vdAoJCQkgKiAgICAgIGRpdiAtIG5TY3JvbGxGb290SW5uZXIKCQkJICogICAgICAgIHRhYmxlIC0gblNjcm9sbEZvb3RUYWJsZQoJCQkgKiAgICAgICAgICB0Zm9vdCAtIG5UZm9vdAoJCQkgKi8KCQkJdmFyCgkJCSAJblNjcm9sbGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsSGVhZElubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsRm9vdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxGb290SW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsSGVhZFRhYmxlID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoZmFsc2UpLAoJCQkgCW5TY3JvbGxGb290VGFibGUgPSBvU2V0dGluZ3MublRhYmxlLmNsb25lTm9kZShmYWxzZSksCgkJCQluVGhlYWQgPSBvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpWzBdLAoJCQkgCW5UZm9vdCA9IG9TZXR0aW5ncy5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290JykubGVuZ3RoID09PSAwID8gbnVsbCA6IAoJCQkJCW9TZXR0aW5ncy5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290JylbMF0sCgkJCQlvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCgkJCW5TY3JvbGxIZWFkLmFwcGVuZENoaWxkKCBuU2Nyb2xsSGVhZElubmVyICk7CgkJCW5TY3JvbGxGb290LmFwcGVuZENoaWxkKCBuU2Nyb2xsRm9vdElubmVyICk7CgkJCW5TY3JvbGxCb2R5LmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWQgKTsKCQkJblNjcm9sbGVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsQm9keSApOwoJCQluU2Nyb2xsSGVhZElubmVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsSGVhZFRhYmxlICk7CgkJCW5TY3JvbGxIZWFkVGFibGUuYXBwZW5kQ2hpbGQoIG5UaGVhZCApOwoJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEZvb3QgKTsKCQkJCW5TY3JvbGxGb290SW5uZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxGb290VGFibGUgKTsKCQkJCW5TY3JvbGxGb290VGFibGUuYXBwZW5kQ2hpbGQoIG5UZm9vdCApOwoJCQl9CgkJCQoJCQluU2Nyb2xsZXIuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbFdyYXBwZXI7CgkJCW5TY3JvbGxIZWFkLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxIZWFkOwoJCQluU2Nyb2xsSGVhZElubmVyLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxIZWFkSW5uZXI7CgkJCW5TY3JvbGxCb2R5LmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxCb2R5OwoJCQluU2Nyb2xsRm9vdC5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsRm9vdDsKCQkJblNjcm9sbEZvb3RJbm5lci5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsRm9vdElubmVyOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iQXV0b0NzcyApCgkJCXsKCQkJCW5TY3JvbGxIZWFkLnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CgkJCQluU2Nyb2xsRm9vdC5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byI7CgkJCX0KCQkJCgkJCW5TY3JvbGxIZWFkLnN0eWxlLmJvcmRlciA9ICIwIjsKCQkJblNjcm9sbEhlYWQuc3R5bGUud2lkdGggPSAiMTAwJSI7CgkJCW5TY3JvbGxGb290LnN0eWxlLmJvcmRlciA9ICIwIjsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS53aWR0aCA9ICIxNTAlIjsgLyogd2lsbCBiZSBvdmVyd3JpdHRlbiAqLwoJCQkKCQkJLyogTW9kaWZ5IGF0dHJpYnV0ZXMgdG8gcmVzcGVjdCB0aGUgY2xvbmVzICovCgkJCW5TY3JvbGxIZWFkVGFibGUucmVtb3ZlQXR0cmlidXRlKCdpZCcpOwoJCQluU2Nyb2xsSGVhZFRhYmxlLnN0eWxlLm1hcmdpbkxlZnQgPSAiMCI7CgkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUubWFyZ2luTGVmdCA9ICIwIjsKCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTsKCQkJCW5TY3JvbGxGb290VGFibGUuc3R5bGUubWFyZ2luTGVmdCA9ICIwIjsKCQkJfQoJCQkKCQkJLyogTW92ZSBhbnkgY2FwdGlvbiBlbGVtZW50cyBmcm9tIHRoZSBib2R5IHRvIHRoZSBoZWFkZXIgKi8KCQkJdmFyIG5DYXB0aW9ucyA9ICQob1NldHRpbmdzLm5UYWJsZSkuY2hpbGRyZW4oJ2NhcHRpb24nKTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uQ2FwdGlvbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJblNjcm9sbEhlYWRUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb25zW2ldICk7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIFNpemluZwoJCQkgKi8KCQkJLyogV2hlbiB4c2Nyb2xsaW5nIGFkZCB0aGUgd2lkdGggYW5kIGEgc2Nyb2xsZXIgdG8gbW92ZSB0aGUgaGVhZGVyIHdpdGggdGhlIGJvZHkgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCApOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb1NldHRpbmdzLm9TY3JvbGwuc1ggKTsKCQkJCQoJCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICk7CQoJCQkJfQoJCQkJCgkJCQkvKiBXaGVuIHRoZSBib2R5IGlzIHNjcm9sbGVkLCB0aGVuIHdlIGFsc28gd2FudCB0byBzY3JvbGwgdGhlIGhlYWRlcnMgKi8KCQkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCggZnVuY3Rpb24gKGUpIHsKCQkJCQluU2Nyb2xsSGVhZC5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0OwoJCQkJCQoJCQkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW5TY3JvbGxGb290LnNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBXaGVuIHlzY3JvbGxpbmcsIGFkZCB0aGUgaGVpZ2h0ICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICk7CgkJCX0KCQkJCgkJCS8qIFJlZHJhdyAtIGFsaWduIGNvbHVtbnMgYWNyb3NzIHRoZSB0YWJsZXMgKi8KCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCSJmbiI6IF9mblNjcm9sbERyYXcsCgkJCQkic05hbWUiOiAic2Nyb2xsaW5nIgoJCQl9ICk7CgkJCQoJCQkvKiBJbmZpbml0ZSBzY3JvbGxpbmcgZXZlbnQgaGFuZGxlcnMgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoIGZ1bmN0aW9uKCkgewoJCQkJCS8qIFVzZSBhIGJsb2NrZXIgdG8gc3RvcCBzY3JvbGxpbmcgZnJvbSBsb2FkaW5nIG1vcmUgZGF0YSB3aGlsZSBvdGhlciBkYXRhIGlzIHN0aWxsIGxvYWRpbmcgKi8KCQkJCQlpZiAoICFvU2V0dGluZ3MuYkRyYXdpbmcgJiYgJCh0aGlzKS5zY3JvbGxUb3AoKSAhPT0gMCApCgkJCQkJewoJCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgbG9hZCB0aGUgbmV4dCBkYXRhIHNldCAqLwoJCQkJCQlpZiAoICQodGhpcykuc2Nyb2xsVG9wKCkgKyAkKHRoaXMpLmhlaWdodCgpID4gCgkJCQkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmhlaWdodCgpIC0gb1NldHRpbmdzLm9TY3JvbGwuaUxvYWRHYXAgKQoJCQkJCQl7CgkJCQkJCQkvKiBPbmx5IGRvIHRoZSByZWRyYXcgaWYgd2UgaGF2ZSB0byAtIHdlIG1pZ2h0IGJlIGF0IHRoZSBlbmQgb2YgdGhlIGRhdGEgKi8KCQkJCQkJCWlmICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAnbmV4dCcgKTsKCQkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MublNjcm9sbEhlYWQgPSBuU2Nyb2xsSGVhZDsKCQkJb1NldHRpbmdzLm5TY3JvbGxGb290ID0gblNjcm9sbEZvb3Q7CgkJCQoJCQlyZXR1cm4gblNjcm9sbGVyOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgdGhlIHZhcmlvdXMgdGFibGVzIGZvciByZXNpemluZy4gSXQncyBhIGJpdCBvZiBhIHBpZyB0aGlzIGZ1bmN0aW9uLCBidXQKCQkgKiBiYXNpY2FsbHkgdGhlIGlkZWEgdG86CgkJICogICAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCSAqICAgMi4gVGFrZSBsaXZlIG1lYXN1cmVtZW50cyBmcm9tIHRoZSBET00KCQkgKiAgIDMuIEFwcGx5IHRoZSBtZWFzdXJlbWVudHMKCQkgKiAgIDQuIENsZWFuIHVwCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbERyYXcgKCBvICkKCQl7CgkJCXZhcgoJCQkJblNjcm9sbEhlYWRJbm5lciA9IG8ublNjcm9sbEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdLAoJCQkJblNjcm9sbEhlYWRUYWJsZSA9IG5TY3JvbGxIZWFkSW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0sCgkJCQluU2Nyb2xsQm9keSA9IG8ublRhYmxlLnBhcmVudE5vZGUsCgkJCQlpLCBpTGVuLCBqLCBqTGVuLCBhbkhlYWRUb1NpemUsIGFuSGVhZFNpemVycywgYW5Gb290U2l6ZXJzLCBhbkZvb3RUb1NpemUsIG9TdHlsZSwgaVZpcywKCQkJCWlXaWR0aCwgYUFwcGxpZWQ9W10sIGlTYW5pdHlXaWR0aCwKCQkJCW5TY3JvbGxGb290SW5uZXIgPSAoby5uVEZvb3QgIT09IG51bGwpID8gby5uU2Nyb2xsRm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZGl2JylbMF0gOiBudWxsLAoJCQkJblNjcm9sbEZvb3RUYWJsZSA9IChvLm5URm9vdCAhPT0gbnVsbCkgPyBuU2Nyb2xsRm9vdElubmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0YWJsZScpWzBdIDogbnVsbCwKCQkJCWllNjcgPSAkLmJyb3dzZXIubXNpZSAmJiAkLmJyb3dzZXIudmVyc2lvbiA8PSA3OwoJCQkKCQkJLyoKCQkJICogMS4gUmUtY3JlYXRlIHRoZSB0YWJsZSBpbnNpZGUgdGhlIHNjcm9sbGluZyBkaXYKCQkJICovCgkJCQoJCQkvKiBSZW1vdmUgdGhlIG9sZCBtaW5pbWlzZWQgdGhlYWQgYW5kIHRmb290IGVsZW1lbnRzIGluIHRoZSBpbm5lciB0YWJsZSAqLwoJCQl2YXIgblRoZWFkU2l6ZSA9IG8ublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpOwoJCQlpZiAoIG5UaGVhZFNpemUubGVuZ3RoID4gMCApCgkJCXsKCQkJCW8ublRhYmxlLnJlbW92ZUNoaWxkKCBuVGhlYWRTaXplWzBdICk7CgkJCX0KCQkJCgkJCXZhciBuVGZvb3RTaXplOwoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJLyogUmVtb3ZlIHRoZSBvbGQgbWluaW1pc2VkIGZvb3RlciBlbGVtZW50IGluIHRoZSBjbG9uZWQgaGVhZGVyICovCgkJCQluVGZvb3RTaXplID0gby5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290Jyk7CgkJCQlpZiAoIG5UZm9vdFNpemUubGVuZ3RoID4gMCApCgkJCQl7CgkJCQkJby5uVGFibGUucmVtb3ZlQ2hpbGQoIG5UZm9vdFNpemVbMF0gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogQ2xvbmUgdGhlIGN1cnJlbnQgaGVhZGVyIGFuZCBmb290ZXIgZWxlbWVudHMgYW5kIHRoZW4gcGxhY2UgaXQgaW50byB0aGUgaW5uZXIgdGFibGUgKi8KCQkJblRoZWFkU2l6ZSA9IG8ublRIZWFkLmNsb25lTm9kZSh0cnVlKTsKCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGhlYWRTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzBdICk7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJblRmb290U2l6ZSA9IG8ublRGb290LmNsb25lTm9kZSh0cnVlKTsKCQkJCW8ublRhYmxlLmluc2VydEJlZm9yZSggblRmb290U2l6ZSwgby5uVGFibGUuY2hpbGROb2Rlc1sxXSApOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiAyLiBUYWtlIGxpdmUgbWVhc3VyZW1lbnRzIGZyb20gdGhlIERPTSAtIGRvIG5vdCBhbHRlciB0aGUgRE9NIGl0c2VsZiEKCQkJICovCgkJCQoJCQkvKiBSZW1vdmUgb2xkIHNpemluZyBhbmQgYXBwbHkgdGhlIGNhbGN1bGF0ZWQgY29sdW1uIHdpZHRocwoJCQkgKiBHZXQgdGhlIHVuaXF1ZSBjb2x1bW4gaGVhZGVycyBpbiB0aGUgbmV3bHkgY3JlYXRlZCAoY2xvbmVkKSBoZWFkZXIuIFdlIHdhbnQgdG8gYXBwbHkgdGhlCgkJCSAqIGNhbGNsYXRlZCBzaXplcyB0byB0aGlzIGhlYWRlcgoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCX0KCQkJCgkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvLCBuVGhlYWRTaXplICk7CgkJCWZvciAoIGk9MCwgaUxlbj1uVGhzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlWaXMgPSBfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCggbywgaSApOwoJCQkJblRoc1tpXS5zdHlsZS53aWR0aCA9IG8uYW9Db2x1bW5zW2lWaXNdLnNXaWR0aDsKCQkJfQoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24obikgewoJCQkJCW4uc3R5bGUud2lkdGggPSAiIjsKCQkJCX0sIG5UZm9vdFNpemUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJykgKTsKCQkJfQoJCQkKCQkJLyogU2l6ZSB0aGUgdGFibGUgYXMgYSB3aG9sZSAqLwoJCQlpU2FuaXR5V2lkdGggPSAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCk7CgkJCWlmICggby5vU2Nyb2xsLnNYID09PSAiIiApCgkJCXsKCQkJCS8qIE5vIHggc2Nyb2xsaW5nICovCgkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9ICIxMDAlIjsKCQkJCQoJCQkJLyogSSBrbm93IHRoaXMgaXMgcnViYmlzaCAtIGJ1dCBJRTcgd2lsbCBtYWtlIHRoZSB3aWR0aCBvZiB0aGUgdGFibGUgd2hlbiAxMDAlIGluY2x1ZGUKCQkJCSAqIHRoZSBzY3JvbGxiYXIgLSB3aGljaCBpcyBzaG91bGRuJ3QuIFdoZW4gdGhlcmUgaXMgYSBzY3JvbGxiYXIgd2UgbmVlZCB0byB0YWtlIHRoaXMKCQkJCSAqIGludG8gYWNjb3VudC4KCQkJCSAqLwoJCQkJaWYgKCBpZTY3ICYmICgkKCd0Ym9keScsIG5TY3JvbGxCb2R5KS5oZWlnaHQoKSA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikgICkKCQkJCXsKCQkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCktby5vU2Nyb2xsLmlCYXJXaWR0aCApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaWYgKCBvLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCS8qIHggc2Nyb2xsIGlubmVyIGhhcyBiZWVuIGdpdmVuIC0gdXNlIGl0ICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvLm9TY3JvbGwuc1hJbm5lcik7CgkJCQl9CgkJCQllbHNlIGlmICggaVNhbml0eVdpZHRoID09ICQoblNjcm9sbEJvZHkpLndpZHRoKCkgJiYKCQkJCSAgICQoblNjcm9sbEJvZHkpLmhlaWdodCgpIDwgJChvLm5UYWJsZSkuaGVpZ2h0KCkgKQoJCQkJewoJCQkJCS8qIFRoZXJlIGlzIHktc2Nyb2xsaW5nIC0gdHJ5IHRvIHRha2UgYWNjb3VudCBvZiB0aGUgeSBzY3JvbGwgYmFyICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCQlpZiAoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSA+IGlTYW5pdHlXaWR0aC1vLm9TY3JvbGwuaUJhcldpZHRoICkKCQkJCQl7CgkJCQkJCS8qIE5vdCBwb3NzaWJsZSB0byB0YWtlIGFjY291bnQgb2YgaXQgKi8KCQkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIEFsbCBlbHNlIGZhaWxzICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlY2FsY3VsYXRlIHRoZSBzYW5pdHkgd2lkdGggLSBub3cgdGhhdCB3ZSd2ZSBhcHBsaWVkIHRoZSByZXF1aXJlZCB3aWR0aCwgYmVmb3JlIGl0IHdhcwoJCQkgKiBhIHRlbXBvcmFyeSB2YXJpYWJsZS4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIHRoZSBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaXMgZG9uZQoJCQkgKiBiZWZvcmUgdGhpcyB0YWJsZSBET00gaXMgY3JlYXRlZC4KCQkJICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJCgkJCS8qIFdlIHdhbnQgdGhlIGhpZGRlbiBoZWFkZXIgdG8gaGF2ZSB6ZXJvIGhlaWdodCwgc28gcmVtb3ZlIHBhZGRpbmcgYW5kIGJvcmRlcnMuIFRoZW4KCQkJICogc2V0IHRoZSB3aWR0aCBiYXNlZCBvbiB0aGUgcmVhbCBoZWFkZXJzCgkJCSAqLwoJCQlhbkhlYWRUb1NpemUgPSBvLm5USGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJYW5IZWFkU2l6ZXJzID0gblRoZWFkU2l6ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJCgkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBuVG9TaXplKSB7CgkJCQlvU3R5bGUgPSBuU2l6ZXIuc3R5bGU7CgkJCQlvU3R5bGUucGFkZGluZ1RvcCA9ICIwIjsKCQkJCW9TdHlsZS5wYWRkaW5nQm90dG9tID0gIjAiOwoJCQkJb1N0eWxlLmJvcmRlclRvcFdpZHRoID0gIjAiOwoJCQkJb1N0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gIjAiOwoJCQkJb1N0eWxlLmhlaWdodCA9IDA7CgkJCQkKCQkJCWlXaWR0aCA9ICQoblNpemVyKS53aWR0aCgpOwoJCQkJblRvU2l6ZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCWFBcHBsaWVkLnB1c2goIGlXaWR0aCApOwoJCQl9LCBhbkhlYWRTaXplcnMsIGFuSGVhZFRvU2l6ZSApOwoJCQkkKGFuSGVhZFNpemVycykuaGVpZ2h0KDApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCS8qIENsb25lIHRoZSBjdXJyZW50IGZvb3RlciBhbmQgdGhlbiBwbGFjZSBpdCBpbnRvIHRoZSBib2R5IHRhYmxlIGFzIGEgImhpZGRlbiBoZWFkZXIiICovCgkJCQlhbkZvb3RTaXplcnMgPSBuVGZvb3RTaXplLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQkJYW5Gb290VG9TaXplID0gby5uVEZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCQkKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBuVG9TaXplKSB7CgkJCQkJb1N0eWxlID0gblNpemVyLnN0eWxlOwoJCQkJCW9TdHlsZS5wYWRkaW5nVG9wID0gIjAiOwoJCQkJCW9TdHlsZS5wYWRkaW5nQm90dG9tID0gIjAiOwoJCQkJCW9TdHlsZS5ib3JkZXJUb3BXaWR0aCA9ICIwIjsKCQkJCQlvU3R5bGUuYm9yZGVyQm90dG9tV2lkdGggPSAiMCI7CgkJCQkJb1N0eWxlLmhlaWdodCA9IDA7CgkJCQkJCgkJCQkJaVdpZHRoID0gJChuU2l6ZXIpLndpZHRoKCk7CgkJCQkJblRvU2l6ZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCQlhQXBwbGllZC5wdXNoKCBpV2lkdGggKTsKCQkJCX0sIGFuRm9vdFNpemVycywgYW5Gb290VG9TaXplICk7CgkJCQkkKGFuRm9vdFNpemVycykuaGVpZ2h0KDApOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiAzLiBBcHBseSB0aGUgbWVhc3VyZW1lbnRzCgkJCSAqLwoJCQkKCQkJLyogIkhpZGUiIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0aGF0IHdlIHVzZWQgZm9yIHRoZSBzaXppbmcuIFdlIHdhbnQgdG8gYWxzbyBmaXggdGhlaXIgd2lkdGgKCQkJICogdG8gd2hhdCB0aGV5IGN1cnJlbnRseSBhcmUKCQkJICovCgkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyKSB7CgkJCQluU2l6ZXIuaW5uZXJIVE1MID0gIiI7CgkJCQluU2l6ZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggYUFwcGxpZWQuc2hpZnQoKSApOwoJCQl9LCBhbkhlYWRTaXplcnMgKTsKCQkJCgkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplcikgewoJCQkJCW5TaXplci5pbm5lckhUTUwgPSAiIjsKCQkJCQluU2l6ZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggYUFwcGxpZWQuc2hpZnQoKSApOwoJCQkJfSwgYW5Gb290U2l6ZXJzICk7CgkJCX0KCQkJCgkJCS8qIFNhbml0eSBjaGVjayB0aGF0IHRoZSB0YWJsZSBpcyBvZiBhIHNlbnNpYmxlIHdpZHRoLiBJZiBub3QgdGhlbiB3ZSBhcmUgZ29pbmcgdG8gZ2V0CgkJCSAqIG1pc2FsaWdubWVudCAtIHRyeSB0byBwcmV2ZW50IHRoaXMgYnkgbm90IGFsbG93aW5nIHRoZSB0YWJsZSB0byBzaHJpbmsgYmVsb3cgaXRzIG1pbiB3aWR0aAoJCQkgKi8KCQkJaWYgKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgPCBpU2FuaXR5V2lkdGggKQoJCQl7CgkJCQkvKiBUaGUgbWluIHdpZHRoIGRlcGVuZHMgdXBvbiBpZiB3ZSBoYXZlIGEgdmVydGljYWwgc2Nyb2xsYmFyIHZpc2libGUgb3Igbm90ICovCgkJCQl2YXIgaUNvcnJlY3Rpb24gPSAoKG5TY3JvbGxCb2R5LnNjcm9sbEhlaWdodCA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikpID8KCQkJCQkJaVNhbml0eVdpZHRoK28ub1Njcm9sbC5pQmFyV2lkdGggOiBpU2FuaXR5V2lkdGg7CgkJCQkKCQkJCS8qIElFNi83IGFyZSBhIGxhdyB1bnRvIHRoZW1zZWx2ZXMuLi4gKi8KCQkJCWlmICggaWU2NyAmJiAoblNjcm9sbEJvZHkuc2Nyb2xsSGVpZ2h0ID4gCgkJCQkJblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8ICQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJCQoJCQkJLyogQXBwbHkgdGhlIGNhbGN1bGF0ZWQgbWluaW11bSB3aWR0aCB0byB0aGUgdGFibGUgd3JhcHBlcnMgKi8KCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaUNvcnJlY3Rpb24gKTsKCQkJCQoJCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJblNjcm9sbEZvb3RJbm5lci5wYXJlbnROb2RlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQl9CgkJCQkKCQkJCS8qIEFuZCBnaXZlIHRoZSB1c2VyIGEgd2FybmluZyB0aGF0IHdlJ3ZlIHN0b3BwZWQgdGhlIHRhYmxlIGdldHRpbmcgdG9vIHNtYWxsICovCgkJCQlpZiAoIG8ub1Njcm9sbC5zWCA9PT0gIiIgKQoJCQkJewoJCQkJCV9mbkxvZyggbywgMSwgIlRoZSB0YWJsZSBjYW5ub3QgZml0IGludG8gdGhlIGN1cnJlbnQgZWxlbWVudCB3aGljaCB3aWxsIGNhdXNlIGNvbHVtbiIrCgkJCQkJCSIgbWlzYWxpZ25tZW50LiBUaGUgdGFibGUgaGFzIGJlZW4gZHJhd24gYXQgaXRzIG1pbmltdW0gcG9zc2libGUgd2lkdGguIiApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG8ub1Njcm9sbC5zWElubmVyICE9PSAiIiApCgkJCQl7CgkJCQkJX2ZuTG9nKCBvLCAxLCAiVGhlIHRhYmxlIGNhbm5vdCBmaXQgaW50byB0aGUgY3VycmVudCBlbGVtZW50IHdoaWNoIHdpbGwgY2F1c2UgY29sdW1uIisKCQkJCQkJIiBtaXNhbGlnbm1lbnQuIEluY3JlYXNlIHRoZSBzU2Nyb2xsWElubmVyIHZhbHVlIG9yIHJlbW92ZSBpdCB0byBhbGxvdyBhdXRvbWF0aWMiKwoJCQkJCQkiIGNhbGN1bGF0aW9uIiApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290SW5uZXIucGFyZW50Tm9kZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAnMTAwJScgKTsKCQkJCX0KCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIDQuIENsZWFuIHVwCgkJCSAqLwoJCQlpZiAoIG8ub1Njcm9sbC5zWSA9PT0gIiIgKQoJCQl7CgkJCQkvKiBJRTc8IHB1dHMgYSB2ZXJ0aWNhbCBzY3JvbGxiYXIgaW4gcGxhY2UgKHdoZW4gaXQgc2hvdWxkbid0IGJlKSBkdWUgdG8gc3VidHJhY3RpbmcKCQkJCSAqIHRoZSBzY3JvbGxiYXIgaGVpZ2h0IGZyb20gdGhlIHZpc2libGUgZGlzcGxheSwgcmF0aGVyIHRoYW4gYWRkaW5nIGl0IG9uLiBXZSBuZWVkIHRvCgkJCQkgKiBzZXQgdGhlIGhlaWdodCBpbiBvcmRlciB0byBzb3J0IHRoaXMuIERvbid0IHdhbnQgdG8gZG8gaXQgaW4gYW55IG90aGVyIGJyb3dzZXJzLgoJCQkJICovCgkJCQlpZiAoIGllNjcgKQoJCQkJewoJCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQrby5vU2Nyb2xsLmlCYXJXaWR0aCApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG8ub1Njcm9sbC5zWSAhPT0gIiIgJiYgby5vU2Nyb2xsLmJDb2xsYXBzZSApCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm9TY3JvbGwuc1kgKTsKCQkJCQoJCQkJdmFyIGlFeHRyYSA9IChvLm9TY3JvbGwuc1ggIT09ICIiICYmIG8ublRhYmxlLm9mZnNldFdpZHRoID4gblNjcm9sbEJvZHkub2Zmc2V0V2lkdGgpID8KCQkJCSAJby5vU2Nyb2xsLmlCYXJXaWR0aCA6IDA7CgkJCQlpZiAoIG8ublRhYmxlLm9mZnNldEhlaWdodCA8IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCApCgkJCQl7CgkJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoICQoby5uVGFibGUpLmhlaWdodCgpK2lFeHRyYSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBGaW5hbGx5IHNldCB0aGUgd2lkdGgncyBvZiB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdGFibGVzICovCgkJCXZhciBpT3V0ZXJXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJblNjcm9sbEhlYWRUYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQluU2Nyb2xsSGVhZElubmVyLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRXaWR0aCApOwoJCQl9CgkJCQoJCQkvKiBJZiBzb3J0aW5nIG9yIGZpbHRlcmluZyBoYXMgb2NjdXJyZWQsIGp1bXAgdGhlIHNjcm9sbGluZyBiYWNrIHRvIHRoZSB0b3AgKi8KCQkJaWYgKCBvLmJTb3J0ZWQgfHwgby5iRmlsdGVyZWQgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zY3JvbGxUb3AgPSAwOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFwcGx5IGEgZ2l2ZW4gZnVuY3Rpb24gdG8gdGhlIGRpc3BsYXkgY2hpbGQgbm9kZXMgb2YgYW4gZWxlbWVudCBhcnJheSAodHlwaWNhbGx5CgkJICogVEQgY2hpbGRyZW4gb2YgVFIgcm93cwoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBmbiBNZXRob2QgdG8gYXBwbHkgdG8gdGhlIG9iamVjdHMKCQkgKiAgQHBhcmFtIGFycmF5IHtub2Rlc30gYW4xIExpc3Qgb2YgZWxlbWVudHMgdG8gbG9vayB0aHJvdWdoIGZvciBkaXNwbGF5IGNoaWxkcmVuCgkJICogIEBwYXJhbSBhcnJheSB7bm9kZXN9IGFuMiBBbm90aGVyIGxpc3QgKGlkZW50aWNhbCBzdHJ1Y3R1cmUgdG8gdGhlIGZpcnN0KSAtIG9wdGlvbmFsCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFwcGx5VG9DaGlsZHJlbiggZm4sIGFuMSwgYW4yICkKCQl7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YW4xLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAsIGpMZW49YW4xW2ldLmNoaWxkTm9kZXMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpZiAoIGFuMVtpXS5jaGlsZE5vZGVzW2pdLm5vZGVUeXBlID09IDEgKQoJCQkJCXsKCQkJCQkJaWYgKCBhbjIgKQoJCQkJCQl7CgkJCQkJCQlmbiggYW4xW2ldLmNoaWxkTm9kZXNbal0sIGFuMltpXS5jaGlsZE5vZGVzW2pdICk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlmbiggYW4xW2ldLmNoaWxkTm9kZXNbal0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBDb252ZXJ0IGEgQ1NTIHVuaXQgd2lkdGggdG8gcGl4ZWxzIChlLmcuIDJlbSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNXaWR0aCB3aWR0aCB0byBiZSBjb252ZXJ0ZWQKCQkgKiAgQHBhcmFtIHtub2RlfSBuUGFyZW50IHBhcmVudCB0byBnZXQgdGhlIHdpdGggZm9yIChyZXF1aXJlZCBmb3IgcmVsYXRpdmUgd2lkdGhzKSAtIG9wdGlvbmFsCgkJICogIEByZXR1cm5zIHtpbnR9IGlXaWR0aCB3aWR0aCBpbiBwaXhlbHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29udmVydFRvV2lkdGggKCBzV2lkdGgsIG5QYXJlbnQgKQoJCXsKCQkJaWYgKCAhc1dpZHRoIHx8IHNXaWR0aCA9PT0gbnVsbCB8fCBzV2lkdGggPT09ICcnICkKCQkJewoJCQkJcmV0dXJuIDA7CgkJCX0KCQkJCgkJCWlmICggIW5QYXJlbnQgKQoJCQl7CgkJCQluUGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTsKCQkJfQoJCQkKCQkJdmFyIGlXaWR0aDsKCQkJdmFyIG5UbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoJCQluVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHNXaWR0aCApOwoJCQkKCQkJblBhcmVudC5hcHBlbmRDaGlsZCggblRtcCApOwoJCQlpV2lkdGggPSBuVG1wLm9mZnNldFdpZHRoOwoJCQluUGFyZW50LnJlbW92ZUNoaWxkKCBuVG1wICk7CgkJCQoJCQlyZXR1cm4gKCBpV2lkdGggKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQ2FsY3VsYXRlIHRoZSB3aWR0aCBvZiBjb2x1bW5zIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DYWxjdWxhdGVDb2x1bW5XaWR0aHMgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGlUYWJsZVdpZHRoID0gb1NldHRpbmdzLm5UYWJsZS5vZmZzZXRXaWR0aDsKCQkJdmFyIGlVc2VySW5wdXRzID0gMDsKCQkJdmFyIGlUbXBXaWR0aDsKCQkJdmFyIGlWaXNpYmxlQ29sdW1ucyA9IDA7CgkJCXZhciBpQ29sdW1zID0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGg7CgkJCXZhciBpLCBpSW5kZXgsIGlDb3JyZWN0b3IsIGlXaWR0aDsKCQkJdmFyIG9IZWFkZXJzID0gJCgndGgnLCBvU2V0dGluZ3MublRIZWFkKTsKCQkJdmFyIHdpZHRoQXR0ciA9IG9TZXR0aW5ncy5uVGFibGUuZ2V0QXR0cmlidXRlKCd3aWR0aCcpOwoJCQkKCQkJLyogQ29udmVydCBhbnkgdXNlciBpbnB1dCBzaXplcyBpbnRvIHBpeGVsIHNpemVzICovCgkJCWZvciAoIGk9MCA7IGk8aUNvbHVtcyA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQl7CgkJCQkJaVZpc2libGVDb2x1bW5zKys7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQlpVG1wV2lkdGggPSBfZm5Db252ZXJ0VG9XaWR0aCggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGhPcmlnLCAKCQkJCQkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZSApOwoJCQkJCQlpZiAoIGlUbXBXaWR0aCAhPT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUbXBXaWR0aCApOwoJCQkJCQl9CgkJCQkJCQkKCQkJCQkJaVVzZXJJbnB1dHMrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIElmIHRoZSBudW1iZXIgb2YgY29sdW1ucyBpbiB0aGUgRE9NIGVxdWFscyB0aGUgbnVtYmVyIHRoYXQgd2UgaGF2ZSB0byBwcm9jZXNzIGluIAoJCQkgKiBEYXRhVGFibGVzLCB0aGVuIHdlIGNhbiB1c2UgdGhlIG9mZnNldHMgdGhhdCBhcmUgY3JlYXRlZCBieSB0aGUgd2ViLWJyb3dzZXIuIE5vIGN1c3RvbSAKCQkJICogc2l6ZXMgY2FuIGJlIHNldCBpbiBvcmRlciBmb3IgdGhpcyB0byBoYXBwZW4sIG5vciBzY3JvbGxpbmcgdXNlZAoJCQkgKi8KCQkJaWYgKCBpQ29sdW1zID09IG9IZWFkZXJzLmxlbmd0aCAmJiBpVXNlcklucHV0cyA9PT0gMCAmJiBpVmlzaWJsZUNvbHVtbnMgPT0gaUNvbHVtcyAmJgoJCQkJb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZID09PSAiIiApCgkJCXsKCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlUbXBXaWR0aCA9ICQob0hlYWRlcnNbaV0pLndpZHRoKCk7CgkJCQkJaWYgKCBpVG1wV2lkdGggIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRtcFdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogT3RoZXJ3aXNlIHdlIGFyZSBnb2luZyB0byBoYXZlIHRvIGRvIHNvbWUgY2FsY3VsYXRpb25zIHRvIGdldCB0aGUgd2lkdGggb2YgZWFjaCBjb2x1bW4uCgkJCQkgKiBDb25zdHJ1Y3QgYSAxIHJvdyB0YWJsZSB3aXRoIHRoZSB3aWRlc3Qgbm9kZSBpbiB0aGUgZGF0YSwgYW5kIGFueSB1c2VyIGRlZmluZWQgd2lkdGhzLAoJCQkJICogdGhlbiBpbnNlcnQgaXQgaW50byB0aGUgRE9NIGFuZCBhbGxvdyB0aGUgYnJvd3NlciB0byBkbyBhbGwgdGhlIGhhcmQgd29yayBvZgoJCQkJICogY2FsY3VsYXRpbmcgdGFibGUgd2lkdGhzLgoJCQkJICovCgkJCQl2YXIKCQkJCQluQ2FsY1RtcCA9IG9TZXR0aW5ncy5uVGFibGUuY2xvbmVOb2RlKCBmYWxzZSApLAoJCQkJCW5UaGVhZENsb25lID0gb1NldHRpbmdzLm5USGVhZC5jbG9uZU5vZGUodHJ1ZSksCgkJCQkJbkJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGJvZHknICksCgkJCQkJblRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RyJyApLAoJCQkJCW5EaXZTaXppbmc7CgkJCQkKCQkJCW5DYWxjVG1wLnJlbW92ZUF0dHJpYnV0ZSggImlkIiApOwoJCQkJbkNhbGNUbXAuYXBwZW5kQ2hpbGQoIG5UaGVhZENsb25lICk7CgkJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRGb290LmNsb25lTm9kZSh0cnVlKSApOwoJCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24obikgewoJCQkJCQluLnN0eWxlLndpZHRoID0gIiI7CgkJCQkJfSwgbkNhbGNUbXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJykgKTsKCQkJCX0KCQkJCQoJCQkJbkNhbGNUbXAuYXBwZW5kQ2hpbGQoIG5Cb2R5ICk7CgkJCQluQm9keS5hcHBlbmRDaGlsZCggblRyICk7CgkJCQkKCQkJCS8qIFJlbW92ZSBhbnkgc2l6aW5nIHRoYXQgd2FzIHByZXZpb3VzbHkgYXBwbGllZCBieSB0aGUgc3R5bGVzICovCgkJCQl2YXIganFDb2xTaXppbmcgPSAkKCd0aGVhZCB0aCcsIG5DYWxjVG1wKTsKCQkJCWlmICgganFDb2xTaXppbmcubGVuZ3RoID09PSAwICkKCQkJCXsKCQkJCQlqcUNvbFNpemluZyA9ICQoJ3Rib2R5IHRyOmVxKDApPnRkJywgbkNhbGNUbXApOwoJCQkJfQoJCQoJCQkJLyogQXBwbHkgY3VzdG9tIHNpemluZyB0byB0aGUgY2xvbmVkIGhlYWRlciAqLwoJCQkJdmFyIG5UaHMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncywgblRoZWFkQ2xvbmUgKTsKCQkJCWlDb3JyZWN0b3IgPSAwOwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJCXsKCQkJCQl2YXIgb0NvbHVtbiA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV07CgkJCQkJaWYgKCBvQ29sdW1uLmJWaXNpYmxlICYmIG9Db2x1bW4uc1dpZHRoT3JpZyAhPT0gbnVsbCAmJiBvQ29sdW1uLnNXaWR0aE9yaWcgIT09ICIiICkKCQkJCQl7CgkJCQkJCW5UaHNbaS1pQ29ycmVjdG9yXS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvQ29sdW1uLnNXaWR0aE9yaWcgKTsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIG9Db2x1bW4uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJblRoc1tpLWlDb3JyZWN0b3JdLnN0eWxlLndpZHRoID0gIiI7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCgkJCQkvKiBGaW5kIHRoZSBiaWdnZXN0IHRkIGZvciBlYWNoIGNvbHVtbiBhbmQgcHV0IGl0IGludG8gdGhlIHRhYmxlICovCgkJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bXMgOyBpKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQl2YXIgblRkID0gX2ZuR2V0V2lkZXN0Tm9kZSggb1NldHRpbmdzLCBpICk7CgkJCQkJCWlmICggblRkICE9PSBudWxsICkKCQkJCQkJewoJCQkJCQkJblRkID0gblRkLmNsb25lTm9kZSh0cnVlKTsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ29udGVudFBhZGRpbmcgIT09ICIiICkKCQkJCQkJCXsKCQkJCQkJCQluVGQuaW5uZXJIVE1MICs9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NvbnRlbnRQYWRkaW5nOwoJCQkJCQkJfQoJCQkJCQkJblRyLmFwcGVuZENoaWxkKCBuVGQgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQnVpbGQgdGhlIHRhYmxlIGFuZCAnZGlzcGxheScgaXQgKi8KCQkJCXZhciBuV3JhcHBlciA9IG9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZTsKCQkJCW5XcmFwcGVyLmFwcGVuZENoaWxkKCBuQ2FsY1RtcCApOwoJCQkJCgkJCQkvKiBXaGVuIHNjcm9sbGluZyAoWCBvciBZKSB3ZSB3YW50IHRvIHNldCB0aGUgd2lkdGggb2YgdGhlIHRhYmxlIGFzIGFwcHJvcHJpYXRlLiBIb3dldmVyLAoJCQkJICogd2hlbiBub3Qgc2Nyb2xsaW5nIGxlYXZlIHRoZSB0YWJsZSB3aWR0aCBhcyBpdCBpcy4gVGhpcyByZXN1bHRzIGluIHNsaWdodGx5IGRpZmZlcmVudCwKCQkJCSAqIGJ1dCBJIHRoaW5rIGNvcnJlY3QgYmVoYXZpb3VyCgkJCQkgKi8KCQkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNYSW5uZXIgIT09ICIiICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKG9TZXR0aW5ncy5vU2Nyb2xsLnNYSW5uZXIpOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSAiIjsKCQkJCQlpZiAoICQobkNhbGNUbXApLndpZHRoKCkgPCBuV3JhcHBlci5vZmZzZXRXaWR0aCApCgkJCQkJewoJCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBuV3JhcHBlci5vZmZzZXRXaWR0aCApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG5XcmFwcGVyLm9mZnNldFdpZHRoICk7CgkJCQl9CgkJCQllbHNlIGlmICggd2lkdGhBdHRyICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCB3aWR0aEF0dHIgKTsKCQkJCX0KCQkJCW5DYWxjVG1wLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKCQkJCQoJCQkJLyogU2Nyb2xsaW5nIGNvbnNpZGVyYXRpb25zICovCgkJCQlfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCggb1NldHRpbmdzLCBuQ2FsY1RtcCApOwoJCQkJCgkJCQkvKiBSZWFkIHRoZSB3aWR0aCdzIGNhbGN1bGF0ZWQgYnkgdGhlIGJyb3dzZXIgYW5kIHN0b3JlIHRoZW0gZm9yIHVzZSBieSB0aGUgY2FsbGVyLiBXZQoJCQkJICogZmlyc3Qgb2YgYWxsIHRyeSB0byB1c2UgdGhlIGVsZW1lbnRzIGluIHRoZSBib2R5LCBidXQgaXQgaXMgcG9zc2libGUgdGhhdCB0aGVyZSBhcmUKCQkJCSAqIG5vIGVsZW1lbnRzIHRoZXJlLCB1bmRlciB3aGljaCBjaXJjdW1zdGFuY2VzIHdlIHVzZSB0aGUgaGVhZGVyIGVsZW1lbnRzCgkJCQkgKi8KCQkJCXZhciBvTm9kZXMgPSAkKCJ0Ym9keSB0cjplcSgwKSIsIG5DYWxjVG1wKS5jaGlsZHJlbigpOwoJCQkJaWYgKCBvTm9kZXMubGVuZ3RoID09PSAwICkKCQkJCXsKCQkJCQlvTm9kZXMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncywgJCgndGhlYWQnLCBuQ2FsY1RtcClbMF0gKTsKCQkJCX0KCQkKCQkJCS8qIEJyb3dzZXJzIG5lZWQgYSBiaXQgb2YgYSBoYW5kIHdoZW4gYSB3aWR0aCBpcyBhc3NpZ25lZCB0byBhbnkgY29sdW1ucyB3aGVuIAoJCQkJICogeC1zY3JvbGxpbmcgYXMgdGhleSB0ZW5kIHRvIGNvbGxhcHNlIHRoZSB0YWJsZSB0byB0aGUgbWluLXdpZHRoLCBldmVuIGlmCgkJCQkgKiB3ZSBzZW50IHRoZSBjb2x1bW4gd2lkdGhzLiBTbyB3ZSBuZWVkIHRvIGtlZXAgdHJhY2sgb2Ygd2hhdCB0aGUgdGFibGUgd2lkdGgKCQkJCSAqIHNob3VsZCBiZSBieSBzdW1taW5nIHRoZSB1c2VyIGdpdmVuIHZhbHVlcywgYW5kIHRoZSBhdXRvbWF0aWMgdmFsdWVzCgkJCQkgKi8KCQkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICkKCQkJCXsKCQkJCQl2YXIgaVRvdGFsID0gMDsKCQkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJCXsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGhPcmlnID09PSBudWxsICkKCQkJCQkJCXsKCQkJCQkJCQlpVG90YWwgKz0gJChvTm9kZXNbaUNvcnJlY3Rvcl0pLm91dGVyV2lkdGgoKTsKCQkJCQkJCX0KCQkJCQkJCWVsc2UKCQkJCQkJCXsKCQkJCQkJCQlpVG90YWwgKz0gcGFyc2VJbnQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGgucmVwbGFjZSgncHgnLCcnKSwgMTApICsKCQkJCQkJCQkJKCQob05vZGVzW2lDb3JyZWN0b3JdKS5vdXRlcldpZHRoKCkgLSAkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkud2lkdGgoKSk7CgkJCQkJCQl9CgkJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRvdGFsICk7CgkJCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG90YWwgKTsKCQkJCX0KCQkKCQkJCWlDb3JyZWN0b3IgPSAwOwoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCWlXaWR0aCA9ICQob05vZGVzW2lDb3JyZWN0b3JdKS53aWR0aCgpOwoJCQkJCQlpZiAoIGlXaWR0aCAhPT0gbnVsbCAmJiBpV2lkdGggPiAwICkKCQkJCQkJewoJCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVdpZHRoICk7CgkJCQkJCX0KCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCX0KCQkJCX0KCQkKCQkJCXZhciBjc3NXaWR0aCA9ICQobkNhbGNUbXApLmNzcygnd2lkdGgnKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUud2lkdGggPSAoY3NzV2lkdGguaW5kZXhPZignJScpICE9PSAtMSkgPwoJCQkJICAgIGNzc1dpZHRoIDogX2ZuU3RyaW5nVG9Dc3MoICQobkNhbGNUbXApLm91dGVyV2lkdGgoKSApOwoJCQkJbkNhbGNUbXAucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggbkNhbGNUbXAgKTsKCQkJfQoJCQoJCQlpZiAoIHdpZHRoQXR0ciApCgkJCXsKCQkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggd2lkdGhBdHRyICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQWRqdXN0IGEgdGFibGUncyB3aWR0aCB0byB0YWtlIGFjY291bnQgb2Ygc2Nyb2xsaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuIHRhYmxlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QgKCBvU2V0dGluZ3MsIG4gKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCA9PT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJLyogV2hlbiB5LXNjcm9sbGluZyBvbmx5LCB3ZSB3YW50IHRvIHJlbW92ZSB0aGUgd2lkdGggb2YgdGhlIHNjcm9sbCBiYXIgc28gdGhlIHRhYmxlCgkJCQkgKiArIHNjcm9sbCBiYXIgd2lsbCBmaXQgaW50byB0aGUgYXJlYSBhdmFpYWxibGUuCgkJCQkgKi8KCQkJCXZhciBpT3JpZ1dpZHRoID0gJChuKS53aWR0aCgpOwoJCQkJbi5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG4pLm91dGVyV2lkdGgoKS1vU2V0dGluZ3Mub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICkKCQkJewoJCQkJLyogV2hlbiB4LXNjcm9sbGluZyBib3RoIHdheXMsIGZpeCB0aGUgdGFibGUgYXQgaXQncyBjdXJyZW50IHNpemUsIHdpdGhvdXQgYWRqdXN0aW5nICovCgkJCQluLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICQobikub3V0ZXJXaWR0aCgpICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSB3aWRlc3Qgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpQ29sIGNvbHVtbiBvZiBpbnRlcmVzdAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBtYXggc3RybGVucyBmb3IgZWFjaCBjb2x1bW4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0V2lkZXN0Tm9kZSggb1NldHRpbmdzLCBpQ29sICkKCQl7CgkJCXZhciBpTWF4SW5kZXggPSBfZm5HZXRNYXhMZW5TdHJpbmcoIG9TZXR0aW5ncywgaUNvbCApOwoJCQlpZiAoIGlNYXhJbmRleCA8IDAgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQoJCQlpZiAoIG9TZXR0aW5ncy5hb0RhdGFbaU1heEluZGV4XS5uVHIgPT09IG51bGwgKQoJCQl7CgkJCQl2YXIgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CgkJCQluLmlubmVySFRNTCA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlNYXhJbmRleCwgaUNvbCwgJycgKTsKCQkJCXJldHVybiBuOwoJCQl9CgkJCXJldHVybiBfZm5HZXRUZE5vZGVzKG9TZXR0aW5ncywgaU1heEluZGV4KVtpQ29sXTsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBtYXhpbXVtIHN0cmxlbiBmb3IgZWFjaCBkYXRhIGNvbHVtbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpQ29sIGNvbHVtbiBvZiBpbnRlcmVzdAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBtYXggc3RybGVucyBmb3IgZWFjaCBjb2x1bW4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0TWF4TGVuU3RyaW5nKCBvU2V0dGluZ3MsIGlDb2wgKQoJCXsKCQkJdmFyIGlNYXggPSAtMTsKCQkJdmFyIGlNYXhJbmRleCA9IC0xOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQl2YXIgcyA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGksIGlDb2wsICdkaXNwbGF5JyApKyIiOwoJCQkJcyA9IHMucmVwbGFjZSggLzwuKj8+L2csICIiICk7CgkJCQlpZiAoIHMubGVuZ3RoID4gaU1heCApCgkJCQl7CgkJCQkJaU1heCA9IHMubGVuZ3RoOwoJCQkJCWlNYXhJbmRleCA9IGk7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBpTWF4SW5kZXg7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFwcGVuZCBhIENTUyB1bml0IChvbmx5IGlmIHJlcXVpcmVkKSB0byBhIHN0cmluZwoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJyYXkxIGZpcnN0IGFycmF5CgkJICogIEBwYXJhbSB7YXJyYXl9IGFBcnJheTIgc2Vjb25kIGFycmF5CgkJICogIEByZXR1cm5zIHtpbnR9IDAgaWYgbWF0Y2gsIDEgaWYgbGVuZ3RoIGlzIGRpZmZlcmVudCwgMiBpZiBubyBtYXRjaAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TdHJpbmdUb0NzcyggcyApCgkJewoJCQlpZiAoIHMgPT09IG51bGwgKQoJCQl7CgkJCQlyZXR1cm4gIjBweCI7CgkJCX0KCQkJCgkJCWlmICggdHlwZW9mIHMgPT0gJ251bWJlcicgKQoJCQl7CgkJCQlpZiAoIHMgPCAwICkKCQkJCXsKCQkJCQlyZXR1cm4gIjBweCI7CgkJCQl9CgkJCQlyZXR1cm4gcysicHgiOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBpZiB0aGUgbGFzdCBjaGFyYWN0ZXIgaXMgbm90IDAtOSAqLwoJCQl2YXIgYyA9IHMuY2hhckNvZGVBdCggcy5sZW5ndGgtMSApOwoJCQlpZiAoYyA8IDB4MzAgfHwgYyA+IDB4MzkpCgkJCXsKCQkJCXJldHVybiBzOwoJCQl9CgkJCXJldHVybiBzKyJweCI7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgd2lkdGggb2YgYSBzY3JvbGwgYmFyIGluIHRoaXMgYnJvd3NlciBiZWluZyB1c2VkCgkJICogIEByZXR1cm5zIHtpbnR9IHdpZHRoIGluIHBpeGVscwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TY3JvbGxCYXJXaWR0aCAoKQoJCXsgIAoJCQl2YXIgaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7CgkJCXZhciBzdHlsZSA9IGlubmVyLnN0eWxlOwoJCQlzdHlsZS53aWR0aCA9ICIxMDAlIjsKCQkJc3R5bGUuaGVpZ2h0ID0gIjIwMHB4IjsKCQkJc3R5bGUucGFkZGluZyA9ICIwcHgiOwoJCQkKCQkJdmFyIG91dGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCXN0eWxlID0gb3V0ZXIuc3R5bGU7CgkJCXN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKCQkJc3R5bGUudG9wID0gIjBweCI7CgkJCXN0eWxlLmxlZnQgPSAiMHB4IjsKCQkJc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwoJCQlzdHlsZS53aWR0aCA9ICIyMDBweCI7CgkJCXN0eWxlLmhlaWdodCA9ICIxNTBweCI7CgkJCXN0eWxlLnBhZGRpbmcgPSAiMHB4IjsKCQkJc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKCQkJb3V0ZXIuYXBwZW5kQ2hpbGQoaW5uZXIpOwoJCQkKCQkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdXRlcik7CgkJCXZhciB3MSA9IGlubmVyLm9mZnNldFdpZHRoOwoJCQlvdXRlci5zdHlsZS5vdmVyZmxvdyA9ICdzY3JvbGwnOwoJCQl2YXIgdzIgPSBpbm5lci5vZmZzZXRXaWR0aDsKCQkJaWYgKCB3MSA9PSB3MiApCgkJCXsKCQkJCXcyID0gb3V0ZXIuY2xpZW50V2lkdGg7CgkJCX0KCQkJCgkJCWRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3V0ZXIpOwoJCQlyZXR1cm4gKHcxIC0gdzIpOyAgCgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIENoYW5nZSB0aGUgb3JkZXIgb2YgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtib29sfSBiQXBwbHlDbGFzc2VzIG9wdGlvbmFsIC0gc2hvdWxkIHdlIGFwcGx5IGNsYXNzZXMgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnQgKCBvU2V0dGluZ3MsIGJBcHBseUNsYXNzZXMgKQoJCXsKCQkJdmFyCgkJCQlpLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuLAoJCQkJc0RhdGFUeXBlLCBuVGgsCgkJCQlhYVNvcnQgPSBbXSwKCQkJIAlhaU9yaWcgPSBbXSwKCQkJCW9Tb3J0ID0gRGF0YVRhYmxlLmV4dC5vU29ydCwKCQkJCWFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGEsCgkJCQlhb0NvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLAoJCQkJb0FyaWEgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLm9BcmlhOwoJCQkKCQkJLyogTm8gc29ydGluZyByZXF1aXJlZCBpZiBzZXJ2ZXItc2lkZSBvciBubyBzb3J0aW5nIGFycmF5ICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgJiYgCgkJCQkob1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggIT09IDAgfHwgb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkICE9PSBudWxsKSApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkICE9PSBudWxsICkKCQkJCXsKCQkJCQlhYVNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJYWFTb3J0ID0gb1NldHRpbmdzLmFhU29ydGluZy5zbGljZSgpOwoJCQkJfQoJCQkJCgkJCQkvKiBJZiB0aGVyZSBpcyBhIHNvcnRpbmcgZGF0YSB0eXBlLCBhbmQgYSBmdWN0aW9uIGJlbG9uZ2luZyB0byBpdCwgdGhlbiB3ZSBuZWVkIHRvCgkJCQkgKiBnZXQgdGhlIGRhdGEgZnJvbSB0aGUgZGV2ZWxvcGVyJ3MgZnVuY3Rpb24gYW5kIGFwcGx5IGl0IGZvciB0aGlzIGNvbHVtbgoJCQkJICovCgkJCQlmb3IgKCBpPTAgOyBpPGFhU29ydC5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCXZhciBpQ29sdW1uID0gYWFTb3J0W2ldWzBdOwoJCQkJCXZhciBpVmlzQ29sdW1uID0gX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUoIG9TZXR0aW5ncywgaUNvbHVtbiApOwoJCQkJCXNEYXRhVHlwZSA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbIGlDb2x1bW4gXS5zU29ydERhdGFUeXBlOwoJCQkJCWlmICggRGF0YVRhYmxlLmV4dC5hZm5Tb3J0RGF0YVtzRGF0YVR5cGVdICkKCQkJCQl7CgkJCQkJCXZhciBhRGF0YSA9IERhdGFUYWJsZS5leHQuYWZuU29ydERhdGFbc0RhdGFUeXBlXSggb1NldHRpbmdzLCBpQ29sdW1uLCBpVmlzQ29sdW1uICk7CgkJCQkJCWZvciAoIGo9MCwgakxlbj1hb0RhdGEubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQkJewoJCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaiwgaUNvbHVtbiwgYURhdGFbal0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQ3JlYXRlIGEgdmFsdWUgLSBrZXkgYXJyYXkgb2YgdGhlIGN1cnJlbnQgcm93IHBvc2l0aW9ucyBzdWNoIHRoYXQgd2UgY2FuIHVzZSB0aGVpcgoJCQkJICogY3VycmVudCBwb3NpdGlvbiBkdXJpbmcgdGhlIHNvcnQsIGlmIHZhbHVlcyBtYXRjaCwgaW4gb3JkZXIgdG8gcGVyZm9ybSBzdGFibGUgc29ydGluZwoJCQkJICovCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFpT3JpZ1sgb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcltpXSBdID0gaTsKCQkJCX0KCQkKCQkJCS8qIEJ1aWxkIGFuIGludGVybmFsIGRhdGEgYXJyYXkgd2hpY2ggaXMgc3BlY2lmaWMgdG8gdGhlIHNvcnQsIHNvIHdlIGNhbiBnZXQgYW5kIHByZXAKCQkJCSAqIHRoZSBkYXRhIHRvIGJlIHNvcnRlZCBvbmx5IG9uY2UsIHJhdGhlciB0aGFuIG5lZWRpbmcgdG8gZG8gaXQgZXZlcnkgdGltZSB0aGUgc29ydGluZwoJCQkJICogZnVuY3Rpb24gcnVucy4gVGhpcyBtYWtlIHRoZSBzb3J0aW5nIGZ1bmN0aW9uIGEgdmVyeSBzaW1wbGUgY29tcGFyaXNvbgoJCQkJICovCgkJCQl2YXIgaVNvcnRMZW4gPSBhYVNvcnQubGVuZ3RoOwoJCQkJdmFyIGZuU29ydEZvcm1hdCwgYURhdGFTb3J0OwoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWZvciAoIGo9MCA7IGo8aVNvcnRMZW4gOyBqKysgKQoJCQkJCXsKCQkJCQkJYURhdGFTb3J0ID0gYW9Db2x1bW5zWyBhYVNvcnRbal1bMF0gXS5hRGF0YVNvcnQ7CgkJCgkJCQkJCWZvciAoIGs9MCwga0xlbj1hRGF0YVNvcnQubGVuZ3RoIDsgazxrTGVuIDsgaysrICkKCQkJCQkJewoJCQkJCQkJc0RhdGFUeXBlID0gYW9Db2x1bW5zWyBhRGF0YVNvcnRba10gXS5zVHlwZTsKCQkJCQkJCWZuU29ydEZvcm1hdCA9IG9Tb3J0WyAoc0RhdGFUeXBlID8gc0RhdGFUeXBlIDogJ3N0cmluZycpKyItcHJlIiBdOwoJCQkJCQkJCgkJCQkJCQlhb0RhdGFbaV0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2tdIF0gPSBmblNvcnRGb3JtYXQgPwoJCQkJCQkJCWZuU29ydEZvcm1hdCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaSwgYURhdGFTb3J0W2tdLCAnc29ydCcgKSApIDoKCQkJCQkJCQlfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBhRGF0YVNvcnRba10sICdzb3J0JyApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBEbyB0aGUgc29ydCAtIGhlcmUgd2Ugd2FudCBtdWx0aS1jb2x1bW4gc29ydGluZyBiYXNlZCBvbiBhIGdpdmVuIGRhdGEgc291cmNlIChjb2x1bW4pCgkJCQkgKiBhbmQgc29ydGluZyBmdW5jdGlvbiAoZnJvbSBvU29ydCkgaW4gYSBjZXJ0YWluIGRpcmVjdGlvbi4gSXQncyByZWFzb25hYmx5IGNvbXBsZXggdG8KCQkJCSAqIGZvbGxvdyBvbiBpdCdzIG93biwgYnV0IHRoaXMgaXMgd2hhdCB3ZSB3YW50IChleGFtcGxlIHR3byBjb2x1bW4gc29ydGluZyk6CgkJCQkgKiAgZm5Mb2NhbFNvcnRpbmcgPSBmdW5jdGlvbihhLGIpewoJCQkJICogIAl2YXIgaVRlc3Q7CgkJCQkgKiAgCWlUZXN0ID0gb1NvcnRbJ3N0cmluZy1hc2MnXSgnZGF0YTExJywgJ2RhdGExMicpOwoJCQkJICogIAlpZiAoaVRlc3QgIT09IDApCgkJCQkgKiAgCQlyZXR1cm4gaVRlc3Q7CgkJCQkgKiAgICBpVGVzdCA9IG9Tb3J0WydudW1lcmljLWRlc2MnXSgnZGF0YTIxJywgJ2RhdGEyMicpOwoJCQkJICogICAgaWYgKGlUZXN0ICE9PSAwKQoJCQkJICogIAkJcmV0dXJuIGlUZXN0OwoJCQkJICogIAlyZXR1cm4gb1NvcnRbJ251bWVyaWMtYXNjJ10oIGFpT3JpZ1thXSwgYWlPcmlnW2JdICk7CgkJCQkgKiAgfQoJCQkJICogQmFzaWNhbGx5IHdlIGhhdmUgYSB0ZXN0IGZvciBlYWNoIHNvcnRpbmcgY29sdW1uLCBpZiB0aGUgZGF0YSBpbiB0aGF0IGNvbHVtbiBpcyBlcXVhbCwKCQkJCSAqIHRlc3QgdGhlIG5leHQgY29sdW1uLiBJZiBhbGwgY29sdW1ucyBtYXRjaCwgdGhlbiB3ZSB1c2UgYSBudW1lcmljIHNvcnQgb24gdGhlIHJvdyAKCQkJCSAqIHBvc2l0aW9ucyBpbiB0aGUgb3JpZ2luYWwgZGF0YSBhcnJheSB0byBwcm92aWRlIGEgc3RhYmxlIHNvcnQuCgkJCQkgKi8KCQkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc29ydCggZnVuY3Rpb24gKCBhLCBiICkgewoJCQkJCXZhciBrLCBsLCBsTGVuLCBpVGVzdCwgYURhdGFTb3J0LCBzRGF0YVR5cGU7CgkJCQkJZm9yICggaz0wIDsgazxpU29ydExlbiA7IGsrKyApCgkJCQkJewoJCQkJCQlhRGF0YVNvcnQgPSBhb0NvbHVtbnNbIGFhU29ydFtrXVswXSBdLmFEYXRhU29ydDsKCQkKCQkJCQkJZm9yICggbD0wLCBsTGVuPWFEYXRhU29ydC5sZW5ndGggOyBsPGxMZW4gOyBsKysgKQoJCQkJCQl7CgkJCQkJCQlzRGF0YVR5cGUgPSBhb0NvbHVtbnNbIGFEYXRhU29ydFtsXSBdLnNUeXBlOwoJCQkJCQkJCgkJCQkJCQlpVGVzdCA9IG9Tb3J0WyAoc0RhdGFUeXBlID8gc0RhdGFUeXBlIDogJ3N0cmluZycpKyItIithYVNvcnRba11bMV0gXSgKCQkJCQkJCQlhb0RhdGFbYV0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2xdIF0sCgkJCQkJCQkJYW9EYXRhW2JdLl9hU29ydERhdGFbIGFEYXRhU29ydFtsXSBdCgkJCQkJCQkpOwoJCQkJCQkKCQkJCQkJCWlmICggaVRlc3QgIT09IDAgKQoJCQkJCQkJewoJCQkJCQkJCXJldHVybiBpVGVzdDsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQkKCQkJCQlyZXR1cm4gb1NvcnRbJ251bWVyaWMtYXNjJ10oIGFpT3JpZ1thXSwgYWlPcmlnW2JdICk7CgkJCQl9ICk7CgkJCX0KCQkJCgkJCS8qIEFsdGVyIHRoZSBzb3J0aW5nIGNsYXNzZXMgdG8gdGFrZSBhY2NvdW50IG9mIHRoZSBjaGFuZ2VzICovCgkJCWlmICggKGJBcHBseUNsYXNzZXMgPT09IHVuZGVmaW5lZCB8fCBiQXBwbHlDbGFzc2VzKSAmJiAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQl7CgkJCQlfZm5Tb3J0aW5nQ2xhc3Nlcyggb1NldHRpbmdzICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJblRoID0gYW9Db2x1bW5zW2ldLm5UaDsKCQkJCW5UaC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtc29ydCcpOwoJCQkJblRoLnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcpOwoJCQkJCgkJCQkvKiBJbiBBUklBIG9ubHkgdGhlIGZpcnN0IHNvcnRpbmcgY29sdW1uIGNhbiBiZSBtYXJrZWQgYXMgc29ydGluZyAtIG5vIG11bHRpLXNvcnQgb3B0aW9uICovCgkJCQlpZiAoIGFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCWlmICggYWFTb3J0Lmxlbmd0aCA+IDAgJiYgYWFTb3J0WzBdWzBdID09IGkgKQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1zb3J0JywgYWFTb3J0WzBdWzFdPT0iYXNjIiA/ICJhc2NlbmRpbmciIDogImRlc2NlbmRpbmciICk7CgkJCQkJCQoJCQkJCQl2YXIgbmV4dFNvcnQgPSAoYW9Db2x1bW5zW2ldLmFzU29ydGluZ1sgYWFTb3J0WzBdWzJdKzEgXSkgPyAKCQkJCQkJCWFvQ29sdW1uc1tpXS5hc1NvcnRpbmdbIGFhU29ydFswXVsyXSsxIF0gOiBhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWzBdOwoJCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYW9Db2x1bW5zW2ldLnNUaXRsZSsKCQkJCQkJCShuZXh0U29ydD09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGFvQ29sdW1uc1tpXS5zVGl0bGUrCgkJCQkJCQkoYW9Db2x1bW5zW2ldLmFzU29ydGluZ1swXT09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGFvQ29sdW1uc1tpXS5zVGl0bGUpOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBUZWxsIHRoZSBkcmF3IGZ1bmN0aW9uIHRoYXQgd2UgaGF2ZSBzb3J0ZWQgdGhlIGRhdGEgKi8KCQkJb1NldHRpbmdzLmJTb3J0ZWQgPSB0cnVlOwoJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoJ3NvcnQnLCBvU2V0dGluZ3MpOwoJCQkKCQkJLyogQ29weSB0aGUgbWFzdGVyIGRhdGEgaW50byB0aGUgZHJhdyBhcnJheSBhbmQgcmUtZHJhdyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCXsKCQkJCS8qIF9mbkZpbHRlcigpIHdpbGwgcmVkcmF3IHRoZSB0YWJsZSBmb3IgdXMgKi8KCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2gsIDEgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOyAvKiByZXNldCBkaXNwbGF5IGJhY2sgdG8gcGFnZSAwICovCgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQXR0YWNoIGEgc29ydCBoYW5kbGVyIChjbGljaykgdG8gYSBub2RlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuTm9kZSBub2RlIHRvIGF0dGFjaCB0aGUgaGFuZGxlciB0bwoJCSAqICBAcGFyYW0ge2ludH0gaURhdGFJbmRleCBjb2x1bW4gc29ydGluZyBpbmRleAoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBbZm5DYWxsYmFja10gY2FsbGJhY2sgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU29ydEF0dGFjaExpc3RlbmVyICggb1NldHRpbmdzLCBuTm9kZSwgaURhdGFJbmRleCwgZm5DYWxsYmFjayApCgkJewoJCQlfZm5CaW5kQWN0aW9uKCBuTm9kZSwge30sIGZ1bmN0aW9uIChlKSB7CgkJCQkvKiBJZiB0aGUgY29sdW1uIGlzIG5vdCBzb3J0YWJsZSAtIGRvbid0IHRvIGFueXRoaW5nICovCgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaURhdGFJbmRleF0uYlNvcnRhYmxlID09PSBmYWxzZSApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQkvKgoJCQkJICogVGhpcyBpcyBhIGxpdHRsZSBiaXQgb2RkIEkgYWRtaXQuLi4gSSBkZWNsYXJlIGEgdGVtcG9yYXJ5IGZ1bmN0aW9uIGluc2lkZSB0aGUgc2NvcGUgb2YKCQkJCSAqIF9mbkJ1aWxkSGVhZCBhbmQgdGhlIGNsaWNrIGhhbmRsZXIgaW4gb3JkZXIgdGhhdCB0aGUgY29kZSBwcmVzZW50ZWQgaGVyZSBjYW4gYmUgdXNlZCAKCQkJCSAqIHR3aWNlIC0gb25jZSBmb3Igd2hlbiBiUHJvY2Vzc2luZyBpcyBlbmFibGVkLCBhbmQgYW5vdGhlciB0aW1lIGZvciB3aGVuIGl0IGlzIAoJCQkJICogZGlzYWJsZWQsIGFzIHdlIG5lZWQgdG8gcGVyZm9ybSBzbGlnaHRseSBkaWZmZXJlbnQgYWN0aW9ucy4KCQkJCSAqICAgQmFzaWNhbGx5IHRoZSBpc3N1ZSBoZXJlIGlzIHRoYXQgdGhlIEphdmFzY3JpcHQgZW5naW5lIGluIG1vZGVybiBicm93c2VycyBkb24ndCAKCQkJCSAqIGFwcGVhciB0byBhbGxvdyB0aGUgcmVuZGVyaW5nIGVuZ2luZSB0byB1cGRhdGUgdGhlIGRpc3BsYXkgd2hpbGUgaXQgaXMgc3RpbGwgZXhjdXRpbmcKCQkJCSAqIGl0J3MgdGhyZWFkICh3ZWxsIC0gaXQgZG9lcyBidXQgb25seSBhZnRlciBsb25nIGludGVydmFscykuIFRoaXMgbWVhbnMgdGhhdCB0aGUgCgkJCQkgKiAncHJvY2Vzc2luZycgZGlzcGxheSBkb2Vzbid0IGFwcGVhciBmb3IgYSB0YWJsZSBzb3J0LiBUbyBicmVhayB0aGUganMgdGhyZWFkIHVwIGEgYml0CgkJCQkgKiBJIGZvcmNlIGFuIGV4ZWN1dGlvbiBicmVhayBieSB1c2luZyBzZXRUaW1lb3V0IC0gYnV0IHRoaXMgYnJlYWtzIHRoZSBleHBlY3RlZCAKCQkJCSAqIHRocmVhZCBjb250aW51YXRpb24gZm9yIHRoZSBlbmQtZGV2ZWxvcGVyJ3MgcG9pbnQgb2YgdmlldyAodGhlaXIgY29kZSB3b3VsZCBleGVjdXRlCgkJCQkgKiB0b28gZWFybHkpLCBzbyB3ZSBvbjt5IGRvIGl0IHdoZW4gd2UgYWJzb2x1dGVseSBoYXZlIHRvLgoJCQkJICovCgkJCQl2YXIgZm5Jbm5lclNvcnRpbmcgPSBmdW5jdGlvbiAoKSB7CgkJCQkJdmFyIGlDb2x1bW4sIGlOZXh0U29ydDsKCQkJCQkKCQkJCQkvKiBJZiB0aGUgc2hpZnQga2V5IGlzIHByZXNzZWQgdGhlbiB3ZSBhcmUgbXVsdGlwZSBjb2x1bW4gc29ydGluZyAqLwoJCQkJCWlmICggZS5zaGlmdEtleSApCgkJCQkJewoJCQkJCQkvKiBBcmUgd2UgYWxyZWFkeSBkb2luZyBzb21lIGtpbmQgb2Ygc29ydCBvbiB0aGlzIGNvbHVtbj8gKi8KCQkJCQkJdmFyIGJGb3VuZCA9IGZhbHNlOwoJCQkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA9PSBpRGF0YUluZGV4ICkKCQkJCQkJCXsKCQkJCQkJCQliRm91bmQgPSB0cnVlOwoJCQkJCQkJCWlDb2x1bW4gPSBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdOwoJCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0rMTsKCQkJCQkJCQkKCQkJCQkJCQlpZiAoICFvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmFzU29ydGluZ1tpTmV4dFNvcnRdICkKCQkJCQkJCQl7CgkJCQkJCQkJCS8qIFJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgc29ydGluZyBvcHRpb25zLCByZW1vdmUgZnJvbSBtdWx0aS1jb2wgc29ydCAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggaSwgMSApOwoJCQkJCQkJCX0KCQkJCQkJCQllbHNlCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBNb3ZlIG9udG8gbmV4dCBzb3J0aW5nIGRpcmVjdGlvbiAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGlOZXh0U29ydDsKCQkJCQkJCQl9CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIE5vIHNvcnQgeWV0IC0gYWRkIGl0IGluICovCgkJCQkJCWlmICggYkZvdW5kID09PSBmYWxzZSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJLyogSWYgbm8gc2hpZnQga2V5IHRoZW4gc2luZ2xlIGNvbHVtbiBzb3J0ICovCgkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggPT0gMSAmJiBvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzBdID09IGlEYXRhSW5kZXggKQoJCQkJCQl7CgkJCQkJCQlpQ29sdW1uID0gb1NldHRpbmdzLmFhU29ydGluZ1swXVswXTsKCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0rMTsKCQkJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF0gKQoJCQkJCQkJewoJCQkJCQkJCWlOZXh0U29ydCA9IDA7CgkJCQkJCQl9CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0gPSBpTmV4dFNvcnQ7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggMCwgb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggKTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJLyogUnVuIHRoZSBzb3J0ICovCgkJCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJCQl9OyAvKiAvZm5Jbm5lclNvcnRpbmcgKi8KCQkJCQoJCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCQl7CgkJCQkJZm5Jbm5lclNvcnRpbmcoKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQkJc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJCWZuSW5uZXJTb3J0aW5nKCk7CgkJCQkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJCQl7CgkJCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJCQl9CgkJCQkJfSwgMCApOwoJCQkJfQoJCQkJCgkJCQkvKiBDYWxsIHRoZSB1c2VyIHNwZWNpZmllZCBjYWxsYmFjayBmdW5jdGlvbiAtIHVzZWQgZm9yIGFzeW5jIHVzZXIgaW50ZXJhY3Rpb24gKi8KCQkJCWlmICggdHlwZW9mIGZuQ2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJyApCgkJCQl7CgkJCQkJZm5DYWxsYmFjayggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogU2V0IHRoZSBzb3J0aW5nIGNsYXNzZXMgb24gdGhlIGhlYWRlciwgTm90ZTogaXQgaXMgc2FmZSB0byBjYWxsIHRoaXMgZnVuY3Rpb24gCgkJICogd2hlbiBiU29ydCBhbmQgYlNvcnRDbGFzc2VzIGFyZSBmYWxzZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGosIGpMZW4sIGlGb3VuZDsKCQkJdmFyIGFhU29ydCwgc0NsYXNzOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkKCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zU29ydEFzYyArIiAiKyBvQ2xhc3Nlcy5zU29ydERlc2MgKwoJCQkJCQkiICIrIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzcyApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZC5jb25jYXQoIG9TZXR0aW5ncy5hYVNvcnRpbmcgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJfQoJCQkKCQkJLyogQXBwbHkgdGhlIHJlcXVpcmVkIGNsYXNzZXMgdG8gdGhlIGhlYWRlciAqLwoJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQl7CgkJCQkJc0NsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzOwoJCQkJCWlGb3VuZCA9IC0xOwoJCQkJCWZvciAoIGo9MCA7IGo8YWFTb3J0Lmxlbmd0aCA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIGFhU29ydFtqXVswXSA9PSBpICkKCQkJCQkJewoJCQkJCQkJc0NsYXNzID0gKCBhYVNvcnRbal1bMV0gPT0gImFzYyIgKSA/CgkJCQkJCQkJb0NsYXNzZXMuc1NvcnRBc2MgOiBvQ2xhc3Nlcy5zU29ydERlc2M7CgkJCQkJCQlpRm91bmQgPSBqOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIHNDbGFzcyApOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQkJCXsKCQkJCQkJLyogalF1ZXJ5IFVJIHVzZXMgZXh0cmEgbWFya3VwICovCgkJCQkJCXZhciBqcVNwYW4gPSAkKCJzcGFuLiIrb0NsYXNzZXMuc1NvcnRJY29uLCAgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpOwoJCQkJCQlqcVNwYW4ucmVtb3ZlQ2xhc3Mob0NsYXNzZXMuc1NvcnRKVUlBc2MgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlEZXNjICsiICIrIAoJCQkJCQkJb0NsYXNzZXMuc1NvcnRKVUkgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlBc2NBbGxvd2VkICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQgKTsKCQkJCQkJCgkJCQkJCXZhciBzU3BhbkNsYXNzOwoJCQkJCQlpZiAoIGlGb3VuZCA9PSAtMSApCgkJCQkJCXsKCQkJCQkJIAlzU3BhbkNsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzSlVJOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBhYVNvcnRbaUZvdW5kXVsxXSA9PSAiYXNjIiApCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSUFzYzsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSURlc2M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCWpxU3Bhbi5hZGRDbGFzcyggc1NwYW5DbGFzcyApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQkvKiBObyBzb3J0aW5nIG9uIHRoaXMgY29sdW1uLCBzbyBhZGQgdGhlIGJhc2UgY2xhc3MuIFRoaXMgd2lsbCBoYXZlIGJlZW4gYXNzaWduZWQgYnkKCQkJCQkgKiBfZm5BZGRDb2x1bW4KCQkJCQkgKi8KCQkJCQkkKG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIAoJCQkgKiBBcHBseSB0aGUgcmVxdWlyZWQgY2xhc3NlcyB0byB0aGUgdGFibGUgYm9keQoJCQkgKiBOb3RlIHRoYXQgdGhpcyBpcyBnaXZlbiBhcyBhIGZlYXR1cmUgc3dpdGNoIHNpbmNlIGl0IGNhbiBzaWduaWZpY2FudGx5IHNsb3cgZG93biBhIHNvcnQKCQkJICogb24gbGFyZ2UgZGF0YSBzZXRzIChhZGRpbmcgYW5kIHJlbW92aW5nIG9mIGNsYXNzZXMgaXMgYWx3YXlzIHNsb3cgYXQgdGhlIGJlc3Qgb2YgdGltZXMuLikKCQkJICogRnVydGhlciB0byB0aGlzLCBub3RlIHRoYXQgdGhpcyBjb2RlIGlzIGFkbWl0YWRseSBmYWlybHkgdWdseS4gSXQgY291bGQgYmUgbWFkZSBhIGxvdCAKCQkJICogc2ltcGlsZXIgdXNpbmcgalF1ZXJ5IHNlbGVjdG9ycyBhbmQgYWRkL3JlbW92ZUNsYXNzLCBidXQgdGhhdCBpcyBzaWduaWZpY2FudGx5IHNsb3dlcgoJCQkgKiAob24gdGhlIG9yZGVyIG9mIDUgdGltZXMgc2xvd2VyKSAtIGhlbmNlIHRoZSBkaXJlY3QgRE9NIG1hbmlwdWxhdGlvbiBoZXJlLgoJCQkgKiBOb3RlIHRoYXQgZm9yIGRlZmVyZWQgZHJhd2luZyB3ZSBkbyB1c2UgalF1ZXJ5IC0gdGhlIHJlYXNvbiBiZWluZyB0aGF0IHRha2luZyB0aGUgZmlyc3QKCQkJICogcm93IGZvdW5kIHRvIHNlZSBpZiB0aGUgd2hvbGUgY29sdW1uIG5lZWRzIHByb2Nlc3NlZCBjYW4gbWlzcyBjbGFzc2VzIHNpbmNlIHRoZSBmaXJzdAoJCQkgKiBjb2x1bW4gbWlnaHQgYmUgbmV3LgoJCQkgKi8KCQkJc0NsYXNzID0gb0NsYXNzZXMuc1NvcnRDb2x1bW47CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydENsYXNzZXMgKQoJCQl7CgkJCQl2YXIgblRkcyA9IF9mbkdldFRkTm9kZXMoIG9TZXR0aW5ncyApOwoJCQoJCQkJLyogUmVtb3ZlIHRoZSBvbGQgY2xhc3NlcyAqLwoJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCQl7CgkJCQkJJChuVGRzKS5yZW1vdmVDbGFzcyhzQ2xhc3MrJzEgJytzQ2xhc3MrJzIgJytzQ2xhc3MrJzMnKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBuVGRzLmxlbmd0aCA+PSBpQ29sdW1ucyApCgkJCQl7CgkJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIG5UZHNbaV0uY2xhc3NOYW1lLmluZGV4T2Yoc0NsYXNzKyIxIikgIT0gLTEgKQoJCQkJCQl7CgkJCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lID0gCgkJCQkJCQkJCSQudHJpbSggblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lLnJlcGxhY2UoIHNDbGFzcysiMSIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQllbHNlIGlmICggblRkc1tpXS5jbGFzc05hbWUuaW5kZXhPZihzQ2xhc3MrIjIiKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGo9MCwgakxlbj0oblRkcy5sZW5ndGgvaUNvbHVtbnMpIDsgajxqTGVuIDsgaisrICkKCQkJCQkJCXsKCQkJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUgPSAKCQkJCQkJCQkJJC50cmltKCBuVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUucmVwbGFjZSggc0NsYXNzKyIyIiwgIiIgKSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBuVGRzW2ldLmNsYXNzTmFtZS5pbmRleE9mKHNDbGFzcysiMyIpICE9IC0xICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPShuVGRzLmxlbmd0aC9pQ29sdW1ucykgOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCW5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZSA9IAoJCQkJCQkJCQkkLnRyaW0oIG5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZS5yZXBsYWNlKCAiICIrc0NsYXNzKyIzIiwgIiIgKSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBBZGQgdGhlIG5ldyBjbGFzc2VzIHRvIHRoZSB0YWJsZSAqLwoJCQkJdmFyIGlDbGFzcyA9IDEsIGlUYXJnZXRDb2w7CgkJCQlmb3IgKCBpPTAgOyBpPGFhU29ydC5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlUYXJnZXRDb2wgPSBwYXJzZUludCggYWFTb3J0W2ldWzBdLCAxMCApOwoJCQkJCWZvciAoIGo9MCwgakxlbj0oblRkcy5sZW5ndGgvaUNvbHVtbnMpIDsgajxqTGVuIDsgaisrICkKCQkJCQl7CgkJCQkJCW5UZHNbKGlDb2x1bW5zKmopK2lUYXJnZXRDb2xdLmNsYXNzTmFtZSArPSAiICIrc0NsYXNzK2lDbGFzczsKCQkJCQl9CgkJCQkJCgkJCQkJaWYgKCBpQ2xhc3MgPCAzICkKCQkJCQl7CgkJCQkJCWlDbGFzcysrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBTYXZlIHRoZSBzdGF0ZSBvZiBhIHRhYmxlIGluIGEgY29va2llIHN1Y2ggdGhhdCB0aGUgcGFnZSBjYW4gYmUgcmVsb2FkZWQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TYXZlU3RhdGUgKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU3RhdGVTYXZlIHx8IG9TZXR0aW5ncy5iRGVzdHJveWluZyApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQoJCQkvKiBTdG9yZSB0aGUgaW50ZXJlc3RpbmcgdmFyaWFibGVzICovCgkJCXZhciBpLCBpTGVuLCBiSW5maW5pdGU9b1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlOwoJCQl2YXIgb1N0YXRlID0gewoJCQkJImlDcmVhdGUiOiAgICAgIG5ldyBEYXRlKCkuZ2V0VGltZSgpLAoJCQkJImlTdGFydCI6ICAgICAgIChiSW5maW5pdGUgPyAwIDogb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0KSwKCQkJCSJpRW5kIjogICAgICAgICAoYkluZmluaXRlID8gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA6IG9TZXR0aW5ncy5faURpc3BsYXlFbmQpLAoJCQkJImlMZW5ndGgiOiAgICAgIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgsCgkJCQkiYWFTb3J0aW5nIjogICAgJC5leHRlbmQoIHRydWUsIFtdLCBvU2V0dGluZ3MuYWFTb3J0aW5nICksCgkJCQkib1NlYXJjaCI6ICAgICAgJC5leHRlbmQoIHRydWUsIHt9LCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICksCgkJCQkiYW9TZWFyY2hDb2xzIjogJC5leHRlbmQoIHRydWUsIFtdLCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzICksCgkJCQkiYWJWaXNDb2xzIjogICAgW10KCQkJfTsKCQkKCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb1N0YXRlLmFiVmlzQ29scy5wdXNoKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICk7CgkJCX0KCQkKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICJhb1N0YXRlU2F2ZVBhcmFtcyIsICdzdGF0ZVNhdmVQYXJhbXMnLCBbb1NldHRpbmdzLCBvU3RhdGVdICk7CgkJCQoJCQlvU2V0dGluZ3MuZm5TdGF0ZVNhdmUuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLCBvU3RhdGUgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXR0ZW1wdCB0byBsb2FkIGEgc2F2ZWQgdGFibGUgc3RhdGUgZnJvbSBhIGNvb2tpZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvSW5pdCBEYXRhVGFibGVzIGluaXQgb2JqZWN0IHNvIHdlIGNhbiBvdmVycmlkZSBzZXR0aW5ncwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Mb2FkU3RhdGUgKCBvU2V0dGluZ3MsIG9Jbml0ICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuZm5TdGF0ZUxvYWQuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzICk7CgkJCWlmICggIW9EYXRhICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBBbGxvdyBjdXN0b20gYW5kIHBsdWctaW4gbWFuaXB1bGF0aW9uIGZ1bmN0aW9ucyB0byBhbHRlciB0aGUgc2F2ZWQgZGF0YSBzZXQgYW5kCgkJCSAqIGNhbmNlbGxpbmcgb2YgbG9hZGluZyBieSByZXR1cm5pbmcgZmFsc2UKCQkJICovCgkJCXZhciBhYlN0YXRlTG9hZCA9IF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRQYXJhbXMnLCAnc3RhdGVMb2FkUGFyYW1zJywgW29TZXR0aW5ncywgb0RhdGFdICk7CgkJCWlmICggJC5pbkFycmF5KCBmYWxzZSwgYWJTdGF0ZUxvYWQgKSAhPT0gLTEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFN0b3JlIHRoZSBzYXZlZCBzdGF0ZSBzbyBpdCBtaWdodCBiZSBhY2Nlc3NlZCBhdCBhbnkgdGltZSAqLwoJCQlvU2V0dGluZ3Mub0xvYWRlZFN0YXRlID0gJC5leHRlbmQoIHRydWUsIHt9LCBvRGF0YSApOwoJCQkKCQkJLyogUmVzdG9yZSBrZXkgZmVhdHVyZXMgKi8KCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICAgID0gb0RhdGEuaVN0YXJ0OwoJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBvRGF0YS5pU3RhcnQ7CgkJCW9TZXR0aW5ncy5faURpc3BsYXlFbmQgICAgICA9IG9EYXRhLmlFbmQ7CgkJCW9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggICA9IG9EYXRhLmlMZW5ndGg7CgkJCW9TZXR0aW5ncy5hYVNvcnRpbmcgICAgICAgICA9IG9EYXRhLmFhU29ydGluZy5zbGljZSgpOwoJCQlvU2V0dGluZ3Muc2F2ZWRfYWFTb3J0aW5nICAgPSBvRGF0YS5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJCgkJCS8qIFNlYXJjaCBmaWx0ZXJpbmcgICovCgkJCSQuZXh0ZW5kKCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCBvRGF0YS5vU2VhcmNoICk7CgkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzLCBvRGF0YS5hb1NlYXJjaENvbHMgKTsKCQkJCgkJCS8qIENvbHVtbiB2aXNpYmlsaXR5IHN0YXRlCgkJCSAqIFBhc3MgYmFjayB2aXNpYmlsaXkgc2V0dGluZ3MgdG8gdGhlIGluaXQgaGFuZGxlciwgYnV0IHRvIGRvIG5vdCBoZXJlIG92ZXJyaWRlCgkJCSAqIHRoZSBpbml0IG9iamVjdCB0aGF0IHRoZSB1c2VyIG1pZ2h0IGhhdmUgcGFzc2VkIGluCgkJCSAqLwoJCQlvSW5pdC5zYXZlZF9hb0NvbHVtbnMgPSBbXTsKCQkJZm9yICggdmFyIGk9MCA7IGk8b0RhdGEuYWJWaXNDb2xzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCW9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXSA9IHt9OwoJCQkJb0luaXQuc2F2ZWRfYW9Db2x1bW5zW2ldLmJWaXNpYmxlID0gb0RhdGEuYWJWaXNDb2xzW2ldOwoJCQl9CgkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICdzdGF0ZUxvYWRlZCcsIFtvU2V0dGluZ3MsIG9EYXRhXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgY29va2llIHdpdGggYSB2YWx1ZSB0byBzdG9yZSB0aGUgc3RhdGUgb2YgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgbmFtZSBvZiB0aGUgY29va2llIHRvIGNyZWF0ZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZhbHVlIHRoZSB2YWx1ZSB0aGUgY29va2llIHNob3VsZCB0YWtlCgkJICogIEBwYXJhbSB7aW50fSBpU2VjcyBkdXJhdGlvbiBvZiB0aGUgY29va2llCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzQmFzZU5hbWUgc05hbWUgaXMgbWFkZSB1cCBvZiB0aGUgYmFzZSArIGZpbGUgbmFtZSAtIHRoaXMgaXMgdGhlIGJhc2UKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm5DYWxsYmFjayBVc2VyIGRlZmluYWJsZSBmdW5jdGlvbiB0byBtb2RpZnkgdGhlIGNvb2tpZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVDb29raWUgKCBzTmFtZSwgc1ZhbHVlLCBpU2Vjcywgc0Jhc2VOYW1lLCBmbkNhbGxiYWNrICkKCQl7CgkJCXZhciBkYXRlID0gbmV3IERhdGUoKTsKCQkJZGF0ZS5zZXRUaW1lKCBkYXRlLmdldFRpbWUoKSsoaVNlY3MqMTAwMCkgKTsKCQkJCgkJCS8qIAoJCQkgKiBTaG9ja2luZyBidXQgdHJ1ZSAtIGl0IHdvdWxkIGFwcGVhciBJRSBoYXMgbWFqb3IgaXNzdWVzIHdpdGggaGF2aW5nIHRoZSBwYXRoIG5vdCBoYXZpbmcKCQkJICogYSB0cmFpbGluZyBzbGFzaCBvbiBpdC4gV2UgbmVlZCB0aGUgY29va2llIHRvIGJlIGF2YWlsYWJsZSBiYXNlZCBvbiB0aGUgcGF0aCwgc28gd2UKCQkJICogaGF2ZSB0byBhcHBlbmQgdGhlIGZpbGUgbmFtZSB0byB0aGUgY29va2llIG5hbWUuIEFwcGFsbGluZy4gVGhhbmtzIHRvIHZleCBmb3IgYWRkaW5nIHRoZQoJCQkgKiBwYXRjaCB0byB1c2UgYXQgbGVhc3Qgc29tZSBvZiB0aGUgcGF0aAoJCQkgKi8KCQkJdmFyIGFQYXJ0cyA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpOwoJCQl2YXIgc05hbWVGaWxlID0gc05hbWUgKyAnXycgKyBhUGFydHMucG9wKCkucmVwbGFjZSgvW1wvOl0vZywiIikudG9Mb3dlckNhc2UoKTsKCQkJdmFyIHNGdWxsQ29va2llLCBvRGF0YTsKCQkJCgkJCWlmICggZm5DYWxsYmFjayAhPT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhID0gKHR5cGVvZiAkLnBhcnNlSlNPTiA9PT0gJ2Z1bmN0aW9uJykgPyAKCQkJCQkkLnBhcnNlSlNPTiggc1ZhbHVlICkgOiBldmFsKCAnKCcrc1ZhbHVlKycpJyApOwoJCQkJc0Z1bGxDb29raWUgPSBmbkNhbGxiYWNrKCBzTmFtZUZpbGUsIG9EYXRhLCBkYXRlLnRvR01UU3RyaW5nKCksCgkJCQkJYVBhcnRzLmpvaW4oJy8nKSsiLyIgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXNGdWxsQ29va2llID0gc05hbWVGaWxlICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHNWYWx1ZSkgKwoJCQkJCSI7IGV4cGlyZXM9IiArIGRhdGUudG9HTVRTdHJpbmcoKSArIjsgcGF0aD0iICsgYVBhcnRzLmpvaW4oJy8nKSsiLyI7CgkJCX0KCQkJCgkJCS8qIEFyZSB3ZSBnb2luZyB0byBnbyBvdmVyIHRoZSBjb29raWUgbGltaXQgb2YgNEtpQj8gSWYgc28sIHRyeSB0byBkZWxldGUgYSBjb29raWVzCgkJCSAqIGJlbG9uZ2luZyB0byBEYXRhVGFibGVzLiBUaGlzIGlzIEZBUiBmcm9tIGJ1bGxldCBwcm9vZgoJCQkgKi8KCQkJdmFyIHNPbGROYW1lPSIiLCBpT2xkVGltZT05OTk5OTk5OTk5OTk5OwoJCQl2YXIgaUxlbmd0aCA9IF9mblJlYWRDb29raWUoIHNOYW1lRmlsZSApIT09bnVsbCA/IGRvY3VtZW50LmNvb2tpZS5sZW5ndGggOiAKCQkJCXNGdWxsQ29va2llLmxlbmd0aCArIGRvY3VtZW50LmNvb2tpZS5sZW5ndGg7CgkJCQoJCQlpZiAoIGlMZW5ndGgrMTAgPiA0MDk2ICkgLyogTWFnaWMgMTAgZm9yIHBhZGRpbmcgKi8KCQkJewoJCQkJdmFyIGFDb29raWVzID1kb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsKCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YUNvb2tpZXMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFDb29raWVzW2ldLmluZGV4T2YoIHNCYXNlTmFtZSApICE9IC0xICkKCQkJCQl7CgkJCQkJCS8qIEl0J3MgYSBEYXRhVGFibGVzIGNvb2tpZSwgc28gZXZhbCBpdCBhbmQgY2hlY2sgdGhlIHRpbWUgc3RhbXAgKi8KCQkJCQkJdmFyIGFTcGxpdENvb2tpZSA9IGFDb29raWVzW2ldLnNwbGl0KCc9Jyk7CgkJCQkJCXRyeSB7IG9EYXRhID0gZXZhbCggJygnK2RlY29kZVVSSUNvbXBvbmVudChhU3BsaXRDb29raWVbMV0pKycpJyApOyB9CgkJCQkJCWNhdGNoKCBlICkgeyBjb250aW51ZTsgfQoJCQkJCQkKCQkJCQkJaWYgKCBvRGF0YS5pQ3JlYXRlICYmIG9EYXRhLmlDcmVhdGUgPCBpT2xkVGltZSApCgkJCQkJCXsKCQkJCQkJCXNPbGROYW1lID0gYVNwbGl0Q29va2llWzBdOwoJCQkJCQkJaU9sZFRpbWUgPSBvRGF0YS5pQ3JlYXRlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQlpZiAoIHNPbGROYW1lICE9PSAiIiApCgkJCQl7CgkJCQkJZG9jdW1lbnQuY29va2llID0gc09sZE5hbWUrIj07IGV4cGlyZXM9VGh1LCAwMS1KYW4tMTk3MCAwMDowMDowMSBHTVQ7IHBhdGg9IisKCQkJCQkJYVBhcnRzLmpvaW4oJy8nKSArICIvIjsKCQkJCX0KCQkJfQoJCQkKCQkJZG9jdW1lbnQuY29va2llID0gc0Z1bGxDb29raWU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlYWQgYW4gb2xkIGNvb2tpZSB0byBnZXQgYSBjb29raWUgd2l0aCBhbiBvbGQgdGFibGUgc3RhdGUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNOYW1lIG5hbWUgb2YgdGhlIGNvb2tpZSB0byByZWFkCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGNvbnRlbnRzIG9mIHRoZSBjb29raWUgLSBvciBudWxsIGlmIG5vIGNvb2tpZSB3aXRoIHRoYXQgbmFtZSBmb3VuZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZWFkQ29va2llICggc05hbWUgKQoJCXsKCQkJdmFyCgkJCQlhUGFydHMgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKSwKCQkJCXNOYW1lRVEgPSBzTmFtZSArICdfJyArIGFQYXJ0c1thUGFydHMubGVuZ3RoLTFdLnJlcGxhY2UoL1tcLzpdL2csIiIpLnRvTG93ZXJDYXNlKCkgKyAnPScsCgkJCSAJc0Nvb2tpZUNvbnRlbnRzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7CgkJCQoJCQlmb3IoIHZhciBpPTAgOyBpPHNDb29raWVDb250ZW50cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQl2YXIgYyA9IHNDb29raWVDb250ZW50c1tpXTsKCQkJCQoJCQkJd2hpbGUgKGMuY2hhckF0KDApPT0nICcpCgkJCQl7CgkJCQkJYyA9IGMuc3Vic3RyaW5nKDEsYy5sZW5ndGgpOwoJCQkJfQoJCQkJCgkJCQlpZiAoYy5pbmRleE9mKHNOYW1lRVEpID09PSAwKQoJCQkJewoJCQkJCXJldHVybiBkZWNvZGVVUklDb21wb25lbnQoIGMuc3Vic3RyaW5nKHNOYW1lRVEubGVuZ3RoLGMubGVuZ3RoKSApOwoJCQkJfQoJCQl9CgkJCXJldHVybiBudWxsOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gdGhlIHNldHRpbmdzIG9iamVjdCBmb3IgYSBwYXJ0aWN1bGFyIHRhYmxlCgkJICogIEBwYXJhbSB7bm9kZX0gblRhYmxlIHRhYmxlIHdlIGFyZSB1c2luZyBhcyBhIGRhdGFUYWJsZQoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBTZXR0aW5ncyBvYmplY3QgLSBvciBudWxsIGlmIG5vdCBmb3VuZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXR0aW5nc0Zyb21Ob2RlICggblRhYmxlICkKCQl7CgkJCWZvciAoIHZhciBpPTAgOyBpPERhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5uVGFibGUgPT09IG5UYWJsZSApCgkJCQl7CgkJCQkJcmV0dXJuIERhdGFUYWJsZS5zZXR0aW5nc1tpXTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiBhbiBhcnJheSB3aXRoIHRoZSBUUiBub2RlcyBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBUUiBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRUck5vZGVzICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhTm9kZXMgPSBbXTsKCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGE7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJYU5vZGVzLnB1c2goIGFvRGF0YVtpXS5uVHIgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gYU5vZGVzOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gZmxhdCBhcnJheSB3aXRoIGFsbCBURCBub2RlcyBmb3IgdGhlIHRhYmxlLCBvciByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gW2lJbmRpdmlkdWFsUm93XSBhb0RhdGEgaW5kZXggdG8gZ2V0IHRoZSBub2RlcyBmb3IgLSBvcHRpb25hbCAKCQkgKiAgICBpZiBub3QgZ2l2ZW4gdGhlbiB0aGUgcmV0dXJuIGFycmF5IHdpbGwgY29udGFpbiBhbGwgbm9kZXMgZm9yIHRoZSB0YWJsZQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IFREIGFycmF5CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFRkTm9kZXMgKCBvU2V0dGluZ3MsIGlJbmRpdmlkdWFsUm93ICkKCQl7CgkJCXZhciBhblJldHVybiA9IFtdOwoJCQl2YXIgaUNvcnJlY3RvcjsKCQkJdmFyIGFuVGRzOwoJCQl2YXIgaVJvdywgaVJvd3M9b1NldHRpbmdzLmFvRGF0YS5sZW5ndGgsCgkJCQlpQ29sdW1uLCBpQ29sdW1ucywgb0RhdGEsIHNOb2RlTmFtZSwgaVN0YXJ0PTAsIGlFbmQ9aVJvd3M7CgkJCQoJCQkvKiBBbGxvdyB0aGUgY29sbGVjdGlvbiB0byBiZSBsaW1pdGVkIHRvIGp1c3Qgb25lIHJvdyAqLwoJCQlpZiAoIGlJbmRpdmlkdWFsUm93ICE9PSB1bmRlZmluZWQgKQoJCQl7CgkJCQlpU3RhcnQgPSBpSW5kaXZpZHVhbFJvdzsKCQkJCWlFbmQgPSBpSW5kaXZpZHVhbFJvdysxOwoJCQl9CgkJCgkJCWZvciAoIGlSb3c9aVN0YXJ0IDsgaVJvdzxpRW5kIDsgaVJvdysrICkKCQkJewoJCQkJb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQkJaWYgKCBvRGF0YS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCS8qIGdldCB0aGUgVEQgY2hpbGQgbm9kZXMgLSB0YWtpbmcgaW50byBhY2NvdW50IHRleHQgZXRjIG5vZGVzICovCgkJCQkJYW5UZHMgPSBbXTsKCQkJCQlmb3IgKCBpQ29sdW1uPTAsIGlDb2x1bW5zPW9EYXRhLm5Uci5jaGlsZE5vZGVzLmxlbmd0aCA7IGlDb2x1bW48aUNvbHVtbnMgOyBpQ29sdW1uKysgKQoJCQkJCXsKCQkJCQkJc05vZGVOYW1lID0gb0RhdGEublRyLmNoaWxkTm9kZXNbaUNvbHVtbl0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJCQkJaWYgKCBzTm9kZU5hbWUgPT0gJ3RkJyB8fCBzTm9kZU5hbWUgPT0gJ3RoJyApCgkJCQkJCXsKCQkJCQkJCWFuVGRzLnB1c2goIG9EYXRhLm5Uci5jaGlsZE5vZGVzW2lDb2x1bW5dICk7CgkJCQkJCX0KCQkJCQl9CgkJCgkJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQkJZm9yICggaUNvbHVtbj0wLCBpQ29sdW1ucz1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGlDb2x1bW48aUNvbHVtbnMgOyBpQ29sdW1uKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJYW5SZXR1cm4ucHVzaCggYW5UZHNbaUNvbHVtbi1pQ29ycmVjdG9yXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJYW5SZXR1cm4ucHVzaCggb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dICk7CgkJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJcmV0dXJuIGFuUmV0dXJuOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBMb2cgYW4gZXJyb3IgbWVzc2FnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTGV2ZWwgbG9nIGVycm9yIG1lc3NhZ2VzLCBvciBkaXNwbGF5IHRoZW0gdG8gdGhlIHVzZXIKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNNZXNnIGVycm9yIG1lc3NhZ2UKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTG9nKCBvU2V0dGluZ3MsIGlMZXZlbCwgc01lc2cgKQoJCXsKCQkJdmFyIHNBbGVydCA9IChvU2V0dGluZ3M9PT1udWxsKSA/CgkJCQkiRGF0YVRhYmxlcyB3YXJuaW5nOiAiK3NNZXNnIDoKCQkJCSJEYXRhVGFibGVzIHdhcm5pbmcgKHRhYmxlIGlkID0gJyIrb1NldHRpbmdzLnNUYWJsZUlkKyInKTogIitzTWVzZzsKCQkJCgkJCWlmICggaUxldmVsID09PSAwICkKCQkJewoJCQkJaWYgKCBEYXRhVGFibGUuZXh0LnNFcnJNb2RlID09ICdhbGVydCcgKQoJCQkJewoJCQkJCWFsZXJ0KCBzQWxlcnQgKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQl0aHJvdyBzQWxlcnQ7CgkJCQl9CgkJCQlyZXR1cm47CgkJCX0KCQkJZWxzZSBpZiAoIGNvbnNvbGUgIT09IHVuZGVmaW5lZCAmJiBjb25zb2xlLmxvZyApCgkJCXsKCQkJCWNvbnNvbGUubG9nKCBzQWxlcnQgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZWUgaWYgYSBwcm9wZXJ0eSBpcyBkZWZpbmVkIG9uIG9uZSBvYmplY3QsIGlmIHNvIGFzc2lnbiBpdCB0byB0aGUgb3RoZXIgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvUmV0IHRhcmdldCBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TcmMgc291cmNlIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgcHJvcGVydHkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtzTWFwcGVkTmFtZV0gbmFtZSB0byBtYXAgdG9vIC0gb3B0aW9uYWwsIHNOYW1lIHVzZWQgaWYgbm90IGdpdmVuCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk1hcCggb1JldCwgb1NyYywgc05hbWUsIHNNYXBwZWROYW1lICkKCQl7CgkJCWlmICggc01hcHBlZE5hbWUgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXNNYXBwZWROYW1lID0gc05hbWU7CgkJCX0KCQkJaWYgKCBvU3JjW3NOYW1lXSAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJb1JldFtzTWFwcGVkTmFtZV0gPSBvU3JjW3NOYW1lXTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBFeHRlbmQgb2JqZWN0cyAtIHZlcnkgc2ltaWxhciB0byBqUXVlcnkuZXh0ZW5kLCBidXQgZGVlcCBjb3B5IG9iamVjdHMsIGFuZCBzaGFsbG93CgkJICogY29weSBhcnJheXMuIFRoZSByZWFzb24gd2UgbmVlZCB0byBkbyB0aGlzLCBpcyB0aGF0IHdlIGRvbid0IHdhbnQgdG8gZGVlcCBjb3B5IGFycmF5CgkJICogaW5pdCB2YWx1ZXMgKHN1Y2ggYXMgYWFTb3J0aW5nKSBzaW5jZSB0aGUgZGV2IHdvdWxkbid0IGJlIGFibGUgdG8gb3ZlcnJpZGUgdGhlbSwgYnV0CgkJICogd2UgZG8gd2FudCB0byBkZWVwIGNvcHkgYXJyYXlzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb091dCBPYmplY3QgdG8gZXh0ZW5kCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRXh0ZW5kZXIgT2JqZWN0IGZyb20gd2hpY2ggdGhlIHByb3BlcnRpZXMgd2lsbCBiZSBhcHBsaWVkIHRvIG9PdXQKCQkgKiAgQHJldHVybnMge29iamVjdH0gb091dCBSZWZlcmVuY2UsIGp1c3QgZm9yIGNvbnZlbmllbmNlIC0gb091dCA9PT0gdGhlIHJldHVybi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICogIEB0b2RvIFRoaXMgZG9lc24ndCB0YWtlIGFjY291bnQgb2YgYXJyYXlzIGluc2lkZSB0aGUgZGVlcCBjb3BpZWQgb2JqZWN0cy4KCQkgKi8KCQlmdW5jdGlvbiBfZm5FeHRlbmQoIG9PdXQsIG9FeHRlbmRlciApCgkJewoJCQlmb3IgKCB2YXIgcHJvcCBpbiBvT3V0ICkKCQkJewoJCQkJaWYgKCBvT3V0Lmhhc093blByb3BlcnR5KHByb3ApICYmIG9FeHRlbmRlcltwcm9wXSAhPT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlpZiAoIHR5cGVvZiBvSW5pdFtwcm9wXSA9PT0gJ29iamVjdCcgJiYgJC5pc0FycmF5KG9FeHRlbmRlcltwcm9wXSkgPT09IGZhbHNlICkKCQkJCQl7CgkJCQkJCSQuZXh0ZW5kKCB0cnVlLCBvT3V0W3Byb3BdLCBvRXh0ZW5kZXJbcHJvcF0gKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJb091dFtwcm9wXSA9IG9FeHRlbmRlcltwcm9wXTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJcmV0dXJuIG9PdXQ7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEJpbmQgYW4gZXZlbnQgaGFuZGVycyB0byBhbGxvdyBhIGNsaWNrIG9yIHJldHVybiBrZXkgdG8gYWN0aXZhdGUgdGhlIGNhbGxiYWNrLgoJCSAqIFRoaXMgaXMgZ29vZCBmb3IgYWNjZXNzYWJpbGl0eSBzaW5jZSBhIHJldHVybiBvbiB0aGUga2V5Ym9hcmQgd2lsbCBoYXZlIHRoZQoJCSAqIHNhbWUgZWZmZWN0IGFzIGEgY2xpY2ssIGlmIHRoZSBlbGVtZW50IGhhcyBmb2N1cy4KCQkgKiAgQHBhcmFtIHtlbGVtZW50fSBuIEVsZW1lbnQgdG8gYmluZCB0aGUgYWN0aW9uIHRvCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBEYXRhIG9iamVjdCB0byBwYXNzIHRvIHRoZSB0cmlnZ2VyZWQgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtmdW5jdGlvbikgZm4gQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIGV2ZW50IGlzIHRyaWdnZXJlZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CaW5kQWN0aW9uKCBuLCBvRGF0YSwgZm4gKQoJCXsKCQkJJChuKQoJCQkJLmJpbmQoICdjbGljay5EVCcsIG9EYXRhLCBmdW5jdGlvbiAoZSkgewoJCQkJCQlmbihlKTsKCQkJCQkJbi5ibHVyKCk7IC8vIFJlbW92ZSBmb2N1cyBvdXRsaW5lIGZvciBtb3VzZSB1c2VycwoJCQkJCX0gKQoJCQkJLmJpbmQoICdrZXlwcmVzcy5EVCcsIG9EYXRhLCBmdW5jdGlvbiAoZSl7CgkJCQkJaWYgKCBlLndoaWNoID09PSAxMyApIHsKCQkJCQkJZm4oZSk7CgkJCQkJfSB9ICkKCQkJCS5iaW5kKCAnc2VsZWN0c3RhcnQuRFQnLCBmdW5jdGlvbiAoKSB7CgkJCQkJLyogVGFrZSB0aGUgYnJ1dGFsIGFwcHJvYWNoIHRvIGNhbmNlbGxpbmcgdGV4dCBzZWxlY3Rpb24gKi8KCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWdpc3RlciBhIGNhbGxiYWNrIGZ1bmN0aW9uLiBFYXNpbHkgYWxsb3dzIGEgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgYWRkZWQgdG8KCQkgKiBhbiBhcnJheSBzdG9yZSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgdGhhdCBjYW4gdGhlbiBhbGwgYmUgY2FsbGVkIHRvZ2V0aGVyLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU3RvcmUgTmFtZSBvZiB0aGUgYXJyYXkgc3RvcmVhZ2UgZm9yIHRoZSBjYWxsYmFja3MgaW4gb1NldHRpbmdzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiYWNrCgkJICogIEBwYXJhbSB7c3RyaW5nKSBzTmFtZSBJZGVudGlmeWluZyBuYW1lIGZvciB0aGUgY2FsbGJhY2sgKGkuZS4gYSBsYWJlbCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgc1N0b3JlLCBmbiwgc05hbWUgKQoJCXsKCQkJaWYgKCBmbiApCgkJCXsKCQkJCW9TZXR0aW5nc1tzU3RvcmVdLnB1c2goIHsKCQkJCQkiZm4iOiBmbiwKCQkJCQkic05hbWUiOiBzTmFtZQoJCQkJfSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpcmUgY2FsbGJhY2sgZnVuY3Rpb25zIGFuZCB0cmlnZ2VyIGV2ZW50cy4gTm90ZSB0aGF0IHRoZSBsb29wIG92ZXIgdGhlIGNhbGxiYWNrCgkJICogYXJyYXkgc3RvcmUgaXMgZG9uZSBiYWNrd2FyZHMhIEZ1cnRoZXIgbm90ZSB0aGF0IHlvdSBkbyBub3Qgd2FudCB0byBmaXJlIG9mZiB0cmlnZ2VycwoJCSAqIGluIHRpbWUgc2Vuc2l0aXZlIGFwcGxpY2F0aW9ucyAoZm9yIGV4YW1wbGUgY2VsbCBjcmVhdGlvbikgYXMgaXRzIHNsb3cuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTdG9yZSBOYW1lIG9mIHRoZSBhcnJheSBzdG9yZWFnZSBmb3IgdGhlIGNhbGxiYWNrcyBpbiBvU2V0dGluZ3MKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUcmlnZ2VyIE5hbWUgb2YgdGhlIGpRdWVyeSBjdXN0b20gZXZlbnQgdG8gdHJpZ2dlci4gSWYgbnVsbCBubyB0cmlnZ2VyCgkJICogICAgaXMgZmlyZWQKCQkgKiAgQHBhcmFtIHthcnJheSkgYUFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIHBhc3MgdG8gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIC8gdHJpZ2dlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgc1N0b3JlLCBzVHJpZ2dlciwgYUFyZ3MgKQoJCXsKCQkJdmFyIGFvU3RvcmUgPSBvU2V0dGluZ3Nbc1N0b3JlXTsKCQkJdmFyIGFSZXQgPVtdOwoJCQoJCQlmb3IgKCB2YXIgaT1hb1N0b3JlLmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCWFSZXQucHVzaCggYW9TdG9yZVtpXS5mbi5hcHBseSggb1NldHRpbmdzLm9JbnN0YW5jZSwgYUFyZ3MgKSApOwoJCQl9CgkJCgkJCWlmICggc1RyaWdnZXIgIT09IG51bGwgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoc1RyaWdnZXIsIGFBcmdzKTsKCQkJfQoJCQoJCQlyZXR1cm4gYVJldDsKCQl9CgkJCgkJCgkJLyoqCgkJICogSlNPTiBzdHJpbmdpZnkuIElmIEpTT04uc3RyaW5naWZ5IGl0IHByb3ZpZGVkIGJ5IHRoZSBicm93c2VyLCBqc29uMi5qcyBvciBhbnkgb3RoZXIKCQkgKiBsaWJyYXJ5LCB0aGVuIHdlIHVzZSB0aGF0IGFzIGl0IGlzIGZhc3QsIHNhZmUgYW5kIGFjY3VyYXRlLiBJZiB0aGUgZnVuY3Rpb24gaXNuJ3QgCgkJICogYXZhaWxhYmxlIHRoZW4gd2UgbmVlZCB0byBidWlsdCBpdCBvdXJzZWx2ZXMgLSB0aGUgaW5zcGVyYXRpb24gZm9yIHRoaXMgZnVuY3Rpb24gY29tZXMKCQkgKiBmcm9tIENyYWlnIEJ1Y2tsZXIgKCBodHRwOi8vd3d3LnNpdGVwb2ludC5jb20vamF2YXNjcmlwdC1qc29uLXNlcmlhbGl6YXRpb24vICkuIEl0IGlzCgkJICogbm90IHBlcmZlY3QgYW5kIGFic29sdXRlbHkgc2hvdWxkIG5vdCBiZSB1c2VkIGFzIGEgcmVwbGFjZW1lbnQgdG8ganNvbjIuanMgLSBidXQgaXQgZG9lcwoJCSAqIGRvIHdoYXQgd2UgbmVlZCwgd2l0aG91dCByZXF1aXJpbmcgYSBkZXBlbmRlbmN5IGZvciBEYXRhVGFibGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBKU09OIG9iamVjdCB0byBiZSBjb252ZXJ0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gSlNPTiBzdHJpbmcKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJdmFyIF9mbkpzb25TdHJpbmcgPSAod2luZG93LkpTT04pID8gSlNPTi5zdHJpbmdpZnkgOiBmdW5jdGlvbiggbyApCgkJewoJCQkvKiBOb3QgYW4gb2JqZWN0IG9yIGFycmF5ICovCgkJCXZhciBzVHlwZSA9IHR5cGVvZiBvOwoJCQlpZiAoc1R5cGUgIT09ICJvYmplY3QiIHx8IG8gPT09IG51bGwpCgkJCXsKCQkJCS8vIHNpbXBsZSBkYXRhIHR5cGUKCQkJCWlmIChzVHlwZSA9PT0gInN0cmluZyIpCgkJCQl7CgkJCQkJbyA9ICciJytvKyciJzsKCQkJCX0KCQkJCXJldHVybiBvKyIiOwoJCQl9CgkJCgkJCS8qIElmIG9iamVjdCBvciBhcnJheSwgbmVlZCB0byByZWN1cnNlIG92ZXIgaXQgKi8KCQkJdmFyCgkJCQlzUHJvcCwgbVZhbHVlLAoJCQkJanNvbiA9IFtdLAoJCQkJYkFyciA9ICQuaXNBcnJheShvKTsKCQkJCgkJCWZvciAoc1Byb3AgaW4gbykKCQkJewoJCQkJbVZhbHVlID0gb1tzUHJvcF07CgkJCQlzVHlwZSA9IHR5cGVvZiBtVmFsdWU7CgkJCgkJCQlpZiAoc1R5cGUgPT09ICJzdHJpbmciKQoJCQkJewoJCQkJCW1WYWx1ZSA9ICciJyttVmFsdWUrJyInOwoJCQkJfQoJCQkJZWxzZSBpZiAoc1R5cGUgPT09ICJvYmplY3QiICYmIG1WYWx1ZSAhPT0gbnVsbCkKCQkJCXsKCQkJCQltVmFsdWUgPSBfZm5Kc29uU3RyaW5nKG1WYWx1ZSk7CgkJCQl9CgkJCgkJCQlqc29uLnB1c2goKGJBcnIgPyAiIiA6ICciJytzUHJvcCsnIjonKSArIG1WYWx1ZSk7CgkJCX0KCQkKCQkJcmV0dXJuIChiQXJyID8gIlsiIDogInsiKSArIGpzb24gKyAoYkFyciA/ICJdIiA6ICJ9Iik7CgkJfTsKCQkKCgkJCgkJCgkJLyoqCgkJICogUGVyZm9ybSBhIGpRdWVyeSBzZWxlY3RvciBhY3Rpb24gb24gdGhlIHRhYmxlJ3MgVFIgZWxlbWVudHMgKGZyb20gdGhlIHRib2R5KSBhbmQKCQkgKiByZXR1cm4gdGhlIHJlc3VsdGluZyBqUXVlcnkgb2JqZWN0LgoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gc1NlbGVjdG9yIGpRdWVyeSBzZWxlY3RvciBvciBub2RlIGNvbGxlY3Rpb24gdG8gYWN0IG9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBbb09wdHNdIE9wdGlvbmFsIHBhcmFtZXRlcnMgZm9yIG1vZGlmeWluZyB0aGUgcm93cyB0byBiZSBpbmNsdWRlZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLmZpbHRlcj1ub25lXSBTZWxlY3QgVFIgZWxlbWVudHMgdGhhdCBtZWV0IHRoZSBjdXJyZW50IGZpbHRlcgoJCSAqICAgIGNyaXRlcmlvbiAoImFwcGxpZWQiKSBvciBhbGwgVFIgZWxlbWVudHMgKGkuZS4gbm8gZmlsdGVyKS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5vcmRlcj1jdXJyZW50XSBPcmRlciBvZiB0aGUgVFIgZWxlbWVudHMgaW4gdGhlIHByb2Nlc3NlZCBhcnJheS4KCQkgKiAgICBDYW4gYmUgZWl0aGVyICdjdXJyZW50Jywgd2hlcmVieSB0aGUgY3VycmVudCBzb3J0aW5nIG9mIHRoZSB0YWJsZSBpcyB1c2VkLCBvcgoJCSAqICAgICdvcmlnaW5hbCcgd2hlcmVieSB0aGUgb3JpZ2luYWwgb3JkZXIgdGhlIGRhdGEgd2FzIHJlYWQgaW50byB0aGUgdGFibGUgaXMgdXNlZC4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5wYWdlPWFsbF0gTGltaXQgdGhlIHNlbGVjdGlvbiB0byB0aGUgY3VycmVudGx5IGRpc3BsYXllZCBwYWdlCgkJICogICAgKCJjdXJyZW50Iikgb3Igbm90ICgiYWxsIikuIElmICdjdXJyZW50JyBpcyBnaXZlbiwgdGhlbiBvcmRlciBpcyBhc3N1bWVkIHRvIGJlIAoJCSAqICAgICdjdXJyZW50JyBhbmQgZmlsdGVyIGlzICdhcHBsaWVkJywgcmVnYXJkbGVzcyBvZiB3aGF0IHRoZXkgbWlnaHQgYmUgZ2l2ZW4gYXMuCgkJICogIEByZXR1cm5zIHtvYmplY3R9IGpRdWVyeSBvYmplY3QsIGZpbHRlcmVkIGJ5IHRoZSBnaXZlbiBzZWxlY3Rvci4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gSGlnaGxpZ2h0IGV2ZXJ5IHNlY29uZCByb3cKCQkgKiAgICAgIG9UYWJsZS4kKCd0cjpvZGQnKS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICdibHVlJyk7CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gRmlsdGVyIHRvIHJvd3Mgd2l0aCAnV2Via2l0JyBpbiB0aGVtLCBhZGQgYSBiYWNrZ3JvdW5kIGNvbG91ciBhbmQgdGhlbgoJCSAqICAgICAgLy8gcmVtb3ZlIHRoZSBmaWx0ZXIsIHRodXMgaGlnaGxpZ2h0aW5nIHRoZSAnV2Via2l0JyByb3dzIG9ubHkuCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJ1dlYmtpdCcpOwoJCSAqICAgICAgb1RhYmxlLiQoJ3RyJywgeyJmaWx0ZXIiOiAiYXBwbGllZCJ9KS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICdibHVlJyk7CgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJycpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLiQgPSBmdW5jdGlvbiAoIHNTZWxlY3Rvciwgb09wdHMgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGEgPSBbXTsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCgkJCWlmICggIW9PcHRzICkKCQkJewoJCQkJb09wdHMgPSB7fTsKCQkJfQoJCQoJCQlvT3B0cyA9ICQuZXh0ZW5kKCB7fSwgewoJCQkJImZpbHRlciI6ICJub25lIiwgLy8gYXBwbGllZAoJCQkJIm9yZGVyIjogImN1cnJlbnQiLCAvLyAib3JpZ2luYWwiCgkJCQkicGFnZSI6ICJhbGwiIC8vIGN1cnJlbnQKCQkJfSwgb09wdHMgKTsKCQkKCQkJLy8gQ3VycmVudCBwYWdlIGltcGxpZXMgdGhhdCBvcmRlcj1jdXJyZW50IGFuZCBmaXRsZXI9YXBwbGllZCwgc2luY2UgaXQgaXMgZmFpcmx5CgkJCS8vIHNlbnNlbGVzcyBvdGhlcndpc2UKCQkJaWYgKCBvT3B0cy5wYWdlID09ICdjdXJyZW50JyApCgkJCXsKCQkJCWZvciAoIGk9b1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBpTGVuPW9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYS5wdXNoKCBvU2V0dGluZ3MuYW9EYXRhWyBvU2V0dGluZ3MuYWlEaXNwbGF5W2ldIF0ublRyICk7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJjdXJyZW50IiAmJiBvT3B0cy5maWx0ZXIgPT0gIm5vbmUiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhLnB1c2goIG9TZXR0aW5ncy5hb0RhdGFbIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXJbaV0gXS5uVHIgKTsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gImN1cnJlbnQiICYmIG9PcHRzLmZpbHRlciA9PSAiYXBwbGllZCIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWEucHVzaCggb1NldHRpbmdzLmFvRGF0YVsgb1NldHRpbmdzLmFpRGlzcGxheVtpXSBdLm5UciApOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAib3JpZ2luYWwiICYmIG9PcHRzLmZpbHRlciA9PSAibm9uZSIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWEucHVzaCggb1NldHRpbmdzLmFvRGF0YVsgaSBdLm5UciApOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAib3JpZ2luYWwiICYmIG9PcHRzLmZpbHRlciA9PSAiYXBwbGllZCIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggJC5pbkFycmF5KCBpLCBvU2V0dGluZ3MuYWlEaXNwbGF5ICkgIT09IC0xICkKCQkJCQl7CgkJCQkJCWEucHVzaCggb1NldHRpbmdzLmFvRGF0YVsgaSBdLm5UciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mbkxvZyggb1NldHRpbmdzLCAxLCAiVW5rbm93biBzZWxlY3Rpb24gb3B0aW9ucyIgKTsKCQkJfQoJCQoJCQkvKiBXZSBuZWVkIHRvIGZpbHRlciBvbiB0aGUgVFIgZWxlbWVudHMgYW5kIGFsc28gJ2ZpbmQnIGluIHRoZWlyIGRlc2NlbmRhbnRzCgkJCSAqIHRvIG1ha2UgdGhlIHNlbGVjdG9yIGFjdCBsaWtlIGl0IHdvdWxkIGluIGEgZnVsbCB0YWJsZSAtIHNvIHdlIG5lZWQKCQkJICogdG8gYnVpbGQgYm90aCByZXN1bHRzIGFuZCB0aGVuIGNvbWJpbmUgdGhlbSB0b2dldGhlcgoJCQkgKi8KCQkJdmFyIGpxQSA9ICQoYSk7CgkJCXZhciBqcVRScyA9IGpxQS5maWx0ZXIoIHNTZWxlY3RvciApOwoJCQl2YXIganFEZXNjZW5kYW50cyA9IGpxQS5maW5kKCBzU2VsZWN0b3IgKTsKCQkKCQkJcmV0dXJuICQoIFtdLmNvbmNhdCgkLm1ha2VBcnJheShqcVRScyksICQubWFrZUFycmF5KGpxRGVzY2VuZGFudHMpKSApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQWxtb3N0IGlkZW50aWNhbCB0byAkIGluIG9wZXJhdGlvbiwgYnV0IGluIHRoaXMgY2FzZSByZXR1cm5zIHRoZSBkYXRhIGZvciB0aGUgbWF0Y2hlZAoJCSAqIHJvd3MgLSBhcyBzdWNoLCB0aGUgalF1ZXJ5IHNlbGVjdG9yIHVzZWQgc2hvdWxkIG1hdGNoIFRSIHJvdyBub2RlcyBvciBURC9USCBjZWxsIG5vZGVzCgkJICogcmF0aGVyIHRoYW4gYW55IGRlY2VuZGVudHMsIHNvIHRoZSBkYXRhIGNhbiBiZSBvYnRhaW5lZCBmb3IgdGhlIHJvdy9jZWxsLiBJZiBtYXRjaGluZwoJCSAqIHJvd3MgYXJlIGZvdW5kLCB0aGUgZGF0YSByZXR1cm5lZCBpcyB0aGUgb3JpZ2luYWwgZGF0YSBhcnJheS9vYmplY3QgdGhhdCB3YXMgdXNlZCB0byAgCgkJICogY3JlYXRlIHRoZSByb3cgKG9yIGEgZ2VuZXJhdGVkIGFycmF5IGlmIGZyb20gYSBET00gc291cmNlKS4KCQkgKgoJCSAqIFRoaXMgbWV0aG9kIGlzIG9mdGVuIHVzZWZ1bCBpbmNvbWJpbmF0aW9uIHdpdGggJCB3aGVyZSBib3RoIGZ1bmN0aW9ucyBhcmUgZ2l2ZW4gdGhlCgkJICogc2FtZSBwYXJhbWV0ZXJzIGFuZCB0aGUgYXJyYXkgaW5kZXhlcyB3aWxsIG1hdGNoIGlkZW50aWNhbGx5LgoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gc1NlbGVjdG9yIGpRdWVyeSBzZWxlY3RvciBvciBub2RlIGNvbGxlY3Rpb24gdG8gYWN0IG9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBbb09wdHNdIE9wdGlvbmFsIHBhcmFtZXRlcnMgZm9yIG1vZGlmeWluZyB0aGUgcm93cyB0byBiZSBpbmNsdWRlZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLmZpbHRlcj1ub25lXSBTZWxlY3QgZWxlbWVudHMgdGhhdCBtZWV0IHRoZSBjdXJyZW50IGZpbHRlcgoJCSAqICAgIGNyaXRlcmlvbiAoImFwcGxpZWQiKSBvciBhbGwgZWxlbWVudHMgKGkuZS4gbm8gZmlsdGVyKS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5vcmRlcj1jdXJyZW50XSBPcmRlciBvZiB0aGUgZGF0YSBpbiB0aGUgcHJvY2Vzc2VkIGFycmF5LgoJCSAqICAgIENhbiBiZSBlaXRoZXIgJ2N1cnJlbnQnLCB3aGVyZWJ5IHRoZSBjdXJyZW50IHNvcnRpbmcgb2YgdGhlIHRhYmxlIGlzIHVzZWQsIG9yCgkJICogICAgJ29yaWdpbmFsJyB3aGVyZWJ5IHRoZSBvcmlnaW5hbCBvcmRlciB0aGUgZGF0YSB3YXMgcmVhZCBpbnRvIHRoZSB0YWJsZSBpcyB1c2VkLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLnBhZ2U9YWxsXSBMaW1pdCB0aGUgc2VsZWN0aW9uIHRvIHRoZSBjdXJyZW50bHkgZGlzcGxheWVkIHBhZ2UKCQkgKiAgICAoImN1cnJlbnQiKSBvciBub3QgKCJhbGwiKS4gSWYgJ2N1cnJlbnQnIGlzIGdpdmVuLCB0aGVuIG9yZGVyIGlzIGFzc3VtZWQgdG8gYmUgCgkJICogICAgJ2N1cnJlbnQnIGFuZCBmaWx0ZXIgaXMgJ2FwcGxpZWQnLCByZWdhcmRsZXNzIG9mIHdoYXQgdGhleSBtaWdodCBiZSBnaXZlbiBhcy4KCQkgKiAgQHJldHVybnMge2FycmF5fSBEYXRhIGZvciB0aGUgbWF0Y2hlZCBlbGVtZW50cy4gSWYgYW55IGVsZW1lbnRzLCBhcyBhIHJlc3VsdCBvZiB0aGUKCQkgKiAgICBzZWxlY3Rvciwgd2VyZSBub3QgVFIsIFREIG9yIFRIIGVsZW1lbnRzIGluIHRoZSBEYXRhVGFibGUsIHRoZXkgd2lsbCBoYXZlIGEgbnVsbCAKCQkgKiAgICBlbnRyeSBpbiB0aGUgYXJyYXkuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIC8vIEdldCB0aGUgZGF0YSBmcm9tIHRoZSBmaXJzdCByb3cgaW4gdGhlIHRhYmxlCgkJICogICAgICB2YXIgZGF0YSA9IG9UYWJsZS5fKCd0cjpmaXJzdCcpOwoJCSAqCgkJICogICAgICAvLyBEbyBzb21ldGhpbmcgdXNlZnVsIHdpdGggdGhlIGRhdGEKCQkgKiAgICAgIGFsZXJ0KCAiRmlyc3QgY2VsbCBpczogIitkYXRhWzBdICk7CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gRmlsdGVyIHRvICdXZWJraXQnIGFuZCBnZXQgYWxsIGRhdGEgZm9yIAoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCdXZWJraXQnKTsKCQkgKiAgICAgIHZhciBkYXRhID0gb1RhYmxlLl8oJ3RyJywgeyJmaWx0ZXIiOiAiYXBwbGllZCJ9KTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gRG8gc29tZXRoaW5nIHdpdGggdGhlIGRhdGEKCQkgKiAgICAgIGFsZXJ0KCBkYXRhLmxlbmd0aCsiIHJvd3MgbWF0Y2hlZCB0aGUgZmlsdGVyIiApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLl8gPSBmdW5jdGlvbiAoIHNTZWxlY3Rvciwgb09wdHMgKQoJCXsKCQkJdmFyIGFPdXQgPSBbXTsKCQkJdmFyIGksIGlMZW4sIGlJbmRleDsKCQkJdmFyIGFUcnMgPSB0aGlzLiQoIHNTZWxlY3Rvciwgb09wdHMgKTsKCQkKCQkJZm9yICggaT0wLCBpTGVuPWFUcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYU91dC5wdXNoKCB0aGlzLmZuR2V0RGF0YShhVHJzW2ldKSApOwoJCQl9CgkJCgkJCXJldHVybiBhT3V0OwoJCX07CgkJCgkJCgkJLyoqCgkJICogQWRkIGEgc2luZ2xlIG5ldyByb3cgb3IgbXVsdGlwbGUgcm93cyBvZiBkYXRhIHRvIHRoZSB0YWJsZS4gUGxlYXNlIG5vdGUKCQkgKiB0aGF0IHRoaXMgaXMgc3VpdGFibGUgZm9yIGNsaWVudC1zaWRlIHByb2Nlc3Npbmcgb25seSAtIGlmIHlvdSBhcmUgdXNpbmcgCgkJICogc2VydmVyLXNpZGUgcHJvY2Vzc2luZyAoaS5lLiAiYlNlcnZlclNpZGUiOiB0cnVlKSwgdGhlbiB0byBhZGQgZGF0YSwgeW91CgkJICogbXVzdCBhZGQgaXQgdG8gdGhlIGRhdGEgc291cmNlLCBpLmUuIHRoZSBzZXJ2ZXItc2lkZSwgdGhyb3VnaCBhbiBBamF4IGNhbGwuCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBtRGF0YSBUaGUgZGF0YSB0byBiZSBhZGRlZCB0byB0aGUgdGFibGUuIFRoaXMgY2FuIGJlOgoJCSAqICAgIDx1bD4KCQkgKiAgICAgIDxsaT4xRCBhcnJheSBvZiBkYXRhIC0gYWRkIGEgc2luZ2xlIHJvdyB3aXRoIHRoZSBkYXRhIHByb3ZpZGVkPC9saT4KCQkgKiAgICAgIDxsaT4yRCBhcnJheSBvZiBhcnJheXMgLSBhZGQgbXVsdGlwbGUgcm93cyBpbiBhIHNpbmdsZSBjYWxsPC9saT4KCQkgKiAgICAgIDxsaT5vYmplY3QgLSBkYXRhIG9iamVjdCB3aGVuIHVzaW5nIDxpPm1EYXRhUHJvcDwvaT48L2xpPgoJCSAqICAgICAgPGxpPmFycmF5IG9mIG9iamVjdHMgLSBtdWx0aXBsZSBkYXRhIG9iamVjdHMgd2hlbiB1c2luZyA8aT5tRGF0YVByb3A8L2k+PC9saT4KCQkgKiAgICA8L3VsPgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIHJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEByZXR1cm5zIHthcnJheX0gQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlcHJlc2VudGluZyB0aGUgbGlzdCBvZiBpbmRleGVzIGluIAoJCSAqICAgIDxpPmFvRGF0YTwvaT4gKHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30pIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIAoJCSAqICAgIHRoZSB0YWJsZS4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2xvYmFsIHZhciBmb3IgY291bnRlcgoJCSAqICAgIHZhciBnaUNvdW50ID0gMjsKCQkgKiAgICAKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIGZuQ2xpY2tBZGRSb3coKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpLmZuQWRkRGF0YSggWwoJCSAqICAgICAgICBnaUNvdW50KyIuMSIsCgkJICogICAgICAgIGdpQ291bnQrIi4yIiwKCQkgKiAgICAgICAgZ2lDb3VudCsiLjMiLAoJCSAqICAgICAgICBnaUNvdW50KyIuNCIgXQoJCSAqICAgICAgKTsKCQkgKiAgICAgICAgCgkJICogICAgICBnaUNvdW50Kys7CgkJICogICAgfQoJCSAqLwoJCXRoaXMuZm5BZGREYXRhID0gZnVuY3Rpb24oIG1EYXRhLCBiUmVkcmF3ICkKCQl7CgkJCWlmICggbURhdGEubGVuZ3RoID09PSAwICkKCQkJewoJCQkJcmV0dXJuIFtdOwoJCQl9CgkJCQoJCQl2YXIgYWlSZXR1cm4gPSBbXTsKCQkJdmFyIGlUZXN0OwoJCQkKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQkvKiBDaGVjayBpZiB3ZSB3YW50IHRvIGFkZCBtdWx0aXBsZSByb3dzIG9yIG5vdCAqLwoJCQlpZiAoIHR5cGVvZiBtRGF0YVswXSA9PT0gIm9iamVjdCIgJiYgbURhdGFbMF0gIT09IG51bGwgKQoJCQl7CgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxtRGF0YS5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlUZXN0ID0gX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBtRGF0YVtpXSApOwoJCQkJCWlmICggaVRlc3QgPT0gLTEgKQoJCQkJCXsKCQkJCQkJcmV0dXJuIGFpUmV0dXJuOwoJCQkJCX0KCQkJCQlhaVJldHVybi5wdXNoKCBpVGVzdCApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaVRlc3QgPSBfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG1EYXRhICk7CgkJCQlpZiAoIGlUZXN0ID09IC0xICkKCQkJCXsKCQkJCQlyZXR1cm4gYWlSZXR1cm47CgkJCQl9CgkJCQlhaVJldHVybi5wdXNoKCBpVGVzdCApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mblJlRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJcmV0dXJuIGFpUmV0dXJuOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiB3aWxsIG1ha2UgRGF0YVRhYmxlcyByZWNhbGN1bGF0ZSB0aGUgY29sdW1uIHNpemVzLCBiYXNlZCBvbiB0aGUgZGF0YSAKCQkgKiBjb250YWluZWQgaW4gdGhlIHRhYmxlIGFuZCB0aGUgc2l6ZXMgYXBwbGllZCB0byB0aGUgY29sdW1ucyAoaW4gdGhlIERPTSwgQ1NTIG9yIAoJCSAqIHRocm91Z2ggdGhlIHNXaWR0aCBwYXJhbWV0ZXIpLiBUaGlzIGNhbiBiZSB1c2VmdWwgd2hlbiB0aGUgd2lkdGggb2YgdGhlIHRhYmxlJ3MgCgkJICogcGFyZW50IGVsZW1lbnQgY2hhbmdlcyAoZm9yIGV4YW1wbGUgYSB3aW5kb3cgcmVzaXplKS4KCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdCwgeW91IHdpbGwgdHlwaWNhbGx5IHdhbnQgdG8KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIG9UYWJsZS5mbkFkanVzdENvbHVtblNpemluZygpOwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuQWRqdXN0Q29sdW1uU2l6aW5nID0gZnVuY3Rpb24gKCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdKTsKCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQl0aGlzLmZuRHJhdyggZmFsc2UgKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiIHx8IG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCS8qIElmIG5vdCByZWRyYXdpbmcsIGJ1dCBzY3JvbGxpbmcsIHdlIHdhbnQgdG8gYXBwbHkgdGhlIG5ldyBjb2x1bW4gc2l6ZXMgYW55d2F5ICovCgkJCQl0aGlzLm9BcGkuX2ZuU2Nyb2xsRHJhdyhvU2V0dGluZ3MpOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBRdWlja2x5IGFuZCBzaW1wbHkgY2xlYXIgYSB0YWJsZQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIHJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEltbWVkaWF0ZWx5ICdudWtlJyB0aGUgY3VycmVudCByb3dzIChwZXJoYXBzIHdhaXRpbmcgZm9yIGFuIEFqYXggY2FsbGJhY2suLi4pCgkJICogICAgICBvVGFibGUuZm5DbGVhclRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5DbGVhclRhYmxlID0gZnVuY3Rpb24oIGJSZWRyYXcgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCV9mbkNsZWFyVGFibGUoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGUgZXhhY3Qgb3Bwb3NpdGUgb2YgJ29wZW5pbmcnIGEgcm93LCB0aGlzIGZ1bmN0aW9uIHdpbGwgY2xvc2UgYW55IHJvd3Mgd2hpY2ggCgkJICogYXJlIGN1cnJlbnRseSAnb3BlbicuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIHRoZSB0YWJsZSByb3cgdG8gJ2Nsb3NlJwoJCSAqICBAcmV0dXJucyB7aW50fSAwIG9uIHN1Y2Nlc3MsIG9yIDEgaWYgZmFpbGVkIChjYW4ndCBmaW5kIHRoZSByb3cpCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkNsb3NlID0gZnVuY3Rpb24oIG5UciApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublBhcmVudCA9PSBuVHIgKQoJCQkJewoJCQkJCXZhciBuVHJQYXJlbnQgPSBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIucGFyZW50Tm9kZTsKCQkJCQlpZiAoIG5UclBhcmVudCApCgkJCQkJewoJCQkJCQkvKiBSZW1vdmUgaXQgaWYgaXQgaXMgY3VycmVudGx5IG9uIGRpc3BsYXkgKi8KCQkJCQkJblRyUGFyZW50LnJlbW92ZUNoaWxkKCBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIgKTsKCQkJCQl9CgkJCQkJb1NldHRpbmdzLmFvT3BlblJvd3Muc3BsaWNlKCBpLCAxICk7CgkJCQkJcmV0dXJuIDA7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIDE7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBSZW1vdmUgYSByb3cgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge21peGVkfSBtVGFyZ2V0IFRoZSBpbmRleCBvZiB0aGUgcm93IGZyb20gYW9EYXRhIHRvIGJlIGRlbGV0ZWQsIG9yCgkJICogICAgdGhlIFRSIGVsZW1lbnQgeW91IHdhbnQgdG8gZGVsZXRlCgkJICogIEBwYXJhbSB7ZnVuY3Rpb258bnVsbH0gW2ZuQ2FsbEJhY2tdIENhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBUaGUgcm93IHRoYXQgd2FzIGRlbGV0ZWQKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSW1tZWRpYXRlbHkgcmVtb3ZlIHRoZSBmaXJzdCByb3cKCQkgKiAgICAgIG9UYWJsZS5mbkRlbGV0ZVJvdyggMCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRGVsZXRlUm93ID0gZnVuY3Rpb24oIG1UYXJnZXQsIGZuQ2FsbEJhY2ssIGJSZWRyYXcgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuLCBpQU9EYXRhSW5kZXg7CgkJCQoJCQlpQU9EYXRhSW5kZXggPSAodHlwZW9mIG1UYXJnZXQgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVRhcmdldCkgOiBtVGFyZ2V0OwoJCQkKCQkJLyogUmV0dXJuIHRoZSBkYXRhIGFycmF5IGZyb20gdGhpcyByb3cgKi8KCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmFvRGF0YS5zcGxpY2UoIGlBT0RhdGFJbmRleCwgMSApOwoJCQoJCQkvKiBVcGRhdGUgdGhlIF9EVF9Sb3dJbmRleCBwYXJhbWV0ZXIgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIuX0RUX1Jvd0luZGV4ID0gaTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSB0YXJnZXQgcm93IGZyb20gdGhlIHNlYXJjaCBhcnJheSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaUFPRGF0YUluZGV4LCBvU2V0dGluZ3MuYWlEaXNwbGF5ICk7CgkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2guc3BsaWNlKCBpRGlzcGxheUluZGV4LCAxICk7CgkJCQoJCQkvKiBEZWxldGUgZnJvbSB0aGUgZGlzcGxheSBhcnJheXMgKi8KCQkJX2ZuRGVsZXRlSW5kZXgoIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIsIGlBT0RhdGFJbmRleCApOwoJCQlfZm5EZWxldGVJbmRleCggb1NldHRpbmdzLmFpRGlzcGxheSwgaUFPRGF0YUluZGV4ICk7CgkJCQoJCQkvKiBJZiB0aGVyZSBpcyBhIHVzZXIgY2FsbGJhY2sgZnVuY3Rpb24gLSBjYWxsIGl0ICovCgkJCWlmICggdHlwZW9mIGZuQ2FsbEJhY2sgPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlmbkNhbGxCYWNrLmNhbGwoIHRoaXMsIG9TZXR0aW5ncywgb0RhdGEgKTsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgZm9yIGFuICdvdmVyZmxvdycgdGhleSBjYXNlIGZvciBkaXNsYXlpbmcgdGhlIHRhYmxlICovCgkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID49IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IC09IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA8IDAgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCXJldHVybiBvRGF0YTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFJlc3RvcmUgdGhlIHRhYmxlIHRvIGl0J3Mgb3JpZ2luYWwgc3RhdGUgaW4gdGhlIERPTSBieSByZW1vdmluZyBhbGwgb2YgRGF0YVRhYmxlcyAKCQkgKiBlbmhhbmNlbWVudHMsIGFsdGVyYXRpb25zIHRvIHRoZSBET00gc3RydWN0dXJlIG9mIHRoZSB0YWJsZSBhbmQgZXZlbnQgbGlzdGVuZXJzLgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiUmVtb3ZlPWZhbHNlXSBDb21wbGV0ZWx5IHJlbW92ZSB0aGUgdGFibGUgZnJvbSB0aGUgRE9NCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgLy8gVGhpcyBleGFtcGxlIGlzIGZhaXJseSBwb2ludGxlc3MgaW4gcmVhbGl0eSwgYnV0IHNob3dzIGhvdyBmbkRlc3Ryb3kgY2FuIGJlIHVzZWQKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuRGVzdHJveSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRGVzdHJveSA9IGZ1bmN0aW9uICggYlJlbW92ZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIG5PcmlnID0gb1NldHRpbmdzLm5UYWJsZVdyYXBwZXIucGFyZW50Tm9kZTsKCQkJdmFyIG5Cb2R5ID0gb1NldHRpbmdzLm5UQm9keTsKCQkJdmFyIGksIGlMZW47CgkJCgkJCWJSZW1vdmUgPSAoYlJlbW92ZT09PXVuZGVmaW5lZCkgPyBmYWxzZSA6IHRydWU7CgkJCQoJCQkvKiBGbGFnIHRvIG5vdGUgdGhhdCB0aGUgdGFibGUgaXMgY3VycmVudGx5IGJlaW5nIGRlc3Ryb3llZCAtIG5vIGFjdGlvbiBzaG91bGQgYmUgdGFrZW4gKi8KCQkJb1NldHRpbmdzLmJEZXN0cm95aW5nID0gdHJ1ZTsKCQkJCgkJCS8qIFJlc3RvcmUgaGlkZGVuIGNvbHVtbnMgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0Rlc3Ryb3lDYWxsYmFjay5sZW5ndGggOyBpPGlMZW4gOyBpKysgKSB7CgkJCQlvU2V0dGluZ3MuYW9EZXN0cm95Q2FsbGJhY2tbaV0uZm4oKTsKCQkJfQoJCQkKCQkJLyogUmVzdG9yZSBoaWRkZW4gY29sdW1ucyAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgPT09IGZhbHNlICkKCQkJCXsKCQkJCQl0aGlzLmZuU2V0Q29sdW1uVmlzKCBpLCB0cnVlICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEJsaXR6IGFsbCBEVCBldmVudHMgKi8KCQkJJChvU2V0dGluZ3MublRhYmxlV3JhcHBlcikuZmluZCgnKicpLmFuZFNlbGYoKS51bmJpbmQoJy5EVCcpOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYW4gJ2VtcHR5JyBpbmRpY2F0b3Igcm93LCByZW1vdmUgaXQgKi8KCQkJJCgndGJvZHk+dHI+dGQuJytvU2V0dGluZ3Mub0NsYXNzZXMuc1Jvd0VtcHR5LCBvU2V0dGluZ3MublRhYmxlKS5wYXJlbnQoKS5yZW1vdmUoKTsKCQkJCgkJCS8qIFdoZW4gc2Nyb2xsaW5nIHdlIGhhZCB0byBicmVhayB0aGUgdGFibGUgdXAgLSByZXN0b3JlIGl0ICovCgkJCWlmICggb1NldHRpbmdzLm5UYWJsZSAhPSBvU2V0dGluZ3MublRIZWFkLnBhcmVudE5vZGUgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmNoaWxkcmVuKCd0aGVhZCcpLnJlbW92ZSgpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5USGVhZCApOwoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgJiYgb1NldHRpbmdzLm5UYWJsZSAhPSBvU2V0dGluZ3MublRGb290LnBhcmVudE5vZGUgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmNoaWxkcmVuKCd0Zm9vdCcpLnJlbW92ZSgpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5URm9vdCApOwoJCQl9CgkJCQoJCQkvKiBSZW1vdmUgdGhlIERhdGFUYWJsZXMgZ2VuZXJhdGVkIG5vZGVzLCBldmVudHMgYW5kIGNsYXNzZXMgKi8KCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCSQob1NldHRpbmdzLm5UYWJsZVdyYXBwZXIpLnJlbW92ZSgpOwoJCQkKCQkJb1NldHRpbmdzLmFhU29ydGluZyA9IFtdOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgPSBbXTsKCQkJX2ZuU29ydGluZ0NsYXNzZXMoIG9TZXR0aW5ncyApOwoJCQkKCQkJJChfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKSkucmVtb3ZlQ2xhc3MoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMuam9pbignICcpICk7CgkJCQoJCQkkKCd0aCwgdGQnLCBvU2V0dGluZ3MublRIZWFkKS5yZW1vdmVDbGFzcyggWwoJCQkJb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZSwKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVBc2MsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlRGVzYywKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lIF0uam9pbignICcpCgkJCSk7CgkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQl7CgkJCQkkKCd0aCBzcGFuLicrb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SWNvbgoJCQkJCSsgJywgdGQgc3Bhbi4nK29TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb24sIG9TZXR0aW5ncy5uVEhlYWQpLnJlbW92ZSgpOwoJCQoJCQkJJCgndGgsIHRkJywgb1NldHRpbmdzLm5USGVhZCkuZWFjaCggZnVuY3Rpb24gKCkgewoJCQkJCXZhciBqcVdyYXBwZXIgPSAkKCdkaXYuJytvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUlXcmFwcGVyLCB0aGlzKTsKCQkJCQl2YXIga2lkcyA9IGpxV3JhcHBlci5jb250ZW50cygpOwoJCQkJCSQodGhpcykuYXBwZW5kKCBraWRzICk7CgkJCQkJanFXcmFwcGVyLnJlbW92ZSgpOwoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBBZGQgdGhlIFRSIGVsZW1lbnRzIGJhY2sgaW50byB0aGUgdGFibGUgaW4gdGhlaXIgb3JpZ2luYWwgb3JkZXIgKi8KCQkJaWYgKCAhYlJlbW92ZSAmJiBvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgKQoJCQl7CgkJCQluT3JpZy5pbnNlcnRCZWZvcmUoIG9TZXR0aW5ncy5uVGFibGUsIG9TZXR0aW5ncy5uVGFibGVSZWluc2VydEJlZm9yZSApOwoJCQl9CgkJCWVsc2UgaWYgKCAhYlJlbW92ZSApCgkJCXsKCQkJCW5PcmlnLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJbkJvZHkuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5hb0RhdGFbaV0ublRyICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlc3RvcmUgdGhlIHdpZHRoIG9mIHRoZSBvcmlnaW5hbCB0YWJsZSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCA9PT0gdHJ1ZSApCgkJCXsKCQkJICBvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3Mob1NldHRpbmdzLnNEZXN0cm95V2lkdGgpOwoJCQl9CgkJCQoJCQkvKiBJZiB0aGUgd2VyZSBvcmlnaW5hbGx5IG9kZC9ldmVuIHR5cGUgY2xhc3NlcyAtIHRoZW4gd2UgYWRkIHRoZW0gYmFjayBoZXJlLiBOb3RlCgkJCSAqIHRoaXMgaXMgbm90IGZvb2wgcHJvb2YgKGZvciBleGFtcGxlIGlmIG5vdCBhbGwgcm93cyBhcyBvZGQvZXZlbiBjbGFzc2VzIC0gYnV0IAoJCQkgKiBpdCdzIGEgZ29vZCBlZmZvcnQgd2l0aG91dCBnZXR0aW5nIGNhcnJpZWQgYXdheQoJCQkgKi8KCQkJJChuQm9keSkuY2hpbGRyZW4oJ3RyOmV2ZW4nKS5hZGRDbGFzcyggb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKTsKCQkJJChuQm9keSkuY2hpbGRyZW4oJ3RyOm9kZCcpLmFkZENsYXNzKCBvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSApOwoJCQkKCQkJLyogUmVtb3ZlIHRoZSBzZXR0aW5ncyBvYmplY3QgZnJvbSB0aGUgc2V0dGluZ3MgYXJyYXkgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXSA9PSBvU2V0dGluZ3MgKQoJCQkJewoJCQkJCURhdGFUYWJsZS5zZXR0aW5ncy5zcGxpY2UoIGksIDEgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRW5kIGl0IGFsbCAqLwoJCQlvU2V0dGluZ3MgPSBudWxsOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUmVkcmF3IHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiQ29tcGxldGU9dHJ1ZV0gUmUtZmlsdGVyIGFuZCByZXNvcnQgKGlmIGVuYWJsZWQpIHRoZSB0YWJsZSBiZWZvcmUgdGhlIGRyYXcuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFJlLWRyYXcgdGhlIHRhYmxlIC0geW91IHdvdWxkbid0IHdhbnQgdG8gZG8gaXQgaGVyZSwgYnV0IGl0J3MgYW4gZXhhbXBsZSA6LSkKCQkgKiAgICAgIG9UYWJsZS5mbkRyYXcoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkRyYXcgPSBmdW5jdGlvbiggYkNvbXBsZXRlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlpZiAoIGJDb21wbGV0ZSApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mblJlRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgaW5wdXQgYmFzZWQgb24gZGF0YQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IFN0cmluZyB0byBmaWx0ZXIgdGhlIHRhYmxlIG9uCgkJICogIEBwYXJhbSB7aW50fG51bGx9IFtpQ29sdW1uXSBDb2x1bW4gdG8gbGltaXQgZmlsdGVyaW5nIHRvCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWdleD1mYWxzZV0gVHJlYXQgYXMgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiU21hcnQ9dHJ1ZV0gUGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JTaG93R2xvYmFsPXRydWVdIFNob3cgdGhlIGlucHV0IGdsb2JhbCBmaWx0ZXIgaW4gaXQncyBpbnB1dCBib3goZXMpCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JDYXNlSW5zZW5zaXRpdmU9dHJ1ZV0gRG8gY2FzZS1pbnNlbnNpdGl2ZSBtYXRjaGluZyAodHJ1ZSkgb3Igbm90IChmYWxzZSkKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29tZXRpbWUgbGF0ZXIgLSBmaWx0ZXIuLi4KCQkgKiAgICAgIG9UYWJsZS5mbkZpbHRlciggJ3Rlc3Qgc3RyaW5nJyApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRmlsdGVyID0gZnVuY3Rpb24oIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJTaG93R2xvYmFsLCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQlpZiAoIGJSZWdleCA9PT0gdW5kZWZpbmVkIHx8IGJSZWdleCA9PT0gbnVsbCApCgkJCXsKCQkJCWJSZWdleCA9IGZhbHNlOwoJCQl9CgkJCQoJCQlpZiAoIGJTbWFydCA9PT0gdW5kZWZpbmVkIHx8IGJTbWFydCA9PT0gbnVsbCApCgkJCXsKCQkJCWJTbWFydCA9IHRydWU7CgkJCX0KCQkJCgkJCWlmICggYlNob3dHbG9iYWwgPT09IHVuZGVmaW5lZCB8fCBiU2hvd0dsb2JhbCA9PT0gbnVsbCApCgkJCXsKCQkJCWJTaG93R2xvYmFsID0gdHJ1ZTsKCQkJfQoJCQkKCQkJaWYgKCBiQ2FzZUluc2Vuc2l0aXZlID09PSB1bmRlZmluZWQgfHwgYkNhc2VJbnNlbnNpdGl2ZSA9PT0gbnVsbCApCgkJCXsKCQkJCWJDYXNlSW5zZW5zaXRpdmUgPSB0cnVlOwoJCQl9CgkJCQoJCQlpZiAoIGlDb2x1bW4gPT09IHVuZGVmaW5lZCB8fCBpQ29sdW1uID09PSBudWxsICkKCQkJewoJCQkJLyogR2xvYmFsIGZpbHRlciAqLwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgewoJCQkJCSJzU2VhcmNoIjpzSW5wdXQrIiIsCgkJCQkJImJSZWdleCI6IGJSZWdleCwKCQkJCQkiYlNtYXJ0IjogYlNtYXJ0LAoJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogYkNhc2VJbnNlbnNpdGl2ZQoJCQkJfSwgMSApOwoJCQkJCgkJCQlpZiAoIGJTaG93R2xvYmFsICYmIG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mICkKCQkJCXsKCQkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJCXsKCQkJCQkJJCgnaW5wdXQnLCBuW2ldKS52YWwoIHNJbnB1dCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFNpbmdsZSBjb2x1bW4gZmlsdGVyICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbHVtbiBdLCB7CgkJCQkJInNTZWFyY2giOiBzSW5wdXQrIiIsCgkJCQkJImJSZWdleCI6IGJSZWdleCwKCQkJCQkiYlNtYXJ0IjogYlNtYXJ0LAoJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogYkNhc2VJbnNlbnNpdGl2ZQoJCQkJfSApOwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCwgMSApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGRhdGEgZm9yIHRoZSB3aG9sZSB0YWJsZSwgYW4gaW5kaXZpZHVhbCByb3cgb3IgYW4gaW5kaXZpZHVhbCBjZWxsIGJhc2VkIG9uIHRoZSAKCQkgKiBwcm92aWRlZCBwYXJhbWV0ZXJzLgoJCSAqICBAcGFyYW0ge2ludHxub2RlfSBbbVJvd10gQSBUUiByb3cgbm9kZSwgVEQvVEggY2VsbCBub2RlIG9yIGFuIGludGVnZXIuIElmIGdpdmVuIGFzCgkJICogICAgYSBUUiBub2RlIHRoZW4gdGhlIGRhdGEgc291cmNlIGZvciB0aGUgd2hvbGUgcm93IHdpbGwgYmUgcmV0dXJuZWQuIElmIGdpdmVuIGFzIGEKCQkgKiAgICBURC9USCBjZWxsIG5vZGUgdGhlbiBpQ29sIHdpbGwgYmUgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGFuZCB0aGUgZGF0YSBmb3IgdGhlCgkJICogICAgY2VsbCByZXR1cm5lZC4gSWYgZ2l2ZW4gYXMgYW4gaW50ZWdlciwgdGhlbiB0aGlzIGlzIHRyZWF0ZWQgYXMgdGhlIGFvRGF0YSBpbnRlcm5hbAoJCSAqICAgIGRhdGEgaW5kZXggZm9yIHRoZSByb3cgKHNlZSBmbkdldFBvc2l0aW9uKSBhbmQgdGhlIGRhdGEgZm9yIHRoYXQgcm93IHVzZWQuCgkJICogIEBwYXJhbSB7aW50fSBbaUNvbF0gT3B0aW9uYWwgY29sdW1uIGluZGV4IHRoYXQgeW91IHdhbnQgdGhlIGRhdGEgb2YuCgkJICogIEByZXR1cm5zIHthcnJheXxvYmplY3R8c3RyaW5nfSBJZiBtUm93IGlzIHVuZGVmaW5lZCwgdGhlbiB0aGUgZGF0YSBmb3IgYWxsIHJvd3MgaXMKCQkgKiAgICByZXR1cm5lZC4gSWYgbVJvdyBpcyBkZWZpbmVkLCBqdXN0IGRhdGEgZm9yIHRoYXQgcm93LCBhbmQgaXMgaUNvbCBpcwoJCSAqICAgIGRlZmluZWQsIG9ubHkgZGF0YSBmb3IgdGhlIGRlc2lnbmF0ZWQgY2VsbCBpcyByZXR1cm5lZC4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUm93IGRhdGEKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIG9UYWJsZS4kKCd0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIHZhciBkYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggdGhpcyApOwoJCSAqICAgICAgICAvLyAuLi4gZG8gc29tZXRoaW5nIHdpdGggdGhlIGFycmF5IC8gb2JqZWN0IG9mIGRhdGEgZm9yIHRoZSByb3cKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBJbmRpdmlkdWFsIGNlbGwgZGF0YQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgb1RhYmxlLiQoJ3RkJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgdmFyIHNEYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggdGhpcyApOwoJCSAqICAgICAgICBhbGVydCggJ1RoZSBjZWxsIGNsaWNrZWQgb24gaGFkIHRoZSB2YWx1ZSBvZiAnK3NEYXRhICk7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXREYXRhID0gZnVuY3Rpb24oIG1Sb3csIGlDb2wgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQlpZiAoIG1Sb3cgIT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXZhciBpUm93ID0gbVJvdzsKCQkJCWlmICggdHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnICkKCQkJCXsKCQkJCQl2YXIgc05vZGUgPSBtUm93Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKHNOb2RlID09PSAidHIiICkKCQkJCQl7CgkJCQkJCWlSb3cgPSBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93KTsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIHNOb2RlID09PSAidGQiICkKCQkJCQl7CgkJCQkJCWlSb3cgPSBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93LnBhcmVudE5vZGUpOwoJCQkJCQlpQ29sID0gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaVJvdywgbVJvdyApOwoJCQkJCX0KCQkJCX0KCQkKCQkJCWlmICggaUNvbCAhPT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlyZXR1cm4gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJycgKTsKCQkJCX0KCQkJCXJldHVybiAob1NldHRpbmdzLmFvRGF0YVtpUm93XSE9PXVuZGVmaW5lZCkgPwoJCQkJCW9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhIDogbnVsbDsKCQkJfQoJCQlyZXR1cm4gX2ZuR2V0RGF0YU1hc3Rlciggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgdGhlIFRSIG5vZGVzIHRoYXQgYXJlIHVzZWQgaW4gdGhlIHRhYmxlJ3MgYm9keS4gTm90ZSB0aGF0IHlvdSB3aWxsIAoJCSAqIHR5cGljYWxseSB3YW50IHRvIHVzZSB0aGUgJyQnIEFQSSBtZXRob2QgaW4gcHJlZmVyZW5jZSB0byB0aGlzIGFzIGl0IGlzIG1vcmUgCgkJICogZmxleGlibGUuCgkJICogIEBwYXJhbSB7aW50fSBbaVJvd10gT3B0aW9uYWwgcm93IGluZGV4IGZvciB0aGUgVFIgZWxlbWVudCB5b3Ugd2FudAoJCSAqICBAcmV0dXJucyB7YXJyYXl8bm9kZX0gSWYgaVJvdyBpcyB1bmRlZmluZWQsIHJldHVybnMgYW4gYXJyYXkgb2YgYWxsIFRSIGVsZW1lbnRzCgkJICogICAgaW4gdGhlIHRhYmxlJ3MgYm9keSwgb3IgaVJvdyBpcyBkZWZpbmVkLCBqdXN0IHRoZSBUUiBlbGVtZW50IHJlcXVlc3RlZC4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gR2V0IHRoZSBub2RlcyBmcm9tIHRoZSB0YWJsZQoJCSAqICAgICAgdmFyIG5Ob2RlcyA9IG9UYWJsZS5mbkdldE5vZGVzKCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuR2V0Tm9kZXMgPSBmdW5jdGlvbiggaVJvdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggaVJvdyAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIChvU2V0dGluZ3MuYW9EYXRhW2lSb3ddIT09dW5kZWZpbmVkKSA/CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgOiBudWxsOwoJCQl9CgkJCXJldHVybiBfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgYXJyYXkgaW5kZXhlcyBvZiBhIHBhcnRpY3VsYXIgY2VsbCBmcm9tIGl0J3MgRE9NIGVsZW1lbnQKCQkgKiBhbmQgY29sdW1uIGluZGV4IGluY2x1ZGluZyBoaWRkZW4gY29sdW1ucwoJCSAqICBAcGFyYW0ge25vZGV9IG5Ob2RlIHRoaXMgY2FuIGVpdGhlciBiZSBhIFRSLCBURCBvciBUSCBpbiB0aGUgdGFibGUncyBib2R5CgkJICogIEByZXR1cm5zIHtpbnR9IElmIG5Ob2RlIGlzIGdpdmVuIGFzIGEgVFIsIHRoZW4gYSBzaW5nbGUgaW5kZXggaXMgcmV0dXJuZWQsIG9yCgkJICogICAgaWYgZ2l2ZW4gYXMgYSBjZWxsLCBhbiBhcnJheSBvZiBbcm93IGluZGV4LCBjb2x1bW4gaW5kZXggKHZpc2libGUpXSBpcyBnaXZlbi4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0ZCcpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIC8vIEdldCB0aGUgcG9zaXRpb24gb2YgdGhlIGN1cnJlbnQgZGF0YSBmcm9tIHRoZSBub2RlCgkJICogICAgICAgIHZhciBhUG9zID0gb1RhYmxlLmZuR2V0UG9zaXRpb24oIHRoaXMgKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIEdldCB0aGUgZGF0YSBhcnJheSBmb3IgdGhpcyByb3cKCQkgKiAgICAgICAgdmFyIGFEYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggYVBvc1swXSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gVXBkYXRlIHRoZSBkYXRhIGFycmF5IGFuZCByZXR1cm4gdGhlIHZhbHVlCgkJICogICAgICAgIGFEYXRhWyBhUG9zWzFdIF0gPSAnY2xpY2tlZCc7CgkJICogICAgICAgIHRoaXMuaW5uZXJIVE1MID0gJ2NsaWNrZWQnOwoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAvLyBJbml0IERhdGFUYWJsZXMKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKCBuTm9kZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIHNOb2RlTmFtZSA9IG5Ob2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk7CgkJCQoJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVFIiICkKCQkJewoJCQkJcmV0dXJuIF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG5Ob2RlKTsKCQkJfQoJCQllbHNlIGlmICggc05vZGVOYW1lID09ICJURCIgfHwgc05vZGVOYW1lID09ICJUSCIgKQoJCQl7CgkJCQl2YXIgaURhdGFJbmRleCA9IF9mbk5vZGVUb0RhdGFJbmRleCggb1NldHRpbmdzLCBuTm9kZS5wYXJlbnROb2RlICk7CgkJCQl2YXIgaUNvbHVtbkluZGV4ID0gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaURhdGFJbmRleCwgbk5vZGUgKTsKCQkJCXJldHVybiBbIGlEYXRhSW5kZXgsIF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKG9TZXR0aW5ncywgaUNvbHVtbkluZGV4ICksIGlDb2x1bW5JbmRleCBdOwoJCQl9CgkJCXJldHVybiBudWxsOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQ2hlY2sgdG8gc2VlIGlmIGEgcm93IGlzICdvcGVuJyBvciBub3QuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIHRoZSB0YWJsZSByb3cgdG8gY2hlY2sKCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhlIHJvdyBpcyBjdXJyZW50bHkgb3BlbiwgZmFsc2Ugb3RoZXJ3aXNlCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbklzT3BlbiA9IGZ1bmN0aW9uKCBuVHIgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBhb09wZW5Sb3dzID0gb1NldHRpbmdzLmFvT3BlblJvd3M7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5QYXJlbnQgPT0gblRyICkKCQkJCXsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gZmFsc2U7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgcGxhY2UgYSBuZXcgcm93IGRpcmVjdGx5IGFmdGVyIGEgcm93IHdoaWNoIGlzIGN1cnJlbnRseSAKCQkgKiBvbiBkaXNwbGF5IG9uIHRoZSBwYWdlLCB3aXRoIHRoZSBIVE1MIGNvbnRlbnRzIHRoYXQgaXMgcGFzc2VkIGludG8gdGhlIAoJCSAqIGZ1bmN0aW9uLiBUaGlzIGNhbiBiZSB1c2VkLCBmb3IgZXhhbXBsZSwgdG8gYXNrIGZvciBjb25maXJtYXRpb24gdGhhdCBhIAoJCSAqIHBhcnRpY3VsYXIgcmVjb3JkIHNob3VsZCBiZSBkZWxldGVkLgoJCSAqICBAcGFyYW0ge25vZGV9IG5UciBUaGUgdGFibGUgcm93IHRvICdvcGVuJwoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gbUh0bWwgVGhlIEhUTUwgdG8gcHV0IGludG8gdGhlIHJvdwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0NsYXNzIENsYXNzIHRvIGdpdmUgdGhlIG5ldyBURCBjZWxsCgkJICogIEByZXR1cm5zIHtub2RlfSBUaGUgcm93IG9wZW5lZC4gTm90ZSB0aGF0IGlmIHRoZSB0YWJsZSByb3cgcGFzc2VkIGluIGFzIHRoZQoJCSAqICAgIGZpcnN0IHBhcmFtZXRlciwgaXMgbm90IGZvdW5kIGluIHRoZSB0YWJsZSwgdGhpcyBtZXRob2Qgd2lsbCBzaWxlbnRseQoJCSAqICAgIHJldHVybi4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlOwoJCSAqICAgICAgCgkJICogICAgICAvLyAnb3BlbicgYW4gaW5mb3JtYXRpb24gcm93IHdoZW4gYSByb3cgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdHInKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBpZiAoIG9UYWJsZS5mbklzT3Blbih0aGlzKSApIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5DbG9zZSggdGhpcyApOwoJCSAqICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbk9wZW4oIHRoaXMsICJUZW1wb3Jhcnkgcm93IG9wZW5lZCIsICJpbmZvX3JvdyIgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuT3BlbiA9IGZ1bmN0aW9uKCBuVHIsIG1IdG1sLCBzQ2xhc3MgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCgkJCS8qIENoZWNrIHRoYXQgdGhlIHJvdyBnaXZlbiBpcyBpbiB0aGUgdGFibGUgKi8KCQkJdmFyIG5UYWJsZVJvd3MgPSBfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKTsKCQkJaWYgKCAkLmluQXJyYXkoblRyLCBuVGFibGVSb3dzKSA9PT0gLTEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIHRoZSBvbGQgb3BlbiBvbmUgaWYgdGhlcmUgaXMgb25lICovCgkJCXRoaXMuZm5DbG9zZSggblRyICk7CgkJCQoJCQl2YXIgbk5ld1JvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRyIik7CgkJCXZhciBuTmV3Q2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7CgkJCW5OZXdSb3cuYXBwZW5kQ2hpbGQoIG5OZXdDZWxsICk7CgkJCW5OZXdDZWxsLmNsYXNzTmFtZSA9IHNDbGFzczsKCQkJbk5ld0NlbGwuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQoJCQlpZiAodHlwZW9mIG1IdG1sID09PSAic3RyaW5nIikKCQkJewoJCQkJbk5ld0NlbGwuaW5uZXJIVE1MID0gbUh0bWw7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkKG5OZXdDZWxsKS5odG1sKCBtSHRtbCApOwoJCQl9CgkJCgkJCS8qIElmIHRoZSBuVHIgaXNuJ3Qgb24gdGhlIHBhZ2UgYXQgdGhlIG1vbWVudCAtIHRoZW4gd2UgZG9uJ3QgaW5zZXJ0IGF0IHRoZSBtb21lbnQgKi8KCQkJdmFyIG5UcnMgPSAkKCd0cicsIG9TZXR0aW5ncy5uVEJvZHkpOwoJCQlpZiAoICQuaW5BcnJheShuVHIsIG5UcnMpICE9IC0xICApCgkJCXsKCQkJCSQobk5ld1JvdykuaW5zZXJ0QWZ0ZXIoblRyKTsKCQkJfQoJCQkKCQkJb1NldHRpbmdzLmFvT3BlblJvd3MucHVzaCggewoJCQkJIm5UciI6IG5OZXdSb3csCgkJCQkiblBhcmVudCI6IG5UcgoJCQl9ICk7CgkJCQoJCQlyZXR1cm4gbk5ld1JvdzsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIENoYW5nZSB0aGUgcGFnaW5hdGlvbiAtIHByb3ZpZGVzIHRoZSBpbnRlcm5hbCBsb2dpYyBmb3IgcGFnaW5hdGlvbiBpbiBhIHNpbXBsZSBBUEkgCgkJICogZnVuY3Rpb24uIFdpdGggdGhpcyBmdW5jdGlvbiB5b3UgY2FuIGhhdmUgYSBEYXRhVGFibGVzIHRhYmxlIGdvIHRvIHRoZSBuZXh0LCAKCQkgKiBwcmV2aW91cywgZmlyc3Qgb3IgbGFzdCBwYWdlcy4KCQkgKiAgQHBhcmFtIHtzdHJpbmd8aW50fSBtQWN0aW9uIFBhZ2luZyBhY3Rpb24gdG8gdGFrZTogImZpcnN0IiwgInByZXZpb3VzIiwgIm5leHQiIG9yICJsYXN0IgoJCSAqICAgIG9yIHBhZ2UgbnVtYmVyIHRvIGp1bXAgdG8gKGludGVnZXIpLCBub3RlIHRoYXQgcGFnZSAwIGlzIHRoZSBmaXJzdCBwYWdlLgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5QYWdlQ2hhbmdlKCAnbmV4dCcgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblBhZ2VDaGFuZ2UgPSBmdW5jdGlvbiAoIG1BY3Rpb24sIGJSZWRyYXcgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCV9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgbUFjdGlvbiApOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBTaG93IGEgcGFydGljdWxhciBjb2x1bW4KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgVGhlIGNvbHVtbiB3aG9zZSBkaXNwbGF5IHNob3VsZCBiZSBjaGFuZ2VkCgkJICogIEBwYXJhbSB7Ym9vbH0gYlNob3cgU2hvdyAodHJ1ZSkgb3IgaGlkZSAoZmFsc2UpIHRoZSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBIaWRlIHRoZSBzZWNvbmQgY29sdW1uIGFmdGVyIGluaXRpYWxpc2F0aW9uCgkJICogICAgICBvVGFibGUuZm5TZXRDb2x1bW5WaXMoIDEsIGZhbHNlICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5TZXRDb2x1bW5WaXMgPSBmdW5jdGlvbiAoIGlDb2wsIGJTaG93LCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgaSwgaUxlbjsKCQkJdmFyIGFvQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnM7CgkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhOwoJCQl2YXIgblRkLCBuQ2VsbCwgYW5UcnMsIGpxQ2hpbGRyZW4sIGJBcHBlbmQsIGlCZWZvcmU7CgkJCQoJCQkvKiBObyBwb2ludCBpbiBkb2luZyBhbnl0aGluZyBpZiB3ZSBhcmUgcmVxdWVzdGluZyB3aGF0IGlzIGFscmVhZHkgdHJ1ZSAqLwoJCQlpZiAoIGFvQ29sdW1uc1tpQ29sXS5iVmlzaWJsZSA9PSBiU2hvdyApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgY29sdW1uICovCgkJCWlmICggYlNob3cgKQoJCQl7CgkJCQl2YXIgaUluc2VydCA9IDA7CgkJCQlmb3IgKCBpPTAgOyBpPGlDb2wgOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCWlJbnNlcnQrKzsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIE5lZWQgdG8gZGVjaWRlIGlmIHdlIHNob3VsZCB1c2UgYXBwZW5kQ2hpbGQgb3IgaW5zZXJ0QmVmb3JlICovCgkJCQliQXBwZW5kID0gKGlJbnNlcnQgPj0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICkpOwoJCQoJCQkJLyogV2hpY2ggY29sb3VtbiBzaG91bGQgd2UgYmUgaW5zZXJ0aW5nIGJlZm9yZT8gKi8KCQkJCWlmICggIWJBcHBlbmQgKQoJCQkJewoJCQkJCWZvciAoIGk9aUNvbCA7IGk8YW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIGFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJCXsKCQkJCQkJCWlCZWZvcmUgPSBpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCWlmICggYkFwcGVuZCApCgkJCQkJCXsKCQkJCQkJCWFvRGF0YVtpXS5uVHIuYXBwZW5kQ2hpbGQoIAoJCQkJCQkJCWFvRGF0YVtpXS5fYW5IaWRkZW5baUNvbF0KCQkJCQkJCSk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlhb0RhdGFbaV0ublRyLmluc2VydEJlZm9yZSgKCQkJCQkJCQlhb0RhdGFbaV0uX2FuSGlkZGVuW2lDb2xdLCAKCQkJCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGkgKVtpQmVmb3JlXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogUmVtb3ZlIGEgY29sdW1uIGZyb20gZGlzcGxheSAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGkgKVtpQ29sXTsKCQkJCQkJYW9EYXRhW2ldLl9hbkhpZGRlbltpQ29sXSA9IG5UZDsKCQkJCQkJblRkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5UZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQkvKiBDbGVhciB0byBzZXQgdGhlIHZpc2libGUgZmxhZyAqLwoJCQlhb0NvbHVtbnNbaUNvbF0uYlZpc2libGUgPSBiU2hvdzsKCQkKCQkJLyogUmVkcmF3IHRoZSBoZWFkZXIgYW5kIGZvb3RlciBiYXNlZCBvbiB0aGUgbmV3IGNvbHVtbiB2aXNpYmlsaXR5ICovCgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQkKCQkJLyogSWYgdGhlcmUgYXJlIGFueSAnb3Blbicgcm93cywgdGhlbiB3ZSBuZWVkIHRvIGFsdGVyIHRoZSBjb2xzcGFuIGZvciB0aGlzIGNvbCBjaGFuZ2UgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5Uci5jb2xTcGFuID0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIERvIGEgcmVkcmF3IGluY2FzZSBhbnl0aGluZyBkZXBlbmRpbmcgb24gdGhlIHRhYmxlIGNvbHVtbnMgbmVlZHMgaXQgCgkJCSAqIChidWlsdC1pbjogc2Nyb2xsaW5nKSAKCQkJICovCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5BZGp1c3RDb2x1bW5TaXppbmcoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCV9mblNhdmVTdGF0ZSggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHNldHRpbmdzIGZvciBhIHBhcnRpY3VsYXIgdGFibGUgZm9yIGV4dGVybmFsIG1hbmlwdWxhdGlvbgoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdC4gU2VlIAoJCSAqICAgIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIHZhciBvU2V0dGluZ3MgPSBvVGFibGUuZm5TZXR0aW5ncygpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTaG93IGFuIGV4YW1wbGUgcGFyYW1ldGVyIGZyb20gdGhlIHNldHRpbmdzCgkJICogICAgICBhbGVydCggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5TZXR0aW5ncyA9IGZ1bmN0aW9uKCkKCQl7CgkJCXJldHVybiBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogU29ydCB0aGUgdGFibGUgYnkgYSBwYXJ0aWN1bGFyIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCB0aGUgZGF0YSBpbmRleCB0byBzb3J0IG9uLiBOb3RlIHRoYXQgdGhpcyB3aWxsIG5vdCBtYXRjaCB0aGUgCgkJICogICAgJ2Rpc3BsYXkgaW5kZXgnIGlmIHlvdSBoYXZlIGhpZGRlbiBkYXRhIGVudHJpZXMKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29ydCBpbW1lZGlhdGVseSB3aXRoIGNvbHVtbnMgMCBhbmQgMQoJCSAqICAgICAgb1RhYmxlLmZuU29ydCggWyBbMCwnYXNjJ10sIFsxLCdhc2MnXSBdICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5Tb3J0ID0gZnVuY3Rpb24oIGFhU29ydCApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJb1NldHRpbmdzLmFhU29ydGluZyA9IGFhU29ydDsKCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBdHRhY2ggYSBzb3J0IGxpc3RlbmVyIHRvIGFuIGVsZW1lbnQgZm9yIGEgZ2l2ZW4gY29sdW1uCgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgdGhlIGVsZW1lbnQgdG8gYXR0YWNoIHRoZSBzb3J0IGxpc3RlbmVyIHRvCgkJICogIEBwYXJhbSB7aW50fSBpQ29sdW1uIHRoZSBjb2x1bW4gdGhhdCBhIGNsaWNrIG9uIHRoaXMgbm9kZSB3aWxsIHNvcnQgb24KCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gc29ydCBpcyBydW4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29ydCBvbiBjb2x1bW4gMSwgd2hlbiAnc29ydGVyJyBpcyBjbGlja2VkIG9uCgkJICogICAgICBvVGFibGUuZm5Tb3J0TGlzdGVuZXIoIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3J0ZXInKSwgMSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU29ydExpc3RlbmVyID0gZnVuY3Rpb24oIG5Ob2RlLCBpQ29sdW1uLCBmbkNhbGxiYWNrICkKCQl7CgkJCV9mblNvcnRBdHRhY2hMaXN0ZW5lciggX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKSwgbk5vZGUsIGlDb2x1bW4sCgkJCSAJZm5DYWxsYmFjayApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIGEgdGFibGUgY2VsbCBvciByb3cgLSB0aGlzIG1ldGhvZCB3aWxsIGFjY2VwdCBlaXRoZXIgYSBzaW5nbGUgdmFsdWUgdG8KCQkgKiB1cGRhdGUgdGhlIGNlbGwgd2l0aCwgYW4gYXJyYXkgb2YgdmFsdWVzIHdpdGggb25lIGVsZW1lbnQgZm9yIGVhY2ggY29sdW1uIG9yCgkJICogYW4gb2JqZWN0IGluIHRoZSBzYW1lIGZvcm1hdCBhcyB0aGUgb3JpZ2luYWwgZGF0YSBzb3VyY2UuIFRoZSBmdW5jdGlvbiBpcwoJCSAqIHNlbGYtcmVmZXJlbmNpbmcgaW4gb3JkZXIgdG8gbWFrZSB0aGUgbXVsdGkgY29sdW1uIHVwZGF0ZXMgZWFzaWVyLgoJCSAqICBAcGFyYW0ge29iamVjdHxhcnJheXxzdHJpbmd9IG1EYXRhIERhdGEgdG8gdXBkYXRlIHRoZSBjZWxsL3JvdyB3aXRoCgkJICogIEBwYXJhbSB7bm9kZXxpbnR9IG1Sb3cgVFIgZWxlbWVudCB5b3Ugd2FudCB0byB1cGRhdGUgb3IgdGhlIGFvRGF0YSBpbmRleAoJCSAqICBAcGFyYW0ge2ludH0gW2lDb2x1bW5dIFRoZSBjb2x1bW4gdG8gdXBkYXRlIChub3QgdXNlZCBvZiBtRGF0YSBpcyBhbiBhcnJheSBvciBvYmplY3QpCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBbYkFjdGlvbj10cnVlXSBQZXJmb3JtIHByZWRyYXcgYWN0aW9ucyBvciBub3QKCQkgKiAgQHJldHVybnMge2ludH0gMCBvbiBzdWNjZXNzLCAxIG9uIGVycm9yCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5VcGRhdGUoICdFeGFtcGxlIHVwZGF0ZScsIDAsIDAgKTsgLy8gU2luZ2xlIGNlbGwKCQkgKiAgICAgIG9UYWJsZS5mblVwZGF0ZSggWydhJywgJ2InLCAnYycsICdkJywgJ2UnXSwgMSwgMCApOyAvLyBSb3cKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblVwZGF0ZSA9IGZ1bmN0aW9uKCBtRGF0YSwgbVJvdywgaUNvbHVtbiwgYlJlZHJhdywgYkFjdGlvbiApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGlWaXNpYmxlQ29sdW1uLCBpLCBpTGVuLCBzRGlzcGxheTsKCQkJdmFyIGlSb3cgPSAodHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVJvdykgOiBtUm93OwoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuX19mblVwZGF0ZURlZXAgPT09IHVuZGVmaW5lZCAmJiAkLmlzQXJyYXkobURhdGEpICYmIHR5cGVvZiBtRGF0YSA9PT0gJ29iamVjdCcgKQoJCQl7CgkJCQkvKiBBcnJheSB1cGRhdGUgLSB1cGRhdGUgdGhlIHdob2xlIHJvdyAqLwoJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgPSBtRGF0YS5zbGljZSgpOwoJCQkJCgkJCQkvKiBGbGFnIHRvIHRoZSBmdW5jdGlvbiB0aGF0IHdlIGFyZSByZWN1cnNpbmcgKi8KCQkJCW9TZXR0aW5ncy5fX2ZuVXBkYXRlRGVlcCA9IHRydWU7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQkJb1NldHRpbmdzLl9fZm5VcGRhdGVEZWVwID0gdW5kZWZpbmVkOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3MuX19mblVwZGF0ZURlZXAgPT09IHVuZGVmaW5lZCAmJiBtRGF0YSAhPT0gbnVsbCAmJiB0eXBlb2YgbURhdGEgPT09ICdvYmplY3QnICkKCQkJewoJCQkJLyogT2JqZWN0IHVwZGF0ZSAtIHVwZGF0ZSB0aGUgd2hvbGUgcm93IC0gYXNzdW1lIHRoZSBkZXZlbG9wZXIgZ2V0cyB0aGUgb2JqZWN0IHJpZ2h0ICovCgkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgbURhdGEgKTsKCQkKCQkJCW9TZXR0aW5ncy5fX2ZuVXBkYXRlRGVlcCA9IHRydWU7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQkJb1NldHRpbmdzLl9fZm5VcGRhdGVEZWVwID0gdW5kZWZpbmVkOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogSW5kaXZpZHVhbCBjZWxsIHVwZGF0ZSAqLwoJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgbURhdGEgKTsKCQkJCXNEaXNwbGF5ID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkJCWlmICggb0NvbC5mblJlbmRlciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJc0Rpc3BsYXkgPSBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiApOwoJCQkJCWlmICggb0NvbC5iVXNlUmVuZGVyZWQgKQoJCQkJCXsKCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgc0Rpc3BsYXkgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCS8qIERvIHRoZSBhY3R1YWwgSFRNTCB1cGRhdGUgKi8KCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKVtpQ29sdW1uXS5pbm5lckhUTUwgPSBzRGlzcGxheTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogTW9kaWZ5IHRoZSBzZWFyY2ggaW5kZXggZm9yIHRoaXMgcm93IChzdHJpY3RseSB0aGlzIGlzIGxpa2VseSBub3QgbmVlZGVkLCBzaW5jZSBmblJlRHJhdwoJCQkgKiB3aWxsIHJlYnVpbGQgdGhlIHNlYXJjaCBhcnJheSAtIGhvd2V2ZXIsIHRoZSByZWRyYXcgbWlnaHQgYmUgZGlzYWJsZWQgYnkgdGhlIHVzZXIpCgkJCSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaVJvdywgb1NldHRpbmdzLmFpRGlzcGxheSApOwoJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2lEaXNwbGF5SW5kZXhdID0gX2ZuQnVpbGRTZWFyY2hSb3coIG9TZXR0aW5ncywgCgkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGlSb3csICdmaWx0ZXInICkgKTsKCQkJCgkJCS8qIFBlcmZvcm0gcHJlLWRyYXcgYWN0aW9ucyAqLwoJCQlpZiAoIGJBY3Rpb24gPT09IHVuZGVmaW5lZCB8fCBiQWN0aW9uICkKCQkJewoJCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlyZXR1cm4gMDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIGluIG9yZGVyCgkJICogdG8gZW5zdXJlIGNvbXBhdGliaWxpdHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJCSAqICAgIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSByZXF1aXJlZAoJCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICogIEBtZXRob2QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIGFsZXJ0KCBvVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuVmVyc2lvbkNoZWNrID0gRGF0YVRhYmxlLmV4dC5mblZlcnNpb25DaGVjazsKCQkKCQkKCQkvKgoJCSAqIFRoaXMgaXMgcmVhbGx5IGEgZ29vZCBiaXQgcnViYmlzaCB0aGlzIG1ldGhvZCBvZiBleHBvc2luZyB0aGUgaW50ZXJuYWwgbWV0aG9kcwoJCSAqIHB1YmxpY2FsbHkuLi4gLSBUbyBiZSBmaXhlZCBpbiAyLjAgdXNpbmcgbWV0aG9kcyBvbiB0aGUgcHJvdG90eXBlCgkJICovCgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGEgd3JhcHBlciBmdW5jdGlvbiBmb3IgZXhwb3J0aW5nIGFuIGludGVybmFsIGZ1bmN0aW9ucyB0byBhbiBleHRlcm5hbCBBUEkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRnVuYyBBUEkgZnVuY3Rpb24gbmFtZQoJCSAqICBAcmV0dXJucyB7ZnVuY3Rpb259IHdyYXBwZWQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRXh0ZXJuQXBpRnVuYyAoc0Z1bmMpCgkJewoJCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCQl2YXIgYUFyZ3MgPSBbX2ZuU2V0dGluZ3NGcm9tTm9kZSh0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSldLmNvbmNhdCggCgkJCQkJQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSApOwoJCQkJcmV0dXJuIERhdGFUYWJsZS5leHQub0FwaVtzRnVuY10uYXBwbHkoIHRoaXMsIGFBcmdzICk7CgkJCX07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlZmVyZW5jZSB0byBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIHVzZSBieSBwbHVnLWluIGRldmVsb3BlcnMuIE5vdGUgdGhhdCB0aGVzZQoJCSAqIG1ldGhvZHMgYXJlIHJlZmVyZW5jZXMgdG8gaW50ZXJuYWwgZnVuY3Rpb25zIGFuZCBhcmUgY29uc2lkZXJlZCB0byBiZSBwcml2YXRlLgoJCSAqIElmIHlvdSB1c2UgdGhlc2UgbWV0aG9kcywgYmUgYXdhcmUgdGhhdCB0aGV5IGFyZSBsaWFibGUgdG8gY2hhbmdlIGJldHdlZW4gdmVyc2lvbnMKCQkgKiAoY2hlY2sgdGhlIHVwZ3JhZGUgbm90ZXMpLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJdGhpcy5vQXBpID0gewoJCQkiX2ZuRXh0ZXJuQXBpRnVuYyI6IF9mbkV4dGVybkFwaUZ1bmMsCgkJCSJfZm5Jbml0aWFsaXNlIjogX2ZuSW5pdGlhbGlzZSwKCQkJIl9mbkluaXRDb21wbGV0ZSI6IF9mbkluaXRDb21wbGV0ZSwKCQkJIl9mbkxhbmd1YWdlQ29tcGF0IjogX2ZuTGFuZ3VhZ2VDb21wYXQsCgkJCSJfZm5BZGRDb2x1bW4iOiBfZm5BZGRDb2x1bW4sCgkJCSJfZm5Db2x1bW5PcHRpb25zIjogX2ZuQ29sdW1uT3B0aW9ucywKCQkJIl9mbkFkZERhdGEiOiBfZm5BZGREYXRhLAoJCQkiX2ZuQ3JlYXRlVHIiOiBfZm5DcmVhdGVUciwKCQkJIl9mbkdhdGhlckRhdGEiOiBfZm5HYXRoZXJEYXRhLAoJCQkiX2ZuQnVpbGRIZWFkIjogX2ZuQnVpbGRIZWFkLAoJCQkiX2ZuRHJhd0hlYWQiOiBfZm5EcmF3SGVhZCwKCQkJIl9mbkRyYXciOiBfZm5EcmF3LAoJCQkiX2ZuUmVEcmF3IjogX2ZuUmVEcmF3LAoJCQkiX2ZuQWpheFVwZGF0ZSI6IF9mbkFqYXhVcGRhdGUsCgkJCSJfZm5BamF4UGFyYW1ldGVycyI6IF9mbkFqYXhQYXJhbWV0ZXJzLAoJCQkiX2ZuQWpheFVwZGF0ZURyYXciOiBfZm5BamF4VXBkYXRlRHJhdywKCQkJIl9mblNlcnZlclBhcmFtcyI6IF9mblNlcnZlclBhcmFtcywKCQkJIl9mbkFkZE9wdGlvbnNIdG1sIjogX2ZuQWRkT3B0aW9uc0h0bWwsCgkJCSJfZm5GZWF0dXJlSHRtbFRhYmxlIjogX2ZuRmVhdHVyZUh0bWxUYWJsZSwKCQkJIl9mblNjcm9sbERyYXciOiBfZm5TY3JvbGxEcmF3LAoJCQkiX2ZuQWRqdXN0Q29sdW1uU2l6aW5nIjogX2ZuQWRqdXN0Q29sdW1uU2l6aW5nLAoJCQkiX2ZuRmVhdHVyZUh0bWxGaWx0ZXIiOiBfZm5GZWF0dXJlSHRtbEZpbHRlciwKCQkJIl9mbkZpbHRlckNvbXBsZXRlIjogX2ZuRmlsdGVyQ29tcGxldGUsCgkJCSJfZm5GaWx0ZXJDdXN0b20iOiBfZm5GaWx0ZXJDdXN0b20sCgkJCSJfZm5GaWx0ZXJDb2x1bW4iOiBfZm5GaWx0ZXJDb2x1bW4sCgkJCSJfZm5GaWx0ZXIiOiBfZm5GaWx0ZXIsCgkJCSJfZm5CdWlsZFNlYXJjaEFycmF5IjogX2ZuQnVpbGRTZWFyY2hBcnJheSwKCQkJIl9mbkJ1aWxkU2VhcmNoUm93IjogX2ZuQnVpbGRTZWFyY2hSb3csCgkJCSJfZm5GaWx0ZXJDcmVhdGVTZWFyY2giOiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2gsCgkJCSJfZm5EYXRhVG9TZWFyY2giOiBfZm5EYXRhVG9TZWFyY2gsCgkJCSJfZm5Tb3J0IjogX2ZuU29ydCwKCQkJIl9mblNvcnRBdHRhY2hMaXN0ZW5lciI6IF9mblNvcnRBdHRhY2hMaXN0ZW5lciwKCQkJIl9mblNvcnRpbmdDbGFzc2VzIjogX2ZuU29ydGluZ0NsYXNzZXMsCgkJCSJfZm5GZWF0dXJlSHRtbFBhZ2luYXRlIjogX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSwKCQkJIl9mblBhZ2VDaGFuZ2UiOiBfZm5QYWdlQ2hhbmdlLAoJCQkiX2ZuRmVhdHVyZUh0bWxJbmZvIjogX2ZuRmVhdHVyZUh0bWxJbmZvLAoJCQkiX2ZuVXBkYXRlSW5mbyI6IF9mblVwZGF0ZUluZm8sCgkJCSJfZm5GZWF0dXJlSHRtbExlbmd0aCI6IF9mbkZlYXR1cmVIdG1sTGVuZ3RoLAoJCQkiX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nIjogX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nLAoJCQkiX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkiOiBfZm5Qcm9jZXNzaW5nRGlzcGxheSwKCQkJIl9mblZpc2libGVUb0NvbHVtbkluZGV4IjogX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSI6IF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlLAoJCQkiX2ZuTm9kZVRvRGF0YUluZGV4IjogX2ZuTm9kZVRvRGF0YUluZGV4LAoJCQkiX2ZuVmlzYmxlQ29sdW1ucyI6IF9mblZpc2JsZUNvbHVtbnMsCgkJCSJfZm5DYWxjdWxhdGVFbmQiOiBfZm5DYWxjdWxhdGVFbmQsCgkJCSJfZm5Db252ZXJ0VG9XaWR0aCI6IF9mbkNvbnZlcnRUb1dpZHRoLAoJCQkiX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzIjogX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLAoJCQkiX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QiOiBfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCwKCQkJIl9mbkdldFdpZGVzdE5vZGUiOiBfZm5HZXRXaWRlc3ROb2RlLAoJCQkiX2ZuR2V0TWF4TGVuU3RyaW5nIjogX2ZuR2V0TWF4TGVuU3RyaW5nLAoJCQkiX2ZuU3RyaW5nVG9Dc3MiOiBfZm5TdHJpbmdUb0NzcywKCQkJIl9mbkRldGVjdFR5cGUiOiBfZm5EZXRlY3RUeXBlLAoJCQkiX2ZuU2V0dGluZ3NGcm9tTm9kZSI6IF9mblNldHRpbmdzRnJvbU5vZGUsCgkJCSJfZm5HZXREYXRhTWFzdGVyIjogX2ZuR2V0RGF0YU1hc3RlciwKCQkJIl9mbkdldFRyTm9kZXMiOiBfZm5HZXRUck5vZGVzLAoJCQkiX2ZuR2V0VGROb2RlcyI6IF9mbkdldFRkTm9kZXMsCgkJCSJfZm5Fc2NhcGVSZWdleCI6IF9mbkVzY2FwZVJlZ2V4LAoJCQkiX2ZuRGVsZXRlSW5kZXgiOiBfZm5EZWxldGVJbmRleCwKCQkJIl9mblJlT3JkZXJJbmRleCI6IF9mblJlT3JkZXJJbmRleCwKCQkJIl9mbkNvbHVtbk9yZGVyaW5nIjogX2ZuQ29sdW1uT3JkZXJpbmcsCgkJCSJfZm5Mb2ciOiBfZm5Mb2csCgkJCSJfZm5DbGVhclRhYmxlIjogX2ZuQ2xlYXJUYWJsZSwKCQkJIl9mblNhdmVTdGF0ZSI6IF9mblNhdmVTdGF0ZSwKCQkJIl9mbkxvYWRTdGF0ZSI6IF9mbkxvYWRTdGF0ZSwKCQkJIl9mbkNyZWF0ZUNvb2tpZSI6IF9mbkNyZWF0ZUNvb2tpZSwKCQkJIl9mblJlYWRDb29raWUiOiBfZm5SZWFkQ29va2llLAoJCQkiX2ZuRGV0ZWN0SGVhZGVyIjogX2ZuRGV0ZWN0SGVhZGVyLAoJCQkiX2ZuR2V0VW5pcXVlVGhzIjogX2ZuR2V0VW5pcXVlVGhzLAoJCQkiX2ZuU2Nyb2xsQmFyV2lkdGgiOiBfZm5TY3JvbGxCYXJXaWR0aCwKCQkJIl9mbkFwcGx5VG9DaGlsZHJlbiI6IF9mbkFwcGx5VG9DaGlsZHJlbiwKCQkJIl9mbk1hcCI6IF9mbk1hcCwKCQkJIl9mbkdldFJvd0RhdGEiOiBfZm5HZXRSb3dEYXRhLAoJCQkiX2ZuR2V0Q2VsbERhdGEiOiBfZm5HZXRDZWxsRGF0YSwKCQkJIl9mblNldENlbGxEYXRhIjogX2ZuU2V0Q2VsbERhdGEsCgkJCSJfZm5HZXRPYmplY3REYXRhRm4iOiBfZm5HZXRPYmplY3REYXRhRm4sCgkJCSJfZm5TZXRPYmplY3REYXRhRm4iOiBfZm5TZXRPYmplY3REYXRhRm4sCgkJCSJfZm5BcHBseUNvbHVtbkRlZnMiOiBfZm5BcHBseUNvbHVtbkRlZnMsCgkJCSJfZm5CaW5kQWN0aW9uIjogX2ZuQmluZEFjdGlvbiwKCQkJIl9mbkV4dGVuZCI6IF9mbkV4dGVuZCwKCQkJIl9mbkNhbGxiYWNrUmVnIjogX2ZuQ2FsbGJhY2tSZWcsCgkJCSJfZm5DYWxsYmFja0ZpcmUiOiBfZm5DYWxsYmFja0ZpcmUsCgkJCSJfZm5Kc29uU3RyaW5nIjogX2ZuSnNvblN0cmluZywKCQkJIl9mblJlbmRlciI6IF9mblJlbmRlciwKCQkJIl9mbk5vZGVUb0NvbHVtbkluZGV4IjogX2ZuTm9kZVRvQ29sdW1uSW5kZXgKCQl9OwoJCQoJCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9BcGksIHRoaXMub0FwaSApOwoJCQoJCWZvciAoIHZhciBzRnVuYyBpbiBEYXRhVGFibGUuZXh0Lm9BcGkgKQoJCXsKCQkJaWYgKCBzRnVuYyApCgkJCXsKCQkJCXRoaXNbc0Z1bmNdID0gX2ZuRXh0ZXJuQXBpRnVuYyhzRnVuYyk7CgkJCX0KCQl9CgkJCgkJCgkJdmFyIF90aGF0ID0gdGhpczsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkKCQkJdmFyIGk9MCwgaUxlbiwgaiwgakxlbiwgaywga0xlbjsKCQkJdmFyIHNJZCA9IHRoaXMuZ2V0QXR0cmlidXRlKCAnaWQnICk7CgkJCXZhciBiSW5pdEhhbmRlZE9mZiA9IGZhbHNlOwoJCQl2YXIgYlVzZVBhc3NlZERhdGEgPSBmYWxzZTsKCQkJCgkJCQoJCQkvKiBTYW5pdHkgY2hlY2sgKi8KCQkJaWYgKCB0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT0gJ3RhYmxlJyApCgkJCXsKCQkJCV9mbkxvZyggbnVsbCwgMCwgIkF0dGVtcHRlZCB0byBpbml0aWFsaXNlIERhdGFUYWJsZXMgb24gYSBub2RlIHdoaWNoIGlzIG5vdCBhICIrCgkJCQkJInRhYmxlOiAiK3RoaXMubm9kZU5hbWUgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgdG8gc2VlIGlmIHdlIGFyZSByZS1pbml0aWFsaXNpbmcgYSB0YWJsZSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49RGF0YVRhYmxlLnNldHRpbmdzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCS8qIEJhc2UgY2hlY2sgb24gdGFibGUgbm9kZSAqLwoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0ublRhYmxlID09IHRoaXMgKQoJCQkJewoJCQkJCWlmICggb0luaXQgPT09IHVuZGVmaW5lZCB8fCBvSW5pdC5iUmV0cmlldmUgKQoJCQkJCXsKCQkJCQkJcmV0dXJuIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5vSW5zdGFuY2U7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKCBvSW5pdC5iRGVzdHJveSApCgkJCQkJewoJCQkJCQlEYXRhVGFibGUuc2V0dGluZ3NbaV0ub0luc3RhbmNlLmZuRGVzdHJveSgpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJX2ZuTG9nKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0sIDAsICJDYW5ub3QgcmVpbml0aWFsaXNlIERhdGFUYWJsZS5cblxuIisKCQkJCQkJCSJUbyByZXRyaWV2ZSB0aGUgRGF0YVRhYmxlcyBvYmplY3QgZm9yIHRoaXMgdGFibGUsIHBhc3Mgbm8gYXJndW1lbnRzIG9yIHNlZSAiKwoJCQkJCQkJInRoZSBkb2NzIGZvciBiUmV0cmlldmUgYW5kIGJEZXN0cm95IiApOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBJZiB0aGUgZWxlbWVudCB3ZSBhcmUgaW5pdGlhbGlzaW5nIGhhcyB0aGUgc2FtZSBJRCBhcyBhIHRhYmxlIHdoaWNoIHdhcyBwcmV2aW91c2x5CgkJCQkgKiBpbml0aWFsaXNlZCwgYnV0IHRoZSB0YWJsZSBub2RlcyBkb24ndCBtYXRjaCAoZnJvbSBiZWZvcmUpIHRoZW4gd2UgZGVzdHJveSB0aGUgb2xkCgkJCQkgKiBpbnN0YW5jZSBieSBzaW1wbHkgZGVsZXRpbmcgaXQuIFRoaXMgaXMgdW5kZXIgdGhlIGFzc3VtcHRpb24gdGhhdCB0aGUgdGFibGUgaGFzIGJlZW4KCQkJCSAqIGRlc3Ryb3llZCBieSBvdGhlciBtZXRob2RzLiBBbnlvbmUgdXNpbmcgbm9uLWlkIHNlbGVjdG9ycyB3aWxsIG5lZWQgdG8gZG8gdGhpcyBtYW51YWxseQoJCQkJICovCgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5zVGFibGVJZCA9PSB0aGlzLmlkICkKCQkJCXsKCQkJCQlEYXRhVGFibGUuc2V0dGluZ3Muc3BsaWNlKCBpLCAxICk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEVuc3VyZSB0aGUgdGFibGUgaGFzIGFuIElEIC0gcmVxdWlyZWQgZm9yIGFjY2Vzc2liaWxpdHkgKi8KCQkJaWYgKCBzSWQgPT09IG51bGwgKQoJCQl7CgkJCQlzSWQgPSAiRGF0YVRhYmxlc19UYWJsZV8iKyhEYXRhVGFibGUuZXh0Ll9vRXh0ZXJuQ29uZmlnLmlOZXh0VW5pcXVlKyspOwoJCQkJdGhpcy5pZCA9IHNJZDsKCQkJfQoJCQkKCQkJLyogQ3JlYXRlIHRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgdGFibGUgYW5kIHNldCBzb21lIG9mIHRoZSBkZWZhdWx0IHBhcmFtZXRlcnMgKi8KCQkJdmFyIG9TZXR0aW5ncyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MsIHsKCQkJCSJuVGFibGUiOiAgICAgICAgdGhpcywKCQkJCSJvQXBpIjogICAgICAgICAgX3RoYXQub0FwaSwKCQkJCSJvSW5pdCI6ICAgICAgICAgb0luaXQsCgkJCQkic0Rlc3Ryb3lXaWR0aCI6ICQodGhpcykud2lkdGgoKSwKCQkJCSJzSW5zdGFuY2UiOiAgICAgc0lkLAoJCQkJInNUYWJsZUlkIjogICAgICBzSWQKCQkJfSApOwoJCQlEYXRhVGFibGUuc2V0dGluZ3MucHVzaCggb1NldHRpbmdzICk7CgkJCQoJCQkvLyBOZWVkIHRvIGFkZCB0aGUgaW5zdGFuY2UgYWZ0ZXIgdGhlIGluc3RhbmNlIGFmdGVyIHRoZSBzZXR0aW5ncyBvYmplY3QgaGFzIGJlZW4gYWRkZWQKCQkJLy8gdG8gdGhlIHNldHRpbmdzIGFycmF5LCBzbyB3ZSBjYW4gc2VsZiByZWZlcmVuY2UgdGhlIHRhYmxlIGluc3RhbmNlIGlmIG1vcmUgdGhhbiBvbmUKCQkJb1NldHRpbmdzLm9JbnN0YW5jZSA9IChfdGhhdC5sZW5ndGg9PT0xKSA/IF90aGF0IDogJCh0aGlzKS5kYXRhVGFibGUoKTsKCQkJCgkJCS8qIFNldHRpbmcgdXAgdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdCAqLwoJCQlpZiAoICFvSW5pdCApCgkJCXsKCQkJCW9Jbml0ID0ge307CgkJCX0KCQkJCgkJCS8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBiZWZvcmUgd2UgYXBwbHkgYWxsIHRoZSBkZWZhdWx0cwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZSApCgkJCXsKCQkJCV9mbkxhbmd1YWdlQ29tcGF0KCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJb0luaXQgPSBfZm5FeHRlbmQoICQuZXh0ZW5kKHRydWUsIHt9LCBEYXRhVGFibGUuZGVmYXVsdHMpLCBvSW5pdCApOwoJCQkKCQkJLy8gTWFwIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zIG9udG8gdGhlIHNldHRpbmdzIG9iamVjdAoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlBhZ2luYXRlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkxlbmd0aENoYW5nZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJGaWx0ZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiU29ydCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJJbmZvIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlByb2Nlc3NpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiQXV0b1dpZHRoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNvcnRDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNlcnZlclNpZGUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiRGVmZXJSZW5kZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFgiLCAic1giICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFhJbm5lciIsICJzWElubmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxZIiwgInNZIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgImJTY3JvbGxDb2xsYXBzZSIsICJiQ29sbGFwc2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiYlNjcm9sbEluZmluaXRlIiwgImJJbmZpbml0ZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJpU2Nyb2xsTG9hZEdhcCIsICJpTG9hZEdhcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJiU2Nyb2xsQXV0b0NzcyIsICJiQXV0b0NzcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcENsYXNzZXMiLCAiYXNTdHJpcGVDbGFzc2VzIiApOyAvLyBsZWdhY3kKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcGVDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblNlcnZlckRhdGEiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImZuRm9ybWF0TnVtYmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzU2VydmVyTWV0aG9kIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhYVNvcnRpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImFhU29ydGluZ0ZpeGVkIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhTGVuZ3RoTWVudSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic1BhZ2luYXRpb25UeXBlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQWpheFNvdXJjZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0FqYXhEYXRhUHJvcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaUNvb2tpZUR1cmF0aW9uIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQ29va2llUHJlZml4IiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzRG9tIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJiU29ydENlbGxzVG9wIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpVGFiSW5kZXgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgIm9TZWFyY2giLCAib1ByZXZpb3VzU2VhcmNoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhb1NlYXJjaENvbHMiLCAiYW9QcmVTZWFyY2hDb2xzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpRGlzcGxheUxlbmd0aCIsICJfaURpc3BsYXlMZW5ndGgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImJKUXVlcnlVSSIsICJiSlVJIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmbkNvb2tpZUNhbGxiYWNrIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblN0YXRlTG9hZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TdGF0ZVNhdmUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQsICJmbkluZm9DYWxsYmFjayIgKTsKCQkJCgkJCS8qIENhbGxiYWNrIGZ1bmN0aW9ucyB3aGljaCBhcmUgYXJyYXkgZHJpdmVuICovCgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICAgICAgIG9Jbml0LmZuRHJhd0NhbGxiYWNrLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TZXJ2ZXJQYXJhbXMnLCAgICAgICBvSW5pdC5mblNlcnZlclBhcmFtcywgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU3RhdGVTYXZlUGFyYW1zJywgICAgb0luaXQuZm5TdGF0ZVNhdmVQYXJhbXMsICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZFBhcmFtcycsICAgIG9Jbml0LmZuU3RhdGVMb2FkUGFyYW1zLCAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICAgICAgICBvSW5pdC5mblN0YXRlTG9hZGVkLCAgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvUm93Q2FsbGJhY2snLCAgICAgICAgb0luaXQuZm5Sb3dDYWxsYmFjaywgICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG9Jbml0LmZuQ3JlYXRlZFJvdywgICAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9IZWFkZXJDYWxsYmFjaycsICAgICBvSW5pdC5mbkhlYWRlckNhbGxiYWNrLCAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRm9vdGVyQ2FsbGJhY2snLCAgICAgb0luaXQuZm5Gb290ZXJDYWxsYmFjaywgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0luaXRDb21wbGV0ZScsICAgICAgIG9Jbml0LmZuSW5pdENvbXBsZXRlLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAgICBvSW5pdC5mblByZURyYXdDYWxsYmFjaywgICAndXNlcicgKTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmCgkJCQkgICBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0Q2xhc3NlcyApCgkJCXsKCQkJCS8qIEVuYWJsZSBzb3J0IGNsYXNzZXMgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIFNhZmUgdG8gZG8gaXQgaGVyZSwgc2luY2Ugc2VydmVyLXNpZGUKCQkJCSAqIHByb2Nlc3NpbmcgbXVzdCBiZSBlbmFibGVkIGJ5IHRoZSBkZXZlbG9wZXIKCQkJCSAqLwoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdzZXJ2ZXJfc2lkZV9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkRlZmVyUmVuZGVyICkKCQkJewoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdkZWZlcl9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYkpRdWVyeVVJICkKCQkJewoJCQkJLyogVXNlIHRoZSBKVUkgY2xhc3NlcyBvYmplY3QgZm9yIGRpc3BsYXkuIFlvdSBjb3VsZCBjbG9uZSB0aGUgb1N0ZENsYXNzZXMgb2JqZWN0IGlmIAoJCQkJICogeW91IHdhbnQgdG8gaGF2ZSBtdWx0aXBsZSB0YWJsZXMgd2l0aCBtdWx0aXBsZSBpbmRlcGVuZGVudCBjbGFzc2VzIAoJCQkJICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9DbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9KVUlDbGFzc2VzICk7CgkJCQkKCQkJCWlmICggb0luaXQuc0RvbSA9PT0gRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gJiYgRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gPT09ICJsZnJ0aXAiICkKCQkJCXsKCQkJCQkvKiBTZXQgdGhlIERPTSB0byB1c2UgYSBsYXlvdXQgc3VpdGFibGUgZm9yIGpRdWVyeSBVSSdzIHRoZW1pbmcgKi8KCQkJCQlvU2V0dGluZ3Muc0RvbSA9ICc8IkgibGZyPnQ8IkYiaXA+JzsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3Mub0NsYXNzZXMsIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMgKTsKCQkJfQoJCQkkKHRoaXMpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1RhYmxlICk7CgkJCQoJCQkvKiBDYWxjdWxhdGUgdGhlIHNjcm9sbCBiYXIgd2lkdGggYW5kIGNhY2hlIGl0IGZvciB1c2UgbGF0ZXIgb24gKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoID0gX2ZuU2Nyb2xsQmFyV2lkdGgoKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIERpc3BsYXkgc3RhcnQgcG9pbnQsIHRha2luZyBpbnRvIGFjY291bnQgdGhlIHNhdmUgc2F2aW5nICovCgkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBvSW5pdC5pRGlzcGxheVN0YXJ0OwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb0luaXQuaURpc3BsYXlTdGFydDsKCQkJfQoJCQkKCQkJLyogTXVzdCBiZSBkb25lIGFmdGVyIGV2ZXJ5dGhpbmcgd2hpY2ggY2FuIGJlIG92ZXJyaWRkZW4gYnkgYSBjb29raWUhICovCgkJCWlmICggb0luaXQuYlN0YXRlU2F2ZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSA9IHRydWU7CgkJCQlfZm5Mb2FkU3RhdGUoIG9TZXR0aW5ncywgb0luaXQgKTsKCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNhdmVTdGF0ZSwgJ3N0YXRlX3NhdmUnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuaURlZmVyTG9hZGluZyAhPT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nID0gdHJ1ZTsKCQkJCW9TZXR0aW5ncy5faVJlY29yZHNUb3RhbCA9IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCQlvU2V0dGluZ3MuX2lSZWNvcmRzRGlzcGxheSA9IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYWFEYXRhICE9PSBudWxsICkKCQkJewoJCQkJYlVzZVBhc3NlZERhdGEgPSB0cnVlOwoJCQl9CgkJCQoJCQkvKiBMYW5ndWFnZSBkZWZpbml0aW9ucyAqLwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZS5zVXJsICE9PSAiIiApCgkJCXsKCQkJCS8qIEdldCB0aGUgbGFuZ3VhZ2UgZGVmaW5pdGlvbnMgZnJvbSBhIGZpbGUgLSBiZWNhdXNlIHRoaXMgQWpheCBjYWxsIG1ha2VzIHRoZSBsYW5ndWFnZQoJCQkJICogZ2V0IGFzeW5jIHRvIHRoZSByZW1haW5kZXIgb2YgdGhpcyBmdW5jdGlvbiB3ZSB1c2UgYkluaXRIYW5kZWRPZmYgdG8gaW5kaWNhdGUgdGhhdCAKCQkJCSAqIF9mbkluaXRpYWxpc2Ugd2lsbCBiZSBmaXJlZCBieSB0aGUgcmV0dXJuZWQgQWpheCBoYW5kbGVyLCByYXRoZXIgdGhhbiB0aGUgY29uc3RydWN0b3IKCQkJCSAqLwoJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zVXJsID0gb0luaXQub0xhbmd1YWdlLnNVcmw7CgkJCQkkLmdldEpTT04oIG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1VybCwgbnVsbCwgZnVuY3Rpb24oIGpzb24gKSB7CgkJCQkJX2ZuTGFuZ3VhZ2VDb21wYXQoIGpzb24gKTsKCQkJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQub0xhbmd1YWdlLCBqc29uICk7CgkJCQkJX2ZuSW5pdGlhbGlzZSggb1NldHRpbmdzICk7CgkJCQl9ICk7CgkJCQliSW5pdEhhbmRlZE9mZiA9IHRydWU7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQub0xhbmd1YWdlICk7CgkJCX0KCQkJCgkJCQoJCQkvKgoJCQkgKiBTdHJpcGVzCgkJCSAqLwoJCQkKCQkJLyogUmVtb3ZlIHJvdyBzdHJpcGUgY2xhc3NlcyBpZiB0aGV5IGFyZSBhbHJlYWR5IG9uIHRoZSB0YWJsZSByb3cgKi8KCQkJdmFyIGJTdHJpcGVSZW1vdmUgPSBmYWxzZTsKCQkJdmFyIGFuUm93cyA9ICQodGhpcykuY2hpbGRyZW4oJ3Rib2R5JykuY2hpbGRyZW4oJ3RyJyk7CgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5Sb3dzLmZpbHRlcigiOmx0KDIpIikuaGFzQ2xhc3MoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbaV0pICkKCQkJCXsKCQkJCQliU3RyaXBlUmVtb3ZlID0gdHJ1ZTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCQkJCQoJCQlpZiAoIGJTdHJpcGVSZW1vdmUgKQoJCQl7CgkJCQkvKiBTdG9yZSB0aGUgY2xhc3NlcyB3aGljaCB3ZSBhcmUgYWJvdXQgdG8gcmVtb3ZlIHNvIHRoZXkgY2FuIGJlIHJlYWRkZWQgb24gZGVzdHJveSAqLwoJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXMgPSBbICcnLCAnJyBdOwoJCQkJaWYgKCAkKGFuUm93c1swXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1swXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCsiICI7CgkJCQl9CgkJCQlpZiAoICQoYW5Sb3dzWzBdKS5oYXNDbGFzcyhvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW4pICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1swXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW47CgkJCQl9CgkJCQlpZiAoICQoYW5Sb3dzWzFdKS5oYXNDbGFzcyhvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCkgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzWzFdICs9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkKyIgIjsKCQkJCX0KCQkJCWlmICggJChhblJvd3NbMV0pLmhhc0NsYXNzKG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlRXZlbikgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzWzFdICs9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlRXZlbjsKCQkJCX0KCQkJCQoJCQkJYW5Sb3dzLnJlbW92ZUNsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmpvaW4oJyAnKSApOwoJCQl9CgkJCQoJCQkKCQkJLyoKCQkJICogQ29sdW1ucwoJCQkgKiBTZWUgaWYgd2Ugc2hvdWxkIGxvYWQgY29sdW1ucyBhdXRvbWF0aWNhbGx5IG9yIHVzZSBkZWZpbmVkIG9uZXMKCQkJICovCgkJCXZhciBhblRocyA9IFtdOwoJCQl2YXIgYW9Db2x1bW5zSW5pdDsKCQkJdmFyIG5UaGVhZCA9IHRoaXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoZWFkJyk7CgkJCWlmICggblRoZWFkLmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvSGVhZGVyLCBuVGhlYWRbMF0gKTsKCQkJCWFuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogSWYgbm90IGdpdmVuIGEgY29sdW1uIGFycmF5LCBnZW5lcmF0ZSBvbmUgd2l0aCBudWxscyAqLwoJCQlpZiAoIG9Jbml0LmFvQ29sdW1ucyA9PT0gbnVsbCApCgkJCXsKCQkJCWFvQ29sdW1uc0luaXQgPSBbXTsKCQkJCWZvciAoIGk9MCwgaUxlbj1hblRocy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFvQ29sdW1uc0luaXQucHVzaCggbnVsbCApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJYW9Db2x1bW5zSW5pdCA9IG9Jbml0LmFvQ29sdW1uczsKCQkJfQoJCQkKCQkJLyogQWRkIHRoZSBjb2x1bW5zICovCgkJCWZvciAoIGk9MCwgaUxlbj1hb0NvbHVtbnNJbml0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCS8qIFNob3J0IGN1dCAtIHVzZSB0aGUgbG9vcCB0byBjaGVjayBpZiB3ZSBoYXZlIGNvbHVtbiB2aXNpYmlsaXR5IHN0YXRlIHRvIHJlc3RvcmUgKi8KCQkJCWlmICggb0luaXQuc2F2ZWRfYW9Db2x1bW5zICE9PSB1bmRlZmluZWQgJiYgb0luaXQuc2F2ZWRfYW9Db2x1bW5zLmxlbmd0aCA9PSBpTGVuICkKCQkJCXsKCQkJCQlpZiAoIGFvQ29sdW1uc0luaXRbaV0gPT09IG51bGwgKQoJCQkJCXsKCQkJCQkJYW9Db2x1bW5zSW5pdFtpXSA9IHt9OwoJCQkJCX0KCQkJCQlhb0NvbHVtbnNJbml0W2ldLmJWaXNpYmxlID0gb0luaXQuc2F2ZWRfYW9Db2x1bW5zW2ldLmJWaXNpYmxlOwoJCQkJfQoJCQkJCgkJCQlfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncywgYW5UaHMgPyBhblRoc1tpXSA6IG51bGwgKTsKCQkJfQoJCQkKCQkJLyogQXBwbHkgdGhlIGNvbHVtbiBkZWZpbml0aW9ucyAqLwoJCQlfZm5BcHBseUNvbHVtbkRlZnMoIG9TZXR0aW5ncywgb0luaXQuYW9Db2x1bW5EZWZzLCBhb0NvbHVtbnNJbml0LCBmdW5jdGlvbiAoaUNvbCwgb0RlZikgewoJCQkJX2ZuQ29sdW1uT3B0aW9ucyggb1NldHRpbmdzLCBpQ29sLCBvRGVmICk7CgkJCX0gKTsKCQkJCgkJCQoJCQkvKgoJCQkgKiBTb3J0aW5nCgkJCSAqIENoZWNrIHRoZSBhYVNvcnRpbmcgYXJyYXkKCQkJICovCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA+PSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA9IDA7CgkJCQl9CgkJCQl2YXIgb0NvbHVtbiA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gXTsKCQkJCQoJCQkJLyogQWRkIGEgZGVmYXVsdCBzb3J0aW5nIGluZGV4ICovCgkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IDA7CgkJCQl9CgkJCQkKCQkJCS8qIElmIGFhU29ydGluZyBpcyBub3QgZGVmaW5lZCwgdGhlbiB3ZSB1c2UgdGhlIGZpcnN0IGluZGljYXRvciBpbiBhc1NvcnRpbmcgKi8KCQkJCWlmICggb0luaXQuYWFTb3J0aW5nID09PSB1bmRlZmluZWQgJiYgb1NldHRpbmdzLnNhdmVkX2FhU29ydGluZyA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID0gb0NvbHVtbi5hc1NvcnRpbmdbMF07CgkJCQl9CgkJCQkKCQkJCS8qIFNldCB0aGUgY3VycmVudCBzb3J0aW5nIGluZGV4IGJhc2VkIG9uIGFvQ29sdW1ucy5hc1NvcnRpbmcgKi8KCQkJCWZvciAoIGo9MCwgakxlbj1vQ29sdW1uLmFzU29ydGluZy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSA9PSBvQ29sdW1uLmFzU29ydGluZ1tqXSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdID0gajsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQkKCQkJLyogRG8gYSBmaXJzdCBwYXNzIG9uIHRoZSBzb3J0aW5nIGNsYXNzZXMgKGFsbG93cyBhbnkgc2l6ZSBjaGFuZ2VzIHRvIGJlIHRha2VuIGludG8KCQkJICogYWNjb3VudCwgYW5kIGFsc28gd2lsbCBhcHBseSBzb3J0aW5nIGRpc2FibGVkIGNsYXNzZXMgaWYgZGlzYWJsZWQKCQkJICovCgkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJCgkJCQoJCQkvKgoJCQkgKiBGaW5hbCBpbml0CgkJCSAqIENhY2hlIHRoZSBoZWFkZXIsIGJvZHkgYW5kIGZvb3RlciBhcyByZXF1aXJlZCwgY3JlYXRpbmcgdGhlbSBpZiBuZWVkZWQKCQkJICovCgkJCXZhciB0aGVhZCA9ICQodGhpcykuY2hpbGRyZW4oJ3RoZWFkJyk7CgkJCWlmICggdGhlYWQubGVuZ3RoID09PSAwICkKCQkJewoJCQkJdGhlYWQgPSBbIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0aGVhZCcgKSBdOwoJCQkJdGhpcy5hcHBlbmRDaGlsZCggdGhlYWRbMF0gKTsKCQkJfQoJCQlvU2V0dGluZ3MublRIZWFkID0gdGhlYWRbMF07CgkJCQoJCQl2YXIgdGJvZHkgPSAkKHRoaXMpLmNoaWxkcmVuKCd0Ym9keScpOwoJCQlpZiAoIHRib2R5Lmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXRib2R5ID0gWyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGJvZHknICkgXTsKCQkJCXRoaXMuYXBwZW5kQ2hpbGQoIHRib2R5WzBdICk7CgkJCX0KCQkJb1NldHRpbmdzLm5UQm9keSA9IHRib2R5WzBdOwoJCQlvU2V0dGluZ3MublRCb2R5LnNldEF0dHJpYnV0ZSggInJvbGUiLCAiYWxlcnQiICk7CgkJCW9TZXR0aW5ncy5uVEJvZHkuc2V0QXR0cmlidXRlKCAiYXJpYS1saXZlIiwgInBvbGl0ZSIgKTsKCQkJb1NldHRpbmdzLm5UQm9keS5zZXRBdHRyaWJ1dGUoICJhcmlhLXJlbGV2YW50IiwgImFsbCIgKTsKCQkJCgkJCXZhciB0Zm9vdCA9ICQodGhpcykuY2hpbGRyZW4oJ3Rmb290Jyk7CgkJCWlmICggdGZvb3QubGVuZ3RoID4gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5uVEZvb3QgPSB0Zm9vdFswXTsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvRm9vdGVyLCBvU2V0dGluZ3MublRGb290ICk7CgkJCX0KCQkJCgkJCS8qIENoZWNrIGlmIHRoZXJlIGlzIGRhdGEgcGFzc2luZyBpbnRvIHRoZSBjb25zdHJ1Y3RvciAqLwoJCQlpZiAoIGJVc2VQYXNzZWREYXRhICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvSW5pdC5hYURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG9Jbml0LmFhRGF0YVsgaSBdICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBHcmFiIHRoZSBkYXRhIGZyb20gdGhlIHBhZ2UgKi8KCQkJCV9mbkdhdGhlckRhdGEoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBDb3B5IHRoZSBkYXRhIGluZGV4IGFycmF5ICovCgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQkvKiBJbml0aWFsaXNhdGlvbiBjb21wbGV0ZSAtIHRhYmxlIGNhbiBiZSBkcmF3biAqLwoJCQlvU2V0dGluZ3MuYkluaXRpYWxpc2VkID0gdHJ1ZTsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIG5lZWQgdG8gaW5pdGlhbGlzZSB0aGUgdGFibGUgKGl0IG1pZ2h0IG5vdCBoYXZlIGJlZW4gaGFuZGVkIG9mZiB0byB0aGUKCQkJICogbGFuZ3VhZ2UgcHJvY2Vzc29yKQoJCQkgKi8KCQkJaWYgKCBiSW5pdEhhbmRlZE9mZiA9PT0gZmFsc2UgKQoJCQl7CgkJCQlfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0gKTsKCX07CgoJLyoqCgkgKiBWZXJzaW9uIHN0cmluZyBmb3IgcGx1Zy1pbnMgdG8gY2hlY2sgY29tcGF0aWJpbGl0eS4gQWxsb3dlZCBmb3JtYXQgaXMKCSAqIGEuYi5jLmQuZSB3aGVyZTogYTppbnQsIGI6aW50LCBjOmludCwgZDpzdHJpbmcoZGV2fGJldGEpLCBlOmludC4gZCBhbmQKCSAqIGUgYXJlIG9wdGlvbmFsCgkgKiAgQG1lbWJlcgoJICogIEB0eXBlIHN0cmluZwoJICogIEBkZWZhdWx0IFZlcnNpb24gbnVtYmVyCgkgKi8KCURhdGFUYWJsZS52ZXJzaW9uID0gIjEuOS4wIjsKCgkvKioKCSAqIFByaXZhdGUgZGF0YSBzdG9yZSwgY29udGFpbmluZyBhbGwgb2YgdGhlIHNldHRpbmdzIG9iamVjdHMgdGhhdCBhcmUgY3JlYXRlZCBmb3IgdGhlCgkgKiB0YWJsZXMgb24gYSBnaXZlbiBwYWdlLgoJICogCgkgKiBOb3RlIHRoYXQgdGhlIDxpPkRhdGFUYWJsZS5zZXR0aW5nczwvaT4gb2JqZWN0IGlzIGFsaWFzZWQgdG8gPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZUV4dDwvaT4gCgkgKiB0aHJvdWdoIHdoaWNoIGl0IG1heSBiZSBhY2Nlc3NlZCBhbmQgbWFuaXB1bGF0ZWQsIG9yIDxpPmpRdWVyeS5mbi5kYXRhVGFibGUuc2V0dGluZ3M8L2k+LgoJICogIEBtZW1iZXIKCSAqICBAdHlwZSBhcnJheQoJICogIEBkZWZhdWx0IFtdCgkgKiAgQHByaXZhdGUKCSAqLwoJRGF0YVRhYmxlLnNldHRpbmdzID0gW107CgoJLyoqCgkgKiBPYmplY3QgbW9kZWxzIGNvbnRhaW5lciwgZm9yIHRoZSB2YXJpb3VzIG1vZGVscyB0aGF0IERhdGFUYWJsZXMgaGFzIGF2YWlsYWJsZQoJICogdG8gaXQuIFRoZXNlIG1vZGVscyBkZWZpbmUgdGhlIG9iamVjdHMgdGhhdCBhcmUgdXNlZCB0byBob2xkIHRoZSBhY3RpdmUgc3RhdGUgCgkgKiBhbmQgY29uZmlndXJhdGlvbiBvZiB0aGUgdGFibGUuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzID0ge307CgkKCQoJLyoqCgkgKiBEYXRhVGFibGVzIGV4dGVuc2lvbiBvcHRpb25zIGFuZCBwbHVnLWlucy4gVGhpcyBuYW1lc3BhY2UgYWN0cyBhcyBhIGNvbGxlY3Rpb24gImFyZWEiCgkgKiBmb3IgcGx1Zy1pbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBleHRlbmQgdGhlIGRlZmF1bHQgRGF0YVRhYmxlcyBiZWhhdmlvdXIgLSBpbmRlZWQgbWFueQoJICogb2YgdGhlIGJ1aWxkIGluIG1ldGhvZHMgdXNlIHRoaXMgbWV0aG9kIHRvIHByb3ZpZGUgdGhlaXIgb3duIGNhcGFiaWxpdGllcyAoc29ydGluZyBtZXRob2RzCgkgKiBmb3IgZXhhbXBsZSkuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG5hbWVzcGFjZSBpcyBhbGlhc2VkIHRvIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQgc28gaXQgY2FuIGJlIHJlYWRpbHkgYWNjZXNzZWQKCSAqIGFuZCBtb2RpZmllZCBieSBwbHVnLWlucy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMuZXh0ID0gewoJCS8qKgoJCSAqIFBsdWctaW4gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIHRoaXMgbWV0aG9kIG9mIGZpbHRlcmluZyBpcyBjb21wbGltZW50YXJ5IHRvIHRoZSBkZWZhdWx0CgkJICogdHlwZSBiYXNlZCBmaWx0ZXJpbmcsIGFuZCBhIGxvdCBtb3JlIGNvbXByZWhlbnNpdmUgYXMgaXQgYWxsb3dzIHlvdSBjb21wbGV0ZSBjb250cm9sCgkJICogb3ZlciB0aGUgZmlsdGVyaW5nIGxvZ2ljLiBFYWNoIGVsZW1lbnQgaW4gdGhpcyBhcnJheSBpcyBhIGZ1bmN0aW9uIChwYXJhbWV0ZXJzCgkJICogZGVzY3JpYmVkIGJlbG93KSB0aGF0IGlzIGNhbGxlZCBmb3IgZXZlcnkgcm93IGluIHRoZSB0YWJsZSwgYW5kIHlvdXIgbG9naWMgZGVjaWRlcyBpZgoJCSAqIGl0IHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgZmlsdGVyZWQgZGF0YSBzZXQgb3Igbm90LgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICA8bGk+e2FycmF5fG9iamVjdH0gRGF0YSBmb3IgdGhlIHJvdyB0byBiZSBwcm9jZXNzZWQgKHNhbWUgYXMgdGhlIG9yaWdpbmFsIGZvcm1hdAoJCSAqICAgICAgICAgICB0aGF0IHdhcyBwYXNzZWQgaW4gYXMgdGhlIGRhdGEgc291cmNlLCBvciBhbiBhcnJheSBmcm9tIGEgRE9NIGRhdGEgc291cmNlPC9saT4KCQkgKiAgICAgICAgIDxsaT57aW50fSBSb3cgaW5kZXggaW4gYW9EYXRhICh7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MuYW9EYXRhfSksIHdoaWNoIGNhbgoJCSAqICAgICAgICAgICBiZSB1c2VmdWwgdG8gcmV0cmlldmUgdGhlIFRSIGVsZW1lbnQgaWYgeW91IG5lZWQgRE9NIGludGVyYWN0aW9uLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2Jvb2xlYW59IEluY2x1ZGUgdGhlIHJvdyBpbiB0aGUgZmlsdGVyZWQgcmVzdWx0IHNldCAodHJ1ZSkgb3Igbm90IChmYWxzZSk8L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVGhlIGZvbGxvd2luZyBleGFtcGxlIHNob3dzIGN1c3RvbSBmaWx0ZXJpbmcgYmVpbmcgYXBwbGllZCB0byB0aGUgZm91cnRoIGNvbHVtbiAoaS5lLgoJCSAqICAgIC8vIHRoZSBhRGF0YVszXSBpbmRleCkgYmFzZWQgb24gdHdvIGlucHV0IHZhbHVlcyBmcm9tIHRoZSBlbmQtdXNlciwgbWF0Y2hpbmcgdGhlIGRhdGEgaW4gCgkJICogICAgLy8gYSBjZXJ0YWluIHJhbmdlLgoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0LmFmbkZpbHRlcmluZy5wdXNoKAoJCSAqICAgICAgZnVuY3Rpb24oIG9TZXR0aW5ncywgYURhdGEsIGlEYXRhSW5kZXggKSB7CgkJICogICAgICAgIHZhciBpTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pbicpLnZhbHVlICogMTsKCQkgKiAgICAgICAgdmFyIGlNYXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF4JykudmFsdWUgKiAxOwoJCSAqICAgICAgICB2YXIgaVZlcnNpb24gPSBhRGF0YVszXSA9PSAiLSIgPyAwIDogYURhdGFbM10qMTsKCQkgKiAgICAgICAgaWYgKCBpTWluID09ICIiICYmIGlNYXggPT0gIiIgKSB7CgkJICogICAgICAgICAgcmV0dXJuIHRydWU7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgZWxzZSBpZiAoIGlNaW4gPT0gIiIgJiYgaVZlcnNpb24gPCBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIGVsc2UgaWYgKCBpTWluIDwgaVZlcnNpb24gJiYgIiIgPT0gaU1heCApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICBlbHNlIGlmICggaU1pbiA8IGlWZXJzaW9uICYmIGlWZXJzaW9uIDwgaU1heCApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICB9CgkJICogICAgKTsKCQkgKi8KCQkiYWZuRmlsdGVyaW5nIjogW10sCgkKCQoJCS8qKgoJCSAqIFBsdWctaW4gc29ydGluZyBmdW5jdGlvbnMgLSB0aGlzIG1ldGhvZCBvZiBzb3J0aW5nIGlzIGNvbXBsaW1lbnRhcnkgdG8gdGhlIGRlZmF1bHQgdHlwZQoJCSAqIGJhc2VkIHNvcnRpbmcgdGhhdCBEYXRhVGFibGVzIGRvZXMgYXV0b21hdGljYWxseSwgYWxsb3dpbmcgbXVjaCBncmVhdGVyIGNvbnRyb2wgb3ZlciB0aGUKCQkgKiB0aGUgZGF0YSB0aGF0IGlzIGJlaW5nIHVzZWQgdG8gc29ydCBhIGNvbHVtbi4gVGhpcyBpcyB1c2VmdWwgaWYgeW91IHdhbnQgdG8gZG8gc29ydGluZwoJCSAqIGJhc2VkIG9uIGxpdmUgZGF0YSAoZm9yIGV4YW1wbGUgdGhlIGNvbnRlbnRzIG9mIGFuICdpbnB1dCcgZWxlbWVudCkgcmF0aGVyIHRoYW4ganVzdCB0aGUKCQkgKiBzdGF0aWMgc3RyaW5nIHRoYXQgRGF0YVRhYmxlcyBrbm93cyBvZi4gVGhlIHdheSB0aGVzZSBwbHVnLWlucyB3b3JrIGlzIHRoYXQgeW91IGNyZWF0ZQoJCSAqIGFuIGFycmF5IG9mIHRoZSB2YWx1ZXMgeW91IHdpc2ggdG8gYmUgc29ydGVkIGZvciB0aGUgY29sdW1uIGluIHF1ZXN0aW9uIGFuZCB0aGVuIHJldHVybgoJCSAqIHRoYXQgYXJyYXkuIFdoaWNoIHByZS1zb3J0aW5nIGZ1bmN0aW9uIGlzIHJ1biBoZXJlIGRlcGVuZHMgb24gdGhlIHNTb3J0RGF0YVR5cGUgcGFyYW1ldGVyCgkJICogdGhhdCBpcyB1c2VkIGZvciB0aGUgY29sdW1uIChpZiBhbnkpLiBUaGlzIGlzIHRoZSBjb3JvbGxhcnkgb2YgPGk+b2ZuU2VhcmNoPC9pPiBmb3Igc29ydCAKCQkgKiBkYXRhLgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkgICAgICogICAgICAgICA8bGk+e2ludH0gVGFyZ2V0IGNvbHVtbiBpbmRleDwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2FycmF5fSBEYXRhIGZvciB0aGUgY29sdW1uIHRvIGJlIHNvcnRlZCB1cG9uPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgCgkJICogTm90ZSB0aGF0IGFzIG9mIHYxLjksIGl0IGlzIHR5cGljYWxseSBwcmVmZXJhYmxlIHRvIHVzZSA8aT5tRGF0YVByb3A8L2k+IHRvIHByZXBhcmUgZGF0YSBmb3IKCQkgKiB0aGUgZGlmZmVyZW50IHVzZXMgdGhhdCBEYXRhVGFibGVzIGNhbiBwdXQgdGhlIGRhdGEgdG8uIFNwZWNpZmljYWxseSA8aT5tRGF0YVByb3A8L2k+IHdoZW4KCQkgKiB1c2VkIGFzIGEgZnVuY3Rpb24gd2lsbCBnaXZlIHlvdSBhICd0eXBlJyAoc29ydGluZywgZmlsdGVyaW5nIGV0YykgdGhhdCB5b3UgY2FuIHVzZSB0byAKCQkgKiBwcmVwYXJlIHRoZSBkYXRhIGFzIHJlcXVpcmVkIGZvciB0aGUgZGlmZmVyZW50IHR5cGVzLiBBcyBzdWNoLCB0aGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXBkYXRpbmcgdGhlIGNhY2hlZCBzb3J0aW5nIGluZm9ybWF0aW9uIHdpdGggdXNlciBlbnRlcmVkIHZhbHVlcyBpbiBIVE1MIGlucHV0IGVsZW1lbnRzCgkJICogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5hZm5Tb3J0RGF0YVsnZG9tLXRleHQnXSA9IGZ1bmN0aW9uICggb1NldHRpbmdzLCBpQ29sdW1uICkKCQkgKiAgICB7CgkJICogICAgICB2YXIgYURhdGEgPSBbXTsKCQkgKiAgICAgICQoICd0ZDplcSgnK2lDb2x1bW4rJykgaW5wdXQnLCBvU2V0dGluZ3Mub0FwaS5fZm5HZXRUck5vZGVzKG9TZXR0aW5ncykgKS5lYWNoKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGFEYXRhLnB1c2goIHRoaXMudmFsdWUgKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIHJldHVybiBhRGF0YTsKCQkgKiAgICB9CgkJICovCgkJImFmblNvcnREYXRhIjogW10sCgkKCQoJCS8qKgoJCSAqIEZlYXR1cmUgcGx1Zy1pbnMgLSBUaGlzIGlzIGFuIGFycmF5IG9mIG9iamVjdHMgd2hpY2ggZGVzY3JpYmUgdGhlIGZlYXR1cmUgcGx1Zy1pbnMgdGhhdCBhcmUKCQkgKiBhdmFpbGFibGUgdG8gRGF0YVRhYmxlcy4gVGhlc2UgZmVhdHVyZSBwbHVnLWlucyBhcmUgYWNjZXNzaWJsZSB0aHJvdWdoIHRoZSBzRG9tIGluaXRpYWxpc2F0aW9uCgkJICogb3B0aW9uLiBBcyBzdWNoLCBlYWNoIGZlYXR1cmUgcGx1Zy1pbiBtdXN0IGRlc2NyaWJlIGEgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIHRvIGluaXRpYWxpc2UKCQkgKiBpdHNlbGYgKGZuSW5pdCksIGEgY2hhcmFjdGVyIHNvIHRoZSBmZWF0dXJlIGNhbiBiZSBlbmFibGVkIGJ5IHNEb20gKGNGZWF0dXJlKSBhbmQgdGhlIG5hbWUKCQkgKiBvZiB0aGUgZmVhdHVyZSAoc0ZlYXR1cmUpLiBUaHVzIHRoZSBvYmplY3RzIGF0dGFjaGVkIHRvIHRoaXMgbWV0aG9kIG11c3QgcHJvdmlkZToKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPntmdW5jdGlvbn0gZm5Jbml0IEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwbHVnLWluCgkJICogICAgICAgPHVsPgoJICAgICAqICAgICAgICAgPGxpPgoJICAgICAqICAgICAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntvYmplY3R9IERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0OiBzZWUge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfS48L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntub2RlfG51bGx9IFRoZSBlbGVtZW50IHdoaWNoIGNvbnRhaW5zIHlvdXIgZmVhdHVyZS4gTm90ZSB0aGF0IHRoZSByZXR1cm4KCQkgKiAgICAgICAgICAgICAgICBtYXkgYWxzbyBiZSB2b2lkIGlmIHlvdXIgcGx1Zy1pbiBkb2VzIG5vdCByZXF1aXJlIHRvIGluamVjdCBhbnkgRE9NIGVsZW1lbnRzIAoJCSAqICAgICAgICAgICAgICAgIGludG8gRGF0YVRhYmxlcyBjb250cm9sIChzRG9tKSAtIGZvciBleGFtcGxlIHRoaXMgbWlnaHQgYmUgdXNlZnVsIHdoZW4gCgkJICogICAgICAgICAgICAgICAgZGV2ZWxvcGluZyBhIHBsdWctaW4gd2hpY2ggYWxsb3dzIHRhYmxlIGNvbnRyb2wgdmlhIGtleWJvYXJkIGVudHJ5LjwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvbGk+CgkJICogICAgIDxsaT57Y2hhcmFjdGVyfSBjRmVhdHVyZSBDaGFyYWN0ZXIgdGhhdCB3aWxsIGJlIG1hdGNoZWQgaW4gc0RvbSAtIGNhc2Ugc2Vuc2l0aXZlPC9saT4KCQkgKiAgICAgPGxpPntzdHJpbmd9IHNGZWF0dXJlIEZlYXR1cmUgbmFtZTwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEhvdyBUYWJsZVRvb2xzIGluaXRpYWxpc2VzIGl0c2VsZi4KCQkgKiAgICAkLmZuLmRhdGFUYWJsZUV4dC5hb0ZlYXR1cmVzLnB1c2goIHsKCQkgKiAgICAgICJmbkluaXQiOiBmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCSAqICAgICAgICByZXR1cm4gbmV3IFRhYmxlVG9vbHMoIHsgIm9EVFNldHRpbmdzIjogb1NldHRpbmdzIH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAiY0ZlYXR1cmUiOiAiVCIsCgkJICogICAgICAic0ZlYXR1cmUiOiAiVGFibGVUb29scyIKCQkgKiAgICB9ICk7CgkJICovCgkJImFvRmVhdHVyZXMiOiBbXSwKCQoJCgkJLyoqCgkJICogVHlwZSBkZXRlY3Rpb24gcGx1Zy1pbiBmdW5jdGlvbnMgLSBEYXRhVGFibGVzIHV0aWxpc2VzIHR5cGVzIHRvIGRlZmluZSBob3cgc29ydGluZyBhbmQKCQkgKiBmaWx0ZXJpbmcgYmVoYXZlLCBhbmQgdHlwZXMgY2FuIGJlIGVpdGhlciAgYmUgZGVmaW5lZCBieSB0aGUgZGV2ZWxvcGVyIChzVHlwZSBmb3IgdGhlCgkJICogY29sdW1uKSBvciB0aGV5IGNhbiBiZSBhdXRvbWF0aWNhbGx5IGRldGVjdGVkIGJ5IHRoZSBtZXRob2RzIGluIHRoaXMgYXJyYXkuIFRoZSBmdW5jdGlvbnMKCQkgKiBkZWZpbmVkIGluIHRoZSBhcnJheSBhcmUgcXVpdGUgc2ltcGxlLCB0YWtpbmcgYSBzaW5nbGUgcGFyYW1ldGVyICh0aGUgZGF0YSB0byBhbmFseXNlKSAKCQkgKiBhbmQgcmV0dXJuaW5nIHRoZSB0eXBlIGlmIGl0IGlzIGEga25vd24gdHlwZSwgb3IgbnVsbCBvdGhlcndpc2UuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSBmcm9tIHRoZSBjb2x1bW4gY2VsbCB0byBiZSBhbmFseXNlZDwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e3N0cmluZ3xudWxsfSBEYXRhIHR5cGUgZGV0ZWN0ZWQsIG9yIG51bGwgaWYgdW5rbm93biAoYW5kIHRodXMgcGFzcyBpdAoJCSAqICAgICAgICAgICBvbiB0byB0aGUgb3RoZXIgdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEN1cnJlbmN5IHR5cGUgZGV0ZWN0aW9uIHBsdWctaW46CgkJICogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5hVHlwZXMucHVzaCgKCQkgKiAgICAgIGZ1bmN0aW9uICggc0RhdGEgKSB7CgkJICogICAgICAgIHZhciBzVmFsaWRDaGFycyA9ICIwMTIzNDU2Nzg5Li0iOwoJCSAqICAgICAgICB2YXIgQ2hhcjsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIENoZWNrIHRoZSBudW1lcmljIHBhcnQKCQkgKiAgICAgICAgZm9yICggaT0xIDsgaTxzRGF0YS5sZW5ndGggOyBpKysgKSB7CgkJICogICAgICAgICAgQ2hhciA9IHNEYXRhLmNoYXJBdChpKTsgCgkJICogICAgICAgICAgaWYgKHNWYWxpZENoYXJzLmluZGV4T2YoQ2hhcikgPT0gLTEpIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBudWxsOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gQ2hlY2sgcHJlZml4ZWQgYnkgY3VycmVuY3kKCQkgKiAgICAgICAgaWYgKCBzRGF0YS5jaGFyQXQoMCkgPT0gJyQnIHx8IHNEYXRhLmNoYXJBdCgwKSA9PSAnJnBvdW5kOycgKSB7CgkJICogICAgICAgICAgcmV0dXJuICdjdXJyZW5jeSc7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgcmV0dXJuIG51bGw7CgkJICogICAgICB9CgkJICogICAgKTsKCQkgKi8KCQkiYVR5cGVzIjogW10sCgkKCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIAoJCSAqIGluIG9yZGVyIHRvIGVuc3VyZSBjb21wYXRpYmlsaXR5LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZlcnNpb24gVmVyc2lvbiBzdHJpbmcgdG8gY2hlY2sgZm9yLCBpbiB0aGUgZm9ybWF0ICJYLlkuWiIuIE5vdGUgCgkJICogICAgdGhhdCB0aGUgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIAoJCSAqICAgIHJlcXVpcmVkIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgYWxlcnQoIG9UYWJsZS5mblZlcnNpb25DaGVjayggJzEuOS4wJyApICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblZlcnNpb25DaGVjayI6IGZ1bmN0aW9uKCBzVmVyc2lvbiApCgkJewoJCQkvKiBUaGlzIGlzIGNoZWFwLCBidXQgdmVyeSBlZmZlY3RpdmUgKi8KCQkJdmFyIGZuWlBhZCA9IGZ1bmN0aW9uIChacGFkLCBjb3VudCkKCQkJewoJCQkJd2hpbGUoWnBhZC5sZW5ndGggPCBjb3VudCkgewoJCQkJCVpwYWQgKz0gJzAnOwoJCQkJfQoJCQkJcmV0dXJuIFpwYWQ7CgkJCX07CgkJCXZhciBhVGhpcyA9IERhdGFUYWJsZS5leHQuc1ZlcnNpb24uc3BsaXQoJy4nKTsKCQkJdmFyIGFUaGF0ID0gc1ZlcnNpb24uc3BsaXQoJy4nKTsKCQkJdmFyIHNUaGlzID0gJycsIHNUaGF0ID0gJyc7CgkJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFUaGF0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXNUaGlzICs9IGZuWlBhZCggYVRoaXNbaV0sIDMgKTsKCQkJCXNUaGF0ICs9IGZuWlBhZCggYVRoYXRbaV0sIDMgKTsKCQkJfQoJCQkKCQkJcmV0dXJuIHBhcnNlSW50KHNUaGlzLCAxMCkgPj0gcGFyc2VJbnQoc1RoYXQsIDEwKTsKCQl9LAoJCgkKCQkvKioKCQkgKiBJbmRleCBmb3Igd2hhdCAndGhpcycgaW5kZXggQVBJIGZ1bmN0aW9ucyBzaG91bGQgdXNlCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlBcGlJbmRleCI6IDAsCgkKCQoJCS8qKgoJCSAqIFByZS1wcm9jZXNzaW5nIG9mIGZpbHRlcmluZyBkYXRhIHBsdWctaW5zIC0gV2hlbiB5b3UgYXNzaWduIHRoZSBzVHlwZSBmb3IgYSBjb2x1bW4KCQkgKiAob3IgaGF2ZSBpdCBhdXRvbWF0aWNhbGx5IGRldGVjdGVkIGZvciB5b3UgYnkgRGF0YVRhYmxlcyBvciBhIHR5cGUgZGV0ZWN0aW9uIHBsdWctaW4pLCAKCQkgKiB5b3Ugd2lsbCB0eXBpY2FsbHkgYmUgdXNpbmcgdGhpcyBmb3IgY3VzdG9tIHNvcnRpbmcsIGJ1dCBpdCBjYW4gYWxzbyBiZSB1c2VkIHRvIHByb3ZpZGUgCgkJICogY3VzdG9tIGZpbHRlcmluZyBieSBhbGxvd2luZyB5b3UgdG8gcHJlLXByb2Nlc3NpbmcgdGhlIGRhdGEgYW5kIHJldHVybmluZyB0aGUgZGF0YSBpbgoJCSAqIHRoZSBmb3JtYXQgdGhhdCBzaG91bGQgYmUgZmlsdGVyZWQgdXBvbi4gVGhpcyBpcyBkb25lIGJ5IGFkZGluZyBmdW5jdGlvbnMgdGhpcyBvYmplY3QgCgkJICogd2l0aCBhIHBhcmFtZXRlciBuYW1lIHdoaWNoIG1hdGNoZXMgdGhlIHNUeXBlIGZvciB0aGF0IHRhcmdldCBjb2x1bW4uIFRoaXMgaXMgdGhlCgkJICogY29yb2xsYXJ5IG9mIDxpPmFmblNvcnREYXRhPC9pPiBmb3IgZmlsdGVyaW5nIGRhdGEuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSBmcm9tIHRoZSBjb2x1bW4gY2VsbCB0byBiZSBwcmVwYXJlZCBmb3IgZmlsdGVyaW5nPC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57c3RyaW5nfG51bGx9IEZvcm1hdHRlZCBzdHJpbmcgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIHRoZSBmaWx0ZXJpbmcuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAKCQkgKiBOb3RlIHRoYXQgYXMgb2YgdjEuOSwgaXQgaXMgdHlwaWNhbGx5IHByZWZlcmFibGUgdG8gdXNlIDxpPm1EYXRhUHJvcDwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhUHJvcDwvaT4gd2hlbgoJCSAqIHVzZWQgYXMgYSBmdW5jdGlvbiB3aWxsIGdpdmUgeW91IGEgJ3R5cGUnIChzb3J0aW5nLCBmaWx0ZXJpbmcgZXRjKSB0aGF0IHlvdSBjYW4gdXNlIHRvIAoJCSAqIHByZXBhcmUgdGhlIGRhdGEgYXMgcmVxdWlyZWQgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMuIEFzIHN1Y2gsIHRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQub2ZuU2VhcmNoWyd0aXRsZS1udW1lcmljJ10gPSBmdW5jdGlvbiAoIHNEYXRhICkgewoJCSAqICAgICAgcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1xuL2csIiAiKS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkgKiAgICB9CgkJICovCgkJIm9mblNlYXJjaCI6IHt9LAoJCgkKCQkvKioKCQkgKiBDb250YWluZXIgZm9yIGFsbCBwcml2YXRlIGZ1bmN0aW9ucyBpbiBEYXRhVGFibGVzIHNvIHRoZXkgY2FuIGJlIGV4cG9zZWQgZXh0ZXJuYWxseQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0FwaSI6IHt9LAoJCgkKCQkvKioKCQkgKiBTdG9yYWdlIGZvciB0aGUgdmFyaW91cyBjbGFzc2VzIHRoYXQgRGF0YVRhYmxlcyB1c2VzCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvU3RkQ2xhc3NlcyI6IHt9LAoJCQoJCgkJLyoqCgkJICogU3RvcmFnZSBmb3IgdGhlIHZhcmlvdXMgY2xhc3NlcyB0aGF0IERhdGFUYWJsZXMgdXNlcyAtIGpRdWVyeSBVSSBzdWl0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0pVSUNsYXNzZXMiOiB7fSwKCQoJCgkJLyoqCgkJICogUGFnaW5hdGlvbiBwbHVnLWluIG1ldGhvZHMgLSBUaGUgc3R5bGUgYW5kIGNvbnRyb2xzIG9mIHRoZSBwYWdpbmF0aW9uIGNhbiBzaWduaWZpY2FudGx5IAoJCSAqIGltcGFjdCBvbiBob3cgdGhlIGVuZCB1c2VyIGludGVyYWN0cyB3aXRoIHRoZSBkYXRhIGluIHlvdXIgdGFibGUsIGFuZCBEYXRhVGFibGVzIGFsbG93cyAKCQkgKiB0aGUgYWRkaXRpb24gb2YgcGFnaW5hdGlvbiBjb250cm9scyBieSBleHRlbmRpbmcgdGhpcyBvYmplY3QsIHdoaWNoIGNhbiB0aGVuIGJlIGVuYWJsZWQKCQkgKiB0aHJvdWdoIHRoZSA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IGluaXRpYWxpc2F0aW9uIHBhcmFtZXRlci4gRWFjaCBwYWdpbmF0aW9uIHR5cGUgdGhhdAoJCSAqIGlzIGFkZGVkIGlzIGFuIG9iamVjdCAodGhlIHByb3BlcnR5IG5hbWUgb2Ygd2hpY2ggaXMgd2hhdCA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IHJlZmVycwoJCSAqIHRvKSB0aGF0IGhhcyB0d28gcHJvcGVydGllcywgYm90aCBtZXRob2RzIHRoYXQgYXJlIHVzZWQgYnkgRGF0YVRhYmxlcyB0byB1cGRhdGUgdGhlCgkJICogY29udHJvbCdzIHN0YXRlLgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwYWdpbmcgY29udHJvbHMuIENhbGxlZCBvbmx5IGR1cmluZyBpbml0aWFsaXNhdGlvbiAKCQkgKiAgICAgICAgIG9mIHRoZSB0YWJsZS4gSXQgaXMgZXhwZWN0ZWQgdGhhdCB0aGlzIGZ1bmN0aW9uIHdpbGwgYWRkIHRoZSByZXF1aXJlZCBET00gZWxlbWVudHMgCgkJICogICAgICAgICB0byB0aGUgcGFnZSBmb3IgdGhlIHBhZ2luZyBjb250cm9scyB0byB3b3JrLiBUaGUgZWxlbWVudCBwb2ludGVyIAoJCSAqICAgICAgICAgJ29TZXR0aW5ncy5hYW5GZWF0dXJlcy5wJyBhcnJheSBpcyBwcm92aWRlZCBieSBEYXRhVGFibGVzIHRvIGNvbnRhaW4gdGhlIHBhZ2luZyAKCQkgKiAgICAgICAgIGNvbnRyb2xzIChub3RlIHRoYXQgdGhpcyBpcyBhIDJEIGFycmF5IHRvIGFsbG93IGZvciBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgZWFjaCAKCQkgKiAgICAgICAgIERhdGFUYWJsZXMgRE9NIGVsZW1lbnQpLiBJdCBpcyBzdWdnZXN0ZWQgdGhhdCB5b3UgYWRkIHRoZSBjb250cm9scyB0byB0aGlzIGVsZW1lbnQgCgkJICogICAgICAgICBhcyBjaGlsZHJlbgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgICAgICA8bGk+e25vZGV9IENvbnRhaW5lciBpbnRvIHdoaWNoIHRoZSBwYWdpbmF0aW9uIGNvbnRyb2xzIG11c3QgYmUgaW5zZXJ0ZWQ8L2xpPgoJCSAqICAgICAgICAgICAgIDxsaT57ZnVuY3Rpb259IERyYXcgY2FsbGJhY2sgZnVuY3Rpb24gLSB3aGVuZXZlciB0aGUgY29udHJvbHMgY2F1c2UgYSBwYWdlCgkJICogICAgICAgICAgICAgICBjaGFuZ2UsIHRoaXMgbWV0aG9kIG11c3QgYmUgY2FsbGVkIHRvIHJlZHJhdyB0aGUgdGFibGUuPC9saT4KCSAgICAgKiAgICAgICAgICAgPC91bD4KCSAgICAgKiAgICAgICAgIDwvbGk+CgkJICogICAgICAgICA8bGk+CgkJICogICAgICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT5ObyByZXR1cm4gcmVxdWlyZWQ8L2xpPgoJCSAqICAgICAgICAgICA8L3VsPgoJCSAqICAgICAgICAgPC9pbD4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyIHRoZSBwYWdpbmcgc3RhdHVzIG9mIHRoZSB0YWJsZSBjaGFuZ2VzIGFuZCBpcwoJCSAqICAgICAgICAgdHlwaWNhbGx5IHVzZWQgdG8gdXBkYXRlIGNsYXNzZXMgYW5kL29yIHRleHQgb2YgdGhlIHBhZ2luZyBjb250cm9scyB0byByZWZsZXggdGhlIG5ldyAKCQkgKiAgICAgICAgIHN0YXR1cy4KCQkgKiAgICAgICA8dWw+CgkgICAgICogICAgICAgICA8bGk+CgkgICAgICogICAgICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICAgICAgPGxpPntmdW5jdGlvbn0gRHJhdyBjYWxsYmFjayBmdW5jdGlvbiAtIGluIGNhc2UgeW91IG5lZWQgdG8gcmVkcmF3IHRoZSB0YWJsZSBhZ2FpbgoJCSAqICAgICAgICAgICAgICAgb3IgYXR0YWNoIG5ldyBldmVudCBsaXN0ZW5lcnM8L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPk5vIHJldHVybiByZXF1aXJlZDwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uLmZvdXJfYnV0dG9uID0gewoJCSAqICAgICAgImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgbkZpcnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5QcmV2aW91cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTmV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTGFzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0ZpcnN0ICkgKTsKCQkgKiAgICAgICAgblByZXZpb3VzLmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc1ByZXZpb3VzICkgKTsKCQkgKiAgICAgICAgbk5leHQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zTmV4dCApICk7CgkJICogICAgICAgIG5MYXN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0xhc3QgKSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9idXR0b24gZmlyc3QiOwoJCSAqICAgICAgICBuUHJldmlvdXMuY2xhc3NOYW1lID0gInBhZ2luYXRlX2J1dHRvbiBwcmV2aW91cyI7CgkJICogICAgICAgIG5OZXh0LmNsYXNzTmFtZT0icGFnaW5hdGVfYnV0dG9uIG5leHQiOwoJCSAqICAgICAgICBuTGFzdC5jbGFzc05hbWUgPSAicGFnaW5hdGVfYnV0dG9uIGxhc3QiOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgblBhZ2luZy5hcHBlbmRDaGlsZCggbkZpcnN0ICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5QcmV2aW91cyApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTmV4dCApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTGFzdCApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuRmlyc3QpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAiZmlyc3QiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5QcmV2aW91cykuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgInByZXZpb3VzIiApOwoJCSAqICAgICAgICAgIGZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkgKiAgICAgICAgfSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuTmV4dCkuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgIm5leHQiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5MYXN0KS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAibGFzdCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQobkZpcnN0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5QcmV2aW91cykuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTmV4dCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTGFzdCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAKCQkgKiAgICAgICJmblVwZGF0ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKSB7CgkJICogICAgICAgICAgcmV0dXJuOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBMb29wIG92ZXIgZWFjaCBpbnN0YW5jZSBvZiB0aGUgcGFnZXIKCQkgKiAgICAgICAgdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJICogICAgICAgIGZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkgewoJCSAqICAgICAgICAgIHZhciBidXR0b25zID0gYW5baV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKTsKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMF0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzBdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkgewoJCSAqICAgICAgICAgICAgYnV0dG9uc1syXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfbmV4dCI7CgkJICogICAgICAgICAgICBidXR0b25zWzNdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzJdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1szXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZW5hYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0KCQkgKiAgICB9OwoJCSAqLwoJCSJvUGFnaW5hdGlvbiI6IHt9LAoJCgkKCQkvKioKCQkgKiBTb3J0aW5nIHBsdWctaW4gbWV0aG9kcyAtIFNvcnRpbmcgaW4gRGF0YVRhYmxlcyBpcyBiYXNlZCBvbiB0aGUgZGV0ZWN0ZWQgdHlwZSBvZiB0aGUKCQkgKiBkYXRhIGNvbHVtbiAoeW91IGNhbiBhZGQgeW91ciBvd24gdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLCBvciBvdmVycmlkZSBhdXRvbWF0aWMgCgkJICogZGV0ZWN0aW9uIHVzaW5nIHNUeXBlKS4gV2l0aCB0aGlzIHNwZWNpZmljIHR5cGUgZ2l2ZW4gdG8gdGhlIGNvbHVtbiwgRGF0YVRhYmxlcyB3aWxsIAoJCSAqIGFwcGx5IHRoZSByZXF1aXJlZCBzb3J0IGZyb20gdGhlIGZ1bmN0aW9ucyBpbiB0aGUgb2JqZWN0LiBFYWNoIHNvcnQgdHlwZSBtdXN0IHByb3ZpZGUKCQkgKiB0d28gbWFuZGF0b3J5IG1ldGhvZHMsIG9uZSBlYWNoIGZvciBhc2NlbmRpbmcgYW5kIGRlc2NlbmRpbmcgc29ydGluZywgYW5kIGNhbiBvcHRpb25hbGx5CgkJICogcHJvdmlkZSBhIHByZS1mb3JtYXR0aW5nIG1ldGhvZCB0aGF0IHdpbGwgaGVscCBzcGVlZCB1cCBzb3J0aW5nIGJ5IGFsbG93aW5nIERhdGFUYWJsZXMKCQkgKiB0byBwcmUtZm9ybWF0IHRoZSBzb3J0IGRhdGEgb25seSBvbmNlIChyYXRoZXIgdGhhbiBldmVyeSB0aW1lIHRoZSBhY3R1YWwgc29ydCBmdW5jdGlvbnMKCQkgKiBhcmUgcnVuKS4gVGhlIHR3byBzb3J0aW5nIGZ1bmN0aW9ucyBhcmUgdHlwaWNhbCBKYXZhc2NyaXB0IHNvcnQgbWV0aG9kczoKCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIHNlY29uZCBwYXJhbWV0ZXI8L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIGZpcnN0IHBhcmFtZXRlcjwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2ludH0gU29ydGluZyBtYXRjaDogPDAgaWYgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgbG93ZXIgdGhhbgoJCSAqICAgICAgICAgICB0aGUgc2Vjb25kIHBhcmFtZXRlciwgPT09MCBpZiB0aGUgdHdvIHBhcmFtZXRlcnMgYXJlIGVxdWFsIGFuZCA+MCBpZgoJCSAqICAgICAgICAgICB0aGUgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgaGVpZ2h0IHRoYW4gdGhlIHNlY29uZCBwYXJhbWV0ZXIuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDYXNlLXNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBubyBwcmUtZm9ybWF0dGluZyBtZXRob2QKCQkgKiAgICAkLmV4dGVuZCggJC5mbi5kYXRhVGFibGVFeHQub1NvcnQsIHsKCQkgKiAgICAgICJzdHJpbmctY2FzZS1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1jYXNlLWRlc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJICogICAgICB9CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gQ2FzZS1pbnNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBwcmUtZm9ybWF0dGluZwoJCSAqICAgICQuZXh0ZW5kKCAkLmZuLmRhdGFUYWJsZUV4dC5vU29ydCwgewoJCSAqICAgICAgInN0cmluZy1wcmUiOiBmdW5jdGlvbih4KSB7CgkJICogICAgICAgIHJldHVybiB4LnRvTG93ZXJDYXNlKCk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1kZXNjIjogZnVuY3Rpb24oeCx5KSB7CgkJICogICAgICAgIHJldHVybiAoKHggPCB5KSA/IDEgOiAoKHggPiB5KSA/IC0xIDogMCkpOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkib1NvcnQiOiB7fSwKCQoJCgkJLyoqCgkJICogVmVyc2lvbiBzdHJpbmcgZm9yIHBsdWctaW5zIHRvIGNoZWNrIGNvbXBhdGliaWxpdHkuIEFsbG93ZWQgZm9ybWF0IGlzCgkJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJCSAqIGUgYXJlIG9wdGlvbmFsCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBWZXJzaW9uIG51bWJlcgoJCSAqLwoJCSJzVmVyc2lvbiI6IERhdGFUYWJsZS52ZXJzaW9uLAoJCgkKCQkvKioKCQkgKiBIb3cgc2hvdWxkIERhdGFUYWJsZXMgcmVwb3J0IGFuIGVycm9yLiBDYW4gdGFrZSB0aGUgdmFsdWUgJ2FsZXJ0JyBvciAndGhyb3cnCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhbGVydAoJCSAqLwoJCSJzRXJyTW9kZSI6ICJhbGVydCIsCgkKCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGZvciBEYXRhVGFibGVzIHRvIGFjY2VzcyBnbG9iYWxseSBhYm91dCBvdGhlciBpbnN0YW5jZXMKCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfb0V4dGVybkNvbmZpZyI6IHsKCQkJLyogaW50OmlOZXh0VW5pcXVlIC0gbmV4dCB1bmlxdWUgbnVtYmVyIGZvciBhbiBpbnN0YW5jZSAqLwoJCQkiaU5leHRVbmlxdWUiOiAwCgkJfQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogc2VhcmNoIGluZm9ybWF0aW9uIGZvciB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVycy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCA9IHsKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBmaWx0ZXJpbmcgc2hvdWxkIGJlIGNhc2UgaW5zZW5zaXRpdmUgb3Igbm90CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiQ2FzZUluc2Vuc2l0aXZlIjogdHJ1ZSwKCQoJCS8qKgoJCSAqIEFwcGxpZWQgc2VhcmNoIHRlcm0KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic1NlYXJjaCI6ICIiLAoJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgc2VhcmNoIHRlcm0gc2hvdWxkIGJlIGludGVycHJldGVkIGFzIGEKCQkgKiByZWd1bGFyIGV4cHJlc3Npb24gKHRydWUpIG9yIG5vdCAoZmFsc2UpIGFuZCB0aGVyZWZvcmUgYW5kIHNwZWNpYWwKCQkgKiByZWdleCBjaGFyYWN0ZXJzIGVzY2FwZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYlJlZ2V4IjogZmFsc2UsCgkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIERhdGFUYWJsZXMgaXMgdG8gdXNlIGl0cyBzbWFydCBmaWx0ZXJpbmcgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYlNtYXJ0IjogdHJ1ZQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogZWFjaCBpbmRpdmlkdWFsIHJvdy4gVGhpcyBpcyB0aGUgb2JqZWN0IGZvcm1hdCB1c2VkIGZvciB0aGUgc2V0dGluZ3MgCgkgKiBhb0RhdGEgYXJyYXkuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzLm9Sb3cgPSB7CgkJLyoqCgkJICogVFIgZWxlbWVudCBmb3IgdGhlIHJvdwoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRyIjogbnVsbCwKCQoJCS8qKgoJCSAqIERhdGEgb2JqZWN0IGZyb20gdGhlIG9yaWdpbmFsIGRhdGEgc291cmNlIGZvciB0aGUgcm93LiBUaGlzIGlzIGVpdGhlcgoJCSAqIGFuIGFycmF5IGlmIHVzaW5nIHRoZSB0cmFkaXRpb25hbCBmb3JtIG9mIERhdGFUYWJsZXMsIG9yIGFuIG9iamVjdCBpZgoJCSAqIHVzaW5nIG1EYXRhUHJvcCBvcHRpb25zLiBUaGUgZXhhY3QgdHlwZSB3aWxsIGRlcGVuZCBvbiB0aGUgcGFzc2VkIGluCgkJICogZGF0YSBmcm9tIHRoZSBkYXRhIHNvdXJjZSwgb3Igd2lsbCBiZSBhbiBhcnJheSBpZiB1c2luZyBET00gYSBkYXRhIAoJCSAqIHNvdXJjZS4KCQkgKiAgQHR5cGUgYXJyYXl8b2JqZWN0CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJIl9hRGF0YSI6IFtdLAoJCgkJLyoqCgkJICogU29ydGluZyBkYXRhIGNhY2hlIC0gdGhpcyBhcnJheSBpcyBvc3RlbnNpYmx5IHRoZSBzYW1lIGxlbmd0aCBhcyB0aGUKCQkgKiBudW1iZXIgb2YgY29sdW1ucyAoYWx0aG91Z2ggZWFjaCBpbmRleCBpcyBnZW5lcmF0ZWQgb25seSBhcyBpdCBpcyAKCQkgKiBuZWVkZWQpLCBhbmQgaG9sZHMgdGhlIGRhdGEgdGhhdCBpcyB1c2VkIGZvciBzb3J0aW5nIGVhY2ggY29sdW1uIGluIHRoZQoJCSAqIHJvdy4gV2UgZG8gdGhpcyBjYWNoZSBnZW5lcmF0aW9uIGF0IHRoZSBzdGFydCBvZiB0aGUgc29ydCBpbiBvcmRlciB0aGF0CgkJICogdGhlIGZvcm1hdHRpbmcgb2YgdGhlIHNvcnQgZGF0YSBuZWVkIGJlIGRvbmUgb25seSBvbmNlIGZvciBlYWNoIGNlbGwKCQkgKiBwZXIgc29ydC4gVGhpcyBhcnJheSBzaG91bGQgbm90IGJlIHJlYWQgZnJvbSBvciB3cml0dGVuIHRvIGJ5IGFueXRoaW5nCgkJICogb3RoZXIgdGhhbiB0aGUgbWFzdGVyIHNvcnRpbmcgbWV0aG9kcy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2FTb3J0RGF0YSI6IFtdLAoJCgkJLyoqCgkJICogQXJyYXkgb2YgVEQgZWxlbWVudHMgdGhhdCBhcmUgY2FjaGVkIGZvciBoaWRkZW4gcm93cywgc28gdGhleSBjYW4gYmUKCQkgKiByZWluc2VydGVkIGludG8gdGhlIHRhYmxlIGlmIGEgY29sdW1uIGlzIG1hZGUgdmlzaWJsZSBhZ2FpbiAob3IgdG8gYWN0CgkJICogYXMgYSBzdG9yZSBpZiBhIGNvbHVtbiBpcyBtYWRlIGhpZGRlbikuIE9ubHkgaGlkZGVuIGNvbHVtbnMgaGF2ZSBhIAoJCSAqIHJlZmVyZW5jZSBpbiB0aGUgYXJyYXkuIEZvciBub24taGlkZGVuIGNvbHVtbnMgdGhlIHZhbHVlIGlzIGVpdGhlcgoJCSAqIHVuZGVmaW5lZCBvciBudWxsLgoJCSAqICBAdHlwZSBhcnJheSBub2RlcwoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYW5IaWRkZW4iOiBbXSwKCQoJCS8qKgoJCSAqIENhY2hlIG9mIHRoZSBjbGFzcyBuYW1lIHRoYXQgRGF0YVRhYmxlcyBoYXMgYXBwbGllZCB0byB0aGUgcm93LCBzbyB3ZQoJCSAqIGNhbiBxdWlja2x5IGxvb2sgYXQgdGhpcyB2YXJpYWJsZSByYXRoZXIgdGhhbiBuZWVkaW5nIHRvIGRvIGEgRE9NIGNoZWNrCgkJICogb24gY2xhc3NOYW1lIGZvciB0aGUgblRyIHByb3BlcnR5LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfc1Jvd1N0cmlwZSI6ICIiCgl9OwoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSBjb2x1bW4gaW5mb3JtYXRpb24gb2JqZWN0IGluIERhdGFUYWJsZXMuIFRoaXMgb2JqZWN0CgkgKiBpcyBoZWxkIGluIHRoZSBzZXR0aW5ncyBhb0NvbHVtbnMgYXJyYXkgYW5kIGNvbnRhaW5zIGFsbCB0aGUgaW5mb3JtYXRpb24gdGhhdAoJICogRGF0YVRhYmxlcyBuZWVkcyBhYm91dCBlYWNoIGluZGl2aWR1YWwgY29sdW1uLgoJICogCgkgKiBOb3RlIHRoYXQgdGhpcyBvYmplY3QgaXMgcmVsYXRlZCB0byB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnN9IAoJICogYnV0IHRoaXMgb25lIGlzIHRoZSBpbnRlcm5hbCBkYXRhIHN0b3JlIGZvciBEYXRhVGFibGVzJ3MgY2FjaGUgb2YgY29sdW1ucy4KCSAqIEl0IHNob3VsZCBOT1QgYmUgbWFuaXB1bGF0ZWQgb3V0c2lkZSBvZiBEYXRhVGFibGVzLiBBbnkgY29uZmlndXJhdGlvbiBzaG91bGQKCSAqIGJlIGRvbmUgdGhyb3VnaCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiA9IHsKCQkvKioKCQkgKiBBIGxpc3Qgb2YgdGhlIGNvbHVtbnMgdGhhdCBzb3J0aW5nIHNob3VsZCBvY2N1ciBvbiB3aGVuIHRoaXMgY29sdW1uCgkJICogaXMgc29ydGVkLiBUaGF0IHRoaXMgcHJvcGVydHkgaXMgYW4gYXJyYXkgYWxsb3dzIG11bHRpLWNvbHVtbiBzb3J0aW5nCgkJICogdG8gYmUgZGVmaW5lZCBmb3IgYSBjb2x1bW4gKGZvciBleGFtcGxlIGZpcnN0IG5hbWUgLyBsYXN0IG5hbWUgY29sdW1ucwoJCSAqIHdvdWxkIGJlbmVmaXQgZnJvbSB0aGlzKS4gVGhlIHZhbHVlcyBhcmUgaW50ZWdlcnMgcG9pbnRpbmcgdG8gdGhlCgkJICogY29sdW1ucyB0byBiZSBzb3J0ZWQgb24gKHR5cGljYWxseSBpdCB3aWxsIGJlIGEgc2luZ2xlIGludGVnZXIgcG9pbnRpbmcKCQkgKiBhdCBpdHNlbGYsIGJ1dCB0aGF0IGRvZXNuJ3QgbmVlZCB0byBiZSB0aGUgY2FzZSkuCgkJICogIEB0eXBlIGFycmF5CgkJICovCgkJImFEYXRhU29ydCI6IG51bGwsCgkKCQkvKioKCQkgKiBEZWZpbmUgdGhlIHNvcnRpbmcgZGlyZWN0aW9ucyB0aGF0IGFyZSBhcHBsaWVkIHRvIHRoZSBjb2x1bW4sIGluIHNlcXVlbmNlCgkJICogYXMgdGhlIGNvbHVtbiBpcyByZXBlYXRlZGx5IHNvcnRlZCB1cG9uIC0gaS5lLiB0aGUgZmlyc3QgdmFsdWUgaXMgdXNlZAoJCSAqIGFzIHRoZSBzb3J0aW5nIGRpcmVjdGlvbiB3aGVuIHRoZSBjb2x1bW4gaWYgZmlyc3Qgc29ydGVkIChjbGlja2VkIG9uKS4KCQkgKiBTb3J0IGl0IGFnYWluIChjbGljayBhZ2FpbikgYW5kIGl0IHdpbGwgbW92ZSBvbiB0byB0aGUgbmV4dCBpbmRleC4KCQkgKiBSZXBlYXQgdW50aWwgbG9vcC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKi8KCQkiYXNTb3J0aW5nIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgc2VhcmNoYWJsZSwgYW5kIHRodXMgc2hvdWxkIGJlIGluY2x1ZGVkCgkJICogaW4gdGhlIGZpbHRlcmluZyBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNlYXJjaGFibGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgdGhlIGNvbHVtbiBpcyBzb3J0YWJsZSBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNvcnRhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGVuIHVzaW5nIGZuUmVuZGVyLCB5b3UgaGF2ZSB0d28gb3B0aW9ucyBmb3Igd2hhdCB0byBkbyB3aXRoIHRoZSBkYXRhLAoJCSAqIGFuZCB0aGlzIHByb3BlcnR5IHNlcnZlcyBhcyB0aGUgc3dpdGNoLiBGaXJzdGx5LCB5b3UgY2FuIGhhdmUgdGhlIHNvcnRpbmcKCQkgKiBhbmQgZmlsdGVyaW5nIHVzZSB0aGUgcmVuZGVyZWQgdmFsdWUgKHRydWUgLSBkZWZhdWx0KSwgb3IgeW91IGNhbiBoYXZlCgkJICogdGhlIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB1cyB0aGUgb3JpZ2luYWwgdmFsdWUgKGZhbHNlKS4KCQkgKiAKCQkgKiAqTk9URSogSXQgaXMgaXQgaXMgYWR2aXNhYmxlIG5vdyB0byB1c2UgbURhdGFQcm9wIGFzIGEgZnVuY3Rpb24gYW5kIG1ha2UgCgkJICogdXNlIG9mIHRoZSAndHlwZScgdGhhdCBpdCBnaXZlcywgYWxsb3dpbmcgKHBvdGVudGlhbGx5KSBkaWZmZXJlbnQgZGF0YSB0bwoJCSAqIGJlIHVzZWQgZm9yIHNvcnRpbmcsIGZpbHRlcmluZywgZGlzcGxheSBhbmQgdHlwZSBkZXRlY3Rpb24uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgY3VycmVudGx5IHZpc2libGUgaW4gdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJWaXNpYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIHRvIHRoZSB0eXBlIGRldGVjdGlvbiBtZXRob2QgaWYgdGhlIGF1dG9tYXRpYyB0eXBlCgkJICogZGV0ZWN0aW9uIHNob3VsZCBiZSB1c2VkLCBvciBpZiBhIGNvbHVtbiB0eXBlIChzVHlwZSkgaGFzIGJlZW4gc3BlY2lmaWVkCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYkF1dG9UeXBlIjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBmblJlbmRlcgoJCSAqIGFsbG93aW5nIHlvdSB0byBtb2RpZnkgdGhlIERPTSBlbGVtZW50IChhZGQgYmFja2dyb3VuZCBjb2xvdXIgZm9yIGV4YW1wbGUpIHdoZW4gdGhlCgkJICogZWxlbWVudCBpcyBhdmFpbGFibGUgKHNpbmNlIGl0IGlzIG5vdCB3aGVuIGZuUmVuZGVyIGlzIGNhbGxlZCkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gblRkIFRoZSBURCBub2RlIHRoYXQgaGFzIGJlZW4gY3JlYXRlZAoJCSAqICBAcGFyYW0geyp9IHNEYXRhIFRoZSBEYXRhIGZvciB0aGUgY2VsbAoJCSAqICBAcGFyYW0ge2FycmF5fG9iamVjdH0gb0RhdGEgVGhlIGRhdGEgZm9yIHRoZSB3aG9sZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBpbmRleCBmb3IgdGhlIGFvRGF0YSBkYXRhIHN0b3JlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb24gdG8gZ2V0IGRhdGEgZnJvbSBhIGNlbGwgaW4gYSBjb2x1bW4uIFlvdSBzaG91bGQgPGI+bmV2ZXI8L2I+CgkJICogYWNjZXNzIGRhdGEgZGlyZWN0bHkgdGhyb3VnaCBfYURhdGEgaW50ZXJuYWxseSBpbiBEYXRhVGFibGVzIC0gYWx3YXlzIHVzZQoJCSAqIHRoZSBtZXRob2QgYXR0YWNoZWQgdG8gdGhpcyBwcm9wZXJ0eS4gSXQgYWxsb3dzIG1EYXRhUHJvcCB0byBmdW5jdGlvbiBhcwoJCSAqIHJlcXVpcmVkLiBUaGlzIGZ1bmN0aW9uIGlzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgYnkgdGhlIGNvbHVtbiAKCQkgKiBpbml0aWFsaXNhdGlvbiBtZXRob2QKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGFycmF5L29iamVjdCBmb3IgdGhlIGFycmF5IAoJCSAqICAgIChpLmUuIGFvRGF0YVtdLl9hRGF0YSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBUaGUgc3BlY2lmaWMgZGF0YSB0eXBlIHlvdSB3YW50IHRvIGdldCAtIAoJCSAqICAgICdkaXNwbGF5JywgJ3R5cGUnICdmaWx0ZXInICdzb3J0JwoJCSAqICBAcmV0dXJucyB7Kn0gVGhlIGRhdGEgZm9yIHRoZSBjZWxsIGZyb20gdGhlIGdpdmVuIHJvdydzIGRhdGEKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkdldERhdGEiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCAKCQkgKiBpbiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8gT2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YVJvdyBUaGUgcm93IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YUNvbHVtbiBUaGUgY29sdW1uIGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXkgICBvLmFEYXRhIFRoZSBkYXRhIGZvciB0aGUgcm93IGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvLm9TZXR0aW5ncyBUaGUgc2V0dGluZ3Mgb2JqZWN0IGZvciB0aGlzIERhdGFUYWJsZXMgaW5zdGFuY2UKCQkgKiAgQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyB5b3Ugd2hpY2ggdG8gdXNlIGluIHRoZSBkaXNwbGF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5SZW5kZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIHNldCBkYXRhIGZvciBhIGNlbGwgaW4gdGhlIGNvbHVtbi4gWW91IHNob3VsZCA8Yj5uZXZlcjwvYj4gCgkJICogc2V0IHRoZSBkYXRhIGRpcmVjdGx5IHRvIF9hRGF0YSBpbnRlcm5hbGx5IGluIERhdGFUYWJsZXMgLSBhbHdheXMgdXNlCgkJICogdGhpcyBtZXRob2QuIEl0IGFsbG93cyBtRGF0YVByb3AgdG8gZnVuY3Rpb24gYXMgcmVxdWlyZWQuIFRoaXMgZnVuY3Rpb24KCQkgKiBpcyBhdXRvbWF0aWNhbGx5IGFzc2lnbmVkIGJ5IHRoZSBjb2x1bW4gaW5pdGlhbGlzYXRpb24gbWV0aG9kCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBhcnJheS9vYmplY3QgZm9yIHRoZSBhcnJheSAKCQkgKiAgICAoaS5lLiBhb0RhdGFbXS5fYURhdGEpCgkJICogIEBwYXJhbSB7Kn0gc1ZhbHVlIFZhbHVlIHRvIHNldAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuU2V0RGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogUHJvcGVydHkgdG8gcmVhZCB0aGUgdmFsdWUgZm9yIHRoZSBjZWxscyBpbiB0aGUgY29sdW1uIGZyb20gdGhlIGRhdGEgCgkJICogc291cmNlIGFycmF5IC8gb2JqZWN0LiBJZiBudWxsLCB0aGVuIHRoZSBkZWZhdWx0IGNvbnRlbnQgaXMgdXNlZCwgaWYgYQoJCSAqIGZ1bmN0aW9uIGlzIGdpdmVuIHRoZW4gdGhlIHJldHVybiBmcm9tIHRoZSBmdW5jdGlvbiBpcyB1c2VkLgoJCSAqICBAdHlwZSBmdW5jdGlvbnxpbnR8c3RyaW5nfG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJtRGF0YVByb3AiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBoZWFkZXIgVEgvVEQgZWxlbWVudCBmb3IgdGhpcyBjb2x1bW4gLSB0aGlzIGlzIHdoYXQgdGhlIHNvcnRpbmcKCQkgKiBsaXN0ZW5lciBpcyBhdHRhY2hlZCB0byAoaWYgc29ydGluZyBpcyBlbmFibGVkLikKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UaCI6IG51bGwsCgkJCgkJLyoqCgkJICogVW5pcXVlIGZvb3RlciBUSC9URCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbiAoaWYgdGhlcmUgaXMgb25lKS4gTm90IHVzZWQgCgkJICogaW4gRGF0YVRhYmxlcyBhcyBzdWNoLCBidXQgY2FuIGJlIHVzZWQgZm9yIHBsdWctaW5zIHRvIHJlZmVyZW5jZSB0aGUgCgkJICogZm9vdGVyIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UZiI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzIHRvIGFwcGx5IHRvIGFsbCBURCBlbGVtZW50cyBpbiB0aGUgdGFibGUncyBUQk9EWSBmb3IgdGhlIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzQ2xhc3MiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoZW4gRGF0YVRhYmxlcyBjYWxjdWxhdGVzIHRoZSBjb2x1bW4gd2lkdGhzIHRvIGFzc2lnbiB0byBlYWNoIGNvbHVtbiwKCQkgKiBpdCBmaW5kcyB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gZWFjaCBjb2x1bW4gYW5kIHRoZW4gY29uc3RydWN0cyBhCgkJICogdGVtcG9yYXJ5IHRhYmxlIGFuZCByZWFkcyB0aGUgd2lkdGhzIGZyb20gdGhhdC4gVGhlIHByb2JsZW0gd2l0aCB0aGlzCgkJICogaXMgdGhhdCAibW1tIiBpcyBtdWNoIHdpZGVyIHRoZW4gImlpaWkiLCBidXQgdGhlIGxhdHRlciBpcyBhIGxvbmdlciAKCQkgKiBzdHJpbmcgLSB0aHVzIHRoZSBjYWxjdWxhdGlvbiBjYW4gZ28gd3JvbmcgKGRvaW5nIGl0IHByb3Blcmx5IGFuZCBwdXR0aW5nCgkJICogaXQgaW50byBhbiBET00gb2JqZWN0IGFuZCBtZWFzdXJpbmcgdGhhdCBpcyBob3JyaWJseSghKSBzbG93KS4gVGh1cyBhcwoJCSAqIGEgIndvcmsgYXJvdW5kIiB3ZSBwcm92aWRlIHRoaXMgb3B0aW9uLiBJdCB3aWxsIGFwcGVuZCBpdHMgdmFsdWUgdG8gdGhlCgkJICogdGV4dCB0aGF0IGlzIGZvdW5kIHRvIGJlIHRoZSBsb25nZXN0IHN0cmluZyBmb3IgdGhlIGNvbHVtbiAtIGkuZS4gcGFkZGluZy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNDb250ZW50UGFkZGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogQWxsb3dzIGEgZGVmYXVsdCB2YWx1ZSB0byBiZSBnaXZlbiBmb3IgYSBjb2x1bW4ncyBkYXRhLCBhbmQgd2lsbCBiZSB1c2VkCgkJICogd2hlbmV2ZXIgYSBudWxsIGRhdGEgc291cmNlIGlzIGVuY291bnRlcmVkICh0aGlzIGNhbiBiZSBiZWNhdXNlIG1EYXRhUHJvcAoJCSAqIGlzIHNldCB0byBudWxsLCBvciBiZWNhdXNlIHRoZSBkYXRhIHNvdXJjZSBpdHNlbGYgaXMgbnVsbCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNEZWZhdWx0Q29udGVudCI6IG51bGwsCgkJCgkJLyoqCgkJICogTmFtZSBmb3IgdGhlIGNvbHVtbiwgYWxsb3dpbmcgcmVmZXJlbmNlIHRvIHRoZSBjb2x1bW4gYnkgbmFtZSBhcyB3ZWxsIGFzCgkJICogYnkgaW5kZXggKG5lZWRzIGEgbG9va3VwIHRvIHdvcmsgYnkgbmFtZSkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzTmFtZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ3VzdG9tIHNvcnRpbmcgZGF0YSB0eXBlIC0gZGVmaW5lcyB3aGljaCBvZiB0aGUgYXZhaWxhYmxlIHBsdWctaW5zIGluCgkJICogYWZuU29ydERhdGEgdGhlIGN1c3RvbSBzb3J0aW5nIHdpbGwgdXNlIC0gaWYgYW55IGlzIGRlZmluZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKi8KCQkic1NvcnREYXRhVHlwZSI6ICdzdGQnLAoJCQoJCS8qKgoJCSAqIENsYXNzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGhlYWRlciBlbGVtZW50IHdoZW4gc29ydGluZyBvbiB0aGlzIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzU29ydGluZ0NsYXNzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzcyB0byBiZSBhcHBsaWVkIHRvIHRoZSBoZWFkZXIgZWxlbWVudCB3aGVuIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4gLQoJCSAqIHdoZW4galF1ZXJ5IFVJIHRoZW1pbmcgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1NvcnRpbmdDbGFzc0pVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGl0bGUgb2YgdGhlIGNvbHVtbiAtIHdoYXQgaXMgc2VlbiBpbiB0aGUgVEggZWxlbWVudCAoblRoKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ29sdW1uIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB0eXBlCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNUeXBlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaWR0aCBvZiB0aGUgY29sdW1uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aCI6IG51bGwsCgkJCgkJLyoqCgkJICogV2lkdGggb2YgdGhlIGNvbHVtbiB3aGVuIGl0IHdhcyBmaXJzdCAiZW5jb3VudGVyZWQiCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aE9yaWciOiBudWxsCgl9OwoJCgkKCQoJLyoqCgkgKiBJbml0aWFsaXNhdGlvbiBvcHRpb25zIHRoYXQgY2FuIGJlIGdpdmVuIHRvIERhdGFUYWJsZXMgYXQgaW5pdGlhbGlzYXRpb24gCgkgKiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzID0gewoJCS8qKgoJCSAqIEFuIGFycmF5IG9mIGRhdGEgdG8gdXNlIGZvciB0aGUgdGFibGUsIHBhc3NlZCBpbiBhdCBpbml0aWFsaXNhdGlvbiB3aGljaCAKCQkgKiB3aWxsIGJlIHVzZWQgaW4gcHJlZmVyZW5jZSB0byBhbnkgZGF0YSB3aGljaCBpcyBhbHJlYWR5IGluIHRoZSBET00uIFRoaXMgaXMKCQkgKiBwYXJ0aWN1bGFybHkgdXNlZnVsIGZvciBjb25zdHJ1Y3RpbmcgdGFibGVzIHB1cmVseSBpbiBKYXZhc2NyaXB0LCBmb3IKCQkgKiBleGFtcGxlIHdpdGggYSBjdXN0b20gQWpheCBjYWxsLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhIDJEIGFycmF5IGRhdGEgc291cmNlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYURhdGEiOiBbCgkJICogICAgICAgICAgWydUcmlkZW50JywgJ0ludGVybmV0IEV4cGxvcmVyIDQuMCcsICdXaW4gOTUrJywgNCwgJ1gnXSwKCQkgKiAgICAgICAgICBbJ1RyaWRlbnQnLCAnSW50ZXJuZXQgRXhwbG9yZXIgNS4wJywgJ1dpbiA5NSsnLCA1LCAnQyddLAoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJHcmFkZSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFuIGFycmF5IG9mIG9iamVjdHMgYXMgYSBkYXRhIHNvdXJjZSAobURhdGFQcm9wKQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFEYXRhIjogWwoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJlbmdpbmUiOiAgICJUcmlkZW50IiwKCQkgKiAgICAgICAgICAgICJicm93c2VyIjogICJJbnRlcm5ldCBFeHBsb3JlciA0LjAiLAoJCSAqICAgICAgICAgICAgInBsYXRmb3JtIjogIldpbiA5NSsiLAoJCSAqICAgICAgICAgICAgInZlcnNpb24iOiAgNCwKCQkgKiAgICAgICAgICAgICJncmFkZSI6ICAgICJYIgoJCSAqICAgICAgICAgIH0sCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImVuZ2luZSI6ICAgIlRyaWRlbnQiLAoJCSAqICAgICAgICAgICAgImJyb3dzZXIiOiAgIkludGVybmV0IEV4cGxvcmVyIDUuMCIsCgkJICogICAgICAgICAgICAicGxhdGZvcm0iOiAiV2luIDk1KyIsCgkJICogICAgICAgICAgICAidmVyc2lvbiI6ICA1LAoJCSAqICAgICAgICAgICAgImdyYWRlIjogICAgIkMiCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiLCAgICJtRGF0YVByb3AiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJCcm93c2VyIiwgICJtRGF0YVByb3AiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiUGxhdGZvcm0iLCAibURhdGFQcm9wIjogInBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiwgICJtRGF0YVByb3AiOiAidmVyc2lvbiIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiR3JhZGUiLCAgICAibURhdGFQcm9wIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhRGF0YSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElmIHNvcnRpbmcgaXMgZW5hYmxlZCwgdGhlbiBEYXRhVGFibGVzIHdpbGwgcGVyZm9ybSBhIGZpcnN0IHBhc3Mgc29ydCBvbiAKCQkgKiBpbml0aWFsaXNhdGlvbi4gWW91IGNhbiBkZWZpbmUgd2hpY2ggY29sdW1uKHMpIHRoZSBzb3J0IGlzIHBlcmZvcm1lZCB1cG9uLCAKCQkgKiBhbmQgdGhlIHNvcnRpbmcgZGlyZWN0aW9uLCB3aXRoIHRoaXMgdmFyaWFibGUuIFRoZSBhYVNvcnRpbmcgYXJyYXkgc2hvdWxkIAoJCSAqIGNvbnRhaW4gYW4gYXJyYXkgZm9yIGVhY2ggY29sdW1uIHRvIGJlIHNvcnRlZCBpbml0aWFsbHkgY29udGFpbmluZyB0aGUgCgkJICogY29sdW1uJ3MgaW5kZXggYW5kIGEgZGlyZWN0aW9uIHN0cmluZyAoJ2FzYycgb3IgJ2Rlc2MnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW1swLCdhc2MnXV0KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNvcnQgYnkgM3JkIGNvbHVtbiBmaXJzdCwgYW5kIHRoZW4gNHRoIGNvbHVtbgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmciOiBbWzIsJ2FzYyddLCBbMywnZGVzYyddXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICAvLyBObyBpbml0aWFsIHNvcnRpbmcKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFTb3J0aW5nIjogW10KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhU29ydGluZyI6IFtbMCwnYXNjJ11dLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBpcyBiYXNpY2FsbHkgaWRlbnRpY2FsIHRvIHRoZSBhYVNvcnRpbmcgcGFyYW1ldGVyLCBidXQgCgkJICogY2Fubm90IGJlIG92ZXJyaWRkZW4gYnkgdXNlciBpbnRlcmFjdGlvbiB3aXRoIHRoZSB0YWJsZS4gV2hhdCB0aGlzIG1lYW5zIAoJCSAqIGlzIHRoYXQgeW91IGNvdWxkIGhhdmUgYSBjb2x1bW4gKHZpc2libGUgb3IgaGlkZGVuKSB3aGljaCB0aGUgc29ydGluZyB3aWxsIAoJCSAqIGFsd2F5cyBiZSBmb3JjZWQgb24gZmlyc3QgLSBhbnkgc29ydGluZyBhZnRlciB0aGF0IChmcm9tIHRoZSB1c2VyKSB3aWxsIAoJCSAqIHRoZW4gYmUgcGVyZm9ybWVkIGFzIHJlcXVpcmVkLiBUaGlzIGNhbiBiZSB1c2VmdWwgZm9yIGdyb3VwaW5nIHJvd3MgCgkJICogdG9nZXRoZXIuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmdGaXhlZCI6IFtbMCwnYXNjJ11dCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byByZWFkaWx5IHNwZWNpZnkgdGhlIGVudHJpZXMgaW4gdGhlIGxlbmd0aCBkcm9wCgkJICogZG93biBtZW51IHRoYXQgRGF0YVRhYmxlcyBzaG93cyB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4gSXQgY2FuIGJlIAoJCSAqIGVpdGhlciBhIDFEIGFycmF5IG9mIG9wdGlvbnMgd2hpY2ggd2lsbCBiZSB1c2VkIGZvciBib3RoIHRoZSBkaXNwbGF5ZWQgCgkJICogb3B0aW9uIGFuZCB0aGUgdmFsdWUsIG9yIGEgMkQgYXJyYXkgd2hpY2ggd2lsbCB1c2UgdGhlIGFycmF5IGluIHRoZSBmaXJzdCAKCQkgKiBwb3NpdGlvbiBhcyB0aGUgdmFsdWUsIGFuZCB0aGUgYXJyYXkgaW4gdGhlIHNlY29uZCBwb3NpdGlvbiBhcyB0aGUgCgkJICogZGlzcGxheWVkIG9wdGlvbnMgKHVzZWZ1bCBmb3IgbGFuZ3VhZ2Ugc3RyaW5ncyBzdWNoIGFzICdBbGwnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgWyAxMCwgMjUsIDUwLCAxMDAgXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzEwLCAyNSwgNTAsIC0xXSwgWzEwLCAyNSwgNTAsICJBbGwiXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNldHRpbmcgdGhlIGRlZmF1bHQgZGlzcGxheSBsZW5ndGggYXMgd2VsbCBhcyBsZW5ndGggbWVudQoJCSAqICAgIC8vIFRoaXMgaXMgbGlrZWx5IHRvIGJlIHdhbnRlZCBpZiB5b3UgcmVtb3ZlIHRoZSAnMTAnIG9wdGlvbiB3aGljaAoJCSAqICAgIC8vIGlzIHRoZSBpRGlzcGxheUxlbmd0aCBkZWZhdWx0LgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogMjUsCgkJICogICAgICAgICJhTGVuZ3RoTWVudSI6IFtbMjUsIDUwLCAxMDAsIC0xXSwgWzI1LCA1MCwgMTAwLCAiQWxsIl1dCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhTGVuZ3RoTWVudSI6IFsgMTAsIDI1LCA1MCwgMTAwIF0sCgkKCQoJCS8qKgoJCSAqIFRoZSBhb0NvbHVtbnMgb3B0aW9uIGluIHRoZSBpbml0aWFsaXNhdGlvbiBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byBkZWZpbmUKCQkgKiBkZXRhaWxzIGFib3V0IHRoZSB3YXkgaW5kaXZpZHVhbCBjb2x1bW5zIGJlaGF2ZS4gRm9yIGEgZnVsbCBsaXN0IG9mCgkJICogY29sdW1uIG9wdGlvbnMgdGhhdCBjYW4gYmUgc2V0LCBwbGVhc2Ugc2VlIAoJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uc30uIE5vdGUgdGhhdCBpZiB5b3UgdXNlIGFvQ29sdW1ucyB0bwoJCSAqIGRlZmluZSB5b3VyIGNvbHVtbnMsIHlvdSBtdXN0IGhhdmUgYW4gZW50cnkgaW4gdGhlIGFycmF5IGZvciBldmVyeSBzaW5nbGUKCQkgKiBjb2x1bW4gdGhhdCB5b3UgaGF2ZSBpbiB5b3VyIHRhYmxlICh0aGVzZSBjYW4gYmUgbnVsbCBpZiB5b3UgZG9uJ3Qgd2hpY2gKCQkgKiB0byBzcGVjaWZ5IGFueSBvcHRpb25zKS4KCQkgKiAgQG1lbWJlcgoJCSAqLwoJCSJhb0NvbHVtbnMiOiBudWxsLAoJCgkJLyoqCgkJICogVmVyeSBzaW1pbGFyIHRvIGFvQ29sdW1ucywgYW9Db2x1bW5EZWZzIGFsbG93cyB5b3UgdG8gdGFyZ2V0IGEgc3BlY2lmaWMgCgkJICogY29sdW1uLCBtdWx0aXBsZSBjb2x1bW5zLCBvciBhbGwgY29sdW1ucywgdXNpbmcgdGhlIGFUYXJnZXRzIHByb3BlcnR5IG9mIAoJCSAqIGVhY2ggb2JqZWN0IGluIHRoZSBhcnJheS4gVGhpcyBhbGxvd3MgZ3JlYXQgZmxleGliaWxpdHkgd2hlbiBjcmVhdGluZyAKCQkgKiB0YWJsZXMsIGFzIHRoZSBhb0NvbHVtbkRlZnMgYXJyYXlzIGNhbiBiZSBvZiBhbnkgbGVuZ3RoLCB0YXJnZXRpbmcgdGhlIAoJCSAqIGNvbHVtbnMgeW91IHNwZWNpZmljYWxseSB3YW50LiBhb0NvbHVtbkRlZnMgbWF5IHVzZSBhbnkgb2YgdGhlIGNvbHVtbiAKCQkgKiBvcHRpb25zIGF2YWlsYWJsZToge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zfSwgYnV0IGl0IF9tdXN0XwoJCSAqIGhhdmUgYVRhcmdldHMgZGVmaW5lZCBpbiBlYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkuIFZhbHVlcyBpbiB0aGUgYVRhcmdldHMKCQkgKiBhcnJheSBtYXkgYmU6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5hIHN0cmluZyAtIGNsYXNzIG5hbWUgd2lsbCBiZSBtYXRjaGVkIG9uIHRoZSBUSCBmb3IgdGhlIGNvbHVtbjwvbGk+CgkJICogICAgIDxsaT4wIG9yIGEgcG9zaXRpdmUgaW50ZWdlciAtIGNvbHVtbiBpbmRleCBjb3VudGluZyBmcm9tIHRoZSBsZWZ0PC9saT4KCQkgKiAgICAgPGxpPmEgbmVnYXRpdmUgaW50ZWdlciAtIGNvbHVtbiBpbmRleCBjb3VudGluZyBmcm9tIHRoZSByaWdodDwvbGk+CgkJICogICAgIDxsaT50aGUgc3RyaW5nICJfYWxsIiAtIGFsbCBjb2x1bW5zIChpLmUuIGFzc2lnbiBhIGRlZmF1bHQpPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEBtZW1iZXIKCQkgKi8KCQkiYW9Db2x1bW5EZWZzIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQmFzaWNhbGx5IHRoZSBzYW1lIGFzIG9TZWFyY2gsIHRoaXMgcGFyYW1ldGVyIGRlZmluZXMgdGhlIGluZGl2aWR1YWwgY29sdW1uCgkJICogZmlsdGVyaW5nIHN0YXRlIGF0IGluaXRpYWxpc2F0aW9uIHRpbWUuIFRoZSBhcnJheSBtdXN0IGJlIG9mIHRoZSBzYW1lIHNpemUgCgkJICogYXMgdGhlIG51bWJlciBvZiBjb2x1bW5zLCBhbmQgZWFjaCBlbGVtZW50IGJlIGFuIG9iamVjdCB3aXRoIHRoZSBwYXJhbWV0ZXJzCgkJICogInNTZWFyY2giIGFuZCAiYkVzY2FwZVJlZ2V4IiAodGhlIGxhdHRlciBpcyBvcHRpb25hbCkuICdudWxsJyBpcyBhbHNvCgkJICogYWNjZXB0ZWQgYW5kIHRoZSBkZWZhdWx0IHdpbGwgYmUgdXNlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb1NlYXJjaENvbHMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJzU2VhcmNoIjogIk15IGZpbHRlciIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTZWFyY2giOiAiXlswLTldIiwgImJFc2NhcGVSZWdleCI6IGZhbHNlIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJhb1NlYXJjaENvbHMiOiBbXSwKCQoJCgkJLyoqCgkJICogQW4gYXJyYXkgb2YgQ1NTIGNsYXNzZXMgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBkaXNwbGF5ZWQgcm93cy4gVGhpcyAKCQkgKiBhcnJheSBtYXkgYmUgb2YgYW55IGxlbmd0aCwgYW5kIERhdGFUYWJsZXMgd2lsbCBhcHBseSBlYWNoIGNsYXNzIAoJCSAqIHNlcXVlbnRpYWxseSwgbG9vcGluZyB3aGVuIHJlcXVpcmVkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbICdvZGQnLCAnZXZlbicgXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFzU3RyaXBlQ2xhc3NlcyI6IFsgJ3N0cmlwMScsICdzdHJpcDInLCAnc3RyaXAzJyBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFzU3RyaXBlQ2xhc3NlcyI6IFsgJ29kZCcsICdldmVuJyBdLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBhdXRvbWF0aWMgY29sdW1uIHdpZHRoIGNhbGN1bGF0aW9uLiBUaGlzIGNhbiBiZSBkaXNhYmxlZAoJCSAqIGFzIGFuIG9wdGltaXNhdGlvbiAoaXQgdGFrZXMgc29tZSB0aW1lIHRvIGNhbGN1bGF0ZSB0aGUgd2lkdGhzKSBpZiB0aGUKCQkgKiB0YWJsZXMgd2lkdGhzIGFyZSBwYXNzZWQgaW4gdXNpbmcgYW9Db2x1bW5zLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiQXV0b1dpZHRoIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJBdXRvV2lkdGgiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBEZWZlcnJlZCByZW5kZXJpbmcgY2FuIHByb3ZpZGUgRGF0YVRhYmxlcyB3aXRoIGEgaHVnZSBzcGVlZCBib29zdCB3aGVuIHlvdQoJCSAqIGFyZSB1c2luZyBhbiBBamF4IG9yIEpTIGRhdGEgc291cmNlIGZvciB0aGUgdGFibGUuIFRoaXMgb3B0aW9uLCB3aGVuIHNldCB0bwoJCSAqIHRydWUsIHdpbGwgY2F1c2UgRGF0YVRhYmxlcyB0byBkZWZlciB0aGUgY3JlYXRpb24gb2YgdGhlIHRhYmxlIGVsZW1lbnRzIGZvcgoJCSAqIGVhY2ggcm93IHVudGlsIHRoZXkgYXJlIG5lZWRlZCBmb3IgYSBkcmF3IC0gc2F2aW5nIGEgc2lnbmlmaWNhbnQgYW1vdW50IG9mCgkJICogdGltZS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9hcnJheXMudHh0IiwKCQkgKiAgICAgICAgImJEZWZlclJlbmRlciI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJEZWZlclJlbmRlciI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBSZXBsYWNlIGEgRGF0YVRhYmxlIHdoaWNoIG1hdGNoZXMgdGhlIGdpdmVuIHNlbGVjdG9yIGFuZCByZXBsYWNlIGl0IHdpdGggCgkJICogb25lIHdoaWNoIGhhcyB0aGUgcHJvcGVydGllcyBvZiB0aGUgbmV3IGluaXRpYWxpc2F0aW9uIG9iamVjdCBwYXNzZWQuIElmIG5vCgkJICogdGFibGUgbWF0Y2hlcyB0aGUgc2VsZWN0b3IsIHRoZW4gdGhlIG5ldyBEYXRhVGFibGUgd2lsbCBiZSBjb25zdHJ1Y3RlZCBhcwoJCSAqIHBlciBub3JtYWwuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb21lIHRpbWUgbGF0ZXIuLi4uCgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkZpbHRlciI6IGZhbHNlLAoJCSAqICAgICAgICAiYkRlc3Ryb3kiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRGVzdHJveSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBmaWx0ZXJpbmcgb2YgZGF0YS4gRmlsdGVyaW5nIGluIERhdGFUYWJsZXMgaXMgInNtYXJ0IiBpbgoJCSAqIHRoYXQgaXQgYWxsb3dzIHRoZSBlbmQgdXNlciB0byBpbnB1dCBtdWx0aXBsZSB3b3JkcyAoc3BhY2Ugc2VwYXJhdGVkKSBhbmQKCQkgKiB3aWxsIG1hdGNoIGEgcm93IGNvbnRhaW5pbmcgdGhvc2Ugd29yZHMsIGV2ZW4gaWYgbm90IGluIHRoZSBvcmRlciB0aGF0IHdhcwoJCSAqIHNwZWNpZmllZCAodGhpcyBhbGxvdyBtYXRjaGluZyBhY3Jvc3MgbXVsdGlwbGUgY29sdW1ucykuIE5vdGUgdGhhdCBpZiB5b3UKCQkgKiB3aXNoIHRvIHVzZSBmaWx0ZXJpbmcgaW4gRGF0YVRhYmxlcyB0aGlzIG11c3QgcmVtYWluICd0cnVlJyAtIHRvIHJlbW92ZSB0aGUKCQkgKiBkZWZhdWx0IGZpbHRlcmluZyBpbnB1dCBib3ggYW5kIHJldGFpbiBmaWx0ZXJpbmcgYWJpbGl0aWVzLCBwbGVhc2UgdXNlCgkJICogQHJlZntzRG9tfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkZpbHRlciI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRmlsdGVyIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIHRhYmxlIGluZm9ybWF0aW9uIGRpc3BsYXkuIFRoaXMgc2hvd3MgaW5mb3JtYXRpb24gCgkJICogYWJvdXQgdGhlIGRhdGEgdGhhdCBpcyBjdXJyZW50bHkgdmlzaWJsZSBvbiB0aGUgcGFnZSwgaW5jbHVkaW5nIGluZm9ybWF0aW9uCgkJICogYWJvdXQgZmlsdGVyZWQgZGF0YSBpZiB0aGF0IGFjdGlvbiBpcyBiZWluZyBwZXJmb3JtZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJJbmZvIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJJbmZvIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGpRdWVyeSBVSSBUaGVtZVJvbGxlciBzdXBwb3J0IChyZXF1aXJlZCBhcyBUaGVtZVJvbGxlciByZXF1aXJlcyBzb21lCgkJICogc2xpZ2h0bHkgZGlmZmVyZW50IGFuZCBhZGRpdGlvbmFsIG1hcmstdXAgZnJvbSB3aGF0IERhdGFUYWJsZXMgaGFzCgkJICogdHJhZGl0aW9uYWxseSB1c2VkKS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkpRdWVyeVVJIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkpRdWVyeVVJIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEFsbG93cyB0aGUgZW5kIHVzZXIgdG8gc2VsZWN0IHRoZSBzaXplIG9mIGEgZm9ybWF0dGVkIHBhZ2UgZnJvbSBhIHNlbGVjdAoJCSAqIG1lbnUgKHNpemVzIGFyZSAxMCwgMjUsIDUwIGFuZCAxMDApLiBSZXF1aXJlcyBwYWdpbmF0aW9uIChiUGFnaW5hdGUpLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBwYWdpbmF0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlBhZ2luYXRlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgYSAncHJvY2Vzc2luZycgaW5kaWNhdG9yIHdoZW4gdGhlIHRhYmxlIGlzCgkJICogYmVpbmcgcHJvY2Vzc2VkIChlLmcuIGEgc29ydCkuIFRoaXMgaXMgcGFydGljdWxhcmx5IHVzZWZ1bCBmb3IgdGFibGVzIHdpdGgKCQkgKiBsYXJnZSBhbW91bnRzIG9mIGRhdGEgd2hlcmUgaXQgY2FuIHRha2UgYSBub3RpY2VhYmxlIGFtb3VudCBvZiB0aW1lIHRvIHNvcnQKCQkgKiB0aGUgZW50cmllcy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlByb2Nlc3NpbmciOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogUmV0cmlldmUgdGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gc2VsZWN0b3IuIE5vdGUgdGhhdCBpZiB0aGUKCQkgKiB0YWJsZSBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYWxpc2VkLCB0aGlzIHBhcmFtZXRlciB3aWxsIGNhdXNlIERhdGFUYWJsZXMKCQkgKiB0byBzaW1wbHkgcmV0dXJuIHRoZSBvYmplY3QgdGhhdCBoYXMgYWxyZWFkeSBiZWVuIHNldCB1cCAtIGl0IHdpbGwgbm90IHRha2UKCQkgKiBhY2NvdW50IG9mIGFueSBjaGFuZ2VzIHlvdSBtaWdodCBoYXZlIG1hZGUgdG8gdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdAoJCSAqIHBhc3NlZCB0byBEYXRhVGFibGVzIChzZXR0aW5nIHRoaXMgcGFyYW1ldGVyIHRvIHRydWUgaXMgYW4gYWNrbm93bGVkZ2VtZW50CgkJICogdGhhdCB5b3UgdW5kZXJzdGFuZCB0aGlzKS4gYkRlc3Ryb3kgY2FuIGJlIHVzZWQgdG8gcmVpbml0aWFsaXNlIGEgdGFibGUgaWYKCQkgKiB5b3UgbmVlZC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgaW5pdFRhYmxlKCk7CgkJICogICAgICB0YWJsZUFjdGlvbnMoKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogICAgZnVuY3Rpb24gaW5pdFRhYmxlICgpCgkJICogICAgewoJCSAqICAgICAgcmV0dXJuICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZSwKCQkgKiAgICAgICAgImJSZXRyaWV2ZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9CgkJICogICAgCgkJICogICAgZnVuY3Rpb24gdGFibGVBY3Rpb25zICgpCgkJICogICAgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9IGluaXRUYWJsZSgpOwoJCSAqICAgICAgLy8gcGVyZm9ybSBBUEkgb3BlcmF0aW9ucyB3aXRoIG9UYWJsZSAKCQkgKiAgICB9CgkJICovCgkJImJSZXRyaWV2ZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiBEYXRhVGFibGVzIHNob3VsZCBiZSBhbGxvd2VkIHRvIHNldCB0aGUgcGFkZGluZyAvIG1hcmdpbgoJCSAqIGV0YyBmb3IgdGhlIHNjcm9sbGluZyBoZWFkZXIgZWxlbWVudHMgb3Igbm90LiBUeXBpY2FsbHkgeW91IHdpbGwgd2FudAoJCSAqIHRoaXMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTY3JvbGxBdXRvQ3NzIjogZmFsc2UsCgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxBdXRvQ3NzIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB2ZXJ0aWNhbCAoeSkgc2Nyb2xsaW5nIGlzIGVuYWJsZWQsIERhdGFUYWJsZXMgd2lsbCBmb3JjZSB0aGUgaGVpZ2h0IG9mCgkJICogdGhlIHRhYmxlJ3Mgdmlld3BvcnQgdG8gdGhlIGdpdmVuIGhlaWdodCBhdCBhbGwgdGltZXMgKHVzZWZ1bCBmb3IgbGF5b3V0KS4KCQkgKiBIb3dldmVyLCB0aGlzIGNhbiBsb29rIG9kZCB3aGVuIGZpbHRlcmluZyBkYXRhIGRvd24gdG8gYSBzbWFsbCBkYXRhIHNldCwKCQkgKiBhbmQgdGhlIGZvb3RlciBpcyBsZWZ0ICJmbG9hdGluZyIgZnVydGhlciBkb3duLiBUaGlzIHBhcmFtZXRlciAod2hlbgoJCSAqIGVuYWJsZWQpIHdpbGwgY2F1c2UgRGF0YVRhYmxlcyB0byBjb2xsYXBzZSB0aGUgdGFibGUncyB2aWV3cG9ydCBkb3duIHdoZW4KCQkgKiB0aGUgcmVzdWx0IHNldCB3aWxsIGZpdCB3aXRoaW4gdGhlIGdpdmVuIFkgaGVpZ2h0LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwIiwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxDb2xsYXBzZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgaW5maW5pdGUgc2Nyb2xsaW5nIGZvciBEYXRhVGFibGVzICh0byBiZSB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGgKCQkgKiBzU2Nyb2xsWSkuIEluZmluaXRlIHNjcm9sbGluZyBtZWFucyB0aGF0IERhdGFUYWJsZXMgd2lsbCBjb250aW51YWxseSBsb2FkCgkJICogZGF0YSBhcyBhIHVzZXIgc2Nyb2xscyB0aHJvdWdoIGEgdGFibGUsIHdoaWNoIGlzIHZlcnkgdXNlZnVsIGZvciBsYXJnZQoJCSAqIGRhdGFzZXQuIFRoaXMgY2Fubm90IGJlIHVzZWQgd2l0aCBwYWdpbmF0aW9uLCB3aGljaCBpcyBhdXRvbWF0aWNhbGx5CgkJICogZGlzYWJsZWQuIE5vdGUgLSB0aGUgU2Nyb2xsZXIgZXh0cmEgZm9yIERhdGFUYWJsZXMgaXMgcmVjb21tZW5kZWQgaW4KCQkgKiBpbiBwcmVmZXJlbmNlIHRvIHRoaXMgb3B0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTY3JvbGxJbmZpbml0ZSI6IHRydWUsCgkJICogICAgICAgICJiU2Nyb2xsQ29sbGFwc2UiOiB0cnVlLAoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2Nyb2xsSW5maW5pdGUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogQ29uZmlndXJlIERhdGFUYWJsZXMgdG8gdXNlIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIE5vdGUgdGhhdCB0aGUKCQkgKiBzQWpheFNvdXJjZSBwYXJhbWV0ZXIgbXVzdCBhbHNvIGJlIGdpdmVuIGluIG9yZGVyIHRvIGdpdmUgRGF0YVRhYmxlcyBhCgkJICogc291cmNlIHRvIG9idGFpbiB0aGUgcmVxdWlyZWQgZGF0YSBmb3IgZWFjaCBkcmF3LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInhoci5waHAiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2VydmVyU2lkZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBzb3J0aW5nIG9mIGNvbHVtbnMuIFNvcnRpbmcgb2YgaW5kaXZpZHVhbCBjb2x1bW5zIGNhbiBiZQoJCSAqIGRpc2FibGVkIGJ5IHRoZSAiYlNvcnRhYmxlIiBvcHRpb24gZm9yIGVhY2ggY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU29ydCI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU29ydCI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEFsbG93cyBjb250cm9sIG92ZXIgd2hldGhlciBEYXRhVGFibGVzIHNob3VsZCB1c2UgdGhlIHRvcCAodHJ1ZSkgdW5pcXVlCgkJICogY2VsbCB0aGF0IGlzIGZvdW5kIGZvciBhIHNpbmdsZSBjb2x1bW4sIG9yIHRoZSBib3R0b20gKGZhbHNlIC0gZGVmYXVsdCkuCgkJICogVGhpcyBpcyB1c2VmdWwgd2hlbiB1c2luZyBjb21wbGV4IGhlYWRlcnMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU29ydENlbGxzVG9wIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRDZWxsc1RvcCI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSB0aGUgYWRkaXRpb24gb2YgdGhlIGNsYXNzZXMgJ3NvcnRpbmdfMScsICdzb3J0aW5nXzInIGFuZAoJCSAqICdzb3J0aW5nXzMnIHRvIHRoZSBjb2x1bW5zIHdoaWNoIGFyZSBjdXJyZW50bHkgYmVpbmcgc29ydGVkIG9uLiBUaGlzIGlzCgkJICogcHJlc2VudGVkIGFzIGEgZmVhdHVyZSBzd2l0Y2ggYXMgaXQgY2FuIGluY3JlYXNlIHByb2Nlc3NpbmcgdGltZSAod2hpbGUKCQkgKiBjbGFzc2VzIGFyZSByZW1vdmVkIGFuZCBhZGRlZCkgc28gZm9yIGxhcmdlIGRhdGEgc2V0cyB5b3UgbWlnaHQgd2FudCB0bwoJCSAqIHR1cm4gdGhpcyBvZmYuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTb3J0Q2xhc3NlcyI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU29ydENsYXNzZXMiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBzdGF0ZSBzYXZpbmcuIFdoZW4gZW5hYmxlZCBhIGNvb2tpZSB3aWxsIGJlIHVzZWQgdG8gc2F2ZQoJCSAqIHRhYmxlIGRpc3BsYXkgaW5mb3JtYXRpb24gc3VjaCBhcyBwYWdpbmF0aW9uIGluZm9ybWF0aW9uLCBkaXNwbGF5IGxlbmd0aCwKCQkgKiBmaWx0ZXJpbmcgYW5kIHNvcnRpbmcuIEFzIHN1Y2ggd2hlbiB0aGUgZW5kIHVzZXIgcmVsb2FkcyB0aGUgcGFnZSB0aGUKCQkgKiBkaXNwbGF5IGRpc3BsYXkgd2lsbCBtYXRjaCB3aGF0IHRoeSBoYWQgcHJldmlvdXNseSBzZXQgdXAuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlN0YXRlU2F2ZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBDdXN0b21pc2UgdGhlIGNvb2tpZSBhbmQgLyBvciB0aGUgcGFyYW1ldGVycyBiZWluZyBzdG9yZWQgd2hlbiB1c2luZwoJCSAqIERhdGFUYWJsZXMgd2l0aCBzdGF0ZSBzYXZpbmcgZW5hYmxlZC4gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIKCQkgKiB0aGUgY29va2llIGlzIG1vZGlmaWVkLCBhbmQgaXQgZXhwZWN0cyBhIGZ1bGx5IGZvcm1lZCBjb29raWUgc3RyaW5nIHRvIGJlCgkJICogcmV0dXJuZWQuIE5vdGUgdGhhdCB0aGUgZGF0YSBvYmplY3QgcGFzc2VkIGluIGlzIGEgSmF2YXNjcmlwdCBvYmplY3Qgd2hpY2gKCQkgKiBtdXN0IGJlIGNvbnZlcnRlZCB0byBhIHN0cmluZyAoSlNPTi5zdHJpbmdpZnkgZm9yIGV4YW1wbGUpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgTmFtZSBvZiB0aGUgY29va2llIGRlZmluZWQgYnkgRGF0YVRhYmxlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgRGF0YSB0byBiZSBzdG9yZWQgaW4gdGhlIGNvb2tpZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0V4cGlyZXMgQ29va2llIGV4cGlyZXMgc3RyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUGF0aCBQYXRoIG9mIHRoZSBjb29raWUgdG8gc2V0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IENvb2tpZSBmb3JtYXR0ZWQgc3RyaW5nICh3aGljaCBzaG91bGQgYmUgZW5jb2RlZCBieQoJCSAqICAgIHVzaW5nIGVuY29kZVVSSUNvbXBvbmVudCgpKQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkNvb2tpZUNhbGxiYWNrIjogZnVuY3Rpb24gKHNOYW1lLCBvRGF0YSwgc0V4cGlyZXMsIHNQYXRoKSB7CgkJICogICAgICAgICAgLy8gQ3VzdG9taXNlIG9EYXRhIG9yIHNOYW1lIG9yIHdoYXRldmVyIGVsc2UgaGVyZQoJCSAqICAgICAgICAgIHJldHVybiBzTmFtZSArICI9IitKU09OLnN0cmluZ2lmeShvRGF0YSkrIjsgZXhwaXJlcz0iICsgc0V4cGlyZXMgKyI7IHBhdGg9IiArIHNQYXRoOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNvb2tpZUNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiBhIFRSIGVsZW1lbnQgaXMgY3JlYXRlZCAoYW5kIGFsbCBURCBjaGlsZAoJCSAqIGVsZW1lbnRzIGhhdmUgYmVlbiBpbnNlcnRlZCksIG9yIHJlZ2lzdGVyZWQgaWYgdXNpbmcgYSBET00gc291cmNlLCBhbGxvd2luZwoJCSAqIG1hbmlwdWxhdGlvbiBvZiB0aGUgVFIgZWxlbWVudCAoYWRkaW5nIGNsYXNzZXMgZXRjKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURhdGFJbmRleCBUaGUgaW5kZXggb2YgdGhpcyByb3cgaW4gYW9EYXRhCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkNyZWF0ZWRSb3ciOiBmdW5jdGlvbiggblJvdywgYURhdGEsIGlEYXRhSW5kZXggKSB7CgkJICogICAgICAgICAgLy8gQm9sZCB0aGUgZ3JhZGUgZm9yIGFsbCAnQScgZ3JhZGUgYnJvd3NlcnMKCQkgKiAgICAgICAgICBpZiAoIGFEYXRhWzRdID09ICJBIiApCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgJCgndGQ6ZXEoNCknLCBuUm93KS5odG1sKCAnPGI+QTwvYj4nICk7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNyZWF0ZWRSb3ciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBldmVyeSAnZHJhdycgZXZlbnQsIGFuZCBhbGxvd3MgeW91IHRvCgkJICogZHluYW1pY2FsbHkgbW9kaWZ5IGFueSBhc3BlY3QgeW91IHdhbnQgYWJvdXQgdGhlIGNyZWF0ZWQgRE9NLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5EcmF3Q2FsbGJhY2siOiBmdW5jdGlvbigpIHsKCQkgKiAgICAgICAgICBhbGVydCggJ0RhdGFUYWJsZXMgaGFzIHJlZHJhd24gdGhlIHRhYmxlJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkRyYXdDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElkZW50aWNhbCB0byBmbkhlYWRlckNhbGxiYWNrKCkgYnV0IGZvciB0aGUgdGFibGUgZm9vdGVyIHRoaXMgZnVuY3Rpb24KCQkgKiBhbGxvd3MgeW91IHRvIG1vZGlmeSB0aGUgdGFibGUgZm9vdGVyIG9uIGV2ZXJ5ICdkcmF3JyBldmVuLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Gb290ICJUUiIgZWxlbWVudCBmb3IgdGhlIGZvb3RlcgoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBGdWxsIHRhYmxlIGRhdGEgKGFzIGRlcml2ZWQgZnJvbSB0aGUgb3JpZ2luYWwgSFRNTCkKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBzdGFydGluZyBwb2ludCBpbiB0aGUgCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlIAoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheSBpbnR9IGFpRGlzcGxheSBJbmRleCBhcnJheSB0byB0cmFuc2xhdGUgdGhlIHZpc3VhbCBwb3NpdGlvbgoJCSAqICAgIHRvIHRoZSBmdWxsIGRhdGEgYXJyYXkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkZvb3RlckNhbGxiYWNrIjogZnVuY3Rpb24oIG5Gb290LCBhRGF0YSwgaVN0YXJ0LCBpRW5kLCBhaURpc3BsYXkgKSB7CgkJICogICAgICAgICAgbkZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJylbMF0uaW5uZXJIVE1MID0gIlN0YXJ0aW5nIGluZGV4IGlzICIraVN0YXJ0OwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuRm9vdGVyQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBXaGVuIHJlbmRlcmluZyBsYXJnZSBudW1iZXJzIGluIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGZvciB0aGUgdGFibGUKCQkgKiAoaS5lLiAiU2hvd2luZyAxIHRvIDEwIG9mIDU3IGVudHJpZXMiKSBEYXRhVGFibGVzIHdpbGwgcmVuZGVyIGxhcmdlIG51bWJlcnMKCQkgKiB0byBoYXZlIGEgY29tbWEgc2VwYXJhdG9yIGZvciB0aGUgJ3Rob3VzYW5kcycgdW5pdHMgKGUuZy4gMSBtaWxsaW9uIGlzCgkJICogcmVuZGVyZWQgYXMgIjEsMDAwLDAwMCIpIHRvIGhlbHAgcmVhZGFiaWxpdHkgZm9yIHRoZSBlbmQgdXNlci4gVGhpcwoJCSAqIGZ1bmN0aW9uIHdpbGwgb3ZlcnJpZGUgdGhlIGRlZmF1bHQgbWV0aG9kIERhdGFUYWJsZXMgdXNlcy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge2ludH0gaUluIG51bWJlciB0byBiZSBmb3JtYXR0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gZm9ybWF0dGVkIHN0cmluZyBmb3IgRGF0YVRhYmxlcyB0byBzaG93IHRoZSBudW1iZXIKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRm9ybWF0TnVtYmVyIjogZnVuY3Rpb24gKCBpSW4gKSB7CgkJICogICAgICAgICAgaWYgKCBpSW4gJmx0OyAxMDAwICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIGlJbjsKCQkgKiAgICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgICAgdmFyIAoJCSAqICAgICAgICAgICAgICBzPShpSW4rIiIpLCAKCQkgKiAgICAgICAgICAgICAgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCAKCQkgKiAgICAgICAgICAgICAgaUxlbj1zLmxlbmd0aDsKCQkgKiAgICAgICAgICAgIAoJCSAqICAgICAgICAgICAgZm9yICggdmFyIGk9MCA7IGkmbHQ7aUxlbiA7IGkrKyApIHsKCQkgKiAgICAgICAgICAgICAgaWYgKCBpJTMgPT09IDAgJmFtcDsmYW1wOyBpICE9PSAwICkgewoJCSAqICAgICAgICAgICAgICAgIG91dCA9ICInIitvdXQ7CgkJICogICAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgICAgb3V0ID0gYVtpTGVuLWktMV0rb3V0OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICByZXR1cm4gb3V0OwoJCSAqICAgICAgICB9OwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Gb3JtYXROdW1iZXIiOiBmdW5jdGlvbiAoIGlJbiApIHsKCQkJaWYgKCBpSW4gPCAxMDAwICkKCQkJewoJCQkJLy8gQSBzbWFsbCBvcHRpbWlzYXRpb24gZm9yIHdoYXQgaXMgbGlrZWx5IHRvIGJlIHRoZSBtYWpvcml0eSBvZiB1c2UgY2FzZXMKCQkJCXJldHVybiBpSW47CgkJCX0KCQoJCQl2YXIgcz0oaUluKyIiKSwgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCBpTGVuPXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggaSUzID09PSAwICYmIGkgIT09IDAgKQoJCQkJewoJCQkJCW91dCA9IHRoaXMub0xhbmd1YWdlLnNJbmZvVGhvdXNhbmRzK291dDsKCQkJCX0KCQkJCW91dCA9IGFbaUxlbi1pLTFdK291dDsKCQkJfQoJCQlyZXR1cm4gb3V0OwoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIG9uIGV2ZXJ5ICdkcmF3JyBldmVudCwgYW5kIGFsbG93cyB5b3UgdG8KCQkgKiBkeW5hbWljYWxseSBtb2RpZnkgdGhlIGhlYWRlciByb3cuIFRoaXMgY2FuIGJlIHVzZWQgdG8gY2FsY3VsYXRlIGFuZAoJCSAqIGRpc3BsYXkgdXNlZnVsIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZCAiVFIiIGVsZW1lbnQgZm9yIHRoZSBoZWFkZXIKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgRnVsbCB0YWJsZSBkYXRhIChhcyBkZXJpdmVkIGZyb20gdGhlIG9yaWdpbmFsIEhUTUwpCgkJICogIEBwYXJhbSB7aW50fSBpU3RhcnQgSW5kZXggZm9yIHRoZSBjdXJyZW50IGRpc3BsYXkgc3RhcnRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5IGludH0gYWlEaXNwbGF5IEluZGV4IGFycmF5IHRvIHRyYW5zbGF0ZSB0aGUgdmlzdWFsIHBvc2l0aW9uCgkJICogICAgdG8gdGhlIGZ1bGwgZGF0YSBhcnJheQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSGVhZGVyQ2FsbGJhY2siOiBmdW5jdGlvbiggbkhlYWQsIGFEYXRhLCBpU3RhcnQsIGlFbmQsIGFpRGlzcGxheSApIHsKCQkgKiAgICAgICAgICBuSGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGgnKVswXS5pbm5lckhUTUwgPSAiRGlzcGxheWluZyAiKyhpRW5kLWlTdGFydCkrIiByZWNvcmRzIjsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJmbkhlYWRlckNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgY2FuIGJlIHVzZWQgdG8gY29udmV5IGluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50CgkJICogc3RhdGUgb2YgdGhlIHRhYmxlLiBBbHRob3VnaCB0aGUgaW50ZXJuYXRpb25hbGlzYXRpb24gb3B0aW9ucyBwcmVzZW50ZWQgYnkKCQkgKiBEYXRhVGFibGVzIGFyZSBxdWl0ZSBjYXBhYmxlIG9mIGRlYWxpbmcgd2l0aCBtb3N0IGN1c3RvbWlzYXRpb25zLCB0aGVyZSBtYXkKCQkgKiBiZSB0aW1lcyB3aGVyZSB5b3Ugd2lzaCB0byBjdXN0b21pc2UgdGhlIHN0cmluZyBmdXJ0aGVyLiBUaGlzIGNhbGxiYWNrCgkJICogYWxsb3dzIHlvdSB0byBkbyBleGFjdGx5IHRoYXQuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBTdGFydGluZyBwb3NpdGlvbiBpbiBkYXRhIGZvciB0aGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBFbmQgcG9zaXRpb24gaW4gZGF0YSBmb3IgdGhlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXggVG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHRhYmxlIChyZWdhcmRsZXNzIG9mCgkJICogICAgZmlsdGVyaW5nKQoJCSAqICBAcGFyYW0ge2ludH0gaVRvdGFsIFRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSBkYXRhIHNldCwgYWZ0ZXIgZmlsdGVyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUHJlIFRoZSBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGhhcyBmb3JtYXR0ZWQgdXNpbmcgaXQncwoJCSAqICAgIG93biBydWxlcwoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc3RyaW5nIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgaW5mb3JtYXRpb24gZWxlbWVudC4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAiZm5JbmZvQ2FsbGJhY2siOiBmdW5jdGlvbiggb1NldHRpbmdzLCBpU3RhcnQsIGlFbmQsIGlNYXgsIGlUb3RhbCwgc1ByZSApIHsKCQkgKiAgICAgICAgcmV0dXJuIGlTdGFydCArIiB0byAiKyBpRW5kOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5JbmZvQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgaGFzIGJlZW4gaW5pdGlhbGlzZWQuIE5vcm1hbGx5IERhdGFUYWJsZXMgd2lsbAoJCSAqIGluaXRpYWxpc2Ugc2VxdWVudGlhbGx5IGFuZCB0aGVyZSB3aWxsIGJlIG5vIG5lZWQgZm9yIHRoaXMgZnVuY3Rpb24sCgkJICogaG93ZXZlciwgdGhpcyBkb2VzIG5vdCBob2xkIHRydWUgd2hlbiB1c2luZyBleHRlcm5hbCBsYW5ndWFnZSBpbmZvcm1hdGlvbgoJCSAqIHNpbmNlIHRoYXQgaXMgb2J0YWluZWQgdXNpbmcgYW4gYXN5bmMgWEhSIGNhbGwuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CgkJICogICAgICAgICAgYWxlcnQoICdEYXRhVGFibGVzIGhhcyBmaW5pc2hlZCBpdHMgaW5pdGlhbGlzYXRpb24uJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuSW5pdENvbXBsZXRlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGVkIGF0IHRoZSB2ZXJ5IHN0YXJ0IG9mIGVhY2ggdGFibGUgZHJhdyBhbmQgY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZQoJCSAqIGRyYXcgYnkgcmV0dXJuaW5nIGZhbHNlLCBhbnkgb3RoZXIgcmV0dXJuIChpbmNsdWRpbmcgdW5kZWZpbmVkKSByZXN1bHRzIGluCgkJICogdGhlIGZ1bGwgZHJhdyBvY2N1cnJpbmcpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sZWFufSBGYWxzZSB3aWxsIGNhbmNlbCB0aGUgZHJhdywgYW55dGhpbmcgZWxzZSAoaW5jbHVkaW5nIG5vCgkJICogICAgcmV0dXJuKSB3aWxsIGFsbG93IGl0IHRvIGNvbXBsZXRlLgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuUHJlRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBpZiAoICQoJyN0ZXN0JykudmFsKCkgPT0gMSApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUHJlRHJhd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvICdwb3N0IHByb2Nlc3MnIGVhY2ggcm93IGFmdGVyIGl0IGhhdmUgYmVlbgoJCSAqIGdlbmVyYXRlZCBmb3IgZWFjaCB0YWJsZSBkcmF3LCBidXQgYmVmb3JlIGl0IGlzIHJlbmRlcmVkIG9uIHNjcmVlbi4gVGhpcwoJCSAqIGZ1bmN0aW9uIG1pZ2h0IGJlIHVzZWQgZm9yIHNldHRpbmcgdGhlIHJvdyBjbGFzcyBuYW1lIGV0Yy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleCBUaGUgZGlzcGxheSBpbmRleCBmb3IgdGhlIGN1cnJlbnQgdGFibGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleEZ1bGwgVGhlIGluZGV4IG9mIHRoZSBkYXRhIGluIHRoZSBmdWxsIGxpc3Qgb2YKCQkgKiAgICByb3dzIChhZnRlciBmaWx0ZXJpbmcpCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmblJvd0NhbGxiYWNrIjogZnVuY3Rpb24oIG5Sb3csIGFEYXRhLCBpRGlzcGxheUluZGV4LCBpRGlzcGxheUluZGV4RnVsbCApIHsKCQkgKiAgICAgICAgICAvLyBCb2xkIHRoZSBncmFkZSBmb3IgYWxsICdBJyBncmFkZSBicm93c2VycwoJCSAqICAgICAgICAgIGlmICggYURhdGFbNF0gPT0gIkEiICkKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAkKCd0ZDplcSg0KScsIG5Sb3cpLmh0bWwoICc8Yj5BPC9iPicgKTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUm93Q2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBhbGxvd3MgeW91IHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGZ1bmN0aW9uIHdoaWNoIG9idGFpbnMKCQkgKiB0aGUgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIgKCQuZ2V0SlNPTikgc28gc29tZXRoaW5nIG1vcmUgc3VpdGFibGUgZm9yIHlvdXIKCQkgKiBhcHBsaWNhdGlvbi4gRm9yIGV4YW1wbGUgeW91IGNvdWxkIHVzZSBQT1NUIGRhdGEsIG9yIHB1bGwgaW5mb3JtYXRpb24gZnJvbQoJCSAqIGEgR2VhcnMgb3IgQUlSIGRhdGFiYXNlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU291cmNlIEhUVFAgc291cmNlIHRvIG9idGFpbiB0aGUgZGF0YSBmcm9tIChzQWpheFNvdXJjZSkKCQkgKiAgQHBhcmFtIHthcnJheX0gYW9EYXRhIEEga2V5L3ZhbHVlIHBhaXIgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRhdGEgdG8gc2VuZAoJCSAqICAgIHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm5DYWxsYmFjayB0byBiZSBjYWxsZWQgb24gY29tcGxldGlvbiBvZiB0aGUgZGF0YSBnZXQKCQkgKiAgICBwcm9jZXNzIHRoYXQgd2lsbCBkcmF3IHRoZSBkYXRhIG9uIHRoZSBwYWdlLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUE9TVCBkYXRhIHRvIHNlcnZlcgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInhoci5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJEYXRhIjogZnVuY3Rpb24gKCBzU291cmNlLCBhb0RhdGEsIGZuQ2FsbGJhY2sgKSB7CgkJICogICAgICAgICAgJC5hamF4KCB7CgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAnanNvbicsIAoJCSAqICAgICAgICAgICAgInR5cGUiOiAiUE9TVCIsIAoJCSAqICAgICAgICAgICAgInVybCI6IHNTb3VyY2UsIAoJCSAqICAgICAgICAgICAgImRhdGEiOiBhb0RhdGEsIAoJCSAqICAgICAgICAgICAgInN1Y2Nlc3MiOiBmbkNhbGxiYWNrCgkJICogICAgICAgICAgfSApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblNlcnZlckRhdGEiOiBmdW5jdGlvbiAoIHNVcmwsIGFvRGF0YSwgZm5DYWxsYmFjaywgb1NldHRpbmdzICkgewoJCQlvU2V0dGluZ3MuanFYSFIgPSAkLmFqYXgoIHsKCQkJCSJ1cmwiOiAgc1VybCwKCQkJCSJkYXRhIjogYW9EYXRhLAoJCQkJInN1Y2Nlc3MiOiBmdW5jdGlvbiAoanNvbikgewoJCQkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigneGhyJywgb1NldHRpbmdzKTsKCQkJCQlmbkNhbGxiYWNrKCBqc29uICk7CgkJCQl9LAoJCQkJImRhdGFUeXBlIjogImpzb24iLAoJCQkJImNhY2hlIjogZmFsc2UsCgkJCQkidHlwZSI6IG9TZXR0aW5ncy5zU2VydmVyTWV0aG9kLAoJCQkJImVycm9yIjogZnVuY3Rpb24gKHhociwgZXJyb3IsIHRocm93bikgewoJCQkJCWlmICggZXJyb3IgPT0gInBhcnNlcmVycm9yIiApIHsKCQkJCQkJYWxlcnQoICJEYXRhVGFibGVzIHdhcm5pbmc6IEpTT04gZGF0YSBmcm9tIHNlcnZlciBjb3VsZCBub3QgYmUgcGFyc2VkLiAiKwoJCQkJCQkJIlRoaXMgaXMgY2F1c2VkIGJ5IGEgSlNPTiBmb3JtYXR0aW5nIGVycm9yLiIgKTsKCQkJCQl9CgkJCQl9CgkJCX0gKTsKCQl9LAoJCgkKCQkvKioKCQkgKiBJdCBpcyBvZnRlbiB1c2VmdWwgdG8gc2VuZCBleHRyYSBkYXRhIHRvIHRoZSBzZXJ2ZXIgd2hlbiBtYWtpbmcgYW4gQWpheAoJCSAqIHJlcXVlc3QgLSBmb3IgZXhhbXBsZSBjdXN0b20gZmlsdGVyaW5nIGluZm9ybWF0aW9uLCBhbmQgdGhpcyBjYWxsYmFjawoJCSAqIGZ1bmN0aW9uIG1ha2VzIGl0IHRyaXZpYWwgdG8gc2VuZCBleHRyYSBpbmZvcm1hdGlvbiB0byB0aGUgc2VydmVyLiBUaGUKCQkgKiBwYXNzZWQgaW4gcGFyYW1ldGVyIGlzIHRoZSBkYXRhIHNldCB0aGF0IGhhcyBiZWVuIGNvbnN0cnVjdGVkIGJ5CgkJICogRGF0YVRhYmxlcywgYW5kIHlvdSBjYW4gYWRkIHRvIHRoaXMgb3IgbW9kaWZ5IGl0IGFzIHlvdSByZXF1aXJlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0RhdGEgRGF0YSBhcnJheSAoYXJyYXkgb2Ygb2JqZWN0cyB3aGljaCBhcmUgbmFtZS92YWx1ZQoJCSAqICAgIHBhaXJzKSB0aGF0IGhhcyBiZWVuIGNvbnN0cnVjdGVkIGJ5IERhdGFUYWJsZXMgYW5kIHdpbGwgYmUgc2VudCB0byB0aGUKCQkgKiAgICBzZXJ2ZXIuIEluIHRoZSBjYXNlIG9mIEFqYXggc291cmNlZCBkYXRhIHdpdGggc2VydmVyLXNpZGUgcHJvY2Vzc2luZwoJCSAqICAgIHRoaXMgd2lsbCBiZSBhbiBlbXB0eSBhcnJheSwgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgdGhlcmUgd2lsbCBiZSBhCgkJICogICAgc2lnbmlmaWNhbnQgbnVtYmVyIG9mIHBhcmFtZXRlcnMhCgkJICogIEByZXR1cm5zIHt1bmRlZmluZWR9IEVuc3VyZSB0aGF0IHlvdSBtb2RpZnkgdGhlIGFvRGF0YSBhcnJheSBwYXNzZWQgaW4sCgkJICogICAgYXMgdGhpcyBpcyBwYXNzZWQgYnkgcmVmZXJlbmNlLgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogIEBkdG9wdCBTZXJ2ZXItc2lkZQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNjcmlwdHMvc2VydmVyX3Byb2Nlc3NpbmcucGhwIiwKCQkgKiAgICAgICAgImZuU2VydmVyUGFyYW1zIjogZnVuY3Rpb24gKCBhb0RhdGEgKSB7CgkJICogICAgICAgICAgYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAibW9yZV9kYXRhIiwgInZhbHVlIjogIm15X3ZhbHVlIiB9ICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU2VydmVyUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogTG9hZCB0aGUgdGFibGUgc3RhdGUuIFdpdGggdGhpcyBmdW5jdGlvbiB5b3UgY2FuIGRlZmluZSBmcm9tIHdoZXJlLCBhbmQgaG93LCB0aGUKCQkgKiBzdGF0ZSBvZiBhIHRhYmxlIGlzIGxvYWRlZC4gQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9hZCBmcm9tIGl0cyBzdGF0ZSBzYXZpbmcKCQkgKiBjb29raWUsIGJ1dCB5b3UgbWlnaHQgd2lzaCB0byB1c2UgbG9jYWwgc3RvcmFnZSAoSFRNTDUpIG9yIGEgc2VydmVyLXNpZGUgZGF0YWJhc2UuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBtZW1iZXIKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJuIHtvYmplY3R9IFRoZSBEYXRhVGFibGVzIHN0YXRlIG9iamVjdCB0byBiZSBsb2FkZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIHZhciBvOwoJCSAqICAgICAgICAgIAoJCSAqICAgICAgICAgIC8vIFNlbmQgYW4gQWpheCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgdG8gZ2V0IHRoZSBkYXRhLiBOb3RlIHRoYXQKCQkgKiAgICAgICAgICAvLyB0aGlzIGlzIGEgc3luY2hyb25vdXMgcmVxdWVzdC4KCQkgKiAgICAgICAgICAkLmFqYXgoIHsKCQkgKiAgICAgICAgICAgICJ1cmwiOiAiL3N0YXRlX2xvYWQiLAoJCSAqICAgICAgICAgICAgImFzeW5jIjogZmFsc2UsCgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAianNvbiIsCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZ1bmN0aW9uIChqc29uKSB7CgkJICogICAgICAgICAgICAgIG8gPSBqc29uOwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICByZXR1cm4gbzsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZUxvYWQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncyApIHsKCQkJdmFyIHNEYXRhID0gdGhpcy5vQXBpLl9mblJlYWRDb29raWUoIG9TZXR0aW5ncy5zQ29va2llUHJlZml4K29TZXR0aW5ncy5zSW5zdGFuY2UgKTsKCQkJdmFyIG9EYXRhOwoJCgkJCXRyeSB7CgkJCQlvRGF0YSA9ICh0eXBlb2YgJC5wYXJzZUpTT04gPT09ICdmdW5jdGlvbicpID8gCgkJCQkJJC5wYXJzZUpTT04oc0RhdGEpIDogZXZhbCggJygnK3NEYXRhKycpJyApOwoJCQl9IGNhdGNoIChlKSB7CgkJCQlvRGF0YSA9IG51bGw7CgkJCX0KCQoJCQlyZXR1cm4gb0RhdGE7CgkJfSwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgd2hpY2ggYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc2F2ZWQgc3RhdGUgcHJpb3IgdG8gbG9hZGluZyB0aGF0IHN0YXRlLgoJCSAqIFRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gdGhlIHRhYmxlIGlzIGxvYWRpbmcgc3RhdGUgZnJvbSB0aGUgc3RvcmVkIGRhdGEsIGJ1dAoJCSAqIHByaW9yIHRvIHRoZSBzZXR0aW5ncyBvYmplY3QgYmVpbmcgbW9kaWZpZWQgYnkgdGhlIHNhdmVkIHN0YXRlLiBOb3RlIHRoYXQgZm9yIAoJCSAqIHBsdWctaW4gYXV0aG9ycywgeW91IHNob3VsZCB1c2UgdGhlICdzdGF0ZUxvYWRQYXJhbXMnIGV2ZW50IHRvIGxvYWQgcGFyYW1ldGVycyBmb3IgCgkJICogYSBwbHVnLWluLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRoYXQgaXMgdG8gYmUgbG9hZGVkCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSZW1vdmUgYSBzYXZlZCBmaWx0ZXIsIHNvIGZpbHRlcmluZyBpcyBuZXZlciBsb2FkZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBvRGF0YS5vRmlsdGVyLnNTZWFyY2ggPSAiIjsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gRGlzYWxsb3cgc3RhdGUgbG9hZGluZyBieSByZXR1cm5pbmcgZmFsc2UKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlTG9hZFBhcmFtcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHRoYXQgaXMgY2FsbGVkIHdoZW4gdGhlIHN0YXRlIGhhcyBiZWVuIGxvYWRlZCBmcm9tIHRoZSBzdGF0ZSBzYXZpbmcgbWV0aG9kCgkJICogYW5kIHRoZSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCBoYXMgYmVlbiBtb2RpZmllZCBhcyBhIHJlc3VsdCBvZiB0aGUgbG9hZGVkIHN0YXRlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRoYXQgd2FzIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gU2hvdyBhbiBhbGVydCB3aXRoIHRoZSBmaWx0ZXJpbmcgdmFsdWUgdGhhdCB3YXMgc2F2ZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkZWQiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIGFsZXJ0KCAnU2F2ZWQgZmlsdGVyIHdhczogJytvRGF0YS5vRmlsdGVyLnNTZWFyY2ggKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVMb2FkZWQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBTYXZlIHRoZSB0YWJsZSBzdGF0ZS4gVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvIGRlZmluZSB3aGVyZSBhbmQgaG93IHRoZSBzdGF0ZQoJCSAqIGluZm9ybWF0aW9uIGZvciB0aGUgdGFibGUgaXMgc3RvcmVkIC0gYnkgZGVmYXVsdCBpdCB3aWxsIHVzZSBhIGNvb2tpZSwgYnV0IHlvdQoJCSAqIG1pZ2h0IHdhbnQgdG8gdXNlIGxvY2FsIHN0b3JhZ2UgKEhUTUw1KSBvciBhIHNlcnZlci1zaWRlIGRhdGFiYXNlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdG8gYmUgc2F2ZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIC8vIFNlbmQgYW4gQWpheCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgd2l0aCB0aGUgc3RhdGUgb2JqZWN0CgkJICogICAgICAgICAgJC5hamF4KCB7CgkJICogICAgICAgICAgICAidXJsIjogIi9zdGF0ZV9zYXZlIiwKCQkgKiAgICAgICAgICAgICJkYXRhIjogb0RhdGEsCgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAianNvbiIsCgkJICogICAgICAgICAgICAibWV0aG9kIjogIlBPU1QiCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZ1bmN0aW9uICgpIHt9CgkJICogICAgICAgICAgfSApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlU2F2ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBvRGF0YSApIHsKCQkJdGhpcy5vQXBpLl9mbkNyZWF0ZUNvb2tpZSggCgkJCQlvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCtvU2V0dGluZ3Muc0luc3RhbmNlLCAKCQkJCXRoaXMub0FwaS5fZm5Kc29uU3RyaW5nKG9EYXRhKSwgCgkJCQlvU2V0dGluZ3MuaUNvb2tpZUR1cmF0aW9uLCAKCQkJCW9TZXR0aW5ncy5zQ29va2llUHJlZml4LCAKCQkJCW9TZXR0aW5ncy5mbkNvb2tpZUNhbGxiYWNrCgkJCSk7CgkJfSwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgd2hpY2ggYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc3RhdGUgdG8gYmUgc2F2ZWQuIENhbGxlZCB3aGVuIHRoZSB0YWJsZSAKCQkgKiBoYXMgY2hhbmdlZCBzdGF0ZSBhIG5ldyBzdGF0ZSBzYXZlIGlzIHJlcXVpcmVkLiBUaGlzIG1ldGhvZCBhbGxvd3MgbW9kaWZpY2F0aW9uIG9mCgkJICogdGhlIHN0YXRlIHNhdmluZyBvYmplY3QgcHJpb3IgdG8gYWN0dWFsbHkgZG9pbmcgdGhlIHNhdmUsIGluY2x1ZGluZyBhZGRpdGlvbiBvciAKCQkgKiBvdGhlciBzdGF0ZSBwcm9wZXJ0aWVzIG9yIG1vZGlmaWNhdGlvbi4gTm90ZSB0aGF0IGZvciBwbHVnLWluIGF1dGhvcnMsIHlvdSBzaG91bGQgCgkJICogdXNlIHRoZSAnc3RhdGVTYXZlUGFyYW1zJyBldmVudCB0byBzYXZlIHBhcmFtZXRlcnMgZm9yIGEgcGx1Zy1pbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0byBiZSBzYXZlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUmVtb3ZlIGEgc2F2ZWQgZmlsdGVyLCBzbyBmaWx0ZXJpbmcgaXMgbmV2ZXIgc2F2ZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBvRGF0YS5vRmlsdGVyLnNTZWFyY2ggPSAiIjsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVTYXZlUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRHVyYXRpb24gb2YgdGhlIGNvb2tpZSB3aGljaCBpcyB1c2VkIGZvciBzdG9yaW5nIHNlc3Npb24gaW5mb3JtYXRpb24uIFRoaXMKCQkgKiB2YWx1ZSBpcyBnaXZlbiBpbiBzZWNvbmRzLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgNzIwMCA8aT4oMiBob3Vycyk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlDb29raWVEdXJhdGlvbiI6IDYwKjYwKjI0IC8vIDEgZGF5CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImlDb29raWVEdXJhdGlvbiI6IDcyMDAsCgkKCQoJCS8qKgoJCSAqIFdoZW4gZW5hYmxlZCBEYXRhVGFibGVzIHdpbGwgbm90IG1ha2UgYSByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgZm9yIHRoZSBmaXJzdAoJCSAqIHBhZ2UgZHJhdyAtIHJhdGhlciBpdCB3aWxsIHVzZSB0aGUgZGF0YSBhbHJlYWR5IG9uIHRoZSBwYWdlIChubyBzb3J0aW5nIGV0YwoJCSAqIHdpbGwgYmUgYXBwbGllZCB0byBpdCksIHRodXMgc2F2aW5nIG9uIGFuIFhIUiBhdCBsb2FkIHRpbWUuIGlEZWZlckxvYWRpbmcKCQkgKiBpcyB1c2VkIHRvIGluZGljYXRlIHRoYXQgZGVmZXJyZWQgbG9hZGluZyBpcyByZXF1aXJlZCwgYnV0IGl0IGlzIGFsc28gdXNlZAoJCSAqIHRvIHRlbGwgRGF0YVRhYmxlcyBob3cgbWFueSByZWNvcmRzIHRoZXJlIGFyZSBpbiB0aGUgZnVsbCB0YWJsZSAoYWxsb3dpbmcKCQkgKiB0aGUgaW5mb3JtYXRpb24gZWxlbWVudCBhbmQgcGFnaW5hdGlvbiB0byBiZSBkaXNwbGF5ZWQgY29ycmVjdGx5KS4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3NlcnZlcl9wcm9jZXNzaW5nLnBocCIsCgkJICogICAgICAgICJpRGVmZXJMb2FkaW5nIjogNTcKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlEZWZlckxvYWRpbmciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBOdW1iZXIgb2Ygcm93cyB0byBkaXNwbGF5IG9uIGEgc2luZ2xlIHBhZ2Ugd2hlbiB1c2luZyBwYWdpbmF0aW9uLiBJZgoJCSAqIGZlYXR1cmUgZW5hYmxlZCAoYkxlbmd0aENoYW5nZSkgdGhlbiB0aGUgZW5kIHVzZXIgd2lsbCBiZSBhYmxlIHRvIG92ZXJyaWRlCgkJICogdGhpcyB0byBhIGN1c3RvbSBzZXR0aW5nIHVzaW5nIGEgcG9wLXVwIG1lbnUuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUwCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImlEaXNwbGF5TGVuZ3RoIjogMTAsCgkKCQoJCS8qKgoJCSAqIERlZmluZSB0aGUgc3RhcnRpbmcgcG9pbnQgZm9yIGRhdGEgZGlzcGxheSB3aGVuIHVzaW5nIERhdGFUYWJsZXMgd2l0aAoJCSAqIHBhZ2luYXRpb24uIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciBpcyB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJhdGhlciB0aGFuCgkJICogdGhlIHBhZ2UgbnVtYmVyLCBzbyBpZiB5b3UgaGF2ZSAxMCByZWNvcmRzIHBlciBwYWdlIGFuZCB3YW50IHRvIHN0YXJ0IG9uCgkJICogdGhlIHRoaXJkIHBhZ2UsIGl0IHNob3VsZCBiZSAiMjAiLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheVN0YXJ0IjogMjAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaURpc3BsYXlTdGFydCI6IDAsCgkKCQoJCS8qKgoJCSAqIFRoZSBzY3JvbGwgZ2FwIGlzIHRoZSBhbW91bnQgb2Ygc2Nyb2xsaW5nIHRoYXQgaXMgbGVmdCB0byBnbyBiZWZvcmUKCQkgKiBEYXRhVGFibGVzIHdpbGwgbG9hZCB0aGUgbmV4dCAncGFnZScgb2YgZGF0YSBhdXRvbWF0aWNhbGx5LiBZb3UgdHlwaWNhbGx5CgkJICogd2FudCBhIGdhcCB3aGljaCBpcyBiaWcgZW5vdWdoIHRoYXQgdGhlIHNjcm9sbGluZyB3aWxsIGJlIHNtb290aCBmb3IgdGhlCgkJICogdXNlciwgd2hpbGUgbm90IHNvIGxhcmdlIHRoYXQgaXQgd2lsbCBsb2FkIG1vcmUgZGF0YSB0aGFuIG5lZWQuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImlTY3JvbGxMb2FkR2FwIjogNTAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlTY3JvbGxMb2FkR2FwIjogMTAwLAoJCgkKCQkvKioKCQkgKiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgYWxsb3dzIGtleWJvYXJkIG5hdmlnYXRpb24gb2YgdGhlIHRhYmxlIChzb3J0aW5nLCBwYWdpbmcsCgkJICogYW5kIGZpbHRlcmluZykgYnkgYWRkaW5nIGEgdGFiaW5kZXggYXR0cmlidXRlIHRvIHRoZSByZXF1aXJlZCBlbGVtZW50cy4gVGhpcwoJCSAqIGFsbG93cyB5b3UgdG8gdGFiIHRocm91Z2ggdGhlIGNvbnRyb2xzIGFuZCBwcmVzcyB0aGUgZW50ZXIga2V5IHRvIGFjdGl2YXRlIHRoZW0uCgkJICogVGhlIHRhYmluZGV4IGlzIGRlZmF1bHQgMCwgbWVhbmluZyB0aGF0IHRoZSB0YWIgZm9sbG93cyB0aGUgZmxvdyBvZiB0aGUgZG9jdW1lbnQuCgkJICogWW91IGNhbiBvdmVycnVsZSB0aGlzIHVzaW5nIHRoaXMgcGFyYW1ldGVyIGlmIHlvdSB3aXNoLiBVc2UgYSB2YWx1ZSBvZiAtMSB0bwoJCSAqIGRpc2FibGUgYnVpbHQtaW4ga2V5Ym9hcmQgbmF2aWdhdGlvbi4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpVGFiSW5kZXgiOiAxCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpVGFiSW5kZXgiOiAwLAoJCgkKCQkvKioKCQkgKiBBbGwgc3RyaW5ncyB0aGF0IERhdGFUYWJsZXMgdXNlcyBpbiB0aGUgdXNlciBpbnRlcmZhY2UgdGhhdCBpdCBjcmVhdGVzCgkJICogYXJlIGRlZmluZWQgaW4gdGhpcyBvYmplY3QsIGFsbG93aW5nIHlvdSB0byBtb2RpZmllZCB0aGVtIGluZGl2aWR1YWxseSBvcgoJCSAqIGNvbXBsZXRlbHkgcmVwbGFjZSB0aGVtIGFsbCBhcyByZXF1aXJlZC4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvTGFuZ3VhZ2UiOiB7CgkJCS8qKgoJCQkgKiBTdHJpbmdzIHRoYXQgYXJlIHVzZWQgZm9yIFdBSS1BUklBIGxhYmVscyBhbmQgY29udHJvbHMgb25seSAodGhlc2UgYXJlIG5vdAoJCQkgKiBhY3R1YWxseSB2aXNpYmxlIG9uIHRoZSBwYWdlLCBidXQgd2lsbCBiZSByZWFkIGJ5IHNjcmVlbnJlYWRlcnMsIGFuZCB0aHVzCgkJCSAqIG11c3QgYmUgaW50ZXJuYXRpb25hbGlzZWQgYXMgd2VsbCkuCgkJCSAqICBAbmFtZXNwYWNlCgkJCSAqLwoJCQkib0FyaWEiOiB7CgkJCQkvKioKCQkJCSAqIEFSSUEgbGFiZWwgdGhhdCBpcyBhZGRlZCB0byB0aGUgdGFibGUgaGVhZGVycyB3aGVuIHRoZSBjb2x1bW4gbWF5IGJlCgkJCQkgKiBzb3J0ZWQgYXNjZW5kaW5nIGJ5IGFjdGl2aW5nIHRoZSBjb2x1bW4gKGNsaWNrIG9yIHJldHVybiB3aGVuIGZvY3VzZWQpLgoJCQkJICogTm90ZSB0aGF0IHRoZSBjb2x1bW4gaGVhZGVyIGlzIHByZWZpeGVkIHRvIHRoaXMgc3RyaW5nLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IDogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvQXJpYSI6IHsKCQkJCSAqICAgICAgICAgICAgInNTb3J0QXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGFzY2VuZGluZyIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNTb3J0QXNjZW5kaW5nIjogIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nIiwKCQoJCQkJLyoqCgkJCQkgKiBBUklBIGxhYmVsIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHRhYmxlIGhlYWRlcnMgd2hlbiB0aGUgY29sdW1uIG1heSBiZQoJCQkJICogc29ydGVkIGRlc2NlbmRpbmcgYnkgYWN0aXZpbmcgdGhlIGNvbHVtbiAoY2xpY2sgb3IgcmV0dXJuIHdoZW4gZm9jdXNlZCkuCgkJCQkgKiBOb3RlIHRoYXQgdGhlIGNvbHVtbiBoZWFkZXIgaXMgcHJlZml4ZWQgdG8gdGhpcyBzdHJpbmcuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmcKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9BcmlhIjogewoJCQkJICogICAgICAgICAgICAic1NvcnREZXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGRlc2NlbmRpbmciCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzU29ydERlc2NlbmRpbmciOiAiOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBkZXNjZW5kaW5nIgoJCQl9LAoJCgkJCS8qKgoJCQkgKiBQYWdpbmF0aW9uIHN0cmluZyB1c2VkIGJ5IERhdGFUYWJsZXMgZm9yIHRoZSB0d28gYnVpbHQtaW4gcGFnaW5hdGlvbgoJCQkgKiBjb250cm9sIHR5cGVzICgidHdvX2J1dHRvbiIgYW5kICJmdWxsX251bWJlcnMiKQoJCQkgKiAgQG5hbWVzcGFjZQoJCQkgKi8KCQkJIm9QYWdpbmF0ZSI6IHsKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBmaXJzdCBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IEZpcnN0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzRmlyc3QiOiAiRmlyc3QgcGFnZSIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNGaXJzdCI6ICJGaXJzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBsYXN0IHBhZ2UuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgTGFzdAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic0xhc3QiOiAiTGFzdCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic0xhc3QiOiAiTGFzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBuZXh0IHBhZ2UuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgTmV4dAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic05leHQiOiAiTmV4dCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic05leHQiOiAiTmV4dCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBwcmV2aW91cyBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IFByZXZpb3VzCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzUHJldmlvdXMiOiAiUHJldmlvdXMgcGFnZSIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNQcmV2aW91cyI6ICJQcmV2aW91cyIKCQkJfSwKCQkKCQkJLyoqCgkJCSAqIFRoaXMgc3RyaW5nIGlzIHNob3duIGluIHByZWZlcmVuY2UgdG8gc1plcm9SZWNvcmRzIHdoZW4gdGhlIHRhYmxlIGlzCgkJCSAqIGVtcHR5IG9mIGRhdGEgKHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nKS4gTm90ZSB0aGF0IHRoaXMgaXMgYW4gb3B0aW9uYWwKCQkJICogcGFyYW1ldGVyIC0gaWYgaXQgaXMgbm90IGdpdmVuLCB0aGUgdmFsdWUgb2Ygc1plcm9SZWNvcmRzIHdpbGwgYmUgdXNlZAoJCQkgKiBpbnN0ZWFkIChlaXRoZXIgdGhlIGRlZmF1bHQgb3IgZ2l2ZW4gdmFsdWUpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZQoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBUaGlzIHN0cmluZyBnaXZlcyBpbmZvcm1hdGlvbiB0byB0aGUgZW5kIHVzZXIgYWJvdXQgdGhlIGluZm9ybWF0aW9uIHRoYXQgCgkJCSAqIGlzIGN1cnJlbnQgb24gZGlzcGxheSBvbiB0aGUgcGFnZS4gVGhlIF9TVEFSVF8sIF9FTkRfIGFuZCBfVE9UQUxfIAoJCQkgKiB2YXJpYWJsZXMgYXJlIGFsbCBkeW5hbWljYWxseSByZXBsYWNlZCBhcyB0aGUgdGFibGUgZGlzcGxheSB1cGRhdGVzLCBhbmQgCgkJCSAqIGNhbiBiZSBmcmVlbHkgbW92ZWQgb3IgcmVtb3ZlZCBhcyB0aGUgbGFuZ3VhZ2UgcmVxdWlyZW1lbnRzIGNoYW5nZS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mbyI6ICJHb3QgYSB0b3RhbCBvZiBfVE9UQUxfIGVudHJpZXMgdG8gc2hvdyAoX1NUQVJUXyB0byBfRU5EXykiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm8iOiAiU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEaXNwbGF5IGluZm9ybWF0aW9uIHN0cmluZyBmb3Igd2hlbiB0aGUgdGFibGUgaXMgZW1wdHkuIFR5cGljYWxseSB0aGUgCgkJCSAqIGZvcm1hdCBvZiB0aGlzIHN0cmluZyBzaG91bGQgbWF0Y2ggc0luZm8uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0VtcHR5IjogIk5vIGVudHJpZXMgdG8gc2hvdyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb0VtcHR5IjogIlNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBXaGVuIGEgdXNlciBmaWx0ZXJzIHRoZSBpbmZvcm1hdGlvbiBpbiBhIHRhYmxlLCB0aGlzIHN0cmluZyBpcyBhcHBlbmRlZCAKCQkJICogdG8gdGhlIGluZm9ybWF0aW9uIChzSW5mbykgdG8gZ2l2ZSBhbiBpZGVhIG9mIGhvdyBzdHJvbmcgdGhlIGZpbHRlcmluZyAKCQkJICogaXMuIFRoZSB2YXJpYWJsZSBfTUFYXyBpcyBkeW5hbWljYWxseSB1cGRhdGVkLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKQoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0ZpbHRlcmVkIjogIiAtIGZpbHRlcmluZyBmcm9tIF9NQVhfIHJlY29yZHMiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9GaWx0ZXJlZCI6ICIoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBJZiBjYW4gYmUgdXNlZnVsIHRvIGFwcGVuZCBleHRyYSBpbmZvcm1hdGlvbiB0byB0aGUgaW5mbyBzdHJpbmcgYXQgdGltZXMsCgkJCSAqIGFuZCB0aGlzIHZhcmlhYmxlIGRvZXMgZXhhY3RseSB0aGF0LiBUaGlzIGluZm9ybWF0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8KCQkJICogdGhlIHNJbmZvIChzSW5mb0VtcHR5IGFuZCBzSW5mb0ZpbHRlcmVkIGluIHdoYXRldmVyIGNvbWJpbmF0aW9uIHRoZXkgYXJlCgkJCSAqIGJlaW5nIHVzZWQpIGF0IGFsbCB0aW1lcy4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb1Bvc3RGaXgiOiAiQWxsIHJlY29yZHMgc2hvd24gYXJlIGRlcml2ZWQgZnJvbSByZWFsIGluZm9ybWF0aW9uLiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb1Bvc3RGaXgiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERhdGFUYWJsZXMgaGFzIGEgYnVpbGQgaW4gbnVtYmVyIGZvcm1hdHRlciAoZm5Gb3JtYXROdW1iZXIpIHdoaWNoIGlzIHVzZWQKCQkJICogdG8gZm9ybWF0IGxhcmdlIG51bWJlcnMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUgaW5mb3JtYXRpb24uIEJ5CgkJCSAqIGRlZmF1bHQgYSBjb21tYSBpcyB1c2VkLCBidXQgdGhpcyBjYW4gYmUgdHJpdmlhbGx5IGNoYW5nZWQgdG8gYW55CgkJCSAqIGNoYXJhY3RlciB5b3Ugd2lzaCB3aXRoIHRoaXMgcGFyYW1ldGVyLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAsCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNJbmZvVGhvdXNhbmRzIjogIiciCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9UaG91c2FuZHMiOiAiLCIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEZXRhaWwgdGhlIGFjdGlvbiB0aGF0IHdpbGwgYmUgdGFrZW4gd2hlbiB0aGUgZHJvcCBkb3duIG1lbnUgZm9yIHRoZQoJCQkgKiBwYWdpbmF0aW9uIGxlbmd0aCBvcHRpb24gaXMgY2hhbmdlZC4gVGhlICdfTUVOVV8nIHZhcmlhYmxlIGlzIHJlcGxhY2VkCgkJCSAqIHdpdGggYSBkZWZhdWx0IHNlbGVjdCBsaXN0IG9mIDEwLCAyNSwgNTAgYW5kIDEwMCwgYW5kIGNhbiBiZSByZXBsYWNlZAoJCQkgKiB3aXRoIGEgY3VzdG9tIHNlbGVjdCBib3ggaWYgcmVxdWlyZWQuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3cgX01FTlVfIGVudHJpZXMKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIExhbmd1YWdlIGNoYW5nZSBvbmx5CgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0xlbmd0aE1lbnUiOiAiRGlzcGxheSBfTUVOVV8gcmVjb3JkcyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBMYW5ndWFnZSBhbmQgb3B0aW9ucyBjaGFuZ2UKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTGVuZ3RoTWVudSI6ICdEaXNwbGF5IDxzZWxlY3Q+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMTAiPjEwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMjAiPjIwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMzAiPjMwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNDAiPjQwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNTAiPjUwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iLTEiPkFsbDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzwvc2VsZWN0PiByZWNvcmRzJwoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNMZW5ndGhNZW51IjogIlNob3cgX01FTlVfIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogV2hlbiB1c2luZyBBamF4IHNvdXJjZWQgZGF0YSBhbmQgZHVyaW5nIHRoZSBmaXJzdCBkcmF3IHdoZW4gRGF0YVRhYmxlcyBpcwoJCQkgKiBnYXRoZXJpbmcgdGhlIGRhdGEsIHRoaXMgbWVzc2FnZSBpcyBzaG93biBpbiBhbiBlbXB0eSByb3cgaW4gdGhlIHRhYmxlIHRvCgkJCSAqIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGUgdGhlIGRhdGEgaXMgYmVpbmcgbG9hZGVkLiBOb3RlIHRoYXQgdGhpcwoJCQkgKiBwYXJhbWV0ZXIgaXMgbm90IHVzZWQgd2hlbiBsb2FkaW5nIGRhdGEgYnkgc2VydmVyLXNpZGUgcHJvY2Vzc2luZywganVzdAoJCQkgKiBBamF4IHNvdXJjZWQgZGF0YSB3aXRoIGNsaWVudC1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IExvYWRpbmcuLi4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNMb2FkaW5nUmVjb3JkcyI6ICJQbGVhc2Ugd2FpdCAtIGxvYWRpbmcuLi4iCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0xvYWRpbmdSZWNvcmRzIjogIkxvYWRpbmcuLi4iLAoJCQoJCQoJCQkvKioKCQkJICogVGV4dCB3aGljaCBpcyBkaXNwbGF5ZWQgd2hlbiB0aGUgdGFibGUgaXMgcHJvY2Vzc2luZyBhIHVzZXIgYWN0aW9uCgkJCSAqICh1c3VhbGx5IGEgc29ydCBjb21tYW5kIG9yIHNpbWlsYXIpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBQcm9jZXNzaW5nLi4uCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNQcm9jZXNzaW5nIjogIkRhdGFUYWJsZXMgaXMgY3VycmVudGx5IGJ1c3kiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1Byb2Nlc3NpbmciOiAiUHJvY2Vzc2luZy4uLiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEZXRhaWxzIHRoZSBhY3Rpb25zIHRoYXQgd2lsbCBiZSB0YWtlbiB3aGVuIHRoZSB1c2VyIHR5cGVzIGludG8gdGhlCgkJCSAqIGZpbHRlcmluZyBpbnB1dCB0ZXh0IGJveC4gVGhlIHZhcmlhYmxlICJfSU5QVVRfIiwgaWYgdXNlZCBpbiB0aGUgc3RyaW5nLAoJCQkgKiBpcyByZXBsYWNlZCB3aXRoIHRoZSBIVE1MIHRleHQgYm94IGZvciB0aGUgZmlsdGVyaW5nIGlucHV0IGFsbG93aW5nCgkJCSAqIGNvbnRyb2wgb3ZlciB3aGVyZSBpdCBhcHBlYXJzIGluIHRoZSBzdHJpbmcuIElmICJfSU5QVVRfIiBpcyBub3QgZ2l2ZW4KCQkJICogdGhlbiB0aGUgaW5wdXQgYm94IGlzIGFwcGVuZGVkIHRvIHRoZSBzdHJpbmcgYXV0b21hdGljYWxseS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2VhcmNoOgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgLy8gSW5wdXQgdGV4dCBib3ggd2lsbCBiZSBhcHBlbmRlZCBhdCB0aGUgZW5kIGF1dG9tYXRpY2FsbHkKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzU2VhcmNoIjogIkZpbHRlciByZWNvcmRzOiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBTcGVjaWZ5IHdoZXJlIHRoZSBmaWx0ZXIgc2hvdWxkIGFwcGVhcgoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNTZWFyY2giOiAiQXBwbHkgZmlsdGVyIF9JTlBVVF8gdG8gdGFibGUiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1NlYXJjaCI6ICJTZWFyY2g6IiwKCQkKCQkKCQkJLyoqCgkJCSAqIEFsbCBvZiB0aGUgbGFuZ3VhZ2UgaW5mb3JtYXRpb24gY2FuIGJlIHN0b3JlZCBpbiBhIGZpbGUgb24gdGhlCgkJCSAqIHNlcnZlci1zaWRlLCB3aGljaCBEYXRhVGFibGVzIHdpbGwgbG9vayB1cCBpZiB0aGlzIHBhcmFtZXRlciBpcyBwYXNzZWQuCgkJCSAqIEl0IG11c3Qgc3RvcmUgdGhlIFVSTCBvZiB0aGUgbGFuZ3VhZ2UgZmlsZSwgd2hpY2ggaXMgaW4gYSBKU09OIGZvcm1hdCwKCQkJICogYW5kIHRoZSBvYmplY3QgaGFzIHRoZSBzYW1lIHByb3BlcnRpZXMgYXMgdGhlIG9MYW5ndWFnZSBvYmplY3QgaW4gdGhlCgkJCSAqIGluaXRpYWxpc2VyIG9iamVjdCAoaS5lLiB0aGUgYWJvdmUgcGFyYW1ldGVycykuIFBsZWFzZSByZWZlciB0byBvbmUgb2YKCQkJICogdGhlIGV4YW1wbGUgbGFuZ3VhZ2UgZmlsZXMgdG8gc2VlIGhvdyB0aGlzIHdvcmtzIGluIGFjdGlvbi4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic1VybCI6ICJodHRwOi8vd3d3LnNwcnltZWRpYS5jby51ay9kYXRhVGFibGVzL2xhbmcudHh0IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNVcmwiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFRleHQgc2hvd24gaW5zaWRlIHRoZSB0YWJsZSByZWNvcmRzIHdoZW4gdGhlIGlzIG5vIGluZm9ybWF0aW9uIHRvIGJlCgkJCSAqIGRpc3BsYXllZCBhZnRlciBmaWx0ZXJpbmcuIHNFbXB0eVRhYmxlIGlzIHNob3duIHdoZW4gdGhlcmUgaXMgc2ltcGx5IG5vCgkJCSAqIGluZm9ybWF0aW9uIGluIHRoZSB0YWJsZSBhdCBhbGwgKHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nKS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgTm8gbWF0Y2hpbmcgcmVjb3JkcyBmb3VuZAoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzWmVyb1JlY29yZHMiOiAiTm8gcmVjb3JkcyB0byBkaXNwbGF5IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNaZXJvUmVjb3JkcyI6ICJObyBtYXRjaGluZyByZWNvcmRzIGZvdW5kIgoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gaGF2ZSBkZWZpbmUgdGhlIGdsb2JhbCBmaWx0ZXJpbmcgc3RhdGUgYXQKCQkgKiBpbml0aWFsaXNhdGlvbiB0aW1lLiBBcyBhbiBvYmplY3QgdGhlICJzU2VhcmNoIiBwYXJhbWV0ZXIgbXVzdCBiZQoJCSAqIGRlZmluZWQsIGJ1dCBhbGwgb3RoZXIgcGFyYW1ldGVycyBhcmUgb3B0aW9uYWwuIFdoZW4gImJSZWdleCIgaXMgdHJ1ZSwKCQkgKiB0aGUgc2VhcmNoIHN0cmluZyB3aWxsIGJlIHRyZWF0ZWQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24sIHdoZW4gZmFsc2UKCQkgKiAoZGVmYXVsdCkgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgc3RyYWlnaHQgc3RyaW5nLiBXaGVuICJiU21hcnQiCgkJICogRGF0YVRhYmxlcyB3aWxsIHVzZSBpdCdzIHNtYXJ0IGZpbHRlcmluZyBtZXRob2RzICh0byB3b3JkIG1hdGNoIGF0CgkJICogYW55IHBvaW50IGluIHRoZSBkYXRhKSwgd2hlbiBmYWxzZSB0aGlzIHdpbGwgbm90IGJlIGRvbmUuCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgIm9TZWFyY2giOiB7InNTZWFyY2giOiAiSW5pdGlhbCBzZWFyY2gifQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJvU2VhcmNoIjogJC5leHRlbmQoIHt9LCBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2ggKSwKCQoJCgkJLyoqCgkJICogQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9vayBmb3IgdGhlIHByb3BlcnR5ICdhYURhdGEnIHdoZW4gb2J0YWluaW5nCgkJICogZGF0YSBmcm9tIGFuIEFqYXggc291cmNlIG9yIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gdGhpcyBwYXJhbWV0ZXIKCQkgKiBhbGxvd3MgdGhhdCBwcm9wZXJ0eSB0byBiZSBjaGFuZ2VkLiBZb3UgY2FuIHVzZSBKYXZhc2NyaXB0IGRvdHRlZCBvYmplY3QKCQkgKiBub3RhdGlvbiB0byBnZXQgYSBkYXRhIHNvdXJjZSBmb3IgbXVsdGlwbGUgbGV2ZWxzIG9mIG5lc3RpbmcuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhYURhdGEKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogWy4uLl0gfQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RhdGEudHh0IiwKCQkgKiAgICAgICAgInNBamF4RGF0YVByb3AiOiAiZGF0YSIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogeyAiaW5uZXIiOiBbLi4uXSB9IH0KCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kYXRhLnR4dCIsCgkJICogICAgICAgICJzQWpheERhdGFQcm9wIjogImRhdGEuaW5uZXIiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQWpheERhdGFQcm9wIjogImFhRGF0YSIsCgkKCQoJCS8qKgoJCSAqIFlvdSBjYW4gaW5zdHJ1Y3QgRGF0YVRhYmxlcyB0byBsb2FkIGRhdGEgZnJvbSBhbiBleHRlcm5hbCBzb3VyY2UgdXNpbmcgdGhpcwoJCSAqIHBhcmFtZXRlciAodXNlIGFEYXRhIGlmIHlvdSB3YW50IHRvIHBhc3MgZGF0YSBpbiB5b3UgYWxyZWFkeSBoYXZlKS4gU2ltcGx5CgkJICogcHJvdmlkZSBhIHVybCBhIEpTT04gb2JqZWN0IGNhbiBiZSBvYnRhaW5lZCBmcm9tLiBUaGlzIG9iamVjdCBtdXN0IGluY2x1ZGUKCQkgKiB0aGUgcGFyYW1ldGVyICdhYURhdGEnIHdoaWNoIGlzIHRoZSBkYXRhIHNvdXJjZSBmb3IgdGhlIHRhYmxlLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAiaHR0cDovL3d3dy5zcHJ5bWVkaWEuY28udWsvZGF0YVRhYmxlcy9qc29uLnBocCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkic0FqYXhTb3VyY2UiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBjYW4gYmUgdXNlZCB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBwcmVmaXggdGhhdCBEYXRhVGFibGVzCgkJICogYXNzaWducyB0byBhIGNvb2tpZSB3aGVuIHN0YXRlIHNhdmluZyBpcyBlbmFibGVkLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgU3ByeU1lZGlhX0RhdGFUYWJsZXNfCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0Nvb2tpZVByZWZpeCI6ICJteV9kYXRhdGFibGVfIiwKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb29raWVQcmVmaXgiOiAiU3ByeU1lZGlhX0RhdGFUYWJsZXNfIiwKCQoJCgkJLyoqCgkJICogVGhpcyBpbml0aWFsaXNhdGlvbiB2YXJpYWJsZSBhbGxvd3MgeW91IHRvIHNwZWNpZnkgZXhhY3RseSB3aGVyZSBpbiB0aGUKCQkgKiBET00geW91IHdhbnQgRGF0YVRhYmxlcyB0byBpbmplY3QgdGhlIHZhcmlvdXMgY29udHJvbHMgaXQgYWRkcyB0byB0aGUgcGFnZQoJCSAqIChmb3IgZXhhbXBsZSB5b3UgbWlnaHQgd2FudCB0aGUgcGFnaW5hdGlvbiBjb250cm9scyBhdCB0aGUgdG9wIG9mIHRoZQoJCSAqIHRhYmxlKS4gRElWIGVsZW1lbnRzICh3aXRoIG9yIHdpdGhvdXQgYSBjdXN0b20gY2xhc3MpIGNhbiBhbHNvIGJlIGFkZGVkIHRvCgkJICogYWlkIHN0eWxpbmcuIFRoZSBmb2xsb3cgc3ludGF4IGlzIHVzZWQ6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5UaGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIGFsbG93ZWQ6CQoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nbCcgLSBMZW5ndGggY2hhbmdpbmc8L2xpCgkJICogICAgICAgICA8bGk+J2YnIC0gRmlsdGVyaW5nIGlucHV0PC9saT4KCQkgKiAgICAgICAgIDxsaT4ndCcgLSBUaGUgdGFibGUhPC9saT4KCQkgKiAgICAgICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3AnIC0gUGFnaW5hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3InIC0gcFJvY2Vzc2luZzwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgY29uc3RhbnRzIGFyZSBhbGxvd2VkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nSCcgLSBqUXVlcnlVSSB0aGVtZSAiaGVhZGVyIiBjbGFzc2VzICgnZmctdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci10bCB1aS1jb3JuZXItdHIgdWktaGVscGVyLWNsZWFyZml4Jyk8L2xpPgoJCSAqICAgICAgICAgPGxpPidGJyAtIGpRdWVyeVVJIHRoZW1lICJmb290ZXIiIGNsYXNzZXMgKCdmZy10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWJsIHVpLWNvcm5lci1iciB1aS1oZWxwZXItY2xlYXJmaXgnKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgc3ludGF4IGlzIGV4cGVjdGVkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OycgYW5kICcmZ3Q7JyAtIGRpdiBlbGVtZW50czwvbGk+CgkJICogICAgICAgICA8bGk+JyZsdDsiY2xhc3MiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhIGNsYXNzPC9saT4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyIjaWQiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhbiBJRDwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPkV4YW1wbGVzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyJ3cmFwcGVyImZsaXB0Jmd0Oyc8L2xpPgoJCSAqICAgICAgICAgPGxpPicmbHQ7bGYmbHQ7dCZndDtpcCZndDsnPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGxmcnRpcCA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgZmFsc2UpPC9pPiA8Yj5vcjwvYj4gCgkJICogICAgPCJIImxmcj50PCJGImlwPiA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgdHJ1ZSk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0RvbSI6ICcmbHQ7InRvcCJpJmd0O3J0Jmx0OyJib3R0b20iZmxwJmd0OyZsdDsiY2xlYXIiJmxndDsnCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzRG9tIjogImxmcnRpcCIsCgkKCQoJCS8qKgoJCSAqIERhdGFUYWJsZXMgZmVhdHVyZXMgdHdvIGRpZmZlcmVudCBidWlsdC1pbiBwYWdpbmF0aW9uIGludGVyYWN0aW9uIG1ldGhvZHMKCQkgKiAoJ3R3b19idXR0b24nIG9yICdmdWxsX251bWJlcnMnKSB3aGljaCBwcmVzZW50IGRpZmZlcmVudCBwYWdlIGNvbnRyb2xzIHRvCgkJICogdGhlIGVuZCB1c2VyLiBGdXJ0aGVyIG1ldGhvZHMgY2FuIGJlIGFkZGVkIHVzaW5nIHRoZSBBUEkgKHNlZSBiZWxvdykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCB0d29fYnV0dG9uCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNQYWdpbmF0aW9uVHlwZSI6ICJmdWxsX251bWJlcnMiCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJInNQYWdpbmF0aW9uVHlwZSI6ICJ0d29fYnV0dG9uIiwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGhvcml6b250YWwgc2Nyb2xsaW5nLiBXaGVuIGEgdGFibGUgaXMgdG9vIHdpZGUgdG8gZml0IGludG8gYSBjZXJ0YWluCgkJICogbGF5b3V0LCBvciB5b3UgaGF2ZSBhIGxhcmdlIG51bWJlciBvZiBjb2x1bW5zIGluIHRoZSB0YWJsZSwgeW91IGNhbiBlbmFibGUKCQkgKiB4LXNjcm9sbGluZyB0byBzaG93IHRoZSB0YWJsZSBpbiBhIHZpZXdwb3J0LCB3aGljaCBjYW4gYmUgc2Nyb2xsZWQuIFRoaXMKCQkgKiBwcm9wZXJ0eSBjYW4gYnkgYW55IENTUyB1bml0LCBvciBhIG51bWJlciAoaW4gd2hpY2ggY2FzZSBpdCB3aWxsIGJlIHRyZWF0ZWQKCQkgKiBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxYIjogIjEwMCUiLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1Njcm9sbFgiOiAiIiwKCQoJCgkJLyoqCgkJICogVGhpcyBwcm9wZXJ0eSBjYW4gYmUgdXNlZCB0byBmb3JjZSBhIERhdGFUYWJsZSB0byB1c2UgbW9yZSB3aWR0aCB0aGFuIGl0CgkJICogbWlnaHQgb3RoZXJ3aXNlIGRvIHdoZW4geC1zY3JvbGxpbmcgaXMgZW5hYmxlZC4gRm9yIGV4YW1wbGUgaWYgeW91IGhhdmUgYQoJCSAqIHRhYmxlIHdoaWNoIHJlcXVpcmVzIHRvIGJlIHdlbGwgc3BhY2VkLCB0aGlzIHBhcmFtZXRlciBpcyB1c2VmdWwgZm9yCgkJICogIm92ZXItc2l6aW5nIiB0aGUgdGFibGUsIGFuZCB0aHVzIGZvcmNpbmcgc2Nyb2xsaW5nLiBUaGlzIHByb3BlcnR5IGNhbiBieQoJCSAqIGFueSBDU1MgdW5pdCwgb3IgYSBudW1iZXIgKGluIHdoaWNoIGNhc2UgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgcGl4ZWwKCQkgKiBtZWFzdXJlbWVudCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5ibGFuayBzdHJpbmcgLSBpLmUuIGRpc2FibGVkPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxYIjogIjEwMCUiLAoJCSAqICAgICAgICAic1Njcm9sbFhJbm5lciI6ICIxMTAlIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1Njcm9sbFhJbm5lciI6ICIiLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgdmVydGljYWwgc2Nyb2xsaW5nLiBWZXJ0aWNhbCBzY3JvbGxpbmcgd2lsbCBjb25zdHJhaW4gdGhlIERhdGFUYWJsZQoJCSAqIHRvIHRoZSBnaXZlbiBoZWlnaHQsIGFuIGVuYWJsZSBzY3JvbGxpbmcgZm9yIGFueSBkYXRhIHdoaWNoIG92ZXJmbG93cyB0aGUKCQkgKiBjdXJyZW50IHZpZXdwb3J0LiBUaGlzIGNhbiBiZSB1c2VkIGFzIGFuIGFsdGVybmF0aXZlIHRvIHBhZ2luZyB0byBkaXNwbGF5CgkJICogYSBsb3Qgb2YgZGF0YSBpbiBhIHNtYWxsIGFyZWEgKGFsdGhvdWdoIHBhZ2luZyBhbmQgc2Nyb2xsaW5nIGNhbiBib3RoIGJlCgkJICogZW5hYmxlZCBhdCB0aGUgc2FtZSB0aW1lKS4gVGhpcyBwcm9wZXJ0eSBjYW4gYnkgYW55IENTUyB1bml0LCBvciBhIG51bWJlcgoJCSAqIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWSI6ICIiLAoJCgkKCQkvKioKCQkgKiBTZXQgdGhlIEhUVFAgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBtYWtlIHRoZSBBamF4IGNhbGwgZm9yIHNlcnZlci1zaWRlCgkJICogcHJvY2Vzc2luZyBvciBBamF4IHNvdXJjZWQgZGF0YS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IEdFVAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3Bvc3QucGhwIiwKCQkgKiAgICAgICAgInNTZXJ2ZXJNZXRob2QiOiAiUE9TVCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTZXJ2ZXJNZXRob2QiOiAiR0VUIgoJfTsKCQoJCgkKCS8qKgoJICogQ29sdW1uIG9wdGlvbnMgdGhhdCBjYW4gYmUgZ2l2ZW4gdG8gRGF0YVRhYmxlcyBhdCBpbml0aWFsaXNhdGlvbiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnMgPSB7CgkJLyoqCgkJICogQWxsb3dzIGEgY29sdW1uJ3Mgc29ydGluZyB0byB0YWtlIG11bHRpcGxlIGNvbHVtbnMgaW50byBhY2NvdW50IHdoZW4gCgkJICogZG9pbmcgYSBzb3J0LiBGb3IgZXhhbXBsZSBmaXJzdCBuYW1lIC8gbGFzdCBuYW1lIGNvbHVtbnMgbWFrZSBzZW5zZSB0byAKCQkgKiBkbyBhIG11bHRpLWNvbHVtbiBzb3J0IG92ZXIgdGhlIHR3byBjb2x1bW5zLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsIDxpPlRha2VzIHRoZSB2YWx1ZSBvZiB0aGUgY29sdW1uIGluZGV4IGF1dG9tYXRpY2FsbHk8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdLCAiYVRhcmdldHMiOiBbIDAgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMSwgMCBdLCAiYVRhcmdldHMiOiBbIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMiwgMywgNCBdLCAiYVRhcmdldHMiOiBbIDIgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAxLCAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJhRGF0YVNvcnQiOiBbIDIsIDMsIDQgXSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhRGF0YVNvcnQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBZb3UgY2FuIGNvbnRyb2wgdGhlIGRlZmF1bHQgc29ydGluZyBkaXJlY3Rpb24sIGFuZCBldmVuIGFsdGVyIHRoZSBiZWhhdmlvdXIKCQkgKiBvZiB0aGUgc29ydCBoYW5kbGVyIChpLmUuIG9ubHkgYWxsb3cgYXNjZW5kaW5nIHNvcnRpbmcgZXRjKSB1c2luZyB0aGlzCgkJICogcGFyYW1ldGVyLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbICdhc2MnLCAnZGVzYycgXQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0sICJhVGFyZ2V0cyI6IFsgMSBdIH0sCgkJICogICAgICAgICAgeyAiYXNTb3J0aW5nIjogWyAiZGVzYyIsICJhc2MiLCAiYXNjIiBdLCAiYVRhcmdldHMiOiBbIDIgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiIF0sICJhVGFyZ2V0cyI6IFsgMyBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiwgImFzYyIsICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiBdIH0sCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhc1NvcnRpbmciOiBbICdhc2MnLCAnZGVzYycgXSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9uIHRoZSBkYXRhIGluIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTZWFyY2hhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNlYXJjaGFibGUiOiBmYWxzZSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2VhcmNoYWJsZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRhYmxlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB1c2luZyBmblJlbmRlcigpIGZvciBhIGNvbHVtbiwgeW91IG1heSB3aXNoIHRvIHVzZSB0aGUgb3JpZ2luYWwgZGF0YQoJCSAqIChiZWZvcmUgcmVuZGVyaW5nKSBmb3Igc29ydGluZyBhbmQgZmlsdGVyaW5nICh0aGUgZGVmYXVsdCBpcyB0byB1c2VkIHRoZQoJCSAqIHJlbmRlcmVkIGRhdGEgdGhhdCB0aGUgdXNlciBjYW4gc2VlKS4gVGhpcyBtYXkgYmUgdXNlZnVsIGZvciBkYXRlcyBldGMuCgkJICogCgkJICogKk5PVEUqIEl0IGlzIGl0IGlzIGFkdmlzYWJsZSBub3cgdG8gdXNlIG1EYXRhUHJvcCBhcyBhIGZ1bmN0aW9uIGFuZCBtYWtlIAoJCSAqIHVzZSBvZiB0aGUgJ3R5cGUnIHRoYXQgaXQgZ2l2ZXMsIGFsbG93aW5nIChwb3RlbnRpYWxseSkgZGlmZmVyZW50IGRhdGEgdG8KCQkgKiBiZSB1c2VkIGZvciBzb3J0aW5nLCBmaWx0ZXJpbmcsIGRpc3BsYXkgYW5kIHR5cGUgZGV0ZWN0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UsCgkJICogICAgICAgICAgICAiYVRhcmdldHMiOiBbIDAgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UKCQkgKiAgICAgICAgICB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlZpc2libGUiOiBmYWxzZSwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJiVmlzaWJsZSI6IGZhbHNlIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJWaXNpYmxlIjogdHJ1ZSwKCQkKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBmblJlbmRlcgoJCSAqIGFsbG93aW5nIHlvdSB0byBtb2RpZnkgdGhlIERPTSBlbGVtZW50IChhZGQgYmFja2dyb3VuZCBjb2xvdXIgZm9yIGV4YW1wbGUpIHdoZW4gdGhlCgkJICogZWxlbWVudCBpcyBhdmFpbGFibGUgKHNpbmNlIGl0IGlzIG5vdCB3aGVuIGZuUmVuZGVyIGlzIGNhbGxlZCkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gblRkIFRoZSBURCBub2RlIHRoYXQgaGFzIGJlZW4gY3JlYXRlZAoJCSAqICBAcGFyYW0geyp9IHNEYXRhIFRoZSBEYXRhIGZvciB0aGUgY2VsbAoJCSAqICBAcGFyYW0ge2FycmF5fG9iamVjdH0gb0RhdGEgVGhlIGRhdGEgZm9yIHRoZSB3aG9sZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBpbmRleCBmb3IgdGhlIGFvRGF0YSBkYXRhIHN0b3JlCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIFRoZSBjb2x1bW4gaW5kZXggZm9yIGFvQ29sdW1ucwoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFszXSwKCQkgKiAgICAgICAgICAiZm5DcmVhdGVkQ2VsbCI6IGZ1bmN0aW9uIChuVGQsIHNEYXRhLCBvRGF0YSwgaVJvdywgaUNvbCkgewoJCSAqICAgICAgICAgICAgaWYgKCBzRGF0YSA9PSAiMS43IiApIHsKCQkgKiAgICAgICAgICAgICAgJChuVGQpLmNzcygnY29sb3InLCAnYmx1ZScpCgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9IF0KCQkgKiAgICAgIH0pOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCBpbgoJCSAqIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBPYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhUm93IFRoZSByb3cgaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhQ29sdW1uIFRoZSBjb2x1bW4gaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gIG8uYURhdGEgVGhlIGRhdGEgZm9yIHRoZSByb3cgaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8ub1NldHRpbmdzIFRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgRGF0YVRhYmxlcyBpbnN0YW5jZQoJCSAqICBAcGFyYW0ge29iamVjdH0gby5tRGF0YVByb3AgVGhlIGRhdGEgcHJvcGVydHkgdXNlZCBmb3IgdGhpcyBjb2x1bW4KCQkgKiAgQHBhcmFtIHsqfSAgICAgIHZhbCBUaGUgY3VycmVudCBjZWxsIHZhbHVlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImZuUmVuZGVyIjogZnVuY3Rpb24gKCBvLCB2YWwgKSB7CgkJICogICAgICAgICAgICAgIHJldHVybiBvLmFEYXRhWzBdICsnICcrIG8uYURhdGFbM107CgkJICogICAgICAgICAgICB9LAoJCSAqICAgICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0KCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJmblJlbmRlciI6IGZ1bmN0aW9uICggbywgdmFsICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIG8uYURhdGFbMF0gKycgJysgby5hRGF0YVszXTsKCQkgKiAgICAgICAgICB9IH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblJlbmRlciI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSBjb2x1bW4gaW5kZXggKHN0YXJ0aW5nIGZyb20gMCEpIHRoYXQgeW91IHdpc2ggYSBzb3J0IHRvIGJlIHBlcmZvcm1lZAoJCSAqIHVwb24gd2hlbiB0aGlzIGNvbHVtbiBpcyBzZWxlY3RlZCBmb3Igc29ydGluZy4gVGhpcyBjYW4gYmUgdXNlZCBmb3Igc29ydGluZwoJCSAqIG9uIGhpZGRlbiBjb2x1bW5zIGZvciBleGFtcGxlLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgLTEgPGk+VXNlIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZCBjb2x1bW4gaW5kZXg8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpRGF0YVNvcnQiOiAtMSwKCQoJCgkJLyoqCgkJICogVGhpcyBwcm9wZXJ0eSBjYW4gYmUgdXNlZCB0byByZWFkIGRhdGEgZnJvbSBhbnkgSlNPTiBkYXRhIHNvdXJjZSBwcm9wZXJ0eSwKCQkgKiBpbmNsdWRpbmcgZGVlcGx5IG5lc3RlZCBvYmplY3RzIC8gcHJvcGVydGllcy4gbURhdGFQcm9wIGNhbiBiZSBnaXZlbiBpbiBhCgkJICogbnVtYmVyIG9mIGRpZmZlcmVudCB3YXlzIHdoaWNoIGVmZmVjdCBpdHMgYmVoYXZpb3VyOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+aW50ZWdlciAtIHRyZWF0ZWQgYXMgYW4gYXJyYXkgaW5kZXggZm9yIHRoZSBkYXRhIHNvdXJjZS4gVGhpcyBpcyB0aGUKCQkgKiAgICAgICBkZWZhdWx0IHRoYXQgRGF0YVRhYmxlcyB1c2VzIChpbmNyZW1lbnRhbGx5IGluY3JlYXNlZCBmb3IgZWFjaCBjb2x1bW4pLjwvbGk+CgkJICogICAgIDxsaT5zdHJpbmcgLSByZWFkIGFuIG9iamVjdCBwcm9wZXJ0eSBmcm9tIHRoZSBkYXRhIHNvdXJjZS4gTm90ZSB0aGF0IHlvdSBjYW4KCQkgKiAgICAgICB1c2UgSmF2YXNjcmlwdCBkb3R0ZWQgbm90YXRpb24gdG8gcmVhZCBkZWVwIHByb3BlcnRpZXMvYXJyYXlzIGZyb20gdGhlCgkJICogICAgICAgZGF0YSBzb3VyY2UuPC9saT4KCQkgKiAgICAgPGxpPm51bGwgLSAgdGhlIHNEYWZhdWx0Q29udGVudCBvcHRpb24gd2lsbCB1c2UgdXNlZCBmb3IgdGhlIGNlbGwgKGVtcHR5CgkJICogICAgICAgc3RyaW5nIGJ5IGRlZmF1bHQuIFRoaXMgY2FuIGJlIHVzZWZ1bCBvbiBnZW5lcmF0ZWQgY29sdW1ucyBzdWNoIGFzCgkJICogICAgICAgZWRpdCAvIGRlbGV0ZSBhY3Rpb24gY29sdW1ucy48L2xpPgoJCSAqICAgICA8bGk+ZnVuY3Rpb24gLSB0aGUgZnVuY3Rpb24gZ2l2ZW4gd2lsbCBiZSBleGVjdXRlZCB3aGVuZXZlciBEYXRhVGFibGVzIAoJCSAqICAgICAgIG5lZWRzIHRvIHNldCBvciBnZXQgdGhlIGRhdGEgZm9yIGEgY2VsbCBpbiB0aGUgY29sdW1uLiBUaGUgZnVuY3Rpb24gCgkJICogICAgICAgdGFrZXMgdGhyZWUgcGFyYW1ldGVyczoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2FycmF5fG9iamVjdH0gVGhlIGRhdGEgc291cmNlIGZvciB0aGUgcm93PC9saT4KCQkgKiAgICAgICAgIDxsaT57c3RyaW5nfSBUaGUgdHlwZSBjYWxsIGRhdGEgcmVxdWVzdGVkIC0gdGhpcyB3aWxsIGJlICdzZXQnIHdoZW4KCQkgKiAgICAgICAgICAgc2V0dGluZyBkYXRhIG9yICdmaWx0ZXInLCAnZGlzcGxheScsICd0eXBlJyBvciAnc29ydCcgd2hlbiBnYXRoZXJpbmcKCQkgKiAgICAgICAgICAgZGF0YS48L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIHNldCB3aGVuIHRoZSBzZWNvbmQgcGFyYW1ldGVyIGlzICdzZXQnLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgICBUaGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uIGlzIG5vdCByZXF1aXJlZCB3aGVuICdzZXQnIGlzIHRoZSB0eXBlCgkJICogICAgICAgb2YgY2FsbCwgYnV0IG90aGVyd2lzZSB0aGUgcmV0dXJuIGlzIHdoYXQgd2lsbCBiZSB1c2VkIGZvciB0aGUgZGF0YQoJCSAqICAgICAgIHJlcXVlc3RlZC48L2xpPgoJCSAqICAgIDwvdWw+CgkJICogIEB0eXBlIHN0cmluZ3xpbnR8ZnVuY3Rpb258bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsIDxpPlVzZSBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQgY29sdW1uIGluZGV4PC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFJlYWQgdGFibGUgZGF0YSBmcm9tIG9iamVjdHMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kZWVwLnR4dCIsCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogImVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YVByb3AiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YVByb3AiOiAicGxhdGZvcm0uaW5uZXIiIH0sCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogInBsYXRmb3JtLmRldGFpbHMuMCIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YVByb3AiOiAicGxhdGZvcm0uZGV0YWlscy4xIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgbURhdGFQcm9wIGFzIGEgZnVuY3Rpb24gdG8gcHJvdmlkZSBkaWZmZXJlbnQgaW5mb3JtYXRpb24gZm9yCgkJICogICAgLy8gc29ydGluZywgZmlsdGVyaW5nIGFuZCBkaXNwbGF5LiBJbiB0aGlzIGNhc2UsIGN1cnJlbmN5IChwcmljZSkKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0sCgkJICogICAgICAgICAgIm1EYXRhUHJvcCI6IGZ1bmN0aW9uICggc291cmNlLCB0eXBlLCB2YWwgKSB7CgkJICogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3NldCcpIHsKCQkgKiAgICAgICAgICAgICAgc291cmNlLnByaWNlID0gdmFsOwoJCSAqICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgY29tcHV0ZWQgZGlzbGF5IGFuZCBmaWx0ZXIgdmFsdWVzIGZvciBlZmZpY2llbmN5CgkJICogICAgICAgICAgICAgIHNvdXJjZS5wcmljZV9kaXNwbGF5ID0gdmFsPT0iIiA/ICIiIDogIiQiK251bWJlckZvcm1hdCh2YWwpOwoJCSAqICAgICAgICAgICAgICBzb3VyY2UucHJpY2VfZmlsdGVyICA9IHZhbD09IiIgPyAiIiA6ICIkIitudW1iZXJGb3JtYXQodmFsKSsiICIrdmFsOwoJCSAqICAgICAgICAgICAgICByZXR1cm47CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnZGlzcGxheScpIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZV9kaXNwbGF5OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2ZpbHRlcicpIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZV9maWx0ZXI7CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICAvLyAnc29ydCcgYW5kICd0eXBlJyBib3RoIGp1c3QgdXNlIHRoZSBpbnRlZ2VyCgkJICogICAgICAgICAgICByZXR1cm4gc291cmNlLnByaWNlOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkibURhdGFQcm9wIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2xhc3MgdG8gZ2l2ZSB0byBlYWNoIGNlbGwgaW4gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQ2xhc3MiOiAiIiwKCQkKCQkvKioKCQkgKiBXaGVuIERhdGFUYWJsZXMgY2FsY3VsYXRlcyB0aGUgY29sdW1uIHdpZHRocyB0byBhc3NpZ24gdG8gZWFjaCBjb2x1bW4sCgkJICogaXQgZmluZHMgdGhlIGxvbmdlc3Qgc3RyaW5nIGluIGVhY2ggY29sdW1uIGFuZCB0aGVuIGNvbnN0cnVjdHMgYQoJCSAqIHRlbXBvcmFyeSB0YWJsZSBhbmQgcmVhZHMgdGhlIHdpZHRocyBmcm9tIHRoYXQuIFRoZSBwcm9ibGVtIHdpdGggdGhpcwoJCSAqIGlzIHRoYXQgIm1tbSIgaXMgbXVjaCB3aWRlciB0aGVuICJpaWlpIiwgYnV0IHRoZSBsYXR0ZXIgaXMgYSBsb25nZXIgCgkJICogc3RyaW5nIC0gdGh1cyB0aGUgY2FsY3VsYXRpb24gY2FuIGdvIHdyb25nIChkb2luZyBpdCBwcm9wZXJseSBhbmQgcHV0dGluZwoJCSAqIGl0IGludG8gYW4gRE9NIG9iamVjdCBhbmQgbWVhc3VyaW5nIHRoYXQgaXMgaG9ycmlibHkoISkgc2xvdykuIFRodXMgYXMKCQkgKiBhICJ3b3JrIGFyb3VuZCIgd2UgcHJvdmlkZSB0aGlzIG9wdGlvbi4gSXQgd2lsbCBhcHBlbmQgaXRzIHZhbHVlIHRvIHRoZQoJCSAqIHRleHQgdGhhdCBpcyBmb3VuZCB0byBiZSB0aGUgbG9uZ2VzdCBzdHJpbmcgZm9yIHRoZSBjb2x1bW4gLSBpLmUuIHBhZGRpbmcuCgkJICogR2VuZXJhbGx5IHlvdSBzaG91bGRuJ3QgbmVlZCB0aGlzLCBhbmQgaXQgaXMgbm90IGRvY3VtZW50ZWQgb24gdGhlIAoJCSAqIGdlbmVyYWwgRGF0YVRhYmxlcy5uZXQgZG9jdW1lbnRhdGlvbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPGk+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAic0NvbnRlbnRQYWRkaW5nIjogIm1tbSIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb250ZW50UGFkZGluZyI6ICIiLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgYSBkZWZhdWx0IHZhbHVlIHRvIGJlIGdpdmVuIGZvciBhIGNvbHVtbidzIGRhdGEsIGFuZCB3aWxsIGJlIHVzZWQKCQkgKiB3aGVuZXZlciBhIG51bGwgZGF0YSBzb3VyY2UgaXMgZW5jb3VudGVyZWQgKHRoaXMgY2FuIGJlIGJlY2F1c2UgbURhdGFQcm9wCgkJICogaXMgc2V0IHRvIG51bGwsIG9yIGJlY2F1c2UgdGhlIGRhdGEgc291cmNlIGl0c2VsZiBpcyBudWxsKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YVByb3AiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IiwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgLTEgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YVByb3AiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IgoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0RlZmF1bHRDb250ZW50IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgaXMgb25seSB1c2VkIGluIERhdGFUYWJsZXMnIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIEl0IGNhbgoJCSAqIGJlIGV4Y2VwdGlvbmFsbHkgdXNlZnVsIHRvIGtub3cgd2hhdCBjb2x1bW5zIGFyZSBiZWluZyBkaXNwbGF5ZWQgb24gdGhlCgkJICogY2xpZW50IHNpZGUsIGFuZCB0byBtYXAgdGhlc2UgdG8gZGF0YWJhc2UgZmllbGRzLiBXaGVuIGRlZmluZWQsIHRoZSBuYW1lcwoJCSAqIGFsc28gYWxsb3cgRGF0YVRhYmxlcyB0byByZW9yZGVyIGluZm9ybWF0aW9uIGZyb20gdGhlIHNlcnZlciBpZiBpdCBjb21lcwoJCSAqIGJhY2sgaW4gYW4gdW5leHBlY3RlZCBvcmRlciAoaS5lLiBpZiB5b3Ugc3dpdGNoIHlvdXIgY29sdW1ucyBhcm91bmQgb24gdGhlCgkJICogY2xpZW50LXNpZGUsIHlvdXIgc2VydmVyLXNpZGUgY29kZSBkb2VzIG5vdCBhbHNvIG5lZWQgdXBkYXRpbmcpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZW5naW5lIiwgImFUYXJnZXRzIjogWyAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJicm93c2VyIiwgImFUYXJnZXRzIjogWyAxIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIsICJhVGFyZ2V0cyI6IFsgMiBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAidmVyc2lvbiIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZ3JhZGUiLCAiYVRhcmdldHMiOiBbIDQgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJlbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJ2ZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNOYW1lIjogIiIsCgkKCQoJCS8qKgoJCSAqIERlZmluZXMgYSBkYXRhIHNvdXJjZSB0eXBlIGZvciB0aGUgc29ydGluZyB3aGljaCBjYW4gYmUgdXNlZCB0byByZWFkCgkJICogcmVhbHRpbWUgaW5mb3JtYXRpb24gZnJvbSB0aGUgdGFibGUgKHVwZGF0aW5nIHRoZSBpbnRlcm5hbGx5IGNhY2hlZAoJCSAqIHZlcnNpb24pIHByaW9yIHRvIHNvcnRpbmcuIFRoaXMgYWxsb3dzIHNvcnRpbmcgdG8gb2NjdXIgb24gdXNlciBlZGl0YWJsZQoJCSAqIGVsZW1lbnRzIHN1Y2ggYXMgZm9ybSBpbnB1dHMuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJhVGFyZ2V0cyI6IFsgMiwgMyBdIH0sCgkJICogICAgICAgICAgeyAic1R5cGUiOiAibnVtZXJpYyIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tc2VsZWN0IiwgImFUYXJnZXRzIjogWyA0IF0gfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIsICJhVGFyZ2V0cyI6IFsgNSBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXRleHQiIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJzVHlwZSI6ICJudW1lcmljIiB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXNlbGVjdCIgfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU29ydERhdGFUeXBlIjogInN0ZCIsCgkKCQoJCS8qKgoJCSAqIFRoZSB0aXRsZSBvZiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwgPGk+RGVyaXZlZCBmcm9tIHRoZSAnVEgnIHZhbHVlIGZvciB0aGlzIGNvbHVtbiBpbiB0aGUgCgkJICogICAgb3JpZ2luYWwgSFRNTCB0YWJsZS48L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiTXkgY29sdW1uIHRpdGxlIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIk15IGNvbHVtbiB0aXRsZSIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSB0eXBlIGFsbG93cyB5b3UgdG8gc3BlY2lmeSBob3cgdGhlIGRhdGEgZm9yIHRoaXMgY29sdW1uIHdpbGwgYmUgc29ydGVkLgoJCSAqIEZvdXIgdHlwZXMgKHN0cmluZywgbnVtZXJpYywgZGF0ZSBhbmQgaHRtbCAod2hpY2ggd2lsbCBzdHJpcCBIVE1MIHRhZ3MKCQkgKiBiZWZvcmUgc29ydGluZykpIGFyZSBjdXJyZW50bHkgYXZhaWxhYmxlLiBOb3RlIHRoYXQgb25seSBkYXRlIGZvcm1hdHMKCQkgKiB1bmRlcnN0b29kIGJ5IEphdmFzY3JpcHQncyBEYXRlKCkgb2JqZWN0IHdpbGwgYmUgYWNjZXB0ZWQgYXMgdHlwZSBkYXRlLiBGb3IKCQkgKiBleGFtcGxlOiAiTWFyIDI2LCAyMDA4IDU6MDMgUE0iLiBNYXkgdGFrZSB0aGUgdmFsdWVzOiAnc3RyaW5nJywgJ251bWVyaWMnLAoJCSAqICdkYXRlJyBvciAnaHRtbCcgKGJ5IGRlZmF1bHQpLiBGdXJ0aGVyIHR5cGVzIGNhbiBiZSBhZGRpbmcgdGhyb3VnaAoJCSAqIHBsdWctaW5zLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5BdXRvLWRldGVjdGVkIGZyb20gcmF3IGRhdGE8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVHlwZSI6ICJodG1sIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1R5cGUiOiAiaHRtbCIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUeXBlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRGVmaW5pbmcgdGhlIHdpZHRoIG9mIHRoZSBjb2x1bW4sIHRoaXMgcGFyYW1ldGVyIG1heSB0YWtlIGFueSBDU1MgdmFsdWUKCQkgKiAoM2VtLCAyMHB4IGV0YykuIERhdGFUYWJsZXMgYXBwbHlzICdzbWFydCcgd2lkdGhzIHRvIGNvbHVtbnMgd2hpY2ggaGF2ZSBub3QKCQkgKiBiZWVuIGdpdmVuIGEgc3BlY2lmaWMgd2lkdGggdGhyb3VnaCB0aGlzIGludGVyZmFjZSBlbnN1cmluZyB0aGF0IHRoZSB0YWJsZQoJCSAqIHJlbWFpbnMgcmVhZGFibGUuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsIDxpPkF1dG9tYXRpYzwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNXaWR0aCI6ICIyMCUiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzV2lkdGgiOiAiMjAlIiB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1dpZHRoIjogbnVsbAoJfTsKCQoJCgkKCS8qKgoJICogRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QgLSB0aGlzIGhvbGRzIGFsbCB0aGUgaW5mb3JtYXRpb24gbmVlZGVkIGZvciBhCgkgKiBnaXZlbiB0YWJsZSwgaW5jbHVkaW5nIGNvbmZpZ3VyYXRpb24sIGRhdGEgYW5kIGN1cnJlbnQgYXBwbGljYXRpb24gb2YgdGhlCgkgKiB0YWJsZSBvcHRpb25zLiBEYXRhVGFibGVzIGRvZXMgbm90IGhhdmUgYSBzaW5nbGUgaW5zdGFuY2UgZm9yIGVhY2ggRGF0YVRhYmxlCgkgKiB3aXRoIHRoZSBzZXR0aW5ncyBhdHRhY2hlZCB0byB0aGF0IGluc3RhbmNlLCBidXQgcmF0aGVyIGluc3RhbmNlcyBvZiB0aGUKCSAqIERhdGFUYWJsZSAiY2xhc3MiIGFyZSBjcmVhdGVkIG9uLXRoZS1mbHkgYXMgbmVlZGVkICh0eXBpY2FsbHkgYnkgYSAKCSAqICQoKS5kYXRhVGFibGUoKSBjYWxsKSBhbmQgdGhlIHNldHRpbmdzIG9iamVjdCBpcyB0aGVuIGFwcGxpZWQgdG8gdGhhdAoJICogaW5zdGFuY2UuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG9iamVjdCBpcyByZWxhdGVkIHRvIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9IGJ1dCB0aGlzIAoJICogb25lIGlzIHRoZSBpbnRlcm5hbCBkYXRhIHN0b3JlIGZvciBEYXRhVGFibGVzJ3MgY2FjaGUgb2YgY29sdW1ucy4gSXQgc2hvdWxkCgkgKiBOT1QgYmUgbWFuaXB1bGF0ZWQgb3V0c2lkZSBvZiBEYXRhVGFibGVzLiBBbnkgY29uZmlndXJhdGlvbiBzaG91bGQgYmUgZG9uZQoJICogdGhyb3VnaCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucy4KCSAqICBAbmFtZXNwYWNlCgkgKiAgQHRvZG8gUmVhbGx5IHNob3VsZCBhdHRhY2ggdGhlIHNldHRpbmdzIG9iamVjdCB0byBpbmRpdmlkdWFsIGluc3RhbmNlcyBzbyB3ZQoJICogICAgZG9uJ3QgbmVlZCB0byBjcmVhdGUgbmV3IGluc3RhbmNlcyBvbiBlYWNoICQoKS5kYXRhVGFibGUoKSBjYWxsIChpZiB0aGUKCSAqICAgIHRhYmxlIGFscmVhZHkgZXhpc3RzKS4gSXQgd291bGQgYWxzbyBzYXZlIHBhc3Npbmcgb1NldHRpbmdzIGFyb3VuZCBhbmQKCSAqICAgIGludG8gZXZlcnkgc2luZ2xlIGZ1bmN0aW9uLiBIb3dldmVyLCB0aGlzIGlzIGEgdmVyeSBzaWduaWZpY2FudCAKCSAqICAgIGFyY2hpdGVjdHVyZSBjaGFuZ2UgZm9yIERhdGFUYWJsZXMgYW5kIHdpbGwgYWxtb3N0IGNlcnRhaW5seSBicmVhawoJICogICAgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCBvbGRlciBpbnN0YWxsYXRpb25zLiBUaGlzIGlzIHNvbWV0aGluZyB0aGF0CgkgKiAgICB3aWxsIGJlIGRvbmUgaW4gMi4wLgoJICovCglEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5ncyA9IHsKCQkvKioKCQkgKiBQcmltYXJ5IGZlYXR1cmVzIG9mIERhdGFUYWJsZXMgYW5kIHRoZWlyIGVuYWJsZW1lbnQgc3RhdGUuCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib0ZlYXR1cmVzIjogewoJCQkKCQkJLyoqCgkJCSAqIEZsYWcgdG8gc2F5IGlmIERhdGFUYWJsZXMgc2hvdWxkIGF1dG9tYXRpY2FsbHkgdHJ5IHRvIGNhbGN1bGF0ZSB0aGUKCQkJICogb3B0aW11bSB0YWJsZSBhbmQgY29sdW1ucyB3aWR0aHMgKHRydWUpIG9yIG5vdCAoZmFsc2UpLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJBdXRvV2lkdGgiOiBudWxsLAoJCgkJCS8qKgoJCQkgKiBEZWxheSB0aGUgY3JlYXRpb24gb2YgVFIgYW5kIFREIGVsZW1lbnRzIHVudGlsIHRoZXkgYXJlIGFjdHVhbGx5CgkJCSAqIG5lZWRlZCBieSBhIGRyaXZlbiBwYWdlIGRyYXcuIFRoaXMgY2FuIGdpdmUgYSBzaWduaWZpY2FudCBzcGVlZAoJCQkgKiBpbmNyZWFzZSBmb3IgQWpheCBzb3VyY2UgYW5kIEphdmFzY3JpcHQgc291cmNlIGRhdGEsIGJ1dCBtYWtlcyBubwoJCQkgKiBkaWZmZXJlbmNlIGF0IGFsbCBmcm8gRE9NIGFuZCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRhYmxlcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiRGVmZXJSZW5kZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEVuYWJsZSBmaWx0ZXJpbmcgb24gdGhlIHRhYmxlIG9yIG5vdC4gTm90ZSB0aGF0IGlmIHRoaXMgaXMgZGlzYWJsZWQKCQkJICogdGhlbiB0aGVyZSBpcyBubyBmaWx0ZXJpbmcgYXQgYWxsIG9uIHRoZSB0YWJsZSwgaW5jbHVkaW5nIGZuRmlsdGVyLgoJCQkgKiBUbyBqdXN0IHJlbW92ZSB0aGUgZmlsdGVyaW5nIGlucHV0IHVzZSBzRG9tIGFuZCByZW1vdmUgdGhlICdmJyBvcHRpb24uCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkZpbHRlciI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogVGFibGUgaW5mb3JtYXRpb24gZWxlbWVudCAodGhlICdTaG93aW5nIHggb2YgeSByZWNvcmRzJyBkaXYpIGVuYWJsZQoJCQkgKiBmbGFnLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJJbmZvIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBQcmVzZW50IGEgdXNlciBjb250cm9sIGFsbG93aW5nIHRoZSBlbmQgdXNlciB0byBjaGFuZ2UgdGhlIHBhZ2Ugc2l6ZQoJCQkgKiB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiTGVuZ3RoQ2hhbmdlIjogbnVsbCwKCQoJCQkvKioKCQkJICogUGFnaW5hdGlvbiBlbmFibGVkIG9yIG5vdC4gTm90ZSB0aGF0IGlmIHRoaXMgaXMgZGlzYWJsZWQgdGhlbiBsZW5ndGgKCQkJICogY2hhbmdpbmcgbXVzdCBhbHNvIGJlIGRpc2FibGVkLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJQYWdpbmF0ZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogUHJvY2Vzc2luZyBpbmRpY2F0b3IgZW5hYmxlIGZsYWcgd2hlbmV2ZXIgRGF0YVRhYmxlcyBpcyBlbmFjdGluZyBhCgkJCSAqIHVzZXIgcmVxdWVzdCAtIHR5cGljYWxseSBhbiBBamF4IHJlcXVlc3QgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlByb2Nlc3NpbmciOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgZW5hYmxlZCBmbGFnIC0gd2hlbiBlbmFibGVkIERhdGFUYWJsZXMgd2lsbAoJCQkgKiBnZXQgYWxsIGRhdGEgZnJvbSB0aGUgc2VydmVyIGZvciBldmVyeSBkcmF3IC0gdGhlcmUgaXMgbm8gZmlsdGVyaW5nLAoJCQkgKiBzb3J0aW5nIG9yIHBhZ2luZyBkb25lIG9uIHRoZSBjbGllbnQtc2lkZS4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU2VydmVyU2lkZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogU29ydGluZyBlbmFibGVtZW50IGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlNvcnQiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEFwcGx5IGEgY2xhc3MgdG8gdGhlIGNvbHVtbnMgd2hpY2ggYXJlIGJlaW5nIHNvcnRlZCB0byBwcm92aWRlIGEKCQkJICogdmlzdWFsIGhpZ2hsaWdodCBvciBub3QuIFRoaXMgY2FuIHNsb3cgdGhpbmdzIGRvd24gd2hlbiBlbmFibGVkIHNpbmNlCgkJCSAqIHRoZXJlIGlzIGEgbG90IG9mIERPTSBpbnRlcmFjdGlvbi4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU29ydENsYXNzZXMiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFN0YXRlIHNhdmluZyBlbmFibGVtZW50IGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlN0YXRlU2F2ZSI6IG51bGwKCQl9LAoJCQoJCgkJLyoqCgkJICogU2Nyb2xsaW5nIHNldHRpbmdzIGZvciBhIHRhYmxlLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJIm9TY3JvbGwiOiB7CgkJCS8qKgoJCQkgKiBJbmRpY2F0ZSBpZiBEYXRhVGFibGVzIHNob3VsZCBiZSBhbGxvd2VkIHRvIHNldCB0aGUgcGFkZGluZyAvIG1hcmdpbgoJCQkgKiBldGMgZm9yIHRoZSBzY3JvbGxpbmcgaGVhZGVyIGVsZW1lbnRzIG9yIG5vdC4gVHlwaWNhbGx5IHlvdSB3aWxsIHdhbnQKCQkJICogdGhpcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiQXV0b0NzcyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2hlbiB0aGUgdGFibGUgaXMgc2hvcnRlciBpbiBoZWlnaHQgdGhhbiBzU2Nyb2xsWSwgY29sbGFwc2UgdGhlCgkJCSAqIHRhYmxlIGNvbnRhaW5lciBkb3duIHRvIHRoZSBoZWlnaHQgb2YgdGhlIHRhYmxlICh3aGVuIHRydWUpLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJDb2xsYXBzZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogSW5maW5pdGUgc2Nyb2xsaW5nIGVuYWJsZW1lbnQgZmxhZy4gTm93IGRlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJCSAqIHVzaW5nIHRoZSBTY3JvbGxlciBwbHVnLWluLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJJbmZpbml0ZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2lkdGggb2YgdGhlIHNjcm9sbGJhciBmb3IgdGhlIHdlYi1icm93c2VyJ3MgcGxhdGZvcm0uIENhbGN1bGF0ZWQKCQkJICogZHVyaW5nIHRhYmxlIGluaXRpYWxpc2F0aW9uLgoJCQkgKiAgQHR5cGUgaW50CgkJCSAqICBAZGVmYXVsdCAwCgkJCSAqLwoJCQkiaUJhcldpZHRoIjogMCwKCQkJCgkJCS8qKgoJCQkgKiBTcGFjZSAoaW4gcGl4ZWxzKSBiZXR3ZWVuIHRoZSBib3R0b20gb2YgdGhlIHNjcm9sbGluZyBjb250YWluZXIgYW5kIAoJCQkgKiB0aGUgYm90dG9tIG9mIHRoZSBzY3JvbGxpbmcgdmlld3BvcnQgYmVmb3JlIHRoZSBuZXh0IHBhZ2UgaXMgbG9hZGVkCgkJCSAqIHdoZW4gdXNpbmcgaW5maW5pdGUgc2Nyb2xsaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgaW50CgkJCSAqLwoJCQkiaUxvYWRHYXAiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFZpZXdwb3J0IHdpZHRoIGZvciBob3Jpem9udGFsIHNjcm9sbGluZy4gSG9yaXpvbnRhbCBzY3JvbGxpbmcgaXMgCgkJCSAqIGRpc2FibGVkIGlmIGFuIGVtcHR5IHN0cmluZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKi8KCQkJInNYIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBXaWR0aCB0byBleHBhbmQgdGhlIHRhYmxlIHRvIHdoZW4gdXNpbmcgeC1zY3JvbGxpbmcuIFR5cGljYWxseSB5b3UKCQkJICogc2hvdWxkIG5vdCBuZWVkIHRvIHVzZSB0aGlzLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVwcmVjYXRlZAoJCQkgKi8KCQkJInNYSW5uZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFZpZXdwb3J0IGhlaWdodCBmb3IgdmVydGljYWwgc2Nyb2xsaW5nLiBWZXJ0aWNhbCBzY3JvbGxpbmcgaXMgZGlzYWJsZWQKCQkJICogaWYgYW4gZW1wdHkgc3RyaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqLwoJCQkic1kiOiBudWxsCgkJfSwKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBpbmZvcm1hdGlvbiBmb3IgdGhlIHRhYmxlLgoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBleHRlbmRzIERhdGFUYWJsZS5kZWZhdWx0cy5vTGFuZ3VhZ2UKCQkgKi8KCQkib0xhbmd1YWdlIjogewoJCQkvKioKCQkJICogSW5mb3JtYXRpb24gY2FsbGJhY2sgZnVuY3Rpb24uIFNlZSAKCQkJICoge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5mbkluZm9DYWxsYmFja30KCQkJICogIEB0eXBlIGZ1bmN0aW9uCgkJCSAqICBAZGVmYXVsdCAKCQkJICovCgkJCSJmbkluZm9DYWxsYmFjayI6IG51bGwKCQl9LAoJCQoJCS8qKgoJCSAqIEFycmF5IHJlZmVyZW5jaW5nIHRoZSBub2RlcyB3aGljaCBhcmUgdXNlZCBmb3IgdGhlIGZlYXR1cmVzLiBUaGUgCgkJICogcGFyYW1ldGVycyBvZiB0aGlzIG9iamVjdCBtYXRjaCB3aGF0IGlzIGFsbG93ZWQgYnkgc0RvbSAtIGkuZS4KCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPidsJyAtIExlbmd0aCBjaGFuZ2luZzwvbGk+CgkJICogICAgIDxsaT4nZicgLSBGaWx0ZXJpbmcgaW5wdXQ8L2xpPgoJCSAqICAgICA8bGk+J3QnIC0gVGhlIHRhYmxlITwvbGk+CgkJICogICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgIDxsaT4ncCcgLSBQYWdpbmF0aW9uPC9saT4KCQkgKiAgICAgPGxpPidyJyAtIHBSb2Nlc3Npbmc8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYWFuRmVhdHVyZXMiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBkYXRhIGluZm9ybWF0aW9uIC0gc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9Sb3d9IGZvciBkZXRhaWxlZAoJCSAqIGluZm9ybWF0aW9uLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0RhdGEiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBpbmRleGVzIHdoaWNoIGFyZSBpbiB0aGUgY3VycmVudCBkaXNwbGF5IChhZnRlciBmaWx0ZXJpbmcgZXRjKQoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhaURpc3BsYXkiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBpbmRleGVzIGZvciBkaXNwbGF5IC0gbm8gZmlsdGVyaW5nCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFpRGlzcGxheU1hc3RlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IGVhY2ggY29sdW1uIHRoYXQgaXMgaW4gdXNlCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvQ29sdW1ucyI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSdzIGhlYWRlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0hlYWRlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSdzIGZvb3RlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Zvb3RlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFNlYXJjaCBkYXRhIGFycmF5IGZvciByZWd1bGFyIGV4cHJlc3Npb24gc2VhcmNoaW5nCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFzRGF0YVNlYXJjaCI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIHRoZSBhcHBsaWVkIGdsb2JhbCBzZWFyY2ggaW5mb3JtYXRpb24gaW4gY2FzZSB3ZSB3YW50IHRvIGZvcmNlIGEgCgkJICogcmVzZWFyY2ggb3IgY29tcGFyZSB0aGUgb2xkIHNlYXJjaCB0byBhIG5ldyBvbmUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBleHRlbmRzIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaAoJCSAqLwoJCSJvUHJldmlvdXNTZWFyY2giOiB7fSwKCQkKCQkvKioKCQkgKiBTdG9yZSB0aGUgYXBwbGllZCBzZWFyY2ggZm9yIGVhY2ggY29sdW1uIC0gc2VlIAoJCSAqIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2h9IGZvciB0aGUgZm9ybWF0IHRoYXQgaXMgdXNlZCBmb3IgdGhlCgkJICogZmlsdGVyaW5nIGluZm9ybWF0aW9uIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9QcmVTZWFyY2hDb2xzIjogW10sCgkJCgkJLyoqCgkJICogU29ydGluZyB0aGF0IGlzIGFwcGxpZWQgdG8gdGhlIHRhYmxlLiBOb3RlIHRoYXQgdGhlIGlubmVyIGFycmF5cyBhcmUKCQkgKiB1c2VkIGluIHRoZSBmb2xsb3dpbmcgbWFubmVyOgoJCSAqIDx1bD4KCQkgKiAgIDxsaT5JbmRleCAwIC0gY29sdW1uIG51bWJlcjwvbGk+CgkJICogICA8bGk+SW5kZXggMSAtIGN1cnJlbnQgc29ydGluZyBkaXJlY3Rpb248L2xpPgoJCSAqICAgPGxpPkluZGV4IDIgLSBpbmRleCBvZiBhc1NvcnRpbmcgZm9yIHRoaXMgY29sdW1uPC9saT4KCQkgKiA8L3VsPgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQHRvZG8gVGhlc2UgaW5uZXIgYXJyYXlzIHNob3VsZCByZWFsbHkgYmUgb2JqZWN0cwoJCSAqLwoJCSJhYVNvcnRpbmciOiBudWxsLAoJCQoJCS8qKgoJCSAqIFNvcnRpbmcgdGhhdCBpcyBhbHdheXMgYXBwbGllZCB0byB0aGUgdGFibGUgKGkuZS4gcHJlZml4ZWQgaW4gZnJvbnQgb2YKCQkgKiBhYVNvcnRpbmcpLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXl8bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzc2VzIHRvIHVzZSBmb3IgdGhlIHN0cmlwaW5nIG9mIGEgdGFibGUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc1N0cmlwZUNsYXNzZXMiOiBudWxsLAoJCQoJCS8qKgoJCSAqIElmIHJlc3RvcmluZyBhIHRhYmxlIC0gd2Ugc2hvdWxkIHJlc3RvcmUgaXRzIHN0cmlwaW5nIGNsYXNzZXMgYXMgd2VsbAoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc0Rlc3Ryb3lTdHJpcGVzIjogW10sCgkJCgkJLyoqCgkJICogSWYgcmVzdG9yaW5nIGEgdGFibGUgLSB3ZSBzaG91bGQgcmVzdG9yZSBpdHMgd2lkdGggCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJInNEZXN0cm95V2lkdGgiOiAwLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBhcnJheSBmb3IgZXZlcnkgdGltZSBhIHJvdyBpcyBpbnNlcnRlZCAoaS5lLiBvbiBhIGRyYXcpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1Jvd0NhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciB0aGUgaGVhZGVyIG9uIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9IZWFkZXJDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9uIGZvciB0aGUgZm9vdGVyIG9uIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Gb290ZXJDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgZHJhdyBjYWxsYmFjayBmdW5jdGlvbnMKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9EcmF3Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHJvdyBjcmVhdGVkIGZ1bmN0aW9uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUm93Q3JlYXRlZENhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciBqdXN0IGJlZm9yZSB0aGUgdGFibGUgaXMgcmVkcmF3bi4gQSByZXR1cm4gb2YgCgkJICogZmFsc2Ugd2lsbCBiZSB1c2VkIHRvIGNhbmNlbCB0aGUgZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9QcmVEcmF3Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgZm9yIHdoZW4gdGhlIHRhYmxlIGhhcyBiZWVuIGluaXRpYWxpc2VkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0luaXRDb21wbGV0ZSI6IFtdLAoJCgkJCgkJLyoqCgkJICogQ2FsbGJhY2tzIGZvciBtb2RpZnlpbmcgdGhlIHNldHRpbmdzIHRvIGJlIHN0b3JlZCBmb3Igc3RhdGUgc2F2aW5nLCBwcmlvciB0bwoJCSAqIHNhdmluZyBzdGF0ZS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZVNhdmVQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG1vZGlmeWluZyB0aGUgc2V0dGluZ3MgdGhhdCBoYXZlIGJlZW4gc3RvcmVkIGZvciBzdGF0ZSBzYXZpbmcKCQkgKiBwcmlvciB0byB1c2luZyB0aGUgc3RvcmVkIHZhbHVlcyB0byByZXN0b3JlIHRoZSBzdGF0ZS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZUxvYWRQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG9wZXJhdGluZyBvbiB0aGUgc2V0dGluZ3Mgb2JqZWN0IG9uY2UgdGhlIHNhdmVkIHN0YXRlIGhhcyBiZWVuCgkJICogbG9hZGVkCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVMb2FkZWQiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWNoZSB0aGUgdGFibGUgSUQgZm9yIHF1aWNrIGFjY2VzcwoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqLwoJCSJzVGFibGVJZCI6ICIiLAoJCQoJCS8qKgoJCSAqIFRoZSBUQUJMRSBub2RlIGZvciB0aGUgbWFpbiB0YWJsZQoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQZXJtYW5lbnQgcmVmIHRvIHRoZSB0aGVhZCBlbGVtZW50CgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVEhlYWQiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFBlcm1hbmVudCByZWYgdG8gdGhlIHRmb290IGVsZW1lbnQgLSBpZiBpdCBleGlzdHMKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5URm9vdCI6IG51bGwsCgkJCgkJLyoqCgkJICogUGVybWFuZW50IHJlZiB0byB0aGUgdGJvZHkgZWxlbWVudAoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRCb2R5IjogbnVsbCwKCQkKCQkvKioKCQkgKiBDYWNoZSB0aGUgd3JhcHBlciBub2RlIChjb250YWlucyBhbGwgRGF0YVRhYmxlcyBjb250cm9sbGVkIGVsZW1lbnRzKQoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRhYmxlV3JhcHBlciI6IG51bGwsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgd2hlbiB1c2luZyBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRoZSBsb2FkaW5nIG9mIGRhdGEgCgkJICogc2hvdWxkIGJlIGRlZmVycmVkIHVudGlsIHRoZSBzZWNvbmQgZHJhdy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkRlZmVyTG9hZGluZyI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIGFsbCByZXF1aXJlZCBpbmZvcm1hdGlvbiBoYXMgYmVlbiByZWFkIGluCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkluaXRpYWxpc2VkIjogZmFsc2UsCgkJCgkJLyoqCgkJICogSW5mb3JtYXRpb24gYWJvdXQgb3BlbiByb3dzLiBFYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkgaGFzIHRoZSBwYXJhbWV0ZXJzCgkJICogJ25UcicgYW5kICduUGFyZW50JwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb09wZW5Sb3dzIjogW10sCgkJCgkJLyoqCgkJICogRGljdGF0ZSB0aGUgcG9zaXRpb25pbmcgb2YgRGF0YVRhYmxlcycgY29udHJvbCBlbGVtZW50cyAtIHNlZQoJCSAqIHtAbGluayBEYXRhVGFibGUubW9kZWwub0luaXQuc0RvbX0uCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzRG9tIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGljaCB0eXBlIG9mIHBhZ2luYXRpb24gc2hvdWxkIGJlIHVzZWQuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcgCgkJICogIEBkZWZhdWx0IHR3b19idXR0b24KCQkgKi8KCQkic1BhZ2luYXRpb25UeXBlIjogInR3b19idXR0b24iLAoJCQoJCS8qKgoJCSAqIFRoZSBjb29raWUgZHVyYXRpb24gKGZvciBiU3RhdGVTYXZlKSBpbiBzZWNvbmRzLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiaUNvb2tpZUR1cmF0aW9uIjogMCwKCQkKCQkvKioKCQkgKiBUaGUgY29va2llIG5hbWUgcHJlZml4LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic0Nvb2tpZVByZWZpeCI6ICIiLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9uIGZvciBjb29raWUgY3JlYXRpb24uCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuQ29va2llQ2FsbGJhY2siOiBudWxsLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igc3RhdGUgc2F2aW5nLiBFYWNoIGFycmF5IGVsZW1lbnQgaXMgYW4gCgkJICogb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+ZnVuY3Rpb246Zm4gLSBmdW5jdGlvbiB0byBjYWxsLiBUYWtlcyB0d28gcGFyYW1ldGVycywgb1NldHRpbmdzCgkJICogICAgICAgYW5kIHRoZSBKU09OIHN0cmluZyB0byBzYXZlIHRoYXQgaGFzIGJlZW4gdGh1cyBmYXIgY3JlYXRlZC4gUmV0dXJucwoJCSAqICAgICAgIGEgSlNPTiBzdHJpbmcgdG8gYmUgaW5zZXJ0ZWQgaW50byBhIGpzb24gb2JqZWN0IAoJCSAqICAgICAgIChpLmUuICcicGFyYW0iOiBbIDAsIDEsIDJdJyk8L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nOnNOYW1lIC0gbmFtZSBvZiBjYWxsYmFjazwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlU2F2ZSI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igc3RhdGUgbG9hZGluZy4gRWFjaCBhcnJheSBlbGVtZW50IGlzIGFuIAoJCSAqIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmZ1bmN0aW9uOmZuIC0gZnVuY3Rpb24gdG8gY2FsbC4gVGFrZXMgdHdvIHBhcmFtZXRlcnMsIG9TZXR0aW5ncyAKCQkgKiAgICAgICBhbmQgdGhlIG9iamVjdCBzdG9yZWQuIE1heSByZXR1cm4gZmFsc2UgdG8gY2FuY2VsIHN0YXRlIGxvYWRpbmc8L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nOnNOYW1lIC0gbmFtZSBvZiBjYWxsYmFjazwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlTG9hZCI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0YXRlIHRoYXQgd2FzIGxvYWRlZCBmcm9tIHRoZSBjb29raWUuIFVzZWZ1bCBmb3IgYmFjayByZWZlcmVuY2UKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0xvYWRlZFN0YXRlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBTb3VyY2UgdXJsIGZvciBBSkFYIGRhdGEgZm9yIHRoZSB0YWJsZS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNBamF4U291cmNlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQcm9wZXJ0eSBmcm9tIGEgZ2l2ZW4gb2JqZWN0IGZyb20gd2hpY2ggdG8gcmVhZCB0aGUgdGFibGUgZGF0YSBmcm9tLiBUaGlzCgkJICogY2FuIGJlIGFuIGVtcHR5IHN0cmluZyAod2hlbiBub3Qgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyksIGluIHdoaWNoIGNhc2UgCgkJICogaXQgaXMgIGFzc3VtZWQgYW4gYW4gYXJyYXkgaXMgZ2l2ZW4gZGlyZWN0bHkuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKi8KCQkic0FqYXhEYXRhUHJvcCI6IG51bGwsCgkJCgkJLyoqCgkJICogTm90ZSBpZiBkcmF3IHNob3VsZCBiZSBibG9ja2VkIHdoaWxlIGdldHRpbmcgZGF0YQoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYkFqYXhEYXRhR2V0IjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBUaGUgbGFzdCBqUXVlcnkgWEhSIG9iamVjdCB0aGF0IHdhcyB1c2VkIGZvciBzZXJ2ZXItc2lkZSBkYXRhIGdhdGhlcmluZy4gCgkJICogVGhpcyBjYW4gYmUgdXNlZCBmb3Igd29ya2luZyB3aXRoIHRoZSBYSFIgaW5mb3JtYXRpb24gaW4gb25lIG9mIHRoZSAKCQkgKiBjYWxsYmFja3MKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkianFYSFIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIGdldCB0aGUgc2VydmVyLXNpZGUgZGF0YS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuU2VydmVyRGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb25zIHdoaWNoIGFyZSBjYWxsZWQgcHJpb3IgdG8gc2VuZGluZyBhbiBBamF4IHJlcXVlc3Qgc28gZXh0cmEgCgkJICogcGFyYW1ldGVycyBjYW4gZWFzaWx5IGJlIHNlbnQgdG8gdGhlIHNlcnZlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1NlcnZlclBhcmFtcyI6IFtdLAoJCQoJCS8qKgoJCSAqIFNlbmQgdGhlIFhIUiBIVFRQIG1ldGhvZCAtIEdFVCBvciBQT1NUIChjb3VsZCBiZSBQVVQgb3IgREVMRVRFIGlmIAoJCSAqIHJlcXVpcmVkKS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzU2VydmVyTWV0aG9kIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGb3JtYXQgbnVtYmVycyBmb3IgZGlzcGxheS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuRm9ybWF0TnVtYmVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBMaXN0IG9mIG9wdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCBmb3IgdGhlIHVzZXIgc2VsZWN0YWJsZSBsZW5ndGggbWVudS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFMZW5ndGhNZW51IjogbnVsbCwKCQkKCQkvKioKCQkgKiBDb3VudGVyIGZvciB0aGUgZHJhd3MgdGhhdCB0aGUgdGFibGUgZG9lcy4gQWxzbyB1c2VkIGFzIGEgdHJhY2tlciBmb3IKCQkgKiBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlEcmF3IjogMCwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiBhIHJlZHJhdyBpcyBiZWluZyBkb25lIC0gdXNlZnVsIGZvciBBamF4CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkRyYXdpbmciOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBEcmF3IGluZGV4IChpRHJhdykgb2YgdGhlIGxhc3QgZXJyb3Igd2hlbiBwYXJzaW5nIHRoZSByZXR1cm5lZCBkYXRhCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAtMQoJCSAqLwoJCSJpRHJhd0Vycm9yIjogLTEsCgkJCgkJLyoqCgkJICogUGFnaW5nIGRpc3BsYXkgbGVuZ3RoCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqLwoJCSJfaURpc3BsYXlMZW5ndGgiOiAxMCwKCQoJCS8qKgoJCSAqIFBhZ2luZyBzdGFydCBwb2ludCAtIGFpRGlzcGxheSBpbmRleAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJfaURpc3BsYXlTdGFydCI6IDAsCgkKCQkvKioKCQkgKiBQYWdpbmcgZW5kIHBvaW50IC0gYWlEaXNwbGF5IGluZGV4LiBVc2UgZm5EaXNwbGF5RW5kIHJhdGhlciB0aGFuCgkJICogdGhpcyBwcm9wZXJ0eSB0byBnZXQgdGhlIGVuZCBwb2ludAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMTAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lEaXNwbGF5RW5kIjogMTAsCgkJCgkJLyoqCgkJICogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyAtIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSByZXN1bHQgc2V0CgkJICogKGkuZS4gYmVmb3JlIGZpbHRlcmluZyksIFVzZSBmblJlY29yZHNUb3RhbCByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJlZ2FyZGxlc3Mgb2YKCQkgKiB0aGUgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBzZXR0aW5nLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfaVJlY29yZHNUb3RhbCI6IDAsCgkKCQkvKioKCQkgKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGN1cnJlbnQgZGlzcGxheSBzZXQKCQkgKiAoaS5lLiBhZnRlciBmaWx0ZXJpbmcpLiBVc2UgZm5SZWNvcmRzRGlzcGxheSByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJlZ2FyZGxlc3Mgb2YKCQkgKiB0aGUgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBzZXR0aW5nLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lSZWNvcmRzRGlzcGxheSI6IDAsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiBqUXVlcnkgVUkgbWFya2luZyBhbmQgY2xhc3NlcyBzaG91bGQgYmUgdXNlZC4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYkpVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzZXMgdG8gdXNlIGZvciB0aGUgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICovCgkJIm9DbGFzc2VzIjoge30sCgkJCgkJLyoqCgkJICogRmxhZyBhdHRhY2hlZCB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IHNvIHlvdSBjYW4gY2hlY2sgaW4gdGhlIGRyYXcgCgkJICogY2FsbGJhY2sgaWYgZmlsdGVyaW5nIGhhcyBiZWVuIGRvbmUgaW4gdGhlIGRyYXcuIERlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJICogZXZlbnRzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImJGaWx0ZXJlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEZsYWcgYXR0YWNoZWQgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBzbyB5b3UgY2FuIGNoZWNrIGluIHRoZSBkcmF3IAoJCSAqIGNhbGxiYWNrIGlmIHNvcnRpbmcgaGFzIGJlZW4gZG9uZSBpbiB0aGUgZHJhdy4gRGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YKCQkgKiBldmVudHMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlNvcnRlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIHRoYXQgaWYgbXVsdGlwbGUgcm93cyBhcmUgaW4gdGhlIGhlYWRlciBhbmQgdGhlcmUgaXMgbW9yZSB0aGFuIAoJCSAqIG9uZSB1bmlxdWUgY2VsbCBwZXIgY29sdW1uLCBpZiB0aGUgdG9wIG9uZSAodHJ1ZSkgb3IgYm90dG9tIG9uZSAoZmFsc2UpIAoJCSAqIHNob3VsZCBiZSB1c2VkIGZvciBzb3J0aW5nIC8gdGl0bGUgYnkgRGF0YVRhYmxlcy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNvcnRDZWxsc1RvcCI6IG51bGwsCgkJCgkJLyoqCgkJICogSW5pdGlhbGlzYXRpb24gb2JqZWN0IHRoYXQgaXMgdXNlZCBmb3IgdGhlIHRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm9Jbml0IjogbnVsbCwKCQkKCQkvKioKCQkgKiBEZXN0cm95IGNhbGxiYWNrIGZ1bmN0aW9ucyAtIGZvciBwbHVnLWlucyB0byBhdHRhY2ggdGhlbXNlbHZlcyB0byB0aGUKCQkgKiBkZXN0cm95IHNvIHRoZXkgY2FuIGNsZWFuIHVwIG1hcmt1cCBhbmQgZXZlbnRzLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Rlc3Ryb3lDYWxsYmFjayI6IFtdLAoJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCByZWNvcmQgc2V0LCBiZWZvcmUgZmlsdGVyaW5nCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuUmVjb3Jkc1RvdGFsIjogZnVuY3Rpb24gKCkKCQl7CgkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKSB7CgkJCQlyZXR1cm4gcGFyc2VJbnQodGhpcy5faVJlY29yZHNUb3RhbCwgMTApOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCByZWNvcmQgc2V0LCBhZnRlciBmaWx0ZXJpbmcKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5SZWNvcmRzRGlzcGxheSI6IGZ1bmN0aW9uICgpCgkJewoJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkgewoJCQkJcmV0dXJuIHBhcnNlSW50KHRoaXMuX2lSZWNvcmRzRGlzcGxheSwgMTApOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuYWlEaXNwbGF5Lmxlbmd0aDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogU2V0IHRoZSBkaXNwbGF5IGVuZCBwb2ludCAtIGFpRGlzcGxheSBpbmRleAoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAdG9kbyBTaG91bGQgZG8gYXdheSB3aXRoIF9pRGlzcGxheUVuZCBhbmQgY2FsY3VsYXRlIGl0IG9uLXRoZS1mbHkgaGVyZQoJCSAqLwoJCSJmbkRpc3BsYXlFbmQiOiBmdW5jdGlvbiAoKQoJCXsKCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApIHsKCQkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlBhZ2luYXRlID09PSBmYWxzZSB8fCB0aGlzLl9pRGlzcGxheUxlbmd0aCA9PSAtMSApIHsKCQkJCQlyZXR1cm4gdGhpcy5faURpc3BsYXlTdGFydCt0aGlzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiBNYXRoLm1pbiggdGhpcy5faURpc3BsYXlTdGFydCt0aGlzLl9pRGlzcGxheUxlbmd0aCwgCgkJCQkJCXRoaXMuX2lSZWNvcmRzRGlzcGxheSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuX2lEaXNwbGF5RW5kOwoJCQl9CgkJfSwKCQkKCQkvKioKCQkgKiBUaGUgRGF0YVRhYmxlcyBvYmplY3QgZm9yIHRoaXMgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0luc3RhbmNlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBVbmlxdWUgaWRlbnRpZmllciBmb3IgZWFjaCBpbnN0YW5jZSBvZiB0aGUgRGF0YVRhYmxlcyBvYmplY3QuIElmIHRoZXJlCgkJICogaXMgYW4gSUQgb24gdGhlIHRhYmxlIG5vZGUsIHRoZW4gaXQgdGFrZXMgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGFuCgkJICogaW5jcmVtZW50aW5nIGludGVybmFsIGNvdW50ZXIgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0luc3RhbmNlIjogbnVsbCwKCQoJCS8qKgoJCSAqIHRhYmluZGV4IGF0dHJpYnV0ZSB2YWx1ZSB0aGF0IGlzIGFkZGVkIHRvIERhdGFUYWJsZXMgY29udHJvbCBlbGVtZW50cywgYWxsb3dpbmcKCQkgKiBrZXlib2FyZCBuYXZpZ2F0aW9uIG9mIHRoZSB0YWJsZSBhbmQgaXRzIGNvbnRyb2xzLgoJCSAqLwoJCSJpVGFiSW5kZXgiOiAwCgl9OwoKCS8qKgoJICogRXh0ZW5zaW9uIG9iamVjdCBmb3IgRGF0YVRhYmxlcyB0aGF0IGlzIHVzZWQgdG8gcHJvdmlkZSBhbGwgZXh0ZW5zaW9uIG9wdGlvbnMuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlLmV4dDwvaT4gb2JqZWN0IGlzIGF2YWlsYWJsZSB0aHJvdWdoCgkgKiA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlLmV4dDwvaT4gd2hlcmUgaXQgbWF5IGJlIGFjY2Vzc2VkIGFuZCBtYW5pcHVsYXRlZC4gSXQgaXMKCSAqIGFsc28gYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlRXh0PC9pPiBmb3IgaGlzdG9yaWMgcmVhc29ucy4KCSAqICBAbmFtZXNwYWNlCgkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5leHQKCSAqLwoJRGF0YVRhYmxlLmV4dCA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5leHQgKTsKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMsIHsKCQkic1RhYmxlIjogImRhdGFUYWJsZSIsCgkKCQkvKiBUd28gYnV0dG9ucyBidXR0b25zICovCgkJInNQYWdlUHJldkVuYWJsZWQiOiAicGFnaW5hdGVfZW5hYmxlZF9wcmV2aW91cyIsCgkJInNQYWdlUHJldkRpc2FibGVkIjogInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIiwKCQkic1BhZ2VOZXh0RW5hYmxlZCI6ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiLAoJCSJzUGFnZU5leHREaXNhYmxlZCI6ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IiwKCQkic1BhZ2VKVUlOZXh0IjogIiIsCgkJInNQYWdlSlVJUHJldiI6ICIiLAoJCQoJCS8qIEZ1bGwgbnVtYmVycyBwYWdpbmcgYnV0dG9ucyAqLwoJCSJzUGFnZUJ1dHRvbiI6ICJwYWdpbmF0ZV9idXR0b24iLAoJCSJzUGFnZUJ1dHRvbkFjdGl2ZSI6ICJwYWdpbmF0ZV9hY3RpdmUiLAoJCSJzUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIjogInBhZ2luYXRlX2J1dHRvbiBwYWdpbmF0ZV9idXR0b25fZGlzYWJsZWQiLAoJCSJzUGFnZUZpcnN0IjogImZpcnN0IiwKCQkic1BhZ2VQcmV2aW91cyI6ICJwcmV2aW91cyIsCgkJInNQYWdlTmV4dCI6ICJuZXh0IiwKCQkic1BhZ2VMYXN0IjogImxhc3QiLAoJCQoJCS8qIFN0cmlwaW5nIGNsYXNzZXMgKi8KCQkic1N0cmlwZU9kZCI6ICJvZGQiLAoJCSJzU3RyaXBlRXZlbiI6ICJldmVuIiwKCQkKCQkvKiBFbXB0eSByb3cgKi8KCQkic1Jvd0VtcHR5IjogImRhdGFUYWJsZXNfZW1wdHkiLAoJCQoJCS8qIEZlYXR1cmVzICovCgkJInNXcmFwcGVyIjogImRhdGFUYWJsZXNfd3JhcHBlciIsCgkJInNGaWx0ZXIiOiAiZGF0YVRhYmxlc19maWx0ZXIiLAoJCSJzSW5mbyI6ICJkYXRhVGFibGVzX2luZm8iLAoJCSJzUGFnaW5nIjogImRhdGFUYWJsZXNfcGFnaW5hdGUgcGFnaW5nXyIsIC8qIE5vdGUgdGhhdCB0aGUgdHlwZSBpcyBwb3N0Zml4ZWQgKi8KCQkic0xlbmd0aCI6ICJkYXRhVGFibGVzX2xlbmd0aCIsCgkJInNQcm9jZXNzaW5nIjogImRhdGFUYWJsZXNfcHJvY2Vzc2luZyIsCgkJCgkJLyogU29ydGluZyAqLwoJCSJzU29ydEFzYyI6ICJzb3J0aW5nX2FzYyIsCgkJInNTb3J0RGVzYyI6ICJzb3J0aW5nX2Rlc2MiLAoJCSJzU29ydGFibGUiOiAic29ydGluZyIsIC8qIFNvcnRhYmxlIGluIGJvdGggZGlyZWN0aW9ucyAqLwoJCSJzU29ydGFibGVBc2MiOiAic29ydGluZ19hc2NfZGlzYWJsZWQiLAoJCSJzU29ydGFibGVEZXNjIjogInNvcnRpbmdfZGVzY19kaXNhYmxlZCIsCgkJInNTb3J0YWJsZU5vbmUiOiAic29ydGluZ19kaXNhYmxlZCIsCgkJInNTb3J0Q29sdW1uIjogInNvcnRpbmdfIiwgLyogTm90ZSB0aGF0IGFuIGludCBpcyBwb3N0Zml4ZWQgZm9yIHRoZSBzb3J0aW5nIG9yZGVyICovCgkJInNTb3J0SlVJQXNjIjogIiIsCgkJInNTb3J0SlVJRGVzYyI6ICIiLAoJCSJzU29ydEpVSSI6ICIiLAoJCSJzU29ydEpVSUFzY0FsbG93ZWQiOiAiIiwKCQkic1NvcnRKVUlEZXNjQWxsb3dlZCI6ICIiLAoJCSJzU29ydEpVSVdyYXBwZXIiOiAiIiwKCQkic1NvcnRJY29uIjogIiIsCgkJCgkJLyogU2Nyb2xsaW5nICovCgkJInNTY3JvbGxXcmFwcGVyIjogImRhdGFUYWJsZXNfc2Nyb2xsIiwKCQkic1Njcm9sbEhlYWQiOiAiZGF0YVRhYmxlc19zY3JvbGxIZWFkIiwKCQkic1Njcm9sbEhlYWRJbm5lciI6ICJkYXRhVGFibGVzX3Njcm9sbEhlYWRJbm5lciIsCgkJInNTY3JvbGxCb2R5IjogImRhdGFUYWJsZXNfc2Nyb2xsQm9keSIsCgkJInNTY3JvbGxGb290IjogImRhdGFUYWJsZXNfc2Nyb2xsRm9vdCIsCgkJInNTY3JvbGxGb290SW5uZXIiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290SW5uZXIiLAoJCQoJCS8qIE1pc2MgKi8KCQkic0Zvb3RlclRIIjogIiIKCX0gKTsKCQoJCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vSlVJQ2xhc3NlcywgRGF0YVRhYmxlLmV4dC5vU3RkQ2xhc3NlcywgewoJCS8qIFR3byBidXR0b25zIGJ1dHRvbnMgKi8KCQkic1BhZ2VQcmV2RW5hYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWxlZnQiLAoJCSJzUGFnZVByZXZEaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWxlZnQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZU5leHRFbmFibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItcmlnaHQiLAoJCSJzUGFnZU5leHREaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXJpZ2h0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VKVUlOZXh0IjogInVpLWljb24gdWktaWNvbi1jaXJjbGUtYXJyb3ctZSIsCgkJInNQYWdlSlVJUHJldiI6ICJ1aS1pY29uIHVpLWljb24tY2lyY2xlLWFycm93LXciLAoJCQoJCS8qIEZ1bGwgbnVtYmVycyBwYWdpbmcgYnV0dG9ucyAqLwoJCSJzUGFnZUJ1dHRvbiI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzUGFnZUJ1dHRvbkFjdGl2ZSI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlRmlyc3QiOiAiZmlyc3QgdWktY29ybmVyLXRsIHVpLWNvcm5lci1ibCIsCgkJInNQYWdlTGFzdCI6ICJsYXN0IHVpLWNvcm5lci10ciB1aS1jb3JuZXItYnIiLAoJCQoJCS8qIEZlYXR1cmVzICovCgkJInNQYWdpbmciOiAiZGF0YVRhYmxlc19wYWdpbmF0ZSBmZy1idXR0b25zZXQgdWktYnV0dG9uc2V0IGZnLWJ1dHRvbnNldC1tdWx0aSAiKwoJCQkidWktYnV0dG9uc2V0LW11bHRpIHBhZ2luZ18iLCAvKiBOb3RlIHRoYXQgdGhlIHR5cGUgaXMgcG9zdGZpeGVkICovCgkJCgkJLyogU29ydGluZyAqLwoJCSJzU29ydEFzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnREZXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGUiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZUFzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlRGVzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlTm9uZSI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRKVUlBc2MiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi10cmlhbmdsZS0xLW4iLAoJCSJzU29ydEpVSURlc2MiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi10cmlhbmdsZS0xLXMiLAoJCSJzU29ydEpVSSI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTItbi1zIiwKCQkic1NvcnRKVUlBc2NBbGxvd2VkIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tY2FyYXQtMS1uIiwKCQkic1NvcnRKVUlEZXNjQWxsb3dlZCI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTEtcyIsCgkJInNTb3J0SlVJV3JhcHBlciI6ICJEYXRhVGFibGVzX3NvcnRfd3JhcHBlciIsCgkJInNTb3J0SWNvbiI6ICJEYXRhVGFibGVzX3NvcnRfaWNvbiIsCgkJCgkJLyogU2Nyb2xsaW5nICovCgkJInNTY3JvbGxIZWFkIjogImRhdGFUYWJsZXNfc2Nyb2xsSGVhZCB1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1Njcm9sbEZvb3QiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290IHVpLXN0YXRlLWRlZmF1bHQiLAoJCQoJCS8qIE1pc2MgKi8KCQkic0Zvb3RlclRIIjogInVpLXN0YXRlLWRlZmF1bHQiCgl9ICk7CgkKCQoJLyoKCSAqIFZhcmlhYmxlOiBvUGFnaW5hdGlvbgoJICogUHVycG9zZTogIAoJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQKCSAqLwoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1BhZ2luYXRpb24sIHsKCQkvKgoJCSAqIFZhcmlhYmxlOiB0d29fYnV0dG9uCgkJICogUHVycG9zZTogIFN0YW5kYXJkIHR3byBidXR0b24gKGZvcndhcmQvYmFjaykgcGFnaW5hdGlvbgoJCSAqIFNjb3BlOiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uCgkJICovCgkJInR3b19idXR0b24iOiB7CgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi50d29fYnV0dG9uLmZuSW5pdAoJCQkgKiBQdXJwb3NlOiAgSW5pdGlhbGlzZSBkb20gZWxlbWVudHMgcmVxdWlyZWQgZm9yIHBhZ2luYXRpb24gd2l0aCBmb3J3YXJkL2JhY2sgYnV0dG9ucyBvbmx5CgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIG5vZGU6blBhZ2luZyAtIHRoZSBESVYgd2hpY2ggY29udGFpbnMgdGhpcyBwYWdpbmF0aW9uIGNvbnRyb2wKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB3aGljaCBtdXN0IGJlIGNhbGxlZCBvbiB1cGRhdGUKCQkJICovCgkJCSJmbkluaXQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgblBhZ2luZywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQl2YXIgb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZTsKCQkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCXZhciBmbkNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICggZSApIHsKCQkJCQlpZiAoIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLmFjdGlvbiApICkKCQkJCQl7CgkJCQkJCWZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQl9OwoJCgkJCQl2YXIgc0FwcGVuZCA9ICghb1NldHRpbmdzLmJKVUkpID8KCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj4nK29MYW5nLnNQcmV2aW91cysnPC9hPicrCgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+JytvTGFuZy5zTmV4dCsnPC9hPicKCQkJCQk6CgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZVByZXZEaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+PHNwYW4gY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlSlVJUHJldisnIj48L3NwYW4+PC9hPicrCgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+PHNwYW4gY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlSlVJTmV4dCsnIj48L3NwYW4+PC9hPic7CgkJCQkkKG5QYWdpbmcpLmFwcGVuZCggc0FwcGVuZCApOwoJCQkJCgkJCQl2YXIgZWxzID0gJCgnYScsIG5QYWdpbmcpOwoJCQkJdmFyIG5QcmV2aW91cyA9IGVsc1swXSwKCQkJCQluTmV4dCA9IGVsc1sxXTsKCQkJCQoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggblByZXZpb3VzLCB7YWN0aW9uOiAicHJldmlvdXMifSwgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5OZXh0LCAgICAge2FjdGlvbjogIm5leHQifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQkKCQkJCS8qIElEIHRoZSBmaXJzdCBlbGVtZW50cyBvbmx5ICovCgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJblBhZ2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3BhZ2luYXRlJzsKCQkJCQluUHJldmlvdXMuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19wcmV2aW91cyc7CgkJCQkJbk5leHQuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19uZXh0JzsKCQoJCQkJCW5QcmV2aW91cy5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBvU2V0dGluZ3Muc1RhYmxlSWQpOwoJCQkJCW5OZXh0LnNldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24udHdvX2J1dHRvbi5mblVwZGF0ZQoJCQkgKiBQdXJwb3NlOiAgVXBkYXRlIHRoZSB0d28gYnV0dG9uIHBhZ2luYXRpb24gYXQgdGhlIGVuZCBvZiB0aGUgZHJhdwoJCQkgKiBSZXR1cm5zOiAgLQoJCQkgKiBJbnB1dHM6ICAgb2JqZWN0Om9TZXR0aW5ncyAtIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJCSAqICAgICAgICAgICBmdW5jdGlvbjpmbkNhbGxiYWNrRHJhdyAtIGRyYXcgZnVuY3Rpb24gdG8gY2FsbCBvbiBwYWdlIGNoYW5nZQoJCQkgKi8KCQkJImZuVXBkYXRlIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGZuQ2FsbGJhY2tEcmF3ICkKCQkJewoJCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5baV0uY2hpbGROb2Rlcy5sZW5ndGggIT09IDAgKQoJCQkJCXsKCQkJCQkJYW5baV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUgPSAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApID8gCgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZVByZXZEaXNhYmxlZCA6IG9DbGFzc2VzLnNQYWdlUHJldkVuYWJsZWQ7CgkJCQkJCQoJCQkJCQlhbltpXS5jaGlsZE5vZGVzWzFdLmNsYXNzTmFtZSA9ICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpID09IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKSA/IAoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VOZXh0RGlzYWJsZWQgOiBvQ2xhc3Nlcy5zUGFnZU5leHRFbmFibGVkOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0sCgkJCgkJCgkJLyoKCQkgKiBWYXJpYWJsZTogaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzCgkJICogUHVycG9zZTogIENoYW5nZSB0aGUgbnVtYmVyIG9mIHBhZ2VzIHdoaWNoIGNhbiBiZSBzZWVuCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkiaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzIjogNSwKCQkKCQkvKgoJCSAqIFZhcmlhYmxlOiBmdWxsX251bWJlcnMKCQkgKiBQdXJwb3NlOiAgRnVsbCBudW1iZXJzIHBhZ2luYXRpb24KCQkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCSJmdWxsX251bWJlcnMiOiB7CgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi5mdWxsX251bWJlcnMuZm5Jbml0CgkJCSAqIFB1cnBvc2U6ICBJbml0aWFsaXNlIGRvbSBlbGVtZW50cyByZXF1aXJlZCBmb3IgcGFnaW5hdGlvbiB3aXRoIGEgbGlzdCBvZiB0aGUgcGFnZXMKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgbm9kZTpuUGFnaW5nIC0gdGhlIERJViB3aGljaCBjb250YWlucyB0aGlzIHBhZ2luYXRpb24gY29udHJvbAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIG9uIHVwZGF0ZQoJCQkgKi8KCQkJImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGZuQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKCBlICkgewoJCQkJCWlmICggb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEuYWN0aW9uICkgKQoJCQkJCXsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCX07CgkKCQkJCSQoblBhZ2luZykuYXBwZW5kKAoJCQkJCSc8YSAgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VGaXJzdCsnIj4nK29MYW5nLnNGaXJzdCsnPC9hPicrCgkJCQkJJzxhICB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZVByZXZpb3VzKyciPicrb0xhbmcuc1ByZXZpb3VzKyc8L2E+JysKCQkJCQknPHNwYW4+PC9zcGFuPicrCgkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlTmV4dCsnIj4nK29MYW5nLnNOZXh0Kyc8L2E+JysKCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VMYXN0KyciPicrb0xhbmcuc0xhc3QrJzwvYT4nCgkJCQkpOwoJCQkJdmFyIGVscyA9ICQoJ2EnLCBuUGFnaW5nKTsKCQkJCXZhciBuRmlyc3QgPSBlbHNbMF0sCgkJCQkJblByZXYgPSBlbHNbMV0sCgkJCQkJbk5leHQgPSBlbHNbMl0sCgkJCQkJbkxhc3QgPSBlbHNbM107CgkJCQkKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5GaXJzdCwge2FjdGlvbjogImZpcnN0In0sICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuUHJldiwgIHthY3Rpb246ICJwcmV2aW91cyJ9LCBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbk5leHQsICB7YWN0aW9uOiAibmV4dCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5MYXN0LCAge2FjdGlvbjogImxhc3QifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQkKCQkJCS8qIElEIHRoZSBmaXJzdCBlbGVtZW50cyBvbmx5ICovCgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJblBhZ2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3BhZ2luYXRlJzsKCQkJCQluRmlyc3QuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX2ZpcnN0JzsKCQkJCQluUHJldi5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfcHJldmlvdXMnOwoJCQkJCW5OZXh0LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19uZXh0JzsKCQkJCQluTGFzdC5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfbGFzdCc7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24uZnVsbF9udW1iZXJzLmZuVXBkYXRlCgkJCSAqIFB1cnBvc2U6ICBVcGRhdGUgdGhlIGxpc3Qgb2YgcGFnZSBidXR0b25zIHNob3dzCgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB0byBjYWxsIG9uIHBhZ2UgY2hhbmdlCgkJCSAqLwoJCQkiZm5VcGRhdGUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQl2YXIgaVBhZ2VDb3VudCA9IERhdGFUYWJsZS5leHQub1BhZ2luYXRpb24uaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzOwoJCQkJdmFyIGlQYWdlQ291bnRIYWxmID0gTWF0aC5mbG9vcihpUGFnZUNvdW50IC8gMik7CgkJCQl2YXIgaVBhZ2VzID0gTWF0aC5jZWlsKChvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpKSAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgpOwoJCQkJdmFyIGlDdXJyZW50UGFnZSA9IE1hdGguY2VpbChvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKSArIDE7CgkJCQl2YXIgc0xpc3QgPSAiIjsKCQkJCXZhciBpU3RhcnRCdXR0b24sIGlFbmRCdXR0b24sIGksIGlMZW47CgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgYW5CdXR0b25zLCBhblN0YXRpYywgblBhZ2luYXRlTGlzdDsKCQkJCXZhciBhbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wOwoJCQkJdmFyIGZuQmluZCA9IGZ1bmN0aW9uIChqKSB7CgkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggdGhpcywgeyJwYWdlIjogaitpU3RhcnRCdXR0b24tMX0sIGZ1bmN0aW9uKGUpIHsKCQkJCQkJLyogVXNlIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgZWxlbWVudCB0byBqdW1wIHRvIHRoZSByZXF1aXJlZCBwYWdlICovCgkJCQkJCW9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLnBhZ2UgKTsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJfSApOwoJCQkJfTsKCQkJCQoJCQkJLyogUGFnZXMgY2FsY3VsYXRpb24gKi8KCQkJCWlmIChpUGFnZXMgPCBpUGFnZUNvdW50KQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlQYWdlczsKCQkJCX0KCQkJCWVsc2UgaWYgKGlDdXJyZW50UGFnZSA8PSBpUGFnZUNvdW50SGFsZikKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZUNvdW50OwoJCQkJfQoJCQkJZWxzZSBpZiAoaUN1cnJlbnRQYWdlID49IChpUGFnZXMgLSBpUGFnZUNvdW50SGFsZikpCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gaVBhZ2VzIC0gaVBhZ2VDb3VudCArIDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlQYWdlczsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSBpQ3VycmVudFBhZ2UgLSBNYXRoLmNlaWwoaVBhZ2VDb3VudCAvIDIpICsgMTsKCQkJCQlpRW5kQnV0dG9uID0gaVN0YXJ0QnV0dG9uICsgaVBhZ2VDb3VudCAtIDE7CgkJCQl9CgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSBkeW5hbWljIGxpc3QgKi8KCQkJCWZvciAoIGk9aVN0YXJ0QnV0dG9uIDsgaTw9aUVuZEJ1dHRvbiA7IGkrKyApCgkJCQl7CgkJCQkJc0xpc3QgKz0gKGlDdXJyZW50UGFnZSAhPT0gaSkgPwoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPicgOgoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbkFjdGl2ZSsnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPic7CgkJCQl9CgkJCQkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhbltpXS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCApCgkJCQkJewoJCQkJCQljb250aW51ZTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogQnVpbGQgdXAgdGhlIGR5bmFtaWMgbGlzdCBmb3JzdCAtIGh0bWwgYW5kIGxpc3RlbmVycyAqLwoJCQkJCSQoJ3NwYW46ZXEoMCknLCBhbltpXSkKCQkJCQkJLmh0bWwoIHNMaXN0ICkKCQkJCQkJLmNoaWxkcmVuKCdhJykuZWFjaCggZm5CaW5kICk7CgkJCQkJCgkJCQkJLyogVXBkYXRlIHRoZSBwcmVtYW5lbnQgYm90dG9uJ3MgY2xhc3NlcyAqLwoJCQkJCWFuQnV0dG9ucyA9IGFuW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7CgkJCQkJYW5TdGF0aWMgPSBbCgkJCQkJCWFuQnV0dG9uc1swXSwgYW5CdXR0b25zWzFdLCAKCQkJCQkJYW5CdXR0b25zW2FuQnV0dG9ucy5sZW5ndGgtMl0sIGFuQnV0dG9uc1thbkJ1dHRvbnMubGVuZ3RoLTFdCgkJCQkJXTsKCQoJCQkJCSQoYW5TdGF0aWMpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VCdXR0b25BY3RpdmUrIiAiK29DbGFzc2VzLnNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQgKTsKCQkJCQkkKFthblN0YXRpY1swXSwgYW5TdGF0aWNbMV1dKS5hZGRDbGFzcyggCgkJCQkJCShpQ3VycmVudFBhZ2U9PTEpID8KCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQgOgoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VCdXR0b24KCQkJCQkpOwoJCQkJCSQoW2FuU3RhdGljWzJdLCBhblN0YXRpY1szXV0pLmFkZENsYXNzKAoJCQkJCQkoaVBhZ2VzPT09MCB8fCBpQ3VycmVudFBhZ2U9PT1pUGFnZXMgfHwgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aD09PS0xKSA/CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIDoKCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uCgkJCQkJKTsKCQkJCX0KCQkJfQoJCX0KCX0gKTsKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1NvcnQsIHsKCQkvKgoJCSAqIHRleHQgc29ydGluZwoJCSAqLwoJCSJzdHJpbmctcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCWlmICggdHlwZW9mIGEgIT0gJ3N0cmluZycgKSB7IGEgPSAnJzsgfQoJCQlyZXR1cm4gYS50b0xvd2VyQ2FzZSgpOwoJCX0sCgkKCQkic3RyaW5nLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQl9LAoJCQoJCSJzdHJpbmctZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQl9LAoJCQoJCQoJCS8qCgkJICogaHRtbCBzb3J0aW5nIChpZ25vcmUgaHRtbCB0YWdzKQoJCSAqLwoJCSJodG1sLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQlyZXR1cm4gYS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKS50b0xvd2VyQ2FzZSgpOwoJCX0sCgkJCgkJImh0bWwtYXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiAoKHggPCB5KSA/IC0xIDogKCh4ID4geSkgPyAxIDogMCkpOwoJCX0sCgkJCgkJImh0bWwtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQl9LAoJCQoJCQoJCS8qCgkJICogZGF0ZSBzb3J0aW5nCgkJICovCgkJImRhdGUtcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCXZhciB4ID0gRGF0ZS5wYXJzZSggYSApOwoJCQkKCQkJaWYgKCBpc05hTih4KSB8fCB4PT09IiIgKQoJCQl7CgkJCQl4ID0gRGF0ZS5wYXJzZSggIjAxLzAxLzE5NzAgMDA6MDA6MDAiICk7CgkJCX0KCQkJcmV0dXJuIHg7CgkJfSwKCQoJCSJkYXRlLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geCAtIHk7CgkJfSwKCQkKCQkiZGF0ZS1kZXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiB5IC0geDsKCQl9LAoJCQoJCQoJCS8qCgkJICogbnVtZXJpY2FsIHNvcnRpbmcKCQkgKi8KCQkibnVtZXJpYy1wcmUiOiBmdW5jdGlvbiAoIGEgKQoJCXsKCQkJcmV0dXJuIChhPT0iLSIgfHwgYT09PSIiKSA/IDAgOiBhKjE7CgkJfSwKCQoJCSJudW1lcmljLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geCAtIHk7CgkJfSwKCQkKCQkibnVtZXJpYy1kZXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiB5IC0geDsKCQl9Cgl9ICk7CgkKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQuYVR5cGVzLCBbCgkJLyoKCQkgKiBGdW5jdGlvbjogLQoJCSAqIFB1cnBvc2U6ICBDaGVjayB0byBzZWUgaWYgYSBzdHJpbmcgaXMgbnVtZXJpYwoJCSAqIFJldHVybnM6ICBzdHJpbmc6J251bWVyaWMnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgbWl4ZWQ6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCS8qIEFsbG93IHplcm8gbGVuZ3RoIHN0cmluZ3MgYXMgYSBudW1iZXIgKi8KCQkJaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICdudW1iZXInICkKCQkJewoJCQkJcmV0dXJuICdudW1lcmljJzsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIHNEYXRhICE9PSAnc3RyaW5nJyApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgc1ZhbGlkRmlyc3RDaGFycyA9ICIwMTIzNDU2Nzg5LSI7CgkJCXZhciBzVmFsaWRDaGFycyA9ICIwMTIzNDU2Nzg5LiI7CgkJCXZhciBDaGFyOwoJCQl2YXIgYkRlY2ltYWwgPSBmYWxzZTsKCQkJCgkJCS8qIENoZWNrIGZvciBhIHZhbGlkIGZpcnN0IGNoYXIgKG5vIHBlcmlvZCBhbmQgYWxsb3cgbmVnYXRpdmVzKSAqLwoJCQlDaGFyID0gc0RhdGEuY2hhckF0KDApOyAKCQkJaWYgKHNWYWxpZEZpcnN0Q2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBhbGwgdGhlIG90aGVyIGNoYXJhY3RlcnMgYXJlIHZhbGlkICovCgkJCWZvciAoIHZhciBpPTEgOyBpPHNEYXRhLmxlbmd0aCA7IGkrKyApIAoJCQl7CgkJCQlDaGFyID0gc0RhdGEuY2hhckF0KGkpOyAKCQkJCWlmIChzVmFsaWRDaGFycy5pbmRleE9mKENoYXIpID09IC0xKSAKCQkJCXsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0KCQkJCQoJCQkJLyogT25seSBhbGxvd2VkIG9uZSBkZWNpbWFsIHBsYWNlLi4uICovCgkJCQlpZiAoIENoYXIgPT0gIi4iICkKCQkJCXsKCQkJCQlpZiAoIGJEZWNpbWFsICkKCQkJCQl7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX0KCQkJCQliRGVjaW1hbCA9IHRydWU7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiAnbnVtZXJpYyc7CgkJfSwKCQkKCQkvKgoJCSAqIEZ1bmN0aW9uOiAtCgkJICogUHVycG9zZTogIENoZWNrIHRvIHNlZSBpZiBhIHN0cmluZyBpcyBhY3R1YWxseSBhIGZvcm1hdHRlZCBkYXRlCgkJICogUmV0dXJuczogIHN0cmluZzonZGF0ZScgb3IgbnVsbAoJCSAqIElucHV0czogICBzdHJpbmc6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCXZhciBpUGFyc2UgPSBEYXRlLnBhcnNlKHNEYXRhKTsKCQkJaWYgKCAoaVBhcnNlICE9PSBudWxsICYmICFpc05hTihpUGFyc2UpKSB8fCAodHlwZW9mIHNEYXRhID09PSAnc3RyaW5nJyAmJiBzRGF0YS5sZW5ndGggPT09IDApICkKCQkJewoJCQkJcmV0dXJuICdkYXRlJzsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9LAoJCQoJCS8qCgkJICogRnVuY3Rpb246IC0KCQkgKiBQdXJwb3NlOiAgQ2hlY2sgdG8gc2VlIGlmIGEgc3RyaW5nIHNob3VsZCBiZSB0cmVhdGVkIGFzIGFuIEhUTUwgc3RyaW5nCgkJICogUmV0dXJuczogIHN0cmluZzonaHRtbCcgb3IgbnVsbAoJCSAqIElucHV0czogICBzdHJpbmc6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCWlmICggdHlwZW9mIHNEYXRhID09PSAnc3RyaW5nJyAmJiBzRGF0YS5pbmRleE9mKCc8JykgIT0gLTEgJiYgc0RhdGEuaW5kZXhPZignPicpICE9IC0xICkKCQkJewoJCQkJcmV0dXJuICdodG1sJzsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9CgldICk7CgkKCgkvLyBqUXVlcnkgYWxpYXNlcwoJJC5mbi5EYXRhVGFibGUgPSBEYXRhVGFibGU7CgkkLmZuLmRhdGFUYWJsZSA9IERhdGFUYWJsZTsKCSQuZm4uZGF0YVRhYmxlU2V0dGluZ3MgPSBEYXRhVGFibGUuc2V0dGluZ3M7CgkkLmZuLmRhdGFUYWJsZUV4dCA9IERhdGFUYWJsZS5leHQ7CgoKCS8vIEluZm9ybWF0aW9uIGFib3V0IGV2ZW50cyBmaXJlZCBieSBEYXRhVGFibGVzIC0gZm9yIGRvY3VtZW50YXRpb24uCgkvKioKCSAqIERyYXcgZXZlbnQsIGZpcmVkIHdoZW5ldmVyIHRoZSB0YWJsZSBpcyByZWRyYXduIG9uIHRoZSBwYWdlLCBhdCB0aGUgc2FtZSBwb2ludCBhcwoJICogZm5EcmF3Q2FsbGJhY2suIFRoaXMgbWF5IGJlIHVzZWZ1bCBmb3IgYmluZGluZyBldmVudHMgb3IgcGVyZm9ybWluZyBjYWxjdWxhdGlvbnMgd2hlbgoJICogdGhlIHRhYmxlIGlzIGFsdGVyZWQgYXQgYWxsLgoJICogIEBuYW1lIERhdGFUYWJsZSNkcmF3CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCgoJLyoqCgkgKiBGaWx0ZXIgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIGZpbHRlcmluZyBhcHBsaWVkIHRvIHRoZSB0YWJsZSAodXNpbmcgdGhlIGJ1aWxkIGluIGdsb2JhbAoJICogZ2xvYmFsIGZpbHRlciwgb3IgY29sdW1uIGZpbHRlcnMpIGlzIGFsdGVyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI2ZpbHRlcgoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogUGFnZSBjaGFuZ2UgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHBhZ2luZyBvZiB0aGUgdGFibGUgaXMgYWx0ZXJlZC4KCSAqICBAbmFtZSBEYXRhVGFibGUjcGFnZQoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogU29ydCBldmVudCwgZmlyZWQgd2hlbiB0aGUgc29ydGluZyBhcHBsaWVkIHRvIHRoZSB0YWJsZSBpcyBhbHRlcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNzb3J0CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCgoJLyoqCgkgKiBEYXRhVGFibGVzIGluaXRpYWxpc2F0aW9uIGNvbXBsZXRlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSB0YWJsZSBpcyBmdWxseSBkcmF3biwKCSAqIGluY2x1ZGluZyBBamF4IGRhdGEgbG9hZGVkLCBpZiBBamF4IGRhdGEgaXMgcmVxdWlyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI2luaXQKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJICogICAgcHJlc2VudCBpZiBjbGllbnQtc2lkZSBBamF4IHNvdXJjZWQgZGF0YSBpcyB1c2VkPC9saT48L29sPgoJICovCgoJLyoqCgkgKiBTdGF0ZSBzYXZlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSB0YWJsZSBoYXMgY2hhbmdlZCBzdGF0ZSBhIG5ldyBzdGF0ZSBzYXZlIGlzIHJlcXVpcmVkLgoJICogVGhpcyBtZXRob2QgYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc3RhdGUgc2F2aW5nIG9iamVjdCBwcmlvciB0byBhY3R1YWxseSBkb2luZyB0aGUKCSAqIHNhdmUsIGluY2x1ZGluZyBhZGRpdGlvbiBvciBvdGhlciBzdGF0ZSBwcm9wZXJ0aWVzIChmb3IgcGx1Zy1pbnMpIG9yIG1vZGlmaWNhdGlvbgoJICogb2YgYSBEYXRhVGFibGVzIGNvcmUgcHJvcGVydHkuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlU2F2ZVBhcmFtcwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBUaGUgc3RhdGUgaW5mb3JtYXRpb24gdG8gYmUgc2F2ZWQKCSAqLwoKCS8qKgoJICogU3RhdGUgbG9hZCBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaXMgbG9hZGluZyBzdGF0ZSBmcm9tIHRoZSBzdG9yZWQgZGF0YSwgYnV0CgkgKiBwcmlvciB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IGJlaW5nIG1vZGlmaWVkIGJ5IHRoZSBzYXZlZCBzdGF0ZSAtIGFsbG93aW5nIG1vZGlmaWNhdGlvbgoJICogb2YgdGhlIHNhdmVkIHN0YXRlIGlzIHJlcXVpcmVkIG9yIGxvYWRpbmcgb2Ygc3RhdGUgZm9yIGEgcGx1Zy1pbi4KCSAqICBAbmFtZSBEYXRhVGFibGUjc3RhdGVMb2FkUGFyYW1zCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBzYXZlZCBzdGF0ZSBpbmZvcm1hdGlvbgoJICovCgoJLyoqCgkgKiBTdGF0ZSBsb2FkZWQgZXZlbnQsIGZpcmVkIHdoZW4gc3RhdGUgaGFzIGJlZW4gbG9hZGVkIGZyb20gc3RvcmVkIGRhdGEgYW5kIHRoZSBzZXR0aW5ncwoJICogb2JqZWN0IGhhcyBiZWVuIG1vZGlmaWVkIGJ5IHRoZSBsb2FkZWQgZGF0YS4KCSAqICBAbmFtZSBEYXRhVGFibGUjc3RhdGVMb2FkZWQKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIHNhdmVkIHN0YXRlIGluZm9ybWF0aW9uCgkgKi8KCgkvKioKCSAqIFByb2Nlc3NpbmcgZXZlbnQsIGZpcmVkIHdoZW4gRGF0YVRhYmxlcyBpcyBkb2luZyBzb21lIGtpbmQgb2YgcHJvY2Vzc2luZyAoYmUgaXQsCgkgKiBzb3J0LCBmaWx0ZXIgb3IgYW55dGhpbmcgZWxzZSkuIENhbiBiZSB1c2VkIHRvIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGF0CgkgKiB0aGVyZSBpcyBzb21ldGhpbmcgaGFwcGVuaW5nLCBvciB0aGF0IHNvbWV0aGluZyBoYXMgZmluaXNoZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3Byb2Nlc3NpbmcKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtib29sZWFufSBiU2hvdyBGbGFnIGZvciBpZiBEYXRhVGFibGVzIGlzIGRvaW5nIHByb2Nlc3Npbmcgb3Igbm90CgkgKi8KCgkvKioKCSAqIEFqYXggKFhIUikgZXZlbnQsIGZpcmVkIHdoZW5ldmVyIGFuIEFqYXggcmVxdWVzdCBpcyBjb21wbGV0ZWQgZnJvbSBhIHJlcXVlc3QgdG8gCgkgKiBtYWRlIHRvIHRoZSBzZXJ2ZXIgZm9yIG5ldyBkYXRhIChub3RlIHRoYXQgdGhpcyB0cmlnZ2VyIGlzIGNhbGxlZCBpbiBmblNlcnZlckRhdGEsCgkgKiBpZiB5b3Ugb3ZlcnJpZGUgZm5TZXJ2ZXJEYXRhIGFuZCB3aGljaCB0byB1c2UgdGhpcyBldmVudCwgeW91IG5lZWQgdG8gdHJpZ2dlciBpdCBpbgoJICogeW91IHN1Y2Nlc3MgZnVuY3Rpb24pLgoJICogIEBuYW1lIERhdGFUYWJsZSN4aHIKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KfShqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkpOwo=",
                "body": "LyoqCiAqIEBzdW1tYXJ5ICAgICBEYXRhVGFibGVzCiAqIEBkZXNjcmlwdGlvbiBQYWdpbmF0ZSwgc2VhcmNoIGFuZCBzb3J0IEhUTUwgdGFibGVzCiAqIEB2ZXJzaW9uICAgICAxLjkuMAogKiBAZmlsZSAgICAgICAganF1ZXJ5LmRhdGFUYWJsZXMuanMKICogQGF1dGhvciAgICAgIEFsbGFuIEphcmRpbmUgKHd3dy5zcHJ5bWVkaWEuY28udWspCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QKICoKICogQGNvcHlyaWdodCBDb3B5cmlnaHQgMjAwOC0yMDEyIEFsbGFuIEphcmRpbmUsIGFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZnJlZSBzb2Z0d2FyZSwgdW5kZXIgZWl0aGVyIHRoZSBHUEwgdjIgbGljZW5zZSBvciBhCiAqIEJTRCBzdHlsZSBsaWNlbnNlLCBhdmFpbGFibGUgYXQ6CiAqICAgaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2VfZ3BsMgogKiAgIGh0dHA6Ly9kYXRhdGFibGVzLm5ldC9saWNlbnNlX2JzZAogKiAKICogVGhpcyBzb3VyY2UgZmlsZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIAogKiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLgogKiAKICogRm9yIGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvOiBodHRwOi8vd3d3LmRhdGF0YWJsZXMubmV0CiAqLwoKLypqc2xpbnQgZXZpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIGJyb3dzZXI6IHRydWUgKi8KLypnbG9iYWxzICQsIGpRdWVyeSxfZm5FeHRlcm5BcGlGdW5jLF9mbkluaXRpYWxpc2UsX2ZuSW5pdENvbXBsZXRlLF9mbkxhbmd1YWdlQ29tcGF0LF9mbkFkZENvbHVtbixfZm5Db2x1bW5PcHRpb25zLF9mbkFkZERhdGEsX2ZuQ3JlYXRlVHIsX2ZuR2F0aGVyRGF0YSxfZm5CdWlsZEhlYWQsX2ZuRHJhd0hlYWQsX2ZuRHJhdyxfZm5SZURyYXcsX2ZuQWpheFVwZGF0ZSxfZm5BamF4UGFyYW1ldGVycyxfZm5BamF4VXBkYXRlRHJhdyxfZm5TZXJ2ZXJQYXJhbXMsX2ZuQWRkT3B0aW9uc0h0bWwsX2ZuRmVhdHVyZUh0bWxUYWJsZSxfZm5TY3JvbGxEcmF3LF9mbkFkanVzdENvbHVtblNpemluZyxfZm5GZWF0dXJlSHRtbEZpbHRlcixfZm5GaWx0ZXJDb21wbGV0ZSxfZm5GaWx0ZXJDdXN0b20sX2ZuRmlsdGVyQ29sdW1uLF9mbkZpbHRlcixfZm5CdWlsZFNlYXJjaEFycmF5LF9mbkJ1aWxkU2VhcmNoUm93LF9mbkZpbHRlckNyZWF0ZVNlYXJjaCxfZm5EYXRhVG9TZWFyY2gsX2ZuU29ydCxfZm5Tb3J0QXR0YWNoTGlzdGVuZXIsX2ZuU29ydGluZ0NsYXNzZXMsX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSxfZm5QYWdlQ2hhbmdlLF9mbkZlYXR1cmVIdG1sSW5mbyxfZm5VcGRhdGVJbmZvLF9mbkZlYXR1cmVIdG1sTGVuZ3RoLF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyxfZm5Qcm9jZXNzaW5nRGlzcGxheSxfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCxfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSxfZm5Ob2RlVG9EYXRhSW5kZXgsX2ZuVmlzYmxlQ29sdW1ucyxfZm5DYWxjdWxhdGVFbmQsX2ZuQ29udmVydFRvV2lkdGgsX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0LF9mbkdldFdpZGVzdE5vZGUsX2ZuR2V0TWF4TGVuU3RyaW5nLF9mblN0cmluZ1RvQ3NzLF9mbkRldGVjdFR5cGUsX2ZuU2V0dGluZ3NGcm9tTm9kZSxfZm5HZXREYXRhTWFzdGVyLF9mbkdldFRyTm9kZXMsX2ZuR2V0VGROb2RlcyxfZm5Fc2NhcGVSZWdleCxfZm5EZWxldGVJbmRleCxfZm5SZU9yZGVySW5kZXgsX2ZuQ29sdW1uT3JkZXJpbmcsX2ZuTG9nLF9mbkNsZWFyVGFibGUsX2ZuU2F2ZVN0YXRlLF9mbkxvYWRTdGF0ZSxfZm5DcmVhdGVDb29raWUsX2ZuUmVhZENvb2tpZSxfZm5EZXRlY3RIZWFkZXIsX2ZuR2V0VW5pcXVlVGhzLF9mblNjcm9sbEJhcldpZHRoLF9mbkFwcGx5VG9DaGlsZHJlbixfZm5NYXAsX2ZuR2V0Um93RGF0YSxfZm5HZXRDZWxsRGF0YSxfZm5TZXRDZWxsRGF0YSxfZm5HZXRPYmplY3REYXRhRm4sX2ZuU2V0T2JqZWN0RGF0YUZuLF9mbkFwcGx5Q29sdW1uRGVmcyxfZm5CaW5kQWN0aW9uLF9mbkNhbGxiYWNrUmVnLF9mbkNhbGxiYWNrRmlyZSxfZm5Kc29uU3RyaW5nLF9mblJlbmRlcixfZm5Ob2RlVG9Db2x1bW5JbmRleCovCgooLyoqIEBsZW5kcyA8Z2xvYmFsPiAqL2Z1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewoJLyoqIAoJICogRGF0YVRhYmxlcyBpcyBhIHBsdWctaW4gZm9yIHRoZSBqUXVlcnkgSmF2YXNjcmlwdCBsaWJyYXJ5LiBJdCBpcyBhIAoJICogaGlnaGx5IGZsZXhpYmxlIHRvb2wsIGJhc2VkIHVwb24gdGhlIGZvdW5kYXRpb25zIG9mIHByb2dyZXNzaXZlIAoJICogZW5oYW5jZW1lbnQsIHdoaWNoIHdpbGwgYWRkIGFkdmFuY2VkIGludGVyYWN0aW9uIGNvbnRyb2xzIHRvIGFueSAKCSAqIEhUTUwgdGFibGUuIEZvciBhIGZ1bGwgbGlzdCBvZiBmZWF0dXJlcyBwbGVhc2UgcmVmZXIgdG8KCSAqIDxhIGhyZWY9Imh0dHA6Ly9kYXRhdGFibGVzLm5ldCI+RGF0YVRhYmxlcy5uZXQ8L2E+LgoJICoKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlPC9pPiBvYmplY3QgaXMgbm90IGEgZ2xvYmFsIHZhcmlhYmxlIGJ1dCBpcwoJICogYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uRGF0YVRhYmxlPC9pPiBhbmQgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZTwvaT4gdGhyb3VnaCB3aGljaCAKCSAqIGl0IG1heSBiZSAgYWNjZXNzZWQuCgkgKgoJICogIEBjbGFzcwoJICogIEBwYXJhbSB7b2JqZWN0fSBbb0luaXQ9e31dIENvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciBEYXRhVGFibGVzLiBPcHRpb25zCgkgKiAgICBhcmUgZGVmaW5lZCBieSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfQoJICogIEByZXF1aXJlcyBqUXVlcnkgMS4zKwoJICogCgkgKiAgQGV4YW1wbGUKCSAqICAgIC8vIEJhc2ljIGluaXRpYWxpc2F0aW9uCgkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gewoJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJICogICAgfSApOwoJICogIAoJICogIEBleGFtcGxlCgkgKiAgICAvLyBJbml0aWFsaXNhdGlvbiB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyAtIGluIHRoaXMgY2FzZSwgZGlzYWJsZQoJICogICAgLy8gcGFnaW5hdGlvbiBhbmQgc29ydGluZy4KCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiB7CgkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlLAoJICogICAgICAgICJiU29ydCI6IGZhbHNlIAoJICogICAgICB9ICk7CgkgKiAgICB9ICk7CgkgKi8KCXZhciBEYXRhVGFibGUgPSBmdW5jdGlvbiggb0luaXQgKQoJewoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhIGNvbHVtbiB0byB0aGUgbGlzdCB1c2VkIGZvciB0aGUgdGFibGUgd2l0aCBkZWZhdWx0IHZhbHVlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gblRoIFRoZSB0aCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncywgblRoICkKCQl7CgkJCXZhciBvRGVmYXVsdHMgPSBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uczsKCQkJdmFyIGlDb2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9Db2wgPSAkLmV4dGVuZCgge30sIERhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiwgb0RlZmF1bHRzLCB7CgkJCQkic1NvcnRpbmdDbGFzcyI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQkic1NvcnRpbmdDbGFzc0pVSSI6IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSSwKCQkJCSJuVGgiOiBuVGggPyBuVGggOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpLAoJCQkJInNUaXRsZSI6ICAgIG9EZWZhdWx0cy5zVGl0bGUgICAgPyBvRGVmYXVsdHMuc1RpdGxlICAgIDogblRoID8gblRoLmlubmVySFRNTCA6ICcnLAoJCQkJImFEYXRhU29ydCI6IG9EZWZhdWx0cy5hRGF0YVNvcnQgPyBvRGVmYXVsdHMuYURhdGFTb3J0IDogW2lDb2xdLAoJCQkJIm1EYXRhUHJvcCI6IG9EZWZhdWx0cy5tRGF0YVByb3AgPyBvRGVmYXVsdHMub0RlZmF1bHRzIDogaUNvbAoJCQl9ICk7CgkJCW9TZXR0aW5ncy5hb0NvbHVtbnMucHVzaCggb0NvbCApOwoJCQkKCQkJLyogQWRkIGEgY29sdW1uIHNwZWNpZmljIGZpbHRlciAqLwoJCQlpZiAoIG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbIGlDb2wgXSA9PT0gdW5kZWZpbmVkIHx8IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbIGlDb2wgXSA9PT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbIGlDb2wgXSA9ICQuZXh0ZW5kKCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQl2YXIgb1ByZSA9IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbIGlDb2wgXTsKCQkJCQoJCQkJLyogRG9uJ3QgcmVxdWlyZSB0aGF0IHRoZSB1c2VyIG11c3Qgc3BlY2lmeSBiUmVnZXgsIGJTbWFydCBvciBiQ2FzZUluc2Vuc2l0aXZlICovCgkJCQlpZiAoIG9QcmUuYlJlZ2V4ID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9QcmUuYlJlZ2V4ID0gdHJ1ZTsKCQkJCX0KCQkJCQoJCQkJaWYgKCBvUHJlLmJTbWFydCA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvUHJlLmJTbWFydCA9IHRydWU7CgkJCQl9CgkJCQkKCQkJCWlmICggb1ByZS5iQ2FzZUluc2Vuc2l0aXZlID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9QcmUuYkNhc2VJbnNlbnNpdGl2ZSA9IHRydWU7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFVzZSB0aGUgY29sdW1uIG9wdGlvbnMgZnVuY3Rpb24gdG8gaW5pdGlhbGlzZSBjbGFzc2VzIGV0YyAqLwoJCQlfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG51bGwgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgb3B0aW9ucyBmb3IgYSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBjb2x1bW4gaW5kZXggdG8gY29uc2lkZXIKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9PcHRpb25zIG9iamVjdCB3aXRoIHNUeXBlLCBiVmlzaWJsZSBhbmQgYlNlYXJjaGFibGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29sdW1uT3B0aW9ucyggb1NldHRpbmdzLCBpQ29sLCBvT3B0aW9ucyApCgkJewoJCQl2YXIgb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbIGlDb2wgXTsKCQkJCgkJCS8qIFVzZXIgc3BlY2lmaWVkIGNvbHVtbiBvcHRpb25zICovCgkJCWlmICggb09wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBvT3B0aW9ucyAhPT0gbnVsbCApCgkJCXsKCQkJCWlmICggb09wdGlvbnMuc1R5cGUgIT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb0NvbC5zVHlwZSA9IG9PcHRpb25zLnNUeXBlOwoJCQkJCW9Db2wuX2JBdXRvVHlwZSA9IGZhbHNlOwoJCQkJfQoJCQkJCgkJCQkkLmV4dGVuZCggb0NvbCwgb09wdGlvbnMgKTsKCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJzV2lkdGgiLCAic1dpZHRoT3JpZyIgKTsKCQkKCQkJCS8qIGlEYXRhU29ydCB0byBiZSBhcHBsaWVkIChiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSksIGJ1dCBhRGF0YVNvcnQgd2lsbCB0YWtlCgkJCQkgKiBwcmlvcml0eSBpZiBkZWZpbmVkCgkJCQkgKi8KCQkJCWlmICggb09wdGlvbnMuaURhdGFTb3J0ICE9PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9Db2wuYURhdGFTb3J0ID0gWyBvT3B0aW9ucy5pRGF0YVNvcnQgXTsKCQkJCX0KCQkJCV9mbk1hcCggb0NvbCwgb09wdGlvbnMsICJhRGF0YVNvcnQiICk7CgkJCX0KCQkKCQkJLyogQ2FjaGUgdGhlIGRhdGEgZ2V0IGFuZCBzZXQgZnVuY3Rpb25zIGZvciBzcGVlZCAqLwoJCQlvQ29sLmZuR2V0RGF0YSA9IF9mbkdldE9iamVjdERhdGFGbiggb0NvbC5tRGF0YVByb3AgKTsKCQkJb0NvbC5mblNldERhdGEgPSBfZm5TZXRPYmplY3REYXRhRm4oIG9Db2wubURhdGFQcm9wICk7CgkJCQoJCQkvKiBGZWF0dXJlIHNvcnRpbmcgb3ZlcnJpZGVzIGNvbHVtbiBzcGVjaWZpYyB3aGVuIG9mZiAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJb0NvbC5iU29ydGFibGUgPSBmYWxzZTsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgdGhhdCB0aGUgY2xhc3MgYXNzaWdubWVudCBpcyBjb3JyZWN0IGZvciBzb3J0aW5nICovCgkJCWlmICggIW9Db2wuYlNvcnRhYmxlIHx8CgkJCQkgKCQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSkgKQoJCQl7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3MgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZTsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9ICIiOwoJCQl9CgkJCWVsc2UgaWYgKCBvQ29sLmJTb3J0YWJsZSB8fAoJCQkgICAgICAgICAgKCQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSkgKQoJCQl7CgkJCSAgb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZTsKCQkJICBvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUk7CgkJCX0KCQkJZWxzZSBpZiAoICQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpICE9IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSApCgkJCXsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVBc2M7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3NKVUkgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUlBc2NBbGxvd2VkOwoJCQl9CgkJCWVsc2UgaWYgKCAkLmluQXJyYXkoJ2FzYycsIG9Db2wuYXNTb3J0aW5nKSA9PSAtMSAmJiAkLmluQXJyYXkoJ2Rlc2MnLCBvQ29sLmFzU29ydGluZykgIT0gLTEgKQoJCQl7CgkJCQlvQ29sLnNTb3J0aW5nQ2xhc3MgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlRGVzYzsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSURlc2NBbGxvd2VkOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkanVzdCB0aGUgdGFibGUgY29sdW1uIHdpZHRocyBmb3IgbmV3IGRhdGEuIE5vdGU6IHlvdSB3b3VsZCBwcm9iYWJseSB3YW50IHRvIAoJCSAqIGRvIGEgcmVkcmF3IGFmdGVyIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiEKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGp1c3RDb2x1bW5TaXppbmcgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogTm90IGludGVyZXN0ZWQgaW4gZG9pbmcgY29sdW1uIHdpZHRoIGNhbGN1bGF0aW9uIGlmIGF1dG93aWR0aCBpcyBkaXNhYmxlZCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCA9PT0gZmFsc2UgKQoJCQl7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJCgkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCWZvciAoIHZhciBpPTAgLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGguc3R5bGUud2lkdGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aDsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDb3ZlcnQgdGhlIGluZGV4IG9mIGEgdmlzaWJsZSBjb2x1bW4gdG8gdGhlIGluZGV4IGluIHRoZSBkYXRhIGFycmF5ICh0YWtlIGFjY291bnQKCQkgKiBvZiBoaWRkZW4gY29sdW1ucykKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaU1hdGNoIFZpc2libGUgY29sdW1uIGluZGV4IHRvIGxvb2t1cAoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBkYXRhIGluZGV4CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblZpc2libGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlNYXRjaCApCgkJewoJCQl2YXIgaUNvbHVtbiA9IC0xOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgPT09IHRydWUgKQoJCQkJewoJCQkJCWlDb2x1bW4rKzsKCQkJCX0KCQkJCQoJCQkJaWYgKCBpQ29sdW1uID09IGlNYXRjaCApCgkJCQl7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBudWxsOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBDb3ZlcnQgdGhlIGluZGV4IG9mIGFuIGluZGV4IGluIHRoZSBkYXRhIGFycmF5IGFuZCBjb252ZXJ0IGl0IHRvIHRoZSB2aXNpYmxlCgkJICogICBjb2x1bW4gaW5kZXggKHRha2UgYWNjb3VudCBvZiBoaWRkZW4gY29sdW1ucykKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXRjaCBDb2x1bW4gaW5kZXggdG8gbG9va3VwCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2ludH0gaSB0aGUgZGF0YSBpbmRleAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSggb1NldHRpbmdzLCBpTWF0Y2ggKQoJCXsKCQkJdmFyIGlWaXNpYmxlID0gLTE7CgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSB0cnVlICkKCQkJCXsKCQkJCQlpVmlzaWJsZSsrOwoJCQkJfQoJCQkJCgkJCQlpZiAoIGkgPT0gaU1hdGNoICkKCQkJCXsKCQkJCQlyZXR1cm4gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSA9PT0gdHJ1ZSA/IGlWaXNpYmxlIDogbnVsbDsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgbnVtYmVyIG9mIHZpc2libGUgY29sdW1ucwoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBudW1iZXIgb2YgdmlzaWJsZSBjb2x1bW5zCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvUyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5WaXNibGVDb2x1bW5zKCBvUyApCgkJewoJCQl2YXIgaVZpcyA9IDA7CgkJCWZvciAoIHZhciBpPTAgOyBpPG9TLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSA9PT0gdHJ1ZSApCgkJCQl7CgkJCQkJaVZpcysrOwoJCQkJfQoJCQl9CgkJCXJldHVybiBpVmlzOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHNvcnQgdHlwZSBiYXNlZCBvbiBhbiBpbnB1dCBzdHJpbmcKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNEYXRhIGRhdGEgd2Ugd2lzaCB0byBrbm93IHRoZSB0eXBlIG9mCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IHR5cGUgKGRlZmF1bHRzIHRvICdzdHJpbmcnIGlmIG5vIHR5cGUgY2FuIGJlIGRldGVjdGVkKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EZXRlY3RUeXBlKCBzRGF0YSApCgkJewoJCQl2YXIgYVR5cGVzID0gRGF0YVRhYmxlLmV4dC5hVHlwZXM7CgkJCXZhciBpTGVuID0gYVR5cGVzLmxlbmd0aDsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgc1R5cGUgPSBhVHlwZXNbaV0oIHNEYXRhICk7CgkJCQlpZiAoIHNUeXBlICE9PSBudWxsICkKCQkJCXsKCQkJCQlyZXR1cm4gc1R5cGU7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiAnc3RyaW5nJzsKCQl9CgkJCgkJCgkJLyoqCgkJICogRmlndXJlIG91dCBob3cgdG8gcmVvcmRlciBhIGRpc3BsYXkgbGlzdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIGFycmF5IHtpbnR9IGFpUmV0dXJuIGluZGV4IGxpc3QgZm9yIHJlb3JkZXJpbmcKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVPcmRlckluZGV4ICggb1NldHRpbmdzLCBzQ29sdW1ucyApCgkJewoJCQl2YXIgYUNvbHVtbnMgPSBzQ29sdW1ucy5zcGxpdCgnLCcpOwoJCQl2YXIgYWlSZXR1cm4gPSBbXTsKCQkJCgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlmb3IgKCB2YXIgaj0wIDsgajxpTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc05hbWUgPT0gYUNvbHVtbnNbal0gKQoJCQkJCXsKCQkJCQkJYWlSZXR1cm4ucHVzaCggaiApOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBhaVJldHVybjsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBjb2x1bW4gb3JkZXJpbmcgdGhhdCBEYXRhVGFibGVzIGV4cGVjdHMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBuYW1lcwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5PcmRlcmluZyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgc05hbWVzID0gJyc7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlzTmFtZXMgKz0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zTmFtZSsnLCc7CgkJCX0KCQkJaWYgKCBzTmFtZXMubGVuZ3RoID09IGlMZW4gKQoJCQl7CgkJCQlyZXR1cm4gIiI7CgkJCX0KCQkJcmV0dXJuIHNOYW1lcy5zbGljZSgwLCAtMSk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFRha2UgdGhlIGNvbHVtbiBkZWZpbml0aW9ucyBhbmQgc3RhdGljIGNvbHVtbnMgYXJyYXlzIGFuZCBjYWxjdWxhdGUgaG93CgkJICogdGhleSByZWxhdGUgdG8gY29sdW1uIGluZGV4ZXMuIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aWxsIHRoZW4gYXBwbHkgdGhlCgkJICogZGVmaW5pdGlvbiBmb3VuZCBmb3IgYSBjb2x1bW4gdG8gYSBzdWl0YWJsZSBjb25maWd1cmF0aW9uIG9iamVjdC4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0NvbERlZnMgVGhlIGFvQ29sdW1uRGVmcyBhcnJheSB0aGF0IGlzIHRvIGJlIGFwcGxpZWQKCQkgKiAgQHBhcmFtIHthcnJheX0gYW9Db2xzIFRoZSBhb0NvbHVtbnMgYXJyYXkgdGhhdCBkZWZpbmVzIGNvbHVtbnMgaW5kaXZpZHVhbGx5CgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIENhbGxiYWNrIGZ1bmN0aW9uIC0gdGFrZXMgdHdvIHBhcmFtZXRlcnMsIHRoZSBjYWxjdWxhdGVkCgkJICogICAgY29sdW1uIGluZGV4IGFuZCB0aGUgZGVmaW5pdGlvbiBmb3IgdGhhdCBjb2x1bW4uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFwcGx5Q29sdW1uRGVmcyggb1NldHRpbmdzLCBhb0NvbERlZnMsIGFvQ29scywgZm4gKQoJCXsKCQkJdmFyIGksIGlMZW4sIGosIGpMZW4sIGssIGtMZW47CgkJCgkJCS8vIENvbHVtbiBkZWZpbml0aW9ucyB3aXRoIGFUYXJnZXRzCgkJCWlmICggYW9Db2xEZWZzICkKCQkJewoJCQkJLyogTG9vcCBvdmVyIHRoZSBkZWZpbml0aW9ucyBhcnJheSAtIGxvb3AgaW4gcmV2ZXJzZSBzbyBmaXJzdCBpbnN0YW5jZSBoYXMgcHJpb3JpdHkgKi8KCQkJCWZvciAoIGk9YW9Db2xEZWZzLmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCQl7CgkJCQkJLyogRWFjaCBkZWZpbml0aW9uIGNhbiB0YXJnZXQgbXVsdGlwbGUgY29sdW1ucywgYXMgaXQgaXMgYW4gYXJyYXkgKi8KCQkJCQl2YXIgYVRhcmdldHMgPSBhb0NvbERlZnNbaV0uYVRhcmdldHM7CgkJCQkJaWYgKCAhJC5pc0FycmF5KCBhVGFyZ2V0cyApICkKCQkJCQl7CgkJCQkJCV9mbkxvZyggb1NldHRpbmdzLCAxLCAnYVRhcmdldHMgbXVzdCBiZSBhbiBhcnJheSBvZiB0YXJnZXRzLCBub3QgYSAnKyh0eXBlb2YgYVRhcmdldHMpICk7CgkJCQkJfQoJCQoJCQkJCWZvciAoIGo9MCwgakxlbj1hVGFyZ2V0cy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCXsKCQkJCQkJaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdudW1iZXInICYmIGFUYXJnZXRzW2pdID49IDAgKQoJCQkJCQl7CgkJCQkJCQkvKiBBZGQgY29sdW1ucyB0aGF0IHdlIGRvbid0IHlldCBrbm93IGFib3V0ICovCgkJCQkJCQl3aGlsZSggb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggPD0gYVRhcmdldHNbal0gKQoJCQkJCQkJewoJCQkJCQkJCV9mbkFkZENvbHVtbiggb1NldHRpbmdzICk7CgkJCQkJCQl9CgkJCgkJCQkJCQkvKiBJbnRlZ2VyLCBiYXNpYyBpbmRleCAqLwoJCQkJCQkJZm4oIGFUYXJnZXRzW2pdLCBhb0NvbERlZnNbaV0gKTsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggdHlwZW9mIGFUYXJnZXRzW2pdID09PSAnbnVtYmVyJyAmJiBhVGFyZ2V0c1tqXSA8IDAgKQoJCQkJCQl7CgkJCQkJCQkvKiBOZWdhdGl2ZSBpbnRlZ2VyLCByaWdodCB0byBsZWZ0IGNvbHVtbiBjb3VudGluZyAqLwoJCQkJCQkJZm4oIG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoK2FUYXJnZXRzW2pdLCBhb0NvbERlZnNbaV0gKTsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggdHlwZW9mIGFUYXJnZXRzW2pdID09PSAnc3RyaW5nJyApCgkJCQkJCXsKCQkJCQkJCS8qIENsYXNzIG5hbWUgbWF0Y2hpbmcgb24gVEggZWxlbWVudCAqLwoJCQkJCQkJZm9yICggaz0wLCBrTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgazxrTGVuIDsgaysrICkKCQkJCQkJCXsKCQkJCQkJCQlpZiAoIGFUYXJnZXRzW2pdID09ICJfYWxsIiB8fAoJCQkJCQkJCSAgICAgJChvU2V0dGluZ3MuYW9Db2x1bW5zW2tdLm5UaCkuaGFzQ2xhc3MoIGFUYXJnZXRzW2pdICkgKQoJCQkJCQkJCXsKCQkJCQkJCQkJZm4oIGssIGFvQ29sRGVmc1tpXSApOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQkvLyBTdGF0aWNhbGx5IGRlZmluZWQgY29sdW1ucyBhcnJheQoJCQlpZiAoIGFvQ29scyApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hb0NvbHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlmbiggaSwgYW9Db2xzW2ldICk7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogQWRkIGEgZGF0YSBhcnJheSB0byB0aGUgdGFibGUsIGNyZWF0aW5nIERPTSBub2RlIGV0Yy4gVGhpcyBpcyB0aGUgcGFyYWxsZWwgdG8gCgkJICogX2ZuR2F0aGVyRGF0YSwgYnV0IGZvciBhZGRpbmcgcm93cyBmcm9tIGEgSmF2YXNjcmlwdCBzb3VyY2UsIHJhdGhlciB0aGFuIGEKCQkgKiBET00gc291cmNlLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIGRhdGEgYXJyYXkgdG8gYmUgYWRkZWQKCQkgKiAgQHJldHVybnMge2ludH0gPj0wIGlmIHN1Y2Nlc3NmdWwgKGluZGV4IG9mIG5ldyBhb0RhdGEgZW50cnkpLCAtMSBpZiBmYWlsZWQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWRkRGF0YSAoIG9TZXR0aW5ncywgYURhdGFTdXBwbGllZCApCgkJewoJCQl2YXIgb0NvbDsKCQkJCgkJCS8qIFRha2UgYW4gaW5kZXBlbmRlbnQgY29weSBvZiB0aGUgZGF0YSBzb3VyY2Ugc28gd2UgY2FuIGJhc2ggaXQgYWJvdXQgYXMgd2Ugd2lzaCAqLwoJCQl2YXIgYURhdGFJbiA9ICgkLmlzQXJyYXkoYURhdGFTdXBwbGllZCkpID8KCQkJCWFEYXRhU3VwcGxpZWQuc2xpY2UoKSA6CgkJCQkkLmV4dGVuZCggdHJ1ZSwge30sIGFEYXRhU3VwcGxpZWQgKTsKCQkJCgkJCS8qIENyZWF0ZSB0aGUgb2JqZWN0IGZvciBzdG9yaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgbmV3IHJvdyAqLwoJCQl2YXIgaVJvdyA9IG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoOwoJCQl2YXIgb0RhdGEgPSAkLmV4dGVuZCggdHJ1ZSwge30sIERhdGFUYWJsZS5tb2RlbHMub1JvdywgewoJCQkJIl9hRGF0YSI6IGFEYXRhSW4KCQkJfSApOwoJCQlvU2V0dGluZ3MuYW9EYXRhLnB1c2goIG9EYXRhICk7CgkJCgkJCS8qIENyZWF0ZSB0aGUgY2VsbHMgKi8KCQkJdmFyIG5UZCwgc1RoaXNUeXBlOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV07CgkJCgkJCQkvKiBVc2UgcmVuZGVyZWQgZGF0YSBmb3IgZmlsdGVyaW5nL3NvcnRpbmcgKi8KCQkJCWlmICggdHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgb0NvbC5iVXNlUmVuZGVyZWQgJiYgb0NvbC5tRGF0YVByb3AgIT09IG51bGwgKQoJCQkJewoJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksIF9mblJlbmRlcihvU2V0dGluZ3MsIGlSb3csIGkpICk7CgkJCQl9CgkJCQkKCQkJCS8qIFNlZSBpZiB3ZSBzaG91bGQgYXV0by1kZXRlY3QgdGhlIGNvbHVtbiB0eXBlICovCgkJCQlpZiAoIG9Db2wuX2JBdXRvVHlwZSAmJiBvQ29sLnNUeXBlICE9ICdzdHJpbmcnICkKCQkJCXsKCQkJCQkvKiBBdHRlbXB0IHRvIGF1dG8gZGV0ZWN0IHRoZSB0eXBlIC0gc2FtZSBhcyBfZm5HYXRoZXJEYXRhKCkgKi8KCQkJCQl2YXIgc1ZhclR5cGUgPSBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAndHlwZScgKTsKCQkJCQlpZiAoIHNWYXJUeXBlICE9PSBudWxsICYmIHNWYXJUeXBlICE9PSAnJyApCgkJCQkJewoJCQkJCQlzVGhpc1R5cGUgPSBfZm5EZXRlY3RUeXBlKCBzVmFyVHlwZSApOwoJCQkJCQlpZiAoIG9Db2wuc1R5cGUgPT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQlvQ29sLnNUeXBlID0gc1RoaXNUeXBlOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBvQ29sLnNUeXBlICE9IHNUaGlzVHlwZSAmJiBvQ29sLnNUeXBlICE9ICJodG1sIiApCgkJCQkJCXsKCQkJCQkJCS8qIFN0cmluZyBpcyBhbHdheXMgdGhlICdmYWxsYmFjaycgb3B0aW9uICovCgkJCQkJCQlvQ29sLnNUeXBlID0gJ3N0cmluZyc7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEFkZCB0byB0aGUgZGlzcGxheSBhcnJheSAqLwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnB1c2goIGlSb3cgKTsKCQkKCQkJLyogQ3JlYXRlIHRoZSBET00gaW1mb3JtYXRpb24gKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQl7CgkJCQlfZm5DcmVhdGVUciggb1NldHRpbmdzLCBpUm93ICk7CgkJCX0KCQkKCQkJcmV0dXJuIGlSb3c7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlYWQgaW4gdGhlIGRhdGEgZnJvbSB0aGUgdGFyZ2V0IHRhYmxlIGZyb20gdGhlIERPTQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdhdGhlckRhdGEoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaUxvb3AsIGksIGlMZW4sIGosIGpMZW4sIGpJbm5lciwKCQkJIAluVGRzLCBuVHJzLCBuVGQsIGFMb2NhbERhdGEsIGlUaGlzSW5kZXgsCgkJCQlpUm93LCBpUm93cywgaUNvbHVtbiwgaUNvbHVtbnMsIHNOb2RlTmFtZSwKCQkJCW9Db2wsIG9EYXRhOwoJCQkKCQkJLyoKCQkJICogUHJvY2VzcyBieSByb3cgZmlyc3QKCQkJICogQWRkIHRoZSBkYXRhIG9iamVjdCBmb3IgdGhlIHdob2xlIHRhYmxlIC0gc3RvcmluZyB0aGUgdHIgbm9kZS4gTm90ZSAtIG5vIHBvaW50IGluIGdldHRpbmcKCQkJICogRE9NIGJhc2VkIGRhdGEgaWYgd2UgYXJlIGdvaW5nIHRvIGdvIGFuZCByZXBsYWNlIGl0IHdpdGggQWpheCBzb3VyY2UgZGF0YS4KCQkJICovCgkJCWlmICggb1NldHRpbmdzLmJEZWZlckxvYWRpbmcgfHwgb1NldHRpbmdzLnNBamF4U291cmNlID09PSBudWxsICkKCQkJewoJCQkJblRycyA9IG9TZXR0aW5ncy5uVEJvZHkuY2hpbGROb2RlczsKCQkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBuVHJzW2ldLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT0gIlRSIiApCgkJCQkJewoJCQkJCQlpVGhpc0luZGV4ID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCQkJCW5UcnNbaV0uX0RUX1Jvd0luZGV4ID0gaVRoaXNJbmRleDsKCQkJCQkJb1NldHRpbmdzLmFvRGF0YS5wdXNoKCAkLmV4dGVuZCggdHJ1ZSwge30sIERhdGFUYWJsZS5tb2RlbHMub1JvdywgewoJCQkJCQkJIm5UciI6IG5UcnNbaV0KCQkJCQkJfSApICk7CgkJCQkJCQoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnB1c2goIGlUaGlzSW5kZXggKTsKCQkJCQkJblRkcyA9IG5UcnNbaV0uY2hpbGROb2RlczsKCQkJCQkJaklubmVyID0gMDsKCQkJCQkJCgkJCQkJCWZvciAoIGo9MCwgakxlbj1uVGRzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJCXsKCQkJCQkJCXNOb2RlTmFtZSA9IG5UZHNbal0ubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQkJCWlmICggc05vZGVOYW1lID09ICJURCIgfHwgc05vZGVOYW1lID09ICJUSCIgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlUaGlzSW5kZXgsIGpJbm5lciwgJC50cmltKG5UZHNbal0uaW5uZXJIVE1MKSApOwoJCQkJCQkJCWpJbm5lcisrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBHYXRoZXIgaW4gdGhlIFREIGVsZW1lbnRzIG9mIHRoZSBUYWJsZSAtIG5vdGUgdGhhdCB0aGlzIGlzIGJhc2ljYWxseSB0aGUgc2FtZSBhcwoJCQkgKiBmbkdldFRkTm9kZXMsIGJ1dCB0aGF0IGZ1bmN0aW9uIHRha2VzIGFjY291bnQgb2YgaGlkZGVuIGNvbHVtbnMsIHdoaWNoIHdlIGhhdmVuJ3QgeWV0CgkJCSAqIHNldHVwIQoJCQkgKi8KCQkJblRycyA9IF9mbkdldFRyTm9kZXMoIG9TZXR0aW5ncyApOwoJCQluVGRzID0gW107CgkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIGo9MCwgakxlbj1uVHJzW2ldLmNoaWxkTm9kZXMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQluVGQgPSBuVHJzW2ldLmNoaWxkTm9kZXNbal07CgkJCQkJc05vZGVOYW1lID0gblRkLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk7CgkJCQkJaWYgKCBzTm9kZU5hbWUgPT0gIlREIiB8fCBzTm9kZU5hbWUgPT0gIlRIIiApCgkJCQkJewoJCQkJCQluVGRzLnB1c2goIG5UZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogTm93IHByb2Nlc3MgYnkgY29sdW1uICovCgkJCWZvciAoIGlDb2x1bW49MCwgaUNvbHVtbnM9b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpQ29sdW1uPGlDb2x1bW5zIDsgaUNvbHVtbisrICkKCQkJewoJCQkJb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl07CgkJCgkJCQkvKiBHZXQgdGhlIHRpdGxlIG9mIHRoZSBjb2x1bW4gLSB1bmxlc3MgdGhlcmUgaXMgYSB1c2VyIHNldCBvbmUgKi8KCQkJCWlmICggb0NvbC5zVGl0bGUgPT09IG51bGwgKQoJCQkJewoJCQkJCW9Db2wuc1RpdGxlID0gb0NvbC5uVGguaW5uZXJIVE1MOwoJCQkJfQoJCQkJCgkJCQl2YXIKCQkJCQliQXV0b1R5cGUgPSBvQ29sLl9iQXV0b1R5cGUsCgkJCQkJYlJlbmRlciA9IHR5cGVvZiBvQ29sLmZuUmVuZGVyID09PSAnZnVuY3Rpb24nLAoJCQkJCWJDbGFzcyA9IG9Db2wuc0NsYXNzICE9PSBudWxsLAoJCQkJCWJWaXNpYmxlID0gb0NvbC5iVmlzaWJsZSwKCQkJCQluQ2VsbCwgc1RoaXNUeXBlLCBzUmVuZGVyZWQsIHNWYWxUeXBlOwoJCQkJCgkJCQkvKiBBIHNpbmdsZSBsb29wIHRvIHJ1bGUgdGhlbSBhbGwgKGFuZCBiZSBtb3JlIGVmZmljaWVudCkgKi8KCQkJCWlmICggYkF1dG9UeXBlIHx8IGJSZW5kZXIgfHwgYkNsYXNzIHx8ICFiVmlzaWJsZSApCgkJCQl7CgkJCQkJZm9yICggaVJvdz0wLCBpUm93cz1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGlSb3c8aVJvd3MgOyBpUm93KysgKQoJCQkJCXsKCQkJCQkJb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQkJCQluQ2VsbCA9IG5UZHNbIChpUm93KmlDb2x1bW5zKSArIGlDb2x1bW4gXTsKCQkJCQkJCgkJCQkJCS8qIFR5cGUgZGV0ZWN0aW9uICovCgkJCQkJCWlmICggYkF1dG9UeXBlICYmIG9Db2wuc1R5cGUgIT0gJ3N0cmluZycgKQoJCQkJCQl7CgkJCQkJCQlzVmFsVHlwZSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICd0eXBlJyApOwoJCQkJCQkJaWYgKCBzVmFsVHlwZSAhPT0gJycgKQoJCQkJCQkJewoJCQkJCQkJCXNUaGlzVHlwZSA9IF9mbkRldGVjdFR5cGUoIHNWYWxUeXBlICk7CgkJCQkJCQkJaWYgKCBvQ29sLnNUeXBlID09PSBudWxsICkKCQkJCQkJCQl7CgkJCQkJCQkJCW9Db2wuc1R5cGUgPSBzVGhpc1R5cGU7CgkJCQkJCQkJfQoJCQkJCQkJCWVsc2UgaWYgKCBvQ29sLnNUeXBlICE9IHNUaGlzVHlwZSAmJiAKCQkJCQkJCQkgICAgICAgICAgb0NvbC5zVHlwZSAhPSAiaHRtbCIgKQoJCQkJCQkJCXsKCQkJCQkJCQkJLyogU3RyaW5nIGlzIGFsd2F5cyB0aGUgJ2ZhbGxiYWNrJyBvcHRpb24gKi8KCQkJCQkJCQkJb0NvbC5zVHlwZSA9ICdzdHJpbmcnOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQoJCQkJCQlpZiAoIHR5cGVvZiBvQ29sLm1EYXRhUHJvcCA9PT0gJ2Z1bmN0aW9uJyApCgkJCQkJCXsKCQkJCQkJCW5DZWxsLmlubmVySFRNTCA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICdkaXNwbGF5JyApOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBSZW5kZXJpbmcgKi8KCQkJCQkJaWYgKCBiUmVuZGVyICkKCQkJCQkJewoJCQkJCQkJc1JlbmRlcmVkID0gX2ZuUmVuZGVyKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4gKTsKCQkJCQkJCW5DZWxsLmlubmVySFRNTCA9IHNSZW5kZXJlZDsKCQkJCQkJCWlmICggb0NvbC5iVXNlUmVuZGVyZWQgKQoJCQkJCQkJewoJCQkJCQkJCS8qIFVzZSB0aGUgcmVuZGVyZWQgZGF0YSBmb3IgZmlsdGVyaW5nL3NvcnRpbmcgKi8KCQkJCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCBzUmVuZGVyZWQgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogQ2xhc3NlcyAqLwoJCQkJCQlpZiAoIGJDbGFzcyApCgkJCQkJCXsKCQkJCQkJCW5DZWxsLmNsYXNzTmFtZSArPSAnICcrb0NvbC5zQ2xhc3M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIENvbHVtbiB2aXNhYmlsaXR5ICovCgkJCQkJCWlmICggIWJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbkNlbGw7CgkJCQkJCQluQ2VsbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuQ2VsbCApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dID0gbnVsbDsKCQkJCQkJfQoJCQoJCQkJCQlpZiAoIG9Db2wuZm5DcmVhdGVkQ2VsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJCW5DZWxsLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sdW1uLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpQ29sdW1uCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8qIFJvdyBjcmVhdGVkIGNhbGxiYWNrcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5hb1Jvd0NyZWF0ZWRDYWxsYmFjay5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpXTsKCQkJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUm93Q3JlYXRlZENhbGxiYWNrJywgbnVsbCwgW29EYXRhLm5Uciwgb0RhdGEuX2FEYXRhLCBpXSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFRha2UgYSBUUiBlbGVtZW50IGFuZCBjb252ZXJ0IGl0IHRvIGFuIGluZGV4IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbiB0aGUgVFIgZWxlbWVudCB0byBmaW5kCgkJICogIEByZXR1cm5zIHtpbnR9IGluZGV4IGlmIHRoZSBub2RlIGlzIGZvdW5kLCBudWxsIGlmIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Ob2RlVG9EYXRhSW5kZXgoIG9TZXR0aW5ncywgbiApCgkJewoJCQlyZXR1cm4gKG4uX0RUX1Jvd0luZGV4IT09dW5kZWZpbmVkKSA/IG4uX0RUX1Jvd0luZGV4IDogbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSBhIFREIGVsZW1lbnQgYW5kIGNvbnZlcnQgaXQgaW50byBhIGNvbHVtbiBkYXRhIGluZGV4IChub3QgdGhlIHZpc2libGUgaW5kZXgpCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBudW1iZXIgdGhlIFREL1RIIGNhbiBiZSBmb3VuZCBpbgoJCSAqICBAcGFyYW0ge25vZGV9IG4gVGhlIFREL1RIIGVsZW1lbnQgdG8gZmluZAoJCSAqICBAcmV0dXJucyB7aW50fSBpbmRleCBpZiB0aGUgbm9kZSBpcyBmb3VuZCwgLTEgaWYgbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk5vZGVUb0NvbHVtbkluZGV4KCBvU2V0dGluZ3MsIGlSb3csIG4gKQoJCXsKCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5DZWxsc1tpXSA9PT0gbiApCgkJCQl7CgkJCQkJcmV0dXJuIGk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIC0xOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgZGF0YSBmb3IgYSBnaXZlbiByb3cgZnJvbSB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgndHlwZScgJ2ZpbHRlcicgJ3NvcnQnKQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Um93RGF0YSggb1NldHRpbmdzLCBpUm93LCBzU3BlY2lmaWMgKQoJCXsKCQkJdmFyIG91dCA9IFtdOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb3V0LnB1c2goIF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksIHNTcGVjaWZpYyApICk7CgkJCX0KCQkJcmV0dXJuIG91dDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBkYXRhIGZvciBhIGdpdmVuIGNlbGwgZnJvbSB0aGUgaW50ZXJuYWwgY2FjaGUsIHRha2luZyBpbnRvIGFjY291bnQgZGF0YSBtYXBwaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIHJvdyBpZAoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBDb2x1bW4gaW5kZXgKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBkYXRhIGdldCB0eXBlICgnZGlzcGxheScsICd0eXBlJyAnZmlsdGVyJyAnc29ydCcpCgkJICogIEByZXR1cm5zIHsqfSBDZWxsIGRhdGEKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgc1NwZWNpZmljICkKCQl7CgkJCXZhciBzRGF0YTsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJaWYgKCAoc0RhdGE9b0NvbC5mbkdldERhdGEoIG9EYXRhLCBzU3BlY2lmaWMgKSkgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmlEcmF3RXJyb3IgIT0gb1NldHRpbmdzLmlEcmF3ICYmIG9Db2wuc0RlZmF1bHRDb250ZW50ID09PSBudWxsICkKCQkJCXsKCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJlcXVlc3RlZCB1bmtub3duIHBhcmFtZXRlciAnIitvQ29sLm1EYXRhUHJvcCsKCQkJCQkJIicgZnJvbSB0aGUgZGF0YSBzb3VyY2UgZm9yIHJvdyAiK2lSb3cgKTsKCQkJCQlvU2V0dGluZ3MuaURyYXdFcnJvciA9IG9TZXR0aW5ncy5pRHJhdzsKCQkJCX0KCQkJCXJldHVybiBvQ29sLnNEZWZhdWx0Q29udGVudDsKCQkJfQoJCQoJCQkvKiBXaGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsLCB3ZSBjYW4gdXNlIGRlZmF1bHQgY29sdW1uIGRhdGEgKi8KCQkJaWYgKCBzRGF0YSA9PT0gbnVsbCAmJiBvQ29sLnNEZWZhdWx0Q29udGVudCAhPT0gbnVsbCApCgkJCXsKCQkJCXNEYXRhID0gb0NvbC5zRGVmYXVsdENvbnRlbnQ7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSA9PT0gJ2Z1bmN0aW9uJyApCgkJCXsKCQkJCS8qIElmIHRoZSBkYXRhIHNvdXJjZSBpcyBhIGZ1bmN0aW9uLCB0aGVuIHdlIHJ1biBpdCBhbmQgdXNlIHRoZSByZXR1cm4gKi8KCQkJCXJldHVybiBzRGF0YSgpOwoJCQl9CgkJCgkJCWlmICggc1NwZWNpZmljID09ICdkaXNwbGF5JyAmJiBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFNldCB0aGUgdmFsdWUgZm9yIGEgc3BlY2lmaWMgY2VsbCwgaW50byB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgQ29sdW1uIGluZGV4CgkJICogIEBwYXJhbSB7Kn0gdmFsIFZhbHVlIHRvIHNldAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCB2YWwgKQoJCXsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJb0NvbC5mblNldERhdGEoIG9EYXRhLCB2YWwgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGEgZnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byBnZXQgZGF0YSBmcm9tIGEgc291cmNlIG9iamVjdCwgdGFraW5nCgkJICogaW50byBhY2NvdW50IHRoZSBhYmlsaXR5IHRvIHVzZSBuZXN0ZWQgb2JqZWN0cyBhcyBhIHNvdXJjZQoJCSAqICBAcGFyYW0ge3N0cmluZ3xpbnR8ZnVuY3Rpb259IG1Tb3VyY2UgVGhlIGRhdGEgc291cmNlIGZvciB0aGUgb2JqZWN0CgkJICogIEByZXR1cm5zIHtmdW5jdGlvbn0gRGF0YSBnZXQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0T2JqZWN0RGF0YUZuKCBtU291cmNlICkKCQl7CgkJCWlmICggbVNvdXJjZSA9PT0gbnVsbCApCgkJCXsKCQkJCS8qIEdpdmUgYW4gZW1wdHkgc3RyaW5nIGZvciByZW5kZXJpbmcgLyBzb3J0aW5nIGV0YyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ2Z1bmN0aW9uJyApCgkJCXsKCQkJCXJldHVybiBmdW5jdGlvbiAoZGF0YSwgdHlwZSkgewoJCQkJCXJldHVybiBtU291cmNlKCBkYXRhLCB0eXBlICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgbVNvdXJjZS5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQl7CgkJCQkvKiBJZiB0aGVyZSBpcyBhIC4gaW4gdGhlIHNvdXJjZSBzdHJpbmcgdGhlbiB0aGUgZGF0YSBzb3VyY2UgaXMgaW4gYSAKCQkJCSAqIG5lc3RlZCBvYmplY3Qgc28gd2UgbG9vcCBvdmVyIHRoZSBkYXRhIGZvciBlYWNoIGxldmVsIHRvIGdldCB0aGUgbmV4dAoJCQkJICogbGV2ZWwgZG93bi4gT24gZWFjaCBsb29wIHdlIHRlc3QgZm9yIHVuZGVmaW5lZCwgYW5kIGlmIGZvdW5kIGltbWVkaWF0bHkKCQkJCSAqIHJldHVybi4gVGhpcyBhbGxvd3MgZW50aXJlIG9iamVjdHMgdG8gYmUgbWlzc2luZyBhbmQgc0RlZmF1bHRDb250ZW50IHRvCgkJCQkgKiBiZSB1c2VkIGlmIGRlZmluZWQsIHJhdGhlciB0aGFuIHRocm93aW5nIGFuIGVycm9yCgkJCQkgKi8KCQkJCXZhciBhID0gbVNvdXJjZS5zcGxpdCgnLicpOwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQlkYXRhID0gZGF0YVsgYVtpXSBdOwoJCQkJCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCApCgkJCQkJCXsKCQkJCQkJCXJldHVybiB1bmRlZmluZWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuIGRhdGE7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIGRhdGFbbVNvdXJjZV07CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHNldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIHNldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogTm90aGluZyB0byBkbyB3aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkge307CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQltU291cmNlKCBkYXRhLCAnc2V0JywgdmFsICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgbVNvdXJjZS5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQl7CgkJCQkvKiBMaWtlIHRoZSBnZXQsIHdlIG5lZWQgdG8gZ2V0IGRhdGEgZnJvbSBhIG5lc3RlZCBvYmplY3QuICAqLwoJCQkJdmFyIGEgPSBtU291cmNlLnNwbGl0KCcuJyk7CgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGgtMSA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQlkYXRhID0gZGF0YVsgYVtpXSBdOwoJCQkJCX0KCQkJCQlkYXRhWyBhW2EubGVuZ3RoLTFdIF0gPSB2YWw7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQlkYXRhW21Tb3VyY2VdID0gdmFsOwkKCQkJCX07CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGFuIGFycmF5IHdpdGggdGhlIGZ1bGwgdGFibGUgZGF0YQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIGFycmF5IHthcnJheX0gYURhdGEgTWFzdGVyIGRhdGEgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0RGF0YU1hc3RlciAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYURhdGEgPSBbXTsKCQkJdmFyIGlMZW4gPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbjsgaSsrICkKCQkJewoJCQkJYURhdGEucHVzaCggb1NldHRpbmdzLmFvRGF0YVtpXS5fYURhdGEgKTsKCQkJfQoJCQlyZXR1cm4gYURhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIE51a2UgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2xlYXJUYWJsZSggb1NldHRpbmdzICkKCQl7CgkJCW9TZXR0aW5ncy5hb0RhdGEuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCApOwoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNwbGljZSggMCwgb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggKTsKCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIDAsIG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoICk7CgkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJfQoJCQoJCQoJCSAvKioKCQkgKiBUYWtlIGFuIGFycmF5IG9mIGludGVnZXJzIChpbmRleCBhcnJheSkgYW5kIHJlbW92ZSBhIHRhcmdldCBpbnRlZ2VyICh2YWx1ZSAtIG5vdCAKCQkgKiB0aGUga2V5ISkKCQkgKiAgQHBhcmFtIHthcnJheX0gYSBJbmRleCBhcnJheSB0byB0YXJnZXQKCQkgKiAgQHBhcmFtIHtpbnR9IGlUYXJnZXQgdmFsdWUgdG8gZmluZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EZWxldGVJbmRleCggYSwgaVRhcmdldCApCgkJewoJCQl2YXIgaVRhcmdldEluZGV4ID0gLTE7CgkJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBhW2ldID09IGlUYXJnZXQgKQoJCQkJewoJCQkJCWlUYXJnZXRJbmRleCA9IGk7CgkJCQl9CgkJCQllbHNlIGlmICggYVtpXSA+IGlUYXJnZXQgKQoJCQkJewoJCQkJCWFbaV0tLTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBpVGFyZ2V0SW5kZXggIT0gLTEgKQoJCQl7CgkJCQlhLnNwbGljZSggaVRhcmdldEluZGV4LCAxICk7CgkJCX0KCQl9CgkJCgkJCgkJIC8qKgoJCSAqIENhbGwgdGhlIGRldmVsb3BlciBkZWZpbmVkIGZuUmVuZGVyIGZ1bmN0aW9uIGZvciBhIGdpdmVuIGNlbGwgKHJvdy9jb2x1bW4pIHdpdGgKCQkgKiB0aGUgcmVxdWlyZWQgcGFyYW1ldGVycyBhbmQgcmV0dXJuIHRoZSByZXN1bHQuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIGluZGV4IGZvciB0aGUgcm93CgkJICogIEBwYXJhbSB7aW50fSBpQ29sIGFvQ29sdW1ucyBpbmRleCBmb3IgdGhlIGNvbHVtbgoJCSAqICBAcmV0dXJucyB7Kn0gUmV0dXJuIG9mIHRoZSBkZXZlbG9wZXIncyBmblJlbmRlciBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbCApCgkJewoJCQl2YXIgb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbF07CgkJCgkJCXJldHVybiBvQ29sLmZuUmVuZGVyKCB7CgkJCQkiaURhdGFSb3ciOiAgICBpUm93LAoJCQkJImlEYXRhQ29sdW1uIjogaUNvbCwKCQkJCSJvU2V0dGluZ3MiOiAgIG9TZXR0aW5ncywKCQkJCSJhRGF0YSI6ICAgICAgIG9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhLAoJCQkJIm1EYXRhUHJvcCI6ICAgb0NvbC5tRGF0YVByb3AKCQkJfSwgX2ZuR2V0Q2VsbERhdGEob1NldHRpbmdzLCBpUm93LCBpQ29sLCAnZGlzcGxheScpICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIG5ldyBUUiBlbGVtZW50IChhbmQgaXQncyBURCBjaGlsZHJlbikgZm9yIGEgcm93CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgUm93IHRvIGNvbnNpZGVyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNyZWF0ZVRyICggb1NldHRpbmdzLCBpUm93ICkKCQl7CgkJCXZhciBvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCXZhciBuVGQ7CgkJCgkJCWlmICggb0RhdGEublRyID09PSBudWxsICkKCQkJewoJCQkJb0RhdGEublRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKCQkKCQkJCS8qIFVzZSBhIHByaXZhdGUgcHJvcGVydHkgb24gdGhlIG5vZGUgdG8gYWxsb3cgcmVzZXJ2ZSBtYXBwaW5nIGZyb20gdGhlIG5vZGUKCQkJCSAqIHRvIHRoZSBhb0RhdGEgYXJyYXkgZm9yIGZhc3QgbG9vayB1cAoJCQkJICovCgkJCQlvRGF0YS5uVHIuX0RUX1Jvd0luZGV4ID0gaVJvdzsKCQkKCQkJCS8qIFNwZWNpYWwgcGFyYW1ldGVycyBjYW4gYmUgZ2l2ZW4gYnkgdGhlIGRhdGEgc291cmNlIHRvIGJlIHVzZWQgb24gdGhlIHJvdyAqLwoJCQkJaWYgKCBvRGF0YS5fYURhdGEuRFRfUm93SWQgKQoJCQkJewoJCQkJCW9EYXRhLm5Uci5pZCA9IG9EYXRhLl9hRGF0YS5EVF9Sb3dJZDsKCQkJCX0KCQkKCQkJCWlmICggb0RhdGEuX2FEYXRhLkRUX1Jvd0NsYXNzICkKCQkJCXsKCQkJCQkkKG9EYXRhLm5UcikuYWRkQ2xhc3MoIG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzcyApOwoJCQkJfQoJCQoJCQkJLyogUHJvY2VzcyBlYWNoIGNvbHVtbiAqLwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldOwoJCQkJCW5UZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CgkJCgkJCQkJLyogUmVuZGVyIGlmIG5lZWRlZCAtIGlmIGJVc2VSZW5kZXJlZCBpcyB0cnVlIHRoZW4gd2UgYWxyZWFkeSBoYXZlIHRoZSByZW5kZXJlZAoJCQkJCSAqIHZhbHVlIGluIHRoZSBkYXRhIHNvdXJjZSAtIHNvIGNhbiBqdXN0IHVzZSB0aGF0CgkJCQkJICovCgkJCQkJblRkLmlubmVySFRNTCA9ICh0eXBlb2Ygb0NvbC5mblJlbmRlciA9PT0gJ2Z1bmN0aW9uJyAmJiAoIW9Db2wuYlVzZVJlbmRlcmVkIHx8IG9Db2wubURhdGFQcm9wID09PSBudWxsKSkgPwoJCQkJCQlfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaSApIDoKCQkJCQkJX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCQkvKiBBZGQgdXNlciBkZWZpbmVkIGNsYXNzICovCgkJCQkJaWYgKCBvQ29sLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQuY2xhc3NOYW1lID0gb0NvbC5zQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggb0NvbC5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlvRGF0YS5uVHIuYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBudWxsOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvRGF0YS5fYW5IaWRkZW5baV0gPSBuVGQ7CgkJCQkJfQoJCQoJCQkJCWlmICggb0NvbC5mbkNyZWF0ZWRDZWxsICkKCQkJCQl7CgkJCQkJCW9Db2wuZm5DcmVhdGVkQ2VsbC5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLAoJCQkJCQkJblRkLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCAnZGlzcGxheScgKSwgb0RhdGEuX2FEYXRhLCBpUm93LCBpCgkJCQkJCSk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG51bGwsIFtvRGF0YS5uVHIsIG9EYXRhLl9hRGF0YSwgaVJvd10gKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgdGhlIEhUTUwgaGVhZGVyIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZEhlYWQoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaSwgblRoLCBpTGVuLCBqLCBqTGVuOwoJCQl2YXIgaVRocyA9IG9TZXR0aW5ncy5uVEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJykubGVuZ3RoOwoJCQl2YXIgaUNvcnJlY3RvciA9IDA7CgkJCXZhciBqcUNoaWxkcmVuOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYSBoZWFkZXIgaW4gcGxhY2UgLSB0aGVuIHVzZSBpdCAtIG90aGVyd2lzZSBpdCdzIGdvaW5nIHRvIGdldCBudWtlZC4uLiAqLwoJCQlpZiAoIGlUaHMgIT09IDAgKQoJCQl7CgkJCQkvKiBXZSd2ZSBnb3QgYSB0aGVhZCBmcm9tIHRoZSBET00sIHNvIHJlbW92ZSBoaWRkZW4gY29sdW1ucyBhbmQgYXBwbHkgd2lkdGggdG8gdmlzIGNvbHMgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJblRoID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGg7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgncm9sZScsICdjb2x1bW5oZWFkZXInKTsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4Jywgb1NldHRpbmdzLmlUYWJJbmRleCk7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBvU2V0dGluZ3Muc1RhYmxlSWQpOwoJCQkJCX0KCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCSQoblRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogU2V0IHRoZSB0aXRsZSBvZiB0aGUgY29sdW1uIGlmIGl0IGlzIHVzZXIgZGVmaW5lZCAobm90IHdoYXQgd2FzIGF1dG8gZGV0ZWN0ZWQpICovCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZSAhPSBuVGguaW5uZXJIVE1MICkKCQkJCQl7CgkJCQkJCW5UaC5pbm5lckhUTUwgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBXZSBkb24ndCBoYXZlIGEgaGVhZGVyIGluIHRoZSBET00gLSBzbyB3ZSBhcmUgZ29pbmcgdG8gaGF2ZSB0byBjcmVhdGUgb25lICovCgkJCQl2YXIgblRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInRyIiApOwoJCQkJCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5UaCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoOwoJCQkJCW5UaC5pbm5lckhUTUwgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNUaXRsZTsKCQkJCQluVGguc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQkkKG5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICk7CgkJCQkJfQoJCQkJCQoJCQkJCW5Uci5hcHBlbmRDaGlsZCggblRoICk7CgkJCQl9CgkJCQkkKG9TZXR0aW5ncy5uVEhlYWQpLmh0bWwoICcnIClbMF0uYXBwZW5kQ2hpbGQoIG5UciApOwoJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBvU2V0dGluZ3MuYW9IZWFkZXIsIG9TZXR0aW5ncy5uVEhlYWQgKTsKCQkJfQoJCQkKCQkJLyogQVJJQSByb2xlIGZvciB0aGUgcm93cyAqLwkKCQkJJChvU2V0dGluZ3MublRIZWFkKS5jaGlsZHJlbigndHInKS5hdHRyKCdyb2xlJywgJ3JvdycpOwoJCQkKCQkJLyogQWRkIHRoZSBleHRyYSBtYXJrdXAgbmVlZGVkIGJ5IGpRdWVyeSBVSSdzIHRoZW1lcyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluVGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaDsKCQkJCQkKCQkJCQl2YXIgbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkJCW5EaXYuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJV3JhcHBlcjsKCQkJCQkkKG5UaCkuY29udGVudHMoKS5hcHBlbmRUbyhuRGl2KTsKCQkJCQkKCQkJCQl2YXIgblNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CgkJCQkJblNwYW4uY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SWNvbjsKCQkJCQluRGl2LmFwcGVuZENoaWxkKCBuU3BhbiApOwoJCQkJCW5UaC5hcHBlbmRDaGlsZCggbkRpdiApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICE9PSBmYWxzZSApCgkJCQkJewoJCQkJCQlfZm5Tb3J0QXR0YWNoTGlzdGVuZXIoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgsIGkgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBEZWFsIHdpdGggdGhlIGZvb3RlciAtIGFkZCBjbGFzc2VzIGlmIHJlcXVpcmVkICovCgkJCWlmICggb1NldHRpbmdzLm9DbGFzc2VzLnNGb290ZXJUSCAhPT0gIiIgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVEZvb3QpLmNoaWxkcmVuKCd0cicpLmNoaWxkcmVuKCd0aCcpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc0Zvb3RlclRIICk7CgkJCX0KCQkJCgkJCS8qIENhY2hlIHRoZSBmb290ZXIgZWxlbWVudHMgKi8KCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJdmFyIGFuQ2VsbHMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncywgbnVsbCwgb1NldHRpbmdzLmFvRm9vdGVyICk7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5DZWxsc1tpXSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UZiA9IGFuQ2VsbHNbaV07CgkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKQoJCQkJCQl7CgkJCQkJCQkkKGFuQ2VsbHNbaV0pLmFkZENsYXNzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIGhlYWRlciAob3IgZm9vdGVyKSBlbGVtZW50IGJhc2VkIG9uIHRoZSBjb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZXMuIFRoZQoJCSAqIG1ldGhvZG9sb2d5IGhlcmUgaXMgdG8gdXNlIHRoZSBsYXlvdXQgYXJyYXkgZnJvbSBfZm5EZXRlY3RIZWFkZXIsIG1vZGlmaWVkIGZvcgoJCSAqIHRoZSBpbnN0YW50YW5lb3VzIGNvbHVtbiB2aXNpYmlsaXR5LCB0byBjb25zdHJ1Y3QgdGhlIG5ldyBsYXlvdXQuIFRoZSBncmlkIGlzCgkJICogdHJhdmVyc2VkIG92ZXIgY2VsbCBhdCBhIHRpbWUgaW4gYSByb3dzIHggY29sdW1ucyBncmlkIGZhc2hpb24sIGFsdGhvdWdoIGVhY2ggCgkJICogY2VsbCBpbnNlcnQgY2FuIGNvdmVyIG11bHRpcGxlIGVsZW1lbnRzIGluIHRoZSBncmlkIC0gd2hpY2ggaXMgdHJhY2tzIHVzaW5nIHRoZQoJCSAqIGFBcHBsaWVkIGFycmF5LiBDZWxsIGluc2VydHMgaW4gdGhlIGdyaWQgd2lsbCBvbmx5IG9jY3VyIHdoZXJlIHRoZXJlIGlzbid0CgkJICogYWxyZWFkeSBhIGNlbGwgaW4gdGhhdCBwb3NpdGlvbi4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0gYXJyYXkge29iamVjdHN9IGFvU291cmNlIExheW91dCBhcnJheSBmcm9tIF9mbkRldGVjdEhlYWRlcgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiSW5jbHVkZUhpZGRlbj1mYWxzZV0gSWYgdHJ1ZSB0aGVuIGluY2x1ZGUgdGhlIGhpZGRlbiBjb2x1bW5zIGluIHRoZSBjYWxjLCAKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgYW9Tb3VyY2UsIGJJbmNsdWRlSGlkZGVuICkKCQl7CgkJCXZhciBpLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuLCBuLCBuTG9jYWxUcjsKCQkJdmFyIGFvTG9jYWwgPSBbXTsKCQkJdmFyIGFBcHBsaWVkID0gW107CgkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgaVJvd3NwYW4sIGlDb2xzcGFuOwoJCQoJCQlpZiAoICBiSW5jbHVkZUhpZGRlbiA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJYkluY2x1ZGVIaWRkZW4gPSBmYWxzZTsKCQkJfQoJCQoJCQkvKiBNYWtlIGEgY29weSBvZiB0aGUgbWFzdGVyIGxheW91dCBhcnJheSwgYnV0IHdpdGhvdXQgdGhlIHZpc2libGUgY29sdW1ucyBpbiBpdCAqLwoJCQlmb3IgKCBpPTAsIGlMZW49YW9Tb3VyY2UubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYW9Mb2NhbFtpXSA9IGFvU291cmNlW2ldLnNsaWNlKCk7CgkJCQlhb0xvY2FsW2ldLm5UciA9IGFvU291cmNlW2ldLm5UcjsKCQkKCQkJCS8qIFJlbW92ZSBhbnkgY29sdW1ucyB3aGljaCBhcmUgY3VycmVudGx5IGhpZGRlbiAqLwoJCQkJZm9yICggaj1pQ29sdW1ucy0xIDsgaj49MCA7IGotLSApCgkJCQl7CgkJCQkJaWYgKCAhb1NldHRpbmdzLmFvQ29sdW1uc1tqXS5iVmlzaWJsZSAmJiAhYkluY2x1ZGVIaWRkZW4gKQoJCQkJCXsKCQkJCQkJYW9Mb2NhbFtpXS5zcGxpY2UoIGosIDEgKTsKCQkJCQl9CgkJCQl9CgkJCgkJCQkvKiBQcmVwIHRoZSBhcHBsaWVkIGFycmF5IC0gaXQgbmVlZHMgYW4gZWxlbWVudCBmb3IgZWFjaCByb3cgKi8KCQkJCWFBcHBsaWVkLnB1c2goIFtdICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPWFvTG9jYWwubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJbkxvY2FsVHIgPSBhb0xvY2FsW2ldLm5UcjsKCQkJCQoJCQkJLyogQWxsIGNlbGxzIGFyZSBnb2luZyB0byBiZSByZXBsYWNlZCwgc28gZW1wdHkgb3V0IHRoZSByb3cgKi8KCQkJCWlmICggbkxvY2FsVHIgKQoJCQkJewoJCQkJCXdoaWxlKCAobiA9IG5Mb2NhbFRyLmZpcnN0Q2hpbGQpICkKCQkJCQl7CgkJCQkJCW5Mb2NhbFRyLnJlbW92ZUNoaWxkKCBuICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJZm9yICggaj0wLCBqTGVuPWFvTG9jYWxbaV0ubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpUm93c3BhbiA9IDE7CgkJCQkJaUNvbHNwYW4gPSAxOwoJCQoJCQkJCS8qIENoZWNrIHRvIHNlZSBpZiB0aGVyZSBpcyBhbHJlYWR5IGEgY2VsbCAocm93L2NvbHNwYW4pIGNvdmVyaW5nIG91ciB0YXJnZXQKCQkJCQkgKiBpbnNlcnQgcG9pbnQuIElmIHRoZXJlIGlzLCB0aGVuIHRoZXJlIGlzIG5vdGhpbmcgdG8gZG8uCgkJCQkJICovCgkJCQkJaWYgKCBhQXBwbGllZFtpXVtqXSA9PT0gdW5kZWZpbmVkICkKCQkJCQl7CgkJCQkJCW5Mb2NhbFRyLmFwcGVuZENoaWxkKCBhb0xvY2FsW2ldW2pdLmNlbGwgKTsKCQkJCQkJYUFwcGxpZWRbaV1bal0gPSAxOwoJCQoJCQkJCQkvKiBFeHBhbmQgdGhlIGNlbGwgdG8gY292ZXIgYXMgbWFueSByb3dzIGFzIG5lZWRlZCAqLwoJCQkJCQl3aGlsZSAoIGFvTG9jYWxbaStpUm93c3Bhbl0gIT09IHVuZGVmaW5lZCAmJgoJCQkJCQkgICAgICAgIGFvTG9jYWxbaV1bal0uY2VsbCA9PSBhb0xvY2FsW2kraVJvd3NwYW5dW2pdLmNlbGwgKQoJCQkJCQl7CgkJCQkJCQlhQXBwbGllZFtpK2lSb3dzcGFuXVtqXSA9IDE7CgkJCQkJCQlpUm93c3BhbisrOwoJCQkJCQl9CgkJCgkJCQkJCS8qIEV4cGFuZCB0aGUgY2VsbCB0byBjb3ZlciBhcyBtYW55IGNvbHVtbnMgYXMgbmVlZGVkICovCgkJCQkJCXdoaWxlICggYW9Mb2NhbFtpXVtqK2lDb2xzcGFuXSAhPT0gdW5kZWZpbmVkICYmCgkJCQkJCSAgICAgICAgYW9Mb2NhbFtpXVtqXS5jZWxsID09IGFvTG9jYWxbaV1baitpQ29sc3Bhbl0uY2VsbCApCgkJCQkJCXsKCQkJCQkJCS8qIE11c3QgdXBkYXRlIHRoZSBhcHBsaWVkIGFycmF5IG92ZXIgdGhlIHJvd3MgZm9yIHRoZSBjb2x1bW5zICovCgkJCQkJCQlmb3IgKCBrPTAgOyBrPGlSb3dzcGFuIDsgaysrICkKCQkJCQkJCXsKCQkJCQkJCQlhQXBwbGllZFtpK2tdW2oraUNvbHNwYW5dID0gMTsKCQkJCQkJCX0KCQkJCQkJCWlDb2xzcGFuKys7CgkJCQkJCX0KCQkKCQkJCQkJLyogRG8gdGhlIGFjdHVhbCBleHBhbnNpb24gaW4gdGhlIERPTSAqLwoJCQkJCQlhb0xvY2FsW2ldW2pdLmNlbGwucm93U3BhbiA9IGlSb3dzcGFuOwoJCQkJCQlhb0xvY2FsW2ldW2pdLmNlbGwuY29sU3BhbiA9IGlDb2xzcGFuOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBJbnNlcnQgdGhlIHJlcXVpcmVkIFRSIG5vZGVzIGludG8gdGhlIHRhYmxlIGZvciBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRHJhdyggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpLCBpTGVuLCBuOwoJCQl2YXIgYW5Sb3dzID0gW107CgkJCXZhciBpUm93Q291bnQgPSAwOwoJCQl2YXIgaVN0cmlwZXMgPSBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmxlbmd0aDsKCQkJdmFyIGlPcGVuUm93cyA9IG9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aDsKCQkJCgkJCS8qIFByb3ZpZGUgYSBwcmUtY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZSBkcmF3IGlzIGZhbHNlIGlzIHJldHVybmVkICovCgkJCXZhciBhUHJlRHJhdyA9IF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAncHJlRHJhdycsIFtvU2V0dGluZ3NdICk7CgkJCWlmICggJC5pbkFycmF5KCBmYWxzZSwgYVByZURyYXcgKSAhPT0gLTEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCW9TZXR0aW5ncy5iRHJhd2luZyA9IHRydWU7CgkJCQoJCQkvKiBDaGVjayBhbmQgc2VlIGlmIHdlIGhhdmUgYW4gaW5pdGlhbCBkcmF3IHBvc2l0aW9uIGZyb20gc3RhdGUgc2F2aW5nICovCgkJCWlmICggb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ICE9PSB1bmRlZmluZWQgJiYgb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ICE9IC0xICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQ7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gKG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA+PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpKSA/CgkJCQkJCTAgOiBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQ7CgkJCQl9CgkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSAtMTsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgZHJhdyBpbnRlcmNlcHQgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyApCgkJCXsKCQkJCW9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nID0gZmFsc2U7CgkJCQlvU2V0dGluZ3MuaURyYXcrKzsKCQkJfQoJCQllbHNlIGlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQlvU2V0dGluZ3MuaURyYXcrKzsKCQkJfQoJCQllbHNlIGlmICggIW9TZXR0aW5ncy5iRGVzdHJveWluZyAmJiAhX2ZuQWpheFVwZGF0ZSggb1NldHRpbmdzICkgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCWlmICggb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQl2YXIgaVN0YXJ0ID0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0OwoJCQkJdmFyIGlFbmQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5RW5kOwoJCQkJCgkJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJewoJCQkJCWlTdGFydCA9IDA7CgkJCQkJaUVuZCA9IG9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoOwoJCQkJfQoJCQkJCgkJCQlmb3IgKCB2YXIgaj1pU3RhcnQgOyBqPGlFbmQgOyBqKysgKQoJCQkJewoJCQkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhWyBvU2V0dGluZ3MuYWlEaXNwbGF5W2pdIF07CgkJCQkJaWYgKCBhb0RhdGEublRyID09PSBudWxsICkKCQkJCQl7CgkJCQkJCV9mbkNyZWF0ZVRyKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5haURpc3BsYXlbal0gKTsKCQkJCQl9CgkJCgkJCQkJdmFyIG5Sb3cgPSBhb0RhdGEublRyOwoJCQkJCQoJCQkJCS8qIFJlbW92ZSB0aGUgb2xkIHN0cmlwaW5nIGNsYXNzZXMgYW5kIHRoZW4gYWRkIHRoZSBuZXcgb25lICovCgkJCQkJaWYgKCBpU3RyaXBlcyAhPT0gMCApCgkJCQkJewoJCQkJCQl2YXIgc1N0cmlwZSA9IG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbIGlSb3dDb3VudCAlIGlTdHJpcGVzIF07CgkJCQkJCWlmICggYW9EYXRhLl9zUm93U3RyaXBlICE9IHNTdHJpcGUgKQoJCQkJCQl7CgkJCQkJCQkkKG5Sb3cpLnJlbW92ZUNsYXNzKCBhb0RhdGEuX3NSb3dTdHJpcGUgKS5hZGRDbGFzcyggc1N0cmlwZSApOwoJCQkJCQkJYW9EYXRhLl9zUm93U3RyaXBlID0gc1N0cmlwZTsKCQkJCQkJfQoJCQkJCX0KCQkJCQkKCQkJCQkvKiBSb3cgY2FsbGJhY2sgZnVuY3Rpb25zIC0gbWlnaHQgd2FudCB0byBtYW5pcHVsZSB0aGUgcm93ICovCgkJCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1Jvd0NhbGxiYWNrJywgbnVsbCwgCgkJCQkJCVtuUm93LCBvU2V0dGluZ3MuYW9EYXRhWyBvU2V0dGluZ3MuYWlEaXNwbGF5W2pdIF0uX2FEYXRhLCBpUm93Q291bnQsIGpdICk7CgkJCQkJCgkJCQkJYW5Sb3dzLnB1c2goIG5Sb3cgKTsKCQkJCQlpUm93Q291bnQrKzsKCQkJCQkKCQkJCQkvKiBJZiB0aGVyZSBpcyBhbiBvcGVuIHJvdyAtIGFuZCBpdCBpcyBhdHRhY2hlZCB0byB0aGlzIHBhcmVudCAtIGF0dGFjaCBpdCBvbiByZWRyYXcgKi8KCQkJCQlpZiAoIGlPcGVuUm93cyAhPT0gMCApCgkJCQkJewoJCQkJCQlmb3IgKCB2YXIgaz0wIDsgazxpT3BlblJvd3MgOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG5Sb3cgPT0gb1NldHRpbmdzLmFvT3BlblJvd3Nba10ublBhcmVudCApCgkJCQkJCQl7CgkJCQkJCQkJYW5Sb3dzLnB1c2goIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2tdLm5UciApOwoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogVGFibGUgaXMgZW1wdHkgLSBjcmVhdGUgYSByb3cgd2l0aCBhbiBlbXB0eSBtZXNzYWdlIGluIGl0ICovCgkJCQlhblJvd3NbIDAgXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0cicgKTsKCQkJCQoJCQkJaWYgKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWzBdICkKCQkJCXsKCQkJCQlhblJvd3NbIDAgXS5jbGFzc05hbWUgPSBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzWzBdOwoJCQkJfQoJCQoJCQkJdmFyIHNaZXJvID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zWmVyb1JlY29yZHMucmVwbGFjZSgKCQkJCQknX01BWF8nLCBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIob1NldHRpbmdzLmZuUmVjb3Jkc1RvdGFsKCkpICk7CgkJCQlpZiAoIG9TZXR0aW5ncy5pRHJhdyA9PSAxICYmIG9TZXR0aW5ncy5zQWpheFNvdXJjZSAhPT0gbnVsbCAmJiAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJc1plcm8gPSBvU2V0dGluZ3Mub0xhbmd1YWdlLnNMb2FkaW5nUmVjb3JkczsKCQkJCX0KCQkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0xhbmd1YWdlLnNFbXB0eVRhYmxlICYmIG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpID09PSAwICkKCQkJCXsKCQkJCQlzWmVybyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0VtcHR5VGFibGU7CgkJCQl9CgkJCgkJCQl2YXIgblRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RkJyApOwoJCQkJblRkLnNldEF0dHJpYnV0ZSggJ3ZhbGlnbicsICJ0b3AiICk7CgkJCQluVGQuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQkJblRkLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUm93RW1wdHk7CgkJCQluVGQuaW5uZXJIVE1MID0gc1plcm87CgkJCQkKCQkJCWFuUm93c1sgaVJvd0NvdW50IF0uYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQl9CgkJCQoJCQkvKiBIZWFkZXIgYW5kIGZvb3RlciBjYWxsYmFja3MgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0hlYWRlckNhbGxiYWNrJywgJ2hlYWRlcicsIFsgJChvU2V0dGluZ3MublRIZWFkKS5jaGlsZHJlbigndHInKVswXSwgCgkJCQlfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKSwgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksIG9TZXR0aW5ncy5haURpc3BsYXkgXSApOwoJCQkKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0Zvb3RlckNhbGxiYWNrJywgJ2Zvb3RlcicsIFsgJChvU2V0dGluZ3MublRGb290KS5jaGlsZHJlbigndHInKVswXSwgCgkJCQlfZm5HZXREYXRhTWFzdGVyKCBvU2V0dGluZ3MgKSwgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCksIG9TZXR0aW5ncy5haURpc3BsYXkgXSApOwoJCQkKCQkJLyogCgkJCSAqIE5lZWQgdG8gcmVtb3ZlIGFueSBvbGQgcm93IGZyb20gdGhlIGRpc3BsYXkgLSBub3RlIHdlIGNhbid0IGp1c3QgZW1wdHkgdGhlIHRib2R5IHVzaW5nCgkJCSAqICQoKS5odG1sKCcnKSBzaW5jZSB0aGlzIHdpbGwgdW5iaW5kIHRoZSBqUXVlcnkgZXZlbnQgaGFuZGxlcnMgKGV2ZW4gYWx0aG91Z2ggdGhlIG5vZGUgCgkJCSAqIHN0aWxsIGV4aXN0cyEpIC0gZXF1YWxseSB3ZSBjYW4ndCB1c2UgaW5uZXJIVE1MLCBzaW5jZSBJRSB0aHJvd3MgYW4gZXhjZXB0aW9uLgoJCQkgKi8KCQkJdmFyCgkJCQluQWRkRnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKCQkJCW5SZW1vdmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAoJCQkJbkJvZHlQYXIsIG5UcnM7CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5uVEJvZHkgKQoJCQl7CgkJCQluQm9keVBhciA9IG9TZXR0aW5ncy5uVEJvZHkucGFyZW50Tm9kZTsKCQkJCW5SZW1vdmVGcmFnLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRCb2R5ICk7CgkJCQkKCQkJCS8qIFdoZW4gZG9pbmcgaW5maW5pdGUgc2Nyb2xsaW5nLCBvbmx5IHJlbW92ZSBjaGlsZCByb3dzIHdoZW4gc29ydGluZywgZmlsdGVyaW5nIG9yIHN0YXJ0CgkJCQkgKiB1cC4gV2hlbiBub3QgaW5maW5pdGUgc2Nyb2xsLCBhbHdheXMgZG8gaXQuCgkJCQkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSB8fCAhb1NldHRpbmdzLl9iSW5pdENvbXBsZXRlIHx8CgkJCQkgCW9TZXR0aW5ncy5iU29ydGVkIHx8IG9TZXR0aW5ncy5iRmlsdGVyZWQgKQoJCQkJewoJCQkJCXdoaWxlKCAobiA9IG9TZXR0aW5ncy5uVEJvZHkuZmlyc3RDaGlsZCkgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLm5UQm9keS5yZW1vdmVDaGlsZCggbiApOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogUHV0IHRoZSBkcmF3IHRhYmxlIGludG8gdGhlIGRvbSAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuUm93cy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5BZGRGcmFnLmFwcGVuZENoaWxkKCBhblJvd3NbaV0gKTsKCQkJCX0KCQkJCQoJCQkJb1NldHRpbmdzLm5UQm9keS5hcHBlbmRDaGlsZCggbkFkZEZyYWcgKTsKCQkJCWlmICggbkJvZHlQYXIgIT09IG51bGwgKQoJCQkJewoJCQkJCW5Cb2R5UGFyLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRCb2R5ICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIENhbGwgYWxsIHJlcXVpcmVkIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgdGhlIGVuZCBvZiBhIGRyYXcgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICdkcmF3JywgW29TZXR0aW5nc10gKTsKCQkJCgkJCS8qIERyYXcgaXMgY29tcGxldGUsIHNvcnRpbmcgYW5kIGZpbHRlcmluZyBtdXN0IGJlIGFzIHdlbGwgKi8KCQkJb1NldHRpbmdzLmJTb3J0ZWQgPSBmYWxzZTsKCQkJb1NldHRpbmdzLmJGaWx0ZXJlZCA9IGZhbHNlOwoJCQlvU2V0dGluZ3MuYkRyYXdpbmcgPSBmYWxzZTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlpZiAoICFvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgKQoJCQkJewoJCQkJCV9mbkluaXRDb21wbGV0ZSggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogUmVkcmF3IHRoZSB0YWJsZSAtIHRha2luZyBhY2NvdW50IG9mIHRoZSB2YXJpb3VzIGZlYXR1cmVzIHdoaWNoIGFyZSBlbmFibGVkCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJLyogU29ydGluZyB3aWxsIHJlZmlsdGVyIGFuZCBkcmF3IGZvciB1cyAqLwoJCQkJX2ZuU29ydCggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCXsKCQkJCS8qIEZpbHRlcmluZyB3aWxsIHJlZHJhdyBmb3IgdXMgKi8KCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2ggKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGQgdGhlIG9wdGlvbnMgdG8gdGhlIHBhZ2UgSFRNTCBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWRkT3B0aW9uc0h0bWwgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyoKCQkJICogQ3JlYXRlIGEgdGVtcG9yYXJ5LCBlbXB0eSwgZGl2IHdoaWNoIHdlIGNhbiBsYXRlciBvbiByZXBsYWNlIHdpdGggd2hhdCB3ZSBoYXZlIGdlbmVyYXRlZAoJCQkgKiB3ZSBkbyBpdCB0aGlzIHdheSB0byByZW5kZXJpbmcgdGhlICdvcHRpb25zJyBodG1sIG9mZmxpbmUgLSBzcGVlZCA6LSkKCQkJICovCgkJCXZhciBuSG9sZGluZyA9ICQoJzxkaXY+PC9kaXY+JylbMF07CgkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIG5Ib2xkaW5nLCBvU2V0dGluZ3MublRhYmxlICk7CgkJCQoJCQkvKiAKCQkJICogQWxsIERhdGFUYWJsZXMgYXJlIHdyYXBwZWQgaW4gYSBkaXYKCQkJICovCgkJCW9TZXR0aW5ncy5uVGFibGVXcmFwcGVyID0gJCgnPGRpdiBpZD0iJytvU2V0dGluZ3Muc1RhYmxlSWQrJ193cmFwcGVyIiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1dyYXBwZXIrJyIgcm9sZT0iZ3JpZCI+PC9kaXY+JylbMF07CgkJCW9TZXR0aW5ncy5uVGFibGVSZWluc2VydEJlZm9yZSA9IG9TZXR0aW5ncy5uVGFibGUubmV4dFNpYmxpbmc7CgkJCgkJCS8qIFRyYWNrIHdoZXJlIHdlIHdhbnQgdG8gaW5zZXJ0IHRoZSBvcHRpb24gKi8KCQkJdmFyIG5JbnNlcnROb2RlID0gb1NldHRpbmdzLm5UYWJsZVdyYXBwZXI7CgkJCQoJCQkvKiBMb29wIG92ZXIgdGhlIHVzZXIgc2V0IHBvc2l0aW9uaW5nIGFuZCBwbGFjZSB0aGUgZWxlbWVudHMgYXMgbmVlZGVkICovCgkJCXZhciBhRG9tID0gb1NldHRpbmdzLnNEb20uc3BsaXQoJycpOwoJCQl2YXIgblRtcCwgaVB1c2hGZWF0dXJlLCBjT3B0aW9uLCBuTmV3Tm9kZSwgY05leHQsIHNBdHRyLCBqOwoJCQlmb3IgKCB2YXIgaT0wIDsgaTxhRG9tLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlQdXNoRmVhdHVyZSA9IDA7CgkJCQljT3B0aW9uID0gYURvbVtpXTsKCQkJCQoJCQkJaWYgKCBjT3B0aW9uID09ICc8JyApCgkJCQl7CgkJCQkJLyogTmV3IGNvbnRhaW5lciBkaXYgKi8KCQkJCQluTmV3Tm9kZSA9ICQoJzxkaXY+PC9kaXY+JylbMF07CgkJCQkJCgkJCQkJLyogQ2hlY2sgdG8gc2VlIGlmIHdlIHNob3VsZCBhcHBlbmQgYW4gaWQgYW5kL29yIGEgY2xhc3MgbmFtZSB0byB0aGUgY29udGFpbmVyICovCgkJCQkJY05leHQgPSBhRG9tW2krMV07CgkJCQkJaWYgKCBjTmV4dCA9PSAiJyIgfHwgY05leHQgPT0gJyInICkKCQkJCQl7CgkJCQkJCXNBdHRyID0gIiI7CgkJCQkJCWogPSAyOwoJCQkJCQl3aGlsZSAoIGFEb21baStqXSAhPSBjTmV4dCApCgkJCQkJCXsKCQkJCQkJCXNBdHRyICs9IGFEb21baStqXTsKCQkJCQkJCWorKzsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogUmVwbGFjZSBqUXVlcnkgVUkgY29uc3RhbnRzICovCgkJCQkJCWlmICggc0F0dHIgPT0gIkgiICkKCQkJCQkJewoJCQkJCQkJc0F0dHIgPSAiZmctdG9vbGJhciB1aS10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLXRsIHVpLWNvcm5lci10ciB1aS1oZWxwZXItY2xlYXJmaXgiOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBzQXR0ciA9PSAiRiIgKQoJCQkJCQl7CgkJCQkJCQlzQXR0ciA9ICJmZy10b29sYmFyIHVpLXRvb2xiYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYmwgdWktY29ybmVyLWJyIHVpLWhlbHBlci1jbGVhcmZpeCI7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIFRoZSBhdHRyaWJ1dGUgY2FuIGJlIGluIHRoZSBmb3JtYXQgb2YgIiNpZC5jbGFzcyIsICIjaWQiIG9yICJjbGFzcyIgVGhpcyBsb2dpYwoJCQkJCQkgKiBicmVha3MgdGhlIHN0cmluZyBpbnRvIHBhcnRzIGFuZCBhcHBsaWVzIHRoZW0gYXMgbmVlZGVkCgkJCQkJCSAqLwoJCQkJCQlpZiAoIHNBdHRyLmluZGV4T2YoJy4nKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCXZhciBhU3BsaXQgPSBzQXR0ci5zcGxpdCgnLicpOwoJCQkJCQkJbk5ld05vZGUuaWQgPSBhU3BsaXRbMF0uc3Vic3RyKDEsIGFTcGxpdFswXS5sZW5ndGgtMSk7CgkJCQkJCQluTmV3Tm9kZS5jbGFzc05hbWUgPSBhU3BsaXRbMV07CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIHNBdHRyLmNoYXJBdCgwKSA9PSAiIyIgKQoJCQkJCQl7CgkJCQkJCQluTmV3Tm9kZS5pZCA9IHNBdHRyLnN1YnN0cigxLCBzQXR0ci5sZW5ndGgtMSk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQluTmV3Tm9kZS5jbGFzc05hbWUgPSBzQXR0cjsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJaSArPSBqOyAvKiBNb3ZlIGFsb25nIHRoZSBwb3NpdGlvbiBhcnJheSAqLwoJCQkJCX0KCQkJCQkKCQkJCQluSW5zZXJ0Tm9kZS5hcHBlbmRDaGlsZCggbk5ld05vZGUgKTsKCQkJCQluSW5zZXJ0Tm9kZSA9IG5OZXdOb2RlOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJz4nICkKCQkJCXsKCQkJCQkvKiBFbmQgY29udGFpbmVyIGRpdiAqLwoJCQkJCW5JbnNlcnROb2RlID0gbkluc2VydE5vZGUucGFyZW50Tm9kZTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdsJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJMZW5ndGhDaGFuZ2UgKQoJCQkJewoJCQkJCS8qIExlbmd0aCAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbExlbmd0aCggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdmJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQkJewoJCQkJCS8qIEZpbHRlciAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbEZpbHRlciggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICdyJyAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQcm9jZXNzaW5nICkKCQkJCXsKCQkJCQkvKiBwUm9jZXNzaW5nICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICd0JyApCgkJCQl7CgkJCQkJLyogVGFibGUgKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxUYWJsZSggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICAnaScgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iSW5mbyApCgkJCQl7CgkJCQkJLyogSW5mbyAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbEluZm8oIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAncCcgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgKQoJCQkJewoJCQkJCS8qIFBhZ2luYXRpb24gKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSggb1NldHRpbmdzICk7CgkJCQkJaVB1c2hGZWF0dXJlID0gMTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBEYXRhVGFibGUuZXh0LmFvRmVhdHVyZXMubGVuZ3RoICE9PSAwICkKCQkJCXsKCQkJCQkvKiBQbHVnLWluIGZlYXR1cmVzICovCgkJCQkJdmFyIGFvRmVhdHVyZXMgPSBEYXRhVGFibGUuZXh0LmFvRmVhdHVyZXM7CgkJCQkJZm9yICggdmFyIGs9MCwga0xlbj1hb0ZlYXR1cmVzLmxlbmd0aCA7IGs8a0xlbiA7IGsrKyApCgkJCQkJewoJCQkJCQlpZiAoIGNPcHRpb24gPT0gYW9GZWF0dXJlc1trXS5jRmVhdHVyZSApCgkJCQkJCXsKCQkJCQkJCW5UbXAgPSBhb0ZlYXR1cmVzW2tdLmZuSW5pdCggb1NldHRpbmdzICk7CgkJCQkJCQlpZiAoIG5UbXAgKQoJCQkJCQkJewoJCQkJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQWRkIHRvIHRoZSAyRCBmZWF0dXJlcyBhcnJheSAqLwoJCQkJaWYgKCBpUHVzaEZlYXR1cmUgPT0gMSAmJiBuVG1wICE9PSBudWxsICkKCQkJCXsKCQkJCQlpZiAoIHR5cGVvZiBvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0gIT09ICdvYmplY3QnICkKCQkJCQl7CgkJCQkJCW9TZXR0aW5ncy5hYW5GZWF0dXJlc1tjT3B0aW9uXSA9IFtdOwoJCQkJCX0KCQkJCQlvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0ucHVzaCggblRtcCApOwoJCQkJCW5JbnNlcnROb2RlLmFwcGVuZENoaWxkKCBuVG1wICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEJ1aWx0IG91ciBET00gc3RydWN0dXJlIC0gcmVwbGFjZSB0aGUgaG9sZGluZyBkaXYgd2l0aCB3aGF0IHdlIHdhbnQgKi8KCQkJbkhvbGRpbmcucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoIG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyLCBuSG9sZGluZyApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVc2UgdGhlIERPTSBzb3VyY2UgdG8gY3JlYXRlIHVwIGFuIGFycmF5IG9mIGhlYWRlciBjZWxscy4gVGhlIGlkZWEgaGVyZSBpcyB0bwoJCSAqIGNyZWF0ZSBhIGxheW91dCBncmlkIChhcnJheSkgb2Ygcm93cyB4IGNvbHVtbnMsIHdoaWNoIGNvbnRhaW5zIGEgcmVmZXJlbmNlCgkJICogdG8gdGhlIGNlbGwgdGhhdCB0aGF0IHBvaW50IGluIHRoZSBncmlkIChyZWdhcmRsZXNzIG9mIGNvbC9yb3dzcGFuKSwgc3VjaCB0aGF0CgkJICogYW55IGNvbHVtbiAvIHJvdyBjb3VsZCBiZSByZW1vdmVkIGFuZCB0aGUgbmV3IGdyaWQgY29uc3RydWN0ZWQKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3R9IGFMYXlvdXQgQXJyYXkgdG8gc3RvcmUgdGhlIGNhbGN1bGF0ZWQgbGF5b3V0IGluCgkJICogIEBwYXJhbSB7bm9kZX0gblRoZWFkIFRoZSBoZWFkZXIvZm9vdGVyIGVsZW1lbnQgZm9yIHRoZSB0YWJsZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5EZXRlY3RIZWFkZXIgKCBhTGF5b3V0LCBuVGhlYWQgKQoJCXsKCQkJdmFyIG5UcnMgPSAkKG5UaGVhZCkuY2hpbGRyZW4oJ3RyJyk7CgkJCXZhciBuQ2VsbDsKCQkJdmFyIGksIGosIGssIGwsIGlMZW4sIGpMZW4sIGlDb2xTaGlmdGVkOwoJCQl2YXIgZm5TaGlmdENvbCA9IGZ1bmN0aW9uICggYSwgaSwgaiApIHsKCQkJCXdoaWxlICggYVtpXVtqXSApIHsKCQkJCQlqKys7CgkJCQl9CgkJCQlyZXR1cm4gajsKCQkJfTsKCQkKCQkJYUxheW91dC5zcGxpY2UoIDAsIGFMYXlvdXQubGVuZ3RoICk7CgkJCQoJCQkvKiBXZSBrbm93IGhvdyBtYW55IHJvd3MgdGhlcmUgYXJlIGluIHRoZSBsYXlvdXQgLSBzbyBwcmVwIGl0ICovCgkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWFMYXlvdXQucHVzaCggW10gKTsKCQkJfQoJCQkKCQkJLyogQ2FsY3VsYXRlIGEgbGF5b3V0IGFycmF5ICovCgkJCWZvciAoIGk9MCwgaUxlbj1uVHJzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXZhciBpQ29sdW1uID0gMDsKCQkJCQoJCQkJLyogRm9yIGV2ZXJ5IGNlbGwgaW4gdGhlIHJvdy4uLiAqLwoJCQkJZm9yICggaj0wLCBqTGVuPW5UcnNbaV0uY2hpbGROb2Rlcy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCW5DZWxsID0gblRyc1tpXS5jaGlsZE5vZGVzW2pdOwoJCQoJCQkJCWlmICggbkNlbGwubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVEQiIHx8CgkJCQkJICAgICBuQ2VsbC5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09ICJUSCIgKQoJCQkJCXsKCQkJCQkJLyogR2V0IHRoZSBjb2wgYW5kIHJvd3NwYW4gYXR0cmlidXRlcyBmcm9tIHRoZSBET00gYW5kIHNhbml0aXNlIHRoZW0gKi8KCQkJCQkJdmFyIGlDb2xzcGFuID0gbkNlbGwuZ2V0QXR0cmlidXRlKCdjb2xzcGFuJykgKiAxOwoJCQkJCQl2YXIgaVJvd3NwYW4gPSBuQ2VsbC5nZXRBdHRyaWJ1dGUoJ3Jvd3NwYW4nKSAqIDE7CgkJCQkJCWlDb2xzcGFuID0gKCFpQ29sc3BhbiB8fCBpQ29sc3Bhbj09PTAgfHwgaUNvbHNwYW49PT0xKSA/IDEgOiBpQ29sc3BhbjsKCQkJCQkJaVJvd3NwYW4gPSAoIWlSb3dzcGFuIHx8IGlSb3dzcGFuPT09MCB8fCBpUm93c3Bhbj09PTEpID8gMSA6IGlSb3dzcGFuOwoJCQoJCQkJCQkvKiBUaGVyZSBtaWdodCBiZSBjb2xzcGFuIGNlbGxzIGFscmVhZHkgaW4gdGhpcyByb3csIHNvIHNoaWZ0IG91ciB0YXJnZXQgCgkJCQkJCSAqIGFjY29yZGluZ2x5CgkJCQkJCSAqLwoJCQkJCQlpQ29sU2hpZnRlZCA9IGZuU2hpZnRDb2woIGFMYXlvdXQsIGksIGlDb2x1bW4gKTsKCQkJCQkJCgkJCQkJCS8qIElmIHRoZXJlIGlzIGNvbCAvIHJvd3NwYW4sIGNvcHkgdGhlIGluZm9ybWF0aW9uIGludG8gdGhlIGxheW91dCBncmlkICovCgkJCQkJCWZvciAoIGw9MCA7IGw8aUNvbHNwYW4gOyBsKysgKQoJCQkJCQl7CgkJCQkJCQlmb3IgKCBrPTAgOyBrPGlSb3dzcGFuIDsgaysrICkKCQkJCQkJCXsKCQkJCQkJCQlhTGF5b3V0W2kra11baUNvbFNoaWZ0ZWQrbF0gPSB7CgkJCQkJCQkJCSJjZWxsIjogbkNlbGwsCgkJCQkJCQkJCSJ1bmlxdWUiOiBpQ29sc3BhbiA9PSAxID8gdHJ1ZSA6IGZhbHNlCgkJCQkJCQkJfTsKCQkJCQkJCQlhTGF5b3V0W2kra10ublRyID0gblRyc1tpXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgdW5pcXVlIHRoIGVsZW1lbnRzLCBvbmUgZm9yIGVhY2ggY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZGVyIGF1dG9tYXRpY2FsbHkgZGV0ZWN0IHRoZSBsYXlvdXQgZnJvbSB0aGlzIG5vZGUgLSBvcHRpb25hbAoJCSAqICBAcGFyYW0ge2FycmF5fSBhTGF5b3V0IHRoZWFkL3Rmb290IGxheW91dCBmcm9tIF9mbkRldGVjdEhlYWRlciAtIG9wdGlvbmFsCgkJICogIEByZXR1cm5zIGFycmF5IHtub2RlfSBhUmV0dXJuIGxpc3Qgb2YgdW5pcXVlIHRocwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRVbmlxdWVUaHMgKCBvU2V0dGluZ3MsIG5IZWFkZXIsIGFMYXlvdXQgKQoJCXsKCQkJdmFyIGFSZXR1cm4gPSBbXTsKCQkJaWYgKCAhYUxheW91dCApCgkJCXsKCQkJCWFMYXlvdXQgPSBvU2V0dGluZ3MuYW9IZWFkZXI7CgkJCQlpZiAoIG5IZWFkZXIgKQoJCQkJewoJCQkJCWFMYXlvdXQgPSBbXTsKCQkJCQlfZm5EZXRlY3RIZWFkZXIoIGFMYXlvdXQsIG5IZWFkZXIgKTsKCQkJCX0KCQkJfQoJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFMYXlvdXQubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1hTGF5b3V0W2ldLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaWYgKCBhTGF5b3V0W2ldW2pdLnVuaXF1ZSAmJiAKCQkJCQkJICghYVJldHVybltqXSB8fCAhb1NldHRpbmdzLmJTb3J0Q2VsbHNUb3ApICkKCQkJCQl7CgkJCQkJCWFSZXR1cm5bal0gPSBhTGF5b3V0W2ldW2pdLmNlbGw7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gYVJldHVybjsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIHRoZSB0YWJsZSB1c2luZyBhbiBBamF4IGNhbGwKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gQmxvY2sgdGhlIHRhYmxlIGRyYXdpbmcgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFqYXhVcGRhdGUoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5iQWpheERhdGFHZXQgKQoJCQl7CgkJCQlvU2V0dGluZ3MuaURyYXcrKzsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQkJdmFyIGFvRGF0YSA9IF9mbkFqYXhQYXJhbWV0ZXJzKCBvU2V0dGluZ3MgKTsKCQkJCV9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKTsKCQkJCQoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwKCQkJCQlmdW5jdGlvbihqc29uKSB7CgkJCQkJCV9mbkFqYXhVcGRhdGVEcmF3KCBvU2V0dGluZ3MsIGpzb24gKTsKCQkJCQl9LCBvU2V0dGluZ3MgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEJ1aWxkIHVwIHRoZSBwYXJhbWV0ZXJzIGluIGFuIG9iamVjdCBuZWVkZWQgZm9yIGEgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyByZXF1ZXN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2Jvb2x9IGJsb2NrIHRoZSB0YWJsZSBkcmF3aW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BamF4UGFyYW1ldGVycyggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgYW9EYXRhID0gW10sIG1EYXRhUHJvcDsKCQkJdmFyIGk7CgkJCQoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzRWNobyIsICAgICAgICAgICJ2YWx1ZSI6IG9TZXR0aW5ncy5pRHJhdyB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlDb2x1bW5zIiwgICAgICAgInZhbHVlIjogaUNvbHVtbnMgfSApOwoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzQ29sdW1ucyIsICAgICAgICJ2YWx1ZSI6IF9mbkNvbHVtbk9yZGVyaW5nKG9TZXR0aW5ncykgfSApOwoJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJpRGlzcGxheVN0YXJ0IiwgICJ2YWx1ZSI6IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlEaXNwbGF5TGVuZ3RoIiwgInZhbHVlIjogb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgIT09IGZhbHNlID8KCQkJCW9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggOiAtMSB9ICk7CgkJCQkKCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCXsKCQkJICBtRGF0YVByb3AgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm1EYXRhUHJvcDsKCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogIm1EYXRhUHJvcF8iK2ksICJ2YWx1ZSI6IHR5cGVvZihtRGF0YVByb3ApPT09ImZ1bmN0aW9uIiA/ICdmdW5jdGlvbicgOiBtRGF0YVByb3AgfSApOwoJCQl9CgkJCQoJCQkvKiBGaWx0ZXJpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgIT09IGZhbHNlICkKCQkJewoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NlYXJjaCIsICJ2YWx1ZSI6IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2guc1NlYXJjaCB9ICk7CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiUmVnZXgiLCAgInZhbHVlIjogb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaC5iUmVnZXggfSApOwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCQl7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NlYXJjaF8iK2ksICAgICAidmFsdWUiOiBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzW2ldLnNTZWFyY2ggfSApOwoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJSZWdleF8iK2ksICAgICAgInZhbHVlIjogb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1tpXS5iUmVnZXggfSApOwoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJTZWFyY2hhYmxlXyIraSwgInZhbHVlIjogb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU2VhcmNoYWJsZSB9ICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFNvcnRpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICE9PSBmYWxzZSApCgkJCXsKCQkJCXZhciBpRml4ZWQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwgPyBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQubGVuZ3RoIDogMDsKCQkJCXZhciBpVXNlciA9IG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoOwoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaVNvcnRpbmdDb2xzIiwgICAidmFsdWUiOiBpRml4ZWQraVVzZXIgfSApOwoJCQkJZm9yICggaT0wIDsgaTxpRml4ZWQgOyBpKysgKQoJCQkJewoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlTb3J0Q29sXyIraSwgICJ2YWx1ZSI6IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZFtpXVswXSB9ICk7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NvcnREaXJfIitpLCAgInZhbHVlIjogb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkW2ldWzFdIH0gKTsKCQkJCX0KCQkJCQoJCQkJZm9yICggaT0wIDsgaTxpVXNlciA7IGkrKyApCgkJCQl7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaVNvcnRDb2xfIisoaStpRml4ZWQpLCAgInZhbHVlIjogb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSB9ICk7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAic1NvcnREaXJfIisoaStpRml4ZWQpLCAgInZhbHVlIjogb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSB9ICk7CgkJCQl9CgkJCQkKCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJewoJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJTb3J0YWJsZV8iK2ksICAidmFsdWUiOiBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSB9ICk7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBhb0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBBamF4IHBhcmFtZXRlcnMgZnJvbSBwbHVnaW5zCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3RzfSBhb0RhdGEgbmFtZS92YWx1ZSBwYWlycyB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApCgkJewoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU2VydmVyUGFyYW1zJywgJ3NlcnZlclBhcmFtcycsIFthb0RhdGFdICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERhdGEgdGhlIGRhdGEgZnJvbSB0aGUgc2VydmVyIChudWtpbmcgdGhlIG9sZCkgYW5kIHJlZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBqc29uIGRhdGEgcmV0dXJuIGZyb20gdGhlIHNlcnZlci4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IGpzb24uc0VjaG8gVHJhY2tpbmcgZmxhZyBmb3IgRGF0YVRhYmxlcyB0byBtYXRjaCByZXF1ZXN0cwoJCSAqICBAcGFyYW0ge2ludH0ganNvbi5pVG90YWxSZWNvcmRzIE51bWJlciBvZiByZWNvcmRzIGluIHRoZSBkYXRhIHNldCwgbm90IGFjY291bnRpbmcgZm9yIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge2ludH0ganNvbi5pVG90YWxEaXNwbGF5UmVjb3JkcyBOdW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgZGF0YSBzZXQsIGFjY291bnRpbmcgZm9yIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge2FycmF5fSBqc29uLmFhRGF0YSBUaGUgZGF0YSB0byBkaXNwbGF5IG9uIHRoaXMgcGFnZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gW2pzb24uc0NvbHVtbnNdIENvbHVtbiBvcmRlcmluZyAoc05hbWUsIGNvbW1hIHNlcGFyYXRlZCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWpheFVwZGF0ZURyYXcgKCBvU2V0dGluZ3MsIGpzb24gKQoJCXsKCQkJaWYgKCBqc29uLnNFY2hvICE9PSB1bmRlZmluZWQgKQoJCQl7CgkJCQkvKiBQcm90ZWN0IGFnYWluc3Qgb2xkIHJldHVybnMgb3Zlci13cml0aW5nIGEgbmV3IG9uZS4gUG9zc2libGUgd2hlbiB5b3UgZ2V0CgkJCQkgKiB2ZXJ5IGZhc3QgaW50ZXJhY3Rpb24sIGFuZCBsYXRlciBxdWVpcmVzIGFyZSBjb21wbGV0ZWQgbXVjaCBmYXN0ZXIKCQkJCSAqLwoJCQkJaWYgKCBqc29uLnNFY2hvKjEgPCBvU2V0dGluZ3MuaURyYXcgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuaURyYXcgPSBqc29uLnNFY2hvICogMTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlIHx8CgkJCQkgICAob1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlICYmIChvU2V0dGluZ3MuYlNvcnRlZCB8fCBvU2V0dGluZ3MuYkZpbHRlcmVkKSkgKQoJCQl7CgkJCQlfZm5DbGVhclRhYmxlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlvU2V0dGluZ3MuX2lSZWNvcmRzVG90YWwgPSBwYXJzZUludChqc29uLmlUb3RhbFJlY29yZHMsIDEwKTsKCQkJb1NldHRpbmdzLl9pUmVjb3Jkc0Rpc3BsYXkgPSBwYXJzZUludChqc29uLmlUb3RhbERpc3BsYXlSZWNvcmRzLCAxMCk7CgkJCQoJCQkvKiBEZXRlcm1pbmUgaWYgcmVvcmRlcmluZyBpcyByZXF1aXJlZCAqLwoJCQl2YXIgc09yZGVyaW5nID0gX2ZuQ29sdW1uT3JkZXJpbmcob1NldHRpbmdzKTsKCQkJdmFyIGJSZU9yZGVyID0gKGpzb24uc0NvbHVtbnMgIT09IHVuZGVmaW5lZCAmJiBzT3JkZXJpbmcgIT09ICIiICYmIGpzb24uc0NvbHVtbnMgIT0gc09yZGVyaW5nICk7CgkJCXZhciBhaUluZGV4OwoJCQlpZiAoIGJSZU9yZGVyICkKCQkJewoJCQkJYWlJbmRleCA9IF9mblJlT3JkZXJJbmRleCggb1NldHRpbmdzLCBqc29uLnNDb2x1bW5zICk7CgkJCX0KCQkJCgkJCXZhciBhRGF0YSA9IF9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKSgganNvbiApOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFEYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYlJlT3JkZXIgKQoJCQkJewoJCQkJCS8qIElmIHdlIG5lZWQgdG8gcmUtb3JkZXIsIHRoZW4gY3JlYXRlIGEgbmV3IGFycmF5IHdpdGggdGhlIGNvcnJlY3Qgb3JkZXIgYW5kIGFkZCBpdCAqLwoJCQkJCXZhciBhRGF0YVNvcnRlZCA9IFtdOwoJCQkJCWZvciAoIHZhciBqPTAsIGpMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCXsKCQkJCQkJYURhdGFTb3J0ZWQucHVzaCggYURhdGFbaV1bIGFpSW5kZXhbal0gXSApOwoJCQkJCX0KCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhU29ydGVkICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJLyogTm8gcmUtb3JkZXIgcmVxdWlyZWQsIHNldmVyIGdvdCBpdCAicmlnaHQiIC0ganVzdCBzdHJhaWdodCBhZGQgKi8KCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhW2ldICk7CgkJCQl9CgkJCX0KCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCgkJCW9TZXR0aW5ncy5iQWpheERhdGFHZXQgPSBmYWxzZTsKCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCW9TZXR0aW5ncy5iQWpheERhdGFHZXQgPSB0cnVlOwoJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgZmlsdGVyaW5nIHRleHQKCQkgKiAgQHJldHVybnMge25vZGV9IEZpbHRlciBjb250cm9sIGVsZW1lbnQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GZWF0dXJlSHRtbEZpbHRlciAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgb1ByZXZpb3VzU2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCXZhciBzU2VhcmNoU3RyID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zU2VhcmNoOwoJCQlzU2VhcmNoU3RyID0gKHNTZWFyY2hTdHIuaW5kZXhPZignX0lOUFVUXycpICE9PSAtMSkgPwoJCQkgIHNTZWFyY2hTdHIucmVwbGFjZSgnX0lOUFVUXycsICc8aW5wdXQgdHlwZT0idGV4dCIgLz4nKSA6CgkJCSAgc1NlYXJjaFN0cj09PSIiID8gJzxpbnB1dCB0eXBlPSJ0ZXh0IiAvPicgOiBzU2VhcmNoU3RyKycgPGlucHV0IHR5cGU9InRleHQiIC8+JzsKCQkJCgkJCXZhciBuRmlsdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJbkZpbHRlci5jbGFzc05hbWUgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0ZpbHRlcjsKCQkJbkZpbHRlci5pbm5lckhUTUwgPSAnPGxhYmVsPicrc1NlYXJjaFN0cisnPC9sYWJlbD4nOwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuZiApCgkJCXsKCQkJCW5GaWx0ZXIuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19maWx0ZXInOwoJCQl9CgkJCQoJCQl2YXIganFGaWx0ZXIgPSAkKCJpbnB1dCIsIG5GaWx0ZXIpOwoJCQlqcUZpbHRlci52YWwoIG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoLnJlcGxhY2UoJyInLCcmcXVvdDsnKSApOwoJCQlqcUZpbHRlci5iaW5kKCAna2V5dXAuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGZpbHRlciBpbnB1dCBlbGVtZW50cyBmb3IgdGhlIG5ldyBkaXNwbGF5ICovCgkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBuW2ldICE9ICQodGhpcykucGFyZW50cygnZGl2LmRhdGFUYWJsZXNfZmlsdGVyJylbMF0gKQoJCQkJCXsKCQkJCQkJJCgnaW5wdXQnLCBuW2ldKS52YWwoIHRoaXMudmFsdWUgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIE5vdyBkbyB0aGUgZmlsdGVyICovCgkJCQlpZiAoIHRoaXMudmFsdWUgIT0gb1ByZXZpb3VzU2VhcmNoLnNTZWFyY2ggKQoJCQkJewoJCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIHsgCgkJCQkJCSJzU2VhcmNoIjogdGhpcy52YWx1ZSwgCgkJCQkJCSJiUmVnZXgiOiBvUHJldmlvdXNTZWFyY2guYlJlZ2V4LAoJCQkJCQkiYlNtYXJ0Ijogb1ByZXZpb3VzU2VhcmNoLmJTbWFydCAsCgkJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogb1ByZXZpb3VzU2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgCgkJCQkJfSApOwoJCQkJfQoJCQl9ICk7CgkJCgkJCWpxRmlsdGVyCgkJCQkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkJLyogUHJldmVudCBmb3JtIHN1Ym1pc3Npb24gKi8KCQkJCQlpZiAoIGUua2V5Q29kZSA9PSAxMyApCgkJCQkJewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQkpOwoJCQkKCQkJcmV0dXJuIG5GaWx0ZXI7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgdGFibGUgdXNpbmcgYm90aCB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgY29sdW1uIGJhc2VkIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2VhcmNoIHNlYXJjaCBpbmZvcm1hdGlvbgoJCSAqICBAcGFyYW0ge2ludH0gW2lGb3JjZV0gZm9yY2UgYSByZXNlYXJjaCBvZiB0aGUgbWFzdGVyIGFycmF5ICgxKSBvciBub3QgKHVuZGVmaW5lZCBvciAwKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb21wbGV0ZSAoIG9TZXR0aW5ncywgb0lucHV0LCBpRm9yY2UgKQoJCXsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJdmFyIGFvUHJldlNlYXJjaCA9IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHM7CgkJCXZhciBmblNhdmVGaWx0ZXIgPSBmdW5jdGlvbiAoIG9GaWx0ZXIgKSB7CgkJCQkvKiBTYXZlIHRoZSBmaWx0ZXJpbmcgdmFsdWVzICovCgkJCQlvUHJldlNlYXJjaC5zU2VhcmNoID0gb0ZpbHRlci5zU2VhcmNoOwoJCQkJb1ByZXZTZWFyY2guYlJlZ2V4ID0gb0ZpbHRlci5iUmVnZXg7CgkJCQlvUHJldlNlYXJjaC5iU21hcnQgPSBvRmlsdGVyLmJTbWFydDsKCQkJCW9QcmV2U2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgPSBvRmlsdGVyLmJDYXNlSW5zZW5zaXRpdmU7CgkJCX07CgkJCgkJCS8qIEluIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgYWxsIGZpbHRlcmluZyBpcyBkb25lIGJ5IHRoZSBzZXJ2ZXIsIHNvIG5vIHBvaW50IGhhbmdpbmcgYXJvdW5kIGhlcmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCS8qIEdsb2JhbCBmaWx0ZXIgKi8KCQkJCV9mbkZpbHRlciggb1NldHRpbmdzLCBvSW5wdXQuc1NlYXJjaCwgaUZvcmNlLCBvSW5wdXQuYlJlZ2V4LCBvSW5wdXQuYlNtYXJ0LCBvSW5wdXQuYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQkJZm5TYXZlRmlsdGVyKCBvSW5wdXQgKTsKCQkKCQkJCS8qIE5vdyBkbyB0aGUgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVyICovCgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJX2ZuRmlsdGVyQ29sdW1uKCBvU2V0dGluZ3MsIGFvUHJldlNlYXJjaFtpXS5zU2VhcmNoLCBpLCBhb1ByZXZTZWFyY2hbaV0uYlJlZ2V4LCAKCQkJCQkJYW9QcmV2U2VhcmNoW2ldLmJTbWFydCwgYW9QcmV2U2VhcmNoW2ldLmJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJCX0KCQkJCQoJCQkJLyogQ3VzdG9tIGZpbHRlcmluZyAqLwoJCQkJX2ZuRmlsdGVyQ3VzdG9tKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWZuU2F2ZUZpbHRlciggb0lucHV0ICk7CgkJCX0KCQkJCgkJCS8qIFRlbGwgdGhlIGRyYXcgZnVuY3Rpb24gd2UgaGF2ZSBiZWVuIGZpbHRlcmluZyAqLwoJCQlvU2V0dGluZ3MuYkZpbHRlcmVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdmaWx0ZXInLCBvU2V0dGluZ3MpOwoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8qIFJlYnVpbGQgc2VhcmNoIGFycmF5ICdvZmZsaW5lJyAqLwoJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDAgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgY3VzdG9tIGZpbHRlcmluZyBmdW5jdGlvbnMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDdXN0b20oIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYWZuRmlsdGVycyA9IERhdGFUYWJsZS5leHQuYWZuRmlsdGVyaW5nOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFmbkZpbHRlcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJdmFyIGlDb3JyZWN0b3IgPSAwOwoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJdmFyIGlEaXNJbmRleCA9IG9TZXR0aW5ncy5haURpc3BsYXlbai1pQ29ycmVjdG9yXTsKCQkJCQkKCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgdXNlIHRoaXMgcm93IGJhc2VkIG9uIHRoZSBmaWx0ZXJpbmcgZnVuY3Rpb24gKi8KCQkJCQlpZiAoICFhZm5GaWx0ZXJzW2ldKCBvU2V0dGluZ3MsIF9mbkdldFJvd0RhdGEoIG9TZXR0aW5ncywgaURpc0luZGV4LCAnZmlsdGVyJyApLCBpRGlzSW5kZXggKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggai1pQ29ycmVjdG9yLCAxICk7CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSB0YWJsZSBvbiBhIHBlci1jb2x1bW4gYmFzaXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2x1bW4gY29sdW1uIHRvIGZpbHRlcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBzZWFyY2ggc3RyaW5nIGFzIGEgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTbWFydCB1c2Ugc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb2x1bW4gKCBvU2V0dGluZ3MsIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJaWYgKCBzSW5wdXQgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJdmFyIHJwU2VhcmNoID0gX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoKCBzSW5wdXQsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICk7CgkJCQoJCQlmb3IgKCB2YXIgaT1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCXZhciBzRGF0YSA9IF9mbkRhdGFUb1NlYXJjaCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtpXSwgaUNvbHVtbiwgJ2ZpbHRlcicgKSwKCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLnNUeXBlICk7CgkJCQlpZiAoICEgcnBTZWFyY2gudGVzdCggc0RhdGEgKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIGksIDEgKTsKCQkJCQlpSW5kZXhDb3JyZWN0b3IrKzsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIGRhdGEgdGFibGUgYmFzZWQgb24gdXNlciBpbnB1dCBhbmQgZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlGb3JjZSBvcHRpb25hbCAtIGZvcmNlIGEgcmVzZWFyY2ggb2YgdGhlIG1hc3RlciBhcnJheSAoMSkgb3Igbm90ICh1bmRlZmluZWQgb3IgMCkKCQkgKiAgQHBhcmFtIHtib29sfSBiUmVnZXggdHJlYXQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNtYXJ0IHBlcmZvcm0gc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXIoIG9TZXR0aW5ncywgc0lucHV0LCBpRm9yY2UsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBpOwoJCQl2YXIgcnBTZWFyY2ggPSBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNJbnB1dCwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIGFyZSBmb3JjaW5nIG9yIG5vdCAtIG9wdGlvbmFsIHBhcmFtZXRlciAqLwoJCQlpZiAoICFpRm9yY2UgKQoJCQl7CgkJCQlpRm9yY2UgPSAwOwoJCQl9CgkJCQoJCQkvKiBOZWVkIHRvIHRha2UgYWNjb3VudCBvZiBjdXN0b20gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIGFsd2F5cyBmaWx0ZXIgKi8KCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmbkZpbHRlcmluZy5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlpRm9yY2UgPSAxOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBJZiB0aGUgaW5wdXQgaXMgYmxhbmsgLSB3ZSB3YW50IHRoZSBmdWxsIGRhdGEgc2V0CgkJCSAqLwoJCQlpZiAoIHNJbnB1dC5sZW5ndGggPD0gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyoKCQkJCSAqIFdlIGFyZSBzdGFydGluZyBhIG5ldyBzZWFyY2ggb3IgdGhlIG5ldyBzZWFyY2ggc3RyaW5nIGlzIHNtYWxsZXIgCgkJCQkgKiB0aGVuIHRoZSBvbGQgb25lIChpLmUuIGRlbGV0ZSkuIFNlYXJjaCBmcm9tIHRoZSBtYXN0ZXIgYXJyYXkKCQkJIAkgKi8KCQkJCWlmICggb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggPT0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggfHwKCQkJCQkgICBvUHJldlNlYXJjaC5zU2VhcmNoLmxlbmd0aCA+IHNJbnB1dC5sZW5ndGggfHwgaUZvcmNlID09IDEgfHwKCQkJCQkgICBzSW5wdXQuaW5kZXhPZihvUHJldlNlYXJjaC5zU2VhcmNoKSAhPT0gMCApCgkJCQl7CgkJCQkJLyogTnVrZSB0aGUgb2xkIGRpc3BsYXkgYXJyYXkgLSB3ZSBhcmUgZ29pbmcgdG8gcmVidWlsZCBpdCAqLwoJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQkJCgkJCQkJLyogRm9yY2UgYSByZWJ1aWxkIG9mIHRoZSBzZWFyY2ggYXJyYXkgKi8KCQkJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDEgKTsKCQkJCQkKCQkJCQkvKiBTZWFyY2ggdGhyb3VnaCBhbGwgcmVjb3JkcyB0byBwb3B1bGF0ZSB0aGUgc2VhcmNoIGFycmF5CgkJCQkJICogVGhlIHRoZSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyIGFuZCBhc0RhdGFTZWFyY2ggYXJyYXlzIGhhdmUgMSB0byAxIAoJCQkJCSAqIG1hcHBpbmcKCQkJCQkgKi8KCQkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggcnBTZWFyY2gudGVzdChvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2ldKSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkucHVzaCggb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcltpXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkgIH0KCQkJICBlbHNlCgkJCQl7CgkJCSAgCS8qIFVzaW5nIG9sZCBzZWFyY2ggYXJyYXkgLSByZWZpbmUgaXQgLSBkbyBpdCB0aGlzIHdheSBmb3Igc3BlZWQKCQkJICAJICogRG9uJ3QgaGF2ZSB0byBzZWFyY2ggdGhlIHdob2xlIG1hc3RlciBhcnJheSBhZ2FpbgoJCQkJCSAqLwoJCQkgIAl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJICAJCgkJCSAgCS8qIFNlYXJjaCB0aGUgY3VycmVudCByZXN1bHRzICovCgkJCSAgCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJICAJCWlmICggISBycFNlYXJjaC50ZXN0KG9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0pICkKCQkJCQkJewoJCQkgIAkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCBpLWlJbmRleENvcnJlY3RvciwgMSApOwoJCQkgIAkJCWlJbmRleENvcnJlY3RvcisrOwoJCQkgIAkJfQoJCQkgIAl9CgkJCSAgfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhbiBhcnJheSB3aGljaCBjYW4gYmUgcXVpY2tseSBzZWFyY2ggdGhyb3VnaAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWFzdGVyIHVzZSB0aGUgbWFzdGVyIGRhdGEgYXJyYXkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaEFycmF5ICggb1NldHRpbmdzLCBpTWFzdGVyICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQkvKiBDbGVhciBvdXQgdGhlIG9sZCBkYXRhICovCgkJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoLnNwbGljZSggMCwgb1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggKTsKCQkJCQoJCQkJdmFyIGFBcnJheSA9IChpTWFzdGVyICYmIGlNYXN0ZXI9PT0xKSA/CgkJCQkgCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIgOiBvU2V0dGluZ3MuYWlEaXNwbGF5OwoJCQkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFBcnJheS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0gPSBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLAoJCQkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGFBcnJheVtpXSwgJ2ZpbHRlcicgKSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIHNlYXJjaGFibGUgc3RyaW5nIGZyb20gYSBzaW5nbGUgZGF0YSByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSb3cgZGF0YSBhcnJheSB0byB1c2UgZm9yIHRoZSBkYXRhIHRvIHNlYXJjaAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLCBhRGF0YSApCgkJewoJCQl2YXIgc1NlYXJjaCA9ICcnOwoJCQlpZiAoIG9TZXR0aW5ncy5fX25UbXBGaWx0ZXIgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCW9TZXR0aW5ncy5fX25UbXBGaWx0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJfQoJCQl2YXIgblRtcCA9IG9TZXR0aW5ncy5fX25UbXBGaWx0ZXI7CgkJCQoJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2pdLmJTZWFyY2hhYmxlICkKCQkJCXsKCQkJCQl2YXIgc0RhdGEgPSBhRGF0YVtqXTsKCQkJCQlzU2VhcmNoICs9IF9mbkRhdGFUb1NlYXJjaCggc0RhdGEsIG9TZXR0aW5ncy5hb0NvbHVtbnNbal0uc1R5cGUgKSsnICAnOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiBpdCBsb29rcyBsaWtlIHRoZXJlIGlzIGFuIEhUTUwgZW50aXR5IGluIHRoZSBzdHJpbmcsIGF0dGVtcHQgdG8gZGVjb2RlIGl0ICovCgkJCWlmICggc1NlYXJjaC5pbmRleE9mKCcmJykgIT09IC0xICkKCQkJewoJCQkJblRtcC5pbm5lckhUTUwgPSBzU2VhcmNoOwoJCQkJc1NlYXJjaCA9IG5UbXAudGV4dENvbnRlbnQgPyBuVG1wLnRleHRDb250ZW50IDogblRtcC5pbm5lclRleHQ7CgkJCQkKCQkJCS8qIElFIGFuZCBPcGVyYSBhcHBlYXIgdG8gcHV0IGFuIG5ld2xpbmUgd2hlcmUgdGhlcmUgaXMgYSA8YnI+IHRhZyAtIHJlbW92ZSBpdCAqLwoJCQkJc1NlYXJjaCA9IHNTZWFyY2gucmVwbGFjZSgvXG4vZywiICIpLnJlcGxhY2UoL1xyL2csIiIpOwoJCQl9CgkJCQoJCQlyZXR1cm4gc1NlYXJjaDsKCQl9CgkJCgkJLyoqCgkJICogQnVpbGQgYSByZWd1bGFyIGV4cHJlc3Npb24gb2JqZWN0IHN1aXRhYmxlIGZvciBzZWFyY2hpbmcgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NlYXJjaCBzdHJpbmcgdG8gc2VhcmNoIGZvcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU21hcnQgcGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc3RpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEByZXR1cm5zIHtSZWdFeHB9IGNvbnN0cnVjdGVkIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNTZWFyY2gsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBhc1NlYXJjaCwgc1JlZ0V4cFN0cmluZzsKCQkJCgkJCWlmICggYlNtYXJ0ICkKCQkJewoJCQkJLyogR2VuZXJhdGUgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byB1c2UuIFNvbWV0aGluZyBhbG9uZyB0aGUgbGluZXMgb2Y6CgkJCQkgKiBeKD89Lio/XGJvbmVcYikoPz0uKj9cYnR3b1xiKSg/PS4qP1xidGhyZWVcYikuKiQKCQkJCSAqLwoJCQkJYXNTZWFyY2ggPSBiUmVnZXggPyBzU2VhcmNoLnNwbGl0KCAnICcgKSA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICkuc3BsaXQoICcgJyApOwoJCQkJc1JlZ0V4cFN0cmluZyA9ICdeKD89Lio/Jythc1NlYXJjaC5qb2luKCAnKSg/PS4qPycgKSsnKS4qJCc7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1JlZ0V4cFN0cmluZywgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlzU2VhcmNoID0gYlJlZ2V4ID8gc1NlYXJjaCA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICk7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1NlYXJjaCwgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ29udmVydCByYXcgZGF0YSBpbnRvIHNvbWV0aGluZyB0aGF0IHRoZSB1c2VyIGNhbiBzZWFyY2ggb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNEYXRhIGRhdGEgdG8gYmUgbW9kaWZpZWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUeXBlIGRhdGEgdHlwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBzZWFyY2ggc3RyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRhdGFUb1NlYXJjaCAoIHNEYXRhLCBzVHlwZSApCgkJewoJCQlpZiAoIHR5cGVvZiBEYXRhVGFibGUuZXh0Lm9mblNlYXJjaFtzVHlwZV0gPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlyZXR1cm4gRGF0YVRhYmxlLmV4dC5vZm5TZWFyY2hbc1R5cGVdKCBzRGF0YSApOwoJCQl9CgkJCWVsc2UgaWYgKCBzVHlwZSA9PSAiaHRtbCIgKQoJCQl7CgkJCQlyZXR1cm4gc0RhdGEucmVwbGFjZSgvW1xyXG5dL2csIiAiKS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIHNEYXRhID09PSAic3RyaW5nIiApCgkJCXsKCQkJCXJldHVybiBzRGF0YS5yZXBsYWNlKC9bXHJcbl0vZywiICIpOwoJCQl9CgkJCWVsc2UgaWYgKCBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIHNjYXBlIGEgc3RyaW5nIHN0dWNoIHRoYXQgaXQgY2FuIGJlIHVzZWQgaW4gYSByZWd1bGFyIGV4cHJlc3Npb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWYWwgc3RyaW5nIHRvIGVzY2FwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBlc2NhcGVkIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Fc2NhcGVSZWdleCAoIHNWYWwgKQoJCXsKCQkJdmFyIGFjRXNjYXBlID0gWyAnLycsICcuJywgJyonLCAnKycsICc/JywgJ3wnLCAnKCcsICcpJywgJ1snLCAnXScsICd7JywgJ30nLCAnXFwnLCAnJCcsICdeJyBdOwoJCQl2YXIgcmVSZXBsYWNlID0gbmV3IFJlZ0V4cCggJyhcXCcgKyBhY0VzY2FwZS5qb2luKCd8XFwnKSArICcpJywgJ2cnICk7CgkJCXJldHVybiBzVmFsLnJlcGxhY2UocmVSZXBsYWNlLCAnXFwkMScpOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdGhlIGluZm8gZGlzcGxheQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBJbmZvcm1hdGlvbiBlbGVtZW50CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sSW5mbyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgbkluZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQluSW5mby5jbGFzc05hbWUgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc0luZm87CgkJCQoJCQkvKiBBY3Rpb25zIHRoYXQgYXJlIHRvIGJlIHRha2VuIG9uY2Ugb25seSBmb3IgdGhpcyBmZWF0dXJlICovCgkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5pICkKCQkJewoJCQkJLyogQWRkIGRyYXcgY2FsbGJhY2sgKi8KCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogX2ZuVXBkYXRlSW5mbywKCQkJCQkic05hbWUiOiAiaW5mb3JtYXRpb24iCgkJCQl9ICk7CgkJCQkKCQkJCS8qIEFkZCBpZCAqLwoJCQkJbkluZm8uaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19pbmZvJzsKCQkJfQoJCQlvU2V0dGluZ3MublRhYmxlLnNldEF0dHJpYnV0ZSggJ2FyaWEtZGVzY3JpYmVkYnknLCBvU2V0dGluZ3Muc1RhYmxlSWQrJ19pbmZvJyApOwoJCQkKCQkJcmV0dXJuIG5JbmZvOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgdGhlIGluZm9ybWF0aW9uIGVsZW1lbnRzIGluIHRoZSBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuVXBkYXRlSW5mbyAoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBTaG93IGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJJbmZvIHx8IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5pLmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJdmFyCgkJCQlpU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQrMSwgaUVuZCA9IG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwKCQkJCWlNYXggPSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSwgaVRvdGFsID0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSwKCQkJCXNTdGFydCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaVN0YXJ0ICksIHNFbmQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlFbmQgKSwKCQkJCXNNYXggPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlNYXggKSwgc1RvdGFsID0gb1NldHRpbmdzLmZuRm9ybWF0TnVtYmVyKCBpVG90YWwgKSwKCQkJCXNPdXQ7CgkJCQoJCQkvKiBXaGVuIGluZmluaXRlIHNjcm9sbGluZywgd2UgYXJlIGFsd2F5cyBzdGFydGluZyBhdCAxLiBfaURpc3BsYXlTdGFydCBpcyB1c2VkIG9ubHkKCQkJICogaW50ZXJuYWxseQoJCQkgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQlzU3RhcnQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIDEgKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpID09PSAwICYmIAoJCQkJICAgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSApCgkJCXsKCQkJCS8qIEVtcHR5IHJlY29yZCBzZXQgKi8KCQkJCXNPdXQgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLnNJbmZvRW1wdHkrIG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0luZm9Qb3N0Rml4OwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpID09PSAwICkKCQkJewoJCQkJLyogUm1wdHkgcmVjb3JkIHNldCBhZnRlciBmaWx0ZXJpbmcgKi8KCQkJCXNPdXQgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLnNJbmZvRW1wdHkgKycgJysgCgkJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zSW5mb0ZpbHRlcmVkLnJlcGxhY2UoJ19NQVhfJywgc01heCkrCgkJCQkJCW9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0luZm9Qb3N0Rml4OwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpID09IG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpICkKCQkJewoJCQkJLyogTm9ybWFsIHJlY29yZCBzZXQgKi8KCQkJCXNPdXQgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLnNJbmZvLgoJCQkJCQlyZXBsYWNlKCdfU1RBUlRfJywgc1N0YXJ0KS4KCQkJCQkJcmVwbGFjZSgnX0VORF8nLCAgIHNFbmQpLgoJCQkJCQlyZXBsYWNlKCdfVE9UQUxfJywgc1RvdGFsKSsgCgkJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zSW5mb1Bvc3RGaXg7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBSZWNvcmQgc2V0IGFmdGVyIGZpbHRlcmluZyAqLwoJCQkJc091dCA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0luZm8uCgkJCQkJCXJlcGxhY2UoJ19TVEFSVF8nLCBzU3RhcnQpLgoJCQkJCQlyZXBsYWNlKCdfRU5EXycsICAgc0VuZCkuCgkJCQkJCXJlcGxhY2UoJ19UT1RBTF8nLCBzVG90YWwpICsnICcrIAoJCQkJCW9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc0luZm9GaWx0ZXJlZC5yZXBsYWNlKCdfTUFYXycsIAoJCQkJCQlvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIob1NldHRpbmdzLmZuUmVjb3Jkc1RvdGFsKCkpKSsgCgkJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zSW5mb1Bvc3RGaXg7CgkJCX0KCQkJCgkJCWlmICggb1NldHRpbmdzLm9MYW5ndWFnZS5mbkluZm9DYWxsYmFjayAhPT0gbnVsbCApCgkJCXsKCQkJCXNPdXQgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLmZuSW5mb0NhbGxiYWNrLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIAoJCQkJCW9TZXR0aW5ncywgaVN0YXJ0LCBpRW5kLCBpTWF4LCBpVG90YWwsIHNPdXQgKTsKCQkJfQoJCQkKCQkJdmFyIG4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMuaTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCSQobltpXSkuaHRtbCggc091dCApOwoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRpYWxpc2UgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGlBamF4U3RhcnQ9b1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0OwoJCQkKCQkJLyogRW5zdXJlIHRoYXQgdGhlIHRhYmxlIGRhdGEgaXMgZnVsbHkgaW5pdGlhbGlzZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkluaXRpYWxpc2VkID09PSBmYWxzZSApCgkJCXsKCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7IF9mbkluaXRpYWxpc2UoIG9TZXR0aW5ncyApOyB9LCAyMDAgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgZGlzcGxheSBIVE1MIG9wdGlvbnMgKi8KCQkJX2ZuQWRkT3B0aW9uc0h0bWwoIG9TZXR0aW5ncyApOwoJCQkKCQkJLyogQnVpbGQgYW5kIGRyYXcgdGhlIGhlYWRlciAvIGZvb3RlciBmb3IgdGhlIHRhYmxlICovCgkJCV9mbkJ1aWxkSGVhZCggb1NldHRpbmdzICk7CgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQoJCQkvKiBPa2F5IHRvIHNob3cgdGhhdCBzb21ldGhpbmcgaXMgZ29pbmcgb24gbm93ICovCgkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIHRydWUgKTsKCQkJCgkJCS8qIENhbGN1bGF0ZSBzaXplcyBmb3IgY29sdW1ucyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggIT09IG51bGwgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIElmIHRoZXJlIGlzIGRlZmF1bHQgc29ydGluZyByZXF1aXJlZCAtIGxldCdzIGRvIGl0LiBUaGUgc29ydCBmdW5jdGlvbiB3aWxsIGRvIHRoZQoJCQkgKiBkcmF3aW5nIGZvciB1cy4gT3RoZXJ3aXNlIHdlIGRyYXcgdGhlIHRhYmxlIHJlZ2FyZGxlc3Mgb2YgdGhlIEFqYXggc291cmNlIC0gdGhpcyBhbGxvd3MKCQkJICogdGhlIHRhYmxlIHRvIGxvb2sgaW5pdGlhbGlzZWQgZm9yIEFqYXggc291cmNpbmcgZGF0YSAoc2hvdyAnbG9hZGluZycgbWVzc2FnZSBwb3NzaWJseSkKCQkJICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCXsKCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBpZiB0aGVyZSBpcyBhbiBhamF4IHNvdXJjZSBsb2FkIHRoZSBkYXRhICovCgkJCWlmICggb1NldHRpbmdzLnNBamF4U291cmNlICE9PSBudWxsICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJdmFyIGFvRGF0YSA9IFtdOwoJCQkJX2ZuU2VydmVyUGFyYW1zKCBvU2V0dGluZ3MsIGFvRGF0YSApOwoJCQkJb1NldHRpbmdzLmZuU2VydmVyRGF0YS5jYWxsKCBvU2V0dGluZ3Mub0luc3RhbmNlLCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UsIGFvRGF0YSwgZnVuY3Rpb24oanNvbikgewoJCQkJCXZhciBhRGF0YSA9IChvU2V0dGluZ3Muc0FqYXhEYXRhUHJvcCAhPT0gIiIpID8KCQkJCQkgCV9mbkdldE9iamVjdERhdGFGbiggb1NldHRpbmdzLnNBamF4RGF0YVByb3AgKShqc29uKSA6IGpzb247CgkJCgkJCQkJLyogR290IHRoZSBkYXRhIC0gYWRkIGl0IHRvIHRoZSB0YWJsZSAqLwoJCQkJCWZvciAoIGk9MCA7IGk8YURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCV9mbkFkZERhdGEoIG9TZXR0aW5ncywgYURhdGFbaV0gKTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogUmVzZXQgdGhlIGluaXQgZGlzcGxheSBmb3IgY29va2llIHNhdmluZy4gV2UndmUgYWxyZWFkeSBkb25lIGEgZmlsdGVyLCBhbmQKCQkJCQkgKiB0aGVyZWZvcmUgY2xlYXJlZCBpdCBiZWZvcmUuIFNvIHdlIG5lZWQgdG8gbWFrZSBpdCBhcHBlYXIgJ2ZyZXNoJwoJCQkJCSAqLwoJCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IGlBamF4U3RhcnQ7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJCQl7CgkJCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQkJCgkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncywganNvbiApOwoJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgaW5pdGlhbGlzYXRpb24gY29tcGxldGUgaXMgZG9uZSBhdCB0aGUgZW5kIG9mIF9mbkRyYXcgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQlfZm5Jbml0Q29tcGxldGUoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIERyYXcgdGhlIHRhYmxlIGZvciB0aGUgZmlyc3QgdGltZSwgYWRkaW5nIGFsbCByZXF1aXJlZCBmZWF0dXJlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBbanNvbl0gSlNPTiBmcm9tIHRoZSBzZXJ2ZXIgdGhhdCBjb21wbGV0ZWQgdGhlIHRhYmxlLCBpZiB1c2luZyBBamF4IHNvdXJjZQoJCSAqICAgIHdpdGggY2xpZW50LXNpZGUgcHJvY2Vzc2luZyAob3B0aW9uYWwpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkluaXRDb21wbGV0ZSAoIG9TZXR0aW5ncywganNvbiApCgkJewoJCQlvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgPSB0cnVlOwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvSW5pdENvbXBsZXRlJywgJ2luaXQnLCBbb1NldHRpbmdzLCBqc29uXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBjb21wYXRpYmlsaXR5IC0gd2hlbiBjZXJ0YWluIG9wdGlvbnMgYXJlIGdpdmVuLCBhbmQgb3RoZXJzIGFyZW4ndCwgd2UKCQkgKiBuZWVkIHRvIGR1cGxpY2F0ZSB0aGUgdmFsdWVzIG92ZXIsIGluIG9yZGVyIHRvIHByb3ZpZGUgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCQkgKiB3aXRoIG9sZGVyIGxhbmd1YWdlIGZpbGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxhbmd1YWdlQ29tcGF0KCBvTGFuZ3VhZ2UgKQoJCXsKCQkJLyogQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgLSBpZiB0aGVyZSBpcyBubyBzRW1wdHlUYWJsZSBnaXZlbiwgdGhlbiB1c2UgdGhlIHNhbWUgYXMKCQkJICogc1plcm9SZWNvcmRzIC0gYXNzdW1pbmcgdGhhdCBpcyBnaXZlbi4KCQkJICovCgkJCWlmICggIW9MYW5ndWFnZS5zRW1wdHlUYWJsZSAmJiBvTGFuZ3VhZ2Uuc1plcm9SZWNvcmRzICkKCQkJewoJCQkJX2ZuTWFwKCBvTGFuZ3VhZ2UsIG9MYW5ndWFnZSwgJ3NaZXJvUmVjb3JkcycsICdzRW1wdHlUYWJsZScgKTsKCQkJfQoJCQoJCQkvKiBMaWtld2lzZSB3aXRoIGxvYWRpbmcgcmVjb3JkcyAqLwoJCQlpZiAoICFvTGFuZ3VhZ2Uuc0xvYWRpbmdSZWNvcmRzICYmIG9MYW5ndWFnZS5zWmVyb1JlY29yZHMgKQoJCQl7CgkJCQlfZm5NYXAoIG9MYW5ndWFnZSwgb0xhbmd1YWdlLCAnc1plcm9SZWNvcmRzJywgJ3NMb2FkaW5nUmVjb3JkcycgKTsKCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdXNlciBkaXNwbGF5IGxlbmd0aCBjaGFuZ2luZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBEaXNwbGF5IGxlbmd0aCBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxMZW5ndGggKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJLyogVGhpcyBjYW4gYmUgb3ZlcnJ1bGVkIGJ5IG5vdCB1c2luZyB0aGUgX01FTlVfIHZhci9tYWNybyBpbiB0aGUgbGFuZ3VhZ2UgdmFyaWFibGUgKi8KCQkJdmFyIHNOYW1lID0gJ25hbWU9Iicrb1NldHRpbmdzLnNUYWJsZUlkKydfbGVuZ3RoIic7CgkJCXZhciBzU3RkTWVudSA9ICc8c2VsZWN0IHNpemU9IjEiICcrc05hbWUrJz4nOwoJCQl2YXIgaSwgaUxlbjsKCQkJdmFyIGFMZW5ndGhNZW51ID0gb1NldHRpbmdzLmFMZW5ndGhNZW51OwoJCQkKCQkJaWYgKCBhTGVuZ3RoTWVudS5sZW5ndGggPT0gMiAmJiB0eXBlb2YgYUxlbmd0aE1lbnVbMF0gPT09ICdvYmplY3QnICYmIAoJCQkJCXR5cGVvZiBhTGVuZ3RoTWVudVsxXSA9PT0gJ29iamVjdCcgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YUxlbmd0aE1lbnVbMF0ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlzU3RkTWVudSArPSAnPG9wdGlvbiB2YWx1ZT0iJythTGVuZ3RoTWVudVswXVtpXSsnIj4nK2FMZW5ndGhNZW51WzFdW2ldKyc8L29wdGlvbj4nOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFMZW5ndGhNZW51Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJc1N0ZE1lbnUgKz0gJzxvcHRpb24gdmFsdWU9IicrYUxlbmd0aE1lbnVbaV0rJyI+JythTGVuZ3RoTWVudVtpXSsnPC9vcHRpb24+JzsKCQkJCX0KCQkJfQoJCQlzU3RkTWVudSArPSAnPC9zZWxlY3Q+JzsKCQkJCgkJCXZhciBuTGVuZ3RoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmwgKQoJCQl7CgkJCQluTGVuZ3RoLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfbGVuZ3RoJzsKCQkJfQoJCQluTGVuZ3RoLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zTGVuZ3RoOwoJCQluTGVuZ3RoLmlubmVySFRNTCA9ICc8bGFiZWw+JytvU2V0dGluZ3Mub0xhbmd1YWdlLnNMZW5ndGhNZW51LnJlcGxhY2UoICdfTUVOVV8nLCBzU3RkTWVudSApKyc8L2xhYmVsPic7CgkJCQoJCQkvKgoJCQkgKiBTZXQgdGhlIGxlbmd0aCB0byB0aGUgY3VycmVudCBkaXNwbGF5IGxlbmd0aCAtIHRoYW5rcyB0byBBbmRyZWEgUGF2bG92aWMgZm9yIHRoaXMgZml4LAoJCQkgKiBhbmQgU3RlZmFuIFNrb3BuaWsgZm9yIGZpeGluZyB0aGUgZml4IQoJCQkgKi8KCQkJJCgnc2VsZWN0IG9wdGlvblt2YWx1ZT0iJytvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKyciXScsIG5MZW5ndGgpLmF0dHIoInNlbGVjdGVkIiwgdHJ1ZSk7CgkJCQoJCQkkKCdzZWxlY3QnLCBuTGVuZ3RoKS5iaW5kKCAnY2hhbmdlLkRUJywgZnVuY3Rpb24oZSkgewoJCQkJdmFyIGlWYWwgPSAkKHRoaXMpLnZhbCgpOwoJCQkJCgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGxlbmd0aCBvcHRpb25zIGZvciB0aGUgbmV3IGRpc3BsYXkgKi8KCQkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmw7CgkJCQlmb3IgKCBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggbltpXSAhPSB0aGlzLnBhcmVudE5vZGUgKQoJCQkJCXsKCQkJCQkJJCgnc2VsZWN0JywgbltpXSkudmFsKCBpVmFsICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBSZWRyYXcgdGhlIHRhYmxlICovCgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID0gcGFyc2VJbnQoaVZhbCwgMTApOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCQoJCQkJLyogSWYgd2UgaGF2ZSBzcGFjZSB0byBzaG93IGV4dHJhIHJvd3MgKGJhY2tpbmcgdXAgZnJvbSB0aGUgZW5kIHBvaW50IC0gdGhlbiBkbyBzbyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgPT0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIC0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA8IDAgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA9PSAtMSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJCQoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0gKTsKCQkKCQkKCQkJJCgnc2VsZWN0Jywgbkxlbmd0aCkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQoJCQlyZXR1cm4gbkxlbmd0aDsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmNhbGN1bGF0ZSB0aGUgZW5kIHBvaW50IGJhc2VkIG9uIHRoZSBzdGFydCBwb2ludAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2V0IHRoZSBlbmQgcG9pbnQgb2YgdGhlIGRpc3BsYXkgLSBiYXNlZCBvbiBob3cgbWFueSBlbGVtZW50cyB0aGVyZSBhcmUKCQkJCSAqIHN0aWxsIHRvIGRpc3BsYXkKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID4gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggfHwKCQkJCQkgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kID0gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCArIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCQkgKiBOb3RlIHRoYXQgbW9zdCBvZiB0aGUgcGFnaW5nIGxvZ2ljIGlzIGRvbmUgaW4gCgkJICogRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciBkZWZhdWx0IHBhZ2luYXRpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUGFnaW5hdGlvbiBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgblBhZ2luYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJblBhZ2luYXRlLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnaW5nK29TZXR0aW5ncy5zUGFnaW5hdGlvblR5cGU7CgkJCQoJCQlEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uWyBvU2V0dGluZ3Muc1BhZ2luYXRpb25UeXBlIF0uZm5Jbml0KCBvU2V0dGluZ3MsIG5QYWdpbmF0ZSwgCgkJCQlmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQl9CgkJCSk7CgkJCQoJCQkvKiBBZGQgYSBkcmF3IGNhbGxiYWNrIGZvciB0aGUgcGFnaW5hdGlvbiBvbiBmaXJzdCBpbnN0YW5jZSwgdG8gdXBkYXRlIHRoZSBwYWdpbmcgZGlzcGxheSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkJCQkJRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvblsgb1NldHRpbmdzLnNQYWdpbmF0aW9uVHlwZSBdLmZuVXBkYXRlKCBvU2V0dGluZ3MsIGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCX0gKTsKCQkJCQl9LAoJCQkJCSJzTmFtZSI6ICJwYWdpbmF0aW9uIgoJCQkJfSApOwoJCQl9CgkJCXJldHVybiBuUGFnaW5hdGU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFsdGVyIHRoZSBkaXNwbGF5IHNldHRpbmdzIHRvIGNoYW5nZSB0aGUgcGFnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKQoJCSAqICBAcmV0dXJucyB7Ym9vbH0gdHJ1ZSBwYWdlIGhhcyBjaGFuZ2VkLCBmYWxzZSAtIG5vIGNoYW5nZSAobm8gZWZmZWN0KSBlZyAnZmlyc3QnIG9uIHBhZ2UgMQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5QYWdlQ2hhbmdlICggb1NldHRpbmdzLCBtQWN0aW9uICkKCQl7CgkJCXZhciBpT2xkU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQoJCQlpZiAoIHR5cGVvZiBtQWN0aW9uID09PSAibnVtYmVyIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG1BY3Rpb24gKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPiBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJmaXJzdCIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJwcmV2aW91cyIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoPj0wID8KCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDoKCQkJCQkwOwoJCQkJCgkJCQkvKiBDb3JyZWN0IGZvciB1bmRlcnJ1biAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPCAwICkKCQkJCXsKCQkJCSAgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggbUFjdGlvbiA9PSAibmV4dCIgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPj0gMCApCgkJCQl7CgkJCQkJLyogTWFrZSBzdXJlIHdlIGFyZSBub3Qgb3ZlciBydW5uaW5nIHRoZSBkaXNwbGF5IGFycmF5ICovCgkJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKz0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCQl9CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggbUFjdGlvbiA9PSAibGFzdCIgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPj0gMCApCgkJCQl7CgkJCQkJdmFyIGlQYWdlcyA9IHBhcnNlSW50KCAob1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKS0xKSAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgsIDEwICkgKyAxOwoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IChpUGFnZXMtMSkgKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlVua25vd24gcGFnaW5nIGFjdGlvbjogIittQWN0aW9uICk7CgkJCX0KCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdwYWdlJywgb1NldHRpbmdzKTsKCQkJCgkJCXJldHVybiBpT2xkU3RhcnQgIT0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0OwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdGhlIHByb2Nlc3Npbmcgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBQcm9jZXNzaW5nIGVsZW1lbnQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBuUHJvY2Vzc2luZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCQoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuciApCgkJCXsKCQkJCW5Qcm9jZXNzaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcHJvY2Vzc2luZyc7CgkJCX0KCQkJblByb2Nlc3NpbmcuaW5uZXJIVE1MID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zUHJvY2Vzc2luZzsKCQkJblByb2Nlc3NpbmcuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNQcm9jZXNzaW5nOwoJCQlvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBuUHJvY2Vzc2luZywgb1NldHRpbmdzLm5UYWJsZSApOwoJCQkKCQkJcmV0dXJuIG5Qcm9jZXNzaW5nOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBEaXNwbGF5IG9yIGhpZGUgdGhlIHByb2Nlc3NpbmcgaW5kaWNhdG9yCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU2hvdyBTaG93IHRoZSBwcm9jZXNzaW5nIGluZGljYXRvciAodHJ1ZSkgb3Igbm90IChmYWxzZSkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkgKCBvU2V0dGluZ3MsIGJTaG93ICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCXsKCQkJCXZhciBhbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5yOwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFuW2ldLnN0eWxlLnZpc2liaWxpdHkgPSBiU2hvdyA/ICJ2aXNpYmxlIiA6ICJoaWRkZW4iOwoJCQkJfQoJCQl9CgkJCgkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigncHJvY2Vzc2luZycsIFtvU2V0dGluZ3MsIGJTaG93XSk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhbnkgY29udHJvbCBlbGVtZW50cyBmb3IgdGhlIHRhYmxlIC0gc3BlY2lmaWNhbGx5IHNjcm9sbGluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sVGFibGUgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogQ2hlY2sgaWYgc2Nyb2xsaW5nIGlzIGVuYWJsZWQgb3Igbm90IC0gaWYgbm90IHRoZW4gbGVhdmUgdGhlIERPTSB1bmFsdGVyZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCA9PT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuIG9TZXR0aW5ncy5uVGFibGU7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIFRoZSBIVE1MIHN0cnVjdHVyZSB0aGF0IHdlIHdhbnQgdG8gZ2VuZXJhdGUgaW4gdGhpcyBmdW5jdGlvbiBpczoKCQkJICogIGRpdiAtIG5TY3JvbGxlcgoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsSGVhZAoJCQkgKiAgICAgIGRpdiAtIG5TY3JvbGxIZWFkSW5uZXIKCQkJICogICAgICAgIHRhYmxlIC0gblNjcm9sbEhlYWRUYWJsZQoJCQkgKiAgICAgICAgICB0aGVhZCAtIG5UaGVhZAoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsQm9keQoJCQkgKiAgICAgIHRhYmxlIC0gb1NldHRpbmdzLm5UYWJsZQoJCQkgKiAgICAgICAgdGhlYWQgLSBuVGhlYWRTaXplCgkJCSAqICAgICAgICB0Ym9keSAtIG5UYm9keQoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsRm9vdAoJCQkgKiAgICAgIGRpdiAtIG5TY3JvbGxGb290SW5uZXIKCQkJICogICAgICAgIHRhYmxlIC0gblNjcm9sbEZvb3RUYWJsZQoJCQkgKiAgICAgICAgICB0Zm9vdCAtIG5UZm9vdAoJCQkgKi8KCQkJdmFyCgkJCSAJblNjcm9sbGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsSGVhZElubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsRm9vdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxGb290SW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsSGVhZFRhYmxlID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoZmFsc2UpLAoJCQkgCW5TY3JvbGxGb290VGFibGUgPSBvU2V0dGluZ3MublRhYmxlLmNsb25lTm9kZShmYWxzZSksCgkJCQluVGhlYWQgPSBvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpWzBdLAoJCQkgCW5UZm9vdCA9IG9TZXR0aW5ncy5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290JykubGVuZ3RoID09PSAwID8gbnVsbCA6IAoJCQkJCW9TZXR0aW5ncy5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290JylbMF0sCgkJCQlvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCgkJCW5TY3JvbGxIZWFkLmFwcGVuZENoaWxkKCBuU2Nyb2xsSGVhZElubmVyICk7CgkJCW5TY3JvbGxGb290LmFwcGVuZENoaWxkKCBuU2Nyb2xsRm9vdElubmVyICk7CgkJCW5TY3JvbGxCb2R5LmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWQgKTsKCQkJblNjcm9sbGVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsQm9keSApOwoJCQluU2Nyb2xsSGVhZElubmVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsSGVhZFRhYmxlICk7CgkJCW5TY3JvbGxIZWFkVGFibGUuYXBwZW5kQ2hpbGQoIG5UaGVhZCApOwoJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEZvb3QgKTsKCQkJCW5TY3JvbGxGb290SW5uZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxGb290VGFibGUgKTsKCQkJCW5TY3JvbGxGb290VGFibGUuYXBwZW5kQ2hpbGQoIG5UZm9vdCApOwoJCQl9CgkJCQoJCQluU2Nyb2xsZXIuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbFdyYXBwZXI7CgkJCW5TY3JvbGxIZWFkLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxIZWFkOwoJCQluU2Nyb2xsSGVhZElubmVyLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxIZWFkSW5uZXI7CgkJCW5TY3JvbGxCb2R5LmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxCb2R5OwoJCQluU2Nyb2xsRm9vdC5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsRm9vdDsKCQkJblNjcm9sbEZvb3RJbm5lci5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsRm9vdElubmVyOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iQXV0b0NzcyApCgkJCXsKCQkJCW5TY3JvbGxIZWFkLnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CgkJCQluU2Nyb2xsRm9vdC5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byI7CgkJCX0KCQkJCgkJCW5TY3JvbGxIZWFkLnN0eWxlLmJvcmRlciA9ICIwIjsKCQkJblNjcm9sbEhlYWQuc3R5bGUud2lkdGggPSAiMTAwJSI7CgkJCW5TY3JvbGxGb290LnN0eWxlLmJvcmRlciA9ICIwIjsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS53aWR0aCA9ICIxNTAlIjsgLyogd2lsbCBiZSBvdmVyd3JpdHRlbiAqLwoJCQkKCQkJLyogTW9kaWZ5IGF0dHJpYnV0ZXMgdG8gcmVzcGVjdCB0aGUgY2xvbmVzICovCgkJCW5TY3JvbGxIZWFkVGFibGUucmVtb3ZlQXR0cmlidXRlKCdpZCcpOwoJCQluU2Nyb2xsSGVhZFRhYmxlLnN0eWxlLm1hcmdpbkxlZnQgPSAiMCI7CgkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUubWFyZ2luTGVmdCA9ICIwIjsKCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTsKCQkJCW5TY3JvbGxGb290VGFibGUuc3R5bGUubWFyZ2luTGVmdCA9ICIwIjsKCQkJfQoJCQkKCQkJLyogTW92ZSBhbnkgY2FwdGlvbiBlbGVtZW50cyBmcm9tIHRoZSBib2R5IHRvIHRoZSBoZWFkZXIgKi8KCQkJdmFyIG5DYXB0aW9ucyA9ICQob1NldHRpbmdzLm5UYWJsZSkuY2hpbGRyZW4oJ2NhcHRpb24nKTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uQ2FwdGlvbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJblNjcm9sbEhlYWRUYWJsZS5hcHBlbmRDaGlsZCggbkNhcHRpb25zW2ldICk7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIFNpemluZwoJCQkgKi8KCQkJLyogV2hlbiB4c2Nyb2xsaW5nIGFkZCB0aGUgd2lkdGggYW5kIGEgc2Nyb2xsZXIgdG8gbW92ZSB0aGUgaGVhZGVyIHdpdGggdGhlIGJvZHkgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCApOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb1NldHRpbmdzLm9TY3JvbGwuc1ggKTsKCQkJCQoJCQkJaWYgKCBuVGZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICk7CQoJCQkJfQoJCQkJCgkJCQkvKiBXaGVuIHRoZSBib2R5IGlzIHNjcm9sbGVkLCB0aGVuIHdlIGFsc28gd2FudCB0byBzY3JvbGwgdGhlIGhlYWRlcnMgKi8KCQkJCSQoblNjcm9sbEJvZHkpLnNjcm9sbCggZnVuY3Rpb24gKGUpIHsKCQkJCQluU2Nyb2xsSGVhZC5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0OwoJCQkJCQoJCQkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCW5TY3JvbGxGb290LnNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBXaGVuIHlzY3JvbGxpbmcsIGFkZCB0aGUgaGVpZ2h0ICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICk7CgkJCX0KCQkJCgkJCS8qIFJlZHJhdyAtIGFsaWduIGNvbHVtbnMgYWNyb3NzIHRoZSB0YWJsZXMgKi8KCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCSJmbiI6IF9mblNjcm9sbERyYXcsCgkJCQkic05hbWUiOiAic2Nyb2xsaW5nIgoJCQl9ICk7CgkJCQoJCQkvKiBJbmZpbml0ZSBzY3JvbGxpbmcgZXZlbnQgaGFuZGxlcnMgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoIGZ1bmN0aW9uKCkgewoJCQkJCS8qIFVzZSBhIGJsb2NrZXIgdG8gc3RvcCBzY3JvbGxpbmcgZnJvbSBsb2FkaW5nIG1vcmUgZGF0YSB3aGlsZSBvdGhlciBkYXRhIGlzIHN0aWxsIGxvYWRpbmcgKi8KCQkJCQlpZiAoICFvU2V0dGluZ3MuYkRyYXdpbmcgJiYgJCh0aGlzKS5zY3JvbGxUb3AoKSAhPT0gMCApCgkJCQkJewoJCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgbG9hZCB0aGUgbmV4dCBkYXRhIHNldCAqLwoJCQkJCQlpZiAoICQodGhpcykuc2Nyb2xsVG9wKCkgKyAkKHRoaXMpLmhlaWdodCgpID4gCgkJCQkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmhlaWdodCgpIC0gb1NldHRpbmdzLm9TY3JvbGwuaUxvYWRHYXAgKQoJCQkJCQl7CgkJCQkJCQkvKiBPbmx5IGRvIHRoZSByZWRyYXcgaWYgd2UgaGF2ZSB0byAtIHdlIG1pZ2h0IGJlIGF0IHRoZSBlbmQgb2YgdGhlIGRhdGEgKi8KCQkJCQkJCWlmICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAnbmV4dCcgKTsKCQkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfSApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MublNjcm9sbEhlYWQgPSBuU2Nyb2xsSGVhZDsKCQkJb1NldHRpbmdzLm5TY3JvbGxGb290ID0gblNjcm9sbEZvb3Q7CgkJCQoJCQlyZXR1cm4gblNjcm9sbGVyOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBVcGRhdGUgdGhlIHZhcmlvdXMgdGFibGVzIGZvciByZXNpemluZy4gSXQncyBhIGJpdCBvZiBhIHBpZyB0aGlzIGZ1bmN0aW9uLCBidXQKCQkgKiBiYXNpY2FsbHkgdGhlIGlkZWEgdG86CgkJICogICAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCSAqICAgMi4gVGFrZSBsaXZlIG1lYXN1cmVtZW50cyBmcm9tIHRoZSBET00KCQkgKiAgIDMuIEFwcGx5IHRoZSBtZWFzdXJlbWVudHMKCQkgKiAgIDQuIENsZWFuIHVwCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbERyYXcgKCBvICkKCQl7CgkJCXZhcgoJCQkJblNjcm9sbEhlYWRJbm5lciA9IG8ublNjcm9sbEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdLAoJCQkJblNjcm9sbEhlYWRUYWJsZSA9IG5TY3JvbGxIZWFkSW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0sCgkJCQluU2Nyb2xsQm9keSA9IG8ublRhYmxlLnBhcmVudE5vZGUsCgkJCQlpLCBpTGVuLCBqLCBqTGVuLCBhbkhlYWRUb1NpemUsIGFuSGVhZFNpemVycywgYW5Gb290U2l6ZXJzLCBhbkZvb3RUb1NpemUsIG9TdHlsZSwgaVZpcywKCQkJCWlXaWR0aCwgYUFwcGxpZWQ9W10sIGlTYW5pdHlXaWR0aCwKCQkJCW5TY3JvbGxGb290SW5uZXIgPSAoby5uVEZvb3QgIT09IG51bGwpID8gby5uU2Nyb2xsRm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZGl2JylbMF0gOiBudWxsLAoJCQkJblNjcm9sbEZvb3RUYWJsZSA9IChvLm5URm9vdCAhPT0gbnVsbCkgPyBuU2Nyb2xsRm9vdElubmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0YWJsZScpWzBdIDogbnVsbCwKCQkJCWllNjcgPSAkLmJyb3dzZXIubXNpZSAmJiAkLmJyb3dzZXIudmVyc2lvbiA8PSA3OwoJCQkKCQkJLyoKCQkJICogMS4gUmUtY3JlYXRlIHRoZSB0YWJsZSBpbnNpZGUgdGhlIHNjcm9sbGluZyBkaXYKCQkJICovCgkJCQoJCQkvKiBSZW1vdmUgdGhlIG9sZCBtaW5pbWlzZWQgdGhlYWQgYW5kIHRmb290IGVsZW1lbnRzIGluIHRoZSBpbm5lciB0YWJsZSAqLwoJCQl2YXIgblRoZWFkU2l6ZSA9IG8ublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpOwoJCQlpZiAoIG5UaGVhZFNpemUubGVuZ3RoID4gMCApCgkJCXsKCQkJCW8ublRhYmxlLnJlbW92ZUNoaWxkKCBuVGhlYWRTaXplWzBdICk7CgkJCX0KCQkJCgkJCXZhciBuVGZvb3RTaXplOwoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJLyogUmVtb3ZlIHRoZSBvbGQgbWluaW1pc2VkIGZvb3RlciBlbGVtZW50IGluIHRoZSBjbG9uZWQgaGVhZGVyICovCgkJCQluVGZvb3RTaXplID0gby5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290Jyk7CgkJCQlpZiAoIG5UZm9vdFNpemUubGVuZ3RoID4gMCApCgkJCQl7CgkJCQkJby5uVGFibGUucmVtb3ZlQ2hpbGQoIG5UZm9vdFNpemVbMF0gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogQ2xvbmUgdGhlIGN1cnJlbnQgaGVhZGVyIGFuZCBmb290ZXIgZWxlbWVudHMgYW5kIHRoZW4gcGxhY2UgaXQgaW50byB0aGUgaW5uZXIgdGFibGUgKi8KCQkJblRoZWFkU2l6ZSA9IG8ublRIZWFkLmNsb25lTm9kZSh0cnVlKTsKCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGhlYWRTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzBdICk7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJblRmb290U2l6ZSA9IG8ublRGb290LmNsb25lTm9kZSh0cnVlKTsKCQkJCW8ublRhYmxlLmluc2VydEJlZm9yZSggblRmb290U2l6ZSwgby5uVGFibGUuY2hpbGROb2Rlc1sxXSApOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiAyLiBUYWtlIGxpdmUgbWVhc3VyZW1lbnRzIGZyb20gdGhlIERPTSAtIGRvIG5vdCBhbHRlciB0aGUgRE9NIGl0c2VsZiEKCQkJICovCgkJCQoJCQkvKiBSZW1vdmUgb2xkIHNpemluZyBhbmQgYXBwbHkgdGhlIGNhbGN1bGF0ZWQgY29sdW1uIHdpZHRocwoJCQkgKiBHZXQgdGhlIHVuaXF1ZSBjb2x1bW4gaGVhZGVycyBpbiB0aGUgbmV3bHkgY3JlYXRlZCAoY2xvbmVkKSBoZWFkZXIuIFdlIHdhbnQgdG8gYXBwbHkgdGhlCgkJCSAqIGNhbGNsYXRlZCBzaXplcyB0byB0aGlzIGhlYWRlcgoJCQkgKi8KCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSAnMTAwJSc7CgkJCX0KCQkJCgkJCXZhciBuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvLCBuVGhlYWRTaXplICk7CgkJCWZvciAoIGk9MCwgaUxlbj1uVGhzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlWaXMgPSBfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCggbywgaSApOwoJCQkJblRoc1tpXS5zdHlsZS53aWR0aCA9IG8uYW9Db2x1bW5zW2lWaXNdLnNXaWR0aDsKCQkJfQoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24obikgewoJCQkJCW4uc3R5bGUud2lkdGggPSAiIjsKCQkJCX0sIG5UZm9vdFNpemUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJykgKTsKCQkJfQoJCQkKCQkJLyogU2l6ZSB0aGUgdGFibGUgYXMgYSB3aG9sZSAqLwoJCQlpU2FuaXR5V2lkdGggPSAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCk7CgkJCWlmICggby5vU2Nyb2xsLnNYID09PSAiIiApCgkJCXsKCQkJCS8qIE5vIHggc2Nyb2xsaW5nICovCgkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9ICIxMDAlIjsKCQkJCQoJCQkJLyogSSBrbm93IHRoaXMgaXMgcnViYmlzaCAtIGJ1dCBJRTcgd2lsbCBtYWtlIHRoZSB3aWR0aCBvZiB0aGUgdGFibGUgd2hlbiAxMDAlIGluY2x1ZGUKCQkJCSAqIHRoZSBzY3JvbGxiYXIgLSB3aGljaCBpcyBzaG91bGRuJ3QuIFdoZW4gdGhlcmUgaXMgYSBzY3JvbGxiYXIgd2UgbmVlZCB0byB0YWtlIHRoaXMKCQkJCSAqIGludG8gYWNjb3VudC4KCQkJCSAqLwoJCQkJaWYgKCBpZTY3ICYmICgkKCd0Ym9keScsIG5TY3JvbGxCb2R5KS5oZWlnaHQoKSA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikgICkKCQkJCXsKCQkJCQlvLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCktby5vU2Nyb2xsLmlCYXJXaWR0aCApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaWYgKCBvLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCS8qIHggc2Nyb2xsIGlubmVyIGhhcyBiZWVuIGdpdmVuIC0gdXNlIGl0ICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvLm9TY3JvbGwuc1hJbm5lcik7CgkJCQl9CgkJCQllbHNlIGlmICggaVNhbml0eVdpZHRoID09ICQoblNjcm9sbEJvZHkpLndpZHRoKCkgJiYKCQkJCSAgICQoblNjcm9sbEJvZHkpLmhlaWdodCgpIDwgJChvLm5UYWJsZSkuaGVpZ2h0KCkgKQoJCQkJewoJCQkJCS8qIFRoZXJlIGlzIHktc2Nyb2xsaW5nIC0gdHJ5IHRvIHRha2UgYWNjb3VudCBvZiB0aGUgeSBzY3JvbGwgYmFyICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCQlpZiAoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSA+IGlTYW5pdHlXaWR0aC1vLm9TY3JvbGwuaUJhcldpZHRoICkKCQkJCQl7CgkJCQkJCS8qIE5vdCBwb3NzaWJsZSB0byB0YWtlIGFjY291bnQgb2YgaXQgKi8KCQkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIEFsbCBlbHNlIGZhaWxzICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlY2FsY3VsYXRlIHRoZSBzYW5pdHkgd2lkdGggLSBub3cgdGhhdCB3ZSd2ZSBhcHBsaWVkIHRoZSByZXF1aXJlZCB3aWR0aCwgYmVmb3JlIGl0IHdhcwoJCQkgKiBhIHRlbXBvcmFyeSB2YXJpYWJsZS4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIHRoZSBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaXMgZG9uZQoJCQkgKiBiZWZvcmUgdGhpcyB0YWJsZSBET00gaXMgY3JlYXRlZC4KCQkJICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJCgkJCS8qIFdlIHdhbnQgdGhlIGhpZGRlbiBoZWFkZXIgdG8gaGF2ZSB6ZXJvIGhlaWdodCwgc28gcmVtb3ZlIHBhZGRpbmcgYW5kIGJvcmRlcnMuIFRoZW4KCQkJICogc2V0IHRoZSB3aWR0aCBiYXNlZCBvbiB0aGUgcmVhbCBoZWFkZXJzCgkJCSAqLwoJCQlhbkhlYWRUb1NpemUgPSBvLm5USGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJYW5IZWFkU2l6ZXJzID0gblRoZWFkU2l6ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJCgkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBuVG9TaXplKSB7CgkJCQlvU3R5bGUgPSBuU2l6ZXIuc3R5bGU7CgkJCQlvU3R5bGUucGFkZGluZ1RvcCA9ICIwIjsKCQkJCW9TdHlsZS5wYWRkaW5nQm90dG9tID0gIjAiOwoJCQkJb1N0eWxlLmJvcmRlclRvcFdpZHRoID0gIjAiOwoJCQkJb1N0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gIjAiOwoJCQkJb1N0eWxlLmhlaWdodCA9IDA7CgkJCQkKCQkJCWlXaWR0aCA9ICQoblNpemVyKS53aWR0aCgpOwoJCQkJblRvU2l6ZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCWFBcHBsaWVkLnB1c2goIGlXaWR0aCApOwoJCQl9LCBhbkhlYWRTaXplcnMsIGFuSGVhZFRvU2l6ZSApOwoJCQkkKGFuSGVhZFNpemVycykuaGVpZ2h0KDApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCS8qIENsb25lIHRoZSBjdXJyZW50IGZvb3RlciBhbmQgdGhlbiBwbGFjZSBpdCBpbnRvIHRoZSBib2R5IHRhYmxlIGFzIGEgImhpZGRlbiBoZWFkZXIiICovCgkJCQlhbkZvb3RTaXplcnMgPSBuVGZvb3RTaXplLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQkJYW5Gb290VG9TaXplID0gby5uVEZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCQkKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBuVG9TaXplKSB7CgkJCQkJb1N0eWxlID0gblNpemVyLnN0eWxlOwoJCQkJCW9TdHlsZS5wYWRkaW5nVG9wID0gIjAiOwoJCQkJCW9TdHlsZS5wYWRkaW5nQm90dG9tID0gIjAiOwoJCQkJCW9TdHlsZS5ib3JkZXJUb3BXaWR0aCA9ICIwIjsKCQkJCQlvU3R5bGUuYm9yZGVyQm90dG9tV2lkdGggPSAiMCI7CgkJCQkJb1N0eWxlLmhlaWdodCA9IDA7CgkJCQkJCgkJCQkJaVdpZHRoID0gJChuU2l6ZXIpLndpZHRoKCk7CgkJCQkJblRvU2l6ZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCQlhQXBwbGllZC5wdXNoKCBpV2lkdGggKTsKCQkJCX0sIGFuRm9vdFNpemVycywgYW5Gb290VG9TaXplICk7CgkJCQkkKGFuRm9vdFNpemVycykuaGVpZ2h0KDApOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiAzLiBBcHBseSB0aGUgbWVhc3VyZW1lbnRzCgkJCSAqLwoJCQkKCQkJLyogIkhpZGUiIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0aGF0IHdlIHVzZWQgZm9yIHRoZSBzaXppbmcuIFdlIHdhbnQgdG8gYWxzbyBmaXggdGhlaXIgd2lkdGgKCQkJICogdG8gd2hhdCB0aGV5IGN1cnJlbnRseSBhcmUKCQkJICovCgkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyKSB7CgkJCQluU2l6ZXIuaW5uZXJIVE1MID0gIiI7CgkJCQluU2l6ZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggYUFwcGxpZWQuc2hpZnQoKSApOwoJCQl9LCBhbkhlYWRTaXplcnMgKTsKCQkJCgkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplcikgewoJCQkJCW5TaXplci5pbm5lckhUTUwgPSAiIjsKCQkJCQluU2l6ZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggYUFwcGxpZWQuc2hpZnQoKSApOwoJCQkJfSwgYW5Gb290U2l6ZXJzICk7CgkJCX0KCQkJCgkJCS8qIFNhbml0eSBjaGVjayB0aGF0IHRoZSB0YWJsZSBpcyBvZiBhIHNlbnNpYmxlIHdpZHRoLiBJZiBub3QgdGhlbiB3ZSBhcmUgZ29pbmcgdG8gZ2V0CgkJCSAqIG1pc2FsaWdubWVudCAtIHRyeSB0byBwcmV2ZW50IHRoaXMgYnkgbm90IGFsbG93aW5nIHRoZSB0YWJsZSB0byBzaHJpbmsgYmVsb3cgaXRzIG1pbiB3aWR0aAoJCQkgKi8KCQkJaWYgKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgPCBpU2FuaXR5V2lkdGggKQoJCQl7CgkJCQkvKiBUaGUgbWluIHdpZHRoIGRlcGVuZHMgdXBvbiBpZiB3ZSBoYXZlIGEgdmVydGljYWwgc2Nyb2xsYmFyIHZpc2libGUgb3Igbm90ICovCgkJCQl2YXIgaUNvcnJlY3Rpb24gPSAoKG5TY3JvbGxCb2R5LnNjcm9sbEhlaWdodCA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikpID8KCQkJCQkJaVNhbml0eVdpZHRoK28ub1Njcm9sbC5pQmFyV2lkdGggOiBpU2FuaXR5V2lkdGg7CgkJCQkKCQkJCS8qIElFNi83IGFyZSBhIGxhdyB1bnRvIHRoZW1zZWx2ZXMuLi4gKi8KCQkJCWlmICggaWU2NyAmJiAoblNjcm9sbEJvZHkuc2Nyb2xsSGVpZ2h0ID4gCgkJCQkJblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8ICQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJCQoJCQkJLyogQXBwbHkgdGhlIGNhbGN1bGF0ZWQgbWluaW11bSB3aWR0aCB0byB0aGUgdGFibGUgd3JhcHBlcnMgKi8KCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaUNvcnJlY3Rpb24gKTsKCQkJCQoJCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJblNjcm9sbEZvb3RJbm5lci5wYXJlbnROb2RlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQl9CgkJCQkKCQkJCS8qIEFuZCBnaXZlIHRoZSB1c2VyIGEgd2FybmluZyB0aGF0IHdlJ3ZlIHN0b3BwZWQgdGhlIHRhYmxlIGdldHRpbmcgdG9vIHNtYWxsICovCgkJCQlpZiAoIG8ub1Njcm9sbC5zWCA9PT0gIiIgKQoJCQkJewoJCQkJCV9mbkxvZyggbywgMSwgIlRoZSB0YWJsZSBjYW5ub3QgZml0IGludG8gdGhlIGN1cnJlbnQgZWxlbWVudCB3aGljaCB3aWxsIGNhdXNlIGNvbHVtbiIrCgkJCQkJCSIgbWlzYWxpZ25tZW50LiBUaGUgdGFibGUgaGFzIGJlZW4gZHJhd24gYXQgaXRzIG1pbmltdW0gcG9zc2libGUgd2lkdGguIiApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG8ub1Njcm9sbC5zWElubmVyICE9PSAiIiApCgkJCQl7CgkJCQkJX2ZuTG9nKCBvLCAxLCAiVGhlIHRhYmxlIGNhbm5vdCBmaXQgaW50byB0aGUgY3VycmVudCBlbGVtZW50IHdoaWNoIHdpbGwgY2F1c2UgY29sdW1uIisKCQkJCQkJIiBtaXNhbGlnbm1lbnQuIEluY3JlYXNlIHRoZSBzU2Nyb2xsWElubmVyIHZhbHVlIG9yIHJlbW92ZSBpdCB0byBhbGxvdyBhdXRvbWF0aWMiKwoJCQkJCQkiIGNhbGN1bGF0aW9uIiApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290SW5uZXIucGFyZW50Tm9kZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAnMTAwJScgKTsKCQkJCX0KCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIDQuIENsZWFuIHVwCgkJCSAqLwoJCQlpZiAoIG8ub1Njcm9sbC5zWSA9PT0gIiIgKQoJCQl7CgkJCQkvKiBJRTc8IHB1dHMgYSB2ZXJ0aWNhbCBzY3JvbGxiYXIgaW4gcGxhY2UgKHdoZW4gaXQgc2hvdWxkbid0IGJlKSBkdWUgdG8gc3VidHJhY3RpbmcKCQkJCSAqIHRoZSBzY3JvbGxiYXIgaGVpZ2h0IGZyb20gdGhlIHZpc2libGUgZGlzcGxheSwgcmF0aGVyIHRoYW4gYWRkaW5nIGl0IG9uLiBXZSBuZWVkIHRvCgkJCQkgKiBzZXQgdGhlIGhlaWdodCBpbiBvcmRlciB0byBzb3J0IHRoaXMuIERvbid0IHdhbnQgdG8gZG8gaXQgaW4gYW55IG90aGVyIGJyb3dzZXJzLgoJCQkJICovCgkJCQlpZiAoIGllNjcgKQoJCQkJewoJCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQrby5vU2Nyb2xsLmlCYXJXaWR0aCApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG8ub1Njcm9sbC5zWSAhPT0gIiIgJiYgby5vU2Nyb2xsLmJDb2xsYXBzZSApCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm9TY3JvbGwuc1kgKTsKCQkJCQoJCQkJdmFyIGlFeHRyYSA9IChvLm9TY3JvbGwuc1ggIT09ICIiICYmIG8ublRhYmxlLm9mZnNldFdpZHRoID4gblNjcm9sbEJvZHkub2Zmc2V0V2lkdGgpID8KCQkJCSAJby5vU2Nyb2xsLmlCYXJXaWR0aCA6IDA7CgkJCQlpZiAoIG8ublRhYmxlLm9mZnNldEhlaWdodCA8IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCApCgkJCQl7CgkJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoICQoby5uVGFibGUpLmhlaWdodCgpK2lFeHRyYSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBGaW5hbGx5IHNldCB0aGUgd2lkdGgncyBvZiB0aGUgaGVhZGVyIGFuZCBmb290ZXIgdGFibGVzICovCgkJCXZhciBpT3V0ZXJXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJblNjcm9sbEhlYWRUYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQluU2Nyb2xsSGVhZElubmVyLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJblNjcm9sbEZvb3RJbm5lci5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRXaWR0aCApOwoJCQkJblNjcm9sbEZvb3RUYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRXaWR0aCApOwoJCQl9CgkJCQoJCQkvKiBJZiBzb3J0aW5nIG9yIGZpbHRlcmluZyBoYXMgb2NjdXJyZWQsIGp1bXAgdGhlIHNjcm9sbGluZyBiYWNrIHRvIHRoZSB0b3AgKi8KCQkJaWYgKCBvLmJTb3J0ZWQgfHwgby5iRmlsdGVyZWQgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zY3JvbGxUb3AgPSAwOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFwcGx5IGEgZ2l2ZW4gZnVuY3Rpb24gdG8gdGhlIGRpc3BsYXkgY2hpbGQgbm9kZXMgb2YgYW4gZWxlbWVudCBhcnJheSAodHlwaWNhbGx5CgkJICogVEQgY2hpbGRyZW4gb2YgVFIgcm93cwoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBmbiBNZXRob2QgdG8gYXBwbHkgdG8gdGhlIG9iamVjdHMKCQkgKiAgQHBhcmFtIGFycmF5IHtub2Rlc30gYW4xIExpc3Qgb2YgZWxlbWVudHMgdG8gbG9vayB0aHJvdWdoIGZvciBkaXNwbGF5IGNoaWxkcmVuCgkJICogIEBwYXJhbSBhcnJheSB7bm9kZXN9IGFuMiBBbm90aGVyIGxpc3QgKGlkZW50aWNhbCBzdHJ1Y3R1cmUgdG8gdGhlIGZpcnN0KSAtIG9wdGlvbmFsCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFwcGx5VG9DaGlsZHJlbiggZm4sIGFuMSwgYW4yICkKCQl7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YW4xLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAsIGpMZW49YW4xW2ldLmNoaWxkTm9kZXMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpZiAoIGFuMVtpXS5jaGlsZE5vZGVzW2pdLm5vZGVUeXBlID09IDEgKQoJCQkJCXsKCQkJCQkJaWYgKCBhbjIgKQoJCQkJCQl7CgkJCQkJCQlmbiggYW4xW2ldLmNoaWxkTm9kZXNbal0sIGFuMltpXS5jaGlsZE5vZGVzW2pdICk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlmbiggYW4xW2ldLmNoaWxkTm9kZXNbal0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBDb252ZXJ0IGEgQ1NTIHVuaXQgd2lkdGggdG8gcGl4ZWxzIChlLmcuIDJlbSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNXaWR0aCB3aWR0aCB0byBiZSBjb252ZXJ0ZWQKCQkgKiAgQHBhcmFtIHtub2RlfSBuUGFyZW50IHBhcmVudCB0byBnZXQgdGhlIHdpdGggZm9yIChyZXF1aXJlZCBmb3IgcmVsYXRpdmUgd2lkdGhzKSAtIG9wdGlvbmFsCgkJICogIEByZXR1cm5zIHtpbnR9IGlXaWR0aCB3aWR0aCBpbiBwaXhlbHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ29udmVydFRvV2lkdGggKCBzV2lkdGgsIG5QYXJlbnQgKQoJCXsKCQkJaWYgKCAhc1dpZHRoIHx8IHNXaWR0aCA9PT0gbnVsbCB8fCBzV2lkdGggPT09ICcnICkKCQkJewoJCQkJcmV0dXJuIDA7CgkJCX0KCQkJCgkJCWlmICggIW5QYXJlbnQgKQoJCQl7CgkJCQluUGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTsKCQkJfQoJCQkKCQkJdmFyIGlXaWR0aDsKCQkJdmFyIG5UbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApOwoJCQluVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHNXaWR0aCApOwoJCQkKCQkJblBhcmVudC5hcHBlbmRDaGlsZCggblRtcCApOwoJCQlpV2lkdGggPSBuVG1wLm9mZnNldFdpZHRoOwoJCQluUGFyZW50LnJlbW92ZUNoaWxkKCBuVG1wICk7CgkJCQoJCQlyZXR1cm4gKCBpV2lkdGggKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQ2FsY3VsYXRlIHRoZSB3aWR0aCBvZiBjb2x1bW5zIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DYWxjdWxhdGVDb2x1bW5XaWR0aHMgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGlUYWJsZVdpZHRoID0gb1NldHRpbmdzLm5UYWJsZS5vZmZzZXRXaWR0aDsKCQkJdmFyIGlVc2VySW5wdXRzID0gMDsKCQkJdmFyIGlUbXBXaWR0aDsKCQkJdmFyIGlWaXNpYmxlQ29sdW1ucyA9IDA7CgkJCXZhciBpQ29sdW1zID0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGg7CgkJCXZhciBpLCBpSW5kZXgsIGlDb3JyZWN0b3IsIGlXaWR0aDsKCQkJdmFyIG9IZWFkZXJzID0gJCgndGgnLCBvU2V0dGluZ3MublRIZWFkKTsKCQkJdmFyIHdpZHRoQXR0ciA9IG9TZXR0aW5ncy5uVGFibGUuZ2V0QXR0cmlidXRlKCd3aWR0aCcpOwoJCQkKCQkJLyogQ29udmVydCBhbnkgdXNlciBpbnB1dCBzaXplcyBpbnRvIHBpeGVsIHNpemVzICovCgkJCWZvciAoIGk9MCA7IGk8aUNvbHVtcyA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQl7CgkJCQkJaVZpc2libGVDb2x1bW5zKys7CgkJCQkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQlpVG1wV2lkdGggPSBfZm5Db252ZXJ0VG9XaWR0aCggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGhPcmlnLCAKCQkJCQkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZSApOwoJCQkJCQlpZiAoIGlUbXBXaWR0aCAhPT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUbXBXaWR0aCApOwoJCQkJCQl9CgkJCQkJCQkKCQkJCQkJaVVzZXJJbnB1dHMrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIElmIHRoZSBudW1iZXIgb2YgY29sdW1ucyBpbiB0aGUgRE9NIGVxdWFscyB0aGUgbnVtYmVyIHRoYXQgd2UgaGF2ZSB0byBwcm9jZXNzIGluIAoJCQkgKiBEYXRhVGFibGVzLCB0aGVuIHdlIGNhbiB1c2UgdGhlIG9mZnNldHMgdGhhdCBhcmUgY3JlYXRlZCBieSB0aGUgd2ViLWJyb3dzZXIuIE5vIGN1c3RvbSAKCQkJICogc2l6ZXMgY2FuIGJlIHNldCBpbiBvcmRlciBmb3IgdGhpcyB0byBoYXBwZW4sIG5vciBzY3JvbGxpbmcgdXNlZAoJCQkgKi8KCQkJaWYgKCBpQ29sdW1zID09IG9IZWFkZXJzLmxlbmd0aCAmJiBpVXNlcklucHV0cyA9PT0gMCAmJiBpVmlzaWJsZUNvbHVtbnMgPT0gaUNvbHVtcyAmJgoJCQkJb1NldHRpbmdzLm9TY3JvbGwuc1ggPT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNZID09PSAiIiApCgkJCXsKCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlUbXBXaWR0aCA9ICQob0hlYWRlcnNbaV0pLndpZHRoKCk7CgkJCQkJaWYgKCBpVG1wV2lkdGggIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRtcFdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogT3RoZXJ3aXNlIHdlIGFyZSBnb2luZyB0byBoYXZlIHRvIGRvIHNvbWUgY2FsY3VsYXRpb25zIHRvIGdldCB0aGUgd2lkdGggb2YgZWFjaCBjb2x1bW4uCgkJCQkgKiBDb25zdHJ1Y3QgYSAxIHJvdyB0YWJsZSB3aXRoIHRoZSB3aWRlc3Qgbm9kZSBpbiB0aGUgZGF0YSwgYW5kIGFueSB1c2VyIGRlZmluZWQgd2lkdGhzLAoJCQkJICogdGhlbiBpbnNlcnQgaXQgaW50byB0aGUgRE9NIGFuZCBhbGxvdyB0aGUgYnJvd3NlciB0byBkbyBhbGwgdGhlIGhhcmQgd29yayBvZgoJCQkJICogY2FsY3VsYXRpbmcgdGFibGUgd2lkdGhzLgoJCQkJICovCgkJCQl2YXIKCQkJCQluQ2FsY1RtcCA9IG9TZXR0aW5ncy5uVGFibGUuY2xvbmVOb2RlKCBmYWxzZSApLAoJCQkJCW5UaGVhZENsb25lID0gb1NldHRpbmdzLm5USGVhZC5jbG9uZU5vZGUodHJ1ZSksCgkJCQkJbkJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGJvZHknICksCgkJCQkJblRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RyJyApLAoJCQkJCW5EaXZTaXppbmc7CgkJCQkKCQkJCW5DYWxjVG1wLnJlbW92ZUF0dHJpYnV0ZSggImlkIiApOwoJCQkJbkNhbGNUbXAuYXBwZW5kQ2hpbGQoIG5UaGVhZENsb25lICk7CgkJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5DYWxjVG1wLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRGb290LmNsb25lTm9kZSh0cnVlKSApOwoJCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24obikgewoJCQkJCQluLnN0eWxlLndpZHRoID0gIiI7CgkJCQkJfSwgbkNhbGNUbXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJykgKTsKCQkJCX0KCQkJCQoJCQkJbkNhbGNUbXAuYXBwZW5kQ2hpbGQoIG5Cb2R5ICk7CgkJCQluQm9keS5hcHBlbmRDaGlsZCggblRyICk7CgkJCQkKCQkJCS8qIFJlbW92ZSBhbnkgc2l6aW5nIHRoYXQgd2FzIHByZXZpb3VzbHkgYXBwbGllZCBieSB0aGUgc3R5bGVzICovCgkJCQl2YXIganFDb2xTaXppbmcgPSAkKCd0aGVhZCB0aCcsIG5DYWxjVG1wKTsKCQkJCWlmICgganFDb2xTaXppbmcubGVuZ3RoID09PSAwICkKCQkJCXsKCQkJCQlqcUNvbFNpemluZyA9ICQoJ3Rib2R5IHRyOmVxKDApPnRkJywgbkNhbGNUbXApOwoJCQkJfQoJCQoJCQkJLyogQXBwbHkgY3VzdG9tIHNpemluZyB0byB0aGUgY2xvbmVkIGhlYWRlciAqLwoJCQkJdmFyIG5UaHMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncywgblRoZWFkQ2xvbmUgKTsKCQkJCWlDb3JyZWN0b3IgPSAwOwoJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJCXsKCQkJCQl2YXIgb0NvbHVtbiA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV07CgkJCQkJaWYgKCBvQ29sdW1uLmJWaXNpYmxlICYmIG9Db2x1bW4uc1dpZHRoT3JpZyAhPT0gbnVsbCAmJiBvQ29sdW1uLnNXaWR0aE9yaWcgIT09ICIiICkKCQkJCQl7CgkJCQkJCW5UaHNbaS1pQ29ycmVjdG9yXS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvQ29sdW1uLnNXaWR0aE9yaWcgKTsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIG9Db2x1bW4uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJblRoc1tpLWlDb3JyZWN0b3JdLnN0eWxlLndpZHRoID0gIiI7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCgkJCQkvKiBGaW5kIHRoZSBiaWdnZXN0IHRkIGZvciBlYWNoIGNvbHVtbiBhbmQgcHV0IGl0IGludG8gdGhlIHRhYmxlICovCgkJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bXMgOyBpKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQl2YXIgblRkID0gX2ZuR2V0V2lkZXN0Tm9kZSggb1NldHRpbmdzLCBpICk7CgkJCQkJCWlmICggblRkICE9PSBudWxsICkKCQkJCQkJewoJCQkJCQkJblRkID0gblRkLmNsb25lTm9kZSh0cnVlKTsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ29udGVudFBhZGRpbmcgIT09ICIiICkKCQkJCQkJCXsKCQkJCQkJCQluVGQuaW5uZXJIVE1MICs9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NvbnRlbnRQYWRkaW5nOwoJCQkJCQkJfQoJCQkJCQkJblRyLmFwcGVuZENoaWxkKCBuVGQgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQnVpbGQgdGhlIHRhYmxlIGFuZCAnZGlzcGxheScgaXQgKi8KCQkJCXZhciBuV3JhcHBlciA9IG9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZTsKCQkJCW5XcmFwcGVyLmFwcGVuZENoaWxkKCBuQ2FsY1RtcCApOwoJCQkJCgkJCQkvKiBXaGVuIHNjcm9sbGluZyAoWCBvciBZKSB3ZSB3YW50IHRvIHNldCB0aGUgd2lkdGggb2YgdGhlIHRhYmxlIGFzIGFwcHJvcHJpYXRlLiBIb3dldmVyLAoJCQkJICogd2hlbiBub3Qgc2Nyb2xsaW5nIGxlYXZlIHRoZSB0YWJsZSB3aWR0aCBhcyBpdCBpcy4gVGhpcyByZXN1bHRzIGluIHNsaWdodGx5IGRpZmZlcmVudCwKCQkJCSAqIGJ1dCBJIHRoaW5rIGNvcnJlY3QgYmVoYXZpb3VyCgkJCQkgKi8KCQkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICYmIG9TZXR0aW5ncy5vU2Nyb2xsLnNYSW5uZXIgIT09ICIiICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKG9TZXR0aW5ncy5vU2Nyb2xsLnNYSW5uZXIpOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSAiIjsKCQkJCQlpZiAoICQobkNhbGNUbXApLndpZHRoKCkgPCBuV3JhcHBlci5vZmZzZXRXaWR0aCApCgkJCQkJewoJCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBuV3JhcHBlci5vZmZzZXRXaWR0aCApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG5XcmFwcGVyLm9mZnNldFdpZHRoICk7CgkJCQl9CgkJCQllbHNlIGlmICggd2lkdGhBdHRyICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCB3aWR0aEF0dHIgKTsKCQkJCX0KCQkJCW5DYWxjVG1wLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKCQkJCQoJCQkJLyogU2Nyb2xsaW5nIGNvbnNpZGVyYXRpb25zICovCgkJCQlfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCggb1NldHRpbmdzLCBuQ2FsY1RtcCApOwoJCQkJCgkJCQkvKiBSZWFkIHRoZSB3aWR0aCdzIGNhbGN1bGF0ZWQgYnkgdGhlIGJyb3dzZXIgYW5kIHN0b3JlIHRoZW0gZm9yIHVzZSBieSB0aGUgY2FsbGVyLiBXZQoJCQkJICogZmlyc3Qgb2YgYWxsIHRyeSB0byB1c2UgdGhlIGVsZW1lbnRzIGluIHRoZSBib2R5LCBidXQgaXQgaXMgcG9zc2libGUgdGhhdCB0aGVyZSBhcmUKCQkJCSAqIG5vIGVsZW1lbnRzIHRoZXJlLCB1bmRlciB3aGljaCBjaXJjdW1zdGFuY2VzIHdlIHVzZSB0aGUgaGVhZGVyIGVsZW1lbnRzCgkJCQkgKi8KCQkJCXZhciBvTm9kZXMgPSAkKCJ0Ym9keSB0cjplcSgwKSIsIG5DYWxjVG1wKS5jaGlsZHJlbigpOwoJCQkJaWYgKCBvTm9kZXMubGVuZ3RoID09PSAwICkKCQkJCXsKCQkJCQlvTm9kZXMgPSBfZm5HZXRVbmlxdWVUaHMoIG9TZXR0aW5ncywgJCgndGhlYWQnLCBuQ2FsY1RtcClbMF0gKTsKCQkJCX0KCQkKCQkJCS8qIEJyb3dzZXJzIG5lZWQgYSBiaXQgb2YgYSBoYW5kIHdoZW4gYSB3aWR0aCBpcyBhc3NpZ25lZCB0byBhbnkgY29sdW1ucyB3aGVuIAoJCQkJICogeC1zY3JvbGxpbmcgYXMgdGhleSB0ZW5kIHRvIGNvbGxhcHNlIHRoZSB0YWJsZSB0byB0aGUgbWluLXdpZHRoLCBldmVuIGlmCgkJCQkgKiB3ZSBzZW50IHRoZSBjb2x1bW4gd2lkdGhzLiBTbyB3ZSBuZWVkIHRvIGtlZXAgdHJhY2sgb2Ygd2hhdCB0aGUgdGFibGUgd2lkdGgKCQkJCSAqIHNob3VsZCBiZSBieSBzdW1taW5nIHRoZSB1c2VyIGdpdmVuIHZhbHVlcywgYW5kIHRoZSBhdXRvbWF0aWMgdmFsdWVzCgkJCQkgKi8KCQkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICkKCQkJCXsKCQkJCQl2YXIgaVRvdGFsID0gMDsKCQkJCQlpQ29ycmVjdG9yID0gMDsKCQkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJCXsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGhPcmlnID09PSBudWxsICkKCQkJCQkJCXsKCQkJCQkJCQlpVG90YWwgKz0gJChvTm9kZXNbaUNvcnJlY3Rvcl0pLm91dGVyV2lkdGgoKTsKCQkJCQkJCX0KCQkJCQkJCWVsc2UKCQkJCQkJCXsKCQkJCQkJCQlpVG90YWwgKz0gcGFyc2VJbnQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGgucmVwbGFjZSgncHgnLCcnKSwgMTApICsKCQkJCQkJCQkJKCQob05vZGVzW2lDb3JyZWN0b3JdKS5vdXRlcldpZHRoKCkgLSAkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkud2lkdGgoKSk7CgkJCQkJCQl9CgkJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRvdGFsICk7CgkJCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG90YWwgKTsKCQkJCX0KCQkKCQkJCWlDb3JyZWN0b3IgPSAwOwoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCWlXaWR0aCA9ICQob05vZGVzW2lDb3JyZWN0b3JdKS53aWR0aCgpOwoJCQkJCQlpZiAoIGlXaWR0aCAhPT0gbnVsbCAmJiBpV2lkdGggPiAwICkKCQkJCQkJewoJCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVdpZHRoICk7CgkJCQkJCX0KCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCX0KCQkJCX0KCQkKCQkJCXZhciBjc3NXaWR0aCA9ICQobkNhbGNUbXApLmNzcygnd2lkdGgnKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUud2lkdGggPSAoY3NzV2lkdGguaW5kZXhPZignJScpICE9PSAtMSkgPwoJCQkJICAgIGNzc1dpZHRoIDogX2ZuU3RyaW5nVG9Dc3MoICQobkNhbGNUbXApLm91dGVyV2lkdGgoKSApOwoJCQkJbkNhbGNUbXAucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggbkNhbGNUbXAgKTsKCQkJfQoJCQoJCQlpZiAoIHdpZHRoQXR0ciApCgkJCXsKCQkJCW9TZXR0aW5ncy5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggd2lkdGhBdHRyICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQWRqdXN0IGEgdGFibGUncyB3aWR0aCB0byB0YWtlIGFjY291bnQgb2Ygc2Nyb2xsaW5nCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuIHRhYmxlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QgKCBvU2V0dGluZ3MsIG4gKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCA9PT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJLyogV2hlbiB5LXNjcm9sbGluZyBvbmx5LCB3ZSB3YW50IHRvIHJlbW92ZSB0aGUgd2lkdGggb2YgdGhlIHNjcm9sbCBiYXIgc28gdGhlIHRhYmxlCgkJCQkgKiArIHNjcm9sbCBiYXIgd2lsbCBmaXQgaW50byB0aGUgYXJlYSBhdmFpYWxibGUuCgkJCQkgKi8KCQkJCXZhciBpT3JpZ1dpZHRoID0gJChuKS53aWR0aCgpOwoJCQkJbi5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAkKG4pLm91dGVyV2lkdGgoKS1vU2V0dGluZ3Mub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICkKCQkJewoJCQkJLyogV2hlbiB4LXNjcm9sbGluZyBib3RoIHdheXMsIGZpeCB0aGUgdGFibGUgYXQgaXQncyBjdXJyZW50IHNpemUsIHdpdGhvdXQgYWRqdXN0aW5nICovCgkJCQluLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICQobikub3V0ZXJXaWR0aCgpICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSB3aWRlc3Qgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpQ29sIGNvbHVtbiBvZiBpbnRlcmVzdAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBtYXggc3RybGVucyBmb3IgZWFjaCBjb2x1bW4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0V2lkZXN0Tm9kZSggb1NldHRpbmdzLCBpQ29sICkKCQl7CgkJCXZhciBpTWF4SW5kZXggPSBfZm5HZXRNYXhMZW5TdHJpbmcoIG9TZXR0aW5ncywgaUNvbCApOwoJCQlpZiAoIGlNYXhJbmRleCA8IDAgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQoJCQlpZiAoIG9TZXR0aW5ncy5hb0RhdGFbaU1heEluZGV4XS5uVHIgPT09IG51bGwgKQoJCQl7CgkJCQl2YXIgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CgkJCQluLmlubmVySFRNTCA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlNYXhJbmRleCwgaUNvbCwgJycgKTsKCQkJCXJldHVybiBuOwoJCQl9CgkJCXJldHVybiBfZm5HZXRUZE5vZGVzKG9TZXR0aW5ncywgaU1heEluZGV4KVtpQ29sXTsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBtYXhpbXVtIHN0cmxlbiBmb3IgZWFjaCBkYXRhIGNvbHVtbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpQ29sIGNvbHVtbiBvZiBpbnRlcmVzdAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBtYXggc3RybGVucyBmb3IgZWFjaCBjb2x1bW4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0TWF4TGVuU3RyaW5nKCBvU2V0dGluZ3MsIGlDb2wgKQoJCXsKCQkJdmFyIGlNYXggPSAtMTsKCQkJdmFyIGlNYXhJbmRleCA9IC0xOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQl2YXIgcyA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGksIGlDb2wsICdkaXNwbGF5JyApKyIiOwoJCQkJcyA9IHMucmVwbGFjZSggLzwuKj8+L2csICIiICk7CgkJCQlpZiAoIHMubGVuZ3RoID4gaU1heCApCgkJCQl7CgkJCQkJaU1heCA9IHMubGVuZ3RoOwoJCQkJCWlNYXhJbmRleCA9IGk7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBpTWF4SW5kZXg7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFwcGVuZCBhIENTUyB1bml0IChvbmx5IGlmIHJlcXVpcmVkKSB0byBhIHN0cmluZwoJCSAqICBAcGFyYW0ge2FycmF5fSBhQXJyYXkxIGZpcnN0IGFycmF5CgkJICogIEBwYXJhbSB7YXJyYXl9IGFBcnJheTIgc2Vjb25kIGFycmF5CgkJICogIEByZXR1cm5zIHtpbnR9IDAgaWYgbWF0Y2gsIDEgaWYgbGVuZ3RoIGlzIGRpZmZlcmVudCwgMiBpZiBubyBtYXRjaAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TdHJpbmdUb0NzcyggcyApCgkJewoJCQlpZiAoIHMgPT09IG51bGwgKQoJCQl7CgkJCQlyZXR1cm4gIjBweCI7CgkJCX0KCQkJCgkJCWlmICggdHlwZW9mIHMgPT0gJ251bWJlcicgKQoJCQl7CgkJCQlpZiAoIHMgPCAwICkKCQkJCXsKCQkJCQlyZXR1cm4gIjBweCI7CgkJCQl9CgkJCQlyZXR1cm4gcysicHgiOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBpZiB0aGUgbGFzdCBjaGFyYWN0ZXIgaXMgbm90IDAtOSAqLwoJCQl2YXIgYyA9IHMuY2hhckNvZGVBdCggcy5sZW5ndGgtMSApOwoJCQlpZiAoYyA8IDB4MzAgfHwgYyA+IDB4MzkpCgkJCXsKCQkJCXJldHVybiBzOwoJCQl9CgkJCXJldHVybiBzKyJweCI7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgd2lkdGggb2YgYSBzY3JvbGwgYmFyIGluIHRoaXMgYnJvd3NlciBiZWluZyB1c2VkCgkJICogIEByZXR1cm5zIHtpbnR9IHdpZHRoIGluIHBpeGVscwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TY3JvbGxCYXJXaWR0aCAoKQoJCXsgIAoJCQl2YXIgaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7CgkJCXZhciBzdHlsZSA9IGlubmVyLnN0eWxlOwoJCQlzdHlsZS53aWR0aCA9ICIxMDAlIjsKCQkJc3R5bGUuaGVpZ2h0ID0gIjIwMHB4IjsKCQkJc3R5bGUucGFkZGluZyA9ICIwcHgiOwoJCQkKCQkJdmFyIG91dGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCXN0eWxlID0gb3V0ZXIuc3R5bGU7CgkJCXN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKCQkJc3R5bGUudG9wID0gIjBweCI7CgkJCXN0eWxlLmxlZnQgPSAiMHB4IjsKCQkJc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwoJCQlzdHlsZS53aWR0aCA9ICIyMDBweCI7CgkJCXN0eWxlLmhlaWdodCA9ICIxNTBweCI7CgkJCXN0eWxlLnBhZGRpbmcgPSAiMHB4IjsKCQkJc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKCQkJb3V0ZXIuYXBwZW5kQ2hpbGQoaW5uZXIpOwoJCQkKCQkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdXRlcik7CgkJCXZhciB3MSA9IGlubmVyLm9mZnNldFdpZHRoOwoJCQlvdXRlci5zdHlsZS5vdmVyZmxvdyA9ICdzY3JvbGwnOwoJCQl2YXIgdzIgPSBpbm5lci5vZmZzZXRXaWR0aDsKCQkJaWYgKCB3MSA9PSB3MiApCgkJCXsKCQkJCXcyID0gb3V0ZXIuY2xpZW50V2lkdGg7CgkJCX0KCQkJCgkJCWRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3V0ZXIpOwoJCQlyZXR1cm4gKHcxIC0gdzIpOyAgCgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIENoYW5nZSB0aGUgb3JkZXIgb2YgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtib29sfSBiQXBwbHlDbGFzc2VzIG9wdGlvbmFsIC0gc2hvdWxkIHdlIGFwcGx5IGNsYXNzZXMgb3Igbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnQgKCBvU2V0dGluZ3MsIGJBcHBseUNsYXNzZXMgKQoJCXsKCQkJdmFyCgkJCQlpLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuLAoJCQkJc0RhdGFUeXBlLCBuVGgsCgkJCQlhYVNvcnQgPSBbXSwKCQkJIAlhaU9yaWcgPSBbXSwKCQkJCW9Tb3J0ID0gRGF0YVRhYmxlLmV4dC5vU29ydCwKCQkJCWFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGEsCgkJCQlhb0NvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLAoJCQkJb0FyaWEgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLm9BcmlhOwoJCQkKCQkJLyogTm8gc29ydGluZyByZXF1aXJlZCBpZiBzZXJ2ZXItc2lkZSBvciBubyBzb3J0aW5nIGFycmF5ICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgJiYgCgkJCQkob1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggIT09IDAgfHwgb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkICE9PSBudWxsKSApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkICE9PSBudWxsICkKCQkJCXsKCQkJCQlhYVNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJYWFTb3J0ID0gb1NldHRpbmdzLmFhU29ydGluZy5zbGljZSgpOwoJCQkJfQoJCQkJCgkJCQkvKiBJZiB0aGVyZSBpcyBhIHNvcnRpbmcgZGF0YSB0eXBlLCBhbmQgYSBmdWN0aW9uIGJlbG9uZ2luZyB0byBpdCwgdGhlbiB3ZSBuZWVkIHRvCgkJCQkgKiBnZXQgdGhlIGRhdGEgZnJvbSB0aGUgZGV2ZWxvcGVyJ3MgZnVuY3Rpb24gYW5kIGFwcGx5IGl0IGZvciB0aGlzIGNvbHVtbgoJCQkJICovCgkJCQlmb3IgKCBpPTAgOyBpPGFhU29ydC5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCXZhciBpQ29sdW1uID0gYWFTb3J0W2ldWzBdOwoJCQkJCXZhciBpVmlzQ29sdW1uID0gX2ZuQ29sdW1uSW5kZXhUb1Zpc2libGUoIG9TZXR0aW5ncywgaUNvbHVtbiApOwoJCQkJCXNEYXRhVHlwZSA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbIGlDb2x1bW4gXS5zU29ydERhdGFUeXBlOwoJCQkJCWlmICggRGF0YVRhYmxlLmV4dC5hZm5Tb3J0RGF0YVtzRGF0YVR5cGVdICkKCQkJCQl7CgkJCQkJCXZhciBhRGF0YSA9IERhdGFUYWJsZS5leHQuYWZuU29ydERhdGFbc0RhdGFUeXBlXSggb1NldHRpbmdzLCBpQ29sdW1uLCBpVmlzQ29sdW1uICk7CgkJCQkJCWZvciAoIGo9MCwgakxlbj1hb0RhdGEubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQkJewoJCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaiwgaUNvbHVtbiwgYURhdGFbal0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQ3JlYXRlIGEgdmFsdWUgLSBrZXkgYXJyYXkgb2YgdGhlIGN1cnJlbnQgcm93IHBvc2l0aW9ucyBzdWNoIHRoYXQgd2UgY2FuIHVzZSB0aGVpcgoJCQkJICogY3VycmVudCBwb3NpdGlvbiBkdXJpbmcgdGhlIHNvcnQsIGlmIHZhbHVlcyBtYXRjaCwgaW4gb3JkZXIgdG8gcGVyZm9ybSBzdGFibGUgc29ydGluZwoJCQkJICovCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFpT3JpZ1sgb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcltpXSBdID0gaTsKCQkJCX0KCQkKCQkJCS8qIEJ1aWxkIGFuIGludGVybmFsIGRhdGEgYXJyYXkgd2hpY2ggaXMgc3BlY2lmaWMgdG8gdGhlIHNvcnQsIHNvIHdlIGNhbiBnZXQgYW5kIHByZXAKCQkJCSAqIHRoZSBkYXRhIHRvIGJlIHNvcnRlZCBvbmx5IG9uY2UsIHJhdGhlciB0aGFuIG5lZWRpbmcgdG8gZG8gaXQgZXZlcnkgdGltZSB0aGUgc29ydGluZwoJCQkJICogZnVuY3Rpb24gcnVucy4gVGhpcyBtYWtlIHRoZSBzb3J0aW5nIGZ1bmN0aW9uIGEgdmVyeSBzaW1wbGUgY29tcGFyaXNvbgoJCQkJICovCgkJCQl2YXIgaVNvcnRMZW4gPSBhYVNvcnQubGVuZ3RoOwoJCQkJdmFyIGZuU29ydEZvcm1hdCwgYURhdGFTb3J0OwoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWZvciAoIGo9MCA7IGo8aVNvcnRMZW4gOyBqKysgKQoJCQkJCXsKCQkJCQkJYURhdGFTb3J0ID0gYW9Db2x1bW5zWyBhYVNvcnRbal1bMF0gXS5hRGF0YVNvcnQ7CgkJCgkJCQkJCWZvciAoIGs9MCwga0xlbj1hRGF0YVNvcnQubGVuZ3RoIDsgazxrTGVuIDsgaysrICkKCQkJCQkJewoJCQkJCQkJc0RhdGFUeXBlID0gYW9Db2x1bW5zWyBhRGF0YVNvcnRba10gXS5zVHlwZTsKCQkJCQkJCWZuU29ydEZvcm1hdCA9IG9Tb3J0WyAoc0RhdGFUeXBlID8gc0RhdGFUeXBlIDogJ3N0cmluZycpKyItcHJlIiBdOwoJCQkJCQkJCgkJCQkJCQlhb0RhdGFbaV0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2tdIF0gPSBmblNvcnRGb3JtYXQgPwoJCQkJCQkJCWZuU29ydEZvcm1hdCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaSwgYURhdGFTb3J0W2tdLCAnc29ydCcgKSApIDoKCQkJCQkJCQlfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBhRGF0YVNvcnRba10sICdzb3J0JyApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBEbyB0aGUgc29ydCAtIGhlcmUgd2Ugd2FudCBtdWx0aS1jb2x1bW4gc29ydGluZyBiYXNlZCBvbiBhIGdpdmVuIGRhdGEgc291cmNlIChjb2x1bW4pCgkJCQkgKiBhbmQgc29ydGluZyBmdW5jdGlvbiAoZnJvbSBvU29ydCkgaW4gYSBjZXJ0YWluIGRpcmVjdGlvbi4gSXQncyByZWFzb25hYmx5IGNvbXBsZXggdG8KCQkJCSAqIGZvbGxvdyBvbiBpdCdzIG93biwgYnV0IHRoaXMgaXMgd2hhdCB3ZSB3YW50IChleGFtcGxlIHR3byBjb2x1bW4gc29ydGluZyk6CgkJCQkgKiAgZm5Mb2NhbFNvcnRpbmcgPSBmdW5jdGlvbihhLGIpewoJCQkJICogIAl2YXIgaVRlc3Q7CgkJCQkgKiAgCWlUZXN0ID0gb1NvcnRbJ3N0cmluZy1hc2MnXSgnZGF0YTExJywgJ2RhdGExMicpOwoJCQkJICogIAlpZiAoaVRlc3QgIT09IDApCgkJCQkgKiAgCQlyZXR1cm4gaVRlc3Q7CgkJCQkgKiAgICBpVGVzdCA9IG9Tb3J0WydudW1lcmljLWRlc2MnXSgnZGF0YTIxJywgJ2RhdGEyMicpOwoJCQkJICogICAgaWYgKGlUZXN0ICE9PSAwKQoJCQkJICogIAkJcmV0dXJuIGlUZXN0OwoJCQkJICogIAlyZXR1cm4gb1NvcnRbJ251bWVyaWMtYXNjJ10oIGFpT3JpZ1thXSwgYWlPcmlnW2JdICk7CgkJCQkgKiAgfQoJCQkJICogQmFzaWNhbGx5IHdlIGhhdmUgYSB0ZXN0IGZvciBlYWNoIHNvcnRpbmcgY29sdW1uLCBpZiB0aGUgZGF0YSBpbiB0aGF0IGNvbHVtbiBpcyBlcXVhbCwKCQkJCSAqIHRlc3QgdGhlIG5leHQgY29sdW1uLiBJZiBhbGwgY29sdW1ucyBtYXRjaCwgdGhlbiB3ZSB1c2UgYSBudW1lcmljIHNvcnQgb24gdGhlIHJvdyAKCQkJCSAqIHBvc2l0aW9ucyBpbiB0aGUgb3JpZ2luYWwgZGF0YSBhcnJheSB0byBwcm92aWRlIGEgc3RhYmxlIHNvcnQuCgkJCQkgKi8KCQkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc29ydCggZnVuY3Rpb24gKCBhLCBiICkgewoJCQkJCXZhciBrLCBsLCBsTGVuLCBpVGVzdCwgYURhdGFTb3J0LCBzRGF0YVR5cGU7CgkJCQkJZm9yICggaz0wIDsgazxpU29ydExlbiA7IGsrKyApCgkJCQkJewoJCQkJCQlhRGF0YVNvcnQgPSBhb0NvbHVtbnNbIGFhU29ydFtrXVswXSBdLmFEYXRhU29ydDsKCQkKCQkJCQkJZm9yICggbD0wLCBsTGVuPWFEYXRhU29ydC5sZW5ndGggOyBsPGxMZW4gOyBsKysgKQoJCQkJCQl7CgkJCQkJCQlzRGF0YVR5cGUgPSBhb0NvbHVtbnNbIGFEYXRhU29ydFtsXSBdLnNUeXBlOwoJCQkJCQkJCgkJCQkJCQlpVGVzdCA9IG9Tb3J0WyAoc0RhdGFUeXBlID8gc0RhdGFUeXBlIDogJ3N0cmluZycpKyItIithYVNvcnRba11bMV0gXSgKCQkJCQkJCQlhb0RhdGFbYV0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2xdIF0sCgkJCQkJCQkJYW9EYXRhW2JdLl9hU29ydERhdGFbIGFEYXRhU29ydFtsXSBdCgkJCQkJCQkpOwoJCQkJCQkKCQkJCQkJCWlmICggaVRlc3QgIT09IDAgKQoJCQkJCQkJewoJCQkJCQkJCXJldHVybiBpVGVzdDsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQkKCQkJCQlyZXR1cm4gb1NvcnRbJ251bWVyaWMtYXNjJ10oIGFpT3JpZ1thXSwgYWlPcmlnW2JdICk7CgkJCQl9ICk7CgkJCX0KCQkJCgkJCS8qIEFsdGVyIHRoZSBzb3J0aW5nIGNsYXNzZXMgdG8gdGFrZSBhY2NvdW50IG9mIHRoZSBjaGFuZ2VzICovCgkJCWlmICggKGJBcHBseUNsYXNzZXMgPT09IHVuZGVmaW5lZCB8fCBiQXBwbHlDbGFzc2VzKSAmJiAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQl7CgkJCQlfZm5Tb3J0aW5nQ2xhc3Nlcyggb1NldHRpbmdzICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJblRoID0gYW9Db2x1bW5zW2ldLm5UaDsKCQkJCW5UaC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtc29ydCcpOwoJCQkJblRoLnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcpOwoJCQkJCgkJCQkvKiBJbiBBUklBIG9ubHkgdGhlIGZpcnN0IHNvcnRpbmcgY29sdW1uIGNhbiBiZSBtYXJrZWQgYXMgc29ydGluZyAtIG5vIG11bHRpLXNvcnQgb3B0aW9uICovCgkJCQlpZiAoIGFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCWlmICggYWFTb3J0Lmxlbmd0aCA+IDAgJiYgYWFTb3J0WzBdWzBdID09IGkgKQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1zb3J0JywgYWFTb3J0WzBdWzFdPT0iYXNjIiA/ICJhc2NlbmRpbmciIDogImRlc2NlbmRpbmciICk7CgkJCQkJCQoJCQkJCQl2YXIgbmV4dFNvcnQgPSAoYW9Db2x1bW5zW2ldLmFzU29ydGluZ1sgYWFTb3J0WzBdWzJdKzEgXSkgPyAKCQkJCQkJCWFvQ29sdW1uc1tpXS5hc1NvcnRpbmdbIGFhU29ydFswXVsyXSsxIF0gOiBhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWzBdOwoJCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYW9Db2x1bW5zW2ldLnNUaXRsZSsKCQkJCQkJCShuZXh0U29ydD09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGFvQ29sdW1uc1tpXS5zVGl0bGUrCgkJCQkJCQkoYW9Db2x1bW5zW2ldLmFzU29ydGluZ1swXT09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGFvQ29sdW1uc1tpXS5zVGl0bGUpOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBUZWxsIHRoZSBkcmF3IGZ1bmN0aW9uIHRoYXQgd2UgaGF2ZSBzb3J0ZWQgdGhlIGRhdGEgKi8KCQkJb1NldHRpbmdzLmJTb3J0ZWQgPSB0cnVlOwoJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoJ3NvcnQnLCBvU2V0dGluZ3MpOwoJCQkKCQkJLyogQ29weSB0aGUgbWFzdGVyIGRhdGEgaW50byB0aGUgZHJhdyBhcnJheSBhbmQgcmUtZHJhdyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciApCgkJCXsKCQkJCS8qIF9mbkZpbHRlcigpIHdpbGwgcmVkcmF3IHRoZSB0YWJsZSBmb3IgdXMgKi8KCQkJCV9mbkZpbHRlckNvbXBsZXRlKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2gsIDEgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOyAvKiByZXNldCBkaXNwbGF5IGJhY2sgdG8gcGFnZSAwICovCgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQXR0YWNoIGEgc29ydCBoYW5kbGVyIChjbGljaykgdG8gYSBub2RlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuTm9kZSBub2RlIHRvIGF0dGFjaCB0aGUgaGFuZGxlciB0bwoJCSAqICBAcGFyYW0ge2ludH0gaURhdGFJbmRleCBjb2x1bW4gc29ydGluZyBpbmRleAoJCSAqICBAcGFyYW0ge2Z1bmN0aW9ufSBbZm5DYWxsYmFja10gY2FsbGJhY2sgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU29ydEF0dGFjaExpc3RlbmVyICggb1NldHRpbmdzLCBuTm9kZSwgaURhdGFJbmRleCwgZm5DYWxsYmFjayApCgkJewoJCQlfZm5CaW5kQWN0aW9uKCBuTm9kZSwge30sIGZ1bmN0aW9uIChlKSB7CgkJCQkvKiBJZiB0aGUgY29sdW1uIGlzIG5vdCBzb3J0YWJsZSAtIGRvbid0IHRvIGFueXRoaW5nICovCgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaURhdGFJbmRleF0uYlNvcnRhYmxlID09PSBmYWxzZSApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQkvKgoJCQkJICogVGhpcyBpcyBhIGxpdHRsZSBiaXQgb2RkIEkgYWRtaXQuLi4gSSBkZWNsYXJlIGEgdGVtcG9yYXJ5IGZ1bmN0aW9uIGluc2lkZSB0aGUgc2NvcGUgb2YKCQkJCSAqIF9mbkJ1aWxkSGVhZCBhbmQgdGhlIGNsaWNrIGhhbmRsZXIgaW4gb3JkZXIgdGhhdCB0aGUgY29kZSBwcmVzZW50ZWQgaGVyZSBjYW4gYmUgdXNlZCAKCQkJCSAqIHR3aWNlIC0gb25jZSBmb3Igd2hlbiBiUHJvY2Vzc2luZyBpcyBlbmFibGVkLCBhbmQgYW5vdGhlciB0aW1lIGZvciB3aGVuIGl0IGlzIAoJCQkJICogZGlzYWJsZWQsIGFzIHdlIG5lZWQgdG8gcGVyZm9ybSBzbGlnaHRseSBkaWZmZXJlbnQgYWN0aW9ucy4KCQkJCSAqICAgQmFzaWNhbGx5IHRoZSBpc3N1ZSBoZXJlIGlzIHRoYXQgdGhlIEphdmFzY3JpcHQgZW5naW5lIGluIG1vZGVybiBicm93c2VycyBkb24ndCAKCQkJCSAqIGFwcGVhciB0byBhbGxvdyB0aGUgcmVuZGVyaW5nIGVuZ2luZSB0byB1cGRhdGUgdGhlIGRpc3BsYXkgd2hpbGUgaXQgaXMgc3RpbGwgZXhjdXRpbmcKCQkJCSAqIGl0J3MgdGhyZWFkICh3ZWxsIC0gaXQgZG9lcyBidXQgb25seSBhZnRlciBsb25nIGludGVydmFscykuIFRoaXMgbWVhbnMgdGhhdCB0aGUgCgkJCQkgKiAncHJvY2Vzc2luZycgZGlzcGxheSBkb2Vzbid0IGFwcGVhciBmb3IgYSB0YWJsZSBzb3J0LiBUbyBicmVhayB0aGUganMgdGhyZWFkIHVwIGEgYml0CgkJCQkgKiBJIGZvcmNlIGFuIGV4ZWN1dGlvbiBicmVhayBieSB1c2luZyBzZXRUaW1lb3V0IC0gYnV0IHRoaXMgYnJlYWtzIHRoZSBleHBlY3RlZCAKCQkJCSAqIHRocmVhZCBjb250aW51YXRpb24gZm9yIHRoZSBlbmQtZGV2ZWxvcGVyJ3MgcG9pbnQgb2YgdmlldyAodGhlaXIgY29kZSB3b3VsZCBleGVjdXRlCgkJCQkgKiB0b28gZWFybHkpLCBzbyB3ZSBvbjt5IGRvIGl0IHdoZW4gd2UgYWJzb2x1dGVseSBoYXZlIHRvLgoJCQkJICovCgkJCQl2YXIgZm5Jbm5lclNvcnRpbmcgPSBmdW5jdGlvbiAoKSB7CgkJCQkJdmFyIGlDb2x1bW4sIGlOZXh0U29ydDsKCQkJCQkKCQkJCQkvKiBJZiB0aGUgc2hpZnQga2V5IGlzIHByZXNzZWQgdGhlbiB3ZSBhcmUgbXVsdGlwZSBjb2x1bW4gc29ydGluZyAqLwoJCQkJCWlmICggZS5zaGlmdEtleSApCgkJCQkJewoJCQkJCQkvKiBBcmUgd2UgYWxyZWFkeSBkb2luZyBzb21lIGtpbmQgb2Ygc29ydCBvbiB0aGlzIGNvbHVtbj8gKi8KCQkJCQkJdmFyIGJGb3VuZCA9IGZhbHNlOwoJCQkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCA7IGkrKyApCgkJCQkJCXsKCQkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA9PSBpRGF0YUluZGV4ICkKCQkJCQkJCXsKCQkJCQkJCQliRm91bmQgPSB0cnVlOwoJCQkJCQkJCWlDb2x1bW4gPSBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdOwoJCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0rMTsKCQkJCQkJCQkKCQkJCQkJCQlpZiAoICFvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmFzU29ydGluZ1tpTmV4dFNvcnRdICkKCQkJCQkJCQl7CgkJCQkJCQkJCS8qIFJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgc29ydGluZyBvcHRpb25zLCByZW1vdmUgZnJvbSBtdWx0aS1jb2wgc29ydCAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggaSwgMSApOwoJCQkJCQkJCX0KCQkJCQkJCQllbHNlCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBNb3ZlIG9udG8gbmV4dCBzb3J0aW5nIGRpcmVjdGlvbiAqLwoJCQkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGlOZXh0U29ydDsKCQkJCQkJCQl9CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIE5vIHNvcnQgeWV0IC0gYWRkIGl0IGluICovCgkJCQkJCWlmICggYkZvdW5kID09PSBmYWxzZSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJLyogSWYgbm8gc2hpZnQga2V5IHRoZW4gc2luZ2xlIGNvbHVtbiBzb3J0ICovCgkJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggPT0gMSAmJiBvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzBdID09IGlEYXRhSW5kZXggKQoJCQkJCQl7CgkJCQkJCQlpQ29sdW1uID0gb1NldHRpbmdzLmFhU29ydGluZ1swXVswXTsKCQkJCQkJCWlOZXh0U29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0rMTsKCQkJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF0gKQoJCQkJCQkJewoJCQkJCQkJCWlOZXh0U29ydCA9IDA7CgkJCQkJCQl9CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzFdID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMl0gPSBpTmV4dFNvcnQ7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNwbGljZSggMCwgb1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggKTsKCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmcucHVzaCggWyBpRGF0YUluZGV4LCAKCQkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmFzU29ydGluZ1swXSwgMCBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJCgkJCQkJLyogUnVuIHRoZSBzb3J0ICovCgkJCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJCQl9OyAvKiAvZm5Jbm5lclNvcnRpbmcgKi8KCQkJCQoJCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCQl7CgkJCQkJZm5Jbm5lclNvcnRpbmcoKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQkJc2V0VGltZW91dCggZnVuY3Rpb24oKSB7CgkJCQkJCWZuSW5uZXJTb3J0aW5nKCk7CgkJCQkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJCQl7CgkJCQkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJCQl9CgkJCQkJfSwgMCApOwoJCQkJfQoJCQkJCgkJCQkvKiBDYWxsIHRoZSB1c2VyIHNwZWNpZmllZCBjYWxsYmFjayBmdW5jdGlvbiAtIHVzZWQgZm9yIGFzeW5jIHVzZXIgaW50ZXJhY3Rpb24gKi8KCQkJCWlmICggdHlwZW9mIGZuQ2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJyApCgkJCQl7CgkJCQkJZm5DYWxsYmFjayggb1NldHRpbmdzICk7CgkJCQl9CgkJCX0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogU2V0IHRoZSBzb3J0aW5nIGNsYXNzZXMgb24gdGhlIGhlYWRlciwgTm90ZTogaXQgaXMgc2FmZSB0byBjYWxsIHRoaXMgZnVuY3Rpb24gCgkJICogd2hlbiBiU29ydCBhbmQgYlNvcnRDbGFzc2VzIGFyZSBmYWxzZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGosIGpMZW4sIGlGb3VuZDsKCQkJdmFyIGFhU29ydCwgc0NsYXNzOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkKCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zU29ydEFzYyArIiAiKyBvQ2xhc3Nlcy5zU29ydERlc2MgKwoJCQkJCQkiICIrIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzcyApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZCAhPT0gbnVsbCApCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZC5jb25jYXQoIG9TZXR0aW5ncy5hYVNvcnRpbmcgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFhU29ydCA9IG9TZXR0aW5ncy5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJfQoJCQkKCQkJLyogQXBwbHkgdGhlIHJlcXVpcmVkIGNsYXNzZXMgdG8gdGhlIGhlYWRlciAqLwoJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQl7CgkJCQkJc0NsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzOwoJCQkJCWlGb3VuZCA9IC0xOwoJCQkJCWZvciAoIGo9MCA7IGo8YWFTb3J0Lmxlbmd0aCA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIGFhU29ydFtqXVswXSA9PSBpICkKCQkJCQkJewoJCQkJCQkJc0NsYXNzID0gKCBhYVNvcnRbal1bMV0gPT0gImFzYyIgKSA/CgkJCQkJCQkJb0NsYXNzZXMuc1NvcnRBc2MgOiBvQ2xhc3Nlcy5zU29ydERlc2M7CgkJCQkJCQlpRm91bmQgPSBqOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIHNDbGFzcyApOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQkJCXsKCQkJCQkJLyogalF1ZXJ5IFVJIHVzZXMgZXh0cmEgbWFya3VwICovCgkJCQkJCXZhciBqcVNwYW4gPSAkKCJzcGFuLiIrb0NsYXNzZXMuc1NvcnRJY29uLCAgb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpOwoJCQkJCQlqcVNwYW4ucmVtb3ZlQ2xhc3Mob0NsYXNzZXMuc1NvcnRKVUlBc2MgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlEZXNjICsiICIrIAoJCQkJCQkJb0NsYXNzZXMuc1NvcnRKVUkgKyIgIisgb0NsYXNzZXMuc1NvcnRKVUlBc2NBbGxvd2VkICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQgKTsKCQkJCQkJCgkJCQkJCXZhciBzU3BhbkNsYXNzOwoJCQkJCQlpZiAoIGlGb3VuZCA9PSAtMSApCgkJCQkJCXsKCQkJCQkJIAlzU3BhbkNsYXNzID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzSlVJOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBhYVNvcnRbaUZvdW5kXVsxXSA9PSAiYXNjIiApCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSUFzYzsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCXNTcGFuQ2xhc3MgPSBvQ2xhc3Nlcy5zU29ydEpVSURlc2M7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCWpxU3Bhbi5hZGRDbGFzcyggc1NwYW5DbGFzcyApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQkvKiBObyBzb3J0aW5nIG9uIHRoaXMgY29sdW1uLCBzbyBhZGQgdGhlIGJhc2UgY2xhc3MuIFRoaXMgd2lsbCBoYXZlIGJlZW4gYXNzaWduZWQgYnkKCQkJCQkgKiBfZm5BZGRDb2x1bW4KCQkJCQkgKi8KCQkJCQkkKG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zU29ydGluZ0NsYXNzICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIAoJCQkgKiBBcHBseSB0aGUgcmVxdWlyZWQgY2xhc3NlcyB0byB0aGUgdGFibGUgYm9keQoJCQkgKiBOb3RlIHRoYXQgdGhpcyBpcyBnaXZlbiBhcyBhIGZlYXR1cmUgc3dpdGNoIHNpbmNlIGl0IGNhbiBzaWduaWZpY2FudGx5IHNsb3cgZG93biBhIHNvcnQKCQkJICogb24gbGFyZ2UgZGF0YSBzZXRzIChhZGRpbmcgYW5kIHJlbW92aW5nIG9mIGNsYXNzZXMgaXMgYWx3YXlzIHNsb3cgYXQgdGhlIGJlc3Qgb2YgdGltZXMuLikKCQkJICogRnVydGhlciB0byB0aGlzLCBub3RlIHRoYXQgdGhpcyBjb2RlIGlzIGFkbWl0YWRseSBmYWlybHkgdWdseS4gSXQgY291bGQgYmUgbWFkZSBhIGxvdCAKCQkJICogc2ltcGlsZXIgdXNpbmcgalF1ZXJ5IHNlbGVjdG9ycyBhbmQgYWRkL3JlbW92ZUNsYXNzLCBidXQgdGhhdCBpcyBzaWduaWZpY2FudGx5IHNsb3dlcgoJCQkgKiAob24gdGhlIG9yZGVyIG9mIDUgdGltZXMgc2xvd2VyKSAtIGhlbmNlIHRoZSBkaXJlY3QgRE9NIG1hbmlwdWxhdGlvbiBoZXJlLgoJCQkgKiBOb3RlIHRoYXQgZm9yIGRlZmVyZWQgZHJhd2luZyB3ZSBkbyB1c2UgalF1ZXJ5IC0gdGhlIHJlYXNvbiBiZWluZyB0aGF0IHRha2luZyB0aGUgZmlyc3QKCQkJICogcm93IGZvdW5kIHRvIHNlZSBpZiB0aGUgd2hvbGUgY29sdW1uIG5lZWRzIHByb2Nlc3NlZCBjYW4gbWlzcyBjbGFzc2VzIHNpbmNlIHRoZSBmaXJzdAoJCQkgKiBjb2x1bW4gbWlnaHQgYmUgbmV3LgoJCQkgKi8KCQkJc0NsYXNzID0gb0NsYXNzZXMuc1NvcnRDb2x1bW47CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydENsYXNzZXMgKQoJCQl7CgkJCQl2YXIgblRkcyA9IF9mbkdldFRkTm9kZXMoIG9TZXR0aW5ncyApOwoJCQoJCQkJLyogUmVtb3ZlIHRoZSBvbGQgY2xhc3NlcyAqLwoJCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCQl7CgkJCQkJJChuVGRzKS5yZW1vdmVDbGFzcyhzQ2xhc3MrJzEgJytzQ2xhc3MrJzIgJytzQ2xhc3MrJzMnKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBuVGRzLmxlbmd0aCA+PSBpQ29sdW1ucyApCgkJCQl7CgkJCQkJZm9yICggaT0wIDsgaTxpQ29sdW1ucyA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIG5UZHNbaV0uY2xhc3NOYW1lLmluZGV4T2Yoc0NsYXNzKyIxIikgIT0gLTEgKQoJCQkJCQl7CgkJCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lID0gCgkJCQkJCQkJCSQudHJpbSggblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lLnJlcGxhY2UoIHNDbGFzcysiMSIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQllbHNlIGlmICggblRkc1tpXS5jbGFzc05hbWUuaW5kZXhPZihzQ2xhc3MrIjIiKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGo9MCwgakxlbj0oblRkcy5sZW5ndGgvaUNvbHVtbnMpIDsgajxqTGVuIDsgaisrICkKCQkJCQkJCXsKCQkJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUgPSAKCQkJCQkJCQkJJC50cmltKCBuVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUucmVwbGFjZSggc0NsYXNzKyIyIiwgIiIgKSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBuVGRzW2ldLmNsYXNzTmFtZS5pbmRleE9mKHNDbGFzcysiMyIpICE9IC0xICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPShuVGRzLmxlbmd0aC9pQ29sdW1ucykgOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCW5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZSA9IAoJCQkJCQkJCQkkLnRyaW0oIG5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZS5yZXBsYWNlKCAiICIrc0NsYXNzKyIzIiwgIiIgKSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBBZGQgdGhlIG5ldyBjbGFzc2VzIHRvIHRoZSB0YWJsZSAqLwoJCQkJdmFyIGlDbGFzcyA9IDEsIGlUYXJnZXRDb2w7CgkJCQlmb3IgKCBpPTAgOyBpPGFhU29ydC5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlUYXJnZXRDb2wgPSBwYXJzZUludCggYWFTb3J0W2ldWzBdLCAxMCApOwoJCQkJCWZvciAoIGo9MCwgakxlbj0oblRkcy5sZW5ndGgvaUNvbHVtbnMpIDsgajxqTGVuIDsgaisrICkKCQkJCQl7CgkJCQkJCW5UZHNbKGlDb2x1bW5zKmopK2lUYXJnZXRDb2xdLmNsYXNzTmFtZSArPSAiICIrc0NsYXNzK2lDbGFzczsKCQkJCQl9CgkJCQkJCgkJCQkJaWYgKCBpQ2xhc3MgPCAzICkKCQkJCQl7CgkJCQkJCWlDbGFzcysrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBTYXZlIHRoZSBzdGF0ZSBvZiBhIHRhYmxlIGluIGEgY29va2llIHN1Y2ggdGhhdCB0aGUgcGFnZSBjYW4gYmUgcmVsb2FkZWQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TYXZlU3RhdGUgKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU3RhdGVTYXZlIHx8IG9TZXR0aW5ncy5iRGVzdHJveWluZyApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQoJCQkvKiBTdG9yZSB0aGUgaW50ZXJlc3RpbmcgdmFyaWFibGVzICovCgkJCXZhciBpLCBpTGVuLCBiSW5maW5pdGU9b1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlOwoJCQl2YXIgb1N0YXRlID0gewoJCQkJImlDcmVhdGUiOiAgICAgIG5ldyBEYXRlKCkuZ2V0VGltZSgpLAoJCQkJImlTdGFydCI6ICAgICAgIChiSW5maW5pdGUgPyAwIDogb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0KSwKCQkJCSJpRW5kIjogICAgICAgICAoYkluZmluaXRlID8gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA6IG9TZXR0aW5ncy5faURpc3BsYXlFbmQpLAoJCQkJImlMZW5ndGgiOiAgICAgIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgsCgkJCQkiYWFTb3J0aW5nIjogICAgJC5leHRlbmQoIHRydWUsIFtdLCBvU2V0dGluZ3MuYWFTb3J0aW5nICksCgkJCQkib1NlYXJjaCI6ICAgICAgJC5leHRlbmQoIHRydWUsIHt9LCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoICksCgkJCQkiYW9TZWFyY2hDb2xzIjogJC5leHRlbmQoIHRydWUsIFtdLCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzICksCgkJCQkiYWJWaXNDb2xzIjogICAgW10KCQkJfTsKCQkKCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJb1N0YXRlLmFiVmlzQ29scy5wdXNoKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICk7CgkJCX0KCQkKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICJhb1N0YXRlU2F2ZVBhcmFtcyIsICdzdGF0ZVNhdmVQYXJhbXMnLCBbb1NldHRpbmdzLCBvU3RhdGVdICk7CgkJCQoJCQlvU2V0dGluZ3MuZm5TdGF0ZVNhdmUuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLCBvU3RhdGUgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXR0ZW1wdCB0byBsb2FkIGEgc2F2ZWQgdGFibGUgc3RhdGUgZnJvbSBhIGNvb2tpZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvSW5pdCBEYXRhVGFibGVzIGluaXQgb2JqZWN0IHNvIHdlIGNhbiBvdmVycmlkZSBzZXR0aW5ncwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Mb2FkU3RhdGUgKCBvU2V0dGluZ3MsIG9Jbml0ICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuZm5TdGF0ZUxvYWQuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzICk7CgkJCWlmICggIW9EYXRhICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBBbGxvdyBjdXN0b20gYW5kIHBsdWctaW4gbWFuaXB1bGF0aW9uIGZ1bmN0aW9ucyB0byBhbHRlciB0aGUgc2F2ZWQgZGF0YSBzZXQgYW5kCgkJCSAqIGNhbmNlbGxpbmcgb2YgbG9hZGluZyBieSByZXR1cm5pbmcgZmFsc2UKCQkJICovCgkJCXZhciBhYlN0YXRlTG9hZCA9IF9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRQYXJhbXMnLCAnc3RhdGVMb2FkUGFyYW1zJywgW29TZXR0aW5ncywgb0RhdGFdICk7CgkJCWlmICggJC5pbkFycmF5KCBmYWxzZSwgYWJTdGF0ZUxvYWQgKSAhPT0gLTEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFN0b3JlIHRoZSBzYXZlZCBzdGF0ZSBzbyBpdCBtaWdodCBiZSBhY2Nlc3NlZCBhdCBhbnkgdGltZSAqLwoJCQlvU2V0dGluZ3Mub0xvYWRlZFN0YXRlID0gJC5leHRlbmQoIHRydWUsIHt9LCBvRGF0YSApOwoJCQkKCQkJLyogUmVzdG9yZSBrZXkgZmVhdHVyZXMgKi8KCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICAgID0gb0RhdGEuaVN0YXJ0OwoJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBvRGF0YS5pU3RhcnQ7CgkJCW9TZXR0aW5ncy5faURpc3BsYXlFbmQgICAgICA9IG9EYXRhLmlFbmQ7CgkJCW9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggICA9IG9EYXRhLmlMZW5ndGg7CgkJCW9TZXR0aW5ncy5hYVNvcnRpbmcgICAgICAgICA9IG9EYXRhLmFhU29ydGluZy5zbGljZSgpOwoJCQlvU2V0dGluZ3Muc2F2ZWRfYWFTb3J0aW5nICAgPSBvRGF0YS5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJCgkJCS8qIFNlYXJjaCBmaWx0ZXJpbmcgICovCgkJCSQuZXh0ZW5kKCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCBvRGF0YS5vU2VhcmNoICk7CgkJCSQuZXh0ZW5kKCB0cnVlLCBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzLCBvRGF0YS5hb1NlYXJjaENvbHMgKTsKCQkJCgkJCS8qIENvbHVtbiB2aXNpYmlsaXR5IHN0YXRlCgkJCSAqIFBhc3MgYmFjayB2aXNpYmlsaXkgc2V0dGluZ3MgdG8gdGhlIGluaXQgaGFuZGxlciwgYnV0IHRvIGRvIG5vdCBoZXJlIG92ZXJyaWRlCgkJCSAqIHRoZSBpbml0IG9iamVjdCB0aGF0IHRoZSB1c2VyIG1pZ2h0IGhhdmUgcGFzc2VkIGluCgkJCSAqLwoJCQlvSW5pdC5zYXZlZF9hb0NvbHVtbnMgPSBbXTsKCQkJZm9yICggdmFyIGk9MCA7IGk8b0RhdGEuYWJWaXNDb2xzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCW9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXSA9IHt9OwoJCQkJb0luaXQuc2F2ZWRfYW9Db2x1bW5zW2ldLmJWaXNpYmxlID0gb0RhdGEuYWJWaXNDb2xzW2ldOwoJCQl9CgkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICdzdGF0ZUxvYWRlZCcsIFtvU2V0dGluZ3MsIG9EYXRhXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgY29va2llIHdpdGggYSB2YWx1ZSB0byBzdG9yZSB0aGUgc3RhdGUgb2YgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgbmFtZSBvZiB0aGUgY29va2llIHRvIGNyZWF0ZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZhbHVlIHRoZSB2YWx1ZSB0aGUgY29va2llIHNob3VsZCB0YWtlCgkJICogIEBwYXJhbSB7aW50fSBpU2VjcyBkdXJhdGlvbiBvZiB0aGUgY29va2llCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzQmFzZU5hbWUgc05hbWUgaXMgbWFkZSB1cCBvZiB0aGUgYmFzZSArIGZpbGUgbmFtZSAtIHRoaXMgaXMgdGhlIGJhc2UKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm5DYWxsYmFjayBVc2VyIGRlZmluYWJsZSBmdW5jdGlvbiB0byBtb2RpZnkgdGhlIGNvb2tpZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVDb29raWUgKCBzTmFtZSwgc1ZhbHVlLCBpU2Vjcywgc0Jhc2VOYW1lLCBmbkNhbGxiYWNrICkKCQl7CgkJCXZhciBkYXRlID0gbmV3IERhdGUoKTsKCQkJZGF0ZS5zZXRUaW1lKCBkYXRlLmdldFRpbWUoKSsoaVNlY3MqMTAwMCkgKTsKCQkJCgkJCS8qIAoJCQkgKiBTaG9ja2luZyBidXQgdHJ1ZSAtIGl0IHdvdWxkIGFwcGVhciBJRSBoYXMgbWFqb3IgaXNzdWVzIHdpdGggaGF2aW5nIHRoZSBwYXRoIG5vdCBoYXZpbmcKCQkJICogYSB0cmFpbGluZyBzbGFzaCBvbiBpdC4gV2UgbmVlZCB0aGUgY29va2llIHRvIGJlIGF2YWlsYWJsZSBiYXNlZCBvbiB0aGUgcGF0aCwgc28gd2UKCQkJICogaGF2ZSB0byBhcHBlbmQgdGhlIGZpbGUgbmFtZSB0byB0aGUgY29va2llIG5hbWUuIEFwcGFsbGluZy4gVGhhbmtzIHRvIHZleCBmb3IgYWRkaW5nIHRoZQoJCQkgKiBwYXRjaCB0byB1c2UgYXQgbGVhc3Qgc29tZSBvZiB0aGUgcGF0aAoJCQkgKi8KCQkJdmFyIGFQYXJ0cyA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpOwoJCQl2YXIgc05hbWVGaWxlID0gc05hbWUgKyAnXycgKyBhUGFydHMucG9wKCkucmVwbGFjZSgvW1wvOl0vZywiIikudG9Mb3dlckNhc2UoKTsKCQkJdmFyIHNGdWxsQ29va2llLCBvRGF0YTsKCQkJCgkJCWlmICggZm5DYWxsYmFjayAhPT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhID0gKHR5cGVvZiAkLnBhcnNlSlNPTiA9PT0gJ2Z1bmN0aW9uJykgPyAKCQkJCQkkLnBhcnNlSlNPTiggc1ZhbHVlICkgOiBldmFsKCAnKCcrc1ZhbHVlKycpJyApOwoJCQkJc0Z1bGxDb29raWUgPSBmbkNhbGxiYWNrKCBzTmFtZUZpbGUsIG9EYXRhLCBkYXRlLnRvR01UU3RyaW5nKCksCgkJCQkJYVBhcnRzLmpvaW4oJy8nKSsiLyIgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXNGdWxsQ29va2llID0gc05hbWVGaWxlICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHNWYWx1ZSkgKwoJCQkJCSI7IGV4cGlyZXM9IiArIGRhdGUudG9HTVRTdHJpbmcoKSArIjsgcGF0aD0iICsgYVBhcnRzLmpvaW4oJy8nKSsiLyI7CgkJCX0KCQkJCgkJCS8qIEFyZSB3ZSBnb2luZyB0byBnbyBvdmVyIHRoZSBjb29raWUgbGltaXQgb2YgNEtpQj8gSWYgc28sIHRyeSB0byBkZWxldGUgYSBjb29raWVzCgkJCSAqIGJlbG9uZ2luZyB0byBEYXRhVGFibGVzLiBUaGlzIGlzIEZBUiBmcm9tIGJ1bGxldCBwcm9vZgoJCQkgKi8KCQkJdmFyIHNPbGROYW1lPSIiLCBpT2xkVGltZT05OTk5OTk5OTk5OTk5OwoJCQl2YXIgaUxlbmd0aCA9IF9mblJlYWRDb29raWUoIHNOYW1lRmlsZSApIT09bnVsbCA/IGRvY3VtZW50LmNvb2tpZS5sZW5ndGggOiAKCQkJCXNGdWxsQ29va2llLmxlbmd0aCArIGRvY3VtZW50LmNvb2tpZS5sZW5ndGg7CgkJCQoJCQlpZiAoIGlMZW5ndGgrMTAgPiA0MDk2ICkgLyogTWFnaWMgMTAgZm9yIHBhZGRpbmcgKi8KCQkJewoJCQkJdmFyIGFDb29raWVzID1kb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsKCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YUNvb2tpZXMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFDb29raWVzW2ldLmluZGV4T2YoIHNCYXNlTmFtZSApICE9IC0xICkKCQkJCQl7CgkJCQkJCS8qIEl0J3MgYSBEYXRhVGFibGVzIGNvb2tpZSwgc28gZXZhbCBpdCBhbmQgY2hlY2sgdGhlIHRpbWUgc3RhbXAgKi8KCQkJCQkJdmFyIGFTcGxpdENvb2tpZSA9IGFDb29raWVzW2ldLnNwbGl0KCc9Jyk7CgkJCQkJCXRyeSB7IG9EYXRhID0gZXZhbCggJygnK2RlY29kZVVSSUNvbXBvbmVudChhU3BsaXRDb29raWVbMV0pKycpJyApOyB9CgkJCQkJCWNhdGNoKCBlICkgeyBjb250aW51ZTsgfQoJCQkJCQkKCQkJCQkJaWYgKCBvRGF0YS5pQ3JlYXRlICYmIG9EYXRhLmlDcmVhdGUgPCBpT2xkVGltZSApCgkJCQkJCXsKCQkJCQkJCXNPbGROYW1lID0gYVNwbGl0Q29va2llWzBdOwoJCQkJCQkJaU9sZFRpbWUgPSBvRGF0YS5pQ3JlYXRlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQlpZiAoIHNPbGROYW1lICE9PSAiIiApCgkJCQl7CgkJCQkJZG9jdW1lbnQuY29va2llID0gc09sZE5hbWUrIj07IGV4cGlyZXM9VGh1LCAwMS1KYW4tMTk3MCAwMDowMDowMSBHTVQ7IHBhdGg9IisKCQkJCQkJYVBhcnRzLmpvaW4oJy8nKSArICIvIjsKCQkJCX0KCQkJfQoJCQkKCQkJZG9jdW1lbnQuY29va2llID0gc0Z1bGxDb29raWU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlYWQgYW4gb2xkIGNvb2tpZSB0byBnZXQgYSBjb29raWUgd2l0aCBhbiBvbGQgdGFibGUgc3RhdGUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNOYW1lIG5hbWUgb2YgdGhlIGNvb2tpZSB0byByZWFkCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGNvbnRlbnRzIG9mIHRoZSBjb29raWUgLSBvciBudWxsIGlmIG5vIGNvb2tpZSB3aXRoIHRoYXQgbmFtZSBmb3VuZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZWFkQ29va2llICggc05hbWUgKQoJCXsKCQkJdmFyCgkJCQlhUGFydHMgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKSwKCQkJCXNOYW1lRVEgPSBzTmFtZSArICdfJyArIGFQYXJ0c1thUGFydHMubGVuZ3RoLTFdLnJlcGxhY2UoL1tcLzpdL2csIiIpLnRvTG93ZXJDYXNlKCkgKyAnPScsCgkJCSAJc0Nvb2tpZUNvbnRlbnRzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7CgkJCQoJCQlmb3IoIHZhciBpPTAgOyBpPHNDb29raWVDb250ZW50cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQl2YXIgYyA9IHNDb29raWVDb250ZW50c1tpXTsKCQkJCQoJCQkJd2hpbGUgKGMuY2hhckF0KDApPT0nICcpCgkJCQl7CgkJCQkJYyA9IGMuc3Vic3RyaW5nKDEsYy5sZW5ndGgpOwoJCQkJfQoJCQkJCgkJCQlpZiAoYy5pbmRleE9mKHNOYW1lRVEpID09PSAwKQoJCQkJewoJCQkJCXJldHVybiBkZWNvZGVVUklDb21wb25lbnQoIGMuc3Vic3RyaW5nKHNOYW1lRVEubGVuZ3RoLGMubGVuZ3RoKSApOwoJCQkJfQoJCQl9CgkJCXJldHVybiBudWxsOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gdGhlIHNldHRpbmdzIG9iamVjdCBmb3IgYSBwYXJ0aWN1bGFyIHRhYmxlCgkJICogIEBwYXJhbSB7bm9kZX0gblRhYmxlIHRhYmxlIHdlIGFyZSB1c2luZyBhcyBhIGRhdGFUYWJsZQoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBTZXR0aW5ncyBvYmplY3QgLSBvciBudWxsIGlmIG5vdCBmb3VuZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXR0aW5nc0Zyb21Ob2RlICggblRhYmxlICkKCQl7CgkJCWZvciAoIHZhciBpPTAgOyBpPERhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5uVGFibGUgPT09IG5UYWJsZSApCgkJCQl7CgkJCQkJcmV0dXJuIERhdGFUYWJsZS5zZXR0aW5nc1tpXTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiBhbiBhcnJheSB3aXRoIHRoZSBUUiBub2RlcyBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBUUiBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRUck5vZGVzICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBhTm9kZXMgPSBbXTsKCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGE7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJYU5vZGVzLnB1c2goIGFvRGF0YVtpXS5uVHIgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gYU5vZGVzOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gZmxhdCBhcnJheSB3aXRoIGFsbCBURCBub2RlcyBmb3IgdGhlIHRhYmxlLCBvciByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gW2lJbmRpdmlkdWFsUm93XSBhb0RhdGEgaW5kZXggdG8gZ2V0IHRoZSBub2RlcyBmb3IgLSBvcHRpb25hbCAKCQkgKiAgICBpZiBub3QgZ2l2ZW4gdGhlbiB0aGUgcmV0dXJuIGFycmF5IHdpbGwgY29udGFpbiBhbGwgbm9kZXMgZm9yIHRoZSB0YWJsZQoJCSAqICBAcmV0dXJucyB7YXJyYXl9IFREIGFycmF5CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldFRkTm9kZXMgKCBvU2V0dGluZ3MsIGlJbmRpdmlkdWFsUm93ICkKCQl7CgkJCXZhciBhblJldHVybiA9IFtdOwoJCQl2YXIgaUNvcnJlY3RvcjsKCQkJdmFyIGFuVGRzOwoJCQl2YXIgaVJvdywgaVJvd3M9b1NldHRpbmdzLmFvRGF0YS5sZW5ndGgsCgkJCQlpQ29sdW1uLCBpQ29sdW1ucywgb0RhdGEsIHNOb2RlTmFtZSwgaVN0YXJ0PTAsIGlFbmQ9aVJvd3M7CgkJCQoJCQkvKiBBbGxvdyB0aGUgY29sbGVjdGlvbiB0byBiZSBsaW1pdGVkIHRvIGp1c3Qgb25lIHJvdyAqLwoJCQlpZiAoIGlJbmRpdmlkdWFsUm93ICE9PSB1bmRlZmluZWQgKQoJCQl7CgkJCQlpU3RhcnQgPSBpSW5kaXZpZHVhbFJvdzsKCQkJCWlFbmQgPSBpSW5kaXZpZHVhbFJvdysxOwoJCQl9CgkJCgkJCWZvciAoIGlSb3c9aVN0YXJ0IDsgaVJvdzxpRW5kIDsgaVJvdysrICkKCQkJewoJCQkJb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQkJaWYgKCBvRGF0YS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCS8qIGdldCB0aGUgVEQgY2hpbGQgbm9kZXMgLSB0YWtpbmcgaW50byBhY2NvdW50IHRleHQgZXRjIG5vZGVzICovCgkJCQkJYW5UZHMgPSBbXTsKCQkJCQlmb3IgKCBpQ29sdW1uPTAsIGlDb2x1bW5zPW9EYXRhLm5Uci5jaGlsZE5vZGVzLmxlbmd0aCA7IGlDb2x1bW48aUNvbHVtbnMgOyBpQ29sdW1uKysgKQoJCQkJCXsKCQkJCQkJc05vZGVOYW1lID0gb0RhdGEublRyLmNoaWxkTm9kZXNbaUNvbHVtbl0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJCQkJaWYgKCBzTm9kZU5hbWUgPT0gJ3RkJyB8fCBzTm9kZU5hbWUgPT0gJ3RoJyApCgkJCQkJCXsKCQkJCQkJCWFuVGRzLnB1c2goIG9EYXRhLm5Uci5jaGlsZE5vZGVzW2lDb2x1bW5dICk7CgkJCQkJCX0KCQkJCQl9CgkJCgkJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQkJZm9yICggaUNvbHVtbj0wLCBpQ29sdW1ucz1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGlDb2x1bW48aUNvbHVtbnMgOyBpQ29sdW1uKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJYW5SZXR1cm4ucHVzaCggYW5UZHNbaUNvbHVtbi1pQ29ycmVjdG9yXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJYW5SZXR1cm4ucHVzaCggb0RhdGEuX2FuSGlkZGVuW2lDb2x1bW5dICk7CgkJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJcmV0dXJuIGFuUmV0dXJuOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBMb2cgYW4gZXJyb3IgbWVzc2FnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTGV2ZWwgbG9nIGVycm9yIG1lc3NhZ2VzLCBvciBkaXNwbGF5IHRoZW0gdG8gdGhlIHVzZXIKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNNZXNnIGVycm9yIG1lc3NhZ2UKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTG9nKCBvU2V0dGluZ3MsIGlMZXZlbCwgc01lc2cgKQoJCXsKCQkJdmFyIHNBbGVydCA9IChvU2V0dGluZ3M9PT1udWxsKSA/CgkJCQkiRGF0YVRhYmxlcyB3YXJuaW5nOiAiK3NNZXNnIDoKCQkJCSJEYXRhVGFibGVzIHdhcm5pbmcgKHRhYmxlIGlkID0gJyIrb1NldHRpbmdzLnNUYWJsZUlkKyInKTogIitzTWVzZzsKCQkJCgkJCWlmICggaUxldmVsID09PSAwICkKCQkJewoJCQkJaWYgKCBEYXRhVGFibGUuZXh0LnNFcnJNb2RlID09ICdhbGVydCcgKQoJCQkJewoJCQkJCWFsZXJ0KCBzQWxlcnQgKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQl0aHJvdyBzQWxlcnQ7CgkJCQl9CgkJCQlyZXR1cm47CgkJCX0KCQkJZWxzZSBpZiAoIGNvbnNvbGUgIT09IHVuZGVmaW5lZCAmJiBjb25zb2xlLmxvZyApCgkJCXsKCQkJCWNvbnNvbGUubG9nKCBzQWxlcnQgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBTZWUgaWYgYSBwcm9wZXJ0eSBpcyBkZWZpbmVkIG9uIG9uZSBvYmplY3QsIGlmIHNvIGFzc2lnbiBpdCB0byB0aGUgb3RoZXIgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvUmV0IHRhcmdldCBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TcmMgc291cmNlIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgcHJvcGVydHkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtzTWFwcGVkTmFtZV0gbmFtZSB0byBtYXAgdG9vIC0gb3B0aW9uYWwsIHNOYW1lIHVzZWQgaWYgbm90IGdpdmVuCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk1hcCggb1JldCwgb1NyYywgc05hbWUsIHNNYXBwZWROYW1lICkKCQl7CgkJCWlmICggc01hcHBlZE5hbWUgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXNNYXBwZWROYW1lID0gc05hbWU7CgkJCX0KCQkJaWYgKCBvU3JjW3NOYW1lXSAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJb1JldFtzTWFwcGVkTmFtZV0gPSBvU3JjW3NOYW1lXTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBFeHRlbmQgb2JqZWN0cyAtIHZlcnkgc2ltaWxhciB0byBqUXVlcnkuZXh0ZW5kLCBidXQgZGVlcCBjb3B5IG9iamVjdHMsIGFuZCBzaGFsbG93CgkJICogY29weSBhcnJheXMuIFRoZSByZWFzb24gd2UgbmVlZCB0byBkbyB0aGlzLCBpcyB0aGF0IHdlIGRvbid0IHdhbnQgdG8gZGVlcCBjb3B5IGFycmF5CgkJICogaW5pdCB2YWx1ZXMgKHN1Y2ggYXMgYWFTb3J0aW5nKSBzaW5jZSB0aGUgZGV2IHdvdWxkbid0IGJlIGFibGUgdG8gb3ZlcnJpZGUgdGhlbSwgYnV0CgkJICogd2UgZG8gd2FudCB0byBkZWVwIGNvcHkgYXJyYXlzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb091dCBPYmplY3QgdG8gZXh0ZW5kCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRXh0ZW5kZXIgT2JqZWN0IGZyb20gd2hpY2ggdGhlIHByb3BlcnRpZXMgd2lsbCBiZSBhcHBsaWVkIHRvIG9PdXQKCQkgKiAgQHJldHVybnMge29iamVjdH0gb091dCBSZWZlcmVuY2UsIGp1c3QgZm9yIGNvbnZlbmllbmNlIC0gb091dCA9PT0gdGhlIHJldHVybi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICogIEB0b2RvIFRoaXMgZG9lc24ndCB0YWtlIGFjY291bnQgb2YgYXJyYXlzIGluc2lkZSB0aGUgZGVlcCBjb3BpZWQgb2JqZWN0cy4KCQkgKi8KCQlmdW5jdGlvbiBfZm5FeHRlbmQoIG9PdXQsIG9FeHRlbmRlciApCgkJewoJCQlmb3IgKCB2YXIgcHJvcCBpbiBvT3V0ICkKCQkJewoJCQkJaWYgKCBvT3V0Lmhhc093blByb3BlcnR5KHByb3ApICYmIG9FeHRlbmRlcltwcm9wXSAhPT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlpZiAoIHR5cGVvZiBvSW5pdFtwcm9wXSA9PT0gJ29iamVjdCcgJiYgJC5pc0FycmF5KG9FeHRlbmRlcltwcm9wXSkgPT09IGZhbHNlICkKCQkJCQl7CgkJCQkJCSQuZXh0ZW5kKCB0cnVlLCBvT3V0W3Byb3BdLCBvRXh0ZW5kZXJbcHJvcF0gKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJb091dFtwcm9wXSA9IG9FeHRlbmRlcltwcm9wXTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJcmV0dXJuIG9PdXQ7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEJpbmQgYW4gZXZlbnQgaGFuZGVycyB0byBhbGxvdyBhIGNsaWNrIG9yIHJldHVybiBrZXkgdG8gYWN0aXZhdGUgdGhlIGNhbGxiYWNrLgoJCSAqIFRoaXMgaXMgZ29vZCBmb3IgYWNjZXNzYWJpbGl0eSBzaW5jZSBhIHJldHVybiBvbiB0aGUga2V5Ym9hcmQgd2lsbCBoYXZlIHRoZQoJCSAqIHNhbWUgZWZmZWN0IGFzIGEgY2xpY2ssIGlmIHRoZSBlbGVtZW50IGhhcyBmb2N1cy4KCQkgKiAgQHBhcmFtIHtlbGVtZW50fSBuIEVsZW1lbnQgdG8gYmluZCB0aGUgYWN0aW9uIHRvCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBEYXRhIG9iamVjdCB0byBwYXNzIHRvIHRoZSB0cmlnZ2VyZWQgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtmdW5jdGlvbikgZm4gQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIGV2ZW50IGlzIHRyaWdnZXJlZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CaW5kQWN0aW9uKCBuLCBvRGF0YSwgZm4gKQoJCXsKCQkJJChuKQoJCQkJLmJpbmQoICdjbGljay5EVCcsIG9EYXRhLCBmdW5jdGlvbiAoZSkgewoJCQkJCQlmbihlKTsKCQkJCQkJbi5ibHVyKCk7IC8vIFJlbW92ZSBmb2N1cyBvdXRsaW5lIGZvciBtb3VzZSB1c2VycwoJCQkJCX0gKQoJCQkJLmJpbmQoICdrZXlwcmVzcy5EVCcsIG9EYXRhLCBmdW5jdGlvbiAoZSl7CgkJCQkJaWYgKCBlLndoaWNoID09PSAxMyApIHsKCQkJCQkJZm4oZSk7CgkJCQkJfSB9ICkKCQkJCS5iaW5kKCAnc2VsZWN0c3RhcnQuRFQnLCBmdW5jdGlvbiAoKSB7CgkJCQkJLyogVGFrZSB0aGUgYnJ1dGFsIGFwcHJvYWNoIHRvIGNhbmNlbGxpbmcgdGV4dCBzZWxlY3Rpb24gKi8KCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWdpc3RlciBhIGNhbGxiYWNrIGZ1bmN0aW9uLiBFYXNpbHkgYWxsb3dzIGEgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgYWRkZWQgdG8KCQkgKiBhbiBhcnJheSBzdG9yZSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgdGhhdCBjYW4gdGhlbiBhbGwgYmUgY2FsbGVkIHRvZ2V0aGVyLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU3RvcmUgTmFtZSBvZiB0aGUgYXJyYXkgc3RvcmVhZ2UgZm9yIHRoZSBjYWxsYmFja3MgaW4gb1NldHRpbmdzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiYWNrCgkJICogIEBwYXJhbSB7c3RyaW5nKSBzTmFtZSBJZGVudGlmeWluZyBuYW1lIGZvciB0aGUgY2FsbGJhY2sgKGkuZS4gYSBsYWJlbCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgc1N0b3JlLCBmbiwgc05hbWUgKQoJCXsKCQkJaWYgKCBmbiApCgkJCXsKCQkJCW9TZXR0aW5nc1tzU3RvcmVdLnB1c2goIHsKCQkJCQkiZm4iOiBmbiwKCQkJCQkic05hbWUiOiBzTmFtZQoJCQkJfSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpcmUgY2FsbGJhY2sgZnVuY3Rpb25zIGFuZCB0cmlnZ2VyIGV2ZW50cy4gTm90ZSB0aGF0IHRoZSBsb29wIG92ZXIgdGhlIGNhbGxiYWNrCgkJICogYXJyYXkgc3RvcmUgaXMgZG9uZSBiYWNrd2FyZHMhIEZ1cnRoZXIgbm90ZSB0aGF0IHlvdSBkbyBub3Qgd2FudCB0byBmaXJlIG9mZiB0cmlnZ2VycwoJCSAqIGluIHRpbWUgc2Vuc2l0aXZlIGFwcGxpY2F0aW9ucyAoZm9yIGV4YW1wbGUgY2VsbCBjcmVhdGlvbikgYXMgaXRzIHNsb3cuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTdG9yZSBOYW1lIG9mIHRoZSBhcnJheSBzdG9yZWFnZSBmb3IgdGhlIGNhbGxiYWNrcyBpbiBvU2V0dGluZ3MKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUcmlnZ2VyIE5hbWUgb2YgdGhlIGpRdWVyeSBjdXN0b20gZXZlbnQgdG8gdHJpZ2dlci4gSWYgbnVsbCBubyB0cmlnZ2VyCgkJICogICAgaXMgZmlyZWQKCQkgKiAgQHBhcmFtIHthcnJheSkgYUFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIHBhc3MgdG8gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIC8gdHJpZ2dlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgc1N0b3JlLCBzVHJpZ2dlciwgYUFyZ3MgKQoJCXsKCQkJdmFyIGFvU3RvcmUgPSBvU2V0dGluZ3Nbc1N0b3JlXTsKCQkJdmFyIGFSZXQgPVtdOwoJCQoJCQlmb3IgKCB2YXIgaT1hb1N0b3JlLmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCWFSZXQucHVzaCggYW9TdG9yZVtpXS5mbi5hcHBseSggb1NldHRpbmdzLm9JbnN0YW5jZSwgYUFyZ3MgKSApOwoJCQl9CgkJCgkJCWlmICggc1RyaWdnZXIgIT09IG51bGwgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoc1RyaWdnZXIsIGFBcmdzKTsKCQkJfQoJCQoJCQlyZXR1cm4gYVJldDsKCQl9CgkJCgkJCgkJLyoqCgkJICogSlNPTiBzdHJpbmdpZnkuIElmIEpTT04uc3RyaW5naWZ5IGl0IHByb3ZpZGVkIGJ5IHRoZSBicm93c2VyLCBqc29uMi5qcyBvciBhbnkgb3RoZXIKCQkgKiBsaWJyYXJ5LCB0aGVuIHdlIHVzZSB0aGF0IGFzIGl0IGlzIGZhc3QsIHNhZmUgYW5kIGFjY3VyYXRlLiBJZiB0aGUgZnVuY3Rpb24gaXNuJ3QgCgkJICogYXZhaWxhYmxlIHRoZW4gd2UgbmVlZCB0byBidWlsdCBpdCBvdXJzZWx2ZXMgLSB0aGUgaW5zcGVyYXRpb24gZm9yIHRoaXMgZnVuY3Rpb24gY29tZXMKCQkgKiBmcm9tIENyYWlnIEJ1Y2tsZXIgKCBodHRwOi8vd3d3LnNpdGVwb2ludC5jb20vamF2YXNjcmlwdC1qc29uLXNlcmlhbGl6YXRpb24vICkuIEl0IGlzCgkJICogbm90IHBlcmZlY3QgYW5kIGFic29sdXRlbHkgc2hvdWxkIG5vdCBiZSB1c2VkIGFzIGEgcmVwbGFjZW1lbnQgdG8ganNvbjIuanMgLSBidXQgaXQgZG9lcwoJCSAqIGRvIHdoYXQgd2UgbmVlZCwgd2l0aG91dCByZXF1aXJpbmcgYSBkZXBlbmRlbmN5IGZvciBEYXRhVGFibGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBKU09OIG9iamVjdCB0byBiZSBjb252ZXJ0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gSlNPTiBzdHJpbmcKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJdmFyIF9mbkpzb25TdHJpbmcgPSAod2luZG93LkpTT04pID8gSlNPTi5zdHJpbmdpZnkgOiBmdW5jdGlvbiggbyApCgkJewoJCQkvKiBOb3QgYW4gb2JqZWN0IG9yIGFycmF5ICovCgkJCXZhciBzVHlwZSA9IHR5cGVvZiBvOwoJCQlpZiAoc1R5cGUgIT09ICJvYmplY3QiIHx8IG8gPT09IG51bGwpCgkJCXsKCQkJCS8vIHNpbXBsZSBkYXRhIHR5cGUKCQkJCWlmIChzVHlwZSA9PT0gInN0cmluZyIpCgkJCQl7CgkJCQkJbyA9ICciJytvKyciJzsKCQkJCX0KCQkJCXJldHVybiBvKyIiOwoJCQl9CgkJCgkJCS8qIElmIG9iamVjdCBvciBhcnJheSwgbmVlZCB0byByZWN1cnNlIG92ZXIgaXQgKi8KCQkJdmFyCgkJCQlzUHJvcCwgbVZhbHVlLAoJCQkJanNvbiA9IFtdLAoJCQkJYkFyciA9ICQuaXNBcnJheShvKTsKCQkJCgkJCWZvciAoc1Byb3AgaW4gbykKCQkJewoJCQkJbVZhbHVlID0gb1tzUHJvcF07CgkJCQlzVHlwZSA9IHR5cGVvZiBtVmFsdWU7CgkJCgkJCQlpZiAoc1R5cGUgPT09ICJzdHJpbmciKQoJCQkJewoJCQkJCW1WYWx1ZSA9ICciJyttVmFsdWUrJyInOwoJCQkJfQoJCQkJZWxzZSBpZiAoc1R5cGUgPT09ICJvYmplY3QiICYmIG1WYWx1ZSAhPT0gbnVsbCkKCQkJCXsKCQkJCQltVmFsdWUgPSBfZm5Kc29uU3RyaW5nKG1WYWx1ZSk7CgkJCQl9CgkJCgkJCQlqc29uLnB1c2goKGJBcnIgPyAiIiA6ICciJytzUHJvcCsnIjonKSArIG1WYWx1ZSk7CgkJCX0KCQkKCQkJcmV0dXJuIChiQXJyID8gIlsiIDogInsiKSArIGpzb24gKyAoYkFyciA/ICJdIiA6ICJ9Iik7CgkJfTsKCQkKCgkJCgkJCgkJLyoqCgkJICogUGVyZm9ybSBhIGpRdWVyeSBzZWxlY3RvciBhY3Rpb24gb24gdGhlIHRhYmxlJ3MgVFIgZWxlbWVudHMgKGZyb20gdGhlIHRib2R5KSBhbmQKCQkgKiByZXR1cm4gdGhlIHJlc3VsdGluZyBqUXVlcnkgb2JqZWN0LgoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gc1NlbGVjdG9yIGpRdWVyeSBzZWxlY3RvciBvciBub2RlIGNvbGxlY3Rpb24gdG8gYWN0IG9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBbb09wdHNdIE9wdGlvbmFsIHBhcmFtZXRlcnMgZm9yIG1vZGlmeWluZyB0aGUgcm93cyB0byBiZSBpbmNsdWRlZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLmZpbHRlcj1ub25lXSBTZWxlY3QgVFIgZWxlbWVudHMgdGhhdCBtZWV0IHRoZSBjdXJyZW50IGZpbHRlcgoJCSAqICAgIGNyaXRlcmlvbiAoImFwcGxpZWQiKSBvciBhbGwgVFIgZWxlbWVudHMgKGkuZS4gbm8gZmlsdGVyKS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5vcmRlcj1jdXJyZW50XSBPcmRlciBvZiB0aGUgVFIgZWxlbWVudHMgaW4gdGhlIHByb2Nlc3NlZCBhcnJheS4KCQkgKiAgICBDYW4gYmUgZWl0aGVyICdjdXJyZW50Jywgd2hlcmVieSB0aGUgY3VycmVudCBzb3J0aW5nIG9mIHRoZSB0YWJsZSBpcyB1c2VkLCBvcgoJCSAqICAgICdvcmlnaW5hbCcgd2hlcmVieSB0aGUgb3JpZ2luYWwgb3JkZXIgdGhlIGRhdGEgd2FzIHJlYWQgaW50byB0aGUgdGFibGUgaXMgdXNlZC4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5wYWdlPWFsbF0gTGltaXQgdGhlIHNlbGVjdGlvbiB0byB0aGUgY3VycmVudGx5IGRpc3BsYXllZCBwYWdlCgkJICogICAgKCJjdXJyZW50Iikgb3Igbm90ICgiYWxsIikuIElmICdjdXJyZW50JyBpcyBnaXZlbiwgdGhlbiBvcmRlciBpcyBhc3N1bWVkIHRvIGJlIAoJCSAqICAgICdjdXJyZW50JyBhbmQgZmlsdGVyIGlzICdhcHBsaWVkJywgcmVnYXJkbGVzcyBvZiB3aGF0IHRoZXkgbWlnaHQgYmUgZ2l2ZW4gYXMuCgkJICogIEByZXR1cm5zIHtvYmplY3R9IGpRdWVyeSBvYmplY3QsIGZpbHRlcmVkIGJ5IHRoZSBnaXZlbiBzZWxlY3Rvci4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gSGlnaGxpZ2h0IGV2ZXJ5IHNlY29uZCByb3cKCQkgKiAgICAgIG9UYWJsZS4kKCd0cjpvZGQnKS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICdibHVlJyk7CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gRmlsdGVyIHRvIHJvd3Mgd2l0aCAnV2Via2l0JyBpbiB0aGVtLCBhZGQgYSBiYWNrZ3JvdW5kIGNvbG91ciBhbmQgdGhlbgoJCSAqICAgICAgLy8gcmVtb3ZlIHRoZSBmaWx0ZXIsIHRodXMgaGlnaGxpZ2h0aW5nIHRoZSAnV2Via2l0JyByb3dzIG9ubHkuCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJ1dlYmtpdCcpOwoJCSAqICAgICAgb1RhYmxlLiQoJ3RyJywgeyJmaWx0ZXIiOiAiYXBwbGllZCJ9KS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICdibHVlJyk7CgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJycpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLiQgPSBmdW5jdGlvbiAoIHNTZWxlY3Rvciwgb09wdHMgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGEgPSBbXTsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCgkJCWlmICggIW9PcHRzICkKCQkJewoJCQkJb09wdHMgPSB7fTsKCQkJfQoJCQoJCQlvT3B0cyA9ICQuZXh0ZW5kKCB7fSwgewoJCQkJImZpbHRlciI6ICJub25lIiwgLy8gYXBwbGllZAoJCQkJIm9yZGVyIjogImN1cnJlbnQiLCAvLyAib3JpZ2luYWwiCgkJCQkicGFnZSI6ICJhbGwiIC8vIGN1cnJlbnQKCQkJfSwgb09wdHMgKTsKCQkKCQkJLy8gQ3VycmVudCBwYWdlIGltcGxpZXMgdGhhdCBvcmRlcj1jdXJyZW50IGFuZCBmaXRsZXI9YXBwbGllZCwgc2luY2UgaXQgaXMgZmFpcmx5CgkJCS8vIHNlbnNlbGVzcyBvdGhlcndpc2UKCQkJaWYgKCBvT3B0cy5wYWdlID09ICdjdXJyZW50JyApCgkJCXsKCQkJCWZvciAoIGk9b1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0LCBpTGVuPW9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYS5wdXNoKCBvU2V0dGluZ3MuYW9EYXRhWyBvU2V0dGluZ3MuYWlEaXNwbGF5W2ldIF0ublRyICk7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJjdXJyZW50IiAmJiBvT3B0cy5maWx0ZXIgPT0gIm5vbmUiICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhLnB1c2goIG9TZXR0aW5ncy5hb0RhdGFbIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXJbaV0gXS5uVHIgKTsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gImN1cnJlbnQiICYmIG9PcHRzLmZpbHRlciA9PSAiYXBwbGllZCIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWEucHVzaCggb1NldHRpbmdzLmFvRGF0YVsgb1NldHRpbmdzLmFpRGlzcGxheVtpXSBdLm5UciApOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAib3JpZ2luYWwiICYmIG9PcHRzLmZpbHRlciA9PSAibm9uZSIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWEucHVzaCggb1NldHRpbmdzLmFvRGF0YVsgaSBdLm5UciApOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAib3JpZ2luYWwiICYmIG9PcHRzLmZpbHRlciA9PSAiYXBwbGllZCIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggJC5pbkFycmF5KCBpLCBvU2V0dGluZ3MuYWlEaXNwbGF5ICkgIT09IC0xICkKCQkJCQl7CgkJCQkJCWEucHVzaCggb1NldHRpbmdzLmFvRGF0YVsgaSBdLm5UciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mbkxvZyggb1NldHRpbmdzLCAxLCAiVW5rbm93biBzZWxlY3Rpb24gb3B0aW9ucyIgKTsKCQkJfQoJCQoJCQkvKiBXZSBuZWVkIHRvIGZpbHRlciBvbiB0aGUgVFIgZWxlbWVudHMgYW5kIGFsc28gJ2ZpbmQnIGluIHRoZWlyIGRlc2NlbmRhbnRzCgkJCSAqIHRvIG1ha2UgdGhlIHNlbGVjdG9yIGFjdCBsaWtlIGl0IHdvdWxkIGluIGEgZnVsbCB0YWJsZSAtIHNvIHdlIG5lZWQKCQkJICogdG8gYnVpbGQgYm90aCByZXN1bHRzIGFuZCB0aGVuIGNvbWJpbmUgdGhlbSB0b2dldGhlcgoJCQkgKi8KCQkJdmFyIGpxQSA9ICQoYSk7CgkJCXZhciBqcVRScyA9IGpxQS5maWx0ZXIoIHNTZWxlY3RvciApOwoJCQl2YXIganFEZXNjZW5kYW50cyA9IGpxQS5maW5kKCBzU2VsZWN0b3IgKTsKCQkKCQkJcmV0dXJuICQoIFtdLmNvbmNhdCgkLm1ha2VBcnJheShqcVRScyksICQubWFrZUFycmF5KGpxRGVzY2VuZGFudHMpKSApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQWxtb3N0IGlkZW50aWNhbCB0byAkIGluIG9wZXJhdGlvbiwgYnV0IGluIHRoaXMgY2FzZSByZXR1cm5zIHRoZSBkYXRhIGZvciB0aGUgbWF0Y2hlZAoJCSAqIHJvd3MgLSBhcyBzdWNoLCB0aGUgalF1ZXJ5IHNlbGVjdG9yIHVzZWQgc2hvdWxkIG1hdGNoIFRSIHJvdyBub2RlcyBvciBURC9USCBjZWxsIG5vZGVzCgkJICogcmF0aGVyIHRoYW4gYW55IGRlY2VuZGVudHMsIHNvIHRoZSBkYXRhIGNhbiBiZSBvYnRhaW5lZCBmb3IgdGhlIHJvdy9jZWxsLiBJZiBtYXRjaGluZwoJCSAqIHJvd3MgYXJlIGZvdW5kLCB0aGUgZGF0YSByZXR1cm5lZCBpcyB0aGUgb3JpZ2luYWwgZGF0YSBhcnJheS9vYmplY3QgdGhhdCB3YXMgdXNlZCB0byAgCgkJICogY3JlYXRlIHRoZSByb3cgKG9yIGEgZ2VuZXJhdGVkIGFycmF5IGlmIGZyb20gYSBET00gc291cmNlKS4KCQkgKgoJCSAqIFRoaXMgbWV0aG9kIGlzIG9mdGVuIHVzZWZ1bCBpbmNvbWJpbmF0aW9uIHdpdGggJCB3aGVyZSBib3RoIGZ1bmN0aW9ucyBhcmUgZ2l2ZW4gdGhlCgkJICogc2FtZSBwYXJhbWV0ZXJzIGFuZCB0aGUgYXJyYXkgaW5kZXhlcyB3aWxsIG1hdGNoIGlkZW50aWNhbGx5LgoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gc1NlbGVjdG9yIGpRdWVyeSBzZWxlY3RvciBvciBub2RlIGNvbGxlY3Rpb24gdG8gYWN0IG9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBbb09wdHNdIE9wdGlvbmFsIHBhcmFtZXRlcnMgZm9yIG1vZGlmeWluZyB0aGUgcm93cyB0byBiZSBpbmNsdWRlZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLmZpbHRlcj1ub25lXSBTZWxlY3QgZWxlbWVudHMgdGhhdCBtZWV0IHRoZSBjdXJyZW50IGZpbHRlcgoJCSAqICAgIGNyaXRlcmlvbiAoImFwcGxpZWQiKSBvciBhbGwgZWxlbWVudHMgKGkuZS4gbm8gZmlsdGVyKS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5vcmRlcj1jdXJyZW50XSBPcmRlciBvZiB0aGUgZGF0YSBpbiB0aGUgcHJvY2Vzc2VkIGFycmF5LgoJCSAqICAgIENhbiBiZSBlaXRoZXIgJ2N1cnJlbnQnLCB3aGVyZWJ5IHRoZSBjdXJyZW50IHNvcnRpbmcgb2YgdGhlIHRhYmxlIGlzIHVzZWQsIG9yCgkJICogICAgJ29yaWdpbmFsJyB3aGVyZWJ5IHRoZSBvcmlnaW5hbCBvcmRlciB0aGUgZGF0YSB3YXMgcmVhZCBpbnRvIHRoZSB0YWJsZSBpcyB1c2VkLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLnBhZ2U9YWxsXSBMaW1pdCB0aGUgc2VsZWN0aW9uIHRvIHRoZSBjdXJyZW50bHkgZGlzcGxheWVkIHBhZ2UKCQkgKiAgICAoImN1cnJlbnQiKSBvciBub3QgKCJhbGwiKS4gSWYgJ2N1cnJlbnQnIGlzIGdpdmVuLCB0aGVuIG9yZGVyIGlzIGFzc3VtZWQgdG8gYmUgCgkJICogICAgJ2N1cnJlbnQnIGFuZCBmaWx0ZXIgaXMgJ2FwcGxpZWQnLCByZWdhcmRsZXNzIG9mIHdoYXQgdGhleSBtaWdodCBiZSBnaXZlbiBhcy4KCQkgKiAgQHJldHVybnMge2FycmF5fSBEYXRhIGZvciB0aGUgbWF0Y2hlZCBlbGVtZW50cy4gSWYgYW55IGVsZW1lbnRzLCBhcyBhIHJlc3VsdCBvZiB0aGUKCQkgKiAgICBzZWxlY3Rvciwgd2VyZSBub3QgVFIsIFREIG9yIFRIIGVsZW1lbnRzIGluIHRoZSBEYXRhVGFibGUsIHRoZXkgd2lsbCBoYXZlIGEgbnVsbCAKCQkgKiAgICBlbnRyeSBpbiB0aGUgYXJyYXkuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIC8vIEdldCB0aGUgZGF0YSBmcm9tIHRoZSBmaXJzdCByb3cgaW4gdGhlIHRhYmxlCgkJICogICAgICB2YXIgZGF0YSA9IG9UYWJsZS5fKCd0cjpmaXJzdCcpOwoJCSAqCgkJICogICAgICAvLyBEbyBzb21ldGhpbmcgdXNlZnVsIHdpdGggdGhlIGRhdGEKCQkgKiAgICAgIGFsZXJ0KCAiRmlyc3QgY2VsbCBpczogIitkYXRhWzBdICk7CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gRmlsdGVyIHRvICdXZWJraXQnIGFuZCBnZXQgYWxsIGRhdGEgZm9yIAoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCdXZWJraXQnKTsKCQkgKiAgICAgIHZhciBkYXRhID0gb1RhYmxlLl8oJ3RyJywgeyJmaWx0ZXIiOiAiYXBwbGllZCJ9KTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gRG8gc29tZXRoaW5nIHdpdGggdGhlIGRhdGEKCQkgKiAgICAgIGFsZXJ0KCBkYXRhLmxlbmd0aCsiIHJvd3MgbWF0Y2hlZCB0aGUgZmlsdGVyIiApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLl8gPSBmdW5jdGlvbiAoIHNTZWxlY3Rvciwgb09wdHMgKQoJCXsKCQkJdmFyIGFPdXQgPSBbXTsKCQkJdmFyIGksIGlMZW4sIGlJbmRleDsKCQkJdmFyIGFUcnMgPSB0aGlzLiQoIHNTZWxlY3Rvciwgb09wdHMgKTsKCQkKCQkJZm9yICggaT0wLCBpTGVuPWFUcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYU91dC5wdXNoKCB0aGlzLmZuR2V0RGF0YShhVHJzW2ldKSApOwoJCQl9CgkJCgkJCXJldHVybiBhT3V0OwoJCX07CgkJCgkJCgkJLyoqCgkJICogQWRkIGEgc2luZ2xlIG5ldyByb3cgb3IgbXVsdGlwbGUgcm93cyBvZiBkYXRhIHRvIHRoZSB0YWJsZS4gUGxlYXNlIG5vdGUKCQkgKiB0aGF0IHRoaXMgaXMgc3VpdGFibGUgZm9yIGNsaWVudC1zaWRlIHByb2Nlc3Npbmcgb25seSAtIGlmIHlvdSBhcmUgdXNpbmcgCgkJICogc2VydmVyLXNpZGUgcHJvY2Vzc2luZyAoaS5lLiAiYlNlcnZlclNpZGUiOiB0cnVlKSwgdGhlbiB0byBhZGQgZGF0YSwgeW91CgkJICogbXVzdCBhZGQgaXQgdG8gdGhlIGRhdGEgc291cmNlLCBpLmUuIHRoZSBzZXJ2ZXItc2lkZSwgdGhyb3VnaCBhbiBBamF4IGNhbGwuCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBtRGF0YSBUaGUgZGF0YSB0byBiZSBhZGRlZCB0byB0aGUgdGFibGUuIFRoaXMgY2FuIGJlOgoJCSAqICAgIDx1bD4KCQkgKiAgICAgIDxsaT4xRCBhcnJheSBvZiBkYXRhIC0gYWRkIGEgc2luZ2xlIHJvdyB3aXRoIHRoZSBkYXRhIHByb3ZpZGVkPC9saT4KCQkgKiAgICAgIDxsaT4yRCBhcnJheSBvZiBhcnJheXMgLSBhZGQgbXVsdGlwbGUgcm93cyBpbiBhIHNpbmdsZSBjYWxsPC9saT4KCQkgKiAgICAgIDxsaT5vYmplY3QgLSBkYXRhIG9iamVjdCB3aGVuIHVzaW5nIDxpPm1EYXRhUHJvcDwvaT48L2xpPgoJCSAqICAgICAgPGxpPmFycmF5IG9mIG9iamVjdHMgLSBtdWx0aXBsZSBkYXRhIG9iamVjdHMgd2hlbiB1c2luZyA8aT5tRGF0YVByb3A8L2k+PC9saT4KCQkgKiAgICA8L3VsPgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIHJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEByZXR1cm5zIHthcnJheX0gQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlcHJlc2VudGluZyB0aGUgbGlzdCBvZiBpbmRleGVzIGluIAoJCSAqICAgIDxpPmFvRGF0YTwvaT4gKHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30pIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIAoJCSAqICAgIHRoZSB0YWJsZS4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2xvYmFsIHZhciBmb3IgY291bnRlcgoJCSAqICAgIHZhciBnaUNvdW50ID0gMjsKCQkgKiAgICAKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIGZuQ2xpY2tBZGRSb3coKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpLmZuQWRkRGF0YSggWwoJCSAqICAgICAgICBnaUNvdW50KyIuMSIsCgkJICogICAgICAgIGdpQ291bnQrIi4yIiwKCQkgKiAgICAgICAgZ2lDb3VudCsiLjMiLAoJCSAqICAgICAgICBnaUNvdW50KyIuNCIgXQoJCSAqICAgICAgKTsKCQkgKiAgICAgICAgCgkJICogICAgICBnaUNvdW50Kys7CgkJICogICAgfQoJCSAqLwoJCXRoaXMuZm5BZGREYXRhID0gZnVuY3Rpb24oIG1EYXRhLCBiUmVkcmF3ICkKCQl7CgkJCWlmICggbURhdGEubGVuZ3RoID09PSAwICkKCQkJewoJCQkJcmV0dXJuIFtdOwoJCQl9CgkJCQoJCQl2YXIgYWlSZXR1cm4gPSBbXTsKCQkJdmFyIGlUZXN0OwoJCQkKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQkvKiBDaGVjayBpZiB3ZSB3YW50IHRvIGFkZCBtdWx0aXBsZSByb3dzIG9yIG5vdCAqLwoJCQlpZiAoIHR5cGVvZiBtRGF0YVswXSA9PT0gIm9iamVjdCIgJiYgbURhdGFbMF0gIT09IG51bGwgKQoJCQl7CgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxtRGF0YS5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWlUZXN0ID0gX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBtRGF0YVtpXSApOwoJCQkJCWlmICggaVRlc3QgPT0gLTEgKQoJCQkJCXsKCQkJCQkJcmV0dXJuIGFpUmV0dXJuOwoJCQkJCX0KCQkJCQlhaVJldHVybi5wdXNoKCBpVGVzdCApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaVRlc3QgPSBfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG1EYXRhICk7CgkJCQlpZiAoIGlUZXN0ID09IC0xICkKCQkJCXsKCQkJCQlyZXR1cm4gYWlSZXR1cm47CgkJCQl9CgkJCQlhaVJldHVybi5wdXNoKCBpVGVzdCApOwoJCQl9CgkJCQoJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mblJlRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJcmV0dXJuIGFpUmV0dXJuOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiB3aWxsIG1ha2UgRGF0YVRhYmxlcyByZWNhbGN1bGF0ZSB0aGUgY29sdW1uIHNpemVzLCBiYXNlZCBvbiB0aGUgZGF0YSAKCQkgKiBjb250YWluZWQgaW4gdGhlIHRhYmxlIGFuZCB0aGUgc2l6ZXMgYXBwbGllZCB0byB0aGUgY29sdW1ucyAoaW4gdGhlIERPTSwgQ1NTIG9yIAoJCSAqIHRocm91Z2ggdGhlIHNXaWR0aCBwYXJhbWV0ZXIpLiBUaGlzIGNhbiBiZSB1c2VmdWwgd2hlbiB0aGUgd2lkdGggb2YgdGhlIHRhYmxlJ3MgCgkJICogcGFyZW50IGVsZW1lbnQgY2hhbmdlcyAoZm9yIGV4YW1wbGUgYSB3aW5kb3cgcmVzaXplKS4KCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdCwgeW91IHdpbGwgdHlwaWNhbGx5IHdhbnQgdG8KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgICAKCQkgKiAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIG9UYWJsZS5mbkFkanVzdENvbHVtblNpemluZygpOwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuQWRqdXN0Q29sdW1uU2l6aW5nID0gZnVuY3Rpb24gKCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdKTsKCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQl0aGlzLmZuRHJhdyggZmFsc2UgKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiIHx8IG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCS8qIElmIG5vdCByZWRyYXdpbmcsIGJ1dCBzY3JvbGxpbmcsIHdlIHdhbnQgdG8gYXBwbHkgdGhlIG5ldyBjb2x1bW4gc2l6ZXMgYW55d2F5ICovCgkJCQl0aGlzLm9BcGkuX2ZuU2Nyb2xsRHJhdyhvU2V0dGluZ3MpOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBRdWlja2x5IGFuZCBzaW1wbHkgY2xlYXIgYSB0YWJsZQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIHJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIEltbWVkaWF0ZWx5ICdudWtlJyB0aGUgY3VycmVudCByb3dzIChwZXJoYXBzIHdhaXRpbmcgZm9yIGFuIEFqYXggY2FsbGJhY2suLi4pCgkJICogICAgICBvVGFibGUuZm5DbGVhclRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5DbGVhclRhYmxlID0gZnVuY3Rpb24oIGJSZWRyYXcgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCV9mbkNsZWFyVGFibGUoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGUgZXhhY3Qgb3Bwb3NpdGUgb2YgJ29wZW5pbmcnIGEgcm93LCB0aGlzIGZ1bmN0aW9uIHdpbGwgY2xvc2UgYW55IHJvd3Mgd2hpY2ggCgkJICogYXJlIGN1cnJlbnRseSAnb3BlbicuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIHRoZSB0YWJsZSByb3cgdG8gJ2Nsb3NlJwoJCSAqICBAcmV0dXJucyB7aW50fSAwIG9uIHN1Y2Nlc3MsIG9yIDEgaWYgZmFpbGVkIChjYW4ndCBmaW5kIHRoZSByb3cpCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkNsb3NlID0gZnVuY3Rpb24oIG5UciApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWZvciAoIHZhciBpPTAgOyBpPG9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvT3BlblJvd3NbaV0ublBhcmVudCA9PSBuVHIgKQoJCQkJewoJCQkJCXZhciBuVHJQYXJlbnQgPSBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIucGFyZW50Tm9kZTsKCQkJCQlpZiAoIG5UclBhcmVudCApCgkJCQkJewoJCQkJCQkvKiBSZW1vdmUgaXQgaWYgaXQgaXMgY3VycmVudGx5IG9uIGRpc3BsYXkgKi8KCQkJCQkJblRyUGFyZW50LnJlbW92ZUNoaWxkKCBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIgKTsKCQkJCQl9CgkJCQkJb1NldHRpbmdzLmFvT3BlblJvd3Muc3BsaWNlKCBpLCAxICk7CgkJCQkJcmV0dXJuIDA7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIDE7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBSZW1vdmUgYSByb3cgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge21peGVkfSBtVGFyZ2V0IFRoZSBpbmRleCBvZiB0aGUgcm93IGZyb20gYW9EYXRhIHRvIGJlIGRlbGV0ZWQsIG9yCgkJICogICAgdGhlIFRSIGVsZW1lbnQgeW91IHdhbnQgdG8gZGVsZXRlCgkJICogIEBwYXJhbSB7ZnVuY3Rpb258bnVsbH0gW2ZuQ2FsbEJhY2tdIENhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBUaGUgcm93IHRoYXQgd2FzIGRlbGV0ZWQKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSW1tZWRpYXRlbHkgcmVtb3ZlIHRoZSBmaXJzdCByb3cKCQkgKiAgICAgIG9UYWJsZS5mbkRlbGV0ZVJvdyggMCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRGVsZXRlUm93ID0gZnVuY3Rpb24oIG1UYXJnZXQsIGZuQ2FsbEJhY2ssIGJSZWRyYXcgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuLCBpQU9EYXRhSW5kZXg7CgkJCQoJCQlpQU9EYXRhSW5kZXggPSAodHlwZW9mIG1UYXJnZXQgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVRhcmdldCkgOiBtVGFyZ2V0OwoJCQkKCQkJLyogUmV0dXJuIHRoZSBkYXRhIGFycmF5IGZyb20gdGhpcyByb3cgKi8KCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmFvRGF0YS5zcGxpY2UoIGlBT0RhdGFJbmRleCwgMSApOwoJCQoJCQkvKiBVcGRhdGUgdGhlIF9EVF9Sb3dJbmRleCBwYXJhbWV0ZXIgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIuX0RUX1Jvd0luZGV4ID0gaTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSB0YXJnZXQgcm93IGZyb20gdGhlIHNlYXJjaCBhcnJheSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaUFPRGF0YUluZGV4LCBvU2V0dGluZ3MuYWlEaXNwbGF5ICk7CgkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2guc3BsaWNlKCBpRGlzcGxheUluZGV4LCAxICk7CgkJCQoJCQkvKiBEZWxldGUgZnJvbSB0aGUgZGlzcGxheSBhcnJheXMgKi8KCQkJX2ZuRGVsZXRlSW5kZXgoIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIsIGlBT0RhdGFJbmRleCApOwoJCQlfZm5EZWxldGVJbmRleCggb1NldHRpbmdzLmFpRGlzcGxheSwgaUFPRGF0YUluZGV4ICk7CgkJCQoJCQkvKiBJZiB0aGVyZSBpcyBhIHVzZXIgY2FsbGJhY2sgZnVuY3Rpb24gLSBjYWxsIGl0ICovCgkJCWlmICggdHlwZW9mIGZuQ2FsbEJhY2sgPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlmbkNhbGxCYWNrLmNhbGwoIHRoaXMsIG9TZXR0aW5ncywgb0RhdGEgKTsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgZm9yIGFuICdvdmVyZmxvdycgdGhleSBjYXNlIGZvciBkaXNsYXlpbmcgdGhlIHRhYmxlICovCgkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID49IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IC09IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA8IDAgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCXJldHVybiBvRGF0YTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFJlc3RvcmUgdGhlIHRhYmxlIHRvIGl0J3Mgb3JpZ2luYWwgc3RhdGUgaW4gdGhlIERPTSBieSByZW1vdmluZyBhbGwgb2YgRGF0YVRhYmxlcyAKCQkgKiBlbmhhbmNlbWVudHMsIGFsdGVyYXRpb25zIHRvIHRoZSBET00gc3RydWN0dXJlIG9mIHRoZSB0YWJsZSBhbmQgZXZlbnQgbGlzdGVuZXJzLgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiUmVtb3ZlPWZhbHNlXSBDb21wbGV0ZWx5IHJlbW92ZSB0aGUgdGFibGUgZnJvbSB0aGUgRE9NCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgLy8gVGhpcyBleGFtcGxlIGlzIGZhaXJseSBwb2ludGxlc3MgaW4gcmVhbGl0eSwgYnV0IHNob3dzIGhvdyBmbkRlc3Ryb3kgY2FuIGJlIHVzZWQKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuRGVzdHJveSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRGVzdHJveSA9IGZ1bmN0aW9uICggYlJlbW92ZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIG5PcmlnID0gb1NldHRpbmdzLm5UYWJsZVdyYXBwZXIucGFyZW50Tm9kZTsKCQkJdmFyIG5Cb2R5ID0gb1NldHRpbmdzLm5UQm9keTsKCQkJdmFyIGksIGlMZW47CgkJCgkJCWJSZW1vdmUgPSAoYlJlbW92ZT09PXVuZGVmaW5lZCkgPyBmYWxzZSA6IHRydWU7CgkJCQoJCQkvKiBGbGFnIHRvIG5vdGUgdGhhdCB0aGUgdGFibGUgaXMgY3VycmVudGx5IGJlaW5nIGRlc3Ryb3llZCAtIG5vIGFjdGlvbiBzaG91bGQgYmUgdGFrZW4gKi8KCQkJb1NldHRpbmdzLmJEZXN0cm95aW5nID0gdHJ1ZTsKCQkJCgkJCS8qIFJlc3RvcmUgaGlkZGVuIGNvbHVtbnMgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0Rlc3Ryb3lDYWxsYmFjay5sZW5ndGggOyBpPGlMZW4gOyBpKysgKSB7CgkJCQlvU2V0dGluZ3MuYW9EZXN0cm95Q2FsbGJhY2tbaV0uZm4oKTsKCQkJfQoJCQkKCQkJLyogUmVzdG9yZSBoaWRkZW4gY29sdW1ucyAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgPT09IGZhbHNlICkKCQkJCXsKCQkJCQl0aGlzLmZuU2V0Q29sdW1uVmlzKCBpLCB0cnVlICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEJsaXR6IGFsbCBEVCBldmVudHMgKi8KCQkJJChvU2V0dGluZ3MublRhYmxlV3JhcHBlcikuZmluZCgnKicpLmFuZFNlbGYoKS51bmJpbmQoJy5EVCcpOwoJCQkKCQkJLyogSWYgdGhlcmUgaXMgYW4gJ2VtcHR5JyBpbmRpY2F0b3Igcm93LCByZW1vdmUgaXQgKi8KCQkJJCgndGJvZHk+dHI+dGQuJytvU2V0dGluZ3Mub0NsYXNzZXMuc1Jvd0VtcHR5LCBvU2V0dGluZ3MublRhYmxlKS5wYXJlbnQoKS5yZW1vdmUoKTsKCQkJCgkJCS8qIFdoZW4gc2Nyb2xsaW5nIHdlIGhhZCB0byBicmVhayB0aGUgdGFibGUgdXAgLSByZXN0b3JlIGl0ICovCgkJCWlmICggb1NldHRpbmdzLm5UYWJsZSAhPSBvU2V0dGluZ3MublRIZWFkLnBhcmVudE5vZGUgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmNoaWxkcmVuKCd0aGVhZCcpLnJlbW92ZSgpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5USGVhZCApOwoJCQl9CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgJiYgb1NldHRpbmdzLm5UYWJsZSAhPSBvU2V0dGluZ3MublRGb290LnBhcmVudE5vZGUgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5uVGFibGUpLmNoaWxkcmVuKCd0Zm9vdCcpLnJlbW92ZSgpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5URm9vdCApOwoJCQl9CgkJCQoJCQkvKiBSZW1vdmUgdGhlIERhdGFUYWJsZXMgZ2VuZXJhdGVkIG5vZGVzLCBldmVudHMgYW5kIGNsYXNzZXMgKi8KCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCSQob1NldHRpbmdzLm5UYWJsZVdyYXBwZXIpLnJlbW92ZSgpOwoJCQkKCQkJb1NldHRpbmdzLmFhU29ydGluZyA9IFtdOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgPSBbXTsKCQkJX2ZuU29ydGluZ0NsYXNzZXMoIG9TZXR0aW5ncyApOwoJCQkKCQkJJChfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKSkucmVtb3ZlQ2xhc3MoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMuam9pbignICcpICk7CgkJCQoJCQkkKCd0aCwgdGQnLCBvU2V0dGluZ3MublRIZWFkKS5yZW1vdmVDbGFzcyggWwoJCQkJb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZSwKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVBc2MsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlRGVzYywKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lIF0uam9pbignICcpCgkJCSk7CgkJCWlmICggb1NldHRpbmdzLmJKVUkgKQoJCQl7CgkJCQkkKCd0aCBzcGFuLicrb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SWNvbgoJCQkJCSsgJywgdGQgc3Bhbi4nK29TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb24sIG9TZXR0aW5ncy5uVEhlYWQpLnJlbW92ZSgpOwoJCQoJCQkJJCgndGgsIHRkJywgb1NldHRpbmdzLm5USGVhZCkuZWFjaCggZnVuY3Rpb24gKCkgewoJCQkJCXZhciBqcVdyYXBwZXIgPSAkKCdkaXYuJytvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRKVUlXcmFwcGVyLCB0aGlzKTsKCQkJCQl2YXIga2lkcyA9IGpxV3JhcHBlci5jb250ZW50cygpOwoJCQkJCSQodGhpcykuYXBwZW5kKCBraWRzICk7CgkJCQkJanFXcmFwcGVyLnJlbW92ZSgpOwoJCQkJfSApOwoJCQl9CgkJCQoJCQkvKiBBZGQgdGhlIFRSIGVsZW1lbnRzIGJhY2sgaW50byB0aGUgdGFibGUgaW4gdGhlaXIgb3JpZ2luYWwgb3JkZXIgKi8KCQkJaWYgKCAhYlJlbW92ZSAmJiBvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgKQoJCQl7CgkJCQluT3JpZy5pbnNlcnRCZWZvcmUoIG9TZXR0aW5ncy5uVGFibGUsIG9TZXR0aW5ncy5uVGFibGVSZWluc2VydEJlZm9yZSApOwoJCQl9CgkJCWVsc2UgaWYgKCAhYlJlbW92ZSApCgkJCXsKCQkJCW5PcmlnLmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCX0KCQkKCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJbkJvZHkuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5hb0RhdGFbaV0ublRyICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlc3RvcmUgdGhlIHdpZHRoIG9mIHRoZSBvcmlnaW5hbCB0YWJsZSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkF1dG9XaWR0aCA9PT0gdHJ1ZSApCgkJCXsKCQkJICBvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3Mob1NldHRpbmdzLnNEZXN0cm95V2lkdGgpOwoJCQl9CgkJCQoJCQkvKiBJZiB0aGUgd2VyZSBvcmlnaW5hbGx5IG9kZC9ldmVuIHR5cGUgY2xhc3NlcyAtIHRoZW4gd2UgYWRkIHRoZW0gYmFjayBoZXJlLiBOb3RlCgkJCSAqIHRoaXMgaXMgbm90IGZvb2wgcHJvb2YgKGZvciBleGFtcGxlIGlmIG5vdCBhbGwgcm93cyBhcyBvZGQvZXZlbiBjbGFzc2VzIC0gYnV0IAoJCQkgKiBpdCdzIGEgZ29vZCBlZmZvcnQgd2l0aG91dCBnZXR0aW5nIGNhcnJpZWQgYXdheQoJCQkgKi8KCQkJJChuQm9keSkuY2hpbGRyZW4oJ3RyOmV2ZW4nKS5hZGRDbGFzcyggb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKTsKCQkJJChuQm9keSkuY2hpbGRyZW4oJ3RyOm9kZCcpLmFkZENsYXNzKCBvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSApOwoJCQkKCQkJLyogUmVtb3ZlIHRoZSBzZXR0aW5ncyBvYmplY3QgZnJvbSB0aGUgc2V0dGluZ3MgYXJyYXkgKi8KCQkJZm9yICggaT0wLCBpTGVuPURhdGFUYWJsZS5zZXR0aW5ncy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXSA9PSBvU2V0dGluZ3MgKQoJCQkJewoJCQkJCURhdGFUYWJsZS5zZXR0aW5ncy5zcGxpY2UoIGksIDEgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRW5kIGl0IGFsbCAqLwoJCQlvU2V0dGluZ3MgPSBudWxsOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUmVkcmF3IHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiQ29tcGxldGU9dHJ1ZV0gUmUtZmlsdGVyIGFuZCByZXNvcnQgKGlmIGVuYWJsZWQpIHRoZSB0YWJsZSBiZWZvcmUgdGhlIGRyYXcuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFJlLWRyYXcgdGhlIHRhYmxlIC0geW91IHdvdWxkbid0IHdhbnQgdG8gZG8gaXQgaGVyZSwgYnV0IGl0J3MgYW4gZXhhbXBsZSA6LSkKCQkgKiAgICAgIG9UYWJsZS5mbkRyYXcoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkRyYXcgPSBmdW5jdGlvbiggYkNvbXBsZXRlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQlpZiAoIGJDb21wbGV0ZSApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCV9mblJlRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgaW5wdXQgYmFzZWQgb24gZGF0YQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IFN0cmluZyB0byBmaWx0ZXIgdGhlIHRhYmxlIG9uCgkJICogIEBwYXJhbSB7aW50fG51bGx9IFtpQ29sdW1uXSBDb2x1bW4gdG8gbGltaXQgZmlsdGVyaW5nIHRvCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWdleD1mYWxzZV0gVHJlYXQgYXMgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiU21hcnQ9dHJ1ZV0gUGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JTaG93R2xvYmFsPXRydWVdIFNob3cgdGhlIGlucHV0IGdsb2JhbCBmaWx0ZXIgaW4gaXQncyBpbnB1dCBib3goZXMpCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JDYXNlSW5zZW5zaXRpdmU9dHJ1ZV0gRG8gY2FzZS1pbnNlbnNpdGl2ZSBtYXRjaGluZyAodHJ1ZSkgb3Igbm90IChmYWxzZSkKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29tZXRpbWUgbGF0ZXIgLSBmaWx0ZXIuLi4KCQkgKiAgICAgIG9UYWJsZS5mbkZpbHRlciggJ3Rlc3Qgc3RyaW5nJyApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuRmlsdGVyID0gZnVuY3Rpb24oIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJTaG93R2xvYmFsLCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQlpZiAoIGJSZWdleCA9PT0gdW5kZWZpbmVkIHx8IGJSZWdleCA9PT0gbnVsbCApCgkJCXsKCQkJCWJSZWdleCA9IGZhbHNlOwoJCQl9CgkJCQoJCQlpZiAoIGJTbWFydCA9PT0gdW5kZWZpbmVkIHx8IGJTbWFydCA9PT0gbnVsbCApCgkJCXsKCQkJCWJTbWFydCA9IHRydWU7CgkJCX0KCQkJCgkJCWlmICggYlNob3dHbG9iYWwgPT09IHVuZGVmaW5lZCB8fCBiU2hvd0dsb2JhbCA9PT0gbnVsbCApCgkJCXsKCQkJCWJTaG93R2xvYmFsID0gdHJ1ZTsKCQkJfQoJCQkKCQkJaWYgKCBiQ2FzZUluc2Vuc2l0aXZlID09PSB1bmRlZmluZWQgfHwgYkNhc2VJbnNlbnNpdGl2ZSA9PT0gbnVsbCApCgkJCXsKCQkJCWJDYXNlSW5zZW5zaXRpdmUgPSB0cnVlOwoJCQl9CgkJCQoJCQlpZiAoIGlDb2x1bW4gPT09IHVuZGVmaW5lZCB8fCBpQ29sdW1uID09PSBudWxsICkKCQkJewoJCQkJLyogR2xvYmFsIGZpbHRlciAqLwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgewoJCQkJCSJzU2VhcmNoIjpzSW5wdXQrIiIsCgkJCQkJImJSZWdleCI6IGJSZWdleCwKCQkJCQkiYlNtYXJ0IjogYlNtYXJ0LAoJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogYkNhc2VJbnNlbnNpdGl2ZQoJCQkJfSwgMSApOwoJCQkJCgkJCQlpZiAoIGJTaG93R2xvYmFsICYmIG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mICkKCQkJCXsKCQkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJCXsKCQkJCQkJJCgnaW5wdXQnLCBuW2ldKS52YWwoIHNJbnB1dCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFNpbmdsZSBjb2x1bW4gZmlsdGVyICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbHVtbiBdLCB7CgkJCQkJInNTZWFyY2giOiBzSW5wdXQrIiIsCgkJCQkJImJSZWdleCI6IGJSZWdleCwKCQkJCQkiYlNtYXJ0IjogYlNtYXJ0LAoJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogYkNhc2VJbnNlbnNpdGl2ZQoJCQkJfSApOwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCwgMSApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGRhdGEgZm9yIHRoZSB3aG9sZSB0YWJsZSwgYW4gaW5kaXZpZHVhbCByb3cgb3IgYW4gaW5kaXZpZHVhbCBjZWxsIGJhc2VkIG9uIHRoZSAKCQkgKiBwcm92aWRlZCBwYXJhbWV0ZXJzLgoJCSAqICBAcGFyYW0ge2ludHxub2RlfSBbbVJvd10gQSBUUiByb3cgbm9kZSwgVEQvVEggY2VsbCBub2RlIG9yIGFuIGludGVnZXIuIElmIGdpdmVuIGFzCgkJICogICAgYSBUUiBub2RlIHRoZW4gdGhlIGRhdGEgc291cmNlIGZvciB0aGUgd2hvbGUgcm93IHdpbGwgYmUgcmV0dXJuZWQuIElmIGdpdmVuIGFzIGEKCQkgKiAgICBURC9USCBjZWxsIG5vZGUgdGhlbiBpQ29sIHdpbGwgYmUgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGFuZCB0aGUgZGF0YSBmb3IgdGhlCgkJICogICAgY2VsbCByZXR1cm5lZC4gSWYgZ2l2ZW4gYXMgYW4gaW50ZWdlciwgdGhlbiB0aGlzIGlzIHRyZWF0ZWQgYXMgdGhlIGFvRGF0YSBpbnRlcm5hbAoJCSAqICAgIGRhdGEgaW5kZXggZm9yIHRoZSByb3cgKHNlZSBmbkdldFBvc2l0aW9uKSBhbmQgdGhlIGRhdGEgZm9yIHRoYXQgcm93IHVzZWQuCgkJICogIEBwYXJhbSB7aW50fSBbaUNvbF0gT3B0aW9uYWwgY29sdW1uIGluZGV4IHRoYXQgeW91IHdhbnQgdGhlIGRhdGEgb2YuCgkJICogIEByZXR1cm5zIHthcnJheXxvYmplY3R8c3RyaW5nfSBJZiBtUm93IGlzIHVuZGVmaW5lZCwgdGhlbiB0aGUgZGF0YSBmb3IgYWxsIHJvd3MgaXMKCQkgKiAgICByZXR1cm5lZC4gSWYgbVJvdyBpcyBkZWZpbmVkLCBqdXN0IGRhdGEgZm9yIHRoYXQgcm93LCBhbmQgaXMgaUNvbCBpcwoJCSAqICAgIGRlZmluZWQsIG9ubHkgZGF0YSBmb3IgdGhlIGRlc2lnbmF0ZWQgY2VsbCBpcyByZXR1cm5lZC4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUm93IGRhdGEKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIG9UYWJsZS4kKCd0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIHZhciBkYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggdGhpcyApOwoJCSAqICAgICAgICAvLyAuLi4gZG8gc29tZXRoaW5nIHdpdGggdGhlIGFycmF5IC8gb2JqZWN0IG9mIGRhdGEgZm9yIHRoZSByb3cKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBJbmRpdmlkdWFsIGNlbGwgZGF0YQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgb1RhYmxlLiQoJ3RkJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgdmFyIHNEYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggdGhpcyApOwoJCSAqICAgICAgICBhbGVydCggJ1RoZSBjZWxsIGNsaWNrZWQgb24gaGFkIHRoZSB2YWx1ZSBvZiAnK3NEYXRhICk7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXREYXRhID0gZnVuY3Rpb24oIG1Sb3csIGlDb2wgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQlpZiAoIG1Sb3cgIT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXZhciBpUm93ID0gbVJvdzsKCQkJCWlmICggdHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnICkKCQkJCXsKCQkJCQl2YXIgc05vZGUgPSBtUm93Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKHNOb2RlID09PSAidHIiICkKCQkJCQl7CgkJCQkJCWlSb3cgPSBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93KTsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIHNOb2RlID09PSAidGQiICkKCQkJCQl7CgkJCQkJCWlSb3cgPSBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93LnBhcmVudE5vZGUpOwoJCQkJCQlpQ29sID0gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaVJvdywgbVJvdyApOwoJCQkJCX0KCQkJCX0KCQkKCQkJCWlmICggaUNvbCAhPT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlyZXR1cm4gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJycgKTsKCQkJCX0KCQkJCXJldHVybiAob1NldHRpbmdzLmFvRGF0YVtpUm93XSE9PXVuZGVmaW5lZCkgPwoJCQkJCW9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhIDogbnVsbDsKCQkJfQoJCQlyZXR1cm4gX2ZuR2V0RGF0YU1hc3Rlciggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgdGhlIFRSIG5vZGVzIHRoYXQgYXJlIHVzZWQgaW4gdGhlIHRhYmxlJ3MgYm9keS4gTm90ZSB0aGF0IHlvdSB3aWxsIAoJCSAqIHR5cGljYWxseSB3YW50IHRvIHVzZSB0aGUgJyQnIEFQSSBtZXRob2QgaW4gcHJlZmVyZW5jZSB0byB0aGlzIGFzIGl0IGlzIG1vcmUgCgkJICogZmxleGlibGUuCgkJICogIEBwYXJhbSB7aW50fSBbaVJvd10gT3B0aW9uYWwgcm93IGluZGV4IGZvciB0aGUgVFIgZWxlbWVudCB5b3Ugd2FudAoJCSAqICBAcmV0dXJucyB7YXJyYXl8bm9kZX0gSWYgaVJvdyBpcyB1bmRlZmluZWQsIHJldHVybnMgYW4gYXJyYXkgb2YgYWxsIFRSIGVsZW1lbnRzCgkJICogICAgaW4gdGhlIHRhYmxlJ3MgYm9keSwgb3IgaVJvdyBpcyBkZWZpbmVkLCBqdXN0IHRoZSBUUiBlbGVtZW50IHJlcXVlc3RlZC4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gR2V0IHRoZSBub2RlcyBmcm9tIHRoZSB0YWJsZQoJCSAqICAgICAgdmFyIG5Ob2RlcyA9IG9UYWJsZS5mbkdldE5vZGVzKCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuR2V0Tm9kZXMgPSBmdW5jdGlvbiggaVJvdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggaVJvdyAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIChvU2V0dGluZ3MuYW9EYXRhW2lSb3ddIT09dW5kZWZpbmVkKSA/CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgOiBudWxsOwoJCQl9CgkJCXJldHVybiBfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgYXJyYXkgaW5kZXhlcyBvZiBhIHBhcnRpY3VsYXIgY2VsbCBmcm9tIGl0J3MgRE9NIGVsZW1lbnQKCQkgKiBhbmQgY29sdW1uIGluZGV4IGluY2x1ZGluZyBoaWRkZW4gY29sdW1ucwoJCSAqICBAcGFyYW0ge25vZGV9IG5Ob2RlIHRoaXMgY2FuIGVpdGhlciBiZSBhIFRSLCBURCBvciBUSCBpbiB0aGUgdGFibGUncyBib2R5CgkJICogIEByZXR1cm5zIHtpbnR9IElmIG5Ob2RlIGlzIGdpdmVuIGFzIGEgVFIsIHRoZW4gYSBzaW5nbGUgaW5kZXggaXMgcmV0dXJuZWQsIG9yCgkJICogICAgaWYgZ2l2ZW4gYXMgYSBjZWxsLCBhbiBhcnJheSBvZiBbcm93IGluZGV4LCBjb2x1bW4gaW5kZXggKHZpc2libGUpXSBpcyBnaXZlbi4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0ZCcpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIC8vIEdldCB0aGUgcG9zaXRpb24gb2YgdGhlIGN1cnJlbnQgZGF0YSBmcm9tIHRoZSBub2RlCgkJICogICAgICAgIHZhciBhUG9zID0gb1RhYmxlLmZuR2V0UG9zaXRpb24oIHRoaXMgKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIEdldCB0aGUgZGF0YSBhcnJheSBmb3IgdGhpcyByb3cKCQkgKiAgICAgICAgdmFyIGFEYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggYVBvc1swXSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gVXBkYXRlIHRoZSBkYXRhIGFycmF5IGFuZCByZXR1cm4gdGhlIHZhbHVlCgkJICogICAgICAgIGFEYXRhWyBhUG9zWzFdIF0gPSAnY2xpY2tlZCc7CgkJICogICAgICAgIHRoaXMuaW5uZXJIVE1MID0gJ2NsaWNrZWQnOwoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAvLyBJbml0IERhdGFUYWJsZXMKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKCBuTm9kZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIHNOb2RlTmFtZSA9IG5Ob2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk7CgkJCQoJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVFIiICkKCQkJewoJCQkJcmV0dXJuIF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG5Ob2RlKTsKCQkJfQoJCQllbHNlIGlmICggc05vZGVOYW1lID09ICJURCIgfHwgc05vZGVOYW1lID09ICJUSCIgKQoJCQl7CgkJCQl2YXIgaURhdGFJbmRleCA9IF9mbk5vZGVUb0RhdGFJbmRleCggb1NldHRpbmdzLCBuTm9kZS5wYXJlbnROb2RlICk7CgkJCQl2YXIgaUNvbHVtbkluZGV4ID0gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaURhdGFJbmRleCwgbk5vZGUgKTsKCQkJCXJldHVybiBbIGlEYXRhSW5kZXgsIF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKG9TZXR0aW5ncywgaUNvbHVtbkluZGV4ICksIGlDb2x1bW5JbmRleCBdOwoJCQl9CgkJCXJldHVybiBudWxsOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQ2hlY2sgdG8gc2VlIGlmIGEgcm93IGlzICdvcGVuJyBvciBub3QuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIHRoZSB0YWJsZSByb3cgdG8gY2hlY2sKCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhlIHJvdyBpcyBjdXJyZW50bHkgb3BlbiwgZmFsc2Ugb3RoZXJ3aXNlCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbklzT3BlbiA9IGZ1bmN0aW9uKCBuVHIgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBhb09wZW5Sb3dzID0gb1NldHRpbmdzLmFvT3BlblJvd3M7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5QYXJlbnQgPT0gblRyICkKCQkJCXsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gZmFsc2U7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgcGxhY2UgYSBuZXcgcm93IGRpcmVjdGx5IGFmdGVyIGEgcm93IHdoaWNoIGlzIGN1cnJlbnRseSAKCQkgKiBvbiBkaXNwbGF5IG9uIHRoZSBwYWdlLCB3aXRoIHRoZSBIVE1MIGNvbnRlbnRzIHRoYXQgaXMgcGFzc2VkIGludG8gdGhlIAoJCSAqIGZ1bmN0aW9uLiBUaGlzIGNhbiBiZSB1c2VkLCBmb3IgZXhhbXBsZSwgdG8gYXNrIGZvciBjb25maXJtYXRpb24gdGhhdCBhIAoJCSAqIHBhcnRpY3VsYXIgcmVjb3JkIHNob3VsZCBiZSBkZWxldGVkLgoJCSAqICBAcGFyYW0ge25vZGV9IG5UciBUaGUgdGFibGUgcm93IHRvICdvcGVuJwoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gbUh0bWwgVGhlIEhUTUwgdG8gcHV0IGludG8gdGhlIHJvdwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0NsYXNzIENsYXNzIHRvIGdpdmUgdGhlIG5ldyBURCBjZWxsCgkJICogIEByZXR1cm5zIHtub2RlfSBUaGUgcm93IG9wZW5lZC4gTm90ZSB0aGF0IGlmIHRoZSB0YWJsZSByb3cgcGFzc2VkIGluIGFzIHRoZQoJCSAqICAgIGZpcnN0IHBhcmFtZXRlciwgaXMgbm90IGZvdW5kIGluIHRoZSB0YWJsZSwgdGhpcyBtZXRob2Qgd2lsbCBzaWxlbnRseQoJCSAqICAgIHJldHVybi4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlOwoJCSAqICAgICAgCgkJICogICAgICAvLyAnb3BlbicgYW4gaW5mb3JtYXRpb24gcm93IHdoZW4gYSByb3cgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdHInKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBpZiAoIG9UYWJsZS5mbklzT3Blbih0aGlzKSApIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5DbG9zZSggdGhpcyApOwoJCSAqICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbk9wZW4oIHRoaXMsICJUZW1wb3Jhcnkgcm93IG9wZW5lZCIsICJpbmZvX3JvdyIgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuT3BlbiA9IGZ1bmN0aW9uKCBuVHIsIG1IdG1sLCBzQ2xhc3MgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCgkJCS8qIENoZWNrIHRoYXQgdGhlIHJvdyBnaXZlbiBpcyBpbiB0aGUgdGFibGUgKi8KCQkJdmFyIG5UYWJsZVJvd3MgPSBfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKTsKCQkJaWYgKCAkLmluQXJyYXkoblRyLCBuVGFibGVSb3dzKSA9PT0gLTEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIHRoZSBvbGQgb3BlbiBvbmUgaWYgdGhlcmUgaXMgb25lICovCgkJCXRoaXMuZm5DbG9zZSggblRyICk7CgkJCQoJCQl2YXIgbk5ld1JvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRyIik7CgkJCXZhciBuTmV3Q2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7CgkJCW5OZXdSb3cuYXBwZW5kQ2hpbGQoIG5OZXdDZWxsICk7CgkJCW5OZXdDZWxsLmNsYXNzTmFtZSA9IHNDbGFzczsKCQkJbk5ld0NlbGwuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQoJCQlpZiAodHlwZW9mIG1IdG1sID09PSAic3RyaW5nIikKCQkJewoJCQkJbk5ld0NlbGwuaW5uZXJIVE1MID0gbUh0bWw7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkKG5OZXdDZWxsKS5odG1sKCBtSHRtbCApOwoJCQl9CgkJCgkJCS8qIElmIHRoZSBuVHIgaXNuJ3Qgb24gdGhlIHBhZ2UgYXQgdGhlIG1vbWVudCAtIHRoZW4gd2UgZG9uJ3QgaW5zZXJ0IGF0IHRoZSBtb21lbnQgKi8KCQkJdmFyIG5UcnMgPSAkKCd0cicsIG9TZXR0aW5ncy5uVEJvZHkpOwoJCQlpZiAoICQuaW5BcnJheShuVHIsIG5UcnMpICE9IC0xICApCgkJCXsKCQkJCSQobk5ld1JvdykuaW5zZXJ0QWZ0ZXIoblRyKTsKCQkJfQoJCQkKCQkJb1NldHRpbmdzLmFvT3BlblJvd3MucHVzaCggewoJCQkJIm5UciI6IG5OZXdSb3csCgkJCQkiblBhcmVudCI6IG5UcgoJCQl9ICk7CgkJCQoJCQlyZXR1cm4gbk5ld1JvdzsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIENoYW5nZSB0aGUgcGFnaW5hdGlvbiAtIHByb3ZpZGVzIHRoZSBpbnRlcm5hbCBsb2dpYyBmb3IgcGFnaW5hdGlvbiBpbiBhIHNpbXBsZSBBUEkgCgkJICogZnVuY3Rpb24uIFdpdGggdGhpcyBmdW5jdGlvbiB5b3UgY2FuIGhhdmUgYSBEYXRhVGFibGVzIHRhYmxlIGdvIHRvIHRoZSBuZXh0LCAKCQkgKiBwcmV2aW91cywgZmlyc3Qgb3IgbGFzdCBwYWdlcy4KCQkgKiAgQHBhcmFtIHtzdHJpbmd8aW50fSBtQWN0aW9uIFBhZ2luZyBhY3Rpb24gdG8gdGFrZTogImZpcnN0IiwgInByZXZpb3VzIiwgIm5leHQiIG9yICJsYXN0IgoJCSAqICAgIG9yIHBhZ2UgbnVtYmVyIHRvIGp1bXAgdG8gKGludGVnZXIpLCBub3RlIHRoYXQgcGFnZSAwIGlzIHRoZSBmaXJzdCBwYWdlLgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5QYWdlQ2hhbmdlKCAnbmV4dCcgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblBhZ2VDaGFuZ2UgPSBmdW5jdGlvbiAoIG1BY3Rpb24sIGJSZWRyYXcgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCV9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgbUFjdGlvbiApOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBTaG93IGEgcGFydGljdWxhciBjb2x1bW4KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgVGhlIGNvbHVtbiB3aG9zZSBkaXNwbGF5IHNob3VsZCBiZSBjaGFuZ2VkCgkJICogIEBwYXJhbSB7Ym9vbH0gYlNob3cgU2hvdyAodHJ1ZSkgb3IgaGlkZSAoZmFsc2UpIHRoZSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBIaWRlIHRoZSBzZWNvbmQgY29sdW1uIGFmdGVyIGluaXRpYWxpc2F0aW9uCgkJICogICAgICBvVGFibGUuZm5TZXRDb2x1bW5WaXMoIDEsIGZhbHNlICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5TZXRDb2x1bW5WaXMgPSBmdW5jdGlvbiAoIGlDb2wsIGJTaG93LCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgaSwgaUxlbjsKCQkJdmFyIGFvQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnM7CgkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhOwoJCQl2YXIgblRkLCBuQ2VsbCwgYW5UcnMsIGpxQ2hpbGRyZW4sIGJBcHBlbmQsIGlCZWZvcmU7CgkJCQoJCQkvKiBObyBwb2ludCBpbiBkb2luZyBhbnl0aGluZyBpZiB3ZSBhcmUgcmVxdWVzdGluZyB3aGF0IGlzIGFscmVhZHkgdHJ1ZSAqLwoJCQlpZiAoIGFvQ29sdW1uc1tpQ29sXS5iVmlzaWJsZSA9PSBiU2hvdyApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogU2hvdyB0aGUgY29sdW1uICovCgkJCWlmICggYlNob3cgKQoJCQl7CgkJCQl2YXIgaUluc2VydCA9IDA7CgkJCQlmb3IgKCBpPTAgOyBpPGlDb2wgOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCWlJbnNlcnQrKzsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIE5lZWQgdG8gZGVjaWRlIGlmIHdlIHNob3VsZCB1c2UgYXBwZW5kQ2hpbGQgb3IgaW5zZXJ0QmVmb3JlICovCgkJCQliQXBwZW5kID0gKGlJbnNlcnQgPj0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICkpOwoJCQoJCQkJLyogV2hpY2ggY29sb3VtbiBzaG91bGQgd2UgYmUgaW5zZXJ0aW5nIGJlZm9yZT8gKi8KCQkJCWlmICggIWJBcHBlbmQgKQoJCQkJewoJCQkJCWZvciAoIGk9aUNvbCA7IGk8YW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlpZiAoIGFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJCXsKCQkJCQkJCWlCZWZvcmUgPSBpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCWlmICggYkFwcGVuZCApCgkJCQkJCXsKCQkJCQkJCWFvRGF0YVtpXS5uVHIuYXBwZW5kQ2hpbGQoIAoJCQkJCQkJCWFvRGF0YVtpXS5fYW5IaWRkZW5baUNvbF0KCQkJCQkJCSk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlhb0RhdGFbaV0ublRyLmluc2VydEJlZm9yZSgKCQkJCQkJCQlhb0RhdGFbaV0uX2FuSGlkZGVuW2lDb2xdLCAKCQkJCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGkgKVtpQmVmb3JlXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogUmVtb3ZlIGEgY29sdW1uIGZyb20gZGlzcGxheSAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluVGQgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGkgKVtpQ29sXTsKCQkJCQkJYW9EYXRhW2ldLl9hbkhpZGRlbltpQ29sXSA9IG5UZDsKCQkJCQkJblRkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5UZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQoJCQkvKiBDbGVhciB0byBzZXQgdGhlIHZpc2libGUgZmxhZyAqLwoJCQlhb0NvbHVtbnNbaUNvbF0uYlZpc2libGUgPSBiU2hvdzsKCQkKCQkJLyogUmVkcmF3IHRoZSBoZWFkZXIgYW5kIGZvb3RlciBiYXNlZCBvbiB0aGUgbmV3IGNvbHVtbiB2aXNpYmlsaXR5ICovCgkJCV9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0hlYWRlciApOwoJCQlpZiAoIG9TZXR0aW5ncy5uVEZvb3QgKQoJCQl7CgkJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9Gb290ZXIgKTsKCQkJfQoJCQkKCQkJLyogSWYgdGhlcmUgYXJlIGFueSAnb3Blbicgcm93cywgdGhlbiB3ZSBuZWVkIHRvIGFsdGVyIHRoZSBjb2xzcGFuIGZvciB0aGlzIGNvbCBjaGFuZ2UgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb09wZW5Sb3dzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5Uci5jb2xTcGFuID0gX2ZuVmlzYmxlQ29sdW1ucyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIERvIGEgcmVkcmF3IGluY2FzZSBhbnl0aGluZyBkZXBlbmRpbmcgb24gdGhlIHRhYmxlIGNvbHVtbnMgbmVlZHMgaXQgCgkJCSAqIChidWlsdC1pbjogc2Nyb2xsaW5nKSAKCQkJICovCgkJCWlmICggYlJlZHJhdyA9PT0gdW5kZWZpbmVkIHx8IGJSZWRyYXcgKQoJCQl7CgkJCQlfZm5BZGp1c3RDb2x1bW5TaXppbmcoIG9TZXR0aW5ncyApOwoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCV9mblNhdmVTdGF0ZSggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHNldHRpbmdzIGZvciBhIHBhcnRpY3VsYXIgdGFibGUgZm9yIGV4dGVybmFsIG1hbmlwdWxhdGlvbgoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdC4gU2VlIAoJCSAqICAgIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIHZhciBvU2V0dGluZ3MgPSBvVGFibGUuZm5TZXR0aW5ncygpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTaG93IGFuIGV4YW1wbGUgcGFyYW1ldGVyIGZyb20gdGhlIHNldHRpbmdzCgkJICogICAgICBhbGVydCggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5TZXR0aW5ncyA9IGZ1bmN0aW9uKCkKCQl7CgkJCXJldHVybiBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogU29ydCB0aGUgdGFibGUgYnkgYSBwYXJ0aWN1bGFyIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCB0aGUgZGF0YSBpbmRleCB0byBzb3J0IG9uLiBOb3RlIHRoYXQgdGhpcyB3aWxsIG5vdCBtYXRjaCB0aGUgCgkJICogICAgJ2Rpc3BsYXkgaW5kZXgnIGlmIHlvdSBoYXZlIGhpZGRlbiBkYXRhIGVudHJpZXMKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29ydCBpbW1lZGlhdGVseSB3aXRoIGNvbHVtbnMgMCBhbmQgMQoJCSAqICAgICAgb1RhYmxlLmZuU29ydCggWyBbMCwnYXNjJ10sIFsxLCdhc2MnXSBdICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5Tb3J0ID0gZnVuY3Rpb24oIGFhU29ydCApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJb1NldHRpbmdzLmFhU29ydGluZyA9IGFhU29ydDsKCQkJX2ZuU29ydCggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBdHRhY2ggYSBzb3J0IGxpc3RlbmVyIHRvIGFuIGVsZW1lbnQgZm9yIGEgZ2l2ZW4gY29sdW1uCgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgdGhlIGVsZW1lbnQgdG8gYXR0YWNoIHRoZSBzb3J0IGxpc3RlbmVyIHRvCgkJICogIEBwYXJhbSB7aW50fSBpQ29sdW1uIHRoZSBjb2x1bW4gdGhhdCBhIGNsaWNrIG9uIHRoaXMgbm9kZSB3aWxsIHNvcnQgb24KCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gc29ydCBpcyBydW4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29ydCBvbiBjb2x1bW4gMSwgd2hlbiAnc29ydGVyJyBpcyBjbGlja2VkIG9uCgkJICogICAgICBvVGFibGUuZm5Tb3J0TGlzdGVuZXIoIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3J0ZXInKSwgMSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU29ydExpc3RlbmVyID0gZnVuY3Rpb24oIG5Ob2RlLCBpQ29sdW1uLCBmbkNhbGxiYWNrICkKCQl7CgkJCV9mblNvcnRBdHRhY2hMaXN0ZW5lciggX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKSwgbk5vZGUsIGlDb2x1bW4sCgkJCSAJZm5DYWxsYmFjayApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIGEgdGFibGUgY2VsbCBvciByb3cgLSB0aGlzIG1ldGhvZCB3aWxsIGFjY2VwdCBlaXRoZXIgYSBzaW5nbGUgdmFsdWUgdG8KCQkgKiB1cGRhdGUgdGhlIGNlbGwgd2l0aCwgYW4gYXJyYXkgb2YgdmFsdWVzIHdpdGggb25lIGVsZW1lbnQgZm9yIGVhY2ggY29sdW1uIG9yCgkJICogYW4gb2JqZWN0IGluIHRoZSBzYW1lIGZvcm1hdCBhcyB0aGUgb3JpZ2luYWwgZGF0YSBzb3VyY2UuIFRoZSBmdW5jdGlvbiBpcwoJCSAqIHNlbGYtcmVmZXJlbmNpbmcgaW4gb3JkZXIgdG8gbWFrZSB0aGUgbXVsdGkgY29sdW1uIHVwZGF0ZXMgZWFzaWVyLgoJCSAqICBAcGFyYW0ge29iamVjdHxhcnJheXxzdHJpbmd9IG1EYXRhIERhdGEgdG8gdXBkYXRlIHRoZSBjZWxsL3JvdyB3aXRoCgkJICogIEBwYXJhbSB7bm9kZXxpbnR9IG1Sb3cgVFIgZWxlbWVudCB5b3Ugd2FudCB0byB1cGRhdGUgb3IgdGhlIGFvRGF0YSBpbmRleAoJCSAqICBAcGFyYW0ge2ludH0gW2lDb2x1bW5dIFRoZSBjb2x1bW4gdG8gdXBkYXRlIChub3QgdXNlZCBvZiBtRGF0YSBpcyBhbiBhcnJheSBvciBvYmplY3QpCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gUmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBbYkFjdGlvbj10cnVlXSBQZXJmb3JtIHByZWRyYXcgYWN0aW9ucyBvciBub3QKCQkgKiAgQHJldHVybnMge2ludH0gMCBvbiBzdWNjZXNzLCAxIG9uIGVycm9yCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5VcGRhdGUoICdFeGFtcGxlIHVwZGF0ZScsIDAsIDAgKTsgLy8gU2luZ2xlIGNlbGwKCQkgKiAgICAgIG9UYWJsZS5mblVwZGF0ZSggWydhJywgJ2InLCAnYycsICdkJywgJ2UnXSwgMSwgMCApOyAvLyBSb3cKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblVwZGF0ZSA9IGZ1bmN0aW9uKCBtRGF0YSwgbVJvdywgaUNvbHVtbiwgYlJlZHJhdywgYkFjdGlvbiApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGlWaXNpYmxlQ29sdW1uLCBpLCBpTGVuLCBzRGlzcGxheTsKCQkJdmFyIGlSb3cgPSAodHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVJvdykgOiBtUm93OwoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuX19mblVwZGF0ZURlZXAgPT09IHVuZGVmaW5lZCAmJiAkLmlzQXJyYXkobURhdGEpICYmIHR5cGVvZiBtRGF0YSA9PT0gJ29iamVjdCcgKQoJCQl7CgkJCQkvKiBBcnJheSB1cGRhdGUgLSB1cGRhdGUgdGhlIHdob2xlIHJvdyAqLwoJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgPSBtRGF0YS5zbGljZSgpOwoJCQkJCgkJCQkvKiBGbGFnIHRvIHRoZSBmdW5jdGlvbiB0aGF0IHdlIGFyZSByZWN1cnNpbmcgKi8KCQkJCW9TZXR0aW5ncy5fX2ZuVXBkYXRlRGVlcCA9IHRydWU7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQkJb1NldHRpbmdzLl9fZm5VcGRhdGVEZWVwID0gdW5kZWZpbmVkOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3MuX19mblVwZGF0ZURlZXAgPT09IHVuZGVmaW5lZCAmJiBtRGF0YSAhPT0gbnVsbCAmJiB0eXBlb2YgbURhdGEgPT09ICdvYmplY3QnICkKCQkJewoJCQkJLyogT2JqZWN0IHVwZGF0ZSAtIHVwZGF0ZSB0aGUgd2hvbGUgcm93IC0gYXNzdW1lIHRoZSBkZXZlbG9wZXIgZ2V0cyB0aGUgb2JqZWN0IHJpZ2h0ICovCgkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgbURhdGEgKTsKCQkKCQkJCW9TZXR0aW5ncy5fX2ZuVXBkYXRlRGVlcCA9IHRydWU7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQkJb1NldHRpbmdzLl9fZm5VcGRhdGVEZWVwID0gdW5kZWZpbmVkOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogSW5kaXZpZHVhbCBjZWxsIHVwZGF0ZSAqLwoJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgbURhdGEgKTsKCQkJCXNEaXNwbGF5ID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkJCWlmICggb0NvbC5mblJlbmRlciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJc0Rpc3BsYXkgPSBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiApOwoJCQkJCWlmICggb0NvbC5iVXNlUmVuZGVyZWQgKQoJCQkJCXsKCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgc0Rpc3BsYXkgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCS8qIERvIHRoZSBhY3R1YWwgSFRNTCB1cGRhdGUgKi8KCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKVtpQ29sdW1uXS5pbm5lckhUTUwgPSBzRGlzcGxheTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogTW9kaWZ5IHRoZSBzZWFyY2ggaW5kZXggZm9yIHRoaXMgcm93IChzdHJpY3RseSB0aGlzIGlzIGxpa2VseSBub3QgbmVlZGVkLCBzaW5jZSBmblJlRHJhdwoJCQkgKiB3aWxsIHJlYnVpbGQgdGhlIHNlYXJjaCBhcnJheSAtIGhvd2V2ZXIsIHRoZSByZWRyYXcgbWlnaHQgYmUgZGlzYWJsZWQgYnkgdGhlIHVzZXIpCgkJCSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaVJvdywgb1NldHRpbmdzLmFpRGlzcGxheSApOwoJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2lEaXNwbGF5SW5kZXhdID0gX2ZuQnVpbGRTZWFyY2hSb3coIG9TZXR0aW5ncywgCgkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGlSb3csICdmaWx0ZXInICkgKTsKCQkJCgkJCS8qIFBlcmZvcm0gcHJlLWRyYXcgYWN0aW9ucyAqLwoJCQlpZiAoIGJBY3Rpb24gPT09IHVuZGVmaW5lZCB8fCBiQWN0aW9uICkKCQkJewoJCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlyZXR1cm4gMDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIGluIG9yZGVyCgkJICogdG8gZW5zdXJlIGNvbXBhdGliaWxpdHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJCSAqICAgIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSByZXF1aXJlZAoJCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICogIEBtZXRob2QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIGFsZXJ0KCBvVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuVmVyc2lvbkNoZWNrID0gRGF0YVRhYmxlLmV4dC5mblZlcnNpb25DaGVjazsKCQkKCQkKCQkvKgoJCSAqIFRoaXMgaXMgcmVhbGx5IGEgZ29vZCBiaXQgcnViYmlzaCB0aGlzIG1ldGhvZCBvZiBleHBvc2luZyB0aGUgaW50ZXJuYWwgbWV0aG9kcwoJCSAqIHB1YmxpY2FsbHkuLi4gLSBUbyBiZSBmaXhlZCBpbiAyLjAgdXNpbmcgbWV0aG9kcyBvbiB0aGUgcHJvdG90eXBlCgkJICovCgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGEgd3JhcHBlciBmdW5jdGlvbiBmb3IgZXhwb3J0aW5nIGFuIGludGVybmFsIGZ1bmN0aW9ucyB0byBhbiBleHRlcm5hbCBBUEkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRnVuYyBBUEkgZnVuY3Rpb24gbmFtZQoJCSAqICBAcmV0dXJucyB7ZnVuY3Rpb259IHdyYXBwZWQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRXh0ZXJuQXBpRnVuYyAoc0Z1bmMpCgkJewoJCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCQl2YXIgYUFyZ3MgPSBbX2ZuU2V0dGluZ3NGcm9tTm9kZSh0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSldLmNvbmNhdCggCgkJCQkJQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSApOwoJCQkJcmV0dXJuIERhdGFUYWJsZS5leHQub0FwaVtzRnVuY10uYXBwbHkoIHRoaXMsIGFBcmdzICk7CgkJCX07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlZmVyZW5jZSB0byBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIHVzZSBieSBwbHVnLWluIGRldmVsb3BlcnMuIE5vdGUgdGhhdCB0aGVzZQoJCSAqIG1ldGhvZHMgYXJlIHJlZmVyZW5jZXMgdG8gaW50ZXJuYWwgZnVuY3Rpb25zIGFuZCBhcmUgY29uc2lkZXJlZCB0byBiZSBwcml2YXRlLgoJCSAqIElmIHlvdSB1c2UgdGhlc2UgbWV0aG9kcywgYmUgYXdhcmUgdGhhdCB0aGV5IGFyZSBsaWFibGUgdG8gY2hhbmdlIGJldHdlZW4gdmVyc2lvbnMKCQkgKiAoY2hlY2sgdGhlIHVwZ3JhZGUgbm90ZXMpLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJdGhpcy5vQXBpID0gewoJCQkiX2ZuRXh0ZXJuQXBpRnVuYyI6IF9mbkV4dGVybkFwaUZ1bmMsCgkJCSJfZm5Jbml0aWFsaXNlIjogX2ZuSW5pdGlhbGlzZSwKCQkJIl9mbkluaXRDb21wbGV0ZSI6IF9mbkluaXRDb21wbGV0ZSwKCQkJIl9mbkxhbmd1YWdlQ29tcGF0IjogX2ZuTGFuZ3VhZ2VDb21wYXQsCgkJCSJfZm5BZGRDb2x1bW4iOiBfZm5BZGRDb2x1bW4sCgkJCSJfZm5Db2x1bW5PcHRpb25zIjogX2ZuQ29sdW1uT3B0aW9ucywKCQkJIl9mbkFkZERhdGEiOiBfZm5BZGREYXRhLAoJCQkiX2ZuQ3JlYXRlVHIiOiBfZm5DcmVhdGVUciwKCQkJIl9mbkdhdGhlckRhdGEiOiBfZm5HYXRoZXJEYXRhLAoJCQkiX2ZuQnVpbGRIZWFkIjogX2ZuQnVpbGRIZWFkLAoJCQkiX2ZuRHJhd0hlYWQiOiBfZm5EcmF3SGVhZCwKCQkJIl9mbkRyYXciOiBfZm5EcmF3LAoJCQkiX2ZuUmVEcmF3IjogX2ZuUmVEcmF3LAoJCQkiX2ZuQWpheFVwZGF0ZSI6IF9mbkFqYXhVcGRhdGUsCgkJCSJfZm5BamF4UGFyYW1ldGVycyI6IF9mbkFqYXhQYXJhbWV0ZXJzLAoJCQkiX2ZuQWpheFVwZGF0ZURyYXciOiBfZm5BamF4VXBkYXRlRHJhdywKCQkJIl9mblNlcnZlclBhcmFtcyI6IF9mblNlcnZlclBhcmFtcywKCQkJIl9mbkFkZE9wdGlvbnNIdG1sIjogX2ZuQWRkT3B0aW9uc0h0bWwsCgkJCSJfZm5GZWF0dXJlSHRtbFRhYmxlIjogX2ZuRmVhdHVyZUh0bWxUYWJsZSwKCQkJIl9mblNjcm9sbERyYXciOiBfZm5TY3JvbGxEcmF3LAoJCQkiX2ZuQWRqdXN0Q29sdW1uU2l6aW5nIjogX2ZuQWRqdXN0Q29sdW1uU2l6aW5nLAoJCQkiX2ZuRmVhdHVyZUh0bWxGaWx0ZXIiOiBfZm5GZWF0dXJlSHRtbEZpbHRlciwKCQkJIl9mbkZpbHRlckNvbXBsZXRlIjogX2ZuRmlsdGVyQ29tcGxldGUsCgkJCSJfZm5GaWx0ZXJDdXN0b20iOiBfZm5GaWx0ZXJDdXN0b20sCgkJCSJfZm5GaWx0ZXJDb2x1bW4iOiBfZm5GaWx0ZXJDb2x1bW4sCgkJCSJfZm5GaWx0ZXIiOiBfZm5GaWx0ZXIsCgkJCSJfZm5CdWlsZFNlYXJjaEFycmF5IjogX2ZuQnVpbGRTZWFyY2hBcnJheSwKCQkJIl9mbkJ1aWxkU2VhcmNoUm93IjogX2ZuQnVpbGRTZWFyY2hSb3csCgkJCSJfZm5GaWx0ZXJDcmVhdGVTZWFyY2giOiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2gsCgkJCSJfZm5EYXRhVG9TZWFyY2giOiBfZm5EYXRhVG9TZWFyY2gsCgkJCSJfZm5Tb3J0IjogX2ZuU29ydCwKCQkJIl9mblNvcnRBdHRhY2hMaXN0ZW5lciI6IF9mblNvcnRBdHRhY2hMaXN0ZW5lciwKCQkJIl9mblNvcnRpbmdDbGFzc2VzIjogX2ZuU29ydGluZ0NsYXNzZXMsCgkJCSJfZm5GZWF0dXJlSHRtbFBhZ2luYXRlIjogX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSwKCQkJIl9mblBhZ2VDaGFuZ2UiOiBfZm5QYWdlQ2hhbmdlLAoJCQkiX2ZuRmVhdHVyZUh0bWxJbmZvIjogX2ZuRmVhdHVyZUh0bWxJbmZvLAoJCQkiX2ZuVXBkYXRlSW5mbyI6IF9mblVwZGF0ZUluZm8sCgkJCSJfZm5GZWF0dXJlSHRtbExlbmd0aCI6IF9mbkZlYXR1cmVIdG1sTGVuZ3RoLAoJCQkiX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nIjogX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nLAoJCQkiX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkiOiBfZm5Qcm9jZXNzaW5nRGlzcGxheSwKCQkJIl9mblZpc2libGVUb0NvbHVtbkluZGV4IjogX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSI6IF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlLAoJCQkiX2ZuTm9kZVRvRGF0YUluZGV4IjogX2ZuTm9kZVRvRGF0YUluZGV4LAoJCQkiX2ZuVmlzYmxlQ29sdW1ucyI6IF9mblZpc2JsZUNvbHVtbnMsCgkJCSJfZm5DYWxjdWxhdGVFbmQiOiBfZm5DYWxjdWxhdGVFbmQsCgkJCSJfZm5Db252ZXJ0VG9XaWR0aCI6IF9mbkNvbnZlcnRUb1dpZHRoLAoJCQkiX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzIjogX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLAoJCQkiX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QiOiBfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCwKCQkJIl9mbkdldFdpZGVzdE5vZGUiOiBfZm5HZXRXaWRlc3ROb2RlLAoJCQkiX2ZuR2V0TWF4TGVuU3RyaW5nIjogX2ZuR2V0TWF4TGVuU3RyaW5nLAoJCQkiX2ZuU3RyaW5nVG9Dc3MiOiBfZm5TdHJpbmdUb0NzcywKCQkJIl9mbkRldGVjdFR5cGUiOiBfZm5EZXRlY3RUeXBlLAoJCQkiX2ZuU2V0dGluZ3NGcm9tTm9kZSI6IF9mblNldHRpbmdzRnJvbU5vZGUsCgkJCSJfZm5HZXREYXRhTWFzdGVyIjogX2ZuR2V0RGF0YU1hc3RlciwKCQkJIl9mbkdldFRyTm9kZXMiOiBfZm5HZXRUck5vZGVzLAoJCQkiX2ZuR2V0VGROb2RlcyI6IF9mbkdldFRkTm9kZXMsCgkJCSJfZm5Fc2NhcGVSZWdleCI6IF9mbkVzY2FwZVJlZ2V4LAoJCQkiX2ZuRGVsZXRlSW5kZXgiOiBfZm5EZWxldGVJbmRleCwKCQkJIl9mblJlT3JkZXJJbmRleCI6IF9mblJlT3JkZXJJbmRleCwKCQkJIl9mbkNvbHVtbk9yZGVyaW5nIjogX2ZuQ29sdW1uT3JkZXJpbmcsCgkJCSJfZm5Mb2ciOiBfZm5Mb2csCgkJCSJfZm5DbGVhclRhYmxlIjogX2ZuQ2xlYXJUYWJsZSwKCQkJIl9mblNhdmVTdGF0ZSI6IF9mblNhdmVTdGF0ZSwKCQkJIl9mbkxvYWRTdGF0ZSI6IF9mbkxvYWRTdGF0ZSwKCQkJIl9mbkNyZWF0ZUNvb2tpZSI6IF9mbkNyZWF0ZUNvb2tpZSwKCQkJIl9mblJlYWRDb29raWUiOiBfZm5SZWFkQ29va2llLAoJCQkiX2ZuRGV0ZWN0SGVhZGVyIjogX2ZuRGV0ZWN0SGVhZGVyLAoJCQkiX2ZuR2V0VW5pcXVlVGhzIjogX2ZuR2V0VW5pcXVlVGhzLAoJCQkiX2ZuU2Nyb2xsQmFyV2lkdGgiOiBfZm5TY3JvbGxCYXJXaWR0aCwKCQkJIl9mbkFwcGx5VG9DaGlsZHJlbiI6IF9mbkFwcGx5VG9DaGlsZHJlbiwKCQkJIl9mbk1hcCI6IF9mbk1hcCwKCQkJIl9mbkdldFJvd0RhdGEiOiBfZm5HZXRSb3dEYXRhLAoJCQkiX2ZuR2V0Q2VsbERhdGEiOiBfZm5HZXRDZWxsRGF0YSwKCQkJIl9mblNldENlbGxEYXRhIjogX2ZuU2V0Q2VsbERhdGEsCgkJCSJfZm5HZXRPYmplY3REYXRhRm4iOiBfZm5HZXRPYmplY3REYXRhRm4sCgkJCSJfZm5TZXRPYmplY3REYXRhRm4iOiBfZm5TZXRPYmplY3REYXRhRm4sCgkJCSJfZm5BcHBseUNvbHVtbkRlZnMiOiBfZm5BcHBseUNvbHVtbkRlZnMsCgkJCSJfZm5CaW5kQWN0aW9uIjogX2ZuQmluZEFjdGlvbiwKCQkJIl9mbkV4dGVuZCI6IF9mbkV4dGVuZCwKCQkJIl9mbkNhbGxiYWNrUmVnIjogX2ZuQ2FsbGJhY2tSZWcsCgkJCSJfZm5DYWxsYmFja0ZpcmUiOiBfZm5DYWxsYmFja0ZpcmUsCgkJCSJfZm5Kc29uU3RyaW5nIjogX2ZuSnNvblN0cmluZywKCQkJIl9mblJlbmRlciI6IF9mblJlbmRlciwKCQkJIl9mbk5vZGVUb0NvbHVtbkluZGV4IjogX2ZuTm9kZVRvQ29sdW1uSW5kZXgKCQl9OwoJCQoJCSQuZXh0ZW5kKCBEYXRhVGFibGUuZXh0Lm9BcGksIHRoaXMub0FwaSApOwoJCQoJCWZvciAoIHZhciBzRnVuYyBpbiBEYXRhVGFibGUuZXh0Lm9BcGkgKQoJCXsKCQkJaWYgKCBzRnVuYyApCgkJCXsKCQkJCXRoaXNbc0Z1bmNdID0gX2ZuRXh0ZXJuQXBpRnVuYyhzRnVuYyk7CgkJCX0KCQl9CgkJCgkJCgkJdmFyIF90aGF0ID0gdGhpczsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkKCQkJdmFyIGk9MCwgaUxlbiwgaiwgakxlbiwgaywga0xlbjsKCQkJdmFyIHNJZCA9IHRoaXMuZ2V0QXR0cmlidXRlKCAnaWQnICk7CgkJCXZhciBiSW5pdEhhbmRlZE9mZiA9IGZhbHNlOwoJCQl2YXIgYlVzZVBhc3NlZERhdGEgPSBmYWxzZTsKCQkJCgkJCQoJCQkvKiBTYW5pdHkgY2hlY2sgKi8KCQkJaWYgKCB0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT0gJ3RhYmxlJyApCgkJCXsKCQkJCV9mbkxvZyggbnVsbCwgMCwgIkF0dGVtcHRlZCB0byBpbml0aWFsaXNlIERhdGFUYWJsZXMgb24gYSBub2RlIHdoaWNoIGlzIG5vdCBhICIrCgkJCQkJInRhYmxlOiAiK3RoaXMubm9kZU5hbWUgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogQ2hlY2sgdG8gc2VlIGlmIHdlIGFyZSByZS1pbml0aWFsaXNpbmcgYSB0YWJsZSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49RGF0YVRhYmxlLnNldHRpbmdzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCS8qIEJhc2UgY2hlY2sgb24gdGFibGUgbm9kZSAqLwoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0ublRhYmxlID09IHRoaXMgKQoJCQkJewoJCQkJCWlmICggb0luaXQgPT09IHVuZGVmaW5lZCB8fCBvSW5pdC5iUmV0cmlldmUgKQoJCQkJCXsKCQkJCQkJcmV0dXJuIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5vSW5zdGFuY2U7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKCBvSW5pdC5iRGVzdHJveSApCgkJCQkJewoJCQkJCQlEYXRhVGFibGUuc2V0dGluZ3NbaV0ub0luc3RhbmNlLmZuRGVzdHJveSgpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJX2ZuTG9nKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0sIDAsICJDYW5ub3QgcmVpbml0aWFsaXNlIERhdGFUYWJsZS5cblxuIisKCQkJCQkJCSJUbyByZXRyaWV2ZSB0aGUgRGF0YVRhYmxlcyBvYmplY3QgZm9yIHRoaXMgdGFibGUsIHBhc3Mgbm8gYXJndW1lbnRzIG9yIHNlZSAiKwoJCQkJCQkJInRoZSBkb2NzIGZvciBiUmV0cmlldmUgYW5kIGJEZXN0cm95IiApOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBJZiB0aGUgZWxlbWVudCB3ZSBhcmUgaW5pdGlhbGlzaW5nIGhhcyB0aGUgc2FtZSBJRCBhcyBhIHRhYmxlIHdoaWNoIHdhcyBwcmV2aW91c2x5CgkJCQkgKiBpbml0aWFsaXNlZCwgYnV0IHRoZSB0YWJsZSBub2RlcyBkb24ndCBtYXRjaCAoZnJvbSBiZWZvcmUpIHRoZW4gd2UgZGVzdHJveSB0aGUgb2xkCgkJCQkgKiBpbnN0YW5jZSBieSBzaW1wbHkgZGVsZXRpbmcgaXQuIFRoaXMgaXMgdW5kZXIgdGhlIGFzc3VtcHRpb24gdGhhdCB0aGUgdGFibGUgaGFzIGJlZW4KCQkJCSAqIGRlc3Ryb3llZCBieSBvdGhlciBtZXRob2RzLiBBbnlvbmUgdXNpbmcgbm9uLWlkIHNlbGVjdG9ycyB3aWxsIG5lZWQgdG8gZG8gdGhpcyBtYW51YWxseQoJCQkJICovCgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5zVGFibGVJZCA9PSB0aGlzLmlkICkKCQkJCXsKCQkJCQlEYXRhVGFibGUuc2V0dGluZ3Muc3BsaWNlKCBpLCAxICk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEVuc3VyZSB0aGUgdGFibGUgaGFzIGFuIElEIC0gcmVxdWlyZWQgZm9yIGFjY2Vzc2liaWxpdHkgKi8KCQkJaWYgKCBzSWQgPT09IG51bGwgKQoJCQl7CgkJCQlzSWQgPSAiRGF0YVRhYmxlc19UYWJsZV8iKyhEYXRhVGFibGUuZXh0Ll9vRXh0ZXJuQ29uZmlnLmlOZXh0VW5pcXVlKyspOwoJCQkJdGhpcy5pZCA9IHNJZDsKCQkJfQoJCQkKCQkJLyogQ3JlYXRlIHRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgdGFibGUgYW5kIHNldCBzb21lIG9mIHRoZSBkZWZhdWx0IHBhcmFtZXRlcnMgKi8KCQkJdmFyIG9TZXR0aW5ncyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MsIHsKCQkJCSJuVGFibGUiOiAgICAgICAgdGhpcywKCQkJCSJvQXBpIjogICAgICAgICAgX3RoYXQub0FwaSwKCQkJCSJvSW5pdCI6ICAgICAgICAgb0luaXQsCgkJCQkic0Rlc3Ryb3lXaWR0aCI6ICQodGhpcykud2lkdGgoKSwKCQkJCSJzSW5zdGFuY2UiOiAgICAgc0lkLAoJCQkJInNUYWJsZUlkIjogICAgICBzSWQKCQkJfSApOwoJCQlEYXRhVGFibGUuc2V0dGluZ3MucHVzaCggb1NldHRpbmdzICk7CgkJCQoJCQkvLyBOZWVkIHRvIGFkZCB0aGUgaW5zdGFuY2UgYWZ0ZXIgdGhlIGluc3RhbmNlIGFmdGVyIHRoZSBzZXR0aW5ncyBvYmplY3QgaGFzIGJlZW4gYWRkZWQKCQkJLy8gdG8gdGhlIHNldHRpbmdzIGFycmF5LCBzbyB3ZSBjYW4gc2VsZiByZWZlcmVuY2UgdGhlIHRhYmxlIGluc3RhbmNlIGlmIG1vcmUgdGhhbiBvbmUKCQkJb1NldHRpbmdzLm9JbnN0YW5jZSA9IChfdGhhdC5sZW5ndGg9PT0xKSA/IF90aGF0IDogJCh0aGlzKS5kYXRhVGFibGUoKTsKCQkJCgkJCS8qIFNldHRpbmcgdXAgdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdCAqLwoJCQlpZiAoICFvSW5pdCApCgkJCXsKCQkJCW9Jbml0ID0ge307CgkJCX0KCQkJCgkJCS8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBiZWZvcmUgd2UgYXBwbHkgYWxsIHRoZSBkZWZhdWx0cwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZSApCgkJCXsKCQkJCV9mbkxhbmd1YWdlQ29tcGF0KCBvSW5pdC5vTGFuZ3VhZ2UgKTsKCQkJfQoJCQkKCQkJb0luaXQgPSBfZm5FeHRlbmQoICQuZXh0ZW5kKHRydWUsIHt9LCBEYXRhVGFibGUuZGVmYXVsdHMpLCBvSW5pdCApOwoJCQkKCQkJLy8gTWFwIHRoZSBpbml0aWFsaXNhdGlvbiBvcHRpb25zIG9udG8gdGhlIHNldHRpbmdzIG9iamVjdAoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlBhZ2luYXRlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkxlbmd0aENoYW5nZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJGaWx0ZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiU29ydCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJJbmZvIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlByb2Nlc3NpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiQXV0b1dpZHRoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNvcnRDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNlcnZlclNpZGUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiRGVmZXJSZW5kZXIiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFgiLCAic1giICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAic1Njcm9sbFhJbm5lciIsICJzWElubmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxZIiwgInNZIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgImJTY3JvbGxDb2xsYXBzZSIsICJiQ29sbGFwc2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiYlNjcm9sbEluZmluaXRlIiwgImJJbmZpbml0ZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJpU2Nyb2xsTG9hZEdhcCIsICJpTG9hZEdhcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJiU2Nyb2xsQXV0b0NzcyIsICJiQXV0b0NzcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcENsYXNzZXMiLCAiYXNTdHJpcGVDbGFzc2VzIiApOyAvLyBsZWdhY3kKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcGVDbGFzc2VzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblNlcnZlckRhdGEiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImZuRm9ybWF0TnVtYmVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzU2VydmVyTWV0aG9kIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhYVNvcnRpbmciICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImFhU29ydGluZ0ZpeGVkIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhTGVuZ3RoTWVudSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic1BhZ2luYXRpb25UeXBlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQWpheFNvdXJjZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0FqYXhEYXRhUHJvcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaUNvb2tpZUR1cmF0aW9uIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzQ29va2llUHJlZml4IiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJzRG9tIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJiU29ydENlbGxzVG9wIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpVGFiSW5kZXgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgIm9TZWFyY2giLCAib1ByZXZpb3VzU2VhcmNoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhb1NlYXJjaENvbHMiLCAiYW9QcmVTZWFyY2hDb2xzIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJpRGlzcGxheUxlbmd0aCIsICJfaURpc3BsYXlMZW5ndGgiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImJKUXVlcnlVSSIsICJiSlVJIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmbkNvb2tpZUNhbGxiYWNrIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmblN0YXRlTG9hZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TdGF0ZVNhdmUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQsICJmbkluZm9DYWxsYmFjayIgKTsKCQkJCgkJCS8qIENhbGxiYWNrIGZ1bmN0aW9ucyB3aGljaCBhcmUgYXJyYXkgZHJpdmVuICovCgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsICAgICAgIG9Jbml0LmZuRHJhd0NhbGxiYWNrLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TZXJ2ZXJQYXJhbXMnLCAgICAgICBvSW5pdC5mblNlcnZlclBhcmFtcywgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU3RhdGVTYXZlUGFyYW1zJywgICAgb0luaXQuZm5TdGF0ZVNhdmVQYXJhbXMsICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1N0YXRlTG9hZFBhcmFtcycsICAgIG9Jbml0LmZuU3RhdGVMb2FkUGFyYW1zLCAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRlZCcsICAgICAgICBvSW5pdC5mblN0YXRlTG9hZGVkLCAgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvUm93Q2FsbGJhY2snLCAgICAgICAgb0luaXQuZm5Sb3dDYWxsYmFjaywgICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIG9Jbml0LmZuQ3JlYXRlZFJvdywgICAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9IZWFkZXJDYWxsYmFjaycsICAgICBvSW5pdC5mbkhlYWRlckNhbGxiYWNrLCAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRm9vdGVyQ2FsbGJhY2snLCAgICAgb0luaXQuZm5Gb290ZXJDYWxsYmFjaywgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0luaXRDb21wbGV0ZScsICAgICAgIG9Jbml0LmZuSW5pdENvbXBsZXRlLCAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9QcmVEcmF3Q2FsbGJhY2snLCAgICBvSW5pdC5mblByZURyYXdDYWxsYmFjaywgICAndXNlcicgKTsKCQkJCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSAmJiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmCgkJCQkgICBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0Q2xhc3NlcyApCgkJCXsKCQkJCS8qIEVuYWJsZSBzb3J0IGNsYXNzZXMgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIFNhZmUgdG8gZG8gaXQgaGVyZSwgc2luY2Ugc2VydmVyLXNpZGUKCQkJCSAqIHByb2Nlc3NpbmcgbXVzdCBiZSBlbmFibGVkIGJ5IHRoZSBkZXZlbG9wZXIKCQkJCSAqLwoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdzZXJ2ZXJfc2lkZV9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkRlZmVyUmVuZGVyICkKCQkJewoJCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgX2ZuU29ydGluZ0NsYXNzZXMsICdkZWZlcl9zb3J0X2NsYXNzZXMnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYkpRdWVyeVVJICkKCQkJewoJCQkJLyogVXNlIHRoZSBKVUkgY2xhc3NlcyBvYmplY3QgZm9yIGRpc3BsYXkuIFlvdSBjb3VsZCBjbG9uZSB0aGUgb1N0ZENsYXNzZXMgb2JqZWN0IGlmIAoJCQkJICogeW91IHdhbnQgdG8gaGF2ZSBtdWx0aXBsZSB0YWJsZXMgd2l0aCBtdWx0aXBsZSBpbmRlcGVuZGVudCBjbGFzc2VzIAoJCQkJICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9DbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9KVUlDbGFzc2VzICk7CgkJCQkKCQkJCWlmICggb0luaXQuc0RvbSA9PT0gRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gJiYgRGF0YVRhYmxlLmRlZmF1bHRzLnNEb20gPT09ICJsZnJ0aXAiICkKCQkJCXsKCQkJCQkvKiBTZXQgdGhlIERPTSB0byB1c2UgYSBsYXlvdXQgc3VpdGFibGUgZm9yIGpRdWVyeSBVSSdzIHRoZW1pbmcgKi8KCQkJCQlvU2V0dGluZ3Muc0RvbSA9ICc8IkgibGZyPnQ8IkYiaXA+JzsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCSQuZXh0ZW5kKCBvU2V0dGluZ3Mub0NsYXNzZXMsIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMgKTsKCQkJfQoJCQkkKHRoaXMpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1RhYmxlICk7CgkJCQoJCQkvKiBDYWxjdWxhdGUgdGhlIHNjcm9sbCBiYXIgd2lkdGggYW5kIGNhY2hlIGl0IGZvciB1c2UgbGF0ZXIgb24gKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJb1NldHRpbmdzLm9TY3JvbGwuaUJhcldpZHRoID0gX2ZuU2Nyb2xsQmFyV2lkdGgoKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCS8qIERpc3BsYXkgc3RhcnQgcG9pbnQsIHRha2luZyBpbnRvIGFjY291bnQgdGhlIHNhdmUgc2F2aW5nICovCgkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBvSW5pdC5pRGlzcGxheVN0YXJ0OwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb0luaXQuaURpc3BsYXlTdGFydDsKCQkJfQoJCQkKCQkJLyogTXVzdCBiZSBkb25lIGFmdGVyIGV2ZXJ5dGhpbmcgd2hpY2ggY2FuIGJlIG92ZXJyaWRkZW4gYnkgYSBjb29raWUhICovCgkJCWlmICggb0luaXQuYlN0YXRlU2F2ZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSA9IHRydWU7CgkJCQlfZm5Mb2FkU3RhdGUoIG9TZXR0aW5ncywgb0luaXQgKTsKCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNhdmVTdGF0ZSwgJ3N0YXRlX3NhdmUnICk7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuaURlZmVyTG9hZGluZyAhPT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nID0gdHJ1ZTsKCQkJCW9TZXR0aW5ncy5faVJlY29yZHNUb3RhbCA9IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCQlvU2V0dGluZ3MuX2lSZWNvcmRzRGlzcGxheSA9IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYWFEYXRhICE9PSBudWxsICkKCQkJewoJCQkJYlVzZVBhc3NlZERhdGEgPSB0cnVlOwoJCQl9CgkJCQoJCQkvKiBMYW5ndWFnZSBkZWZpbml0aW9ucyAqLwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZS5zVXJsICE9PSAiIiApCgkJCXsKCQkJCS8qIEdldCB0aGUgbGFuZ3VhZ2UgZGVmaW5pdGlvbnMgZnJvbSBhIGZpbGUgLSBiZWNhdXNlIHRoaXMgQWpheCBjYWxsIG1ha2VzIHRoZSBsYW5ndWFnZQoJCQkJICogZ2V0IGFzeW5jIHRvIHRoZSByZW1haW5kZXIgb2YgdGhpcyBmdW5jdGlvbiB3ZSB1c2UgYkluaXRIYW5kZWRPZmYgdG8gaW5kaWNhdGUgdGhhdCAKCQkJCSAqIF9mbkluaXRpYWxpc2Ugd2lsbCBiZSBmaXJlZCBieSB0aGUgcmV0dXJuZWQgQWpheCBoYW5kbGVyLCByYXRoZXIgdGhhbiB0aGUgY29uc3RydWN0b3IKCQkJCSAqLwoJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zVXJsID0gb0luaXQub0xhbmd1YWdlLnNVcmw7CgkJCQkkLmdldEpTT04oIG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1VybCwgbnVsbCwgZnVuY3Rpb24oIGpzb24gKSB7CgkJCQkJX2ZuTGFuZ3VhZ2VDb21wYXQoIGpzb24gKTsKCQkJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQub0xhbmd1YWdlLCBqc29uICk7CgkJCQkJX2ZuSW5pdGlhbGlzZSggb1NldHRpbmdzICk7CgkJCQl9ICk7CgkJCQliSW5pdEhhbmRlZE9mZiA9IHRydWU7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQub0xhbmd1YWdlICk7CgkJCX0KCQkJCgkJCQoJCQkvKgoJCQkgKiBTdHJpcGVzCgkJCSAqLwoJCQkKCQkJLyogUmVtb3ZlIHJvdyBzdHJpcGUgY2xhc3NlcyBpZiB0aGV5IGFyZSBhbHJlYWR5IG9uIHRoZSB0YWJsZSByb3cgKi8KCQkJdmFyIGJTdHJpcGVSZW1vdmUgPSBmYWxzZTsKCQkJdmFyIGFuUm93cyA9ICQodGhpcykuY2hpbGRyZW4oJ3Rib2R5JykuY2hpbGRyZW4oJ3RyJyk7CgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYW5Sb3dzLmZpbHRlcigiOmx0KDIpIikuaGFzQ2xhc3MoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbaV0pICkKCQkJCXsKCQkJCQliU3RyaXBlUmVtb3ZlID0gdHJ1ZTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCQkJCQoJCQlpZiAoIGJTdHJpcGVSZW1vdmUgKQoJCQl7CgkJCQkvKiBTdG9yZSB0aGUgY2xhc3NlcyB3aGljaCB3ZSBhcmUgYWJvdXQgdG8gcmVtb3ZlIHNvIHRoZXkgY2FuIGJlIHJlYWRkZWQgb24gZGVzdHJveSAqLwoJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXMgPSBbICcnLCAnJyBdOwoJCQkJaWYgKCAkKGFuUm93c1swXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1swXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCsiICI7CgkJCQl9CgkJCQlpZiAoICQoYW5Sb3dzWzBdKS5oYXNDbGFzcyhvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW4pICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1swXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW47CgkJCQl9CgkJCQlpZiAoICQoYW5Sb3dzWzFdKS5oYXNDbGFzcyhvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCkgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzWzFdICs9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkKyIgIjsKCQkJCX0KCQkJCWlmICggJChhblJvd3NbMV0pLmhhc0NsYXNzKG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlRXZlbikgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzWzFdICs9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlRXZlbjsKCQkJCX0KCQkJCQoJCQkJYW5Sb3dzLnJlbW92ZUNsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmpvaW4oJyAnKSApOwoJCQl9CgkJCQoJCQkKCQkJLyoKCQkJICogQ29sdW1ucwoJCQkgKiBTZWUgaWYgd2Ugc2hvdWxkIGxvYWQgY29sdW1ucyBhdXRvbWF0aWNhbGx5IG9yIHVzZSBkZWZpbmVkIG9uZXMKCQkJICovCgkJCXZhciBhblRocyA9IFtdOwoJCQl2YXIgYW9Db2x1bW5zSW5pdDsKCQkJdmFyIG5UaGVhZCA9IHRoaXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoZWFkJyk7CgkJCWlmICggblRoZWFkLmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvSGVhZGVyLCBuVGhlYWRbMF0gKTsKCQkJCWFuVGhzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogSWYgbm90IGdpdmVuIGEgY29sdW1uIGFycmF5LCBnZW5lcmF0ZSBvbmUgd2l0aCBudWxscyAqLwoJCQlpZiAoIG9Jbml0LmFvQ29sdW1ucyA9PT0gbnVsbCApCgkJCXsKCQkJCWFvQ29sdW1uc0luaXQgPSBbXTsKCQkJCWZvciAoIGk9MCwgaUxlbj1hblRocy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFvQ29sdW1uc0luaXQucHVzaCggbnVsbCApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJYW9Db2x1bW5zSW5pdCA9IG9Jbml0LmFvQ29sdW1uczsKCQkJfQoJCQkKCQkJLyogQWRkIHRoZSBjb2x1bW5zICovCgkJCWZvciAoIGk9MCwgaUxlbj1hb0NvbHVtbnNJbml0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCS8qIFNob3J0IGN1dCAtIHVzZSB0aGUgbG9vcCB0byBjaGVjayBpZiB3ZSBoYXZlIGNvbHVtbiB2aXNpYmlsaXR5IHN0YXRlIHRvIHJlc3RvcmUgKi8KCQkJCWlmICggb0luaXQuc2F2ZWRfYW9Db2x1bW5zICE9PSB1bmRlZmluZWQgJiYgb0luaXQuc2F2ZWRfYW9Db2x1bW5zLmxlbmd0aCA9PSBpTGVuICkKCQkJCXsKCQkJCQlpZiAoIGFvQ29sdW1uc0luaXRbaV0gPT09IG51bGwgKQoJCQkJCXsKCQkJCQkJYW9Db2x1bW5zSW5pdFtpXSA9IHt9OwoJCQkJCX0KCQkJCQlhb0NvbHVtbnNJbml0W2ldLmJWaXNpYmxlID0gb0luaXQuc2F2ZWRfYW9Db2x1bW5zW2ldLmJWaXNpYmxlOwoJCQkJfQoJCQkJCgkJCQlfZm5BZGRDb2x1bW4oIG9TZXR0aW5ncywgYW5UaHMgPyBhblRoc1tpXSA6IG51bGwgKTsKCQkJfQoJCQkKCQkJLyogQXBwbHkgdGhlIGNvbHVtbiBkZWZpbml0aW9ucyAqLwoJCQlfZm5BcHBseUNvbHVtbkRlZnMoIG9TZXR0aW5ncywgb0luaXQuYW9Db2x1bW5EZWZzLCBhb0NvbHVtbnNJbml0LCBmdW5jdGlvbiAoaUNvbCwgb0RlZikgewoJCQkJX2ZuQ29sdW1uT3B0aW9ucyggb1NldHRpbmdzLCBpQ29sLCBvRGVmICk7CgkJCX0gKTsKCQkJCgkJCQoJCQkvKgoJCQkgKiBTb3J0aW5nCgkJCSAqIENoZWNrIHRoZSBhYVNvcnRpbmcgYXJyYXkKCQkJICovCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA+PSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXSA9IDA7CgkJCQl9CgkJCQl2YXIgb0NvbHVtbiA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gXTsKCQkJCQoJCQkJLyogQWRkIGEgZGVmYXVsdCBzb3J0aW5nIGluZGV4ICovCgkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IDA7CgkJCQl9CgkJCQkKCQkJCS8qIElmIGFhU29ydGluZyBpcyBub3QgZGVmaW5lZCwgdGhlbiB3ZSB1c2UgdGhlIGZpcnN0IGluZGljYXRvciBpbiBhc1NvcnRpbmcgKi8KCQkJCWlmICggb0luaXQuYWFTb3J0aW5nID09PSB1bmRlZmluZWQgJiYgb1NldHRpbmdzLnNhdmVkX2FhU29ydGluZyA9PT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzFdID0gb0NvbHVtbi5hc1NvcnRpbmdbMF07CgkJCQl9CgkJCQkKCQkJCS8qIFNldCB0aGUgY3VycmVudCBzb3J0aW5nIGluZGV4IGJhc2VkIG9uIGFvQ29sdW1ucy5hc1NvcnRpbmcgKi8KCQkJCWZvciAoIGo9MCwgakxlbj1vQ29sdW1uLmFzU29ydGluZy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSA9PSBvQ29sdW1uLmFzU29ydGluZ1tqXSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdID0gajsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQkKCQkJLyogRG8gYSBmaXJzdCBwYXNzIG9uIHRoZSBzb3J0aW5nIGNsYXNzZXMgKGFsbG93cyBhbnkgc2l6ZSBjaGFuZ2VzIHRvIGJlIHRha2VuIGludG8KCQkJICogYWNjb3VudCwgYW5kIGFsc28gd2lsbCBhcHBseSBzb3J0aW5nIGRpc2FibGVkIGNsYXNzZXMgaWYgZGlzYWJsZWQKCQkJICovCgkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJCgkJCQoJCQkvKgoJCQkgKiBGaW5hbCBpbml0CgkJCSAqIENhY2hlIHRoZSBoZWFkZXIsIGJvZHkgYW5kIGZvb3RlciBhcyByZXF1aXJlZCwgY3JlYXRpbmcgdGhlbSBpZiBuZWVkZWQKCQkJICovCgkJCXZhciB0aGVhZCA9ICQodGhpcykuY2hpbGRyZW4oJ3RoZWFkJyk7CgkJCWlmICggdGhlYWQubGVuZ3RoID09PSAwICkKCQkJewoJCQkJdGhlYWQgPSBbIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0aGVhZCcgKSBdOwoJCQkJdGhpcy5hcHBlbmRDaGlsZCggdGhlYWRbMF0gKTsKCQkJfQoJCQlvU2V0dGluZ3MublRIZWFkID0gdGhlYWRbMF07CgkJCQoJCQl2YXIgdGJvZHkgPSAkKHRoaXMpLmNoaWxkcmVuKCd0Ym9keScpOwoJCQlpZiAoIHRib2R5Lmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXRib2R5ID0gWyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGJvZHknICkgXTsKCQkJCXRoaXMuYXBwZW5kQ2hpbGQoIHRib2R5WzBdICk7CgkJCX0KCQkJb1NldHRpbmdzLm5UQm9keSA9IHRib2R5WzBdOwoJCQlvU2V0dGluZ3MublRCb2R5LnNldEF0dHJpYnV0ZSggInJvbGUiLCAiYWxlcnQiICk7CgkJCW9TZXR0aW5ncy5uVEJvZHkuc2V0QXR0cmlidXRlKCAiYXJpYS1saXZlIiwgInBvbGl0ZSIgKTsKCQkJb1NldHRpbmdzLm5UQm9keS5zZXRBdHRyaWJ1dGUoICJhcmlhLXJlbGV2YW50IiwgImFsbCIgKTsKCQkJCgkJCXZhciB0Zm9vdCA9ICQodGhpcykuY2hpbGRyZW4oJ3Rmb290Jyk7CgkJCWlmICggdGZvb3QubGVuZ3RoID4gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5uVEZvb3QgPSB0Zm9vdFswXTsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvRm9vdGVyLCBvU2V0dGluZ3MublRGb290ICk7CgkJCX0KCQkJCgkJCS8qIENoZWNrIGlmIHRoZXJlIGlzIGRhdGEgcGFzc2luZyBpbnRvIHRoZSBjb25zdHJ1Y3RvciAqLwoJCQlpZiAoIGJVc2VQYXNzZWREYXRhICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvSW5pdC5hYURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG9Jbml0LmFhRGF0YVsgaSBdICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBHcmFiIHRoZSBkYXRhIGZyb20gdGhlIHBhZ2UgKi8KCQkJCV9mbkdhdGhlckRhdGEoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBDb3B5IHRoZSBkYXRhIGluZGV4IGFycmF5ICovCgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQkvKiBJbml0aWFsaXNhdGlvbiBjb21wbGV0ZSAtIHRhYmxlIGNhbiBiZSBkcmF3biAqLwoJCQlvU2V0dGluZ3MuYkluaXRpYWxpc2VkID0gdHJ1ZTsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIG5lZWQgdG8gaW5pdGlhbGlzZSB0aGUgdGFibGUgKGl0IG1pZ2h0IG5vdCBoYXZlIGJlZW4gaGFuZGVkIG9mZiB0byB0aGUKCQkJICogbGFuZ3VhZ2UgcHJvY2Vzc29yKQoJCQkgKi8KCQkJaWYgKCBiSW5pdEhhbmRlZE9mZiA9PT0gZmFsc2UgKQoJCQl7CgkJCQlfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0gKTsKCX07CgoJLyoqCgkgKiBWZXJzaW9uIHN0cmluZyBmb3IgcGx1Zy1pbnMgdG8gY2hlY2sgY29tcGF0aWJpbGl0eS4gQWxsb3dlZCBmb3JtYXQgaXMKCSAqIGEuYi5jLmQuZSB3aGVyZTogYTppbnQsIGI6aW50LCBjOmludCwgZDpzdHJpbmcoZGV2fGJldGEpLCBlOmludC4gZCBhbmQKCSAqIGUgYXJlIG9wdGlvbmFsCgkgKiAgQG1lbWJlcgoJICogIEB0eXBlIHN0cmluZwoJICogIEBkZWZhdWx0IFZlcnNpb24gbnVtYmVyCgkgKi8KCURhdGFUYWJsZS52ZXJzaW9uID0gIjEuOS4wIjsKCgkvKioKCSAqIFByaXZhdGUgZGF0YSBzdG9yZSwgY29udGFpbmluZyBhbGwgb2YgdGhlIHNldHRpbmdzIG9iamVjdHMgdGhhdCBhcmUgY3JlYXRlZCBmb3IgdGhlCgkgKiB0YWJsZXMgb24gYSBnaXZlbiBwYWdlLgoJICogCgkgKiBOb3RlIHRoYXQgdGhlIDxpPkRhdGFUYWJsZS5zZXR0aW5nczwvaT4gb2JqZWN0IGlzIGFsaWFzZWQgdG8gPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZUV4dDwvaT4gCgkgKiB0aHJvdWdoIHdoaWNoIGl0IG1heSBiZSBhY2Nlc3NlZCBhbmQgbWFuaXB1bGF0ZWQsIG9yIDxpPmpRdWVyeS5mbi5kYXRhVGFibGUuc2V0dGluZ3M8L2k+LgoJICogIEBtZW1iZXIKCSAqICBAdHlwZSBhcnJheQoJICogIEBkZWZhdWx0IFtdCgkgKiAgQHByaXZhdGUKCSAqLwoJRGF0YVRhYmxlLnNldHRpbmdzID0gW107CgoJLyoqCgkgKiBPYmplY3QgbW9kZWxzIGNvbnRhaW5lciwgZm9yIHRoZSB2YXJpb3VzIG1vZGVscyB0aGF0IERhdGFUYWJsZXMgaGFzIGF2YWlsYWJsZQoJICogdG8gaXQuIFRoZXNlIG1vZGVscyBkZWZpbmUgdGhlIG9iamVjdHMgdGhhdCBhcmUgdXNlZCB0byBob2xkIHRoZSBhY3RpdmUgc3RhdGUgCgkgKiBhbmQgY29uZmlndXJhdGlvbiBvZiB0aGUgdGFibGUuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzID0ge307CgkKCQoJLyoqCgkgKiBEYXRhVGFibGVzIGV4dGVuc2lvbiBvcHRpb25zIGFuZCBwbHVnLWlucy4gVGhpcyBuYW1lc3BhY2UgYWN0cyBhcyBhIGNvbGxlY3Rpb24gImFyZWEiCgkgKiBmb3IgcGx1Zy1pbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBleHRlbmQgdGhlIGRlZmF1bHQgRGF0YVRhYmxlcyBiZWhhdmlvdXIgLSBpbmRlZWQgbWFueQoJICogb2YgdGhlIGJ1aWxkIGluIG1ldGhvZHMgdXNlIHRoaXMgbWV0aG9kIHRvIHByb3ZpZGUgdGhlaXIgb3duIGNhcGFiaWxpdGllcyAoc29ydGluZyBtZXRob2RzCgkgKiBmb3IgZXhhbXBsZSkuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG5hbWVzcGFjZSBpcyBhbGlhc2VkIHRvIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQgc28gaXQgY2FuIGJlIHJlYWRpbHkgYWNjZXNzZWQKCSAqIGFuZCBtb2RpZmllZCBieSBwbHVnLWlucy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMuZXh0ID0gewoJCS8qKgoJCSAqIFBsdWctaW4gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIHRoaXMgbWV0aG9kIG9mIGZpbHRlcmluZyBpcyBjb21wbGltZW50YXJ5IHRvIHRoZSBkZWZhdWx0CgkJICogdHlwZSBiYXNlZCBmaWx0ZXJpbmcsIGFuZCBhIGxvdCBtb3JlIGNvbXByZWhlbnNpdmUgYXMgaXQgYWxsb3dzIHlvdSBjb21wbGV0ZSBjb250cm9sCgkJICogb3ZlciB0aGUgZmlsdGVyaW5nIGxvZ2ljLiBFYWNoIGVsZW1lbnQgaW4gdGhpcyBhcnJheSBpcyBhIGZ1bmN0aW9uIChwYXJhbWV0ZXJzCgkJICogZGVzY3JpYmVkIGJlbG93KSB0aGF0IGlzIGNhbGxlZCBmb3IgZXZlcnkgcm93IGluIHRoZSB0YWJsZSwgYW5kIHlvdXIgbG9naWMgZGVjaWRlcyBpZgoJCSAqIGl0IHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgZmlsdGVyZWQgZGF0YSBzZXQgb3Igbm90LgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICA8bGk+e2FycmF5fG9iamVjdH0gRGF0YSBmb3IgdGhlIHJvdyB0byBiZSBwcm9jZXNzZWQgKHNhbWUgYXMgdGhlIG9yaWdpbmFsIGZvcm1hdAoJCSAqICAgICAgICAgICB0aGF0IHdhcyBwYXNzZWQgaW4gYXMgdGhlIGRhdGEgc291cmNlLCBvciBhbiBhcnJheSBmcm9tIGEgRE9NIGRhdGEgc291cmNlPC9saT4KCQkgKiAgICAgICAgIDxsaT57aW50fSBSb3cgaW5kZXggaW4gYW9EYXRhICh7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3MuYW9EYXRhfSksIHdoaWNoIGNhbgoJCSAqICAgICAgICAgICBiZSB1c2VmdWwgdG8gcmV0cmlldmUgdGhlIFRSIGVsZW1lbnQgaWYgeW91IG5lZWQgRE9NIGludGVyYWN0aW9uLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2Jvb2xlYW59IEluY2x1ZGUgdGhlIHJvdyBpbiB0aGUgZmlsdGVyZWQgcmVzdWx0IHNldCAodHJ1ZSkgb3Igbm90IChmYWxzZSk8L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVGhlIGZvbGxvd2luZyBleGFtcGxlIHNob3dzIGN1c3RvbSBmaWx0ZXJpbmcgYmVpbmcgYXBwbGllZCB0byB0aGUgZm91cnRoIGNvbHVtbiAoaS5lLgoJCSAqICAgIC8vIHRoZSBhRGF0YVszXSBpbmRleCkgYmFzZWQgb24gdHdvIGlucHV0IHZhbHVlcyBmcm9tIHRoZSBlbmQtdXNlciwgbWF0Y2hpbmcgdGhlIGRhdGEgaW4gCgkJICogICAgLy8gYSBjZXJ0YWluIHJhbmdlLgoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0LmFmbkZpbHRlcmluZy5wdXNoKAoJCSAqICAgICAgZnVuY3Rpb24oIG9TZXR0aW5ncywgYURhdGEsIGlEYXRhSW5kZXggKSB7CgkJICogICAgICAgIHZhciBpTWluID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pbicpLnZhbHVlICogMTsKCQkgKiAgICAgICAgdmFyIGlNYXggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF4JykudmFsdWUgKiAxOwoJCSAqICAgICAgICB2YXIgaVZlcnNpb24gPSBhRGF0YVszXSA9PSAiLSIgPyAwIDogYURhdGFbM10qMTsKCQkgKiAgICAgICAgaWYgKCBpTWluID09ICIiICYmIGlNYXggPT0gIiIgKSB7CgkJICogICAgICAgICAgcmV0dXJuIHRydWU7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgZWxzZSBpZiAoIGlNaW4gPT0gIiIgJiYgaVZlcnNpb24gPCBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIGVsc2UgaWYgKCBpTWluIDwgaVZlcnNpb24gJiYgIiIgPT0gaU1heCApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICBlbHNlIGlmICggaU1pbiA8IGlWZXJzaW9uICYmIGlWZXJzaW9uIDwgaU1heCApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICB9CgkJICogICAgKTsKCQkgKi8KCQkiYWZuRmlsdGVyaW5nIjogW10sCgkKCQoJCS8qKgoJCSAqIFBsdWctaW4gc29ydGluZyBmdW5jdGlvbnMgLSB0aGlzIG1ldGhvZCBvZiBzb3J0aW5nIGlzIGNvbXBsaW1lbnRhcnkgdG8gdGhlIGRlZmF1bHQgdHlwZQoJCSAqIGJhc2VkIHNvcnRpbmcgdGhhdCBEYXRhVGFibGVzIGRvZXMgYXV0b21hdGljYWxseSwgYWxsb3dpbmcgbXVjaCBncmVhdGVyIGNvbnRyb2wgb3ZlciB0aGUKCQkgKiB0aGUgZGF0YSB0aGF0IGlzIGJlaW5nIHVzZWQgdG8gc29ydCBhIGNvbHVtbi4gVGhpcyBpcyB1c2VmdWwgaWYgeW91IHdhbnQgdG8gZG8gc29ydGluZwoJCSAqIGJhc2VkIG9uIGxpdmUgZGF0YSAoZm9yIGV4YW1wbGUgdGhlIGNvbnRlbnRzIG9mIGFuICdpbnB1dCcgZWxlbWVudCkgcmF0aGVyIHRoYW4ganVzdCB0aGUKCQkgKiBzdGF0aWMgc3RyaW5nIHRoYXQgRGF0YVRhYmxlcyBrbm93cyBvZi4gVGhlIHdheSB0aGVzZSBwbHVnLWlucyB3b3JrIGlzIHRoYXQgeW91IGNyZWF0ZQoJCSAqIGFuIGFycmF5IG9mIHRoZSB2YWx1ZXMgeW91IHdpc2ggdG8gYmUgc29ydGVkIGZvciB0aGUgY29sdW1uIGluIHF1ZXN0aW9uIGFuZCB0aGVuIHJldHVybgoJCSAqIHRoYXQgYXJyYXkuIFdoaWNoIHByZS1zb3J0aW5nIGZ1bmN0aW9uIGlzIHJ1biBoZXJlIGRlcGVuZHMgb24gdGhlIHNTb3J0RGF0YVR5cGUgcGFyYW1ldGVyCgkJICogdGhhdCBpcyB1c2VkIGZvciB0aGUgY29sdW1uIChpZiBhbnkpLiBUaGlzIGlzIHRoZSBjb3JvbGxhcnkgb2YgPGk+b2ZuU2VhcmNoPC9pPiBmb3Igc29ydCAKCQkgKiBkYXRhLgoJCSAqICAgPHVsPgoJICAgICAqICAgICA8bGk+CgkgICAgICogICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkgICAgICogICAgICAgICA8bGk+e2ludH0gVGFyZ2V0IGNvbHVtbiBpbmRleDwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2FycmF5fSBEYXRhIGZvciB0aGUgY29sdW1uIHRvIGJlIHNvcnRlZCB1cG9uPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgCgkJICogTm90ZSB0aGF0IGFzIG9mIHYxLjksIGl0IGlzIHR5cGljYWxseSBwcmVmZXJhYmxlIHRvIHVzZSA8aT5tRGF0YVByb3A8L2k+IHRvIHByZXBhcmUgZGF0YSBmb3IKCQkgKiB0aGUgZGlmZmVyZW50IHVzZXMgdGhhdCBEYXRhVGFibGVzIGNhbiBwdXQgdGhlIGRhdGEgdG8uIFNwZWNpZmljYWxseSA8aT5tRGF0YVByb3A8L2k+IHdoZW4KCQkgKiB1c2VkIGFzIGEgZnVuY3Rpb24gd2lsbCBnaXZlIHlvdSBhICd0eXBlJyAoc29ydGluZywgZmlsdGVyaW5nIGV0YykgdGhhdCB5b3UgY2FuIHVzZSB0byAKCQkgKiBwcmVwYXJlIHRoZSBkYXRhIGFzIHJlcXVpcmVkIGZvciB0aGUgZGlmZmVyZW50IHR5cGVzLiBBcyBzdWNoLCB0aGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXBkYXRpbmcgdGhlIGNhY2hlZCBzb3J0aW5nIGluZm9ybWF0aW9uIHdpdGggdXNlciBlbnRlcmVkIHZhbHVlcyBpbiBIVE1MIGlucHV0IGVsZW1lbnRzCgkJICogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5hZm5Tb3J0RGF0YVsnZG9tLXRleHQnXSA9IGZ1bmN0aW9uICggb1NldHRpbmdzLCBpQ29sdW1uICkKCQkgKiAgICB7CgkJICogICAgICB2YXIgYURhdGEgPSBbXTsKCQkgKiAgICAgICQoICd0ZDplcSgnK2lDb2x1bW4rJykgaW5wdXQnLCBvU2V0dGluZ3Mub0FwaS5fZm5HZXRUck5vZGVzKG9TZXR0aW5ncykgKS5lYWNoKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIGFEYXRhLnB1c2goIHRoaXMudmFsdWUgKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIHJldHVybiBhRGF0YTsKCQkgKiAgICB9CgkJICovCgkJImFmblNvcnREYXRhIjogW10sCgkKCQoJCS8qKgoJCSAqIEZlYXR1cmUgcGx1Zy1pbnMgLSBUaGlzIGlzIGFuIGFycmF5IG9mIG9iamVjdHMgd2hpY2ggZGVzY3JpYmUgdGhlIGZlYXR1cmUgcGx1Zy1pbnMgdGhhdCBhcmUKCQkgKiBhdmFpbGFibGUgdG8gRGF0YVRhYmxlcy4gVGhlc2UgZmVhdHVyZSBwbHVnLWlucyBhcmUgYWNjZXNzaWJsZSB0aHJvdWdoIHRoZSBzRG9tIGluaXRpYWxpc2F0aW9uCgkJICogb3B0aW9uLiBBcyBzdWNoLCBlYWNoIGZlYXR1cmUgcGx1Zy1pbiBtdXN0IGRlc2NyaWJlIGEgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIHRvIGluaXRpYWxpc2UKCQkgKiBpdHNlbGYgKGZuSW5pdCksIGEgY2hhcmFjdGVyIHNvIHRoZSBmZWF0dXJlIGNhbiBiZSBlbmFibGVkIGJ5IHNEb20gKGNGZWF0dXJlKSBhbmQgdGhlIG5hbWUKCQkgKiBvZiB0aGUgZmVhdHVyZSAoc0ZlYXR1cmUpLiBUaHVzIHRoZSBvYmplY3RzIGF0dGFjaGVkIHRvIHRoaXMgbWV0aG9kIG11c3QgcHJvdmlkZToKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPntmdW5jdGlvbn0gZm5Jbml0IEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwbHVnLWluCgkJICogICAgICAgPHVsPgoJICAgICAqICAgICAgICAgPGxpPgoJICAgICAqICAgICAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntvYmplY3R9IERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0OiBzZWUge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfS48L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPntub2RlfG51bGx9IFRoZSBlbGVtZW50IHdoaWNoIGNvbnRhaW5zIHlvdXIgZmVhdHVyZS4gTm90ZSB0aGF0IHRoZSByZXR1cm4KCQkgKiAgICAgICAgICAgICAgICBtYXkgYWxzbyBiZSB2b2lkIGlmIHlvdXIgcGx1Zy1pbiBkb2VzIG5vdCByZXF1aXJlIHRvIGluamVjdCBhbnkgRE9NIGVsZW1lbnRzIAoJCSAqICAgICAgICAgICAgICAgIGludG8gRGF0YVRhYmxlcyBjb250cm9sIChzRG9tKSAtIGZvciBleGFtcGxlIHRoaXMgbWlnaHQgYmUgdXNlZnVsIHdoZW4gCgkJICogICAgICAgICAgICAgICAgZGV2ZWxvcGluZyBhIHBsdWctaW4gd2hpY2ggYWxsb3dzIHRhYmxlIGNvbnRyb2wgdmlhIGtleWJvYXJkIGVudHJ5LjwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvbGk+CgkJICogICAgIDxsaT57Y2hhcmFjdGVyfSBjRmVhdHVyZSBDaGFyYWN0ZXIgdGhhdCB3aWxsIGJlIG1hdGNoZWQgaW4gc0RvbSAtIGNhc2Ugc2Vuc2l0aXZlPC9saT4KCQkgKiAgICAgPGxpPntzdHJpbmd9IHNGZWF0dXJlIEZlYXR1cmUgbmFtZTwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEhvdyBUYWJsZVRvb2xzIGluaXRpYWxpc2VzIGl0c2VsZi4KCQkgKiAgICAkLmZuLmRhdGFUYWJsZUV4dC5hb0ZlYXR1cmVzLnB1c2goIHsKCQkgKiAgICAgICJmbkluaXQiOiBmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCSAqICAgICAgICByZXR1cm4gbmV3IFRhYmxlVG9vbHMoIHsgIm9EVFNldHRpbmdzIjogb1NldHRpbmdzIH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAiY0ZlYXR1cmUiOiAiVCIsCgkJICogICAgICAic0ZlYXR1cmUiOiAiVGFibGVUb29scyIKCQkgKiAgICB9ICk7CgkJICovCgkJImFvRmVhdHVyZXMiOiBbXSwKCQoJCgkJLyoqCgkJICogVHlwZSBkZXRlY3Rpb24gcGx1Zy1pbiBmdW5jdGlvbnMgLSBEYXRhVGFibGVzIHV0aWxpc2VzIHR5cGVzIHRvIGRlZmluZSBob3cgc29ydGluZyBhbmQKCQkgKiBmaWx0ZXJpbmcgYmVoYXZlLCBhbmQgdHlwZXMgY2FuIGJlIGVpdGhlciAgYmUgZGVmaW5lZCBieSB0aGUgZGV2ZWxvcGVyIChzVHlwZSBmb3IgdGhlCgkJICogY29sdW1uKSBvciB0aGV5IGNhbiBiZSBhdXRvbWF0aWNhbGx5IGRldGVjdGVkIGJ5IHRoZSBtZXRob2RzIGluIHRoaXMgYXJyYXkuIFRoZSBmdW5jdGlvbnMKCQkgKiBkZWZpbmVkIGluIHRoZSBhcnJheSBhcmUgcXVpdGUgc2ltcGxlLCB0YWtpbmcgYSBzaW5nbGUgcGFyYW1ldGVyICh0aGUgZGF0YSB0byBhbmFseXNlKSAKCQkgKiBhbmQgcmV0dXJuaW5nIHRoZSB0eXBlIGlmIGl0IGlzIGEga25vd24gdHlwZSwgb3IgbnVsbCBvdGhlcndpc2UuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSBmcm9tIHRoZSBjb2x1bW4gY2VsbCB0byBiZSBhbmFseXNlZDwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e3N0cmluZ3xudWxsfSBEYXRhIHR5cGUgZGV0ZWN0ZWQsIG9yIG51bGwgaWYgdW5rbm93biAoYW5kIHRodXMgcGFzcyBpdAoJCSAqICAgICAgICAgICBvbiB0byB0aGUgb3RoZXIgdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIEN1cnJlbmN5IHR5cGUgZGV0ZWN0aW9uIHBsdWctaW46CgkJICogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5hVHlwZXMucHVzaCgKCQkgKiAgICAgIGZ1bmN0aW9uICggc0RhdGEgKSB7CgkJICogICAgICAgIHZhciBzVmFsaWRDaGFycyA9ICIwMTIzNDU2Nzg5Li0iOwoJCSAqICAgICAgICB2YXIgQ2hhcjsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIENoZWNrIHRoZSBudW1lcmljIHBhcnQKCQkgKiAgICAgICAgZm9yICggaT0xIDsgaTxzRGF0YS5sZW5ndGggOyBpKysgKSB7CgkJICogICAgICAgICAgQ2hhciA9IHNEYXRhLmNoYXJBdChpKTsgCgkJICogICAgICAgICAgaWYgKHNWYWxpZENoYXJzLmluZGV4T2YoQ2hhcikgPT0gLTEpIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBudWxsOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gQ2hlY2sgcHJlZml4ZWQgYnkgY3VycmVuY3kKCQkgKiAgICAgICAgaWYgKCBzRGF0YS5jaGFyQXQoMCkgPT0gJyQnIHx8IHNEYXRhLmNoYXJBdCgwKSA9PSAnJnBvdW5kOycgKSB7CgkJICogICAgICAgICAgcmV0dXJuICdjdXJyZW5jeSc7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgcmV0dXJuIG51bGw7CgkJICogICAgICB9CgkJICogICAgKTsKCQkgKi8KCQkiYVR5cGVzIjogW10sCgkKCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIAoJCSAqIGluIG9yZGVyIHRvIGVuc3VyZSBjb21wYXRpYmlsaXR5LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1ZlcnNpb24gVmVyc2lvbiBzdHJpbmcgdG8gY2hlY2sgZm9yLCBpbiB0aGUgZm9ybWF0ICJYLlkuWiIuIE5vdGUgCgkJICogICAgdGhhdCB0aGUgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkJICogIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGlzIGdyZWF0ZXIgb3IgZXF1YWwgdG8gdGhlIAoJCSAqICAgIHJlcXVpcmVkIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgYWxlcnQoIG9UYWJsZS5mblZlcnNpb25DaGVjayggJzEuOS4wJyApICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblZlcnNpb25DaGVjayI6IGZ1bmN0aW9uKCBzVmVyc2lvbiApCgkJewoJCQkvKiBUaGlzIGlzIGNoZWFwLCBidXQgdmVyeSBlZmZlY3RpdmUgKi8KCQkJdmFyIGZuWlBhZCA9IGZ1bmN0aW9uIChacGFkLCBjb3VudCkKCQkJewoJCQkJd2hpbGUoWnBhZC5sZW5ndGggPCBjb3VudCkgewoJCQkJCVpwYWQgKz0gJzAnOwoJCQkJfQoJCQkJcmV0dXJuIFpwYWQ7CgkJCX07CgkJCXZhciBhVGhpcyA9IERhdGFUYWJsZS5leHQuc1ZlcnNpb24uc3BsaXQoJy4nKTsKCQkJdmFyIGFUaGF0ID0gc1ZlcnNpb24uc3BsaXQoJy4nKTsKCQkJdmFyIHNUaGlzID0gJycsIHNUaGF0ID0gJyc7CgkJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFUaGF0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXNUaGlzICs9IGZuWlBhZCggYVRoaXNbaV0sIDMgKTsKCQkJCXNUaGF0ICs9IGZuWlBhZCggYVRoYXRbaV0sIDMgKTsKCQkJfQoJCQkKCQkJcmV0dXJuIHBhcnNlSW50KHNUaGlzLCAxMCkgPj0gcGFyc2VJbnQoc1RoYXQsIDEwKTsKCQl9LAoJCgkKCQkvKioKCQkgKiBJbmRleCBmb3Igd2hhdCAndGhpcycgaW5kZXggQVBJIGZ1bmN0aW9ucyBzaG91bGQgdXNlCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlBcGlJbmRleCI6IDAsCgkKCQoJCS8qKgoJCSAqIFByZS1wcm9jZXNzaW5nIG9mIGZpbHRlcmluZyBkYXRhIHBsdWctaW5zIC0gV2hlbiB5b3UgYXNzaWduIHRoZSBzVHlwZSBmb3IgYSBjb2x1bW4KCQkgKiAob3IgaGF2ZSBpdCBhdXRvbWF0aWNhbGx5IGRldGVjdGVkIGZvciB5b3UgYnkgRGF0YVRhYmxlcyBvciBhIHR5cGUgZGV0ZWN0aW9uIHBsdWctaW4pLCAKCQkgKiB5b3Ugd2lsbCB0eXBpY2FsbHkgYmUgdXNpbmcgdGhpcyBmb3IgY3VzdG9tIHNvcnRpbmcsIGJ1dCBpdCBjYW4gYWxzbyBiZSB1c2VkIHRvIHByb3ZpZGUgCgkJICogY3VzdG9tIGZpbHRlcmluZyBieSBhbGxvd2luZyB5b3UgdG8gcHJlLXByb2Nlc3NpbmcgdGhlIGRhdGEgYW5kIHJldHVybmluZyB0aGUgZGF0YSBpbgoJCSAqIHRoZSBmb3JtYXQgdGhhdCBzaG91bGQgYmUgZmlsdGVyZWQgdXBvbi4gVGhpcyBpcyBkb25lIGJ5IGFkZGluZyBmdW5jdGlvbnMgdGhpcyBvYmplY3QgCgkJICogd2l0aCBhIHBhcmFtZXRlciBuYW1lIHdoaWNoIG1hdGNoZXMgdGhlIHNUeXBlIGZvciB0aGF0IHRhcmdldCBjb2x1bW4uIFRoaXMgaXMgdGhlCgkJICogY29yb2xsYXJ5IG9mIDxpPmFmblNvcnREYXRhPC9pPiBmb3IgZmlsdGVyaW5nIGRhdGEuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSBmcm9tIHRoZSBjb2x1bW4gY2VsbCB0byBiZSBwcmVwYXJlZCBmb3IgZmlsdGVyaW5nPC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57c3RyaW5nfG51bGx9IEZvcm1hdHRlZCBzdHJpbmcgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIHRoZSBmaWx0ZXJpbmcuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAKCQkgKiBOb3RlIHRoYXQgYXMgb2YgdjEuOSwgaXQgaXMgdHlwaWNhbGx5IHByZWZlcmFibGUgdG8gdXNlIDxpPm1EYXRhUHJvcDwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhUHJvcDwvaT4gd2hlbgoJCSAqIHVzZWQgYXMgYSBmdW5jdGlvbiB3aWxsIGdpdmUgeW91IGEgJ3R5cGUnIChzb3J0aW5nLCBmaWx0ZXJpbmcgZXRjKSB0aGF0IHlvdSBjYW4gdXNlIHRvIAoJCSAqIHByZXBhcmUgdGhlIGRhdGEgYXMgcmVxdWlyZWQgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMuIEFzIHN1Y2gsIHRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQub2ZuU2VhcmNoWyd0aXRsZS1udW1lcmljJ10gPSBmdW5jdGlvbiAoIHNEYXRhICkgewoJCSAqICAgICAgcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1xuL2csIiAiKS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkgKiAgICB9CgkJICovCgkJIm9mblNlYXJjaCI6IHt9LAoJCgkKCQkvKioKCQkgKiBDb250YWluZXIgZm9yIGFsbCBwcml2YXRlIGZ1bmN0aW9ucyBpbiBEYXRhVGFibGVzIHNvIHRoZXkgY2FuIGJlIGV4cG9zZWQgZXh0ZXJuYWxseQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0FwaSI6IHt9LAoJCgkKCQkvKioKCQkgKiBTdG9yYWdlIGZvciB0aGUgdmFyaW91cyBjbGFzc2VzIHRoYXQgRGF0YVRhYmxlcyB1c2VzCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvU3RkQ2xhc3NlcyI6IHt9LAoJCQoJCgkJLyoqCgkJICogU3RvcmFnZSBmb3IgdGhlIHZhcmlvdXMgY2xhc3NlcyB0aGF0IERhdGFUYWJsZXMgdXNlcyAtIGpRdWVyeSBVSSBzdWl0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0pVSUNsYXNzZXMiOiB7fSwKCQoJCgkJLyoqCgkJICogUGFnaW5hdGlvbiBwbHVnLWluIG1ldGhvZHMgLSBUaGUgc3R5bGUgYW5kIGNvbnRyb2xzIG9mIHRoZSBwYWdpbmF0aW9uIGNhbiBzaWduaWZpY2FudGx5IAoJCSAqIGltcGFjdCBvbiBob3cgdGhlIGVuZCB1c2VyIGludGVyYWN0cyB3aXRoIHRoZSBkYXRhIGluIHlvdXIgdGFibGUsIGFuZCBEYXRhVGFibGVzIGFsbG93cyAKCQkgKiB0aGUgYWRkaXRpb24gb2YgcGFnaW5hdGlvbiBjb250cm9scyBieSBleHRlbmRpbmcgdGhpcyBvYmplY3QsIHdoaWNoIGNhbiB0aGVuIGJlIGVuYWJsZWQKCQkgKiB0aHJvdWdoIHRoZSA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IGluaXRpYWxpc2F0aW9uIHBhcmFtZXRlci4gRWFjaCBwYWdpbmF0aW9uIHR5cGUgdGhhdAoJCSAqIGlzIGFkZGVkIGlzIGFuIG9iamVjdCAodGhlIHByb3BlcnR5IG5hbWUgb2Ygd2hpY2ggaXMgd2hhdCA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IHJlZmVycwoJCSAqIHRvKSB0aGF0IGhhcyB0d28gcHJvcGVydGllcywgYm90aCBtZXRob2RzIHRoYXQgYXJlIHVzZWQgYnkgRGF0YVRhYmxlcyB0byB1cGRhdGUgdGhlCgkJICogY29udHJvbCdzIHN0YXRlLgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwYWdpbmcgY29udHJvbHMuIENhbGxlZCBvbmx5IGR1cmluZyBpbml0aWFsaXNhdGlvbiAKCQkgKiAgICAgICAgIG9mIHRoZSB0YWJsZS4gSXQgaXMgZXhwZWN0ZWQgdGhhdCB0aGlzIGZ1bmN0aW9uIHdpbGwgYWRkIHRoZSByZXF1aXJlZCBET00gZWxlbWVudHMgCgkJICogICAgICAgICB0byB0aGUgcGFnZSBmb3IgdGhlIHBhZ2luZyBjb250cm9scyB0byB3b3JrLiBUaGUgZWxlbWVudCBwb2ludGVyIAoJCSAqICAgICAgICAgJ29TZXR0aW5ncy5hYW5GZWF0dXJlcy5wJyBhcnJheSBpcyBwcm92aWRlZCBieSBEYXRhVGFibGVzIHRvIGNvbnRhaW4gdGhlIHBhZ2luZyAKCQkgKiAgICAgICAgIGNvbnRyb2xzIChub3RlIHRoYXQgdGhpcyBpcyBhIDJEIGFycmF5IHRvIGFsbG93IGZvciBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgZWFjaCAKCQkgKiAgICAgICAgIERhdGFUYWJsZXMgRE9NIGVsZW1lbnQpLiBJdCBpcyBzdWdnZXN0ZWQgdGhhdCB5b3UgYWRkIHRoZSBjb250cm9scyB0byB0aGlzIGVsZW1lbnQgCgkJICogICAgICAgICBhcyBjaGlsZHJlbgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgICAgICA8bGk+e25vZGV9IENvbnRhaW5lciBpbnRvIHdoaWNoIHRoZSBwYWdpbmF0aW9uIGNvbnRyb2xzIG11c3QgYmUgaW5zZXJ0ZWQ8L2xpPgoJCSAqICAgICAgICAgICAgIDxsaT57ZnVuY3Rpb259IERyYXcgY2FsbGJhY2sgZnVuY3Rpb24gLSB3aGVuZXZlciB0aGUgY29udHJvbHMgY2F1c2UgYSBwYWdlCgkJICogICAgICAgICAgICAgICBjaGFuZ2UsIHRoaXMgbWV0aG9kIG11c3QgYmUgY2FsbGVkIHRvIHJlZHJhdyB0aGUgdGFibGUuPC9saT4KCSAgICAgKiAgICAgICAgICAgPC91bD4KCSAgICAgKiAgICAgICAgIDwvbGk+CgkJICogICAgICAgICA8bGk+CgkJICogICAgICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT5ObyByZXR1cm4gcmVxdWlyZWQ8L2xpPgoJCSAqICAgICAgICAgICA8L3VsPgoJCSAqICAgICAgICAgPC9pbD4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyIHRoZSBwYWdpbmcgc3RhdHVzIG9mIHRoZSB0YWJsZSBjaGFuZ2VzIGFuZCBpcwoJCSAqICAgICAgICAgdHlwaWNhbGx5IHVzZWQgdG8gdXBkYXRlIGNsYXNzZXMgYW5kL29yIHRleHQgb2YgdGhlIHBhZ2luZyBjb250cm9scyB0byByZWZsZXggdGhlIG5ldyAKCQkgKiAgICAgICAgIHN0YXR1cy4KCQkgKiAgICAgICA8dWw+CgkgICAgICogICAgICAgICA8bGk+CgkgICAgICogICAgICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICAgICAgPGxpPntmdW5jdGlvbn0gRHJhdyBjYWxsYmFjayBmdW5jdGlvbiAtIGluIGNhc2UgeW91IG5lZWQgdG8gcmVkcmF3IHRoZSB0YWJsZSBhZ2FpbgoJCSAqICAgICAgICAgICAgICAgb3IgYXR0YWNoIG5ldyBldmVudCBsaXN0ZW5lcnM8L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPk5vIHJldHVybiByZXF1aXJlZDwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uLmZvdXJfYnV0dG9uID0gewoJCSAqICAgICAgImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgbkZpcnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5QcmV2aW91cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTmV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTGFzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0ZpcnN0ICkgKTsKCQkgKiAgICAgICAgblByZXZpb3VzLmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc1ByZXZpb3VzICkgKTsKCQkgKiAgICAgICAgbk5leHQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zTmV4dCApICk7CgkJICogICAgICAgIG5MYXN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0xhc3QgKSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9idXR0b24gZmlyc3QiOwoJCSAqICAgICAgICBuUHJldmlvdXMuY2xhc3NOYW1lID0gInBhZ2luYXRlX2J1dHRvbiBwcmV2aW91cyI7CgkJICogICAgICAgIG5OZXh0LmNsYXNzTmFtZT0icGFnaW5hdGVfYnV0dG9uIG5leHQiOwoJCSAqICAgICAgICBuTGFzdC5jbGFzc05hbWUgPSAicGFnaW5hdGVfYnV0dG9uIGxhc3QiOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgblBhZ2luZy5hcHBlbmRDaGlsZCggbkZpcnN0ICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5QcmV2aW91cyApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTmV4dCApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTGFzdCApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuRmlyc3QpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAiZmlyc3QiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5QcmV2aW91cykuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgInByZXZpb3VzIiApOwoJCSAqICAgICAgICAgIGZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkgKiAgICAgICAgfSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuTmV4dCkuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgIm5leHQiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5MYXN0KS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAibGFzdCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQobkZpcnN0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5QcmV2aW91cykuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTmV4dCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTGFzdCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAKCQkgKiAgICAgICJmblVwZGF0ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKSB7CgkJICogICAgICAgICAgcmV0dXJuOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBMb29wIG92ZXIgZWFjaCBpbnN0YW5jZSBvZiB0aGUgcGFnZXIKCQkgKiAgICAgICAgdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJICogICAgICAgIGZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkgewoJCSAqICAgICAgICAgIHZhciBidXR0b25zID0gYW5baV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKTsKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMF0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzBdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkgewoJCSAqICAgICAgICAgICAgYnV0dG9uc1syXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfbmV4dCI7CgkJICogICAgICAgICAgICBidXR0b25zWzNdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzJdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1szXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZW5hYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0KCQkgKiAgICB9OwoJCSAqLwoJCSJvUGFnaW5hdGlvbiI6IHt9LAoJCgkKCQkvKioKCQkgKiBTb3J0aW5nIHBsdWctaW4gbWV0aG9kcyAtIFNvcnRpbmcgaW4gRGF0YVRhYmxlcyBpcyBiYXNlZCBvbiB0aGUgZGV0ZWN0ZWQgdHlwZSBvZiB0aGUKCQkgKiBkYXRhIGNvbHVtbiAoeW91IGNhbiBhZGQgeW91ciBvd24gdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLCBvciBvdmVycmlkZSBhdXRvbWF0aWMgCgkJICogZGV0ZWN0aW9uIHVzaW5nIHNUeXBlKS4gV2l0aCB0aGlzIHNwZWNpZmljIHR5cGUgZ2l2ZW4gdG8gdGhlIGNvbHVtbiwgRGF0YVRhYmxlcyB3aWxsIAoJCSAqIGFwcGx5IHRoZSByZXF1aXJlZCBzb3J0IGZyb20gdGhlIGZ1bmN0aW9ucyBpbiB0aGUgb2JqZWN0LiBFYWNoIHNvcnQgdHlwZSBtdXN0IHByb3ZpZGUKCQkgKiB0d28gbWFuZGF0b3J5IG1ldGhvZHMsIG9uZSBlYWNoIGZvciBhc2NlbmRpbmcgYW5kIGRlc2NlbmRpbmcgc29ydGluZywgYW5kIGNhbiBvcHRpb25hbGx5CgkJICogcHJvdmlkZSBhIHByZS1mb3JtYXR0aW5nIG1ldGhvZCB0aGF0IHdpbGwgaGVscCBzcGVlZCB1cCBzb3J0aW5nIGJ5IGFsbG93aW5nIERhdGFUYWJsZXMKCQkgKiB0byBwcmUtZm9ybWF0IHRoZSBzb3J0IGRhdGEgb25seSBvbmNlIChyYXRoZXIgdGhhbiBldmVyeSB0aW1lIHRoZSBhY3R1YWwgc29ydCBmdW5jdGlvbnMKCQkgKiBhcmUgcnVuKS4gVGhlIHR3byBzb3J0aW5nIGZ1bmN0aW9ucyBhcmUgdHlwaWNhbCBKYXZhc2NyaXB0IHNvcnQgbWV0aG9kczoKCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIHNlY29uZCBwYXJhbWV0ZXI8L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIGZpcnN0IHBhcmFtZXRlcjwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2ludH0gU29ydGluZyBtYXRjaDogPDAgaWYgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgbG93ZXIgdGhhbgoJCSAqICAgICAgICAgICB0aGUgc2Vjb25kIHBhcmFtZXRlciwgPT09MCBpZiB0aGUgdHdvIHBhcmFtZXRlcnMgYXJlIGVxdWFsIGFuZCA+MCBpZgoJCSAqICAgICAgICAgICB0aGUgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgaGVpZ2h0IHRoYW4gdGhlIHNlY29uZCBwYXJhbWV0ZXIuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDYXNlLXNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBubyBwcmUtZm9ybWF0dGluZyBtZXRob2QKCQkgKiAgICAkLmV4dGVuZCggJC5mbi5kYXRhVGFibGVFeHQub1NvcnQsIHsKCQkgKiAgICAgICJzdHJpbmctY2FzZS1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1jYXNlLWRlc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJICogICAgICB9CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gQ2FzZS1pbnNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBwcmUtZm9ybWF0dGluZwoJCSAqICAgICQuZXh0ZW5kKCAkLmZuLmRhdGFUYWJsZUV4dC5vU29ydCwgewoJCSAqICAgICAgInN0cmluZy1wcmUiOiBmdW5jdGlvbih4KSB7CgkJICogICAgICAgIHJldHVybiB4LnRvTG93ZXJDYXNlKCk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1kZXNjIjogZnVuY3Rpb24oeCx5KSB7CgkJICogICAgICAgIHJldHVybiAoKHggPCB5KSA/IDEgOiAoKHggPiB5KSA/IC0xIDogMCkpOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkib1NvcnQiOiB7fSwKCQoJCgkJLyoqCgkJICogVmVyc2lvbiBzdHJpbmcgZm9yIHBsdWctaW5zIHRvIGNoZWNrIGNvbXBhdGliaWxpdHkuIEFsbG93ZWQgZm9ybWF0IGlzCgkJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJCSAqIGUgYXJlIG9wdGlvbmFsCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBWZXJzaW9uIG51bWJlcgoJCSAqLwoJCSJzVmVyc2lvbiI6IERhdGFUYWJsZS52ZXJzaW9uLAoJCgkKCQkvKioKCQkgKiBIb3cgc2hvdWxkIERhdGFUYWJsZXMgcmVwb3J0IGFuIGVycm9yLiBDYW4gdGFrZSB0aGUgdmFsdWUgJ2FsZXJ0JyBvciAndGhyb3cnCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhbGVydAoJCSAqLwoJCSJzRXJyTW9kZSI6ICJhbGVydCIsCgkKCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGZvciBEYXRhVGFibGVzIHRvIGFjY2VzcyBnbG9iYWxseSBhYm91dCBvdGhlciBpbnN0YW5jZXMKCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfb0V4dGVybkNvbmZpZyI6IHsKCQkJLyogaW50OmlOZXh0VW5pcXVlIC0gbmV4dCB1bmlxdWUgbnVtYmVyIGZvciBhbiBpbnN0YW5jZSAqLwoJCQkiaU5leHRVbmlxdWUiOiAwCgkJfQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogc2VhcmNoIGluZm9ybWF0aW9uIGZvciB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVycy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCA9IHsKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBmaWx0ZXJpbmcgc2hvdWxkIGJlIGNhc2UgaW5zZW5zaXRpdmUgb3Igbm90CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiQ2FzZUluc2Vuc2l0aXZlIjogdHJ1ZSwKCQoJCS8qKgoJCSAqIEFwcGxpZWQgc2VhcmNoIHRlcm0KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic1NlYXJjaCI6ICIiLAoJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgc2VhcmNoIHRlcm0gc2hvdWxkIGJlIGludGVycHJldGVkIGFzIGEKCQkgKiByZWd1bGFyIGV4cHJlc3Npb24gKHRydWUpIG9yIG5vdCAoZmFsc2UpIGFuZCB0aGVyZWZvcmUgYW5kIHNwZWNpYWwKCQkgKiByZWdleCBjaGFyYWN0ZXJzIGVzY2FwZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYlJlZ2V4IjogZmFsc2UsCgkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIERhdGFUYWJsZXMgaXMgdG8gdXNlIGl0cyBzbWFydCBmaWx0ZXJpbmcgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYlNtYXJ0IjogdHJ1ZQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogZWFjaCBpbmRpdmlkdWFsIHJvdy4gVGhpcyBpcyB0aGUgb2JqZWN0IGZvcm1hdCB1c2VkIGZvciB0aGUgc2V0dGluZ3MgCgkgKiBhb0RhdGEgYXJyYXkuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzLm9Sb3cgPSB7CgkJLyoqCgkJICogVFIgZWxlbWVudCBmb3IgdGhlIHJvdwoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRyIjogbnVsbCwKCQoJCS8qKgoJCSAqIERhdGEgb2JqZWN0IGZyb20gdGhlIG9yaWdpbmFsIGRhdGEgc291cmNlIGZvciB0aGUgcm93LiBUaGlzIGlzIGVpdGhlcgoJCSAqIGFuIGFycmF5IGlmIHVzaW5nIHRoZSB0cmFkaXRpb25hbCBmb3JtIG9mIERhdGFUYWJsZXMsIG9yIGFuIG9iamVjdCBpZgoJCSAqIHVzaW5nIG1EYXRhUHJvcCBvcHRpb25zLiBUaGUgZXhhY3QgdHlwZSB3aWxsIGRlcGVuZCBvbiB0aGUgcGFzc2VkIGluCgkJICogZGF0YSBmcm9tIHRoZSBkYXRhIHNvdXJjZSwgb3Igd2lsbCBiZSBhbiBhcnJheSBpZiB1c2luZyBET00gYSBkYXRhIAoJCSAqIHNvdXJjZS4KCQkgKiAgQHR5cGUgYXJyYXl8b2JqZWN0CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJIl9hRGF0YSI6IFtdLAoJCgkJLyoqCgkJICogU29ydGluZyBkYXRhIGNhY2hlIC0gdGhpcyBhcnJheSBpcyBvc3RlbnNpYmx5IHRoZSBzYW1lIGxlbmd0aCBhcyB0aGUKCQkgKiBudW1iZXIgb2YgY29sdW1ucyAoYWx0aG91Z2ggZWFjaCBpbmRleCBpcyBnZW5lcmF0ZWQgb25seSBhcyBpdCBpcyAKCQkgKiBuZWVkZWQpLCBhbmQgaG9sZHMgdGhlIGRhdGEgdGhhdCBpcyB1c2VkIGZvciBzb3J0aW5nIGVhY2ggY29sdW1uIGluIHRoZQoJCSAqIHJvdy4gV2UgZG8gdGhpcyBjYWNoZSBnZW5lcmF0aW9uIGF0IHRoZSBzdGFydCBvZiB0aGUgc29ydCBpbiBvcmRlciB0aGF0CgkJICogdGhlIGZvcm1hdHRpbmcgb2YgdGhlIHNvcnQgZGF0YSBuZWVkIGJlIGRvbmUgb25seSBvbmNlIGZvciBlYWNoIGNlbGwKCQkgKiBwZXIgc29ydC4gVGhpcyBhcnJheSBzaG91bGQgbm90IGJlIHJlYWQgZnJvbSBvciB3cml0dGVuIHRvIGJ5IGFueXRoaW5nCgkJICogb3RoZXIgdGhhbiB0aGUgbWFzdGVyIHNvcnRpbmcgbWV0aG9kcy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2FTb3J0RGF0YSI6IFtdLAoJCgkJLyoqCgkJICogQXJyYXkgb2YgVEQgZWxlbWVudHMgdGhhdCBhcmUgY2FjaGVkIGZvciBoaWRkZW4gcm93cywgc28gdGhleSBjYW4gYmUKCQkgKiByZWluc2VydGVkIGludG8gdGhlIHRhYmxlIGlmIGEgY29sdW1uIGlzIG1hZGUgdmlzaWJsZSBhZ2FpbiAob3IgdG8gYWN0CgkJICogYXMgYSBzdG9yZSBpZiBhIGNvbHVtbiBpcyBtYWRlIGhpZGRlbikuIE9ubHkgaGlkZGVuIGNvbHVtbnMgaGF2ZSBhIAoJCSAqIHJlZmVyZW5jZSBpbiB0aGUgYXJyYXkuIEZvciBub24taGlkZGVuIGNvbHVtbnMgdGhlIHZhbHVlIGlzIGVpdGhlcgoJCSAqIHVuZGVmaW5lZCBvciBudWxsLgoJCSAqICBAdHlwZSBhcnJheSBub2RlcwoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYW5IaWRkZW4iOiBbXSwKCQoJCS8qKgoJCSAqIENhY2hlIG9mIHRoZSBjbGFzcyBuYW1lIHRoYXQgRGF0YVRhYmxlcyBoYXMgYXBwbGllZCB0byB0aGUgcm93LCBzbyB3ZQoJCSAqIGNhbiBxdWlja2x5IGxvb2sgYXQgdGhpcyB2YXJpYWJsZSByYXRoZXIgdGhhbiBuZWVkaW5nIHRvIGRvIGEgRE9NIGNoZWNrCgkJICogb24gY2xhc3NOYW1lIGZvciB0aGUgblRyIHByb3BlcnR5LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfc1Jvd1N0cmlwZSI6ICIiCgl9OwoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSBjb2x1bW4gaW5mb3JtYXRpb24gb2JqZWN0IGluIERhdGFUYWJsZXMuIFRoaXMgb2JqZWN0CgkgKiBpcyBoZWxkIGluIHRoZSBzZXR0aW5ncyBhb0NvbHVtbnMgYXJyYXkgYW5kIGNvbnRhaW5zIGFsbCB0aGUgaW5mb3JtYXRpb24gdGhhdAoJICogRGF0YVRhYmxlcyBuZWVkcyBhYm91dCBlYWNoIGluZGl2aWR1YWwgY29sdW1uLgoJICogCgkgKiBOb3RlIHRoYXQgdGhpcyBvYmplY3QgaXMgcmVsYXRlZCB0byB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnN9IAoJICogYnV0IHRoaXMgb25lIGlzIHRoZSBpbnRlcm5hbCBkYXRhIHN0b3JlIGZvciBEYXRhVGFibGVzJ3MgY2FjaGUgb2YgY29sdW1ucy4KCSAqIEl0IHNob3VsZCBOT1QgYmUgbWFuaXB1bGF0ZWQgb3V0c2lkZSBvZiBEYXRhVGFibGVzLiBBbnkgY29uZmlndXJhdGlvbiBzaG91bGQKCSAqIGJlIGRvbmUgdGhyb3VnaCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiA9IHsKCQkvKioKCQkgKiBBIGxpc3Qgb2YgdGhlIGNvbHVtbnMgdGhhdCBzb3J0aW5nIHNob3VsZCBvY2N1ciBvbiB3aGVuIHRoaXMgY29sdW1uCgkJICogaXMgc29ydGVkLiBUaGF0IHRoaXMgcHJvcGVydHkgaXMgYW4gYXJyYXkgYWxsb3dzIG11bHRpLWNvbHVtbiBzb3J0aW5nCgkJICogdG8gYmUgZGVmaW5lZCBmb3IgYSBjb2x1bW4gKGZvciBleGFtcGxlIGZpcnN0IG5hbWUgLyBsYXN0IG5hbWUgY29sdW1ucwoJCSAqIHdvdWxkIGJlbmVmaXQgZnJvbSB0aGlzKS4gVGhlIHZhbHVlcyBhcmUgaW50ZWdlcnMgcG9pbnRpbmcgdG8gdGhlCgkJICogY29sdW1ucyB0byBiZSBzb3J0ZWQgb24gKHR5cGljYWxseSBpdCB3aWxsIGJlIGEgc2luZ2xlIGludGVnZXIgcG9pbnRpbmcKCQkgKiBhdCBpdHNlbGYsIGJ1dCB0aGF0IGRvZXNuJ3QgbmVlZCB0byBiZSB0aGUgY2FzZSkuCgkJICogIEB0eXBlIGFycmF5CgkJICovCgkJImFEYXRhU29ydCI6IG51bGwsCgkKCQkvKioKCQkgKiBEZWZpbmUgdGhlIHNvcnRpbmcgZGlyZWN0aW9ucyB0aGF0IGFyZSBhcHBsaWVkIHRvIHRoZSBjb2x1bW4sIGluIHNlcXVlbmNlCgkJICogYXMgdGhlIGNvbHVtbiBpcyByZXBlYXRlZGx5IHNvcnRlZCB1cG9uIC0gaS5lLiB0aGUgZmlyc3QgdmFsdWUgaXMgdXNlZAoJCSAqIGFzIHRoZSBzb3J0aW5nIGRpcmVjdGlvbiB3aGVuIHRoZSBjb2x1bW4gaWYgZmlyc3Qgc29ydGVkIChjbGlja2VkIG9uKS4KCQkgKiBTb3J0IGl0IGFnYWluIChjbGljayBhZ2FpbikgYW5kIGl0IHdpbGwgbW92ZSBvbiB0byB0aGUgbmV4dCBpbmRleC4KCQkgKiBSZXBlYXQgdW50aWwgbG9vcC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKi8KCQkiYXNTb3J0aW5nIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgc2VhcmNoYWJsZSwgYW5kIHRodXMgc2hvdWxkIGJlIGluY2x1ZGVkCgkJICogaW4gdGhlIGZpbHRlcmluZyBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNlYXJjaGFibGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgdGhlIGNvbHVtbiBpcyBzb3J0YWJsZSBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNvcnRhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGVuIHVzaW5nIGZuUmVuZGVyLCB5b3UgaGF2ZSB0d28gb3B0aW9ucyBmb3Igd2hhdCB0byBkbyB3aXRoIHRoZSBkYXRhLAoJCSAqIGFuZCB0aGlzIHByb3BlcnR5IHNlcnZlcyBhcyB0aGUgc3dpdGNoLiBGaXJzdGx5LCB5b3UgY2FuIGhhdmUgdGhlIHNvcnRpbmcKCQkgKiBhbmQgZmlsdGVyaW5nIHVzZSB0aGUgcmVuZGVyZWQgdmFsdWUgKHRydWUgLSBkZWZhdWx0KSwgb3IgeW91IGNhbiBoYXZlCgkJICogdGhlIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB1cyB0aGUgb3JpZ2luYWwgdmFsdWUgKGZhbHNlKS4KCQkgKiAKCQkgKiAqTk9URSogSXQgaXMgaXQgaXMgYWR2aXNhYmxlIG5vdyB0byB1c2UgbURhdGFQcm9wIGFzIGEgZnVuY3Rpb24gYW5kIG1ha2UgCgkJICogdXNlIG9mIHRoZSAndHlwZScgdGhhdCBpdCBnaXZlcywgYWxsb3dpbmcgKHBvdGVudGlhbGx5KSBkaWZmZXJlbnQgZGF0YSB0bwoJCSAqIGJlIHVzZWQgZm9yIHNvcnRpbmcsIGZpbHRlcmluZywgZGlzcGxheSBhbmQgdHlwZSBkZXRlY3Rpb24uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgY3VycmVudGx5IHZpc2libGUgaW4gdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJWaXNpYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIHRvIHRoZSB0eXBlIGRldGVjdGlvbiBtZXRob2QgaWYgdGhlIGF1dG9tYXRpYyB0eXBlCgkJICogZGV0ZWN0aW9uIHNob3VsZCBiZSB1c2VkLCBvciBpZiBhIGNvbHVtbiB0eXBlIChzVHlwZSkgaGFzIGJlZW4gc3BlY2lmaWVkCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYkF1dG9UeXBlIjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBmblJlbmRlcgoJCSAqIGFsbG93aW5nIHlvdSB0byBtb2RpZnkgdGhlIERPTSBlbGVtZW50IChhZGQgYmFja2dyb3VuZCBjb2xvdXIgZm9yIGV4YW1wbGUpIHdoZW4gdGhlCgkJICogZWxlbWVudCBpcyBhdmFpbGFibGUgKHNpbmNlIGl0IGlzIG5vdCB3aGVuIGZuUmVuZGVyIGlzIGNhbGxlZCkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gblRkIFRoZSBURCBub2RlIHRoYXQgaGFzIGJlZW4gY3JlYXRlZAoJCSAqICBAcGFyYW0geyp9IHNEYXRhIFRoZSBEYXRhIGZvciB0aGUgY2VsbAoJCSAqICBAcGFyYW0ge2FycmF5fG9iamVjdH0gb0RhdGEgVGhlIGRhdGEgZm9yIHRoZSB3aG9sZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBpbmRleCBmb3IgdGhlIGFvRGF0YSBkYXRhIHN0b3JlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb24gdG8gZ2V0IGRhdGEgZnJvbSBhIGNlbGwgaW4gYSBjb2x1bW4uIFlvdSBzaG91bGQgPGI+bmV2ZXI8L2I+CgkJICogYWNjZXNzIGRhdGEgZGlyZWN0bHkgdGhyb3VnaCBfYURhdGEgaW50ZXJuYWxseSBpbiBEYXRhVGFibGVzIC0gYWx3YXlzIHVzZQoJCSAqIHRoZSBtZXRob2QgYXR0YWNoZWQgdG8gdGhpcyBwcm9wZXJ0eS4gSXQgYWxsb3dzIG1EYXRhUHJvcCB0byBmdW5jdGlvbiBhcwoJCSAqIHJlcXVpcmVkLiBUaGlzIGZ1bmN0aW9uIGlzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgYnkgdGhlIGNvbHVtbiAKCQkgKiBpbml0aWFsaXNhdGlvbiBtZXRob2QKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGFycmF5L29iamVjdCBmb3IgdGhlIGFycmF5IAoJCSAqICAgIChpLmUuIGFvRGF0YVtdLl9hRGF0YSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBUaGUgc3BlY2lmaWMgZGF0YSB0eXBlIHlvdSB3YW50IHRvIGdldCAtIAoJCSAqICAgICdkaXNwbGF5JywgJ3R5cGUnICdmaWx0ZXInICdzb3J0JwoJCSAqICBAcmV0dXJucyB7Kn0gVGhlIGRhdGEgZm9yIHRoZSBjZWxsIGZyb20gdGhlIGdpdmVuIHJvdydzIGRhdGEKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkdldERhdGEiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCAKCQkgKiBpbiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8gT2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YVJvdyBUaGUgcm93IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YUNvbHVtbiBUaGUgY29sdW1uIGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXkgICBvLmFEYXRhIFRoZSBkYXRhIGZvciB0aGUgcm93IGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvLm9TZXR0aW5ncyBUaGUgc2V0dGluZ3Mgb2JqZWN0IGZvciB0aGlzIERhdGFUYWJsZXMgaW5zdGFuY2UKCQkgKiAgQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyB5b3Ugd2hpY2ggdG8gdXNlIGluIHRoZSBkaXNwbGF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5SZW5kZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIHNldCBkYXRhIGZvciBhIGNlbGwgaW4gdGhlIGNvbHVtbi4gWW91IHNob3VsZCA8Yj5uZXZlcjwvYj4gCgkJICogc2V0IHRoZSBkYXRhIGRpcmVjdGx5IHRvIF9hRGF0YSBpbnRlcm5hbGx5IGluIERhdGFUYWJsZXMgLSBhbHdheXMgdXNlCgkJICogdGhpcyBtZXRob2QuIEl0IGFsbG93cyBtRGF0YVByb3AgdG8gZnVuY3Rpb24gYXMgcmVxdWlyZWQuIFRoaXMgZnVuY3Rpb24KCQkgKiBpcyBhdXRvbWF0aWNhbGx5IGFzc2lnbmVkIGJ5IHRoZSBjb2x1bW4gaW5pdGlhbGlzYXRpb24gbWV0aG9kCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBhcnJheS9vYmplY3QgZm9yIHRoZSBhcnJheSAKCQkgKiAgICAoaS5lLiBhb0RhdGFbXS5fYURhdGEpCgkJICogIEBwYXJhbSB7Kn0gc1ZhbHVlIFZhbHVlIHRvIHNldAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuU2V0RGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogUHJvcGVydHkgdG8gcmVhZCB0aGUgdmFsdWUgZm9yIHRoZSBjZWxscyBpbiB0aGUgY29sdW1uIGZyb20gdGhlIGRhdGEgCgkJICogc291cmNlIGFycmF5IC8gb2JqZWN0LiBJZiBudWxsLCB0aGVuIHRoZSBkZWZhdWx0IGNvbnRlbnQgaXMgdXNlZCwgaWYgYQoJCSAqIGZ1bmN0aW9uIGlzIGdpdmVuIHRoZW4gdGhlIHJldHVybiBmcm9tIHRoZSBmdW5jdGlvbiBpcyB1c2VkLgoJCSAqICBAdHlwZSBmdW5jdGlvbnxpbnR8c3RyaW5nfG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJtRGF0YVByb3AiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBoZWFkZXIgVEgvVEQgZWxlbWVudCBmb3IgdGhpcyBjb2x1bW4gLSB0aGlzIGlzIHdoYXQgdGhlIHNvcnRpbmcKCQkgKiBsaXN0ZW5lciBpcyBhdHRhY2hlZCB0byAoaWYgc29ydGluZyBpcyBlbmFibGVkLikKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UaCI6IG51bGwsCgkJCgkJLyoqCgkJICogVW5pcXVlIGZvb3RlciBUSC9URCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbiAoaWYgdGhlcmUgaXMgb25lKS4gTm90IHVzZWQgCgkJICogaW4gRGF0YVRhYmxlcyBhcyBzdWNoLCBidXQgY2FuIGJlIHVzZWQgZm9yIHBsdWctaW5zIHRvIHJlZmVyZW5jZSB0aGUgCgkJICogZm9vdGVyIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UZiI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzIHRvIGFwcGx5IHRvIGFsbCBURCBlbGVtZW50cyBpbiB0aGUgdGFibGUncyBUQk9EWSBmb3IgdGhlIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzQ2xhc3MiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoZW4gRGF0YVRhYmxlcyBjYWxjdWxhdGVzIHRoZSBjb2x1bW4gd2lkdGhzIHRvIGFzc2lnbiB0byBlYWNoIGNvbHVtbiwKCQkgKiBpdCBmaW5kcyB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gZWFjaCBjb2x1bW4gYW5kIHRoZW4gY29uc3RydWN0cyBhCgkJICogdGVtcG9yYXJ5IHRhYmxlIGFuZCByZWFkcyB0aGUgd2lkdGhzIGZyb20gdGhhdC4gVGhlIHByb2JsZW0gd2l0aCB0aGlzCgkJICogaXMgdGhhdCAibW1tIiBpcyBtdWNoIHdpZGVyIHRoZW4gImlpaWkiLCBidXQgdGhlIGxhdHRlciBpcyBhIGxvbmdlciAKCQkgKiBzdHJpbmcgLSB0aHVzIHRoZSBjYWxjdWxhdGlvbiBjYW4gZ28gd3JvbmcgKGRvaW5nIGl0IHByb3Blcmx5IGFuZCBwdXR0aW5nCgkJICogaXQgaW50byBhbiBET00gb2JqZWN0IGFuZCBtZWFzdXJpbmcgdGhhdCBpcyBob3JyaWJseSghKSBzbG93KS4gVGh1cyBhcwoJCSAqIGEgIndvcmsgYXJvdW5kIiB3ZSBwcm92aWRlIHRoaXMgb3B0aW9uLiBJdCB3aWxsIGFwcGVuZCBpdHMgdmFsdWUgdG8gdGhlCgkJICogdGV4dCB0aGF0IGlzIGZvdW5kIHRvIGJlIHRoZSBsb25nZXN0IHN0cmluZyBmb3IgdGhlIGNvbHVtbiAtIGkuZS4gcGFkZGluZy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNDb250ZW50UGFkZGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogQWxsb3dzIGEgZGVmYXVsdCB2YWx1ZSB0byBiZSBnaXZlbiBmb3IgYSBjb2x1bW4ncyBkYXRhLCBhbmQgd2lsbCBiZSB1c2VkCgkJICogd2hlbmV2ZXIgYSBudWxsIGRhdGEgc291cmNlIGlzIGVuY291bnRlcmVkICh0aGlzIGNhbiBiZSBiZWNhdXNlIG1EYXRhUHJvcAoJCSAqIGlzIHNldCB0byBudWxsLCBvciBiZWNhdXNlIHRoZSBkYXRhIHNvdXJjZSBpdHNlbGYgaXMgbnVsbCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNEZWZhdWx0Q29udGVudCI6IG51bGwsCgkJCgkJLyoqCgkJICogTmFtZSBmb3IgdGhlIGNvbHVtbiwgYWxsb3dpbmcgcmVmZXJlbmNlIHRvIHRoZSBjb2x1bW4gYnkgbmFtZSBhcyB3ZWxsIGFzCgkJICogYnkgaW5kZXggKG5lZWRzIGEgbG9va3VwIHRvIHdvcmsgYnkgbmFtZSkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzTmFtZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ3VzdG9tIHNvcnRpbmcgZGF0YSB0eXBlIC0gZGVmaW5lcyB3aGljaCBvZiB0aGUgYXZhaWxhYmxlIHBsdWctaW5zIGluCgkJICogYWZuU29ydERhdGEgdGhlIGN1c3RvbSBzb3J0aW5nIHdpbGwgdXNlIC0gaWYgYW55IGlzIGRlZmluZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKi8KCQkic1NvcnREYXRhVHlwZSI6ICdzdGQnLAoJCQoJCS8qKgoJCSAqIENsYXNzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGhlYWRlciBlbGVtZW50IHdoZW4gc29ydGluZyBvbiB0aGlzIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzU29ydGluZ0NsYXNzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzcyB0byBiZSBhcHBsaWVkIHRvIHRoZSBoZWFkZXIgZWxlbWVudCB3aGVuIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4gLQoJCSAqIHdoZW4galF1ZXJ5IFVJIHRoZW1pbmcgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1NvcnRpbmdDbGFzc0pVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGl0bGUgb2YgdGhlIGNvbHVtbiAtIHdoYXQgaXMgc2VlbiBpbiB0aGUgVEggZWxlbWVudCAoblRoKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ29sdW1uIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB0eXBlCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNUeXBlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaWR0aCBvZiB0aGUgY29sdW1uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aCI6IG51bGwsCgkJCgkJLyoqCgkJICogV2lkdGggb2YgdGhlIGNvbHVtbiB3aGVuIGl0IHdhcyBmaXJzdCAiZW5jb3VudGVyZWQiCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aE9yaWciOiBudWxsCgl9OwoJCgkKCQoJLyoqCgkgKiBJbml0aWFsaXNhdGlvbiBvcHRpb25zIHRoYXQgY2FuIGJlIGdpdmVuIHRvIERhdGFUYWJsZXMgYXQgaW5pdGlhbGlzYXRpb24gCgkgKiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzID0gewoJCS8qKgoJCSAqIEFuIGFycmF5IG9mIGRhdGEgdG8gdXNlIGZvciB0aGUgdGFibGUsIHBhc3NlZCBpbiBhdCBpbml0aWFsaXNhdGlvbiB3aGljaCAKCQkgKiB3aWxsIGJlIHVzZWQgaW4gcHJlZmVyZW5jZSB0byBhbnkgZGF0YSB3aGljaCBpcyBhbHJlYWR5IGluIHRoZSBET00uIFRoaXMgaXMKCQkgKiBwYXJ0aWN1bGFybHkgdXNlZnVsIGZvciBjb25zdHJ1Y3RpbmcgdGFibGVzIHB1cmVseSBpbiBKYXZhc2NyaXB0LCBmb3IKCQkgKiBleGFtcGxlIHdpdGggYSBjdXN0b20gQWpheCBjYWxsLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhIDJEIGFycmF5IGRhdGEgc291cmNlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYURhdGEiOiBbCgkJICogICAgICAgICAgWydUcmlkZW50JywgJ0ludGVybmV0IEV4cGxvcmVyIDQuMCcsICdXaW4gOTUrJywgNCwgJ1gnXSwKCQkgKiAgICAgICAgICBbJ1RyaWRlbnQnLCAnSW50ZXJuZXQgRXhwbG9yZXIgNS4wJywgJ1dpbiA5NSsnLCA1LCAnQyddLAoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJHcmFkZSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFuIGFycmF5IG9mIG9iamVjdHMgYXMgYSBkYXRhIHNvdXJjZSAobURhdGFQcm9wKQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFEYXRhIjogWwoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJlbmdpbmUiOiAgICJUcmlkZW50IiwKCQkgKiAgICAgICAgICAgICJicm93c2VyIjogICJJbnRlcm5ldCBFeHBsb3JlciA0LjAiLAoJCSAqICAgICAgICAgICAgInBsYXRmb3JtIjogIldpbiA5NSsiLAoJCSAqICAgICAgICAgICAgInZlcnNpb24iOiAgNCwKCQkgKiAgICAgICAgICAgICJncmFkZSI6ICAgICJYIgoJCSAqICAgICAgICAgIH0sCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImVuZ2luZSI6ICAgIlRyaWRlbnQiLAoJCSAqICAgICAgICAgICAgImJyb3dzZXIiOiAgIkludGVybmV0IEV4cGxvcmVyIDUuMCIsCgkJICogICAgICAgICAgICAicGxhdGZvcm0iOiAiV2luIDk1KyIsCgkJICogICAgICAgICAgICAidmVyc2lvbiI6ICA1LAoJCSAqICAgICAgICAgICAgImdyYWRlIjogICAgIkMiCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiLCAgICJtRGF0YVByb3AiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJCcm93c2VyIiwgICJtRGF0YVByb3AiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiUGxhdGZvcm0iLCAibURhdGFQcm9wIjogInBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiwgICJtRGF0YVByb3AiOiAidmVyc2lvbiIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiR3JhZGUiLCAgICAibURhdGFQcm9wIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhRGF0YSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElmIHNvcnRpbmcgaXMgZW5hYmxlZCwgdGhlbiBEYXRhVGFibGVzIHdpbGwgcGVyZm9ybSBhIGZpcnN0IHBhc3Mgc29ydCBvbiAKCQkgKiBpbml0aWFsaXNhdGlvbi4gWW91IGNhbiBkZWZpbmUgd2hpY2ggY29sdW1uKHMpIHRoZSBzb3J0IGlzIHBlcmZvcm1lZCB1cG9uLCAKCQkgKiBhbmQgdGhlIHNvcnRpbmcgZGlyZWN0aW9uLCB3aXRoIHRoaXMgdmFyaWFibGUuIFRoZSBhYVNvcnRpbmcgYXJyYXkgc2hvdWxkIAoJCSAqIGNvbnRhaW4gYW4gYXJyYXkgZm9yIGVhY2ggY29sdW1uIHRvIGJlIHNvcnRlZCBpbml0aWFsbHkgY29udGFpbmluZyB0aGUgCgkJICogY29sdW1uJ3MgaW5kZXggYW5kIGEgZGlyZWN0aW9uIHN0cmluZyAoJ2FzYycgb3IgJ2Rlc2MnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW1swLCdhc2MnXV0KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNvcnQgYnkgM3JkIGNvbHVtbiBmaXJzdCwgYW5kIHRoZW4gNHRoIGNvbHVtbgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmciOiBbWzIsJ2FzYyddLCBbMywnZGVzYyddXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICAvLyBObyBpbml0aWFsIHNvcnRpbmcKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFTb3J0aW5nIjogW10KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhU29ydGluZyI6IFtbMCwnYXNjJ11dLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBpcyBiYXNpY2FsbHkgaWRlbnRpY2FsIHRvIHRoZSBhYVNvcnRpbmcgcGFyYW1ldGVyLCBidXQgCgkJICogY2Fubm90IGJlIG92ZXJyaWRkZW4gYnkgdXNlciBpbnRlcmFjdGlvbiB3aXRoIHRoZSB0YWJsZS4gV2hhdCB0aGlzIG1lYW5zIAoJCSAqIGlzIHRoYXQgeW91IGNvdWxkIGhhdmUgYSBjb2x1bW4gKHZpc2libGUgb3IgaGlkZGVuKSB3aGljaCB0aGUgc29ydGluZyB3aWxsIAoJCSAqIGFsd2F5cyBiZSBmb3JjZWQgb24gZmlyc3QgLSBhbnkgc29ydGluZyBhZnRlciB0aGF0IChmcm9tIHRoZSB1c2VyKSB3aWxsIAoJCSAqIHRoZW4gYmUgcGVyZm9ybWVkIGFzIHJlcXVpcmVkLiBUaGlzIGNhbiBiZSB1c2VmdWwgZm9yIGdyb3VwaW5nIHJvd3MgCgkJICogdG9nZXRoZXIuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmdGaXhlZCI6IFtbMCwnYXNjJ11dCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byByZWFkaWx5IHNwZWNpZnkgdGhlIGVudHJpZXMgaW4gdGhlIGxlbmd0aCBkcm9wCgkJICogZG93biBtZW51IHRoYXQgRGF0YVRhYmxlcyBzaG93cyB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4gSXQgY2FuIGJlIAoJCSAqIGVpdGhlciBhIDFEIGFycmF5IG9mIG9wdGlvbnMgd2hpY2ggd2lsbCBiZSB1c2VkIGZvciBib3RoIHRoZSBkaXNwbGF5ZWQgCgkJICogb3B0aW9uIGFuZCB0aGUgdmFsdWUsIG9yIGEgMkQgYXJyYXkgd2hpY2ggd2lsbCB1c2UgdGhlIGFycmF5IGluIHRoZSBmaXJzdCAKCQkgKiBwb3NpdGlvbiBhcyB0aGUgdmFsdWUsIGFuZCB0aGUgYXJyYXkgaW4gdGhlIHNlY29uZCBwb3NpdGlvbiBhcyB0aGUgCgkJICogZGlzcGxheWVkIG9wdGlvbnMgKHVzZWZ1bCBmb3IgbGFuZ3VhZ2Ugc3RyaW5ncyBzdWNoIGFzICdBbGwnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgWyAxMCwgMjUsIDUwLCAxMDAgXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzEwLCAyNSwgNTAsIC0xXSwgWzEwLCAyNSwgNTAsICJBbGwiXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNldHRpbmcgdGhlIGRlZmF1bHQgZGlzcGxheSBsZW5ndGggYXMgd2VsbCBhcyBsZW5ndGggbWVudQoJCSAqICAgIC8vIFRoaXMgaXMgbGlrZWx5IHRvIGJlIHdhbnRlZCBpZiB5b3UgcmVtb3ZlIHRoZSAnMTAnIG9wdGlvbiB3aGljaAoJCSAqICAgIC8vIGlzIHRoZSBpRGlzcGxheUxlbmd0aCBkZWZhdWx0LgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogMjUsCgkJICogICAgICAgICJhTGVuZ3RoTWVudSI6IFtbMjUsIDUwLCAxMDAsIC0xXSwgWzI1LCA1MCwgMTAwLCAiQWxsIl1dCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhTGVuZ3RoTWVudSI6IFsgMTAsIDI1LCA1MCwgMTAwIF0sCgkKCQoJCS8qKgoJCSAqIFRoZSBhb0NvbHVtbnMgb3B0aW9uIGluIHRoZSBpbml0aWFsaXNhdGlvbiBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byBkZWZpbmUKCQkgKiBkZXRhaWxzIGFib3V0IHRoZSB3YXkgaW5kaXZpZHVhbCBjb2x1bW5zIGJlaGF2ZS4gRm9yIGEgZnVsbCBsaXN0IG9mCgkJICogY29sdW1uIG9wdGlvbnMgdGhhdCBjYW4gYmUgc2V0LCBwbGVhc2Ugc2VlIAoJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uc30uIE5vdGUgdGhhdCBpZiB5b3UgdXNlIGFvQ29sdW1ucyB0bwoJCSAqIGRlZmluZSB5b3VyIGNvbHVtbnMsIHlvdSBtdXN0IGhhdmUgYW4gZW50cnkgaW4gdGhlIGFycmF5IGZvciBldmVyeSBzaW5nbGUKCQkgKiBjb2x1bW4gdGhhdCB5b3UgaGF2ZSBpbiB5b3VyIHRhYmxlICh0aGVzZSBjYW4gYmUgbnVsbCBpZiB5b3UgZG9uJ3Qgd2hpY2gKCQkgKiB0byBzcGVjaWZ5IGFueSBvcHRpb25zKS4KCQkgKiAgQG1lbWJlcgoJCSAqLwoJCSJhb0NvbHVtbnMiOiBudWxsLAoJCgkJLyoqCgkJICogVmVyeSBzaW1pbGFyIHRvIGFvQ29sdW1ucywgYW9Db2x1bW5EZWZzIGFsbG93cyB5b3UgdG8gdGFyZ2V0IGEgc3BlY2lmaWMgCgkJICogY29sdW1uLCBtdWx0aXBsZSBjb2x1bW5zLCBvciBhbGwgY29sdW1ucywgdXNpbmcgdGhlIGFUYXJnZXRzIHByb3BlcnR5IG9mIAoJCSAqIGVhY2ggb2JqZWN0IGluIHRoZSBhcnJheS4gVGhpcyBhbGxvd3MgZ3JlYXQgZmxleGliaWxpdHkgd2hlbiBjcmVhdGluZyAKCQkgKiB0YWJsZXMsIGFzIHRoZSBhb0NvbHVtbkRlZnMgYXJyYXlzIGNhbiBiZSBvZiBhbnkgbGVuZ3RoLCB0YXJnZXRpbmcgdGhlIAoJCSAqIGNvbHVtbnMgeW91IHNwZWNpZmljYWxseSB3YW50LiBhb0NvbHVtbkRlZnMgbWF5IHVzZSBhbnkgb2YgdGhlIGNvbHVtbiAKCQkgKiBvcHRpb25zIGF2YWlsYWJsZToge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zfSwgYnV0IGl0IF9tdXN0XwoJCSAqIGhhdmUgYVRhcmdldHMgZGVmaW5lZCBpbiBlYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkuIFZhbHVlcyBpbiB0aGUgYVRhcmdldHMKCQkgKiBhcnJheSBtYXkgYmU6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5hIHN0cmluZyAtIGNsYXNzIG5hbWUgd2lsbCBiZSBtYXRjaGVkIG9uIHRoZSBUSCBmb3IgdGhlIGNvbHVtbjwvbGk+CgkJICogICAgIDxsaT4wIG9yIGEgcG9zaXRpdmUgaW50ZWdlciAtIGNvbHVtbiBpbmRleCBjb3VudGluZyBmcm9tIHRoZSBsZWZ0PC9saT4KCQkgKiAgICAgPGxpPmEgbmVnYXRpdmUgaW50ZWdlciAtIGNvbHVtbiBpbmRleCBjb3VudGluZyBmcm9tIHRoZSByaWdodDwvbGk+CgkJICogICAgIDxsaT50aGUgc3RyaW5nICJfYWxsIiAtIGFsbCBjb2x1bW5zIChpLmUuIGFzc2lnbiBhIGRlZmF1bHQpPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEBtZW1iZXIKCQkgKi8KCQkiYW9Db2x1bW5EZWZzIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQmFzaWNhbGx5IHRoZSBzYW1lIGFzIG9TZWFyY2gsIHRoaXMgcGFyYW1ldGVyIGRlZmluZXMgdGhlIGluZGl2aWR1YWwgY29sdW1uCgkJICogZmlsdGVyaW5nIHN0YXRlIGF0IGluaXRpYWxpc2F0aW9uIHRpbWUuIFRoZSBhcnJheSBtdXN0IGJlIG9mIHRoZSBzYW1lIHNpemUgCgkJICogYXMgdGhlIG51bWJlciBvZiBjb2x1bW5zLCBhbmQgZWFjaCBlbGVtZW50IGJlIGFuIG9iamVjdCB3aXRoIHRoZSBwYXJhbWV0ZXJzCgkJICogInNTZWFyY2giIGFuZCAiYkVzY2FwZVJlZ2V4IiAodGhlIGxhdHRlciBpcyBvcHRpb25hbCkuICdudWxsJyBpcyBhbHNvCgkJICogYWNjZXB0ZWQgYW5kIHRoZSBkZWZhdWx0IHdpbGwgYmUgdXNlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb1NlYXJjaENvbHMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJzU2VhcmNoIjogIk15IGZpbHRlciIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTZWFyY2giOiAiXlswLTldIiwgImJFc2NhcGVSZWdleCI6IGZhbHNlIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJhb1NlYXJjaENvbHMiOiBbXSwKCQoJCgkJLyoqCgkJICogQW4gYXJyYXkgb2YgQ1NTIGNsYXNzZXMgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBkaXNwbGF5ZWQgcm93cy4gVGhpcyAKCQkgKiBhcnJheSBtYXkgYmUgb2YgYW55IGxlbmd0aCwgYW5kIERhdGFUYWJsZXMgd2lsbCBhcHBseSBlYWNoIGNsYXNzIAoJCSAqIHNlcXVlbnRpYWxseSwgbG9vcGluZyB3aGVuIHJlcXVpcmVkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbICdvZGQnLCAnZXZlbicgXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFzU3RyaXBlQ2xhc3NlcyI6IFsgJ3N0cmlwMScsICdzdHJpcDInLCAnc3RyaXAzJyBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFzU3RyaXBlQ2xhc3NlcyI6IFsgJ29kZCcsICdldmVuJyBdLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBhdXRvbWF0aWMgY29sdW1uIHdpZHRoIGNhbGN1bGF0aW9uLiBUaGlzIGNhbiBiZSBkaXNhYmxlZAoJCSAqIGFzIGFuIG9wdGltaXNhdGlvbiAoaXQgdGFrZXMgc29tZSB0aW1lIHRvIGNhbGN1bGF0ZSB0aGUgd2lkdGhzKSBpZiB0aGUKCQkgKiB0YWJsZXMgd2lkdGhzIGFyZSBwYXNzZWQgaW4gdXNpbmcgYW9Db2x1bW5zLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiQXV0b1dpZHRoIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJBdXRvV2lkdGgiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBEZWZlcnJlZCByZW5kZXJpbmcgY2FuIHByb3ZpZGUgRGF0YVRhYmxlcyB3aXRoIGEgaHVnZSBzcGVlZCBib29zdCB3aGVuIHlvdQoJCSAqIGFyZSB1c2luZyBhbiBBamF4IG9yIEpTIGRhdGEgc291cmNlIGZvciB0aGUgdGFibGUuIFRoaXMgb3B0aW9uLCB3aGVuIHNldCB0bwoJCSAqIHRydWUsIHdpbGwgY2F1c2UgRGF0YVRhYmxlcyB0byBkZWZlciB0aGUgY3JlYXRpb24gb2YgdGhlIHRhYmxlIGVsZW1lbnRzIGZvcgoJCSAqIGVhY2ggcm93IHVudGlsIHRoZXkgYXJlIG5lZWRlZCBmb3IgYSBkcmF3IC0gc2F2aW5nIGEgc2lnbmlmaWNhbnQgYW1vdW50IG9mCgkJICogdGltZS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9hcnJheXMudHh0IiwKCQkgKiAgICAgICAgImJEZWZlclJlbmRlciI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJEZWZlclJlbmRlciI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBSZXBsYWNlIGEgRGF0YVRhYmxlIHdoaWNoIG1hdGNoZXMgdGhlIGdpdmVuIHNlbGVjdG9yIGFuZCByZXBsYWNlIGl0IHdpdGggCgkJICogb25lIHdoaWNoIGhhcyB0aGUgcHJvcGVydGllcyBvZiB0aGUgbmV3IGluaXRpYWxpc2F0aW9uIG9iamVjdCBwYXNzZWQuIElmIG5vCgkJICogdGFibGUgbWF0Y2hlcyB0aGUgc2VsZWN0b3IsIHRoZW4gdGhlIG5ldyBEYXRhVGFibGUgd2lsbCBiZSBjb25zdHJ1Y3RlZCBhcwoJCSAqIHBlciBub3JtYWwuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb21lIHRpbWUgbGF0ZXIuLi4uCgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkZpbHRlciI6IGZhbHNlLAoJCSAqICAgICAgICAiYkRlc3Ryb3kiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRGVzdHJveSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBmaWx0ZXJpbmcgb2YgZGF0YS4gRmlsdGVyaW5nIGluIERhdGFUYWJsZXMgaXMgInNtYXJ0IiBpbgoJCSAqIHRoYXQgaXQgYWxsb3dzIHRoZSBlbmQgdXNlciB0byBpbnB1dCBtdWx0aXBsZSB3b3JkcyAoc3BhY2Ugc2VwYXJhdGVkKSBhbmQKCQkgKiB3aWxsIG1hdGNoIGEgcm93IGNvbnRhaW5pbmcgdGhvc2Ugd29yZHMsIGV2ZW4gaWYgbm90IGluIHRoZSBvcmRlciB0aGF0IHdhcwoJCSAqIHNwZWNpZmllZCAodGhpcyBhbGxvdyBtYXRjaGluZyBhY3Jvc3MgbXVsdGlwbGUgY29sdW1ucykuIE5vdGUgdGhhdCBpZiB5b3UKCQkgKiB3aXNoIHRvIHVzZSBmaWx0ZXJpbmcgaW4gRGF0YVRhYmxlcyB0aGlzIG11c3QgcmVtYWluICd0cnVlJyAtIHRvIHJlbW92ZSB0aGUKCQkgKiBkZWZhdWx0IGZpbHRlcmluZyBpbnB1dCBib3ggYW5kIHJldGFpbiBmaWx0ZXJpbmcgYWJpbGl0aWVzLCBwbGVhc2UgdXNlCgkJICogQHJlZntzRG9tfS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkZpbHRlciI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRmlsdGVyIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIHRhYmxlIGluZm9ybWF0aW9uIGRpc3BsYXkuIFRoaXMgc2hvd3MgaW5mb3JtYXRpb24gCgkJICogYWJvdXQgdGhlIGRhdGEgdGhhdCBpcyBjdXJyZW50bHkgdmlzaWJsZSBvbiB0aGUgcGFnZSwgaW5jbHVkaW5nIGluZm9ybWF0aW9uCgkJICogYWJvdXQgZmlsdGVyZWQgZGF0YSBpZiB0aGF0IGFjdGlvbiBpcyBiZWluZyBwZXJmb3JtZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJJbmZvIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJJbmZvIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGpRdWVyeSBVSSBUaGVtZVJvbGxlciBzdXBwb3J0IChyZXF1aXJlZCBhcyBUaGVtZVJvbGxlciByZXF1aXJlcyBzb21lCgkJICogc2xpZ2h0bHkgZGlmZmVyZW50IGFuZCBhZGRpdGlvbmFsIG1hcmstdXAgZnJvbSB3aGF0IERhdGFUYWJsZXMgaGFzCgkJICogdHJhZGl0aW9uYWxseSB1c2VkKS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkpRdWVyeVVJIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkpRdWVyeVVJIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIEFsbG93cyB0aGUgZW5kIHVzZXIgdG8gc2VsZWN0IHRoZSBzaXplIG9mIGEgZm9ybWF0dGVkIHBhZ2UgZnJvbSBhIHNlbGVjdAoJCSAqIG1lbnUgKHNpemVzIGFyZSAxMCwgMjUsIDUwIGFuZCAxMDApLiBSZXF1aXJlcyBwYWdpbmF0aW9uIChiUGFnaW5hdGUpLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBwYWdpbmF0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlBhZ2luYXRlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgYSAncHJvY2Vzc2luZycgaW5kaWNhdG9yIHdoZW4gdGhlIHRhYmxlIGlzCgkJICogYmVpbmcgcHJvY2Vzc2VkIChlLmcuIGEgc29ydCkuIFRoaXMgaXMgcGFydGljdWxhcmx5IHVzZWZ1bCBmb3IgdGFibGVzIHdpdGgKCQkgKiBsYXJnZSBhbW91bnRzIG9mIGRhdGEgd2hlcmUgaXQgY2FuIHRha2UgYSBub3RpY2VhYmxlIGFtb3VudCBvZiB0aW1lIHRvIHNvcnQKCQkgKiB0aGUgZW50cmllcy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlByb2Nlc3NpbmciOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogUmV0cmlldmUgdGhlIERhdGFUYWJsZXMgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gc2VsZWN0b3IuIE5vdGUgdGhhdCBpZiB0aGUKCQkgKiB0YWJsZSBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYWxpc2VkLCB0aGlzIHBhcmFtZXRlciB3aWxsIGNhdXNlIERhdGFUYWJsZXMKCQkgKiB0byBzaW1wbHkgcmV0dXJuIHRoZSBvYmplY3QgdGhhdCBoYXMgYWxyZWFkeSBiZWVuIHNldCB1cCAtIGl0IHdpbGwgbm90IHRha2UKCQkgKiBhY2NvdW50IG9mIGFueSBjaGFuZ2VzIHlvdSBtaWdodCBoYXZlIG1hZGUgdG8gdGhlIGluaXRpYWxpc2F0aW9uIG9iamVjdAoJCSAqIHBhc3NlZCB0byBEYXRhVGFibGVzIChzZXR0aW5nIHRoaXMgcGFyYW1ldGVyIHRvIHRydWUgaXMgYW4gYWNrbm93bGVkZ2VtZW50CgkJICogdGhhdCB5b3UgdW5kZXJzdGFuZCB0aGlzKS4gYkRlc3Ryb3kgY2FuIGJlIHVzZWQgdG8gcmVpbml0aWFsaXNlIGEgdGFibGUgaWYKCQkgKiB5b3UgbmVlZC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgaW5pdFRhYmxlKCk7CgkJICogICAgICB0YWJsZUFjdGlvbnMoKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogICAgZnVuY3Rpb24gaW5pdFRhYmxlICgpCgkJICogICAgewoJCSAqICAgICAgcmV0dXJuICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIsCgkJICogICAgICAgICJiUGFnaW5hdGUiOiBmYWxzZSwKCQkgKiAgICAgICAgImJSZXRyaWV2ZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9CgkJICogICAgCgkJICogICAgZnVuY3Rpb24gdGFibGVBY3Rpb25zICgpCgkJICogICAgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9IGluaXRUYWJsZSgpOwoJCSAqICAgICAgLy8gcGVyZm9ybSBBUEkgb3BlcmF0aW9ucyB3aXRoIG9UYWJsZSAKCQkgKiAgICB9CgkJICovCgkJImJSZXRyaWV2ZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiBEYXRhVGFibGVzIHNob3VsZCBiZSBhbGxvd2VkIHRvIHNldCB0aGUgcGFkZGluZyAvIG1hcmdpbgoJCSAqIGV0YyBmb3IgdGhlIHNjcm9sbGluZyBoZWFkZXIgZWxlbWVudHMgb3Igbm90LiBUeXBpY2FsbHkgeW91IHdpbGwgd2FudAoJCSAqIHRoaXMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTY3JvbGxBdXRvQ3NzIjogZmFsc2UsCgkJICogICAgICAgICJzU2Nyb2xsWSI6ICIyMDBweCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxBdXRvQ3NzIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB2ZXJ0aWNhbCAoeSkgc2Nyb2xsaW5nIGlzIGVuYWJsZWQsIERhdGFUYWJsZXMgd2lsbCBmb3JjZSB0aGUgaGVpZ2h0IG9mCgkJICogdGhlIHRhYmxlJ3Mgdmlld3BvcnQgdG8gdGhlIGdpdmVuIGhlaWdodCBhdCBhbGwgdGltZXMgKHVzZWZ1bCBmb3IgbGF5b3V0KS4KCQkgKiBIb3dldmVyLCB0aGlzIGNhbiBsb29rIG9kZCB3aGVuIGZpbHRlcmluZyBkYXRhIGRvd24gdG8gYSBzbWFsbCBkYXRhIHNldCwKCQkgKiBhbmQgdGhlIGZvb3RlciBpcyBsZWZ0ICJmbG9hdGluZyIgZnVydGhlciBkb3duLiBUaGlzIHBhcmFtZXRlciAod2hlbgoJCSAqIGVuYWJsZWQpIHdpbGwgY2F1c2UgRGF0YVRhYmxlcyB0byBjb2xsYXBzZSB0aGUgdGFibGUncyB2aWV3cG9ydCBkb3duIHdoZW4KCQkgKiB0aGUgcmVzdWx0IHNldCB3aWxsIGZpdCB3aXRoaW4gdGhlIGdpdmVuIFkgaGVpZ2h0LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwIiwKCQkgKiAgICAgICAgImJTY3JvbGxDb2xsYXBzZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTY3JvbGxDb2xsYXBzZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgaW5maW5pdGUgc2Nyb2xsaW5nIGZvciBEYXRhVGFibGVzICh0byBiZSB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGgKCQkgKiBzU2Nyb2xsWSkuIEluZmluaXRlIHNjcm9sbGluZyBtZWFucyB0aGF0IERhdGFUYWJsZXMgd2lsbCBjb250aW51YWxseSBsb2FkCgkJICogZGF0YSBhcyBhIHVzZXIgc2Nyb2xscyB0aHJvdWdoIGEgdGFibGUsIHdoaWNoIGlzIHZlcnkgdXNlZnVsIGZvciBsYXJnZQoJCSAqIGRhdGFzZXQuIFRoaXMgY2Fubm90IGJlIHVzZWQgd2l0aCBwYWdpbmF0aW9uLCB3aGljaCBpcyBhdXRvbWF0aWNhbGx5CgkJICogZGlzYWJsZWQuIE5vdGUgLSB0aGUgU2Nyb2xsZXIgZXh0cmEgZm9yIERhdGFUYWJsZXMgaXMgcmVjb21tZW5kZWQgaW4KCQkgKiBpbiBwcmVmZXJlbmNlIHRvIHRoaXMgb3B0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTY3JvbGxJbmZpbml0ZSI6IHRydWUsCgkJICogICAgICAgICJiU2Nyb2xsQ29sbGFwc2UiOiB0cnVlLAoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2Nyb2xsSW5maW5pdGUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogQ29uZmlndXJlIERhdGFUYWJsZXMgdG8gdXNlIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIE5vdGUgdGhhdCB0aGUKCQkgKiBzQWpheFNvdXJjZSBwYXJhbWV0ZXIgbXVzdCBhbHNvIGJlIGdpdmVuIGluIG9yZGVyIHRvIGdpdmUgRGF0YVRhYmxlcyBhCgkJICogc291cmNlIHRvIG9idGFpbiB0aGUgcmVxdWlyZWQgZGF0YSBmb3IgZWFjaCBkcmF3LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInhoci5waHAiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2VydmVyU2lkZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBzb3J0aW5nIG9mIGNvbHVtbnMuIFNvcnRpbmcgb2YgaW5kaXZpZHVhbCBjb2x1bW5zIGNhbiBiZQoJCSAqIGRpc2FibGVkIGJ5IHRoZSAiYlNvcnRhYmxlIiBvcHRpb24gZm9yIGVhY2ggY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU29ydCI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU29ydCI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEFsbG93cyBjb250cm9sIG92ZXIgd2hldGhlciBEYXRhVGFibGVzIHNob3VsZCB1c2UgdGhlIHRvcCAodHJ1ZSkgdW5pcXVlCgkJICogY2VsbCB0aGF0IGlzIGZvdW5kIGZvciBhIHNpbmdsZSBjb2x1bW4sIG9yIHRoZSBib3R0b20gKGZhbHNlIC0gZGVmYXVsdCkuCgkJICogVGhpcyBpcyB1c2VmdWwgd2hlbiB1c2luZyBjb21wbGV4IGhlYWRlcnMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU29ydENlbGxzVG9wIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRDZWxsc1RvcCI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSB0aGUgYWRkaXRpb24gb2YgdGhlIGNsYXNzZXMgJ3NvcnRpbmdfMScsICdzb3J0aW5nXzInIGFuZAoJCSAqICdzb3J0aW5nXzMnIHRvIHRoZSBjb2x1bW5zIHdoaWNoIGFyZSBjdXJyZW50bHkgYmVpbmcgc29ydGVkIG9uLiBUaGlzIGlzCgkJICogcHJlc2VudGVkIGFzIGEgZmVhdHVyZSBzd2l0Y2ggYXMgaXQgY2FuIGluY3JlYXNlIHByb2Nlc3NpbmcgdGltZSAod2hpbGUKCQkgKiBjbGFzc2VzIGFyZSByZW1vdmVkIGFuZCBhZGRlZCkgc28gZm9yIGxhcmdlIGRhdGEgc2V0cyB5b3UgbWlnaHQgd2FudCB0bwoJCSAqIHR1cm4gdGhpcyBvZmYuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTb3J0Q2xhc3NlcyI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU29ydENsYXNzZXMiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgb3IgZGlzYWJsZSBzdGF0ZSBzYXZpbmcuIFdoZW4gZW5hYmxlZCBhIGNvb2tpZSB3aWxsIGJlIHVzZWQgdG8gc2F2ZQoJCSAqIHRhYmxlIGRpc3BsYXkgaW5mb3JtYXRpb24gc3VjaCBhcyBwYWdpbmF0aW9uIGluZm9ybWF0aW9uLCBkaXNwbGF5IGxlbmd0aCwKCQkgKiBmaWx0ZXJpbmcgYW5kIHNvcnRpbmcuIEFzIHN1Y2ggd2hlbiB0aGUgZW5kIHVzZXIgcmVsb2FkcyB0aGUgcGFnZSB0aGUKCQkgKiBkaXNwbGF5IGRpc3BsYXkgd2lsbCBtYXRjaCB3aGF0IHRoeSBoYWQgcHJldmlvdXNseSBzZXQgdXAuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlN0YXRlU2F2ZSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBDdXN0b21pc2UgdGhlIGNvb2tpZSBhbmQgLyBvciB0aGUgcGFyYW1ldGVycyBiZWluZyBzdG9yZWQgd2hlbiB1c2luZwoJCSAqIERhdGFUYWJsZXMgd2l0aCBzdGF0ZSBzYXZpbmcgZW5hYmxlZC4gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIKCQkgKiB0aGUgY29va2llIGlzIG1vZGlmaWVkLCBhbmQgaXQgZXhwZWN0cyBhIGZ1bGx5IGZvcm1lZCBjb29raWUgc3RyaW5nIHRvIGJlCgkJICogcmV0dXJuZWQuIE5vdGUgdGhhdCB0aGUgZGF0YSBvYmplY3QgcGFzc2VkIGluIGlzIGEgSmF2YXNjcmlwdCBvYmplY3Qgd2hpY2gKCQkgKiBtdXN0IGJlIGNvbnZlcnRlZCB0byBhIHN0cmluZyAoSlNPTi5zdHJpbmdpZnkgZm9yIGV4YW1wbGUpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge3N0cmluZ30gc05hbWUgTmFtZSBvZiB0aGUgY29va2llIGRlZmluZWQgYnkgRGF0YVRhYmxlcwoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgRGF0YSB0byBiZSBzdG9yZWQgaW4gdGhlIGNvb2tpZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0V4cGlyZXMgQ29va2llIGV4cGlyZXMgc3RyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUGF0aCBQYXRoIG9mIHRoZSBjb29raWUgdG8gc2V0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IENvb2tpZSBmb3JtYXR0ZWQgc3RyaW5nICh3aGljaCBzaG91bGQgYmUgZW5jb2RlZCBieQoJCSAqICAgIHVzaW5nIGVuY29kZVVSSUNvbXBvbmVudCgpKQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkNvb2tpZUNhbGxiYWNrIjogZnVuY3Rpb24gKHNOYW1lLCBvRGF0YSwgc0V4cGlyZXMsIHNQYXRoKSB7CgkJICogICAgICAgICAgLy8gQ3VzdG9taXNlIG9EYXRhIG9yIHNOYW1lIG9yIHdoYXRldmVyIGVsc2UgaGVyZQoJCSAqICAgICAgICAgIHJldHVybiBzTmFtZSArICI9IitKU09OLnN0cmluZ2lmeShvRGF0YSkrIjsgZXhwaXJlcz0iICsgc0V4cGlyZXMgKyI7IHBhdGg9IiArIHNQYXRoOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNvb2tpZUNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiBhIFRSIGVsZW1lbnQgaXMgY3JlYXRlZCAoYW5kIGFsbCBURCBjaGlsZAoJCSAqIGVsZW1lbnRzIGhhdmUgYmVlbiBpbnNlcnRlZCksIG9yIHJlZ2lzdGVyZWQgaWYgdXNpbmcgYSBET00gc291cmNlLCBhbGxvd2luZwoJCSAqIG1hbmlwdWxhdGlvbiBvZiB0aGUgVFIgZWxlbWVudCAoYWRkaW5nIGNsYXNzZXMgZXRjKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURhdGFJbmRleCBUaGUgaW5kZXggb2YgdGhpcyByb3cgaW4gYW9EYXRhCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkNyZWF0ZWRSb3ciOiBmdW5jdGlvbiggblJvdywgYURhdGEsIGlEYXRhSW5kZXggKSB7CgkJICogICAgICAgICAgLy8gQm9sZCB0aGUgZ3JhZGUgZm9yIGFsbCAnQScgZ3JhZGUgYnJvd3NlcnMKCQkgKiAgICAgICAgICBpZiAoIGFEYXRhWzRdID09ICJBIiApCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgJCgndGQ6ZXEoNCknLCBuUm93KS5odG1sKCAnPGI+QTwvYj4nICk7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkNyZWF0ZWRSb3ciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBldmVyeSAnZHJhdycgZXZlbnQsIGFuZCBhbGxvd3MgeW91IHRvCgkJICogZHluYW1pY2FsbHkgbW9kaWZ5IGFueSBhc3BlY3QgeW91IHdhbnQgYWJvdXQgdGhlIGNyZWF0ZWQgRE9NLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5EcmF3Q2FsbGJhY2siOiBmdW5jdGlvbigpIHsKCQkgKiAgICAgICAgICBhbGVydCggJ0RhdGFUYWJsZXMgaGFzIHJlZHJhd24gdGhlIHRhYmxlJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkRyYXdDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElkZW50aWNhbCB0byBmbkhlYWRlckNhbGxiYWNrKCkgYnV0IGZvciB0aGUgdGFibGUgZm9vdGVyIHRoaXMgZnVuY3Rpb24KCQkgKiBhbGxvd3MgeW91IHRvIG1vZGlmeSB0aGUgdGFibGUgZm9vdGVyIG9uIGV2ZXJ5ICdkcmF3JyBldmVuLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Gb290ICJUUiIgZWxlbWVudCBmb3IgdGhlIGZvb3RlcgoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBGdWxsIHRhYmxlIGRhdGEgKGFzIGRlcml2ZWQgZnJvbSB0aGUgb3JpZ2luYWwgSFRNTCkKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBzdGFydGluZyBwb2ludCBpbiB0aGUgCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlIAoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheSBpbnR9IGFpRGlzcGxheSBJbmRleCBhcnJheSB0byB0cmFuc2xhdGUgdGhlIHZpc3VhbCBwb3NpdGlvbgoJCSAqICAgIHRvIHRoZSBmdWxsIGRhdGEgYXJyYXkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkZvb3RlckNhbGxiYWNrIjogZnVuY3Rpb24oIG5Gb290LCBhRGF0YSwgaVN0YXJ0LCBpRW5kLCBhaURpc3BsYXkgKSB7CgkJICogICAgICAgICAgbkZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJylbMF0uaW5uZXJIVE1MID0gIlN0YXJ0aW5nIGluZGV4IGlzICIraVN0YXJ0OwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuRm9vdGVyQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBXaGVuIHJlbmRlcmluZyBsYXJnZSBudW1iZXJzIGluIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGZvciB0aGUgdGFibGUKCQkgKiAoaS5lLiAiU2hvd2luZyAxIHRvIDEwIG9mIDU3IGVudHJpZXMiKSBEYXRhVGFibGVzIHdpbGwgcmVuZGVyIGxhcmdlIG51bWJlcnMKCQkgKiB0byBoYXZlIGEgY29tbWEgc2VwYXJhdG9yIGZvciB0aGUgJ3Rob3VzYW5kcycgdW5pdHMgKGUuZy4gMSBtaWxsaW9uIGlzCgkJICogcmVuZGVyZWQgYXMgIjEsMDAwLDAwMCIpIHRvIGhlbHAgcmVhZGFiaWxpdHkgZm9yIHRoZSBlbmQgdXNlci4gVGhpcwoJCSAqIGZ1bmN0aW9uIHdpbGwgb3ZlcnJpZGUgdGhlIGRlZmF1bHQgbWV0aG9kIERhdGFUYWJsZXMgdXNlcy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge2ludH0gaUluIG51bWJlciB0byBiZSBmb3JtYXR0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gZm9ybWF0dGVkIHN0cmluZyBmb3IgRGF0YVRhYmxlcyB0byBzaG93IHRoZSBudW1iZXIKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRm9ybWF0TnVtYmVyIjogZnVuY3Rpb24gKCBpSW4gKSB7CgkJICogICAgICAgICAgaWYgKCBpSW4gJmx0OyAxMDAwICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIGlJbjsKCQkgKiAgICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgICAgdmFyIAoJCSAqICAgICAgICAgICAgICBzPShpSW4rIiIpLCAKCQkgKiAgICAgICAgICAgICAgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCAKCQkgKiAgICAgICAgICAgICAgaUxlbj1zLmxlbmd0aDsKCQkgKiAgICAgICAgICAgIAoJCSAqICAgICAgICAgICAgZm9yICggdmFyIGk9MCA7IGkmbHQ7aUxlbiA7IGkrKyApIHsKCQkgKiAgICAgICAgICAgICAgaWYgKCBpJTMgPT09IDAgJmFtcDsmYW1wOyBpICE9PSAwICkgewoJCSAqICAgICAgICAgICAgICAgIG91dCA9ICInIitvdXQ7CgkJICogICAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgICAgb3V0ID0gYVtpTGVuLWktMV0rb3V0OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICByZXR1cm4gb3V0OwoJCSAqICAgICAgICB9OwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Gb3JtYXROdW1iZXIiOiBmdW5jdGlvbiAoIGlJbiApIHsKCQkJaWYgKCBpSW4gPCAxMDAwICkKCQkJewoJCQkJLy8gQSBzbWFsbCBvcHRpbWlzYXRpb24gZm9yIHdoYXQgaXMgbGlrZWx5IHRvIGJlIHRoZSBtYWpvcml0eSBvZiB1c2UgY2FzZXMKCQkJCXJldHVybiBpSW47CgkJCX0KCQoJCQl2YXIgcz0oaUluKyIiKSwgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCBpTGVuPXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggaSUzID09PSAwICYmIGkgIT09IDAgKQoJCQkJewoJCQkJCW91dCA9IHRoaXMub0xhbmd1YWdlLnNJbmZvVGhvdXNhbmRzK291dDsKCQkJCX0KCQkJCW91dCA9IGFbaUxlbi1pLTFdK291dDsKCQkJfQoJCQlyZXR1cm4gb3V0OwoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIG9uIGV2ZXJ5ICdkcmF3JyBldmVudCwgYW5kIGFsbG93cyB5b3UgdG8KCQkgKiBkeW5hbWljYWxseSBtb2RpZnkgdGhlIGhlYWRlciByb3cuIFRoaXMgY2FuIGJlIHVzZWQgdG8gY2FsY3VsYXRlIGFuZAoJCSAqIGRpc3BsYXkgdXNlZnVsIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZCAiVFIiIGVsZW1lbnQgZm9yIHRoZSBoZWFkZXIKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgRnVsbCB0YWJsZSBkYXRhIChhcyBkZXJpdmVkIGZyb20gdGhlIG9yaWdpbmFsIEhUTUwpCgkJICogIEBwYXJhbSB7aW50fSBpU3RhcnQgSW5kZXggZm9yIHRoZSBjdXJyZW50IGRpc3BsYXkgc3RhcnRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5IGludH0gYWlEaXNwbGF5IEluZGV4IGFycmF5IHRvIHRyYW5zbGF0ZSB0aGUgdmlzdWFsIHBvc2l0aW9uCgkJICogICAgdG8gdGhlIGZ1bGwgZGF0YSBhcnJheQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSGVhZGVyQ2FsbGJhY2siOiBmdW5jdGlvbiggbkhlYWQsIGFEYXRhLCBpU3RhcnQsIGlFbmQsIGFpRGlzcGxheSApIHsKCQkgKiAgICAgICAgICBuSGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGgnKVswXS5pbm5lckhUTUwgPSAiRGlzcGxheWluZyAiKyhpRW5kLWlTdGFydCkrIiByZWNvcmRzIjsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJmbkhlYWRlckNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgY2FuIGJlIHVzZWQgdG8gY29udmV5IGluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50CgkJICogc3RhdGUgb2YgdGhlIHRhYmxlLiBBbHRob3VnaCB0aGUgaW50ZXJuYXRpb25hbGlzYXRpb24gb3B0aW9ucyBwcmVzZW50ZWQgYnkKCQkgKiBEYXRhVGFibGVzIGFyZSBxdWl0ZSBjYXBhYmxlIG9mIGRlYWxpbmcgd2l0aCBtb3N0IGN1c3RvbWlzYXRpb25zLCB0aGVyZSBtYXkKCQkgKiBiZSB0aW1lcyB3aGVyZSB5b3Ugd2lzaCB0byBjdXN0b21pc2UgdGhlIHN0cmluZyBmdXJ0aGVyLiBUaGlzIGNhbGxiYWNrCgkJICogYWxsb3dzIHlvdSB0byBkbyBleGFjdGx5IHRoYXQuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBTdGFydGluZyBwb3NpdGlvbiBpbiBkYXRhIGZvciB0aGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBFbmQgcG9zaXRpb24gaW4gZGF0YSBmb3IgdGhlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXggVG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHRhYmxlIChyZWdhcmRsZXNzIG9mCgkJICogICAgZmlsdGVyaW5nKQoJCSAqICBAcGFyYW0ge2ludH0gaVRvdGFsIFRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSBkYXRhIHNldCwgYWZ0ZXIgZmlsdGVyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUHJlIFRoZSBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGhhcyBmb3JtYXR0ZWQgdXNpbmcgaXQncwoJCSAqICAgIG93biBydWxlcwoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc3RyaW5nIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgaW5mb3JtYXRpb24gZWxlbWVudC4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAiZm5JbmZvQ2FsbGJhY2siOiBmdW5jdGlvbiggb1NldHRpbmdzLCBpU3RhcnQsIGlFbmQsIGlNYXgsIGlUb3RhbCwgc1ByZSApIHsKCQkgKiAgICAgICAgcmV0dXJuIGlTdGFydCArIiB0byAiKyBpRW5kOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5JbmZvQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgaGFzIGJlZW4gaW5pdGlhbGlzZWQuIE5vcm1hbGx5IERhdGFUYWJsZXMgd2lsbAoJCSAqIGluaXRpYWxpc2Ugc2VxdWVudGlhbGx5IGFuZCB0aGVyZSB3aWxsIGJlIG5vIG5lZWQgZm9yIHRoaXMgZnVuY3Rpb24sCgkJICogaG93ZXZlciwgdGhpcyBkb2VzIG5vdCBob2xkIHRydWUgd2hlbiB1c2luZyBleHRlcm5hbCBsYW5ndWFnZSBpbmZvcm1hdGlvbgoJCSAqIHNpbmNlIHRoYXQgaXMgb2J0YWluZWQgdXNpbmcgYW4gYXN5bmMgWEhSIGNhbGwuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CgkJICogICAgICAgICAgYWxlcnQoICdEYXRhVGFibGVzIGhhcyBmaW5pc2hlZCBpdHMgaW5pdGlhbGlzYXRpb24uJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuSW5pdENvbXBsZXRlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGVkIGF0IHRoZSB2ZXJ5IHN0YXJ0IG9mIGVhY2ggdGFibGUgZHJhdyBhbmQgY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZQoJCSAqIGRyYXcgYnkgcmV0dXJuaW5nIGZhbHNlLCBhbnkgb3RoZXIgcmV0dXJuIChpbmNsdWRpbmcgdW5kZWZpbmVkKSByZXN1bHRzIGluCgkJICogdGhlIGZ1bGwgZHJhdyBvY2N1cnJpbmcpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sZWFufSBGYWxzZSB3aWxsIGNhbmNlbCB0aGUgZHJhdywgYW55dGhpbmcgZWxzZSAoaW5jbHVkaW5nIG5vCgkJICogICAgcmV0dXJuKSB3aWxsIGFsbG93IGl0IHRvIGNvbXBsZXRlLgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuUHJlRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBpZiAoICQoJyN0ZXN0JykudmFsKCkgPT0gMSApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUHJlRHJhd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvICdwb3N0IHByb2Nlc3MnIGVhY2ggcm93IGFmdGVyIGl0IGhhdmUgYmVlbgoJCSAqIGdlbmVyYXRlZCBmb3IgZWFjaCB0YWJsZSBkcmF3LCBidXQgYmVmb3JlIGl0IGlzIHJlbmRlcmVkIG9uIHNjcmVlbi4gVGhpcwoJCSAqIGZ1bmN0aW9uIG1pZ2h0IGJlIHVzZWQgZm9yIHNldHRpbmcgdGhlIHJvdyBjbGFzcyBuYW1lIGV0Yy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleCBUaGUgZGlzcGxheSBpbmRleCBmb3IgdGhlIGN1cnJlbnQgdGFibGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleEZ1bGwgVGhlIGluZGV4IG9mIHRoZSBkYXRhIGluIHRoZSBmdWxsIGxpc3Qgb2YKCQkgKiAgICByb3dzIChhZnRlciBmaWx0ZXJpbmcpCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmblJvd0NhbGxiYWNrIjogZnVuY3Rpb24oIG5Sb3csIGFEYXRhLCBpRGlzcGxheUluZGV4LCBpRGlzcGxheUluZGV4RnVsbCApIHsKCQkgKiAgICAgICAgICAvLyBCb2xkIHRoZSBncmFkZSBmb3IgYWxsICdBJyBncmFkZSBicm93c2VycwoJCSAqICAgICAgICAgIGlmICggYURhdGFbNF0gPT0gIkEiICkKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAkKCd0ZDplcSg0KScsIG5Sb3cpLmh0bWwoICc8Yj5BPC9iPicgKTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUm93Q2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBhbGxvd3MgeW91IHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGZ1bmN0aW9uIHdoaWNoIG9idGFpbnMKCQkgKiB0aGUgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIgKCQuZ2V0SlNPTikgc28gc29tZXRoaW5nIG1vcmUgc3VpdGFibGUgZm9yIHlvdXIKCQkgKiBhcHBsaWNhdGlvbi4gRm9yIGV4YW1wbGUgeW91IGNvdWxkIHVzZSBQT1NUIGRhdGEsIG9yIHB1bGwgaW5mb3JtYXRpb24gZnJvbQoJCSAqIGEgR2VhcnMgb3IgQUlSIGRhdGFiYXNlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU291cmNlIEhUVFAgc291cmNlIHRvIG9idGFpbiB0aGUgZGF0YSBmcm9tIChzQWpheFNvdXJjZSkKCQkgKiAgQHBhcmFtIHthcnJheX0gYW9EYXRhIEEga2V5L3ZhbHVlIHBhaXIgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRhdGEgdG8gc2VuZAoJCSAqICAgIHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm5DYWxsYmFjayB0byBiZSBjYWxsZWQgb24gY29tcGxldGlvbiBvZiB0aGUgZGF0YSBnZXQKCQkgKiAgICBwcm9jZXNzIHRoYXQgd2lsbCBkcmF3IHRoZSBkYXRhIG9uIHRoZSBwYWdlLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUE9TVCBkYXRhIHRvIHNlcnZlcgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInhoci5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJEYXRhIjogZnVuY3Rpb24gKCBzU291cmNlLCBhb0RhdGEsIGZuQ2FsbGJhY2sgKSB7CgkJICogICAgICAgICAgJC5hamF4KCB7CgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAnanNvbicsIAoJCSAqICAgICAgICAgICAgInR5cGUiOiAiUE9TVCIsIAoJCSAqICAgICAgICAgICAgInVybCI6IHNTb3VyY2UsIAoJCSAqICAgICAgICAgICAgImRhdGEiOiBhb0RhdGEsIAoJCSAqICAgICAgICAgICAgInN1Y2Nlc3MiOiBmbkNhbGxiYWNrCgkJICogICAgICAgICAgfSApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblNlcnZlckRhdGEiOiBmdW5jdGlvbiAoIHNVcmwsIGFvRGF0YSwgZm5DYWxsYmFjaywgb1NldHRpbmdzICkgewoJCQlvU2V0dGluZ3MuanFYSFIgPSAkLmFqYXgoIHsKCQkJCSJ1cmwiOiAgc1VybCwKCQkJCSJkYXRhIjogYW9EYXRhLAoJCQkJInN1Y2Nlc3MiOiBmdW5jdGlvbiAoanNvbikgewoJCQkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigneGhyJywgb1NldHRpbmdzKTsKCQkJCQlmbkNhbGxiYWNrKCBqc29uICk7CgkJCQl9LAoJCQkJImRhdGFUeXBlIjogImpzb24iLAoJCQkJImNhY2hlIjogZmFsc2UsCgkJCQkidHlwZSI6IG9TZXR0aW5ncy5zU2VydmVyTWV0aG9kLAoJCQkJImVycm9yIjogZnVuY3Rpb24gKHhociwgZXJyb3IsIHRocm93bikgewoJCQkJCWlmICggZXJyb3IgPT0gInBhcnNlcmVycm9yIiApIHsKCQkJCQkJYWxlcnQoICJEYXRhVGFibGVzIHdhcm5pbmc6IEpTT04gZGF0YSBmcm9tIHNlcnZlciBjb3VsZCBub3QgYmUgcGFyc2VkLiAiKwoJCQkJCQkJIlRoaXMgaXMgY2F1c2VkIGJ5IGEgSlNPTiBmb3JtYXR0aW5nIGVycm9yLiIgKTsKCQkJCQl9CgkJCQl9CgkJCX0gKTsKCQl9LAoJCgkKCQkvKioKCQkgKiBJdCBpcyBvZnRlbiB1c2VmdWwgdG8gc2VuZCBleHRyYSBkYXRhIHRvIHRoZSBzZXJ2ZXIgd2hlbiBtYWtpbmcgYW4gQWpheAoJCSAqIHJlcXVlc3QgLSBmb3IgZXhhbXBsZSBjdXN0b20gZmlsdGVyaW5nIGluZm9ybWF0aW9uLCBhbmQgdGhpcyBjYWxsYmFjawoJCSAqIGZ1bmN0aW9uIG1ha2VzIGl0IHRyaXZpYWwgdG8gc2VuZCBleHRyYSBpbmZvcm1hdGlvbiB0byB0aGUgc2VydmVyLiBUaGUKCQkgKiBwYXNzZWQgaW4gcGFyYW1ldGVyIGlzIHRoZSBkYXRhIHNldCB0aGF0IGhhcyBiZWVuIGNvbnN0cnVjdGVkIGJ5CgkJICogRGF0YVRhYmxlcywgYW5kIHlvdSBjYW4gYWRkIHRvIHRoaXMgb3IgbW9kaWZ5IGl0IGFzIHlvdSByZXF1aXJlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0RhdGEgRGF0YSBhcnJheSAoYXJyYXkgb2Ygb2JqZWN0cyB3aGljaCBhcmUgbmFtZS92YWx1ZQoJCSAqICAgIHBhaXJzKSB0aGF0IGhhcyBiZWVuIGNvbnN0cnVjdGVkIGJ5IERhdGFUYWJsZXMgYW5kIHdpbGwgYmUgc2VudCB0byB0aGUKCQkgKiAgICBzZXJ2ZXIuIEluIHRoZSBjYXNlIG9mIEFqYXggc291cmNlZCBkYXRhIHdpdGggc2VydmVyLXNpZGUgcHJvY2Vzc2luZwoJCSAqICAgIHRoaXMgd2lsbCBiZSBhbiBlbXB0eSBhcnJheSwgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgdGhlcmUgd2lsbCBiZSBhCgkJICogICAgc2lnbmlmaWNhbnQgbnVtYmVyIG9mIHBhcmFtZXRlcnMhCgkJICogIEByZXR1cm5zIHt1bmRlZmluZWR9IEVuc3VyZSB0aGF0IHlvdSBtb2RpZnkgdGhlIGFvRGF0YSBhcnJheSBwYXNzZWQgaW4sCgkJICogICAgYXMgdGhpcyBpcyBwYXNzZWQgYnkgcmVmZXJlbmNlLgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogIEBkdG9wdCBTZXJ2ZXItc2lkZQoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNjcmlwdHMvc2VydmVyX3Byb2Nlc3NpbmcucGhwIiwKCQkgKiAgICAgICAgImZuU2VydmVyUGFyYW1zIjogZnVuY3Rpb24gKCBhb0RhdGEgKSB7CgkJICogICAgICAgICAgYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAibW9yZV9kYXRhIiwgInZhbHVlIjogIm15X3ZhbHVlIiB9ICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU2VydmVyUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogTG9hZCB0aGUgdGFibGUgc3RhdGUuIFdpdGggdGhpcyBmdW5jdGlvbiB5b3UgY2FuIGRlZmluZSBmcm9tIHdoZXJlLCBhbmQgaG93LCB0aGUKCQkgKiBzdGF0ZSBvZiBhIHRhYmxlIGlzIGxvYWRlZC4gQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9hZCBmcm9tIGl0cyBzdGF0ZSBzYXZpbmcKCQkgKiBjb29raWUsIGJ1dCB5b3UgbWlnaHQgd2lzaCB0byB1c2UgbG9jYWwgc3RvcmFnZSAoSFRNTDUpIG9yIGEgc2VydmVyLXNpZGUgZGF0YWJhc2UuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBtZW1iZXIKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJuIHtvYmplY3R9IFRoZSBEYXRhVGFibGVzIHN0YXRlIG9iamVjdCB0byBiZSBsb2FkZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIHZhciBvOwoJCSAqICAgICAgICAgIAoJCSAqICAgICAgICAgIC8vIFNlbmQgYW4gQWpheCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgdG8gZ2V0IHRoZSBkYXRhLiBOb3RlIHRoYXQKCQkgKiAgICAgICAgICAvLyB0aGlzIGlzIGEgc3luY2hyb25vdXMgcmVxdWVzdC4KCQkgKiAgICAgICAgICAkLmFqYXgoIHsKCQkgKiAgICAgICAgICAgICJ1cmwiOiAiL3N0YXRlX2xvYWQiLAoJCSAqICAgICAgICAgICAgImFzeW5jIjogZmFsc2UsCgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAianNvbiIsCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZ1bmN0aW9uIChqc29uKSB7CgkJICogICAgICAgICAgICAgIG8gPSBqc29uOwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICByZXR1cm4gbzsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZUxvYWQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncyApIHsKCQkJdmFyIHNEYXRhID0gdGhpcy5vQXBpLl9mblJlYWRDb29raWUoIG9TZXR0aW5ncy5zQ29va2llUHJlZml4K29TZXR0aW5ncy5zSW5zdGFuY2UgKTsKCQkJdmFyIG9EYXRhOwoJCgkJCXRyeSB7CgkJCQlvRGF0YSA9ICh0eXBlb2YgJC5wYXJzZUpTT04gPT09ICdmdW5jdGlvbicpID8gCgkJCQkJJC5wYXJzZUpTT04oc0RhdGEpIDogZXZhbCggJygnK3NEYXRhKycpJyApOwoJCQl9IGNhdGNoIChlKSB7CgkJCQlvRGF0YSA9IG51bGw7CgkJCX0KCQoJCQlyZXR1cm4gb0RhdGE7CgkJfSwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgd2hpY2ggYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc2F2ZWQgc3RhdGUgcHJpb3IgdG8gbG9hZGluZyB0aGF0IHN0YXRlLgoJCSAqIFRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gdGhlIHRhYmxlIGlzIGxvYWRpbmcgc3RhdGUgZnJvbSB0aGUgc3RvcmVkIGRhdGEsIGJ1dAoJCSAqIHByaW9yIHRvIHRoZSBzZXR0aW5ncyBvYmplY3QgYmVpbmcgbW9kaWZpZWQgYnkgdGhlIHNhdmVkIHN0YXRlLiBOb3RlIHRoYXQgZm9yIAoJCSAqIHBsdWctaW4gYXV0aG9ycywgeW91IHNob3VsZCB1c2UgdGhlICdzdGF0ZUxvYWRQYXJhbXMnIGV2ZW50IHRvIGxvYWQgcGFyYW1ldGVycyBmb3IgCgkJICogYSBwbHVnLWluLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRoYXQgaXMgdG8gYmUgbG9hZGVkCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSZW1vdmUgYSBzYXZlZCBmaWx0ZXIsIHNvIGZpbHRlcmluZyBpcyBuZXZlciBsb2FkZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBvRGF0YS5vRmlsdGVyLnNTZWFyY2ggPSAiIjsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gRGlzYWxsb3cgc3RhdGUgbG9hZGluZyBieSByZXR1cm5pbmcgZmFsc2UKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlTG9hZFBhcmFtcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHRoYXQgaXMgY2FsbGVkIHdoZW4gdGhlIHN0YXRlIGhhcyBiZWVuIGxvYWRlZCBmcm9tIHRoZSBzdGF0ZSBzYXZpbmcgbWV0aG9kCgkJICogYW5kIHRoZSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCBoYXMgYmVlbiBtb2RpZmllZCBhcyBhIHJlc3VsdCBvZiB0aGUgbG9hZGVkIHN0YXRlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRoYXQgd2FzIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gU2hvdyBhbiBhbGVydCB3aXRoIHRoZSBmaWx0ZXJpbmcgdmFsdWUgdGhhdCB3YXMgc2F2ZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkZWQiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIGFsZXJ0KCAnU2F2ZWQgZmlsdGVyIHdhczogJytvRGF0YS5vRmlsdGVyLnNTZWFyY2ggKTsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVMb2FkZWQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBTYXZlIHRoZSB0YWJsZSBzdGF0ZS4gVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvIGRlZmluZSB3aGVyZSBhbmQgaG93IHRoZSBzdGF0ZQoJCSAqIGluZm9ybWF0aW9uIGZvciB0aGUgdGFibGUgaXMgc3RvcmVkIC0gYnkgZGVmYXVsdCBpdCB3aWxsIHVzZSBhIGNvb2tpZSwgYnV0IHlvdQoJCSAqIG1pZ2h0IHdhbnQgdG8gdXNlIGxvY2FsIHN0b3JhZ2UgKEhUTUw1KSBvciBhIHNlcnZlci1zaWRlIGRhdGFiYXNlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdG8gYmUgc2F2ZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJTdGF0ZVNhdmUiOiB0cnVlLAoJCSAqICAgICAgICAiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBvRGF0YSkgewoJCSAqICAgICAgICAgIC8vIFNlbmQgYW4gQWpheCByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgd2l0aCB0aGUgc3RhdGUgb2JqZWN0CgkJICogICAgICAgICAgJC5hamF4KCB7CgkJICogICAgICAgICAgICAidXJsIjogIi9zdGF0ZV9zYXZlIiwKCQkgKiAgICAgICAgICAgICJkYXRhIjogb0RhdGEsCgkJICogICAgICAgICAgICAiZGF0YVR5cGUiOiAianNvbiIsCgkJICogICAgICAgICAgICAibWV0aG9kIjogIlBPU1QiCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZ1bmN0aW9uICgpIHt9CgkJICogICAgICAgICAgfSApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlU2F2ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBvRGF0YSApIHsKCQkJdGhpcy5vQXBpLl9mbkNyZWF0ZUNvb2tpZSggCgkJCQlvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCtvU2V0dGluZ3Muc0luc3RhbmNlLCAKCQkJCXRoaXMub0FwaS5fZm5Kc29uU3RyaW5nKG9EYXRhKSwgCgkJCQlvU2V0dGluZ3MuaUNvb2tpZUR1cmF0aW9uLCAKCQkJCW9TZXR0aW5ncy5zQ29va2llUHJlZml4LCAKCQkJCW9TZXR0aW5ncy5mbkNvb2tpZUNhbGxiYWNrCgkJCSk7CgkJfSwKCQoJCgkJLyoqCgkJICogQ2FsbGJhY2sgd2hpY2ggYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc3RhdGUgdG8gYmUgc2F2ZWQuIENhbGxlZCB3aGVuIHRoZSB0YWJsZSAKCQkgKiBoYXMgY2hhbmdlZCBzdGF0ZSBhIG5ldyBzdGF0ZSBzYXZlIGlzIHJlcXVpcmVkLiBUaGlzIG1ldGhvZCBhbGxvd3MgbW9kaWZpY2F0aW9uIG9mCgkJICogdGhlIHN0YXRlIHNhdmluZyBvYmplY3QgcHJpb3IgdG8gYWN0dWFsbHkgZG9pbmcgdGhlIHNhdmUsIGluY2x1ZGluZyBhZGRpdGlvbiBvciAKCQkgKiBvdGhlciBzdGF0ZSBwcm9wZXJ0aWVzIG9yIG1vZGlmaWNhdGlvbi4gTm90ZSB0aGF0IGZvciBwbHVnLWluIGF1dGhvcnMsIHlvdSBzaG91bGQgCgkJICogdXNlIHRoZSAnc3RhdGVTYXZlUGFyYW1zJyBldmVudCB0byBzYXZlIHBhcmFtZXRlcnMgZm9yIGEgcGx1Zy1pbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0byBiZSBzYXZlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUmVtb3ZlIGEgc2F2ZWQgZmlsdGVyLCBzbyBmaWx0ZXJpbmcgaXMgbmV2ZXIgc2F2ZWQKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVMb2FkUGFyYW1zIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBvRGF0YS5vRmlsdGVyLnNTZWFyY2ggPSAiIjsKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVTYXZlUGFyYW1zIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRHVyYXRpb24gb2YgdGhlIGNvb2tpZSB3aGljaCBpcyB1c2VkIGZvciBzdG9yaW5nIHNlc3Npb24gaW5mb3JtYXRpb24uIFRoaXMKCQkgKiB2YWx1ZSBpcyBnaXZlbiBpbiBzZWNvbmRzLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgNzIwMCA8aT4oMiBob3Vycyk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlDb29raWVEdXJhdGlvbiI6IDYwKjYwKjI0IC8vIDEgZGF5CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImlDb29raWVEdXJhdGlvbiI6IDcyMDAsCgkKCQoJCS8qKgoJCSAqIFdoZW4gZW5hYmxlZCBEYXRhVGFibGVzIHdpbGwgbm90IG1ha2UgYSByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIgZm9yIHRoZSBmaXJzdAoJCSAqIHBhZ2UgZHJhdyAtIHJhdGhlciBpdCB3aWxsIHVzZSB0aGUgZGF0YSBhbHJlYWR5IG9uIHRoZSBwYWdlIChubyBzb3J0aW5nIGV0YwoJCSAqIHdpbGwgYmUgYXBwbGllZCB0byBpdCksIHRodXMgc2F2aW5nIG9uIGFuIFhIUiBhdCBsb2FkIHRpbWUuIGlEZWZlckxvYWRpbmcKCQkgKiBpcyB1c2VkIHRvIGluZGljYXRlIHRoYXQgZGVmZXJyZWQgbG9hZGluZyBpcyByZXF1aXJlZCwgYnV0IGl0IGlzIGFsc28gdXNlZAoJCSAqIHRvIHRlbGwgRGF0YVRhYmxlcyBob3cgbWFueSByZWNvcmRzIHRoZXJlIGFyZSBpbiB0aGUgZnVsbCB0YWJsZSAoYWxsb3dpbmcKCQkgKiB0aGUgaW5mb3JtYXRpb24gZWxlbWVudCBhbmQgcGFnaW5hdGlvbiB0byBiZSBkaXNwbGF5ZWQgY29ycmVjdGx5KS4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3NlcnZlcl9wcm9jZXNzaW5nLnBocCIsCgkJICogICAgICAgICJpRGVmZXJMb2FkaW5nIjogNTcKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlEZWZlckxvYWRpbmciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBOdW1iZXIgb2Ygcm93cyB0byBkaXNwbGF5IG9uIGEgc2luZ2xlIHBhZ2Ugd2hlbiB1c2luZyBwYWdpbmF0aW9uLiBJZgoJCSAqIGZlYXR1cmUgZW5hYmxlZCAoYkxlbmd0aENoYW5nZSkgdGhlbiB0aGUgZW5kIHVzZXIgd2lsbCBiZSBhYmxlIHRvIG92ZXJyaWRlCgkJICogdGhpcyB0byBhIGN1c3RvbSBzZXR0aW5nIHVzaW5nIGEgcG9wLXVwIG1lbnUuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUwCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImlEaXNwbGF5TGVuZ3RoIjogMTAsCgkKCQoJCS8qKgoJCSAqIERlZmluZSB0aGUgc3RhcnRpbmcgcG9pbnQgZm9yIGRhdGEgZGlzcGxheSB3aGVuIHVzaW5nIERhdGFUYWJsZXMgd2l0aAoJCSAqIHBhZ2luYXRpb24uIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciBpcyB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJhdGhlciB0aGFuCgkJICogdGhlIHBhZ2UgbnVtYmVyLCBzbyBpZiB5b3UgaGF2ZSAxMCByZWNvcmRzIHBlciBwYWdlIGFuZCB3YW50IHRvIHN0YXJ0IG9uCgkJICogdGhlIHRoaXJkIHBhZ2UsIGl0IHNob3VsZCBiZSAiMjAiLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheVN0YXJ0IjogMjAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaURpc3BsYXlTdGFydCI6IDAsCgkKCQoJCS8qKgoJCSAqIFRoZSBzY3JvbGwgZ2FwIGlzIHRoZSBhbW91bnQgb2Ygc2Nyb2xsaW5nIHRoYXQgaXMgbGVmdCB0byBnbyBiZWZvcmUKCQkgKiBEYXRhVGFibGVzIHdpbGwgbG9hZCB0aGUgbmV4dCAncGFnZScgb2YgZGF0YSBhdXRvbWF0aWNhbGx5LiBZb3UgdHlwaWNhbGx5CgkJICogd2FudCBhIGdhcCB3aGljaCBpcyBiaWcgZW5vdWdoIHRoYXQgdGhlIHNjcm9sbGluZyB3aWxsIGJlIHNtb290aCBmb3IgdGhlCgkJICogdXNlciwgd2hpbGUgbm90IHNvIGxhcmdlIHRoYXQgaXQgd2lsbCBsb2FkIG1vcmUgZGF0YSB0aGFuIG5lZWQuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImlTY3JvbGxMb2FkR2FwIjogNTAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlTY3JvbGxMb2FkR2FwIjogMTAwLAoJCgkKCQkvKioKCQkgKiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgYWxsb3dzIGtleWJvYXJkIG5hdmlnYXRpb24gb2YgdGhlIHRhYmxlIChzb3J0aW5nLCBwYWdpbmcsCgkJICogYW5kIGZpbHRlcmluZykgYnkgYWRkaW5nIGEgdGFiaW5kZXggYXR0cmlidXRlIHRvIHRoZSByZXF1aXJlZCBlbGVtZW50cy4gVGhpcwoJCSAqIGFsbG93cyB5b3UgdG8gdGFiIHRocm91Z2ggdGhlIGNvbnRyb2xzIGFuZCBwcmVzcyB0aGUgZW50ZXIga2V5IHRvIGFjdGl2YXRlIHRoZW0uCgkJICogVGhlIHRhYmluZGV4IGlzIGRlZmF1bHQgMCwgbWVhbmluZyB0aGF0IHRoZSB0YWIgZm9sbG93cyB0aGUgZmxvdyBvZiB0aGUgZG9jdW1lbnQuCgkJICogWW91IGNhbiBvdmVycnVsZSB0aGlzIHVzaW5nIHRoaXMgcGFyYW1ldGVyIGlmIHlvdSB3aXNoLiBVc2UgYSB2YWx1ZSBvZiAtMSB0bwoJCSAqIGRpc2FibGUgYnVpbHQtaW4ga2V5Ym9hcmQgbmF2aWdhdGlvbi4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpVGFiSW5kZXgiOiAxCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpVGFiSW5kZXgiOiAwLAoJCgkKCQkvKioKCQkgKiBBbGwgc3RyaW5ncyB0aGF0IERhdGFUYWJsZXMgdXNlcyBpbiB0aGUgdXNlciBpbnRlcmZhY2UgdGhhdCBpdCBjcmVhdGVzCgkJICogYXJlIGRlZmluZWQgaW4gdGhpcyBvYmplY3QsIGFsbG93aW5nIHlvdSB0byBtb2RpZmllZCB0aGVtIGluZGl2aWR1YWxseSBvcgoJCSAqIGNvbXBsZXRlbHkgcmVwbGFjZSB0aGVtIGFsbCBhcyByZXF1aXJlZC4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvTGFuZ3VhZ2UiOiB7CgkJCS8qKgoJCQkgKiBTdHJpbmdzIHRoYXQgYXJlIHVzZWQgZm9yIFdBSS1BUklBIGxhYmVscyBhbmQgY29udHJvbHMgb25seSAodGhlc2UgYXJlIG5vdAoJCQkgKiBhY3R1YWxseSB2aXNpYmxlIG9uIHRoZSBwYWdlLCBidXQgd2lsbCBiZSByZWFkIGJ5IHNjcmVlbnJlYWRlcnMsIGFuZCB0aHVzCgkJCSAqIG11c3QgYmUgaW50ZXJuYXRpb25hbGlzZWQgYXMgd2VsbCkuCgkJCSAqICBAbmFtZXNwYWNlCgkJCSAqLwoJCQkib0FyaWEiOiB7CgkJCQkvKioKCQkJCSAqIEFSSUEgbGFiZWwgdGhhdCBpcyBhZGRlZCB0byB0aGUgdGFibGUgaGVhZGVycyB3aGVuIHRoZSBjb2x1bW4gbWF5IGJlCgkJCQkgKiBzb3J0ZWQgYXNjZW5kaW5nIGJ5IGFjdGl2aW5nIHRoZSBjb2x1bW4gKGNsaWNrIG9yIHJldHVybiB3aGVuIGZvY3VzZWQpLgoJCQkJICogTm90ZSB0aGF0IHRoZSBjb2x1bW4gaGVhZGVyIGlzIHByZWZpeGVkIHRvIHRoaXMgc3RyaW5nLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IDogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvQXJpYSI6IHsKCQkJCSAqICAgICAgICAgICAgInNTb3J0QXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGFzY2VuZGluZyIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNTb3J0QXNjZW5kaW5nIjogIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nIiwKCQoJCQkJLyoqCgkJCQkgKiBBUklBIGxhYmVsIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHRhYmxlIGhlYWRlcnMgd2hlbiB0aGUgY29sdW1uIG1heSBiZQoJCQkJICogc29ydGVkIGRlc2NlbmRpbmcgYnkgYWN0aXZpbmcgdGhlIGNvbHVtbiAoY2xpY2sgb3IgcmV0dXJuIHdoZW4gZm9jdXNlZCkuCgkJCQkgKiBOb3RlIHRoYXQgdGhlIGNvbHVtbiBoZWFkZXIgaXMgcHJlZml4ZWQgdG8gdGhpcyBzdHJpbmcuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmcKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9BcmlhIjogewoJCQkJICogICAgICAgICAgICAic1NvcnREZXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGRlc2NlbmRpbmciCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzU29ydERlc2NlbmRpbmciOiAiOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBkZXNjZW5kaW5nIgoJCQl9LAoJCgkJCS8qKgoJCQkgKiBQYWdpbmF0aW9uIHN0cmluZyB1c2VkIGJ5IERhdGFUYWJsZXMgZm9yIHRoZSB0d28gYnVpbHQtaW4gcGFnaW5hdGlvbgoJCQkgKiBjb250cm9sIHR5cGVzICgidHdvX2J1dHRvbiIgYW5kICJmdWxsX251bWJlcnMiKQoJCQkgKiAgQG5hbWVzcGFjZQoJCQkgKi8KCQkJIm9QYWdpbmF0ZSI6IHsKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBmaXJzdCBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IEZpcnN0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzRmlyc3QiOiAiRmlyc3QgcGFnZSIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNGaXJzdCI6ICJGaXJzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBsYXN0IHBhZ2UuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgTGFzdAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic0xhc3QiOiAiTGFzdCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic0xhc3QiOiAiTGFzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBuZXh0IHBhZ2UuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgTmV4dAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic05leHQiOiAiTmV4dCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic05leHQiOiAiTmV4dCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBwcmV2aW91cyBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IFByZXZpb3VzCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzUHJldmlvdXMiOiAiUHJldmlvdXMgcGFnZSIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNQcmV2aW91cyI6ICJQcmV2aW91cyIKCQkJfSwKCQkKCQkJLyoqCgkJCSAqIFRoaXMgc3RyaW5nIGlzIHNob3duIGluIHByZWZlcmVuY2UgdG8gc1plcm9SZWNvcmRzIHdoZW4gdGhlIHRhYmxlIGlzCgkJCSAqIGVtcHR5IG9mIGRhdGEgKHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nKS4gTm90ZSB0aGF0IHRoaXMgaXMgYW4gb3B0aW9uYWwKCQkJICogcGFyYW1ldGVyIC0gaWYgaXQgaXMgbm90IGdpdmVuLCB0aGUgdmFsdWUgb2Ygc1plcm9SZWNvcmRzIHdpbGwgYmUgdXNlZAoJCQkgKiBpbnN0ZWFkIChlaXRoZXIgdGhlIGRlZmF1bHQgb3IgZ2l2ZW4gdmFsdWUpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZQoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBUaGlzIHN0cmluZyBnaXZlcyBpbmZvcm1hdGlvbiB0byB0aGUgZW5kIHVzZXIgYWJvdXQgdGhlIGluZm9ybWF0aW9uIHRoYXQgCgkJCSAqIGlzIGN1cnJlbnQgb24gZGlzcGxheSBvbiB0aGUgcGFnZS4gVGhlIF9TVEFSVF8sIF9FTkRfIGFuZCBfVE9UQUxfIAoJCQkgKiB2YXJpYWJsZXMgYXJlIGFsbCBkeW5hbWljYWxseSByZXBsYWNlZCBhcyB0aGUgdGFibGUgZGlzcGxheSB1cGRhdGVzLCBhbmQgCgkJCSAqIGNhbiBiZSBmcmVlbHkgbW92ZWQgb3IgcmVtb3ZlZCBhcyB0aGUgbGFuZ3VhZ2UgcmVxdWlyZW1lbnRzIGNoYW5nZS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mbyI6ICJHb3QgYSB0b3RhbCBvZiBfVE9UQUxfIGVudHJpZXMgdG8gc2hvdyAoX1NUQVJUXyB0byBfRU5EXykiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm8iOiAiU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEaXNwbGF5IGluZm9ybWF0aW9uIHN0cmluZyBmb3Igd2hlbiB0aGUgdGFibGUgaXMgZW1wdHkuIFR5cGljYWxseSB0aGUgCgkJCSAqIGZvcm1hdCBvZiB0aGlzIHN0cmluZyBzaG91bGQgbWF0Y2ggc0luZm8uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0VtcHR5IjogIk5vIGVudHJpZXMgdG8gc2hvdyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb0VtcHR5IjogIlNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBXaGVuIGEgdXNlciBmaWx0ZXJzIHRoZSBpbmZvcm1hdGlvbiBpbiBhIHRhYmxlLCB0aGlzIHN0cmluZyBpcyBhcHBlbmRlZCAKCQkJICogdG8gdGhlIGluZm9ybWF0aW9uIChzSW5mbykgdG8gZ2l2ZSBhbiBpZGVhIG9mIGhvdyBzdHJvbmcgdGhlIGZpbHRlcmluZyAKCQkJICogaXMuIFRoZSB2YXJpYWJsZSBfTUFYXyBpcyBkeW5hbWljYWxseSB1cGRhdGVkLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKQoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0ZpbHRlcmVkIjogIiAtIGZpbHRlcmluZyBmcm9tIF9NQVhfIHJlY29yZHMiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9GaWx0ZXJlZCI6ICIoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBJZiBjYW4gYmUgdXNlZnVsIHRvIGFwcGVuZCBleHRyYSBpbmZvcm1hdGlvbiB0byB0aGUgaW5mbyBzdHJpbmcgYXQgdGltZXMsCgkJCSAqIGFuZCB0aGlzIHZhcmlhYmxlIGRvZXMgZXhhY3RseSB0aGF0LiBUaGlzIGluZm9ybWF0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8KCQkJICogdGhlIHNJbmZvIChzSW5mb0VtcHR5IGFuZCBzSW5mb0ZpbHRlcmVkIGluIHdoYXRldmVyIGNvbWJpbmF0aW9uIHRoZXkgYXJlCgkJCSAqIGJlaW5nIHVzZWQpIGF0IGFsbCB0aW1lcy4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb1Bvc3RGaXgiOiAiQWxsIHJlY29yZHMgc2hvd24gYXJlIGRlcml2ZWQgZnJvbSByZWFsIGluZm9ybWF0aW9uLiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb1Bvc3RGaXgiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERhdGFUYWJsZXMgaGFzIGEgYnVpbGQgaW4gbnVtYmVyIGZvcm1hdHRlciAoZm5Gb3JtYXROdW1iZXIpIHdoaWNoIGlzIHVzZWQKCQkJICogdG8gZm9ybWF0IGxhcmdlIG51bWJlcnMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUgaW5mb3JtYXRpb24uIEJ5CgkJCSAqIGRlZmF1bHQgYSBjb21tYSBpcyB1c2VkLCBidXQgdGhpcyBjYW4gYmUgdHJpdmlhbGx5IGNoYW5nZWQgdG8gYW55CgkJCSAqIGNoYXJhY3RlciB5b3Ugd2lzaCB3aXRoIHRoaXMgcGFyYW1ldGVyLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAsCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNJbmZvVGhvdXNhbmRzIjogIiciCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9UaG91c2FuZHMiOiAiLCIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEZXRhaWwgdGhlIGFjdGlvbiB0aGF0IHdpbGwgYmUgdGFrZW4gd2hlbiB0aGUgZHJvcCBkb3duIG1lbnUgZm9yIHRoZQoJCQkgKiBwYWdpbmF0aW9uIGxlbmd0aCBvcHRpb24gaXMgY2hhbmdlZC4gVGhlICdfTUVOVV8nIHZhcmlhYmxlIGlzIHJlcGxhY2VkCgkJCSAqIHdpdGggYSBkZWZhdWx0IHNlbGVjdCBsaXN0IG9mIDEwLCAyNSwgNTAgYW5kIDEwMCwgYW5kIGNhbiBiZSByZXBsYWNlZAoJCQkgKiB3aXRoIGEgY3VzdG9tIHNlbGVjdCBib3ggaWYgcmVxdWlyZWQuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3cgX01FTlVfIGVudHJpZXMKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIExhbmd1YWdlIGNoYW5nZSBvbmx5CgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0xlbmd0aE1lbnUiOiAiRGlzcGxheSBfTUVOVV8gcmVjb3JkcyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBMYW5ndWFnZSBhbmQgb3B0aW9ucyBjaGFuZ2UKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTGVuZ3RoTWVudSI6ICdEaXNwbGF5IDxzZWxlY3Q+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMTAiPjEwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMjAiPjIwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMzAiPjMwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNDAiPjQwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNTAiPjUwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iLTEiPkFsbDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzwvc2VsZWN0PiByZWNvcmRzJwoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNMZW5ndGhNZW51IjogIlNob3cgX01FTlVfIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogV2hlbiB1c2luZyBBamF4IHNvdXJjZWQgZGF0YSBhbmQgZHVyaW5nIHRoZSBmaXJzdCBkcmF3IHdoZW4gRGF0YVRhYmxlcyBpcwoJCQkgKiBnYXRoZXJpbmcgdGhlIGRhdGEsIHRoaXMgbWVzc2FnZSBpcyBzaG93biBpbiBhbiBlbXB0eSByb3cgaW4gdGhlIHRhYmxlIHRvCgkJCSAqIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGUgdGhlIGRhdGEgaXMgYmVpbmcgbG9hZGVkLiBOb3RlIHRoYXQgdGhpcwoJCQkgKiBwYXJhbWV0ZXIgaXMgbm90IHVzZWQgd2hlbiBsb2FkaW5nIGRhdGEgYnkgc2VydmVyLXNpZGUgcHJvY2Vzc2luZywganVzdAoJCQkgKiBBamF4IHNvdXJjZWQgZGF0YSB3aXRoIGNsaWVudC1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IExvYWRpbmcuLi4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNMb2FkaW5nUmVjb3JkcyI6ICJQbGVhc2Ugd2FpdCAtIGxvYWRpbmcuLi4iCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0xvYWRpbmdSZWNvcmRzIjogIkxvYWRpbmcuLi4iLAoJCQoJCQoJCQkvKioKCQkJICogVGV4dCB3aGljaCBpcyBkaXNwbGF5ZWQgd2hlbiB0aGUgdGFibGUgaXMgcHJvY2Vzc2luZyBhIHVzZXIgYWN0aW9uCgkJCSAqICh1c3VhbGx5IGEgc29ydCBjb21tYW5kIG9yIHNpbWlsYXIpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBQcm9jZXNzaW5nLi4uCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNQcm9jZXNzaW5nIjogIkRhdGFUYWJsZXMgaXMgY3VycmVudGx5IGJ1c3kiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1Byb2Nlc3NpbmciOiAiUHJvY2Vzc2luZy4uLiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEZXRhaWxzIHRoZSBhY3Rpb25zIHRoYXQgd2lsbCBiZSB0YWtlbiB3aGVuIHRoZSB1c2VyIHR5cGVzIGludG8gdGhlCgkJCSAqIGZpbHRlcmluZyBpbnB1dCB0ZXh0IGJveC4gVGhlIHZhcmlhYmxlICJfSU5QVVRfIiwgaWYgdXNlZCBpbiB0aGUgc3RyaW5nLAoJCQkgKiBpcyByZXBsYWNlZCB3aXRoIHRoZSBIVE1MIHRleHQgYm94IGZvciB0aGUgZmlsdGVyaW5nIGlucHV0IGFsbG93aW5nCgkJCSAqIGNvbnRyb2wgb3ZlciB3aGVyZSBpdCBhcHBlYXJzIGluIHRoZSBzdHJpbmcuIElmICJfSU5QVVRfIiBpcyBub3QgZ2l2ZW4KCQkJICogdGhlbiB0aGUgaW5wdXQgYm94IGlzIGFwcGVuZGVkIHRvIHRoZSBzdHJpbmcgYXV0b21hdGljYWxseS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2VhcmNoOgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgLy8gSW5wdXQgdGV4dCBib3ggd2lsbCBiZSBhcHBlbmRlZCBhdCB0aGUgZW5kIGF1dG9tYXRpY2FsbHkKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzU2VhcmNoIjogIkZpbHRlciByZWNvcmRzOiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBTcGVjaWZ5IHdoZXJlIHRoZSBmaWx0ZXIgc2hvdWxkIGFwcGVhcgoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNTZWFyY2giOiAiQXBwbHkgZmlsdGVyIF9JTlBVVF8gdG8gdGFibGUiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1NlYXJjaCI6ICJTZWFyY2g6IiwKCQkKCQkKCQkJLyoqCgkJCSAqIEFsbCBvZiB0aGUgbGFuZ3VhZ2UgaW5mb3JtYXRpb24gY2FuIGJlIHN0b3JlZCBpbiBhIGZpbGUgb24gdGhlCgkJCSAqIHNlcnZlci1zaWRlLCB3aGljaCBEYXRhVGFibGVzIHdpbGwgbG9vayB1cCBpZiB0aGlzIHBhcmFtZXRlciBpcyBwYXNzZWQuCgkJCSAqIEl0IG11c3Qgc3RvcmUgdGhlIFVSTCBvZiB0aGUgbGFuZ3VhZ2UgZmlsZSwgd2hpY2ggaXMgaW4gYSBKU09OIGZvcm1hdCwKCQkJICogYW5kIHRoZSBvYmplY3QgaGFzIHRoZSBzYW1lIHByb3BlcnRpZXMgYXMgdGhlIG9MYW5ndWFnZSBvYmplY3QgaW4gdGhlCgkJCSAqIGluaXRpYWxpc2VyIG9iamVjdCAoaS5lLiB0aGUgYWJvdmUgcGFyYW1ldGVycykuIFBsZWFzZSByZWZlciB0byBvbmUgb2YKCQkJICogdGhlIGV4YW1wbGUgbGFuZ3VhZ2UgZmlsZXMgdG8gc2VlIGhvdyB0aGlzIHdvcmtzIGluIGFjdGlvbi4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic1VybCI6ICJodHRwOi8vd3d3LnNwcnltZWRpYS5jby51ay9kYXRhVGFibGVzL2xhbmcudHh0IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNVcmwiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFRleHQgc2hvd24gaW5zaWRlIHRoZSB0YWJsZSByZWNvcmRzIHdoZW4gdGhlIGlzIG5vIGluZm9ybWF0aW9uIHRvIGJlCgkJCSAqIGRpc3BsYXllZCBhZnRlciBmaWx0ZXJpbmcuIHNFbXB0eVRhYmxlIGlzIHNob3duIHdoZW4gdGhlcmUgaXMgc2ltcGx5IG5vCgkJCSAqIGluZm9ybWF0aW9uIGluIHRoZSB0YWJsZSBhdCBhbGwgKHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nKS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgTm8gbWF0Y2hpbmcgcmVjb3JkcyBmb3VuZAoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzWmVyb1JlY29yZHMiOiAiTm8gcmVjb3JkcyB0byBkaXNwbGF5IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNaZXJvUmVjb3JkcyI6ICJObyBtYXRjaGluZyByZWNvcmRzIGZvdW5kIgoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gaGF2ZSBkZWZpbmUgdGhlIGdsb2JhbCBmaWx0ZXJpbmcgc3RhdGUgYXQKCQkgKiBpbml0aWFsaXNhdGlvbiB0aW1lLiBBcyBhbiBvYmplY3QgdGhlICJzU2VhcmNoIiBwYXJhbWV0ZXIgbXVzdCBiZQoJCSAqIGRlZmluZWQsIGJ1dCBhbGwgb3RoZXIgcGFyYW1ldGVycyBhcmUgb3B0aW9uYWwuIFdoZW4gImJSZWdleCIgaXMgdHJ1ZSwKCQkgKiB0aGUgc2VhcmNoIHN0cmluZyB3aWxsIGJlIHRyZWF0ZWQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24sIHdoZW4gZmFsc2UKCQkgKiAoZGVmYXVsdCkgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgc3RyYWlnaHQgc3RyaW5nLiBXaGVuICJiU21hcnQiCgkJICogRGF0YVRhYmxlcyB3aWxsIHVzZSBpdCdzIHNtYXJ0IGZpbHRlcmluZyBtZXRob2RzICh0byB3b3JkIG1hdGNoIGF0CgkJICogYW55IHBvaW50IGluIHRoZSBkYXRhKSwgd2hlbiBmYWxzZSB0aGlzIHdpbGwgbm90IGJlIGRvbmUuCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgIm9TZWFyY2giOiB7InNTZWFyY2giOiAiSW5pdGlhbCBzZWFyY2gifQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJvU2VhcmNoIjogJC5leHRlbmQoIHt9LCBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2ggKSwKCQoJCgkJLyoqCgkJICogQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9vayBmb3IgdGhlIHByb3BlcnR5ICdhYURhdGEnIHdoZW4gb2J0YWluaW5nCgkJICogZGF0YSBmcm9tIGFuIEFqYXggc291cmNlIG9yIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gdGhpcyBwYXJhbWV0ZXIKCQkgKiBhbGxvd3MgdGhhdCBwcm9wZXJ0eSB0byBiZSBjaGFuZ2VkLiBZb3UgY2FuIHVzZSBKYXZhc2NyaXB0IGRvdHRlZCBvYmplY3QKCQkgKiBub3RhdGlvbiB0byBnZXQgYSBkYXRhIHNvdXJjZSBmb3IgbXVsdGlwbGUgbGV2ZWxzIG9mIG5lc3RpbmcuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhYURhdGEKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogWy4uLl0gfQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RhdGEudHh0IiwKCQkgKiAgICAgICAgInNBamF4RGF0YVByb3AiOiAiZGF0YSIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogeyAiaW5uZXIiOiBbLi4uXSB9IH0KCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kYXRhLnR4dCIsCgkJICogICAgICAgICJzQWpheERhdGFQcm9wIjogImRhdGEuaW5uZXIiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQWpheERhdGFQcm9wIjogImFhRGF0YSIsCgkKCQoJCS8qKgoJCSAqIFlvdSBjYW4gaW5zdHJ1Y3QgRGF0YVRhYmxlcyB0byBsb2FkIGRhdGEgZnJvbSBhbiBleHRlcm5hbCBzb3VyY2UgdXNpbmcgdGhpcwoJCSAqIHBhcmFtZXRlciAodXNlIGFEYXRhIGlmIHlvdSB3YW50IHRvIHBhc3MgZGF0YSBpbiB5b3UgYWxyZWFkeSBoYXZlKS4gU2ltcGx5CgkJICogcHJvdmlkZSBhIHVybCBhIEpTT04gb2JqZWN0IGNhbiBiZSBvYnRhaW5lZCBmcm9tLiBUaGlzIG9iamVjdCBtdXN0IGluY2x1ZGUKCQkgKiB0aGUgcGFyYW1ldGVyICdhYURhdGEnIHdoaWNoIGlzIHRoZSBkYXRhIHNvdXJjZSBmb3IgdGhlIHRhYmxlLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAiaHR0cDovL3d3dy5zcHJ5bWVkaWEuY28udWsvZGF0YVRhYmxlcy9qc29uLnBocCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkic0FqYXhTb3VyY2UiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBjYW4gYmUgdXNlZCB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBwcmVmaXggdGhhdCBEYXRhVGFibGVzCgkJICogYXNzaWducyB0byBhIGNvb2tpZSB3aGVuIHN0YXRlIHNhdmluZyBpcyBlbmFibGVkLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgU3ByeU1lZGlhX0RhdGFUYWJsZXNfCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0Nvb2tpZVByZWZpeCI6ICJteV9kYXRhdGFibGVfIiwKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb29raWVQcmVmaXgiOiAiU3ByeU1lZGlhX0RhdGFUYWJsZXNfIiwKCQoJCgkJLyoqCgkJICogVGhpcyBpbml0aWFsaXNhdGlvbiB2YXJpYWJsZSBhbGxvd3MgeW91IHRvIHNwZWNpZnkgZXhhY3RseSB3aGVyZSBpbiB0aGUKCQkgKiBET00geW91IHdhbnQgRGF0YVRhYmxlcyB0byBpbmplY3QgdGhlIHZhcmlvdXMgY29udHJvbHMgaXQgYWRkcyB0byB0aGUgcGFnZQoJCSAqIChmb3IgZXhhbXBsZSB5b3UgbWlnaHQgd2FudCB0aGUgcGFnaW5hdGlvbiBjb250cm9scyBhdCB0aGUgdG9wIG9mIHRoZQoJCSAqIHRhYmxlKS4gRElWIGVsZW1lbnRzICh3aXRoIG9yIHdpdGhvdXQgYSBjdXN0b20gY2xhc3MpIGNhbiBhbHNvIGJlIGFkZGVkIHRvCgkJICogYWlkIHN0eWxpbmcuIFRoZSBmb2xsb3cgc3ludGF4IGlzIHVzZWQ6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5UaGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIGFsbG93ZWQ6CQoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nbCcgLSBMZW5ndGggY2hhbmdpbmc8L2xpCgkJICogICAgICAgICA8bGk+J2YnIC0gRmlsdGVyaW5nIGlucHV0PC9saT4KCQkgKiAgICAgICAgIDxsaT4ndCcgLSBUaGUgdGFibGUhPC9saT4KCQkgKiAgICAgICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3AnIC0gUGFnaW5hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3InIC0gcFJvY2Vzc2luZzwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgY29uc3RhbnRzIGFyZSBhbGxvd2VkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nSCcgLSBqUXVlcnlVSSB0aGVtZSAiaGVhZGVyIiBjbGFzc2VzICgnZmctdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci10bCB1aS1jb3JuZXItdHIgdWktaGVscGVyLWNsZWFyZml4Jyk8L2xpPgoJCSAqICAgICAgICAgPGxpPidGJyAtIGpRdWVyeVVJIHRoZW1lICJmb290ZXIiIGNsYXNzZXMgKCdmZy10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWJsIHVpLWNvcm5lci1iciB1aS1oZWxwZXItY2xlYXJmaXgnKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgc3ludGF4IGlzIGV4cGVjdGVkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OycgYW5kICcmZ3Q7JyAtIGRpdiBlbGVtZW50czwvbGk+CgkJICogICAgICAgICA8bGk+JyZsdDsiY2xhc3MiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhIGNsYXNzPC9saT4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyIjaWQiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhbiBJRDwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPkV4YW1wbGVzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyJ3cmFwcGVyImZsaXB0Jmd0Oyc8L2xpPgoJCSAqICAgICAgICAgPGxpPicmbHQ7bGYmbHQ7dCZndDtpcCZndDsnPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGxmcnRpcCA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgZmFsc2UpPC9pPiA8Yj5vcjwvYj4gCgkJICogICAgPCJIImxmcj50PCJGImlwPiA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgdHJ1ZSk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0RvbSI6ICcmbHQ7InRvcCJpJmd0O3J0Jmx0OyJib3R0b20iZmxwJmd0OyZsdDsiY2xlYXIiJmxndDsnCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzRG9tIjogImxmcnRpcCIsCgkKCQoJCS8qKgoJCSAqIERhdGFUYWJsZXMgZmVhdHVyZXMgdHdvIGRpZmZlcmVudCBidWlsdC1pbiBwYWdpbmF0aW9uIGludGVyYWN0aW9uIG1ldGhvZHMKCQkgKiAoJ3R3b19idXR0b24nIG9yICdmdWxsX251bWJlcnMnKSB3aGljaCBwcmVzZW50IGRpZmZlcmVudCBwYWdlIGNvbnRyb2xzIHRvCgkJICogdGhlIGVuZCB1c2VyLiBGdXJ0aGVyIG1ldGhvZHMgY2FuIGJlIGFkZGVkIHVzaW5nIHRoZSBBUEkgKHNlZSBiZWxvdykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCB0d29fYnV0dG9uCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNQYWdpbmF0aW9uVHlwZSI6ICJmdWxsX251bWJlcnMiCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJInNQYWdpbmF0aW9uVHlwZSI6ICJ0d29fYnV0dG9uIiwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGhvcml6b250YWwgc2Nyb2xsaW5nLiBXaGVuIGEgdGFibGUgaXMgdG9vIHdpZGUgdG8gZml0IGludG8gYSBjZXJ0YWluCgkJICogbGF5b3V0LCBvciB5b3UgaGF2ZSBhIGxhcmdlIG51bWJlciBvZiBjb2x1bW5zIGluIHRoZSB0YWJsZSwgeW91IGNhbiBlbmFibGUKCQkgKiB4LXNjcm9sbGluZyB0byBzaG93IHRoZSB0YWJsZSBpbiBhIHZpZXdwb3J0LCB3aGljaCBjYW4gYmUgc2Nyb2xsZWQuIFRoaXMKCQkgKiBwcm9wZXJ0eSBjYW4gYnkgYW55IENTUyB1bml0LCBvciBhIG51bWJlciAoaW4gd2hpY2ggY2FzZSBpdCB3aWxsIGJlIHRyZWF0ZWQKCQkgKiBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxYIjogIjEwMCUiLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1Njcm9sbFgiOiAiIiwKCQoJCgkJLyoqCgkJICogVGhpcyBwcm9wZXJ0eSBjYW4gYmUgdXNlZCB0byBmb3JjZSBhIERhdGFUYWJsZSB0byB1c2UgbW9yZSB3aWR0aCB0aGFuIGl0CgkJICogbWlnaHQgb3RoZXJ3aXNlIGRvIHdoZW4geC1zY3JvbGxpbmcgaXMgZW5hYmxlZC4gRm9yIGV4YW1wbGUgaWYgeW91IGhhdmUgYQoJCSAqIHRhYmxlIHdoaWNoIHJlcXVpcmVzIHRvIGJlIHdlbGwgc3BhY2VkLCB0aGlzIHBhcmFtZXRlciBpcyB1c2VmdWwgZm9yCgkJICogIm92ZXItc2l6aW5nIiB0aGUgdGFibGUsIGFuZCB0aHVzIGZvcmNpbmcgc2Nyb2xsaW5nLiBUaGlzIHByb3BlcnR5IGNhbiBieQoJCSAqIGFueSBDU1MgdW5pdCwgb3IgYSBudW1iZXIgKGluIHdoaWNoIGNhc2UgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgcGl4ZWwKCQkgKiBtZWFzdXJlbWVudCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5ibGFuayBzdHJpbmcgLSBpLmUuIGRpc2FibGVkPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxYIjogIjEwMCUiLAoJCSAqICAgICAgICAic1Njcm9sbFhJbm5lciI6ICIxMTAlIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1Njcm9sbFhJbm5lciI6ICIiLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgdmVydGljYWwgc2Nyb2xsaW5nLiBWZXJ0aWNhbCBzY3JvbGxpbmcgd2lsbCBjb25zdHJhaW4gdGhlIERhdGFUYWJsZQoJCSAqIHRvIHRoZSBnaXZlbiBoZWlnaHQsIGFuIGVuYWJsZSBzY3JvbGxpbmcgZm9yIGFueSBkYXRhIHdoaWNoIG92ZXJmbG93cyB0aGUKCQkgKiBjdXJyZW50IHZpZXdwb3J0LiBUaGlzIGNhbiBiZSB1c2VkIGFzIGFuIGFsdGVybmF0aXZlIHRvIHBhZ2luZyB0byBkaXNwbGF5CgkJICogYSBsb3Qgb2YgZGF0YSBpbiBhIHNtYWxsIGFyZWEgKGFsdGhvdWdoIHBhZ2luZyBhbmQgc2Nyb2xsaW5nIGNhbiBib3RoIGJlCgkJICogZW5hYmxlZCBhdCB0aGUgc2FtZSB0aW1lKS4gVGhpcyBwcm9wZXJ0eSBjYW4gYnkgYW55IENTUyB1bml0LCBvciBhIG51bWJlcgoJCSAqIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWSI6ICIiLAoJCgkKCQkvKioKCQkgKiBTZXQgdGhlIEhUVFAgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBtYWtlIHRoZSBBamF4IGNhbGwgZm9yIHNlcnZlci1zaWRlCgkJICogcHJvY2Vzc2luZyBvciBBamF4IHNvdXJjZWQgZGF0YS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IEdFVAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3Bvc3QucGhwIiwKCQkgKiAgICAgICAgInNTZXJ2ZXJNZXRob2QiOiAiUE9TVCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTZXJ2ZXJNZXRob2QiOiAiR0VUIgoJfTsKCQoJCgkKCS8qKgoJICogQ29sdW1uIG9wdGlvbnMgdGhhdCBjYW4gYmUgZ2l2ZW4gdG8gRGF0YVRhYmxlcyBhdCBpbml0aWFsaXNhdGlvbiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnMgPSB7CgkJLyoqCgkJICogQWxsb3dzIGEgY29sdW1uJ3Mgc29ydGluZyB0byB0YWtlIG11bHRpcGxlIGNvbHVtbnMgaW50byBhY2NvdW50IHdoZW4gCgkJICogZG9pbmcgYSBzb3J0LiBGb3IgZXhhbXBsZSBmaXJzdCBuYW1lIC8gbGFzdCBuYW1lIGNvbHVtbnMgbWFrZSBzZW5zZSB0byAKCQkgKiBkbyBhIG11bHRpLWNvbHVtbiBzb3J0IG92ZXIgdGhlIHR3byBjb2x1bW5zLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsIDxpPlRha2VzIHRoZSB2YWx1ZSBvZiB0aGUgY29sdW1uIGluZGV4IGF1dG9tYXRpY2FsbHk8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdLCAiYVRhcmdldHMiOiBbIDAgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMSwgMCBdLCAiYVRhcmdldHMiOiBbIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMiwgMywgNCBdLCAiYVRhcmdldHMiOiBbIDIgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAxLCAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJhRGF0YVNvcnQiOiBbIDIsIDMsIDQgXSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhRGF0YVNvcnQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBZb3UgY2FuIGNvbnRyb2wgdGhlIGRlZmF1bHQgc29ydGluZyBkaXJlY3Rpb24sIGFuZCBldmVuIGFsdGVyIHRoZSBiZWhhdmlvdXIKCQkgKiBvZiB0aGUgc29ydCBoYW5kbGVyIChpLmUuIG9ubHkgYWxsb3cgYXNjZW5kaW5nIHNvcnRpbmcgZXRjKSB1c2luZyB0aGlzCgkJICogcGFyYW1ldGVyLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbICdhc2MnLCAnZGVzYycgXQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0sICJhVGFyZ2V0cyI6IFsgMSBdIH0sCgkJICogICAgICAgICAgeyAiYXNTb3J0aW5nIjogWyAiZGVzYyIsICJhc2MiLCAiYXNjIiBdLCAiYVRhcmdldHMiOiBbIDIgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiIF0sICJhVGFyZ2V0cyI6IFsgMyBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiwgImFzYyIsICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiBdIH0sCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhc1NvcnRpbmciOiBbICdhc2MnLCAnZGVzYycgXSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9uIHRoZSBkYXRhIGluIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTZWFyY2hhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNlYXJjaGFibGUiOiBmYWxzZSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2VhcmNoYWJsZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRhYmxlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB1c2luZyBmblJlbmRlcigpIGZvciBhIGNvbHVtbiwgeW91IG1heSB3aXNoIHRvIHVzZSB0aGUgb3JpZ2luYWwgZGF0YQoJCSAqIChiZWZvcmUgcmVuZGVyaW5nKSBmb3Igc29ydGluZyBhbmQgZmlsdGVyaW5nICh0aGUgZGVmYXVsdCBpcyB0byB1c2VkIHRoZQoJCSAqIHJlbmRlcmVkIGRhdGEgdGhhdCB0aGUgdXNlciBjYW4gc2VlKS4gVGhpcyBtYXkgYmUgdXNlZnVsIGZvciBkYXRlcyBldGMuCgkJICogCgkJICogKk5PVEUqIEl0IGlzIGl0IGlzIGFkdmlzYWJsZSBub3cgdG8gdXNlIG1EYXRhUHJvcCBhcyBhIGZ1bmN0aW9uIGFuZCBtYWtlIAoJCSAqIHVzZSBvZiB0aGUgJ3R5cGUnIHRoYXQgaXQgZ2l2ZXMsIGFsbG93aW5nIChwb3RlbnRpYWxseSkgZGlmZmVyZW50IGRhdGEgdG8KCQkgKiBiZSB1c2VkIGZvciBzb3J0aW5nLCBmaWx0ZXJpbmcsIGRpc3BsYXkgYW5kIHR5cGUgZGV0ZWN0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UsCgkJICogICAgICAgICAgICAiYVRhcmdldHMiOiBbIDAgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UKCQkgKiAgICAgICAgICB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlZpc2libGUiOiBmYWxzZSwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJiVmlzaWJsZSI6IGZhbHNlIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJWaXNpYmxlIjogdHJ1ZSwKCQkKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBmblJlbmRlcgoJCSAqIGFsbG93aW5nIHlvdSB0byBtb2RpZnkgdGhlIERPTSBlbGVtZW50IChhZGQgYmFja2dyb3VuZCBjb2xvdXIgZm9yIGV4YW1wbGUpIHdoZW4gdGhlCgkJICogZWxlbWVudCBpcyBhdmFpbGFibGUgKHNpbmNlIGl0IGlzIG5vdCB3aGVuIGZuUmVuZGVyIGlzIGNhbGxlZCkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gblRkIFRoZSBURCBub2RlIHRoYXQgaGFzIGJlZW4gY3JlYXRlZAoJCSAqICBAcGFyYW0geyp9IHNEYXRhIFRoZSBEYXRhIGZvciB0aGUgY2VsbAoJCSAqICBAcGFyYW0ge2FycmF5fG9iamVjdH0gb0RhdGEgVGhlIGRhdGEgZm9yIHRoZSB3aG9sZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBpbmRleCBmb3IgdGhlIGFvRGF0YSBkYXRhIHN0b3JlCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIFRoZSBjb2x1bW4gaW5kZXggZm9yIGFvQ29sdW1ucwoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFszXSwKCQkgKiAgICAgICAgICAiZm5DcmVhdGVkQ2VsbCI6IGZ1bmN0aW9uIChuVGQsIHNEYXRhLCBvRGF0YSwgaVJvdywgaUNvbCkgewoJCSAqICAgICAgICAgICAgaWYgKCBzRGF0YSA9PSAiMS43IiApIHsKCQkgKiAgICAgICAgICAgICAgJChuVGQpLmNzcygnY29sb3InLCAnYmx1ZScpCgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9IF0KCQkgKiAgICAgIH0pOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCBpbgoJCSAqIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBPYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhUm93IFRoZSByb3cgaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhQ29sdW1uIFRoZSBjb2x1bW4gaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gIG8uYURhdGEgVGhlIGRhdGEgZm9yIHRoZSByb3cgaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8ub1NldHRpbmdzIFRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgRGF0YVRhYmxlcyBpbnN0YW5jZQoJCSAqICBAcGFyYW0ge29iamVjdH0gby5tRGF0YVByb3AgVGhlIGRhdGEgcHJvcGVydHkgdXNlZCBmb3IgdGhpcyBjb2x1bW4KCQkgKiAgQHBhcmFtIHsqfSAgICAgIHZhbCBUaGUgY3VycmVudCBjZWxsIHZhbHVlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImZuUmVuZGVyIjogZnVuY3Rpb24gKCBvLCB2YWwgKSB7CgkJICogICAgICAgICAgICAgIHJldHVybiBvLmFEYXRhWzBdICsnICcrIG8uYURhdGFbM107CgkJICogICAgICAgICAgICB9LAoJCSAqICAgICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0KCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJmblJlbmRlciI6IGZ1bmN0aW9uICggbywgdmFsICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIG8uYURhdGFbMF0gKycgJysgby5hRGF0YVszXTsKCQkgKiAgICAgICAgICB9IH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblJlbmRlciI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSBjb2x1bW4gaW5kZXggKHN0YXJ0aW5nIGZyb20gMCEpIHRoYXQgeW91IHdpc2ggYSBzb3J0IHRvIGJlIHBlcmZvcm1lZAoJCSAqIHVwb24gd2hlbiB0aGlzIGNvbHVtbiBpcyBzZWxlY3RlZCBmb3Igc29ydGluZy4gVGhpcyBjYW4gYmUgdXNlZCBmb3Igc29ydGluZwoJCSAqIG9uIGhpZGRlbiBjb2x1bW5zIGZvciBleGFtcGxlLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgLTEgPGk+VXNlIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZCBjb2x1bW4gaW5kZXg8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpRGF0YVNvcnQiOiAtMSwKCQoJCgkJLyoqCgkJICogVGhpcyBwcm9wZXJ0eSBjYW4gYmUgdXNlZCB0byByZWFkIGRhdGEgZnJvbSBhbnkgSlNPTiBkYXRhIHNvdXJjZSBwcm9wZXJ0eSwKCQkgKiBpbmNsdWRpbmcgZGVlcGx5IG5lc3RlZCBvYmplY3RzIC8gcHJvcGVydGllcy4gbURhdGFQcm9wIGNhbiBiZSBnaXZlbiBpbiBhCgkJICogbnVtYmVyIG9mIGRpZmZlcmVudCB3YXlzIHdoaWNoIGVmZmVjdCBpdHMgYmVoYXZpb3VyOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+aW50ZWdlciAtIHRyZWF0ZWQgYXMgYW4gYXJyYXkgaW5kZXggZm9yIHRoZSBkYXRhIHNvdXJjZS4gVGhpcyBpcyB0aGUKCQkgKiAgICAgICBkZWZhdWx0IHRoYXQgRGF0YVRhYmxlcyB1c2VzIChpbmNyZW1lbnRhbGx5IGluY3JlYXNlZCBmb3IgZWFjaCBjb2x1bW4pLjwvbGk+CgkJICogICAgIDxsaT5zdHJpbmcgLSByZWFkIGFuIG9iamVjdCBwcm9wZXJ0eSBmcm9tIHRoZSBkYXRhIHNvdXJjZS4gTm90ZSB0aGF0IHlvdSBjYW4KCQkgKiAgICAgICB1c2UgSmF2YXNjcmlwdCBkb3R0ZWQgbm90YXRpb24gdG8gcmVhZCBkZWVwIHByb3BlcnRpZXMvYXJyYXlzIGZyb20gdGhlCgkJICogICAgICAgZGF0YSBzb3VyY2UuPC9saT4KCQkgKiAgICAgPGxpPm51bGwgLSAgdGhlIHNEYWZhdWx0Q29udGVudCBvcHRpb24gd2lsbCB1c2UgdXNlZCBmb3IgdGhlIGNlbGwgKGVtcHR5CgkJICogICAgICAgc3RyaW5nIGJ5IGRlZmF1bHQuIFRoaXMgY2FuIGJlIHVzZWZ1bCBvbiBnZW5lcmF0ZWQgY29sdW1ucyBzdWNoIGFzCgkJICogICAgICAgZWRpdCAvIGRlbGV0ZSBhY3Rpb24gY29sdW1ucy48L2xpPgoJCSAqICAgICA8bGk+ZnVuY3Rpb24gLSB0aGUgZnVuY3Rpb24gZ2l2ZW4gd2lsbCBiZSBleGVjdXRlZCB3aGVuZXZlciBEYXRhVGFibGVzIAoJCSAqICAgICAgIG5lZWRzIHRvIHNldCBvciBnZXQgdGhlIGRhdGEgZm9yIGEgY2VsbCBpbiB0aGUgY29sdW1uLiBUaGUgZnVuY3Rpb24gCgkJICogICAgICAgdGFrZXMgdGhyZWUgcGFyYW1ldGVyczoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2FycmF5fG9iamVjdH0gVGhlIGRhdGEgc291cmNlIGZvciB0aGUgcm93PC9saT4KCQkgKiAgICAgICAgIDxsaT57c3RyaW5nfSBUaGUgdHlwZSBjYWxsIGRhdGEgcmVxdWVzdGVkIC0gdGhpcyB3aWxsIGJlICdzZXQnIHdoZW4KCQkgKiAgICAgICAgICAgc2V0dGluZyBkYXRhIG9yICdmaWx0ZXInLCAnZGlzcGxheScsICd0eXBlJyBvciAnc29ydCcgd2hlbiBnYXRoZXJpbmcKCQkgKiAgICAgICAgICAgZGF0YS48L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIHNldCB3aGVuIHRoZSBzZWNvbmQgcGFyYW1ldGVyIGlzICdzZXQnLjwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgICBUaGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uIGlzIG5vdCByZXF1aXJlZCB3aGVuICdzZXQnIGlzIHRoZSB0eXBlCgkJICogICAgICAgb2YgY2FsbCwgYnV0IG90aGVyd2lzZSB0aGUgcmV0dXJuIGlzIHdoYXQgd2lsbCBiZSB1c2VkIGZvciB0aGUgZGF0YQoJCSAqICAgICAgIHJlcXVlc3RlZC48L2xpPgoJCSAqICAgIDwvdWw+CgkJICogIEB0eXBlIHN0cmluZ3xpbnR8ZnVuY3Rpb258bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsIDxpPlVzZSBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQgY29sdW1uIGluZGV4PC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFJlYWQgdGFibGUgZGF0YSBmcm9tIG9iamVjdHMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kZWVwLnR4dCIsCgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogImVuZ2luZSIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YVByb3AiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YVByb3AiOiAicGxhdGZvcm0uaW5uZXIiIH0sCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogInBsYXRmb3JtLmRldGFpbHMuMCIgfSwKCQkgKiAgICAgICAgICB7ICJtRGF0YVByb3AiOiAicGxhdGZvcm0uZGV0YWlscy4xIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgbURhdGFQcm9wIGFzIGEgZnVuY3Rpb24gdG8gcHJvdmlkZSBkaWZmZXJlbnQgaW5mb3JtYXRpb24gZm9yCgkJICogICAgLy8gc29ydGluZywgZmlsdGVyaW5nIGFuZCBkaXNwbGF5LiBJbiB0aGlzIGNhc2UsIGN1cnJlbmN5IChwcmljZSkKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0sCgkJICogICAgICAgICAgIm1EYXRhUHJvcCI6IGZ1bmN0aW9uICggc291cmNlLCB0eXBlLCB2YWwgKSB7CgkJICogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3NldCcpIHsKCQkgKiAgICAgICAgICAgICAgc291cmNlLnByaWNlID0gdmFsOwoJCSAqICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgY29tcHV0ZWQgZGlzbGF5IGFuZCBmaWx0ZXIgdmFsdWVzIGZvciBlZmZpY2llbmN5CgkJICogICAgICAgICAgICAgIHNvdXJjZS5wcmljZV9kaXNwbGF5ID0gdmFsPT0iIiA/ICIiIDogIiQiK251bWJlckZvcm1hdCh2YWwpOwoJCSAqICAgICAgICAgICAgICBzb3VyY2UucHJpY2VfZmlsdGVyICA9IHZhbD09IiIgPyAiIiA6ICIkIitudW1iZXJGb3JtYXQodmFsKSsiICIrdmFsOwoJCSAqICAgICAgICAgICAgICByZXR1cm47CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAnZGlzcGxheScpIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZV9kaXNwbGF5OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2ZpbHRlcicpIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS5wcmljZV9maWx0ZXI7CgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgICAvLyAnc29ydCcgYW5kICd0eXBlJyBib3RoIGp1c3QgdXNlIHRoZSBpbnRlZ2VyCgkJICogICAgICAgICAgICByZXR1cm4gc291cmNlLnByaWNlOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkibURhdGFQcm9wIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2xhc3MgdG8gZ2l2ZSB0byBlYWNoIGNlbGwgaW4gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQ2xhc3MiOiAiIiwKCQkKCQkvKioKCQkgKiBXaGVuIERhdGFUYWJsZXMgY2FsY3VsYXRlcyB0aGUgY29sdW1uIHdpZHRocyB0byBhc3NpZ24gdG8gZWFjaCBjb2x1bW4sCgkJICogaXQgZmluZHMgdGhlIGxvbmdlc3Qgc3RyaW5nIGluIGVhY2ggY29sdW1uIGFuZCB0aGVuIGNvbnN0cnVjdHMgYQoJCSAqIHRlbXBvcmFyeSB0YWJsZSBhbmQgcmVhZHMgdGhlIHdpZHRocyBmcm9tIHRoYXQuIFRoZSBwcm9ibGVtIHdpdGggdGhpcwoJCSAqIGlzIHRoYXQgIm1tbSIgaXMgbXVjaCB3aWRlciB0aGVuICJpaWlpIiwgYnV0IHRoZSBsYXR0ZXIgaXMgYSBsb25nZXIgCgkJICogc3RyaW5nIC0gdGh1cyB0aGUgY2FsY3VsYXRpb24gY2FuIGdvIHdyb25nIChkb2luZyBpdCBwcm9wZXJseSBhbmQgcHV0dGluZwoJCSAqIGl0IGludG8gYW4gRE9NIG9iamVjdCBhbmQgbWVhc3VyaW5nIHRoYXQgaXMgaG9ycmlibHkoISkgc2xvdykuIFRodXMgYXMKCQkgKiBhICJ3b3JrIGFyb3VuZCIgd2UgcHJvdmlkZSB0aGlzIG9wdGlvbi4gSXQgd2lsbCBhcHBlbmQgaXRzIHZhbHVlIHRvIHRoZQoJCSAqIHRleHQgdGhhdCBpcyBmb3VuZCB0byBiZSB0aGUgbG9uZ2VzdCBzdHJpbmcgZm9yIHRoZSBjb2x1bW4gLSBpLmUuIHBhZGRpbmcuCgkJICogR2VuZXJhbGx5IHlvdSBzaG91bGRuJ3QgbmVlZCB0aGlzLCBhbmQgaXQgaXMgbm90IGRvY3VtZW50ZWQgb24gdGhlIAoJCSAqIGdlbmVyYWwgRGF0YVRhYmxlcy5uZXQgZG9jdW1lbnRhdGlvbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPGk+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAic0NvbnRlbnRQYWRkaW5nIjogIm1tbSIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb250ZW50UGFkZGluZyI6ICIiLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgYSBkZWZhdWx0IHZhbHVlIHRvIGJlIGdpdmVuIGZvciBhIGNvbHVtbidzIGRhdGEsIGFuZCB3aWxsIGJlIHVzZWQKCQkgKiB3aGVuZXZlciBhIG51bGwgZGF0YSBzb3VyY2UgaXMgZW5jb3VudGVyZWQgKHRoaXMgY2FuIGJlIGJlY2F1c2UgbURhdGFQcm9wCgkJICogaXMgc2V0IHRvIG51bGwsIG9yIGJlY2F1c2UgdGhlIGRhdGEgc291cmNlIGl0c2VsZiBpcyBudWxsKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YVByb3AiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IiwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgLTEgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YVByb3AiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IgoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0RlZmF1bHRDb250ZW50IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgaXMgb25seSB1c2VkIGluIERhdGFUYWJsZXMnIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIEl0IGNhbgoJCSAqIGJlIGV4Y2VwdGlvbmFsbHkgdXNlZnVsIHRvIGtub3cgd2hhdCBjb2x1bW5zIGFyZSBiZWluZyBkaXNwbGF5ZWQgb24gdGhlCgkJICogY2xpZW50IHNpZGUsIGFuZCB0byBtYXAgdGhlc2UgdG8gZGF0YWJhc2UgZmllbGRzLiBXaGVuIGRlZmluZWQsIHRoZSBuYW1lcwoJCSAqIGFsc28gYWxsb3cgRGF0YVRhYmxlcyB0byByZW9yZGVyIGluZm9ybWF0aW9uIGZyb20gdGhlIHNlcnZlciBpZiBpdCBjb21lcwoJCSAqIGJhY2sgaW4gYW4gdW5leHBlY3RlZCBvcmRlciAoaS5lLiBpZiB5b3Ugc3dpdGNoIHlvdXIgY29sdW1ucyBhcm91bmQgb24gdGhlCgkJICogY2xpZW50LXNpZGUsIHlvdXIgc2VydmVyLXNpZGUgY29kZSBkb2VzIG5vdCBhbHNvIG5lZWQgdXBkYXRpbmcpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZW5naW5lIiwgImFUYXJnZXRzIjogWyAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJicm93c2VyIiwgImFUYXJnZXRzIjogWyAxIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIsICJhVGFyZ2V0cyI6IFsgMiBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAidmVyc2lvbiIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZ3JhZGUiLCAiYVRhcmdldHMiOiBbIDQgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJlbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJ2ZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNOYW1lIjogIiIsCgkKCQoJCS8qKgoJCSAqIERlZmluZXMgYSBkYXRhIHNvdXJjZSB0eXBlIGZvciB0aGUgc29ydGluZyB3aGljaCBjYW4gYmUgdXNlZCB0byByZWFkCgkJICogcmVhbHRpbWUgaW5mb3JtYXRpb24gZnJvbSB0aGUgdGFibGUgKHVwZGF0aW5nIHRoZSBpbnRlcm5hbGx5IGNhY2hlZAoJCSAqIHZlcnNpb24pIHByaW9yIHRvIHNvcnRpbmcuIFRoaXMgYWxsb3dzIHNvcnRpbmcgdG8gb2NjdXIgb24gdXNlciBlZGl0YWJsZQoJCSAqIGVsZW1lbnRzIHN1Y2ggYXMgZm9ybSBpbnB1dHMuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJhVGFyZ2V0cyI6IFsgMiwgMyBdIH0sCgkJICogICAgICAgICAgeyAic1R5cGUiOiAibnVtZXJpYyIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tc2VsZWN0IiwgImFUYXJnZXRzIjogWyA0IF0gfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIsICJhVGFyZ2V0cyI6IFsgNSBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXRleHQiIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJzVHlwZSI6ICJudW1lcmljIiB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXNlbGVjdCIgfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU29ydERhdGFUeXBlIjogInN0ZCIsCgkKCQoJCS8qKgoJCSAqIFRoZSB0aXRsZSBvZiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwgPGk+RGVyaXZlZCBmcm9tIHRoZSAnVEgnIHZhbHVlIGZvciB0aGlzIGNvbHVtbiBpbiB0aGUgCgkJICogICAgb3JpZ2luYWwgSFRNTCB0YWJsZS48L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiTXkgY29sdW1uIHRpdGxlIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIk15IGNvbHVtbiB0aXRsZSIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSB0eXBlIGFsbG93cyB5b3UgdG8gc3BlY2lmeSBob3cgdGhlIGRhdGEgZm9yIHRoaXMgY29sdW1uIHdpbGwgYmUgc29ydGVkLgoJCSAqIEZvdXIgdHlwZXMgKHN0cmluZywgbnVtZXJpYywgZGF0ZSBhbmQgaHRtbCAod2hpY2ggd2lsbCBzdHJpcCBIVE1MIHRhZ3MKCQkgKiBiZWZvcmUgc29ydGluZykpIGFyZSBjdXJyZW50bHkgYXZhaWxhYmxlLiBOb3RlIHRoYXQgb25seSBkYXRlIGZvcm1hdHMKCQkgKiB1bmRlcnN0b29kIGJ5IEphdmFzY3JpcHQncyBEYXRlKCkgb2JqZWN0IHdpbGwgYmUgYWNjZXB0ZWQgYXMgdHlwZSBkYXRlLiBGb3IKCQkgKiBleGFtcGxlOiAiTWFyIDI2LCAyMDA4IDU6MDMgUE0iLiBNYXkgdGFrZSB0aGUgdmFsdWVzOiAnc3RyaW5nJywgJ251bWVyaWMnLAoJCSAqICdkYXRlJyBvciAnaHRtbCcgKGJ5IGRlZmF1bHQpLiBGdXJ0aGVyIHR5cGVzIGNhbiBiZSBhZGRpbmcgdGhyb3VnaAoJCSAqIHBsdWctaW5zLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5BdXRvLWRldGVjdGVkIGZyb20gcmF3IGRhdGE8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVHlwZSI6ICJodG1sIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1R5cGUiOiAiaHRtbCIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUeXBlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRGVmaW5pbmcgdGhlIHdpZHRoIG9mIHRoZSBjb2x1bW4sIHRoaXMgcGFyYW1ldGVyIG1heSB0YWtlIGFueSBDU1MgdmFsdWUKCQkgKiAoM2VtLCAyMHB4IGV0YykuIERhdGFUYWJsZXMgYXBwbHlzICdzbWFydCcgd2lkdGhzIHRvIGNvbHVtbnMgd2hpY2ggaGF2ZSBub3QKCQkgKiBiZWVuIGdpdmVuIGEgc3BlY2lmaWMgd2lkdGggdGhyb3VnaCB0aGlzIGludGVyZmFjZSBlbnN1cmluZyB0aGF0IHRoZSB0YWJsZQoJCSAqIHJlbWFpbnMgcmVhZGFibGUuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsIDxpPkF1dG9tYXRpYzwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNXaWR0aCI6ICIyMCUiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzV2lkdGgiOiAiMjAlIiB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1dpZHRoIjogbnVsbAoJfTsKCQoJCgkKCS8qKgoJICogRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QgLSB0aGlzIGhvbGRzIGFsbCB0aGUgaW5mb3JtYXRpb24gbmVlZGVkIGZvciBhCgkgKiBnaXZlbiB0YWJsZSwgaW5jbHVkaW5nIGNvbmZpZ3VyYXRpb24sIGRhdGEgYW5kIGN1cnJlbnQgYXBwbGljYXRpb24gb2YgdGhlCgkgKiB0YWJsZSBvcHRpb25zLiBEYXRhVGFibGVzIGRvZXMgbm90IGhhdmUgYSBzaW5nbGUgaW5zdGFuY2UgZm9yIGVhY2ggRGF0YVRhYmxlCgkgKiB3aXRoIHRoZSBzZXR0aW5ncyBhdHRhY2hlZCB0byB0aGF0IGluc3RhbmNlLCBidXQgcmF0aGVyIGluc3RhbmNlcyBvZiB0aGUKCSAqIERhdGFUYWJsZSAiY2xhc3MiIGFyZSBjcmVhdGVkIG9uLXRoZS1mbHkgYXMgbmVlZGVkICh0eXBpY2FsbHkgYnkgYSAKCSAqICQoKS5kYXRhVGFibGUoKSBjYWxsKSBhbmQgdGhlIHNldHRpbmdzIG9iamVjdCBpcyB0aGVuIGFwcGxpZWQgdG8gdGhhdAoJICogaW5zdGFuY2UuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG9iamVjdCBpcyByZWxhdGVkIHRvIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9IGJ1dCB0aGlzIAoJICogb25lIGlzIHRoZSBpbnRlcm5hbCBkYXRhIHN0b3JlIGZvciBEYXRhVGFibGVzJ3MgY2FjaGUgb2YgY29sdW1ucy4gSXQgc2hvdWxkCgkgKiBOT1QgYmUgbWFuaXB1bGF0ZWQgb3V0c2lkZSBvZiBEYXRhVGFibGVzLiBBbnkgY29uZmlndXJhdGlvbiBzaG91bGQgYmUgZG9uZQoJICogdGhyb3VnaCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucy4KCSAqICBAbmFtZXNwYWNlCgkgKiAgQHRvZG8gUmVhbGx5IHNob3VsZCBhdHRhY2ggdGhlIHNldHRpbmdzIG9iamVjdCB0byBpbmRpdmlkdWFsIGluc3RhbmNlcyBzbyB3ZQoJICogICAgZG9uJ3QgbmVlZCB0byBjcmVhdGUgbmV3IGluc3RhbmNlcyBvbiBlYWNoICQoKS5kYXRhVGFibGUoKSBjYWxsIChpZiB0aGUKCSAqICAgIHRhYmxlIGFscmVhZHkgZXhpc3RzKS4gSXQgd291bGQgYWxzbyBzYXZlIHBhc3Npbmcgb1NldHRpbmdzIGFyb3VuZCBhbmQKCSAqICAgIGludG8gZXZlcnkgc2luZ2xlIGZ1bmN0aW9uLiBIb3dldmVyLCB0aGlzIGlzIGEgdmVyeSBzaWduaWZpY2FudCAKCSAqICAgIGFyY2hpdGVjdHVyZSBjaGFuZ2UgZm9yIERhdGFUYWJsZXMgYW5kIHdpbGwgYWxtb3N0IGNlcnRhaW5seSBicmVhawoJICogICAgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCBvbGRlciBpbnN0YWxsYXRpb25zLiBUaGlzIGlzIHNvbWV0aGluZyB0aGF0CgkgKiAgICB3aWxsIGJlIGRvbmUgaW4gMi4wLgoJICovCglEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5ncyA9IHsKCQkvKioKCQkgKiBQcmltYXJ5IGZlYXR1cmVzIG9mIERhdGFUYWJsZXMgYW5kIHRoZWlyIGVuYWJsZW1lbnQgc3RhdGUuCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib0ZlYXR1cmVzIjogewoJCQkKCQkJLyoqCgkJCSAqIEZsYWcgdG8gc2F5IGlmIERhdGFUYWJsZXMgc2hvdWxkIGF1dG9tYXRpY2FsbHkgdHJ5IHRvIGNhbGN1bGF0ZSB0aGUKCQkJICogb3B0aW11bSB0YWJsZSBhbmQgY29sdW1ucyB3aWR0aHMgKHRydWUpIG9yIG5vdCAoZmFsc2UpLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJBdXRvV2lkdGgiOiBudWxsLAoJCgkJCS8qKgoJCQkgKiBEZWxheSB0aGUgY3JlYXRpb24gb2YgVFIgYW5kIFREIGVsZW1lbnRzIHVudGlsIHRoZXkgYXJlIGFjdHVhbGx5CgkJCSAqIG5lZWRlZCBieSBhIGRyaXZlbiBwYWdlIGRyYXcuIFRoaXMgY2FuIGdpdmUgYSBzaWduaWZpY2FudCBzcGVlZAoJCQkgKiBpbmNyZWFzZSBmb3IgQWpheCBzb3VyY2UgYW5kIEphdmFzY3JpcHQgc291cmNlIGRhdGEsIGJ1dCBtYWtlcyBubwoJCQkgKiBkaWZmZXJlbmNlIGF0IGFsbCBmcm8gRE9NIGFuZCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRhYmxlcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiRGVmZXJSZW5kZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEVuYWJsZSBmaWx0ZXJpbmcgb24gdGhlIHRhYmxlIG9yIG5vdC4gTm90ZSB0aGF0IGlmIHRoaXMgaXMgZGlzYWJsZWQKCQkJICogdGhlbiB0aGVyZSBpcyBubyBmaWx0ZXJpbmcgYXQgYWxsIG9uIHRoZSB0YWJsZSwgaW5jbHVkaW5nIGZuRmlsdGVyLgoJCQkgKiBUbyBqdXN0IHJlbW92ZSB0aGUgZmlsdGVyaW5nIGlucHV0IHVzZSBzRG9tIGFuZCByZW1vdmUgdGhlICdmJyBvcHRpb24uCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkZpbHRlciI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogVGFibGUgaW5mb3JtYXRpb24gZWxlbWVudCAodGhlICdTaG93aW5nIHggb2YgeSByZWNvcmRzJyBkaXYpIGVuYWJsZQoJCQkgKiBmbGFnLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJJbmZvIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBQcmVzZW50IGEgdXNlciBjb250cm9sIGFsbG93aW5nIHRoZSBlbmQgdXNlciB0byBjaGFuZ2UgdGhlIHBhZ2Ugc2l6ZQoJCQkgKiB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiTGVuZ3RoQ2hhbmdlIjogbnVsbCwKCQoJCQkvKioKCQkJICogUGFnaW5hdGlvbiBlbmFibGVkIG9yIG5vdC4gTm90ZSB0aGF0IGlmIHRoaXMgaXMgZGlzYWJsZWQgdGhlbiBsZW5ndGgKCQkJICogY2hhbmdpbmcgbXVzdCBhbHNvIGJlIGRpc2FibGVkLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJQYWdpbmF0ZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogUHJvY2Vzc2luZyBpbmRpY2F0b3IgZW5hYmxlIGZsYWcgd2hlbmV2ZXIgRGF0YVRhYmxlcyBpcyBlbmFjdGluZyBhCgkJCSAqIHVzZXIgcmVxdWVzdCAtIHR5cGljYWxseSBhbiBBamF4IHJlcXVlc3QgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlByb2Nlc3NpbmciOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgZW5hYmxlZCBmbGFnIC0gd2hlbiBlbmFibGVkIERhdGFUYWJsZXMgd2lsbAoJCQkgKiBnZXQgYWxsIGRhdGEgZnJvbSB0aGUgc2VydmVyIGZvciBldmVyeSBkcmF3IC0gdGhlcmUgaXMgbm8gZmlsdGVyaW5nLAoJCQkgKiBzb3J0aW5nIG9yIHBhZ2luZyBkb25lIG9uIHRoZSBjbGllbnQtc2lkZS4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU2VydmVyU2lkZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogU29ydGluZyBlbmFibGVtZW50IGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlNvcnQiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEFwcGx5IGEgY2xhc3MgdG8gdGhlIGNvbHVtbnMgd2hpY2ggYXJlIGJlaW5nIHNvcnRlZCB0byBwcm92aWRlIGEKCQkJICogdmlzdWFsIGhpZ2hsaWdodCBvciBub3QuIFRoaXMgY2FuIHNsb3cgdGhpbmdzIGRvd24gd2hlbiBlbmFibGVkIHNpbmNlCgkJCSAqIHRoZXJlIGlzIGEgbG90IG9mIERPTSBpbnRlcmFjdGlvbi4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU29ydENsYXNzZXMiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFN0YXRlIHNhdmluZyBlbmFibGVtZW50IGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlN0YXRlU2F2ZSI6IG51bGwKCQl9LAoJCQoJCgkJLyoqCgkJICogU2Nyb2xsaW5nIHNldHRpbmdzIGZvciBhIHRhYmxlLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJIm9TY3JvbGwiOiB7CgkJCS8qKgoJCQkgKiBJbmRpY2F0ZSBpZiBEYXRhVGFibGVzIHNob3VsZCBiZSBhbGxvd2VkIHRvIHNldCB0aGUgcGFkZGluZyAvIG1hcmdpbgoJCQkgKiBldGMgZm9yIHRoZSBzY3JvbGxpbmcgaGVhZGVyIGVsZW1lbnRzIG9yIG5vdC4gVHlwaWNhbGx5IHlvdSB3aWxsIHdhbnQKCQkJICogdGhpcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiQXV0b0NzcyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2hlbiB0aGUgdGFibGUgaXMgc2hvcnRlciBpbiBoZWlnaHQgdGhhbiBzU2Nyb2xsWSwgY29sbGFwc2UgdGhlCgkJCSAqIHRhYmxlIGNvbnRhaW5lciBkb3duIHRvIHRoZSBoZWlnaHQgb2YgdGhlIHRhYmxlICh3aGVuIHRydWUpLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJDb2xsYXBzZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogSW5maW5pdGUgc2Nyb2xsaW5nIGVuYWJsZW1lbnQgZmxhZy4gTm93IGRlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJCSAqIHVzaW5nIHRoZSBTY3JvbGxlciBwbHVnLWluLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJJbmZpbml0ZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2lkdGggb2YgdGhlIHNjcm9sbGJhciBmb3IgdGhlIHdlYi1icm93c2VyJ3MgcGxhdGZvcm0uIENhbGN1bGF0ZWQKCQkJICogZHVyaW5nIHRhYmxlIGluaXRpYWxpc2F0aW9uLgoJCQkgKiAgQHR5cGUgaW50CgkJCSAqICBAZGVmYXVsdCAwCgkJCSAqLwoJCQkiaUJhcldpZHRoIjogMCwKCQkJCgkJCS8qKgoJCQkgKiBTcGFjZSAoaW4gcGl4ZWxzKSBiZXR3ZWVuIHRoZSBib3R0b20gb2YgdGhlIHNjcm9sbGluZyBjb250YWluZXIgYW5kIAoJCQkgKiB0aGUgYm90dG9tIG9mIHRoZSBzY3JvbGxpbmcgdmlld3BvcnQgYmVmb3JlIHRoZSBuZXh0IHBhZ2UgaXMgbG9hZGVkCgkJCSAqIHdoZW4gdXNpbmcgaW5maW5pdGUgc2Nyb2xsaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgaW50CgkJCSAqLwoJCQkiaUxvYWRHYXAiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFZpZXdwb3J0IHdpZHRoIGZvciBob3Jpem9udGFsIHNjcm9sbGluZy4gSG9yaXpvbnRhbCBzY3JvbGxpbmcgaXMgCgkJCSAqIGRpc2FibGVkIGlmIGFuIGVtcHR5IHN0cmluZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKi8KCQkJInNYIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBXaWR0aCB0byBleHBhbmQgdGhlIHRhYmxlIHRvIHdoZW4gdXNpbmcgeC1zY3JvbGxpbmcuIFR5cGljYWxseSB5b3UKCQkJICogc2hvdWxkIG5vdCBuZWVkIHRvIHVzZSB0aGlzLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVwcmVjYXRlZAoJCQkgKi8KCQkJInNYSW5uZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFZpZXdwb3J0IGhlaWdodCBmb3IgdmVydGljYWwgc2Nyb2xsaW5nLiBWZXJ0aWNhbCBzY3JvbGxpbmcgaXMgZGlzYWJsZWQKCQkJICogaWYgYW4gZW1wdHkgc3RyaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqLwoJCQkic1kiOiBudWxsCgkJfSwKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBpbmZvcm1hdGlvbiBmb3IgdGhlIHRhYmxlLgoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBleHRlbmRzIERhdGFUYWJsZS5kZWZhdWx0cy5vTGFuZ3VhZ2UKCQkgKi8KCQkib0xhbmd1YWdlIjogewoJCQkvKioKCQkJICogSW5mb3JtYXRpb24gY2FsbGJhY2sgZnVuY3Rpb24uIFNlZSAKCQkJICoge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5mbkluZm9DYWxsYmFja30KCQkJICogIEB0eXBlIGZ1bmN0aW9uCgkJCSAqICBAZGVmYXVsdCAKCQkJICovCgkJCSJmbkluZm9DYWxsYmFjayI6IG51bGwKCQl9LAoJCQoJCS8qKgoJCSAqIEFycmF5IHJlZmVyZW5jaW5nIHRoZSBub2RlcyB3aGljaCBhcmUgdXNlZCBmb3IgdGhlIGZlYXR1cmVzLiBUaGUgCgkJICogcGFyYW1ldGVycyBvZiB0aGlzIG9iamVjdCBtYXRjaCB3aGF0IGlzIGFsbG93ZWQgYnkgc0RvbSAtIGkuZS4KCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPidsJyAtIExlbmd0aCBjaGFuZ2luZzwvbGk+CgkJICogICAgIDxsaT4nZicgLSBGaWx0ZXJpbmcgaW5wdXQ8L2xpPgoJCSAqICAgICA8bGk+J3QnIC0gVGhlIHRhYmxlITwvbGk+CgkJICogICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgIDxsaT4ncCcgLSBQYWdpbmF0aW9uPC9saT4KCQkgKiAgICAgPGxpPidyJyAtIHBSb2Nlc3Npbmc8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYWFuRmVhdHVyZXMiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBkYXRhIGluZm9ybWF0aW9uIC0gc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9Sb3d9IGZvciBkZXRhaWxlZAoJCSAqIGluZm9ybWF0aW9uLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0RhdGEiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBpbmRleGVzIHdoaWNoIGFyZSBpbiB0aGUgY3VycmVudCBkaXNwbGF5IChhZnRlciBmaWx0ZXJpbmcgZXRjKQoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhaURpc3BsYXkiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBpbmRleGVzIGZvciBkaXNwbGF5IC0gbm8gZmlsdGVyaW5nCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFpRGlzcGxheU1hc3RlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IGVhY2ggY29sdW1uIHRoYXQgaXMgaW4gdXNlCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvQ29sdW1ucyI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSdzIGhlYWRlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0hlYWRlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSdzIGZvb3RlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Zvb3RlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFNlYXJjaCBkYXRhIGFycmF5IGZvciByZWd1bGFyIGV4cHJlc3Npb24gc2VhcmNoaW5nCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFzRGF0YVNlYXJjaCI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIHRoZSBhcHBsaWVkIGdsb2JhbCBzZWFyY2ggaW5mb3JtYXRpb24gaW4gY2FzZSB3ZSB3YW50IHRvIGZvcmNlIGEgCgkJICogcmVzZWFyY2ggb3IgY29tcGFyZSB0aGUgb2xkIHNlYXJjaCB0byBhIG5ldyBvbmUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBleHRlbmRzIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaAoJCSAqLwoJCSJvUHJldmlvdXNTZWFyY2giOiB7fSwKCQkKCQkvKioKCQkgKiBTdG9yZSB0aGUgYXBwbGllZCBzZWFyY2ggZm9yIGVhY2ggY29sdW1uIC0gc2VlIAoJCSAqIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2h9IGZvciB0aGUgZm9ybWF0IHRoYXQgaXMgdXNlZCBmb3IgdGhlCgkJICogZmlsdGVyaW5nIGluZm9ybWF0aW9uIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9QcmVTZWFyY2hDb2xzIjogW10sCgkJCgkJLyoqCgkJICogU29ydGluZyB0aGF0IGlzIGFwcGxpZWQgdG8gdGhlIHRhYmxlLiBOb3RlIHRoYXQgdGhlIGlubmVyIGFycmF5cyBhcmUKCQkgKiB1c2VkIGluIHRoZSBmb2xsb3dpbmcgbWFubmVyOgoJCSAqIDx1bD4KCQkgKiAgIDxsaT5JbmRleCAwIC0gY29sdW1uIG51bWJlcjwvbGk+CgkJICogICA8bGk+SW5kZXggMSAtIGN1cnJlbnQgc29ydGluZyBkaXJlY3Rpb248L2xpPgoJCSAqICAgPGxpPkluZGV4IDIgLSBpbmRleCBvZiBhc1NvcnRpbmcgZm9yIHRoaXMgY29sdW1uPC9saT4KCQkgKiA8L3VsPgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQHRvZG8gVGhlc2UgaW5uZXIgYXJyYXlzIHNob3VsZCByZWFsbHkgYmUgb2JqZWN0cwoJCSAqLwoJCSJhYVNvcnRpbmciOiBudWxsLAoJCQoJCS8qKgoJCSAqIFNvcnRpbmcgdGhhdCBpcyBhbHdheXMgYXBwbGllZCB0byB0aGUgdGFibGUgKGkuZS4gcHJlZml4ZWQgaW4gZnJvbnQgb2YKCQkgKiBhYVNvcnRpbmcpLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXl8bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzc2VzIHRvIHVzZSBmb3IgdGhlIHN0cmlwaW5nIG9mIGEgdGFibGUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc1N0cmlwZUNsYXNzZXMiOiBudWxsLAoJCQoJCS8qKgoJCSAqIElmIHJlc3RvcmluZyBhIHRhYmxlIC0gd2Ugc2hvdWxkIHJlc3RvcmUgaXRzIHN0cmlwaW5nIGNsYXNzZXMgYXMgd2VsbAoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc0Rlc3Ryb3lTdHJpcGVzIjogW10sCgkJCgkJLyoqCgkJICogSWYgcmVzdG9yaW5nIGEgdGFibGUgLSB3ZSBzaG91bGQgcmVzdG9yZSBpdHMgd2lkdGggCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJInNEZXN0cm95V2lkdGgiOiAwLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBhcnJheSBmb3IgZXZlcnkgdGltZSBhIHJvdyBpcyBpbnNlcnRlZCAoaS5lLiBvbiBhIGRyYXcpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1Jvd0NhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciB0aGUgaGVhZGVyIG9uIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9IZWFkZXJDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9uIGZvciB0aGUgZm9vdGVyIG9uIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Gb290ZXJDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgZHJhdyBjYWxsYmFjayBmdW5jdGlvbnMKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9EcmF3Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHJvdyBjcmVhdGVkIGZ1bmN0aW9uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUm93Q3JlYXRlZENhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciBqdXN0IGJlZm9yZSB0aGUgdGFibGUgaXMgcmVkcmF3bi4gQSByZXR1cm4gb2YgCgkJICogZmFsc2Ugd2lsbCBiZSB1c2VkIHRvIGNhbmNlbCB0aGUgZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9QcmVEcmF3Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgZm9yIHdoZW4gdGhlIHRhYmxlIGhhcyBiZWVuIGluaXRpYWxpc2VkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0luaXRDb21wbGV0ZSI6IFtdLAoJCgkJCgkJLyoqCgkJICogQ2FsbGJhY2tzIGZvciBtb2RpZnlpbmcgdGhlIHNldHRpbmdzIHRvIGJlIHN0b3JlZCBmb3Igc3RhdGUgc2F2aW5nLCBwcmlvciB0bwoJCSAqIHNhdmluZyBzdGF0ZS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZVNhdmVQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG1vZGlmeWluZyB0aGUgc2V0dGluZ3MgdGhhdCBoYXZlIGJlZW4gc3RvcmVkIGZvciBzdGF0ZSBzYXZpbmcKCQkgKiBwcmlvciB0byB1c2luZyB0aGUgc3RvcmVkIHZhbHVlcyB0byByZXN0b3JlIHRoZSBzdGF0ZS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZUxvYWRQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG9wZXJhdGluZyBvbiB0aGUgc2V0dGluZ3Mgb2JqZWN0IG9uY2UgdGhlIHNhdmVkIHN0YXRlIGhhcyBiZWVuCgkJICogbG9hZGVkCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVMb2FkZWQiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWNoZSB0aGUgdGFibGUgSUQgZm9yIHF1aWNrIGFjY2VzcwoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqLwoJCSJzVGFibGVJZCI6ICIiLAoJCQoJCS8qKgoJCSAqIFRoZSBUQUJMRSBub2RlIGZvciB0aGUgbWFpbiB0YWJsZQoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQZXJtYW5lbnQgcmVmIHRvIHRoZSB0aGVhZCBlbGVtZW50CgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVEhlYWQiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFBlcm1hbmVudCByZWYgdG8gdGhlIHRmb290IGVsZW1lbnQgLSBpZiBpdCBleGlzdHMKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5URm9vdCI6IG51bGwsCgkJCgkJLyoqCgkJICogUGVybWFuZW50IHJlZiB0byB0aGUgdGJvZHkgZWxlbWVudAoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRCb2R5IjogbnVsbCwKCQkKCQkvKioKCQkgKiBDYWNoZSB0aGUgd3JhcHBlciBub2RlIChjb250YWlucyBhbGwgRGF0YVRhYmxlcyBjb250cm9sbGVkIGVsZW1lbnRzKQoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRhYmxlV3JhcHBlciI6IG51bGwsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgd2hlbiB1c2luZyBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRoZSBsb2FkaW5nIG9mIGRhdGEgCgkJICogc2hvdWxkIGJlIGRlZmVycmVkIHVudGlsIHRoZSBzZWNvbmQgZHJhdy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkRlZmVyTG9hZGluZyI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIGFsbCByZXF1aXJlZCBpbmZvcm1hdGlvbiBoYXMgYmVlbiByZWFkIGluCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkluaXRpYWxpc2VkIjogZmFsc2UsCgkJCgkJLyoqCgkJICogSW5mb3JtYXRpb24gYWJvdXQgb3BlbiByb3dzLiBFYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkgaGFzIHRoZSBwYXJhbWV0ZXJzCgkJICogJ25UcicgYW5kICduUGFyZW50JwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb09wZW5Sb3dzIjogW10sCgkJCgkJLyoqCgkJICogRGljdGF0ZSB0aGUgcG9zaXRpb25pbmcgb2YgRGF0YVRhYmxlcycgY29udHJvbCBlbGVtZW50cyAtIHNlZQoJCSAqIHtAbGluayBEYXRhVGFibGUubW9kZWwub0luaXQuc0RvbX0uCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzRG9tIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGljaCB0eXBlIG9mIHBhZ2luYXRpb24gc2hvdWxkIGJlIHVzZWQuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcgCgkJICogIEBkZWZhdWx0IHR3b19idXR0b24KCQkgKi8KCQkic1BhZ2luYXRpb25UeXBlIjogInR3b19idXR0b24iLAoJCQoJCS8qKgoJCSAqIFRoZSBjb29raWUgZHVyYXRpb24gKGZvciBiU3RhdGVTYXZlKSBpbiBzZWNvbmRzLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiaUNvb2tpZUR1cmF0aW9uIjogMCwKCQkKCQkvKioKCQkgKiBUaGUgY29va2llIG5hbWUgcHJlZml4LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic0Nvb2tpZVByZWZpeCI6ICIiLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9uIGZvciBjb29raWUgY3JlYXRpb24uCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuQ29va2llQ2FsbGJhY2siOiBudWxsLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igc3RhdGUgc2F2aW5nLiBFYWNoIGFycmF5IGVsZW1lbnQgaXMgYW4gCgkJICogb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+ZnVuY3Rpb246Zm4gLSBmdW5jdGlvbiB0byBjYWxsLiBUYWtlcyB0d28gcGFyYW1ldGVycywgb1NldHRpbmdzCgkJICogICAgICAgYW5kIHRoZSBKU09OIHN0cmluZyB0byBzYXZlIHRoYXQgaGFzIGJlZW4gdGh1cyBmYXIgY3JlYXRlZC4gUmV0dXJucwoJCSAqICAgICAgIGEgSlNPTiBzdHJpbmcgdG8gYmUgaW5zZXJ0ZWQgaW50byBhIGpzb24gb2JqZWN0IAoJCSAqICAgICAgIChpLmUuICcicGFyYW0iOiBbIDAsIDEsIDJdJyk8L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nOnNOYW1lIC0gbmFtZSBvZiBjYWxsYmFjazwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlU2F2ZSI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igc3RhdGUgbG9hZGluZy4gRWFjaCBhcnJheSBlbGVtZW50IGlzIGFuIAoJCSAqIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmZ1bmN0aW9uOmZuIC0gZnVuY3Rpb24gdG8gY2FsbC4gVGFrZXMgdHdvIHBhcmFtZXRlcnMsIG9TZXR0aW5ncyAKCQkgKiAgICAgICBhbmQgdGhlIG9iamVjdCBzdG9yZWQuIE1heSByZXR1cm4gZmFsc2UgdG8gY2FuY2VsIHN0YXRlIGxvYWRpbmc8L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nOnNOYW1lIC0gbmFtZSBvZiBjYWxsYmFjazwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlTG9hZCI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0YXRlIHRoYXQgd2FzIGxvYWRlZCBmcm9tIHRoZSBjb29raWUuIFVzZWZ1bCBmb3IgYmFjayByZWZlcmVuY2UKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0xvYWRlZFN0YXRlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBTb3VyY2UgdXJsIGZvciBBSkFYIGRhdGEgZm9yIHRoZSB0YWJsZS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNBamF4U291cmNlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQcm9wZXJ0eSBmcm9tIGEgZ2l2ZW4gb2JqZWN0IGZyb20gd2hpY2ggdG8gcmVhZCB0aGUgdGFibGUgZGF0YSBmcm9tLiBUaGlzCgkJICogY2FuIGJlIGFuIGVtcHR5IHN0cmluZyAod2hlbiBub3Qgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyksIGluIHdoaWNoIGNhc2UgCgkJICogaXQgaXMgIGFzc3VtZWQgYW4gYW4gYXJyYXkgaXMgZ2l2ZW4gZGlyZWN0bHkuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKi8KCQkic0FqYXhEYXRhUHJvcCI6IG51bGwsCgkJCgkJLyoqCgkJICogTm90ZSBpZiBkcmF3IHNob3VsZCBiZSBibG9ja2VkIHdoaWxlIGdldHRpbmcgZGF0YQoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYkFqYXhEYXRhR2V0IjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBUaGUgbGFzdCBqUXVlcnkgWEhSIG9iamVjdCB0aGF0IHdhcyB1c2VkIGZvciBzZXJ2ZXItc2lkZSBkYXRhIGdhdGhlcmluZy4gCgkJICogVGhpcyBjYW4gYmUgdXNlZCBmb3Igd29ya2luZyB3aXRoIHRoZSBYSFIgaW5mb3JtYXRpb24gaW4gb25lIG9mIHRoZSAKCQkgKiBjYWxsYmFja3MKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkianFYSFIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIGdldCB0aGUgc2VydmVyLXNpZGUgZGF0YS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuU2VydmVyRGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb25zIHdoaWNoIGFyZSBjYWxsZWQgcHJpb3IgdG8gc2VuZGluZyBhbiBBamF4IHJlcXVlc3Qgc28gZXh0cmEgCgkJICogcGFyYW1ldGVycyBjYW4gZWFzaWx5IGJlIHNlbnQgdG8gdGhlIHNlcnZlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1NlcnZlclBhcmFtcyI6IFtdLAoJCQoJCS8qKgoJCSAqIFNlbmQgdGhlIFhIUiBIVFRQIG1ldGhvZCAtIEdFVCBvciBQT1NUIChjb3VsZCBiZSBQVVQgb3IgREVMRVRFIGlmIAoJCSAqIHJlcXVpcmVkKS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzU2VydmVyTWV0aG9kIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGb3JtYXQgbnVtYmVycyBmb3IgZGlzcGxheS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuRm9ybWF0TnVtYmVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBMaXN0IG9mIG9wdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCBmb3IgdGhlIHVzZXIgc2VsZWN0YWJsZSBsZW5ndGggbWVudS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFMZW5ndGhNZW51IjogbnVsbCwKCQkKCQkvKioKCQkgKiBDb3VudGVyIGZvciB0aGUgZHJhd3MgdGhhdCB0aGUgdGFibGUgZG9lcy4gQWxzbyB1c2VkIGFzIGEgdHJhY2tlciBmb3IKCQkgKiBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlEcmF3IjogMCwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiBhIHJlZHJhdyBpcyBiZWluZyBkb25lIC0gdXNlZnVsIGZvciBBamF4CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkRyYXdpbmciOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBEcmF3IGluZGV4IChpRHJhdykgb2YgdGhlIGxhc3QgZXJyb3Igd2hlbiBwYXJzaW5nIHRoZSByZXR1cm5lZCBkYXRhCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAtMQoJCSAqLwoJCSJpRHJhd0Vycm9yIjogLTEsCgkJCgkJLyoqCgkJICogUGFnaW5nIGRpc3BsYXkgbGVuZ3RoCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqLwoJCSJfaURpc3BsYXlMZW5ndGgiOiAxMCwKCQoJCS8qKgoJCSAqIFBhZ2luZyBzdGFydCBwb2ludCAtIGFpRGlzcGxheSBpbmRleAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJfaURpc3BsYXlTdGFydCI6IDAsCgkKCQkvKioKCQkgKiBQYWdpbmcgZW5kIHBvaW50IC0gYWlEaXNwbGF5IGluZGV4LiBVc2UgZm5EaXNwbGF5RW5kIHJhdGhlciB0aGFuCgkJICogdGhpcyBwcm9wZXJ0eSB0byBnZXQgdGhlIGVuZCBwb2ludAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMTAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lEaXNwbGF5RW5kIjogMTAsCgkJCgkJLyoqCgkJICogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyAtIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSByZXN1bHQgc2V0CgkJICogKGkuZS4gYmVmb3JlIGZpbHRlcmluZyksIFVzZSBmblJlY29yZHNUb3RhbCByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJlZ2FyZGxlc3Mgb2YKCQkgKiB0aGUgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBzZXR0aW5nLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfaVJlY29yZHNUb3RhbCI6IDAsCgkKCQkvKioKCQkgKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGN1cnJlbnQgZGlzcGxheSBzZXQKCQkgKiAoaS5lLiBhZnRlciBmaWx0ZXJpbmcpLiBVc2UgZm5SZWNvcmRzRGlzcGxheSByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJlZ2FyZGxlc3Mgb2YKCQkgKiB0aGUgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBzZXR0aW5nLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lSZWNvcmRzRGlzcGxheSI6IDAsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiBqUXVlcnkgVUkgbWFya2luZyBhbmQgY2xhc3NlcyBzaG91bGQgYmUgdXNlZC4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYkpVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzZXMgdG8gdXNlIGZvciB0aGUgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICovCgkJIm9DbGFzc2VzIjoge30sCgkJCgkJLyoqCgkJICogRmxhZyBhdHRhY2hlZCB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IHNvIHlvdSBjYW4gY2hlY2sgaW4gdGhlIGRyYXcgCgkJICogY2FsbGJhY2sgaWYgZmlsdGVyaW5nIGhhcyBiZWVuIGRvbmUgaW4gdGhlIGRyYXcuIERlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJICogZXZlbnRzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImJGaWx0ZXJlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEZsYWcgYXR0YWNoZWQgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBzbyB5b3UgY2FuIGNoZWNrIGluIHRoZSBkcmF3IAoJCSAqIGNhbGxiYWNrIGlmIHNvcnRpbmcgaGFzIGJlZW4gZG9uZSBpbiB0aGUgZHJhdy4gRGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YKCQkgKiBldmVudHMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlNvcnRlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIHRoYXQgaWYgbXVsdGlwbGUgcm93cyBhcmUgaW4gdGhlIGhlYWRlciBhbmQgdGhlcmUgaXMgbW9yZSB0aGFuIAoJCSAqIG9uZSB1bmlxdWUgY2VsbCBwZXIgY29sdW1uLCBpZiB0aGUgdG9wIG9uZSAodHJ1ZSkgb3IgYm90dG9tIG9uZSAoZmFsc2UpIAoJCSAqIHNob3VsZCBiZSB1c2VkIGZvciBzb3J0aW5nIC8gdGl0bGUgYnkgRGF0YVRhYmxlcy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNvcnRDZWxsc1RvcCI6IG51bGwsCgkJCgkJLyoqCgkJICogSW5pdGlhbGlzYXRpb24gb2JqZWN0IHRoYXQgaXMgdXNlZCBmb3IgdGhlIHRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm9Jbml0IjogbnVsbCwKCQkKCQkvKioKCQkgKiBEZXN0cm95IGNhbGxiYWNrIGZ1bmN0aW9ucyAtIGZvciBwbHVnLWlucyB0byBhdHRhY2ggdGhlbXNlbHZlcyB0byB0aGUKCQkgKiBkZXN0cm95IHNvIHRoZXkgY2FuIGNsZWFuIHVwIG1hcmt1cCBhbmQgZXZlbnRzLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Rlc3Ryb3lDYWxsYmFjayI6IFtdLAoJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCByZWNvcmQgc2V0LCBiZWZvcmUgZmlsdGVyaW5nCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuUmVjb3Jkc1RvdGFsIjogZnVuY3Rpb24gKCkKCQl7CgkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKSB7CgkJCQlyZXR1cm4gcGFyc2VJbnQodGhpcy5faVJlY29yZHNUb3RhbCwgMTApOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCByZWNvcmQgc2V0LCBhZnRlciBmaWx0ZXJpbmcKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5SZWNvcmRzRGlzcGxheSI6IGZ1bmN0aW9uICgpCgkJewoJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkgewoJCQkJcmV0dXJuIHBhcnNlSW50KHRoaXMuX2lSZWNvcmRzRGlzcGxheSwgMTApOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuYWlEaXNwbGF5Lmxlbmd0aDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogU2V0IHRoZSBkaXNwbGF5IGVuZCBwb2ludCAtIGFpRGlzcGxheSBpbmRleAoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAdG9kbyBTaG91bGQgZG8gYXdheSB3aXRoIF9pRGlzcGxheUVuZCBhbmQgY2FsY3VsYXRlIGl0IG9uLXRoZS1mbHkgaGVyZQoJCSAqLwoJCSJmbkRpc3BsYXlFbmQiOiBmdW5jdGlvbiAoKQoJCXsKCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApIHsKCQkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlBhZ2luYXRlID09PSBmYWxzZSB8fCB0aGlzLl9pRGlzcGxheUxlbmd0aCA9PSAtMSApIHsKCQkJCQlyZXR1cm4gdGhpcy5faURpc3BsYXlTdGFydCt0aGlzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiBNYXRoLm1pbiggdGhpcy5faURpc3BsYXlTdGFydCt0aGlzLl9pRGlzcGxheUxlbmd0aCwgCgkJCQkJCXRoaXMuX2lSZWNvcmRzRGlzcGxheSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuX2lEaXNwbGF5RW5kOwoJCQl9CgkJfSwKCQkKCQkvKioKCQkgKiBUaGUgRGF0YVRhYmxlcyBvYmplY3QgZm9yIHRoaXMgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0luc3RhbmNlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBVbmlxdWUgaWRlbnRpZmllciBmb3IgZWFjaCBpbnN0YW5jZSBvZiB0aGUgRGF0YVRhYmxlcyBvYmplY3QuIElmIHRoZXJlCgkJICogaXMgYW4gSUQgb24gdGhlIHRhYmxlIG5vZGUsIHRoZW4gaXQgdGFrZXMgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGFuCgkJICogaW5jcmVtZW50aW5nIGludGVybmFsIGNvdW50ZXIgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0luc3RhbmNlIjogbnVsbCwKCQoJCS8qKgoJCSAqIHRhYmluZGV4IGF0dHJpYnV0ZSB2YWx1ZSB0aGF0IGlzIGFkZGVkIHRvIERhdGFUYWJsZXMgY29udHJvbCBlbGVtZW50cywgYWxsb3dpbmcKCQkgKiBrZXlib2FyZCBuYXZpZ2F0aW9uIG9mIHRoZSB0YWJsZSBhbmQgaXRzIGNvbnRyb2xzLgoJCSAqLwoJCSJpVGFiSW5kZXgiOiAwCgl9OwoKCS8qKgoJICogRXh0ZW5zaW9uIG9iamVjdCBmb3IgRGF0YVRhYmxlcyB0aGF0IGlzIHVzZWQgdG8gcHJvdmlkZSBhbGwgZXh0ZW5zaW9uIG9wdGlvbnMuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlLmV4dDwvaT4gb2JqZWN0IGlzIGF2YWlsYWJsZSB0aHJvdWdoCgkgKiA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlLmV4dDwvaT4gd2hlcmUgaXQgbWF5IGJlIGFjY2Vzc2VkIGFuZCBtYW5pcHVsYXRlZC4gSXQgaXMKCSAqIGFsc28gYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlRXh0PC9pPiBmb3IgaGlzdG9yaWMgcmVhc29ucy4KCSAqICBAbmFtZXNwYWNlCgkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5leHQKCSAqLwoJRGF0YVRhYmxlLmV4dCA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5leHQgKTsKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1N0ZENsYXNzZXMsIHsKCQkic1RhYmxlIjogImRhdGFUYWJsZSIsCgkKCQkvKiBUd28gYnV0dG9ucyBidXR0b25zICovCgkJInNQYWdlUHJldkVuYWJsZWQiOiAicGFnaW5hdGVfZW5hYmxlZF9wcmV2aW91cyIsCgkJInNQYWdlUHJldkRpc2FibGVkIjogInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIiwKCQkic1BhZ2VOZXh0RW5hYmxlZCI6ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiLAoJCSJzUGFnZU5leHREaXNhYmxlZCI6ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IiwKCQkic1BhZ2VKVUlOZXh0IjogIiIsCgkJInNQYWdlSlVJUHJldiI6ICIiLAoJCQoJCS8qIEZ1bGwgbnVtYmVycyBwYWdpbmcgYnV0dG9ucyAqLwoJCSJzUGFnZUJ1dHRvbiI6ICJwYWdpbmF0ZV9idXR0b24iLAoJCSJzUGFnZUJ1dHRvbkFjdGl2ZSI6ICJwYWdpbmF0ZV9hY3RpdmUiLAoJCSJzUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIjogInBhZ2luYXRlX2J1dHRvbiBwYWdpbmF0ZV9idXR0b25fZGlzYWJsZWQiLAoJCSJzUGFnZUZpcnN0IjogImZpcnN0IiwKCQkic1BhZ2VQcmV2aW91cyI6ICJwcmV2aW91cyIsCgkJInNQYWdlTmV4dCI6ICJuZXh0IiwKCQkic1BhZ2VMYXN0IjogImxhc3QiLAoJCQoJCS8qIFN0cmlwaW5nIGNsYXNzZXMgKi8KCQkic1N0cmlwZU9kZCI6ICJvZGQiLAoJCSJzU3RyaXBlRXZlbiI6ICJldmVuIiwKCQkKCQkvKiBFbXB0eSByb3cgKi8KCQkic1Jvd0VtcHR5IjogImRhdGFUYWJsZXNfZW1wdHkiLAoJCQoJCS8qIEZlYXR1cmVzICovCgkJInNXcmFwcGVyIjogImRhdGFUYWJsZXNfd3JhcHBlciIsCgkJInNGaWx0ZXIiOiAiZGF0YVRhYmxlc19maWx0ZXIiLAoJCSJzSW5mbyI6ICJkYXRhVGFibGVzX2luZm8iLAoJCSJzUGFnaW5nIjogImRhdGFUYWJsZXNfcGFnaW5hdGUgcGFnaW5nXyIsIC8qIE5vdGUgdGhhdCB0aGUgdHlwZSBpcyBwb3N0Zml4ZWQgKi8KCQkic0xlbmd0aCI6ICJkYXRhVGFibGVzX2xlbmd0aCIsCgkJInNQcm9jZXNzaW5nIjogImRhdGFUYWJsZXNfcHJvY2Vzc2luZyIsCgkJCgkJLyogU29ydGluZyAqLwoJCSJzU29ydEFzYyI6ICJzb3J0aW5nX2FzYyIsCgkJInNTb3J0RGVzYyI6ICJzb3J0aW5nX2Rlc2MiLAoJCSJzU29ydGFibGUiOiAic29ydGluZyIsIC8qIFNvcnRhYmxlIGluIGJvdGggZGlyZWN0aW9ucyAqLwoJCSJzU29ydGFibGVBc2MiOiAic29ydGluZ19hc2NfZGlzYWJsZWQiLAoJCSJzU29ydGFibGVEZXNjIjogInNvcnRpbmdfZGVzY19kaXNhYmxlZCIsCgkJInNTb3J0YWJsZU5vbmUiOiAic29ydGluZ19kaXNhYmxlZCIsCgkJInNTb3J0Q29sdW1uIjogInNvcnRpbmdfIiwgLyogTm90ZSB0aGF0IGFuIGludCBpcyBwb3N0Zml4ZWQgZm9yIHRoZSBzb3J0aW5nIG9yZGVyICovCgkJInNTb3J0SlVJQXNjIjogIiIsCgkJInNTb3J0SlVJRGVzYyI6ICIiLAoJCSJzU29ydEpVSSI6ICIiLAoJCSJzU29ydEpVSUFzY0FsbG93ZWQiOiAiIiwKCQkic1NvcnRKVUlEZXNjQWxsb3dlZCI6ICIiLAoJCSJzU29ydEpVSVdyYXBwZXIiOiAiIiwKCQkic1NvcnRJY29uIjogIiIsCgkJCgkJLyogU2Nyb2xsaW5nICovCgkJInNTY3JvbGxXcmFwcGVyIjogImRhdGFUYWJsZXNfc2Nyb2xsIiwKCQkic1Njcm9sbEhlYWQiOiAiZGF0YVRhYmxlc19zY3JvbGxIZWFkIiwKCQkic1Njcm9sbEhlYWRJbm5lciI6ICJkYXRhVGFibGVzX3Njcm9sbEhlYWRJbm5lciIsCgkJInNTY3JvbGxCb2R5IjogImRhdGFUYWJsZXNfc2Nyb2xsQm9keSIsCgkJInNTY3JvbGxGb290IjogImRhdGFUYWJsZXNfc2Nyb2xsRm9vdCIsCgkJInNTY3JvbGxGb290SW5uZXIiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290SW5uZXIiLAoJCQoJCS8qIE1pc2MgKi8KCQkic0Zvb3RlclRIIjogIiIKCX0gKTsKCQoJCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vSlVJQ2xhc3NlcywgRGF0YVRhYmxlLmV4dC5vU3RkQ2xhc3NlcywgewoJCS8qIFR3byBidXR0b25zIGJ1dHRvbnMgKi8KCQkic1BhZ2VQcmV2RW5hYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWxlZnQiLAoJCSJzUGFnZVByZXZEaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWxlZnQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZU5leHRFbmFibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItcmlnaHQiLAoJCSJzUGFnZU5leHREaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXJpZ2h0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VKVUlOZXh0IjogInVpLWljb24gdWktaWNvbi1jaXJjbGUtYXJyb3ctZSIsCgkJInNQYWdlSlVJUHJldiI6ICJ1aS1pY29uIHVpLWljb24tY2lyY2xlLWFycm93LXciLAoJCQoJCS8qIEZ1bGwgbnVtYmVycyBwYWdpbmcgYnV0dG9ucyAqLwoJCSJzUGFnZUJ1dHRvbiI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzUGFnZUJ1dHRvbkFjdGl2ZSI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlRmlyc3QiOiAiZmlyc3QgdWktY29ybmVyLXRsIHVpLWNvcm5lci1ibCIsCgkJInNQYWdlTGFzdCI6ICJsYXN0IHVpLWNvcm5lci10ciB1aS1jb3JuZXItYnIiLAoJCQoJCS8qIEZlYXR1cmVzICovCgkJInNQYWdpbmciOiAiZGF0YVRhYmxlc19wYWdpbmF0ZSBmZy1idXR0b25zZXQgdWktYnV0dG9uc2V0IGZnLWJ1dHRvbnNldC1tdWx0aSAiKwoJCQkidWktYnV0dG9uc2V0LW11bHRpIHBhZ2luZ18iLCAvKiBOb3RlIHRoYXQgdGhlIHR5cGUgaXMgcG9zdGZpeGVkICovCgkJCgkJLyogU29ydGluZyAqLwoJCSJzU29ydEFzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnREZXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGUiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZUFzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlRGVzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlTm9uZSI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRKVUlBc2MiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi10cmlhbmdsZS0xLW4iLAoJCSJzU29ydEpVSURlc2MiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi10cmlhbmdsZS0xLXMiLAoJCSJzU29ydEpVSSI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTItbi1zIiwKCQkic1NvcnRKVUlBc2NBbGxvd2VkIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tY2FyYXQtMS1uIiwKCQkic1NvcnRKVUlEZXNjQWxsb3dlZCI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTEtcyIsCgkJInNTb3J0SlVJV3JhcHBlciI6ICJEYXRhVGFibGVzX3NvcnRfd3JhcHBlciIsCgkJInNTb3J0SWNvbiI6ICJEYXRhVGFibGVzX3NvcnRfaWNvbiIsCgkJCgkJLyogU2Nyb2xsaW5nICovCgkJInNTY3JvbGxIZWFkIjogImRhdGFUYWJsZXNfc2Nyb2xsSGVhZCB1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1Njcm9sbEZvb3QiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290IHVpLXN0YXRlLWRlZmF1bHQiLAoJCQoJCS8qIE1pc2MgKi8KCQkic0Zvb3RlclRIIjogInVpLXN0YXRlLWRlZmF1bHQiCgl9ICk7CgkKCQoJLyoKCSAqIFZhcmlhYmxlOiBvUGFnaW5hdGlvbgoJICogUHVycG9zZTogIAoJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQKCSAqLwoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1BhZ2luYXRpb24sIHsKCQkvKgoJCSAqIFZhcmlhYmxlOiB0d29fYnV0dG9uCgkJICogUHVycG9zZTogIFN0YW5kYXJkIHR3byBidXR0b24gKGZvcndhcmQvYmFjaykgcGFnaW5hdGlvbgoJCSAqIFNjb3BlOiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uCgkJICovCgkJInR3b19idXR0b24iOiB7CgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi50d29fYnV0dG9uLmZuSW5pdAoJCQkgKiBQdXJwb3NlOiAgSW5pdGlhbGlzZSBkb20gZWxlbWVudHMgcmVxdWlyZWQgZm9yIHBhZ2luYXRpb24gd2l0aCBmb3J3YXJkL2JhY2sgYnV0dG9ucyBvbmx5CgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIG5vZGU6blBhZ2luZyAtIHRoZSBESVYgd2hpY2ggY29udGFpbnMgdGhpcyBwYWdpbmF0aW9uIGNvbnRyb2wKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB3aGljaCBtdXN0IGJlIGNhbGxlZCBvbiB1cGRhdGUKCQkJICovCgkJCSJmbkluaXQiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgblBhZ2luZywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQl2YXIgb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZTsKCQkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCXZhciBmbkNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICggZSApIHsKCQkJCQlpZiAoIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLmFjdGlvbiApICkKCQkJCQl7CgkJCQkJCWZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQl9OwoJCgkJCQl2YXIgc0FwcGVuZCA9ICghb1NldHRpbmdzLmJKVUkpID8KCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj4nK29MYW5nLnNQcmV2aW91cysnPC9hPicrCgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+JytvTGFuZy5zTmV4dCsnPC9hPicKCQkJCQk6CgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZVByZXZEaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+PHNwYW4gY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlSlVJUHJldisnIj48L3NwYW4+PC9hPicrCgkJCQkJJzxhIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCsnIiB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIHJvbGU9ImJ1dHRvbiI+PHNwYW4gY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlSlVJTmV4dCsnIj48L3NwYW4+PC9hPic7CgkJCQkkKG5QYWdpbmcpLmFwcGVuZCggc0FwcGVuZCApOwoJCQkJCgkJCQl2YXIgZWxzID0gJCgnYScsIG5QYWdpbmcpOwoJCQkJdmFyIG5QcmV2aW91cyA9IGVsc1swXSwKCQkJCQluTmV4dCA9IGVsc1sxXTsKCQkJCQoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggblByZXZpb3VzLCB7YWN0aW9uOiAicHJldmlvdXMifSwgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5OZXh0LCAgICAge2FjdGlvbjogIm5leHQifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQkKCQkJCS8qIElEIHRoZSBmaXJzdCBlbGVtZW50cyBvbmx5ICovCgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJblBhZ2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3BhZ2luYXRlJzsKCQkJCQluUHJldmlvdXMuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19wcmV2aW91cyc7CgkJCQkJbk5leHQuaWQgPSBvU2V0dGluZ3Muc1RhYmxlSWQrJ19uZXh0JzsKCQoJCQkJCW5QcmV2aW91cy5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBvU2V0dGluZ3Muc1RhYmxlSWQpOwoJCQkJCW5OZXh0LnNldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24udHdvX2J1dHRvbi5mblVwZGF0ZQoJCQkgKiBQdXJwb3NlOiAgVXBkYXRlIHRoZSB0d28gYnV0dG9uIHBhZ2luYXRpb24gYXQgdGhlIGVuZCBvZiB0aGUgZHJhdwoJCQkgKiBSZXR1cm5zOiAgLQoJCQkgKiBJbnB1dHM6ICAgb2JqZWN0Om9TZXR0aW5ncyAtIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJCSAqICAgICAgICAgICBmdW5jdGlvbjpmbkNhbGxiYWNrRHJhdyAtIGRyYXcgZnVuY3Rpb24gdG8gY2FsbCBvbiBwYWdlIGNoYW5nZQoJCQkgKi8KCQkJImZuVXBkYXRlIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGZuQ2FsbGJhY2tEcmF3ICkKCQkJewoJCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW5baV0uY2hpbGROb2Rlcy5sZW5ndGggIT09IDAgKQoJCQkJCXsKCQkJCQkJYW5baV0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWUgPSAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApID8gCgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZVByZXZEaXNhYmxlZCA6IG9DbGFzc2VzLnNQYWdlUHJldkVuYWJsZWQ7CgkJCQkJCQoJCQkJCQlhbltpXS5jaGlsZE5vZGVzWzFdLmNsYXNzTmFtZSA9ICggb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpID09IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKSA/IAoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VOZXh0RGlzYWJsZWQgOiBvQ2xhc3Nlcy5zUGFnZU5leHRFbmFibGVkOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0sCgkJCgkJCgkJLyoKCQkgKiBWYXJpYWJsZTogaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzCgkJICogUHVycG9zZTogIENoYW5nZSB0aGUgbnVtYmVyIG9mIHBhZ2VzIHdoaWNoIGNhbiBiZSBzZWVuCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkiaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzIjogNSwKCQkKCQkvKgoJCSAqIFZhcmlhYmxlOiBmdWxsX251bWJlcnMKCQkgKiBQdXJwb3NlOiAgRnVsbCBudW1iZXJzIHBhZ2luYXRpb24KCQkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCSJmdWxsX251bWJlcnMiOiB7CgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi5mdWxsX251bWJlcnMuZm5Jbml0CgkJCSAqIFB1cnBvc2U6ICBJbml0aWFsaXNlIGRvbSBlbGVtZW50cyByZXF1aXJlZCBmb3IgcGFnaW5hdGlvbiB3aXRoIGEgbGlzdCBvZiB0aGUgcGFnZXMKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgbm9kZTpuUGFnaW5nIC0gdGhlIERJViB3aGljaCBjb250YWlucyB0aGlzIHBhZ2luYXRpb24gY29udHJvbAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIG9uIHVwZGF0ZQoJCQkgKi8KCQkJImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGZuQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKCBlICkgewoJCQkJCWlmICggb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEuYWN0aW9uICkgKQoJCQkJCXsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCX07CgkKCQkJCSQoblBhZ2luZykuYXBwZW5kKAoJCQkJCSc8YSAgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VGaXJzdCsnIj4nK29MYW5nLnNGaXJzdCsnPC9hPicrCgkJCQkJJzxhICB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZVByZXZpb3VzKyciPicrb0xhbmcuc1ByZXZpb3VzKyc8L2E+JysKCQkJCQknPHNwYW4+PC9zcGFuPicrCgkJCQkJJzxhIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlTmV4dCsnIj4nK29MYW5nLnNOZXh0Kyc8L2E+JysKCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VMYXN0KyciPicrb0xhbmcuc0xhc3QrJzwvYT4nCgkJCQkpOwoJCQkJdmFyIGVscyA9ICQoJ2EnLCBuUGFnaW5nKTsKCQkJCXZhciBuRmlyc3QgPSBlbHNbMF0sCgkJCQkJblByZXYgPSBlbHNbMV0sCgkJCQkJbk5leHQgPSBlbHNbMl0sCgkJCQkJbkxhc3QgPSBlbHNbM107CgkJCQkKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5GaXJzdCwge2FjdGlvbjogImZpcnN0In0sICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuUHJldiwgIHthY3Rpb246ICJwcmV2aW91cyJ9LCBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbk5leHQsICB7YWN0aW9uOiAibmV4dCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5MYXN0LCAge2FjdGlvbjogImxhc3QifSwgICAgIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQkKCQkJCS8qIElEIHRoZSBmaXJzdCBlbGVtZW50cyBvbmx5ICovCgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJblBhZ2luZy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3BhZ2luYXRlJzsKCQkJCQluRmlyc3QuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX2ZpcnN0JzsKCQkJCQluUHJldi5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfcHJldmlvdXMnOwoJCQkJCW5OZXh0LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19uZXh0JzsKCQkJCQluTGFzdC5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfbGFzdCc7CgkJCQl9CgkJCX0sCgkJCQoJCQkvKgoJCQkgKiBGdW5jdGlvbjogb1BhZ2luYXRpb24uZnVsbF9udW1iZXJzLmZuVXBkYXRlCgkJCSAqIFB1cnBvc2U6ICBVcGRhdGUgdGhlIGxpc3Qgb2YgcGFnZSBidXR0b25zIHNob3dzCgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB0byBjYWxsIG9uIHBhZ2UgY2hhbmdlCgkJCSAqLwoJCQkiZm5VcGRhdGUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQl2YXIgaVBhZ2VDb3VudCA9IERhdGFUYWJsZS5leHQub1BhZ2luYXRpb24uaUZ1bGxOdW1iZXJzU2hvd1BhZ2VzOwoJCQkJdmFyIGlQYWdlQ291bnRIYWxmID0gTWF0aC5mbG9vcihpUGFnZUNvdW50IC8gMik7CgkJCQl2YXIgaVBhZ2VzID0gTWF0aC5jZWlsKChvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpKSAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgpOwoJCQkJdmFyIGlDdXJyZW50UGFnZSA9IE1hdGguY2VpbChvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKSArIDE7CgkJCQl2YXIgc0xpc3QgPSAiIjsKCQkJCXZhciBpU3RhcnRCdXR0b24sIGlFbmRCdXR0b24sIGksIGlMZW47CgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgYW5CdXR0b25zLCBhblN0YXRpYywgblBhZ2luYXRlTGlzdDsKCQkJCXZhciBhbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wOwoJCQkJdmFyIGZuQmluZCA9IGZ1bmN0aW9uIChqKSB7CgkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggdGhpcywgeyJwYWdlIjogaitpU3RhcnRCdXR0b24tMX0sIGZ1bmN0aW9uKGUpIHsKCQkJCQkJLyogVXNlIHRoZSBpbmZvcm1hdGlvbiBpbiB0aGUgZWxlbWVudCB0byBqdW1wIHRvIHRoZSByZXF1aXJlZCBwYWdlICovCgkJCQkJCW9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgZS5kYXRhLnBhZ2UgKTsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJfSApOwoJCQkJfTsKCQkJCQoJCQkJLyogUGFnZXMgY2FsY3VsYXRpb24gKi8KCQkJCWlmIChpUGFnZXMgPCBpUGFnZUNvdW50KQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlQYWdlczsKCQkJCX0KCQkJCWVsc2UgaWYgKGlDdXJyZW50UGFnZSA8PSBpUGFnZUNvdW50SGFsZikKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZUNvdW50OwoJCQkJfQoJCQkJZWxzZSBpZiAoaUN1cnJlbnRQYWdlID49IChpUGFnZXMgLSBpUGFnZUNvdW50SGFsZikpCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gaVBhZ2VzIC0gaVBhZ2VDb3VudCArIDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlQYWdlczsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSBpQ3VycmVudFBhZ2UgLSBNYXRoLmNlaWwoaVBhZ2VDb3VudCAvIDIpICsgMTsKCQkJCQlpRW5kQnV0dG9uID0gaVN0YXJ0QnV0dG9uICsgaVBhZ2VDb3VudCAtIDE7CgkJCQl9CgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSBkeW5hbWljIGxpc3QgKi8KCQkJCWZvciAoIGk9aVN0YXJ0QnV0dG9uIDsgaTw9aUVuZEJ1dHRvbiA7IGkrKyApCgkJCQl7CgkJCQkJc0xpc3QgKz0gKGlDdXJyZW50UGFnZSAhPT0gaSkgPwoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPicgOgoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbkFjdGl2ZSsnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPic7CgkJCQl9CgkJCQkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhbltpXS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCApCgkJCQkJewoJCQkJCQljb250aW51ZTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogQnVpbGQgdXAgdGhlIGR5bmFtaWMgbGlzdCBmb3JzdCAtIGh0bWwgYW5kIGxpc3RlbmVycyAqLwoJCQkJCSQoJ3NwYW46ZXEoMCknLCBhbltpXSkKCQkJCQkJLmh0bWwoIHNMaXN0ICkKCQkJCQkJLmNoaWxkcmVuKCdhJykuZWFjaCggZm5CaW5kICk7CgkJCQkJCgkJCQkJLyogVXBkYXRlIHRoZSBwcmVtYW5lbnQgYm90dG9uJ3MgY2xhc3NlcyAqLwoJCQkJCWFuQnV0dG9ucyA9IGFuW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7CgkJCQkJYW5TdGF0aWMgPSBbCgkJCQkJCWFuQnV0dG9uc1swXSwgYW5CdXR0b25zWzFdLCAKCQkJCQkJYW5CdXR0b25zW2FuQnV0dG9ucy5sZW5ndGgtMl0sIGFuQnV0dG9uc1thbkJ1dHRvbnMubGVuZ3RoLTFdCgkJCQkJXTsKCQoJCQkJCSQoYW5TdGF0aWMpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VCdXR0b25BY3RpdmUrIiAiK29DbGFzc2VzLnNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQgKTsKCQkJCQkkKFthblN0YXRpY1swXSwgYW5TdGF0aWNbMV1dKS5hZGRDbGFzcyggCgkJCQkJCShpQ3VycmVudFBhZ2U9PTEpID8KCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQgOgoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VCdXR0b24KCQkJCQkpOwoJCQkJCSQoW2FuU3RhdGljWzJdLCBhblN0YXRpY1szXV0pLmFkZENsYXNzKAoJCQkJCQkoaVBhZ2VzPT09MCB8fCBpQ3VycmVudFBhZ2U9PT1pUGFnZXMgfHwgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aD09PS0xKSA/CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIDoKCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uCgkJCQkJKTsKCQkJCX0KCQkJfQoJCX0KCX0gKTsKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1NvcnQsIHsKCQkvKgoJCSAqIHRleHQgc29ydGluZwoJCSAqLwoJCSJzdHJpbmctcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCWlmICggdHlwZW9mIGEgIT0gJ3N0cmluZycgKSB7IGEgPSAnJzsgfQoJCQlyZXR1cm4gYS50b0xvd2VyQ2FzZSgpOwoJCX0sCgkKCQkic3RyaW5nLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQl9LAoJCQoJCSJzdHJpbmctZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQl9LAoJCQoJCQoJCS8qCgkJICogaHRtbCBzb3J0aW5nIChpZ25vcmUgaHRtbCB0YWdzKQoJCSAqLwoJCSJodG1sLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQlyZXR1cm4gYS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKS50b0xvd2VyQ2FzZSgpOwoJCX0sCgkJCgkJImh0bWwtYXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiAoKHggPCB5KSA/IC0xIDogKCh4ID4geSkgPyAxIDogMCkpOwoJCX0sCgkJCgkJImh0bWwtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQl9LAoJCQoJCQoJCS8qCgkJICogZGF0ZSBzb3J0aW5nCgkJICovCgkJImRhdGUtcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCXZhciB4ID0gRGF0ZS5wYXJzZSggYSApOwoJCQkKCQkJaWYgKCBpc05hTih4KSB8fCB4PT09IiIgKQoJCQl7CgkJCQl4ID0gRGF0ZS5wYXJzZSggIjAxLzAxLzE5NzAgMDA6MDA6MDAiICk7CgkJCX0KCQkJcmV0dXJuIHg7CgkJfSwKCQoJCSJkYXRlLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geCAtIHk7CgkJfSwKCQkKCQkiZGF0ZS1kZXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiB5IC0geDsKCQl9LAoJCQoJCQoJCS8qCgkJICogbnVtZXJpY2FsIHNvcnRpbmcKCQkgKi8KCQkibnVtZXJpYy1wcmUiOiBmdW5jdGlvbiAoIGEgKQoJCXsKCQkJcmV0dXJuIChhPT0iLSIgfHwgYT09PSIiKSA/IDAgOiBhKjE7CgkJfSwKCQoJCSJudW1lcmljLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geCAtIHk7CgkJfSwKCQkKCQkibnVtZXJpYy1kZXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiB5IC0geDsKCQl9Cgl9ICk7CgkKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQuYVR5cGVzLCBbCgkJLyoKCQkgKiBGdW5jdGlvbjogLQoJCSAqIFB1cnBvc2U6ICBDaGVjayB0byBzZWUgaWYgYSBzdHJpbmcgaXMgbnVtZXJpYwoJCSAqIFJldHVybnM6ICBzdHJpbmc6J251bWVyaWMnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgbWl4ZWQ6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCS8qIEFsbG93IHplcm8gbGVuZ3RoIHN0cmluZ3MgYXMgYSBudW1iZXIgKi8KCQkJaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICdudW1iZXInICkKCQkJewoJCQkJcmV0dXJuICdudW1lcmljJzsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIHNEYXRhICE9PSAnc3RyaW5nJyApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgc1ZhbGlkRmlyc3RDaGFycyA9ICIwMTIzNDU2Nzg5LSI7CgkJCXZhciBzVmFsaWRDaGFycyA9ICIwMTIzNDU2Nzg5LiI7CgkJCXZhciBDaGFyOwoJCQl2YXIgYkRlY2ltYWwgPSBmYWxzZTsKCQkJCgkJCS8qIENoZWNrIGZvciBhIHZhbGlkIGZpcnN0IGNoYXIgKG5vIHBlcmlvZCBhbmQgYWxsb3cgbmVnYXRpdmVzKSAqLwoJCQlDaGFyID0gc0RhdGEuY2hhckF0KDApOyAKCQkJaWYgKHNWYWxpZEZpcnN0Q2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBhbGwgdGhlIG90aGVyIGNoYXJhY3RlcnMgYXJlIHZhbGlkICovCgkJCWZvciAoIHZhciBpPTEgOyBpPHNEYXRhLmxlbmd0aCA7IGkrKyApIAoJCQl7CgkJCQlDaGFyID0gc0RhdGEuY2hhckF0KGkpOyAKCQkJCWlmIChzVmFsaWRDaGFycy5pbmRleE9mKENoYXIpID09IC0xKSAKCQkJCXsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0KCQkJCQoJCQkJLyogT25seSBhbGxvd2VkIG9uZSBkZWNpbWFsIHBsYWNlLi4uICovCgkJCQlpZiAoIENoYXIgPT0gIi4iICkKCQkJCXsKCQkJCQlpZiAoIGJEZWNpbWFsICkKCQkJCQl7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX0KCQkJCQliRGVjaW1hbCA9IHRydWU7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiAnbnVtZXJpYyc7CgkJfSwKCQkKCQkvKgoJCSAqIEZ1bmN0aW9uOiAtCgkJICogUHVycG9zZTogIENoZWNrIHRvIHNlZSBpZiBhIHN0cmluZyBpcyBhY3R1YWxseSBhIGZvcm1hdHRlZCBkYXRlCgkJICogUmV0dXJuczogIHN0cmluZzonZGF0ZScgb3IgbnVsbAoJCSAqIElucHV0czogICBzdHJpbmc6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCXZhciBpUGFyc2UgPSBEYXRlLnBhcnNlKHNEYXRhKTsKCQkJaWYgKCAoaVBhcnNlICE9PSBudWxsICYmICFpc05hTihpUGFyc2UpKSB8fCAodHlwZW9mIHNEYXRhID09PSAnc3RyaW5nJyAmJiBzRGF0YS5sZW5ndGggPT09IDApICkKCQkJewoJCQkJcmV0dXJuICdkYXRlJzsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9LAoJCQoJCS8qCgkJICogRnVuY3Rpb246IC0KCQkgKiBQdXJwb3NlOiAgQ2hlY2sgdG8gc2VlIGlmIGEgc3RyaW5nIHNob3VsZCBiZSB0cmVhdGVkIGFzIGFuIEhUTUwgc3RyaW5nCgkJICogUmV0dXJuczogIHN0cmluZzonaHRtbCcgb3IgbnVsbAoJCSAqIElucHV0czogICBzdHJpbmc6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCWlmICggdHlwZW9mIHNEYXRhID09PSAnc3RyaW5nJyAmJiBzRGF0YS5pbmRleE9mKCc8JykgIT0gLTEgJiYgc0RhdGEuaW5kZXhPZignPicpICE9IC0xICkKCQkJewoJCQkJcmV0dXJuICdodG1sJzsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9CgldICk7CgkKCgkvLyBqUXVlcnkgYWxpYXNlcwoJJC5mbi5EYXRhVGFibGUgPSBEYXRhVGFibGU7CgkkLmZuLmRhdGFUYWJsZSA9IERhdGFUYWJsZTsKCSQuZm4uZGF0YVRhYmxlU2V0dGluZ3MgPSBEYXRhVGFibGUuc2V0dGluZ3M7CgkkLmZuLmRhdGFUYWJsZUV4dCA9IERhdGFUYWJsZS5leHQ7CgoKCS8vIEluZm9ybWF0aW9uIGFib3V0IGV2ZW50cyBmaXJlZCBieSBEYXRhVGFibGVzIC0gZm9yIGRvY3VtZW50YXRpb24uCgkvKioKCSAqIERyYXcgZXZlbnQsIGZpcmVkIHdoZW5ldmVyIHRoZSB0YWJsZSBpcyByZWRyYXduIG9uIHRoZSBwYWdlLCBhdCB0aGUgc2FtZSBwb2ludCBhcwoJICogZm5EcmF3Q2FsbGJhY2suIFRoaXMgbWF5IGJlIHVzZWZ1bCBmb3IgYmluZGluZyBldmVudHMgb3IgcGVyZm9ybWluZyBjYWxjdWxhdGlvbnMgd2hlbgoJICogdGhlIHRhYmxlIGlzIGFsdGVyZWQgYXQgYWxsLgoJICogIEBuYW1lIERhdGFUYWJsZSNkcmF3CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCgoJLyoqCgkgKiBGaWx0ZXIgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIGZpbHRlcmluZyBhcHBsaWVkIHRvIHRoZSB0YWJsZSAodXNpbmcgdGhlIGJ1aWxkIGluIGdsb2JhbAoJICogZ2xvYmFsIGZpbHRlciwgb3IgY29sdW1uIGZpbHRlcnMpIGlzIGFsdGVyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI2ZpbHRlcgoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogUGFnZSBjaGFuZ2UgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHBhZ2luZyBvZiB0aGUgdGFibGUgaXMgYWx0ZXJlZC4KCSAqICBAbmFtZSBEYXRhVGFibGUjcGFnZQoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogU29ydCBldmVudCwgZmlyZWQgd2hlbiB0aGUgc29ydGluZyBhcHBsaWVkIHRvIHRoZSB0YWJsZSBpcyBhbHRlcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNzb3J0CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCgoJLyoqCgkgKiBEYXRhVGFibGVzIGluaXRpYWxpc2F0aW9uIGNvbXBsZXRlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSB0YWJsZSBpcyBmdWxseSBkcmF3biwKCSAqIGluY2x1ZGluZyBBamF4IGRhdGEgbG9hZGVkLCBpZiBBamF4IGRhdGEgaXMgcmVxdWlyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI2luaXQKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJICogICAgcHJlc2VudCBpZiBjbGllbnQtc2lkZSBBamF4IHNvdXJjZWQgZGF0YSBpcyB1c2VkPC9saT48L29sPgoJICovCgoJLyoqCgkgKiBTdGF0ZSBzYXZlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSB0YWJsZSBoYXMgY2hhbmdlZCBzdGF0ZSBhIG5ldyBzdGF0ZSBzYXZlIGlzIHJlcXVpcmVkLgoJICogVGhpcyBtZXRob2QgYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc3RhdGUgc2F2aW5nIG9iamVjdCBwcmlvciB0byBhY3R1YWxseSBkb2luZyB0aGUKCSAqIHNhdmUsIGluY2x1ZGluZyBhZGRpdGlvbiBvciBvdGhlciBzdGF0ZSBwcm9wZXJ0aWVzIChmb3IgcGx1Zy1pbnMpIG9yIG1vZGlmaWNhdGlvbgoJICogb2YgYSBEYXRhVGFibGVzIGNvcmUgcHJvcGVydHkuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlU2F2ZVBhcmFtcwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBUaGUgc3RhdGUgaW5mb3JtYXRpb24gdG8gYmUgc2F2ZWQKCSAqLwoKCS8qKgoJICogU3RhdGUgbG9hZCBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaXMgbG9hZGluZyBzdGF0ZSBmcm9tIHRoZSBzdG9yZWQgZGF0YSwgYnV0CgkgKiBwcmlvciB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IGJlaW5nIG1vZGlmaWVkIGJ5IHRoZSBzYXZlZCBzdGF0ZSAtIGFsbG93aW5nIG1vZGlmaWNhdGlvbgoJICogb2YgdGhlIHNhdmVkIHN0YXRlIGlzIHJlcXVpcmVkIG9yIGxvYWRpbmcgb2Ygc3RhdGUgZm9yIGEgcGx1Zy1pbi4KCSAqICBAbmFtZSBEYXRhVGFibGUjc3RhdGVMb2FkUGFyYW1zCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBzYXZlZCBzdGF0ZSBpbmZvcm1hdGlvbgoJICovCgoJLyoqCgkgKiBTdGF0ZSBsb2FkZWQgZXZlbnQsIGZpcmVkIHdoZW4gc3RhdGUgaGFzIGJlZW4gbG9hZGVkIGZyb20gc3RvcmVkIGRhdGEgYW5kIHRoZSBzZXR0aW5ncwoJICogb2JqZWN0IGhhcyBiZWVuIG1vZGlmaWVkIGJ5IHRoZSBsb2FkZWQgZGF0YS4KCSAqICBAbmFtZSBEYXRhVGFibGUjc3RhdGVMb2FkZWQKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIHNhdmVkIHN0YXRlIGluZm9ybWF0aW9uCgkgKi8KCgkvKioKCSAqIFByb2Nlc3NpbmcgZXZlbnQsIGZpcmVkIHdoZW4gRGF0YVRhYmxlcyBpcyBkb2luZyBzb21lIGtpbmQgb2YgcHJvY2Vzc2luZyAoYmUgaXQsCgkgKiBzb3J0LCBmaWx0ZXIgb3IgYW55dGhpbmcgZWxzZSkuIENhbiBiZSB1c2VkIHRvIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGF0CgkgKiB0aGVyZSBpcyBzb21ldGhpbmcgaGFwcGVuaW5nLCBvciB0aGF0IHNvbWV0aGluZyBoYXMgZmluaXNoZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3Byb2Nlc3NpbmcKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtib29sZWFufSBiU2hvdyBGbGFnIGZvciBpZiBEYXRhVGFibGVzIGlzIGRvaW5nIHByb2Nlc3Npbmcgb3Igbm90CgkgKi8KCgkvKioKCSAqIEFqYXggKFhIUikgZXZlbnQsIGZpcmVkIHdoZW5ldmVyIGFuIEFqYXggcmVxdWVzdCBpcyBjb21wbGV0ZWQgZnJvbSBhIHJlcXVlc3QgdG8gCgkgKiBtYWRlIHRvIHRoZSBzZXJ2ZXIgZm9yIG5ldyBkYXRhIChub3RlIHRoYXQgdGhpcyB0cmlnZ2VyIGlzIGNhbGxlZCBpbiBmblNlcnZlckRhdGEsCgkgKiBpZiB5b3Ugb3ZlcnJpZGUgZm5TZXJ2ZXJEYXRhIGFuZCB3aGljaCB0byB1c2UgdGhpcyBldmVudCwgeW91IG5lZWQgdG8gdHJpZ2dlciBpdCBpbgoJICogeW91IHN1Y2Nlc3MgZnVuY3Rpb24pLgoJICogIEBuYW1lIERhdGFUYWJsZSN4aHIKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KfShqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkpOwo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 02:17:15 GMT",
                    "Content-Length": "361238",
                    "Date": "Sun, 09 Nov 2014 02:17:16 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}