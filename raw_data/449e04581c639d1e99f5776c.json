{
    "url": "http://localhost:9999/ariya/phantomjs/src/qt/qtwebkit/Tools/TestResultServer/static-dashboards/aggregate_results.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location.hash</b> and written to <b>the 'innerHTML' property of a DOM element</b> via the following statements:<ul><li>html+= '&lt;a href=\"timeline_e...' + (location.hash? location.hash+ '&amp;' : '#' ) + 'builder=' + builder+ '\"&gt;' + chartHTML(results, numColumns) + '&lt;/a&gt;';</li><li>return html;</li><li>html += htmlForBuilder(builder);</li><li>document.body.innerHTML = html;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ariya/phantomjs/src/qt/qtwebkit/Tools/TestResultServer/static-dashboards/aggregate_results.js",
                "path": "/ariya/phantomjs/src/qt/qtwebkit/Tools/TestResultServer/static-dashboards/aggregate_results.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hcml5YS9waGFudG9tanMvc3JjL3F0L3F0d2Via2l0L1Rvb2xzL1Rlc3RSZXN1bHRTZXJ2ZXIvc3RhdGljLWRhc2hib2FyZHMvYWdncmVnYXRlX3Jlc3VsdHMuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTA0MjkNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMjE6NTE6MTQgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDIxOjUwOjAwIEdNVA0KDQovLyBDb3B5cmlnaHQgKEMpIDIwMTMgR29vZ2xlIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KLy8KLy8gUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0Ci8vIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUKLy8gbWV0OgovLwovLyAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAovLyBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCi8vICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUKLy8gY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lcgovLyBpbiB0aGUgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlCi8vIGRpc3RyaWJ1dGlvbi4KLy8gICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBHb29nbGUgSW5jLiBub3IgdGhlIG5hbWVzIG9mIGl0cwovLyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbQovLyB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgovLwovLyBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTCi8vICJBUyBJUyIgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UCi8vIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUgovLyBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVAovLyBPV05FUiBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwKLy8gU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVAovLyBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwKLy8gREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZCi8vIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQKLy8gKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFCi8vIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCi8vCi8vIEBmaWxlb3ZlcnZpZXcgQ3JlYXRlcyBhIGRhc2hib2FyZCBmb3IgdHJhY2tpbmcgbnVtYmVyIG9mIHBhc3Nlcy9mYWlsdXJlcyBwZXIgcnVuLgovLwovLyBDdXJyZW50bHksIG9ubHkgd2Via2l0IHRlc3RzIGFyZSBzdXBwb3J0ZWQsIGJ1dCBhZGRpbmcgb3RoZXIgdGVzdCB0eXBlcwovLyBzaG91bGQganVzdCByZXF1aXJlIHRoZSBmb2xsb3dpbmcgc3RlcHM6Ci8vICAgICAtZ2VuZXJhdGUgcmVzdWx0cy5qc29uIGZvciB0aGVzZSB0ZXN0cwovLyAgICAgLWNvcHkgdGhlbSB0byB0aGUgYXBwcm9wcmlhdGUgbG9jYXRpb24KLy8gICAgIC1hZGQgdGhlIGJ1aWxkZXIgbmFtZSB0byB0aGUgbGlzdCBvZiBidWlsZGVycyBpbiBkYXNoYm9hcmRfYmFzZS5qcy4KCmZ1bmN0aW9uIGdlbmVyYXRlUGFnZShoaXN0b3J5SW5zdGFuY2UpCnsKICAgIHZhciBodG1sID0gdWkuaHRtbC50ZXN0VHlwZVN3aXRjaGVyKHRydWUpICsgJzxicj4nOwogICAgZm9yICh2YXIgYnVpbGRlciBpbiBjdXJyZW50QnVpbGRlcnMoKSkKICAgICAgICBodG1sICs9IGh0bWxGb3JCdWlsZGVyKGJ1aWxkZXIpOwogICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSBodG1sOwp9CgpmdW5jdGlvbiBoYW5kbGVWYWxpZEhhc2hQYXJhbWV0ZXIoaGlzdG9yeUluc3RhbmNlLCBrZXksIHZhbHVlKQp7CiAgICBzd2l0Y2goa2V5KSB7CiAgICBjYXNlICdyYXdWYWx1ZXMnOgogICAgICAgIGhpc3RvcnlJbnN0YW5jZS5kYXNoYm9hcmRTcGVjaWZpY1N0YXRlW2tleV0gPSB2YWx1ZSA9PSAndHJ1ZSc7CiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCnZhciBkZWZhdWx0RGFzaGJvYXJkU3BlY2lmaWNTdGF0ZVZhbHVlcyA9IHsKICAgIHJhd1ZhbHVlczogZmFsc2UKfTsKCgp2YXIgYWdncmVnYXRlUmVzdWx0c0NvbmZpZyA9IHsKICAgIGRlZmF1bHRTdGF0ZVZhbHVlczogZGVmYXVsdERhc2hib2FyZFNwZWNpZmljU3RhdGVWYWx1ZXMsCiAgICBnZW5lcmF0ZVBhZ2U6IGdlbmVyYXRlUGFnZSwKICAgIGhhbmRsZVZhbGlkSGFzaFBhcmFtZXRlcjogaGFuZGxlVmFsaWRIYXNoUGFyYW1ldGVyLAp9OwoKLy8gRklYTUUoanBhcmVudCk6IEV2ZW50dWFsbHkgcmVtb3ZlIGFsbCB1c2FnZSBvZiBnbG9iYWwgaGlzdG9yeSBvYmplY3QuCnZhciBnX2hpc3RvcnkgPSBuZXcgaGlzdG9yeS5IaXN0b3J5KGFnZ3JlZ2F0ZVJlc3VsdHNDb25maWcpOwpnX2hpc3RvcnkucGFyc2VDcm9zc0Rhc2hib2FyZFBhcmFtZXRlcnMoKTsKCmZ1bmN0aW9uIGh0bWxGb3JCdWlsZGVyKGJ1aWxkZXIpCnsKICAgIHZhciByZXN1bHRzID0gZ19yZXN1bHRzQnlCdWlsZGVyW2J1aWxkZXJdOwogICAgLy8gU29tZSBrZXlzIHdlcmUgYWRkZWQgbGF0ZXIgdGhhbiBvdGhlcnMsIHNvIHRoZXkgZG9uJ3QgaGF2ZSBhcyBtYW55CiAgICAvLyBidWlsZHMuIFVzZSB0aGUgc2hvcnRlc3QuCiAgICAvLyBGSVhNRTogT25jZSA1MDAgcnVucyBoYXZlIGZpbmlzaGVkLCB3ZSBjYW4gZ2V0IHJpZCBvZiBwYXNzaW5nIHRoaXMKICAgIC8vIGFyb3VuZCBhbmQganVzdCBhc3N1bWUgYWxsIGtleXMgaGF2ZSB0aGUgc2FtZSBudW1iZXIgb2YgYnVpbGRlcnMgZm9yIGEKICAgIC8vIGdpdmVuIGJ1aWxkZXIuCiAgICB2YXIgbnVtQ29sdW1ucyA9IHJlc3VsdHNbQUxMX0ZJWEFCTEVfQ09VTlRfS0VZXS5sZW5ndGg7CiAgICB2YXIgaHRtbCA9ICc8ZGl2IGNsYXNzPWNvbnRhaW5lcj48aDI+JyArIGJ1aWxkZXIgKyAnPC9oMj4nOwoKICAgIGlmIChnX2hpc3RvcnkuZGFzaGJvYXJkU3BlY2lmaWNTdGF0ZS5yYXdWYWx1ZXMpCiAgICAgICAgaHRtbCArPSByYXdWYWx1ZXNIVE1MKHJlc3VsdHMsIG51bUNvbHVtbnMpOwogICAgZWxzZSB7CiAgICAgICAgaHRtbCArPSAnPGEgaHJlZj0idGltZWxpbmVfZXhwbG9yZXIuaHRtbCcgKyAobG9jYXRpb24uaGFzaCA/IGxvY2F0aW9uLmhhc2ggKyAnJicgOiAnIycpICsgJ2J1aWxkZXI9JyArIGJ1aWxkZXIgKyAnIj4nICsKICAgICAgICAgICAgY2hhcnRIVE1MKHJlc3VsdHMsIG51bUNvbHVtbnMpICsgJzwvYT4nOwogICAgfQoKICAgIGh0bWwgKz0gJzwvZGl2Pic7CiAgICByZXR1cm4gaHRtbDsKfQoKZnVuY3Rpb24gcmF3VmFsdWVzSFRNTChyZXN1bHRzLCBudW1Db2x1bW5zKQp7CiAgICB2YXIgaHRtbCA9IGh0bWxGb3JTdW1tYXJ5VGFibGUocmVzdWx0cywgbnVtQ29sdW1ucykgKwogICAgICAgIGh0bWxGb3JUZXN0VHlwZShyZXN1bHRzLCBGSVhBQkxFX0NPVU5UU19LRVksIEZJWEFCTEVfREVTQ1JJUFRJT04sIG51bUNvbHVtbnMpOwogICAgaWYgKGdfaGlzdG9yeS5pc0xheW91dFRlc3RSZXN1bHRzKCkpIHsKICAgICAgICBodG1sICs9IGh0bWxGb3JUZXN0VHlwZShyZXN1bHRzLCBERUZFUlJFRF9DT1VOVFNfS0VZLCBERUZFUlJFRF9ERVNDUklQVElPTiwgbnVtQ29sdW1ucykgKwogICAgICAgICAgICBodG1sRm9yVGVzdFR5cGUocmVzdWx0cywgV09OVEZJWF9DT1VOVFNfS0VZLCBXT05URklYX0RFU0NSSVBUSU9OLCBudW1Db2x1bW5zKTsKICAgIH0KICAgIHJldHVybiBodG1sOwp9CgpmdW5jdGlvbiBjaGFydEhUTUwocmVzdWx0cywgbnVtQ29sdW1ucykKewogICAgdmFyIHJldmlzaW9uS2V5ID0gV0VCS0lUX1JFVklTSU9OU19LRVk7CiAgICB2YXIgcmV2aXNpb25MYWJlbCA9ICJXZWJLaXQgUmV2aXNpb24iOwogICAgdmFyIHN0YXJ0UmV2aXNpb24gPSByZXN1bHRzW3JldmlzaW9uS2V5XVtudW1Db2x1bW5zIC0gMV07CiAgICB2YXIgZW5kUmV2aXNpb24gPSByZXN1bHRzW3JldmlzaW9uS2V5XVswXTsKCiAgICB2YXIgZml4YWJsZSA9IHJlc3VsdHNbRklYQUJMRV9DT1VOVF9LRVldLnNsaWNlKDAsIG51bUNvbHVtbnMpOwogICAgdmFyIGh0bWwgPSBjaGFydCgiVG90YWwgZmFpbGluZyIsIHsiIjogZml4YWJsZX0sIHJldmlzaW9uTGFiZWwsIHN0YXJ0UmV2aXNpb24sIGVuZFJldmlzaW9uKTsKCiAgICB2YXIgdmFsdWVzID0gdmFsdWVzUGVyRXhwZWN0YXRpb24ocmVzdWx0c1tGSVhBQkxFX0NPVU5UU19LRVldLCBudW1Db2x1bW5zKTsKICAgIC8vIERvbid0IGNhcmUgYWJvdXQgbnVtYmVyIG9mIHBhc3NlcyBmb3IgdGhlIGNoYXJ0cy4KICAgIGRlbGV0ZSh2YWx1ZXNbJ1AnXSk7CgogICAgcmV0dXJuIGh0bWwgKyBjaGFydCgiRGV0YWlsZWQgYnJlYWtkb3duIiwgdmFsdWVzLCByZXZpc2lvbkxhYmVsLCBzdGFydFJldmlzaW9uLCBlbmRSZXZpc2lvbik7Cn0KCnZhciBMQUJFTF9DT0xPUlMgPSBbJ0ZGMDAwMCcsICcwMEZGMDAnLCAnMDAwMEZGJywgJzAwMDAwMCcsICdGRjZFQjQnLCAnRkZBODEyJywgJzlCMzBGRicsICcwMEZGQ0MnXTsKCi8vIEZJWE1FOiBGaW5kIGEgYmV0dGVyIHdheSB0byBleGNsdWRlIG91dGxpZXJzLiBUaGlzIGlzIGp1c3Qgc28gd2UgZXhjbHVkZQovLyBydW5zIHdoZXJlIGV2ZXJ5IHRlc3QgZmFpbGVkLgp2YXIgTUFYX1ZBTFVFID0gMTAwMDA7CgpmdW5jdGlvbiBmaWx0ZXJlZFZhbHVlcyh2YWx1ZXMsIGRlc2lyZWROdW1iZXJPZlBvaW50cykKewogICAgLy8gRmlsdGVyIG91dCB2YWx1ZXMgdG8gbWFrZSB0aGUgZ3JhcGggYSBiaXQgbW9yZSByZWFkYWJsZSBhbmQgdG8ga2VlcCBVUkxzCiAgICAvLyBmcm9tIGV4Y2VlZGluZyB0aGUgYnJvd3NlcnMgbWF4IGxlbmd0aCByZXN0cmljdGlvbi4KICAgIHZhciBmaWx0ZXJBbW91bnQgPSBNYXRoLmZsb29yKHZhbHVlcy5sZW5ndGggLyBkZXNpcmVkTnVtYmVyT2ZQb2ludHMpOwogICAgaWYgKGZpbHRlckFtb3VudCA8IDEpCiAgICAgICAgcmV0dXJuIHZhbHVlczsKCiAgICByZXR1cm4gdmFsdWVzLmZpbHRlcihmdW5jdGlvbihlbGVtZW50LCBpbmRleCwgYXJyYXkpIHsKICAgICAgICAvLyBJbmNsdWRlIHRoZSBtb3N0IHJlY2VudCBhbmQgb2xkZXN0IHZhbHVlcyBhbmQgZXhjbHVkZSBvdXRsaWVycy4KICAgICAgICByZXR1cm4gKGluZGV4ICUgZmlsdGVyQW1vdW50ID09IDAgfHwgaW5kZXggPT0gYXJyYXkubGVuZ3RoIC0gMSkgJiYgKGFycmF5W2luZGV4XSA8IE1BWF9WQUxVRSAmJiBhcnJheVtpbmRleF0gIT0gMCk7CiAgICB9KTsKfQoKZnVuY3Rpb24gY2hhcnRVcmwodGl0bGUsIHZhbHVlcywgcmV2aXNpb25MYWJlbCwgc3RhcnRSZXZpc2lvbiwgZW5kUmV2aXNpb24sIGRlc2lyZWROdW1iZXJPZlBvaW50cykgewogICAgdmFyIG1heFZhbHVlID0gMDsKICAgIGZvciAodmFyIGV4cGVjdGF0aW9uIGluIHZhbHVlcykKICAgICAgICBtYXhWYWx1ZSA9IE1hdGgubWF4KG1heFZhbHVlLCBNYXRoLm1heC5hcHBseShudWxsLCBmaWx0ZXJlZFZhbHVlcyh2YWx1ZXNbZXhwZWN0YXRpb25dLCBkZXNpcmVkTnVtYmVyT2ZQb2ludHMpKSk7CgogICAgdmFyIGNoYXJ0RGF0YSA9ICcnOwogICAgdmFyIGxhYmVscyA9ICcnOwogICAgdmFyIG51bUxhYmVscyA9IDA7CgogICAgdmFyIGZpcnN0ID0gdHJ1ZTsKICAgIGZvciAodmFyIGV4cGVjdGF0aW9uIGluIHZhbHVlcykgewogICAgICAgIGNoYXJ0RGF0YSArPSAoZmlyc3QgPyAnZTonIDogJywnKSArIGV4dGVuZGVkRW5jb2RlKGZpbHRlcmVkVmFsdWVzKHZhbHVlc1tleHBlY3RhdGlvbl0sIGRlc2lyZWROdW1iZXJPZlBvaW50cykucmV2ZXJzZSgpLCBtYXhWYWx1ZSk7CgogICAgICAgIGlmIChleHBlY3RhdGlvbikgewogICAgICAgICAgICBudW1MYWJlbHMrKzsKICAgICAgICAgICAgbGFiZWxzICs9IChmaXJzdCA/ICcnIDogJ3wnKSArIGV4cGVjdGF0aW9uc01hcCgpW2V4cGVjdGF0aW9uXTsKICAgICAgICB9CiAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgIH0KCiAgICB2YXIgdXJsID0gImh0dHA6Ly9jaGFydC5hcGlzLmdvb2dsZS5jb20vY2hhcnQ/Y2h0PWxjJmNocz02MDB4NDAwJmNoZD0iICsKICAgICAgICAgICAgY2hhcnREYXRhICsgIiZjaGc9MTUsMTUsMSwzJmNoeHQ9eCx4LHkmY2h4bD0xOnx8IiArIHJldmlzaW9uTGFiZWwgKwogICAgICAgICAgICAifCZjaHhyPTAsIiArIHN0YXJ0UmV2aXNpb24gKyAiLCIgKyBlbmRSZXZpc2lvbiArICJ8MiwwLCIgKyBtYXhWYWx1ZSArICImY2h0dD0iICsgdGl0bGU7CgoKICAgIGlmIChsYWJlbHMpCiAgICAgICAgdXJsICs9ICImY2hkbD0iICsgbGFiZWxzICsgIiZjaGNvPSIgKyBMQUJFTF9DT0xPUlMuc2xpY2UoMCwgbnVtTGFiZWxzKS5qb2luKCcsJyk7CiAgICByZXR1cm4gdXJsOwp9CgpmdW5jdGlvbiBjaGFydCh0aXRsZSwgdmFsdWVzLCByZXZpc2lvbkxhYmVsLCBzdGFydFJldmlzaW9uLCBlbmRSZXZpc2lvbikKewogICAgdmFyIGRlc2lyZWROdW1iZXJPZlBvaW50cyA9IDQwMDsKICAgIHZhciB1cmwgPSBjaGFydFVybCh0aXRsZSwgdmFsdWVzLCByZXZpc2lvbkxhYmVsLCBzdGFydFJldmlzaW9uLCBlbmRSZXZpc2lvbiwgZGVzaXJlZE51bWJlck9mUG9pbnRzKTsKCiAgICB3aGlsZSAodXJsLmxlbmd0aCA+PSAyMDQ4KSB7CiAgICAgICAgLy8gRGVjcmVhc2UgdGhlIGRlc2lyZWQgbnVtYmVyIG9mIHBvaW50cyBncmFkdWFsbHkgdW50aWwgd2UgZ2V0IGEgVVJMIHRoYXQKICAgICAgICAvLyBkb2Vzbid0IGV4Y2VlZCBjaGFydHNlcnZlcidzIG1heCBVUkwgbGVuZ3RoLgogICAgICAgIGRlc2lyZWROdW1iZXJPZlBvaW50cyA9IDMgLyA0ICogZGVzaXJlZE51bWJlck9mUG9pbnRzOwogICAgICAgIHVybCA9IGNoYXJ0VXJsKHRpdGxlLCB2YWx1ZXMsIHJldmlzaW9uTGFiZWwsIHN0YXJ0UmV2aXNpb24sIGVuZFJldmlzaW9uLCBkZXNpcmVkTnVtYmVyT2ZQb2ludHMpOwogICAgfQoKICAgIHJldHVybiAnPGltZyBzcmM9IicgKyB1cmwgKyAnIj4nOwp9CgpmdW5jdGlvbiB3cmFwSFRNTEluVGFibGUoZGVzY3JpcHRpb24sIGh0bWwpCnsKICAgIHJldHVybiAnPGgzPicgKyBkZXNjcmlwdGlvbiArICc8L2gzPjx0YWJsZT48dGJvZHk+JyArIGh0bWwgKyAnPC90Ym9keT48L3RhYmxlPic7Cn0KCmZ1bmN0aW9uIGh0bWxGb3JTdW1tYXJ5VGFibGUocmVzdWx0cywgbnVtQ29sdW1ucykKewogICAgdmFyIHBlcmNlbnQgPSBbXTsKICAgIHZhciBmaXhhYmxlID0gcmVzdWx0c1tGSVhBQkxFX0NPVU5UX0tFWV0uc2xpY2UoMCwgbnVtQ29sdW1ucyk7CiAgICB2YXIgYWxsRml4YWJsZSA9IHJlc3VsdHNbQUxMX0ZJWEFCTEVfQ09VTlRfS0VZXS5zbGljZSgwLCBudW1Db2x1bW5zKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQ29sdW1uczsgaSsrKSB7CiAgICAgICAgdmFyIHBlcmNlbnRhZ2UgPSAxMDAgKiAoYWxsRml4YWJsZVtpXSAtIGZpeGFibGVbaV0pIC8gYWxsRml4YWJsZVtpXTsKICAgICAgICAvLyBSb3VuZCB0byB0aGUgbmVhcmVzdCB0ZW50aCBvZiBhIHBlcmNlbnQuCiAgICAgICAgcGVyY2VudC5wdXNoKE1hdGgucm91bmQocGVyY2VudGFnZSAqIDEwKSAvIDEwICsgJyUnKTsKICAgIH0KICAgIHZhciBodG1sID0gaHRtbEZvclRhYmxlUm93KCdXZWJLaXQgUmV2aXNpb24nLCByZXN1bHRzW1dFQktJVF9SRVZJU0lPTlNfS0VZXS5zbGljZSgwLCBudW1Db2x1bW5zKSkgKwogICAgICAgIGh0bWxGb3JUYWJsZVJvdygnUGVyY2VudCBwYXNzZWQnLCBwZXJjZW50KSArCiAgICAgICAgaHRtbEZvclRhYmxlUm93KCdGYWlsdXJlcyAoZGVkdXBlZCknLCBmaXhhYmxlKSArCiAgICAgICAgaHRtbEZvclRhYmxlUm93KCdGaXhhYmxlIFRlc3RzJywgYWxsRml4YWJsZSk7CiAgICByZXR1cm4gd3JhcEhUTUxJblRhYmxlKCdTdW1tYXJ5JywgaHRtbCk7Cn0KCmZ1bmN0aW9uIHZhbHVlc1BlckV4cGVjdGF0aW9uKGNvdW50cywgbnVtQ29sdW1ucykKewogICAgdmFyIHZhbHVlcyA9IHt9OwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1Db2x1bW5zOyBpKyspIHsKICAgICAgICBmb3IgKHZhciBleHBlY3RhdGlvbiBpbiBleHBlY3RhdGlvbnNNYXAoKSkgewogICAgICAgICAgICBpZiAoZXhwZWN0YXRpb24gaW4gY291bnRzW2ldKSB7CiAgICAgICAgICAgICAgICB2YXIgY291bnQgPSBjb3VudHNbaV1bZXhwZWN0YXRpb25dOwogICAgICAgICAgICAgICAgaWYgKCF2YWx1ZXNbZXhwZWN0YXRpb25dKQogICAgICAgICAgICAgICAgICAgIHZhbHVlc1tleHBlY3RhdGlvbl0gPSBbXTsKICAgICAgICAgICAgICAgIHZhbHVlc1tleHBlY3RhdGlvbl0ucHVzaChjb3VudCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdmFsdWVzOwp9CgpmdW5jdGlvbiBodG1sRm9yVGVzdFR5cGUocmVzdWx0cywga2V5LCBkZXNjcmlwdGlvbiwgbnVtQ29sdW1ucykKewogICAgdmFyIGNvdW50cyA9IHJlc3VsdHNba2V5XTsKICAgIHZhciBodG1sID0gaHRtbEZvclRhYmxlUm93KCdXZWJLaXQgUmV2aXNpb24nLCByZXN1bHRzW1dFQktJVF9SRVZJU0lPTlNfS0VZXS5zbGljZSgwLCBudW1Db2x1bW5zKSk7CiAgICB2YXIgdmFsdWVzID0gdmFsdWVzUGVyRXhwZWN0YXRpb24oY291bnRzLCBudW1Db2x1bW5zKTsKICAgIGZvciAodmFyIGV4cGVjdGF0aW9uIGluIHZhbHVlcykKICAgICAgICBodG1sICs9IGh0bWxGb3JUYWJsZVJvdyhleHBlY3RhdGlvbnNNYXAoKVtleHBlY3RhdGlvbl0sIHZhbHVlc1tleHBlY3RhdGlvbl0pOwogICAgcmV0dXJuIHdyYXBIVE1MSW5UYWJsZShkZXNjcmlwdGlvbiwgaHRtbCk7Cn0KCmZ1bmN0aW9uIGh0bWxGb3JUYWJsZVJvdyhjb2x1bW5OYW1lLCB2YWx1ZXMpCnsKICAgIHJldHVybiAnPHRyPjx0ZD4nICsgY29sdW1uTmFtZSArICc8L3RkPjx0ZD4nICsgdmFsdWVzLmpvaW4oJzwvdGQ+PHRkPicpICsgJzwvdGQ+PC90cj4nOwp9CgovLyBUYWtlbiBmcm9tIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vYXBpcy9jaGFydC9kb2NzL2RhdGFfZm9ybWF0cy5odG1sLgpmdW5jdGlvbiBleHRlbmRlZEVuY29kZShhcnJWYWxzLCBtYXhWYWwpCnsKICAgIHZhciBtYXAgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODktLic7CiAgICB2YXIgbWFwTGVuZ3RoID0gbWFwLmxlbmd0aDsKICAgIHZhciBtYXBMZW5ndGhTcXVhcmVkID0gbWFwTGVuZ3RoICogbWFwTGVuZ3RoOwoKICAgIHZhciBjaGFydERhdGEgPSAnJzsKCiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYXJyVmFscy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIC8vIEluIGNhc2UgdGhlIGFycmF5IHZhbHMgd2VyZSB0cmFuc2xhdGVkIHRvIHN0cmluZ3MuCiAgICAgICAgdmFyIG51bWVyaWNWYWwgPSBuZXcgTnVtYmVyKGFyclZhbHNbaV0pOwogICAgICAgIC8vIFNjYWxlIHRoZSB2YWx1ZSB0byBtYXhWYWwuCiAgICAgICAgdmFyIHNjYWxlZFZhbCA9IE1hdGguZmxvb3IobWFwTGVuZ3RoU3F1YXJlZCAqIG51bWVyaWNWYWwgLyBtYXhWYWwpOwoKICAgICAgICBpZihzY2FsZWRWYWwgPiBtYXBMZW5ndGhTcXVhcmVkIC0gMSkKICAgICAgICAgICAgY2hhcnREYXRhICs9ICIuLiI7CiAgICAgICAgZWxzZSBpZiAoc2NhbGVkVmFsIDwgMCkKICAgICAgICAgICAgY2hhcnREYXRhICs9ICdfXyc7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBmaXJzdCBhbmQgc2Vjb25kIGRpZ2l0cyBhbmQgYWRkIHRoZW0gdG8gdGhlIG91dHB1dC4KICAgICAgICAgICAgdmFyIHF1b3RpZW50ID0gTWF0aC5mbG9vcihzY2FsZWRWYWwgLyBtYXBMZW5ndGgpOwogICAgICAgICAgICB2YXIgcmVtYWluZGVyID0gc2NhbGVkVmFsIC0gbWFwTGVuZ3RoICogcXVvdGllbnQ7CiAgICAgICAgICAgIGNoYXJ0RGF0YSArPSBtYXAuY2hhckF0KHF1b3RpZW50KSArIG1hcC5jaGFyQXQocmVtYWluZGVyKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGNoYXJ0RGF0YTsKfQoKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbigpIHsKICAgIHZhciByZXNvdXJjZUxvYWRlciA9IG5ldyBsb2FkZXIuTG9hZGVyKCk7CiAgICByZXNvdXJjZUxvYWRlci5sb2FkKCk7Cn0sIGZhbHNlKTsK",
                "body": "Ly8gQ29weXJpZ2h0IChDKSAyMDEzIEdvb2dsZSBJbmMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vCi8vIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAovLyBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlCi8vIG1ldDoKLy8KLy8gICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKLy8gbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgovLyAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlCi8vIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIKLy8gaW4gdGhlIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZQovLyBkaXN0cmlidXRpb24uCi8vICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgR29vZ2xlIEluYy4gbm9yIHRoZSBuYW1lcyBvZiBpdHMKLy8gY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20KLy8gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KLy8KLy8gVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUwovLyAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVAovLyBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IKLy8gQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQKLy8gT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsCi8vIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QKLy8gTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsCi8vIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWQovLyBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUCi8vIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRQovLyBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgovLwovLyBAZmlsZW92ZXJ2aWV3IENyZWF0ZXMgYSBkYXNoYm9hcmQgZm9yIHRyYWNraW5nIG51bWJlciBvZiBwYXNzZXMvZmFpbHVyZXMgcGVyIHJ1bi4KLy8KLy8gQ3VycmVudGx5LCBvbmx5IHdlYmtpdCB0ZXN0cyBhcmUgc3VwcG9ydGVkLCBidXQgYWRkaW5nIG90aGVyIHRlc3QgdHlwZXMKLy8gc2hvdWxkIGp1c3QgcmVxdWlyZSB0aGUgZm9sbG93aW5nIHN0ZXBzOgovLyAgICAgLWdlbmVyYXRlIHJlc3VsdHMuanNvbiBmb3IgdGhlc2UgdGVzdHMKLy8gICAgIC1jb3B5IHRoZW0gdG8gdGhlIGFwcHJvcHJpYXRlIGxvY2F0aW9uCi8vICAgICAtYWRkIHRoZSBidWlsZGVyIG5hbWUgdG8gdGhlIGxpc3Qgb2YgYnVpbGRlcnMgaW4gZGFzaGJvYXJkX2Jhc2UuanMuCgpmdW5jdGlvbiBnZW5lcmF0ZVBhZ2UoaGlzdG9yeUluc3RhbmNlKQp7CiAgICB2YXIgaHRtbCA9IHVpLmh0bWwudGVzdFR5cGVTd2l0Y2hlcih0cnVlKSArICc8YnI+JzsKICAgIGZvciAodmFyIGJ1aWxkZXIgaW4gY3VycmVudEJ1aWxkZXJzKCkpCiAgICAgICAgaHRtbCArPSBodG1sRm9yQnVpbGRlcihidWlsZGVyKTsKICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gaHRtbDsKfQoKZnVuY3Rpb24gaGFuZGxlVmFsaWRIYXNoUGFyYW1ldGVyKGhpc3RvcnlJbnN0YW5jZSwga2V5LCB2YWx1ZSkKewogICAgc3dpdGNoKGtleSkgewogICAgY2FzZSAncmF3VmFsdWVzJzoKICAgICAgICBoaXN0b3J5SW5zdGFuY2UuZGFzaGJvYXJkU3BlY2lmaWNTdGF0ZVtrZXldID0gdmFsdWUgPT0gJ3RydWUnOwogICAgICAgIHJldHVybiB0cnVlOwoKICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9Cgp2YXIgZGVmYXVsdERhc2hib2FyZFNwZWNpZmljU3RhdGVWYWx1ZXMgPSB7CiAgICByYXdWYWx1ZXM6IGZhbHNlCn07CgoKdmFyIGFnZ3JlZ2F0ZVJlc3VsdHNDb25maWcgPSB7CiAgICBkZWZhdWx0U3RhdGVWYWx1ZXM6IGRlZmF1bHREYXNoYm9hcmRTcGVjaWZpY1N0YXRlVmFsdWVzLAogICAgZ2VuZXJhdGVQYWdlOiBnZW5lcmF0ZVBhZ2UsCiAgICBoYW5kbGVWYWxpZEhhc2hQYXJhbWV0ZXI6IGhhbmRsZVZhbGlkSGFzaFBhcmFtZXRlciwKfTsKCi8vIEZJWE1FKGpwYXJlbnQpOiBFdmVudHVhbGx5IHJlbW92ZSBhbGwgdXNhZ2Ugb2YgZ2xvYmFsIGhpc3Rvcnkgb2JqZWN0Lgp2YXIgZ19oaXN0b3J5ID0gbmV3IGhpc3RvcnkuSGlzdG9yeShhZ2dyZWdhdGVSZXN1bHRzQ29uZmlnKTsKZ19oaXN0b3J5LnBhcnNlQ3Jvc3NEYXNoYm9hcmRQYXJhbWV0ZXJzKCk7CgpmdW5jdGlvbiBodG1sRm9yQnVpbGRlcihidWlsZGVyKQp7CiAgICB2YXIgcmVzdWx0cyA9IGdfcmVzdWx0c0J5QnVpbGRlcltidWlsZGVyXTsKICAgIC8vIFNvbWUga2V5cyB3ZXJlIGFkZGVkIGxhdGVyIHRoYW4gb3RoZXJzLCBzbyB0aGV5IGRvbid0IGhhdmUgYXMgbWFueQogICAgLy8gYnVpbGRzLiBVc2UgdGhlIHNob3J0ZXN0LgogICAgLy8gRklYTUU6IE9uY2UgNTAwIHJ1bnMgaGF2ZSBmaW5pc2hlZCwgd2UgY2FuIGdldCByaWQgb2YgcGFzc2luZyB0aGlzCiAgICAvLyBhcm91bmQgYW5kIGp1c3QgYXNzdW1lIGFsbCBrZXlzIGhhdmUgdGhlIHNhbWUgbnVtYmVyIG9mIGJ1aWxkZXJzIGZvciBhCiAgICAvLyBnaXZlbiBidWlsZGVyLgogICAgdmFyIG51bUNvbHVtbnMgPSByZXN1bHRzW0FMTF9GSVhBQkxFX0NPVU5UX0tFWV0ubGVuZ3RoOwogICAgdmFyIGh0bWwgPSAnPGRpdiBjbGFzcz1jb250YWluZXI+PGgyPicgKyBidWlsZGVyICsgJzwvaDI+JzsKCiAgICBpZiAoZ19oaXN0b3J5LmRhc2hib2FyZFNwZWNpZmljU3RhdGUucmF3VmFsdWVzKQogICAgICAgIGh0bWwgKz0gcmF3VmFsdWVzSFRNTChyZXN1bHRzLCBudW1Db2x1bW5zKTsKICAgIGVsc2UgewogICAgICAgIGh0bWwgKz0gJzxhIGhyZWY9InRpbWVsaW5lX2V4cGxvcmVyLmh0bWwnICsgKGxvY2F0aW9uLmhhc2ggPyBsb2NhdGlvbi5oYXNoICsgJyYnIDogJyMnKSArICdidWlsZGVyPScgKyBidWlsZGVyICsgJyI+JyArCiAgICAgICAgICAgIGNoYXJ0SFRNTChyZXN1bHRzLCBudW1Db2x1bW5zKSArICc8L2E+JzsKICAgIH0KCiAgICBodG1sICs9ICc8L2Rpdj4nOwogICAgcmV0dXJuIGh0bWw7Cn0KCmZ1bmN0aW9uIHJhd1ZhbHVlc0hUTUwocmVzdWx0cywgbnVtQ29sdW1ucykKewogICAgdmFyIGh0bWwgPSBodG1sRm9yU3VtbWFyeVRhYmxlKHJlc3VsdHMsIG51bUNvbHVtbnMpICsKICAgICAgICBodG1sRm9yVGVzdFR5cGUocmVzdWx0cywgRklYQUJMRV9DT1VOVFNfS0VZLCBGSVhBQkxFX0RFU0NSSVBUSU9OLCBudW1Db2x1bW5zKTsKICAgIGlmIChnX2hpc3RvcnkuaXNMYXlvdXRUZXN0UmVzdWx0cygpKSB7CiAgICAgICAgaHRtbCArPSBodG1sRm9yVGVzdFR5cGUocmVzdWx0cywgREVGRVJSRURfQ09VTlRTX0tFWSwgREVGRVJSRURfREVTQ1JJUFRJT04sIG51bUNvbHVtbnMpICsKICAgICAgICAgICAgaHRtbEZvclRlc3RUeXBlKHJlc3VsdHMsIFdPTlRGSVhfQ09VTlRTX0tFWSwgV09OVEZJWF9ERVNDUklQVElPTiwgbnVtQ29sdW1ucyk7CiAgICB9CiAgICByZXR1cm4gaHRtbDsKfQoKZnVuY3Rpb24gY2hhcnRIVE1MKHJlc3VsdHMsIG51bUNvbHVtbnMpCnsKICAgIHZhciByZXZpc2lvbktleSA9IFdFQktJVF9SRVZJU0lPTlNfS0VZOwogICAgdmFyIHJldmlzaW9uTGFiZWwgPSAiV2ViS2l0IFJldmlzaW9uIjsKICAgIHZhciBzdGFydFJldmlzaW9uID0gcmVzdWx0c1tyZXZpc2lvbktleV1bbnVtQ29sdW1ucyAtIDFdOwogICAgdmFyIGVuZFJldmlzaW9uID0gcmVzdWx0c1tyZXZpc2lvbktleV1bMF07CgogICAgdmFyIGZpeGFibGUgPSByZXN1bHRzW0ZJWEFCTEVfQ09VTlRfS0VZXS5zbGljZSgwLCBudW1Db2x1bW5zKTsKICAgIHZhciBodG1sID0gY2hhcnQoIlRvdGFsIGZhaWxpbmciLCB7IiI6IGZpeGFibGV9LCByZXZpc2lvbkxhYmVsLCBzdGFydFJldmlzaW9uLCBlbmRSZXZpc2lvbik7CgogICAgdmFyIHZhbHVlcyA9IHZhbHVlc1BlckV4cGVjdGF0aW9uKHJlc3VsdHNbRklYQUJMRV9DT1VOVFNfS0VZXSwgbnVtQ29sdW1ucyk7CiAgICAvLyBEb24ndCBjYXJlIGFib3V0IG51bWJlciBvZiBwYXNzZXMgZm9yIHRoZSBjaGFydHMuCiAgICBkZWxldGUodmFsdWVzWydQJ10pOwoKICAgIHJldHVybiBodG1sICsgY2hhcnQoIkRldGFpbGVkIGJyZWFrZG93biIsIHZhbHVlcywgcmV2aXNpb25MYWJlbCwgc3RhcnRSZXZpc2lvbiwgZW5kUmV2aXNpb24pOwp9Cgp2YXIgTEFCRUxfQ09MT1JTID0gWydGRjAwMDAnLCAnMDBGRjAwJywgJzAwMDBGRicsICcwMDAwMDAnLCAnRkY2RUI0JywgJ0ZGQTgxMicsICc5QjMwRkYnLCAnMDBGRkNDJ107CgovLyBGSVhNRTogRmluZCBhIGJldHRlciB3YXkgdG8gZXhjbHVkZSBvdXRsaWVycy4gVGhpcyBpcyBqdXN0IHNvIHdlIGV4Y2x1ZGUKLy8gcnVucyB3aGVyZSBldmVyeSB0ZXN0IGZhaWxlZC4KdmFyIE1BWF9WQUxVRSA9IDEwMDAwOwoKZnVuY3Rpb24gZmlsdGVyZWRWYWx1ZXModmFsdWVzLCBkZXNpcmVkTnVtYmVyT2ZQb2ludHMpCnsKICAgIC8vIEZpbHRlciBvdXQgdmFsdWVzIHRvIG1ha2UgdGhlIGdyYXBoIGEgYml0IG1vcmUgcmVhZGFibGUgYW5kIHRvIGtlZXAgVVJMcwogICAgLy8gZnJvbSBleGNlZWRpbmcgdGhlIGJyb3dzZXJzIG1heCBsZW5ndGggcmVzdHJpY3Rpb24uCiAgICB2YXIgZmlsdGVyQW1vdW50ID0gTWF0aC5mbG9vcih2YWx1ZXMubGVuZ3RoIC8gZGVzaXJlZE51bWJlck9mUG9pbnRzKTsKICAgIGlmIChmaWx0ZXJBbW91bnQgPCAxKQogICAgICAgIHJldHVybiB2YWx1ZXM7CgogICAgcmV0dXJuIHZhbHVlcy5maWx0ZXIoZnVuY3Rpb24oZWxlbWVudCwgaW5kZXgsIGFycmF5KSB7CiAgICAgICAgLy8gSW5jbHVkZSB0aGUgbW9zdCByZWNlbnQgYW5kIG9sZGVzdCB2YWx1ZXMgYW5kIGV4Y2x1ZGUgb3V0bGllcnMuCiAgICAgICAgcmV0dXJuIChpbmRleCAlIGZpbHRlckFtb3VudCA9PSAwIHx8IGluZGV4ID09IGFycmF5Lmxlbmd0aCAtIDEpICYmIChhcnJheVtpbmRleF0gPCBNQVhfVkFMVUUgJiYgYXJyYXlbaW5kZXhdICE9IDApOwogICAgfSk7Cn0KCmZ1bmN0aW9uIGNoYXJ0VXJsKHRpdGxlLCB2YWx1ZXMsIHJldmlzaW9uTGFiZWwsIHN0YXJ0UmV2aXNpb24sIGVuZFJldmlzaW9uLCBkZXNpcmVkTnVtYmVyT2ZQb2ludHMpIHsKICAgIHZhciBtYXhWYWx1ZSA9IDA7CiAgICBmb3IgKHZhciBleHBlY3RhdGlvbiBpbiB2YWx1ZXMpCiAgICAgICAgbWF4VmFsdWUgPSBNYXRoLm1heChtYXhWYWx1ZSwgTWF0aC5tYXguYXBwbHkobnVsbCwgZmlsdGVyZWRWYWx1ZXModmFsdWVzW2V4cGVjdGF0aW9uXSwgZGVzaXJlZE51bWJlck9mUG9pbnRzKSkpOwoKICAgIHZhciBjaGFydERhdGEgPSAnJzsKICAgIHZhciBsYWJlbHMgPSAnJzsKICAgIHZhciBudW1MYWJlbHMgPSAwOwoKICAgIHZhciBmaXJzdCA9IHRydWU7CiAgICBmb3IgKHZhciBleHBlY3RhdGlvbiBpbiB2YWx1ZXMpIHsKICAgICAgICBjaGFydERhdGEgKz0gKGZpcnN0ID8gJ2U6JyA6ICcsJykgKyBleHRlbmRlZEVuY29kZShmaWx0ZXJlZFZhbHVlcyh2YWx1ZXNbZXhwZWN0YXRpb25dLCBkZXNpcmVkTnVtYmVyT2ZQb2ludHMpLnJldmVyc2UoKSwgbWF4VmFsdWUpOwoKICAgICAgICBpZiAoZXhwZWN0YXRpb24pIHsKICAgICAgICAgICAgbnVtTGFiZWxzKys7CiAgICAgICAgICAgIGxhYmVscyArPSAoZmlyc3QgPyAnJyA6ICd8JykgKyBleHBlY3RhdGlvbnNNYXAoKVtleHBlY3RhdGlvbl07CiAgICAgICAgfQogICAgICAgIGZpcnN0ID0gZmFsc2U7CiAgICB9CgogICAgdmFyIHVybCA9ICJodHRwOi8vY2hhcnQuYXBpcy5nb29nbGUuY29tL2NoYXJ0P2NodD1sYyZjaHM9NjAweDQwMCZjaGQ9IiArCiAgICAgICAgICAgIGNoYXJ0RGF0YSArICImY2hnPTE1LDE1LDEsMyZjaHh0PXgseCx5JmNoeGw9MTp8fCIgKyByZXZpc2lvbkxhYmVsICsKICAgICAgICAgICAgInwmY2h4cj0wLCIgKyBzdGFydFJldmlzaW9uICsgIiwiICsgZW5kUmV2aXNpb24gKyAifDIsMCwiICsgbWF4VmFsdWUgKyAiJmNodHQ9IiArIHRpdGxlOwoKCiAgICBpZiAobGFiZWxzKQogICAgICAgIHVybCArPSAiJmNoZGw9IiArIGxhYmVscyArICImY2hjbz0iICsgTEFCRUxfQ09MT1JTLnNsaWNlKDAsIG51bUxhYmVscykuam9pbignLCcpOwogICAgcmV0dXJuIHVybDsKfQoKZnVuY3Rpb24gY2hhcnQodGl0bGUsIHZhbHVlcywgcmV2aXNpb25MYWJlbCwgc3RhcnRSZXZpc2lvbiwgZW5kUmV2aXNpb24pCnsKICAgIHZhciBkZXNpcmVkTnVtYmVyT2ZQb2ludHMgPSA0MDA7CiAgICB2YXIgdXJsID0gY2hhcnRVcmwodGl0bGUsIHZhbHVlcywgcmV2aXNpb25MYWJlbCwgc3RhcnRSZXZpc2lvbiwgZW5kUmV2aXNpb24sIGRlc2lyZWROdW1iZXJPZlBvaW50cyk7CgogICAgd2hpbGUgKHVybC5sZW5ndGggPj0gMjA0OCkgewogICAgICAgIC8vIERlY3JlYXNlIHRoZSBkZXNpcmVkIG51bWJlciBvZiBwb2ludHMgZ3JhZHVhbGx5IHVudGlsIHdlIGdldCBhIFVSTCB0aGF0CiAgICAgICAgLy8gZG9lc24ndCBleGNlZWQgY2hhcnRzZXJ2ZXIncyBtYXggVVJMIGxlbmd0aC4KICAgICAgICBkZXNpcmVkTnVtYmVyT2ZQb2ludHMgPSAzIC8gNCAqIGRlc2lyZWROdW1iZXJPZlBvaW50czsKICAgICAgICB1cmwgPSBjaGFydFVybCh0aXRsZSwgdmFsdWVzLCByZXZpc2lvbkxhYmVsLCBzdGFydFJldmlzaW9uLCBlbmRSZXZpc2lvbiwgZGVzaXJlZE51bWJlck9mUG9pbnRzKTsKICAgIH0KCiAgICByZXR1cm4gJzxpbWcgc3JjPSInICsgdXJsICsgJyI+JzsKfQoKZnVuY3Rpb24gd3JhcEhUTUxJblRhYmxlKGRlc2NyaXB0aW9uLCBodG1sKQp7CiAgICByZXR1cm4gJzxoMz4nICsgZGVzY3JpcHRpb24gKyAnPC9oMz48dGFibGU+PHRib2R5PicgKyBodG1sICsgJzwvdGJvZHk+PC90YWJsZT4nOwp9CgpmdW5jdGlvbiBodG1sRm9yU3VtbWFyeVRhYmxlKHJlc3VsdHMsIG51bUNvbHVtbnMpCnsKICAgIHZhciBwZXJjZW50ID0gW107CiAgICB2YXIgZml4YWJsZSA9IHJlc3VsdHNbRklYQUJMRV9DT1VOVF9LRVldLnNsaWNlKDAsIG51bUNvbHVtbnMpOwogICAgdmFyIGFsbEZpeGFibGUgPSByZXN1bHRzW0FMTF9GSVhBQkxFX0NPVU5UX0tFWV0uc2xpY2UoMCwgbnVtQ29sdW1ucyk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bUNvbHVtbnM7IGkrKykgewogICAgICAgIHZhciBwZXJjZW50YWdlID0gMTAwICogKGFsbEZpeGFibGVbaV0gLSBmaXhhYmxlW2ldKSAvIGFsbEZpeGFibGVbaV07CiAgICAgICAgLy8gUm91bmQgdG8gdGhlIG5lYXJlc3QgdGVudGggb2YgYSBwZXJjZW50LgogICAgICAgIHBlcmNlbnQucHVzaChNYXRoLnJvdW5kKHBlcmNlbnRhZ2UgKiAxMCkgLyAxMCArICclJyk7CiAgICB9CiAgICB2YXIgaHRtbCA9IGh0bWxGb3JUYWJsZVJvdygnV2ViS2l0IFJldmlzaW9uJywgcmVzdWx0c1tXRUJLSVRfUkVWSVNJT05TX0tFWV0uc2xpY2UoMCwgbnVtQ29sdW1ucykpICsKICAgICAgICBodG1sRm9yVGFibGVSb3coJ1BlcmNlbnQgcGFzc2VkJywgcGVyY2VudCkgKwogICAgICAgIGh0bWxGb3JUYWJsZVJvdygnRmFpbHVyZXMgKGRlZHVwZWQpJywgZml4YWJsZSkgKwogICAgICAgIGh0bWxGb3JUYWJsZVJvdygnRml4YWJsZSBUZXN0cycsIGFsbEZpeGFibGUpOwogICAgcmV0dXJuIHdyYXBIVE1MSW5UYWJsZSgnU3VtbWFyeScsIGh0bWwpOwp9CgpmdW5jdGlvbiB2YWx1ZXNQZXJFeHBlY3RhdGlvbihjb3VudHMsIG51bUNvbHVtbnMpCnsKICAgIHZhciB2YWx1ZXMgPSB7fTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQ29sdW1uczsgaSsrKSB7CiAgICAgICAgZm9yICh2YXIgZXhwZWN0YXRpb24gaW4gZXhwZWN0YXRpb25zTWFwKCkpIHsKICAgICAgICAgICAgaWYgKGV4cGVjdGF0aW9uIGluIGNvdW50c1tpXSkgewogICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gY291bnRzW2ldW2V4cGVjdGF0aW9uXTsKICAgICAgICAgICAgICAgIGlmICghdmFsdWVzW2V4cGVjdGF0aW9uXSkKICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbZXhwZWN0YXRpb25dID0gW107CiAgICAgICAgICAgICAgICB2YWx1ZXNbZXhwZWN0YXRpb25dLnB1c2goY291bnQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHZhbHVlczsKfQoKZnVuY3Rpb24gaHRtbEZvclRlc3RUeXBlKHJlc3VsdHMsIGtleSwgZGVzY3JpcHRpb24sIG51bUNvbHVtbnMpCnsKICAgIHZhciBjb3VudHMgPSByZXN1bHRzW2tleV07CiAgICB2YXIgaHRtbCA9IGh0bWxGb3JUYWJsZVJvdygnV2ViS2l0IFJldmlzaW9uJywgcmVzdWx0c1tXRUJLSVRfUkVWSVNJT05TX0tFWV0uc2xpY2UoMCwgbnVtQ29sdW1ucykpOwogICAgdmFyIHZhbHVlcyA9IHZhbHVlc1BlckV4cGVjdGF0aW9uKGNvdW50cywgbnVtQ29sdW1ucyk7CiAgICBmb3IgKHZhciBleHBlY3RhdGlvbiBpbiB2YWx1ZXMpCiAgICAgICAgaHRtbCArPSBodG1sRm9yVGFibGVSb3coZXhwZWN0YXRpb25zTWFwKClbZXhwZWN0YXRpb25dLCB2YWx1ZXNbZXhwZWN0YXRpb25dKTsKICAgIHJldHVybiB3cmFwSFRNTEluVGFibGUoZGVzY3JpcHRpb24sIGh0bWwpOwp9CgpmdW5jdGlvbiBodG1sRm9yVGFibGVSb3coY29sdW1uTmFtZSwgdmFsdWVzKQp7CiAgICByZXR1cm4gJzx0cj48dGQ+JyArIGNvbHVtbk5hbWUgKyAnPC90ZD48dGQ+JyArIHZhbHVlcy5qb2luKCc8L3RkPjx0ZD4nKSArICc8L3RkPjwvdHI+JzsKfQoKLy8gVGFrZW4gZnJvbSBodHRwOi8vY29kZS5nb29nbGUuY29tL2FwaXMvY2hhcnQvZG9jcy9kYXRhX2Zvcm1hdHMuaHRtbC4KZnVuY3Rpb24gZXh0ZW5kZWRFbmNvZGUoYXJyVmFscywgbWF4VmFsKQp7CiAgICB2YXIgbWFwID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5LS4nOwogICAgdmFyIG1hcExlbmd0aCA9IG1hcC5sZW5ndGg7CiAgICB2YXIgbWFwTGVuZ3RoU3F1YXJlZCA9IG1hcExlbmd0aCAqIG1hcExlbmd0aDsKCiAgICB2YXIgY2hhcnREYXRhID0gJyc7CgogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFyclZhbHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAvLyBJbiBjYXNlIHRoZSBhcnJheSB2YWxzIHdlcmUgdHJhbnNsYXRlZCB0byBzdHJpbmdzLgogICAgICAgIHZhciBudW1lcmljVmFsID0gbmV3IE51bWJlcihhcnJWYWxzW2ldKTsKICAgICAgICAvLyBTY2FsZSB0aGUgdmFsdWUgdG8gbWF4VmFsLgogICAgICAgIHZhciBzY2FsZWRWYWwgPSBNYXRoLmZsb29yKG1hcExlbmd0aFNxdWFyZWQgKiBudW1lcmljVmFsIC8gbWF4VmFsKTsKCiAgICAgICAgaWYoc2NhbGVkVmFsID4gbWFwTGVuZ3RoU3F1YXJlZCAtIDEpCiAgICAgICAgICAgIGNoYXJ0RGF0YSArPSAiLi4iOwogICAgICAgIGVsc2UgaWYgKHNjYWxlZFZhbCA8IDApCiAgICAgICAgICAgIGNoYXJ0RGF0YSArPSAnX18nOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBDYWxjdWxhdGUgZmlyc3QgYW5kIHNlY29uZCBkaWdpdHMgYW5kIGFkZCB0aGVtIHRvIHRoZSBvdXRwdXQuCiAgICAgICAgICAgIHZhciBxdW90aWVudCA9IE1hdGguZmxvb3Ioc2NhbGVkVmFsIC8gbWFwTGVuZ3RoKTsKICAgICAgICAgICAgdmFyIHJlbWFpbmRlciA9IHNjYWxlZFZhbCAtIG1hcExlbmd0aCAqIHF1b3RpZW50OwogICAgICAgICAgICBjaGFydERhdGEgKz0gbWFwLmNoYXJBdChxdW90aWVudCkgKyBtYXAuY2hhckF0KHJlbWFpbmRlcik7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBjaGFydERhdGE7Cn0KCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgcmVzb3VyY2VMb2FkZXIgPSBuZXcgbG9hZGVyLkxvYWRlcigpOwogICAgcmVzb3VyY2VMb2FkZXIubG9hZCgpOwp9LCBmYWxzZSk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:50:00 GMT",
                    "Content-Length": "10429",
                    "Date": "Fri, 07 Nov 2014 21:51:14 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}