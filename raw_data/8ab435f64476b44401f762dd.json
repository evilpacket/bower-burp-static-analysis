{
    "url": "http://localhost:9999/aurigadl/WebODF/programs/viewer/viewer.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>location</b> and written to <b>document.title</b> via the following statements:<ul><li>url = location;</li><li>filename = url.replace(/^.*[\\\\\\/]/, '');</li><li>document.title = filename;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/aurigadl/WebODF/programs/viewer/viewer.js",
                "path": "/aurigadl/WebODF/programs/viewer/viewer.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hdXJpZ2FkbC9XZWJPREYvcHJvZ3JhbXMvdmlld2VyL3ZpZXdlci5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjAwMDENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFN1biwgMDkgTm92IDIwMTQgMDI6NDE6MDIgR01UDQpMYXN0LU1vZGlmaWVkOiBTdW4sIDA5IE5vdiAyMDE0IDAyOjQwOjM1IEdNVA0KDQovKioKICogQGxpY2Vuc2UKICogQ29weXJpZ2h0IChDKSAyMDEzIEtPIEdtYkggPGNvcHlyaWdodEBrb2dtYmguY29tPgogKgogKiBAbGljc3RhcnQKICogVGhlIEphdmFTY3JpcHQgY29kZSBpbiB0aGlzIHBhZ2UgaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQKICogYW5kL29yIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogKiAoR05VIEFHUEwpIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mCiAqIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLiAgVGhlIGNvZGUgaXMgZGlzdHJpYnV0ZWQKICogV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IKICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVSBBR1BMIGZvciBtb3JlIGRldGFpbHMuCiAqCiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogKiBhbG9uZyB3aXRoIHRoaXMgY29kZS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICoKICogQXMgYWRkaXRpb25hbCBwZXJtaXNzaW9uIHVuZGVyIEdOVSBBR1BMIHZlcnNpb24gMyBzZWN0aW9uIDcsIHlvdQogKiBtYXkgZGlzdHJpYnV0ZSBub24tc291cmNlIChlLmcuLCBtaW5pbWl6ZWQgb3IgY29tcGFjdGVkKSBmb3JtcyBvZgogKiB0aGF0IGNvZGUgd2l0aG91dCB0aGUgY29weSBvZiB0aGUgR05VIEdQTCBub3JtYWxseSByZXF1aXJlZCBieQogKiBzZWN0aW9uIDQsIHByb3ZpZGVkIHlvdSBpbmNsdWRlIHRoaXMgbGljZW5zZSBub3RpY2UgYW5kIGEgVVJMCiAqIHRocm91Z2ggd2hpY2ggcmVjaXBpZW50cyBjYW4gYWNjZXNzIHRoZSBDb3JyZXNwb25kaW5nIFNvdXJjZS4KICoKICogQXMgYSBzcGVjaWFsIGV4Y2VwdGlvbiB0byB0aGUgQUdQTCwgYW55IEhUTUwgZmlsZSB3aGljaCBtZXJlbHkgbWFrZXMgZnVuY3Rpb24KICogY2FsbHMgdG8gdGhpcyBjb2RlLCBhbmQgZm9yIHRoYXQgcHVycG9zZSBpbmNsdWRlcyBpdCBieSByZWZlcmVuY2Ugc2hhbGwgYmUKICogZGVlbWVkIGEgc2VwYXJhdGUgd29yayBmb3IgY29weXJpZ2h0IGxhdyBwdXJwb3Nlcy4gSW4gYWRkaXRpb24sIHRoZSBjb3B5cmlnaHQKICogaG9sZGVycyBvZiB0aGlzIGNvZGUgZ2l2ZSB5b3UgcGVybWlzc2lvbiB0byBjb21iaW5lIHRoaXMgY29kZSB3aXRoIGZyZWUKICogc29mdHdhcmUgbGlicmFyaWVzIHRoYXQgYXJlIHJlbGVhc2VkIHVuZGVyIHRoZSBHTlUgTEdQTC4gWW91IG1heSBjb3B5IGFuZAogKiBkaXN0cmlidXRlIHN1Y2ggYSBzeXN0ZW0gZm9sbG93aW5nIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFHUEwgZm9yIHRoaXMgY29kZQogKiBhbmQgdGhlIExHUEwgZm9yIHRoZSBsaWJyYXJpZXMuIElmIHlvdSBtb2RpZnkgdGhpcyBjb2RlLCB5b3UgbWF5IGV4dGVuZCB0aGlzCiAqIGV4Y2VwdGlvbiB0byB5b3VyIHZlcnNpb24gb2YgdGhlIGNvZGUsIGJ1dCB5b3UgYXJlIG5vdCBvYmxpZ2F0ZWQgdG8gZG8gc28uCiAqIElmIHlvdSBkbyBub3Qgd2lzaCB0byBkbyBzbywgZGVsZXRlIHRoaXMgZXhjZXB0aW9uIHN0YXRlbWVudCBmcm9tIHlvdXIKICogdmVyc2lvbi4KICoKICogVGhpcyBsaWNlbnNlIGFwcGxpZXMgdG8gdGhpcyBlbnRpcmUgY29tcGlsYXRpb24uCiAqIEBsaWNlbmQKICogQHNvdXJjZTogaHR0cDovL3d3dy53ZWJvZGYub3JnLwogKiBAc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20va29nbWJoL1dlYk9ERi8KICovCgovKmdsb2JhbCBkb2N1bWVudCwgd2luZG93Ki8KCmZ1bmN0aW9uIFZpZXdlcih2aWV3ZXJQbHVnaW4pIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAga1Njcm9sbGJhclBhZGRpbmcgPSA0MCwKICAgICAgICBrTWluU2NhbGUgPSAwLjI1LAogICAgICAgIGtNYXhTY2FsZSA9IDQuMCwKICAgICAgICBrRGVmYXVsdFNjYWxlRGVsdGEgPSAxLjEsCiAgICAgICAga0RlZmF1bHRTY2FsZSA9ICdhdXRvJywKICAgICAgICBwcmVzZW50YXRpb25Nb2RlID0gZmFsc2UsCiAgICAgICAgaW5pdGlhbGl6ZWQgPSBmYWxzZSwKICAgICAgICBpc1NsaWRlc2hvdyA9IGZhbHNlLAogICAgICAgIHVybCwKICAgICAgICB2aWV3ZXJFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZXdlcicpLAogICAgICAgIGNhbnZhc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXNDb250YWluZXInKSwKICAgICAgICBvdmVybGF5TmF2aWdhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ292ZXJsYXlOYXZpZ2F0b3InKSwKICAgICAgICBwYWdlU3dpdGNoZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9vbGJhckxlZnQnKSwKICAgICAgICB6b29tV2lkZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rvb2xiYXJNaWRkbGVDb250YWluZXInKSwKICAgICAgICBzY2FsZVNlbGVjdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYWxlU2VsZWN0JyksCiAgICAgICAgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5JyksCiAgICAgICAgdG9vbGJhclJpZ2h0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rvb2xiYXJSaWdodCcpLAogICAgICAgIGFib3V0RGlhbG9nLAogICAgICAgIGZpbGVuYW1lLAogICAgICAgIHBhZ2VzID0gW10sCiAgICAgICAgY3VycmVudFBhZ2UsCiAgICAgICAgc2NhbGVDaGFuZ2VUaW1lciwKICAgICAgICB0b3VjaFRpbWVyOwoKICAgIGZ1bmN0aW9uIGluaXRpYWxpemVBYm91dEluZm9ybWF0aW9uKCkgewogICAgICAgIHZhciBiYXNlZE9uRGl2LCBhYm91dEJ1dHRvbiwgcGx1Z2luTmFtZSwgcGx1Z2luVmVyc2lvbiwgcGx1Z2luVVJMOwoKICAgICAgICBpZiAodmlld2VyUGx1Z2luKSB7CiAgICAgICAgICAgIHBsdWdpbk5hbWUgPSB2aWV3ZXJQbHVnaW4uZ2V0UGx1Z2luTmFtZSgpOwogICAgICAgICAgICBwbHVnaW5WZXJzaW9uID0gdmlld2VyUGx1Z2luLmdldFBsdWdpblZlcnNpb24oKTsKICAgICAgICAgICAgcGx1Z2luVVJMID0gdmlld2VyUGx1Z2luLmdldFBsdWdpblVSTCgpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ3JlYXRlIGRpYWxvZwogICAgICAgIGFib3V0RGlhbG9nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgYWJvdXREaWFsb2cuaWQgPSAiYWJvdXREaWFsb2ciOwogICAgICAgIGFib3V0RGlhbG9nLmlubmVySFRNTCA9CiAgICAgICAgICAgICI8aDE+PGEgaHJlZiA9IFwiaHR0cDovL3ZpZXdlcmpzLm9yZ1wiIHRhcmdldD1cIl9ibGFua1wiPlZpZXdlckpTPC9hPjwvaDE+IiArCiAgICAgICAgICAgICI8cD48YSBocmVmID0gXCJodHRwOi8vbmxuZXQubmxcIiB0YXJnZXQ9XCJfYmxhbmtcIj48aW1nIHNyYz1cImltYWdlc1wvbmxuZXQucG5nXCIgd2lkdGg9XCIxNjBcIiBoZWlnaHQ9XCI2MFwiPjwvaW1nPjwvYT48L3A+IiArCiAgICAgICAgICAgICI8cD48YSBocmVmID0gXCJodHRwOi8va29nbWJoLmNvbVwiIHRhcmdldD1cIl9ibGFua1wiPjxpbWcgc3JjPVwiaW1hZ2VzXC9rb2dtYmgucG5nXCIgd2lkdGg9XCIxNzJcIiBoZWlnaHQ9XCI0MFwiPjwvaW1nPjwvYT48L3A+IiArCiAgICAgICAgICAgICh2aWV3ZXJQbHVnaW4gPyAoIjxwPlVzaW5nIHRoZSA8YSBocmVmID0gXCIiKyBwbHVnaW5VUkwgKyAiXCIgdGFyZ2V0PVwiX2JsYW5rXCI+IiArIHBsdWdpbk5hbWUgKyAiPC9hPiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIoPHNwYW4gaWQgPSBcInBsdWdpblZlcnNpb25cIj4iICsgcGx1Z2luVmVyc2lvbiArICI8L3NwYW4+KSAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwbHVnaW4gdG8gc2hvdyB5b3UgdGhpcyBkb2N1bWVudC48L3A+IikKICAgICAgICAgICAgICAgICAgICAgICAgIDogIiIpICsKICAgICAgICAgICAgIjxwPk1hZGUgYnkgPGEgaHJlZiA9IFwiaHR0cDovL2tvZ21iaC5jb21cIiB0YXJnZXQ9XCJfYmxhbmtcIj5LTyBHbWJIPC9hPi48L3A+IiArCiAgICAgICAgICAgICI8YnV0dG9uIGlkID0gXCJhYm91dERpYWxvZ0Nsb3NlQnV0dG9uXCIgY2xhc3MgPSBcInRvb2xiYXJCdXR0b24gdGV4dEJ1dHRvblwiPkNsb3NlPC9idXR0b24+IjsKICAgICAgICB2aWV3ZXJFbGVtZW50LmFwcGVuZENoaWxkKGFib3V0RGlhbG9nKTsKCiAgICAgICAgLy8gQ3JlYXRlICJiYXNlZCBvbiIgbGluZQogICAgICAgIGJhc2VkT25EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBiYXNlZE9uRGl2LmlkID0gImJhc2VkT24iOwogICAgICAgIGJhc2VkT25EaXYuaW5uZXJIVE1MID0KICAgICAgICAgICAgIkJhc2VkIG9uICIgKwogICAgICAgICAgICAiPGEgaHJlZiA9IFwiaHR0cDovL3dlYm9kZi5vcmdcIiB0YXJnZXQ9XCJfYmxhbmtcIj5XZWJPREY8L2E+IiArCiAgICAgICAgICAgICIgYnkgIiArCiAgICAgICAgICAgICI8YSBocmVmID0gXCJodHRwOi8va29nbWJoLmNvbVwiIHRhcmdldD1cIl9ibGFua1wiPktPPC9hPiI7CgogICAgICAgIHRvb2xiYXJSaWdodC5hcHBlbmRDaGlsZChiYXNlZE9uRGl2KTsKCiAgICAgICAgLy8gQ3JlYXRlIGJ1dHRvbiB0byBvcGVuIGRpYWxvZyB0aGF0IHNheXMgIlZpZXdlckpTIgogICAgICAgIGFib3V0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgICAgYWJvdXRCdXR0b24uaWQgPSAiYWJvdXQiOwogICAgICAgIGFib3V0QnV0dG9uLmNsYXNzTmFtZSA9ICJ0b29sYmFyQnV0dG9uIHRleHRCdXR0b24gYWJvdXQiOwogICAgICAgIGFib3V0QnV0dG9uLnRpdGxlID0gIkFib3V0IjsKICAgICAgICBhYm91dEJ1dHRvbi5pbm5lckhUTUwgPSAiVmlld2VySlMiCiAgICAgICAgdG9vbGJhclJpZ2h0LmFwcGVuZENoaWxkKGFib3V0QnV0dG9uKTsKCiAgICAgICAgLy8gQXR0YWNoIGV2ZW50cyB0byB0aGUgYWJvdmUKICAgICAgICBhYm91dEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNob3dBYm91dERpYWxvZygpOwogICAgICAgIH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhYm91dERpYWxvZ0Nsb3NlQnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBoaWRlQWJvdXREaWFsb2coKTsKICAgICAgICB9KTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2hvd0Fib3V0RGlhbG9nKCkgewogICAgICAgIGFib3V0RGlhbG9nLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIG92ZXJsYXkuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsKICAgIH0KCiAgICBmdW5jdGlvbiBoaWRlQWJvdXREaWFsb2coKSB7CiAgICAgICAgYWJvdXREaWFsb2cuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICBvdmVybGF5LnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0Z1bGxTY3JlZW4oKSB7CiAgICAvLyBOb3RlIHRoYXQgdGhlIGJyb3dzZXIgZnVsbHNjcmVlbiAodHJpZ2dlcmVkIGJ5IHNob3J0IGtleXMpIG1pZ2h0CiAgICAvLyBiZSBjb25zaWRlcmVkIGRpZmZlcmVudCBmcm9tIGNvbnRlbnQgZnVsbHNjcmVlbiB3aGVuIGV4cGVjdGluZyBhIGJvb2xlYW4KICAgICAgICByZXR1cm4gZG9jdW1lbnQuaXNGdWxsU2NyZWVuIHx8IGRvY3VtZW50Lm1vekZ1bGxTY3JlZW4gfHwgZG9jdW1lbnQud2Via2l0SXNGdWxsU2NyZWVuOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbGVjdFNjYWxlT3B0aW9uKHZhbHVlKSB7CiAgICAgICAgLy8gUmV0cmlldmUgdGhlIG9wdGlvbnMgZnJvbSB0aGUgem9vbSBsZXZlbCA8c2VsZWN0PiBlbGVtZW50CiAgICAgICAgdmFyIG9wdGlvbnMgPSBzY2FsZVNlbGVjdG9yLm9wdGlvbnMsCiAgICAgICAgICAgIG9wdGlvbiwKICAgICAgICAgICAgcHJlZGVmaW5lZFZhbHVlRm91bmQgPSBmYWxzZSwKICAgICAgICAgICAgaTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgb3B0aW9uID0gb3B0aW9uc1tpXTsKICAgICAgICAgICAgaWYgKG9wdGlvbi52YWx1ZSAhPT0gdmFsdWUpIHsKICAgICAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgcHJlZGVmaW5lZFZhbHVlRm91bmQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJlZGVmaW5lZFZhbHVlRm91bmQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UGFnZXMoKSB7CiAgICAgICAgcmV0dXJuIHZpZXdlclBsdWdpbi5nZXRQYWdlcygpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNjYWxlKHZhbCwgcmVzZXRBdXRvU2V0dGluZ3MsIG5vU2Nyb2xsKSB7CiAgICAgICAgaWYgKHZhbCA9PT0gc2VsZi5nZXRab29tTGV2ZWwoKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzZWxmLnNldFpvb21MZXZlbCh2YWwpOwoKICAgICAgICB2YXIgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnVUlFdmVudHMnKTsKICAgICAgICBldmVudC5pbml0VUlFdmVudCgnc2NhbGVjaGFuZ2UnLCBmYWxzZSwgZmFsc2UsIHdpbmRvdywgMCk7CiAgICAgICAgZXZlbnQuc2NhbGUgPSB2YWw7CiAgICAgICAgZXZlbnQucmVzZXRBdXRvU2V0dGluZ3MgPSByZXNldEF1dG9TZXR0aW5nczsKICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICB9CgogICAgZnVuY3Rpb24gb25TY3JvbGwoKSB7CiAgICAgICAgdmFyIHBhZ2VOdW1iZXI7CgogICAgICAgIGlmICh2aWV3ZXJQbHVnaW4ub25TY3JvbGwpIHsKICAgICAgICAgICAgdmlld2VyUGx1Z2luLm9uU2Nyb2xsKCk7CiAgICAgICAgfQogICAgICAgIGlmICh2aWV3ZXJQbHVnaW4uZ2V0UGFnZUluVmlldykgewogICAgICAgICAgICBwYWdlTnVtYmVyID0gdmlld2VyUGx1Z2luLmdldFBhZ2VJblZpZXcoKTsKICAgICAgICAgICAgaWYgKHBhZ2VOdW1iZXIpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gcGFnZU51bWJlcjsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlTnVtYmVyJykudmFsdWUgPSBwYWdlTnVtYmVyOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRlbGF5ZWRSZWZyZXNoKG1pbGxpc2Vjb25kcykgewogICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQoc2NhbGVDaGFuZ2VUaW1lcik7CiAgICAgICAgc2NhbGVDaGFuZ2VUaW1lciA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgb25TY3JvbGwoKTsKICAgICAgICB9LCBtaWxsaXNlY29uZHMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlU2NhbGUodmFsdWUsIHJlc2V0QXV0b1NldHRpbmdzLCBub1Njcm9sbCkgewogICAgICAgIHZhciBzY2FsZSwKICAgICAgICAgICAgbWF4V2lkdGgsCiAgICAgICAgICAgIG1heEhlaWdodDsKCiAgICAgICAgaWYgKHZhbHVlID09PSAnY3VzdG9tJykgewogICAgICAgICAgICBzY2FsZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1c3RvbVNjYWxlT3B0aW9uJykudGV4dENvbnRlbnQpIC8gMTAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNjYWxlID0gcGFyc2VGbG9hdCh2YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2NhbGUpIHsKICAgICAgICAgICAgc2V0U2NhbGUoc2NhbGUsIHRydWUsIG5vU2Nyb2xsKTsKICAgICAgICAgICAgZGVsYXllZFJlZnJlc2goMzAwKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbWF4V2lkdGggPSBjYW52YXNDb250YWluZXIuY2xpZW50V2lkdGggLSBrU2Nyb2xsYmFyUGFkZGluZzsKICAgICAgICBtYXhIZWlnaHQgPSBjYW52YXNDb250YWluZXIuY2xpZW50SGVpZ2h0IC0ga1Njcm9sbGJhclBhZGRpbmc7CgogICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICBjYXNlICdwYWdlLWFjdHVhbCc6CiAgICAgICAgICAgIHNldFNjYWxlKDEsIHJlc2V0QXV0b1NldHRpbmdzLCBub1Njcm9sbCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3BhZ2Utd2lkdGgnOgogICAgICAgICAgICB2aWV3ZXJQbHVnaW4uZml0VG9XaWR0aChtYXhXaWR0aCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3BhZ2UtaGVpZ2h0JzoKICAgICAgICAgICAgdmlld2VyUGx1Z2luLmZpdFRvSGVpZ2h0KG1heEhlaWdodCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3BhZ2UtZml0JzoKICAgICAgICAgICAgdmlld2VyUGx1Z2luLmZpdFRvUGFnZShtYXhXaWR0aCwgbWF4SGVpZ2h0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnYXV0byc6CiAgICAgICAgICAgIGlmICh2aWV3ZXJQbHVnaW4uaXNTbGlkZXNob3coKSkgewogICAgICAgICAgICAgICAgdmlld2VyUGx1Z2luLmZpdFRvUGFnZShtYXhXaWR0aCArIGtTY3JvbGxiYXJQYWRkaW5nLCBtYXhIZWlnaHQgKyBrU2Nyb2xsYmFyUGFkZGluZyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2aWV3ZXJQbHVnaW4uZml0U21hcnQobWF4V2lkdGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgc2VsZWN0U2NhbGVPcHRpb24odmFsdWUpOwogICAgICAgIGRlbGF5ZWRSZWZyZXNoKDMwMCk7CiAgICB9CgogICAgCiAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxvY2F0aW9uID0gU3RyaW5nKGRvY3VtZW50LmxvY2F0aW9uKSwKICAgICAgICAgICAgcG9zID0gbG9jYXRpb24uaW5kZXhPZignIycpLAogICAgICAgICAgICBlbGVtZW50OwoKICAgICAgICBsb2NhdGlvbiA9IGxvY2F0aW9uLnN1YnN0cihwb3MgKyAxKTsKICAgICAgICBpZiAocG9zID09PSAtMSB8fCBsb2NhdGlvbi5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0NvdWxkIG5vdCBwYXJzZSBmaWxlIHBhdGggYXJndW1lbnQuJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHVybCA9IGxvY2F0aW9uOwogICAgICAgIGZpbGVuYW1lID0gdXJsLnJlcGxhY2UoL14uKltcXFwvXS8sICcnKTsKICAgICAgICBkb2N1bWVudC50aXRsZSA9IGZpbGVuYW1lOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb2N1bWVudE5hbWUnKS5pbm5lckhUTUwgPSBkb2N1bWVudC50aXRsZTsKCiAgICAgICAgdmlld2VyUGx1Z2luLm9uTG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsdWdpblZlcnNpb24nKS5pbm5lckhUTUwgPSB2aWV3ZXJQbHVnaW4uZ2V0UGx1Z2luVmVyc2lvbigpOwoKICAgICAgICAgICAgaXNTbGlkZXNob3cgPSB2aWV3ZXJQbHVnaW4uaXNTbGlkZXNob3coKTsKICAgICAgICAgICAgaWYgKGlzU2xpZGVzaG93KSB7CiAgICAgICAgICAgICAgICAvLyBObyBwYWRkaW5nIGZvciBzbGlkZXNob3dzCiAgICAgICAgICAgICAgICBjYW52YXNDb250YWluZXIuc3R5bGUucGFkZGluZyA9IDA7CiAgICAgICAgICAgICAgICAvLyBTaG93IHBhZ2UgbmF2IGNvbnRyb2xzIG9ubHkgZm9yIHByZXNlbnRhdGlvbnMKICAgICAgICAgICAgICAgIHBhZ2VTd2l0Y2hlci5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRm9yIHRleHQgZG9jdW1lbnRzLCBzaG93IHRoZSB6b29tIHdpZGdldC4KICAgICAgICAgICAgICAgIHpvb21XaWRnZXQuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKICAgICAgICAgICAgICAgIC8vIE9ubHkgc2hvdyB0aGUgcGFnZSBzd2l0Y2hlciB3aWRnZXQgaWYgdGhlIHBsdWdpbiBzdXBwb3J0cyBwYWdlIG51bWJlcnMKICAgICAgICAgICAgICAgIGlmICh2aWV3ZXJQbHVnaW4uZ2V0UGFnZUluVmlldykgewogICAgICAgICAgICAgICAgICAgIHBhZ2VTd2l0Y2hlci5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgICAgIHBhZ2VzID0gZ2V0UGFnZXMoKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bVBhZ2VzJykuaW5uZXJIVE1MID0gJ29mICcgKyBwYWdlcy5sZW5ndGg7CgogICAgICAgICAgICBzZWxmLnNob3dQYWdlKDEpOwoKICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgc2NhbGUKICAgICAgICAgICAgcGFyc2VTY2FsZShrRGVmYXVsdFNjYWxlKTsKCiAgICAgICAgICAgIGNhbnZhc0NvbnRhaW5lci5vbnNjcm9sbCA9IG9uU2Nyb2xsOwogICAgICAgICAgICBkZWxheWVkUmVmcmVzaCgpOwogICAgICAgIH07CgogICAgICAgIHZpZXdlclBsdWdpbi5pbml0aWFsaXplKGNhbnZhc0NvbnRhaW5lciwgbG9jYXRpb24pOwogICAgfTsKCiAgICAvKioKICAgICAqIFNob3dzIHRoZSAnbid0aCBwYWdlLiBJZiBuIGlzIGxhcmdlciB0aGFuIHRoZSBwYWdlIGNvdW50LAogICAgICogc2hvd3MgdGhlIGxhc3QgcGFnZS4gSWYgbiBpcyBsZXNzIHRoYW4gMSwgc2hvd3MgdGhlIGZpcnN0IHBhZ2UuCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIHRoaXMuc2hvd1BhZ2UgPSBmdW5jdGlvbiAobikgewogICAgICAgIGlmIChuIDw9IDApIHsKICAgICAgICAgICAgbiA9IDE7CiAgICAgICAgfSBlbHNlIGlmIChuID4gcGFnZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIG4gPSBwYWdlcy5sZW5ndGg7CiAgICAgICAgfQoKICAgICAgICB2aWV3ZXJQbHVnaW4uc2hvd1BhZ2Uobik7CgogICAgICAgIGN1cnJlbnRQYWdlID0gbjsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFnZU51bWJlcicpLnZhbHVlID0gY3VycmVudFBhZ2U7CiAgICB9OwoKICAgIC8qKgogICAgICogU2hvd3MgdGhlIG5leHQgcGFnZS4gSWYgdGhlcmUgaXMgbm8gc3Vic2VxdWVudCBwYWdlLCBkb2VzIG5vdGhpbmcuCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIHRoaXMuc2hvd05leHRQYWdlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHNlbGYuc2hvd1BhZ2UoY3VycmVudFBhZ2UgKyAxKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBTaG93cyB0aGUgcHJldmlvdXMgcGFnZS4gSWYgdGhlcmUgaXMgbm8gcHJldmlvdXMgcGFnZSwgZG9lcyBub3RoaW5nLgogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICB0aGlzLnNob3dQcmV2aW91c1BhZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgc2VsZi5zaG93UGFnZShjdXJyZW50UGFnZSAtIDEpOwogICAgfTsKCiAgICAvKioKICAgICAqIEF0dGVtcHRzIHRvICdkb3dubG9hZCcgdGhlIGZpbGUuCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIHRoaXMuZG93bmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRvY3VtZW50VXJsID0gdXJsLnNwbGl0KCcjJylbMF07CiAgICAgICAgZG9jdW1lbnRVcmwgKz0gJyN2aWV3ZXIuYWN0aW9uPWRvd25sb2FkJzsKICAgICAgICB3aW5kb3cub3Blbihkb2N1bWVudFVybCwgJ19wYXJlbnQnKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBUb2dnbGVzIHRoZSBmdWxsc2NyZWVuIHN0YXRlIG9mIHRoZSB2aWV3ZXIKICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgdGhpcy50b2dnbGVGdWxsU2NyZWVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlbGVtID0gdmlld2VyRWxlbWVudDsKICAgICAgICBpZiAoIWlzRnVsbFNjcmVlbigpKSB7CiAgICAgICAgICAgIGlmIChlbGVtLnJlcXVlc3RGdWxsU2NyZWVuKSB7CiAgICAgICAgICAgICAgICBlbGVtLnJlcXVlc3RGdWxsU2NyZWVuKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbS5tb3pSZXF1ZXN0RnVsbFNjcmVlbikgewogICAgICAgICAgICAgICAgZWxlbS5tb3pSZXF1ZXN0RnVsbFNjcmVlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0ud2Via2l0UmVxdWVzdEZ1bGxTY3JlZW4pIHsKICAgICAgICAgICAgICAgIGVsZW0ud2Via2l0UmVxdWVzdEZ1bGxTY3JlZW4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5jYW5jZWxGdWxsU2NyZWVuKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5jYW5jZWxGdWxsU2NyZWVuKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbikgewogICAgICAgICAgICAgICAgZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LndlYmtpdENhbmNlbEZ1bGxTY3JlZW4pIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LndlYmtpdENhbmNlbEZ1bGxTY3JlZW4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAKICAgIC8qKgogICAgICogVG9nZ2xlcyB0aGUgcHJlc2VudGF0aW9uIG1vZGUgb2YgdGhlIHZpZXdlci4KICAgICAqIFByZXNlbnRhdGlvbiBtb2RlIGludm9sdmVzIGZ1bGxzY3JlZW4gKyBoaWRkZW4gVUkgY29udHJvbHMKICAgICAqLwogICAgdGhpcy50b2dnbGVQcmVzZW50YXRpb25Nb2RlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0aXRsZWJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZWJhcicpLAogICAgICAgICAgICB0b29sYmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rvb2xiYXJDb250YWluZXInKSwKICAgICAgICAgICAgb3ZlcmxheUNsb3NlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ292ZXJsYXlDbG9zZUJ1dHRvbicpOwoKICAgICAgICBpZiAoIXByZXNlbnRhdGlvbk1vZGUpIHsKICAgICAgICAgICAgdGl0bGViYXIuc3R5bGUuZGlzcGxheSA9IHRvb2xiYXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgb3ZlcmxheUNsb3NlQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICBjYW52YXNDb250YWluZXIuY2xhc3NOYW1lID0gJ3ByZXNlbnRhdGlvbk1vZGUnOwogICAgICAgICAgICBpc1NsaWRlc2hvdyA9IHRydWU7CiAgICAgICAgICAgIGNhbnZhc0NvbnRhaW5lci5vbm1vdXNlZG93biA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY2FudmFzQ29udGFpbmVyLm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNhbnZhc0NvbnRhaW5lci5vbm1vdXNldXAgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dOZXh0UGFnZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dQcmV2aW91c1BhZ2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgcGFyc2VTY2FsZSgncGFnZS1maXQnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aXRsZWJhci5zdHlsZS5kaXNwbGF5ID0gdG9vbGJhci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgb3ZlcmxheUNsb3NlQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGNhbnZhc0NvbnRhaW5lci5jbGFzc05hbWUgPSAnJzsKICAgICAgICAgICAgY2FudmFzQ29udGFpbmVyLm9ubW91c2V1cCA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgICBjYW52YXNDb250YWluZXIub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgICBjYW52YXNDb250YWluZXIub25tb3VzZWRvd24gPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICAgICAgcGFyc2VTY2FsZSgnYXV0bycpOwogICAgICAgICAgICBpc1NsaWRlc2hvdyA9IHZpZXdlclBsdWdpbi5pc1NsaWRlc2hvdygpOwogICAgICAgIH0KCiAgICAgICAgcHJlc2VudGF0aW9uTW9kZSA9ICFwcmVzZW50YXRpb25Nb2RlOwogICAgfTsKCiAgICAvKioKICAgICAqIEdldHMgdGhlIHpvb20gbGV2ZWwgb2YgdGhlIGRvY3VtZW50CiAgICAgKiBAcmV0dXJuIHshbnVtYmVyfQogICAgICovCiAgICB0aGlzLmdldFpvb21MZXZlbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdmlld2VyUGx1Z2luLmdldFpvb21MZXZlbCgpOwogICAgfTsKCiAgICAvKioKICAgICAqIFNldCB0aGUgem9vbSBsZXZlbCBvZiB0aGUgZG9jdW1lbnQKICAgICAqIEBwYXJhbSB7IW51bWJlcn0gdmFsdWUKICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgdGhpcy5zZXRab29tTGV2ZWwgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICB2aWV3ZXJQbHVnaW4uc2V0Wm9vbUxldmVsKHZhbHVlKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBab29tIG91dCBieSAxMCAlCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIHRoaXMuem9vbU91dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyAxMCAlIGRlY3JlbWVudAogICAgICAgIHZhciBuZXdTY2FsZSA9IChzZWxmLmdldFpvb21MZXZlbCgpIC8ga0RlZmF1bHRTY2FsZURlbHRhKS50b0ZpeGVkKDIpOwogICAgICAgIG5ld1NjYWxlID0gTWF0aC5tYXgoa01pblNjYWxlLCBuZXdTY2FsZSk7CiAgICAgICAgcGFyc2VTY2FsZShuZXdTY2FsZSwgdHJ1ZSk7CiAgICB9OwoKICAgIC8qKgogICAgICogWm9vbSBpbiBieSAxMCUKICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgdGhpcy56b29tSW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gMTAgJSBpbmNyZW1lbnQKICAgICAgICB2YXIgbmV3U2NhbGUgPSAoc2VsZi5nZXRab29tTGV2ZWwoKSAqIGtEZWZhdWx0U2NhbGVEZWx0YSkudG9GaXhlZCgyKTsKICAgICAgICBuZXdTY2FsZSA9IE1hdGgubWluKGtNYXhTY2FsZSwgbmV3U2NhbGUpOwogICAgICAgIHBhcnNlU2NhbGUobmV3U2NhbGUsIHRydWUpOwogICAgfTsKCiAgICBmdW5jdGlvbiBjYW5jZWxQcmVzZW50YXRpb25Nb2RlKCkgewogICAgICAgIGlmIChwcmVzZW50YXRpb25Nb2RlICYmICFpc0Z1bGxTY3JlZW4oKSkgewogICAgICAgICAgICBzZWxmLnRvZ2dsZVByZXNlbnRhdGlvbk1vZGUoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2hvd092ZXJsYXlOYXZpZ2F0b3IoKSB7CiAgICAgICAgaWYgKGlzU2xpZGVzaG93KSB7CiAgICAgICAgICAgIG92ZXJsYXlOYXZpZ2F0b3IuY2xhc3NOYW1lID0gJ3RvdWNoZWQnOwogICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRvdWNoVGltZXIpOwogICAgICAgICAgICB0b3VjaFRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgb3ZlcmxheU5hdmlnYXRvci5jbGFzc05hbWUgPSAnJzsKICAgICAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CgogICAgICAgIGluaXRpYWxpemVBYm91dEluZm9ybWF0aW9uKCk7CgogICAgICAgIGlmICh2aWV3ZXJQbHVnaW4pIHsKICAgICAgICAgICAgc2VsZi5pbml0aWFsaXplKCk7CgogICAgICAgICAgICBpZiAoIShkb2N1bWVudC5jYW5jZWxGdWxsU2NyZWVuIHx8IGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4gfHwgZG9jdW1lbnQud2Via2l0Q2FuY2VsRnVsbFNjcmVlbikpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmdWxsc2NyZWVuJykuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheUNsb3NlQnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZWxmLnRvZ2dsZUZ1bGxTY3JlZW4pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnVsbHNjcmVlbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi50b2dnbGVGdWxsU2NyZWVuKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXNlbnRhdGlvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCFpc0Z1bGxTY3JlZW4oKSkgewogICAgICAgICAgICAgICAgICAgIHNlbGYudG9nZ2xlRnVsbFNjcmVlbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2VsZi50b2dnbGVQcmVzZW50YXRpb25Nb2RlKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmNoYW5nZScsIGNhbmNlbFByZXNlbnRhdGlvbk1vZGUpOwogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlJywgY2FuY2VsUHJlc2VudGF0aW9uTW9kZSk7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5jaGFuZ2UnLCBjYW5jZWxQcmVzZW50YXRpb25Nb2RlKTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2VsZi5kb3dubG9hZCgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd6b29tT3V0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLnpvb21PdXQoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnem9vbUluJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLnpvb21JbigpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2aW91cycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2VsZi5zaG93UHJldmlvdXNQYWdlKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuc2hvd05leHRQYWdlKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZpb3VzUGFnZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2VsZi5zaG93UHJldmlvdXNQYWdlKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHRQYWdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNob3dOZXh0UGFnZSgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlTnVtYmVyJykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2VsZi5zaG93UGFnZSh0aGlzLnZhbHVlKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhbGVTZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBwYXJzZVNjYWxlKHRoaXMudmFsdWUpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhbnZhc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNob3dPdmVybGF5TmF2aWdhdG9yKTsKICAgICAgICAgICAgb3ZlcmxheU5hdmlnYXRvci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNob3dPdmVybGF5TmF2aWdhdG9yKTsKCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY2FsZWNoYW5nZScsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBjdXN0b21TY2FsZU9wdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXN0b21TY2FsZU9wdGlvbicpLAogICAgICAgICAgICAgICAgICAgIHByZWRlZmluZWRWYWx1ZUZvdW5kID0gc2VsZWN0U2NhbGVPcHRpb24oU3RyaW5nKGV2dC5zY2FsZSkpOwoKICAgICAgICAgICAgICAgIGN1c3RvbVNjYWxlT3B0aW9uLnNlbGVjdGVkID0gZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKCFwcmVkZWZpbmVkVmFsdWVGb3VuZCkgewogICAgICAgICAgICAgICAgICAgIGN1c3RvbVNjYWxlT3B0aW9uLnRleHRDb250ZW50ID0gTWF0aC5yb3VuZChldnQuc2NhbGUgKiAxMDAwMCkgLyAxMDAgKyAnJSc7CiAgICAgICAgICAgICAgICAgICAgY3VzdG9tU2NhbGVPcHRpb24uc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB0cnVlKTsKCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICBpZiAoaW5pdGlhbGl6ZWQgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2VXaWR0aE9wdGlvbicpLnNlbGVjdGVkIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2VBdXRvT3B0aW9uJykuc2VsZWN0ZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyc2VTY2FsZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhbGVTZWxlY3QnKS52YWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG93T3ZlcmxheU5hdmlnYXRvcigpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICAgICAgdmFyIGtleSA9IGV2dC5rZXlDb2RlLAogICAgICAgICAgICAgICAgICAgIHNoaWZ0S2V5ID0gZXZ0LnNoaWZ0S2V5OwoKICAgICAgICAgICAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgICAgICAgICAgICBjYXNlIDMzOiAvLyBwYWdlVXAKICAgICAgICAgICAgICAgIGNhc2UgMzg6IC8vIHVwCiAgICAgICAgICAgICAgICBjYXNlIDM3OiAvLyBsZWZ0CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93UHJldmlvdXNQYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM0OiAvLyBwYWdlRG93bgogICAgICAgICAgICAgICAgY2FzZSA0MDogLy8gZG93bgogICAgICAgICAgICAgICAgY2FzZSAzOTogLy8gcmlnaHQKICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dOZXh0UGFnZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAzMjogLy8gc3BhY2UKICAgICAgICAgICAgICAgICAgICBzaGlmdEtleSA/IHNlbGYuc2hvd1ByZXZpb3VzUGFnZSgpIDogc2VsZi5zaG93TmV4dFBhZ2UoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIGluaXQoKTsKfQo=",
                "body": "LyoqCiAqIEBsaWNlbnNlCiAqIENvcHlyaWdodCAoQykgMjAxMyBLTyBHbWJIIDxjb3B5cmlnaHRAa29nbWJoLmNvbT4KICoKICogQGxpY3N0YXJ0CiAqIFRoZSBKYXZhU2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0CiAqIGFuZC9vciBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICogKEdOVSBBR1BMKSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZgogKiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4gIFRoZSBjb2RlIGlzIGRpc3RyaWJ1dGVkCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUgQUdQTCBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICogYWxvbmcgd2l0aCB0aGlzIGNvZGUuICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiAqCiAqIEFzIGFkZGl0aW9uYWwgcGVybWlzc2lvbiB1bmRlciBHTlUgQUdQTCB2ZXJzaW9uIDMgc2VjdGlvbiA3LCB5b3UKICogbWF5IGRpc3RyaWJ1dGUgbm9uLXNvdXJjZSAoZS5nLiwgbWluaW1pemVkIG9yIGNvbXBhY3RlZCkgZm9ybXMgb2YKICogdGhhdCBjb2RlIHdpdGhvdXQgdGhlIGNvcHkgb2YgdGhlIEdOVSBHUEwgbm9ybWFsbHkgcmVxdWlyZWQgYnkKICogc2VjdGlvbiA0LCBwcm92aWRlZCB5b3UgaW5jbHVkZSB0aGlzIGxpY2Vuc2Ugbm90aWNlIGFuZCBhIFVSTAogKiB0aHJvdWdoIHdoaWNoIHJlY2lwaWVudHMgY2FuIGFjY2VzcyB0aGUgQ29ycmVzcG9uZGluZyBTb3VyY2UuCiAqCiAqIEFzIGEgc3BlY2lhbCBleGNlcHRpb24gdG8gdGhlIEFHUEwsIGFueSBIVE1MIGZpbGUgd2hpY2ggbWVyZWx5IG1ha2VzIGZ1bmN0aW9uCiAqIGNhbGxzIHRvIHRoaXMgY29kZSwgYW5kIGZvciB0aGF0IHB1cnBvc2UgaW5jbHVkZXMgaXQgYnkgcmVmZXJlbmNlIHNoYWxsIGJlCiAqIGRlZW1lZCBhIHNlcGFyYXRlIHdvcmsgZm9yIGNvcHlyaWdodCBsYXcgcHVycG9zZXMuIEluIGFkZGl0aW9uLCB0aGUgY29weXJpZ2h0CiAqIGhvbGRlcnMgb2YgdGhpcyBjb2RlIGdpdmUgeW91IHBlcm1pc3Npb24gdG8gY29tYmluZSB0aGlzIGNvZGUgd2l0aCBmcmVlCiAqIHNvZnR3YXJlIGxpYnJhcmllcyB0aGF0IGFyZSByZWxlYXNlZCB1bmRlciB0aGUgR05VIExHUEwuIFlvdSBtYXkgY29weSBhbmQKICogZGlzdHJpYnV0ZSBzdWNoIGEgc3lzdGVtIGZvbGxvd2luZyB0aGUgdGVybXMgb2YgdGhlIEdOVSBBR1BMIGZvciB0aGlzIGNvZGUKICogYW5kIHRoZSBMR1BMIGZvciB0aGUgbGlicmFyaWVzLiBJZiB5b3UgbW9kaWZ5IHRoaXMgY29kZSwgeW91IG1heSBleHRlbmQgdGhpcwogKiBleGNlcHRpb24gdG8geW91ciB2ZXJzaW9uIG9mIHRoZSBjb2RlLCBidXQgeW91IGFyZSBub3Qgb2JsaWdhdGVkIHRvIGRvIHNvLgogKiBJZiB5b3UgZG8gbm90IHdpc2ggdG8gZG8gc28sIGRlbGV0ZSB0aGlzIGV4Y2VwdGlvbiBzdGF0ZW1lbnQgZnJvbSB5b3VyCiAqIHZlcnNpb24uCiAqCiAqIFRoaXMgbGljZW5zZSBhcHBsaWVzIHRvIHRoaXMgZW50aXJlIGNvbXBpbGF0aW9uLgogKiBAbGljZW5kCiAqIEBzb3VyY2U6IGh0dHA6Ly93d3cud2Vib2RmLm9yZy8KICogQHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2tvZ21iaC9XZWJPREYvCiAqLwoKLypnbG9iYWwgZG9jdW1lbnQsIHdpbmRvdyovCgpmdW5jdGlvbiBWaWV3ZXIodmlld2VyUGx1Z2luKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGtTY3JvbGxiYXJQYWRkaW5nID0gNDAsCiAgICAgICAga01pblNjYWxlID0gMC4yNSwKICAgICAgICBrTWF4U2NhbGUgPSA0LjAsCiAgICAgICAga0RlZmF1bHRTY2FsZURlbHRhID0gMS4xLAogICAgICAgIGtEZWZhdWx0U2NhbGUgPSAnYXV0bycsCiAgICAgICAgcHJlc2VudGF0aW9uTW9kZSA9IGZhbHNlLAogICAgICAgIGluaXRpYWxpemVkID0gZmFsc2UsCiAgICAgICAgaXNTbGlkZXNob3cgPSBmYWxzZSwKICAgICAgICB1cmwsCiAgICAgICAgdmlld2VyRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWV3ZXInKSwKICAgICAgICBjYW52YXNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzQ29udGFpbmVyJyksCiAgICAgICAgb3ZlcmxheU5hdmlnYXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5TmF2aWdhdG9yJyksCiAgICAgICAgcGFnZVN3aXRjaGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rvb2xiYXJMZWZ0JyksCiAgICAgICAgem9vbVdpZGdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b29sYmFyTWlkZGxlQ29udGFpbmVyJyksCiAgICAgICAgc2NhbGVTZWxlY3RvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FsZVNlbGVjdCcpLAogICAgICAgIG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3ZlcmxheScpLAogICAgICAgIHRvb2xiYXJSaWdodCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b29sYmFyUmlnaHQnKSwKICAgICAgICBhYm91dERpYWxvZywKICAgICAgICBmaWxlbmFtZSwKICAgICAgICBwYWdlcyA9IFtdLAogICAgICAgIGN1cnJlbnRQYWdlLAogICAgICAgIHNjYWxlQ2hhbmdlVGltZXIsCiAgICAgICAgdG91Y2hUaW1lcjsKCiAgICBmdW5jdGlvbiBpbml0aWFsaXplQWJvdXRJbmZvcm1hdGlvbigpIHsKICAgICAgICB2YXIgYmFzZWRPbkRpdiwgYWJvdXRCdXR0b24sIHBsdWdpbk5hbWUsIHBsdWdpblZlcnNpb24sIHBsdWdpblVSTDsKCiAgICAgICAgaWYgKHZpZXdlclBsdWdpbikgewogICAgICAgICAgICBwbHVnaW5OYW1lID0gdmlld2VyUGx1Z2luLmdldFBsdWdpbk5hbWUoKTsKICAgICAgICAgICAgcGx1Z2luVmVyc2lvbiA9IHZpZXdlclBsdWdpbi5nZXRQbHVnaW5WZXJzaW9uKCk7CiAgICAgICAgICAgIHBsdWdpblVSTCA9IHZpZXdlclBsdWdpbi5nZXRQbHVnaW5VUkwoKTsKICAgICAgICB9CgogICAgICAgIC8vIENyZWF0ZSBkaWFsb2cKICAgICAgICBhYm91dERpYWxvZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGFib3V0RGlhbG9nLmlkID0gImFib3V0RGlhbG9nIjsKICAgICAgICBhYm91dERpYWxvZy5pbm5lckhUTUwgPQogICAgICAgICAgICAiPGgxPjxhIGhyZWYgPSBcImh0dHA6Ly92aWV3ZXJqcy5vcmdcIiB0YXJnZXQ9XCJfYmxhbmtcIj5WaWV3ZXJKUzwvYT48L2gxPiIgKwogICAgICAgICAgICAiPHA+PGEgaHJlZiA9IFwiaHR0cDovL25sbmV0Lm5sXCIgdGFyZ2V0PVwiX2JsYW5rXCI+PGltZyBzcmM9XCJpbWFnZXNcL25sbmV0LnBuZ1wiIHdpZHRoPVwiMTYwXCIgaGVpZ2h0PVwiNjBcIj48L2ltZz48L2E+PC9wPiIgKwogICAgICAgICAgICAiPHA+PGEgaHJlZiA9IFwiaHR0cDovL2tvZ21iaC5jb21cIiB0YXJnZXQ9XCJfYmxhbmtcIj48aW1nIHNyYz1cImltYWdlc1wva29nbWJoLnBuZ1wiIHdpZHRoPVwiMTcyXCIgaGVpZ2h0PVwiNDBcIj48L2ltZz48L2E+PC9wPiIgKwogICAgICAgICAgICAodmlld2VyUGx1Z2luID8gKCI8cD5Vc2luZyB0aGUgPGEgaHJlZiA9IFwiIisgcGx1Z2luVVJMICsgIlwiIHRhcmdldD1cIl9ibGFua1wiPiIgKyBwbHVnaW5OYW1lICsgIjwvYT4gIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiKDxzcGFuIGlkID0gXCJwbHVnaW5WZXJzaW9uXCI+IiArIHBsdWdpblZlcnNpb24gKyAiPC9zcGFuPikgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGx1Z2luIHRvIHNob3cgeW91IHRoaXMgZG9jdW1lbnQuPC9wPiIpCiAgICAgICAgICAgICAgICAgICAgICAgICA6ICIiKSArCiAgICAgICAgICAgICI8cD5NYWRlIGJ5IDxhIGhyZWYgPSBcImh0dHA6Ly9rb2dtYmguY29tXCIgdGFyZ2V0PVwiX2JsYW5rXCI+S08gR21iSDwvYT4uPC9wPiIgKwogICAgICAgICAgICAiPGJ1dHRvbiBpZCA9IFwiYWJvdXREaWFsb2dDbG9zZUJ1dHRvblwiIGNsYXNzID0gXCJ0b29sYmFyQnV0dG9uIHRleHRCdXR0b25cIj5DbG9zZTwvYnV0dG9uPiI7CiAgICAgICAgdmlld2VyRWxlbWVudC5hcHBlbmRDaGlsZChhYm91dERpYWxvZyk7CgogICAgICAgIC8vIENyZWF0ZSAiYmFzZWQgb24iIGxpbmUKICAgICAgICBiYXNlZE9uRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgYmFzZWRPbkRpdi5pZCA9ICJiYXNlZE9uIjsKICAgICAgICBiYXNlZE9uRGl2LmlubmVySFRNTCA9CiAgICAgICAgICAgICJCYXNlZCBvbiAiICsKICAgICAgICAgICAgIjxhIGhyZWYgPSBcImh0dHA6Ly93ZWJvZGYub3JnXCIgdGFyZ2V0PVwiX2JsYW5rXCI+V2ViT0RGPC9hPiIgKwogICAgICAgICAgICAiIGJ5ICIgKwogICAgICAgICAgICAiPGEgaHJlZiA9IFwiaHR0cDovL2tvZ21iaC5jb21cIiB0YXJnZXQ9XCJfYmxhbmtcIj5LTzwvYT4iOwoKICAgICAgICB0b29sYmFyUmlnaHQuYXBwZW5kQ2hpbGQoYmFzZWRPbkRpdik7CgogICAgICAgIC8vIENyZWF0ZSBidXR0b24gdG8gb3BlbiBkaWFsb2cgdGhhdCBzYXlzICJWaWV3ZXJKUyIKICAgICAgICBhYm91dEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgIGFib3V0QnV0dG9uLmlkID0gImFib3V0IjsKICAgICAgICBhYm91dEJ1dHRvbi5jbGFzc05hbWUgPSAidG9vbGJhckJ1dHRvbiB0ZXh0QnV0dG9uIGFib3V0IjsKICAgICAgICBhYm91dEJ1dHRvbi50aXRsZSA9ICJBYm91dCI7CiAgICAgICAgYWJvdXRCdXR0b24uaW5uZXJIVE1MID0gIlZpZXdlckpTIgogICAgICAgIHRvb2xiYXJSaWdodC5hcHBlbmRDaGlsZChhYm91dEJ1dHRvbik7CgogICAgICAgIC8vIEF0dGFjaCBldmVudHMgdG8gdGhlIGFib3ZlCiAgICAgICAgYWJvdXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzaG93QWJvdXREaWFsb2coKTsKICAgICAgICB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWJvdXREaWFsb2dDbG9zZUJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaGlkZUFib3V0RGlhbG9nKCk7CiAgICAgICAgfSk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNob3dBYm91dERpYWxvZygpIHsKICAgICAgICBhYm91dERpYWxvZy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBvdmVybGF5LnN0eWxlLnZpc2liaWxpdHkgPSAidmlzaWJsZSI7CiAgICB9CgogICAgZnVuY3Rpb24gaGlkZUFib3V0RGlhbG9nKCkgewogICAgICAgIGFib3V0RGlhbG9nLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgb3ZlcmxheS5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICB9CgogICAgZnVuY3Rpb24gaXNGdWxsU2NyZWVuKCkgewogICAgLy8gTm90ZSB0aGF0IHRoZSBicm93c2VyIGZ1bGxzY3JlZW4gKHRyaWdnZXJlZCBieSBzaG9ydCBrZXlzKSBtaWdodAogICAgLy8gYmUgY29uc2lkZXJlZCBkaWZmZXJlbnQgZnJvbSBjb250ZW50IGZ1bGxzY3JlZW4gd2hlbiBleHBlY3RpbmcgYSBib29sZWFuCiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmlzRnVsbFNjcmVlbiB8fCBkb2N1bWVudC5tb3pGdWxsU2NyZWVuIHx8IGRvY3VtZW50LndlYmtpdElzRnVsbFNjcmVlbjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxlY3RTY2FsZU9wdGlvbih2YWx1ZSkgewogICAgICAgIC8vIFJldHJpZXZlIHRoZSBvcHRpb25zIGZyb20gdGhlIHpvb20gbGV2ZWwgPHNlbGVjdD4gZWxlbWVudAogICAgICAgIHZhciBvcHRpb25zID0gc2NhbGVTZWxlY3Rvci5vcHRpb25zLAogICAgICAgICAgICBvcHRpb24sCiAgICAgICAgICAgIHByZWRlZmluZWRWYWx1ZUZvdW5kID0gZmFsc2UsCiAgICAgICAgICAgIGk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgIG9wdGlvbiA9IG9wdGlvbnNbaV07CiAgICAgICAgICAgIGlmIChvcHRpb24udmFsdWUgIT09IHZhbHVlKSB7CiAgICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICAgIHByZWRlZmluZWRWYWx1ZUZvdW5kID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByZWRlZmluZWRWYWx1ZUZvdW5kOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFBhZ2VzKCkgewogICAgICAgIHJldHVybiB2aWV3ZXJQbHVnaW4uZ2V0UGFnZXMoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRTY2FsZSh2YWwsIHJlc2V0QXV0b1NldHRpbmdzLCBub1Njcm9sbCkgewogICAgICAgIGlmICh2YWwgPT09IHNlbGYuZ2V0Wm9vbUxldmVsKCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5zZXRab29tTGV2ZWwodmFsKTsKCiAgICAgICAgdmFyIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ1VJRXZlbnRzJyk7CiAgICAgICAgZXZlbnQuaW5pdFVJRXZlbnQoJ3NjYWxlY2hhbmdlJywgZmFsc2UsIGZhbHNlLCB3aW5kb3csIDApOwogICAgICAgIGV2ZW50LnNjYWxlID0gdmFsOwogICAgICAgIGV2ZW50LnJlc2V0QXV0b1NldHRpbmdzID0gcmVzZXRBdXRvU2V0dGluZ3M7CiAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uU2Nyb2xsKCkgewogICAgICAgIHZhciBwYWdlTnVtYmVyOwoKICAgICAgICBpZiAodmlld2VyUGx1Z2luLm9uU2Nyb2xsKSB7CiAgICAgICAgICAgIHZpZXdlclBsdWdpbi5vblNjcm9sbCgpOwogICAgICAgIH0KICAgICAgICBpZiAodmlld2VyUGx1Z2luLmdldFBhZ2VJblZpZXcpIHsKICAgICAgICAgICAgcGFnZU51bWJlciA9IHZpZXdlclBsdWdpbi5nZXRQYWdlSW5WaWV3KCk7CiAgICAgICAgICAgIGlmIChwYWdlTnVtYmVyKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50UGFnZSA9IHBhZ2VOdW1iZXI7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFnZU51bWJlcicpLnZhbHVlID0gcGFnZU51bWJlcjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkZWxheWVkUmVmcmVzaChtaWxsaXNlY29uZHMpIHsKICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHNjYWxlQ2hhbmdlVGltZXIpOwogICAgICAgIHNjYWxlQ2hhbmdlVGltZXIgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG9uU2Nyb2xsKCk7CiAgICAgICAgfSwgbWlsbGlzZWNvbmRzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZVNjYWxlKHZhbHVlLCByZXNldEF1dG9TZXR0aW5ncywgbm9TY3JvbGwpIHsKICAgICAgICB2YXIgc2NhbGUsCiAgICAgICAgICAgIG1heFdpZHRoLAogICAgICAgICAgICBtYXhIZWlnaHQ7CgogICAgICAgIGlmICh2YWx1ZSA9PT0gJ2N1c3RvbScpIHsKICAgICAgICAgICAgc2NhbGUgPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXN0b21TY2FsZU9wdGlvbicpLnRleHRDb250ZW50KSAvIDEwMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzY2FsZSA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNjYWxlKSB7CiAgICAgICAgICAgIHNldFNjYWxlKHNjYWxlLCB0cnVlLCBub1Njcm9sbCk7CiAgICAgICAgICAgIGRlbGF5ZWRSZWZyZXNoKDMwMCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1heFdpZHRoID0gY2FudmFzQ29udGFpbmVyLmNsaWVudFdpZHRoIC0ga1Njcm9sbGJhclBhZGRpbmc7CiAgICAgICAgbWF4SGVpZ2h0ID0gY2FudmFzQ29udGFpbmVyLmNsaWVudEhlaWdodCAtIGtTY3JvbGxiYXJQYWRkaW5nOwoKICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgY2FzZSAncGFnZS1hY3R1YWwnOgogICAgICAgICAgICBzZXRTY2FsZSgxLCByZXNldEF1dG9TZXR0aW5ncywgbm9TY3JvbGwpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdwYWdlLXdpZHRoJzoKICAgICAgICAgICAgdmlld2VyUGx1Z2luLmZpdFRvV2lkdGgobWF4V2lkdGgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdwYWdlLWhlaWdodCc6CiAgICAgICAgICAgIHZpZXdlclBsdWdpbi5maXRUb0hlaWdodChtYXhIZWlnaHQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdwYWdlLWZpdCc6CiAgICAgICAgICAgIHZpZXdlclBsdWdpbi5maXRUb1BhZ2UobWF4V2lkdGgsIG1heEhlaWdodCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2F1dG8nOgogICAgICAgICAgICBpZiAodmlld2VyUGx1Z2luLmlzU2xpZGVzaG93KCkpIHsKICAgICAgICAgICAgICAgIHZpZXdlclBsdWdpbi5maXRUb1BhZ2UobWF4V2lkdGggKyBrU2Nyb2xsYmFyUGFkZGluZywgbWF4SGVpZ2h0ICsga1Njcm9sbGJhclBhZGRpbmcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmlld2VyUGx1Z2luLmZpdFNtYXJ0KG1heFdpZHRoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHNlbGVjdFNjYWxlT3B0aW9uKHZhbHVlKTsKICAgICAgICBkZWxheWVkUmVmcmVzaCgzMDApOwogICAgfQoKICAgIAogICAgdGhpcy5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBsb2NhdGlvbiA9IFN0cmluZyhkb2N1bWVudC5sb2NhdGlvbiksCiAgICAgICAgICAgIHBvcyA9IGxvY2F0aW9uLmluZGV4T2YoJyMnKSwKICAgICAgICAgICAgZWxlbWVudDsKCiAgICAgICAgbG9jYXRpb24gPSBsb2NhdGlvbi5zdWJzdHIocG9zICsgMSk7CiAgICAgICAgaWYgKHBvcyA9PT0gLTEgfHwgbG9jYXRpb24ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDb3VsZCBub3QgcGFyc2UgZmlsZSBwYXRoIGFyZ3VtZW50LicpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB1cmwgPSBsb2NhdGlvbjsKICAgICAgICBmaWxlbmFtZSA9IHVybC5yZXBsYWNlKC9eLipbXFxcL10vLCAnJyk7CiAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBmaWxlbmFtZTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9jdW1lbnROYW1lJykuaW5uZXJIVE1MID0gZG9jdW1lbnQudGl0bGU7CgogICAgICAgIHZpZXdlclBsdWdpbi5vbkxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbHVnaW5WZXJzaW9uJykuaW5uZXJIVE1MID0gdmlld2VyUGx1Z2luLmdldFBsdWdpblZlcnNpb24oKTsKCiAgICAgICAgICAgIGlzU2xpZGVzaG93ID0gdmlld2VyUGx1Z2luLmlzU2xpZGVzaG93KCk7CiAgICAgICAgICAgIGlmIChpc1NsaWRlc2hvdykgewogICAgICAgICAgICAgICAgLy8gTm8gcGFkZGluZyBmb3Igc2xpZGVzaG93cwogICAgICAgICAgICAgICAgY2FudmFzQ29udGFpbmVyLnN0eWxlLnBhZGRpbmcgPSAwOwogICAgICAgICAgICAgICAgLy8gU2hvdyBwYWdlIG5hdiBjb250cm9scyBvbmx5IGZvciBwcmVzZW50YXRpb25zCiAgICAgICAgICAgICAgICBwYWdlU3dpdGNoZXIuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciB0ZXh0IGRvY3VtZW50cywgc2hvdyB0aGUgem9vbSB3aWRnZXQuCiAgICAgICAgICAgICAgICB6b29tV2lkZ2V0LnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7CiAgICAgICAgICAgICAgICAvLyBPbmx5IHNob3cgdGhlIHBhZ2Ugc3dpdGNoZXIgd2lkZ2V0IGlmIHRoZSBwbHVnaW4gc3VwcG9ydHMgcGFnZSBudW1iZXJzCiAgICAgICAgICAgICAgICBpZiAodmlld2VyUGx1Z2luLmdldFBhZ2VJblZpZXcpIHsKICAgICAgICAgICAgICAgICAgICBwYWdlU3dpdGNoZXIuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgICAgICBwYWdlcyA9IGdldFBhZ2VzKCk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudW1QYWdlcycpLmlubmVySFRNTCA9ICdvZiAnICsgcGFnZXMubGVuZ3RoOwoKICAgICAgICAgICAgc2VsZi5zaG93UGFnZSgxKTsKCiAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHNjYWxlCiAgICAgICAgICAgIHBhcnNlU2NhbGUoa0RlZmF1bHRTY2FsZSk7CgogICAgICAgICAgICBjYW52YXNDb250YWluZXIub25zY3JvbGwgPSBvblNjcm9sbDsKICAgICAgICAgICAgZGVsYXllZFJlZnJlc2goKTsKICAgICAgICB9OwoKICAgICAgICB2aWV3ZXJQbHVnaW4uaW5pdGlhbGl6ZShjYW52YXNDb250YWluZXIsIGxvY2F0aW9uKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBTaG93cyB0aGUgJ24ndGggcGFnZS4gSWYgbiBpcyBsYXJnZXIgdGhhbiB0aGUgcGFnZSBjb3VudCwKICAgICAqIHNob3dzIHRoZSBsYXN0IHBhZ2UuIElmIG4gaXMgbGVzcyB0aGFuIDEsIHNob3dzIHRoZSBmaXJzdCBwYWdlLgogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICB0aGlzLnNob3dQYWdlID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICBpZiAobiA8PSAwKSB7CiAgICAgICAgICAgIG4gPSAxOwogICAgICAgIH0gZWxzZSBpZiAobiA+IHBhZ2VzLmxlbmd0aCkgewogICAgICAgICAgICBuID0gcGFnZXMubGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgdmlld2VyUGx1Z2luLnNob3dQYWdlKG4pOwoKICAgICAgICBjdXJyZW50UGFnZSA9IG47CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2VOdW1iZXInKS52YWx1ZSA9IGN1cnJlbnRQYWdlOwogICAgfTsKCiAgICAvKioKICAgICAqIFNob3dzIHRoZSBuZXh0IHBhZ2UuIElmIHRoZXJlIGlzIG5vIHN1YnNlcXVlbnQgcGFnZSwgZG9lcyBub3RoaW5nLgogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICB0aGlzLnNob3dOZXh0UGFnZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBzZWxmLnNob3dQYWdlKGN1cnJlbnRQYWdlICsgMSk7CiAgICB9OwoKICAgIC8qKgogICAgICogU2hvd3MgdGhlIHByZXZpb3VzIHBhZ2UuIElmIHRoZXJlIGlzIG5vIHByZXZpb3VzIHBhZ2UsIGRvZXMgbm90aGluZy4KICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgdGhpcy5zaG93UHJldmlvdXNQYWdlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHNlbGYuc2hvd1BhZ2UoY3VycmVudFBhZ2UgLSAxKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBBdHRlbXB0cyB0byAnZG93bmxvYWQnIHRoZSBmaWxlLgogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICB0aGlzLmRvd25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkb2N1bWVudFVybCA9IHVybC5zcGxpdCgnIycpWzBdOwogICAgICAgIGRvY3VtZW50VXJsICs9ICcjdmlld2VyLmFjdGlvbj1kb3dubG9hZCc7CiAgICAgICAgd2luZG93Lm9wZW4oZG9jdW1lbnRVcmwsICdfcGFyZW50Jyk7CiAgICB9OwoKICAgIC8qKgogICAgICogVG9nZ2xlcyB0aGUgZnVsbHNjcmVlbiBzdGF0ZSBvZiB0aGUgdmlld2VyCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIHRoaXMudG9nZ2xlRnVsbFNjcmVlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZWxlbSA9IHZpZXdlckVsZW1lbnQ7CiAgICAgICAgaWYgKCFpc0Z1bGxTY3JlZW4oKSkgewogICAgICAgICAgICBpZiAoZWxlbS5yZXF1ZXN0RnVsbFNjcmVlbikgewogICAgICAgICAgICAgICAgZWxlbS5yZXF1ZXN0RnVsbFNjcmVlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0ubW96UmVxdWVzdEZ1bGxTY3JlZW4pIHsKICAgICAgICAgICAgICAgIGVsZW0ubW96UmVxdWVzdEZ1bGxTY3JlZW4oKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtLndlYmtpdFJlcXVlc3RGdWxsU2NyZWVuKSB7CiAgICAgICAgICAgICAgICBlbGVtLndlYmtpdFJlcXVlc3RGdWxsU2NyZWVuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQuY2FuY2VsRnVsbFNjcmVlbikgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuY2FuY2VsRnVsbFNjcmVlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4pIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4oKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRDYW5jZWxGdWxsU2NyZWVuKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC53ZWJraXRDYW5jZWxGdWxsU2NyZWVuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogCiAgICAvKioKICAgICAqIFRvZ2dsZXMgdGhlIHByZXNlbnRhdGlvbiBtb2RlIG9mIHRoZSB2aWV3ZXIuCiAgICAgKiBQcmVzZW50YXRpb24gbW9kZSBpbnZvbHZlcyBmdWxsc2NyZWVuICsgaGlkZGVuIFVJIGNvbnRyb2xzCiAgICAgKi8KICAgIHRoaXMudG9nZ2xlUHJlc2VudGF0aW9uTW9kZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdGl0bGViYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGViYXInKSwKICAgICAgICAgICAgdG9vbGJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b29sYmFyQ29udGFpbmVyJyksCiAgICAgICAgICAgIG92ZXJsYXlDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdmVybGF5Q2xvc2VCdXR0b24nKTsKCiAgICAgICAgaWYgKCFwcmVzZW50YXRpb25Nb2RlKSB7CiAgICAgICAgICAgIHRpdGxlYmFyLnN0eWxlLmRpc3BsYXkgPSB0b29sYmFyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIG92ZXJsYXlDbG9zZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgY2FudmFzQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdwcmVzZW50YXRpb25Nb2RlJzsKICAgICAgICAgICAgaXNTbGlkZXNob3cgPSB0cnVlOwogICAgICAgICAgICBjYW52YXNDb250YWluZXIub25tb3VzZWRvd24gPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNhbnZhc0NvbnRhaW5lci5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBjYW52YXNDb250YWluZXIub25tb3VzZXVwID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93TmV4dFBhZ2UoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93UHJldmlvdXNQYWdlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHBhcnNlU2NhbGUoJ3BhZ2UtZml0Jyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGl0bGViYXIuc3R5bGUuZGlzcGxheSA9IHRvb2xiYXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIG92ZXJsYXlDbG9zZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBjYW52YXNDb250YWluZXIuY2xhc3NOYW1lID0gJyc7CiAgICAgICAgICAgIGNhbnZhc0NvbnRhaW5lci5vbm1vdXNldXAgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICAgICAgY2FudmFzQ29udGFpbmVyLm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICAgICAgY2FudmFzQ29udGFpbmVyLm9ubW91c2Vkb3duID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgICAgIHBhcnNlU2NhbGUoJ2F1dG8nKTsKICAgICAgICAgICAgaXNTbGlkZXNob3cgPSB2aWV3ZXJQbHVnaW4uaXNTbGlkZXNob3coKTsKICAgICAgICB9CgogICAgICAgIHByZXNlbnRhdGlvbk1vZGUgPSAhcHJlc2VudGF0aW9uTW9kZTsKICAgIH07CgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSB6b29tIGxldmVsIG9mIHRoZSBkb2N1bWVudAogICAgICogQHJldHVybiB7IW51bWJlcn0KICAgICAqLwogICAgdGhpcy5nZXRab29tTGV2ZWwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHZpZXdlclBsdWdpbi5nZXRab29tTGV2ZWwoKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHpvb20gbGV2ZWwgb2YgdGhlIGRvY3VtZW50CiAgICAgKiBAcGFyYW0geyFudW1iZXJ9IHZhbHVlCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIHRoaXMuc2V0Wm9vbUxldmVsID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdmlld2VyUGx1Z2luLnNldFpvb21MZXZlbCh2YWx1ZSk7CiAgICB9OwoKICAgIC8qKgogICAgICogWm9vbSBvdXQgYnkgMTAgJQogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICB0aGlzLnpvb21PdXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gMTAgJSBkZWNyZW1lbnQKICAgICAgICB2YXIgbmV3U2NhbGUgPSAoc2VsZi5nZXRab29tTGV2ZWwoKSAvIGtEZWZhdWx0U2NhbGVEZWx0YSkudG9GaXhlZCgyKTsKICAgICAgICBuZXdTY2FsZSA9IE1hdGgubWF4KGtNaW5TY2FsZSwgbmV3U2NhbGUpOwogICAgICAgIHBhcnNlU2NhbGUobmV3U2NhbGUsIHRydWUpOwogICAgfTsKCiAgICAvKioKICAgICAqIFpvb20gaW4gYnkgMTAlCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIHRoaXMuem9vbUluID0gZnVuY3Rpb24gKCkgewogICAgICAgIC8vIDEwICUgaW5jcmVtZW50CiAgICAgICAgdmFyIG5ld1NjYWxlID0gKHNlbGYuZ2V0Wm9vbUxldmVsKCkgKiBrRGVmYXVsdFNjYWxlRGVsdGEpLnRvRml4ZWQoMik7CiAgICAgICAgbmV3U2NhbGUgPSBNYXRoLm1pbihrTWF4U2NhbGUsIG5ld1NjYWxlKTsKICAgICAgICBwYXJzZVNjYWxlKG5ld1NjYWxlLCB0cnVlKTsKICAgIH07CgogICAgZnVuY3Rpb24gY2FuY2VsUHJlc2VudGF0aW9uTW9kZSgpIHsKICAgICAgICBpZiAocHJlc2VudGF0aW9uTW9kZSAmJiAhaXNGdWxsU2NyZWVuKCkpIHsKICAgICAgICAgICAgc2VsZi50b2dnbGVQcmVzZW50YXRpb25Nb2RlKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNob3dPdmVybGF5TmF2aWdhdG9yKCkgewogICAgICAgIGlmIChpc1NsaWRlc2hvdykgewogICAgICAgICAgICBvdmVybGF5TmF2aWdhdG9yLmNsYXNzTmFtZSA9ICd0b3VjaGVkJzsKICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0b3VjaFRpbWVyKTsKICAgICAgICAgICAgdG91Y2hUaW1lciA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIG92ZXJsYXlOYXZpZ2F0b3IuY2xhc3NOYW1lID0gJyc7CiAgICAgICAgICAgIH0sIDIwMDApOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbml0KCkgewoKICAgICAgICBpbml0aWFsaXplQWJvdXRJbmZvcm1hdGlvbigpOwoKICAgICAgICBpZiAodmlld2VyUGx1Z2luKSB7CiAgICAgICAgICAgIHNlbGYuaW5pdGlhbGl6ZSgpOwoKICAgICAgICAgICAgaWYgKCEoZG9jdW1lbnQuY2FuY2VsRnVsbFNjcmVlbiB8fCBkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuIHx8IGRvY3VtZW50LndlYmtpdENhbmNlbEZ1bGxTY3JlZW4pKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnVsbHNjcmVlbicpLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ292ZXJsYXlDbG9zZUJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2VsZi50b2dnbGVGdWxsU2NyZWVuKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z1bGxzY3JlZW4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNlbGYudG9nZ2xlRnVsbFNjcmVlbik7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVzZW50YXRpb24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICghaXNGdWxsU2NyZWVuKCkpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnRvZ2dsZUZ1bGxTY3JlZW4oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGYudG9nZ2xlUHJlc2VudGF0aW9uTW9kZSgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBjYW5jZWxQcmVzZW50YXRpb25Nb2RlKTsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignd2Via2l0ZnVsbHNjcmVlbmNoYW5nZScsIGNhbmNlbFByZXNlbnRhdGlvbk1vZGUpOwogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3pmdWxsc2NyZWVuY2hhbmdlJywgY2FuY2VsUHJlc2VudGF0aW9uTW9kZSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuZG93bmxvYWQoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnem9vbU91dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2VsZi56b29tT3V0KCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3pvb21JbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2VsZi56b29tSW4oKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldmlvdXMnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuc2hvd1ByZXZpb3VzUGFnZSgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNob3dOZXh0UGFnZSgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2aW91c1BhZ2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuc2hvd1ByZXZpb3VzUGFnZSgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0UGFnZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2VsZi5zaG93TmV4dFBhZ2UoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFnZU51bWJlcicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuc2hvd1BhZ2UodGhpcy52YWx1ZSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYWxlU2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcGFyc2VTY2FsZSh0aGlzLnZhbHVlKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYW52YXNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaG93T3ZlcmxheU5hdmlnYXRvcik7CiAgICAgICAgICAgIG92ZXJsYXlOYXZpZ2F0b3IuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaG93T3ZlcmxheU5hdmlnYXRvcik7CgogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2NhbGVjaGFuZ2UnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICB2YXIgY3VzdG9tU2NhbGVPcHRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VzdG9tU2NhbGVPcHRpb24nKSwKICAgICAgICAgICAgICAgICAgICBwcmVkZWZpbmVkVmFsdWVGb3VuZCA9IHNlbGVjdFNjYWxlT3B0aW9uKFN0cmluZyhldnQuc2NhbGUpKTsKCiAgICAgICAgICAgICAgICBjdXN0b21TY2FsZU9wdGlvbi5zZWxlY3RlZCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIGlmICghcHJlZGVmaW5lZFZhbHVlRm91bmQpIHsKICAgICAgICAgICAgICAgICAgICBjdXN0b21TY2FsZU9wdGlvbi50ZXh0Q29udGVudCA9IE1hdGgucm91bmQoZXZ0LnNjYWxlICogMTAwMDApIC8gMTAwICsgJyUnOwogICAgICAgICAgICAgICAgICAgIGN1c3RvbVNjYWxlT3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICAgICAgaWYgKGluaXRpYWxpemVkICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlV2lkdGhPcHRpb24nKS5zZWxlY3RlZCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlQXV0b09wdGlvbicpLnNlbGVjdGVkKSkgewogICAgICAgICAgICAgICAgICAgIHBhcnNlU2NhbGUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYWxlU2VsZWN0JykudmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2hvd092ZXJsYXlOYXZpZ2F0b3IoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBldnQua2V5Q29kZSwKICAgICAgICAgICAgICAgICAgICBzaGlmdEtleSA9IGV2dC5zaGlmdEtleTsKCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgICAgICAgICAgY2FzZSAzMzogLy8gcGFnZVVwCiAgICAgICAgICAgICAgICBjYXNlIDM4OiAvLyB1cAogICAgICAgICAgICAgICAgY2FzZSAzNzogLy8gbGVmdAogICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd1ByZXZpb3VzUGFnZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAzNDogLy8gcGFnZURvd24KICAgICAgICAgICAgICAgIGNhc2UgNDA6IC8vIGRvd24KICAgICAgICAgICAgICAgIGNhc2UgMzk6IC8vIHJpZ2h0CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93TmV4dFBhZ2UoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMzI6IC8vIHNwYWNlCiAgICAgICAgICAgICAgICAgICAgc2hpZnRLZXkgPyBzZWxmLnNob3dQcmV2aW91c1BhZ2UoKSA6IHNlbGYuc2hvd05leHRQYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KCiAgICBpbml0KCk7Cn0K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 02:40:35 GMT",
                    "Content-Length": "20001",
                    "Date": "Sun, 09 Nov 2014 02:41:02 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}