{
    "url": "http://localhost:9999/x-tag/map/demo/x-tag-components.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>the 'baseURI' property of a DOM element</b> and written to <b>the 'setAttribute()' function of a DOM element</b> via the following statement:<ul><li>base.setAttribute('href', document.baseURI || document.URL);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/x-tag/map/demo/x-tag-components.js",
                "path": "/x-tag/map/demo/x-tag-components.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC94LXRhZy9tYXAvZGVtby94LXRhZy1jb21wb25lbnRzLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjE0ODczDQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBTdW4sIDA5IE5vdiAyMDE0IDAzOjQ0OjMwIEdNVA0KTGFzdC1Nb2RpZmllZDogU3VuLCAwOSBOb3YgMjAxNCAwMzo0NDozMCBHTVQNCg0KLyoKIExlYWZsZXQsIGEgSmF2YVNjcmlwdCBsaWJyYXJ5IGZvciBtb2JpbGUtZnJpZW5kbHkgaW50ZXJhY3RpdmUgbWFwcy4gaHR0cDovL2xlYWZsZXRqcy5jb20KIChjKSAyMDEwLTIwMTMsIFZsYWRpbWlyIEFnYWZvbmtpbgogKGMpIDIwMTAtMjAxMSwgQ2xvdWRNYWRlCiovCiFmdW5jdGlvbih0LGUsaSl7dmFyIG49dC5MLG89e307by52ZXJzaW9uPSIwLjctZGV2Iiwib2JqZWN0Ij09dHlwZW9mIG1vZHVsZSYmIm9iamVjdCI9PXR5cGVvZiBtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1vOiJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQmJmRlZmluZShvKSxvLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gdC5MPW4sdGhpc30sdC5MPW8sby5VdGlsPXtleHRlbmQ6ZnVuY3Rpb24odCl7dmFyIGUsaSxuLG8scz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKGk9MCxuPXMubGVuZ3RoO24+aTtpKyspe289c1tpXXx8e307Zm9yKGUgaW4gbylvLmhhc093blByb3BlcnR5KGUpJiYodFtlXT1vW2VdKX1yZXR1cm4gdH0sYmluZDpmdW5jdGlvbih0LGUpe3ZhciBpPWFyZ3VtZW50cy5sZW5ndGg+Mj9BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMik6bnVsbDtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdC5hcHBseShlLGl8fGFyZ3VtZW50cyl9fSxzdGFtcDpmdW5jdGlvbigpe3ZhciB0PTAsZT0iX2xlYWZsZXRfaWQiO3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4gaVtlXT1pW2VdfHwrK3QsaVtlXX19KCksaW52b2tlRWFjaDpmdW5jdGlvbih0LGUsaSl7dmFyIG4sbztpZigib2JqZWN0Ij09dHlwZW9mIHQpe289QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDMpO2ZvcihuIGluIHQpZS5hcHBseShpLFtuLHRbbl1dLmNvbmNhdChvKSk7cmV0dXJuITB9cmV0dXJuITF9LGxpbWl0RXhlY0J5SW50ZXJ2YWw6ZnVuY3Rpb24odCxlLGkpe3ZhciBuLG87cmV0dXJuIGZ1bmN0aW9uIHMoKXt2YXIgYT1hcmd1bWVudHM7cmV0dXJuIG4/KG89ITAsdm9pZCAwKToobj0hMCxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7bj0hMSxvJiYocy5hcHBseShpLGEpLG89ITEpfSxlKSx0LmFwcGx5KGksYSksdm9pZCAwKX19LGZhbHNlRm46ZnVuY3Rpb24oKXtyZXR1cm4hMX0sZm9ybWF0TnVtOmZ1bmN0aW9uKHQsZSl7dmFyIGk9TWF0aC5wb3coMTAsZXx8NSk7cmV0dXJuIE1hdGgucm91bmQodCppKS9pfSx0cmltOmZ1bmN0aW9uKHQpe3JldHVybiB0LnRyaW0/dC50cmltKCk6dC5yZXBsYWNlKC9eXHMrfFxzKyQvZywiIil9LHNwbGl0V29yZHM6ZnVuY3Rpb24odCl7cmV0dXJuIG8uVXRpbC50cmltKHQpLnNwbGl0KC9ccysvKX0sc2V0T3B0aW9uczpmdW5jdGlvbih0LGUpe3JldHVybiB0Lm9wdGlvbnM9by5leHRlbmQoe30sdC5vcHRpb25zLGUpLHQub3B0aW9uc30sZ2V0UGFyYW1TdHJpbmc6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPVtdO2Zvcih2YXIgbyBpbiB0KW4ucHVzaChlbmNvZGVVUklDb21wb25lbnQoaT9vLnRvVXBwZXJDYXNlKCk6bykrIj0iK2VuY29kZVVSSUNvbXBvbmVudCh0W29dKSk7cmV0dXJuKGUmJi0xIT09ZS5pbmRleE9mKCI/Iik/IiYiOiI/Iikrbi5qb2luKCImIil9LGNvbXBpbGVUZW1wbGF0ZTpmdW5jdGlvbih0LGUpe3JldHVybiB0PXQucmVwbGFjZSgvXHsgKihbXHdfXSspICpcfS9nLGZ1bmN0aW9uKHQsaSl7cmV0dXJuJyIgKyBvWyInK2krJyJdJysoImZ1bmN0aW9uIj09dHlwZW9mIGVbaV0/IihvKSI6IiIpKycgKyAiJ30pLG5ldyBGdW5jdGlvbigibyIsJ3JldHVybiAiJyt0KyciOycpfSx0ZW1wbGF0ZTpmdW5jdGlvbih0LGUpe3ZhciBpPW8uVXRpbC5fdGVtcGxhdGVDYWNoZT1vLlV0aWwuX3RlbXBsYXRlQ2FjaGV8fHt9O3JldHVybiBpW3RdPWlbdF18fG8uVXRpbC5jb21waWxlVGVtcGxhdGUodCxlKSxpW3RdKGUpfSxpc0FycmF5OkFycmF5LmlzQXJyYXl8fGZ1bmN0aW9uKHQpe3JldHVybiJbb2JqZWN0IEFycmF5XSI9PT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCl9LGVtcHR5SW1hZ2VVcmw6ImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBQUQvQUN3QUFBQUFBUUFCQUFBQ0FEcz0ifSxmdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSl7dmFyIGksbixvPVsid2Via2l0IiwibW96IiwibyIsIm1zIl07Zm9yKGk9MDtpPG8ubGVuZ3RoJiYhbjtpKyspbj10W29baV0rZV07cmV0dXJuIG59ZnVuY3Rpb24gaShlKXt2YXIgaT0rbmV3IERhdGUsbz1NYXRoLm1heCgwLDE2LShpLW4pKTtyZXR1cm4gbj1pK28sdC5zZXRUaW1lb3V0KGUsbyl9dmFyIG49MCxzPXQucmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxlKCJSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiKXx8aSxhPXQuY2FuY2VsQW5pbWF0aW9uRnJhbWV8fGUoIkNhbmNlbEFuaW1hdGlvbkZyYW1lIil8fGUoIkNhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSIpfHxmdW5jdGlvbihlKXt0LmNsZWFyVGltZW91dChlKX07by5VdGlsLnJlcXVlc3RBbmltRnJhbWU9ZnVuY3Rpb24oZSxuLGEscil7cmV0dXJuIGU9by5iaW5kKGUsbiksYSYmcz09PWk/KGUoKSx2b2lkIDApOnMuY2FsbCh0LGUscil9LG8uVXRpbC5jYW5jZWxBbmltRnJhbWU9ZnVuY3Rpb24oZSl7ZSYmYS5jYWxsKHQsZSl9fSgpLG8uZXh0ZW5kPW8uVXRpbC5leHRlbmQsby5iaW5kPW8uVXRpbC5iaW5kLG8uc3RhbXA9by5VdGlsLnN0YW1wLG8uc2V0T3B0aW9ucz1vLlV0aWwuc2V0T3B0aW9ucyxvLkNsYXNzPWZ1bmN0aW9uKCl7fSxvLkNsYXNzLmV4dGVuZD1mdW5jdGlvbih0KXt2YXIgZT1mdW5jdGlvbigpe3RoaXMuaW5pdGlhbGl6ZSYmdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLl9pbml0SG9va3MmJnRoaXMuY2FsbEluaXRIb29rcygpfSxpPWZ1bmN0aW9uKCl7fTtpLnByb3RvdHlwZT10aGlzLnByb3RvdHlwZTt2YXIgbj1uZXcgaTtuLmNvbnN0cnVjdG9yPWUsZS5wcm90b3R5cGU9bjtmb3IodmFyIHMgaW4gdGhpcyl0aGlzLmhhc093blByb3BlcnR5KHMpJiYicHJvdG90eXBlIiE9PXMmJihlW3NdPXRoaXNbc10pO3Quc3RhdGljcyYmKG8uZXh0ZW5kKGUsdC5zdGF0aWNzKSxkZWxldGUgdC5zdGF0aWNzKSx0LmluY2x1ZGVzJiYoby5VdGlsLmV4dGVuZC5hcHBseShudWxsLFtuXS5jb25jYXQodC5pbmNsdWRlcykpLGRlbGV0ZSB0LmluY2x1ZGVzKSx0Lm9wdGlvbnMmJm4ub3B0aW9ucyYmKHQub3B0aW9ucz1vLmV4dGVuZCh7fSxuLm9wdGlvbnMsdC5vcHRpb25zKSksby5leHRlbmQobix0KSxuLl9pbml0SG9va3M9W107dmFyIGE9dGhpcztyZXR1cm4gZS5fX3N1cGVyX189YS5wcm90b3R5cGUsbi5jYWxsSW5pdEhvb2tzPWZ1bmN0aW9uKCl7aWYoIXRoaXMuX2luaXRIb29rc0NhbGxlZCl7YS5wcm90b3R5cGUuY2FsbEluaXRIb29rcyYmYS5wcm90b3R5cGUuY2FsbEluaXRIb29rcy5jYWxsKHRoaXMpLHRoaXMuX2luaXRIb29rc0NhbGxlZD0hMDtmb3IodmFyIHQ9MCxlPW4uX2luaXRIb29rcy5sZW5ndGg7ZT50O3QrKyluLl9pbml0SG9va3NbdF0uY2FsbCh0aGlzKX19LGV9LG8uQ2xhc3MuaW5jbHVkZT1mdW5jdGlvbih0KXtvLmV4dGVuZCh0aGlzLnByb3RvdHlwZSx0KX0sby5DbGFzcy5tZXJnZU9wdGlvbnM9ZnVuY3Rpb24odCl7by5leHRlbmQodGhpcy5wcm90b3R5cGUub3B0aW9ucyx0KX0sby5DbGFzcy5hZGRJbml0SG9vaz1mdW5jdGlvbih0KXt2YXIgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSksaT0iZnVuY3Rpb24iPT10eXBlb2YgdD90OmZ1bmN0aW9uKCl7dGhpc1t0XS5hcHBseSh0aGlzLGUpfTt0aGlzLnByb3RvdHlwZS5faW5pdEhvb2tzPXRoaXMucHJvdG90eXBlLl9pbml0SG9va3N8fFtdLHRoaXMucHJvdG90eXBlLl9pbml0SG9va3MucHVzaChpKX07dmFyIHM9Il9sZWFmbGV0X2V2ZW50cyI7by5NaXhpbj17fSxvLk1peGluLkV2ZW50cz17YWRkRXZlbnRMaXN0ZW5lcjpmdW5jdGlvbih0LGUsaSl7aWYoby5VdGlsLmludm9rZUVhY2godCx0aGlzLmFkZEV2ZW50TGlzdGVuZXIsdGhpcyxlLGkpKXJldHVybiB0aGlzO3ZhciBuLGEscixoLGwsdSxjLGQ9dGhpc1tzXT10aGlzW3NdfHx7fSxwPWkmJm8uc3RhbXAoaSk7Zm9yKHQ9by5VdGlsLnNwbGl0V29yZHModCksbj0wLGE9dC5sZW5ndGg7YT5uO24rKylyPXthY3Rpb246ZSxjb250ZXh0Oml8fHRoaXN9LGg9dFtuXSxpPyhsPWgrIl9pZHgiLHU9bCsiX2xlbiIsYz1kW2xdPWRbbF18fHt9LGNbcF18fChjW3BdPVtdLGRbdV09KGRbdV18fDApKzEpLGNbcF0ucHVzaChyKSk6KGRbaF09ZFtoXXx8W10sZFtoXS5wdXNoKHIpKTtyZXR1cm4gdGhpc30saGFzRXZlbnRMaXN0ZW5lcnM6ZnVuY3Rpb24odCl7dmFyIGU9dGhpc1tzXTtyZXR1cm4hIWUmJih0IGluIGUmJmVbdF0ubGVuZ3RoPjB8fHQrIl9pZHgiaW4gZSYmZVt0KyJfaWR4X2xlbiJdPjApfSxyZW1vdmVFdmVudExpc3RlbmVyOmZ1bmN0aW9uKHQsZSxpKXtpZighdGhpc1tzXSlyZXR1cm4gdGhpcztpZighdClyZXR1cm4gdGhpcy5jbGVhckFsbEV2ZW50TGlzdGVuZXJzKCk7aWYoby5VdGlsLmludm9rZUVhY2godCx0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIsdGhpcyxlLGkpKXJldHVybiB0aGlzO3ZhciBuLGEscixoLGwsdSxjLGQscCxtPXRoaXNbc10sXz1pJiZvLnN0YW1wKGkpO2Zvcih0PW8uVXRpbC5zcGxpdFdvcmRzKHQpLG49MCxhPXQubGVuZ3RoO2E+bjtuKyspaWYocj10W25dLHU9cisiX2lkeCIsYz11KyJfbGVuIixkPW1bdV0sZSl7aWYoaD1pJiZkP2RbX106bVtyXSl7Zm9yKGw9aC5sZW5ndGgtMTtsPj0wO2wtLSloW2xdLmFjdGlvbiE9PWV8fGkmJmhbbF0uY29udGV4dCE9PWl8fChwPWguc3BsaWNlKGwsMSkscFswXS5hY3Rpb249by5VdGlsLmZhbHNlRm4pO2kmJmQmJjA9PT1oLmxlbmd0aCYmKGRlbGV0ZSBkW19dLG1bY10tLSl9fWVsc2UgZGVsZXRlIG1bcl0sZGVsZXRlIG1bdV07cmV0dXJuIHRoaXN9LGNsZWFyQWxsRXZlbnRMaXN0ZW5lcnM6ZnVuY3Rpb24oKXtyZXR1cm4gZGVsZXRlIHRoaXNbc10sdGhpc30sZmlyZUV2ZW50OmZ1bmN0aW9uKHQsZSl7aWYoIXRoaXMuaGFzRXZlbnRMaXN0ZW5lcnModCkpcmV0dXJuIHRoaXM7dmFyIGksbixhLHIsaCxsPW8uVXRpbC5leHRlbmQoe30sZSx7dHlwZTp0LHRhcmdldDp0aGlzfSksdT10aGlzW3NdO2lmKHVbdF0pZm9yKGk9dVt0XS5zbGljZSgpLG49MCxhPWkubGVuZ3RoO2E+bjtuKyspaVtuXS5hY3Rpb24uY2FsbChpW25dLmNvbnRleHR8fHRoaXMsbCk7cj11W3QrIl9pZHgiXTtmb3IoaCBpbiByKWlmKGk9cltoXS5zbGljZSgpKWZvcihuPTAsYT1pLmxlbmd0aDthPm47bisrKWlbbl0uYWN0aW9uLmNhbGwoaVtuXS5jb250ZXh0fHx0aGlzLGwpO3JldHVybiB0aGlzfSxhZGRPbmVUaW1lRXZlbnRMaXN0ZW5lcjpmdW5jdGlvbih0LGUsaSl7aWYoby5VdGlsLmludm9rZUVhY2godCx0aGlzLmFkZE9uZVRpbWVFdmVudExpc3RlbmVyLHRoaXMsZSxpKSlyZXR1cm4gdGhpczt2YXIgbj1vLmJpbmQoZnVuY3Rpb24oKXt0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIodCxlLGkpLnJlbW92ZUV2ZW50TGlzdGVuZXIodCxuLGkpfSx0aGlzKTtyZXR1cm4gdGhpcy5hZGRFdmVudExpc3RlbmVyKHQsZSxpKS5hZGRFdmVudExpc3RlbmVyKHQsbixpKX19LG8uTWl4aW4uRXZlbnRzLm9uPW8uTWl4aW4uRXZlbnRzLmFkZEV2ZW50TGlzdGVuZXIsby5NaXhpbi5FdmVudHMub2ZmPW8uTWl4aW4uRXZlbnRzLnJlbW92ZUV2ZW50TGlzdGVuZXIsby5NaXhpbi5FdmVudHMub25jZT1vLk1peGluLkV2ZW50cy5hZGRPbmVUaW1lRXZlbnRMaXN0ZW5lcixvLk1peGluLkV2ZW50cy5maXJlPW8uTWl4aW4uRXZlbnRzLmZpcmVFdmVudCxmdW5jdGlvbigpe3ZhciBuPSEhdC5BY3RpdmVYT2JqZWN0LHM9biYmIXQuWE1MSHR0cFJlcXVlc3QsYT1uJiYhZS5xdWVyeVNlbGVjdG9yLHI9biYmIWUuYWRkRXZlbnRMaXN0ZW5lcixoPW5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSxsPS0xIT09aC5pbmRleE9mKCJ3ZWJraXQiKSx1PS0xIT09aC5pbmRleE9mKCJjaHJvbWUiKSxjPS0xIT09aC5pbmRleE9mKCJwaGFudG9tIiksZD0tMSE9PWguaW5kZXhPZigiYW5kcm9pZCIpLHA9LTEhPT1oLnNlYXJjaCgiYW5kcm9pZCBbMjNdIiksbT10eXBlb2Ygb3JpZW50YXRpb24hPWkrIiIsXz10Lm5hdmlnYXRvciYmdC5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZCYmdC5uYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cyxmPSJkZXZpY2VQaXhlbFJhdGlvImluIHQmJnQuZGV2aWNlUGl4ZWxSYXRpbz4xfHwibWF0Y2hNZWRpYSJpbiB0JiZ0Lm1hdGNoTWVkaWEoIihtaW4tcmVzb2x1dGlvbjoxNDRkcGkpIikmJnQubWF0Y2hNZWRpYSgiKG1pbi1yZXNvbHV0aW9uOjE0NGRwaSkiKS5tYXRjaGVzLGc9ZS5kb2N1bWVudEVsZW1lbnQsdj1uJiYidHJhbnNpdGlvbiJpbiBnLnN0eWxlLHk9IldlYktpdENTU01hdHJpeCJpbiB0JiYibTExImluIG5ldyB0LldlYktpdENTU01hdHJpeCxMPSJNb3pQZXJzcGVjdGl2ZSJpbiBnLnN0eWxlLFA9Ik9UcmFuc2l0aW9uImluIGcuc3R5bGUseD0hdC5MX0RJU0FCTEVfM0QmJih2fHx5fHxMfHxQKSYmIWMsdz0hdC5MX05PX1RPVUNIJiYhYyYmZnVuY3Rpb24oKXt2YXIgdD0ib250b3VjaHN0YXJ0IjtpZihffHx0IGluIGcpcmV0dXJuITA7dmFyIGk9ZS5jcmVhdGVFbGVtZW50KCJkaXYiKSxuPSExO3JldHVybiBpLnNldEF0dHJpYnV0ZT8oaS5zZXRBdHRyaWJ1dGUodCwicmV0dXJuOyIpLCJmdW5jdGlvbiI9PXR5cGVvZiBpW3RdJiYobj0hMCksaS5yZW1vdmVBdHRyaWJ1dGUodCksaT1udWxsLG4pOiExfSgpO28uQnJvd3Nlcj17aWU6bixpZTY6cyxpZTc6YSxpZWx0OTpyLHdlYmtpdDpsLGFuZHJvaWQ6ZCxhbmRyb2lkMjM6cCxjaHJvbWU6dSxpZTNkOnYsd2Via2l0M2Q6eSxnZWNrbzNkOkwsb3BlcmEzZDpQLGFueTNkOngsbW9iaWxlOm0sbW9iaWxlV2Via2l0Om0mJmwsbW9iaWxlV2Via2l0M2Q6bSYmeSxtb2JpbGVPcGVyYTptJiZ0Lm9wZXJhLHRvdWNoOncsbXNUb3VjaDpfLHJldGluYTpmfX0oKSxvLlBvaW50PWZ1bmN0aW9uKHQsZSxpKXt0aGlzLng9aT9NYXRoLnJvdW5kKHQpOnQsdGhpcy55PWk/TWF0aC5yb3VuZChlKTplfSxvLlBvaW50LnByb3RvdHlwZT17Y2xvbmU6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IG8uUG9pbnQodGhpcy54LHRoaXMueSl9LGFkZDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5jbG9uZSgpLl9hZGQoby5wb2ludCh0KSl9LF9hZGQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueCs9dC54LHRoaXMueSs9dC55LHRoaXN9LHN1YnRyYWN0OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmNsb25lKCkuX3N1YnRyYWN0KG8ucG9pbnQodCkpfSxfc3VidHJhY3Q6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueC09dC54LHRoaXMueS09dC55LHRoaXN9LGRpdmlkZUJ5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmNsb25lKCkuX2RpdmlkZUJ5KHQpfSxfZGl2aWRlQnk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueC89dCx0aGlzLnkvPXQsdGhpc30sbXVsdGlwbHlCeTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5jbG9uZSgpLl9tdWx0aXBseUJ5KHQpfSxfbXVsdGlwbHlCeTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy54Kj10LHRoaXMueSo9dCx0aGlzfSxyb3VuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNsb25lKCkuX3JvdW5kKCl9LF9yb3VuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLng9TWF0aC5yb3VuZCh0aGlzLngpLHRoaXMueT1NYXRoLnJvdW5kKHRoaXMueSksdGhpc30sZmxvb3I6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jbG9uZSgpLl9mbG9vcigpfSxfZmxvb3I6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy54PU1hdGguZmxvb3IodGhpcy54KSx0aGlzLnk9TWF0aC5mbG9vcih0aGlzLnkpLHRoaXN9LGRpc3RhbmNlVG86ZnVuY3Rpb24odCl7dD1vLnBvaW50KHQpO3ZhciBlPXQueC10aGlzLngsaT10LnktdGhpcy55O3JldHVybiBNYXRoLnNxcnQoZSplK2kqaSl9LGVxdWFsczpmdW5jdGlvbih0KXtyZXR1cm4gdD1vLnBvaW50KHQpLHQueD09PXRoaXMueCYmdC55PT09dGhpcy55fSxjb250YWluczpmdW5jdGlvbih0KXtyZXR1cm4gdD1vLnBvaW50KHQpLE1hdGguYWJzKHQueCk8PU1hdGguYWJzKHRoaXMueCkmJk1hdGguYWJzKHQueSk8PU1hdGguYWJzKHRoaXMueSl9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIlBvaW50KCIrby5VdGlsLmZvcm1hdE51bSh0aGlzLngpKyIsICIrby5VdGlsLmZvcm1hdE51bSh0aGlzLnkpKyIpIn19LG8ucG9pbnQ9ZnVuY3Rpb24odCxlLG4pe3JldHVybiB0IGluc3RhbmNlb2Ygby5Qb2ludD90Om8uVXRpbC5pc0FycmF5KHQpP25ldyBvLlBvaW50KHRbMF0sdFsxXSk6dD09PWl8fG51bGw9PT10P3Q6bmV3IG8uUG9pbnQodCxlLG4pfSxvLkJvdW5kcz1mdW5jdGlvbih0LGUpe2lmKHQpZm9yKHZhciBpPWU/W3QsZV06dCxuPTAsbz1pLmxlbmd0aDtvPm47bisrKXRoaXMuZXh0ZW5kKGlbbl0pfSxvLkJvdW5kcy5wcm90b3R5cGU9e2V4dGVuZDpmdW5jdGlvbih0KXtyZXR1cm4gdD1vLnBvaW50KHQpLHRoaXMubWlufHx0aGlzLm1heD8odGhpcy5taW4ueD1NYXRoLm1pbih0LngsdGhpcy5taW4ueCksdGhpcy5tYXgueD1NYXRoLm1heCh0LngsdGhpcy5tYXgueCksdGhpcy5taW4ueT1NYXRoLm1pbih0LnksdGhpcy5taW4ueSksdGhpcy5tYXgueT1NYXRoLm1heCh0LnksdGhpcy5tYXgueSkpOih0aGlzLm1pbj10LmNsb25lKCksdGhpcy5tYXg9dC5jbG9uZSgpKSx0aGlzfSxnZXRDZW50ZXI6ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBvLlBvaW50KCh0aGlzLm1pbi54K3RoaXMubWF4LngpLzIsKHRoaXMubWluLnkrdGhpcy5tYXgueSkvMix0KX0sZ2V0Qm90dG9tTGVmdDpmdW5jdGlvbigpe3JldHVybiBuZXcgby5Qb2ludCh0aGlzLm1pbi54LHRoaXMubWF4LnkpfSxnZXRUb3BSaWdodDpmdW5jdGlvbigpe3JldHVybiBuZXcgby5Qb2ludCh0aGlzLm1heC54LHRoaXMubWluLnkpfSxnZXRTaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWF4LnN1YnRyYWN0KHRoaXMubWluKX0sY29udGFpbnM6ZnVuY3Rpb24odCl7dmFyIGUsaTtyZXR1cm4gdD0ibnVtYmVyIj09dHlwZW9mIHRbMF18fHQgaW5zdGFuY2VvZiBvLlBvaW50P28ucG9pbnQodCk6by5ib3VuZHModCksdCBpbnN0YW5jZW9mIG8uQm91bmRzPyhlPXQubWluLGk9dC5tYXgpOmU9aT10LGUueD49dGhpcy5taW4ueCYmaS54PD10aGlzLm1heC54JiZlLnk+PXRoaXMubWluLnkmJmkueTw9dGhpcy5tYXgueX0saW50ZXJzZWN0czpmdW5jdGlvbih0KXt0PW8uYm91bmRzKHQpO3ZhciBlPXRoaXMubWluLGk9dGhpcy5tYXgsbj10Lm1pbixzPXQubWF4LGE9cy54Pj1lLngmJm4ueDw9aS54LHI9cy55Pj1lLnkmJm4ueTw9aS55O3JldHVybiBhJiZyfSxpc1ZhbGlkOmZ1bmN0aW9uKCl7cmV0dXJuISghdGhpcy5taW58fCF0aGlzLm1heCl9fSxvLmJvdW5kcz1mdW5jdGlvbih0LGUpe3JldHVybiF0fHx0IGluc3RhbmNlb2Ygby5Cb3VuZHM/dDpuZXcgby5Cb3VuZHModCxlKX0sby5UcmFuc2Zvcm1hdGlvbj1mdW5jdGlvbih0LGUsaSxuKXt0aGlzLl9hPXQsdGhpcy5fYj1lLHRoaXMuX2M9aSx0aGlzLl9kPW59LG8uVHJhbnNmb3JtYXRpb24ucHJvdG90eXBlPXt0cmFuc2Zvcm06ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5fdHJhbnNmb3JtKHQuY2xvbmUoKSxlKX0sX3RyYW5zZm9ybTpmdW5jdGlvbih0LGUpe3JldHVybiBlPWV8fDEsdC54PWUqKHRoaXMuX2EqdC54K3RoaXMuX2IpLHQueT1lKih0aGlzLl9jKnQueSt0aGlzLl9kKSx0fSx1bnRyYW5zZm9ybTpmdW5jdGlvbih0LGUpe3JldHVybiBlPWV8fDEsbmV3IG8uUG9pbnQoKHQueC9lLXRoaXMuX2IpL3RoaXMuX2EsKHQueS9lLXRoaXMuX2QpL3RoaXMuX2MpfX0sby5Eb21VdGlsPXtnZXQ6ZnVuY3Rpb24odCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P2UuZ2V0RWxlbWVudEJ5SWQodCk6dH0sZ2V0U3R5bGU6ZnVuY3Rpb24odCxpKXt2YXIgbj10LnN0eWxlW2ldO2lmKCFuJiZ0LmN1cnJlbnRTdHlsZSYmKG49dC5jdXJyZW50U3R5bGVbaV0pLCghbnx8ImF1dG8iPT09bikmJmUuZGVmYXVsdFZpZXcpe3ZhciBvPWUuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSh0LG51bGwpO249bz9vW2ldOm51bGx9cmV0dXJuImF1dG8iPT09bj9udWxsOm59LGdldFZpZXdwb3J0T2Zmc2V0OmZ1bmN0aW9uKHQpe3ZhciBpLG49MCxzPTAsYT10LHI9ZS5ib2R5LGg9ZS5kb2N1bWVudEVsZW1lbnQsbD1vLkJyb3dzZXIuaWU3O2Rve2lmKG4rPWEub2Zmc2V0VG9wfHwwLHMrPWEub2Zmc2V0TGVmdHx8MCxuKz1wYXJzZUludChvLkRvbVV0aWwuZ2V0U3R5bGUoYSwiYm9yZGVyVG9wV2lkdGgiKSwxMCl8fDAscys9cGFyc2VJbnQoby5Eb21VdGlsLmdldFN0eWxlKGEsImJvcmRlckxlZnRXaWR0aCIpLDEwKXx8MCxpPW8uRG9tVXRpbC5nZXRTdHlsZShhLCJwb3NpdGlvbiIpLGEub2Zmc2V0UGFyZW50PT09ciYmImFic29sdXRlIj09PWkpYnJlYWs7aWYoImZpeGVkIj09PWkpe24rPXIuc2Nyb2xsVG9wfHxoLnNjcm9sbFRvcHx8MCxzKz1yLnNjcm9sbExlZnR8fGguc2Nyb2xsTGVmdHx8MDticmVha31pZigicmVsYXRpdmUiPT09aSYmIWEub2Zmc2V0TGVmdCl7dmFyIHU9by5Eb21VdGlsLmdldFN0eWxlKGEsIndpZHRoIiksYz1vLkRvbVV0aWwuZ2V0U3R5bGUoYSwibWF4LXdpZHRoIiksZD1hLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOygibm9uZSIhPT11fHwibm9uZSIhPT1jKSYmKHMrPWQubGVmdCthLmNsaWVudExlZnQpLG4rPWQudG9wKyhyLnNjcm9sbFRvcHx8aC5zY3JvbGxUb3B8fDApO2JyZWFrfWE9YS5vZmZzZXRQYXJlbnR9d2hpbGUoYSk7YT10O2Rve2lmKGE9PT1yKWJyZWFrO24tPWEuc2Nyb2xsVG9wfHwwLHMtPWEuc2Nyb2xsTGVmdHx8MCxvLkRvbVV0aWwuZG9jdW1lbnRJc0x0cigpfHwhby5Ccm93c2VyLndlYmtpdCYmIWx8fChzKz1hLnNjcm9sbFdpZHRoLWEuY2xpZW50V2lkdGgsbCYmImhpZGRlbiIhPT1vLkRvbVV0aWwuZ2V0U3R5bGUoYSwib3ZlcmZsb3cteSIpJiYiaGlkZGVuIiE9PW8uRG9tVXRpbC5nZXRTdHlsZShhLCJvdmVyZmxvdyIpJiYocys9MTcpKSxhPWEucGFyZW50Tm9kZX13aGlsZShhKTtyZXR1cm4gbmV3IG8uUG9pbnQocyxuKX0sZG9jdW1lbnRJc0x0cjpmdW5jdGlvbigpe3JldHVybiBvLkRvbVV0aWwuX2RvY0lzTHRyQ2FjaGVkfHwoby5Eb21VdGlsLl9kb2NJc0x0ckNhY2hlZD0hMCxvLkRvbVV0aWwuX2RvY0lzTHRyPSJsdHIiPT09by5Eb21VdGlsLmdldFN0eWxlKGUuYm9keSwiZGlyZWN0aW9uIikpLG8uRG9tVXRpbC5fZG9jSXNMdHJ9LGNyZWF0ZTpmdW5jdGlvbih0LGksbil7dmFyIG89ZS5jcmVhdGVFbGVtZW50KHQpO3JldHVybiBvLmNsYXNzTmFtZT1pLG4mJm4uYXBwZW5kQ2hpbGQobyksb30saGFzQ2xhc3M6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdC5jbGFzc05hbWUubGVuZ3RoPjAmJm5ldyBSZWdFeHAoIihefFxccykiK2UrIihcXHN8JCkiKS50ZXN0KHQuY2xhc3NOYW1lKX0sYWRkQ2xhc3M6ZnVuY3Rpb24odCxlKXtvLkRvbVV0aWwuaGFzQ2xhc3ModCxlKXx8KHQuY2xhc3NOYW1lKz0odC5jbGFzc05hbWU/IiAiOiIiKStlKX0scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24odCxlKXt0LmNsYXNzTmFtZT1vLlV0aWwudHJpbSgoIiAiK3QuY2xhc3NOYW1lKyIgIikucmVwbGFjZSgiICIrZSsiICIsIiAiKSl9LHNldE9wYWNpdHk6ZnVuY3Rpb24odCxlKXtpZigib3BhY2l0eSJpbiB0LnN0eWxlKXQuc3R5bGUub3BhY2l0eT1lO2Vsc2UgaWYoImZpbHRlciJpbiB0LnN0eWxlKXt2YXIgaT0hMSxuPSJEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5BbHBoYSI7dHJ5e2k9dC5maWx0ZXJzLml0ZW0obil9Y2F0Y2gobyl7aWYoMT09PWUpcmV0dXJufWU9TWF0aC5yb3VuZCgxMDAqZSksaT8oaS5FbmFibGVkPTEwMCE9PWUsaS5PcGFjaXR5PWUpOnQuc3R5bGUuZmlsdGVyKz0iIHByb2dpZDoiK24rIihvcGFjaXR5PSIrZSsiKSJ9fSx0ZXN0UHJvcDpmdW5jdGlvbih0KXtmb3IodmFyIGk9ZS5kb2N1bWVudEVsZW1lbnQuc3R5bGUsbj0wO248dC5sZW5ndGg7bisrKWlmKHRbbl1pbiBpKXJldHVybiB0W25dO3JldHVybiExfSxnZXRUcmFuc2xhdGVTdHJpbmc6ZnVuY3Rpb24odCl7dmFyIGU9by5Ccm93c2VyLndlYmtpdDNkLGk9InRyYW5zbGF0ZSIrKGU/IjNkIjoiIikrIigiLG49KGU/IiwwIjoiIikrIikiO3JldHVybiBpK3QueCsicHgsIit0LnkrInB4IitufSxnZXRTY2FsZVN0cmluZzpmdW5jdGlvbih0LGUpe3ZhciBpPW8uRG9tVXRpbC5nZXRUcmFuc2xhdGVTdHJpbmcoZS5hZGQoZS5tdWx0aXBseUJ5KC0xKnQpKSksbj0iIHNjYWxlKCIrdCsiKSAiO3JldHVybiBpK259LHNldFBvc2l0aW9uOmZ1bmN0aW9uKHQsZSxpKXt0Ll9sZWFmbGV0X3Bvcz1lLCFpJiZvLkJyb3dzZXIuYW55M2Q/KHQuc3R5bGVbby5Eb21VdGlsLlRSQU5TRk9STV09by5Eb21VdGlsLmdldFRyYW5zbGF0ZVN0cmluZyhlKSxvLkJyb3dzZXIubW9iaWxlV2Via2l0M2QmJih0LnN0eWxlLldlYmtpdEJhY2tmYWNlVmlzaWJpbGl0eT0iaGlkZGVuIikpOih0LnN0eWxlLmxlZnQ9ZS54KyJweCIsdC5zdHlsZS50b3A9ZS55KyJweCIpfSxnZXRQb3NpdGlvbjpmdW5jdGlvbih0KXtyZXR1cm4gdC5fbGVhZmxldF9wb3N9fSxvLkRvbVV0aWwuVFJBTlNGT1JNPW8uRG9tVXRpbC50ZXN0UHJvcChbInRyYW5zZm9ybSIsIldlYmtpdFRyYW5zZm9ybSIsIk9UcmFuc2Zvcm0iLCJNb3pUcmFuc2Zvcm0iLCJtc1RyYW5zZm9ybSJdKSxvLkRvbVV0aWwuVFJBTlNJVElPTj1vLkRvbVV0aWwudGVzdFByb3AoWyJ3ZWJraXRUcmFuc2l0aW9uIiwidHJhbnNpdGlvbiIsIk9UcmFuc2l0aW9uIiwiTW96VHJhbnNpdGlvbiIsIm1zVHJhbnNpdGlvbiJdKSxvLkRvbVV0aWwuVFJBTlNJVElPTl9FTkQ9IndlYmtpdFRyYW5zaXRpb24iPT09by5Eb21VdGlsLlRSQU5TSVRJT058fCJPVHJhbnNpdGlvbiI9PT1vLkRvbVV0aWwuVFJBTlNJVElPTj9vLkRvbVV0aWwuVFJBTlNJVElPTisiRW5kIjoidHJhbnNpdGlvbmVuZCIsZnVuY3Rpb24oKXt2YXIgaT1vLkRvbVV0aWwudGVzdFByb3AoWyJ1c2VyU2VsZWN0IiwiV2Via2l0VXNlclNlbGVjdCIsIk9Vc2VyU2VsZWN0IiwiTW96VXNlclNlbGVjdCIsIm1zVXNlclNlbGVjdCJdKTtvLmV4dGVuZChvLkRvbVV0aWwse2Rpc2FibGVUZXh0U2VsZWN0aW9uOmZ1bmN0aW9uKCl7aWYoby5Eb21FdmVudC5vbih0LCJzZWxlY3RzdGFydCIsby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCksaSl7dmFyIG49ZS5kb2N1bWVudEVsZW1lbnQuc3R5bGU7dGhpcy5fdXNlclNlbGVjdD1uW2ldLG5baV09Im5vbmUifX0sZW5hYmxlVGV4dFNlbGVjdGlvbjpmdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKHQsInNlbGVjdHN0YXJ0IixvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KSxpJiYoZS5kb2N1bWVudEVsZW1lbnQuc3R5bGVbaV09dGhpcy5fdXNlclNlbGVjdCxkZWxldGUgdGhpcy5fdXNlclNlbGVjdCl9LGRpc2FibGVJbWFnZURyYWc6ZnVuY3Rpb24oKXtvLkRvbUV2ZW50Lm9uKHQsImRyYWdzdGFydCIsby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCl9LGVuYWJsZUltYWdlRHJhZzpmdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKHQsImRyYWdzdGFydCIsby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCl9fSl9KCksby5MYXRMbmc9ZnVuY3Rpb24odCxlKXt2YXIgaT1wYXJzZUZsb2F0KHQpLG49cGFyc2VGbG9hdChlKTtpZihpc05hTihpKXx8aXNOYU4obikpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIExhdExuZyBvYmplY3Q6ICgiK3QrIiwgIitlKyIpIik7dGhpcy5sYXQ9aSx0aGlzLmxuZz1ufSxvLmV4dGVuZChvLkxhdExuZyx7REVHX1RPX1JBRDpNYXRoLlBJLzE4MCxSQURfVE9fREVHOjE4MC9NYXRoLlBJLE1BWF9NQVJHSU46MWUtOX0pLG8uTGF0TG5nLnByb3RvdHlwZT17ZXF1YWxzOmZ1bmN0aW9uKHQpe2lmKCF0KXJldHVybiExO3Q9by5sYXRMbmcodCk7dmFyIGU9TWF0aC5tYXgoTWF0aC5hYnModGhpcy5sYXQtdC5sYXQpLE1hdGguYWJzKHRoaXMubG5nLXQubG5nKSk7cmV0dXJuIGU8PW8uTGF0TG5nLk1BWF9NQVJHSU59LHRvU3RyaW5nOmZ1bmN0aW9uKHQpe3JldHVybiJMYXRMbmcoIitvLlV0aWwuZm9ybWF0TnVtKHRoaXMubGF0LHQpKyIsICIrby5VdGlsLmZvcm1hdE51bSh0aGlzLmxuZyx0KSsiKSJ9LGRpc3RhbmNlVG86ZnVuY3Rpb24odCl7dD1vLmxhdExuZyh0KTt2YXIgZT02Mzc4MTM3LGk9by5MYXRMbmcuREVHX1RPX1JBRCxuPSh0LmxhdC10aGlzLmxhdCkqaSxzPSh0LmxuZy10aGlzLmxuZykqaSxhPXRoaXMubGF0Kmkscj10LmxhdCppLGg9TWF0aC5zaW4obi8yKSxsPU1hdGguc2luKHMvMiksdT1oKmgrbCpsKk1hdGguY29zKGEpKk1hdGguY29zKHIpO3JldHVybiAyKmUqTWF0aC5hdGFuMihNYXRoLnNxcnQodSksTWF0aC5zcXJ0KDEtdSkpfSx3cmFwOmZ1bmN0aW9uKHQsZSl7dmFyIGk9dGhpcy5sbmc7cmV0dXJuIHQ9dHx8LTE4MCxlPWV8fDE4MCxpPShpK2UpJShlLXQpKyh0Pml8fGk9PT1lP2U6dCksbmV3IG8uTGF0TG5nKHRoaXMubGF0LGkpfX0sby5sYXRMbmc9ZnVuY3Rpb24odCxlKXtyZXR1cm4gdCBpbnN0YW5jZW9mIG8uTGF0TG5nP3Q6by5VdGlsLmlzQXJyYXkodCk/Im51bWJlciI9PXR5cGVvZiB0WzBdfHwic3RyaW5nIj09dHlwZW9mIHRbMF0/bmV3IG8uTGF0TG5nKHRbMF0sdFsxXSk6bnVsbDp0PT09aXx8bnVsbD09PXQ/dDoib2JqZWN0Ij09dHlwZW9mIHQmJiJsYXQiaW4gdD9uZXcgby5MYXRMbmcodC5sYXQsImxuZyJpbiB0P3QubG5nOnQubG9uKTplPT09aT9udWxsOm5ldyBvLkxhdExuZyh0LGUpfSxvLkxhdExuZ0JvdW5kcz1mdW5jdGlvbih0LGUpe2lmKHQpZm9yKHZhciBpPWU/W3QsZV06dCxuPTAsbz1pLmxlbmd0aDtvPm47bisrKXRoaXMuZXh0ZW5kKGlbbl0pfSxvLkxhdExuZ0JvdW5kcy5wcm90b3R5cGU9e2V4dGVuZDpmdW5jdGlvbih0KXtpZighdClyZXR1cm4gdGhpczt2YXIgZT1vLmxhdExuZyh0KTtyZXR1cm4gdD1udWxsIT09ZT9lOm8ubGF0TG5nQm91bmRzKHQpLHQgaW5zdGFuY2VvZiBvLkxhdExuZz90aGlzLl9zb3V0aFdlc3R8fHRoaXMuX25vcnRoRWFzdD8odGhpcy5fc291dGhXZXN0LmxhdD1NYXRoLm1pbih0LmxhdCx0aGlzLl9zb3V0aFdlc3QubGF0KSx0aGlzLl9zb3V0aFdlc3QubG5nPU1hdGgubWluKHQubG5nLHRoaXMuX3NvdXRoV2VzdC5sbmcpLHRoaXMuX25vcnRoRWFzdC5sYXQ9TWF0aC5tYXgodC5sYXQsdGhpcy5fbm9ydGhFYXN0LmxhdCksdGhpcy5fbm9ydGhFYXN0LmxuZz1NYXRoLm1heCh0LmxuZyx0aGlzLl9ub3J0aEVhc3QubG5nKSk6KHRoaXMuX3NvdXRoV2VzdD1uZXcgby5MYXRMbmcodC5sYXQsdC5sbmcpLHRoaXMuX25vcnRoRWFzdD1uZXcgby5MYXRMbmcodC5sYXQsdC5sbmcpKTp0IGluc3RhbmNlb2Ygby5MYXRMbmdCb3VuZHMmJih0aGlzLmV4dGVuZCh0Ll9zb3V0aFdlc3QpLHRoaXMuZXh0ZW5kKHQuX25vcnRoRWFzdCkpLHRoaXN9LHBhZDpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9zb3V0aFdlc3QsaT10aGlzLl9ub3J0aEVhc3Qsbj1NYXRoLmFicyhlLmxhdC1pLmxhdCkqdCxzPU1hdGguYWJzKGUubG5nLWkubG5nKSp0O3JldHVybiBuZXcgby5MYXRMbmdCb3VuZHMobmV3IG8uTGF0TG5nKGUubGF0LW4sZS5sbmctcyksbmV3IG8uTGF0TG5nKGkubGF0K24saS5sbmcrcykpfSxnZXRDZW50ZXI6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IG8uTGF0TG5nKCh0aGlzLl9zb3V0aFdlc3QubGF0K3RoaXMuX25vcnRoRWFzdC5sYXQpLzIsKHRoaXMuX3NvdXRoV2VzdC5sbmcrdGhpcy5fbm9ydGhFYXN0LmxuZykvMil9LGdldFNvdXRoV2VzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zb3V0aFdlc3R9LGdldE5vcnRoRWFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9ub3J0aEVhc3R9LGdldE5vcnRoV2VzdDpmdW5jdGlvbigpe3JldHVybiBuZXcgby5MYXRMbmcodGhpcy5nZXROb3J0aCgpLHRoaXMuZ2V0V2VzdCgpKX0sZ2V0U291dGhFYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBvLkxhdExuZyh0aGlzLmdldFNvdXRoKCksdGhpcy5nZXRFYXN0KCkpfSxnZXRXZXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NvdXRoV2VzdC5sbmd9LGdldFNvdXRoOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NvdXRoV2VzdC5sYXR9LGdldEVhc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbm9ydGhFYXN0LmxuZ30sZ2V0Tm9ydGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbm9ydGhFYXN0LmxhdH0sY29udGFpbnM6ZnVuY3Rpb24odCl7dD0ibnVtYmVyIj09dHlwZW9mIHRbMF18fHQgaW5zdGFuY2VvZiBvLkxhdExuZz9vLmxhdExuZyh0KTpvLmxhdExuZ0JvdW5kcyh0KTt2YXIgZSxpLG49dGhpcy5fc291dGhXZXN0LHM9dGhpcy5fbm9ydGhFYXN0O3JldHVybiB0IGluc3RhbmNlb2Ygby5MYXRMbmdCb3VuZHM/KGU9dC5nZXRTb3V0aFdlc3QoKSxpPXQuZ2V0Tm9ydGhFYXN0KCkpOmU9aT10LGUubGF0Pj1uLmxhdCYmaS5sYXQ8PXMubGF0JiZlLmxuZz49bi5sbmcmJmkubG5nPD1zLmxuZ30saW50ZXJzZWN0czpmdW5jdGlvbih0KXt0PW8ubGF0TG5nQm91bmRzKHQpO3ZhciBlPXRoaXMuX3NvdXRoV2VzdCxpPXRoaXMuX25vcnRoRWFzdCxuPXQuZ2V0U291dGhXZXN0KCkscz10LmdldE5vcnRoRWFzdCgpLGE9cy5sYXQ+PWUubGF0JiZuLmxhdDw9aS5sYXQscj1zLmxuZz49ZS5sbmcmJm4ubG5nPD1pLmxuZztyZXR1cm4gYSYmcn0sdG9CQm94U3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuW3RoaXMuZ2V0V2VzdCgpLHRoaXMuZ2V0U291dGgoKSx0aGlzLmdldEVhc3QoKSx0aGlzLmdldE5vcnRoKCldLmpvaW4oIiwiKX0sZXF1YWxzOmZ1bmN0aW9uKHQpe3JldHVybiB0Pyh0PW8ubGF0TG5nQm91bmRzKHQpLHRoaXMuX3NvdXRoV2VzdC5lcXVhbHModC5nZXRTb3V0aFdlc3QoKSkmJnRoaXMuX25vcnRoRWFzdC5lcXVhbHModC5nZXROb3J0aEVhc3QoKSkpOiExfSxpc1ZhbGlkOmZ1bmN0aW9uKCl7cmV0dXJuISghdGhpcy5fc291dGhXZXN0fHwhdGhpcy5fbm9ydGhFYXN0KX19LG8ubGF0TG5nQm91bmRzPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIXR8fHQgaW5zdGFuY2VvZiBvLkxhdExuZ0JvdW5kcz90Om5ldyBvLkxhdExuZ0JvdW5kcyh0LGUpfSxvLlByb2plY3Rpb249e30sby5Qcm9qZWN0aW9uLlNwaGVyaWNhbE1lcmNhdG9yPXtNQVhfTEFUSVRVREU6ODUuMDUxMTI4Nzc5OCxwcm9qZWN0OmZ1bmN0aW9uKHQpe3ZhciBlPW8uTGF0TG5nLkRFR19UT19SQUQsaT10aGlzLk1BWF9MQVRJVFVERSxuPU1hdGgubWF4KE1hdGgubWluKGksdC5sYXQpLC1pKSxzPXQubG5nKmUsYT1uKmU7cmV0dXJuIGE9TWF0aC5sb2coTWF0aC50YW4oTWF0aC5QSS80K2EvMikpLG5ldyBvLlBvaW50KHMsYSl9LHVucHJvamVjdDpmdW5jdGlvbih0KXt2YXIgZT1vLkxhdExuZy5SQURfVE9fREVHLGk9dC54KmUsbj0oMipNYXRoLmF0YW4oTWF0aC5leHAodC55KSktTWF0aC5QSS8yKSplO3JldHVybiBuZXcgby5MYXRMbmcobixpKX19LG8uUHJvamVjdGlvbi5Mb25MYXQ9e3Byb2plY3Q6ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBvLlBvaW50KHQubG5nLHQubGF0KX0sdW5wcm9qZWN0OmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5MYXRMbmcodC55LHQueCl9fSxvLkNSUz17bGF0TG5nVG9Qb2ludDpmdW5jdGlvbih0LGUpe3ZhciBpPXRoaXMucHJvamVjdGlvbi5wcm9qZWN0KHQpLG49dGhpcy5zY2FsZShlKTtyZXR1cm4gdGhpcy50cmFuc2Zvcm1hdGlvbi5fdHJhbnNmb3JtKGksbil9LHBvaW50VG9MYXRMbmc6ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLnNjYWxlKGUpLG49dGhpcy50cmFuc2Zvcm1hdGlvbi51bnRyYW5zZm9ybSh0LGkpO3JldHVybiB0aGlzLnByb2plY3Rpb24udW5wcm9qZWN0KG4pfSxwcm9qZWN0OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLnByb2plY3Rpb24ucHJvamVjdCh0KX0sc2NhbGU6ZnVuY3Rpb24odCl7cmV0dXJuIDI1NipNYXRoLnBvdygyLHQpfX0sby5DUlMuU2ltcGxlPW8uZXh0ZW5kKHt9LG8uQ1JTLHtwcm9qZWN0aW9uOm8uUHJvamVjdGlvbi5Mb25MYXQsdHJhbnNmb3JtYXRpb246bmV3IG8uVHJhbnNmb3JtYXRpb24oMSwwLC0xLDApLHNjYWxlOmZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdygyLHQpfX0pLG8uQ1JTLkVQU0czODU3PW8uZXh0ZW5kKHt9LG8uQ1JTLHtjb2RlOiJFUFNHOjM4NTciLHByb2plY3Rpb246by5Qcm9qZWN0aW9uLlNwaGVyaWNhbE1lcmNhdG9yLHRyYW5zZm9ybWF0aW9uOm5ldyBvLlRyYW5zZm9ybWF0aW9uKC41L01hdGguUEksLjUsLS41L01hdGguUEksLjUpLHByb2plY3Q6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5wcm9qZWN0aW9uLnByb2plY3QodCksaT02Mzc4MTM3O3JldHVybiBlLm11bHRpcGx5QnkoaSl9fSksby5DUlMuRVBTRzkwMDkxMz1vLmV4dGVuZCh7fSxvLkNSUy5FUFNHMzg1Nyx7Y29kZToiRVBTRzo5MDA5MTMifSksby5DUlMuRVBTRzQzMjY9by5leHRlbmQoe30sby5DUlMse2NvZGU6IkVQU0c6NDMyNiIscHJvamVjdGlvbjpvLlByb2plY3Rpb24uTG9uTGF0LHRyYW5zZm9ybWF0aW9uOm5ldyBvLlRyYW5zZm9ybWF0aW9uKDEvMzYwLC41LC0xLzM2MCwuNSl9KSxvLk1hcD1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsb3B0aW9uczp7Y3JzOm8uQ1JTLkVQU0czODU3LGZhZGVBbmltYXRpb246by5Eb21VdGlsLlRSQU5TSVRJT04mJiFvLkJyb3dzZXIuYW5kcm9pZDIzLHRyYWNrUmVzaXplOiEwLG1hcmtlclpvb21BbmltYXRpb246by5Eb21VdGlsLlRSQU5TSVRJT04mJm8uQnJvd3Nlci5hbnkzZH0saW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUpe2U9by5zZXRPcHRpb25zKHRoaXMsZSksdGhpcy5faW5pdENvbnRhaW5lcih0KSx0aGlzLl9pbml0TGF5b3V0KCksdGhpcy5fb25SZXNpemU9by5iaW5kKHRoaXMuX29uUmVzaXplLHRoaXMpLHRoaXMuX2luaXRFdmVudHMoKSxlLm1heEJvdW5kcyYmdGhpcy5zZXRNYXhCb3VuZHMoZS5tYXhCb3VuZHMpLGUuY2VudGVyJiZlLnpvb20hPT1pJiZ0aGlzLnNldFZpZXcoby5sYXRMbmcoZS5jZW50ZXIpLGUuem9vbSx7cmVzZXQ6ITB9KSx0aGlzLl9oYW5kbGVycz1bXSx0aGlzLl9sYXllcnM9e30sdGhpcy5fem9vbUJvdW5kTGF5ZXJzPXt9LHRoaXMuX3RpbGVMYXllcnNOdW09MCx0aGlzLmNhbGxJbml0SG9va3MoKSx0aGlzLl9hZGRMYXllcnMoZS5sYXllcnMpfSxzZXRWaWV3OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIGU9ZT09PWk/dGhpcy5nZXRab29tKCk6ZSx0aGlzLl9yZXNldFZpZXcoby5sYXRMbmcodCksdGhpcy5fbGltaXRab29tKGUpKSx0aGlzfSxzZXRab29tOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX2xvYWRlZD90aGlzLnNldFZpZXcodGhpcy5nZXRDZW50ZXIoKSx0LHt6b29tOmV9KToodGhpcy5fem9vbT10aGlzLl9saW1pdFpvb20odCksdGhpcyl9LHpvb21JbjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnNldFpvb20odGhpcy5fem9vbSsodHx8MSksZSl9LHpvb21PdXQ6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5zZXRab29tKHRoaXMuX3pvb20tKHR8fDEpLGUpfSxzZXRab29tQXJvdW5kOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbj10aGlzLmdldFpvb21TY2FsZShlKSxzPXRoaXMuZ2V0U2l6ZSgpLmRpdmlkZUJ5KDIpLGE9dCBpbnN0YW5jZW9mIG8uUG9pbnQ/dDp0aGlzLmxhdExuZ1RvQ29udGFpbmVyUG9pbnQodCkscj1hLnN1YnRyYWN0KHMpLm11bHRpcGx5QnkoMS0xL24pLGg9dGhpcy5jb250YWluZXJQb2ludFRvTGF0TG5nKHMuYWRkKHIpKTtyZXR1cm4gdGhpcy5zZXRWaWV3KGgsZSx7em9vbTppfSl9LGZpdEJvdW5kczpmdW5jdGlvbih0LGUpe2U9ZXx8e30sdD10LmdldEJvdW5kcz90LmdldEJvdW5kcygpOm8ubGF0TG5nQm91bmRzKHQpO3ZhciBpPW8ucG9pbnQoZS5wYWRkaW5nVG9wTGVmdHx8ZS5wYWRkaW5nfHxbMCwwXSksbj1vLnBvaW50KGUucGFkZGluZ0JvdHRvbVJpZ2h0fHxlLnBhZGRpbmd8fFswLDBdKSxzPXRoaXMuZ2V0Qm91bmRzWm9vbSh0LCExLGkuYWRkKG4pKSxhPW4uc3VidHJhY3QoaSkuZGl2aWRlQnkoMikscj10aGlzLnByb2plY3QodC5nZXRTb3V0aFdlc3QoKSxzKSxoPXRoaXMucHJvamVjdCh0LmdldE5vcnRoRWFzdCgpLHMpLGw9dGhpcy51bnByb2plY3Qoci5hZGQoaCkuZGl2aWRlQnkoMikuYWRkKGEpLHMpO3JldHVybiB0aGlzLnNldFZpZXcobCxzLGUpfSxmaXRXb3JsZDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5maXRCb3VuZHMoW1stOTAsLTE4MF0sWzkwLDE4MF1dLHQpfSxwYW5UbzpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnNldFZpZXcodCx0aGlzLl96b29tLHtwYW46ZX0pfSxwYW5CeTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5maXJlKCJtb3Zlc3RhcnQiKSx0aGlzLl9yYXdQYW5CeShvLnBvaW50KHQpKSx0aGlzLmZpcmUoIm1vdmUiKSx0aGlzLmZpcmUoIm1vdmVlbmQiKX0sc2V0TWF4Qm91bmRzOmZ1bmN0aW9uKHQsZSl7aWYodD1vLmxhdExuZ0JvdW5kcyh0KSx0aGlzLm9wdGlvbnMubWF4Qm91bmRzPXQsIXQpcmV0dXJuIHRoaXMuX2JvdW5kc01pblpvb209bnVsbCx0aGlzLm9mZigibW92ZWVuZCIsdGhpcy5fcGFuSW5zaWRlTWF4Qm91bmRzLHRoaXMpLHRoaXM7dmFyIGk9dGhpcy5nZXRCb3VuZHNab29tKHQsITApO3JldHVybiB0aGlzLl9ib3VuZHNNaW5ab29tPWksdGhpcy5fbG9hZGVkJiYodGhpcy5fem9vbTxpP3RoaXMuc2V0Vmlldyh0LmdldENlbnRlcigpLGksZSk6dGhpcy5wYW5JbnNpZGVCb3VuZHModCkpLHRoaXMub24oIm1vdmVlbmQiLHRoaXMuX3Bhbkluc2lkZU1heEJvdW5kcyx0aGlzKSx0aGlzfSxwYW5JbnNpZGVCb3VuZHM6ZnVuY3Rpb24odCl7dD1vLmxhdExuZ0JvdW5kcyh0KTt2YXIgZT10aGlzLmdldFBpeGVsQm91bmRzKCksaT1lLmdldEJvdHRvbUxlZnQoKSxuPWUuZ2V0VG9wUmlnaHQoKSxzPXRoaXMucHJvamVjdCh0LmdldFNvdXRoV2VzdCgpKSxhPXRoaXMucHJvamVjdCh0LmdldE5vcnRoRWFzdCgpKSxyPTAsaD0wO3JldHVybiBuLnk8YS55JiYoaD1NYXRoLmNlaWwoYS55LW4ueSkpLG4ueD5hLngmJihyPU1hdGguZmxvb3IoYS54LW4ueCkpLGkueT5zLnkmJihoPU1hdGguZmxvb3Iocy55LWkueSkpLGkueDxzLngmJihyPU1hdGguY2VpbChzLngtaS54KSkscnx8aD90aGlzLnBhbkJ5KFtyLGhdKTp0aGlzfSxhZGRMYXllcjpmdW5jdGlvbih0KXt2YXIgZT1vLnN0YW1wKHQpO3JldHVybiB0aGlzLl9sYXllcnNbZV0/dGhpczoodGhpcy5fbGF5ZXJzW2VdPXQsIXQub3B0aW9uc3x8aXNOYU4odC5vcHRpb25zLm1heFpvb20pJiZpc05hTih0Lm9wdGlvbnMubWluWm9vbSl8fCh0aGlzLl96b29tQm91bmRMYXllcnNbZV09dCx0aGlzLl91cGRhdGVab29tTGV2ZWxzKCkpLHRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uJiZvLlRpbGVMYXllciYmdCBpbnN0YW5jZW9mIG8uVGlsZUxheWVyJiYodGhpcy5fdGlsZUxheWVyc051bSsrLHRoaXMuX3RpbGVMYXllcnNUb0xvYWQrKyx0Lm9uKCJsb2FkIix0aGlzLl9vblRpbGVMYXllckxvYWQsdGhpcykpLHRoaXMuX2xvYWRlZCYmdGhpcy5fbGF5ZXJBZGQodCksdGhpcyl9LHJlbW92ZUxheWVyOmZ1bmN0aW9uKHQpe3ZhciBlPW8uc3RhbXAodCk7cmV0dXJuIHRoaXMuX2xheWVyc1tlXT8odGhpcy5fbG9hZGVkJiZ0Lm9uUmVtb3ZlKHRoaXMpLGRlbGV0ZSB0aGlzLl9sYXllcnNbZV0sdGhpcy5fbG9hZGVkJiZ0aGlzLmZpcmUoImxheWVycmVtb3ZlIix7bGF5ZXI6dH0pLHRoaXMuX3pvb21Cb3VuZExheWVyc1tlXSYmKGRlbGV0ZSB0aGlzLl96b29tQm91bmRMYXllcnNbZV0sdGhpcy5fdXBkYXRlWm9vbUxldmVscygpKSx0aGlzLm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5UaWxlTGF5ZXImJnQgaW5zdGFuY2VvZiBvLlRpbGVMYXllciYmKHRoaXMuX3RpbGVMYXllcnNOdW0tLSx0aGlzLl90aWxlTGF5ZXJzVG9Mb2FkLS0sdC5vZmYoImxvYWQiLHRoaXMuX29uVGlsZUxheWVyTG9hZCx0aGlzKSksdGhpcyk6dGhpc30saGFzTGF5ZXI6ZnVuY3Rpb24odCl7cmV0dXJuIHQ/by5zdGFtcCh0KWluIHRoaXMuX2xheWVyczohMX0sZWFjaExheWVyOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBpIGluIHRoaXMuX2xheWVycyl0LmNhbGwoZSx0aGlzLl9sYXllcnNbaV0pO3JldHVybiB0aGlzfSxpbnZhbGlkYXRlU2l6ZTpmdW5jdGlvbih0KXt0PW8uZXh0ZW5kKHthbmltYXRlOiExLHBhbjohMH0sdD09PSEwP3thbmltYXRlOiEwfTp0KTt2YXIgZT10aGlzLmdldFNpemUoKTtpZih0aGlzLl9zaXplQ2hhbmdlZD0hMCx0aGlzLl9pbml0aWFsQ2VudGVyPW51bGwsdGhpcy5vcHRpb25zLm1heEJvdW5kcyYmdGhpcy5zZXRNYXhCb3VuZHModGhpcy5vcHRpb25zLm1heEJvdW5kcyksIXRoaXMuX2xvYWRlZClyZXR1cm4gdGhpczt2YXIgaT10aGlzLmdldFNpemUoKSxuPWUuZGl2aWRlQnkoMikucm91bmQoKSxzPWkuZGl2aWRlQnkoMikucm91bmQoKSxhPW4uc3VidHJhY3Qocyk7cmV0dXJuIGEueHx8YS55Pyh0LmFuaW1hdGUmJnQucGFuP3RoaXMucGFuQnkoYSk6KHQucGFuJiZ0aGlzLl9yYXdQYW5CeShhKSx0aGlzLmZpcmUoIm1vdmUiKSxjbGVhclRpbWVvdXQodGhpcy5fc2l6ZVRpbWVyKSx0aGlzLl9zaXplVGltZXI9c2V0VGltZW91dChvLmJpbmQodGhpcy5maXJlLHRoaXMsIm1vdmVlbmQiKSwyMDApKSx0aGlzLmZpcmUoInJlc2l6ZSIse29sZFNpemU6ZSxuZXdTaXplOml9KSk6dGhpc30sYWRkSGFuZGxlcjpmdW5jdGlvbih0LGUpe2lmKCFlKXJldHVybiB0aGlzO3ZhciBpPXRoaXNbdF09bmV3IGUodGhpcyk7cmV0dXJuIHRoaXMuX2hhbmRsZXJzLnB1c2goaSksdGhpcy5vcHRpb25zW3RdJiZpLmVuYWJsZSgpLHRoaXN9LHJlbW92ZTpmdW5jdGlvbigpe3RoaXMuX2xvYWRlZCYmdGhpcy5maXJlKCJ1bmxvYWQiKSx0aGlzLl9pbml0RXZlbnRzKCJvZmYiKTt0cnl7ZGVsZXRlIHRoaXMuX2NvbnRhaW5lci5fbGVhZmxldH1jYXRjaCh0KXt0aGlzLl9jb250YWluZXIuX2xlYWZsZXQ9aX1yZXR1cm4gdGhpcy5fY2xlYXJQYW5lcygpLHRoaXMuX2NsZWFyQ29udHJvbFBvcyYmdGhpcy5fY2xlYXJDb250cm9sUG9zKCksdGhpcy5fY2xlYXJIYW5kbGVycygpLHRoaXN9LGdldENlbnRlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jaGVja0lmTG9hZGVkKCksdGhpcy5faW5pdGlhbENlbnRlciYmIXRoaXMuX21vdmVkKCk/dGhpcy5faW5pdGlhbENlbnRlcjp0aGlzLmxheWVyUG9pbnRUb0xhdExuZyh0aGlzLl9nZXRDZW50ZXJMYXllclBvaW50KCkpfSxnZXRab29tOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3pvb219LGdldEJvdW5kczpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0UGl4ZWxCb3VuZHMoKSxlPXRoaXMudW5wcm9qZWN0KHQuZ2V0Qm90dG9tTGVmdCgpKSxpPXRoaXMudW5wcm9qZWN0KHQuZ2V0VG9wUmlnaHQoKSk7cmV0dXJuIG5ldyBvLkxhdExuZ0JvdW5kcyhlLGkpfSxnZXRNaW5ab29tOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbGF5ZXJzTWluWm9vbT09PWk/MDp0aGlzLl9sYXllcnNNaW5ab29tLGU9dGhpcy5fYm91bmRzTWluWm9vbT09PWk/MDp0aGlzLl9ib3VuZHNNaW5ab29tO3JldHVybiB0aGlzLm9wdGlvbnMubWluWm9vbT09PWk/TWF0aC5tYXgodCxlKTp0aGlzLm9wdGlvbnMubWluWm9vbX0sZ2V0TWF4Wm9vbTpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMubWF4Wm9vbT09PWk/dGhpcy5fbGF5ZXJzTWF4Wm9vbT09PWk/MS8wOnRoaXMuX2xheWVyc01heFpvb206dGhpcy5vcHRpb25zLm1heFpvb219LGdldEJvdW5kc1pvb206ZnVuY3Rpb24odCxlLGkpe3Q9by5sYXRMbmdCb3VuZHModCk7dmFyIG4scz10aGlzLmdldE1pblpvb20oKS0oZT8xOjApLGE9dGhpcy5nZXRNYXhab29tKCkscj10aGlzLmdldFNpemUoKSxoPXQuZ2V0Tm9ydGhXZXN0KCksbD10LmdldFNvdXRoRWFzdCgpLHU9ITA7aT1vLnBvaW50KGl8fFswLDBdKTtkbyBzKyssbj10aGlzLnByb2plY3QobCxzKS5zdWJ0cmFjdCh0aGlzLnByb2plY3QoaCxzKSkuYWRkKGkpLHU9ZT9uLng8ci54fHxuLnk8ci55OnIuY29udGFpbnMobik7d2hpbGUodSYmYT49cyk7cmV0dXJuIHUmJmU/bnVsbDplP3M6cy0xfSxnZXRTaXplOmZ1bmN0aW9uKCl7cmV0dXJuKCF0aGlzLl9zaXplfHx0aGlzLl9zaXplQ2hhbmdlZCkmJih0aGlzLl9zaXplPW5ldyBvLlBvaW50KHRoaXMuX2NvbnRhaW5lci5jbGllbnRXaWR0aCx0aGlzLl9jb250YWluZXIuY2xpZW50SGVpZ2h0KSx0aGlzLl9zaXplQ2hhbmdlZD0hMSksdGhpcy5fc2l6ZS5jbG9uZSgpfSxnZXRQaXhlbEJvdW5kczpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2dldFRvcExlZnRQb2ludCgpO3JldHVybiBuZXcgby5Cb3VuZHModCx0LmFkZCh0aGlzLmdldFNpemUoKSkpfSxnZXRQaXhlbE9yaWdpbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jaGVja0lmTG9hZGVkKCksdGhpcy5faW5pdGlhbFRvcExlZnRQb2ludH0sZ2V0UGFuZXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcGFuZXN9LGdldENvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jb250YWluZXJ9LGdldFpvb21TY2FsZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLm9wdGlvbnMuY3JzO3JldHVybiBlLnNjYWxlKHQpL2Uuc2NhbGUodGhpcy5fem9vbSl9LGdldFNjYWxlWm9vbTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fem9vbStNYXRoLmxvZyh0KS9NYXRoLkxOMn0scHJvamVjdDpmdW5jdGlvbih0LGUpe3JldHVybiBlPWU9PT1pP3RoaXMuX3pvb206ZSx0aGlzLm9wdGlvbnMuY3JzLmxhdExuZ1RvUG9pbnQoby5sYXRMbmcodCksZSl9LHVucHJvamVjdDpmdW5jdGlvbih0LGUpe3JldHVybiBlPWU9PT1pP3RoaXMuX3pvb206ZSx0aGlzLm9wdGlvbnMuY3JzLnBvaW50VG9MYXRMbmcoby5wb2ludCh0KSxlKX0sbGF5ZXJQb2ludFRvTGF0TG5nOmZ1bmN0aW9uKHQpe3ZhciBlPW8ucG9pbnQodCkuYWRkKHRoaXMuZ2V0UGl4ZWxPcmlnaW4oKSk7cmV0dXJuIHRoaXMudW5wcm9qZWN0KGUpfSxsYXRMbmdUb0xheWVyUG9pbnQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5wcm9qZWN0KG8ubGF0TG5nKHQpKS5fcm91bmQoKTtyZXR1cm4gZS5fc3VidHJhY3QodGhpcy5nZXRQaXhlbE9yaWdpbigpKX0sY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIG8ucG9pbnQodCkuc3VidHJhY3QodGhpcy5fZ2V0TWFwUGFuZVBvcygpKX0sbGF5ZXJQb2ludFRvQ29udGFpbmVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIG8ucG9pbnQodCkuYWRkKHRoaXMuX2dldE1hcFBhbmVQb3MoKSl9LGNvbnRhaW5lclBvaW50VG9MYXRMbmc6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5jb250YWluZXJQb2ludFRvTGF5ZXJQb2ludChvLnBvaW50KHQpKTtyZXR1cm4gdGhpcy5sYXllclBvaW50VG9MYXRMbmcoZSl9LGxhdExuZ1RvQ29udGFpbmVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMubGF5ZXJQb2ludFRvQ29udGFpbmVyUG9pbnQodGhpcy5sYXRMbmdUb0xheWVyUG9pbnQoby5sYXRMbmcodCkpKX0sbW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIG8uRG9tRXZlbnQuZ2V0TW91c2VQb3NpdGlvbih0LHRoaXMuX2NvbnRhaW5lcil9LG1vdXNlRXZlbnRUb0xheWVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQodGhpcy5tb3VzZUV2ZW50VG9Db250YWluZXJQb2ludCh0KSl9LG1vdXNlRXZlbnRUb0xhdExuZzpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5sYXllclBvaW50VG9MYXRMbmcodGhpcy5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQpKX0sX2luaXRDb250YWluZXI6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fY29udGFpbmVyPW8uRG9tVXRpbC5nZXQodCk7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJNYXAgY29udGFpbmVyIG5vdCBmb3VuZC4iKTtpZihlLl9sZWFmbGV0KXRocm93IG5ldyBFcnJvcigiTWFwIGNvbnRhaW5lciBpcyBhbHJlYWR5IGluaXRpYWxpemVkLiIpO2UuX2xlYWZsZXQ9ITB9LF9pbml0TGF5b3V0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fY29udGFpbmVyO28uRG9tVXRpbC5hZGRDbGFzcyh0LCJsZWFmbGV0LWNvbnRhaW5lciIrKG8uQnJvd3Nlci50b3VjaD8iIGxlYWZsZXQtdG91Y2giOiIiKSsoby5Ccm93c2VyLnJldGluYT8iIGxlYWZsZXQtcmV0aW5hIjoiIikrKHRoaXMub3B0aW9ucy5mYWRlQW5pbWF0aW9uPyIgbGVhZmxldC1mYWRlLWFuaW0iOiIiKSk7dmFyIGU9by5Eb21VdGlsLmdldFN0eWxlKHQsInBvc2l0aW9uIik7ImFic29sdXRlIiE9PWUmJiJyZWxhdGl2ZSIhPT1lJiYiZml4ZWQiIT09ZSYmKHQuc3R5bGUucG9zaXRpb249InJlbGF0aXZlIiksdGhpcy5faW5pdFBhbmVzKCksdGhpcy5faW5pdENvbnRyb2xQb3MmJnRoaXMuX2luaXRDb250cm9sUG9zKCl9LF9pbml0UGFuZXM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9wYW5lcz17fTt0aGlzLl9tYXBQYW5lPXQubWFwUGFuZT10aGlzLl9jcmVhdGVQYW5lKCJsZWFmbGV0LW1hcC1wYW5lIix0aGlzLl9jb250YWluZXIpLHRoaXMuX3RpbGVQYW5lPXQudGlsZVBhbmU9dGhpcy5fY3JlYXRlUGFuZSgibGVhZmxldC10aWxlLXBhbmUiLHRoaXMuX21hcFBhbmUpLHQub2JqZWN0c1BhbmU9dGhpcy5fY3JlYXRlUGFuZSgibGVhZmxldC1vYmplY3RzLXBhbmUiLHRoaXMuX21hcFBhbmUpLHQuc2hhZG93UGFuZT10aGlzLl9jcmVhdGVQYW5lKCJsZWFmbGV0LXNoYWRvdy1wYW5lIiksdC5vdmVybGF5UGFuZT10aGlzLl9jcmVhdGVQYW5lKCJsZWFmbGV0LW92ZXJsYXktcGFuZSIpLHQubWFya2VyUGFuZT10aGlzLl9jcmVhdGVQYW5lKCJsZWFmbGV0LW1hcmtlci1wYW5lIiksdC5wb3B1cFBhbmU9dGhpcy5fY3JlYXRlUGFuZSgibGVhZmxldC1wb3B1cC1wYW5lIik7dmFyIGU9IiBsZWFmbGV0LXpvb20taGlkZSI7dGhpcy5vcHRpb25zLm1hcmtlclpvb21BbmltYXRpb258fChvLkRvbVV0aWwuYWRkQ2xhc3ModC5tYXJrZXJQYW5lLGUpLG8uRG9tVXRpbC5hZGRDbGFzcyh0LnNoYWRvd1BhbmUsZSksby5Eb21VdGlsLmFkZENsYXNzKHQucG9wdXBQYW5lLGUpKX0sX2NyZWF0ZVBhbmU6ZnVuY3Rpb24odCxlKXtyZXR1cm4gby5Eb21VdGlsLmNyZWF0ZSgiZGl2Iix0LGV8fHRoaXMuX3BhbmVzLm9iamVjdHNQYW5lKX0sX2NsZWFyUGFuZXM6ZnVuY3Rpb24oKXt0aGlzLl9jb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5fbWFwUGFuZSl9LF9hZGRMYXllcnM6ZnVuY3Rpb24odCl7dD10P28uVXRpbC5pc0FycmF5KHQpP3Q6W3RdOltdO2Zvcih2YXIgZT0wLGk9dC5sZW5ndGg7aT5lO2UrKyl0aGlzLmFkZExheWVyKHRbZV0pfSxfcmVzZXRWaWV3OmZ1bmN0aW9uKHQsZSxpLG4pe3ZhciBzPXRoaXMuX3pvb20hPT1lO258fCh0aGlzLmZpcmUoIm1vdmVzdGFydCIpLHMmJnRoaXMuZmlyZSgiem9vbXN0YXJ0IikpLHRoaXMuX3pvb209ZSx0aGlzLl9pbml0aWFsQ2VudGVyPXQsdGhpcy5faW5pdGlhbFRvcExlZnRQb2ludD10aGlzLl9nZXROZXdUb3BMZWZ0UG9pbnQodCksaT90aGlzLl9pbml0aWFsVG9wTGVmdFBvaW50Ll9hZGQodGhpcy5fZ2V0TWFwUGFuZVBvcygpKTpvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fbWFwUGFuZSxuZXcgby5Qb2ludCgwLDApKSx0aGlzLl90aWxlTGF5ZXJzVG9Mb2FkPXRoaXMuX3RpbGVMYXllcnNOdW07dmFyIGE9IXRoaXMuX2xvYWRlZDt0aGlzLl9sb2FkZWQ9ITAsYSYmKHRoaXMuZmlyZSgibG9hZCIpLHRoaXMuZWFjaExheWVyKHRoaXMuX2xheWVyQWRkLHRoaXMpKSx0aGlzLmZpcmUoInZpZXdyZXNldCIse2hhcmQ6IWl9KSx0aGlzLmZpcmUoIm1vdmUiKSwoc3x8bikmJnRoaXMuZmlyZSgiem9vbWVuZCIpLHRoaXMuZmlyZSgibW92ZWVuZCIse2hhcmQ6IWl9KX0sX3Jhd1BhbkJ5OmZ1bmN0aW9uKHQpe28uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lLHRoaXMuX2dldE1hcFBhbmVQb3MoKS5zdWJ0cmFjdCh0KSl9LF9nZXRab29tU3BhbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldE1heFpvb20oKS10aGlzLmdldE1pblpvb20oKX0sX3VwZGF0ZVpvb21MZXZlbHM6ZnVuY3Rpb24oKXt2YXIgdCxlPTEvMCxuPS0xLzAsbz10aGlzLl9nZXRab29tU3BhbigpO2Zvcih0IGluIHRoaXMuX3pvb21Cb3VuZExheWVycyl7dmFyIHM9dGhpcy5fem9vbUJvdW5kTGF5ZXJzW3RdO2lzTmFOKHMub3B0aW9ucy5taW5ab29tKXx8KGU9TWF0aC5taW4oZSxzLm9wdGlvbnMubWluWm9vbSkpLGlzTmFOKHMub3B0aW9ucy5tYXhab29tKXx8KG49TWF0aC5tYXgobixzLm9wdGlvbnMubWF4Wm9vbSkpfXQ9PT1pP3RoaXMuX2xheWVyc01heFpvb209dGhpcy5fbGF5ZXJzTWluWm9vbT1pOih0aGlzLl9sYXllcnNNYXhab29tPW4sdGhpcy5fbGF5ZXJzTWluWm9vbT1lKSxvIT09dGhpcy5fZ2V0Wm9vbVNwYW4oKSYmdGhpcy5maXJlKCJ6b29tbGV2ZWxzY2hhbmdlIil9LF9wYW5JbnNpZGVNYXhCb3VuZHM6ZnVuY3Rpb24oKXt0aGlzLnBhbkluc2lkZUJvdW5kcyh0aGlzLm9wdGlvbnMubWF4Qm91bmRzKX0sX2NoZWNrSWZMb2FkZWQ6ZnVuY3Rpb24oKXtpZighdGhpcy5fbG9hZGVkKXRocm93IG5ldyBFcnJvcigiU2V0IG1hcCBjZW50ZXIgYW5kIHpvb20gZmlyc3QuIil9LF9pbml0RXZlbnRzOmZ1bmN0aW9uKGUpe2lmKG8uRG9tRXZlbnQpe2U9ZXx8Im9uIixvLkRvbUV2ZW50W2VdKHRoaXMuX2NvbnRhaW5lciwiY2xpY2siLHRoaXMuX29uTW91c2VDbGljayx0aGlzKTt2YXIgaSxuLHM9WyJkYmxjbGljayIsIm1vdXNlZG93biIsIm1vdXNldXAiLCJtb3VzZWVudGVyIiwibW91c2VsZWF2ZSIsIm1vdXNlbW92ZSIsImNvbnRleHRtZW51Il07Zm9yKGk9MCxuPXMubGVuZ3RoO24+aTtpKyspby5Eb21FdmVudFtlXSh0aGlzLl9jb250YWluZXIsc1tpXSx0aGlzLl9maXJlTW91c2VFdmVudCx0aGlzKTt0aGlzLm9wdGlvbnMudHJhY2tSZXNpemUmJm8uRG9tRXZlbnRbZV0odCwicmVzaXplIix0aGlzLl9vblJlc2l6ZSx0aGlzKX19LF9vblJlc2l6ZTpmdW5jdGlvbigpe28uVXRpbC5jYW5jZWxBbmltRnJhbWUodGhpcy5fcmVzaXplUmVxdWVzdCksdGhpcy5fcmVzaXplUmVxdWVzdD1vLlV0aWwucmVxdWVzdEFuaW1GcmFtZSh0aGlzLmludmFsaWRhdGVTaXplLHRoaXMsITEsdGhpcy5fY29udGFpbmVyKX0sX29uTW91c2VDbGljazpmdW5jdGlvbih0KXshdGhpcy5fbG9hZGVkfHwhdC5fc2ltdWxhdGVkJiYodGhpcy5kcmFnZ2luZyYmdGhpcy5kcmFnZ2luZy5tb3ZlZCgpfHx0aGlzLmJveFpvb20mJnRoaXMuYm94Wm9vbS5tb3ZlZCgpKXx8by5Eb21FdmVudC5fc2tpcHBlZCh0KXx8KHRoaXMuZmlyZSgicHJlY2xpY2siKSx0aGlzLl9maXJlTW91c2VFdmVudCh0KSl9LF9maXJlTW91c2VFdmVudDpmdW5jdGlvbih0KXtpZih0aGlzLl9sb2FkZWQmJiFvLkRvbUV2ZW50Ll9za2lwcGVkKHQpKXt2YXIgZT10LnR5cGU7aWYoZT0ibW91c2VlbnRlciI9PT1lPyJtb3VzZW92ZXIiOiJtb3VzZWxlYXZlIj09PWU/Im1vdXNlb3V0IjplLHRoaXMuaGFzRXZlbnRMaXN0ZW5lcnMoZSkpeyJjb250ZXh0bWVudSI9PT1lJiZvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KHQpO3ZhciBpPXRoaXMubW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQodCksbj10aGlzLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KGkpLHM9dGhpcy5sYXllclBvaW50VG9MYXRMbmcobik7dGhpcy5maXJlKGUse2xhdGxuZzpzLGxheWVyUG9pbnQ6bixjb250YWluZXJQb2ludDppLG9yaWdpbmFsRXZlbnQ6dH0pfX19LF9vblRpbGVMYXllckxvYWQ6ZnVuY3Rpb24oKXt0aGlzLl90aWxlTGF5ZXJzVG9Mb2FkLS0sdGhpcy5fdGlsZUxheWVyc051bSYmIXRoaXMuX3RpbGVMYXllcnNUb0xvYWQmJnRoaXMuZmlyZSgidGlsZWxheWVyc2xvYWQiKX0sX2NsZWFySGFuZGxlcnM6ZnVuY3Rpb24oKXtmb3IodmFyIHQ9MCxlPXRoaXMuX2hhbmRsZXJzLmxlbmd0aDtlPnQ7dCsrKXRoaXMuX2hhbmRsZXJzW3RdLmRpc2FibGUoKX0sd2hlblJlYWR5OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX2xvYWRlZD90LmNhbGwoZXx8dGhpcyx0aGlzKTp0aGlzLm9uKCJsb2FkIix0LGUpLHRoaXN9LF9sYXllckFkZDpmdW5jdGlvbih0KXt0Lm9uQWRkKHRoaXMpLHRoaXMuZmlyZSgibGF5ZXJhZGQiLHtsYXllcjp0fSl9LF9nZXRNYXBQYW5lUG9zOmZ1bmN0aW9uKCl7cmV0dXJuIG8uRG9tVXRpbC5nZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lKX0sX21vdmVkOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZ2V0TWFwUGFuZVBvcygpO3JldHVybiB0JiYhdC5lcXVhbHMoWzAsMF0pfSxfZ2V0VG9wTGVmdFBvaW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0UGl4ZWxPcmlnaW4oKS5zdWJ0cmFjdCh0aGlzLl9nZXRNYXBQYW5lUG9zKCkpfSxfZ2V0TmV3VG9wTGVmdFBvaW50OmZ1bmN0aW9uKHQsZSl7dmFyIGk9dGhpcy5nZXRTaXplKCkuX2RpdmlkZUJ5KDIpO3JldHVybiB0aGlzLnByb2plY3QodCxlKS5fc3VidHJhY3QoaSkuX3JvdW5kKCl9LF9sYXRMbmdUb05ld0xheWVyUG9pbnQ6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPXRoaXMuX2dldE5ld1RvcExlZnRQb2ludChpLGUpLmFkZCh0aGlzLl9nZXRNYXBQYW5lUG9zKCkpO3JldHVybiB0aGlzLnByb2plY3QodCxlKS5fc3VidHJhY3Qobil9LF9nZXRDZW50ZXJMYXllclBvaW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQodGhpcy5nZXRTaXplKCkuX2RpdmlkZUJ5KDIpKX0sX2dldENlbnRlck9mZnNldDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5sYXRMbmdUb0xheWVyUG9pbnQodCkuc3VidHJhY3QodGhpcy5fZ2V0Q2VudGVyTGF5ZXJQb2ludCgpKX0sX2xpbWl0Wm9vbTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLmdldE1pblpvb20oKSxpPXRoaXMuZ2V0TWF4Wm9vbSgpO3JldHVybiBNYXRoLm1heChlLE1hdGgubWluKGksdCkpfX0pLG8ubWFwPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLk1hcCh0LGUpfSxvLlByb2plY3Rpb24uTWVyY2F0b3I9e01BWF9MQVRJVFVERTo4NS4wODQwNTkxNTU2LFJfTUlOT1I6NjM1Njc1Mi4zMTQyNDUxNzksUl9NQUpPUjo2Mzc4MTM3LHByb2plY3Q6ZnVuY3Rpb24odCl7dmFyIGU9by5MYXRMbmcuREVHX1RPX1JBRCxpPXRoaXMuTUFYX0xBVElUVURFLG49TWF0aC5tYXgoTWF0aC5taW4oaSx0LmxhdCksLWkpLHM9dGhpcy5SX01BSk9SLGE9dGhpcy5SX01JTk9SLHI9dC5sbmcqZSpzLGg9biplLGw9YS9zLHU9TWF0aC5zcXJ0KDEtbCpsKSxjPXUqTWF0aC5zaW4oaCk7Yz1NYXRoLnBvdygoMS1jKS8oMStjKSwuNSp1KTt2YXIgZD1NYXRoLnRhbiguNSooLjUqTWF0aC5QSS1oKSkvYztyZXR1cm4gaD0tcypNYXRoLmxvZyhkKSxuZXcgby5Qb2ludChyLGgpfSx1bnByb2plY3Q6ZnVuY3Rpb24odCl7Zm9yKHZhciBlLGk9by5MYXRMbmcuUkFEX1RPX0RFRyxuPXRoaXMuUl9NQUpPUixzPXRoaXMuUl9NSU5PUixhPXQueCppL24scj1zL24saD1NYXRoLnNxcnQoMS1yKnIpLGw9TWF0aC5leHAoLXQueS9uKSx1PU1hdGguUEkvMi0yKk1hdGguYXRhbihsKSxjPTE1LGQ9MWUtNyxwPWMsbT0uMTtNYXRoLmFicyhtKT5kJiYtLXA+MDspZT1oKk1hdGguc2luKHUpLG09TWF0aC5QSS8yLTIqTWF0aC5hdGFuKGwqTWF0aC5wb3coKDEtZSkvKDErZSksLjUqaCkpLXUsdSs9bTtyZXR1cm4gbmV3IG8uTGF0TG5nKHUqaSxhKX19LG8uQ1JTLkVQU0czMzk1PW8uZXh0ZW5kKHt9LG8uQ1JTLHtjb2RlOiJFUFNHOjMzOTUiLHByb2plY3Rpb246by5Qcm9qZWN0aW9uLk1lcmNhdG9yLHRyYW5zZm9ybWF0aW9uOmZ1bmN0aW9uKCl7dmFyIHQ9by5Qcm9qZWN0aW9uLk1lcmNhdG9yLGU9dC5SX01BSk9SLGk9LjUvKE1hdGguUEkqZSk7cmV0dXJuIG5ldyBvLlRyYW5zZm9ybWF0aW9uKGksLjUsLWksLjUpfSgpfSksby5UaWxlTGF5ZXI9by5DbGFzcy5leHRlbmQoe2luY2x1ZGVzOm8uTWl4aW4uRXZlbnRzLG9wdGlvbnM6e21pblpvb206MCxtYXhab29tOjE4LHRpbGVTaXplOjI1NixzdWJkb21haW5zOiJhYmMiLGVycm9yVGlsZVVybDoiIixhdHRyaWJ1dGlvbjoiIix6b29tT2Zmc2V0OjAsb3BhY2l0eToxLHVubG9hZEludmlzaWJsZVRpbGVzOm8uQnJvd3Nlci5tb2JpbGUsdXBkYXRlV2hlbklkbGU6by5Ccm93c2VyLm1vYmlsZX0saW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUpe2U9by5zZXRPcHRpb25zKHRoaXMsZSksZS5kZXRlY3RSZXRpbmEmJm8uQnJvd3Nlci5yZXRpbmEmJmUubWF4Wm9vbT4wJiYoZS50aWxlU2l6ZT1NYXRoLmZsb29yKGUudGlsZVNpemUvMiksZS56b29tT2Zmc2V0KyssZS5taW5ab29tPjAmJmUubWluWm9vbS0tLHRoaXMub3B0aW9ucy5tYXhab29tLS0pLGUuYm91bmRzJiYoZS5ib3VuZHM9by5sYXRMbmdCb3VuZHMoZS5ib3VuZHMpKSx0aGlzLl91cmw9dDsKdmFyIGk9dGhpcy5vcHRpb25zLnN1YmRvbWFpbnM7InN0cmluZyI9PXR5cGVvZiBpJiYodGhpcy5vcHRpb25zLnN1YmRvbWFpbnM9aS5zcGxpdCgiIikpfSxvbkFkZDpmdW5jdGlvbih0KXt0aGlzLl9tYXA9dCx0aGlzLl9hbmltYXRlZD10Ll96b29tQW5pbWF0ZWQsdGhpcy5faW5pdENvbnRhaW5lcigpLHQub24oe3ZpZXdyZXNldDp0aGlzLl9yZXNldCxtb3ZlZW5kOnRoaXMuX3VwZGF0ZX0sdGhpcyksdGhpcy5fYW5pbWF0ZWQmJnQub24oe3pvb21hbmltOnRoaXMuX2FuaW1hdGVab29tLHpvb21lbmQ6dGhpcy5fZW5kWm9vbUFuaW19LHRoaXMpLHRoaXMub3B0aW9ucy51cGRhdGVXaGVuSWRsZXx8KHRoaXMuX2xpbWl0ZWRVcGRhdGU9by5VdGlsLmxpbWl0RXhlY0J5SW50ZXJ2YWwodGhpcy5fdXBkYXRlLDE1MCx0aGlzKSx0Lm9uKCJtb3ZlIix0aGlzLl9saW1pdGVkVXBkYXRlLHRoaXMpKSx0aGlzLl9yZXNldCgpLHRoaXMuX3VwZGF0ZSgpfSxhZGRUbzpmdW5jdGlvbih0KXtyZXR1cm4gdC5hZGRMYXllcih0aGlzKSx0aGlzfSxvblJlbW92ZTpmdW5jdGlvbih0KXt0aGlzLl9jb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLl9jb250YWluZXIpLHQub2ZmKHt2aWV3cmVzZXQ6dGhpcy5fcmVzZXQsbW92ZWVuZDp0aGlzLl91cGRhdGV9LHRoaXMpLHRoaXMuX2FuaW1hdGVkJiZ0Lm9mZih7em9vbWFuaW06dGhpcy5fYW5pbWF0ZVpvb20sem9vbWVuZDp0aGlzLl9lbmRab29tQW5pbX0sdGhpcyksdGhpcy5vcHRpb25zLnVwZGF0ZVdoZW5JZGxlfHx0Lm9mZigibW92ZSIsdGhpcy5fbGltaXRlZFVwZGF0ZSx0aGlzKSx0aGlzLl9jb250YWluZXI9bnVsbCx0aGlzLl9tYXA9bnVsbH0sYnJpbmdUb0Zyb250OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLl9wYW5lcy50aWxlUGFuZTtyZXR1cm4gdGhpcy5fY29udGFpbmVyJiYodC5hcHBlbmRDaGlsZCh0aGlzLl9jb250YWluZXIpLHRoaXMuX3NldEF1dG9aSW5kZXgodCxNYXRoLm1heCkpLHRoaXN9LGJyaW5nVG9CYWNrOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLl9wYW5lcy50aWxlUGFuZTtyZXR1cm4gdGhpcy5fY29udGFpbmVyJiYodC5pbnNlcnRCZWZvcmUodGhpcy5fY29udGFpbmVyLHQuZmlyc3RDaGlsZCksdGhpcy5fc2V0QXV0b1pJbmRleCh0LE1hdGgubWluKSksdGhpc30sZ2V0QXR0cmlidXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLmF0dHJpYnV0aW9ufSxnZXRDb250YWluZXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fY29udGFpbmVyfSxzZXRPcGFjaXR5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9wdGlvbnMub3BhY2l0eT10LHRoaXMuX21hcCYmdGhpcy5fdXBkYXRlT3BhY2l0eSgpLHRoaXN9LHNldFpJbmRleDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLnpJbmRleD10LHRoaXMuX3VwZGF0ZVpJbmRleCgpLHRoaXN9LHNldFVybDpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLl91cmw9dCxlfHx0aGlzLnJlZHJhdygpLHRoaXN9LHJlZHJhdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXAmJih0aGlzLl9yZXNldCh7aGFyZDohMH0pLHRoaXMuX3VwZGF0ZSgpKSx0aGlzfSxfdXBkYXRlWkluZGV4OmZ1bmN0aW9uKCl7dGhpcy5fY29udGFpbmVyJiZ0aGlzLm9wdGlvbnMuekluZGV4IT09aSYmKHRoaXMuX2NvbnRhaW5lci5zdHlsZS56SW5kZXg9dGhpcy5vcHRpb25zLnpJbmRleCl9LF9zZXRBdXRvWkluZGV4OmZ1bmN0aW9uKHQsZSl7dmFyIGksbixvLHM9dC5jaGlsZHJlbixhPS1lKDEvMCwtMS8wKTtmb3Iobj0wLG89cy5sZW5ndGg7bz5uO24rKylzW25dIT09dGhpcy5fY29udGFpbmVyJiYoaT1wYXJzZUludChzW25dLnN0eWxlLnpJbmRleCwxMCksaXNOYU4oaSl8fChhPWUoYSxpKSkpO3RoaXMub3B0aW9ucy56SW5kZXg9dGhpcy5fY29udGFpbmVyLnN0eWxlLnpJbmRleD0oaXNGaW5pdGUoYSk/YTowKStlKDEsLTEpfSxfdXBkYXRlT3BhY2l0eTpmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5fdGlsZXM7aWYoby5Ccm93c2VyLmllbHQ5KWZvcih0IGluIGUpby5Eb21VdGlsLnNldE9wYWNpdHkoZVt0XSx0aGlzLm9wdGlvbnMub3BhY2l0eSk7ZWxzZSBvLkRvbVV0aWwuc2V0T3BhY2l0eSh0aGlzLl9jb250YWluZXIsdGhpcy5vcHRpb25zLm9wYWNpdHkpfSxfaW5pdENvbnRhaW5lcjpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcC5fcGFuZXMudGlsZVBhbmU7aWYoIXRoaXMuX2NvbnRhaW5lcil7aWYodGhpcy5fY29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoImRpdiIsImxlYWZsZXQtbGF5ZXIiKSx0aGlzLl91cGRhdGVaSW5kZXgoKSx0aGlzLl9hbmltYXRlZCl7dmFyIGU9ImxlYWZsZXQtdGlsZS1jb250YWluZXIgbGVhZmxldC16b29tLWFuaW1hdGVkIjt0aGlzLl9iZ0J1ZmZlcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGUsdGhpcy5fY29udGFpbmVyKSx0aGlzLl90aWxlQ29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoImRpdiIsZSx0aGlzLl9jb250YWluZXIpfWVsc2UgdGhpcy5fdGlsZUNvbnRhaW5lcj10aGlzLl9jb250YWluZXI7dC5hcHBlbmRDaGlsZCh0aGlzLl9jb250YWluZXIpLHRoaXMub3B0aW9ucy5vcGFjaXR5PDEmJnRoaXMuX3VwZGF0ZU9wYWNpdHkoKX19LF9yZXNldDpmdW5jdGlvbih0KXtmb3IodmFyIGUgaW4gdGhpcy5fdGlsZXMpdGhpcy5maXJlKCJ0aWxldW5sb2FkIix7dGlsZTp0aGlzLl90aWxlc1tlXX0pO3RoaXMuX3RpbGVzPXt9LHRoaXMuX3RpbGVzVG9Mb2FkPTAsdGhpcy5vcHRpb25zLnJldXNlVGlsZXMmJih0aGlzLl91bnVzZWRUaWxlcz1bXSksdGhpcy5fdGlsZUNvbnRhaW5lci5pbm5lckhUTUw9IiIsdGhpcy5fYW5pbWF0ZWQmJnQmJnQuaGFyZCYmdGhpcy5fY2xlYXJCZ0J1ZmZlcigpLHRoaXMuX2luaXRDb250YWluZXIoKX0sX2dldFRpbGVTaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLGU9dC5nZXRab29tKCksaT10aGlzLm9wdGlvbnMubWF4TmF0aXZlWm9vbSxuPXRoaXMub3B0aW9ucy50aWxlU2l6ZTtyZXR1cm4gaSYmZT5pJiYobj1NYXRoLnJvdW5kKHQuZ2V0Wm9vbVNjYWxlKGUpL3QuZ2V0Wm9vbVNjYWxlKGkpKm4pKSxufSxfdXBkYXRlOmZ1bmN0aW9uKCl7aWYodGhpcy5fbWFwKXt2YXIgdD10aGlzLl9tYXAsZT10LmdldFBpeGVsQm91bmRzKCksaT10LmdldFpvb20oKSxuPXRoaXMuX2dldFRpbGVTaXplKCk7aWYoIShpPnRoaXMub3B0aW9ucy5tYXhab29tfHxpPHRoaXMub3B0aW9ucy5taW5ab29tKSl7dmFyIHM9by5ib3VuZHMoZS5taW4uZGl2aWRlQnkobikuX2Zsb29yKCksZS5tYXguZGl2aWRlQnkobikuX2Zsb29yKCkpO3RoaXMuX2FkZFRpbGVzRnJvbUNlbnRlck91dChzKSwodGhpcy5vcHRpb25zLnVubG9hZEludmlzaWJsZVRpbGVzfHx0aGlzLm9wdGlvbnMucmV1c2VUaWxlcykmJnRoaXMuX3JlbW92ZU90aGVyVGlsZXMocyl9fX0sX2FkZFRpbGVzRnJvbUNlbnRlck91dDpmdW5jdGlvbih0KXt2YXIgaSxuLHMsYT1bXSxyPXQuZ2V0Q2VudGVyKCk7Zm9yKGk9dC5taW4ueTtpPD10Lm1heC55O2krKylmb3Iobj10Lm1pbi54O248PXQubWF4Lng7bisrKXM9bmV3IG8uUG9pbnQobixpKSx0aGlzLl90aWxlU2hvdWxkQmVMb2FkZWQocykmJmEucHVzaChzKTt2YXIgaD1hLmxlbmd0aDtpZigwIT09aCl7YS5zb3J0KGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQuZGlzdGFuY2VUbyhyKS1lLmRpc3RhbmNlVG8ocil9KTt2YXIgbD1lLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtmb3IodGhpcy5fdGlsZXNUb0xvYWR8fHRoaXMuZmlyZSgibG9hZGluZyIpLHRoaXMuX3RpbGVzVG9Mb2FkKz1oLG49MDtoPm47bisrKXRoaXMuX2FkZFRpbGUoYVtuXSxsKTt0aGlzLl90aWxlQ29udGFpbmVyLmFwcGVuZENoaWxkKGwpfX0sX3RpbGVTaG91bGRCZUxvYWRlZDpmdW5jdGlvbih0KXtpZih0LngrIjoiK3QueSBpbiB0aGlzLl90aWxlcylyZXR1cm4hMTt2YXIgZT10aGlzLm9wdGlvbnM7aWYoIWUuY29udGludW91c1dvcmxkKXt2YXIgaT10aGlzLl9nZXRXcmFwVGlsZU51bSgpO2lmKGUubm9XcmFwJiYodC54PDB8fHQueD49aSl8fHQueTwwfHx0Lnk+PWkpcmV0dXJuITF9aWYoZS5ib3VuZHMpe3ZhciBuPWUudGlsZVNpemUsbz10Lm11bHRpcGx5Qnkobikscz1vLmFkZChbbixuXSksYT10aGlzLl9tYXAudW5wcm9qZWN0KG8pLHI9dGhpcy5fbWFwLnVucHJvamVjdChzKTtpZihlLmNvbnRpbnVvdXNXb3JsZHx8ZS5ub1dyYXB8fChhPWEud3JhcCgpLHI9ci53cmFwKCkpLCFlLmJvdW5kcy5pbnRlcnNlY3RzKFthLHJdKSlyZXR1cm4hMX1yZXR1cm4hMH0sX3JlbW92ZU90aGVyVGlsZXM6ZnVuY3Rpb24odCl7dmFyIGUsaSxuLG87Zm9yKG8gaW4gdGhpcy5fdGlsZXMpZT1vLnNwbGl0KCI6IiksaT1wYXJzZUludChlWzBdLDEwKSxuPXBhcnNlSW50KGVbMV0sMTApLChpPHQubWluLnh8fGk+dC5tYXgueHx8bjx0Lm1pbi55fHxuPnQubWF4LnkpJiZ0aGlzLl9yZW1vdmVUaWxlKG8pfSxfcmVtb3ZlVGlsZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl90aWxlc1t0XTt0aGlzLmZpcmUoInRpbGV1bmxvYWQiLHt0aWxlOmUsdXJsOmUuc3JjfSksdGhpcy5vcHRpb25zLnJldXNlVGlsZXM/KG8uRG9tVXRpbC5yZW1vdmVDbGFzcyhlLCJsZWFmbGV0LXRpbGUtbG9hZGVkIiksdGhpcy5fdW51c2VkVGlsZXMucHVzaChlKSk6ZS5wYXJlbnROb2RlPT09dGhpcy5fdGlsZUNvbnRhaW5lciYmdGhpcy5fdGlsZUNvbnRhaW5lci5yZW1vdmVDaGlsZChlKSxvLkJyb3dzZXIuYW5kcm9pZHx8KGUub25sb2FkPW51bGwsZS5zcmM9by5VdGlsLmVtcHR5SW1hZ2VVcmwpLGRlbGV0ZSB0aGlzLl90aWxlc1t0XX0sX2FkZFRpbGU6ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLl9nZXRUaWxlUG9zKHQpLG49dGhpcy5fZ2V0VGlsZSgpO28uRG9tVXRpbC5zZXRQb3NpdGlvbihuLGksby5Ccm93c2VyLmNocm9tZXx8by5Ccm93c2VyLmFuZHJvaWQyMyksdGhpcy5fdGlsZXNbdC54KyI6Iit0LnldPW4sdGhpcy5fbG9hZFRpbGUobix0KSxuLnBhcmVudE5vZGUhPT10aGlzLl90aWxlQ29udGFpbmVyJiZlLmFwcGVuZENoaWxkKG4pfSxfZ2V0Wm9vbUZvclVybDpmdW5jdGlvbigpe3ZhciB0PXRoaXMub3B0aW9ucyxlPXRoaXMuX21hcC5nZXRab29tKCk7cmV0dXJuIHQuem9vbVJldmVyc2UmJihlPXQubWF4Wm9vbS1lKSxlKz10Lnpvb21PZmZzZXQsdC5tYXhOYXRpdmVab29tP01hdGgubWluKGUsdC5tYXhOYXRpdmVab29tKTplfSxfZ2V0VGlsZVBvczpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAuZ2V0UGl4ZWxPcmlnaW4oKSxpPXRoaXMuX2dldFRpbGVTaXplKCk7cmV0dXJuIHQubXVsdGlwbHlCeShpKS5zdWJ0cmFjdChlKX0sZ2V0VGlsZVVybDpmdW5jdGlvbih0KXtyZXR1cm4gby5VdGlsLnRlbXBsYXRlKHRoaXMuX3VybCxvLmV4dGVuZCh7czp0aGlzLl9nZXRTdWJkb21haW4odCksejp0LnoseDp0LngseTp0Lnl9LHRoaXMub3B0aW9ucykpfSxfZ2V0V3JhcFRpbGVOdW06ZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5wb3coMix0aGlzLl9nZXRab29tRm9yVXJsKCkpfSxfYWRqdXN0VGlsZVBvaW50OmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2dldFdyYXBUaWxlTnVtKCk7dGhpcy5vcHRpb25zLmNvbnRpbnVvdXNXb3JsZHx8dGhpcy5vcHRpb25zLm5vV3JhcHx8KHQueD0odC54JWUrZSklZSksdGhpcy5vcHRpb25zLnRtcyYmKHQueT1lLXQueS0xKSx0Lno9dGhpcy5fZ2V0Wm9vbUZvclVybCgpfSxfZ2V0U3ViZG9tYWluOmZ1bmN0aW9uKHQpe3ZhciBlPU1hdGguYWJzKHQueCt0LnkpJXRoaXMub3B0aW9ucy5zdWJkb21haW5zLmxlbmd0aDtyZXR1cm4gdGhpcy5vcHRpb25zLnN1YmRvbWFpbnNbZV19LF9nZXRUaWxlOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLnJldXNlVGlsZXMmJnRoaXMuX3VudXNlZFRpbGVzLmxlbmd0aD4wKXt2YXIgdD10aGlzLl91bnVzZWRUaWxlcy5wb3AoKTtyZXR1cm4gdGhpcy5fcmVzZXRUaWxlKHQpLHR9cmV0dXJuIHRoaXMuX2NyZWF0ZVRpbGUoKX0sX3Jlc2V0VGlsZTpmdW5jdGlvbigpe30sX2NyZWF0ZVRpbGU6ZnVuY3Rpb24oKXt2YXIgdD1vLkRvbVV0aWwuY3JlYXRlKCJpbWciLCJsZWFmbGV0LXRpbGUiKTtyZXR1cm4gdC5zdHlsZS53aWR0aD10LnN0eWxlLmhlaWdodD10aGlzLl9nZXRUaWxlU2l6ZSgpKyJweCIsdC5nYWxsZXJ5aW1nPSJubyIsdC5vbnNlbGVjdHN0YXJ0PXQub25tb3VzZW1vdmU9by5VdGlsLmZhbHNlRm4sby5Ccm93c2VyLmllbHQ5JiZ0aGlzLm9wdGlvbnMub3BhY2l0eSE9PWkmJm8uRG9tVXRpbC5zZXRPcGFjaXR5KHQsdGhpcy5vcHRpb25zLm9wYWNpdHkpLHR9LF9sb2FkVGlsZTpmdW5jdGlvbih0LGUpe3QuX2xheWVyPXRoaXMsdC5vbmxvYWQ9dGhpcy5fdGlsZU9uTG9hZCx0Lm9uZXJyb3I9dGhpcy5fdGlsZU9uRXJyb3IsdGhpcy5fYWRqdXN0VGlsZVBvaW50KGUpLHQuc3JjPXRoaXMuZ2V0VGlsZVVybChlKX0sX3RpbGVMb2FkZWQ6ZnVuY3Rpb24oKXt0aGlzLl90aWxlc1RvTG9hZC0tLHRoaXMuX3RpbGVzVG9Mb2FkfHwodGhpcy5maXJlKCJsb2FkIiksdGhpcy5fYW5pbWF0ZWQmJihjbGVhclRpbWVvdXQodGhpcy5fY2xlYXJCZ0J1ZmZlclRpbWVyKSx0aGlzLl9jbGVhckJnQnVmZmVyVGltZXI9c2V0VGltZW91dChvLmJpbmQodGhpcy5fY2xlYXJCZ0J1ZmZlcix0aGlzKSw1MDApKSl9LF90aWxlT25Mb2FkOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbGF5ZXI7dGhpcy5zcmMhPT1vLlV0aWwuZW1wdHlJbWFnZVVybCYmKG8uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLCJsZWFmbGV0LXRpbGUtbG9hZGVkIiksdC5maXJlKCJ0aWxlbG9hZCIse3RpbGU6dGhpcyx1cmw6dGhpcy5zcmN9KSksdC5fdGlsZUxvYWRlZCgpfSxfdGlsZU9uRXJyb3I6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9sYXllcjt0LmZpcmUoInRpbGVlcnJvciIse3RpbGU6dGhpcyx1cmw6dGhpcy5zcmN9KTt2YXIgZT10Lm9wdGlvbnMuZXJyb3JUaWxlVXJsO2UmJih0aGlzLnNyYz1lKSx0Ll90aWxlTG9hZGVkKCl9fSksby50aWxlTGF5ZXI9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uVGlsZUxheWVyKHQsZSl9LG8uVGlsZUxheWVyLldNUz1vLlRpbGVMYXllci5leHRlbmQoe2RlZmF1bHRXbXNQYXJhbXM6e3NlcnZpY2U6IldNUyIscmVxdWVzdDoiR2V0TWFwIix2ZXJzaW9uOiIxLjEuMSIsbGF5ZXJzOiIiLHN0eWxlczoiIixmb3JtYXQ6ImltYWdlL2pwZWciLHRyYW5zcGFyZW50OiExfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7dGhpcy5fdXJsPXQ7dmFyIGk9by5leHRlbmQoe30sdGhpcy5kZWZhdWx0V21zUGFyYW1zKSxuPWUudGlsZVNpemV8fHRoaXMub3B0aW9ucy50aWxlU2l6ZTtpLndpZHRoPWkuaGVpZ2h0PWUuZGV0ZWN0UmV0aW5hJiZvLkJyb3dzZXIucmV0aW5hPzIqbjpuO2Zvcih2YXIgcyBpbiBlKXRoaXMub3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShzKXx8ImNycyI9PT1zfHwoaVtzXT1lW3NdKTt0aGlzLndtc1BhcmFtcz1pLG8uc2V0T3B0aW9ucyh0aGlzLGUpfSxvbkFkZDpmdW5jdGlvbih0KXt0aGlzLl9jcnM9dGhpcy5vcHRpb25zLmNyc3x8dC5vcHRpb25zLmNyczt2YXIgZT1wYXJzZUZsb2F0KHRoaXMud21zUGFyYW1zLnZlcnNpb24pPj0xLjM/ImNycyI6InNycyI7dGhpcy53bXNQYXJhbXNbZV09dGhpcy5fY3JzLmNvZGUsby5UaWxlTGF5ZXIucHJvdG90eXBlLm9uQWRkLmNhbGwodGhpcyx0KX0sZ2V0VGlsZVVybDpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAsaT10aGlzLm9wdGlvbnMudGlsZVNpemUsbj10Lm11bHRpcGx5QnkoaSkscz1uLmFkZChbaSxpXSksYT10aGlzLl9jcnMucHJvamVjdChlLnVucHJvamVjdChuLHQueikpLHI9dGhpcy5fY3JzLnByb2plY3QoZS51bnByb2plY3Qocyx0LnopKSxoPVthLngsci55LHIueCxhLnldLmpvaW4oIiwiKSxsPW8uVXRpbC50ZW1wbGF0ZSh0aGlzLl91cmwse3M6dGhpcy5fZ2V0U3ViZG9tYWluKHQpfSk7cmV0dXJuIGwrby5VdGlsLmdldFBhcmFtU3RyaW5nKHRoaXMud21zUGFyYW1zLGwsITApKyImQkJPWD0iK2h9LHNldFBhcmFtczpmdW5jdGlvbih0LGUpe3JldHVybiBvLmV4dGVuZCh0aGlzLndtc1BhcmFtcyx0KSxlfHx0aGlzLnJlZHJhdygpLHRoaXN9fSksby50aWxlTGF5ZXIud21zPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLlRpbGVMYXllci5XTVModCxlKX0sby5UaWxlTGF5ZXIuQ2FudmFzPW8uVGlsZUxheWVyLmV4dGVuZCh7b3B0aW9uczp7YXN5bmM6ITF9LGluaXRpYWxpemU6ZnVuY3Rpb24odCl7by5zZXRPcHRpb25zKHRoaXMsdCl9LHJlZHJhdzpmdW5jdGlvbigpe3RoaXMuX21hcCYmKHRoaXMuX3Jlc2V0KHtoYXJkOiEwfSksdGhpcy5fdXBkYXRlKCkpO2Zvcih2YXIgdCBpbiB0aGlzLl90aWxlcyl0aGlzLl9yZWRyYXdUaWxlKHRoaXMuX3RpbGVzW3RdKTtyZXR1cm4gdGhpc30sX3JlZHJhd1RpbGU6ZnVuY3Rpb24odCl7dGhpcy5kcmF3VGlsZSh0LHQuX3RpbGVQb2ludCx0aGlzLl9tYXAuX3pvb20pfSxfY3JlYXRlVGlsZTpmdW5jdGlvbigpe3ZhciB0PW8uRG9tVXRpbC5jcmVhdGUoImNhbnZhcyIsImxlYWZsZXQtdGlsZSIpO3JldHVybiB0LndpZHRoPXQuaGVpZ2h0PXRoaXMub3B0aW9ucy50aWxlU2l6ZSx0Lm9uc2VsZWN0c3RhcnQ9dC5vbm1vdXNlbW92ZT1vLlV0aWwuZmFsc2VGbix0fSxfbG9hZFRpbGU6ZnVuY3Rpb24odCxlKXt0Ll9sYXllcj10aGlzLHQuX3RpbGVQb2ludD1lLHRoaXMuX3JlZHJhd1RpbGUodCksdGhpcy5vcHRpb25zLmFzeW5jfHx0aGlzLnRpbGVEcmF3bih0KX0sZHJhd1RpbGU6ZnVuY3Rpb24oKXt9LHRpbGVEcmF3bjpmdW5jdGlvbih0KXt0aGlzLl90aWxlT25Mb2FkLmNhbGwodCl9fSksby50aWxlTGF5ZXIuY2FudmFzPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5UaWxlTGF5ZXIuQ2FudmFzKHQpfSxvLkltYWdlT3ZlcmxheT1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsb3B0aW9uczp7b3BhY2l0eToxfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSxpKXt0aGlzLl91cmw9dCx0aGlzLl9ib3VuZHM9by5sYXRMbmdCb3VuZHMoZSksby5zZXRPcHRpb25zKHRoaXMsaSl9LG9uQWRkOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10LHRoaXMuX2ltYWdlfHx0aGlzLl9pbml0SW1hZ2UoKSx0Ll9wYW5lcy5vdmVybGF5UGFuZS5hcHBlbmRDaGlsZCh0aGlzLl9pbWFnZSksdC5vbigidmlld3Jlc2V0Iix0aGlzLl9yZXNldCx0aGlzKSx0Lm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5Ccm93c2VyLmFueTNkJiZ0Lm9uKCJ6b29tYW5pbSIsdGhpcy5fYW5pbWF0ZVpvb20sdGhpcyksdGhpcy5fcmVzZXQoKX0sb25SZW1vdmU6ZnVuY3Rpb24odCl7dC5nZXRQYW5lcygpLm92ZXJsYXlQYW5lLnJlbW92ZUNoaWxkKHRoaXMuX2ltYWdlKSx0Lm9mZigidmlld3Jlc2V0Iix0aGlzLl9yZXNldCx0aGlzKSx0Lm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmdC5vZmYoInpvb21hbmltIix0aGlzLl9hbmltYXRlWm9vbSx0aGlzKX0sYWRkVG86ZnVuY3Rpb24odCl7cmV0dXJuIHQuYWRkTGF5ZXIodGhpcyksdGhpc30sc2V0T3BhY2l0eTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLm9wYWNpdHk9dCx0aGlzLl91cGRhdGVPcGFjaXR5KCksdGhpc30sYnJpbmdUb0Zyb250OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2ltYWdlJiZ0aGlzLl9tYXAuX3BhbmVzLm92ZXJsYXlQYW5lLmFwcGVuZENoaWxkKHRoaXMuX2ltYWdlKSx0aGlzfSxicmluZ1RvQmFjazpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcC5fcGFuZXMub3ZlcmxheVBhbmU7cmV0dXJuIHRoaXMuX2ltYWdlJiZ0Lmluc2VydEJlZm9yZSh0aGlzLl9pbWFnZSx0LmZpcnN0Q2hpbGQpLHRoaXN9LHNldFVybDpmdW5jdGlvbih0KXt0aGlzLl91cmw9dCx0aGlzLl9pbWFnZS5zcmM9dGhpcy5fdXJsfSxnZXRBdHRyaWJ1dGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMuYXR0cmlidXRpb259LF9pbml0SW1hZ2U6ZnVuY3Rpb24oKXt0aGlzLl9pbWFnZT1vLkRvbVV0aWwuY3JlYXRlKCJpbWciLCJsZWFmbGV0LWltYWdlLWxheWVyIiksdGhpcy5fbWFwLm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5Ccm93c2VyLmFueTNkP28uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9pbWFnZSwibGVhZmxldC16b29tLWFuaW1hdGVkIik6by5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2ltYWdlLCJsZWFmbGV0LXpvb20taGlkZSIpLHRoaXMuX3VwZGF0ZU9wYWNpdHkoKSxvLmV4dGVuZCh0aGlzLl9pbWFnZSx7Z2FsbGVyeWltZzoibm8iLG9uc2VsZWN0c3RhcnQ6by5VdGlsLmZhbHNlRm4sb25tb3VzZW1vdmU6by5VdGlsLmZhbHNlRm4sb25sb2FkOm8uYmluZCh0aGlzLl9vbkltYWdlTG9hZCx0aGlzKSxzcmM6dGhpcy5fdXJsfSl9LF9hbmltYXRlWm9vbTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAsaT10aGlzLl9pbWFnZSxuPWUuZ2V0Wm9vbVNjYWxlKHQuem9vbSkscz10aGlzLl9ib3VuZHMuZ2V0Tm9ydGhXZXN0KCksYT10aGlzLl9ib3VuZHMuZ2V0U291dGhFYXN0KCkscj1lLl9sYXRMbmdUb05ld0xheWVyUG9pbnQocyx0Lnpvb20sdC5jZW50ZXIpLGg9ZS5fbGF0TG5nVG9OZXdMYXllclBvaW50KGEsdC56b29tLHQuY2VudGVyKS5fc3VidHJhY3QociksbD1yLl9hZGQoaC5fbXVsdGlwbHlCeSguNSooMS0xL24pKSk7aS5zdHlsZVtvLkRvbVV0aWwuVFJBTlNGT1JNXT1vLkRvbVV0aWwuZ2V0VHJhbnNsYXRlU3RyaW5nKGwpKyIgc2NhbGUoIituKyIpICJ9LF9yZXNldDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2ltYWdlLGU9dGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9ib3VuZHMuZ2V0Tm9ydGhXZXN0KCkpLGk9dGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9ib3VuZHMuZ2V0U291dGhFYXN0KCkpLl9zdWJ0cmFjdChlKTtvLkRvbVV0aWwuc2V0UG9zaXRpb24odCxlKSx0LnN0eWxlLndpZHRoPWkueCsicHgiLHQuc3R5bGUuaGVpZ2h0PWkueSsicHgifSxfb25JbWFnZUxvYWQ6ZnVuY3Rpb24oKXt0aGlzLmZpcmUoImxvYWQiKX0sX3VwZGF0ZU9wYWNpdHk6ZnVuY3Rpb24oKXtvLkRvbVV0aWwuc2V0T3BhY2l0eSh0aGlzLl9pbWFnZSx0aGlzLm9wdGlvbnMub3BhY2l0eSl9fSksby5pbWFnZU92ZXJsYXk9ZnVuY3Rpb24odCxlLGkpe3JldHVybiBuZXcgby5JbWFnZU92ZXJsYXkodCxlLGkpfSxvLkljb249by5DbGFzcy5leHRlbmQoe29wdGlvbnM6e2NsYXNzTmFtZToiIn0saW5pdGlhbGl6ZTpmdW5jdGlvbih0KXtvLnNldE9wdGlvbnModGhpcyx0KX0sY3JlYXRlSWNvbjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fY3JlYXRlSWNvbigiaWNvbiIsdCl9LGNyZWF0ZVNoYWRvdzpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fY3JlYXRlSWNvbigic2hhZG93Iix0KX0sX2NyZWF0ZUljb246ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLl9nZXRJY29uVXJsKHQpO2lmKCFpKXtpZigiaWNvbiI9PT10KXRocm93IG5ldyBFcnJvcigiaWNvblVybCBub3Qgc2V0IGluIEljb24gb3B0aW9ucyAoc2VlIHRoZSBkb2NzKS4iKTtyZXR1cm4gbnVsbH12YXIgbjtyZXR1cm4gbj1lJiYiSU1HIj09PWUudGFnTmFtZT90aGlzLl9jcmVhdGVJbWcoaSxlKTp0aGlzLl9jcmVhdGVJbWcoaSksdGhpcy5fc2V0SWNvblN0eWxlcyhuLHQpLG59LF9zZXRJY29uU3R5bGVzOmZ1bmN0aW9uKHQsZSl7dmFyIGksbj10aGlzLm9wdGlvbnMscz1vLnBvaW50KG5bZSsiU2l6ZSJdKTtpPSJzaGFkb3ciPT09ZT9vLnBvaW50KG4uc2hhZG93QW5jaG9yfHxuLmljb25BbmNob3IpOm8ucG9pbnQobi5pY29uQW5jaG9yKSwhaSYmcyYmKGk9cy5kaXZpZGVCeSgyLCEwKSksdC5jbGFzc05hbWU9ImxlYWZsZXQtbWFya2VyLSIrZSsiICIrbi5jbGFzc05hbWUsaSYmKHQuc3R5bGUubWFyZ2luTGVmdD0taS54KyJweCIsdC5zdHlsZS5tYXJnaW5Ub3A9LWkueSsicHgiKSxzJiYodC5zdHlsZS53aWR0aD1zLngrInB4Iix0LnN0eWxlLmhlaWdodD1zLnkrInB4Iil9LF9jcmVhdGVJbWc6ZnVuY3Rpb24odCxpKXtyZXR1cm4gby5Ccm93c2VyLmllNj8oaXx8KGk9ZS5jcmVhdGVFbGVtZW50KCJkaXYiKSksaS5zdHlsZS5maWx0ZXI9J3Byb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5BbHBoYUltYWdlTG9hZGVyKHNyYz0iJyt0KyciKScpOihpfHwoaT1lLmNyZWF0ZUVsZW1lbnQoImltZyIpKSxpLnNyYz10KSxpfSxfZ2V0SWNvblVybDpmdW5jdGlvbih0KXtyZXR1cm4gby5Ccm93c2VyLnJldGluYSYmdGhpcy5vcHRpb25zW3QrIlJldGluYVVybCJdP3RoaXMub3B0aW9uc1t0KyJSZXRpbmFVcmwiXTp0aGlzLm9wdGlvbnNbdCsiVXJsIl19fSksby5pY29uPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5JY29uKHQpfSxvLkljb24uRGVmYXVsdD1vLkljb24uZXh0ZW5kKHtvcHRpb25zOntpY29uU2l6ZTpbMjUsNDFdLGljb25BbmNob3I6WzEyLDQxXSxwb3B1cEFuY2hvcjpbMSwtMzRdLHNoYWRvd1NpemU6WzQxLDQxXX0sX2dldEljb25Vcmw6ZnVuY3Rpb24odCl7dmFyIGU9dCsiVXJsIjtpZih0aGlzLm9wdGlvbnNbZV0pcmV0dXJuIHRoaXMub3B0aW9uc1tlXTtvLkJyb3dzZXIucmV0aW5hJiYiaWNvbiI9PT10JiYodCs9Ii0yeCIpO3ZhciBpPW8uSWNvbi5EZWZhdWx0LmltYWdlUGF0aDtpZighaSl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGF1dG9kZXRlY3QgTC5JY29uLkRlZmF1bHQuaW1hZ2VQYXRoLCBzZXQgaXQgbWFudWFsbHkuIik7cmV0dXJuIGkrIi9tYXJrZXItIit0KyIucG5nIn19KSxvLkljb24uRGVmYXVsdC5pbWFnZVBhdGg9ZnVuY3Rpb24oKXt2YXIgdCxpLG4sbyxzLGE9ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0Iikscj0vW1wvXl1sZWFmbGV0W1wtXC5fXT8oW1x3XC1cLl9dKilcLmpzXD8/Lztmb3IodD0wLGk9YS5sZW5ndGg7aT50O3QrKylpZihuPWFbdF0uc3JjLG89bi5tYXRjaChyKSlyZXR1cm4gcz1uLnNwbGl0KHIpWzBdLChzP3MrIi8iOiIiKSsiaW1hZ2VzIn0oKSxvLk1hcmtlcj1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsb3B0aW9uczp7aWNvbjpuZXcgby5JY29uLkRlZmF1bHQsdGl0bGU6IiIsY2xpY2thYmxlOiEwLGRyYWdnYWJsZTohMSxrZXlib2FyZDohMCx6SW5kZXhPZmZzZXQ6MCxvcGFjaXR5OjEscmlzZU9uSG92ZXI6ITEscmlzZU9mZnNldDoyNTB9LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlKXtvLnNldE9wdGlvbnModGhpcyxlKSx0aGlzLl9sYXRsbmc9by5sYXRMbmcodCl9LG9uQWRkOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10LHQub24oInZpZXdyZXNldCIsdGhpcy51cGRhdGUsdGhpcyksdGhpcy5faW5pdEljb24oKSx0aGlzLnVwZGF0ZSgpLHRoaXMuZmlyZSgiYWRkIiksdC5vcHRpb25zLnpvb21BbmltYXRpb24mJnQub3B0aW9ucy5tYXJrZXJab29tQW5pbWF0aW9uJiZ0Lm9uKCJ6b29tYW5pbSIsdGhpcy5fYW5pbWF0ZVpvb20sdGhpcyl9LGFkZFRvOmZ1bmN0aW9uKHQpe3JldHVybiB0LmFkZExheWVyKHRoaXMpLHRoaXN9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3RoaXMuZHJhZ2dpbmcmJnRoaXMuZHJhZ2dpbmcuZGlzYWJsZSgpLHRoaXMuX3JlbW92ZUljb24oKSx0aGlzLl9yZW1vdmVTaGFkb3coKSx0aGlzLmZpcmUoInJlbW92ZSIpLHQub2ZmKHt2aWV3cmVzZXQ6dGhpcy51cGRhdGUsem9vbWFuaW06dGhpcy5fYW5pbWF0ZVpvb219LHRoaXMpLHRoaXMuX21hcD1udWxsfSxnZXRMYXRMbmc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbGF0bG5nfSxzZXRMYXRMbmc6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZz1vLmxhdExuZyh0KSx0aGlzLnVwZGF0ZSgpLHRoaXMuZmlyZSgibW92ZSIse2xhdGxuZzp0aGlzLl9sYXRsbmd9KX0sc2V0WkluZGV4T2Zmc2V0OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9wdGlvbnMuekluZGV4T2Zmc2V0PXQsdGhpcy51cGRhdGUoKSx0aGlzfSxzZXRJY29uOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9wdGlvbnMuaWNvbj10LHRoaXMuX21hcCYmKHRoaXMuX2luaXRJY29uKCksdGhpcy51cGRhdGUoKSksdGhpcy5fcG9wdXAmJnRoaXMuYmluZFBvcHVwKHRoaXMuX3BvcHVwKSx0aGlzfSx1cGRhdGU6ZnVuY3Rpb24oKXtpZih0aGlzLl9pY29uKXt2YXIgdD10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2xhdGxuZykucm91bmQoKTt0aGlzLl9zZXRQb3ModCl9cmV0dXJuIHRoaXN9LF9pbml0SWNvbjpmdW5jdGlvbigpe3ZhciB0PXRoaXMub3B0aW9ucyxlPXRoaXMuX21hcCxpPWUub3B0aW9ucy56b29tQW5pbWF0aW9uJiZlLm9wdGlvbnMubWFya2VyWm9vbUFuaW1hdGlvbixuPWk/ImxlYWZsZXQtem9vbS1hbmltYXRlZCI6ImxlYWZsZXQtem9vbS1oaWRlIixzPXQuaWNvbi5jcmVhdGVJY29uKHRoaXMuX2ljb24pLGE9ITE7cyE9PXRoaXMuX2ljb24mJih0aGlzLl9pY29uJiZ0aGlzLl9yZW1vdmVJY29uKCksYT0hMCx0LnRpdGxlJiYocy50aXRsZT10LnRpdGxlKSksby5Eb21VdGlsLmFkZENsYXNzKHMsbiksdC5rZXlib2FyZCYmKHMudGFiSW5kZXg9IjAiKSx0aGlzLl9pY29uPXMsdGhpcy5faW5pdEludGVyYWN0aW9uKCksdC5yaXNlT25Ib3ZlciYmby5Eb21FdmVudC5vbihzLCJtb3VzZW92ZXIiLHRoaXMuX2JyaW5nVG9Gcm9udCx0aGlzKS5vbihzLCJtb3VzZW91dCIsdGhpcy5fcmVzZXRaSW5kZXgsdGhpcyk7dmFyIHI9dC5pY29uLmNyZWF0ZVNoYWRvdyh0aGlzLl9zaGFkb3cpLGg9ITE7ciE9PXRoaXMuX3NoYWRvdyYmKHRoaXMuX3JlbW92ZVNoYWRvdygpLGg9ITApLHImJm8uRG9tVXRpbC5hZGRDbGFzcyhyLG4pLHRoaXMuX3NoYWRvdz1yLHQub3BhY2l0eTwxJiZ0aGlzLl91cGRhdGVPcGFjaXR5KCk7dmFyIGw9dGhpcy5fbWFwLl9wYW5lczthJiZsLm1hcmtlclBhbmUuYXBwZW5kQ2hpbGQodGhpcy5faWNvbiksciYmaCYmbC5zaGFkb3dQYW5lLmFwcGVuZENoaWxkKHRoaXMuX3NoYWRvdyl9LF9yZW1vdmVJY29uOmZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLnJpc2VPbkhvdmVyJiZvLkRvbUV2ZW50Lm9mZih0aGlzLl9pY29uLCJtb3VzZW92ZXIiLHRoaXMuX2JyaW5nVG9Gcm9udCkub2ZmKHRoaXMuX2ljb24sIm1vdXNlb3V0Iix0aGlzLl9yZXNldFpJbmRleCksdGhpcy5fbWFwLl9wYW5lcy5tYXJrZXJQYW5lLnJlbW92ZUNoaWxkKHRoaXMuX2ljb24pLHRoaXMuX2ljb249bnVsbH0sX3JlbW92ZVNoYWRvdzpmdW5jdGlvbigpe3RoaXMuX3NoYWRvdyYmdGhpcy5fbWFwLl9wYW5lcy5zaGFkb3dQYW5lLnJlbW92ZUNoaWxkKHRoaXMuX3NoYWRvdyksdGhpcy5fc2hhZG93PW51bGx9LF9zZXRQb3M6ZnVuY3Rpb24odCl7by5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX2ljb24sdCksdGhpcy5fc2hhZG93JiZvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fc2hhZG93LHQpLHRoaXMuX3pJbmRleD10LnkrdGhpcy5vcHRpb25zLnpJbmRleE9mZnNldCx0aGlzLl9yZXNldFpJbmRleCgpfSxfdXBkYXRlWkluZGV4OmZ1bmN0aW9uKHQpe3RoaXMuX2ljb24uc3R5bGUuekluZGV4PXRoaXMuX3pJbmRleCt0fSxfYW5pbWF0ZVpvb206ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fbWFwLl9sYXRMbmdUb05ld0xheWVyUG9pbnQodGhpcy5fbGF0bG5nLHQuem9vbSx0LmNlbnRlcik7dGhpcy5fc2V0UG9zKGUpfSxfaW5pdEludGVyYWN0aW9uOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmNsaWNrYWJsZSl7dmFyIHQ9dGhpcy5faWNvbixlPVsiZGJsY2xpY2siLCJtb3VzZWRvd24iLCJtb3VzZW92ZXIiLCJtb3VzZW91dCIsImNvbnRleHRtZW51Il07by5Eb21VdGlsLmFkZENsYXNzKHQsImxlYWZsZXQtY2xpY2thYmxlIiksby5Eb21FdmVudC5vbih0LCJjbGljayIsdGhpcy5fb25Nb3VzZUNsaWNrLHRoaXMpLG8uRG9tRXZlbnQub24odCwia2V5cHJlc3MiLHRoaXMuX29uS2V5UHJlc3MsdGhpcyk7Zm9yKHZhciBpPTA7aTxlLmxlbmd0aDtpKyspby5Eb21FdmVudC5vbih0LGVbaV0sdGhpcy5fZmlyZU1vdXNlRXZlbnQsdGhpcyk7by5IYW5kbGVyLk1hcmtlckRyYWcmJih0aGlzLmRyYWdnaW5nPW5ldyBvLkhhbmRsZXIuTWFya2VyRHJhZyh0aGlzKSx0aGlzLm9wdGlvbnMuZHJhZ2dhYmxlJiZ0aGlzLmRyYWdnaW5nLmVuYWJsZSgpKX19LF9vbk1vdXNlQ2xpY2s6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5kcmFnZ2luZyYmdGhpcy5kcmFnZ2luZy5tb3ZlZCgpOyh0aGlzLmhhc0V2ZW50TGlzdGVuZXJzKHQudHlwZSl8fGUpJiZvLkRvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbih0KSxlfHwodGhpcy5kcmFnZ2luZyYmdGhpcy5kcmFnZ2luZy5fZW5hYmxlZHx8IXRoaXMuX21hcC5kcmFnZ2luZ3x8IXRoaXMuX21hcC5kcmFnZ2luZy5tb3ZlZCgpKSYmdGhpcy5maXJlKHQudHlwZSx7b3JpZ2luYWxFdmVudDp0LGxhdGxuZzp0aGlzLl9sYXRsbmd9KX0sX29uS2V5UHJlc3M6ZnVuY3Rpb24odCl7MTM9PT10LmtleUNvZGUmJnRoaXMuZmlyZSgiY2xpY2siLHtvcmlnaW5hbEV2ZW50OnQsbGF0bG5nOnRoaXMuX2xhdGxuZ30pfSxfZmlyZU1vdXNlRXZlbnQ6ZnVuY3Rpb24odCl7dGhpcy5maXJlKHQudHlwZSx7b3JpZ2luYWxFdmVudDp0LGxhdGxuZzp0aGlzLl9sYXRsbmd9KSwiY29udGV4dG1lbnUiPT09dC50eXBlJiZ0aGlzLmhhc0V2ZW50TGlzdGVuZXJzKHQudHlwZSkmJm8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCksIm1vdXNlZG93biIhPT10LnR5cGU/by5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24odCk6by5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCh0KX0sc2V0T3BhY2l0eTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLm9wYWNpdHk9dCx0aGlzLl9tYXAmJnRoaXMuX3VwZGF0ZU9wYWNpdHkoKSx0aGlzfSxfdXBkYXRlT3BhY2l0eTpmdW5jdGlvbigpe28uRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2ljb24sdGhpcy5vcHRpb25zLm9wYWNpdHkpLHRoaXMuX3NoYWRvdyYmby5Eb21VdGlsLnNldE9wYWNpdHkodGhpcy5fc2hhZG93LHRoaXMub3B0aW9ucy5vcGFjaXR5KX0sX2JyaW5nVG9Gcm9udDpmdW5jdGlvbigpe3RoaXMuX3VwZGF0ZVpJbmRleCh0aGlzLm9wdGlvbnMucmlzZU9mZnNldCl9LF9yZXNldFpJbmRleDpmdW5jdGlvbigpe3RoaXMuX3VwZGF0ZVpJbmRleCgwKX19KSxvLm1hcmtlcj1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5NYXJrZXIodCxlKX0sby5EaXZJY29uPW8uSWNvbi5leHRlbmQoe29wdGlvbnM6e2ljb25TaXplOlsxMiwxMl0sY2xhc3NOYW1lOiJsZWFmbGV0LWRpdi1pY29uIixodG1sOiExfSxjcmVhdGVJY29uOmZ1bmN0aW9uKHQpe3ZhciBpPXQmJiJESVYiPT09dC50YWdOYW1lP3Q6ZS5jcmVhdGVFbGVtZW50KCJkaXYiKSxuPXRoaXMub3B0aW9ucztyZXR1cm4gaS5pbm5lckhUTUw9bi5odG1sIT09ITE/bi5odG1sOiIiLG4uYmdQb3MmJihpLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbj0tbi5iZ1Bvcy54KyJweCAiKy1uLmJnUG9zLnkrInB4IiksdGhpcy5fc2V0SWNvblN0eWxlcyhpLCJpY29uIiksaX0sY3JlYXRlU2hhZG93OmZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9fSksby5kaXZJY29uPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5EaXZJY29uKHQpfSxvLk1hcC5tZXJnZU9wdGlvbnMoe2Nsb3NlUG9wdXBPbkNsaWNrOiEwfSksby5Qb3B1cD1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsb3B0aW9uczp7bWluV2lkdGg6NTAsbWF4V2lkdGg6MzAwLGF1dG9QYW46ITAsY2xvc2VCdXR0b246ITAsb2Zmc2V0OlswLDddLGF1dG9QYW5QYWRkaW5nOls1LDVdLGtlZXBJblZpZXc6ITEsY2xhc3NOYW1lOiIiLHpvb21BbmltYXRpb246ITB9LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlKXtvLnNldE9wdGlvbnModGhpcyx0KSx0aGlzLl9zb3VyY2U9ZSx0aGlzLl9hbmltYXRlZD1vLkJyb3dzZXIuYW55M2QmJnRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uLHRoaXMuX2lzT3Blbj0hMX0sb25BZGQ6ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXQsdGhpcy5fY29udGFpbmVyfHx0aGlzLl9pbml0TGF5b3V0KCksdGhpcy5fdXBkYXRlQ29udGVudCgpO3ZhciBlPXQub3B0aW9ucy5mYWRlQW5pbWF0aW9uO2UmJm8uRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2NvbnRhaW5lciwwKSx0Ll9wYW5lcy5wb3B1cFBhbmUuYXBwZW5kQ2hpbGQodGhpcy5fY29udGFpbmVyKSx0Lm9uKHRoaXMuX2dldEV2ZW50cygpLHRoaXMpLHRoaXMudXBkYXRlKCksZSYmby5Eb21VdGlsLnNldE9wYWNpdHkodGhpcy5fY29udGFpbmVyLDEpLHRoaXMuZmlyZSgib3BlbiIpLHQuZmlyZSgicG9wdXBvcGVuIix7cG9wdXA6dGhpc30pLHRoaXMuX3NvdXJjZSYmdGhpcy5fc291cmNlLmZpcmUoInBvcHVwb3BlbiIse3BvcHVwOnRoaXN9KX0sYWRkVG86ZnVuY3Rpb24odCl7cmV0dXJuIHQuYWRkTGF5ZXIodGhpcyksdGhpc30sb3Blbk9uOmZ1bmN0aW9uKHQpe3JldHVybiB0Lm9wZW5Qb3B1cCh0aGlzKSx0aGlzfSxvblJlbW92ZTpmdW5jdGlvbih0KXt0Ll9wYW5lcy5wb3B1cFBhbmUucmVtb3ZlQ2hpbGQodGhpcy5fY29udGFpbmVyKSxvLlV0aWwuZmFsc2VGbih0aGlzLl9jb250YWluZXIub2Zmc2V0V2lkdGgpLHQub2ZmKHRoaXMuX2dldEV2ZW50cygpLHRoaXMpLHQub3B0aW9ucy5mYWRlQW5pbWF0aW9uJiZvLkRvbVV0aWwuc2V0T3BhY2l0eSh0aGlzLl9jb250YWluZXIsMCksdGhpcy5fbWFwPW51bGwsdGhpcy5maXJlKCJjbG9zZSIpLHQuZmlyZSgicG9wdXBjbG9zZSIse3BvcHVwOnRoaXN9KSx0aGlzLl9zb3VyY2UmJnRoaXMuX3NvdXJjZS5maXJlKCJwb3B1cGNsb3NlIix7cG9wdXA6dGhpc30pfSxzZXRMYXRMbmc6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZz1vLmxhdExuZyh0KSx0aGlzLnVwZGF0ZSgpLHRoaXN9LHNldENvbnRlbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2NvbnRlbnQ9dCx0aGlzLnVwZGF0ZSgpLHRoaXN9LHVwZGF0ZTpmdW5jdGlvbigpe3RoaXMuX21hcCYmKHRoaXMuX2NvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5PSJoaWRkZW4iLHRoaXMuX3VwZGF0ZUNvbnRlbnQoKSx0aGlzLl91cGRhdGVMYXlvdXQoKSx0aGlzLl91cGRhdGVQb3NpdGlvbigpLHRoaXMuX2NvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5PSIiLHRoaXMuX2FkanVzdFBhbigpKX0sX2dldEV2ZW50czpmdW5jdGlvbigpe3ZhciB0PXt2aWV3cmVzZXQ6dGhpcy5fdXBkYXRlUG9zaXRpb259O3JldHVybiB0aGlzLl9hbmltYXRlZCYmKHQuem9vbWFuaW09dGhpcy5fem9vbUFuaW1hdGlvbiksKCJjbG9zZU9uQ2xpY2siaW4gdGhpcy5vcHRpb25zP3RoaXMub3B0aW9ucy5jbG9zZU9uQ2xpY2s6dGhpcy5fbWFwLm9wdGlvbnMuY2xvc2VQb3B1cE9uQ2xpY2spJiYodC5wcmVjbGljaz10aGlzLl9jbG9zZSksdGhpcy5vcHRpb25zLmtlZXBJblZpZXcmJih0Lm1vdmVlbmQ9dGhpcy5fYWRqdXN0UGFuKSx0fSxfY2xvc2U6ZnVuY3Rpb24oKXt0aGlzLl9tYXAmJnRoaXMuX21hcC5jbG9zZVBvcHVwKHRoaXMpfSxfaW5pdExheW91dDpmdW5jdGlvbigpe3ZhciB0LGU9ImxlYWZsZXQtcG9wdXAiLGk9ZSsiICIrdGhpcy5vcHRpb25zLmNsYXNzTmFtZSsiIGxlYWZsZXQtem9vbS0iKyh0aGlzLl9hbmltYXRlZD8iYW5pbWF0ZWQiOiJoaWRlIiksbj10aGlzLl9jb250YWluZXI9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixpKTt0aGlzLm9wdGlvbnMuY2xvc2VCdXR0b24mJih0PXRoaXMuX2Nsb3NlQnV0dG9uPW8uRG9tVXRpbC5jcmVhdGUoImEiLGUrIi1jbG9zZS1idXR0b24iLG4pLHQuaHJlZj0iI2Nsb3NlIix0LmlubmVySFRNTD0iJiMyMTU7IixvLkRvbUV2ZW50LmRpc2FibGVDbGlja1Byb3BhZ2F0aW9uKHQpLG8uRG9tRXZlbnQub24odCwiY2xpY2siLHRoaXMuX29uQ2xvc2VCdXR0b25DbGljayx0aGlzKSk7dmFyIHM9dGhpcy5fd3JhcHBlcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGUrIi1jb250ZW50LXdyYXBwZXIiLG4pO28uRG9tRXZlbnQuZGlzYWJsZUNsaWNrUHJvcGFnYXRpb24ocyksdGhpcy5fY29udGVudE5vZGU9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKyItY29udGVudCIscyksby5Eb21FdmVudC5vbih0aGlzLl9jb250ZW50Tm9kZSwibW91c2V3aGVlbCIsby5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pLG8uRG9tRXZlbnQub24odGhpcy5fY29udGVudE5vZGUsIk1vek1vdXNlUGl4ZWxTY3JvbGwiLG8uRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKSxvLkRvbUV2ZW50Lm9uKHMsImNvbnRleHRtZW51IixvLkRvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbiksdGhpcy5fdGlwQ29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoImRpdiIsZSsiLXRpcC1jb250YWluZXIiLG4pLHRoaXMuX3RpcD1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGUrIi10aXAiLHRoaXMuX3RpcENvbnRhaW5lcil9LF91cGRhdGVDb250ZW50OmZ1bmN0aW9uKCl7aWYodGhpcy5fY29udGVudCl7aWYoInN0cmluZyI9PXR5cGVvZiB0aGlzLl9jb250ZW50KXRoaXMuX2NvbnRlbnROb2RlLmlubmVySFRNTD10aGlzLl9jb250ZW50O2Vsc2V7Zm9yKDt0aGlzLl9jb250ZW50Tm9kZS5oYXNDaGlsZE5vZGVzKCk7KXRoaXMuX2NvbnRlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRlbnROb2RlLmZpcnN0Q2hpbGQpO3RoaXMuX2NvbnRlbnROb2RlLmFwcGVuZENoaWxkKHRoaXMuX2NvbnRlbnQpfXRoaXMuZmlyZSgiY29udGVudHVwZGF0ZSIpfX0sX3VwZGF0ZUxheW91dDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2NvbnRlbnROb2RlLGU9dC5zdHlsZTtlLndpZHRoPSIiLGUud2hpdGVTcGFjZT0ibm93cmFwIjt2YXIgaT10Lm9mZnNldFdpZHRoO2k9TWF0aC5taW4oaSx0aGlzLm9wdGlvbnMubWF4V2lkdGgpLGk9TWF0aC5tYXgoaSx0aGlzLm9wdGlvbnMubWluV2lkdGgpLGUud2lkdGg9aSsxKyJweCIsZS53aGl0ZVNwYWNlPSIiLGUuaGVpZ2h0PSIiO3ZhciBuPXQub2Zmc2V0SGVpZ2h0LHM9dGhpcy5vcHRpb25zLm1heEhlaWdodCxhPSJsZWFmbGV0LXBvcHVwLXNjcm9sbGVkIjtzJiZuPnM/KGUuaGVpZ2h0PXMrInB4IixvLkRvbVV0aWwuYWRkQ2xhc3ModCxhKSk6by5Eb21VdGlsLnJlbW92ZUNsYXNzKHQsYSksdGhpcy5fY29udGFpbmVyV2lkdGg9dGhpcy5fY29udGFpbmVyLm9mZnNldFdpZHRofSxfdXBkYXRlUG9zaXRpb246ZnVuY3Rpb24oKXtpZih0aGlzLl9tYXApe3ZhciB0PXRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5fbGF0bG5nKSxlPXRoaXMuX2FuaW1hdGVkLGk9by5wb2ludCh0aGlzLm9wdGlvbnMub2Zmc2V0KTtlJiZvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fY29udGFpbmVyLHQpLHRoaXMuX2NvbnRhaW5lckJvdHRvbT0taS55LShlPzA6dC55KSx0aGlzLl9jb250YWluZXJMZWZ0PS1NYXRoLnJvdW5kKHRoaXMuX2NvbnRhaW5lcldpZHRoLzIpK2kueCsoZT8wOnQueCksdGhpcy5fY29udGFpbmVyLnN0eWxlLmJvdHRvbT10aGlzLl9jb250YWluZXJCb3R0b20rInB4Iix0aGlzLl9jb250YWluZXIuc3R5bGUubGVmdD10aGlzLl9jb250YWluZXJMZWZ0KyJweCJ9fSxfem9vbUFuaW1hdGlvbjpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAuX2xhdExuZ1RvTmV3TGF5ZXJQb2ludCh0aGlzLl9sYXRsbmcsdC56b29tLHQuY2VudGVyKTtvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fY29udGFpbmVyLGUpfSxfYWRqdXN0UGFuOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmF1dG9QYW4pe3ZhciB0PXRoaXMuX21hcCxlPXRoaXMuX2NvbnRhaW5lci5vZmZzZXRIZWlnaHQsaT10aGlzLl9jb250YWluZXJXaWR0aCxuPW5ldyBvLlBvaW50KHRoaXMuX2NvbnRhaW5lckxlZnQsLWUtdGhpcy5fY29udGFpbmVyQm90dG9tKTt0aGlzLl9hbmltYXRlZCYmbi5fYWRkKG8uRG9tVXRpbC5nZXRQb3NpdGlvbih0aGlzLl9jb250YWluZXIpKTt2YXIgcz10LmxheWVyUG9pbnRUb0NvbnRhaW5lclBvaW50KG4pLGE9by5wb2ludCh0aGlzLm9wdGlvbnMuYXV0b1BhblBhZGRpbmcpLHI9by5wb2ludCh0aGlzLm9wdGlvbnMuYXV0b1BhblBhZGRpbmdUb3BMZWZ0fHxhKSxoPW8ucG9pbnQodGhpcy5vcHRpb25zLmF1dG9QYW5QYWRkaW5nQm90dG9tUmlnaHR8fGEpLGw9dC5nZXRTaXplKCksdT0wLGM9MDtzLngraStoLng+bC54JiYodT1zLngraS1sLngraC54KSxzLngtdS1yLng8MCYmKHU9cy54LXIueCkscy55K2UraC55PmwueSYmKGM9cy55K2UtbC55K2gueSkscy55LWMtci55PDAmJihjPXMueS1yLnkpLCh1fHxjKSYmdC5maXJlKCJhdXRvcGFuc3RhcnQiKS5wYW5CeShbdSxjXSl9fSxfb25DbG9zZUJ1dHRvbkNsaWNrOmZ1bmN0aW9uKHQpe3RoaXMuX2Nsb3NlKCksby5Eb21FdmVudC5zdG9wKHQpfX0pLG8ucG9wdXA9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uUG9wdXAodCxlKX0sby5NYXAuaW5jbHVkZSh7b3BlblBvcHVwOmZ1bmN0aW9uKHQsZSxpKXtpZih0aGlzLmNsb3NlUG9wdXAoKSwhKHQgaW5zdGFuY2VvZiBvLlBvcHVwKSl7dmFyIG49dDt0PW5ldyBvLlBvcHVwKGkpLnNldExhdExuZyhlKS5zZXRDb250ZW50KG4pfXJldHVybiB0Ll9pc09wZW49ITAsdGhpcy5fcG9wdXA9dCx0aGlzLmFkZExheWVyKHQpfSxjbG9zZVBvcHVwOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0IT09dGhpcy5fcG9wdXB8fCh0PXRoaXMuX3BvcHVwLHRoaXMuX3BvcHVwPW51bGwpLHQmJih0aGlzLnJlbW92ZUxheWVyKHQpLHQuX2lzT3Blbj0hMSksdGhpc319KSxvLk1hcmtlci5pbmNsdWRlKHtvcGVuUG9wdXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcG9wdXAmJnRoaXMuX21hcCYmIXRoaXMuX21hcC5oYXNMYXllcih0aGlzLl9wb3B1cCkmJih0aGlzLl9wb3B1cC5zZXRMYXRMbmcodGhpcy5fbGF0bG5nKSx0aGlzLl9tYXAub3BlblBvcHVwKHRoaXMuX3BvcHVwKSksdGhpc30sY2xvc2VQb3B1cDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wb3B1cCYmdGhpcy5fcG9wdXAuX2Nsb3NlKCksdGhpc30sdG9nZ2xlUG9wdXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcG9wdXAmJih0aGlzLl9wb3B1cC5faXNPcGVuP3RoaXMuY2xvc2VQb3B1cCgpOnRoaXMub3BlblBvcHVwKCkpLHRoaXN9LGJpbmRQb3B1cDpmdW5jdGlvbih0LGUpe3ZhciBpPW8ucG9pbnQodGhpcy5vcHRpb25zLmljb24ub3B0aW9ucy5wb3B1cEFuY2hvcnx8WzAsMF0pO3JldHVybiBpPWkuYWRkKG8uUG9wdXAucHJvdG90eXBlLm9wdGlvbnMub2Zmc2V0KSxlJiZlLm9mZnNldCYmKGk9aS5hZGQoZS5vZmZzZXQpKSxlPW8uZXh0ZW5kKHtvZmZzZXQ6aX0sZSksdGhpcy5fcG9wdXBIYW5kbGVyc0FkZGVkfHwodGhpcy5vbigiY2xpY2siLHRoaXMudG9nZ2xlUG9wdXAsdGhpcykub24oInJlbW92ZSIsdGhpcy5jbG9zZVBvcHVwLHRoaXMpLm9uKCJtb3ZlIix0aGlzLl9tb3ZlUG9wdXAsdGhpcyksdGhpcy5fcG9wdXBIYW5kbGVyc0FkZGVkPSEwKSx0IGluc3RhbmNlb2Ygby5Qb3B1cD8oby5zZXRPcHRpb25zKHQsZSksdGhpcy5fcG9wdXA9dCk6dGhpcy5fcG9wdXA9bmV3IG8uUG9wdXAoZSx0aGlzKS5zZXRDb250ZW50KHQpLHRoaXN9LHNldFBvcHVwQ29udGVudDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fcG9wdXAmJnRoaXMuX3BvcHVwLnNldENvbnRlbnQodCksdGhpc30sdW5iaW5kUG9wdXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcG9wdXAmJih0aGlzLl9wb3B1cD1udWxsLHRoaXMub2ZmKCJjbGljayIsdGhpcy50b2dnbGVQb3B1cCx0aGlzKS5vZmYoInJlbW92ZSIsdGhpcy5jbG9zZVBvcHVwLHRoaXMpLm9mZigibW92ZSIsdGhpcy5fbW92ZVBvcHVwLHRoaXMpLHRoaXMuX3BvcHVwSGFuZGxlcnNBZGRlZD0hMSksdGhpc30sX21vdmVQb3B1cDpmdW5jdGlvbih0KXt0aGlzLl9wb3B1cC5zZXRMYXRMbmcodC5sYXRsbmcpfX0pLG8uTGF5ZXJHcm91cD1vLkNsYXNzLmV4dGVuZCh7aW5pdGlhbGl6ZTpmdW5jdGlvbih0KXt0aGlzLl9sYXllcnM9e307dmFyIGUsaTtpZih0KWZvcihlPTAsaT10Lmxlbmd0aDtpPmU7ZSsrKXRoaXMuYWRkTGF5ZXIodFtlXSl9LGFkZExheWVyOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuZ2V0TGF5ZXJJZCh0KTtyZXR1cm4gdGhpcy5fbGF5ZXJzW2VdPXQsdGhpcy5fbWFwJiZ0aGlzLl9tYXAuYWRkTGF5ZXIodCksdGhpc30scmVtb3ZlTGF5ZXI6ZnVuY3Rpb24odCl7dmFyIGU9dCBpbiB0aGlzLl9sYXllcnM/dDp0aGlzLmdldExheWVySWQodCk7cmV0dXJuIHRoaXMuX21hcCYmdGhpcy5fbGF5ZXJzW2VdJiZ0aGlzLl9tYXAucmVtb3ZlTGF5ZXIodGhpcy5fbGF5ZXJzW2VdKSxkZWxldGUgdGhpcy5fbGF5ZXJzW2VdLHRoaXN9LGhhc0xheWVyOmZ1bmN0aW9uKHQpe3JldHVybiB0P3QgaW4gdGhpcy5fbGF5ZXJzfHx0aGlzLmdldExheWVySWQodClpbiB0aGlzLl9sYXllcnM6ITF9LGNsZWFyTGF5ZXJzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaExheWVyKHRoaXMucmVtb3ZlTGF5ZXIsdGhpcyksdGhpc30saW52b2tlOmZ1bmN0aW9uKHQpe3ZhciBlLGksbj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKGUgaW4gdGhpcy5fbGF5ZXJzKWk9dGhpcy5fbGF5ZXJzW2VdLGlbdF0mJmlbdF0uYXBwbHkoaSxuKTtyZXR1cm4gdGhpc30sb25BZGQ6ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXQsdGhpcy5lYWNoTGF5ZXIodC5hZGRMYXllcix0KX0sb25SZW1vdmU6ZnVuY3Rpb24odCl7dGhpcy5lYWNoTGF5ZXIodC5yZW1vdmVMYXllcix0KSx0aGlzLl9tYXA9bnVsbH0sYWRkVG86ZnVuY3Rpb24odCl7cmV0dXJuIHQuYWRkTGF5ZXIodGhpcyksdGhpc30sZWFjaExheWVyOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBpIGluIHRoaXMuX2xheWVycyl0LmNhbGwoZSx0aGlzLl9sYXllcnNbaV0pO3JldHVybiB0aGlzfSxnZXRMYXllcjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fbGF5ZXJzW3RdfSxnZXRMYXllcnM6ZnVuY3Rpb24oKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gdGhpcy5fbGF5ZXJzKXQucHVzaCh0aGlzLl9sYXllcnNbZV0pO3JldHVybiB0fSxzZXRaSW5kZXg6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuaW52b2tlKCJzZXRaSW5kZXgiLHQpfSxnZXRMYXllcklkOmZ1bmN0aW9uKHQpe3JldHVybiBvLnN0YW1wKHQpfX0pLG8ubGF5ZXJHcm91cD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uTGF5ZXJHcm91cCh0KX0sby5GZWF0dXJlR3JvdXA9by5MYXllckdyb3VwLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsc3RhdGljczp7RVZFTlRTOiJjbGljayBkYmxjbGljayBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2Vtb3ZlIGNvbnRleHRtZW51IHBvcHVwb3BlbiBwb3B1cGNsb3NlIn0sYWRkTGF5ZXI6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuaGFzTGF5ZXIodCk/dGhpczooIm9uImluIHQmJnQub24oby5GZWF0dXJlR3JvdXAuRVZFTlRTLHRoaXMuX3Byb3BhZ2F0ZUV2ZW50LHRoaXMpLG8uTGF5ZXJHcm91cC5wcm90b3R5cGUuYWRkTGF5ZXIuY2FsbCh0aGlzLHQpLHRoaXMuX3BvcHVwQ29udGVudCYmdC5iaW5kUG9wdXAmJnQuYmluZFBvcHVwKHRoaXMuX3BvcHVwQ29udGVudCx0aGlzLl9wb3B1cE9wdGlvbnMpLHRoaXMuZmlyZSgibGF5ZXJhZGQiLHtsYXllcjp0fSkpfSxyZW1vdmVMYXllcjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5oYXNMYXllcih0KT8odCBpbiB0aGlzLl9sYXllcnMmJih0PXRoaXMuX2xheWVyc1t0XSksdC5vZmYoby5GZWF0dXJlR3JvdXAuRVZFTlRTLHRoaXMuX3Byb3BhZ2F0ZUV2ZW50LHRoaXMpLG8uTGF5ZXJHcm91cC5wcm90b3R5cGUucmVtb3ZlTGF5ZXIuY2FsbCh0aGlzLHQpLHRoaXMuX3BvcHVwQ29udGVudCYmdGhpcy5pbnZva2UoInVuYmluZFBvcHVwIiksdGhpcy5maXJlKCJsYXllcnJlbW92ZSIse2xheWVyOnR9KSk6dGhpc30sYmluZFBvcHVwOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX3BvcHVwQ29udGVudD10LHRoaXMuX3BvcHVwT3B0aW9ucz1lLHRoaXMuaW52b2tlKCJiaW5kUG9wdXAiLHQsZSl9LHNldFN0eWxlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmludm9rZSgic2V0U3R5bGUiLHQpfSxicmluZ1RvRnJvbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pbnZva2UoImJyaW5nVG9Gcm9udCIpfSxicmluZ1RvQmFjazpmdW5jdGlvbigpe3JldHVybiB0aGlzLmludm9rZSgiYnJpbmdUb0JhY2siKX0sZ2V0Qm91bmRzOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IG8uTGF0TG5nQm91bmRzO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbihlKXt0LmV4dGVuZChlIGluc3RhbmNlb2Ygby5NYXJrZXI/ZS5nZXRMYXRMbmcoKTplLmdldEJvdW5kcygpKX0pLHR9LF9wcm9wYWdhdGVFdmVudDpmdW5jdGlvbih0KXt0LmxheWVyfHwodC5sYXllcj10LnRhcmdldCksdC50YXJnZXQ9dGhpcyx0aGlzLmZpcmUodC50eXBlLHQpfX0pLG8uZmVhdHVyZUdyb3VwPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5GZWF0dXJlR3JvdXAodCl9LG8uUGF0aD1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6W28uTWl4aW4uRXZlbnRzXSxzdGF0aWNzOntDTElQX1BBRERJTkc6ZnVuY3Rpb24oKXt2YXIgZT1vLkJyb3dzZXIubW9iaWxlPzEyODA6MmUzLGk9KGUvTWF0aC5tYXgodC5vdXRlcldpZHRoLHQub3V0ZXJIZWlnaHQpLTEpLzI7cmV0dXJuIE1hdGgubWF4KDAsTWF0aC5taW4oLjUsaSkpfSgpfSxvcHRpb25zOntzdHJva2U6ITAsY29sb3I6IiMwMDMzZmYiLGRhc2hBcnJheTpudWxsLGxpbmVDYXA6bnVsbCxsaW5lSm9pbjpudWxsLHdlaWdodDo1LG9wYWNpdHk6LjUsZmlsbDohMSxmaWxsQ29sb3I6bnVsbCxmaWxsT3BhY2l0eTouMixjbGlja2FibGU6ITB9LGluaXRpYWxpemU6ZnVuY3Rpb24odCl7by5zZXRPcHRpb25zKHRoaXMsdCl9LG9uQWRkOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10LHRoaXMuX2NvbnRhaW5lcnx8KHRoaXMuX2luaXRFbGVtZW50cygpLHRoaXMuX2luaXRFdmVudHMoKSksdGhpcy5wcm9qZWN0TGF0bG5ncygpLHRoaXMuX3VwZGF0ZVBhdGgoKSx0aGlzLl9jb250YWluZXImJnRoaXMuX21hcC5fcGF0aFJvb3QuYXBwZW5kQ2hpbGQodGhpcy5fY29udGFpbmVyKSx0aGlzLmZpcmUoImFkZCIpLHQub24oe3ZpZXdyZXNldDp0aGlzLnByb2plY3RMYXRsbmdzLG1vdmVlbmQ6dGhpcy5fdXBkYXRlUGF0aH0sdGhpcyl9LGFkZFRvOmZ1bmN0aW9uKHQpe3JldHVybiB0LmFkZExheWVyKHRoaXMpLHRoaXN9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3QuX3BhdGhSb290LnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRhaW5lciksdGhpcy5maXJlKCJyZW1vdmUiKSx0aGlzLl9tYXA9bnVsbCxvLkJyb3dzZXIudm1sJiYodGhpcy5fY29udGFpbmVyPW51bGwsdGhpcy5fc3Ryb2tlPW51bGwsdGhpcy5fZmlsbD1udWxsKSx0Lm9mZih7dmlld3Jlc2V0OnRoaXMucHJvamVjdExhdGxuZ3MsbW92ZWVuZDp0aGlzLl91cGRhdGVQYXRofSx0aGlzKX0scHJvamVjdExhdGxuZ3M6ZnVuY3Rpb24oKXt9LHNldFN0eWxlOmZ1bmN0aW9uKHQpe3JldHVybiBvLnNldE9wdGlvbnModGhpcyx0KSx0aGlzLl9jb250YWluZXImJnRoaXMuX3VwZGF0ZVN0eWxlKCksdGhpc30scmVkcmF3OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX21hcCYmKHRoaXMucHJvamVjdExhdGxuZ3MoKSx0aGlzLl91cGRhdGVQYXRoKCkpLHRoaXN9fSksby5NYXAuaW5jbHVkZSh7X3VwZGF0ZVBhdGhWaWV3cG9ydDpmdW5jdGlvbigpe3ZhciB0PW8uUGF0aC5DTElQX1BBRERJTkcsZT10aGlzLmdldFNpemUoKSxpPW8uRG9tVXRpbC5nZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lKSxuPWkubXVsdGlwbHlCeSgtMSkuX3N1YnRyYWN0KGUubXVsdGlwbHlCeSh0KS5fcm91bmQoKSkscz1uLmFkZChlLm11bHRpcGx5QnkoMSsyKnQpLl9yb3VuZCgpKTt0aGlzLl9wYXRoVmlld3BvcnQ9bmV3IG8uQm91bmRzKG4scyl9fSksby5QYXRoLlNWR19OUz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLG8uQnJvd3Nlci5zdmc9ISghZS5jcmVhdGVFbGVtZW50TlN8fCFlLmNyZWF0ZUVsZW1lbnROUyhvLlBhdGguU1ZHX05TLCJzdmciKS5jcmVhdGVTVkdSZWN0KSxvLlBhdGg9by5QYXRoLmV4dGVuZCh7c3RhdGljczp7U1ZHOm8uQnJvd3Nlci5zdmd9LGJyaW5nVG9Gcm9udDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcC5fcGF0aFJvb3QsZT10aGlzLl9jb250YWluZXI7cmV0dXJuIGUmJnQubGFzdENoaWxkIT09ZSYmdC5hcHBlbmRDaGlsZChlKSx0aGlzfSxicmluZ1RvQmFjazpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcC5fcGF0aFJvb3QsZT10aGlzLl9jb250YWluZXIsaT10LmZpcnN0Q2hpbGQ7cmV0dXJuIGUmJmkhPT1lJiZ0Lmluc2VydEJlZm9yZShlLGkpLHRoaXN9LGdldFBhdGhTdHJpbmc6ZnVuY3Rpb24oKXt9LF9jcmVhdGVFbGVtZW50OmZ1bmN0aW9uKHQpe3JldHVybiBlLmNyZWF0ZUVsZW1lbnROUyhvLlBhdGguU1ZHX05TLHQpfSxfaW5pdEVsZW1lbnRzOmZ1bmN0aW9uKCl7dGhpcy5fbWFwLl9pbml0UGF0aFJvb3QoKSx0aGlzLl9pbml0UGF0aCgpLHRoaXMuX2luaXRTdHlsZSgpfSxfaW5pdFBhdGg6ZnVuY3Rpb24oKXt0aGlzLl9jb250YWluZXI9dGhpcy5fY3JlYXRlRWxlbWVudCgiZyIpLHRoaXMuX3BhdGg9dGhpcy5fY3JlYXRlRWxlbWVudCgicGF0aCIpLHRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9wYXRoKX0sX2luaXRTdHlsZTpmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5zdHJva2UmJih0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgic3Ryb2tlLWxpbmVqb2luIiwicm91bmQiKSx0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgic3Ryb2tlLWxpbmVjYXAiLCJyb3VuZCIpKSx0aGlzLm9wdGlvbnMuZmlsbCYmdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImZpbGwtcnVsZSIsImV2ZW5vZGQiKSx0aGlzLm9wdGlvbnMucG9pbnRlckV2ZW50cyYmdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoInBvaW50ZXItZXZlbnRzIix0aGlzLm9wdGlvbnMucG9pbnRlckV2ZW50cyksdGhpcy5vcHRpb25zLmNsaWNrYWJsZXx8dGhpcy5vcHRpb25zLnBvaW50ZXJFdmVudHN8fHRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCJwb2ludGVyLWV2ZW50cyIsIm5vbmUiKSx0aGlzLl91cGRhdGVTdHlsZSgpfSxfdXBkYXRlU3R5bGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuc3Ryb2tlPyh0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgic3Ryb2tlIix0aGlzLm9wdGlvbnMuY29sb3IpLHRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCJzdHJva2Utb3BhY2l0eSIsdGhpcy5vcHRpb25zLm9wYWNpdHkpLHRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCJzdHJva2Utd2lkdGgiLHRoaXMub3B0aW9ucy53ZWlnaHQpLHRoaXMub3B0aW9ucy5kYXNoQXJyYXk/dGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoInN0cm9rZS1kYXNoYXJyYXkiLHRoaXMub3B0aW9ucy5kYXNoQXJyYXkpOnRoaXMuX3BhdGgucmVtb3ZlQXR0cmlidXRlKCJzdHJva2UtZGFzaGFycmF5IiksdGhpcy5vcHRpb25zLmxpbmVDYXAmJnRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCJzdHJva2UtbGluZWNhcCIsdGhpcy5vcHRpb25zLmxpbmVDYXApLHRoaXMub3B0aW9ucy5saW5lSm9pbiYmdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoInN0cm9rZS1saW5lam9pbiIsdGhpcy5vcHRpb25zLmxpbmVKb2luKSk6dGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsIm5vbmUiKSx0aGlzLm9wdGlvbnMuZmlsbD8odGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImZpbGwiLHRoaXMub3B0aW9ucy5maWxsQ29sb3J8fHRoaXMub3B0aW9ucy5jb2xvciksdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImZpbGwtb3BhY2l0eSIsdGhpcy5vcHRpb25zLmZpbGxPcGFjaXR5KSk6dGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImZpbGwiLCJub25lIil9LF91cGRhdGVQYXRoOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRQYXRoU3RyaW5nKCk7dHx8KHQ9Ik0wIDAiKSx0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgiZCIsdCl9LF9pbml0RXZlbnRzOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmNsaWNrYWJsZSl7KG8uQnJvd3Nlci5zdmd8fCFvLkJyb3dzZXIudm1sKSYmdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwibGVhZmxldC1jbGlja2FibGUiKSxvLkRvbUV2ZW50Lm9uKHRoaXMuX2NvbnRhaW5lciwiY2xpY2siLHRoaXMuX29uTW91c2VDbGljayx0aGlzKTtmb3IodmFyIHQ9WyJkYmxjbGljayIsIm1vdXNlZG93biIsIm1vdXNlb3ZlciIsIm1vdXNlb3V0IiwibW91c2Vtb3ZlIiwiY29udGV4dG1lbnUiXSxlPTA7ZTx0Lmxlbmd0aDtlKyspby5Eb21FdmVudC5vbih0aGlzLl9jb250YWluZXIsdFtlXSx0aGlzLl9maXJlTW91c2VFdmVudCx0aGlzKX19LF9vbk1vdXNlQ2xpY2s6ZnVuY3Rpb24odCl7dGhpcy5fbWFwLmRyYWdnaW5nJiZ0aGlzLl9tYXAuZHJhZ2dpbmcubW92ZWQoKXx8dGhpcy5fZmlyZU1vdXNlRXZlbnQodCl9LF9maXJlTW91c2VFdmVudDpmdW5jdGlvbih0KXtpZih0aGlzLmhhc0V2ZW50TGlzdGVuZXJzKHQudHlwZSkpe3ZhciBlPXRoaXMuX21hcCxpPWUubW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQodCksbj1lLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KGkpLHM9ZS5sYXllclBvaW50VG9MYXRMbmcobik7dGhpcy5maXJlKHQudHlwZSx7bGF0bG5nOnMsbGF5ZXJQb2ludDpuLGNvbnRhaW5lclBvaW50Omksb3JpZ2luYWxFdmVudDp0fSksImNvbnRleHRtZW51Ij09PXQudHlwZSYmby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCh0KSwibW91c2Vtb3ZlIiE9PXQudHlwZSYmby5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24odCl9fX0pLG8uTWFwLmluY2x1ZGUoe19pbml0UGF0aFJvb3Q6ZnVuY3Rpb24oKXt0aGlzLl9wYXRoUm9vdHx8KHRoaXMuX3BhdGhSb290PW8uUGF0aC5wcm90b3R5cGUuX2NyZWF0ZUVsZW1lbnQoInN2ZyIpLHRoaXMuX3BhbmVzLm92ZXJsYXlQYW5lLmFwcGVuZENoaWxkKHRoaXMuX3BhdGhSb290KSx0aGlzLm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5Ccm93c2VyLmFueTNkPyh0aGlzLl9wYXRoUm9vdC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwiIGxlYWZsZXQtem9vbS1hbmltYXRlZCIpLHRoaXMub24oe3pvb21hbmltOnRoaXMuX2FuaW1hdGVQYXRoWm9vbSx6b29tZW5kOnRoaXMuX2VuZFBhdGhab29tfSkpOnRoaXMuX3BhdGhSb290LnNldEF0dHJpYnV0ZSgiY2xhc3MiLCIgbGVhZmxldC16b29tLWhpZGUiKSx0aGlzLm9uKCJtb3ZlZW5kIix0aGlzLl91cGRhdGVTdmdWaWV3cG9ydCksdGhpcy5fdXBkYXRlU3ZnVmlld3BvcnQoKSl9LF9hbmltYXRlUGF0aFpvb206ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5nZXRab29tU2NhbGUodC56b29tKSxpPXRoaXMuX2dldENlbnRlck9mZnNldCh0LmNlbnRlcikuX211bHRpcGx5QnkoLWUpLl9hZGQodGhpcy5fcGF0aFZpZXdwb3J0Lm1pbik7dGhpcy5fcGF0aFJvb3Quc3R5bGVbby5Eb21VdGlsLlRSQU5TRk9STV09by5Eb21VdGlsLmdldFRyYW5zbGF0ZVN0cmluZyhpKSsiIHNjYWxlKCIrZSsiKSAiLHRoaXMuX3BhdGhab29taW5nPSEwfSxfZW5kUGF0aFpvb206ZnVuY3Rpb24oKXt0aGlzLl9wYXRoWm9vbWluZz0hMX0sX3VwZGF0ZVN2Z1ZpZXdwb3J0OmZ1bmN0aW9uKCl7aWYoIXRoaXMuX3BhdGhab29taW5nKXt0aGlzLl91cGRhdGVQYXRoVmlld3BvcnQoKTt2YXIgdD10aGlzLl9wYXRoVmlld3BvcnQsZT10Lm1pbixpPXQubWF4LG49aS54LWUueCxzPWkueS1lLnksYT10aGlzLl9wYXRoUm9vdCxyPXRoaXMuX3BhbmVzLm92ZXJsYXlQYW5lO28uQnJvd3Nlci5tb2JpbGVXZWJraXQmJnIucmVtb3ZlQ2hpbGQoYSksby5Eb21VdGlsLnNldFBvc2l0aW9uKGEsZSksYS5zZXRBdHRyaWJ1dGUoIndpZHRoIixuKSxhLnNldEF0dHJpYnV0ZSgiaGVpZ2h0IixzKSxhLnNldEF0dHJpYnV0ZSgidmlld0JveCIsW2UueCxlLnksbixzXS5qb2luKCIgIikpLG8uQnJvd3Nlci5tb2JpbGVXZWJraXQmJnIuYXBwZW5kQ2hpbGQoYSl9fX0pLG8uUGF0aC5pbmNsdWRlKHtiaW5kUG9wdXA6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdCBpbnN0YW5jZW9mIG8uUG9wdXA/dGhpcy5fcG9wdXA9dDooKCF0aGlzLl9wb3B1cHx8ZSkmJih0aGlzLl9wb3B1cD1uZXcgby5Qb3B1cChlLHRoaXMpKSx0aGlzLl9wb3B1cC5zZXRDb250ZW50KHQpKSx0aGlzLl9wb3B1cEhhbmRsZXJzQWRkZWR8fCh0aGlzLm9uKCJjbGljayIsdGhpcy5fb3BlblBvcHVwLHRoaXMpLm9uKCJyZW1vdmUiLHRoaXMuY2xvc2VQb3B1cCx0aGlzKSx0aGlzLl9wb3B1cEhhbmRsZXJzQWRkZWQ9ITApLHRoaXMKfSx1bmJpbmRQb3B1cDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wb3B1cCYmKHRoaXMuX3BvcHVwPW51bGwsdGhpcy5vZmYoImNsaWNrIix0aGlzLl9vcGVuUG9wdXApLm9mZigicmVtb3ZlIix0aGlzLmNsb3NlUG9wdXApLHRoaXMuX3BvcHVwSGFuZGxlcnNBZGRlZD0hMSksdGhpc30sb3BlblBvcHVwOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9wb3B1cCYmKHQ9dHx8dGhpcy5fbGF0bG5nfHx0aGlzLl9sYXRsbmdzW01hdGguZmxvb3IodGhpcy5fbGF0bG5ncy5sZW5ndGgvMildLHRoaXMuX29wZW5Qb3B1cCh7bGF0bG5nOnR9KSksdGhpc30sY2xvc2VQb3B1cDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wb3B1cCYmdGhpcy5fcG9wdXAuX2Nsb3NlKCksdGhpc30sX29wZW5Qb3B1cDpmdW5jdGlvbih0KXt0aGlzLl9wb3B1cC5zZXRMYXRMbmcodC5sYXRsbmcpLHRoaXMuX21hcC5vcGVuUG9wdXAodGhpcy5fcG9wdXApfX0pLG8uQnJvd3Nlci52bWw9IW8uQnJvd3Nlci5zdmcmJmZ1bmN0aW9uKCl7dHJ5e3ZhciB0PWUuY3JlYXRlRWxlbWVudCgiZGl2Iik7dC5pbm5lckhUTUw9Jzx2OnNoYXBlIGFkaj0iMSIvPic7dmFyIGk9dC5maXJzdENoaWxkO3JldHVybiBpLnN0eWxlLmJlaGF2aW9yPSJ1cmwoI2RlZmF1bHQjVk1MKSIsaSYmIm9iamVjdCI9PXR5cGVvZiBpLmFkan1jYXRjaChuKXtyZXR1cm4hMX19KCksby5QYXRoPW8uQnJvd3Nlci5zdmd8fCFvLkJyb3dzZXIudm1sP28uUGF0aDpvLlBhdGguZXh0ZW5kKHtzdGF0aWNzOntWTUw6ITAsQ0xJUF9QQURESU5HOi4wMn0sX2NyZWF0ZUVsZW1lbnQ6ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIGUubmFtZXNwYWNlcy5hZGQoImx2bWwiLCJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOnZtbCIpLGZ1bmN0aW9uKHQpe3JldHVybiBlLmNyZWF0ZUVsZW1lbnQoIjxsdm1sOiIrdCsnIGNsYXNzPSJsdm1sIj4nKX19Y2F0Y2godCl7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBlLmNyZWF0ZUVsZW1lbnQoIjwiK3QrJyB4bWxucz0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LmNvbTp2bWwiIGNsYXNzPSJsdm1sIj4nKX19fSgpLF9pbml0UGF0aDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2NvbnRhaW5lcj10aGlzLl9jcmVhdGVFbGVtZW50KCJzaGFwZSIpO28uRG9tVXRpbC5hZGRDbGFzcyh0LCJsZWFmbGV0LXZtbC1zaGFwZSIpLHRoaXMub3B0aW9ucy5jbGlja2FibGUmJm8uRG9tVXRpbC5hZGRDbGFzcyh0LCJsZWFmbGV0LWNsaWNrYWJsZSIpLHQuY29vcmRzaXplPSIxIDEiLHRoaXMuX3BhdGg9dGhpcy5fY3JlYXRlRWxlbWVudCgicGF0aCIpLHQuYXBwZW5kQ2hpbGQodGhpcy5fcGF0aCksdGhpcy5fbWFwLl9wYXRoUm9vdC5hcHBlbmRDaGlsZCh0KX0sX2luaXRTdHlsZTpmdW5jdGlvbigpe3RoaXMuX3VwZGF0ZVN0eWxlKCl9LF91cGRhdGVTdHlsZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3N0cm9rZSxlPXRoaXMuX2ZpbGwsaT10aGlzLm9wdGlvbnMsbj10aGlzLl9jb250YWluZXI7bi5zdHJva2VkPWkuc3Ryb2tlLG4uZmlsbGVkPWkuZmlsbCxpLnN0cm9rZT8odHx8KHQ9dGhpcy5fc3Ryb2tlPXRoaXMuX2NyZWF0ZUVsZW1lbnQoInN0cm9rZSIpLHQuZW5kY2FwPSJyb3VuZCIsbi5hcHBlbmRDaGlsZCh0KSksdC53ZWlnaHQ9aS53ZWlnaHQrInB4Iix0LmNvbG9yPWkuY29sb3IsdC5vcGFjaXR5PWkub3BhY2l0eSx0LmRhc2hTdHlsZT1pLmRhc2hBcnJheT9vLlV0aWwuaXNBcnJheShpLmRhc2hBcnJheSk/aS5kYXNoQXJyYXkuam9pbigiICIpOmkuZGFzaEFycmF5LnJlcGxhY2UoLyggKiwgKikvZywiICIpOiIiLGkubGluZUNhcCYmKHQuZW5kY2FwPWkubGluZUNhcC5yZXBsYWNlKCJidXR0IiwiZmxhdCIpKSxpLmxpbmVKb2luJiYodC5qb2luc3R5bGU9aS5saW5lSm9pbikpOnQmJihuLnJlbW92ZUNoaWxkKHQpLHRoaXMuX3N0cm9rZT1udWxsKSxpLmZpbGw/KGV8fChlPXRoaXMuX2ZpbGw9dGhpcy5fY3JlYXRlRWxlbWVudCgiZmlsbCIpLG4uYXBwZW5kQ2hpbGQoZSkpLGUuY29sb3I9aS5maWxsQ29sb3J8fGkuY29sb3IsZS5vcGFjaXR5PWkuZmlsbE9wYWNpdHkpOmUmJihuLnJlbW92ZUNoaWxkKGUpLHRoaXMuX2ZpbGw9bnVsbCl9LF91cGRhdGVQYXRoOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fY29udGFpbmVyLnN0eWxlO3QuZGlzcGxheT0ibm9uZSIsdGhpcy5fcGF0aC52PXRoaXMuZ2V0UGF0aFN0cmluZygpKyIgIix0LmRpc3BsYXk9IiJ9fSksby5NYXAuaW5jbHVkZShvLkJyb3dzZXIuc3ZnfHwhby5Ccm93c2VyLnZtbD97fTp7X2luaXRQYXRoUm9vdDpmdW5jdGlvbigpe2lmKCF0aGlzLl9wYXRoUm9vdCl7dmFyIHQ9dGhpcy5fcGF0aFJvb3Q9ZS5jcmVhdGVFbGVtZW50KCJkaXYiKTt0LmNsYXNzTmFtZT0ibGVhZmxldC12bWwtY29udGFpbmVyIix0aGlzLl9wYW5lcy5vdmVybGF5UGFuZS5hcHBlbmRDaGlsZCh0KSx0aGlzLm9uKCJtb3ZlZW5kIix0aGlzLl91cGRhdGVQYXRoVmlld3BvcnQpLHRoaXMuX3VwZGF0ZVBhdGhWaWV3cG9ydCgpfX19KSxvLkJyb3dzZXIuY2FudmFzPWZ1bmN0aW9uKCl7cmV0dXJuISFlLmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpLmdldENvbnRleHR9KCksby5QYXRoPW8uUGF0aC5TVkcmJiF0LkxfUFJFRkVSX0NBTlZBU3x8IW8uQnJvd3Nlci5jYW52YXM/by5QYXRoOm8uUGF0aC5leHRlbmQoe3N0YXRpY3M6e0NBTlZBUzohMCxTVkc6ITF9LHJlZHJhdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXAmJih0aGlzLnByb2plY3RMYXRsbmdzKCksdGhpcy5fcmVxdWVzdFVwZGF0ZSgpKSx0aGlzfSxzZXRTdHlsZTpmdW5jdGlvbih0KXtyZXR1cm4gby5zZXRPcHRpb25zKHRoaXMsdCksdGhpcy5fbWFwJiYodGhpcy5fdXBkYXRlU3R5bGUoKSx0aGlzLl9yZXF1ZXN0VXBkYXRlKCkpLHRoaXN9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3Qub2ZmKCJ2aWV3cmVzZXQiLHRoaXMucHJvamVjdExhdGxuZ3MsdGhpcykub2ZmKCJtb3ZlZW5kIix0aGlzLl91cGRhdGVQYXRoLHRoaXMpLHRoaXMub3B0aW9ucy5jbGlja2FibGUmJih0aGlzLl9tYXAub2ZmKCJjbGljayIsdGhpcy5fb25DbGljayx0aGlzKSx0aGlzLl9tYXAub2ZmKCJtb3VzZW1vdmUiLHRoaXMuX29uTW91c2VNb3ZlLHRoaXMpKSx0aGlzLl9yZXF1ZXN0VXBkYXRlKCksdGhpcy5fbWFwPW51bGx9LF9yZXF1ZXN0VXBkYXRlOmZ1bmN0aW9uKCl7dGhpcy5fbWFwJiYhby5QYXRoLl91cGRhdGVSZXF1ZXN0JiYoby5QYXRoLl91cGRhdGVSZXF1ZXN0PW8uVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKHRoaXMuX2ZpcmVNYXBNb3ZlRW5kLHRoaXMuX21hcCkpfSxfZmlyZU1hcE1vdmVFbmQ6ZnVuY3Rpb24oKXtvLlBhdGguX3VwZGF0ZVJlcXVlc3Q9bnVsbCx0aGlzLmZpcmUoIm1vdmVlbmQiKX0sX2luaXRFbGVtZW50czpmdW5jdGlvbigpe3RoaXMuX21hcC5faW5pdFBhdGhSb290KCksdGhpcy5fY3R4PXRoaXMuX21hcC5fY2FudmFzQ3R4fSxfdXBkYXRlU3R5bGU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLm9wdGlvbnM7dC5zdHJva2UmJih0aGlzLl9jdHgubGluZVdpZHRoPXQud2VpZ2h0LHRoaXMuX2N0eC5zdHJva2VTdHlsZT10LmNvbG9yKSx0LmZpbGwmJih0aGlzLl9jdHguZmlsbFN0eWxlPXQuZmlsbENvbG9yfHx0LmNvbG9yKX0sX2RyYXdQYXRoOmZ1bmN0aW9uKCl7dmFyIHQsZSxpLG4scyxhO2Zvcih0aGlzLl9jdHguYmVnaW5QYXRoKCksdD0wLGk9dGhpcy5fcGFydHMubGVuZ3RoO2k+dDt0Kyspe2ZvcihlPTAsbj10aGlzLl9wYXJ0c1t0XS5sZW5ndGg7bj5lO2UrKylzPXRoaXMuX3BhcnRzW3RdW2VdLGE9KDA9PT1lPyJtb3ZlIjoibGluZSIpKyJUbyIsdGhpcy5fY3R4W2FdKHMueCxzLnkpO3RoaXMgaW5zdGFuY2VvZiBvLlBvbHlnb24mJnRoaXMuX2N0eC5jbG9zZVBhdGgoKX19LF9jaGVja0lmRW1wdHk6ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5fcGFydHMubGVuZ3RofSxfdXBkYXRlUGF0aDpmdW5jdGlvbigpe2lmKCF0aGlzLl9jaGVja0lmRW1wdHkoKSl7dmFyIHQ9dGhpcy5fY3R4LGU9dGhpcy5vcHRpb25zO3RoaXMuX2RyYXdQYXRoKCksdC5zYXZlKCksdGhpcy5fdXBkYXRlU3R5bGUoKSxlLmZpbGwmJih0Lmdsb2JhbEFscGhhPWUuZmlsbE9wYWNpdHksdC5maWxsKCkpLGUuc3Ryb2tlJiYodC5nbG9iYWxBbHBoYT1lLm9wYWNpdHksdC5zdHJva2UoKSksdC5yZXN0b3JlKCl9fSxfaW5pdEV2ZW50czpmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5jbGlja2FibGUmJih0aGlzLl9tYXAub24oIm1vdXNlbW92ZSIsdGhpcy5fb25Nb3VzZU1vdmUsdGhpcyksdGhpcy5fbWFwLm9uKCJjbGljayIsdGhpcy5fb25DbGljayx0aGlzKSl9LF9vbkNsaWNrOmZ1bmN0aW9uKHQpe3RoaXMuX2NvbnRhaW5zUG9pbnQodC5sYXllclBvaW50KSYmdGhpcy5maXJlKCJjbGljayIsdCl9LF9vbk1vdXNlTW92ZTpmdW5jdGlvbih0KXt0aGlzLl9tYXAmJiF0aGlzLl9tYXAuX2FuaW1hdGluZ1pvb20mJih0aGlzLl9jb250YWluc1BvaW50KHQubGF5ZXJQb2ludCk/KHRoaXMuX2N0eC5jYW52YXMuc3R5bGUuY3Vyc29yPSJwb2ludGVyIix0aGlzLl9tb3VzZUluc2lkZT0hMCx0aGlzLmZpcmUoIm1vdXNlb3ZlciIsdCkpOnRoaXMuX21vdXNlSW5zaWRlJiYodGhpcy5fY3R4LmNhbnZhcy5zdHlsZS5jdXJzb3I9IiIsdGhpcy5fbW91c2VJbnNpZGU9ITEsdGhpcy5maXJlKCJtb3VzZW91dCIsdCkpKX19KSxvLk1hcC5pbmNsdWRlKG8uUGF0aC5TVkcmJiF0LkxfUFJFRkVSX0NBTlZBU3x8IW8uQnJvd3Nlci5jYW52YXM/e306e19pbml0UGF0aFJvb3Q6ZnVuY3Rpb24oKXt2YXIgdCxpPXRoaXMuX3BhdGhSb290O2l8fChpPXRoaXMuX3BhdGhSb290PWUuY3JlYXRlRWxlbWVudCgiY2FudmFzIiksaS5zdHlsZS5wb3NpdGlvbj0iYWJzb2x1dGUiLHQ9dGhpcy5fY2FudmFzQ3R4PWkuZ2V0Q29udGV4dCgiMmQiKSx0LmxpbmVDYXA9InJvdW5kIix0LmxpbmVKb2luPSJyb3VuZCIsdGhpcy5fcGFuZXMub3ZlcmxheVBhbmUuYXBwZW5kQ2hpbGQoaSksdGhpcy5vcHRpb25zLnpvb21BbmltYXRpb24mJih0aGlzLl9wYXRoUm9vdC5jbGFzc05hbWU9ImxlYWZsZXQtem9vbS1hbmltYXRlZCIsdGhpcy5vbigiem9vbWFuaW0iLHRoaXMuX2FuaW1hdGVQYXRoWm9vbSksdGhpcy5vbigiem9vbWVuZCIsdGhpcy5fZW5kUGF0aFpvb20pKSx0aGlzLm9uKCJtb3ZlZW5kIix0aGlzLl91cGRhdGVDYW52YXNWaWV3cG9ydCksdGhpcy5fdXBkYXRlQ2FudmFzVmlld3BvcnQoKSl9LF91cGRhdGVDYW52YXNWaWV3cG9ydDpmdW5jdGlvbigpe2lmKCF0aGlzLl9wYXRoWm9vbWluZyl7dGhpcy5fdXBkYXRlUGF0aFZpZXdwb3J0KCk7dmFyIHQ9dGhpcy5fcGF0aFZpZXdwb3J0LGU9dC5taW4saT10Lm1heC5zdWJ0cmFjdChlKSxuPXRoaXMuX3BhdGhSb290O28uRG9tVXRpbC5zZXRQb3NpdGlvbihuLGUpLG4ud2lkdGg9aS54LG4uaGVpZ2h0PWkueSxuLmdldENvbnRleHQoIjJkIikudHJhbnNsYXRlKC1lLngsLWUueSl9fX0pLG8uTGluZVV0aWw9e3NpbXBsaWZ5OmZ1bmN0aW9uKHQsZSl7aWYoIWV8fCF0Lmxlbmd0aClyZXR1cm4gdC5zbGljZSgpO3ZhciBpPWUqZTtyZXR1cm4gdD10aGlzLl9yZWR1Y2VQb2ludHModCxpKSx0PXRoaXMuX3NpbXBsaWZ5RFAodCxpKX0scG9pbnRUb1NlZ21lbnREaXN0YW5jZTpmdW5jdGlvbih0LGUsaSl7cmV0dXJuIE1hdGguc3FydCh0aGlzLl9zcUNsb3Nlc3RQb2ludE9uU2VnbWVudCh0LGUsaSwhMCkpfSxjbG9zZXN0UG9pbnRPblNlZ21lbnQ6ZnVuY3Rpb24odCxlLGkpe3JldHVybiB0aGlzLl9zcUNsb3Nlc3RQb2ludE9uU2VnbWVudCh0LGUsaSl9LF9zaW1wbGlmeURQOmZ1bmN0aW9uKHQsZSl7dmFyIG49dC5sZW5ndGgsbz10eXBlb2YgVWludDhBcnJheSE9aSsiIj9VaW50OEFycmF5OkFycmF5LHM9bmV3IG8obik7c1swXT1zW24tMV09MSx0aGlzLl9zaW1wbGlmeURQU3RlcCh0LHMsZSwwLG4tMSk7dmFyIGEscj1bXTtmb3IoYT0wO24+YTthKyspc1thXSYmci5wdXNoKHRbYV0pO3JldHVybiByfSxfc2ltcGxpZnlEUFN0ZXA6ZnVuY3Rpb24odCxlLGksbixvKXt2YXIgcyxhLHIsaD0wO2ZvcihhPW4rMTtvLTE+PWE7YSsrKXI9dGhpcy5fc3FDbG9zZXN0UG9pbnRPblNlZ21lbnQodFthXSx0W25dLHRbb10sITApLHI+aCYmKHM9YSxoPXIpO2g+aSYmKGVbc109MSx0aGlzLl9zaW1wbGlmeURQU3RlcCh0LGUsaSxuLHMpLHRoaXMuX3NpbXBsaWZ5RFBTdGVwKHQsZSxpLHMsbykpfSxfcmVkdWNlUG9pbnRzOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBpPVt0WzBdXSxuPTEsbz0wLHM9dC5sZW5ndGg7cz5uO24rKyl0aGlzLl9zcURpc3QodFtuXSx0W29dKT5lJiYoaS5wdXNoKHRbbl0pLG89bik7cmV0dXJuIHMtMT5vJiZpLnB1c2godFtzLTFdKSxpfSxjbGlwU2VnbWVudDpmdW5jdGlvbih0LGUsaSxuKXt2YXIgbyxzLGEscj1uP3RoaXMuX2xhc3RDb2RlOnRoaXMuX2dldEJpdENvZGUodCxpKSxoPXRoaXMuX2dldEJpdENvZGUoZSxpKTtmb3IodGhpcy5fbGFzdENvZGU9aDs7KXtpZighKHJ8aCkpcmV0dXJuW3QsZV07aWYociZoKXJldHVybiExO289cnx8aCxzPXRoaXMuX2dldEVkZ2VJbnRlcnNlY3Rpb24odCxlLG8saSksYT10aGlzLl9nZXRCaXRDb2RlKHMsaSksbz09PXI/KHQ9cyxyPWEpOihlPXMsaD1hKX19LF9nZXRFZGdlSW50ZXJzZWN0aW9uOmZ1bmN0aW9uKHQsZSxpLG4pe3ZhciBzPWUueC10LngsYT1lLnktdC55LHI9bi5taW4saD1uLm1heDtyZXR1cm4gOCZpP25ldyBvLlBvaW50KHQueCtzKihoLnktdC55KS9hLGgueSk6NCZpP25ldyBvLlBvaW50KHQueCtzKihyLnktdC55KS9hLHIueSk6MiZpP25ldyBvLlBvaW50KGgueCx0LnkrYSooaC54LXQueCkvcyk6MSZpP25ldyBvLlBvaW50KHIueCx0LnkrYSooci54LXQueCkvcyk6dm9pZCAwfSxfZ2V0Qml0Q29kZTpmdW5jdGlvbih0LGUpe3ZhciBpPTA7cmV0dXJuIHQueDxlLm1pbi54P2l8PTE6dC54PmUubWF4LngmJihpfD0yKSx0Lnk8ZS5taW4ueT9pfD00OnQueT5lLm1heC55JiYoaXw9OCksaX0sX3NxRGlzdDpmdW5jdGlvbih0LGUpe3ZhciBpPWUueC10Lngsbj1lLnktdC55O3JldHVybiBpKmkrbipufSxfc3FDbG9zZXN0UG9pbnRPblNlZ21lbnQ6ZnVuY3Rpb24odCxlLGksbil7dmFyIHMsYT1lLngscj1lLnksaD1pLngtYSxsPWkueS1yLHU9aCpoK2wqbDtyZXR1cm4gdT4wJiYocz0oKHQueC1hKSpoKyh0LnktcikqbCkvdSxzPjE/KGE9aS54LHI9aS55KTpzPjAmJihhKz1oKnMscis9bCpzKSksaD10LngtYSxsPXQueS1yLG4/aCpoK2wqbDpuZXcgby5Qb2ludChhLHIpfX0sby5Qb2x5bGluZT1vLlBhdGguZXh0ZW5kKHtpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7by5QYXRoLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcyxlKSx0aGlzLl9sYXRsbmdzPXRoaXMuX2NvbnZlcnRMYXRMbmdzKHQpfSxvcHRpb25zOntzbW9vdGhGYWN0b3I6MSxub0NsaXA6ITF9LHByb2plY3RMYXRsbmdzOmZ1bmN0aW9uKCl7dGhpcy5fb3JpZ2luYWxQb2ludHM9W107Zm9yKHZhciB0PTAsZT10aGlzLl9sYXRsbmdzLmxlbmd0aDtlPnQ7dCsrKXRoaXMuX29yaWdpbmFsUG9pbnRzW3RdPXRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5fbGF0bG5nc1t0XSl9LGdldFBhdGhTdHJpbmc6ZnVuY3Rpb24oKXtmb3IodmFyIHQ9MCxlPXRoaXMuX3BhcnRzLmxlbmd0aCxpPSIiO2U+dDt0KyspaSs9dGhpcy5fZ2V0UGF0aFBhcnRTdHIodGhpcy5fcGFydHNbdF0pO3JldHVybiBpfSxnZXRMYXRMbmdzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2xhdGxuZ3N9LHNldExhdExuZ3M6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZ3M9dGhpcy5fY29udmVydExhdExuZ3ModCksdGhpcy5yZWRyYXcoKX0sYWRkTGF0TG5nOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9sYXRsbmdzLnB1c2goby5sYXRMbmcodCkpLHRoaXMucmVkcmF3KCl9LHNwbGljZUxhdExuZ3M6ZnVuY3Rpb24oKXt2YXIgdD1bXS5zcGxpY2UuYXBwbHkodGhpcy5fbGF0bG5ncyxhcmd1bWVudHMpO3JldHVybiB0aGlzLl9jb252ZXJ0TGF0TG5ncyh0aGlzLl9sYXRsbmdzLCEwKSx0aGlzLnJlZHJhdygpLHR9LGNsb3Nlc3RMYXllclBvaW50OmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSxpLG49MS8wLHM9dGhpcy5fcGFydHMsYT1udWxsLHI9MCxoPXMubGVuZ3RoO2g+cjtyKyspZm9yKHZhciBsPXNbcl0sdT0xLGM9bC5sZW5ndGg7Yz51O3UrKyl7ZT1sW3UtMV0saT1sW3VdO3ZhciBkPW8uTGluZVV0aWwuX3NxQ2xvc2VzdFBvaW50T25TZWdtZW50KHQsZSxpLCEwKTtuPmQmJihuPWQsYT1vLkxpbmVVdGlsLl9zcUNsb3Nlc3RQb2ludE9uU2VnbWVudCh0LGUsaSkpfXJldHVybiBhJiYoYS5kaXN0YW5jZT1NYXRoLnNxcnQobikpLGF9LGdldEJvdW5kczpmdW5jdGlvbigpe3JldHVybiBuZXcgby5MYXRMbmdCb3VuZHModGhpcy5nZXRMYXRMbmdzKCkpfSxfY29udmVydExhdExuZ3M6ZnVuY3Rpb24odCxlKXt2YXIgaSxuLHM9ZT90OltdO2ZvcihpPTAsbj10Lmxlbmd0aDtuPmk7aSsrKXtpZihvLlV0aWwuaXNBcnJheSh0W2ldKSYmIm51bWJlciIhPXR5cGVvZiB0W2ldWzBdKXJldHVybjtzW2ldPW8ubGF0TG5nKHRbaV0pfXJldHVybiBzfSxfaW5pdEV2ZW50czpmdW5jdGlvbigpe28uUGF0aC5wcm90b3R5cGUuX2luaXRFdmVudHMuY2FsbCh0aGlzKX0sX2dldFBhdGhQYXJ0U3RyOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSxpPW8uUGF0aC5WTUwsbj0wLHM9dC5sZW5ndGgsYT0iIjtzPm47bisrKWU9dFtuXSxpJiZlLl9yb3VuZCgpLGErPShuPyJMIjoiTSIpK2UueCsiICIrZS55O3JldHVybiBhfSxfY2xpcFBvaW50czpmdW5jdGlvbigpe3ZhciB0LGUsaSxuPXRoaXMuX29yaWdpbmFsUG9pbnRzLHM9bi5sZW5ndGg7aWYodGhpcy5vcHRpb25zLm5vQ2xpcClyZXR1cm4gdGhpcy5fcGFydHM9W25dLHZvaWQgMDt0aGlzLl9wYXJ0cz1bXTt2YXIgYT10aGlzLl9wYXJ0cyxyPXRoaXMuX21hcC5fcGF0aFZpZXdwb3J0LGg9by5MaW5lVXRpbDtmb3IodD0wLGU9MDtzLTE+dDt0KyspaT1oLmNsaXBTZWdtZW50KG5bdF0sblt0KzFdLHIsdCksaSYmKGFbZV09YVtlXXx8W10sYVtlXS5wdXNoKGlbMF0pLChpWzFdIT09blt0KzFdfHx0PT09cy0yKSYmKGFbZV0ucHVzaChpWzFdKSxlKyspKX0sX3NpbXBsaWZ5UG9pbnRzOmZ1bmN0aW9uKCl7Zm9yKHZhciB0PXRoaXMuX3BhcnRzLGU9by5MaW5lVXRpbCxpPTAsbj10Lmxlbmd0aDtuPmk7aSsrKXRbaV09ZS5zaW1wbGlmeSh0W2ldLHRoaXMub3B0aW9ucy5zbW9vdGhGYWN0b3IpfSxfdXBkYXRlUGF0aDpmdW5jdGlvbigpe3RoaXMuX21hcCYmKHRoaXMuX2NsaXBQb2ludHMoKSx0aGlzLl9zaW1wbGlmeVBvaW50cygpLG8uUGF0aC5wcm90b3R5cGUuX3VwZGF0ZVBhdGguY2FsbCh0aGlzKSl9fSksby5wb2x5bGluZT1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5Qb2x5bGluZSh0LGUpfSxvLlBvbHlVdGlsPXt9LG8uUG9seVV0aWwuY2xpcFBvbHlnb249ZnVuY3Rpb24odCxlKXt2YXIgaSxuLHMsYSxyLGgsbCx1LGMsZD1bMSw0LDIsOF0scD1vLkxpbmVVdGlsO2ZvcihuPTAsbD10Lmxlbmd0aDtsPm47bisrKXRbbl0uX2NvZGU9cC5fZ2V0Qml0Q29kZSh0W25dLGUpO2ZvcihhPTA7ND5hO2ErKyl7Zm9yKHU9ZFthXSxpPVtdLG49MCxsPXQubGVuZ3RoLHM9bC0xO2w+bjtzPW4rKylyPXRbbl0saD10W3NdLHIuX2NvZGUmdT9oLl9jb2RlJnV8fChjPXAuX2dldEVkZ2VJbnRlcnNlY3Rpb24oaCxyLHUsZSksYy5fY29kZT1wLl9nZXRCaXRDb2RlKGMsZSksaS5wdXNoKGMpKTooaC5fY29kZSZ1JiYoYz1wLl9nZXRFZGdlSW50ZXJzZWN0aW9uKGgscix1LGUpLGMuX2NvZGU9cC5fZ2V0Qml0Q29kZShjLGUpLGkucHVzaChjKSksaS5wdXNoKHIpKTt0PWl9cmV0dXJuIHR9LG8uUG9seWdvbj1vLlBvbHlsaW5lLmV4dGVuZCh7b3B0aW9uczp7ZmlsbDohMH0saW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUpe3ZhciBpLG4scztpZihvLlBvbHlsaW5lLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcyx0LGUpLHQmJm8uVXRpbC5pc0FycmF5KHRbMF0pJiYibnVtYmVyIiE9dHlwZW9mIHRbMF1bMF0pZm9yKHRoaXMuX2xhdGxuZ3M9dGhpcy5fY29udmVydExhdExuZ3ModFswXSksdGhpcy5faG9sZXM9dC5zbGljZSgxKSxpPTAsbj10aGlzLl9ob2xlcy5sZW5ndGg7bj5pO2krKylzPXRoaXMuX2hvbGVzW2ldPXRoaXMuX2NvbnZlcnRMYXRMbmdzKHRoaXMuX2hvbGVzW2ldKSxzWzBdLmVxdWFscyhzW3MubGVuZ3RoLTFdKSYmcy5wb3AoKTt0PXRoaXMuX2xhdGxuZ3MsdC5sZW5ndGg+PTImJnRbMF0uZXF1YWxzKHRbdC5sZW5ndGgtMV0pJiZ0LnBvcCgpfSxwcm9qZWN0TGF0bG5nczpmdW5jdGlvbigpe2lmKG8uUG9seWxpbmUucHJvdG90eXBlLnByb2plY3RMYXRsbmdzLmNhbGwodGhpcyksdGhpcy5faG9sZVBvaW50cz1bXSx0aGlzLl9ob2xlcyl7dmFyIHQsZSxpLG47Zm9yKHQ9MCxpPXRoaXMuX2hvbGVzLmxlbmd0aDtpPnQ7dCsrKWZvcih0aGlzLl9ob2xlUG9pbnRzW3RdPVtdLGU9MCxuPXRoaXMuX2hvbGVzW3RdLmxlbmd0aDtuPmU7ZSsrKXRoaXMuX2hvbGVQb2ludHNbdF1bZV09dGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9ob2xlc1t0XVtlXSl9fSxfY2xpcFBvaW50czpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX29yaWdpbmFsUG9pbnRzLGU9W107aWYodGhpcy5fcGFydHM9W3RdLmNvbmNhdCh0aGlzLl9ob2xlUG9pbnRzKSwhdGhpcy5vcHRpb25zLm5vQ2xpcCl7Zm9yKHZhciBpPTAsbj10aGlzLl9wYXJ0cy5sZW5ndGg7bj5pO2krKyl7dmFyIHM9by5Qb2x5VXRpbC5jbGlwUG9seWdvbih0aGlzLl9wYXJ0c1tpXSx0aGlzLl9tYXAuX3BhdGhWaWV3cG9ydCk7cy5sZW5ndGgmJmUucHVzaChzKX10aGlzLl9wYXJ0cz1lfX0sX2dldFBhdGhQYXJ0U3RyOmZ1bmN0aW9uKHQpe3ZhciBlPW8uUG9seWxpbmUucHJvdG90eXBlLl9nZXRQYXRoUGFydFN0ci5jYWxsKHRoaXMsdCk7cmV0dXJuIGUrKG8uQnJvd3Nlci5zdmc/InoiOiJ4Iil9fSksby5wb2x5Z29uPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLlBvbHlnb24odCxlKX0sZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQpe3JldHVybiBvLkZlYXR1cmVHcm91cC5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCxlKXt0aGlzLl9sYXllcnM9e30sdGhpcy5fb3B0aW9ucz1lLHRoaXMuc2V0TGF0TG5ncyh0KX0sc2V0TGF0TG5nczpmdW5jdGlvbihlKXt2YXIgaT0wLG49ZS5sZW5ndGg7Zm9yKHRoaXMuZWFjaExheWVyKGZ1bmN0aW9uKHQpe24+aT90LnNldExhdExuZ3MoZVtpKytdKTp0aGlzLnJlbW92ZUxheWVyKHQpfSx0aGlzKTtuPmk7KXRoaXMuYWRkTGF5ZXIobmV3IHQoZVtpKytdLHRoaXMuX29wdGlvbnMpKTtyZXR1cm4gdGhpc30sZ2V0TGF0TG5nczpmdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbihlKXt0LnB1c2goZS5nZXRMYXRMbmdzKCkpfSksdH19KX1vLk11bHRpUG9seWxpbmU9dChvLlBvbHlsaW5lKSxvLk11bHRpUG9seWdvbj10KG8uUG9seWdvbiksby5tdWx0aVBvbHlsaW5lPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLk11bHRpUG9seWxpbmUodCxlKX0sby5tdWx0aVBvbHlnb249ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uTXVsdGlQb2x5Z29uKHQsZSl9fSgpLG8uUmVjdGFuZ2xlPW8uUG9seWdvbi5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCxlKXtvLlBvbHlnb24ucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLHRoaXMuX2JvdW5kc1RvTGF0TG5ncyh0KSxlKX0sc2V0Qm91bmRzOmZ1bmN0aW9uKHQpe3RoaXMuc2V0TGF0TG5ncyh0aGlzLl9ib3VuZHNUb0xhdExuZ3ModCkpfSxfYm91bmRzVG9MYXRMbmdzOmZ1bmN0aW9uKHQpe3JldHVybiB0PW8ubGF0TG5nQm91bmRzKHQpLFt0LmdldFNvdXRoV2VzdCgpLHQuZ2V0Tm9ydGhXZXN0KCksdC5nZXROb3J0aEVhc3QoKSx0LmdldFNvdXRoRWFzdCgpXX19KSxvLnJlY3RhbmdsZT1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5SZWN0YW5nbGUodCxlKX0sby5DaXJjbGU9by5QYXRoLmV4dGVuZCh7aW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUsaSl7by5QYXRoLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcyxpKSx0aGlzLl9sYXRsbmc9by5sYXRMbmcodCksdGhpcy5fbVJhZGl1cz1lfSxvcHRpb25zOntmaWxsOiEwfSxzZXRMYXRMbmc6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZz1vLmxhdExuZyh0KSx0aGlzLnJlZHJhdygpfSxzZXRSYWRpdXM6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX21SYWRpdXM9dCx0aGlzLnJlZHJhdygpfSxwcm9qZWN0TGF0bG5nczpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2dldExuZ1JhZGl1cygpLGU9dGhpcy5fbGF0bG5nLGk9dGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludChbZS5sYXQsZS5sbmctdF0pO3RoaXMuX3BvaW50PXRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQoZSksdGhpcy5fcmFkaXVzPU1hdGgubWF4KHRoaXMuX3BvaW50LngtaS54LDEpfSxnZXRCb3VuZHM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9nZXRMbmdSYWRpdXMoKSxlPTM2MCoodGhpcy5fbVJhZGl1cy80MDA3NTAxNyksaT10aGlzLl9sYXRsbmc7cmV0dXJuIG5ldyBvLkxhdExuZ0JvdW5kcyhbaS5sYXQtZSxpLmxuZy10XSxbaS5sYXQrZSxpLmxuZyt0XSl9LGdldExhdExuZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9sYXRsbmd9LGdldFBhdGhTdHJpbmc6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9wb2ludCxlPXRoaXMuX3JhZGl1cztyZXR1cm4gdGhpcy5fY2hlY2tJZkVtcHR5KCk/IiI6by5Ccm93c2VyLnN2Zz8iTSIrdC54KyIsIisodC55LWUpKyJBIitlKyIsIitlKyIsMCwxLDEsIisodC54LS4xKSsiLCIrKHQueS1lKSsiIHoiOih0Ll9yb3VuZCgpLGU9TWF0aC5yb3VuZChlKSwiQUwgIit0LngrIiwiK3QueSsiICIrZSsiLCIrZSsiIDAsIisyMzU5MjYwMCl9LGdldFJhZGl1czpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tUmFkaXVzfSxfZ2V0TGF0UmFkaXVzOmZ1bmN0aW9uKCl7cmV0dXJuIDM2MCoodGhpcy5fbVJhZGl1cy80MDA3NTAxNyl9LF9nZXRMbmdSYWRpdXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZ2V0TGF0UmFkaXVzKCkvTWF0aC5jb3Moby5MYXRMbmcuREVHX1RPX1JBRCp0aGlzLl9sYXRsbmcubGF0KX0sX2NoZWNrSWZFbXB0eTpmdW5jdGlvbigpe2lmKCF0aGlzLl9tYXApcmV0dXJuITE7dmFyIHQ9dGhpcy5fbWFwLl9wYXRoVmlld3BvcnQsZT10aGlzLl9yYWRpdXMsaT10aGlzLl9wb2ludDtyZXR1cm4gaS54LWU+dC5tYXgueHx8aS55LWU+dC5tYXgueXx8aS54K2U8dC5taW4ueHx8aS55K2U8dC5taW4ueX19KSxvLmNpcmNsZT1mdW5jdGlvbih0LGUsaSl7cmV0dXJuIG5ldyBvLkNpcmNsZSh0LGUsaSl9LG8uQ2lyY2xlTWFya2VyPW8uQ2lyY2xlLmV4dGVuZCh7b3B0aW9uczp7cmFkaXVzOjEwLHdlaWdodDoyfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7by5DaXJjbGUucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLHQsbnVsbCxlKSx0aGlzLl9yYWRpdXM9dGhpcy5vcHRpb25zLnJhZGl1c30scHJvamVjdExhdGxuZ3M6ZnVuY3Rpb24oKXt0aGlzLl9wb2ludD10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2xhdGxuZyl9LF91cGRhdGVTdHlsZTpmdW5jdGlvbigpe28uQ2lyY2xlLnByb3RvdHlwZS5fdXBkYXRlU3R5bGUuY2FsbCh0aGlzKSx0aGlzLnNldFJhZGl1cyh0aGlzLm9wdGlvbnMucmFkaXVzKX0sc2V0TGF0TG5nOmZ1bmN0aW9uKHQpe28uQ2lyY2xlLnByb3RvdHlwZS5zZXRMYXRMbmcuY2FsbCh0aGlzLHQpLHRoaXMuX3BvcHVwJiZ0aGlzLl9wb3B1cC5faXNPcGVuJiZ0aGlzLl9wb3B1cC5zZXRMYXRMbmcodCl9LHNldFJhZGl1czpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLnJhZGl1cz10aGlzLl9yYWRpdXM9dCx0aGlzLnJlZHJhdygpfX0pLG8uY2lyY2xlTWFya2VyPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLkNpcmNsZU1hcmtlcih0LGUpfSxvLlBvbHlsaW5lLmluY2x1ZGUoby5QYXRoLkNBTlZBUz97X2NvbnRhaW5zUG9pbnQ6ZnVuY3Rpb24odCxlKXt2YXIgaSxuLHMsYSxyLGgsbCx1PXRoaXMub3B0aW9ucy53ZWlnaHQvMjtmb3Ioby5Ccm93c2VyLnRvdWNoJiYodSs9MTApLGk9MCxhPXRoaXMuX3BhcnRzLmxlbmd0aDthPmk7aSsrKWZvcihsPXRoaXMuX3BhcnRzW2ldLG49MCxyPWwubGVuZ3RoLHM9ci0xO3I+bjtzPW4rKylpZigoZXx8MCE9PW4pJiYoaD1vLkxpbmVVdGlsLnBvaW50VG9TZWdtZW50RGlzdGFuY2UodCxsW3NdLGxbbl0pLHU+PWgpKXJldHVybiEwO3JldHVybiExfX06e30pLG8uUG9seWdvbi5pbmNsdWRlKG8uUGF0aC5DQU5WQVM/e19jb250YWluc1BvaW50OmZ1bmN0aW9uKHQpe3ZhciBlLGksbixzLGEscixoLGwsdT0hMTtpZihvLlBvbHlsaW5lLnByb3RvdHlwZS5fY29udGFpbnNQb2ludC5jYWxsKHRoaXMsdCwhMCkpcmV0dXJuITA7Zm9yKHM9MCxoPXRoaXMuX3BhcnRzLmxlbmd0aDtoPnM7cysrKWZvcihlPXRoaXMuX3BhcnRzW3NdLGE9MCxsPWUubGVuZ3RoLHI9bC0xO2w+YTtyPWErKylpPWVbYV0sbj1lW3JdLGkueT50LnkhPW4ueT50LnkmJnQueDwobi54LWkueCkqKHQueS1pLnkpLyhuLnktaS55KStpLngmJih1PSF1KTtyZXR1cm4gdX19Ont9KSxvLkNpcmNsZS5pbmNsdWRlKG8uUGF0aC5DQU5WQVM/e19kcmF3UGF0aDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3BvaW50O3RoaXMuX2N0eC5iZWdpblBhdGgoKSx0aGlzLl9jdHguYXJjKHQueCx0LnksdGhpcy5fcmFkaXVzLDAsMipNYXRoLlBJLCExKX0sX2NvbnRhaW5zUG9pbnQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fcG9pbnQsaT10aGlzLm9wdGlvbnMuc3Ryb2tlP3RoaXMub3B0aW9ucy53ZWlnaHQvMjowO3JldHVybiB0LmRpc3RhbmNlVG8oZSk8PXRoaXMuX3JhZGl1cytpfX06e30pLG8uQ2lyY2xlTWFya2VyLmluY2x1ZGUoby5QYXRoLkNBTlZBUz97X3VwZGF0ZVN0eWxlOmZ1bmN0aW9uKCl7by5QYXRoLnByb3RvdHlwZS5fdXBkYXRlU3R5bGUuY2FsbCh0aGlzKX19Ont9KSxvLkdlb0pTT049by5GZWF0dXJlR3JvdXAuZXh0ZW5kKHtpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7by5zZXRPcHRpb25zKHRoaXMsZSksdGhpcy5fbGF5ZXJzPXt9LHQmJnRoaXMuYWRkRGF0YSh0KX0sYWRkRGF0YTpmdW5jdGlvbih0KXt2YXIgZSxpLG4scz1vLlV0aWwuaXNBcnJheSh0KT90OnQuZmVhdHVyZXM7aWYocyl7Zm9yKGU9MCxpPXMubGVuZ3RoO2k+ZTtlKyspbj1zW2VdLChuLmdlb21ldHJpZXN8fG4uZ2VvbWV0cnl8fG4uZmVhdHVyZXN8fG4uY29vcmRpbmF0ZXMpJiZ0aGlzLmFkZERhdGEoc1tlXSk7cmV0dXJuIHRoaXN9dmFyIGE9dGhpcy5vcHRpb25zO2lmKCFhLmZpbHRlcnx8YS5maWx0ZXIodCkpe3ZhciByPW8uR2VvSlNPTi5nZW9tZXRyeVRvTGF5ZXIodCxhLnBvaW50VG9MYXllcixhLmNvb3Jkc1RvTGF0TG5nLGEpO3JldHVybiByLmZlYXR1cmU9by5HZW9KU09OLmFzRmVhdHVyZSh0KSxyLmRlZmF1bHRPcHRpb25zPXIub3B0aW9ucyx0aGlzLnJlc2V0U3R5bGUociksYS5vbkVhY2hGZWF0dXJlJiZhLm9uRWFjaEZlYXR1cmUodCxyKSx0aGlzLmFkZExheWVyKHIpfX0scmVzZXRTdHlsZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLm9wdGlvbnMuc3R5bGU7ZSYmKG8uVXRpbC5leHRlbmQodC5vcHRpb25zLHQuZGVmYXVsdE9wdGlvbnMpLHRoaXMuX3NldExheWVyU3R5bGUodCxlKSl9LHNldFN0eWxlOmZ1bmN0aW9uKHQpe3RoaXMuZWFjaExheWVyKGZ1bmN0aW9uKGUpe3RoaXMuX3NldExheWVyU3R5bGUoZSx0KX0sdGhpcyl9LF9zZXRMYXllclN0eWxlOmZ1bmN0aW9uKHQsZSl7ImZ1bmN0aW9uIj09dHlwZW9mIGUmJihlPWUodC5mZWF0dXJlKSksdC5zZXRTdHlsZSYmdC5zZXRTdHlsZShlKX19KSxvLmV4dGVuZChvLkdlb0pTT04se2dlb21ldHJ5VG9MYXllcjpmdW5jdGlvbih0LGUsaSxuKXt2YXIgcyxhLHIsaCxsPSJGZWF0dXJlIj09PXQudHlwZT90Lmdlb21ldHJ5OnQsdT1sLmNvb3JkaW5hdGVzLGM9W107c3dpdGNoKGk9aXx8dGhpcy5jb29yZHNUb0xhdExuZyxsLnR5cGUpe2Nhc2UiUG9pbnQiOnJldHVybiBzPWkodSksZT9lKHQscyk6bmV3IG8uTWFya2VyKHMpO2Nhc2UiTXVsdGlQb2ludCI6Zm9yKHI9MCxoPXUubGVuZ3RoO2g+cjtyKyspcz1pKHVbcl0pLGMucHVzaChlP2UodCxzKTpuZXcgby5NYXJrZXIocykpO3JldHVybiBuZXcgby5GZWF0dXJlR3JvdXAoYyk7Y2FzZSJMaW5lU3RyaW5nIjpyZXR1cm4gYT10aGlzLmNvb3Jkc1RvTGF0TG5ncyh1LDAsaSksbmV3IG8uUG9seWxpbmUoYSxuKTtjYXNlIlBvbHlnb24iOmlmKDI9PT11Lmxlbmd0aCYmIXVbMV0ubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBHZW9KU09OIG9iamVjdC4iKTtyZXR1cm4gYT10aGlzLmNvb3Jkc1RvTGF0TG5ncyh1LDEsaSksbmV3IG8uUG9seWdvbihhLG4pO2Nhc2UiTXVsdGlMaW5lU3RyaW5nIjpyZXR1cm4gYT10aGlzLmNvb3Jkc1RvTGF0TG5ncyh1LDEsaSksbmV3IG8uTXVsdGlQb2x5bGluZShhLG4pO2Nhc2UiTXVsdGlQb2x5Z29uIjpyZXR1cm4gYT10aGlzLmNvb3Jkc1RvTGF0TG5ncyh1LDIsaSksbmV3IG8uTXVsdGlQb2x5Z29uKGEsbik7Y2FzZSJHZW9tZXRyeUNvbGxlY3Rpb24iOmZvcihyPTAsaD1sLmdlb21ldHJpZXMubGVuZ3RoO2g+cjtyKyspYy5wdXNoKHRoaXMuZ2VvbWV0cnlUb0xheWVyKHtnZW9tZXRyeTpsLmdlb21ldHJpZXNbcl0sdHlwZToiRmVhdHVyZSIscHJvcGVydGllczp0LnByb3BlcnRpZXN9LGUsaSxuKSk7cmV0dXJuIG5ldyBvLkZlYXR1cmVHcm91cChjKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiSW52YWxpZCBHZW9KU09OIG9iamVjdC4iKX19LGNvb3Jkc1RvTGF0TG5nOmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5MYXRMbmcodFsxXSx0WzBdKX0sY29vcmRzVG9MYXRMbmdzOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbixvLHMsYT1bXTtmb3Iobz0wLHM9dC5sZW5ndGg7cz5vO28rKyluPWU/dGhpcy5jb29yZHNUb0xhdExuZ3ModFtvXSxlLTEsaSk6KGl8fHRoaXMuY29vcmRzVG9MYXRMbmcpKHRbb10pLGEucHVzaChuKTtyZXR1cm4gYX0sbGF0TG5nVG9Db29yZHM6ZnVuY3Rpb24odCl7cmV0dXJuW3QubG5nLHQubGF0XX0sbGF0TG5nc1RvQ29vcmRzOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1bXSxpPTAsbj10Lmxlbmd0aDtuPmk7aSsrKWUucHVzaChvLkdlb0pTT04ubGF0TG5nVG9Db29yZHModFtpXSkpO3JldHVybiBlfSxnZXRGZWF0dXJlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQuZmVhdHVyZT9vLmV4dGVuZCh7fSx0LmZlYXR1cmUse2dlb21ldHJ5OmV9KTpvLkdlb0pTT04uYXNGZWF0dXJlKGUpfSxhc0ZlYXR1cmU6ZnVuY3Rpb24odCl7cmV0dXJuIkZlYXR1cmUiPT09dC50eXBlP3Q6e3R5cGU6IkZlYXR1cmUiLHByb3BlcnRpZXM6e30sZ2VvbWV0cnk6dH19fSk7dmFyIGE9e3RvR2VvSlNPTjpmdW5jdGlvbigpe3JldHVybiBvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOiJQb2ludCIsY29vcmRpbmF0ZXM6by5HZW9KU09OLmxhdExuZ1RvQ29vcmRzKHRoaXMuZ2V0TGF0TG5nKCkpfSl9fTtvLk1hcmtlci5pbmNsdWRlKGEpLG8uQ2lyY2xlLmluY2x1ZGUoYSksby5DaXJjbGVNYXJrZXIuaW5jbHVkZShhKSxvLlBvbHlsaW5lLmluY2x1ZGUoe3RvR2VvSlNPTjpmdW5jdGlvbigpe3JldHVybiBvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOiJMaW5lU3RyaW5nIixjb29yZGluYXRlczpvLkdlb0pTT04ubGF0TG5nc1RvQ29vcmRzKHRoaXMuZ2V0TGF0TG5ncygpKX0pfX0pLG8uUG9seWdvbi5pbmNsdWRlKHt0b0dlb0pTT046ZnVuY3Rpb24oKXt2YXIgdCxlLGksbj1bby5HZW9KU09OLmxhdExuZ3NUb0Nvb3Jkcyh0aGlzLmdldExhdExuZ3MoKSldO2lmKG5bMF0ucHVzaChuWzBdWzBdKSx0aGlzLl9ob2xlcylmb3IodD0wLGU9dGhpcy5faG9sZXMubGVuZ3RoO2U+dDt0KyspaT1vLkdlb0pTT04ubGF0TG5nc1RvQ29vcmRzKHRoaXMuX2hvbGVzW3RdKSxpLnB1c2goaVswXSksbi5wdXNoKGkpO3JldHVybiBvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOiJQb2x5Z29uIixjb29yZGluYXRlczpufSl9fSksZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQpe3JldHVybiBmdW5jdGlvbigpe3ZhciBlPVtdO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbih0KXtlLnB1c2godC50b0dlb0pTT04oKS5nZW9tZXRyeS5jb29yZGluYXRlcyl9KSxvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOnQsY29vcmRpbmF0ZXM6ZX0pfX1vLk11bHRpUG9seWxpbmUuaW5jbHVkZSh7dG9HZW9KU09OOnQoIk11bHRpTGluZVN0cmluZyIpfSksby5NdWx0aVBvbHlnb24uaW5jbHVkZSh7dG9HZW9KU09OOnQoIk11bHRpUG9seWdvbiIpfSksby5MYXllckdyb3VwLmluY2x1ZGUoe3RvR2VvSlNPTjpmdW5jdGlvbigpe3ZhciBlLGk9dGhpcy5mZWF0dXJlJiZ0aGlzLmZlYXR1cmUuZ2VvbWV0cnksbj1bXTtpZihpJiYiTXVsdGlQb2ludCI9PT1pLnR5cGUpcmV0dXJuIHQoIk11bHRpUG9pbnQiKS5jYWxsKHRoaXMpO3ZhciBzPWkmJiJHZW9tZXRyeUNvbGxlY3Rpb24iPT09aS50eXBlO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbih0KXt0LnRvR2VvSlNPTiYmKGU9dC50b0dlb0pTT04oKSxuLnB1c2gocz9lLmdlb21ldHJ5Om8uR2VvSlNPTi5hc0ZlYXR1cmUoZSkpKX0pLHM/by5HZW9KU09OLmdldEZlYXR1cmUodGhpcyx7Z2VvbWV0cmllczpuLHR5cGU6Ikdlb21ldHJ5Q29sbGVjdGlvbiJ9KTp7dHlwZToiRmVhdHVyZUNvbGxlY3Rpb24iLGZlYXR1cmVzOm59fX0pfSgpLG8uZ2VvSnNvbj1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5HZW9KU09OKHQsZSl9LG8uRG9tRXZlbnQ9e2FkZExpc3RlbmVyOmZ1bmN0aW9uKHQsZSxpLG4pe3ZhciBzLGEscixoPW8uc3RhbXAoaSksbD0iX2xlYWZsZXRfIitlK2g7cmV0dXJuIHRbbF0/dGhpczoocz1mdW5jdGlvbihlKXtyZXR1cm4gaS5jYWxsKG58fHQsZXx8by5Eb21FdmVudC5fZ2V0RXZlbnQoKSl9LG8uQnJvd3Nlci5tc1RvdWNoJiYwPT09ZS5pbmRleE9mKCJ0b3VjaCIpP3RoaXMuYWRkTXNUb3VjaExpc3RlbmVyKHQsZSxzLGgpOihvLkJyb3dzZXIudG91Y2gmJiJkYmxjbGljayI9PT1lJiZ0aGlzLmFkZERvdWJsZVRhcExpc3RlbmVyJiZ0aGlzLmFkZERvdWJsZVRhcExpc3RlbmVyKHQscyxoKSwiYWRkRXZlbnRMaXN0ZW5lciJpbiB0PyJtb3VzZXdoZWVsIj09PWU/KHQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NTW91c2VTY3JvbGwiLHMsITEpLHQuYWRkRXZlbnRMaXN0ZW5lcihlLHMsITEpKToibW91c2VlbnRlciI9PT1lfHwibW91c2VsZWF2ZSI9PT1lPyhhPXMscj0ibW91c2VlbnRlciI9PT1lPyJtb3VzZW92ZXIiOiJtb3VzZW91dCIscz1mdW5jdGlvbihlKXtyZXR1cm4gby5Eb21FdmVudC5fY2hlY2tNb3VzZSh0LGUpP2EoZSk6dm9pZCAwfSx0LmFkZEV2ZW50TGlzdGVuZXIocixzLCExKSk6ImNsaWNrIj09PWUmJm8uQnJvd3Nlci5hbmRyb2lkPyhhPXMscz1mdW5jdGlvbih0KXtyZXR1cm4gby5Eb21FdmVudC5fZmlsdGVyQ2xpY2sodCxhKX0sdC5hZGRFdmVudExpc3RlbmVyKGUscywhMSkpOnQuYWRkRXZlbnRMaXN0ZW5lcihlLHMsITEpOiJhdHRhY2hFdmVudCJpbiB0JiZ0LmF0dGFjaEV2ZW50KCJvbiIrZSxzKSx0W2xdPXMsdGhpcykpfSxyZW1vdmVMaXN0ZW5lcjpmdW5jdGlvbih0LGUsaSl7dmFyIG49by5zdGFtcChpKSxzPSJfbGVhZmxldF8iK2UrbixhPXRbc107cmV0dXJuIGE/KG8uQnJvd3Nlci5tc1RvdWNoJiYwPT09ZS5pbmRleE9mKCJ0b3VjaCIpP3RoaXMucmVtb3ZlTXNUb3VjaExpc3RlbmVyKHQsZSxuKTpvLkJyb3dzZXIudG91Y2gmJiJkYmxjbGljayI9PT1lJiZ0aGlzLnJlbW92ZURvdWJsZVRhcExpc3RlbmVyP3RoaXMucmVtb3ZlRG91YmxlVGFwTGlzdGVuZXIodCxuKToicmVtb3ZlRXZlbnRMaXN0ZW5lciJpbiB0PyJtb3VzZXdoZWVsIj09PWU/KHQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NTW91c2VTY3JvbGwiLGEsITEpLHQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLGEsITEpKToibW91c2VlbnRlciI9PT1lfHwibW91c2VsZWF2ZSI9PT1lP3QucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2VlbnRlciI9PT1lPyJtb3VzZW92ZXIiOiJtb3VzZW91dCIsYSwhMSk6dC5yZW1vdmVFdmVudExpc3RlbmVyKGUsYSwhMSk6ImRldGFjaEV2ZW50ImluIHQmJnQuZGV0YWNoRXZlbnQoIm9uIitlLGEpLHRbc109bnVsbCx0aGlzKTp0aGlzfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24odCl7cmV0dXJuIHQuc3RvcFByb3BhZ2F0aW9uP3Quc3RvcFByb3BhZ2F0aW9uKCk6dC5jYW5jZWxCdWJibGU9ITAsby5Eb21FdmVudC5fc2tpcHBlZCh0KSx0aGlzfSxkaXNhYmxlQ2xpY2tQcm9wYWdhdGlvbjpmdW5jdGlvbih0KXtmb3IodmFyIGU9by5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24saT1vLkRyYWdnYWJsZS5TVEFSVC5sZW5ndGgtMTtpPj0wO2ktLSlvLkRvbUV2ZW50LmFkZExpc3RlbmVyKHQsby5EcmFnZ2FibGUuU1RBUlRbaV0sZSk7cmV0dXJuIG8uRG9tRXZlbnQuYWRkTGlzdGVuZXIodCwiY2xpY2siLG8uRG9tRXZlbnQuX2Zha2VTdG9wKS5hZGRMaXN0ZW5lcih0LCJkYmxjbGljayIsZSl9LHByZXZlbnREZWZhdWx0OmZ1bmN0aW9uKHQpe3JldHVybiB0LnByZXZlbnREZWZhdWx0P3QucHJldmVudERlZmF1bHQoKTp0LnJldHVyblZhbHVlPSExLHRoaXN9LHN0b3A6ZnVuY3Rpb24odCl7cmV0dXJuIG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCkuc3RvcFByb3BhZ2F0aW9uKHQpfSxnZXRNb3VzZVBvc2l0aW9uOmZ1bmN0aW9uKHQsaSl7dmFyIG49by5Ccm93c2VyLmllNyxzPWUuYm9keSxhPWUuZG9jdW1lbnRFbGVtZW50LHI9dC5wYWdlWD90LnBhZ2VYLXMuc2Nyb2xsTGVmdC1hLnNjcm9sbExlZnQ6dC5jbGllbnRYLGg9dC5wYWdlWT90LnBhZ2VZLXMuc2Nyb2xsVG9wLWEuc2Nyb2xsVG9wOnQuY2xpZW50WSxsPW5ldyBvLlBvaW50KHIsaCk7aWYoIWkpcmV0dXJuIGw7dmFyIHU9aS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxjPXUubGVmdC1pLmNsaWVudExlZnQsZD11LnRvcC1pLmNsaWVudFRvcDtyZXR1cm4gby5Eb21VdGlsLmRvY3VtZW50SXNMdHIoKXx8IW8uQnJvd3Nlci53ZWJraXQmJiFufHwoYys9aS5zY3JvbGxXaWR0aC1pLmNsaWVudFdpZHRoLG4mJiJoaWRkZW4iIT09by5Eb21VdGlsLmdldFN0eWxlKGksIm92ZXJmbG93LXkiKSYmImhpZGRlbiIhPT1vLkRvbVV0aWwuZ2V0U3R5bGUoaSwib3ZlcmZsb3ciKSYmKGMrPTE3KSksbC5fc3VidHJhY3QobmV3IG8uUG9pbnQoYyxkKSl9LGdldFdoZWVsRGVsdGE6ZnVuY3Rpb24odCl7dmFyIGU9MDtyZXR1cm4gdC53aGVlbERlbHRhJiYoZT10LndoZWVsRGVsdGEvMTIwKSx0LmRldGFpbCYmKGU9LXQuZGV0YWlsLzMpLGV9LF9za2lwRXZlbnRzOnt9LF9mYWtlU3RvcDpmdW5jdGlvbih0KXtvLkRvbUV2ZW50Ll9za2lwRXZlbnRzW3QudHlwZV09ITB9LF9za2lwcGVkOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX3NraXBFdmVudHNbdC50eXBlXTtyZXR1cm4gdGhpcy5fc2tpcEV2ZW50c1t0LnR5cGVdPSExLGV9LF9jaGVja01vdXNlOmZ1bmN0aW9uKHQsZSl7dmFyIGk9ZS5yZWxhdGVkVGFyZ2V0O2lmKCFpKXJldHVybiEwO3RyeXtmb3IoO2kmJmkhPT10OylpPWkucGFyZW50Tm9kZX1jYXRjaChuKXtyZXR1cm4hMX1yZXR1cm4gaSE9PXR9LF9nZXRFdmVudDpmdW5jdGlvbigpe3ZhciBlPXQuZXZlbnQ7aWYoIWUpZm9yKHZhciBpPWFyZ3VtZW50cy5jYWxsZWUuY2FsbGVyO2kmJihlPWkuYXJndW1lbnRzWzBdLCFlfHx0LkV2ZW50IT09ZS5jb25zdHJ1Y3Rvcik7KWk9aS5jYWxsZXI7cmV0dXJuIGV9LF9maWx0ZXJDbGljazpmdW5jdGlvbih0LGUpe3ZhciBpPXQudGltZVN0YW1wfHx0Lm9yaWdpbmFsRXZlbnQudGltZVN0YW1wLG49by5Eb21FdmVudC5fbGFzdENsaWNrJiZpLW8uRG9tRXZlbnQuX2xhc3RDbGljaztyZXR1cm4gbiYmbj4xMDAmJjFlMz5ufHx0LnRhcmdldC5fc2ltdWxhdGVkQ2xpY2smJiF0Ll9zaW11bGF0ZWQ/KG8uRG9tRXZlbnQuc3RvcCh0KSx2b2lkIDApOihvLkRvbUV2ZW50Ll9sYXN0Q2xpY2s9aSxlKHQpKX19LG8uRG9tRXZlbnQub249by5Eb21FdmVudC5hZGRMaXN0ZW5lcixvLkRvbUV2ZW50Lm9mZj1vLkRvbUV2ZW50LnJlbW92ZUxpc3RlbmVyLG8uRHJhZ2dhYmxlPW8uQ2xhc3MuZXh0ZW5kKHtpbmNsdWRlczpvLk1peGluLkV2ZW50cyxzdGF0aWNzOntTVEFSVDpvLkJyb3dzZXIudG91Y2g/WyJ0b3VjaHN0YXJ0IiwibW91c2Vkb3duIl06WyJtb3VzZWRvd24iXSxFTkQ6e21vdXNlZG93bjoibW91c2V1cCIsdG91Y2hzdGFydDoidG91Y2hlbmQiLE1TUG9pbnRlckRvd246InRvdWNoZW5kIn0sTU9WRTp7bW91c2Vkb3duOiJtb3VzZW1vdmUiLHRvdWNoc3RhcnQ6InRvdWNobW92ZSIsTVNQb2ludGVyRG93bjoidG91Y2htb3ZlIn19LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlKXt0aGlzLl9lbGVtZW50PXQsdGhpcy5fZHJhZ1N0YXJ0VGFyZ2V0PWV8fHR9LGVuYWJsZTpmdW5jdGlvbigpe2lmKCF0aGlzLl9lbmFibGVkKXtmb3IodmFyIHQ9by5EcmFnZ2FibGUuU1RBUlQubGVuZ3RoLTE7dD49MDt0LS0pby5Eb21FdmVudC5vbih0aGlzLl9kcmFnU3RhcnRUYXJnZXQsby5EcmFnZ2FibGUuU1RBUlRbdF0sdGhpcy5fb25Eb3duLHRoaXMpO3RoaXMuX2VuYWJsZWQ9ITB9fSxkaXNhYmxlOmZ1bmN0aW9uKCl7aWYodGhpcy5fZW5hYmxlZCl7Zm9yKHZhciB0PW8uRHJhZ2dhYmxlLlNUQVJULmxlbmd0aC0xO3Q+PTA7dC0tKW8uRG9tRXZlbnQub2ZmKHRoaXMuX2RyYWdTdGFydFRhcmdldCxvLkRyYWdnYWJsZS5TVEFSVFt0XSx0aGlzLl9vbkRvd24sdGhpcyk7dGhpcy5fZW5hYmxlZD0hMSx0aGlzLl9tb3ZlZD0hMX19LF9vbkRvd246ZnVuY3Rpb24odCl7aWYodGhpcy5fbW92ZWQ9ITEsIXQuc2hpZnRLZXkmJigxPT09dC53aGljaHx8MT09PXQuYnV0dG9ufHx0LnRvdWNoZXMpJiYoby5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24odCksIW8uRHJhZ2dhYmxlLl9kaXNhYmxlZCkpe28uRG9tVXRpbC5kaXNhYmxlSW1hZ2VEcmFnKCksby5Eb21VdGlsLmRpc2FibGVUZXh0U2VsZWN0aW9uKCk7dmFyIGk9dC50b3VjaGVzP3QudG91Y2hlc1swXTp0LG49aS50YXJnZXQ7by5Ccm93c2VyLnRvdWNoJiZuLnRhZ05hbWUmJiJhIj09PW4udGFnTmFtZS50b0xvd2VyQ2FzZSgpJiZvLkRvbVV0aWwuYWRkQ2xhc3MobiwibGVhZmxldC1hY3RpdmUiKSx0aGlzLl9tb3Zpbmd8fCh0aGlzLl9zdGFydFBvaW50PW5ldyBvLlBvaW50KGkuY2xpZW50WCxpLmNsaWVudFkpLHRoaXMuX3N0YXJ0UG9zPXRoaXMuX25ld1Bvcz1vLkRvbVV0aWwuZ2V0UG9zaXRpb24odGhpcy5fZWxlbWVudCksby5Eb21FdmVudC5vbihlLG8uRHJhZ2dhYmxlLk1PVkVbdC50eXBlXSx0aGlzLl9vbk1vdmUsdGhpcykub24oZSxvLkRyYWdnYWJsZS5FTkRbdC50eXBlXSx0aGlzLl9vblVwLHRoaXMpKX19LF9vbk1vdmU6ZnVuY3Rpb24odCl7aWYoISh0LnRvdWNoZXMmJnQudG91Y2hlcy5sZW5ndGg+MSkpe3ZhciBpPXQudG91Y2hlcyYmMT09PXQudG91Y2hlcy5sZW5ndGg/dC50b3VjaGVzWzBdOnQsbj1uZXcgby5Qb2ludChpLmNsaWVudFgsaS5jbGllbnRZKSxzPW4uc3VidHJhY3QodGhpcy5fc3RhcnRQb2ludCk7KHMueHx8cy55KSYmKG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCksdGhpcy5fbW92ZWR8fCh0aGlzLmZpcmUoImRyYWdzdGFydCIpLHRoaXMuX21vdmVkPSEwLHRoaXMuX3N0YXJ0UG9zPW8uRG9tVXRpbC5nZXRQb3NpdGlvbih0aGlzLl9lbGVtZW50KS5zdWJ0cmFjdChzKSxvLkJyb3dzZXIudG91Y2h8fG8uRG9tVXRpbC5hZGRDbGFzcyhlLmJvZHksImxlYWZsZXQtZHJhZ2dpbmciKSksdGhpcy5fbmV3UG9zPXRoaXMuX3N0YXJ0UG9zLmFkZChzKSx0aGlzLl9tb3Zpbmc9ITAsby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCksdGhpcy5fYW5pbVJlcXVlc3Q9by5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fdXBkYXRlUG9zaXRpb24sdGhpcywhMCx0aGlzLl9kcmFnU3RhcnRUYXJnZXQpKX19LF91cGRhdGVQb3NpdGlvbjpmdW5jdGlvbigpe3RoaXMuZmlyZSgicHJlZHJhZyIpLG8uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9lbGVtZW50LHRoaXMuX25ld1BvcyksdGhpcy5maXJlKCJkcmFnIil9LF9vblVwOmZ1bmN0aW9uKCl7by5Ccm93c2VyLnRvdWNofHxvLkRvbVV0aWwucmVtb3ZlQ2xhc3MoZS5ib2R5LCJsZWFmbGV0LWRyYWdnaW5nIik7Zm9yKHZhciB0IGluIG8uRHJhZ2dhYmxlLk1PVkUpby5Eb21FdmVudC5vZmYoZSxvLkRyYWdnYWJsZS5NT1ZFW3RdLHRoaXMuX29uTW92ZSkub2ZmKGUsby5EcmFnZ2FibGUuRU5EW3RdLHRoaXMuX29uVXApO28uRG9tVXRpbC5lbmFibGVJbWFnZURyYWcoKSxvLkRvbVV0aWwuZW5hYmxlVGV4dFNlbGVjdGlvbigpLHRoaXMuX21vdmVkJiYoby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCksdGhpcy5maXJlKCJkcmFnZW5kIikpLHRoaXMuX21vdmluZz0hMX19KSxvLkhhbmRsZXI9by5DbGFzcy5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXR9LGVuYWJsZTpmdW5jdGlvbigpe3RoaXMuX2VuYWJsZWR8fCh0aGlzLl9lbmFibGVkPSEwLHRoaXMuYWRkSG9va3MoKSl9LGRpc2FibGU6ZnVuY3Rpb24oKXt0aGlzLl9lbmFibGVkJiYodGhpcy5fZW5hYmxlZD0hMSx0aGlzLnJlbW92ZUhvb2tzKCkpfSxlbmFibGVkOmZ1bmN0aW9uKCl7cmV0dXJuISF0aGlzLl9lbmFibGVkfX0pLG8uTWFwLm1lcmdlT3B0aW9ucyh7ZHJhZ2dpbmc6ITAsaW5lcnRpYTohby5Ccm93c2VyLmFuZHJvaWQyMyxpbmVydGlhRGVjZWxlcmF0aW9uOjM0MDAsaW5lcnRpYU1heFNwZWVkOjEvMCxpbmVydGlhVGhyZXNob2xkOm8uQnJvd3Nlci50b3VjaD8zMjoxOCxlYXNlTGluZWFyaXR5Oi4yNSx3b3JsZENvcHlKdW1wOiExfSksby5NYXAuRHJhZz1vLkhhbmRsZXIuZXh0ZW5kKHthZGRIb29rczpmdW5jdGlvbigpe2lmKCF0aGlzLl9kcmFnZ2FibGUpe3ZhciB0PXRoaXMuX21hcDt0aGlzLl9kcmFnZ2FibGU9bmV3IG8uRHJhZ2dhYmxlKHQuX21hcFBhbmUsdC5fY29udGFpbmVyKSx0aGlzLl9kcmFnZ2FibGUub24oe2RyYWdzdGFydDp0aGlzLl9vbkRyYWdTdGFydCxkcmFnOnRoaXMuX29uRHJhZyxkcmFnZW5kOnRoaXMuX29uRHJhZ0VuZH0sdGhpcyksdC5vcHRpb25zLndvcmxkQ29weUp1bXAmJih0aGlzLl9kcmFnZ2FibGUub24oInByZWRyYWciLHRoaXMuX29uUHJlRHJhZyx0aGlzKSx0Lm9uKCJ2aWV3cmVzZXQiLHRoaXMuX29uVmlld1Jlc2V0LHRoaXMpLHQud2hlblJlYWR5KHRoaXMuX29uVmlld1Jlc2V0LHRoaXMpKX10aGlzLl9kcmFnZ2FibGUuZW5hYmxlKCl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7dGhpcy5fZHJhZ2dhYmxlLmRpc2FibGUoKX0sbW92ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZHJhZ2dhYmxlJiZ0aGlzLl9kcmFnZ2FibGUuX21vdmVkfSxfb25EcmFnU3RhcnQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9tYXA7dC5fcGFuQW5pbSYmdC5fcGFuQW5pbS5zdG9wKCksdC5maXJlKCJtb3Zlc3RhcnQiKS5maXJlKCJkcmFnc3RhcnQiKSx0Lm9wdGlvbnMuaW5lcnRpYSYmKHRoaXMuX3Bvc2l0aW9ucz1bXSx0aGlzLl90aW1lcz1bXSl9LF9vbkRyYWc6ZnVuY3Rpb24oKXtpZih0aGlzLl9tYXAub3B0aW9ucy5pbmVydGlhKXt2YXIgdD10aGlzLl9sYXN0VGltZT0rbmV3IERhdGUsZT10aGlzLl9sYXN0UG9zPXRoaXMuX2RyYWdnYWJsZS5fbmV3UG9zO3RoaXMuX3Bvc2l0aW9ucy5wdXNoKGUpLHRoaXMuX3RpbWVzLnB1c2godCksdC10aGlzLl90aW1lc1swXT4yMDAmJih0aGlzLl9wb3NpdGlvbnMuc2hpZnQoKSx0aGlzLl90aW1lcy5zaGlmdCgpKX10aGlzLl9tYXAuZmlyZSgibW92ZSIpLmZpcmUoImRyYWciKX0sX29uVmlld1Jlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLmdldFNpemUoKS5fZGl2aWRlQnkoMiksZT10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KFswLDBdKTt0aGlzLl9pbml0aWFsV29ybGRPZmZzZXQ9ZS5zdWJ0cmFjdCh0KS54LHRoaXMuX3dvcmxkV2lkdGg9dGhpcy5fbWFwLnByb2plY3QoWzAsMTgwXSkueH0sX29uUHJlRHJhZzpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3dvcmxkV2lkdGgsZT1NYXRoLnJvdW5kKHQvMiksaT10aGlzLl9pbml0aWFsV29ybGRPZmZzZXQsbj10aGlzLl9kcmFnZ2FibGUuX25ld1Bvcy54LG89KG4tZStpKSV0K2UtaSxzPShuK2UraSkldC1lLWksYT1NYXRoLmFicyhvK2kpPE1hdGguYWJzKHMraSk/bzpzO3RoaXMuX2RyYWdnYWJsZS5fbmV3UG9zLng9YX0sX29uRHJhZ0VuZDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPXQub3B0aW9ucyxpPStuZXcgRGF0ZS10aGlzLl9sYXN0VGltZSxuPSFlLmluZXJ0aWF8fGk+ZS5pbmVydGlhVGhyZXNob2xkfHwhdGhpcy5fcG9zaXRpb25zWzBdO2lmKHQuZmlyZSgiZHJhZ2VuZCIpLG4pdC5maXJlKCJtb3ZlZW5kIik7ZWxzZXt2YXIgcz10aGlzLl9sYXN0UG9zLnN1YnRyYWN0KHRoaXMuX3Bvc2l0aW9uc1swXSksYT0odGhpcy5fbGFzdFRpbWUraS10aGlzLl90aW1lc1swXSkvMWUzLHI9ZS5lYXNlTGluZWFyaXR5LGg9cy5tdWx0aXBseUJ5KHIvYSksbD1oLmRpc3RhbmNlVG8oWzAsMF0pLHU9TWF0aC5taW4oZS5pbmVydGlhTWF4U3BlZWQsbCksYz1oLm11bHRpcGx5QnkodS9sKSxkPXUvKGUuaW5lcnRpYURlY2VsZXJhdGlvbipyKSxwPWMubXVsdGlwbHlCeSgtZC8yKS5yb3VuZCgpO3AueCYmcC55P28uVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uKCl7dC5wYW5CeShwLHtkdXJhdGlvbjpkLGVhc2VMaW5lYXJpdHk6cixub01vdmVTdGFydDohMH0pfSk6dC5maXJlKCJtb3ZlZW5kIil9fX0pLG8uTWFwLmFkZEluaXRIb29rKCJhZGRIYW5kbGVyIiwiZHJhZ2dpbmciLG8uTWFwLkRyYWcpLG8uTWFwLm1lcmdlT3B0aW9ucyh7ZG91YmxlQ2xpY2tab29tOiEwfSksby5NYXAuRG91YmxlQ2xpY2tab29tPW8uSGFuZGxlci5leHRlbmQoe2FkZEhvb2tzOmZ1bmN0aW9uKCl7dGhpcy5fbWFwLm9uKCJkYmxjbGljayIsdGhpcy5fb25Eb3VibGVDbGljayx0aGlzKX0scmVtb3ZlSG9va3M6ZnVuY3Rpb24oKXt0aGlzLl9tYXAub2ZmKCJkYmxjbGljayIsdGhpcy5fb25Eb3VibGVDbGljayx0aGlzKX0sX29uRG91YmxlQ2xpY2s6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fbWFwLGk9ZS5nZXRab29tKCkrMTsiY2VudGVyIj09PWUub3B0aW9ucy5kb3VibGVDbGlja1pvb20/ZS5zZXRab29tKGkpOmUuc2V0Wm9vbUFyb3VuZCh0LmNvbnRhaW5lclBvaW50LGkpfX0pLG8uTWFwLmFkZEluaXRIb29rKCJhZGRIYW5kbGVyIiwiZG91YmxlQ2xpY2tab29tIixvLk1hcC5Eb3VibGVDbGlja1pvb20pLG8uTWFwLm1lcmdlT3B0aW9ucyh7c2Nyb2xsV2hlZWxab29tOiEwfSksby5NYXAuU2Nyb2xsV2hlZWxab29tPW8uSGFuZGxlci5leHRlbmQoe2FkZEhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vbih0aGlzLl9tYXAuX2NvbnRhaW5lciwibW91c2V3aGVlbCIsdGhpcy5fb25XaGVlbFNjcm9sbCx0aGlzKSxvLkRvbUV2ZW50Lm9uKHRoaXMuX21hcC5fY29udGFpbmVyLCJNb3pNb3VzZVBpeGVsU2Nyb2xsIixvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KSx0aGlzLl9kZWx0YT0wfSxyZW1vdmVIb29rczpmdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKHRoaXMuX21hcC5fY29udGFpbmVyLCJtb3VzZXdoZWVsIix0aGlzLl9vbldoZWVsU2Nyb2xsKSxvLkRvbUV2ZW50Lm9mZih0aGlzLl9tYXAuX2NvbnRhaW5lciwiTW96TW91c2VQaXhlbFNjcm9sbCIsby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCl9LF9vbldoZWVsU2Nyb2xsOmZ1bmN0aW9uKHQpe3ZhciBlPW8uRG9tRXZlbnQuZ2V0V2hlZWxEZWx0YSh0KTt0aGlzLl9kZWx0YSs9ZSx0aGlzLl9sYXN0TW91c2VQb3M9dGhpcy5fbWFwLm1vdXNlRXZlbnRUb0NvbnRhaW5lclBvaW50KHQpLHRoaXMuX3N0YXJ0VGltZXx8KHRoaXMuX3N0YXJ0VGltZT0rbmV3IERhdGUpO3ZhciBpPU1hdGgubWF4KDQwLSgrbmV3IERhdGUtdGhpcy5fc3RhcnRUaW1lKSwwKTtjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpLHRoaXMuX3RpbWVyPXNldFRpbWVvdXQoby5iaW5kKHRoaXMuX3BlcmZvcm1ab29tLHRoaXMpLGkpLG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCksby5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24odCl9LF9wZXJmb3JtWm9vbTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPXRoaXMuX2RlbHRhLGk9dC5nZXRab29tKCk7ZT1lPjA/TWF0aC5jZWlsKGUpOk1hdGguZmxvb3IoZSksZT1NYXRoLm1heChNYXRoLm1pbihlLDQpLC00KSxlPXQuX2xpbWl0Wm9vbShpK2UpLWksdGhpcy5fZGVsdGE9MCx0aGlzLl9zdGFydFRpbWU9bnVsbCxlJiYoImNlbnRlciI9PT10Lm9wdGlvbnMuc2Nyb2xsV2hlZWxab29tP3Quc2V0Wm9vbShpK2UpOnQuc2V0Wm9vbUFyb3VuZCh0aGlzLl9sYXN0TW91c2VQb3MsaStlKSl9fSksby5NYXAuYWRkSW5pdEhvb2soImFkZEhhbmRsZXIiLCJzY3JvbGxXaGVlbFpvb20iLG8uTWFwLlNjcm9sbFdoZWVsWm9vbSksby5leHRlbmQoby5Eb21FdmVudCx7X3RvdWNoc3RhcnQ6by5Ccm93c2VyLm1zVG91Y2g/Ik1TUG9pbnRlckRvd24iOiJ0b3VjaHN0YXJ0IixfdG91Y2hlbmQ6by5Ccm93c2VyLm1zVG91Y2g/Ik1TUG9pbnRlclVwIjoidG91Y2hlbmQiLGFkZERvdWJsZVRhcExpc3RlbmVyOmZ1bmN0aW9uKHQsaSxuKXtmdW5jdGlvbiBzKHQpe3ZhciBlO2lmKG8uQnJvd3Nlci5tc1RvdWNoPyhtLnB1c2godC5wb2ludGVySWQpLGU9bS5sZW5ndGgpOmU9dC50b3VjaGVzLmxlbmd0aCwhKGU+MSkpe3ZhciBpPURhdGUubm93KCksbj1pLShyfHxpKTtoPXQudG91Y2hlcz90LnRvdWNoZXNbMF06dCxsPW4+MCYmdT49bixyPWl9fWZ1bmN0aW9uIGEodCl7aWYoby5Ccm93c2VyLm1zVG91Y2gpe3ZhciBlPW0uaW5kZXhPZih0LnBvaW50ZXJJZCk7aWYoLTE9PT1lKXJldHVybjttLnNwbGljZShlLDEpfWlmKGwpe2lmKG8uQnJvd3Nlci5tc1RvdWNoKXt2YXIgbixzPXt9O2Zvcih2YXIgYSBpbiBoKW49aFthXSxzW2FdPSJmdW5jdGlvbiI9PXR5cGVvZiBuP24uYmluZChoKTpuO2g9c31oLnR5cGU9ImRibGNsaWNrIixpKGgpLHI9bnVsbH19dmFyIHIsaCxsPSExLHU9MjUwLGM9Il9sZWFmbGV0XyIsZD10aGlzLl90b3VjaHN0YXJ0LHA9dGhpcy5fdG91Y2hlbmQsbT1bXTt0W2MrZCtuXT1zLHRbYytwK25dPWE7dmFyIF89by5Ccm93c2VyLm1zVG91Y2g/ZS5kb2N1bWVudEVsZW1lbnQ6dDtyZXR1cm4gdC5hZGRFdmVudExpc3RlbmVyKGQscywhMSksXy5hZGRFdmVudExpc3RlbmVyKHAsYSwhMSksby5Ccm93c2VyLm1zVG91Y2gmJl8uYWRkRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyQ2FuY2VsIixhLCExKSx0aGlzfSxyZW1vdmVEb3VibGVUYXBMaXN0ZW5lcjpmdW5jdGlvbih0LGkpe3ZhciBuPSJfbGVhZmxldF8iO3JldHVybiB0LnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5fdG91Y2hzdGFydCx0W24rdGhpcy5fdG91Y2hzdGFydCtpXSwhMSksKG8uQnJvd3Nlci5tc1RvdWNoP2UuZG9jdW1lbnRFbGVtZW50OnQpLnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5fdG91Y2hlbmQsdFtuK3RoaXMuX3RvdWNoZW5kK2ldLCExKSxvLkJyb3dzZXIubXNUb3VjaCYmZS5kb2N1bWVudEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyQ2FuY2VsIix0W24rdGhpcy5fdG91Y2hlbmQraV0sITEpLHRoaXN9fSksby5leHRlbmQoby5Eb21FdmVudCx7X21zVG91Y2hlczpbXSxfbXNEb2N1bWVudExpc3RlbmVyOiExLGFkZE1zVG91Y2hMaXN0ZW5lcjpmdW5jdGlvbih0LGUsaSxuKXtzd2l0Y2goZSl7Y2FzZSJ0b3VjaHN0YXJ0IjpyZXR1cm4gdGhpcy5hZGRNc1RvdWNoTGlzdGVuZXJTdGFydCh0LGUsaSxuKTtjYXNlInRvdWNoZW5kIjpyZXR1cm4gdGhpcy5hZGRNc1RvdWNoTGlzdGVuZXJFbmQodCxlLGksbik7Y2FzZSJ0b3VjaG1vdmUiOnJldHVybiB0aGlzLmFkZE1zVG91Y2hMaXN0ZW5lck1vdmUodCxlLGksbik7ZGVmYXVsdDp0aHJvdyJVbmtub3duIHRvdWNoIGV2ZW50IHR5cGUifX0sYWRkTXNUb3VjaExpc3RlbmVyU3RhcnQ6ZnVuY3Rpb24odCxpLG4scyl7dmFyIGE9Il9sZWFmbGV0XyIscj10aGlzLl9tc1RvdWNoZXMsaD1mdW5jdGlvbih0KXtvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KHQpO2Zvcih2YXIgZT0hMSxpPTA7aTxyLmxlbmd0aDtpKyspaWYocltpXS5wb2ludGVySWQ9PT10LnBvaW50ZXJJZCl7ZT0hMDticmVha31lfHxyLnB1c2godCksdC50b3VjaGVzPXIuc2xpY2UoKSx0LmNoYW5nZWRUb3VjaGVzPVt0XSxuKHQpfTtpZih0W2ErInRvdWNoc3RhcnQiK3NdPWgsdC5hZGRFdmVudExpc3RlbmVyKCJNU1BvaW50ZXJEb3duIixoLCExKSwhdGhpcy5fbXNEb2N1bWVudExpc3RlbmVyKXt2YXIgbD1mdW5jdGlvbih0KXtmb3IodmFyIGU9MDtlPHIubGVuZ3RoO2UrKylpZihyW2VdLnBvaW50ZXJJZD09PXQucG9pbnRlcklkKXtyLnNwbGljZShlLDEpO2JyZWFrfX07ZS5kb2N1bWVudEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyVXAiLGwsITEpLGUuZG9jdW1lbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoIk1TUG9pbnRlckNhbmNlbCIsbCwhMSksdGhpcy5fbXNEb2N1bWVudExpc3RlbmVyPSEwfXJldHVybiB0aGlzfSxhZGRNc1RvdWNoTGlzdGVuZXJNb3ZlOmZ1bmN0aW9uKHQsZSxpLG4pe2Z1bmN0aW9uIG8odCl7aWYodC5wb2ludGVyVHlwZSE9PXQuTVNQT0lOVEVSX1RZUEVfTU9VU0V8fDAhPT10LmJ1dHRvbnMpe2Zvcih2YXIgZT0wO2U8YS5sZW5ndGg7ZSsrKWlmKGFbZV0ucG9pbnRlcklkPT09dC5wb2ludGVySWQpe2FbZV09dDticmVha310LnRvdWNoZXM9YS5zbGljZSgpLHQuY2hhbmdlZFRvdWNoZXM9W3RdLGkodCl9fXZhciBzPSJfbGVhZmxldF8iLGE9dGhpcy5fbXNUb3VjaGVzO3JldHVybiB0W3MrInRvdWNobW92ZSIrbl09byx0LmFkZEV2ZW50TGlzdGVuZXIoIk1TUG9pbnRlck1vdmUiLG8sITEpLHRoaXN9LGFkZE1zVG91Y2hMaXN0ZW5lckVuZDpmdW5jdGlvbih0LGUsaSxuKXt2YXIgbz0iX2xlYWZsZXRfIixzPXRoaXMuX21zVG91Y2hlcyxhPWZ1bmN0aW9uKHQpe2Zvcih2YXIgZT0wO2U8cy5sZW5ndGg7ZSsrKWlmKHNbZV0ucG9pbnRlcklkPT09dC5wb2ludGVySWQpe3Muc3BsaWNlKGUsMSk7YnJlYWt9dC50b3VjaGVzPXMuc2xpY2UoKSx0LmNoYW5nZWRUb3VjaGVzPVt0XSxpKHQpfTtyZXR1cm4gdFtvKyJ0b3VjaGVuZCIrbl09YSx0LmFkZEV2ZW50TGlzdGVuZXIoIk1TUG9pbnRlclVwIixhLCExKSx0LmFkZEV2ZW50TGlzdGVuZXIoIk1TUG9pbnRlckNhbmNlbCIsYSwhMSksdGhpc30scmVtb3ZlTXNUb3VjaExpc3RlbmVyOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbj0iX2xlYWZsZXRfIixvPXRbbitlK2ldO3N3aXRjaChlKXtjYXNlInRvdWNoc3RhcnQiOnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyRG93biIsbywhMSk7YnJlYWs7Y2FzZSJ0b3VjaG1vdmUiOnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyTW92ZSIsbywhMSk7YnJlYWs7Y2FzZSJ0b3VjaGVuZCI6dC5yZW1vdmVFdmVudExpc3RlbmVyKCJNU1BvaW50ZXJVcCIsbywhMSksdC5yZW1vdmVFdmVudExpc3RlbmVyKCJNU1BvaW50ZXJDYW5jZWwiLG8sITEpfXJldHVybiB0aGlzfX0pLG8uTWFwLm1lcmdlT3B0aW9ucyh7dG91Y2hab29tOm8uQnJvd3Nlci50b3VjaCYmIW8uQnJvd3Nlci5hbmRyb2lkMjN9KSxvLk1hcC5Ub3VjaFpvb209by5IYW5kbGVyLmV4dGVuZCh7YWRkSG9va3M6ZnVuY3Rpb24oKXtvLkRvbUV2ZW50Lm9uKHRoaXMuX21hcC5fY29udGFpbmVyLCJ0b3VjaHN0YXJ0Iix0aGlzLl9vblRvdWNoU3RhcnQsdGhpcyl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYodGhpcy5fbWFwLl9jb250YWluZXIsInRvdWNoc3RhcnQiLHRoaXMuX29uVG91Y2hTdGFydCx0aGlzKX0sX29uVG91Y2hTdGFydDpmdW5jdGlvbih0KXt2YXIgaT10aGlzLl9tYXA7aWYodC50b3VjaGVzJiYyPT09dC50b3VjaGVzLmxlbmd0aCYmIWkuX2FuaW1hdGluZ1pvb20mJiF0aGlzLl96b29taW5nKXt2YXIgbj1pLm1vdXNlRXZlbnRUb0xheWVyUG9pbnQodC50b3VjaGVzWzBdKSxzPWkubW91c2VFdmVudFRvTGF5ZXJQb2ludCh0LnRvdWNoZXNbMV0pLGE9aS5fZ2V0Q2VudGVyTGF5ZXJQb2ludCgpOwp0aGlzLl9zdGFydENlbnRlcj1uLmFkZChzKS5fZGl2aWRlQnkoMiksdGhpcy5fc3RhcnREaXN0PW4uZGlzdGFuY2VUbyhzKSx0aGlzLl9tb3ZlZD0hMSx0aGlzLl96b29taW5nPSEwLHRoaXMuX2NlbnRlck9mZnNldD1hLnN1YnRyYWN0KHRoaXMuX3N0YXJ0Q2VudGVyKSxpLl9wYW5BbmltJiZpLl9wYW5BbmltLnN0b3AoKSxvLkRvbUV2ZW50Lm9uKGUsInRvdWNobW92ZSIsdGhpcy5fb25Ub3VjaE1vdmUsdGhpcykub24oZSwidG91Y2hlbmQiLHRoaXMuX29uVG91Y2hFbmQsdGhpcyksby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCh0KX19LF9vblRvdWNoTW92ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXA7aWYodC50b3VjaGVzJiYyPT09dC50b3VjaGVzLmxlbmd0aCYmdGhpcy5fem9vbWluZyl7dmFyIGk9ZS5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQudG91Y2hlc1swXSksbj1lLm1vdXNlRXZlbnRUb0xheWVyUG9pbnQodC50b3VjaGVzWzFdKTt0aGlzLl9zY2FsZT1pLmRpc3RhbmNlVG8obikvdGhpcy5fc3RhcnREaXN0LHRoaXMuX2RlbHRhPWkuX2FkZChuKS5fZGl2aWRlQnkoMikuX3N1YnRyYWN0KHRoaXMuX3N0YXJ0Q2VudGVyKSwxIT09dGhpcy5fc2NhbGUmJih0aGlzLl9tb3ZlZHx8KG8uRG9tVXRpbC5hZGRDbGFzcyhlLl9tYXBQYW5lLCJsZWFmbGV0LXRvdWNoaW5nIiksZS5maXJlKCJtb3Zlc3RhcnQiKS5maXJlKCJ6b29tc3RhcnQiKSx0aGlzLl9tb3ZlZD0hMCksby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCksdGhpcy5fYW5pbVJlcXVlc3Q9by5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fdXBkYXRlT25Nb3ZlLHRoaXMsITAsdGhpcy5fbWFwLl9jb250YWluZXIpLG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCkpfX0sX3VwZGF0ZU9uTW92ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPXRoaXMuX2dldFNjYWxlT3JpZ2luKCksaT10LmxheWVyUG9pbnRUb0xhdExuZyhlKSxuPXQuZ2V0U2NhbGVab29tKHRoaXMuX3NjYWxlKTt0Ll9hbmltYXRlWm9vbShpLG4sdGhpcy5fc3RhcnRDZW50ZXIsdGhpcy5fc2NhbGUsdGhpcy5fZGVsdGEpfSxfb25Ub3VjaEVuZDpmdW5jdGlvbigpe2lmKCF0aGlzLl9tb3ZlZHx8IXRoaXMuX3pvb21pbmcpcmV0dXJuIHRoaXMuX3pvb21pbmc9ITEsdm9pZCAwO3ZhciB0PXRoaXMuX21hcDt0aGlzLl96b29taW5nPSExLG8uRG9tVXRpbC5yZW1vdmVDbGFzcyh0Ll9tYXBQYW5lLCJsZWFmbGV0LXRvdWNoaW5nIiksby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCksby5Eb21FdmVudC5vZmYoZSwidG91Y2htb3ZlIix0aGlzLl9vblRvdWNoTW92ZSkub2ZmKGUsInRvdWNoZW5kIix0aGlzLl9vblRvdWNoRW5kKTt2YXIgaT10aGlzLl9nZXRTY2FsZU9yaWdpbigpLG49dC5sYXllclBvaW50VG9MYXRMbmcoaSkscz10LmdldFpvb20oKSxhPXQuZ2V0U2NhbGVab29tKHRoaXMuX3NjYWxlKS1zLHI9YT4wP01hdGguY2VpbChhKTpNYXRoLmZsb29yKGEpLGg9dC5fbGltaXRab29tKHMrciksbD10LmdldFpvb21TY2FsZShoKS90aGlzLl9zY2FsZTt0Ll9hbmltYXRlWm9vbShuLGgsaSxsKX0sX2dldFNjYWxlT3JpZ2luOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fY2VudGVyT2Zmc2V0LnN1YnRyYWN0KHRoaXMuX2RlbHRhKS5kaXZpZGVCeSh0aGlzLl9zY2FsZSk7cmV0dXJuIHRoaXMuX3N0YXJ0Q2VudGVyLmFkZCh0KX19KSxvLk1hcC5hZGRJbml0SG9vaygiYWRkSGFuZGxlciIsInRvdWNoWm9vbSIsby5NYXAuVG91Y2hab29tKSxvLk1hcC5tZXJnZU9wdGlvbnMoe3RhcDohMCx0YXBUb2xlcmFuY2U6MTV9KSxvLk1hcC5UYXA9by5IYW5kbGVyLmV4dGVuZCh7YWRkSG9va3M6ZnVuY3Rpb24oKXtvLkRvbUV2ZW50Lm9uKHRoaXMuX21hcC5fY29udGFpbmVyLCJ0b3VjaHN0YXJ0Iix0aGlzLl9vbkRvd24sdGhpcyl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYodGhpcy5fbWFwLl9jb250YWluZXIsInRvdWNoc3RhcnQiLHRoaXMuX29uRG93bix0aGlzKX0sX29uRG93bjpmdW5jdGlvbih0KXtpZih0LnRvdWNoZXMpe2lmKG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCksdGhpcy5fZmlyZUNsaWNrPSEwLHQudG91Y2hlcy5sZW5ndGg+MSlyZXR1cm4gdGhpcy5fZmlyZUNsaWNrPSExLGNsZWFyVGltZW91dCh0aGlzLl9ob2xkVGltZW91dCksdm9pZCAwO3ZhciBpPXQudG91Y2hlc1swXSxuPWkudGFyZ2V0O3RoaXMuX3N0YXJ0UG9zPXRoaXMuX25ld1Bvcz1uZXcgby5Qb2ludChpLmNsaWVudFgsaS5jbGllbnRZKSxuLnRhZ05hbWUmJiJhIj09PW4udGFnTmFtZS50b0xvd2VyQ2FzZSgpJiZvLkRvbVV0aWwuYWRkQ2xhc3MobiwibGVhZmxldC1hY3RpdmUiKSx0aGlzLl9ob2xkVGltZW91dD1zZXRUaW1lb3V0KG8uYmluZChmdW5jdGlvbigpe3RoaXMuX2lzVGFwVmFsaWQoKSYmKHRoaXMuX2ZpcmVDbGljaz0hMSx0aGlzLl9vblVwKCksdGhpcy5fc2ltdWxhdGVFdmVudCgiY29udGV4dG1lbnUiLGkpKX0sdGhpcyksMWUzKSxvLkRvbUV2ZW50Lm9uKGUsInRvdWNobW92ZSIsdGhpcy5fb25Nb3ZlLHRoaXMpLm9uKGUsInRvdWNoZW5kIix0aGlzLl9vblVwLHRoaXMpfX0sX29uVXA6ZnVuY3Rpb24odCl7aWYoY2xlYXJUaW1lb3V0KHRoaXMuX2hvbGRUaW1lb3V0KSxvLkRvbUV2ZW50Lm9mZihlLCJ0b3VjaG1vdmUiLHRoaXMuX29uTW92ZSx0aGlzKS5vZmYoZSwidG91Y2hlbmQiLHRoaXMuX29uVXAsdGhpcyksdGhpcy5fZmlyZUNsaWNrJiZ0JiZ0LmNoYW5nZWRUb3VjaGVzKXt2YXIgaT10LmNoYW5nZWRUb3VjaGVzWzBdLG49aS50YXJnZXQ7biYmbi50YWdOYW1lJiYiYSI9PT1uLnRhZ05hbWUudG9Mb3dlckNhc2UoKSYmby5Eb21VdGlsLnJlbW92ZUNsYXNzKG4sImxlYWZsZXQtYWN0aXZlIiksdGhpcy5faXNUYXBWYWxpZCgpJiZ0aGlzLl9zaW11bGF0ZUV2ZW50KCJjbGljayIsaSl9fSxfaXNUYXBWYWxpZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9uZXdQb3MuZGlzdGFuY2VUbyh0aGlzLl9zdGFydFBvcyk8PXRoaXMuX21hcC5vcHRpb25zLnRhcFRvbGVyYW5jZX0sX29uTW92ZTpmdW5jdGlvbih0KXt2YXIgZT10LnRvdWNoZXNbMF07dGhpcy5fbmV3UG9zPW5ldyBvLlBvaW50KGUuY2xpZW50WCxlLmNsaWVudFkpfSxfc2ltdWxhdGVFdmVudDpmdW5jdGlvbihpLG4pe3ZhciBvPWUuY3JlYXRlRXZlbnQoIk1vdXNlRXZlbnRzIik7by5fc2ltdWxhdGVkPSEwLG4udGFyZ2V0Ll9zaW11bGF0ZWRDbGljaz0hMCxvLmluaXRNb3VzZUV2ZW50KGksITAsITAsdCwxLG4uc2NyZWVuWCxuLnNjcmVlblksbi5jbGllbnRYLG4uY2xpZW50WSwhMSwhMSwhMSwhMSwwLG51bGwpLG4udGFyZ2V0LmRpc3BhdGNoRXZlbnQobyl9fSksby5Ccm93c2VyLnRvdWNoJiYhby5Ccm93c2VyLm1zVG91Y2gmJm8uTWFwLmFkZEluaXRIb29rKCJhZGRIYW5kbGVyIiwidGFwIixvLk1hcC5UYXApLG8uTWFwLm1lcmdlT3B0aW9ucyh7Ym94Wm9vbTohMH0pLG8uTWFwLkJveFpvb209by5IYW5kbGVyLmV4dGVuZCh7aW5pdGlhbGl6ZTpmdW5jdGlvbih0KXt0aGlzLl9tYXA9dCx0aGlzLl9jb250YWluZXI9dC5fY29udGFpbmVyLHRoaXMuX3BhbmU9dC5fcGFuZXMub3ZlcmxheVBhbmUsdGhpcy5fbW92ZWQ9ITF9LGFkZEhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vbih0aGlzLl9jb250YWluZXIsIm1vdXNlZG93biIsdGhpcy5fb25Nb3VzZURvd24sdGhpcyl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYodGhpcy5fY29udGFpbmVyLCJtb3VzZWRvd24iLHRoaXMuX29uTW91c2VEb3duKSx0aGlzLl9tb3ZlZD0hMX0sbW92ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbW92ZWR9LF9vbk1vdXNlRG93bjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fbW92ZWQ9ITEsIXQuc2hpZnRLZXl8fDEhPT10LndoaWNoJiYxIT09dC5idXR0b24/ITE6KG8uRG9tVXRpbC5kaXNhYmxlVGV4dFNlbGVjdGlvbigpLG8uRG9tVXRpbC5kaXNhYmxlSW1hZ2VEcmFnKCksdGhpcy5fc3RhcnRMYXllclBvaW50PXRoaXMuX21hcC5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQpLHRoaXMuX2JveD1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLCJsZWFmbGV0LXpvb20tYm94Iix0aGlzLl9wYW5lKSxvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fYm94LHRoaXMuX3N0YXJ0TGF5ZXJQb2ludCksdGhpcy5fY29udGFpbmVyLnN0eWxlLmN1cnNvcj0iY3Jvc3NoYWlyIixvLkRvbUV2ZW50Lm9uKGUsIm1vdXNlbW92ZSIsdGhpcy5fb25Nb3VzZU1vdmUsdGhpcykub24oZSwibW91c2V1cCIsdGhpcy5fb25Nb3VzZVVwLHRoaXMpLm9uKGUsImtleWRvd24iLHRoaXMuX29uS2V5RG93bix0aGlzKSx0aGlzLl9tYXAuZmlyZSgiYm94em9vbXN0YXJ0Iiksdm9pZCAwKX0sX29uTW91c2VNb3ZlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX3N0YXJ0TGF5ZXJQb2ludCxpPXRoaXMuX2JveCxuPXRoaXMuX21hcC5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQpLHM9bi5zdWJ0cmFjdChlKSxhPW5ldyBvLlBvaW50KE1hdGgubWluKG4ueCxlLngpLE1hdGgubWluKG4ueSxlLnkpKTtvLkRvbVV0aWwuc2V0UG9zaXRpb24oaSxhKSx0aGlzLl9tb3ZlZD0hMCxpLnN0eWxlLndpZHRoPU1hdGgubWF4KDAsTWF0aC5hYnMocy54KS00KSsicHgiLGkuc3R5bGUuaGVpZ2h0PU1hdGgubWF4KDAsTWF0aC5hYnMocy55KS00KSsicHgifSxfZmluaXNoOmZ1bmN0aW9uKCl7dGhpcy5fcGFuZS5yZW1vdmVDaGlsZCh0aGlzLl9ib3gpLHRoaXMuX2NvbnRhaW5lci5zdHlsZS5jdXJzb3I9IiIsby5Eb21VdGlsLmVuYWJsZVRleHRTZWxlY3Rpb24oKSxvLkRvbVV0aWwuZW5hYmxlSW1hZ2VEcmFnKCksby5Eb21FdmVudC5vZmYoZSwibW91c2Vtb3ZlIix0aGlzLl9vbk1vdXNlTW92ZSkub2ZmKGUsIm1vdXNldXAiLHRoaXMuX29uTW91c2VVcCkub2ZmKGUsImtleWRvd24iLHRoaXMuX29uS2V5RG93bil9LF9vbk1vdXNlVXA6ZnVuY3Rpb24odCl7dGhpcy5fZmluaXNoKCk7dmFyIGU9dGhpcy5fbWFwLGk9ZS5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQpO2lmKCF0aGlzLl9zdGFydExheWVyUG9pbnQuZXF1YWxzKGkpKXt2YXIgbj1uZXcgby5MYXRMbmdCb3VuZHMoZS5sYXllclBvaW50VG9MYXRMbmcodGhpcy5fc3RhcnRMYXllclBvaW50KSxlLmxheWVyUG9pbnRUb0xhdExuZyhpKSk7ZS5maXRCb3VuZHMobiksZS5maXJlKCJib3h6b29tZW5kIix7Ym94Wm9vbUJvdW5kczpufSl9fSxfb25LZXlEb3duOmZ1bmN0aW9uKHQpezI3PT09dC5rZXlDb2RlJiZ0aGlzLl9maW5pc2goKX19KSxvLk1hcC5hZGRJbml0SG9vaygiYWRkSGFuZGxlciIsImJveFpvb20iLG8uTWFwLkJveFpvb20pLG8uTWFwLm1lcmdlT3B0aW9ucyh7a2V5Ym9hcmQ6ITAsa2V5Ym9hcmRQYW5PZmZzZXQ6ODAsa2V5Ym9hcmRab29tT2Zmc2V0OjF9KSxvLk1hcC5LZXlib2FyZD1vLkhhbmRsZXIuZXh0ZW5kKHtrZXlDb2Rlczp7bGVmdDpbMzddLHJpZ2h0OlszOV0sZG93bjpbNDBdLHVwOlszOF0sem9vbUluOlsxODcsMTA3LDYxLDE3MV0sem9vbU91dDpbMTg5LDEwOSwxNzNdfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10LHRoaXMuX3NldFBhbk9mZnNldCh0Lm9wdGlvbnMua2V5Ym9hcmRQYW5PZmZzZXQpLHRoaXMuX3NldFpvb21PZmZzZXQodC5vcHRpb25zLmtleWJvYXJkWm9vbU9mZnNldCl9LGFkZEhvb2tzOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLl9jb250YWluZXI7LTE9PT10LnRhYkluZGV4JiYodC50YWJJbmRleD0iMCIpLG8uRG9tRXZlbnQub24odCwiZm9jdXMiLHRoaXMuX29uRm9jdXMsdGhpcykub24odCwiYmx1ciIsdGhpcy5fb25CbHVyLHRoaXMpLm9uKHQsIm1vdXNlZG93biIsdGhpcy5fb25Nb3VzZURvd24sdGhpcyksdGhpcy5fbWFwLm9uKCJmb2N1cyIsdGhpcy5fYWRkSG9va3MsdGhpcykub24oImJsdXIiLHRoaXMuX3JlbW92ZUhvb2tzLHRoaXMpfSxyZW1vdmVIb29rczpmdW5jdGlvbigpe3RoaXMuX3JlbW92ZUhvb2tzKCk7dmFyIHQ9dGhpcy5fbWFwLl9jb250YWluZXI7by5Eb21FdmVudC5vZmYodCwiZm9jdXMiLHRoaXMuX29uRm9jdXMsdGhpcykub2ZmKHQsImJsdXIiLHRoaXMuX29uQmx1cix0aGlzKS5vZmYodCwibW91c2Vkb3duIix0aGlzLl9vbk1vdXNlRG93bix0aGlzKSx0aGlzLl9tYXAub2ZmKCJmb2N1cyIsdGhpcy5fYWRkSG9va3MsdGhpcykub2ZmKCJibHVyIix0aGlzLl9yZW1vdmVIb29rcyx0aGlzKX0sX29uTW91c2VEb3duOmZ1bmN0aW9uKCl7aWYoIXRoaXMuX2ZvY3VzZWQpe3ZhciBpPWUuYm9keSxuPWUuZG9jdW1lbnRFbGVtZW50LG89aS5zY3JvbGxUb3B8fG4uc2Nyb2xsVG9wLHM9aS5zY3JvbGxMZWZ0fHxuLnNjcm9sbExlZnQ7dGhpcy5fbWFwLl9jb250YWluZXIuZm9jdXMoKSx0LnNjcm9sbFRvKHMsbyl9fSxfb25Gb2N1czpmdW5jdGlvbigpe3RoaXMuX2ZvY3VzZWQ9ITAsdGhpcy5fbWFwLmZpcmUoImZvY3VzIil9LF9vbkJsdXI6ZnVuY3Rpb24oKXt0aGlzLl9mb2N1c2VkPSExLHRoaXMuX21hcC5maXJlKCJibHVyIil9LF9zZXRQYW5PZmZzZXQ6ZnVuY3Rpb24odCl7dmFyIGUsaSxuPXRoaXMuX3BhbktleXM9e30sbz10aGlzLmtleUNvZGVzO2ZvcihlPTAsaT1vLmxlZnQubGVuZ3RoO2k+ZTtlKyspbltvLmxlZnRbZV1dPVstMSp0LDBdO2ZvcihlPTAsaT1vLnJpZ2h0Lmxlbmd0aDtpPmU7ZSsrKW5bby5yaWdodFtlXV09W3QsMF07Zm9yKGU9MCxpPW8uZG93bi5sZW5ndGg7aT5lO2UrKyluW28uZG93bltlXV09WzAsdF07Zm9yKGU9MCxpPW8udXAubGVuZ3RoO2k+ZTtlKyspbltvLnVwW2VdXT1bMCwtMSp0XX0sX3NldFpvb21PZmZzZXQ6ZnVuY3Rpb24odCl7dmFyIGUsaSxuPXRoaXMuX3pvb21LZXlzPXt9LG89dGhpcy5rZXlDb2Rlcztmb3IoZT0wLGk9by56b29tSW4ubGVuZ3RoO2k+ZTtlKyspbltvLnpvb21JbltlXV09dDtmb3IoZT0wLGk9by56b29tT3V0Lmxlbmd0aDtpPmU7ZSsrKW5bby56b29tT3V0W2VdXT0tdH0sX2FkZEhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vbihlLCJrZXlkb3duIix0aGlzLl9vbktleURvd24sdGhpcyl9LF9yZW1vdmVIb29rczpmdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKGUsImtleWRvd24iLHRoaXMuX29uS2V5RG93bix0aGlzKX0sX29uS2V5RG93bjpmdW5jdGlvbih0KXt2YXIgZT10LmtleUNvZGUsaT10aGlzLl9tYXA7aWYoZSBpbiB0aGlzLl9wYW5LZXlzKXtpZihpLl9wYW5BbmltJiZpLl9wYW5BbmltLl9pblByb2dyZXNzKXJldHVybjtpLnBhbkJ5KHRoaXMuX3BhbktleXNbZV0pLGkub3B0aW9ucy5tYXhCb3VuZHMmJmkucGFuSW5zaWRlQm91bmRzKGkub3B0aW9ucy5tYXhCb3VuZHMpfWVsc2V7aWYoIShlIGluIHRoaXMuX3pvb21LZXlzKSlyZXR1cm47aS5zZXRab29tKGkuZ2V0Wm9vbSgpK3RoaXMuX3pvb21LZXlzW2VdKX1vLkRvbUV2ZW50LnN0b3AodCl9fSksby5NYXAuYWRkSW5pdEhvb2soImFkZEhhbmRsZXIiLCJrZXlib2FyZCIsby5NYXAuS2V5Ym9hcmQpLG8uSGFuZGxlci5NYXJrZXJEcmFnPW8uSGFuZGxlci5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCl7dGhpcy5fbWFya2VyPXR9LGFkZEhvb2tzOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFya2VyLl9pY29uO3RoaXMuX2RyYWdnYWJsZXx8KHRoaXMuX2RyYWdnYWJsZT1uZXcgby5EcmFnZ2FibGUodCx0KSksdGhpcy5fZHJhZ2dhYmxlLm9uKCJkcmFnc3RhcnQiLHRoaXMuX29uRHJhZ1N0YXJ0LHRoaXMpLm9uKCJkcmFnIix0aGlzLl9vbkRyYWcsdGhpcykub24oImRyYWdlbmQiLHRoaXMuX29uRHJhZ0VuZCx0aGlzKSx0aGlzLl9kcmFnZ2FibGUuZW5hYmxlKCksby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcmtlci5faWNvbiwibGVhZmxldC1tYXJrZXItZHJhZ2dhYmxlIil9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7dGhpcy5fZHJhZ2dhYmxlLm9mZigiZHJhZ3N0YXJ0Iix0aGlzLl9vbkRyYWdTdGFydCx0aGlzKS5vZmYoImRyYWciLHRoaXMuX29uRHJhZyx0aGlzKS5vZmYoImRyYWdlbmQiLHRoaXMuX29uRHJhZ0VuZCx0aGlzKSx0aGlzLl9kcmFnZ2FibGUuZGlzYWJsZSgpLG8uRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl9tYXJrZXIuX2ljb24sImxlYWZsZXQtbWFya2VyLWRyYWdnYWJsZSIpfSxtb3ZlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kcmFnZ2FibGUmJnRoaXMuX2RyYWdnYWJsZS5fbW92ZWR9LF9vbkRyYWdTdGFydDpmdW5jdGlvbigpe3RoaXMuX21hcmtlci5jbG9zZVBvcHVwKCkuZmlyZSgibW92ZXN0YXJ0IikuZmlyZSgiZHJhZ3N0YXJ0Iiksby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcmtlci5faWNvbiwibGVhZmxldC1tYXJrZXItZHJhZ2dpbmciKX0sX29uRHJhZzpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcmtlcixlPXQuX3NoYWRvdyxpPW8uRG9tVXRpbC5nZXRQb3NpdGlvbih0Ll9pY29uKSxuPXQuX21hcC5sYXllclBvaW50VG9MYXRMbmcoaSk7ZSYmby5Eb21VdGlsLnNldFBvc2l0aW9uKGUsaSksdC5fbGF0bG5nPW4sdC5maXJlKCJtb3ZlIix7bGF0bG5nOm59KS5maXJlKCJkcmFnIil9LF9vbkRyYWdFbmQ6ZnVuY3Rpb24oKXt0aGlzLl9tYXJrZXIuZmlyZSgibW92ZWVuZCIpLmZpcmUoImRyYWdlbmQiKSxvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fbWFya2VyLl9pY29uLCJsZWFmbGV0LW1hcmtlci1kcmFnZ2luZyIpfX0pLG8uQ29udHJvbD1vLkNsYXNzLmV4dGVuZCh7b3B0aW9uczp7cG9zaXRpb246InRvcHJpZ2h0In0saW5pdGlhbGl6ZTpmdW5jdGlvbih0KXtvLnNldE9wdGlvbnModGhpcyx0KX0sZ2V0UG9zaXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLnBvc2l0aW9ufSxzZXRQb3NpdGlvbjpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXA7cmV0dXJuIGUmJmUucmVtb3ZlQ29udHJvbCh0aGlzKSx0aGlzLm9wdGlvbnMucG9zaXRpb249dCxlJiZlLmFkZENvbnRyb2wodGhpcyksdGhpc30sZ2V0Q29udGFpbmVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2NvbnRhaW5lcn0sYWRkVG86ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXQ7dmFyIGU9dGhpcy5fY29udGFpbmVyPXRoaXMub25BZGQodCksaT10aGlzLmdldFBvc2l0aW9uKCksbj10Ll9jb250cm9sQ29ybmVyc1tpXTtyZXR1cm4gby5Eb21VdGlsLmFkZENsYXNzKGUsImxlYWZsZXQtY29udHJvbCIpLC0xIT09aS5pbmRleE9mKCJib3R0b20iKT9uLmluc2VydEJlZm9yZShlLG4uZmlyc3RDaGlsZCk6bi5hcHBlbmRDaGlsZChlKSx0aGlzfSxyZW1vdmVGcm9tOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuZ2V0UG9zaXRpb24oKSxpPXQuX2NvbnRyb2xDb3JuZXJzW2VdO3JldHVybiBpLnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRhaW5lciksdGhpcy5fbWFwPW51bGwsdGhpcy5vblJlbW92ZSYmdGhpcy5vblJlbW92ZSh0KSx0aGlzfX0pLG8uY29udHJvbD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uQ29udHJvbCh0KX0sby5NYXAuaW5jbHVkZSh7YWRkQ29udHJvbDpmdW5jdGlvbih0KXtyZXR1cm4gdC5hZGRUbyh0aGlzKSx0aGlzfSxyZW1vdmVDb250cm9sOmZ1bmN0aW9uKHQpe3JldHVybiB0LnJlbW92ZUZyb20odGhpcyksdGhpc30sX2luaXRDb250cm9sUG9zOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LHMpe3ZhciBhPWkrdCsiICIraStzO2VbdCtzXT1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGEsbil9dmFyIGU9dGhpcy5fY29udHJvbENvcm5lcnM9e30saT0ibGVhZmxldC0iLG49dGhpcy5fY29udHJvbENvbnRhaW5lcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGkrImNvbnRyb2wtY29udGFpbmVyIix0aGlzLl9jb250YWluZXIpO3QoInRvcCIsImxlZnQiKSx0KCJ0b3AiLCJyaWdodCIpLHQoImJvdHRvbSIsImxlZnQiKSx0KCJib3R0b20iLCJyaWdodCIpfSxfY2xlYXJDb250cm9sUG9zOmZ1bmN0aW9uKCl7dGhpcy5fY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRyb2xDb250YWluZXIpfX0pLG8uQ29udHJvbC5ab29tPW8uQ29udHJvbC5leHRlbmQoe29wdGlvbnM6e3Bvc2l0aW9uOiJ0b3BsZWZ0Iix6b29tSW5UZXh0OiIrIix6b29tSW5UaXRsZToiWm9vbSBpbiIsem9vbU91dFRleHQ6Ii0iLHpvb21PdXRUaXRsZToiWm9vbSBvdXQifSxvbkFkZDpmdW5jdGlvbih0KXt2YXIgZT0ibGVhZmxldC1jb250cm9sLXpvb20iLGk9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKyIgbGVhZmxldC1iYXIiKTtyZXR1cm4gdGhpcy5fbWFwPXQsdGhpcy5fem9vbUluQnV0dG9uPXRoaXMuX2NyZWF0ZUJ1dHRvbih0aGlzLm9wdGlvbnMuem9vbUluVGV4dCx0aGlzLm9wdGlvbnMuem9vbUluVGl0bGUsZSsiLWluIixpLHRoaXMuX3pvb21Jbix0aGlzKSx0aGlzLl96b29tT3V0QnV0dG9uPXRoaXMuX2NyZWF0ZUJ1dHRvbih0aGlzLm9wdGlvbnMuem9vbU91dFRleHQsdGhpcy5vcHRpb25zLnpvb21PdXRUaXRsZSxlKyItb3V0IixpLHRoaXMuX3pvb21PdXQsdGhpcyksdC5vbigiem9vbWVuZCB6b29tbGV2ZWxzY2hhbmdlIix0aGlzLl91cGRhdGVEaXNhYmxlZCx0aGlzKSxpfSxvblJlbW92ZTpmdW5jdGlvbih0KXt0Lm9mZigiem9vbWVuZCB6b29tbGV2ZWxzY2hhbmdlIix0aGlzLl91cGRhdGVEaXNhYmxlZCx0aGlzKX0sX3pvb21JbjpmdW5jdGlvbih0KXt0aGlzLl9tYXAuem9vbUluKHQuc2hpZnRLZXk/MzoxKX0sX3pvb21PdXQ6ZnVuY3Rpb24odCl7dGhpcy5fbWFwLnpvb21PdXQodC5zaGlmdEtleT8zOjEpfSxfY3JlYXRlQnV0dG9uOmZ1bmN0aW9uKHQsZSxpLG4scyxhKXt2YXIgcj1vLkRvbVV0aWwuY3JlYXRlKCJhIixpLG4pO3IuaW5uZXJIVE1MPXQsci5ocmVmPSIjIixyLnRpdGxlPWU7dmFyIGg9by5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb247cmV0dXJuIG8uRG9tRXZlbnQub24ociwiY2xpY2siLGgpLm9uKHIsIm1vdXNlZG93biIsaCkub24ociwiZGJsY2xpY2siLGgpLm9uKHIsImNsaWNrIixvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KS5vbihyLCJjbGljayIscyxhKSxyfSxfdXBkYXRlRGlzYWJsZWQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9tYXAsZT0ibGVhZmxldC1kaXNhYmxlZCI7by5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX3pvb21JbkJ1dHRvbixlKSxvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fem9vbU91dEJ1dHRvbixlKSx0Ll96b29tPT09dC5nZXRNaW5ab29tKCkmJm8uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl96b29tT3V0QnV0dG9uLGUpLHQuX3pvb209PT10LmdldE1heFpvb20oKSYmby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX3pvb21JbkJ1dHRvbixlKX19KSxvLk1hcC5tZXJnZU9wdGlvbnMoe3pvb21Db250cm9sOiEwfSksby5NYXAuYWRkSW5pdEhvb2soZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuem9vbUNvbnRyb2wmJih0aGlzLnpvb21Db250cm9sPW5ldyBvLkNvbnRyb2wuWm9vbSx0aGlzLmFkZENvbnRyb2wodGhpcy56b29tQ29udHJvbCkpfSksby5jb250cm9sLnpvb209ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBvLkNvbnRyb2wuWm9vbSh0KX0sby5Db250cm9sLkF0dHJpYnV0aW9uPW8uQ29udHJvbC5leHRlbmQoe29wdGlvbnM6e3Bvc2l0aW9uOiJib3R0b21yaWdodCIscHJlZml4Oic8YSBocmVmPSJodHRwOi8vbGVhZmxldGpzLmNvbSIgdGl0bGU9IkEgSlMgbGlicmFyeSBmb3IgaW50ZXJhY3RpdmUgbWFwcyI+TGVhZmxldDwvYT4nfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQpe28uc2V0T3B0aW9ucyh0aGlzLHQpLHRoaXMuX2F0dHJpYnV0aW9ucz17fX0sb25BZGQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2NvbnRhaW5lcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLCJsZWFmbGV0LWNvbnRyb2wtYXR0cmlidXRpb24iKSxvLkRvbUV2ZW50LmRpc2FibGVDbGlja1Byb3BhZ2F0aW9uKHRoaXMuX2NvbnRhaW5lciksdC5vbigibGF5ZXJhZGQiLHRoaXMuX29uTGF5ZXJBZGQsdGhpcykub24oImxheWVycmVtb3ZlIix0aGlzLl9vbkxheWVyUmVtb3ZlLHRoaXMpLHRoaXMuX3VwZGF0ZSgpLHRoaXMuX2NvbnRhaW5lcn0sb25SZW1vdmU6ZnVuY3Rpb24odCl7dC5vZmYoImxheWVyYWRkIix0aGlzLl9vbkxheWVyQWRkKS5vZmYoImxheWVycmVtb3ZlIix0aGlzLl9vbkxheWVyUmVtb3ZlKX0sc2V0UHJlZml4OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9wdGlvbnMucHJlZml4PXQsdGhpcy5fdXBkYXRlKCksdGhpc30sYWRkQXR0cmlidXRpb246ZnVuY3Rpb24odCl7cmV0dXJuIHQ/KHRoaXMuX2F0dHJpYnV0aW9uc1t0XXx8KHRoaXMuX2F0dHJpYnV0aW9uc1t0XT0wKSx0aGlzLl9hdHRyaWJ1dGlvbnNbdF0rKyx0aGlzLl91cGRhdGUoKSx0aGlzKTp2b2lkIDB9LHJlbW92ZUF0dHJpYnV0aW9uOmZ1bmN0aW9uKHQpe3JldHVybiB0Pyh0aGlzLl9hdHRyaWJ1dGlvbnNbdF0mJih0aGlzLl9hdHRyaWJ1dGlvbnNbdF0tLSx0aGlzLl91cGRhdGUoKSksdGhpcyk6dm9pZCAwfSxfdXBkYXRlOmZ1bmN0aW9uKCl7aWYodGhpcy5fbWFwKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gdGhpcy5fYXR0cmlidXRpb25zKXRoaXMuX2F0dHJpYnV0aW9uc1tlXSYmdC5wdXNoKGUpO3ZhciBpPVtdO3RoaXMub3B0aW9ucy5wcmVmaXgmJmkucHVzaCh0aGlzLm9wdGlvbnMucHJlZml4KSx0Lmxlbmd0aCYmaS5wdXNoKHQuam9pbigiLCAiKSksdGhpcy5fY29udGFpbmVyLmlubmVySFRNTD1pLmpvaW4oIiB8ICIpfX0sX29uTGF5ZXJBZGQ6ZnVuY3Rpb24odCl7dC5sYXllci5nZXRBdHRyaWJ1dGlvbiYmdGhpcy5hZGRBdHRyaWJ1dGlvbih0LmxheWVyLmdldEF0dHJpYnV0aW9uKCkpfSxfb25MYXllclJlbW92ZTpmdW5jdGlvbih0KXt0LmxheWVyLmdldEF0dHJpYnV0aW9uJiZ0aGlzLnJlbW92ZUF0dHJpYnV0aW9uKHQubGF5ZXIuZ2V0QXR0cmlidXRpb24oKSl9fSksby5NYXAubWVyZ2VPcHRpb25zKHthdHRyaWJ1dGlvbkNvbnRyb2w6ITB9KSxvLk1hcC5hZGRJbml0SG9vayhmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5hdHRyaWJ1dGlvbkNvbnRyb2wmJih0aGlzLmF0dHJpYnV0aW9uQ29udHJvbD0obmV3IG8uQ29udHJvbC5BdHRyaWJ1dGlvbikuYWRkVG8odGhpcykpfSksby5jb250cm9sLmF0dHJpYnV0aW9uPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5Db250cm9sLkF0dHJpYnV0aW9uKHQpfSxvLkNvbnRyb2wuU2NhbGU9by5Db250cm9sLmV4dGVuZCh7b3B0aW9uczp7cG9zaXRpb246ImJvdHRvbWxlZnQiLG1heFdpZHRoOjEwMCxtZXRyaWM6ITAsaW1wZXJpYWw6ITAsdXBkYXRlV2hlbklkbGU6ITF9LG9uQWRkOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10O3ZhciBlPSJsZWFmbGV0LWNvbnRyb2wtc2NhbGUiLGk9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKSxuPXRoaXMub3B0aW9ucztyZXR1cm4gdGhpcy5fYWRkU2NhbGVzKG4sZSxpKSx0Lm9uKG4udXBkYXRlV2hlbklkbGU/Im1vdmVlbmQiOiJtb3ZlIix0aGlzLl91cGRhdGUsdGhpcyksdC53aGVuUmVhZHkodGhpcy5fdXBkYXRlLHRoaXMpLGl9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3Qub2ZmKHRoaXMub3B0aW9ucy51cGRhdGVXaGVuSWRsZT8ibW92ZWVuZCI6Im1vdmUiLHRoaXMuX3VwZGF0ZSx0aGlzKX0sX2FkZFNjYWxlczpmdW5jdGlvbih0LGUsaSl7dC5tZXRyaWMmJih0aGlzLl9tU2NhbGU9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKyItbGluZSIsaSkpLHQuaW1wZXJpYWwmJih0aGlzLl9pU2NhbGU9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKyItbGluZSIsaSkpfSxfdXBkYXRlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLmdldEJvdW5kcygpLGU9dC5nZXRDZW50ZXIoKS5sYXQsaT02Mzc4MTM3Kk1hdGguUEkqTWF0aC5jb3MoZSpNYXRoLlBJLzE4MCksbj1pKih0LmdldE5vcnRoRWFzdCgpLmxuZy10LmdldFNvdXRoV2VzdCgpLmxuZykvMTgwLG89dGhpcy5fbWFwLmdldFNpemUoKSxzPXRoaXMub3B0aW9ucyxhPTA7by54PjAmJihhPW4qKHMubWF4V2lkdGgvby54KSksdGhpcy5fdXBkYXRlU2NhbGVzKHMsYSl9LF91cGRhdGVTY2FsZXM6ZnVuY3Rpb24odCxlKXt0Lm1ldHJpYyYmZSYmdGhpcy5fdXBkYXRlTWV0cmljKGUpLHQuaW1wZXJpYWwmJmUmJnRoaXMuX3VwZGF0ZUltcGVyaWFsKGUpfSxfdXBkYXRlTWV0cmljOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2dldFJvdW5kTnVtKHQpO3RoaXMuX21TY2FsZS5zdHlsZS53aWR0aD10aGlzLl9nZXRTY2FsZVdpZHRoKGUvdCkrInB4Iix0aGlzLl9tU2NhbGUuaW5uZXJIVE1MPTFlMz5lP2UrIiBtIjplLzFlMysiIGttIn0sX3VwZGF0ZUltcGVyaWFsOmZ1bmN0aW9uKHQpe3ZhciBlLGksbixvPTMuMjgwODM5OSp0LHM9dGhpcy5faVNjYWxlO28+NTI4MD8oZT1vLzUyODAsaT10aGlzLl9nZXRSb3VuZE51bShlKSxzLnN0eWxlLndpZHRoPXRoaXMuX2dldFNjYWxlV2lkdGgoaS9lKSsicHgiLHMuaW5uZXJIVE1MPWkrIiBtaSIpOihuPXRoaXMuX2dldFJvdW5kTnVtKG8pLHMuc3R5bGUud2lkdGg9dGhpcy5fZ2V0U2NhbGVXaWR0aChuL28pKyJweCIscy5pbm5lckhUTUw9bisiIGZ0Iil9LF9nZXRTY2FsZVdpZHRoOmZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnJvdW5kKHRoaXMub3B0aW9ucy5tYXhXaWR0aCp0KS0xMH0sX2dldFJvdW5kTnVtOmZ1bmN0aW9uKHQpe3ZhciBlPU1hdGgucG93KDEwLChNYXRoLmZsb29yKHQpKyIiKS5sZW5ndGgtMSksaT10L2U7cmV0dXJuIGk9aT49MTA/MTA6aT49NT81Omk+PTM/MzppPj0yPzI6MSxlKml9fSksby5jb250cm9sLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5Db250cm9sLlNjYWxlKHQpfSxvLkNvbnRyb2wuTGF5ZXJzPW8uQ29udHJvbC5leHRlbmQoe29wdGlvbnM6e2NvbGxhcHNlZDohMCxwb3NpdGlvbjoidG9wcmlnaHQiLGF1dG9aSW5kZXg6ITB9LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlLGkpe28uc2V0T3B0aW9ucyh0aGlzLGkpLHRoaXMuX2xheWVycz17fSx0aGlzLl9sYXN0WkluZGV4PTAsdGhpcy5faGFuZGxpbmdDbGljaz0hMTtmb3IodmFyIG4gaW4gdCl0aGlzLl9hZGRMYXllcih0W25dLG4pO2ZvcihuIGluIGUpdGhpcy5fYWRkTGF5ZXIoZVtuXSxuLCEwKX0sb25BZGQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2luaXRMYXlvdXQoKSx0aGlzLl91cGRhdGUoKSx0Lm9uKCJsYXllcmFkZCIsdGhpcy5fb25MYXllckNoYW5nZSx0aGlzKS5vbigibGF5ZXJyZW1vdmUiLHRoaXMuX29uTGF5ZXJDaGFuZ2UsdGhpcyksdGhpcy5fY29udGFpbmVyfSxvblJlbW92ZTpmdW5jdGlvbih0KXt0Lm9mZigibGF5ZXJhZGQiLHRoaXMuX29uTGF5ZXJDaGFuZ2UpLm9mZigibGF5ZXJyZW1vdmUiLHRoaXMuX29uTGF5ZXJDaGFuZ2UpfSxhZGRCYXNlTGF5ZXI6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5fYWRkTGF5ZXIodCxlKSx0aGlzLl91cGRhdGUoKSx0aGlzfSxhZGRPdmVybGF5OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX2FkZExheWVyKHQsZSwhMCksdGhpcy5fdXBkYXRlKCksdGhpc30scmVtb3ZlTGF5ZXI6ZnVuY3Rpb24odCl7dmFyIGU9by5zdGFtcCh0KTtyZXR1cm4gZGVsZXRlIHRoaXMuX2xheWVyc1tlXSx0aGlzLl91cGRhdGUoKSx0aGlzfSxfaW5pdExheW91dDpmdW5jdGlvbigpe3ZhciB0PSJsZWFmbGV0LWNvbnRyb2wtbGF5ZXJzIixlPXRoaXMuX2NvbnRhaW5lcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLHQpO2Uuc2V0QXR0cmlidXRlKCJhcmlhLWhhc3BvcHVwIiwhMCksby5Ccm93c2VyLnRvdWNoP28uRG9tRXZlbnQub24oZSwiY2xpY2siLG8uRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKTooby5Eb21FdmVudC5kaXNhYmxlQ2xpY2tQcm9wYWdhdGlvbihlKSxvLkRvbUV2ZW50Lm9uKGUsIm1vdXNld2hlZWwiLG8uRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKSk7dmFyIGk9dGhpcy5fZm9ybT1vLkRvbVV0aWwuY3JlYXRlKCJmb3JtIix0KyItbGlzdCIpO2lmKHRoaXMub3B0aW9ucy5jb2xsYXBzZWQpe28uQnJvd3Nlci5hbmRyb2lkfHxvLkRvbUV2ZW50Lm9uKGUsIm1vdXNlb3ZlciIsdGhpcy5fZXhwYW5kLHRoaXMpLm9uKGUsIm1vdXNlb3V0Iix0aGlzLl9jb2xsYXBzZSx0aGlzKTt2YXIgbj10aGlzLl9sYXllcnNMaW5rPW8uRG9tVXRpbC5jcmVhdGUoImEiLHQrIi10b2dnbGUiLGUpO24uaHJlZj0iIyIsbi50aXRsZT0iTGF5ZXJzIixvLkJyb3dzZXIudG91Y2g/by5Eb21FdmVudC5vbihuLCJjbGljayIsby5Eb21FdmVudC5zdG9wKS5vbihuLCJjbGljayIsdGhpcy5fZXhwYW5kLHRoaXMpOm8uRG9tRXZlbnQub24obiwiZm9jdXMiLHRoaXMuX2V4cGFuZCx0aGlzKSx0aGlzLl9tYXAub24oImNsaWNrIix0aGlzLl9jb2xsYXBzZSx0aGlzKX1lbHNlIHRoaXMuX2V4cGFuZCgpO3RoaXMuX2Jhc2VMYXllcnNMaXN0PW8uRG9tVXRpbC5jcmVhdGUoImRpdiIsdCsiLWJhc2UiLGkpLHRoaXMuX3NlcGFyYXRvcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLHQrIi1zZXBhcmF0b3IiLGkpLHRoaXMuX292ZXJsYXlzTGlzdD1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLHQrIi1vdmVybGF5cyIsaSksZS5hcHBlbmRDaGlsZChpKX0sX2FkZExheWVyOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbj1vLnN0YW1wKHQpO3RoaXMuX2xheWVyc1tuXT17bGF5ZXI6dCxuYW1lOmUsb3ZlcmxheTppfSx0aGlzLm9wdGlvbnMuYXV0b1pJbmRleCYmdC5zZXRaSW5kZXgmJih0aGlzLl9sYXN0WkluZGV4KyssdC5zZXRaSW5kZXgodGhpcy5fbGFzdFpJbmRleCkpfSxfdXBkYXRlOmZ1bmN0aW9uKCl7aWYodGhpcy5fY29udGFpbmVyKXt0aGlzLl9iYXNlTGF5ZXJzTGlzdC5pbm5lckhUTUw9IiIsdGhpcy5fb3ZlcmxheXNMaXN0LmlubmVySFRNTD0iIjt2YXIgdCxlLGk9ITEsbj0hMTtmb3IodCBpbiB0aGlzLl9sYXllcnMpZT10aGlzLl9sYXllcnNbdF0sdGhpcy5fYWRkSXRlbShlKSxuPW58fGUub3ZlcmxheSxpPWl8fCFlLm92ZXJsYXk7dGhpcy5fc2VwYXJhdG9yLnN0eWxlLmRpc3BsYXk9biYmaT8iIjoibm9uZSJ9fSxfb25MYXllckNoYW5nZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9sYXllcnNbby5zdGFtcCh0LmxheWVyKV07aWYoZSl7dGhpcy5faGFuZGxpbmdDbGlja3x8dGhpcy5fdXBkYXRlKCk7dmFyIGk9ZS5vdmVybGF5PyJsYXllcmFkZCI9PT10LnR5cGU/Im92ZXJsYXlhZGQiOiJvdmVybGF5cmVtb3ZlIjoibGF5ZXJhZGQiPT09dC50eXBlPyJiYXNlbGF5ZXJjaGFuZ2UiOm51bGw7aSYmdGhpcy5fbWFwLmZpcmUoaSxlKX19LF9jcmVhdGVSYWRpb0VsZW1lbnQ6ZnVuY3Rpb24odCxpKXt2YXIgbj0nPGlucHV0IHR5cGU9InJhZGlvIiBjbGFzcz0ibGVhZmxldC1jb250cm9sLWxheWVycy1zZWxlY3RvciIgbmFtZT0iJyt0KyciJztpJiYobis9JyBjaGVja2VkPSJjaGVja2VkIicpLG4rPSIvPiI7dmFyIG89ZS5jcmVhdGVFbGVtZW50KCJkaXYiKTtyZXR1cm4gby5pbm5lckhUTUw9bixvLmZpcnN0Q2hpbGR9LF9hZGRJdGVtOmZ1bmN0aW9uKHQpe3ZhciBpLG49ZS5jcmVhdGVFbGVtZW50KCJsYWJlbCIpLHM9dGhpcy5fbWFwLmhhc0xheWVyKHQubGF5ZXIpO3Qub3ZlcmxheT8oaT1lLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksaS50eXBlPSJjaGVja2JveCIsaS5jbGFzc05hbWU9ImxlYWZsZXQtY29udHJvbC1sYXllcnMtc2VsZWN0b3IiLGkuZGVmYXVsdENoZWNrZWQ9cyk6aT10aGlzLl9jcmVhdGVSYWRpb0VsZW1lbnQoImxlYWZsZXQtYmFzZS1sYXllcnMiLHMpLGkubGF5ZXJJZD1vLnN0YW1wKHQubGF5ZXIpLG8uRG9tRXZlbnQub24oaSwiY2xpY2siLHRoaXMuX29uSW5wdXRDbGljayx0aGlzKTt2YXIgYT1lLmNyZWF0ZUVsZW1lbnQoInNwYW4iKTthLmlubmVySFRNTD0iICIrdC5uYW1lLG4uYXBwZW5kQ2hpbGQoaSksbi5hcHBlbmRDaGlsZChhKTt2YXIgcj10Lm92ZXJsYXk/dGhpcy5fb3ZlcmxheXNMaXN0OnRoaXMuX2Jhc2VMYXllcnNMaXN0O3JldHVybiByLmFwcGVuZENoaWxkKG4pLG59LF9vbklucHV0Q2xpY2s6ZnVuY3Rpb24oKXt2YXIgdCxlLGksbj10aGlzLl9mb3JtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbnB1dCIpLG89bi5sZW5ndGg7Zm9yKHRoaXMuX2hhbmRsaW5nQ2xpY2s9ITAsdD0wO28+dDt0KyspZT1uW3RdLGk9dGhpcy5fbGF5ZXJzW2UubGF5ZXJJZF0sZS5jaGVja2VkJiYhdGhpcy5fbWFwLmhhc0xheWVyKGkubGF5ZXIpP3RoaXMuX21hcC5hZGRMYXllcihpLmxheWVyKTohZS5jaGVja2VkJiZ0aGlzLl9tYXAuaGFzTGF5ZXIoaS5sYXllcikmJnRoaXMuX21hcC5yZW1vdmVMYXllcihpLmxheWVyKTt0aGlzLl9oYW5kbGluZ0NsaWNrPSExfSxfZXhwYW5kOmZ1bmN0aW9uKCl7by5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2NvbnRhaW5lciwibGVhZmxldC1jb250cm9sLWxheWVycy1leHBhbmRlZCIpfSxfY29sbGFwc2U6ZnVuY3Rpb24oKXt0aGlzLl9jb250YWluZXIuY2xhc3NOYW1lPXRoaXMuX2NvbnRhaW5lci5jbGFzc05hbWUucmVwbGFjZSgiIGxlYWZsZXQtY29udHJvbC1sYXllcnMtZXhwYW5kZWQiLCIiKX19KSxvLmNvbnRyb2wubGF5ZXJzPWZ1bmN0aW9uKHQsZSxpKXtyZXR1cm4gbmV3IG8uQ29udHJvbC5MYXllcnModCxlLGkpfSxvLlBvc0FuaW1hdGlvbj1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMscnVuOmZ1bmN0aW9uKHQsZSxpLG4pe3RoaXMuc3RvcCgpLHRoaXMuX2VsPXQsdGhpcy5faW5Qcm9ncmVzcz0hMCx0aGlzLl9uZXdQb3M9ZSx0aGlzLmZpcmUoInN0YXJ0IiksdC5zdHlsZVtvLkRvbVV0aWwuVFJBTlNJVElPTl09ImFsbCAiKyhpfHwuMjUpKyJzIGN1YmljLWJlemllcigwLDAsIisobnx8LjUpKyIsMSkiLG8uRG9tRXZlbnQub24odCxvLkRvbVV0aWwuVFJBTlNJVElPTl9FTkQsdGhpcy5fb25UcmFuc2l0aW9uRW5kLHRoaXMpLG8uRG9tVXRpbC5zZXRQb3NpdGlvbih0LGUpLG8uVXRpbC5mYWxzZUZuKHQub2Zmc2V0V2lkdGgpLHRoaXMuX3N0ZXBUaW1lcj1zZXRJbnRlcnZhbChvLmJpbmQodGhpcy5fb25TdGVwLHRoaXMpLDUwKX0sc3RvcDpmdW5jdGlvbigpe3RoaXMuX2luUHJvZ3Jlc3MmJihvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fZWwsdGhpcy5fZ2V0UG9zKCkpLHRoaXMuX29uVHJhbnNpdGlvbkVuZCgpLG8uVXRpbC5mYWxzZUZuKHRoaXMuX2VsLm9mZnNldFdpZHRoKSl9LF9vblN0ZXA6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9nZXRQb3MoKTtyZXR1cm4gdD8odGhpcy5fZWwuX2xlYWZsZXRfcG9zPXQsdGhpcy5maXJlKCJzdGVwIiksdm9pZCAwKToodGhpcy5fb25UcmFuc2l0aW9uRW5kKCksdm9pZCAwKX0sX3RyYW5zZm9ybVJlOi8oWy0rXT8oPzpcZCpcLik/XGQrKVxEKiwgKFstK10/KD86XGQqXC4pP1xkKylcRCpcKS8sX2dldFBvczpmdW5jdGlvbigpe3ZhciBlLGksbixzPXRoaXMuX2VsLGE9dC5nZXRDb21wdXRlZFN0eWxlKHMpO2lmKG8uQnJvd3Nlci5hbnkzZCl7aWYobj1hW28uRG9tVXRpbC5UUkFOU0ZPUk1dLm1hdGNoKHRoaXMuX3RyYW5zZm9ybVJlKSwhbilyZXR1cm47ZT1wYXJzZUZsb2F0KG5bMV0pLGk9cGFyc2VGbG9hdChuWzJdKX1lbHNlIGU9cGFyc2VGbG9hdChhLmxlZnQpLGk9cGFyc2VGbG9hdChhLnRvcCk7cmV0dXJuIG5ldyBvLlBvaW50KGUsaSwhMCl9LF9vblRyYW5zaXRpb25FbmQ6ZnVuY3Rpb24oKXtvLkRvbUV2ZW50Lm9mZih0aGlzLl9lbCxvLkRvbVV0aWwuVFJBTlNJVElPTl9FTkQsdGhpcy5fb25UcmFuc2l0aW9uRW5kLHRoaXMpLHRoaXMuX2luUHJvZ3Jlc3MmJih0aGlzLl9pblByb2dyZXNzPSExLHRoaXMuX2VsLnN0eWxlW28uRG9tVXRpbC5UUkFOU0lUSU9OXT0iIix0aGlzLl9lbC5fbGVhZmxldF9wb3M9dGhpcy5fbmV3UG9zLGNsZWFySW50ZXJ2YWwodGhpcy5fc3RlcFRpbWVyKSx0aGlzLmZpcmUoInN0ZXAiKS5maXJlKCJlbmQiKSl9fSksby5NYXAuaW5jbHVkZSh7c2V0VmlldzpmdW5jdGlvbih0LGUsbil7aWYoZT1lPT09aT90aGlzLl96b29tOnRoaXMuX2xpbWl0Wm9vbShlKSx0PW8ubGF0TG5nKHQpLG49bnx8e30sdGhpcy5fcGFuQW5pbSYmdGhpcy5fcGFuQW5pbS5zdG9wKCksdGhpcy5fbG9hZGVkJiYhbi5yZXNldCYmbiE9PSEwKXtuLmFuaW1hdGUhPT1pJiYobi56b29tPW8uZXh0ZW5kKHthbmltYXRlOm4uYW5pbWF0ZX0sbi56b29tKSxuLnBhbj1vLmV4dGVuZCh7YW5pbWF0ZTpuLmFuaW1hdGV9LG4ucGFuKSk7dmFyIHM9dGhpcy5fem9vbSE9PWU/dGhpcy5fdHJ5QW5pbWF0ZWRab29tJiZ0aGlzLl90cnlBbmltYXRlZFpvb20odCxlLG4uem9vbSk6dGhpcy5fdHJ5QW5pbWF0ZWRQYW4odCxuLnBhbik7aWYocylyZXR1cm4gY2xlYXJUaW1lb3V0KHRoaXMuX3NpemVUaW1lciksdGhpc31yZXR1cm4gdGhpcy5fcmVzZXRWaWV3KHQsZSksdGhpc30scGFuQnk6ZnVuY3Rpb24odCxlKXtpZih0PW8ucG9pbnQodCkucm91bmQoKSxlPWV8fHt9LCF0LngmJiF0LnkpcmV0dXJuIHRoaXM7aWYodGhpcy5fcGFuQW5pbXx8KHRoaXMuX3BhbkFuaW09bmV3IG8uUG9zQW5pbWF0aW9uLHRoaXMuX3BhbkFuaW0ub24oe3N0ZXA6dGhpcy5fb25QYW5UcmFuc2l0aW9uU3RlcCxlbmQ6dGhpcy5fb25QYW5UcmFuc2l0aW9uRW5kfSx0aGlzKSksZS5ub01vdmVTdGFydHx8dGhpcy5maXJlKCJtb3Zlc3RhcnQiKSxlLmFuaW1hdGUhPT0hMSl7by5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcFBhbmUsImxlYWZsZXQtcGFuLWFuaW0iKTt2YXIgaT10aGlzLl9nZXRNYXBQYW5lUG9zKCkuc3VidHJhY3QodCk7dGhpcy5fcGFuQW5pbS5ydW4odGhpcy5fbWFwUGFuZSxpLGUuZHVyYXRpb258fC4yNSxlLmVhc2VMaW5lYXJpdHkpfWVsc2UgdGhpcy5fcmF3UGFuQnkodCksdGhpcy5maXJlKCJtb3ZlIikuZmlyZSgibW92ZWVuZCIpO3JldHVybiB0aGlzfSxfb25QYW5UcmFuc2l0aW9uU3RlcDpmdW5jdGlvbigpe3RoaXMuZmlyZSgibW92ZSIpfSxfb25QYW5UcmFuc2l0aW9uRW5kOmZ1bmN0aW9uKCl7by5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX21hcFBhbmUsImxlYWZsZXQtcGFuLWFuaW0iKSx0aGlzLmZpcmUoIm1vdmVlbmQiKX0sX3RyeUFuaW1hdGVkUGFuOmZ1bmN0aW9uKHQsZSl7dmFyIGk9dGhpcy5fZ2V0Q2VudGVyT2Zmc2V0KHQpLl9mbG9vcigpO3JldHVybihlJiZlLmFuaW1hdGUpPT09ITB8fHRoaXMuZ2V0U2l6ZSgpLmNvbnRhaW5zKGkpPyh0aGlzLnBhbkJ5KGksZSksITApOiExfX0pLG8uUG9zQW5pbWF0aW9uPW8uRG9tVXRpbC5UUkFOU0lUSU9OP28uUG9zQW5pbWF0aW9uOm8uUG9zQW5pbWF0aW9uLmV4dGVuZCh7cnVuOmZ1bmN0aW9uKHQsZSxpLG4pe3RoaXMuc3RvcCgpLHRoaXMuX2VsPXQsdGhpcy5faW5Qcm9ncmVzcz0hMCx0aGlzLl9kdXJhdGlvbj1pfHwuMjUsdGhpcy5fZWFzZU91dFBvd2VyPTEvTWF0aC5tYXgobnx8LjUsLjIpLHRoaXMuX3N0YXJ0UG9zPW8uRG9tVXRpbC5nZXRQb3NpdGlvbih0KSx0aGlzLl9vZmZzZXQ9ZS5zdWJ0cmFjdCh0aGlzLl9zdGFydFBvcyksdGhpcy5fc3RhcnRUaW1lPStuZXcgRGF0ZSx0aGlzLmZpcmUoInN0YXJ0IiksdGhpcy5fYW5pbWF0ZSgpfSxzdG9wOmZ1bmN0aW9uKCl7dGhpcy5faW5Qcm9ncmVzcyYmKHRoaXMuX3N0ZXAoKSx0aGlzLl9jb21wbGV0ZSgpKX0sX2FuaW1hdGU6ZnVuY3Rpb24oKXt0aGlzLl9hbmltSWQ9by5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fYW5pbWF0ZSx0aGlzKSx0aGlzLl9zdGVwKCl9LF9zdGVwOmZ1bmN0aW9uKCl7dmFyIHQ9K25ldyBEYXRlLXRoaXMuX3N0YXJ0VGltZSxlPTFlMyp0aGlzLl9kdXJhdGlvbjtlPnQ/dGhpcy5fcnVuRnJhbWUodGhpcy5fZWFzZU91dCh0L2UpKToodGhpcy5fcnVuRnJhbWUoMSksdGhpcy5fY29tcGxldGUoKSl9LF9ydW5GcmFtZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9zdGFydFBvcy5hZGQodGhpcy5fb2Zmc2V0Lm11bHRpcGx5QnkodCkpO28uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9lbCxlKSx0aGlzLmZpcmUoInN0ZXAiKX0sX2NvbXBsZXRlOmZ1bmN0aW9uKCl7by5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltSWQpLHRoaXMuX2luUHJvZ3Jlc3M9ITEsdGhpcy5maXJlKCJlbmQiKX0sX2Vhc2VPdXQ6ZnVuY3Rpb24odCl7cmV0dXJuIDEtTWF0aC5wb3coMS10LHRoaXMuX2Vhc2VPdXRQb3dlcil9fSksby5NYXAubWVyZ2VPcHRpb25zKHt6b29tQW5pbWF0aW9uOiEwLHpvb21BbmltYXRpb25UaHJlc2hvbGQ6NH0pLG8uRG9tVXRpbC5UUkFOU0lUSU9OJiZvLk1hcC5hZGRJbml0SG9vayhmdW5jdGlvbigpe3RoaXMuX3pvb21BbmltYXRlZD10aGlzLm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5Eb21VdGlsLlRSQU5TSVRJT04mJm8uQnJvd3Nlci5hbnkzZCYmIW8uQnJvd3Nlci5hbmRyb2lkMjMmJiFvLkJyb3dzZXIubW9iaWxlT3BlcmEsdGhpcy5fem9vbUFuaW1hdGVkJiZvLkRvbUV2ZW50Lm9uKHRoaXMuX21hcFBhbmUsby5Eb21VdGlsLlRSQU5TSVRJT05fRU5ELHRoaXMuX2NhdGNoVHJhbnNpdGlvbkVuZCx0aGlzKX0pLG8uTWFwLmluY2x1ZGUoby5Eb21VdGlsLlRSQU5TSVRJT04/e19jYXRjaFRyYW5zaXRpb25FbmQ6ZnVuY3Rpb24oKXt0aGlzLl9hbmltYXRpbmdab29tJiZ0aGlzLl9vblpvb21UcmFuc2l0aW9uRW5kKCl9LF9ub3RoaW5nVG9BbmltYXRlOmZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMuX2NvbnRhaW5lci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJsZWFmbGV0LXpvb20tYW5pbWF0ZWQiKS5sZW5ndGh9LF90cnlBbmltYXRlZFpvb206ZnVuY3Rpb24odCxlLGkpe2lmKHRoaXMuX2FuaW1hdGluZ1pvb20pcmV0dXJuITA7aWYoaT1pfHx7fSwhdGhpcy5fem9vbUFuaW1hdGVkfHxpLmFuaW1hdGU9PT0hMXx8dGhpcy5fbm90aGluZ1RvQW5pbWF0ZSgpfHxNYXRoLmFicyhlLXRoaXMuX3pvb20pPnRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uVGhyZXNob2xkKXJldHVybiExO3ZhciBuPXRoaXMuZ2V0Wm9vbVNjYWxlKGUpLG89dGhpcy5fZ2V0Q2VudGVyT2Zmc2V0KHQpLl9kaXZpZGVCeSgxLTEvbikscz10aGlzLl9nZXRDZW50ZXJMYXllclBvaW50KCkuX2FkZChvKTtyZXR1cm4gaS5hbmltYXRlPT09ITB8fHRoaXMuZ2V0U2l6ZSgpLmNvbnRhaW5zKG8pPyh0aGlzLmZpcmUoIm1vdmVzdGFydCIpLmZpcmUoInpvb21zdGFydCIpLHRoaXMuX2FuaW1hdGVab29tKHQsZSxzLG4sbnVsbCwhMCksITApOiExfSxfYW5pbWF0ZVpvb206ZnVuY3Rpb24odCxlLGksbixzLGEpe3RoaXMuX2FuaW1hdGluZ1pvb209ITAsby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcFBhbmUsImxlYWZsZXQtem9vbS1hbmltIiksdGhpcy5fYW5pbWF0ZVRvQ2VudGVyPXQsdGhpcy5fYW5pbWF0ZVRvWm9vbT1lLG8uRHJhZ2dhYmxlJiYoby5EcmFnZ2FibGUuX2Rpc2FibGVkPSEwKSx0aGlzLmZpcmUoInpvb21hbmltIix7Y2VudGVyOnQsem9vbTplLG9yaWdpbjppLHNjYWxlOm4sZGVsdGE6cyxiYWNrd2FyZHM6YX0pfSxfb25ab29tVHJhbnNpdGlvbkVuZDpmdW5jdGlvbigpe3RoaXMuX2FuaW1hdGluZ1pvb209ITEsby5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX21hcFBhbmUsImxlYWZsZXQtem9vbS1hbmltIiksdGhpcy5fcmVzZXRWaWV3KHRoaXMuX2FuaW1hdGVUb0NlbnRlcix0aGlzLl9hbmltYXRlVG9ab29tLCEwLCEwKSxvLkRyYWdnYWJsZSYmKG8uRHJhZ2dhYmxlLl9kaXNhYmxlZD0hMSl9fTp7fSksby5UaWxlTGF5ZXIuaW5jbHVkZSh7X2FuaW1hdGVab29tOmZ1bmN0aW9uKHQpe3RoaXMuX2FuaW1hdGluZ3x8KHRoaXMuX2FuaW1hdGluZz0hMCx0aGlzLl9wcmVwYXJlQmdCdWZmZXIoKSk7dmFyIGU9dGhpcy5fYmdCdWZmZXIsaT1vLkRvbVV0aWwuVFJBTlNGT1JNLG49dC5kZWx0YT9vLkRvbVV0aWwuZ2V0VHJhbnNsYXRlU3RyaW5nKHQuZGVsdGEpOmUuc3R5bGVbaV0scz1vLkRvbVV0aWwuZ2V0U2NhbGVTdHJpbmcodC5zY2FsZSx0Lm9yaWdpbik7ZS5zdHlsZVtpXT10LmJhY2t3YXJkcz9zKyIgIituOm4rIiAiK3N9LF9lbmRab29tQW5pbTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3RpbGVDb250YWluZXIsZT10aGlzLl9iZ0J1ZmZlcjt0LnN0eWxlLnZpc2liaWxpdHk9IiIsdC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKHQpLG8uVXRpbC5mYWxzZUZuKGUub2Zmc2V0V2lkdGgpLHRoaXMuX2FuaW1hdGluZz0hMX0sX2NsZWFyQmdCdWZmZXI6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9tYXA7IXR8fHQuX2FuaW1hdGluZ1pvb218fHQudG91Y2hab29tLl96b29taW5nfHwodGhpcy5fYmdCdWZmZXIuaW5uZXJIVE1MPSIiLHRoaXMuX2JnQnVmZmVyLnN0eWxlW28uRG9tVXRpbC5UUkFOU0ZPUk1dPSIiKX0sX3ByZXBhcmVCZ0J1ZmZlcjpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3RpbGVDb250YWluZXIsZT10aGlzLl9iZ0J1ZmZlcixpPXRoaXMuX2dldExvYWRlZFRpbGVzUGVyY2VudGFnZShlKSxuPXRoaXMuX2dldExvYWRlZFRpbGVzUGVyY2VudGFnZSh0KTtyZXR1cm4gZSYmaT4uNSYmLjU+bj8odC5zdHlsZS52aXNpYmlsaXR5PSJoaWRkZW4iLHRoaXMuX3N0b3BMb2FkaW5nSW1hZ2VzKHQpLHZvaWQgMCk6KGUuc3R5bGUudmlzaWJpbGl0eT0iaGlkZGVuIixlLnN0eWxlW28uRG9tVXRpbC5UUkFOU0ZPUk1dPSIiLHRoaXMuX3RpbGVDb250YWluZXI9ZSxlPXRoaXMuX2JnQnVmZmVyPXQsdGhpcy5fc3RvcExvYWRpbmdJbWFnZXMoZSksY2xlYXJUaW1lb3V0KHRoaXMuX2NsZWFyQmdCdWZmZXJUaW1lciksdm9pZCAwKX0sX2dldExvYWRlZFRpbGVzUGVyY2VudGFnZTpmdW5jdGlvbih0KXt2YXIgZSxpLG49dC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIiksbz0wO2ZvcihlPTAsaT1uLmxlbmd0aDtpPmU7ZSsrKW5bZV0uY29tcGxldGUmJm8rKztyZXR1cm4gby9pfSxfc3RvcExvYWRpbmdJbWFnZXM6ZnVuY3Rpb24odCl7dmFyIGUsaSxuLHM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIikpO2ZvcihlPTAsaT1zLmxlbmd0aDtpPmU7ZSsrKW49c1tlXSxuLmNvbXBsZXRlfHwobi5vbmxvYWQ9by5VdGlsLmZhbHNlRm4sbi5vbmVycm9yPW8uVXRpbC5mYWxzZUZuLG4uc3JjPW8uVXRpbC5lbXB0eUltYWdlVXJsLG4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKSl9fSksby5NYXAuaW5jbHVkZSh7X2RlZmF1bHRMb2NhdGVPcHRpb25zOnt3YXRjaDohMSxzZXRWaWV3OiExLG1heFpvb206MS8wLHRpbWVvdXQ6MWU0LG1heGltdW1BZ2U6MCxlbmFibGVIaWdoQWNjdXJhY3k6ITF9LGxvY2F0ZTpmdW5jdGlvbih0KXtpZih0PXRoaXMuX2xvY2F0ZU9wdGlvbnM9by5leHRlbmQodGhpcy5fZGVmYXVsdExvY2F0ZU9wdGlvbnMsdCksIW5hdmlnYXRvci5nZW9sb2NhdGlvbilyZXR1cm4gdGhpcy5faGFuZGxlR2VvbG9jYXRpb25FcnJvcih7Y29kZTowLG1lc3NhZ2U6Ikdlb2xvY2F0aW9uIG5vdCBzdXBwb3J0ZWQuIn0pLHRoaXM7dmFyIGU9by5iaW5kKHRoaXMuX2hhbmRsZUdlb2xvY2F0aW9uUmVzcG9uc2UsdGhpcyksaT1vLmJpbmQodGhpcy5faGFuZGxlR2VvbG9jYXRpb25FcnJvcix0aGlzKTtyZXR1cm4gdC53YXRjaD90aGlzLl9sb2NhdGlvbldhdGNoSWQ9bmF2aWdhdG9yLmdlb2xvY2F0aW9uLndhdGNoUG9zaXRpb24oZSxpLHQpOm5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oZSxpLHQpLHRoaXN9LHN0b3BMb2NhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gbmF2aWdhdG9yLmdlb2xvY2F0aW9uJiZuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uY2xlYXJXYXRjaCh0aGlzLl9sb2NhdGlvbldhdGNoSWQpLHRoaXMuX2xvY2F0ZU9wdGlvbnMmJih0aGlzLl9sb2NhdGVPcHRpb25zLnNldFZpZXc9ITEpLHRoaXN9LF9oYW5kbGVHZW9sb2NhdGlvbkVycm9yOmZ1bmN0aW9uKHQpe3ZhciBlPXQuY29kZSxpPXQubWVzc2FnZXx8KDE9PT1lPyJwZXJtaXNzaW9uIGRlbmllZCI6Mj09PWU/InBvc2l0aW9uIHVuYXZhaWxhYmxlIjoidGltZW91dCIpO3RoaXMuX2xvY2F0ZU9wdGlvbnMuc2V0VmlldyYmIXRoaXMuX2xvYWRlZCYmdGhpcy5maXRXb3JsZCgpLHRoaXMuZmlyZSgibG9jYXRpb25lcnJvciIse2NvZGU6ZSxtZXNzYWdlOiJHZW9sb2NhdGlvbiBlcnJvcjogIitpKyIuIn0pfSxfaGFuZGxlR2VvbG9jYXRpb25SZXNwb25zZTpmdW5jdGlvbih0KXt2YXIgZT10LmNvb3Jkcy5sYXRpdHVkZSxpPXQuY29vcmRzLmxvbmdpdHVkZSxuPW5ldyBvLkxhdExuZyhlLGkpLHM9MTgwKnQuY29vcmRzLmFjY3VyYWN5LzQwMDc1MDE3LGE9cy9NYXRoLmNvcyhvLkxhdExuZy5ERUdfVE9fUkFEKmUpLHI9by5sYXRMbmdCb3VuZHMoW2UtcyxpLWFdLFtlK3MsaSthXSksaD10aGlzLl9sb2NhdGVPcHRpb25zO2lmKGguc2V0Vmlldyl7dmFyIGw9TWF0aC5taW4odGhpcy5nZXRCb3VuZHNab29tKHIpLGgubWF4Wm9vbSk7dGhpcy5zZXRWaWV3KG4sbCl9dmFyIHU9e2xhdGxuZzpuLGJvdW5kczpyfTtmb3IodmFyIGMgaW4gdC5jb29yZHMpIm51bWJlciI9PXR5cGVvZiB0LmNvb3Jkc1tjXSYmKHVbY109dC5jb29yZHNbY10pO3RoaXMuZmlyZSgibG9jYXRpb25mb3VuZCIsdSl9fSl9KHdpbmRvdyxkb2N1bWVudCk7Ci8vIFdlIGRvbid0IHVzZSB0aGUgcGxhdGZvcm0gYm9vdHN0cmFwcGVyLCBzbyBmYWtlIHRoaXMgc3R1ZmYuCgp3aW5kb3cuUGxhdGZvcm0gPSB7fTsKdmFyIGxvZ0ZsYWdzID0ge307CgoKCi8vIERPTVRva2VuTGlzdCBwb2x5ZmlsbCBmaXIgSUU5CihmdW5jdGlvbiAoKSB7CgppZiAodHlwZW9mIHdpbmRvdy5FbGVtZW50ID09PSAidW5kZWZpbmVkIiB8fCAiY2xhc3NMaXN0IiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHJldHVybjsKCnZhciBwcm90b3R5cGUgPSBBcnJheS5wcm90b3R5cGUsCiAgICBpbmRleE9mID0gcHJvdG90eXBlLmluZGV4T2YsCiAgICBzbGljZSA9IHByb3RvdHlwZS5zbGljZSwKICAgIHB1c2ggPSBwcm90b3R5cGUucHVzaCwKICAgIHNwbGljZSA9IHByb3RvdHlwZS5zcGxpY2UsCiAgICBqb2luID0gcHJvdG90eXBlLmpvaW47CgpmdW5jdGlvbiBET01Ub2tlbkxpc3QoZWwpIHsKICB0aGlzLl9lbGVtZW50ID0gZWw7CiAgaWYgKGVsLmNsYXNzTmFtZSAhPSB0aGlzLl9jbGFzc0NhY2hlKSB7CiAgICB0aGlzLl9jbGFzc0NhY2hlID0gZWwuY2xhc3NOYW1lOwoKICAgIGlmICghdGhpcy5fY2xhc3NDYWNoZSkgcmV0dXJuOwoKICAgICAgLy8gVGhlIGNsYXNzTmFtZSBuZWVkcyB0byBiZSB0cmltbWVkIGFuZCBzcGxpdCBvbiB3aGl0ZXNwYWNlCiAgICAgIC8vIHRvIHJldHJpZXZlIGEgbGlzdCBvZiBjbGFzc2VzLgogICAgICB2YXIgY2xhc3NlcyA9IHRoaXMuX2NsYXNzQ2FjaGUucmVwbGFjZSgvXlxzK3xccyskL2csJycpLnNwbGl0KC9ccysvKSwKICAgICAgICBpOwogICAgZm9yIChpID0gMDsgaSA8IGNsYXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgcHVzaC5jYWxsKHRoaXMsIGNsYXNzZXNbaV0pOwogICAgfQogIH0KfTsKCmZ1bmN0aW9uIHNldFRvQ2xhc3NOYW1lKGVsLCBjbGFzc2VzKSB7CiAgZWwuY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKCcgJyk7Cn0KCkRPTVRva2VuTGlzdC5wcm90b3R5cGUgPSB7CiAgYWRkOiBmdW5jdGlvbih0b2tlbikgewogICAgaWYodGhpcy5jb250YWlucyh0b2tlbikpIHJldHVybjsKICAgIHB1c2guY2FsbCh0aGlzLCB0b2tlbik7CiAgICBzZXRUb0NsYXNzTmFtZSh0aGlzLl9lbGVtZW50LCBzbGljZS5jYWxsKHRoaXMsIDApKTsKICB9LAogIGNvbnRhaW5zOiBmdW5jdGlvbih0b2tlbikgewogICAgcmV0dXJuIGluZGV4T2YuY2FsbCh0aGlzLCB0b2tlbikgIT09IC0xOwogIH0sCiAgaXRlbTogZnVuY3Rpb24oaW5kZXgpIHsKICAgIHJldHVybiB0aGlzW2luZGV4XSB8fCBudWxsOwogIH0sCiAgcmVtb3ZlOiBmdW5jdGlvbih0b2tlbikgewogICAgdmFyIGkgPSBpbmRleE9mLmNhbGwodGhpcywgdG9rZW4pOwogICAgIGlmIChpID09PSAtMSkgewogICAgICAgcmV0dXJuOwogICAgIH0KICAgIHNwbGljZS5jYWxsKHRoaXMsIGksIDEpOwogICAgc2V0VG9DbGFzc05hbWUodGhpcy5fZWxlbWVudCwgc2xpY2UuY2FsbCh0aGlzLCAwKSk7CiAgfSwKICB0b1N0cmluZzogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gam9pbi5jYWxsKHRoaXMsICcgJyk7CiAgfSwKICB0b2dnbGU6IGZ1bmN0aW9uKHRva2VuKSB7CiAgICBpZiAoaW5kZXhPZi5jYWxsKHRoaXMsIHRva2VuKSA9PT0gLTEpIHsKICAgICAgdGhpcy5hZGQodG9rZW4pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5yZW1vdmUodG9rZW4pOwogICAgfQogIH0KfTsKCndpbmRvdy5ET01Ub2tlbkxpc3QgPSBET01Ub2tlbkxpc3Q7CgpmdW5jdGlvbiBkZWZpbmVFbGVtZW50R2V0dGVyIChvYmosIHByb3AsIGdldHRlcikgewogIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIHByb3AsewogICAgICBnZXQgOiBnZXR0ZXIKICAgIH0pCiAgfSBlbHNlIHsKICAgIG9iai5fX2RlZmluZUdldHRlcl9fKHByb3AsIGdldHRlcik7CiAgfQp9CgpkZWZpbmVFbGVtZW50R2V0dGVyKEVsZW1lbnQucHJvdG90eXBlLCAnY2xhc3NMaXN0JywgZnVuY3Rpb24gKCkgewogIHJldHVybiBuZXcgRE9NVG9rZW5MaXN0KHRoaXMpOwp9KTsKCn0pKCk7CgoKLyoKICogQ29weXJpZ2h0IDIwMTIgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJlbmVkIGJ5IGEgQlNELXN0eWxlCiAqIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS4KICovCgovLyBTaWRlVGFibGUgaXMgYSB3ZWFrIG1hcCB3aGVyZSBwb3NzaWJsZS4gSWYgV2Vha01hcCBpcyBub3QgYXZhaWxhYmxlIHRoZQovLyBhc3NvY2lhdGlvbiBpcyBzdG9yZWQgYXMgYW4gZXhwYW5kbyBwcm9wZXJ0eS4KdmFyIFNpZGVUYWJsZTsKLy8gVE9ETyhhcnYpOiBXZWFrTWFwIGRvZXMgbm90IGFsbG93IGZvciBOb2RlIGV0YyB0byBiZSBrZXlzIGluIEZpcmVmb3gKaWYgKHR5cGVvZiBXZWFrTWFwICE9PSAndW5kZWZpbmVkJyAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0ZpcmVmb3gvJykgPCAwKSB7CiAgU2lkZVRhYmxlID0gV2Vha01hcDsKfSBlbHNlIHsKICAoZnVuY3Rpb24oKSB7CiAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgICB2YXIgY291bnRlciA9IERhdGUubm93KCkgJSAxZTk7CgogICAgU2lkZVRhYmxlID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubmFtZSA9ICdfX3N0JyArIChNYXRoLnJhbmRvbSgpICogMWU5ID4+PiAwKSArIChjb3VudGVyKysgKyAnX18nKTsKICAgIH07CgogICAgU2lkZVRhYmxlLnByb3RvdHlwZSA9IHsKICAgICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgdmFyIGVudHJ5ID0ga2V5W3RoaXMubmFtZV07CiAgICAgICAgaWYgKGVudHJ5ICYmIGVudHJ5WzBdID09PSBrZXkpCiAgICAgICAgICBlbnRyeVsxXSA9IHZhbHVlOwogICAgICAgIGVsc2UKICAgICAgICAgIGRlZmluZVByb3BlcnR5KGtleSwgdGhpcy5uYW1lLCB7dmFsdWU6IFtrZXksIHZhbHVlXSwgd3JpdGFibGU6IHRydWV9KTsKICAgICAgfSwKICAgICAgZ2V0OiBmdW5jdGlvbihrZXkpIHsKICAgICAgICB2YXIgZW50cnk7CiAgICAgICAgcmV0dXJuIChlbnRyeSA9IGtleVt0aGlzLm5hbWVdKSAmJiBlbnRyeVswXSA9PT0ga2V5ID8KICAgICAgICAgICAgZW50cnlbMV0gOiB1bmRlZmluZWQ7CiAgICAgIH0sCiAgICAgIGRlbGV0ZTogZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgdGhpcy5zZXQoa2V5LCB1bmRlZmluZWQpOwogICAgICB9CiAgICB9CiAgfSkoKTsKfQoKLyoKICogQ29weXJpZ2h0IDIwMTIgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJlbmVkIGJ5IGEgQlNELXN0eWxlCiAqIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS4KICovCgooZnVuY3Rpb24oZ2xvYmFsKSB7CgogIHZhciByZWdpc3RyYXRpb25zVGFibGUgPSBuZXcgU2lkZVRhYmxlKCk7CgogIC8vIFdlIHVzZSBzZXRJbW1lZGlhdGUgb3IgcG9zdE1lc3NhZ2UgZm9yIG91ciBmdXR1cmUgY2FsbGJhY2suCiAgdmFyIHNldEltbWVkaWF0ZSA9IHdpbmRvdy5tc1NldEltbWVkaWF0ZTsKCiAgLy8gVXNlIHBvc3QgbWVzc2FnZSB0byBlbXVsYXRlIHNldEltbWVkaWF0ZS4KICBpZiAoIXNldEltbWVkaWF0ZSkgewogICAgdmFyIHNldEltbWVkaWF0ZVF1ZXVlID0gW107CiAgICB2YXIgc2VudGluZWwgPSBTdHJpbmcoTWF0aC5yYW5kb20oKSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKGUuZGF0YSA9PT0gc2VudGluZWwpIHsKICAgICAgICB2YXIgcXVldWUgPSBzZXRJbW1lZGlhdGVRdWV1ZTsKICAgICAgICBzZXRJbW1lZGlhdGVRdWV1ZSA9IFtdOwogICAgICAgIHF1ZXVlLmZvckVhY2goZnVuY3Rpb24oZnVuYykgewogICAgICAgICAgZnVuYygpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIHNldEltbWVkaWF0ZSA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgICAgc2V0SW1tZWRpYXRlUXVldWUucHVzaChmdW5jKTsKICAgICAgd2luZG93LnBvc3RNZXNzYWdlKHNlbnRpbmVsLCAnKicpOwogICAgfTsKICB9CgogIC8vIFRoaXMgaXMgdXNlZCB0byBlbnN1cmUgdGhhdCB3ZSBuZXZlciBzY2hlZHVsZSAyIGNhbGxhcyB0byBzZXRJbW1lZGlhdGUKICB2YXIgaXNTY2hlZHVsZWQgPSBmYWxzZTsKCiAgLy8gS2VlcCB0cmFjayBvZiBvYnNlcnZlcnMgdGhhdCBuZWVkcyB0byBiZSBub3RpZmllZCBuZXh0IHRpbWUuCiAgdmFyIHNjaGVkdWxlZE9ic2VydmVycyA9IFtdOwoKICAvKioKICAgKiBTY2hlZHVsZXMgfGRpc3BhdGNoQ2FsbGJhY2t8IHRvIGJlIGNhbGxlZCBpbiB0aGUgZnV0dXJlLgogICAqIEBwYXJhbSB7TXV0YXRpb25PYnNlcnZlcn0gb2JzZXJ2ZXIKICAgKi8KICBmdW5jdGlvbiBzY2hlZHVsZUNhbGxiYWNrKG9ic2VydmVyKSB7CiAgICBzY2hlZHVsZWRPYnNlcnZlcnMucHVzaChvYnNlcnZlcik7CiAgICBpZiAoIWlzU2NoZWR1bGVkKSB7CiAgICAgIGlzU2NoZWR1bGVkID0gdHJ1ZTsKICAgICAgc2V0SW1tZWRpYXRlKGRpc3BhdGNoQ2FsbGJhY2tzKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHdyYXBJZk5lZWRlZChub2RlKSB7CiAgICByZXR1cm4gd2luZG93LlNoYWRvd0RPTVBvbHlmaWxsICYmCiAgICAgICAgd2luZG93LlNoYWRvd0RPTVBvbHlmaWxsLndyYXBJZk5lZWRlZChub2RlKSB8fAogICAgICAgIG5vZGU7CiAgfQoKICBmdW5jdGlvbiBkaXNwYXRjaENhbGxiYWNrcygpIHsKICAgIC8vIGh0dHA6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNtdXRhdGlvbi1vYnNlcnZlcnMKCiAgICBpc1NjaGVkdWxlZCA9IGZhbHNlOyAvLyBVc2VkIHRvIGFsbG93IGEgbmV3IHNldEltbWVkaWF0ZSBjYWxsIGFib3ZlLgoKICAgIHZhciBvYnNlcnZlcnMgPSBzY2hlZHVsZWRPYnNlcnZlcnM7CiAgICBzY2hlZHVsZWRPYnNlcnZlcnMgPSBbXTsKICAgIC8vIFNvcnQgb2JzZXJ2ZXJzIGJhc2VkIG9uIHRoZWlyIGNyZWF0aW9uIFVJRCAoaW5jcmVtZW50YWwpLgogICAgb2JzZXJ2ZXJzLnNvcnQoZnVuY3Rpb24obzEsIG8yKSB7CiAgICAgIHJldHVybiBvMS51aWRfIC0gbzIudWlkXzsKICAgIH0pOwoKICAgIHZhciBhbnlOb25FbXB0eSA9IGZhbHNlOwogICAgb2JzZXJ2ZXJzLmZvckVhY2goZnVuY3Rpb24ob2JzZXJ2ZXIpIHsKCiAgICAgIC8vIDIuMSwgMi4yCiAgICAgIHZhciBxdWV1ZSA9IG9ic2VydmVyLnRha2VSZWNvcmRzKCk7CiAgICAgIC8vIDIuMy4gUmVtb3ZlIGFsbCB0cmFuc2llbnQgcmVnaXN0ZXJlZCBvYnNlcnZlcnMgd2hvc2Ugb2JzZXJ2ZXIgaXMgbW8uCiAgICAgIHJlbW92ZVRyYW5zaWVudE9ic2VydmVyc0ZvcihvYnNlcnZlcik7CgogICAgICAvLyAyLjQKICAgICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgIG9ic2VydmVyLmNhbGxiYWNrXyhxdWV1ZSwgb2JzZXJ2ZXIpOwogICAgICAgIGFueU5vbkVtcHR5ID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CgogICAgLy8gMy4KICAgIGlmIChhbnlOb25FbXB0eSkKICAgICAgZGlzcGF0Y2hDYWxsYmFja3MoKTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZVRyYW5zaWVudE9ic2VydmVyc0ZvcihvYnNlcnZlcikgewogICAgb2JzZXJ2ZXIubm9kZXNfLmZvckVhY2goZnVuY3Rpb24obm9kZSkgewogICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQobm9kZSk7CiAgICAgIGlmICghcmVnaXN0cmF0aW9ucykKICAgICAgICByZXR1cm47CiAgICAgIHJlZ2lzdHJhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihyZWdpc3RyYXRpb24pIHsKICAgICAgICBpZiAocmVnaXN0cmF0aW9uLm9ic2VydmVyID09PSBvYnNlcnZlcikKICAgICAgICAgIHJlZ2lzdHJhdGlvbi5yZW1vdmVUcmFuc2llbnRPYnNlcnZlcnMoKTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCBmb3IgdGhlICJGb3IgZWFjaCByZWdpc3RlcmVkIG9ic2VydmVyIG9ic2VydmVyICh3aXRoCiAgICogb2JzZXJ2ZXIncyBvcHRpb25zIGFzIG9wdGlvbnMpIGluIHRhcmdldCdzIGxpc3Qgb2YgcmVnaXN0ZXJlZCBvYnNlcnZlcnMsCiAgICogcnVuIHRoZXNlIHN1YnN0ZXBzOiIgYW5kIHRoZSAiRm9yIGVhY2ggYW5jZXN0b3IgYW5jZXN0b3Igb2YgdGFyZ2V0LCBhbmQgZm9yCiAgICogZWFjaCByZWdpc3RlcmVkIG9ic2VydmVyIG9ic2VydmVyICh3aXRoIG9wdGlvbnMgb3B0aW9ucykgaW4gYW5jZXN0b3IncyBsaXN0CiAgICogb2YgcmVnaXN0ZXJlZCBvYnNlcnZlcnMsIHJ1biB0aGVzZSBzdWJzdGVwczoiIHBhcnQgb2YgdGhlIGFsZ29yaXRobXMuIFRoZQogICAqIHxvcHRpb25zLnN1YnRyZWV8IGlzIGNoZWNrZWQgdG8gZW5zdXJlIHRoYXQgdGhlIGNhbGxiYWNrIGlzIGNhbGxlZAogICAqIGNvcnJlY3RseS4KICAgKgogICAqIEBwYXJhbSB7Tm9kZX0gdGFyZ2V0CiAgICogQHBhcmFtIHtmdW5jdGlvbihNdXRhdGlvbk9ic2VydmVySW5pdCk6TXV0YXRpb25SZWNvcmR9IGNhbGxiYWNrCiAgICovCiAgZnVuY3Rpb24gZm9yRWFjaEFuY2VzdG9yQW5kT2JzZXJ2ZXJFbnF1ZXVlUmVjb3JkKHRhcmdldCwgY2FsbGJhY2spIHsKICAgIGZvciAodmFyIG5vZGUgPSB0YXJnZXQ7IG5vZGU7IG5vZGUgPSBub2RlLnBhcmVudE5vZGUpIHsKICAgICAgdmFyIHJlZ2lzdHJhdGlvbnMgPSByZWdpc3RyYXRpb25zVGFibGUuZ2V0KG5vZGUpOwoKICAgICAgaWYgKHJlZ2lzdHJhdGlvbnMpIHsKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJlZ2lzdHJhdGlvbnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIHZhciByZWdpc3RyYXRpb24gPSByZWdpc3RyYXRpb25zW2pdOwogICAgICAgICAgdmFyIG9wdGlvbnMgPSByZWdpc3RyYXRpb24ub3B0aW9uczsKCiAgICAgICAgICAvLyBPbmx5IHRhcmdldCBpZ25vcmVzIHN1YnRyZWUuCiAgICAgICAgICBpZiAobm9kZSAhPT0gdGFyZ2V0ICYmICFvcHRpb25zLnN1YnRyZWUpCiAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgIHZhciByZWNvcmQgPSBjYWxsYmFjayhvcHRpb25zKTsKICAgICAgICAgIGlmIChyZWNvcmQpCiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbi5lbnF1ZXVlKHJlY29yZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICB2YXIgdWlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIFRoZSBjbGFzcyB0aGF0IG1hcHMgdG8gdGhlIERPTSBNdXRhdGlvbk9ic2VydmVyIGludGVyZmFjZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjay4KICAgKiBAY29uc3RydWN0b3IKICAgKi8KICBmdW5jdGlvbiBKc011dGF0aW9uT2JzZXJ2ZXIoY2FsbGJhY2spIHsKICAgIHRoaXMuY2FsbGJhY2tfID0gY2FsbGJhY2s7CiAgICB0aGlzLm5vZGVzXyA9IFtdOwogICAgdGhpcy5yZWNvcmRzXyA9IFtdOwogICAgdGhpcy51aWRfID0gKyt1aWRDb3VudGVyOwogIH0KCiAgSnNNdXRhdGlvbk9ic2VydmVyLnByb3RvdHlwZSA9IHsKICAgIG9ic2VydmU6IGZ1bmN0aW9uKHRhcmdldCwgb3B0aW9ucykgewogICAgICB0YXJnZXQgPSB3cmFwSWZOZWVkZWQodGFyZ2V0KTsKCiAgICAgIC8vIDEuMQogICAgICBpZiAoIW9wdGlvbnMuY2hpbGRMaXN0ICYmICFvcHRpb25zLmF0dHJpYnV0ZXMgJiYgIW9wdGlvbnMuY2hhcmFjdGVyRGF0YSB8fAoKICAgICAgICAgIC8vIDEuMgogICAgICAgICAgb3B0aW9ucy5hdHRyaWJ1dGVPbGRWYWx1ZSAmJiAhb3B0aW9ucy5hdHRyaWJ1dGVzIHx8CgogICAgICAgICAgLy8gMS4zCiAgICAgICAgICBvcHRpb25zLmF0dHJpYnV0ZUZpbHRlciAmJiBvcHRpb25zLmF0dHJpYnV0ZUZpbHRlci5sZW5ndGggJiYKICAgICAgICAgICAgICAhb3B0aW9ucy5hdHRyaWJ1dGVzIHx8CgogICAgICAgICAgLy8gMS40CiAgICAgICAgICBvcHRpb25zLmNoYXJhY3RlckRhdGFPbGRWYWx1ZSAmJiAhb3B0aW9ucy5jaGFyYWN0ZXJEYXRhKSB7CgogICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigpOwogICAgICB9CgogICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQodGFyZ2V0KTsKICAgICAgaWYgKCFyZWdpc3RyYXRpb25zKQogICAgICAgIHJlZ2lzdHJhdGlvbnNUYWJsZS5zZXQodGFyZ2V0LCByZWdpc3RyYXRpb25zID0gW10pOwoKICAgICAgLy8gMgogICAgICAvLyBJZiB0YXJnZXQncyBsaXN0IG9mIHJlZ2lzdGVyZWQgb2JzZXJ2ZXJzIGFscmVhZHkgaW5jbHVkZXMgYSByZWdpc3RlcmVkCiAgICAgIC8vIG9ic2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgY29udGV4dCBvYmplY3QsIHJlcGxhY2UgdGhhdCByZWdpc3RlcmVkCiAgICAgIC8vIG9ic2VydmVyJ3Mgb3B0aW9ucyB3aXRoIG9wdGlvbnMuCiAgICAgIHZhciByZWdpc3RyYXRpb247CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVnaXN0cmF0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChyZWdpc3RyYXRpb25zW2ldLm9ic2VydmVyID09PSB0aGlzKSB7CiAgICAgICAgICByZWdpc3RyYXRpb24gPSByZWdpc3RyYXRpb25zW2ldOwogICAgICAgICAgcmVnaXN0cmF0aW9uLnJlbW92ZUxpc3RlbmVycygpOwogICAgICAgICAgcmVnaXN0cmF0aW9uLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyAzLgogICAgICAvLyBPdGhlcndpc2UsIGFkZCBhIG5ldyByZWdpc3RlcmVkIG9ic2VydmVyIHRvIHRhcmdldCdzIGxpc3Qgb2YgcmVnaXN0ZXJlZAogICAgICAvLyBvYnNlcnZlcnMgd2l0aCB0aGUgY29udGV4dCBvYmplY3QgYXMgdGhlIG9ic2VydmVyIGFuZCBvcHRpb25zIGFzIHRoZQogICAgICAvLyBvcHRpb25zLCBhbmQgYWRkIHRhcmdldCB0byBjb250ZXh0IG9iamVjdCdzIGxpc3Qgb2Ygbm9kZXMgb24gd2hpY2ggaXQKICAgICAgLy8gaXMgcmVnaXN0ZXJlZC4KICAgICAgaWYgKCFyZWdpc3RyYXRpb24pIHsKICAgICAgICByZWdpc3RyYXRpb24gPSBuZXcgUmVnaXN0cmF0aW9uKHRoaXMsIHRhcmdldCwgb3B0aW9ucyk7CiAgICAgICAgcmVnaXN0cmF0aW9ucy5wdXNoKHJlZ2lzdHJhdGlvbik7CiAgICAgICAgdGhpcy5ub2Rlc18ucHVzaCh0YXJnZXQpOwogICAgICB9CgogICAgICByZWdpc3RyYXRpb24uYWRkTGlzdGVuZXJzKCk7CiAgICB9LAoKICAgIGRpc2Nvbm5lY3Q6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLm5vZGVzXy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQobm9kZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWdpc3RyYXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgcmVnaXN0cmF0aW9uID0gcmVnaXN0cmF0aW9uc1tpXTsKICAgICAgICAgIGlmIChyZWdpc3RyYXRpb24ub2JzZXJ2ZXIgPT09IHRoaXMpIHsKICAgICAgICAgICAgcmVnaXN0cmF0aW9uLnJlbW92ZUxpc3RlbmVycygpOwogICAgICAgICAgICByZWdpc3RyYXRpb25zLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgLy8gRWFjaCBub2RlIGNhbiBvbmx5IGhhdmUgb25lIHJlZ2lzdGVyZWQgb2JzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoCiAgICAgICAgICAgIC8vIHRoaXMgb2JzZXJ2ZXIuCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgdGhpcyk7CiAgICAgIHRoaXMucmVjb3Jkc18gPSBbXTsKICAgIH0sCgogICAgdGFrZVJlY29yZHM6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgY29weU9mUmVjb3JkcyA9IHRoaXMucmVjb3Jkc187CiAgICAgIHRoaXMucmVjb3Jkc18gPSBbXTsKICAgICAgcmV0dXJuIGNvcHlPZlJlY29yZHM7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUKICAgKiBAcGFyYW0ge05vZGV9IHRhcmdldAogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIE11dGF0aW9uUmVjb3JkKHR5cGUsIHRhcmdldCkgewogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0OwogICAgdGhpcy5hZGRlZE5vZGVzID0gW107CiAgICB0aGlzLnJlbW92ZWROb2RlcyA9IFtdOwogICAgdGhpcy5wcmV2aW91c1NpYmxpbmcgPSBudWxsOwogICAgdGhpcy5uZXh0U2libGluZyA9IG51bGw7CiAgICB0aGlzLmF0dHJpYnV0ZU5hbWUgPSBudWxsOwogICAgdGhpcy5hdHRyaWJ1dGVOYW1lc3BhY2UgPSBudWxsOwogICAgdGhpcy5vbGRWYWx1ZSA9IG51bGw7CiAgfQoKICBmdW5jdGlvbiBjb3B5TXV0YXRpb25SZWNvcmQob3JpZ2luYWwpIHsKICAgIHZhciByZWNvcmQgPSBuZXcgTXV0YXRpb25SZWNvcmQob3JpZ2luYWwudHlwZSwgb3JpZ2luYWwudGFyZ2V0KTsKICAgIHJlY29yZC5hZGRlZE5vZGVzID0gb3JpZ2luYWwuYWRkZWROb2Rlcy5zbGljZSgpOwogICAgcmVjb3JkLnJlbW92ZWROb2RlcyA9IG9yaWdpbmFsLnJlbW92ZWROb2Rlcy5zbGljZSgpOwogICAgcmVjb3JkLnByZXZpb3VzU2libGluZyA9IG9yaWdpbmFsLnByZXZpb3VzU2libGluZzsKICAgIHJlY29yZC5uZXh0U2libGluZyA9IG9yaWdpbmFsLm5leHRTaWJsaW5nOwogICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWUgPSBvcmlnaW5hbC5hdHRyaWJ1dGVOYW1lOwogICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWVzcGFjZSA9IG9yaWdpbmFsLmF0dHJpYnV0ZU5hbWVzcGFjZTsKICAgIHJlY29yZC5vbGRWYWx1ZSA9IG9yaWdpbmFsLm9sZFZhbHVlOwogICAgcmV0dXJuIHJlY29yZDsKICB9OwoKICAvLyBXZSBrZWVwIHRyYWNrIG9mIHRoZSB0d28gKHBvc3NpYmx5IG9uZSkgcmVjb3JkcyB1c2VkIGluIGEgc2luZ2xlIG11dGF0aW9uLgogIHZhciBjdXJyZW50UmVjb3JkLCByZWNvcmRXaXRoT2xkVmFsdWU7CgogIC8qKgogICAqIENyZWF0ZXMgYSByZWNvcmQgd2l0aG91dCB8b2xkVmFsdWV8IGFuZCBjYWNoZXMgaXQgYXMgfGN1cnJlbnRSZWNvcmR8IGZvcgogICAqIGxhdGVyIHVzZS4KICAgKiBAcGFyYW0ge3N0cmluZ30gb2xkVmFsdWUKICAgKiBAcmV0dXJuIHtNdXRhdGlvblJlY29yZH0KICAgKi8KICBmdW5jdGlvbiBnZXRSZWNvcmQodHlwZSwgdGFyZ2V0KSB7CiAgICByZXR1cm4gY3VycmVudFJlY29yZCA9IG5ldyBNdXRhdGlvblJlY29yZCh0eXBlLCB0YXJnZXQpOwogIH0KCiAgLyoqCiAgICogR2V0cyBvciBjcmVhdGVzIGEgcmVjb3JkIHdpdGggfG9sZFZhbHVlfCBiYXNlZCBpbiB0aGUgfGN1cnJlbnRSZWNvcmR8CiAgICogQHBhcmFtIHtzdHJpbmd9IG9sZFZhbHVlCiAgICogQHJldHVybiB7TXV0YXRpb25SZWNvcmR9CiAgICovCiAgZnVuY3Rpb24gZ2V0UmVjb3JkV2l0aE9sZFZhbHVlKG9sZFZhbHVlKSB7CiAgICBpZiAocmVjb3JkV2l0aE9sZFZhbHVlKQogICAgICByZXR1cm4gcmVjb3JkV2l0aE9sZFZhbHVlOwogICAgcmVjb3JkV2l0aE9sZFZhbHVlID0gY29weU11dGF0aW9uUmVjb3JkKGN1cnJlbnRSZWNvcmQpOwogICAgcmVjb3JkV2l0aE9sZFZhbHVlLm9sZFZhbHVlID0gb2xkVmFsdWU7CiAgICByZXR1cm4gcmVjb3JkV2l0aE9sZFZhbHVlOwogIH0KCiAgZnVuY3Rpb24gY2xlYXJSZWNvcmRzKCkgewogICAgY3VycmVudFJlY29yZCA9IHJlY29yZFdpdGhPbGRWYWx1ZSA9IHVuZGVmaW5lZDsKICB9CgogIC8qKgogICAqIEBwYXJhbSB7TXV0YXRpb25SZWNvcmR9IHJlY29yZAogICAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHJlY29yZCByZXByZXNlbnRzIGEgcmVjb3JkIGZyb20gdGhlIGN1cnJlbnQKICAgKiBtdXRhdGlvbiBldmVudC4KICAgKi8KICBmdW5jdGlvbiByZWNvcmRSZXByZXNlbnRzQ3VycmVudE11dGF0aW9uKHJlY29yZCkgewogICAgcmV0dXJuIHJlY29yZCA9PT0gcmVjb3JkV2l0aE9sZFZhbHVlIHx8IHJlY29yZCA9PT0gY3VycmVudFJlY29yZDsKICB9CgogIC8qKgogICAqIFNlbGVjdHMgd2hpY2ggcmVjb3JkLCBpZiBhbnksIHRvIHJlcGxhY2UgdGhlIGxhc3QgcmVjb3JkIGluIHRoZSBxdWV1ZS4KICAgKiBUaGlzIHJldHVybnMgfG51bGx8IGlmIG5vIHJlY29yZCBzaG91bGQgYmUgcmVwbGFjZWQuCiAgICoKICAgKiBAcGFyYW0ge011dGF0aW9uUmVjb3JkfSBsYXN0UmVjb3JkCiAgICogQHBhcmFtIHtNdXRhdGlvblJlY29yZH0gbmV3UmVjb3JkCiAgICogQHBhcmFtIHtNdXRhdGlvblJlY29yZH0KICAgKi8KICBmdW5jdGlvbiBzZWxlY3RSZWNvcmQobGFzdFJlY29yZCwgbmV3UmVjb3JkKSB7CiAgICBpZiAobGFzdFJlY29yZCA9PT0gbmV3UmVjb3JkKQogICAgICByZXR1cm4gbGFzdFJlY29yZDsKCiAgICAvLyBDaGVjayBpZiB0aGUgdGhlIHJlY29yZCB3ZSBhcmUgYWRkaW5nIHJlcHJlc2VudHMgdGhlIHNhbWUgcmVjb3JkLiBJZgogICAgLy8gc28sIHdlIGtlZXAgdGhlIG9uZSB3aXRoIHRoZSBvbGRWYWx1ZSBpbiBpdC4KICAgIGlmIChyZWNvcmRXaXRoT2xkVmFsdWUgJiYgcmVjb3JkUmVwcmVzZW50c0N1cnJlbnRNdXRhdGlvbihsYXN0UmVjb3JkKSkKICAgICAgcmV0dXJuIHJlY29yZFdpdGhPbGRWYWx1ZTsKCiAgICByZXR1cm4gbnVsbDsKICB9CgogIC8qKgogICAqIENsYXNzIHVzZWQgdG8gcmVwcmVzZW50IGEgcmVnaXN0ZXJlZCBvYnNlcnZlci4KICAgKiBAcGFyYW0ge011dGF0aW9uT2JzZXJ2ZXJ9IG9ic2VydmVyCiAgICogQHBhcmFtIHtOb2RlfSB0YXJnZXQKICAgKiBAcGFyYW0ge011dGF0aW9uT2JzZXJ2ZXJJbml0fSBvcHRpb25zCiAgICogQGNvbnN0cnVjdG9yCiAgICovCiAgZnVuY3Rpb24gUmVnaXN0cmF0aW9uKG9ic2VydmVyLCB0YXJnZXQsIG9wdGlvbnMpIHsKICAgIHRoaXMub2JzZXJ2ZXIgPSBvYnNlcnZlcjsKICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0OwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIHRoaXMudHJhbnNpZW50T2JzZXJ2ZWROb2RlcyA9IFtdOwogIH0KCiAgUmVnaXN0cmF0aW9uLnByb3RvdHlwZSA9IHsKICAgIGVucXVldWU6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICB2YXIgcmVjb3JkcyA9IHRoaXMub2JzZXJ2ZXIucmVjb3Jkc187CiAgICAgIHZhciBsZW5ndGggPSByZWNvcmRzLmxlbmd0aDsKCiAgICAgIC8vIFRoZXJlIGFyZSBjYXNlcyB3aGVyZSB3ZSByZXBsYWNlIHRoZSBsYXN0IHJlY29yZCB3aXRoIHRoZSBuZXcgcmVjb3JkLgogICAgICAvLyBGb3IgZXhhbXBsZSBpZiB0aGUgcmVjb3JkIHJlcHJlc2VudHMgdGhlIHNhbWUgbXV0YXRpb24gd2UgbmVlZCB0byB1c2UKICAgICAgLy8gdGhlIG9uZSB3aXRoIHRoZSBvbGRWYWx1ZS4gSWYgd2UgZ2V0IHNhbWUgcmVjb3JkICh0aGlzIGNhbiBoYXBwZW4gYXMgd2UKICAgICAgLy8gd2FsayB1cCB0aGUgdHJlZSkgd2UgaWdub3JlIHRoZSBuZXcgcmVjb3JkLgogICAgICBpZiAocmVjb3Jkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIGxhc3RSZWNvcmQgPSByZWNvcmRzW2xlbmd0aCAtIDFdOwogICAgICAgIHZhciByZWNvcmRUb1JlcGxhY2VMYXN0ID0gc2VsZWN0UmVjb3JkKGxhc3RSZWNvcmQsIHJlY29yZCk7CiAgICAgICAgaWYgKHJlY29yZFRvUmVwbGFjZUxhc3QpIHsKICAgICAgICAgIHJlY29yZHNbbGVuZ3RoIC0gMV0gPSByZWNvcmRUb1JlcGxhY2VMYXN0OwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzY2hlZHVsZUNhbGxiYWNrKHRoaXMub2JzZXJ2ZXIpOwogICAgICB9CgogICAgICByZWNvcmRzW2xlbmd0aF0gPSByZWNvcmQ7CiAgICB9LAoKICAgIGFkZExpc3RlbmVyczogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuYWRkTGlzdGVuZXJzXyh0aGlzLnRhcmdldCk7CiAgICB9LAoKICAgIGFkZExpc3RlbmVyc186IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CiAgICAgIGlmIChvcHRpb25zLmF0dHJpYnV0ZXMpCiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCB0aGlzLCB0cnVlKTsKCiAgICAgIGlmIChvcHRpb25zLmNoYXJhY3RlckRhdGEpCiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCdET01DaGFyYWN0ZXJEYXRhTW9kaWZpZWQnLCB0aGlzLCB0cnVlKTsKCiAgICAgIGlmIChvcHRpb25zLmNoaWxkTGlzdCkKICAgICAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIHRoaXMsIHRydWUpOwoKICAgICAgaWYgKG9wdGlvbnMuY2hpbGRMaXN0IHx8IG9wdGlvbnMuc3VidHJlZSkKICAgICAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVSZW1vdmVkJywgdGhpcywgdHJ1ZSk7CiAgICB9LAoKICAgIHJlbW92ZUxpc3RlbmVyczogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzXyh0aGlzLnRhcmdldCk7CiAgICB9LAoKICAgIHJlbW92ZUxpc3RlbmVyc186IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CiAgICAgIGlmIChvcHRpb25zLmF0dHJpYnV0ZXMpCiAgICAgICAgbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCB0aGlzLCB0cnVlKTsKCiAgICAgIGlmIChvcHRpb25zLmNoYXJhY3RlckRhdGEpCiAgICAgICAgbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCdET01DaGFyYWN0ZXJEYXRhTW9kaWZpZWQnLCB0aGlzLCB0cnVlKTsKCiAgICAgIGlmIChvcHRpb25zLmNoaWxkTGlzdCkKICAgICAgICBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIHRoaXMsIHRydWUpOwoKICAgICAgaWYgKG9wdGlvbnMuY2hpbGRMaXN0IHx8IG9wdGlvbnMuc3VidHJlZSkKICAgICAgICBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVSZW1vdmVkJywgdGhpcywgdHJ1ZSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQWRkcyBhIHRyYW5zaWVudCBvYnNlcnZlciBvbiBub2RlLiBUaGUgdHJhbnNpZW50IG9ic2VydmVyIGdldHMgcmVtb3ZlZAogICAgICogbmV4dCB0aW1lIHdlIGRlbGl2ZXIgdGhlIGNoYW5nZSByZWNvcmRzLgogICAgICogQHBhcmFtIHtOb2RlfSBub2RlCiAgICAgKi8KICAgIGFkZFRyYW5zaWVudE9ic2VydmVyOiBmdW5jdGlvbihub2RlKSB7CiAgICAgIC8vIERvbid0IGFkZCB0cmFuc2llbnQgb2JzZXJ2ZXJzIG9uIHRoZSB0YXJnZXQgaXRzZWxmLiBXZSBhbHJlYWR5IGhhdmUgYWxsCiAgICAgIC8vIHRoZSByZXF1aXJlZCBsaXN0ZW5lcnMgc2V0IHVwIG9uIHRoZSB0YXJnZXQuCiAgICAgIGlmIChub2RlID09PSB0aGlzLnRhcmdldCkKICAgICAgICByZXR1cm47CgogICAgICB0aGlzLmFkZExpc3RlbmVyc18obm9kZSk7CiAgICAgIHRoaXMudHJhbnNpZW50T2JzZXJ2ZWROb2Rlcy5wdXNoKG5vZGUpOwogICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQobm9kZSk7CiAgICAgIGlmICghcmVnaXN0cmF0aW9ucykKICAgICAgICByZWdpc3RyYXRpb25zVGFibGUuc2V0KG5vZGUsIHJlZ2lzdHJhdGlvbnMgPSBbXSk7CgogICAgICAvLyBXZSBrbm93IHRoYXQgcmVnaXN0cmF0aW9ucyBkb2VzIG5vdCBjb250YWluIHRoaXMgYmVjYXVzZSB3ZSBhbHJlYWR5CiAgICAgIC8vIGNoZWNrZWQgaWYgbm9kZSA9PT0gdGhpcy50YXJnZXQuCiAgICAgIHJlZ2lzdHJhdGlvbnMucHVzaCh0aGlzKTsKICAgIH0sCgogICAgcmVtb3ZlVHJhbnNpZW50T2JzZXJ2ZXJzOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHRyYW5zaWVudE9ic2VydmVkTm9kZXMgPSB0aGlzLnRyYW5zaWVudE9ic2VydmVkTm9kZXM7CiAgICAgIHRoaXMudHJhbnNpZW50T2JzZXJ2ZWROb2RlcyA9IFtdOwoKICAgICAgdHJhbnNpZW50T2JzZXJ2ZWROb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAvLyBUcmFuc2llbnQgb2JzZXJ2ZXJzIGFyZSBuZXZlciBhZGRlZCB0byB0aGUgdGFyZ2V0LgogICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzXyhub2RlKTsKCiAgICAgICAgdmFyIHJlZ2lzdHJhdGlvbnMgPSByZWdpc3RyYXRpb25zVGFibGUuZ2V0KG5vZGUpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVnaXN0cmF0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHJlZ2lzdHJhdGlvbnNbaV0gPT09IHRoaXMpIHsKICAgICAgICAgICAgcmVnaXN0cmF0aW9ucy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIC8vIEVhY2ggbm9kZSBjYW4gb25seSBoYXZlIG9uZSByZWdpc3RlcmVkIG9ic2VydmVyIGFzc29jaWF0ZWQgd2l0aAogICAgICAgICAgICAvLyB0aGlzIG9ic2VydmVyLgogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHRoaXMpOwogICAgfSwKCiAgICBoYW5kbGVFdmVudDogZnVuY3Rpb24oZSkgewogICAgICAvLyBTdG9wIHByb3BhZ2F0aW9uIHNpbmNlIHdlIGFyZSBtYW5hZ2luZyB0aGUgcHJvcGFnYXRpb24gbWFudWFsbHkuCiAgICAgIC8vIFRoaXMgbWVhbnMgdGhhdCBvdGhlciBtdXRhdGlvbiBldmVudHMgb24gdGhlIHBhZ2Ugd2lsbCBub3Qgd29yawogICAgICAvLyBjb3JyZWN0bHkgYnV0IHRoYXQgaXMgYnkgZGVzaWduLgogICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwoKICAgICAgc3dpdGNoIChlLnR5cGUpIHsKICAgICAgICBjYXNlICdET01BdHRyTW9kaWZpZWQnOgogICAgICAgICAgLy8gaHR0cDovL2RvbS5zcGVjLndoYXR3Zy5vcmcvI2NvbmNlcHQtbW8tcXVldWUtYXR0cmlidXRlcwoKICAgICAgICAgIHZhciBuYW1lID0gZS5hdHRyTmFtZTsKICAgICAgICAgIHZhciBuYW1lc3BhY2UgPSBlLnJlbGF0ZWROb2RlLm5hbWVzcGFjZVVSSTsKICAgICAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDsKCiAgICAgICAgICAvLyAxLgogICAgICAgICAgdmFyIHJlY29yZCA9IG5ldyBnZXRSZWNvcmQoJ2F0dHJpYnV0ZXMnLCB0YXJnZXQpOwogICAgICAgICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWUgPSBuYW1lOwogICAgICAgICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWVzcGFjZSA9IG5hbWVzcGFjZTsKCiAgICAgICAgICAvLyAyLgogICAgICAgICAgdmFyIG9sZFZhbHVlID0KICAgICAgICAgICAgICBlLmF0dHJDaGFuZ2UgPT09IE11dGF0aW9uRXZlbnQuQURESVRJT04gPyBudWxsIDogZS5wcmV2VmFsdWU7CgogICAgICAgICAgZm9yRWFjaEFuY2VzdG9yQW5kT2JzZXJ2ZXJFbnF1ZXVlUmVjb3JkKHRhcmdldCwgZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAvLyAzLjEsIDQuMgogICAgICAgICAgICBpZiAoIW9wdGlvbnMuYXR0cmlidXRlcykKICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAvLyAzLjIsIDQuMwogICAgICAgICAgICBpZiAob3B0aW9ucy5hdHRyaWJ1dGVGaWx0ZXIgJiYgb3B0aW9ucy5hdHRyaWJ1dGVGaWx0ZXIubGVuZ3RoICYmCiAgICAgICAgICAgICAgICBvcHRpb25zLmF0dHJpYnV0ZUZpbHRlci5pbmRleE9mKG5hbWUpID09PSAtMSAmJgogICAgICAgICAgICAgICAgb3B0aW9ucy5hdHRyaWJ1dGVGaWx0ZXIuaW5kZXhPZihuYW1lc3BhY2UpID09PSAtMSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAzLjMsIDQuNAogICAgICAgICAgICBpZiAob3B0aW9ucy5hdHRyaWJ1dGVPbGRWYWx1ZSkKICAgICAgICAgICAgICByZXR1cm4gZ2V0UmVjb3JkV2l0aE9sZFZhbHVlKG9sZFZhbHVlKTsKCiAgICAgICAgICAgIC8vIDMuNCwgNC41CiAgICAgICAgICAgIHJldHVybiByZWNvcmQ7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnRE9NQ2hhcmFjdGVyRGF0YU1vZGlmaWVkJzoKICAgICAgICAgIC8vIGh0dHA6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNjb25jZXB0LW1vLXF1ZXVlLWNoYXJhY3RlcmRhdGEKICAgICAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDsKCiAgICAgICAgICAvLyAxLgogICAgICAgICAgdmFyIHJlY29yZCA9IGdldFJlY29yZCgnY2hhcmFjdGVyRGF0YScsIHRhcmdldCk7CgogICAgICAgICAgLy8gMi4KICAgICAgICAgIHZhciBvbGRWYWx1ZSA9IGUucHJldlZhbHVlOwoKCiAgICAgICAgICBmb3JFYWNoQW5jZXN0b3JBbmRPYnNlcnZlckVucXVldWVSZWNvcmQodGFyZ2V0LCBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIC8vIDMuMSwgNC4yCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5jaGFyYWN0ZXJEYXRhKQogICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIC8vIDMuMiwgNC4zCiAgICAgICAgICAgIGlmIChvcHRpb25zLmNoYXJhY3RlckRhdGFPbGRWYWx1ZSkKICAgICAgICAgICAgICByZXR1cm4gZ2V0UmVjb3JkV2l0aE9sZFZhbHVlKG9sZFZhbHVlKTsKCiAgICAgICAgICAgIC8vIDMuMywgNC40CiAgICAgICAgICAgIHJldHVybiByZWNvcmQ7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnRE9NTm9kZVJlbW92ZWQnOgogICAgICAgICAgdGhpcy5hZGRUcmFuc2llbnRPYnNlcnZlcihlLnRhcmdldCk7CiAgICAgICAgICAvLyBGYWxsIHRocm91Z2guCiAgICAgICAgY2FzZSAnRE9NTm9kZUluc2VydGVkJzoKICAgICAgICAgIC8vIGh0dHA6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNjb25jZXB0LW1vLXF1ZXVlLWNoaWxkbGlzdAogICAgICAgICAgdmFyIHRhcmdldCA9IGUucmVsYXRlZE5vZGU7CiAgICAgICAgICB2YXIgY2hhbmdlZE5vZGUgPSBlLnRhcmdldDsKICAgICAgICAgIHZhciBhZGRlZE5vZGVzLCByZW1vdmVkTm9kZXM7CiAgICAgICAgICBpZiAoZS50eXBlID09PSAnRE9NTm9kZUluc2VydGVkJykgewogICAgICAgICAgICBhZGRlZE5vZGVzID0gW2NoYW5nZWROb2RlXTsKICAgICAgICAgICAgcmVtb3ZlZE5vZGVzID0gW107CiAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgYWRkZWROb2RlcyA9IFtdOwogICAgICAgICAgICByZW1vdmVkTm9kZXMgPSBbY2hhbmdlZE5vZGVdOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHByZXZpb3VzU2libGluZyA9IGNoYW5nZWROb2RlLnByZXZpb3VzU2libGluZzsKICAgICAgICAgIHZhciBuZXh0U2libGluZyA9IGNoYW5nZWROb2RlLm5leHRTaWJsaW5nOwoKICAgICAgICAgIC8vIDEuCiAgICAgICAgICB2YXIgcmVjb3JkID0gZ2V0UmVjb3JkKCdjaGlsZExpc3QnLCB0YXJnZXQpOwogICAgICAgICAgcmVjb3JkLmFkZGVkTm9kZXMgPSBhZGRlZE5vZGVzOwogICAgICAgICAgcmVjb3JkLnJlbW92ZWROb2RlcyA9IHJlbW92ZWROb2RlczsKICAgICAgICAgIHJlY29yZC5wcmV2aW91c1NpYmxpbmcgPSBwcmV2aW91c1NpYmxpbmc7CiAgICAgICAgICByZWNvcmQubmV4dFNpYmxpbmcgPSBuZXh0U2libGluZzsKCiAgICAgICAgICBmb3JFYWNoQW5jZXN0b3JBbmRPYnNlcnZlckVucXVldWVSZWNvcmQodGFyZ2V0LCBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIC8vIDIuMSwgMy4yCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5jaGlsZExpc3QpCiAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgLy8gMi4yLCAzLjMKICAgICAgICAgICAgcmV0dXJuIHJlY29yZDsKICAgICAgICAgIH0pOwoKICAgICAgfQoKICAgICAgY2xlYXJSZWNvcmRzKCk7CiAgICB9CiAgfTsKCiAgZ2xvYmFsLkpzTXV0YXRpb25PYnNlcnZlciA9IEpzTXV0YXRpb25PYnNlcnZlcjsKCn0pKHRoaXMpOwoKLyoKICogQ29weXJpZ2h0IDIwMTMgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBCU0Qtc3R5bGUKICogbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLgogKi8KCmlmICghd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIpIHsKICB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciA9IAogICAgICB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlciB8fCAKICAgICAgd2luZG93LkpzTXV0YXRpb25PYnNlcnZlcjsKICBpZiAoIU11dGF0aW9uT2JzZXJ2ZXIpIHsKICAgIHRocm93IG5ldyBFcnJvcigibm8gbXV0YXRpb24gb2JzZXJ2ZXIgc3VwcG9ydCIpOwogIH0KfQoKLyoKICogQ29weXJpZ2h0IDIwMTMgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBCU0Qtc3R5bGUKICogbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLgogKi8KCi8qKgogKiBJbXBsZW1lbnRzIGBkb2N1bWVudC5yZWdpc3RlcmAKICogQG1vZHVsZSBDdXN0b21FbGVtZW50cwoqLwoKLyoqCiAqIFBvbHlmaWxsZWQgZXh0ZW5zaW9ucyB0byB0aGUgYGRvY3VtZW50YCBvYmplY3QuCiAqIEBjbGFzcyBEb2N1bWVudAoqLwoKKGZ1bmN0aW9uKHNjb3BlKSB7CgovLyBpbXBvcnRzCgppZiAoIXNjb3BlKSB7CiAgc2NvcGUgPSB3aW5kb3cuQ3VzdG9tRWxlbWVudHMgPSB7ZmxhZ3M6e319Owp9CnZhciBmbGFncyA9IHNjb3BlLmZsYWdzOwoKLy8gbmF0aXZlIGRvY3VtZW50LnJlZ2lzdGVyPwoKdmFyIGhhc05hdGl2ZSA9IEJvb2xlYW4oZG9jdW1lbnQucmVnaXN0ZXIpOwp2YXIgdXNlTmF0aXZlID0gIWZsYWdzLnJlZ2lzdGVyICYmIGhhc05hdGl2ZTsKCmlmICh1c2VOYXRpdmUpIHsKCiAgLy8gc3R1YgogIHZhciBub3AgPSBmdW5jdGlvbigpIHt9OwoKICAvLyBleHBvcnRzCiAgc2NvcGUucmVnaXN0cnkgPSB7fTsKICBzY29wZS51cGdyYWRlRWxlbWVudCA9IG5vcDsKICAKICBzY29wZS53YXRjaFNoYWRvdyA9IG5vcDsKICBzY29wZS51cGdyYWRlID0gbm9wOwogIHNjb3BlLnVwZ3JhZGVBbGwgPSBub3A7CiAgc2NvcGUudXBncmFkZVN1YnRyZWUgPSBub3A7CiAgc2NvcGUub2JzZXJ2ZURvY3VtZW50ID0gbm9wOwogIHNjb3BlLnVwZ3JhZGVEb2N1bWVudCA9IG5vcDsKICBzY29wZS50YWtlUmVjb3JkcyA9IG5vcDsKCn0gZWxzZSB7CgogIC8qKgogICAqIFJlZ2lzdGVycyBhIGN1c3RvbSB0YWcgbmFtZSB3aXRoIHRoZSBkb2N1bWVudC4KICAgKgogICAqIFdoZW4gYSByZWdpc3RlcmVkIGVsZW1lbnQgaXMgY3JlYXRlZCwgYSBgcmVhZHlDYWxsYmFja2AgbWV0aG9kIGlzIGNhbGxlZAogICAqIGluIHRoZSBzY29wZSBvZiB0aGUgZWxlbWVudC4gVGhlIGByZWFkeUNhbGxiYWNrYCBtZXRob2QgY2FuIGJlIHNwZWNpZmllZCBvbgogICAqIGVpdGhlciBgb3B0aW9ucy5wcm90b3R5cGVgIG9yIGBvcHRpb25zLmxpZmVjeWNsZWAgd2l0aCB0aGUgbGF0dGVyIHRha2luZwogICAqIHByZWNlZGVuY2UuCiAgICoKICAgKiBAbWV0aG9kIHJlZ2lzdGVyCiAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIHRhZyBuYW1lIHRvIHJlZ2lzdGVyLiBNdXN0IGluY2x1ZGUgYSBkYXNoICgnLScpLAogICAqICAgIGZvciBleGFtcGxlICd4LWNvbXBvbmVudCcuCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiAgICBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMuZXh0ZW5kc10KICAgKiAgICAgIChfb2ZmIHNwZWNfKSBUYWcgbmFtZSBvZiBhbiBlbGVtZW50IHRvIGV4dGVuZCAob3IgYmxhbmsgZm9yIGEgbmV3CiAgICogICAgICBlbGVtZW50KS4gVGhpcyBwYXJhbWV0ZXIgaXMgbm90IHBhcnQgb2YgdGhlIHNwZWNpZmljYXRpb24sIGJ1dCBpbnN0ZWFkCiAgICogICAgICBpcyBhIGhpbnQgZm9yIHRoZSBwb2x5ZmlsbCBiZWNhdXNlIHRoZSBleHRlbmRlZSBpcyBkaWZmaWN1bHQgdG8gaW5mZXIuCiAgICogICAgICBSZW1lbWJlciB0aGF0IHRoZSBpbnB1dCBwcm90b3R5cGUgbXVzdCBjaGFpbiB0byB0aGUgZXh0ZW5kZWQgZWxlbWVudCdzCiAgICogICAgICBwcm90b3R5cGUgKG9yIEhUTUxFbGVtZW50LnByb3RvdHlwZSkgcmVnYXJkbGVzcyBvZiB0aGUgdmFsdWUgb2YKICAgKiAgICAgIGBleHRlbmRzYC4KICAgKiAgICBAcGFyYW0ge09iamVjdH0gb3B0aW9ucy5wcm90b3R5cGUgVGhlIHByb3RvdHlwZSB0byB1c2UgZm9yIHRoZSBuZXcKICAgKiAgICAgIGVsZW1lbnQuIFRoZSBwcm90b3R5cGUgbXVzdCBpbmhlcml0IGZyb20gSFRNTEVsZW1lbnQuCiAgICogICAgQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmxpZmVjeWNsZV0KICAgKiAgICAgIENhbGxiYWNrcyB0aGF0IGZpcmUgYXQgaW1wb3J0YW50IHBoYXNlcyBpbiB0aGUgbGlmZSBvZiB0aGUgY3VzdG9tCiAgICogICAgICBlbGVtZW50LgogICAqCiAgICogQGV4YW1wbGUKICAgKiAgICAgIEZhbmN5QnV0dG9uID0gZG9jdW1lbnQucmVnaXN0ZXIoImZhbmN5LWJ1dHRvbiIsIHsKICAgKiAgICAgICAgZXh0ZW5kczogJ2J1dHRvbicsCiAgICogICAgICAgIHByb3RvdHlwZTogT2JqZWN0LmNyZWF0ZShIVE1MQnV0dG9uRWxlbWVudC5wcm90b3R5cGUsIHsKICAgKiAgICAgICAgICByZWFkeUNhbGxiYWNrOiB7CiAgICogICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJhIGZhbmN5LWJ1dHRvbiB3YXMgY3JlYXRlZCIsCiAgICogICAgICAgICAgICB9CiAgICogICAgICAgICAgfQogICAqICAgICAgICB9KQogICAqICAgICAgfSk7CiAgICogQHJldHVybiB7RnVuY3Rpb259IENvbnN0cnVjdG9yIGZvciB0aGUgbmV3bHkgcmVnaXN0ZXJlZCB0eXBlLgogICAqLwogIGZ1bmN0aW9uIHJlZ2lzdGVyKG5hbWUsIG9wdGlvbnMpIHsKICAgIC8vY29uc29sZS53YXJuKCdkb2N1bWVudC5yZWdpc3RlcigiJyArIG5hbWUgKyAnIiwgJywgb3B0aW9ucywgJyknKTsKICAgIC8vIGNvbnN0cnVjdCBhIGRlZmludGlvbiBvdXQgb2Ygb3B0aW9ucwogICAgLy8gVE9ETyhzam1pbGVzKTogcHJvYmFibHkgc2hvdWxkIGNsb25lIG9wdGlvbnMgaW5zdGVhZCBvZiBtdXRhdGluZyBpdAogICAgdmFyIGRlZmluaXRpb24gPSBvcHRpb25zIHx8IHt9OwogICAgaWYgKCFuYW1lKSB7CiAgICAgIC8vIFRPRE8oc2ptaWxlcyk6IHJlcGxhY2Ugd2l0aCBtb3JlIGFwcHJvcHJpYXRlIGVycm9yIChFcmljQiBjYW4gcHJvYmFibHkKICAgICAgLy8gb2ZmZXIgZ3VpZGFuY2UpCiAgICAgIHRocm93IG5ldyBFcnJvcignZG9jdW1lbnQucmVnaXN0ZXI6IGZpcnN0IGFyZ3VtZW50IGBuYW1lYCBtdXN0IG5vdCBiZSBlbXB0eScpOwogICAgfQogICAgaWYgKG5hbWUuaW5kZXhPZignLScpIDwgMCkgewogICAgICAvLyBUT0RPKHNqbWlsZXMpOiByZXBsYWNlIHdpdGggbW9yZSBhcHByb3ByaWF0ZSBlcnJvciAoRXJpY0IgY2FuIHByb2JhYmx5CiAgICAgIC8vIG9mZmVyIGd1aWRhbmNlKQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RvY3VtZW50LnJlZ2lzdGVyOiBmaXJzdCBhcmd1bWVudCAoXCduYW1lXCcpIG11c3QgY29udGFpbiBhIGRhc2ggKFwnLVwnKS4gQXJndW1lbnQgcHJvdmlkZWQgd2FzIFwnJyArIFN0cmluZyhuYW1lKSArICdcJy4nKTsKICAgIH0KICAgIC8vIHJlY29yZCBuYW1lCiAgICBkZWZpbml0aW9uLm5hbWUgPSBuYW1lOwogICAgLy8gbXVzdCBoYXZlIGEgcHJvdG90eXBlLCBkZWZhdWx0IHRvIGFuIGV4dGVuc2lvbiBvZiBIVE1MRWxlbWVudAogICAgLy8gVE9ETyhzam1pbGVzKTogcHJvYmFibHkgc2hvdWxkIHRocm93IGlmIG5vIHByb3RvdHlwZSwgY2hlY2sgc3BlYwogICAgaWYgKCFkZWZpbml0aW9uLnByb3RvdHlwZSkgewogICAgICAvLyBUT0RPKHNqbWlsZXMpOiByZXBsYWNlIHdpdGggbW9yZSBhcHByb3ByaWF0ZSBlcnJvciAoRXJpY0IgY2FuIHByb2JhYmx5CiAgICAgIC8vIG9mZmVyIGd1aWRhbmNlKQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ09wdGlvbnMgbWlzc2luZyByZXF1aXJlZCBwcm90b3R5cGUgcHJvcGVydHknKTsKICAgIH0KICAgIC8vIGVuc3VyZSBhIGxpZmVjeWNsZSBvYmplY3Qgc28gd2UgZG9uJ3QgaGF2ZSB0byBudWxsIHRlc3QgaXQKICAgIGRlZmluaXRpb24ubGlmZWN5Y2xlID0gZGVmaW5pdGlvbi5saWZlY3ljbGUgfHwge307CiAgICAvLyBidWlsZCBhIGxpc3Qgb2YgYW5jZXN0cmFsIGN1c3RvbSBlbGVtZW50cyAoZm9yIG5hdGl2ZSBiYXNlIGRldGVjdGlvbikKICAgIC8vIFRPRE8oc2ptaWxlcyk6IHdlIHVzZWQgdG8gbmVlZCB0byBzdG9yZSB0aGlzLCBidXQgY3VycmVudCBjb2RlIG9ubHkKICAgIC8vIHVzZXMgaXQgaW4gJ3Jlc29sdmVUYWdOYW1lJzogaXQgc2hvdWxkIHByb2JhYmx5IGJlIGlubGluZWQKICAgIGRlZmluaXRpb24uYW5jZXN0cnkgPSBhbmNlc3RyeShkZWZpbml0aW9uLmV4dGVuZHMpOwogICAgLy8gZXh0ZW5zaW9ucyBvZiBuYXRpdmUgc3BlY2lhbGl6YXRpb25zIG9mIEhUTUxFbGVtZW50IHJlcXVpcmUgbG9jYWxOYW1lCiAgICAvLyB0byByZW1haW4gbmF0aXZlLCBhbmQgdXNlIHNlY29uZGFyeSAnaXMnIHNwZWNpZmllciBmb3IgZXh0ZW5zaW9uIHR5cGUKICAgIHJlc29sdmVUYWdOYW1lKGRlZmluaXRpb24pOwogICAgLy8gc29tZSBwbGF0Zm9ybXMgcmVxdWlyZSBtb2RpZmljYXRpb25zIHRvIHRoZSB1c2VyLXN1cHBsaWVkIHByb3RvdHlwZQogICAgLy8gY2hhaW4KICAgIHJlc29sdmVQcm90b3R5cGVDaGFpbihkZWZpbml0aW9uKTsKICAgIC8vIG92ZXJyaWRlcyB0byBpbXBsZW1lbnQgYXR0cmlidXRlQ2hhbmdlZCBjYWxsYmFjawogICAgb3ZlcnJpZGVBdHRyaWJ1dGVBcGkoZGVmaW5pdGlvbi5wcm90b3R5cGUpOwogICAgLy8gNy4xLjU6IFJlZ2lzdGVyIHRoZSBERUZJTklUSU9OIHdpdGggRE9DVU1FTlQKICAgIHJlZ2lzdGVyRGVmaW5pdGlvbihuYW1lLCBkZWZpbml0aW9uKTsKICAgIC8vIDcuMS43LiBSdW4gY3VzdG9tIGVsZW1lbnQgY29uc3RydWN0b3IgZ2VuZXJhdGlvbiBhbGdvcml0aG0gd2l0aCBQUk9UT1RZUEUKICAgIC8vIDcuMS44LiBSZXR1cm4gdGhlIG91dHB1dCBvZiB0aGUgcHJldmlvdXMgc3RlcC4KICAgIGRlZmluaXRpb24uY3RvciA9IGdlbmVyYXRlQ29uc3RydWN0b3IoZGVmaW5pdGlvbik7CiAgICBkZWZpbml0aW9uLmN0b3IucHJvdG90eXBlID0gZGVmaW5pdGlvbi5wcm90b3R5cGU7CiAgICAvLyBmb3JjZSBvdXIgLmNvbnN0cnVjdG9yIHRvIGJlIG91ciBhY3R1YWwgY29uc3RydWN0b3IKICAgIGRlZmluaXRpb24ucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gZGVmaW5pdGlvbi5jdG9yOwogICAgLy8gaWYgaW5pdGlhbCBwYXJzaW5nIGlzIGNvbXBsZXRlCiAgICBpZiAoc2NvcGUucmVhZHkpIHsKICAgICAgLy8gdXBncmFkZSBhbnkgcHJlLWV4aXN0aW5nIG5vZGVzIG9mIHRoaXMgdHlwZQogICAgICBzY29wZS51cGdyYWRlQWxsKGRvY3VtZW50KTsKICAgIH0KICAgIHJldHVybiBkZWZpbml0aW9uLmN0b3I7CiAgfQoKICBmdW5jdGlvbiBhbmNlc3RyeShleHRuZHMpIHsKICAgIHZhciBleHRlbmRlZSA9IHJlZ2lzdHJ5W2V4dG5kc107CiAgICBpZiAoZXh0ZW5kZWUpIHsKICAgICAgcmV0dXJuIGFuY2VzdHJ5KGV4dGVuZGVlLmV4dGVuZHMpLmNvbmNhdChbZXh0ZW5kZWVdKTsKICAgIH0KICAgIHJldHVybiBbXTsKICB9CgogIGZ1bmN0aW9uIHJlc29sdmVUYWdOYW1lKGRlZmluaXRpb24pIHsKICAgIC8vIGlmIHdlIGFyZSBleHBsaWNpdGx5IGV4dGVuZGluZyBzb21ldGhpbmcsIHRoYXQgdGhpbmcgaXMgb3VyCiAgICAvLyBiYXNlVGFnLCB1bmxlc3MgaXQgcmVwcmVzZW50cyBhIGN1c3RvbSBjb21wb25lbnQKICAgIHZhciBiYXNlVGFnID0gZGVmaW5pdGlvbi5leHRlbmRzOwogICAgLy8gaWYgb3VyIGFuY2VzdHJ5IGluY2x1ZGVzIGN1c3RvbSBjb21wb25lbnRzLCB3ZSBvbmx5IGhhdmUgYQogICAgLy8gYmFzZVRhZyBpZiBvbmUgb2YgdGhlbSBkb2VzCiAgICBmb3IgKHZhciBpPTAsIGE7IChhPWRlZmluaXRpb24uYW5jZXN0cnlbaV0pOyBpKyspIHsKICAgICAgYmFzZVRhZyA9IGEuaXMgJiYgYS50YWc7CiAgICB9CiAgICAvLyBvdXIgdGFnIGlzIG91ciBiYXNlVGFnLCBpZiBpdCBleGlzdHMsIGFuZCBvdGhlcndpc2UganVzdCBvdXIgbmFtZQogICAgZGVmaW5pdGlvbi50YWcgPSBiYXNlVGFnIHx8IGRlZmluaXRpb24ubmFtZTsKICAgIGlmIChiYXNlVGFnKSB7CiAgICAgIC8vIGlmIHRoZXJlIGlzIGEgYmFzZSB0YWcsIHVzZSBzZWNvbmRhcnkgJ2lzJyBzcGVjaWZpZXIKICAgICAgZGVmaW5pdGlvbi5pcyA9IGRlZmluaXRpb24ubmFtZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlc29sdmVQcm90b3R5cGVDaGFpbihkZWZpbml0aW9uKSB7CiAgICAvLyBpZiB3ZSBkb24ndCBzdXBwb3J0IF9fcHJvdG9fXyB3ZSBuZWVkIHRvIGxvY2F0ZSB0aGUgbmF0aXZlIGxldmVsCiAgICAvLyBwcm90b3R5cGUgZm9yIHByZWNpc2UgbWl4aW5nIGluCiAgICBpZiAoIU9iamVjdC5fX3Byb3RvX18pIHsKICAgICAgLy8gZGVmYXVsdCBwcm90b3R5cGUKICAgICAgdmFyIG5hdGl2ZVByb3RvdHlwZSA9IEhUTUxFbGVtZW50LnByb3RvdHlwZTsKICAgICAgLy8gd29yayBvdXQgcHJvdG90eXBlIHdoZW4gdXNpbmcgdHlwZS1leHRlbnNpb24KICAgICAgaWYgKGRlZmluaXRpb24uaXMpIHsKICAgICAgICB2YXIgaW5zdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZGVmaW5pdGlvbi50YWcpOwogICAgICAgIG5hdGl2ZVByb3RvdHlwZSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnN0KTsKICAgICAgfQogICAgICAvLyBlbnN1cmUgX19wcm90b19fIHJlZmVyZW5jZSBpcyBpbnN0YWxsZWQgYXQgZWFjaCBwb2ludCBvbiB0aGUgcHJvdG90eXBlCiAgICAgIC8vIGNoYWluLgogICAgICAvLyBOT1RFOiBPbiBwbGF0Zm9ybXMgd2l0aG91dCBfX3Byb3RvX18sIGEgbWl4aW4gc3RyYXRlZ3kgaXMgdXNlZCBpbnN0ZWFkCiAgICAgIC8vIG9mIHByb3RvdHlwZSBzd2l6emxpbmcuIEluIHRoaXMgY2FzZSwgdGhpcyBnZW5lcmF0ZWQgX19wcm90b19fIHByb3ZpZGVzCiAgICAgIC8vIGxpbWl0ZWQgc3VwcG9ydCBmb3IgcHJvdG90eXBlIHRyYXZlcnNhbC4KICAgICAgdmFyIHByb3RvID0gZGVmaW5pdGlvbi5wcm90b3R5cGUsIGFuY2VzdG9yOwogICAgICB3aGlsZSAocHJvdG8gJiYgKHByb3RvICE9PSBuYXRpdmVQcm90b3R5cGUpKSB7CiAgICAgICAgdmFyIGFuY2VzdG9yID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvKTsKICAgICAgICBwcm90by5fX3Byb3RvX18gPSBhbmNlc3RvcjsKICAgICAgICBwcm90byA9IGFuY2VzdG9yOwogICAgICB9CiAgICB9CiAgICAvLyBjYWNoZSB0aGlzIGluIGNhc2Ugb2YgbWl4aW4KICAgIGRlZmluaXRpb24ubmF0aXZlID0gbmF0aXZlUHJvdG90eXBlOwogIH0KCiAgLy8gU0VDVElPTiA0CgogIGZ1bmN0aW9uIGluc3RhbnRpYXRlKGRlZmluaXRpb24pIHsKICAgIC8vIDQuYS4xLiBDcmVhdGUgYSBuZXcgb2JqZWN0IHRoYXQgaW1wbGVtZW50cyBQUk9UT1RZUEUKICAgIC8vIDQuYS4yLiBMZXQgRUxFTUVOVCBieSB0aGlzIG5ldyBvYmplY3QKICAgIC8vCiAgICAvLyB0aGUgY3VzdG9tIGVsZW1lbnQgaW5zdGFudGlhdGlvbiBhbGdvcml0aG0gbXVzdCBhbHNvIGVuc3VyZSB0aGF0IHRoZQogICAgLy8gb3V0cHV0IGlzIGEgdmFsaWQgRE9NIGVsZW1lbnQgd2l0aCB0aGUgcHJvcGVyIHdyYXBwZXIgaW4gcGxhY2UuCiAgICAvLwogICAgcmV0dXJuIHVwZ3JhZGUoZG9tQ3JlYXRlRWxlbWVudChkZWZpbml0aW9uLnRhZyksIGRlZmluaXRpb24pOwogIH0KCiAgZnVuY3Rpb24gdXBncmFkZShlbGVtZW50LCBkZWZpbml0aW9uKSB7CiAgICAvLyBzb21lIGRlZmluaXRpb25zIHNwZWNpZnkgYW4gJ2lzJyBhdHRyaWJ1dGUKICAgIGlmIChkZWZpbml0aW9uLmlzKSB7CiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdpcycsIGRlZmluaXRpb24uaXMpOwogICAgfQogICAgLy8gbWFrZSAnZWxlbWVudCcgaW1wbGVtZW50IGRlZmluaXRpb24ucHJvdG90eXBlCiAgICBpbXBsZW1lbnQoZWxlbWVudCwgZGVmaW5pdGlvbik7CiAgICAvLyBmbGFnIGFzIHVwZ3JhZGVkCiAgICBlbGVtZW50Ll9fdXBncmFkZWRfXyA9IHRydWU7CiAgICAvLyB0aGVyZSBzaG91bGQgbmV2ZXIgYmUgYSBzaGFkb3cgcm9vdCBvbiBlbGVtZW50IGF0IHRoaXMgcG9pbnQKICAgIC8vIHdlIHJlcXVpcmUgY2hpbGQgbm9kZXMgYmUgdXBncmFkZWQgYmVmb3JlIGBjcmVhdGVkYAogICAgc2NvcGUudXBncmFkZVN1YnRyZWUoZWxlbWVudCk7CiAgICAvLyBsaWZlY3ljbGUgbWFuYWdlbWVudAogICAgY3JlYXRlZChlbGVtZW50KTsKICAgIC8vIE9VVFBVVAogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfQoKICBmdW5jdGlvbiBpbXBsZW1lbnQoZWxlbWVudCwgZGVmaW5pdGlvbikgewogICAgLy8gcHJvdG90eXBlIHN3aXp6bGluZyBpcyBiZXN0CiAgICBpZiAoT2JqZWN0Ll9fcHJvdG9fXykgewogICAgICBlbGVtZW50Ll9fcHJvdG9fXyA9IGRlZmluaXRpb24ucHJvdG90eXBlOwogICAgfSBlbHNlIHsKICAgICAgLy8gd2hlcmUgYWJvdmUgd2UgY2FuIHJlLWFjcXVpcmUgaW5Qcm90b3R5cGUgdmlhCiAgICAgIC8vIGdldFByb3RvdHlwZU9mKEVsZW1lbnQpLCB3ZSBjYW5ub3QgZG8gc28gd2hlbgogICAgICAvLyB3ZSB1c2UgbWl4aW4sIHNvIHdlIGluc3RhbGwgYSBtYWdpYyByZWZlcmVuY2UKICAgICAgY3VzdG9tTWl4aW4oZWxlbWVudCwgZGVmaW5pdGlvbi5wcm90b3R5cGUsIGRlZmluaXRpb24ubmF0aXZlKTsKICAgICAgZWxlbWVudC5fX3Byb3RvX18gPSBkZWZpbml0aW9uLnByb3RvdHlwZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGN1c3RvbU1peGluKGluVGFyZ2V0LCBpblNyYywgaW5OYXRpdmUpIHsKICAgIC8vIFRPRE8oc2ptaWxlcyk6ICd1c2VkJyBhbGxvd3MgdXMgdG8gb25seSBjb3B5IHRoZSAneW91bmdlc3QnIHZlcnNpb24gb2YKICAgIC8vIGFueSBwcm9wZXJ0eS4gVGhpcyBzZXQgc2hvdWxkIGJlIHByZWNhbGN1bGF0ZWQuIFdlIGFsc28gbmVlZCB0bwogICAgLy8gY29uc2lkZXIgdGhpcyBmb3Igc3VwcG9ydGluZyAnc3VwZXInLgogICAgdmFyIHVzZWQgPSB7fTsKICAgIC8vIHN0YXJ0IHdpdGggaW5TcmMKICAgIHZhciBwID0gaW5TcmM7CiAgICAvLyBzb21ldGltZXMgdGhlIGRlZmF1bHQgaXMgSFRNTFVua25vd25FbGVtZW50LnByb3RvdHlwZSBpbnN0ZWFkIG9mCiAgICAvLyBIVE1MRWxlbWVudC5wcm90b3R5cGUsIHNvIHdlIGFkZCBhIHRlc3QKICAgIC8vIHRoZSBpZGVhIGlzIHRvIGF2b2lkIG1peGluZyBpbiBuYXRpdmUgcHJvdG90eXBlcywgc28gYWRkaW5nCiAgICAvLyB0aGUgc2Vjb25kIHRlc3QgaXMgV0xPRwogICAgd2hpbGUgKHAgIT09IGluTmF0aXZlICYmIHAgIT09IEhUTUxVbmtub3duRWxlbWVudC5wcm90b3R5cGUpIHsKICAgICAgdmFyIGtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhwKTsKICAgICAgZm9yICh2YXIgaT0wLCBrOyBrPWtleXNbaV07IGkrKykgewogICAgICAgIGlmICghdXNlZFtrXSkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGluVGFyZ2V0LCBrLAogICAgICAgICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocCwgaykpOwogICAgICAgICAgdXNlZFtrXSA9IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHAgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YocCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVkKGVsZW1lbnQpIHsKICAgIC8vIGludm9rZSBjcmVhdGVkQ2FsbGJhY2sKICAgIGlmIChlbGVtZW50LmNyZWF0ZWRDYWxsYmFjaykgewogICAgICBlbGVtZW50LmNyZWF0ZWRDYWxsYmFjaygpOwogICAgfQogIH0KCiAgLy8gYXR0cmlidXRlIHdhdGNoaW5nCgogIGZ1bmN0aW9uIG92ZXJyaWRlQXR0cmlidXRlQXBpKHByb3RvdHlwZSkgewogICAgLy8gb3ZlcnJpZGVzIHRvIGltcGxlbWVudCBjYWxsYmFja3MKICAgIC8vIFRPRE8oc2ptaWxlcyk6IHNob3VsZCBzdXBwb3J0IGFjY2VzcyB2aWEgLmF0dHJpYnV0ZXMgTmFtZWROb2RlTWFwCiAgICAvLyBUT0RPKHNqbWlsZXMpOiBwcmVzZXJ2ZXMgdXNlciBkZWZpbmVkIG92ZXJyaWRlcywgaWYgYW55CiAgICB2YXIgc2V0QXR0cmlidXRlID0gcHJvdG90eXBlLnNldEF0dHJpYnV0ZTsKICAgIHByb3RvdHlwZS5zZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICBjaGFuZ2VBdHRyaWJ1dGUuY2FsbCh0aGlzLCBuYW1lLCB2YWx1ZSwgc2V0QXR0cmlidXRlKTsKICAgIH0KICAgIHZhciByZW1vdmVBdHRyaWJ1dGUgPSBwcm90b3R5cGUucmVtb3ZlQXR0cmlidXRlOwogICAgcHJvdG90eXBlLnJlbW92ZUF0dHJpYnV0ZSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgIGNoYW5nZUF0dHJpYnV0ZS5jYWxsKHRoaXMsIG5hbWUsIHZhbHVlLCByZW1vdmVBdHRyaWJ1dGUpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hhbmdlQXR0cmlidXRlKG5hbWUsIHZhbHVlLCBvcGVyYXRpb24pIHsKICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMuZ2V0QXR0cmlidXRlKG5hbWUpOwogICAgb3BlcmF0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICBpZiAodGhpcy5hdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2sgCiAgICAgICAgJiYgKHRoaXMuZ2V0QXR0cmlidXRlKG5hbWUpICE9PSBvbGRWYWx1ZSkpIHsKICAgICAgdGhpcy5hdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2sobmFtZSwgb2xkVmFsdWUpOwogICAgfQogIH0KCiAgLy8gZWxlbWVudCByZWdpc3RyeSAobWFwcyB0YWcgbmFtZXMgdG8gZGVmaW5pdGlvbnMpCgogIHZhciByZWdpc3RyeSA9IHt9OwoKICBmdW5jdGlvbiByZWdpc3RlckRlZmluaXRpb24obmFtZSwgZGVmaW5pdGlvbikgewogICAgcmVnaXN0cnlbbmFtZV0gPSBkZWZpbml0aW9uOwogIH0KCiAgZnVuY3Rpb24gZ2VuZXJhdGVDb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBpbnN0YW50aWF0ZShkZWZpbml0aW9uKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50KHRhZywgdHlwZUV4dGVuc2lvbikgewogICAgLy8gVE9ETyhzam1pbGVzKTogaWdub3JlICd0YWcnIHdoZW4gdXNpbmcgJ3R5cGVFeHRlbnNpb24nLCB3ZSBjb3VsZAogICAgLy8gZXJyb3IgY2hlY2sgaXQsIG9yIHBlcmhhcHMgdGhlcmUgc2hvdWxkIG9ubHkgZXZlciBiZSBvbmUgYXJndW1lbnQKICAgIHZhciBkZWZpbml0aW9uID0gcmVnaXN0cnlbdHlwZUV4dGVuc2lvbiB8fCB0YWddOwogICAgaWYgKGRlZmluaXRpb24pIHsKICAgICAgcmV0dXJuIG5ldyBkZWZpbml0aW9uLmN0b3IoKTsKICAgIH0KICAgIHJldHVybiBkb21DcmVhdGVFbGVtZW50KHRhZyk7CiAgfQoKICBmdW5jdGlvbiB1cGdyYWRlRWxlbWVudChlbGVtZW50KSB7CiAgICBpZiAoIWVsZW1lbnQuX191cGdyYWRlZF9fICYmIChlbGVtZW50Lm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSkpIHsKICAgICAgdmFyIHR5cGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnaXMnKSB8fCBlbGVtZW50LmxvY2FsTmFtZTsKICAgICAgdmFyIGRlZmluaXRpb24gPSByZWdpc3RyeVt0eXBlXTsKICAgICAgcmV0dXJuIGRlZmluaXRpb24gJiYgdXBncmFkZShlbGVtZW50LCBkZWZpbml0aW9uKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNsb25lTm9kZShkZWVwKSB7CiAgICAvLyBjYWxsIG9yaWdpbmFsIGNsb25lCiAgICB2YXIgbiA9IGRvbUNsb25lTm9kZS5jYWxsKHRoaXMsIGRlZXApOwogICAgLy8gdXBncmFkZSB0aGUgZWxlbWVudCBhbmQgc3VidHJlZQogICAgc2NvcGUudXBncmFkZUFsbChuKTsKICAgIC8vIHJldHVybiB0aGUgY2xvbmUKICAgIHJldHVybiBuOwogIH0KICAvLyBjYXB0dXJlIG5hdGl2ZSBjcmVhdGVFbGVtZW50IGJlZm9yZSB3ZSBvdmVycmlkZSBpdAoKICB2YXIgZG9tQ3JlYXRlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuYmluZChkb2N1bWVudCk7CgogIC8vIGNhcHR1cmUgbmF0aXZlIGNsb25lTm9kZSBiZWZvcmUgd2Ugb3ZlcnJpZGUgaXQKCiAgdmFyIGRvbUNsb25lTm9kZSA9IE5vZGUucHJvdG90eXBlLmNsb25lTm9kZTsKCiAgLy8gZXhwb3J0cwoKICBkb2N1bWVudC5yZWdpc3RlciA9IHJlZ2lzdGVyOwogIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgPSBjcmVhdGVFbGVtZW50OyAvLyBvdmVycmlkZQogIE5vZGUucHJvdG90eXBlLmNsb25lTm9kZSA9IGNsb25lTm9kZTsgLy8gb3ZlcnJpZGUKCiAgc2NvcGUucmVnaXN0cnkgPSByZWdpc3RyeTsKCiAgLyoqCiAgICogVXBncmFkZSBhbiBlbGVtZW50IHRvIGEgY3VzdG9tIGVsZW1lbnQuIFVwZ3JhZGluZyBhbiBlbGVtZW50CiAgICogY2F1c2VzIHRoZSBjdXN0b20gcHJvdG90eXBlIHRvIGJlIGFwcGxpZWQsIGFuIGBpc2AgYXR0cmlidXRlIAogICAqIHRvIGJlIGF0dGFjaGVkIChhcyBuZWVkZWQpLCBhbmQgaW52b2NhdGlvbiBvZiB0aGUgYHJlYWR5Q2FsbGJhY2tgLgogICAqIGB1cGdyYWRlYCBkb2VzIG5vdGhpbmcgaWYgdGhlIGVsZW1lbnQgaXMgYWxyZWFkeSB1cGdyYWRlZCwgb3IKICAgKiBpZiBpdCBtYXRjaGVzIG5vIHJlZ2lzdGVyZWQgY3VzdG9tIHRhZyBuYW1lLgogICAqCiAgICogQG1ldGhvZCB1Z3ByYWRlCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IFRoZSBlbGVtZW50IHRvIHVwZ3JhZGUuCiAgICogQHJldHVybiB7RWxlbWVudH0gVGhlIHVwZ3JhZGVkIGVsZW1lbnQuCiAgICovCiAgc2NvcGUudXBncmFkZSA9IHVwZ3JhZGVFbGVtZW50Owp9CgpzY29wZS5oYXNOYXRpdmUgPSBoYXNOYXRpdmU7CnNjb3BlLnVzZU5hdGl2ZSA9IHVzZU5hdGl2ZTsKCn0pKHdpbmRvdy5DdXN0b21FbGVtZW50cyk7CgogLyoKQ29weXJpZ2h0IDIwMTMgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBCU0Qtc3R5bGUKbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLgoqLwoKKGZ1bmN0aW9uKHNjb3BlKXsKCnZhciBsb2dGbGFncyA9IHdpbmRvdy5sb2dGbGFncyB8fCB7fTsKCi8vIHdhbGsgdGhlIHN1YnRyZWUgcm9vdGVkIGF0IG5vZGUsIGFwcGx5aW5nICdmaW5kKGVsZW1lbnQsIGRhdGEpJyBmdW5jdGlvbgovLyB0byBlYWNoIGVsZW1lbnQKLy8gaWYgJ2ZpbmQnIHJldHVybnMgdHJ1ZSBmb3IgJ2VsZW1lbnQnLCBkbyBub3Qgc2VhcmNoIGVsZW1lbnQncyBzdWJ0cmVlCmZ1bmN0aW9uIGZpbmRBbGwobm9kZSwgZmluZCwgZGF0YSkgewogIHZhciBlID0gbm9kZS5maXJzdEVsZW1lbnRDaGlsZDsKICBpZiAoIWUpIHsKICAgIGUgPSBub2RlLmZpcnN0Q2hpbGQ7CiAgICB3aGlsZSAoZSAmJiBlLm5vZGVUeXBlICE9PSBOb2RlLkVMRU1FTlRfTk9ERSkgewogICAgICBlID0gZS5uZXh0U2libGluZzsKICAgIH0KICB9CiAgd2hpbGUgKGUpIHsKICAgIGlmIChmaW5kKGUsIGRhdGEpICE9PSB0cnVlKSB7CiAgICAgIGZpbmRBbGwoZSwgZmluZCwgZGF0YSk7CiAgICB9CiAgICBlID0gZS5uZXh0RWxlbWVudFNpYmxpbmc7CiAgfQogIHJldHVybiBudWxsOwp9CgovLyB3YWxrIGFsbCBzaGFkb3dSb290cyBvbiBhIGdpdmVuIG5vZGUuCmZ1bmN0aW9uIGZvclJvb3RzKG5vZGUsIGNiKSB7CiAgdmFyIHJvb3QgPSBub2RlLnNoYWRvd1Jvb3Q7CiAgd2hpbGUocm9vdCkgewogICAgZm9yU3VidHJlZShyb290LCBjYik7CiAgICByb290ID0gcm9vdC5vbGRlclNoYWRvd1Jvb3Q7CiAgfQp9CgovLyB3YWxrIHRoZSBzdWJ0cmVlIHJvb3RlZCBhdCBub2RlLCBpbmNsdWRpbmcgZGVzY2VudCBpbnRvIHNoYWRvdy1yb290cywKLy8gYXBwbHlpbmcgJ2NiJyB0byBlYWNoIGVsZW1lbnQKZnVuY3Rpb24gZm9yU3VidHJlZShub2RlLCBjYikgewogIC8vbG9nRmxhZ3MuZG9tICYmIG5vZGUuY2hpbGROb2RlcyAmJiBub2RlLmNoaWxkTm9kZXMubGVuZ3RoICYmIGNvbnNvbGUuZ3JvdXAoJ3N1YlRyZWU6ICcsIG5vZGUpOwogIGZpbmRBbGwobm9kZSwgZnVuY3Rpb24oZSkgewogICAgaWYgKGNiKGUpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZm9yUm9vdHMoZSwgY2IpOwogIH0pOwogIGZvclJvb3RzKG5vZGUsIGNiKTsKICAvL2xvZ0ZsYWdzLmRvbSAmJiBub2RlLmNoaWxkTm9kZXMgJiYgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aCAmJiBjb25zb2xlLmdyb3VwRW5kKCk7Cn0KCi8vIG1hbmFnZSBsaWZlY3ljbGUgb24gYWRkZWQgbm9kZQpmdW5jdGlvbiBhZGRlZChub2RlKSB7CiAgaWYgKHVwZ3JhZGUobm9kZSkpIHsKICAgIGluc2VydGVkTm9kZShub2RlKTsKICAgIHJldHVybiB0cnVlOwogIH0KICBpbnNlcnRlZChub2RlKTsKfQoKLy8gbWFuYWdlIGxpZmVjeWNsZSBvbiBhZGRlZCBub2RlJ3Mgc3VidHJlZSBvbmx5CmZ1bmN0aW9uIGFkZGVkU3VidHJlZShub2RlKSB7CiAgZm9yU3VidHJlZShub2RlLCBmdW5jdGlvbihlKSB7CiAgICBpZiAoYWRkZWQoZSkpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfSk7Cn0KCi8vIG1hbmFnZSBsaWZlY3ljbGUgb24gYWRkZWQgbm9kZSBhbmQgaXQncyBzdWJ0cmVlCmZ1bmN0aW9uIGFkZGVkTm9kZShub2RlKSB7CiAgcmV0dXJuIGFkZGVkKG5vZGUpIHx8IGFkZGVkU3VidHJlZShub2RlKTsKfQoKLy8gdXBncmFkZSBjdXN0b20gZWxlbWVudHMgYXQgbm9kZSwgaWYgYXBwbGljYWJsZQpmdW5jdGlvbiB1cGdyYWRlKG5vZGUpIHsKICBpZiAoIW5vZGUuX191cGdyYWRlZF9fICYmIG5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgICB2YXIgdHlwZSA9IG5vZGUuZ2V0QXR0cmlidXRlKCdpcycpIHx8IG5vZGUubG9jYWxOYW1lOwogICAgdmFyIGRlZmluaXRpb24gPSBzY29wZS5yZWdpc3RyeVt0eXBlXTsKICAgIGlmIChkZWZpbml0aW9uKSB7CiAgICAgIGxvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmdyb3VwKCd1cGdyYWRlOicsIG5vZGUubG9jYWxOYW1lKTsKICAgICAgc2NvcGUudXBncmFkZShub2RlKTsKICAgICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUuZ3JvdXBFbmQoKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBpbnNlcnRlZE5vZGUobm9kZSkgewogIGluc2VydGVkKG5vZGUpOwogIGlmIChpbkRvY3VtZW50KG5vZGUpKSB7CiAgICBmb3JTdWJ0cmVlKG5vZGUsIGZ1bmN0aW9uKGUpIHsKICAgICAgaW5zZXJ0ZWQoZSk7CiAgICB9KTsKICB9Cn0KCgovLyBUT0RPKHNvcnZlbGwpOiBvbiBwbGF0Zm9ybXMgd2l0aG91dCBNdXRhdGlvbk9ic2VydmVyLCBtdXRhdGlvbnMgbWF5IG5vdCBiZSAKLy8gcmVsaWFibGUgYW5kIHRoZXJlZm9yZSBlbnRlcmVkL2xlZnRWaWV3IGFyZSBub3QgcmVsaWFibGUuCi8vIFRvIG1ha2UgdGhlc2UgY2FsbGJhY2tzIGxlc3MgbGlrZWx5IHRvIGZhaWwsIHdlIGRlZmVyIGFsbCBpbnNlcnRzIGFuZCByZW1vdmVzCi8vIHRvIGdpdmUgYSBjaGFuY2UgZm9yIGVsZW1lbnRzIHRvIGJlIGluc2VydGVkIGludG8gZG9tLiAKLy8gVGhpcyBlbnN1cmVzIGVudGVyZWRWaWV3Q2FsbGJhY2sgZmlyZXMgZm9yIGVsZW1lbnRzIHRoYXQgYXJlIGNyZWF0ZWQgYW5kIAovLyBpbW1lZGlhdGVseSBhZGRlZCB0byBkb20uCnZhciBoYXNQb2x5ZmlsbE11dGF0aW9ucyA9ICghd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwKICAgICh3aW5kb3cuTXV0YXRpb25PYnNlcnZlciA9PT0gd2luZG93LkpzTXV0YXRpb25PYnNlcnZlcikpOwpzY29wZS5oYXNQb2x5ZmlsbE11dGF0aW9ucyA9IGhhc1BvbHlmaWxsTXV0YXRpb25zOwoKdmFyIGlzUGVuZGluZ011dGF0aW9ucyA9IGZhbHNlOwp2YXIgcGVuZGluZ011dGF0aW9ucyA9IFtdOwpmdW5jdGlvbiBkZWZlck11dGF0aW9uKGZuKSB7CiAgcGVuZGluZ011dGF0aW9ucy5wdXNoKGZuKTsKICBpZiAoIWlzUGVuZGluZ011dGF0aW9ucykgewogICAgaXNQZW5kaW5nTXV0YXRpb25zID0gdHJ1ZTsKICAgIHZhciBhc3luYyA9ICh3aW5kb3cuUGxhdGZvcm0gJiYgd2luZG93LlBsYXRmb3JtLmVuZE9mTWljcm90YXNrKSB8fAogICAgICAgIHNldFRpbWVvdXQ7CiAgICBhc3luYyh0YWtlTXV0YXRpb25zKTsKICB9Cn0KCmZ1bmN0aW9uIHRha2VNdXRhdGlvbnMoKSB7CiAgaXNQZW5kaW5nTXV0YXRpb25zID0gZmFsc2U7CiAgdmFyICRwID0gcGVuZGluZ011dGF0aW9uczsKICBmb3IgKHZhciBpPTAsIGw9JHAubGVuZ3RoLCBwOyAoaTxsKSAmJiAocD0kcFtpXSk7IGkrKykgewogICAgcCgpOwogIH0KICBwZW5kaW5nTXV0YXRpb25zID0gW107Cn0KCmZ1bmN0aW9uIGluc2VydGVkKGVsZW1lbnQpIHsKICBpZiAoaGFzUG9seWZpbGxNdXRhdGlvbnMpIHsKICAgIGRlZmVyTXV0YXRpb24oZnVuY3Rpb24oKSB7CiAgICAgIF9pbnNlcnRlZChlbGVtZW50KTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICBfaW5zZXJ0ZWQoZWxlbWVudCk7CiAgfQp9CgovLyBUT0RPKHNqbWlsZXMpOiBpZiB0aGVyZSBhcmUgZGVzY2VudHMgaW50byB0cmVlcyB0aGF0IGNhbiBuZXZlciBoYXZlIGluRG9jdW1lbnQoKikgdHJ1ZSwgZml4IHRoaXMKZnVuY3Rpb24gX2luc2VydGVkKGVsZW1lbnQpIHsKICAvLyBUT0RPKHNqbWlsZXMpOiBpdCdzIHBvc3NpYmxlIHdlIHdlcmUgaW5zZXJ0ZWQgYW5kIHJlbW92ZWQgaW4gdGhlIHNwYWNlCiAgLy8gb2Ygb25lIG1pY3JvdGFzaywgaW4gd2hpY2ggY2FzZSB3ZSB3b24ndCBiZSAnaW5Eb2N1bWVudCcgaGVyZQogIC8vIEJ1dCB0aGVyZSBhcmUgb3RoZXIgY2FzZXMgd2hlcmUgd2UgYXJlIHRlc3RpbmcgZm9yIGluc2VydGVkIHdpdGhvdXQKICAvLyBzcGVjaWZpYyBrbm93bGVkZ2Ugb2YgbXV0YXRpb25zLCBhbmQgbXVzdCB0ZXN0ICdpbkRvY3VtZW50JyB0byBkZXRlcm1pbmUKICAvLyB3aGV0aGVyIHRvIGNhbGwgaW5zZXJ0ZWQKICAvLyBJZiB3ZSBjYW4gZmFjdG9yIHRoZXNlIGNhc2VzIGludG8gc2VwYXJhdGUgY29kZSBwYXRocyB3ZSBjYW4gaGF2ZQogIC8vIGJldHRlciBkaWFnbm9zdGljcy4KICAvLyBUT0RPKHNqbWlsZXMpOiB3aGVuIGxvZ2dpbmcsIGRvIHdvcmsgb24gYWxsIGN1c3RvbSBlbGVtZW50cyBzbyB3ZSBjYW4KICAvLyB0cmFjayBiZWhhdmlvciBldmVuIHdoZW4gY2FsbGJhY2tzIG5vdCBkZWZpbmVkCiAgLy9jb25zb2xlLmxvZygnaW5zZXJ0ZWQ6ICcsIGVsZW1lbnQubG9jYWxOYW1lKTsKICBpZiAoZWxlbWVudC5lbnRlcmVkVmlld0NhbGxiYWNrIHx8IChlbGVtZW50Ll9fdXBncmFkZWRfXyAmJiBsb2dGbGFncy5kb20pKSB7CiAgICBsb2dGbGFncy5kb20gJiYgY29uc29sZS5ncm91cCgnaW5zZXJ0ZWQ6JywgZWxlbWVudC5sb2NhbE5hbWUpOwogICAgaWYgKGluRG9jdW1lbnQoZWxlbWVudCkpIHsKICAgICAgZWxlbWVudC5fX2luc2VydGVkID0gKGVsZW1lbnQuX19pbnNlcnRlZCB8fCAwKSArIDE7CiAgICAgIC8vIGlmIHdlIGFyZSBpbiBhICdyZW1vdmVkJyBzdGF0ZSwgYmx1bnRseSBhZGp1c3QgdG8gYW4gJ2luc2VydGVkJyBzdGF0ZQogICAgICBpZiAoZWxlbWVudC5fX2luc2VydGVkIDwgMSkgewogICAgICAgIGVsZW1lbnQuX19pbnNlcnRlZCA9IDE7CiAgICAgIH0KICAgICAgLy8gaWYgd2UgYXJlICdvdmVyIGluc2VydGVkJywgc3F1ZWxjaCB0aGUgY2FsbGJhY2sKICAgICAgaWYgKGVsZW1lbnQuX19pbnNlcnRlZCA+IDEpIHsKICAgICAgICBsb2dGbGFncy5kb20gJiYgY29uc29sZS53YXJuKCdpbnNlcnRlZDonLCBlbGVtZW50LmxvY2FsTmFtZSwKICAgICAgICAgICdpbnNlcnQvcmVtb3ZlIGNvdW50OicsIGVsZW1lbnQuX19pbnNlcnRlZCkKICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmVudGVyZWRWaWV3Q2FsbGJhY2spIHsKICAgICAgICBsb2dGbGFncy5kb20gJiYgY29uc29sZS5sb2coJ2luc2VydGVkOicsIGVsZW1lbnQubG9jYWxOYW1lKTsKICAgICAgICBlbGVtZW50LmVudGVyZWRWaWV3Q2FsbGJhY2soKTsKICAgICAgfQogICAgfQogICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUuZ3JvdXBFbmQoKTsKICB9Cn0KCmZ1bmN0aW9uIHJlbW92ZWROb2RlKG5vZGUpIHsKICByZW1vdmVkKG5vZGUpOwogIGZvclN1YnRyZWUobm9kZSwgZnVuY3Rpb24oZSkgewogICAgcmVtb3ZlZChlKTsKICB9KTsKfQoKCmZ1bmN0aW9uIHJlbW92ZWQoZWxlbWVudCkgewogIGlmIChoYXNQb2x5ZmlsbE11dGF0aW9ucykgewogICAgZGVmZXJNdXRhdGlvbihmdW5jdGlvbigpIHsKICAgICAgX3JlbW92ZWQoZWxlbWVudCk7CiAgICB9KTsKICB9IGVsc2UgewogICAgX3JlbW92ZWQoZWxlbWVudCk7CiAgfQp9CgpmdW5jdGlvbiByZW1vdmVkKGVsZW1lbnQpIHsKICAvLyBUT0RPKHNqbWlsZXMpOiB0ZW1wb3Jhcnk6IGRvIHdvcmsgb24gYWxsIGN1c3RvbSBlbGVtZW50cyBzbyB3ZSBjYW4gdHJhY2sKICAvLyBiZWhhdmlvciBldmVuIHdoZW4gY2FsbGJhY2tzIG5vdCBkZWZpbmVkCiAgaWYgKGVsZW1lbnQubGVmdFZpZXdDYWxsYmFjayB8fCAoZWxlbWVudC5fX3VwZ3JhZGVkX18gJiYgbG9nRmxhZ3MuZG9tKSkgewogICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUubG9nKCdyZW1vdmVkOicsIGVsZW1lbnQubG9jYWxOYW1lKTsKICAgIGlmICghaW5Eb2N1bWVudChlbGVtZW50KSkgewogICAgICBlbGVtZW50Ll9faW5zZXJ0ZWQgPSAoZWxlbWVudC5fX2luc2VydGVkIHx8IDApIC0gMTsKICAgICAgLy8gaWYgd2UgYXJlIGluIGEgJ2luc2VydGVkJyBzdGF0ZSwgYmx1bnRseSBhZGp1c3QgdG8gYW4gJ3JlbW92ZWQnIHN0YXRlCiAgICAgIGlmIChlbGVtZW50Ll9faW5zZXJ0ZWQgPiAwKSB7CiAgICAgICAgZWxlbWVudC5fX2luc2VydGVkID0gMDsKICAgICAgfQogICAgICAvLyBpZiB3ZSBhcmUgJ292ZXIgcmVtb3ZlZCcsIHNxdWVsY2ggdGhlIGNhbGxiYWNrCiAgICAgIGlmIChlbGVtZW50Ll9faW5zZXJ0ZWQgPCAwKSB7CiAgICAgICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUud2FybigncmVtb3ZlZDonLCBlbGVtZW50LmxvY2FsTmFtZSwKICAgICAgICAgICAgJ2luc2VydC9yZW1vdmUgY291bnQ6JywgZWxlbWVudC5fX2luc2VydGVkKQogICAgICB9IGVsc2UgaWYgKGVsZW1lbnQubGVmdFZpZXdDYWxsYmFjaykgewogICAgICAgIGVsZW1lbnQubGVmdFZpZXdDYWxsYmFjaygpOwogICAgICB9CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBpbkRvY3VtZW50KGVsZW1lbnQpIHsKICB2YXIgcCA9IGVsZW1lbnQ7CiAgdmFyIGRvYyA9IHdpbmRvdy5TaGFkb3dET01Qb2x5ZmlsbCAmJgogICAgICB3aW5kb3cuU2hhZG93RE9NUG9seWZpbGwud3JhcElmTmVlZGVkKGRvY3VtZW50KSB8fCBkb2N1bWVudDsKICB3aGlsZSAocCkgewogICAgaWYgKHAgPT0gZG9jKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcCA9IHAucGFyZW50Tm9kZSB8fCBwLmhvc3Q7CiAgfQp9CgpmdW5jdGlvbiB3YXRjaFNoYWRvdyhub2RlKSB7CiAgaWYgKG5vZGUuc2hhZG93Um9vdCAmJiAhbm9kZS5zaGFkb3dSb290Ll9fd2F0Y2hlZCkgewogICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUubG9nKCd3YXRjaGluZyBzaGFkb3ctcm9vdCBmb3I6ICcsIG5vZGUubG9jYWxOYW1lKTsKICAgIC8vIHdhdGNoIGFsbCB1bndhdGNoZWQgcm9vdHMuLi4KICAgIHZhciByb290ID0gbm9kZS5zaGFkb3dSb290OwogICAgd2hpbGUgKHJvb3QpIHsKICAgICAgd2F0Y2hSb290KHJvb3QpOwogICAgICByb290ID0gcm9vdC5vbGRlclNoYWRvd1Jvb3Q7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiB3YXRjaFJvb3Qocm9vdCkgewogIGlmICghcm9vdC5fX3dhdGNoZWQpIHsKICAgIG9ic2VydmUocm9vdCk7CiAgICByb290Ll9fd2F0Y2hlZCA9IHRydWU7CiAgfQp9CgpmdW5jdGlvbiBmaWx0ZXIoaW5Ob2RlKSB7CiAgc3dpdGNoIChpbk5vZGUubG9jYWxOYW1lKSB7CiAgICBjYXNlICdzdHlsZSc6CiAgICBjYXNlICdzY3JpcHQnOgogICAgY2FzZSAndGVtcGxhdGUnOgogICAgY2FzZSB1bmRlZmluZWQ6CiAgICAgIHJldHVybiB0cnVlOwogIH0KfQoKZnVuY3Rpb24gaGFuZGxlcihtdXRhdGlvbnMpIHsKICAvLwogIGlmIChsb2dGbGFncy5kb20pIHsKICAgIHZhciBteCA9IG11dGF0aW9uc1swXTsKICAgIGlmIChteCAmJiBteC50eXBlID09PSAnY2hpbGRMaXN0JyAmJiBteC5hZGRlZE5vZGVzKSB7CiAgICAgICAgaWYgKG14LmFkZGVkTm9kZXMpIHsKICAgICAgICAgIHZhciBkID0gbXguYWRkZWROb2Rlc1swXTsKICAgICAgICAgIHdoaWxlIChkICYmIGQgIT09IGRvY3VtZW50ICYmICFkLmhvc3QpIHsKICAgICAgICAgICAgZCA9IGQucGFyZW50Tm9kZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciB1ID0gZCAmJiAoZC5VUkwgfHwgZC5fVVJMIHx8IChkLmhvc3QgJiYgZC5ob3N0LmxvY2FsTmFtZSkpIHx8ICcnOwogICAgICAgICAgdSA9IHUuc3BsaXQoJy8/Jykuc2hpZnQoKS5zcGxpdCgnLycpLnBvcCgpOwogICAgICAgIH0KICAgIH0KICAgIGNvbnNvbGUuZ3JvdXAoJ211dGF0aW9ucyAoJWQpIFslc10nLCBtdXRhdGlvbnMubGVuZ3RoLCB1IHx8ICcnKTsKICB9CiAgLy8KICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihteCkgewogICAgLy9sb2dGbGFncy5kb20gJiYgY29uc29sZS5ncm91cCgnbXV0YXRpb24nKTsKICAgIGlmIChteC50eXBlID09PSAnY2hpbGRMaXN0JykgewogICAgICBmb3JFYWNoKG14LmFkZGVkTm9kZXMsIGZ1bmN0aW9uKG4pIHsKICAgICAgICAvL2xvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmxvZyhuLmxvY2FsTmFtZSk7CiAgICAgICAgaWYgKGZpbHRlcihuKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyBub2RlcyBhZGRlZCBtYXkgbmVlZCBsaWZlY3ljbGUgbWFuYWdlbWVudAogICAgICAgIGFkZGVkTm9kZShuKTsKICAgICAgfSk7CiAgICAgIC8vIHJlbW92ZWQgbm9kZXMgbWF5IG5lZWQgbGlmZWN5Y2xlIG1hbmFnZW1lbnQKICAgICAgZm9yRWFjaChteC5yZW1vdmVkTm9kZXMsIGZ1bmN0aW9uKG4pIHsKICAgICAgICAvL2xvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmxvZyhuLmxvY2FsTmFtZSk7CiAgICAgICAgaWYgKGZpbHRlcihuKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByZW1vdmVkTm9kZShuKTsKICAgICAgfSk7CiAgICB9CiAgICAvL2xvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmdyb3VwRW5kKCk7CiAgfSk7CiAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUuZ3JvdXBFbmQoKTsKfTsKCnZhciBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGhhbmRsZXIpOwoKZnVuY3Rpb24gdGFrZVJlY29yZHMoKSB7CiAgLy8gVE9ETyhzam1pbGVzKTogYXNrIFJhZiB3aHkgd2UgaGF2ZSB0byBjYWxsIGhhbmRsZXIgb3Vyc2VsdmVzCiAgaGFuZGxlcihvYnNlcnZlci50YWtlUmVjb3JkcygpKTsKICB0YWtlTXV0YXRpb25zKCk7Cn0KCnZhciBmb3JFYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbC5iaW5kKEFycmF5LnByb3RvdHlwZS5mb3JFYWNoKTsKCmZ1bmN0aW9uIG9ic2VydmUoaW5Sb290KSB7CiAgb2JzZXJ2ZXIub2JzZXJ2ZShpblJvb3QsIHtjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9KTsKfQoKZnVuY3Rpb24gb2JzZXJ2ZURvY3VtZW50KGRvY3VtZW50KSB7CiAgb2JzZXJ2ZShkb2N1bWVudCk7Cn0KCmZ1bmN0aW9uIHVwZ3JhZGVEb2N1bWVudChkb2N1bWVudCkgewogIGxvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmdyb3VwKCd1cGdyYWRlRG9jdW1lbnQ6ICcsIChkb2N1bWVudC5VUkwgfHwgZG9jdW1lbnQuX1VSTCB8fCAnJykuc3BsaXQoJy8nKS5wb3AoKSk7CiAgYWRkZWROb2RlKGRvY3VtZW50KTsKICBsb2dGbGFncy5kb20gJiYgY29uc29sZS5ncm91cEVuZCgpOwp9CgovLyBleHBvcnRzCgpzY29wZS53YXRjaFNoYWRvdyA9IHdhdGNoU2hhZG93OwpzY29wZS51cGdyYWRlQWxsID0gYWRkZWROb2RlOwpzY29wZS51cGdyYWRlU3VidHJlZSA9IGFkZGVkU3VidHJlZTsKCnNjb3BlLm9ic2VydmVEb2N1bWVudCA9IG9ic2VydmVEb2N1bWVudDsKc2NvcGUudXBncmFkZURvY3VtZW50ID0gdXBncmFkZURvY3VtZW50OwoKc2NvcGUudGFrZVJlY29yZHMgPSB0YWtlUmVjb3JkczsKCn0pKHdpbmRvdy5DdXN0b21FbGVtZW50cyk7CgovKgogKiBDb3B5cmlnaHQgMjAxMyBUaGUgUG9seW1lciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZQogKiBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuCiAqLwoKKGZ1bmN0aW9uKHNjb3BlKSB7CgppZiAoIXNjb3BlKSB7CiAgc2NvcGUgPSB3aW5kb3cuSFRNTEltcG9ydHMgPSB7ZmxhZ3M6e319Owp9CgovLyBpbXBvcnRzCgp2YXIgeGhyID0gc2NvcGUueGhyOwoKLy8gaW1wb3J0ZXIKCnZhciBJTVBPUlRfTElOS19UWVBFID0gJ2ltcG9ydCc7CnZhciBTVFlMRV9MSU5LX1RZUEUgPSAnc3R5bGVzaGVldCc7CgovLyBoaWdobGFuZGVyIG9iamVjdCByZXByZXNlbnRzIGEgcHJpbWFyeSBkb2N1bWVudCAodGhlIGFyZ3VtZW50IHRvICdsb2FkJykKLy8gYXQgdGhlIHJvb3Qgb2YgYSB0cmVlIG9mIGRvY3VtZW50cwoKLy8gZm9yIGFueSBkb2N1bWVudCwgaW1wb3J0ZXI6Ci8vIC0gbG9hZHMgYW55IGxpbmtlZCBkb2N1bWVudHMgKHdpdGggZGVkdXBpbmcpLCBtb2RpZmllcyBwYXRocyBhbmQgZmVlZHMgdGhlbSBiYWNrIGludG8gaW1wb3J0ZXIKLy8gLSBsb2FkcyB0ZXh0IG9mIGV4dGVybmFsIHNjcmlwdCB0YWdzCi8vIC0gbG9hZHMgdGV4dCBvZiBleHRlcm5hbCBzdHlsZSB0YWdzIGluc2lkZSBvZiA8ZWxlbWVudD4sIG1vZGlmaWVzIHBhdGhzCgovLyB3aGVuIGltcG9ydGVyICdtb2RpZmllcyBwYXRocycgaW4gYSBkb2N1bWVudCwgdGhpcyBpbmNsdWRlcwovLyAtIGhyZWYvc3JjL2FjdGlvbiBpbiBub2RlIGF0dHJpYnV0ZXMKLy8gLSBwYXRocyBpbiBpbmxpbmUgc3R5bGVzaGVldHMKLy8gLSBhbGwgY29udGVudCBpbnNpZGUgdGVtcGxhdGVzCgovLyBsaW5rZWQgc3R5bGUgc2hlZXRzIGluIGFuIGltcG9ydCBoYXZlIHRoZWlyIG93biBwYXRoIGZpeGVkIHVwIHdoZW4gdGhlaXIgY29udGFpbmluZyBpbXBvcnQgbW9kaWZpZXMgcGF0aHMKLy8gbGlua2VkIHN0eWxlIHNoZWV0cyBpbiBhbiA8ZWxlbWVudD4gYXJlIGxvYWRlZCwgYW5kIHRoZSBjb250ZW50IGdldHMgcGF0aCBmaXh1cHMKLy8gaW5saW5lIHN0eWxlIHNoZWV0cyBnZXQgcGF0aCBmaXh1cHMgd2hlbiB0aGVpciBjb250YWluaW5nIGltcG9ydCBtb2RpZmllcyBwYXRocwoKdmFyIGxvYWRlcjsKCnZhciBpbXBvcnRlciA9IHsKICBkb2N1bWVudHM6IHt9LAogIGNhY2hlOiB7fSwKICBwcmVsb2FkU2VsZWN0b3JzOiBbCiAgICAnbGlua1tyZWw9JyArIElNUE9SVF9MSU5LX1RZUEUgKyAnXScsCiAgICAnZWxlbWVudCBsaW5rW3JlbD0nICsgU1RZTEVfTElOS19UWVBFICsgJ10nLAogICAgJ3RlbXBsYXRlJywKICAgICdzY3JpcHRbc3JjXTpub3QoW3R5cGVdKScsCiAgICAnc2NyaXB0W3NyY11bdHlwZT0idGV4dC9qYXZhc2NyaXB0Il0nCiAgXS5qb2luKCcsJyksCiAgbG9hZGVyOiBmdW5jdGlvbihuZXh0KSB7CiAgICAvLyBjb25zdHJ1Y3QgYSBsb2FkZXIgaW5zdGFuY2UKICAgIGxvYWRlciA9IG5ldyBMb2FkZXIoaW1wb3J0ZXIubG9hZGVkLCBuZXh0KTsKICAgIC8vIGFsaWFzIHRoZSBsb2FkZXIgY2FjaGUgKGZvciBkZWJ1Z2dpbmcpCiAgICBsb2FkZXIuY2FjaGUgPSBpbXBvcnRlci5jYWNoZTsKICAgIHJldHVybiBsb2FkZXI7CiAgfSwKICBsb2FkOiBmdW5jdGlvbihkb2MsIG5leHQpIHsKICAgIC8vIGNvbnN0cnVjdCBhIGxvYWRlciBpbnN0YW5jZQogICAgbG9hZGVyID0gaW1wb3J0ZXIubG9hZGVyKG5leHQpOwogICAgLy8gYWRkIG5vZGVzIGZyb20gZG9jdW1lbnQgaW50byBsb2FkZXIgcXVldWUKICAgIGltcG9ydGVyLnByZWxvYWQoZG9jKTsKICB9LAogIHByZWxvYWQ6IGZ1bmN0aW9uKGRvYykgewogICAgLy8gYWxsIHByZWxvYWRhYmxlIG5vZGVzIGluIGluRG9jdW1lbnQKICAgIHZhciBub2RlcyA9IGRvYy5xdWVyeVNlbGVjdG9yQWxsKGltcG9ydGVyLnByZWxvYWRTZWxlY3RvcnMpOwogICAgLy8gZnJvbSB0aGUgbWFpbiBkb2N1bWVudCwgb25seSBsb2FkIGltcG9ydHMKICAgIC8vIFRPRE8oc2ptaWxlcyk6IGRvIHRoaXMgYnkgYWx0ZXJpbmcgdGhlIHNlbGVjdG9yIGxpc3QgaW5zdGVhZAogICAgbm9kZXMgPSB0aGlzLmZpbHRlck1haW5Eb2N1bWVudE5vZGVzKGRvYywgbm9kZXMpOwogICAgLy8gZXh0cmEgbGluayBub2RlcyBmcm9tIHRlbXBsYXRlcywgZmlsdGVyIHRlbXBsYXRlcyBvdXQgb2YgdGhlIG5vZGVzIGxpc3QKICAgIG5vZGVzID0gdGhpcy5leHRyYWN0VGVtcGxhdGVOb2Rlcyhub2Rlcyk7CiAgICAvLyBhZGQgdGhlc2Ugbm9kZXMgdG8gbG9hZGVyJ3MgcXVldWUKICAgIGxvYWRlci5hZGROb2Rlcyhub2Rlcyk7CiAgfSwKICBmaWx0ZXJNYWluRG9jdW1lbnROb2RlczogZnVuY3Rpb24oZG9jLCBub2RlcykgewogICAgaWYgKGRvYyA9PT0gZG9jdW1lbnQpIHsKICAgICAgbm9kZXMgPSBBcnJheS5wcm90b3R5cGUuZmlsdGVyLmNhbGwobm9kZXMsIGZ1bmN0aW9uKG4pIHsKICAgICAgICByZXR1cm4gIWlzU2NyaXB0KG4pOwogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBub2RlczsKICB9LAogIGV4dHJhY3RUZW1wbGF0ZU5vZGVzOiBmdW5jdGlvbihub2RlcykgewogICAgdmFyIGV4dHJhID0gW107CiAgICBub2RlcyA9IEFycmF5LnByb3RvdHlwZS5maWx0ZXIuY2FsbChub2RlcywgZnVuY3Rpb24obikgewogICAgICBpZiAobi5sb2NhbE5hbWUgPT09ICd0ZW1wbGF0ZScpIHsKICAgICAgICBpZiAobi5jb250ZW50KSB7CiAgICAgICAgICB2YXIgbCQgPSBuLmNvbnRlbnQucXVlcnlTZWxlY3RvckFsbCgnbGlua1tyZWw9JyArIFNUWUxFX0xJTktfVFlQRSArCiAgICAgICAgICAgICddJyk7CiAgICAgICAgICBpZiAobCQubGVuZ3RoKSB7CiAgICAgICAgICAgIGV4dHJhID0gZXh0cmEuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGwkLCAwKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0pOwogICAgaWYgKGV4dHJhLmxlbmd0aCkgewogICAgICBub2RlcyA9IG5vZGVzLmNvbmNhdChleHRyYSk7CiAgICB9CiAgICByZXR1cm4gbm9kZXM7CiAgfSwKICBsb2FkZWQ6IGZ1bmN0aW9uKHVybCwgZWx0LCByZXNvdXJjZSkgewogICAgaWYgKGlzRG9jdW1lbnRMaW5rKGVsdCkpIHsKICAgICAgdmFyIGRvY3VtZW50ID0gaW1wb3J0ZXIuZG9jdW1lbnRzW3VybF07CiAgICAgIC8vIGlmIHdlJ3ZlIG5ldmVyIHNlZW4gYSBkb2N1bWVudCBhdCB0aGlzIHVybAogICAgICBpZiAoIWRvY3VtZW50KSB7CiAgICAgICAgLy8gZ2VuZXJhdGUgYW4gSFRNTERvY3VtZW50IGZyb20gZGF0YQogICAgICAgIGRvY3VtZW50ID0gbWFrZURvY3VtZW50KHJlc291cmNlLCB1cmwpOwogICAgICAgIC8vIHJlc29sdmUgcmVzb3VyY2UgcGF0aHMgcmVsYXRpdmUgdG8gaG9zdCBkb2N1bWVudAogICAgICAgIHBhdGgucmVzb2x2ZVBhdGhzSW5IVE1MKGRvY3VtZW50KTsKICAgICAgICAvLyBjYWNoZSBkb2N1bWVudAogICAgICAgIGltcG9ydGVyLmRvY3VtZW50c1t1cmxdID0gZG9jdW1lbnQ7CiAgICAgICAgLy8gYWRkIG5vZGVzIGZyb20gdGhpcyBkb2N1bWVudCB0byB0aGUgbG9hZGVyIHF1ZXVlCiAgICAgICAgaW1wb3J0ZXIucHJlbG9hZChkb2N1bWVudCk7CiAgICAgIH0KICAgICAgLy8gc3RvcmUgaW1wb3J0IHJlY29yZAogICAgICBlbHQuaW1wb3J0ID0gewogICAgICAgIGhyZWY6IHVybCwKICAgICAgICBvd25lck5vZGU6IGVsdCwKICAgICAgICBjb250ZW50OiBkb2N1bWVudAogICAgICB9OwogICAgICAvLyBzdG9yZSBkb2N1bWVudCByZXNvdXJjZQogICAgICBlbHQuY29udGVudCA9IHJlc291cmNlID0gZG9jdW1lbnQ7CiAgICB9CiAgICAvLyBzdG9yZSBnZW5lcmljIHJlc291cmNlCiAgICAvLyBUT0RPKHNvcnZlbGwpOiBmYWlscyBmb3Igbm9kZXMgaW5zaWRlIDx0ZW1wbGF0ZT4uY29udGVudAogICAgLy8gc2VlIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0yNDkzODEuCiAgICBlbHQuX19yZXNvdXJjZSA9IHJlc291cmNlOwogICAgLy8gY3NzIHBhdGggZml4dXBzCiAgICBpZiAoaXNTdHlsZXNoZWV0TGluayhlbHQpKSB7CiAgICAgIHBhdGgucmVzb2x2ZVBhdGhzSW5TdHlsZXNoZWV0KGVsdCk7CiAgICB9CiAgfQp9OwoKZnVuY3Rpb24gaXNEb2N1bWVudExpbmsoZWx0KSB7CiAgcmV0dXJuIGlzTGlua1JlbChlbHQsIElNUE9SVF9MSU5LX1RZUEUpOwp9CgpmdW5jdGlvbiBpc1N0eWxlc2hlZXRMaW5rKGVsdCkgewogIHJldHVybiBpc0xpbmtSZWwoZWx0LCBTVFlMRV9MSU5LX1RZUEUpOwp9CgpmdW5jdGlvbiBpc0xpbmtSZWwoZWx0LCByZWwpIHsKICByZXR1cm4gZWx0LmxvY2FsTmFtZSA9PT0gJ2xpbmsnICYmIGVsdC5nZXRBdHRyaWJ1dGUoJ3JlbCcpID09PSByZWw7Cn0KCmZ1bmN0aW9uIGlzU2NyaXB0KGVsdCkgewogIHJldHVybiBlbHQubG9jYWxOYW1lID09PSAnc2NyaXB0JzsKfQoKZnVuY3Rpb24gbWFrZURvY3VtZW50KHJlc291cmNlLCB1cmwpIHsKICAvLyBjcmVhdGUgYSBuZXcgSFRNTCBkb2N1bWVudAogIHZhciBkb2MgPSByZXNvdXJjZTsKICBpZiAoIShkb2MgaW5zdGFuY2VvZiBEb2N1bWVudCkpIHsKICAgIGRvYyA9IGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudChJTVBPUlRfTElOS19UWVBFKTsKICAgIC8vIGluc3RhbGwgaHRtbAogICAgZG9jLmJvZHkuaW5uZXJIVE1MID0gcmVzb3VyY2U7CiAgfQogIC8vIGNhY2hlIHRoZSBuZXcgZG9jdW1lbnQncyBzb3VyY2UgdXJsCiAgZG9jLl9VUkwgPSB1cmw7CiAgLy8gZXN0YWJsaXNoIGEgcmVsYXRpdmUgcGF0aCB2aWEgPGJhc2U+CiAgdmFyIGJhc2UgPSBkb2MuY3JlYXRlRWxlbWVudCgnYmFzZScpOwogIGJhc2Uuc2V0QXR0cmlidXRlKCdocmVmJywgZG9jdW1lbnQuYmFzZVVSSSB8fCBkb2N1bWVudC5VUkwpOwogIGRvYy5oZWFkLmFwcGVuZENoaWxkKGJhc2UpOwogIC8vIFRPRE8oc29ydmVsbCk6IGlkZWFsbHkgdGhpcyBjb2RlIGlzIG5vdCBhd2FyZSBvZiBUZW1wbGF0ZSBwb2x5ZmlsbCwKICAvLyBidXQgZm9yIG5vdyB0aGUgcG9seWZpbGwgbmVlZHMgaGVscCB0byBib290c3RyYXAgdGhlc2UgdGVtcGxhdGVzCiAgaWYgKHdpbmRvdy5IVE1MVGVtcGxhdGVFbGVtZW50ICYmIEhUTUxUZW1wbGF0ZUVsZW1lbnQuYm9vdHN0cmFwKSB7CiAgICBIVE1MVGVtcGxhdGVFbGVtZW50LmJvb3RzdHJhcChkb2MpOwogIH0KICByZXR1cm4gZG9jOwp9Cgp2YXIgTG9hZGVyID0gZnVuY3Rpb24ob25Mb2FkLCBvbkNvbXBsZXRlKSB7CiAgdGhpcy5vbmxvYWQgPSBvbkxvYWQ7CiAgdGhpcy5vbmNvbXBsZXRlID0gb25Db21wbGV0ZTsKICB0aGlzLmluZmxpZ2h0ID0gMDsKICB0aGlzLnBlbmRpbmcgPSB7fTsKICB0aGlzLmNhY2hlID0ge307Cn07CgpMb2FkZXIucHJvdG90eXBlID0gewogIGFkZE5vZGVzOiBmdW5jdGlvbihub2RlcykgewogICAgLy8gbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyB0byBjb21wbGV0ZQogICAgdGhpcy5pbmZsaWdodCArPSBub2Rlcy5sZW5ndGg7CiAgICAvLyBjb21tZW5jZSB0cmFuc2FjdGlvbnMKICAgIGZvckVhY2gobm9kZXMsIHRoaXMucmVxdWlyZSwgdGhpcyk7CiAgICAvLyBhbnl0aGluZyB0byBkbz8KICAgIHRoaXMuY2hlY2tEb25lKCk7CiAgfSwKICByZXF1aXJlOiBmdW5jdGlvbihlbHQpIHsKICAgIHZhciB1cmwgPSBwYXRoLm5vZGVVcmwoZWx0KTsKICAgIC8vIFRPRE8oc2ptaWxlcyk6IGFkLWhvYwogICAgZWx0Ll9fbm9kZVVybCA9IHVybDsKICAgIC8vIGRlZHVwbGljYXRpb24KICAgIGlmICghdGhpcy5kZWR1cGUodXJsLCBlbHQpKSB7CiAgICAgIC8vIGZldGNoIHRoaXMgcmVzb3VyY2UKICAgICAgdGhpcy5mZXRjaCh1cmwsIGVsdCk7CiAgICB9CiAgfSwKICBkZWR1cGU6IGZ1bmN0aW9uKHVybCwgZWx0KSB7CiAgICBpZiAodGhpcy5wZW5kaW5nW3VybF0pIHsKICAgICAgLy8gYWRkIHRvIGxpc3Qgb2Ygbm9kZXMgd2FpdGluZyBmb3IgaW5VcmwKICAgICAgdGhpcy5wZW5kaW5nW3VybF0ucHVzaChlbHQpOwogICAgICAvLyBkb24ndCBuZWVkIGZldGNoCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHRoaXMuY2FjaGVbdXJsXSkgewogICAgICAvLyBjb21wbGV0ZSBsb2FkIHVzaW5nIGNhY2hlIGRhdGEKICAgICAgdGhpcy5vbmxvYWQodXJsLCBlbHQsIGxvYWRlci5jYWNoZVt1cmxdKTsKICAgICAgLy8gZmluaXNoZWQgdGhpcyB0cmFuc2FjdGlvbgogICAgICB0aGlzLnRhaWwoKTsKICAgICAgLy8gZG9uJ3QgbmVlZCBmZXRjaAogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8vIGZpcnN0IG5vZGUgd2FpdGluZyBmb3IgaW5VcmwKICAgIHRoaXMucGVuZGluZ1t1cmxdID0gW2VsdF07CiAgICAvLyBuZWVkIGZldGNoIChub3QgYSBkdXBlKQogICAgcmV0dXJuIGZhbHNlOwogIH0sCiAgZmV0Y2g6IGZ1bmN0aW9uKHVybCwgZWx0KSB7CiAgICB2YXIgcmVjZWl2ZVhociA9IGZ1bmN0aW9uKGVyciwgcmVzb3VyY2UpIHsKICAgICAgdGhpcy5yZWNlaXZlKHVybCwgZWx0LCBlcnIsIHJlc291cmNlKTsKICAgIH0uYmluZCh0aGlzKTsKICAgIHhoci5sb2FkKHVybCwgcmVjZWl2ZVhocik7CiAgICAvLyBUT0RPKHNvcnZlbGwpOiBibG9ja2VkIG9uCiAgICAvLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9MjU3MjIxCiAgICAvLyB4aHInaW5nIGZvciBhIGRvY3VtZW50IG1ha2VzIHNjcmlwdHMgaW4gaW1wb3J0cyBydW5uYWJsZTsgb3RoZXJ3aXNlCiAgICAvLyB0aGV5IGFyZSBub3Q7IGhvd2V2ZXIsIGl0IHJlcXVpcmVzIHRoYXQgd2UgaGF2ZSBkb2N0eXBlPWh0bWwgaW4KICAgIC8vIHRoZSBpbXBvcnQgd2hpY2ggaXMgdW5hY2NlcHRhYmxlLiBUaGlzIGlzIG9ubHkgbmVlZGVkIG9uIENocm9tZQogICAgLy8gdG8gYXZvaWQgdGhlIGJ1ZyBhYm92ZS4KICAgIC8qCiAgICBpZiAoaXNEb2N1bWVudExpbmsoZWx0KSkgewogICAgICB4aHIubG9hZERvY3VtZW50KHVybCwgcmVjZWl2ZVhocik7CiAgICB9IGVsc2UgewogICAgICB4aHIubG9hZCh1cmwsIHJlY2VpdmVYaHIpOwogICAgfQogICAgKi8KICB9LAogIHJlY2VpdmU6IGZ1bmN0aW9uKHVybCwgZWx0LCBlcnIsIHJlc291cmNlKSB7CiAgICBpZiAoIWVycikgewogICAgICBsb2FkZXIuY2FjaGVbdXJsXSA9IHJlc291cmNlOwogICAgfQogICAgbG9hZGVyLnBlbmRpbmdbdXJsXS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFlcnIpIHsKICAgICAgICB0aGlzLm9ubG9hZCh1cmwsIGUsIHJlc291cmNlKTsKICAgICAgfQogICAgICB0aGlzLnRhaWwoKTsKICAgIH0sIHRoaXMpOwogICAgbG9hZGVyLnBlbmRpbmdbdXJsXSA9IG51bGw7CiAgfSwKICB0YWlsOiBmdW5jdGlvbigpIHsKICAgIC0tdGhpcy5pbmZsaWdodDsKICAgIHRoaXMuY2hlY2tEb25lKCk7CiAgfSwKICBjaGVja0RvbmU6IGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLmluZmxpZ2h0KSB7CiAgICAgIHRoaXMub25jb21wbGV0ZSgpOwogICAgfQogIH0KfTsKCnZhciBVUkxfQVRUUlMgPSBbJ2hyZWYnLCAnc3JjJywgJ2FjdGlvbiddOwp2YXIgVVJMX0FUVFJTX1NFTEVDVE9SID0gJ1snICsgVVJMX0FUVFJTLmpvaW4oJ10sWycpICsgJ10nOwp2YXIgVVJMX1RFTVBMQVRFX1NFQVJDSCA9ICd7ey4qfX0nOwoKdmFyIHBhdGggPSB7CiAgbm9kZVVybDogZnVuY3Rpb24obm9kZSkgewogICAgcmV0dXJuIHBhdGgucmVzb2x2ZVVybChwYXRoLmRvY3VtZW50VVJMLCBwYXRoLmhyZWZPclNyYyhub2RlKSk7CiAgfSwKICBocmVmT3JTcmM6IGZ1bmN0aW9uKG5vZGUpIHsKICAgIHJldHVybiBub2RlLmdldEF0dHJpYnV0ZSgiaHJlZiIpIHx8IG5vZGUuZ2V0QXR0cmlidXRlKCJzcmMiKTsKICB9LAogIGRvY3VtZW50VXJsRnJvbU5vZGU6IGZ1bmN0aW9uKG5vZGUpIHsKICAgIHJldHVybiBwYXRoLmdldERvY3VtZW50VXJsKG5vZGUub3duZXJEb2N1bWVudCB8fCBub2RlKTsKICB9LAogIGdldERvY3VtZW50VXJsOiBmdW5jdGlvbihkb2MpIHsKICAgIHZhciB1cmwgPSBkb2MgJiYKICAgICAgICAvLyBUT0RPKHNqbWlsZXMpOiBTaGFkb3dET01Qb2x5ZmlsbCBpbnRydXNpb24KICAgICAgICAoZG9jLl9VUkwgfHwgKGRvYy5pbXBsICYmIGRvYy5pbXBsLl9VUkwpCiAgICAgICAgICAgIHx8IGRvYy5iYXNlVVJJIHx8IGRvYy5VUkwpCiAgICAgICAgICAgICAgICB8fCAnJzsKICAgIC8vIHRha2Ugb25seSB0aGUgbGVmdCBzaWRlIGlmIHRoZXJlIGlzIGEgIwogICAgcmV0dXJuIHVybC5zcGxpdCgnIycpWzBdOwogIH0sCiAgcmVzb2x2ZVVybDogZnVuY3Rpb24oYmFzZVVybCwgdXJsKSB7CiAgICBpZiAodGhpcy5pc0Fic1VybCh1cmwpKSB7CiAgICAgIHJldHVybiB1cmw7CiAgICB9CiAgICByZXR1cm4gdGhpcy5jb21wcmVzc1VybCh0aGlzLnVybFRvUGF0aChiYXNlVXJsKSArIHVybCk7CiAgfSwKICByZXNvbHZlUmVsYXRpdmVVcmw6IGZ1bmN0aW9uKGJhc2VVcmwsIHVybCkgewogICAgaWYgKHRoaXMuaXNBYnNVcmwodXJsKSkgewogICAgICByZXR1cm4gdXJsOwogICAgfQogICAgcmV0dXJuIHRoaXMubWFrZURvY3VtZW50UmVsUGF0aCh0aGlzLnJlc29sdmVVcmwoYmFzZVVybCwgdXJsKSk7CiAgfSwKICBpc0Fic1VybDogZnVuY3Rpb24odXJsKSB7CiAgICByZXR1cm4gLyheZGF0YTopfCheaHR0cFtzXT86KXwoXlwvKS8udGVzdCh1cmwpOwogIH0sCiAgdXJsVG9QYXRoOiBmdW5jdGlvbihiYXNlVXJsKSB7CiAgICB2YXIgcGFydHMgPSBiYXNlVXJsLnNwbGl0KCIvIik7CiAgICBwYXJ0cy5wb3AoKTsKICAgIHBhcnRzLnB1c2goJycpOwogICAgcmV0dXJuIHBhcnRzLmpvaW4oIi8iKTsKICB9LAogIGNvbXByZXNzVXJsOiBmdW5jdGlvbih1cmwpIHsKICAgIHZhciBzZWFyY2ggPSAnJzsKICAgIHZhciBzZWFyY2hQb3MgPSB1cmwuaW5kZXhPZignPycpOwogICAgLy8gcXVlcnkgc3RyaW5nIGlzIG5vdCBwYXJ0IG9mIHRoZSBwYXRoCiAgICBpZiAoc2VhcmNoUG9zID4gLTEpIHsKICAgICAgc2VhcmNoID0gdXJsLnN1YnN0cmluZyhzZWFyY2hQb3MpOwogICAgICB1cmwgPSB1cmwuc3Vic3RyaW5nKHNlYXJjaFBvcywgMCk7CiAgICB9CiAgICB2YXIgcGFydHMgPSB1cmwuc3BsaXQoJy8nKTsKICAgIGZvciAodmFyIGk9MCwgcDsgaTxwYXJ0cy5sZW5ndGg7IGkrKykgewogICAgICBwID0gcGFydHNbaV07CiAgICAgIGlmIChwID09PSAnLi4nKSB7CiAgICAgICAgcGFydHMuc3BsaWNlKGktMSwgMik7CiAgICAgICAgaSAtPSAyOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcGFydHMuam9pbignLycpICsgc2VhcmNoOwogIH0sCiAgbWFrZURvY3VtZW50UmVsUGF0aDogZnVuY3Rpb24odXJsKSB7CiAgICAvLyB0ZXN0IHVybCBhZ2FpbnN0IGRvY3VtZW50IHRvIHNlZSBpZiB3ZSBjYW4gY29uc3RydWN0IGEgcmVsYXRpdmUgcGF0aAogICAgcGF0aC51cmxFbHQuaHJlZiA9IHVybDsKICAgIC8vIElFIGRvZXMgbm90IHNldCBob3N0IGlmIHNhbWUgYXMgZG9jdW1lbnQKICAgIGlmICghcGF0aC51cmxFbHQuaG9zdCB8fCAKICAgICAgICAocGF0aC51cmxFbHQuaG9zdCA9PT0gd2luZG93LmxvY2F0aW9uLmhvc3QgJiYKICAgICAgICBwYXRoLnVybEVsdC5wcm90b2NvbCA9PT0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sKSkgewogICAgICByZXR1cm4gdGhpcy5tYWtlUmVsUGF0aChwYXRoLmRvY3VtZW50VVJMLCBwYXRoLnVybEVsdC5ocmVmKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB1cmw7CiAgICB9CiAgfSwKICAvLyBtYWtlIGEgcmVsYXRpdmUgcGF0aCBmcm9tIHNvdXJjZSB0byB0YXJnZXQKICBtYWtlUmVsUGF0aDogZnVuY3Rpb24oc291cmNlLCB0YXJnZXQpIHsKICAgIHZhciBzID0gc291cmNlLnNwbGl0KCcvJyk7CiAgICB2YXIgdCA9IHRhcmdldC5zcGxpdCgnLycpOwogICAgd2hpbGUgKHMubGVuZ3RoICYmIHNbMF0gPT09IHRbMF0pewogICAgICBzLnNoaWZ0KCk7CiAgICAgIHQuc2hpZnQoKTsKICAgIH0KICAgIGZvcih2YXIgaSA9IDAsIGwgPSBzLmxlbmd0aC0xOyBpIDwgbDsgaSsrKSB7CiAgICAgIHQudW5zaGlmdCgnLi4nKTsKICAgIH0KICAgIHZhciByID0gdC5qb2luKCcvJyk7CiAgICByZXR1cm4gcjsKICB9LAogIHJlc29sdmVQYXRoc0luSFRNTDogZnVuY3Rpb24ocm9vdCwgdXJsKSB7CiAgICB1cmwgPSB1cmwgfHwgcGF0aC5kb2N1bWVudFVybEZyb21Ob2RlKHJvb3QpCiAgICBwYXRoLnJlc29sdmVBdHRyaWJ1dGVzKHJvb3QsIHVybCk7CiAgICBwYXRoLnJlc29sdmVTdHlsZUVsdHMocm9vdCwgdXJsKTsKICAgIC8vIGhhbmRsZSB0ZW1wbGF0ZS5jb250ZW50CiAgICB2YXIgdGVtcGxhdGVzID0gcm9vdC5xdWVyeVNlbGVjdG9yQWxsKCd0ZW1wbGF0ZScpOwogICAgaWYgKHRlbXBsYXRlcykgewogICAgICBmb3JFYWNoKHRlbXBsYXRlcywgZnVuY3Rpb24odCkgewogICAgICAgIGlmICh0LmNvbnRlbnQpIHsKICAgICAgICAgIHBhdGgucmVzb2x2ZVBhdGhzSW5IVE1MKHQuY29udGVudCwgdXJsKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sCiAgcmVzb2x2ZVBhdGhzSW5TdHlsZXNoZWV0OiBmdW5jdGlvbihzaGVldCkgewogICAgdmFyIGRvY1VybCA9IHBhdGgubm9kZVVybChzaGVldCk7CiAgICBzaGVldC5fX3Jlc291cmNlID0gcGF0aC5yZXNvbHZlQ3NzVGV4dChzaGVldC5fX3Jlc291cmNlLCBkb2NVcmwpOwogIH0sCiAgcmVzb2x2ZVN0eWxlRWx0czogZnVuY3Rpb24ocm9vdCwgdXJsKSB7CiAgICB2YXIgc3R5bGVzID0gcm9vdC5xdWVyeVNlbGVjdG9yQWxsKCdzdHlsZScpOwogICAgaWYgKHN0eWxlcykgewogICAgICBmb3JFYWNoKHN0eWxlcywgZnVuY3Rpb24oc3R5bGUpIHsKICAgICAgICBzdHlsZS50ZXh0Q29udGVudCA9IHBhdGgucmVzb2x2ZUNzc1RleHQoc3R5bGUudGV4dENvbnRlbnQsIHVybCk7CiAgICAgIH0pOwogICAgfQogIH0sCiAgcmVzb2x2ZUNzc1RleHQ6IGZ1bmN0aW9uKGNzc1RleHQsIGJhc2VVcmwpIHsKICAgIHJldHVybiBjc3NUZXh0LnJlcGxhY2UoL3VybFwoW14pXSpcKS9nLCBmdW5jdGlvbihtYXRjaCkgewogICAgICAvLyBmaW5kIHRoZSB1cmwgcGF0aCwgaWdub3JlIHF1b3RlcyBpbiB1cmwgc3RyaW5nCiAgICAgIHZhciB1cmxQYXRoID0gbWF0Y2gucmVwbGFjZSgvWyInXS9nLCAiIikuc2xpY2UoNCwgLTEpOwogICAgICB1cmxQYXRoID0gcGF0aC5yZXNvbHZlUmVsYXRpdmVVcmwoYmFzZVVybCwgdXJsUGF0aCk7CiAgICAgIHJldHVybiAidXJsKCIgKyB1cmxQYXRoICsgIikiOwogICAgfSk7CiAgfSwKICByZXNvbHZlQXR0cmlidXRlczogZnVuY3Rpb24ocm9vdCwgdXJsKSB7CiAgICAvLyBzZWFyY2ggZm9yIGF0dHJpYnV0ZXMgdGhhdCBob3N0IHVybHMKICAgIHZhciBub2RlcyA9IHJvb3QgJiYgcm9vdC5xdWVyeVNlbGVjdG9yQWxsKFVSTF9BVFRSU19TRUxFQ1RPUik7CiAgICBpZiAobm9kZXMpIHsKICAgICAgZm9yRWFjaChub2RlcywgZnVuY3Rpb24obikgewogICAgICAgIHRoaXMucmVzb2x2ZU5vZGVBdHRyaWJ1dGVzKG4sIHVybCk7CiAgICAgIH0sIHRoaXMpOwogICAgfQogIH0sCiAgcmVzb2x2ZU5vZGVBdHRyaWJ1dGVzOiBmdW5jdGlvbihub2RlLCB1cmwpIHsKICAgIFVSTF9BVFRSUy5mb3JFYWNoKGZ1bmN0aW9uKHYpIHsKICAgICAgdmFyIGF0dHIgPSBub2RlLmF0dHJpYnV0ZXNbdl07CiAgICAgIGlmIChhdHRyICYmIGF0dHIudmFsdWUgJiYKICAgICAgICAgKGF0dHIudmFsdWUuc2VhcmNoKFVSTF9URU1QTEFURV9TRUFSQ0gpIDwgMCkpIHsKICAgICAgICB2YXIgdXJsUGF0aCA9IHBhdGgucmVzb2x2ZVJlbGF0aXZlVXJsKHVybCwgYXR0ci52YWx1ZSk7CiAgICAgICAgYXR0ci52YWx1ZSA9IHVybFBhdGg7CiAgICAgIH0KICAgIH0pOwogIH0KfTsKCnBhdGguZG9jdW1lbnRVUkwgPSBwYXRoLmdldERvY3VtZW50VXJsKGRvY3VtZW50KTsKcGF0aC51cmxFbHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7Cgp4aHIgPSB4aHIgfHwgewogIGFzeW5jOiB0cnVlLAogIG9rOiBmdW5jdGlvbihyZXF1ZXN0KSB7CiAgICByZXR1cm4gKHJlcXVlc3Quc3RhdHVzID49IDIwMCAmJiByZXF1ZXN0LnN0YXR1cyA8IDMwMCkKICAgICAgICB8fCAocmVxdWVzdC5zdGF0dXMgPT09IDMwNCkKICAgICAgICB8fCAocmVxdWVzdC5zdGF0dXMgPT09IDApOwogIH0sCiAgbG9hZDogZnVuY3Rpb24odXJsLCBuZXh0LCBuZXh0Q29udGV4dCkgewogICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIGlmIChzY29wZS5mbGFncy5kZWJ1ZyB8fCBzY29wZS5mbGFncy5idXN0KSB7CiAgICAgIHVybCArPSAnPycgKyBNYXRoLnJhbmRvbSgpOwogICAgfQogICAgcmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwsIHhoci5hc3luYyk7CiAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWR5c3RhdGVjaGFuZ2UnLCBmdW5jdGlvbihlKSB7CiAgICAgIGlmIChyZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHsKICAgICAgICBuZXh0LmNhbGwobmV4dENvbnRleHQsICF4aHIub2socmVxdWVzdCkgJiYgcmVxdWVzdCwKICAgICAgICAgIHJlcXVlc3QucmVzcG9uc2UsIHVybCk7CiAgICAgIH0KICAgIH0pOwogICAgcmVxdWVzdC5zZW5kKCk7CiAgICByZXR1cm4gcmVxdWVzdDsKICB9LAogIGxvYWREb2N1bWVudDogZnVuY3Rpb24odXJsLCBuZXh0LCBuZXh0Q29udGV4dCkgewogICAgdGhpcy5sb2FkKHVybCwgbmV4dCwgbmV4dENvbnRleHQpLnJlc3BvbnNlVHlwZSA9ICdkb2N1bWVudCc7CiAgfQp9OwoKdmFyIGZvckVhY2ggPSBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsLmJpbmQoQXJyYXkucHJvdG90eXBlLmZvckVhY2gpOwoKLy8gZXhwb3J0cwoKc2NvcGUucGF0aCA9IHBhdGg7CnNjb3BlLnhociA9IHhocjsKc2NvcGUuaW1wb3J0ZXIgPSBpbXBvcnRlcjsKc2NvcGUuZ2V0RG9jdW1lbnRVcmwgPSBwYXRoLmdldERvY3VtZW50VXJsOwpzY29wZS5JTVBPUlRfTElOS19UWVBFID0gSU1QT1JUX0xJTktfVFlQRTsKCn0pKHdpbmRvdy5IVE1MSW1wb3J0cyk7CgovKgogKiBDb3B5cmlnaHQgMjAxMyBUaGUgUG9seW1lciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZQogKiBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuCiAqLwoKKGZ1bmN0aW9uKHNjb3BlKSB7Cgp2YXIgSU1QT1JUX0xJTktfVFlQRSA9ICdpbXBvcnQnOwoKLy8gaGlnaGxhbmRlciBvYmplY3QgZm9yIHBhcnNpbmcgYSBkb2N1bWVudCB0cmVlCgp2YXIgaW1wb3J0UGFyc2VyID0gewogIHNlbGVjdG9yczogWwogICAgJ2xpbmtbcmVsPScgKyBJTVBPUlRfTElOS19UWVBFICsgJ10nLAogICAgJ2xpbmtbcmVsPXN0eWxlc2hlZXRdJywKICAgICdzdHlsZScsCiAgICAnc2NyaXB0Om5vdChbdHlwZV0pJywKICAgICdzY3JpcHRbdHlwZT0idGV4dC9qYXZhc2NyaXB0Il0nCiAgXSwKICBtYXA6IHsKICAgIGxpbms6ICdwYXJzZUxpbmsnLAogICAgc2NyaXB0OiAncGFyc2VTY3JpcHQnLAogICAgc3R5bGU6ICdwYXJzZUdlbmVyaWMnCiAgfSwKICBwYXJzZTogZnVuY3Rpb24oaW5Eb2N1bWVudCkgewogICAgaWYgKCFpbkRvY3VtZW50Ll9faW1wb3J0UGFyc2VkKSB7CiAgICAgIC8vIG9ubHkgcGFyc2Ugb25jZQogICAgICBpbkRvY3VtZW50Ll9faW1wb3J0UGFyc2VkID0gdHJ1ZTsKICAgICAgLy8gYWxsIHBhcnNhYmxlIGVsZW1lbnRzIGluIGluRG9jdW1lbnQgKGRlcHRoLWZpcnN0IHByZS1vcmRlciB0cmF2ZXJzYWwpCiAgICAgIHZhciBlbHRzID0gaW5Eb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGltcG9ydFBhcnNlci5zZWxlY3RvcnMpOwogICAgICAvLyBmb3IgZWFjaCBwYXJzYWJsZSBub2RlIHR5cGUsIGNhbGwgdGhlIG1hcHBlZCBwYXJzaW5nIG1ldGhvZAogICAgICBmb3JFYWNoKGVsdHMsIGZ1bmN0aW9uKGUpIHsKICAgICAgICBpbXBvcnRQYXJzZXJbaW1wb3J0UGFyc2VyLm1hcFtlLmxvY2FsTmFtZV1dKGUpOwogICAgICB9KTsKICAgIH0KICB9LAogIHBhcnNlTGluazogZnVuY3Rpb24obGlua0VsdCkgewogICAgaWYgKGlzRG9jdW1lbnRMaW5rKGxpbmtFbHQpKSB7CiAgICAgIGlmIChsaW5rRWx0LmNvbnRlbnQpIHsKICAgICAgICBpbXBvcnRQYXJzZXIucGFyc2UobGlua0VsdC5jb250ZW50KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5wYXJzZUdlbmVyaWMobGlua0VsdCk7CiAgICB9CiAgfSwKICBwYXJzZUdlbmVyaWM6IGZ1bmN0aW9uKGVsdCkgewogICAgaWYgKG5lZWRzTWFpbkRvY3VtZW50Q29udGV4dChlbHQpKSB7CiAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoZWx0KTsKICAgIH0KICB9LAogIHBhcnNlU2NyaXB0OiBmdW5jdGlvbihzY3JpcHRFbHQpIHsKICAgIGlmIChuZWVkc01haW5Eb2N1bWVudENvbnRleHQoc2NyaXB0RWx0KSkgewogICAgICAvLyBhY3F1aXJlIGNvZGUgdG8gZXhlY3V0ZQogICAgICB2YXIgY29kZSA9IChzY3JpcHRFbHQuX19yZXNvdXJjZSB8fCBzY3JpcHRFbHQudGV4dENvbnRlbnQpLnRyaW0oKTsKICAgICAgaWYgKGNvZGUpIHsKICAgICAgICAvLyBjYWxjdWxhdGUgc291cmNlIG1hcCBoaW50CiAgICAgICAgdmFyIG1vbmlrZXIgPSBzY3JpcHRFbHQuX19ub2RlVXJsOwogICAgICAgIGlmICghbW9uaWtlcikgewogICAgICAgICAgdmFyIG1vbmlrZXIgPSBzY29wZS5wYXRoLmRvY3VtZW50VXJsRnJvbU5vZGUoc2NyaXB0RWx0KTsKICAgICAgICAgIC8vIHRoZXJlIGNvdWxkIGJlIG1vcmUgdGhhbiBvbmUgc2NyaXB0IHRoaXMgdXJsCiAgICAgICAgICB2YXIgdGFnID0gJ1snICsgTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSsxKSoxMDAwKSArICddJzsKICAgICAgICAgIC8vIFRPRE8oc2ptaWxlcyk6IFBvbHltZXIgaGFjaywgc2hvdWxkIGJlIHBsdWdnYWJsZSBpZiB3ZSBuZWVkIHRvIGFsbG93IAogICAgICAgICAgLy8gdGhpcyBzb3J0IG9mIHRoaW5nCiAgICAgICAgICB2YXIgbWF0Y2hlcyA9IGNvZGUubWF0Y2goL1BvbHltZXJcKFsnIl0oW14nIl0qKS8pOwogICAgICAgICAgdGFnID0gbWF0Y2hlcyAmJiBtYXRjaGVzWzFdIHx8IHRhZzsKICAgICAgICAgIC8vIHRhZyB0aGUgbW9uaWtlcgogICAgICAgICAgbW9uaWtlciArPSAnLycgKyB0YWcgKyAnLmpzJzsKICAgICAgICB9CiAgICAgICAgLy8gc291cmNlIG1hcCBoaW50CiAgICAgICAgY29kZSArPSAiXG4vLyMgc291cmNlVVJMPSIgKyBtb25pa2VyICsgIlxuIjsKICAgICAgICAvLyBldmFsdWF0ZSB0aGUgY29kZQogICAgICAgIGV2YWwuY2FsbCh3aW5kb3csIGNvZGUpOwogICAgICB9CiAgICB9CiAgfQp9OwoKdmFyIGZvckVhY2ggPSBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsLmJpbmQoQXJyYXkucHJvdG90eXBlLmZvckVhY2gpOwoKZnVuY3Rpb24gaXNEb2N1bWVudExpbmsoZWx0KSB7CiAgcmV0dXJuIGVsdC5sb2NhbE5hbWUgPT09ICdsaW5rJwogICAgICAmJiBlbHQuZ2V0QXR0cmlidXRlKCdyZWwnKSA9PT0gSU1QT1JUX0xJTktfVFlQRTsKfQoKZnVuY3Rpb24gbmVlZHNNYWluRG9jdW1lbnRDb250ZXh0KG5vZGUpIHsKICAvLyBub2RlcyBjYW4gYmUgbW92ZWQgdG8gdGhlIG1haW4gZG9jdW1lbnQ6CiAgLy8gaWYgdGhleSBhcmUgaW4gYSB0cmVlIGJ1dCBub3QgaW4gdGhlIG1haW4gZG9jdW1lbnQgYW5kIG5vdCBjaGlsZHJlbiBvZiA8ZWxlbWVudD4KICByZXR1cm4gbm9kZS5wYXJlbnROb2RlICYmICFpbk1haW5Eb2N1bWVudChub2RlKSAKICAgICAgJiYgIWlzRWxlbWVudEVsZW1lbnRDaGlsZChub2RlKTsKfQoKZnVuY3Rpb24gaW5NYWluRG9jdW1lbnQoZWx0KSB7CiAgcmV0dXJuIGVsdC5vd25lckRvY3VtZW50ID09PSBkb2N1bWVudCB8fAogICAgLy8gVE9ETyhzam1pbGVzKTogU2hhZG93RE9NUG9seWZpbGwgaW50cnVzaW9uCiAgICBlbHQub3duZXJEb2N1bWVudC5pbXBsID09PSBkb2N1bWVudDsKfQoKZnVuY3Rpb24gaXNFbGVtZW50RWxlbWVudENoaWxkKGVsdCkgewogIHJldHVybiBlbHQucGFyZW50Tm9kZSAmJiBlbHQucGFyZW50Tm9kZS5sb2NhbE5hbWUgPT09ICdlbGVtZW50JzsKfQoKLy8gZXhwb3J0cwoKc2NvcGUucGFyc2VyID0gaW1wb3J0UGFyc2VyOwoKfSkoSFRNTEltcG9ydHMpOwovKgogKiBDb3B5cmlnaHQgMjAxMyBUaGUgUG9seW1lciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZQogKiBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuCiAqLwooZnVuY3Rpb24oKXsKCi8vIGJvb3RzdHJhcAoKLy8gSUUgc2hpbSBmb3IgQ3VzdG9tRXZlbnQKaWYgKHR5cGVvZiB3aW5kb3cuQ3VzdG9tRXZlbnQgIT09ICdmdW5jdGlvbicpIHsKICB3aW5kb3cuQ3VzdG9tRXZlbnQgPSBmdW5jdGlvbihpblR5cGUpIHsKICAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdIVE1MRXZlbnRzJyk7CiAgICAgZS5pbml0RXZlbnQoaW5UeXBlLCB0cnVlLCB0cnVlKTsKICAgICByZXR1cm4gZTsKICB9Owp9CgpmdW5jdGlvbiBib290c3RyYXAoKSB7CiAgLy8gcHJlbG9hZCBkb2N1bWVudCByZXNvdXJjZSB0cmVlcwogIEhUTUxJbXBvcnRzLmltcG9ydGVyLmxvYWQoZG9jdW1lbnQsIGZ1bmN0aW9uKCkgewogICAgSFRNTEltcG9ydHMucGFyc2VyLnBhcnNlKGRvY3VtZW50KTsKICAgIEhUTUxJbXBvcnRzLnJlYWR5VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgLy8gc2VuZCBIVE1MSW1wb3J0c0xvYWRlZCB3aGVuIGZpbmlzaGVkCiAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KAogICAgICBuZXcgQ3VzdG9tRXZlbnQoJ0hUTUxJbXBvcnRzTG9hZGVkJywge2J1YmJsZXM6IHRydWV9KQogICAgKTsKICB9KTsKfTsKCmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7CiAgYm9vdHN0cmFwKCk7Cn0gZWxzZSB7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBib290c3RyYXApOwp9Cgp9KSgpOwoKLyoKICogQ29weXJpZ2h0IDIwMTMgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBCU0Qtc3R5bGUKICogbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLgogKi8KCihmdW5jdGlvbigpIHsKCi8vIGltcG9ydAoKdmFyIElNUE9SVF9MSU5LX1RZUEUgPSB3aW5kb3cuSFRNTEltcG9ydHMgPyBIVE1MSW1wb3J0cy5JTVBPUlRfTElOS19UWVBFIDogJ25vbmUnOwoKLy8gaGlnaGxhbmRlciBvYmplY3QgZm9yIHBhcnNpbmcgYSBkb2N1bWVudCB0cmVlCgp2YXIgcGFyc2VyID0gewogIHNlbGVjdG9yczogWwogICAgJ2xpbmtbcmVsPScgKyBJTVBPUlRfTElOS19UWVBFICsgJ10nCiAgXSwKICBtYXA6IHsKICAgIGxpbms6ICdwYXJzZUxpbmsnCiAgfSwKICBwYXJzZTogZnVuY3Rpb24oaW5Eb2N1bWVudCkgewogICAgaWYgKCFpbkRvY3VtZW50Ll9fcGFyc2VkKSB7CiAgICAgIC8vIG9ubHkgcGFyc2Ugb25jZQogICAgICBpbkRvY3VtZW50Ll9fcGFyc2VkID0gdHJ1ZTsKICAgICAgLy8gYWxsIHBhcnNhYmxlIGVsZW1lbnRzIGluIGluRG9jdW1lbnQgKGRlcHRoLWZpcnN0IHByZS1vcmRlciB0cmF2ZXJzYWwpCiAgICAgIHZhciBlbHRzID0gaW5Eb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHBhcnNlci5zZWxlY3RvcnMpOwogICAgICAvLyBmb3IgZWFjaCBwYXJzYWJsZSBub2RlIHR5cGUsIGNhbGwgdGhlIG1hcHBlZCBwYXJzaW5nIG1ldGhvZAogICAgICBmb3JFYWNoKGVsdHMsIGZ1bmN0aW9uKGUpIHsKICAgICAgICBwYXJzZXJbcGFyc2VyLm1hcFtlLmxvY2FsTmFtZV1dKGUpOwogICAgICB9KTsKICAgICAgLy8gdXBncmFkZSBhbGwgdXBncmFkZWFibGUgc3RhdGljIGVsZW1lbnRzLCBhbnl0aGluZyBkeW5hbWljYWxseQogICAgICAvLyBjcmVhdGVkIHNob3VsZCBiZSBjYXVnaHQgYnkgb2JzZXJ2ZXIKICAgICAgQ3VzdG9tRWxlbWVudHMudXBncmFkZURvY3VtZW50KGluRG9jdW1lbnQpOwogICAgICAvLyBvYnNlcnZlIGRvY3VtZW50IGZvciBkb20gY2hhbmdlcwogICAgICBDdXN0b21FbGVtZW50cy5vYnNlcnZlRG9jdW1lbnQoaW5Eb2N1bWVudCk7CiAgICB9CiAgfSwKICBwYXJzZUxpbms6IGZ1bmN0aW9uKGxpbmtFbHQpIHsKICAgIC8vIGltcG9ydHMKICAgIGlmIChpc0RvY3VtZW50TGluayhsaW5rRWx0KSkgewogICAgICB0aGlzLnBhcnNlSW1wb3J0KGxpbmtFbHQpOwogICAgfQogIH0sCiAgcGFyc2VJbXBvcnQ6IGZ1bmN0aW9uKGxpbmtFbHQpIHsKICAgIGlmIChsaW5rRWx0LmNvbnRlbnQpIHsKICAgICAgcGFyc2VyLnBhcnNlKGxpbmtFbHQuY29udGVudCk7CiAgICB9CiAgfQp9OwoKZnVuY3Rpb24gaXNEb2N1bWVudExpbmsoaW5FbHQpIHsKICByZXR1cm4gKGluRWx0LmxvY2FsTmFtZSA9PT0gJ2xpbmsnCiAgICAgICYmIGluRWx0LmdldEF0dHJpYnV0ZSgncmVsJykgPT09IElNUE9SVF9MSU5LX1RZUEUpOwp9Cgp2YXIgZm9yRWFjaCA9IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwuYmluZChBcnJheS5wcm90b3R5cGUuZm9yRWFjaCk7CgovLyBleHBvcnRzCgpDdXN0b21FbGVtZW50cy5wYXJzZXIgPSBwYXJzZXI7Cgp9KSgpOwovKgogKiBDb3B5cmlnaHQgMjAxMyBUaGUgUG9seW1lciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZQogKiBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuCiAqLwooZnVuY3Rpb24oKXsKCi8vIGJvb3RzdHJhcCBwYXJzaW5nCmZ1bmN0aW9uIGJvb3RzdHJhcCgpIHsKICAvLyBwYXJzZSBkb2N1bWVudAogIEN1c3RvbUVsZW1lbnRzLnBhcnNlci5wYXJzZShkb2N1bWVudCk7CiAgLy8gb25lIG1vcmUgcGFzcyBiZWZvcmUgcmVnaXN0ZXIgaXMgJ2xpdmUnCiAgQ3VzdG9tRWxlbWVudHMudXBncmFkZURvY3VtZW50KGRvY3VtZW50KTsgIAogIC8vIGNob29zZSBhc3luYwogIHZhciBhc3luYyA9IHdpbmRvdy5QbGF0Zm9ybSAmJiBQbGF0Zm9ybS5lbmRPZk1pY3JvdGFzayA/IAogICAgUGxhdGZvcm0uZW5kT2ZNaWNyb3Rhc2sgOgogICAgc2V0VGltZW91dDsKICBhc3luYyhmdW5jdGlvbigpIHsKICAgIC8vIHNldCBpbnRlcm5hbCAncmVhZHknIGZsYWcsIG5vdyBkb2N1bWVudC5yZWdpc3RlciB3aWxsIHRyaWdnZXIgCiAgICAvLyBzeW5jaHJvbm91cyB1cGdyYWRlcwogICAgQ3VzdG9tRWxlbWVudHMucmVhZHkgPSB0cnVlOwogICAgLy8gY2FwdHVyZSBibHVudCBwcm9maWxpbmcgZGF0YQogICAgQ3VzdG9tRWxlbWVudHMucmVhZHlUaW1lID0gRGF0ZS5ub3coKTsKICAgIGlmICh3aW5kb3cuSFRNTEltcG9ydHMpIHsKICAgICAgQ3VzdG9tRWxlbWVudHMuZWxhcHNlZCA9IEN1c3RvbUVsZW1lbnRzLnJlYWR5VGltZSAtIEhUTUxJbXBvcnRzLnJlYWR5VGltZTsKICAgIH0KICAgIC8vIG5vdGlmeSB0aGUgc3lzdGVtIHRoYXQgd2UgYXJlIGJvb3RzdHJhcHBlZAogICAgZG9jdW1lbnQuYm9keS5kaXNwYXRjaEV2ZW50KAogICAgICBuZXcgQ3VzdG9tRXZlbnQoJ1dlYkNvbXBvbmVudHNSZWFkeScsIHtidWJibGVzOiB0cnVlfSkKICAgICk7CiAgfSk7Cn0KCi8vIEN1c3RvbUV2ZW50IHNoaW0gZm9yIElFCmlmICh0eXBlb2Ygd2luZG93LkN1c3RvbUV2ZW50ICE9PSAnZnVuY3Rpb24nKSB7CiAgd2luZG93LkN1c3RvbUV2ZW50ID0gZnVuY3Rpb24oaW5UeXBlKSB7CiAgICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnSFRNTEV2ZW50cycpOwogICAgIGUuaW5pdEV2ZW50KGluVHlwZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgcmV0dXJuIGU7CiAgfTsKfQoKaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHsKICBib290c3RyYXAoKTsKfSBlbHNlIHsKICB2YXIgbG9hZEV2ZW50ID0gd2luZG93LkhUTUxJbXBvcnRzID8gJ0hUTUxJbXBvcnRzTG9hZGVkJyA6ICdET01Db250ZW50TG9hZGVkJzsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihsb2FkRXZlbnQsIGJvb3RzdHJhcCk7Cn0KCn0pKCk7CgooZnVuY3Rpb24gKCkgewoKLyoqKiBWYXJpYWJsZXMgKioqLwoKICB2YXIgd2luID0gd2luZG93LAogICAgZG9jID0gZG9jdW1lbnQsCiAgICBub29wID0gZnVuY3Rpb24oKXt9LAogICAgdHJ1ZW9wID0gZnVuY3Rpb24oKXsgcmV0dXJuIHRydWU7IH0sCiAgICByZWdleFBzZXVkb1NwbGl0ID0gLyhbXHctXSsoPzpcKFteXCldK1wpKT8pL2csCiAgICByZWdleFBzZXVkb1JlcGxhY2UgPSAvKFx3KikoPzpcKChbXlwpXSopXCkpPy8sCiAgICByZWdleERpZ2l0cyA9IC8oXGQrKS9nLAogICAga2V5cHNldWRvID0gewogICAgICBhY3Rpb246IGZ1bmN0aW9uIChwc2V1ZG8sIGV2ZW50KSB7CiAgICAgICAgcmV0dXJuIHBzZXVkby52YWx1ZS5tYXRjaChyZWdleERpZ2l0cykuaW5kZXhPZihTdHJpbmcoZXZlbnQua2V5Q29kZSkpID4gLTEgPT0gKHBzZXVkby5uYW1lID09ICdrZXlwYXNzJykgfHwgbnVsbDsKICAgICAgfQogICAgfSwKICAgIHByZWZpeCA9IChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzdHlsZXMgPSB3aW4uZ2V0Q29tcHV0ZWRTdHlsZShkb2MuZG9jdW1lbnRFbGVtZW50LCAnJyksCiAgICAgICAgICBwcmUgPSAoQXJyYXkucHJvdG90eXBlLnNsaWNlCiAgICAgICAgICAgIC5jYWxsKHN0eWxlcykKICAgICAgICAgICAgLmpvaW4oJycpCiAgICAgICAgICAgIC5tYXRjaCgvLShtb3p8d2Via2l0fG1zKS0vKSB8fCAoc3R5bGVzLk9MaW5rID09PSAnJyAmJiBbJycsICdvJ10pCiAgICAgICAgICApWzFdOwogICAgICByZXR1cm4gewogICAgICAgIGRvbTogcHJlID09ICdtcycgPyAnTVMnIDogcHJlLAogICAgICAgIGxvd2VyY2FzZTogcHJlLAogICAgICAgIGNzczogJy0nICsgcHJlICsgJy0nLAogICAgICAgIGpzOiBwcmUgPT0gJ21zJyA/IHByZSA6IHByZVswXS50b1VwcGVyQ2FzZSgpICsgcHJlLnN1YnN0cigxKQogICAgICB9OwogICAgfSkoKSwKICAgIG1hdGNoU2VsZWN0b3IgPSBFbGVtZW50LnByb3RvdHlwZS5tYXRjaGVzU2VsZWN0b3IgfHwgRWxlbWVudC5wcm90b3R5cGVbcHJlZml4Lmxvd2VyY2FzZSArICdNYXRjaGVzU2VsZWN0b3InXSwKICAgIG11dGF0aW9uID0gd2luLk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luW3ByZWZpeC5qcyArICdNdXRhdGlvbk9ic2VydmVyJ107CgovKioqIEZ1bmN0aW9ucyAqKiovCgovLyBVdGlsaXRpZXMKCiAgdmFyIHR5cGVDYWNoZSA9IHt9LAogICAgICB0eXBlU3RyaW5nID0gdHlwZUNhY2hlLnRvU3RyaW5nLAogICAgICB0eXBlUmVnZXhwID0gL1xzKFthLXpBLVpdKykvOwogIGZ1bmN0aW9uIHR5cGVPZihvYmopIHsKICAgIHZhciB0eXBlID0gdHlwZVN0cmluZy5jYWxsKG9iaik7CiAgICByZXR1cm4gdHlwZUNhY2hlW3R5cGVdIHx8ICh0eXBlQ2FjaGVbdHlwZV0gPSB0eXBlLm1hdGNoKHR5cGVSZWdleHApWzFdLnRvTG93ZXJDYXNlKCkpOwogIH0KCiAgZnVuY3Rpb24gY2xvbmUoaXRlbSwgdHlwZSl7CiAgICB2YXIgZm4gPSBjbG9uZVt0eXBlIHx8IHR5cGVPZihpdGVtKV07CiAgICByZXR1cm4gZm4gPyBmbihpdGVtKSA6IGl0ZW07CiAgfQogICAgY2xvbmUub2JqZWN0ID0gZnVuY3Rpb24oc3JjKXsKICAgICAgdmFyIG9iaiA9IHt9OwogICAgICBmb3IgKHZhciBrZXkgaW4gc3JjKSBvYmpba2V5XSA9IGNsb25lKHNyY1trZXldKTsKICAgICAgcmV0dXJuIG9iajsKICAgIH07CiAgICBjbG9uZS5hcnJheSA9IGZ1bmN0aW9uKHNyYyl7CiAgICAgIHZhciBpID0gc3JjLmxlbmd0aCwgYXJyYXkgPSBuZXcgQXJyYXkoaSk7CiAgICAgIHdoaWxlIChpLS0pIGFycmF5W2ldID0gY2xvbmUoc3JjW2ldKTsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfTsKCiAgdmFyIHVuc2xpY2VhYmxlID0gWyd1bmRlZmluZWQnLCAnbnVsbCcsICdudW1iZXInLCAnYm9vbGVhbicsICdzdHJpbmcnLCAnZnVuY3Rpb24nXTsKICBmdW5jdGlvbiB0b0FycmF5KG9iail7CiAgICByZXR1cm4gdW5zbGljZWFibGUuaW5kZXhPZih0eXBlT2Yob2JqKSkgPT0gLTEgPwogICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwob2JqLCAwKSA6CiAgICBbb2JqXTsKICB9CgovLyBET00KICB2YXIgc3RyID0gJyc7CiAgZnVuY3Rpb24gcXVlcnkoZWxlbWVudCwgc2VsZWN0b3IpewogICAgcmV0dXJuIChzZWxlY3RvciB8fCBzdHIpLmxlbmd0aCA/IHRvQXJyYXkoZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSkgOiBbXTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlTXV0YXRpb25zKGVsZW1lbnQsIG11dGF0aW9ucykgewogICAgdmFyIGRpZmYgPSB7IGFkZGVkOiBbXSwgcmVtb3ZlZDogW10gfTsKICAgIG11dGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHJlY29yZCl7CiAgICAgIHJlY29yZC5fbXV0YXRpb24gPSB0cnVlOwogICAgICBmb3IgKHZhciB6IGluIGRpZmYpIHsKICAgICAgICB2YXIgdHlwZSA9IGVsZW1lbnQuX3JlY29yZHNbKHogPT0gJ2FkZGVkJykgPyAnaW5zZXJ0ZWQnIDogJ3JlbW92ZWQnXSwKICAgICAgICAgIG5vZGVzID0gcmVjb3JkW3ogKyAnTm9kZXMnXSwgbGVuZ3RoID0gbm9kZXMubGVuZ3RoOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoICYmIGRpZmZbel0uaW5kZXhPZihub2Rlc1tpXSkgPT0gLTE7IGkrKyl7CiAgICAgICAgICBkaWZmW3pdLnB1c2gobm9kZXNbaV0pOwogICAgICAgICAgdHlwZS5mb3JFYWNoKGZ1bmN0aW9uKGZuKXsKICAgICAgICAgICAgZm4obm9kZXNbaV0sIHJlY29yZCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCi8vIE1peGlucwoKICBmdW5jdGlvbiBtZXJnZU9uZShzb3VyY2UsIGtleSwgY3VycmVudCl7CiAgICB2YXIgdHlwZSA9IHR5cGVPZihjdXJyZW50KTsKICAgIGlmICh0eXBlID09ICdvYmplY3QnICYmIHR5cGVPZihzb3VyY2Vba2V5XSkgPT0gJ29iamVjdCcpIHh0YWcubWVyZ2Uoc291cmNlW2tleV0sIGN1cnJlbnQpOwogICAgZWxzZSBzb3VyY2Vba2V5XSA9IGNsb25lKGN1cnJlbnQsIHR5cGUpOwogICAgcmV0dXJuIHNvdXJjZTsKICB9CgogIGZ1bmN0aW9uIG1lcmdlTWl4aW4odHlwZSwgbWl4aW4sIG9wdGlvbikgewogICAgdmFyIG9yaWdpbmFsID0ge307CiAgICBmb3IgKHZhciBvIGluIG9wdGlvbikgb3JpZ2luYWxbby5zcGxpdCgnOicpWzBdXSA9IHRydWU7CiAgICBmb3IgKHZhciB4IGluIG1peGluKSBpZiAoIW9yaWdpbmFsW3guc3BsaXQoJzonKVswXV0pIG9wdGlvblt4XSA9IG1peGluW3hdOwogIH0KCiAgZnVuY3Rpb24gYXBwbHlNaXhpbnModGFnKSB7CiAgICB0YWcubWl4aW5zLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgdmFyIG1peGluID0geHRhZy5taXhpbnNbbmFtZV07CiAgICAgIGZvciAodmFyIHR5cGUgaW4gbWl4aW4pIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgIGNhc2UgJ2xpZmVjeWNsZSc6IGNhc2UgJ21ldGhvZHMnOgogICAgICAgICAgICBtZXJnZU1peGluKHR5cGUsIG1peGluW3R5cGVdLCB0YWdbdHlwZV0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2FjY2Vzc29ycyc6IGNhc2UgJ3Byb3RvdHlwZSc6CiAgICAgICAgICAgIGZvciAodmFyIHogaW4gbWl4aW5bdHlwZV0pIG1lcmdlTWl4aW4oeiwgbWl4aW5bdHlwZV0sIHRhZy5hY2Nlc3NvcnMpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2V2ZW50cyc6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gdGFnOwogIH0KCi8vIEV2ZW50cwoKICBmdW5jdGlvbiBkZWxlZ2F0ZUFjdGlvbihwc2V1ZG8sIGV2ZW50KSB7CiAgICB2YXIgdGFyZ2V0ID0gcXVlcnkodGhpcywgcHNldWRvLnZhbHVlKS5maWx0ZXIoZnVuY3Rpb24obm9kZSl7CiAgICAgIHJldHVybiBub2RlID09IGV2ZW50LnRhcmdldCB8fCBub2RlLmNvbnRhaW5zID8gbm9kZS5jb250YWlucyhldmVudC50YXJnZXQpIDogbnVsbDsKICAgIH0pWzBdOwogICAgcmV0dXJuIHRhcmdldCA/IHBzZXVkby5saXN0ZW5lciA9IHBzZXVkby5saXN0ZW5lci5iaW5kKHRhcmdldCkgOiBudWxsOwogIH0KCiAgZnVuY3Rpb24gdG91Y2hGaWx0ZXIoZXZlbnQpIHsKICAgIGlmIChldmVudC50eXBlLm1hdGNoKCd0b3VjaCcpKXsKICAgICAgZXZlbnQudGFyZ2V0Ll9fdG91Y2hlZF9fID0gdHJ1ZTsKICAgIH0KICAgIGVsc2UgaWYgKGV2ZW50LnRhcmdldC5fX3RvdWNoZWRfXyAmJiBldmVudC50eXBlLm1hdGNoKCdtb3VzZScpKXsKICAgICAgZGVsZXRlIGV2ZW50LnRhcmdldC5fX3RvdWNoZWRfXzsKICAgICAgcmV0dXJuOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVGbG93RXZlbnQodHlwZSkgewogICAgdmFyIGZsb3cgPSB0eXBlID09ICdvdmVyJzsKICAgIHJldHVybiB7CiAgICAgIGF0dGFjaDogJ092ZXJmbG93RXZlbnQnIGluIHdpbiA/ICdvdmVyZmxvd2NoYW5nZWQnIDogW10sCiAgICAgIGNvbmRpdGlvbjogZnVuY3Rpb24gKGV2ZW50LCBjdXN0b20pIHsKICAgICAgICBldmVudC5mbG93ID0gdHlwZTsKICAgICAgICByZXR1cm4gZXZlbnQudHlwZSA9PSAodHlwZSArICdmbG93JykgfHwKICAgICAgICAoKGV2ZW50Lm9yaWVudCA9PT0gMCAmJiBldmVudC5ob3Jpem9udGFsT3ZlcmZsb3cgPT0gZmxvdykgfHwKICAgICAgICAoZXZlbnQub3JpZW50ID09IDEgJiYgZXZlbnQudmVydGljYWxPdmVyZmxvdyA9PSBmbG93KSB8fAogICAgICAgIChldmVudC5vcmllbnQgPT0gMiAmJiBldmVudC5ob3Jpem9udGFsT3ZlcmZsb3cgPT0gZmxvdyAmJiBldmVudC52ZXJ0aWNhbE92ZXJmbG93ID09IGZsb3cpKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIHdyaXRlUHJvcGVydHkoa2V5LCBldmVudCwgYmFzZSwgZGVzYyl7CiAgICBpZiAoZGVzYykgZXZlbnRba2V5XSA9IGJhc2Vba2V5XTsKICAgIGVsc2UgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV2ZW50LCBrZXksIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBiYXNlW2tleV0KICAgIH0pOwogIH0KCiAgdmFyIHNraXBQcm9wcyA9IHt9OwogIGZvciAodmFyIHogaW4gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0N1c3RvbUV2ZW50JykpIHNraXBQcm9wc1t6XSA9IDE7CiAgZnVuY3Rpb24gaW5oZXJpdEV2ZW50KGV2ZW50LCBiYXNlKXsKICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihldmVudCwgJ3RhcmdldCcpOwogICAgZm9yICh2YXIgeiBpbiBiYXNlKSB7CiAgICAgIGlmICghc2tpcFByb3BzW3pdKSB3cml0ZVByb3BlcnR5KHosIGV2ZW50LCBiYXNlLCBkZXNjKTsKICAgIH0KICAgIGV2ZW50LmJhc2VFdmVudCA9IGJhc2U7CiAgfQoKLy8gQWNjZXNzb3JzCgogIGZ1bmN0aW9uIGdldEFyZ3MoYXR0ciwgdmFsdWUpewogICAgcmV0dXJuIHsKICAgICAgdmFsdWU6IGF0dHIuYm9vbGVhbiA/ICcnIDogdmFsdWUsCiAgICAgIG1ldGhvZDogYXR0ci5ib29sZWFuICYmICF2YWx1ZSA/ICdyZW1vdmVBdHRyaWJ1dGUnIDogJ3NldEF0dHJpYnV0ZScKICAgIH07CiAgfQoKICBmdW5jdGlvbiBtb2RBdHRyKGVsZW1lbnQsIGF0dHIsIG5hbWUsIHZhbHVlKXsKICAgIHZhciBhcmdzID0gZ2V0QXJncyhhdHRyLCB2YWx1ZSk7CiAgICBlbGVtZW50W2FyZ3MubWV0aG9kXShuYW1lLCBhcmdzLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHN5bmNBdHRyKGVsZW1lbnQsIGF0dHIsIG5hbWUsIHZhbHVlLCBtZXRob2QpewogICAgdmFyIG5vZGVzID0gYXR0ci5wcm9wZXJ0eSA/IFtlbGVtZW50Lnh0YWdbYXR0ci5wcm9wZXJ0eV1dIDogYXR0ci5zZWxlY3RvciA/IHh0YWcucXVlcnkoZWxlbWVudCwgYXR0ci5zZWxlY3RvcikgOiBbXSwKICAgICAgICBpbmRleCA9IG5vZGVzLmxlbmd0aDsKICAgIHdoaWxlIChpbmRleC0tKSBub2Rlc1tpbmRleF1bbWV0aG9kXShuYW1lLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVWaWV3KGVsZW1lbnQsIG5hbWUsIHZhbHVlKXsKICAgIGlmIChlbGVtZW50Ll9fdmlld19fKXsKICAgICAgZWxlbWVudC5fX3ZpZXdfXy51cGRhdGVCaW5kaW5nVmFsdWUoZWxlbWVudCwgbmFtZSwgdmFsdWUpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYXR0YWNoUHJvcGVydGllcyh0YWcsIHByb3AsIHosIGFjY2Vzc29yLCBhdHRyLCBuYW1lKXsKICAgIHZhciBrZXkgPSB6LnNwbGl0KCc6JyksIHR5cGUgPSBrZXlbMF07CiAgICBpZiAodHlwZSA9PSAnZ2V0JykgewogICAgICBrZXlbMF0gPSBwcm9wOwogICAgICB0YWcucHJvdG90eXBlW3Byb3BdLmdldCA9IHh0YWcuYXBwbHlQc2V1ZG9zKGtleS5qb2luKCc6JyksIGFjY2Vzc29yW3pdLCB0YWcucHNldWRvcyk7CiAgICB9CiAgICBlbHNlIGlmICh0eXBlID09ICdzZXQnKSB7CiAgICAgIGtleVswXSA9IHByb3A7CiAgICAgIHZhciBzZXR0ZXIgPSB0YWcucHJvdG90eXBlW3Byb3BdLnNldCA9IHh0YWcuYXBwbHlQc2V1ZG9zKGtleS5qb2luKCc6JyksIGF0dHIgPyBmdW5jdGlvbih2YWx1ZSl7CiAgICAgICAgdGhpcy54dGFnLl9za2lwU2V0ID0gdHJ1ZTsKICAgICAgICBpZiAoIXRoaXMueHRhZy5fc2tpcEF0dHIpIG1vZEF0dHIodGhpcywgYXR0ciwgbmFtZSwgdmFsdWUpOwogICAgICAgIGlmICh0aGlzLnh0YWcuX3NraXBBdHRyICYmIGF0dHIuc2tpcCkgZGVsZXRlIHRoaXMueHRhZy5fc2tpcEF0dHI7CiAgICAgICAgYWNjZXNzb3Jbel0uY2FsbCh0aGlzLCBhdHRyLmJvb2xlYW4gPyAhIXZhbHVlIDogdmFsdWUpOwogICAgICAgIHVwZGF0ZVZpZXcodGhpcywgbmFtZSwgdmFsdWUpOwogICAgICAgIGRlbGV0ZSB0aGlzLnh0YWcuX3NraXBTZXQ7CiAgICAgIH0gOiBhY2Nlc3Nvclt6XSA/IGZ1bmN0aW9uKHZhbHVlKXsKICAgICAgICBhY2Nlc3Nvclt6XS5jYWxsKHRoaXMsIHZhbHVlKTsKICAgICAgICB1cGRhdGVWaWV3KHRoaXMsIG5hbWUsIHZhbHVlKTsKICAgICAgfSA6IG51bGwsIHRhZy5wc2V1ZG9zKTsKCiAgICAgIGlmIChhdHRyKSBhdHRyLnNldHRlciA9IHNldHRlcjsKICAgIH0KICAgIGVsc2UgdGFnLnByb3RvdHlwZVtwcm9wXVt6XSA9IGFjY2Vzc29yW3pdOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VBY2Nlc3Nvcih0YWcsIHByb3ApewogICAgdGFnLnByb3RvdHlwZVtwcm9wXSA9IHt9OwogICAgdmFyIGFjY2Vzc29yID0gdGFnLmFjY2Vzc29yc1twcm9wXSwKICAgICAgICBhdHRyID0gYWNjZXNzb3IuYXR0cmlidXRlLAogICAgICAgIG5hbWUgPSBhdHRyICYmIGF0dHIubmFtZSA/IGF0dHIubmFtZS50b0xvd2VyQ2FzZSgpIDogcHJvcDsKCiAgICBpZiAoYXR0cikgewogICAgICBhdHRyLmtleSA9IHByb3A7CiAgICAgIHRhZy5hdHRyaWJ1dGVzW25hbWVdID0gYXR0cjsKICAgIH0KCiAgICBmb3IgKHZhciB6IGluIGFjY2Vzc29yKSBhdHRhY2hQcm9wZXJ0aWVzKHRhZywgcHJvcCwgeiwgYWNjZXNzb3IsIGF0dHIsIG5hbWUpOwoKICAgIGlmIChhdHRyKSB7CiAgICAgIGlmICghdGFnLnByb3RvdHlwZVtwcm9wXS5nZXQpIHsKICAgICAgICB2YXIgbWV0aG9kID0gKGF0dHIuYm9vbGVhbiA/ICdoYXMnIDogJ2dldCcpICsgJ0F0dHJpYnV0ZSc7CiAgICAgICAgdGFnLnByb3RvdHlwZVtwcm9wXS5nZXQgPSBmdW5jdGlvbigpewogICAgICAgICAgcmV0dXJuIHRoaXNbbWV0aG9kXShuYW1lKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGlmICghdGFnLnByb3RvdHlwZVtwcm9wXS5zZXQpIHRhZy5wcm90b3R5cGVbcHJvcF0uc2V0ID0gZnVuY3Rpb24odmFsdWUpewogICAgICAgIG1vZEF0dHIodGhpcywgYXR0ciwgbmFtZSwgdmFsdWUpOwogICAgICAgIHVwZGF0ZVZpZXcodGhpcywgbmFtZSwgdmFsdWUpOwogICAgICB9OwogICAgfQogIH0KCi8qKiogWC1UYWcgT2JqZWN0IERlZmluaXRpb24gKioqLwoKICB2YXIgeHRhZyA9IHsKICAgIHRhZ3M6IHt9LAogICAgZGVmYXVsdE9wdGlvbnM6IHsKICAgICAgcHNldWRvczogW10sCiAgICAgIG1peGluczogW10sCiAgICAgIGV2ZW50czoge30sCiAgICAgIG1ldGhvZHM6IHt9LAogICAgICBhY2Nlc3NvcnM6IHt9LAogICAgICBsaWZlY3ljbGU6IHt9LAogICAgICBhdHRyaWJ1dGVzOiB7fSwKICAgICAgJ3Byb3RvdHlwZSc6IHsKICAgICAgICB4dGFnOiB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9feHRhZ19fID8gdGhpcy5fX3h0YWdfXyA6ICh0aGlzLl9feHRhZ19fID0geyBkYXRhOiB7fSB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICByZWdpc3RlcjogZnVuY3Rpb24gKG5hbWUsIG9wdGlvbnMpIHsKICAgICAgdmFyIF9uYW1lOwogICAgICBpZiAodHlwZW9mIG5hbWUgPT0gJ3N0cmluZycpIHsKICAgICAgICBfbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIHNhdmUgcHJvdG90eXBlIGZvciBhY3R1YWwgb2JqZWN0IGNyZWF0aW9uIGJlbG93CiAgICAgIHZhciBiYXNlUHJvdG90eXBlID0gb3B0aW9ucy5wcm90b3R5cGU7CiAgICAgIGRlbGV0ZSBvcHRpb25zLnByb3RvdHlwZTsKCiAgICAgIHZhciB0YWcgPSB4dGFnLnRhZ3NbX25hbWVdID0gYXBwbHlNaXhpbnMoeHRhZy5tZXJnZSh7fSwgeHRhZy5kZWZhdWx0T3B0aW9ucywgb3B0aW9ucykpOwoKICAgICAgZm9yICh2YXIgeiBpbiB0YWcuZXZlbnRzKSB0YWcuZXZlbnRzW3pdID0geHRhZy5wYXJzZUV2ZW50KHosIHRhZy5ldmVudHNbel0pOwogICAgICBmb3IgKHogaW4gdGFnLmxpZmVjeWNsZSkgdGFnLmxpZmVjeWNsZVt6LnNwbGl0KCc6JylbMF1dID0geHRhZy5hcHBseVBzZXVkb3MoeiwgdGFnLmxpZmVjeWNsZVt6XSwgdGFnLnBzZXVkb3MpOwogICAgICBmb3IgKHogaW4gdGFnLm1ldGhvZHMpIHRhZy5wcm90b3R5cGVbei5zcGxpdCgnOicpWzBdXSA9IHsgdmFsdWU6IHh0YWcuYXBwbHlQc2V1ZG9zKHosIHRhZy5tZXRob2RzW3pdLCB0YWcucHNldWRvcyksIGVudW1lcmFibGU6IHRydWUgfTsKICAgICAgZm9yICh6IGluIHRhZy5hY2Nlc3NvcnMpIHBhcnNlQWNjZXNzb3IodGFnLCB6KTsKCiAgICAgIHZhciByZWFkeSA9IHRhZy5saWZlY3ljbGUuY3JlYXRlZCB8fCB0YWcubGlmZWN5Y2xlLnJlYWR5OwogICAgICB0YWcucHJvdG90eXBlLmNyZWF0ZWRDYWxsYmFjayA9IHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpewogICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzOwogICAgICAgICAgeHRhZy5hZGRFdmVudHModGhpcywgdGFnLmV2ZW50cyk7CiAgICAgICAgICB0YWcubWl4aW5zLmZvckVhY2goZnVuY3Rpb24obWl4aW4pewogICAgICAgICAgICBpZiAoeHRhZy5taXhpbnNbbWl4aW5dLmV2ZW50cykgeHRhZy5hZGRFdmVudHMoZWxlbWVudCwgeHRhZy5taXhpbnNbbWl4aW5dLmV2ZW50cyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvdXRwdXQgPSByZWFkeSA/IHJlYWR5LmFwcGx5KHRoaXMsIHRvQXJyYXkoYXJndW1lbnRzKSkgOiBudWxsOwogICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiB0YWcuYXR0cmlidXRlcykgewogICAgICAgICAgICB2YXIgYXR0ciA9IHRhZy5hdHRyaWJ1dGVzW25hbWVdLAogICAgICAgICAgICAgICAgaGFzQXR0ciA9IHRoaXMuaGFzQXR0cmlidXRlKG5hbWUpOwogICAgICAgICAgICBpZiAoaGFzQXR0ciB8fCBhdHRyLmJvb2xlYW4pIHsKICAgICAgICAgICAgICB0aGlzW2F0dHIua2V5XSA9IGF0dHIuYm9vbGVhbiA/IGhhc0F0dHIgOiB0aGlzLmdldEF0dHJpYnV0ZShuYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGFnLnBzZXVkb3MuZm9yRWFjaChmdW5jdGlvbihvYmopewogICAgICAgICAgICBvYmoub25BZGQuY2FsbChlbGVtZW50LCBvYmopOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmICh0YWcubGlmZWN5Y2xlLmluc2VydGVkKSB0YWcucHJvdG90eXBlLmVudGVyZWRWaWV3Q2FsbGJhY2sgPSB7IHZhbHVlOiB0YWcubGlmZWN5Y2xlLmluc2VydGVkLCBlbnVtZXJhYmxlOiB0cnVlIH07CiAgICAgIGlmICh0YWcubGlmZWN5Y2xlLnJlbW92ZWQpIHRhZy5wcm90b3R5cGUubGVmdERvY3VtZW50Q2FsbGJhY2sgPSB7IHZhbHVlOiB0YWcubGlmZWN5Y2xlLnJlbW92ZWQsIGVudW1lcmFibGU6IHRydWUgfTsKICAgICAgaWYgKHRhZy5saWZlY3ljbGUuYXR0cmlidXRlQ2hhbmdlZCkgdGFnLnByb3RvdHlwZS5hdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2sgPSB7IHZhbHVlOiB0YWcubGlmZWN5Y2xlLmF0dHJpYnV0ZUNoYW5nZWQsIGVudW1lcmFibGU6IHRydWUgfTsKCiAgICAgIHZhciBzZXRBdHRyaWJ1dGUgPSB0YWcucHJvdG90eXBlLnNldEF0dHJpYnV0ZSB8fCBIVE1MRWxlbWVudC5wcm90b3R5cGUuc2V0QXR0cmlidXRlOwogICAgICB0YWcucHJvdG90eXBlLnNldEF0dHJpYnV0ZSA9IHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICBlbnVtYmVyYWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKXsKICAgICAgICAgIHZhciBhdHRyID0gdGFnLmF0dHJpYnV0ZXNbbmFtZS50b0xvd2VyQ2FzZSgpXTsKICAgICAgICAgIGlmICghdGhpcy54dGFnLl9za2lwQXR0cikgc2V0QXR0cmlidXRlLmNhbGwodGhpcywgbmFtZSwgYXR0ciAmJiBhdHRyLmJvb2xlYW4gPyAnJyA6IHZhbHVlKTsKICAgICAgICAgIGlmIChhdHRyKSB7CiAgICAgICAgICAgIGlmIChhdHRyLnNldHRlciAmJiAhdGhpcy54dGFnLl9za2lwU2V0KSB7CiAgICAgICAgICAgICAgdGhpcy54dGFnLl9za2lwQXR0ciA9IHRydWU7CiAgICAgICAgICAgICAgYXR0ci5zZXR0ZXIuY2FsbCh0aGlzLCBhdHRyLmJvb2xlYW4gPyB0cnVlIDogdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhbHVlID0gYXR0ci5za2lwID8gYXR0ci5ib29sZWFuID8gdGhpcy5oYXNBdHRyaWJ1dGUobmFtZSkgOiB0aGlzLmdldEF0dHJpYnV0ZShuYW1lKSA6IHZhbHVlOwogICAgICAgICAgICBzeW5jQXR0cih0aGlzLCBhdHRyLCBuYW1lLCBhdHRyLmJvb2xlYW4gPyAnJyA6IHZhbHVlLCAnc2V0QXR0cmlidXRlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBkZWxldGUgdGhpcy54dGFnLl9za2lwQXR0cjsKICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgcmVtb3ZlQXR0cmlidXRlID0gdGFnLnByb3RvdHlwZS5yZW1vdmVBdHRyaWJ1dGUgfHwgSFRNTEVsZW1lbnQucHJvdG90eXBlLnJlbW92ZUF0dHJpYnV0ZTsKICAgICAgdGFnLnByb3RvdHlwZS5yZW1vdmVBdHRyaWJ1dGUgPSB7CiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgZW51bWJlcmFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChuYW1lKXsKICAgICAgICAgIHZhciBhdHRyID0gdGFnLmF0dHJpYnV0ZXNbbmFtZS50b0xvd2VyQ2FzZSgpXTsKICAgICAgICAgIGlmICghdGhpcy54dGFnLl9za2lwQXR0cikgcmVtb3ZlQXR0cmlidXRlLmNhbGwodGhpcywgbmFtZSk7CiAgICAgICAgICBpZiAoYXR0cikgewogICAgICAgICAgICBpZiAoYXR0ci5zZXR0ZXIgJiYgIXRoaXMueHRhZy5fc2tpcFNldCkgewogICAgICAgICAgICAgIHRoaXMueHRhZy5fc2tpcEF0dHIgPSB0cnVlOwogICAgICAgICAgICAgIGF0dHIuc2V0dGVyLmNhbGwodGhpcywgYXR0ci5ib29sZWFuID8gZmFsc2UgOiB1bmRlZmluZWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN5bmNBdHRyKHRoaXMsIGF0dHIsIG5hbWUsIHVuZGVmaW5lZCwgJ3JlbW92ZUF0dHJpYnV0ZScpOwogICAgICAgICAgfQogICAgICAgICAgZGVsZXRlIHRoaXMueHRhZy5fc2tpcEF0dHI7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIGVsZW1lbnRQcm90byA9IGJhc2VQcm90b3R5cGUgPwogICAgICAgIGJhc2VQcm90b3R5cGUgOgogICAgICAgICAgb3B0aW9uc1snZXh0ZW5kcyddID8KICAgICAgICAgICAgT2JqZWN0LmNyZWF0ZShkb2MuY3JlYXRlRWxlbWVudChvcHRpb25zWydleHRlbmRzJ10pCiAgICAgICAgICAgICAgLmNvbnN0cnVjdG9yKS5wcm90b3R5cGUgOgogICAgICAgICAgd2luLkhUTUxFbGVtZW50LnByb3RvdHlwZTsKCiAgICAgIHJldHVybiBkb2MucmVnaXN0ZXIoX25hbWUsIHsKICAgICAgICAnZXh0ZW5kcyc6IG9wdGlvbnNbJ2V4dGVuZHMnXSwKICAgICAgICAncHJvdG90eXBlJzogT2JqZWN0LmNyZWF0ZShlbGVtZW50UHJvdG8sIHRhZy5wcm90b3R5cGUpCiAgICAgIH0pOwoKICAgIH0sCgogICAgLyogRXhwb3NlZCBWYXJpYWJsZXMgKi8KCiAgICBtaXhpbnM6IHt9LAogICAgcHJlZml4OiBwcmVmaXgsCiAgICB0b3VjaGVzOiB7CiAgICAgIGFjdGl2ZTogW10sCiAgICAgIGNoYW5nZWQ6IFtdCiAgICB9LAogICAgY2FwdHVyZUV2ZW50czogWydmb2N1cycsICdibHVyJywgJ3Njcm9sbCcsICd1bmRlcmZsb3cnLCAnb3ZlcmZsb3cnLCAnb3ZlcmZsb3djaGFuZ2VkJ10sCiAgICBjdXN0b21FdmVudHM6IHsKICAgICAgb3ZlcmZsb3c6IGNyZWF0ZUZsb3dFdmVudCgnb3ZlcicpLAogICAgICB1bmRlcmZsb3c6IGNyZWF0ZUZsb3dFdmVudCgndW5kZXInKSwKICAgICAgYW5pbWF0aW9uc3RhcnQ6IHsKICAgICAgICBhdHRhY2g6IFtwcmVmaXguZG9tICsgJ0FuaW1hdGlvblN0YXJ0J10KICAgICAgfSwKICAgICAgYW5pbWF0aW9uZW5kOiB7CiAgICAgICAgYXR0YWNoOiBbcHJlZml4LmRvbSArICdBbmltYXRpb25FbmQnXQogICAgICB9LAogICAgICB0cmFuc2l0aW9uZW5kOiB7CiAgICAgICAgYXR0YWNoOiBbcHJlZml4LmRvbSArICdUcmFuc2l0aW9uRW5kJ10KICAgICAgfSwKICAgICAgbW92ZTogewogICAgICAgIGF0dGFjaDogWydtb3VzZW1vdmUnLCAndG91Y2htb3ZlJ10sCiAgICAgICAgY29uZGl0aW9uOiB0b3VjaEZpbHRlcgogICAgICB9LAogICAgICBlbnRlcjogewogICAgICAgIGF0dGFjaDogWydtb3VzZW92ZXInLCAndG91Y2hlbnRlciddLAogICAgICAgIGNvbmRpdGlvbjogdG91Y2hGaWx0ZXIKICAgICAgfSwKICAgICAgbGVhdmU6IHsKICAgICAgICBhdHRhY2g6IFsnbW91c2VvdXQnLCAndG91Y2hsZWF2ZSddLAogICAgICAgIGNvbmRpdGlvbjogdG91Y2hGaWx0ZXIKICAgICAgfSwKICAgICAgdGFwc3RhcnQ6IHsKICAgICAgICBvYnNlcnZlOiB7CiAgICAgICAgICBtb3VzZWRvd246IGRvYywKICAgICAgICAgIHRvdWNoc3RhcnQ6IGRvYwogICAgICAgIH0sCiAgICAgICAgY29uZGl0aW9uOiB0b3VjaEZpbHRlcgogICAgICB9LAogICAgICB0YXBlbmQ6IHsKICAgICAgICBvYnNlcnZlOiB7CiAgICAgICAgICBtb3VzZXVwOiBkb2MsCiAgICAgICAgICB0b3VjaGVuZDogZG9jCiAgICAgICAgfSwKICAgICAgICBjb25kaXRpb246IHRvdWNoRmlsdGVyCiAgICAgIH0sCiAgICAgIHRhcG1vdmU6IHsKICAgICAgICBhdHRhY2g6IFsndGFwc3RhcnQnLCAnZHJhZ2VuZCcsICd0b3VjaGNhbmNlbCddLAogICAgICAgIGNvbmRpdGlvbjogZnVuY3Rpb24oZXZlbnQsIGN1c3RvbSl7CiAgICAgICAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnbW92ZSc6ICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgY2FzZSAnZHJhZ292ZXInOgogICAgICAgICAgICAgIHZhciBsYXN0ID0gY3VzdG9tLmxhc3REcmFnIHx8IHt9OwogICAgICAgICAgICAgIGN1c3RvbS5sYXN0RHJhZyA9IGV2ZW50OwogICAgICAgICAgICAgIHJldHVybiAobGFzdC5wYWdlWCAhPSBldmVudC5wYWdlWCAmJiBsYXN0LnBhZ2VZICE9IGV2ZW50LnBhZ2VZKSB8fCBudWxsOwogICAgICAgICAgICBjYXNlICd0YXBzdGFydCc6CiAgICAgICAgICAgICAgY3VzdG9tLnRvdWNoZXMgPSBjdXN0b20udG91Y2hlcyB8fCAxOwogICAgICAgICAgICAgIGlmICghY3VzdG9tLm1vdmUpIHsKICAgICAgICAgICAgICAgIGN1c3RvbS5jdXJyZW50ID0gdGhpczsKICAgICAgICAgICAgICAgIGN1c3RvbS5tb3ZlID0geHRhZy5hZGRFdmVudHModGhpcywgewogICAgICAgICAgICAgICAgICBtb3ZlOiBjdXN0b20ubGlzdGVuZXIsCiAgICAgICAgICAgICAgICAgIGRyYWdvdmVyOiBjdXN0b20ubGlzdGVuZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY3VzdG9tLnRhcGVuZCA9IHh0YWcuYWRkRXZlbnQoZG9jLCAndGFwZW5kJywgY3VzdG9tLmxpc3RlbmVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3RhcGVuZCc6IGNhc2UgJ2RyYWdlbmQnOiBjYXNlICd0b3VjaGNhbmNlbCc6CiAgICAgICAgICAgICAgY3VzdG9tLnRvdWNoZXMtLTsKICAgICAgICAgICAgICBpZiAoIWN1c3RvbS50b3VjaGVzKSB7CiAgICAgICAgICAgICAgICB4dGFnLnJlbW92ZUV2ZW50cyhjdXN0b20uY3VycmVudCAsIGN1c3RvbS5tb3ZlIHx8IHt9KTsKICAgICAgICAgICAgICAgIHh0YWcucmVtb3ZlRXZlbnQoZG9jLCBjdXN0b20udGFwZW5kIHx8IHt9KTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBjdXN0b20ubGFzdERyYWc7CiAgICAgICAgICAgICAgICBkZWxldGUgY3VzdG9tLmN1cnJlbnQ7CiAgICAgICAgICAgICAgICBkZWxldGUgY3VzdG9tLnRhcGVuZDsKICAgICAgICAgICAgICAgIGRlbGV0ZSBjdXN0b20ubW92ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgcHNldWRvczogewogICAgICBrZXlwYXNzOiBrZXlwc2V1ZG8sCiAgICAgIGtleWZhaWw6IGtleXBzZXVkbywKICAgICAgZGVsZWdhdGU6IHsgYWN0aW9uOiBkZWxlZ2F0ZUFjdGlvbiB9LAogICAgICB3aXRoaW46IHsKICAgICAgICBhY3Rpb246IGRlbGVnYXRlQWN0aW9uLAogICAgICAgIG9uQWRkOiBmdW5jdGlvbihwc2V1ZG8pewogICAgICAgICAgdmFyIGNvbmRpdGlvbiA9IHBzZXVkby5zb3VyY2UuY29uZGl0aW9uOwogICAgICAgICAgaWYgKGNvbmRpdGlvbikgcHNldWRvLnNvdXJjZS5jb25kaXRpb24gPSBmdW5jdGlvbihldmVudCwgY3VzdG9tKXsKICAgICAgICAgICAgcmV0dXJuIHh0YWcucXVlcnkodGhpcywgcHNldWRvLnZhbHVlKS5maWx0ZXIoZnVuY3Rpb24obm9kZSl7CiAgICAgICAgICAgICAgcmV0dXJuIG5vZGUgPT0gZXZlbnQudGFyZ2V0IHx8IG5vZGUuY29udGFpbnMgPyBub2RlLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgOiBudWxsOwogICAgICAgICAgICB9KVswXSA/IGNvbmRpdGlvbi5jYWxsKHRoaXMsIGV2ZW50LCBjdXN0b20pIDogbnVsbDsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBwcmV2ZW50YWJsZTogewogICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKHBzZXVkbywgZXZlbnQpIHsKICAgICAgICAgIHJldHVybiAhZXZlbnQuZGVmYXVsdFByZXZlbnRlZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyogVVRJTElUSUVTICovCgogICAgY2xvbmU6IGNsb25lLAogICAgdHlwZU9mOiB0eXBlT2YsCiAgICB0b0FycmF5OiB0b0FycmF5LAoKICAgIHdyYXA6IGZ1bmN0aW9uIChvcmlnaW5hbCwgZm4pIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCl7CiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyksCiAgICAgICAgICByZXR1cm5lZCA9IG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICAgIHJldHVybiByZXR1cm5lZCA9PT0gZmFsc2UgPyBmYWxzZSA6IGZuLmFwcGx5KHRoaXMsIHR5cGVvZiByZXR1cm5lZCAhPSAndW5kZWZpbmVkJyA/IHRvQXJyYXkocmV0dXJuZWQpIDogYXJncyk7CiAgICAgIH07CiAgICB9LAoKICAgIG1lcmdlOiBmdW5jdGlvbihzb3VyY2UsIGssIHYpewogICAgICBpZiAodHlwZU9mKGspID09ICdzdHJpbmcnKSByZXR1cm4gbWVyZ2VPbmUoc291cmNlLCBrLCB2KTsKICAgICAgZm9yICh2YXIgaSA9IDEsIGwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKXsKICAgICAgICB2YXIgb2JqZWN0ID0gYXJndW1lbnRzW2ldOwogICAgICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIG1lcmdlT25lKHNvdXJjZSwga2V5LCBvYmplY3Rba2V5XSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHNvdXJjZTsKICAgIH0sCgogICAgdWlkOiBmdW5jdGlvbigpewogICAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsMTApOwogICAgfSwKCiAgICAvKiBET00gKi8KCiAgICBxdWVyeTogcXVlcnksCgogICAgc2tpcFRyYW5zaXRpb246IGZ1bmN0aW9uKGVsZW1lbnQsIGZuLCBiaW5kKXsKICAgICAgdmFyIHByb3AgPSBwcmVmaXguanMgKyAnVHJhbnNpdGlvblByb3BlcnR5JzsKICAgICAgZWxlbWVudC5zdHlsZVtwcm9wXSA9IGVsZW1lbnQuc3R5bGUudHJhbnNpdGlvblByb3BlcnR5ID0gJ25vbmUnOwogICAgICB4dGFnLnJlcXVlc3RGcmFtZShmdW5jdGlvbigpewogICAgICAgIHZhciBjYWxsYmFjazsKICAgICAgICBpZiAoZm4pIGNhbGxiYWNrID0gZm4uY2FsbChiaW5kKTsKICAgICAgICB4dGFnLnJlcXVlc3RGcmFtZShmdW5jdGlvbigpewogICAgICAgICAgZWxlbWVudC5zdHlsZVtwcm9wXSA9IGVsZW1lbnQuc3R5bGUudHJhbnNpdGlvblByb3BlcnR5ID0gJyc7CiAgICAgICAgICBpZiAoY2FsbGJhY2spIHh0YWcucmVxdWVzdEZyYW1lKGNhbGxiYWNrKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAoKICAgIHJlcXVlc3RGcmFtZTogKGZ1bmN0aW9uKCl7CiAgICAgIHZhciByYWYgPSB3aW4ucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8CiAgICAgICAgd2luW3ByZWZpeC5sb3dlcmNhc2UgKyAnUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ10gfHwKICAgICAgICBmdW5jdGlvbihmbil7IHJldHVybiB3aW4uc2V0VGltZW91dChmbiwgMjApOyB9OwogICAgICByZXR1cm4gZnVuY3Rpb24oZm4pewogICAgICAgIHJldHVybiByYWYuY2FsbCh3aW4sIGZuKTsKICAgICAgfTsKICAgIH0pKCksCgogICAgbWF0Y2hTZWxlY3RvcjogZnVuY3Rpb24gKGVsZW1lbnQsIHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiBtYXRjaFNlbGVjdG9yLmNhbGwoZWxlbWVudCwgc2VsZWN0b3IpOwogICAgfSwKCiAgICBzZXQ6IGZ1bmN0aW9uIChlbGVtZW50LCBtZXRob2QsIHZhbHVlKSB7CiAgICAgIGVsZW1lbnRbbWV0aG9kXSA9IHZhbHVlOwogICAgICBpZiAod2luZG93LkN1c3RvbUVsZW1lbnRzKSBDdXN0b21FbGVtZW50cy51cGdyYWRlQWxsKGVsZW1lbnQpOwogICAgfSwKCiAgICBpbm5lckhUTUw6IGZ1bmN0aW9uKGVsLCBodG1sKXsKICAgICAgeHRhZy5zZXQoZWwsICdpbm5lckhUTUwnLCBodG1sKTsKICAgIH0sCgogICAgaGFzQ2xhc3M6IGZ1bmN0aW9uIChlbGVtZW50LCBrbGFzcykgewogICAgICByZXR1cm4gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoJyAnKS5pbmRleE9mKGtsYXNzLnRyaW0oKSk+LTE7CiAgICB9LAoKICAgIGFkZENsYXNzOiBmdW5jdGlvbiAoZWxlbWVudCwga2xhc3MpIHsKICAgICAgdmFyIGxpc3QgPSBlbGVtZW50LmNsYXNzTmFtZS50cmltKCkuc3BsaXQoJyAnKTsKICAgICAga2xhc3MudHJpbSgpLnNwbGl0KCcgJykuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkgewogICAgICAgIGlmICghfmxpc3QuaW5kZXhPZihuYW1lKSkgbGlzdC5wdXNoKG5hbWUpOwogICAgICB9KTsKICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBsaXN0LmpvaW4oJyAnKS50cmltKCk7CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfSwKCiAgICByZW1vdmVDbGFzczogZnVuY3Rpb24gKGVsZW1lbnQsIGtsYXNzKSB7CiAgICAgIHZhciBjbGFzc2VzID0ga2xhc3MudHJpbSgpLnNwbGl0KCcgJyk7CiAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWUudHJpbSgpLnNwbGl0KCcgJykuZmlsdGVyKGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5hbWUgJiYgIX5jbGFzc2VzLmluZGV4T2YobmFtZSk7CiAgICAgIH0pLmpvaW4oJyAnKTsKICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICB9LAoKICAgIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbiAoZWxlbWVudCwga2xhc3MpIHsKICAgICAgcmV0dXJuIHh0YWdbeHRhZy5oYXNDbGFzcyhlbGVtZW50LCBrbGFzcykgPyAncmVtb3ZlQ2xhc3MnIDogJ2FkZENsYXNzJ10uY2FsbChudWxsLCBlbGVtZW50LCBrbGFzcyk7CiAgICB9LAoKICAgIHF1ZXJ5Q2hpbGRyZW46IGZ1bmN0aW9uIChlbGVtZW50LCBzZWxlY3RvcikgewogICAgICB2YXIgaWQgPSBlbGVtZW50LmlkLAogICAgICAgIGd1aWQgPSBlbGVtZW50LmlkID0gaWQgfHwgJ3hfJyArIHh0YWcudWlkKCksCiAgICAgICAgYXR0ciA9ICcjJyArIGd1aWQgKyAnID4gJzsKICAgICAgc2VsZWN0b3IgPSBhdHRyICsgKHNlbGVjdG9yICsgJycpLnJlcGxhY2UoJywnLCAnLCcgKyBhdHRyLCAnZycpOwogICAgICB2YXIgcmVzdWx0ID0gZWxlbWVudC5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgICBpZiAoIWlkKSBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTsKICAgICAgcmV0dXJuIHRvQXJyYXkocmVzdWx0KTsKICAgIH0sCgogICAgY3JlYXRlRnJhZ21lbnQ6IGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgICAgdmFyIGZyYWcgPSBkb2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICBpZiAoY29udGVudCkgewogICAgICAgIHZhciBkaXYgPSBmcmFnLmFwcGVuZENoaWxkKGRvYy5jcmVhdGVFbGVtZW50KCdkaXYnKSksCiAgICAgICAgICBub2RlcyA9IHRvQXJyYXkoY29udGVudC5ub2RlTmFtZSA/IGFyZ3VtZW50cyA6ICEoZGl2LmlubmVySFRNTCA9IGNvbnRlbnQpIHx8IGRpdi5jaGlsZHJlbiksCiAgICAgICAgICBsZW5ndGggPSBub2Rlcy5sZW5ndGgsCiAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSBmcmFnLmluc2VydEJlZm9yZShub2Rlc1tpbmRleCsrXSwgZGl2KTsKICAgICAgICBmcmFnLnJlbW92ZUNoaWxkKGRpdik7CiAgICAgIH0KICAgICAgcmV0dXJuIGZyYWc7CiAgICB9LAoKICAgIG1hbmlwdWxhdGU6IGZ1bmN0aW9uKGVsZW1lbnQsIGZuKXsKICAgICAgdmFyIG5leHQgPSBlbGVtZW50Lm5leHRTaWJsaW5nLAogICAgICAgIHBhcmVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSwKICAgICAgICBmcmFnID0gZG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKICAgICAgICByZXR1cm5lZCA9IGZuLmNhbGwoZnJhZy5hcHBlbmRDaGlsZChlbGVtZW50KSwgZnJhZykgfHwgZWxlbWVudDsKICAgICAgaWYgKG5leHQpIHBhcmVudC5pbnNlcnRCZWZvcmUocmV0dXJuZWQsIG5leHQpOwogICAgICBlbHNlIHBhcmVudC5hcHBlbmRDaGlsZChyZXR1cm5lZCk7CiAgICB9LAoKICAgIC8qIFBTRVVET1MgKi8KCiAgICBhcHBseVBzZXVkb3M6IGZ1bmN0aW9uKGtleSwgZm4sIGVsZW1lbnQsIHNvdXJjZSkgewogICAgICB2YXIgbGlzdGVuZXIgPSBmbiwKICAgICAgICAgIHBzZXVkb3MgPSB7fTsKICAgICAgaWYgKGtleS5tYXRjaCgnOicpKSB7CiAgICAgICAgdmFyIHNwbGl0ID0ga2V5Lm1hdGNoKHJlZ2V4UHNldWRvU3BsaXQpLAogICAgICAgICAgICBpID0gc3BsaXQubGVuZ3RoOwogICAgICAgIHdoaWxlICgtLWkpIHsKICAgICAgICAgIHNwbGl0W2ldLnJlcGxhY2UocmVnZXhQc2V1ZG9SZXBsYWNlLCBmdW5jdGlvbiAobWF0Y2gsIG5hbWUsIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICgheHRhZy5wc2V1ZG9zW25hbWVdKSB0aHJvdyAicHNldWRvIG5vdCBmb3VuZDogIiArIG5hbWUgKyAiICIgKyBzcGxpdDsKICAgICAgICAgICAgdmFyIHBzZXVkbyA9IHBzZXVkb3NbaV0gPSBPYmplY3QuY3JlYXRlKHh0YWcucHNldWRvc1tuYW1lXSk7CiAgICAgICAgICAgICAgICBwc2V1ZG8ua2V5ID0ga2V5OwogICAgICAgICAgICAgICAgcHNldWRvLm5hbWUgPSBuYW1lOwogICAgICAgICAgICAgICAgcHNldWRvLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgICBwc2V1ZG9bJ2FyZ3VtZW50cyddID0gKHZhbHVlIHx8ICcnKS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgcHNldWRvLmFjdGlvbiA9IHBzZXVkby5hY3Rpb24gfHwgdHJ1ZW9wOwogICAgICAgICAgICAgICAgcHNldWRvLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgICAgICAgdmFyIGxhc3QgPSBsaXN0ZW5lcjsKICAgICAgICAgICAgbGlzdGVuZXIgPSBmdW5jdGlvbigpewogICAgICAgICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpLAogICAgICAgICAgICAgICAgICBvYmogPSB7CiAgICAgICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBzb3VyY2UsCiAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXI6IGxhc3QKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB2YXIgb3V0cHV0ID0gcHNldWRvLmFjdGlvbi5hcHBseSh0aGlzLCBbb2JqXS5jb25jYXQoYXJncykpOwogICAgICAgICAgICAgIGlmIChvdXRwdXQgPT09IG51bGwgfHwgb3V0cHV0ID09PSBmYWxzZSkgcmV0dXJuIG91dHB1dDsKICAgICAgICAgICAgICByZXR1cm4gb2JqLmxpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoZWxlbWVudCAmJiBwc2V1ZG8ub25BZGQpIHsKICAgICAgICAgICAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUpIHBzZXVkby5vbkFkZC5jYWxsKGVsZW1lbnQsIHBzZXVkbyk7CiAgICAgICAgICAgICAgZWxzZSBlbGVtZW50LnB1c2gocHNldWRvKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAodmFyIHogaW4gcHNldWRvcykgewogICAgICAgIGlmIChwc2V1ZG9zW3pdLm9uQ29tcGlsZWQpIGxpc3RlbmVyID0gcHNldWRvc1t6XS5vbkNvbXBpbGVkKGxpc3RlbmVyLCBwc2V1ZG9zW3pdKSB8fCBsaXN0ZW5lcjsKICAgICAgfQogICAgICByZXR1cm4gbGlzdGVuZXI7CiAgICB9LAoKICAgIHJlbW92ZVBzZXVkb3M6IGZ1bmN0aW9uKGVsZW1lbnQsIGV2ZW50KXsKICAgICAgZXZlbnQuX3BzZXVkb3MuZm9yRWFjaChmdW5jdGlvbihvYmopewogICAgICAgIGlmIChvYmoub25SZW1vdmUpIG9iai5vblJlbW92ZS5jYWxsKGVsZW1lbnQsIG9iaik7CiAgICAgIH0pOwogICAgfSwKCiAgLyoqKiBFdmVudHMgKioqLwoKICAgIHBhcnNlRXZlbnQ6IGZ1bmN0aW9uKHR5cGUsIGZuKSB7CiAgICAgIHZhciBwc2V1ZG9zID0gdHlwZS5zcGxpdCgnOicpLAogICAgICAgICAga2V5ID0gcHNldWRvcy5zaGlmdCgpLAogICAgICAgICAgY3VzdG9tID0geHRhZy5jdXN0b21FdmVudHNba2V5XSwKICAgICAgICAgIGV2ZW50ID0geHRhZy5tZXJnZSh7CiAgICAgICAgICAgIHR5cGU6IGtleSwKICAgICAgICAgICAgc3RhY2s6IG5vb3AsCiAgICAgICAgICAgIGNvbmRpdGlvbjogdHJ1ZW9wLAogICAgICAgICAgICBhdHRhY2g6IFtdLAogICAgICAgICAgICBfYXR0YWNoOiBbXSwKICAgICAgICAgICAgcHNldWRvczogJycsCiAgICAgICAgICAgIF9wc2V1ZG9zOiBbXSwKICAgICAgICAgICAgb25BZGQ6IG5vb3AsCiAgICAgICAgICAgIG9uUmVtb3ZlOiBub29wCiAgICAgICAgICB9LCBjdXN0b20gfHwge30pOwogICAgICBldmVudC5hdHRhY2ggPSB0b0FycmF5KGV2ZW50LmJhc2UgfHwgZXZlbnQuYXR0YWNoKTsKICAgICAgZXZlbnQuY2hhaW4gPSBrZXkgKyAoZXZlbnQucHNldWRvcy5sZW5ndGggPyAnOicgKyBldmVudC5wc2V1ZG9zIDogJycpICsgKHBzZXVkb3MubGVuZ3RoID8gJzonICsgcHNldWRvcy5qb2luKCc6JykgOiAnJyk7CiAgICAgIHZhciBjb25kaXRpb24gPSBldmVudC5jb25kaXRpb247CiAgICAgIGV2ZW50LmNvbmRpdGlvbiA9IGZ1bmN0aW9uKGUpewogICAgICAgIHZhciB0ID0gZS50b3VjaGVzLCB0dCA9IGUudGFyZ2V0VG91Y2hlczsKICAgICAgICByZXR1cm4gY29uZGl0aW9uLmFwcGx5KHRoaXMsIHRvQXJyYXkoYXJndW1lbnRzKSk7CiAgICAgIH07CiAgICAgIHZhciBzdGFjayA9IHh0YWcuYXBwbHlQc2V1ZG9zKGV2ZW50LmNoYWluLCBmbiwgZXZlbnQuX3BzZXVkb3MsIGV2ZW50KTsKICAgICAgZXZlbnQuc3RhY2sgPSBmdW5jdGlvbihlKXsKICAgICAgICB2YXIgdCA9IGUudG91Y2hlcywgdHQgPSBlLnRhcmdldFRvdWNoZXM7CiAgICAgICAgdmFyIGRldGFpbCA9IGUuZGV0YWlsIHx8IHt9OwogICAgICAgIGlmICghZGV0YWlsLl9fc3RhY2tfXykgcmV0dXJuIHN0YWNrLmFwcGx5KHRoaXMsIHRvQXJyYXkoYXJndW1lbnRzKSk7CiAgICAgICAgZWxzZSBpZiAoZGV0YWlsLl9fc3RhY2tfXyA9PSBzdGFjaykgewogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiBzdGFjay5hcHBseSh0aGlzLCB0b0FycmF5KGFyZ3VtZW50cykpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgZXZlbnQubGlzdGVuZXIgPSBmdW5jdGlvbihlKXsKICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKSwKICAgICAgICAgICAgb3V0cHV0ID0gZXZlbnQuY29uZGl0aW9uLmFwcGx5KHRoaXMsIGFyZ3MuY29uY2F0KFtldmVudF0pKTsKICAgICAgICBpZiAoIW91dHB1dCkgcmV0dXJuIG91dHB1dDsKICAgICAgICBpZiAoZS50eXBlICE9IGtleSkgeHRhZy5maXJlRXZlbnQoZS50YXJnZXQsIGtleSwgeyBiYXNlRXZlbnQ6IGUsIGRldGFpbDogeyBfX3N0YWNrX186IHN0YWNrIH0gfSk7CiAgICAgICAgZWxzZSByZXR1cm4gZXZlbnQuc3RhY2suYXBwbHkodGhpcywgYXJncyk7CiAgICAgIH07CiAgICAgIGV2ZW50LmF0dGFjaC5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICBldmVudC5fYXR0YWNoLnB1c2goeHRhZy5wYXJzZUV2ZW50KG5hbWUsIGV2ZW50Lmxpc3RlbmVyKSk7CiAgICAgIH0pOwogICAgICBpZiAoY3VzdG9tICYmIGN1c3RvbS5vYnNlcnZlICYmICFjdXN0b20uX19vYnNlcnZpbmdfXykgewogICAgICAgIGN1c3RvbS5vYnNlcnZlciA9IGZ1bmN0aW9uKGUpewogICAgICAgICAgdmFyIG91dHB1dCA9IGV2ZW50LmNvbmRpdGlvbi5hcHBseSh0aGlzLCB0b0FycmF5KGFyZ3VtZW50cykuY29uY2F0KFtjdXN0b21dKSk7CiAgICAgICAgICBpZiAoIW91dHB1dCkgcmV0dXJuIG91dHB1dDsKICAgICAgICAgIHh0YWcuZmlyZUV2ZW50KGUudGFyZ2V0LCBrZXksIHsgYmFzZUV2ZW50OiBlIH0pOwogICAgICAgIH07CiAgICAgICAgZm9yICh2YXIgeiBpbiBjdXN0b20ub2JzZXJ2ZSkgeHRhZy5hZGRFdmVudChjdXN0b20ub2JzZXJ2ZVt6XSB8fCBkb2N1bWVudCwgeiwgY3VzdG9tLm9ic2VydmVyLCB0cnVlKTsKICAgICAgICBjdXN0b20uX19vYnNlcnZpbmdfXyA9IHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGV2ZW50OwogICAgfSwKCiAgICBhZGRFdmVudDogZnVuY3Rpb24gKGVsZW1lbnQsIHR5cGUsIGZuLCBjYXB0dXJlKSB7CiAgICAgIHZhciBldmVudCA9ICh0eXBlb2YgZm4gPT0gJ2Z1bmN0aW9uJykgPyB4dGFnLnBhcnNlRXZlbnQodHlwZSwgZm4pIDogZm47CiAgICAgIGV2ZW50Ll9wc2V1ZG9zLmZvckVhY2goZnVuY3Rpb24ob2JqKXsKICAgICAgICBvYmoub25BZGQuY2FsbChlbGVtZW50LCBvYmopOwogICAgICB9KTsKICAgICAgZXZlbnQuX2F0dGFjaC5mb3JFYWNoKGZ1bmN0aW9uKG9iaikgewogICAgICAgIHh0YWcuYWRkRXZlbnQoZWxlbWVudCwgb2JqLnR5cGUsIG9iaik7CiAgICAgIH0pOwogICAgICBldmVudC5vbkFkZC5jYWxsKGVsZW1lbnQsIGV2ZW50LCBldmVudC5saXN0ZW5lcik7CiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudC50eXBlLCBldmVudC5zdGFjaywgY2FwdHVyZSB8fCB4dGFnLmNhcHR1cmVFdmVudHMuaW5kZXhPZihldmVudC50eXBlKSA+IC0xKTsKICAgICAgcmV0dXJuIGV2ZW50OwogICAgfSwKCiAgICBhZGRFdmVudHM6IGZ1bmN0aW9uIChlbGVtZW50LCBvYmopIHsKICAgICAgdmFyIGV2ZW50cyA9IHt9OwogICAgICBmb3IgKHZhciB6IGluIG9iaikgewogICAgICAgIGV2ZW50c1t6XSA9IHh0YWcuYWRkRXZlbnQoZWxlbWVudCwgeiwgb2JqW3pdKTsKICAgICAgfQogICAgICByZXR1cm4gZXZlbnRzOwogICAgfSwKCiAgICByZW1vdmVFdmVudDogZnVuY3Rpb24gKGVsZW1lbnQsIHR5cGUsIGV2ZW50KSB7CiAgICAgIGV2ZW50ID0gZXZlbnQgfHwgdHlwZTsKICAgICAgZXZlbnQub25SZW1vdmUuY2FsbChlbGVtZW50LCBldmVudCwgZXZlbnQubGlzdGVuZXIpOwogICAgICB4dGFnLnJlbW92ZVBzZXVkb3MoZWxlbWVudCwgZXZlbnQpOwogICAgICBldmVudC5fYXR0YWNoLmZvckVhY2goZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgeHRhZy5yZW1vdmVFdmVudChlbGVtZW50LCBvYmopOwogICAgICB9KTsKICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LnR5cGUsIGV2ZW50LnN0YWNrKTsKICAgIH0sCgogICAgcmVtb3ZlRXZlbnRzOiBmdW5jdGlvbihlbGVtZW50LCBvYmopewogICAgICBmb3IgKHZhciB6IGluIG9iaikgeHRhZy5yZW1vdmVFdmVudChlbGVtZW50LCBvYmpbel0pOwogICAgfSwKCiAgICBmaXJlRXZlbnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIHR5cGUsIG9wdGlvbnMsIHdhcm4pewogICAgICB2YXIgZXZlbnQgPSBkb2MuY3JlYXRlRXZlbnQoJ0N1c3RvbUV2ZW50Jyk7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICBpZiAod2FybikgY29uc29sZS53YXJuKCdmaXJlRXZlbnQgaGFzIGJlZW4gbW9kaWZpZWQsIG1vcmUgaW5mbyBoZXJlOiAnKTsKICAgICAgZXZlbnQuaW5pdEN1c3RvbUV2ZW50KHR5cGUsCiAgICAgICAgb3B0aW9ucy5idWJibGVzICE9PSBmYWxzZSwKICAgICAgICBvcHRpb25zLmNhbmNlbGFibGUgIT09IGZhbHNlLAogICAgICAgIG9wdGlvbnMuZGV0YWlsCiAgICAgICk7CiAgICAgIGlmIChvcHRpb25zLmJhc2VFdmVudCkgaW5oZXJpdEV2ZW50KGV2ZW50LCBvcHRpb25zLmJhc2VFdmVudCk7CiAgICAgIHRyeSB7IGVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7IH0KICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1RoaXMgZXJyb3IgbWF5IGhhdmUgYmVlbiBjYXVzZWQgYnkgYSBjaGFuZ2UgaW4gdGhlIGZpcmVFdmVudCBtZXRob2QsIG1vcmUgaW5mbyBoZXJlOiAnLCBlKTsKICAgICAgfQogICAgfSwKCiAgICBhZGRPYnNlcnZlcjogZnVuY3Rpb24oZWxlbWVudCwgdHlwZSwgZm4pewogICAgICBpZiAoIWVsZW1lbnQuX3JlY29yZHMpIHsKICAgICAgICBlbGVtZW50Ll9yZWNvcmRzID0geyBpbnNlcnRlZDogW10sIHJlbW92ZWQ6IFtdIH07CiAgICAgICAgaWYgKG11dGF0aW9uKXsKICAgICAgICAgIGVsZW1lbnQuX29ic2VydmVyID0gbmV3IG11dGF0aW9uKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgICBwYXJzZU11dGF0aW9ucyhlbGVtZW50LCBtdXRhdGlvbnMpOwogICAgICAgICAgfSk7CiAgICAgICAgICBlbGVtZW50Ll9vYnNlcnZlci5vYnNlcnZlKGVsZW1lbnQsIHsKICAgICAgICAgICAgc3VidHJlZTogdHJ1ZSwKICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLAogICAgICAgICAgICBhdHRyaWJ1dGVzOiAhdHJ1ZSwKICAgICAgICAgICAgY2hhcmFjdGVyRGF0YTogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlIFsnSW5zZXJ0ZWQnLCAnUmVtb3ZlZCddLmZvckVhY2goZnVuY3Rpb24odHlwZSl7CiAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGUnICsgdHlwZSwgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICBldmVudC5fbXV0YXRpb24gPSB0cnVlOwogICAgICAgICAgICBlbGVtZW50Ll9yZWNvcmRzW3R5cGUudG9Mb3dlckNhc2UoKV0uZm9yRWFjaChmdW5jdGlvbihmbil7CiAgICAgICAgICAgICAgZm4oZXZlbnQudGFyZ2V0LCBldmVudCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwgZmFsc2UpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChlbGVtZW50Ll9yZWNvcmRzW3R5cGVdLmluZGV4T2YoZm4pID09IC0xKSBlbGVtZW50Ll9yZWNvcmRzW3R5cGVdLnB1c2goZm4pOwogICAgfSwKCiAgICByZW1vdmVPYnNlcnZlcjogZnVuY3Rpb24oZWxlbWVudCwgdHlwZSwgZm4pewogICAgICB2YXIgb2JqID0gZWxlbWVudC5fcmVjb3JkczsKICAgICAgaWYgKG9iaiAmJiBmbil7CiAgICAgICAgb2JqW3R5cGVdLnNwbGljZShvYmpbdHlwZV0uaW5kZXhPZihmbiksIDEpOwogICAgICB9CiAgICAgIGVsc2V7CiAgICAgICAgb2JqW3R5cGVdID0gW107CiAgICAgIH0KICAgIH0KCiAgfTsKCi8qKiogVW5pdmVyc2FsIFRvdWNoICoqKi8KCnZhciB0b3VjaENvdW50ID0gMCwgdG91Y2hUYXJnZXQgPSBudWxsOwoKZG9jLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpewogIHRvdWNoQ291bnQrKzsKICB0b3VjaFRhcmdldCA9IGUudGFyZ2V0Owp9LCB0cnVlKTsKCmRvYy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24oKXsKICB0b3VjaENvdW50LS07CiAgdG91Y2hUYXJnZXQgPSBudWxsOwp9LCBmYWxzZSk7Cgp2YXIgVUlFdmVudFByb3RvID0gewogIHRvdWNoZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIGdldDogZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIHRoaXMuX190b3VjaGVzX18gfHwKICAgICAgICAodGhpcy5pZGVudGlmaWVyID0gMCkgfHwKICAgICAgICAodGhpcy5fX3RvdWNoZXNfXyA9IHRvdWNoQ291bnQgPyBbdGhpc10gOiBbXSk7CiAgICB9CiAgfSwKICB0YXJnZXRUb3VjaGVzOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICBnZXQ6IGZ1bmN0aW9uKCl7CiAgICAgIHJldHVybiB0aGlzLl9fdGFyZ2V0VG91Y2hlc19fIHx8ICh0aGlzLl9fdGFyZ2V0VG91Y2hlc19fID0KICAgICAgICAodG91Y2hDb3VudCAmJiB0aGlzLmN1cnJlbnRUYXJnZXQgJiYKICAgICAgICAodGhpcy5jdXJyZW50VGFyZ2V0ID09IHRvdWNoVGFyZ2V0IHx8CiAgICAgICAgKHRoaXMuY3VycmVudFRhcmdldC5jb250YWlucyAmJiB0aGlzLmN1cnJlbnRUYXJnZXQuY29udGFpbnModG91Y2hUYXJnZXQpKSkpID8gW3RoaXNdIDogW10pOwogICAgfQogIH0sCiAgY2hhbmdlZFRvdWNoZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIGdldDogZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIHRoaXMudG91Y2hlczsKICAgIH0KICB9Cn07Cgpmb3IgKHogaW4gVUlFdmVudFByb3RvKXsKICBVSUV2ZW50LnByb3RvdHlwZVt6XSA9IFVJRXZlbnRQcm90b1t6XTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVUlFdmVudC5wcm90b3R5cGUsIHosIFVJRXZlbnRQcm90b1t6XSk7Cn0KCnZhciB0b3VjaFJlc2V0ID0gewogICAgdmFsdWU6IG51bGwsCiAgICB3cml0YWJsZTogdHJ1ZSwKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgVG91Y2hFdmVudFByb3RvID0gewogICAgdG91Y2hlczogdG91Y2hSZXNldCwKICAgIHRhcmdldFRvdWNoZXM6IHRvdWNoUmVzZXQsCiAgICBjaGFuZ2VkVG91Y2hlczogdG91Y2hSZXNldAogIH07CgppZiAod2luLlRvdWNoRXZlbnQpIHsKICBmb3IgKHogaW4gVG91Y2hFdmVudFByb3RvKSB3aW4uVG91Y2hFdmVudC5wcm90b3R5cGVbel0gPSBUb3VjaEV2ZW50UHJvdG9bel07Cn0KCi8qKiogQ3VzdG9tIEV2ZW50IERlZmluaXRpb25zICoqKi8KCiAgZnVuY3Rpb24gYWRkVGFwKGVsLCB0YXAsIGUpewogICAgaWYgKCFlbC5fX3RhcF9fKSB7CiAgICAgIGVsLl9fdGFwX18gPSB7IGNsaWNrOiBlLnR5cGUgPT0gJ21vdXNlZG93bicgfTsKICAgICAgaWYgKGVsLl9fdGFwX18uY2xpY2spIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGFwLm9ic2VydmVyKTsKICAgICAgZWxzZSB7CiAgICAgICAgZWwuX190YXBfXy5zY3JvbGwgPSB0YXAub2JzZXJ2ZXIuYmluZChlbCk7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGVsLl9fdGFwX18uc2Nyb2xsLCB0cnVlKTsKICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0YXAub2JzZXJ2ZXIpOwogICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgdGFwLm9ic2VydmVyKTsKICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRhcC5vYnNlcnZlcik7CiAgICAgIH0KICAgIH0KICAgIGlmICghZWwuX190YXBfXy5jbGljaykgewogICAgICBlbC5fX3RhcF9fLnggPSBlLnRvdWNoZXNbMF0ucGFnZVg7CiAgICAgIGVsLl9fdGFwX18ueSA9IGUudG91Y2hlc1swXS5wYWdlWTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlbW92ZVRhcChlbCwgdGFwKXsKICAgIGlmIChlbC5fX3RhcF9fKSB7CiAgICAgIGlmIChlbC5fX3RhcF9fLmNsaWNrKSBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRhcC5vYnNlcnZlcik7CiAgICAgIGVsc2UgewogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBlbC5fX3RhcF9fLnNjcm9sbCwgdHJ1ZSk7CiAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGFwLm9ic2VydmVyKTsKICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGNhbmNlbCcsIHRhcC5vYnNlcnZlcik7CiAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0YXAub2JzZXJ2ZXIpOwogICAgICB9CiAgICAgIGRlbGV0ZSBlbC5fX3RhcF9fOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hlY2tUYXBQb3NpdGlvbihlbCwgdGFwLCBlKXsKICAgIHZhciB0b3VjaCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07CiAgICBpZiAoCiAgICAgIHRvdWNoLnBhZ2VYIDwgZWwuX190YXBfXy54ICsgdGFwLmdlc3R1cmUudG9sZXJhbmNlICYmCiAgICAgIHRvdWNoLnBhZ2VYID4gZWwuX190YXBfXy54IC0gdGFwLmdlc3R1cmUudG9sZXJhbmNlICYmCiAgICAgIHRvdWNoLnBhZ2VZIDwgZWwuX190YXBfXy55ICsgdGFwLmdlc3R1cmUudG9sZXJhbmNlICYmCiAgICAgIHRvdWNoLnBhZ2VZID4gZWwuX190YXBfXy55IC0gdGFwLmdlc3R1cmUudG9sZXJhbmNlCiAgICApIHJldHVybiB0cnVlOwogIH0KCiAgeHRhZy5jdXN0b21FdmVudHMudGFwID0gewogICAgb2JzZXJ2ZTogewogICAgICBtb3VzZWRvd246IGRvY3VtZW50LAogICAgICB0b3VjaHN0YXJ0OiBkb2N1bWVudAogICAgfSwKICAgIGdlc3R1cmU6IHsKICAgICAgdG9sZXJhbmNlOiA4CiAgICB9LAogICAgY29uZGl0aW9uOiBmdW5jdGlvbihlLCB0YXApewogICAgICB2YXIgZWwgPSBlLnRhcmdldDsKICAgICAgc3dpdGNoIChlLnR5cGUpIHsKICAgICAgICBjYXNlICd0b3VjaHN0YXJ0JzoKICAgICAgICAgIGlmIChlbC5fX3RhcF9fICYmIGVsLl9fdGFwX18uY2xpY2spIHJlbW92ZVRhcChlbCwgdGFwKTsKICAgICAgICAgIGFkZFRhcChlbCwgdGFwLCBlKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICBjYXNlICdtb3VzZWRvd24nOgogICAgICAgICAgaWYgKCFlbC5fX3RhcF9fKSBhZGRUYXAoZWwsIHRhcCwgZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgY2FzZSAnc2Nyb2xsJzoKICAgICAgICBjYXNlICd0b3VjaGNhbmNlbCc6CiAgICAgICAgICByZW1vdmVUYXAodGhpcywgdGFwKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICBjYXNlICd0b3VjaG1vdmUnOgogICAgICAgIGNhc2UgJ3RvdWNoZW5kJzoKICAgICAgICAgIGlmICh0aGlzLl9fdGFwX18gJiYgIWNoZWNrVGFwUG9zaXRpb24odGhpcywgdGFwLCBlKSkgewogICAgICAgICAgICByZW1vdmVUYXAodGhpcywgdGFwKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUudHlwZSA9PSAndG91Y2hlbmQnIHx8IG51bGw7CiAgICAgICAgY2FzZSAnY2xpY2snOgogICAgICAgICAgcmVtb3ZlVGFwKHRoaXMsIHRhcCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogIH07CgogIHdpbi54dGFnID0geHRhZzsKICBpZiAodHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIGRlZmluZSh4dGFnKTsKCiAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoJ1dlYkNvbXBvbmVudHNSZWFkeScsIGZ1bmN0aW9uKCl7CiAgICB4dGFnLmZpcmVFdmVudChkb2MuYm9keSwgJ0RPTUNvbXBvbmVudHNMb2FkZWQnKTsKICB9KTsKCn0pKCk7Cg==",
                "body": "LyoKIExlYWZsZXQsIGEgSmF2YVNjcmlwdCBsaWJyYXJ5IGZvciBtb2JpbGUtZnJpZW5kbHkgaW50ZXJhY3RpdmUgbWFwcy4gaHR0cDovL2xlYWZsZXRqcy5jb20KIChjKSAyMDEwLTIwMTMsIFZsYWRpbWlyIEFnYWZvbmtpbgogKGMpIDIwMTAtMjAxMSwgQ2xvdWRNYWRlCiovCiFmdW5jdGlvbih0LGUsaSl7dmFyIG49dC5MLG89e307by52ZXJzaW9uPSIwLjctZGV2Iiwib2JqZWN0Ij09dHlwZW9mIG1vZHVsZSYmIm9iamVjdCI9PXR5cGVvZiBtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1vOiJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQmJmRlZmluZShvKSxvLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gdC5MPW4sdGhpc30sdC5MPW8sby5VdGlsPXtleHRlbmQ6ZnVuY3Rpb24odCl7dmFyIGUsaSxuLG8scz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKGk9MCxuPXMubGVuZ3RoO24+aTtpKyspe289c1tpXXx8e307Zm9yKGUgaW4gbylvLmhhc093blByb3BlcnR5KGUpJiYodFtlXT1vW2VdKX1yZXR1cm4gdH0sYmluZDpmdW5jdGlvbih0LGUpe3ZhciBpPWFyZ3VtZW50cy5sZW5ndGg+Mj9BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMik6bnVsbDtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdC5hcHBseShlLGl8fGFyZ3VtZW50cyl9fSxzdGFtcDpmdW5jdGlvbigpe3ZhciB0PTAsZT0iX2xlYWZsZXRfaWQiO3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4gaVtlXT1pW2VdfHwrK3QsaVtlXX19KCksaW52b2tlRWFjaDpmdW5jdGlvbih0LGUsaSl7dmFyIG4sbztpZigib2JqZWN0Ij09dHlwZW9mIHQpe289QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDMpO2ZvcihuIGluIHQpZS5hcHBseShpLFtuLHRbbl1dLmNvbmNhdChvKSk7cmV0dXJuITB9cmV0dXJuITF9LGxpbWl0RXhlY0J5SW50ZXJ2YWw6ZnVuY3Rpb24odCxlLGkpe3ZhciBuLG87cmV0dXJuIGZ1bmN0aW9uIHMoKXt2YXIgYT1hcmd1bWVudHM7cmV0dXJuIG4/KG89ITAsdm9pZCAwKToobj0hMCxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7bj0hMSxvJiYocy5hcHBseShpLGEpLG89ITEpfSxlKSx0LmFwcGx5KGksYSksdm9pZCAwKX19LGZhbHNlRm46ZnVuY3Rpb24oKXtyZXR1cm4hMX0sZm9ybWF0TnVtOmZ1bmN0aW9uKHQsZSl7dmFyIGk9TWF0aC5wb3coMTAsZXx8NSk7cmV0dXJuIE1hdGgucm91bmQodCppKS9pfSx0cmltOmZ1bmN0aW9uKHQpe3JldHVybiB0LnRyaW0/dC50cmltKCk6dC5yZXBsYWNlKC9eXHMrfFxzKyQvZywiIil9LHNwbGl0V29yZHM6ZnVuY3Rpb24odCl7cmV0dXJuIG8uVXRpbC50cmltKHQpLnNwbGl0KC9ccysvKX0sc2V0T3B0aW9uczpmdW5jdGlvbih0LGUpe3JldHVybiB0Lm9wdGlvbnM9by5leHRlbmQoe30sdC5vcHRpb25zLGUpLHQub3B0aW9uc30sZ2V0UGFyYW1TdHJpbmc6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPVtdO2Zvcih2YXIgbyBpbiB0KW4ucHVzaChlbmNvZGVVUklDb21wb25lbnQoaT9vLnRvVXBwZXJDYXNlKCk6bykrIj0iK2VuY29kZVVSSUNvbXBvbmVudCh0W29dKSk7cmV0dXJuKGUmJi0xIT09ZS5pbmRleE9mKCI/Iik/IiYiOiI/Iikrbi5qb2luKCImIil9LGNvbXBpbGVUZW1wbGF0ZTpmdW5jdGlvbih0LGUpe3JldHVybiB0PXQucmVwbGFjZSgvXHsgKihbXHdfXSspICpcfS9nLGZ1bmN0aW9uKHQsaSl7cmV0dXJuJyIgKyBvWyInK2krJyJdJysoImZ1bmN0aW9uIj09dHlwZW9mIGVbaV0/IihvKSI6IiIpKycgKyAiJ30pLG5ldyBGdW5jdGlvbigibyIsJ3JldHVybiAiJyt0KyciOycpfSx0ZW1wbGF0ZTpmdW5jdGlvbih0LGUpe3ZhciBpPW8uVXRpbC5fdGVtcGxhdGVDYWNoZT1vLlV0aWwuX3RlbXBsYXRlQ2FjaGV8fHt9O3JldHVybiBpW3RdPWlbdF18fG8uVXRpbC5jb21waWxlVGVtcGxhdGUodCxlKSxpW3RdKGUpfSxpc0FycmF5OkFycmF5LmlzQXJyYXl8fGZ1bmN0aW9uKHQpe3JldHVybiJbb2JqZWN0IEFycmF5XSI9PT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCl9LGVtcHR5SW1hZ2VVcmw6ImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBQUQvQUN3QUFBQUFBUUFCQUFBQ0FEcz0ifSxmdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSl7dmFyIGksbixvPVsid2Via2l0IiwibW96IiwibyIsIm1zIl07Zm9yKGk9MDtpPG8ubGVuZ3RoJiYhbjtpKyspbj10W29baV0rZV07cmV0dXJuIG59ZnVuY3Rpb24gaShlKXt2YXIgaT0rbmV3IERhdGUsbz1NYXRoLm1heCgwLDE2LShpLW4pKTtyZXR1cm4gbj1pK28sdC5zZXRUaW1lb3V0KGUsbyl9dmFyIG49MCxzPXQucmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxlKCJSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiKXx8aSxhPXQuY2FuY2VsQW5pbWF0aW9uRnJhbWV8fGUoIkNhbmNlbEFuaW1hdGlvbkZyYW1lIil8fGUoIkNhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSIpfHxmdW5jdGlvbihlKXt0LmNsZWFyVGltZW91dChlKX07by5VdGlsLnJlcXVlc3RBbmltRnJhbWU9ZnVuY3Rpb24oZSxuLGEscil7cmV0dXJuIGU9by5iaW5kKGUsbiksYSYmcz09PWk/KGUoKSx2b2lkIDApOnMuY2FsbCh0LGUscil9LG8uVXRpbC5jYW5jZWxBbmltRnJhbWU9ZnVuY3Rpb24oZSl7ZSYmYS5jYWxsKHQsZSl9fSgpLG8uZXh0ZW5kPW8uVXRpbC5leHRlbmQsby5iaW5kPW8uVXRpbC5iaW5kLG8uc3RhbXA9by5VdGlsLnN0YW1wLG8uc2V0T3B0aW9ucz1vLlV0aWwuc2V0T3B0aW9ucyxvLkNsYXNzPWZ1bmN0aW9uKCl7fSxvLkNsYXNzLmV4dGVuZD1mdW5jdGlvbih0KXt2YXIgZT1mdW5jdGlvbigpe3RoaXMuaW5pdGlhbGl6ZSYmdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLl9pbml0SG9va3MmJnRoaXMuY2FsbEluaXRIb29rcygpfSxpPWZ1bmN0aW9uKCl7fTtpLnByb3RvdHlwZT10aGlzLnByb3RvdHlwZTt2YXIgbj1uZXcgaTtuLmNvbnN0cnVjdG9yPWUsZS5wcm90b3R5cGU9bjtmb3IodmFyIHMgaW4gdGhpcyl0aGlzLmhhc093blByb3BlcnR5KHMpJiYicHJvdG90eXBlIiE9PXMmJihlW3NdPXRoaXNbc10pO3Quc3RhdGljcyYmKG8uZXh0ZW5kKGUsdC5zdGF0aWNzKSxkZWxldGUgdC5zdGF0aWNzKSx0LmluY2x1ZGVzJiYoby5VdGlsLmV4dGVuZC5hcHBseShudWxsLFtuXS5jb25jYXQodC5pbmNsdWRlcykpLGRlbGV0ZSB0LmluY2x1ZGVzKSx0Lm9wdGlvbnMmJm4ub3B0aW9ucyYmKHQub3B0aW9ucz1vLmV4dGVuZCh7fSxuLm9wdGlvbnMsdC5vcHRpb25zKSksby5leHRlbmQobix0KSxuLl9pbml0SG9va3M9W107dmFyIGE9dGhpcztyZXR1cm4gZS5fX3N1cGVyX189YS5wcm90b3R5cGUsbi5jYWxsSW5pdEhvb2tzPWZ1bmN0aW9uKCl7aWYoIXRoaXMuX2luaXRIb29rc0NhbGxlZCl7YS5wcm90b3R5cGUuY2FsbEluaXRIb29rcyYmYS5wcm90b3R5cGUuY2FsbEluaXRIb29rcy5jYWxsKHRoaXMpLHRoaXMuX2luaXRIb29rc0NhbGxlZD0hMDtmb3IodmFyIHQ9MCxlPW4uX2luaXRIb29rcy5sZW5ndGg7ZT50O3QrKyluLl9pbml0SG9va3NbdF0uY2FsbCh0aGlzKX19LGV9LG8uQ2xhc3MuaW5jbHVkZT1mdW5jdGlvbih0KXtvLmV4dGVuZCh0aGlzLnByb3RvdHlwZSx0KX0sby5DbGFzcy5tZXJnZU9wdGlvbnM9ZnVuY3Rpb24odCl7by5leHRlbmQodGhpcy5wcm90b3R5cGUub3B0aW9ucyx0KX0sby5DbGFzcy5hZGRJbml0SG9vaz1mdW5jdGlvbih0KXt2YXIgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSksaT0iZnVuY3Rpb24iPT10eXBlb2YgdD90OmZ1bmN0aW9uKCl7dGhpc1t0XS5hcHBseSh0aGlzLGUpfTt0aGlzLnByb3RvdHlwZS5faW5pdEhvb2tzPXRoaXMucHJvdG90eXBlLl9pbml0SG9va3N8fFtdLHRoaXMucHJvdG90eXBlLl9pbml0SG9va3MucHVzaChpKX07dmFyIHM9Il9sZWFmbGV0X2V2ZW50cyI7by5NaXhpbj17fSxvLk1peGluLkV2ZW50cz17YWRkRXZlbnRMaXN0ZW5lcjpmdW5jdGlvbih0LGUsaSl7aWYoby5VdGlsLmludm9rZUVhY2godCx0aGlzLmFkZEV2ZW50TGlzdGVuZXIsdGhpcyxlLGkpKXJldHVybiB0aGlzO3ZhciBuLGEscixoLGwsdSxjLGQ9dGhpc1tzXT10aGlzW3NdfHx7fSxwPWkmJm8uc3RhbXAoaSk7Zm9yKHQ9by5VdGlsLnNwbGl0V29yZHModCksbj0wLGE9dC5sZW5ndGg7YT5uO24rKylyPXthY3Rpb246ZSxjb250ZXh0Oml8fHRoaXN9LGg9dFtuXSxpPyhsPWgrIl9pZHgiLHU9bCsiX2xlbiIsYz1kW2xdPWRbbF18fHt9LGNbcF18fChjW3BdPVtdLGRbdV09KGRbdV18fDApKzEpLGNbcF0ucHVzaChyKSk6KGRbaF09ZFtoXXx8W10sZFtoXS5wdXNoKHIpKTtyZXR1cm4gdGhpc30saGFzRXZlbnRMaXN0ZW5lcnM6ZnVuY3Rpb24odCl7dmFyIGU9dGhpc1tzXTtyZXR1cm4hIWUmJih0IGluIGUmJmVbdF0ubGVuZ3RoPjB8fHQrIl9pZHgiaW4gZSYmZVt0KyJfaWR4X2xlbiJdPjApfSxyZW1vdmVFdmVudExpc3RlbmVyOmZ1bmN0aW9uKHQsZSxpKXtpZighdGhpc1tzXSlyZXR1cm4gdGhpcztpZighdClyZXR1cm4gdGhpcy5jbGVhckFsbEV2ZW50TGlzdGVuZXJzKCk7aWYoby5VdGlsLmludm9rZUVhY2godCx0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIsdGhpcyxlLGkpKXJldHVybiB0aGlzO3ZhciBuLGEscixoLGwsdSxjLGQscCxtPXRoaXNbc10sXz1pJiZvLnN0YW1wKGkpO2Zvcih0PW8uVXRpbC5zcGxpdFdvcmRzKHQpLG49MCxhPXQubGVuZ3RoO2E+bjtuKyspaWYocj10W25dLHU9cisiX2lkeCIsYz11KyJfbGVuIixkPW1bdV0sZSl7aWYoaD1pJiZkP2RbX106bVtyXSl7Zm9yKGw9aC5sZW5ndGgtMTtsPj0wO2wtLSloW2xdLmFjdGlvbiE9PWV8fGkmJmhbbF0uY29udGV4dCE9PWl8fChwPWguc3BsaWNlKGwsMSkscFswXS5hY3Rpb249by5VdGlsLmZhbHNlRm4pO2kmJmQmJjA9PT1oLmxlbmd0aCYmKGRlbGV0ZSBkW19dLG1bY10tLSl9fWVsc2UgZGVsZXRlIG1bcl0sZGVsZXRlIG1bdV07cmV0dXJuIHRoaXN9LGNsZWFyQWxsRXZlbnRMaXN0ZW5lcnM6ZnVuY3Rpb24oKXtyZXR1cm4gZGVsZXRlIHRoaXNbc10sdGhpc30sZmlyZUV2ZW50OmZ1bmN0aW9uKHQsZSl7aWYoIXRoaXMuaGFzRXZlbnRMaXN0ZW5lcnModCkpcmV0dXJuIHRoaXM7dmFyIGksbixhLHIsaCxsPW8uVXRpbC5leHRlbmQoe30sZSx7dHlwZTp0LHRhcmdldDp0aGlzfSksdT10aGlzW3NdO2lmKHVbdF0pZm9yKGk9dVt0XS5zbGljZSgpLG49MCxhPWkubGVuZ3RoO2E+bjtuKyspaVtuXS5hY3Rpb24uY2FsbChpW25dLmNvbnRleHR8fHRoaXMsbCk7cj11W3QrIl9pZHgiXTtmb3IoaCBpbiByKWlmKGk9cltoXS5zbGljZSgpKWZvcihuPTAsYT1pLmxlbmd0aDthPm47bisrKWlbbl0uYWN0aW9uLmNhbGwoaVtuXS5jb250ZXh0fHx0aGlzLGwpO3JldHVybiB0aGlzfSxhZGRPbmVUaW1lRXZlbnRMaXN0ZW5lcjpmdW5jdGlvbih0LGUsaSl7aWYoby5VdGlsLmludm9rZUVhY2godCx0aGlzLmFkZE9uZVRpbWVFdmVudExpc3RlbmVyLHRoaXMsZSxpKSlyZXR1cm4gdGhpczt2YXIgbj1vLmJpbmQoZnVuY3Rpb24oKXt0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIodCxlLGkpLnJlbW92ZUV2ZW50TGlzdGVuZXIodCxuLGkpfSx0aGlzKTtyZXR1cm4gdGhpcy5hZGRFdmVudExpc3RlbmVyKHQsZSxpKS5hZGRFdmVudExpc3RlbmVyKHQsbixpKX19LG8uTWl4aW4uRXZlbnRzLm9uPW8uTWl4aW4uRXZlbnRzLmFkZEV2ZW50TGlzdGVuZXIsby5NaXhpbi5FdmVudHMub2ZmPW8uTWl4aW4uRXZlbnRzLnJlbW92ZUV2ZW50TGlzdGVuZXIsby5NaXhpbi5FdmVudHMub25jZT1vLk1peGluLkV2ZW50cy5hZGRPbmVUaW1lRXZlbnRMaXN0ZW5lcixvLk1peGluLkV2ZW50cy5maXJlPW8uTWl4aW4uRXZlbnRzLmZpcmVFdmVudCxmdW5jdGlvbigpe3ZhciBuPSEhdC5BY3RpdmVYT2JqZWN0LHM9biYmIXQuWE1MSHR0cFJlcXVlc3QsYT1uJiYhZS5xdWVyeVNlbGVjdG9yLHI9biYmIWUuYWRkRXZlbnRMaXN0ZW5lcixoPW5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSxsPS0xIT09aC5pbmRleE9mKCJ3ZWJraXQiKSx1PS0xIT09aC5pbmRleE9mKCJjaHJvbWUiKSxjPS0xIT09aC5pbmRleE9mKCJwaGFudG9tIiksZD0tMSE9PWguaW5kZXhPZigiYW5kcm9pZCIpLHA9LTEhPT1oLnNlYXJjaCgiYW5kcm9pZCBbMjNdIiksbT10eXBlb2Ygb3JpZW50YXRpb24hPWkrIiIsXz10Lm5hdmlnYXRvciYmdC5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZCYmdC5uYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cyxmPSJkZXZpY2VQaXhlbFJhdGlvImluIHQmJnQuZGV2aWNlUGl4ZWxSYXRpbz4xfHwibWF0Y2hNZWRpYSJpbiB0JiZ0Lm1hdGNoTWVkaWEoIihtaW4tcmVzb2x1dGlvbjoxNDRkcGkpIikmJnQubWF0Y2hNZWRpYSgiKG1pbi1yZXNvbHV0aW9uOjE0NGRwaSkiKS5tYXRjaGVzLGc9ZS5kb2N1bWVudEVsZW1lbnQsdj1uJiYidHJhbnNpdGlvbiJpbiBnLnN0eWxlLHk9IldlYktpdENTU01hdHJpeCJpbiB0JiYibTExImluIG5ldyB0LldlYktpdENTU01hdHJpeCxMPSJNb3pQZXJzcGVjdGl2ZSJpbiBnLnN0eWxlLFA9Ik9UcmFuc2l0aW9uImluIGcuc3R5bGUseD0hdC5MX0RJU0FCTEVfM0QmJih2fHx5fHxMfHxQKSYmIWMsdz0hdC5MX05PX1RPVUNIJiYhYyYmZnVuY3Rpb24oKXt2YXIgdD0ib250b3VjaHN0YXJ0IjtpZihffHx0IGluIGcpcmV0dXJuITA7dmFyIGk9ZS5jcmVhdGVFbGVtZW50KCJkaXYiKSxuPSExO3JldHVybiBpLnNldEF0dHJpYnV0ZT8oaS5zZXRBdHRyaWJ1dGUodCwicmV0dXJuOyIpLCJmdW5jdGlvbiI9PXR5cGVvZiBpW3RdJiYobj0hMCksaS5yZW1vdmVBdHRyaWJ1dGUodCksaT1udWxsLG4pOiExfSgpO28uQnJvd3Nlcj17aWU6bixpZTY6cyxpZTc6YSxpZWx0OTpyLHdlYmtpdDpsLGFuZHJvaWQ6ZCxhbmRyb2lkMjM6cCxjaHJvbWU6dSxpZTNkOnYsd2Via2l0M2Q6eSxnZWNrbzNkOkwsb3BlcmEzZDpQLGFueTNkOngsbW9iaWxlOm0sbW9iaWxlV2Via2l0Om0mJmwsbW9iaWxlV2Via2l0M2Q6bSYmeSxtb2JpbGVPcGVyYTptJiZ0Lm9wZXJhLHRvdWNoOncsbXNUb3VjaDpfLHJldGluYTpmfX0oKSxvLlBvaW50PWZ1bmN0aW9uKHQsZSxpKXt0aGlzLng9aT9NYXRoLnJvdW5kKHQpOnQsdGhpcy55PWk/TWF0aC5yb3VuZChlKTplfSxvLlBvaW50LnByb3RvdHlwZT17Y2xvbmU6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IG8uUG9pbnQodGhpcy54LHRoaXMueSl9LGFkZDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5jbG9uZSgpLl9hZGQoby5wb2ludCh0KSl9LF9hZGQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueCs9dC54LHRoaXMueSs9dC55LHRoaXN9LHN1YnRyYWN0OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmNsb25lKCkuX3N1YnRyYWN0KG8ucG9pbnQodCkpfSxfc3VidHJhY3Q6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueC09dC54LHRoaXMueS09dC55LHRoaXN9LGRpdmlkZUJ5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmNsb25lKCkuX2RpdmlkZUJ5KHQpfSxfZGl2aWRlQnk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueC89dCx0aGlzLnkvPXQsdGhpc30sbXVsdGlwbHlCeTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5jbG9uZSgpLl9tdWx0aXBseUJ5KHQpfSxfbXVsdGlwbHlCeTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy54Kj10LHRoaXMueSo9dCx0aGlzfSxyb3VuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNsb25lKCkuX3JvdW5kKCl9LF9yb3VuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLng9TWF0aC5yb3VuZCh0aGlzLngpLHRoaXMueT1NYXRoLnJvdW5kKHRoaXMueSksdGhpc30sZmxvb3I6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jbG9uZSgpLl9mbG9vcigpfSxfZmxvb3I6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy54PU1hdGguZmxvb3IodGhpcy54KSx0aGlzLnk9TWF0aC5mbG9vcih0aGlzLnkpLHRoaXN9LGRpc3RhbmNlVG86ZnVuY3Rpb24odCl7dD1vLnBvaW50KHQpO3ZhciBlPXQueC10aGlzLngsaT10LnktdGhpcy55O3JldHVybiBNYXRoLnNxcnQoZSplK2kqaSl9LGVxdWFsczpmdW5jdGlvbih0KXtyZXR1cm4gdD1vLnBvaW50KHQpLHQueD09PXRoaXMueCYmdC55PT09dGhpcy55fSxjb250YWluczpmdW5jdGlvbih0KXtyZXR1cm4gdD1vLnBvaW50KHQpLE1hdGguYWJzKHQueCk8PU1hdGguYWJzKHRoaXMueCkmJk1hdGguYWJzKHQueSk8PU1hdGguYWJzKHRoaXMueSl9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIlBvaW50KCIrby5VdGlsLmZvcm1hdE51bSh0aGlzLngpKyIsICIrby5VdGlsLmZvcm1hdE51bSh0aGlzLnkpKyIpIn19LG8ucG9pbnQ9ZnVuY3Rpb24odCxlLG4pe3JldHVybiB0IGluc3RhbmNlb2Ygby5Qb2ludD90Om8uVXRpbC5pc0FycmF5KHQpP25ldyBvLlBvaW50KHRbMF0sdFsxXSk6dD09PWl8fG51bGw9PT10P3Q6bmV3IG8uUG9pbnQodCxlLG4pfSxvLkJvdW5kcz1mdW5jdGlvbih0LGUpe2lmKHQpZm9yKHZhciBpPWU/W3QsZV06dCxuPTAsbz1pLmxlbmd0aDtvPm47bisrKXRoaXMuZXh0ZW5kKGlbbl0pfSxvLkJvdW5kcy5wcm90b3R5cGU9e2V4dGVuZDpmdW5jdGlvbih0KXtyZXR1cm4gdD1vLnBvaW50KHQpLHRoaXMubWlufHx0aGlzLm1heD8odGhpcy5taW4ueD1NYXRoLm1pbih0LngsdGhpcy5taW4ueCksdGhpcy5tYXgueD1NYXRoLm1heCh0LngsdGhpcy5tYXgueCksdGhpcy5taW4ueT1NYXRoLm1pbih0LnksdGhpcy5taW4ueSksdGhpcy5tYXgueT1NYXRoLm1heCh0LnksdGhpcy5tYXgueSkpOih0aGlzLm1pbj10LmNsb25lKCksdGhpcy5tYXg9dC5jbG9uZSgpKSx0aGlzfSxnZXRDZW50ZXI6ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBvLlBvaW50KCh0aGlzLm1pbi54K3RoaXMubWF4LngpLzIsKHRoaXMubWluLnkrdGhpcy5tYXgueSkvMix0KX0sZ2V0Qm90dG9tTGVmdDpmdW5jdGlvbigpe3JldHVybiBuZXcgby5Qb2ludCh0aGlzLm1pbi54LHRoaXMubWF4LnkpfSxnZXRUb3BSaWdodDpmdW5jdGlvbigpe3JldHVybiBuZXcgby5Qb2ludCh0aGlzLm1heC54LHRoaXMubWluLnkpfSxnZXRTaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWF4LnN1YnRyYWN0KHRoaXMubWluKX0sY29udGFpbnM6ZnVuY3Rpb24odCl7dmFyIGUsaTtyZXR1cm4gdD0ibnVtYmVyIj09dHlwZW9mIHRbMF18fHQgaW5zdGFuY2VvZiBvLlBvaW50P28ucG9pbnQodCk6by5ib3VuZHModCksdCBpbnN0YW5jZW9mIG8uQm91bmRzPyhlPXQubWluLGk9dC5tYXgpOmU9aT10LGUueD49dGhpcy5taW4ueCYmaS54PD10aGlzLm1heC54JiZlLnk+PXRoaXMubWluLnkmJmkueTw9dGhpcy5tYXgueX0saW50ZXJzZWN0czpmdW5jdGlvbih0KXt0PW8uYm91bmRzKHQpO3ZhciBlPXRoaXMubWluLGk9dGhpcy5tYXgsbj10Lm1pbixzPXQubWF4LGE9cy54Pj1lLngmJm4ueDw9aS54LHI9cy55Pj1lLnkmJm4ueTw9aS55O3JldHVybiBhJiZyfSxpc1ZhbGlkOmZ1bmN0aW9uKCl7cmV0dXJuISghdGhpcy5taW58fCF0aGlzLm1heCl9fSxvLmJvdW5kcz1mdW5jdGlvbih0LGUpe3JldHVybiF0fHx0IGluc3RhbmNlb2Ygby5Cb3VuZHM/dDpuZXcgby5Cb3VuZHModCxlKX0sby5UcmFuc2Zvcm1hdGlvbj1mdW5jdGlvbih0LGUsaSxuKXt0aGlzLl9hPXQsdGhpcy5fYj1lLHRoaXMuX2M9aSx0aGlzLl9kPW59LG8uVHJhbnNmb3JtYXRpb24ucHJvdG90eXBlPXt0cmFuc2Zvcm06ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5fdHJhbnNmb3JtKHQuY2xvbmUoKSxlKX0sX3RyYW5zZm9ybTpmdW5jdGlvbih0LGUpe3JldHVybiBlPWV8fDEsdC54PWUqKHRoaXMuX2EqdC54K3RoaXMuX2IpLHQueT1lKih0aGlzLl9jKnQueSt0aGlzLl9kKSx0fSx1bnRyYW5zZm9ybTpmdW5jdGlvbih0LGUpe3JldHVybiBlPWV8fDEsbmV3IG8uUG9pbnQoKHQueC9lLXRoaXMuX2IpL3RoaXMuX2EsKHQueS9lLXRoaXMuX2QpL3RoaXMuX2MpfX0sby5Eb21VdGlsPXtnZXQ6ZnVuY3Rpb24odCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P2UuZ2V0RWxlbWVudEJ5SWQodCk6dH0sZ2V0U3R5bGU6ZnVuY3Rpb24odCxpKXt2YXIgbj10LnN0eWxlW2ldO2lmKCFuJiZ0LmN1cnJlbnRTdHlsZSYmKG49dC5jdXJyZW50U3R5bGVbaV0pLCghbnx8ImF1dG8iPT09bikmJmUuZGVmYXVsdFZpZXcpe3ZhciBvPWUuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSh0LG51bGwpO249bz9vW2ldOm51bGx9cmV0dXJuImF1dG8iPT09bj9udWxsOm59LGdldFZpZXdwb3J0T2Zmc2V0OmZ1bmN0aW9uKHQpe3ZhciBpLG49MCxzPTAsYT10LHI9ZS5ib2R5LGg9ZS5kb2N1bWVudEVsZW1lbnQsbD1vLkJyb3dzZXIuaWU3O2Rve2lmKG4rPWEub2Zmc2V0VG9wfHwwLHMrPWEub2Zmc2V0TGVmdHx8MCxuKz1wYXJzZUludChvLkRvbVV0aWwuZ2V0U3R5bGUoYSwiYm9yZGVyVG9wV2lkdGgiKSwxMCl8fDAscys9cGFyc2VJbnQoby5Eb21VdGlsLmdldFN0eWxlKGEsImJvcmRlckxlZnRXaWR0aCIpLDEwKXx8MCxpPW8uRG9tVXRpbC5nZXRTdHlsZShhLCJwb3NpdGlvbiIpLGEub2Zmc2V0UGFyZW50PT09ciYmImFic29sdXRlIj09PWkpYnJlYWs7aWYoImZpeGVkIj09PWkpe24rPXIuc2Nyb2xsVG9wfHxoLnNjcm9sbFRvcHx8MCxzKz1yLnNjcm9sbExlZnR8fGguc2Nyb2xsTGVmdHx8MDticmVha31pZigicmVsYXRpdmUiPT09aSYmIWEub2Zmc2V0TGVmdCl7dmFyIHU9by5Eb21VdGlsLmdldFN0eWxlKGEsIndpZHRoIiksYz1vLkRvbVV0aWwuZ2V0U3R5bGUoYSwibWF4LXdpZHRoIiksZD1hLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOygibm9uZSIhPT11fHwibm9uZSIhPT1jKSYmKHMrPWQubGVmdCthLmNsaWVudExlZnQpLG4rPWQudG9wKyhyLnNjcm9sbFRvcHx8aC5zY3JvbGxUb3B8fDApO2JyZWFrfWE9YS5vZmZzZXRQYXJlbnR9d2hpbGUoYSk7YT10O2Rve2lmKGE9PT1yKWJyZWFrO24tPWEuc2Nyb2xsVG9wfHwwLHMtPWEuc2Nyb2xsTGVmdHx8MCxvLkRvbVV0aWwuZG9jdW1lbnRJc0x0cigpfHwhby5Ccm93c2VyLndlYmtpdCYmIWx8fChzKz1hLnNjcm9sbFdpZHRoLWEuY2xpZW50V2lkdGgsbCYmImhpZGRlbiIhPT1vLkRvbVV0aWwuZ2V0U3R5bGUoYSwib3ZlcmZsb3cteSIpJiYiaGlkZGVuIiE9PW8uRG9tVXRpbC5nZXRTdHlsZShhLCJvdmVyZmxvdyIpJiYocys9MTcpKSxhPWEucGFyZW50Tm9kZX13aGlsZShhKTtyZXR1cm4gbmV3IG8uUG9pbnQocyxuKX0sZG9jdW1lbnRJc0x0cjpmdW5jdGlvbigpe3JldHVybiBvLkRvbVV0aWwuX2RvY0lzTHRyQ2FjaGVkfHwoby5Eb21VdGlsLl9kb2NJc0x0ckNhY2hlZD0hMCxvLkRvbVV0aWwuX2RvY0lzTHRyPSJsdHIiPT09by5Eb21VdGlsLmdldFN0eWxlKGUuYm9keSwiZGlyZWN0aW9uIikpLG8uRG9tVXRpbC5fZG9jSXNMdHJ9LGNyZWF0ZTpmdW5jdGlvbih0LGksbil7dmFyIG89ZS5jcmVhdGVFbGVtZW50KHQpO3JldHVybiBvLmNsYXNzTmFtZT1pLG4mJm4uYXBwZW5kQ2hpbGQobyksb30saGFzQ2xhc3M6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdC5jbGFzc05hbWUubGVuZ3RoPjAmJm5ldyBSZWdFeHAoIihefFxccykiK2UrIihcXHN8JCkiKS50ZXN0KHQuY2xhc3NOYW1lKX0sYWRkQ2xhc3M6ZnVuY3Rpb24odCxlKXtvLkRvbVV0aWwuaGFzQ2xhc3ModCxlKXx8KHQuY2xhc3NOYW1lKz0odC5jbGFzc05hbWU/IiAiOiIiKStlKX0scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24odCxlKXt0LmNsYXNzTmFtZT1vLlV0aWwudHJpbSgoIiAiK3QuY2xhc3NOYW1lKyIgIikucmVwbGFjZSgiICIrZSsiICIsIiAiKSl9LHNldE9wYWNpdHk6ZnVuY3Rpb24odCxlKXtpZigib3BhY2l0eSJpbiB0LnN0eWxlKXQuc3R5bGUub3BhY2l0eT1lO2Vsc2UgaWYoImZpbHRlciJpbiB0LnN0eWxlKXt2YXIgaT0hMSxuPSJEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5BbHBoYSI7dHJ5e2k9dC5maWx0ZXJzLml0ZW0obil9Y2F0Y2gobyl7aWYoMT09PWUpcmV0dXJufWU9TWF0aC5yb3VuZCgxMDAqZSksaT8oaS5FbmFibGVkPTEwMCE9PWUsaS5PcGFjaXR5PWUpOnQuc3R5bGUuZmlsdGVyKz0iIHByb2dpZDoiK24rIihvcGFjaXR5PSIrZSsiKSJ9fSx0ZXN0UHJvcDpmdW5jdGlvbih0KXtmb3IodmFyIGk9ZS5kb2N1bWVudEVsZW1lbnQuc3R5bGUsbj0wO248dC5sZW5ndGg7bisrKWlmKHRbbl1pbiBpKXJldHVybiB0W25dO3JldHVybiExfSxnZXRUcmFuc2xhdGVTdHJpbmc6ZnVuY3Rpb24odCl7dmFyIGU9by5Ccm93c2VyLndlYmtpdDNkLGk9InRyYW5zbGF0ZSIrKGU/IjNkIjoiIikrIigiLG49KGU/IiwwIjoiIikrIikiO3JldHVybiBpK3QueCsicHgsIit0LnkrInB4IitufSxnZXRTY2FsZVN0cmluZzpmdW5jdGlvbih0LGUpe3ZhciBpPW8uRG9tVXRpbC5nZXRUcmFuc2xhdGVTdHJpbmcoZS5hZGQoZS5tdWx0aXBseUJ5KC0xKnQpKSksbj0iIHNjYWxlKCIrdCsiKSAiO3JldHVybiBpK259LHNldFBvc2l0aW9uOmZ1bmN0aW9uKHQsZSxpKXt0Ll9sZWFmbGV0X3Bvcz1lLCFpJiZvLkJyb3dzZXIuYW55M2Q/KHQuc3R5bGVbby5Eb21VdGlsLlRSQU5TRk9STV09by5Eb21VdGlsLmdldFRyYW5zbGF0ZVN0cmluZyhlKSxvLkJyb3dzZXIubW9iaWxlV2Via2l0M2QmJih0LnN0eWxlLldlYmtpdEJhY2tmYWNlVmlzaWJpbGl0eT0iaGlkZGVuIikpOih0LnN0eWxlLmxlZnQ9ZS54KyJweCIsdC5zdHlsZS50b3A9ZS55KyJweCIpfSxnZXRQb3NpdGlvbjpmdW5jdGlvbih0KXtyZXR1cm4gdC5fbGVhZmxldF9wb3N9fSxvLkRvbVV0aWwuVFJBTlNGT1JNPW8uRG9tVXRpbC50ZXN0UHJvcChbInRyYW5zZm9ybSIsIldlYmtpdFRyYW5zZm9ybSIsIk9UcmFuc2Zvcm0iLCJNb3pUcmFuc2Zvcm0iLCJtc1RyYW5zZm9ybSJdKSxvLkRvbVV0aWwuVFJBTlNJVElPTj1vLkRvbVV0aWwudGVzdFByb3AoWyJ3ZWJraXRUcmFuc2l0aW9uIiwidHJhbnNpdGlvbiIsIk9UcmFuc2l0aW9uIiwiTW96VHJhbnNpdGlvbiIsIm1zVHJhbnNpdGlvbiJdKSxvLkRvbVV0aWwuVFJBTlNJVElPTl9FTkQ9IndlYmtpdFRyYW5zaXRpb24iPT09by5Eb21VdGlsLlRSQU5TSVRJT058fCJPVHJhbnNpdGlvbiI9PT1vLkRvbVV0aWwuVFJBTlNJVElPTj9vLkRvbVV0aWwuVFJBTlNJVElPTisiRW5kIjoidHJhbnNpdGlvbmVuZCIsZnVuY3Rpb24oKXt2YXIgaT1vLkRvbVV0aWwudGVzdFByb3AoWyJ1c2VyU2VsZWN0IiwiV2Via2l0VXNlclNlbGVjdCIsIk9Vc2VyU2VsZWN0IiwiTW96VXNlclNlbGVjdCIsIm1zVXNlclNlbGVjdCJdKTtvLmV4dGVuZChvLkRvbVV0aWwse2Rpc2FibGVUZXh0U2VsZWN0aW9uOmZ1bmN0aW9uKCl7aWYoby5Eb21FdmVudC5vbih0LCJzZWxlY3RzdGFydCIsby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCksaSl7dmFyIG49ZS5kb2N1bWVudEVsZW1lbnQuc3R5bGU7dGhpcy5fdXNlclNlbGVjdD1uW2ldLG5baV09Im5vbmUifX0sZW5hYmxlVGV4dFNlbGVjdGlvbjpmdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKHQsInNlbGVjdHN0YXJ0IixvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KSxpJiYoZS5kb2N1bWVudEVsZW1lbnQuc3R5bGVbaV09dGhpcy5fdXNlclNlbGVjdCxkZWxldGUgdGhpcy5fdXNlclNlbGVjdCl9LGRpc2FibGVJbWFnZURyYWc6ZnVuY3Rpb24oKXtvLkRvbUV2ZW50Lm9uKHQsImRyYWdzdGFydCIsby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCl9LGVuYWJsZUltYWdlRHJhZzpmdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKHQsImRyYWdzdGFydCIsby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCl9fSl9KCksby5MYXRMbmc9ZnVuY3Rpb24odCxlKXt2YXIgaT1wYXJzZUZsb2F0KHQpLG49cGFyc2VGbG9hdChlKTtpZihpc05hTihpKXx8aXNOYU4obikpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIExhdExuZyBvYmplY3Q6ICgiK3QrIiwgIitlKyIpIik7dGhpcy5sYXQ9aSx0aGlzLmxuZz1ufSxvLmV4dGVuZChvLkxhdExuZyx7REVHX1RPX1JBRDpNYXRoLlBJLzE4MCxSQURfVE9fREVHOjE4MC9NYXRoLlBJLE1BWF9NQVJHSU46MWUtOX0pLG8uTGF0TG5nLnByb3RvdHlwZT17ZXF1YWxzOmZ1bmN0aW9uKHQpe2lmKCF0KXJldHVybiExO3Q9by5sYXRMbmcodCk7dmFyIGU9TWF0aC5tYXgoTWF0aC5hYnModGhpcy5sYXQtdC5sYXQpLE1hdGguYWJzKHRoaXMubG5nLXQubG5nKSk7cmV0dXJuIGU8PW8uTGF0TG5nLk1BWF9NQVJHSU59LHRvU3RyaW5nOmZ1bmN0aW9uKHQpe3JldHVybiJMYXRMbmcoIitvLlV0aWwuZm9ybWF0TnVtKHRoaXMubGF0LHQpKyIsICIrby5VdGlsLmZvcm1hdE51bSh0aGlzLmxuZyx0KSsiKSJ9LGRpc3RhbmNlVG86ZnVuY3Rpb24odCl7dD1vLmxhdExuZyh0KTt2YXIgZT02Mzc4MTM3LGk9by5MYXRMbmcuREVHX1RPX1JBRCxuPSh0LmxhdC10aGlzLmxhdCkqaSxzPSh0LmxuZy10aGlzLmxuZykqaSxhPXRoaXMubGF0Kmkscj10LmxhdCppLGg9TWF0aC5zaW4obi8yKSxsPU1hdGguc2luKHMvMiksdT1oKmgrbCpsKk1hdGguY29zKGEpKk1hdGguY29zKHIpO3JldHVybiAyKmUqTWF0aC5hdGFuMihNYXRoLnNxcnQodSksTWF0aC5zcXJ0KDEtdSkpfSx3cmFwOmZ1bmN0aW9uKHQsZSl7dmFyIGk9dGhpcy5sbmc7cmV0dXJuIHQ9dHx8LTE4MCxlPWV8fDE4MCxpPShpK2UpJShlLXQpKyh0Pml8fGk9PT1lP2U6dCksbmV3IG8uTGF0TG5nKHRoaXMubGF0LGkpfX0sby5sYXRMbmc9ZnVuY3Rpb24odCxlKXtyZXR1cm4gdCBpbnN0YW5jZW9mIG8uTGF0TG5nP3Q6by5VdGlsLmlzQXJyYXkodCk/Im51bWJlciI9PXR5cGVvZiB0WzBdfHwic3RyaW5nIj09dHlwZW9mIHRbMF0/bmV3IG8uTGF0TG5nKHRbMF0sdFsxXSk6bnVsbDp0PT09aXx8bnVsbD09PXQ/dDoib2JqZWN0Ij09dHlwZW9mIHQmJiJsYXQiaW4gdD9uZXcgby5MYXRMbmcodC5sYXQsImxuZyJpbiB0P3QubG5nOnQubG9uKTplPT09aT9udWxsOm5ldyBvLkxhdExuZyh0LGUpfSxvLkxhdExuZ0JvdW5kcz1mdW5jdGlvbih0LGUpe2lmKHQpZm9yKHZhciBpPWU/W3QsZV06dCxuPTAsbz1pLmxlbmd0aDtvPm47bisrKXRoaXMuZXh0ZW5kKGlbbl0pfSxvLkxhdExuZ0JvdW5kcy5wcm90b3R5cGU9e2V4dGVuZDpmdW5jdGlvbih0KXtpZighdClyZXR1cm4gdGhpczt2YXIgZT1vLmxhdExuZyh0KTtyZXR1cm4gdD1udWxsIT09ZT9lOm8ubGF0TG5nQm91bmRzKHQpLHQgaW5zdGFuY2VvZiBvLkxhdExuZz90aGlzLl9zb3V0aFdlc3R8fHRoaXMuX25vcnRoRWFzdD8odGhpcy5fc291dGhXZXN0LmxhdD1NYXRoLm1pbih0LmxhdCx0aGlzLl9zb3V0aFdlc3QubGF0KSx0aGlzLl9zb3V0aFdlc3QubG5nPU1hdGgubWluKHQubG5nLHRoaXMuX3NvdXRoV2VzdC5sbmcpLHRoaXMuX25vcnRoRWFzdC5sYXQ9TWF0aC5tYXgodC5sYXQsdGhpcy5fbm9ydGhFYXN0LmxhdCksdGhpcy5fbm9ydGhFYXN0LmxuZz1NYXRoLm1heCh0LmxuZyx0aGlzLl9ub3J0aEVhc3QubG5nKSk6KHRoaXMuX3NvdXRoV2VzdD1uZXcgby5MYXRMbmcodC5sYXQsdC5sbmcpLHRoaXMuX25vcnRoRWFzdD1uZXcgby5MYXRMbmcodC5sYXQsdC5sbmcpKTp0IGluc3RhbmNlb2Ygby5MYXRMbmdCb3VuZHMmJih0aGlzLmV4dGVuZCh0Ll9zb3V0aFdlc3QpLHRoaXMuZXh0ZW5kKHQuX25vcnRoRWFzdCkpLHRoaXN9LHBhZDpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9zb3V0aFdlc3QsaT10aGlzLl9ub3J0aEVhc3Qsbj1NYXRoLmFicyhlLmxhdC1pLmxhdCkqdCxzPU1hdGguYWJzKGUubG5nLWkubG5nKSp0O3JldHVybiBuZXcgby5MYXRMbmdCb3VuZHMobmV3IG8uTGF0TG5nKGUubGF0LW4sZS5sbmctcyksbmV3IG8uTGF0TG5nKGkubGF0K24saS5sbmcrcykpfSxnZXRDZW50ZXI6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IG8uTGF0TG5nKCh0aGlzLl9zb3V0aFdlc3QubGF0K3RoaXMuX25vcnRoRWFzdC5sYXQpLzIsKHRoaXMuX3NvdXRoV2VzdC5sbmcrdGhpcy5fbm9ydGhFYXN0LmxuZykvMil9LGdldFNvdXRoV2VzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zb3V0aFdlc3R9LGdldE5vcnRoRWFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9ub3J0aEVhc3R9LGdldE5vcnRoV2VzdDpmdW5jdGlvbigpe3JldHVybiBuZXcgby5MYXRMbmcodGhpcy5nZXROb3J0aCgpLHRoaXMuZ2V0V2VzdCgpKX0sZ2V0U291dGhFYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBvLkxhdExuZyh0aGlzLmdldFNvdXRoKCksdGhpcy5nZXRFYXN0KCkpfSxnZXRXZXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NvdXRoV2VzdC5sbmd9LGdldFNvdXRoOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NvdXRoV2VzdC5sYXR9LGdldEVhc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbm9ydGhFYXN0LmxuZ30sZ2V0Tm9ydGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbm9ydGhFYXN0LmxhdH0sY29udGFpbnM6ZnVuY3Rpb24odCl7dD0ibnVtYmVyIj09dHlwZW9mIHRbMF18fHQgaW5zdGFuY2VvZiBvLkxhdExuZz9vLmxhdExuZyh0KTpvLmxhdExuZ0JvdW5kcyh0KTt2YXIgZSxpLG49dGhpcy5fc291dGhXZXN0LHM9dGhpcy5fbm9ydGhFYXN0O3JldHVybiB0IGluc3RhbmNlb2Ygby5MYXRMbmdCb3VuZHM/KGU9dC5nZXRTb3V0aFdlc3QoKSxpPXQuZ2V0Tm9ydGhFYXN0KCkpOmU9aT10LGUubGF0Pj1uLmxhdCYmaS5sYXQ8PXMubGF0JiZlLmxuZz49bi5sbmcmJmkubG5nPD1zLmxuZ30saW50ZXJzZWN0czpmdW5jdGlvbih0KXt0PW8ubGF0TG5nQm91bmRzKHQpO3ZhciBlPXRoaXMuX3NvdXRoV2VzdCxpPXRoaXMuX25vcnRoRWFzdCxuPXQuZ2V0U291dGhXZXN0KCkscz10LmdldE5vcnRoRWFzdCgpLGE9cy5sYXQ+PWUubGF0JiZuLmxhdDw9aS5sYXQscj1zLmxuZz49ZS5sbmcmJm4ubG5nPD1pLmxuZztyZXR1cm4gYSYmcn0sdG9CQm94U3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuW3RoaXMuZ2V0V2VzdCgpLHRoaXMuZ2V0U291dGgoKSx0aGlzLmdldEVhc3QoKSx0aGlzLmdldE5vcnRoKCldLmpvaW4oIiwiKX0sZXF1YWxzOmZ1bmN0aW9uKHQpe3JldHVybiB0Pyh0PW8ubGF0TG5nQm91bmRzKHQpLHRoaXMuX3NvdXRoV2VzdC5lcXVhbHModC5nZXRTb3V0aFdlc3QoKSkmJnRoaXMuX25vcnRoRWFzdC5lcXVhbHModC5nZXROb3J0aEVhc3QoKSkpOiExfSxpc1ZhbGlkOmZ1bmN0aW9uKCl7cmV0dXJuISghdGhpcy5fc291dGhXZXN0fHwhdGhpcy5fbm9ydGhFYXN0KX19LG8ubGF0TG5nQm91bmRzPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIXR8fHQgaW5zdGFuY2VvZiBvLkxhdExuZ0JvdW5kcz90Om5ldyBvLkxhdExuZ0JvdW5kcyh0LGUpfSxvLlByb2plY3Rpb249e30sby5Qcm9qZWN0aW9uLlNwaGVyaWNhbE1lcmNhdG9yPXtNQVhfTEFUSVRVREU6ODUuMDUxMTI4Nzc5OCxwcm9qZWN0OmZ1bmN0aW9uKHQpe3ZhciBlPW8uTGF0TG5nLkRFR19UT19SQUQsaT10aGlzLk1BWF9MQVRJVFVERSxuPU1hdGgubWF4KE1hdGgubWluKGksdC5sYXQpLC1pKSxzPXQubG5nKmUsYT1uKmU7cmV0dXJuIGE9TWF0aC5sb2coTWF0aC50YW4oTWF0aC5QSS80K2EvMikpLG5ldyBvLlBvaW50KHMsYSl9LHVucHJvamVjdDpmdW5jdGlvbih0KXt2YXIgZT1vLkxhdExuZy5SQURfVE9fREVHLGk9dC54KmUsbj0oMipNYXRoLmF0YW4oTWF0aC5leHAodC55KSktTWF0aC5QSS8yKSplO3JldHVybiBuZXcgby5MYXRMbmcobixpKX19LG8uUHJvamVjdGlvbi5Mb25MYXQ9e3Byb2plY3Q6ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBvLlBvaW50KHQubG5nLHQubGF0KX0sdW5wcm9qZWN0OmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5MYXRMbmcodC55LHQueCl9fSxvLkNSUz17bGF0TG5nVG9Qb2ludDpmdW5jdGlvbih0LGUpe3ZhciBpPXRoaXMucHJvamVjdGlvbi5wcm9qZWN0KHQpLG49dGhpcy5zY2FsZShlKTtyZXR1cm4gdGhpcy50cmFuc2Zvcm1hdGlvbi5fdHJhbnNmb3JtKGksbil9LHBvaW50VG9MYXRMbmc6ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLnNjYWxlKGUpLG49dGhpcy50cmFuc2Zvcm1hdGlvbi51bnRyYW5zZm9ybSh0LGkpO3JldHVybiB0aGlzLnByb2plY3Rpb24udW5wcm9qZWN0KG4pfSxwcm9qZWN0OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLnByb2plY3Rpb24ucHJvamVjdCh0KX0sc2NhbGU6ZnVuY3Rpb24odCl7cmV0dXJuIDI1NipNYXRoLnBvdygyLHQpfX0sby5DUlMuU2ltcGxlPW8uZXh0ZW5kKHt9LG8uQ1JTLHtwcm9qZWN0aW9uOm8uUHJvamVjdGlvbi5Mb25MYXQsdHJhbnNmb3JtYXRpb246bmV3IG8uVHJhbnNmb3JtYXRpb24oMSwwLC0xLDApLHNjYWxlOmZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdygyLHQpfX0pLG8uQ1JTLkVQU0czODU3PW8uZXh0ZW5kKHt9LG8uQ1JTLHtjb2RlOiJFUFNHOjM4NTciLHByb2plY3Rpb246by5Qcm9qZWN0aW9uLlNwaGVyaWNhbE1lcmNhdG9yLHRyYW5zZm9ybWF0aW9uOm5ldyBvLlRyYW5zZm9ybWF0aW9uKC41L01hdGguUEksLjUsLS41L01hdGguUEksLjUpLHByb2plY3Q6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5wcm9qZWN0aW9uLnByb2plY3QodCksaT02Mzc4MTM3O3JldHVybiBlLm11bHRpcGx5QnkoaSl9fSksby5DUlMuRVBTRzkwMDkxMz1vLmV4dGVuZCh7fSxvLkNSUy5FUFNHMzg1Nyx7Y29kZToiRVBTRzo5MDA5MTMifSksby5DUlMuRVBTRzQzMjY9by5leHRlbmQoe30sby5DUlMse2NvZGU6IkVQU0c6NDMyNiIscHJvamVjdGlvbjpvLlByb2plY3Rpb24uTG9uTGF0LHRyYW5zZm9ybWF0aW9uOm5ldyBvLlRyYW5zZm9ybWF0aW9uKDEvMzYwLC41LC0xLzM2MCwuNSl9KSxvLk1hcD1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsb3B0aW9uczp7Y3JzOm8uQ1JTLkVQU0czODU3LGZhZGVBbmltYXRpb246by5Eb21VdGlsLlRSQU5TSVRJT04mJiFvLkJyb3dzZXIuYW5kcm9pZDIzLHRyYWNrUmVzaXplOiEwLG1hcmtlclpvb21BbmltYXRpb246by5Eb21VdGlsLlRSQU5TSVRJT04mJm8uQnJvd3Nlci5hbnkzZH0saW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUpe2U9by5zZXRPcHRpb25zKHRoaXMsZSksdGhpcy5faW5pdENvbnRhaW5lcih0KSx0aGlzLl9pbml0TGF5b3V0KCksdGhpcy5fb25SZXNpemU9by5iaW5kKHRoaXMuX29uUmVzaXplLHRoaXMpLHRoaXMuX2luaXRFdmVudHMoKSxlLm1heEJvdW5kcyYmdGhpcy5zZXRNYXhCb3VuZHMoZS5tYXhCb3VuZHMpLGUuY2VudGVyJiZlLnpvb20hPT1pJiZ0aGlzLnNldFZpZXcoby5sYXRMbmcoZS5jZW50ZXIpLGUuem9vbSx7cmVzZXQ6ITB9KSx0aGlzLl9oYW5kbGVycz1bXSx0aGlzLl9sYXllcnM9e30sdGhpcy5fem9vbUJvdW5kTGF5ZXJzPXt9LHRoaXMuX3RpbGVMYXllcnNOdW09MCx0aGlzLmNhbGxJbml0SG9va3MoKSx0aGlzLl9hZGRMYXllcnMoZS5sYXllcnMpfSxzZXRWaWV3OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIGU9ZT09PWk/dGhpcy5nZXRab29tKCk6ZSx0aGlzLl9yZXNldFZpZXcoby5sYXRMbmcodCksdGhpcy5fbGltaXRab29tKGUpKSx0aGlzfSxzZXRab29tOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX2xvYWRlZD90aGlzLnNldFZpZXcodGhpcy5nZXRDZW50ZXIoKSx0LHt6b29tOmV9KToodGhpcy5fem9vbT10aGlzLl9saW1pdFpvb20odCksdGhpcyl9LHpvb21JbjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnNldFpvb20odGhpcy5fem9vbSsodHx8MSksZSl9LHpvb21PdXQ6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5zZXRab29tKHRoaXMuX3pvb20tKHR8fDEpLGUpfSxzZXRab29tQXJvdW5kOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbj10aGlzLmdldFpvb21TY2FsZShlKSxzPXRoaXMuZ2V0U2l6ZSgpLmRpdmlkZUJ5KDIpLGE9dCBpbnN0YW5jZW9mIG8uUG9pbnQ/dDp0aGlzLmxhdExuZ1RvQ29udGFpbmVyUG9pbnQodCkscj1hLnN1YnRyYWN0KHMpLm11bHRpcGx5QnkoMS0xL24pLGg9dGhpcy5jb250YWluZXJQb2ludFRvTGF0TG5nKHMuYWRkKHIpKTtyZXR1cm4gdGhpcy5zZXRWaWV3KGgsZSx7em9vbTppfSl9LGZpdEJvdW5kczpmdW5jdGlvbih0LGUpe2U9ZXx8e30sdD10LmdldEJvdW5kcz90LmdldEJvdW5kcygpOm8ubGF0TG5nQm91bmRzKHQpO3ZhciBpPW8ucG9pbnQoZS5wYWRkaW5nVG9wTGVmdHx8ZS5wYWRkaW5nfHxbMCwwXSksbj1vLnBvaW50KGUucGFkZGluZ0JvdHRvbVJpZ2h0fHxlLnBhZGRpbmd8fFswLDBdKSxzPXRoaXMuZ2V0Qm91bmRzWm9vbSh0LCExLGkuYWRkKG4pKSxhPW4uc3VidHJhY3QoaSkuZGl2aWRlQnkoMikscj10aGlzLnByb2plY3QodC5nZXRTb3V0aFdlc3QoKSxzKSxoPXRoaXMucHJvamVjdCh0LmdldE5vcnRoRWFzdCgpLHMpLGw9dGhpcy51bnByb2plY3Qoci5hZGQoaCkuZGl2aWRlQnkoMikuYWRkKGEpLHMpO3JldHVybiB0aGlzLnNldFZpZXcobCxzLGUpfSxmaXRXb3JsZDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5maXRCb3VuZHMoW1stOTAsLTE4MF0sWzkwLDE4MF1dLHQpfSxwYW5UbzpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnNldFZpZXcodCx0aGlzLl96b29tLHtwYW46ZX0pfSxwYW5CeTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5maXJlKCJtb3Zlc3RhcnQiKSx0aGlzLl9yYXdQYW5CeShvLnBvaW50KHQpKSx0aGlzLmZpcmUoIm1vdmUiKSx0aGlzLmZpcmUoIm1vdmVlbmQiKX0sc2V0TWF4Qm91bmRzOmZ1bmN0aW9uKHQsZSl7aWYodD1vLmxhdExuZ0JvdW5kcyh0KSx0aGlzLm9wdGlvbnMubWF4Qm91bmRzPXQsIXQpcmV0dXJuIHRoaXMuX2JvdW5kc01pblpvb209bnVsbCx0aGlzLm9mZigibW92ZWVuZCIsdGhpcy5fcGFuSW5zaWRlTWF4Qm91bmRzLHRoaXMpLHRoaXM7dmFyIGk9dGhpcy5nZXRCb3VuZHNab29tKHQsITApO3JldHVybiB0aGlzLl9ib3VuZHNNaW5ab29tPWksdGhpcy5fbG9hZGVkJiYodGhpcy5fem9vbTxpP3RoaXMuc2V0Vmlldyh0LmdldENlbnRlcigpLGksZSk6dGhpcy5wYW5JbnNpZGVCb3VuZHModCkpLHRoaXMub24oIm1vdmVlbmQiLHRoaXMuX3Bhbkluc2lkZU1heEJvdW5kcyx0aGlzKSx0aGlzfSxwYW5JbnNpZGVCb3VuZHM6ZnVuY3Rpb24odCl7dD1vLmxhdExuZ0JvdW5kcyh0KTt2YXIgZT10aGlzLmdldFBpeGVsQm91bmRzKCksaT1lLmdldEJvdHRvbUxlZnQoKSxuPWUuZ2V0VG9wUmlnaHQoKSxzPXRoaXMucHJvamVjdCh0LmdldFNvdXRoV2VzdCgpKSxhPXRoaXMucHJvamVjdCh0LmdldE5vcnRoRWFzdCgpKSxyPTAsaD0wO3JldHVybiBuLnk8YS55JiYoaD1NYXRoLmNlaWwoYS55LW4ueSkpLG4ueD5hLngmJihyPU1hdGguZmxvb3IoYS54LW4ueCkpLGkueT5zLnkmJihoPU1hdGguZmxvb3Iocy55LWkueSkpLGkueDxzLngmJihyPU1hdGguY2VpbChzLngtaS54KSkscnx8aD90aGlzLnBhbkJ5KFtyLGhdKTp0aGlzfSxhZGRMYXllcjpmdW5jdGlvbih0KXt2YXIgZT1vLnN0YW1wKHQpO3JldHVybiB0aGlzLl9sYXllcnNbZV0/dGhpczoodGhpcy5fbGF5ZXJzW2VdPXQsIXQub3B0aW9uc3x8aXNOYU4odC5vcHRpb25zLm1heFpvb20pJiZpc05hTih0Lm9wdGlvbnMubWluWm9vbSl8fCh0aGlzLl96b29tQm91bmRMYXllcnNbZV09dCx0aGlzLl91cGRhdGVab29tTGV2ZWxzKCkpLHRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uJiZvLlRpbGVMYXllciYmdCBpbnN0YW5jZW9mIG8uVGlsZUxheWVyJiYodGhpcy5fdGlsZUxheWVyc051bSsrLHRoaXMuX3RpbGVMYXllcnNUb0xvYWQrKyx0Lm9uKCJsb2FkIix0aGlzLl9vblRpbGVMYXllckxvYWQsdGhpcykpLHRoaXMuX2xvYWRlZCYmdGhpcy5fbGF5ZXJBZGQodCksdGhpcyl9LHJlbW92ZUxheWVyOmZ1bmN0aW9uKHQpe3ZhciBlPW8uc3RhbXAodCk7cmV0dXJuIHRoaXMuX2xheWVyc1tlXT8odGhpcy5fbG9hZGVkJiZ0Lm9uUmVtb3ZlKHRoaXMpLGRlbGV0ZSB0aGlzLl9sYXllcnNbZV0sdGhpcy5fbG9hZGVkJiZ0aGlzLmZpcmUoImxheWVycmVtb3ZlIix7bGF5ZXI6dH0pLHRoaXMuX3pvb21Cb3VuZExheWVyc1tlXSYmKGRlbGV0ZSB0aGlzLl96b29tQm91bmRMYXllcnNbZV0sdGhpcy5fdXBkYXRlWm9vbUxldmVscygpKSx0aGlzLm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5UaWxlTGF5ZXImJnQgaW5zdGFuY2VvZiBvLlRpbGVMYXllciYmKHRoaXMuX3RpbGVMYXllcnNOdW0tLSx0aGlzLl90aWxlTGF5ZXJzVG9Mb2FkLS0sdC5vZmYoImxvYWQiLHRoaXMuX29uVGlsZUxheWVyTG9hZCx0aGlzKSksdGhpcyk6dGhpc30saGFzTGF5ZXI6ZnVuY3Rpb24odCl7cmV0dXJuIHQ/by5zdGFtcCh0KWluIHRoaXMuX2xheWVyczohMX0sZWFjaExheWVyOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBpIGluIHRoaXMuX2xheWVycyl0LmNhbGwoZSx0aGlzLl9sYXllcnNbaV0pO3JldHVybiB0aGlzfSxpbnZhbGlkYXRlU2l6ZTpmdW5jdGlvbih0KXt0PW8uZXh0ZW5kKHthbmltYXRlOiExLHBhbjohMH0sdD09PSEwP3thbmltYXRlOiEwfTp0KTt2YXIgZT10aGlzLmdldFNpemUoKTtpZih0aGlzLl9zaXplQ2hhbmdlZD0hMCx0aGlzLl9pbml0aWFsQ2VudGVyPW51bGwsdGhpcy5vcHRpb25zLm1heEJvdW5kcyYmdGhpcy5zZXRNYXhCb3VuZHModGhpcy5vcHRpb25zLm1heEJvdW5kcyksIXRoaXMuX2xvYWRlZClyZXR1cm4gdGhpczt2YXIgaT10aGlzLmdldFNpemUoKSxuPWUuZGl2aWRlQnkoMikucm91bmQoKSxzPWkuZGl2aWRlQnkoMikucm91bmQoKSxhPW4uc3VidHJhY3Qocyk7cmV0dXJuIGEueHx8YS55Pyh0LmFuaW1hdGUmJnQucGFuP3RoaXMucGFuQnkoYSk6KHQucGFuJiZ0aGlzLl9yYXdQYW5CeShhKSx0aGlzLmZpcmUoIm1vdmUiKSxjbGVhclRpbWVvdXQodGhpcy5fc2l6ZVRpbWVyKSx0aGlzLl9zaXplVGltZXI9c2V0VGltZW91dChvLmJpbmQodGhpcy5maXJlLHRoaXMsIm1vdmVlbmQiKSwyMDApKSx0aGlzLmZpcmUoInJlc2l6ZSIse29sZFNpemU6ZSxuZXdTaXplOml9KSk6dGhpc30sYWRkSGFuZGxlcjpmdW5jdGlvbih0LGUpe2lmKCFlKXJldHVybiB0aGlzO3ZhciBpPXRoaXNbdF09bmV3IGUodGhpcyk7cmV0dXJuIHRoaXMuX2hhbmRsZXJzLnB1c2goaSksdGhpcy5vcHRpb25zW3RdJiZpLmVuYWJsZSgpLHRoaXN9LHJlbW92ZTpmdW5jdGlvbigpe3RoaXMuX2xvYWRlZCYmdGhpcy5maXJlKCJ1bmxvYWQiKSx0aGlzLl9pbml0RXZlbnRzKCJvZmYiKTt0cnl7ZGVsZXRlIHRoaXMuX2NvbnRhaW5lci5fbGVhZmxldH1jYXRjaCh0KXt0aGlzLl9jb250YWluZXIuX2xlYWZsZXQ9aX1yZXR1cm4gdGhpcy5fY2xlYXJQYW5lcygpLHRoaXMuX2NsZWFyQ29udHJvbFBvcyYmdGhpcy5fY2xlYXJDb250cm9sUG9zKCksdGhpcy5fY2xlYXJIYW5kbGVycygpLHRoaXN9LGdldENlbnRlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jaGVja0lmTG9hZGVkKCksdGhpcy5faW5pdGlhbENlbnRlciYmIXRoaXMuX21vdmVkKCk/dGhpcy5faW5pdGlhbENlbnRlcjp0aGlzLmxheWVyUG9pbnRUb0xhdExuZyh0aGlzLl9nZXRDZW50ZXJMYXllclBvaW50KCkpfSxnZXRab29tOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3pvb219LGdldEJvdW5kczpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0UGl4ZWxCb3VuZHMoKSxlPXRoaXMudW5wcm9qZWN0KHQuZ2V0Qm90dG9tTGVmdCgpKSxpPXRoaXMudW5wcm9qZWN0KHQuZ2V0VG9wUmlnaHQoKSk7cmV0dXJuIG5ldyBvLkxhdExuZ0JvdW5kcyhlLGkpfSxnZXRNaW5ab29tOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbGF5ZXJzTWluWm9vbT09PWk/MDp0aGlzLl9sYXllcnNNaW5ab29tLGU9dGhpcy5fYm91bmRzTWluWm9vbT09PWk/MDp0aGlzLl9ib3VuZHNNaW5ab29tO3JldHVybiB0aGlzLm9wdGlvbnMubWluWm9vbT09PWk/TWF0aC5tYXgodCxlKTp0aGlzLm9wdGlvbnMubWluWm9vbX0sZ2V0TWF4Wm9vbTpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMubWF4Wm9vbT09PWk/dGhpcy5fbGF5ZXJzTWF4Wm9vbT09PWk/MS8wOnRoaXMuX2xheWVyc01heFpvb206dGhpcy5vcHRpb25zLm1heFpvb219LGdldEJvdW5kc1pvb206ZnVuY3Rpb24odCxlLGkpe3Q9by5sYXRMbmdCb3VuZHModCk7dmFyIG4scz10aGlzLmdldE1pblpvb20oKS0oZT8xOjApLGE9dGhpcy5nZXRNYXhab29tKCkscj10aGlzLmdldFNpemUoKSxoPXQuZ2V0Tm9ydGhXZXN0KCksbD10LmdldFNvdXRoRWFzdCgpLHU9ITA7aT1vLnBvaW50KGl8fFswLDBdKTtkbyBzKyssbj10aGlzLnByb2plY3QobCxzKS5zdWJ0cmFjdCh0aGlzLnByb2plY3QoaCxzKSkuYWRkKGkpLHU9ZT9uLng8ci54fHxuLnk8ci55OnIuY29udGFpbnMobik7d2hpbGUodSYmYT49cyk7cmV0dXJuIHUmJmU/bnVsbDplP3M6cy0xfSxnZXRTaXplOmZ1bmN0aW9uKCl7cmV0dXJuKCF0aGlzLl9zaXplfHx0aGlzLl9zaXplQ2hhbmdlZCkmJih0aGlzLl9zaXplPW5ldyBvLlBvaW50KHRoaXMuX2NvbnRhaW5lci5jbGllbnRXaWR0aCx0aGlzLl9jb250YWluZXIuY2xpZW50SGVpZ2h0KSx0aGlzLl9zaXplQ2hhbmdlZD0hMSksdGhpcy5fc2l6ZS5jbG9uZSgpfSxnZXRQaXhlbEJvdW5kczpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2dldFRvcExlZnRQb2ludCgpO3JldHVybiBuZXcgby5Cb3VuZHModCx0LmFkZCh0aGlzLmdldFNpemUoKSkpfSxnZXRQaXhlbE9yaWdpbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jaGVja0lmTG9hZGVkKCksdGhpcy5faW5pdGlhbFRvcExlZnRQb2ludH0sZ2V0UGFuZXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcGFuZXN9LGdldENvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jb250YWluZXJ9LGdldFpvb21TY2FsZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLm9wdGlvbnMuY3JzO3JldHVybiBlLnNjYWxlKHQpL2Uuc2NhbGUodGhpcy5fem9vbSl9LGdldFNjYWxlWm9vbTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fem9vbStNYXRoLmxvZyh0KS9NYXRoLkxOMn0scHJvamVjdDpmdW5jdGlvbih0LGUpe3JldHVybiBlPWU9PT1pP3RoaXMuX3pvb206ZSx0aGlzLm9wdGlvbnMuY3JzLmxhdExuZ1RvUG9pbnQoby5sYXRMbmcodCksZSl9LHVucHJvamVjdDpmdW5jdGlvbih0LGUpe3JldHVybiBlPWU9PT1pP3RoaXMuX3pvb206ZSx0aGlzLm9wdGlvbnMuY3JzLnBvaW50VG9MYXRMbmcoby5wb2ludCh0KSxlKX0sbGF5ZXJQb2ludFRvTGF0TG5nOmZ1bmN0aW9uKHQpe3ZhciBlPW8ucG9pbnQodCkuYWRkKHRoaXMuZ2V0UGl4ZWxPcmlnaW4oKSk7cmV0dXJuIHRoaXMudW5wcm9qZWN0KGUpfSxsYXRMbmdUb0xheWVyUG9pbnQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5wcm9qZWN0KG8ubGF0TG5nKHQpKS5fcm91bmQoKTtyZXR1cm4gZS5fc3VidHJhY3QodGhpcy5nZXRQaXhlbE9yaWdpbigpKX0sY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIG8ucG9pbnQodCkuc3VidHJhY3QodGhpcy5fZ2V0TWFwUGFuZVBvcygpKX0sbGF5ZXJQb2ludFRvQ29udGFpbmVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIG8ucG9pbnQodCkuYWRkKHRoaXMuX2dldE1hcFBhbmVQb3MoKSl9LGNvbnRhaW5lclBvaW50VG9MYXRMbmc6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5jb250YWluZXJQb2ludFRvTGF5ZXJQb2ludChvLnBvaW50KHQpKTtyZXR1cm4gdGhpcy5sYXllclBvaW50VG9MYXRMbmcoZSl9LGxhdExuZ1RvQ29udGFpbmVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMubGF5ZXJQb2ludFRvQ29udGFpbmVyUG9pbnQodGhpcy5sYXRMbmdUb0xheWVyUG9pbnQoby5sYXRMbmcodCkpKX0sbW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIG8uRG9tRXZlbnQuZ2V0TW91c2VQb3NpdGlvbih0LHRoaXMuX2NvbnRhaW5lcil9LG1vdXNlRXZlbnRUb0xheWVyUG9pbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQodGhpcy5tb3VzZUV2ZW50VG9Db250YWluZXJQb2ludCh0KSl9LG1vdXNlRXZlbnRUb0xhdExuZzpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5sYXllclBvaW50VG9MYXRMbmcodGhpcy5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQpKX0sX2luaXRDb250YWluZXI6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fY29udGFpbmVyPW8uRG9tVXRpbC5nZXQodCk7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJNYXAgY29udGFpbmVyIG5vdCBmb3VuZC4iKTtpZihlLl9sZWFmbGV0KXRocm93IG5ldyBFcnJvcigiTWFwIGNvbnRhaW5lciBpcyBhbHJlYWR5IGluaXRpYWxpemVkLiIpO2UuX2xlYWZsZXQ9ITB9LF9pbml0TGF5b3V0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fY29udGFpbmVyO28uRG9tVXRpbC5hZGRDbGFzcyh0LCJsZWFmbGV0LWNvbnRhaW5lciIrKG8uQnJvd3Nlci50b3VjaD8iIGxlYWZsZXQtdG91Y2giOiIiKSsoby5Ccm93c2VyLnJldGluYT8iIGxlYWZsZXQtcmV0aW5hIjoiIikrKHRoaXMub3B0aW9ucy5mYWRlQW5pbWF0aW9uPyIgbGVhZmxldC1mYWRlLWFuaW0iOiIiKSk7dmFyIGU9by5Eb21VdGlsLmdldFN0eWxlKHQsInBvc2l0aW9uIik7ImFic29sdXRlIiE9PWUmJiJyZWxhdGl2ZSIhPT1lJiYiZml4ZWQiIT09ZSYmKHQuc3R5bGUucG9zaXRpb249InJlbGF0aXZlIiksdGhpcy5faW5pdFBhbmVzKCksdGhpcy5faW5pdENvbnRyb2xQb3MmJnRoaXMuX2luaXRDb250cm9sUG9zKCl9LF9pbml0UGFuZXM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9wYW5lcz17fTt0aGlzLl9tYXBQYW5lPXQubWFwUGFuZT10aGlzLl9jcmVhdGVQYW5lKCJsZWFmbGV0LW1hcC1wYW5lIix0aGlzLl9jb250YWluZXIpLHRoaXMuX3RpbGVQYW5lPXQudGlsZVBhbmU9dGhpcy5fY3JlYXRlUGFuZSgibGVhZmxldC10aWxlLXBhbmUiLHRoaXMuX21hcFBhbmUpLHQub2JqZWN0c1BhbmU9dGhpcy5fY3JlYXRlUGFuZSgibGVhZmxldC1vYmplY3RzLXBhbmUiLHRoaXMuX21hcFBhbmUpLHQuc2hhZG93UGFuZT10aGlzLl9jcmVhdGVQYW5lKCJsZWFmbGV0LXNoYWRvdy1wYW5lIiksdC5vdmVybGF5UGFuZT10aGlzLl9jcmVhdGVQYW5lKCJsZWFmbGV0LW92ZXJsYXktcGFuZSIpLHQubWFya2VyUGFuZT10aGlzLl9jcmVhdGVQYW5lKCJsZWFmbGV0LW1hcmtlci1wYW5lIiksdC5wb3B1cFBhbmU9dGhpcy5fY3JlYXRlUGFuZSgibGVhZmxldC1wb3B1cC1wYW5lIik7dmFyIGU9IiBsZWFmbGV0LXpvb20taGlkZSI7dGhpcy5vcHRpb25zLm1hcmtlclpvb21BbmltYXRpb258fChvLkRvbVV0aWwuYWRkQ2xhc3ModC5tYXJrZXJQYW5lLGUpLG8uRG9tVXRpbC5hZGRDbGFzcyh0LnNoYWRvd1BhbmUsZSksby5Eb21VdGlsLmFkZENsYXNzKHQucG9wdXBQYW5lLGUpKX0sX2NyZWF0ZVBhbmU6ZnVuY3Rpb24odCxlKXtyZXR1cm4gby5Eb21VdGlsLmNyZWF0ZSgiZGl2Iix0LGV8fHRoaXMuX3BhbmVzLm9iamVjdHNQYW5lKX0sX2NsZWFyUGFuZXM6ZnVuY3Rpb24oKXt0aGlzLl9jb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5fbWFwUGFuZSl9LF9hZGRMYXllcnM6ZnVuY3Rpb24odCl7dD10P28uVXRpbC5pc0FycmF5KHQpP3Q6W3RdOltdO2Zvcih2YXIgZT0wLGk9dC5sZW5ndGg7aT5lO2UrKyl0aGlzLmFkZExheWVyKHRbZV0pfSxfcmVzZXRWaWV3OmZ1bmN0aW9uKHQsZSxpLG4pe3ZhciBzPXRoaXMuX3pvb20hPT1lO258fCh0aGlzLmZpcmUoIm1vdmVzdGFydCIpLHMmJnRoaXMuZmlyZSgiem9vbXN0YXJ0IikpLHRoaXMuX3pvb209ZSx0aGlzLl9pbml0aWFsQ2VudGVyPXQsdGhpcy5faW5pdGlhbFRvcExlZnRQb2ludD10aGlzLl9nZXROZXdUb3BMZWZ0UG9pbnQodCksaT90aGlzLl9pbml0aWFsVG9wTGVmdFBvaW50Ll9hZGQodGhpcy5fZ2V0TWFwUGFuZVBvcygpKTpvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fbWFwUGFuZSxuZXcgby5Qb2ludCgwLDApKSx0aGlzLl90aWxlTGF5ZXJzVG9Mb2FkPXRoaXMuX3RpbGVMYXllcnNOdW07dmFyIGE9IXRoaXMuX2xvYWRlZDt0aGlzLl9sb2FkZWQ9ITAsYSYmKHRoaXMuZmlyZSgibG9hZCIpLHRoaXMuZWFjaExheWVyKHRoaXMuX2xheWVyQWRkLHRoaXMpKSx0aGlzLmZpcmUoInZpZXdyZXNldCIse2hhcmQ6IWl9KSx0aGlzLmZpcmUoIm1vdmUiKSwoc3x8bikmJnRoaXMuZmlyZSgiem9vbWVuZCIpLHRoaXMuZmlyZSgibW92ZWVuZCIse2hhcmQ6IWl9KX0sX3Jhd1BhbkJ5OmZ1bmN0aW9uKHQpe28uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lLHRoaXMuX2dldE1hcFBhbmVQb3MoKS5zdWJ0cmFjdCh0KSl9LF9nZXRab29tU3BhbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldE1heFpvb20oKS10aGlzLmdldE1pblpvb20oKX0sX3VwZGF0ZVpvb21MZXZlbHM6ZnVuY3Rpb24oKXt2YXIgdCxlPTEvMCxuPS0xLzAsbz10aGlzLl9nZXRab29tU3BhbigpO2Zvcih0IGluIHRoaXMuX3pvb21Cb3VuZExheWVycyl7dmFyIHM9dGhpcy5fem9vbUJvdW5kTGF5ZXJzW3RdO2lzTmFOKHMub3B0aW9ucy5taW5ab29tKXx8KGU9TWF0aC5taW4oZSxzLm9wdGlvbnMubWluWm9vbSkpLGlzTmFOKHMub3B0aW9ucy5tYXhab29tKXx8KG49TWF0aC5tYXgobixzLm9wdGlvbnMubWF4Wm9vbSkpfXQ9PT1pP3RoaXMuX2xheWVyc01heFpvb209dGhpcy5fbGF5ZXJzTWluWm9vbT1pOih0aGlzLl9sYXllcnNNYXhab29tPW4sdGhpcy5fbGF5ZXJzTWluWm9vbT1lKSxvIT09dGhpcy5fZ2V0Wm9vbVNwYW4oKSYmdGhpcy5maXJlKCJ6b29tbGV2ZWxzY2hhbmdlIil9LF9wYW5JbnNpZGVNYXhCb3VuZHM6ZnVuY3Rpb24oKXt0aGlzLnBhbkluc2lkZUJvdW5kcyh0aGlzLm9wdGlvbnMubWF4Qm91bmRzKX0sX2NoZWNrSWZMb2FkZWQ6ZnVuY3Rpb24oKXtpZighdGhpcy5fbG9hZGVkKXRocm93IG5ldyBFcnJvcigiU2V0IG1hcCBjZW50ZXIgYW5kIHpvb20gZmlyc3QuIil9LF9pbml0RXZlbnRzOmZ1bmN0aW9uKGUpe2lmKG8uRG9tRXZlbnQpe2U9ZXx8Im9uIixvLkRvbUV2ZW50W2VdKHRoaXMuX2NvbnRhaW5lciwiY2xpY2siLHRoaXMuX29uTW91c2VDbGljayx0aGlzKTt2YXIgaSxuLHM9WyJkYmxjbGljayIsIm1vdXNlZG93biIsIm1vdXNldXAiLCJtb3VzZWVudGVyIiwibW91c2VsZWF2ZSIsIm1vdXNlbW92ZSIsImNvbnRleHRtZW51Il07Zm9yKGk9MCxuPXMubGVuZ3RoO24+aTtpKyspby5Eb21FdmVudFtlXSh0aGlzLl9jb250YWluZXIsc1tpXSx0aGlzLl9maXJlTW91c2VFdmVudCx0aGlzKTt0aGlzLm9wdGlvbnMudHJhY2tSZXNpemUmJm8uRG9tRXZlbnRbZV0odCwicmVzaXplIix0aGlzLl9vblJlc2l6ZSx0aGlzKX19LF9vblJlc2l6ZTpmdW5jdGlvbigpe28uVXRpbC5jYW5jZWxBbmltRnJhbWUodGhpcy5fcmVzaXplUmVxdWVzdCksdGhpcy5fcmVzaXplUmVxdWVzdD1vLlV0aWwucmVxdWVzdEFuaW1GcmFtZSh0aGlzLmludmFsaWRhdGVTaXplLHRoaXMsITEsdGhpcy5fY29udGFpbmVyKX0sX29uTW91c2VDbGljazpmdW5jdGlvbih0KXshdGhpcy5fbG9hZGVkfHwhdC5fc2ltdWxhdGVkJiYodGhpcy5kcmFnZ2luZyYmdGhpcy5kcmFnZ2luZy5tb3ZlZCgpfHx0aGlzLmJveFpvb20mJnRoaXMuYm94Wm9vbS5tb3ZlZCgpKXx8by5Eb21FdmVudC5fc2tpcHBlZCh0KXx8KHRoaXMuZmlyZSgicHJlY2xpY2siKSx0aGlzLl9maXJlTW91c2VFdmVudCh0KSl9LF9maXJlTW91c2VFdmVudDpmdW5jdGlvbih0KXtpZih0aGlzLl9sb2FkZWQmJiFvLkRvbUV2ZW50Ll9za2lwcGVkKHQpKXt2YXIgZT10LnR5cGU7aWYoZT0ibW91c2VlbnRlciI9PT1lPyJtb3VzZW92ZXIiOiJtb3VzZWxlYXZlIj09PWU/Im1vdXNlb3V0IjplLHRoaXMuaGFzRXZlbnRMaXN0ZW5lcnMoZSkpeyJjb250ZXh0bWVudSI9PT1lJiZvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KHQpO3ZhciBpPXRoaXMubW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQodCksbj10aGlzLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KGkpLHM9dGhpcy5sYXllclBvaW50VG9MYXRMbmcobik7dGhpcy5maXJlKGUse2xhdGxuZzpzLGxheWVyUG9pbnQ6bixjb250YWluZXJQb2ludDppLG9yaWdpbmFsRXZlbnQ6dH0pfX19LF9vblRpbGVMYXllckxvYWQ6ZnVuY3Rpb24oKXt0aGlzLl90aWxlTGF5ZXJzVG9Mb2FkLS0sdGhpcy5fdGlsZUxheWVyc051bSYmIXRoaXMuX3RpbGVMYXllcnNUb0xvYWQmJnRoaXMuZmlyZSgidGlsZWxheWVyc2xvYWQiKX0sX2NsZWFySGFuZGxlcnM6ZnVuY3Rpb24oKXtmb3IodmFyIHQ9MCxlPXRoaXMuX2hhbmRsZXJzLmxlbmd0aDtlPnQ7dCsrKXRoaXMuX2hhbmRsZXJzW3RdLmRpc2FibGUoKX0sd2hlblJlYWR5OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX2xvYWRlZD90LmNhbGwoZXx8dGhpcyx0aGlzKTp0aGlzLm9uKCJsb2FkIix0LGUpLHRoaXN9LF9sYXllckFkZDpmdW5jdGlvbih0KXt0Lm9uQWRkKHRoaXMpLHRoaXMuZmlyZSgibGF5ZXJhZGQiLHtsYXllcjp0fSl9LF9nZXRNYXBQYW5lUG9zOmZ1bmN0aW9uKCl7cmV0dXJuIG8uRG9tVXRpbC5nZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lKX0sX21vdmVkOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZ2V0TWFwUGFuZVBvcygpO3JldHVybiB0JiYhdC5lcXVhbHMoWzAsMF0pfSxfZ2V0VG9wTGVmdFBvaW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0UGl4ZWxPcmlnaW4oKS5zdWJ0cmFjdCh0aGlzLl9nZXRNYXBQYW5lUG9zKCkpfSxfZ2V0TmV3VG9wTGVmdFBvaW50OmZ1bmN0aW9uKHQsZSl7dmFyIGk9dGhpcy5nZXRTaXplKCkuX2RpdmlkZUJ5KDIpO3JldHVybiB0aGlzLnByb2plY3QodCxlKS5fc3VidHJhY3QoaSkuX3JvdW5kKCl9LF9sYXRMbmdUb05ld0xheWVyUG9pbnQ6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPXRoaXMuX2dldE5ld1RvcExlZnRQb2ludChpLGUpLmFkZCh0aGlzLl9nZXRNYXBQYW5lUG9zKCkpO3JldHVybiB0aGlzLnByb2plY3QodCxlKS5fc3VidHJhY3Qobil9LF9nZXRDZW50ZXJMYXllclBvaW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQodGhpcy5nZXRTaXplKCkuX2RpdmlkZUJ5KDIpKX0sX2dldENlbnRlck9mZnNldDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5sYXRMbmdUb0xheWVyUG9pbnQodCkuc3VidHJhY3QodGhpcy5fZ2V0Q2VudGVyTGF5ZXJQb2ludCgpKX0sX2xpbWl0Wm9vbTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLmdldE1pblpvb20oKSxpPXRoaXMuZ2V0TWF4Wm9vbSgpO3JldHVybiBNYXRoLm1heChlLE1hdGgubWluKGksdCkpfX0pLG8ubWFwPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLk1hcCh0LGUpfSxvLlByb2plY3Rpb24uTWVyY2F0b3I9e01BWF9MQVRJVFVERTo4NS4wODQwNTkxNTU2LFJfTUlOT1I6NjM1Njc1Mi4zMTQyNDUxNzksUl9NQUpPUjo2Mzc4MTM3LHByb2plY3Q6ZnVuY3Rpb24odCl7dmFyIGU9by5MYXRMbmcuREVHX1RPX1JBRCxpPXRoaXMuTUFYX0xBVElUVURFLG49TWF0aC5tYXgoTWF0aC5taW4oaSx0LmxhdCksLWkpLHM9dGhpcy5SX01BSk9SLGE9dGhpcy5SX01JTk9SLHI9dC5sbmcqZSpzLGg9biplLGw9YS9zLHU9TWF0aC5zcXJ0KDEtbCpsKSxjPXUqTWF0aC5zaW4oaCk7Yz1NYXRoLnBvdygoMS1jKS8oMStjKSwuNSp1KTt2YXIgZD1NYXRoLnRhbiguNSooLjUqTWF0aC5QSS1oKSkvYztyZXR1cm4gaD0tcypNYXRoLmxvZyhkKSxuZXcgby5Qb2ludChyLGgpfSx1bnByb2plY3Q6ZnVuY3Rpb24odCl7Zm9yKHZhciBlLGk9by5MYXRMbmcuUkFEX1RPX0RFRyxuPXRoaXMuUl9NQUpPUixzPXRoaXMuUl9NSU5PUixhPXQueCppL24scj1zL24saD1NYXRoLnNxcnQoMS1yKnIpLGw9TWF0aC5leHAoLXQueS9uKSx1PU1hdGguUEkvMi0yKk1hdGguYXRhbihsKSxjPTE1LGQ9MWUtNyxwPWMsbT0uMTtNYXRoLmFicyhtKT5kJiYtLXA+MDspZT1oKk1hdGguc2luKHUpLG09TWF0aC5QSS8yLTIqTWF0aC5hdGFuKGwqTWF0aC5wb3coKDEtZSkvKDErZSksLjUqaCkpLXUsdSs9bTtyZXR1cm4gbmV3IG8uTGF0TG5nKHUqaSxhKX19LG8uQ1JTLkVQU0czMzk1PW8uZXh0ZW5kKHt9LG8uQ1JTLHtjb2RlOiJFUFNHOjMzOTUiLHByb2plY3Rpb246by5Qcm9qZWN0aW9uLk1lcmNhdG9yLHRyYW5zZm9ybWF0aW9uOmZ1bmN0aW9uKCl7dmFyIHQ9by5Qcm9qZWN0aW9uLk1lcmNhdG9yLGU9dC5SX01BSk9SLGk9LjUvKE1hdGguUEkqZSk7cmV0dXJuIG5ldyBvLlRyYW5zZm9ybWF0aW9uKGksLjUsLWksLjUpfSgpfSksby5UaWxlTGF5ZXI9by5DbGFzcy5leHRlbmQoe2luY2x1ZGVzOm8uTWl4aW4uRXZlbnRzLG9wdGlvbnM6e21pblpvb206MCxtYXhab29tOjE4LHRpbGVTaXplOjI1NixzdWJkb21haW5zOiJhYmMiLGVycm9yVGlsZVVybDoiIixhdHRyaWJ1dGlvbjoiIix6b29tT2Zmc2V0OjAsb3BhY2l0eToxLHVubG9hZEludmlzaWJsZVRpbGVzOm8uQnJvd3Nlci5tb2JpbGUsdXBkYXRlV2hlbklkbGU6by5Ccm93c2VyLm1vYmlsZX0saW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUpe2U9by5zZXRPcHRpb25zKHRoaXMsZSksZS5kZXRlY3RSZXRpbmEmJm8uQnJvd3Nlci5yZXRpbmEmJmUubWF4Wm9vbT4wJiYoZS50aWxlU2l6ZT1NYXRoLmZsb29yKGUudGlsZVNpemUvMiksZS56b29tT2Zmc2V0KyssZS5taW5ab29tPjAmJmUubWluWm9vbS0tLHRoaXMub3B0aW9ucy5tYXhab29tLS0pLGUuYm91bmRzJiYoZS5ib3VuZHM9by5sYXRMbmdCb3VuZHMoZS5ib3VuZHMpKSx0aGlzLl91cmw9dDsKdmFyIGk9dGhpcy5vcHRpb25zLnN1YmRvbWFpbnM7InN0cmluZyI9PXR5cGVvZiBpJiYodGhpcy5vcHRpb25zLnN1YmRvbWFpbnM9aS5zcGxpdCgiIikpfSxvbkFkZDpmdW5jdGlvbih0KXt0aGlzLl9tYXA9dCx0aGlzLl9hbmltYXRlZD10Ll96b29tQW5pbWF0ZWQsdGhpcy5faW5pdENvbnRhaW5lcigpLHQub24oe3ZpZXdyZXNldDp0aGlzLl9yZXNldCxtb3ZlZW5kOnRoaXMuX3VwZGF0ZX0sdGhpcyksdGhpcy5fYW5pbWF0ZWQmJnQub24oe3pvb21hbmltOnRoaXMuX2FuaW1hdGVab29tLHpvb21lbmQ6dGhpcy5fZW5kWm9vbUFuaW19LHRoaXMpLHRoaXMub3B0aW9ucy51cGRhdGVXaGVuSWRsZXx8KHRoaXMuX2xpbWl0ZWRVcGRhdGU9by5VdGlsLmxpbWl0RXhlY0J5SW50ZXJ2YWwodGhpcy5fdXBkYXRlLDE1MCx0aGlzKSx0Lm9uKCJtb3ZlIix0aGlzLl9saW1pdGVkVXBkYXRlLHRoaXMpKSx0aGlzLl9yZXNldCgpLHRoaXMuX3VwZGF0ZSgpfSxhZGRUbzpmdW5jdGlvbih0KXtyZXR1cm4gdC5hZGRMYXllcih0aGlzKSx0aGlzfSxvblJlbW92ZTpmdW5jdGlvbih0KXt0aGlzLl9jb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLl9jb250YWluZXIpLHQub2ZmKHt2aWV3cmVzZXQ6dGhpcy5fcmVzZXQsbW92ZWVuZDp0aGlzLl91cGRhdGV9LHRoaXMpLHRoaXMuX2FuaW1hdGVkJiZ0Lm9mZih7em9vbWFuaW06dGhpcy5fYW5pbWF0ZVpvb20sem9vbWVuZDp0aGlzLl9lbmRab29tQW5pbX0sdGhpcyksdGhpcy5vcHRpb25zLnVwZGF0ZVdoZW5JZGxlfHx0Lm9mZigibW92ZSIsdGhpcy5fbGltaXRlZFVwZGF0ZSx0aGlzKSx0aGlzLl9jb250YWluZXI9bnVsbCx0aGlzLl9tYXA9bnVsbH0sYnJpbmdUb0Zyb250OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLl9wYW5lcy50aWxlUGFuZTtyZXR1cm4gdGhpcy5fY29udGFpbmVyJiYodC5hcHBlbmRDaGlsZCh0aGlzLl9jb250YWluZXIpLHRoaXMuX3NldEF1dG9aSW5kZXgodCxNYXRoLm1heCkpLHRoaXN9LGJyaW5nVG9CYWNrOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLl9wYW5lcy50aWxlUGFuZTtyZXR1cm4gdGhpcy5fY29udGFpbmVyJiYodC5pbnNlcnRCZWZvcmUodGhpcy5fY29udGFpbmVyLHQuZmlyc3RDaGlsZCksdGhpcy5fc2V0QXV0b1pJbmRleCh0LE1hdGgubWluKSksdGhpc30sZ2V0QXR0cmlidXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLmF0dHJpYnV0aW9ufSxnZXRDb250YWluZXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fY29udGFpbmVyfSxzZXRPcGFjaXR5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9wdGlvbnMub3BhY2l0eT10LHRoaXMuX21hcCYmdGhpcy5fdXBkYXRlT3BhY2l0eSgpLHRoaXN9LHNldFpJbmRleDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLnpJbmRleD10LHRoaXMuX3VwZGF0ZVpJbmRleCgpLHRoaXN9LHNldFVybDpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLl91cmw9dCxlfHx0aGlzLnJlZHJhdygpLHRoaXN9LHJlZHJhdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXAmJih0aGlzLl9yZXNldCh7aGFyZDohMH0pLHRoaXMuX3VwZGF0ZSgpKSx0aGlzfSxfdXBkYXRlWkluZGV4OmZ1bmN0aW9uKCl7dGhpcy5fY29udGFpbmVyJiZ0aGlzLm9wdGlvbnMuekluZGV4IT09aSYmKHRoaXMuX2NvbnRhaW5lci5zdHlsZS56SW5kZXg9dGhpcy5vcHRpb25zLnpJbmRleCl9LF9zZXRBdXRvWkluZGV4OmZ1bmN0aW9uKHQsZSl7dmFyIGksbixvLHM9dC5jaGlsZHJlbixhPS1lKDEvMCwtMS8wKTtmb3Iobj0wLG89cy5sZW5ndGg7bz5uO24rKylzW25dIT09dGhpcy5fY29udGFpbmVyJiYoaT1wYXJzZUludChzW25dLnN0eWxlLnpJbmRleCwxMCksaXNOYU4oaSl8fChhPWUoYSxpKSkpO3RoaXMub3B0aW9ucy56SW5kZXg9dGhpcy5fY29udGFpbmVyLnN0eWxlLnpJbmRleD0oaXNGaW5pdGUoYSk/YTowKStlKDEsLTEpfSxfdXBkYXRlT3BhY2l0eTpmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5fdGlsZXM7aWYoby5Ccm93c2VyLmllbHQ5KWZvcih0IGluIGUpby5Eb21VdGlsLnNldE9wYWNpdHkoZVt0XSx0aGlzLm9wdGlvbnMub3BhY2l0eSk7ZWxzZSBvLkRvbVV0aWwuc2V0T3BhY2l0eSh0aGlzLl9jb250YWluZXIsdGhpcy5vcHRpb25zLm9wYWNpdHkpfSxfaW5pdENvbnRhaW5lcjpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcC5fcGFuZXMudGlsZVBhbmU7aWYoIXRoaXMuX2NvbnRhaW5lcil7aWYodGhpcy5fY29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoImRpdiIsImxlYWZsZXQtbGF5ZXIiKSx0aGlzLl91cGRhdGVaSW5kZXgoKSx0aGlzLl9hbmltYXRlZCl7dmFyIGU9ImxlYWZsZXQtdGlsZS1jb250YWluZXIgbGVhZmxldC16b29tLWFuaW1hdGVkIjt0aGlzLl9iZ0J1ZmZlcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGUsdGhpcy5fY29udGFpbmVyKSx0aGlzLl90aWxlQ29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoImRpdiIsZSx0aGlzLl9jb250YWluZXIpfWVsc2UgdGhpcy5fdGlsZUNvbnRhaW5lcj10aGlzLl9jb250YWluZXI7dC5hcHBlbmRDaGlsZCh0aGlzLl9jb250YWluZXIpLHRoaXMub3B0aW9ucy5vcGFjaXR5PDEmJnRoaXMuX3VwZGF0ZU9wYWNpdHkoKX19LF9yZXNldDpmdW5jdGlvbih0KXtmb3IodmFyIGUgaW4gdGhpcy5fdGlsZXMpdGhpcy5maXJlKCJ0aWxldW5sb2FkIix7dGlsZTp0aGlzLl90aWxlc1tlXX0pO3RoaXMuX3RpbGVzPXt9LHRoaXMuX3RpbGVzVG9Mb2FkPTAsdGhpcy5vcHRpb25zLnJldXNlVGlsZXMmJih0aGlzLl91bnVzZWRUaWxlcz1bXSksdGhpcy5fdGlsZUNvbnRhaW5lci5pbm5lckhUTUw9IiIsdGhpcy5fYW5pbWF0ZWQmJnQmJnQuaGFyZCYmdGhpcy5fY2xlYXJCZ0J1ZmZlcigpLHRoaXMuX2luaXRDb250YWluZXIoKX0sX2dldFRpbGVTaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLGU9dC5nZXRab29tKCksaT10aGlzLm9wdGlvbnMubWF4TmF0aXZlWm9vbSxuPXRoaXMub3B0aW9ucy50aWxlU2l6ZTtyZXR1cm4gaSYmZT5pJiYobj1NYXRoLnJvdW5kKHQuZ2V0Wm9vbVNjYWxlKGUpL3QuZ2V0Wm9vbVNjYWxlKGkpKm4pKSxufSxfdXBkYXRlOmZ1bmN0aW9uKCl7aWYodGhpcy5fbWFwKXt2YXIgdD10aGlzLl9tYXAsZT10LmdldFBpeGVsQm91bmRzKCksaT10LmdldFpvb20oKSxuPXRoaXMuX2dldFRpbGVTaXplKCk7aWYoIShpPnRoaXMub3B0aW9ucy5tYXhab29tfHxpPHRoaXMub3B0aW9ucy5taW5ab29tKSl7dmFyIHM9by5ib3VuZHMoZS5taW4uZGl2aWRlQnkobikuX2Zsb29yKCksZS5tYXguZGl2aWRlQnkobikuX2Zsb29yKCkpO3RoaXMuX2FkZFRpbGVzRnJvbUNlbnRlck91dChzKSwodGhpcy5vcHRpb25zLnVubG9hZEludmlzaWJsZVRpbGVzfHx0aGlzLm9wdGlvbnMucmV1c2VUaWxlcykmJnRoaXMuX3JlbW92ZU90aGVyVGlsZXMocyl9fX0sX2FkZFRpbGVzRnJvbUNlbnRlck91dDpmdW5jdGlvbih0KXt2YXIgaSxuLHMsYT1bXSxyPXQuZ2V0Q2VudGVyKCk7Zm9yKGk9dC5taW4ueTtpPD10Lm1heC55O2krKylmb3Iobj10Lm1pbi54O248PXQubWF4Lng7bisrKXM9bmV3IG8uUG9pbnQobixpKSx0aGlzLl90aWxlU2hvdWxkQmVMb2FkZWQocykmJmEucHVzaChzKTt2YXIgaD1hLmxlbmd0aDtpZigwIT09aCl7YS5zb3J0KGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQuZGlzdGFuY2VUbyhyKS1lLmRpc3RhbmNlVG8ocil9KTt2YXIgbD1lLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtmb3IodGhpcy5fdGlsZXNUb0xvYWR8fHRoaXMuZmlyZSgibG9hZGluZyIpLHRoaXMuX3RpbGVzVG9Mb2FkKz1oLG49MDtoPm47bisrKXRoaXMuX2FkZFRpbGUoYVtuXSxsKTt0aGlzLl90aWxlQ29udGFpbmVyLmFwcGVuZENoaWxkKGwpfX0sX3RpbGVTaG91bGRCZUxvYWRlZDpmdW5jdGlvbih0KXtpZih0LngrIjoiK3QueSBpbiB0aGlzLl90aWxlcylyZXR1cm4hMTt2YXIgZT10aGlzLm9wdGlvbnM7aWYoIWUuY29udGludW91c1dvcmxkKXt2YXIgaT10aGlzLl9nZXRXcmFwVGlsZU51bSgpO2lmKGUubm9XcmFwJiYodC54PDB8fHQueD49aSl8fHQueTwwfHx0Lnk+PWkpcmV0dXJuITF9aWYoZS5ib3VuZHMpe3ZhciBuPWUudGlsZVNpemUsbz10Lm11bHRpcGx5Qnkobikscz1vLmFkZChbbixuXSksYT10aGlzLl9tYXAudW5wcm9qZWN0KG8pLHI9dGhpcy5fbWFwLnVucHJvamVjdChzKTtpZihlLmNvbnRpbnVvdXNXb3JsZHx8ZS5ub1dyYXB8fChhPWEud3JhcCgpLHI9ci53cmFwKCkpLCFlLmJvdW5kcy5pbnRlcnNlY3RzKFthLHJdKSlyZXR1cm4hMX1yZXR1cm4hMH0sX3JlbW92ZU90aGVyVGlsZXM6ZnVuY3Rpb24odCl7dmFyIGUsaSxuLG87Zm9yKG8gaW4gdGhpcy5fdGlsZXMpZT1vLnNwbGl0KCI6IiksaT1wYXJzZUludChlWzBdLDEwKSxuPXBhcnNlSW50KGVbMV0sMTApLChpPHQubWluLnh8fGk+dC5tYXgueHx8bjx0Lm1pbi55fHxuPnQubWF4LnkpJiZ0aGlzLl9yZW1vdmVUaWxlKG8pfSxfcmVtb3ZlVGlsZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl90aWxlc1t0XTt0aGlzLmZpcmUoInRpbGV1bmxvYWQiLHt0aWxlOmUsdXJsOmUuc3JjfSksdGhpcy5vcHRpb25zLnJldXNlVGlsZXM/KG8uRG9tVXRpbC5yZW1vdmVDbGFzcyhlLCJsZWFmbGV0LXRpbGUtbG9hZGVkIiksdGhpcy5fdW51c2VkVGlsZXMucHVzaChlKSk6ZS5wYXJlbnROb2RlPT09dGhpcy5fdGlsZUNvbnRhaW5lciYmdGhpcy5fdGlsZUNvbnRhaW5lci5yZW1vdmVDaGlsZChlKSxvLkJyb3dzZXIuYW5kcm9pZHx8KGUub25sb2FkPW51bGwsZS5zcmM9by5VdGlsLmVtcHR5SW1hZ2VVcmwpLGRlbGV0ZSB0aGlzLl90aWxlc1t0XX0sX2FkZFRpbGU6ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLl9nZXRUaWxlUG9zKHQpLG49dGhpcy5fZ2V0VGlsZSgpO28uRG9tVXRpbC5zZXRQb3NpdGlvbihuLGksby5Ccm93c2VyLmNocm9tZXx8by5Ccm93c2VyLmFuZHJvaWQyMyksdGhpcy5fdGlsZXNbdC54KyI6Iit0LnldPW4sdGhpcy5fbG9hZFRpbGUobix0KSxuLnBhcmVudE5vZGUhPT10aGlzLl90aWxlQ29udGFpbmVyJiZlLmFwcGVuZENoaWxkKG4pfSxfZ2V0Wm9vbUZvclVybDpmdW5jdGlvbigpe3ZhciB0PXRoaXMub3B0aW9ucyxlPXRoaXMuX21hcC5nZXRab29tKCk7cmV0dXJuIHQuem9vbVJldmVyc2UmJihlPXQubWF4Wm9vbS1lKSxlKz10Lnpvb21PZmZzZXQsdC5tYXhOYXRpdmVab29tP01hdGgubWluKGUsdC5tYXhOYXRpdmVab29tKTplfSxfZ2V0VGlsZVBvczpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAuZ2V0UGl4ZWxPcmlnaW4oKSxpPXRoaXMuX2dldFRpbGVTaXplKCk7cmV0dXJuIHQubXVsdGlwbHlCeShpKS5zdWJ0cmFjdChlKX0sZ2V0VGlsZVVybDpmdW5jdGlvbih0KXtyZXR1cm4gby5VdGlsLnRlbXBsYXRlKHRoaXMuX3VybCxvLmV4dGVuZCh7czp0aGlzLl9nZXRTdWJkb21haW4odCksejp0LnoseDp0LngseTp0Lnl9LHRoaXMub3B0aW9ucykpfSxfZ2V0V3JhcFRpbGVOdW06ZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5wb3coMix0aGlzLl9nZXRab29tRm9yVXJsKCkpfSxfYWRqdXN0VGlsZVBvaW50OmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2dldFdyYXBUaWxlTnVtKCk7dGhpcy5vcHRpb25zLmNvbnRpbnVvdXNXb3JsZHx8dGhpcy5vcHRpb25zLm5vV3JhcHx8KHQueD0odC54JWUrZSklZSksdGhpcy5vcHRpb25zLnRtcyYmKHQueT1lLXQueS0xKSx0Lno9dGhpcy5fZ2V0Wm9vbUZvclVybCgpfSxfZ2V0U3ViZG9tYWluOmZ1bmN0aW9uKHQpe3ZhciBlPU1hdGguYWJzKHQueCt0LnkpJXRoaXMub3B0aW9ucy5zdWJkb21haW5zLmxlbmd0aDtyZXR1cm4gdGhpcy5vcHRpb25zLnN1YmRvbWFpbnNbZV19LF9nZXRUaWxlOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLnJldXNlVGlsZXMmJnRoaXMuX3VudXNlZFRpbGVzLmxlbmd0aD4wKXt2YXIgdD10aGlzLl91bnVzZWRUaWxlcy5wb3AoKTtyZXR1cm4gdGhpcy5fcmVzZXRUaWxlKHQpLHR9cmV0dXJuIHRoaXMuX2NyZWF0ZVRpbGUoKX0sX3Jlc2V0VGlsZTpmdW5jdGlvbigpe30sX2NyZWF0ZVRpbGU6ZnVuY3Rpb24oKXt2YXIgdD1vLkRvbVV0aWwuY3JlYXRlKCJpbWciLCJsZWFmbGV0LXRpbGUiKTtyZXR1cm4gdC5zdHlsZS53aWR0aD10LnN0eWxlLmhlaWdodD10aGlzLl9nZXRUaWxlU2l6ZSgpKyJweCIsdC5nYWxsZXJ5aW1nPSJubyIsdC5vbnNlbGVjdHN0YXJ0PXQub25tb3VzZW1vdmU9by5VdGlsLmZhbHNlRm4sby5Ccm93c2VyLmllbHQ5JiZ0aGlzLm9wdGlvbnMub3BhY2l0eSE9PWkmJm8uRG9tVXRpbC5zZXRPcGFjaXR5KHQsdGhpcy5vcHRpb25zLm9wYWNpdHkpLHR9LF9sb2FkVGlsZTpmdW5jdGlvbih0LGUpe3QuX2xheWVyPXRoaXMsdC5vbmxvYWQ9dGhpcy5fdGlsZU9uTG9hZCx0Lm9uZXJyb3I9dGhpcy5fdGlsZU9uRXJyb3IsdGhpcy5fYWRqdXN0VGlsZVBvaW50KGUpLHQuc3JjPXRoaXMuZ2V0VGlsZVVybChlKX0sX3RpbGVMb2FkZWQ6ZnVuY3Rpb24oKXt0aGlzLl90aWxlc1RvTG9hZC0tLHRoaXMuX3RpbGVzVG9Mb2FkfHwodGhpcy5maXJlKCJsb2FkIiksdGhpcy5fYW5pbWF0ZWQmJihjbGVhclRpbWVvdXQodGhpcy5fY2xlYXJCZ0J1ZmZlclRpbWVyKSx0aGlzLl9jbGVhckJnQnVmZmVyVGltZXI9c2V0VGltZW91dChvLmJpbmQodGhpcy5fY2xlYXJCZ0J1ZmZlcix0aGlzKSw1MDApKSl9LF90aWxlT25Mb2FkOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbGF5ZXI7dGhpcy5zcmMhPT1vLlV0aWwuZW1wdHlJbWFnZVVybCYmKG8uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLCJsZWFmbGV0LXRpbGUtbG9hZGVkIiksdC5maXJlKCJ0aWxlbG9hZCIse3RpbGU6dGhpcyx1cmw6dGhpcy5zcmN9KSksdC5fdGlsZUxvYWRlZCgpfSxfdGlsZU9uRXJyb3I6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9sYXllcjt0LmZpcmUoInRpbGVlcnJvciIse3RpbGU6dGhpcyx1cmw6dGhpcy5zcmN9KTt2YXIgZT10Lm9wdGlvbnMuZXJyb3JUaWxlVXJsO2UmJih0aGlzLnNyYz1lKSx0Ll90aWxlTG9hZGVkKCl9fSksby50aWxlTGF5ZXI9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uVGlsZUxheWVyKHQsZSl9LG8uVGlsZUxheWVyLldNUz1vLlRpbGVMYXllci5leHRlbmQoe2RlZmF1bHRXbXNQYXJhbXM6e3NlcnZpY2U6IldNUyIscmVxdWVzdDoiR2V0TWFwIix2ZXJzaW9uOiIxLjEuMSIsbGF5ZXJzOiIiLHN0eWxlczoiIixmb3JtYXQ6ImltYWdlL2pwZWciLHRyYW5zcGFyZW50OiExfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7dGhpcy5fdXJsPXQ7dmFyIGk9by5leHRlbmQoe30sdGhpcy5kZWZhdWx0V21zUGFyYW1zKSxuPWUudGlsZVNpemV8fHRoaXMub3B0aW9ucy50aWxlU2l6ZTtpLndpZHRoPWkuaGVpZ2h0PWUuZGV0ZWN0UmV0aW5hJiZvLkJyb3dzZXIucmV0aW5hPzIqbjpuO2Zvcih2YXIgcyBpbiBlKXRoaXMub3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShzKXx8ImNycyI9PT1zfHwoaVtzXT1lW3NdKTt0aGlzLndtc1BhcmFtcz1pLG8uc2V0T3B0aW9ucyh0aGlzLGUpfSxvbkFkZDpmdW5jdGlvbih0KXt0aGlzLl9jcnM9dGhpcy5vcHRpb25zLmNyc3x8dC5vcHRpb25zLmNyczt2YXIgZT1wYXJzZUZsb2F0KHRoaXMud21zUGFyYW1zLnZlcnNpb24pPj0xLjM/ImNycyI6InNycyI7dGhpcy53bXNQYXJhbXNbZV09dGhpcy5fY3JzLmNvZGUsby5UaWxlTGF5ZXIucHJvdG90eXBlLm9uQWRkLmNhbGwodGhpcyx0KX0sZ2V0VGlsZVVybDpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAsaT10aGlzLm9wdGlvbnMudGlsZVNpemUsbj10Lm11bHRpcGx5QnkoaSkscz1uLmFkZChbaSxpXSksYT10aGlzLl9jcnMucHJvamVjdChlLnVucHJvamVjdChuLHQueikpLHI9dGhpcy5fY3JzLnByb2plY3QoZS51bnByb2plY3Qocyx0LnopKSxoPVthLngsci55LHIueCxhLnldLmpvaW4oIiwiKSxsPW8uVXRpbC50ZW1wbGF0ZSh0aGlzLl91cmwse3M6dGhpcy5fZ2V0U3ViZG9tYWluKHQpfSk7cmV0dXJuIGwrby5VdGlsLmdldFBhcmFtU3RyaW5nKHRoaXMud21zUGFyYW1zLGwsITApKyImQkJPWD0iK2h9LHNldFBhcmFtczpmdW5jdGlvbih0LGUpe3JldHVybiBvLmV4dGVuZCh0aGlzLndtc1BhcmFtcyx0KSxlfHx0aGlzLnJlZHJhdygpLHRoaXN9fSksby50aWxlTGF5ZXIud21zPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLlRpbGVMYXllci5XTVModCxlKX0sby5UaWxlTGF5ZXIuQ2FudmFzPW8uVGlsZUxheWVyLmV4dGVuZCh7b3B0aW9uczp7YXN5bmM6ITF9LGluaXRpYWxpemU6ZnVuY3Rpb24odCl7by5zZXRPcHRpb25zKHRoaXMsdCl9LHJlZHJhdzpmdW5jdGlvbigpe3RoaXMuX21hcCYmKHRoaXMuX3Jlc2V0KHtoYXJkOiEwfSksdGhpcy5fdXBkYXRlKCkpO2Zvcih2YXIgdCBpbiB0aGlzLl90aWxlcyl0aGlzLl9yZWRyYXdUaWxlKHRoaXMuX3RpbGVzW3RdKTtyZXR1cm4gdGhpc30sX3JlZHJhd1RpbGU6ZnVuY3Rpb24odCl7dGhpcy5kcmF3VGlsZSh0LHQuX3RpbGVQb2ludCx0aGlzLl9tYXAuX3pvb20pfSxfY3JlYXRlVGlsZTpmdW5jdGlvbigpe3ZhciB0PW8uRG9tVXRpbC5jcmVhdGUoImNhbnZhcyIsImxlYWZsZXQtdGlsZSIpO3JldHVybiB0LndpZHRoPXQuaGVpZ2h0PXRoaXMub3B0aW9ucy50aWxlU2l6ZSx0Lm9uc2VsZWN0c3RhcnQ9dC5vbm1vdXNlbW92ZT1vLlV0aWwuZmFsc2VGbix0fSxfbG9hZFRpbGU6ZnVuY3Rpb24odCxlKXt0Ll9sYXllcj10aGlzLHQuX3RpbGVQb2ludD1lLHRoaXMuX3JlZHJhd1RpbGUodCksdGhpcy5vcHRpb25zLmFzeW5jfHx0aGlzLnRpbGVEcmF3bih0KX0sZHJhd1RpbGU6ZnVuY3Rpb24oKXt9LHRpbGVEcmF3bjpmdW5jdGlvbih0KXt0aGlzLl90aWxlT25Mb2FkLmNhbGwodCl9fSksby50aWxlTGF5ZXIuY2FudmFzPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5UaWxlTGF5ZXIuQ2FudmFzKHQpfSxvLkltYWdlT3ZlcmxheT1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsb3B0aW9uczp7b3BhY2l0eToxfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSxpKXt0aGlzLl91cmw9dCx0aGlzLl9ib3VuZHM9by5sYXRMbmdCb3VuZHMoZSksby5zZXRPcHRpb25zKHRoaXMsaSl9LG9uQWRkOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10LHRoaXMuX2ltYWdlfHx0aGlzLl9pbml0SW1hZ2UoKSx0Ll9wYW5lcy5vdmVybGF5UGFuZS5hcHBlbmRDaGlsZCh0aGlzLl9pbWFnZSksdC5vbigidmlld3Jlc2V0Iix0aGlzLl9yZXNldCx0aGlzKSx0Lm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5Ccm93c2VyLmFueTNkJiZ0Lm9uKCJ6b29tYW5pbSIsdGhpcy5fYW5pbWF0ZVpvb20sdGhpcyksdGhpcy5fcmVzZXQoKX0sb25SZW1vdmU6ZnVuY3Rpb24odCl7dC5nZXRQYW5lcygpLm92ZXJsYXlQYW5lLnJlbW92ZUNoaWxkKHRoaXMuX2ltYWdlKSx0Lm9mZigidmlld3Jlc2V0Iix0aGlzLl9yZXNldCx0aGlzKSx0Lm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmdC5vZmYoInpvb21hbmltIix0aGlzLl9hbmltYXRlWm9vbSx0aGlzKX0sYWRkVG86ZnVuY3Rpb24odCl7cmV0dXJuIHQuYWRkTGF5ZXIodGhpcyksdGhpc30sc2V0T3BhY2l0eTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLm9wYWNpdHk9dCx0aGlzLl91cGRhdGVPcGFjaXR5KCksdGhpc30sYnJpbmdUb0Zyb250OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2ltYWdlJiZ0aGlzLl9tYXAuX3BhbmVzLm92ZXJsYXlQYW5lLmFwcGVuZENoaWxkKHRoaXMuX2ltYWdlKSx0aGlzfSxicmluZ1RvQmFjazpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcC5fcGFuZXMub3ZlcmxheVBhbmU7cmV0dXJuIHRoaXMuX2ltYWdlJiZ0Lmluc2VydEJlZm9yZSh0aGlzLl9pbWFnZSx0LmZpcnN0Q2hpbGQpLHRoaXN9LHNldFVybDpmdW5jdGlvbih0KXt0aGlzLl91cmw9dCx0aGlzLl9pbWFnZS5zcmM9dGhpcy5fdXJsfSxnZXRBdHRyaWJ1dGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMuYXR0cmlidXRpb259LF9pbml0SW1hZ2U6ZnVuY3Rpb24oKXt0aGlzLl9pbWFnZT1vLkRvbVV0aWwuY3JlYXRlKCJpbWciLCJsZWFmbGV0LWltYWdlLWxheWVyIiksdGhpcy5fbWFwLm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5Ccm93c2VyLmFueTNkP28uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9pbWFnZSwibGVhZmxldC16b29tLWFuaW1hdGVkIik6by5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2ltYWdlLCJsZWFmbGV0LXpvb20taGlkZSIpLHRoaXMuX3VwZGF0ZU9wYWNpdHkoKSxvLmV4dGVuZCh0aGlzLl9pbWFnZSx7Z2FsbGVyeWltZzoibm8iLG9uc2VsZWN0c3RhcnQ6by5VdGlsLmZhbHNlRm4sb25tb3VzZW1vdmU6by5VdGlsLmZhbHNlRm4sb25sb2FkOm8uYmluZCh0aGlzLl9vbkltYWdlTG9hZCx0aGlzKSxzcmM6dGhpcy5fdXJsfSl9LF9hbmltYXRlWm9vbTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAsaT10aGlzLl9pbWFnZSxuPWUuZ2V0Wm9vbVNjYWxlKHQuem9vbSkscz10aGlzLl9ib3VuZHMuZ2V0Tm9ydGhXZXN0KCksYT10aGlzLl9ib3VuZHMuZ2V0U291dGhFYXN0KCkscj1lLl9sYXRMbmdUb05ld0xheWVyUG9pbnQocyx0Lnpvb20sdC5jZW50ZXIpLGg9ZS5fbGF0TG5nVG9OZXdMYXllclBvaW50KGEsdC56b29tLHQuY2VudGVyKS5fc3VidHJhY3QociksbD1yLl9hZGQoaC5fbXVsdGlwbHlCeSguNSooMS0xL24pKSk7aS5zdHlsZVtvLkRvbVV0aWwuVFJBTlNGT1JNXT1vLkRvbVV0aWwuZ2V0VHJhbnNsYXRlU3RyaW5nKGwpKyIgc2NhbGUoIituKyIpICJ9LF9yZXNldDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2ltYWdlLGU9dGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9ib3VuZHMuZ2V0Tm9ydGhXZXN0KCkpLGk9dGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9ib3VuZHMuZ2V0U291dGhFYXN0KCkpLl9zdWJ0cmFjdChlKTtvLkRvbVV0aWwuc2V0UG9zaXRpb24odCxlKSx0LnN0eWxlLndpZHRoPWkueCsicHgiLHQuc3R5bGUuaGVpZ2h0PWkueSsicHgifSxfb25JbWFnZUxvYWQ6ZnVuY3Rpb24oKXt0aGlzLmZpcmUoImxvYWQiKX0sX3VwZGF0ZU9wYWNpdHk6ZnVuY3Rpb24oKXtvLkRvbVV0aWwuc2V0T3BhY2l0eSh0aGlzLl9pbWFnZSx0aGlzLm9wdGlvbnMub3BhY2l0eSl9fSksby5pbWFnZU92ZXJsYXk9ZnVuY3Rpb24odCxlLGkpe3JldHVybiBuZXcgby5JbWFnZU92ZXJsYXkodCxlLGkpfSxvLkljb249by5DbGFzcy5leHRlbmQoe29wdGlvbnM6e2NsYXNzTmFtZToiIn0saW5pdGlhbGl6ZTpmdW5jdGlvbih0KXtvLnNldE9wdGlvbnModGhpcyx0KX0sY3JlYXRlSWNvbjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fY3JlYXRlSWNvbigiaWNvbiIsdCl9LGNyZWF0ZVNoYWRvdzpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fY3JlYXRlSWNvbigic2hhZG93Iix0KX0sX2NyZWF0ZUljb246ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLl9nZXRJY29uVXJsKHQpO2lmKCFpKXtpZigiaWNvbiI9PT10KXRocm93IG5ldyBFcnJvcigiaWNvblVybCBub3Qgc2V0IGluIEljb24gb3B0aW9ucyAoc2VlIHRoZSBkb2NzKS4iKTtyZXR1cm4gbnVsbH12YXIgbjtyZXR1cm4gbj1lJiYiSU1HIj09PWUudGFnTmFtZT90aGlzLl9jcmVhdGVJbWcoaSxlKTp0aGlzLl9jcmVhdGVJbWcoaSksdGhpcy5fc2V0SWNvblN0eWxlcyhuLHQpLG59LF9zZXRJY29uU3R5bGVzOmZ1bmN0aW9uKHQsZSl7dmFyIGksbj10aGlzLm9wdGlvbnMscz1vLnBvaW50KG5bZSsiU2l6ZSJdKTtpPSJzaGFkb3ciPT09ZT9vLnBvaW50KG4uc2hhZG93QW5jaG9yfHxuLmljb25BbmNob3IpOm8ucG9pbnQobi5pY29uQW5jaG9yKSwhaSYmcyYmKGk9cy5kaXZpZGVCeSgyLCEwKSksdC5jbGFzc05hbWU9ImxlYWZsZXQtbWFya2VyLSIrZSsiICIrbi5jbGFzc05hbWUsaSYmKHQuc3R5bGUubWFyZ2luTGVmdD0taS54KyJweCIsdC5zdHlsZS5tYXJnaW5Ub3A9LWkueSsicHgiKSxzJiYodC5zdHlsZS53aWR0aD1zLngrInB4Iix0LnN0eWxlLmhlaWdodD1zLnkrInB4Iil9LF9jcmVhdGVJbWc6ZnVuY3Rpb24odCxpKXtyZXR1cm4gby5Ccm93c2VyLmllNj8oaXx8KGk9ZS5jcmVhdGVFbGVtZW50KCJkaXYiKSksaS5zdHlsZS5maWx0ZXI9J3Byb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5BbHBoYUltYWdlTG9hZGVyKHNyYz0iJyt0KyciKScpOihpfHwoaT1lLmNyZWF0ZUVsZW1lbnQoImltZyIpKSxpLnNyYz10KSxpfSxfZ2V0SWNvblVybDpmdW5jdGlvbih0KXtyZXR1cm4gby5Ccm93c2VyLnJldGluYSYmdGhpcy5vcHRpb25zW3QrIlJldGluYVVybCJdP3RoaXMub3B0aW9uc1t0KyJSZXRpbmFVcmwiXTp0aGlzLm9wdGlvbnNbdCsiVXJsIl19fSksby5pY29uPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5JY29uKHQpfSxvLkljb24uRGVmYXVsdD1vLkljb24uZXh0ZW5kKHtvcHRpb25zOntpY29uU2l6ZTpbMjUsNDFdLGljb25BbmNob3I6WzEyLDQxXSxwb3B1cEFuY2hvcjpbMSwtMzRdLHNoYWRvd1NpemU6WzQxLDQxXX0sX2dldEljb25Vcmw6ZnVuY3Rpb24odCl7dmFyIGU9dCsiVXJsIjtpZih0aGlzLm9wdGlvbnNbZV0pcmV0dXJuIHRoaXMub3B0aW9uc1tlXTtvLkJyb3dzZXIucmV0aW5hJiYiaWNvbiI9PT10JiYodCs9Ii0yeCIpO3ZhciBpPW8uSWNvbi5EZWZhdWx0LmltYWdlUGF0aDtpZighaSl0aHJvdyBuZXcgRXJyb3IoIkNvdWxkbid0IGF1dG9kZXRlY3QgTC5JY29uLkRlZmF1bHQuaW1hZ2VQYXRoLCBzZXQgaXQgbWFudWFsbHkuIik7cmV0dXJuIGkrIi9tYXJrZXItIit0KyIucG5nIn19KSxvLkljb24uRGVmYXVsdC5pbWFnZVBhdGg9ZnVuY3Rpb24oKXt2YXIgdCxpLG4sbyxzLGE9ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0Iikscj0vW1wvXl1sZWFmbGV0W1wtXC5fXT8oW1x3XC1cLl9dKilcLmpzXD8/Lztmb3IodD0wLGk9YS5sZW5ndGg7aT50O3QrKylpZihuPWFbdF0uc3JjLG89bi5tYXRjaChyKSlyZXR1cm4gcz1uLnNwbGl0KHIpWzBdLChzP3MrIi8iOiIiKSsiaW1hZ2VzIn0oKSxvLk1hcmtlcj1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsb3B0aW9uczp7aWNvbjpuZXcgby5JY29uLkRlZmF1bHQsdGl0bGU6IiIsY2xpY2thYmxlOiEwLGRyYWdnYWJsZTohMSxrZXlib2FyZDohMCx6SW5kZXhPZmZzZXQ6MCxvcGFjaXR5OjEscmlzZU9uSG92ZXI6ITEscmlzZU9mZnNldDoyNTB9LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlKXtvLnNldE9wdGlvbnModGhpcyxlKSx0aGlzLl9sYXRsbmc9by5sYXRMbmcodCl9LG9uQWRkOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10LHQub24oInZpZXdyZXNldCIsdGhpcy51cGRhdGUsdGhpcyksdGhpcy5faW5pdEljb24oKSx0aGlzLnVwZGF0ZSgpLHRoaXMuZmlyZSgiYWRkIiksdC5vcHRpb25zLnpvb21BbmltYXRpb24mJnQub3B0aW9ucy5tYXJrZXJab29tQW5pbWF0aW9uJiZ0Lm9uKCJ6b29tYW5pbSIsdGhpcy5fYW5pbWF0ZVpvb20sdGhpcyl9LGFkZFRvOmZ1bmN0aW9uKHQpe3JldHVybiB0LmFkZExheWVyKHRoaXMpLHRoaXN9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3RoaXMuZHJhZ2dpbmcmJnRoaXMuZHJhZ2dpbmcuZGlzYWJsZSgpLHRoaXMuX3JlbW92ZUljb24oKSx0aGlzLl9yZW1vdmVTaGFkb3coKSx0aGlzLmZpcmUoInJlbW92ZSIpLHQub2ZmKHt2aWV3cmVzZXQ6dGhpcy51cGRhdGUsem9vbWFuaW06dGhpcy5fYW5pbWF0ZVpvb219LHRoaXMpLHRoaXMuX21hcD1udWxsfSxnZXRMYXRMbmc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbGF0bG5nfSxzZXRMYXRMbmc6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZz1vLmxhdExuZyh0KSx0aGlzLnVwZGF0ZSgpLHRoaXMuZmlyZSgibW92ZSIse2xhdGxuZzp0aGlzLl9sYXRsbmd9KX0sc2V0WkluZGV4T2Zmc2V0OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9wdGlvbnMuekluZGV4T2Zmc2V0PXQsdGhpcy51cGRhdGUoKSx0aGlzfSxzZXRJY29uOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9wdGlvbnMuaWNvbj10LHRoaXMuX21hcCYmKHRoaXMuX2luaXRJY29uKCksdGhpcy51cGRhdGUoKSksdGhpcy5fcG9wdXAmJnRoaXMuYmluZFBvcHVwKHRoaXMuX3BvcHVwKSx0aGlzfSx1cGRhdGU6ZnVuY3Rpb24oKXtpZih0aGlzLl9pY29uKXt2YXIgdD10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2xhdGxuZykucm91bmQoKTt0aGlzLl9zZXRQb3ModCl9cmV0dXJuIHRoaXN9LF9pbml0SWNvbjpmdW5jdGlvbigpe3ZhciB0PXRoaXMub3B0aW9ucyxlPXRoaXMuX21hcCxpPWUub3B0aW9ucy56b29tQW5pbWF0aW9uJiZlLm9wdGlvbnMubWFya2VyWm9vbUFuaW1hdGlvbixuPWk/ImxlYWZsZXQtem9vbS1hbmltYXRlZCI6ImxlYWZsZXQtem9vbS1oaWRlIixzPXQuaWNvbi5jcmVhdGVJY29uKHRoaXMuX2ljb24pLGE9ITE7cyE9PXRoaXMuX2ljb24mJih0aGlzLl9pY29uJiZ0aGlzLl9yZW1vdmVJY29uKCksYT0hMCx0LnRpdGxlJiYocy50aXRsZT10LnRpdGxlKSksby5Eb21VdGlsLmFkZENsYXNzKHMsbiksdC5rZXlib2FyZCYmKHMudGFiSW5kZXg9IjAiKSx0aGlzLl9pY29uPXMsdGhpcy5faW5pdEludGVyYWN0aW9uKCksdC5yaXNlT25Ib3ZlciYmby5Eb21FdmVudC5vbihzLCJtb3VzZW92ZXIiLHRoaXMuX2JyaW5nVG9Gcm9udCx0aGlzKS5vbihzLCJtb3VzZW91dCIsdGhpcy5fcmVzZXRaSW5kZXgsdGhpcyk7dmFyIHI9dC5pY29uLmNyZWF0ZVNoYWRvdyh0aGlzLl9zaGFkb3cpLGg9ITE7ciE9PXRoaXMuX3NoYWRvdyYmKHRoaXMuX3JlbW92ZVNoYWRvdygpLGg9ITApLHImJm8uRG9tVXRpbC5hZGRDbGFzcyhyLG4pLHRoaXMuX3NoYWRvdz1yLHQub3BhY2l0eTwxJiZ0aGlzLl91cGRhdGVPcGFjaXR5KCk7dmFyIGw9dGhpcy5fbWFwLl9wYW5lczthJiZsLm1hcmtlclBhbmUuYXBwZW5kQ2hpbGQodGhpcy5faWNvbiksciYmaCYmbC5zaGFkb3dQYW5lLmFwcGVuZENoaWxkKHRoaXMuX3NoYWRvdyl9LF9yZW1vdmVJY29uOmZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLnJpc2VPbkhvdmVyJiZvLkRvbUV2ZW50Lm9mZih0aGlzLl9pY29uLCJtb3VzZW92ZXIiLHRoaXMuX2JyaW5nVG9Gcm9udCkub2ZmKHRoaXMuX2ljb24sIm1vdXNlb3V0Iix0aGlzLl9yZXNldFpJbmRleCksdGhpcy5fbWFwLl9wYW5lcy5tYXJrZXJQYW5lLnJlbW92ZUNoaWxkKHRoaXMuX2ljb24pLHRoaXMuX2ljb249bnVsbH0sX3JlbW92ZVNoYWRvdzpmdW5jdGlvbigpe3RoaXMuX3NoYWRvdyYmdGhpcy5fbWFwLl9wYW5lcy5zaGFkb3dQYW5lLnJlbW92ZUNoaWxkKHRoaXMuX3NoYWRvdyksdGhpcy5fc2hhZG93PW51bGx9LF9zZXRQb3M6ZnVuY3Rpb24odCl7by5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX2ljb24sdCksdGhpcy5fc2hhZG93JiZvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fc2hhZG93LHQpLHRoaXMuX3pJbmRleD10LnkrdGhpcy5vcHRpb25zLnpJbmRleE9mZnNldCx0aGlzLl9yZXNldFpJbmRleCgpfSxfdXBkYXRlWkluZGV4OmZ1bmN0aW9uKHQpe3RoaXMuX2ljb24uc3R5bGUuekluZGV4PXRoaXMuX3pJbmRleCt0fSxfYW5pbWF0ZVpvb206ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fbWFwLl9sYXRMbmdUb05ld0xheWVyUG9pbnQodGhpcy5fbGF0bG5nLHQuem9vbSx0LmNlbnRlcik7dGhpcy5fc2V0UG9zKGUpfSxfaW5pdEludGVyYWN0aW9uOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmNsaWNrYWJsZSl7dmFyIHQ9dGhpcy5faWNvbixlPVsiZGJsY2xpY2siLCJtb3VzZWRvd24iLCJtb3VzZW92ZXIiLCJtb3VzZW91dCIsImNvbnRleHRtZW51Il07by5Eb21VdGlsLmFkZENsYXNzKHQsImxlYWZsZXQtY2xpY2thYmxlIiksby5Eb21FdmVudC5vbih0LCJjbGljayIsdGhpcy5fb25Nb3VzZUNsaWNrLHRoaXMpLG8uRG9tRXZlbnQub24odCwia2V5cHJlc3MiLHRoaXMuX29uS2V5UHJlc3MsdGhpcyk7Zm9yKHZhciBpPTA7aTxlLmxlbmd0aDtpKyspby5Eb21FdmVudC5vbih0LGVbaV0sdGhpcy5fZmlyZU1vdXNlRXZlbnQsdGhpcyk7by5IYW5kbGVyLk1hcmtlckRyYWcmJih0aGlzLmRyYWdnaW5nPW5ldyBvLkhhbmRsZXIuTWFya2VyRHJhZyh0aGlzKSx0aGlzLm9wdGlvbnMuZHJhZ2dhYmxlJiZ0aGlzLmRyYWdnaW5nLmVuYWJsZSgpKX19LF9vbk1vdXNlQ2xpY2s6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5kcmFnZ2luZyYmdGhpcy5kcmFnZ2luZy5tb3ZlZCgpOyh0aGlzLmhhc0V2ZW50TGlzdGVuZXJzKHQudHlwZSl8fGUpJiZvLkRvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbih0KSxlfHwodGhpcy5kcmFnZ2luZyYmdGhpcy5kcmFnZ2luZy5fZW5hYmxlZHx8IXRoaXMuX21hcC5kcmFnZ2luZ3x8IXRoaXMuX21hcC5kcmFnZ2luZy5tb3ZlZCgpKSYmdGhpcy5maXJlKHQudHlwZSx7b3JpZ2luYWxFdmVudDp0LGxhdGxuZzp0aGlzLl9sYXRsbmd9KX0sX29uS2V5UHJlc3M6ZnVuY3Rpb24odCl7MTM9PT10LmtleUNvZGUmJnRoaXMuZmlyZSgiY2xpY2siLHtvcmlnaW5hbEV2ZW50OnQsbGF0bG5nOnRoaXMuX2xhdGxuZ30pfSxfZmlyZU1vdXNlRXZlbnQ6ZnVuY3Rpb24odCl7dGhpcy5maXJlKHQudHlwZSx7b3JpZ2luYWxFdmVudDp0LGxhdGxuZzp0aGlzLl9sYXRsbmd9KSwiY29udGV4dG1lbnUiPT09dC50eXBlJiZ0aGlzLmhhc0V2ZW50TGlzdGVuZXJzKHQudHlwZSkmJm8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCksIm1vdXNlZG93biIhPT10LnR5cGU/by5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24odCk6by5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCh0KX0sc2V0T3BhY2l0eTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLm9wYWNpdHk9dCx0aGlzLl9tYXAmJnRoaXMuX3VwZGF0ZU9wYWNpdHkoKSx0aGlzfSxfdXBkYXRlT3BhY2l0eTpmdW5jdGlvbigpe28uRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2ljb24sdGhpcy5vcHRpb25zLm9wYWNpdHkpLHRoaXMuX3NoYWRvdyYmby5Eb21VdGlsLnNldE9wYWNpdHkodGhpcy5fc2hhZG93LHRoaXMub3B0aW9ucy5vcGFjaXR5KX0sX2JyaW5nVG9Gcm9udDpmdW5jdGlvbigpe3RoaXMuX3VwZGF0ZVpJbmRleCh0aGlzLm9wdGlvbnMucmlzZU9mZnNldCl9LF9yZXNldFpJbmRleDpmdW5jdGlvbigpe3RoaXMuX3VwZGF0ZVpJbmRleCgwKX19KSxvLm1hcmtlcj1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5NYXJrZXIodCxlKX0sby5EaXZJY29uPW8uSWNvbi5leHRlbmQoe29wdGlvbnM6e2ljb25TaXplOlsxMiwxMl0sY2xhc3NOYW1lOiJsZWFmbGV0LWRpdi1pY29uIixodG1sOiExfSxjcmVhdGVJY29uOmZ1bmN0aW9uKHQpe3ZhciBpPXQmJiJESVYiPT09dC50YWdOYW1lP3Q6ZS5jcmVhdGVFbGVtZW50KCJkaXYiKSxuPXRoaXMub3B0aW9ucztyZXR1cm4gaS5pbm5lckhUTUw9bi5odG1sIT09ITE/bi5odG1sOiIiLG4uYmdQb3MmJihpLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbj0tbi5iZ1Bvcy54KyJweCAiKy1uLmJnUG9zLnkrInB4IiksdGhpcy5fc2V0SWNvblN0eWxlcyhpLCJpY29uIiksaX0sY3JlYXRlU2hhZG93OmZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9fSksby5kaXZJY29uPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5EaXZJY29uKHQpfSxvLk1hcC5tZXJnZU9wdGlvbnMoe2Nsb3NlUG9wdXBPbkNsaWNrOiEwfSksby5Qb3B1cD1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsb3B0aW9uczp7bWluV2lkdGg6NTAsbWF4V2lkdGg6MzAwLGF1dG9QYW46ITAsY2xvc2VCdXR0b246ITAsb2Zmc2V0OlswLDddLGF1dG9QYW5QYWRkaW5nOls1LDVdLGtlZXBJblZpZXc6ITEsY2xhc3NOYW1lOiIiLHpvb21BbmltYXRpb246ITB9LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlKXtvLnNldE9wdGlvbnModGhpcyx0KSx0aGlzLl9zb3VyY2U9ZSx0aGlzLl9hbmltYXRlZD1vLkJyb3dzZXIuYW55M2QmJnRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uLHRoaXMuX2lzT3Blbj0hMX0sb25BZGQ6ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXQsdGhpcy5fY29udGFpbmVyfHx0aGlzLl9pbml0TGF5b3V0KCksdGhpcy5fdXBkYXRlQ29udGVudCgpO3ZhciBlPXQub3B0aW9ucy5mYWRlQW5pbWF0aW9uO2UmJm8uRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2NvbnRhaW5lciwwKSx0Ll9wYW5lcy5wb3B1cFBhbmUuYXBwZW5kQ2hpbGQodGhpcy5fY29udGFpbmVyKSx0Lm9uKHRoaXMuX2dldEV2ZW50cygpLHRoaXMpLHRoaXMudXBkYXRlKCksZSYmby5Eb21VdGlsLnNldE9wYWNpdHkodGhpcy5fY29udGFpbmVyLDEpLHRoaXMuZmlyZSgib3BlbiIpLHQuZmlyZSgicG9wdXBvcGVuIix7cG9wdXA6dGhpc30pLHRoaXMuX3NvdXJjZSYmdGhpcy5fc291cmNlLmZpcmUoInBvcHVwb3BlbiIse3BvcHVwOnRoaXN9KX0sYWRkVG86ZnVuY3Rpb24odCl7cmV0dXJuIHQuYWRkTGF5ZXIodGhpcyksdGhpc30sb3Blbk9uOmZ1bmN0aW9uKHQpe3JldHVybiB0Lm9wZW5Qb3B1cCh0aGlzKSx0aGlzfSxvblJlbW92ZTpmdW5jdGlvbih0KXt0Ll9wYW5lcy5wb3B1cFBhbmUucmVtb3ZlQ2hpbGQodGhpcy5fY29udGFpbmVyKSxvLlV0aWwuZmFsc2VGbih0aGlzLl9jb250YWluZXIub2Zmc2V0V2lkdGgpLHQub2ZmKHRoaXMuX2dldEV2ZW50cygpLHRoaXMpLHQub3B0aW9ucy5mYWRlQW5pbWF0aW9uJiZvLkRvbVV0aWwuc2V0T3BhY2l0eSh0aGlzLl9jb250YWluZXIsMCksdGhpcy5fbWFwPW51bGwsdGhpcy5maXJlKCJjbG9zZSIpLHQuZmlyZSgicG9wdXBjbG9zZSIse3BvcHVwOnRoaXN9KSx0aGlzLl9zb3VyY2UmJnRoaXMuX3NvdXJjZS5maXJlKCJwb3B1cGNsb3NlIix7cG9wdXA6dGhpc30pfSxzZXRMYXRMbmc6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZz1vLmxhdExuZyh0KSx0aGlzLnVwZGF0ZSgpLHRoaXN9LHNldENvbnRlbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2NvbnRlbnQ9dCx0aGlzLnVwZGF0ZSgpLHRoaXN9LHVwZGF0ZTpmdW5jdGlvbigpe3RoaXMuX21hcCYmKHRoaXMuX2NvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5PSJoaWRkZW4iLHRoaXMuX3VwZGF0ZUNvbnRlbnQoKSx0aGlzLl91cGRhdGVMYXlvdXQoKSx0aGlzLl91cGRhdGVQb3NpdGlvbigpLHRoaXMuX2NvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5PSIiLHRoaXMuX2FkanVzdFBhbigpKX0sX2dldEV2ZW50czpmdW5jdGlvbigpe3ZhciB0PXt2aWV3cmVzZXQ6dGhpcy5fdXBkYXRlUG9zaXRpb259O3JldHVybiB0aGlzLl9hbmltYXRlZCYmKHQuem9vbWFuaW09dGhpcy5fem9vbUFuaW1hdGlvbiksKCJjbG9zZU9uQ2xpY2siaW4gdGhpcy5vcHRpb25zP3RoaXMub3B0aW9ucy5jbG9zZU9uQ2xpY2s6dGhpcy5fbWFwLm9wdGlvbnMuY2xvc2VQb3B1cE9uQ2xpY2spJiYodC5wcmVjbGljaz10aGlzLl9jbG9zZSksdGhpcy5vcHRpb25zLmtlZXBJblZpZXcmJih0Lm1vdmVlbmQ9dGhpcy5fYWRqdXN0UGFuKSx0fSxfY2xvc2U6ZnVuY3Rpb24oKXt0aGlzLl9tYXAmJnRoaXMuX21hcC5jbG9zZVBvcHVwKHRoaXMpfSxfaW5pdExheW91dDpmdW5jdGlvbigpe3ZhciB0LGU9ImxlYWZsZXQtcG9wdXAiLGk9ZSsiICIrdGhpcy5vcHRpb25zLmNsYXNzTmFtZSsiIGxlYWZsZXQtem9vbS0iKyh0aGlzLl9hbmltYXRlZD8iYW5pbWF0ZWQiOiJoaWRlIiksbj10aGlzLl9jb250YWluZXI9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixpKTt0aGlzLm9wdGlvbnMuY2xvc2VCdXR0b24mJih0PXRoaXMuX2Nsb3NlQnV0dG9uPW8uRG9tVXRpbC5jcmVhdGUoImEiLGUrIi1jbG9zZS1idXR0b24iLG4pLHQuaHJlZj0iI2Nsb3NlIix0LmlubmVySFRNTD0iJiMyMTU7IixvLkRvbUV2ZW50LmRpc2FibGVDbGlja1Byb3BhZ2F0aW9uKHQpLG8uRG9tRXZlbnQub24odCwiY2xpY2siLHRoaXMuX29uQ2xvc2VCdXR0b25DbGljayx0aGlzKSk7dmFyIHM9dGhpcy5fd3JhcHBlcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGUrIi1jb250ZW50LXdyYXBwZXIiLG4pO28uRG9tRXZlbnQuZGlzYWJsZUNsaWNrUHJvcGFnYXRpb24ocyksdGhpcy5fY29udGVudE5vZGU9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKyItY29udGVudCIscyksby5Eb21FdmVudC5vbih0aGlzLl9jb250ZW50Tm9kZSwibW91c2V3aGVlbCIsby5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pLG8uRG9tRXZlbnQub24odGhpcy5fY29udGVudE5vZGUsIk1vek1vdXNlUGl4ZWxTY3JvbGwiLG8uRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKSxvLkRvbUV2ZW50Lm9uKHMsImNvbnRleHRtZW51IixvLkRvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbiksdGhpcy5fdGlwQ29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoImRpdiIsZSsiLXRpcC1jb250YWluZXIiLG4pLHRoaXMuX3RpcD1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGUrIi10aXAiLHRoaXMuX3RpcENvbnRhaW5lcil9LF91cGRhdGVDb250ZW50OmZ1bmN0aW9uKCl7aWYodGhpcy5fY29udGVudCl7aWYoInN0cmluZyI9PXR5cGVvZiB0aGlzLl9jb250ZW50KXRoaXMuX2NvbnRlbnROb2RlLmlubmVySFRNTD10aGlzLl9jb250ZW50O2Vsc2V7Zm9yKDt0aGlzLl9jb250ZW50Tm9kZS5oYXNDaGlsZE5vZGVzKCk7KXRoaXMuX2NvbnRlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRlbnROb2RlLmZpcnN0Q2hpbGQpO3RoaXMuX2NvbnRlbnROb2RlLmFwcGVuZENoaWxkKHRoaXMuX2NvbnRlbnQpfXRoaXMuZmlyZSgiY29udGVudHVwZGF0ZSIpfX0sX3VwZGF0ZUxheW91dDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2NvbnRlbnROb2RlLGU9dC5zdHlsZTtlLndpZHRoPSIiLGUud2hpdGVTcGFjZT0ibm93cmFwIjt2YXIgaT10Lm9mZnNldFdpZHRoO2k9TWF0aC5taW4oaSx0aGlzLm9wdGlvbnMubWF4V2lkdGgpLGk9TWF0aC5tYXgoaSx0aGlzLm9wdGlvbnMubWluV2lkdGgpLGUud2lkdGg9aSsxKyJweCIsZS53aGl0ZVNwYWNlPSIiLGUuaGVpZ2h0PSIiO3ZhciBuPXQub2Zmc2V0SGVpZ2h0LHM9dGhpcy5vcHRpb25zLm1heEhlaWdodCxhPSJsZWFmbGV0LXBvcHVwLXNjcm9sbGVkIjtzJiZuPnM/KGUuaGVpZ2h0PXMrInB4IixvLkRvbVV0aWwuYWRkQ2xhc3ModCxhKSk6by5Eb21VdGlsLnJlbW92ZUNsYXNzKHQsYSksdGhpcy5fY29udGFpbmVyV2lkdGg9dGhpcy5fY29udGFpbmVyLm9mZnNldFdpZHRofSxfdXBkYXRlUG9zaXRpb246ZnVuY3Rpb24oKXtpZih0aGlzLl9tYXApe3ZhciB0PXRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5fbGF0bG5nKSxlPXRoaXMuX2FuaW1hdGVkLGk9by5wb2ludCh0aGlzLm9wdGlvbnMub2Zmc2V0KTtlJiZvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fY29udGFpbmVyLHQpLHRoaXMuX2NvbnRhaW5lckJvdHRvbT0taS55LShlPzA6dC55KSx0aGlzLl9jb250YWluZXJMZWZ0PS1NYXRoLnJvdW5kKHRoaXMuX2NvbnRhaW5lcldpZHRoLzIpK2kueCsoZT8wOnQueCksdGhpcy5fY29udGFpbmVyLnN0eWxlLmJvdHRvbT10aGlzLl9jb250YWluZXJCb3R0b20rInB4Iix0aGlzLl9jb250YWluZXIuc3R5bGUubGVmdD10aGlzLl9jb250YWluZXJMZWZ0KyJweCJ9fSxfem9vbUFuaW1hdGlvbjpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAuX2xhdExuZ1RvTmV3TGF5ZXJQb2ludCh0aGlzLl9sYXRsbmcsdC56b29tLHQuY2VudGVyKTtvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fY29udGFpbmVyLGUpfSxfYWRqdXN0UGFuOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmF1dG9QYW4pe3ZhciB0PXRoaXMuX21hcCxlPXRoaXMuX2NvbnRhaW5lci5vZmZzZXRIZWlnaHQsaT10aGlzLl9jb250YWluZXJXaWR0aCxuPW5ldyBvLlBvaW50KHRoaXMuX2NvbnRhaW5lckxlZnQsLWUtdGhpcy5fY29udGFpbmVyQm90dG9tKTt0aGlzLl9hbmltYXRlZCYmbi5fYWRkKG8uRG9tVXRpbC5nZXRQb3NpdGlvbih0aGlzLl9jb250YWluZXIpKTt2YXIgcz10LmxheWVyUG9pbnRUb0NvbnRhaW5lclBvaW50KG4pLGE9by5wb2ludCh0aGlzLm9wdGlvbnMuYXV0b1BhblBhZGRpbmcpLHI9by5wb2ludCh0aGlzLm9wdGlvbnMuYXV0b1BhblBhZGRpbmdUb3BMZWZ0fHxhKSxoPW8ucG9pbnQodGhpcy5vcHRpb25zLmF1dG9QYW5QYWRkaW5nQm90dG9tUmlnaHR8fGEpLGw9dC5nZXRTaXplKCksdT0wLGM9MDtzLngraStoLng+bC54JiYodT1zLngraS1sLngraC54KSxzLngtdS1yLng8MCYmKHU9cy54LXIueCkscy55K2UraC55PmwueSYmKGM9cy55K2UtbC55K2gueSkscy55LWMtci55PDAmJihjPXMueS1yLnkpLCh1fHxjKSYmdC5maXJlKCJhdXRvcGFuc3RhcnQiKS5wYW5CeShbdSxjXSl9fSxfb25DbG9zZUJ1dHRvbkNsaWNrOmZ1bmN0aW9uKHQpe3RoaXMuX2Nsb3NlKCksby5Eb21FdmVudC5zdG9wKHQpfX0pLG8ucG9wdXA9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uUG9wdXAodCxlKX0sby5NYXAuaW5jbHVkZSh7b3BlblBvcHVwOmZ1bmN0aW9uKHQsZSxpKXtpZih0aGlzLmNsb3NlUG9wdXAoKSwhKHQgaW5zdGFuY2VvZiBvLlBvcHVwKSl7dmFyIG49dDt0PW5ldyBvLlBvcHVwKGkpLnNldExhdExuZyhlKS5zZXRDb250ZW50KG4pfXJldHVybiB0Ll9pc09wZW49ITAsdGhpcy5fcG9wdXA9dCx0aGlzLmFkZExheWVyKHQpfSxjbG9zZVBvcHVwOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0IT09dGhpcy5fcG9wdXB8fCh0PXRoaXMuX3BvcHVwLHRoaXMuX3BvcHVwPW51bGwpLHQmJih0aGlzLnJlbW92ZUxheWVyKHQpLHQuX2lzT3Blbj0hMSksdGhpc319KSxvLk1hcmtlci5pbmNsdWRlKHtvcGVuUG9wdXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcG9wdXAmJnRoaXMuX21hcCYmIXRoaXMuX21hcC5oYXNMYXllcih0aGlzLl9wb3B1cCkmJih0aGlzLl9wb3B1cC5zZXRMYXRMbmcodGhpcy5fbGF0bG5nKSx0aGlzLl9tYXAub3BlblBvcHVwKHRoaXMuX3BvcHVwKSksdGhpc30sY2xvc2VQb3B1cDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wb3B1cCYmdGhpcy5fcG9wdXAuX2Nsb3NlKCksdGhpc30sdG9nZ2xlUG9wdXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcG9wdXAmJih0aGlzLl9wb3B1cC5faXNPcGVuP3RoaXMuY2xvc2VQb3B1cCgpOnRoaXMub3BlblBvcHVwKCkpLHRoaXN9LGJpbmRQb3B1cDpmdW5jdGlvbih0LGUpe3ZhciBpPW8ucG9pbnQodGhpcy5vcHRpb25zLmljb24ub3B0aW9ucy5wb3B1cEFuY2hvcnx8WzAsMF0pO3JldHVybiBpPWkuYWRkKG8uUG9wdXAucHJvdG90eXBlLm9wdGlvbnMub2Zmc2V0KSxlJiZlLm9mZnNldCYmKGk9aS5hZGQoZS5vZmZzZXQpKSxlPW8uZXh0ZW5kKHtvZmZzZXQ6aX0sZSksdGhpcy5fcG9wdXBIYW5kbGVyc0FkZGVkfHwodGhpcy5vbigiY2xpY2siLHRoaXMudG9nZ2xlUG9wdXAsdGhpcykub24oInJlbW92ZSIsdGhpcy5jbG9zZVBvcHVwLHRoaXMpLm9uKCJtb3ZlIix0aGlzLl9tb3ZlUG9wdXAsdGhpcyksdGhpcy5fcG9wdXBIYW5kbGVyc0FkZGVkPSEwKSx0IGluc3RhbmNlb2Ygby5Qb3B1cD8oby5zZXRPcHRpb25zKHQsZSksdGhpcy5fcG9wdXA9dCk6dGhpcy5fcG9wdXA9bmV3IG8uUG9wdXAoZSx0aGlzKS5zZXRDb250ZW50KHQpLHRoaXN9LHNldFBvcHVwQ29udGVudDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fcG9wdXAmJnRoaXMuX3BvcHVwLnNldENvbnRlbnQodCksdGhpc30sdW5iaW5kUG9wdXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcG9wdXAmJih0aGlzLl9wb3B1cD1udWxsLHRoaXMub2ZmKCJjbGljayIsdGhpcy50b2dnbGVQb3B1cCx0aGlzKS5vZmYoInJlbW92ZSIsdGhpcy5jbG9zZVBvcHVwLHRoaXMpLm9mZigibW92ZSIsdGhpcy5fbW92ZVBvcHVwLHRoaXMpLHRoaXMuX3BvcHVwSGFuZGxlcnNBZGRlZD0hMSksdGhpc30sX21vdmVQb3B1cDpmdW5jdGlvbih0KXt0aGlzLl9wb3B1cC5zZXRMYXRMbmcodC5sYXRsbmcpfX0pLG8uTGF5ZXJHcm91cD1vLkNsYXNzLmV4dGVuZCh7aW5pdGlhbGl6ZTpmdW5jdGlvbih0KXt0aGlzLl9sYXllcnM9e307dmFyIGUsaTtpZih0KWZvcihlPTAsaT10Lmxlbmd0aDtpPmU7ZSsrKXRoaXMuYWRkTGF5ZXIodFtlXSl9LGFkZExheWVyOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuZ2V0TGF5ZXJJZCh0KTtyZXR1cm4gdGhpcy5fbGF5ZXJzW2VdPXQsdGhpcy5fbWFwJiZ0aGlzLl9tYXAuYWRkTGF5ZXIodCksdGhpc30scmVtb3ZlTGF5ZXI6ZnVuY3Rpb24odCl7dmFyIGU9dCBpbiB0aGlzLl9sYXllcnM/dDp0aGlzLmdldExheWVySWQodCk7cmV0dXJuIHRoaXMuX21hcCYmdGhpcy5fbGF5ZXJzW2VdJiZ0aGlzLl9tYXAucmVtb3ZlTGF5ZXIodGhpcy5fbGF5ZXJzW2VdKSxkZWxldGUgdGhpcy5fbGF5ZXJzW2VdLHRoaXN9LGhhc0xheWVyOmZ1bmN0aW9uKHQpe3JldHVybiB0P3QgaW4gdGhpcy5fbGF5ZXJzfHx0aGlzLmdldExheWVySWQodClpbiB0aGlzLl9sYXllcnM6ITF9LGNsZWFyTGF5ZXJzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaExheWVyKHRoaXMucmVtb3ZlTGF5ZXIsdGhpcyksdGhpc30saW52b2tlOmZ1bmN0aW9uKHQpe3ZhciBlLGksbj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKGUgaW4gdGhpcy5fbGF5ZXJzKWk9dGhpcy5fbGF5ZXJzW2VdLGlbdF0mJmlbdF0uYXBwbHkoaSxuKTtyZXR1cm4gdGhpc30sb25BZGQ6ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXQsdGhpcy5lYWNoTGF5ZXIodC5hZGRMYXllcix0KX0sb25SZW1vdmU6ZnVuY3Rpb24odCl7dGhpcy5lYWNoTGF5ZXIodC5yZW1vdmVMYXllcix0KSx0aGlzLl9tYXA9bnVsbH0sYWRkVG86ZnVuY3Rpb24odCl7cmV0dXJuIHQuYWRkTGF5ZXIodGhpcyksdGhpc30sZWFjaExheWVyOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBpIGluIHRoaXMuX2xheWVycyl0LmNhbGwoZSx0aGlzLl9sYXllcnNbaV0pO3JldHVybiB0aGlzfSxnZXRMYXllcjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fbGF5ZXJzW3RdfSxnZXRMYXllcnM6ZnVuY3Rpb24oKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gdGhpcy5fbGF5ZXJzKXQucHVzaCh0aGlzLl9sYXllcnNbZV0pO3JldHVybiB0fSxzZXRaSW5kZXg6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuaW52b2tlKCJzZXRaSW5kZXgiLHQpfSxnZXRMYXllcklkOmZ1bmN0aW9uKHQpe3JldHVybiBvLnN0YW1wKHQpfX0pLG8ubGF5ZXJHcm91cD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uTGF5ZXJHcm91cCh0KX0sby5GZWF0dXJlR3JvdXA9by5MYXllckdyb3VwLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMsc3RhdGljczp7RVZFTlRTOiJjbGljayBkYmxjbGljayBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2Vtb3ZlIGNvbnRleHRtZW51IHBvcHVwb3BlbiBwb3B1cGNsb3NlIn0sYWRkTGF5ZXI6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuaGFzTGF5ZXIodCk/dGhpczooIm9uImluIHQmJnQub24oby5GZWF0dXJlR3JvdXAuRVZFTlRTLHRoaXMuX3Byb3BhZ2F0ZUV2ZW50LHRoaXMpLG8uTGF5ZXJHcm91cC5wcm90b3R5cGUuYWRkTGF5ZXIuY2FsbCh0aGlzLHQpLHRoaXMuX3BvcHVwQ29udGVudCYmdC5iaW5kUG9wdXAmJnQuYmluZFBvcHVwKHRoaXMuX3BvcHVwQ29udGVudCx0aGlzLl9wb3B1cE9wdGlvbnMpLHRoaXMuZmlyZSgibGF5ZXJhZGQiLHtsYXllcjp0fSkpfSxyZW1vdmVMYXllcjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5oYXNMYXllcih0KT8odCBpbiB0aGlzLl9sYXllcnMmJih0PXRoaXMuX2xheWVyc1t0XSksdC5vZmYoby5GZWF0dXJlR3JvdXAuRVZFTlRTLHRoaXMuX3Byb3BhZ2F0ZUV2ZW50LHRoaXMpLG8uTGF5ZXJHcm91cC5wcm90b3R5cGUucmVtb3ZlTGF5ZXIuY2FsbCh0aGlzLHQpLHRoaXMuX3BvcHVwQ29udGVudCYmdGhpcy5pbnZva2UoInVuYmluZFBvcHVwIiksdGhpcy5maXJlKCJsYXllcnJlbW92ZSIse2xheWVyOnR9KSk6dGhpc30sYmluZFBvcHVwOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX3BvcHVwQ29udGVudD10LHRoaXMuX3BvcHVwT3B0aW9ucz1lLHRoaXMuaW52b2tlKCJiaW5kUG9wdXAiLHQsZSl9LHNldFN0eWxlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmludm9rZSgic2V0U3R5bGUiLHQpfSxicmluZ1RvRnJvbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pbnZva2UoImJyaW5nVG9Gcm9udCIpfSxicmluZ1RvQmFjazpmdW5jdGlvbigpe3JldHVybiB0aGlzLmludm9rZSgiYnJpbmdUb0JhY2siKX0sZ2V0Qm91bmRzOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IG8uTGF0TG5nQm91bmRzO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbihlKXt0LmV4dGVuZChlIGluc3RhbmNlb2Ygby5NYXJrZXI/ZS5nZXRMYXRMbmcoKTplLmdldEJvdW5kcygpKX0pLHR9LF9wcm9wYWdhdGVFdmVudDpmdW5jdGlvbih0KXt0LmxheWVyfHwodC5sYXllcj10LnRhcmdldCksdC50YXJnZXQ9dGhpcyx0aGlzLmZpcmUodC50eXBlLHQpfX0pLG8uZmVhdHVyZUdyb3VwPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5GZWF0dXJlR3JvdXAodCl9LG8uUGF0aD1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6W28uTWl4aW4uRXZlbnRzXSxzdGF0aWNzOntDTElQX1BBRERJTkc6ZnVuY3Rpb24oKXt2YXIgZT1vLkJyb3dzZXIubW9iaWxlPzEyODA6MmUzLGk9KGUvTWF0aC5tYXgodC5vdXRlcldpZHRoLHQub3V0ZXJIZWlnaHQpLTEpLzI7cmV0dXJuIE1hdGgubWF4KDAsTWF0aC5taW4oLjUsaSkpfSgpfSxvcHRpb25zOntzdHJva2U6ITAsY29sb3I6IiMwMDMzZmYiLGRhc2hBcnJheTpudWxsLGxpbmVDYXA6bnVsbCxsaW5lSm9pbjpudWxsLHdlaWdodDo1LG9wYWNpdHk6LjUsZmlsbDohMSxmaWxsQ29sb3I6bnVsbCxmaWxsT3BhY2l0eTouMixjbGlja2FibGU6ITB9LGluaXRpYWxpemU6ZnVuY3Rpb24odCl7by5zZXRPcHRpb25zKHRoaXMsdCl9LG9uQWRkOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10LHRoaXMuX2NvbnRhaW5lcnx8KHRoaXMuX2luaXRFbGVtZW50cygpLHRoaXMuX2luaXRFdmVudHMoKSksdGhpcy5wcm9qZWN0TGF0bG5ncygpLHRoaXMuX3VwZGF0ZVBhdGgoKSx0aGlzLl9jb250YWluZXImJnRoaXMuX21hcC5fcGF0aFJvb3QuYXBwZW5kQ2hpbGQodGhpcy5fY29udGFpbmVyKSx0aGlzLmZpcmUoImFkZCIpLHQub24oe3ZpZXdyZXNldDp0aGlzLnByb2plY3RMYXRsbmdzLG1vdmVlbmQ6dGhpcy5fdXBkYXRlUGF0aH0sdGhpcyl9LGFkZFRvOmZ1bmN0aW9uKHQpe3JldHVybiB0LmFkZExheWVyKHRoaXMpLHRoaXN9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3QuX3BhdGhSb290LnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRhaW5lciksdGhpcy5maXJlKCJyZW1vdmUiKSx0aGlzLl9tYXA9bnVsbCxvLkJyb3dzZXIudm1sJiYodGhpcy5fY29udGFpbmVyPW51bGwsdGhpcy5fc3Ryb2tlPW51bGwsdGhpcy5fZmlsbD1udWxsKSx0Lm9mZih7dmlld3Jlc2V0OnRoaXMucHJvamVjdExhdGxuZ3MsbW92ZWVuZDp0aGlzLl91cGRhdGVQYXRofSx0aGlzKX0scHJvamVjdExhdGxuZ3M6ZnVuY3Rpb24oKXt9LHNldFN0eWxlOmZ1bmN0aW9uKHQpe3JldHVybiBvLnNldE9wdGlvbnModGhpcyx0KSx0aGlzLl9jb250YWluZXImJnRoaXMuX3VwZGF0ZVN0eWxlKCksdGhpc30scmVkcmF3OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX21hcCYmKHRoaXMucHJvamVjdExhdGxuZ3MoKSx0aGlzLl91cGRhdGVQYXRoKCkpLHRoaXN9fSksby5NYXAuaW5jbHVkZSh7X3VwZGF0ZVBhdGhWaWV3cG9ydDpmdW5jdGlvbigpe3ZhciB0PW8uUGF0aC5DTElQX1BBRERJTkcsZT10aGlzLmdldFNpemUoKSxpPW8uRG9tVXRpbC5nZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lKSxuPWkubXVsdGlwbHlCeSgtMSkuX3N1YnRyYWN0KGUubXVsdGlwbHlCeSh0KS5fcm91bmQoKSkscz1uLmFkZChlLm11bHRpcGx5QnkoMSsyKnQpLl9yb3VuZCgpKTt0aGlzLl9wYXRoVmlld3BvcnQ9bmV3IG8uQm91bmRzKG4scyl9fSksby5QYXRoLlNWR19OUz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLG8uQnJvd3Nlci5zdmc9ISghZS5jcmVhdGVFbGVtZW50TlN8fCFlLmNyZWF0ZUVsZW1lbnROUyhvLlBhdGguU1ZHX05TLCJzdmciKS5jcmVhdGVTVkdSZWN0KSxvLlBhdGg9by5QYXRoLmV4dGVuZCh7c3RhdGljczp7U1ZHOm8uQnJvd3Nlci5zdmd9LGJyaW5nVG9Gcm9udDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcC5fcGF0aFJvb3QsZT10aGlzLl9jb250YWluZXI7cmV0dXJuIGUmJnQubGFzdENoaWxkIT09ZSYmdC5hcHBlbmRDaGlsZChlKSx0aGlzfSxicmluZ1RvQmFjazpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcC5fcGF0aFJvb3QsZT10aGlzLl9jb250YWluZXIsaT10LmZpcnN0Q2hpbGQ7cmV0dXJuIGUmJmkhPT1lJiZ0Lmluc2VydEJlZm9yZShlLGkpLHRoaXN9LGdldFBhdGhTdHJpbmc6ZnVuY3Rpb24oKXt9LF9jcmVhdGVFbGVtZW50OmZ1bmN0aW9uKHQpe3JldHVybiBlLmNyZWF0ZUVsZW1lbnROUyhvLlBhdGguU1ZHX05TLHQpfSxfaW5pdEVsZW1lbnRzOmZ1bmN0aW9uKCl7dGhpcy5fbWFwLl9pbml0UGF0aFJvb3QoKSx0aGlzLl9pbml0UGF0aCgpLHRoaXMuX2luaXRTdHlsZSgpfSxfaW5pdFBhdGg6ZnVuY3Rpb24oKXt0aGlzLl9jb250YWluZXI9dGhpcy5fY3JlYXRlRWxlbWVudCgiZyIpLHRoaXMuX3BhdGg9dGhpcy5fY3JlYXRlRWxlbWVudCgicGF0aCIpLHRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9wYXRoKX0sX2luaXRTdHlsZTpmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5zdHJva2UmJih0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgic3Ryb2tlLWxpbmVqb2luIiwicm91bmQiKSx0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgic3Ryb2tlLWxpbmVjYXAiLCJyb3VuZCIpKSx0aGlzLm9wdGlvbnMuZmlsbCYmdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImZpbGwtcnVsZSIsImV2ZW5vZGQiKSx0aGlzLm9wdGlvbnMucG9pbnRlckV2ZW50cyYmdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoInBvaW50ZXItZXZlbnRzIix0aGlzLm9wdGlvbnMucG9pbnRlckV2ZW50cyksdGhpcy5vcHRpb25zLmNsaWNrYWJsZXx8dGhpcy5vcHRpb25zLnBvaW50ZXJFdmVudHN8fHRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCJwb2ludGVyLWV2ZW50cyIsIm5vbmUiKSx0aGlzLl91cGRhdGVTdHlsZSgpfSxfdXBkYXRlU3R5bGU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuc3Ryb2tlPyh0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgic3Ryb2tlIix0aGlzLm9wdGlvbnMuY29sb3IpLHRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCJzdHJva2Utb3BhY2l0eSIsdGhpcy5vcHRpb25zLm9wYWNpdHkpLHRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCJzdHJva2Utd2lkdGgiLHRoaXMub3B0aW9ucy53ZWlnaHQpLHRoaXMub3B0aW9ucy5kYXNoQXJyYXk/dGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoInN0cm9rZS1kYXNoYXJyYXkiLHRoaXMub3B0aW9ucy5kYXNoQXJyYXkpOnRoaXMuX3BhdGgucmVtb3ZlQXR0cmlidXRlKCJzdHJva2UtZGFzaGFycmF5IiksdGhpcy5vcHRpb25zLmxpbmVDYXAmJnRoaXMuX3BhdGguc2V0QXR0cmlidXRlKCJzdHJva2UtbGluZWNhcCIsdGhpcy5vcHRpb25zLmxpbmVDYXApLHRoaXMub3B0aW9ucy5saW5lSm9pbiYmdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoInN0cm9rZS1saW5lam9pbiIsdGhpcy5vcHRpb25zLmxpbmVKb2luKSk6dGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoInN0cm9rZSIsIm5vbmUiKSx0aGlzLm9wdGlvbnMuZmlsbD8odGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImZpbGwiLHRoaXMub3B0aW9ucy5maWxsQ29sb3J8fHRoaXMub3B0aW9ucy5jb2xvciksdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImZpbGwtb3BhY2l0eSIsdGhpcy5vcHRpb25zLmZpbGxPcGFjaXR5KSk6dGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImZpbGwiLCJub25lIil9LF91cGRhdGVQYXRoOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRQYXRoU3RyaW5nKCk7dHx8KHQ9Ik0wIDAiKSx0aGlzLl9wYXRoLnNldEF0dHJpYnV0ZSgiZCIsdCl9LF9pbml0RXZlbnRzOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmNsaWNrYWJsZSl7KG8uQnJvd3Nlci5zdmd8fCFvLkJyb3dzZXIudm1sKSYmdGhpcy5fcGF0aC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwibGVhZmxldC1jbGlja2FibGUiKSxvLkRvbUV2ZW50Lm9uKHRoaXMuX2NvbnRhaW5lciwiY2xpY2siLHRoaXMuX29uTW91c2VDbGljayx0aGlzKTtmb3IodmFyIHQ9WyJkYmxjbGljayIsIm1vdXNlZG93biIsIm1vdXNlb3ZlciIsIm1vdXNlb3V0IiwibW91c2Vtb3ZlIiwiY29udGV4dG1lbnUiXSxlPTA7ZTx0Lmxlbmd0aDtlKyspby5Eb21FdmVudC5vbih0aGlzLl9jb250YWluZXIsdFtlXSx0aGlzLl9maXJlTW91c2VFdmVudCx0aGlzKX19LF9vbk1vdXNlQ2xpY2s6ZnVuY3Rpb24odCl7dGhpcy5fbWFwLmRyYWdnaW5nJiZ0aGlzLl9tYXAuZHJhZ2dpbmcubW92ZWQoKXx8dGhpcy5fZmlyZU1vdXNlRXZlbnQodCl9LF9maXJlTW91c2VFdmVudDpmdW5jdGlvbih0KXtpZih0aGlzLmhhc0V2ZW50TGlzdGVuZXJzKHQudHlwZSkpe3ZhciBlPXRoaXMuX21hcCxpPWUubW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQodCksbj1lLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KGkpLHM9ZS5sYXllclBvaW50VG9MYXRMbmcobik7dGhpcy5maXJlKHQudHlwZSx7bGF0bG5nOnMsbGF5ZXJQb2ludDpuLGNvbnRhaW5lclBvaW50Omksb3JpZ2luYWxFdmVudDp0fSksImNvbnRleHRtZW51Ij09PXQudHlwZSYmby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCh0KSwibW91c2Vtb3ZlIiE9PXQudHlwZSYmby5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24odCl9fX0pLG8uTWFwLmluY2x1ZGUoe19pbml0UGF0aFJvb3Q6ZnVuY3Rpb24oKXt0aGlzLl9wYXRoUm9vdHx8KHRoaXMuX3BhdGhSb290PW8uUGF0aC5wcm90b3R5cGUuX2NyZWF0ZUVsZW1lbnQoInN2ZyIpLHRoaXMuX3BhbmVzLm92ZXJsYXlQYW5lLmFwcGVuZENoaWxkKHRoaXMuX3BhdGhSb290KSx0aGlzLm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5Ccm93c2VyLmFueTNkPyh0aGlzLl9wYXRoUm9vdC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwiIGxlYWZsZXQtem9vbS1hbmltYXRlZCIpLHRoaXMub24oe3pvb21hbmltOnRoaXMuX2FuaW1hdGVQYXRoWm9vbSx6b29tZW5kOnRoaXMuX2VuZFBhdGhab29tfSkpOnRoaXMuX3BhdGhSb290LnNldEF0dHJpYnV0ZSgiY2xhc3MiLCIgbGVhZmxldC16b29tLWhpZGUiKSx0aGlzLm9uKCJtb3ZlZW5kIix0aGlzLl91cGRhdGVTdmdWaWV3cG9ydCksdGhpcy5fdXBkYXRlU3ZnVmlld3BvcnQoKSl9LF9hbmltYXRlUGF0aFpvb206ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5nZXRab29tU2NhbGUodC56b29tKSxpPXRoaXMuX2dldENlbnRlck9mZnNldCh0LmNlbnRlcikuX211bHRpcGx5QnkoLWUpLl9hZGQodGhpcy5fcGF0aFZpZXdwb3J0Lm1pbik7dGhpcy5fcGF0aFJvb3Quc3R5bGVbby5Eb21VdGlsLlRSQU5TRk9STV09by5Eb21VdGlsLmdldFRyYW5zbGF0ZVN0cmluZyhpKSsiIHNjYWxlKCIrZSsiKSAiLHRoaXMuX3BhdGhab29taW5nPSEwfSxfZW5kUGF0aFpvb206ZnVuY3Rpb24oKXt0aGlzLl9wYXRoWm9vbWluZz0hMX0sX3VwZGF0ZVN2Z1ZpZXdwb3J0OmZ1bmN0aW9uKCl7aWYoIXRoaXMuX3BhdGhab29taW5nKXt0aGlzLl91cGRhdGVQYXRoVmlld3BvcnQoKTt2YXIgdD10aGlzLl9wYXRoVmlld3BvcnQsZT10Lm1pbixpPXQubWF4LG49aS54LWUueCxzPWkueS1lLnksYT10aGlzLl9wYXRoUm9vdCxyPXRoaXMuX3BhbmVzLm92ZXJsYXlQYW5lO28uQnJvd3Nlci5tb2JpbGVXZWJraXQmJnIucmVtb3ZlQ2hpbGQoYSksby5Eb21VdGlsLnNldFBvc2l0aW9uKGEsZSksYS5zZXRBdHRyaWJ1dGUoIndpZHRoIixuKSxhLnNldEF0dHJpYnV0ZSgiaGVpZ2h0IixzKSxhLnNldEF0dHJpYnV0ZSgidmlld0JveCIsW2UueCxlLnksbixzXS5qb2luKCIgIikpLG8uQnJvd3Nlci5tb2JpbGVXZWJraXQmJnIuYXBwZW5kQ2hpbGQoYSl9fX0pLG8uUGF0aC5pbmNsdWRlKHtiaW5kUG9wdXA6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdCBpbnN0YW5jZW9mIG8uUG9wdXA/dGhpcy5fcG9wdXA9dDooKCF0aGlzLl9wb3B1cHx8ZSkmJih0aGlzLl9wb3B1cD1uZXcgby5Qb3B1cChlLHRoaXMpKSx0aGlzLl9wb3B1cC5zZXRDb250ZW50KHQpKSx0aGlzLl9wb3B1cEhhbmRsZXJzQWRkZWR8fCh0aGlzLm9uKCJjbGljayIsdGhpcy5fb3BlblBvcHVwLHRoaXMpLm9uKCJyZW1vdmUiLHRoaXMuY2xvc2VQb3B1cCx0aGlzKSx0aGlzLl9wb3B1cEhhbmRsZXJzQWRkZWQ9ITApLHRoaXMKfSx1bmJpbmRQb3B1cDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wb3B1cCYmKHRoaXMuX3BvcHVwPW51bGwsdGhpcy5vZmYoImNsaWNrIix0aGlzLl9vcGVuUG9wdXApLm9mZigicmVtb3ZlIix0aGlzLmNsb3NlUG9wdXApLHRoaXMuX3BvcHVwSGFuZGxlcnNBZGRlZD0hMSksdGhpc30sb3BlblBvcHVwOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9wb3B1cCYmKHQ9dHx8dGhpcy5fbGF0bG5nfHx0aGlzLl9sYXRsbmdzW01hdGguZmxvb3IodGhpcy5fbGF0bG5ncy5sZW5ndGgvMildLHRoaXMuX29wZW5Qb3B1cCh7bGF0bG5nOnR9KSksdGhpc30sY2xvc2VQb3B1cDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wb3B1cCYmdGhpcy5fcG9wdXAuX2Nsb3NlKCksdGhpc30sX29wZW5Qb3B1cDpmdW5jdGlvbih0KXt0aGlzLl9wb3B1cC5zZXRMYXRMbmcodC5sYXRsbmcpLHRoaXMuX21hcC5vcGVuUG9wdXAodGhpcy5fcG9wdXApfX0pLG8uQnJvd3Nlci52bWw9IW8uQnJvd3Nlci5zdmcmJmZ1bmN0aW9uKCl7dHJ5e3ZhciB0PWUuY3JlYXRlRWxlbWVudCgiZGl2Iik7dC5pbm5lckhUTUw9Jzx2OnNoYXBlIGFkaj0iMSIvPic7dmFyIGk9dC5maXJzdENoaWxkO3JldHVybiBpLnN0eWxlLmJlaGF2aW9yPSJ1cmwoI2RlZmF1bHQjVk1MKSIsaSYmIm9iamVjdCI9PXR5cGVvZiBpLmFkan1jYXRjaChuKXtyZXR1cm4hMX19KCksby5QYXRoPW8uQnJvd3Nlci5zdmd8fCFvLkJyb3dzZXIudm1sP28uUGF0aDpvLlBhdGguZXh0ZW5kKHtzdGF0aWNzOntWTUw6ITAsQ0xJUF9QQURESU5HOi4wMn0sX2NyZWF0ZUVsZW1lbnQ6ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIGUubmFtZXNwYWNlcy5hZGQoImx2bWwiLCJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOnZtbCIpLGZ1bmN0aW9uKHQpe3JldHVybiBlLmNyZWF0ZUVsZW1lbnQoIjxsdm1sOiIrdCsnIGNsYXNzPSJsdm1sIj4nKX19Y2F0Y2godCl7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBlLmNyZWF0ZUVsZW1lbnQoIjwiK3QrJyB4bWxucz0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LmNvbTp2bWwiIGNsYXNzPSJsdm1sIj4nKX19fSgpLF9pbml0UGF0aDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2NvbnRhaW5lcj10aGlzLl9jcmVhdGVFbGVtZW50KCJzaGFwZSIpO28uRG9tVXRpbC5hZGRDbGFzcyh0LCJsZWFmbGV0LXZtbC1zaGFwZSIpLHRoaXMub3B0aW9ucy5jbGlja2FibGUmJm8uRG9tVXRpbC5hZGRDbGFzcyh0LCJsZWFmbGV0LWNsaWNrYWJsZSIpLHQuY29vcmRzaXplPSIxIDEiLHRoaXMuX3BhdGg9dGhpcy5fY3JlYXRlRWxlbWVudCgicGF0aCIpLHQuYXBwZW5kQ2hpbGQodGhpcy5fcGF0aCksdGhpcy5fbWFwLl9wYXRoUm9vdC5hcHBlbmRDaGlsZCh0KX0sX2luaXRTdHlsZTpmdW5jdGlvbigpe3RoaXMuX3VwZGF0ZVN0eWxlKCl9LF91cGRhdGVTdHlsZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3N0cm9rZSxlPXRoaXMuX2ZpbGwsaT10aGlzLm9wdGlvbnMsbj10aGlzLl9jb250YWluZXI7bi5zdHJva2VkPWkuc3Ryb2tlLG4uZmlsbGVkPWkuZmlsbCxpLnN0cm9rZT8odHx8KHQ9dGhpcy5fc3Ryb2tlPXRoaXMuX2NyZWF0ZUVsZW1lbnQoInN0cm9rZSIpLHQuZW5kY2FwPSJyb3VuZCIsbi5hcHBlbmRDaGlsZCh0KSksdC53ZWlnaHQ9aS53ZWlnaHQrInB4Iix0LmNvbG9yPWkuY29sb3IsdC5vcGFjaXR5PWkub3BhY2l0eSx0LmRhc2hTdHlsZT1pLmRhc2hBcnJheT9vLlV0aWwuaXNBcnJheShpLmRhc2hBcnJheSk/aS5kYXNoQXJyYXkuam9pbigiICIpOmkuZGFzaEFycmF5LnJlcGxhY2UoLyggKiwgKikvZywiICIpOiIiLGkubGluZUNhcCYmKHQuZW5kY2FwPWkubGluZUNhcC5yZXBsYWNlKCJidXR0IiwiZmxhdCIpKSxpLmxpbmVKb2luJiYodC5qb2luc3R5bGU9aS5saW5lSm9pbikpOnQmJihuLnJlbW92ZUNoaWxkKHQpLHRoaXMuX3N0cm9rZT1udWxsKSxpLmZpbGw/KGV8fChlPXRoaXMuX2ZpbGw9dGhpcy5fY3JlYXRlRWxlbWVudCgiZmlsbCIpLG4uYXBwZW5kQ2hpbGQoZSkpLGUuY29sb3I9aS5maWxsQ29sb3J8fGkuY29sb3IsZS5vcGFjaXR5PWkuZmlsbE9wYWNpdHkpOmUmJihuLnJlbW92ZUNoaWxkKGUpLHRoaXMuX2ZpbGw9bnVsbCl9LF91cGRhdGVQYXRoOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fY29udGFpbmVyLnN0eWxlO3QuZGlzcGxheT0ibm9uZSIsdGhpcy5fcGF0aC52PXRoaXMuZ2V0UGF0aFN0cmluZygpKyIgIix0LmRpc3BsYXk9IiJ9fSksby5NYXAuaW5jbHVkZShvLkJyb3dzZXIuc3ZnfHwhby5Ccm93c2VyLnZtbD97fTp7X2luaXRQYXRoUm9vdDpmdW5jdGlvbigpe2lmKCF0aGlzLl9wYXRoUm9vdCl7dmFyIHQ9dGhpcy5fcGF0aFJvb3Q9ZS5jcmVhdGVFbGVtZW50KCJkaXYiKTt0LmNsYXNzTmFtZT0ibGVhZmxldC12bWwtY29udGFpbmVyIix0aGlzLl9wYW5lcy5vdmVybGF5UGFuZS5hcHBlbmRDaGlsZCh0KSx0aGlzLm9uKCJtb3ZlZW5kIix0aGlzLl91cGRhdGVQYXRoVmlld3BvcnQpLHRoaXMuX3VwZGF0ZVBhdGhWaWV3cG9ydCgpfX19KSxvLkJyb3dzZXIuY2FudmFzPWZ1bmN0aW9uKCl7cmV0dXJuISFlLmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpLmdldENvbnRleHR9KCksby5QYXRoPW8uUGF0aC5TVkcmJiF0LkxfUFJFRkVSX0NBTlZBU3x8IW8uQnJvd3Nlci5jYW52YXM/by5QYXRoOm8uUGF0aC5leHRlbmQoe3N0YXRpY3M6e0NBTlZBUzohMCxTVkc6ITF9LHJlZHJhdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXAmJih0aGlzLnByb2plY3RMYXRsbmdzKCksdGhpcy5fcmVxdWVzdFVwZGF0ZSgpKSx0aGlzfSxzZXRTdHlsZTpmdW5jdGlvbih0KXtyZXR1cm4gby5zZXRPcHRpb25zKHRoaXMsdCksdGhpcy5fbWFwJiYodGhpcy5fdXBkYXRlU3R5bGUoKSx0aGlzLl9yZXF1ZXN0VXBkYXRlKCkpLHRoaXN9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3Qub2ZmKCJ2aWV3cmVzZXQiLHRoaXMucHJvamVjdExhdGxuZ3MsdGhpcykub2ZmKCJtb3ZlZW5kIix0aGlzLl91cGRhdGVQYXRoLHRoaXMpLHRoaXMub3B0aW9ucy5jbGlja2FibGUmJih0aGlzLl9tYXAub2ZmKCJjbGljayIsdGhpcy5fb25DbGljayx0aGlzKSx0aGlzLl9tYXAub2ZmKCJtb3VzZW1vdmUiLHRoaXMuX29uTW91c2VNb3ZlLHRoaXMpKSx0aGlzLl9yZXF1ZXN0VXBkYXRlKCksdGhpcy5fbWFwPW51bGx9LF9yZXF1ZXN0VXBkYXRlOmZ1bmN0aW9uKCl7dGhpcy5fbWFwJiYhby5QYXRoLl91cGRhdGVSZXF1ZXN0JiYoby5QYXRoLl91cGRhdGVSZXF1ZXN0PW8uVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKHRoaXMuX2ZpcmVNYXBNb3ZlRW5kLHRoaXMuX21hcCkpfSxfZmlyZU1hcE1vdmVFbmQ6ZnVuY3Rpb24oKXtvLlBhdGguX3VwZGF0ZVJlcXVlc3Q9bnVsbCx0aGlzLmZpcmUoIm1vdmVlbmQiKX0sX2luaXRFbGVtZW50czpmdW5jdGlvbigpe3RoaXMuX21hcC5faW5pdFBhdGhSb290KCksdGhpcy5fY3R4PXRoaXMuX21hcC5fY2FudmFzQ3R4fSxfdXBkYXRlU3R5bGU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLm9wdGlvbnM7dC5zdHJva2UmJih0aGlzLl9jdHgubGluZVdpZHRoPXQud2VpZ2h0LHRoaXMuX2N0eC5zdHJva2VTdHlsZT10LmNvbG9yKSx0LmZpbGwmJih0aGlzLl9jdHguZmlsbFN0eWxlPXQuZmlsbENvbG9yfHx0LmNvbG9yKX0sX2RyYXdQYXRoOmZ1bmN0aW9uKCl7dmFyIHQsZSxpLG4scyxhO2Zvcih0aGlzLl9jdHguYmVnaW5QYXRoKCksdD0wLGk9dGhpcy5fcGFydHMubGVuZ3RoO2k+dDt0Kyspe2ZvcihlPTAsbj10aGlzLl9wYXJ0c1t0XS5sZW5ndGg7bj5lO2UrKylzPXRoaXMuX3BhcnRzW3RdW2VdLGE9KDA9PT1lPyJtb3ZlIjoibGluZSIpKyJUbyIsdGhpcy5fY3R4W2FdKHMueCxzLnkpO3RoaXMgaW5zdGFuY2VvZiBvLlBvbHlnb24mJnRoaXMuX2N0eC5jbG9zZVBhdGgoKX19LF9jaGVja0lmRW1wdHk6ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5fcGFydHMubGVuZ3RofSxfdXBkYXRlUGF0aDpmdW5jdGlvbigpe2lmKCF0aGlzLl9jaGVja0lmRW1wdHkoKSl7dmFyIHQ9dGhpcy5fY3R4LGU9dGhpcy5vcHRpb25zO3RoaXMuX2RyYXdQYXRoKCksdC5zYXZlKCksdGhpcy5fdXBkYXRlU3R5bGUoKSxlLmZpbGwmJih0Lmdsb2JhbEFscGhhPWUuZmlsbE9wYWNpdHksdC5maWxsKCkpLGUuc3Ryb2tlJiYodC5nbG9iYWxBbHBoYT1lLm9wYWNpdHksdC5zdHJva2UoKSksdC5yZXN0b3JlKCl9fSxfaW5pdEV2ZW50czpmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5jbGlja2FibGUmJih0aGlzLl9tYXAub24oIm1vdXNlbW92ZSIsdGhpcy5fb25Nb3VzZU1vdmUsdGhpcyksdGhpcy5fbWFwLm9uKCJjbGljayIsdGhpcy5fb25DbGljayx0aGlzKSl9LF9vbkNsaWNrOmZ1bmN0aW9uKHQpe3RoaXMuX2NvbnRhaW5zUG9pbnQodC5sYXllclBvaW50KSYmdGhpcy5maXJlKCJjbGljayIsdCl9LF9vbk1vdXNlTW92ZTpmdW5jdGlvbih0KXt0aGlzLl9tYXAmJiF0aGlzLl9tYXAuX2FuaW1hdGluZ1pvb20mJih0aGlzLl9jb250YWluc1BvaW50KHQubGF5ZXJQb2ludCk/KHRoaXMuX2N0eC5jYW52YXMuc3R5bGUuY3Vyc29yPSJwb2ludGVyIix0aGlzLl9tb3VzZUluc2lkZT0hMCx0aGlzLmZpcmUoIm1vdXNlb3ZlciIsdCkpOnRoaXMuX21vdXNlSW5zaWRlJiYodGhpcy5fY3R4LmNhbnZhcy5zdHlsZS5jdXJzb3I9IiIsdGhpcy5fbW91c2VJbnNpZGU9ITEsdGhpcy5maXJlKCJtb3VzZW91dCIsdCkpKX19KSxvLk1hcC5pbmNsdWRlKG8uUGF0aC5TVkcmJiF0LkxfUFJFRkVSX0NBTlZBU3x8IW8uQnJvd3Nlci5jYW52YXM/e306e19pbml0UGF0aFJvb3Q6ZnVuY3Rpb24oKXt2YXIgdCxpPXRoaXMuX3BhdGhSb290O2l8fChpPXRoaXMuX3BhdGhSb290PWUuY3JlYXRlRWxlbWVudCgiY2FudmFzIiksaS5zdHlsZS5wb3NpdGlvbj0iYWJzb2x1dGUiLHQ9dGhpcy5fY2FudmFzQ3R4PWkuZ2V0Q29udGV4dCgiMmQiKSx0LmxpbmVDYXA9InJvdW5kIix0LmxpbmVKb2luPSJyb3VuZCIsdGhpcy5fcGFuZXMub3ZlcmxheVBhbmUuYXBwZW5kQ2hpbGQoaSksdGhpcy5vcHRpb25zLnpvb21BbmltYXRpb24mJih0aGlzLl9wYXRoUm9vdC5jbGFzc05hbWU9ImxlYWZsZXQtem9vbS1hbmltYXRlZCIsdGhpcy5vbigiem9vbWFuaW0iLHRoaXMuX2FuaW1hdGVQYXRoWm9vbSksdGhpcy5vbigiem9vbWVuZCIsdGhpcy5fZW5kUGF0aFpvb20pKSx0aGlzLm9uKCJtb3ZlZW5kIix0aGlzLl91cGRhdGVDYW52YXNWaWV3cG9ydCksdGhpcy5fdXBkYXRlQ2FudmFzVmlld3BvcnQoKSl9LF91cGRhdGVDYW52YXNWaWV3cG9ydDpmdW5jdGlvbigpe2lmKCF0aGlzLl9wYXRoWm9vbWluZyl7dGhpcy5fdXBkYXRlUGF0aFZpZXdwb3J0KCk7dmFyIHQ9dGhpcy5fcGF0aFZpZXdwb3J0LGU9dC5taW4saT10Lm1heC5zdWJ0cmFjdChlKSxuPXRoaXMuX3BhdGhSb290O28uRG9tVXRpbC5zZXRQb3NpdGlvbihuLGUpLG4ud2lkdGg9aS54LG4uaGVpZ2h0PWkueSxuLmdldENvbnRleHQoIjJkIikudHJhbnNsYXRlKC1lLngsLWUueSl9fX0pLG8uTGluZVV0aWw9e3NpbXBsaWZ5OmZ1bmN0aW9uKHQsZSl7aWYoIWV8fCF0Lmxlbmd0aClyZXR1cm4gdC5zbGljZSgpO3ZhciBpPWUqZTtyZXR1cm4gdD10aGlzLl9yZWR1Y2VQb2ludHModCxpKSx0PXRoaXMuX3NpbXBsaWZ5RFAodCxpKX0scG9pbnRUb1NlZ21lbnREaXN0YW5jZTpmdW5jdGlvbih0LGUsaSl7cmV0dXJuIE1hdGguc3FydCh0aGlzLl9zcUNsb3Nlc3RQb2ludE9uU2VnbWVudCh0LGUsaSwhMCkpfSxjbG9zZXN0UG9pbnRPblNlZ21lbnQ6ZnVuY3Rpb24odCxlLGkpe3JldHVybiB0aGlzLl9zcUNsb3Nlc3RQb2ludE9uU2VnbWVudCh0LGUsaSl9LF9zaW1wbGlmeURQOmZ1bmN0aW9uKHQsZSl7dmFyIG49dC5sZW5ndGgsbz10eXBlb2YgVWludDhBcnJheSE9aSsiIj9VaW50OEFycmF5OkFycmF5LHM9bmV3IG8obik7c1swXT1zW24tMV09MSx0aGlzLl9zaW1wbGlmeURQU3RlcCh0LHMsZSwwLG4tMSk7dmFyIGEscj1bXTtmb3IoYT0wO24+YTthKyspc1thXSYmci5wdXNoKHRbYV0pO3JldHVybiByfSxfc2ltcGxpZnlEUFN0ZXA6ZnVuY3Rpb24odCxlLGksbixvKXt2YXIgcyxhLHIsaD0wO2ZvcihhPW4rMTtvLTE+PWE7YSsrKXI9dGhpcy5fc3FDbG9zZXN0UG9pbnRPblNlZ21lbnQodFthXSx0W25dLHRbb10sITApLHI+aCYmKHM9YSxoPXIpO2g+aSYmKGVbc109MSx0aGlzLl9zaW1wbGlmeURQU3RlcCh0LGUsaSxuLHMpLHRoaXMuX3NpbXBsaWZ5RFBTdGVwKHQsZSxpLHMsbykpfSxfcmVkdWNlUG9pbnRzOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBpPVt0WzBdXSxuPTEsbz0wLHM9dC5sZW5ndGg7cz5uO24rKyl0aGlzLl9zcURpc3QodFtuXSx0W29dKT5lJiYoaS5wdXNoKHRbbl0pLG89bik7cmV0dXJuIHMtMT5vJiZpLnB1c2godFtzLTFdKSxpfSxjbGlwU2VnbWVudDpmdW5jdGlvbih0LGUsaSxuKXt2YXIgbyxzLGEscj1uP3RoaXMuX2xhc3RDb2RlOnRoaXMuX2dldEJpdENvZGUodCxpKSxoPXRoaXMuX2dldEJpdENvZGUoZSxpKTtmb3IodGhpcy5fbGFzdENvZGU9aDs7KXtpZighKHJ8aCkpcmV0dXJuW3QsZV07aWYociZoKXJldHVybiExO289cnx8aCxzPXRoaXMuX2dldEVkZ2VJbnRlcnNlY3Rpb24odCxlLG8saSksYT10aGlzLl9nZXRCaXRDb2RlKHMsaSksbz09PXI/KHQ9cyxyPWEpOihlPXMsaD1hKX19LF9nZXRFZGdlSW50ZXJzZWN0aW9uOmZ1bmN0aW9uKHQsZSxpLG4pe3ZhciBzPWUueC10LngsYT1lLnktdC55LHI9bi5taW4saD1uLm1heDtyZXR1cm4gOCZpP25ldyBvLlBvaW50KHQueCtzKihoLnktdC55KS9hLGgueSk6NCZpP25ldyBvLlBvaW50KHQueCtzKihyLnktdC55KS9hLHIueSk6MiZpP25ldyBvLlBvaW50KGgueCx0LnkrYSooaC54LXQueCkvcyk6MSZpP25ldyBvLlBvaW50KHIueCx0LnkrYSooci54LXQueCkvcyk6dm9pZCAwfSxfZ2V0Qml0Q29kZTpmdW5jdGlvbih0LGUpe3ZhciBpPTA7cmV0dXJuIHQueDxlLm1pbi54P2l8PTE6dC54PmUubWF4LngmJihpfD0yKSx0Lnk8ZS5taW4ueT9pfD00OnQueT5lLm1heC55JiYoaXw9OCksaX0sX3NxRGlzdDpmdW5jdGlvbih0LGUpe3ZhciBpPWUueC10Lngsbj1lLnktdC55O3JldHVybiBpKmkrbipufSxfc3FDbG9zZXN0UG9pbnRPblNlZ21lbnQ6ZnVuY3Rpb24odCxlLGksbil7dmFyIHMsYT1lLngscj1lLnksaD1pLngtYSxsPWkueS1yLHU9aCpoK2wqbDtyZXR1cm4gdT4wJiYocz0oKHQueC1hKSpoKyh0LnktcikqbCkvdSxzPjE/KGE9aS54LHI9aS55KTpzPjAmJihhKz1oKnMscis9bCpzKSksaD10LngtYSxsPXQueS1yLG4/aCpoK2wqbDpuZXcgby5Qb2ludChhLHIpfX0sby5Qb2x5bGluZT1vLlBhdGguZXh0ZW5kKHtpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7by5QYXRoLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcyxlKSx0aGlzLl9sYXRsbmdzPXRoaXMuX2NvbnZlcnRMYXRMbmdzKHQpfSxvcHRpb25zOntzbW9vdGhGYWN0b3I6MSxub0NsaXA6ITF9LHByb2plY3RMYXRsbmdzOmZ1bmN0aW9uKCl7dGhpcy5fb3JpZ2luYWxQb2ludHM9W107Zm9yKHZhciB0PTAsZT10aGlzLl9sYXRsbmdzLmxlbmd0aDtlPnQ7dCsrKXRoaXMuX29yaWdpbmFsUG9pbnRzW3RdPXRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5fbGF0bG5nc1t0XSl9LGdldFBhdGhTdHJpbmc6ZnVuY3Rpb24oKXtmb3IodmFyIHQ9MCxlPXRoaXMuX3BhcnRzLmxlbmd0aCxpPSIiO2U+dDt0KyspaSs9dGhpcy5fZ2V0UGF0aFBhcnRTdHIodGhpcy5fcGFydHNbdF0pO3JldHVybiBpfSxnZXRMYXRMbmdzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2xhdGxuZ3N9LHNldExhdExuZ3M6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZ3M9dGhpcy5fY29udmVydExhdExuZ3ModCksdGhpcy5yZWRyYXcoKX0sYWRkTGF0TG5nOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9sYXRsbmdzLnB1c2goby5sYXRMbmcodCkpLHRoaXMucmVkcmF3KCl9LHNwbGljZUxhdExuZ3M6ZnVuY3Rpb24oKXt2YXIgdD1bXS5zcGxpY2UuYXBwbHkodGhpcy5fbGF0bG5ncyxhcmd1bWVudHMpO3JldHVybiB0aGlzLl9jb252ZXJ0TGF0TG5ncyh0aGlzLl9sYXRsbmdzLCEwKSx0aGlzLnJlZHJhdygpLHR9LGNsb3Nlc3RMYXllclBvaW50OmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSxpLG49MS8wLHM9dGhpcy5fcGFydHMsYT1udWxsLHI9MCxoPXMubGVuZ3RoO2g+cjtyKyspZm9yKHZhciBsPXNbcl0sdT0xLGM9bC5sZW5ndGg7Yz51O3UrKyl7ZT1sW3UtMV0saT1sW3VdO3ZhciBkPW8uTGluZVV0aWwuX3NxQ2xvc2VzdFBvaW50T25TZWdtZW50KHQsZSxpLCEwKTtuPmQmJihuPWQsYT1vLkxpbmVVdGlsLl9zcUNsb3Nlc3RQb2ludE9uU2VnbWVudCh0LGUsaSkpfXJldHVybiBhJiYoYS5kaXN0YW5jZT1NYXRoLnNxcnQobikpLGF9LGdldEJvdW5kczpmdW5jdGlvbigpe3JldHVybiBuZXcgby5MYXRMbmdCb3VuZHModGhpcy5nZXRMYXRMbmdzKCkpfSxfY29udmVydExhdExuZ3M6ZnVuY3Rpb24odCxlKXt2YXIgaSxuLHM9ZT90OltdO2ZvcihpPTAsbj10Lmxlbmd0aDtuPmk7aSsrKXtpZihvLlV0aWwuaXNBcnJheSh0W2ldKSYmIm51bWJlciIhPXR5cGVvZiB0W2ldWzBdKXJldHVybjtzW2ldPW8ubGF0TG5nKHRbaV0pfXJldHVybiBzfSxfaW5pdEV2ZW50czpmdW5jdGlvbigpe28uUGF0aC5wcm90b3R5cGUuX2luaXRFdmVudHMuY2FsbCh0aGlzKX0sX2dldFBhdGhQYXJ0U3RyOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSxpPW8uUGF0aC5WTUwsbj0wLHM9dC5sZW5ndGgsYT0iIjtzPm47bisrKWU9dFtuXSxpJiZlLl9yb3VuZCgpLGErPShuPyJMIjoiTSIpK2UueCsiICIrZS55O3JldHVybiBhfSxfY2xpcFBvaW50czpmdW5jdGlvbigpe3ZhciB0LGUsaSxuPXRoaXMuX29yaWdpbmFsUG9pbnRzLHM9bi5sZW5ndGg7aWYodGhpcy5vcHRpb25zLm5vQ2xpcClyZXR1cm4gdGhpcy5fcGFydHM9W25dLHZvaWQgMDt0aGlzLl9wYXJ0cz1bXTt2YXIgYT10aGlzLl9wYXJ0cyxyPXRoaXMuX21hcC5fcGF0aFZpZXdwb3J0LGg9by5MaW5lVXRpbDtmb3IodD0wLGU9MDtzLTE+dDt0KyspaT1oLmNsaXBTZWdtZW50KG5bdF0sblt0KzFdLHIsdCksaSYmKGFbZV09YVtlXXx8W10sYVtlXS5wdXNoKGlbMF0pLChpWzFdIT09blt0KzFdfHx0PT09cy0yKSYmKGFbZV0ucHVzaChpWzFdKSxlKyspKX0sX3NpbXBsaWZ5UG9pbnRzOmZ1bmN0aW9uKCl7Zm9yKHZhciB0PXRoaXMuX3BhcnRzLGU9by5MaW5lVXRpbCxpPTAsbj10Lmxlbmd0aDtuPmk7aSsrKXRbaV09ZS5zaW1wbGlmeSh0W2ldLHRoaXMub3B0aW9ucy5zbW9vdGhGYWN0b3IpfSxfdXBkYXRlUGF0aDpmdW5jdGlvbigpe3RoaXMuX21hcCYmKHRoaXMuX2NsaXBQb2ludHMoKSx0aGlzLl9zaW1wbGlmeVBvaW50cygpLG8uUGF0aC5wcm90b3R5cGUuX3VwZGF0ZVBhdGguY2FsbCh0aGlzKSl9fSksby5wb2x5bGluZT1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5Qb2x5bGluZSh0LGUpfSxvLlBvbHlVdGlsPXt9LG8uUG9seVV0aWwuY2xpcFBvbHlnb249ZnVuY3Rpb24odCxlKXt2YXIgaSxuLHMsYSxyLGgsbCx1LGMsZD1bMSw0LDIsOF0scD1vLkxpbmVVdGlsO2ZvcihuPTAsbD10Lmxlbmd0aDtsPm47bisrKXRbbl0uX2NvZGU9cC5fZ2V0Qml0Q29kZSh0W25dLGUpO2ZvcihhPTA7ND5hO2ErKyl7Zm9yKHU9ZFthXSxpPVtdLG49MCxsPXQubGVuZ3RoLHM9bC0xO2w+bjtzPW4rKylyPXRbbl0saD10W3NdLHIuX2NvZGUmdT9oLl9jb2RlJnV8fChjPXAuX2dldEVkZ2VJbnRlcnNlY3Rpb24oaCxyLHUsZSksYy5fY29kZT1wLl9nZXRCaXRDb2RlKGMsZSksaS5wdXNoKGMpKTooaC5fY29kZSZ1JiYoYz1wLl9nZXRFZGdlSW50ZXJzZWN0aW9uKGgscix1LGUpLGMuX2NvZGU9cC5fZ2V0Qml0Q29kZShjLGUpLGkucHVzaChjKSksaS5wdXNoKHIpKTt0PWl9cmV0dXJuIHR9LG8uUG9seWdvbj1vLlBvbHlsaW5lLmV4dGVuZCh7b3B0aW9uczp7ZmlsbDohMH0saW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUpe3ZhciBpLG4scztpZihvLlBvbHlsaW5lLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcyx0LGUpLHQmJm8uVXRpbC5pc0FycmF5KHRbMF0pJiYibnVtYmVyIiE9dHlwZW9mIHRbMF1bMF0pZm9yKHRoaXMuX2xhdGxuZ3M9dGhpcy5fY29udmVydExhdExuZ3ModFswXSksdGhpcy5faG9sZXM9dC5zbGljZSgxKSxpPTAsbj10aGlzLl9ob2xlcy5sZW5ndGg7bj5pO2krKylzPXRoaXMuX2hvbGVzW2ldPXRoaXMuX2NvbnZlcnRMYXRMbmdzKHRoaXMuX2hvbGVzW2ldKSxzWzBdLmVxdWFscyhzW3MubGVuZ3RoLTFdKSYmcy5wb3AoKTt0PXRoaXMuX2xhdGxuZ3MsdC5sZW5ndGg+PTImJnRbMF0uZXF1YWxzKHRbdC5sZW5ndGgtMV0pJiZ0LnBvcCgpfSxwcm9qZWN0TGF0bG5nczpmdW5jdGlvbigpe2lmKG8uUG9seWxpbmUucHJvdG90eXBlLnByb2plY3RMYXRsbmdzLmNhbGwodGhpcyksdGhpcy5faG9sZVBvaW50cz1bXSx0aGlzLl9ob2xlcyl7dmFyIHQsZSxpLG47Zm9yKHQ9MCxpPXRoaXMuX2hvbGVzLmxlbmd0aDtpPnQ7dCsrKWZvcih0aGlzLl9ob2xlUG9pbnRzW3RdPVtdLGU9MCxuPXRoaXMuX2hvbGVzW3RdLmxlbmd0aDtuPmU7ZSsrKXRoaXMuX2hvbGVQb2ludHNbdF1bZV09dGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9ob2xlc1t0XVtlXSl9fSxfY2xpcFBvaW50czpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX29yaWdpbmFsUG9pbnRzLGU9W107aWYodGhpcy5fcGFydHM9W3RdLmNvbmNhdCh0aGlzLl9ob2xlUG9pbnRzKSwhdGhpcy5vcHRpb25zLm5vQ2xpcCl7Zm9yKHZhciBpPTAsbj10aGlzLl9wYXJ0cy5sZW5ndGg7bj5pO2krKyl7dmFyIHM9by5Qb2x5VXRpbC5jbGlwUG9seWdvbih0aGlzLl9wYXJ0c1tpXSx0aGlzLl9tYXAuX3BhdGhWaWV3cG9ydCk7cy5sZW5ndGgmJmUucHVzaChzKX10aGlzLl9wYXJ0cz1lfX0sX2dldFBhdGhQYXJ0U3RyOmZ1bmN0aW9uKHQpe3ZhciBlPW8uUG9seWxpbmUucHJvdG90eXBlLl9nZXRQYXRoUGFydFN0ci5jYWxsKHRoaXMsdCk7cmV0dXJuIGUrKG8uQnJvd3Nlci5zdmc/InoiOiJ4Iil9fSksby5wb2x5Z29uPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLlBvbHlnb24odCxlKX0sZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQpe3JldHVybiBvLkZlYXR1cmVHcm91cC5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCxlKXt0aGlzLl9sYXllcnM9e30sdGhpcy5fb3B0aW9ucz1lLHRoaXMuc2V0TGF0TG5ncyh0KX0sc2V0TGF0TG5nczpmdW5jdGlvbihlKXt2YXIgaT0wLG49ZS5sZW5ndGg7Zm9yKHRoaXMuZWFjaExheWVyKGZ1bmN0aW9uKHQpe24+aT90LnNldExhdExuZ3MoZVtpKytdKTp0aGlzLnJlbW92ZUxheWVyKHQpfSx0aGlzKTtuPmk7KXRoaXMuYWRkTGF5ZXIobmV3IHQoZVtpKytdLHRoaXMuX29wdGlvbnMpKTtyZXR1cm4gdGhpc30sZ2V0TGF0TG5nczpmdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbihlKXt0LnB1c2goZS5nZXRMYXRMbmdzKCkpfSksdH19KX1vLk11bHRpUG9seWxpbmU9dChvLlBvbHlsaW5lKSxvLk11bHRpUG9seWdvbj10KG8uUG9seWdvbiksby5tdWx0aVBvbHlsaW5lPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLk11bHRpUG9seWxpbmUodCxlKX0sby5tdWx0aVBvbHlnb249ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uTXVsdGlQb2x5Z29uKHQsZSl9fSgpLG8uUmVjdGFuZ2xlPW8uUG9seWdvbi5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCxlKXtvLlBvbHlnb24ucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLHRoaXMuX2JvdW5kc1RvTGF0TG5ncyh0KSxlKX0sc2V0Qm91bmRzOmZ1bmN0aW9uKHQpe3RoaXMuc2V0TGF0TG5ncyh0aGlzLl9ib3VuZHNUb0xhdExuZ3ModCkpfSxfYm91bmRzVG9MYXRMbmdzOmZ1bmN0aW9uKHQpe3JldHVybiB0PW8ubGF0TG5nQm91bmRzKHQpLFt0LmdldFNvdXRoV2VzdCgpLHQuZ2V0Tm9ydGhXZXN0KCksdC5nZXROb3J0aEVhc3QoKSx0LmdldFNvdXRoRWFzdCgpXX19KSxvLnJlY3RhbmdsZT1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5SZWN0YW5nbGUodCxlKX0sby5DaXJjbGU9by5QYXRoLmV4dGVuZCh7aW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUsaSl7by5QYXRoLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcyxpKSx0aGlzLl9sYXRsbmc9by5sYXRMbmcodCksdGhpcy5fbVJhZGl1cz1lfSxvcHRpb25zOntmaWxsOiEwfSxzZXRMYXRMbmc6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZz1vLmxhdExuZyh0KSx0aGlzLnJlZHJhdygpfSxzZXRSYWRpdXM6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX21SYWRpdXM9dCx0aGlzLnJlZHJhdygpfSxwcm9qZWN0TGF0bG5nczpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2dldExuZ1JhZGl1cygpLGU9dGhpcy5fbGF0bG5nLGk9dGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludChbZS5sYXQsZS5sbmctdF0pO3RoaXMuX3BvaW50PXRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQoZSksdGhpcy5fcmFkaXVzPU1hdGgubWF4KHRoaXMuX3BvaW50LngtaS54LDEpfSxnZXRCb3VuZHM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9nZXRMbmdSYWRpdXMoKSxlPTM2MCoodGhpcy5fbVJhZGl1cy80MDA3NTAxNyksaT10aGlzLl9sYXRsbmc7cmV0dXJuIG5ldyBvLkxhdExuZ0JvdW5kcyhbaS5sYXQtZSxpLmxuZy10XSxbaS5sYXQrZSxpLmxuZyt0XSl9LGdldExhdExuZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9sYXRsbmd9LGdldFBhdGhTdHJpbmc6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9wb2ludCxlPXRoaXMuX3JhZGl1cztyZXR1cm4gdGhpcy5fY2hlY2tJZkVtcHR5KCk/IiI6by5Ccm93c2VyLnN2Zz8iTSIrdC54KyIsIisodC55LWUpKyJBIitlKyIsIitlKyIsMCwxLDEsIisodC54LS4xKSsiLCIrKHQueS1lKSsiIHoiOih0Ll9yb3VuZCgpLGU9TWF0aC5yb3VuZChlKSwiQUwgIit0LngrIiwiK3QueSsiICIrZSsiLCIrZSsiIDAsIisyMzU5MjYwMCl9LGdldFJhZGl1czpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tUmFkaXVzfSxfZ2V0TGF0UmFkaXVzOmZ1bmN0aW9uKCl7cmV0dXJuIDM2MCoodGhpcy5fbVJhZGl1cy80MDA3NTAxNyl9LF9nZXRMbmdSYWRpdXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZ2V0TGF0UmFkaXVzKCkvTWF0aC5jb3Moby5MYXRMbmcuREVHX1RPX1JBRCp0aGlzLl9sYXRsbmcubGF0KX0sX2NoZWNrSWZFbXB0eTpmdW5jdGlvbigpe2lmKCF0aGlzLl9tYXApcmV0dXJuITE7dmFyIHQ9dGhpcy5fbWFwLl9wYXRoVmlld3BvcnQsZT10aGlzLl9yYWRpdXMsaT10aGlzLl9wb2ludDtyZXR1cm4gaS54LWU+dC5tYXgueHx8aS55LWU+dC5tYXgueXx8aS54K2U8dC5taW4ueHx8aS55K2U8dC5taW4ueX19KSxvLmNpcmNsZT1mdW5jdGlvbih0LGUsaSl7cmV0dXJuIG5ldyBvLkNpcmNsZSh0LGUsaSl9LG8uQ2lyY2xlTWFya2VyPW8uQ2lyY2xlLmV4dGVuZCh7b3B0aW9uczp7cmFkaXVzOjEwLHdlaWdodDoyfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7by5DaXJjbGUucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLHQsbnVsbCxlKSx0aGlzLl9yYWRpdXM9dGhpcy5vcHRpb25zLnJhZGl1c30scHJvamVjdExhdGxuZ3M6ZnVuY3Rpb24oKXt0aGlzLl9wb2ludD10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2xhdGxuZyl9LF91cGRhdGVTdHlsZTpmdW5jdGlvbigpe28uQ2lyY2xlLnByb3RvdHlwZS5fdXBkYXRlU3R5bGUuY2FsbCh0aGlzKSx0aGlzLnNldFJhZGl1cyh0aGlzLm9wdGlvbnMucmFkaXVzKX0sc2V0TGF0TG5nOmZ1bmN0aW9uKHQpe28uQ2lyY2xlLnByb3RvdHlwZS5zZXRMYXRMbmcuY2FsbCh0aGlzLHQpLHRoaXMuX3BvcHVwJiZ0aGlzLl9wb3B1cC5faXNPcGVuJiZ0aGlzLl9wb3B1cC5zZXRMYXRMbmcodCl9LHNldFJhZGl1czpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLnJhZGl1cz10aGlzLl9yYWRpdXM9dCx0aGlzLnJlZHJhdygpfX0pLG8uY2lyY2xlTWFya2VyPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLkNpcmNsZU1hcmtlcih0LGUpfSxvLlBvbHlsaW5lLmluY2x1ZGUoby5QYXRoLkNBTlZBUz97X2NvbnRhaW5zUG9pbnQ6ZnVuY3Rpb24odCxlKXt2YXIgaSxuLHMsYSxyLGgsbCx1PXRoaXMub3B0aW9ucy53ZWlnaHQvMjtmb3Ioby5Ccm93c2VyLnRvdWNoJiYodSs9MTApLGk9MCxhPXRoaXMuX3BhcnRzLmxlbmd0aDthPmk7aSsrKWZvcihsPXRoaXMuX3BhcnRzW2ldLG49MCxyPWwubGVuZ3RoLHM9ci0xO3I+bjtzPW4rKylpZigoZXx8MCE9PW4pJiYoaD1vLkxpbmVVdGlsLnBvaW50VG9TZWdtZW50RGlzdGFuY2UodCxsW3NdLGxbbl0pLHU+PWgpKXJldHVybiEwO3JldHVybiExfX06e30pLG8uUG9seWdvbi5pbmNsdWRlKG8uUGF0aC5DQU5WQVM/e19jb250YWluc1BvaW50OmZ1bmN0aW9uKHQpe3ZhciBlLGksbixzLGEscixoLGwsdT0hMTtpZihvLlBvbHlsaW5lLnByb3RvdHlwZS5fY29udGFpbnNQb2ludC5jYWxsKHRoaXMsdCwhMCkpcmV0dXJuITA7Zm9yKHM9MCxoPXRoaXMuX3BhcnRzLmxlbmd0aDtoPnM7cysrKWZvcihlPXRoaXMuX3BhcnRzW3NdLGE9MCxsPWUubGVuZ3RoLHI9bC0xO2w+YTtyPWErKylpPWVbYV0sbj1lW3JdLGkueT50LnkhPW4ueT50LnkmJnQueDwobi54LWkueCkqKHQueS1pLnkpLyhuLnktaS55KStpLngmJih1PSF1KTtyZXR1cm4gdX19Ont9KSxvLkNpcmNsZS5pbmNsdWRlKG8uUGF0aC5DQU5WQVM/e19kcmF3UGF0aDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3BvaW50O3RoaXMuX2N0eC5iZWdpblBhdGgoKSx0aGlzLl9jdHguYXJjKHQueCx0LnksdGhpcy5fcmFkaXVzLDAsMipNYXRoLlBJLCExKX0sX2NvbnRhaW5zUG9pbnQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fcG9pbnQsaT10aGlzLm9wdGlvbnMuc3Ryb2tlP3RoaXMub3B0aW9ucy53ZWlnaHQvMjowO3JldHVybiB0LmRpc3RhbmNlVG8oZSk8PXRoaXMuX3JhZGl1cytpfX06e30pLG8uQ2lyY2xlTWFya2VyLmluY2x1ZGUoby5QYXRoLkNBTlZBUz97X3VwZGF0ZVN0eWxlOmZ1bmN0aW9uKCl7by5QYXRoLnByb3RvdHlwZS5fdXBkYXRlU3R5bGUuY2FsbCh0aGlzKX19Ont9KSxvLkdlb0pTT049by5GZWF0dXJlR3JvdXAuZXh0ZW5kKHtpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7by5zZXRPcHRpb25zKHRoaXMsZSksdGhpcy5fbGF5ZXJzPXt9LHQmJnRoaXMuYWRkRGF0YSh0KX0sYWRkRGF0YTpmdW5jdGlvbih0KXt2YXIgZSxpLG4scz1vLlV0aWwuaXNBcnJheSh0KT90OnQuZmVhdHVyZXM7aWYocyl7Zm9yKGU9MCxpPXMubGVuZ3RoO2k+ZTtlKyspbj1zW2VdLChuLmdlb21ldHJpZXN8fG4uZ2VvbWV0cnl8fG4uZmVhdHVyZXN8fG4uY29vcmRpbmF0ZXMpJiZ0aGlzLmFkZERhdGEoc1tlXSk7cmV0dXJuIHRoaXN9dmFyIGE9dGhpcy5vcHRpb25zO2lmKCFhLmZpbHRlcnx8YS5maWx0ZXIodCkpe3ZhciByPW8uR2VvSlNPTi5nZW9tZXRyeVRvTGF5ZXIodCxhLnBvaW50VG9MYXllcixhLmNvb3Jkc1RvTGF0TG5nLGEpO3JldHVybiByLmZlYXR1cmU9by5HZW9KU09OLmFzRmVhdHVyZSh0KSxyLmRlZmF1bHRPcHRpb25zPXIub3B0aW9ucyx0aGlzLnJlc2V0U3R5bGUociksYS5vbkVhY2hGZWF0dXJlJiZhLm9uRWFjaEZlYXR1cmUodCxyKSx0aGlzLmFkZExheWVyKHIpfX0scmVzZXRTdHlsZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLm9wdGlvbnMuc3R5bGU7ZSYmKG8uVXRpbC5leHRlbmQodC5vcHRpb25zLHQuZGVmYXVsdE9wdGlvbnMpLHRoaXMuX3NldExheWVyU3R5bGUodCxlKSl9LHNldFN0eWxlOmZ1bmN0aW9uKHQpe3RoaXMuZWFjaExheWVyKGZ1bmN0aW9uKGUpe3RoaXMuX3NldExheWVyU3R5bGUoZSx0KX0sdGhpcyl9LF9zZXRMYXllclN0eWxlOmZ1bmN0aW9uKHQsZSl7ImZ1bmN0aW9uIj09dHlwZW9mIGUmJihlPWUodC5mZWF0dXJlKSksdC5zZXRTdHlsZSYmdC5zZXRTdHlsZShlKX19KSxvLmV4dGVuZChvLkdlb0pTT04se2dlb21ldHJ5VG9MYXllcjpmdW5jdGlvbih0LGUsaSxuKXt2YXIgcyxhLHIsaCxsPSJGZWF0dXJlIj09PXQudHlwZT90Lmdlb21ldHJ5OnQsdT1sLmNvb3JkaW5hdGVzLGM9W107c3dpdGNoKGk9aXx8dGhpcy5jb29yZHNUb0xhdExuZyxsLnR5cGUpe2Nhc2UiUG9pbnQiOnJldHVybiBzPWkodSksZT9lKHQscyk6bmV3IG8uTWFya2VyKHMpO2Nhc2UiTXVsdGlQb2ludCI6Zm9yKHI9MCxoPXUubGVuZ3RoO2g+cjtyKyspcz1pKHVbcl0pLGMucHVzaChlP2UodCxzKTpuZXcgby5NYXJrZXIocykpO3JldHVybiBuZXcgby5GZWF0dXJlR3JvdXAoYyk7Y2FzZSJMaW5lU3RyaW5nIjpyZXR1cm4gYT10aGlzLmNvb3Jkc1RvTGF0TG5ncyh1LDAsaSksbmV3IG8uUG9seWxpbmUoYSxuKTtjYXNlIlBvbHlnb24iOmlmKDI9PT11Lmxlbmd0aCYmIXVbMV0ubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBHZW9KU09OIG9iamVjdC4iKTtyZXR1cm4gYT10aGlzLmNvb3Jkc1RvTGF0TG5ncyh1LDEsaSksbmV3IG8uUG9seWdvbihhLG4pO2Nhc2UiTXVsdGlMaW5lU3RyaW5nIjpyZXR1cm4gYT10aGlzLmNvb3Jkc1RvTGF0TG5ncyh1LDEsaSksbmV3IG8uTXVsdGlQb2x5bGluZShhLG4pO2Nhc2UiTXVsdGlQb2x5Z29uIjpyZXR1cm4gYT10aGlzLmNvb3Jkc1RvTGF0TG5ncyh1LDIsaSksbmV3IG8uTXVsdGlQb2x5Z29uKGEsbik7Y2FzZSJHZW9tZXRyeUNvbGxlY3Rpb24iOmZvcihyPTAsaD1sLmdlb21ldHJpZXMubGVuZ3RoO2g+cjtyKyspYy5wdXNoKHRoaXMuZ2VvbWV0cnlUb0xheWVyKHtnZW9tZXRyeTpsLmdlb21ldHJpZXNbcl0sdHlwZToiRmVhdHVyZSIscHJvcGVydGllczp0LnByb3BlcnRpZXN9LGUsaSxuKSk7cmV0dXJuIG5ldyBvLkZlYXR1cmVHcm91cChjKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcigiSW52YWxpZCBHZW9KU09OIG9iamVjdC4iKX19LGNvb3Jkc1RvTGF0TG5nOmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5MYXRMbmcodFsxXSx0WzBdKX0sY29vcmRzVG9MYXRMbmdzOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbixvLHMsYT1bXTtmb3Iobz0wLHM9dC5sZW5ndGg7cz5vO28rKyluPWU/dGhpcy5jb29yZHNUb0xhdExuZ3ModFtvXSxlLTEsaSk6KGl8fHRoaXMuY29vcmRzVG9MYXRMbmcpKHRbb10pLGEucHVzaChuKTtyZXR1cm4gYX0sbGF0TG5nVG9Db29yZHM6ZnVuY3Rpb24odCl7cmV0dXJuW3QubG5nLHQubGF0XX0sbGF0TG5nc1RvQ29vcmRzOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1bXSxpPTAsbj10Lmxlbmd0aDtuPmk7aSsrKWUucHVzaChvLkdlb0pTT04ubGF0TG5nVG9Db29yZHModFtpXSkpO3JldHVybiBlfSxnZXRGZWF0dXJlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQuZmVhdHVyZT9vLmV4dGVuZCh7fSx0LmZlYXR1cmUse2dlb21ldHJ5OmV9KTpvLkdlb0pTT04uYXNGZWF0dXJlKGUpfSxhc0ZlYXR1cmU6ZnVuY3Rpb24odCl7cmV0dXJuIkZlYXR1cmUiPT09dC50eXBlP3Q6e3R5cGU6IkZlYXR1cmUiLHByb3BlcnRpZXM6e30sZ2VvbWV0cnk6dH19fSk7dmFyIGE9e3RvR2VvSlNPTjpmdW5jdGlvbigpe3JldHVybiBvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOiJQb2ludCIsY29vcmRpbmF0ZXM6by5HZW9KU09OLmxhdExuZ1RvQ29vcmRzKHRoaXMuZ2V0TGF0TG5nKCkpfSl9fTtvLk1hcmtlci5pbmNsdWRlKGEpLG8uQ2lyY2xlLmluY2x1ZGUoYSksby5DaXJjbGVNYXJrZXIuaW5jbHVkZShhKSxvLlBvbHlsaW5lLmluY2x1ZGUoe3RvR2VvSlNPTjpmdW5jdGlvbigpe3JldHVybiBvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOiJMaW5lU3RyaW5nIixjb29yZGluYXRlczpvLkdlb0pTT04ubGF0TG5nc1RvQ29vcmRzKHRoaXMuZ2V0TGF0TG5ncygpKX0pfX0pLG8uUG9seWdvbi5pbmNsdWRlKHt0b0dlb0pTT046ZnVuY3Rpb24oKXt2YXIgdCxlLGksbj1bby5HZW9KU09OLmxhdExuZ3NUb0Nvb3Jkcyh0aGlzLmdldExhdExuZ3MoKSldO2lmKG5bMF0ucHVzaChuWzBdWzBdKSx0aGlzLl9ob2xlcylmb3IodD0wLGU9dGhpcy5faG9sZXMubGVuZ3RoO2U+dDt0KyspaT1vLkdlb0pTT04ubGF0TG5nc1RvQ29vcmRzKHRoaXMuX2hvbGVzW3RdKSxpLnB1c2goaVswXSksbi5wdXNoKGkpO3JldHVybiBvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOiJQb2x5Z29uIixjb29yZGluYXRlczpufSl9fSksZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQpe3JldHVybiBmdW5jdGlvbigpe3ZhciBlPVtdO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbih0KXtlLnB1c2godC50b0dlb0pTT04oKS5nZW9tZXRyeS5jb29yZGluYXRlcyl9KSxvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOnQsY29vcmRpbmF0ZXM6ZX0pfX1vLk11bHRpUG9seWxpbmUuaW5jbHVkZSh7dG9HZW9KU09OOnQoIk11bHRpTGluZVN0cmluZyIpfSksby5NdWx0aVBvbHlnb24uaW5jbHVkZSh7dG9HZW9KU09OOnQoIk11bHRpUG9seWdvbiIpfSksby5MYXllckdyb3VwLmluY2x1ZGUoe3RvR2VvSlNPTjpmdW5jdGlvbigpe3ZhciBlLGk9dGhpcy5mZWF0dXJlJiZ0aGlzLmZlYXR1cmUuZ2VvbWV0cnksbj1bXTtpZihpJiYiTXVsdGlQb2ludCI9PT1pLnR5cGUpcmV0dXJuIHQoIk11bHRpUG9pbnQiKS5jYWxsKHRoaXMpO3ZhciBzPWkmJiJHZW9tZXRyeUNvbGxlY3Rpb24iPT09aS50eXBlO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbih0KXt0LnRvR2VvSlNPTiYmKGU9dC50b0dlb0pTT04oKSxuLnB1c2gocz9lLmdlb21ldHJ5Om8uR2VvSlNPTi5hc0ZlYXR1cmUoZSkpKX0pLHM/by5HZW9KU09OLmdldEZlYXR1cmUodGhpcyx7Z2VvbWV0cmllczpuLHR5cGU6Ikdlb21ldHJ5Q29sbGVjdGlvbiJ9KTp7dHlwZToiRmVhdHVyZUNvbGxlY3Rpb24iLGZlYXR1cmVzOm59fX0pfSgpLG8uZ2VvSnNvbj1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5HZW9KU09OKHQsZSl9LG8uRG9tRXZlbnQ9e2FkZExpc3RlbmVyOmZ1bmN0aW9uKHQsZSxpLG4pe3ZhciBzLGEscixoPW8uc3RhbXAoaSksbD0iX2xlYWZsZXRfIitlK2g7cmV0dXJuIHRbbF0/dGhpczoocz1mdW5jdGlvbihlKXtyZXR1cm4gaS5jYWxsKG58fHQsZXx8by5Eb21FdmVudC5fZ2V0RXZlbnQoKSl9LG8uQnJvd3Nlci5tc1RvdWNoJiYwPT09ZS5pbmRleE9mKCJ0b3VjaCIpP3RoaXMuYWRkTXNUb3VjaExpc3RlbmVyKHQsZSxzLGgpOihvLkJyb3dzZXIudG91Y2gmJiJkYmxjbGljayI9PT1lJiZ0aGlzLmFkZERvdWJsZVRhcExpc3RlbmVyJiZ0aGlzLmFkZERvdWJsZVRhcExpc3RlbmVyKHQscyxoKSwiYWRkRXZlbnRMaXN0ZW5lciJpbiB0PyJtb3VzZXdoZWVsIj09PWU/KHQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NTW91c2VTY3JvbGwiLHMsITEpLHQuYWRkRXZlbnRMaXN0ZW5lcihlLHMsITEpKToibW91c2VlbnRlciI9PT1lfHwibW91c2VsZWF2ZSI9PT1lPyhhPXMscj0ibW91c2VlbnRlciI9PT1lPyJtb3VzZW92ZXIiOiJtb3VzZW91dCIscz1mdW5jdGlvbihlKXtyZXR1cm4gby5Eb21FdmVudC5fY2hlY2tNb3VzZSh0LGUpP2EoZSk6dm9pZCAwfSx0LmFkZEV2ZW50TGlzdGVuZXIocixzLCExKSk6ImNsaWNrIj09PWUmJm8uQnJvd3Nlci5hbmRyb2lkPyhhPXMscz1mdW5jdGlvbih0KXtyZXR1cm4gby5Eb21FdmVudC5fZmlsdGVyQ2xpY2sodCxhKX0sdC5hZGRFdmVudExpc3RlbmVyKGUscywhMSkpOnQuYWRkRXZlbnRMaXN0ZW5lcihlLHMsITEpOiJhdHRhY2hFdmVudCJpbiB0JiZ0LmF0dGFjaEV2ZW50KCJvbiIrZSxzKSx0W2xdPXMsdGhpcykpfSxyZW1vdmVMaXN0ZW5lcjpmdW5jdGlvbih0LGUsaSl7dmFyIG49by5zdGFtcChpKSxzPSJfbGVhZmxldF8iK2UrbixhPXRbc107cmV0dXJuIGE/KG8uQnJvd3Nlci5tc1RvdWNoJiYwPT09ZS5pbmRleE9mKCJ0b3VjaCIpP3RoaXMucmVtb3ZlTXNUb3VjaExpc3RlbmVyKHQsZSxuKTpvLkJyb3dzZXIudG91Y2gmJiJkYmxjbGljayI9PT1lJiZ0aGlzLnJlbW92ZURvdWJsZVRhcExpc3RlbmVyP3RoaXMucmVtb3ZlRG91YmxlVGFwTGlzdGVuZXIodCxuKToicmVtb3ZlRXZlbnRMaXN0ZW5lciJpbiB0PyJtb3VzZXdoZWVsIj09PWU/KHQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NTW91c2VTY3JvbGwiLGEsITEpLHQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLGEsITEpKToibW91c2VlbnRlciI9PT1lfHwibW91c2VsZWF2ZSI9PT1lP3QucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2VlbnRlciI9PT1lPyJtb3VzZW92ZXIiOiJtb3VzZW91dCIsYSwhMSk6dC5yZW1vdmVFdmVudExpc3RlbmVyKGUsYSwhMSk6ImRldGFjaEV2ZW50ImluIHQmJnQuZGV0YWNoRXZlbnQoIm9uIitlLGEpLHRbc109bnVsbCx0aGlzKTp0aGlzfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24odCl7cmV0dXJuIHQuc3RvcFByb3BhZ2F0aW9uP3Quc3RvcFByb3BhZ2F0aW9uKCk6dC5jYW5jZWxCdWJibGU9ITAsby5Eb21FdmVudC5fc2tpcHBlZCh0KSx0aGlzfSxkaXNhYmxlQ2xpY2tQcm9wYWdhdGlvbjpmdW5jdGlvbih0KXtmb3IodmFyIGU9by5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24saT1vLkRyYWdnYWJsZS5TVEFSVC5sZW5ndGgtMTtpPj0wO2ktLSlvLkRvbUV2ZW50LmFkZExpc3RlbmVyKHQsby5EcmFnZ2FibGUuU1RBUlRbaV0sZSk7cmV0dXJuIG8uRG9tRXZlbnQuYWRkTGlzdGVuZXIodCwiY2xpY2siLG8uRG9tRXZlbnQuX2Zha2VTdG9wKS5hZGRMaXN0ZW5lcih0LCJkYmxjbGljayIsZSl9LHByZXZlbnREZWZhdWx0OmZ1bmN0aW9uKHQpe3JldHVybiB0LnByZXZlbnREZWZhdWx0P3QucHJldmVudERlZmF1bHQoKTp0LnJldHVyblZhbHVlPSExLHRoaXN9LHN0b3A6ZnVuY3Rpb24odCl7cmV0dXJuIG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCkuc3RvcFByb3BhZ2F0aW9uKHQpfSxnZXRNb3VzZVBvc2l0aW9uOmZ1bmN0aW9uKHQsaSl7dmFyIG49by5Ccm93c2VyLmllNyxzPWUuYm9keSxhPWUuZG9jdW1lbnRFbGVtZW50LHI9dC5wYWdlWD90LnBhZ2VYLXMuc2Nyb2xsTGVmdC1hLnNjcm9sbExlZnQ6dC5jbGllbnRYLGg9dC5wYWdlWT90LnBhZ2VZLXMuc2Nyb2xsVG9wLWEuc2Nyb2xsVG9wOnQuY2xpZW50WSxsPW5ldyBvLlBvaW50KHIsaCk7aWYoIWkpcmV0dXJuIGw7dmFyIHU9aS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxjPXUubGVmdC1pLmNsaWVudExlZnQsZD11LnRvcC1pLmNsaWVudFRvcDtyZXR1cm4gby5Eb21VdGlsLmRvY3VtZW50SXNMdHIoKXx8IW8uQnJvd3Nlci53ZWJraXQmJiFufHwoYys9aS5zY3JvbGxXaWR0aC1pLmNsaWVudFdpZHRoLG4mJiJoaWRkZW4iIT09by5Eb21VdGlsLmdldFN0eWxlKGksIm92ZXJmbG93LXkiKSYmImhpZGRlbiIhPT1vLkRvbVV0aWwuZ2V0U3R5bGUoaSwib3ZlcmZsb3ciKSYmKGMrPTE3KSksbC5fc3VidHJhY3QobmV3IG8uUG9pbnQoYyxkKSl9LGdldFdoZWVsRGVsdGE6ZnVuY3Rpb24odCl7dmFyIGU9MDtyZXR1cm4gdC53aGVlbERlbHRhJiYoZT10LndoZWVsRGVsdGEvMTIwKSx0LmRldGFpbCYmKGU9LXQuZGV0YWlsLzMpLGV9LF9za2lwRXZlbnRzOnt9LF9mYWtlU3RvcDpmdW5jdGlvbih0KXtvLkRvbUV2ZW50Ll9za2lwRXZlbnRzW3QudHlwZV09ITB9LF9za2lwcGVkOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX3NraXBFdmVudHNbdC50eXBlXTtyZXR1cm4gdGhpcy5fc2tpcEV2ZW50c1t0LnR5cGVdPSExLGV9LF9jaGVja01vdXNlOmZ1bmN0aW9uKHQsZSl7dmFyIGk9ZS5yZWxhdGVkVGFyZ2V0O2lmKCFpKXJldHVybiEwO3RyeXtmb3IoO2kmJmkhPT10OylpPWkucGFyZW50Tm9kZX1jYXRjaChuKXtyZXR1cm4hMX1yZXR1cm4gaSE9PXR9LF9nZXRFdmVudDpmdW5jdGlvbigpe3ZhciBlPXQuZXZlbnQ7aWYoIWUpZm9yKHZhciBpPWFyZ3VtZW50cy5jYWxsZWUuY2FsbGVyO2kmJihlPWkuYXJndW1lbnRzWzBdLCFlfHx0LkV2ZW50IT09ZS5jb25zdHJ1Y3Rvcik7KWk9aS5jYWxsZXI7cmV0dXJuIGV9LF9maWx0ZXJDbGljazpmdW5jdGlvbih0LGUpe3ZhciBpPXQudGltZVN0YW1wfHx0Lm9yaWdpbmFsRXZlbnQudGltZVN0YW1wLG49by5Eb21FdmVudC5fbGFzdENsaWNrJiZpLW8uRG9tRXZlbnQuX2xhc3RDbGljaztyZXR1cm4gbiYmbj4xMDAmJjFlMz5ufHx0LnRhcmdldC5fc2ltdWxhdGVkQ2xpY2smJiF0Ll9zaW11bGF0ZWQ/KG8uRG9tRXZlbnQuc3RvcCh0KSx2b2lkIDApOihvLkRvbUV2ZW50Ll9sYXN0Q2xpY2s9aSxlKHQpKX19LG8uRG9tRXZlbnQub249by5Eb21FdmVudC5hZGRMaXN0ZW5lcixvLkRvbUV2ZW50Lm9mZj1vLkRvbUV2ZW50LnJlbW92ZUxpc3RlbmVyLG8uRHJhZ2dhYmxlPW8uQ2xhc3MuZXh0ZW5kKHtpbmNsdWRlczpvLk1peGluLkV2ZW50cyxzdGF0aWNzOntTVEFSVDpvLkJyb3dzZXIudG91Y2g/WyJ0b3VjaHN0YXJ0IiwibW91c2Vkb3duIl06WyJtb3VzZWRvd24iXSxFTkQ6e21vdXNlZG93bjoibW91c2V1cCIsdG91Y2hzdGFydDoidG91Y2hlbmQiLE1TUG9pbnRlckRvd246InRvdWNoZW5kIn0sTU9WRTp7bW91c2Vkb3duOiJtb3VzZW1vdmUiLHRvdWNoc3RhcnQ6InRvdWNobW92ZSIsTVNQb2ludGVyRG93bjoidG91Y2htb3ZlIn19LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlKXt0aGlzLl9lbGVtZW50PXQsdGhpcy5fZHJhZ1N0YXJ0VGFyZ2V0PWV8fHR9LGVuYWJsZTpmdW5jdGlvbigpe2lmKCF0aGlzLl9lbmFibGVkKXtmb3IodmFyIHQ9by5EcmFnZ2FibGUuU1RBUlQubGVuZ3RoLTE7dD49MDt0LS0pby5Eb21FdmVudC5vbih0aGlzLl9kcmFnU3RhcnRUYXJnZXQsby5EcmFnZ2FibGUuU1RBUlRbdF0sdGhpcy5fb25Eb3duLHRoaXMpO3RoaXMuX2VuYWJsZWQ9ITB9fSxkaXNhYmxlOmZ1bmN0aW9uKCl7aWYodGhpcy5fZW5hYmxlZCl7Zm9yKHZhciB0PW8uRHJhZ2dhYmxlLlNUQVJULmxlbmd0aC0xO3Q+PTA7dC0tKW8uRG9tRXZlbnQub2ZmKHRoaXMuX2RyYWdTdGFydFRhcmdldCxvLkRyYWdnYWJsZS5TVEFSVFt0XSx0aGlzLl9vbkRvd24sdGhpcyk7dGhpcy5fZW5hYmxlZD0hMSx0aGlzLl9tb3ZlZD0hMX19LF9vbkRvd246ZnVuY3Rpb24odCl7aWYodGhpcy5fbW92ZWQ9ITEsIXQuc2hpZnRLZXkmJigxPT09dC53aGljaHx8MT09PXQuYnV0dG9ufHx0LnRvdWNoZXMpJiYoby5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24odCksIW8uRHJhZ2dhYmxlLl9kaXNhYmxlZCkpe28uRG9tVXRpbC5kaXNhYmxlSW1hZ2VEcmFnKCksby5Eb21VdGlsLmRpc2FibGVUZXh0U2VsZWN0aW9uKCk7dmFyIGk9dC50b3VjaGVzP3QudG91Y2hlc1swXTp0LG49aS50YXJnZXQ7by5Ccm93c2VyLnRvdWNoJiZuLnRhZ05hbWUmJiJhIj09PW4udGFnTmFtZS50b0xvd2VyQ2FzZSgpJiZvLkRvbVV0aWwuYWRkQ2xhc3MobiwibGVhZmxldC1hY3RpdmUiKSx0aGlzLl9tb3Zpbmd8fCh0aGlzLl9zdGFydFBvaW50PW5ldyBvLlBvaW50KGkuY2xpZW50WCxpLmNsaWVudFkpLHRoaXMuX3N0YXJ0UG9zPXRoaXMuX25ld1Bvcz1vLkRvbVV0aWwuZ2V0UG9zaXRpb24odGhpcy5fZWxlbWVudCksby5Eb21FdmVudC5vbihlLG8uRHJhZ2dhYmxlLk1PVkVbdC50eXBlXSx0aGlzLl9vbk1vdmUsdGhpcykub24oZSxvLkRyYWdnYWJsZS5FTkRbdC50eXBlXSx0aGlzLl9vblVwLHRoaXMpKX19LF9vbk1vdmU6ZnVuY3Rpb24odCl7aWYoISh0LnRvdWNoZXMmJnQudG91Y2hlcy5sZW5ndGg+MSkpe3ZhciBpPXQudG91Y2hlcyYmMT09PXQudG91Y2hlcy5sZW5ndGg/dC50b3VjaGVzWzBdOnQsbj1uZXcgby5Qb2ludChpLmNsaWVudFgsaS5jbGllbnRZKSxzPW4uc3VidHJhY3QodGhpcy5fc3RhcnRQb2ludCk7KHMueHx8cy55KSYmKG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCksdGhpcy5fbW92ZWR8fCh0aGlzLmZpcmUoImRyYWdzdGFydCIpLHRoaXMuX21vdmVkPSEwLHRoaXMuX3N0YXJ0UG9zPW8uRG9tVXRpbC5nZXRQb3NpdGlvbih0aGlzLl9lbGVtZW50KS5zdWJ0cmFjdChzKSxvLkJyb3dzZXIudG91Y2h8fG8uRG9tVXRpbC5hZGRDbGFzcyhlLmJvZHksImxlYWZsZXQtZHJhZ2dpbmciKSksdGhpcy5fbmV3UG9zPXRoaXMuX3N0YXJ0UG9zLmFkZChzKSx0aGlzLl9tb3Zpbmc9ITAsby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCksdGhpcy5fYW5pbVJlcXVlc3Q9by5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fdXBkYXRlUG9zaXRpb24sdGhpcywhMCx0aGlzLl9kcmFnU3RhcnRUYXJnZXQpKX19LF91cGRhdGVQb3NpdGlvbjpmdW5jdGlvbigpe3RoaXMuZmlyZSgicHJlZHJhZyIpLG8uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9lbGVtZW50LHRoaXMuX25ld1BvcyksdGhpcy5maXJlKCJkcmFnIil9LF9vblVwOmZ1bmN0aW9uKCl7by5Ccm93c2VyLnRvdWNofHxvLkRvbVV0aWwucmVtb3ZlQ2xhc3MoZS5ib2R5LCJsZWFmbGV0LWRyYWdnaW5nIik7Zm9yKHZhciB0IGluIG8uRHJhZ2dhYmxlLk1PVkUpby5Eb21FdmVudC5vZmYoZSxvLkRyYWdnYWJsZS5NT1ZFW3RdLHRoaXMuX29uTW92ZSkub2ZmKGUsby5EcmFnZ2FibGUuRU5EW3RdLHRoaXMuX29uVXApO28uRG9tVXRpbC5lbmFibGVJbWFnZURyYWcoKSxvLkRvbVV0aWwuZW5hYmxlVGV4dFNlbGVjdGlvbigpLHRoaXMuX21vdmVkJiYoby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCksdGhpcy5maXJlKCJkcmFnZW5kIikpLHRoaXMuX21vdmluZz0hMX19KSxvLkhhbmRsZXI9by5DbGFzcy5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXR9LGVuYWJsZTpmdW5jdGlvbigpe3RoaXMuX2VuYWJsZWR8fCh0aGlzLl9lbmFibGVkPSEwLHRoaXMuYWRkSG9va3MoKSl9LGRpc2FibGU6ZnVuY3Rpb24oKXt0aGlzLl9lbmFibGVkJiYodGhpcy5fZW5hYmxlZD0hMSx0aGlzLnJlbW92ZUhvb2tzKCkpfSxlbmFibGVkOmZ1bmN0aW9uKCl7cmV0dXJuISF0aGlzLl9lbmFibGVkfX0pLG8uTWFwLm1lcmdlT3B0aW9ucyh7ZHJhZ2dpbmc6ITAsaW5lcnRpYTohby5Ccm93c2VyLmFuZHJvaWQyMyxpbmVydGlhRGVjZWxlcmF0aW9uOjM0MDAsaW5lcnRpYU1heFNwZWVkOjEvMCxpbmVydGlhVGhyZXNob2xkOm8uQnJvd3Nlci50b3VjaD8zMjoxOCxlYXNlTGluZWFyaXR5Oi4yNSx3b3JsZENvcHlKdW1wOiExfSksby5NYXAuRHJhZz1vLkhhbmRsZXIuZXh0ZW5kKHthZGRIb29rczpmdW5jdGlvbigpe2lmKCF0aGlzLl9kcmFnZ2FibGUpe3ZhciB0PXRoaXMuX21hcDt0aGlzLl9kcmFnZ2FibGU9bmV3IG8uRHJhZ2dhYmxlKHQuX21hcFBhbmUsdC5fY29udGFpbmVyKSx0aGlzLl9kcmFnZ2FibGUub24oe2RyYWdzdGFydDp0aGlzLl9vbkRyYWdTdGFydCxkcmFnOnRoaXMuX29uRHJhZyxkcmFnZW5kOnRoaXMuX29uRHJhZ0VuZH0sdGhpcyksdC5vcHRpb25zLndvcmxkQ29weUp1bXAmJih0aGlzLl9kcmFnZ2FibGUub24oInByZWRyYWciLHRoaXMuX29uUHJlRHJhZyx0aGlzKSx0Lm9uKCJ2aWV3cmVzZXQiLHRoaXMuX29uVmlld1Jlc2V0LHRoaXMpLHQud2hlblJlYWR5KHRoaXMuX29uVmlld1Jlc2V0LHRoaXMpKX10aGlzLl9kcmFnZ2FibGUuZW5hYmxlKCl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7dGhpcy5fZHJhZ2dhYmxlLmRpc2FibGUoKX0sbW92ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZHJhZ2dhYmxlJiZ0aGlzLl9kcmFnZ2FibGUuX21vdmVkfSxfb25EcmFnU3RhcnQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9tYXA7dC5fcGFuQW5pbSYmdC5fcGFuQW5pbS5zdG9wKCksdC5maXJlKCJtb3Zlc3RhcnQiKS5maXJlKCJkcmFnc3RhcnQiKSx0Lm9wdGlvbnMuaW5lcnRpYSYmKHRoaXMuX3Bvc2l0aW9ucz1bXSx0aGlzLl90aW1lcz1bXSl9LF9vbkRyYWc6ZnVuY3Rpb24oKXtpZih0aGlzLl9tYXAub3B0aW9ucy5pbmVydGlhKXt2YXIgdD10aGlzLl9sYXN0VGltZT0rbmV3IERhdGUsZT10aGlzLl9sYXN0UG9zPXRoaXMuX2RyYWdnYWJsZS5fbmV3UG9zO3RoaXMuX3Bvc2l0aW9ucy5wdXNoKGUpLHRoaXMuX3RpbWVzLnB1c2godCksdC10aGlzLl90aW1lc1swXT4yMDAmJih0aGlzLl9wb3NpdGlvbnMuc2hpZnQoKSx0aGlzLl90aW1lcy5zaGlmdCgpKX10aGlzLl9tYXAuZmlyZSgibW92ZSIpLmZpcmUoImRyYWciKX0sX29uVmlld1Jlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLmdldFNpemUoKS5fZGl2aWRlQnkoMiksZT10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KFswLDBdKTt0aGlzLl9pbml0aWFsV29ybGRPZmZzZXQ9ZS5zdWJ0cmFjdCh0KS54LHRoaXMuX3dvcmxkV2lkdGg9dGhpcy5fbWFwLnByb2plY3QoWzAsMTgwXSkueH0sX29uUHJlRHJhZzpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3dvcmxkV2lkdGgsZT1NYXRoLnJvdW5kKHQvMiksaT10aGlzLl9pbml0aWFsV29ybGRPZmZzZXQsbj10aGlzLl9kcmFnZ2FibGUuX25ld1Bvcy54LG89KG4tZStpKSV0K2UtaSxzPShuK2UraSkldC1lLWksYT1NYXRoLmFicyhvK2kpPE1hdGguYWJzKHMraSk/bzpzO3RoaXMuX2RyYWdnYWJsZS5fbmV3UG9zLng9YX0sX29uRHJhZ0VuZDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPXQub3B0aW9ucyxpPStuZXcgRGF0ZS10aGlzLl9sYXN0VGltZSxuPSFlLmluZXJ0aWF8fGk+ZS5pbmVydGlhVGhyZXNob2xkfHwhdGhpcy5fcG9zaXRpb25zWzBdO2lmKHQuZmlyZSgiZHJhZ2VuZCIpLG4pdC5maXJlKCJtb3ZlZW5kIik7ZWxzZXt2YXIgcz10aGlzLl9sYXN0UG9zLnN1YnRyYWN0KHRoaXMuX3Bvc2l0aW9uc1swXSksYT0odGhpcy5fbGFzdFRpbWUraS10aGlzLl90aW1lc1swXSkvMWUzLHI9ZS5lYXNlTGluZWFyaXR5LGg9cy5tdWx0aXBseUJ5KHIvYSksbD1oLmRpc3RhbmNlVG8oWzAsMF0pLHU9TWF0aC5taW4oZS5pbmVydGlhTWF4U3BlZWQsbCksYz1oLm11bHRpcGx5QnkodS9sKSxkPXUvKGUuaW5lcnRpYURlY2VsZXJhdGlvbipyKSxwPWMubXVsdGlwbHlCeSgtZC8yKS5yb3VuZCgpO3AueCYmcC55P28uVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uKCl7dC5wYW5CeShwLHtkdXJhdGlvbjpkLGVhc2VMaW5lYXJpdHk6cixub01vdmVTdGFydDohMH0pfSk6dC5maXJlKCJtb3ZlZW5kIil9fX0pLG8uTWFwLmFkZEluaXRIb29rKCJhZGRIYW5kbGVyIiwiZHJhZ2dpbmciLG8uTWFwLkRyYWcpLG8uTWFwLm1lcmdlT3B0aW9ucyh7ZG91YmxlQ2xpY2tab29tOiEwfSksby5NYXAuRG91YmxlQ2xpY2tab29tPW8uSGFuZGxlci5leHRlbmQoe2FkZEhvb2tzOmZ1bmN0aW9uKCl7dGhpcy5fbWFwLm9uKCJkYmxjbGljayIsdGhpcy5fb25Eb3VibGVDbGljayx0aGlzKX0scmVtb3ZlSG9va3M6ZnVuY3Rpb24oKXt0aGlzLl9tYXAub2ZmKCJkYmxjbGljayIsdGhpcy5fb25Eb3VibGVDbGljayx0aGlzKX0sX29uRG91YmxlQ2xpY2s6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fbWFwLGk9ZS5nZXRab29tKCkrMTsiY2VudGVyIj09PWUub3B0aW9ucy5kb3VibGVDbGlja1pvb20/ZS5zZXRab29tKGkpOmUuc2V0Wm9vbUFyb3VuZCh0LmNvbnRhaW5lclBvaW50LGkpfX0pLG8uTWFwLmFkZEluaXRIb29rKCJhZGRIYW5kbGVyIiwiZG91YmxlQ2xpY2tab29tIixvLk1hcC5Eb3VibGVDbGlja1pvb20pLG8uTWFwLm1lcmdlT3B0aW9ucyh7c2Nyb2xsV2hlZWxab29tOiEwfSksby5NYXAuU2Nyb2xsV2hlZWxab29tPW8uSGFuZGxlci5leHRlbmQoe2FkZEhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vbih0aGlzLl9tYXAuX2NvbnRhaW5lciwibW91c2V3aGVlbCIsdGhpcy5fb25XaGVlbFNjcm9sbCx0aGlzKSxvLkRvbUV2ZW50Lm9uKHRoaXMuX21hcC5fY29udGFpbmVyLCJNb3pNb3VzZVBpeGVsU2Nyb2xsIixvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KSx0aGlzLl9kZWx0YT0wfSxyZW1vdmVIb29rczpmdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKHRoaXMuX21hcC5fY29udGFpbmVyLCJtb3VzZXdoZWVsIix0aGlzLl9vbldoZWVsU2Nyb2xsKSxvLkRvbUV2ZW50Lm9mZih0aGlzLl9tYXAuX2NvbnRhaW5lciwiTW96TW91c2VQaXhlbFNjcm9sbCIsby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCl9LF9vbldoZWVsU2Nyb2xsOmZ1bmN0aW9uKHQpe3ZhciBlPW8uRG9tRXZlbnQuZ2V0V2hlZWxEZWx0YSh0KTt0aGlzLl9kZWx0YSs9ZSx0aGlzLl9sYXN0TW91c2VQb3M9dGhpcy5fbWFwLm1vdXNlRXZlbnRUb0NvbnRhaW5lclBvaW50KHQpLHRoaXMuX3N0YXJ0VGltZXx8KHRoaXMuX3N0YXJ0VGltZT0rbmV3IERhdGUpO3ZhciBpPU1hdGgubWF4KDQwLSgrbmV3IERhdGUtdGhpcy5fc3RhcnRUaW1lKSwwKTtjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpLHRoaXMuX3RpbWVyPXNldFRpbWVvdXQoby5iaW5kKHRoaXMuX3BlcmZvcm1ab29tLHRoaXMpLGkpLG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCksby5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24odCl9LF9wZXJmb3JtWm9vbTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPXRoaXMuX2RlbHRhLGk9dC5nZXRab29tKCk7ZT1lPjA/TWF0aC5jZWlsKGUpOk1hdGguZmxvb3IoZSksZT1NYXRoLm1heChNYXRoLm1pbihlLDQpLC00KSxlPXQuX2xpbWl0Wm9vbShpK2UpLWksdGhpcy5fZGVsdGE9MCx0aGlzLl9zdGFydFRpbWU9bnVsbCxlJiYoImNlbnRlciI9PT10Lm9wdGlvbnMuc2Nyb2xsV2hlZWxab29tP3Quc2V0Wm9vbShpK2UpOnQuc2V0Wm9vbUFyb3VuZCh0aGlzLl9sYXN0TW91c2VQb3MsaStlKSl9fSksby5NYXAuYWRkSW5pdEhvb2soImFkZEhhbmRsZXIiLCJzY3JvbGxXaGVlbFpvb20iLG8uTWFwLlNjcm9sbFdoZWVsWm9vbSksby5leHRlbmQoby5Eb21FdmVudCx7X3RvdWNoc3RhcnQ6by5Ccm93c2VyLm1zVG91Y2g/Ik1TUG9pbnRlckRvd24iOiJ0b3VjaHN0YXJ0IixfdG91Y2hlbmQ6by5Ccm93c2VyLm1zVG91Y2g/Ik1TUG9pbnRlclVwIjoidG91Y2hlbmQiLGFkZERvdWJsZVRhcExpc3RlbmVyOmZ1bmN0aW9uKHQsaSxuKXtmdW5jdGlvbiBzKHQpe3ZhciBlO2lmKG8uQnJvd3Nlci5tc1RvdWNoPyhtLnB1c2godC5wb2ludGVySWQpLGU9bS5sZW5ndGgpOmU9dC50b3VjaGVzLmxlbmd0aCwhKGU+MSkpe3ZhciBpPURhdGUubm93KCksbj1pLShyfHxpKTtoPXQudG91Y2hlcz90LnRvdWNoZXNbMF06dCxsPW4+MCYmdT49bixyPWl9fWZ1bmN0aW9uIGEodCl7aWYoby5Ccm93c2VyLm1zVG91Y2gpe3ZhciBlPW0uaW5kZXhPZih0LnBvaW50ZXJJZCk7aWYoLTE9PT1lKXJldHVybjttLnNwbGljZShlLDEpfWlmKGwpe2lmKG8uQnJvd3Nlci5tc1RvdWNoKXt2YXIgbixzPXt9O2Zvcih2YXIgYSBpbiBoKW49aFthXSxzW2FdPSJmdW5jdGlvbiI9PXR5cGVvZiBuP24uYmluZChoKTpuO2g9c31oLnR5cGU9ImRibGNsaWNrIixpKGgpLHI9bnVsbH19dmFyIHIsaCxsPSExLHU9MjUwLGM9Il9sZWFmbGV0XyIsZD10aGlzLl90b3VjaHN0YXJ0LHA9dGhpcy5fdG91Y2hlbmQsbT1bXTt0W2MrZCtuXT1zLHRbYytwK25dPWE7dmFyIF89by5Ccm93c2VyLm1zVG91Y2g/ZS5kb2N1bWVudEVsZW1lbnQ6dDtyZXR1cm4gdC5hZGRFdmVudExpc3RlbmVyKGQscywhMSksXy5hZGRFdmVudExpc3RlbmVyKHAsYSwhMSksby5Ccm93c2VyLm1zVG91Y2gmJl8uYWRkRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyQ2FuY2VsIixhLCExKSx0aGlzfSxyZW1vdmVEb3VibGVUYXBMaXN0ZW5lcjpmdW5jdGlvbih0LGkpe3ZhciBuPSJfbGVhZmxldF8iO3JldHVybiB0LnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5fdG91Y2hzdGFydCx0W24rdGhpcy5fdG91Y2hzdGFydCtpXSwhMSksKG8uQnJvd3Nlci5tc1RvdWNoP2UuZG9jdW1lbnRFbGVtZW50OnQpLnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5fdG91Y2hlbmQsdFtuK3RoaXMuX3RvdWNoZW5kK2ldLCExKSxvLkJyb3dzZXIubXNUb3VjaCYmZS5kb2N1bWVudEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyQ2FuY2VsIix0W24rdGhpcy5fdG91Y2hlbmQraV0sITEpLHRoaXN9fSksby5leHRlbmQoby5Eb21FdmVudCx7X21zVG91Y2hlczpbXSxfbXNEb2N1bWVudExpc3RlbmVyOiExLGFkZE1zVG91Y2hMaXN0ZW5lcjpmdW5jdGlvbih0LGUsaSxuKXtzd2l0Y2goZSl7Y2FzZSJ0b3VjaHN0YXJ0IjpyZXR1cm4gdGhpcy5hZGRNc1RvdWNoTGlzdGVuZXJTdGFydCh0LGUsaSxuKTtjYXNlInRvdWNoZW5kIjpyZXR1cm4gdGhpcy5hZGRNc1RvdWNoTGlzdGVuZXJFbmQodCxlLGksbik7Y2FzZSJ0b3VjaG1vdmUiOnJldHVybiB0aGlzLmFkZE1zVG91Y2hMaXN0ZW5lck1vdmUodCxlLGksbik7ZGVmYXVsdDp0aHJvdyJVbmtub3duIHRvdWNoIGV2ZW50IHR5cGUifX0sYWRkTXNUb3VjaExpc3RlbmVyU3RhcnQ6ZnVuY3Rpb24odCxpLG4scyl7dmFyIGE9Il9sZWFmbGV0XyIscj10aGlzLl9tc1RvdWNoZXMsaD1mdW5jdGlvbih0KXtvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KHQpO2Zvcih2YXIgZT0hMSxpPTA7aTxyLmxlbmd0aDtpKyspaWYocltpXS5wb2ludGVySWQ9PT10LnBvaW50ZXJJZCl7ZT0hMDticmVha31lfHxyLnB1c2godCksdC50b3VjaGVzPXIuc2xpY2UoKSx0LmNoYW5nZWRUb3VjaGVzPVt0XSxuKHQpfTtpZih0W2ErInRvdWNoc3RhcnQiK3NdPWgsdC5hZGRFdmVudExpc3RlbmVyKCJNU1BvaW50ZXJEb3duIixoLCExKSwhdGhpcy5fbXNEb2N1bWVudExpc3RlbmVyKXt2YXIgbD1mdW5jdGlvbih0KXtmb3IodmFyIGU9MDtlPHIubGVuZ3RoO2UrKylpZihyW2VdLnBvaW50ZXJJZD09PXQucG9pbnRlcklkKXtyLnNwbGljZShlLDEpO2JyZWFrfX07ZS5kb2N1bWVudEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyVXAiLGwsITEpLGUuZG9jdW1lbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoIk1TUG9pbnRlckNhbmNlbCIsbCwhMSksdGhpcy5fbXNEb2N1bWVudExpc3RlbmVyPSEwfXJldHVybiB0aGlzfSxhZGRNc1RvdWNoTGlzdGVuZXJNb3ZlOmZ1bmN0aW9uKHQsZSxpLG4pe2Z1bmN0aW9uIG8odCl7aWYodC5wb2ludGVyVHlwZSE9PXQuTVNQT0lOVEVSX1RZUEVfTU9VU0V8fDAhPT10LmJ1dHRvbnMpe2Zvcih2YXIgZT0wO2U8YS5sZW5ndGg7ZSsrKWlmKGFbZV0ucG9pbnRlcklkPT09dC5wb2ludGVySWQpe2FbZV09dDticmVha310LnRvdWNoZXM9YS5zbGljZSgpLHQuY2hhbmdlZFRvdWNoZXM9W3RdLGkodCl9fXZhciBzPSJfbGVhZmxldF8iLGE9dGhpcy5fbXNUb3VjaGVzO3JldHVybiB0W3MrInRvdWNobW92ZSIrbl09byx0LmFkZEV2ZW50TGlzdGVuZXIoIk1TUG9pbnRlck1vdmUiLG8sITEpLHRoaXN9LGFkZE1zVG91Y2hMaXN0ZW5lckVuZDpmdW5jdGlvbih0LGUsaSxuKXt2YXIgbz0iX2xlYWZsZXRfIixzPXRoaXMuX21zVG91Y2hlcyxhPWZ1bmN0aW9uKHQpe2Zvcih2YXIgZT0wO2U8cy5sZW5ndGg7ZSsrKWlmKHNbZV0ucG9pbnRlcklkPT09dC5wb2ludGVySWQpe3Muc3BsaWNlKGUsMSk7YnJlYWt9dC50b3VjaGVzPXMuc2xpY2UoKSx0LmNoYW5nZWRUb3VjaGVzPVt0XSxpKHQpfTtyZXR1cm4gdFtvKyJ0b3VjaGVuZCIrbl09YSx0LmFkZEV2ZW50TGlzdGVuZXIoIk1TUG9pbnRlclVwIixhLCExKSx0LmFkZEV2ZW50TGlzdGVuZXIoIk1TUG9pbnRlckNhbmNlbCIsYSwhMSksdGhpc30scmVtb3ZlTXNUb3VjaExpc3RlbmVyOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbj0iX2xlYWZsZXRfIixvPXRbbitlK2ldO3N3aXRjaChlKXtjYXNlInRvdWNoc3RhcnQiOnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyRG93biIsbywhMSk7YnJlYWs7Y2FzZSJ0b3VjaG1vdmUiOnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiTVNQb2ludGVyTW92ZSIsbywhMSk7YnJlYWs7Y2FzZSJ0b3VjaGVuZCI6dC5yZW1vdmVFdmVudExpc3RlbmVyKCJNU1BvaW50ZXJVcCIsbywhMSksdC5yZW1vdmVFdmVudExpc3RlbmVyKCJNU1BvaW50ZXJDYW5jZWwiLG8sITEpfXJldHVybiB0aGlzfX0pLG8uTWFwLm1lcmdlT3B0aW9ucyh7dG91Y2hab29tOm8uQnJvd3Nlci50b3VjaCYmIW8uQnJvd3Nlci5hbmRyb2lkMjN9KSxvLk1hcC5Ub3VjaFpvb209by5IYW5kbGVyLmV4dGVuZCh7YWRkSG9va3M6ZnVuY3Rpb24oKXtvLkRvbUV2ZW50Lm9uKHRoaXMuX21hcC5fY29udGFpbmVyLCJ0b3VjaHN0YXJ0Iix0aGlzLl9vblRvdWNoU3RhcnQsdGhpcyl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYodGhpcy5fbWFwLl9jb250YWluZXIsInRvdWNoc3RhcnQiLHRoaXMuX29uVG91Y2hTdGFydCx0aGlzKX0sX29uVG91Y2hTdGFydDpmdW5jdGlvbih0KXt2YXIgaT10aGlzLl9tYXA7aWYodC50b3VjaGVzJiYyPT09dC50b3VjaGVzLmxlbmd0aCYmIWkuX2FuaW1hdGluZ1pvb20mJiF0aGlzLl96b29taW5nKXt2YXIgbj1pLm1vdXNlRXZlbnRUb0xheWVyUG9pbnQodC50b3VjaGVzWzBdKSxzPWkubW91c2VFdmVudFRvTGF5ZXJQb2ludCh0LnRvdWNoZXNbMV0pLGE9aS5fZ2V0Q2VudGVyTGF5ZXJQb2ludCgpOwp0aGlzLl9zdGFydENlbnRlcj1uLmFkZChzKS5fZGl2aWRlQnkoMiksdGhpcy5fc3RhcnREaXN0PW4uZGlzdGFuY2VUbyhzKSx0aGlzLl9tb3ZlZD0hMSx0aGlzLl96b29taW5nPSEwLHRoaXMuX2NlbnRlck9mZnNldD1hLnN1YnRyYWN0KHRoaXMuX3N0YXJ0Q2VudGVyKSxpLl9wYW5BbmltJiZpLl9wYW5BbmltLnN0b3AoKSxvLkRvbUV2ZW50Lm9uKGUsInRvdWNobW92ZSIsdGhpcy5fb25Ub3VjaE1vdmUsdGhpcykub24oZSwidG91Y2hlbmQiLHRoaXMuX29uVG91Y2hFbmQsdGhpcyksby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCh0KX19LF9vblRvdWNoTW92ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXA7aWYodC50b3VjaGVzJiYyPT09dC50b3VjaGVzLmxlbmd0aCYmdGhpcy5fem9vbWluZyl7dmFyIGk9ZS5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQudG91Y2hlc1swXSksbj1lLm1vdXNlRXZlbnRUb0xheWVyUG9pbnQodC50b3VjaGVzWzFdKTt0aGlzLl9zY2FsZT1pLmRpc3RhbmNlVG8obikvdGhpcy5fc3RhcnREaXN0LHRoaXMuX2RlbHRhPWkuX2FkZChuKS5fZGl2aWRlQnkoMikuX3N1YnRyYWN0KHRoaXMuX3N0YXJ0Q2VudGVyKSwxIT09dGhpcy5fc2NhbGUmJih0aGlzLl9tb3ZlZHx8KG8uRG9tVXRpbC5hZGRDbGFzcyhlLl9tYXBQYW5lLCJsZWFmbGV0LXRvdWNoaW5nIiksZS5maXJlKCJtb3Zlc3RhcnQiKS5maXJlKCJ6b29tc3RhcnQiKSx0aGlzLl9tb3ZlZD0hMCksby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCksdGhpcy5fYW5pbVJlcXVlc3Q9by5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fdXBkYXRlT25Nb3ZlLHRoaXMsITAsdGhpcy5fbWFwLl9jb250YWluZXIpLG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCkpfX0sX3VwZGF0ZU9uTW92ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPXRoaXMuX2dldFNjYWxlT3JpZ2luKCksaT10LmxheWVyUG9pbnRUb0xhdExuZyhlKSxuPXQuZ2V0U2NhbGVab29tKHRoaXMuX3NjYWxlKTt0Ll9hbmltYXRlWm9vbShpLG4sdGhpcy5fc3RhcnRDZW50ZXIsdGhpcy5fc2NhbGUsdGhpcy5fZGVsdGEpfSxfb25Ub3VjaEVuZDpmdW5jdGlvbigpe2lmKCF0aGlzLl9tb3ZlZHx8IXRoaXMuX3pvb21pbmcpcmV0dXJuIHRoaXMuX3pvb21pbmc9ITEsdm9pZCAwO3ZhciB0PXRoaXMuX21hcDt0aGlzLl96b29taW5nPSExLG8uRG9tVXRpbC5yZW1vdmVDbGFzcyh0Ll9tYXBQYW5lLCJsZWFmbGV0LXRvdWNoaW5nIiksby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCksby5Eb21FdmVudC5vZmYoZSwidG91Y2htb3ZlIix0aGlzLl9vblRvdWNoTW92ZSkub2ZmKGUsInRvdWNoZW5kIix0aGlzLl9vblRvdWNoRW5kKTt2YXIgaT10aGlzLl9nZXRTY2FsZU9yaWdpbigpLG49dC5sYXllclBvaW50VG9MYXRMbmcoaSkscz10LmdldFpvb20oKSxhPXQuZ2V0U2NhbGVab29tKHRoaXMuX3NjYWxlKS1zLHI9YT4wP01hdGguY2VpbChhKTpNYXRoLmZsb29yKGEpLGg9dC5fbGltaXRab29tKHMrciksbD10LmdldFpvb21TY2FsZShoKS90aGlzLl9zY2FsZTt0Ll9hbmltYXRlWm9vbShuLGgsaSxsKX0sX2dldFNjYWxlT3JpZ2luOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fY2VudGVyT2Zmc2V0LnN1YnRyYWN0KHRoaXMuX2RlbHRhKS5kaXZpZGVCeSh0aGlzLl9zY2FsZSk7cmV0dXJuIHRoaXMuX3N0YXJ0Q2VudGVyLmFkZCh0KX19KSxvLk1hcC5hZGRJbml0SG9vaygiYWRkSGFuZGxlciIsInRvdWNoWm9vbSIsby5NYXAuVG91Y2hab29tKSxvLk1hcC5tZXJnZU9wdGlvbnMoe3RhcDohMCx0YXBUb2xlcmFuY2U6MTV9KSxvLk1hcC5UYXA9by5IYW5kbGVyLmV4dGVuZCh7YWRkSG9va3M6ZnVuY3Rpb24oKXtvLkRvbUV2ZW50Lm9uKHRoaXMuX21hcC5fY29udGFpbmVyLCJ0b3VjaHN0YXJ0Iix0aGlzLl9vbkRvd24sdGhpcyl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYodGhpcy5fbWFwLl9jb250YWluZXIsInRvdWNoc3RhcnQiLHRoaXMuX29uRG93bix0aGlzKX0sX29uRG93bjpmdW5jdGlvbih0KXtpZih0LnRvdWNoZXMpe2lmKG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCksdGhpcy5fZmlyZUNsaWNrPSEwLHQudG91Y2hlcy5sZW5ndGg+MSlyZXR1cm4gdGhpcy5fZmlyZUNsaWNrPSExLGNsZWFyVGltZW91dCh0aGlzLl9ob2xkVGltZW91dCksdm9pZCAwO3ZhciBpPXQudG91Y2hlc1swXSxuPWkudGFyZ2V0O3RoaXMuX3N0YXJ0UG9zPXRoaXMuX25ld1Bvcz1uZXcgby5Qb2ludChpLmNsaWVudFgsaS5jbGllbnRZKSxuLnRhZ05hbWUmJiJhIj09PW4udGFnTmFtZS50b0xvd2VyQ2FzZSgpJiZvLkRvbVV0aWwuYWRkQ2xhc3MobiwibGVhZmxldC1hY3RpdmUiKSx0aGlzLl9ob2xkVGltZW91dD1zZXRUaW1lb3V0KG8uYmluZChmdW5jdGlvbigpe3RoaXMuX2lzVGFwVmFsaWQoKSYmKHRoaXMuX2ZpcmVDbGljaz0hMSx0aGlzLl9vblVwKCksdGhpcy5fc2ltdWxhdGVFdmVudCgiY29udGV4dG1lbnUiLGkpKX0sdGhpcyksMWUzKSxvLkRvbUV2ZW50Lm9uKGUsInRvdWNobW92ZSIsdGhpcy5fb25Nb3ZlLHRoaXMpLm9uKGUsInRvdWNoZW5kIix0aGlzLl9vblVwLHRoaXMpfX0sX29uVXA6ZnVuY3Rpb24odCl7aWYoY2xlYXJUaW1lb3V0KHRoaXMuX2hvbGRUaW1lb3V0KSxvLkRvbUV2ZW50Lm9mZihlLCJ0b3VjaG1vdmUiLHRoaXMuX29uTW92ZSx0aGlzKS5vZmYoZSwidG91Y2hlbmQiLHRoaXMuX29uVXAsdGhpcyksdGhpcy5fZmlyZUNsaWNrJiZ0JiZ0LmNoYW5nZWRUb3VjaGVzKXt2YXIgaT10LmNoYW5nZWRUb3VjaGVzWzBdLG49aS50YXJnZXQ7biYmbi50YWdOYW1lJiYiYSI9PT1uLnRhZ05hbWUudG9Mb3dlckNhc2UoKSYmby5Eb21VdGlsLnJlbW92ZUNsYXNzKG4sImxlYWZsZXQtYWN0aXZlIiksdGhpcy5faXNUYXBWYWxpZCgpJiZ0aGlzLl9zaW11bGF0ZUV2ZW50KCJjbGljayIsaSl9fSxfaXNUYXBWYWxpZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9uZXdQb3MuZGlzdGFuY2VUbyh0aGlzLl9zdGFydFBvcyk8PXRoaXMuX21hcC5vcHRpb25zLnRhcFRvbGVyYW5jZX0sX29uTW92ZTpmdW5jdGlvbih0KXt2YXIgZT10LnRvdWNoZXNbMF07dGhpcy5fbmV3UG9zPW5ldyBvLlBvaW50KGUuY2xpZW50WCxlLmNsaWVudFkpfSxfc2ltdWxhdGVFdmVudDpmdW5jdGlvbihpLG4pe3ZhciBvPWUuY3JlYXRlRXZlbnQoIk1vdXNlRXZlbnRzIik7by5fc2ltdWxhdGVkPSEwLG4udGFyZ2V0Ll9zaW11bGF0ZWRDbGljaz0hMCxvLmluaXRNb3VzZUV2ZW50KGksITAsITAsdCwxLG4uc2NyZWVuWCxuLnNjcmVlblksbi5jbGllbnRYLG4uY2xpZW50WSwhMSwhMSwhMSwhMSwwLG51bGwpLG4udGFyZ2V0LmRpc3BhdGNoRXZlbnQobyl9fSksby5Ccm93c2VyLnRvdWNoJiYhby5Ccm93c2VyLm1zVG91Y2gmJm8uTWFwLmFkZEluaXRIb29rKCJhZGRIYW5kbGVyIiwidGFwIixvLk1hcC5UYXApLG8uTWFwLm1lcmdlT3B0aW9ucyh7Ym94Wm9vbTohMH0pLG8uTWFwLkJveFpvb209by5IYW5kbGVyLmV4dGVuZCh7aW5pdGlhbGl6ZTpmdW5jdGlvbih0KXt0aGlzLl9tYXA9dCx0aGlzLl9jb250YWluZXI9dC5fY29udGFpbmVyLHRoaXMuX3BhbmU9dC5fcGFuZXMub3ZlcmxheVBhbmUsdGhpcy5fbW92ZWQ9ITF9LGFkZEhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vbih0aGlzLl9jb250YWluZXIsIm1vdXNlZG93biIsdGhpcy5fb25Nb3VzZURvd24sdGhpcyl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYodGhpcy5fY29udGFpbmVyLCJtb3VzZWRvd24iLHRoaXMuX29uTW91c2VEb3duKSx0aGlzLl9tb3ZlZD0hMX0sbW92ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbW92ZWR9LF9vbk1vdXNlRG93bjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fbW92ZWQ9ITEsIXQuc2hpZnRLZXl8fDEhPT10LndoaWNoJiYxIT09dC5idXR0b24/ITE6KG8uRG9tVXRpbC5kaXNhYmxlVGV4dFNlbGVjdGlvbigpLG8uRG9tVXRpbC5kaXNhYmxlSW1hZ2VEcmFnKCksdGhpcy5fc3RhcnRMYXllclBvaW50PXRoaXMuX21hcC5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQpLHRoaXMuX2JveD1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLCJsZWFmbGV0LXpvb20tYm94Iix0aGlzLl9wYW5lKSxvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fYm94LHRoaXMuX3N0YXJ0TGF5ZXJQb2ludCksdGhpcy5fY29udGFpbmVyLnN0eWxlLmN1cnNvcj0iY3Jvc3NoYWlyIixvLkRvbUV2ZW50Lm9uKGUsIm1vdXNlbW92ZSIsdGhpcy5fb25Nb3VzZU1vdmUsdGhpcykub24oZSwibW91c2V1cCIsdGhpcy5fb25Nb3VzZVVwLHRoaXMpLm9uKGUsImtleWRvd24iLHRoaXMuX29uS2V5RG93bix0aGlzKSx0aGlzLl9tYXAuZmlyZSgiYm94em9vbXN0YXJ0Iiksdm9pZCAwKX0sX29uTW91c2VNb3ZlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX3N0YXJ0TGF5ZXJQb2ludCxpPXRoaXMuX2JveCxuPXRoaXMuX21hcC5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQpLHM9bi5zdWJ0cmFjdChlKSxhPW5ldyBvLlBvaW50KE1hdGgubWluKG4ueCxlLngpLE1hdGgubWluKG4ueSxlLnkpKTtvLkRvbVV0aWwuc2V0UG9zaXRpb24oaSxhKSx0aGlzLl9tb3ZlZD0hMCxpLnN0eWxlLndpZHRoPU1hdGgubWF4KDAsTWF0aC5hYnMocy54KS00KSsicHgiLGkuc3R5bGUuaGVpZ2h0PU1hdGgubWF4KDAsTWF0aC5hYnMocy55KS00KSsicHgifSxfZmluaXNoOmZ1bmN0aW9uKCl7dGhpcy5fcGFuZS5yZW1vdmVDaGlsZCh0aGlzLl9ib3gpLHRoaXMuX2NvbnRhaW5lci5zdHlsZS5jdXJzb3I9IiIsby5Eb21VdGlsLmVuYWJsZVRleHRTZWxlY3Rpb24oKSxvLkRvbVV0aWwuZW5hYmxlSW1hZ2VEcmFnKCksby5Eb21FdmVudC5vZmYoZSwibW91c2Vtb3ZlIix0aGlzLl9vbk1vdXNlTW92ZSkub2ZmKGUsIm1vdXNldXAiLHRoaXMuX29uTW91c2VVcCkub2ZmKGUsImtleWRvd24iLHRoaXMuX29uS2V5RG93bil9LF9vbk1vdXNlVXA6ZnVuY3Rpb24odCl7dGhpcy5fZmluaXNoKCk7dmFyIGU9dGhpcy5fbWFwLGk9ZS5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQpO2lmKCF0aGlzLl9zdGFydExheWVyUG9pbnQuZXF1YWxzKGkpKXt2YXIgbj1uZXcgby5MYXRMbmdCb3VuZHMoZS5sYXllclBvaW50VG9MYXRMbmcodGhpcy5fc3RhcnRMYXllclBvaW50KSxlLmxheWVyUG9pbnRUb0xhdExuZyhpKSk7ZS5maXRCb3VuZHMobiksZS5maXJlKCJib3h6b29tZW5kIix7Ym94Wm9vbUJvdW5kczpufSl9fSxfb25LZXlEb3duOmZ1bmN0aW9uKHQpezI3PT09dC5rZXlDb2RlJiZ0aGlzLl9maW5pc2goKX19KSxvLk1hcC5hZGRJbml0SG9vaygiYWRkSGFuZGxlciIsImJveFpvb20iLG8uTWFwLkJveFpvb20pLG8uTWFwLm1lcmdlT3B0aW9ucyh7a2V5Ym9hcmQ6ITAsa2V5Ym9hcmRQYW5PZmZzZXQ6ODAsa2V5Ym9hcmRab29tT2Zmc2V0OjF9KSxvLk1hcC5LZXlib2FyZD1vLkhhbmRsZXIuZXh0ZW5kKHtrZXlDb2Rlczp7bGVmdDpbMzddLHJpZ2h0OlszOV0sZG93bjpbNDBdLHVwOlszOF0sem9vbUluOlsxODcsMTA3LDYxLDE3MV0sem9vbU91dDpbMTg5LDEwOSwxNzNdfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10LHRoaXMuX3NldFBhbk9mZnNldCh0Lm9wdGlvbnMua2V5Ym9hcmRQYW5PZmZzZXQpLHRoaXMuX3NldFpvb21PZmZzZXQodC5vcHRpb25zLmtleWJvYXJkWm9vbU9mZnNldCl9LGFkZEhvb2tzOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLl9jb250YWluZXI7LTE9PT10LnRhYkluZGV4JiYodC50YWJJbmRleD0iMCIpLG8uRG9tRXZlbnQub24odCwiZm9jdXMiLHRoaXMuX29uRm9jdXMsdGhpcykub24odCwiYmx1ciIsdGhpcy5fb25CbHVyLHRoaXMpLm9uKHQsIm1vdXNlZG93biIsdGhpcy5fb25Nb3VzZURvd24sdGhpcyksdGhpcy5fbWFwLm9uKCJmb2N1cyIsdGhpcy5fYWRkSG9va3MsdGhpcykub24oImJsdXIiLHRoaXMuX3JlbW92ZUhvb2tzLHRoaXMpfSxyZW1vdmVIb29rczpmdW5jdGlvbigpe3RoaXMuX3JlbW92ZUhvb2tzKCk7dmFyIHQ9dGhpcy5fbWFwLl9jb250YWluZXI7by5Eb21FdmVudC5vZmYodCwiZm9jdXMiLHRoaXMuX29uRm9jdXMsdGhpcykub2ZmKHQsImJsdXIiLHRoaXMuX29uQmx1cix0aGlzKS5vZmYodCwibW91c2Vkb3duIix0aGlzLl9vbk1vdXNlRG93bix0aGlzKSx0aGlzLl9tYXAub2ZmKCJmb2N1cyIsdGhpcy5fYWRkSG9va3MsdGhpcykub2ZmKCJibHVyIix0aGlzLl9yZW1vdmVIb29rcyx0aGlzKX0sX29uTW91c2VEb3duOmZ1bmN0aW9uKCl7aWYoIXRoaXMuX2ZvY3VzZWQpe3ZhciBpPWUuYm9keSxuPWUuZG9jdW1lbnRFbGVtZW50LG89aS5zY3JvbGxUb3B8fG4uc2Nyb2xsVG9wLHM9aS5zY3JvbGxMZWZ0fHxuLnNjcm9sbExlZnQ7dGhpcy5fbWFwLl9jb250YWluZXIuZm9jdXMoKSx0LnNjcm9sbFRvKHMsbyl9fSxfb25Gb2N1czpmdW5jdGlvbigpe3RoaXMuX2ZvY3VzZWQ9ITAsdGhpcy5fbWFwLmZpcmUoImZvY3VzIil9LF9vbkJsdXI6ZnVuY3Rpb24oKXt0aGlzLl9mb2N1c2VkPSExLHRoaXMuX21hcC5maXJlKCJibHVyIil9LF9zZXRQYW5PZmZzZXQ6ZnVuY3Rpb24odCl7dmFyIGUsaSxuPXRoaXMuX3BhbktleXM9e30sbz10aGlzLmtleUNvZGVzO2ZvcihlPTAsaT1vLmxlZnQubGVuZ3RoO2k+ZTtlKyspbltvLmxlZnRbZV1dPVstMSp0LDBdO2ZvcihlPTAsaT1vLnJpZ2h0Lmxlbmd0aDtpPmU7ZSsrKW5bby5yaWdodFtlXV09W3QsMF07Zm9yKGU9MCxpPW8uZG93bi5sZW5ndGg7aT5lO2UrKyluW28uZG93bltlXV09WzAsdF07Zm9yKGU9MCxpPW8udXAubGVuZ3RoO2k+ZTtlKyspbltvLnVwW2VdXT1bMCwtMSp0XX0sX3NldFpvb21PZmZzZXQ6ZnVuY3Rpb24odCl7dmFyIGUsaSxuPXRoaXMuX3pvb21LZXlzPXt9LG89dGhpcy5rZXlDb2Rlcztmb3IoZT0wLGk9by56b29tSW4ubGVuZ3RoO2k+ZTtlKyspbltvLnpvb21JbltlXV09dDtmb3IoZT0wLGk9by56b29tT3V0Lmxlbmd0aDtpPmU7ZSsrKW5bby56b29tT3V0W2VdXT0tdH0sX2FkZEhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vbihlLCJrZXlkb3duIix0aGlzLl9vbktleURvd24sdGhpcyl9LF9yZW1vdmVIb29rczpmdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKGUsImtleWRvd24iLHRoaXMuX29uS2V5RG93bix0aGlzKX0sX29uS2V5RG93bjpmdW5jdGlvbih0KXt2YXIgZT10LmtleUNvZGUsaT10aGlzLl9tYXA7aWYoZSBpbiB0aGlzLl9wYW5LZXlzKXtpZihpLl9wYW5BbmltJiZpLl9wYW5BbmltLl9pblByb2dyZXNzKXJldHVybjtpLnBhbkJ5KHRoaXMuX3BhbktleXNbZV0pLGkub3B0aW9ucy5tYXhCb3VuZHMmJmkucGFuSW5zaWRlQm91bmRzKGkub3B0aW9ucy5tYXhCb3VuZHMpfWVsc2V7aWYoIShlIGluIHRoaXMuX3pvb21LZXlzKSlyZXR1cm47aS5zZXRab29tKGkuZ2V0Wm9vbSgpK3RoaXMuX3pvb21LZXlzW2VdKX1vLkRvbUV2ZW50LnN0b3AodCl9fSksby5NYXAuYWRkSW5pdEhvb2soImFkZEhhbmRsZXIiLCJrZXlib2FyZCIsby5NYXAuS2V5Ym9hcmQpLG8uSGFuZGxlci5NYXJrZXJEcmFnPW8uSGFuZGxlci5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCl7dGhpcy5fbWFya2VyPXR9LGFkZEhvb2tzOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFya2VyLl9pY29uO3RoaXMuX2RyYWdnYWJsZXx8KHRoaXMuX2RyYWdnYWJsZT1uZXcgby5EcmFnZ2FibGUodCx0KSksdGhpcy5fZHJhZ2dhYmxlLm9uKCJkcmFnc3RhcnQiLHRoaXMuX29uRHJhZ1N0YXJ0LHRoaXMpLm9uKCJkcmFnIix0aGlzLl9vbkRyYWcsdGhpcykub24oImRyYWdlbmQiLHRoaXMuX29uRHJhZ0VuZCx0aGlzKSx0aGlzLl9kcmFnZ2FibGUuZW5hYmxlKCksby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcmtlci5faWNvbiwibGVhZmxldC1tYXJrZXItZHJhZ2dhYmxlIil9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7dGhpcy5fZHJhZ2dhYmxlLm9mZigiZHJhZ3N0YXJ0Iix0aGlzLl9vbkRyYWdTdGFydCx0aGlzKS5vZmYoImRyYWciLHRoaXMuX29uRHJhZyx0aGlzKS5vZmYoImRyYWdlbmQiLHRoaXMuX29uRHJhZ0VuZCx0aGlzKSx0aGlzLl9kcmFnZ2FibGUuZGlzYWJsZSgpLG8uRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl9tYXJrZXIuX2ljb24sImxlYWZsZXQtbWFya2VyLWRyYWdnYWJsZSIpfSxtb3ZlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kcmFnZ2FibGUmJnRoaXMuX2RyYWdnYWJsZS5fbW92ZWR9LF9vbkRyYWdTdGFydDpmdW5jdGlvbigpe3RoaXMuX21hcmtlci5jbG9zZVBvcHVwKCkuZmlyZSgibW92ZXN0YXJ0IikuZmlyZSgiZHJhZ3N0YXJ0Iiksby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcmtlci5faWNvbiwibGVhZmxldC1tYXJrZXItZHJhZ2dpbmciKX0sX29uRHJhZzpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcmtlcixlPXQuX3NoYWRvdyxpPW8uRG9tVXRpbC5nZXRQb3NpdGlvbih0Ll9pY29uKSxuPXQuX21hcC5sYXllclBvaW50VG9MYXRMbmcoaSk7ZSYmby5Eb21VdGlsLnNldFBvc2l0aW9uKGUsaSksdC5fbGF0bG5nPW4sdC5maXJlKCJtb3ZlIix7bGF0bG5nOm59KS5maXJlKCJkcmFnIil9LF9vbkRyYWdFbmQ6ZnVuY3Rpb24oKXt0aGlzLl9tYXJrZXIuZmlyZSgibW92ZWVuZCIpLmZpcmUoImRyYWdlbmQiKSxvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fbWFya2VyLl9pY29uLCJsZWFmbGV0LW1hcmtlci1kcmFnZ2luZyIpfX0pLG8uQ29udHJvbD1vLkNsYXNzLmV4dGVuZCh7b3B0aW9uczp7cG9zaXRpb246InRvcHJpZ2h0In0saW5pdGlhbGl6ZTpmdW5jdGlvbih0KXtvLnNldE9wdGlvbnModGhpcyx0KX0sZ2V0UG9zaXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLnBvc2l0aW9ufSxzZXRQb3NpdGlvbjpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXA7cmV0dXJuIGUmJmUucmVtb3ZlQ29udHJvbCh0aGlzKSx0aGlzLm9wdGlvbnMucG9zaXRpb249dCxlJiZlLmFkZENvbnRyb2wodGhpcyksdGhpc30sZ2V0Q29udGFpbmVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2NvbnRhaW5lcn0sYWRkVG86ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXQ7dmFyIGU9dGhpcy5fY29udGFpbmVyPXRoaXMub25BZGQodCksaT10aGlzLmdldFBvc2l0aW9uKCksbj10Ll9jb250cm9sQ29ybmVyc1tpXTtyZXR1cm4gby5Eb21VdGlsLmFkZENsYXNzKGUsImxlYWZsZXQtY29udHJvbCIpLC0xIT09aS5pbmRleE9mKCJib3R0b20iKT9uLmluc2VydEJlZm9yZShlLG4uZmlyc3RDaGlsZCk6bi5hcHBlbmRDaGlsZChlKSx0aGlzfSxyZW1vdmVGcm9tOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuZ2V0UG9zaXRpb24oKSxpPXQuX2NvbnRyb2xDb3JuZXJzW2VdO3JldHVybiBpLnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRhaW5lciksdGhpcy5fbWFwPW51bGwsdGhpcy5vblJlbW92ZSYmdGhpcy5vblJlbW92ZSh0KSx0aGlzfX0pLG8uY29udHJvbD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uQ29udHJvbCh0KX0sby5NYXAuaW5jbHVkZSh7YWRkQ29udHJvbDpmdW5jdGlvbih0KXtyZXR1cm4gdC5hZGRUbyh0aGlzKSx0aGlzfSxyZW1vdmVDb250cm9sOmZ1bmN0aW9uKHQpe3JldHVybiB0LnJlbW92ZUZyb20odGhpcyksdGhpc30sX2luaXRDb250cm9sUG9zOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0LHMpe3ZhciBhPWkrdCsiICIraStzO2VbdCtzXT1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGEsbil9dmFyIGU9dGhpcy5fY29udHJvbENvcm5lcnM9e30saT0ibGVhZmxldC0iLG49dGhpcy5fY29udHJvbENvbnRhaW5lcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLGkrImNvbnRyb2wtY29udGFpbmVyIix0aGlzLl9jb250YWluZXIpO3QoInRvcCIsImxlZnQiKSx0KCJ0b3AiLCJyaWdodCIpLHQoImJvdHRvbSIsImxlZnQiKSx0KCJib3R0b20iLCJyaWdodCIpfSxfY2xlYXJDb250cm9sUG9zOmZ1bmN0aW9uKCl7dGhpcy5fY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuX2NvbnRyb2xDb250YWluZXIpfX0pLG8uQ29udHJvbC5ab29tPW8uQ29udHJvbC5leHRlbmQoe29wdGlvbnM6e3Bvc2l0aW9uOiJ0b3BsZWZ0Iix6b29tSW5UZXh0OiIrIix6b29tSW5UaXRsZToiWm9vbSBpbiIsem9vbU91dFRleHQ6Ii0iLHpvb21PdXRUaXRsZToiWm9vbSBvdXQifSxvbkFkZDpmdW5jdGlvbih0KXt2YXIgZT0ibGVhZmxldC1jb250cm9sLXpvb20iLGk9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKyIgbGVhZmxldC1iYXIiKTtyZXR1cm4gdGhpcy5fbWFwPXQsdGhpcy5fem9vbUluQnV0dG9uPXRoaXMuX2NyZWF0ZUJ1dHRvbih0aGlzLm9wdGlvbnMuem9vbUluVGV4dCx0aGlzLm9wdGlvbnMuem9vbUluVGl0bGUsZSsiLWluIixpLHRoaXMuX3pvb21Jbix0aGlzKSx0aGlzLl96b29tT3V0QnV0dG9uPXRoaXMuX2NyZWF0ZUJ1dHRvbih0aGlzLm9wdGlvbnMuem9vbU91dFRleHQsdGhpcy5vcHRpb25zLnpvb21PdXRUaXRsZSxlKyItb3V0IixpLHRoaXMuX3pvb21PdXQsdGhpcyksdC5vbigiem9vbWVuZCB6b29tbGV2ZWxzY2hhbmdlIix0aGlzLl91cGRhdGVEaXNhYmxlZCx0aGlzKSxpfSxvblJlbW92ZTpmdW5jdGlvbih0KXt0Lm9mZigiem9vbWVuZCB6b29tbGV2ZWxzY2hhbmdlIix0aGlzLl91cGRhdGVEaXNhYmxlZCx0aGlzKX0sX3pvb21JbjpmdW5jdGlvbih0KXt0aGlzLl9tYXAuem9vbUluKHQuc2hpZnRLZXk/MzoxKX0sX3pvb21PdXQ6ZnVuY3Rpb24odCl7dGhpcy5fbWFwLnpvb21PdXQodC5zaGlmdEtleT8zOjEpfSxfY3JlYXRlQnV0dG9uOmZ1bmN0aW9uKHQsZSxpLG4scyxhKXt2YXIgcj1vLkRvbVV0aWwuY3JlYXRlKCJhIixpLG4pO3IuaW5uZXJIVE1MPXQsci5ocmVmPSIjIixyLnRpdGxlPWU7dmFyIGg9by5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb247cmV0dXJuIG8uRG9tRXZlbnQub24ociwiY2xpY2siLGgpLm9uKHIsIm1vdXNlZG93biIsaCkub24ociwiZGJsY2xpY2siLGgpLm9uKHIsImNsaWNrIixvLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KS5vbihyLCJjbGljayIscyxhKSxyfSxfdXBkYXRlRGlzYWJsZWQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9tYXAsZT0ibGVhZmxldC1kaXNhYmxlZCI7by5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX3pvb21JbkJ1dHRvbixlKSxvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fem9vbU91dEJ1dHRvbixlKSx0Ll96b29tPT09dC5nZXRNaW5ab29tKCkmJm8uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl96b29tT3V0QnV0dG9uLGUpLHQuX3pvb209PT10LmdldE1heFpvb20oKSYmby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX3pvb21JbkJ1dHRvbixlKX19KSxvLk1hcC5tZXJnZU9wdGlvbnMoe3pvb21Db250cm9sOiEwfSksby5NYXAuYWRkSW5pdEhvb2soZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuem9vbUNvbnRyb2wmJih0aGlzLnpvb21Db250cm9sPW5ldyBvLkNvbnRyb2wuWm9vbSx0aGlzLmFkZENvbnRyb2wodGhpcy56b29tQ29udHJvbCkpfSksby5jb250cm9sLnpvb209ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBvLkNvbnRyb2wuWm9vbSh0KX0sby5Db250cm9sLkF0dHJpYnV0aW9uPW8uQ29udHJvbC5leHRlbmQoe29wdGlvbnM6e3Bvc2l0aW9uOiJib3R0b21yaWdodCIscHJlZml4Oic8YSBocmVmPSJodHRwOi8vbGVhZmxldGpzLmNvbSIgdGl0bGU9IkEgSlMgbGlicmFyeSBmb3IgaW50ZXJhY3RpdmUgbWFwcyI+TGVhZmxldDwvYT4nfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQpe28uc2V0T3B0aW9ucyh0aGlzLHQpLHRoaXMuX2F0dHJpYnV0aW9ucz17fX0sb25BZGQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2NvbnRhaW5lcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLCJsZWFmbGV0LWNvbnRyb2wtYXR0cmlidXRpb24iKSxvLkRvbUV2ZW50LmRpc2FibGVDbGlja1Byb3BhZ2F0aW9uKHRoaXMuX2NvbnRhaW5lciksdC5vbigibGF5ZXJhZGQiLHRoaXMuX29uTGF5ZXJBZGQsdGhpcykub24oImxheWVycmVtb3ZlIix0aGlzLl9vbkxheWVyUmVtb3ZlLHRoaXMpLHRoaXMuX3VwZGF0ZSgpLHRoaXMuX2NvbnRhaW5lcn0sb25SZW1vdmU6ZnVuY3Rpb24odCl7dC5vZmYoImxheWVyYWRkIix0aGlzLl9vbkxheWVyQWRkKS5vZmYoImxheWVycmVtb3ZlIix0aGlzLl9vbkxheWVyUmVtb3ZlKX0sc2V0UHJlZml4OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9wdGlvbnMucHJlZml4PXQsdGhpcy5fdXBkYXRlKCksdGhpc30sYWRkQXR0cmlidXRpb246ZnVuY3Rpb24odCl7cmV0dXJuIHQ/KHRoaXMuX2F0dHJpYnV0aW9uc1t0XXx8KHRoaXMuX2F0dHJpYnV0aW9uc1t0XT0wKSx0aGlzLl9hdHRyaWJ1dGlvbnNbdF0rKyx0aGlzLl91cGRhdGUoKSx0aGlzKTp2b2lkIDB9LHJlbW92ZUF0dHJpYnV0aW9uOmZ1bmN0aW9uKHQpe3JldHVybiB0Pyh0aGlzLl9hdHRyaWJ1dGlvbnNbdF0mJih0aGlzLl9hdHRyaWJ1dGlvbnNbdF0tLSx0aGlzLl91cGRhdGUoKSksdGhpcyk6dm9pZCAwfSxfdXBkYXRlOmZ1bmN0aW9uKCl7aWYodGhpcy5fbWFwKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gdGhpcy5fYXR0cmlidXRpb25zKXRoaXMuX2F0dHJpYnV0aW9uc1tlXSYmdC5wdXNoKGUpO3ZhciBpPVtdO3RoaXMub3B0aW9ucy5wcmVmaXgmJmkucHVzaCh0aGlzLm9wdGlvbnMucHJlZml4KSx0Lmxlbmd0aCYmaS5wdXNoKHQuam9pbigiLCAiKSksdGhpcy5fY29udGFpbmVyLmlubmVySFRNTD1pLmpvaW4oIiB8ICIpfX0sX29uTGF5ZXJBZGQ6ZnVuY3Rpb24odCl7dC5sYXllci5nZXRBdHRyaWJ1dGlvbiYmdGhpcy5hZGRBdHRyaWJ1dGlvbih0LmxheWVyLmdldEF0dHJpYnV0aW9uKCkpfSxfb25MYXllclJlbW92ZTpmdW5jdGlvbih0KXt0LmxheWVyLmdldEF0dHJpYnV0aW9uJiZ0aGlzLnJlbW92ZUF0dHJpYnV0aW9uKHQubGF5ZXIuZ2V0QXR0cmlidXRpb24oKSl9fSksby5NYXAubWVyZ2VPcHRpb25zKHthdHRyaWJ1dGlvbkNvbnRyb2w6ITB9KSxvLk1hcC5hZGRJbml0SG9vayhmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5hdHRyaWJ1dGlvbkNvbnRyb2wmJih0aGlzLmF0dHJpYnV0aW9uQ29udHJvbD0obmV3IG8uQ29udHJvbC5BdHRyaWJ1dGlvbikuYWRkVG8odGhpcykpfSksby5jb250cm9sLmF0dHJpYnV0aW9uPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5Db250cm9sLkF0dHJpYnV0aW9uKHQpfSxvLkNvbnRyb2wuU2NhbGU9by5Db250cm9sLmV4dGVuZCh7b3B0aW9uczp7cG9zaXRpb246ImJvdHRvbWxlZnQiLG1heFdpZHRoOjEwMCxtZXRyaWM6ITAsaW1wZXJpYWw6ITAsdXBkYXRlV2hlbklkbGU6ITF9LG9uQWRkOmZ1bmN0aW9uKHQpe3RoaXMuX21hcD10O3ZhciBlPSJsZWFmbGV0LWNvbnRyb2wtc2NhbGUiLGk9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKSxuPXRoaXMub3B0aW9ucztyZXR1cm4gdGhpcy5fYWRkU2NhbGVzKG4sZSxpKSx0Lm9uKG4udXBkYXRlV2hlbklkbGU/Im1vdmVlbmQiOiJtb3ZlIix0aGlzLl91cGRhdGUsdGhpcyksdC53aGVuUmVhZHkodGhpcy5fdXBkYXRlLHRoaXMpLGl9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3Qub2ZmKHRoaXMub3B0aW9ucy51cGRhdGVXaGVuSWRsZT8ibW92ZWVuZCI6Im1vdmUiLHRoaXMuX3VwZGF0ZSx0aGlzKX0sX2FkZFNjYWxlczpmdW5jdGlvbih0LGUsaSl7dC5tZXRyaWMmJih0aGlzLl9tU2NhbGU9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKyItbGluZSIsaSkpLHQuaW1wZXJpYWwmJih0aGlzLl9pU2NhbGU9by5Eb21VdGlsLmNyZWF0ZSgiZGl2IixlKyItbGluZSIsaSkpfSxfdXBkYXRlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLmdldEJvdW5kcygpLGU9dC5nZXRDZW50ZXIoKS5sYXQsaT02Mzc4MTM3Kk1hdGguUEkqTWF0aC5jb3MoZSpNYXRoLlBJLzE4MCksbj1pKih0LmdldE5vcnRoRWFzdCgpLmxuZy10LmdldFNvdXRoV2VzdCgpLmxuZykvMTgwLG89dGhpcy5fbWFwLmdldFNpemUoKSxzPXRoaXMub3B0aW9ucyxhPTA7by54PjAmJihhPW4qKHMubWF4V2lkdGgvby54KSksdGhpcy5fdXBkYXRlU2NhbGVzKHMsYSl9LF91cGRhdGVTY2FsZXM6ZnVuY3Rpb24odCxlKXt0Lm1ldHJpYyYmZSYmdGhpcy5fdXBkYXRlTWV0cmljKGUpLHQuaW1wZXJpYWwmJmUmJnRoaXMuX3VwZGF0ZUltcGVyaWFsKGUpfSxfdXBkYXRlTWV0cmljOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2dldFJvdW5kTnVtKHQpO3RoaXMuX21TY2FsZS5zdHlsZS53aWR0aD10aGlzLl9nZXRTY2FsZVdpZHRoKGUvdCkrInB4Iix0aGlzLl9tU2NhbGUuaW5uZXJIVE1MPTFlMz5lP2UrIiBtIjplLzFlMysiIGttIn0sX3VwZGF0ZUltcGVyaWFsOmZ1bmN0aW9uKHQpe3ZhciBlLGksbixvPTMuMjgwODM5OSp0LHM9dGhpcy5faVNjYWxlO28+NTI4MD8oZT1vLzUyODAsaT10aGlzLl9nZXRSb3VuZE51bShlKSxzLnN0eWxlLndpZHRoPXRoaXMuX2dldFNjYWxlV2lkdGgoaS9lKSsicHgiLHMuaW5uZXJIVE1MPWkrIiBtaSIpOihuPXRoaXMuX2dldFJvdW5kTnVtKG8pLHMuc3R5bGUud2lkdGg9dGhpcy5fZ2V0U2NhbGVXaWR0aChuL28pKyJweCIscy5pbm5lckhUTUw9bisiIGZ0Iil9LF9nZXRTY2FsZVdpZHRoOmZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnJvdW5kKHRoaXMub3B0aW9ucy5tYXhXaWR0aCp0KS0xMH0sX2dldFJvdW5kTnVtOmZ1bmN0aW9uKHQpe3ZhciBlPU1hdGgucG93KDEwLChNYXRoLmZsb29yKHQpKyIiKS5sZW5ndGgtMSksaT10L2U7cmV0dXJuIGk9aT49MTA/MTA6aT49NT81Omk+PTM/MzppPj0yPzI6MSxlKml9fSksby5jb250cm9sLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5Db250cm9sLlNjYWxlKHQpfSxvLkNvbnRyb2wuTGF5ZXJzPW8uQ29udHJvbC5leHRlbmQoe29wdGlvbnM6e2NvbGxhcHNlZDohMCxwb3NpdGlvbjoidG9wcmlnaHQiLGF1dG9aSW5kZXg6ITB9LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlLGkpe28uc2V0T3B0aW9ucyh0aGlzLGkpLHRoaXMuX2xheWVycz17fSx0aGlzLl9sYXN0WkluZGV4PTAsdGhpcy5faGFuZGxpbmdDbGljaz0hMTtmb3IodmFyIG4gaW4gdCl0aGlzLl9hZGRMYXllcih0W25dLG4pO2ZvcihuIGluIGUpdGhpcy5fYWRkTGF5ZXIoZVtuXSxuLCEwKX0sb25BZGQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2luaXRMYXlvdXQoKSx0aGlzLl91cGRhdGUoKSx0Lm9uKCJsYXllcmFkZCIsdGhpcy5fb25MYXllckNoYW5nZSx0aGlzKS5vbigibGF5ZXJyZW1vdmUiLHRoaXMuX29uTGF5ZXJDaGFuZ2UsdGhpcyksdGhpcy5fY29udGFpbmVyfSxvblJlbW92ZTpmdW5jdGlvbih0KXt0Lm9mZigibGF5ZXJhZGQiLHRoaXMuX29uTGF5ZXJDaGFuZ2UpLm9mZigibGF5ZXJyZW1vdmUiLHRoaXMuX29uTGF5ZXJDaGFuZ2UpfSxhZGRCYXNlTGF5ZXI6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5fYWRkTGF5ZXIodCxlKSx0aGlzLl91cGRhdGUoKSx0aGlzfSxhZGRPdmVybGF5OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX2FkZExheWVyKHQsZSwhMCksdGhpcy5fdXBkYXRlKCksdGhpc30scmVtb3ZlTGF5ZXI6ZnVuY3Rpb24odCl7dmFyIGU9by5zdGFtcCh0KTtyZXR1cm4gZGVsZXRlIHRoaXMuX2xheWVyc1tlXSx0aGlzLl91cGRhdGUoKSx0aGlzfSxfaW5pdExheW91dDpmdW5jdGlvbigpe3ZhciB0PSJsZWFmbGV0LWNvbnRyb2wtbGF5ZXJzIixlPXRoaXMuX2NvbnRhaW5lcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLHQpO2Uuc2V0QXR0cmlidXRlKCJhcmlhLWhhc3BvcHVwIiwhMCksby5Ccm93c2VyLnRvdWNoP28uRG9tRXZlbnQub24oZSwiY2xpY2siLG8uRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKTooby5Eb21FdmVudC5kaXNhYmxlQ2xpY2tQcm9wYWdhdGlvbihlKSxvLkRvbUV2ZW50Lm9uKGUsIm1vdXNld2hlZWwiLG8uRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKSk7dmFyIGk9dGhpcy5fZm9ybT1vLkRvbVV0aWwuY3JlYXRlKCJmb3JtIix0KyItbGlzdCIpO2lmKHRoaXMub3B0aW9ucy5jb2xsYXBzZWQpe28uQnJvd3Nlci5hbmRyb2lkfHxvLkRvbUV2ZW50Lm9uKGUsIm1vdXNlb3ZlciIsdGhpcy5fZXhwYW5kLHRoaXMpLm9uKGUsIm1vdXNlb3V0Iix0aGlzLl9jb2xsYXBzZSx0aGlzKTt2YXIgbj10aGlzLl9sYXllcnNMaW5rPW8uRG9tVXRpbC5jcmVhdGUoImEiLHQrIi10b2dnbGUiLGUpO24uaHJlZj0iIyIsbi50aXRsZT0iTGF5ZXJzIixvLkJyb3dzZXIudG91Y2g/by5Eb21FdmVudC5vbihuLCJjbGljayIsby5Eb21FdmVudC5zdG9wKS5vbihuLCJjbGljayIsdGhpcy5fZXhwYW5kLHRoaXMpOm8uRG9tRXZlbnQub24obiwiZm9jdXMiLHRoaXMuX2V4cGFuZCx0aGlzKSx0aGlzLl9tYXAub24oImNsaWNrIix0aGlzLl9jb2xsYXBzZSx0aGlzKX1lbHNlIHRoaXMuX2V4cGFuZCgpO3RoaXMuX2Jhc2VMYXllcnNMaXN0PW8uRG9tVXRpbC5jcmVhdGUoImRpdiIsdCsiLWJhc2UiLGkpLHRoaXMuX3NlcGFyYXRvcj1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLHQrIi1zZXBhcmF0b3IiLGkpLHRoaXMuX292ZXJsYXlzTGlzdD1vLkRvbVV0aWwuY3JlYXRlKCJkaXYiLHQrIi1vdmVybGF5cyIsaSksZS5hcHBlbmRDaGlsZChpKX0sX2FkZExheWVyOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbj1vLnN0YW1wKHQpO3RoaXMuX2xheWVyc1tuXT17bGF5ZXI6dCxuYW1lOmUsb3ZlcmxheTppfSx0aGlzLm9wdGlvbnMuYXV0b1pJbmRleCYmdC5zZXRaSW5kZXgmJih0aGlzLl9sYXN0WkluZGV4KyssdC5zZXRaSW5kZXgodGhpcy5fbGFzdFpJbmRleCkpfSxfdXBkYXRlOmZ1bmN0aW9uKCl7aWYodGhpcy5fY29udGFpbmVyKXt0aGlzLl9iYXNlTGF5ZXJzTGlzdC5pbm5lckhUTUw9IiIsdGhpcy5fb3ZlcmxheXNMaXN0LmlubmVySFRNTD0iIjt2YXIgdCxlLGk9ITEsbj0hMTtmb3IodCBpbiB0aGlzLl9sYXllcnMpZT10aGlzLl9sYXllcnNbdF0sdGhpcy5fYWRkSXRlbShlKSxuPW58fGUub3ZlcmxheSxpPWl8fCFlLm92ZXJsYXk7dGhpcy5fc2VwYXJhdG9yLnN0eWxlLmRpc3BsYXk9biYmaT8iIjoibm9uZSJ9fSxfb25MYXllckNoYW5nZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9sYXllcnNbby5zdGFtcCh0LmxheWVyKV07aWYoZSl7dGhpcy5faGFuZGxpbmdDbGlja3x8dGhpcy5fdXBkYXRlKCk7dmFyIGk9ZS5vdmVybGF5PyJsYXllcmFkZCI9PT10LnR5cGU/Im92ZXJsYXlhZGQiOiJvdmVybGF5cmVtb3ZlIjoibGF5ZXJhZGQiPT09dC50eXBlPyJiYXNlbGF5ZXJjaGFuZ2UiOm51bGw7aSYmdGhpcy5fbWFwLmZpcmUoaSxlKX19LF9jcmVhdGVSYWRpb0VsZW1lbnQ6ZnVuY3Rpb24odCxpKXt2YXIgbj0nPGlucHV0IHR5cGU9InJhZGlvIiBjbGFzcz0ibGVhZmxldC1jb250cm9sLWxheWVycy1zZWxlY3RvciIgbmFtZT0iJyt0KyciJztpJiYobis9JyBjaGVja2VkPSJjaGVja2VkIicpLG4rPSIvPiI7dmFyIG89ZS5jcmVhdGVFbGVtZW50KCJkaXYiKTtyZXR1cm4gby5pbm5lckhUTUw9bixvLmZpcnN0Q2hpbGR9LF9hZGRJdGVtOmZ1bmN0aW9uKHQpe3ZhciBpLG49ZS5jcmVhdGVFbGVtZW50KCJsYWJlbCIpLHM9dGhpcy5fbWFwLmhhc0xheWVyKHQubGF5ZXIpO3Qub3ZlcmxheT8oaT1lLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksaS50eXBlPSJjaGVja2JveCIsaS5jbGFzc05hbWU9ImxlYWZsZXQtY29udHJvbC1sYXllcnMtc2VsZWN0b3IiLGkuZGVmYXVsdENoZWNrZWQ9cyk6aT10aGlzLl9jcmVhdGVSYWRpb0VsZW1lbnQoImxlYWZsZXQtYmFzZS1sYXllcnMiLHMpLGkubGF5ZXJJZD1vLnN0YW1wKHQubGF5ZXIpLG8uRG9tRXZlbnQub24oaSwiY2xpY2siLHRoaXMuX29uSW5wdXRDbGljayx0aGlzKTt2YXIgYT1lLmNyZWF0ZUVsZW1lbnQoInNwYW4iKTthLmlubmVySFRNTD0iICIrdC5uYW1lLG4uYXBwZW5kQ2hpbGQoaSksbi5hcHBlbmRDaGlsZChhKTt2YXIgcj10Lm92ZXJsYXk/dGhpcy5fb3ZlcmxheXNMaXN0OnRoaXMuX2Jhc2VMYXllcnNMaXN0O3JldHVybiByLmFwcGVuZENoaWxkKG4pLG59LF9vbklucHV0Q2xpY2s6ZnVuY3Rpb24oKXt2YXIgdCxlLGksbj10aGlzLl9mb3JtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbnB1dCIpLG89bi5sZW5ndGg7Zm9yKHRoaXMuX2hhbmRsaW5nQ2xpY2s9ITAsdD0wO28+dDt0KyspZT1uW3RdLGk9dGhpcy5fbGF5ZXJzW2UubGF5ZXJJZF0sZS5jaGVja2VkJiYhdGhpcy5fbWFwLmhhc0xheWVyKGkubGF5ZXIpP3RoaXMuX21hcC5hZGRMYXllcihpLmxheWVyKTohZS5jaGVja2VkJiZ0aGlzLl9tYXAuaGFzTGF5ZXIoaS5sYXllcikmJnRoaXMuX21hcC5yZW1vdmVMYXllcihpLmxheWVyKTt0aGlzLl9oYW5kbGluZ0NsaWNrPSExfSxfZXhwYW5kOmZ1bmN0aW9uKCl7by5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2NvbnRhaW5lciwibGVhZmxldC1jb250cm9sLWxheWVycy1leHBhbmRlZCIpfSxfY29sbGFwc2U6ZnVuY3Rpb24oKXt0aGlzLl9jb250YWluZXIuY2xhc3NOYW1lPXRoaXMuX2NvbnRhaW5lci5jbGFzc05hbWUucmVwbGFjZSgiIGxlYWZsZXQtY29udHJvbC1sYXllcnMtZXhwYW5kZWQiLCIiKX19KSxvLmNvbnRyb2wubGF5ZXJzPWZ1bmN0aW9uKHQsZSxpKXtyZXR1cm4gbmV3IG8uQ29udHJvbC5MYXllcnModCxlLGkpfSxvLlBvc0FuaW1hdGlvbj1vLkNsYXNzLmV4dGVuZCh7aW5jbHVkZXM6by5NaXhpbi5FdmVudHMscnVuOmZ1bmN0aW9uKHQsZSxpLG4pe3RoaXMuc3RvcCgpLHRoaXMuX2VsPXQsdGhpcy5faW5Qcm9ncmVzcz0hMCx0aGlzLl9uZXdQb3M9ZSx0aGlzLmZpcmUoInN0YXJ0IiksdC5zdHlsZVtvLkRvbVV0aWwuVFJBTlNJVElPTl09ImFsbCAiKyhpfHwuMjUpKyJzIGN1YmljLWJlemllcigwLDAsIisobnx8LjUpKyIsMSkiLG8uRG9tRXZlbnQub24odCxvLkRvbVV0aWwuVFJBTlNJVElPTl9FTkQsdGhpcy5fb25UcmFuc2l0aW9uRW5kLHRoaXMpLG8uRG9tVXRpbC5zZXRQb3NpdGlvbih0LGUpLG8uVXRpbC5mYWxzZUZuKHQub2Zmc2V0V2lkdGgpLHRoaXMuX3N0ZXBUaW1lcj1zZXRJbnRlcnZhbChvLmJpbmQodGhpcy5fb25TdGVwLHRoaXMpLDUwKX0sc3RvcDpmdW5jdGlvbigpe3RoaXMuX2luUHJvZ3Jlc3MmJihvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fZWwsdGhpcy5fZ2V0UG9zKCkpLHRoaXMuX29uVHJhbnNpdGlvbkVuZCgpLG8uVXRpbC5mYWxzZUZuKHRoaXMuX2VsLm9mZnNldFdpZHRoKSl9LF9vblN0ZXA6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9nZXRQb3MoKTtyZXR1cm4gdD8odGhpcy5fZWwuX2xlYWZsZXRfcG9zPXQsdGhpcy5maXJlKCJzdGVwIiksdm9pZCAwKToodGhpcy5fb25UcmFuc2l0aW9uRW5kKCksdm9pZCAwKX0sX3RyYW5zZm9ybVJlOi8oWy0rXT8oPzpcZCpcLik/XGQrKVxEKiwgKFstK10/KD86XGQqXC4pP1xkKylcRCpcKS8sX2dldFBvczpmdW5jdGlvbigpe3ZhciBlLGksbixzPXRoaXMuX2VsLGE9dC5nZXRDb21wdXRlZFN0eWxlKHMpO2lmKG8uQnJvd3Nlci5hbnkzZCl7aWYobj1hW28uRG9tVXRpbC5UUkFOU0ZPUk1dLm1hdGNoKHRoaXMuX3RyYW5zZm9ybVJlKSwhbilyZXR1cm47ZT1wYXJzZUZsb2F0KG5bMV0pLGk9cGFyc2VGbG9hdChuWzJdKX1lbHNlIGU9cGFyc2VGbG9hdChhLmxlZnQpLGk9cGFyc2VGbG9hdChhLnRvcCk7cmV0dXJuIG5ldyBvLlBvaW50KGUsaSwhMCl9LF9vblRyYW5zaXRpb25FbmQ6ZnVuY3Rpb24oKXtvLkRvbUV2ZW50Lm9mZih0aGlzLl9lbCxvLkRvbVV0aWwuVFJBTlNJVElPTl9FTkQsdGhpcy5fb25UcmFuc2l0aW9uRW5kLHRoaXMpLHRoaXMuX2luUHJvZ3Jlc3MmJih0aGlzLl9pblByb2dyZXNzPSExLHRoaXMuX2VsLnN0eWxlW28uRG9tVXRpbC5UUkFOU0lUSU9OXT0iIix0aGlzLl9lbC5fbGVhZmxldF9wb3M9dGhpcy5fbmV3UG9zLGNsZWFySW50ZXJ2YWwodGhpcy5fc3RlcFRpbWVyKSx0aGlzLmZpcmUoInN0ZXAiKS5maXJlKCJlbmQiKSl9fSksby5NYXAuaW5jbHVkZSh7c2V0VmlldzpmdW5jdGlvbih0LGUsbil7aWYoZT1lPT09aT90aGlzLl96b29tOnRoaXMuX2xpbWl0Wm9vbShlKSx0PW8ubGF0TG5nKHQpLG49bnx8e30sdGhpcy5fcGFuQW5pbSYmdGhpcy5fcGFuQW5pbS5zdG9wKCksdGhpcy5fbG9hZGVkJiYhbi5yZXNldCYmbiE9PSEwKXtuLmFuaW1hdGUhPT1pJiYobi56b29tPW8uZXh0ZW5kKHthbmltYXRlOm4uYW5pbWF0ZX0sbi56b29tKSxuLnBhbj1vLmV4dGVuZCh7YW5pbWF0ZTpuLmFuaW1hdGV9LG4ucGFuKSk7dmFyIHM9dGhpcy5fem9vbSE9PWU/dGhpcy5fdHJ5QW5pbWF0ZWRab29tJiZ0aGlzLl90cnlBbmltYXRlZFpvb20odCxlLG4uem9vbSk6dGhpcy5fdHJ5QW5pbWF0ZWRQYW4odCxuLnBhbik7aWYocylyZXR1cm4gY2xlYXJUaW1lb3V0KHRoaXMuX3NpemVUaW1lciksdGhpc31yZXR1cm4gdGhpcy5fcmVzZXRWaWV3KHQsZSksdGhpc30scGFuQnk6ZnVuY3Rpb24odCxlKXtpZih0PW8ucG9pbnQodCkucm91bmQoKSxlPWV8fHt9LCF0LngmJiF0LnkpcmV0dXJuIHRoaXM7aWYodGhpcy5fcGFuQW5pbXx8KHRoaXMuX3BhbkFuaW09bmV3IG8uUG9zQW5pbWF0aW9uLHRoaXMuX3BhbkFuaW0ub24oe3N0ZXA6dGhpcy5fb25QYW5UcmFuc2l0aW9uU3RlcCxlbmQ6dGhpcy5fb25QYW5UcmFuc2l0aW9uRW5kfSx0aGlzKSksZS5ub01vdmVTdGFydHx8dGhpcy5maXJlKCJtb3Zlc3RhcnQiKSxlLmFuaW1hdGUhPT0hMSl7by5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcFBhbmUsImxlYWZsZXQtcGFuLWFuaW0iKTt2YXIgaT10aGlzLl9nZXRNYXBQYW5lUG9zKCkuc3VidHJhY3QodCk7dGhpcy5fcGFuQW5pbS5ydW4odGhpcy5fbWFwUGFuZSxpLGUuZHVyYXRpb258fC4yNSxlLmVhc2VMaW5lYXJpdHkpfWVsc2UgdGhpcy5fcmF3UGFuQnkodCksdGhpcy5maXJlKCJtb3ZlIikuZmlyZSgibW92ZWVuZCIpO3JldHVybiB0aGlzfSxfb25QYW5UcmFuc2l0aW9uU3RlcDpmdW5jdGlvbigpe3RoaXMuZmlyZSgibW92ZSIpfSxfb25QYW5UcmFuc2l0aW9uRW5kOmZ1bmN0aW9uKCl7by5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX21hcFBhbmUsImxlYWZsZXQtcGFuLWFuaW0iKSx0aGlzLmZpcmUoIm1vdmVlbmQiKX0sX3RyeUFuaW1hdGVkUGFuOmZ1bmN0aW9uKHQsZSl7dmFyIGk9dGhpcy5fZ2V0Q2VudGVyT2Zmc2V0KHQpLl9mbG9vcigpO3JldHVybihlJiZlLmFuaW1hdGUpPT09ITB8fHRoaXMuZ2V0U2l6ZSgpLmNvbnRhaW5zKGkpPyh0aGlzLnBhbkJ5KGksZSksITApOiExfX0pLG8uUG9zQW5pbWF0aW9uPW8uRG9tVXRpbC5UUkFOU0lUSU9OP28uUG9zQW5pbWF0aW9uOm8uUG9zQW5pbWF0aW9uLmV4dGVuZCh7cnVuOmZ1bmN0aW9uKHQsZSxpLG4pe3RoaXMuc3RvcCgpLHRoaXMuX2VsPXQsdGhpcy5faW5Qcm9ncmVzcz0hMCx0aGlzLl9kdXJhdGlvbj1pfHwuMjUsdGhpcy5fZWFzZU91dFBvd2VyPTEvTWF0aC5tYXgobnx8LjUsLjIpLHRoaXMuX3N0YXJ0UG9zPW8uRG9tVXRpbC5nZXRQb3NpdGlvbih0KSx0aGlzLl9vZmZzZXQ9ZS5zdWJ0cmFjdCh0aGlzLl9zdGFydFBvcyksdGhpcy5fc3RhcnRUaW1lPStuZXcgRGF0ZSx0aGlzLmZpcmUoInN0YXJ0IiksdGhpcy5fYW5pbWF0ZSgpfSxzdG9wOmZ1bmN0aW9uKCl7dGhpcy5faW5Qcm9ncmVzcyYmKHRoaXMuX3N0ZXAoKSx0aGlzLl9jb21wbGV0ZSgpKX0sX2FuaW1hdGU6ZnVuY3Rpb24oKXt0aGlzLl9hbmltSWQ9by5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fYW5pbWF0ZSx0aGlzKSx0aGlzLl9zdGVwKCl9LF9zdGVwOmZ1bmN0aW9uKCl7dmFyIHQ9K25ldyBEYXRlLXRoaXMuX3N0YXJ0VGltZSxlPTFlMyp0aGlzLl9kdXJhdGlvbjtlPnQ/dGhpcy5fcnVuRnJhbWUodGhpcy5fZWFzZU91dCh0L2UpKToodGhpcy5fcnVuRnJhbWUoMSksdGhpcy5fY29tcGxldGUoKSl9LF9ydW5GcmFtZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9zdGFydFBvcy5hZGQodGhpcy5fb2Zmc2V0Lm11bHRpcGx5QnkodCkpO28uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9lbCxlKSx0aGlzLmZpcmUoInN0ZXAiKX0sX2NvbXBsZXRlOmZ1bmN0aW9uKCl7by5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltSWQpLHRoaXMuX2luUHJvZ3Jlc3M9ITEsdGhpcy5maXJlKCJlbmQiKX0sX2Vhc2VPdXQ6ZnVuY3Rpb24odCl7cmV0dXJuIDEtTWF0aC5wb3coMS10LHRoaXMuX2Vhc2VPdXRQb3dlcil9fSksby5NYXAubWVyZ2VPcHRpb25zKHt6b29tQW5pbWF0aW9uOiEwLHpvb21BbmltYXRpb25UaHJlc2hvbGQ6NH0pLG8uRG9tVXRpbC5UUkFOU0lUSU9OJiZvLk1hcC5hZGRJbml0SG9vayhmdW5jdGlvbigpe3RoaXMuX3pvb21BbmltYXRlZD10aGlzLm9wdGlvbnMuem9vbUFuaW1hdGlvbiYmby5Eb21VdGlsLlRSQU5TSVRJT04mJm8uQnJvd3Nlci5hbnkzZCYmIW8uQnJvd3Nlci5hbmRyb2lkMjMmJiFvLkJyb3dzZXIubW9iaWxlT3BlcmEsdGhpcy5fem9vbUFuaW1hdGVkJiZvLkRvbUV2ZW50Lm9uKHRoaXMuX21hcFBhbmUsby5Eb21VdGlsLlRSQU5TSVRJT05fRU5ELHRoaXMuX2NhdGNoVHJhbnNpdGlvbkVuZCx0aGlzKX0pLG8uTWFwLmluY2x1ZGUoby5Eb21VdGlsLlRSQU5TSVRJT04/e19jYXRjaFRyYW5zaXRpb25FbmQ6ZnVuY3Rpb24oKXt0aGlzLl9hbmltYXRpbmdab29tJiZ0aGlzLl9vblpvb21UcmFuc2l0aW9uRW5kKCl9LF9ub3RoaW5nVG9BbmltYXRlOmZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMuX2NvbnRhaW5lci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJsZWFmbGV0LXpvb20tYW5pbWF0ZWQiKS5sZW5ndGh9LF90cnlBbmltYXRlZFpvb206ZnVuY3Rpb24odCxlLGkpe2lmKHRoaXMuX2FuaW1hdGluZ1pvb20pcmV0dXJuITA7aWYoaT1pfHx7fSwhdGhpcy5fem9vbUFuaW1hdGVkfHxpLmFuaW1hdGU9PT0hMXx8dGhpcy5fbm90aGluZ1RvQW5pbWF0ZSgpfHxNYXRoLmFicyhlLXRoaXMuX3pvb20pPnRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uVGhyZXNob2xkKXJldHVybiExO3ZhciBuPXRoaXMuZ2V0Wm9vbVNjYWxlKGUpLG89dGhpcy5fZ2V0Q2VudGVyT2Zmc2V0KHQpLl9kaXZpZGVCeSgxLTEvbikscz10aGlzLl9nZXRDZW50ZXJMYXllclBvaW50KCkuX2FkZChvKTtyZXR1cm4gaS5hbmltYXRlPT09ITB8fHRoaXMuZ2V0U2l6ZSgpLmNvbnRhaW5zKG8pPyh0aGlzLmZpcmUoIm1vdmVzdGFydCIpLmZpcmUoInpvb21zdGFydCIpLHRoaXMuX2FuaW1hdGVab29tKHQsZSxzLG4sbnVsbCwhMCksITApOiExfSxfYW5pbWF0ZVpvb206ZnVuY3Rpb24odCxlLGksbixzLGEpe3RoaXMuX2FuaW1hdGluZ1pvb209ITAsby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcFBhbmUsImxlYWZsZXQtem9vbS1hbmltIiksdGhpcy5fYW5pbWF0ZVRvQ2VudGVyPXQsdGhpcy5fYW5pbWF0ZVRvWm9vbT1lLG8uRHJhZ2dhYmxlJiYoby5EcmFnZ2FibGUuX2Rpc2FibGVkPSEwKSx0aGlzLmZpcmUoInpvb21hbmltIix7Y2VudGVyOnQsem9vbTplLG9yaWdpbjppLHNjYWxlOm4sZGVsdGE6cyxiYWNrd2FyZHM6YX0pfSxfb25ab29tVHJhbnNpdGlvbkVuZDpmdW5jdGlvbigpe3RoaXMuX2FuaW1hdGluZ1pvb209ITEsby5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX21hcFBhbmUsImxlYWZsZXQtem9vbS1hbmltIiksdGhpcy5fcmVzZXRWaWV3KHRoaXMuX2FuaW1hdGVUb0NlbnRlcix0aGlzLl9hbmltYXRlVG9ab29tLCEwLCEwKSxvLkRyYWdnYWJsZSYmKG8uRHJhZ2dhYmxlLl9kaXNhYmxlZD0hMSl9fTp7fSksby5UaWxlTGF5ZXIuaW5jbHVkZSh7X2FuaW1hdGVab29tOmZ1bmN0aW9uKHQpe3RoaXMuX2FuaW1hdGluZ3x8KHRoaXMuX2FuaW1hdGluZz0hMCx0aGlzLl9wcmVwYXJlQmdCdWZmZXIoKSk7dmFyIGU9dGhpcy5fYmdCdWZmZXIsaT1vLkRvbVV0aWwuVFJBTlNGT1JNLG49dC5kZWx0YT9vLkRvbVV0aWwuZ2V0VHJhbnNsYXRlU3RyaW5nKHQuZGVsdGEpOmUuc3R5bGVbaV0scz1vLkRvbVV0aWwuZ2V0U2NhbGVTdHJpbmcodC5zY2FsZSx0Lm9yaWdpbik7ZS5zdHlsZVtpXT10LmJhY2t3YXJkcz9zKyIgIituOm4rIiAiK3N9LF9lbmRab29tQW5pbTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3RpbGVDb250YWluZXIsZT10aGlzLl9iZ0J1ZmZlcjt0LnN0eWxlLnZpc2liaWxpdHk9IiIsdC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKHQpLG8uVXRpbC5mYWxzZUZuKGUub2Zmc2V0V2lkdGgpLHRoaXMuX2FuaW1hdGluZz0hMX0sX2NsZWFyQmdCdWZmZXI6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9tYXA7IXR8fHQuX2FuaW1hdGluZ1pvb218fHQudG91Y2hab29tLl96b29taW5nfHwodGhpcy5fYmdCdWZmZXIuaW5uZXJIVE1MPSIiLHRoaXMuX2JnQnVmZmVyLnN0eWxlW28uRG9tVXRpbC5UUkFOU0ZPUk1dPSIiKX0sX3ByZXBhcmVCZ0J1ZmZlcjpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3RpbGVDb250YWluZXIsZT10aGlzLl9iZ0J1ZmZlcixpPXRoaXMuX2dldExvYWRlZFRpbGVzUGVyY2VudGFnZShlKSxuPXRoaXMuX2dldExvYWRlZFRpbGVzUGVyY2VudGFnZSh0KTtyZXR1cm4gZSYmaT4uNSYmLjU+bj8odC5zdHlsZS52aXNpYmlsaXR5PSJoaWRkZW4iLHRoaXMuX3N0b3BMb2FkaW5nSW1hZ2VzKHQpLHZvaWQgMCk6KGUuc3R5bGUudmlzaWJpbGl0eT0iaGlkZGVuIixlLnN0eWxlW28uRG9tVXRpbC5UUkFOU0ZPUk1dPSIiLHRoaXMuX3RpbGVDb250YWluZXI9ZSxlPXRoaXMuX2JnQnVmZmVyPXQsdGhpcy5fc3RvcExvYWRpbmdJbWFnZXMoZSksY2xlYXJUaW1lb3V0KHRoaXMuX2NsZWFyQmdCdWZmZXJUaW1lciksdm9pZCAwKX0sX2dldExvYWRlZFRpbGVzUGVyY2VudGFnZTpmdW5jdGlvbih0KXt2YXIgZSxpLG49dC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIiksbz0wO2ZvcihlPTAsaT1uLmxlbmd0aDtpPmU7ZSsrKW5bZV0uY29tcGxldGUmJm8rKztyZXR1cm4gby9pfSxfc3RvcExvYWRpbmdJbWFnZXM6ZnVuY3Rpb24odCl7dmFyIGUsaSxuLHM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIikpO2ZvcihlPTAsaT1zLmxlbmd0aDtpPmU7ZSsrKW49c1tlXSxuLmNvbXBsZXRlfHwobi5vbmxvYWQ9by5VdGlsLmZhbHNlRm4sbi5vbmVycm9yPW8uVXRpbC5mYWxzZUZuLG4uc3JjPW8uVXRpbC5lbXB0eUltYWdlVXJsLG4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKSl9fSksby5NYXAuaW5jbHVkZSh7X2RlZmF1bHRMb2NhdGVPcHRpb25zOnt3YXRjaDohMSxzZXRWaWV3OiExLG1heFpvb206MS8wLHRpbWVvdXQ6MWU0LG1heGltdW1BZ2U6MCxlbmFibGVIaWdoQWNjdXJhY3k6ITF9LGxvY2F0ZTpmdW5jdGlvbih0KXtpZih0PXRoaXMuX2xvY2F0ZU9wdGlvbnM9by5leHRlbmQodGhpcy5fZGVmYXVsdExvY2F0ZU9wdGlvbnMsdCksIW5hdmlnYXRvci5nZW9sb2NhdGlvbilyZXR1cm4gdGhpcy5faGFuZGxlR2VvbG9jYXRpb25FcnJvcih7Y29kZTowLG1lc3NhZ2U6Ikdlb2xvY2F0aW9uIG5vdCBzdXBwb3J0ZWQuIn0pLHRoaXM7dmFyIGU9by5iaW5kKHRoaXMuX2hhbmRsZUdlb2xvY2F0aW9uUmVzcG9uc2UsdGhpcyksaT1vLmJpbmQodGhpcy5faGFuZGxlR2VvbG9jYXRpb25FcnJvcix0aGlzKTtyZXR1cm4gdC53YXRjaD90aGlzLl9sb2NhdGlvbldhdGNoSWQ9bmF2aWdhdG9yLmdlb2xvY2F0aW9uLndhdGNoUG9zaXRpb24oZSxpLHQpOm5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oZSxpLHQpLHRoaXN9LHN0b3BMb2NhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gbmF2aWdhdG9yLmdlb2xvY2F0aW9uJiZuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uY2xlYXJXYXRjaCh0aGlzLl9sb2NhdGlvbldhdGNoSWQpLHRoaXMuX2xvY2F0ZU9wdGlvbnMmJih0aGlzLl9sb2NhdGVPcHRpb25zLnNldFZpZXc9ITEpLHRoaXN9LF9oYW5kbGVHZW9sb2NhdGlvbkVycm9yOmZ1bmN0aW9uKHQpe3ZhciBlPXQuY29kZSxpPXQubWVzc2FnZXx8KDE9PT1lPyJwZXJtaXNzaW9uIGRlbmllZCI6Mj09PWU/InBvc2l0aW9uIHVuYXZhaWxhYmxlIjoidGltZW91dCIpO3RoaXMuX2xvY2F0ZU9wdGlvbnMuc2V0VmlldyYmIXRoaXMuX2xvYWRlZCYmdGhpcy5maXRXb3JsZCgpLHRoaXMuZmlyZSgibG9jYXRpb25lcnJvciIse2NvZGU6ZSxtZXNzYWdlOiJHZW9sb2NhdGlvbiBlcnJvcjogIitpKyIuIn0pfSxfaGFuZGxlR2VvbG9jYXRpb25SZXNwb25zZTpmdW5jdGlvbih0KXt2YXIgZT10LmNvb3Jkcy5sYXRpdHVkZSxpPXQuY29vcmRzLmxvbmdpdHVkZSxuPW5ldyBvLkxhdExuZyhlLGkpLHM9MTgwKnQuY29vcmRzLmFjY3VyYWN5LzQwMDc1MDE3LGE9cy9NYXRoLmNvcyhvLkxhdExuZy5ERUdfVE9fUkFEKmUpLHI9by5sYXRMbmdCb3VuZHMoW2UtcyxpLWFdLFtlK3MsaSthXSksaD10aGlzLl9sb2NhdGVPcHRpb25zO2lmKGguc2V0Vmlldyl7dmFyIGw9TWF0aC5taW4odGhpcy5nZXRCb3VuZHNab29tKHIpLGgubWF4Wm9vbSk7dGhpcy5zZXRWaWV3KG4sbCl9dmFyIHU9e2xhdGxuZzpuLGJvdW5kczpyfTtmb3IodmFyIGMgaW4gdC5jb29yZHMpIm51bWJlciI9PXR5cGVvZiB0LmNvb3Jkc1tjXSYmKHVbY109dC5jb29yZHNbY10pO3RoaXMuZmlyZSgibG9jYXRpb25mb3VuZCIsdSl9fSl9KHdpbmRvdyxkb2N1bWVudCk7Ci8vIFdlIGRvbid0IHVzZSB0aGUgcGxhdGZvcm0gYm9vdHN0cmFwcGVyLCBzbyBmYWtlIHRoaXMgc3R1ZmYuCgp3aW5kb3cuUGxhdGZvcm0gPSB7fTsKdmFyIGxvZ0ZsYWdzID0ge307CgoKCi8vIERPTVRva2VuTGlzdCBwb2x5ZmlsbCBmaXIgSUU5CihmdW5jdGlvbiAoKSB7CgppZiAodHlwZW9mIHdpbmRvdy5FbGVtZW50ID09PSAidW5kZWZpbmVkIiB8fCAiY2xhc3NMaXN0IiBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHJldHVybjsKCnZhciBwcm90b3R5cGUgPSBBcnJheS5wcm90b3R5cGUsCiAgICBpbmRleE9mID0gcHJvdG90eXBlLmluZGV4T2YsCiAgICBzbGljZSA9IHByb3RvdHlwZS5zbGljZSwKICAgIHB1c2ggPSBwcm90b3R5cGUucHVzaCwKICAgIHNwbGljZSA9IHByb3RvdHlwZS5zcGxpY2UsCiAgICBqb2luID0gcHJvdG90eXBlLmpvaW47CgpmdW5jdGlvbiBET01Ub2tlbkxpc3QoZWwpIHsKICB0aGlzLl9lbGVtZW50ID0gZWw7CiAgaWYgKGVsLmNsYXNzTmFtZSAhPSB0aGlzLl9jbGFzc0NhY2hlKSB7CiAgICB0aGlzLl9jbGFzc0NhY2hlID0gZWwuY2xhc3NOYW1lOwoKICAgIGlmICghdGhpcy5fY2xhc3NDYWNoZSkgcmV0dXJuOwoKICAgICAgLy8gVGhlIGNsYXNzTmFtZSBuZWVkcyB0byBiZSB0cmltbWVkIGFuZCBzcGxpdCBvbiB3aGl0ZXNwYWNlCiAgICAgIC8vIHRvIHJldHJpZXZlIGEgbGlzdCBvZiBjbGFzc2VzLgogICAgICB2YXIgY2xhc3NlcyA9IHRoaXMuX2NsYXNzQ2FjaGUucmVwbGFjZSgvXlxzK3xccyskL2csJycpLnNwbGl0KC9ccysvKSwKICAgICAgICBpOwogICAgZm9yIChpID0gMDsgaSA8IGNsYXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgcHVzaC5jYWxsKHRoaXMsIGNsYXNzZXNbaV0pOwogICAgfQogIH0KfTsKCmZ1bmN0aW9uIHNldFRvQ2xhc3NOYW1lKGVsLCBjbGFzc2VzKSB7CiAgZWwuY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKCcgJyk7Cn0KCkRPTVRva2VuTGlzdC5wcm90b3R5cGUgPSB7CiAgYWRkOiBmdW5jdGlvbih0b2tlbikgewogICAgaWYodGhpcy5jb250YWlucyh0b2tlbikpIHJldHVybjsKICAgIHB1c2guY2FsbCh0aGlzLCB0b2tlbik7CiAgICBzZXRUb0NsYXNzTmFtZSh0aGlzLl9lbGVtZW50LCBzbGljZS5jYWxsKHRoaXMsIDApKTsKICB9LAogIGNvbnRhaW5zOiBmdW5jdGlvbih0b2tlbikgewogICAgcmV0dXJuIGluZGV4T2YuY2FsbCh0aGlzLCB0b2tlbikgIT09IC0xOwogIH0sCiAgaXRlbTogZnVuY3Rpb24oaW5kZXgpIHsKICAgIHJldHVybiB0aGlzW2luZGV4XSB8fCBudWxsOwogIH0sCiAgcmVtb3ZlOiBmdW5jdGlvbih0b2tlbikgewogICAgdmFyIGkgPSBpbmRleE9mLmNhbGwodGhpcywgdG9rZW4pOwogICAgIGlmIChpID09PSAtMSkgewogICAgICAgcmV0dXJuOwogICAgIH0KICAgIHNwbGljZS5jYWxsKHRoaXMsIGksIDEpOwogICAgc2V0VG9DbGFzc05hbWUodGhpcy5fZWxlbWVudCwgc2xpY2UuY2FsbCh0aGlzLCAwKSk7CiAgfSwKICB0b1N0cmluZzogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gam9pbi5jYWxsKHRoaXMsICcgJyk7CiAgfSwKICB0b2dnbGU6IGZ1bmN0aW9uKHRva2VuKSB7CiAgICBpZiAoaW5kZXhPZi5jYWxsKHRoaXMsIHRva2VuKSA9PT0gLTEpIHsKICAgICAgdGhpcy5hZGQodG9rZW4pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5yZW1vdmUodG9rZW4pOwogICAgfQogIH0KfTsKCndpbmRvdy5ET01Ub2tlbkxpc3QgPSBET01Ub2tlbkxpc3Q7CgpmdW5jdGlvbiBkZWZpbmVFbGVtZW50R2V0dGVyIChvYmosIHByb3AsIGdldHRlcikgewogIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIHByb3AsewogICAgICBnZXQgOiBnZXR0ZXIKICAgIH0pCiAgfSBlbHNlIHsKICAgIG9iai5fX2RlZmluZUdldHRlcl9fKHByb3AsIGdldHRlcik7CiAgfQp9CgpkZWZpbmVFbGVtZW50R2V0dGVyKEVsZW1lbnQucHJvdG90eXBlLCAnY2xhc3NMaXN0JywgZnVuY3Rpb24gKCkgewogIHJldHVybiBuZXcgRE9NVG9rZW5MaXN0KHRoaXMpOwp9KTsKCn0pKCk7CgoKLyoKICogQ29weXJpZ2h0IDIwMTIgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJlbmVkIGJ5IGEgQlNELXN0eWxlCiAqIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS4KICovCgovLyBTaWRlVGFibGUgaXMgYSB3ZWFrIG1hcCB3aGVyZSBwb3NzaWJsZS4gSWYgV2Vha01hcCBpcyBub3QgYXZhaWxhYmxlIHRoZQovLyBhc3NvY2lhdGlvbiBpcyBzdG9yZWQgYXMgYW4gZXhwYW5kbyBwcm9wZXJ0eS4KdmFyIFNpZGVUYWJsZTsKLy8gVE9ETyhhcnYpOiBXZWFrTWFwIGRvZXMgbm90IGFsbG93IGZvciBOb2RlIGV0YyB0byBiZSBrZXlzIGluIEZpcmVmb3gKaWYgKHR5cGVvZiBXZWFrTWFwICE9PSAndW5kZWZpbmVkJyAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0ZpcmVmb3gvJykgPCAwKSB7CiAgU2lkZVRhYmxlID0gV2Vha01hcDsKfSBlbHNlIHsKICAoZnVuY3Rpb24oKSB7CiAgICB2YXIgZGVmaW5lUHJvcGVydHkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgICB2YXIgY291bnRlciA9IERhdGUubm93KCkgJSAxZTk7CgogICAgU2lkZVRhYmxlID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubmFtZSA9ICdfX3N0JyArIChNYXRoLnJhbmRvbSgpICogMWU5ID4+PiAwKSArIChjb3VudGVyKysgKyAnX18nKTsKICAgIH07CgogICAgU2lkZVRhYmxlLnByb3RvdHlwZSA9IHsKICAgICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgdmFyIGVudHJ5ID0ga2V5W3RoaXMubmFtZV07CiAgICAgICAgaWYgKGVudHJ5ICYmIGVudHJ5WzBdID09PSBrZXkpCiAgICAgICAgICBlbnRyeVsxXSA9IHZhbHVlOwogICAgICAgIGVsc2UKICAgICAgICAgIGRlZmluZVByb3BlcnR5KGtleSwgdGhpcy5uYW1lLCB7dmFsdWU6IFtrZXksIHZhbHVlXSwgd3JpdGFibGU6IHRydWV9KTsKICAgICAgfSwKICAgICAgZ2V0OiBmdW5jdGlvbihrZXkpIHsKICAgICAgICB2YXIgZW50cnk7CiAgICAgICAgcmV0dXJuIChlbnRyeSA9IGtleVt0aGlzLm5hbWVdKSAmJiBlbnRyeVswXSA9PT0ga2V5ID8KICAgICAgICAgICAgZW50cnlbMV0gOiB1bmRlZmluZWQ7CiAgICAgIH0sCiAgICAgIGRlbGV0ZTogZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgdGhpcy5zZXQoa2V5LCB1bmRlZmluZWQpOwogICAgICB9CiAgICB9CiAgfSkoKTsKfQoKLyoKICogQ29weXJpZ2h0IDIwMTIgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJlbmVkIGJ5IGEgQlNELXN0eWxlCiAqIGxpY2Vuc2UgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS4KICovCgooZnVuY3Rpb24oZ2xvYmFsKSB7CgogIHZhciByZWdpc3RyYXRpb25zVGFibGUgPSBuZXcgU2lkZVRhYmxlKCk7CgogIC8vIFdlIHVzZSBzZXRJbW1lZGlhdGUgb3IgcG9zdE1lc3NhZ2UgZm9yIG91ciBmdXR1cmUgY2FsbGJhY2suCiAgdmFyIHNldEltbWVkaWF0ZSA9IHdpbmRvdy5tc1NldEltbWVkaWF0ZTsKCiAgLy8gVXNlIHBvc3QgbWVzc2FnZSB0byBlbXVsYXRlIHNldEltbWVkaWF0ZS4KICBpZiAoIXNldEltbWVkaWF0ZSkgewogICAgdmFyIHNldEltbWVkaWF0ZVF1ZXVlID0gW107CiAgICB2YXIgc2VudGluZWwgPSBTdHJpbmcoTWF0aC5yYW5kb20oKSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKGUuZGF0YSA9PT0gc2VudGluZWwpIHsKICAgICAgICB2YXIgcXVldWUgPSBzZXRJbW1lZGlhdGVRdWV1ZTsKICAgICAgICBzZXRJbW1lZGlhdGVRdWV1ZSA9IFtdOwogICAgICAgIHF1ZXVlLmZvckVhY2goZnVuY3Rpb24oZnVuYykgewogICAgICAgICAgZnVuYygpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIHNldEltbWVkaWF0ZSA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgICAgc2V0SW1tZWRpYXRlUXVldWUucHVzaChmdW5jKTsKICAgICAgd2luZG93LnBvc3RNZXNzYWdlKHNlbnRpbmVsLCAnKicpOwogICAgfTsKICB9CgogIC8vIFRoaXMgaXMgdXNlZCB0byBlbnN1cmUgdGhhdCB3ZSBuZXZlciBzY2hlZHVsZSAyIGNhbGxhcyB0byBzZXRJbW1lZGlhdGUKICB2YXIgaXNTY2hlZHVsZWQgPSBmYWxzZTsKCiAgLy8gS2VlcCB0cmFjayBvZiBvYnNlcnZlcnMgdGhhdCBuZWVkcyB0byBiZSBub3RpZmllZCBuZXh0IHRpbWUuCiAgdmFyIHNjaGVkdWxlZE9ic2VydmVycyA9IFtdOwoKICAvKioKICAgKiBTY2hlZHVsZXMgfGRpc3BhdGNoQ2FsbGJhY2t8IHRvIGJlIGNhbGxlZCBpbiB0aGUgZnV0dXJlLgogICAqIEBwYXJhbSB7TXV0YXRpb25PYnNlcnZlcn0gb2JzZXJ2ZXIKICAgKi8KICBmdW5jdGlvbiBzY2hlZHVsZUNhbGxiYWNrKG9ic2VydmVyKSB7CiAgICBzY2hlZHVsZWRPYnNlcnZlcnMucHVzaChvYnNlcnZlcik7CiAgICBpZiAoIWlzU2NoZWR1bGVkKSB7CiAgICAgIGlzU2NoZWR1bGVkID0gdHJ1ZTsKICAgICAgc2V0SW1tZWRpYXRlKGRpc3BhdGNoQ2FsbGJhY2tzKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHdyYXBJZk5lZWRlZChub2RlKSB7CiAgICByZXR1cm4gd2luZG93LlNoYWRvd0RPTVBvbHlmaWxsICYmCiAgICAgICAgd2luZG93LlNoYWRvd0RPTVBvbHlmaWxsLndyYXBJZk5lZWRlZChub2RlKSB8fAogICAgICAgIG5vZGU7CiAgfQoKICBmdW5jdGlvbiBkaXNwYXRjaENhbGxiYWNrcygpIHsKICAgIC8vIGh0dHA6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNtdXRhdGlvbi1vYnNlcnZlcnMKCiAgICBpc1NjaGVkdWxlZCA9IGZhbHNlOyAvLyBVc2VkIHRvIGFsbG93IGEgbmV3IHNldEltbWVkaWF0ZSBjYWxsIGFib3ZlLgoKICAgIHZhciBvYnNlcnZlcnMgPSBzY2hlZHVsZWRPYnNlcnZlcnM7CiAgICBzY2hlZHVsZWRPYnNlcnZlcnMgPSBbXTsKICAgIC8vIFNvcnQgb2JzZXJ2ZXJzIGJhc2VkIG9uIHRoZWlyIGNyZWF0aW9uIFVJRCAoaW5jcmVtZW50YWwpLgogICAgb2JzZXJ2ZXJzLnNvcnQoZnVuY3Rpb24obzEsIG8yKSB7CiAgICAgIHJldHVybiBvMS51aWRfIC0gbzIudWlkXzsKICAgIH0pOwoKICAgIHZhciBhbnlOb25FbXB0eSA9IGZhbHNlOwogICAgb2JzZXJ2ZXJzLmZvckVhY2goZnVuY3Rpb24ob2JzZXJ2ZXIpIHsKCiAgICAgIC8vIDIuMSwgMi4yCiAgICAgIHZhciBxdWV1ZSA9IG9ic2VydmVyLnRha2VSZWNvcmRzKCk7CiAgICAgIC8vIDIuMy4gUmVtb3ZlIGFsbCB0cmFuc2llbnQgcmVnaXN0ZXJlZCBvYnNlcnZlcnMgd2hvc2Ugb2JzZXJ2ZXIgaXMgbW8uCiAgICAgIHJlbW92ZVRyYW5zaWVudE9ic2VydmVyc0ZvcihvYnNlcnZlcik7CgogICAgICAvLyAyLjQKICAgICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgIG9ic2VydmVyLmNhbGxiYWNrXyhxdWV1ZSwgb2JzZXJ2ZXIpOwogICAgICAgIGFueU5vbkVtcHR5ID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CgogICAgLy8gMy4KICAgIGlmIChhbnlOb25FbXB0eSkKICAgICAgZGlzcGF0Y2hDYWxsYmFja3MoKTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZVRyYW5zaWVudE9ic2VydmVyc0ZvcihvYnNlcnZlcikgewogICAgb2JzZXJ2ZXIubm9kZXNfLmZvckVhY2goZnVuY3Rpb24obm9kZSkgewogICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQobm9kZSk7CiAgICAgIGlmICghcmVnaXN0cmF0aW9ucykKICAgICAgICByZXR1cm47CiAgICAgIHJlZ2lzdHJhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihyZWdpc3RyYXRpb24pIHsKICAgICAgICBpZiAocmVnaXN0cmF0aW9uLm9ic2VydmVyID09PSBvYnNlcnZlcikKICAgICAgICAgIHJlZ2lzdHJhdGlvbi5yZW1vdmVUcmFuc2llbnRPYnNlcnZlcnMoKTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCBmb3IgdGhlICJGb3IgZWFjaCByZWdpc3RlcmVkIG9ic2VydmVyIG9ic2VydmVyICh3aXRoCiAgICogb2JzZXJ2ZXIncyBvcHRpb25zIGFzIG9wdGlvbnMpIGluIHRhcmdldCdzIGxpc3Qgb2YgcmVnaXN0ZXJlZCBvYnNlcnZlcnMsCiAgICogcnVuIHRoZXNlIHN1YnN0ZXBzOiIgYW5kIHRoZSAiRm9yIGVhY2ggYW5jZXN0b3IgYW5jZXN0b3Igb2YgdGFyZ2V0LCBhbmQgZm9yCiAgICogZWFjaCByZWdpc3RlcmVkIG9ic2VydmVyIG9ic2VydmVyICh3aXRoIG9wdGlvbnMgb3B0aW9ucykgaW4gYW5jZXN0b3IncyBsaXN0CiAgICogb2YgcmVnaXN0ZXJlZCBvYnNlcnZlcnMsIHJ1biB0aGVzZSBzdWJzdGVwczoiIHBhcnQgb2YgdGhlIGFsZ29yaXRobXMuIFRoZQogICAqIHxvcHRpb25zLnN1YnRyZWV8IGlzIGNoZWNrZWQgdG8gZW5zdXJlIHRoYXQgdGhlIGNhbGxiYWNrIGlzIGNhbGxlZAogICAqIGNvcnJlY3RseS4KICAgKgogICAqIEBwYXJhbSB7Tm9kZX0gdGFyZ2V0CiAgICogQHBhcmFtIHtmdW5jdGlvbihNdXRhdGlvbk9ic2VydmVySW5pdCk6TXV0YXRpb25SZWNvcmR9IGNhbGxiYWNrCiAgICovCiAgZnVuY3Rpb24gZm9yRWFjaEFuY2VzdG9yQW5kT2JzZXJ2ZXJFbnF1ZXVlUmVjb3JkKHRhcmdldCwgY2FsbGJhY2spIHsKICAgIGZvciAodmFyIG5vZGUgPSB0YXJnZXQ7IG5vZGU7IG5vZGUgPSBub2RlLnBhcmVudE5vZGUpIHsKICAgICAgdmFyIHJlZ2lzdHJhdGlvbnMgPSByZWdpc3RyYXRpb25zVGFibGUuZ2V0KG5vZGUpOwoKICAgICAgaWYgKHJlZ2lzdHJhdGlvbnMpIHsKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJlZ2lzdHJhdGlvbnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIHZhciByZWdpc3RyYXRpb24gPSByZWdpc3RyYXRpb25zW2pdOwogICAgICAgICAgdmFyIG9wdGlvbnMgPSByZWdpc3RyYXRpb24ub3B0aW9uczsKCiAgICAgICAgICAvLyBPbmx5IHRhcmdldCBpZ25vcmVzIHN1YnRyZWUuCiAgICAgICAgICBpZiAobm9kZSAhPT0gdGFyZ2V0ICYmICFvcHRpb25zLnN1YnRyZWUpCiAgICAgICAgICAgIGNvbnRpbnVlOwoKICAgICAgICAgIHZhciByZWNvcmQgPSBjYWxsYmFjayhvcHRpb25zKTsKICAgICAgICAgIGlmIChyZWNvcmQpCiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbi5lbnF1ZXVlKHJlY29yZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICB2YXIgdWlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIFRoZSBjbGFzcyB0aGF0IG1hcHMgdG8gdGhlIERPTSBNdXRhdGlvbk9ic2VydmVyIGludGVyZmFjZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjay4KICAgKiBAY29uc3RydWN0b3IKICAgKi8KICBmdW5jdGlvbiBKc011dGF0aW9uT2JzZXJ2ZXIoY2FsbGJhY2spIHsKICAgIHRoaXMuY2FsbGJhY2tfID0gY2FsbGJhY2s7CiAgICB0aGlzLm5vZGVzXyA9IFtdOwogICAgdGhpcy5yZWNvcmRzXyA9IFtdOwogICAgdGhpcy51aWRfID0gKyt1aWRDb3VudGVyOwogIH0KCiAgSnNNdXRhdGlvbk9ic2VydmVyLnByb3RvdHlwZSA9IHsKICAgIG9ic2VydmU6IGZ1bmN0aW9uKHRhcmdldCwgb3B0aW9ucykgewogICAgICB0YXJnZXQgPSB3cmFwSWZOZWVkZWQodGFyZ2V0KTsKCiAgICAgIC8vIDEuMQogICAgICBpZiAoIW9wdGlvbnMuY2hpbGRMaXN0ICYmICFvcHRpb25zLmF0dHJpYnV0ZXMgJiYgIW9wdGlvbnMuY2hhcmFjdGVyRGF0YSB8fAoKICAgICAgICAgIC8vIDEuMgogICAgICAgICAgb3B0aW9ucy5hdHRyaWJ1dGVPbGRWYWx1ZSAmJiAhb3B0aW9ucy5hdHRyaWJ1dGVzIHx8CgogICAgICAgICAgLy8gMS4zCiAgICAgICAgICBvcHRpb25zLmF0dHJpYnV0ZUZpbHRlciAmJiBvcHRpb25zLmF0dHJpYnV0ZUZpbHRlci5sZW5ndGggJiYKICAgICAgICAgICAgICAhb3B0aW9ucy5hdHRyaWJ1dGVzIHx8CgogICAgICAgICAgLy8gMS40CiAgICAgICAgICBvcHRpb25zLmNoYXJhY3RlckRhdGFPbGRWYWx1ZSAmJiAhb3B0aW9ucy5jaGFyYWN0ZXJEYXRhKSB7CgogICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigpOwogICAgICB9CgogICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQodGFyZ2V0KTsKICAgICAgaWYgKCFyZWdpc3RyYXRpb25zKQogICAgICAgIHJlZ2lzdHJhdGlvbnNUYWJsZS5zZXQodGFyZ2V0LCByZWdpc3RyYXRpb25zID0gW10pOwoKICAgICAgLy8gMgogICAgICAvLyBJZiB0YXJnZXQncyBsaXN0IG9mIHJlZ2lzdGVyZWQgb2JzZXJ2ZXJzIGFscmVhZHkgaW5jbHVkZXMgYSByZWdpc3RlcmVkCiAgICAgIC8vIG9ic2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgY29udGV4dCBvYmplY3QsIHJlcGxhY2UgdGhhdCByZWdpc3RlcmVkCiAgICAgIC8vIG9ic2VydmVyJ3Mgb3B0aW9ucyB3aXRoIG9wdGlvbnMuCiAgICAgIHZhciByZWdpc3RyYXRpb247CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVnaXN0cmF0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChyZWdpc3RyYXRpb25zW2ldLm9ic2VydmVyID09PSB0aGlzKSB7CiAgICAgICAgICByZWdpc3RyYXRpb24gPSByZWdpc3RyYXRpb25zW2ldOwogICAgICAgICAgcmVnaXN0cmF0aW9uLnJlbW92ZUxpc3RlbmVycygpOwogICAgICAgICAgcmVnaXN0cmF0aW9uLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyAzLgogICAgICAvLyBPdGhlcndpc2UsIGFkZCBhIG5ldyByZWdpc3RlcmVkIG9ic2VydmVyIHRvIHRhcmdldCdzIGxpc3Qgb2YgcmVnaXN0ZXJlZAogICAgICAvLyBvYnNlcnZlcnMgd2l0aCB0aGUgY29udGV4dCBvYmplY3QgYXMgdGhlIG9ic2VydmVyIGFuZCBvcHRpb25zIGFzIHRoZQogICAgICAvLyBvcHRpb25zLCBhbmQgYWRkIHRhcmdldCB0byBjb250ZXh0IG9iamVjdCdzIGxpc3Qgb2Ygbm9kZXMgb24gd2hpY2ggaXQKICAgICAgLy8gaXMgcmVnaXN0ZXJlZC4KICAgICAgaWYgKCFyZWdpc3RyYXRpb24pIHsKICAgICAgICByZWdpc3RyYXRpb24gPSBuZXcgUmVnaXN0cmF0aW9uKHRoaXMsIHRhcmdldCwgb3B0aW9ucyk7CiAgICAgICAgcmVnaXN0cmF0aW9ucy5wdXNoKHJlZ2lzdHJhdGlvbik7CiAgICAgICAgdGhpcy5ub2Rlc18ucHVzaCh0YXJnZXQpOwogICAgICB9CgogICAgICByZWdpc3RyYXRpb24uYWRkTGlzdGVuZXJzKCk7CiAgICB9LAoKICAgIGRpc2Nvbm5lY3Q6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLm5vZGVzXy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQobm9kZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWdpc3RyYXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgcmVnaXN0cmF0aW9uID0gcmVnaXN0cmF0aW9uc1tpXTsKICAgICAgICAgIGlmIChyZWdpc3RyYXRpb24ub2JzZXJ2ZXIgPT09IHRoaXMpIHsKICAgICAgICAgICAgcmVnaXN0cmF0aW9uLnJlbW92ZUxpc3RlbmVycygpOwogICAgICAgICAgICByZWdpc3RyYXRpb25zLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgLy8gRWFjaCBub2RlIGNhbiBvbmx5IGhhdmUgb25lIHJlZ2lzdGVyZWQgb2JzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoCiAgICAgICAgICAgIC8vIHRoaXMgb2JzZXJ2ZXIuCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgdGhpcyk7CiAgICAgIHRoaXMucmVjb3Jkc18gPSBbXTsKICAgIH0sCgogICAgdGFrZVJlY29yZHM6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgY29weU9mUmVjb3JkcyA9IHRoaXMucmVjb3Jkc187CiAgICAgIHRoaXMucmVjb3Jkc18gPSBbXTsKICAgICAgcmV0dXJuIGNvcHlPZlJlY29yZHM7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUKICAgKiBAcGFyYW0ge05vZGV9IHRhcmdldAogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIE11dGF0aW9uUmVjb3JkKHR5cGUsIHRhcmdldCkgewogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0OwogICAgdGhpcy5hZGRlZE5vZGVzID0gW107CiAgICB0aGlzLnJlbW92ZWROb2RlcyA9IFtdOwogICAgdGhpcy5wcmV2aW91c1NpYmxpbmcgPSBudWxsOwogICAgdGhpcy5uZXh0U2libGluZyA9IG51bGw7CiAgICB0aGlzLmF0dHJpYnV0ZU5hbWUgPSBudWxsOwogICAgdGhpcy5hdHRyaWJ1dGVOYW1lc3BhY2UgPSBudWxsOwogICAgdGhpcy5vbGRWYWx1ZSA9IG51bGw7CiAgfQoKICBmdW5jdGlvbiBjb3B5TXV0YXRpb25SZWNvcmQob3JpZ2luYWwpIHsKICAgIHZhciByZWNvcmQgPSBuZXcgTXV0YXRpb25SZWNvcmQob3JpZ2luYWwudHlwZSwgb3JpZ2luYWwudGFyZ2V0KTsKICAgIHJlY29yZC5hZGRlZE5vZGVzID0gb3JpZ2luYWwuYWRkZWROb2Rlcy5zbGljZSgpOwogICAgcmVjb3JkLnJlbW92ZWROb2RlcyA9IG9yaWdpbmFsLnJlbW92ZWROb2Rlcy5zbGljZSgpOwogICAgcmVjb3JkLnByZXZpb3VzU2libGluZyA9IG9yaWdpbmFsLnByZXZpb3VzU2libGluZzsKICAgIHJlY29yZC5uZXh0U2libGluZyA9IG9yaWdpbmFsLm5leHRTaWJsaW5nOwogICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWUgPSBvcmlnaW5hbC5hdHRyaWJ1dGVOYW1lOwogICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWVzcGFjZSA9IG9yaWdpbmFsLmF0dHJpYnV0ZU5hbWVzcGFjZTsKICAgIHJlY29yZC5vbGRWYWx1ZSA9IG9yaWdpbmFsLm9sZFZhbHVlOwogICAgcmV0dXJuIHJlY29yZDsKICB9OwoKICAvLyBXZSBrZWVwIHRyYWNrIG9mIHRoZSB0d28gKHBvc3NpYmx5IG9uZSkgcmVjb3JkcyB1c2VkIGluIGEgc2luZ2xlIG11dGF0aW9uLgogIHZhciBjdXJyZW50UmVjb3JkLCByZWNvcmRXaXRoT2xkVmFsdWU7CgogIC8qKgogICAqIENyZWF0ZXMgYSByZWNvcmQgd2l0aG91dCB8b2xkVmFsdWV8IGFuZCBjYWNoZXMgaXQgYXMgfGN1cnJlbnRSZWNvcmR8IGZvcgogICAqIGxhdGVyIHVzZS4KICAgKiBAcGFyYW0ge3N0cmluZ30gb2xkVmFsdWUKICAgKiBAcmV0dXJuIHtNdXRhdGlvblJlY29yZH0KICAgKi8KICBmdW5jdGlvbiBnZXRSZWNvcmQodHlwZSwgdGFyZ2V0KSB7CiAgICByZXR1cm4gY3VycmVudFJlY29yZCA9IG5ldyBNdXRhdGlvblJlY29yZCh0eXBlLCB0YXJnZXQpOwogIH0KCiAgLyoqCiAgICogR2V0cyBvciBjcmVhdGVzIGEgcmVjb3JkIHdpdGggfG9sZFZhbHVlfCBiYXNlZCBpbiB0aGUgfGN1cnJlbnRSZWNvcmR8CiAgICogQHBhcmFtIHtzdHJpbmd9IG9sZFZhbHVlCiAgICogQHJldHVybiB7TXV0YXRpb25SZWNvcmR9CiAgICovCiAgZnVuY3Rpb24gZ2V0UmVjb3JkV2l0aE9sZFZhbHVlKG9sZFZhbHVlKSB7CiAgICBpZiAocmVjb3JkV2l0aE9sZFZhbHVlKQogICAgICByZXR1cm4gcmVjb3JkV2l0aE9sZFZhbHVlOwogICAgcmVjb3JkV2l0aE9sZFZhbHVlID0gY29weU11dGF0aW9uUmVjb3JkKGN1cnJlbnRSZWNvcmQpOwogICAgcmVjb3JkV2l0aE9sZFZhbHVlLm9sZFZhbHVlID0gb2xkVmFsdWU7CiAgICByZXR1cm4gcmVjb3JkV2l0aE9sZFZhbHVlOwogIH0KCiAgZnVuY3Rpb24gY2xlYXJSZWNvcmRzKCkgewogICAgY3VycmVudFJlY29yZCA9IHJlY29yZFdpdGhPbGRWYWx1ZSA9IHVuZGVmaW5lZDsKICB9CgogIC8qKgogICAqIEBwYXJhbSB7TXV0YXRpb25SZWNvcmR9IHJlY29yZAogICAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHJlY29yZCByZXByZXNlbnRzIGEgcmVjb3JkIGZyb20gdGhlIGN1cnJlbnQKICAgKiBtdXRhdGlvbiBldmVudC4KICAgKi8KICBmdW5jdGlvbiByZWNvcmRSZXByZXNlbnRzQ3VycmVudE11dGF0aW9uKHJlY29yZCkgewogICAgcmV0dXJuIHJlY29yZCA9PT0gcmVjb3JkV2l0aE9sZFZhbHVlIHx8IHJlY29yZCA9PT0gY3VycmVudFJlY29yZDsKICB9CgogIC8qKgogICAqIFNlbGVjdHMgd2hpY2ggcmVjb3JkLCBpZiBhbnksIHRvIHJlcGxhY2UgdGhlIGxhc3QgcmVjb3JkIGluIHRoZSBxdWV1ZS4KICAgKiBUaGlzIHJldHVybnMgfG51bGx8IGlmIG5vIHJlY29yZCBzaG91bGQgYmUgcmVwbGFjZWQuCiAgICoKICAgKiBAcGFyYW0ge011dGF0aW9uUmVjb3JkfSBsYXN0UmVjb3JkCiAgICogQHBhcmFtIHtNdXRhdGlvblJlY29yZH0gbmV3UmVjb3JkCiAgICogQHBhcmFtIHtNdXRhdGlvblJlY29yZH0KICAgKi8KICBmdW5jdGlvbiBzZWxlY3RSZWNvcmQobGFzdFJlY29yZCwgbmV3UmVjb3JkKSB7CiAgICBpZiAobGFzdFJlY29yZCA9PT0gbmV3UmVjb3JkKQogICAgICByZXR1cm4gbGFzdFJlY29yZDsKCiAgICAvLyBDaGVjayBpZiB0aGUgdGhlIHJlY29yZCB3ZSBhcmUgYWRkaW5nIHJlcHJlc2VudHMgdGhlIHNhbWUgcmVjb3JkLiBJZgogICAgLy8gc28sIHdlIGtlZXAgdGhlIG9uZSB3aXRoIHRoZSBvbGRWYWx1ZSBpbiBpdC4KICAgIGlmIChyZWNvcmRXaXRoT2xkVmFsdWUgJiYgcmVjb3JkUmVwcmVzZW50c0N1cnJlbnRNdXRhdGlvbihsYXN0UmVjb3JkKSkKICAgICAgcmV0dXJuIHJlY29yZFdpdGhPbGRWYWx1ZTsKCiAgICByZXR1cm4gbnVsbDsKICB9CgogIC8qKgogICAqIENsYXNzIHVzZWQgdG8gcmVwcmVzZW50IGEgcmVnaXN0ZXJlZCBvYnNlcnZlci4KICAgKiBAcGFyYW0ge011dGF0aW9uT2JzZXJ2ZXJ9IG9ic2VydmVyCiAgICogQHBhcmFtIHtOb2RlfSB0YXJnZXQKICAgKiBAcGFyYW0ge011dGF0aW9uT2JzZXJ2ZXJJbml0fSBvcHRpb25zCiAgICogQGNvbnN0cnVjdG9yCiAgICovCiAgZnVuY3Rpb24gUmVnaXN0cmF0aW9uKG9ic2VydmVyLCB0YXJnZXQsIG9wdGlvbnMpIHsKICAgIHRoaXMub2JzZXJ2ZXIgPSBvYnNlcnZlcjsKICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0OwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIHRoaXMudHJhbnNpZW50T2JzZXJ2ZWROb2RlcyA9IFtdOwogIH0KCiAgUmVnaXN0cmF0aW9uLnByb3RvdHlwZSA9IHsKICAgIGVucXVldWU6IGZ1bmN0aW9uKHJlY29yZCkgewogICAgICB2YXIgcmVjb3JkcyA9IHRoaXMub2JzZXJ2ZXIucmVjb3Jkc187CiAgICAgIHZhciBsZW5ndGggPSByZWNvcmRzLmxlbmd0aDsKCiAgICAgIC8vIFRoZXJlIGFyZSBjYXNlcyB3aGVyZSB3ZSByZXBsYWNlIHRoZSBsYXN0IHJlY29yZCB3aXRoIHRoZSBuZXcgcmVjb3JkLgogICAgICAvLyBGb3IgZXhhbXBsZSBpZiB0aGUgcmVjb3JkIHJlcHJlc2VudHMgdGhlIHNhbWUgbXV0YXRpb24gd2UgbmVlZCB0byB1c2UKICAgICAgLy8gdGhlIG9uZSB3aXRoIHRoZSBvbGRWYWx1ZS4gSWYgd2UgZ2V0IHNhbWUgcmVjb3JkICh0aGlzIGNhbiBoYXBwZW4gYXMgd2UKICAgICAgLy8gd2FsayB1cCB0aGUgdHJlZSkgd2UgaWdub3JlIHRoZSBuZXcgcmVjb3JkLgogICAgICBpZiAocmVjb3Jkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIGxhc3RSZWNvcmQgPSByZWNvcmRzW2xlbmd0aCAtIDFdOwogICAgICAgIHZhciByZWNvcmRUb1JlcGxhY2VMYXN0ID0gc2VsZWN0UmVjb3JkKGxhc3RSZWNvcmQsIHJlY29yZCk7CiAgICAgICAgaWYgKHJlY29yZFRvUmVwbGFjZUxhc3QpIHsKICAgICAgICAgIHJlY29yZHNbbGVuZ3RoIC0gMV0gPSByZWNvcmRUb1JlcGxhY2VMYXN0OwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzY2hlZHVsZUNhbGxiYWNrKHRoaXMub2JzZXJ2ZXIpOwogICAgICB9CgogICAgICByZWNvcmRzW2xlbmd0aF0gPSByZWNvcmQ7CiAgICB9LAoKICAgIGFkZExpc3RlbmVyczogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuYWRkTGlzdGVuZXJzXyh0aGlzLnRhcmdldCk7CiAgICB9LAoKICAgIGFkZExpc3RlbmVyc186IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CiAgICAgIGlmIChvcHRpb25zLmF0dHJpYnV0ZXMpCiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCB0aGlzLCB0cnVlKTsKCiAgICAgIGlmIChvcHRpb25zLmNoYXJhY3RlckRhdGEpCiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCdET01DaGFyYWN0ZXJEYXRhTW9kaWZpZWQnLCB0aGlzLCB0cnVlKTsKCiAgICAgIGlmIChvcHRpb25zLmNoaWxkTGlzdCkKICAgICAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIHRoaXMsIHRydWUpOwoKICAgICAgaWYgKG9wdGlvbnMuY2hpbGRMaXN0IHx8IG9wdGlvbnMuc3VidHJlZSkKICAgICAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVSZW1vdmVkJywgdGhpcywgdHJ1ZSk7CiAgICB9LAoKICAgIHJlbW92ZUxpc3RlbmVyczogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzXyh0aGlzLnRhcmdldCk7CiAgICB9LAoKICAgIHJlbW92ZUxpc3RlbmVyc186IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CiAgICAgIGlmIChvcHRpb25zLmF0dHJpYnV0ZXMpCiAgICAgICAgbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCB0aGlzLCB0cnVlKTsKCiAgICAgIGlmIChvcHRpb25zLmNoYXJhY3RlckRhdGEpCiAgICAgICAgbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCdET01DaGFyYWN0ZXJEYXRhTW9kaWZpZWQnLCB0aGlzLCB0cnVlKTsKCiAgICAgIGlmIChvcHRpb25zLmNoaWxkTGlzdCkKICAgICAgICBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIHRoaXMsIHRydWUpOwoKICAgICAgaWYgKG9wdGlvbnMuY2hpbGRMaXN0IHx8IG9wdGlvbnMuc3VidHJlZSkKICAgICAgICBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVSZW1vdmVkJywgdGhpcywgdHJ1ZSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQWRkcyBhIHRyYW5zaWVudCBvYnNlcnZlciBvbiBub2RlLiBUaGUgdHJhbnNpZW50IG9ic2VydmVyIGdldHMgcmVtb3ZlZAogICAgICogbmV4dCB0aW1lIHdlIGRlbGl2ZXIgdGhlIGNoYW5nZSByZWNvcmRzLgogICAgICogQHBhcmFtIHtOb2RlfSBub2RlCiAgICAgKi8KICAgIGFkZFRyYW5zaWVudE9ic2VydmVyOiBmdW5jdGlvbihub2RlKSB7CiAgICAgIC8vIERvbid0IGFkZCB0cmFuc2llbnQgb2JzZXJ2ZXJzIG9uIHRoZSB0YXJnZXQgaXRzZWxmLiBXZSBhbHJlYWR5IGhhdmUgYWxsCiAgICAgIC8vIHRoZSByZXF1aXJlZCBsaXN0ZW5lcnMgc2V0IHVwIG9uIHRoZSB0YXJnZXQuCiAgICAgIGlmIChub2RlID09PSB0aGlzLnRhcmdldCkKICAgICAgICByZXR1cm47CgogICAgICB0aGlzLmFkZExpc3RlbmVyc18obm9kZSk7CiAgICAgIHRoaXMudHJhbnNpZW50T2JzZXJ2ZWROb2Rlcy5wdXNoKG5vZGUpOwogICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQobm9kZSk7CiAgICAgIGlmICghcmVnaXN0cmF0aW9ucykKICAgICAgICByZWdpc3RyYXRpb25zVGFibGUuc2V0KG5vZGUsIHJlZ2lzdHJhdGlvbnMgPSBbXSk7CgogICAgICAvLyBXZSBrbm93IHRoYXQgcmVnaXN0cmF0aW9ucyBkb2VzIG5vdCBjb250YWluIHRoaXMgYmVjYXVzZSB3ZSBhbHJlYWR5CiAgICAgIC8vIGNoZWNrZWQgaWYgbm9kZSA9PT0gdGhpcy50YXJnZXQuCiAgICAgIHJlZ2lzdHJhdGlvbnMucHVzaCh0aGlzKTsKICAgIH0sCgogICAgcmVtb3ZlVHJhbnNpZW50T2JzZXJ2ZXJzOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHRyYW5zaWVudE9ic2VydmVkTm9kZXMgPSB0aGlzLnRyYW5zaWVudE9ic2VydmVkTm9kZXM7CiAgICAgIHRoaXMudHJhbnNpZW50T2JzZXJ2ZWROb2RlcyA9IFtdOwoKICAgICAgdHJhbnNpZW50T2JzZXJ2ZWROb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAvLyBUcmFuc2llbnQgb2JzZXJ2ZXJzIGFyZSBuZXZlciBhZGRlZCB0byB0aGUgdGFyZ2V0LgogICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzXyhub2RlKTsKCiAgICAgICAgdmFyIHJlZ2lzdHJhdGlvbnMgPSByZWdpc3RyYXRpb25zVGFibGUuZ2V0KG5vZGUpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVnaXN0cmF0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHJlZ2lzdHJhdGlvbnNbaV0gPT09IHRoaXMpIHsKICAgICAgICAgICAgcmVnaXN0cmF0aW9ucy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIC8vIEVhY2ggbm9kZSBjYW4gb25seSBoYXZlIG9uZSByZWdpc3RlcmVkIG9ic2VydmVyIGFzc29jaWF0ZWQgd2l0aAogICAgICAgICAgICAvLyB0aGlzIG9ic2VydmVyLgogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHRoaXMpOwogICAgfSwKCiAgICBoYW5kbGVFdmVudDogZnVuY3Rpb24oZSkgewogICAgICAvLyBTdG9wIHByb3BhZ2F0aW9uIHNpbmNlIHdlIGFyZSBtYW5hZ2luZyB0aGUgcHJvcGFnYXRpb24gbWFudWFsbHkuCiAgICAgIC8vIFRoaXMgbWVhbnMgdGhhdCBvdGhlciBtdXRhdGlvbiBldmVudHMgb24gdGhlIHBhZ2Ugd2lsbCBub3Qgd29yawogICAgICAvLyBjb3JyZWN0bHkgYnV0IHRoYXQgaXMgYnkgZGVzaWduLgogICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwoKICAgICAgc3dpdGNoIChlLnR5cGUpIHsKICAgICAgICBjYXNlICdET01BdHRyTW9kaWZpZWQnOgogICAgICAgICAgLy8gaHR0cDovL2RvbS5zcGVjLndoYXR3Zy5vcmcvI2NvbmNlcHQtbW8tcXVldWUtYXR0cmlidXRlcwoKICAgICAgICAgIHZhciBuYW1lID0gZS5hdHRyTmFtZTsKICAgICAgICAgIHZhciBuYW1lc3BhY2UgPSBlLnJlbGF0ZWROb2RlLm5hbWVzcGFjZVVSSTsKICAgICAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDsKCiAgICAgICAgICAvLyAxLgogICAgICAgICAgdmFyIHJlY29yZCA9IG5ldyBnZXRSZWNvcmQoJ2F0dHJpYnV0ZXMnLCB0YXJnZXQpOwogICAgICAgICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWUgPSBuYW1lOwogICAgICAgICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWVzcGFjZSA9IG5hbWVzcGFjZTsKCiAgICAgICAgICAvLyAyLgogICAgICAgICAgdmFyIG9sZFZhbHVlID0KICAgICAgICAgICAgICBlLmF0dHJDaGFuZ2UgPT09IE11dGF0aW9uRXZlbnQuQURESVRJT04gPyBudWxsIDogZS5wcmV2VmFsdWU7CgogICAgICAgICAgZm9yRWFjaEFuY2VzdG9yQW5kT2JzZXJ2ZXJFbnF1ZXVlUmVjb3JkKHRhcmdldCwgZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAvLyAzLjEsIDQuMgogICAgICAgICAgICBpZiAoIW9wdGlvbnMuYXR0cmlidXRlcykKICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAvLyAzLjIsIDQuMwogICAgICAgICAgICBpZiAob3B0aW9ucy5hdHRyaWJ1dGVGaWx0ZXIgJiYgb3B0aW9ucy5hdHRyaWJ1dGVGaWx0ZXIubGVuZ3RoICYmCiAgICAgICAgICAgICAgICBvcHRpb25zLmF0dHJpYnV0ZUZpbHRlci5pbmRleE9mKG5hbWUpID09PSAtMSAmJgogICAgICAgICAgICAgICAgb3B0aW9ucy5hdHRyaWJ1dGVGaWx0ZXIuaW5kZXhPZihuYW1lc3BhY2UpID09PSAtMSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAzLjMsIDQuNAogICAgICAgICAgICBpZiAob3B0aW9ucy5hdHRyaWJ1dGVPbGRWYWx1ZSkKICAgICAgICAgICAgICByZXR1cm4gZ2V0UmVjb3JkV2l0aE9sZFZhbHVlKG9sZFZhbHVlKTsKCiAgICAgICAgICAgIC8vIDMuNCwgNC41CiAgICAgICAgICAgIHJldHVybiByZWNvcmQ7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnRE9NQ2hhcmFjdGVyRGF0YU1vZGlmaWVkJzoKICAgICAgICAgIC8vIGh0dHA6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNjb25jZXB0LW1vLXF1ZXVlLWNoYXJhY3RlcmRhdGEKICAgICAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDsKCiAgICAgICAgICAvLyAxLgogICAgICAgICAgdmFyIHJlY29yZCA9IGdldFJlY29yZCgnY2hhcmFjdGVyRGF0YScsIHRhcmdldCk7CgogICAgICAgICAgLy8gMi4KICAgICAgICAgIHZhciBvbGRWYWx1ZSA9IGUucHJldlZhbHVlOwoKCiAgICAgICAgICBmb3JFYWNoQW5jZXN0b3JBbmRPYnNlcnZlckVucXVldWVSZWNvcmQodGFyZ2V0LCBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIC8vIDMuMSwgNC4yCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5jaGFyYWN0ZXJEYXRhKQogICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgIC8vIDMuMiwgNC4zCiAgICAgICAgICAgIGlmIChvcHRpb25zLmNoYXJhY3RlckRhdGFPbGRWYWx1ZSkKICAgICAgICAgICAgICByZXR1cm4gZ2V0UmVjb3JkV2l0aE9sZFZhbHVlKG9sZFZhbHVlKTsKCiAgICAgICAgICAgIC8vIDMuMywgNC40CiAgICAgICAgICAgIHJldHVybiByZWNvcmQ7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnRE9NTm9kZVJlbW92ZWQnOgogICAgICAgICAgdGhpcy5hZGRUcmFuc2llbnRPYnNlcnZlcihlLnRhcmdldCk7CiAgICAgICAgICAvLyBGYWxsIHRocm91Z2guCiAgICAgICAgY2FzZSAnRE9NTm9kZUluc2VydGVkJzoKICAgICAgICAgIC8vIGh0dHA6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNjb25jZXB0LW1vLXF1ZXVlLWNoaWxkbGlzdAogICAgICAgICAgdmFyIHRhcmdldCA9IGUucmVsYXRlZE5vZGU7CiAgICAgICAgICB2YXIgY2hhbmdlZE5vZGUgPSBlLnRhcmdldDsKICAgICAgICAgIHZhciBhZGRlZE5vZGVzLCByZW1vdmVkTm9kZXM7CiAgICAgICAgICBpZiAoZS50eXBlID09PSAnRE9NTm9kZUluc2VydGVkJykgewogICAgICAgICAgICBhZGRlZE5vZGVzID0gW2NoYW5nZWROb2RlXTsKICAgICAgICAgICAgcmVtb3ZlZE5vZGVzID0gW107CiAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgYWRkZWROb2RlcyA9IFtdOwogICAgICAgICAgICByZW1vdmVkTm9kZXMgPSBbY2hhbmdlZE5vZGVdOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHByZXZpb3VzU2libGluZyA9IGNoYW5nZWROb2RlLnByZXZpb3VzU2libGluZzsKICAgICAgICAgIHZhciBuZXh0U2libGluZyA9IGNoYW5nZWROb2RlLm5leHRTaWJsaW5nOwoKICAgICAgICAgIC8vIDEuCiAgICAgICAgICB2YXIgcmVjb3JkID0gZ2V0UmVjb3JkKCdjaGlsZExpc3QnLCB0YXJnZXQpOwogICAgICAgICAgcmVjb3JkLmFkZGVkTm9kZXMgPSBhZGRlZE5vZGVzOwogICAgICAgICAgcmVjb3JkLnJlbW92ZWROb2RlcyA9IHJlbW92ZWROb2RlczsKICAgICAgICAgIHJlY29yZC5wcmV2aW91c1NpYmxpbmcgPSBwcmV2aW91c1NpYmxpbmc7CiAgICAgICAgICByZWNvcmQubmV4dFNpYmxpbmcgPSBuZXh0U2libGluZzsKCiAgICAgICAgICBmb3JFYWNoQW5jZXN0b3JBbmRPYnNlcnZlckVucXVldWVSZWNvcmQodGFyZ2V0LCBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIC8vIDIuMSwgMy4yCiAgICAgICAgICAgIGlmICghb3B0aW9ucy5jaGlsZExpc3QpCiAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgLy8gMi4yLCAzLjMKICAgICAgICAgICAgcmV0dXJuIHJlY29yZDsKICAgICAgICAgIH0pOwoKICAgICAgfQoKICAgICAgY2xlYXJSZWNvcmRzKCk7CiAgICB9CiAgfTsKCiAgZ2xvYmFsLkpzTXV0YXRpb25PYnNlcnZlciA9IEpzTXV0YXRpb25PYnNlcnZlcjsKCn0pKHRoaXMpOwoKLyoKICogQ29weXJpZ2h0IDIwMTMgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBCU0Qtc3R5bGUKICogbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLgogKi8KCmlmICghd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIpIHsKICB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciA9IAogICAgICB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlciB8fCAKICAgICAgd2luZG93LkpzTXV0YXRpb25PYnNlcnZlcjsKICBpZiAoIU11dGF0aW9uT2JzZXJ2ZXIpIHsKICAgIHRocm93IG5ldyBFcnJvcigibm8gbXV0YXRpb24gb2JzZXJ2ZXIgc3VwcG9ydCIpOwogIH0KfQoKLyoKICogQ29weXJpZ2h0IDIwMTMgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBCU0Qtc3R5bGUKICogbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLgogKi8KCi8qKgogKiBJbXBsZW1lbnRzIGBkb2N1bWVudC5yZWdpc3RlcmAKICogQG1vZHVsZSBDdXN0b21FbGVtZW50cwoqLwoKLyoqCiAqIFBvbHlmaWxsZWQgZXh0ZW5zaW9ucyB0byB0aGUgYGRvY3VtZW50YCBvYmplY3QuCiAqIEBjbGFzcyBEb2N1bWVudAoqLwoKKGZ1bmN0aW9uKHNjb3BlKSB7CgovLyBpbXBvcnRzCgppZiAoIXNjb3BlKSB7CiAgc2NvcGUgPSB3aW5kb3cuQ3VzdG9tRWxlbWVudHMgPSB7ZmxhZ3M6e319Owp9CnZhciBmbGFncyA9IHNjb3BlLmZsYWdzOwoKLy8gbmF0aXZlIGRvY3VtZW50LnJlZ2lzdGVyPwoKdmFyIGhhc05hdGl2ZSA9IEJvb2xlYW4oZG9jdW1lbnQucmVnaXN0ZXIpOwp2YXIgdXNlTmF0aXZlID0gIWZsYWdzLnJlZ2lzdGVyICYmIGhhc05hdGl2ZTsKCmlmICh1c2VOYXRpdmUpIHsKCiAgLy8gc3R1YgogIHZhciBub3AgPSBmdW5jdGlvbigpIHt9OwoKICAvLyBleHBvcnRzCiAgc2NvcGUucmVnaXN0cnkgPSB7fTsKICBzY29wZS51cGdyYWRlRWxlbWVudCA9IG5vcDsKICAKICBzY29wZS53YXRjaFNoYWRvdyA9IG5vcDsKICBzY29wZS51cGdyYWRlID0gbm9wOwogIHNjb3BlLnVwZ3JhZGVBbGwgPSBub3A7CiAgc2NvcGUudXBncmFkZVN1YnRyZWUgPSBub3A7CiAgc2NvcGUub2JzZXJ2ZURvY3VtZW50ID0gbm9wOwogIHNjb3BlLnVwZ3JhZGVEb2N1bWVudCA9IG5vcDsKICBzY29wZS50YWtlUmVjb3JkcyA9IG5vcDsKCn0gZWxzZSB7CgogIC8qKgogICAqIFJlZ2lzdGVycyBhIGN1c3RvbSB0YWcgbmFtZSB3aXRoIHRoZSBkb2N1bWVudC4KICAgKgogICAqIFdoZW4gYSByZWdpc3RlcmVkIGVsZW1lbnQgaXMgY3JlYXRlZCwgYSBgcmVhZHlDYWxsYmFja2AgbWV0aG9kIGlzIGNhbGxlZAogICAqIGluIHRoZSBzY29wZSBvZiB0aGUgZWxlbWVudC4gVGhlIGByZWFkeUNhbGxiYWNrYCBtZXRob2QgY2FuIGJlIHNwZWNpZmllZCBvbgogICAqIGVpdGhlciBgb3B0aW9ucy5wcm90b3R5cGVgIG9yIGBvcHRpb25zLmxpZmVjeWNsZWAgd2l0aCB0aGUgbGF0dGVyIHRha2luZwogICAqIHByZWNlZGVuY2UuCiAgICoKICAgKiBAbWV0aG9kIHJlZ2lzdGVyCiAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIHRhZyBuYW1lIHRvIHJlZ2lzdGVyLiBNdXN0IGluY2x1ZGUgYSBkYXNoICgnLScpLAogICAqICAgIGZvciBleGFtcGxlICd4LWNvbXBvbmVudCcuCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiAgICBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMuZXh0ZW5kc10KICAgKiAgICAgIChfb2ZmIHNwZWNfKSBUYWcgbmFtZSBvZiBhbiBlbGVtZW50IHRvIGV4dGVuZCAob3IgYmxhbmsgZm9yIGEgbmV3CiAgICogICAgICBlbGVtZW50KS4gVGhpcyBwYXJhbWV0ZXIgaXMgbm90IHBhcnQgb2YgdGhlIHNwZWNpZmljYXRpb24sIGJ1dCBpbnN0ZWFkCiAgICogICAgICBpcyBhIGhpbnQgZm9yIHRoZSBwb2x5ZmlsbCBiZWNhdXNlIHRoZSBleHRlbmRlZSBpcyBkaWZmaWN1bHQgdG8gaW5mZXIuCiAgICogICAgICBSZW1lbWJlciB0aGF0IHRoZSBpbnB1dCBwcm90b3R5cGUgbXVzdCBjaGFpbiB0byB0aGUgZXh0ZW5kZWQgZWxlbWVudCdzCiAgICogICAgICBwcm90b3R5cGUgKG9yIEhUTUxFbGVtZW50LnByb3RvdHlwZSkgcmVnYXJkbGVzcyBvZiB0aGUgdmFsdWUgb2YKICAgKiAgICAgIGBleHRlbmRzYC4KICAgKiAgICBAcGFyYW0ge09iamVjdH0gb3B0aW9ucy5wcm90b3R5cGUgVGhlIHByb3RvdHlwZSB0byB1c2UgZm9yIHRoZSBuZXcKICAgKiAgICAgIGVsZW1lbnQuIFRoZSBwcm90b3R5cGUgbXVzdCBpbmhlcml0IGZyb20gSFRNTEVsZW1lbnQuCiAgICogICAgQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmxpZmVjeWNsZV0KICAgKiAgICAgIENhbGxiYWNrcyB0aGF0IGZpcmUgYXQgaW1wb3J0YW50IHBoYXNlcyBpbiB0aGUgbGlmZSBvZiB0aGUgY3VzdG9tCiAgICogICAgICBlbGVtZW50LgogICAqCiAgICogQGV4YW1wbGUKICAgKiAgICAgIEZhbmN5QnV0dG9uID0gZG9jdW1lbnQucmVnaXN0ZXIoImZhbmN5LWJ1dHRvbiIsIHsKICAgKiAgICAgICAgZXh0ZW5kczogJ2J1dHRvbicsCiAgICogICAgICAgIHByb3RvdHlwZTogT2JqZWN0LmNyZWF0ZShIVE1MQnV0dG9uRWxlbWVudC5wcm90b3R5cGUsIHsKICAgKiAgICAgICAgICByZWFkeUNhbGxiYWNrOiB7CiAgICogICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJhIGZhbmN5LWJ1dHRvbiB3YXMgY3JlYXRlZCIsCiAgICogICAgICAgICAgICB9CiAgICogICAgICAgICAgfQogICAqICAgICAgICB9KQogICAqICAgICAgfSk7CiAgICogQHJldHVybiB7RnVuY3Rpb259IENvbnN0cnVjdG9yIGZvciB0aGUgbmV3bHkgcmVnaXN0ZXJlZCB0eXBlLgogICAqLwogIGZ1bmN0aW9uIHJlZ2lzdGVyKG5hbWUsIG9wdGlvbnMpIHsKICAgIC8vY29uc29sZS53YXJuKCdkb2N1bWVudC5yZWdpc3RlcigiJyArIG5hbWUgKyAnIiwgJywgb3B0aW9ucywgJyknKTsKICAgIC8vIGNvbnN0cnVjdCBhIGRlZmludGlvbiBvdXQgb2Ygb3B0aW9ucwogICAgLy8gVE9ETyhzam1pbGVzKTogcHJvYmFibHkgc2hvdWxkIGNsb25lIG9wdGlvbnMgaW5zdGVhZCBvZiBtdXRhdGluZyBpdAogICAgdmFyIGRlZmluaXRpb24gPSBvcHRpb25zIHx8IHt9OwogICAgaWYgKCFuYW1lKSB7CiAgICAgIC8vIFRPRE8oc2ptaWxlcyk6IHJlcGxhY2Ugd2l0aCBtb3JlIGFwcHJvcHJpYXRlIGVycm9yIChFcmljQiBjYW4gcHJvYmFibHkKICAgICAgLy8gb2ZmZXIgZ3VpZGFuY2UpCiAgICAgIHRocm93IG5ldyBFcnJvcignZG9jdW1lbnQucmVnaXN0ZXI6IGZpcnN0IGFyZ3VtZW50IGBuYW1lYCBtdXN0IG5vdCBiZSBlbXB0eScpOwogICAgfQogICAgaWYgKG5hbWUuaW5kZXhPZignLScpIDwgMCkgewogICAgICAvLyBUT0RPKHNqbWlsZXMpOiByZXBsYWNlIHdpdGggbW9yZSBhcHByb3ByaWF0ZSBlcnJvciAoRXJpY0IgY2FuIHByb2JhYmx5CiAgICAgIC8vIG9mZmVyIGd1aWRhbmNlKQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RvY3VtZW50LnJlZ2lzdGVyOiBmaXJzdCBhcmd1bWVudCAoXCduYW1lXCcpIG11c3QgY29udGFpbiBhIGRhc2ggKFwnLVwnKS4gQXJndW1lbnQgcHJvdmlkZWQgd2FzIFwnJyArIFN0cmluZyhuYW1lKSArICdcJy4nKTsKICAgIH0KICAgIC8vIHJlY29yZCBuYW1lCiAgICBkZWZpbml0aW9uLm5hbWUgPSBuYW1lOwogICAgLy8gbXVzdCBoYXZlIGEgcHJvdG90eXBlLCBkZWZhdWx0IHRvIGFuIGV4dGVuc2lvbiBvZiBIVE1MRWxlbWVudAogICAgLy8gVE9ETyhzam1pbGVzKTogcHJvYmFibHkgc2hvdWxkIHRocm93IGlmIG5vIHByb3RvdHlwZSwgY2hlY2sgc3BlYwogICAgaWYgKCFkZWZpbml0aW9uLnByb3RvdHlwZSkgewogICAgICAvLyBUT0RPKHNqbWlsZXMpOiByZXBsYWNlIHdpdGggbW9yZSBhcHByb3ByaWF0ZSBlcnJvciAoRXJpY0IgY2FuIHByb2JhYmx5CiAgICAgIC8vIG9mZmVyIGd1aWRhbmNlKQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ09wdGlvbnMgbWlzc2luZyByZXF1aXJlZCBwcm90b3R5cGUgcHJvcGVydHknKTsKICAgIH0KICAgIC8vIGVuc3VyZSBhIGxpZmVjeWNsZSBvYmplY3Qgc28gd2UgZG9uJ3QgaGF2ZSB0byBudWxsIHRlc3QgaXQKICAgIGRlZmluaXRpb24ubGlmZWN5Y2xlID0gZGVmaW5pdGlvbi5saWZlY3ljbGUgfHwge307CiAgICAvLyBidWlsZCBhIGxpc3Qgb2YgYW5jZXN0cmFsIGN1c3RvbSBlbGVtZW50cyAoZm9yIG5hdGl2ZSBiYXNlIGRldGVjdGlvbikKICAgIC8vIFRPRE8oc2ptaWxlcyk6IHdlIHVzZWQgdG8gbmVlZCB0byBzdG9yZSB0aGlzLCBidXQgY3VycmVudCBjb2RlIG9ubHkKICAgIC8vIHVzZXMgaXQgaW4gJ3Jlc29sdmVUYWdOYW1lJzogaXQgc2hvdWxkIHByb2JhYmx5IGJlIGlubGluZWQKICAgIGRlZmluaXRpb24uYW5jZXN0cnkgPSBhbmNlc3RyeShkZWZpbml0aW9uLmV4dGVuZHMpOwogICAgLy8gZXh0ZW5zaW9ucyBvZiBuYXRpdmUgc3BlY2lhbGl6YXRpb25zIG9mIEhUTUxFbGVtZW50IHJlcXVpcmUgbG9jYWxOYW1lCiAgICAvLyB0byByZW1haW4gbmF0aXZlLCBhbmQgdXNlIHNlY29uZGFyeSAnaXMnIHNwZWNpZmllciBmb3IgZXh0ZW5zaW9uIHR5cGUKICAgIHJlc29sdmVUYWdOYW1lKGRlZmluaXRpb24pOwogICAgLy8gc29tZSBwbGF0Zm9ybXMgcmVxdWlyZSBtb2RpZmljYXRpb25zIHRvIHRoZSB1c2VyLXN1cHBsaWVkIHByb3RvdHlwZQogICAgLy8gY2hhaW4KICAgIHJlc29sdmVQcm90b3R5cGVDaGFpbihkZWZpbml0aW9uKTsKICAgIC8vIG92ZXJyaWRlcyB0byBpbXBsZW1lbnQgYXR0cmlidXRlQ2hhbmdlZCBjYWxsYmFjawogICAgb3ZlcnJpZGVBdHRyaWJ1dGVBcGkoZGVmaW5pdGlvbi5wcm90b3R5cGUpOwogICAgLy8gNy4xLjU6IFJlZ2lzdGVyIHRoZSBERUZJTklUSU9OIHdpdGggRE9DVU1FTlQKICAgIHJlZ2lzdGVyRGVmaW5pdGlvbihuYW1lLCBkZWZpbml0aW9uKTsKICAgIC8vIDcuMS43LiBSdW4gY3VzdG9tIGVsZW1lbnQgY29uc3RydWN0b3IgZ2VuZXJhdGlvbiBhbGdvcml0aG0gd2l0aCBQUk9UT1RZUEUKICAgIC8vIDcuMS44LiBSZXR1cm4gdGhlIG91dHB1dCBvZiB0aGUgcHJldmlvdXMgc3RlcC4KICAgIGRlZmluaXRpb24uY3RvciA9IGdlbmVyYXRlQ29uc3RydWN0b3IoZGVmaW5pdGlvbik7CiAgICBkZWZpbml0aW9uLmN0b3IucHJvdG90eXBlID0gZGVmaW5pdGlvbi5wcm90b3R5cGU7CiAgICAvLyBmb3JjZSBvdXIgLmNvbnN0cnVjdG9yIHRvIGJlIG91ciBhY3R1YWwgY29uc3RydWN0b3IKICAgIGRlZmluaXRpb24ucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gZGVmaW5pdGlvbi5jdG9yOwogICAgLy8gaWYgaW5pdGlhbCBwYXJzaW5nIGlzIGNvbXBsZXRlCiAgICBpZiAoc2NvcGUucmVhZHkpIHsKICAgICAgLy8gdXBncmFkZSBhbnkgcHJlLWV4aXN0aW5nIG5vZGVzIG9mIHRoaXMgdHlwZQogICAgICBzY29wZS51cGdyYWRlQWxsKGRvY3VtZW50KTsKICAgIH0KICAgIHJldHVybiBkZWZpbml0aW9uLmN0b3I7CiAgfQoKICBmdW5jdGlvbiBhbmNlc3RyeShleHRuZHMpIHsKICAgIHZhciBleHRlbmRlZSA9IHJlZ2lzdHJ5W2V4dG5kc107CiAgICBpZiAoZXh0ZW5kZWUpIHsKICAgICAgcmV0dXJuIGFuY2VzdHJ5KGV4dGVuZGVlLmV4dGVuZHMpLmNvbmNhdChbZXh0ZW5kZWVdKTsKICAgIH0KICAgIHJldHVybiBbXTsKICB9CgogIGZ1bmN0aW9uIHJlc29sdmVUYWdOYW1lKGRlZmluaXRpb24pIHsKICAgIC8vIGlmIHdlIGFyZSBleHBsaWNpdGx5IGV4dGVuZGluZyBzb21ldGhpbmcsIHRoYXQgdGhpbmcgaXMgb3VyCiAgICAvLyBiYXNlVGFnLCB1bmxlc3MgaXQgcmVwcmVzZW50cyBhIGN1c3RvbSBjb21wb25lbnQKICAgIHZhciBiYXNlVGFnID0gZGVmaW5pdGlvbi5leHRlbmRzOwogICAgLy8gaWYgb3VyIGFuY2VzdHJ5IGluY2x1ZGVzIGN1c3RvbSBjb21wb25lbnRzLCB3ZSBvbmx5IGhhdmUgYQogICAgLy8gYmFzZVRhZyBpZiBvbmUgb2YgdGhlbSBkb2VzCiAgICBmb3IgKHZhciBpPTAsIGE7IChhPWRlZmluaXRpb24uYW5jZXN0cnlbaV0pOyBpKyspIHsKICAgICAgYmFzZVRhZyA9IGEuaXMgJiYgYS50YWc7CiAgICB9CiAgICAvLyBvdXIgdGFnIGlzIG91ciBiYXNlVGFnLCBpZiBpdCBleGlzdHMsIGFuZCBvdGhlcndpc2UganVzdCBvdXIgbmFtZQogICAgZGVmaW5pdGlvbi50YWcgPSBiYXNlVGFnIHx8IGRlZmluaXRpb24ubmFtZTsKICAgIGlmIChiYXNlVGFnKSB7CiAgICAgIC8vIGlmIHRoZXJlIGlzIGEgYmFzZSB0YWcsIHVzZSBzZWNvbmRhcnkgJ2lzJyBzcGVjaWZpZXIKICAgICAgZGVmaW5pdGlvbi5pcyA9IGRlZmluaXRpb24ubmFtZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlc29sdmVQcm90b3R5cGVDaGFpbihkZWZpbml0aW9uKSB7CiAgICAvLyBpZiB3ZSBkb24ndCBzdXBwb3J0IF9fcHJvdG9fXyB3ZSBuZWVkIHRvIGxvY2F0ZSB0aGUgbmF0aXZlIGxldmVsCiAgICAvLyBwcm90b3R5cGUgZm9yIHByZWNpc2UgbWl4aW5nIGluCiAgICBpZiAoIU9iamVjdC5fX3Byb3RvX18pIHsKICAgICAgLy8gZGVmYXVsdCBwcm90b3R5cGUKICAgICAgdmFyIG5hdGl2ZVByb3RvdHlwZSA9IEhUTUxFbGVtZW50LnByb3RvdHlwZTsKICAgICAgLy8gd29yayBvdXQgcHJvdG90eXBlIHdoZW4gdXNpbmcgdHlwZS1leHRlbnNpb24KICAgICAgaWYgKGRlZmluaXRpb24uaXMpIHsKICAgICAgICB2YXIgaW5zdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZGVmaW5pdGlvbi50YWcpOwogICAgICAgIG5hdGl2ZVByb3RvdHlwZSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnN0KTsKICAgICAgfQogICAgICAvLyBlbnN1cmUgX19wcm90b19fIHJlZmVyZW5jZSBpcyBpbnN0YWxsZWQgYXQgZWFjaCBwb2ludCBvbiB0aGUgcHJvdG90eXBlCiAgICAgIC8vIGNoYWluLgogICAgICAvLyBOT1RFOiBPbiBwbGF0Zm9ybXMgd2l0aG91dCBfX3Byb3RvX18sIGEgbWl4aW4gc3RyYXRlZ3kgaXMgdXNlZCBpbnN0ZWFkCiAgICAgIC8vIG9mIHByb3RvdHlwZSBzd2l6emxpbmcuIEluIHRoaXMgY2FzZSwgdGhpcyBnZW5lcmF0ZWQgX19wcm90b19fIHByb3ZpZGVzCiAgICAgIC8vIGxpbWl0ZWQgc3VwcG9ydCBmb3IgcHJvdG90eXBlIHRyYXZlcnNhbC4KICAgICAgdmFyIHByb3RvID0gZGVmaW5pdGlvbi5wcm90b3R5cGUsIGFuY2VzdG9yOwogICAgICB3aGlsZSAocHJvdG8gJiYgKHByb3RvICE9PSBuYXRpdmVQcm90b3R5cGUpKSB7CiAgICAgICAgdmFyIGFuY2VzdG9yID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvKTsKICAgICAgICBwcm90by5fX3Byb3RvX18gPSBhbmNlc3RvcjsKICAgICAgICBwcm90byA9IGFuY2VzdG9yOwogICAgICB9CiAgICB9CiAgICAvLyBjYWNoZSB0aGlzIGluIGNhc2Ugb2YgbWl4aW4KICAgIGRlZmluaXRpb24ubmF0aXZlID0gbmF0aXZlUHJvdG90eXBlOwogIH0KCiAgLy8gU0VDVElPTiA0CgogIGZ1bmN0aW9uIGluc3RhbnRpYXRlKGRlZmluaXRpb24pIHsKICAgIC8vIDQuYS4xLiBDcmVhdGUgYSBuZXcgb2JqZWN0IHRoYXQgaW1wbGVtZW50cyBQUk9UT1RZUEUKICAgIC8vIDQuYS4yLiBMZXQgRUxFTUVOVCBieSB0aGlzIG5ldyBvYmplY3QKICAgIC8vCiAgICAvLyB0aGUgY3VzdG9tIGVsZW1lbnQgaW5zdGFudGlhdGlvbiBhbGdvcml0aG0gbXVzdCBhbHNvIGVuc3VyZSB0aGF0IHRoZQogICAgLy8gb3V0cHV0IGlzIGEgdmFsaWQgRE9NIGVsZW1lbnQgd2l0aCB0aGUgcHJvcGVyIHdyYXBwZXIgaW4gcGxhY2UuCiAgICAvLwogICAgcmV0dXJuIHVwZ3JhZGUoZG9tQ3JlYXRlRWxlbWVudChkZWZpbml0aW9uLnRhZyksIGRlZmluaXRpb24pOwogIH0KCiAgZnVuY3Rpb24gdXBncmFkZShlbGVtZW50LCBkZWZpbml0aW9uKSB7CiAgICAvLyBzb21lIGRlZmluaXRpb25zIHNwZWNpZnkgYW4gJ2lzJyBhdHRyaWJ1dGUKICAgIGlmIChkZWZpbml0aW9uLmlzKSB7CiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdpcycsIGRlZmluaXRpb24uaXMpOwogICAgfQogICAgLy8gbWFrZSAnZWxlbWVudCcgaW1wbGVtZW50IGRlZmluaXRpb24ucHJvdG90eXBlCiAgICBpbXBsZW1lbnQoZWxlbWVudCwgZGVmaW5pdGlvbik7CiAgICAvLyBmbGFnIGFzIHVwZ3JhZGVkCiAgICBlbGVtZW50Ll9fdXBncmFkZWRfXyA9IHRydWU7CiAgICAvLyB0aGVyZSBzaG91bGQgbmV2ZXIgYmUgYSBzaGFkb3cgcm9vdCBvbiBlbGVtZW50IGF0IHRoaXMgcG9pbnQKICAgIC8vIHdlIHJlcXVpcmUgY2hpbGQgbm9kZXMgYmUgdXBncmFkZWQgYmVmb3JlIGBjcmVhdGVkYAogICAgc2NvcGUudXBncmFkZVN1YnRyZWUoZWxlbWVudCk7CiAgICAvLyBsaWZlY3ljbGUgbWFuYWdlbWVudAogICAgY3JlYXRlZChlbGVtZW50KTsKICAgIC8vIE9VVFBVVAogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfQoKICBmdW5jdGlvbiBpbXBsZW1lbnQoZWxlbWVudCwgZGVmaW5pdGlvbikgewogICAgLy8gcHJvdG90eXBlIHN3aXp6bGluZyBpcyBiZXN0CiAgICBpZiAoT2JqZWN0Ll9fcHJvdG9fXykgewogICAgICBlbGVtZW50Ll9fcHJvdG9fXyA9IGRlZmluaXRpb24ucHJvdG90eXBlOwogICAgfSBlbHNlIHsKICAgICAgLy8gd2hlcmUgYWJvdmUgd2UgY2FuIHJlLWFjcXVpcmUgaW5Qcm90b3R5cGUgdmlhCiAgICAgIC8vIGdldFByb3RvdHlwZU9mKEVsZW1lbnQpLCB3ZSBjYW5ub3QgZG8gc28gd2hlbgogICAgICAvLyB3ZSB1c2UgbWl4aW4sIHNvIHdlIGluc3RhbGwgYSBtYWdpYyByZWZlcmVuY2UKICAgICAgY3VzdG9tTWl4aW4oZWxlbWVudCwgZGVmaW5pdGlvbi5wcm90b3R5cGUsIGRlZmluaXRpb24ubmF0aXZlKTsKICAgICAgZWxlbWVudC5fX3Byb3RvX18gPSBkZWZpbml0aW9uLnByb3RvdHlwZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGN1c3RvbU1peGluKGluVGFyZ2V0LCBpblNyYywgaW5OYXRpdmUpIHsKICAgIC8vIFRPRE8oc2ptaWxlcyk6ICd1c2VkJyBhbGxvd3MgdXMgdG8gb25seSBjb3B5IHRoZSAneW91bmdlc3QnIHZlcnNpb24gb2YKICAgIC8vIGFueSBwcm9wZXJ0eS4gVGhpcyBzZXQgc2hvdWxkIGJlIHByZWNhbGN1bGF0ZWQuIFdlIGFsc28gbmVlZCB0bwogICAgLy8gY29uc2lkZXIgdGhpcyBmb3Igc3VwcG9ydGluZyAnc3VwZXInLgogICAgdmFyIHVzZWQgPSB7fTsKICAgIC8vIHN0YXJ0IHdpdGggaW5TcmMKICAgIHZhciBwID0gaW5TcmM7CiAgICAvLyBzb21ldGltZXMgdGhlIGRlZmF1bHQgaXMgSFRNTFVua25vd25FbGVtZW50LnByb3RvdHlwZSBpbnN0ZWFkIG9mCiAgICAvLyBIVE1MRWxlbWVudC5wcm90b3R5cGUsIHNvIHdlIGFkZCBhIHRlc3QKICAgIC8vIHRoZSBpZGVhIGlzIHRvIGF2b2lkIG1peGluZyBpbiBuYXRpdmUgcHJvdG90eXBlcywgc28gYWRkaW5nCiAgICAvLyB0aGUgc2Vjb25kIHRlc3QgaXMgV0xPRwogICAgd2hpbGUgKHAgIT09IGluTmF0aXZlICYmIHAgIT09IEhUTUxVbmtub3duRWxlbWVudC5wcm90b3R5cGUpIHsKICAgICAgdmFyIGtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhwKTsKICAgICAgZm9yICh2YXIgaT0wLCBrOyBrPWtleXNbaV07IGkrKykgewogICAgICAgIGlmICghdXNlZFtrXSkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGluVGFyZ2V0LCBrLAogICAgICAgICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocCwgaykpOwogICAgICAgICAgdXNlZFtrXSA9IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHAgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YocCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVkKGVsZW1lbnQpIHsKICAgIC8vIGludm9rZSBjcmVhdGVkQ2FsbGJhY2sKICAgIGlmIChlbGVtZW50LmNyZWF0ZWRDYWxsYmFjaykgewogICAgICBlbGVtZW50LmNyZWF0ZWRDYWxsYmFjaygpOwogICAgfQogIH0KCiAgLy8gYXR0cmlidXRlIHdhdGNoaW5nCgogIGZ1bmN0aW9uIG92ZXJyaWRlQXR0cmlidXRlQXBpKHByb3RvdHlwZSkgewogICAgLy8gb3ZlcnJpZGVzIHRvIGltcGxlbWVudCBjYWxsYmFja3MKICAgIC8vIFRPRE8oc2ptaWxlcyk6IHNob3VsZCBzdXBwb3J0IGFjY2VzcyB2aWEgLmF0dHJpYnV0ZXMgTmFtZWROb2RlTWFwCiAgICAvLyBUT0RPKHNqbWlsZXMpOiBwcmVzZXJ2ZXMgdXNlciBkZWZpbmVkIG92ZXJyaWRlcywgaWYgYW55CiAgICB2YXIgc2V0QXR0cmlidXRlID0gcHJvdG90eXBlLnNldEF0dHJpYnV0ZTsKICAgIHByb3RvdHlwZS5zZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICBjaGFuZ2VBdHRyaWJ1dGUuY2FsbCh0aGlzLCBuYW1lLCB2YWx1ZSwgc2V0QXR0cmlidXRlKTsKICAgIH0KICAgIHZhciByZW1vdmVBdHRyaWJ1dGUgPSBwcm90b3R5cGUucmVtb3ZlQXR0cmlidXRlOwogICAgcHJvdG90eXBlLnJlbW92ZUF0dHJpYnV0ZSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgIGNoYW5nZUF0dHJpYnV0ZS5jYWxsKHRoaXMsIG5hbWUsIHZhbHVlLCByZW1vdmVBdHRyaWJ1dGUpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hhbmdlQXR0cmlidXRlKG5hbWUsIHZhbHVlLCBvcGVyYXRpb24pIHsKICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMuZ2V0QXR0cmlidXRlKG5hbWUpOwogICAgb3BlcmF0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICBpZiAodGhpcy5hdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2sgCiAgICAgICAgJiYgKHRoaXMuZ2V0QXR0cmlidXRlKG5hbWUpICE9PSBvbGRWYWx1ZSkpIHsKICAgICAgdGhpcy5hdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2sobmFtZSwgb2xkVmFsdWUpOwogICAgfQogIH0KCiAgLy8gZWxlbWVudCByZWdpc3RyeSAobWFwcyB0YWcgbmFtZXMgdG8gZGVmaW5pdGlvbnMpCgogIHZhciByZWdpc3RyeSA9IHt9OwoKICBmdW5jdGlvbiByZWdpc3RlckRlZmluaXRpb24obmFtZSwgZGVmaW5pdGlvbikgewogICAgcmVnaXN0cnlbbmFtZV0gPSBkZWZpbml0aW9uOwogIH0KCiAgZnVuY3Rpb24gZ2VuZXJhdGVDb25zdHJ1Y3RvcihkZWZpbml0aW9uKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBpbnN0YW50aWF0ZShkZWZpbml0aW9uKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50KHRhZywgdHlwZUV4dGVuc2lvbikgewogICAgLy8gVE9ETyhzam1pbGVzKTogaWdub3JlICd0YWcnIHdoZW4gdXNpbmcgJ3R5cGVFeHRlbnNpb24nLCB3ZSBjb3VsZAogICAgLy8gZXJyb3IgY2hlY2sgaXQsIG9yIHBlcmhhcHMgdGhlcmUgc2hvdWxkIG9ubHkgZXZlciBiZSBvbmUgYXJndW1lbnQKICAgIHZhciBkZWZpbml0aW9uID0gcmVnaXN0cnlbdHlwZUV4dGVuc2lvbiB8fCB0YWddOwogICAgaWYgKGRlZmluaXRpb24pIHsKICAgICAgcmV0dXJuIG5ldyBkZWZpbml0aW9uLmN0b3IoKTsKICAgIH0KICAgIHJldHVybiBkb21DcmVhdGVFbGVtZW50KHRhZyk7CiAgfQoKICBmdW5jdGlvbiB1cGdyYWRlRWxlbWVudChlbGVtZW50KSB7CiAgICBpZiAoIWVsZW1lbnQuX191cGdyYWRlZF9fICYmIChlbGVtZW50Lm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSkpIHsKICAgICAgdmFyIHR5cGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnaXMnKSB8fCBlbGVtZW50LmxvY2FsTmFtZTsKICAgICAgdmFyIGRlZmluaXRpb24gPSByZWdpc3RyeVt0eXBlXTsKICAgICAgcmV0dXJuIGRlZmluaXRpb24gJiYgdXBncmFkZShlbGVtZW50LCBkZWZpbml0aW9uKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNsb25lTm9kZShkZWVwKSB7CiAgICAvLyBjYWxsIG9yaWdpbmFsIGNsb25lCiAgICB2YXIgbiA9IGRvbUNsb25lTm9kZS5jYWxsKHRoaXMsIGRlZXApOwogICAgLy8gdXBncmFkZSB0aGUgZWxlbWVudCBhbmQgc3VidHJlZQogICAgc2NvcGUudXBncmFkZUFsbChuKTsKICAgIC8vIHJldHVybiB0aGUgY2xvbmUKICAgIHJldHVybiBuOwogIH0KICAvLyBjYXB0dXJlIG5hdGl2ZSBjcmVhdGVFbGVtZW50IGJlZm9yZSB3ZSBvdmVycmlkZSBpdAoKICB2YXIgZG9tQ3JlYXRlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuYmluZChkb2N1bWVudCk7CgogIC8vIGNhcHR1cmUgbmF0aXZlIGNsb25lTm9kZSBiZWZvcmUgd2Ugb3ZlcnJpZGUgaXQKCiAgdmFyIGRvbUNsb25lTm9kZSA9IE5vZGUucHJvdG90eXBlLmNsb25lTm9kZTsKCiAgLy8gZXhwb3J0cwoKICBkb2N1bWVudC5yZWdpc3RlciA9IHJlZ2lzdGVyOwogIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgPSBjcmVhdGVFbGVtZW50OyAvLyBvdmVycmlkZQogIE5vZGUucHJvdG90eXBlLmNsb25lTm9kZSA9IGNsb25lTm9kZTsgLy8gb3ZlcnJpZGUKCiAgc2NvcGUucmVnaXN0cnkgPSByZWdpc3RyeTsKCiAgLyoqCiAgICogVXBncmFkZSBhbiBlbGVtZW50IHRvIGEgY3VzdG9tIGVsZW1lbnQuIFVwZ3JhZGluZyBhbiBlbGVtZW50CiAgICogY2F1c2VzIHRoZSBjdXN0b20gcHJvdG90eXBlIHRvIGJlIGFwcGxpZWQsIGFuIGBpc2AgYXR0cmlidXRlIAogICAqIHRvIGJlIGF0dGFjaGVkIChhcyBuZWVkZWQpLCBhbmQgaW52b2NhdGlvbiBvZiB0aGUgYHJlYWR5Q2FsbGJhY2tgLgogICAqIGB1cGdyYWRlYCBkb2VzIG5vdGhpbmcgaWYgdGhlIGVsZW1lbnQgaXMgYWxyZWFkeSB1cGdyYWRlZCwgb3IKICAgKiBpZiBpdCBtYXRjaGVzIG5vIHJlZ2lzdGVyZWQgY3VzdG9tIHRhZyBuYW1lLgogICAqCiAgICogQG1ldGhvZCB1Z3ByYWRlCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IFRoZSBlbGVtZW50IHRvIHVwZ3JhZGUuCiAgICogQHJldHVybiB7RWxlbWVudH0gVGhlIHVwZ3JhZGVkIGVsZW1lbnQuCiAgICovCiAgc2NvcGUudXBncmFkZSA9IHVwZ3JhZGVFbGVtZW50Owp9CgpzY29wZS5oYXNOYXRpdmUgPSBoYXNOYXRpdmU7CnNjb3BlLnVzZU5hdGl2ZSA9IHVzZU5hdGl2ZTsKCn0pKHdpbmRvdy5DdXN0b21FbGVtZW50cyk7CgogLyoKQ29weXJpZ2h0IDIwMTMgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBCU0Qtc3R5bGUKbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLgoqLwoKKGZ1bmN0aW9uKHNjb3BlKXsKCnZhciBsb2dGbGFncyA9IHdpbmRvdy5sb2dGbGFncyB8fCB7fTsKCi8vIHdhbGsgdGhlIHN1YnRyZWUgcm9vdGVkIGF0IG5vZGUsIGFwcGx5aW5nICdmaW5kKGVsZW1lbnQsIGRhdGEpJyBmdW5jdGlvbgovLyB0byBlYWNoIGVsZW1lbnQKLy8gaWYgJ2ZpbmQnIHJldHVybnMgdHJ1ZSBmb3IgJ2VsZW1lbnQnLCBkbyBub3Qgc2VhcmNoIGVsZW1lbnQncyBzdWJ0cmVlCmZ1bmN0aW9uIGZpbmRBbGwobm9kZSwgZmluZCwgZGF0YSkgewogIHZhciBlID0gbm9kZS5maXJzdEVsZW1lbnRDaGlsZDsKICBpZiAoIWUpIHsKICAgIGUgPSBub2RlLmZpcnN0Q2hpbGQ7CiAgICB3aGlsZSAoZSAmJiBlLm5vZGVUeXBlICE9PSBOb2RlLkVMRU1FTlRfTk9ERSkgewogICAgICBlID0gZS5uZXh0U2libGluZzsKICAgIH0KICB9CiAgd2hpbGUgKGUpIHsKICAgIGlmIChmaW5kKGUsIGRhdGEpICE9PSB0cnVlKSB7CiAgICAgIGZpbmRBbGwoZSwgZmluZCwgZGF0YSk7CiAgICB9CiAgICBlID0gZS5uZXh0RWxlbWVudFNpYmxpbmc7CiAgfQogIHJldHVybiBudWxsOwp9CgovLyB3YWxrIGFsbCBzaGFkb3dSb290cyBvbiBhIGdpdmVuIG5vZGUuCmZ1bmN0aW9uIGZvclJvb3RzKG5vZGUsIGNiKSB7CiAgdmFyIHJvb3QgPSBub2RlLnNoYWRvd1Jvb3Q7CiAgd2hpbGUocm9vdCkgewogICAgZm9yU3VidHJlZShyb290LCBjYik7CiAgICByb290ID0gcm9vdC5vbGRlclNoYWRvd1Jvb3Q7CiAgfQp9CgovLyB3YWxrIHRoZSBzdWJ0cmVlIHJvb3RlZCBhdCBub2RlLCBpbmNsdWRpbmcgZGVzY2VudCBpbnRvIHNoYWRvdy1yb290cywKLy8gYXBwbHlpbmcgJ2NiJyB0byBlYWNoIGVsZW1lbnQKZnVuY3Rpb24gZm9yU3VidHJlZShub2RlLCBjYikgewogIC8vbG9nRmxhZ3MuZG9tICYmIG5vZGUuY2hpbGROb2RlcyAmJiBub2RlLmNoaWxkTm9kZXMubGVuZ3RoICYmIGNvbnNvbGUuZ3JvdXAoJ3N1YlRyZWU6ICcsIG5vZGUpOwogIGZpbmRBbGwobm9kZSwgZnVuY3Rpb24oZSkgewogICAgaWYgKGNiKGUpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZm9yUm9vdHMoZSwgY2IpOwogIH0pOwogIGZvclJvb3RzKG5vZGUsIGNiKTsKICAvL2xvZ0ZsYWdzLmRvbSAmJiBub2RlLmNoaWxkTm9kZXMgJiYgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aCAmJiBjb25zb2xlLmdyb3VwRW5kKCk7Cn0KCi8vIG1hbmFnZSBsaWZlY3ljbGUgb24gYWRkZWQgbm9kZQpmdW5jdGlvbiBhZGRlZChub2RlKSB7CiAgaWYgKHVwZ3JhZGUobm9kZSkpIHsKICAgIGluc2VydGVkTm9kZShub2RlKTsKICAgIHJldHVybiB0cnVlOwogIH0KICBpbnNlcnRlZChub2RlKTsKfQoKLy8gbWFuYWdlIGxpZmVjeWNsZSBvbiBhZGRlZCBub2RlJ3Mgc3VidHJlZSBvbmx5CmZ1bmN0aW9uIGFkZGVkU3VidHJlZShub2RlKSB7CiAgZm9yU3VidHJlZShub2RlLCBmdW5jdGlvbihlKSB7CiAgICBpZiAoYWRkZWQoZSkpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfSk7Cn0KCi8vIG1hbmFnZSBsaWZlY3ljbGUgb24gYWRkZWQgbm9kZSBhbmQgaXQncyBzdWJ0cmVlCmZ1bmN0aW9uIGFkZGVkTm9kZShub2RlKSB7CiAgcmV0dXJuIGFkZGVkKG5vZGUpIHx8IGFkZGVkU3VidHJlZShub2RlKTsKfQoKLy8gdXBncmFkZSBjdXN0b20gZWxlbWVudHMgYXQgbm9kZSwgaWYgYXBwbGljYWJsZQpmdW5jdGlvbiB1cGdyYWRlKG5vZGUpIHsKICBpZiAoIW5vZGUuX191cGdyYWRlZF9fICYmIG5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgICB2YXIgdHlwZSA9IG5vZGUuZ2V0QXR0cmlidXRlKCdpcycpIHx8IG5vZGUubG9jYWxOYW1lOwogICAgdmFyIGRlZmluaXRpb24gPSBzY29wZS5yZWdpc3RyeVt0eXBlXTsKICAgIGlmIChkZWZpbml0aW9uKSB7CiAgICAgIGxvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmdyb3VwKCd1cGdyYWRlOicsIG5vZGUubG9jYWxOYW1lKTsKICAgICAgc2NvcGUudXBncmFkZShub2RlKTsKICAgICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUuZ3JvdXBFbmQoKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBpbnNlcnRlZE5vZGUobm9kZSkgewogIGluc2VydGVkKG5vZGUpOwogIGlmIChpbkRvY3VtZW50KG5vZGUpKSB7CiAgICBmb3JTdWJ0cmVlKG5vZGUsIGZ1bmN0aW9uKGUpIHsKICAgICAgaW5zZXJ0ZWQoZSk7CiAgICB9KTsKICB9Cn0KCgovLyBUT0RPKHNvcnZlbGwpOiBvbiBwbGF0Zm9ybXMgd2l0aG91dCBNdXRhdGlvbk9ic2VydmVyLCBtdXRhdGlvbnMgbWF5IG5vdCBiZSAKLy8gcmVsaWFibGUgYW5kIHRoZXJlZm9yZSBlbnRlcmVkL2xlZnRWaWV3IGFyZSBub3QgcmVsaWFibGUuCi8vIFRvIG1ha2UgdGhlc2UgY2FsbGJhY2tzIGxlc3MgbGlrZWx5IHRvIGZhaWwsIHdlIGRlZmVyIGFsbCBpbnNlcnRzIGFuZCByZW1vdmVzCi8vIHRvIGdpdmUgYSBjaGFuY2UgZm9yIGVsZW1lbnRzIHRvIGJlIGluc2VydGVkIGludG8gZG9tLiAKLy8gVGhpcyBlbnN1cmVzIGVudGVyZWRWaWV3Q2FsbGJhY2sgZmlyZXMgZm9yIGVsZW1lbnRzIHRoYXQgYXJlIGNyZWF0ZWQgYW5kIAovLyBpbW1lZGlhdGVseSBhZGRlZCB0byBkb20uCnZhciBoYXNQb2x5ZmlsbE11dGF0aW9ucyA9ICghd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwKICAgICh3aW5kb3cuTXV0YXRpb25PYnNlcnZlciA9PT0gd2luZG93LkpzTXV0YXRpb25PYnNlcnZlcikpOwpzY29wZS5oYXNQb2x5ZmlsbE11dGF0aW9ucyA9IGhhc1BvbHlmaWxsTXV0YXRpb25zOwoKdmFyIGlzUGVuZGluZ011dGF0aW9ucyA9IGZhbHNlOwp2YXIgcGVuZGluZ011dGF0aW9ucyA9IFtdOwpmdW5jdGlvbiBkZWZlck11dGF0aW9uKGZuKSB7CiAgcGVuZGluZ011dGF0aW9ucy5wdXNoKGZuKTsKICBpZiAoIWlzUGVuZGluZ011dGF0aW9ucykgewogICAgaXNQZW5kaW5nTXV0YXRpb25zID0gdHJ1ZTsKICAgIHZhciBhc3luYyA9ICh3aW5kb3cuUGxhdGZvcm0gJiYgd2luZG93LlBsYXRmb3JtLmVuZE9mTWljcm90YXNrKSB8fAogICAgICAgIHNldFRpbWVvdXQ7CiAgICBhc3luYyh0YWtlTXV0YXRpb25zKTsKICB9Cn0KCmZ1bmN0aW9uIHRha2VNdXRhdGlvbnMoKSB7CiAgaXNQZW5kaW5nTXV0YXRpb25zID0gZmFsc2U7CiAgdmFyICRwID0gcGVuZGluZ011dGF0aW9uczsKICBmb3IgKHZhciBpPTAsIGw9JHAubGVuZ3RoLCBwOyAoaTxsKSAmJiAocD0kcFtpXSk7IGkrKykgewogICAgcCgpOwogIH0KICBwZW5kaW5nTXV0YXRpb25zID0gW107Cn0KCmZ1bmN0aW9uIGluc2VydGVkKGVsZW1lbnQpIHsKICBpZiAoaGFzUG9seWZpbGxNdXRhdGlvbnMpIHsKICAgIGRlZmVyTXV0YXRpb24oZnVuY3Rpb24oKSB7CiAgICAgIF9pbnNlcnRlZChlbGVtZW50KTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICBfaW5zZXJ0ZWQoZWxlbWVudCk7CiAgfQp9CgovLyBUT0RPKHNqbWlsZXMpOiBpZiB0aGVyZSBhcmUgZGVzY2VudHMgaW50byB0cmVlcyB0aGF0IGNhbiBuZXZlciBoYXZlIGluRG9jdW1lbnQoKikgdHJ1ZSwgZml4IHRoaXMKZnVuY3Rpb24gX2luc2VydGVkKGVsZW1lbnQpIHsKICAvLyBUT0RPKHNqbWlsZXMpOiBpdCdzIHBvc3NpYmxlIHdlIHdlcmUgaW5zZXJ0ZWQgYW5kIHJlbW92ZWQgaW4gdGhlIHNwYWNlCiAgLy8gb2Ygb25lIG1pY3JvdGFzaywgaW4gd2hpY2ggY2FzZSB3ZSB3b24ndCBiZSAnaW5Eb2N1bWVudCcgaGVyZQogIC8vIEJ1dCB0aGVyZSBhcmUgb3RoZXIgY2FzZXMgd2hlcmUgd2UgYXJlIHRlc3RpbmcgZm9yIGluc2VydGVkIHdpdGhvdXQKICAvLyBzcGVjaWZpYyBrbm93bGVkZ2Ugb2YgbXV0YXRpb25zLCBhbmQgbXVzdCB0ZXN0ICdpbkRvY3VtZW50JyB0byBkZXRlcm1pbmUKICAvLyB3aGV0aGVyIHRvIGNhbGwgaW5zZXJ0ZWQKICAvLyBJZiB3ZSBjYW4gZmFjdG9yIHRoZXNlIGNhc2VzIGludG8gc2VwYXJhdGUgY29kZSBwYXRocyB3ZSBjYW4gaGF2ZQogIC8vIGJldHRlciBkaWFnbm9zdGljcy4KICAvLyBUT0RPKHNqbWlsZXMpOiB3aGVuIGxvZ2dpbmcsIGRvIHdvcmsgb24gYWxsIGN1c3RvbSBlbGVtZW50cyBzbyB3ZSBjYW4KICAvLyB0cmFjayBiZWhhdmlvciBldmVuIHdoZW4gY2FsbGJhY2tzIG5vdCBkZWZpbmVkCiAgLy9jb25zb2xlLmxvZygnaW5zZXJ0ZWQ6ICcsIGVsZW1lbnQubG9jYWxOYW1lKTsKICBpZiAoZWxlbWVudC5lbnRlcmVkVmlld0NhbGxiYWNrIHx8IChlbGVtZW50Ll9fdXBncmFkZWRfXyAmJiBsb2dGbGFncy5kb20pKSB7CiAgICBsb2dGbGFncy5kb20gJiYgY29uc29sZS5ncm91cCgnaW5zZXJ0ZWQ6JywgZWxlbWVudC5sb2NhbE5hbWUpOwogICAgaWYgKGluRG9jdW1lbnQoZWxlbWVudCkpIHsKICAgICAgZWxlbWVudC5fX2luc2VydGVkID0gKGVsZW1lbnQuX19pbnNlcnRlZCB8fCAwKSArIDE7CiAgICAgIC8vIGlmIHdlIGFyZSBpbiBhICdyZW1vdmVkJyBzdGF0ZSwgYmx1bnRseSBhZGp1c3QgdG8gYW4gJ2luc2VydGVkJyBzdGF0ZQogICAgICBpZiAoZWxlbWVudC5fX2luc2VydGVkIDwgMSkgewogICAgICAgIGVsZW1lbnQuX19pbnNlcnRlZCA9IDE7CiAgICAgIH0KICAgICAgLy8gaWYgd2UgYXJlICdvdmVyIGluc2VydGVkJywgc3F1ZWxjaCB0aGUgY2FsbGJhY2sKICAgICAgaWYgKGVsZW1lbnQuX19pbnNlcnRlZCA+IDEpIHsKICAgICAgICBsb2dGbGFncy5kb20gJiYgY29uc29sZS53YXJuKCdpbnNlcnRlZDonLCBlbGVtZW50LmxvY2FsTmFtZSwKICAgICAgICAgICdpbnNlcnQvcmVtb3ZlIGNvdW50OicsIGVsZW1lbnQuX19pbnNlcnRlZCkKICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmVudGVyZWRWaWV3Q2FsbGJhY2spIHsKICAgICAgICBsb2dGbGFncy5kb20gJiYgY29uc29sZS5sb2coJ2luc2VydGVkOicsIGVsZW1lbnQubG9jYWxOYW1lKTsKICAgICAgICBlbGVtZW50LmVudGVyZWRWaWV3Q2FsbGJhY2soKTsKICAgICAgfQogICAgfQogICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUuZ3JvdXBFbmQoKTsKICB9Cn0KCmZ1bmN0aW9uIHJlbW92ZWROb2RlKG5vZGUpIHsKICByZW1vdmVkKG5vZGUpOwogIGZvclN1YnRyZWUobm9kZSwgZnVuY3Rpb24oZSkgewogICAgcmVtb3ZlZChlKTsKICB9KTsKfQoKCmZ1bmN0aW9uIHJlbW92ZWQoZWxlbWVudCkgewogIGlmIChoYXNQb2x5ZmlsbE11dGF0aW9ucykgewogICAgZGVmZXJNdXRhdGlvbihmdW5jdGlvbigpIHsKICAgICAgX3JlbW92ZWQoZWxlbWVudCk7CiAgICB9KTsKICB9IGVsc2UgewogICAgX3JlbW92ZWQoZWxlbWVudCk7CiAgfQp9CgpmdW5jdGlvbiByZW1vdmVkKGVsZW1lbnQpIHsKICAvLyBUT0RPKHNqbWlsZXMpOiB0ZW1wb3Jhcnk6IGRvIHdvcmsgb24gYWxsIGN1c3RvbSBlbGVtZW50cyBzbyB3ZSBjYW4gdHJhY2sKICAvLyBiZWhhdmlvciBldmVuIHdoZW4gY2FsbGJhY2tzIG5vdCBkZWZpbmVkCiAgaWYgKGVsZW1lbnQubGVmdFZpZXdDYWxsYmFjayB8fCAoZWxlbWVudC5fX3VwZ3JhZGVkX18gJiYgbG9nRmxhZ3MuZG9tKSkgewogICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUubG9nKCdyZW1vdmVkOicsIGVsZW1lbnQubG9jYWxOYW1lKTsKICAgIGlmICghaW5Eb2N1bWVudChlbGVtZW50KSkgewogICAgICBlbGVtZW50Ll9faW5zZXJ0ZWQgPSAoZWxlbWVudC5fX2luc2VydGVkIHx8IDApIC0gMTsKICAgICAgLy8gaWYgd2UgYXJlIGluIGEgJ2luc2VydGVkJyBzdGF0ZSwgYmx1bnRseSBhZGp1c3QgdG8gYW4gJ3JlbW92ZWQnIHN0YXRlCiAgICAgIGlmIChlbGVtZW50Ll9faW5zZXJ0ZWQgPiAwKSB7CiAgICAgICAgZWxlbWVudC5fX2luc2VydGVkID0gMDsKICAgICAgfQogICAgICAvLyBpZiB3ZSBhcmUgJ292ZXIgcmVtb3ZlZCcsIHNxdWVsY2ggdGhlIGNhbGxiYWNrCiAgICAgIGlmIChlbGVtZW50Ll9faW5zZXJ0ZWQgPCAwKSB7CiAgICAgICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUud2FybigncmVtb3ZlZDonLCBlbGVtZW50LmxvY2FsTmFtZSwKICAgICAgICAgICAgJ2luc2VydC9yZW1vdmUgY291bnQ6JywgZWxlbWVudC5fX2luc2VydGVkKQogICAgICB9IGVsc2UgaWYgKGVsZW1lbnQubGVmdFZpZXdDYWxsYmFjaykgewogICAgICAgIGVsZW1lbnQubGVmdFZpZXdDYWxsYmFjaygpOwogICAgICB9CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBpbkRvY3VtZW50KGVsZW1lbnQpIHsKICB2YXIgcCA9IGVsZW1lbnQ7CiAgdmFyIGRvYyA9IHdpbmRvdy5TaGFkb3dET01Qb2x5ZmlsbCAmJgogICAgICB3aW5kb3cuU2hhZG93RE9NUG9seWZpbGwud3JhcElmTmVlZGVkKGRvY3VtZW50KSB8fCBkb2N1bWVudDsKICB3aGlsZSAocCkgewogICAgaWYgKHAgPT0gZG9jKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcCA9IHAucGFyZW50Tm9kZSB8fCBwLmhvc3Q7CiAgfQp9CgpmdW5jdGlvbiB3YXRjaFNoYWRvdyhub2RlKSB7CiAgaWYgKG5vZGUuc2hhZG93Um9vdCAmJiAhbm9kZS5zaGFkb3dSb290Ll9fd2F0Y2hlZCkgewogICAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUubG9nKCd3YXRjaGluZyBzaGFkb3ctcm9vdCBmb3I6ICcsIG5vZGUubG9jYWxOYW1lKTsKICAgIC8vIHdhdGNoIGFsbCB1bndhdGNoZWQgcm9vdHMuLi4KICAgIHZhciByb290ID0gbm9kZS5zaGFkb3dSb290OwogICAgd2hpbGUgKHJvb3QpIHsKICAgICAgd2F0Y2hSb290KHJvb3QpOwogICAgICByb290ID0gcm9vdC5vbGRlclNoYWRvd1Jvb3Q7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiB3YXRjaFJvb3Qocm9vdCkgewogIGlmICghcm9vdC5fX3dhdGNoZWQpIHsKICAgIG9ic2VydmUocm9vdCk7CiAgICByb290Ll9fd2F0Y2hlZCA9IHRydWU7CiAgfQp9CgpmdW5jdGlvbiBmaWx0ZXIoaW5Ob2RlKSB7CiAgc3dpdGNoIChpbk5vZGUubG9jYWxOYW1lKSB7CiAgICBjYXNlICdzdHlsZSc6CiAgICBjYXNlICdzY3JpcHQnOgogICAgY2FzZSAndGVtcGxhdGUnOgogICAgY2FzZSB1bmRlZmluZWQ6CiAgICAgIHJldHVybiB0cnVlOwogIH0KfQoKZnVuY3Rpb24gaGFuZGxlcihtdXRhdGlvbnMpIHsKICAvLwogIGlmIChsb2dGbGFncy5kb20pIHsKICAgIHZhciBteCA9IG11dGF0aW9uc1swXTsKICAgIGlmIChteCAmJiBteC50eXBlID09PSAnY2hpbGRMaXN0JyAmJiBteC5hZGRlZE5vZGVzKSB7CiAgICAgICAgaWYgKG14LmFkZGVkTm9kZXMpIHsKICAgICAgICAgIHZhciBkID0gbXguYWRkZWROb2Rlc1swXTsKICAgICAgICAgIHdoaWxlIChkICYmIGQgIT09IGRvY3VtZW50ICYmICFkLmhvc3QpIHsKICAgICAgICAgICAgZCA9IGQucGFyZW50Tm9kZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciB1ID0gZCAmJiAoZC5VUkwgfHwgZC5fVVJMIHx8IChkLmhvc3QgJiYgZC5ob3N0LmxvY2FsTmFtZSkpIHx8ICcnOwogICAgICAgICAgdSA9IHUuc3BsaXQoJy8/Jykuc2hpZnQoKS5zcGxpdCgnLycpLnBvcCgpOwogICAgICAgIH0KICAgIH0KICAgIGNvbnNvbGUuZ3JvdXAoJ211dGF0aW9ucyAoJWQpIFslc10nLCBtdXRhdGlvbnMubGVuZ3RoLCB1IHx8ICcnKTsKICB9CiAgLy8KICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihteCkgewogICAgLy9sb2dGbGFncy5kb20gJiYgY29uc29sZS5ncm91cCgnbXV0YXRpb24nKTsKICAgIGlmIChteC50eXBlID09PSAnY2hpbGRMaXN0JykgewogICAgICBmb3JFYWNoKG14LmFkZGVkTm9kZXMsIGZ1bmN0aW9uKG4pIHsKICAgICAgICAvL2xvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmxvZyhuLmxvY2FsTmFtZSk7CiAgICAgICAgaWYgKGZpbHRlcihuKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyBub2RlcyBhZGRlZCBtYXkgbmVlZCBsaWZlY3ljbGUgbWFuYWdlbWVudAogICAgICAgIGFkZGVkTm9kZShuKTsKICAgICAgfSk7CiAgICAgIC8vIHJlbW92ZWQgbm9kZXMgbWF5IG5lZWQgbGlmZWN5Y2xlIG1hbmFnZW1lbnQKICAgICAgZm9yRWFjaChteC5yZW1vdmVkTm9kZXMsIGZ1bmN0aW9uKG4pIHsKICAgICAgICAvL2xvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmxvZyhuLmxvY2FsTmFtZSk7CiAgICAgICAgaWYgKGZpbHRlcihuKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByZW1vdmVkTm9kZShuKTsKICAgICAgfSk7CiAgICB9CiAgICAvL2xvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmdyb3VwRW5kKCk7CiAgfSk7CiAgbG9nRmxhZ3MuZG9tICYmIGNvbnNvbGUuZ3JvdXBFbmQoKTsKfTsKCnZhciBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGhhbmRsZXIpOwoKZnVuY3Rpb24gdGFrZVJlY29yZHMoKSB7CiAgLy8gVE9ETyhzam1pbGVzKTogYXNrIFJhZiB3aHkgd2UgaGF2ZSB0byBjYWxsIGhhbmRsZXIgb3Vyc2VsdmVzCiAgaGFuZGxlcihvYnNlcnZlci50YWtlUmVjb3JkcygpKTsKICB0YWtlTXV0YXRpb25zKCk7Cn0KCnZhciBmb3JFYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbC5iaW5kKEFycmF5LnByb3RvdHlwZS5mb3JFYWNoKTsKCmZ1bmN0aW9uIG9ic2VydmUoaW5Sb290KSB7CiAgb2JzZXJ2ZXIub2JzZXJ2ZShpblJvb3QsIHtjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9KTsKfQoKZnVuY3Rpb24gb2JzZXJ2ZURvY3VtZW50KGRvY3VtZW50KSB7CiAgb2JzZXJ2ZShkb2N1bWVudCk7Cn0KCmZ1bmN0aW9uIHVwZ3JhZGVEb2N1bWVudChkb2N1bWVudCkgewogIGxvZ0ZsYWdzLmRvbSAmJiBjb25zb2xlLmdyb3VwKCd1cGdyYWRlRG9jdW1lbnQ6ICcsIChkb2N1bWVudC5VUkwgfHwgZG9jdW1lbnQuX1VSTCB8fCAnJykuc3BsaXQoJy8nKS5wb3AoKSk7CiAgYWRkZWROb2RlKGRvY3VtZW50KTsKICBsb2dGbGFncy5kb20gJiYgY29uc29sZS5ncm91cEVuZCgpOwp9CgovLyBleHBvcnRzCgpzY29wZS53YXRjaFNoYWRvdyA9IHdhdGNoU2hhZG93OwpzY29wZS51cGdyYWRlQWxsID0gYWRkZWROb2RlOwpzY29wZS51cGdyYWRlU3VidHJlZSA9IGFkZGVkU3VidHJlZTsKCnNjb3BlLm9ic2VydmVEb2N1bWVudCA9IG9ic2VydmVEb2N1bWVudDsKc2NvcGUudXBncmFkZURvY3VtZW50ID0gdXBncmFkZURvY3VtZW50OwoKc2NvcGUudGFrZVJlY29yZHMgPSB0YWtlUmVjb3JkczsKCn0pKHdpbmRvdy5DdXN0b21FbGVtZW50cyk7CgovKgogKiBDb3B5cmlnaHQgMjAxMyBUaGUgUG9seW1lciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZQogKiBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuCiAqLwoKKGZ1bmN0aW9uKHNjb3BlKSB7CgppZiAoIXNjb3BlKSB7CiAgc2NvcGUgPSB3aW5kb3cuSFRNTEltcG9ydHMgPSB7ZmxhZ3M6e319Owp9CgovLyBpbXBvcnRzCgp2YXIgeGhyID0gc2NvcGUueGhyOwoKLy8gaW1wb3J0ZXIKCnZhciBJTVBPUlRfTElOS19UWVBFID0gJ2ltcG9ydCc7CnZhciBTVFlMRV9MSU5LX1RZUEUgPSAnc3R5bGVzaGVldCc7CgovLyBoaWdobGFuZGVyIG9iamVjdCByZXByZXNlbnRzIGEgcHJpbWFyeSBkb2N1bWVudCAodGhlIGFyZ3VtZW50IHRvICdsb2FkJykKLy8gYXQgdGhlIHJvb3Qgb2YgYSB0cmVlIG9mIGRvY3VtZW50cwoKLy8gZm9yIGFueSBkb2N1bWVudCwgaW1wb3J0ZXI6Ci8vIC0gbG9hZHMgYW55IGxpbmtlZCBkb2N1bWVudHMgKHdpdGggZGVkdXBpbmcpLCBtb2RpZmllcyBwYXRocyBhbmQgZmVlZHMgdGhlbSBiYWNrIGludG8gaW1wb3J0ZXIKLy8gLSBsb2FkcyB0ZXh0IG9mIGV4dGVybmFsIHNjcmlwdCB0YWdzCi8vIC0gbG9hZHMgdGV4dCBvZiBleHRlcm5hbCBzdHlsZSB0YWdzIGluc2lkZSBvZiA8ZWxlbWVudD4sIG1vZGlmaWVzIHBhdGhzCgovLyB3aGVuIGltcG9ydGVyICdtb2RpZmllcyBwYXRocycgaW4gYSBkb2N1bWVudCwgdGhpcyBpbmNsdWRlcwovLyAtIGhyZWYvc3JjL2FjdGlvbiBpbiBub2RlIGF0dHJpYnV0ZXMKLy8gLSBwYXRocyBpbiBpbmxpbmUgc3R5bGVzaGVldHMKLy8gLSBhbGwgY29udGVudCBpbnNpZGUgdGVtcGxhdGVzCgovLyBsaW5rZWQgc3R5bGUgc2hlZXRzIGluIGFuIGltcG9ydCBoYXZlIHRoZWlyIG93biBwYXRoIGZpeGVkIHVwIHdoZW4gdGhlaXIgY29udGFpbmluZyBpbXBvcnQgbW9kaWZpZXMgcGF0aHMKLy8gbGlua2VkIHN0eWxlIHNoZWV0cyBpbiBhbiA8ZWxlbWVudD4gYXJlIGxvYWRlZCwgYW5kIHRoZSBjb250ZW50IGdldHMgcGF0aCBmaXh1cHMKLy8gaW5saW5lIHN0eWxlIHNoZWV0cyBnZXQgcGF0aCBmaXh1cHMgd2hlbiB0aGVpciBjb250YWluaW5nIGltcG9ydCBtb2RpZmllcyBwYXRocwoKdmFyIGxvYWRlcjsKCnZhciBpbXBvcnRlciA9IHsKICBkb2N1bWVudHM6IHt9LAogIGNhY2hlOiB7fSwKICBwcmVsb2FkU2VsZWN0b3JzOiBbCiAgICAnbGlua1tyZWw9JyArIElNUE9SVF9MSU5LX1RZUEUgKyAnXScsCiAgICAnZWxlbWVudCBsaW5rW3JlbD0nICsgU1RZTEVfTElOS19UWVBFICsgJ10nLAogICAgJ3RlbXBsYXRlJywKICAgICdzY3JpcHRbc3JjXTpub3QoW3R5cGVdKScsCiAgICAnc2NyaXB0W3NyY11bdHlwZT0idGV4dC9qYXZhc2NyaXB0Il0nCiAgXS5qb2luKCcsJyksCiAgbG9hZGVyOiBmdW5jdGlvbihuZXh0KSB7CiAgICAvLyBjb25zdHJ1Y3QgYSBsb2FkZXIgaW5zdGFuY2UKICAgIGxvYWRlciA9IG5ldyBMb2FkZXIoaW1wb3J0ZXIubG9hZGVkLCBuZXh0KTsKICAgIC8vIGFsaWFzIHRoZSBsb2FkZXIgY2FjaGUgKGZvciBkZWJ1Z2dpbmcpCiAgICBsb2FkZXIuY2FjaGUgPSBpbXBvcnRlci5jYWNoZTsKICAgIHJldHVybiBsb2FkZXI7CiAgfSwKICBsb2FkOiBmdW5jdGlvbihkb2MsIG5leHQpIHsKICAgIC8vIGNvbnN0cnVjdCBhIGxvYWRlciBpbnN0YW5jZQogICAgbG9hZGVyID0gaW1wb3J0ZXIubG9hZGVyKG5leHQpOwogICAgLy8gYWRkIG5vZGVzIGZyb20gZG9jdW1lbnQgaW50byBsb2FkZXIgcXVldWUKICAgIGltcG9ydGVyLnByZWxvYWQoZG9jKTsKICB9LAogIHByZWxvYWQ6IGZ1bmN0aW9uKGRvYykgewogICAgLy8gYWxsIHByZWxvYWRhYmxlIG5vZGVzIGluIGluRG9jdW1lbnQKICAgIHZhciBub2RlcyA9IGRvYy5xdWVyeVNlbGVjdG9yQWxsKGltcG9ydGVyLnByZWxvYWRTZWxlY3RvcnMpOwogICAgLy8gZnJvbSB0aGUgbWFpbiBkb2N1bWVudCwgb25seSBsb2FkIGltcG9ydHMKICAgIC8vIFRPRE8oc2ptaWxlcyk6IGRvIHRoaXMgYnkgYWx0ZXJpbmcgdGhlIHNlbGVjdG9yIGxpc3QgaW5zdGVhZAogICAgbm9kZXMgPSB0aGlzLmZpbHRlck1haW5Eb2N1bWVudE5vZGVzKGRvYywgbm9kZXMpOwogICAgLy8gZXh0cmEgbGluayBub2RlcyBmcm9tIHRlbXBsYXRlcywgZmlsdGVyIHRlbXBsYXRlcyBvdXQgb2YgdGhlIG5vZGVzIGxpc3QKICAgIG5vZGVzID0gdGhpcy5leHRyYWN0VGVtcGxhdGVOb2Rlcyhub2Rlcyk7CiAgICAvLyBhZGQgdGhlc2Ugbm9kZXMgdG8gbG9hZGVyJ3MgcXVldWUKICAgIGxvYWRlci5hZGROb2Rlcyhub2Rlcyk7CiAgfSwKICBmaWx0ZXJNYWluRG9jdW1lbnROb2RlczogZnVuY3Rpb24oZG9jLCBub2RlcykgewogICAgaWYgKGRvYyA9PT0gZG9jdW1lbnQpIHsKICAgICAgbm9kZXMgPSBBcnJheS5wcm90b3R5cGUuZmlsdGVyLmNhbGwobm9kZXMsIGZ1bmN0aW9uKG4pIHsKICAgICAgICByZXR1cm4gIWlzU2NyaXB0KG4pOwogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBub2RlczsKICB9LAogIGV4dHJhY3RUZW1wbGF0ZU5vZGVzOiBmdW5jdGlvbihub2RlcykgewogICAgdmFyIGV4dHJhID0gW107CiAgICBub2RlcyA9IEFycmF5LnByb3RvdHlwZS5maWx0ZXIuY2FsbChub2RlcywgZnVuY3Rpb24obikgewogICAgICBpZiAobi5sb2NhbE5hbWUgPT09ICd0ZW1wbGF0ZScpIHsKICAgICAgICBpZiAobi5jb250ZW50KSB7CiAgICAgICAgICB2YXIgbCQgPSBuLmNvbnRlbnQucXVlcnlTZWxlY3RvckFsbCgnbGlua1tyZWw9JyArIFNUWUxFX0xJTktfVFlQRSArCiAgICAgICAgICAgICddJyk7CiAgICAgICAgICBpZiAobCQubGVuZ3RoKSB7CiAgICAgICAgICAgIGV4dHJhID0gZXh0cmEuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGwkLCAwKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0pOwogICAgaWYgKGV4dHJhLmxlbmd0aCkgewogICAgICBub2RlcyA9IG5vZGVzLmNvbmNhdChleHRyYSk7CiAgICB9CiAgICByZXR1cm4gbm9kZXM7CiAgfSwKICBsb2FkZWQ6IGZ1bmN0aW9uKHVybCwgZWx0LCByZXNvdXJjZSkgewogICAgaWYgKGlzRG9jdW1lbnRMaW5rKGVsdCkpIHsKICAgICAgdmFyIGRvY3VtZW50ID0gaW1wb3J0ZXIuZG9jdW1lbnRzW3VybF07CiAgICAgIC8vIGlmIHdlJ3ZlIG5ldmVyIHNlZW4gYSBkb2N1bWVudCBhdCB0aGlzIHVybAogICAgICBpZiAoIWRvY3VtZW50KSB7CiAgICAgICAgLy8gZ2VuZXJhdGUgYW4gSFRNTERvY3VtZW50IGZyb20gZGF0YQogICAgICAgIGRvY3VtZW50ID0gbWFrZURvY3VtZW50KHJlc291cmNlLCB1cmwpOwogICAgICAgIC8vIHJlc29sdmUgcmVzb3VyY2UgcGF0aHMgcmVsYXRpdmUgdG8gaG9zdCBkb2N1bWVudAogICAgICAgIHBhdGgucmVzb2x2ZVBhdGhzSW5IVE1MKGRvY3VtZW50KTsKICAgICAgICAvLyBjYWNoZSBkb2N1bWVudAogICAgICAgIGltcG9ydGVyLmRvY3VtZW50c1t1cmxdID0gZG9jdW1lbnQ7CiAgICAgICAgLy8gYWRkIG5vZGVzIGZyb20gdGhpcyBkb2N1bWVudCB0byB0aGUgbG9hZGVyIHF1ZXVlCiAgICAgICAgaW1wb3J0ZXIucHJlbG9hZChkb2N1bWVudCk7CiAgICAgIH0KICAgICAgLy8gc3RvcmUgaW1wb3J0IHJlY29yZAogICAgICBlbHQuaW1wb3J0ID0gewogICAgICAgIGhyZWY6IHVybCwKICAgICAgICBvd25lck5vZGU6IGVsdCwKICAgICAgICBjb250ZW50OiBkb2N1bWVudAogICAgICB9OwogICAgICAvLyBzdG9yZSBkb2N1bWVudCByZXNvdXJjZQogICAgICBlbHQuY29udGVudCA9IHJlc291cmNlID0gZG9jdW1lbnQ7CiAgICB9CiAgICAvLyBzdG9yZSBnZW5lcmljIHJlc291cmNlCiAgICAvLyBUT0RPKHNvcnZlbGwpOiBmYWlscyBmb3Igbm9kZXMgaW5zaWRlIDx0ZW1wbGF0ZT4uY29udGVudAogICAgLy8gc2VlIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0yNDkzODEuCiAgICBlbHQuX19yZXNvdXJjZSA9IHJlc291cmNlOwogICAgLy8gY3NzIHBhdGggZml4dXBzCiAgICBpZiAoaXNTdHlsZXNoZWV0TGluayhlbHQpKSB7CiAgICAgIHBhdGgucmVzb2x2ZVBhdGhzSW5TdHlsZXNoZWV0KGVsdCk7CiAgICB9CiAgfQp9OwoKZnVuY3Rpb24gaXNEb2N1bWVudExpbmsoZWx0KSB7CiAgcmV0dXJuIGlzTGlua1JlbChlbHQsIElNUE9SVF9MSU5LX1RZUEUpOwp9CgpmdW5jdGlvbiBpc1N0eWxlc2hlZXRMaW5rKGVsdCkgewogIHJldHVybiBpc0xpbmtSZWwoZWx0LCBTVFlMRV9MSU5LX1RZUEUpOwp9CgpmdW5jdGlvbiBpc0xpbmtSZWwoZWx0LCByZWwpIHsKICByZXR1cm4gZWx0LmxvY2FsTmFtZSA9PT0gJ2xpbmsnICYmIGVsdC5nZXRBdHRyaWJ1dGUoJ3JlbCcpID09PSByZWw7Cn0KCmZ1bmN0aW9uIGlzU2NyaXB0KGVsdCkgewogIHJldHVybiBlbHQubG9jYWxOYW1lID09PSAnc2NyaXB0JzsKfQoKZnVuY3Rpb24gbWFrZURvY3VtZW50KHJlc291cmNlLCB1cmwpIHsKICAvLyBjcmVhdGUgYSBuZXcgSFRNTCBkb2N1bWVudAogIHZhciBkb2MgPSByZXNvdXJjZTsKICBpZiAoIShkb2MgaW5zdGFuY2VvZiBEb2N1bWVudCkpIHsKICAgIGRvYyA9IGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudChJTVBPUlRfTElOS19UWVBFKTsKICAgIC8vIGluc3RhbGwgaHRtbAogICAgZG9jLmJvZHkuaW5uZXJIVE1MID0gcmVzb3VyY2U7CiAgfQogIC8vIGNhY2hlIHRoZSBuZXcgZG9jdW1lbnQncyBzb3VyY2UgdXJsCiAgZG9jLl9VUkwgPSB1cmw7CiAgLy8gZXN0YWJsaXNoIGEgcmVsYXRpdmUgcGF0aCB2aWEgPGJhc2U+CiAgdmFyIGJhc2UgPSBkb2MuY3JlYXRlRWxlbWVudCgnYmFzZScpOwogIGJhc2Uuc2V0QXR0cmlidXRlKCdocmVmJywgZG9jdW1lbnQuYmFzZVVSSSB8fCBkb2N1bWVudC5VUkwpOwogIGRvYy5oZWFkLmFwcGVuZENoaWxkKGJhc2UpOwogIC8vIFRPRE8oc29ydmVsbCk6IGlkZWFsbHkgdGhpcyBjb2RlIGlzIG5vdCBhd2FyZSBvZiBUZW1wbGF0ZSBwb2x5ZmlsbCwKICAvLyBidXQgZm9yIG5vdyB0aGUgcG9seWZpbGwgbmVlZHMgaGVscCB0byBib290c3RyYXAgdGhlc2UgdGVtcGxhdGVzCiAgaWYgKHdpbmRvdy5IVE1MVGVtcGxhdGVFbGVtZW50ICYmIEhUTUxUZW1wbGF0ZUVsZW1lbnQuYm9vdHN0cmFwKSB7CiAgICBIVE1MVGVtcGxhdGVFbGVtZW50LmJvb3RzdHJhcChkb2MpOwogIH0KICByZXR1cm4gZG9jOwp9Cgp2YXIgTG9hZGVyID0gZnVuY3Rpb24ob25Mb2FkLCBvbkNvbXBsZXRlKSB7CiAgdGhpcy5vbmxvYWQgPSBvbkxvYWQ7CiAgdGhpcy5vbmNvbXBsZXRlID0gb25Db21wbGV0ZTsKICB0aGlzLmluZmxpZ2h0ID0gMDsKICB0aGlzLnBlbmRpbmcgPSB7fTsKICB0aGlzLmNhY2hlID0ge307Cn07CgpMb2FkZXIucHJvdG90eXBlID0gewogIGFkZE5vZGVzOiBmdW5jdGlvbihub2RlcykgewogICAgLy8gbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyB0byBjb21wbGV0ZQogICAgdGhpcy5pbmZsaWdodCArPSBub2Rlcy5sZW5ndGg7CiAgICAvLyBjb21tZW5jZSB0cmFuc2FjdGlvbnMKICAgIGZvckVhY2gobm9kZXMsIHRoaXMucmVxdWlyZSwgdGhpcyk7CiAgICAvLyBhbnl0aGluZyB0byBkbz8KICAgIHRoaXMuY2hlY2tEb25lKCk7CiAgfSwKICByZXF1aXJlOiBmdW5jdGlvbihlbHQpIHsKICAgIHZhciB1cmwgPSBwYXRoLm5vZGVVcmwoZWx0KTsKICAgIC8vIFRPRE8oc2ptaWxlcyk6IGFkLWhvYwogICAgZWx0Ll9fbm9kZVVybCA9IHVybDsKICAgIC8vIGRlZHVwbGljYXRpb24KICAgIGlmICghdGhpcy5kZWR1cGUodXJsLCBlbHQpKSB7CiAgICAgIC8vIGZldGNoIHRoaXMgcmVzb3VyY2UKICAgICAgdGhpcy5mZXRjaCh1cmwsIGVsdCk7CiAgICB9CiAgfSwKICBkZWR1cGU6IGZ1bmN0aW9uKHVybCwgZWx0KSB7CiAgICBpZiAodGhpcy5wZW5kaW5nW3VybF0pIHsKICAgICAgLy8gYWRkIHRvIGxpc3Qgb2Ygbm9kZXMgd2FpdGluZyBmb3IgaW5VcmwKICAgICAgdGhpcy5wZW5kaW5nW3VybF0ucHVzaChlbHQpOwogICAgICAvLyBkb24ndCBuZWVkIGZldGNoCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHRoaXMuY2FjaGVbdXJsXSkgewogICAgICAvLyBjb21wbGV0ZSBsb2FkIHVzaW5nIGNhY2hlIGRhdGEKICAgICAgdGhpcy5vbmxvYWQodXJsLCBlbHQsIGxvYWRlci5jYWNoZVt1cmxdKTsKICAgICAgLy8gZmluaXNoZWQgdGhpcyB0cmFuc2FjdGlvbgogICAgICB0aGlzLnRhaWwoKTsKICAgICAgLy8gZG9uJ3QgbmVlZCBmZXRjaAogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8vIGZpcnN0IG5vZGUgd2FpdGluZyBmb3IgaW5VcmwKICAgIHRoaXMucGVuZGluZ1t1cmxdID0gW2VsdF07CiAgICAvLyBuZWVkIGZldGNoIChub3QgYSBkdXBlKQogICAgcmV0dXJuIGZhbHNlOwogIH0sCiAgZmV0Y2g6IGZ1bmN0aW9uKHVybCwgZWx0KSB7CiAgICB2YXIgcmVjZWl2ZVhociA9IGZ1bmN0aW9uKGVyciwgcmVzb3VyY2UpIHsKICAgICAgdGhpcy5yZWNlaXZlKHVybCwgZWx0LCBlcnIsIHJlc291cmNlKTsKICAgIH0uYmluZCh0aGlzKTsKICAgIHhoci5sb2FkKHVybCwgcmVjZWl2ZVhocik7CiAgICAvLyBUT0RPKHNvcnZlbGwpOiBibG9ja2VkIG9uCiAgICAvLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9MjU3MjIxCiAgICAvLyB4aHInaW5nIGZvciBhIGRvY3VtZW50IG1ha2VzIHNjcmlwdHMgaW4gaW1wb3J0cyBydW5uYWJsZTsgb3RoZXJ3aXNlCiAgICAvLyB0aGV5IGFyZSBub3Q7IGhvd2V2ZXIsIGl0IHJlcXVpcmVzIHRoYXQgd2UgaGF2ZSBkb2N0eXBlPWh0bWwgaW4KICAgIC8vIHRoZSBpbXBvcnQgd2hpY2ggaXMgdW5hY2NlcHRhYmxlLiBUaGlzIGlzIG9ubHkgbmVlZGVkIG9uIENocm9tZQogICAgLy8gdG8gYXZvaWQgdGhlIGJ1ZyBhYm92ZS4KICAgIC8qCiAgICBpZiAoaXNEb2N1bWVudExpbmsoZWx0KSkgewogICAgICB4aHIubG9hZERvY3VtZW50KHVybCwgcmVjZWl2ZVhocik7CiAgICB9IGVsc2UgewogICAgICB4aHIubG9hZCh1cmwsIHJlY2VpdmVYaHIpOwogICAgfQogICAgKi8KICB9LAogIHJlY2VpdmU6IGZ1bmN0aW9uKHVybCwgZWx0LCBlcnIsIHJlc291cmNlKSB7CiAgICBpZiAoIWVycikgewogICAgICBsb2FkZXIuY2FjaGVbdXJsXSA9IHJlc291cmNlOwogICAgfQogICAgbG9hZGVyLnBlbmRpbmdbdXJsXS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFlcnIpIHsKICAgICAgICB0aGlzLm9ubG9hZCh1cmwsIGUsIHJlc291cmNlKTsKICAgICAgfQogICAgICB0aGlzLnRhaWwoKTsKICAgIH0sIHRoaXMpOwogICAgbG9hZGVyLnBlbmRpbmdbdXJsXSA9IG51bGw7CiAgfSwKICB0YWlsOiBmdW5jdGlvbigpIHsKICAgIC0tdGhpcy5pbmZsaWdodDsKICAgIHRoaXMuY2hlY2tEb25lKCk7CiAgfSwKICBjaGVja0RvbmU6IGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLmluZmxpZ2h0KSB7CiAgICAgIHRoaXMub25jb21wbGV0ZSgpOwogICAgfQogIH0KfTsKCnZhciBVUkxfQVRUUlMgPSBbJ2hyZWYnLCAnc3JjJywgJ2FjdGlvbiddOwp2YXIgVVJMX0FUVFJTX1NFTEVDVE9SID0gJ1snICsgVVJMX0FUVFJTLmpvaW4oJ10sWycpICsgJ10nOwp2YXIgVVJMX1RFTVBMQVRFX1NFQVJDSCA9ICd7ey4qfX0nOwoKdmFyIHBhdGggPSB7CiAgbm9kZVVybDogZnVuY3Rpb24obm9kZSkgewogICAgcmV0dXJuIHBhdGgucmVzb2x2ZVVybChwYXRoLmRvY3VtZW50VVJMLCBwYXRoLmhyZWZPclNyYyhub2RlKSk7CiAgfSwKICBocmVmT3JTcmM6IGZ1bmN0aW9uKG5vZGUpIHsKICAgIHJldHVybiBub2RlLmdldEF0dHJpYnV0ZSgiaHJlZiIpIHx8IG5vZGUuZ2V0QXR0cmlidXRlKCJzcmMiKTsKICB9LAogIGRvY3VtZW50VXJsRnJvbU5vZGU6IGZ1bmN0aW9uKG5vZGUpIHsKICAgIHJldHVybiBwYXRoLmdldERvY3VtZW50VXJsKG5vZGUub3duZXJEb2N1bWVudCB8fCBub2RlKTsKICB9LAogIGdldERvY3VtZW50VXJsOiBmdW5jdGlvbihkb2MpIHsKICAgIHZhciB1cmwgPSBkb2MgJiYKICAgICAgICAvLyBUT0RPKHNqbWlsZXMpOiBTaGFkb3dET01Qb2x5ZmlsbCBpbnRydXNpb24KICAgICAgICAoZG9jLl9VUkwgfHwgKGRvYy5pbXBsICYmIGRvYy5pbXBsLl9VUkwpCiAgICAgICAgICAgIHx8IGRvYy5iYXNlVVJJIHx8IGRvYy5VUkwpCiAgICAgICAgICAgICAgICB8fCAnJzsKICAgIC8vIHRha2Ugb25seSB0aGUgbGVmdCBzaWRlIGlmIHRoZXJlIGlzIGEgIwogICAgcmV0dXJuIHVybC5zcGxpdCgnIycpWzBdOwogIH0sCiAgcmVzb2x2ZVVybDogZnVuY3Rpb24oYmFzZVVybCwgdXJsKSB7CiAgICBpZiAodGhpcy5pc0Fic1VybCh1cmwpKSB7CiAgICAgIHJldHVybiB1cmw7CiAgICB9CiAgICByZXR1cm4gdGhpcy5jb21wcmVzc1VybCh0aGlzLnVybFRvUGF0aChiYXNlVXJsKSArIHVybCk7CiAgfSwKICByZXNvbHZlUmVsYXRpdmVVcmw6IGZ1bmN0aW9uKGJhc2VVcmwsIHVybCkgewogICAgaWYgKHRoaXMuaXNBYnNVcmwodXJsKSkgewogICAgICByZXR1cm4gdXJsOwogICAgfQogICAgcmV0dXJuIHRoaXMubWFrZURvY3VtZW50UmVsUGF0aCh0aGlzLnJlc29sdmVVcmwoYmFzZVVybCwgdXJsKSk7CiAgfSwKICBpc0Fic1VybDogZnVuY3Rpb24odXJsKSB7CiAgICByZXR1cm4gLyheZGF0YTopfCheaHR0cFtzXT86KXwoXlwvKS8udGVzdCh1cmwpOwogIH0sCiAgdXJsVG9QYXRoOiBmdW5jdGlvbihiYXNlVXJsKSB7CiAgICB2YXIgcGFydHMgPSBiYXNlVXJsLnNwbGl0KCIvIik7CiAgICBwYXJ0cy5wb3AoKTsKICAgIHBhcnRzLnB1c2goJycpOwogICAgcmV0dXJuIHBhcnRzLmpvaW4oIi8iKTsKICB9LAogIGNvbXByZXNzVXJsOiBmdW5jdGlvbih1cmwpIHsKICAgIHZhciBzZWFyY2ggPSAnJzsKICAgIHZhciBzZWFyY2hQb3MgPSB1cmwuaW5kZXhPZignPycpOwogICAgLy8gcXVlcnkgc3RyaW5nIGlzIG5vdCBwYXJ0IG9mIHRoZSBwYXRoCiAgICBpZiAoc2VhcmNoUG9zID4gLTEpIHsKICAgICAgc2VhcmNoID0gdXJsLnN1YnN0cmluZyhzZWFyY2hQb3MpOwogICAgICB1cmwgPSB1cmwuc3Vic3RyaW5nKHNlYXJjaFBvcywgMCk7CiAgICB9CiAgICB2YXIgcGFydHMgPSB1cmwuc3BsaXQoJy8nKTsKICAgIGZvciAodmFyIGk9MCwgcDsgaTxwYXJ0cy5sZW5ndGg7IGkrKykgewogICAgICBwID0gcGFydHNbaV07CiAgICAgIGlmIChwID09PSAnLi4nKSB7CiAgICAgICAgcGFydHMuc3BsaWNlKGktMSwgMik7CiAgICAgICAgaSAtPSAyOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcGFydHMuam9pbignLycpICsgc2VhcmNoOwogIH0sCiAgbWFrZURvY3VtZW50UmVsUGF0aDogZnVuY3Rpb24odXJsKSB7CiAgICAvLyB0ZXN0IHVybCBhZ2FpbnN0IGRvY3VtZW50IHRvIHNlZSBpZiB3ZSBjYW4gY29uc3RydWN0IGEgcmVsYXRpdmUgcGF0aAogICAgcGF0aC51cmxFbHQuaHJlZiA9IHVybDsKICAgIC8vIElFIGRvZXMgbm90IHNldCBob3N0IGlmIHNhbWUgYXMgZG9jdW1lbnQKICAgIGlmICghcGF0aC51cmxFbHQuaG9zdCB8fCAKICAgICAgICAocGF0aC51cmxFbHQuaG9zdCA9PT0gd2luZG93LmxvY2F0aW9uLmhvc3QgJiYKICAgICAgICBwYXRoLnVybEVsdC5wcm90b2NvbCA9PT0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sKSkgewogICAgICByZXR1cm4gdGhpcy5tYWtlUmVsUGF0aChwYXRoLmRvY3VtZW50VVJMLCBwYXRoLnVybEVsdC5ocmVmKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB1cmw7CiAgICB9CiAgfSwKICAvLyBtYWtlIGEgcmVsYXRpdmUgcGF0aCBmcm9tIHNvdXJjZSB0byB0YXJnZXQKICBtYWtlUmVsUGF0aDogZnVuY3Rpb24oc291cmNlLCB0YXJnZXQpIHsKICAgIHZhciBzID0gc291cmNlLnNwbGl0KCcvJyk7CiAgICB2YXIgdCA9IHRhcmdldC5zcGxpdCgnLycpOwogICAgd2hpbGUgKHMubGVuZ3RoICYmIHNbMF0gPT09IHRbMF0pewogICAgICBzLnNoaWZ0KCk7CiAgICAgIHQuc2hpZnQoKTsKICAgIH0KICAgIGZvcih2YXIgaSA9IDAsIGwgPSBzLmxlbmd0aC0xOyBpIDwgbDsgaSsrKSB7CiAgICAgIHQudW5zaGlmdCgnLi4nKTsKICAgIH0KICAgIHZhciByID0gdC5qb2luKCcvJyk7CiAgICByZXR1cm4gcjsKICB9LAogIHJlc29sdmVQYXRoc0luSFRNTDogZnVuY3Rpb24ocm9vdCwgdXJsKSB7CiAgICB1cmwgPSB1cmwgfHwgcGF0aC5kb2N1bWVudFVybEZyb21Ob2RlKHJvb3QpCiAgICBwYXRoLnJlc29sdmVBdHRyaWJ1dGVzKHJvb3QsIHVybCk7CiAgICBwYXRoLnJlc29sdmVTdHlsZUVsdHMocm9vdCwgdXJsKTsKICAgIC8vIGhhbmRsZSB0ZW1wbGF0ZS5jb250ZW50CiAgICB2YXIgdGVtcGxhdGVzID0gcm9vdC5xdWVyeVNlbGVjdG9yQWxsKCd0ZW1wbGF0ZScpOwogICAgaWYgKHRlbXBsYXRlcykgewogICAgICBmb3JFYWNoKHRlbXBsYXRlcywgZnVuY3Rpb24odCkgewogICAgICAgIGlmICh0LmNvbnRlbnQpIHsKICAgICAgICAgIHBhdGgucmVzb2x2ZVBhdGhzSW5IVE1MKHQuY29udGVudCwgdXJsKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sCiAgcmVzb2x2ZVBhdGhzSW5TdHlsZXNoZWV0OiBmdW5jdGlvbihzaGVldCkgewogICAgdmFyIGRvY1VybCA9IHBhdGgubm9kZVVybChzaGVldCk7CiAgICBzaGVldC5fX3Jlc291cmNlID0gcGF0aC5yZXNvbHZlQ3NzVGV4dChzaGVldC5fX3Jlc291cmNlLCBkb2NVcmwpOwogIH0sCiAgcmVzb2x2ZVN0eWxlRWx0czogZnVuY3Rpb24ocm9vdCwgdXJsKSB7CiAgICB2YXIgc3R5bGVzID0gcm9vdC5xdWVyeVNlbGVjdG9yQWxsKCdzdHlsZScpOwogICAgaWYgKHN0eWxlcykgewogICAgICBmb3JFYWNoKHN0eWxlcywgZnVuY3Rpb24oc3R5bGUpIHsKICAgICAgICBzdHlsZS50ZXh0Q29udGVudCA9IHBhdGgucmVzb2x2ZUNzc1RleHQoc3R5bGUudGV4dENvbnRlbnQsIHVybCk7CiAgICAgIH0pOwogICAgfQogIH0sCiAgcmVzb2x2ZUNzc1RleHQ6IGZ1bmN0aW9uKGNzc1RleHQsIGJhc2VVcmwpIHsKICAgIHJldHVybiBjc3NUZXh0LnJlcGxhY2UoL3VybFwoW14pXSpcKS9nLCBmdW5jdGlvbihtYXRjaCkgewogICAgICAvLyBmaW5kIHRoZSB1cmwgcGF0aCwgaWdub3JlIHF1b3RlcyBpbiB1cmwgc3RyaW5nCiAgICAgIHZhciB1cmxQYXRoID0gbWF0Y2gucmVwbGFjZSgvWyInXS9nLCAiIikuc2xpY2UoNCwgLTEpOwogICAgICB1cmxQYXRoID0gcGF0aC5yZXNvbHZlUmVsYXRpdmVVcmwoYmFzZVVybCwgdXJsUGF0aCk7CiAgICAgIHJldHVybiAidXJsKCIgKyB1cmxQYXRoICsgIikiOwogICAgfSk7CiAgfSwKICByZXNvbHZlQXR0cmlidXRlczogZnVuY3Rpb24ocm9vdCwgdXJsKSB7CiAgICAvLyBzZWFyY2ggZm9yIGF0dHJpYnV0ZXMgdGhhdCBob3N0IHVybHMKICAgIHZhciBub2RlcyA9IHJvb3QgJiYgcm9vdC5xdWVyeVNlbGVjdG9yQWxsKFVSTF9BVFRSU19TRUxFQ1RPUik7CiAgICBpZiAobm9kZXMpIHsKICAgICAgZm9yRWFjaChub2RlcywgZnVuY3Rpb24obikgewogICAgICAgIHRoaXMucmVzb2x2ZU5vZGVBdHRyaWJ1dGVzKG4sIHVybCk7CiAgICAgIH0sIHRoaXMpOwogICAgfQogIH0sCiAgcmVzb2x2ZU5vZGVBdHRyaWJ1dGVzOiBmdW5jdGlvbihub2RlLCB1cmwpIHsKICAgIFVSTF9BVFRSUy5mb3JFYWNoKGZ1bmN0aW9uKHYpIHsKICAgICAgdmFyIGF0dHIgPSBub2RlLmF0dHJpYnV0ZXNbdl07CiAgICAgIGlmIChhdHRyICYmIGF0dHIudmFsdWUgJiYKICAgICAgICAgKGF0dHIudmFsdWUuc2VhcmNoKFVSTF9URU1QTEFURV9TRUFSQ0gpIDwgMCkpIHsKICAgICAgICB2YXIgdXJsUGF0aCA9IHBhdGgucmVzb2x2ZVJlbGF0aXZlVXJsKHVybCwgYXR0ci52YWx1ZSk7CiAgICAgICAgYXR0ci52YWx1ZSA9IHVybFBhdGg7CiAgICAgIH0KICAgIH0pOwogIH0KfTsKCnBhdGguZG9jdW1lbnRVUkwgPSBwYXRoLmdldERvY3VtZW50VXJsKGRvY3VtZW50KTsKcGF0aC51cmxFbHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7Cgp4aHIgPSB4aHIgfHwgewogIGFzeW5jOiB0cnVlLAogIG9rOiBmdW5jdGlvbihyZXF1ZXN0KSB7CiAgICByZXR1cm4gKHJlcXVlc3Quc3RhdHVzID49IDIwMCAmJiByZXF1ZXN0LnN0YXR1cyA8IDMwMCkKICAgICAgICB8fCAocmVxdWVzdC5zdGF0dXMgPT09IDMwNCkKICAgICAgICB8fCAocmVxdWVzdC5zdGF0dXMgPT09IDApOwogIH0sCiAgbG9hZDogZnVuY3Rpb24odXJsLCBuZXh0LCBuZXh0Q29udGV4dCkgewogICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIGlmIChzY29wZS5mbGFncy5kZWJ1ZyB8fCBzY29wZS5mbGFncy5idXN0KSB7CiAgICAgIHVybCArPSAnPycgKyBNYXRoLnJhbmRvbSgpOwogICAgfQogICAgcmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwsIHhoci5hc3luYyk7CiAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWR5c3RhdGVjaGFuZ2UnLCBmdW5jdGlvbihlKSB7CiAgICAgIGlmIChyZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHsKICAgICAgICBuZXh0LmNhbGwobmV4dENvbnRleHQsICF4aHIub2socmVxdWVzdCkgJiYgcmVxdWVzdCwKICAgICAgICAgIHJlcXVlc3QucmVzcG9uc2UsIHVybCk7CiAgICAgIH0KICAgIH0pOwogICAgcmVxdWVzdC5zZW5kKCk7CiAgICByZXR1cm4gcmVxdWVzdDsKICB9LAogIGxvYWREb2N1bWVudDogZnVuY3Rpb24odXJsLCBuZXh0LCBuZXh0Q29udGV4dCkgewogICAgdGhpcy5sb2FkKHVybCwgbmV4dCwgbmV4dENvbnRleHQpLnJlc3BvbnNlVHlwZSA9ICdkb2N1bWVudCc7CiAgfQp9OwoKdmFyIGZvckVhY2ggPSBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsLmJpbmQoQXJyYXkucHJvdG90eXBlLmZvckVhY2gpOwoKLy8gZXhwb3J0cwoKc2NvcGUucGF0aCA9IHBhdGg7CnNjb3BlLnhociA9IHhocjsKc2NvcGUuaW1wb3J0ZXIgPSBpbXBvcnRlcjsKc2NvcGUuZ2V0RG9jdW1lbnRVcmwgPSBwYXRoLmdldERvY3VtZW50VXJsOwpzY29wZS5JTVBPUlRfTElOS19UWVBFID0gSU1QT1JUX0xJTktfVFlQRTsKCn0pKHdpbmRvdy5IVE1MSW1wb3J0cyk7CgovKgogKiBDb3B5cmlnaHQgMjAxMyBUaGUgUG9seW1lciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZQogKiBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuCiAqLwoKKGZ1bmN0aW9uKHNjb3BlKSB7Cgp2YXIgSU1QT1JUX0xJTktfVFlQRSA9ICdpbXBvcnQnOwoKLy8gaGlnaGxhbmRlciBvYmplY3QgZm9yIHBhcnNpbmcgYSBkb2N1bWVudCB0cmVlCgp2YXIgaW1wb3J0UGFyc2VyID0gewogIHNlbGVjdG9yczogWwogICAgJ2xpbmtbcmVsPScgKyBJTVBPUlRfTElOS19UWVBFICsgJ10nLAogICAgJ2xpbmtbcmVsPXN0eWxlc2hlZXRdJywKICAgICdzdHlsZScsCiAgICAnc2NyaXB0Om5vdChbdHlwZV0pJywKICAgICdzY3JpcHRbdHlwZT0idGV4dC9qYXZhc2NyaXB0Il0nCiAgXSwKICBtYXA6IHsKICAgIGxpbms6ICdwYXJzZUxpbmsnLAogICAgc2NyaXB0OiAncGFyc2VTY3JpcHQnLAogICAgc3R5bGU6ICdwYXJzZUdlbmVyaWMnCiAgfSwKICBwYXJzZTogZnVuY3Rpb24oaW5Eb2N1bWVudCkgewogICAgaWYgKCFpbkRvY3VtZW50Ll9faW1wb3J0UGFyc2VkKSB7CiAgICAgIC8vIG9ubHkgcGFyc2Ugb25jZQogICAgICBpbkRvY3VtZW50Ll9faW1wb3J0UGFyc2VkID0gdHJ1ZTsKICAgICAgLy8gYWxsIHBhcnNhYmxlIGVsZW1lbnRzIGluIGluRG9jdW1lbnQgKGRlcHRoLWZpcnN0IHByZS1vcmRlciB0cmF2ZXJzYWwpCiAgICAgIHZhciBlbHRzID0gaW5Eb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGltcG9ydFBhcnNlci5zZWxlY3RvcnMpOwogICAgICAvLyBmb3IgZWFjaCBwYXJzYWJsZSBub2RlIHR5cGUsIGNhbGwgdGhlIG1hcHBlZCBwYXJzaW5nIG1ldGhvZAogICAgICBmb3JFYWNoKGVsdHMsIGZ1bmN0aW9uKGUpIHsKICAgICAgICBpbXBvcnRQYXJzZXJbaW1wb3J0UGFyc2VyLm1hcFtlLmxvY2FsTmFtZV1dKGUpOwogICAgICB9KTsKICAgIH0KICB9LAogIHBhcnNlTGluazogZnVuY3Rpb24obGlua0VsdCkgewogICAgaWYgKGlzRG9jdW1lbnRMaW5rKGxpbmtFbHQpKSB7CiAgICAgIGlmIChsaW5rRWx0LmNvbnRlbnQpIHsKICAgICAgICBpbXBvcnRQYXJzZXIucGFyc2UobGlua0VsdC5jb250ZW50KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5wYXJzZUdlbmVyaWMobGlua0VsdCk7CiAgICB9CiAgfSwKICBwYXJzZUdlbmVyaWM6IGZ1bmN0aW9uKGVsdCkgewogICAgaWYgKG5lZWRzTWFpbkRvY3VtZW50Q29udGV4dChlbHQpKSB7CiAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoZWx0KTsKICAgIH0KICB9LAogIHBhcnNlU2NyaXB0OiBmdW5jdGlvbihzY3JpcHRFbHQpIHsKICAgIGlmIChuZWVkc01haW5Eb2N1bWVudENvbnRleHQoc2NyaXB0RWx0KSkgewogICAgICAvLyBhY3F1aXJlIGNvZGUgdG8gZXhlY3V0ZQogICAgICB2YXIgY29kZSA9IChzY3JpcHRFbHQuX19yZXNvdXJjZSB8fCBzY3JpcHRFbHQudGV4dENvbnRlbnQpLnRyaW0oKTsKICAgICAgaWYgKGNvZGUpIHsKICAgICAgICAvLyBjYWxjdWxhdGUgc291cmNlIG1hcCBoaW50CiAgICAgICAgdmFyIG1vbmlrZXIgPSBzY3JpcHRFbHQuX19ub2RlVXJsOwogICAgICAgIGlmICghbW9uaWtlcikgewogICAgICAgICAgdmFyIG1vbmlrZXIgPSBzY29wZS5wYXRoLmRvY3VtZW50VXJsRnJvbU5vZGUoc2NyaXB0RWx0KTsKICAgICAgICAgIC8vIHRoZXJlIGNvdWxkIGJlIG1vcmUgdGhhbiBvbmUgc2NyaXB0IHRoaXMgdXJsCiAgICAgICAgICB2YXIgdGFnID0gJ1snICsgTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSsxKSoxMDAwKSArICddJzsKICAgICAgICAgIC8vIFRPRE8oc2ptaWxlcyk6IFBvbHltZXIgaGFjaywgc2hvdWxkIGJlIHBsdWdnYWJsZSBpZiB3ZSBuZWVkIHRvIGFsbG93IAogICAgICAgICAgLy8gdGhpcyBzb3J0IG9mIHRoaW5nCiAgICAgICAgICB2YXIgbWF0Y2hlcyA9IGNvZGUubWF0Y2goL1BvbHltZXJcKFsnIl0oW14nIl0qKS8pOwogICAgICAgICAgdGFnID0gbWF0Y2hlcyAmJiBtYXRjaGVzWzFdIHx8IHRhZzsKICAgICAgICAgIC8vIHRhZyB0aGUgbW9uaWtlcgogICAgICAgICAgbW9uaWtlciArPSAnLycgKyB0YWcgKyAnLmpzJzsKICAgICAgICB9CiAgICAgICAgLy8gc291cmNlIG1hcCBoaW50CiAgICAgICAgY29kZSArPSAiXG4vLyMgc291cmNlVVJMPSIgKyBtb25pa2VyICsgIlxuIjsKICAgICAgICAvLyBldmFsdWF0ZSB0aGUgY29kZQogICAgICAgIGV2YWwuY2FsbCh3aW5kb3csIGNvZGUpOwogICAgICB9CiAgICB9CiAgfQp9OwoKdmFyIGZvckVhY2ggPSBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsLmJpbmQoQXJyYXkucHJvdG90eXBlLmZvckVhY2gpOwoKZnVuY3Rpb24gaXNEb2N1bWVudExpbmsoZWx0KSB7CiAgcmV0dXJuIGVsdC5sb2NhbE5hbWUgPT09ICdsaW5rJwogICAgICAmJiBlbHQuZ2V0QXR0cmlidXRlKCdyZWwnKSA9PT0gSU1QT1JUX0xJTktfVFlQRTsKfQoKZnVuY3Rpb24gbmVlZHNNYWluRG9jdW1lbnRDb250ZXh0KG5vZGUpIHsKICAvLyBub2RlcyBjYW4gYmUgbW92ZWQgdG8gdGhlIG1haW4gZG9jdW1lbnQ6CiAgLy8gaWYgdGhleSBhcmUgaW4gYSB0cmVlIGJ1dCBub3QgaW4gdGhlIG1haW4gZG9jdW1lbnQgYW5kIG5vdCBjaGlsZHJlbiBvZiA8ZWxlbWVudD4KICByZXR1cm4gbm9kZS5wYXJlbnROb2RlICYmICFpbk1haW5Eb2N1bWVudChub2RlKSAKICAgICAgJiYgIWlzRWxlbWVudEVsZW1lbnRDaGlsZChub2RlKTsKfQoKZnVuY3Rpb24gaW5NYWluRG9jdW1lbnQoZWx0KSB7CiAgcmV0dXJuIGVsdC5vd25lckRvY3VtZW50ID09PSBkb2N1bWVudCB8fAogICAgLy8gVE9ETyhzam1pbGVzKTogU2hhZG93RE9NUG9seWZpbGwgaW50cnVzaW9uCiAgICBlbHQub3duZXJEb2N1bWVudC5pbXBsID09PSBkb2N1bWVudDsKfQoKZnVuY3Rpb24gaXNFbGVtZW50RWxlbWVudENoaWxkKGVsdCkgewogIHJldHVybiBlbHQucGFyZW50Tm9kZSAmJiBlbHQucGFyZW50Tm9kZS5sb2NhbE5hbWUgPT09ICdlbGVtZW50JzsKfQoKLy8gZXhwb3J0cwoKc2NvcGUucGFyc2VyID0gaW1wb3J0UGFyc2VyOwoKfSkoSFRNTEltcG9ydHMpOwovKgogKiBDb3B5cmlnaHQgMjAxMyBUaGUgUG9seW1lciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZQogKiBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuCiAqLwooZnVuY3Rpb24oKXsKCi8vIGJvb3RzdHJhcAoKLy8gSUUgc2hpbSBmb3IgQ3VzdG9tRXZlbnQKaWYgKHR5cGVvZiB3aW5kb3cuQ3VzdG9tRXZlbnQgIT09ICdmdW5jdGlvbicpIHsKICB3aW5kb3cuQ3VzdG9tRXZlbnQgPSBmdW5jdGlvbihpblR5cGUpIHsKICAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdIVE1MRXZlbnRzJyk7CiAgICAgZS5pbml0RXZlbnQoaW5UeXBlLCB0cnVlLCB0cnVlKTsKICAgICByZXR1cm4gZTsKICB9Owp9CgpmdW5jdGlvbiBib290c3RyYXAoKSB7CiAgLy8gcHJlbG9hZCBkb2N1bWVudCByZXNvdXJjZSB0cmVlcwogIEhUTUxJbXBvcnRzLmltcG9ydGVyLmxvYWQoZG9jdW1lbnQsIGZ1bmN0aW9uKCkgewogICAgSFRNTEltcG9ydHMucGFyc2VyLnBhcnNlKGRvY3VtZW50KTsKICAgIEhUTUxJbXBvcnRzLnJlYWR5VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgLy8gc2VuZCBIVE1MSW1wb3J0c0xvYWRlZCB3aGVuIGZpbmlzaGVkCiAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KAogICAgICBuZXcgQ3VzdG9tRXZlbnQoJ0hUTUxJbXBvcnRzTG9hZGVkJywge2J1YmJsZXM6IHRydWV9KQogICAgKTsKICB9KTsKfTsKCmlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7CiAgYm9vdHN0cmFwKCk7Cn0gZWxzZSB7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBib290c3RyYXApOwp9Cgp9KSgpOwoKLyoKICogQ29weXJpZ2h0IDIwMTMgVGhlIFBvbHltZXIgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBCU0Qtc3R5bGUKICogbGljZW5zZSB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlLgogKi8KCihmdW5jdGlvbigpIHsKCi8vIGltcG9ydAoKdmFyIElNUE9SVF9MSU5LX1RZUEUgPSB3aW5kb3cuSFRNTEltcG9ydHMgPyBIVE1MSW1wb3J0cy5JTVBPUlRfTElOS19UWVBFIDogJ25vbmUnOwoKLy8gaGlnaGxhbmRlciBvYmplY3QgZm9yIHBhcnNpbmcgYSBkb2N1bWVudCB0cmVlCgp2YXIgcGFyc2VyID0gewogIHNlbGVjdG9yczogWwogICAgJ2xpbmtbcmVsPScgKyBJTVBPUlRfTElOS19UWVBFICsgJ10nCiAgXSwKICBtYXA6IHsKICAgIGxpbms6ICdwYXJzZUxpbmsnCiAgfSwKICBwYXJzZTogZnVuY3Rpb24oaW5Eb2N1bWVudCkgewogICAgaWYgKCFpbkRvY3VtZW50Ll9fcGFyc2VkKSB7CiAgICAgIC8vIG9ubHkgcGFyc2Ugb25jZQogICAgICBpbkRvY3VtZW50Ll9fcGFyc2VkID0gdHJ1ZTsKICAgICAgLy8gYWxsIHBhcnNhYmxlIGVsZW1lbnRzIGluIGluRG9jdW1lbnQgKGRlcHRoLWZpcnN0IHByZS1vcmRlciB0cmF2ZXJzYWwpCiAgICAgIHZhciBlbHRzID0gaW5Eb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHBhcnNlci5zZWxlY3RvcnMpOwogICAgICAvLyBmb3IgZWFjaCBwYXJzYWJsZSBub2RlIHR5cGUsIGNhbGwgdGhlIG1hcHBlZCBwYXJzaW5nIG1ldGhvZAogICAgICBmb3JFYWNoKGVsdHMsIGZ1bmN0aW9uKGUpIHsKICAgICAgICBwYXJzZXJbcGFyc2VyLm1hcFtlLmxvY2FsTmFtZV1dKGUpOwogICAgICB9KTsKICAgICAgLy8gdXBncmFkZSBhbGwgdXBncmFkZWFibGUgc3RhdGljIGVsZW1lbnRzLCBhbnl0aGluZyBkeW5hbWljYWxseQogICAgICAvLyBjcmVhdGVkIHNob3VsZCBiZSBjYXVnaHQgYnkgb2JzZXJ2ZXIKICAgICAgQ3VzdG9tRWxlbWVudHMudXBncmFkZURvY3VtZW50KGluRG9jdW1lbnQpOwogICAgICAvLyBvYnNlcnZlIGRvY3VtZW50IGZvciBkb20gY2hhbmdlcwogICAgICBDdXN0b21FbGVtZW50cy5vYnNlcnZlRG9jdW1lbnQoaW5Eb2N1bWVudCk7CiAgICB9CiAgfSwKICBwYXJzZUxpbms6IGZ1bmN0aW9uKGxpbmtFbHQpIHsKICAgIC8vIGltcG9ydHMKICAgIGlmIChpc0RvY3VtZW50TGluayhsaW5rRWx0KSkgewogICAgICB0aGlzLnBhcnNlSW1wb3J0KGxpbmtFbHQpOwogICAgfQogIH0sCiAgcGFyc2VJbXBvcnQ6IGZ1bmN0aW9uKGxpbmtFbHQpIHsKICAgIGlmIChsaW5rRWx0LmNvbnRlbnQpIHsKICAgICAgcGFyc2VyLnBhcnNlKGxpbmtFbHQuY29udGVudCk7CiAgICB9CiAgfQp9OwoKZnVuY3Rpb24gaXNEb2N1bWVudExpbmsoaW5FbHQpIHsKICByZXR1cm4gKGluRWx0LmxvY2FsTmFtZSA9PT0gJ2xpbmsnCiAgICAgICYmIGluRWx0LmdldEF0dHJpYnV0ZSgncmVsJykgPT09IElNUE9SVF9MSU5LX1RZUEUpOwp9Cgp2YXIgZm9yRWFjaCA9IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwuYmluZChBcnJheS5wcm90b3R5cGUuZm9yRWFjaCk7CgovLyBleHBvcnRzCgpDdXN0b21FbGVtZW50cy5wYXJzZXIgPSBwYXJzZXI7Cgp9KSgpOwovKgogKiBDb3B5cmlnaHQgMjAxMyBUaGUgUG9seW1lciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZQogKiBsaWNlbnNlIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUuCiAqLwooZnVuY3Rpb24oKXsKCi8vIGJvb3RzdHJhcCBwYXJzaW5nCmZ1bmN0aW9uIGJvb3RzdHJhcCgpIHsKICAvLyBwYXJzZSBkb2N1bWVudAogIEN1c3RvbUVsZW1lbnRzLnBhcnNlci5wYXJzZShkb2N1bWVudCk7CiAgLy8gb25lIG1vcmUgcGFzcyBiZWZvcmUgcmVnaXN0ZXIgaXMgJ2xpdmUnCiAgQ3VzdG9tRWxlbWVudHMudXBncmFkZURvY3VtZW50KGRvY3VtZW50KTsgIAogIC8vIGNob29zZSBhc3luYwogIHZhciBhc3luYyA9IHdpbmRvdy5QbGF0Zm9ybSAmJiBQbGF0Zm9ybS5lbmRPZk1pY3JvdGFzayA/IAogICAgUGxhdGZvcm0uZW5kT2ZNaWNyb3Rhc2sgOgogICAgc2V0VGltZW91dDsKICBhc3luYyhmdW5jdGlvbigpIHsKICAgIC8vIHNldCBpbnRlcm5hbCAncmVhZHknIGZsYWcsIG5vdyBkb2N1bWVudC5yZWdpc3RlciB3aWxsIHRyaWdnZXIgCiAgICAvLyBzeW5jaHJvbm91cyB1cGdyYWRlcwogICAgQ3VzdG9tRWxlbWVudHMucmVhZHkgPSB0cnVlOwogICAgLy8gY2FwdHVyZSBibHVudCBwcm9maWxpbmcgZGF0YQogICAgQ3VzdG9tRWxlbWVudHMucmVhZHlUaW1lID0gRGF0ZS5ub3coKTsKICAgIGlmICh3aW5kb3cuSFRNTEltcG9ydHMpIHsKICAgICAgQ3VzdG9tRWxlbWVudHMuZWxhcHNlZCA9IEN1c3RvbUVsZW1lbnRzLnJlYWR5VGltZSAtIEhUTUxJbXBvcnRzLnJlYWR5VGltZTsKICAgIH0KICAgIC8vIG5vdGlmeSB0aGUgc3lzdGVtIHRoYXQgd2UgYXJlIGJvb3RzdHJhcHBlZAogICAgZG9jdW1lbnQuYm9keS5kaXNwYXRjaEV2ZW50KAogICAgICBuZXcgQ3VzdG9tRXZlbnQoJ1dlYkNvbXBvbmVudHNSZWFkeScsIHtidWJibGVzOiB0cnVlfSkKICAgICk7CiAgfSk7Cn0KCi8vIEN1c3RvbUV2ZW50IHNoaW0gZm9yIElFCmlmICh0eXBlb2Ygd2luZG93LkN1c3RvbUV2ZW50ICE9PSAnZnVuY3Rpb24nKSB7CiAgd2luZG93LkN1c3RvbUV2ZW50ID0gZnVuY3Rpb24oaW5UeXBlKSB7CiAgICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnSFRNTEV2ZW50cycpOwogICAgIGUuaW5pdEV2ZW50KGluVHlwZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgcmV0dXJuIGU7CiAgfTsKfQoKaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHsKICBib290c3RyYXAoKTsKfSBlbHNlIHsKICB2YXIgbG9hZEV2ZW50ID0gd2luZG93LkhUTUxJbXBvcnRzID8gJ0hUTUxJbXBvcnRzTG9hZGVkJyA6ICdET01Db250ZW50TG9hZGVkJzsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihsb2FkRXZlbnQsIGJvb3RzdHJhcCk7Cn0KCn0pKCk7CgooZnVuY3Rpb24gKCkgewoKLyoqKiBWYXJpYWJsZXMgKioqLwoKICB2YXIgd2luID0gd2luZG93LAogICAgZG9jID0gZG9jdW1lbnQsCiAgICBub29wID0gZnVuY3Rpb24oKXt9LAogICAgdHJ1ZW9wID0gZnVuY3Rpb24oKXsgcmV0dXJuIHRydWU7IH0sCiAgICByZWdleFBzZXVkb1NwbGl0ID0gLyhbXHctXSsoPzpcKFteXCldK1wpKT8pL2csCiAgICByZWdleFBzZXVkb1JlcGxhY2UgPSAvKFx3KikoPzpcKChbXlwpXSopXCkpPy8sCiAgICByZWdleERpZ2l0cyA9IC8oXGQrKS9nLAogICAga2V5cHNldWRvID0gewogICAgICBhY3Rpb246IGZ1bmN0aW9uIChwc2V1ZG8sIGV2ZW50KSB7CiAgICAgICAgcmV0dXJuIHBzZXVkby52YWx1ZS5tYXRjaChyZWdleERpZ2l0cykuaW5kZXhPZihTdHJpbmcoZXZlbnQua2V5Q29kZSkpID4gLTEgPT0gKHBzZXVkby5uYW1lID09ICdrZXlwYXNzJykgfHwgbnVsbDsKICAgICAgfQogICAgfSwKICAgIHByZWZpeCA9IChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzdHlsZXMgPSB3aW4uZ2V0Q29tcHV0ZWRTdHlsZShkb2MuZG9jdW1lbnRFbGVtZW50LCAnJyksCiAgICAgICAgICBwcmUgPSAoQXJyYXkucHJvdG90eXBlLnNsaWNlCiAgICAgICAgICAgIC5jYWxsKHN0eWxlcykKICAgICAgICAgICAgLmpvaW4oJycpCiAgICAgICAgICAgIC5tYXRjaCgvLShtb3p8d2Via2l0fG1zKS0vKSB8fCAoc3R5bGVzLk9MaW5rID09PSAnJyAmJiBbJycsICdvJ10pCiAgICAgICAgICApWzFdOwogICAgICByZXR1cm4gewogICAgICAgIGRvbTogcHJlID09ICdtcycgPyAnTVMnIDogcHJlLAogICAgICAgIGxvd2VyY2FzZTogcHJlLAogICAgICAgIGNzczogJy0nICsgcHJlICsgJy0nLAogICAgICAgIGpzOiBwcmUgPT0gJ21zJyA/IHByZSA6IHByZVswXS50b1VwcGVyQ2FzZSgpICsgcHJlLnN1YnN0cigxKQogICAgICB9OwogICAgfSkoKSwKICAgIG1hdGNoU2VsZWN0b3IgPSBFbGVtZW50LnByb3RvdHlwZS5tYXRjaGVzU2VsZWN0b3IgfHwgRWxlbWVudC5wcm90b3R5cGVbcHJlZml4Lmxvd2VyY2FzZSArICdNYXRjaGVzU2VsZWN0b3InXSwKICAgIG11dGF0aW9uID0gd2luLk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luW3ByZWZpeC5qcyArICdNdXRhdGlvbk9ic2VydmVyJ107CgovKioqIEZ1bmN0aW9ucyAqKiovCgovLyBVdGlsaXRpZXMKCiAgdmFyIHR5cGVDYWNoZSA9IHt9LAogICAgICB0eXBlU3RyaW5nID0gdHlwZUNhY2hlLnRvU3RyaW5nLAogICAgICB0eXBlUmVnZXhwID0gL1xzKFthLXpBLVpdKykvOwogIGZ1bmN0aW9uIHR5cGVPZihvYmopIHsKICAgIHZhciB0eXBlID0gdHlwZVN0cmluZy5jYWxsKG9iaik7CiAgICByZXR1cm4gdHlwZUNhY2hlW3R5cGVdIHx8ICh0eXBlQ2FjaGVbdHlwZV0gPSB0eXBlLm1hdGNoKHR5cGVSZWdleHApWzFdLnRvTG93ZXJDYXNlKCkpOwogIH0KCiAgZnVuY3Rpb24gY2xvbmUoaXRlbSwgdHlwZSl7CiAgICB2YXIgZm4gPSBjbG9uZVt0eXBlIHx8IHR5cGVPZihpdGVtKV07CiAgICByZXR1cm4gZm4gPyBmbihpdGVtKSA6IGl0ZW07CiAgfQogICAgY2xvbmUub2JqZWN0ID0gZnVuY3Rpb24oc3JjKXsKICAgICAgdmFyIG9iaiA9IHt9OwogICAgICBmb3IgKHZhciBrZXkgaW4gc3JjKSBvYmpba2V5XSA9IGNsb25lKHNyY1trZXldKTsKICAgICAgcmV0dXJuIG9iajsKICAgIH07CiAgICBjbG9uZS5hcnJheSA9IGZ1bmN0aW9uKHNyYyl7CiAgICAgIHZhciBpID0gc3JjLmxlbmd0aCwgYXJyYXkgPSBuZXcgQXJyYXkoaSk7CiAgICAgIHdoaWxlIChpLS0pIGFycmF5W2ldID0gY2xvbmUoc3JjW2ldKTsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfTsKCiAgdmFyIHVuc2xpY2VhYmxlID0gWyd1bmRlZmluZWQnLCAnbnVsbCcsICdudW1iZXInLCAnYm9vbGVhbicsICdzdHJpbmcnLCAnZnVuY3Rpb24nXTsKICBmdW5jdGlvbiB0b0FycmF5KG9iail7CiAgICByZXR1cm4gdW5zbGljZWFibGUuaW5kZXhPZih0eXBlT2Yob2JqKSkgPT0gLTEgPwogICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwob2JqLCAwKSA6CiAgICBbb2JqXTsKICB9CgovLyBET00KICB2YXIgc3RyID0gJyc7CiAgZnVuY3Rpb24gcXVlcnkoZWxlbWVudCwgc2VsZWN0b3IpewogICAgcmV0dXJuIChzZWxlY3RvciB8fCBzdHIpLmxlbmd0aCA/IHRvQXJyYXkoZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSkgOiBbXTsKICB9CgogIGZ1bmN0aW9uIHBhcnNlTXV0YXRpb25zKGVsZW1lbnQsIG11dGF0aW9ucykgewogICAgdmFyIGRpZmYgPSB7IGFkZGVkOiBbXSwgcmVtb3ZlZDogW10gfTsKICAgIG11dGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHJlY29yZCl7CiAgICAgIHJlY29yZC5fbXV0YXRpb24gPSB0cnVlOwogICAgICBmb3IgKHZhciB6IGluIGRpZmYpIHsKICAgICAgICB2YXIgdHlwZSA9IGVsZW1lbnQuX3JlY29yZHNbKHogPT0gJ2FkZGVkJykgPyAnaW5zZXJ0ZWQnIDogJ3JlbW92ZWQnXSwKICAgICAgICAgIG5vZGVzID0gcmVjb3JkW3ogKyAnTm9kZXMnXSwgbGVuZ3RoID0gbm9kZXMubGVuZ3RoOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoICYmIGRpZmZbel0uaW5kZXhPZihub2Rlc1tpXSkgPT0gLTE7IGkrKyl7CiAgICAgICAgICBkaWZmW3pdLnB1c2gobm9kZXNbaV0pOwogICAgICAgICAgdHlwZS5mb3JFYWNoKGZ1bmN0aW9uKGZuKXsKICAgICAgICAgICAgZm4obm9kZXNbaV0sIHJlY29yZCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KCi8vIE1peGlucwoKICBmdW5jdGlvbiBtZXJnZU9uZShzb3VyY2UsIGtleSwgY3VycmVudCl7CiAgICB2YXIgdHlwZSA9IHR5cGVPZihjdXJyZW50KTsKICAgIGlmICh0eXBlID09ICdvYmplY3QnICYmIHR5cGVPZihzb3VyY2Vba2V5XSkgPT0gJ29iamVjdCcpIHh0YWcubWVyZ2Uoc291cmNlW2tleV0sIGN1cnJlbnQpOwogICAgZWxzZSBzb3VyY2Vba2V5XSA9IGNsb25lKGN1cnJlbnQsIHR5cGUpOwogICAgcmV0dXJuIHNvdXJjZTsKICB9CgogIGZ1bmN0aW9uIG1lcmdlTWl4aW4odHlwZSwgbWl4aW4sIG9wdGlvbikgewogICAgdmFyIG9yaWdpbmFsID0ge307CiAgICBmb3IgKHZhciBvIGluIG9wdGlvbikgb3JpZ2luYWxbby5zcGxpdCgnOicpWzBdXSA9IHRydWU7CiAgICBmb3IgKHZhciB4IGluIG1peGluKSBpZiAoIW9yaWdpbmFsW3guc3BsaXQoJzonKVswXV0pIG9wdGlvblt4XSA9IG1peGluW3hdOwogIH0KCiAgZnVuY3Rpb24gYXBwbHlNaXhpbnModGFnKSB7CiAgICB0YWcubWl4aW5zLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgdmFyIG1peGluID0geHRhZy5taXhpbnNbbmFtZV07CiAgICAgIGZvciAodmFyIHR5cGUgaW4gbWl4aW4pIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgIGNhc2UgJ2xpZmVjeWNsZSc6IGNhc2UgJ21ldGhvZHMnOgogICAgICAgICAgICBtZXJnZU1peGluKHR5cGUsIG1peGluW3R5cGVdLCB0YWdbdHlwZV0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2FjY2Vzc29ycyc6IGNhc2UgJ3Byb3RvdHlwZSc6CiAgICAgICAgICAgIGZvciAodmFyIHogaW4gbWl4aW5bdHlwZV0pIG1lcmdlTWl4aW4oeiwgbWl4aW5bdHlwZV0sIHRhZy5hY2Nlc3NvcnMpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2V2ZW50cyc6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gdGFnOwogIH0KCi8vIEV2ZW50cwoKICBmdW5jdGlvbiBkZWxlZ2F0ZUFjdGlvbihwc2V1ZG8sIGV2ZW50KSB7CiAgICB2YXIgdGFyZ2V0ID0gcXVlcnkodGhpcywgcHNldWRvLnZhbHVlKS5maWx0ZXIoZnVuY3Rpb24obm9kZSl7CiAgICAgIHJldHVybiBub2RlID09IGV2ZW50LnRhcmdldCB8fCBub2RlLmNvbnRhaW5zID8gbm9kZS5jb250YWlucyhldmVudC50YXJnZXQpIDogbnVsbDsKICAgIH0pWzBdOwogICAgcmV0dXJuIHRhcmdldCA/IHBzZXVkby5saXN0ZW5lciA9IHBzZXVkby5saXN0ZW5lci5iaW5kKHRhcmdldCkgOiBudWxsOwogIH0KCiAgZnVuY3Rpb24gdG91Y2hGaWx0ZXIoZXZlbnQpIHsKICAgIGlmIChldmVudC50eXBlLm1hdGNoKCd0b3VjaCcpKXsKICAgICAgZXZlbnQudGFyZ2V0Ll9fdG91Y2hlZF9fID0gdHJ1ZTsKICAgIH0KICAgIGVsc2UgaWYgKGV2ZW50LnRhcmdldC5fX3RvdWNoZWRfXyAmJiBldmVudC50eXBlLm1hdGNoKCdtb3VzZScpKXsKICAgICAgZGVsZXRlIGV2ZW50LnRhcmdldC5fX3RvdWNoZWRfXzsKICAgICAgcmV0dXJuOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVGbG93RXZlbnQodHlwZSkgewogICAgdmFyIGZsb3cgPSB0eXBlID09ICdvdmVyJzsKICAgIHJldHVybiB7CiAgICAgIGF0dGFjaDogJ092ZXJmbG93RXZlbnQnIGluIHdpbiA/ICdvdmVyZmxvd2NoYW5nZWQnIDogW10sCiAgICAgIGNvbmRpdGlvbjogZnVuY3Rpb24gKGV2ZW50LCBjdXN0b20pIHsKICAgICAgICBldmVudC5mbG93ID0gdHlwZTsKICAgICAgICByZXR1cm4gZXZlbnQudHlwZSA9PSAodHlwZSArICdmbG93JykgfHwKICAgICAgICAoKGV2ZW50Lm9yaWVudCA9PT0gMCAmJiBldmVudC5ob3Jpem9udGFsT3ZlcmZsb3cgPT0gZmxvdykgfHwKICAgICAgICAoZXZlbnQub3JpZW50ID09IDEgJiYgZXZlbnQudmVydGljYWxPdmVyZmxvdyA9PSBmbG93KSB8fAogICAgICAgIChldmVudC5vcmllbnQgPT0gMiAmJiBldmVudC5ob3Jpem9udGFsT3ZlcmZsb3cgPT0gZmxvdyAmJiBldmVudC52ZXJ0aWNhbE92ZXJmbG93ID09IGZsb3cpKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIHdyaXRlUHJvcGVydHkoa2V5LCBldmVudCwgYmFzZSwgZGVzYyl7CiAgICBpZiAoZGVzYykgZXZlbnRba2V5XSA9IGJhc2Vba2V5XTsKICAgIGVsc2UgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV2ZW50LCBrZXksIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBiYXNlW2tleV0KICAgIH0pOwogIH0KCiAgdmFyIHNraXBQcm9wcyA9IHt9OwogIGZvciAodmFyIHogaW4gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0N1c3RvbUV2ZW50JykpIHNraXBQcm9wc1t6XSA9IDE7CiAgZnVuY3Rpb24gaW5oZXJpdEV2ZW50KGV2ZW50LCBiYXNlKXsKICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihldmVudCwgJ3RhcmdldCcpOwogICAgZm9yICh2YXIgeiBpbiBiYXNlKSB7CiAgICAgIGlmICghc2tpcFByb3BzW3pdKSB3cml0ZVByb3BlcnR5KHosIGV2ZW50LCBiYXNlLCBkZXNjKTsKICAgIH0KICAgIGV2ZW50LmJhc2VFdmVudCA9IGJhc2U7CiAgfQoKLy8gQWNjZXNzb3JzCgogIGZ1bmN0aW9uIGdldEFyZ3MoYXR0ciwgdmFsdWUpewogICAgcmV0dXJuIHsKICAgICAgdmFsdWU6IGF0dHIuYm9vbGVhbiA/ICcnIDogdmFsdWUsCiAgICAgIG1ldGhvZDogYXR0ci5ib29sZWFuICYmICF2YWx1ZSA/ICdyZW1vdmVBdHRyaWJ1dGUnIDogJ3NldEF0dHJpYnV0ZScKICAgIH07CiAgfQoKICBmdW5jdGlvbiBtb2RBdHRyKGVsZW1lbnQsIGF0dHIsIG5hbWUsIHZhbHVlKXsKICAgIHZhciBhcmdzID0gZ2V0QXJncyhhdHRyLCB2YWx1ZSk7CiAgICBlbGVtZW50W2FyZ3MubWV0aG9kXShuYW1lLCBhcmdzLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHN5bmNBdHRyKGVsZW1lbnQsIGF0dHIsIG5hbWUsIHZhbHVlLCBtZXRob2QpewogICAgdmFyIG5vZGVzID0gYXR0ci5wcm9wZXJ0eSA/IFtlbGVtZW50Lnh0YWdbYXR0ci5wcm9wZXJ0eV1dIDogYXR0ci5zZWxlY3RvciA/IHh0YWcucXVlcnkoZWxlbWVudCwgYXR0ci5zZWxlY3RvcikgOiBbXSwKICAgICAgICBpbmRleCA9IG5vZGVzLmxlbmd0aDsKICAgIHdoaWxlIChpbmRleC0tKSBub2Rlc1tpbmRleF1bbWV0aG9kXShuYW1lLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVWaWV3KGVsZW1lbnQsIG5hbWUsIHZhbHVlKXsKICAgIGlmIChlbGVtZW50Ll9fdmlld19fKXsKICAgICAgZWxlbWVudC5fX3ZpZXdfXy51cGRhdGVCaW5kaW5nVmFsdWUoZWxlbWVudCwgbmFtZSwgdmFsdWUpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYXR0YWNoUHJvcGVydGllcyh0YWcsIHByb3AsIHosIGFjY2Vzc29yLCBhdHRyLCBuYW1lKXsKICAgIHZhciBrZXkgPSB6LnNwbGl0KCc6JyksIHR5cGUgPSBrZXlbMF07CiAgICBpZiAodHlwZSA9PSAnZ2V0JykgewogICAgICBrZXlbMF0gPSBwcm9wOwogICAgICB0YWcucHJvdG90eXBlW3Byb3BdLmdldCA9IHh0YWcuYXBwbHlQc2V1ZG9zKGtleS5qb2luKCc6JyksIGFjY2Vzc29yW3pdLCB0YWcucHNldWRvcyk7CiAgICB9CiAgICBlbHNlIGlmICh0eXBlID09ICdzZXQnKSB7CiAgICAgIGtleVswXSA9IHByb3A7CiAgICAgIHZhciBzZXR0ZXIgPSB0YWcucHJvdG90eXBlW3Byb3BdLnNldCA9IHh0YWcuYXBwbHlQc2V1ZG9zKGtleS5qb2luKCc6JyksIGF0dHIgPyBmdW5jdGlvbih2YWx1ZSl7CiAgICAgICAgdGhpcy54dGFnLl9za2lwU2V0ID0gdHJ1ZTsKICAgICAgICBpZiAoIXRoaXMueHRhZy5fc2tpcEF0dHIpIG1vZEF0dHIodGhpcywgYXR0ciwgbmFtZSwgdmFsdWUpOwogICAgICAgIGlmICh0aGlzLnh0YWcuX3NraXBBdHRyICYmIGF0dHIuc2tpcCkgZGVsZXRlIHRoaXMueHRhZy5fc2tpcEF0dHI7CiAgICAgICAgYWNjZXNzb3Jbel0uY2FsbCh0aGlzLCBhdHRyLmJvb2xlYW4gPyAhIXZhbHVlIDogdmFsdWUpOwogICAgICAgIHVwZGF0ZVZpZXcodGhpcywgbmFtZSwgdmFsdWUpOwogICAgICAgIGRlbGV0ZSB0aGlzLnh0YWcuX3NraXBTZXQ7CiAgICAgIH0gOiBhY2Nlc3Nvclt6XSA/IGZ1bmN0aW9uKHZhbHVlKXsKICAgICAgICBhY2Nlc3Nvclt6XS5jYWxsKHRoaXMsIHZhbHVlKTsKICAgICAgICB1cGRhdGVWaWV3KHRoaXMsIG5hbWUsIHZhbHVlKTsKICAgICAgfSA6IG51bGwsIHRhZy5wc2V1ZG9zKTsKCiAgICAgIGlmIChhdHRyKSBhdHRyLnNldHRlciA9IHNldHRlcjsKICAgIH0KICAgIGVsc2UgdGFnLnByb3RvdHlwZVtwcm9wXVt6XSA9IGFjY2Vzc29yW3pdOwogIH0KCiAgZnVuY3Rpb24gcGFyc2VBY2Nlc3Nvcih0YWcsIHByb3ApewogICAgdGFnLnByb3RvdHlwZVtwcm9wXSA9IHt9OwogICAgdmFyIGFjY2Vzc29yID0gdGFnLmFjY2Vzc29yc1twcm9wXSwKICAgICAgICBhdHRyID0gYWNjZXNzb3IuYXR0cmlidXRlLAogICAgICAgIG5hbWUgPSBhdHRyICYmIGF0dHIubmFtZSA/IGF0dHIubmFtZS50b0xvd2VyQ2FzZSgpIDogcHJvcDsKCiAgICBpZiAoYXR0cikgewogICAgICBhdHRyLmtleSA9IHByb3A7CiAgICAgIHRhZy5hdHRyaWJ1dGVzW25hbWVdID0gYXR0cjsKICAgIH0KCiAgICBmb3IgKHZhciB6IGluIGFjY2Vzc29yKSBhdHRhY2hQcm9wZXJ0aWVzKHRhZywgcHJvcCwgeiwgYWNjZXNzb3IsIGF0dHIsIG5hbWUpOwoKICAgIGlmIChhdHRyKSB7CiAgICAgIGlmICghdGFnLnByb3RvdHlwZVtwcm9wXS5nZXQpIHsKICAgICAgICB2YXIgbWV0aG9kID0gKGF0dHIuYm9vbGVhbiA/ICdoYXMnIDogJ2dldCcpICsgJ0F0dHJpYnV0ZSc7CiAgICAgICAgdGFnLnByb3RvdHlwZVtwcm9wXS5nZXQgPSBmdW5jdGlvbigpewogICAgICAgICAgcmV0dXJuIHRoaXNbbWV0aG9kXShuYW1lKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGlmICghdGFnLnByb3RvdHlwZVtwcm9wXS5zZXQpIHRhZy5wcm90b3R5cGVbcHJvcF0uc2V0ID0gZnVuY3Rpb24odmFsdWUpewogICAgICAgIG1vZEF0dHIodGhpcywgYXR0ciwgbmFtZSwgdmFsdWUpOwogICAgICAgIHVwZGF0ZVZpZXcodGhpcywgbmFtZSwgdmFsdWUpOwogICAgICB9OwogICAgfQogIH0KCi8qKiogWC1UYWcgT2JqZWN0IERlZmluaXRpb24gKioqLwoKICB2YXIgeHRhZyA9IHsKICAgIHRhZ3M6IHt9LAogICAgZGVmYXVsdE9wdGlvbnM6IHsKICAgICAgcHNldWRvczogW10sCiAgICAgIG1peGluczogW10sCiAgICAgIGV2ZW50czoge30sCiAgICAgIG1ldGhvZHM6IHt9LAogICAgICBhY2Nlc3NvcnM6IHt9LAogICAgICBsaWZlY3ljbGU6IHt9LAogICAgICBhdHRyaWJ1dGVzOiB7fSwKICAgICAgJ3Byb3RvdHlwZSc6IHsKICAgICAgICB4dGFnOiB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9feHRhZ19fID8gdGhpcy5fX3h0YWdfXyA6ICh0aGlzLl9feHRhZ19fID0geyBkYXRhOiB7fSB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICByZWdpc3RlcjogZnVuY3Rpb24gKG5hbWUsIG9wdGlvbnMpIHsKICAgICAgdmFyIF9uYW1lOwogICAgICBpZiAodHlwZW9mIG5hbWUgPT0gJ3N0cmluZycpIHsKICAgICAgICBfbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIHNhdmUgcHJvdG90eXBlIGZvciBhY3R1YWwgb2JqZWN0IGNyZWF0aW9uIGJlbG93CiAgICAgIHZhciBiYXNlUHJvdG90eXBlID0gb3B0aW9ucy5wcm90b3R5cGU7CiAgICAgIGRlbGV0ZSBvcHRpb25zLnByb3RvdHlwZTsKCiAgICAgIHZhciB0YWcgPSB4dGFnLnRhZ3NbX25hbWVdID0gYXBwbHlNaXhpbnMoeHRhZy5tZXJnZSh7fSwgeHRhZy5kZWZhdWx0T3B0aW9ucywgb3B0aW9ucykpOwoKICAgICAgZm9yICh2YXIgeiBpbiB0YWcuZXZlbnRzKSB0YWcuZXZlbnRzW3pdID0geHRhZy5wYXJzZUV2ZW50KHosIHRhZy5ldmVudHNbel0pOwogICAgICBmb3IgKHogaW4gdGFnLmxpZmVjeWNsZSkgdGFnLmxpZmVjeWNsZVt6LnNwbGl0KCc6JylbMF1dID0geHRhZy5hcHBseVBzZXVkb3MoeiwgdGFnLmxpZmVjeWNsZVt6XSwgdGFnLnBzZXVkb3MpOwogICAgICBmb3IgKHogaW4gdGFnLm1ldGhvZHMpIHRhZy5wcm90b3R5cGVbei5zcGxpdCgnOicpWzBdXSA9IHsgdmFsdWU6IHh0YWcuYXBwbHlQc2V1ZG9zKHosIHRhZy5tZXRob2RzW3pdLCB0YWcucHNldWRvcyksIGVudW1lcmFibGU6IHRydWUgfTsKICAgICAgZm9yICh6IGluIHRhZy5hY2Nlc3NvcnMpIHBhcnNlQWNjZXNzb3IodGFnLCB6KTsKCiAgICAgIHZhciByZWFkeSA9IHRhZy5saWZlY3ljbGUuY3JlYXRlZCB8fCB0YWcubGlmZWN5Y2xlLnJlYWR5OwogICAgICB0YWcucHJvdG90eXBlLmNyZWF0ZWRDYWxsYmFjayA9IHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpewogICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzOwogICAgICAgICAgeHRhZy5hZGRFdmVudHModGhpcywgdGFnLmV2ZW50cyk7CiAgICAgICAgICB0YWcubWl4aW5zLmZvckVhY2goZnVuY3Rpb24obWl4aW4pewogICAgICAgICAgICBpZiAoeHRhZy5taXhpbnNbbWl4aW5dLmV2ZW50cykgeHRhZy5hZGRFdmVudHMoZWxlbWVudCwgeHRhZy5taXhpbnNbbWl4aW5dLmV2ZW50cyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvdXRwdXQgPSByZWFkeSA/IHJlYWR5LmFwcGx5KHRoaXMsIHRvQXJyYXkoYXJndW1lbnRzKSkgOiBudWxsOwogICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiB0YWcuYXR0cmlidXRlcykgewogICAgICAgICAgICB2YXIgYXR0ciA9IHRhZy5hdHRyaWJ1dGVzW25hbWVdLAogICAgICAgICAgICAgICAgaGFzQXR0ciA9IHRoaXMuaGFzQXR0cmlidXRlKG5hbWUpOwogICAgICAgICAgICBpZiAoaGFzQXR0ciB8fCBhdHRyLmJvb2xlYW4pIHsKICAgICAgICAgICAgICB0aGlzW2F0dHIua2V5XSA9IGF0dHIuYm9vbGVhbiA/IGhhc0F0dHIgOiB0aGlzLmdldEF0dHJpYnV0ZShuYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGFnLnBzZXVkb3MuZm9yRWFjaChmdW5jdGlvbihvYmopewogICAgICAgICAgICBvYmoub25BZGQuY2FsbChlbGVtZW50LCBvYmopOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmICh0YWcubGlmZWN5Y2xlLmluc2VydGVkKSB0YWcucHJvdG90eXBlLmVudGVyZWRWaWV3Q2FsbGJhY2sgPSB7IHZhbHVlOiB0YWcubGlmZWN5Y2xlLmluc2VydGVkLCBlbnVtZXJhYmxlOiB0cnVlIH07CiAgICAgIGlmICh0YWcubGlmZWN5Y2xlLnJlbW92ZWQpIHRhZy5wcm90b3R5cGUubGVmdERvY3VtZW50Q2FsbGJhY2sgPSB7IHZhbHVlOiB0YWcubGlmZWN5Y2xlLnJlbW92ZWQsIGVudW1lcmFibGU6IHRydWUgfTsKICAgICAgaWYgKHRhZy5saWZlY3ljbGUuYXR0cmlidXRlQ2hhbmdlZCkgdGFnLnByb3RvdHlwZS5hdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2sgPSB7IHZhbHVlOiB0YWcubGlmZWN5Y2xlLmF0dHJpYnV0ZUNoYW5nZWQsIGVudW1lcmFibGU6IHRydWUgfTsKCiAgICAgIHZhciBzZXRBdHRyaWJ1dGUgPSB0YWcucHJvdG90eXBlLnNldEF0dHJpYnV0ZSB8fCBIVE1MRWxlbWVudC5wcm90b3R5cGUuc2V0QXR0cmlidXRlOwogICAgICB0YWcucHJvdG90eXBlLnNldEF0dHJpYnV0ZSA9IHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICBlbnVtYmVyYWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKXsKICAgICAgICAgIHZhciBhdHRyID0gdGFnLmF0dHJpYnV0ZXNbbmFtZS50b0xvd2VyQ2FzZSgpXTsKICAgICAgICAgIGlmICghdGhpcy54dGFnLl9za2lwQXR0cikgc2V0QXR0cmlidXRlLmNhbGwodGhpcywgbmFtZSwgYXR0ciAmJiBhdHRyLmJvb2xlYW4gPyAnJyA6IHZhbHVlKTsKICAgICAgICAgIGlmIChhdHRyKSB7CiAgICAgICAgICAgIGlmIChhdHRyLnNldHRlciAmJiAhdGhpcy54dGFnLl9za2lwU2V0KSB7CiAgICAgICAgICAgICAgdGhpcy54dGFnLl9za2lwQXR0ciA9IHRydWU7CiAgICAgICAgICAgICAgYXR0ci5zZXR0ZXIuY2FsbCh0aGlzLCBhdHRyLmJvb2xlYW4gPyB0cnVlIDogdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhbHVlID0gYXR0ci5za2lwID8gYXR0ci5ib29sZWFuID8gdGhpcy5oYXNBdHRyaWJ1dGUobmFtZSkgOiB0aGlzLmdldEF0dHJpYnV0ZShuYW1lKSA6IHZhbHVlOwogICAgICAgICAgICBzeW5jQXR0cih0aGlzLCBhdHRyLCBuYW1lLCBhdHRyLmJvb2xlYW4gPyAnJyA6IHZhbHVlLCAnc2V0QXR0cmlidXRlJyk7CiAgICAgICAgICB9CiAgICAgICAgICBkZWxldGUgdGhpcy54dGFnLl9za2lwQXR0cjsKICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgcmVtb3ZlQXR0cmlidXRlID0gdGFnLnByb3RvdHlwZS5yZW1vdmVBdHRyaWJ1dGUgfHwgSFRNTEVsZW1lbnQucHJvdG90eXBlLnJlbW92ZUF0dHJpYnV0ZTsKICAgICAgdGFnLnByb3RvdHlwZS5yZW1vdmVBdHRyaWJ1dGUgPSB7CiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgZW51bWJlcmFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChuYW1lKXsKICAgICAgICAgIHZhciBhdHRyID0gdGFnLmF0dHJpYnV0ZXNbbmFtZS50b0xvd2VyQ2FzZSgpXTsKICAgICAgICAgIGlmICghdGhpcy54dGFnLl9za2lwQXR0cikgcmVtb3ZlQXR0cmlidXRlLmNhbGwodGhpcywgbmFtZSk7CiAgICAgICAgICBpZiAoYXR0cikgewogICAgICAgICAgICBpZiAoYXR0ci5zZXR0ZXIgJiYgIXRoaXMueHRhZy5fc2tpcFNldCkgewogICAgICAgICAgICAgIHRoaXMueHRhZy5fc2tpcEF0dHIgPSB0cnVlOwogICAgICAgICAgICAgIGF0dHIuc2V0dGVyLmNhbGwodGhpcywgYXR0ci5ib29sZWFuID8gZmFsc2UgOiB1bmRlZmluZWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN5bmNBdHRyKHRoaXMsIGF0dHIsIG5hbWUsIHVuZGVmaW5lZCwgJ3JlbW92ZUF0dHJpYnV0ZScpOwogICAgICAgICAgfQogICAgICAgICAgZGVsZXRlIHRoaXMueHRhZy5fc2tpcEF0dHI7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIGVsZW1lbnRQcm90byA9IGJhc2VQcm90b3R5cGUgPwogICAgICAgIGJhc2VQcm90b3R5cGUgOgogICAgICAgICAgb3B0aW9uc1snZXh0ZW5kcyddID8KICAgICAgICAgICAgT2JqZWN0LmNyZWF0ZShkb2MuY3JlYXRlRWxlbWVudChvcHRpb25zWydleHRlbmRzJ10pCiAgICAgICAgICAgICAgLmNvbnN0cnVjdG9yKS5wcm90b3R5cGUgOgogICAgICAgICAgd2luLkhUTUxFbGVtZW50LnByb3RvdHlwZTsKCiAgICAgIHJldHVybiBkb2MucmVnaXN0ZXIoX25hbWUsIHsKICAgICAgICAnZXh0ZW5kcyc6IG9wdGlvbnNbJ2V4dGVuZHMnXSwKICAgICAgICAncHJvdG90eXBlJzogT2JqZWN0LmNyZWF0ZShlbGVtZW50UHJvdG8sIHRhZy5wcm90b3R5cGUpCiAgICAgIH0pOwoKICAgIH0sCgogICAgLyogRXhwb3NlZCBWYXJpYWJsZXMgKi8KCiAgICBtaXhpbnM6IHt9LAogICAgcHJlZml4OiBwcmVmaXgsCiAgICB0b3VjaGVzOiB7CiAgICAgIGFjdGl2ZTogW10sCiAgICAgIGNoYW5nZWQ6IFtdCiAgICB9LAogICAgY2FwdHVyZUV2ZW50czogWydmb2N1cycsICdibHVyJywgJ3Njcm9sbCcsICd1bmRlcmZsb3cnLCAnb3ZlcmZsb3cnLCAnb3ZlcmZsb3djaGFuZ2VkJ10sCiAgICBjdXN0b21FdmVudHM6IHsKICAgICAgb3ZlcmZsb3c6IGNyZWF0ZUZsb3dFdmVudCgnb3ZlcicpLAogICAgICB1bmRlcmZsb3c6IGNyZWF0ZUZsb3dFdmVudCgndW5kZXInKSwKICAgICAgYW5pbWF0aW9uc3RhcnQ6IHsKICAgICAgICBhdHRhY2g6IFtwcmVmaXguZG9tICsgJ0FuaW1hdGlvblN0YXJ0J10KICAgICAgfSwKICAgICAgYW5pbWF0aW9uZW5kOiB7CiAgICAgICAgYXR0YWNoOiBbcHJlZml4LmRvbSArICdBbmltYXRpb25FbmQnXQogICAgICB9LAogICAgICB0cmFuc2l0aW9uZW5kOiB7CiAgICAgICAgYXR0YWNoOiBbcHJlZml4LmRvbSArICdUcmFuc2l0aW9uRW5kJ10KICAgICAgfSwKICAgICAgbW92ZTogewogICAgICAgIGF0dGFjaDogWydtb3VzZW1vdmUnLCAndG91Y2htb3ZlJ10sCiAgICAgICAgY29uZGl0aW9uOiB0b3VjaEZpbHRlcgogICAgICB9LAogICAgICBlbnRlcjogewogICAgICAgIGF0dGFjaDogWydtb3VzZW92ZXInLCAndG91Y2hlbnRlciddLAogICAgICAgIGNvbmRpdGlvbjogdG91Y2hGaWx0ZXIKICAgICAgfSwKICAgICAgbGVhdmU6IHsKICAgICAgICBhdHRhY2g6IFsnbW91c2VvdXQnLCAndG91Y2hsZWF2ZSddLAogICAgICAgIGNvbmRpdGlvbjogdG91Y2hGaWx0ZXIKICAgICAgfSwKICAgICAgdGFwc3RhcnQ6IHsKICAgICAgICBvYnNlcnZlOiB7CiAgICAgICAgICBtb3VzZWRvd246IGRvYywKICAgICAgICAgIHRvdWNoc3RhcnQ6IGRvYwogICAgICAgIH0sCiAgICAgICAgY29uZGl0aW9uOiB0b3VjaEZpbHRlcgogICAgICB9LAogICAgICB0YXBlbmQ6IHsKICAgICAgICBvYnNlcnZlOiB7CiAgICAgICAgICBtb3VzZXVwOiBkb2MsCiAgICAgICAgICB0b3VjaGVuZDogZG9jCiAgICAgICAgfSwKICAgICAgICBjb25kaXRpb246IHRvdWNoRmlsdGVyCiAgICAgIH0sCiAgICAgIHRhcG1vdmU6IHsKICAgICAgICBhdHRhY2g6IFsndGFwc3RhcnQnLCAnZHJhZ2VuZCcsICd0b3VjaGNhbmNlbCddLAogICAgICAgIGNvbmRpdGlvbjogZnVuY3Rpb24oZXZlbnQsIGN1c3RvbSl7CiAgICAgICAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnbW92ZSc6ICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgY2FzZSAnZHJhZ292ZXInOgogICAgICAgICAgICAgIHZhciBsYXN0ID0gY3VzdG9tLmxhc3REcmFnIHx8IHt9OwogICAgICAgICAgICAgIGN1c3RvbS5sYXN0RHJhZyA9IGV2ZW50OwogICAgICAgICAgICAgIHJldHVybiAobGFzdC5wYWdlWCAhPSBldmVudC5wYWdlWCAmJiBsYXN0LnBhZ2VZICE9IGV2ZW50LnBhZ2VZKSB8fCBudWxsOwogICAgICAgICAgICBjYXNlICd0YXBzdGFydCc6CiAgICAgICAgICAgICAgY3VzdG9tLnRvdWNoZXMgPSBjdXN0b20udG91Y2hlcyB8fCAxOwogICAgICAgICAgICAgIGlmICghY3VzdG9tLm1vdmUpIHsKICAgICAgICAgICAgICAgIGN1c3RvbS5jdXJyZW50ID0gdGhpczsKICAgICAgICAgICAgICAgIGN1c3RvbS5tb3ZlID0geHRhZy5hZGRFdmVudHModGhpcywgewogICAgICAgICAgICAgICAgICBtb3ZlOiBjdXN0b20ubGlzdGVuZXIsCiAgICAgICAgICAgICAgICAgIGRyYWdvdmVyOiBjdXN0b20ubGlzdGVuZXIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY3VzdG9tLnRhcGVuZCA9IHh0YWcuYWRkRXZlbnQoZG9jLCAndGFwZW5kJywgY3VzdG9tLmxpc3RlbmVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3RhcGVuZCc6IGNhc2UgJ2RyYWdlbmQnOiBjYXNlICd0b3VjaGNhbmNlbCc6CiAgICAgICAgICAgICAgY3VzdG9tLnRvdWNoZXMtLTsKICAgICAgICAgICAgICBpZiAoIWN1c3RvbS50b3VjaGVzKSB7CiAgICAgICAgICAgICAgICB4dGFnLnJlbW92ZUV2ZW50cyhjdXN0b20uY3VycmVudCAsIGN1c3RvbS5tb3ZlIHx8IHt9KTsKICAgICAgICAgICAgICAgIHh0YWcucmVtb3ZlRXZlbnQoZG9jLCBjdXN0b20udGFwZW5kIHx8IHt9KTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBjdXN0b20ubGFzdERyYWc7CiAgICAgICAgICAgICAgICBkZWxldGUgY3VzdG9tLmN1cnJlbnQ7CiAgICAgICAgICAgICAgICBkZWxldGUgY3VzdG9tLnRhcGVuZDsKICAgICAgICAgICAgICAgIGRlbGV0ZSBjdXN0b20ubW92ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgcHNldWRvczogewogICAgICBrZXlwYXNzOiBrZXlwc2V1ZG8sCiAgICAgIGtleWZhaWw6IGtleXBzZXVkbywKICAgICAgZGVsZWdhdGU6IHsgYWN0aW9uOiBkZWxlZ2F0ZUFjdGlvbiB9LAogICAgICB3aXRoaW46IHsKICAgICAgICBhY3Rpb246IGRlbGVnYXRlQWN0aW9uLAogICAgICAgIG9uQWRkOiBmdW5jdGlvbihwc2V1ZG8pewogICAgICAgICAgdmFyIGNvbmRpdGlvbiA9IHBzZXVkby5zb3VyY2UuY29uZGl0aW9uOwogICAgICAgICAgaWYgKGNvbmRpdGlvbikgcHNldWRvLnNvdXJjZS5jb25kaXRpb24gPSBmdW5jdGlvbihldmVudCwgY3VzdG9tKXsKICAgICAgICAgICAgcmV0dXJuIHh0YWcucXVlcnkodGhpcywgcHNldWRvLnZhbHVlKS5maWx0ZXIoZnVuY3Rpb24obm9kZSl7CiAgICAgICAgICAgICAgcmV0dXJuIG5vZGUgPT0gZXZlbnQudGFyZ2V0IHx8IG5vZGUuY29udGFpbnMgPyBub2RlLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgOiBudWxsOwogICAgICAgICAgICB9KVswXSA/IGNvbmRpdGlvbi5jYWxsKHRoaXMsIGV2ZW50LCBjdXN0b20pIDogbnVsbDsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBwcmV2ZW50YWJsZTogewogICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKHBzZXVkbywgZXZlbnQpIHsKICAgICAgICAgIHJldHVybiAhZXZlbnQuZGVmYXVsdFByZXZlbnRlZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyogVVRJTElUSUVTICovCgogICAgY2xvbmU6IGNsb25lLAogICAgdHlwZU9mOiB0eXBlT2YsCiAgICB0b0FycmF5OiB0b0FycmF5LAoKICAgIHdyYXA6IGZ1bmN0aW9uIChvcmlnaW5hbCwgZm4pIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCl7CiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyksCiAgICAgICAgICByZXR1cm5lZCA9IG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICAgIHJldHVybiByZXR1cm5lZCA9PT0gZmFsc2UgPyBmYWxzZSA6IGZuLmFwcGx5KHRoaXMsIHR5cGVvZiByZXR1cm5lZCAhPSAndW5kZWZpbmVkJyA/IHRvQXJyYXkocmV0dXJuZWQpIDogYXJncyk7CiAgICAgIH07CiAgICB9LAoKICAgIG1lcmdlOiBmdW5jdGlvbihzb3VyY2UsIGssIHYpewogICAgICBpZiAodHlwZU9mKGspID09ICdzdHJpbmcnKSByZXR1cm4gbWVyZ2VPbmUoc291cmNlLCBrLCB2KTsKICAgICAgZm9yICh2YXIgaSA9IDEsIGwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKXsKICAgICAgICB2YXIgb2JqZWN0ID0gYXJndW1lbnRzW2ldOwogICAgICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIG1lcmdlT25lKHNvdXJjZSwga2V5LCBvYmplY3Rba2V5XSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHNvdXJjZTsKICAgIH0sCgogICAgdWlkOiBmdW5jdGlvbigpewogICAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsMTApOwogICAgfSwKCiAgICAvKiBET00gKi8KCiAgICBxdWVyeTogcXVlcnksCgogICAgc2tpcFRyYW5zaXRpb246IGZ1bmN0aW9uKGVsZW1lbnQsIGZuLCBiaW5kKXsKICAgICAgdmFyIHByb3AgPSBwcmVmaXguanMgKyAnVHJhbnNpdGlvblByb3BlcnR5JzsKICAgICAgZWxlbWVudC5zdHlsZVtwcm9wXSA9IGVsZW1lbnQuc3R5bGUudHJhbnNpdGlvblByb3BlcnR5ID0gJ25vbmUnOwogICAgICB4dGFnLnJlcXVlc3RGcmFtZShmdW5jdGlvbigpewogICAgICAgIHZhciBjYWxsYmFjazsKICAgICAgICBpZiAoZm4pIGNhbGxiYWNrID0gZm4uY2FsbChiaW5kKTsKICAgICAgICB4dGFnLnJlcXVlc3RGcmFtZShmdW5jdGlvbigpewogICAgICAgICAgZWxlbWVudC5zdHlsZVtwcm9wXSA9IGVsZW1lbnQuc3R5bGUudHJhbnNpdGlvblByb3BlcnR5ID0gJyc7CiAgICAgICAgICBpZiAoY2FsbGJhY2spIHh0YWcucmVxdWVzdEZyYW1lKGNhbGxiYWNrKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAoKICAgIHJlcXVlc3RGcmFtZTogKGZ1bmN0aW9uKCl7CiAgICAgIHZhciByYWYgPSB3aW4ucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8CiAgICAgICAgd2luW3ByZWZpeC5sb3dlcmNhc2UgKyAnUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ10gfHwKICAgICAgICBmdW5jdGlvbihmbil7IHJldHVybiB3aW4uc2V0VGltZW91dChmbiwgMjApOyB9OwogICAgICByZXR1cm4gZnVuY3Rpb24oZm4pewogICAgICAgIHJldHVybiByYWYuY2FsbCh3aW4sIGZuKTsKICAgICAgfTsKICAgIH0pKCksCgogICAgbWF0Y2hTZWxlY3RvcjogZnVuY3Rpb24gKGVsZW1lbnQsIHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiBtYXRjaFNlbGVjdG9yLmNhbGwoZWxlbWVudCwgc2VsZWN0b3IpOwogICAgfSwKCiAgICBzZXQ6IGZ1bmN0aW9uIChlbGVtZW50LCBtZXRob2QsIHZhbHVlKSB7CiAgICAgIGVsZW1lbnRbbWV0aG9kXSA9IHZhbHVlOwogICAgICBpZiAod2luZG93LkN1c3RvbUVsZW1lbnRzKSBDdXN0b21FbGVtZW50cy51cGdyYWRlQWxsKGVsZW1lbnQpOwogICAgfSwKCiAgICBpbm5lckhUTUw6IGZ1bmN0aW9uKGVsLCBodG1sKXsKICAgICAgeHRhZy5zZXQoZWwsICdpbm5lckhUTUwnLCBodG1sKTsKICAgIH0sCgogICAgaGFzQ2xhc3M6IGZ1bmN0aW9uIChlbGVtZW50LCBrbGFzcykgewogICAgICByZXR1cm4gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoJyAnKS5pbmRleE9mKGtsYXNzLnRyaW0oKSk+LTE7CiAgICB9LAoKICAgIGFkZENsYXNzOiBmdW5jdGlvbiAoZWxlbWVudCwga2xhc3MpIHsKICAgICAgdmFyIGxpc3QgPSBlbGVtZW50LmNsYXNzTmFtZS50cmltKCkuc3BsaXQoJyAnKTsKICAgICAga2xhc3MudHJpbSgpLnNwbGl0KCcgJykuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkgewogICAgICAgIGlmICghfmxpc3QuaW5kZXhPZihuYW1lKSkgbGlzdC5wdXNoKG5hbWUpOwogICAgICB9KTsKICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBsaXN0LmpvaW4oJyAnKS50cmltKCk7CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfSwKCiAgICByZW1vdmVDbGFzczogZnVuY3Rpb24gKGVsZW1lbnQsIGtsYXNzKSB7CiAgICAgIHZhciBjbGFzc2VzID0ga2xhc3MudHJpbSgpLnNwbGl0KCcgJyk7CiAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWUudHJpbSgpLnNwbGl0KCcgJykuZmlsdGVyKGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgcmV0dXJuIG5hbWUgJiYgIX5jbGFzc2VzLmluZGV4T2YobmFtZSk7CiAgICAgIH0pLmpvaW4oJyAnKTsKICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICB9LAoKICAgIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbiAoZWxlbWVudCwga2xhc3MpIHsKICAgICAgcmV0dXJuIHh0YWdbeHRhZy5oYXNDbGFzcyhlbGVtZW50LCBrbGFzcykgPyAncmVtb3ZlQ2xhc3MnIDogJ2FkZENsYXNzJ10uY2FsbChudWxsLCBlbGVtZW50LCBrbGFzcyk7CiAgICB9LAoKICAgIHF1ZXJ5Q2hpbGRyZW46IGZ1bmN0aW9uIChlbGVtZW50LCBzZWxlY3RvcikgewogICAgICB2YXIgaWQgPSBlbGVtZW50LmlkLAogICAgICAgIGd1aWQgPSBlbGVtZW50LmlkID0gaWQgfHwgJ3hfJyArIHh0YWcudWlkKCksCiAgICAgICAgYXR0ciA9ICcjJyArIGd1aWQgKyAnID4gJzsKICAgICAgc2VsZWN0b3IgPSBhdHRyICsgKHNlbGVjdG9yICsgJycpLnJlcGxhY2UoJywnLCAnLCcgKyBhdHRyLCAnZycpOwogICAgICB2YXIgcmVzdWx0ID0gZWxlbWVudC5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgICBpZiAoIWlkKSBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTsKICAgICAgcmV0dXJuIHRvQXJyYXkocmVzdWx0KTsKICAgIH0sCgogICAgY3JlYXRlRnJhZ21lbnQ6IGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgICAgdmFyIGZyYWcgPSBkb2MuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICBpZiAoY29udGVudCkgewogICAgICAgIHZhciBkaXYgPSBmcmFnLmFwcGVuZENoaWxkKGRvYy5jcmVhdGVFbGVtZW50KCdkaXYnKSksCiAgICAgICAgICBub2RlcyA9IHRvQXJyYXkoY29udGVudC5ub2RlTmFtZSA/IGFyZ3VtZW50cyA6ICEoZGl2LmlubmVySFRNTCA9IGNvbnRlbnQpIHx8IGRpdi5jaGlsZHJlbiksCiAgICAgICAgICBsZW5ndGggPSBub2Rlcy5sZW5ndGgsCiAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSBmcmFnLmluc2VydEJlZm9yZShub2Rlc1tpbmRleCsrXSwgZGl2KTsKICAgICAgICBmcmFnLnJlbW92ZUNoaWxkKGRpdik7CiAgICAgIH0KICAgICAgcmV0dXJuIGZyYWc7CiAgICB9LAoKICAgIG1hbmlwdWxhdGU6IGZ1bmN0aW9uKGVsZW1lbnQsIGZuKXsKICAgICAgdmFyIG5leHQgPSBlbGVtZW50Lm5leHRTaWJsaW5nLAogICAgICAgIHBhcmVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSwKICAgICAgICBmcmFnID0gZG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKICAgICAgICByZXR1cm5lZCA9IGZuLmNhbGwoZnJhZy5hcHBlbmRDaGlsZChlbGVtZW50KSwgZnJhZykgfHwgZWxlbWVudDsKICAgICAgaWYgKG5leHQpIHBhcmVudC5pbnNlcnRCZWZvcmUocmV0dXJuZWQsIG5leHQpOwogICAgICBlbHNlIHBhcmVudC5hcHBlbmRDaGlsZChyZXR1cm5lZCk7CiAgICB9LAoKICAgIC8qIFBTRVVET1MgKi8KCiAgICBhcHBseVBzZXVkb3M6IGZ1bmN0aW9uKGtleSwgZm4sIGVsZW1lbnQsIHNvdXJjZSkgewogICAgICB2YXIgbGlzdGVuZXIgPSBmbiwKICAgICAgICAgIHBzZXVkb3MgPSB7fTsKICAgICAgaWYgKGtleS5tYXRjaCgnOicpKSB7CiAgICAgICAgdmFyIHNwbGl0ID0ga2V5Lm1hdGNoKHJlZ2V4UHNldWRvU3BsaXQpLAogICAgICAgICAgICBpID0gc3BsaXQubGVuZ3RoOwogICAgICAgIHdoaWxlICgtLWkpIHsKICAgICAgICAgIHNwbGl0W2ldLnJlcGxhY2UocmVnZXhQc2V1ZG9SZXBsYWNlLCBmdW5jdGlvbiAobWF0Y2gsIG5hbWUsIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICgheHRhZy5wc2V1ZG9zW25hbWVdKSB0aHJvdyAicHNldWRvIG5vdCBmb3VuZDogIiArIG5hbWUgKyAiICIgKyBzcGxpdDsKICAgICAgICAgICAgdmFyIHBzZXVkbyA9IHBzZXVkb3NbaV0gPSBPYmplY3QuY3JlYXRlKHh0YWcucHNldWRvc1tuYW1lXSk7CiAgICAgICAgICAgICAgICBwc2V1ZG8ua2V5ID0ga2V5OwogICAgICAgICAgICAgICAgcHNldWRvLm5hbWUgPSBuYW1lOwogICAgICAgICAgICAgICAgcHNldWRvLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgICBwc2V1ZG9bJ2FyZ3VtZW50cyddID0gKHZhbHVlIHx8ICcnKS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgcHNldWRvLmFjdGlvbiA9IHBzZXVkby5hY3Rpb24gfHwgdHJ1ZW9wOwogICAgICAgICAgICAgICAgcHNldWRvLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgICAgICAgdmFyIGxhc3QgPSBsaXN0ZW5lcjsKICAgICAgICAgICAgbGlzdGVuZXIgPSBmdW5jdGlvbigpewogICAgICAgICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpLAogICAgICAgICAgICAgICAgICBvYmogPSB7CiAgICAgICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBzb3VyY2UsCiAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXI6IGxhc3QKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB2YXIgb3V0cHV0ID0gcHNldWRvLmFjdGlvbi5hcHBseSh0aGlzLCBbb2JqXS5jb25jYXQoYXJncykpOwogICAgICAgICAgICAgIGlmIChvdXRwdXQgPT09IG51bGwgfHwgb3V0cHV0ID09PSBmYWxzZSkgcmV0dXJuIG91dHB1dDsKICAgICAgICAgICAgICByZXR1cm4gb2JqLmxpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoZWxlbWVudCAmJiBwc2V1ZG8ub25BZGQpIHsKICAgICAgICAgICAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUpIHBzZXVkby5vbkFkZC5jYWxsKGVsZW1lbnQsIHBzZXVkbyk7CiAgICAgICAgICAgICAgZWxzZSBlbGVtZW50LnB1c2gocHNldWRvKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAodmFyIHogaW4gcHNldWRvcykgewogICAgICAgIGlmIChwc2V1ZG9zW3pdLm9uQ29tcGlsZWQpIGxpc3RlbmVyID0gcHNldWRvc1t6XS5vbkNvbXBpbGVkKGxpc3RlbmVyLCBwc2V1ZG9zW3pdKSB8fCBsaXN0ZW5lcjsKICAgICAgfQogICAgICByZXR1cm4gbGlzdGVuZXI7CiAgICB9LAoKICAgIHJlbW92ZVBzZXVkb3M6IGZ1bmN0aW9uKGVsZW1lbnQsIGV2ZW50KXsKICAgICAgZXZlbnQuX3BzZXVkb3MuZm9yRWFjaChmdW5jdGlvbihvYmopewogICAgICAgIGlmIChvYmoub25SZW1vdmUpIG9iai5vblJlbW92ZS5jYWxsKGVsZW1lbnQsIG9iaik7CiAgICAgIH0pOwogICAgfSwKCiAgLyoqKiBFdmVudHMgKioqLwoKICAgIHBhcnNlRXZlbnQ6IGZ1bmN0aW9uKHR5cGUsIGZuKSB7CiAgICAgIHZhciBwc2V1ZG9zID0gdHlwZS5zcGxpdCgnOicpLAogICAgICAgICAga2V5ID0gcHNldWRvcy5zaGlmdCgpLAogICAgICAgICAgY3VzdG9tID0geHRhZy5jdXN0b21FdmVudHNba2V5XSwKICAgICAgICAgIGV2ZW50ID0geHRhZy5tZXJnZSh7CiAgICAgICAgICAgIHR5cGU6IGtleSwKICAgICAgICAgICAgc3RhY2s6IG5vb3AsCiAgICAgICAgICAgIGNvbmRpdGlvbjogdHJ1ZW9wLAogICAgICAgICAgICBhdHRhY2g6IFtdLAogICAgICAgICAgICBfYXR0YWNoOiBbXSwKICAgICAgICAgICAgcHNldWRvczogJycsCiAgICAgICAgICAgIF9wc2V1ZG9zOiBbXSwKICAgICAgICAgICAgb25BZGQ6IG5vb3AsCiAgICAgICAgICAgIG9uUmVtb3ZlOiBub29wCiAgICAgICAgICB9LCBjdXN0b20gfHwge30pOwogICAgICBldmVudC5hdHRhY2ggPSB0b0FycmF5KGV2ZW50LmJhc2UgfHwgZXZlbnQuYXR0YWNoKTsKICAgICAgZXZlbnQuY2hhaW4gPSBrZXkgKyAoZXZlbnQucHNldWRvcy5sZW5ndGggPyAnOicgKyBldmVudC5wc2V1ZG9zIDogJycpICsgKHBzZXVkb3MubGVuZ3RoID8gJzonICsgcHNldWRvcy5qb2luKCc6JykgOiAnJyk7CiAgICAgIHZhciBjb25kaXRpb24gPSBldmVudC5jb25kaXRpb247CiAgICAgIGV2ZW50LmNvbmRpdGlvbiA9IGZ1bmN0aW9uKGUpewogICAgICAgIHZhciB0ID0gZS50b3VjaGVzLCB0dCA9IGUudGFyZ2V0VG91Y2hlczsKICAgICAgICByZXR1cm4gY29uZGl0aW9uLmFwcGx5KHRoaXMsIHRvQXJyYXkoYXJndW1lbnRzKSk7CiAgICAgIH07CiAgICAgIHZhciBzdGFjayA9IHh0YWcuYXBwbHlQc2V1ZG9zKGV2ZW50LmNoYWluLCBmbiwgZXZlbnQuX3BzZXVkb3MsIGV2ZW50KTsKICAgICAgZXZlbnQuc3RhY2sgPSBmdW5jdGlvbihlKXsKICAgICAgICB2YXIgdCA9IGUudG91Y2hlcywgdHQgPSBlLnRhcmdldFRvdWNoZXM7CiAgICAgICAgdmFyIGRldGFpbCA9IGUuZGV0YWlsIHx8IHt9OwogICAgICAgIGlmICghZGV0YWlsLl9fc3RhY2tfXykgcmV0dXJuIHN0YWNrLmFwcGx5KHRoaXMsIHRvQXJyYXkoYXJndW1lbnRzKSk7CiAgICAgICAgZWxzZSBpZiAoZGV0YWlsLl9fc3RhY2tfXyA9PSBzdGFjaykgewogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiBzdGFjay5hcHBseSh0aGlzLCB0b0FycmF5KGFyZ3VtZW50cykpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgZXZlbnQubGlzdGVuZXIgPSBmdW5jdGlvbihlKXsKICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKSwKICAgICAgICAgICAgb3V0cHV0ID0gZXZlbnQuY29uZGl0aW9uLmFwcGx5KHRoaXMsIGFyZ3MuY29uY2F0KFtldmVudF0pKTsKICAgICAgICBpZiAoIW91dHB1dCkgcmV0dXJuIG91dHB1dDsKICAgICAgICBpZiAoZS50eXBlICE9IGtleSkgeHRhZy5maXJlRXZlbnQoZS50YXJnZXQsIGtleSwgeyBiYXNlRXZlbnQ6IGUsIGRldGFpbDogeyBfX3N0YWNrX186IHN0YWNrIH0gfSk7CiAgICAgICAgZWxzZSByZXR1cm4gZXZlbnQuc3RhY2suYXBwbHkodGhpcywgYXJncyk7CiAgICAgIH07CiAgICAgIGV2ZW50LmF0dGFjaC5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICBldmVudC5fYXR0YWNoLnB1c2goeHRhZy5wYXJzZUV2ZW50KG5hbWUsIGV2ZW50Lmxpc3RlbmVyKSk7CiAgICAgIH0pOwogICAgICBpZiAoY3VzdG9tICYmIGN1c3RvbS5vYnNlcnZlICYmICFjdXN0b20uX19vYnNlcnZpbmdfXykgewogICAgICAgIGN1c3RvbS5vYnNlcnZlciA9IGZ1bmN0aW9uKGUpewogICAgICAgICAgdmFyIG91dHB1dCA9IGV2ZW50LmNvbmRpdGlvbi5hcHBseSh0aGlzLCB0b0FycmF5KGFyZ3VtZW50cykuY29uY2F0KFtjdXN0b21dKSk7CiAgICAgICAgICBpZiAoIW91dHB1dCkgcmV0dXJuIG91dHB1dDsKICAgICAgICAgIHh0YWcuZmlyZUV2ZW50KGUudGFyZ2V0LCBrZXksIHsgYmFzZUV2ZW50OiBlIH0pOwogICAgICAgIH07CiAgICAgICAgZm9yICh2YXIgeiBpbiBjdXN0b20ub2JzZXJ2ZSkgeHRhZy5hZGRFdmVudChjdXN0b20ub2JzZXJ2ZVt6XSB8fCBkb2N1bWVudCwgeiwgY3VzdG9tLm9ic2VydmVyLCB0cnVlKTsKICAgICAgICBjdXN0b20uX19vYnNlcnZpbmdfXyA9IHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGV2ZW50OwogICAgfSwKCiAgICBhZGRFdmVudDogZnVuY3Rpb24gKGVsZW1lbnQsIHR5cGUsIGZuLCBjYXB0dXJlKSB7CiAgICAgIHZhciBldmVudCA9ICh0eXBlb2YgZm4gPT0gJ2Z1bmN0aW9uJykgPyB4dGFnLnBhcnNlRXZlbnQodHlwZSwgZm4pIDogZm47CiAgICAgIGV2ZW50Ll9wc2V1ZG9zLmZvckVhY2goZnVuY3Rpb24ob2JqKXsKICAgICAgICBvYmoub25BZGQuY2FsbChlbGVtZW50LCBvYmopOwogICAgICB9KTsKICAgICAgZXZlbnQuX2F0dGFjaC5mb3JFYWNoKGZ1bmN0aW9uKG9iaikgewogICAgICAgIHh0YWcuYWRkRXZlbnQoZWxlbWVudCwgb2JqLnR5cGUsIG9iaik7CiAgICAgIH0pOwogICAgICBldmVudC5vbkFkZC5jYWxsKGVsZW1lbnQsIGV2ZW50LCBldmVudC5saXN0ZW5lcik7CiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudC50eXBlLCBldmVudC5zdGFjaywgY2FwdHVyZSB8fCB4dGFnLmNhcHR1cmVFdmVudHMuaW5kZXhPZihldmVudC50eXBlKSA+IC0xKTsKICAgICAgcmV0dXJuIGV2ZW50OwogICAgfSwKCiAgICBhZGRFdmVudHM6IGZ1bmN0aW9uIChlbGVtZW50LCBvYmopIHsKICAgICAgdmFyIGV2ZW50cyA9IHt9OwogICAgICBmb3IgKHZhciB6IGluIG9iaikgewogICAgICAgIGV2ZW50c1t6XSA9IHh0YWcuYWRkRXZlbnQoZWxlbWVudCwgeiwgb2JqW3pdKTsKICAgICAgfQogICAgICByZXR1cm4gZXZlbnRzOwogICAgfSwKCiAgICByZW1vdmVFdmVudDogZnVuY3Rpb24gKGVsZW1lbnQsIHR5cGUsIGV2ZW50KSB7CiAgICAgIGV2ZW50ID0gZXZlbnQgfHwgdHlwZTsKICAgICAgZXZlbnQub25SZW1vdmUuY2FsbChlbGVtZW50LCBldmVudCwgZXZlbnQubGlzdGVuZXIpOwogICAgICB4dGFnLnJlbW92ZVBzZXVkb3MoZWxlbWVudCwgZXZlbnQpOwogICAgICBldmVudC5fYXR0YWNoLmZvckVhY2goZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgeHRhZy5yZW1vdmVFdmVudChlbGVtZW50LCBvYmopOwogICAgICB9KTsKICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LnR5cGUsIGV2ZW50LnN0YWNrKTsKICAgIH0sCgogICAgcmVtb3ZlRXZlbnRzOiBmdW5jdGlvbihlbGVtZW50LCBvYmopewogICAgICBmb3IgKHZhciB6IGluIG9iaikgeHRhZy5yZW1vdmVFdmVudChlbGVtZW50LCBvYmpbel0pOwogICAgfSwKCiAgICBmaXJlRXZlbnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIHR5cGUsIG9wdGlvbnMsIHdhcm4pewogICAgICB2YXIgZXZlbnQgPSBkb2MuY3JlYXRlRXZlbnQoJ0N1c3RvbUV2ZW50Jyk7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICBpZiAod2FybikgY29uc29sZS53YXJuKCdmaXJlRXZlbnQgaGFzIGJlZW4gbW9kaWZpZWQsIG1vcmUgaW5mbyBoZXJlOiAnKTsKICAgICAgZXZlbnQuaW5pdEN1c3RvbUV2ZW50KHR5cGUsCiAgICAgICAgb3B0aW9ucy5idWJibGVzICE9PSBmYWxzZSwKICAgICAgICBvcHRpb25zLmNhbmNlbGFibGUgIT09IGZhbHNlLAogICAgICAgIG9wdGlvbnMuZGV0YWlsCiAgICAgICk7CiAgICAgIGlmIChvcHRpb25zLmJhc2VFdmVudCkgaW5oZXJpdEV2ZW50KGV2ZW50LCBvcHRpb25zLmJhc2VFdmVudCk7CiAgICAgIHRyeSB7IGVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7IH0KICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1RoaXMgZXJyb3IgbWF5IGhhdmUgYmVlbiBjYXVzZWQgYnkgYSBjaGFuZ2UgaW4gdGhlIGZpcmVFdmVudCBtZXRob2QsIG1vcmUgaW5mbyBoZXJlOiAnLCBlKTsKICAgICAgfQogICAgfSwKCiAgICBhZGRPYnNlcnZlcjogZnVuY3Rpb24oZWxlbWVudCwgdHlwZSwgZm4pewogICAgICBpZiAoIWVsZW1lbnQuX3JlY29yZHMpIHsKICAgICAgICBlbGVtZW50Ll9yZWNvcmRzID0geyBpbnNlcnRlZDogW10sIHJlbW92ZWQ6IFtdIH07CiAgICAgICAgaWYgKG11dGF0aW9uKXsKICAgICAgICAgIGVsZW1lbnQuX29ic2VydmVyID0gbmV3IG11dGF0aW9uKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgICBwYXJzZU11dGF0aW9ucyhlbGVtZW50LCBtdXRhdGlvbnMpOwogICAgICAgICAgfSk7CiAgICAgICAgICBlbGVtZW50Ll9vYnNlcnZlci5vYnNlcnZlKGVsZW1lbnQsIHsKICAgICAgICAgICAgc3VidHJlZTogdHJ1ZSwKICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLAogICAgICAgICAgICBhdHRyaWJ1dGVzOiAhdHJ1ZSwKICAgICAgICAgICAgY2hhcmFjdGVyRGF0YTogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlIFsnSW5zZXJ0ZWQnLCAnUmVtb3ZlZCddLmZvckVhY2goZnVuY3Rpb24odHlwZSl7CiAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGUnICsgdHlwZSwgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICBldmVudC5fbXV0YXRpb24gPSB0cnVlOwogICAgICAgICAgICBlbGVtZW50Ll9yZWNvcmRzW3R5cGUudG9Mb3dlckNhc2UoKV0uZm9yRWFjaChmdW5jdGlvbihmbil7CiAgICAgICAgICAgICAgZm4oZXZlbnQudGFyZ2V0LCBldmVudCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwgZmFsc2UpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChlbGVtZW50Ll9yZWNvcmRzW3R5cGVdLmluZGV4T2YoZm4pID09IC0xKSBlbGVtZW50Ll9yZWNvcmRzW3R5cGVdLnB1c2goZm4pOwogICAgfSwKCiAgICByZW1vdmVPYnNlcnZlcjogZnVuY3Rpb24oZWxlbWVudCwgdHlwZSwgZm4pewogICAgICB2YXIgb2JqID0gZWxlbWVudC5fcmVjb3JkczsKICAgICAgaWYgKG9iaiAmJiBmbil7CiAgICAgICAgb2JqW3R5cGVdLnNwbGljZShvYmpbdHlwZV0uaW5kZXhPZihmbiksIDEpOwogICAgICB9CiAgICAgIGVsc2V7CiAgICAgICAgb2JqW3R5cGVdID0gW107CiAgICAgIH0KICAgIH0KCiAgfTsKCi8qKiogVW5pdmVyc2FsIFRvdWNoICoqKi8KCnZhciB0b3VjaENvdW50ID0gMCwgdG91Y2hUYXJnZXQgPSBudWxsOwoKZG9jLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpewogIHRvdWNoQ291bnQrKzsKICB0b3VjaFRhcmdldCA9IGUudGFyZ2V0Owp9LCB0cnVlKTsKCmRvYy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24oKXsKICB0b3VjaENvdW50LS07CiAgdG91Y2hUYXJnZXQgPSBudWxsOwp9LCBmYWxzZSk7Cgp2YXIgVUlFdmVudFByb3RvID0gewogIHRvdWNoZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIGdldDogZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIHRoaXMuX190b3VjaGVzX18gfHwKICAgICAgICAodGhpcy5pZGVudGlmaWVyID0gMCkgfHwKICAgICAgICAodGhpcy5fX3RvdWNoZXNfXyA9IHRvdWNoQ291bnQgPyBbdGhpc10gOiBbXSk7CiAgICB9CiAgfSwKICB0YXJnZXRUb3VjaGVzOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICBnZXQ6IGZ1bmN0aW9uKCl7CiAgICAgIHJldHVybiB0aGlzLl9fdGFyZ2V0VG91Y2hlc19fIHx8ICh0aGlzLl9fdGFyZ2V0VG91Y2hlc19fID0KICAgICAgICAodG91Y2hDb3VudCAmJiB0aGlzLmN1cnJlbnRUYXJnZXQgJiYKICAgICAgICAodGhpcy5jdXJyZW50VGFyZ2V0ID09IHRvdWNoVGFyZ2V0IHx8CiAgICAgICAgKHRoaXMuY3VycmVudFRhcmdldC5jb250YWlucyAmJiB0aGlzLmN1cnJlbnRUYXJnZXQuY29udGFpbnModG91Y2hUYXJnZXQpKSkpID8gW3RoaXNdIDogW10pOwogICAgfQogIH0sCiAgY2hhbmdlZFRvdWNoZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIGdldDogZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIHRoaXMudG91Y2hlczsKICAgIH0KICB9Cn07Cgpmb3IgKHogaW4gVUlFdmVudFByb3RvKXsKICBVSUV2ZW50LnByb3RvdHlwZVt6XSA9IFVJRXZlbnRQcm90b1t6XTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVUlFdmVudC5wcm90b3R5cGUsIHosIFVJRXZlbnRQcm90b1t6XSk7Cn0KCnZhciB0b3VjaFJlc2V0ID0gewogICAgdmFsdWU6IG51bGwsCiAgICB3cml0YWJsZTogdHJ1ZSwKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgVG91Y2hFdmVudFByb3RvID0gewogICAgdG91Y2hlczogdG91Y2hSZXNldCwKICAgIHRhcmdldFRvdWNoZXM6IHRvdWNoUmVzZXQsCiAgICBjaGFuZ2VkVG91Y2hlczogdG91Y2hSZXNldAogIH07CgppZiAod2luLlRvdWNoRXZlbnQpIHsKICBmb3IgKHogaW4gVG91Y2hFdmVudFByb3RvKSB3aW4uVG91Y2hFdmVudC5wcm90b3R5cGVbel0gPSBUb3VjaEV2ZW50UHJvdG9bel07Cn0KCi8qKiogQ3VzdG9tIEV2ZW50IERlZmluaXRpb25zICoqKi8KCiAgZnVuY3Rpb24gYWRkVGFwKGVsLCB0YXAsIGUpewogICAgaWYgKCFlbC5fX3RhcF9fKSB7CiAgICAgIGVsLl9fdGFwX18gPSB7IGNsaWNrOiBlLnR5cGUgPT0gJ21vdXNlZG93bicgfTsKICAgICAgaWYgKGVsLl9fdGFwX18uY2xpY2spIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGFwLm9ic2VydmVyKTsKICAgICAgZWxzZSB7CiAgICAgICAgZWwuX190YXBfXy5zY3JvbGwgPSB0YXAub2JzZXJ2ZXIuYmluZChlbCk7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGVsLl9fdGFwX18uc2Nyb2xsLCB0cnVlKTsKICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0YXAub2JzZXJ2ZXIpOwogICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgdGFwLm9ic2VydmVyKTsKICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRhcC5vYnNlcnZlcik7CiAgICAgIH0KICAgIH0KICAgIGlmICghZWwuX190YXBfXy5jbGljaykgewogICAgICBlbC5fX3RhcF9fLnggPSBlLnRvdWNoZXNbMF0ucGFnZVg7CiAgICAgIGVsLl9fdGFwX18ueSA9IGUudG91Y2hlc1swXS5wYWdlWTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlbW92ZVRhcChlbCwgdGFwKXsKICAgIGlmIChlbC5fX3RhcF9fKSB7CiAgICAgIGlmIChlbC5fX3RhcF9fLmNsaWNrKSBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRhcC5vYnNlcnZlcik7CiAgICAgIGVsc2UgewogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBlbC5fX3RhcF9fLnNjcm9sbCwgdHJ1ZSk7CiAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGFwLm9ic2VydmVyKTsKICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGNhbmNlbCcsIHRhcC5vYnNlcnZlcik7CiAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0YXAub2JzZXJ2ZXIpOwogICAgICB9CiAgICAgIGRlbGV0ZSBlbC5fX3RhcF9fOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hlY2tUYXBQb3NpdGlvbihlbCwgdGFwLCBlKXsKICAgIHZhciB0b3VjaCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07CiAgICBpZiAoCiAgICAgIHRvdWNoLnBhZ2VYIDwgZWwuX190YXBfXy54ICsgdGFwLmdlc3R1cmUudG9sZXJhbmNlICYmCiAgICAgIHRvdWNoLnBhZ2VYID4gZWwuX190YXBfXy54IC0gdGFwLmdlc3R1cmUudG9sZXJhbmNlICYmCiAgICAgIHRvdWNoLnBhZ2VZIDwgZWwuX190YXBfXy55ICsgdGFwLmdlc3R1cmUudG9sZXJhbmNlICYmCiAgICAgIHRvdWNoLnBhZ2VZID4gZWwuX190YXBfXy55IC0gdGFwLmdlc3R1cmUudG9sZXJhbmNlCiAgICApIHJldHVybiB0cnVlOwogIH0KCiAgeHRhZy5jdXN0b21FdmVudHMudGFwID0gewogICAgb2JzZXJ2ZTogewogICAgICBtb3VzZWRvd246IGRvY3VtZW50LAogICAgICB0b3VjaHN0YXJ0OiBkb2N1bWVudAogICAgfSwKICAgIGdlc3R1cmU6IHsKICAgICAgdG9sZXJhbmNlOiA4CiAgICB9LAogICAgY29uZGl0aW9uOiBmdW5jdGlvbihlLCB0YXApewogICAgICB2YXIgZWwgPSBlLnRhcmdldDsKICAgICAgc3dpdGNoIChlLnR5cGUpIHsKICAgICAgICBjYXNlICd0b3VjaHN0YXJ0JzoKICAgICAgICAgIGlmIChlbC5fX3RhcF9fICYmIGVsLl9fdGFwX18uY2xpY2spIHJlbW92ZVRhcChlbCwgdGFwKTsKICAgICAgICAgIGFkZFRhcChlbCwgdGFwLCBlKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICBjYXNlICdtb3VzZWRvd24nOgogICAgICAgICAgaWYgKCFlbC5fX3RhcF9fKSBhZGRUYXAoZWwsIHRhcCwgZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgY2FzZSAnc2Nyb2xsJzoKICAgICAgICBjYXNlICd0b3VjaGNhbmNlbCc6CiAgICAgICAgICByZW1vdmVUYXAodGhpcywgdGFwKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICBjYXNlICd0b3VjaG1vdmUnOgogICAgICAgIGNhc2UgJ3RvdWNoZW5kJzoKICAgICAgICAgIGlmICh0aGlzLl9fdGFwX18gJiYgIWNoZWNrVGFwUG9zaXRpb24odGhpcywgdGFwLCBlKSkgewogICAgICAgICAgICByZW1vdmVUYXAodGhpcywgdGFwKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUudHlwZSA9PSAndG91Y2hlbmQnIHx8IG51bGw7CiAgICAgICAgY2FzZSAnY2xpY2snOgogICAgICAgICAgcmVtb3ZlVGFwKHRoaXMsIHRhcCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogIH07CgogIHdpbi54dGFnID0geHRhZzsKICBpZiAodHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIGRlZmluZSh4dGFnKTsKCiAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoJ1dlYkNvbXBvbmVudHNSZWFkeScsIGZ1bmN0aW9uKCl7CiAgICB4dGFnLmZpcmVFdmVudChkb2MuYm9keSwgJ0RPTUNvbXBvbmVudHNMb2FkZWQnKTsKICB9KTsKCn0pKCk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 03:44:30 GMT",
                    "Content-Length": "214873",
                    "Date": "Sun, 09 Nov 2014 03:44:30 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}