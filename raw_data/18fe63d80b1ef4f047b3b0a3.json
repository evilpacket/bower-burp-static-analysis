{
    "url": "http://localhost:9999/simplabs/ember-simple-auth-component/simple-auth.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>location</b> and written to <b>the 'href' property of a DOM element</b> via the following statement:<ul><li>link.href = location;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/simplabs/ember-simple-auth-component/simple-auth.js",
                "path": "/simplabs/ember-simple-auth-component/simple-auth.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9zaW1wbGFicy9lbWJlci1zaW1wbGUtYXV0aC1jb21wb25lbnQvc2ltcGxlLWF1dGguanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNjIxMDYNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMjM6MDQ6MjkgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDIzOjA0OjI5IEdNVA0KDQooZnVuY3Rpb24oZ2xvYmFsKSB7CgpFbWJlci5saWJyYXJpZXMucmVnaXN0ZXIoJ0VtYmVyIFNpbXBsZSBBdXRoJywgJzAuNy4xJyk7Cgp2YXIgZGVmaW5lLCByZXF1aXJlTW9kdWxlOwoKKGZ1bmN0aW9uKCkgewogIHZhciByZWdpc3RyeSA9IHt9LCBzZWVuID0ge307CgogIGRlZmluZSA9IGZ1bmN0aW9uKG5hbWUsIGRlcHMsIGNhbGxiYWNrKSB7CiAgICByZWdpc3RyeVtuYW1lXSA9IHsgZGVwczogZGVwcywgY2FsbGJhY2s6IGNhbGxiYWNrIH07CiAgfTsKCiAgcmVxdWlyZU1vZHVsZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIGlmIChzZWVuLmhhc093blByb3BlcnR5KG5hbWUpKSB7IHJldHVybiBzZWVuW25hbWVdOyB9CiAgICBzZWVuW25hbWVdID0ge307CgogICAgaWYgKCFyZWdpc3RyeVtuYW1lXSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkNvdWxkIG5vdCBmaW5kIG1vZHVsZSAiICsgbmFtZSk7CiAgICB9CgogICAgdmFyIG1vZCA9IHJlZ2lzdHJ5W25hbWVdLAogICAgICAgIGRlcHMgPSBtb2QuZGVwcywKICAgICAgICBjYWxsYmFjayA9IG1vZC5jYWxsYmFjaywKICAgICAgICByZWlmaWVkID0gW10sCiAgICAgICAgZXhwb3J0czsKCiAgICBmb3IgKHZhciBpPTAsIGw9ZGVwcy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgIGlmIChkZXBzW2ldID09PSAnZXhwb3J0cycpIHsKICAgICAgICByZWlmaWVkLnB1c2goZXhwb3J0cyA9IHt9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZWlmaWVkLnB1c2gocmVxdWlyZU1vZHVsZShyZXNvbHZlKGRlcHNbaV0pKSk7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgdmFsdWUgPSBjYWxsYmFjay5hcHBseSh0aGlzLCByZWlmaWVkKTsKICAgIHJldHVybiBzZWVuW25hbWVdID0gZXhwb3J0cyB8fCB2YWx1ZTsKCiAgICBmdW5jdGlvbiByZXNvbHZlKGNoaWxkKSB7CiAgICAgIGlmIChjaGlsZC5jaGFyQXQoMCkgIT09ICcuJykgeyByZXR1cm4gY2hpbGQ7IH0KICAgICAgdmFyIHBhcnRzID0gY2hpbGQuc3BsaXQoIi8iKTsKICAgICAgdmFyIHBhcmVudEJhc2UgPSBuYW1lLnNwbGl0KCIvIikuc2xpY2UoMCwgLTEpOwoKICAgICAgZm9yICh2YXIgaT0wLCBsPXBhcnRzLmxlbmd0aDsgaTxsOyBpKyspIHsKICAgICAgICB2YXIgcGFydCA9IHBhcnRzW2ldOwoKICAgICAgICBpZiAocGFydCA9PT0gJy4uJykgeyBwYXJlbnRCYXNlLnBvcCgpOyB9CiAgICAgICAgZWxzZSBpZiAocGFydCA9PT0gJy4nKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgZWxzZSB7IHBhcmVudEJhc2UucHVzaChwYXJ0KTsgfQogICAgICB9CgogICAgICByZXR1cm4gcGFyZW50QmFzZS5qb2luKCIvIik7CiAgICB9CiAgfTsKCiAgcmVxdWlyZU1vZHVsZS5yZWdpc3RyeSA9IHJlZ2lzdHJ5Owp9KSgpOwoKZGVmaW5lKCJzaW1wbGUtYXV0aC9hdXRoZW50aWNhdG9ycy9iYXNlIiwgCiAgWyJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIC8qKgogICAgICBUaGUgYmFzZSBmb3IgYWxsIGF1dGhlbnRpY2F0b3JzLiBfX1RoaXMgc2VydmVzIGFzIGEgc3RhcnRpbmcgcG9pbnQgZm9yCiAgICAgIGltcGxlbWVudGluZyBjdXN0b20gYXV0aGVudGljYXRvcnMgYW5kIG11c3Qgbm90IGJlIHVzZWQgZGlyZWN0bHkuX18KCiAgICAgIFRoZSBhdXRoZW50aWNhdG9yIGF1dGhlbnRpY2F0ZXMgdGhlIHNlc3Npb24uIFRoZSBhY3R1YWwgbWVjaGFuaXNtIHVzZWQgdG8gZG8KICAgICAgdGhpcyBtaWdodCBlLmcuIGJlIHBvc3RpbmcgYSBzZXQgb2YgY3JlZGVudGlhbHMgdG8gYSBzZXJ2ZXIgYW5kIGluIGV4Y2hhbmdlCiAgICAgIHJldHJpZXZpbmcgYW4gYWNjZXNzIHRva2VuLCBpbml0aWF0aW5nIGF1dGhlbnRpY2F0aW9uIGFnYWluc3QgYW4gZXh0ZXJuYWwKICAgICAgcHJvdmlkZXIgbGlrZSBGYWNlYm9vayBldGMuIGFuZCBkZXBlbmRzIG9uIHRoZSBzcGVjaWZpYyBhdXRoZW50aWNhdG9yLiBBbnkKICAgICAgZGF0YSB0aGF0IHRoZSBhdXRoZW50aWNhdG9yIHJlY2VpdmVzIHVwb24gc3VjY2Vzc2Z1bCBhdXRoZW50aWNhdGlvbiBhbmQKICAgICAgcmVzb2x2ZXMgd2l0aCBmcm9tIHRoZQogICAgICBbYEF1dGhlbnRpY2F0b3JzLkJhc2UjYXV0aGVudGljYXRlYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZS1hdXRoZW50aWNhdGUpCiAgICAgIG1ldGhvZCBpcyBzdG9yZWQgaW4gdGhlIHNlc3Npb24gYW5kIGNhbiB0aGVuIGJlIHVzZWQgYnkgdGhlIGF1dGhvcml6ZXIgKHNlZQogICAgICBbYEF1dGhvcml6ZXJzLkJhc2VgXSgjU2ltcGxlQXV0aC1BdXRob3JpemVycy1CYXNlKSkuCgogICAgICBUaGUgYXV0aGVudGljYXRvciBhbHNvIGRlY2lkZXMgd2hldGhlciBhIHNldCBvZiBkYXRhIHRoYXQgd2FzIHJlc3RvcmVkIGZyb20KICAgICAgdGhlIHNlc3Npb24gc3RvcmUgKHNlZQogICAgICBbYFN0b3Jlcy5CYXNlYF0oI1NpbXBsZUF1dGgtU3RvcmVzLUJhc2UpKSBpcyBzdWZmaWNpZW50IGZvciB0aGUgc2Vzc2lvbiB0byBiZQogICAgICBhdXRoZW50aWNhdGVkIG9yIG5vdC4KCiAgICAgIF9fQ3VzdG9tIGF1dGhlbnRpY2F0b3JzIGhhdmUgdG8gYmUgcmVnaXN0ZXJlZCB3aXRoIEVtYmVyJ3MgZGVwZW5kZW5jeQogICAgICBpbmplY3Rpb24gY29udGFpbmVyX18gc28gdGhhdCB0aGUgc2Vzc2lvbiBjYW4gcmV0cmlldmUgYW4gaW5zdGFuY2UsIGUuZy46CgogICAgICBgYGBqcwogICAgICBpbXBvcnQgQmFzZSBmcm9tICdzaW1wbGUtYXV0aC9hdXRoZW50aWNhdG9ycy9iYXNlJzsKCiAgICAgIHZhciBDdXN0b21BdXRoZW50aWNhdG9yID0gQmFzZS5leHRlbmQoewogICAgICAgIC4uLgogICAgICB9KTsKCiAgICAgIEVtYmVyLkFwcGxpY2F0aW9uLmluaXRpYWxpemVyKHsKICAgICAgICBuYW1lOiAnYXV0aGVudGljYXRpb24nLAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGNvbnRhaW5lciwgYXBwbGljYXRpb24pIHsKICAgICAgICAgIGNvbnRhaW5lci5yZWdpc3RlcignYXV0aGVudGljYXRvcjpjdXN0b20nLCBDdXN0b21BdXRoZW50aWNhdG9yKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIGBgYGpzCiAgICAgIC8vIGFwcC9jb250cm9sbGVycy9sb2dpbi5qcwogICAgICBpbXBvcnQgQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4gZnJvbSAnc2ltcGxlLWF1dGgvbWl4aW5zL2F1dGhlbnRpY2F0aW9uLWNvbnRyb2xsZXItbWl4aW4nOwoKICAgICAgZXhwb3J0IGRlZmF1bHQgRW1iZXIuQ29udHJvbGxlci5leHRlbmQoQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4sIHsKICAgICAgICBhdXRoZW50aWNhdG9yOiAnYXV0aGVudGljYXRvcjpjdXN0b20nCiAgICAgIH0pOwogICAgICBgYGAKCiAgICAgIEBjbGFzcyBCYXNlCiAgICAgIEBuYW1lc3BhY2UgU2ltcGxlQXV0aC5BdXRoZW50aWNhdG9ycwogICAgICBAbW9kdWxlIHNpbXBsZS1hdXRoL2F1dGhlbnRpY2F0b3JzL2Jhc2UKICAgICAgQGV4dGVuZHMgRW1iZXIuT2JqZWN0CiAgICAgIEB1c2VzIEVtYmVyLkV2ZW50ZWQKICAgICovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gRW1iZXIuT2JqZWN0LmV4dGVuZChFbWJlci5FdmVudGVkLCB7CiAgICAgIC8qKgogICAgICAgIF9fVHJpZ2dlcmVkIHdoZW4gdGhlIGRhdGEgdGhhdCBjb25zdGl0dXRlcyB0aGUgc2Vzc2lvbiBpcyB1cGRhdGVkIGJ5IHRoZQogICAgICAgIGF1dGhlbnRpY2F0b3JfXy4gVGhpcyBtaWdodCBoYXBwZW4gZS5nLiBiZWNhdXNlIHRoZSBhdXRoZW50aWNhdG9yIHJlZnJlc2hlcwogICAgICAgIGl0IG9yIGFuIGV2ZW50IGZyb20gaXMgdHJpZ2dlcmVkIGZyb20gYW4gZXh0ZXJuYWwgYXV0aGVudGljYXRpb24gcHJvdmlkZXIuCiAgICAgICAgVGhlIHNlc3Npb24gYXV0b21hdGljYWxseSBjYXRjaGVzIHRoYXQgZXZlbnQsIHBhc3NlcyB0aGUgdXBkYXRlZCBkYXRhIGJhY2sKICAgICAgICB0byB0aGUgYXV0aGVudGljYXRvcidzCiAgICAgICAgW1NpbXBsZUF1dGguQXV0aGVudGljYXRvcnMuQmFzZSNyZXN0b3JlXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdG9ycy1CYXNlLXJlc3RvcmUpCiAgICAgICAgbWV0aG9kIGFuZCBoYW5kbGVzIHRoZSByZXN1bHQgb2YgdGhhdCBpbnZvY2F0aW9uIGFjY29yZGluZ2x5LgoKICAgICAgICBAZXZlbnQgc2Vzc2lvbkRhdGFVcGRhdGVkCiAgICAgICAgQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIHVwZGF0ZWQgc2Vzc2lvbiBkYXRhCiAgICAgICovCiAgICAgIC8qKgogICAgICAgIF9fVHJpZ2dlcmVkIHdoZW4gdGhlIGRhdGEgdGhhdCBjb25zdGl0dXRlcyB0aGUgc2Vzc2lvbiBpcyBpbnZhbGlkYXRlZCBieQogICAgICAgIHRoZSBhdXRoZW50aWNhdG9yX18uIFRoaXMgbWlnaHQgaGFwcGVuIGUuZy4gYmVjYXVzZSB0aGUgZGF0ZSBleHBpcmVzIG9yIGFuCiAgICAgICAgZXZlbnQgaXMgdHJpZ2dlcmVkIGZyb20gYW4gZXh0ZXJuYWwgYXV0aGVudGljYXRpb24gcHJvdmlkZXIuIFRoZSBzZXNzaW9uCiAgICAgICAgYXV0b21hdGljYWxseSBjYXRjaGVzIHRoYXQgZXZlbnQgYW5kIGludmFsaWRhdGVzIGl0c2VsZi4KCiAgICAgICAgQGV2ZW50IHNlc3Npb25EYXRhSW52YWxpZGF0ZWQKICAgICAgICBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgdXBkYXRlZCBzZXNzaW9uIGRhdGEKICAgICAgKi8KCiAgICAgIC8qKgogICAgICAgIFJlc3RvcmVzIHRoZSBzZXNzaW9uIGZyb20gYSBzZXQgb2YgcHJvcGVydGllcy4gX19UaGlzIG1ldGhvZCBpcyBpbnZva2VkIGJ5CiAgICAgICAgdGhlIHNlc3Npb24gZWl0aGVyIGFmdGVyIHRoZSBhcHBsaWNhdGlvbiBzdGFydHMgdXAgYW5kIHNlc3Npb24gZGF0YSB3YXMKICAgICAgICByZXN0b3JlZCBmcm9tIHRoZSBzdG9yZV9fIG9yIHdoZW4gcHJvcGVydGllcyBpbiB0aGUgc3RvcmUgaGF2ZSBjaGFuZ2VkIGR1ZQogICAgICAgIHRvIGV4dGVybmFsIGV2ZW50cyAoZS5nLiBpbiBhbm90aGVyIHRhYikgYW5kIHRoZSBuZXcgc2V0IG9mIHByb3BlcnRpZXMKICAgICAgICBuZWVkcyB0byBiZSByZS1jaGVja2VkIGZvciB3aGV0aGVyIGl0IHN0aWxsIGNvbnN0aXR1dGVzIGFuIGF1dGhlbnRpY2F0ZWQKICAgICAgICBzZXNzaW9uLgoKICAgICAgICBfX1RoaXMgbWV0aG9kIHJldHVybnMgYSBwcm9taXNlLiBBIHJlc29sdmluZyBwcm9taXNlIHdpbGwgcmVzdWx0IGluIHRoZQogICAgICAgIHNlc3Npb24gYmVpbmcgYXV0aGVudGljYXRlZC5fXyBBbnkgcHJvcGVydGllcyB0aGUgcHJvbWlzZSByZXNvbHZlcyB3aXRoCiAgICAgICAgd2lsbCBiZSBzYXZlZCBpbiBhbmQgYWNjZXNzaWJsZSB2aWEgdGhlIHNlc3Npb24uIEluIG1vc3QgY2FzZXMgdGhlIGBkYXRhYAogICAgICAgIGFyZ3VtZW50IHdpbGwgc2ltcGx5IGJlIGZvcndhcmRlZCB0aHJvdWdoIHRoZSBwcm9taXNlLiBBIHJlamVjdGluZyBwcm9taXNlCiAgICAgICAgaW5kaWNhdGVzIHRoYXQgYXV0aGVudGljYXRpb24gZmFpbGVkIGFuZCB0aGUgc2Vzc2lvbiB3aWxsIHJlbWFpbiB1bmNoYW5nZWQuCgogICAgICAgIGBTaW1wbGVBdXRoLkF1dGhlbnRpY2F0b3JzLkJhc2VgJ3MgaW1wbGVtZW50YXRpb24gYWx3YXlzIHJldHVybnMgYQogICAgICAgIHJlamVjdGluZyBwcm9taXNlLgoKICAgICAgICBAbWV0aG9kIHJlc3RvcmUKICAgICAgICBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSB0byByZXN0b3JlIHRoZSBzZXNzaW9uIGZyb20KICAgICAgICBAcmV0dXJuIHtFbWJlci5SU1ZQLlByb21pc2V9IEEgcHJvbWlzZSB0aGF0IHdoZW4gaXQgcmVzb2x2ZXMgcmVzdWx0cyBpbiB0aGUgc2Vzc2lvbiBiZWluZyBhdXRoZW50aWNhdGVkCiAgICAgICovCiAgICAgIHJlc3RvcmU6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICByZXR1cm4gbmV3IEVtYmVyLlJTVlAucmVqZWN0KCk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBBdXRoZW50aWNhdGVzIHRoZSBzZXNzaW9uIHdpdGggdGhlIHNwZWNpZmllZCBgb3B0aW9uc2AuIFRoZXNlIG9wdGlvbnMgdmFyeQogICAgICAgIGRlcGVuZGluZyBvbiB0aGUgYWN0dWFsIGF1dGhlbnRpY2F0aW9uIG1lY2hhbmlzbSB0aGUgYXV0aGVudGljYXRvcgogICAgICAgIGltcGxlbWVudHMgKGUuZy4gYSBzZXQgb2YgY3JlZGVudGlhbHMgb3IgYSBGYWNlYm9vayBhY2NvdW50IGlkIGV0Yy4pLiBfX1RoZQogICAgICAgIHNlc3Npb24gd2lsbCBpbnZva2UgdGhpcyBtZXRob2Qgd2hlbiBhbiBhY3Rpb24gaW4gdGhlIGFwcGxpY2F0aW9uIHRyaWdnZXJzCiAgICAgICAgYXV0aGVudGljYXRpb25fXyAoc2VlCiAgICAgICAgW1NpbXBsZUF1dGguQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4uYWN0aW9ucyNhdXRoZW50aWNhdGVdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluLWF1dGhlbnRpY2F0ZSkpLgoKICAgICAgICBfX1RoaXMgbWV0aG9kIHJldHVybnMgYSBwcm9taXNlLiBBIHJlc29sdmluZyBwcm9taXNlIHdpbGwgcmVzdWx0IGluIHRoZQogICAgICAgIHNlc3Npb24gYmVpbmcgYXV0aGVudGljYXRlZC5fXyBBbnkgcHJvcGVydGllcyB0aGUgcHJvbWlzZSByZXNvbHZlcyB3aXRoCiAgICAgICAgd2lsbCBiZSBzYXZlZCBpbiBhbmQgYWNjZXNzaWJsZSB2aWEgdGhlIHNlc3Npb24uIEEgcmVqZWN0aW5nIHByb21pc2UKICAgICAgICBpbmRpY2F0ZXMgdGhhdCBhdXRoZW50aWNhdGlvbiBmYWlsZWQgYW5kIHRoZSBzZXNzaW9uIHdpbGwgcmVtYWluIHVuY2hhbmdlZC4KCiAgICAgICAgYFNpbXBsZUF1dGguQXV0aGVudGljYXRvcnMuQmFzZWAncyBpbXBsZW1lbnRhdGlvbiBhbHdheXMgcmV0dXJucyBhCiAgICAgICAgcmVqZWN0aW5nIHByb21pc2UgYW5kIHRodXMgbmV2ZXIgYXV0aGVudGljYXRlcyB0aGUgc2Vzc2lvbi4KCiAgICAgICAgQG1ldGhvZCBhdXRoZW50aWNhdGUKICAgICAgICBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBUaGUgb3B0aW9ucyB0byBhdXRoZW50aWNhdGUgdGhlIHNlc3Npb24gd2l0aAogICAgICAgIEByZXR1cm4ge0VtYmVyLlJTVlAuUHJvbWlzZX0gQSBwcm9taXNlIHRoYXQgd2hlbiBpdCByZXNvbHZlcyByZXN1bHRzIGluIHRoZSBzZXNzaW9uIGJlaW5nIGF1dGhlbnRpY2F0ZWQKICAgICAgKi8KICAgICAgYXV0aGVudGljYXRlOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIG5ldyBFbWJlci5SU1ZQLnJlamVjdCgpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgVGhpcyBjYWxsYmFjayBpcyBpbnZva2VkIHdoZW4gdGhlIHNlc3Npb24gaXMgaW52YWxpZGF0ZWQuIFdoaWxlIHRoZSBzZXNzaW9uCiAgICAgICAgd2lsbCBpbnZhbGlkYXRlIGl0c2VsZiBhbmQgY2xlYXIgYWxsIHNlc3Npb24gcHJvcGVydGllcywgaXQgbWlnaHQgYmUKICAgICAgICBuZWNlc3NhcnkgZm9yIHNvbWUgYXV0aGVudGljYXRvcnMgdG8gcGVyZm9ybSBhZGRpdGlvbmFsIHRhc2tzIChlLmcuCiAgICAgICAgaW52YWxpZGF0aW5nIGFuIGFjY2VzcyB0b2tlbiBvbiB0aGUgc2VydmVyKSwgd2hpY2ggc2hvdWxkIGJlIGRvbmUgaW4gdGhpcwogICAgICAgIG1ldGhvZC4KCiAgICAgICAgX19UaGlzIG1ldGhvZCByZXR1cm5zIGEgcHJvbWlzZS4gQSByZXNvbHZpbmcgcHJvbWlzZSB3aWxsIHJlc3VsdCBpbiB0aGUKICAgICAgICBzZXNzaW9uIGJlaW5nIGludmFsaWRhdGVkLl9fIEEgcmVqZWN0aW5nIHByb21pc2Ugd2lsbCByZXN1bHQgaW4gdGhlIHNlc3Npb24KICAgICAgICBpbnZhbGlkYXRpb24gYmVpbmcgaW50ZXJjZXB0ZWQgYW5kIHRoZSBzZXNzaW9uIGJlaW5nIGxlZnQgYXV0aGVudGljYXRlZC4KCiAgICAgICAgYFNpbXBsZUF1dGguQXV0aGVudGljYXRvcnMuQmFzZWAncyBpbXBsZW1lbnRhdGlvbiBhbHdheXMgcmV0dXJucyBhCiAgICAgICAgcmVzb2x2aW5nIHByb21pc2UgYW5kIHRodXMgbmV2ZXIgaW50ZXJjZXB0cyBzZXNzaW9uIGludmFsaWRhdGlvbi4KCiAgICAgICAgQG1ldGhvZCBpbnZhbGlkYXRlCiAgICAgICAgQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdGhhdCB0aGUgc2Vzc2lvbiBjdXJyZW50bHkgaG9sZHMKICAgICAgICBAcmV0dXJuIHtFbWJlci5SU1ZQLlByb21pc2V9IEEgcHJvbWlzZSB0aGF0IHdoZW4gaXQgcmVzb2x2ZXMgcmVzdWx0cyBpbiB0aGUgc2Vzc2lvbiBiZWluZyBpbnZhbGlkYXRlZAogICAgICAqLwogICAgICBpbnZhbGlkYXRlOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBFbWJlci5SU1ZQLnJlc29sdmUoKTsKICAgICAgfQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvYXV0aG9yaXplcnMvYmFzZSIsIAogIFsiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICAvKioKICAgICAgVGhlIGJhc2UgZm9yIGFsbCBhdXRob3JpemVycy4gX19UaGlzIHNlcnZlcyBhcyBhIHN0YXJ0aW5nIHBvaW50IGZvcgogICAgICBpbXBsZW1lbnRpbmcgY3VzdG9tIGF1dGhvcml6ZXJzIGFuZCBtdXN0IG5vdCBiZSB1c2VkIGRpcmVjdGx5Ll9fCgogICAgICBfX1RoZSBhdXRob3JpemVyIHByZXByb2Nlc3NlcyBhbGwgWEhSIHJlcXVlc3RzX18gKGV4Y2VwdCBvbmVzIHRvIDNyZCBwYXJ0eQogICAgICBvcmlnaW5zLCBzZWUKICAgICAgW0NvbmZpZ3VyYXRpb24uY3Jvc3NPcmlnaW5XaGl0ZWxpc3RdKCNTaW1wbGVBdXRoLUNvbmZpZ3VyYXRpb24tY3Jvc3NPcmlnaW5XaGl0ZWxpc3QpKQogICAgICBhbmQgbWFrZXMgc3VyZSB0aGV5IGhhdmUgdGhlIHJlcXVpcmVkIGRhdGEgYXR0YWNoZWQgdGhhdCBhbGxvd3MgdGhlIHNlcnZlciB0bwogICAgICBpZGVudGlmeSB0aGUgdXNlciBtYWtpbmcgdGhlIHJlcXVlc3QuIFRoaXMgZGF0YSBtaWdodCBiZSBhbiBIVFRQIGhlYWRlciwKICAgICAgcXVlcnkgc3RyaW5nIHBhcmFtZXRlcnMgaW4gdGhlIFVSTCwgY29va2llcyBldGMuIF9fVGhlIGF1dGhvcml6ZXIgaGFzIHRvIGZpdAogICAgICB0aGUgYXV0aGVudGljYXRvcl9fIChzZWUKICAgICAgW1NpbXBsZUF1dGguQXV0aGVudGljYXRvcnMuQmFzZV0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZSkpCiAgICAgIGFzIGl0IHJlbGllcyBvbiBkYXRhIHRoYXQgdGhlIGF1dGhlbnRpY2F0b3IgYWNxdWlyZXMgZHVyaW5nIGF1dGhlbnRpY2F0aW9uLgoKICAgICAgQGNsYXNzIEJhc2UKICAgICAgQG5hbWVzcGFjZSBTaW1wbGVBdXRoLkF1dGhvcml6ZXJzCiAgICAgIEBtb2R1bGUgc2ltcGxlLWF1dGgvYXV0aG9yaXplcnMvYmFzZQogICAgICBAZXh0ZW5kcyBFbWJlci5PYmplY3QKICAgICovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gRW1iZXIuT2JqZWN0LmV4dGVuZCh7CiAgICAgIC8qKgogICAgICAgIFRoZSBzZXNzaW9uIHRoZSBhdXRob3JpemVyIGdldHMgdGhlIGRhdGEgaXQgbmVlZHMgdG8gYXV0aG9yaXplIHJlcXVlc3RzCiAgICAgICAgZnJvbS4KCiAgICAgICAgQHByb3BlcnR5IHNlc3Npb24KICAgICAgICBAcmVhZE9ubHkKICAgICAgICBAdHlwZSBTaW1wbGVBdXRoLlNlc3Npb24KICAgICAgICBAZGVmYXVsdCB0aGUgc2Vzc2lvbiBpbnN0YW5jZQogICAgICAqLwogICAgICBzZXNzaW9uOiBudWxsLAoKICAgICAgLyoqCiAgICAgICAgQXV0aG9yaXplcyBhbiBYSFIgcmVxdWVzdCBieSBhZGRpbmcgc29tZSBzb3J0IG9mIHNlY3JldCBpbmZvcm1hdGlvbiB0aGF0CiAgICAgICAgYWxsb3dzIHRoZSBzZXJ2ZXIgdG8gaWRlbnRpZnkgdGhlIHVzZXIgbWFraW5nIHRoZSByZXF1ZXN0IChlLmcuIGEgdG9rZW4gaW4KICAgICAgICB0aGUgYEF1dGhvcml6YXRpb25gIGhlYWRlciBvciBzb21lIG90aGVyIHNlY3JldCBpbiB0aGUgcXVlcnkgc3RyaW5nIGV0Yy4pLgoKICAgICAgICBgU2ltcGxlQXV0aC5BdXRob3JpemVycy5CYXNlYCdzIGltcGxlbWVudGF0aW9uIGRvZXMgbm90aGluZy4KCiAgICAgICAgQG1ldGhvZCBhdXRob3JpemUKICAgICAgICBAcGFyYW0ge2pxWEhSfSBqcVhIUiBUaGUgWEhSIHJlcXVlc3QgdG8gYXV0aG9yaXplIChzZWUgaHR0cDovL2FwaS5qcXVlcnkuY29tL2pRdWVyeS5hamF4LyNqcVhIUikKICAgICAgICBAcGFyYW0ge09iamVjdH0gcmVxdWVzdE9wdGlvbnMgVGhlIG9wdGlvbnMgYXMgcHJvdmlkZWQgdG8gdGhlIGAkLmFqYXhgIG1ldGhvZCAoc2VlIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9qUXVlcnkuYWpheFByZWZpbHRlci8pCiAgICAgICovCiAgICAgIGF1dGhvcml6ZTogZnVuY3Rpb24oanFYSFIsIHJlcXVlc3RPcHRpb25zKSB7CiAgICAgIH0KICAgIH0pOwogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL2NvbmZpZ3VyYXRpb24iLCAKICBbInNpbXBsZS1hdXRoL3V0aWxzL2xvYWQtY29uZmlnIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBsb2FkQ29uZmlnID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CgogICAgdmFyIGRlZmF1bHRzID0gewogICAgICBhdXRoZW50aWNhdGlvblJvdXRlOiAgICAgICAgICdsb2dpbicsCiAgICAgIHJvdXRlQWZ0ZXJBdXRoZW50aWNhdGlvbjogICAgJ2luZGV4JywKICAgICAgcm91dGVJZkFscmVhZHlBdXRoZW50aWNhdGVkOiAnaW5kZXgnLAogICAgICBzZXNzaW9uUHJvcGVydHlOYW1lOiAgICAgICAgICdzZXNzaW9uJywKICAgICAgYXV0aG9yaXplcjogICAgICAgICAgICAgICAgICBudWxsLAogICAgICBzZXNzaW9uOiAgICAgICAgICAgICAgICAgICAgICdzaW1wbGUtYXV0aC1zZXNzaW9uOm1haW4nLAogICAgICBzdG9yZTogICAgICAgICAgICAgICAgICAgICAgICdzaW1wbGUtYXV0aC1zZXNzaW9uLXN0b3JlOmxvY2FsLXN0b3JhZ2UnLAogICAgICBsb2NhbFN0b3JhZ2VLZXk6ICAgICAgICAgICAgICdlbWJlcl9zaW1wbGVfYXV0aDpzZXNzaW9uJywKICAgICAgY3Jvc3NPcmlnaW5XaGl0ZWxpc3Q6ICAgICAgICBbXSwKICAgICAgYXBwbGljYXRpb25Sb290VXJsOiAgICAgICAgICBudWxsCiAgICB9OwoKICAgIC8qKgogICAgICBFbWJlciBTaW1wbGUgQXV0aCdzIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgoKICAgICAgVG8gY2hhbmdlIGFueSBvZiB0aGVzZSB2YWx1ZXMsIHNldCB0aGVtIG9uIHRoZSBhcHBsaWNhdGlvbidzIGVudmlyb25tZW50CiAgICAgIG9iamVjdDoKCiAgICAgIGBgYGpzCiAgICAgIEVOVlsnc2ltcGxlLWF1dGgnXSA9IHsKICAgICAgICBhdXRoZW50aWNhdGlvblJvdXRlOiAnc2lnbi1pbicKICAgICAgfTsKICAgICAgYGBgCgogICAgICBAY2xhc3MgQ29uZmlndXJhdGlvbgogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGgKICAgICAgQG1vZHVsZSBzaW1wbGUtYXV0aC9jb25maWd1cmF0aW9uCiAgICAqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IHsKICAgICAgLyoqCiAgICAgICAgVGhlIHJvdXRlIHRvIHRyYW5zaXRpb24gdG8gZm9yIGF1dGhlbnRpY2F0aW9uLgoKICAgICAgICBAcHJvcGVydHkgYXV0aGVudGljYXRpb25Sb3V0ZQogICAgICAgIEByZWFkT25seQogICAgICAgIEBzdGF0aWMKICAgICAgICBAdHlwZSBTdHJpbmcKICAgICAgICBAZGVmYXVsdCAnbG9naW4nCiAgICAgICovCiAgICAgIGF1dGhlbnRpY2F0aW9uUm91dGU6IGRlZmF1bHRzLmF1dGhlbnRpY2F0aW9uUm91dGUsCgogICAgICAvKioKICAgICAgICBUaGUgcm91dGUgdG8gdHJhbnNpdGlvbiB0byBhZnRlciBzdWNjZXNzZnVsIGF1dGhlbnRpY2F0aW9uLgoKICAgICAgICBAcHJvcGVydHkgcm91dGVBZnRlckF1dGhlbnRpY2F0aW9uCiAgICAgICAgQHJlYWRPbmx5CiAgICAgICAgQHN0YXRpYwogICAgICAgIEB0eXBlIFN0cmluZwogICAgICAgIEBkZWZhdWx0ICdpbmRleCcKICAgICAgKi8KICAgICAgcm91dGVBZnRlckF1dGhlbnRpY2F0aW9uOiBkZWZhdWx0cy5yb3V0ZUFmdGVyQXV0aGVudGljYXRpb24sCgogICAgICAvKioKICAgICAgICBUaGUgcm91dGUgdG8gdHJhbnNpdGlvbiB0byBpZiBhIHJvdXRlIHRoYXQgaW1wbGVtZW50cwogICAgICAgIFtgVW5hdXRoZW50aWNhdGVkUm91dGVNaXhpbmBdKCNTaW1wbGVBdXRoLVVuYXV0aGVudGljYXRlZFJvdXRlTWl4aW4pIGlzCiAgICAgICAgYWNjZXNzZWQgd2hlbiB0aGUgc2Vzc2lvbiBpcyBhdXRoZW50aWNhdGVkLgoKICAgICAgICBAcHJvcGVydHkgcm91dGVJZkFscmVhZHlBdXRoZW50aWNhdGVkCiAgICAgICAgQHJlYWRPbmx5CiAgICAgICAgQHN0YXRpYwogICAgICAgIEB0eXBlIFN0cmluZwogICAgICAgIEBkZWZhdWx0ICdpbmRleCcKICAgICAgKi8KICAgICAgcm91dGVJZkFscmVhZHlBdXRoZW50aWNhdGVkOiBkZWZhdWx0cy5yb3V0ZUlmQWxyZWFkeUF1dGhlbnRpY2F0ZWQsCgogICAgICAvKioKICAgICAgICBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgdGhhdCB0aGUgc2Vzc2lvbiBpcyBpbmplY3RlZCB3aXRoIGludG8gcm91dGVzIGFuZAogICAgICAgIGNvbnRyb2xsZXJzLgoKICAgICAgICBAcHJvcGVydHkgc2Vzc2lvblByb3BlcnR5TmFtZQogICAgICAgIEByZWFkT25seQogICAgICAgIEBzdGF0aWMKICAgICAgICBAdHlwZSBTdHJpbmcKICAgICAgICBAZGVmYXVsdCAnc2Vzc2lvbicKICAgICAgKi8KICAgICAgc2Vzc2lvblByb3BlcnR5TmFtZTogZGVmYXVsdHMuc2Vzc2lvblByb3BlcnR5TmFtZSwKCiAgICAgIC8qKgogICAgICAgIFRoZSBhdXRob3JpemVyIGZhY3RvcnkgdG8gdXNlIGFzIGl0IGlzIHJlZ2lzdGVyZWQgd2l0aCBFbWJlcidzIGNvbnRhaW5lciwKICAgICAgICBzZWUKICAgICAgICBbRW1iZXIncyBBUEkgZG9jc10oaHR0cDovL2VtYmVyanMuY29tL2FwaS9jbGFzc2VzL0VtYmVyLkFwcGxpY2F0aW9uLmh0bWwjbWV0aG9kX3JlZ2lzdGVyKTsKICAgICAgICB3aGVuIHRoZSBhcHBsaWNhdGlvbiBkb2VzIG5vdCBpbnRlcmFjdCB3aXRoIGEgc2VydmVyIHRoYXQgcmVxdWlyZXMKICAgICAgICBhdXRob3JpemVkIHJlcXVlc3RzLCBubyBhdXp0aG9yaXplciBpcyBuZWVkZWQuCgogICAgICAgIEBwcm9wZXJ0eSBhdXRob3JpemVyCiAgICAgICAgQHJlYWRPbmx5CiAgICAgICAgQHN0YXRpYwogICAgICAgIEB0eXBlIFN0cmluZwogICAgICAgIEBkZWZhdWx0IG51bGwKICAgICAgKi8KICAgICAgYXV0aG9yaXplcjogZGVmYXVsdHMuYXV0aG9yaXplciwKCiAgICAgIC8qKgogICAgICAgIFRoZSBzZXNzaW9uIGZhY3RvcnkgdG8gdXNlIGFzIGl0IGlzIHJlZ2lzdGVyZWQgd2l0aCBFbWJlcidzIGNvbnRhaW5lciwKICAgICAgICBzZWUKICAgICAgICBbRW1iZXIncyBBUEkgZG9jc10oaHR0cDovL2VtYmVyanMuY29tL2FwaS9jbGFzc2VzL0VtYmVyLkFwcGxpY2F0aW9uLmh0bWwjbWV0aG9kX3JlZ2lzdGVyKS4KCiAgICAgICAgQHByb3BlcnR5IHNlc3Npb24KICAgICAgICBAcmVhZE9ubHkKICAgICAgICBAc3RhdGljCiAgICAgICAgQHR5cGUgU3RyaW5nCiAgICAgICAgQGRlZmF1bHQgJ3NpbXBsZS1hdXRoLXNlc3Npb246bWFpbicKICAgICAgKi8KICAgICAgc2Vzc2lvbjogZGVmYXVsdHMuc2Vzc2lvbiwKCiAgICAgIC8qKgogICAgICAgIFRoZSBzdG9yZSBmYWN0b3J5IHRvIHVzZSBhcyBpdCBpcyByZWdpc3RlcmVkIHdpdGggRW1iZXIncyBjb250YWluZXIsIHNlZQogICAgICAgIFtFbWJlcidzIEFQSSBkb2NzXShodHRwOi8vZW1iZXJqcy5jb20vYXBpL2NsYXNzZXMvRW1iZXIuQXBwbGljYXRpb24uaHRtbCNtZXRob2RfcmVnaXN0ZXIpLgoKICAgICAgICBAcHJvcGVydHkgc3RvcmUKICAgICAgICBAcmVhZE9ubHkKICAgICAgICBAc3RhdGljCiAgICAgICAgQHR5cGUgU3RyaW5nCiAgICAgICAgQGRlZmF1bHQgc2ltcGxlLWF1dGgtc2Vzc2lvbi1zdG9yZTpsb2NhbC1zdG9yYWdlCiAgICAgICovCiAgICAgIHN0b3JlOiBkZWZhdWx0cy5zdG9yZSwKCiAgICAgIC8qKgogICAgICAgIFRoZSBrZXkgdGhlIHN0b3JlIHN0b3JlcyB0aGUgZGF0YSBpbi4KCiAgICAgICAgQHByb3BlcnR5IGtleQogICAgICAgIEB0eXBlIFN0cmluZwogICAgICAgIEBkZWZhdWx0ICdlbWJlcl9zaW1wbGVfYXV0aDpzZXNzaW9uJwogICAgICAqLwogICAgICBsb2NhbFN0b3JhZ2VLZXk6IGRlZmF1bHRzLmxvY2FsU3RvcmFnZUtleSwKCiAgICAgIC8qKgogICAgICAgIEVtYmVyIFNpbXBsZSBBdXRoIHdpbGwgbmV2ZXIgYXV0aG9yaXplIHJlcXVlc3RzIGdvaW5nIHRvIGEgZGlmZmVyZW50IG9yaWdpbgogICAgICAgIHRoYW4gdGhlIG9uZSB0aGUgRW1iZXIuanMgYXBwbGljYXRpb24gd2FzIGxvYWRlZCBmcm9tOyB0byBleHBsaWNpdGVseQogICAgICAgIGVuYWJsZSBhdXRob3JpemF0aW9uIGZvciBhZGRpdGlvbmFsIG9yaWdpbnMsIHdoaXRlbGlzdCB0aG9zZSBvcmlnaW5zIHdpdGgKICAgICAgICB0aGlzIHNldHRpbmcuIF9CZXdhcmUgdGhhdCBvcmlnaW5zIGNvbnNpc3Qgb2YgcHJvdG9jb2wsIGhvc3QgYW5kIHBvcnQgKHBvcnQKICAgICAgICBjYW4gYmUgbGVmdCBvdXQgd2hlbiBpdCBpcyA4MCBmb3IgSFRUUCBvciA0NDMgZm9yIEhUVFBTKV8KCiAgICAgICAgQHByb3BlcnR5IGNyb3NzT3JpZ2luV2hpdGVsaXN0CiAgICAgICAgQHJlYWRPbmx5CiAgICAgICAgQHN0YXRpYwogICAgICAgIEB0eXBlIEFycmF5CiAgICAgICAgQGRlZmF1bHQgW10KICAgICAgKi8KICAgICAgY3Jvc3NPcmlnaW5XaGl0ZWxpc3Q6IGRlZmF1bHRzLmNyb3NzT3JpZ2luV2hpdGVsaXN0LAoKICAgICAgLyoqCiAgICAgICAgQHByb3BlcnR5IGFwcGxpY2F0aW9uUm9vdFVybAogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIGFwcGxpY2F0aW9uUm9vdFVybDogZGVmYXVsdHMuYXBwbGljYXRpb25Sb290VXJsLAoKICAgICAgLyoqCiAgICAgICAgQG1ldGhvZCBsb2FkCiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgbG9hZDogbG9hZENvbmZpZyhkZWZhdWx0cywgZnVuY3Rpb24oY29udGFpbmVyLCBjb25maWcpIHsKICAgICAgICB0aGlzLmFwcGxpY2F0aW9uUm9vdFVybCA9IGNvbnRhaW5lci5sb29rdXAoJ3JvdXRlcjptYWluJykuZ2V0KCdyb290VVJMJykgfHwgJy8nOwogICAgICB9KQogICAgfTsKICB9KTsKZGVmaW5lKCJzaW1wbGUtYXV0aC9lbWJlciIsIAogIFsiLi9pbml0aWFsaXplciJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIGluaXRpYWxpemVyID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CgogICAgRW1iZXIub25Mb2FkKCdFbWJlci5BcHBsaWNhdGlvbicsIGZ1bmN0aW9uKEFwcGxpY2F0aW9uKSB7CiAgICAgIEFwcGxpY2F0aW9uLmluaXRpYWxpemVyKGluaXRpYWxpemVyKTsKICAgIH0pOwogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL2luaXRpYWxpemVyIiwgCiAgWyIuL2NvbmZpZ3VyYXRpb24iLCIuL3V0aWxzL2dldC1nbG9iYWwtY29uZmlnIiwiLi9zZXR1cCIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZGVwZW5kZW5jeTJfXywgX19kZXBlbmRlbmN5M19fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIENvbmZpZ3VyYXRpb24gPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKICAgIHZhciBnZXRHbG9iYWxDb25maWcgPSBfX2RlcGVuZGVuY3kyX19bImRlZmF1bHQiXTsKICAgIHZhciBzZXR1cCA9IF9fZGVwZW5kZW5jeTNfX1siZGVmYXVsdCJdOwoKICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSB7CiAgICAgIG5hbWU6ICAgICAgICdzaW1wbGUtYXV0aCcsCiAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGNvbnRhaW5lciwgYXBwbGljYXRpb24pIHsKICAgICAgICB2YXIgY29uZmlnID0gZ2V0R2xvYmFsQ29uZmlnKCdzaW1wbGUtYXV0aCcpOwogICAgICAgIENvbmZpZ3VyYXRpb24ubG9hZChjb250YWluZXIsIGNvbmZpZyk7CiAgICAgICAgc2V0dXAoY29udGFpbmVyLCBhcHBsaWNhdGlvbik7CiAgICAgIH0KICAgIH07CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvbWl4aW5zL2FwcGxpY2F0aW9uLXJvdXRlLW1peGluIiwgCiAgWyIuLy4uL2NvbmZpZ3VyYXRpb24iLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIENvbmZpZ3VyYXRpb24gPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKCiAgICAvKioKICAgICAgVGhlIG1peGluIGZvciB0aGUgYXBwbGljYXRpb24gcm91dGU7IGRlZmluZXMgYWN0aW9ucyB0byBhdXRoZW50aWNhdGUgdGhlCiAgICAgIHNlc3Npb24gYXMgd2VsbCBhcyB0byBpbnZhbGlkYXRlIGl0LiBUaGVzZSBhY3Rpb25zIGNhbiBiZSB1c2VkIGluIGFsbAogICAgICB0ZW1wbGF0ZXMgbGlrZSB0aGlzOgoKICAgICAgYGBgaGFuZGxlYmFycwogICAgICB7eyNpZiBzZXNzaW9uLmlzQXV0aGVudGljYXRlZH19CiAgICAgICAgPGEge3sgYWN0aW9uICdpbnZhbGlkYXRlU2Vzc2lvbicgfX0+TG9nb3V0PC9hPgogICAgICB7e2Vsc2V9fQogICAgICAgIDxhIHt7IGFjdGlvbiAnYXV0aGVudGljYXRlU2Vzc2lvbicgfX0+TG9naW48L2E+CiAgICAgIHt7L2lmfX0KICAgICAgYGBgCgogICAgICBvciBpbiB0aGUgY2FzZSB0aGF0IHRoZSBhcHBsaWNhdGlvbiB1c2VzIGEgZGVkaWNhdGVkIHJvdXRlIGZvciBsb2dnaW5nIGluOgoKICAgICAgYGBgaGFuZGxlYmFycwogICAgICB7eyNpZiBzZXNzaW9uLmlzQXV0aGVudGljYXRlZH19CiAgICAgICAgPGEge3sgYWN0aW9uICdpbnZhbGlkYXRlU2Vzc2lvbicgfX0+TG9nb3V0PC9hPgogICAgICB7e2Vsc2V9fQogICAgICAgIHt7I2xpbmstdG8gJ2xvZ2luJ319TG9naW57ey9saW5rLXRvfX0KICAgICAge3svaWZ9fQogICAgICBgYGAKCiAgICAgIFRoaXMgbWl4aW4gYWxzbyBkZWZpbmVzIGFjdGlvbnMgdGhhdCBhcmUgdHJpZ2dlcmVkIHdoZW5ldmVyIHRoZSBzZXNzaW9uIGlzCiAgICAgIHN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkIG9yIGludmFsaWRhdGVkIGFuZCB3aGVuZXZlciBhdXRoZW50aWNhdGlvbiBvcgogICAgICBpbnZhbGlkYXRpb24gZmFpbHMuIFRoZXNlIGFjdGlvbnMgcHJvdmlkZSBhIGdvb2Qgc3RhcnRpbmcgcG9pbnQgZm9yIGFkZGluZwogICAgICBjdXN0b20gYmVoYXZpb3IgdG8gdGhlc2UgZXZlbnRzLgoKICAgICAgX19XaGVuIHRoaXMgbWl4aW4gaXMgdXNlZCBhbmQgdGhlIGFwcGxpY2F0aW9uJ3MgYEFwcGxpY2F0aW9uUm91dGVgIGRlZmluZXMKICAgICAgdGhlIGBiZWZvcmVNb2RlbGAgbWV0aG9kLCB0aGF0IG1ldGhvZCBoYXMgdG8gY2FsbCBgX3N1cGVyYC5fXwoKICAgICAgVXNpbmcgdGhpcyBtaXhpbiBpcyBvcHRpb25hbC4gV2l0aG91dCB1c2luZyBpdCwgdGhlIHNlc3Npb24ncyBldmVudHMgd2lsbCBub3QKICAgICAgYmUgYXV0b21hdGljYWxseSB0cmFuc2xhdGVkIGludG8gcm91dGUgYWN0aW9ucyBidXQgd291bGQgaGF2ZSB0byBiZSBoYW5kbGVkCiAgICAgIGluaWRpdmlhbGx5LCBlLmcuIGluIGFuIGluaXRpYWxpemVyOgoKICAgICAgYGBganMKICAgICAgRW1iZXIuQXBwbGljYXRpb24uaW5pdGlhbGl6ZXIoewogICAgICAgIG5hbWU6ICAgICAgICdhdXRoZW50aWNhdGlvbicsCiAgICAgICAgYWZ0ZXI6ICAgICAgJ3NpbXBsZS1hdXRoJywKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbihjb250YWluZXIsIGFwcGxpY2F0aW9uKSB7CiAgICAgICAgICB2YXIgYXBwbGljYXRpb25Sb3V0ZSA9IGNvbnRhaW5lci5sb29rdXAoJ3JvdXRlOmFwcGxpY2F0aW9uJyk7CiAgICAgICAgICB2YXIgc2Vzc2lvbiAgICAgICAgICA9IGNvbnRhaW5lci5sb29rdXAoJ3NpbXBsZS1hdXRoLXNlc3Npb246bWFpbicpOwogICAgICAgICAgLy8gaGFuZGxlIHRoZSBzZXNzaW9uIGV2ZW50cwogICAgICAgICAgc2Vzc2lvbi5vbignc2Vzc2lvbkF1dGhlbnRpY2F0aW9uU3VjY2VlZGVkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGFwcGxpY2F0aW9uUm91dGUudHJhbnNpdGlvblRvKCdpbmRleCcpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgYGBgCgogICAgICBAY2xhc3MgQXBwbGljYXRpb25Sb3V0ZU1peGluCiAgICAgIEBuYW1lc3BhY2UgU2ltcGxlQXV0aAogICAgICBAbW9kdWxlIHNpbXBsZS1hdXRoL21peGlucy9hcHBsaWNhdGlvbi1yb3V0ZS1taXhpbgogICAgICBAZXh0ZW5kcyBFbWJlci5NaXhpbgogICAgICBAc3RhdGljCiAgICAqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IEVtYmVyLk1peGluLmNyZWF0ZSh7CiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgYmVmb3JlTW9kZWwKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICBiZWZvcmVNb2RlbDogZnVuY3Rpb24odHJhbnNpdGlvbikgewogICAgICAgIHRoaXMuX3N1cGVyKHRyYW5zaXRpb24pOwogICAgICAgIGlmICghdGhpcy5nZXQoJ19hdXRoRXZlbnRMaXN0ZW5lcnNBc3NpZ25lZCcpKSB7CiAgICAgICAgICB0aGlzLnNldCgnX2F1dGhFdmVudExpc3RlbmVyc0Fzc2lnbmVkJywgdHJ1ZSk7CiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgRW1iZXIuQShbCiAgICAgICAgICAgICdzZXNzaW9uQXV0aGVudGljYXRpb25TdWNjZWVkZWQnLAogICAgICAgICAgICAnc2Vzc2lvbkF1dGhlbnRpY2F0aW9uRmFpbGVkJywKICAgICAgICAgICAgJ3Nlc3Npb25JbnZhbGlkYXRpb25TdWNjZWVkZWQnLAogICAgICAgICAgICAnc2Vzc2lvbkludmFsaWRhdGlvbkZhaWxlZCcsCiAgICAgICAgICAgICdhdXRob3JpemF0aW9uRmFpbGVkJwogICAgICAgICAgXSkuZm9yRWFjaChmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICBfdGhpcy5nZXQoQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lKS5vbihldmVudCwgZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUudW5zaGlmdC5jYWxsKGFyZ3VtZW50cywgZXZlbnQpOwogICAgICAgICAgICAgIHRyYW5zaXRpb24uc2VuZC5hcHBseSh0cmFuc2l0aW9uLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGFjdGlvbnM6IHsKICAgICAgICAvKioKICAgICAgICAgIFRoaXMgYWN0aW9uIHRyaWdnZXJzIHRyYW5zaXRpb24gdG8gdGhlCiAgICAgICAgICBbYENvbmZpZ3VyYXRpb24uYXV0aGVudGljYXRpb25Sb3V0ZWBdKCNTaW1wbGVBdXRoLUNvbmZpZ3VyYXRpb24tYXV0aGVudGljYXRpb25Sb3V0ZSkuCiAgICAgICAgICBJdCBjYW4gYmUgdXNlZCBpbiB0ZW1wbGF0ZXMgYXMgc2hvd24gYWJvdmUuIEl0IGlzIGFsc28gdHJpZ2dlcmVkCiAgICAgICAgICBhdXRvbWF0aWNhbGx5IGJ5IHRoZQogICAgICAgICAgW2BBdXRoZW50aWNhdGVkUm91dGVNaXhpbmBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluKSB3aGVuZXZlcgogICAgICAgICAgYSByb3V0ZSB0aGF0IHJlcXVyaWVzIGF1dGhlbnRpY2F0aW9uIGlzIGFjY2Vzc2VkIGJ1dCB0aGUgc2Vzc2lvbiBpcyBub3QKICAgICAgICAgIGN1cnJlbnRseSBhdXRoZW50aWNhdGVkLgoKICAgICAgICAgIF9fRm9yIGFuIGFwcGxpY2F0aW9uIHRoYXQgd29ya3Mgd2l0aG91dCBhbiBhdXRoZW50aWNhdGlvbiByb3V0ZSAoZS5nLgogICAgICAgICAgYmVjYXVzZSBpdCBvcGVucyBhIG5ldyB3aW5kb3cgdG8gaGFuZGxlIGF1dGhlbnRpY2F0aW9uIHRoZXJlKSwgdGhpcyBpcwogICAgICAgICAgdGhlIGFjdGlvbiB0byBvdmVycmlkZSwgZS5nLjpfXwoKICAgICAgICAgIGBgYGpzCiAgICAgICAgICBBcHAuQXBwbGljYXRpb25Sb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZChTaW1wbGVBdXRoLkFwcGxpY2F0aW9uUm91dGVNaXhpbiwgewogICAgICAgICAgICBhY3Rpb25zOiB7CiAgICAgICAgICAgICAgYXV0aGVudGljYXRlU2Vzc2lvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLmdldCgnc2Vzc2lvbicpLmF1dGhlbnRpY2F0ZSgnYXV0aGVudGljYXRvcjpjdXN0b20nLCB7fSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGBgYAoKICAgICAgICAgIEBtZXRob2QgYWN0aW9ucy5hdXRoZW50aWNhdGVTZXNzaW9uCiAgICAgICAgKi8KICAgICAgICBhdXRoZW50aWNhdGVTZXNzaW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvKENvbmZpZ3VyYXRpb24uYXV0aGVudGljYXRpb25Sb3V0ZSk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICBUaGlzIGFjdGlvbiBpcyB0cmlnZ2VyZWQgd2hlbmV2ZXIgdGhlIHNlc3Npb24gaXMgc3VjY2Vzc2Z1bGx5CiAgICAgICAgICBhdXRoZW50aWNhdGVkLiBJZiB0aGVyZSBpcyBhIHRyYW5zaXRpb24gdGhhdCB3YXMgcHJldmlvdXNseSBpbnRlcmNlcHRlZAogICAgICAgICAgYnkKICAgICAgICAgIFtgQXV0aGVudGljYXRlZFJvdXRlTWl4aW4jYmVmb3JlTW9kZWxgXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdGVkUm91dGVNaXhpbi1iZWZvcmVNb2RlbCkKICAgICAgICAgIGl0IHdpbGwgcmV0cnkgaXQuIElmIHRoZXJlIGlzIG5vIHN1Y2ggdHJhbnNpdGlvbiwgdGhpcyBhY3Rpb24gdHJhbnNpdGlvbnMKICAgICAgICAgIHRvIHRoZQogICAgICAgICAgW2BDb25maWd1cmF0aW9uLnJvdXRlQWZ0ZXJBdXRoZW50aWNhdGlvbmBdKCNTaW1wbGVBdXRoLUNvbmZpZ3VyYXRpb24tcm91dGVBZnRlckF1dGhlbnRpY2F0aW9uKS4KCiAgICAgICAgICBAbWV0aG9kIGFjdGlvbnMuc2Vzc2lvbkF1dGhlbnRpY2F0aW9uU3VjY2VlZGVkCiAgICAgICAgKi8KICAgICAgICBzZXNzaW9uQXV0aGVudGljYXRpb25TdWNjZWVkZWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGF0dGVtcHRlZFRyYW5zaXRpb24gPSB0aGlzLmdldChDb25maWd1cmF0aW9uLnNlc3Npb25Qcm9wZXJ0eU5hbWUpLmdldCgnYXR0ZW1wdGVkVHJhbnNpdGlvbicpOwogICAgICAgICAgaWYgKGF0dGVtcHRlZFRyYW5zaXRpb24pIHsKICAgICAgICAgICAgYXR0ZW1wdGVkVHJhbnNpdGlvbi5yZXRyeSgpOwogICAgICAgICAgICB0aGlzLmdldChDb25maWd1cmF0aW9uLnNlc3Npb25Qcm9wZXJ0eU5hbWUpLnNldCgnYXR0ZW1wdGVkVHJhbnNpdGlvbicsIG51bGwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uVG8oQ29uZmlndXJhdGlvbi5yb3V0ZUFmdGVyQXV0aGVudGljYXRpb24pOwogICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAgVGhpcyBhY3Rpb24gaXMgdHJpZ2dlcmVkIHdoZW5ldmVyIHNlc3Npb24gYXV0aGVudGljYXRpb24gZmFpbHMuIFRoZQogICAgICAgICAgYGVycm9yYCBhcmd1bWVudCBpcyB0aGUgZXJyb3Igb2JqZWN0IHRoYXQgdGhlIHByb21pc2UgdGhlIGF1dGhlbnRpY2F0b3IKICAgICAgICAgIHJldHVybnMgcmVqZWN0cyB3aXRoLiAoc2VlCiAgICAgICAgICBbYEF1dGhlbnRpY2F0b3JzLkJhc2UjYXV0aGVudGljYXRlYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZS1hdXRoZW50aWNhdGUpKS4KCiAgICAgICAgICBJdCBjYW4gYmUgb3ZlcnJpZGRlbiB0byBkaXNwbGF5IGVycm9yIG1lc3NhZ2VzIGV0Yy46CgogICAgICAgICAgYGBganMKICAgICAgICAgIEFwcC5BcHBsaWNhdGlvblJvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKFNpbXBsZUF1dGguQXBwbGljYXRpb25Sb3V0ZU1peGluLCB7CiAgICAgICAgICAgIGFjdGlvbnM6IHsKICAgICAgICAgICAgICBzZXNzaW9uQXV0aGVudGljYXRpb25GYWlsZWQ6IGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXJGb3IoJ2FwcGxpY2F0aW9uJykuc2V0KCdsb2dpbkVycm9yTWVzc2FnZScsIGVycm9yLm1lc3NhZ2UpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBgYGAKCiAgICAgICAgICBAbWV0aG9kIGFjdGlvbnMuc2Vzc2lvbkF1dGhlbnRpY2F0aW9uRmFpbGVkCiAgICAgICAgICBAcGFyYW0ge2FueX0gZXJyb3IgVGhlIGVycm9yIHRoZSBwcm9taXNlIHJldHVybmVkIGJ5IHRoZSBhdXRoZW50aWNhdG9yIHJlamVjdHMgd2l0aCwgc2VlIFtgQXV0aGVudGljYXRvcnMuQmFzZSNhdXRoZW50aWNhdGVgXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdG9ycy1CYXNlLWF1dGhlbnRpY2F0ZSkKICAgICAgICAqLwogICAgICAgIHNlc3Npb25BdXRoZW50aWNhdGlvbkZhaWxlZDogZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgIFRoaXMgYWN0aW9uIGludmFsaWRhdGVzIHRoZSBzZXNzaW9uIChzZWUKICAgICAgICAgIFtgU2Vzc2lvbiNpbnZhbGlkYXRlYF0oI1NpbXBsZUF1dGgtU2Vzc2lvbi1pbnZhbGlkYXRlKSkuCiAgICAgICAgICBJZiBpbnZhbGlkYXRpb24gc3VjY2VlZHMsIGl0IHJlbG9hZHMgdGhlIGFwcGxpY2F0aW9uIChzZWUKICAgICAgICAgIFtgQXBwbGljYXRpb25Sb3V0ZU1peGluI3Nlc3Npb25JbnZhbGlkYXRpb25TdWNjZWVkZWRgXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4tc2Vzc2lvbkludmFsaWRhdGlvblN1Y2NlZWRlZCkpLgoKICAgICAgICAgIEBtZXRob2QgYWN0aW9ucy5pbnZhbGlkYXRlU2Vzc2lvbgogICAgICAgICovCiAgICAgICAgaW52YWxpZGF0ZVNlc3Npb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy5nZXQoQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lKS5pbnZhbGlkYXRlKCk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICBUaGlzIGFjdGlvbiBpcyBpbnZva2VkIHdoZW5ldmVyIHRoZSBzZXNzaW9uIGlzIHN1Y2Nlc3NmdWxseSBpbnZhbGlkYXRlZC4KICAgICAgICAgIEl0IHJlbG9hZHMgdGhlIEVtYmVyLmpzIGFwcGxpY2F0aW9uIGJ5IHJlZGlyZWN0aW5nIHRoZSBicm93c2VyIHRvIHRoZQogICAgICAgICAgYXBwbGljYXRpb24ncyByb290IFVSTCBzbyB0aGF0IGFsbCBpbi1tZW1vcnkgZGF0YSAoc3VjaCBhcyBFbWJlciBEYXRhCiAgICAgICAgICBzdG9yZXMgZXRjLikgZ2V0cyBjbGVhcmVkLiBUaGUgcm9vdCBVUkwgaXMgYXV0b21hdGljYWxseSByZXRyaWV2ZWQgZnJvbQogICAgICAgICAgdGhlIEVtYmVyLmpzIGFwcGxpY2F0aW9uJ3Mgcm91dGVyIChzZWUKICAgICAgICAgIGh0dHA6Ly9lbWJlcmpzLmNvbS9ndWlkZXMvcm91dGluZy8jdG9jX3NwZWNpZnlpbmctYS1yb290LXVybCkuCgogICAgICAgICAgSWYgeW91ciBFbWJlci5qcyBhcHBsaWNhdGlvbiB3aWxsIGJlIHVzZWQgaW4gYW4gZW52aXJvbm1lbnQgd2hlcmUgdGhlCiAgICAgICAgICB1c2VycyBkb24ndCBoYXZlIGRpcmVjdCBhY2Nlc3MgdG8gYW55IGRhdGEgc3RvcmVkIG9uIHRoZSBjbGllbnQgKGUuZy4KICAgICAgICAgIFtjb3Jkb3ZhXShodHRwOi8vY29yZG92YS5hcGFjaGUub3JnKSkgdGhpcyBhY3Rpb24gY2FuIGJlIG92ZXJyaWRkZW4gdG8KICAgICAgICAgIHNpbXBseSB0cmFuc2l0aW9uIHRvIHRoZSBgJ2luZGV4J2Agcm91dGUuCgogICAgICAgICAgQG1ldGhvZCBhY3Rpb25zLnNlc3Npb25JbnZhbGlkYXRpb25TdWNjZWVkZWQKICAgICAgICAqLwogICAgICAgIHNlc3Npb25JbnZhbGlkYXRpb25TdWNjZWVkZWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCFFbWJlci50ZXN0aW5nKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKENvbmZpZ3VyYXRpb24uYXBwbGljYXRpb25Sb290VXJsKTsKICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgIFRoaXMgYWN0aW9uIGlzIGludm9rZWQgd2hlbmV2ZXIgc2Vzc2lvbiBpbnZhbGlkYXRpb24gZmFpbHMuIFRoaXMgbWFpbmx5CiAgICAgICAgICBzZXJ2ZXMgYXMgYW4gZXh0ZW5zaW9uIHBvaW50IHRvIGFkZCBjdXN0b20gYmVoYXZpb3IgYW5kIGRvZXMgbm90aGluZyBieQogICAgICAgICAgZGVmYXVsdC4KCiAgICAgICAgICBAbWV0aG9kIGFjdGlvbnMuc2Vzc2lvbkludmFsaWRhdGlvbkZhaWxlZAogICAgICAgICAgQHBhcmFtIHthbnl9IGVycm9yIFRoZSBlcnJvciB0aGUgcHJvbWlzZSByZXR1cm5lZCBieSB0aGUgYXV0aGVudGljYXRvciByZWplY3RzIHdpdGgsIHNlZSBbYEF1dGhlbnRpY2F0b3JzLkJhc2UjaW52YWxpZGF0ZWBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UtaW52YWxpZGF0ZSkKICAgICAgICAqLwogICAgICAgIHNlc3Npb25JbnZhbGlkYXRpb25GYWlsZWQ6IGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICBUaGlzIGFjdGlvbiBpcyBpbnZva2VkIHdoZW4gYW4gYXV0aG9yaXphdGlvbiBlcnJvciBvY2N1cnMgKHdoaWNoIGlzCiAgICAgICAgICB0aGUgY2FzZSBfX3doZW4gdGhlIHNlcnZlciByZXNwb25kcyB3aXRoIEhUVFAgc3RhdHVzIDQwMV9fKS4gSXQKICAgICAgICAgIGludmFsaWRhdGVzIHRoZSBzZXNzaW9uIGFuZCByZWxvYWRzIHRoZSBhcHBsaWNhdGlvbiAoc2VlCiAgICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbiNzZXNzaW9uSW52YWxpZGF0aW9uU3VjY2VlZGVkYF0oI1NpbXBsZUF1dGgtQXBwbGljYXRpb25Sb3V0ZU1peGluLXNlc3Npb25JbnZhbGlkYXRpb25TdWNjZWVkZWQpKS4KCiAgICAgICAgICBAbWV0aG9kIGFjdGlvbnMuYXV0aG9yaXphdGlvbkZhaWxlZAogICAgICAgICovCiAgICAgICAgYXV0aG9yaXphdGlvbkZhaWxlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAodGhpcy5nZXQoQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lKS5nZXQoJ2lzQXV0aGVudGljYXRlZCcpKSB7CiAgICAgICAgICAgIHRoaXMuZ2V0KENvbmZpZ3VyYXRpb24uc2Vzc2lvblByb3BlcnR5TmFtZSkuaW52YWxpZGF0ZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvbWl4aW5zL2F1dGhlbnRpY2F0ZWQtcm91dGUtbWl4aW4iLCAKICBbIi4vLi4vY29uZmlndXJhdGlvbiIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgQ29uZmlndXJhdGlvbiA9IF9fZGVwZW5kZW5jeTFfX1siZGVmYXVsdCJdOwoKICAgIC8qKgogICAgICBUaGlzIG1peGluIGlzIGZvciByb3V0ZXMgdGhhdCByZXF1aXJlIHRoZSBzZXNzaW9uIHRvIGJlIGF1dGhlbnRpY2F0ZWQgdG8gYmUKICAgICAgYWNjZXNzaWJsZS4gSW5jbHVkaW5nIHRoaXMgbWl4aW4gaW4gYSByb3V0ZSBhdXRvbWF0aWNhbGx5IGFkZHMgYSBob29rIHRoYXQKICAgICAgZW5mb3JjZXMgdGhlIHNlc3Npb24gdG8gYmUgYXV0aGVudGljYXRlZCBhbmQgcmVkaXJlY3RzIHRvIHRoZQogICAgICBbYENvbmZpZ3VyYXRpb24uYXV0aGVudGljYXRpb25Sb3V0ZWBdKCNTaW1wbGVBdXRoLUNvbmZpZ3VyYXRpb24tYXV0aGVudGljYXRpb25Sb3V0ZSkKICAgICAgaWYgaXQgaXMgbm90LgoKICAgICAgYGBganMKICAgICAgLy8gYXBwL3JvdXRlcy9wcm90ZWN0ZWQuanMKICAgICAgaW1wb3J0IEF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluIGZyb20gJ3NpbXBsZS1hdXRoL21peGlucy9hdXRoZW50aWNhdGVkLXJvdXRlLW1peGluJzsKCiAgICAgIGV4cG9ydCBkZWZhdWx0IEVtYmVyLlJvdXRlLmV4dGVuZChBdXRoZW50aWNhdGVkUm91dGVNaXhpbik7CiAgICAgIGBgYAoKICAgICAgYEF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluYCBwZXJmb3JtcyB0aGUgcmVkaXJlY3QgaW4gdGhlIGBiZWZvcmVNb2RlbGAgbWV0aG9kCiAgICAgIHNvIHRoYXQgaW4gYWxsIG1ldGhvZHMgZXhlY3V0ZWQgYWZ0ZXIgdGhhdCB0aGUgc2Vzc2lvbiBpcyBndWFyYW50ZWVkIHRvIGJlCiAgICAgIGF1dGhlbnRpY2F0ZWQuIF9fSWYgYGJlZm9yZU1vZGVsYCBpcyBvdmVycmlkZGVuLCBlbnN1cmUgdGhhdCB0aGUgY3VzdG9tCiAgICAgIGltcGxlbWVudGF0aW9uIGNhbGxzIGB0aGlzLl9zdXBlcih0cmFuc2l0aW9uKWBfXyBzbyB0aGF0IHRoZSBzZXNzaW9uCiAgICAgIGVuZm9yY2VtZW50IGNvZGUgaXMgYWN0dWFsbHkgZXhlY3V0ZWQuCgogICAgICBAY2xhc3MgQXV0aGVudGljYXRlZFJvdXRlTWl4aW4KICAgICAgQG5hbWVzcGFjZSBTaW1wbGVBdXRoCiAgICAgIEBtb2R1bGUgc2ltcGxlLWF1dGgvbWl4aW5zL2F1dGhlbnRpY2F0ZWQtcm91dGUtbWl4aW4KICAgICAgQGV4dGVuZHMgRW1iZXIuTWl4aW4KICAgICAgQHN0YXRpYwogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBFbWJlci5NaXhpbi5jcmVhdGUoewogICAgICAvKioKICAgICAgICBUaGlzIG1ldGhvZCBpbXBsZW1lbnRzIHRoZSBlbmZvcmNlbWVudCBvZiB0aGUgc2Vzc2lvbiBiZWluZyBhdXRoZW50aWNhdGVkLgogICAgICAgIElmIHRoZSBzZXNzaW9uIGlzIG5vdCBhdXRoZW50aWNhdGVkLCB0aGUgY3VycmVudCB0cmFuc2l0aW9uIHdpbGwgYmUgYWJvcnRlZAogICAgICAgIGFuZCBhIHJlZGlyZWN0IHdpbGwgYmUgdHJpZ2dlcmVkIHRvIHRoZQogICAgICAgIFtgQ29uZmlndXJhdGlvbi5hdXRoZW50aWNhdGlvblJvdXRlYF0oI1NpbXBsZUF1dGgtQ29uZmlndXJhdGlvbi1hdXRoZW50aWNhdGlvblJvdXRlKS4KICAgICAgICBUaGUgbWV0aG9kIGFsc28gc2F2ZXMgdGhlIGludGVyY2VwdGVkIHRyYW5zaXRpb24gc28gdGhhdCBpdCBjYW4gYmUgcmV0cmllZAogICAgICAgIGFmdGVyIHRoZSBzZXNzaW9uIGhhcyBiZWVuIGF1dGhlbnRpY2F0ZWQgKHNlZQogICAgICAgIFtgQXBwbGljYXRpb25Sb3V0ZU1peGluI3Nlc3Npb25BdXRoZW50aWNhdGlvblN1Y2NlZWRlZGBdKCNTaW1wbGVBdXRoLUFwcGxpY2F0aW9uUm91dGVNaXhpbi1zZXNzaW9uQXV0aGVudGljYXRpb25TdWNjZWVkZWQpKS4KCiAgICAgICAgQG1ldGhvZCBiZWZvcmVNb2RlbAogICAgICAgIEBwYXJhbSB7VHJhbnNpdGlvbn0gdHJhbnNpdGlvbiBUaGUgdHJhbnNpdGlvbiB0aGF0IGxlYWQgdG8gdGhpcyByb3V0ZQogICAgICAqLwogICAgICBiZWZvcmVNb2RlbDogZnVuY3Rpb24odHJhbnNpdGlvbikgewogICAgICAgIHRoaXMuX3N1cGVyKHRyYW5zaXRpb24pOwogICAgICAgIGlmICghdGhpcy5nZXQoQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lKS5nZXQoJ2lzQXV0aGVudGljYXRlZCcpKSB7CiAgICAgICAgICB0cmFuc2l0aW9uLmFib3J0KCk7CiAgICAgICAgICB0aGlzLmdldChDb25maWd1cmF0aW9uLnNlc3Npb25Qcm9wZXJ0eU5hbWUpLnNldCgnYXR0ZW1wdGVkVHJhbnNpdGlvbicsIHRyYW5zaXRpb24pOwogICAgICAgICAgRW1iZXIuYXNzZXJ0KCdUaGUgcm91dGUgY29uZmlndXJlZCBhcyBDb25maWd1cmF0aW9uLmF1dGhlbnRpY2F0aW9uUm91dGUgY2Fubm90IGltcGxlbWVudCB0aGUgQXV0aGVudGljYXRlZFJvdXRlTWl4aW4gbWl4aW4gYXMgdGhhdCBsZWFkcyB0byBhbiBpbmZpbml0ZSB0cmFuc2l0aW9uaW5nIGxvb3AuJywgdGhpcy5nZXQoJ3JvdXRlTmFtZScpICE9PSBDb25maWd1cmF0aW9uLmF1dGhlbnRpY2F0aW9uUm91dGUpOwogICAgICAgICAgdHJhbnNpdGlvbi5zZW5kKCdhdXRoZW50aWNhdGVTZXNzaW9uJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9KTsKZGVmaW5lKCJzaW1wbGUtYXV0aC9taXhpbnMvYXV0aGVudGljYXRpb24tY29udHJvbGxlci1taXhpbiIsIAogIFsiLi8uLi9jb25maWd1cmF0aW9uIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBDb25maWd1cmF0aW9uID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CgogICAgLyoqCiAgICAgIFRoaXMgbWl4aW4gaXMgZm9yIHRoZSBjb250cm9sbGVyIHRoYXQgaGFuZGxlcyB0aGUKICAgICAgW2BDb25maWd1cmF0aW9uLmF1dGhlbnRpY2F0aW9uUm91dGVgXSgjU2ltcGxlQXV0aC1Db25maWd1cmF0aW9uLWF1dGhlbnRpY2F0aW9uUm91dGUpLgogICAgICBJdCBwcm92aWRlcyB0aGUgYGF1dGhlbnRpY2F0ZWAgYWN0aW9uIHRoYXQgd2lsbCBhdXRoZW50aWNhdGUgdGhlIHNlc3Npb24gd2l0aAogICAgICB0aGUgY29uZmlndXJlZCBhdXRoZW50aWNhdG9yIChzZWUKICAgICAgW2BBdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbiNhdXRoZW50aWNhdG9yYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4tYXV0aGVudGljYXRvcikpLgoKICAgICAgQGNsYXNzIEF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluCiAgICAgIEBuYW1lc3BhY2UgU2ltcGxlQXV0aAogICAgICBAbW9kdWxlIHNpbXBsZS1hdXRoL21peGlucy9hdXRoZW50aWNhdGlvbi1jb250cm9sbGVyLW1peGluCiAgICAgIEBleHRlbmRzIEVtYmVyLk1peGluCiAgICAqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IEVtYmVyLk1peGluLmNyZWF0ZSh7CiAgICAgIC8qKgogICAgICAgIFRoZSBhdXRoZW50aWNhdG9yIGZhY3RvcnkgdG8gdXNlIGFzIGl0IGlzIHJlZ2lzdGVyZWQgd2l0aCBFbWJlcidzCiAgICAgICAgY29udGFpbmVyLCBzZWUKICAgICAgICBbRW1iZXIncyBBUEkgZG9jc10oaHR0cDovL2VtYmVyanMuY29tL2FwaS9jbGFzc2VzL0VtYmVyLkFwcGxpY2F0aW9uLmh0bWwjbWV0aG9kX3JlZ2lzdGVyKS4KCiAgICAgICAgQHByb3BlcnR5IGF1dGhlbnRpY2F0b3IKICAgICAgICBAdHlwZSBTdHJpbmcKICAgICAgICBAZGVmYXVsdCBudWxsCiAgICAgICovCiAgICAgIGF1dGhlbnRpY2F0b3I6IG51bGwsCgogICAgICBhY3Rpb25zOiB7CiAgICAgICAgLyoqCiAgICAgICAgICBUaGlzIGFjdGlvbiB3aWxsIGF1dGhlbnRpY2F0ZSB0aGUgc2Vzc2lvbiB3aXRoIHRoZSBjb25maWd1cmVkCiAgICAgICAgICBhdXRoZW50aWNhdG9yIChzZWUKICAgICAgICAgIFtgQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4jYXV0aGVudGljYXRvcmBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluLWF1dGhlbnRpY2F0b3IpLAogICAgICAgICAgW2BTZXNzaW9uI2F1dGhlbnRpY2F0ZWBdKCNTaW1wbGVBdXRoLVNlc3Npb24tYXV0aGVudGljYXRlKSkuCgogICAgICAgICAgQG1ldGhvZCBhY3Rpb25zLmF1dGhlbnRpY2F0ZQogICAgICAgICAgQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgQW55IG9wdGlvbnMgdGhlIGF1dGhlbnRpY2F0b3IgbmVlZHMgdG8gYXV0aGVudGljYXRlIHRoZSBzZXNzaW9uCiAgICAgICAgKi8KICAgICAgICBhdXRoZW50aWNhdGU6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBhdXRoZW50aWNhdG9yID0gdGhpcy5nZXQoJ2F1dGhlbnRpY2F0b3InKTsKICAgICAgICAgIEVtYmVyLmFzc2VydCgnQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4vTG9naW5Db250cm9sbGVyTWl4aW4gcmVxdWlyZSB0aGUgYXV0aGVudGljYXRvciBwcm9wZXJ0eSB0byBiZSBzZXQgb24gdGhlIGNvbnRyb2xsZXInLCAhRW1iZXIuaXNFbXB0eShhdXRoZW50aWNhdG9yKSk7CiAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lKS5hdXRoZW50aWNhdGUodGhpcy5nZXQoJ2F1dGhlbnRpY2F0b3InKSwgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9KTsKZGVmaW5lKCJzaW1wbGUtYXV0aC9taXhpbnMvbG9naW4tY29udHJvbGxlci1taXhpbiIsIAogIFsiLi8uLi9jb25maWd1cmF0aW9uIiwiLi9hdXRoZW50aWNhdGlvbi1jb250cm9sbGVyLW1peGluIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBlbmRlbmN5Ml9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIENvbmZpZ3VyYXRpb24gPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKICAgIHZhciBBdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbiA9IF9fZGVwZW5kZW5jeTJfX1siZGVmYXVsdCJdOwoKICAgIC8qKgogICAgICBUaGlzIG1peGluIGlzIGZvciB0aGUgY29udHJvbGxlciB0aGF0IGhhbmRsZXMgdGhlCiAgICAgIFtgQ29uZmlndXJhdGlvbi5hdXRoZW50aWNhdGlvblJvdXRlYF0oI1NpbXBsZUF1dGgtQ29uZmlndXJhdGlvbi1hdXRoZW50aWNhdGlvblJvdXRlKQogICAgICBpZiB0aGUgdXNlZCBhdXRoZW50aWNhdGlvbiBtZWNoYW5pc20gd29ya3Mgd2l0aCBhIGxvZ2luIGZvcm0gdGhhdCBhc2tzIGZvcgogICAgICB1c2VyIGNyZWRlbnRpYWxzLiBJdCBwcm92aWRlcyB0aGUgYGF1dGhlbnRpY2F0ZWAgYWN0aW9uIHRoYXQgd2lsbAogICAgICBhdXRoZW50aWNhdGUgdGhlIHNlc3Npb24gd2l0aCB0aGUgY29uZmlndXJlZCBhdXRoZW50aWNhdG9yIHdoZW4gaW52b2tlZC4KICAgICAgX19UaGlzIGlzIGEgc3BlY2lhbGl6YXRpb24gb2YKICAgICAgW2BBdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbmBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluKS5fXwoKICAgICAgQWNjb21wYW55aW5nIHRoZSBjb250cm9sbGVyIHRoYXQgdGhpcyBtaXhpbiBpcyBtaXhlZCBpbiB0aGUgYXBwbGljYXRpb24gbmVlZHMKICAgICAgdG8gaGF2ZSBhIGBsb2dpbmAgdGVtcGxhdGUgd2l0aCB0aGUgZmllbGRzIGBpZGVudGlmaWNhdGlvbmAgYW5kIGBwYXNzd29yZGAgYXMKICAgICAgd2VsbCBhcyBhbiBhY3Rpb25hYmxlIGJ1dHRvbiBvciBsaW5rIHRoYXQgdHJpZ2dlcnMgdGhlIGBhdXRoZW50aWNhdGVgIGFjdGlvbiwKICAgICAgZS5nLjoKCiAgICAgIGBgYGhhbmRsZWJhcnMKICAgICAgPGZvcm0ge3thY3Rpb24gJ2F1dGhlbnRpY2F0ZScgb249J3N1Ym1pdCd9fT4KICAgICAgICA8bGFiZWwgZm9yPSJpZGVudGlmaWNhdGlvbiI+TG9naW48L2xhYmVsPgogICAgICAgIHt7aW5wdXQgdmFsdWU9aWRlbnRpZmljYXRpb24gcGxhY2Vob2xkZXI9J0VudGVyIExvZ2luJ319CiAgICAgICAgPGxhYmVsIGZvcj0icGFzc3dvcmQiPlBhc3N3b3JkPC9sYWJlbD4KICAgICAgICB7e2lucHV0IHZhbHVlPXBhc3N3b3JkIHBsYWNlaG9sZGVyPSdFbnRlciBQYXNzd29yZCcgdHlwZT0ncGFzc3dvcmQnfX0KICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+TG9naW48L2J1dHRvbj4KICAgICAgPC9mb3JtPgogICAgICBgYGAKCiAgICAgIEBjbGFzcyBMb2dpbkNvbnRyb2xsZXJNaXhpbgogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGgKICAgICAgQG1vZHVsZSBzaW1wbGUtYXV0aC9taXhpbnMvbG9naW4tY29udHJvbGxlci1taXhpbgogICAgICBAZXh0ZW5kcyBTaW1wbGVBdXRoLkF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluCiAgICAqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IEVtYmVyLk1peGluLmNyZWF0ZShBdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbiwgewogICAgICBhY3Rpb25zOiB7CiAgICAgICAgLyoqCiAgICAgICAgICBUaGlzIGFjdGlvbiB3aWxsIGF1dGhlbnRpY2F0ZSB0aGUgc2Vzc2lvbiB3aXRoIHRoZSBjb25maWd1cmVkCiAgICAgICAgICBhdXRoZW50aWNhdG9yIChzZWUKICAgICAgICAgIFtBdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbiNhdXRoZW50aWNhdG9yXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdGlvbi1hdXRoZW50aWNhdG9yKSkKICAgICAgICAgIGlmIGJvdGggYGlkZW50aWZpY2F0aW9uYCBhbmQgYHBhc3N3b3JkYCBhcmUgbm9uLWVtcHR5LiBJdCBwYXNzZXMgYm90aAogICAgICAgICAgdmFsdWVzIHRvIHRoZSBhdXRoZW50aWNhdG9yLgoKICAgICAgICAgIF9fVGhlIGFjdGlvbiBhbHNvIHJlc2V0cyB0aGUgYHBhc3N3b3JkYCBwcm9wZXJ0eSBzbyBzZW5zaXRpdmUgZGF0YSBkb2VzCiAgICAgICAgICBub3Qgc3RheSBpbiBtZW1vcnkgZm9yIGxvbmdlciB0aGFuIG5lY2Vzc2FyeS5fXwoKICAgICAgICAgIEBtZXRob2QgYWN0aW9ucy5hdXRoZW50aWNhdGUKICAgICAgICAqLwogICAgICAgIGF1dGhlbnRpY2F0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZ2V0UHJvcGVydGllcygnaWRlbnRpZmljYXRpb24nLCAncGFzc3dvcmQnKTsKICAgICAgICAgIHRoaXMuc2V0KCdwYXNzd29yZCcsIG51bGwpOwogICAgICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyKGRhdGEpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvbWl4aW5zL3VuYXV0aGVudGljYXRlZC1yb3V0ZS1taXhpbiIsIAogIFsiLi8uLi9jb25maWd1cmF0aW9uIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBDb25maWd1cmF0aW9uID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CgogICAgLyoqCiAgICAgIFRoaXMgbWl4aW4gaXMgZm9yIHJvdXRlcyB0aGF0IHNob3VsZCBvbmx5IGJlIGFjY2Vzc2libGUgaWYgdGhlIHNlc3Npb24gaXMKICAgICAgbm90IGF1dGhlbnRpY2F0ZWQuIFRoaXMgaXMgZS5nLiB0aGUgY2FzZSBmb3IgdGhlIGxvZ2luIHJvdXRlIHRoYXQgc2hvdWxkIG5vdAogICAgICBiZSBhY2Nlc3NpYmxlIHdoZW4gdGhlIHNlc3Npb24gaXMgYWxyZWFkeSBhdXRoZW50aWNhdGVkLiBJbmNsdWRpbmcgdGhpcyBtaXhpbgogICAgICBpbiBhIHJvdXRlIGF1dG9tYXRpY2FsbHkgYWRkcyBhIGhvb2sgdGhhdCByZWRpcmVjdHMgdG8gdGhlCiAgICAgIFtgQ29uZmlndXJhdGlvbi5yb3V0ZUlmQWxyZWFkeUF1dGhlbnRpY2F0ZWRgXSgjU2ltcGxlQXV0aC1Db25maWd1cmF0aW9uLXJvdXRlSWZBbHJlYWR5QXV0aGVudGljYXRlZCksCiAgICAgIHdoaWNoIGRlZmF1bHRzIHRvIGAnaW5kZXgnYC4KCiAgICAgIGBgYGpzCiAgICAgIC8vIGFwcC9yb3V0ZXMvbG9naW4uanMKICAgICAgaW1wb3J0IFVuYXV0aGVudGljYXRlZFJvdXRlTWl4aW4gZnJvbSAnc2ltcGxlLWF1dGgvbWl4aW5zL3VuYXV0aGVudGljYXRlZC1yb3V0ZS1taXhpbic7CgogICAgICBleHBvcnQgZGVmYXVsdCBFbWJlci5Sb3V0ZS5leHRlbmQoVW5hdXRoZW50aWNhdGVkUm91dGVNaXhpbik7CiAgICAgIGBgYAoKICAgICAgYFVuYXV0aGVudGljYXRlZFJvdXRlTWl4aW5gIHBlcmZvcm1zIHRoZSByZWRpcmVjdCBpbiB0aGUgYGJlZm9yZU1vZGVsYAogICAgICBtZXRob2QuIF9fSWYgYGJlZm9yZU1vZGVsYCBpcyBvdmVycmlkZGVuLCBlbnN1cmUgdGhhdCB0aGUgY3VzdG9tCiAgICAgIGltcGxlbWVudGF0aW9uIGNhbGxzIGB0aGlzLl9zdXBlcih0cmFuc2l0aW9uKWBfXy4KCiAgICAgIEBjbGFzcyBVbmF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluCiAgICAgIEBuYW1lc3BhY2UgU2ltcGxlQXV0aAogICAgICBAbW9kdWxlIHNpbXBsZS1hdXRoL21peGlucy91bmF1dGhlbnRpY2F0ZWQtcm91dGUtbWl4aW4KICAgICAgQGV4dGVuZHMgRW1iZXIuTWl4aW4KICAgICAgQHN0YXRpYwogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBFbWJlci5NaXhpbi5jcmVhdGUoewogICAgICAvKioKICAgICAgICBUaGlzIG1ldGhvZCBpbXBsZW1lbnRzIHRoZSBlbmZvcmNlbWVudCBvZiB0aGUgc2Vzc2lvbiBub3QgYmVpbmcKICAgICAgICBhdXRoZW50aWNhdGVkLiBJZiB0aGUgc2Vzc2lvbiBpcyBhdXRoZW50aWNhdGVkLCB0aGUgY3VycmVudCB0cmFuc2l0aW9uIHdpbGwKICAgICAgICBiZSBhYm9ydGVkIGFuZCBhIHJlZGlyZWN0IHdpbGwgYmUgdHJpZ2dlcmVkIHRvIHRoZQogICAgICAgIFtgQ29uZmlndXJhdGlvbi5yb3V0ZUlmQWxyZWFkeUF1dGhlbnRpY2F0ZWRgXSgjU2ltcGxlQXV0aC1Db25maWd1cmF0aW9uLXJvdXRlSWZBbHJlYWR5QXV0aGVudGljYXRlZCkuCgogICAgICAgIEBtZXRob2QgYmVmb3JlTW9kZWwKICAgICAgICBAcGFyYW0ge1RyYW5zaXRpb259IHRyYW5zaXRpb24gVGhlIHRyYW5zaXRpb24gdGhhdCBsZWFkIHRvIHRoaXMgcm91dGUKICAgICAgKi8KICAgICAgYmVmb3JlTW9kZWw6IGZ1bmN0aW9uKHRyYW5zaXRpb24pIHsKICAgICAgICBpZiAodGhpcy5nZXQoQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lKS5nZXQoJ2lzQXV0aGVudGljYXRlZCcpKSB7CiAgICAgICAgICB0cmFuc2l0aW9uLmFib3J0KCk7CiAgICAgICAgICBFbWJlci5hc3NlcnQoJ1RoZSByb3V0ZSBjb25maWd1cmVkIGFzIENvbmZpZ3VyYXRpb24ucm91dGVJZkFscmVhZHlBdXRoZW50aWNhdGVkIGNhbm5vdCBpbXBsZW1lbnQgdGhlIFVuYXV0aGVudGljYXRlZFJvdXRlTWl4aW4gbWl4aW4gYXMgdGhhdCBsZWFkcyB0byBhbiBpbmZpbml0ZSB0cmFuc2l0aW9uaW5nIGxvb3AuJywgdGhpcy5nZXQoJ3JvdXRlTmFtZScpICE9PSBDb25maWd1cmF0aW9uLnJvdXRlSWZBbHJlYWR5QXV0aGVudGljYXRlZCk7CiAgICAgICAgICB0aGlzLnRyYW5zaXRpb25UbyhDb25maWd1cmF0aW9uLnJvdXRlSWZBbHJlYWR5QXV0aGVudGljYXRlZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9KTsKZGVmaW5lKCJzaW1wbGUtYXV0aC9zZXNzaW9uIiwgCiAgWyJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIC8qKgogICAgICBfX1RoZSBzZXNzaW9uIHByb3ZpZGVzIGFjY2VzcyB0byB0aGUgY3VycmVudCBhdXRoZW50aWNhdGlvbiBzdGF0ZSBhcyB3ZWxsIGFzCiAgICAgIGFueSBkYXRhIHRoZSBhdXRoZW50aWNhdG9yIHJlc29sdmVkIHdpdGhfXyAoc2VlCiAgICAgIFtgQXV0aGVudGljYXRvcnMuQmFzZSNhdXRoZW50aWNhdGVgXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdG9ycy1CYXNlLWF1dGhlbnRpY2F0ZSkpLgogICAgICBJdCBpcyBjcmVhdGVkIHdoZW4gRW1iZXIgU2ltcGxlIEF1dGggaXMgc2V0IHVwIGFuZCBfX2luamVjdGVkIGludG8gYWxsCiAgICAgIGNvbnRyb2xsZXJzIGFuZCByb3V0ZXMgc28gdGhhdCB0aGVzZSBwYXJ0cyBvZiB0aGUgYXBwbGljYXRpb24gY2FuIGFsd2F5cwogICAgICBhY2Nlc3MgdGhlIGN1cnJlbnQgYXV0aGVudGljYXRpb24gc3RhdGUgYW5kIG90aGVyIGRhdGFfXywgZGVwZW5kaW5nIG9uIHRoZQogICAgICBhdXRoZW50aWNhdG9yIGluIHVzZSBhbmQgd2hldGhlciB0aGUgc2Vzc2lvbiBpcyBhY3R1YWxseSBhdXRoZW50aWNhdGVkIChzZWUKICAgICAgW2BBdXRoZW50aWNhdG9ycy5CYXNlYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZSkpLgoKICAgICAgVGhlIHNlc3Npb24gYWxzbyBwcm92aWRlcyBtZXRob2RzIHRvIGF1dGhlbnRpY2F0ZSBhbmQgdG8gaW52YWxpZGF0ZSBpdHNlbGYKICAgICAgKHNlZQogICAgICBbYFNlc3Npb24jYXV0aGVudGljYXRlYF0oI1NpbXBsZUF1dGgtU2Vzc2lvbi1hdXRoZW50aWNhdGUpLAogICAgICBbYFNlc3Npb24jaW52YWxkaWF0ZWBdKCNTaW1wbGVBdXRoLVNlc3Npb24taW52YWxkaWF0ZSkpLgogICAgICBUaGVzZSBtZXRob2RzIGFyZSB1c3VhbGx5IGludm9rZWQgdGhyb3VnaCBhY3Rpb25zIGZyb20gcm91dGVzIG9yIGNvbnRyb2xsZXJzLgogICAgICBUbyBhdXRoZW50aWNhdGUgdGhlIHNlc3Npb24gbWFudWFsbHksIHNpbXBsZSBjYWxsIHRoZQogICAgICBbYFNlc3Npb24jYXV0aGVudGljYXRlYF0oI1NpbXBsZUF1dGgtU2Vzc2lvbi1hdXRoZW50aWNhdGUpCiAgICAgIG1ldGhvZCB3aXRoIHRoZSBhdXRoZW50aWNhdG9yIGZhY3RvcnkgdG8gdXNlIGFzIHdlbGwgYXMgYW55IG9wdGlvbnMgdGhlCiAgICAgIGF1dGhlbnRpY2F0b3IgbmVlZHMgdG8gYXV0aGVudGljYXRlIHRoZSBzZXNzaW9uOgoKICAgICAgYGBganMKICAgICAgdGhpcy5nZXQoJ3Nlc3Npb24nKS5hdXRoZW50aWNhdGUoJ2F1dGhlbnRpY2F0b3I6Y3VzdG9tJywgeyBzb21lOiAnb3B0aW9uJyB9KS50aGVuKGZ1bmN0aW9uKCkgewogICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIHdhcyBzdWNjZXNzZnVsCiAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgIC8vIGF1dGhlbnRpY2F0aW9uIGZhaWxlZAogICAgICB9KTsKICAgICAgYGBgCgogICAgICBUaGUgc2Vzc2lvbiBhbHNvIG9ic2VydmVzIHRoZSBzdG9yZSBhbmQgLSBpZiBpdCBpcyBhdXRoZW50aWNhdGVkIC0gdGhlCiAgICAgIGF1dGhlbnRpY2F0b3IgZm9yIGNoYW5nZXMgKHNlZQogICAgICBbYEF1dGhlbnRpY2F0b3JzLkJhc2VgXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdG9ycy1CYXNlKQogICAgICBlbmQgW2BTdG9yZXMuQmFzZWBdKCNTaW1wbGVBdXRoLVN0b3Jlcy1CYXNlKSkuCgogICAgICBAY2xhc3MgU2Vzc2lvbgogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGgKICAgICAgQG1vZHVsZSBzaW1wbGUtYXV0aC9zZXNzaW9uCiAgICAgIEBleHRlbmRzIEVtYmVyLk9iamVjdFByb3h5CiAgICAgIEB1c2VzIEVtYmVyLkV2ZW50ZWQKICAgICovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gRW1iZXIuT2JqZWN0UHJveHkuZXh0ZW5kKEVtYmVyLkV2ZW50ZWQsIHsKICAgICAgLyoqCiAgICAgICAgVHJpZ2dlcmVkIF9fd2hlbmV2ZXIgdGhlIHNlc3Npb24gaXMgc3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWRfXy4gV2hlbiB0aGUKICAgICAgICBhcHBsaWNhdGlvbiB1c2VzIHRoZQogICAgICAgIFtgQXBwbGljYXRpb25Sb3V0ZU1peGluYCBtaXhpbl0oI1NpbXBsZUF1dGgtQXBwbGljYXRpb25Sb3V0ZU1peGluKSwKICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbi5hY3Rpb25zI3Nlc3Npb25BdXRoZW50aWNhdGlvblN1Y2NlZWRlZGBdKCNTaW1wbGVBdXRoLUFwcGxpY2F0aW9uUm91dGVNaXhpbi1zZXNzaW9uQXV0aGVudGljYXRpb25TdWNjZWVkZWQpCiAgICAgICAgd2lsbCBiZSBpbnZva2VkIHdoZW5ldmVyIHRoaXMgZXZlbnQgaXMgdHJpZ2dlcmVkLgoKICAgICAgICBAZXZlbnQgc2Vzc2lvbkF1dGhlbnRpY2F0aW9uU3VjY2VlZGVkCiAgICAgICovCiAgICAgIC8qKgogICAgICAgIFRyaWdnZXJlZCBfX3doZW5ldmVyIGFuIGF0dGVtcHQgdG8gYXV0aGVudGljYXRlIHRoZSBzZXNzaW9uIGZhaWxzX18uIFdoZW4KICAgICAgICB0aGUgYXBwbGljYXRpb24gdXNlcyB0aGUKICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbmAgbWl4aW5dKCNTaW1wbGVBdXRoLUFwcGxpY2F0aW9uUm91dGVNaXhpbiksCiAgICAgICAgW2BBcHBsaWNhdGlvblJvdXRlTWl4aW4uYWN0aW9ucyNzZXNzaW9uQXV0aGVudGljYXRpb25GYWlsZWRgXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4tc2Vzc2lvbkF1dGhlbnRpY2F0aW9uRmFpbGVkKQogICAgICAgIHdpbGwgYmUgaW52b2tlZCB3aGVuZXZlciB0aGlzIGV2ZW50IGlzIHRyaWdnZXJlZC4KCiAgICAgICAgQGV2ZW50IHNlc3Npb25BdXRoZW50aWNhdGlvbkZhaWxlZAogICAgICAgIEBwYXJhbSB7T2JqZWN0fSBlcnJvciBUaGUgZXJyb3Igb2JqZWN0OyB0aGlzIGRlcGVuZHMgb24gdGhlIGF1dGhlbnRpY2F0b3IgaW4gdXNlLCBzZWUgW1NpbXBsZUF1dGguQXV0aGVudGljYXRvcnMuQmFzZSNhdXRoZW50aWNhdGVdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UtYXV0aGVudGljYXRlKQogICAgICAqLwogICAgICAvKioKICAgICAgICBUcmlnZ2VyZWQgX193aGVuZXZlciB0aGUgc2Vzc2lvbiBpcyBzdWNjZXNzZnVsbHkgaW52YWxpZGF0ZWRfXy4gV2hlbiB0aGUKICAgICAgICBhcHBsaWNhdGlvbiB1c2VzIHRoZQogICAgICAgIFtgQXBwbGljYXRpb25Sb3V0ZU1peGluYCBtaXhpbl0oI1NpbXBsZUF1dGgtQXBwbGljYXRpb25Sb3V0ZU1peGluKSwKICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbi5hY3Rpb25zI3Nlc3Npb25JbnZhbGlkYXRpb25TdWNjZWVkZWRgXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4tc2Vzc2lvbkludmFsaWRhdGlvblN1Y2NlZWRlZCkKICAgICAgICB3aWxsIGJlIGludm9rZWQgd2hlbmV2ZXIgdGhpcyBldmVudCBpcyB0cmlnZ2VyZWQuCgogICAgICAgIEBldmVudCBzZXNzaW9uSW52YWxpZGF0aW9uU3VjY2VlZGVkCiAgICAgICovCiAgICAgIC8qKgogICAgICAgIFRyaWdnZXJlZCBfX3doZW5ldmVyIGFuIGF0dGVtcHQgdG8gaW52YWxpZGF0ZSB0aGUgc2Vzc2lvbiBmYWlsc19fLiBXaGVuIHRoZQogICAgICAgIGFwcGxpY2F0aW9uIHVzZXMgdGhlCiAgICAgICAgW2BBcHBsaWNhdGlvblJvdXRlTWl4aW5gIG1peGluXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4pLAogICAgICAgIFtgQXBwbGljYXRpb25Sb3V0ZU1peGluLmFjdGlvbnMjc2Vzc2lvbkludmFsaWRhdGlvbkZhaWxlZGBdKCNTaW1wbGVBdXRoLUFwcGxpY2F0aW9uUm91dGVNaXhpbi1zZXNzaW9uSW52YWxpZGF0aW9uRmFpbGVkKQogICAgICAgIHdpbGwgYmUgaW52b2tlZCB3aGVuZXZlciB0aGlzIGV2ZW50IGlzIHRyaWdnZXJlZC4KCiAgICAgICAgQGV2ZW50IHNlc3Npb25JbnZhbGlkYXRpb25GYWlsZWQKICAgICAgICBAcGFyYW0ge09iamVjdH0gZXJyb3IgVGhlIGVycm9yIG9iamVjdDsgdGhpcyBkZXBlbmRzIG9uIHRoZSBhdXRoZW50aWNhdG9yIGluIHVzZSwgc2VlIFtTaW1wbGVBdXRoLkF1dGhlbnRpY2F0b3JzLkJhc2UjaW52YWxpZGF0ZV0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZS1pbnZhbGlkYXRlKQogICAgICAqLwogICAgICAvKioKICAgICAgICBUcmlnZ2VyZWQgX193aGVuZXZlciB0aGUgc2VydmVyIHJlamVjdHMgdGhlIGF1dGhvcml6YXRpb24gaW5mb3JtYXRpb24KICAgICAgICBwYXNzZWQgd2l0aCBhIHJlcXVlc3QgYW5kIHJlc3BvbmRzIHdpdGggc3RhdHVzIDQwMV9fLiBXaGVuIHRoZSBhcHBsaWNhdGlvbgogICAgICAgIHVzZXMgdGhlCiAgICAgICAgW2BBcHBsaWNhdGlvblJvdXRlTWl4aW5gIG1peGluXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4pLAogICAgICAgIFtgQXBwbGljYXRpb25Sb3V0ZU1peGluLmFjdGlvbnMjYXV0aG9yaXphdGlvbkZhaWxlZGBdKCNTaW1wbGVBdXRoLUFwcGxpY2F0aW9uUm91dGVNaXhpbi1hdXRob3JpemF0aW9uRmFpbGVkKQogICAgICAgIHdpbGwgYmUgaW52b2tlZCB3aGVuZXZlciB0aGlzIGV2ZW50IGlzIHRyaWdnZXJlZC4KCiAgICAgICAgQGV2ZW50IGF1dGhvcml6YXRpb25GYWlsZWQKICAgICAgKi8KCiAgICAgIC8qKgogICAgICAgIFRoZSBhdXRoZW50aWNhdG9yIGZhY3RvcnkgdG8gdXNlIGFzIGl0IGlzIHJlZ2lzdGVyZWQgd2l0aCBFbWJlcidzCiAgICAgICAgY29udGFpbmVyLCBzZWUKICAgICAgICBbRW1iZXIncyBBUEkgZG9jc10oaHR0cDovL2VtYmVyanMuY29tL2FwaS9jbGFzc2VzL0VtYmVyLkFwcGxpY2F0aW9uLmh0bWwjbWV0aG9kX3JlZ2lzdGVyKS4KICAgICAgICBUaGlzIGlzIG9ubHkgc2V0IHdoZW4gdGhlIHNlc3Npb24gaXMgY3VycmVudGx5IGF1dGhlbnRpY2F0ZWQuCgogICAgICAgIEBwcm9wZXJ0eSBhdXRoZW50aWNhdG9yCiAgICAgICAgQHR5cGUgU3RyaW5nCiAgICAgICAgQHJlYWRPbmx5CiAgICAgICAgQGRlZmF1bHQgbnVsbAogICAgICAqLwogICAgICBhdXRoZW50aWNhdG9yOiBudWxsLAogICAgICAvKioKICAgICAgICBUaGUgc3RvcmUgdXNlZCB0byBwZXJzaXN0IHNlc3Npb24gcHJvcGVydGllcy4KCiAgICAgICAgQHByb3BlcnR5IHN0b3JlCiAgICAgICAgQHR5cGUgU2ltcGxlQXV0aC5TdG9yZXMuQmFzZQogICAgICAgIEByZWFkT25seQogICAgICAgIEBkZWZhdWx0IG51bGwKICAgICAgKi8KICAgICAgc3RvcmU6IG51bGwsCiAgICAgIC8qKgogICAgICAgIFRoZSBFbWJlci5qcyBjb250YWluZXIsCgogICAgICAgIEBwcm9wZXJ0eSBjb250YWluZXIKICAgICAgICBAdHlwZSBDb250YWluZXIKICAgICAgICBAcmVhZE9ubHkKICAgICAgICBAZGVmYXVsdCBudWxsCiAgICAgICovCiAgICAgIGNvbnRhaW5lcjogbnVsbCwKICAgICAgLyoqCiAgICAgICAgUmV0dXJucyB3aGV0aGVyIHRoZSBzZXNzaW9uIGlzIGN1cnJlbnRseSBhdXRoZW50aWNhdGVkLgoKICAgICAgICBAcHJvcGVydHkgaXNBdXRoZW50aWNhdGVkCiAgICAgICAgQHR5cGUgQm9vbGVhbgogICAgICAgIEByZWFkT25seQogICAgICAgIEBkZWZhdWx0IGZhbHNlCiAgICAgICovCiAgICAgIGlzQXV0aGVudGljYXRlZDogZmFsc2UsCiAgICAgIC8qKgogICAgICAgIEBwcm9wZXJ0eSBhdHRlbXB0ZWRUcmFuc2l0aW9uCiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgYXR0ZW1wdGVkVHJhbnNpdGlvbjogbnVsbCwKICAgICAgLyoqCiAgICAgICAgQHByb3BlcnR5IGNvbnRlbnQKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICBjb250ZW50OiB7fSwKCiAgICAgIC8qKgogICAgICAgIEF1dGhlbnRpY2F0ZXMgdGhlIHNlc3Npb24gd2l0aCBhbiBgYXV0aGVudGljYXRvcmAgYW5kIGFwcHJvcHJpYXRlCiAgICAgICAgYG9wdGlvbnNgLiBfX1RoaXMgZGVsZWdhdGVzIHRoZSBhY3R1YWwgYXV0aGVudGljYXRpb24gd29yayB0byB0aGUKICAgICAgICBgYXV0aGVudGljYXRvcmBfXyBhbmQgaGFuZGxlcyB0aGUgcmV0dXJuZWQgcHJvbWlzZSBhY2NvcmRpbmdseSAoc2VlCiAgICAgICAgW2BBdXRoZW50aWNhdG9ycy5CYXNlI2F1dGhlbnRpY2F0ZWBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UtYXV0aGVudGljYXRlKSkuCiAgICAgICAgQWxsIGRhdGEgdGhlIGF1dGhlbnRpY2F0b3IgcmVzb2x2ZXMgd2l0aCB3aWxsIGJlIHNhdmVkIGluIHRoZSBzZXNzaW9uLgoKICAgICAgICBfX1RoaXMgbWV0aG9kIHJldHVybnMgYSBwcm9taXNlIGl0c2VsZi4gQSByZXNvbHZpbmcgcHJvbWlzZSBpbmRpY2F0ZXMgdGhhdAogICAgICAgIHRoZSBzZXNzaW9uIHdhcyBzdWNjZXNzZnVsbHkgYXV0aGVudGljYXRlZF9fIHdoaWxlIGEgcmVqZWN0aW5nIHByb21pc2UKICAgICAgICBpbmRpY2F0ZXMgdGhhdCBhdXRoZW50aWNhdGlvbiBmYWlsZWQgYW5kIHRoZSBzZXNzaW9uIHJlbWFpbnMKICAgICAgICB1bmF1dGhlbnRpY2F0ZWQuCgogICAgICAgIEBtZXRob2QgYXV0aGVudGljYXRlCiAgICAgICAgQHBhcmFtIHtTdHJpbmd9IGF1dGhlbnRpY2F0b3IgVGhlIGF1dGhlbnRpY2F0b3IgZmFjdG9yeSB0byB1c2UgYXMgaXQgaXMgcmVnaXN0ZXJlZCB3aXRoIEVtYmVyJ3MgY29udGFpbmVyLCBzZWUgW0VtYmVyJ3MgQVBJIGRvY3NdKGh0dHA6Ly9lbWJlcmpzLmNvbS9hcGkvY2xhc3Nlcy9FbWJlci5BcHBsaWNhdGlvbi5odG1sI21ldGhvZF9yZWdpc3RlcikKICAgICAgICBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBUaGUgb3B0aW9ucyB0byBwYXNzIHRvIHRoZSBhdXRoZW50aWNhdG9yOyBkZXBlbmRpbmcgb24gdGhlIHR5cGUgb2YgYXV0aGVudGljYXRvciB0aGVzZSBtaWdodCBiZSBhIHNldCBvZiBjcmVkZW50aWFscywgYSBGYWNlYm9vayBPQXV0aCBUb2tlbiwgZXRjLgogICAgICAgIEByZXR1cm4ge0VtYmVyLlJTVlAuUHJvbWlzZX0gQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgc2Vzc2lvbiB3YXMgYXV0aGVudGljYXRlZCBzdWNjZXNzZnVsbHkKICAgICAgKi8KICAgICAgYXV0aGVudGljYXRlOiBmdW5jdGlvbihhdXRoZW50aWNhdG9yLCBvcHRpb25zKSB7CiAgICAgICAgRW1iZXIuYXNzZXJ0KCdTZXNzaW9uI2F1dGhlbnRpY2F0ZSByZXF1aXJlcyB0aGUgYXV0aGVudGljYXRvciBmYWN0b3J5IHRvIGJlIHNwZWNpZmllZCwgd2FzICcgKyBhdXRoZW50aWNhdG9yLCAhRW1iZXIuaXNFbXB0eShhdXRoZW50aWNhdG9yKSk7CiAgICAgICAgdmFyIF90aGlzICAgICAgICAgICAgPSB0aGlzOwogICAgICAgIHZhciB0aGVBdXRoZW50aWNhdG9yID0gdGhpcy5jb250YWluZXIubG9va3VwKGF1dGhlbnRpY2F0b3IpOwogICAgICAgIEVtYmVyLmFzc2VydCgnTm8gYXV0aGVudGljYXRvciBmb3IgZmFjdG9yeSAiJyArIGF1dGhlbnRpY2F0b3IgKyAnIiBjb3VsZCBiZSBmb3VuZCcsICFFbWJlci5pc05vbmUodGhlQXV0aGVudGljYXRvcikpOwogICAgICAgIHJldHVybiBuZXcgRW1iZXIuUlNWUC5Qcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdGhlQXV0aGVudGljYXRvci5hdXRoZW50aWNhdGUob3B0aW9ucykudGhlbihmdW5jdGlvbihjb250ZW50KSB7CiAgICAgICAgICAgIF90aGlzLnNldHVwKGF1dGhlbnRpY2F0b3IsIGNvbnRlbnQsIHRydWUpOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICBfdGhpcy5jbGVhcigpOwogICAgICAgICAgICBfdGhpcy50cmlnZ2VyKCdzZXNzaW9uQXV0aGVudGljYXRpb25GYWlsZWQnLCBlcnJvcik7CiAgICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEludmFsaWRhdGVzIHRoZSBzZXNzaW9uIHdpdGggdGhlIGF1dGhlbnRpY2F0b3IgaXQgaXMgY3VycmVudGx5CiAgICAgICAgYXV0aGVudGljYXRlZCB3aXRoIChzZWUKICAgICAgICBbYFNlc3Npb24jYXV0aGVudGljYXRvcmBdKCNTaW1wbGVBdXRoLVNlc3Npb24tYXV0aGVudGljYXRvcikpLiBfX1RoaXMKICAgICAgICBpbnZva2VzIHRoZSBhdXRoZW50aWNhdG9yJ3MgYGludmFsaWRhdGVgIG1ldGhvZCBhbmQgaGFuZGxlcyB0aGUgcmV0dXJuZWQKICAgICAgICBwcm9taXNlIGFjY29yZGluZ2x5X18gKHNlZQogICAgICAgIFtgQXV0aGVudGljYXRvcnMuQmFzZSNpbnZhbGlkYXRlYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZS1pbnZhbGlkYXRlKSkuCgogICAgICAgIF9fVGhpcyBtZXRob2QgcmV0dXJucyBhIHByb21pc2UgaXRzZWxmLiBBIHJlc29sdmluZyBwcm9taXNlIGluZGljYXRlcyB0aGF0CiAgICAgICAgdGhlIHNlc3Npb24gd2FzIHN1Y2Nlc3NmdWxseSBpbnZhbGlkYXRlZF9fIHdoaWxlIGEgcmVqZWN0aW5nIHByb21pc2UKICAgICAgICBpbmRpY2F0ZXMgdGhhdCB0aGUgcHJvbWlzZSByZXR1cm5lZCBieSB0aGUgYGF1dGhlbnRpY2F0b3JgIHJlamVjdGVkIGFuZAogICAgICAgIHRodXMgaW52YWxpZGF0aW9uIHdhcyBjYW5jZWxsZWQuIEluIHRoYXQgY2FzZSB0aGUgc2Vzc2lvbiByZW1haW5zCiAgICAgICAgYXV0aGVudGljYXRlZC4gT25jZSB0aGUgc2Vzc2lvbiBpcyBzdWNjZXNzZnVsbHkgaW52YWxpZGF0ZWQgaXQgY2xlYXJzIGFsbAogICAgICAgIG9mIGl0cyBkYXRhLgoKICAgICAgICBAbWV0aG9kIGludmFsaWRhdGUKICAgICAgICBAcmV0dXJuIHtFbWJlci5SU1ZQLlByb21pc2V9IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIHNlc3Npb24gd2FzIGludmFsaWRhdGVkIHN1Y2Nlc3NmdWxseQogICAgICAqLwogICAgICBpbnZhbGlkYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICBFbWJlci5hc3NlcnQoJ1Nlc3Npb24jaW52YWxpZGF0ZSByZXF1aXJlcyB0aGUgc2Vzc2lvbiB0byBiZSBhdXRoZW50aWNhdGVkJywgdGhpcy5nZXQoJ2lzQXV0aGVudGljYXRlZCcpKTsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHJldHVybiBuZXcgRW1iZXIuUlNWUC5Qcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIGF1dGhlbnRpY2F0b3IgPSBfdGhpcy5jb250YWluZXIubG9va3VwKF90aGlzLmF1dGhlbnRpY2F0b3IpOwogICAgICAgICAgYXV0aGVudGljYXRvci5pbnZhbGlkYXRlKF90aGlzLmNvbnRlbnQpLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGF1dGhlbnRpY2F0b3Iub2ZmKCdzZXNzaW9uRGF0YVVwZGF0ZWQnKTsKICAgICAgICAgICAgX3RoaXMuY2xlYXIodHJ1ZSk7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgICAgIF90aGlzLnRyaWdnZXIoJ3Nlc3Npb25JbnZhbGlkYXRpb25GYWlsZWQnLCBlcnJvcik7CiAgICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgcmVzdG9yZQogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIHJlc3RvcmU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgcmV0dXJuIG5ldyBFbWJlci5SU1ZQLlByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICB2YXIgcmVzdG9yZWRDb250ZW50ID0gX3RoaXMuc3RvcmUucmVzdG9yZSgpOwogICAgICAgICAgdmFyIGF1dGhlbnRpY2F0b3IgICA9IHJlc3RvcmVkQ29udGVudC5hdXRoZW50aWNhdG9yOwogICAgICAgICAgaWYgKCEhYXV0aGVudGljYXRvcikgewogICAgICAgICAgICBkZWxldGUgcmVzdG9yZWRDb250ZW50LmF1dGhlbnRpY2F0b3I7CiAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5sb29rdXAoYXV0aGVudGljYXRvcikucmVzdG9yZShyZXN0b3JlZENvbnRlbnQpLnRoZW4oZnVuY3Rpb24oY29udGVudCkgewogICAgICAgICAgICAgIF90aGlzLnNldHVwKGF1dGhlbnRpY2F0b3IsIGNvbnRlbnQpOwogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgX3RoaXMuc3RvcmUuY2xlYXIoKTsKICAgICAgICAgICAgICByZWplY3QoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpcy5zdG9yZS5jbGVhcigpOwogICAgICAgICAgICByZWplY3QoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2Qgc2V0dXAKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICBzZXR1cDogZnVuY3Rpb24oYXV0aGVudGljYXRvciwgY29udGVudCwgdHJpZ2dlcikgewogICAgICAgIGNvbnRlbnQgPSBFbWJlci5tZXJnZShFbWJlci5tZXJnZSh7fSwgdGhpcy5jb250ZW50KSwgY29udGVudCk7CiAgICAgICAgdHJpZ2dlciA9ICEhdHJpZ2dlciAmJiAhdGhpcy5nZXQoJ2lzQXV0aGVudGljYXRlZCcpOwogICAgICAgIHRoaXMuYmVnaW5Qcm9wZXJ0eUNoYW5nZXMoKTsKICAgICAgICB0aGlzLnNldFByb3BlcnRpZXMoewogICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLAogICAgICAgICAgYXV0aGVudGljYXRvcjogICBhdXRoZW50aWNhdG9yLAogICAgICAgICAgY29udGVudDogICAgICAgICBjb250ZW50CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5iaW5kVG9BdXRoZW50aWNhdG9yRXZlbnRzKCk7CiAgICAgICAgdGhpcy51cGRhdGVTdG9yZSgpOwogICAgICAgIHRoaXMuZW5kUHJvcGVydHlDaGFuZ2VzKCk7CiAgICAgICAgaWYgKHRyaWdnZXIpIHsKICAgICAgICAgIHRoaXMudHJpZ2dlcignc2Vzc2lvbkF1dGhlbnRpY2F0aW9uU3VjY2VlZGVkJyk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgQG1ldGhvZCBjbGVhcgogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIGNsZWFyOiBmdW5jdGlvbih0cmlnZ2VyKSB7CiAgICAgICAgdHJpZ2dlciA9ICEhdHJpZ2dlciAmJiB0aGlzLmdldCgnaXNBdXRoZW50aWNhdGVkJyk7CiAgICAgICAgdGhpcy5iZWdpblByb3BlcnR5Q2hhbmdlcygpOwogICAgICAgIHRoaXMuc2V0UHJvcGVydGllcyh7CiAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlLAogICAgICAgICAgYXV0aGVudGljYXRvcjogICBudWxsLAogICAgICAgICAgY29udGVudDogICAgICAgICB7fQogICAgICAgIH0pOwogICAgICAgIHRoaXMuc3RvcmUuY2xlYXIoKTsKICAgICAgICB0aGlzLmVuZFByb3BlcnR5Q2hhbmdlcygpOwogICAgICAgIGlmICh0cmlnZ2VyKSB7CiAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Nlc3Npb25JbnZhbGlkYXRpb25TdWNjZWVkZWQnKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBAbWV0aG9kIHNldFVua25vd25Qcm9wZXJ0eQogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIHNldFVua25vd25Qcm9wZXJ0eTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9zdXBlcihrZXksIHZhbHVlKTsKICAgICAgICB0aGlzLnVwZGF0ZVN0b3JlKCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgdXBkYXRlU3RvcmUKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICB1cGRhdGVTdG9yZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmNvbnRlbnQ7CiAgICAgICAgaWYgKCFFbWJlci5pc0VtcHR5KHRoaXMuYXV0aGVudGljYXRvcikpIHsKICAgICAgICAgIGRhdGEgPSBFbWJlci5tZXJnZSh7IGF1dGhlbnRpY2F0b3I6IHRoaXMuYXV0aGVudGljYXRvciB9LCBkYXRhKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFFbWJlci5pc0VtcHR5KGRhdGEpKSB7CiAgICAgICAgICB0aGlzLnN0b3JlLnBlcnNpc3QoZGF0YSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgQG1ldGhvZCBiaW5kVG9BdXRoZW50aWNhdG9yRXZlbnRzCiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgYmluZFRvQXV0aGVudGljYXRvckV2ZW50czogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgYXV0aGVudGljYXRvciA9IHRoaXMuY29udGFpbmVyLmxvb2t1cCh0aGlzLmF1dGhlbnRpY2F0b3IpOwogICAgICAgIGF1dGhlbnRpY2F0b3Iub2ZmKCdzZXNzaW9uRGF0YVVwZGF0ZWQnKTsKICAgICAgICBhdXRoZW50aWNhdG9yLm9mZignc2Vzc2lvbkRhdGFJbnZhbGlkYXRlZCcpOwogICAgICAgIGF1dGhlbnRpY2F0b3Iub24oJ3Nlc3Npb25EYXRhVXBkYXRlZCcsIGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgICAgICAgIF90aGlzLnNldHVwKF90aGlzLmF1dGhlbnRpY2F0b3IsIGNvbnRlbnQpOwogICAgICAgIH0pOwogICAgICAgIGF1dGhlbnRpY2F0b3Iub24oJ3Nlc3Npb25EYXRhSW52YWxpZGF0ZWQnLCBmdW5jdGlvbihjb250ZW50KSB7CiAgICAgICAgICBfdGhpcy5jbGVhcih0cnVlKTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgYmluZFRvU3RvcmVFdmVudHMKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICBiaW5kVG9TdG9yZUV2ZW50czogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB0aGlzLnN0b3JlLm9uKCdzZXNzaW9uRGF0YVVwZGF0ZWQnLCBmdW5jdGlvbihjb250ZW50KSB7CiAgICAgICAgICB2YXIgYXV0aGVudGljYXRvciA9IGNvbnRlbnQuYXV0aGVudGljYXRvcjsKICAgICAgICAgIGlmICghIWF1dGhlbnRpY2F0b3IpIHsKICAgICAgICAgICAgZGVsZXRlIGNvbnRlbnQuYXV0aGVudGljYXRvcjsKICAgICAgICAgICAgX3RoaXMuY29udGFpbmVyLmxvb2t1cChhdXRoZW50aWNhdG9yKS5yZXN0b3JlKGNvbnRlbnQpLnRoZW4oZnVuY3Rpb24oY29udGVudCkgewogICAgICAgICAgICAgIF90aGlzLnNldHVwKGF1dGhlbnRpY2F0b3IsIGNvbnRlbnQsIHRydWUpOwogICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBfdGhpcy5jbGVhcih0cnVlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpcy5jbGVhcih0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfS5vYnNlcnZlcygnc3RvcmUnKQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvc2V0dXAiLCAKICBbIi4vY29uZmlndXJhdGlvbiIsIi4vc2Vzc2lvbiIsIi4vc3RvcmVzL2xvY2FsLXN0b3JhZ2UiLCIuL3N0b3Jlcy9lcGhlbWVyYWwiLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2RlcGVuZGVuY3kyX18sIF9fZGVwZW5kZW5jeTNfXywgX19kZXBlbmRlbmN5NF9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIENvbmZpZ3VyYXRpb24gPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKICAgIHZhciBTZXNzaW9uID0gX19kZXBlbmRlbmN5Ml9fWyJkZWZhdWx0Il07CiAgICB2YXIgTG9jYWxTdG9yYWdlID0gX19kZXBlbmRlbmN5M19fWyJkZWZhdWx0Il07CiAgICB2YXIgRXBoZW1lcmFsID0gX19kZXBlbmRlbmN5NF9fWyJkZWZhdWx0Il07CgogICAgZnVuY3Rpb24gZXh0cmFjdExvY2F0aW9uT3JpZ2luKGxvY2F0aW9uKSB7CiAgICAgIGlmIChsb2NhdGlvbiA9PT0gJyonKXsKICAgICAgICAgIHJldHVybiBsb2NhdGlvbjsKICAgICAgfQogICAgICBpZiAoRW1iZXIudHlwZU9mKGxvY2F0aW9uKSA9PT0gJ3N0cmluZycpIHsKICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICBsaW5rLmhyZWYgPSBsb2NhdGlvbjsKICAgICAgICAvL0lFIHJlcXVpcmVzIHRoZSBmb2xsb3dpbmcgbGluZSB3aGVuIHVybCBpcyByZWxhdGl2ZS4KICAgICAgICAvL0ZpcnN0IGFzc2lnbm1lbnQgb2YgcmVsYXRpdmUgdXJsIHRvIGxpbmsuaHJlZiByZXN1bHRzIGluIGFic29sdXRlIHVybCBvbiBsaW5rLmhyZWYgYnV0IGxpbmsuaG9zdG5hbWUgYW5kIG90aGVyIHByb3BlcnRpZXMgYXJlIG5vdCBzZXQKICAgICAgICAvL1NlY29uZCBhc3NpZ25tZW50IG9mIGFic29sdXRlIHVybCB0byBsaW5rLmhyZWYgcmVzdWx0cyBpbiBsaW5rLmhvc3RuYW1lIGFuZCBvdGhlciBwcm9wZXJ0aWVzIGJlaW5nIHNldCBhcyBleHBlY3RlZAogICAgICAgIGxpbmsuaHJlZiA9IGxpbmsuaHJlZjsKICAgICAgICBsb2NhdGlvbiA9IGxpbms7CiAgICAgIH0KICAgICAgdmFyIHBvcnQgPSBsb2NhdGlvbi5wb3J0OwogICAgICBpZiAoRW1iZXIuaXNFbXB0eShwb3J0KSkgewogICAgICAgIC8vbmVlZCB0byBpbmNsdWRlIHRoZSBwb3J0IHdoZXRoZXIgaXRzIGFjdHVhbGx5IHByZXNlbnQgb3Igbm90IGFzIHNvbWUgdmVyc2lvbnMgb2YgSUUgd2lsbCBhbHdheXMgc2V0IGl0CiAgICAgICAgcG9ydCA9IGxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cDonID8gJzgwJyA6IChsb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHBzOicgPyAnNDQzJyA6ICcnKTsKICAgICAgfQogICAgICByZXR1cm4gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdG5hbWUgKyAocG9ydCAhPT0gJycgPyAnOicgKyBwb3J0IDogJycpOwogICAgfQoKICAgIHZhciB1cmxPcmlnaW5zICAgICA9IHt9OwogICAgdmFyIGNyb3NzT3JpZ2luV2hpdGVsaXN0OwogICAgZnVuY3Rpb24gc2hvdWxkQXV0aG9yaXplUmVxdWVzdChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zLmNyb3NzRG9tYWluID09PSBmYWxzZSB8fCBjcm9zc09yaWdpbldoaXRlbGlzdC5pbmRleE9mKCcqJykgPiAtMSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHZhciB1cmxPcmlnaW4gPSB1cmxPcmlnaW5zW29wdGlvbnMudXJsXSA9IHVybE9yaWdpbnNbb3B0aW9ucy51cmxdIHx8IGV4dHJhY3RMb2NhdGlvbk9yaWdpbihvcHRpb25zLnVybCk7CiAgICAgIHJldHVybiBjcm9zc09yaWdpbldoaXRlbGlzdC5pbmRleE9mKHVybE9yaWdpbikgPiAtMTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3RlckZhY3Rvcmllcyhjb250YWluZXIpIHsKICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdzaW1wbGUtYXV0aC1zZXNzaW9uLXN0b3JlOmxvY2FsLXN0b3JhZ2UnLCBMb2NhbFN0b3JhZ2UpOwogICAgICBjb250YWluZXIucmVnaXN0ZXIoJ3NpbXBsZS1hdXRoLXNlc3Npb24tc3RvcmU6ZXBoZW1lcmFsJywgRXBoZW1lcmFsKTsKICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdzaW1wbGUtYXV0aC1zZXNzaW9uOm1haW4nLCBTZXNzaW9uKTsKICAgIH0KCiAgICB2YXIgZGlkU2V0dXBBamF4SG9va3MgPSBmYWxzZTsKCiAgICAvKioKICAgICAgQG1ldGhvZCBzZXR1cAogICAgICBAcHJpdmF0ZQogICAgKiovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gZnVuY3Rpb24oY29udGFpbmVyLCBhcHBsaWNhdGlvbikgewogICAgICBhcHBsaWNhdGlvbi5kZWZlclJlYWRpbmVzcygpOwogICAgICByZWdpc3RlckZhY3Rvcmllcyhjb250YWluZXIpOwoKICAgICAgdmFyIHN0b3JlICAgPSBjb250YWluZXIubG9va3VwKENvbmZpZ3VyYXRpb24uc3RvcmUpOwogICAgICB2YXIgc2Vzc2lvbiA9IGNvbnRhaW5lci5sb29rdXAoQ29uZmlndXJhdGlvbi5zZXNzaW9uKTsKICAgICAgc2Vzc2lvbi5zZXRQcm9wZXJ0aWVzKHsgc3RvcmU6IHN0b3JlLCBjb250YWluZXI6IGNvbnRhaW5lciB9KTsKICAgICAgRW1iZXIuQShbJ2NvbnRyb2xsZXInLCAncm91dGUnXSkuZm9yRWFjaChmdW5jdGlvbihjb21wb25lbnQpIHsKICAgICAgICBjb250YWluZXIuaW5qZWN0aW9uKGNvbXBvbmVudCwgQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lLCBDb25maWd1cmF0aW9uLnNlc3Npb24pOwogICAgICB9KTsKCiAgICAgIGNyb3NzT3JpZ2luV2hpdGVsaXN0ID0gRW1iZXIuQShDb25maWd1cmF0aW9uLmNyb3NzT3JpZ2luV2hpdGVsaXN0KS5tYXAoZnVuY3Rpb24ob3JpZ2luKSB7CiAgICAgICAgcmV0dXJuIGV4dHJhY3RMb2NhdGlvbk9yaWdpbihvcmlnaW4pOwogICAgICB9KTsKCiAgICAgIGlmICghRW1iZXIuaXNFbXB0eShDb25maWd1cmF0aW9uLmF1dGhvcml6ZXIpKSB7CiAgICAgICAgdmFyIGF1dGhvcml6ZXIgPSBjb250YWluZXIubG9va3VwKENvbmZpZ3VyYXRpb24uYXV0aG9yaXplcik7CiAgICAgICAgaWYgKCEhYXV0aG9yaXplcikgewogICAgICAgICAgYXV0aG9yaXplci5zZXQoJ3Nlc3Npb24nLCBzZXNzaW9uKTsKICAgICAgICAgIGlmICghZGlkU2V0dXBBamF4SG9va3MpIHsKICAgICAgICAgICAgRW1iZXIuJC5hamF4UHJlZmlsdGVyKGZ1bmN0aW9uKG9wdGlvbnMsIG9yaWdpbmFsT3B0aW9ucywganFYSFIpIHsKICAgICAgICAgICAgICBpZiAoIWF1dGhvcml6ZXIuaXNEZXN0cm95ZWQgJiYgc2hvdWxkQXV0aG9yaXplUmVxdWVzdChvcHRpb25zKSkgewogICAgICAgICAgICAgICAganFYSFIuX19zaW1wbGVfYXV0aF9hdXRob3JpemVkX18gPSB0cnVlOwogICAgICAgICAgICAgICAgYXV0aG9yaXplci5hdXRob3JpemUoanFYSFIsIG9wdGlvbnMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIEVtYmVyLiQoZG9jdW1lbnQpLmFqYXhFcnJvcihmdW5jdGlvbihldmVudCwganFYSFIsIHNldHRpbmcsIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgIGlmICghIWpxWEhSLl9fc2ltcGxlX2F1dGhfYXV0aG9yaXplZF9fICYmIGpxWEhSLnN0YXR1cyA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICBzZXNzaW9uLnRyaWdnZXIoJ2F1dGhvcml6YXRpb25GYWlsZWQnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkaWRTZXR1cEFqYXhIb29rcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIEVtYmVyLkxvZ2dlci5pbmZvKCdObyBhdXRob3JpemVyIHdhcyBjb25maWd1cmVkIGZvciBFbWJlciBTaW1wbGUgQXV0aCAtIHNwZWNpZnkgb25lIGlmIGJhY2tlbmQgcmVxdWVzdHMgbmVlZCB0byBiZSBhdXRob3JpemVkLicpOwogICAgICB9CgogICAgICB2YXIgYWR2YW5jZVJlYWRpbmVzcyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGFwcGxpY2F0aW9uLmFkdmFuY2VSZWFkaW5lc3MoKTsKICAgICAgfTsKICAgICAgc2Vzc2lvbi5yZXN0b3JlKCkudGhlbihhZHZhbmNlUmVhZGluZXNzLCBhZHZhbmNlUmVhZGluZXNzKTsKICAgIH0KICB9KTsKZGVmaW5lKCJzaW1wbGUtYXV0aC9zdG9yZXMvYmFzZSIsIAogIFsiLi4vdXRpbHMvb2JqZWN0cy1hcmUtZXF1YWwiLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIG9iamVjdHNBcmVFcXVhbCA9IF9fZGVwZW5kZW5jeTFfX1siZGVmYXVsdCJdOwoKICAgIC8qKgogICAgICBUaGUgYmFzZSBmb3IgYWxsIHN0b3JlIHR5cGVzLiBfX1RoaXMgc2VydmVzIGFzIGEgc3RhcnRpbmcgcG9pbnQgZm9yCiAgICAgIGltcGxlbWVudGluZyBjdXN0b20gc3RvcmVzIGFuZCBtdXN0IG5vdCBiZSB1c2VkIGRpcmVjdGx5Ll9fCgogICAgICBTdG9yZXMgYXJlIHVzZWQgdG8gcGVyc2lzdCB0aGUgc2Vzc2lvbidzIHN0YXRlIHNvIGl0IHN1cnZpdmVzIGEgcGFnZSByZWxvYWQKICAgICAgYW5kIGlzIHN5bmNocm9uaXplZCBhY3Jvc3MgbXVsdGlwbGUgdGFicyBvciB3aW5kb3dzIG9mIHRoZSBzYW1lIGFwcGxpY2F0aW9uLgogICAgICBUaGUgc3RvcmUgdG8gYmUgdXNlZCB3aXRoIHRoZSBhcHBsaWNhdGlvbiBjYW4gYmUgY29uZmlndXJlZCBvbiB0aGUKICAgICAgYXBwbGljYXRpb24ncyBlbnZpcm9ubWVudCBvYmplY3Q6CgogICAgICBgYGBqcwogICAgICBFTlZbJ3NpbXBsZS1hdXRoJ10gPSB7CiAgICAgICAgc3RvcmU6ICdzaW1wbGUtYXV0aC1zZXNzaW9uLXN0b3JlOmxvY2FsLXN0b3JhZ2UnCiAgICAgIH0KICAgICAgYGBgCgogICAgICBAY2xhc3MgQmFzZQogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGguU3RvcmVzCiAgICAgIEBtb2R1bGUgc2ltcGxlLWF1dGgvc3RvcmVzL2Jhc2UKICAgICAgQGV4dGVuZHMgRW1iZXIuT2JqZWN0CiAgICAgIEB1c2VzIEVtYmVyLkV2ZW50ZWQKICAgICovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gRW1iZXIuT2JqZWN0LmV4dGVuZChFbWJlci5FdmVudGVkLCB7CiAgICAgIC8qKgogICAgICAgIF9fVHJpZ2dlcmVkIHdoZW4gdGhlIGRhdGEgdGhhdCBjb25zdGl0dXRlcyB0aGUgc2Vzc2lvbiBjaGFuZ2VzIGluIHRoZQogICAgICAgIHN0b3JlLiBUaGlzIHVzdWFsbHkgaGFwcGVucyBiZWNhdXNlIHRoZSBzZXNzaW9uIGlzIGF1dGhlbnRpY2F0ZWQgb3IKICAgICAgICBpbnZhbGlkYXRlZCBpbiBhbm90aGVyIHRhYiBvciB3aW5kb3cuX18gVGhlIHNlc3Npb24gYXV0b21hdGljYWxseSBjYXRjaGVzCiAgICAgICAgdGhhdCBldmVudCwgcGFzc2VzIHRoZSB1cGRhdGVkIGRhdGEgdG8gaXRzIGF1dGhlbnRpY2F0b3IncwogICAgICAgIFtgQXV0aGVudGljYXRvcnMuQmFzZSNyZXN0b3JlYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZS1yZXN0b3JlKQogICAgICAgIG1ldGhvZCBhbmQgaGFuZGxlcyB0aGUgcmVzdWx0IG9mIHRoYXQgaW52b2NhdGlvbiBhY2NvcmRpbmdseS4KCiAgICAgICAgQGV2ZW50IHNlc3Npb25EYXRhVXBkYXRlZAogICAgICAgIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSB1cGRhdGVkIHNlc3Npb24gZGF0YQogICAgICAqLwoKICAgICAgLyoqCiAgICAgICAgUGVyc2lzdHMgdGhlIGBkYXRhYCBpbiB0aGUgc3RvcmUuIFRoaXMgYWN0dWFsbHkgcmVwbGFjZXMgYWxsIGN1cnJlbnRseQogICAgICAgIHN0b3JlZCBkYXRhLgoKICAgICAgICBgU3RvcmVzLkJhc2VgJ3MgaW1wbGVtZW50YXRpb24gZG9lcyBub3RoaW5nLgoKICAgICAgICBAbWV0aG9kIHBlcnNpc3QKICAgICAgICBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSB0byBwZXJzaXN0CiAgICAgICovCiAgICAgIHBlcnNpc3Q6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFJlc3RvcmVzIGFsbCBkYXRhIGN1cnJlbnRseSBzYXZlZCBpbiB0aGUgc3RvcmUgYXMgYSBwbGFpbiBvYmplY3QuCgogICAgICAgIGBTdG9yZXMuQmFzZWAncyBpbXBsZW1lbnRhdGlvbiBhbHdheXMgcmV0dXJucyBhbiBlbXB0eSBwbGFpbiBPYmplY3QuCgogICAgICAgIEBtZXRob2QgcmVzdG9yZQogICAgICAgIEByZXR1cm4ge09iamVjdH0gVGhlIGRhdGEgY3VycmVudGx5IHBlcnNpc3RlZCBpbiB0aGUgc3RvcmUuCiAgICAgICovCiAgICAgIHJlc3RvcmU6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB7fTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIENsZWFycyB0aGUgc3RvcmUuCgogICAgICAgIGBTdG9yZXMuQmFzZWAncyBpbXBsZW1lbnRhdGlvbiBkb2VzIG5vdGhpbmcuCgogICAgICAgIEBtZXRob2QgY2xlYXIKICAgICAgKi8KICAgICAgY2xlYXI6IGZ1bmN0aW9uKCkgewogICAgICB9CiAgICB9KTsKICB9KTsKZGVmaW5lKCJzaW1wbGUtYXV0aC9zdG9yZXMvZXBoZW1lcmFsIiwgCiAgWyIuL2Jhc2UiLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIEJhc2UgPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKCiAgICAvKioKICAgICAgU3RvcmUgdGhhdCBzYXZlcyBpdHMgZGF0YSBpbiBtZW1vcnkgYW5kIHRodXMgX19pcyBub3QgYWN0dWFsbHkgcGVyc2lzdGVudF9fLgogICAgICBJdCBkb2VzIGFsc28gbm90IHN5bmNocm9uaXplIHRoZSBzZXNzaW9uJ3Mgc3RhdGUgYWNyb3NzIG11bHRpcGxlIHRhYnMgb3IKICAgICAgd2luZG93cyBhcyB0aG9zZSBjYW5ub3Qgc2hhcmUgbWVtb3J5LgoKICAgICAgX19UaGlzIHN0b3JlIGlzIG1haW5seSB1c2VmdWwgZm9yIHRlc3RpbmcuX18KCiAgICAgIF9UaGUgZmFjdG9yeSBmb3IgdGhpcyBzdG9yZSBpcyByZWdpc3RlcmVkIGFzCiAgICAgIGAnc2ltcGxlLWF1dGgtc2Vzc2lvbi1zdG9yZTplcGhlbWVyYWwnYCBpbiBFbWJlcidzIGNvbnRhaW5lci5fCgogICAgICBAY2xhc3MgRXBoZW1lcmFsCiAgICAgIEBuYW1lc3BhY2UgU2ltcGxlQXV0aC5TdG9yZXMKICAgICAgQG1vZHVsZSBzaW1wbGUtYXV0aC9zdG9yZXMvZXBoZW1lcmFsCiAgICAgIEBleHRlbmRzIFN0b3Jlcy5CYXNlCiAgICAqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IEJhc2UuZXh0ZW5kKHsKICAgICAgLyoqCiAgICAgICAgQG1ldGhvZCBpbml0CiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgUGVyc2lzdHMgdGhlIGBkYXRhYC4KCiAgICAgICAgQG1ldGhvZCBwZXJzaXN0CiAgICAgICAgQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gcGVyc2lzdAogICAgICAqLwogICAgICBwZXJzaXN0OiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdGhpcy5fZGF0YSA9IEpTT04uc3RyaW5naWZ5KGRhdGEgfHwge30pOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgUmVzdG9yZXMgYWxsIGRhdGEgY3VycmVudGx5IHNhdmVkIGFzIGEgcGxhaW4gb2JqZWN0LgoKICAgICAgICBAbWV0aG9kIHJlc3RvcmUKICAgICAgICBAcmV0dXJuIHtPYmplY3R9IEFsbCBkYXRhIGN1cnJlbnRseSBwZXJzaXN0ZWQKICAgICAgKi8KICAgICAgcmVzdG9yZTogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodGhpcy5fZGF0YSkgfHwge307CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBDbGVhcnMgdGhlIHN0b3JlLgoKICAgICAgICBAbWV0aG9kIGNsZWFyCiAgICAgICovCiAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHsKICAgICAgICBkZWxldGUgdGhpcy5fZGF0YTsKICAgICAgICB0aGlzLl9kYXRhID0gJ3t9JzsKICAgICAgfQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvc3RvcmVzL2xvY2FsLXN0b3JhZ2UiLCAKICBbIi4vYmFzZSIsIi4uL3V0aWxzL29iamVjdHMtYXJlLWVxdWFsIiwiLi4vY29uZmlndXJhdGlvbiIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZGVwZW5kZW5jeTJfXywgX19kZXBlbmRlbmN5M19fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIEJhc2UgPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKICAgIHZhciBvYmplY3RzQXJlRXF1YWwgPSBfX2RlcGVuZGVuY3kyX19bImRlZmF1bHQiXTsKICAgIHZhciBDb25maWd1cmF0aW9uID0gX19kZXBlbmRlbmN5M19fWyJkZWZhdWx0Il07CgogICAgLyoqCiAgICAgIFN0b3JlIHRoYXQgc2F2ZXMgaXRzIGRhdGEgaW4gdGhlIGJyb3dzZXIncyBgbG9jYWxTdG9yYWdlYC4KCiAgICAgIF9UaGUgZmFjdG9yeSBmb3IgdGhpcyBzdG9yZSBpcyByZWdpc3RlcmVkIGFzCiAgICAgIGAnc2ltcGxlLWF1dGgtc2Vzc2lvbi1zdG9yZTpsb2NhbC1zdG9yYWdlJ2AgaW4gRW1iZXIncyBjb250YWluZXIuXwoKICAgICAgX19gU3RvcmVzLkxvY2FsU3RvcmFnZWAgaXMgRW1iZXIgU2ltcGxlIEF1dGgncyBkZWZhdWx0IHN0b3JlLl9fCgogICAgICBAY2xhc3MgTG9jYWxTdG9yYWdlCiAgICAgIEBuYW1lc3BhY2UgU2ltcGxlQXV0aC5TdG9yZXMKICAgICAgQG1vZHVsZSBzaW1wbGUtYXV0aC9zdG9yZXMvbG9jYWwtc3RvcmFnZQogICAgICBAZXh0ZW5kcyBTdG9yZXMuQmFzZQogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBCYXNlLmV4dGVuZCh7CiAgICAgIC8qKgogICAgICAgIFRoZSBrZXkgdGhlIHN0b3JlIHN0b3JlcyB0aGUgZGF0YSBpbi4KCiAgICAgICAgQHByb3BlcnR5IGtleQogICAgICAgIEB0eXBlIFN0cmluZwogICAgICAgIEBkZWZhdWx0ICdlbWJlcl9zaW1wbGVfYXV0aDpzZXNzaW9uJwogICAgICAqLwogICAgICBrZXk6ICdlbWJlcl9zaW1wbGVfYXV0aDpzZXNzaW9uJywKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgaW5pdAogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIGluaXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMua2V5ID0gQ29uZmlndXJhdGlvbi5sb2NhbFN0b3JhZ2VLZXk7CgogICAgICAgIHRoaXMuYmluZFRvU3RvcmFnZUV2ZW50cygpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgUGVyc2lzdHMgdGhlIGBkYXRhYCBpbiB0aGUgYGxvY2FsU3RvcmFnZWAuCgogICAgICAgIEBtZXRob2QgcGVyc2lzdAogICAgICAgIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBkYXRhIHRvIHBlcnNpc3QKICAgICAgKi8KICAgICAgcGVyc2lzdDogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhIHx8IHt9KTsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLmtleSwgZGF0YSk7CiAgICAgICAgdGhpcy5fbGFzdERhdGEgPSB0aGlzLnJlc3RvcmUoKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFJlc3RvcmVzIGFsbCBkYXRhIGN1cnJlbnRseSBzYXZlZCBpbiB0aGUgYGxvY2FsU3RvcmFnZWAgaWRlbnRpZmllZCBieSB0aGUKICAgICAgICBga2V5UHJlZml4YCBhcyBvbmUgcGxhaW4gb2JqZWN0LgoKICAgICAgICBAbWV0aG9kIHJlc3RvcmUKICAgICAgICBAcmV0dXJuIHtPYmplY3R9IEFsbCBkYXRhIGN1cnJlbnRseSBwZXJzaXN0ZWQgaW4gdGhlIGBsb2NhbFN0b3JhZ2VgCiAgICAgICovCiAgICAgIHJlc3RvcmU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBkYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5rZXkpOwogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGRhdGEpIHx8IHt9OwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgQ2xlYXJzIHRoZSBzdG9yZSBieSBkZWxldGluZyBhbGwgYGxvY2FsU3RvcmFnZWAga2V5cyBwcmVmaXhlZCB3aXRoIHRoZQogICAgICAgIGBrZXlQcmVmaXhgLgoKICAgICAgICBAbWV0aG9kIGNsZWFyCiAgICAgICovCiAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHsKICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLmtleSk7CiAgICAgICAgdGhpcy5fbGFzdERhdGEgPSBudWxsOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgQG1ldGhvZCBiaW5kVG9TdG9yYWdlRXZlbnRzCiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgYmluZFRvU3RvcmFnZUV2ZW50czogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICBFbWJlci4kKHdpbmRvdykuYmluZCgnc3RvcmFnZScsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIHZhciBkYXRhID0gX3RoaXMucmVzdG9yZSgpOwogICAgICAgICAgaWYgKCFvYmplY3RzQXJlRXF1YWwoZGF0YSwgX3RoaXMuX2xhc3REYXRhKSkgewogICAgICAgICAgICBfdGhpcy5fbGFzdERhdGEgPSBkYXRhOwogICAgICAgICAgICBfdGhpcy50cmlnZ2VyKCdzZXNzaW9uRGF0YVVwZGF0ZWQnLCBkYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvdXRpbHMvZ2V0LWdsb2JhbC1jb25maWciLCAKICBbImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIGdsb2JhbCA9ICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgPyB3aW5kb3cgOiB7fTsKCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgcmV0dXJuIEVtYmVyLmdldChnbG9iYWwsICdFTlYuJyArIHNjb3BlKSB8fCB7fTsKICAgIH0KICB9KTsKZGVmaW5lKCJzaW1wbGUtYXV0aC91dGlscy9sb2FkLWNvbmZpZyIsIAogIFsiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gZnVuY3Rpb24oZGVmYXVsdHMsIGNhbGxiYWNrKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihjb250YWluZXIsIGNvbmZpZykgewogICAgICAgIHZhciB3cmFwcGVkQ29uZmlnID0gRW1iZXIuT2JqZWN0LmNyZWF0ZShjb25maWcpOwogICAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHRoaXMpIHsKICAgICAgICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KHByb3BlcnR5KSAmJiBFbWJlci50eXBlT2YodGhpc1twcm9wZXJ0eV0pICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHRoaXNbcHJvcGVydHldID0gd3JhcHBlZENvbmZpZy5nZXRXaXRoRGVmYXVsdChwcm9wZXJ0eSwgZGVmYXVsdHNbcHJvcGVydHldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICBjYWxsYmFjay5hcHBseSh0aGlzLCBbY29udGFpbmVyLCBjb25maWddKTsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvdXRpbHMvb2JqZWN0cy1hcmUtZXF1YWwiLCAKICBbImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgLyoqCiAgICAgIEBtZXRob2Qgb2JqZWN0c0FyZUVxdWFsCiAgICAgIEBwcml2YXRlCiAgICAqLwogICAgZnVuY3Rpb24gb2JqZWN0c0FyZUVxdWFsKGEsIGIpIHsKICAgICAgaWYgKGEgPT09IGIpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpZiAoIShhIGluc3RhbmNlb2YgT2JqZWN0KSB8fCAhKGIgaW5zdGFuY2VvZiBPYmplY3QpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmKGEuY29uc3RydWN0b3IgIT09IGIuY29uc3RydWN0b3IpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIGEpIHsKICAgICAgICBpZiAoIWEuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFiLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoYVtwcm9wZXJ0eV0gPT09IGJbcHJvcGVydHldKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKEVtYmVyLnR5cGVPZihhW3Byb3BlcnR5XSkgIT09ICdvYmplY3QnKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghb2JqZWN0c0FyZUVxdWFsKGFbcHJvcGVydHldLCBiW3Byb3BlcnR5XSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAocHJvcGVydHkgaW4gYikgewogICAgICAgIGlmIChiLmhhc093blByb3BlcnR5KHByb3BlcnR5KSAmJiAhYS5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBvYmplY3RzQXJlRXF1YWw7CiAgfSk7CnZhciBpbml0aWFsaXplciAgICAgICAgICAgICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL2luaXRpYWxpemVyJylbJ2RlZmF1bHQnXTsKdmFyIENvbmZpZ3VyYXRpb24gICAgICAgICAgICAgICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvY29uZmlndXJhdGlvbicpWydkZWZhdWx0J107CnZhciBTZXNzaW9uICAgICAgICAgICAgICAgICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL3Nlc3Npb24nKVsnZGVmYXVsdCddOwp2YXIgQmFzZUF1dGhlbnRpY2F0b3IgICAgICAgICAgICAgPSByZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC9hdXRoZW50aWNhdG9ycy9iYXNlJylbJ2RlZmF1bHQnXTsKdmFyIEJhc2VBdXRob3JpemVyICAgICAgICAgICAgICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvYXV0aG9yaXplcnMvYmFzZScpWydkZWZhdWx0J107CnZhciBCYXNlU3RvcmUgICAgICAgICAgICAgICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL3N0b3Jlcy9iYXNlJylbJ2RlZmF1bHQnXTsKdmFyIExvY2FsU3RvcmFnZVN0b3JlICAgICAgICAgICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvc3RvcmVzL2xvY2FsLXN0b3JhZ2UnKVsnZGVmYXVsdCddOwp2YXIgRXBoZW1lcmFsU3RvcmUgICAgICAgICAgICAgICAgPSByZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC9zdG9yZXMvZXBoZW1lcmFsJylbJ2RlZmF1bHQnXTsKdmFyIG9iamVjdHNBcmVFcXVhbCAgICAgICAgICAgICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvdXRpbHMvb2JqZWN0cy1hcmUtZXF1YWwnKVsnZGVmYXVsdCddOwp2YXIgZ2V0R2xvYmFsQ29uZmlnICAgICAgICAgICAgICAgPSByZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC91dGlscy9nZXQtZ2xvYmFsLWNvbmZpZycpWydkZWZhdWx0J107CnZhciBsb2FkQ29uZmlnICAgICAgICAgICAgICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL3V0aWxzL2xvYWQtY29uZmlnJylbJ2RlZmF1bHQnXTsKdmFyIEFwcGxpY2F0aW9uUm91dGVNaXhpbiAgICAgICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvbWl4aW5zL2FwcGxpY2F0aW9uLXJvdXRlLW1peGluJylbJ2RlZmF1bHQnXTsKdmFyIEF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluICAgICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvbWl4aW5zL2F1dGhlbnRpY2F0ZWQtcm91dGUtbWl4aW4nKVsnZGVmYXVsdCddOwp2YXIgQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4gPSByZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC9taXhpbnMvYXV0aGVudGljYXRpb24tY29udHJvbGxlci1taXhpbicpWydkZWZhdWx0J107CnZhciBMb2dpbkNvbnRyb2xsZXJNaXhpbiAgICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL21peGlucy9sb2dpbi1jb250cm9sbGVyLW1peGluJylbJ2RlZmF1bHQnXTsKdmFyIFVuYXV0aGVudGljYXRlZFJvdXRlTWl4aW4gICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvbWl4aW5zL3VuYXV0aGVudGljYXRlZC1yb3V0ZS1taXhpbicpWydkZWZhdWx0J107CgpnbG9iYWwuU2ltcGxlQXV0aCA9IHsKICBDb25maWd1cmF0aW9uOiBDb25maWd1cmF0aW9uLAoKICBTZXNzaW9uOiBTZXNzaW9uLAoKICBBdXRoZW50aWNhdG9yczogewogICAgQmFzZTogQmFzZUF1dGhlbnRpY2F0b3IKICB9LAoKICBBdXRob3JpemVyczogewogICAgQmFzZTogQmFzZUF1dGhvcml6ZXIKICB9LAoKICBTdG9yZXM6IHsKICAgIEJhc2U6ICAgICAgICAgQmFzZVN0b3JlLAogICAgTG9jYWxTdG9yYWdlOiBMb2NhbFN0b3JhZ2VTdG9yZSwKICAgIEVwaGVtZXJhbDogICAgRXBoZW1lcmFsU3RvcmUKICB9LAoKICBVdGlsczogewogICAgb2JqZWN0c0FyZUVxdWFsOiBvYmplY3RzQXJlRXF1YWwsCiAgICBnZXRHbG9iYWxDb25maWc6IGdldEdsb2JhbENvbmZpZywKICAgIGxvYWRDb25maWc6ICAgICAgbG9hZENvbmZpZwogIH0sCgogIEFwcGxpY2F0aW9uUm91dGVNaXhpbjogICAgICAgICBBcHBsaWNhdGlvblJvdXRlTWl4aW4sCiAgQXV0aGVudGljYXRlZFJvdXRlTWl4aW46ICAgICAgIEF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluLAogIEF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluOiBBdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbiwKICBMb2dpbkNvbnRyb2xsZXJNaXhpbjogICAgICAgICAgTG9naW5Db250cm9sbGVyTWl4aW4sCiAgVW5hdXRoZW50aWNhdGVkUm91dGVNaXhpbjogICAgIFVuYXV0aGVudGljYXRlZFJvdXRlTWl4aW4KfTsKCnJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL2VtYmVyJyk7Cn0pKCh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykgPyBnbG9iYWwgOiB3aW5kb3cpOwo=",
                "body": "KGZ1bmN0aW9uKGdsb2JhbCkgewoKRW1iZXIubGlicmFyaWVzLnJlZ2lzdGVyKCdFbWJlciBTaW1wbGUgQXV0aCcsICcwLjcuMScpOwoKdmFyIGRlZmluZSwgcmVxdWlyZU1vZHVsZTsKCihmdW5jdGlvbigpIHsKICB2YXIgcmVnaXN0cnkgPSB7fSwgc2VlbiA9IHt9OwoKICBkZWZpbmUgPSBmdW5jdGlvbihuYW1lLCBkZXBzLCBjYWxsYmFjaykgewogICAgcmVnaXN0cnlbbmFtZV0gPSB7IGRlcHM6IGRlcHMsIGNhbGxiYWNrOiBjYWxsYmFjayB9OwogIH07CgogIHJlcXVpcmVNb2R1bGUgPSBmdW5jdGlvbihuYW1lKSB7CiAgICBpZiAoc2Vlbi5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgeyByZXR1cm4gc2VlbltuYW1lXTsgfQogICAgc2VlbltuYW1lXSA9IHt9OwoKICAgIGlmICghcmVnaXN0cnlbbmFtZV0pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgZmluZCBtb2R1bGUgIiArIG5hbWUpOwogICAgfQoKICAgIHZhciBtb2QgPSByZWdpc3RyeVtuYW1lXSwKICAgICAgICBkZXBzID0gbW9kLmRlcHMsCiAgICAgICAgY2FsbGJhY2sgPSBtb2QuY2FsbGJhY2ssCiAgICAgICAgcmVpZmllZCA9IFtdLAogICAgICAgIGV4cG9ydHM7CgogICAgZm9yICh2YXIgaT0wLCBsPWRlcHMubGVuZ3RoOyBpPGw7IGkrKykgewogICAgICBpZiAoZGVwc1tpXSA9PT0gJ2V4cG9ydHMnKSB7CiAgICAgICAgcmVpZmllZC5wdXNoKGV4cG9ydHMgPSB7fSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVpZmllZC5wdXNoKHJlcXVpcmVNb2R1bGUocmVzb2x2ZShkZXBzW2ldKSkpOwogICAgICB9CiAgICB9CgogICAgdmFyIHZhbHVlID0gY2FsbGJhY2suYXBwbHkodGhpcywgcmVpZmllZCk7CiAgICByZXR1cm4gc2VlbltuYW1lXSA9IGV4cG9ydHMgfHwgdmFsdWU7CgogICAgZnVuY3Rpb24gcmVzb2x2ZShjaGlsZCkgewogICAgICBpZiAoY2hpbGQuY2hhckF0KDApICE9PSAnLicpIHsgcmV0dXJuIGNoaWxkOyB9CiAgICAgIHZhciBwYXJ0cyA9IGNoaWxkLnNwbGl0KCIvIik7CiAgICAgIHZhciBwYXJlbnRCYXNlID0gbmFtZS5zcGxpdCgiLyIpLnNsaWNlKDAsIC0xKTsKCiAgICAgIGZvciAodmFyIGk9MCwgbD1wYXJ0cy5sZW5ndGg7IGk8bDsgaSsrKSB7CiAgICAgICAgdmFyIHBhcnQgPSBwYXJ0c1tpXTsKCiAgICAgICAgaWYgKHBhcnQgPT09ICcuLicpIHsgcGFyZW50QmFzZS5wb3AoKTsgfQogICAgICAgIGVsc2UgaWYgKHBhcnQgPT09ICcuJykgeyBjb250aW51ZTsgfQogICAgICAgIGVsc2UgeyBwYXJlbnRCYXNlLnB1c2gocGFydCk7IH0KICAgICAgfQoKICAgICAgcmV0dXJuIHBhcmVudEJhc2Uuam9pbigiLyIpOwogICAgfQogIH07CgogIHJlcXVpcmVNb2R1bGUucmVnaXN0cnkgPSByZWdpc3RyeTsKfSkoKTsKCmRlZmluZSgic2ltcGxlLWF1dGgvYXV0aGVudGljYXRvcnMvYmFzZSIsIAogIFsiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICAvKioKICAgICAgVGhlIGJhc2UgZm9yIGFsbCBhdXRoZW50aWNhdG9ycy4gX19UaGlzIHNlcnZlcyBhcyBhIHN0YXJ0aW5nIHBvaW50IGZvcgogICAgICBpbXBsZW1lbnRpbmcgY3VzdG9tIGF1dGhlbnRpY2F0b3JzIGFuZCBtdXN0IG5vdCBiZSB1c2VkIGRpcmVjdGx5Ll9fCgogICAgICBUaGUgYXV0aGVudGljYXRvciBhdXRoZW50aWNhdGVzIHRoZSBzZXNzaW9uLiBUaGUgYWN0dWFsIG1lY2hhbmlzbSB1c2VkIHRvIGRvCiAgICAgIHRoaXMgbWlnaHQgZS5nLiBiZSBwb3N0aW5nIGEgc2V0IG9mIGNyZWRlbnRpYWxzIHRvIGEgc2VydmVyIGFuZCBpbiBleGNoYW5nZQogICAgICByZXRyaWV2aW5nIGFuIGFjY2VzcyB0b2tlbiwgaW5pdGlhdGluZyBhdXRoZW50aWNhdGlvbiBhZ2FpbnN0IGFuIGV4dGVybmFsCiAgICAgIHByb3ZpZGVyIGxpa2UgRmFjZWJvb2sgZXRjLiBhbmQgZGVwZW5kcyBvbiB0aGUgc3BlY2lmaWMgYXV0aGVudGljYXRvci4gQW55CiAgICAgIGRhdGEgdGhhdCB0aGUgYXV0aGVudGljYXRvciByZWNlaXZlcyB1cG9uIHN1Y2Nlc3NmdWwgYXV0aGVudGljYXRpb24gYW5kCiAgICAgIHJlc29sdmVzIHdpdGggZnJvbSB0aGUKICAgICAgW2BBdXRoZW50aWNhdG9ycy5CYXNlI2F1dGhlbnRpY2F0ZWBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UtYXV0aGVudGljYXRlKQogICAgICBtZXRob2QgaXMgc3RvcmVkIGluIHRoZSBzZXNzaW9uIGFuZCBjYW4gdGhlbiBiZSB1c2VkIGJ5IHRoZSBhdXRob3JpemVyIChzZWUKICAgICAgW2BBdXRob3JpemVycy5CYXNlYF0oI1NpbXBsZUF1dGgtQXV0aG9yaXplcnMtQmFzZSkpLgoKICAgICAgVGhlIGF1dGhlbnRpY2F0b3IgYWxzbyBkZWNpZGVzIHdoZXRoZXIgYSBzZXQgb2YgZGF0YSB0aGF0IHdhcyByZXN0b3JlZCBmcm9tCiAgICAgIHRoZSBzZXNzaW9uIHN0b3JlIChzZWUKICAgICAgW2BTdG9yZXMuQmFzZWBdKCNTaW1wbGVBdXRoLVN0b3Jlcy1CYXNlKSkgaXMgc3VmZmljaWVudCBmb3IgdGhlIHNlc3Npb24gdG8gYmUKICAgICAgYXV0aGVudGljYXRlZCBvciBub3QuCgogICAgICBfX0N1c3RvbSBhdXRoZW50aWNhdG9ycyBoYXZlIHRvIGJlIHJlZ2lzdGVyZWQgd2l0aCBFbWJlcidzIGRlcGVuZGVuY3kKICAgICAgaW5qZWN0aW9uIGNvbnRhaW5lcl9fIHNvIHRoYXQgdGhlIHNlc3Npb24gY2FuIHJldHJpZXZlIGFuIGluc3RhbmNlLCBlLmcuOgoKICAgICAgYGBganMKICAgICAgaW1wb3J0IEJhc2UgZnJvbSAnc2ltcGxlLWF1dGgvYXV0aGVudGljYXRvcnMvYmFzZSc7CgogICAgICB2YXIgQ3VzdG9tQXV0aGVudGljYXRvciA9IEJhc2UuZXh0ZW5kKHsKICAgICAgICAuLi4KICAgICAgfSk7CgogICAgICBFbWJlci5BcHBsaWNhdGlvbi5pbml0aWFsaXplcih7CiAgICAgICAgbmFtZTogJ2F1dGhlbnRpY2F0aW9uJywKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbihjb250YWluZXIsIGFwcGxpY2F0aW9uKSB7CiAgICAgICAgICBjb250YWluZXIucmVnaXN0ZXIoJ2F1dGhlbnRpY2F0b3I6Y3VzdG9tJywgQ3VzdG9tQXV0aGVudGljYXRvcik7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgYGBgCgogICAgICBgYGBqcwogICAgICAvLyBhcHAvY29udHJvbGxlcnMvbG9naW4uanMKICAgICAgaW1wb3J0IEF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluIGZyb20gJ3NpbXBsZS1hdXRoL21peGlucy9hdXRoZW50aWNhdGlvbi1jb250cm9sbGVyLW1peGluJzsKCiAgICAgIGV4cG9ydCBkZWZhdWx0IEVtYmVyLkNvbnRyb2xsZXIuZXh0ZW5kKEF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluLCB7CiAgICAgICAgYXV0aGVudGljYXRvcjogJ2F1dGhlbnRpY2F0b3I6Y3VzdG9tJwogICAgICB9KTsKICAgICAgYGBgCgogICAgICBAY2xhc3MgQmFzZQogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGguQXV0aGVudGljYXRvcnMKICAgICAgQG1vZHVsZSBzaW1wbGUtYXV0aC9hdXRoZW50aWNhdG9ycy9iYXNlCiAgICAgIEBleHRlbmRzIEVtYmVyLk9iamVjdAogICAgICBAdXNlcyBFbWJlci5FdmVudGVkCiAgICAqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IEVtYmVyLk9iamVjdC5leHRlbmQoRW1iZXIuRXZlbnRlZCwgewogICAgICAvKioKICAgICAgICBfX1RyaWdnZXJlZCB3aGVuIHRoZSBkYXRhIHRoYXQgY29uc3RpdHV0ZXMgdGhlIHNlc3Npb24gaXMgdXBkYXRlZCBieSB0aGUKICAgICAgICBhdXRoZW50aWNhdG9yX18uIFRoaXMgbWlnaHQgaGFwcGVuIGUuZy4gYmVjYXVzZSB0aGUgYXV0aGVudGljYXRvciByZWZyZXNoZXMKICAgICAgICBpdCBvciBhbiBldmVudCBmcm9tIGlzIHRyaWdnZXJlZCBmcm9tIGFuIGV4dGVybmFsIGF1dGhlbnRpY2F0aW9uIHByb3ZpZGVyLgogICAgICAgIFRoZSBzZXNzaW9uIGF1dG9tYXRpY2FsbHkgY2F0Y2hlcyB0aGF0IGV2ZW50LCBwYXNzZXMgdGhlIHVwZGF0ZWQgZGF0YSBiYWNrCiAgICAgICAgdG8gdGhlIGF1dGhlbnRpY2F0b3IncwogICAgICAgIFtTaW1wbGVBdXRoLkF1dGhlbnRpY2F0b3JzLkJhc2UjcmVzdG9yZV0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZS1yZXN0b3JlKQogICAgICAgIG1ldGhvZCBhbmQgaGFuZGxlcyB0aGUgcmVzdWx0IG9mIHRoYXQgaW52b2NhdGlvbiBhY2NvcmRpbmdseS4KCiAgICAgICAgQGV2ZW50IHNlc3Npb25EYXRhVXBkYXRlZAogICAgICAgIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSB1cGRhdGVkIHNlc3Npb24gZGF0YQogICAgICAqLwogICAgICAvKioKICAgICAgICBfX1RyaWdnZXJlZCB3aGVuIHRoZSBkYXRhIHRoYXQgY29uc3RpdHV0ZXMgdGhlIHNlc3Npb24gaXMgaW52YWxpZGF0ZWQgYnkKICAgICAgICB0aGUgYXV0aGVudGljYXRvcl9fLiBUaGlzIG1pZ2h0IGhhcHBlbiBlLmcuIGJlY2F1c2UgdGhlIGRhdGUgZXhwaXJlcyBvciBhbgogICAgICAgIGV2ZW50IGlzIHRyaWdnZXJlZCBmcm9tIGFuIGV4dGVybmFsIGF1dGhlbnRpY2F0aW9uIHByb3ZpZGVyLiBUaGUgc2Vzc2lvbgogICAgICAgIGF1dG9tYXRpY2FsbHkgY2F0Y2hlcyB0aGF0IGV2ZW50IGFuZCBpbnZhbGlkYXRlcyBpdHNlbGYuCgogICAgICAgIEBldmVudCBzZXNzaW9uRGF0YUludmFsaWRhdGVkCiAgICAgICAgQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIHVwZGF0ZWQgc2Vzc2lvbiBkYXRhCiAgICAgICovCgogICAgICAvKioKICAgICAgICBSZXN0b3JlcyB0aGUgc2Vzc2lvbiBmcm9tIGEgc2V0IG9mIHByb3BlcnRpZXMuIF9fVGhpcyBtZXRob2QgaXMgaW52b2tlZCBieQogICAgICAgIHRoZSBzZXNzaW9uIGVpdGhlciBhZnRlciB0aGUgYXBwbGljYXRpb24gc3RhcnRzIHVwIGFuZCBzZXNzaW9uIGRhdGEgd2FzCiAgICAgICAgcmVzdG9yZWQgZnJvbSB0aGUgc3RvcmVfXyBvciB3aGVuIHByb3BlcnRpZXMgaW4gdGhlIHN0b3JlIGhhdmUgY2hhbmdlZCBkdWUKICAgICAgICB0byBleHRlcm5hbCBldmVudHMgKGUuZy4gaW4gYW5vdGhlciB0YWIpIGFuZCB0aGUgbmV3IHNldCBvZiBwcm9wZXJ0aWVzCiAgICAgICAgbmVlZHMgdG8gYmUgcmUtY2hlY2tlZCBmb3Igd2hldGhlciBpdCBzdGlsbCBjb25zdGl0dXRlcyBhbiBhdXRoZW50aWNhdGVkCiAgICAgICAgc2Vzc2lvbi4KCiAgICAgICAgX19UaGlzIG1ldGhvZCByZXR1cm5zIGEgcHJvbWlzZS4gQSByZXNvbHZpbmcgcHJvbWlzZSB3aWxsIHJlc3VsdCBpbiB0aGUKICAgICAgICBzZXNzaW9uIGJlaW5nIGF1dGhlbnRpY2F0ZWQuX18gQW55IHByb3BlcnRpZXMgdGhlIHByb21pc2UgcmVzb2x2ZXMgd2l0aAogICAgICAgIHdpbGwgYmUgc2F2ZWQgaW4gYW5kIGFjY2Vzc2libGUgdmlhIHRoZSBzZXNzaW9uLiBJbiBtb3N0IGNhc2VzIHRoZSBgZGF0YWAKICAgICAgICBhcmd1bWVudCB3aWxsIHNpbXBseSBiZSBmb3J3YXJkZWQgdGhyb3VnaCB0aGUgcHJvbWlzZS4gQSByZWplY3RpbmcgcHJvbWlzZQogICAgICAgIGluZGljYXRlcyB0aGF0IGF1dGhlbnRpY2F0aW9uIGZhaWxlZCBhbmQgdGhlIHNlc3Npb24gd2lsbCByZW1haW4gdW5jaGFuZ2VkLgoKICAgICAgICBgU2ltcGxlQXV0aC5BdXRoZW50aWNhdG9ycy5CYXNlYCdzIGltcGxlbWVudGF0aW9uIGFsd2F5cyByZXR1cm5zIGEKICAgICAgICByZWplY3RpbmcgcHJvbWlzZS4KCiAgICAgICAgQG1ldGhvZCByZXN0b3JlCiAgICAgICAgQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gcmVzdG9yZSB0aGUgc2Vzc2lvbiBmcm9tCiAgICAgICAgQHJldHVybiB7RW1iZXIuUlNWUC5Qcm9taXNlfSBBIHByb21pc2UgdGhhdCB3aGVuIGl0IHJlc29sdmVzIHJlc3VsdHMgaW4gdGhlIHNlc3Npb24gYmVpbmcgYXV0aGVudGljYXRlZAogICAgICAqLwogICAgICByZXN0b3JlOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBFbWJlci5SU1ZQLnJlamVjdCgpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgQXV0aGVudGljYXRlcyB0aGUgc2Vzc2lvbiB3aXRoIHRoZSBzcGVjaWZpZWQgYG9wdGlvbnNgLiBUaGVzZSBvcHRpb25zIHZhcnkKICAgICAgICBkZXBlbmRpbmcgb24gdGhlIGFjdHVhbCBhdXRoZW50aWNhdGlvbiBtZWNoYW5pc20gdGhlIGF1dGhlbnRpY2F0b3IKICAgICAgICBpbXBsZW1lbnRzIChlLmcuIGEgc2V0IG9mIGNyZWRlbnRpYWxzIG9yIGEgRmFjZWJvb2sgYWNjb3VudCBpZCBldGMuKS4gX19UaGUKICAgICAgICBzZXNzaW9uIHdpbGwgaW52b2tlIHRoaXMgbWV0aG9kIHdoZW4gYW4gYWN0aW9uIGluIHRoZSBhcHBsaWNhdGlvbiB0cmlnZ2VycwogICAgICAgIGF1dGhlbnRpY2F0aW9uX18gKHNlZQogICAgICAgIFtTaW1wbGVBdXRoLkF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluLmFjdGlvbnMjYXV0aGVudGljYXRlXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbi1hdXRoZW50aWNhdGUpKS4KCiAgICAgICAgX19UaGlzIG1ldGhvZCByZXR1cm5zIGEgcHJvbWlzZS4gQSByZXNvbHZpbmcgcHJvbWlzZSB3aWxsIHJlc3VsdCBpbiB0aGUKICAgICAgICBzZXNzaW9uIGJlaW5nIGF1dGhlbnRpY2F0ZWQuX18gQW55IHByb3BlcnRpZXMgdGhlIHByb21pc2UgcmVzb2x2ZXMgd2l0aAogICAgICAgIHdpbGwgYmUgc2F2ZWQgaW4gYW5kIGFjY2Vzc2libGUgdmlhIHRoZSBzZXNzaW9uLiBBIHJlamVjdGluZyBwcm9taXNlCiAgICAgICAgaW5kaWNhdGVzIHRoYXQgYXV0aGVudGljYXRpb24gZmFpbGVkIGFuZCB0aGUgc2Vzc2lvbiB3aWxsIHJlbWFpbiB1bmNoYW5nZWQuCgogICAgICAgIGBTaW1wbGVBdXRoLkF1dGhlbnRpY2F0b3JzLkJhc2VgJ3MgaW1wbGVtZW50YXRpb24gYWx3YXlzIHJldHVybnMgYQogICAgICAgIHJlamVjdGluZyBwcm9taXNlIGFuZCB0aHVzIG5ldmVyIGF1dGhlbnRpY2F0ZXMgdGhlIHNlc3Npb24uCgogICAgICAgIEBtZXRob2QgYXV0aGVudGljYXRlCiAgICAgICAgQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgVGhlIG9wdGlvbnMgdG8gYXV0aGVudGljYXRlIHRoZSBzZXNzaW9uIHdpdGgKICAgICAgICBAcmV0dXJuIHtFbWJlci5SU1ZQLlByb21pc2V9IEEgcHJvbWlzZSB0aGF0IHdoZW4gaXQgcmVzb2x2ZXMgcmVzdWx0cyBpbiB0aGUgc2Vzc2lvbiBiZWluZyBhdXRoZW50aWNhdGVkCiAgICAgICovCiAgICAgIGF1dGhlbnRpY2F0ZTogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgIHJldHVybiBuZXcgRW1iZXIuUlNWUC5yZWplY3QoKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFRoaXMgY2FsbGJhY2sgaXMgaW52b2tlZCB3aGVuIHRoZSBzZXNzaW9uIGlzIGludmFsaWRhdGVkLiBXaGlsZSB0aGUgc2Vzc2lvbgogICAgICAgIHdpbGwgaW52YWxpZGF0ZSBpdHNlbGYgYW5kIGNsZWFyIGFsbCBzZXNzaW9uIHByb3BlcnRpZXMsIGl0IG1pZ2h0IGJlCiAgICAgICAgbmVjZXNzYXJ5IGZvciBzb21lIGF1dGhlbnRpY2F0b3JzIHRvIHBlcmZvcm0gYWRkaXRpb25hbCB0YXNrcyAoZS5nLgogICAgICAgIGludmFsaWRhdGluZyBhbiBhY2Nlc3MgdG9rZW4gb24gdGhlIHNlcnZlciksIHdoaWNoIHNob3VsZCBiZSBkb25lIGluIHRoaXMKICAgICAgICBtZXRob2QuCgogICAgICAgIF9fVGhpcyBtZXRob2QgcmV0dXJucyBhIHByb21pc2UuIEEgcmVzb2x2aW5nIHByb21pc2Ugd2lsbCByZXN1bHQgaW4gdGhlCiAgICAgICAgc2Vzc2lvbiBiZWluZyBpbnZhbGlkYXRlZC5fXyBBIHJlamVjdGluZyBwcm9taXNlIHdpbGwgcmVzdWx0IGluIHRoZSBzZXNzaW9uCiAgICAgICAgaW52YWxpZGF0aW9uIGJlaW5nIGludGVyY2VwdGVkIGFuZCB0aGUgc2Vzc2lvbiBiZWluZyBsZWZ0IGF1dGhlbnRpY2F0ZWQuCgogICAgICAgIGBTaW1wbGVBdXRoLkF1dGhlbnRpY2F0b3JzLkJhc2VgJ3MgaW1wbGVtZW50YXRpb24gYWx3YXlzIHJldHVybnMgYQogICAgICAgIHJlc29sdmluZyBwcm9taXNlIGFuZCB0aHVzIG5ldmVyIGludGVyY2VwdHMgc2Vzc2lvbiBpbnZhbGlkYXRpb24uCgogICAgICAgIEBtZXRob2QgaW52YWxpZGF0ZQogICAgICAgIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBkYXRhIHRoYXQgdGhlIHNlc3Npb24gY3VycmVudGx5IGhvbGRzCiAgICAgICAgQHJldHVybiB7RW1iZXIuUlNWUC5Qcm9taXNlfSBBIHByb21pc2UgdGhhdCB3aGVuIGl0IHJlc29sdmVzIHJlc3VsdHMgaW4gdGhlIHNlc3Npb24gYmVpbmcgaW52YWxpZGF0ZWQKICAgICAgKi8KICAgICAgaW52YWxpZGF0ZTogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHJldHVybiBuZXcgRW1iZXIuUlNWUC5yZXNvbHZlKCk7CiAgICAgIH0KICAgIH0pOwogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL2F1dGhvcml6ZXJzL2Jhc2UiLCAKICBbImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgLyoqCiAgICAgIFRoZSBiYXNlIGZvciBhbGwgYXV0aG9yaXplcnMuIF9fVGhpcyBzZXJ2ZXMgYXMgYSBzdGFydGluZyBwb2ludCBmb3IKICAgICAgaW1wbGVtZW50aW5nIGN1c3RvbSBhdXRob3JpemVycyBhbmQgbXVzdCBub3QgYmUgdXNlZCBkaXJlY3RseS5fXwoKICAgICAgX19UaGUgYXV0aG9yaXplciBwcmVwcm9jZXNzZXMgYWxsIFhIUiByZXF1ZXN0c19fIChleGNlcHQgb25lcyB0byAzcmQgcGFydHkKICAgICAgb3JpZ2lucywgc2VlCiAgICAgIFtDb25maWd1cmF0aW9uLmNyb3NzT3JpZ2luV2hpdGVsaXN0XSgjU2ltcGxlQXV0aC1Db25maWd1cmF0aW9uLWNyb3NzT3JpZ2luV2hpdGVsaXN0KSkKICAgICAgYW5kIG1ha2VzIHN1cmUgdGhleSBoYXZlIHRoZSByZXF1aXJlZCBkYXRhIGF0dGFjaGVkIHRoYXQgYWxsb3dzIHRoZSBzZXJ2ZXIgdG8KICAgICAgaWRlbnRpZnkgdGhlIHVzZXIgbWFraW5nIHRoZSByZXF1ZXN0LiBUaGlzIGRhdGEgbWlnaHQgYmUgYW4gSFRUUCBoZWFkZXIsCiAgICAgIHF1ZXJ5IHN0cmluZyBwYXJhbWV0ZXJzIGluIHRoZSBVUkwsIGNvb2tpZXMgZXRjLiBfX1RoZSBhdXRob3JpemVyIGhhcyB0byBmaXQKICAgICAgdGhlIGF1dGhlbnRpY2F0b3JfXyAoc2VlCiAgICAgIFtTaW1wbGVBdXRoLkF1dGhlbnRpY2F0b3JzLkJhc2VdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UpKQogICAgICBhcyBpdCByZWxpZXMgb24gZGF0YSB0aGF0IHRoZSBhdXRoZW50aWNhdG9yIGFjcXVpcmVzIGR1cmluZyBhdXRoZW50aWNhdGlvbi4KCiAgICAgIEBjbGFzcyBCYXNlCiAgICAgIEBuYW1lc3BhY2UgU2ltcGxlQXV0aC5BdXRob3JpemVycwogICAgICBAbW9kdWxlIHNpbXBsZS1hdXRoL2F1dGhvcml6ZXJzL2Jhc2UKICAgICAgQGV4dGVuZHMgRW1iZXIuT2JqZWN0CiAgICAqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IEVtYmVyLk9iamVjdC5leHRlbmQoewogICAgICAvKioKICAgICAgICBUaGUgc2Vzc2lvbiB0aGUgYXV0aG9yaXplciBnZXRzIHRoZSBkYXRhIGl0IG5lZWRzIHRvIGF1dGhvcml6ZSByZXF1ZXN0cwogICAgICAgIGZyb20uCgogICAgICAgIEBwcm9wZXJ0eSBzZXNzaW9uCiAgICAgICAgQHJlYWRPbmx5CiAgICAgICAgQHR5cGUgU2ltcGxlQXV0aC5TZXNzaW9uCiAgICAgICAgQGRlZmF1bHQgdGhlIHNlc3Npb24gaW5zdGFuY2UKICAgICAgKi8KICAgICAgc2Vzc2lvbjogbnVsbCwKCiAgICAgIC8qKgogICAgICAgIEF1dGhvcml6ZXMgYW4gWEhSIHJlcXVlc3QgYnkgYWRkaW5nIHNvbWUgc29ydCBvZiBzZWNyZXQgaW5mb3JtYXRpb24gdGhhdAogICAgICAgIGFsbG93cyB0aGUgc2VydmVyIHRvIGlkZW50aWZ5IHRoZSB1c2VyIG1ha2luZyB0aGUgcmVxdWVzdCAoZS5nLiBhIHRva2VuIGluCiAgICAgICAgdGhlIGBBdXRob3JpemF0aW9uYCBoZWFkZXIgb3Igc29tZSBvdGhlciBzZWNyZXQgaW4gdGhlIHF1ZXJ5IHN0cmluZyBldGMuKS4KCiAgICAgICAgYFNpbXBsZUF1dGguQXV0aG9yaXplcnMuQmFzZWAncyBpbXBsZW1lbnRhdGlvbiBkb2VzIG5vdGhpbmcuCgogICAgICAgIEBtZXRob2QgYXV0aG9yaXplCiAgICAgICAgQHBhcmFtIHtqcVhIUn0ganFYSFIgVGhlIFhIUiByZXF1ZXN0IHRvIGF1dGhvcml6ZSAoc2VlIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9qUXVlcnkuYWpheC8janFYSFIpCiAgICAgICAgQHBhcmFtIHtPYmplY3R9IHJlcXVlc3RPcHRpb25zIFRoZSBvcHRpb25zIGFzIHByb3ZpZGVkIHRvIHRoZSBgJC5hamF4YCBtZXRob2QgKHNlZSBodHRwOi8vYXBpLmpxdWVyeS5jb20valF1ZXJ5LmFqYXhQcmVmaWx0ZXIvKQogICAgICAqLwogICAgICBhdXRob3JpemU6IGZ1bmN0aW9uKGpxWEhSLCByZXF1ZXN0T3B0aW9ucykgewogICAgICB9CiAgICB9KTsKICB9KTsKZGVmaW5lKCJzaW1wbGUtYXV0aC9jb25maWd1cmF0aW9uIiwgCiAgWyJzaW1wbGUtYXV0aC91dGlscy9sb2FkLWNvbmZpZyIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgbG9hZENvbmZpZyA9IF9fZGVwZW5kZW5jeTFfX1siZGVmYXVsdCJdOwoKICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgYXV0aGVudGljYXRpb25Sb3V0ZTogICAgICAgICAnbG9naW4nLAogICAgICByb3V0ZUFmdGVyQXV0aGVudGljYXRpb246ICAgICdpbmRleCcsCiAgICAgIHJvdXRlSWZBbHJlYWR5QXV0aGVudGljYXRlZDogJ2luZGV4JywKICAgICAgc2Vzc2lvblByb3BlcnR5TmFtZTogICAgICAgICAnc2Vzc2lvbicsCiAgICAgIGF1dGhvcml6ZXI6ICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgc2Vzc2lvbjogICAgICAgICAgICAgICAgICAgICAnc2ltcGxlLWF1dGgtc2Vzc2lvbjptYWluJywKICAgICAgc3RvcmU6ICAgICAgICAgICAgICAgICAgICAgICAnc2ltcGxlLWF1dGgtc2Vzc2lvbi1zdG9yZTpsb2NhbC1zdG9yYWdlJywKICAgICAgbG9jYWxTdG9yYWdlS2V5OiAgICAgICAgICAgICAnZW1iZXJfc2ltcGxlX2F1dGg6c2Vzc2lvbicsCiAgICAgIGNyb3NzT3JpZ2luV2hpdGVsaXN0OiAgICAgICAgW10sCiAgICAgIGFwcGxpY2F0aW9uUm9vdFVybDogICAgICAgICAgbnVsbAogICAgfTsKCiAgICAvKioKICAgICAgRW1iZXIgU2ltcGxlIEF1dGgncyBjb25maWd1cmF0aW9uIG9iamVjdC4KCiAgICAgIFRvIGNoYW5nZSBhbnkgb2YgdGhlc2UgdmFsdWVzLCBzZXQgdGhlbSBvbiB0aGUgYXBwbGljYXRpb24ncyBlbnZpcm9ubWVudAogICAgICBvYmplY3Q6CgogICAgICBgYGBqcwogICAgICBFTlZbJ3NpbXBsZS1hdXRoJ10gPSB7CiAgICAgICAgYXV0aGVudGljYXRpb25Sb3V0ZTogJ3NpZ24taW4nCiAgICAgIH07CiAgICAgIGBgYAoKICAgICAgQGNsYXNzIENvbmZpZ3VyYXRpb24KICAgICAgQG5hbWVzcGFjZSBTaW1wbGVBdXRoCiAgICAgIEBtb2R1bGUgc2ltcGxlLWF1dGgvY29uZmlndXJhdGlvbgogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSB7CiAgICAgIC8qKgogICAgICAgIFRoZSByb3V0ZSB0byB0cmFuc2l0aW9uIHRvIGZvciBhdXRoZW50aWNhdGlvbi4KCiAgICAgICAgQHByb3BlcnR5IGF1dGhlbnRpY2F0aW9uUm91dGUKICAgICAgICBAcmVhZE9ubHkKICAgICAgICBAc3RhdGljCiAgICAgICAgQHR5cGUgU3RyaW5nCiAgICAgICAgQGRlZmF1bHQgJ2xvZ2luJwogICAgICAqLwogICAgICBhdXRoZW50aWNhdGlvblJvdXRlOiBkZWZhdWx0cy5hdXRoZW50aWNhdGlvblJvdXRlLAoKICAgICAgLyoqCiAgICAgICAgVGhlIHJvdXRlIHRvIHRyYW5zaXRpb24gdG8gYWZ0ZXIgc3VjY2Vzc2Z1bCBhdXRoZW50aWNhdGlvbi4KCiAgICAgICAgQHByb3BlcnR5IHJvdXRlQWZ0ZXJBdXRoZW50aWNhdGlvbgogICAgICAgIEByZWFkT25seQogICAgICAgIEBzdGF0aWMKICAgICAgICBAdHlwZSBTdHJpbmcKICAgICAgICBAZGVmYXVsdCAnaW5kZXgnCiAgICAgICovCiAgICAgIHJvdXRlQWZ0ZXJBdXRoZW50aWNhdGlvbjogZGVmYXVsdHMucm91dGVBZnRlckF1dGhlbnRpY2F0aW9uLAoKICAgICAgLyoqCiAgICAgICAgVGhlIHJvdXRlIHRvIHRyYW5zaXRpb24gdG8gaWYgYSByb3V0ZSB0aGF0IGltcGxlbWVudHMKICAgICAgICBbYFVuYXV0aGVudGljYXRlZFJvdXRlTWl4aW5gXSgjU2ltcGxlQXV0aC1VbmF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluKSBpcwogICAgICAgIGFjY2Vzc2VkIHdoZW4gdGhlIHNlc3Npb24gaXMgYXV0aGVudGljYXRlZC4KCiAgICAgICAgQHByb3BlcnR5IHJvdXRlSWZBbHJlYWR5QXV0aGVudGljYXRlZAogICAgICAgIEByZWFkT25seQogICAgICAgIEBzdGF0aWMKICAgICAgICBAdHlwZSBTdHJpbmcKICAgICAgICBAZGVmYXVsdCAnaW5kZXgnCiAgICAgICovCiAgICAgIHJvdXRlSWZBbHJlYWR5QXV0aGVudGljYXRlZDogZGVmYXVsdHMucm91dGVJZkFscmVhZHlBdXRoZW50aWNhdGVkLAoKICAgICAgLyoqCiAgICAgICAgVGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5IHRoYXQgdGhlIHNlc3Npb24gaXMgaW5qZWN0ZWQgd2l0aCBpbnRvIHJvdXRlcyBhbmQKICAgICAgICBjb250cm9sbGVycy4KCiAgICAgICAgQHByb3BlcnR5IHNlc3Npb25Qcm9wZXJ0eU5hbWUKICAgICAgICBAcmVhZE9ubHkKICAgICAgICBAc3RhdGljCiAgICAgICAgQHR5cGUgU3RyaW5nCiAgICAgICAgQGRlZmF1bHQgJ3Nlc3Npb24nCiAgICAgICovCiAgICAgIHNlc3Npb25Qcm9wZXJ0eU5hbWU6IGRlZmF1bHRzLnNlc3Npb25Qcm9wZXJ0eU5hbWUsCgogICAgICAvKioKICAgICAgICBUaGUgYXV0aG9yaXplciBmYWN0b3J5IHRvIHVzZSBhcyBpdCBpcyByZWdpc3RlcmVkIHdpdGggRW1iZXIncyBjb250YWluZXIsCiAgICAgICAgc2VlCiAgICAgICAgW0VtYmVyJ3MgQVBJIGRvY3NdKGh0dHA6Ly9lbWJlcmpzLmNvbS9hcGkvY2xhc3Nlcy9FbWJlci5BcHBsaWNhdGlvbi5odG1sI21ldGhvZF9yZWdpc3Rlcik7CiAgICAgICAgd2hlbiB0aGUgYXBwbGljYXRpb24gZG9lcyBub3QgaW50ZXJhY3Qgd2l0aCBhIHNlcnZlciB0aGF0IHJlcXVpcmVzCiAgICAgICAgYXV0aG9yaXplZCByZXF1ZXN0cywgbm8gYXV6dGhvcml6ZXIgaXMgbmVlZGVkLgoKICAgICAgICBAcHJvcGVydHkgYXV0aG9yaXplcgogICAgICAgIEByZWFkT25seQogICAgICAgIEBzdGF0aWMKICAgICAgICBAdHlwZSBTdHJpbmcKICAgICAgICBAZGVmYXVsdCBudWxsCiAgICAgICovCiAgICAgIGF1dGhvcml6ZXI6IGRlZmF1bHRzLmF1dGhvcml6ZXIsCgogICAgICAvKioKICAgICAgICBUaGUgc2Vzc2lvbiBmYWN0b3J5IHRvIHVzZSBhcyBpdCBpcyByZWdpc3RlcmVkIHdpdGggRW1iZXIncyBjb250YWluZXIsCiAgICAgICAgc2VlCiAgICAgICAgW0VtYmVyJ3MgQVBJIGRvY3NdKGh0dHA6Ly9lbWJlcmpzLmNvbS9hcGkvY2xhc3Nlcy9FbWJlci5BcHBsaWNhdGlvbi5odG1sI21ldGhvZF9yZWdpc3RlcikuCgogICAgICAgIEBwcm9wZXJ0eSBzZXNzaW9uCiAgICAgICAgQHJlYWRPbmx5CiAgICAgICAgQHN0YXRpYwogICAgICAgIEB0eXBlIFN0cmluZwogICAgICAgIEBkZWZhdWx0ICdzaW1wbGUtYXV0aC1zZXNzaW9uOm1haW4nCiAgICAgICovCiAgICAgIHNlc3Npb246IGRlZmF1bHRzLnNlc3Npb24sCgogICAgICAvKioKICAgICAgICBUaGUgc3RvcmUgZmFjdG9yeSB0byB1c2UgYXMgaXQgaXMgcmVnaXN0ZXJlZCB3aXRoIEVtYmVyJ3MgY29udGFpbmVyLCBzZWUKICAgICAgICBbRW1iZXIncyBBUEkgZG9jc10oaHR0cDovL2VtYmVyanMuY29tL2FwaS9jbGFzc2VzL0VtYmVyLkFwcGxpY2F0aW9uLmh0bWwjbWV0aG9kX3JlZ2lzdGVyKS4KCiAgICAgICAgQHByb3BlcnR5IHN0b3JlCiAgICAgICAgQHJlYWRPbmx5CiAgICAgICAgQHN0YXRpYwogICAgICAgIEB0eXBlIFN0cmluZwogICAgICAgIEBkZWZhdWx0IHNpbXBsZS1hdXRoLXNlc3Npb24tc3RvcmU6bG9jYWwtc3RvcmFnZQogICAgICAqLwogICAgICBzdG9yZTogZGVmYXVsdHMuc3RvcmUsCgogICAgICAvKioKICAgICAgICBUaGUga2V5IHRoZSBzdG9yZSBzdG9yZXMgdGhlIGRhdGEgaW4uCgogICAgICAgIEBwcm9wZXJ0eSBrZXkKICAgICAgICBAdHlwZSBTdHJpbmcKICAgICAgICBAZGVmYXVsdCAnZW1iZXJfc2ltcGxlX2F1dGg6c2Vzc2lvbicKICAgICAgKi8KICAgICAgbG9jYWxTdG9yYWdlS2V5OiBkZWZhdWx0cy5sb2NhbFN0b3JhZ2VLZXksCgogICAgICAvKioKICAgICAgICBFbWJlciBTaW1wbGUgQXV0aCB3aWxsIG5ldmVyIGF1dGhvcml6ZSByZXF1ZXN0cyBnb2luZyB0byBhIGRpZmZlcmVudCBvcmlnaW4KICAgICAgICB0aGFuIHRoZSBvbmUgdGhlIEVtYmVyLmpzIGFwcGxpY2F0aW9uIHdhcyBsb2FkZWQgZnJvbTsgdG8gZXhwbGljaXRlbHkKICAgICAgICBlbmFibGUgYXV0aG9yaXphdGlvbiBmb3IgYWRkaXRpb25hbCBvcmlnaW5zLCB3aGl0ZWxpc3QgdGhvc2Ugb3JpZ2lucyB3aXRoCiAgICAgICAgdGhpcyBzZXR0aW5nLiBfQmV3YXJlIHRoYXQgb3JpZ2lucyBjb25zaXN0IG9mIHByb3RvY29sLCBob3N0IGFuZCBwb3J0IChwb3J0CiAgICAgICAgY2FuIGJlIGxlZnQgb3V0IHdoZW4gaXQgaXMgODAgZm9yIEhUVFAgb3IgNDQzIGZvciBIVFRQUylfCgogICAgICAgIEBwcm9wZXJ0eSBjcm9zc09yaWdpbldoaXRlbGlzdAogICAgICAgIEByZWFkT25seQogICAgICAgIEBzdGF0aWMKICAgICAgICBAdHlwZSBBcnJheQogICAgICAgIEBkZWZhdWx0IFtdCiAgICAgICovCiAgICAgIGNyb3NzT3JpZ2luV2hpdGVsaXN0OiBkZWZhdWx0cy5jcm9zc09yaWdpbldoaXRlbGlzdCwKCiAgICAgIC8qKgogICAgICAgIEBwcm9wZXJ0eSBhcHBsaWNhdGlvblJvb3RVcmwKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICBhcHBsaWNhdGlvblJvb3RVcmw6IGRlZmF1bHRzLmFwcGxpY2F0aW9uUm9vdFVybCwKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgbG9hZAogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIGxvYWQ6IGxvYWRDb25maWcoZGVmYXVsdHMsIGZ1bmN0aW9uKGNvbnRhaW5lciwgY29uZmlnKSB7CiAgICAgICAgdGhpcy5hcHBsaWNhdGlvblJvb3RVcmwgPSBjb250YWluZXIubG9va3VwKCdyb3V0ZXI6bWFpbicpLmdldCgncm9vdFVSTCcpIHx8ICcvJzsKICAgICAgfSkKICAgIH07CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvZW1iZXIiLCAKICBbIi4vaW5pdGlhbGl6ZXIiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBpbml0aWFsaXplciA9IF9fZGVwZW5kZW5jeTFfX1siZGVmYXVsdCJdOwoKICAgIEVtYmVyLm9uTG9hZCgnRW1iZXIuQXBwbGljYXRpb24nLCBmdW5jdGlvbihBcHBsaWNhdGlvbikgewogICAgICBBcHBsaWNhdGlvbi5pbml0aWFsaXplcihpbml0aWFsaXplcik7CiAgICB9KTsKICB9KTsKZGVmaW5lKCJzaW1wbGUtYXV0aC9pbml0aWFsaXplciIsIAogIFsiLi9jb25maWd1cmF0aW9uIiwiLi91dGlscy9nZXQtZ2xvYmFsLWNvbmZpZyIsIi4vc2V0dXAiLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2RlcGVuZGVuY3kyX18sIF9fZGVwZW5kZW5jeTNfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBDb25maWd1cmF0aW9uID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CiAgICB2YXIgZ2V0R2xvYmFsQ29uZmlnID0gX19kZXBlbmRlbmN5Ml9fWyJkZWZhdWx0Il07CiAgICB2YXIgc2V0dXAgPSBfX2RlcGVuZGVuY3kzX19bImRlZmF1bHQiXTsKCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gewogICAgICBuYW1lOiAgICAgICAnc2ltcGxlLWF1dGgnLAogICAgICBpbml0aWFsaXplOiBmdW5jdGlvbihjb250YWluZXIsIGFwcGxpY2F0aW9uKSB7CiAgICAgICAgdmFyIGNvbmZpZyA9IGdldEdsb2JhbENvbmZpZygnc2ltcGxlLWF1dGgnKTsKICAgICAgICBDb25maWd1cmF0aW9uLmxvYWQoY29udGFpbmVyLCBjb25maWcpOwogICAgICAgIHNldHVwKGNvbnRhaW5lciwgYXBwbGljYXRpb24pOwogICAgICB9CiAgICB9OwogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL21peGlucy9hcHBsaWNhdGlvbi1yb3V0ZS1taXhpbiIsIAogIFsiLi8uLi9jb25maWd1cmF0aW9uIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBDb25maWd1cmF0aW9uID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CgogICAgLyoqCiAgICAgIFRoZSBtaXhpbiBmb3IgdGhlIGFwcGxpY2F0aW9uIHJvdXRlOyBkZWZpbmVzIGFjdGlvbnMgdG8gYXV0aGVudGljYXRlIHRoZQogICAgICBzZXNzaW9uIGFzIHdlbGwgYXMgdG8gaW52YWxpZGF0ZSBpdC4gVGhlc2UgYWN0aW9ucyBjYW4gYmUgdXNlZCBpbiBhbGwKICAgICAgdGVtcGxhdGVzIGxpa2UgdGhpczoKCiAgICAgIGBgYGhhbmRsZWJhcnMKICAgICAge3sjaWYgc2Vzc2lvbi5pc0F1dGhlbnRpY2F0ZWR9fQogICAgICAgIDxhIHt7IGFjdGlvbiAnaW52YWxpZGF0ZVNlc3Npb24nIH19PkxvZ291dDwvYT4KICAgICAge3tlbHNlfX0KICAgICAgICA8YSB7eyBhY3Rpb24gJ2F1dGhlbnRpY2F0ZVNlc3Npb24nIH19PkxvZ2luPC9hPgogICAgICB7ey9pZn19CiAgICAgIGBgYAoKICAgICAgb3IgaW4gdGhlIGNhc2UgdGhhdCB0aGUgYXBwbGljYXRpb24gdXNlcyBhIGRlZGljYXRlZCByb3V0ZSBmb3IgbG9nZ2luZyBpbjoKCiAgICAgIGBgYGhhbmRsZWJhcnMKICAgICAge3sjaWYgc2Vzc2lvbi5pc0F1dGhlbnRpY2F0ZWR9fQogICAgICAgIDxhIHt7IGFjdGlvbiAnaW52YWxpZGF0ZVNlc3Npb24nIH19PkxvZ291dDwvYT4KICAgICAge3tlbHNlfX0KICAgICAgICB7eyNsaW5rLXRvICdsb2dpbid9fUxvZ2lue3svbGluay10b319CiAgICAgIHt7L2lmfX0KICAgICAgYGBgCgogICAgICBUaGlzIG1peGluIGFsc28gZGVmaW5lcyBhY3Rpb25zIHRoYXQgYXJlIHRyaWdnZXJlZCB3aGVuZXZlciB0aGUgc2Vzc2lvbiBpcwogICAgICBzdWNjZXNzZnVsbHkgYXV0aGVudGljYXRlZCBvciBpbnZhbGlkYXRlZCBhbmQgd2hlbmV2ZXIgYXV0aGVudGljYXRpb24gb3IKICAgICAgaW52YWxpZGF0aW9uIGZhaWxzLiBUaGVzZSBhY3Rpb25zIHByb3ZpZGUgYSBnb29kIHN0YXJ0aW5nIHBvaW50IGZvciBhZGRpbmcKICAgICAgY3VzdG9tIGJlaGF2aW9yIHRvIHRoZXNlIGV2ZW50cy4KCiAgICAgIF9fV2hlbiB0aGlzIG1peGluIGlzIHVzZWQgYW5kIHRoZSBhcHBsaWNhdGlvbidzIGBBcHBsaWNhdGlvblJvdXRlYCBkZWZpbmVzCiAgICAgIHRoZSBgYmVmb3JlTW9kZWxgIG1ldGhvZCwgdGhhdCBtZXRob2QgaGFzIHRvIGNhbGwgYF9zdXBlcmAuX18KCiAgICAgIFVzaW5nIHRoaXMgbWl4aW4gaXMgb3B0aW9uYWwuIFdpdGhvdXQgdXNpbmcgaXQsIHRoZSBzZXNzaW9uJ3MgZXZlbnRzIHdpbGwgbm90CiAgICAgIGJlIGF1dG9tYXRpY2FsbHkgdHJhbnNsYXRlZCBpbnRvIHJvdXRlIGFjdGlvbnMgYnV0IHdvdWxkIGhhdmUgdG8gYmUgaGFuZGxlZAogICAgICBpbmlkaXZpYWxseSwgZS5nLiBpbiBhbiBpbml0aWFsaXplcjoKCiAgICAgIGBgYGpzCiAgICAgIEVtYmVyLkFwcGxpY2F0aW9uLmluaXRpYWxpemVyKHsKICAgICAgICBuYW1lOiAgICAgICAnYXV0aGVudGljYXRpb24nLAogICAgICAgIGFmdGVyOiAgICAgICdzaW1wbGUtYXV0aCcsCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY29udGFpbmVyLCBhcHBsaWNhdGlvbikgewogICAgICAgICAgdmFyIGFwcGxpY2F0aW9uUm91dGUgPSBjb250YWluZXIubG9va3VwKCdyb3V0ZTphcHBsaWNhdGlvbicpOwogICAgICAgICAgdmFyIHNlc3Npb24gICAgICAgICAgPSBjb250YWluZXIubG9va3VwKCdzaW1wbGUtYXV0aC1zZXNzaW9uOm1haW4nKTsKICAgICAgICAgIC8vIGhhbmRsZSB0aGUgc2Vzc2lvbiBldmVudHMKICAgICAgICAgIHNlc3Npb24ub24oJ3Nlc3Npb25BdXRoZW50aWNhdGlvblN1Y2NlZWRlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBhcHBsaWNhdGlvblJvdXRlLnRyYW5zaXRpb25UbygnaW5kZXgnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGBgYAoKICAgICAgQGNsYXNzIEFwcGxpY2F0aW9uUm91dGVNaXhpbgogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGgKICAgICAgQG1vZHVsZSBzaW1wbGUtYXV0aC9taXhpbnMvYXBwbGljYXRpb24tcm91dGUtbWl4aW4KICAgICAgQGV4dGVuZHMgRW1iZXIuTWl4aW4KICAgICAgQHN0YXRpYwogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBFbWJlci5NaXhpbi5jcmVhdGUoewogICAgICAvKioKICAgICAgICBAbWV0aG9kIGJlZm9yZU1vZGVsCiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgYmVmb3JlTW9kZWw6IGZ1bmN0aW9uKHRyYW5zaXRpb24pIHsKICAgICAgICB0aGlzLl9zdXBlcih0cmFuc2l0aW9uKTsKICAgICAgICBpZiAoIXRoaXMuZ2V0KCdfYXV0aEV2ZW50TGlzdGVuZXJzQXNzaWduZWQnKSkgewogICAgICAgICAgdGhpcy5zZXQoJ19hdXRoRXZlbnRMaXN0ZW5lcnNBc3NpZ25lZCcsIHRydWUpOwogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgIEVtYmVyLkEoWwogICAgICAgICAgICAnc2Vzc2lvbkF1dGhlbnRpY2F0aW9uU3VjY2VlZGVkJywKICAgICAgICAgICAgJ3Nlc3Npb25BdXRoZW50aWNhdGlvbkZhaWxlZCcsCiAgICAgICAgICAgICdzZXNzaW9uSW52YWxpZGF0aW9uU3VjY2VlZGVkJywKICAgICAgICAgICAgJ3Nlc3Npb25JbnZhbGlkYXRpb25GYWlsZWQnLAogICAgICAgICAgICAnYXV0aG9yaXphdGlvbkZhaWxlZCcKICAgICAgICAgIF0pLmZvckVhY2goZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgX3RoaXMuZ2V0KENvbmZpZ3VyYXRpb24uc2Vzc2lvblByb3BlcnR5TmFtZSkub24oZXZlbnQsIGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnVuc2hpZnQuY2FsbChhcmd1bWVudHMsIGV2ZW50KTsKICAgICAgICAgICAgICB0cmFuc2l0aW9uLnNlbmQuYXBwbHkodHJhbnNpdGlvbiwgYXJndW1lbnRzKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBhY3Rpb25zOiB7CiAgICAgICAgLyoqCiAgICAgICAgICBUaGlzIGFjdGlvbiB0cmlnZ2VycyB0cmFuc2l0aW9uIHRvIHRoZQogICAgICAgICAgW2BDb25maWd1cmF0aW9uLmF1dGhlbnRpY2F0aW9uUm91dGVgXSgjU2ltcGxlQXV0aC1Db25maWd1cmF0aW9uLWF1dGhlbnRpY2F0aW9uUm91dGUpLgogICAgICAgICAgSXQgY2FuIGJlIHVzZWQgaW4gdGVtcGxhdGVzIGFzIHNob3duIGFib3ZlLiBJdCBpcyBhbHNvIHRyaWdnZXJlZAogICAgICAgICAgYXV0b21hdGljYWxseSBieSB0aGUKICAgICAgICAgIFtgQXV0aGVudGljYXRlZFJvdXRlTWl4aW5gXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdGVkUm91dGVNaXhpbikgd2hlbmV2ZXIKICAgICAgICAgIGEgcm91dGUgdGhhdCByZXF1cmllcyBhdXRoZW50aWNhdGlvbiBpcyBhY2Nlc3NlZCBidXQgdGhlIHNlc3Npb24gaXMgbm90CiAgICAgICAgICBjdXJyZW50bHkgYXV0aGVudGljYXRlZC4KCiAgICAgICAgICBfX0ZvciBhbiBhcHBsaWNhdGlvbiB0aGF0IHdvcmtzIHdpdGhvdXQgYW4gYXV0aGVudGljYXRpb24gcm91dGUgKGUuZy4KICAgICAgICAgIGJlY2F1c2UgaXQgb3BlbnMgYSBuZXcgd2luZG93IHRvIGhhbmRsZSBhdXRoZW50aWNhdGlvbiB0aGVyZSksIHRoaXMgaXMKICAgICAgICAgIHRoZSBhY3Rpb24gdG8gb3ZlcnJpZGUsIGUuZy46X18KCiAgICAgICAgICBgYGBqcwogICAgICAgICAgQXBwLkFwcGxpY2F0aW9uUm91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoU2ltcGxlQXV0aC5BcHBsaWNhdGlvblJvdXRlTWl4aW4sIHsKICAgICAgICAgICAgYWN0aW9uczogewogICAgICAgICAgICAgIGF1dGhlbnRpY2F0ZVNlc3Npb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy5nZXQoJ3Nlc3Npb24nKS5hdXRoZW50aWNhdGUoJ2F1dGhlbnRpY2F0b3I6Y3VzdG9tJywge30pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBgYGAKCiAgICAgICAgICBAbWV0aG9kIGFjdGlvbnMuYXV0aGVudGljYXRlU2Vzc2lvbgogICAgICAgICovCiAgICAgICAgYXV0aGVudGljYXRlU2Vzc2lvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLnRyYW5zaXRpb25UbyhDb25maWd1cmF0aW9uLmF1dGhlbnRpY2F0aW9uUm91dGUpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAgVGhpcyBhY3Rpb24gaXMgdHJpZ2dlcmVkIHdoZW5ldmVyIHRoZSBzZXNzaW9uIGlzIHN1Y2Nlc3NmdWxseQogICAgICAgICAgYXV0aGVudGljYXRlZC4gSWYgdGhlcmUgaXMgYSB0cmFuc2l0aW9uIHRoYXQgd2FzIHByZXZpb3VzbHkgaW50ZXJjZXB0ZWQKICAgICAgICAgIGJ5CiAgICAgICAgICBbYEF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluI2JlZm9yZU1vZGVsYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRlZFJvdXRlTWl4aW4tYmVmb3JlTW9kZWwpCiAgICAgICAgICBpdCB3aWxsIHJldHJ5IGl0LiBJZiB0aGVyZSBpcyBubyBzdWNoIHRyYW5zaXRpb24sIHRoaXMgYWN0aW9uIHRyYW5zaXRpb25zCiAgICAgICAgICB0byB0aGUKICAgICAgICAgIFtgQ29uZmlndXJhdGlvbi5yb3V0ZUFmdGVyQXV0aGVudGljYXRpb25gXSgjU2ltcGxlQXV0aC1Db25maWd1cmF0aW9uLXJvdXRlQWZ0ZXJBdXRoZW50aWNhdGlvbikuCgogICAgICAgICAgQG1ldGhvZCBhY3Rpb25zLnNlc3Npb25BdXRoZW50aWNhdGlvblN1Y2NlZWRlZAogICAgICAgICovCiAgICAgICAgc2Vzc2lvbkF1dGhlbnRpY2F0aW9uU3VjY2VlZGVkOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhdHRlbXB0ZWRUcmFuc2l0aW9uID0gdGhpcy5nZXQoQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lKS5nZXQoJ2F0dGVtcHRlZFRyYW5zaXRpb24nKTsKICAgICAgICAgIGlmIChhdHRlbXB0ZWRUcmFuc2l0aW9uKSB7CiAgICAgICAgICAgIGF0dGVtcHRlZFRyYW5zaXRpb24ucmV0cnkoKTsKICAgICAgICAgICAgdGhpcy5nZXQoQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lKS5zZXQoJ2F0dGVtcHRlZFRyYW5zaXRpb24nLCBudWxsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvKENvbmZpZ3VyYXRpb24ucm91dGVBZnRlckF1dGhlbnRpY2F0aW9uKTsKICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgIFRoaXMgYWN0aW9uIGlzIHRyaWdnZXJlZCB3aGVuZXZlciBzZXNzaW9uIGF1dGhlbnRpY2F0aW9uIGZhaWxzLiBUaGUKICAgICAgICAgIGBlcnJvcmAgYXJndW1lbnQgaXMgdGhlIGVycm9yIG9iamVjdCB0aGF0IHRoZSBwcm9taXNlIHRoZSBhdXRoZW50aWNhdG9yCiAgICAgICAgICByZXR1cm5zIHJlamVjdHMgd2l0aC4gKHNlZQogICAgICAgICAgW2BBdXRoZW50aWNhdG9ycy5CYXNlI2F1dGhlbnRpY2F0ZWBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UtYXV0aGVudGljYXRlKSkuCgogICAgICAgICAgSXQgY2FuIGJlIG92ZXJyaWRkZW4gdG8gZGlzcGxheSBlcnJvciBtZXNzYWdlcyBldGMuOgoKICAgICAgICAgIGBgYGpzCiAgICAgICAgICBBcHAuQXBwbGljYXRpb25Sb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZChTaW1wbGVBdXRoLkFwcGxpY2F0aW9uUm91dGVNaXhpbiwgewogICAgICAgICAgICBhY3Rpb25zOiB7CiAgICAgICAgICAgICAgc2Vzc2lvbkF1dGhlbnRpY2F0aW9uRmFpbGVkOiBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyRm9yKCdhcHBsaWNhdGlvbicpLnNldCgnbG9naW5FcnJvck1lc3NhZ2UnLCBlcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgYGBgCgogICAgICAgICAgQG1ldGhvZCBhY3Rpb25zLnNlc3Npb25BdXRoZW50aWNhdGlvbkZhaWxlZAogICAgICAgICAgQHBhcmFtIHthbnl9IGVycm9yIFRoZSBlcnJvciB0aGUgcHJvbWlzZSByZXR1cm5lZCBieSB0aGUgYXV0aGVudGljYXRvciByZWplY3RzIHdpdGgsIHNlZSBbYEF1dGhlbnRpY2F0b3JzLkJhc2UjYXV0aGVudGljYXRlYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZS1hdXRoZW50aWNhdGUpCiAgICAgICAgKi8KICAgICAgICBzZXNzaW9uQXV0aGVudGljYXRpb25GYWlsZWQ6IGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICBUaGlzIGFjdGlvbiBpbnZhbGlkYXRlcyB0aGUgc2Vzc2lvbiAoc2VlCiAgICAgICAgICBbYFNlc3Npb24jaW52YWxpZGF0ZWBdKCNTaW1wbGVBdXRoLVNlc3Npb24taW52YWxpZGF0ZSkpLgogICAgICAgICAgSWYgaW52YWxpZGF0aW9uIHN1Y2NlZWRzLCBpdCByZWxvYWRzIHRoZSBhcHBsaWNhdGlvbiAoc2VlCiAgICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbiNzZXNzaW9uSW52YWxpZGF0aW9uU3VjY2VlZGVkYF0oI1NpbXBsZUF1dGgtQXBwbGljYXRpb25Sb3V0ZU1peGluLXNlc3Npb25JbnZhbGlkYXRpb25TdWNjZWVkZWQpKS4KCiAgICAgICAgICBAbWV0aG9kIGFjdGlvbnMuaW52YWxpZGF0ZVNlc3Npb24KICAgICAgICAqLwogICAgICAgIGludmFsaWRhdGVTZXNzaW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuZ2V0KENvbmZpZ3VyYXRpb24uc2Vzc2lvblByb3BlcnR5TmFtZSkuaW52YWxpZGF0ZSgpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAgVGhpcyBhY3Rpb24gaXMgaW52b2tlZCB3aGVuZXZlciB0aGUgc2Vzc2lvbiBpcyBzdWNjZXNzZnVsbHkgaW52YWxpZGF0ZWQuCiAgICAgICAgICBJdCByZWxvYWRzIHRoZSBFbWJlci5qcyBhcHBsaWNhdGlvbiBieSByZWRpcmVjdGluZyB0aGUgYnJvd3NlciB0byB0aGUKICAgICAgICAgIGFwcGxpY2F0aW9uJ3Mgcm9vdCBVUkwgc28gdGhhdCBhbGwgaW4tbWVtb3J5IGRhdGEgKHN1Y2ggYXMgRW1iZXIgRGF0YQogICAgICAgICAgc3RvcmVzIGV0Yy4pIGdldHMgY2xlYXJlZC4gVGhlIHJvb3QgVVJMIGlzIGF1dG9tYXRpY2FsbHkgcmV0cmlldmVkIGZyb20KICAgICAgICAgIHRoZSBFbWJlci5qcyBhcHBsaWNhdGlvbidzIHJvdXRlciAoc2VlCiAgICAgICAgICBodHRwOi8vZW1iZXJqcy5jb20vZ3VpZGVzL3JvdXRpbmcvI3RvY19zcGVjaWZ5aW5nLWEtcm9vdC11cmwpLgoKICAgICAgICAgIElmIHlvdXIgRW1iZXIuanMgYXBwbGljYXRpb24gd2lsbCBiZSB1c2VkIGluIGFuIGVudmlyb25tZW50IHdoZXJlIHRoZQogICAgICAgICAgdXNlcnMgZG9uJ3QgaGF2ZSBkaXJlY3QgYWNjZXNzIHRvIGFueSBkYXRhIHN0b3JlZCBvbiB0aGUgY2xpZW50IChlLmcuCiAgICAgICAgICBbY29yZG92YV0oaHR0cDovL2NvcmRvdmEuYXBhY2hlLm9yZykpIHRoaXMgYWN0aW9uIGNhbiBiZSBvdmVycmlkZGVuIHRvCiAgICAgICAgICBzaW1wbHkgdHJhbnNpdGlvbiB0byB0aGUgYCdpbmRleCdgIHJvdXRlLgoKICAgICAgICAgIEBtZXRob2QgYWN0aW9ucy5zZXNzaW9uSW52YWxpZGF0aW9uU3VjY2VlZGVkCiAgICAgICAgKi8KICAgICAgICBzZXNzaW9uSW52YWxpZGF0aW9uU3VjY2VlZGVkOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICghRW1iZXIudGVzdGluZykgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZShDb25maWd1cmF0aW9uLmFwcGxpY2F0aW9uUm9vdFVybCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICBUaGlzIGFjdGlvbiBpcyBpbnZva2VkIHdoZW5ldmVyIHNlc3Npb24gaW52YWxpZGF0aW9uIGZhaWxzLiBUaGlzIG1haW5seQogICAgICAgICAgc2VydmVzIGFzIGFuIGV4dGVuc2lvbiBwb2ludCB0byBhZGQgY3VzdG9tIGJlaGF2aW9yIGFuZCBkb2VzIG5vdGhpbmcgYnkKICAgICAgICAgIGRlZmF1bHQuCgogICAgICAgICAgQG1ldGhvZCBhY3Rpb25zLnNlc3Npb25JbnZhbGlkYXRpb25GYWlsZWQKICAgICAgICAgIEBwYXJhbSB7YW55fSBlcnJvciBUaGUgZXJyb3IgdGhlIHByb21pc2UgcmV0dXJuZWQgYnkgdGhlIGF1dGhlbnRpY2F0b3IgcmVqZWN0cyB3aXRoLCBzZWUgW2BBdXRoZW50aWNhdG9ycy5CYXNlI2ludmFsaWRhdGVgXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdG9ycy1CYXNlLWludmFsaWRhdGUpCiAgICAgICAgKi8KICAgICAgICBzZXNzaW9uSW52YWxpZGF0aW9uRmFpbGVkOiBmdW5jdGlvbihlcnJvcikgewogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAgVGhpcyBhY3Rpb24gaXMgaW52b2tlZCB3aGVuIGFuIGF1dGhvcml6YXRpb24gZXJyb3Igb2NjdXJzICh3aGljaCBpcwogICAgICAgICAgdGhlIGNhc2UgX193aGVuIHRoZSBzZXJ2ZXIgcmVzcG9uZHMgd2l0aCBIVFRQIHN0YXR1cyA0MDFfXykuIEl0CiAgICAgICAgICBpbnZhbGlkYXRlcyB0aGUgc2Vzc2lvbiBhbmQgcmVsb2FkcyB0aGUgYXBwbGljYXRpb24gKHNlZQogICAgICAgICAgW2BBcHBsaWNhdGlvblJvdXRlTWl4aW4jc2Vzc2lvbkludmFsaWRhdGlvblN1Y2NlZWRlZGBdKCNTaW1wbGVBdXRoLUFwcGxpY2F0aW9uUm91dGVNaXhpbi1zZXNzaW9uSW52YWxpZGF0aW9uU3VjY2VlZGVkKSkuCgogICAgICAgICAgQG1ldGhvZCBhY3Rpb25zLmF1dGhvcml6YXRpb25GYWlsZWQKICAgICAgICAqLwogICAgICAgIGF1dGhvcml6YXRpb25GYWlsZWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHRoaXMuZ2V0KENvbmZpZ3VyYXRpb24uc2Vzc2lvblByb3BlcnR5TmFtZSkuZ2V0KCdpc0F1dGhlbnRpY2F0ZWQnKSkgewogICAgICAgICAgICB0aGlzLmdldChDb25maWd1cmF0aW9uLnNlc3Npb25Qcm9wZXJ0eU5hbWUpLmludmFsaWRhdGUoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL21peGlucy9hdXRoZW50aWNhdGVkLXJvdXRlLW1peGluIiwgCiAgWyIuLy4uL2NvbmZpZ3VyYXRpb24iLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIENvbmZpZ3VyYXRpb24gPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKCiAgICAvKioKICAgICAgVGhpcyBtaXhpbiBpcyBmb3Igcm91dGVzIHRoYXQgcmVxdWlyZSB0aGUgc2Vzc2lvbiB0byBiZSBhdXRoZW50aWNhdGVkIHRvIGJlCiAgICAgIGFjY2Vzc2libGUuIEluY2x1ZGluZyB0aGlzIG1peGluIGluIGEgcm91dGUgYXV0b21hdGljYWxseSBhZGRzIGEgaG9vayB0aGF0CiAgICAgIGVuZm9yY2VzIHRoZSBzZXNzaW9uIHRvIGJlIGF1dGhlbnRpY2F0ZWQgYW5kIHJlZGlyZWN0cyB0byB0aGUKICAgICAgW2BDb25maWd1cmF0aW9uLmF1dGhlbnRpY2F0aW9uUm91dGVgXSgjU2ltcGxlQXV0aC1Db25maWd1cmF0aW9uLWF1dGhlbnRpY2F0aW9uUm91dGUpCiAgICAgIGlmIGl0IGlzIG5vdC4KCiAgICAgIGBgYGpzCiAgICAgIC8vIGFwcC9yb3V0ZXMvcHJvdGVjdGVkLmpzCiAgICAgIGltcG9ydCBBdXRoZW50aWNhdGVkUm91dGVNaXhpbiBmcm9tICdzaW1wbGUtYXV0aC9taXhpbnMvYXV0aGVudGljYXRlZC1yb3V0ZS1taXhpbic7CgogICAgICBleHBvcnQgZGVmYXVsdCBFbWJlci5Sb3V0ZS5leHRlbmQoQXV0aGVudGljYXRlZFJvdXRlTWl4aW4pOwogICAgICBgYGAKCiAgICAgIGBBdXRoZW50aWNhdGVkUm91dGVNaXhpbmAgcGVyZm9ybXMgdGhlIHJlZGlyZWN0IGluIHRoZSBgYmVmb3JlTW9kZWxgIG1ldGhvZAogICAgICBzbyB0aGF0IGluIGFsbCBtZXRob2RzIGV4ZWN1dGVkIGFmdGVyIHRoYXQgdGhlIHNlc3Npb24gaXMgZ3VhcmFudGVlZCB0byBiZQogICAgICBhdXRoZW50aWNhdGVkLiBfX0lmIGBiZWZvcmVNb2RlbGAgaXMgb3ZlcnJpZGRlbiwgZW5zdXJlIHRoYXQgdGhlIGN1c3RvbQogICAgICBpbXBsZW1lbnRhdGlvbiBjYWxscyBgdGhpcy5fc3VwZXIodHJhbnNpdGlvbilgX18gc28gdGhhdCB0aGUgc2Vzc2lvbgogICAgICBlbmZvcmNlbWVudCBjb2RlIGlzIGFjdHVhbGx5IGV4ZWN1dGVkLgoKICAgICAgQGNsYXNzIEF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluCiAgICAgIEBuYW1lc3BhY2UgU2ltcGxlQXV0aAogICAgICBAbW9kdWxlIHNpbXBsZS1hdXRoL21peGlucy9hdXRoZW50aWNhdGVkLXJvdXRlLW1peGluCiAgICAgIEBleHRlbmRzIEVtYmVyLk1peGluCiAgICAgIEBzdGF0aWMKICAgICovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gRW1iZXIuTWl4aW4uY3JlYXRlKHsKICAgICAgLyoqCiAgICAgICAgVGhpcyBtZXRob2QgaW1wbGVtZW50cyB0aGUgZW5mb3JjZW1lbnQgb2YgdGhlIHNlc3Npb24gYmVpbmcgYXV0aGVudGljYXRlZC4KICAgICAgICBJZiB0aGUgc2Vzc2lvbiBpcyBub3QgYXV0aGVudGljYXRlZCwgdGhlIGN1cnJlbnQgdHJhbnNpdGlvbiB3aWxsIGJlIGFib3J0ZWQKICAgICAgICBhbmQgYSByZWRpcmVjdCB3aWxsIGJlIHRyaWdnZXJlZCB0byB0aGUKICAgICAgICBbYENvbmZpZ3VyYXRpb24uYXV0aGVudGljYXRpb25Sb3V0ZWBdKCNTaW1wbGVBdXRoLUNvbmZpZ3VyYXRpb24tYXV0aGVudGljYXRpb25Sb3V0ZSkuCiAgICAgICAgVGhlIG1ldGhvZCBhbHNvIHNhdmVzIHRoZSBpbnRlcmNlcHRlZCB0cmFuc2l0aW9uIHNvIHRoYXQgaXQgY2FuIGJlIHJldHJpZWQKICAgICAgICBhZnRlciB0aGUgc2Vzc2lvbiBoYXMgYmVlbiBhdXRoZW50aWNhdGVkIChzZWUKICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbiNzZXNzaW9uQXV0aGVudGljYXRpb25TdWNjZWVkZWRgXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4tc2Vzc2lvbkF1dGhlbnRpY2F0aW9uU3VjY2VlZGVkKSkuCgogICAgICAgIEBtZXRob2QgYmVmb3JlTW9kZWwKICAgICAgICBAcGFyYW0ge1RyYW5zaXRpb259IHRyYW5zaXRpb24gVGhlIHRyYW5zaXRpb24gdGhhdCBsZWFkIHRvIHRoaXMgcm91dGUKICAgICAgKi8KICAgICAgYmVmb3JlTW9kZWw6IGZ1bmN0aW9uKHRyYW5zaXRpb24pIHsKICAgICAgICB0aGlzLl9zdXBlcih0cmFuc2l0aW9uKTsKICAgICAgICBpZiAoIXRoaXMuZ2V0KENvbmZpZ3VyYXRpb24uc2Vzc2lvblByb3BlcnR5TmFtZSkuZ2V0KCdpc0F1dGhlbnRpY2F0ZWQnKSkgewogICAgICAgICAgdHJhbnNpdGlvbi5hYm9ydCgpOwogICAgICAgICAgdGhpcy5nZXQoQ29uZmlndXJhdGlvbi5zZXNzaW9uUHJvcGVydHlOYW1lKS5zZXQoJ2F0dGVtcHRlZFRyYW5zaXRpb24nLCB0cmFuc2l0aW9uKTsKICAgICAgICAgIEVtYmVyLmFzc2VydCgnVGhlIHJvdXRlIGNvbmZpZ3VyZWQgYXMgQ29uZmlndXJhdGlvbi5hdXRoZW50aWNhdGlvblJvdXRlIGNhbm5vdCBpbXBsZW1lbnQgdGhlIEF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluIG1peGluIGFzIHRoYXQgbGVhZHMgdG8gYW4gaW5maW5pdGUgdHJhbnNpdGlvbmluZyBsb29wLicsIHRoaXMuZ2V0KCdyb3V0ZU5hbWUnKSAhPT0gQ29uZmlndXJhdGlvbi5hdXRoZW50aWNhdGlvblJvdXRlKTsKICAgICAgICAgIHRyYW5zaXRpb24uc2VuZCgnYXV0aGVudGljYXRlU2Vzc2lvbicpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvbWl4aW5zL2F1dGhlbnRpY2F0aW9uLWNvbnRyb2xsZXItbWl4aW4iLCAKICBbIi4vLi4vY29uZmlndXJhdGlvbiIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgQ29uZmlndXJhdGlvbiA9IF9fZGVwZW5kZW5jeTFfX1siZGVmYXVsdCJdOwoKICAgIC8qKgogICAgICBUaGlzIG1peGluIGlzIGZvciB0aGUgY29udHJvbGxlciB0aGF0IGhhbmRsZXMgdGhlCiAgICAgIFtgQ29uZmlndXJhdGlvbi5hdXRoZW50aWNhdGlvblJvdXRlYF0oI1NpbXBsZUF1dGgtQ29uZmlndXJhdGlvbi1hdXRoZW50aWNhdGlvblJvdXRlKS4KICAgICAgSXQgcHJvdmlkZXMgdGhlIGBhdXRoZW50aWNhdGVgIGFjdGlvbiB0aGF0IHdpbGwgYXV0aGVudGljYXRlIHRoZSBzZXNzaW9uIHdpdGgKICAgICAgdGhlIGNvbmZpZ3VyZWQgYXV0aGVudGljYXRvciAoc2VlCiAgICAgIFtgQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4jYXV0aGVudGljYXRvcmBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluLWF1dGhlbnRpY2F0b3IpKS4KCiAgICAgIEBjbGFzcyBBdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbgogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGgKICAgICAgQG1vZHVsZSBzaW1wbGUtYXV0aC9taXhpbnMvYXV0aGVudGljYXRpb24tY29udHJvbGxlci1taXhpbgogICAgICBAZXh0ZW5kcyBFbWJlci5NaXhpbgogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBFbWJlci5NaXhpbi5jcmVhdGUoewogICAgICAvKioKICAgICAgICBUaGUgYXV0aGVudGljYXRvciBmYWN0b3J5IHRvIHVzZSBhcyBpdCBpcyByZWdpc3RlcmVkIHdpdGggRW1iZXIncwogICAgICAgIGNvbnRhaW5lciwgc2VlCiAgICAgICAgW0VtYmVyJ3MgQVBJIGRvY3NdKGh0dHA6Ly9lbWJlcmpzLmNvbS9hcGkvY2xhc3Nlcy9FbWJlci5BcHBsaWNhdGlvbi5odG1sI21ldGhvZF9yZWdpc3RlcikuCgogICAgICAgIEBwcm9wZXJ0eSBhdXRoZW50aWNhdG9yCiAgICAgICAgQHR5cGUgU3RyaW5nCiAgICAgICAgQGRlZmF1bHQgbnVsbAogICAgICAqLwogICAgICBhdXRoZW50aWNhdG9yOiBudWxsLAoKICAgICAgYWN0aW9uczogewogICAgICAgIC8qKgogICAgICAgICAgVGhpcyBhY3Rpb24gd2lsbCBhdXRoZW50aWNhdGUgdGhlIHNlc3Npb24gd2l0aCB0aGUgY29uZmlndXJlZAogICAgICAgICAgYXV0aGVudGljYXRvciAoc2VlCiAgICAgICAgICBbYEF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluI2F1dGhlbnRpY2F0b3JgXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbi1hdXRoZW50aWNhdG9yKSwKICAgICAgICAgIFtgU2Vzc2lvbiNhdXRoZW50aWNhdGVgXSgjU2ltcGxlQXV0aC1TZXNzaW9uLWF1dGhlbnRpY2F0ZSkpLgoKICAgICAgICAgIEBtZXRob2QgYWN0aW9ucy5hdXRoZW50aWNhdGUKICAgICAgICAgIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIEFueSBvcHRpb25zIHRoZSBhdXRoZW50aWNhdG9yIG5lZWRzIHRvIGF1dGhlbnRpY2F0ZSB0aGUgc2Vzc2lvbgogICAgICAgICovCiAgICAgICAgYXV0aGVudGljYXRlOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICB2YXIgYXV0aGVudGljYXRvciA9IHRoaXMuZ2V0KCdhdXRoZW50aWNhdG9yJyk7CiAgICAgICAgICBFbWJlci5hc3NlcnQoJ0F1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluL0xvZ2luQ29udHJvbGxlck1peGluIHJlcXVpcmUgdGhlIGF1dGhlbnRpY2F0b3IgcHJvcGVydHkgdG8gYmUgc2V0IG9uIHRoZSBjb250cm9sbGVyJywgIUVtYmVyLmlzRW1wdHkoYXV0aGVudGljYXRvcikpOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KENvbmZpZ3VyYXRpb24uc2Vzc2lvblByb3BlcnR5TmFtZSkuYXV0aGVudGljYXRlKHRoaXMuZ2V0KCdhdXRoZW50aWNhdG9yJyksIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvbWl4aW5zL2xvZ2luLWNvbnRyb2xsZXItbWl4aW4iLCAKICBbIi4vLi4vY29uZmlndXJhdGlvbiIsIi4vYXV0aGVudGljYXRpb24tY29udHJvbGxlci1taXhpbiIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZGVwZW5kZW5jeTJfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBDb25maWd1cmF0aW9uID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CiAgICB2YXIgQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4gPSBfX2RlcGVuZGVuY3kyX19bImRlZmF1bHQiXTsKCiAgICAvKioKICAgICAgVGhpcyBtaXhpbiBpcyBmb3IgdGhlIGNvbnRyb2xsZXIgdGhhdCBoYW5kbGVzIHRoZQogICAgICBbYENvbmZpZ3VyYXRpb24uYXV0aGVudGljYXRpb25Sb3V0ZWBdKCNTaW1wbGVBdXRoLUNvbmZpZ3VyYXRpb24tYXV0aGVudGljYXRpb25Sb3V0ZSkKICAgICAgaWYgdGhlIHVzZWQgYXV0aGVudGljYXRpb24gbWVjaGFuaXNtIHdvcmtzIHdpdGggYSBsb2dpbiBmb3JtIHRoYXQgYXNrcyBmb3IKICAgICAgdXNlciBjcmVkZW50aWFscy4gSXQgcHJvdmlkZXMgdGhlIGBhdXRoZW50aWNhdGVgIGFjdGlvbiB0aGF0IHdpbGwKICAgICAgYXV0aGVudGljYXRlIHRoZSBzZXNzaW9uIHdpdGggdGhlIGNvbmZpZ3VyZWQgYXV0aGVudGljYXRvciB3aGVuIGludm9rZWQuCiAgICAgIF9fVGhpcyBpcyBhIHNwZWNpYWxpemF0aW9uIG9mCiAgICAgIFtgQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW5gXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbikuX18KCiAgICAgIEFjY29tcGFueWluZyB0aGUgY29udHJvbGxlciB0aGF0IHRoaXMgbWl4aW4gaXMgbWl4ZWQgaW4gdGhlIGFwcGxpY2F0aW9uIG5lZWRzCiAgICAgIHRvIGhhdmUgYSBgbG9naW5gIHRlbXBsYXRlIHdpdGggdGhlIGZpZWxkcyBgaWRlbnRpZmljYXRpb25gIGFuZCBgcGFzc3dvcmRgIGFzCiAgICAgIHdlbGwgYXMgYW4gYWN0aW9uYWJsZSBidXR0b24gb3IgbGluayB0aGF0IHRyaWdnZXJzIHRoZSBgYXV0aGVudGljYXRlYCBhY3Rpb24sCiAgICAgIGUuZy46CgogICAgICBgYGBoYW5kbGViYXJzCiAgICAgIDxmb3JtIHt7YWN0aW9uICdhdXRoZW50aWNhdGUnIG9uPSdzdWJtaXQnfX0+CiAgICAgICAgPGxhYmVsIGZvcj0iaWRlbnRpZmljYXRpb24iPkxvZ2luPC9sYWJlbD4KICAgICAgICB7e2lucHV0IHZhbHVlPWlkZW50aWZpY2F0aW9uIHBsYWNlaG9sZGVyPSdFbnRlciBMb2dpbid9fQogICAgICAgIDxsYWJlbCBmb3I9InBhc3N3b3JkIj5QYXNzd29yZDwvbGFiZWw+CiAgICAgICAge3tpbnB1dCB2YWx1ZT1wYXNzd29yZCBwbGFjZWhvbGRlcj0nRW50ZXIgUGFzc3dvcmQnIHR5cGU9J3Bhc3N3b3JkJ319CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgIDwvZm9ybT4KICAgICAgYGBgCgogICAgICBAY2xhc3MgTG9naW5Db250cm9sbGVyTWl4aW4KICAgICAgQG5hbWVzcGFjZSBTaW1wbGVBdXRoCiAgICAgIEBtb2R1bGUgc2ltcGxlLWF1dGgvbWl4aW5zL2xvZ2luLWNvbnRyb2xsZXItbWl4aW4KICAgICAgQGV4dGVuZHMgU2ltcGxlQXV0aC5BdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbgogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBFbWJlci5NaXhpbi5jcmVhdGUoQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4sIHsKICAgICAgYWN0aW9uczogewogICAgICAgIC8qKgogICAgICAgICAgVGhpcyBhY3Rpb24gd2lsbCBhdXRoZW50aWNhdGUgdGhlIHNlc3Npb24gd2l0aCB0aGUgY29uZmlndXJlZAogICAgICAgICAgYXV0aGVudGljYXRvciAoc2VlCiAgICAgICAgICBbQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4jYXV0aGVudGljYXRvcl0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRpb24tYXV0aGVudGljYXRvcikpCiAgICAgICAgICBpZiBib3RoIGBpZGVudGlmaWNhdGlvbmAgYW5kIGBwYXNzd29yZGAgYXJlIG5vbi1lbXB0eS4gSXQgcGFzc2VzIGJvdGgKICAgICAgICAgIHZhbHVlcyB0byB0aGUgYXV0aGVudGljYXRvci4KCiAgICAgICAgICBfX1RoZSBhY3Rpb24gYWxzbyByZXNldHMgdGhlIGBwYXNzd29yZGAgcHJvcGVydHkgc28gc2Vuc2l0aXZlIGRhdGEgZG9lcwogICAgICAgICAgbm90IHN0YXkgaW4gbWVtb3J5IGZvciBsb25nZXIgdGhhbiBuZWNlc3NhcnkuX18KCiAgICAgICAgICBAbWV0aG9kIGFjdGlvbnMuYXV0aGVudGljYXRlCiAgICAgICAgKi8KICAgICAgICBhdXRoZW50aWNhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmdldFByb3BlcnRpZXMoJ2lkZW50aWZpY2F0aW9uJywgJ3Bhc3N3b3JkJyk7CiAgICAgICAgICB0aGlzLnNldCgncGFzc3dvcmQnLCBudWxsKTsKICAgICAgICAgIHJldHVybiB0aGlzLl9zdXBlcihkYXRhKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL21peGlucy91bmF1dGhlbnRpY2F0ZWQtcm91dGUtbWl4aW4iLCAKICBbIi4vLi4vY29uZmlndXJhdGlvbiIsImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2RlcGVuZGVuY3kxX18sIF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgQ29uZmlndXJhdGlvbiA9IF9fZGVwZW5kZW5jeTFfX1siZGVmYXVsdCJdOwoKICAgIC8qKgogICAgICBUaGlzIG1peGluIGlzIGZvciByb3V0ZXMgdGhhdCBzaG91bGQgb25seSBiZSBhY2Nlc3NpYmxlIGlmIHRoZSBzZXNzaW9uIGlzCiAgICAgIG5vdCBhdXRoZW50aWNhdGVkLiBUaGlzIGlzIGUuZy4gdGhlIGNhc2UgZm9yIHRoZSBsb2dpbiByb3V0ZSB0aGF0IHNob3VsZCBub3QKICAgICAgYmUgYWNjZXNzaWJsZSB3aGVuIHRoZSBzZXNzaW9uIGlzIGFscmVhZHkgYXV0aGVudGljYXRlZC4gSW5jbHVkaW5nIHRoaXMgbWl4aW4KICAgICAgaW4gYSByb3V0ZSBhdXRvbWF0aWNhbGx5IGFkZHMgYSBob29rIHRoYXQgcmVkaXJlY3RzIHRvIHRoZQogICAgICBbYENvbmZpZ3VyYXRpb24ucm91dGVJZkFscmVhZHlBdXRoZW50aWNhdGVkYF0oI1NpbXBsZUF1dGgtQ29uZmlndXJhdGlvbi1yb3V0ZUlmQWxyZWFkeUF1dGhlbnRpY2F0ZWQpLAogICAgICB3aGljaCBkZWZhdWx0cyB0byBgJ2luZGV4J2AuCgogICAgICBgYGBqcwogICAgICAvLyBhcHAvcm91dGVzL2xvZ2luLmpzCiAgICAgIGltcG9ydCBVbmF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluIGZyb20gJ3NpbXBsZS1hdXRoL21peGlucy91bmF1dGhlbnRpY2F0ZWQtcm91dGUtbWl4aW4nOwoKICAgICAgZXhwb3J0IGRlZmF1bHQgRW1iZXIuUm91dGUuZXh0ZW5kKFVuYXV0aGVudGljYXRlZFJvdXRlTWl4aW4pOwogICAgICBgYGAKCiAgICAgIGBVbmF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluYCBwZXJmb3JtcyB0aGUgcmVkaXJlY3QgaW4gdGhlIGBiZWZvcmVNb2RlbGAKICAgICAgbWV0aG9kLiBfX0lmIGBiZWZvcmVNb2RlbGAgaXMgb3ZlcnJpZGRlbiwgZW5zdXJlIHRoYXQgdGhlIGN1c3RvbQogICAgICBpbXBsZW1lbnRhdGlvbiBjYWxscyBgdGhpcy5fc3VwZXIodHJhbnNpdGlvbilgX18uCgogICAgICBAY2xhc3MgVW5hdXRoZW50aWNhdGVkUm91dGVNaXhpbgogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGgKICAgICAgQG1vZHVsZSBzaW1wbGUtYXV0aC9taXhpbnMvdW5hdXRoZW50aWNhdGVkLXJvdXRlLW1peGluCiAgICAgIEBleHRlbmRzIEVtYmVyLk1peGluCiAgICAgIEBzdGF0aWMKICAgICovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gRW1iZXIuTWl4aW4uY3JlYXRlKHsKICAgICAgLyoqCiAgICAgICAgVGhpcyBtZXRob2QgaW1wbGVtZW50cyB0aGUgZW5mb3JjZW1lbnQgb2YgdGhlIHNlc3Npb24gbm90IGJlaW5nCiAgICAgICAgYXV0aGVudGljYXRlZC4gSWYgdGhlIHNlc3Npb24gaXMgYXV0aGVudGljYXRlZCwgdGhlIGN1cnJlbnQgdHJhbnNpdGlvbiB3aWxsCiAgICAgICAgYmUgYWJvcnRlZCBhbmQgYSByZWRpcmVjdCB3aWxsIGJlIHRyaWdnZXJlZCB0byB0aGUKICAgICAgICBbYENvbmZpZ3VyYXRpb24ucm91dGVJZkFscmVhZHlBdXRoZW50aWNhdGVkYF0oI1NpbXBsZUF1dGgtQ29uZmlndXJhdGlvbi1yb3V0ZUlmQWxyZWFkeUF1dGhlbnRpY2F0ZWQpLgoKICAgICAgICBAbWV0aG9kIGJlZm9yZU1vZGVsCiAgICAgICAgQHBhcmFtIHtUcmFuc2l0aW9ufSB0cmFuc2l0aW9uIFRoZSB0cmFuc2l0aW9uIHRoYXQgbGVhZCB0byB0aGlzIHJvdXRlCiAgICAgICovCiAgICAgIGJlZm9yZU1vZGVsOiBmdW5jdGlvbih0cmFuc2l0aW9uKSB7CiAgICAgICAgaWYgKHRoaXMuZ2V0KENvbmZpZ3VyYXRpb24uc2Vzc2lvblByb3BlcnR5TmFtZSkuZ2V0KCdpc0F1dGhlbnRpY2F0ZWQnKSkgewogICAgICAgICAgdHJhbnNpdGlvbi5hYm9ydCgpOwogICAgICAgICAgRW1iZXIuYXNzZXJ0KCdUaGUgcm91dGUgY29uZmlndXJlZCBhcyBDb25maWd1cmF0aW9uLnJvdXRlSWZBbHJlYWR5QXV0aGVudGljYXRlZCBjYW5ub3QgaW1wbGVtZW50IHRoZSBVbmF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluIG1peGluIGFzIHRoYXQgbGVhZHMgdG8gYW4gaW5maW5pdGUgdHJhbnNpdGlvbmluZyBsb29wLicsIHRoaXMuZ2V0KCdyb3V0ZU5hbWUnKSAhPT0gQ29uZmlndXJhdGlvbi5yb3V0ZUlmQWxyZWFkeUF1dGhlbnRpY2F0ZWQpOwogICAgICAgICAgdGhpcy50cmFuc2l0aW9uVG8oQ29uZmlndXJhdGlvbi5yb3V0ZUlmQWxyZWFkeUF1dGhlbnRpY2F0ZWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvc2Vzc2lvbiIsIAogIFsiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZXhwb3J0c19fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICAvKioKICAgICAgX19UaGUgc2Vzc2lvbiBwcm92aWRlcyBhY2Nlc3MgdG8gdGhlIGN1cnJlbnQgYXV0aGVudGljYXRpb24gc3RhdGUgYXMgd2VsbCBhcwogICAgICBhbnkgZGF0YSB0aGUgYXV0aGVudGljYXRvciByZXNvbHZlZCB3aXRoX18gKHNlZQogICAgICBbYEF1dGhlbnRpY2F0b3JzLkJhc2UjYXV0aGVudGljYXRlYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZS1hdXRoZW50aWNhdGUpKS4KICAgICAgSXQgaXMgY3JlYXRlZCB3aGVuIEVtYmVyIFNpbXBsZSBBdXRoIGlzIHNldCB1cCBhbmQgX19pbmplY3RlZCBpbnRvIGFsbAogICAgICBjb250cm9sbGVycyBhbmQgcm91dGVzIHNvIHRoYXQgdGhlc2UgcGFydHMgb2YgdGhlIGFwcGxpY2F0aW9uIGNhbiBhbHdheXMKICAgICAgYWNjZXNzIHRoZSBjdXJyZW50IGF1dGhlbnRpY2F0aW9uIHN0YXRlIGFuZCBvdGhlciBkYXRhX18sIGRlcGVuZGluZyBvbiB0aGUKICAgICAgYXV0aGVudGljYXRvciBpbiB1c2UgYW5kIHdoZXRoZXIgdGhlIHNlc3Npb24gaXMgYWN0dWFsbHkgYXV0aGVudGljYXRlZCAoc2VlCiAgICAgIFtgQXV0aGVudGljYXRvcnMuQmFzZWBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UpKS4KCiAgICAgIFRoZSBzZXNzaW9uIGFsc28gcHJvdmlkZXMgbWV0aG9kcyB0byBhdXRoZW50aWNhdGUgYW5kIHRvIGludmFsaWRhdGUgaXRzZWxmCiAgICAgIChzZWUKICAgICAgW2BTZXNzaW9uI2F1dGhlbnRpY2F0ZWBdKCNTaW1wbGVBdXRoLVNlc3Npb24tYXV0aGVudGljYXRlKSwKICAgICAgW2BTZXNzaW9uI2ludmFsZGlhdGVgXSgjU2ltcGxlQXV0aC1TZXNzaW9uLWludmFsZGlhdGUpKS4KICAgICAgVGhlc2UgbWV0aG9kcyBhcmUgdXN1YWxseSBpbnZva2VkIHRocm91Z2ggYWN0aW9ucyBmcm9tIHJvdXRlcyBvciBjb250cm9sbGVycy4KICAgICAgVG8gYXV0aGVudGljYXRlIHRoZSBzZXNzaW9uIG1hbnVhbGx5LCBzaW1wbGUgY2FsbCB0aGUKICAgICAgW2BTZXNzaW9uI2F1dGhlbnRpY2F0ZWBdKCNTaW1wbGVBdXRoLVNlc3Npb24tYXV0aGVudGljYXRlKQogICAgICBtZXRob2Qgd2l0aCB0aGUgYXV0aGVudGljYXRvciBmYWN0b3J5IHRvIHVzZSBhcyB3ZWxsIGFzIGFueSBvcHRpb25zIHRoZQogICAgICBhdXRoZW50aWNhdG9yIG5lZWRzIHRvIGF1dGhlbnRpY2F0ZSB0aGUgc2Vzc2lvbjoKCiAgICAgIGBgYGpzCiAgICAgIHRoaXMuZ2V0KCdzZXNzaW9uJykuYXV0aGVudGljYXRlKCdhdXRoZW50aWNhdG9yOmN1c3RvbScsIHsgc29tZTogJ29wdGlvbicgfSkudGhlbihmdW5jdGlvbigpIHsKICAgICAgICAvLyBhdXRoZW50aWNhdGlvbiB3YXMgc3VjY2Vzc2Z1bAogICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAvLyBhdXRoZW50aWNhdGlvbiBmYWlsZWQKICAgICAgfSk7CiAgICAgIGBgYAoKICAgICAgVGhlIHNlc3Npb24gYWxzbyBvYnNlcnZlcyB0aGUgc3RvcmUgYW5kIC0gaWYgaXQgaXMgYXV0aGVudGljYXRlZCAtIHRoZQogICAgICBhdXRoZW50aWNhdG9yIGZvciBjaGFuZ2VzIChzZWUKICAgICAgW2BBdXRoZW50aWNhdG9ycy5CYXNlYF0oI1NpbXBsZUF1dGgtQXV0aGVudGljYXRvcnMtQmFzZSkKICAgICAgZW5kIFtgU3RvcmVzLkJhc2VgXSgjU2ltcGxlQXV0aC1TdG9yZXMtQmFzZSkpLgoKICAgICAgQGNsYXNzIFNlc3Npb24KICAgICAgQG5hbWVzcGFjZSBTaW1wbGVBdXRoCiAgICAgIEBtb2R1bGUgc2ltcGxlLWF1dGgvc2Vzc2lvbgogICAgICBAZXh0ZW5kcyBFbWJlci5PYmplY3RQcm94eQogICAgICBAdXNlcyBFbWJlci5FdmVudGVkCiAgICAqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IEVtYmVyLk9iamVjdFByb3h5LmV4dGVuZChFbWJlci5FdmVudGVkLCB7CiAgICAgIC8qKgogICAgICAgIFRyaWdnZXJlZCBfX3doZW5ldmVyIHRoZSBzZXNzaW9uIGlzIHN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkX18uIFdoZW4gdGhlCiAgICAgICAgYXBwbGljYXRpb24gdXNlcyB0aGUKICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbmAgbWl4aW5dKCNTaW1wbGVBdXRoLUFwcGxpY2F0aW9uUm91dGVNaXhpbiksCiAgICAgICAgW2BBcHBsaWNhdGlvblJvdXRlTWl4aW4uYWN0aW9ucyNzZXNzaW9uQXV0aGVudGljYXRpb25TdWNjZWVkZWRgXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4tc2Vzc2lvbkF1dGhlbnRpY2F0aW9uU3VjY2VlZGVkKQogICAgICAgIHdpbGwgYmUgaW52b2tlZCB3aGVuZXZlciB0aGlzIGV2ZW50IGlzIHRyaWdnZXJlZC4KCiAgICAgICAgQGV2ZW50IHNlc3Npb25BdXRoZW50aWNhdGlvblN1Y2NlZWRlZAogICAgICAqLwogICAgICAvKioKICAgICAgICBUcmlnZ2VyZWQgX193aGVuZXZlciBhbiBhdHRlbXB0IHRvIGF1dGhlbnRpY2F0ZSB0aGUgc2Vzc2lvbiBmYWlsc19fLiBXaGVuCiAgICAgICAgdGhlIGFwcGxpY2F0aW9uIHVzZXMgdGhlCiAgICAgICAgW2BBcHBsaWNhdGlvblJvdXRlTWl4aW5gIG1peGluXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4pLAogICAgICAgIFtgQXBwbGljYXRpb25Sb3V0ZU1peGluLmFjdGlvbnMjc2Vzc2lvbkF1dGhlbnRpY2F0aW9uRmFpbGVkYF0oI1NpbXBsZUF1dGgtQXBwbGljYXRpb25Sb3V0ZU1peGluLXNlc3Npb25BdXRoZW50aWNhdGlvbkZhaWxlZCkKICAgICAgICB3aWxsIGJlIGludm9rZWQgd2hlbmV2ZXIgdGhpcyBldmVudCBpcyB0cmlnZ2VyZWQuCgogICAgICAgIEBldmVudCBzZXNzaW9uQXV0aGVudGljYXRpb25GYWlsZWQKICAgICAgICBAcGFyYW0ge09iamVjdH0gZXJyb3IgVGhlIGVycm9yIG9iamVjdDsgdGhpcyBkZXBlbmRzIG9uIHRoZSBhdXRoZW50aWNhdG9yIGluIHVzZSwgc2VlIFtTaW1wbGVBdXRoLkF1dGhlbnRpY2F0b3JzLkJhc2UjYXV0aGVudGljYXRlXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdG9ycy1CYXNlLWF1dGhlbnRpY2F0ZSkKICAgICAgKi8KICAgICAgLyoqCiAgICAgICAgVHJpZ2dlcmVkIF9fd2hlbmV2ZXIgdGhlIHNlc3Npb24gaXMgc3VjY2Vzc2Z1bGx5IGludmFsaWRhdGVkX18uIFdoZW4gdGhlCiAgICAgICAgYXBwbGljYXRpb24gdXNlcyB0aGUKICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbmAgbWl4aW5dKCNTaW1wbGVBdXRoLUFwcGxpY2F0aW9uUm91dGVNaXhpbiksCiAgICAgICAgW2BBcHBsaWNhdGlvblJvdXRlTWl4aW4uYWN0aW9ucyNzZXNzaW9uSW52YWxpZGF0aW9uU3VjY2VlZGVkYF0oI1NpbXBsZUF1dGgtQXBwbGljYXRpb25Sb3V0ZU1peGluLXNlc3Npb25JbnZhbGlkYXRpb25TdWNjZWVkZWQpCiAgICAgICAgd2lsbCBiZSBpbnZva2VkIHdoZW5ldmVyIHRoaXMgZXZlbnQgaXMgdHJpZ2dlcmVkLgoKICAgICAgICBAZXZlbnQgc2Vzc2lvbkludmFsaWRhdGlvblN1Y2NlZWRlZAogICAgICAqLwogICAgICAvKioKICAgICAgICBUcmlnZ2VyZWQgX193aGVuZXZlciBhbiBhdHRlbXB0IHRvIGludmFsaWRhdGUgdGhlIHNlc3Npb24gZmFpbHNfXy4gV2hlbiB0aGUKICAgICAgICBhcHBsaWNhdGlvbiB1c2VzIHRoZQogICAgICAgIFtgQXBwbGljYXRpb25Sb3V0ZU1peGluYCBtaXhpbl0oI1NpbXBsZUF1dGgtQXBwbGljYXRpb25Sb3V0ZU1peGluKSwKICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbi5hY3Rpb25zI3Nlc3Npb25JbnZhbGlkYXRpb25GYWlsZWRgXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4tc2Vzc2lvbkludmFsaWRhdGlvbkZhaWxlZCkKICAgICAgICB3aWxsIGJlIGludm9rZWQgd2hlbmV2ZXIgdGhpcyBldmVudCBpcyB0cmlnZ2VyZWQuCgogICAgICAgIEBldmVudCBzZXNzaW9uSW52YWxpZGF0aW9uRmFpbGVkCiAgICAgICAgQHBhcmFtIHtPYmplY3R9IGVycm9yIFRoZSBlcnJvciBvYmplY3Q7IHRoaXMgZGVwZW5kcyBvbiB0aGUgYXV0aGVudGljYXRvciBpbiB1c2UsIHNlZSBbU2ltcGxlQXV0aC5BdXRoZW50aWNhdG9ycy5CYXNlI2ludmFsaWRhdGVdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UtaW52YWxpZGF0ZSkKICAgICAgKi8KICAgICAgLyoqCiAgICAgICAgVHJpZ2dlcmVkIF9fd2hlbmV2ZXIgdGhlIHNlcnZlciByZWplY3RzIHRoZSBhdXRob3JpemF0aW9uIGluZm9ybWF0aW9uCiAgICAgICAgcGFzc2VkIHdpdGggYSByZXF1ZXN0IGFuZCByZXNwb25kcyB3aXRoIHN0YXR1cyA0MDFfXy4gV2hlbiB0aGUgYXBwbGljYXRpb24KICAgICAgICB1c2VzIHRoZQogICAgICAgIFtgQXBwbGljYXRpb25Sb3V0ZU1peGluYCBtaXhpbl0oI1NpbXBsZUF1dGgtQXBwbGljYXRpb25Sb3V0ZU1peGluKSwKICAgICAgICBbYEFwcGxpY2F0aW9uUm91dGVNaXhpbi5hY3Rpb25zI2F1dGhvcml6YXRpb25GYWlsZWRgXSgjU2ltcGxlQXV0aC1BcHBsaWNhdGlvblJvdXRlTWl4aW4tYXV0aG9yaXphdGlvbkZhaWxlZCkKICAgICAgICB3aWxsIGJlIGludm9rZWQgd2hlbmV2ZXIgdGhpcyBldmVudCBpcyB0cmlnZ2VyZWQuCgogICAgICAgIEBldmVudCBhdXRob3JpemF0aW9uRmFpbGVkCiAgICAgICovCgogICAgICAvKioKICAgICAgICBUaGUgYXV0aGVudGljYXRvciBmYWN0b3J5IHRvIHVzZSBhcyBpdCBpcyByZWdpc3RlcmVkIHdpdGggRW1iZXIncwogICAgICAgIGNvbnRhaW5lciwgc2VlCiAgICAgICAgW0VtYmVyJ3MgQVBJIGRvY3NdKGh0dHA6Ly9lbWJlcmpzLmNvbS9hcGkvY2xhc3Nlcy9FbWJlci5BcHBsaWNhdGlvbi5odG1sI21ldGhvZF9yZWdpc3RlcikuCiAgICAgICAgVGhpcyBpcyBvbmx5IHNldCB3aGVuIHRoZSBzZXNzaW9uIGlzIGN1cnJlbnRseSBhdXRoZW50aWNhdGVkLgoKICAgICAgICBAcHJvcGVydHkgYXV0aGVudGljYXRvcgogICAgICAgIEB0eXBlIFN0cmluZwogICAgICAgIEByZWFkT25seQogICAgICAgIEBkZWZhdWx0IG51bGwKICAgICAgKi8KICAgICAgYXV0aGVudGljYXRvcjogbnVsbCwKICAgICAgLyoqCiAgICAgICAgVGhlIHN0b3JlIHVzZWQgdG8gcGVyc2lzdCBzZXNzaW9uIHByb3BlcnRpZXMuCgogICAgICAgIEBwcm9wZXJ0eSBzdG9yZQogICAgICAgIEB0eXBlIFNpbXBsZUF1dGguU3RvcmVzLkJhc2UKICAgICAgICBAcmVhZE9ubHkKICAgICAgICBAZGVmYXVsdCBudWxsCiAgICAgICovCiAgICAgIHN0b3JlOiBudWxsLAogICAgICAvKioKICAgICAgICBUaGUgRW1iZXIuanMgY29udGFpbmVyLAoKICAgICAgICBAcHJvcGVydHkgY29udGFpbmVyCiAgICAgICAgQHR5cGUgQ29udGFpbmVyCiAgICAgICAgQHJlYWRPbmx5CiAgICAgICAgQGRlZmF1bHQgbnVsbAogICAgICAqLwogICAgICBjb250YWluZXI6IG51bGwsCiAgICAgIC8qKgogICAgICAgIFJldHVybnMgd2hldGhlciB0aGUgc2Vzc2lvbiBpcyBjdXJyZW50bHkgYXV0aGVudGljYXRlZC4KCiAgICAgICAgQHByb3BlcnR5IGlzQXV0aGVudGljYXRlZAogICAgICAgIEB0eXBlIEJvb2xlYW4KICAgICAgICBAcmVhZE9ubHkKICAgICAgICBAZGVmYXVsdCBmYWxzZQogICAgICAqLwogICAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlLAogICAgICAvKioKICAgICAgICBAcHJvcGVydHkgYXR0ZW1wdGVkVHJhbnNpdGlvbgogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIGF0dGVtcHRlZFRyYW5zaXRpb246IG51bGwsCiAgICAgIC8qKgogICAgICAgIEBwcm9wZXJ0eSBjb250ZW50CiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgY29udGVudDoge30sCgogICAgICAvKioKICAgICAgICBBdXRoZW50aWNhdGVzIHRoZSBzZXNzaW9uIHdpdGggYW4gYGF1dGhlbnRpY2F0b3JgIGFuZCBhcHByb3ByaWF0ZQogICAgICAgIGBvcHRpb25zYC4gX19UaGlzIGRlbGVnYXRlcyB0aGUgYWN0dWFsIGF1dGhlbnRpY2F0aW9uIHdvcmsgdG8gdGhlCiAgICAgICAgYGF1dGhlbnRpY2F0b3JgX18gYW5kIGhhbmRsZXMgdGhlIHJldHVybmVkIHByb21pc2UgYWNjb3JkaW5nbHkgKHNlZQogICAgICAgIFtgQXV0aGVudGljYXRvcnMuQmFzZSNhdXRoZW50aWNhdGVgXSgjU2ltcGxlQXV0aC1BdXRoZW50aWNhdG9ycy1CYXNlLWF1dGhlbnRpY2F0ZSkpLgogICAgICAgIEFsbCBkYXRhIHRoZSBhdXRoZW50aWNhdG9yIHJlc29sdmVzIHdpdGggd2lsbCBiZSBzYXZlZCBpbiB0aGUgc2Vzc2lvbi4KCiAgICAgICAgX19UaGlzIG1ldGhvZCByZXR1cm5zIGEgcHJvbWlzZSBpdHNlbGYuIEEgcmVzb2x2aW5nIHByb21pc2UgaW5kaWNhdGVzIHRoYXQKICAgICAgICB0aGUgc2Vzc2lvbiB3YXMgc3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWRfXyB3aGlsZSBhIHJlamVjdGluZyBwcm9taXNlCiAgICAgICAgaW5kaWNhdGVzIHRoYXQgYXV0aGVudGljYXRpb24gZmFpbGVkIGFuZCB0aGUgc2Vzc2lvbiByZW1haW5zCiAgICAgICAgdW5hdXRoZW50aWNhdGVkLgoKICAgICAgICBAbWV0aG9kIGF1dGhlbnRpY2F0ZQogICAgICAgIEBwYXJhbSB7U3RyaW5nfSBhdXRoZW50aWNhdG9yIFRoZSBhdXRoZW50aWNhdG9yIGZhY3RvcnkgdG8gdXNlIGFzIGl0IGlzIHJlZ2lzdGVyZWQgd2l0aCBFbWJlcidzIGNvbnRhaW5lciwgc2VlIFtFbWJlcidzIEFQSSBkb2NzXShodHRwOi8vZW1iZXJqcy5jb20vYXBpL2NsYXNzZXMvRW1iZXIuQXBwbGljYXRpb24uaHRtbCNtZXRob2RfcmVnaXN0ZXIpCiAgICAgICAgQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgVGhlIG9wdGlvbnMgdG8gcGFzcyB0byB0aGUgYXV0aGVudGljYXRvcjsgZGVwZW5kaW5nIG9uIHRoZSB0eXBlIG9mIGF1dGhlbnRpY2F0b3IgdGhlc2UgbWlnaHQgYmUgYSBzZXQgb2YgY3JlZGVudGlhbHMsIGEgRmFjZWJvb2sgT0F1dGggVG9rZW4sIGV0Yy4KICAgICAgICBAcmV0dXJuIHtFbWJlci5SU1ZQLlByb21pc2V9IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIHNlc3Npb24gd2FzIGF1dGhlbnRpY2F0ZWQgc3VjY2Vzc2Z1bGx5CiAgICAgICovCiAgICAgIGF1dGhlbnRpY2F0ZTogZnVuY3Rpb24oYXV0aGVudGljYXRvciwgb3B0aW9ucykgewogICAgICAgIEVtYmVyLmFzc2VydCgnU2Vzc2lvbiNhdXRoZW50aWNhdGUgcmVxdWlyZXMgdGhlIGF1dGhlbnRpY2F0b3IgZmFjdG9yeSB0byBiZSBzcGVjaWZpZWQsIHdhcyAnICsgYXV0aGVudGljYXRvciwgIUVtYmVyLmlzRW1wdHkoYXV0aGVudGljYXRvcikpOwogICAgICAgIHZhciBfdGhpcyAgICAgICAgICAgID0gdGhpczsKICAgICAgICB2YXIgdGhlQXV0aGVudGljYXRvciA9IHRoaXMuY29udGFpbmVyLmxvb2t1cChhdXRoZW50aWNhdG9yKTsKICAgICAgICBFbWJlci5hc3NlcnQoJ05vIGF1dGhlbnRpY2F0b3IgZm9yIGZhY3RvcnkgIicgKyBhdXRoZW50aWNhdG9yICsgJyIgY291bGQgYmUgZm91bmQnLCAhRW1iZXIuaXNOb25lKHRoZUF1dGhlbnRpY2F0b3IpKTsKICAgICAgICByZXR1cm4gbmV3IEVtYmVyLlJTVlAuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHRoZUF1dGhlbnRpY2F0b3IuYXV0aGVudGljYXRlKG9wdGlvbnMpLnRoZW4oZnVuY3Rpb24oY29udGVudCkgewogICAgICAgICAgICBfdGhpcy5zZXR1cChhdXRoZW50aWNhdG9yLCBjb250ZW50LCB0cnVlKTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICAgICAgX3RoaXMuY2xlYXIoKTsKICAgICAgICAgICAgX3RoaXMudHJpZ2dlcignc2Vzc2lvbkF1dGhlbnRpY2F0aW9uRmFpbGVkJywgZXJyb3IpOwogICAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBJbnZhbGlkYXRlcyB0aGUgc2Vzc2lvbiB3aXRoIHRoZSBhdXRoZW50aWNhdG9yIGl0IGlzIGN1cnJlbnRseQogICAgICAgIGF1dGhlbnRpY2F0ZWQgd2l0aCAoc2VlCiAgICAgICAgW2BTZXNzaW9uI2F1dGhlbnRpY2F0b3JgXSgjU2ltcGxlQXV0aC1TZXNzaW9uLWF1dGhlbnRpY2F0b3IpKS4gX19UaGlzCiAgICAgICAgaW52b2tlcyB0aGUgYXV0aGVudGljYXRvcidzIGBpbnZhbGlkYXRlYCBtZXRob2QgYW5kIGhhbmRsZXMgdGhlIHJldHVybmVkCiAgICAgICAgcHJvbWlzZSBhY2NvcmRpbmdseV9fIChzZWUKICAgICAgICBbYEF1dGhlbnRpY2F0b3JzLkJhc2UjaW52YWxpZGF0ZWBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UtaW52YWxpZGF0ZSkpLgoKICAgICAgICBfX1RoaXMgbWV0aG9kIHJldHVybnMgYSBwcm9taXNlIGl0c2VsZi4gQSByZXNvbHZpbmcgcHJvbWlzZSBpbmRpY2F0ZXMgdGhhdAogICAgICAgIHRoZSBzZXNzaW9uIHdhcyBzdWNjZXNzZnVsbHkgaW52YWxpZGF0ZWRfXyB3aGlsZSBhIHJlamVjdGluZyBwcm9taXNlCiAgICAgICAgaW5kaWNhdGVzIHRoYXQgdGhlIHByb21pc2UgcmV0dXJuZWQgYnkgdGhlIGBhdXRoZW50aWNhdG9yYCByZWplY3RlZCBhbmQKICAgICAgICB0aHVzIGludmFsaWRhdGlvbiB3YXMgY2FuY2VsbGVkLiBJbiB0aGF0IGNhc2UgdGhlIHNlc3Npb24gcmVtYWlucwogICAgICAgIGF1dGhlbnRpY2F0ZWQuIE9uY2UgdGhlIHNlc3Npb24gaXMgc3VjY2Vzc2Z1bGx5IGludmFsaWRhdGVkIGl0IGNsZWFycyBhbGwKICAgICAgICBvZiBpdHMgZGF0YS4KCiAgICAgICAgQG1ldGhvZCBpbnZhbGlkYXRlCiAgICAgICAgQHJldHVybiB7RW1iZXIuUlNWUC5Qcm9taXNlfSBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBzZXNzaW9uIHdhcyBpbnZhbGlkYXRlZCBzdWNjZXNzZnVsbHkKICAgICAgKi8KICAgICAgaW52YWxpZGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgRW1iZXIuYXNzZXJ0KCdTZXNzaW9uI2ludmFsaWRhdGUgcmVxdWlyZXMgdGhlIHNlc3Npb24gdG8gYmUgYXV0aGVudGljYXRlZCcsIHRoaXMuZ2V0KCdpc0F1dGhlbnRpY2F0ZWQnKSk7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICByZXR1cm4gbmV3IEVtYmVyLlJTVlAuUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHZhciBhdXRoZW50aWNhdG9yID0gX3RoaXMuY29udGFpbmVyLmxvb2t1cChfdGhpcy5hdXRoZW50aWNhdG9yKTsKICAgICAgICAgIGF1dGhlbnRpY2F0b3IuaW52YWxpZGF0ZShfdGhpcy5jb250ZW50KS50aGVuKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBhdXRoZW50aWNhdG9yLm9mZignc2Vzc2lvbkRhdGFVcGRhdGVkJyk7CiAgICAgICAgICAgIF90aGlzLmNsZWFyKHRydWUpOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICBfdGhpcy50cmlnZ2VyKCdzZXNzaW9uSW52YWxpZGF0aW9uRmFpbGVkJywgZXJyb3IpOwogICAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBAbWV0aG9kIHJlc3RvcmUKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICByZXN0b3JlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHJldHVybiBuZXcgRW1iZXIuUlNWUC5Qcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIHJlc3RvcmVkQ29udGVudCA9IF90aGlzLnN0b3JlLnJlc3RvcmUoKTsKICAgICAgICAgIHZhciBhdXRoZW50aWNhdG9yICAgPSByZXN0b3JlZENvbnRlbnQuYXV0aGVudGljYXRvcjsKICAgICAgICAgIGlmICghIWF1dGhlbnRpY2F0b3IpIHsKICAgICAgICAgICAgZGVsZXRlIHJlc3RvcmVkQ29udGVudC5hdXRoZW50aWNhdG9yOwogICAgICAgICAgICBfdGhpcy5jb250YWluZXIubG9va3VwKGF1dGhlbnRpY2F0b3IpLnJlc3RvcmUocmVzdG9yZWRDb250ZW50KS50aGVuKGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgICAgICAgICAgICBfdGhpcy5zZXR1cChhdXRoZW50aWNhdG9yLCBjb250ZW50KTsKICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIF90aGlzLnN0b3JlLmNsZWFyKCk7CiAgICAgICAgICAgICAgcmVqZWN0KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMuc3RvcmUuY2xlYXIoKTsKICAgICAgICAgICAgcmVqZWN0KCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBAbWV0aG9kIHNldHVwCiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgc2V0dXA6IGZ1bmN0aW9uKGF1dGhlbnRpY2F0b3IsIGNvbnRlbnQsIHRyaWdnZXIpIHsKICAgICAgICBjb250ZW50ID0gRW1iZXIubWVyZ2UoRW1iZXIubWVyZ2Uoe30sIHRoaXMuY29udGVudCksIGNvbnRlbnQpOwogICAgICAgIHRyaWdnZXIgPSAhIXRyaWdnZXIgJiYgIXRoaXMuZ2V0KCdpc0F1dGhlbnRpY2F0ZWQnKTsKICAgICAgICB0aGlzLmJlZ2luUHJvcGVydHlDaGFuZ2VzKCk7CiAgICAgICAgdGhpcy5zZXRQcm9wZXJ0aWVzKHsKICAgICAgICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZSwKICAgICAgICAgIGF1dGhlbnRpY2F0b3I6ICAgYXV0aGVudGljYXRvciwKICAgICAgICAgIGNvbnRlbnQ6ICAgICAgICAgY29udGVudAogICAgICAgIH0pOwogICAgICAgIHRoaXMuYmluZFRvQXV0aGVudGljYXRvckV2ZW50cygpOwogICAgICAgIHRoaXMudXBkYXRlU3RvcmUoKTsKICAgICAgICB0aGlzLmVuZFByb3BlcnR5Q2hhbmdlcygpOwogICAgICAgIGlmICh0cmlnZ2VyKSB7CiAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Nlc3Npb25BdXRoZW50aWNhdGlvblN1Y2NlZWRlZCcpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgY2xlYXIKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICBjbGVhcjogZnVuY3Rpb24odHJpZ2dlcikgewogICAgICAgIHRyaWdnZXIgPSAhIXRyaWdnZXIgJiYgdGhpcy5nZXQoJ2lzQXV0aGVudGljYXRlZCcpOwogICAgICAgIHRoaXMuYmVnaW5Qcm9wZXJ0eUNoYW5nZXMoKTsKICAgICAgICB0aGlzLnNldFByb3BlcnRpZXMoewogICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiBmYWxzZSwKICAgICAgICAgIGF1dGhlbnRpY2F0b3I6ICAgbnVsbCwKICAgICAgICAgIGNvbnRlbnQ6ICAgICAgICAge30KICAgICAgICB9KTsKICAgICAgICB0aGlzLnN0b3JlLmNsZWFyKCk7CiAgICAgICAgdGhpcy5lbmRQcm9wZXJ0eUNoYW5nZXMoKTsKICAgICAgICBpZiAodHJpZ2dlcikgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdzZXNzaW9uSW52YWxpZGF0aW9uU3VjY2VlZGVkJyk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgQG1ldGhvZCBzZXRVbmtub3duUHJvcGVydHkKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICBzZXRVbmtub3duUHJvcGVydHk6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5fc3VwZXIoa2V5LCB2YWx1ZSk7CiAgICAgICAgdGhpcy51cGRhdGVTdG9yZSgpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBAbWV0aG9kIHVwZGF0ZVN0b3JlCiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgdXBkYXRlU3RvcmU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBkYXRhID0gdGhpcy5jb250ZW50OwogICAgICAgIGlmICghRW1iZXIuaXNFbXB0eSh0aGlzLmF1dGhlbnRpY2F0b3IpKSB7CiAgICAgICAgICBkYXRhID0gRW1iZXIubWVyZ2UoeyBhdXRoZW50aWNhdG9yOiB0aGlzLmF1dGhlbnRpY2F0b3IgfSwgZGF0YSk7CiAgICAgICAgfQogICAgICAgIGlmICghRW1iZXIuaXNFbXB0eShkYXRhKSkgewogICAgICAgICAgdGhpcy5zdG9yZS5wZXJzaXN0KGRhdGEpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgYmluZFRvQXV0aGVudGljYXRvckV2ZW50cwogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIGJpbmRUb0F1dGhlbnRpY2F0b3JFdmVudHM6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdmFyIGF1dGhlbnRpY2F0b3IgPSB0aGlzLmNvbnRhaW5lci5sb29rdXAodGhpcy5hdXRoZW50aWNhdG9yKTsKICAgICAgICBhdXRoZW50aWNhdG9yLm9mZignc2Vzc2lvbkRhdGFVcGRhdGVkJyk7CiAgICAgICAgYXV0aGVudGljYXRvci5vZmYoJ3Nlc3Npb25EYXRhSW52YWxpZGF0ZWQnKTsKICAgICAgICBhdXRoZW50aWNhdG9yLm9uKCdzZXNzaW9uRGF0YVVwZGF0ZWQnLCBmdW5jdGlvbihjb250ZW50KSB7CiAgICAgICAgICBfdGhpcy5zZXR1cChfdGhpcy5hdXRoZW50aWNhdG9yLCBjb250ZW50KTsKICAgICAgICB9KTsKICAgICAgICBhdXRoZW50aWNhdG9yLm9uKCdzZXNzaW9uRGF0YUludmFsaWRhdGVkJywgZnVuY3Rpb24oY29udGVudCkgewogICAgICAgICAgX3RoaXMuY2xlYXIodHJ1ZSk7CiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBAbWV0aG9kIGJpbmRUb1N0b3JlRXZlbnRzCiAgICAgICAgQHByaXZhdGUKICAgICAgKi8KICAgICAgYmluZFRvU3RvcmVFdmVudHM6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdGhpcy5zdG9yZS5vbignc2Vzc2lvbkRhdGFVcGRhdGVkJywgZnVuY3Rpb24oY29udGVudCkgewogICAgICAgICAgdmFyIGF1dGhlbnRpY2F0b3IgPSBjb250ZW50LmF1dGhlbnRpY2F0b3I7CiAgICAgICAgICBpZiAoISFhdXRoZW50aWNhdG9yKSB7CiAgICAgICAgICAgIGRlbGV0ZSBjb250ZW50LmF1dGhlbnRpY2F0b3I7CiAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5sb29rdXAoYXV0aGVudGljYXRvcikucmVzdG9yZShjb250ZW50KS50aGVuKGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgICAgICAgICAgICBfdGhpcy5zZXR1cChhdXRoZW50aWNhdG9yLCBjb250ZW50LCB0cnVlKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgX3RoaXMuY2xlYXIodHJ1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMuY2xlYXIodHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0ub2JzZXJ2ZXMoJ3N0b3JlJykKICAgIH0pOwogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL3NldHVwIiwgCiAgWyIuL2NvbmZpZ3VyYXRpb24iLCIuL3Nlc3Npb24iLCIuL3N0b3Jlcy9sb2NhbC1zdG9yYWdlIiwiLi9zdG9yZXMvZXBoZW1lcmFsIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19kZXBlbmRlbmN5Ml9fLCBfX2RlcGVuZGVuY3kzX18sIF9fZGVwZW5kZW5jeTRfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBDb25maWd1cmF0aW9uID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CiAgICB2YXIgU2Vzc2lvbiA9IF9fZGVwZW5kZW5jeTJfX1siZGVmYXVsdCJdOwogICAgdmFyIExvY2FsU3RvcmFnZSA9IF9fZGVwZW5kZW5jeTNfX1siZGVmYXVsdCJdOwogICAgdmFyIEVwaGVtZXJhbCA9IF9fZGVwZW5kZW5jeTRfX1siZGVmYXVsdCJdOwoKICAgIGZ1bmN0aW9uIGV4dHJhY3RMb2NhdGlvbk9yaWdpbihsb2NhdGlvbikgewogICAgICBpZiAobG9jYXRpb24gPT09ICcqJyl7CiAgICAgICAgICByZXR1cm4gbG9jYXRpb247CiAgICAgIH0KICAgICAgaWYgKEVtYmVyLnR5cGVPZihsb2NhdGlvbikgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgbGluay5ocmVmID0gbG9jYXRpb247CiAgICAgICAgLy9JRSByZXF1aXJlcyB0aGUgZm9sbG93aW5nIGxpbmUgd2hlbiB1cmwgaXMgcmVsYXRpdmUuCiAgICAgICAgLy9GaXJzdCBhc3NpZ25tZW50IG9mIHJlbGF0aXZlIHVybCB0byBsaW5rLmhyZWYgcmVzdWx0cyBpbiBhYnNvbHV0ZSB1cmwgb24gbGluay5ocmVmIGJ1dCBsaW5rLmhvc3RuYW1lIGFuZCBvdGhlciBwcm9wZXJ0aWVzIGFyZSBub3Qgc2V0CiAgICAgICAgLy9TZWNvbmQgYXNzaWdubWVudCBvZiBhYnNvbHV0ZSB1cmwgdG8gbGluay5ocmVmIHJlc3VsdHMgaW4gbGluay5ob3N0bmFtZSBhbmQgb3RoZXIgcHJvcGVydGllcyBiZWluZyBzZXQgYXMgZXhwZWN0ZWQKICAgICAgICBsaW5rLmhyZWYgPSBsaW5rLmhyZWY7CiAgICAgICAgbG9jYXRpb24gPSBsaW5rOwogICAgICB9CiAgICAgIHZhciBwb3J0ID0gbG9jYXRpb24ucG9ydDsKICAgICAgaWYgKEVtYmVyLmlzRW1wdHkocG9ydCkpIHsKICAgICAgICAvL25lZWQgdG8gaW5jbHVkZSB0aGUgcG9ydCB3aGV0aGVyIGl0cyBhY3R1YWxseSBwcmVzZW50IG9yIG5vdCBhcyBzb21lIHZlcnNpb25zIG9mIElFIHdpbGwgYWx3YXlzIHNldCBpdAogICAgICAgIHBvcnQgPSBsb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHA6JyA/ICc4MCcgOiAobG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonID8gJzQ0MycgOiAnJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3RuYW1lICsgKHBvcnQgIT09ICcnID8gJzonICsgcG9ydCA6ICcnKTsKICAgIH0KCiAgICB2YXIgdXJsT3JpZ2lucyAgICAgPSB7fTsKICAgIHZhciBjcm9zc09yaWdpbldoaXRlbGlzdDsKICAgIGZ1bmN0aW9uIHNob3VsZEF1dGhvcml6ZVJlcXVlc3Qob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucy5jcm9zc0RvbWFpbiA9PT0gZmFsc2UgfHwgY3Jvc3NPcmlnaW5XaGl0ZWxpc3QuaW5kZXhPZignKicpID4gLTEpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICB2YXIgdXJsT3JpZ2luID0gdXJsT3JpZ2luc1tvcHRpb25zLnVybF0gPSB1cmxPcmlnaW5zW29wdGlvbnMudXJsXSB8fCBleHRyYWN0TG9jYXRpb25PcmlnaW4ob3B0aW9ucy51cmwpOwogICAgICByZXR1cm4gY3Jvc3NPcmlnaW5XaGl0ZWxpc3QuaW5kZXhPZih1cmxPcmlnaW4pID4gLTE7CiAgICB9CgogICAgZnVuY3Rpb24gcmVnaXN0ZXJGYWN0b3JpZXMoY29udGFpbmVyKSB7CiAgICAgIGNvbnRhaW5lci5yZWdpc3Rlcignc2ltcGxlLWF1dGgtc2Vzc2lvbi1zdG9yZTpsb2NhbC1zdG9yYWdlJywgTG9jYWxTdG9yYWdlKTsKICAgICAgY29udGFpbmVyLnJlZ2lzdGVyKCdzaW1wbGUtYXV0aC1zZXNzaW9uLXN0b3JlOmVwaGVtZXJhbCcsIEVwaGVtZXJhbCk7CiAgICAgIGNvbnRhaW5lci5yZWdpc3Rlcignc2ltcGxlLWF1dGgtc2Vzc2lvbjptYWluJywgU2Vzc2lvbik7CiAgICB9CgogICAgdmFyIGRpZFNldHVwQWpheEhvb2tzID0gZmFsc2U7CgogICAgLyoqCiAgICAgIEBtZXRob2Qgc2V0dXAKICAgICAgQHByaXZhdGUKICAgICoqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgYXBwbGljYXRpb24pIHsKICAgICAgYXBwbGljYXRpb24uZGVmZXJSZWFkaW5lc3MoKTsKICAgICAgcmVnaXN0ZXJGYWN0b3JpZXMoY29udGFpbmVyKTsKCiAgICAgIHZhciBzdG9yZSAgID0gY29udGFpbmVyLmxvb2t1cChDb25maWd1cmF0aW9uLnN0b3JlKTsKICAgICAgdmFyIHNlc3Npb24gPSBjb250YWluZXIubG9va3VwKENvbmZpZ3VyYXRpb24uc2Vzc2lvbik7CiAgICAgIHNlc3Npb24uc2V0UHJvcGVydGllcyh7IHN0b3JlOiBzdG9yZSwgY29udGFpbmVyOiBjb250YWluZXIgfSk7CiAgICAgIEVtYmVyLkEoWydjb250cm9sbGVyJywgJ3JvdXRlJ10pLmZvckVhY2goZnVuY3Rpb24oY29tcG9uZW50KSB7CiAgICAgICAgY29udGFpbmVyLmluamVjdGlvbihjb21wb25lbnQsIENvbmZpZ3VyYXRpb24uc2Vzc2lvblByb3BlcnR5TmFtZSwgQ29uZmlndXJhdGlvbi5zZXNzaW9uKTsKICAgICAgfSk7CgogICAgICBjcm9zc09yaWdpbldoaXRlbGlzdCA9IEVtYmVyLkEoQ29uZmlndXJhdGlvbi5jcm9zc09yaWdpbldoaXRlbGlzdCkubWFwKGZ1bmN0aW9uKG9yaWdpbikgewogICAgICAgIHJldHVybiBleHRyYWN0TG9jYXRpb25PcmlnaW4ob3JpZ2luKTsKICAgICAgfSk7CgogICAgICBpZiAoIUVtYmVyLmlzRW1wdHkoQ29uZmlndXJhdGlvbi5hdXRob3JpemVyKSkgewogICAgICAgIHZhciBhdXRob3JpemVyID0gY29udGFpbmVyLmxvb2t1cChDb25maWd1cmF0aW9uLmF1dGhvcml6ZXIpOwogICAgICAgIGlmICghIWF1dGhvcml6ZXIpIHsKICAgICAgICAgIGF1dGhvcml6ZXIuc2V0KCdzZXNzaW9uJywgc2Vzc2lvbik7CiAgICAgICAgICBpZiAoIWRpZFNldHVwQWpheEhvb2tzKSB7CiAgICAgICAgICAgIEVtYmVyLiQuYWpheFByZWZpbHRlcihmdW5jdGlvbihvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSKSB7CiAgICAgICAgICAgICAgaWYgKCFhdXRob3JpemVyLmlzRGVzdHJveWVkICYmIHNob3VsZEF1dGhvcml6ZVJlcXVlc3Qob3B0aW9ucykpIHsKICAgICAgICAgICAgICAgIGpxWEhSLl9fc2ltcGxlX2F1dGhfYXV0aG9yaXplZF9fID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGF1dGhvcml6ZXIuYXV0aG9yaXplKGpxWEhSLCBvcHRpb25zKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBFbWJlci4kKGRvY3VtZW50KS5hamF4RXJyb3IoZnVuY3Rpb24oZXZlbnQsIGpxWEhSLCBzZXR0aW5nLCBleGNlcHRpb24pIHsKICAgICAgICAgICAgICBpZiAoISFqcVhIUi5fX3NpbXBsZV9hdXRoX2F1dGhvcml6ZWRfXyAmJiBqcVhIUi5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgc2Vzc2lvbi50cmlnZ2VyKCdhdXRob3JpemF0aW9uRmFpbGVkJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZGlkU2V0dXBBamF4SG9va3MgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBFbWJlci5Mb2dnZXIuaW5mbygnTm8gYXV0aG9yaXplciB3YXMgY29uZmlndXJlZCBmb3IgRW1iZXIgU2ltcGxlIEF1dGggLSBzcGVjaWZ5IG9uZSBpZiBiYWNrZW5kIHJlcXVlc3RzIG5lZWQgdG8gYmUgYXV0aG9yaXplZC4nKTsKICAgICAgfQoKICAgICAgdmFyIGFkdmFuY2VSZWFkaW5lc3MgPSBmdW5jdGlvbigpIHsKICAgICAgICBhcHBsaWNhdGlvbi5hZHZhbmNlUmVhZGluZXNzKCk7CiAgICAgIH07CiAgICAgIHNlc3Npb24ucmVzdG9yZSgpLnRoZW4oYWR2YW5jZVJlYWRpbmVzcywgYWR2YW5jZVJlYWRpbmVzcyk7CiAgICB9CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvc3RvcmVzL2Jhc2UiLCAKICBbIi4uL3V0aWxzL29iamVjdHMtYXJlLWVxdWFsIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBvYmplY3RzQXJlRXF1YWwgPSBfX2RlcGVuZGVuY3kxX19bImRlZmF1bHQiXTsKCiAgICAvKioKICAgICAgVGhlIGJhc2UgZm9yIGFsbCBzdG9yZSB0eXBlcy4gX19UaGlzIHNlcnZlcyBhcyBhIHN0YXJ0aW5nIHBvaW50IGZvcgogICAgICBpbXBsZW1lbnRpbmcgY3VzdG9tIHN0b3JlcyBhbmQgbXVzdCBub3QgYmUgdXNlZCBkaXJlY3RseS5fXwoKICAgICAgU3RvcmVzIGFyZSB1c2VkIHRvIHBlcnNpc3QgdGhlIHNlc3Npb24ncyBzdGF0ZSBzbyBpdCBzdXJ2aXZlcyBhIHBhZ2UgcmVsb2FkCiAgICAgIGFuZCBpcyBzeW5jaHJvbml6ZWQgYWNyb3NzIG11bHRpcGxlIHRhYnMgb3Igd2luZG93cyBvZiB0aGUgc2FtZSBhcHBsaWNhdGlvbi4KICAgICAgVGhlIHN0b3JlIHRvIGJlIHVzZWQgd2l0aCB0aGUgYXBwbGljYXRpb24gY2FuIGJlIGNvbmZpZ3VyZWQgb24gdGhlCiAgICAgIGFwcGxpY2F0aW9uJ3MgZW52aXJvbm1lbnQgb2JqZWN0OgoKICAgICAgYGBganMKICAgICAgRU5WWydzaW1wbGUtYXV0aCddID0gewogICAgICAgIHN0b3JlOiAnc2ltcGxlLWF1dGgtc2Vzc2lvbi1zdG9yZTpsb2NhbC1zdG9yYWdlJwogICAgICB9CiAgICAgIGBgYAoKICAgICAgQGNsYXNzIEJhc2UKICAgICAgQG5hbWVzcGFjZSBTaW1wbGVBdXRoLlN0b3JlcwogICAgICBAbW9kdWxlIHNpbXBsZS1hdXRoL3N0b3Jlcy9iYXNlCiAgICAgIEBleHRlbmRzIEVtYmVyLk9iamVjdAogICAgICBAdXNlcyBFbWJlci5FdmVudGVkCiAgICAqLwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IEVtYmVyLk9iamVjdC5leHRlbmQoRW1iZXIuRXZlbnRlZCwgewogICAgICAvKioKICAgICAgICBfX1RyaWdnZXJlZCB3aGVuIHRoZSBkYXRhIHRoYXQgY29uc3RpdHV0ZXMgdGhlIHNlc3Npb24gY2hhbmdlcyBpbiB0aGUKICAgICAgICBzdG9yZS4gVGhpcyB1c3VhbGx5IGhhcHBlbnMgYmVjYXVzZSB0aGUgc2Vzc2lvbiBpcyBhdXRoZW50aWNhdGVkIG9yCiAgICAgICAgaW52YWxpZGF0ZWQgaW4gYW5vdGhlciB0YWIgb3Igd2luZG93Ll9fIFRoZSBzZXNzaW9uIGF1dG9tYXRpY2FsbHkgY2F0Y2hlcwogICAgICAgIHRoYXQgZXZlbnQsIHBhc3NlcyB0aGUgdXBkYXRlZCBkYXRhIHRvIGl0cyBhdXRoZW50aWNhdG9yJ3MKICAgICAgICBbYEF1dGhlbnRpY2F0b3JzLkJhc2UjcmVzdG9yZWBdKCNTaW1wbGVBdXRoLUF1dGhlbnRpY2F0b3JzLUJhc2UtcmVzdG9yZSkKICAgICAgICBtZXRob2QgYW5kIGhhbmRsZXMgdGhlIHJlc3VsdCBvZiB0aGF0IGludm9jYXRpb24gYWNjb3JkaW5nbHkuCgogICAgICAgIEBldmVudCBzZXNzaW9uRGF0YVVwZGF0ZWQKICAgICAgICBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgdXBkYXRlZCBzZXNzaW9uIGRhdGEKICAgICAgKi8KCiAgICAgIC8qKgogICAgICAgIFBlcnNpc3RzIHRoZSBgZGF0YWAgaW4gdGhlIHN0b3JlLiBUaGlzIGFjdHVhbGx5IHJlcGxhY2VzIGFsbCBjdXJyZW50bHkKICAgICAgICBzdG9yZWQgZGF0YS4KCiAgICAgICAgYFN0b3Jlcy5CYXNlYCdzIGltcGxlbWVudGF0aW9uIGRvZXMgbm90aGluZy4KCiAgICAgICAgQG1ldGhvZCBwZXJzaXN0CiAgICAgICAgQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gcGVyc2lzdAogICAgICAqLwogICAgICBwZXJzaXN0OiBmdW5jdGlvbihkYXRhKSB7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBSZXN0b3JlcyBhbGwgZGF0YSBjdXJyZW50bHkgc2F2ZWQgaW4gdGhlIHN0b3JlIGFzIGEgcGxhaW4gb2JqZWN0LgoKICAgICAgICBgU3RvcmVzLkJhc2VgJ3MgaW1wbGVtZW50YXRpb24gYWx3YXlzIHJldHVybnMgYW4gZW1wdHkgcGxhaW4gT2JqZWN0LgoKICAgICAgICBAbWV0aG9kIHJlc3RvcmUKICAgICAgICBAcmV0dXJuIHtPYmplY3R9IFRoZSBkYXRhIGN1cnJlbnRseSBwZXJzaXN0ZWQgaW4gdGhlIHN0b3JlLgogICAgICAqLwogICAgICByZXN0b3JlOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4ge307CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBDbGVhcnMgdGhlIHN0b3JlLgoKICAgICAgICBgU3RvcmVzLkJhc2VgJ3MgaW1wbGVtZW50YXRpb24gZG9lcyBub3RoaW5nLgoKICAgICAgICBAbWV0aG9kIGNsZWFyCiAgICAgICovCiAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHsKICAgICAgfQogICAgfSk7CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvc3RvcmVzL2VwaGVtZXJhbCIsIAogIFsiLi9iYXNlIiwiZXhwb3J0cyJdLAogIGZ1bmN0aW9uKF9fZGVwZW5kZW5jeTFfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBCYXNlID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CgogICAgLyoqCiAgICAgIFN0b3JlIHRoYXQgc2F2ZXMgaXRzIGRhdGEgaW4gbWVtb3J5IGFuZCB0aHVzIF9faXMgbm90IGFjdHVhbGx5IHBlcnNpc3RlbnRfXy4KICAgICAgSXQgZG9lcyBhbHNvIG5vdCBzeW5jaHJvbml6ZSB0aGUgc2Vzc2lvbidzIHN0YXRlIGFjcm9zcyBtdWx0aXBsZSB0YWJzIG9yCiAgICAgIHdpbmRvd3MgYXMgdGhvc2UgY2Fubm90IHNoYXJlIG1lbW9yeS4KCiAgICAgIF9fVGhpcyBzdG9yZSBpcyBtYWlubHkgdXNlZnVsIGZvciB0ZXN0aW5nLl9fCgogICAgICBfVGhlIGZhY3RvcnkgZm9yIHRoaXMgc3RvcmUgaXMgcmVnaXN0ZXJlZCBhcwogICAgICBgJ3NpbXBsZS1hdXRoLXNlc3Npb24tc3RvcmU6ZXBoZW1lcmFsJ2AgaW4gRW1iZXIncyBjb250YWluZXIuXwoKICAgICAgQGNsYXNzIEVwaGVtZXJhbAogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGguU3RvcmVzCiAgICAgIEBtb2R1bGUgc2ltcGxlLWF1dGgvc3RvcmVzL2VwaGVtZXJhbAogICAgICBAZXh0ZW5kcyBTdG9yZXMuQmFzZQogICAgKi8KICAgIF9fZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBCYXNlLmV4dGVuZCh7CiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgaW5pdAogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIGluaXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFBlcnNpc3RzIHRoZSBgZGF0YWAuCgogICAgICAgIEBtZXRob2QgcGVyc2lzdAogICAgICAgIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBkYXRhIHRvIHBlcnNpc3QKICAgICAgKi8KICAgICAgcGVyc2lzdDogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHRoaXMuX2RhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhIHx8IHt9KTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFJlc3RvcmVzIGFsbCBkYXRhIGN1cnJlbnRseSBzYXZlZCBhcyBhIHBsYWluIG9iamVjdC4KCiAgICAgICAgQG1ldGhvZCByZXN0b3JlCiAgICAgICAgQHJldHVybiB7T2JqZWN0fSBBbGwgZGF0YSBjdXJyZW50bHkgcGVyc2lzdGVkCiAgICAgICovCiAgICAgIHJlc3RvcmU6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXMuX2RhdGEpIHx8IHt9OwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAgQ2xlYXJzIHRoZSBzdG9yZS4KCiAgICAgICAgQG1ldGhvZCBjbGVhcgogICAgICAqLwogICAgICBjbGVhcjogZnVuY3Rpb24oKSB7CiAgICAgICAgZGVsZXRlIHRoaXMuX2RhdGE7CiAgICAgICAgdGhpcy5fZGF0YSA9ICd7fSc7CiAgICAgIH0KICAgIH0pOwogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL3N0b3Jlcy9sb2NhbC1zdG9yYWdlIiwgCiAgWyIuL2Jhc2UiLCIuLi91dGlscy9vYmplY3RzLWFyZS1lcXVhbCIsIi4uL2NvbmZpZ3VyYXRpb24iLCJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19kZXBlbmRlbmN5MV9fLCBfX2RlcGVuZGVuY3kyX18sIF9fZGVwZW5kZW5jeTNfXywgX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBCYXNlID0gX19kZXBlbmRlbmN5MV9fWyJkZWZhdWx0Il07CiAgICB2YXIgb2JqZWN0c0FyZUVxdWFsID0gX19kZXBlbmRlbmN5Ml9fWyJkZWZhdWx0Il07CiAgICB2YXIgQ29uZmlndXJhdGlvbiA9IF9fZGVwZW5kZW5jeTNfX1siZGVmYXVsdCJdOwoKICAgIC8qKgogICAgICBTdG9yZSB0aGF0IHNhdmVzIGl0cyBkYXRhIGluIHRoZSBicm93c2VyJ3MgYGxvY2FsU3RvcmFnZWAuCgogICAgICBfVGhlIGZhY3RvcnkgZm9yIHRoaXMgc3RvcmUgaXMgcmVnaXN0ZXJlZCBhcwogICAgICBgJ3NpbXBsZS1hdXRoLXNlc3Npb24tc3RvcmU6bG9jYWwtc3RvcmFnZSdgIGluIEVtYmVyJ3MgY29udGFpbmVyLl8KCiAgICAgIF9fYFN0b3Jlcy5Mb2NhbFN0b3JhZ2VgIGlzIEVtYmVyIFNpbXBsZSBBdXRoJ3MgZGVmYXVsdCBzdG9yZS5fXwoKICAgICAgQGNsYXNzIExvY2FsU3RvcmFnZQogICAgICBAbmFtZXNwYWNlIFNpbXBsZUF1dGguU3RvcmVzCiAgICAgIEBtb2R1bGUgc2ltcGxlLWF1dGgvc3RvcmVzL2xvY2FsLXN0b3JhZ2UKICAgICAgQGV4dGVuZHMgU3RvcmVzLkJhc2UKICAgICovCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gQmFzZS5leHRlbmQoewogICAgICAvKioKICAgICAgICBUaGUga2V5IHRoZSBzdG9yZSBzdG9yZXMgdGhlIGRhdGEgaW4uCgogICAgICAgIEBwcm9wZXJ0eSBrZXkKICAgICAgICBAdHlwZSBTdHJpbmcKICAgICAgICBAZGVmYXVsdCAnZW1iZXJfc2ltcGxlX2F1dGg6c2Vzc2lvbicKICAgICAgKi8KICAgICAga2V5OiAnZW1iZXJfc2ltcGxlX2F1dGg6c2Vzc2lvbicsCgogICAgICAvKioKICAgICAgICBAbWV0aG9kIGluaXQKICAgICAgICBAcHJpdmF0ZQogICAgICAqLwogICAgICBpbml0OiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLmtleSA9IENvbmZpZ3VyYXRpb24ubG9jYWxTdG9yYWdlS2V5OwoKICAgICAgICB0aGlzLmJpbmRUb1N0b3JhZ2VFdmVudHMoKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIFBlcnNpc3RzIHRoZSBgZGF0YWAgaW4gdGhlIGBsb2NhbFN0b3JhZ2VgLgoKICAgICAgICBAbWV0aG9kIHBlcnNpc3QKICAgICAgICBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSB0byBwZXJzaXN0CiAgICAgICovCiAgICAgIHBlcnNpc3Q6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICBkYXRhID0gSlNPTi5zdHJpbmdpZnkoZGF0YSB8fCB7fSk7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5rZXksIGRhdGEpOwogICAgICAgIHRoaXMuX2xhc3REYXRhID0gdGhpcy5yZXN0b3JlKCk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICBSZXN0b3JlcyBhbGwgZGF0YSBjdXJyZW50bHkgc2F2ZWQgaW4gdGhlIGBsb2NhbFN0b3JhZ2VgIGlkZW50aWZpZWQgYnkgdGhlCiAgICAgICAgYGtleVByZWZpeGAgYXMgb25lIHBsYWluIG9iamVjdC4KCiAgICAgICAgQG1ldGhvZCByZXN0b3JlCiAgICAgICAgQHJldHVybiB7T2JqZWN0fSBBbGwgZGF0YSBjdXJyZW50bHkgcGVyc2lzdGVkIGluIHRoZSBgbG9jYWxTdG9yYWdlYAogICAgICAqLwogICAgICByZXN0b3JlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMua2V5KTsKICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKSB8fCB7fTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIENsZWFycyB0aGUgc3RvcmUgYnkgZGVsZXRpbmcgYWxsIGBsb2NhbFN0b3JhZ2VgIGtleXMgcHJlZml4ZWQgd2l0aCB0aGUKICAgICAgICBga2V5UHJlZml4YC4KCiAgICAgICAgQG1ldGhvZCBjbGVhcgogICAgICAqLwogICAgICBjbGVhcjogZnVuY3Rpb24oKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5rZXkpOwogICAgICAgIHRoaXMuX2xhc3REYXRhID0gbnVsbDsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgIEBtZXRob2QgYmluZFRvU3RvcmFnZUV2ZW50cwogICAgICAgIEBwcml2YXRlCiAgICAgICovCiAgICAgIGJpbmRUb1N0b3JhZ2VFdmVudHM6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgRW1iZXIuJCh3aW5kb3cpLmJpbmQoJ3N0b3JhZ2UnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IF90aGlzLnJlc3RvcmUoKTsKICAgICAgICAgIGlmICghb2JqZWN0c0FyZUVxdWFsKGRhdGEsIF90aGlzLl9sYXN0RGF0YSkpIHsKICAgICAgICAgICAgX3RoaXMuX2xhc3REYXRhID0gZGF0YTsKICAgICAgICAgICAgX3RoaXMudHJpZ2dlcignc2Vzc2lvbkRhdGFVcGRhdGVkJywgZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL3V0aWxzL2dldC1nbG9iYWwtY29uZmlnIiwgCiAgWyJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBnbG9iYWwgPSAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpID8gd2luZG93IDoge307CgogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IGZ1bmN0aW9uKHNjb3BlKSB7CiAgICAgIHJldHVybiBFbWJlci5nZXQoZ2xvYmFsLCAnRU5WLicgKyBzY29wZSkgfHwge307CiAgICB9CiAgfSk7CmRlZmluZSgic2ltcGxlLWF1dGgvdXRpbHMvbG9hZC1jb25maWciLCAKICBbImV4cG9ydHMiXSwKICBmdW5jdGlvbihfX2V4cG9ydHNfXykgewogICAgInVzZSBzdHJpY3QiOwogICAgX19leHBvcnRzX19bImRlZmF1bHQiXSA9IGZ1bmN0aW9uKGRlZmF1bHRzLCBjYWxsYmFjaykgewogICAgICByZXR1cm4gZnVuY3Rpb24oY29udGFpbmVyLCBjb25maWcpIHsKICAgICAgICB2YXIgd3JhcHBlZENvbmZpZyA9IEVtYmVyLk9iamVjdC5jcmVhdGUoY29uZmlnKTsKICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiB0aGlzKSB7CiAgICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkgJiYgRW1iZXIudHlwZU9mKHRoaXNbcHJvcGVydHldKSAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aGlzW3Byb3BlcnR5XSA9IHdyYXBwZWRDb25maWcuZ2V0V2l0aERlZmF1bHQocHJvcGVydHksIGRlZmF1bHRzW3Byb3BlcnR5XSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgY2FsbGJhY2suYXBwbHkodGhpcywgW2NvbnRhaW5lciwgY29uZmlnXSk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0pOwpkZWZpbmUoInNpbXBsZS1hdXRoL3V0aWxzL29iamVjdHMtYXJlLWVxdWFsIiwgCiAgWyJleHBvcnRzIl0sCiAgZnVuY3Rpb24oX19leHBvcnRzX18pIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIC8qKgogICAgICBAbWV0aG9kIG9iamVjdHNBcmVFcXVhbAogICAgICBAcHJpdmF0ZQogICAgKi8KICAgIGZ1bmN0aW9uIG9iamVjdHNBcmVFcXVhbChhLCBiKSB7CiAgICAgIGlmIChhID09PSBiKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIE9iamVjdCkgfHwgIShiIGluc3RhbmNlb2YgT2JqZWN0KSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZihhLmNvbnN0cnVjdG9yICE9PSBiLmNvbnN0cnVjdG9yKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBhKSB7CiAgICAgICAgaWYgKCFhLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghYi5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFbcHJvcGVydHldID09PSBiW3Byb3BlcnR5XSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChFbWJlci50eXBlT2YoYVtwcm9wZXJ0eV0pICE9PSAnb2JqZWN0JykgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIW9iamVjdHNBcmVFcXVhbChhW3Byb3BlcnR5XSwgYltwcm9wZXJ0eV0pKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKHByb3BlcnR5IGluIGIpIHsKICAgICAgICBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkgJiYgIWEuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBfX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gb2JqZWN0c0FyZUVxdWFsOwogIH0pOwp2YXIgaW5pdGlhbGl6ZXIgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC9pbml0aWFsaXplcicpWydkZWZhdWx0J107CnZhciBDb25maWd1cmF0aW9uICAgICAgICAgICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL2NvbmZpZ3VyYXRpb24nKVsnZGVmYXVsdCddOwp2YXIgU2Vzc2lvbiAgICAgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC9zZXNzaW9uJylbJ2RlZmF1bHQnXTsKdmFyIEJhc2VBdXRoZW50aWNhdG9yICAgICAgICAgICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvYXV0aGVudGljYXRvcnMvYmFzZScpWydkZWZhdWx0J107CnZhciBCYXNlQXV0aG9yaXplciAgICAgICAgICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL2F1dGhvcml6ZXJzL2Jhc2UnKVsnZGVmYXVsdCddOwp2YXIgQmFzZVN0b3JlICAgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC9zdG9yZXMvYmFzZScpWydkZWZhdWx0J107CnZhciBMb2NhbFN0b3JhZ2VTdG9yZSAgICAgICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL3N0b3Jlcy9sb2NhbC1zdG9yYWdlJylbJ2RlZmF1bHQnXTsKdmFyIEVwaGVtZXJhbFN0b3JlICAgICAgICAgICAgICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvc3RvcmVzL2VwaGVtZXJhbCcpWydkZWZhdWx0J107CnZhciBvYmplY3RzQXJlRXF1YWwgICAgICAgICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL3V0aWxzL29iamVjdHMtYXJlLWVxdWFsJylbJ2RlZmF1bHQnXTsKdmFyIGdldEdsb2JhbENvbmZpZyAgICAgICAgICAgICAgID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvdXRpbHMvZ2V0LWdsb2JhbC1jb25maWcnKVsnZGVmYXVsdCddOwp2YXIgbG9hZENvbmZpZyAgICAgICAgICAgICAgICAgICAgPSByZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC91dGlscy9sb2FkLWNvbmZpZycpWydkZWZhdWx0J107CnZhciBBcHBsaWNhdGlvblJvdXRlTWl4aW4gICAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL21peGlucy9hcHBsaWNhdGlvbi1yb3V0ZS1taXhpbicpWydkZWZhdWx0J107CnZhciBBdXRoZW50aWNhdGVkUm91dGVNaXhpbiAgICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL21peGlucy9hdXRoZW50aWNhdGVkLXJvdXRlLW1peGluJylbJ2RlZmF1bHQnXTsKdmFyIEF1dGhlbnRpY2F0aW9uQ29udHJvbGxlck1peGluID0gcmVxdWlyZU1vZHVsZSgnc2ltcGxlLWF1dGgvbWl4aW5zL2F1dGhlbnRpY2F0aW9uLWNvbnRyb2xsZXItbWl4aW4nKVsnZGVmYXVsdCddOwp2YXIgTG9naW5Db250cm9sbGVyTWl4aW4gICAgICAgICAgPSByZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC9taXhpbnMvbG9naW4tY29udHJvbGxlci1taXhpbicpWydkZWZhdWx0J107CnZhciBVbmF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluICAgICA9IHJlcXVpcmVNb2R1bGUoJ3NpbXBsZS1hdXRoL21peGlucy91bmF1dGhlbnRpY2F0ZWQtcm91dGUtbWl4aW4nKVsnZGVmYXVsdCddOwoKZ2xvYmFsLlNpbXBsZUF1dGggPSB7CiAgQ29uZmlndXJhdGlvbjogQ29uZmlndXJhdGlvbiwKCiAgU2Vzc2lvbjogU2Vzc2lvbiwKCiAgQXV0aGVudGljYXRvcnM6IHsKICAgIEJhc2U6IEJhc2VBdXRoZW50aWNhdG9yCiAgfSwKCiAgQXV0aG9yaXplcnM6IHsKICAgIEJhc2U6IEJhc2VBdXRob3JpemVyCiAgfSwKCiAgU3RvcmVzOiB7CiAgICBCYXNlOiAgICAgICAgIEJhc2VTdG9yZSwKICAgIExvY2FsU3RvcmFnZTogTG9jYWxTdG9yYWdlU3RvcmUsCiAgICBFcGhlbWVyYWw6ICAgIEVwaGVtZXJhbFN0b3JlCiAgfSwKCiAgVXRpbHM6IHsKICAgIG9iamVjdHNBcmVFcXVhbDogb2JqZWN0c0FyZUVxdWFsLAogICAgZ2V0R2xvYmFsQ29uZmlnOiBnZXRHbG9iYWxDb25maWcsCiAgICBsb2FkQ29uZmlnOiAgICAgIGxvYWRDb25maWcKICB9LAoKICBBcHBsaWNhdGlvblJvdXRlTWl4aW46ICAgICAgICAgQXBwbGljYXRpb25Sb3V0ZU1peGluLAogIEF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluOiAgICAgICBBdXRoZW50aWNhdGVkUm91dGVNaXhpbiwKICBBdXRoZW50aWNhdGlvbkNvbnRyb2xsZXJNaXhpbjogQXV0aGVudGljYXRpb25Db250cm9sbGVyTWl4aW4sCiAgTG9naW5Db250cm9sbGVyTWl4aW46ICAgICAgICAgIExvZ2luQ29udHJvbGxlck1peGluLAogIFVuYXV0aGVudGljYXRlZFJvdXRlTWl4aW46ICAgICBVbmF1dGhlbnRpY2F0ZWRSb3V0ZU1peGluCn07CgpyZXF1aXJlTW9kdWxlKCdzaW1wbGUtYXV0aC9lbWJlcicpOwp9KSgodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpID8gZ2xvYmFsIDogd2luZG93KTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 23:04:29 GMT",
                    "Content-Length": "62106",
                    "Date": "Thu, 06 Nov 2014 23:04:29 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}