{
    "url": "http://localhost:9999/jsxgraph/jsxgraph/examples/adg/watt.html",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.href</b> and written to <b>window.location.href</b> via the following statement:<ul><li>window.location.href=window.location.href.split('?')[0]</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/jsxgraph/jsxgraph/examples/adg/watt.html",
                "path": "/jsxgraph/jsxgraph/examples/adg/watt.html",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9qc3hncmFwaC9qc3hncmFwaC9leGFtcGxlcy9hZGcvd2F0dC5odG1sIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTAxOTkNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IHRleHQvaHRtbDsgY2hhcnNldD11dGYtOA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAwNzo1MTo0MCBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMDc6NTE6NDAgR01UDQoNCjxodG1sPgo8aGVhZD4KICAgPHRpdGxlPkxpbWEmY2NlZGlsO29uIHwgSlNYR3JhcGggRXhhbXBsZTwvdGl0bGU+CiAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIGhyZWY9Ii4uLy4uL2Rpc3RyaWIvanN4Z3JhcGguY3NzIiAvPgogICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSIuLi8uLi9zcmMvbG9hZGpzeGdyYXBoLmpzIj48L3NjcmlwdD4KPC9oZWFkPgo8Ym9keT4KPGRpdiBpZD0iZGVidWciIHN0eWxlPSJkaXNwbGF5OiBub25lIj48L2Rpdj4KPGNlbnRlcj4KPGRpdiBzdHlsZT0id2lkdGg6IDEwMDBweDsiPgogICAgPGRpdiBzdHlsZT0id2lkdGg6NTAwcHg7IGhlaWdodDogNTEwcHg7Ij4KICA8ZGl2IGlkPSJqeGdib3giIGNsYXNzPSJqeGdib3giIHN0eWxlPSJ3aWR0aDo1MDBweDsgaGVpZ2h0OjUwMHB4OyB0ZXh0LWFsaWduOiBsZWZ0OyBmbG9hdDogbGVmdDsiPjwvZGl2PgogIDxkaXYgaWQ9InBvbHlub21pYWxzIiBzdHlsZT0iZGlzcGxheTogbm9uZTsgd2lkdGg6IDUwMHB4OyBoZWlnaHQ6IDUwMHB4OyBtYXJnaW4tbGVmdDogMTBweDsgdGV4dC1hbGlnbjogbGVmdDsgcGFkZGluZy1sZWZ0OiAtMjAwcHg7Ij48L2Rpdj4KICA8L2Rpdj4KCiAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogODAwcHg7IG1hcmdpbi10b3A6IDEwcHg7Ij4KICA8Zm9ybT4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iY2hvb3NlQ29vcmRpbmF0ZVN5c3RlbSgpOyIgdmFsdWU9IkNob29zZSBjb29yZGluYXRlIHN5c3RlbSIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZ2VuZXJhdGVQb2x5bm9taWFscygpOyIgdmFsdWU9IkdlbmVyYXRlIHN5c3RlbSBvZiBwb2x5bm9taWFsIGVxdWF0aW9ucyIgLz4KICAgICAgPGJyIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImNhbGN1bGF0ZUxvY3VzKCk7IiB2YWx1ZT0iQ2FsY3VsYXRlIGxvY3VzIG9mIFQiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9InNob3dMb2N1c0VxdWF0aW9uKCk7IiB2YWx1ZT0iU2hvdyBsb2N1cyBlcXVhdGlvbiIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0ic2hvd0JvYXJkKCk7IiB2YWx1ZT0iU2hvdyBib2FyZCIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0ic2hvd0xvY3VzVGltZShsb2MpIiB2YWx1ZT0iU2hvdyBsb2N1cyB0aW1lIiAvPgogICAgICA8YnIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZXh0ZW5kKCk7IiB2YWx1ZT0iRXh0ZW5kIHRoZSBjb25zdHJ1Y3Rpb24gKHdpdGggZ2xpZGVyKSIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZXh0ZW5kZWRMb2N1cygpOyIgdmFsdWU9IkNhbGN1bGF0ZSBleHRlbmRlZCBsb2N1cyAoYmFzZWQgb24gZ2xpZGVyIEMpIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJzaG93TG9jdXNUaW1lKGxvYzIpIiB2YWx1ZT0iU2hvdyBsb2N1cyB0aW1lIiAvPgogICAgICA8YnIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZXh0ZW5kMigpOyIgdmFsdWU9IkV4dGVuZCB0aGUgY29uc3RydWN0aW9uIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJleHRlbmRlZExvY3VzMigpOyIgdmFsdWU9IkNhbGN1bGF0ZSBleHRlbmRlZCBsb2N1cyIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0ic2hvd0xvY3VzVGltZShsb2MzKSIgdmFsdWU9IlNob3cgbG9jdXMgdGltZSIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZ2VuZXJhdGVQb2x5bm9taWFsczIoKSIgdmFsdWU9IkVxdWF0aW9ucyAyIiAvPgogICAgICA8YnIgLz4KICAgICAgPGlucHV0IHR5cGU9InRleHQiIHZhbHVlPSIwLjIiIGlkPSJkaW0iIHNpemU9IjMiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRpbUNvbnN0cnVjdGlvbigpOyIgdmFsdWU9IkRpbSBjb25zdHJ1Y3Rpb24iIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRpbUxvY3VzKCk7IiB2YWx1ZT0iRGltIGxvY3VzIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkaW1FeHRlbnNpb24oKTsiIHZhbHVlPSJEaW0gZXh0ZW5zaW9uIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkaW1FeHRlbnNpb24yKCk7IiB2YWx1ZT0iRGltIGV4dGVuc2lvbiAyIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJkaW1Mb2N1czIoKTsiIHZhbHVlPSJEaW0gZXh0ZW5kZWQgbG9jaSIgLz4KICAgICAgPGJyIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9InJ1bkNvbXBhcmlzb24oKTsiIHZhbHVlPSJSdW4gY29tcGFyaXNvbiI+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5ocmVmPXdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCc/JylbMF0iIHZhbHVlPSJSZWxvYWQiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9InRvZ2dsZU9wdGltaXplKCk7IiBpZD0ib3B0IiB2YWx1ZT0iT3B0aW1pemF0aW9uIGlzIG9mZiI+CiAgPC9mb3JtPgogIDwvZGl2Pgo8L2Rpdj4KPC9jZW50ZXI+CiAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KICAgIC8qIDwhW0NEQVRBWyAqLwoKICAgIGJvYXJkID0gSlhHLkpTWEdyYXBoLmluaXRCb2FyZCgnanhnYm94Jywge2JvdW5kaW5nYm94OiBbLTEwLCAxMCwgMTAsIC0xMF0sIGF4aXM6IHRydWUsIGdyaWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXBhc3BlY3RyYXRpbzogdHJ1ZSwgc2hvd2NvcHlyaWdodDogZmFsc2V9KTsKCiAgICBBID0gYm9hcmQuY3JlYXRlRWxlbWVudCgncG9pbnQnLCBbMCwgMF0pOwogICAgQiA9IGJvYXJkLmNyZWF0ZUVsZW1lbnQoJ3BvaW50JywgWzgsIDBdKTsKICAgIGMxID0gYm9hcmQuY3JlYXRlRWxlbWVudCgnY2lyY2xlJywgW0EsIDRdKTsvLywge3N0cm9rZU9wYWNpdHk6IDAuM30pOwoKICAgIGMyID0gYm9hcmQuY3JlYXRlKCdjaXJjbGUnLCBbQiwgM10pOwogICAgRyA9IGJvYXJkLmNyZWF0ZSgnZ2xpZGVyJywgW2MxXSwge25hbWU6ICdHJ30pOwoKICAgIGMzID0gYm9hcmQuY3JlYXRlKCdjaXJjbGUnLCBbRywgNl0pOwogICAgRCA9IGJvYXJkLmNyZWF0ZSgnaW50ZXJzZWN0aW9uJywgW2MyLCBjM10sIHtuYW1lOiAnRCd9KTsKCiAgICBFID0gYm9hcmQuY3JlYXRlKCdtaWRwb2ludCcsIFtHLCBEXSwge25hbWU6ICdFJ30pOwoKCgogICAgbG9jID0gbnVsbDsKCiAgICB0Zz1udWxsOwogICAgdGM9bnVsbDsKICAgIHRpPW51bGw7CiAgICB0bT1udWxsOwogICAgbG9jMiA9IG51bGw7CgogICAgdGMyPW51bGw7CiAgICB0aTI9bnVsbDsKICAgIHRtMj1udWxsOwogICAgbG9jMyA9IG51bGw7CgogICAgb3B0ID0gZmFsc2U7CiAgICAKICAgIGZ1bmN0aW9uIGNob29zZUNvb3JkaW5hdGVTeXN0ZW0oKSB7CiAgICAgICAgdmFyIGssIG87CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanhnYm94Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgSlhHLk1hdGguU3ltYm9saWMuZ2VuZXJhdGVTeW1ib2xpY0Nvb3JkaW5hdGVzUGFydGlhbChib2FyZCwgRSwgJ3UnLCAnYnJhY2UnKTsKCiAgICAgICAgZm9yKGsgaW4gYm9hcmQub2JqZWN0cykgewogICAgICAgICAgICBvID0gYm9hcmQub2JqZWN0c1trXTsKICAgICAgICAgICAgaWYoby5lbGVtZW50Q2xhc3MgPT0gSlhHLk9CSkVDVF9DTEFTU19QT0lOVCAmJiBvLmxhYmVsKSB7CiAgICAgICAgICAgICAgICBvLmxhYmVsLnNldFRleHQoby5uYW1lICsgJyAoJyArIG8uc3ltYm9saWMueCArICcsICcgKyBvLnN5bWJvbGljLnkgKyAnKScpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBib2FyZC51cGRhdGUoKTsKICAgICAgICBKWEcuTWF0aC5TeW1ib2xpYy5jbGVhclN5bWJvbGljQ29vcmRpbmF0ZXMoYm9hcmQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlUG9seW5vbWlhbHMoKSB7CiAgICAgICAgdmFyIHJlcyA9IEpYRy5NYXRoLlN5bWJvbGljLmdlbmVyYXRlUG9seW5vbWlhbHMoYm9hcmQsIEUsIHRydWUpLAogICAgICAgICAgICBpLCBvdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKTsKCiAgICAgICAgb3V0LmlubmVySFRNTCA9ICc8dWw+JzsKICAgICAgICBmb3IoaT0wOyBpPHJlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgb3V0LmlubmVySFRNTCArPSAnPGxpPicgKyByZXNbaV0gKyAnID0gMDwvbGk+JzsKICAgICAgICBvdXQuaW5uZXJIVE1MICs9ICc8L3VsPic7CiAgICAgICAgb3V0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqeGdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUxvY3VzKCkgewogICAgICAgIGxvYyA9IGJvYXJkLmNyZWF0ZSgnbG9jdXMnLCBbRV0sIHtzdHJva2VDb2xvcjogJ2JsYWNrJywgc3Ryb2tlV2lkdGg6ICcycHgnfSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2hvd0xvY3VzRXF1YXRpb24oKSB7CiAgICAgICAgdmFyIG91dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpOwoKICAgICAgICBvdXQuaW5uZXJIVE1MID0gJzx1bD4nOwogICAgICAgIGZvcihpPTA7IGk8bG9jLmVxLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBvdXQuaW5uZXJIVE1MICs9ICc8bGk+JyArIGxvYy5lcVtpXSArICcgPSAwPC9saT4nOwogICAgICAgIG91dC5pbm5lckhUTUwgKz0gJzwvdWw+JzsKICAgICAgICBvdXQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9CgogICAgZnVuY3Rpb24gc2hvd0JvYXJkKCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpbUNvbnN0cnVjdGlvbigpIHsKICAgICAgICB2YXIgYyA9IFtwMywgcDQsIGMxLCBnLCBwNiwgYzIsIHAxNF8xXSwgaSwgbyA9IGdldERpbSgpOwoKICAgICAgICBpZihwMy52aXNQcm9wWydzdHJva2VPcGFjaXR5J10gPT0gbykKICAgICAgICAgICAgbyA9IDEuMDsKCiAgICAgICAgZm9yKGk9MDsgaTxjLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNbaV0uc2V0UHJvcGVydHkoe3N0cm9rZU9wYWNpdHk6IG8sIGZpbGxPcGFjaXR5OiBvfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRpbUxvY3VzKCkgewogICAgICAgIHZhciBvID0gZ2V0RGltKCk7CgogICAgICAgIGlmKGxvYyAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmKGxvYy52aXNQcm9wWydzdHJva2VPcGFjaXR5J10gPT0gbykKICAgICAgICAgICAgICAgIG8gPSAxLjA7CiAgICAgICAgICAgIGxvYy5zZXRQcm9wZXJ0eSh7c3Ryb2tlT3BhY2l0eTogb30pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkaW1Mb2N1czIoKSB7CiAgICAgICAgdmFyIG8gPSBnZXREaW0oKTsKCiAgICAgICAgaWYobG9jMiAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmKGxvYzIudmlzUHJvcFsnc3Ryb2tlT3BhY2l0eSddID09IG8pCiAgICAgICAgICAgICAgICBvID0gMS4wOwogICAgICAgICAgICBsb2MyLnNldFByb3BlcnR5KHtzdHJva2VPcGFjaXR5OiBvfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGV4dGVuZCgpIHsKICAgICAgICBpZihsb2M9PW51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgYm9hcmQuc3VzcGVuZFVwZGF0ZSgpOwogICAgICAgIHRnID0gYm9hcmQuY3JlYXRlKCdnbGlkZXInLCBbbG9jXSk7CgogICAgICAgIHRjID0gYm9hcmQuY3JlYXRlKCdjaXJjbGUnLCBbdGcsIDNdKTsKICAgICAgICB0aSA9IGJvYXJkLmNyZWF0ZSgnaW50ZXJzZWN0aW9uJywgW3RjLCBjMSwgMF0sIHtjb2xvcjogJ2JsdWUnfSk7CiAgICAgICAgdG0gPSBib2FyZC5jcmVhdGUoJ21pZHBvaW50JywgW3RnLCB0aV0sIHtjb2xvcjogJ2dyZWVuJ30pOwogICAgICAgIGJvYXJkLnVuc3VzcGVuZFVwZGF0ZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpbUV4dGVuc2lvbigpIHsKICAgICAgICBpZih0ZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIHZhciBjID0gW3RnLCB0YywgdGksIHRtXSwgaSwgbyA9IGdldERpbSgpOwoKICAgICAgICBpZih0Zy52aXNQcm9wWydzdHJva2VPcGFjaXR5J10gPT0gbykKICAgICAgICAgICAgbyA9IDEuMDsKCiAgICAgICAgZm9yKGk9MDsgaTxjLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNbaV0uc2V0UHJvcGVydHkoe3N0cm9rZU9wYWNpdHk6IG8sIGZpbGxPcGFjaXR5OiBvfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldERpbSgpIHsKICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGltJykudmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4dGVuZGVkTG9jdXMoKSB7CiAgICAgICAgbG9jMiA9IGJvYXJkLmNyZWF0ZSgnbG9jdXMnLCBbdG1dLCB7c3Ryb2tlQ29sb3I6ICdibGFjaycsIHN0cm9rZVdpZHRoOiAnNHB4J30pOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4dGVuZDIoKSB7CiAgICAgICAgYm9hcmQuc3VzcGVuZFVwZGF0ZSgpOwogICAgICAgIHRjMiA9IGJvYXJkLmNyZWF0ZSgnY2lyY2xlJywgW3AxNF8xLCAzXSk7CiAgICAgICAgdGkyID0gYm9hcmQuY3JlYXRlKCdpbnRlcnNlY3Rpb24nLCBbdGMyLCBjMSwgMF0sIHtjb2xvcjogJ2JsdWUnfSk7CiAgICAgICAgdG0yID0gYm9hcmQuY3JlYXRlKCdtaWRwb2ludCcsIFtwMTRfMSwgdGkyXSwge2NvbG9yOiAnZ3JlZW4nfSk7CiAgICAgICAgYm9hcmQudW5zdXNwZW5kVXBkYXRlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGltRXh0ZW5zaW9uMigpIHsKICAgICAgICBpZih0ZyA9PSBudWxsKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIHZhciBjID0gW3RjMiwgdGkyLCB0bTJdLCBpLCBvID0gZ2V0RGltKCk7CgogICAgICAgIGlmKHRjMi52aXNQcm9wWydzdHJva2VPcGFjaXR5J10gPT0gbykKICAgICAgICAgICAgbyA9IDEuMDsKCiAgICAgICAgZm9yKGk9MDsgaTxjLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNbaV0uc2V0UHJvcGVydHkoe3N0cm9rZU9wYWNpdHk6IG8sIGZpbGxPcGFjaXR5OiBvfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGV4dGVuZGVkTG9jdXMyKCkgewogICAgICAgIGxvYzMgPSBib2FyZC5jcmVhdGUoJ2xvY3VzJywgW3RtMl0sIHtzdHJva2VDb2xvcjogJ2dyZWVuJywgc3Ryb2tlV2lkdGg6ICcycHgnfSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2hvd0xvY3VzVGltZShsKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpLmlubmVySFRNTCA9IGwuY3RpbWU7CiAgICB9CgogICAgZnVuY3Rpb24gdG9nZ2xlT3B0aW1pemUoKSB7CiAgICAgICAgaWYob3B0KSB7CiAgICAgICAgICAgIGJvYXJkLm9wdGlvbnMubG9jdXMudHJhbnNsYXRlVG9PcmlnaW4gPSBmYWxzZTsKICAgICAgICAgICAgYm9hcmQub3B0aW9ucy5sb2N1cy50cmFuc2xhdGVUbzEwID0gZmFsc2U7CiAgICAgICAgICAgIG9wdCA9IGZhbHNlOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3B0JykudmFsdWUgPSAiT3B0aW1pemF0aW9uIGlzIG9mZiI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYm9hcmQub3B0aW9ucy5sb2N1cy50cmFuc2xhdGVUb09yaWdpbiA9IHRydWU7CiAgICAgICAgICAgIGJvYXJkLm9wdGlvbnMubG9jdXMudHJhbnNsYXRlVG8xMCA9IHRydWU7CiAgICAgICAgICAgIG9wdCA9IHRydWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcHQnKS52YWx1ZSA9ICJPcHRpbWl6YXRpb24gaXMgb24iOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVBvbHlub21pYWxzMigpIHsKICAgICAgICB2YXIgcmVzID0gSlhHLk1hdGguU3ltYm9saWMuZ2VuZXJhdGVQb2x5bm9taWFscyhib2FyZCwgdG0yLCB0cnVlKSwKICAgICAgICAgICAgaSwgb3V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJyk7CgogICAgICAgIG91dC5pbm5lckhUTUwgPSAnPHVsPic7CiAgICAgICAgZm9yKGk9MDsgaTxyZXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIG91dC5pbm5lckhUTUwgKz0gJzxsaT4nICsgcmVzW2ldICsgJyA9IDA8L2xpPic7CiAgICAgICAgb3V0LmlubmVySFRNTCArPSAnPC91bD4nOwogICAgICAgIG91dC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanhnYm94Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIH0KCiAgICBmdW5jdGlvbiBydW5Db21wYXJpc29uKCkgewogICAgICAgIGNhbGN1bGF0ZUxvY3VzKCk7CiAgICAgICAgZXh0ZW5kKCk7CiAgICAgICAgZXh0ZW5kZWRMb2N1cygpOwoKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmKyc/dGltZTA9Jytsb2MuY3RpbWUrJyZ0aW1lMT0nK2xvYzIuY3RpbWU7CiAgICB9CgogICAgZnVuY3Rpb24gcnVuQ29tcGFyaXNvbjIoKSB7CiAgICAgICAgZXh0ZW5kMigpOwogICAgICAgIGV4dGVuZGVkTG9jdXMyKCk7CgogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYrJyZ0aW1lMj0nK2xvYzMuY3RpbWU7CiAgICB9CgooZnVuY3Rpb24od2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7CiAgICB2YXIgciwgdGltZTAsIHRpbWUxLCB0aW1lMiwgaTsKICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJ3RpbWUxJyk+LTEpIHsKICAgICAgICByID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJz8nKVsxXS5zcGxpdCgnJicpOwogICAgICAgIGZvcihpPTA7IGk8ci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZihyW2ldLnNwbGl0KCc9JylbMF0gPT0gJ3RpbWUwJykKICAgICAgICAgICAgICAgIHRpbWUwID0gcltpXS5zcGxpdCgnPScpWzFdOwoKICAgICAgICAgICAgaWYocltpXS5zcGxpdCgnPScpWzBdID09ICd0aW1lMScpCiAgICAgICAgICAgICAgICB0aW1lMSA9IHJbaV0uc3BsaXQoJz0nKVsxXTsKCiAgICAgICAgICAgIGlmKHJbaV0uc3BsaXQoJz0nKVswXSA9PSAndGltZTInKQogICAgICAgICAgICAgICAgdGltZTIgPSByW2ldLnNwbGl0KCc9JylbMV07CiAgICAgICAgfQoKICAgICAgICBpZih0aW1lMSA9PT0gdW5kZWZpbmVkKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmKHRpbWUyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcnVuQ29tcGFyaXNvbjIoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpLmlubmVySFRNTCA9ICdjaGFpbmluZzogJyArIChwYXJzZUZsb2F0KHRpbWUxKStwYXJzZUZsb2F0KHRpbWUwKSkgKyAnPGJyIC8+ZGlyZWN0OiAnICsgdGltZTI7CiAgICB9Cn0pKHdpbmRvdywgZG9jdW1lbnQpOwoKICAgIAogIC8qIF1dPiAqLwogIDwvc2NyaXB0Pgo8YnIvPgo8L2JvZHk+CjwvaHRtbD4K",
                "body": "PGh0bWw+CjxoZWFkPgogICA8dGl0bGU+TGltYSZjY2VkaWw7b24gfCBKU1hHcmFwaCBFeGFtcGxlPC90aXRsZT4KICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgaHJlZj0iLi4vLi4vZGlzdHJpYi9qc3hncmFwaC5jc3MiIC8+CiAgIDxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0IiBzcmM9Ii4uLy4uL3NyYy9sb2FkanN4Z3JhcGguanMiPjwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJkZWJ1ZyIgc3R5bGU9ImRpc3BsYXk6IG5vbmUiPjwvZGl2Pgo8Y2VudGVyPgo8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwMHB4OyI+CiAgICA8ZGl2IHN0eWxlPSJ3aWR0aDo1MDBweDsgaGVpZ2h0OiA1MTBweDsiPgogIDxkaXYgaWQ9Imp4Z2JveCIgY2xhc3M9Imp4Z2JveCIgc3R5bGU9IndpZHRoOjUwMHB4OyBoZWlnaHQ6NTAwcHg7IHRleHQtYWxpZ246IGxlZnQ7IGZsb2F0OiBsZWZ0OyI+PC9kaXY+CiAgPGRpdiBpZD0icG9seW5vbWlhbHMiIHN0eWxlPSJkaXNwbGF5OiBub25lOyB3aWR0aDogNTAwcHg7IGhlaWdodDogNTAwcHg7IG1hcmdpbi1sZWZ0OiAxMHB4OyB0ZXh0LWFsaWduOiBsZWZ0OyBwYWRkaW5nLWxlZnQ6IC0yMDBweDsiPjwvZGl2PgogIDwvZGl2PgoKICAgIDxkaXYgc3R5bGU9IndpZHRoOiA4MDBweDsgbWFyZ2luLXRvcDogMTBweDsiPgogIDxmb3JtPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJjaG9vc2VDb29yZGluYXRlU3lzdGVtKCk7IiB2YWx1ZT0iQ2hvb3NlIGNvb3JkaW5hdGUgc3lzdGVtIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJnZW5lcmF0ZVBvbHlub21pYWxzKCk7IiB2YWx1ZT0iR2VuZXJhdGUgc3lzdGVtIG9mIHBvbHlub21pYWwgZXF1YXRpb25zIiAvPgogICAgICA8YnIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iY2FsY3VsYXRlTG9jdXMoKTsiIHZhbHVlPSJDYWxjdWxhdGUgbG9jdXMgb2YgVCIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0ic2hvd0xvY3VzRXF1YXRpb24oKTsiIHZhbHVlPSJTaG93IGxvY3VzIGVxdWF0aW9uIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJzaG93Qm9hcmQoKTsiIHZhbHVlPSJTaG93IGJvYXJkIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJzaG93TG9jdXNUaW1lKGxvYykiIHZhbHVlPSJTaG93IGxvY3VzIHRpbWUiIC8+CiAgICAgIDxiciAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJleHRlbmQoKTsiIHZhbHVlPSJFeHRlbmQgdGhlIGNvbnN0cnVjdGlvbiAod2l0aCBnbGlkZXIpIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJleHRlbmRlZExvY3VzKCk7IiB2YWx1ZT0iQ2FsY3VsYXRlIGV4dGVuZGVkIGxvY3VzIChiYXNlZCBvbiBnbGlkZXIgQykiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9InNob3dMb2N1c1RpbWUobG9jMikiIHZhbHVlPSJTaG93IGxvY3VzIHRpbWUiIC8+CiAgICAgIDxiciAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJleHRlbmQyKCk7IiB2YWx1ZT0iRXh0ZW5kIHRoZSBjb25zdHJ1Y3Rpb24iIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImV4dGVuZGVkTG9jdXMyKCk7IiB2YWx1ZT0iQ2FsY3VsYXRlIGV4dGVuZGVkIGxvY3VzIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJzaG93TG9jdXNUaW1lKGxvYzMpIiB2YWx1ZT0iU2hvdyBsb2N1cyB0aW1lIiAvPgogICAgICA8aW5wdXQgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJnZW5lcmF0ZVBvbHlub21pYWxzMigpIiB2YWx1ZT0iRXF1YXRpb25zIDIiIC8+CiAgICAgIDxiciAvPgogICAgICA8aW5wdXQgdHlwZT0idGV4dCIgdmFsdWU9IjAuMiIgaWQ9ImRpbSIgc2l6ZT0iMyIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZGltQ29uc3RydWN0aW9uKCk7IiB2YWx1ZT0iRGltIGNvbnN0cnVjdGlvbiIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0iZGltTG9jdXMoKTsiIHZhbHVlPSJEaW0gbG9jdXMiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRpbUV4dGVuc2lvbigpOyIgdmFsdWU9IkRpbSBleHRlbnNpb24iIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRpbUV4dGVuc2lvbjIoKTsiIHZhbHVlPSJEaW0gZXh0ZW5zaW9uIDIiIC8+CiAgICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImRpbUxvY3VzMigpOyIgdmFsdWU9IkRpbSBleHRlbmRlZCBsb2NpIiAvPgogICAgICA8YnIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icnVuQ29tcGFyaXNvbigpOyIgdmFsdWU9IlJ1biBjb21wYXJpc29uIj4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLmhyZWY9d2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJz8nKVswXSIgdmFsdWU9IlJlbG9hZCIgLz4KICAgICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgb25jbGljaz0idG9nZ2xlT3B0aW1pemUoKTsiIGlkPSJvcHQiIHZhbHVlPSJPcHRpbWl6YXRpb24gaXMgb2ZmIj4KICA8L2Zvcm0+CiAgPC9kaXY+CjwvZGl2Pgo8L2NlbnRlcj4KICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgogICAgLyogPCFbQ0RBVEFbICovCgogICAgYm9hcmQgPSBKWEcuSlNYR3JhcGguaW5pdEJvYXJkKCdqeGdib3gnLCB7Ym91bmRpbmdib3g6IFstMTAsIDEwLCAxMCwgLTEwXSwgYXhpczogdHJ1ZSwgZ3JpZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2VlcGFzcGVjdHJhdGlvOiB0cnVlLCBzaG93Y29weXJpZ2h0OiBmYWxzZX0pOwoKICAgIEEgPSBib2FyZC5jcmVhdGVFbGVtZW50KCdwb2ludCcsIFswLCAwXSk7CiAgICBCID0gYm9hcmQuY3JlYXRlRWxlbWVudCgncG9pbnQnLCBbOCwgMF0pOwogICAgYzEgPSBib2FyZC5jcmVhdGVFbGVtZW50KCdjaXJjbGUnLCBbQSwgNF0pOy8vLCB7c3Ryb2tlT3BhY2l0eTogMC4zfSk7CgogICAgYzIgPSBib2FyZC5jcmVhdGUoJ2NpcmNsZScsIFtCLCAzXSk7CiAgICBHID0gYm9hcmQuY3JlYXRlKCdnbGlkZXInLCBbYzFdLCB7bmFtZTogJ0cnfSk7CgogICAgYzMgPSBib2FyZC5jcmVhdGUoJ2NpcmNsZScsIFtHLCA2XSk7CiAgICBEID0gYm9hcmQuY3JlYXRlKCdpbnRlcnNlY3Rpb24nLCBbYzIsIGMzXSwge25hbWU6ICdEJ30pOwoKICAgIEUgPSBib2FyZC5jcmVhdGUoJ21pZHBvaW50JywgW0csIERdLCB7bmFtZTogJ0UnfSk7CgoKCiAgICBsb2MgPSBudWxsOwoKICAgIHRnPW51bGw7CiAgICB0Yz1udWxsOwogICAgdGk9bnVsbDsKICAgIHRtPW51bGw7CiAgICBsb2MyID0gbnVsbDsKCiAgICB0YzI9bnVsbDsKICAgIHRpMj1udWxsOwogICAgdG0yPW51bGw7CiAgICBsb2MzID0gbnVsbDsKCiAgICBvcHQgPSBmYWxzZTsKICAgIAogICAgZnVuY3Rpb24gY2hvb3NlQ29vcmRpbmF0ZVN5c3RlbSgpIHsKICAgICAgICB2YXIgaywgbzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqeGdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBKWEcuTWF0aC5TeW1ib2xpYy5nZW5lcmF0ZVN5bWJvbGljQ29vcmRpbmF0ZXNQYXJ0aWFsKGJvYXJkLCBFLCAndScsICdicmFjZScpOwoKICAgICAgICBmb3IoayBpbiBib2FyZC5vYmplY3RzKSB7CiAgICAgICAgICAgIG8gPSBib2FyZC5vYmplY3RzW2tdOwogICAgICAgICAgICBpZihvLmVsZW1lbnRDbGFzcyA9PSBKWEcuT0JKRUNUX0NMQVNTX1BPSU5UICYmIG8ubGFiZWwpIHsKICAgICAgICAgICAgICAgIG8ubGFiZWwuc2V0VGV4dChvLm5hbWUgKyAnICgnICsgby5zeW1ib2xpYy54ICsgJywgJyArIG8uc3ltYm9saWMueSArICcpJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGJvYXJkLnVwZGF0ZSgpOwogICAgICAgIEpYRy5NYXRoLlN5bWJvbGljLmNsZWFyU3ltYm9saWNDb29yZGluYXRlcyhib2FyZCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2VuZXJhdGVQb2x5bm9taWFscygpIHsKICAgICAgICB2YXIgcmVzID0gSlhHLk1hdGguU3ltYm9saWMuZ2VuZXJhdGVQb2x5bm9taWFscyhib2FyZCwgRSwgdHJ1ZSksCiAgICAgICAgICAgIGksIG91dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb2x5bm9taWFscycpOwoKICAgICAgICBvdXQuaW5uZXJIVE1MID0gJzx1bD4nOwogICAgICAgIGZvcihpPTA7IGk8cmVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBvdXQuaW5uZXJIVE1MICs9ICc8bGk+JyArIHJlc1tpXSArICcgPSAwPC9saT4nOwogICAgICAgIG91dC5pbm5lckhUTUwgKz0gJzwvdWw+JzsKICAgICAgICBvdXQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p4Z2JveCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY3VsYXRlTG9jdXMoKSB7CiAgICAgICAgbG9jID0gYm9hcmQuY3JlYXRlKCdsb2N1cycsIFtFXSwge3N0cm9rZUNvbG9yOiAnYmxhY2snLCBzdHJva2VXaWR0aDogJzJweCd9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzaG93TG9jdXNFcXVhdGlvbigpIHsKICAgICAgICB2YXIgb3V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJyk7CgogICAgICAgIG91dC5pbm5lckhUTUwgPSAnPHVsPic7CiAgICAgICAgZm9yKGk9MDsgaTxsb2MuZXEubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIG91dC5pbm5lckhUTUwgKz0gJzxsaT4nICsgbG9jLmVxW2ldICsgJyA9IDA8L2xpPic7CiAgICAgICAgb3V0LmlubmVySFRNTCArPSAnPC91bD4nOwogICAgICAgIG91dC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanhnYm94Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIH0KCiAgICBmdW5jdGlvbiBzaG93Qm9hcmQoKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanhnYm94Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICB9CgogICAgZnVuY3Rpb24gZGltQ29uc3RydWN0aW9uKCkgewogICAgICAgIHZhciBjID0gW3AzLCBwNCwgYzEsIGcsIHA2LCBjMiwgcDE0XzFdLCBpLCBvID0gZ2V0RGltKCk7CgogICAgICAgIGlmKHAzLnZpc1Byb3BbJ3N0cm9rZU9wYWNpdHknXSA9PSBvKQogICAgICAgICAgICBvID0gMS4wOwoKICAgICAgICBmb3IoaT0wOyBpPGMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY1tpXS5zZXRQcm9wZXJ0eSh7c3Ryb2tlT3BhY2l0eTogbywgZmlsbE9wYWNpdHk6IG99KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZGltTG9jdXMoKSB7CiAgICAgICAgdmFyIG8gPSBnZXREaW0oKTsKCiAgICAgICAgaWYobG9jICE9IG51bGwpIHsKICAgICAgICAgICAgaWYobG9jLnZpc1Byb3BbJ3N0cm9rZU9wYWNpdHknXSA9PSBvKQogICAgICAgICAgICAgICAgbyA9IDEuMDsKICAgICAgICAgICAgbG9jLnNldFByb3BlcnR5KHtzdHJva2VPcGFjaXR5OiBvfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRpbUxvY3VzMigpIHsKICAgICAgICB2YXIgbyA9IGdldERpbSgpOwoKICAgICAgICBpZihsb2MyICE9IG51bGwpIHsKICAgICAgICAgICAgaWYobG9jMi52aXNQcm9wWydzdHJva2VPcGFjaXR5J10gPT0gbykKICAgICAgICAgICAgICAgIG8gPSAxLjA7CiAgICAgICAgICAgIGxvYzIuc2V0UHJvcGVydHkoe3N0cm9rZU9wYWNpdHk6IG99KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZXh0ZW5kKCkgewogICAgICAgIGlmKGxvYz09bnVsbCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICBib2FyZC5zdXNwZW5kVXBkYXRlKCk7CiAgICAgICAgdGcgPSBib2FyZC5jcmVhdGUoJ2dsaWRlcicsIFtsb2NdKTsKCiAgICAgICAgdGMgPSBib2FyZC5jcmVhdGUoJ2NpcmNsZScsIFt0ZywgM10pOwogICAgICAgIHRpID0gYm9hcmQuY3JlYXRlKCdpbnRlcnNlY3Rpb24nLCBbdGMsIGMxLCAwXSwge2NvbG9yOiAnYmx1ZSd9KTsKICAgICAgICB0bSA9IGJvYXJkLmNyZWF0ZSgnbWlkcG9pbnQnLCBbdGcsIHRpXSwge2NvbG9yOiAnZ3JlZW4nfSk7CiAgICAgICAgYm9hcmQudW5zdXNwZW5kVXBkYXRlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGltRXh0ZW5zaW9uKCkgewogICAgICAgIGlmKHRnID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgdmFyIGMgPSBbdGcsIHRjLCB0aSwgdG1dLCBpLCBvID0gZ2V0RGltKCk7CgogICAgICAgIGlmKHRnLnZpc1Byb3BbJ3N0cm9rZU9wYWNpdHknXSA9PSBvKQogICAgICAgICAgICBvID0gMS4wOwoKICAgICAgICBmb3IoaT0wOyBpPGMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY1tpXS5zZXRQcm9wZXJ0eSh7c3Ryb2tlT3BhY2l0eTogbywgZmlsbE9wYWNpdHk6IG99KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGltKCkgewogICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaW0nKS52YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZXh0ZW5kZWRMb2N1cygpIHsKICAgICAgICBsb2MyID0gYm9hcmQuY3JlYXRlKCdsb2N1cycsIFt0bV0sIHtzdHJva2VDb2xvcjogJ2JsYWNrJywgc3Ryb2tlV2lkdGg6ICc0cHgnfSk7CiAgICB9CgogICAgZnVuY3Rpb24gZXh0ZW5kMigpIHsKICAgICAgICBib2FyZC5zdXNwZW5kVXBkYXRlKCk7CiAgICAgICAgdGMyID0gYm9hcmQuY3JlYXRlKCdjaXJjbGUnLCBbcDE0XzEsIDNdKTsKICAgICAgICB0aTIgPSBib2FyZC5jcmVhdGUoJ2ludGVyc2VjdGlvbicsIFt0YzIsIGMxLCAwXSwge2NvbG9yOiAnYmx1ZSd9KTsKICAgICAgICB0bTIgPSBib2FyZC5jcmVhdGUoJ21pZHBvaW50JywgW3AxNF8xLCB0aTJdLCB7Y29sb3I6ICdncmVlbid9KTsKICAgICAgICBib2FyZC51bnN1c3BlbmRVcGRhdGUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaW1FeHRlbnNpb24yKCkgewogICAgICAgIGlmKHRnID09IG51bGwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgdmFyIGMgPSBbdGMyLCB0aTIsIHRtMl0sIGksIG8gPSBnZXREaW0oKTsKCiAgICAgICAgaWYodGMyLnZpc1Byb3BbJ3N0cm9rZU9wYWNpdHknXSA9PSBvKQogICAgICAgICAgICBvID0gMS4wOwoKICAgICAgICBmb3IoaT0wOyBpPGMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY1tpXS5zZXRQcm9wZXJ0eSh7c3Ryb2tlT3BhY2l0eTogbywgZmlsbE9wYWNpdHk6IG99KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZXh0ZW5kZWRMb2N1czIoKSB7CiAgICAgICAgbG9jMyA9IGJvYXJkLmNyZWF0ZSgnbG9jdXMnLCBbdG0yXSwge3N0cm9rZUNvbG9yOiAnZ3JlZW4nLCBzdHJva2VXaWR0aDogJzJweCd9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzaG93TG9jdXNUaW1lKGwpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanhnYm94Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJykuaW5uZXJIVE1MID0gbC5jdGltZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b2dnbGVPcHRpbWl6ZSgpIHsKICAgICAgICBpZihvcHQpIHsKICAgICAgICAgICAgYm9hcmQub3B0aW9ucy5sb2N1cy50cmFuc2xhdGVUb09yaWdpbiA9IGZhbHNlOwogICAgICAgICAgICBib2FyZC5vcHRpb25zLmxvY3VzLnRyYW5zbGF0ZVRvMTAgPSBmYWxzZTsKICAgICAgICAgICAgb3B0ID0gZmFsc2U7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcHQnKS52YWx1ZSA9ICJPcHRpbWl6YXRpb24gaXMgb2ZmIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBib2FyZC5vcHRpb25zLmxvY3VzLnRyYW5zbGF0ZVRvT3JpZ2luID0gdHJ1ZTsKICAgICAgICAgICAgYm9hcmQub3B0aW9ucy5sb2N1cy50cmFuc2xhdGVUbzEwID0gdHJ1ZTsKICAgICAgICAgICAgb3B0ID0gdHJ1ZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wdCcpLnZhbHVlID0gIk9wdGltaXphdGlvbiBpcyBvbiI7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlUG9seW5vbWlhbHMyKCkgewogICAgICAgIHZhciByZXMgPSBKWEcuTWF0aC5TeW1ib2xpYy5nZW5lcmF0ZVBvbHlub21pYWxzKGJvYXJkLCB0bTIsIHRydWUpLAogICAgICAgICAgICBpLCBvdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKTsKCiAgICAgICAgb3V0LmlubmVySFRNTCA9ICc8dWw+JzsKICAgICAgICBmb3IoaT0wOyBpPHJlcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgb3V0LmlubmVySFRNTCArPSAnPGxpPicgKyByZXNbaV0gKyAnID0gMDwvbGk+JzsKICAgICAgICBvdXQuaW5uZXJIVE1MICs9ICc8L3VsPic7CiAgICAgICAgb3V0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqeGdib3gnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfQoKICAgIGZ1bmN0aW9uIHJ1bkNvbXBhcmlzb24oKSB7CiAgICAgICAgY2FsY3VsYXRlTG9jdXMoKTsKICAgICAgICBleHRlbmQoKTsKICAgICAgICBleHRlbmRlZExvY3VzKCk7CgogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYrJz90aW1lMD0nK2xvYy5jdGltZSsnJnRpbWUxPScrbG9jMi5jdGltZTsKICAgIH0KCiAgICBmdW5jdGlvbiBydW5Db21wYXJpc29uMigpIHsKICAgICAgICBleHRlbmQyKCk7CiAgICAgICAgZXh0ZW5kZWRMb2N1czIoKTsKCiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZisnJnRpbWUyPScrbG9jMy5jdGltZTsKICAgIH0KCihmdW5jdGlvbih3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsKICAgIHZhciByLCB0aW1lMCwgdGltZTEsIHRpbWUyLCBpOwogICAgaWYod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZigndGltZTEnKT4tMSkgewogICAgICAgIHIgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnPycpWzFdLnNwbGl0KCcmJyk7CiAgICAgICAgZm9yKGk9MDsgaTxyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmKHJbaV0uc3BsaXQoJz0nKVswXSA9PSAndGltZTAnKQogICAgICAgICAgICAgICAgdGltZTAgPSByW2ldLnNwbGl0KCc9JylbMV07CgogICAgICAgICAgICBpZihyW2ldLnNwbGl0KCc9JylbMF0gPT0gJ3RpbWUxJykKICAgICAgICAgICAgICAgIHRpbWUxID0gcltpXS5zcGxpdCgnPScpWzFdOwoKICAgICAgICAgICAgaWYocltpXS5zcGxpdCgnPScpWzBdID09ICd0aW1lMicpCiAgICAgICAgICAgICAgICB0aW1lMiA9IHJbaV0uc3BsaXQoJz0nKVsxXTsKICAgICAgICB9CgogICAgICAgIGlmKHRpbWUxID09PSB1bmRlZmluZWQpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYodGltZTIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBydW5Db21wYXJpc29uMigpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9seW5vbWlhbHMnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanhnYm94Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvbHlub21pYWxzJykuaW5uZXJIVE1MID0gJ2NoYWluaW5nOiAnICsgKHBhcnNlRmxvYXQodGltZTEpK3BhcnNlRmxvYXQodGltZTApKSArICc8YnIgLz5kaXJlY3Q6ICcgKyB0aW1lMjsKICAgIH0KfSkod2luZG93LCBkb2N1bWVudCk7CgogICAgCiAgLyogXV0+ICovCiAgPC9zY3JpcHQ+Cjxici8+CjwvYm9keT4KPC9odG1sPgo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 07:51:40 GMT",
                    "Content-Length": "10199",
                    "Date": "Fri, 07 Nov 2014 07:51:40 GMT",
                    "Content-Type": "text/html; charset=utf-8"
                },
                "cookies": [],
                "mimeType": "HTML",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}