{
    "url": "http://localhost:9999/MrSwitch/hello.js/demos/skydrive_upload.html",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "HTML5 storage manipulation (DOM-based)",
    "issueType": 5246720,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based HTML5 storage manipulation occurs when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and stores this data in the HTML5 storage of the web browser (either localStorage or sessionStorage). An attacker may be able to use this behavior to construct a URL which, if visited by another application user, will cause the user's browser to store attacker-controllable data.<br><br>This behavior does not in itself constitute a security vulnerability. However, if the application later reads the data back from storage and processes it in an unsafe way, then an attacker may be able to leverage the storage mechanism to deliver other DOM-based attacks, such as cross-site scripting and JavaScript injection.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>You should also review the ways in which the wider application uses data that is retrieved from HTML5 storage. If the data is never handled in an unsafe manner, then this behavior may not constitute any kind of vulnerability.<br><br>The most effective way to avoid DOM-based HTML5 storage manipulation is not to place in HTML5 storage any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored.",
    "issueDetail": "The application may be vulnerable to DOM-based HTML5 storage manipulation. Data is read from <b>window.location.search</b> and written to <b>localStorage.setItem()</b> via the following statements:<ul><li>var access_token = (window.location.hash||window.location.search).match(/access_token=([^&amp;]+)/);</li><li>localStorage.setItem(\"access_token\", decodeURIComponent(access_token[1]));</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/MrSwitch/hello.js/demos/skydrive_upload.html",
                "path": "/MrSwitch/hello.js/demos/skydrive_upload.html",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9NclN3aXRjaC9oZWxsby5qcy9kZW1vcy9za3lkcml2ZV91cGxvYWQuaHRtbCBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTU2ODENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IHRleHQvaHRtbDsgY2hhcnNldD11dGYtOA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAwMzowODoxNyBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMDM6MDg6MTcgR01UDQoNCjwhRE9DVFlQRSBodG1sPgo8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Ii9hZG9ybi9hZG9ybi5jc3MiLz4KPHNjcmlwdCBzcmM9Ii9hZG9ybi9hZG9ybi5qcyIgYXN5bmM+PC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJjbGllbnRfaWRzLmpzIj48L3NjcmlwdD4KCjx0aXRsZT5TaW1wbGUgU2t5RHJpdmUgRGVtbzwvdGl0bGU+CjxzdHlsZT4KaW1newoJcG9zaXRpb246IGZpeGVkOwoJdG9wOjA7CglsZWZ0OjUwJTsKCXdpZHRoOjIwMHB4OwoJYm9yZGVyOjFweCBzb2xpZCAjY2NjOwoJcGFkZGluZzoxMHB4Owp9CmltZzpudGgtY2hpbGQoMm4pewoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDEwZGVnKTsKCS1tb3otdHJhbnNmb3JtOnJvdGF0ZSgxMGRlZyk7CgktbXMtdHJhbnNmb3JtOnJvdGF0ZSgxMGRlZyk7Cgl0cmFuc2Zvcm06cm90YXRlKDEwZGVnKTsKfQppbWc6bnRoLWNoaWxkKDNuKXsKCS13ZWJraXQtdHJhbnNmb3JtOnJvdGF0ZSgtMTBkZWcpOwoJLW1vei10cmFuc2Zvcm06cm90YXRlKC0xMGRlZyk7CgktbXMtdHJhbnNmb3JtOnJvdGF0ZSgtMTBkZWcpOwoJdHJhbnNmb3JtOnJvdGF0ZSgtMTBkZWcpOwp9Cjwvc3R5bGU+CjxoMT5TaW1wbGUgU2t5ZHJpdmUgZGVtbzwvaDE+CjxibG9ja3F1b3RlPgoJPHA+VGhpcyBkZW1vIHVzZXMgT0F1dGgyIGFuZCBDT1JTIChvciBKU09OUCkgdG8gbWFrZSBzb21lIFJFU1QgY2FsbHMgd2hpY2ggbmF2aWdhdGUgdGhlIFdpbmRvd3MgTGl2ZSBHcmFwaCBBUEkgdG8gZ2V0IHNvbWUgcGhvdG9zIG91dCBvZiBTa3lkcml2ZS4gSXQgaXMgUExVR0lOLUZSRUUhPC9wPgo8cD5JZiBydW5uaW5nIGxvY2FsbHksIDxhIGhyZWY9Imh0dHA6Ly9tYW5hZ2UuZGV2LmxpdmUuY29tLyI+cmVnaXN0ZXIgeW91ciBkZXZlbG9wbWVudCBkb21haW48L2E+IGFuZCByZXBsYWNlIFdJTkRPV1NfQ0xJRU5UX0lEIChiZWxvdykgd2l0aCB0aGUgY2xpZW50X2lkIHlvdSBhcmUgYXNzaWduZWQ8L3A+CjwvYmxvY2txdW90ZT4KCgk8cD5TdGFydCBieSBsb2dnaW5nIGluIAk8YnV0dG9uIG9uY2xpY2s9ImxvZ2luKCkiPkxvZ2luPC9idXR0b24+PC9wPgoKPGJsb2NrcXVvdGU+Cgk8Yj4xLiBDcmVhdGUgYW4gQWxidW08L2I+Cgk8Zm9ybT4KCQk8bGFiZWw+QWxidW0gbmFtZSA8L2xhYmVsPgoJCTxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ibmV3X25hbWUiIG5hbWU9Im5hbWUiIHZhbHVlPSJOZXcgQWxidW0gTmFtZSIvPgoJCTxiciAvPgoJCTxsYWJlbD5BbGJ1bSBkZXNjcmlwdGlvbiA8L2xhYmVsPgoJCTx0ZXh0YXJlYSBpZD0ibmV3X2Rlc2NyaXB0aW9uIiBuYW1lPSJkZXNjcmlwdGlvbiI+VGhpcyBpcyBhIHRlc3QgYWxidW08L3RleHRhcmVhPgoJCTxidXR0b24gdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJjcmVhdGVBbGJ1bSh0aGlzLmZvcm0pIj5VcGxvYWQ8L2J1dHRvbj4KCTwvZm9ybT4KCTxiPjIuIFNlbGVjdCBhIGZpbGU8L2I+Cgk8Zm9ybT4KCQk8aW5wdXQgdHlwZT0iZmlsZSIgbmFtZT0iZmlsZSIgaWQ9ImZpbGUiLz4KCTwvZm9ybT4KPC9icj4KCTxiPnBpY2sgYW4gYWxidW0gYXMgdGhlIGRlc3RpbmF0aW9uPC9iPgoJPHNlbGVjdCBpZD0ic2VsZWN0Ij48L3NlbGVjdD4KPC9icj4KCTxidXR0b24gb25jbGljaz0icG9zdFBob3RvKCBzZWxlY3QudmFsdWUsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlJykuZm9ybSApIj5VcGxvYWQ8L2J1dHRvbj4KCTxidXR0b24gb25jbGljaz0ieGhyVXBsb2FkKCBzZWxlY3QudmFsdWUsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlJykuZmlsZXNbMF0gKSI+VXBsb2FkIFhIUjwvYnV0dG9uPgoJPGRpdiBpZD0icmVzdWx0Ij48L2Rpdj4KPC9ibG9ja3F1b3RlPgoKPHNjcmlwdD4KZnVuY3Rpb24gbG9naW4oKXsKCXdpbmRvdy5sb2NhdGlvbiA9ICdodHRwczovL29hdXRoLmxpdmUuY29tL2F1dGhvcml6ZScrIAoJCSc/Y2xpZW50X2lkPScrV0lORE9XU19DTElFTlRfSUQrCgkJJyZzY29wZT13bC5za3lkcml2ZV91cGRhdGUnKwoJCScmcmVzcG9uc2VfdHlwZT10b2tlbicrCgkJJyZyZWRpcmVjdF91cmk9JytlbmNvZGVVUklDb21wb25lbnQod2luZG93LmxvY2F0aW9uLmhyZWYpOwp9CgoKdmFyIGFjY2Vzc190b2tlbiA9ICh3aW5kb3cubG9jYXRpb24uaGFzaHx8d2luZG93LmxvY2F0aW9uLnNlYXJjaCkubWF0Y2goL2FjY2Vzc190b2tlbj0oW14mXSspLyk7IAppZihhY2Nlc3NfdG9rZW4peyAKCS8vIFNhdmUgdGhlIGZpcnN0IG1hdGNoCglsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiYWNjZXNzX3Rva2VuIiwgZGVjb2RlVVJJQ29tcG9uZW50KGFjY2Vzc190b2tlblsxXSkpOwp9Cgp2YXIganNvbl9jb3VudGVyPTA7CmZ1bmN0aW9uIGpzb25wKHBhdGgsY2FsbGJhY2spewoJLy8gTWFrZSB0aGUgYW5vbnltb3VzIGZ1bmN0aW9uLiBub3QgYW5vbnltb3VzCgl2YXIgY2FsbGJhY2tfbmFtZSA9ICdqc29ucF8nICsganNvbl9jb3VudGVyKys7Cgl3aW5kb3dbY2FsbGJhY2tfbmFtZV0gPSBjYWxsYmFjazsKCS8vIEFkZCB0aGUgY2FsbGJhY2sgbmFtZSB0byB0aGUgcGF0aAoJcGF0aCA9IHBhdGgucmVwbGFjZSgvXD1cPy8sICc9JytjYWxsYmFja19uYW1lKTsKCS8vIGZpbmQgYSBwbGFjZSB0byBpbnNlcnQgdGhlIHNjcmlwdCB0YWcKCXZhciBzaWJsaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOwoJLy8gQ3JlYXRlIHRoZSBzY3JpcHQgdGFnCgl2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CglzY3JpcHQuc3JjID0gcGF0aDsKCXNpYmxpbmcucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2NyaXB0LHNpYmxpbmcpOwp9CgoKCi8vCi8vIFBhcmFtCi8vIEV4cGxvZGUvRW5jb2RlIHRoZSBwYXJhbWV0ZXJzIG9mIGFuIFVSTCBzdHJpbmcvb2JqZWN0Ci8vIEBwYXJhbSBzdHJpbmcgcywgU3RyaW5nIHRvIGRlY29kZQovLwpmdW5jdGlvbiBfcGFyYW0ocyl7Cgl2YXIgYiwKCQlhID0ge30sCgkJbTsKCQoJaWYodHlwZW9mKHMpPT09J3N0cmluZycpewoKCQltID0gcy5yZXBsYWNlKC9eW1wjXD9dLywnJykubWF0Y2goLyhbXj1cL1wmXSspPShbXlwmXSspL2cpOwoJCWlmKG0pewoJCQlmb3IodmFyIGk9MDtpPG0ubGVuZ3RoO2krKyl7CgkJCQliID0gbVtpXS5zcGxpdCgnPScpOwoJCQkJYVtiWzBdXSA9IGRlY29kZVVSSUNvbXBvbmVudCggYlsxXSApOwoJCQl9CgkJfQoJCXJldHVybiBhOwoJfQoJZWxzZSB7CgkJdmFyIG8gPSBzOwoJCgkJYSA9IFtdOwoKCQlmb3IoIHZhciB4IGluIG8gKXtpZihvLmhhc093blByb3BlcnR5KHgpKXsKCQkJaWYoIG8uaGFzT3duUHJvcGVydHkoeCkgKXsKCQkJCWEucHVzaCggW3gsIG9beF0gPT09ICc/JyA/ICc/JyA6IGVuY29kZVVSSUNvbXBvbmVudChvW3hdKSBdLmpvaW4oJz0nKSApOwoJCQl9CgkJfX0KCgkJcmV0dXJuIGEuam9pbignJicpOwoJfQp9Cgo8L3NjcmlwdD4KCjxwPlRoaXMgaXMgdGhlIGNydXggb2Ygd2hhdCB0aGlzIGRlbW8gaXMgc2hvd2luZy4gcG9zdFBob3RvIHVwbG9hZHMgdGhlIGZpbGUgc2VsZWN0ZWQgaW4gdGhlIGZpbGUgaW5wdXQgZWxlbWVudCB0byB0aGUgcGF0aCBvZiB0aGUgYWxidW0uIEl0IHRoZW4gY3JlYXRlcyBhbiBhbmNob3IgdGFnIHRvIHRoZSB1cGxvYWRlZCBmaWxlLjwvcD4KCgo8c2NyaXB0PgpmdW5jdGlvbiBjcmVhdGVBbGJ1bShmb3JtKXsKCgl2YXIgdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYWNjZXNzX3Rva2VuIik7CgoJaWYodG9rZW4pewoJCWh0dHBSZXF1ZXN0KCAiUE9TVCIsICdodHRwczovL2FwaXMubGl2ZS5uZXQvdjUuMC9tZS9hbGJ1bXM/YWNjZXNzX3Rva2VuPScrdG9rZW4sIAoJCQl7CgkJCQluYW1lOiBmb3JtLmVsZW1lbnRzWyduYW1lJ10udmFsdWUsCgkJCQlkZXNjcmlwdGlvbjogZm9ybS5lbGVtZW50c1snZGVzY3JpcHRpb24nXS52YWx1ZQoJCQl9LCAKCQkJZnVuY3Rpb24ocil7IAoJCQkJaWYoIXJ8fHIuZXJyb3IpewoJCQkJCWFsZXJ0KHIuZXJyb3IubWVzc2FnZSk7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJdmFyIG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOyAKCQkJCW9wdC52YWx1ZT10aGlzLnVwbG9hZF9sb2NhdGlvbjsgCgkJCQlvcHQuaW5uZXJIVE1MID0gdGhpcy5uYW1lOwoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdCcpLmFwcGVuZENoaWxkKG9wdCk7CgkJCX0pOwoJfQoJZWxzZXsKCQlhbGVydCgiUGxlYXNlIGNsaWNrIHRoZSBsb2dpbiBidXR0b24gZmlyc3QiKTsKCX0KCn0KPC9zY3JpcHQ+Cgo8c2NyaXB0IGNsYXNzPSJwcmUiPgpmdW5jdGlvbiBwb3N0UGhvdG8ocGF0aCwgZmlsZUlucHV0RWxlbWVudCl7Cgl2YXIgdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYWNjZXNzX3Rva2VuIik7CgoJaWYodG9rZW4pewoJCS8vIFBvc3QgYSBwaG90byB1cAoJCWh0dHBSZXF1ZXN0KCAiUE9TVCIsIHBhdGggKyAnP2FjY2Vzc190b2tlbj0nICsgdG9rZW4sIHsKCQkJZmlsZSA6IGZpbGVJbnB1dEVsZW1lbnQgCgkJfSwgZnVuY3Rpb24ocil7CgkJCWNvbnNvbGUubG9nKHIpOwoJCQl2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKCQkJYS5ocmVmID0gci5zb3VyY2U7CgkJCWEuaW5uZXJIVE1MID0gci5uYW1lOwoJCQlhLnRhcmdldCA9ICJfYmxhbmsiOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0JykuYXBwZW5kQ2hpbGQoYSk7CgkJfSwgZnVuY3Rpb24oZSl7CgkJCWNvbnNvbGUubG9nKCJQUk9HUkVTUyIpOwoJCQljb25zb2xlLmxvZyhlKTsKCQl9KTsKCX0KCWVsc2V7CgkJYWxlcnQoIlBsZWFzZSBjbGljayB0aGUgbG9naW4gYnV0dG9uIGZpcnN0Iik7Cgl9Cn0KPC9zY3JpcHQ+CgoKPHNjcmlwdD4KZnVuY3Rpb24geGhyVXBsb2FkKHBhdGgsIGZpbGUpewoKCXZhciB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJhY2Nlc3NfdG9rZW4iKTsKCgkvLyBJbml0aWF0ZSBYTUwgSW5zdGFuY2UKCXZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCgl4aHIub25sb2FkID0geGhyLm9uZXJyb3IgPSBmdW5jdGlvbihlKXsKCQl2YXIgdGV4dCA9IHhoci5yZXNwb25zZVRleHQ7CgkJY29uc29sZS5sb2codGV4dD9KU09OLnBhcnNlKHRleHQpOntlcnJvcjp7bWVzc2FnZToiUG9zdCBGYWlsZWQifX0pOwoJfTsKCgl4aHIub3BlbigiUE9TVCIsIHBhdGggKyAnP2FjY2Vzc190b2tlbj0nICsgdG9rZW4sIHRydWUpOwoKCXZhciBmZCA9IG5ldyBGb3JtRGF0YSgpOwoJZmQuYXBwZW5kKCdmaWxlJywgZmlsZSk7CgoJeGhyLnNlbmQoIGZkICk7Cn0KPC9zY3JpcHQ+CgoKCgo8c2NyaXB0IGNsYXNzPSJwcmUiPgpmdW5jdGlvbiB4aHJSZXF1ZXN0KG1ldGhvZCwgdXJsLCBkYXRhLCBjb21wbGV0ZSwgcHJvZ3Jlc3MpewoKCXZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCgkvLyB4aHIucmVzcG9uc2VUeXBlID0gImpzb24iOyAvLyBpcyBub3Qgd2lkZWx5IHN1cHBvcnRlZCBhcyB5ZXQKCgl4aHIub25sb2FkID0gZnVuY3Rpb24oZSl7CgkJdmFyIHRleHQgPSB4aHIucmVzcG9uc2VUZXh0OwoJCWNvbXBsZXRlKHRleHQ/SlNPTi5wYXJzZSh0ZXh0KTp7ZXJyb3I6e21lc3NhZ2U6IkNvdWxkIG5vdCBnZXQgcmVzb3VyY2UifX0pOwoJfTsKCgl4aHIub25lcnJvciA9IGZ1bmN0aW9uKGUpewoJCXZhciB0ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDsKCQljb21wbGV0ZSh0ZXh0P0pTT04ucGFyc2UodGV4dCk6e2Vycm9yOnttZXNzYWdlOiJQb3N0IGZhaWxlZCJ9fSkKCX07CgoJeGhyLm9ucHJvZ3Jlc3MgPSBwcm9ncmVzczsKCgl4aHIub3BlbihtZXRob2QsIHVybCwgdHJ1ZSk7CgoJaWYoZGF0YSl7CgkJLy8gV2luZG93cyB1bmlxdWUsIGNvbnZlcnQgdG8gYSBKU09OIHN0cmluZyBpZiB0aGlzIGNvbnRhaW5zIGJpbmFyeSBkYXRhCgkJaWYoIWhhc19iaW5hcnkoZGF0YSkpewoJCQlkYXRhID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7CgkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAnYXBwbGljYXRpb24vanNvbicpOwoJCX0KCQkvLyBDcmVhdGUgRm9ybURhdGEKCQllbHNlIGlmKCEoZGF0YSBpbnN0YW5jZW9mIEZvcm1EYXRhKSl7CgoJCQkvLyBMb29wIHRocm91Z2ggYW5kIGFkZCBmb3JtRGF0YQoJCQl2YXIgZiA9IG5ldyBGb3JtRGF0YSgpOwoJCQlmb3IoIHZhciB4IGluIGRhdGEgKWlmKGRhdGEuaGFzT3duUHJvcGVydHkoeCkpewoJCQkJZi5hcHBlbmQoeCwgZGF0YVt4XSk7CgkJCX0KCQkJZGF0YSA9IGY7CgkJfQoJfQoKCXhoci5zZW5kKCBkYXRhIHx8IG51bGwgKTsKfQo8L3NjcmlwdD4KCjxzY3JpcHQgY2xhc3M9InByZSI+CmZ1bmN0aW9uIGh0dHBSZXF1ZXN0KG1ldGhvZCwgdXJsLCBkYXRhLCBjb21wbGV0ZSwgcHJvZ3Jlc3MpewoKCXZhciBwID0gewoJCWRhdGEgOiBkYXRhCgl9CglpZiggcC5kYXRhICYmICFfZGF0YVRvSlNPTihwKSApewoJCWlmcmFtZUhhY2sodXJsLCBwLmRhdGEsIGNhbGxiYWNrKTsKCQlyZXR1cm47Cgl9CglkYXRhID0gcC5kYXRhOwoKCS8vIElFMTAsIEZGLCBDaHJvbWUKCWlmKCd3aXRoQ3JlZGVudGlhbHMnIGluIG5ldyBYTUxIdHRwUmVxdWVzdCgpKXsKCgkJeGhyUmVxdWVzdCggbWV0aG9kLCB1cmwsIGRhdGEsIGNvbXBsZXRlLCBwcm9ncmVzcyApOwoJfQoJZWxzZXsKCgkJLy8gd2luZG93cyBjb252ZXJ0IFBPU1QgdG8gR0VUCgkJLy8gVGhpcyBwZXJoYXBzIGlzbid0IHRoYXQgZ3JlYXQKCQl2YXIgcXM7CgkJaWYoIGRhdGEgKXsKCQkJZGF0YS5tZXRob2QgPSAncG9zdCc7CgkJCXFzID0gZGF0YTsKCQkJZGF0YT1udWxsOwoJCX0KCgoJCS8vIEVsc2UgYWRkIHRoZSBjYWxsYmFjayBvbiB0byB0aGUgVVJMCgkJaWYoIWRhdGEpewoJCQlqc29ucCh1cmwrKHFzPycmJytfcGFyYW0ocXMpOicnKSsiJmNhbGxiYWNrPT8iLCBjb21wbGV0ZSk7CgkJfQoJCWVsc2V7CgkJCWlmcmFtZUhhY2sodXJsLCBkYXRhLCBjb21wbGV0ZSk7CgkJfQoJfQp9CgovLwovLyBTb21lIG9mIHRoZSBwcm92aWRlcnMgcmVxdWlyZSB0aGF0IG9ubHkgTXVsdGlQYXJ0IGlzIHVzZWQgd2l0aCBub24tYmluYXJ5IGZvcm1zLgovLyBUaGlzIGZ1bmN0aW9uIGNoZWNrcyB3aGV0aGVyIHRoZSBmb3JtIGNvbnRhaW5zIGJpbmFyeSBkYXRhCmZ1bmN0aW9uIGhhc19iaW5hcnkoZGF0YSl7CglpZigoIkZvcm1EYXRhIiBpbiB3aW5kb3cgJiYgZGF0YSBpbnN0YW5jZW9mIEZvcm1EYXRhKXx8CgkJKCJGaWxlIiBpbiB3aW5kb3cgJiYgZGF0YSBpbnN0YW5jZW9mIEZpbGUpfHwKCQkoIkJsb2IiIGluIHdpbmRvdyAmJiBkYXRhIGluc3RhbmNlb2YgQmxvYikKCQkpewoJCXJldHVybiB0cnVlOwoJfQoJZm9yKHZhciB4IGluIGRhdGEgKSBpZihkYXRhLmhhc093blByb3BlcnR5KHgpKXsKCQlpZiggZGF0YVt4XSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmIGRhdGFbeF0udHlwZSA9PT0gJ2ZpbGUnICl7CgkJCXJldHVybiB0cnVlOwoJCX0KCX0KCXJldHVybiBmYWxzZTsKfQoKCjwvc2NyaXB0PgoKPHA+SUZyYW1lSGFjazwvcD4KPHNjcmlwdCBjbGFzcz0icHJlIj4KLy8gdXNlciBvdXQgbGl0dGxlIGhlbHBlZCBmdW5jdGlvbiB0byByZWFkIHRoZSBwYXJhbWV0ZXJzCnZhciBxcyA9IF9wYXJhbSh3aW5kb3cubG9jYXRpb24uaGFzaCk7Ci8vIElmIHRoZXJlIGV4aXN0cyBhIHN0YXRlIGFuZCBhIHJlc3VsdCBpbiB0aGUgaGFzaHRhZyB0aGVuIHdlIG5lZWQgdG8gY2FsbCB0aGVzZSBvbiB0aGUgcGFyZW50LgovLyBSZXN1bHQgaXMgc2VyaWFsaXplZCBKU09OIHN0cmluZy4KaWYocXMmJnFzLnN0YXRlJiZxcy5yZXN1bHQpewoJLy8gdHJpZ2dlciBhIGZ1bmN0aW9uIGluIHRoZSBwYXJlbnQKCXdpbmRvdy5wYXJlbnRbcXMuc3RhdGVdKEpTT04ucGFyc2UocXMucmVzdWx0KSk7Cn0KCjwvc2NyaXB0PgoKPHA+VGhpcyBGb3JtK2lGcmFtZStoYXNoIGhhY2sgbGV0cyB1cyBhdHRhY2ggYSBudW1iZXIgb2YgZGlmZmVyZW50IGRhdGEgdHlwZXMgdG8gYmUgcG9zdGVkLjwvcD4KPHVsPgoJPGxpPklucHV0RWxlbWVudDogUG9zdCBhIHNpbmdsZSBpbnB1dCBlbGVtZW50IHdpdGhpbiBhIGZvcm0KCTxsaT5JbnB1dEZvcm06IFBvc3QgYW4gZW50aXJlIGZvcm0gYW5kIGFsbCBpdHMgdmFsdWVzCgk8bGk+SlNPTjogVHVybiBhIEpTT04ga2V5PT52YWx1ZSBvciBhIGtleT0+SW5wdXRFbGVtZW50IGhhc2ggaW50byBhIGZvcm0gcG9zdAo8L3VsPgoKPHNjcmlwdCBjbGFzcz0icHJlIj4KZnVuY3Rpb24gaWZyYW1lSGFjayh1cmwsIGRhdGEsIGNhbGxiYWNrKXsKCgkvLyBUaGlzIGhhY2sgbmVlZHMgYSBmb3JtCgl2YXIgZm9ybSA9IG51bGwsIAoJCXJlZW5hYmxlQWZ0ZXJTdWJtaXQgPSBbXSwKCQluZXdmb3JtOwoKCS8vIFdoYXQgaXMgdGhlIG5hbWUgb2YgdGhlIGNhbGxiYWNrIHRvIGNvbnRhaW4KCS8vIFdlJ2xsIGFsc28gdXNlIHRoaXMgdG8gbmFtZSB0aGUgaUZyYW1lCgl2YXIgc3RhdGUgPSAiaWZybWhhY2tfIitwYXJzZUludChNYXRoLnJhbmRvbSgpKjFlNikudG9TdHJpbmcoMTYpOwoKCS8vIFNhdmUgdGhlIGNhbGxiYWNrIHRvIHRoZSB3aW5kb3cKCXdpbmRvd1tzdGF0ZV0gPSBmdW5jdGlvbihyKXsKCQl0cnl7CgkJCS8vIHJlbW92ZSB0aGUgaWZyYW1lIGZyb20gdGhlIHBhZ2UuCgkJCXdpbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHdpbik7CgkJCS8vIHJlbW92ZSB0aGUgZm9ybQoJCQlpZihuZXdmb3JtKXsKCQkJCW5ld2Zvcm0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuZXdmb3JtKTsKCQkJfQoJCX0KCQljYXRjaChlKXtjb25zb2xlLmVycm9yKCJjb3VsZCBub3QgcmVtb3ZlIGlmcmFtZSIpfQoKCQkvLyByZWVuYWJsZSB0aGUgZGlzYWJsZWQgZm9ybQoJCWZvcih2YXIgaT0wO2k8cmVlbmFibGVBZnRlclN1Ym1pdC5sZW5ndGg7aSsrKXsKCQkJaWYocmVlbmFibGVBZnRlclN1Ym1pdFtpXSl7CgkJCQlyZWVuYWJsZUFmdGVyU3VibWl0W2ldLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCBmYWxzZSk7CgkJCX0KCQl9CgoJCS8vIGZpcmUgdGhlIGNhbGxiYWNrCgkJY2FsbGJhY2socik7Cgl9CgoJLy8gQnVpbGQgdGhlIGlmcmFtZSB3aW5kb3cKCXZhciB3aW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKCXdpbi5pZCA9IHN0YXRlOwoJd2luLm5hbWUgPSBzdGF0ZTsKCXdpbi5oZWlnaHQgPSAiMXB4IjsKCXdpbi53aWR0aCA9ICIxcHgiOwoJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh3aW4pOwoKCS8vIEFkZCBzb21lIGFkZGl0aW9uYWwgcXVlcnkgcGFyYW1ldGVycyB0byB0aGUgVVJMCgl1cmwgKz0gIiZzdXBwcmVzc19yZXNwb25zZV9jb2Rlcz10cnVlJnJlZGlyZWN0X3VyaT0iK2VuY29kZVVSSUNvbXBvbmVudCh3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKC8jLiokLywnJykpICsiJnN0YXRlPSIrc3RhdGU7CgoJLy8gaWYgd2UgYXJlIGp1c3QgcG9zdGluZyBhIHNpbmdsZSBpdGVtCglpZihkYXRhIGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCl7CgkJLy8gZ2V0IHRoZSBwYXJlbnQgZm9ybQoJCXZhciBmb3JtID0gZGF0YS5mb3JtOwoJCS8vIExvb3AgdGhyb3VnaCBhbmQgZGlzYWJsZSBhbGwgb2YgaXRzIHNpYmxpbmdzCgkJZm9yKCB2YXIgaSA9IDA7IGkgPCBmb3JtLmVsZW1lbnRzLmxlbmd0aDsgaSsrICl7CgkJCWlmKGZvcm0uZWxlbWVudHNbaV0gIT09IGRhdGEpewoJCQkJZm9ybS5lbGVtZW50c1tpXS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJyx0cnVlKTsKCQkJfQoJCX0KCQkvLyBNb3ZlIHRoZSBmb2N1cyB0byB0aGUgZm9ybQoJCWRhdGEgPSBmb3JtOwoJfQoKCS8vIFBvc3RpbmcgYSBmb3JtCglpZihkYXRhIGluc3RhbmNlb2YgSFRNTEZvcm1FbGVtZW50KXsKCQkvLyBUaGlzIGlzIGEgZm9ybSBlbGVtZW50CgkJdmFyIGZvcm0gPSBkYXRhOwoKCQkvLyBEb2VzIHRoaXMgZm9ybSBuZWVkIHRvIGJlIGEgbXVsdGlwYXJ0IGZvcm0/CgkJZm9yKCB2YXIgaSA9IDA7IGkgPCBmb3JtLmVsZW1lbnRzLmxlbmd0aDsgaSsrICl7CgkJCWlmKCFmb3JtLmVsZW1lbnRzW2ldLmRpc2FibGVkICYmIGZvcm0uZWxlbWVudHNbaV0udHlwZSA9PT0gJ2ZpbGUnKXsKCQkJCWZvcm0uc2V0QXR0cmlidXRlKCdlbmN0eXBlJywgJ211bHRpcGFydC9mb3JtLWRhdGEnKTsKCQkJCWZvcm0uZWxlbWVudHNbaV0uc2V0QXR0cmlidXRlKCduYW1lJywgJ2ZpbGUnKTsKCQkJfQoJCX0KCX0KCWVsc2V7CgkJLy8gSXRzIG5vdCBhIGZvcm0gZWxlbWVudCwgCgkJLy8gVGhlcmVmb3JlIGl0IG11c3QgYmUgYSBKU09OIG9iamVjdCBvZiBLZXk9PlZhbHVlIG9yIEtleT0+RWxlbWVudAoKCQkvLyBJZiBhbnlvbmUgb2YgdGhvc2UgdmFsdWVzIGFyZSBhIGlucHV0IHR5cGU9ZmlsZSB3ZSBzaGFsbCBzaGFsbCBpbnNlcnQgaXRzIHNpYmxpbmdzIGludG8gdGhlIGZvcm0gZm9yIHdoaWNoIGl0IGJlbG9uZ3MuCgkJZm9yKHZhciB4IGluIGRhdGEpIGlmKGRhdGEuaGFzT3duUHJvcGVydHkoeCkpewoJCQkvLyBpcyB0aGlzIGFuIGlucHV0IEVsZW1lbnQ/CgkJCWlmKCBkYXRhW3hdIGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCAmJiBkYXRhW3hdLnR5cGUgPT09ICdmaWxlJyApewoJCQkJZm9ybSA9IGRhdGFbeF0uZm9ybTsKCQkJCWZvcm0uc2V0QXR0cmlidXRlKCdlbmN0eXBlJywgJ211bHRpcGFydC9mb3JtLWRhdGEnKTsKCQkJfQoJCX0KCgkJLy8gRG8gSWYgdGhlcmUgaXMgbm8gZGVmaW5lZCBmb3JtIGVsZW1lbnQsIGxldHMgY3JlYXRlIG9uZS4KCQlpZighZm9ybSl7CgkJCS8vIEJ1aWxkIGZvcm0KCQkJZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsKCQkJZm9ybS5oZWlnaHQgPSAiMXB4IjsKCQkJZm9ybS53aWR0aCA9ICIxcHgiOwoJCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZvcm0pOwoJCQluZXdmb3JtID0gZm9ybTsKCQl9CgoJCS8vIEFkZCBlbGVtZW50cyB0byB0aGUgZm9ybSBpZiB0aGV5IGRvbnQgZXhpc3QKCQlmb3IodmFyIHggaW4gZGF0YSkgaWYoZGF0YS5oYXNPd25Qcm9wZXJ0eSh4KSl7CgoJCQkvLyBJcyB0aGlzIGFuIGVsZW1lbnQ/CgkJCXZhciBlbCA9ICggZGF0YVt4XSBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQgfHwgZGF0YVt4XSBpbnN0YW5jZW9mIEhUTUxUZXh0QXJlYUVsZW1lbnQgfHwgZGF0YVt4XSBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICk7CgoJCQkvLyBpcyB0aGlzIG5vdCBhbiBpbnB1dCBlbGVtZW50LCBvciBvbmUgdGhhdCBleGlzdHMgb3V0c2lkZSB0aGUgZm9ybS4KCQkJaWYoICFlbCB8fCBkYXRhW3hdLmZvcm0gIT09IGZvcm0gKXsKCgkJCQkvLyBEb2VzIGFuIGVsZW1lbnQgaGF2ZSB0aGUgc2FtZSBuYW1lPwoJCQkJaWYoZm9ybS5lbGVtZW50c1t4XSl7CgkJCQkJLy8gUmVtb3ZlIGl0LgoJCQkJCWZvcm0uZWxlbWVudHNbeF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChmb3JtLmVsZW1lbnRzW3hdKTsKCQkJCX0KCgkJCQkvLyBDcmVhdGUgYW4gaW5wdXQgZWxlbWVudAoJCQkJdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCQkJCWlucHV0LnNldEF0dHJpYnV0ZSgnbmFtZScsIHgpOwoJCQkJaW5wdXQudmFsdWUgPSBkYXRhW3hdOwoKCQkJCS8vIERvZXMgaXQgaGF2ZSBhIHZhbHVlIGF0dHJpYnV0ZT8KCQkJCWlmKGVsKXsKCQkJCQlpbnB1dC52YWx1ZSA9IGRhdGFbeF0udmFsdWU7CgkJCQl9CgkJCQllbHNlIGlmKGVsIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpewoJCQkJCWlucHV0LnZhbHVlID0gZGF0YVt4XS5pbm5lckhUTUwgfHwgZGF0YVt4XS5pbm5lclRleHQ7CgkJCQl9CgoJCQkJZm9ybS5hcHBlbmRDaGlsZChpbnB1dCk7CgkJCX0KCQkJLy8gaXQgaXMgYW4gZWxlbWVudCwgd2hpY2ggZXhpc3RzIHdpdGhpbiB0aGUgZm9ybSwgYnV0IHRoZSBuYW1lIGlzIHdyb25nCgkJCWVsc2UgaWYoIGVsICYmIGRhdGFbeF0ubmFtZSAhPT0geCl7CgkJCQlkYXRhW3hdLnNldEF0dHJpYnV0ZSgnbmFtZScsIHgpOwoJCQkJZGF0YVt4XS5uYW1lID0geDsKCQkJfQoJCX0KCgkJLy8gRGlzYWJsZSBlbGVtZW50cyBmcm9tIHdpdGhpbiB0aGUgZm9ybSBpZiB0aGV5IHdlcmVuJ3Qgc3BlY2lmaWVkCgkJZm9yKHZhciBpPTA7aTxmb3JtLmNoaWxkcmVuLmxlbmd0aDtpKyspewoJCQkvLyBEb2VzIHRoZSBzYW1lIG5hbWUgYW5kIHZhbHVlIGV4aXN0IGluIHRoZSBwYXJlbnQKCQkJaWYoICEoIGZvcm0uY2hpbGRyZW5baV0ubmFtZSBpbiBkYXRhICkgJiYgZm9ybS5jaGlsZHJlbltpXS5nZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgIT09IHRydWUgKSB7CgkJCQkvLyBkaXNhYmxlIAoJCQkJZm9ybS5jaGlsZHJlbltpXS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJyx0cnVlKTsKCQkJCS8vIGFkZCByZS1lbmFibGUgdG8gY2FsbGJhY2sKCQkJCXJlZW5hYmxlQWZ0ZXJTdWJtaXQucHVzaChmb3JtLmNoaWxkcmVuW2ldKTsKCQkJfQoJCX0KCX0KCgoJLy8gU2V0IHRoZSB0YXJnZXQgb2YgdGhlIGZvcm0KCWZvcm0uc2V0QXR0cmlidXRlKCdtZXRob2QnLCAncG9zdCcpOwoJZm9ybS5zZXRBdHRyaWJ1dGUoJ2FjdGlvbicsIHVybCk7Cglmb3JtLnNldEF0dHJpYnV0ZSgndGFyZ2V0Jywgc3RhdGUpOwoKCS8vIFN1Ym1pdCB0aGUgZm9ybQoJc2V0VGltZW91dChmdW5jdGlvbigpewoJCWZvcm0uc3VibWl0KCk7Cgl9LDMwKTsKfQoKPC9zY3JpcHQ+Cgo8c2NyaXB0PgoKCi8vCi8vIAovLwpmdW5jdGlvbiBfZGF0YVRvSlNPTihwKXsKCXZhciBkYXRhID0gcC5kYXRhOwoKCS8vIElzIGRhdGEgYSBmb3JtIG9iamVjdAoJaWYoIGRhdGEgaW5zdGFuY2VvZiBIVE1MRm9ybUVsZW1lbnQgKXsKCQkvLyBHZXQgdGhlIGZpcnN0IEZvcm1FbGVtZW50IEl0ZW0gaWYgaXRzIGFuIHR5cGU9ZmlsZQoJCXZhciBraWRzID0gZGF0YS5jaGlsZHJlbjsKCgkJdmFyIGpzb24gPSB7fTsKCgkJLy8gQ3JlYXRlIGEgZGF0YSBzdHJpbmcKCQlmb3IodmFyIGk9MDtpPGtpZHMubGVuZ3RoO2krKyl7CgoJCQkvLyBJcyB0aGlzIGEgZmlsZSwgZG9lcyB0aGUgYnJvd3NlciBub3Qgc3VwcG9ydCAnZmlsZXMnIGFuZCAnRm9ybURhdGEnPwoJCQlpZigga2lkc1tpXS50eXBlID09PSAnZmlsZScgKXsKCQkJCS8vIHRoZSBicm93c2VyIGRvZXMgbm90IFhIUjIKCQkJCWlmKCJGb3JtRGF0YSIgaW4gd2luZG93KXsKCQkJCQlqc29uID0gbmV3IEZvcm1EYXRhKGRhdGEpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJZWxzZSBpZiggISgiZmlsZXMiIGluIGtpZHNbaV0pICl7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJCWVsc2V7CgkJCQlqc29uWyBraWRzW2ldLm5hbWUgXSA9IGtpZHNbaV0udmFsdWUgfHwga2lkc1tpXS5pbm5lckhUTUw7CgkJCX0KCQl9CgoJCS8vIENvbnZlcnQgdG8gYSBwb3N0YWJsZSBxdWVyeXN0cmluZwoJCWRhdGEgPSBqc29uOwoJfQoKCS8vIElzIHRoaXMgYSBmb3JtIGlucHV0IGVsZW1lbnQ/CglpZiggZGF0YSBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQgKXsKCQkvLyBHZXQgdGhlIElucHV0IEVsZW1lbnQKCQkvLyBEbyB3ZSBoYXZlIGEgQmxvYiBkYXRhPwoJCWlmKCJmaWxlcyIgaW4gZGF0YSl7CgoJCQl2YXIgbyA9IHt9OwoJCQlvWyBkYXRhLm5hbWUgXSA9IGRhdGEuZmlsZXM7CgkJCS8vIFR1cm4gaXQgaW50byBhIEZpbGVMaXN0CgkJCWRhdGEgPSBvOwoJCX0KCQllbHNlewoJCQkvLyBUaGlzIGlzIG9sZCBzY2hvb2wsIHdlIGhhdmUgdG8gcGVyZm9ybSB0aGUgRk9STSArIElGUkFNRSArIEhBU0hUQUcgaGFjawoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCS8vIElzIGRhdGEgYSBibG9iLCBGaWxlLCBGaWxlTGlzdD8KCWlmKCAoIkZpbGUiIGluIHdpbmRvdyAmJiBkYXRhIGluc3RhbmNlb2YgRmlsZSkgCgkJfHwgKCJCbG9iIiBpbiB3aW5kb3cgJiYgZGF0YSBpbnN0YW5jZW9mIEJsb2IpIAoJCXx8ICgiRmlsZUxpc3QiIGluIHdpbmRvdyAmJiBkYXRhIGluc3RhbmNlb2YgRmlsZUxpc3QpICl7CgoJCS8vIENvbnZlcnQgdG8gYSBKU09OIG9iamVjdAoJCWRhdGEgPSB7J2ZpbGUnIDogZGF0YX07Cgl9CgoJLy8gTG9vcCB0aHJvdWdoIGRhdGEgaWYgaXRzIG5vdCBGb3JtRGF0YSBpdCBtdXN0IG5vdyBiZSBhIEpTT04gb2JqZWN0CglpZiggISggIkZvcm1EYXRhIiBpbiB3aW5kb3cgJiYgZGF0YSBpbnN0YW5jZW9mIEZvcm1EYXRhICkgKXsKCgkJLy8gTG9vcCB0aHJvdWdoIHRoZSBvYmplY3QKCQlmb3IodmFyIHggaW4gZGF0YSkgaWYoZGF0YS5oYXNPd25Qcm9wZXJ0eSh4KSl7CgoJCQkvLyBGaWxlTGlzdCBPYmplY3Q/CgkJCWlmKCJGaWxlTGlzdCIgaW4gd2luZG93ICYmIGRhdGFbeF0gaW5zdGFuY2VvZiBGaWxlTGlzdCl7CgkJCQkvLyBHZXQgZmlyc3QgcmVjb3JkIG9ubHkKCQkJCWlmKGRhdGFbeF0ubGVuZ3RoPT09MSl7CgkJCQkJZGF0YVt4XSA9IGRhdGFbeF1bMF07CgkJCQl9CgkJCQllbHNlewoJCQkJCWNvbnNvbGUuZXJyb3IoIldlIHdlcmUgZXhwZWN0aW5nIHRoZSBGaWxlTGlzdCB0byBjb250YWluIG9uZSBmaWxlIik7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiggZGF0YVt4XSBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQgJiYgZGF0YVt4XS50eXBlID09PSAnZmlsZScgKXsKCQkJCWlmKCAoImZpbGVzIiBpbiBkYXRhW3hdICkgKXsKCQkJCQlkYXRhW3hdID0gZGF0YVt4XS5maWxlc1swXTsKCQkJCX0KCQkJCWVsc2V7CgkJCQkJLy8gdGhpcyBkb2VzIG5vdCBzdXBwb3J0IEhUTUw1IGZvcm1zIEZpbGVMaXN0CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYoIGRhdGFbeF0gaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50CgkJCQkmJiBkYXRhW3hdIGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQKCQkJCSYmIGRhdGFbeF0gaW5zdGFuY2VvZiBIVE1MVGV4dEFyZWFFbGVtZW50CgkJCQkpewoJCQkJZGF0YVt4XSA9IGRhdGFbeF0udmFsdWU7CgkJCX0KCQkJZWxzZSBpZiggZGF0YVt4XSBpbnN0YW5jZW9mIEVsZW1lbnQgKXsKCQkJCWRhdGFbeF0gPSBkYXRhW3hdLmlubmVySFRNTCB8fCBkYXRhW3hdLmlubmVyVGV4dDsKCQkJfQoJCX0KCX0KCglwLmRhdGEgPSBkYXRhOwoKCXJldHVybiB0cnVlOwp9Cgo8L3NjcmlwdD4KCjxzY3JpcHQ+CmlmKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJhY2Nlc3NfdG9rZW4iKSl7CgkvLyBUb2tlbgoJdmFyIHRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImFjY2Vzc190b2tlbiIpOwoKCS8vIE1ha2UgaHR0cFJlcXVlc3QKCS8vIFJldHJpZXZlIGFsbCBhbGJ1bXMgaW4gU2t5RHJpdmUKCWh0dHBSZXF1ZXN0KCJHRVQiLCAnaHR0cHM6Ly9hcGlzLmxpdmUubmV0L3Y1LjAvbWUvYWxidW1zP2FjY2Vzc190b2tlbj0nK3Rva2VuLCBudWxsLCBmdW5jdGlvbihyKXsKCQkvLyBWYWxpZAoJCWlmKCFyfHxyLmVycm9yKXsKCQkJYWxlcnQoIllvdSBoYXZlIGFuIGVycm9yOiAiK3IuZXJyb3IubWVzc2FnZSk7CgkJCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJhY2Nlc3NfdG9rZW4iKTsKCQkJcmV0dXJuOwoJCX0KCQkvLyBMb29wIHRocm91Z2ggdGhlIHJlc3VsdHMKCQlmb3IodmFyIGk9MDtpPHIuZGF0YS5sZW5ndGg7aSsrKXsKCQkJdmFyIG9iaiA9IHIuZGF0YVtpXTsKCQkJdmFyIG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwoJCQlvcHQudmFsdWUgPSBvYmoudXBsb2FkX2xvY2F0aW9uOwoJCQlvcHQuaW5uZXJIVE1MID0gb2JqLm5hbWU7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxlY3QnKS5hcHBlbmRDaGlsZChvcHQpOwoJCX0KCX0pOwp9Cjwvc2NyaXB0Pg==",
                "body": "PCFET0NUWVBFIGh0bWw+CjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iL2Fkb3JuL2Fkb3JuLmNzcyIvPgo8c2NyaXB0IHNyYz0iL2Fkb3JuL2Fkb3JuLmpzIiBhc3luYz48L3NjcmlwdD4KPHNjcmlwdCBzcmM9ImNsaWVudF9pZHMuanMiPjwvc2NyaXB0PgoKPHRpdGxlPlNpbXBsZSBTa3lEcml2ZSBEZW1vPC90aXRsZT4KPHN0eWxlPgppbWd7Cglwb3NpdGlvbjogZml4ZWQ7Cgl0b3A6MDsKCWxlZnQ6NTAlOwoJd2lkdGg6MjAwcHg7Cglib3JkZXI6MXB4IHNvbGlkICNjY2M7CglwYWRkaW5nOjEwcHg7Cn0KaW1nOm50aC1jaGlsZCgybil7Cgktd2Via2l0LXRyYW5zZm9ybTpyb3RhdGUoMTBkZWcpOwoJLW1vei10cmFuc2Zvcm06cm90YXRlKDEwZGVnKTsKCS1tcy10cmFuc2Zvcm06cm90YXRlKDEwZGVnKTsKCXRyYW5zZm9ybTpyb3RhdGUoMTBkZWcpOwp9CmltZzpudGgtY2hpbGQoM24pewoJLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKC0xMGRlZyk7CgktbW96LXRyYW5zZm9ybTpyb3RhdGUoLTEwZGVnKTsKCS1tcy10cmFuc2Zvcm06cm90YXRlKC0xMGRlZyk7Cgl0cmFuc2Zvcm06cm90YXRlKC0xMGRlZyk7Cn0KPC9zdHlsZT4KPGgxPlNpbXBsZSBTa3lkcml2ZSBkZW1vPC9oMT4KPGJsb2NrcXVvdGU+Cgk8cD5UaGlzIGRlbW8gdXNlcyBPQXV0aDIgYW5kIENPUlMgKG9yIEpTT05QKSB0byBtYWtlIHNvbWUgUkVTVCBjYWxscyB3aGljaCBuYXZpZ2F0ZSB0aGUgV2luZG93cyBMaXZlIEdyYXBoIEFQSSB0byBnZXQgc29tZSBwaG90b3Mgb3V0IG9mIFNreWRyaXZlLiBJdCBpcyBQTFVHSU4tRlJFRSE8L3A+CjxwPklmIHJ1bm5pbmcgbG9jYWxseSwgPGEgaHJlZj0iaHR0cDovL21hbmFnZS5kZXYubGl2ZS5jb20vIj5yZWdpc3RlciB5b3VyIGRldmVsb3BtZW50IGRvbWFpbjwvYT4gYW5kIHJlcGxhY2UgV0lORE9XU19DTElFTlRfSUQgKGJlbG93KSB3aXRoIHRoZSBjbGllbnRfaWQgeW91IGFyZSBhc3NpZ25lZDwvcD4KPC9ibG9ja3F1b3RlPgoKCTxwPlN0YXJ0IGJ5IGxvZ2dpbmcgaW4gCTxidXR0b24gb25jbGljaz0ibG9naW4oKSI+TG9naW48L2J1dHRvbj48L3A+Cgo8YmxvY2txdW90ZT4KCTxiPjEuIENyZWF0ZSBhbiBBbGJ1bTwvYj4KCTxmb3JtPgoJCTxsYWJlbD5BbGJ1bSBuYW1lIDwvbGFiZWw+CgkJPGlucHV0IHR5cGU9InRleHQiIGlkPSJuZXdfbmFtZSIgbmFtZT0ibmFtZSIgdmFsdWU9Ik5ldyBBbGJ1bSBOYW1lIi8+CgkJPGJyIC8+CgkJPGxhYmVsPkFsYnVtIGRlc2NyaXB0aW9uIDwvbGFiZWw+CgkJPHRleHRhcmVhIGlkPSJuZXdfZGVzY3JpcHRpb24iIG5hbWU9ImRlc2NyaXB0aW9uIj5UaGlzIGlzIGEgdGVzdCBhbGJ1bTwvdGV4dGFyZWE+CgkJPGJ1dHRvbiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImNyZWF0ZUFsYnVtKHRoaXMuZm9ybSkiPlVwbG9hZDwvYnV0dG9uPgoJPC9mb3JtPgoJPGI+Mi4gU2VsZWN0IGEgZmlsZTwvYj4KCTxmb3JtPgoJCTxpbnB1dCB0eXBlPSJmaWxlIiBuYW1lPSJmaWxlIiBpZD0iZmlsZSIvPgoJPC9mb3JtPgo8L2JyPgoJPGI+cGljayBhbiBhbGJ1bSBhcyB0aGUgZGVzdGluYXRpb248L2I+Cgk8c2VsZWN0IGlkPSJzZWxlY3QiPjwvc2VsZWN0Pgo8L2JyPgoJPGJ1dHRvbiBvbmNsaWNrPSJwb3N0UGhvdG8oIHNlbGVjdC52YWx1ZSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUnKS5mb3JtICkiPlVwbG9hZDwvYnV0dG9uPgoJPGJ1dHRvbiBvbmNsaWNrPSJ4aHJVcGxvYWQoIHNlbGVjdC52YWx1ZSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUnKS5maWxlc1swXSApIj5VcGxvYWQgWEhSPC9idXR0b24+Cgk8ZGl2IGlkPSJyZXN1bHQiPjwvZGl2Pgo8L2Jsb2NrcXVvdGU+Cgo8c2NyaXB0PgpmdW5jdGlvbiBsb2dpbigpewoJd2luZG93LmxvY2F0aW9uID0gJ2h0dHBzOi8vb2F1dGgubGl2ZS5jb20vYXV0aG9yaXplJysgCgkJJz9jbGllbnRfaWQ9JytXSU5ET1dTX0NMSUVOVF9JRCsKCQknJnNjb3BlPXdsLnNreWRyaXZlX3VwZGF0ZScrCgkJJyZyZXNwb25zZV90eXBlPXRva2VuJysKCQknJnJlZGlyZWN0X3VyaT0nK2VuY29kZVVSSUNvbXBvbmVudCh3aW5kb3cubG9jYXRpb24uaHJlZik7Cn0KCgp2YXIgYWNjZXNzX3Rva2VuID0gKHdpbmRvdy5sb2NhdGlvbi5oYXNofHx3aW5kb3cubG9jYXRpb24uc2VhcmNoKS5tYXRjaCgvYWNjZXNzX3Rva2VuPShbXiZdKykvKTsgCmlmKGFjY2Vzc190b2tlbil7IAoJLy8gU2F2ZSB0aGUgZmlyc3QgbWF0Y2gKCWxvY2FsU3RvcmFnZS5zZXRJdGVtKCJhY2Nlc3NfdG9rZW4iLCBkZWNvZGVVUklDb21wb25lbnQoYWNjZXNzX3Rva2VuWzFdKSk7Cn0KCnZhciBqc29uX2NvdW50ZXI9MDsKZnVuY3Rpb24ganNvbnAocGF0aCxjYWxsYmFjayl7CgkvLyBNYWtlIHRoZSBhbm9ueW1vdXMgZnVuY3Rpb24uIG5vdCBhbm9ueW1vdXMKCXZhciBjYWxsYmFja19uYW1lID0gJ2pzb25wXycgKyBqc29uX2NvdW50ZXIrKzsKCXdpbmRvd1tjYWxsYmFja19uYW1lXSA9IGNhbGxiYWNrOwoJLy8gQWRkIHRoZSBjYWxsYmFjayBuYW1lIHRvIHRoZSBwYXRoCglwYXRoID0gcGF0aC5yZXBsYWNlKC9cPVw/LywgJz0nK2NhbGxiYWNrX25hbWUpOwoJLy8gZmluZCBhIHBsYWNlIHRvIGluc2VydCB0aGUgc2NyaXB0IHRhZwoJdmFyIHNpYmxpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07CgkvLyBDcmVhdGUgdGhlIHNjcmlwdCB0YWcKCXZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKCXNjcmlwdC5zcmMgPSBwYXRoOwoJc2libGluZy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzY3JpcHQsc2libGluZyk7Cn0KCgoKLy8KLy8gUGFyYW0KLy8gRXhwbG9kZS9FbmNvZGUgdGhlIHBhcmFtZXRlcnMgb2YgYW4gVVJMIHN0cmluZy9vYmplY3QKLy8gQHBhcmFtIHN0cmluZyBzLCBTdHJpbmcgdG8gZGVjb2RlCi8vCmZ1bmN0aW9uIF9wYXJhbShzKXsKCXZhciBiLAoJCWEgPSB7fSwKCQltOwoJCglpZih0eXBlb2Yocyk9PT0nc3RyaW5nJyl7CgoJCW0gPSBzLnJlcGxhY2UoL15bXCNcP10vLCcnKS5tYXRjaCgvKFtePVwvXCZdKyk9KFteXCZdKykvZyk7CgkJaWYobSl7CgkJCWZvcih2YXIgaT0wO2k8bS5sZW5ndGg7aSsrKXsKCQkJCWIgPSBtW2ldLnNwbGl0KCc9Jyk7CgkJCQlhW2JbMF1dID0gZGVjb2RlVVJJQ29tcG9uZW50KCBiWzFdICk7CgkJCX0KCQl9CgkJcmV0dXJuIGE7Cgl9CgllbHNlIHsKCQl2YXIgbyA9IHM7CgkKCQlhID0gW107CgoJCWZvciggdmFyIHggaW4gbyApe2lmKG8uaGFzT3duUHJvcGVydHkoeCkpewoJCQlpZiggby5oYXNPd25Qcm9wZXJ0eSh4KSApewoJCQkJYS5wdXNoKCBbeCwgb1t4XSA9PT0gJz8nID8gJz8nIDogZW5jb2RlVVJJQ29tcG9uZW50KG9beF0pIF0uam9pbignPScpICk7CgkJCX0KCQl9fQoKCQlyZXR1cm4gYS5qb2luKCcmJyk7Cgl9Cn0KCjwvc2NyaXB0PgoKPHA+VGhpcyBpcyB0aGUgY3J1eCBvZiB3aGF0IHRoaXMgZGVtbyBpcyBzaG93aW5nLiBwb3N0UGhvdG8gdXBsb2FkcyB0aGUgZmlsZSBzZWxlY3RlZCBpbiB0aGUgZmlsZSBpbnB1dCBlbGVtZW50IHRvIHRoZSBwYXRoIG9mIHRoZSBhbGJ1bS4gSXQgdGhlbiBjcmVhdGVzIGFuIGFuY2hvciB0YWcgdG8gdGhlIHVwbG9hZGVkIGZpbGUuPC9wPgoKCjxzY3JpcHQ+CmZ1bmN0aW9uIGNyZWF0ZUFsYnVtKGZvcm0pewoKCXZhciB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJhY2Nlc3NfdG9rZW4iKTsKCglpZih0b2tlbil7CgkJaHR0cFJlcXVlc3QoICJQT1NUIiwgJ2h0dHBzOi8vYXBpcy5saXZlLm5ldC92NS4wL21lL2FsYnVtcz9hY2Nlc3NfdG9rZW49Jyt0b2tlbiwgCgkJCXsKCQkJCW5hbWU6IGZvcm0uZWxlbWVudHNbJ25hbWUnXS52YWx1ZSwKCQkJCWRlc2NyaXB0aW9uOiBmb3JtLmVsZW1lbnRzWydkZXNjcmlwdGlvbiddLnZhbHVlCgkJCX0sIAoJCQlmdW5jdGlvbihyKXsgCgkJCQlpZighcnx8ci5lcnJvcil7CgkJCQkJYWxlcnQoci5lcnJvci5tZXNzYWdlKTsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQl2YXIgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7IAoJCQkJb3B0LnZhbHVlPXRoaXMudXBsb2FkX2xvY2F0aW9uOyAKCQkJCW9wdC5pbm5lckhUTUwgPSB0aGlzLm5hbWU7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0JykuYXBwZW5kQ2hpbGQob3B0KTsKCQkJfSk7Cgl9CgllbHNlewoJCWFsZXJ0KCJQbGVhc2UgY2xpY2sgdGhlIGxvZ2luIGJ1dHRvbiBmaXJzdCIpOwoJfQoKfQo8L3NjcmlwdD4KCjxzY3JpcHQgY2xhc3M9InByZSI+CmZ1bmN0aW9uIHBvc3RQaG90byhwYXRoLCBmaWxlSW5wdXRFbGVtZW50KXsKCXZhciB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJhY2Nlc3NfdG9rZW4iKTsKCglpZih0b2tlbil7CgkJLy8gUG9zdCBhIHBob3RvIHVwCgkJaHR0cFJlcXVlc3QoICJQT1NUIiwgcGF0aCArICc/YWNjZXNzX3Rva2VuPScgKyB0b2tlbiwgewoJCQlmaWxlIDogZmlsZUlucHV0RWxlbWVudCAKCQl9LCBmdW5jdGlvbihyKXsKCQkJY29uc29sZS5sb2cocik7CgkJCXZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJCQlhLmhyZWYgPSByLnNvdXJjZTsKCQkJYS5pbm5lckhUTUwgPSByLm5hbWU7CgkJCWEudGFyZ2V0ID0gIl9ibGFuayI7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHQnKS5hcHBlbmRDaGlsZChhKTsKCQl9LCBmdW5jdGlvbihlKXsKCQkJY29uc29sZS5sb2coIlBST0dSRVNTIik7CgkJCWNvbnNvbGUubG9nKGUpOwoJCX0pOwoJfQoJZWxzZXsKCQlhbGVydCgiUGxlYXNlIGNsaWNrIHRoZSBsb2dpbiBidXR0b24gZmlyc3QiKTsKCX0KfQo8L3NjcmlwdD4KCgo8c2NyaXB0PgpmdW5jdGlvbiB4aHJVcGxvYWQocGF0aCwgZmlsZSl7CgoJdmFyIHRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImFjY2Vzc190b2tlbiIpOwoKCS8vIEluaXRpYXRlIFhNTCBJbnN0YW5jZQoJdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoKCXhoci5vbmxvYWQgPSB4aHIub25lcnJvciA9IGZ1bmN0aW9uKGUpewoJCXZhciB0ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDsKCQljb25zb2xlLmxvZyh0ZXh0P0pTT04ucGFyc2UodGV4dCk6e2Vycm9yOnttZXNzYWdlOiJQb3N0IEZhaWxlZCJ9fSk7Cgl9OwoKCXhoci5vcGVuKCJQT1NUIiwgcGF0aCArICc/YWNjZXNzX3Rva2VuPScgKyB0b2tlbiwgdHJ1ZSk7CgoJdmFyIGZkID0gbmV3IEZvcm1EYXRhKCk7CglmZC5hcHBlbmQoJ2ZpbGUnLCBmaWxlKTsKCgl4aHIuc2VuZCggZmQgKTsKfQo8L3NjcmlwdD4KCgoKCjxzY3JpcHQgY2xhc3M9InByZSI+CmZ1bmN0aW9uIHhoclJlcXVlc3QobWV0aG9kLCB1cmwsIGRhdGEsIGNvbXBsZXRlLCBwcm9ncmVzcyl7CgoJdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoKCS8vIHhoci5yZXNwb25zZVR5cGUgPSAianNvbiI7IC8vIGlzIG5vdCB3aWRlbHkgc3VwcG9ydGVkIGFzIHlldAoKCXhoci5vbmxvYWQgPSBmdW5jdGlvbihlKXsKCQl2YXIgdGV4dCA9IHhoci5yZXNwb25zZVRleHQ7CgkJY29tcGxldGUodGV4dD9KU09OLnBhcnNlKHRleHQpOntlcnJvcjp7bWVzc2FnZToiQ291bGQgbm90IGdldCByZXNvdXJjZSJ9fSk7Cgl9OwoKCXhoci5vbmVycm9yID0gZnVuY3Rpb24oZSl7CgkJdmFyIHRleHQgPSB4aHIucmVzcG9uc2VUZXh0OwoJCWNvbXBsZXRlKHRleHQ/SlNPTi5wYXJzZSh0ZXh0KTp7ZXJyb3I6e21lc3NhZ2U6IlBvc3QgZmFpbGVkIn19KQoJfTsKCgl4aHIub25wcm9ncmVzcyA9IHByb2dyZXNzOwoKCXhoci5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTsKCglpZihkYXRhKXsKCQkvLyBXaW5kb3dzIHVuaXF1ZSwgY29udmVydCB0byBhIEpTT04gc3RyaW5nIGlmIHRoaXMgY29udGFpbnMgYmluYXJ5IGRhdGEKCQlpZighaGFzX2JpbmFyeShkYXRhKSl7CgkJCWRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKTsKCQkJeGhyLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICdhcHBsaWNhdGlvbi9qc29uJyk7CgkJfQoJCS8vIENyZWF0ZSBGb3JtRGF0YQoJCWVsc2UgaWYoIShkYXRhIGluc3RhbmNlb2YgRm9ybURhdGEpKXsKCgkJCS8vIExvb3AgdGhyb3VnaCBhbmQgYWRkIGZvcm1EYXRhCgkJCXZhciBmID0gbmV3IEZvcm1EYXRhKCk7CgkJCWZvciggdmFyIHggaW4gZGF0YSApaWYoZGF0YS5oYXNPd25Qcm9wZXJ0eSh4KSl7CgkJCQlmLmFwcGVuZCh4LCBkYXRhW3hdKTsKCQkJfQoJCQlkYXRhID0gZjsKCQl9Cgl9CgoJeGhyLnNlbmQoIGRhdGEgfHwgbnVsbCApOwp9Cjwvc2NyaXB0PgoKPHNjcmlwdCBjbGFzcz0icHJlIj4KZnVuY3Rpb24gaHR0cFJlcXVlc3QobWV0aG9kLCB1cmwsIGRhdGEsIGNvbXBsZXRlLCBwcm9ncmVzcyl7CgoJdmFyIHAgPSB7CgkJZGF0YSA6IGRhdGEKCX0KCWlmKCBwLmRhdGEgJiYgIV9kYXRhVG9KU09OKHApICl7CgkJaWZyYW1lSGFjayh1cmwsIHAuZGF0YSwgY2FsbGJhY2spOwoJCXJldHVybjsKCX0KCWRhdGEgPSBwLmRhdGE7CgoJLy8gSUUxMCwgRkYsIENocm9tZQoJaWYoJ3dpdGhDcmVkZW50aWFscycgaW4gbmV3IFhNTEh0dHBSZXF1ZXN0KCkpewoKCQl4aHJSZXF1ZXN0KCBtZXRob2QsIHVybCwgZGF0YSwgY29tcGxldGUsIHByb2dyZXNzICk7Cgl9CgllbHNlewoKCQkvLyB3aW5kb3dzIGNvbnZlcnQgUE9TVCB0byBHRVQKCQkvLyBUaGlzIHBlcmhhcHMgaXNuJ3QgdGhhdCBncmVhdAoJCXZhciBxczsKCQlpZiggZGF0YSApewoJCQlkYXRhLm1ldGhvZCA9ICdwb3N0JzsKCQkJcXMgPSBkYXRhOwoJCQlkYXRhPW51bGw7CgkJfQoKCgkJLy8gRWxzZSBhZGQgdGhlIGNhbGxiYWNrIG9uIHRvIHRoZSBVUkwKCQlpZighZGF0YSl7CgkJCWpzb25wKHVybCsocXM/JyYnK19wYXJhbShxcyk6JycpKyImY2FsbGJhY2s9PyIsIGNvbXBsZXRlKTsKCQl9CgkJZWxzZXsKCQkJaWZyYW1lSGFjayh1cmwsIGRhdGEsIGNvbXBsZXRlKTsKCQl9Cgl9Cn0KCi8vCi8vIFNvbWUgb2YgdGhlIHByb3ZpZGVycyByZXF1aXJlIHRoYXQgb25seSBNdWx0aVBhcnQgaXMgdXNlZCB3aXRoIG5vbi1iaW5hcnkgZm9ybXMuCi8vIFRoaXMgZnVuY3Rpb24gY2hlY2tzIHdoZXRoZXIgdGhlIGZvcm0gY29udGFpbnMgYmluYXJ5IGRhdGEKZnVuY3Rpb24gaGFzX2JpbmFyeShkYXRhKXsKCWlmKCgiRm9ybURhdGEiIGluIHdpbmRvdyAmJiBkYXRhIGluc3RhbmNlb2YgRm9ybURhdGEpfHwKCQkoIkZpbGUiIGluIHdpbmRvdyAmJiBkYXRhIGluc3RhbmNlb2YgRmlsZSl8fAoJCSgiQmxvYiIgaW4gd2luZG93ICYmIGRhdGEgaW5zdGFuY2VvZiBCbG9iKQoJCSl7CgkJcmV0dXJuIHRydWU7Cgl9Cglmb3IodmFyIHggaW4gZGF0YSApIGlmKGRhdGEuaGFzT3duUHJvcGVydHkoeCkpewoJCWlmKCBkYXRhW3hdIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgJiYgZGF0YVt4XS50eXBlID09PSAnZmlsZScgKXsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfQoJcmV0dXJuIGZhbHNlOwp9CgoKPC9zY3JpcHQ+Cgo8cD5JRnJhbWVIYWNrPC9wPgo8c2NyaXB0IGNsYXNzPSJwcmUiPgovLyB1c2VyIG91dCBsaXR0bGUgaGVscGVkIGZ1bmN0aW9uIHRvIHJlYWQgdGhlIHBhcmFtZXRlcnMKdmFyIHFzID0gX3BhcmFtKHdpbmRvdy5sb2NhdGlvbi5oYXNoKTsKLy8gSWYgdGhlcmUgZXhpc3RzIGEgc3RhdGUgYW5kIGEgcmVzdWx0IGluIHRoZSBoYXNodGFnIHRoZW4gd2UgbmVlZCB0byBjYWxsIHRoZXNlIG9uIHRoZSBwYXJlbnQuCi8vIFJlc3VsdCBpcyBzZXJpYWxpemVkIEpTT04gc3RyaW5nLgppZihxcyYmcXMuc3RhdGUmJnFzLnJlc3VsdCl7CgkvLyB0cmlnZ2VyIGEgZnVuY3Rpb24gaW4gdGhlIHBhcmVudAoJd2luZG93LnBhcmVudFtxcy5zdGF0ZV0oSlNPTi5wYXJzZShxcy5yZXN1bHQpKTsKfQoKPC9zY3JpcHQ+Cgo8cD5UaGlzIEZvcm0raUZyYW1lK2hhc2ggaGFjayBsZXRzIHVzIGF0dGFjaCBhIG51bWJlciBvZiBkaWZmZXJlbnQgZGF0YSB0eXBlcyB0byBiZSBwb3N0ZWQuPC9wPgo8dWw+Cgk8bGk+SW5wdXRFbGVtZW50OiBQb3N0IGEgc2luZ2xlIGlucHV0IGVsZW1lbnQgd2l0aGluIGEgZm9ybQoJPGxpPklucHV0Rm9ybTogUG9zdCBhbiBlbnRpcmUgZm9ybSBhbmQgYWxsIGl0cyB2YWx1ZXMKCTxsaT5KU09OOiBUdXJuIGEgSlNPTiBrZXk9PnZhbHVlIG9yIGEga2V5PT5JbnB1dEVsZW1lbnQgaGFzaCBpbnRvIGEgZm9ybSBwb3N0CjwvdWw+Cgo8c2NyaXB0IGNsYXNzPSJwcmUiPgpmdW5jdGlvbiBpZnJhbWVIYWNrKHVybCwgZGF0YSwgY2FsbGJhY2spewoKCS8vIFRoaXMgaGFjayBuZWVkcyBhIGZvcm0KCXZhciBmb3JtID0gbnVsbCwgCgkJcmVlbmFibGVBZnRlclN1Ym1pdCA9IFtdLAoJCW5ld2Zvcm07CgoJLy8gV2hhdCBpcyB0aGUgbmFtZSBvZiB0aGUgY2FsbGJhY2sgdG8gY29udGFpbgoJLy8gV2UnbGwgYWxzbyB1c2UgdGhpcyB0byBuYW1lIHRoZSBpRnJhbWUKCXZhciBzdGF0ZSA9ICJpZnJtaGFja18iK3BhcnNlSW50KE1hdGgucmFuZG9tKCkqMWU2KS50b1N0cmluZygxNik7CgoJLy8gU2F2ZSB0aGUgY2FsbGJhY2sgdG8gdGhlIHdpbmRvdwoJd2luZG93W3N0YXRlXSA9IGZ1bmN0aW9uKHIpewoJCXRyeXsKCQkJLy8gcmVtb3ZlIHRoZSBpZnJhbWUgZnJvbSB0aGUgcGFnZS4KCQkJd2luLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQod2luKTsKCQkJLy8gcmVtb3ZlIHRoZSBmb3JtCgkJCWlmKG5ld2Zvcm0pewoJCQkJbmV3Zm9ybS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5ld2Zvcm0pOwoJCQl9CgkJfQoJCWNhdGNoKGUpe2NvbnNvbGUuZXJyb3IoImNvdWxkIG5vdCByZW1vdmUgaWZyYW1lIil9CgoJCS8vIHJlZW5hYmxlIHRoZSBkaXNhYmxlZCBmb3JtCgkJZm9yKHZhciBpPTA7aTxyZWVuYWJsZUFmdGVyU3VibWl0Lmxlbmd0aDtpKyspewoJCQlpZihyZWVuYWJsZUFmdGVyU3VibWl0W2ldKXsKCQkJCXJlZW5hYmxlQWZ0ZXJTdWJtaXRbaV0uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsIGZhbHNlKTsKCQkJfQoJCX0KCgkJLy8gZmlyZSB0aGUgY2FsbGJhY2sKCQljYWxsYmFjayhyKTsKCX0KCgkvLyBCdWlsZCB0aGUgaWZyYW1lIHdpbmRvdwoJdmFyIHdpbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwoJd2luLmlkID0gc3RhdGU7Cgl3aW4ubmFtZSA9IHN0YXRlOwoJd2luLmhlaWdodCA9ICIxcHgiOwoJd2luLndpZHRoID0gIjFweCI7Cglkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHdpbik7CgoJLy8gQWRkIHNvbWUgYWRkaXRpb25hbCBxdWVyeSBwYXJhbWV0ZXJzIHRvIHRoZSBVUkwKCXVybCArPSAiJnN1cHByZXNzX3Jlc3BvbnNlX2NvZGVzPXRydWUmcmVkaXJlY3RfdXJpPSIrZW5jb2RlVVJJQ29tcG9uZW50KHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyMuKiQvLCcnKSkgKyImc3RhdGU9IitzdGF0ZTsKCgkvLyBpZiB3ZSBhcmUganVzdCBwb3N0aW5nIGEgc2luZ2xlIGl0ZW0KCWlmKGRhdGEgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KXsKCQkvLyBnZXQgdGhlIHBhcmVudCBmb3JtCgkJdmFyIGZvcm0gPSBkYXRhLmZvcm07CgkJLy8gTG9vcCB0aHJvdWdoIGFuZCBkaXNhYmxlIGFsbCBvZiBpdHMgc2libGluZ3MKCQlmb3IoIHZhciBpID0gMDsgaSA8IGZvcm0uZWxlbWVudHMubGVuZ3RoOyBpKysgKXsKCQkJaWYoZm9ybS5lbGVtZW50c1tpXSAhPT0gZGF0YSl7CgkJCQlmb3JtLmVsZW1lbnRzW2ldLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLHRydWUpOwoJCQl9CgkJfQoJCS8vIE1vdmUgdGhlIGZvY3VzIHRvIHRoZSBmb3JtCgkJZGF0YSA9IGZvcm07Cgl9CgoJLy8gUG9zdGluZyBhIGZvcm0KCWlmKGRhdGEgaW5zdGFuY2VvZiBIVE1MRm9ybUVsZW1lbnQpewoJCS8vIFRoaXMgaXMgYSBmb3JtIGVsZW1lbnQKCQl2YXIgZm9ybSA9IGRhdGE7CgoJCS8vIERvZXMgdGhpcyBmb3JtIG5lZWQgdG8gYmUgYSBtdWx0aXBhcnQgZm9ybT8KCQlmb3IoIHZhciBpID0gMDsgaSA8IGZvcm0uZWxlbWVudHMubGVuZ3RoOyBpKysgKXsKCQkJaWYoIWZvcm0uZWxlbWVudHNbaV0uZGlzYWJsZWQgJiYgZm9ybS5lbGVtZW50c1tpXS50eXBlID09PSAnZmlsZScpewoJCQkJZm9ybS5zZXRBdHRyaWJ1dGUoJ2VuY3R5cGUnLCAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScpOwoJCQkJZm9ybS5lbGVtZW50c1tpXS5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnZmlsZScpOwoJCQl9CgkJfQoJfQoJZWxzZXsKCQkvLyBJdHMgbm90IGEgZm9ybSBlbGVtZW50LCAKCQkvLyBUaGVyZWZvcmUgaXQgbXVzdCBiZSBhIEpTT04gb2JqZWN0IG9mIEtleT0+VmFsdWUgb3IgS2V5PT5FbGVtZW50CgoJCS8vIElmIGFueW9uZSBvZiB0aG9zZSB2YWx1ZXMgYXJlIGEgaW5wdXQgdHlwZT1maWxlIHdlIHNoYWxsIHNoYWxsIGluc2VydCBpdHMgc2libGluZ3MgaW50byB0aGUgZm9ybSBmb3Igd2hpY2ggaXQgYmVsb25ncy4KCQlmb3IodmFyIHggaW4gZGF0YSkgaWYoZGF0YS5oYXNPd25Qcm9wZXJ0eSh4KSl7CgkJCS8vIGlzIHRoaXMgYW4gaW5wdXQgRWxlbWVudD8KCQkJaWYoIGRhdGFbeF0gaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50ICYmIGRhdGFbeF0udHlwZSA9PT0gJ2ZpbGUnICl7CgkJCQlmb3JtID0gZGF0YVt4XS5mb3JtOwoJCQkJZm9ybS5zZXRBdHRyaWJ1dGUoJ2VuY3R5cGUnLCAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScpOwoJCQl9CgkJfQoKCQkvLyBEbyBJZiB0aGVyZSBpcyBubyBkZWZpbmVkIGZvcm0gZWxlbWVudCwgbGV0cyBjcmVhdGUgb25lLgoJCWlmKCFmb3JtKXsKCQkJLy8gQnVpbGQgZm9ybQoJCQlmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9ybScpOwoJCQlmb3JtLmhlaWdodCA9ICIxcHgiOwoJCQlmb3JtLndpZHRoID0gIjFweCI7CgkJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZm9ybSk7CgkJCW5ld2Zvcm0gPSBmb3JtOwoJCX0KCgkJLy8gQWRkIGVsZW1lbnRzIHRvIHRoZSBmb3JtIGlmIHRoZXkgZG9udCBleGlzdAoJCWZvcih2YXIgeCBpbiBkYXRhKSBpZihkYXRhLmhhc093blByb3BlcnR5KHgpKXsKCgkJCS8vIElzIHRoaXMgYW4gZWxlbWVudD8KCQkJdmFyIGVsID0gKCBkYXRhW3hdIGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCB8fCBkYXRhW3hdIGluc3RhbmNlb2YgSFRNTFRleHRBcmVhRWxlbWVudCB8fCBkYXRhW3hdIGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgKTsKCgkJCS8vIGlzIHRoaXMgbm90IGFuIGlucHV0IGVsZW1lbnQsIG9yIG9uZSB0aGF0IGV4aXN0cyBvdXRzaWRlIHRoZSBmb3JtLgoJCQlpZiggIWVsIHx8IGRhdGFbeF0uZm9ybSAhPT0gZm9ybSApewoKCQkJCS8vIERvZXMgYW4gZWxlbWVudCBoYXZlIHRoZSBzYW1lIG5hbWU/CgkJCQlpZihmb3JtLmVsZW1lbnRzW3hdKXsKCQkJCQkvLyBSZW1vdmUgaXQuCgkJCQkJZm9ybS5lbGVtZW50c1t4XS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGZvcm0uZWxlbWVudHNbeF0pOwoJCQkJfQoKCQkJCS8vIENyZWF0ZSBhbiBpbnB1dCBlbGVtZW50CgkJCQl2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoJCQkJaW5wdXQuc2V0QXR0cmlidXRlKCduYW1lJywgeCk7CgkJCQlpbnB1dC52YWx1ZSA9IGRhdGFbeF07CgoJCQkJLy8gRG9lcyBpdCBoYXZlIGEgdmFsdWUgYXR0cmlidXRlPwoJCQkJaWYoZWwpewoJCQkJCWlucHV0LnZhbHVlID0gZGF0YVt4XS52YWx1ZTsKCQkJCX0KCQkJCWVsc2UgaWYoZWwgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCl7CgkJCQkJaW5wdXQudmFsdWUgPSBkYXRhW3hdLmlubmVySFRNTCB8fCBkYXRhW3hdLmlubmVyVGV4dDsKCQkJCX0KCgkJCQlmb3JtLmFwcGVuZENoaWxkKGlucHV0KTsKCQkJfQoJCQkvLyBpdCBpcyBhbiBlbGVtZW50LCB3aGljaCBleGlzdHMgd2l0aGluIHRoZSBmb3JtLCBidXQgdGhlIG5hbWUgaXMgd3JvbmcKCQkJZWxzZSBpZiggZWwgJiYgZGF0YVt4XS5uYW1lICE9PSB4KXsKCQkJCWRhdGFbeF0uc2V0QXR0cmlidXRlKCduYW1lJywgeCk7CgkJCQlkYXRhW3hdLm5hbWUgPSB4OwoJCQl9CgkJfQoKCQkvLyBEaXNhYmxlIGVsZW1lbnRzIGZyb20gd2l0aGluIHRoZSBmb3JtIGlmIHRoZXkgd2VyZW4ndCBzcGVjaWZpZWQKCQlmb3IodmFyIGk9MDtpPGZvcm0uY2hpbGRyZW4ubGVuZ3RoO2krKyl7CgkJCS8vIERvZXMgdGhlIHNhbWUgbmFtZSBhbmQgdmFsdWUgZXhpc3QgaW4gdGhlIHBhcmVudAoJCQlpZiggISggZm9ybS5jaGlsZHJlbltpXS5uYW1lIGluIGRhdGEgKSAmJiBmb3JtLmNoaWxkcmVuW2ldLmdldEF0dHJpYnV0ZSgnZGlzYWJsZWQnKSAhPT0gdHJ1ZSApIHsKCQkJCS8vIGRpc2FibGUgCgkJCQlmb3JtLmNoaWxkcmVuW2ldLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLHRydWUpOwoJCQkJLy8gYWRkIHJlLWVuYWJsZSB0byBjYWxsYmFjawoJCQkJcmVlbmFibGVBZnRlclN1Ym1pdC5wdXNoKGZvcm0uY2hpbGRyZW5baV0pOwoJCQl9CgkJfQoJfQoKCgkvLyBTZXQgdGhlIHRhcmdldCBvZiB0aGUgZm9ybQoJZm9ybS5zZXRBdHRyaWJ1dGUoJ21ldGhvZCcsICdwb3N0Jyk7Cglmb3JtLnNldEF0dHJpYnV0ZSgnYWN0aW9uJywgdXJsKTsKCWZvcm0uc2V0QXR0cmlidXRlKCd0YXJnZXQnLCBzdGF0ZSk7CgoJLy8gU3VibWl0IHRoZSBmb3JtCglzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CgkJZm9ybS5zdWJtaXQoKTsKCX0sMzApOwp9Cgo8L3NjcmlwdD4KCjxzY3JpcHQ+CgoKLy8KLy8gCi8vCmZ1bmN0aW9uIF9kYXRhVG9KU09OKHApewoJdmFyIGRhdGEgPSBwLmRhdGE7CgoJLy8gSXMgZGF0YSBhIGZvcm0gb2JqZWN0CglpZiggZGF0YSBpbnN0YW5jZW9mIEhUTUxGb3JtRWxlbWVudCApewoJCS8vIEdldCB0aGUgZmlyc3QgRm9ybUVsZW1lbnQgSXRlbSBpZiBpdHMgYW4gdHlwZT1maWxlCgkJdmFyIGtpZHMgPSBkYXRhLmNoaWxkcmVuOwoKCQl2YXIganNvbiA9IHt9OwoKCQkvLyBDcmVhdGUgYSBkYXRhIHN0cmluZwoJCWZvcih2YXIgaT0wO2k8a2lkcy5sZW5ndGg7aSsrKXsKCgkJCS8vIElzIHRoaXMgYSBmaWxlLCBkb2VzIHRoZSBicm93c2VyIG5vdCBzdXBwb3J0ICdmaWxlcycgYW5kICdGb3JtRGF0YSc/CgkJCWlmKCBraWRzW2ldLnR5cGUgPT09ICdmaWxlJyApewoJCQkJLy8gdGhlIGJyb3dzZXIgZG9lcyBub3QgWEhSMgoJCQkJaWYoIkZvcm1EYXRhIiBpbiB3aW5kb3cpewoJCQkJCWpzb24gPSBuZXcgRm9ybURhdGEoZGF0YSk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQllbHNlIGlmKCAhKCJmaWxlcyIgaW4ga2lkc1tpXSkgKXsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJZWxzZXsKCQkJCWpzb25bIGtpZHNbaV0ubmFtZSBdID0ga2lkc1tpXS52YWx1ZSB8fCBraWRzW2ldLmlubmVySFRNTDsKCQkJfQoJCX0KCgkJLy8gQ29udmVydCB0byBhIHBvc3RhYmxlIHF1ZXJ5c3RyaW5nCgkJZGF0YSA9IGpzb247Cgl9CgoJLy8gSXMgdGhpcyBhIGZvcm0gaW5wdXQgZWxlbWVudD8KCWlmKCBkYXRhIGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCApewoJCS8vIEdldCB0aGUgSW5wdXQgRWxlbWVudAoJCS8vIERvIHdlIGhhdmUgYSBCbG9iIGRhdGE/CgkJaWYoImZpbGVzIiBpbiBkYXRhKXsKCgkJCXZhciBvID0ge307CgkJCW9bIGRhdGEubmFtZSBdID0gZGF0YS5maWxlczsKCQkJLy8gVHVybiBpdCBpbnRvIGEgRmlsZUxpc3QKCQkJZGF0YSA9IG87CgkJfQoJCWVsc2V7CgkJCS8vIFRoaXMgaXMgb2xkIHNjaG9vbCwgd2UgaGF2ZSB0byBwZXJmb3JtIHRoZSBGT1JNICsgSUZSQU1FICsgSEFTSFRBRyBoYWNrCgkJCXJldHVybiBmYWxzZTsKCQl9Cgl9CgoJLy8gSXMgZGF0YSBhIGJsb2IsIEZpbGUsIEZpbGVMaXN0PwoJaWYoICgiRmlsZSIgaW4gd2luZG93ICYmIGRhdGEgaW5zdGFuY2VvZiBGaWxlKSAKCQl8fCAoIkJsb2IiIGluIHdpbmRvdyAmJiBkYXRhIGluc3RhbmNlb2YgQmxvYikgCgkJfHwgKCJGaWxlTGlzdCIgaW4gd2luZG93ICYmIGRhdGEgaW5zdGFuY2VvZiBGaWxlTGlzdCkgKXsKCgkJLy8gQ29udmVydCB0byBhIEpTT04gb2JqZWN0CgkJZGF0YSA9IHsnZmlsZScgOiBkYXRhfTsKCX0KCgkvLyBMb29wIHRocm91Z2ggZGF0YSBpZiBpdHMgbm90IEZvcm1EYXRhIGl0IG11c3Qgbm93IGJlIGEgSlNPTiBvYmplY3QKCWlmKCAhKCAiRm9ybURhdGEiIGluIHdpbmRvdyAmJiBkYXRhIGluc3RhbmNlb2YgRm9ybURhdGEgKSApewoKCQkvLyBMb29wIHRocm91Z2ggdGhlIG9iamVjdAoJCWZvcih2YXIgeCBpbiBkYXRhKSBpZihkYXRhLmhhc093blByb3BlcnR5KHgpKXsKCgkJCS8vIEZpbGVMaXN0IE9iamVjdD8KCQkJaWYoIkZpbGVMaXN0IiBpbiB3aW5kb3cgJiYgZGF0YVt4XSBpbnN0YW5jZW9mIEZpbGVMaXN0KXsKCQkJCS8vIEdldCBmaXJzdCByZWNvcmQgb25seQoJCQkJaWYoZGF0YVt4XS5sZW5ndGg9PT0xKXsKCQkJCQlkYXRhW3hdID0gZGF0YVt4XVswXTsKCQkJCX0KCQkJCWVsc2V7CgkJCQkJY29uc29sZS5lcnJvcigiV2Ugd2VyZSBleHBlY3RpbmcgdGhlIEZpbGVMaXN0IHRvIGNvbnRhaW4gb25lIGZpbGUiKTsKCQkJCX0KCQkJfQoJCQllbHNlIGlmKCBkYXRhW3hdIGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCAmJiBkYXRhW3hdLnR5cGUgPT09ICdmaWxlJyApewoJCQkJaWYoICgiZmlsZXMiIGluIGRhdGFbeF0gKSApewoJCQkJCWRhdGFbeF0gPSBkYXRhW3hdLmZpbGVzWzBdOwoJCQkJfQoJCQkJZWxzZXsKCQkJCQkvLyB0aGlzIGRvZXMgbm90IHN1cHBvcnQgSFRNTDUgZm9ybXMgRmlsZUxpc3QKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiggZGF0YVt4XSBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQKCQkJCSYmIGRhdGFbeF0gaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudAoJCQkJJiYgZGF0YVt4XSBpbnN0YW5jZW9mIEhUTUxUZXh0QXJlYUVsZW1lbnQKCQkJCSl7CgkJCQlkYXRhW3hdID0gZGF0YVt4XS52YWx1ZTsKCQkJfQoJCQllbHNlIGlmKCBkYXRhW3hdIGluc3RhbmNlb2YgRWxlbWVudCApewoJCQkJZGF0YVt4XSA9IGRhdGFbeF0uaW5uZXJIVE1MIHx8IGRhdGFbeF0uaW5uZXJUZXh0OwoJCQl9CgkJfQoJfQoKCXAuZGF0YSA9IGRhdGE7CgoJcmV0dXJuIHRydWU7Cn0KCjwvc2NyaXB0PgoKPHNjcmlwdD4KaWYobG9jYWxTdG9yYWdlLmdldEl0ZW0oImFjY2Vzc190b2tlbiIpKXsKCS8vIFRva2VuCgl2YXIgdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYWNjZXNzX3Rva2VuIik7CgoJLy8gTWFrZSBodHRwUmVxdWVzdAoJLy8gUmV0cmlldmUgYWxsIGFsYnVtcyBpbiBTa3lEcml2ZQoJaHR0cFJlcXVlc3QoIkdFVCIsICdodHRwczovL2FwaXMubGl2ZS5uZXQvdjUuMC9tZS9hbGJ1bXM/YWNjZXNzX3Rva2VuPScrdG9rZW4sIG51bGwsIGZ1bmN0aW9uKHIpewoJCS8vIFZhbGlkCgkJaWYoIXJ8fHIuZXJyb3IpewoJCQlhbGVydCgiWW91IGhhdmUgYW4gZXJyb3I6ICIrci5lcnJvci5tZXNzYWdlKTsKCQkJbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImFjY2Vzc190b2tlbiIpOwoJCQlyZXR1cm47CgkJfQoJCS8vIExvb3AgdGhyb3VnaCB0aGUgcmVzdWx0cwoJCWZvcih2YXIgaT0wO2k8ci5kYXRhLmxlbmd0aDtpKyspewoJCQl2YXIgb2JqID0gci5kYXRhW2ldOwoJCQl2YXIgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CgkJCW9wdC52YWx1ZSA9IG9iai51cGxvYWRfbG9jYXRpb247CgkJCW9wdC5pbm5lckhUTUwgPSBvYmoubmFtZTsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdCcpLmFwcGVuZENoaWxkKG9wdCk7CgkJfQoJfSk7Cn0KPC9zY3JpcHQ+",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 03:08:17 GMT",
                    "Content-Length": "15681",
                    "Date": "Fri, 07 Nov 2014 03:08:17 GMT",
                    "Content-Type": "text/html; charset=utf-8"
                },
                "cookies": [],
                "mimeType": "HTML",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}