{
    "url": "http://localhost:9999/v0lkan/o2.js/bower_components/jscover/doc/example-qunit/out/jscoverage.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.search</b> and written to <b>window.open()</b> via the following statements:<ul><li>jscoverage_initTabContents(location.search);</li><li>queryString = queryString.substring(1);</li><li>parameters = queryString.split(/&amp;|;/);</li><li>parameter = parameters[i];</li><li>value = decodeURIComponent(parameter.substr(index + 1));</li><li>windowURL = value;</li><li>window.open(windowURL);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/v0lkan/o2.js/bower_components/jscover/doc/example-qunit/out/jscoverage.js",
                "path": "/v0lkan/o2.js/bower_components/jscover/doc/example-qunit/out/jscoverage.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC92MGxrYW4vbzIuanMvYm93ZXJfY29tcG9uZW50cy9qc2NvdmVyL2RvYy9leGFtcGxlLXF1bml0L291dC9qc2NvdmVyYWdlLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNDMzMzgNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMTk6NTU6NTkgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDE5OjU1OjQ2IEdNVA0KDQovKg0KICAgIGpzY292ZXJhZ2UuanMgLSBjb2RlIGNvdmVyYWdlIGZvciBKYXZhU2NyaXB0DQogICAgQ29weXJpZ2h0IChDKSAyMDA3LCAyMDA4LCAyMDA5LCAyMDEwIHNpbGljb25mb3Jrcy5jb20NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5DQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkNCiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcg0KICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwNCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0KICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUNCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLg0KDQogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcNCiAgICB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBJbmMuLA0KICAgIDUxIEZyYW5rbGluIFN0cmVldCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgMDIxMTAtMTMwMSBVU0EuDQoqLw0KDQovKioNCkluaXRpYWxpemVzIHRoZSBfJGpzY292ZXJhZ2Ugb2JqZWN0IGluIGEgd2luZG93LiAgVGhpcyBzaG91bGQgYmUgdGhlIGZpcnN0DQpmdW5jdGlvbiBjYWxsZWQgaW4gdGhlIHBhZ2UuDQpAcGFyYW0gIHcgIHRoaXMgc2hvdWxkIGFsd2F5cyBiZSB0aGUgZ2xvYmFsIHdpbmRvdyBvYmplY3QNCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2luaXQodykgew0KICB0cnkgew0KICAgIC8vIGluIFNhZmFyaSwgImltcG9ydCIgaXMgYSBzeW50YXggZXJyb3INCiAgICBDb21wb25lbnRzLnV0aWxzWydpbXBvcnQnXSgncmVzb3VyY2U6Ly9hcHAvbW9kdWxlcy9qc2NvdmVyYWdlLmpzbScpOw0KICAgIGpzY292ZXJhZ2VfaXNJbnZlcnRlZE1vZGUgPSB0cnVlOw0KICAgIHJldHVybjsNCiAgfQ0KICBjYXRjaCAoZSkge30NCg0KICAvLyBjaGVjayBpZiB3ZSBhcmUgaW4gaW52ZXJ0ZWQgbW9kZQ0KICBpZiAody5vcGVuZXIpIHsNCiAgICB0cnkgew0KICAgICAgaWYgKHcub3BlbmVyLnRvcC5fJGpzY292ZXJhZ2UpIHsNCiAgICAgICAganNjb3ZlcmFnZV9pc0ludmVydGVkTW9kZSA9IHRydWU7DQogICAgICAgIGlmICghIHcuXyRqc2NvdmVyYWdlKSB7DQogICAgICAgICAgdy5fJGpzY292ZXJhZ2UgPSB3Lm9wZW5lci50b3AuXyRqc2NvdmVyYWdlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBlbHNlIHsNCiAgICAgICAganNjb3ZlcmFnZV9pc0ludmVydGVkTW9kZSA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgdHJ5IHsNCiAgICAgICAgaWYgKHcub3BlbmVyLl8kanNjb3ZlcmFnZSkgew0KICAgICAgICAgIGpzY292ZXJhZ2VfaXNJbnZlcnRlZE1vZGUgPSB0cnVlOw0KICAgICAgICAgIGlmICghIHcuXyRqc2NvdmVyYWdlKSB7DQogICAgICAgICAgICB3Ll8kanNjb3ZlcmFnZSA9IHcub3BlbmVyLl8kanNjb3ZlcmFnZTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAganNjb3ZlcmFnZV9pc0ludmVydGVkTW9kZSA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBjYXRjaCAoZTIpIHsNCiAgICAgICAganNjb3ZlcmFnZV9pc0ludmVydGVkTW9kZSA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICBlbHNlIHsNCiAgICBqc2NvdmVyYWdlX2lzSW52ZXJ0ZWRNb2RlID0gZmFsc2U7DQogIH0NCg0KICBpZiAoISBqc2NvdmVyYWdlX2lzSW52ZXJ0ZWRNb2RlKSB7DQogICAgaWYgKCEgdy5fJGpzY292ZXJhZ2UpIHsNCiAgICAgIHcuXyRqc2NvdmVyYWdlID0ge307DQogICAgfQ0KICB9DQp9DQoNCnZhciBqc2NvdmVyYWdlX2N1cnJlbnRGaWxlID0gbnVsbDsNCnZhciBqc2NvdmVyYWdlX2N1cnJlbnRMaW5lID0gbnVsbDsNCg0KdmFyIGpzY292ZXJhZ2VfaW5MZW5ndGh5T3BlcmF0aW9uID0gZmFsc2U7DQoNCi8qDQpQb3NzaWJsZSBzdGF0ZXM6DQoJCQlpc0ludmVydGVkTW9kZQlpc1NlcnZlcglpc1JlcG9ydAl0YWJzDQpub3JtYWwJCQlmYWxzZQkJZmFsc2UJCWZhbHNlCQlCcm93c2VyDQppbnZlcnRlZAkJdHJ1ZQkJZmFsc2UJCWZhbHNlCQkNCnNlcnZlciwgbm9ybWFsCQlmYWxzZQkJdHJ1ZQkJZmFsc2UJCUJyb3dzZXIsIFN0b3JlDQpzZXJ2ZXIsIGludmVydGVkCXRydWUJCXRydWUJCWZhbHNlCQlTdG9yZQ0KcmVwb3J0CQkJZmFsc2UJCWZhbHNlCQl0cnVlCQkNCiovDQp2YXIganNjb3ZlcmFnZV9pc0ludmVydGVkTW9kZSA9IGZhbHNlOw0KdmFyIGpzY292ZXJhZ2VfaXNTZXJ2ZXIgPSBmYWxzZTsNCnZhciBqc2NvdmVyYWdlX2lzUmVwb3J0ID0gZmFsc2U7DQoNCmpzY292ZXJhZ2VfaW5pdCh3aW5kb3cpOw0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2NyZWF0ZVJlcXVlc3QoKSB7DQogIC8vIE5vdGUgdGhhdCB0aGUgSUU3IFhNTEh0dHBSZXF1ZXN0IGRvZXMgbm90IHN1cHBvcnQgZmlsZSBVUkwncy4NCiAgLy8gaHR0cDovL3hoYWIuYmxvZ3Nwb3QuY29tLzIwMDYvMTEvaWU3LXN1cHBvcnQtZm9yLXhtbGh0dHByZXF1ZXN0Lmh0bWwNCiAgLy8gaHR0cDovL2Jsb2dzLm1zZG4uY29tL2llL2FyY2hpdmUvMjAwNi8xMi8wNi9maWxlLXVyaXMtaW4td2luZG93cy5hc3B4DQovLyNKU0NPVkVSQUdFX0lGDQogIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkgew0KICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKTsNCiAgfQ0KICBlbHNlIHsNCiAgICByZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQogIH0NCn0NCg0KLy8gaHR0cDovL3d3dy5xdWlya3Ntb2RlLm9yZy9qcy9maW5kcG9zLmh0bWwNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfZmluZFBvcyhvYmopIHsNCiAgdmFyIHJlc3VsdCA9IDA7DQogIGRvIHsNCiAgICByZXN1bHQgKz0gb2JqLm9mZnNldFRvcDsNCiAgICBvYmogPSBvYmoub2Zmc2V0UGFyZW50Ow0KICB9DQogIHdoaWxlIChvYmopOw0KICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQovLyBodHRwOi8vd3d3LnF1aXJrc21vZGUub3JnL3ZpZXdwb3J0L2NvbXBhdGliaWxpdHkuaHRtbA0KZnVuY3Rpb24ganNjb3ZlcmFnZV9nZXRWaWV3cG9ydEhlaWdodCgpIHsNCi8vI0pTQ09WRVJBR0VfSUYgL01TSUUvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkNCiAgaWYgKHNlbGYuaW5uZXJIZWlnaHQpIHsNCiAgICAvLyBhbGwgZXhjZXB0IEV4cGxvcmVyDQogICAgcmV0dXJuIHNlbGYuaW5uZXJIZWlnaHQ7DQogIH0NCiAgZWxzZSBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpIHsNCiAgICAvLyBFeHBsb3JlciA2IFN0cmljdCBNb2RlDQogICAgcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7DQogIH0NCiAgZWxzZSBpZiAoZG9jdW1lbnQuYm9keSkgew0KICAgIC8vIG90aGVyIEV4cGxvcmVycw0KICAgIHJldHVybiBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDsNCiAgfQ0KICBlbHNlIHsNCiAgICB0aHJvdyAiQ291bGRuJ3QgY2FsY3VsYXRlIHZpZXdwb3J0IGhlaWdodCI7DQogIH0NCi8vI0pTQ09WRVJBR0VfRU5ESUYNCn0NCg0KLyoqDQpJbmRpY2F0ZXMgdmlzdWFsbHkgdGhhdCBhIGxlbmd0aHkgb3BlcmF0aW9uIGhhcyBiZWd1bi4gIFRoZSBwcm9ncmVzcyBiYXIgaXMNCmRpc3BsYXllZCwgYW5kIHRoZSBjdXJzb3IgaXMgY2hhbmdlZCB0byBidXN5IChvbiBicm93c2VycyB3aGljaCBzdXBwb3J0IHRoaXMpLg0KKi8NCmZ1bmN0aW9uIGpzY292ZXJhZ2VfYmVnaW5MZW5ndGh5T3BlcmF0aW9uKCkgew0KICBqc2NvdmVyYWdlX2luTGVuZ3RoeU9wZXJhdGlvbiA9IHRydWU7DQoNCiAgdmFyIHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQogIHByb2dyZXNzQmFyLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7DQogIFByb2dyZXNzQmFyLnNldFBlcmNlbnRhZ2UocHJvZ3Jlc3NCYXIsIDApOw0KICB2YXIgcHJvZ3Jlc3NMYWJlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0xhYmVsJyk7DQogIHByb2dyZXNzTGFiZWwuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsNCg0KICAvKiBibGFja2xpc3QgYnVnZ3kgYnJvd3NlcnMgKi8NCi8vI0pTQ09WRVJBR0VfSUYNCiAgaWYgKCEgL09wZXJhfFdlYktpdC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KICAgIC8qDQogICAgQ2hhbmdlIHRoZSBjdXJzb3Igc3R5bGUgb2YgZWFjaCBlbGVtZW50LiAgTm90ZSB0aGF0IGNoYW5naW5nIHRoZSBjbGFzcyBvZiB0aGUNCiAgICBlbGVtZW50ICh0byBvbmUgd2l0aCBhIGJ1c3kgY3Vyc29yKSBpcyBidWdneSBpbiBJRS4NCiAgICAqLw0KICAgIHZhciB0YWJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYnMnKS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZGl2Jyk7DQogICAgdmFyIGk7DQogICAgZm9yIChpID0gMDsgaSA8IHRhYnMubGVuZ3RoOyBpKyspIHsNCiAgICAgIHRhYnMuaXRlbShpKS5zdHlsZS5jdXJzb3IgPSAnd2FpdCc7DQogICAgfQ0KICB9DQp9DQoNCi8qKg0KUmVtb3ZlcyB0aGUgcHJvZ3Jlc3MgYmFyIGFuZCBidXN5IGN1cnNvci4NCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2VuZExlbmd0aHlPcGVyYXRpb24oKSB7DQogIHZhciBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KICBQcm9ncmVzc0Jhci5zZXRQZXJjZW50YWdlKHByb2dyZXNzQmFyLCAxMDApOw0KICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgIGpzY292ZXJhZ2VfaW5MZW5ndGh5T3BlcmF0aW9uID0gZmFsc2U7DQogICAgcHJvZ3Jlc3NCYXIuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOw0KICAgIHZhciBwcm9ncmVzc0xhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzTGFiZWwnKTsNCiAgICBwcm9ncmVzc0xhYmVsLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsNCiAgICBwcm9ncmVzc0xhYmVsLmlubmVySFRNTCA9ICcnOw0KDQogICAgdmFyIHRhYnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFicycpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKTsNCiAgICB2YXIgaTsNCiAgICBmb3IgKGkgPSAwOyBpIDwgdGFicy5sZW5ndGg7IGkrKykgew0KICAgICAgdGFicy5pdGVtKGkpLnN0eWxlLmN1cnNvciA9ICcnOw0KICAgIH0NCiAgfSwgNTApOw0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX3NldFNpemUoKSB7DQovLyNKU0NPVkVSQUdFX0lGIC9NU0lFLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpDQogIHZhciB2aWV3cG9ydEhlaWdodCA9IGpzY292ZXJhZ2VfZ2V0Vmlld3BvcnRIZWlnaHQoKTsNCg0KICAvKg0KICBib3JkZXItdG9wLXdpZHRoOiAgICAgMXB4DQogIHBhZGRpbmctdG9wOiAgICAgICAgIDEwcHgNCiAgcGFkZGluZy1ib3R0b206ICAgICAgMTBweA0KICBib3JkZXItYm90dG9tLXdpZHRoOiAgMXB4DQogIG1hcmdpbi1ib3R0b206ICAgICAgIDEwcHgNCiAgICAgICAgICAgICAgICAgICAgICAgLS0tLQ0KICAgICAgICAgICAgICAgICAgICAgICAzMnB4DQogICovDQogIHZhciB0YWJQYWdlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWJQYWdlcycpOw0KICB2YXIgdGFiUGFnZUhlaWdodCA9ICh2aWV3cG9ydEhlaWdodCAtIGpzY292ZXJhZ2VfZmluZFBvcyh0YWJQYWdlcykgLSAzMikgKyAncHgnOw0KICB2YXIgbm9kZUxpc3QgPSB0YWJQYWdlcy5jaGlsZE5vZGVzOw0KICB2YXIgbGVuZ3RoID0gbm9kZUxpc3QubGVuZ3RoOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgdmFyIG5vZGUgPSBub2RlTGlzdC5pdGVtKGkpOw0KICAgIGlmIChub2RlLm5vZGVUeXBlICE9PSAxKSB7DQogICAgICBjb250aW51ZTsNCiAgICB9DQogICAgbm9kZS5zdHlsZS5oZWlnaHQgPSB0YWJQYWdlSGVpZ2h0Ow0KICB9DQoNCiAgdmFyIGlmcmFtZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZnJhbWVEaXYnKTsNCiAgLy8gbWF5IG5vdCBleGlzdCBpZiB3ZSBoYXZlIHJlbW92ZWQgdGhlIGZpcnN0IHRhYg0KICBpZiAoaWZyYW1lRGl2KSB7DQogICAgaWZyYW1lRGl2LnN0eWxlLmhlaWdodCA9ICh2aWV3cG9ydEhlaWdodCAtIGpzY292ZXJhZ2VfZmluZFBvcyhpZnJhbWVEaXYpIC0gMjEpICsgJ3B4JzsNCiAgfQ0KDQogIHZhciBzdW1tYXJ5RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlEaXYnKTsNCiAgc3VtbWFyeURpdi5zdHlsZS5oZWlnaHQgPSAodmlld3BvcnRIZWlnaHQgLSBqc2NvdmVyYWdlX2ZpbmRQb3Moc3VtbWFyeURpdikgLSAyMSkgKyAncHgnOw0KDQogIHZhciBzb3VyY2VEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc291cmNlRGl2Jyk7DQogIHNvdXJjZURpdi5zdHlsZS5oZWlnaHQgPSAodmlld3BvcnRIZWlnaHQgLSBqc2NvdmVyYWdlX2ZpbmRQb3Moc291cmNlRGl2KSAtIDIxKSArICdweCc7DQoNCiAgdmFyIHN0b3JlRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0b3JlRGl2Jyk7DQogIGlmIChzdG9yZURpdikgew0KICAgIHN0b3JlRGl2LnN0eWxlLmhlaWdodCA9ICh2aWV3cG9ydEhlaWdodCAtIGpzY292ZXJhZ2VfZmluZFBvcyhzdG9yZURpdikgLSAyMSkgKyAncHgnOw0KICB9DQovLyNKU0NPVkVSQUdFX0VORElGDQp9DQoNCi8qKg0KUmV0dXJucyB0aGUgYm9vbGVhbiB2YWx1ZSBvZiBhIHN0cmluZy4gIFZhbHVlcyAnZmFsc2UnLCAnZicsICdubycsICduJywgJ29mZicsDQphbmQgJzAnICh1cHBlciBvciBsb3dlciBjYXNlKSBhcmUgZmFsc2UuDQpAcGFyYW0gIHMgIHRoZSBzdHJpbmcNCkByZXR1cm4gIGEgYm9vbGVhbiB2YWx1ZQ0KKi8NCmZ1bmN0aW9uIGpzY292ZXJhZ2VfZ2V0Qm9vbGVhblZhbHVlKHMpIHsNCiAgcyA9IHMudG9Mb3dlckNhc2UoKTsNCiAgaWYgKHMgPT09ICdmYWxzZScgfHwgcyA9PT0gJ2YnIHx8IHMgPT09ICdubycgfHwgcyA9PT0gJ24nIHx8IHMgPT09ICdvZmYnIHx8IHMgPT09ICcwJykgew0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KICByZXR1cm4gdHJ1ZTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9yZW1vdmVUYWIoaWQpIHsNCiAgdmFyIHRhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkICsgJ1RhYicpOw0KICB0YWIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0YWIpOw0KICB2YXIgdGFiUGFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkICsgJ1RhYlBhZ2UnKTsNCiAgdGFiUGFnZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRhYlBhZ2UpOw0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2lzVmFsaWRVUkwodXJsKSB7DQogIC8vIFJGQyAzOTg2DQogIHZhciBtYXRjaGVzID0gL14oKFteOlwvPyNdKyk6KT8oXC9cLyhbXlwvPyNdKikpPyhbXj8jXSopKFw/KFteI10qKSk/KCMoLiopKT8vLmV4ZWModXJsKTsNCiAgaWYgKG1hdGNoZXMgPT09IG51bGwpIHsNCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCiAgdmFyIHNjaGVtZSA9IG1hdGNoZXNbMV07DQogIGlmICh0eXBlb2Ygc2NoZW1lID09PSAnc3RyaW5nJykgew0KICAgIHNjaGVtZSA9IHNjaGVtZS50b0xvd2VyQ2FzZSgpOw0KICAgIHJldHVybiBzY2hlbWUgPT09ICcnIHx8IHNjaGVtZSA9PT0gJ2ZpbGU6JyB8fCBzY2hlbWUgPT09ICdodHRwOicgfHwgc2NoZW1lID09PSAnaHR0cHM6JzsNCiAgfQ0KICByZXR1cm4gdHJ1ZTsNCn0NCg0KLyoqDQpJbml0aWFsaXplcyB0aGUgY29udGVudHMgb2YgdGhlIHRhYnMuICBUaGlzIHNldHMgdGhlIGluaXRpYWwgdmFsdWVzIG9mIHRoZQ0KaW5wdXQgZmllbGQgYW5kIGlmcmFtZSBpbiB0aGUgIkJyb3dzZXIiIHRhYiBhbmQgdGhlIGNoZWNrYm94IGluIHRoZSAiU3VtbWFyeSINCnRhYi4NCkBwYXJhbSAgcXVlcnlTdHJpbmcgIHRoaXMgc2hvdWxkIGFsd2F5cyBiZSBsb2NhdGlvbi5zZWFyY2gNCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2luaXRUYWJDb250ZW50cyhxdWVyeVN0cmluZykgew0KICB2YXIgc2hvd01pc3NpbmdDb2x1bW4gPSBmYWxzZTsNCiAgdmFyIHVybCA9IG51bGw7DQogIHZhciB3aW5kb3dVUkwgPSBudWxsOw0KICB2YXIgcGFyYW1ldGVycywgcGFyYW1ldGVyLCBpLCBpbmRleCwgbmFtZSwgdmFsdWU7DQogIGlmIChxdWVyeVN0cmluZy5sZW5ndGggPiAwKSB7DQogICAgLy8gY2hvcCBvZmYgdGhlIHF1ZXN0aW9uIG1hcmsNCiAgICBxdWVyeVN0cmluZyA9IHF1ZXJ5U3RyaW5nLnN1YnN0cmluZygxKTsNCiAgICBwYXJhbWV0ZXJzID0gcXVlcnlTdHJpbmcuc3BsaXQoLyZ8Oy8pOw0KICAgIGZvciAoaSA9IDA7IGkgPCBwYXJhbWV0ZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICBwYXJhbWV0ZXIgPSBwYXJhbWV0ZXJzW2ldOw0KICAgICAgaW5kZXggPSBwYXJhbWV0ZXIuaW5kZXhPZignPScpOw0KICAgICAgaWYgKGluZGV4ID09PSAtMSkgew0KICAgICAgICAvLyBzdGlsbCB3b3JrcyB3aXRoIG9sZCBzeW50YXgNCiAgICAgICAgdXJsID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcmFtZXRlcik7DQogICAgICB9DQogICAgICBlbHNlIHsNCiAgICAgICAgbmFtZSA9IHBhcmFtZXRlci5zdWJzdHIoMCwgaW5kZXgpOw0KICAgICAgICB2YWx1ZSA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJhbWV0ZXIuc3Vic3RyKGluZGV4ICsgMSkpOw0KICAgICAgICBpZiAobmFtZSA9PT0gJ21pc3NpbmcnIHx8IG5hbWUgPT09ICdtJykgew0KICAgICAgICAgIHNob3dNaXNzaW5nQ29sdW1uID0ganNjb3ZlcmFnZV9nZXRCb29sZWFuVmFsdWUodmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKG5hbWUgPT09ICd1cmwnIHx8IG5hbWUgPT09ICd1JyB8fCBuYW1lID09PSAnZnJhbWUnIHx8IG5hbWUgPT09ICdmJykgew0KICAgICAgICAgIHVybCA9IHZhbHVlOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKG5hbWUgPT09ICd3aW5kb3cnIHx8IG5hbWUgPT09ICd3Jykgew0KICAgICAgICAgIHdpbmRvd1VSTCA9IHZhbHVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgdmFyIGNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoZWNrYm94Jyk7DQogIGNoZWNrYm94LmNoZWNrZWQgPSBzaG93TWlzc2luZ0NvbHVtbjsNCiAgaWYgKHNob3dNaXNzaW5nQ29sdW1uKSB7DQogICAganNjb3ZlcmFnZV9hcHBlbmRNaXNzaW5nQ29sdW1uKCk7DQogIH0NCg0KICB2YXIgaXNWYWxpZFVSTCA9IGZ1bmN0aW9uICh1cmwpIHsNCiAgICB2YXIgcmVzdWx0ID0ganNjb3ZlcmFnZV9pc1ZhbGlkVVJMKHVybCk7DQogICAgaWYgKCEgcmVzdWx0KSB7DQogICAgICBhbGVydCgnSW52YWxpZCBVUkw6ICcgKyB1cmwpOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9Ow0KDQogIGlmICh1cmwgIT09IG51bGwgJiYgaXNWYWxpZFVSTCh1cmwpKSB7DQogICAgLy8gdGhpcyB3aWxsIGF1dG9tYXRpY2FsbHkgcHJvcGFnYXRlIHRvIHRoZSBpbnB1dCBmaWVsZA0KICAgIGZyYW1lc1swXS5sb2NhdGlvbiA9IHVybDsNCiAgfQ0KICBlbHNlIGlmICh3aW5kb3dVUkwgIT09IG51bGwgJiYgaXNWYWxpZFVSTCh3aW5kb3dVUkwpKSB7DQogICAgd2luZG93Lm9wZW4od2luZG93VVJMKTsNCiAgfQ0KDQogIC8vIGlmIHRoZSBicm93c2VyIHRhYiBpcyBhYnNlbnQsIHdlIGhhdmUgdG8gaW5pdGlhbGl6ZSB0aGUgc3VtbWFyeSB0YWINCiAgaWYgKCEgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jyb3dzZXJUYWInKSkgew0KICAgIGpzY292ZXJhZ2VfcmVjYWxjdWxhdGVTdW1tYXJ5VGFiKCk7DQogIH0NCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9ib2R5X2xvYWQoKSB7DQogIHZhciBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KICBQcm9ncmVzc0Jhci5pbml0KHByb2dyZXNzQmFyKTsNCg0KICBmdW5jdGlvbiByZXBvcnRFcnJvcihlKSB7DQogICAganNjb3ZlcmFnZV9lbmRMZW5ndGh5T3BlcmF0aW9uKCk7DQogICAgdmFyIHN1bW1hcnlUaHJvYmJlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5VGhyb2JiZXInKTsNCiAgICBzdW1tYXJ5VGhyb2JiZXIuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOw0KICAgIHZhciBkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeUVycm9yRGl2Jyk7DQogICAgZGl2LmlubmVySFRNTCA9ICdFcnJvcjogJyArIGU7DQogIH0NCg0KICBpZiAoanNjb3ZlcmFnZV9pc1JlcG9ydCkgew0KICAgIGpzY292ZXJhZ2VfYmVnaW5MZW5ndGh5T3BlcmF0aW9uKCk7DQogICAgdmFyIHN1bW1hcnlUaHJvYmJlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5VGhyb2JiZXInKTsNCiAgICBzdW1tYXJ5VGhyb2JiZXIuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsNCiAgICB2YXIgcmVxdWVzdCA9IGpzY292ZXJhZ2VfY3JlYXRlUmVxdWVzdCgpOw0KICAgIHRyeSB7DQogICAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsICdqc2NvdmVyYWdlLmpzb24nLCB0cnVlKTsNCiAgICAgIHJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgIGlmIChyZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHsNCiAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzICE9PSAwICYmIHJlcXVlc3Quc3RhdHVzICE9PSAyMDApIHsNCiAgICAgICAgICAgICAgdGhyb3cgcmVxdWVzdC5zdGF0dXM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSByZXF1ZXN0LnJlc3BvbnNlVGV4dDsNCiAgICAgICAgICAgIGlmIChyZXNwb25zZSA9PT0gJycpIHsNCiAgICAgICAgICAgICAgdGhyb3cgNDA0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIGpzb24gPSBldmFsKCcoJyArIHJlc3BvbnNlICsgJyknKTsNCiAgICAgICAgICAgIHZhciBmaWxlOw0KICAgICAgICAgICAgZm9yIChmaWxlIGluIGpzb24pIHsNCiAgICAgICAgICAgICAgdmFyIGZpbGVDb3ZlcmFnZSA9IGpzb25bZmlsZV07DQogICAgICAgICAgICAgIF8kanNjb3ZlcmFnZVtmaWxlXSA9IHt9Ow0KICAgICAgICAgICAgICBfJGpzY292ZXJhZ2VbZmlsZV0ubGluZURhdGEgPSBmaWxlQ292ZXJhZ2UubGluZURhdGE7DQogICAgICAgICAgICAgIF8kanNjb3ZlcmFnZVtmaWxlXS5icmFuY2hEYXRhID0gY29udmVydEJyYW5jaERhdGFMaW5lc0Zyb21KU09OKGZpbGVDb3ZlcmFnZS5icmFuY2hEYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGpzY292ZXJhZ2VfcmVjYWxjdWxhdGVTdW1tYXJ5VGFiKCk7DQogICAgICAgICAgICBzdW1tYXJ5VGhyb2JiZXIuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgcmVwb3J0RXJyb3IoZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9Ow0KICAgICAgcmVxdWVzdC5zZW5kKG51bGwpOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgcmVwb3J0RXJyb3IoZSk7DQogICAgfQ0KDQogICAganNjb3ZlcmFnZV9yZW1vdmVUYWIoJ2Jyb3dzZXInKTsNCiAgICBqc2NvdmVyYWdlX3JlbW92ZVRhYignc3RvcmUnKTsNCiAgfQ0KICBlbHNlIHsNCiAgICBpZiAoanNjb3ZlcmFnZV9pc0ludmVydGVkTW9kZSkgew0KICAgICAganNjb3ZlcmFnZV9yZW1vdmVUYWIoJ2Jyb3dzZXInKTsNCiAgICB9DQoNCiAgICBpZiAoISBqc2NvdmVyYWdlX2lzU2VydmVyKSB7DQogICAgICBqc2NvdmVyYWdlX3JlbW92ZVRhYignc3RvcmUnKTsNCiAgICB9DQogIH0NCg0KICBqc2NvdmVyYWdlX2luaXRUYWJDb250cm9sKCk7DQoNCiAganNjb3ZlcmFnZV9pbml0VGFiQ29udGVudHMobG9jYXRpb24uc2VhcmNoKTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9ib2R5X3Jlc2l6ZSgpIHsNCiAgaWYgKC9NU0lFLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7DQogICAganNjb3ZlcmFnZV9zZXRTaXplKCk7DQogIH0NCn0NCg0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi8vIHRhYiAxDQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfdXBkYXRlQnJvd3NlcigpIHsNCiAgdmFyIGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvY2F0aW9uIik7DQogIGZyYW1lc1swXS5sb2NhdGlvbiA9IGlucHV0LnZhbHVlOw0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX29wZW5XaW5kb3coKSB7DQogIHZhciBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2NhdGlvbiIpOw0KICB2YXIgdXJsID0gaW5wdXQudmFsdWU7DQogIHdpbmRvdy5vcGVuKHVybCwnanNjb3ZlcmFnZV93aW5kb3cnKTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9pbnB1dF9rZXlwcmVzcyhlKSB7DQogIGlmIChlLmtleUNvZGUgPT09IDEzKSB7DQogICAgaWYgKGUuc2hpZnRLZXkpIHsNCiAgICAgIGpzY292ZXJhZ2Vfb3BlbldpbmRvdygpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgIGpzY292ZXJhZ2VfdXBkYXRlQnJvd3NlcigpOw0KICAgIH0NCiAgfQ0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX29wZW5JbkZyYW1lQnV0dG9uX2NsaWNrKCkgew0KICBqc2NvdmVyYWdlX3VwZGF0ZUJyb3dzZXIoKTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9vcGVuSW5XaW5kb3dCdXR0b25fY2xpY2soKSB7DQogIGpzY292ZXJhZ2Vfb3BlbldpbmRvdygpOw0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2Jyb3dzZXJfbG9hZCgpIHsNCiAgLyogdXBkYXRlIHRoZSBpbnB1dCBib3ggKi8NCiAgdmFyIGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvY2F0aW9uIik7DQoNCiAgLyogc29tZXRpbWVzIElFIHNlZW1zIHRvIGZpcmUgdGhpcyBhZnRlciB0aGUgdGFiIGhhcyBiZWVuIHJlbW92ZWQgKi8NCiAgaWYgKGlucHV0KSB7DQogICAgaW5wdXQudmFsdWUgPSBmcmFtZXNbMF0ubG9jYXRpb247DQogIH0NCn0NCg0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi8vIHRhYiAyDQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfY3JlYXRlSGFuZGxlcihmaWxlLCBsaW5lKSB7DQogIHJldHVybiBmdW5jdGlvbiAoKSB7DQogICAganNjb3ZlcmFnZV9nZXQoZmlsZSwgbGluZSk7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9Ow0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2NyZWF0ZUxpbmsoZmlsZSwgbGluZSkgew0KICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsNCiAgbGluay5ocmVmID0gJyMnOw0KICBsaW5rLm9uY2xpY2sgPSBqc2NvdmVyYWdlX2NyZWF0ZUhhbmRsZXIoZmlsZSwgbGluZSk7DQoNCiAgdmFyIHRleHQ7DQogIGlmIChsaW5lKSB7DQogICAgdGV4dCA9IGxpbmUudG9TdHJpbmcoKTsNCiAgfQ0KICBlbHNlIHsNCiAgICB0ZXh0ID0gZmlsZTsNCiAgfQ0KDQogIGxpbmsuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkpOw0KDQogIHJldHVybiBsaW5rOw0KfQ0KDQp2YXIgc29ydE9yZGVyID0gMDsNCnZhciBzb3J0Q29sdW1uID0gJ0NvdmVyYWdlJzsNCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9yZWNhbGN1bGF0ZVN1bW1hcnlUYWJCeSh0eXBlKSB7DQogIGlmIChzb3J0Q29sdW1uICE9PSB0eXBlKQ0KICAgIHNvcnRPcmRlciA9IDE7DQogIHNvcnRDb2x1bW4gPSB0eXBlOw0KICBqc2NvdmVyYWdlX3JlY2FsY3VsYXRlU3VtbWFyeVRhYihudWxsKTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9yZWNhbGN1bGF0ZVN1bW1hcnlUYWIoY2MpIHsNCiAgdmFyIGNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoZWNrYm94Jyk7DQogIHZhciBzaG93TWlzc2luZ0NvbHVtbiA9IGNoZWNrYm94LmNoZWNrZWQ7DQoNCiAgaWYgKCEgY2MpIHsNCiAgICBjYyA9IHdpbmRvdy5fJGpzY292ZXJhZ2U7DQogIH0NCiAgaWYgKCEgY2MpIHsNCi8vI0pTQ09WRVJBR0VfSUYgMA0KICAgIHRocm93ICJObyBjb3ZlcmFnZSBpbmZvcm1hdGlvbiBmb3VuZC4iOw0KLy8jSlNDT1ZFUkFHRV9FTkRJRg0KICB9DQoNCiAgdmFyIHRvdGFscyA9IHsgZmlsZXM6MCwgc3RhdGVtZW50czowLCBleGVjdXRlZDowLCBicmFuY2hlczowLCBicmFuY2hlc19jb3ZlcmVkOjAgfTsNCg0KICB2YXIgZmlsZTsNCiAgdmFyIGZpbGVzID0gW107DQogIGZvciAoZmlsZSBpbiBjYykgew0KICAgIGZpbGVzLnB1c2goZmlsZSk7DQogIH0NCiAgaWYgKGZpbGVzLmxlbmd0aCA9PT0gMCkNCiAgICByZXR1cm47DQoNCiAgZmlsZXMgPSBnZXRGaWxlc1NvcnRlZEJ5Q292ZXJhZ2UoZmlsZXMpOw0KICBzb3J0T3JkZXIrKzsNCg0KICB2YXIgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3VtbWFyeVRib2R5Iik7DQogIHdoaWxlICh0Ym9keS5oYXNDaGlsZE5vZGVzKCkpIHsNCiAgICB0Ym9keS5yZW1vdmVDaGlsZCh0Ym9keS5maXJzdENoaWxkKTsNCiAgfQ0KDQoNCiAgdmFyIHJvd0NvdW50ZXIgPSAwOw0KICBmb3IgKHZhciBmID0gMDsgZiA8IGZpbGVzLmxlbmd0aDsgZisrKSB7DQogICAgZmlsZSA9IGZpbGVzW2ZdOw0KICAgIHZhciBsaW5lTnVtYmVyOw0KICAgIHZhciBudW1fc3RhdGVtZW50cyA9IDA7DQogICAgdmFyIG51bV9leGVjdXRlZCA9IDA7DQogICAgdmFyIG1pc3NpbmcgPSBbXTsNCiAgICB2YXIgZmlsZUNDID0gY2NbZmlsZV0ubGluZURhdGE7DQogICAgdmFyIGxlbmd0aCA9IGZpbGVDQy5sZW5ndGg7DQogICAgdmFyIGN1cnJlbnRDb25kaXRpb25hbEVuZCA9IDA7DQogICAgdmFyIGNvbmRpdGlvbmFscyA9IG51bGw7DQogICAgaWYgKGZpbGVDQy5jb25kaXRpb25hbHMpIHsNCiAgICAgIGNvbmRpdGlvbmFscyA9IGZpbGVDQy5jb25kaXRpb25hbHM7DQogICAgfQ0KICAgIGZvciAobGluZU51bWJlciA9IDA7IGxpbmVOdW1iZXIgPCBsZW5ndGg7IGxpbmVOdW1iZXIrKykgew0KICAgICAgdmFyIG4gPSBmaWxlQ0NbbGluZU51bWJlcl07DQoNCiAgICAgIGlmIChsaW5lTnVtYmVyID09PSBjdXJyZW50Q29uZGl0aW9uYWxFbmQpIHsNCiAgICAgICAgY3VycmVudENvbmRpdGlvbmFsRW5kID0gMDsNCiAgICAgIH0NCiAgICAgIGVsc2UgaWYgKGN1cnJlbnRDb25kaXRpb25hbEVuZCA9PT0gMCAmJiBjb25kaXRpb25hbHMgJiYgY29uZGl0aW9uYWxzW2xpbmVOdW1iZXJdKSB7DQogICAgICAgIGN1cnJlbnRDb25kaXRpb25hbEVuZCA9IGNvbmRpdGlvbmFsc1tsaW5lTnVtYmVyXTsNCiAgICAgIH0NCg0KICAgICAgaWYgKGN1cnJlbnRDb25kaXRpb25hbEVuZCAhPT0gMCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICAgIH0NCg0KICAgICAgaWYgKG4gPT09IHVuZGVmaW5lZCB8fCBuID09PSBudWxsKSB7DQogICAgICAgIGNvbnRpbnVlOw0KICAgICAgfQ0KDQogICAgICBpZiAobiA9PT0gMCkgew0KICAgICAgICBtaXNzaW5nLnB1c2gobGluZU51bWJlcik7DQogICAgICB9DQogICAgICBlbHNlIHsNCiAgICAgICAgbnVtX2V4ZWN1dGVkKys7DQogICAgICB9DQogICAgICBudW1fc3RhdGVtZW50cysrOw0KICAgIH0NCg0KICAgIHZhciBwZXJjZW50YWdlID0gKCBudW1fc3RhdGVtZW50cyA9PT0gMCA/IDAgOiBwYXJzZUludCgxMDAgKiBudW1fZXhlY3V0ZWQgLyBudW1fc3RhdGVtZW50cykgKTsNCg0KICAgIHZhciBudW1fYnJhbmNoZXMgPSAwOw0KICAgIHZhciBudW1fZXhlY3V0ZWRfYnJhbmNoZXMgPSAwOw0KICAgIHZhciBmaWxlQnJhbmNoQ0MgPSBjY1tmaWxlXS5icmFuY2hEYXRhOw0KICAgIGlmIChmaWxlQnJhbmNoQ0MpIHsNCiAgICAgICAgdmFyIGJyYW5jaExlbmd0aCA9IGZpbGVCcmFuY2hDQy5sZW5ndGg7DQogICAgICAgIGZvciAobGluZU51bWJlciA9IDA7IGxpbmVOdW1iZXIgPCBicmFuY2hMZW5ndGg7IGxpbmVOdW1iZXIrKykgew0KICAgICAgICAgIHZhciBjb25kaXRpb25zID0gZmlsZUJyYW5jaENDW2xpbmVOdW1iZXJdOw0KICAgICAgICAgIHZhciBjb3ZlcmVkID0gdW5kZWZpbmVkOw0KICAgICAgICAgIGlmIChjb25kaXRpb25zICE9PSB1bmRlZmluZWQgJiYgY29uZGl0aW9ucyAhPT0gbnVsbCAmJiBjb25kaXRpb25zLmxlbmd0aCkgew0KICAgICAgICAgICAgICBjb3ZlcmVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgZm9yICh2YXIgY29uZGl0aW9uSW5kZXggPSAwOyBjb25kaXRpb25JbmRleCA8IGNvbmRpdGlvbnMubGVuZ3RoOyBjb25kaXRpb25JbmRleCsrKSB7DQogICAgICAgICAgICAgICAgICB2YXIgYnJhbmNoRGF0YSA9IGZpbGVCcmFuY2hDQ1tsaW5lTnVtYmVyXVtjb25kaXRpb25JbmRleF07DQogICAgICAgICAgICAgICAgICBpZiAoYnJhbmNoRGF0YSA9PT0gdW5kZWZpbmVkIHx8IGJyYW5jaERhdGEgPT09IG51bGwpDQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgbnVtX2JyYW5jaGVzICs9IDI7DQogICAgICAgICAgICAgICAgICBudW1fZXhlY3V0ZWRfYnJhbmNoZXMgKz0gYnJhbmNoRGF0YS5wYXRoc0NvdmVyZWQoKTsNCiAgICAgICAgICAgICAgICAgIGlmICghYnJhbmNoRGF0YS5jb3ZlcmVkKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICBjb3ZlcmVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdmFyIHBlcmNlbnRhZ2VCcmFuY2ggPSAoIG51bV9icmFuY2hlcyA9PT0gMCA/IDAgOiBwYXJzZUludCgxMDAgKiBudW1fZXhlY3V0ZWRfYnJhbmNoZXMgLyBudW1fYnJhbmNoZXMpKTsNCiAgICB9DQoNCg0KICAgIHZhciByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ciIpOw0KICAgIHJvdy5jbGFzc05hbWUgPSAoIHJvd0NvdW50ZXIrKyAlIDIgPT0gMCA/ICJvZGQiIDogImV2ZW4iICk7DQoNCiAgICB2YXIgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7DQogICAgcm93LmlkID0gInJvdy0iK2ZpbGU7DQogICAgY2VsbC5jbGFzc05hbWUgPSAnbGVmdENvbHVtbic7DQogICAgdmFyIGxpbmsgPSBqc2NvdmVyYWdlX2NyZWF0ZUxpbmsoZmlsZSk7DQogICAgY2VsbC5hcHBlbmRDaGlsZChsaW5rKTsNCg0KICAgIHJvdy5hcHBlbmRDaGlsZChjZWxsKTsNCg0KICAgIGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgIGNlbGwuY2xhc3NOYW1lID0gJ251bWVyaWMnOw0KICAgIGNlbGwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobnVtX3N0YXRlbWVudHMpKTsNCiAgICByb3cuYXBwZW5kQ2hpbGQoY2VsbCk7DQoNCiAgICBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICBjZWxsLmNsYXNzTmFtZSA9ICdudW1lcmljJzsNCiAgICBjZWxsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG51bV9leGVjdXRlZCkpOw0KICAgIHJvdy5hcHBlbmRDaGlsZChjZWxsKTsNCg0KICAgIGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgIGNlbGwuY2xhc3NOYW1lID0gJ251bWVyaWMnOw0KICAgIGNlbGwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobnVtX2JyYW5jaGVzKSk7DQogICAgcm93LmFwcGVuZENoaWxkKGNlbGwpOw0KDQogICAgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7DQogICAgY2VsbC5jbGFzc05hbWUgPSAnbnVtZXJpYyc7DQogICAgY2VsbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShudW1fZXhlY3V0ZWRfYnJhbmNoZXMpKTsNCiAgICByb3cuYXBwZW5kQ2hpbGQoY2VsbCk7DQoNCiAgICAvLyBuZXcgY292ZXJhZ2UgdGQgY29udGFpbmluZyBhIGJhciBncmFwaA0KICAgIGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgIGNlbGwuY2xhc3NOYW1lID0gJ2NvdmVyYWdlJzsNCiAgICB2YXIgcGN0R3JhcGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgY292ZXJlZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KICAgICAgICBwY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgcGN0R3JhcGguY2xhc3NOYW1lID0gInBjdEdyYXBoIjsNCiAgICBpZiggbnVtX3N0YXRlbWVudHMgPT09IDAgKSB7DQogICAgICAgIGNvdmVyZWQuY2xhc3NOYW1lID0gInNraXBwZWQiOw0KICAgICAgICBwY3QuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIk4vQSIpKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb3ZlcmVkLmNsYXNzTmFtZSA9ICJjb3ZlcmVkIjsNCiAgICAgICAgY292ZXJlZC5zdHlsZS53aWR0aCA9IHBlcmNlbnRhZ2UgKyAicHgiOw0KICAgICAgICBwY3QuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocGVyY2VudGFnZSArICclJykpOw0KICAgIH0NCiAgICBwY3QuY2xhc3NOYW1lID0gInBjdCI7DQogICAgcGN0R3JhcGguYXBwZW5kQ2hpbGQoY292ZXJlZCk7DQogICAgY2VsbC5hcHBlbmRDaGlsZChwY3RHcmFwaCk7DQogICAgY2VsbC5hcHBlbmRDaGlsZChwY3QpOw0KICAgIHJvdy5hcHBlbmRDaGlsZChjZWxsKTsNCg0KICAgIC8vIG5ldyBjb3ZlcmFnZSB0ZCBjb250YWluaW5nIGEgYnJhbmNoIGJhciBncmFwaA0KICAgIGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgIGNlbGwuY2xhc3NOYW1lID0gJ2NvdmVyYWdlJzsNCiAgICBwY3RHcmFwaCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KICAgICAgICBjb3ZlcmVkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksDQogICAgICAgIHBjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsNCiAgICBwY3RHcmFwaC5jbGFzc05hbWUgPSAicGN0R3JhcGgiOw0KICAgIGlmKGZpbGVCcmFuY2hDQyA9PT0gdW5kZWZpbmVkIHx8IG51bV9icmFuY2hlcyA9PT0gMCApIHsNCiAgICAgICAgY292ZXJlZC5jbGFzc05hbWUgPSAic2tpcHBlZCI7DQogICAgICAgIHBjdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiTi9BIikpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGNvdmVyZWQuY2xhc3NOYW1lID0gImNvdmVyZWQiOw0KICAgICAgICBjb3ZlcmVkLnN0eWxlLndpZHRoID0gcGVyY2VudGFnZUJyYW5jaCArICJweCI7DQogICAgICAgIHBjdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShwZXJjZW50YWdlQnJhbmNoICsgJyUnKSk7DQogICAgfQ0KICAgIHBjdC5jbGFzc05hbWUgPSAicGN0IjsNCiAgICBwY3RHcmFwaC5hcHBlbmRDaGlsZChjb3ZlcmVkKTsNCiAgICBjZWxsLmFwcGVuZENoaWxkKHBjdEdyYXBoKTsNCiAgICBjZWxsLmFwcGVuZENoaWxkKHBjdCk7DQogICAgcm93LmFwcGVuZENoaWxkKGNlbGwpOw0KDQogICAgaWYgKHNob3dNaXNzaW5nQ29sdW1uKSB7DQogICAgICBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWlzc2luZy5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAoaSAhPT0gMCkgew0KICAgICAgICAgIGNlbGwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiwgIikpOw0KICAgICAgICB9DQogICAgICAgIGxpbmsgPSBqc2NvdmVyYWdlX2NyZWF0ZUxpbmsoZmlsZSwgbWlzc2luZ1tpXSk7DQoNCiAgICAgICAgLy8gZ3JvdXAgY29udGlndW91cyBtaXNzaW5nIGxpbmVzOyBlLmcuLCAxMCwgMTEsIDEyIC0+IDEwLTEyDQogICAgICAgIHZhciBqLCBzdGFydCA9IG1pc3NpbmdbaV07DQogICAgICAgIGZvciAoOzspIHsNCiAgICAgICAgICBqID0gMTsNCiAgICAgICAgICB3aGlsZSAoaSArIGogPCBtaXNzaW5nLmxlbmd0aCAmJiBtaXNzaW5nW2kgKyBqXSA9PSBtaXNzaW5nW2ldICsgaikgew0KICAgICAgICAgICAgaisrOw0KICAgICAgICAgIH0NCiAgICAgICAgICB2YXIgbmV4dG1pc3NpbmcgPSBtaXNzaW5nW2kgKyBqXSwgY3VyID0gbWlzc2luZ1tpXSArIGo7DQogICAgICAgICAgaWYgKGlzTmFOKG5leHRtaXNzaW5nKSkgew0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICAgIHdoaWxlIChjdXIgPCBuZXh0bWlzc2luZyAmJiAhIGZpbGVDQ1tjdXJdKSB7DQogICAgICAgICAgICBjdXIrKzsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGN1ciA8IG5leHRtaXNzaW5nIHx8IGN1ciA+PSBsZW5ndGgpIHsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpICs9IGo7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHN0YXJ0ICE9IG1pc3NpbmdbaV0gfHwgaiA+IDEpIHsNCiAgICAgICAgICBpICs9IGogLSAxOw0KICAgICAgICAgIGxpbmsuaW5uZXJIVE1MICs9ICItIiArIG1pc3NpbmdbaV07DQogICAgICAgIH0NCg0KICAgICAgICBjZWxsLmFwcGVuZENoaWxkKGxpbmspOw0KICAgICAgfQ0KICAgICAgcm93LmFwcGVuZENoaWxkKGNlbGwpOw0KICAgIH0NCg0KICAgIHRib2R5LmFwcGVuZENoaWxkKHJvdyk7DQoNCiAgICB0b3RhbHNbJ2ZpbGVzJ10gKys7DQogICAgdG90YWxzWydzdGF0ZW1lbnRzJ10gKz0gbnVtX3N0YXRlbWVudHM7DQogICAgdG90YWxzWydleGVjdXRlZCddICs9IG51bV9leGVjdXRlZDsNCiAgICB0b3RhbHNbJ2JyYW5jaGVzJ10gKz0gbnVtX2JyYW5jaGVzOw0KICAgIHRvdGFsc1snYnJhbmNoZXNfY292ZXJlZCddICs9IG51bV9leGVjdXRlZF9icmFuY2hlczsNCg0KICAgIC8vIHdyaXRlIHRvdGFscyBkYXRhIGludG8gc3VtbWFyeVRvdGFscyByb3cNCiAgICB2YXIgdHIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3VtbWFyeVRvdGFscyIpOw0KICAgIGlmICh0cikgew0KICAgICAgICB2YXIgdGRzID0gdHIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRkIik7DQogICAgICAgIHRkc1swXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic3BhbiIpWzFdLmZpcnN0Q2hpbGQubm9kZVZhbHVlID0gdG90YWxzWydmaWxlcyddOw0KICAgICAgICB0ZHNbMV0uZmlyc3RDaGlsZC5ub2RlVmFsdWUgPSB0b3RhbHNbJ3N0YXRlbWVudHMnXTsNCiAgICAgICAgdGRzWzJdLmZpcnN0Q2hpbGQubm9kZVZhbHVlID0gdG90YWxzWydleGVjdXRlZCddOw0KICAgICAgICB0ZHNbM10uZmlyc3RDaGlsZC5ub2RlVmFsdWUgPSB0b3RhbHNbJ2JyYW5jaGVzJ107DQogICAgICAgIHRkc1s0XS5maXJzdENoaWxkLm5vZGVWYWx1ZSA9IHRvdGFsc1snYnJhbmNoZXNfY292ZXJlZCddOw0KDQogICAgICAgIHZhciBjb3ZlcmFnZSA9IHBhcnNlSW50KDEwMCAqIHRvdGFsc1snZXhlY3V0ZWQnXSAvIHRvdGFsc1snc3RhdGVtZW50cyddKTsNCiAgICAgICAgaWYoIGlzTmFOKCBjb3ZlcmFnZSApICkgew0KICAgICAgICAgICAgY292ZXJhZ2UgPSAwOw0KICAgICAgICB9DQogICAgICAgIHRkc1s1XS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic3BhbiIpWzBdLmZpcnN0Q2hpbGQubm9kZVZhbHVlID0gY292ZXJhZ2UgKyAnJSc7DQogICAgICAgIHRkc1s1XS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiZGl2IilbMV0uc3R5bGUud2lkdGggPSBjb3ZlcmFnZSArICdweCc7DQoNCiAgICAgICAgY292ZXJhZ2UgPSAwOw0KICAgICAgICBpZiAoZmlsZUJyYW5jaENDICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIGNvdmVyYWdlID0gcGFyc2VJbnQoMTAwICogdG90YWxzWydicmFuY2hlc19jb3ZlcmVkJ10gLyB0b3RhbHNbJ2JyYW5jaGVzJ10pOw0KICAgICAgICAgICAgaWYoIGlzTmFOKCBjb3ZlcmFnZSApICkgew0KICAgICAgICAgICAgICAgIGNvdmVyYWdlID0gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICB0ZHNbNl0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNwYW4iKVswXS5maXJzdENoaWxkLm5vZGVWYWx1ZSA9IGNvdmVyYWdlICsgJyUnOw0KICAgICAgICB0ZHNbNl0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoImRpdiIpWzFdLnN0eWxlLndpZHRoID0gY292ZXJhZ2UgKyAncHgnOw0KICAgIH0NCg0KICB9DQogIGpzY292ZXJhZ2VfZW5kTGVuZ3RoeU9wZXJhdGlvbigpOw0KfQ0KDQpmdW5jdGlvbiBnZXRGaWxlc1NvcnRlZEJ5Q292ZXJhZ2UoZmlsZXNJbikgew0KICB2YXIgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3VtbWFyeVRib2R5Iik7DQogIGlmICh0Ym9keS5jaGlsZHJlbi5sZW5ndGggPCAyKSB7DQogICAgc29ydE9yZGVyPTE7DQogICAgcmV0dXJuIGZpbGVzSW47DQogIH0NCiAgdmFyIGZpbGVzID0gW107DQogIGZvciAodmFyIGk9MDtpPHRib2R5LmNoaWxkcmVuLmxlbmd0aDtpKyspIHsNCiAgICBmaWxlc1tpXSA9IHt9Ow0KICAJZmlsZXNbaV0uZmlsZSA9IHRib2R5LmNoaWxkcmVuW2ldLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLmlubmVySFRNTDsNCiAgCWZpbGVzW2ldLnBlcmMgPSBwYXJzZUludCh0Ym9keS5jaGlsZHJlbltpXS5jaGlsZHJlbls1XS5jaGlsZHJlblsxXS5pbm5lckhUTUwsIDEwKTsNCiAgCWZpbGVzW2ldLmJyUGVyYyA9IHBhcnNlSW50KHRib2R5LmNoaWxkcmVuW2ldLmNoaWxkcmVuWzZdLmNoaWxkcmVuWzFdLmlubmVySFRNTCwgMTApOw0KICAgIGlmIChpc05hTihmaWxlc1tpXS5iclBlcmMpKQ0KICAgICAgZmlsZXNbaV0uYnJQZXJjID0gLTE7DQogIH0NCg0KICBpZiAoc29ydE9yZGVyJTM9PT0xKSB7DQogICAgaWYgKHNvcnRDb2x1bW4gPT0gJ0NvdmVyYWdlJykNCiAgICAgIGZpbGVzLnNvcnQoZnVuY3Rpb24oZmlsZTEsZmlsZTIpIHtyZXR1cm4gZmlsZTEucGVyYy1maWxlMi5wZXJjfSk7DQogICAgZWxzZQ0KICAgICAgZmlsZXMuc29ydChmdW5jdGlvbihmaWxlMSxmaWxlMikge3JldHVybiBmaWxlMS5iclBlcmMtZmlsZTIuYnJQZXJjfSk7DQogIH0gZWxzZSBpZiAoc29ydE9yZGVyJTM9PT0yKSB7DQogICAgIGlmIChzb3J0Q29sdW1uID09ICdDb3ZlcmFnZScpDQogICAgICBmaWxlcy5zb3J0KGZ1bmN0aW9uKGZpbGUxLGZpbGUyKSB7cmV0dXJuIGZpbGUyLnBlcmMtZmlsZTEucGVyY30pOw0KICAgICBlbHNlDQogICAgICAgZmlsZXMuc29ydChmdW5jdGlvbihmaWxlMSxmaWxlMikge3JldHVybiBmaWxlMi5iclBlcmMtZmlsZTEuYnJQZXJjfSk7DQogIH0gZWxzZSB7DQogICAgICByZXR1cm4gZmlsZXNJbi5zb3J0KCk7DQogIH0NCiAgdmFyIHJlc3VsdCA9IFtdOw0KICBmb3IgKHZhciBpPTA7aTxmaWxlcy5sZW5ndGg7aSsrKSB7DQogICAgcmVzdWx0W2ldID0gZmlsZXNbaV0uZmlsZTsNCiAgfQ0KICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2FwcGVuZE1pc3NpbmdDb2x1bW4oKSB7DQogIHZhciBoZWFkZXJSb3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhZGVyUm93Jyk7DQogIHZhciBtaXNzaW5nSGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTsNCiAgbWlzc2luZ0hlYWRlci5pZCA9ICdtaXNzaW5nSGVhZGVyJzsNCiAgbWlzc2luZ0hlYWRlci5pbm5lckhUTUwgPSAnPGFiYnIgdGl0bGU9Ikxpc3Qgb2Ygc3RhdGVtZW50cyBtaXNzZWQgZHVyaW5nIGV4ZWN1dGlvbiI+TWlzc2luZzwvYWJicj4nOw0KICBoZWFkZXJSb3cuYXBwZW5kQ2hpbGQobWlzc2luZ0hlYWRlcik7DQogIHZhciBzdW1tYXJ5VG90YWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlUb3RhbHMnKTsNCiAgdmFyIGVtcHR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsNCiAgZW1wdHkuaWQgPSAnbWlzc2luZ0NlbGwnOw0KICBzdW1tYXJ5VG90YWxzLmFwcGVuZENoaWxkKGVtcHR5KTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9yZW1vdmVNaXNzaW5nQ29sdW1uKCkgew0KICB2YXIgbWlzc2luZ05vZGU7DQogIG1pc3NpbmdOb2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pc3NpbmdIZWFkZXInKTsNCiAgbWlzc2luZ05vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChtaXNzaW5nTm9kZSk7DQogIG1pc3NpbmdOb2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pc3NpbmdDZWxsJyk7DQogIG1pc3NpbmdOb2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobWlzc2luZ05vZGUpOw0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2NoZWNrYm94X2NsaWNrKCkgew0KICBpZiAoanNjb3ZlcmFnZV9pbkxlbmd0aHlPcGVyYXRpb24pIHsNCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCiAganNjb3ZlcmFnZV9iZWdpbkxlbmd0aHlPcGVyYXRpb24oKTsNCiAgdmFyIGNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoZWNrYm94Jyk7DQogIHZhciBzaG93TWlzc2luZ0NvbHVtbiA9IGNoZWNrYm94LmNoZWNrZWQ7DQogIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgaWYgKHNob3dNaXNzaW5nQ29sdW1uKSB7DQogICAgICBqc2NvdmVyYWdlX2FwcGVuZE1pc3NpbmdDb2x1bW4oKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICBqc2NvdmVyYWdlX3JlbW92ZU1pc3NpbmdDb2x1bW4oKTsNCiAgICB9DQogICAganNjb3ZlcmFnZV9yZWNhbGN1bGF0ZVN1bW1hcnlUYWIoKTsNCiAgfSwgNTApOw0KICByZXR1cm4gdHJ1ZTsNCn0NCg0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi8vIHRhYiAzDQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfbWFrZVRhYmxlKGxpbmVzKSB7DQogIHZhciBjb3ZlcmFnZSA9IF8kanNjb3ZlcmFnZVtqc2NvdmVyYWdlX2N1cnJlbnRGaWxlXS5saW5lRGF0YTsNCiAgdmFyIGJyYW5jaERhdGEgPSBfJGpzY292ZXJhZ2VbanNjb3ZlcmFnZV9jdXJyZW50RmlsZV0uYnJhbmNoRGF0YTsNCg0KICAvLyB0aGlzIGNhbiBoYXBwZW4gaWYgdGhlcmUgaXMgYW4gZXJyb3IgaW4gdGhlIG9yaWdpbmFsIEphdmFTY3JpcHQgZmlsZQ0KICBpZiAoISBsaW5lcykgew0KICAgIGxpbmVzID0gW107DQogIH0NCg0KICB2YXIgcm93cyA9IFsnPHRhYmxlIGlkPSJzb3VyY2VUYWJsZSI+J107DQogIHZhciBpID0gMDsNCiAgdmFyIHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQogIHZhciB0YWJsZUhUTUw7DQogIHZhciBjdXJyZW50Q29uZGl0aW9uYWxFbmQgPSAwOw0KDQogIGZ1bmN0aW9uIGpvaW5UYWJsZVJvd3MoKSB7DQogICAgdGFibGVIVE1MID0gcm93cy5qb2luKCcnKTsNCiAgICBQcm9ncmVzc0Jhci5zZXRQZXJjZW50YWdlKHByb2dyZXNzQmFyLCA2MCk7DQogICAgLyoNCiAgICBUaGlzIG1heSBiZSBhIGxvbmcgZGVsYXksIHNvIHNldCBhIHRpbWVvdXQgb2YgMTAwIG1zIHRvIG1ha2Ugc3VyZSB0aGUNCiAgICBkaXNwbGF5IGlzIHVwZGF0ZWQuDQogICAgKi8NCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge2FwcGVuZFRhYmxlKGpzY292ZXJhZ2VfY3VycmVudEZpbGUpO30sIDEwMCk7DQogIH0NCg0KICBmdW5jdGlvbiBhcHBlbmRUYWJsZShqc2NvdmVyYWdlX2N1cnJlbnRGaWxlKSB7DQogICAgdmFyIHNvdXJjZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2VEaXYnKTsNCiAgICBzb3VyY2VEaXYuaW5uZXJIVE1MID0gdGFibGVIVE1MOw0KICAgIFByb2dyZXNzQmFyLnNldFBlcmNlbnRhZ2UocHJvZ3Jlc3NCYXIsIDgwKTsNCiAgICBzZXRUaW1lb3V0KGpzY292ZXJhZ2Vfc2Nyb2xsVG9MaW5lLCAwKTsNCiAgfQ0KDQogIHdoaWxlIChpIDwgbGluZXMubGVuZ3RoKSB7DQogICAgdmFyIGxpbmVOdW1iZXIgPSBpICsgMTsNCg0KICAgIGlmIChsaW5lTnVtYmVyID09PSBjdXJyZW50Q29uZGl0aW9uYWxFbmQpIHsNCiAgICAgIGN1cnJlbnRDb25kaXRpb25hbEVuZCA9IDA7DQogICAgfQ0KICAgIGVsc2UgaWYgKGN1cnJlbnRDb25kaXRpb25hbEVuZCA9PT0gMCAmJiBjb3ZlcmFnZS5jb25kaXRpb25hbHMgJiYgY292ZXJhZ2UuY29uZGl0aW9uYWxzW2xpbmVOdW1iZXJdKSB7DQogICAgICBjdXJyZW50Q29uZGl0aW9uYWxFbmQgPSBjb3ZlcmFnZS5jb25kaXRpb25hbHNbbGluZU51bWJlcl07DQogICAgfQ0KDQogICAgdmFyIHJvdyA9ICc8dHI+JzsNCiAgICByb3cgKz0gJzx0ZCBjbGFzcz0ibnVtZXJpYyI+JyArIGxpbmVOdW1iZXIgKyAnPC90ZD4nOw0KICAgIHZhciB0aW1lc0V4ZWN1dGVkID0gY292ZXJhZ2VbbGluZU51bWJlcl07DQogICAgaWYgKHRpbWVzRXhlY3V0ZWQgIT09IHVuZGVmaW5lZCAmJiB0aW1lc0V4ZWN1dGVkICE9PSBudWxsKSB7DQogICAgICBpZiAoY3VycmVudENvbmRpdGlvbmFsRW5kICE9PSAwKSB7DQogICAgICAgIHJvdyArPSAnPHRkIGNsYXNzPSJ5IG51bWVyaWMiPic7DQogICAgICB9DQogICAgICBlbHNlIGlmICh0aW1lc0V4ZWN1dGVkID09PSAwKSB7DQogICAgICAgIHJvdyArPSAnPHRkIGNsYXNzPSJyIG51bWVyaWMiIGlkPSJsaW5lLScgKyBsaW5lTnVtYmVyICsgJyI+JzsNCiAgICAgIH0NCiAgICAgIGVsc2Ugew0KICAgICAgICByb3cgKz0gJzx0ZCBjbGFzcz0iZyBudW1lcmljIj4nOw0KICAgICAgfQ0KICAgICAgcm93ICs9IHRpbWVzRXhlY3V0ZWQ7DQogICAgICByb3cgKz0gJzwvdGQ+JzsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICByb3cgKz0gJzx0ZD48L3RkPic7DQogICAgfQ0KDQogICAgaWYgKF8kanNjb3ZlcmFnZVtqc2NvdmVyYWdlX2N1cnJlbnRGaWxlXS5icmFuY2hEYXRhICE9PSB1bmRlZmluZWQgJiYgXyRqc2NvdmVyYWdlW2pzY292ZXJhZ2VfY3VycmVudEZpbGVdLmJyYW5jaERhdGEubGVuZ3RoICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgdmFyIGJyYW5jaENsYXNzID0gJyc7DQogICAgICAgIHZhciBicmFuY2hUZXh0ID0gJyYjMTYwOyc7DQogICAgICAgIGlmIChicmFuY2hEYXRhW2xpbmVOdW1iZXJdICE9PSB1bmRlZmluZWQgJiYgYnJhbmNoRGF0YVtsaW5lTnVtYmVyXSAhPT0gbnVsbCkgew0KICAgICAgICAgICAgYnJhbmNoQ2xhc3MgPSAnZyc7DQogICAgICAgICAgICBmb3IgKHZhciBjb25kaXRpb25JbmRleCA9IDA7IGNvbmRpdGlvbkluZGV4IDwgYnJhbmNoRGF0YVtsaW5lTnVtYmVyXS5sZW5ndGg7IGNvbmRpdGlvbkluZGV4KyspIHsNCiAgICAgICAgICAgICAgICBpZiAoYnJhbmNoRGF0YVtsaW5lTnVtYmVyXVtjb25kaXRpb25JbmRleF0gIT09IHVuZGVmaW5lZCAmJiBicmFuY2hEYXRhW2xpbmVOdW1iZXJdW2NvbmRpdGlvbkluZGV4XSAhPT0gbnVsbCAmJiAhYnJhbmNoRGF0YVtsaW5lTnVtYmVyXVtjb25kaXRpb25JbmRleF0uY292ZXJlZCgpKSB7DQogICAgICAgICAgICAgICAgICAgIGJyYW5jaENsYXNzID0gJ3InOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYnJhbmNoQ2xhc3MgPT09ICdyJykgew0KICAgICAgICAgICAgYnJhbmNoVGV4dCA9ICc8YSBocmVmPSIjIiBvbmNsaWNrPSJhbGVydChidWlsZEJyYW5jaE1lc3NhZ2UoXyRqc2NvdmVyYWdlW1wnJytqc2NvdmVyYWdlX2N1cnJlbnRGaWxlKydcJ10uYnJhbmNoRGF0YVsnK2xpbmVOdW1iZXIrJ10pKTsiPmluZm88L2E+JzsNCiAgICAgICAgfQ0KICAgICAgICByb3cgKz0gJzx0ZCBjbGFzcz0ibnVtZXJpYyAnK2JyYW5jaENsYXNzKyciPjxwcmU+JyArIGJyYW5jaFRleHQgKyAnPC9wcmU+PC90ZD4nOw0KICAgIH0NCg0KICAgIHJvdyArPSAnPHRkPjxwcmU+JyArIGxpbmVzW2ldICsgJzwvcHJlPjwvdGQ+JzsNCiAgICByb3cgKz0gJzwvdHI+JzsNCiAgICByb3cgKz0gJ1xuJzsNCiAgICByb3dzW2xpbmVOdW1iZXJdID0gcm93Ow0KICAgIGkrKzsNCiAgfQ0KICByb3dzW2kgKyAxXSA9ICc8L3RhYmxlPic7DQogIFByb2dyZXNzQmFyLnNldFBlcmNlbnRhZ2UocHJvZ3Jlc3NCYXIsIDQwKTsNCiAgc2V0VGltZW91dChqb2luVGFibGVSb3dzLCAwKTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9zY3JvbGxUb0xpbmUoKSB7DQogIGpzY292ZXJhZ2Vfc2VsZWN0VGFiKCdzb3VyY2VUYWInKTsNCiAgaWYgKCEgd2luZG93LmpzY292ZXJhZ2VfY3VycmVudExpbmUpIHsNCiAgICBqc2NvdmVyYWdlX2VuZExlbmd0aHlPcGVyYXRpb24oKTsNCiAgICByZXR1cm47DQogIH0NCiAgdmFyIGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2VEaXYnKTsNCiAgaWYgKGpzY292ZXJhZ2VfY3VycmVudExpbmUgPT09IDEpIHsNCiAgICBkaXYuc2Nyb2xsVG9wID0gMDsNCiAgfQ0KICBlbHNlIHsNCiAgICB2YXIgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW5lLScgKyBqc2NvdmVyYWdlX2N1cnJlbnRMaW5lKTsNCg0KICAgIC8vIHRoaXMgbWlnaHQgbm90IGJlIHRoZXJlIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluIHRoZSBvcmlnaW5hbCBKYXZhU2NyaXB0DQogICAgaWYgKGNlbGwpIHsNCiAgICAgIHZhciBkaXZPZmZzZXQgPSBqc2NvdmVyYWdlX2ZpbmRQb3MoZGl2KTsNCiAgICAgIHZhciBjZWxsT2Zmc2V0ID0ganNjb3ZlcmFnZV9maW5kUG9zKGNlbGwpOw0KICAgICAgZGl2LnNjcm9sbFRvcCA9IGNlbGxPZmZzZXQgLSBkaXZPZmZzZXQ7DQogICAgfQ0KICB9DQogIGpzY292ZXJhZ2VfY3VycmVudExpbmUgPSAwOw0KICBqc2NvdmVyYWdlX2VuZExlbmd0aHlPcGVyYXRpb24oKTsNCn0NCg0KLyoqDQpMb2FkcyB0aGUgZ2l2ZW4gZmlsZSAoYW5kIG9wdGlvbmFsIGxpbmUpIGluIHRoZSBzb3VyY2UgdGFiLg0KKi8NCmZ1bmN0aW9uIGpzY292ZXJhZ2VfZ2V0KGZpbGUsIGxpbmUpIHsNCiAgaWYgKGpzY292ZXJhZ2VfaW5MZW5ndGh5T3BlcmF0aW9uKSB7DQogICAgcmV0dXJuOw0KICB9DQogIGpzY292ZXJhZ2VfYmVnaW5MZW5ndGh5T3BlcmF0aW9uKCk7DQogIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgdmFyIHNvdXJjZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2VEaXYnKTsNCiAgICBzb3VyY2VEaXYuaW5uZXJIVE1MID0gJyc7DQogICAganNjb3ZlcmFnZV9zZWxlY3RUYWIoJ3NvdXJjZVRhYicpOw0KICAgIGlmIChmaWxlID09PSBqc2NvdmVyYWdlX2N1cnJlbnRGaWxlKSB7DQogICAgICBqc2NvdmVyYWdlX2N1cnJlbnRMaW5lID0gbGluZTsNCiAgICAgIGpzY292ZXJhZ2VfcmVjYWxjdWxhdGVTb3VyY2VUYWIoKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICBpZiAoanNjb3ZlcmFnZV9jdXJyZW50RmlsZSA9PT0gbnVsbCkgew0KICAgICAgICB2YXIgdGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdXJjZVRhYicpOw0KICAgICAgICB0YWIuY2xhc3NOYW1lID0gJyc7DQogICAgICAgIHRhYi5vbmNsaWNrID0ganNjb3ZlcmFnZV90YWJfY2xpY2s7DQogICAgICB9DQogICAgICBqc2NvdmVyYWdlX2N1cnJlbnRGaWxlID0gZmlsZTsNCiAgICAgIGpzY292ZXJhZ2VfY3VycmVudExpbmUgPSBsaW5lIHx8IDE7ICAvLyB3aGVuIGNoYW5naW5nIHRoZSBzb3VyY2UsIGFsd2F5cyBzY3JvbGwgdG8gdG9wDQogICAgICB2YXIgZmlsZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlRGl2Jyk7DQogICAgICBmaWxlRGl2LmlubmVySFRNTCA9IGpzY292ZXJhZ2VfY3VycmVudEZpbGU7DQogICAgICBqc2NvdmVyYWdlX3JlY2FsY3VsYXRlU291cmNlVGFiKCk7DQogICAgICByZXR1cm47DQogICAgfQ0KICB9LCA1MCk7DQp9DQoNCi8qKg0KQ2FsY3VsYXRlcyBjb3ZlcmFnZSBzdGF0aXN0aWNzIGZvciB0aGUgY3VycmVudCBzb3VyY2UgZmlsZS4NCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX3JlY2FsY3VsYXRlU291cmNlVGFiKCkgew0KICBpZiAoISBqc2NvdmVyYWdlX2N1cnJlbnRGaWxlKSB7DQogICAganNjb3ZlcmFnZV9lbmRMZW5ndGh5T3BlcmF0aW9uKCk7DQogICAgcmV0dXJuOw0KICB9DQogIHZhciBwcm9ncmVzc0xhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzTGFiZWwnKTsNCiAgcHJvZ3Jlc3NMYWJlbC5pbm5lckhUTUwgPSAnQ2FsY3VsYXRpbmcgY292ZXJhZ2UgLi4uJzsNCiAgdmFyIHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7DQogIFByb2dyZXNzQmFyLnNldFBlcmNlbnRhZ2UocHJvZ3Jlc3NCYXIsIDIwKTsNCiAgdmFyIHJlcXVlc3QgPSBqc2NvdmVyYWdlX2NyZWF0ZVJlcXVlc3QoKTsNCiAgdHJ5IHsNCiAgICB2YXIgcmVsYXRpdmVVcmwgPSBqc2NvdmVyYWdlX2N1cnJlbnRGaWxlOw0KICAgIGlmIChyZWxhdGl2ZVVybC5jaGFyQXQoMCkgIT09ICcvJykNCiAgICAgIHJlbGF0aXZlVXJsID0gJy8nICsgcmVsYXRpdmVVcmw7DQogICAgaWYgKCFqc2NvdmVyYWdlX2lzU2VydmVyKQ0KICAgICAgcmVsYXRpdmVVcmwgPSAnb3JpZ2luYWwtc3JjJyArIHJlbGF0aXZlVXJsOw0KICAgIHJlcXVlc3Qub3BlbignR0VUJywgcmVsYXRpdmVVcmwsIHRydWUpOw0KICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcigiTm9JbnN0cnVtZW50IiwgInRydWUiKTsNCiAgICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgaWYgKHJlcXVlc3QucmVhZHlTdGF0ZSA9PT0gNCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyAhPT0gMCAmJiByZXF1ZXN0LnN0YXR1cyAhPT0gMjAwKSB7DQogICAgICAgICAgICB0aHJvdyByZXF1ZXN0LnN0YXR1czsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIHJlc3BvbnNlID0gcmVxdWVzdC5yZXNwb25zZVRleHQ7DQogICAgICAgICAgaWYgKHJlc3BvbnNlID09PSAnJykgew0KICAgICAgICAgICAgdGhyb3cgNDA0Ow0KICAgICAgICAgIH0NCiAgICAgICAgICB2YXIgZGlzcGxheVNvdXJjZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICB2YXIgbGluZXMgPSByZXNwb25zZS5zcGxpdCgvXG4vKTsNCiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgICAgICAgIGxpbmVzW2ldID0ganNjb3ZlcmFnZV9odG1sX2VzY2FwZShsaW5lc1tpXSk7DQogICAgICAgICAgICAgIGpzY292ZXJhZ2VfbWFrZVRhYmxlKGxpbmVzKTsNCiAgICAgICAgICB9DQogICAgICAgICAgc2V0VGltZW91dChkaXNwbGF5U291cmNlLCAwKTsNCiAgICAgICAgICBzdW1tYXJ5VGhyb2JiZXIuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgcmVwb3J0RXJyb3IoZSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9Ow0KICAgIHJlcXVlc3Quc2VuZChudWxsKTsNCiAgfQ0KICBjYXRjaCAoZSkgew0KICAgIHJlcG9ydEVycm9yKGUpOw0KICB9DQp9DQoNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovLyB0YWJzDQoNCi8qKg0KSW5pdGlhbGl6ZXMgdGhlIHRhYiBjb250cm9sLiAgVGhpcyBmdW5jdGlvbiBtdXN0IGJlIGNhbGxlZCB3aGVuIHRoZSBkb2N1bWVudCBpcw0KbG9hZGVkLg0KKi8NCmZ1bmN0aW9uIGpzY292ZXJhZ2VfaW5pdFRhYkNvbnRyb2woKSB7DQogIHZhciB0YWJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYnMnKTsNCiAgdmFyIGk7DQogIHZhciBjaGlsZDsNCiAgdmFyIHRhYk51bSA9IDA7DQogIGZvciAoaSA9IDA7IGkgPCB0YWJzLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsNCiAgICBjaGlsZCA9IHRhYnMuY2hpbGROb2Rlcy5pdGVtKGkpOw0KICAgIGlmIChjaGlsZC5ub2RlVHlwZSA9PT0gMSkgew0KICAgICAgaWYgKGNoaWxkLmNsYXNzTmFtZSAhPT0gJ2Rpc2FibGVkJykgew0KICAgICAgICBjaGlsZC5vbmNsaWNrID0ganNjb3ZlcmFnZV90YWJfY2xpY2s7DQogICAgICB9DQogICAgICB0YWJOdW0rKzsNCiAgICB9DQogIH0NCiAganNjb3ZlcmFnZV9zZWxlY3RUYWIoMCk7DQp9DQoNCi8qKg0KU2VsZWN0cyBhIHRhYi4NCkBwYXJhbSAgdGFiICB0aGUgaW50ZWdlciBpbmRleCBvZiB0aGUgdGFiICgwLCAxLCAyLCBvciAzKQ0KICAgICAgICAgICAgIE9SDQogICAgICAgICAgICAgdGhlIElEIG9mIHRoZSB0YWIgZWxlbWVudA0KICAgICAgICAgICAgIE9SDQogICAgICAgICAgICAgdGhlIHRhYiBlbGVtZW50IGl0c2VsZg0KKi8NCmZ1bmN0aW9uIGpzY292ZXJhZ2Vfc2VsZWN0VGFiKHRhYikgew0KICBpZiAodHlwZW9mIHRhYiAhPT0gJ251bWJlcicpIHsNCiAgICB0YWIgPSBqc2NvdmVyYWdlX3RhYkluZGV4T2YodGFiKTsNCiAgfQ0KICB2YXIgdGFicyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWJzJyk7DQogIHZhciB0YWJQYWdlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWJQYWdlcycpOw0KICB2YXIgbm9kZUxpc3Q7DQogIHZhciB0YWJOdW07DQogIHZhciBpOw0KICB2YXIgbm9kZTsNCg0KICBub2RlTGlzdCA9IHRhYnMuY2hpbGROb2RlczsNCiAgdGFiTnVtID0gMDsNCiAgZm9yIChpID0gMDsgaSA8IG5vZGVMaXN0Lmxlbmd0aDsgaSsrKSB7DQogICAgbm9kZSA9IG5vZGVMaXN0Lml0ZW0oaSk7DQogICAgaWYgKG5vZGUubm9kZVR5cGUgIT09IDEpIHsNCiAgICAgIGNvbnRpbnVlOw0KICAgIH0NCg0KICAgIGlmIChub2RlLmNsYXNzTmFtZSAhPT0gJ2Rpc2FibGVkJykgew0KICAgICAgaWYgKHRhYk51bSA9PT0gdGFiKSB7DQogICAgICAgIG5vZGUuY2xhc3NOYW1lID0gJ3NlbGVjdGVkJzsNCiAgICAgIH0NCiAgICAgIGVsc2Ugew0KICAgICAgICBub2RlLmNsYXNzTmFtZSA9ICcnOw0KICAgICAgfQ0KICAgIH0NCiAgICB0YWJOdW0rKzsNCiAgfQ0KDQogIG5vZGVMaXN0ID0gdGFiUGFnZXMuY2hpbGROb2RlczsNCiAgdGFiTnVtID0gMDsNCiAgZm9yIChpID0gMDsgaSA8IG5vZGVMaXN0Lmxlbmd0aDsgaSsrKSB7DQogICAgbm9kZSA9IG5vZGVMaXN0Lml0ZW0oaSk7DQogICAgaWYgKG5vZGUubm9kZVR5cGUgIT09IDEpIHsNCiAgICAgIGNvbnRpbnVlOw0KICAgIH0NCg0KICAgIGlmICh0YWJOdW0gPT09IHRhYikgew0KICAgICAgbm9kZS5jbGFzc05hbWUgPSAnc2VsZWN0ZWQgVGFiUGFnZSc7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgbm9kZS5jbGFzc05hbWUgPSAnVGFiUGFnZSc7DQogICAgfQ0KICAgIHRhYk51bSsrOw0KICB9DQp9DQoNCi8qKg0KUmV0dXJucyBhbiBpbnRlZ2VyICgwLCAxLCAyLCBvciAzKSByZXByZXNlbnRpbmcgdGhlIGluZGV4IG9mIGEgZ2l2ZW4gdGFiLg0KQHBhcmFtICB0YWIgIHRoZSBJRCBvZiB0aGUgdGFiIGVsZW1lbnQNCiAgICAgICAgICAgICBPUg0KICAgICAgICAgICAgIHRoZSB0YWIgZWxlbWVudCBpdHNlbGYNCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX3RhYkluZGV4T2YodGFiKSB7DQogIGlmICh0eXBlb2YgdGFiID09PSAnc3RyaW5nJykgew0KICAgIHRhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYik7DQogIH0NCiAgdmFyIHRhYnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFicycpOw0KICB2YXIgaTsNCiAgdmFyIGNoaWxkOw0KICB2YXIgdGFiTnVtID0gMDsNCiAgZm9yIChpID0gMDsgaSA8IHRhYnMuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgew0KICAgIGNoaWxkID0gdGFicy5jaGlsZE5vZGVzLml0ZW0oaSk7DQogICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSAxKSB7DQogICAgICBpZiAoY2hpbGQgPT09IHRhYikgew0KICAgICAgICByZXR1cm4gdGFiTnVtOw0KICAgICAgfQ0KICAgICAgdGFiTnVtKys7DQogICAgfQ0KICB9DQovLyNKU0NPVkVSQUdFX0lGIDANCiAgdGhyb3cgIlRhYiBub3QgZm91bmQiOw0KLy8jSlNDT1ZFUkFHRV9FTkRJRg0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX3RhYl9jbGljayhlKSB7DQogIGlmIChqc2NvdmVyYWdlX2luTGVuZ3RoeU9wZXJhdGlvbikgew0KICAgIHJldHVybjsNCiAgfQ0KICB2YXIgdGFyZ2V0Ow0KLy8jSlNDT1ZFUkFHRV9JRg0KICBpZiAoZSkgew0KICAgIHRhcmdldCA9IGUudGFyZ2V0Ow0KICB9DQogIGVsc2UgaWYgKHdpbmRvdy5ldmVudCkgew0KICAgIC8vIElFDQogICAgdGFyZ2V0ID0gd2luZG93LmV2ZW50LnNyY0VsZW1lbnQ7DQogIH0NCiAgaWYgKHRhcmdldC5jbGFzc05hbWUgPT09ICdzZWxlY3RlZCcpIHsNCiAgICByZXR1cm47DQogIH0NCiAganNjb3ZlcmFnZV9iZWdpbkxlbmd0aHlPcGVyYXRpb24oKTsNCiAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICBpZiAodGFyZ2V0LmlkID09PSAnc3VtbWFyeVRhYicpIHsNCiAgICAgIHZhciB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzdW1tYXJ5VGJvZHkiKTsNCiAgICAgIHdoaWxlICh0Ym9keS5oYXNDaGlsZE5vZGVzKCkpIHsNCiAgICAgICAgdGJvZHkucmVtb3ZlQ2hpbGQodGJvZHkuZmlyc3RDaGlsZCk7DQogICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKHRhcmdldC5pZCA9PT0gJ3NvdXJjZVRhYicpIHsNCiAgICAgIHZhciBzb3VyY2VEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc291cmNlRGl2Jyk7DQogICAgICBzb3VyY2VEaXYuaW5uZXJIVE1MID0gJyc7DQogICAgfQ0KICAgIGpzY292ZXJhZ2Vfc2VsZWN0VGFiKHRhcmdldCk7DQogICAgaWYgKHRhcmdldC5pZCA9PT0gJ3N1bW1hcnlUYWInKSB7DQogICAgICBqc2NvdmVyYWdlX3JlY2FsY3VsYXRlU3VtbWFyeVRhYigpOw0KICAgIH0NCiAgICBlbHNlIGlmICh0YXJnZXQuaWQgPT09ICdzb3VyY2VUYWInKSB7DQogICAgICBqc2NvdmVyYWdlX3JlY2FsY3VsYXRlU291cmNlVGFiKCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAganNjb3ZlcmFnZV9lbmRMZW5ndGh5T3BlcmF0aW9uKCk7DQogICAgfQ0KICB9LCA1MCk7DQp9DQoNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovLyBwcm9ncmVzcyBiYXINCg0KdmFyIFByb2dyZXNzQmFyID0gew0KICBpbml0OiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgZWxlbWVudC5fcGVyY2VudGFnZSA9IDA7DQoNCiAgICAvKiBkb2luZyB0aGlzIHZpYSBKYXZhU2NyaXB0IGNyYXNoZXMgU2FmYXJpICovDQovKg0KICAgIHZhciBwY3RHcmFwaCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgIHBjdEdyYXBoLmNsYXNzTmFtZSA9ICdwY3RHcmFwaCc7DQogICAgZWxlbWVudC5hcHBlbmRDaGlsZChwY3RHcmFwaCk7DQogICAgdmFyIGNvdmVyZWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICBjb3ZlcmVkLmNsYXNzTmFtZSA9ICdjb3ZlcmVkJzsNCiAgICBwY3RHcmFwaC5hcHBlbmRDaGlsZChjb3ZlcmVkKTsNCiAgICB2YXIgcGN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOw0KICAgIHBjdC5jbGFzc05hbWUgPSAncGN0JzsNCiAgICBlbGVtZW50LmFwcGVuZENoaWxkKHBjdCk7DQoqLw0KDQogICAgUHJvZ3Jlc3NCYXIuX3VwZGF0ZShlbGVtZW50KTsNCiAgfSwNCiAgc2V0UGVyY2VudGFnZTogZnVuY3Rpb24oZWxlbWVudCwgcGVyY2VudGFnZSkgew0KICAgIGVsZW1lbnQuX3BlcmNlbnRhZ2UgPSBwZXJjZW50YWdlOw0KICAgIFByb2dyZXNzQmFyLl91cGRhdGUoZWxlbWVudCk7DQogIH0sDQogIF91cGRhdGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHsNCiAgICB2YXIgcGN0R3JhcGggPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKS5pdGVtKDApOw0KICAgIHZhciBjb3ZlcmVkID0gcGN0R3JhcGguZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpLml0ZW0oMCk7DQogICAgdmFyIHBjdCA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKS5pdGVtKDApOw0KICAgIHBjdC5pbm5lckhUTUwgPSBlbGVtZW50Ll9wZXJjZW50YWdlLnRvU3RyaW5nKCkgKyAnJSc7DQogICAgY292ZXJlZC5zdHlsZS53aWR0aCA9IGVsZW1lbnQuX3BlcmNlbnRhZ2UgKyAncHgnOw0KICB9DQp9Ow0KDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLy8gcmVwb3J0cw0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX3BhZChzKSB7DQogIHJldHVybiAnMDAwMCcuc3Vic3RyKHMubGVuZ3RoKSArIHM7DQp9DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2Vfc2VyaWFsaXplQ292ZXJhZ2VUb0pTT04oKSB7DQogIHZhciBqc29uID0gW107DQogIGZvciAodmFyIGZpbGUgaW4gXyRqc2NvdmVyYWdlKSB7DQogICAgdmFyIGNvdmVyYWdlID0gXyRqc2NvdmVyYWdlW2ZpbGVdLmxpbmVEYXRhOw0KDQogICAgdmFyIGFycmF5ID0gW107DQogICAgdmFyIGxlbmd0aCA9IGNvdmVyYWdlLmxlbmd0aDsNCiAgICBmb3IgKHZhciBsaW5lID0gMDsgbGluZSA8IGxlbmd0aDsgbGluZSsrKSB7DQogICAgICB2YXIgdmFsdWUgPSBjb3ZlcmFnZVtsaW5lXTsNCiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7DQogICAgICAgIHZhbHVlID0gJ251bGwnOw0KICAgICAgfQ0KICAgICAgYXJyYXkucHVzaCh2YWx1ZSk7DQogICAgfQ0KDQogICAganNvbi5wdXNoKGpzY292ZXJhZ2VfcXVvdGUoZmlsZSkgKyAnOnsibGluZURhdGEiOlsnICsgYXJyYXkuam9pbignLCcpICsgJ10sImJyYW5jaERhdGEiOicgKyBjb252ZXJ0QnJhbmNoRGF0YUxpbmVzVG9KU09OKF8kanNjb3ZlcmFnZVtmaWxlXS5icmFuY2hEYXRhKSArICd9Jyk7DQogIH0NCiAgcmV0dXJuICd7JyArIGpzb24uam9pbignLCcpICsgJ30nOw0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX3N0b3JlQnV0dG9uX2NsaWNrKCkgew0KICBpZiAoanNjb3ZlcmFnZV9pbkxlbmd0aHlPcGVyYXRpb24pIHsNCiAgICByZXR1cm47DQogIH0NCg0KICBqc2NvdmVyYWdlX2JlZ2luTGVuZ3RoeU9wZXJhdGlvbigpOw0KICB2YXIgaW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0b3JlSW1nJyk7DQogIGltZy5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOw0KDQogIHZhciByZXF1ZXN0ID0ganNjb3ZlcmFnZV9jcmVhdGVSZXF1ZXN0KCk7DQogIHJlcXVlc3Qub3BlbignUE9TVCcsICcvanNjb3ZlcmFnZS1zdG9yZScsIHRydWUpOw0KICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uIChldmVudCkgew0KICAgIGlmIChyZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHsNCiAgICAgIHZhciBtZXNzYWdlOw0KICAgICAgdHJ5IHsNCiAgICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzICE9PSAyMDAgJiYgcmVxdWVzdC5zdGF0dXMgIT09IDIwMSAmJiByZXF1ZXN0LnN0YXR1cyAhPT0gMjA0KSB7DQogICAgICAgICAgdGhyb3cgcmVxdWVzdC5zdGF0dXM7DQogICAgICAgIH0NCiAgICAgICAgbWVzc2FnZSA9IHJlcXVlc3QucmVzcG9uc2VUZXh0Ow0KICAgICAgfQ0KICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgaWYgKGUudG9TdHJpbmcoKS5zZWFyY2goL15cZHszfSQvKSA9PT0gMCkgew0KICAgICAgICAgIG1lc3NhZ2UgPSBlICsgJzogJyArIHJlcXVlc3QucmVzcG9uc2VUZXh0Ow0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIG1lc3NhZ2UgPSAnQ291bGQgbm90IGNvbm5lY3QgdG8gc2VydmVyOiAnICsgZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBqc2NvdmVyYWdlX2VuZExlbmd0aHlPcGVyYXRpb24oKTsNCiAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RvcmVJbWcnKTsNCiAgICAgIGltZy5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7DQoNCiAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RvcmVEaXYnKTsNCiAgICAgIGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShuZXcgRGF0ZSgpICsgJzogJyArIG1lc3NhZ2UpKTsNCiAgICAgIGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdicicpKTsNCiAgICB9DQogIH07DQogIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTsNCiAgdmFyIGpzb24gPSBqc2NvdmVyYWdlX3NlcmlhbGl6ZUNvdmVyYWdlVG9KU09OKCk7DQogIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1MZW5ndGgnLCBqc29uLmxlbmd0aC50b1N0cmluZygpKTsNCiAgcmVxdWVzdC5zZW5kKGpzb24pOw0KfQ0KZnVuY3Rpb24ganNjb3ZlcmFnZV9xdW90ZShzKSB7DQogIHJldHVybiAnIicgKyBzLnJlcGxhY2UoL1tcdTAwMDAtXHUwMDFmIlxcXHUwMDdmLVx1ZmZmZl0vZywgZnVuY3Rpb24gKGMpIHsNCiAgICBzd2l0Y2ggKGMpIHsNCiAgICBjYXNlICdcYic6DQogICAgICByZXR1cm4gJ1xcYic7DQogICAgY2FzZSAnXGYnOg0KICAgICAgcmV0dXJuICdcXGYnOw0KICAgIGNhc2UgJ1xuJzoNCiAgICAgIHJldHVybiAnXFxuJzsNCiAgICBjYXNlICdccic6DQogICAgICByZXR1cm4gJ1xccic7DQogICAgY2FzZSAnXHQnOg0KICAgICAgcmV0dXJuICdcXHQnOw0KICAgIC8vIElFIGRvZXNuJ3Qgc3VwcG9ydCB0aGlzDQogICAgLyoNCiAgICBjYXNlICdcdic6DQogICAgICByZXR1cm4gJ1xcdic7DQogICAgKi8NCiAgICBjYXNlICciJzoNCiAgICAgIHJldHVybiAnXFwiJzsNCiAgICBjYXNlICdcXCc6DQogICAgICByZXR1cm4gJ1xcXFwnOw0KICAgIGRlZmF1bHQ6DQogICAgICByZXR1cm4gJ1xcdScgKyBqc2NvdmVyYWdlX3BhZChjLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKTsNCiAgICB9DQogIH0pICsgJyInOw0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2h0bWxfZXNjYXBlKHMpIHsNCiAgICByZXR1cm4gcy5yZXBsYWNlKC9bPD5cJlwiXCddL2csIGZ1bmN0aW9uKGMpIHsNCiAgICByZXR1cm4gJyYjJyArIGMuY2hhckNvZGVBdCgwKSArICc7JzsNCiAgfSk7DQp9DQpmdW5jdGlvbiBCcmFuY2hEYXRhKCkgew0KICAgIHRoaXMucG9zaXRpb24gPSAtMTsNCiAgICB0aGlzLm5vZGVMZW5ndGggPSAtMTsNCiAgICB0aGlzLnNyYyA9IG51bGw7DQogICAgdGhpcy5ldmFsRmFsc2UgPSAwOw0KICAgIHRoaXMuZXZhbFRydWUgPSAwOw0KDQogICAgdGhpcy5pbml0ID0gZnVuY3Rpb24ocG9zaXRpb24sIG5vZGVMZW5ndGgsIHNyYykgew0KICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247DQogICAgICAgIHRoaXMubm9kZUxlbmd0aCA9IG5vZGVMZW5ndGg7DQogICAgICAgIHRoaXMuc3JjID0gc3JjOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICB0aGlzLnJhbkNvbmRpdGlvbiA9IGZ1bmN0aW9uKHJlc3VsdCkgew0KICAgICAgICBpZiAocmVzdWx0KQ0KICAgICAgICAgICAgdGhpcy5ldmFsVHJ1ZSsrOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICB0aGlzLmV2YWxGYWxzZSsrOw0KICAgIH07DQoNCiAgICB0aGlzLnBhdGhzQ292ZXJlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgcGF0aHMgPSAwOw0KICAgICAgICBpZiAodGhpcy5ldmFsVHJ1ZSA+IDApDQogICAgICAgICAgcGF0aHMrKzsNCiAgICAgICAgaWYgKHRoaXMuZXZhbEZhbHNlID4gMCkNCiAgICAgICAgICBwYXRocysrOw0KICAgICAgICByZXR1cm4gcGF0aHM7DQogICAgfTsNCg0KICAgIHRoaXMuY292ZXJlZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5ldmFsVHJ1ZSA+IDAgJiYgdGhpcy5ldmFsRmFsc2UgPiAwOw0KICAgIH07DQoNCiAgICB0aGlzLnRvSlNPTiA9IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gJ3sicG9zaXRpb24iOicgKyB0aGlzLnBvc2l0aW9uDQogICAgICAgICAgICArICcsIm5vZGVMZW5ndGgiOicgKyB0aGlzLm5vZGVMZW5ndGgNCiAgICAgICAgICAgICsgJywic3JjIjonICsganNjb3ZlcmFnZV9xdW90ZSh0aGlzLnNyYykNCiAgICAgICAgICAgICsgJywiZXZhbEZhbHNlIjonICsgdGhpcy5ldmFsRmFsc2UNCiAgICAgICAgICAgICsgJywiZXZhbFRydWUiOicgKyB0aGlzLmV2YWxUcnVlICsgJ30nOw0KICAgIH07DQoNCiAgICB0aGlzLm1lc3NhZ2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaWYgKHRoaXMuZXZhbFRydWUgPT09IDAgJiYgdGhpcy5ldmFsRmFsc2UgPT09IDApDQogICAgICAgICAgICByZXR1cm4gJ0NvbmRpdGlvbiBuZXZlciBldmFsdWF0ZWQgICAgICAgICA6XHQnICsgdGhpcy5zcmM7DQogICAgICAgIGVsc2UgaWYgKHRoaXMuZXZhbFRydWUgPT09IDApDQogICAgICAgICAgICByZXR1cm4gJ0NvbmRpdGlvbiBuZXZlciBldmFsdWF0ZWQgdG8gdHJ1ZSA6XHQnICsgdGhpcy5zcmM7DQogICAgICAgIGVsc2UgaWYgKHRoaXMuZXZhbEZhbHNlID09PSAwKQ0KICAgICAgICAgICAgcmV0dXJuICdDb25kaXRpb24gbmV2ZXIgZXZhbHVhdGVkIHRvIGZhbHNlOlx0JyArIHRoaXMuc3JjOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gJ0NvbmRpdGlvbiBjb3ZlcmVkJzsNCiAgICB9Ow0KfQ0KDQpCcmFuY2hEYXRhLmZyb21Kc29uID0gZnVuY3Rpb24oanNvblN0cmluZykgew0KICAgIHZhciBqc29uID0gZXZhbCgnKCcgKyBqc29uU3RyaW5nICsgJyknKTsNCiAgICB2YXIgYnJhbmNoRGF0YSA9IG5ldyBCcmFuY2hEYXRhKCk7DQogICAgYnJhbmNoRGF0YS5pbml0KGpzb24ucG9zaXRpb24sIGpzb24ubm9kZUxlbmd0aCwganNvbi5zcmMpOw0KICAgIGJyYW5jaERhdGEuZXZhbEZhbHNlID0ganNvbi5ldmFsRmFsc2U7DQogICAgYnJhbmNoRGF0YS5ldmFsVHJ1ZSA9IGpzb24uZXZhbFRydWU7DQogICAgcmV0dXJuIGJyYW5jaERhdGE7DQp9Ow0KDQpCcmFuY2hEYXRhLmZyb21Kc29uT2JqZWN0ID0gZnVuY3Rpb24oanNvbikgew0KICAgIHZhciBicmFuY2hEYXRhID0gbmV3IEJyYW5jaERhdGEoKTsNCiAgICBicmFuY2hEYXRhLmluaXQoanNvbi5wb3NpdGlvbiwganNvbi5ub2RlTGVuZ3RoLCBqc29uLnNyYyk7DQogICAgYnJhbmNoRGF0YS5ldmFsRmFsc2UgPSBqc29uLmV2YWxGYWxzZTsNCiAgICBicmFuY2hEYXRhLmV2YWxUcnVlID0ganNvbi5ldmFsVHJ1ZTsNCiAgICByZXR1cm4gYnJhbmNoRGF0YTsNCn07DQoNCmZ1bmN0aW9uIGJ1aWxkQnJhbmNoTWVzc2FnZShjb25kaXRpb25zKSB7DQogICAgdmFyIG1lc3NhZ2UgPSAnVGhlIGZvbGxvd2luZyB3YXMgbm90IGNvdmVyZWQ6JzsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbmRpdGlvbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKGNvbmRpdGlvbnNbaV0gIT09IHVuZGVmaW5lZCAmJiBjb25kaXRpb25zW2ldICE9PSBudWxsICYmICFjb25kaXRpb25zW2ldLmNvdmVyZWQoKSkNCiAgICAgICAgICBtZXNzYWdlICs9ICdcbi0gJysgY29uZGl0aW9uc1tpXS5tZXNzYWdlKCk7DQogICAgfQ0KICAgIHJldHVybiBtZXNzYWdlOw0KfTsNCg0KZnVuY3Rpb24gY29udmVydEJyYW5jaERhdGFDb25kaXRpb25BcnJheVRvSlNPTihicmFuY2hEYXRhQ29uZGl0aW9uQXJyYXkpIHsNCiAgICB2YXIgYXJyYXkgPSBbXTsNCiAgICB2YXIgbGVuZ3RoID0gYnJhbmNoRGF0YUNvbmRpdGlvbkFycmF5Lmxlbmd0aDsNCiAgICBmb3IgKHZhciBjb25kaXRpb24gPSAwOyBjb25kaXRpb24gPCBsZW5ndGg7IGNvbmRpdGlvbisrKSB7DQogICAgICAgIHZhciBicmFuY2hEYXRhT2JqZWN0ID0gYnJhbmNoRGF0YUNvbmRpdGlvbkFycmF5W2NvbmRpdGlvbl07DQogICAgICAgIGlmIChicmFuY2hEYXRhT2JqZWN0ID09PSB1bmRlZmluZWQgfHwgYnJhbmNoRGF0YU9iamVjdCA9PT0gbnVsbCkgew0KICAgICAgICAgICAgdmFsdWUgPSAnbnVsbCc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB2YWx1ZSA9IGJyYW5jaERhdGFPYmplY3QudG9KU09OKCk7DQogICAgICAgIH0NCiAgICAgICAgYXJyYXkucHVzaCh2YWx1ZSk7DQogICAgfQ0KICAgIHJldHVybiAnWycgKyBhcnJheS5qb2luKCcsJykgKyAnXSc7DQp9DQoNCmZ1bmN0aW9uIGNvbnZlcnRCcmFuY2hEYXRhTGluZXNUb0pTT04oYnJhbmNoRGF0YSkgew0KICAgIGlmIChicmFuY2hEYXRhID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgcmV0dXJuICdbXScNCiAgICB9DQogICAgdmFyIGFycmF5ID0gW107DQogICAgdmFyIGxlbmd0aCA9IGJyYW5jaERhdGEubGVuZ3RoOw0KICAgIGZvciAodmFyIGxpbmUgPSAwOyBsaW5lIDwgbGVuZ3RoOyBsaW5lKyspIHsNCiAgICAgICAgdmFyIGJyYW5jaERhdGFPYmplY3QgPSBicmFuY2hEYXRhW2xpbmVdOw0KICAgICAgICBpZiAoYnJhbmNoRGF0YU9iamVjdCA9PT0gdW5kZWZpbmVkIHx8IGJyYW5jaERhdGFPYmplY3QgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHZhbHVlID0gJ251bGwnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdmFsdWUgPSBjb252ZXJ0QnJhbmNoRGF0YUNvbmRpdGlvbkFycmF5VG9KU09OKGJyYW5jaERhdGFPYmplY3QpOw0KICAgICAgICB9DQogICAgICAgIGFycmF5LnB1c2godmFsdWUpOw0KICAgIH0NCiAgICByZXR1cm4gJ1snICsgYXJyYXkuam9pbignLCcpICsgJ10nOw0KfQ0KDQpmdW5jdGlvbiBjb252ZXJ0QnJhbmNoRGF0YUxpbmVzRnJvbUpTT04oanNvbk9iamVjdCkgew0KICAgIGlmIChqc29uT2JqZWN0ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCiAgICB2YXIgbGVuZ3RoID0ganNvbk9iamVjdC5sZW5ndGg7DQogICAgZm9yICh2YXIgbGluZSA9IDA7IGxpbmUgPCBsZW5ndGg7IGxpbmUrKykgew0KICAgICAgICB2YXIgYnJhbmNoRGF0YUpTT04gPSBqc29uT2JqZWN0W2xpbmVdOw0KICAgICAgICBpZiAoYnJhbmNoRGF0YUpTT04gIT09IG51bGwpIHsNCiAgICAgICAgICAgIGZvciAodmFyIGNvbmRpdGlvbkluZGV4ID0gMDsgY29uZGl0aW9uSW5kZXggPCBicmFuY2hEYXRhSlNPTi5sZW5ndGg7IGNvbmRpdGlvbkluZGV4ICsrKSB7DQogICAgICAgICAgICAgICAgdmFyIGNvbmRpdGlvbiA9IGJyYW5jaERhdGFKU09OW2NvbmRpdGlvbkluZGV4XTsNCiAgICAgICAgICAgICAgICBpZiAoY29uZGl0aW9uICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGJyYW5jaERhdGFKU09OW2NvbmRpdGlvbkluZGV4XSA9IEJyYW5jaERhdGEuZnJvbUpzb25PYmplY3QoY29uZGl0aW9uKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGpzb25PYmplY3Q7DQp9DQo=",
                "body": "LyoNCiAgICBqc2NvdmVyYWdlLmpzIC0gY29kZSBjb3ZlcmFnZSBmb3IgSmF2YVNjcmlwdA0KICAgIENvcHlyaWdodCAoQykgMjAwNywgMjAwOCwgMjAwOSwgMjAxMCBzaWxpY29uZm9ya3MuY29tDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nDQogICAgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgSW5jLiwNCiAgICA1MSBGcmFua2xpbiBTdHJlZXQsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBLg0KKi8NCg0KLyoqDQpJbml0aWFsaXplcyB0aGUgXyRqc2NvdmVyYWdlIG9iamVjdCBpbiBhIHdpbmRvdy4gIFRoaXMgc2hvdWxkIGJlIHRoZSBmaXJzdA0KZnVuY3Rpb24gY2FsbGVkIGluIHRoZSBwYWdlLg0KQHBhcmFtICB3ICB0aGlzIHNob3VsZCBhbHdheXMgYmUgdGhlIGdsb2JhbCB3aW5kb3cgb2JqZWN0DQoqLw0KZnVuY3Rpb24ganNjb3ZlcmFnZV9pbml0KHcpIHsNCiAgdHJ5IHsNCiAgICAvLyBpbiBTYWZhcmksICJpbXBvcnQiIGlzIGEgc3ludGF4IGVycm9yDQogICAgQ29tcG9uZW50cy51dGlsc1snaW1wb3J0J10oJ3Jlc291cmNlOi8vYXBwL21vZHVsZXMvanNjb3ZlcmFnZS5qc20nKTsNCiAgICBqc2NvdmVyYWdlX2lzSW52ZXJ0ZWRNb2RlID0gdHJ1ZTsNCiAgICByZXR1cm47DQogIH0NCiAgY2F0Y2ggKGUpIHt9DQoNCiAgLy8gY2hlY2sgaWYgd2UgYXJlIGluIGludmVydGVkIG1vZGUNCiAgaWYgKHcub3BlbmVyKSB7DQogICAgdHJ5IHsNCiAgICAgIGlmICh3Lm9wZW5lci50b3AuXyRqc2NvdmVyYWdlKSB7DQogICAgICAgIGpzY292ZXJhZ2VfaXNJbnZlcnRlZE1vZGUgPSB0cnVlOw0KICAgICAgICBpZiAoISB3Ll8kanNjb3ZlcmFnZSkgew0KICAgICAgICAgIHcuXyRqc2NvdmVyYWdlID0gdy5vcGVuZXIudG9wLl8kanNjb3ZlcmFnZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgIGpzY292ZXJhZ2VfaXNJbnZlcnRlZE1vZGUgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmICh3Lm9wZW5lci5fJGpzY292ZXJhZ2UpIHsNCiAgICAgICAgICBqc2NvdmVyYWdlX2lzSW52ZXJ0ZWRNb2RlID0gdHJ1ZTsNCiAgICAgICAgICBpZiAoISB3Ll8kanNjb3ZlcmFnZSkgew0KICAgICAgICAgICAgdy5fJGpzY292ZXJhZ2UgPSB3Lm9wZW5lci5fJGpzY292ZXJhZ2U7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGpzY292ZXJhZ2VfaXNJbnZlcnRlZE1vZGUgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgY2F0Y2ggKGUyKSB7DQogICAgICAgIGpzY292ZXJhZ2VfaXNJbnZlcnRlZE1vZGUgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQogIH0NCiAgZWxzZSB7DQogICAganNjb3ZlcmFnZV9pc0ludmVydGVkTW9kZSA9IGZhbHNlOw0KICB9DQoNCiAgaWYgKCEganNjb3ZlcmFnZV9pc0ludmVydGVkTW9kZSkgew0KICAgIGlmICghIHcuXyRqc2NvdmVyYWdlKSB7DQogICAgICB3Ll8kanNjb3ZlcmFnZSA9IHt9Ow0KICAgIH0NCiAgfQ0KfQ0KDQp2YXIganNjb3ZlcmFnZV9jdXJyZW50RmlsZSA9IG51bGw7DQp2YXIganNjb3ZlcmFnZV9jdXJyZW50TGluZSA9IG51bGw7DQoNCnZhciBqc2NvdmVyYWdlX2luTGVuZ3RoeU9wZXJhdGlvbiA9IGZhbHNlOw0KDQovKg0KUG9zc2libGUgc3RhdGVzOg0KCQkJaXNJbnZlcnRlZE1vZGUJaXNTZXJ2ZXIJaXNSZXBvcnQJdGFicw0Kbm9ybWFsCQkJZmFsc2UJCWZhbHNlCQlmYWxzZQkJQnJvd3Nlcg0KaW52ZXJ0ZWQJCXRydWUJCWZhbHNlCQlmYWxzZQkJDQpzZXJ2ZXIsIG5vcm1hbAkJZmFsc2UJCXRydWUJCWZhbHNlCQlCcm93c2VyLCBTdG9yZQ0Kc2VydmVyLCBpbnZlcnRlZAl0cnVlCQl0cnVlCQlmYWxzZQkJU3RvcmUNCnJlcG9ydAkJCWZhbHNlCQlmYWxzZQkJdHJ1ZQkJDQoqLw0KdmFyIGpzY292ZXJhZ2VfaXNJbnZlcnRlZE1vZGUgPSBmYWxzZTsNCnZhciBqc2NvdmVyYWdlX2lzU2VydmVyID0gZmFsc2U7DQp2YXIganNjb3ZlcmFnZV9pc1JlcG9ydCA9IGZhbHNlOw0KDQpqc2NvdmVyYWdlX2luaXQod2luZG93KTsNCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9jcmVhdGVSZXF1ZXN0KCkgew0KICAvLyBOb3RlIHRoYXQgdGhlIElFNyBYTUxIdHRwUmVxdWVzdCBkb2VzIG5vdCBzdXBwb3J0IGZpbGUgVVJMJ3MuDQogIC8vIGh0dHA6Ly94aGFiLmJsb2dzcG90LmNvbS8yMDA2LzExL2llNy1zdXBwb3J0LWZvci14bWxodHRwcmVxdWVzdC5odG1sDQogIC8vIGh0dHA6Ly9ibG9ncy5tc2RuLmNvbS9pZS9hcmNoaXZlLzIwMDYvMTIvMDYvZmlsZS11cmlzLWluLXdpbmRvd3MuYXNweA0KLy8jSlNDT1ZFUkFHRV9JRg0KICBpZiAod2luZG93LkFjdGl2ZVhPYmplY3QpIHsNCiAgICByZXR1cm4gbmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIik7DQogIH0NCiAgZWxzZSB7DQogICAgcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICB9DQp9DQoNCi8vIGh0dHA6Ly93d3cucXVpcmtzbW9kZS5vcmcvanMvZmluZHBvcy5odG1sDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2ZpbmRQb3Mob2JqKSB7DQogIHZhciByZXN1bHQgPSAwOw0KICBkbyB7DQogICAgcmVzdWx0ICs9IG9iai5vZmZzZXRUb3A7DQogICAgb2JqID0gb2JqLm9mZnNldFBhcmVudDsNCiAgfQ0KICB3aGlsZSAob2JqKTsNCiAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KLy8gaHR0cDovL3d3dy5xdWlya3Ntb2RlLm9yZy92aWV3cG9ydC9jb21wYXRpYmlsaXR5Lmh0bWwNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfZ2V0Vmlld3BvcnRIZWlnaHQoKSB7DQovLyNKU0NPVkVSQUdFX0lGIC9NU0lFLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpDQogIGlmIChzZWxmLmlubmVySGVpZ2h0KSB7DQogICAgLy8gYWxsIGV4Y2VwdCBFeHBsb3Jlcg0KICAgIHJldHVybiBzZWxmLmlubmVySGVpZ2h0Ow0KICB9DQogIGVsc2UgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7DQogICAgLy8gRXhwbG9yZXIgNiBTdHJpY3QgTW9kZQ0KICAgIHJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0Ow0KICB9DQogIGVsc2UgaWYgKGRvY3VtZW50LmJvZHkpIHsNCiAgICAvLyBvdGhlciBFeHBsb3JlcnMNCiAgICByZXR1cm4gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7DQogIH0NCiAgZWxzZSB7DQogICAgdGhyb3cgIkNvdWxkbid0IGNhbGN1bGF0ZSB2aWV3cG9ydCBoZWlnaHQiOw0KICB9DQovLyNKU0NPVkVSQUdFX0VORElGDQp9DQoNCi8qKg0KSW5kaWNhdGVzIHZpc3VhbGx5IHRoYXQgYSBsZW5ndGh5IG9wZXJhdGlvbiBoYXMgYmVndW4uICBUaGUgcHJvZ3Jlc3MgYmFyIGlzDQpkaXNwbGF5ZWQsIGFuZCB0aGUgY3Vyc29yIGlzIGNoYW5nZWQgdG8gYnVzeSAob24gYnJvd3NlcnMgd2hpY2ggc3VwcG9ydCB0aGlzKS4NCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2JlZ2luTGVuZ3RoeU9wZXJhdGlvbigpIHsNCiAganNjb3ZlcmFnZV9pbkxlbmd0aHlPcGVyYXRpb24gPSB0cnVlOw0KDQogIHZhciBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KICBwcm9ncmVzc0Jhci5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOw0KICBQcm9ncmVzc0Jhci5zZXRQZXJjZW50YWdlKHByb2dyZXNzQmFyLCAwKTsNCiAgdmFyIHByb2dyZXNzTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NMYWJlbCcpOw0KICBwcm9ncmVzc0xhYmVsLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7DQoNCiAgLyogYmxhY2tsaXN0IGJ1Z2d5IGJyb3dzZXJzICovDQovLyNKU0NPVkVSQUdFX0lGDQogIGlmICghIC9PcGVyYXxXZWJLaXQvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsNCiAgICAvKg0KICAgIENoYW5nZSB0aGUgY3Vyc29yIHN0eWxlIG9mIGVhY2ggZWxlbWVudC4gIE5vdGUgdGhhdCBjaGFuZ2luZyB0aGUgY2xhc3Mgb2YgdGhlDQogICAgZWxlbWVudCAodG8gb25lIHdpdGggYSBidXN5IGN1cnNvcikgaXMgYnVnZ3kgaW4gSUUuDQogICAgKi8NCiAgICB2YXIgdGFicyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWJzJykuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpOw0KICAgIHZhciBpOw0KICAgIGZvciAoaSA9IDA7IGkgPCB0YWJzLmxlbmd0aDsgaSsrKSB7DQogICAgICB0YWJzLml0ZW0oaSkuc3R5bGUuY3Vyc29yID0gJ3dhaXQnOw0KICAgIH0NCiAgfQ0KfQ0KDQovKioNClJlbW92ZXMgdGhlIHByb2dyZXNzIGJhciBhbmQgYnVzeSBjdXJzb3IuDQoqLw0KZnVuY3Rpb24ganNjb3ZlcmFnZV9lbmRMZW5ndGh5T3BlcmF0aW9uKCkgew0KICB2YXIgcHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXInKTsNCiAgUHJvZ3Jlc3NCYXIuc2V0UGVyY2VudGFnZShwcm9ncmVzc0JhciwgMTAwKTsNCiAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICBqc2NvdmVyYWdlX2luTGVuZ3RoeU9wZXJhdGlvbiA9IGZhbHNlOw0KICAgIHByb2dyZXNzQmFyLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsNCiAgICB2YXIgcHJvZ3Jlc3NMYWJlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0xhYmVsJyk7DQogICAgcHJvZ3Jlc3NMYWJlbC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7DQogICAgcHJvZ3Jlc3NMYWJlbC5pbm5lckhUTUwgPSAnJzsNCg0KICAgIHZhciB0YWJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYnMnKS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZGl2Jyk7DQogICAgdmFyIGk7DQogICAgZm9yIChpID0gMDsgaSA8IHRhYnMubGVuZ3RoOyBpKyspIHsNCiAgICAgIHRhYnMuaXRlbShpKS5zdHlsZS5jdXJzb3IgPSAnJzsNCiAgICB9DQogIH0sIDUwKTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9zZXRTaXplKCkgew0KLy8jSlNDT1ZFUkFHRV9JRiAvTVNJRS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KQ0KICB2YXIgdmlld3BvcnRIZWlnaHQgPSBqc2NvdmVyYWdlX2dldFZpZXdwb3J0SGVpZ2h0KCk7DQoNCiAgLyoNCiAgYm9yZGVyLXRvcC13aWR0aDogICAgIDFweA0KICBwYWRkaW5nLXRvcDogICAgICAgICAxMHB4DQogIHBhZGRpbmctYm90dG9tOiAgICAgIDEwcHgNCiAgYm9yZGVyLWJvdHRvbS13aWR0aDogIDFweA0KICBtYXJnaW4tYm90dG9tOiAgICAgICAxMHB4DQogICAgICAgICAgICAgICAgICAgICAgIC0tLS0NCiAgICAgICAgICAgICAgICAgICAgICAgMzJweA0KICAqLw0KICB2YXIgdGFiUGFnZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiUGFnZXMnKTsNCiAgdmFyIHRhYlBhZ2VIZWlnaHQgPSAodmlld3BvcnRIZWlnaHQgLSBqc2NvdmVyYWdlX2ZpbmRQb3ModGFiUGFnZXMpIC0gMzIpICsgJ3B4JzsNCiAgdmFyIG5vZGVMaXN0ID0gdGFiUGFnZXMuY2hpbGROb2RlczsNCiAgdmFyIGxlbmd0aCA9IG5vZGVMaXN0Lmxlbmd0aDsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgew0KICAgIHZhciBub2RlID0gbm9kZUxpc3QuaXRlbShpKTsNCiAgICBpZiAobm9kZS5ub2RlVHlwZSAhPT0gMSkgew0KICAgICAgY29udGludWU7DQogICAgfQ0KICAgIG5vZGUuc3R5bGUuaGVpZ2h0ID0gdGFiUGFnZUhlaWdodDsNCiAgfQ0KDQogIHZhciBpZnJhbWVEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWZyYW1lRGl2Jyk7DQogIC8vIG1heSBub3QgZXhpc3QgaWYgd2UgaGF2ZSByZW1vdmVkIHRoZSBmaXJzdCB0YWINCiAgaWYgKGlmcmFtZURpdikgew0KICAgIGlmcmFtZURpdi5zdHlsZS5oZWlnaHQgPSAodmlld3BvcnRIZWlnaHQgLSBqc2NvdmVyYWdlX2ZpbmRQb3MoaWZyYW1lRGl2KSAtIDIxKSArICdweCc7DQogIH0NCg0KICB2YXIgc3VtbWFyeURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5RGl2Jyk7DQogIHN1bW1hcnlEaXYuc3R5bGUuaGVpZ2h0ID0gKHZpZXdwb3J0SGVpZ2h0IC0ganNjb3ZlcmFnZV9maW5kUG9zKHN1bW1hcnlEaXYpIC0gMjEpICsgJ3B4JzsNCg0KICB2YXIgc291cmNlRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdXJjZURpdicpOw0KICBzb3VyY2VEaXYuc3R5bGUuaGVpZ2h0ID0gKHZpZXdwb3J0SGVpZ2h0IC0ganNjb3ZlcmFnZV9maW5kUG9zKHNvdXJjZURpdikgLSAyMSkgKyAncHgnOw0KDQogIHZhciBzdG9yZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9yZURpdicpOw0KICBpZiAoc3RvcmVEaXYpIHsNCiAgICBzdG9yZURpdi5zdHlsZS5oZWlnaHQgPSAodmlld3BvcnRIZWlnaHQgLSBqc2NvdmVyYWdlX2ZpbmRQb3Moc3RvcmVEaXYpIC0gMjEpICsgJ3B4JzsNCiAgfQ0KLy8jSlNDT1ZFUkFHRV9FTkRJRg0KfQ0KDQovKioNClJldHVybnMgdGhlIGJvb2xlYW4gdmFsdWUgb2YgYSBzdHJpbmcuICBWYWx1ZXMgJ2ZhbHNlJywgJ2YnLCAnbm8nLCAnbicsICdvZmYnLA0KYW5kICcwJyAodXBwZXIgb3IgbG93ZXIgY2FzZSkgYXJlIGZhbHNlLg0KQHBhcmFtICBzICB0aGUgc3RyaW5nDQpAcmV0dXJuICBhIGJvb2xlYW4gdmFsdWUNCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2dldEJvb2xlYW5WYWx1ZShzKSB7DQogIHMgPSBzLnRvTG93ZXJDYXNlKCk7DQogIGlmIChzID09PSAnZmFsc2UnIHx8IHMgPT09ICdmJyB8fCBzID09PSAnbm8nIHx8IHMgPT09ICduJyB8fCBzID09PSAnb2ZmJyB8fCBzID09PSAnMCcpIHsNCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCiAgcmV0dXJuIHRydWU7DQp9DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfcmVtb3ZlVGFiKGlkKSB7DQogIHZhciB0YWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCArICdUYWInKTsNCiAgdGFiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGFiKTsNCiAgdmFyIHRhYlBhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCArICdUYWJQYWdlJyk7DQogIHRhYlBhZ2UucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0YWJQYWdlKTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9pc1ZhbGlkVVJMKHVybCkgew0KICAvLyBSRkMgMzk4Ng0KICB2YXIgbWF0Y2hlcyA9IC9eKChbXjpcLz8jXSspOik/KFwvXC8oW15cLz8jXSopKT8oW14/I10qKShcPyhbXiNdKikpPygjKC4qKSk/Ly5leGVjKHVybCk7DQogIGlmIChtYXRjaGVzID09PSBudWxsKSB7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQogIHZhciBzY2hlbWUgPSBtYXRjaGVzWzFdOw0KICBpZiAodHlwZW9mIHNjaGVtZSA9PT0gJ3N0cmluZycpIHsNCiAgICBzY2hlbWUgPSBzY2hlbWUudG9Mb3dlckNhc2UoKTsNCiAgICByZXR1cm4gc2NoZW1lID09PSAnJyB8fCBzY2hlbWUgPT09ICdmaWxlOicgfHwgc2NoZW1lID09PSAnaHR0cDonIHx8IHNjaGVtZSA9PT0gJ2h0dHBzOic7DQogIH0NCiAgcmV0dXJuIHRydWU7DQp9DQoNCi8qKg0KSW5pdGlhbGl6ZXMgdGhlIGNvbnRlbnRzIG9mIHRoZSB0YWJzLiAgVGhpcyBzZXRzIHRoZSBpbml0aWFsIHZhbHVlcyBvZiB0aGUNCmlucHV0IGZpZWxkIGFuZCBpZnJhbWUgaW4gdGhlICJCcm93c2VyIiB0YWIgYW5kIHRoZSBjaGVja2JveCBpbiB0aGUgIlN1bW1hcnkiDQp0YWIuDQpAcGFyYW0gIHF1ZXJ5U3RyaW5nICB0aGlzIHNob3VsZCBhbHdheXMgYmUgbG9jYXRpb24uc2VhcmNoDQoqLw0KZnVuY3Rpb24ganNjb3ZlcmFnZV9pbml0VGFiQ29udGVudHMocXVlcnlTdHJpbmcpIHsNCiAgdmFyIHNob3dNaXNzaW5nQ29sdW1uID0gZmFsc2U7DQogIHZhciB1cmwgPSBudWxsOw0KICB2YXIgd2luZG93VVJMID0gbnVsbDsNCiAgdmFyIHBhcmFtZXRlcnMsIHBhcmFtZXRlciwgaSwgaW5kZXgsIG5hbWUsIHZhbHVlOw0KICBpZiAocXVlcnlTdHJpbmcubGVuZ3RoID4gMCkgew0KICAgIC8vIGNob3Agb2ZmIHRoZSBxdWVzdGlvbiBtYXJrDQogICAgcXVlcnlTdHJpbmcgPSBxdWVyeVN0cmluZy5zdWJzdHJpbmcoMSk7DQogICAgcGFyYW1ldGVycyA9IHF1ZXJ5U3RyaW5nLnNwbGl0KC8mfDsvKTsNCiAgICBmb3IgKGkgPSAwOyBpIDwgcGFyYW1ldGVycy5sZW5ndGg7IGkrKykgew0KICAgICAgcGFyYW1ldGVyID0gcGFyYW1ldGVyc1tpXTsNCiAgICAgIGluZGV4ID0gcGFyYW1ldGVyLmluZGV4T2YoJz0nKTsNCiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsNCiAgICAgICAgLy8gc3RpbGwgd29ya3Mgd2l0aCBvbGQgc3ludGF4DQogICAgICAgIHVybCA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJhbWV0ZXIpOw0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgIG5hbWUgPSBwYXJhbWV0ZXIuc3Vic3RyKDAsIGluZGV4KTsNCiAgICAgICAgdmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQocGFyYW1ldGVyLnN1YnN0cihpbmRleCArIDEpKTsNCiAgICAgICAgaWYgKG5hbWUgPT09ICdtaXNzaW5nJyB8fCBuYW1lID09PSAnbScpIHsNCiAgICAgICAgICBzaG93TWlzc2luZ0NvbHVtbiA9IGpzY292ZXJhZ2VfZ2V0Qm9vbGVhblZhbHVlKHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChuYW1lID09PSAndXJsJyB8fCBuYW1lID09PSAndScgfHwgbmFtZSA9PT0gJ2ZyYW1lJyB8fCBuYW1lID09PSAnZicpIHsNCiAgICAgICAgICB1cmwgPSB2YWx1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChuYW1lID09PSAnd2luZG93JyB8fCBuYW1lID09PSAndycpIHsNCiAgICAgICAgICB3aW5kb3dVUkwgPSB2YWx1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIHZhciBjaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVja2JveCcpOw0KICBjaGVja2JveC5jaGVja2VkID0gc2hvd01pc3NpbmdDb2x1bW47DQogIGlmIChzaG93TWlzc2luZ0NvbHVtbikgew0KICAgIGpzY292ZXJhZ2VfYXBwZW5kTWlzc2luZ0NvbHVtbigpOw0KICB9DQoNCiAgdmFyIGlzVmFsaWRVUkwgPSBmdW5jdGlvbiAodXJsKSB7DQogICAgdmFyIHJlc3VsdCA9IGpzY292ZXJhZ2VfaXNWYWxpZFVSTCh1cmwpOw0KICAgIGlmICghIHJlc3VsdCkgew0KICAgICAgYWxlcnQoJ0ludmFsaWQgVVJMOiAnICsgdXJsKTsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfTsNCg0KICBpZiAodXJsICE9PSBudWxsICYmIGlzVmFsaWRVUkwodXJsKSkgew0KICAgIC8vIHRoaXMgd2lsbCBhdXRvbWF0aWNhbGx5IHByb3BhZ2F0ZSB0byB0aGUgaW5wdXQgZmllbGQNCiAgICBmcmFtZXNbMF0ubG9jYXRpb24gPSB1cmw7DQogIH0NCiAgZWxzZSBpZiAod2luZG93VVJMICE9PSBudWxsICYmIGlzVmFsaWRVUkwod2luZG93VVJMKSkgew0KICAgIHdpbmRvdy5vcGVuKHdpbmRvd1VSTCk7DQogIH0NCg0KICAvLyBpZiB0aGUgYnJvd3NlciB0YWIgaXMgYWJzZW50LCB3ZSBoYXZlIHRvIGluaXRpYWxpemUgdGhlIHN1bW1hcnkgdGFiDQogIGlmICghIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicm93c2VyVGFiJykpIHsNCiAgICBqc2NvdmVyYWdlX3JlY2FsY3VsYXRlU3VtbWFyeVRhYigpOw0KICB9DQp9DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfYm9keV9sb2FkKCkgew0KICB2YXIgcHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXInKTsNCiAgUHJvZ3Jlc3NCYXIuaW5pdChwcm9ncmVzc0Jhcik7DQoNCiAgZnVuY3Rpb24gcmVwb3J0RXJyb3IoZSkgew0KICAgIGpzY292ZXJhZ2VfZW5kTGVuZ3RoeU9wZXJhdGlvbigpOw0KICAgIHZhciBzdW1tYXJ5VGhyb2JiZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeVRocm9iYmVyJyk7DQogICAgc3VtbWFyeVRocm9iYmVyLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsNCiAgICB2YXIgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlFcnJvckRpdicpOw0KICAgIGRpdi5pbm5lckhUTUwgPSAnRXJyb3I6ICcgKyBlOw0KICB9DQoNCiAgaWYgKGpzY292ZXJhZ2VfaXNSZXBvcnQpIHsNCiAgICBqc2NvdmVyYWdlX2JlZ2luTGVuZ3RoeU9wZXJhdGlvbigpOw0KICAgIHZhciBzdW1tYXJ5VGhyb2JiZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeVRocm9iYmVyJyk7DQogICAgc3VtbWFyeVRocm9iYmVyLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7DQogICAgdmFyIHJlcXVlc3QgPSBqc2NvdmVyYWdlX2NyZWF0ZVJlcXVlc3QoKTsNCiAgICB0cnkgew0KICAgICAgcmVxdWVzdC5vcGVuKCdHRVQnLCAnanNjb3ZlcmFnZS5qc29uJywgdHJ1ZSk7DQogICAgICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7DQogICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyAhPT0gMCAmJiByZXF1ZXN0LnN0YXR1cyAhPT0gMjAwKSB7DQogICAgICAgICAgICAgIHRocm93IHJlcXVlc3Quc3RhdHVzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gcmVxdWVzdC5yZXNwb25zZVRleHQ7DQogICAgICAgICAgICBpZiAocmVzcG9uc2UgPT09ICcnKSB7DQogICAgICAgICAgICAgIHRocm93IDQwNDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBqc29uID0gZXZhbCgnKCcgKyByZXNwb25zZSArICcpJyk7DQogICAgICAgICAgICB2YXIgZmlsZTsNCiAgICAgICAgICAgIGZvciAoZmlsZSBpbiBqc29uKSB7DQogICAgICAgICAgICAgIHZhciBmaWxlQ292ZXJhZ2UgPSBqc29uW2ZpbGVdOw0KICAgICAgICAgICAgICBfJGpzY292ZXJhZ2VbZmlsZV0gPSB7fTsNCiAgICAgICAgICAgICAgXyRqc2NvdmVyYWdlW2ZpbGVdLmxpbmVEYXRhID0gZmlsZUNvdmVyYWdlLmxpbmVEYXRhOw0KICAgICAgICAgICAgICBfJGpzY292ZXJhZ2VbZmlsZV0uYnJhbmNoRGF0YSA9IGNvbnZlcnRCcmFuY2hEYXRhTGluZXNGcm9tSlNPTihmaWxlQ292ZXJhZ2UuYnJhbmNoRGF0YSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBqc2NvdmVyYWdlX3JlY2FsY3VsYXRlU3VtbWFyeVRhYigpOw0KICAgICAgICAgICAgc3VtbWFyeVRocm9iYmVyLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsNCiAgICAgICAgICB9DQogICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgIHJlcG9ydEVycm9yKGUpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICAgIHJlcXVlc3Quc2VuZChudWxsKTsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgIHJlcG9ydEVycm9yKGUpOw0KICAgIH0NCg0KICAgIGpzY292ZXJhZ2VfcmVtb3ZlVGFiKCdicm93c2VyJyk7DQogICAganNjb3ZlcmFnZV9yZW1vdmVUYWIoJ3N0b3JlJyk7DQogIH0NCiAgZWxzZSB7DQogICAgaWYgKGpzY292ZXJhZ2VfaXNJbnZlcnRlZE1vZGUpIHsNCiAgICAgIGpzY292ZXJhZ2VfcmVtb3ZlVGFiKCdicm93c2VyJyk7DQogICAgfQ0KDQogICAgaWYgKCEganNjb3ZlcmFnZV9pc1NlcnZlcikgew0KICAgICAganNjb3ZlcmFnZV9yZW1vdmVUYWIoJ3N0b3JlJyk7DQogICAgfQ0KICB9DQoNCiAganNjb3ZlcmFnZV9pbml0VGFiQ29udHJvbCgpOw0KDQogIGpzY292ZXJhZ2VfaW5pdFRhYkNvbnRlbnRzKGxvY2F0aW9uLnNlYXJjaCk7DQp9DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfYm9keV9yZXNpemUoKSB7DQogIGlmICgvTVNJRS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KICAgIGpzY292ZXJhZ2Vfc2V0U2l6ZSgpOw0KICB9DQp9DQoNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovLyB0YWIgMQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX3VwZGF0ZUJyb3dzZXIoKSB7DQogIHZhciBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2NhdGlvbiIpOw0KICBmcmFtZXNbMF0ubG9jYXRpb24gPSBpbnB1dC52YWx1ZTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9vcGVuV2luZG93KCkgew0KICB2YXIgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9jYXRpb24iKTsNCiAgdmFyIHVybCA9IGlucHV0LnZhbHVlOw0KICB3aW5kb3cub3Blbih1cmwsJ2pzY292ZXJhZ2Vfd2luZG93Jyk7DQp9DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfaW5wdXRfa2V5cHJlc3MoZSkgew0KICBpZiAoZS5rZXlDb2RlID09PSAxMykgew0KICAgIGlmIChlLnNoaWZ0S2V5KSB7DQogICAgICBqc2NvdmVyYWdlX29wZW5XaW5kb3coKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICBqc2NvdmVyYWdlX3VwZGF0ZUJyb3dzZXIoKTsNCiAgICB9DQogIH0NCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9vcGVuSW5GcmFtZUJ1dHRvbl9jbGljaygpIHsNCiAganNjb3ZlcmFnZV91cGRhdGVCcm93c2VyKCk7DQp9DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2Vfb3BlbkluV2luZG93QnV0dG9uX2NsaWNrKCkgew0KICBqc2NvdmVyYWdlX29wZW5XaW5kb3coKTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9icm93c2VyX2xvYWQoKSB7DQogIC8qIHVwZGF0ZSB0aGUgaW5wdXQgYm94ICovDQogIHZhciBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2NhdGlvbiIpOw0KDQogIC8qIHNvbWV0aW1lcyBJRSBzZWVtcyB0byBmaXJlIHRoaXMgYWZ0ZXIgdGhlIHRhYiBoYXMgYmVlbiByZW1vdmVkICovDQogIGlmIChpbnB1dCkgew0KICAgIGlucHV0LnZhbHVlID0gZnJhbWVzWzBdLmxvY2F0aW9uOw0KICB9DQp9DQoNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovLyB0YWIgMg0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2NyZWF0ZUhhbmRsZXIoZmlsZSwgbGluZSkgew0KICByZXR1cm4gZnVuY3Rpb24gKCkgew0KICAgIGpzY292ZXJhZ2VfZ2V0KGZpbGUsIGxpbmUpOw0KICAgIHJldHVybiBmYWxzZTsNCiAgfTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9jcmVhdGVMaW5rKGZpbGUsIGxpbmUpIHsNCiAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7DQogIGxpbmsuaHJlZiA9ICcjJzsNCiAgbGluay5vbmNsaWNrID0ganNjb3ZlcmFnZV9jcmVhdGVIYW5kbGVyKGZpbGUsIGxpbmUpOw0KDQogIHZhciB0ZXh0Ow0KICBpZiAobGluZSkgew0KICAgIHRleHQgPSBsaW5lLnRvU3RyaW5nKCk7DQogIH0NCiAgZWxzZSB7DQogICAgdGV4dCA9IGZpbGU7DQogIH0NCg0KICBsaW5rLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpKTsNCg0KICByZXR1cm4gbGluazsNCn0NCg0KdmFyIHNvcnRPcmRlciA9IDA7DQp2YXIgc29ydENvbHVtbiA9ICdDb3ZlcmFnZSc7DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfcmVjYWxjdWxhdGVTdW1tYXJ5VGFiQnkodHlwZSkgew0KICBpZiAoc29ydENvbHVtbiAhPT0gdHlwZSkNCiAgICBzb3J0T3JkZXIgPSAxOw0KICBzb3J0Q29sdW1uID0gdHlwZTsNCiAganNjb3ZlcmFnZV9yZWNhbGN1bGF0ZVN1bW1hcnlUYWIobnVsbCk7DQp9DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfcmVjYWxjdWxhdGVTdW1tYXJ5VGFiKGNjKSB7DQogIHZhciBjaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVja2JveCcpOw0KICB2YXIgc2hvd01pc3NpbmdDb2x1bW4gPSBjaGVja2JveC5jaGVja2VkOw0KDQogIGlmICghIGNjKSB7DQogICAgY2MgPSB3aW5kb3cuXyRqc2NvdmVyYWdlOw0KICB9DQogIGlmICghIGNjKSB7DQovLyNKU0NPVkVSQUdFX0lGIDANCiAgICB0aHJvdyAiTm8gY292ZXJhZ2UgaW5mb3JtYXRpb24gZm91bmQuIjsNCi8vI0pTQ09WRVJBR0VfRU5ESUYNCiAgfQ0KDQogIHZhciB0b3RhbHMgPSB7IGZpbGVzOjAsIHN0YXRlbWVudHM6MCwgZXhlY3V0ZWQ6MCwgYnJhbmNoZXM6MCwgYnJhbmNoZXNfY292ZXJlZDowIH07DQoNCiAgdmFyIGZpbGU7DQogIHZhciBmaWxlcyA9IFtdOw0KICBmb3IgKGZpbGUgaW4gY2MpIHsNCiAgICBmaWxlcy5wdXNoKGZpbGUpOw0KICB9DQogIGlmIChmaWxlcy5sZW5ndGggPT09IDApDQogICAgcmV0dXJuOw0KDQogIGZpbGVzID0gZ2V0RmlsZXNTb3J0ZWRCeUNvdmVyYWdlKGZpbGVzKTsNCiAgc29ydE9yZGVyKys7DQoNCiAgdmFyIHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN1bW1hcnlUYm9keSIpOw0KICB3aGlsZSAodGJvZHkuaGFzQ2hpbGROb2RlcygpKSB7DQogICAgdGJvZHkucmVtb3ZlQ2hpbGQodGJvZHkuZmlyc3RDaGlsZCk7DQogIH0NCg0KDQogIHZhciByb3dDb3VudGVyID0gMDsNCiAgZm9yICh2YXIgZiA9IDA7IGYgPCBmaWxlcy5sZW5ndGg7IGYrKykgew0KICAgIGZpbGUgPSBmaWxlc1tmXTsNCiAgICB2YXIgbGluZU51bWJlcjsNCiAgICB2YXIgbnVtX3N0YXRlbWVudHMgPSAwOw0KICAgIHZhciBudW1fZXhlY3V0ZWQgPSAwOw0KICAgIHZhciBtaXNzaW5nID0gW107DQogICAgdmFyIGZpbGVDQyA9IGNjW2ZpbGVdLmxpbmVEYXRhOw0KICAgIHZhciBsZW5ndGggPSBmaWxlQ0MubGVuZ3RoOw0KICAgIHZhciBjdXJyZW50Q29uZGl0aW9uYWxFbmQgPSAwOw0KICAgIHZhciBjb25kaXRpb25hbHMgPSBudWxsOw0KICAgIGlmIChmaWxlQ0MuY29uZGl0aW9uYWxzKSB7DQogICAgICBjb25kaXRpb25hbHMgPSBmaWxlQ0MuY29uZGl0aW9uYWxzOw0KICAgIH0NCiAgICBmb3IgKGxpbmVOdW1iZXIgPSAwOyBsaW5lTnVtYmVyIDwgbGVuZ3RoOyBsaW5lTnVtYmVyKyspIHsNCiAgICAgIHZhciBuID0gZmlsZUNDW2xpbmVOdW1iZXJdOw0KDQogICAgICBpZiAobGluZU51bWJlciA9PT0gY3VycmVudENvbmRpdGlvbmFsRW5kKSB7DQogICAgICAgIGN1cnJlbnRDb25kaXRpb25hbEVuZCA9IDA7DQogICAgICB9DQogICAgICBlbHNlIGlmIChjdXJyZW50Q29uZGl0aW9uYWxFbmQgPT09IDAgJiYgY29uZGl0aW9uYWxzICYmIGNvbmRpdGlvbmFsc1tsaW5lTnVtYmVyXSkgew0KICAgICAgICBjdXJyZW50Q29uZGl0aW9uYWxFbmQgPSBjb25kaXRpb25hbHNbbGluZU51bWJlcl07DQogICAgICB9DQoNCiAgICAgIGlmIChjdXJyZW50Q29uZGl0aW9uYWxFbmQgIT09IDApIHsNCiAgICAgICAgY29udGludWU7DQogICAgICB9DQoNCiAgICAgIGlmIChuID09PSB1bmRlZmluZWQgfHwgbiA9PT0gbnVsbCkgew0KICAgICAgICBjb250aW51ZTsNCiAgICAgIH0NCg0KICAgICAgaWYgKG4gPT09IDApIHsNCiAgICAgICAgbWlzc2luZy5wdXNoKGxpbmVOdW1iZXIpOw0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgIG51bV9leGVjdXRlZCsrOw0KICAgICAgfQ0KICAgICAgbnVtX3N0YXRlbWVudHMrKzsNCiAgICB9DQoNCiAgICB2YXIgcGVyY2VudGFnZSA9ICggbnVtX3N0YXRlbWVudHMgPT09IDAgPyAwIDogcGFyc2VJbnQoMTAwICogbnVtX2V4ZWN1dGVkIC8gbnVtX3N0YXRlbWVudHMpICk7DQoNCiAgICB2YXIgbnVtX2JyYW5jaGVzID0gMDsNCiAgICB2YXIgbnVtX2V4ZWN1dGVkX2JyYW5jaGVzID0gMDsNCiAgICB2YXIgZmlsZUJyYW5jaENDID0gY2NbZmlsZV0uYnJhbmNoRGF0YTsNCiAgICBpZiAoZmlsZUJyYW5jaENDKSB7DQogICAgICAgIHZhciBicmFuY2hMZW5ndGggPSBmaWxlQnJhbmNoQ0MubGVuZ3RoOw0KICAgICAgICBmb3IgKGxpbmVOdW1iZXIgPSAwOyBsaW5lTnVtYmVyIDwgYnJhbmNoTGVuZ3RoOyBsaW5lTnVtYmVyKyspIHsNCiAgICAgICAgICB2YXIgY29uZGl0aW9ucyA9IGZpbGVCcmFuY2hDQ1tsaW5lTnVtYmVyXTsNCiAgICAgICAgICB2YXIgY292ZXJlZCA9IHVuZGVmaW5lZDsNCiAgICAgICAgICBpZiAoY29uZGl0aW9ucyAhPT0gdW5kZWZpbmVkICYmIGNvbmRpdGlvbnMgIT09IG51bGwgJiYgY29uZGl0aW9ucy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgY292ZXJlZCA9IHRydWU7DQogICAgICAgICAgICAgIGZvciAodmFyIGNvbmRpdGlvbkluZGV4ID0gMDsgY29uZGl0aW9uSW5kZXggPCBjb25kaXRpb25zLmxlbmd0aDsgY29uZGl0aW9uSW5kZXgrKykgew0KICAgICAgICAgICAgICAgICAgdmFyIGJyYW5jaERhdGEgPSBmaWxlQnJhbmNoQ0NbbGluZU51bWJlcl1bY29uZGl0aW9uSW5kZXhdOw0KICAgICAgICAgICAgICAgICAgaWYgKGJyYW5jaERhdGEgPT09IHVuZGVmaW5lZCB8fCBicmFuY2hEYXRhID09PSBudWxsKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgIG51bV9icmFuY2hlcyArPSAyOw0KICAgICAgICAgICAgICAgICAgbnVtX2V4ZWN1dGVkX2JyYW5jaGVzICs9IGJyYW5jaERhdGEucGF0aHNDb3ZlcmVkKCk7DQogICAgICAgICAgICAgICAgICBpZiAoIWJyYW5jaERhdGEuY292ZXJlZCgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgY292ZXJlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHZhciBwZXJjZW50YWdlQnJhbmNoID0gKCBudW1fYnJhbmNoZXMgPT09IDAgPyAwIDogcGFyc2VJbnQoMTAwICogbnVtX2V4ZWN1dGVkX2JyYW5jaGVzIC8gbnVtX2JyYW5jaGVzKSk7DQogICAgfQ0KDQoNCiAgICB2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHIiKTsNCiAgICByb3cuY2xhc3NOYW1lID0gKCByb3dDb3VudGVyKysgJSAyID09IDAgPyAib2RkIiA6ICJldmVuIiApOw0KDQogICAgdmFyIGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgIHJvdy5pZCA9ICJyb3ctIitmaWxlOw0KICAgIGNlbGwuY2xhc3NOYW1lID0gJ2xlZnRDb2x1bW4nOw0KICAgIHZhciBsaW5rID0ganNjb3ZlcmFnZV9jcmVhdGVMaW5rKGZpbGUpOw0KICAgIGNlbGwuYXBwZW5kQ2hpbGQobGluayk7DQoNCiAgICByb3cuYXBwZW5kQ2hpbGQoY2VsbCk7DQoNCiAgICBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICBjZWxsLmNsYXNzTmFtZSA9ICdudW1lcmljJzsNCiAgICBjZWxsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG51bV9zdGF0ZW1lbnRzKSk7DQogICAgcm93LmFwcGVuZENoaWxkKGNlbGwpOw0KDQogICAgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7DQogICAgY2VsbC5jbGFzc05hbWUgPSAnbnVtZXJpYyc7DQogICAgY2VsbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShudW1fZXhlY3V0ZWQpKTsNCiAgICByb3cuYXBwZW5kQ2hpbGQoY2VsbCk7DQoNCiAgICBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICBjZWxsLmNsYXNzTmFtZSA9ICdudW1lcmljJzsNCiAgICBjZWxsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG51bV9icmFuY2hlcykpOw0KICAgIHJvdy5hcHBlbmRDaGlsZChjZWxsKTsNCg0KICAgIGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgIGNlbGwuY2xhc3NOYW1lID0gJ251bWVyaWMnOw0KICAgIGNlbGwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobnVtX2V4ZWN1dGVkX2JyYW5jaGVzKSk7DQogICAgcm93LmFwcGVuZENoaWxkKGNlbGwpOw0KDQogICAgLy8gbmV3IGNvdmVyYWdlIHRkIGNvbnRhaW5pbmcgYSBiYXIgZ3JhcGgNCiAgICBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICBjZWxsLmNsYXNzTmFtZSA9ICdjb3ZlcmFnZSc7DQogICAgdmFyIHBjdEdyYXBoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksDQogICAgICAgIGNvdmVyZWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgcGN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOw0KICAgIHBjdEdyYXBoLmNsYXNzTmFtZSA9ICJwY3RHcmFwaCI7DQogICAgaWYoIG51bV9zdGF0ZW1lbnRzID09PSAwICkgew0KICAgICAgICBjb3ZlcmVkLmNsYXNzTmFtZSA9ICJza2lwcGVkIjsNCiAgICAgICAgcGN0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJOL0EiKSk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgY292ZXJlZC5jbGFzc05hbWUgPSAiY292ZXJlZCI7DQogICAgICAgIGNvdmVyZWQuc3R5bGUud2lkdGggPSBwZXJjZW50YWdlICsgInB4IjsNCiAgICAgICAgcGN0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHBlcmNlbnRhZ2UgKyAnJScpKTsNCiAgICB9DQogICAgcGN0LmNsYXNzTmFtZSA9ICJwY3QiOw0KICAgIHBjdEdyYXBoLmFwcGVuZENoaWxkKGNvdmVyZWQpOw0KICAgIGNlbGwuYXBwZW5kQ2hpbGQocGN0R3JhcGgpOw0KICAgIGNlbGwuYXBwZW5kQ2hpbGQocGN0KTsNCiAgICByb3cuYXBwZW5kQ2hpbGQoY2VsbCk7DQoNCiAgICAvLyBuZXcgY292ZXJhZ2UgdGQgY29udGFpbmluZyBhIGJyYW5jaCBiYXIgZ3JhcGgNCiAgICBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICBjZWxsLmNsYXNzTmFtZSA9ICdjb3ZlcmFnZSc7DQogICAgcGN0R3JhcGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCiAgICAgICAgY292ZXJlZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KICAgICAgICBwY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgcGN0R3JhcGguY2xhc3NOYW1lID0gInBjdEdyYXBoIjsNCiAgICBpZihmaWxlQnJhbmNoQ0MgPT09IHVuZGVmaW5lZCB8fCBudW1fYnJhbmNoZXMgPT09IDAgKSB7DQogICAgICAgIGNvdmVyZWQuY2xhc3NOYW1lID0gInNraXBwZWQiOw0KICAgICAgICBwY3QuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIk4vQSIpKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb3ZlcmVkLmNsYXNzTmFtZSA9ICJjb3ZlcmVkIjsNCiAgICAgICAgY292ZXJlZC5zdHlsZS53aWR0aCA9IHBlcmNlbnRhZ2VCcmFuY2ggKyAicHgiOw0KICAgICAgICBwY3QuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocGVyY2VudGFnZUJyYW5jaCArICclJykpOw0KICAgIH0NCiAgICBwY3QuY2xhc3NOYW1lID0gInBjdCI7DQogICAgcGN0R3JhcGguYXBwZW5kQ2hpbGQoY292ZXJlZCk7DQogICAgY2VsbC5hcHBlbmRDaGlsZChwY3RHcmFwaCk7DQogICAgY2VsbC5hcHBlbmRDaGlsZChwY3QpOw0KICAgIHJvdy5hcHBlbmRDaGlsZChjZWxsKTsNCg0KICAgIGlmIChzaG93TWlzc2luZ0NvbHVtbikgew0KICAgICAgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1pc3NpbmcubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKGkgIT09IDApIHsNCiAgICAgICAgICBjZWxsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIsICIpKTsNCiAgICAgICAgfQ0KICAgICAgICBsaW5rID0ganNjb3ZlcmFnZV9jcmVhdGVMaW5rKGZpbGUsIG1pc3NpbmdbaV0pOw0KDQogICAgICAgIC8vIGdyb3VwIGNvbnRpZ3VvdXMgbWlzc2luZyBsaW5lczsgZS5nLiwgMTAsIDExLCAxMiAtPiAxMC0xMg0KICAgICAgICB2YXIgaiwgc3RhcnQgPSBtaXNzaW5nW2ldOw0KICAgICAgICBmb3IgKDs7KSB7DQogICAgICAgICAgaiA9IDE7DQogICAgICAgICAgd2hpbGUgKGkgKyBqIDwgbWlzc2luZy5sZW5ndGggJiYgbWlzc2luZ1tpICsgal0gPT0gbWlzc2luZ1tpXSArIGopIHsNCiAgICAgICAgICAgIGorKzsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIG5leHRtaXNzaW5nID0gbWlzc2luZ1tpICsgal0sIGN1ciA9IG1pc3NpbmdbaV0gKyBqOw0KICAgICAgICAgIGlmIChpc05hTihuZXh0bWlzc2luZykpIHsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCiAgICAgICAgICB3aGlsZSAoY3VyIDwgbmV4dG1pc3NpbmcgJiYgISBmaWxlQ0NbY3VyXSkgew0KICAgICAgICAgICAgY3VyKys7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChjdXIgPCBuZXh0bWlzc2luZyB8fCBjdXIgPj0gbGVuZ3RoKSB7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgICAgaSArPSBqOw0KICAgICAgICB9DQogICAgICAgIGlmIChzdGFydCAhPSBtaXNzaW5nW2ldIHx8IGogPiAxKSB7DQogICAgICAgICAgaSArPSBqIC0gMTsNCiAgICAgICAgICBsaW5rLmlubmVySFRNTCArPSAiLSIgKyBtaXNzaW5nW2ldOw0KICAgICAgICB9DQoNCiAgICAgICAgY2VsbC5hcHBlbmRDaGlsZChsaW5rKTsNCiAgICAgIH0NCiAgICAgIHJvdy5hcHBlbmRDaGlsZChjZWxsKTsNCiAgICB9DQoNCiAgICB0Ym9keS5hcHBlbmRDaGlsZChyb3cpOw0KDQogICAgdG90YWxzWydmaWxlcyddICsrOw0KICAgIHRvdGFsc1snc3RhdGVtZW50cyddICs9IG51bV9zdGF0ZW1lbnRzOw0KICAgIHRvdGFsc1snZXhlY3V0ZWQnXSArPSBudW1fZXhlY3V0ZWQ7DQogICAgdG90YWxzWydicmFuY2hlcyddICs9IG51bV9icmFuY2hlczsNCiAgICB0b3RhbHNbJ2JyYW5jaGVzX2NvdmVyZWQnXSArPSBudW1fZXhlY3V0ZWRfYnJhbmNoZXM7DQoNCiAgICAvLyB3cml0ZSB0b3RhbHMgZGF0YSBpbnRvIHN1bW1hcnlUb3RhbHMgcm93DQogICAgdmFyIHRyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN1bW1hcnlUb3RhbHMiKTsNCiAgICBpZiAodHIpIHsNCiAgICAgICAgdmFyIHRkcyA9IHRyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpOw0KICAgICAgICB0ZHNbMF0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNwYW4iKVsxXS5maXJzdENoaWxkLm5vZGVWYWx1ZSA9IHRvdGFsc1snZmlsZXMnXTsNCiAgICAgICAgdGRzWzFdLmZpcnN0Q2hpbGQubm9kZVZhbHVlID0gdG90YWxzWydzdGF0ZW1lbnRzJ107DQogICAgICAgIHRkc1syXS5maXJzdENoaWxkLm5vZGVWYWx1ZSA9IHRvdGFsc1snZXhlY3V0ZWQnXTsNCiAgICAgICAgdGRzWzNdLmZpcnN0Q2hpbGQubm9kZVZhbHVlID0gdG90YWxzWydicmFuY2hlcyddOw0KICAgICAgICB0ZHNbNF0uZmlyc3RDaGlsZC5ub2RlVmFsdWUgPSB0b3RhbHNbJ2JyYW5jaGVzX2NvdmVyZWQnXTsNCg0KICAgICAgICB2YXIgY292ZXJhZ2UgPSBwYXJzZUludCgxMDAgKiB0b3RhbHNbJ2V4ZWN1dGVkJ10gLyB0b3RhbHNbJ3N0YXRlbWVudHMnXSk7DQogICAgICAgIGlmKCBpc05hTiggY292ZXJhZ2UgKSApIHsNCiAgICAgICAgICAgIGNvdmVyYWdlID0gMDsNCiAgICAgICAgfQ0KICAgICAgICB0ZHNbNV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNwYW4iKVswXS5maXJzdENoaWxkLm5vZGVWYWx1ZSA9IGNvdmVyYWdlICsgJyUnOw0KICAgICAgICB0ZHNbNV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoImRpdiIpWzFdLnN0eWxlLndpZHRoID0gY292ZXJhZ2UgKyAncHgnOw0KDQogICAgICAgIGNvdmVyYWdlID0gMDsNCiAgICAgICAgaWYgKGZpbGVCcmFuY2hDQyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBjb3ZlcmFnZSA9IHBhcnNlSW50KDEwMCAqIHRvdGFsc1snYnJhbmNoZXNfY292ZXJlZCddIC8gdG90YWxzWydicmFuY2hlcyddKTsNCiAgICAgICAgICAgIGlmKCBpc05hTiggY292ZXJhZ2UgKSApIHsNCiAgICAgICAgICAgICAgICBjb3ZlcmFnZSA9IDA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGRzWzZdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzcGFuIilbMF0uZmlyc3RDaGlsZC5ub2RlVmFsdWUgPSBjb3ZlcmFnZSArICclJzsNCiAgICAgICAgdGRzWzZdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJkaXYiKVsxXS5zdHlsZS53aWR0aCA9IGNvdmVyYWdlICsgJ3B4JzsNCiAgICB9DQoNCiAgfQ0KICBqc2NvdmVyYWdlX2VuZExlbmd0aHlPcGVyYXRpb24oKTsNCn0NCg0KZnVuY3Rpb24gZ2V0RmlsZXNTb3J0ZWRCeUNvdmVyYWdlKGZpbGVzSW4pIHsNCiAgdmFyIHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInN1bW1hcnlUYm9keSIpOw0KICBpZiAodGJvZHkuY2hpbGRyZW4ubGVuZ3RoIDwgMikgew0KICAgIHNvcnRPcmRlcj0xOw0KICAgIHJldHVybiBmaWxlc0luOw0KICB9DQogIHZhciBmaWxlcyA9IFtdOw0KICBmb3IgKHZhciBpPTA7aTx0Ym9keS5jaGlsZHJlbi5sZW5ndGg7aSsrKSB7DQogICAgZmlsZXNbaV0gPSB7fTsNCiAgCWZpbGVzW2ldLmZpbGUgPSB0Ym9keS5jaGlsZHJlbltpXS5jaGlsZHJlblswXS5jaGlsZHJlblswXS5pbm5lckhUTUw7DQogIAlmaWxlc1tpXS5wZXJjID0gcGFyc2VJbnQodGJvZHkuY2hpbGRyZW5baV0uY2hpbGRyZW5bNV0uY2hpbGRyZW5bMV0uaW5uZXJIVE1MLCAxMCk7DQogIAlmaWxlc1tpXS5iclBlcmMgPSBwYXJzZUludCh0Ym9keS5jaGlsZHJlbltpXS5jaGlsZHJlbls2XS5jaGlsZHJlblsxXS5pbm5lckhUTUwsIDEwKTsNCiAgICBpZiAoaXNOYU4oZmlsZXNbaV0uYnJQZXJjKSkNCiAgICAgIGZpbGVzW2ldLmJyUGVyYyA9IC0xOw0KICB9DQoNCiAgaWYgKHNvcnRPcmRlciUzPT09MSkgew0KICAgIGlmIChzb3J0Q29sdW1uID09ICdDb3ZlcmFnZScpDQogICAgICBmaWxlcy5zb3J0KGZ1bmN0aW9uKGZpbGUxLGZpbGUyKSB7cmV0dXJuIGZpbGUxLnBlcmMtZmlsZTIucGVyY30pOw0KICAgIGVsc2UNCiAgICAgIGZpbGVzLnNvcnQoZnVuY3Rpb24oZmlsZTEsZmlsZTIpIHtyZXR1cm4gZmlsZTEuYnJQZXJjLWZpbGUyLmJyUGVyY30pOw0KICB9IGVsc2UgaWYgKHNvcnRPcmRlciUzPT09Mikgew0KICAgICBpZiAoc29ydENvbHVtbiA9PSAnQ292ZXJhZ2UnKQ0KICAgICAgZmlsZXMuc29ydChmdW5jdGlvbihmaWxlMSxmaWxlMikge3JldHVybiBmaWxlMi5wZXJjLWZpbGUxLnBlcmN9KTsNCiAgICAgZWxzZQ0KICAgICAgIGZpbGVzLnNvcnQoZnVuY3Rpb24oZmlsZTEsZmlsZTIpIHtyZXR1cm4gZmlsZTIuYnJQZXJjLWZpbGUxLmJyUGVyY30pOw0KICB9IGVsc2Ugew0KICAgICAgcmV0dXJuIGZpbGVzSW4uc29ydCgpOw0KICB9DQogIHZhciByZXN1bHQgPSBbXTsNCiAgZm9yICh2YXIgaT0wO2k8ZmlsZXMubGVuZ3RoO2krKykgew0KICAgIHJlc3VsdFtpXSA9IGZpbGVzW2ldLmZpbGU7DQogIH0NCiAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9hcHBlbmRNaXNzaW5nQ29sdW1uKCkgew0KICB2YXIgaGVhZGVyUm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYWRlclJvdycpOw0KICB2YXIgbWlzc2luZ0hlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7DQogIG1pc3NpbmdIZWFkZXIuaWQgPSAnbWlzc2luZ0hlYWRlcic7DQogIG1pc3NpbmdIZWFkZXIuaW5uZXJIVE1MID0gJzxhYmJyIHRpdGxlPSJMaXN0IG9mIHN0YXRlbWVudHMgbWlzc2VkIGR1cmluZyBleGVjdXRpb24iPk1pc3Npbmc8L2FiYnI+JzsNCiAgaGVhZGVyUm93LmFwcGVuZENoaWxkKG1pc3NpbmdIZWFkZXIpOw0KICB2YXIgc3VtbWFyeVRvdGFscyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5VG90YWxzJyk7DQogIHZhciBlbXB0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7DQogIGVtcHR5LmlkID0gJ21pc3NpbmdDZWxsJzsNCiAgc3VtbWFyeVRvdGFscy5hcHBlbmRDaGlsZChlbXB0eSk7DQp9DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2VfcmVtb3ZlTWlzc2luZ0NvbHVtbigpIHsNCiAgdmFyIG1pc3NpbmdOb2RlOw0KICBtaXNzaW5nTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaXNzaW5nSGVhZGVyJyk7DQogIG1pc3NpbmdOb2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobWlzc2luZ05vZGUpOw0KICBtaXNzaW5nTm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaXNzaW5nQ2VsbCcpOw0KICBtaXNzaW5nTm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG1pc3NpbmdOb2RlKTsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9jaGVja2JveF9jbGljaygpIHsNCiAgaWYgKGpzY292ZXJhZ2VfaW5MZW5ndGh5T3BlcmF0aW9uKSB7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQogIGpzY292ZXJhZ2VfYmVnaW5MZW5ndGh5T3BlcmF0aW9uKCk7DQogIHZhciBjaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVja2JveCcpOw0KICB2YXIgc2hvd01pc3NpbmdDb2x1bW4gPSBjaGVja2JveC5jaGVja2VkOw0KICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgIGlmIChzaG93TWlzc2luZ0NvbHVtbikgew0KICAgICAganNjb3ZlcmFnZV9hcHBlbmRNaXNzaW5nQ29sdW1uKCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAganNjb3ZlcmFnZV9yZW1vdmVNaXNzaW5nQ29sdW1uKCk7DQogICAgfQ0KICAgIGpzY292ZXJhZ2VfcmVjYWxjdWxhdGVTdW1tYXJ5VGFiKCk7DQogIH0sIDUwKTsNCiAgcmV0dXJuIHRydWU7DQp9DQoNCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQovLyB0YWIgMw0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX21ha2VUYWJsZShsaW5lcykgew0KICB2YXIgY292ZXJhZ2UgPSBfJGpzY292ZXJhZ2VbanNjb3ZlcmFnZV9jdXJyZW50RmlsZV0ubGluZURhdGE7DQogIHZhciBicmFuY2hEYXRhID0gXyRqc2NvdmVyYWdlW2pzY292ZXJhZ2VfY3VycmVudEZpbGVdLmJyYW5jaERhdGE7DQoNCiAgLy8gdGhpcyBjYW4gaGFwcGVuIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluIHRoZSBvcmlnaW5hbCBKYXZhU2NyaXB0IGZpbGUNCiAgaWYgKCEgbGluZXMpIHsNCiAgICBsaW5lcyA9IFtdOw0KICB9DQoNCiAgdmFyIHJvd3MgPSBbJzx0YWJsZSBpZD0ic291cmNlVGFibGUiPiddOw0KICB2YXIgaSA9IDA7DQogIHZhciBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KICB2YXIgdGFibGVIVE1MOw0KICB2YXIgY3VycmVudENvbmRpdGlvbmFsRW5kID0gMDsNCg0KICBmdW5jdGlvbiBqb2luVGFibGVSb3dzKCkgew0KICAgIHRhYmxlSFRNTCA9IHJvd3Muam9pbignJyk7DQogICAgUHJvZ3Jlc3NCYXIuc2V0UGVyY2VudGFnZShwcm9ncmVzc0JhciwgNjApOw0KICAgIC8qDQogICAgVGhpcyBtYXkgYmUgYSBsb25nIGRlbGF5LCBzbyBzZXQgYSB0aW1lb3V0IG9mIDEwMCBtcyB0byBtYWtlIHN1cmUgdGhlDQogICAgZGlzcGxheSBpcyB1cGRhdGVkLg0KICAgICovDQogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHthcHBlbmRUYWJsZShqc2NvdmVyYWdlX2N1cnJlbnRGaWxlKTt9LCAxMDApOw0KICB9DQoNCiAgZnVuY3Rpb24gYXBwZW5kVGFibGUoanNjb3ZlcmFnZV9jdXJyZW50RmlsZSkgew0KICAgIHZhciBzb3VyY2VEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc291cmNlRGl2Jyk7DQogICAgc291cmNlRGl2LmlubmVySFRNTCA9IHRhYmxlSFRNTDsNCiAgICBQcm9ncmVzc0Jhci5zZXRQZXJjZW50YWdlKHByb2dyZXNzQmFyLCA4MCk7DQogICAgc2V0VGltZW91dChqc2NvdmVyYWdlX3Njcm9sbFRvTGluZSwgMCk7DQogIH0NCg0KICB3aGlsZSAoaSA8IGxpbmVzLmxlbmd0aCkgew0KICAgIHZhciBsaW5lTnVtYmVyID0gaSArIDE7DQoNCiAgICBpZiAobGluZU51bWJlciA9PT0gY3VycmVudENvbmRpdGlvbmFsRW5kKSB7DQogICAgICBjdXJyZW50Q29uZGl0aW9uYWxFbmQgPSAwOw0KICAgIH0NCiAgICBlbHNlIGlmIChjdXJyZW50Q29uZGl0aW9uYWxFbmQgPT09IDAgJiYgY292ZXJhZ2UuY29uZGl0aW9uYWxzICYmIGNvdmVyYWdlLmNvbmRpdGlvbmFsc1tsaW5lTnVtYmVyXSkgew0KICAgICAgY3VycmVudENvbmRpdGlvbmFsRW5kID0gY292ZXJhZ2UuY29uZGl0aW9uYWxzW2xpbmVOdW1iZXJdOw0KICAgIH0NCg0KICAgIHZhciByb3cgPSAnPHRyPic7DQogICAgcm93ICs9ICc8dGQgY2xhc3M9Im51bWVyaWMiPicgKyBsaW5lTnVtYmVyICsgJzwvdGQ+JzsNCiAgICB2YXIgdGltZXNFeGVjdXRlZCA9IGNvdmVyYWdlW2xpbmVOdW1iZXJdOw0KICAgIGlmICh0aW1lc0V4ZWN1dGVkICE9PSB1bmRlZmluZWQgJiYgdGltZXNFeGVjdXRlZCAhPT0gbnVsbCkgew0KICAgICAgaWYgKGN1cnJlbnRDb25kaXRpb25hbEVuZCAhPT0gMCkgew0KICAgICAgICByb3cgKz0gJzx0ZCBjbGFzcz0ieSBudW1lcmljIj4nOw0KICAgICAgfQ0KICAgICAgZWxzZSBpZiAodGltZXNFeGVjdXRlZCA9PT0gMCkgew0KICAgICAgICByb3cgKz0gJzx0ZCBjbGFzcz0iciBudW1lcmljIiBpZD0ibGluZS0nICsgbGluZU51bWJlciArICciPic7DQogICAgICB9DQogICAgICBlbHNlIHsNCiAgICAgICAgcm93ICs9ICc8dGQgY2xhc3M9ImcgbnVtZXJpYyI+JzsNCiAgICAgIH0NCiAgICAgIHJvdyArPSB0aW1lc0V4ZWN1dGVkOw0KICAgICAgcm93ICs9ICc8L3RkPic7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgcm93ICs9ICc8dGQ+PC90ZD4nOw0KICAgIH0NCg0KICAgIGlmIChfJGpzY292ZXJhZ2VbanNjb3ZlcmFnZV9jdXJyZW50RmlsZV0uYnJhbmNoRGF0YSAhPT0gdW5kZWZpbmVkICYmIF8kanNjb3ZlcmFnZVtqc2NvdmVyYWdlX2N1cnJlbnRGaWxlXS5icmFuY2hEYXRhLmxlbmd0aCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHZhciBicmFuY2hDbGFzcyA9ICcnOw0KICAgICAgICB2YXIgYnJhbmNoVGV4dCA9ICcmIzE2MDsnOw0KICAgICAgICBpZiAoYnJhbmNoRGF0YVtsaW5lTnVtYmVyXSAhPT0gdW5kZWZpbmVkICYmIGJyYW5jaERhdGFbbGluZU51bWJlcl0gIT09IG51bGwpIHsNCiAgICAgICAgICAgIGJyYW5jaENsYXNzID0gJ2cnOw0KICAgICAgICAgICAgZm9yICh2YXIgY29uZGl0aW9uSW5kZXggPSAwOyBjb25kaXRpb25JbmRleCA8IGJyYW5jaERhdGFbbGluZU51bWJlcl0ubGVuZ3RoOyBjb25kaXRpb25JbmRleCsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGJyYW5jaERhdGFbbGluZU51bWJlcl1bY29uZGl0aW9uSW5kZXhdICE9PSB1bmRlZmluZWQgJiYgYnJhbmNoRGF0YVtsaW5lTnVtYmVyXVtjb25kaXRpb25JbmRleF0gIT09IG51bGwgJiYgIWJyYW5jaERhdGFbbGluZU51bWJlcl1bY29uZGl0aW9uSW5kZXhdLmNvdmVyZWQoKSkgew0KICAgICAgICAgICAgICAgICAgICBicmFuY2hDbGFzcyA9ICdyJzsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0NCiAgICAgICAgaWYgKGJyYW5jaENsYXNzID09PSAncicpIHsNCiAgICAgICAgICAgIGJyYW5jaFRleHQgPSAnPGEgaHJlZj0iIyIgb25jbGljaz0iYWxlcnQoYnVpbGRCcmFuY2hNZXNzYWdlKF8kanNjb3ZlcmFnZVtcJycranNjb3ZlcmFnZV9jdXJyZW50RmlsZSsnXCddLmJyYW5jaERhdGFbJytsaW5lTnVtYmVyKyddKSk7Ij5pbmZvPC9hPic7DQogICAgICAgIH0NCiAgICAgICAgcm93ICs9ICc8dGQgY2xhc3M9Im51bWVyaWMgJyticmFuY2hDbGFzcysnIj48cHJlPicgKyBicmFuY2hUZXh0ICsgJzwvcHJlPjwvdGQ+JzsNCiAgICB9DQoNCiAgICByb3cgKz0gJzx0ZD48cHJlPicgKyBsaW5lc1tpXSArICc8L3ByZT48L3RkPic7DQogICAgcm93ICs9ICc8L3RyPic7DQogICAgcm93ICs9ICdcbic7DQogICAgcm93c1tsaW5lTnVtYmVyXSA9IHJvdzsNCiAgICBpKys7DQogIH0NCiAgcm93c1tpICsgMV0gPSAnPC90YWJsZT4nOw0KICBQcm9ncmVzc0Jhci5zZXRQZXJjZW50YWdlKHByb2dyZXNzQmFyLCA0MCk7DQogIHNldFRpbWVvdXQoam9pblRhYmxlUm93cywgMCk7DQp9DQoNCmZ1bmN0aW9uIGpzY292ZXJhZ2Vfc2Nyb2xsVG9MaW5lKCkgew0KICBqc2NvdmVyYWdlX3NlbGVjdFRhYignc291cmNlVGFiJyk7DQogIGlmICghIHdpbmRvdy5qc2NvdmVyYWdlX2N1cnJlbnRMaW5lKSB7DQogICAganNjb3ZlcmFnZV9lbmRMZW5ndGh5T3BlcmF0aW9uKCk7DQogICAgcmV0dXJuOw0KICB9DQogIHZhciBkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc291cmNlRGl2Jyk7DQogIGlmIChqc2NvdmVyYWdlX2N1cnJlbnRMaW5lID09PSAxKSB7DQogICAgZGl2LnNjcm9sbFRvcCA9IDA7DQogIH0NCiAgZWxzZSB7DQogICAgdmFyIGNlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGluZS0nICsganNjb3ZlcmFnZV9jdXJyZW50TGluZSk7DQoNCiAgICAvLyB0aGlzIG1pZ2h0IG5vdCBiZSB0aGVyZSBpZiB0aGVyZSBpcyBhbiBlcnJvciBpbiB0aGUgb3JpZ2luYWwgSmF2YVNjcmlwdA0KICAgIGlmIChjZWxsKSB7DQogICAgICB2YXIgZGl2T2Zmc2V0ID0ganNjb3ZlcmFnZV9maW5kUG9zKGRpdik7DQogICAgICB2YXIgY2VsbE9mZnNldCA9IGpzY292ZXJhZ2VfZmluZFBvcyhjZWxsKTsNCiAgICAgIGRpdi5zY3JvbGxUb3AgPSBjZWxsT2Zmc2V0IC0gZGl2T2Zmc2V0Ow0KICAgIH0NCiAgfQ0KICBqc2NvdmVyYWdlX2N1cnJlbnRMaW5lID0gMDsNCiAganNjb3ZlcmFnZV9lbmRMZW5ndGh5T3BlcmF0aW9uKCk7DQp9DQoNCi8qKg0KTG9hZHMgdGhlIGdpdmVuIGZpbGUgKGFuZCBvcHRpb25hbCBsaW5lKSBpbiB0aGUgc291cmNlIHRhYi4NCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2dldChmaWxlLCBsaW5lKSB7DQogIGlmIChqc2NvdmVyYWdlX2luTGVuZ3RoeU9wZXJhdGlvbikgew0KICAgIHJldHVybjsNCiAgfQ0KICBqc2NvdmVyYWdlX2JlZ2luTGVuZ3RoeU9wZXJhdGlvbigpOw0KICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgIHZhciBzb3VyY2VEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc291cmNlRGl2Jyk7DQogICAgc291cmNlRGl2LmlubmVySFRNTCA9ICcnOw0KICAgIGpzY292ZXJhZ2Vfc2VsZWN0VGFiKCdzb3VyY2VUYWInKTsNCiAgICBpZiAoZmlsZSA9PT0ganNjb3ZlcmFnZV9jdXJyZW50RmlsZSkgew0KICAgICAganNjb3ZlcmFnZV9jdXJyZW50TGluZSA9IGxpbmU7DQogICAgICBqc2NvdmVyYWdlX3JlY2FsY3VsYXRlU291cmNlVGFiKCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgaWYgKGpzY292ZXJhZ2VfY3VycmVudEZpbGUgPT09IG51bGwpIHsNCiAgICAgICAgdmFyIHRhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2VUYWInKTsNCiAgICAgICAgdGFiLmNsYXNzTmFtZSA9ICcnOw0KICAgICAgICB0YWIub25jbGljayA9IGpzY292ZXJhZ2VfdGFiX2NsaWNrOw0KICAgICAgfQ0KICAgICAganNjb3ZlcmFnZV9jdXJyZW50RmlsZSA9IGZpbGU7DQogICAgICBqc2NvdmVyYWdlX2N1cnJlbnRMaW5lID0gbGluZSB8fCAxOyAgLy8gd2hlbiBjaGFuZ2luZyB0aGUgc291cmNlLCBhbHdheXMgc2Nyb2xsIHRvIHRvcA0KICAgICAgdmFyIGZpbGVEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZURpdicpOw0KICAgICAgZmlsZURpdi5pbm5lckhUTUwgPSBqc2NvdmVyYWdlX2N1cnJlbnRGaWxlOw0KICAgICAganNjb3ZlcmFnZV9yZWNhbGN1bGF0ZVNvdXJjZVRhYigpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgfSwgNTApOw0KfQ0KDQovKioNCkNhbGN1bGF0ZXMgY292ZXJhZ2Ugc3RhdGlzdGljcyBmb3IgdGhlIGN1cnJlbnQgc291cmNlIGZpbGUuDQoqLw0KZnVuY3Rpb24ganNjb3ZlcmFnZV9yZWNhbGN1bGF0ZVNvdXJjZVRhYigpIHsNCiAgaWYgKCEganNjb3ZlcmFnZV9jdXJyZW50RmlsZSkgew0KICAgIGpzY292ZXJhZ2VfZW5kTGVuZ3RoeU9wZXJhdGlvbigpOw0KICAgIHJldHVybjsNCiAgfQ0KICB2YXIgcHJvZ3Jlc3NMYWJlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0xhYmVsJyk7DQogIHByb2dyZXNzTGFiZWwuaW5uZXJIVE1MID0gJ0NhbGN1bGF0aW5nIGNvdmVyYWdlIC4uLic7DQogIHZhciBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzc0JhcicpOw0KICBQcm9ncmVzc0Jhci5zZXRQZXJjZW50YWdlKHByb2dyZXNzQmFyLCAyMCk7DQogIHZhciByZXF1ZXN0ID0ganNjb3ZlcmFnZV9jcmVhdGVSZXF1ZXN0KCk7DQogIHRyeSB7DQogICAgdmFyIHJlbGF0aXZlVXJsID0ganNjb3ZlcmFnZV9jdXJyZW50RmlsZTsNCiAgICBpZiAocmVsYXRpdmVVcmwuY2hhckF0KDApICE9PSAnLycpDQogICAgICByZWxhdGl2ZVVybCA9ICcvJyArIHJlbGF0aXZlVXJsOw0KICAgIGlmICghanNjb3ZlcmFnZV9pc1NlcnZlcikNCiAgICAgIHJlbGF0aXZlVXJsID0gJ29yaWdpbmFsLXNyYycgKyByZWxhdGl2ZVVybDsNCiAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHJlbGF0aXZlVXJsLCB0cnVlKTsNCiAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoIk5vSW5zdHJ1bWVudCIsICJ0cnVlIik7DQogICAgcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgIGlmIChyZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBpZiAocmVxdWVzdC5zdGF0dXMgIT09IDAgJiYgcmVxdWVzdC5zdGF0dXMgIT09IDIwMCkgew0KICAgICAgICAgICAgdGhyb3cgcmVxdWVzdC5zdGF0dXM7DQogICAgICAgICAgfQ0KICAgICAgICAgIHZhciByZXNwb25zZSA9IHJlcXVlc3QucmVzcG9uc2VUZXh0Ow0KICAgICAgICAgIGlmIChyZXNwb25zZSA9PT0gJycpIHsNCiAgICAgICAgICAgIHRocm93IDQwNDsNCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIGRpc3BsYXlTb3VyY2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgdmFyIGxpbmVzID0gcmVzcG9uc2Uuc3BsaXQoL1xuLyk7DQogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspDQogICAgICAgICAgICAgICAgICBsaW5lc1tpXSA9IGpzY292ZXJhZ2VfaHRtbF9lc2NhcGUobGluZXNbaV0pOw0KICAgICAgICAgICAgICBqc2NvdmVyYWdlX21ha2VUYWJsZShsaW5lcyk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHNldFRpbWVvdXQoZGlzcGxheVNvdXJjZSwgMCk7DQogICAgICAgICAgc3VtbWFyeVRocm9iYmVyLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgIHJlcG9ydEVycm9yKGUpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfTsNCiAgICByZXF1ZXN0LnNlbmQobnVsbCk7DQogIH0NCiAgY2F0Y2ggKGUpIHsNCiAgICByZXBvcnRFcnJvcihlKTsNCiAgfQ0KfQ0KDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLy8gdGFicw0KDQovKioNCkluaXRpYWxpemVzIHRoZSB0YWIgY29udHJvbC4gIFRoaXMgZnVuY3Rpb24gbXVzdCBiZSBjYWxsZWQgd2hlbiB0aGUgZG9jdW1lbnQgaXMNCmxvYWRlZC4NCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX2luaXRUYWJDb250cm9sKCkgew0KICB2YXIgdGFicyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWJzJyk7DQogIHZhciBpOw0KICB2YXIgY2hpbGQ7DQogIHZhciB0YWJOdW0gPSAwOw0KICBmb3IgKGkgPSAwOyBpIDwgdGFicy5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7DQogICAgY2hpbGQgPSB0YWJzLmNoaWxkTm9kZXMuaXRlbShpKTsNCiAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IDEpIHsNCiAgICAgIGlmIChjaGlsZC5jbGFzc05hbWUgIT09ICdkaXNhYmxlZCcpIHsNCiAgICAgICAgY2hpbGQub25jbGljayA9IGpzY292ZXJhZ2VfdGFiX2NsaWNrOw0KICAgICAgfQ0KICAgICAgdGFiTnVtKys7DQogICAgfQ0KICB9DQogIGpzY292ZXJhZ2Vfc2VsZWN0VGFiKDApOw0KfQ0KDQovKioNClNlbGVjdHMgYSB0YWIuDQpAcGFyYW0gIHRhYiAgdGhlIGludGVnZXIgaW5kZXggb2YgdGhlIHRhYiAoMCwgMSwgMiwgb3IgMykNCiAgICAgICAgICAgICBPUg0KICAgICAgICAgICAgIHRoZSBJRCBvZiB0aGUgdGFiIGVsZW1lbnQNCiAgICAgICAgICAgICBPUg0KICAgICAgICAgICAgIHRoZSB0YWIgZWxlbWVudCBpdHNlbGYNCiovDQpmdW5jdGlvbiBqc2NvdmVyYWdlX3NlbGVjdFRhYih0YWIpIHsNCiAgaWYgKHR5cGVvZiB0YWIgIT09ICdudW1iZXInKSB7DQogICAgdGFiID0ganNjb3ZlcmFnZV90YWJJbmRleE9mKHRhYik7DQogIH0NCiAgdmFyIHRhYnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFicycpOw0KICB2YXIgdGFiUGFnZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiUGFnZXMnKTsNCiAgdmFyIG5vZGVMaXN0Ow0KICB2YXIgdGFiTnVtOw0KICB2YXIgaTsNCiAgdmFyIG5vZGU7DQoNCiAgbm9kZUxpc3QgPSB0YWJzLmNoaWxkTm9kZXM7DQogIHRhYk51bSA9IDA7DQogIGZvciAoaSA9IDA7IGkgPCBub2RlTGlzdC5sZW5ndGg7IGkrKykgew0KICAgIG5vZGUgPSBub2RlTGlzdC5pdGVtKGkpOw0KICAgIGlmIChub2RlLm5vZGVUeXBlICE9PSAxKSB7DQogICAgICBjb250aW51ZTsNCiAgICB9DQoNCiAgICBpZiAobm9kZS5jbGFzc05hbWUgIT09ICdkaXNhYmxlZCcpIHsNCiAgICAgIGlmICh0YWJOdW0gPT09IHRhYikgew0KICAgICAgICBub2RlLmNsYXNzTmFtZSA9ICdzZWxlY3RlZCc7DQogICAgICB9DQogICAgICBlbHNlIHsNCiAgICAgICAgbm9kZS5jbGFzc05hbWUgPSAnJzsNCiAgICAgIH0NCiAgICB9DQogICAgdGFiTnVtKys7DQogIH0NCg0KICBub2RlTGlzdCA9IHRhYlBhZ2VzLmNoaWxkTm9kZXM7DQogIHRhYk51bSA9IDA7DQogIGZvciAoaSA9IDA7IGkgPCBub2RlTGlzdC5sZW5ndGg7IGkrKykgew0KICAgIG5vZGUgPSBub2RlTGlzdC5pdGVtKGkpOw0KICAgIGlmIChub2RlLm5vZGVUeXBlICE9PSAxKSB7DQogICAgICBjb250aW51ZTsNCiAgICB9DQoNCiAgICBpZiAodGFiTnVtID09PSB0YWIpIHsNCiAgICAgIG5vZGUuY2xhc3NOYW1lID0gJ3NlbGVjdGVkIFRhYlBhZ2UnOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgIG5vZGUuY2xhc3NOYW1lID0gJ1RhYlBhZ2UnOw0KICAgIH0NCiAgICB0YWJOdW0rKzsNCiAgfQ0KfQ0KDQovKioNClJldHVybnMgYW4gaW50ZWdlciAoMCwgMSwgMiwgb3IgMykgcmVwcmVzZW50aW5nIHRoZSBpbmRleCBvZiBhIGdpdmVuIHRhYi4NCkBwYXJhbSAgdGFiICB0aGUgSUQgb2YgdGhlIHRhYiBlbGVtZW50DQogICAgICAgICAgICAgT1INCiAgICAgICAgICAgICB0aGUgdGFiIGVsZW1lbnQgaXRzZWxmDQoqLw0KZnVuY3Rpb24ganNjb3ZlcmFnZV90YWJJbmRleE9mKHRhYikgew0KICBpZiAodHlwZW9mIHRhYiA9PT0gJ3N0cmluZycpIHsNCiAgICB0YWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWIpOw0KICB9DQogIHZhciB0YWJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYnMnKTsNCiAgdmFyIGk7DQogIHZhciBjaGlsZDsNCiAgdmFyIHRhYk51bSA9IDA7DQogIGZvciAoaSA9IDA7IGkgPCB0YWJzLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsNCiAgICBjaGlsZCA9IHRhYnMuY2hpbGROb2Rlcy5pdGVtKGkpOw0KICAgIGlmIChjaGlsZC5ub2RlVHlwZSA9PT0gMSkgew0KICAgICAgaWYgKGNoaWxkID09PSB0YWIpIHsNCiAgICAgICAgcmV0dXJuIHRhYk51bTsNCiAgICAgIH0NCiAgICAgIHRhYk51bSsrOw0KICAgIH0NCiAgfQ0KLy8jSlNDT1ZFUkFHRV9JRiAwDQogIHRocm93ICJUYWIgbm90IGZvdW5kIjsNCi8vI0pTQ09WRVJBR0VfRU5ESUYNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV90YWJfY2xpY2soZSkgew0KICBpZiAoanNjb3ZlcmFnZV9pbkxlbmd0aHlPcGVyYXRpb24pIHsNCiAgICByZXR1cm47DQogIH0NCiAgdmFyIHRhcmdldDsNCi8vI0pTQ09WRVJBR0VfSUYNCiAgaWYgKGUpIHsNCiAgICB0YXJnZXQgPSBlLnRhcmdldDsNCiAgfQ0KICBlbHNlIGlmICh3aW5kb3cuZXZlbnQpIHsNCiAgICAvLyBJRQ0KICAgIHRhcmdldCA9IHdpbmRvdy5ldmVudC5zcmNFbGVtZW50Ow0KICB9DQogIGlmICh0YXJnZXQuY2xhc3NOYW1lID09PSAnc2VsZWN0ZWQnKSB7DQogICAgcmV0dXJuOw0KICB9DQogIGpzY292ZXJhZ2VfYmVnaW5MZW5ndGh5T3BlcmF0aW9uKCk7DQogIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgaWYgKHRhcmdldC5pZCA9PT0gJ3N1bW1hcnlUYWInKSB7DQogICAgICB2YXIgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3VtbWFyeVRib2R5Iik7DQogICAgICB3aGlsZSAodGJvZHkuaGFzQ2hpbGROb2RlcygpKSB7DQogICAgICAgIHRib2R5LnJlbW92ZUNoaWxkKHRib2R5LmZpcnN0Q2hpbGQpOw0KICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmICh0YXJnZXQuaWQgPT09ICdzb3VyY2VUYWInKSB7DQogICAgICB2YXIgc291cmNlRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdXJjZURpdicpOw0KICAgICAgc291cmNlRGl2LmlubmVySFRNTCA9ICcnOw0KICAgIH0NCiAgICBqc2NvdmVyYWdlX3NlbGVjdFRhYih0YXJnZXQpOw0KICAgIGlmICh0YXJnZXQuaWQgPT09ICdzdW1tYXJ5VGFiJykgew0KICAgICAganNjb3ZlcmFnZV9yZWNhbGN1bGF0ZVN1bW1hcnlUYWIoKTsNCiAgICB9DQogICAgZWxzZSBpZiAodGFyZ2V0LmlkID09PSAnc291cmNlVGFiJykgew0KICAgICAganNjb3ZlcmFnZV9yZWNhbGN1bGF0ZVNvdXJjZVRhYigpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgIGpzY292ZXJhZ2VfZW5kTGVuZ3RoeU9wZXJhdGlvbigpOw0KICAgIH0NCiAgfSwgNTApOw0KfQ0KDQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLy8gcHJvZ3Jlc3MgYmFyDQoNCnZhciBQcm9ncmVzc0JhciA9IHsNCiAgaW5pdDogZnVuY3Rpb24oZWxlbWVudCkgew0KICAgIGVsZW1lbnQuX3BlcmNlbnRhZ2UgPSAwOw0KDQogICAgLyogZG9pbmcgdGhpcyB2aWEgSmF2YVNjcmlwdCBjcmFzaGVzIFNhZmFyaSAqLw0KLyoNCiAgICB2YXIgcGN0R3JhcGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICBwY3RHcmFwaC5jbGFzc05hbWUgPSAncGN0R3JhcGgnOw0KICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQocGN0R3JhcGgpOw0KICAgIHZhciBjb3ZlcmVkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgY292ZXJlZC5jbGFzc05hbWUgPSAnY292ZXJlZCc7DQogICAgcGN0R3JhcGguYXBwZW5kQ2hpbGQoY292ZXJlZCk7DQogICAgdmFyIHBjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsNCiAgICBwY3QuY2xhc3NOYW1lID0gJ3BjdCc7DQogICAgZWxlbWVudC5hcHBlbmRDaGlsZChwY3QpOw0KKi8NCg0KICAgIFByb2dyZXNzQmFyLl91cGRhdGUoZWxlbWVudCk7DQogIH0sDQogIHNldFBlcmNlbnRhZ2U6IGZ1bmN0aW9uKGVsZW1lbnQsIHBlcmNlbnRhZ2UpIHsNCiAgICBlbGVtZW50Ll9wZXJjZW50YWdlID0gcGVyY2VudGFnZTsNCiAgICBQcm9ncmVzc0Jhci5fdXBkYXRlKGVsZW1lbnQpOw0KICB9LA0KICBfdXBkYXRlOiBmdW5jdGlvbihlbGVtZW50KSB7DQogICAgdmFyIHBjdEdyYXBoID0gZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZGl2JykuaXRlbSgwKTsNCiAgICB2YXIgY292ZXJlZCA9IHBjdEdyYXBoLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKS5pdGVtKDApOw0KICAgIHZhciBwY3QgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzcGFuJykuaXRlbSgwKTsNCiAgICBwY3QuaW5uZXJIVE1MID0gZWxlbWVudC5fcGVyY2VudGFnZS50b1N0cmluZygpICsgJyUnOw0KICAgIGNvdmVyZWQuc3R5bGUud2lkdGggPSBlbGVtZW50Ll9wZXJjZW50YWdlICsgJ3B4JzsNCiAgfQ0KfTsNCg0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi8vIHJlcG9ydHMNCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9wYWQocykgew0KICByZXR1cm4gJzAwMDAnLnN1YnN0cihzLmxlbmd0aCkgKyBzOw0KfQ0KDQpmdW5jdGlvbiBqc2NvdmVyYWdlX3NlcmlhbGl6ZUNvdmVyYWdlVG9KU09OKCkgew0KICB2YXIganNvbiA9IFtdOw0KICBmb3IgKHZhciBmaWxlIGluIF8kanNjb3ZlcmFnZSkgew0KICAgIHZhciBjb3ZlcmFnZSA9IF8kanNjb3ZlcmFnZVtmaWxlXS5saW5lRGF0YTsNCg0KICAgIHZhciBhcnJheSA9IFtdOw0KICAgIHZhciBsZW5ndGggPSBjb3ZlcmFnZS5sZW5ndGg7DQogICAgZm9yICh2YXIgbGluZSA9IDA7IGxpbmUgPCBsZW5ndGg7IGxpbmUrKykgew0KICAgICAgdmFyIHZhbHVlID0gY292ZXJhZ2VbbGluZV07DQogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkgew0KICAgICAgICB2YWx1ZSA9ICdudWxsJzsNCiAgICAgIH0NCiAgICAgIGFycmF5LnB1c2godmFsdWUpOw0KICAgIH0NCg0KICAgIGpzb24ucHVzaChqc2NvdmVyYWdlX3F1b3RlKGZpbGUpICsgJzp7ImxpbmVEYXRhIjpbJyArIGFycmF5LmpvaW4oJywnKSArICddLCJicmFuY2hEYXRhIjonICsgY29udmVydEJyYW5jaERhdGFMaW5lc1RvSlNPTihfJGpzY292ZXJhZ2VbZmlsZV0uYnJhbmNoRGF0YSkgKyAnfScpOw0KICB9DQogIHJldHVybiAneycgKyBqc29uLmpvaW4oJywnKSArICd9JzsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9zdG9yZUJ1dHRvbl9jbGljaygpIHsNCiAgaWYgKGpzY292ZXJhZ2VfaW5MZW5ndGh5T3BlcmF0aW9uKSB7DQogICAgcmV0dXJuOw0KICB9DQoNCiAganNjb3ZlcmFnZV9iZWdpbkxlbmd0aHlPcGVyYXRpb24oKTsNCiAgdmFyIGltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9yZUltZycpOw0KICBpbWcuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsNCg0KICB2YXIgcmVxdWVzdCA9IGpzY292ZXJhZ2VfY3JlYXRlUmVxdWVzdCgpOw0KICByZXF1ZXN0Lm9wZW4oJ1BPU1QnLCAnL2pzY292ZXJhZ2Utc3RvcmUnLCB0cnVlKTsNCiAgcmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7DQogICAgICB2YXIgbWVzc2FnZTsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyAhPT0gMjAwICYmIHJlcXVlc3Quc3RhdHVzICE9PSAyMDEgJiYgcmVxdWVzdC5zdGF0dXMgIT09IDIwNCkgew0KICAgICAgICAgIHRocm93IHJlcXVlc3Quc3RhdHVzOw0KICAgICAgICB9DQogICAgICAgIG1lc3NhZ2UgPSByZXF1ZXN0LnJlc3BvbnNlVGV4dDsNCiAgICAgIH0NCiAgICAgIGNhdGNoIChlKSB7DQogICAgICAgIGlmIChlLnRvU3RyaW5nKCkuc2VhcmNoKC9eXGR7M30kLykgPT09IDApIHsNCiAgICAgICAgICBtZXNzYWdlID0gZSArICc6ICcgKyByZXF1ZXN0LnJlc3BvbnNlVGV4dDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBtZXNzYWdlID0gJ0NvdWxkIG5vdCBjb25uZWN0IHRvIHNlcnZlcjogJyArIGU7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAganNjb3ZlcmFnZV9lbmRMZW5ndGh5T3BlcmF0aW9uKCk7DQogICAgICB2YXIgaW1nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0b3JlSW1nJyk7DQogICAgICBpbWcuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOw0KDQogICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0b3JlRGl2Jyk7DQogICAgICBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobmV3IERhdGUoKSArICc6ICcgKyBtZXNzYWdlKSk7DQogICAgICBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnInKSk7DQogICAgfQ0KICB9Ow0KICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7DQogIHZhciBqc29uID0ganNjb3ZlcmFnZV9zZXJpYWxpemVDb3ZlcmFnZVRvSlNPTigpOw0KICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtTGVuZ3RoJywganNvbi5sZW5ndGgudG9TdHJpbmcoKSk7DQogIHJlcXVlc3Quc2VuZChqc29uKTsNCn0NCmZ1bmN0aW9uIGpzY292ZXJhZ2VfcXVvdGUocykgew0KICByZXR1cm4gJyInICsgcy5yZXBsYWNlKC9bXHUwMDAwLVx1MDAxZiJcXFx1MDA3Zi1cdWZmZmZdL2csIGZ1bmN0aW9uIChjKSB7DQogICAgc3dpdGNoIChjKSB7DQogICAgY2FzZSAnXGInOg0KICAgICAgcmV0dXJuICdcXGInOw0KICAgIGNhc2UgJ1xmJzoNCiAgICAgIHJldHVybiAnXFxmJzsNCiAgICBjYXNlICdcbic6DQogICAgICByZXR1cm4gJ1xcbic7DQogICAgY2FzZSAnXHInOg0KICAgICAgcmV0dXJuICdcXHInOw0KICAgIGNhc2UgJ1x0JzoNCiAgICAgIHJldHVybiAnXFx0JzsNCiAgICAvLyBJRSBkb2Vzbid0IHN1cHBvcnQgdGhpcw0KICAgIC8qDQogICAgY2FzZSAnXHYnOg0KICAgICAgcmV0dXJuICdcXHYnOw0KICAgICovDQogICAgY2FzZSAnIic6DQogICAgICByZXR1cm4gJ1xcIic7DQogICAgY2FzZSAnXFwnOg0KICAgICAgcmV0dXJuICdcXFxcJzsNCiAgICBkZWZhdWx0Og0KICAgICAgcmV0dXJuICdcXHUnICsganNjb3ZlcmFnZV9wYWQoYy5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSk7DQogICAgfQ0KICB9KSArICciJzsNCn0NCg0KZnVuY3Rpb24ganNjb3ZlcmFnZV9odG1sX2VzY2FwZShzKSB7DQogICAgcmV0dXJuIHMucmVwbGFjZSgvWzw+XCZcIlwnXS9nLCBmdW5jdGlvbihjKSB7DQogICAgcmV0dXJuICcmIycgKyBjLmNoYXJDb2RlQXQoMCkgKyAnOyc7DQogIH0pOw0KfQ0KZnVuY3Rpb24gQnJhbmNoRGF0YSgpIHsNCiAgICB0aGlzLnBvc2l0aW9uID0gLTE7DQogICAgdGhpcy5ub2RlTGVuZ3RoID0gLTE7DQogICAgdGhpcy5zcmMgPSBudWxsOw0KICAgIHRoaXMuZXZhbEZhbHNlID0gMDsNCiAgICB0aGlzLmV2YWxUcnVlID0gMDsNCg0KICAgIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKHBvc2l0aW9uLCBub2RlTGVuZ3RoLCBzcmMpIHsNCiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uOw0KICAgICAgICB0aGlzLm5vZGVMZW5ndGggPSBub2RlTGVuZ3RoOw0KICAgICAgICB0aGlzLnNyYyA9IHNyYzsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgdGhpcy5yYW5Db25kaXRpb24gPSBmdW5jdGlvbihyZXN1bHQpIHsNCiAgICAgICAgaWYgKHJlc3VsdCkNCiAgICAgICAgICAgIHRoaXMuZXZhbFRydWUrKzsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdGhpcy5ldmFsRmFsc2UrKzsNCiAgICB9Ow0KDQogICAgdGhpcy5wYXRoc0NvdmVyZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIHBhdGhzID0gMDsNCiAgICAgICAgaWYgKHRoaXMuZXZhbFRydWUgPiAwKQ0KICAgICAgICAgIHBhdGhzKys7DQogICAgICAgIGlmICh0aGlzLmV2YWxGYWxzZSA+IDApDQogICAgICAgICAgcGF0aHMrKzsNCiAgICAgICAgcmV0dXJuIHBhdGhzOw0KICAgIH07DQoNCiAgICB0aGlzLmNvdmVyZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZXZhbFRydWUgPiAwICYmIHRoaXMuZXZhbEZhbHNlID4gMDsNCiAgICB9Ow0KDQogICAgdGhpcy50b0pTT04gPSBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuICd7InBvc2l0aW9uIjonICsgdGhpcy5wb3NpdGlvbg0KICAgICAgICAgICAgKyAnLCJub2RlTGVuZ3RoIjonICsgdGhpcy5ub2RlTGVuZ3RoDQogICAgICAgICAgICArICcsInNyYyI6JyArIGpzY292ZXJhZ2VfcXVvdGUodGhpcy5zcmMpDQogICAgICAgICAgICArICcsImV2YWxGYWxzZSI6JyArIHRoaXMuZXZhbEZhbHNlDQogICAgICAgICAgICArICcsImV2YWxUcnVlIjonICsgdGhpcy5ldmFsVHJ1ZSArICd9JzsNCiAgICB9Ow0KDQogICAgdGhpcy5tZXNzYWdlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGlmICh0aGlzLmV2YWxUcnVlID09PSAwICYmIHRoaXMuZXZhbEZhbHNlID09PSAwKQ0KICAgICAgICAgICAgcmV0dXJuICdDb25kaXRpb24gbmV2ZXIgZXZhbHVhdGVkICAgICAgICAgOlx0JyArIHRoaXMuc3JjOw0KICAgICAgICBlbHNlIGlmICh0aGlzLmV2YWxUcnVlID09PSAwKQ0KICAgICAgICAgICAgcmV0dXJuICdDb25kaXRpb24gbmV2ZXIgZXZhbHVhdGVkIHRvIHRydWUgOlx0JyArIHRoaXMuc3JjOw0KICAgICAgICBlbHNlIGlmICh0aGlzLmV2YWxGYWxzZSA9PT0gMCkNCiAgICAgICAgICAgIHJldHVybiAnQ29uZGl0aW9uIG5ldmVyIGV2YWx1YXRlZCB0byBmYWxzZTpcdCcgKyB0aGlzLnNyYzsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuICdDb25kaXRpb24gY292ZXJlZCc7DQogICAgfTsNCn0NCg0KQnJhbmNoRGF0YS5mcm9tSnNvbiA9IGZ1bmN0aW9uKGpzb25TdHJpbmcpIHsNCiAgICB2YXIganNvbiA9IGV2YWwoJygnICsganNvblN0cmluZyArICcpJyk7DQogICAgdmFyIGJyYW5jaERhdGEgPSBuZXcgQnJhbmNoRGF0YSgpOw0KICAgIGJyYW5jaERhdGEuaW5pdChqc29uLnBvc2l0aW9uLCBqc29uLm5vZGVMZW5ndGgsIGpzb24uc3JjKTsNCiAgICBicmFuY2hEYXRhLmV2YWxGYWxzZSA9IGpzb24uZXZhbEZhbHNlOw0KICAgIGJyYW5jaERhdGEuZXZhbFRydWUgPSBqc29uLmV2YWxUcnVlOw0KICAgIHJldHVybiBicmFuY2hEYXRhOw0KfTsNCg0KQnJhbmNoRGF0YS5mcm9tSnNvbk9iamVjdCA9IGZ1bmN0aW9uKGpzb24pIHsNCiAgICB2YXIgYnJhbmNoRGF0YSA9IG5ldyBCcmFuY2hEYXRhKCk7DQogICAgYnJhbmNoRGF0YS5pbml0KGpzb24ucG9zaXRpb24sIGpzb24ubm9kZUxlbmd0aCwganNvbi5zcmMpOw0KICAgIGJyYW5jaERhdGEuZXZhbEZhbHNlID0ganNvbi5ldmFsRmFsc2U7DQogICAgYnJhbmNoRGF0YS5ldmFsVHJ1ZSA9IGpzb24uZXZhbFRydWU7DQogICAgcmV0dXJuIGJyYW5jaERhdGE7DQp9Ow0KDQpmdW5jdGlvbiBidWlsZEJyYW5jaE1lc3NhZ2UoY29uZGl0aW9ucykgew0KICAgIHZhciBtZXNzYWdlID0gJ1RoZSBmb2xsb3dpbmcgd2FzIG5vdCBjb3ZlcmVkOic7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb25kaXRpb25zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGlmIChjb25kaXRpb25zW2ldICE9PSB1bmRlZmluZWQgJiYgY29uZGl0aW9uc1tpXSAhPT0gbnVsbCAmJiAhY29uZGl0aW9uc1tpXS5jb3ZlcmVkKCkpDQogICAgICAgICAgbWVzc2FnZSArPSAnXG4tICcrIGNvbmRpdGlvbnNbaV0ubWVzc2FnZSgpOw0KICAgIH0NCiAgICByZXR1cm4gbWVzc2FnZTsNCn07DQoNCmZ1bmN0aW9uIGNvbnZlcnRCcmFuY2hEYXRhQ29uZGl0aW9uQXJyYXlUb0pTT04oYnJhbmNoRGF0YUNvbmRpdGlvbkFycmF5KSB7DQogICAgdmFyIGFycmF5ID0gW107DQogICAgdmFyIGxlbmd0aCA9IGJyYW5jaERhdGFDb25kaXRpb25BcnJheS5sZW5ndGg7DQogICAgZm9yICh2YXIgY29uZGl0aW9uID0gMDsgY29uZGl0aW9uIDwgbGVuZ3RoOyBjb25kaXRpb24rKykgew0KICAgICAgICB2YXIgYnJhbmNoRGF0YU9iamVjdCA9IGJyYW5jaERhdGFDb25kaXRpb25BcnJheVtjb25kaXRpb25dOw0KICAgICAgICBpZiAoYnJhbmNoRGF0YU9iamVjdCA9PT0gdW5kZWZpbmVkIHx8IGJyYW5jaERhdGFPYmplY3QgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHZhbHVlID0gJ251bGwnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdmFsdWUgPSBicmFuY2hEYXRhT2JqZWN0LnRvSlNPTigpOw0KICAgICAgICB9DQogICAgICAgIGFycmF5LnB1c2godmFsdWUpOw0KICAgIH0NCiAgICByZXR1cm4gJ1snICsgYXJyYXkuam9pbignLCcpICsgJ10nOw0KfQ0KDQpmdW5jdGlvbiBjb252ZXJ0QnJhbmNoRGF0YUxpbmVzVG9KU09OKGJyYW5jaERhdGEpIHsNCiAgICBpZiAoYnJhbmNoRGF0YSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybiAnW10nDQogICAgfQ0KICAgIHZhciBhcnJheSA9IFtdOw0KICAgIHZhciBsZW5ndGggPSBicmFuY2hEYXRhLmxlbmd0aDsNCiAgICBmb3IgKHZhciBsaW5lID0gMDsgbGluZSA8IGxlbmd0aDsgbGluZSsrKSB7DQogICAgICAgIHZhciBicmFuY2hEYXRhT2JqZWN0ID0gYnJhbmNoRGF0YVtsaW5lXTsNCiAgICAgICAgaWYgKGJyYW5jaERhdGFPYmplY3QgPT09IHVuZGVmaW5lZCB8fCBicmFuY2hEYXRhT2JqZWN0ID09PSBudWxsKSB7DQogICAgICAgICAgICB2YWx1ZSA9ICdudWxsJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHZhbHVlID0gY29udmVydEJyYW5jaERhdGFDb25kaXRpb25BcnJheVRvSlNPTihicmFuY2hEYXRhT2JqZWN0KTsNCiAgICAgICAgfQ0KICAgICAgICBhcnJheS5wdXNoKHZhbHVlKTsNCiAgICB9DQogICAgcmV0dXJuICdbJyArIGFycmF5LmpvaW4oJywnKSArICddJzsNCn0NCg0KZnVuY3Rpb24gY29udmVydEJyYW5jaERhdGFMaW5lc0Zyb21KU09OKGpzb25PYmplY3QpIHsNCiAgICBpZiAoanNvbk9iamVjdCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybiBbXTsNCiAgICB9DQogICAgdmFyIGxlbmd0aCA9IGpzb25PYmplY3QubGVuZ3RoOw0KICAgIGZvciAodmFyIGxpbmUgPSAwOyBsaW5lIDwgbGVuZ3RoOyBsaW5lKyspIHsNCiAgICAgICAgdmFyIGJyYW5jaERhdGFKU09OID0ganNvbk9iamVjdFtsaW5lXTsNCiAgICAgICAgaWYgKGJyYW5jaERhdGFKU09OICE9PSBudWxsKSB7DQogICAgICAgICAgICBmb3IgKHZhciBjb25kaXRpb25JbmRleCA9IDA7IGNvbmRpdGlvbkluZGV4IDwgYnJhbmNoRGF0YUpTT04ubGVuZ3RoOyBjb25kaXRpb25JbmRleCArKykgew0KICAgICAgICAgICAgICAgIHZhciBjb25kaXRpb24gPSBicmFuY2hEYXRhSlNPTltjb25kaXRpb25JbmRleF07DQogICAgICAgICAgICAgICAgaWYgKGNvbmRpdGlvbiAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBicmFuY2hEYXRhSlNPTltjb25kaXRpb25JbmRleF0gPSBCcmFuY2hEYXRhLmZyb21Kc29uT2JqZWN0KGNvbmRpdGlvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBqc29uT2JqZWN0Ow0KfQ0K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 19:55:46 GMT",
                    "Content-Length": "43338",
                    "Date": "Fri, 07 Nov 2014 19:55:59 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}