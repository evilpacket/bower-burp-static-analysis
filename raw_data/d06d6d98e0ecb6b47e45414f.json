{
    "url": "http://localhost:9999/nbubna/store/test/store_test.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.href</b> and written to <b>the 'source' property of a DOM element</b> via the following statement:<ul><li>el.src = window.location.href+'?events=true';</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/nbubna/store/test/store_test.js",
                "path": "/nbubna/store/test/store_test.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9uYnVibmEvc3RvcmUvdGVzdC9zdG9yZV90ZXN0LmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogODcxMA0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogU2F0LCAwOCBOb3YgMjAxNCAxNDo1MjoxMiBHTVQNCkxhc3QtTW9kaWZpZWQ6IFNhdCwgMDggTm92IDIwMTQgMTQ6NTI6MTIgR01UDQoNCi8qCiAgPT09PT09PT0gQSBIYW5keSBMaXR0bGUgUVVuaXQgUmVmZXJlbmNlID09PT09PT09CiAgaHR0cDovL2FwaS5xdW5pdGpzLmNvbS8KCiAgVGVzdCBtZXRob2RzOgogICAgbW9kdWxlKG5hbWUsIHtbc2V0dXBdWyAsdGVhcmRvd25dfSkKICAgIHRlc3QobmFtZSwgY2FsbGJhY2spCiAgICBleHBlY3QobnVtYmVyT2ZBc3NlcnRpb25zKQogICAgc3RvcChpbmNyZW1lbnQpCiAgICBzdGFydChkZWNyZW1lbnQpCiAgVGVzdCBhc3NlcnRpb25zOgogICAgb2sodmFsdWUsIFttZXNzYWdlXSkKICAgIGVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIFttZXNzYWdlXSkKICAgIG5vdEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIFttZXNzYWdlXSkKICAgIGRlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBbbWVzc2FnZV0pCiAgICBub3REZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgW21lc3NhZ2VdKQogICAgc3RyaWN0RXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgW21lc3NhZ2VdKQogICAgbm90U3RyaWN0RXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgW21lc3NhZ2VdKQogICAgdGhyb3dzKGJsb2NrLCBbZXhwZWN0ZWRdLCBbbWVzc2FnZV0pCiovCihmdW5jdGlvbihzdG9yZSkgewoKICAgIHZhciBBUEkgPSBbJ2dldCcsICdzZXQnLCAnaGFzJywgJ3JlbW92ZScsICdlYWNoJywgJ25hbWVzcGFjZScsICdhcmVhJywKICAgICAgICAgICAgICAgJ2dldEFsbCcsICdzZXRBbGwnLCAna2V5cycsICdpc0Zha2UnLCAnY2xlYXInLCAnY2xlYXJBbGwnLCAnc2l6ZSddOwogICAgZnVuY3Rpb24gaGFzKGtleSwgcywgc24pIHsKICAgICAgICBpZiAoIXMpIHsKICAgICAgICAgICAgcyA9IHN0b3JlOwogICAgICAgIH0KICAgICAgICBvayhrZXkgaW4gcywgInRlc3Qgc3RvcmUuIisoc24/c24rJy4nOicnKStrZXkrIiBwcmVzZW5jZSIpOwogICAgfQogICAgZnVuY3Rpb24gaXMoa2V5LCBleHBlY3QsIHMsIHNuKSB7CiAgICAgICAgZXF1YWwoKHN8fHN0b3JlKVtrZXldLCBleHBlY3QsICJzdG9yZS4iKyhzbj9zbisnLic6JycpK2tleSk7CiAgICB9CiAgICAvKmZ1bmN0aW9uIHJldHVybnMoZm4sIGV4cGVjdCwgcykgewogICAgICAgIGVxdWFsKChzfHxzdG9yZSlbZm5dKCksIGV4cGVjdCwgZm4rIigpIik7CiAgICB9Ki8KICAgIGZ1bmN0aW9uIG5vdmFsKHZhbCwgbmFtZSkgewogICAgICAgIG9rKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZCwgbmFtZSk7CiAgICB9CiAgICAvKmZ1bmN0aW9uIHZhbCh2YWwsIG5hbWUpIHsKICAgICAgICBvayh2YWwgIT09IG51bGwgJiYgdmFsICE9PSB1bmRlZmluZWQsIG5hbWUpOwogICAgfSovCiAgICBmdW5jdGlvbiBzYXZlKGtleSwgdmFsLCBzKSB7CiAgICAgICAgbm92YWwoKHMgfHwgc3RvcmUpKGtleSwgdmFsKSwgInNhdmUgdmFsdWUgZm9yICciK2tleSsiJyIpOwogICAgICAgIGdldChrZXksIHZhbCwgcyk7CiAgICB9CiAgICBmdW5jdGlvbiB1cGRhdGUoa2V5LCB2YWwsIHMpIHsKICAgICAgICBpZiAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycgfHwgdmFsICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgb2soKHMgfHwgc3RvcmUpKGtleSwgdmFsKSAhPSBudWxsLCAidXBkYXRlIHZhbHVlIGZvciAnIitrZXkrIiciKTsKICAgICAgICAgICAgZ2V0KGtleSwgdmFsLCBzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlcXVhbCgocyB8fCBzdG9yZSkoa2V5KSwgdHJ1ZSwgJ3VwZGF0ZSBhbGwgdmFsdWVzIGluICcra2V5KTsKICAgICAgICAgICAgZm9yICh2YXIgayBpbiBrZXkpIHsKICAgICAgICAgICAgICAgIGdldChrLCBrZXlba10sIHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZ2V0KGtleSwgZXhwZWN0LCBzKSB7CiAgICAgICAgKGV4cGVjdCAmJiB0eXBlb2YgZXhwZWN0ID09PSAib2JqZWN0IiA/IGRlZXBFcXVhbCA6IGVxdWFsKQogICAgICAgICAgICAoKHMgfHwgc3RvcmUpLmdldChrZXkpLCBleHBlY3QsICJnZXQgJyIra2V5KyInIik7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRBbGwoZXhwZWN0LCBzKSB7CiAgICAgICAgZGVlcEVxdWFsKChzIHx8IHN0b3JlKSgpLCBleHBlY3QsICJnZXRBbGwiKTsKICAgIH0KICAgIGZ1bmN0aW9uIGtleXMoZXhwZWN0LCBzKSB7CiAgICAgICAgdmFyIF9rZXlzID0gKHMgfHwgc3RvcmUpLmtleXMoKTsKICAgICAgICBmb3IgKHZhciBpPTAsbT1leHBlY3QubGVuZ3RoOyBpPG07IGkrKykgewogICAgICAgICAgICBpZiAoX2tleXMuaW5kZXhPZikgewogICAgICAgICAgICAgICAgb2soX2tleXMuaW5kZXhPZihleHBlY3RbaV0pID49IDAsICdoYXMgJytleHBlY3RbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVxdWFsKGtleXMubGVuZ3RoLCBleHBlY3QubGVuZ3RoLCAnZGVlcEVxdWFsIGxlbmd0aCcpOwogICAgfQogICAgZnVuY3Rpb24gZWFjaChleHBlY3QsIHMpIHsKICAgICAgICAocyB8fCBzdG9yZSkuZWFjaChmdW5jdGlvbihrLCB2LCBpKSB7CiAgICAgICAgICAgIG9rKGluQXJyYXkoZXhwZWN0LCBbayx2XSksICdjb250YWlucyAnK2srJzonK3YrJyBhdCAnK2kpOwogICAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gaW5BcnJheShhcnJheSwgZWxlbWVudCkgewogICAgICAgIGZvciAodmFyIGk9MCxtPWFycmF5Lmxlbmd0aDsgaTxtOyBpKyspIHsKICAgICAgICAgICAgaWYgKGVsZW1lbnQudG9TdHJpbmcoKSA9PT0gYXJyYXlbaV0udG9TdHJpbmcoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgZnVuY3Rpb24gcmVtb3ZlKGtleSwgZXhwZWN0LCBzKSB7CiAgICAgICAgZXF1YWwoKHMgfHwgc3RvcmUpLnJlbW92ZShrZXkpLCBleHBlY3QsICJyZW1vdmUgJyIra2V5KyInIik7CiAgICAgICAgZ2V0KGtleSwgbnVsbCwgcyk7CiAgICB9CiAgICBmdW5jdGlvbiBjbGVhcihzKSB7CiAgICAgICAgZXF1YWwoKHMgfHwgc3RvcmUpLmNsZWFyKCksIHMgfHwgc3RvcmUsICJjbGVhciIpOwogICAgICAgIGdldEFsbCh7fSwgcyk7CiAgICAgICAgZXF1YWwoKHMgfHwgc3RvcmUpLnNpemUoKSwgMCwgInNpemUgc2hvdWxkIGJlIDAgYWZ0ZXIgY2xlYXIiKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNsZWFyQWxsKHMpIHsKICAgICAgICBvaygocyB8fCBzdG9yZSkuY2xlYXJBbGwoKSwgImNsZWFyQWxsIHdvcmtlZCBmb3IgIisoc3x8c3RvcmUpKTsKICAgICAgICBnZXRBbGwoe30sIHMpOwogICAgICAgIGVxdWFsKChzIHx8IHN0b3JlKS5zaXplKCksIDAsICJzaXplIHNob3VsZCBiZSAwIGFmdGVyIGNsZWFyIik7CiAgICB9CiAgICBmdW5jdGlvbiBzcGFjZShucykgewogICAgICAgIGVxdWFsKHN0b3JlLm5hbWVzcGFjZShucyksIHN0b3JlW25zXSwgIkNyZWF0ZSBzcGFjZTogJyIrbnMrIiciKTsKICAgICAgICByZXR1cm4gc3RvcmVbbnNdOwogICAgfQogICAgZnVuY3Rpb24gYXJlYShpZCkgewogICAgICAgIHZhciBzID0gc3RvcmUuYXJlYShpZCksCiAgICAgICAgICAgIHN0b3JhZ2UgPSBzLl9hcmVhOwogICAgICAgIGhhcyhpZCk7CiAgICAgICAgZXF1YWwoaWQsIHMuX2lkKTsKICAgICAgICBpcygnX2FyZWEnLCBzdG9yZS5fLmFyZWFzW2lkXSwgcyk7CiAgICAgICAgZm9yICh2YXIgbiBpbiBzdG9yZS5fLmZha2VTdG9yYWdlQVBJKSB7CiAgICAgICAgICAgIGlmIChuICE9PSAnaGFzJyAmJiBuICE9PSAndG9TdHJpbmcnKSB7CiAgICAgICAgICAgICAgICBoYXMobiwgc3RvcmFnZSwgaWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVxdWFsKHMuX2FyZWEsIHN0b3JlLl8uYXJlYXNbaWRdKTsKICAgICAgICBlcXVhbChzdG9yZVtpZF0uX2FyZWEsIHMuX2FyZWEsICdzLl9hcmVhID09IHN0b3JlW2lkXS5fYXJlYScpOwogICAgICAgIHJldHVybiBzOwogICAgfQoKICAgIHZhciBpc19ldmVudHMgPSAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignZXZlbnRzPXRydWUnKSA+IC0xKTsKICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoIWlzX2V2ZW50cykgewoKICAgICAgICAgICAgLy8gZW5zdXJlIHdlIHN0YXJ0IGJsYW5rCiAgICAgICAgICAgIHN0b3JlLmNsZWFyQWxsKCk7CiAgICAgICAgICAgIHRlc3QoImludGVyZmFjZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgb2soc3RvcmUsICJzdG9yZSBpcyBwcmVzZW50Iik7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpPTA7IGk8QVBJLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaGFzKEFQSVtpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoYXMoJ3ZlcnNpb24nLCBzdG9yZS5fKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0ZXN0KCJiYXNpY3MiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNsZWFyKCk7CiAgICAgICAgICAgICAgICBkZWVwRXF1YWwoc3RvcmUuX2lkLCAnbG9jYWwnLCAnaWQgc2hvdWxkIGJlIGxvY2FsJyk7CiAgICAgICAgICAgICAgICBvayghc3RvcmUuaXNGYWtlKCksICJpcyBub3QgZmFrZWQiKTsKICAgICAgICAgICAgICAgIHNhdmUoJ2ZvbycsJ2JhcicpOwogICAgICAgICAgICAgICAgZ2V0QWxsKHtmb286J2Jhcid9KTsKICAgICAgICAgICAgICAgIHVwZGF0ZSh7Zml6Oid3aXonLGZvbzp0cnVlfSk7CiAgICAgICAgICAgICAgICB1cGRhdGUoJ2ZvbycsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGtleXMoWydmb28nLCdmaXonXSk7CiAgICAgICAgICAgICAgICBlYWNoKFtbJ2ZpeicsJ3dpeiddLFsnZm9vJyxmYWxzZV1dKTsKICAgICAgICAgICAgICAgIGVxdWFsKHN0b3JlLnNpemUoKSwgMiwgInNpemUgc2hvdWxkIGJlIDIiKTsKICAgICAgICAgICAgICAgIHJlbW92ZSgnZml6JywgJ3dpeicpOwogICAgICAgICAgICAgICAgcmVtb3ZlKCd3b29naWUnLCB1bmRlZmluZWQpOwogICAgICAgICAgICAgICAgZ2V0KCdmb28nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBjbGVhckFsbCgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHRlc3QoIm5hbWVzcGFjZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2F2ZSgnZm9vJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICB2YXIgbnMgPSBzcGFjZSgndGVzdCcpOwogICAgICAgICAgICAgICAgZXF1YWwobnMrJycsICdzdG9yZS50ZXN0W2xvY2FsXScsICJucy50b1N0cmluZygpIik7CiAgICAgICAgICAgICAgICBnZXRBbGwoe30sIG5zKTsKICAgICAgICAgICAgICAgIHNhdmUoJ2EnLCAnYicsIG5zKTsKICAgICAgICAgICAgICAgIGdldCgndGVzdC5hJywgJ2InKTsKICAgICAgICAgICAgICAgIGVhY2goW1snYScsJ2InXV0sIG5zKTsKICAgICAgICAgICAgICAgIGVhY2goW1snZm9vJyx0cnVlXSxbJ3Rlc3QuYScsJ2InXV0pOwogICAgICAgICAgICAgICAgZWFjaChbXSwgc3BhY2UoJ2VtcHR5JykpOwogICAgICAgICAgICAgICAgc2F2ZSgndGVzdC4nLCAndHJ1ZScsIG5zKTsKICAgICAgICAgICAgICAgIHJlbW92ZSgndGVzdC50ZXN0LicsICd0cnVlJyk7CiAgICAgICAgICAgICAgICBnZXQoJ2ZvbycsIG51bGwsIG5zKTsKICAgICAgICAgICAgICAgIGdldEFsbCh7YTonYid9LCBucyk7CiAgICAgICAgICAgICAgICB1cGRhdGUoJ2EnLCAyNi4yLCBucyk7CiAgICAgICAgICAgICAgICBjbGVhcihucyk7CiAgICAgICAgICAgICAgICBnZXRBbGwoe2Zvbzp0cnVlfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGVzdCgiYXJlYXMiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBsb2NhbCA9IGFyZWEoJ2xvY2FsJyk7CiAgICAgICAgICAgICAgICBlcXVhbChsb2NhbCwgc3RvcmUsICdzdG9yZSBzaG91bGQgZXF1YWwgc3RvcmUubG9jYWwnKTsKICAgICAgICAgICAgICAgIHZhciBzZXNzaW9uID0gYXJlYSgnc2Vzc2lvbicpOwogICAgICAgICAgICAgICAgb2soc2Vzc2lvbiAhPT0gc3RvcmUsICdzdG9yZSBzaG91bGQgbm90IGVxdWFsIHN0b3JlLnNlc3Npb24nKTsKICAgICAgICAgICAgICAgIGFyZWEoJ2Zha2UnLCB0cnVlKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0ZXN0KCJ0cmlja3kgZm9yIHVzIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzYXZlKG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgc2F2ZSh1bmRlZmluZWQsICd1bmRlZmluZWQnKTsKICAgICAgICAgICAgICAgIHNhdmUoMCwgJzAnKTsKICAgICAgICAgICAgICAgIHNhdmUoW10sICdbXScpOwogICAgICAgICAgICAgICAgc2F2ZSh7fSwgMCk7CiAgICAgICAgICAgICAgICBzYXZlKHthOntiOnRydWV9fSwgZmFsc2UpOwogICAgICAgICAgICAgICAgc2F2ZShmdW5jdGlvbiBhKCl7fSwgJ3doYXRldmVyJyk7CiAgICAgICAgICAgICAgICBjbGVhcigpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vMjAxMS4wNi4wOSB0aGVzZSB3cmVjayBtb3N0IGJyb3dzZXJzIGxvY2FsU3RvcmFnZSBpbnRlcmZhY2UKICAgICAgICAgICAgdmFyIGlzX2ZpcmVmb3ggPSAobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2ZpcmVmb3gnKSA+IC0xKTsKICAgICAgICAgICAgaWYgKGlzX2ZpcmVmb3gpIHsKICAgICAgICAgICAgdGVzdCgidHJpY2t5IGZvciBicm93c2VycyIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2F2ZSgnZ2V0SXRlbScsIHRydWUpOwogICAgICAgICAgICAgICAgc2F2ZSgnc2V0SXRlbScsIDEyLjIpOwogICAgICAgICAgICAgICAgc2F2ZSgnY2xlYXInLCAnYm9vJyk7CiAgICAgICAgICAgICAgICBzYXZlKCdyZW1vdmVJdGVtJywgJ2hpJyk7CiAgICAgICAgICAgICAgICBzYXZlKCdrZXknLCB7fSk7CiAgICAgICAgICAgICAgICBzYXZlKCdsZW5ndGgnLCAxKTsKICAgICAgICAgICAgICAgIHVwZGF0ZSgnbGVuZ3RoJywgMik7CiAgICAgICAgICAgICAgICBjbGVhcigpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY2xlYW4gc2xhdGUgYmVmb3JlIGV2ZW50IHRlc3RzCiAgICAgICAgc3RvcmUuY2xlYXJBbGwoKTsKCiAgICAgICAgdmFyIGlzX2h0dHAgPSAod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignZmlsZScpICE9PSAwKSwKICAgICAgICAgICAgaXNfbW9kZXJuID0gISF3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcjsKICAgICAgICBpZiAoaXNfaHR0cCAmJiBpc19tb2Rlcm4pIHsKICAgICAgICAgICAgdmFyIGV2ZW50cyA9IHN0b3JlLm5hbWVzcGFjZSgnZXZlbnRzJyk7CiAgICAgICAgICAgIGlmIChpc19ldmVudHMpIHsKICAgICAgICAgICAgICAgIGV2ZW50cygnZm9vJywge2E6MSxiOjJ9KTsKICAgICAgICAgICAgICAgIGV2ZW50cygnZm9vJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBldmVudHMoJ2JhcicsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGV2ZW50cygwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBmb29zID0gMTsKICAgICAgICAgICAgICAgIGV2ZW50cy5vbignZm9vJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgIHRlc3QoImV2ZW50ICIrZS5rZXkrZm9vcywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgZXF1YWwoJ2V2ZW50cycsIGUubmFtZXNwYWNlLCAiZS5uYW1lc3BhY2Ugc2hvdWxkIGJlICdldmVudHMnIik7CiAgICAgICAgICAgICAgICAgICAgICAgZXF1YWwoJ2ZvbycsIGUua2V5LCAiZS5rZXkgc2hvdWxkIGJlICdmb28nIik7CiAgICAgICAgICAgICAgICAgICAgICAgb2soZS5zdG9yYWdlQXJlYSwgInNob3VsZCBoYXZlIGEgc3RvcmFnZUFyZWEiKTsKICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9vcyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICBvayghZS5vbGRWYWx1ZSwgInNob3VsZG4ndCBiZSBhbnkgb2xkVmFsdWUiKTsKICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZvb3MgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgZXF1YWwoMiwgZS5vbGRWYWx1ZS5iLCAib2xkVmFsdWUgc2hvdWxkIGJlIG9iamVjdCwgbm90IHN0cmluZyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICBlcXVhbCh0cnVlLCBlLm5ld1ZhbHVlLCAibmV3VmFsdWUgc2hvdWxkIGJlIHRydWUiKTsKICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZvb3MgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgb2soIWUubmV3VmFsdWUsICJzaG91bGRuJ3QgYmUgYW55IG5ld1ZhbHVlIik7CiAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgIGZvb3MrKzsKICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKICAgICAgICAgICAgICAgIGVsLnNyYyA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmKyc/ZXZlbnRzPXRydWUnOwogICAgICAgICAgICAgICAgZWwuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOyAgCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLmFwcGVuZENoaWxkKGVsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9Oy8vIGVuZCB3aW5kb3cub25sb2FkCgp9KHdpbmRvdy5zdG9yZSkpOwo=",
                "body": "LyoKICA9PT09PT09PSBBIEhhbmR5IExpdHRsZSBRVW5pdCBSZWZlcmVuY2UgPT09PT09PT0KICBodHRwOi8vYXBpLnF1bml0anMuY29tLwoKICBUZXN0IG1ldGhvZHM6CiAgICBtb2R1bGUobmFtZSwge1tzZXR1cF1bICx0ZWFyZG93bl19KQogICAgdGVzdChuYW1lLCBjYWxsYmFjaykKICAgIGV4cGVjdChudW1iZXJPZkFzc2VydGlvbnMpCiAgICBzdG9wKGluY3JlbWVudCkKICAgIHN0YXJ0KGRlY3JlbWVudCkKICBUZXN0IGFzc2VydGlvbnM6CiAgICBvayh2YWx1ZSwgW21lc3NhZ2VdKQogICAgZXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgW21lc3NhZ2VdKQogICAgbm90RXF1YWwoYWN0dWFsLCBleHBlY3RlZCwgW21lc3NhZ2VdKQogICAgZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQsIFttZXNzYWdlXSkKICAgIG5vdERlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBbbWVzc2FnZV0pCiAgICBzdHJpY3RFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBbbWVzc2FnZV0pCiAgICBub3RTdHJpY3RFcXVhbChhY3R1YWwsIGV4cGVjdGVkLCBbbWVzc2FnZV0pCiAgICB0aHJvd3MoYmxvY2ssIFtleHBlY3RlZF0sIFttZXNzYWdlXSkKKi8KKGZ1bmN0aW9uKHN0b3JlKSB7CgogICAgdmFyIEFQSSA9IFsnZ2V0JywgJ3NldCcsICdoYXMnLCAncmVtb3ZlJywgJ2VhY2gnLCAnbmFtZXNwYWNlJywgJ2FyZWEnLAogICAgICAgICAgICAgICAnZ2V0QWxsJywgJ3NldEFsbCcsICdrZXlzJywgJ2lzRmFrZScsICdjbGVhcicsICdjbGVhckFsbCcsICdzaXplJ107CiAgICBmdW5jdGlvbiBoYXMoa2V5LCBzLCBzbikgewogICAgICAgIGlmICghcykgewogICAgICAgICAgICBzID0gc3RvcmU7CiAgICAgICAgfQogICAgICAgIG9rKGtleSBpbiBzLCAidGVzdCBzdG9yZS4iKyhzbj9zbisnLic6JycpK2tleSsiIHByZXNlbmNlIik7CiAgICB9CiAgICBmdW5jdGlvbiBpcyhrZXksIGV4cGVjdCwgcywgc24pIHsKICAgICAgICBlcXVhbCgoc3x8c3RvcmUpW2tleV0sIGV4cGVjdCwgInN0b3JlLiIrKHNuP3NuKycuJzonJykra2V5KTsKICAgIH0KICAgIC8qZnVuY3Rpb24gcmV0dXJucyhmbiwgZXhwZWN0LCBzKSB7CiAgICAgICAgZXF1YWwoKHN8fHN0b3JlKVtmbl0oKSwgZXhwZWN0LCBmbisiKCkiKTsKICAgIH0qLwogICAgZnVuY3Rpb24gbm92YWwodmFsLCBuYW1lKSB7CiAgICAgICAgb2sodmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkLCBuYW1lKTsKICAgIH0KICAgIC8qZnVuY3Rpb24gdmFsKHZhbCwgbmFtZSkgewogICAgICAgIG9rKHZhbCAhPT0gbnVsbCAmJiB2YWwgIT09IHVuZGVmaW5lZCwgbmFtZSk7CiAgICB9Ki8KICAgIGZ1bmN0aW9uIHNhdmUoa2V5LCB2YWwsIHMpIHsKICAgICAgICBub3ZhbCgocyB8fCBzdG9yZSkoa2V5LCB2YWwpLCAic2F2ZSB2YWx1ZSBmb3IgJyIra2V5KyInIik7CiAgICAgICAgZ2V0KGtleSwgdmFsLCBzKTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZShrZXksIHZhbCwgcykgewogICAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyB8fCB2YWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBvaygocyB8fCBzdG9yZSkoa2V5LCB2YWwpICE9IG51bGwsICJ1cGRhdGUgdmFsdWUgZm9yICciK2tleSsiJyIpOwogICAgICAgICAgICBnZXQoa2V5LCB2YWwsIHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVxdWFsKChzIHx8IHN0b3JlKShrZXkpLCB0cnVlLCAndXBkYXRlIGFsbCB2YWx1ZXMgaW4gJytrZXkpOwogICAgICAgICAgICBmb3IgKHZhciBrIGluIGtleSkgewogICAgICAgICAgICAgICAgZ2V0KGssIGtleVtrXSwgcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBnZXQoa2V5LCBleHBlY3QsIHMpIHsKICAgICAgICAoZXhwZWN0ICYmIHR5cGVvZiBleHBlY3QgPT09ICJvYmplY3QiID8gZGVlcEVxdWFsIDogZXF1YWwpCiAgICAgICAgICAgICgocyB8fCBzdG9yZSkuZ2V0KGtleSksIGV4cGVjdCwgImdldCAnIitrZXkrIiciKTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldEFsbChleHBlY3QsIHMpIHsKICAgICAgICBkZWVwRXF1YWwoKHMgfHwgc3RvcmUpKCksIGV4cGVjdCwgImdldEFsbCIpOwogICAgfQogICAgZnVuY3Rpb24ga2V5cyhleHBlY3QsIHMpIHsKICAgICAgICB2YXIgX2tleXMgPSAocyB8fCBzdG9yZSkua2V5cygpOwogICAgICAgIGZvciAodmFyIGk9MCxtPWV4cGVjdC5sZW5ndGg7IGk8bTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChfa2V5cy5pbmRleE9mKSB7CiAgICAgICAgICAgICAgICBvayhfa2V5cy5pbmRleE9mKGV4cGVjdFtpXSkgPj0gMCwgJ2hhcyAnK2V4cGVjdFtpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZXF1YWwoa2V5cy5sZW5ndGgsIGV4cGVjdC5sZW5ndGgsICdkZWVwRXF1YWwgbGVuZ3RoJyk7CiAgICB9CiAgICBmdW5jdGlvbiBlYWNoKGV4cGVjdCwgcykgewogICAgICAgIChzIHx8IHN0b3JlKS5lYWNoKGZ1bmN0aW9uKGssIHYsIGkpIHsKICAgICAgICAgICAgb2soaW5BcnJheShleHBlY3QsIFtrLHZdKSwgJ2NvbnRhaW5zICcraysnOicrdisnIGF0ICcraSk7CiAgICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBpbkFycmF5KGFycmF5LCBlbGVtZW50KSB7CiAgICAgICAgZm9yICh2YXIgaT0wLG09YXJyYXkubGVuZ3RoOyBpPG07IGkrKykgewogICAgICAgICAgICBpZiAoZWxlbWVudC50b1N0cmluZygpID09PSBhcnJheVtpXS50b1N0cmluZygpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBmdW5jdGlvbiByZW1vdmUoa2V5LCBleHBlY3QsIHMpIHsKICAgICAgICBlcXVhbCgocyB8fCBzdG9yZSkucmVtb3ZlKGtleSksIGV4cGVjdCwgInJlbW92ZSAnIitrZXkrIiciKTsKICAgICAgICBnZXQoa2V5LCBudWxsLCBzKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNsZWFyKHMpIHsKICAgICAgICBlcXVhbCgocyB8fCBzdG9yZSkuY2xlYXIoKSwgcyB8fCBzdG9yZSwgImNsZWFyIik7CiAgICAgICAgZ2V0QWxsKHt9LCBzKTsKICAgICAgICBlcXVhbCgocyB8fCBzdG9yZSkuc2l6ZSgpLCAwLCAic2l6ZSBzaG91bGQgYmUgMCBhZnRlciBjbGVhciIpOwogICAgfQogICAgZnVuY3Rpb24gY2xlYXJBbGwocykgewogICAgICAgIG9rKChzIHx8IHN0b3JlKS5jbGVhckFsbCgpLCAiY2xlYXJBbGwgd29ya2VkIGZvciAiKyhzfHxzdG9yZSkpOwogICAgICAgIGdldEFsbCh7fSwgcyk7CiAgICAgICAgZXF1YWwoKHMgfHwgc3RvcmUpLnNpemUoKSwgMCwgInNpemUgc2hvdWxkIGJlIDAgYWZ0ZXIgY2xlYXIiKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNwYWNlKG5zKSB7CiAgICAgICAgZXF1YWwoc3RvcmUubmFtZXNwYWNlKG5zKSwgc3RvcmVbbnNdLCAiQ3JlYXRlIHNwYWNlOiAnIitucysiJyIpOwogICAgICAgIHJldHVybiBzdG9yZVtuc107CiAgICB9CiAgICBmdW5jdGlvbiBhcmVhKGlkKSB7CiAgICAgICAgdmFyIHMgPSBzdG9yZS5hcmVhKGlkKSwKICAgICAgICAgICAgc3RvcmFnZSA9IHMuX2FyZWE7CiAgICAgICAgaGFzKGlkKTsKICAgICAgICBlcXVhbChpZCwgcy5faWQpOwogICAgICAgIGlzKCdfYXJlYScsIHN0b3JlLl8uYXJlYXNbaWRdLCBzKTsKICAgICAgICBmb3IgKHZhciBuIGluIHN0b3JlLl8uZmFrZVN0b3JhZ2VBUEkpIHsKICAgICAgICAgICAgaWYgKG4gIT09ICdoYXMnICYmIG4gIT09ICd0b1N0cmluZycpIHsKICAgICAgICAgICAgICAgIGhhcyhuLCBzdG9yYWdlLCBpZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZXF1YWwocy5fYXJlYSwgc3RvcmUuXy5hcmVhc1tpZF0pOwogICAgICAgIGVxdWFsKHN0b3JlW2lkXS5fYXJlYSwgcy5fYXJlYSwgJ3MuX2FyZWEgPT0gc3RvcmVbaWRdLl9hcmVhJyk7CiAgICAgICAgcmV0dXJuIHM7CiAgICB9CgogICAgdmFyIGlzX2V2ZW50cyA9ICh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCdldmVudHM9dHJ1ZScpID4gLTEpOwogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICghaXNfZXZlbnRzKSB7CgogICAgICAgICAgICAvLyBlbnN1cmUgd2Ugc3RhcnQgYmxhbmsKICAgICAgICAgICAgc3RvcmUuY2xlYXJBbGwoKTsKICAgICAgICAgICAgdGVzdCgiaW50ZXJmYWNlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBvayhzdG9yZSwgInN0b3JlIGlzIHByZXNlbnQiKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaTxBUEkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBoYXMoQVBJW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhhcygndmVyc2lvbicsIHN0b3JlLl8pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHRlc3QoImJhc2ljcyIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY2xlYXIoKTsKICAgICAgICAgICAgICAgIGRlZXBFcXVhbChzdG9yZS5faWQsICdsb2NhbCcsICdpZCBzaG91bGQgYmUgbG9jYWwnKTsKICAgICAgICAgICAgICAgIG9rKCFzdG9yZS5pc0Zha2UoKSwgImlzIG5vdCBmYWtlZCIpOwogICAgICAgICAgICAgICAgc2F2ZSgnZm9vJywnYmFyJyk7CiAgICAgICAgICAgICAgICBnZXRBbGwoe2ZvbzonYmFyJ30pOwogICAgICAgICAgICAgICAgdXBkYXRlKHtmaXo6J3dpeicsZm9vOnRydWV9KTsKICAgICAgICAgICAgICAgIHVwZGF0ZSgnZm9vJywgZmFsc2UpOwogICAgICAgICAgICAgICAga2V5cyhbJ2ZvbycsJ2ZpeiddKTsKICAgICAgICAgICAgICAgIGVhY2goW1snZml6Jywnd2l6J10sWydmb28nLGZhbHNlXV0pOwogICAgICAgICAgICAgICAgZXF1YWwoc3RvcmUuc2l6ZSgpLCAyLCAic2l6ZSBzaG91bGQgYmUgMiIpOwogICAgICAgICAgICAgICAgcmVtb3ZlKCdmaXonLCAnd2l6Jyk7CiAgICAgICAgICAgICAgICByZW1vdmUoJ3dvb2dpZScsIHVuZGVmaW5lZCk7CiAgICAgICAgICAgICAgICBnZXQoJ2ZvbycsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGNsZWFyQWxsKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGVzdCgibmFtZXNwYWNlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzYXZlKCdmb28nLCB0cnVlKTsKICAgICAgICAgICAgICAgIHZhciBucyA9IHNwYWNlKCd0ZXN0Jyk7CiAgICAgICAgICAgICAgICBlcXVhbChucysnJywgJ3N0b3JlLnRlc3RbbG9jYWxdJywgIm5zLnRvU3RyaW5nKCkiKTsKICAgICAgICAgICAgICAgIGdldEFsbCh7fSwgbnMpOwogICAgICAgICAgICAgICAgc2F2ZSgnYScsICdiJywgbnMpOwogICAgICAgICAgICAgICAgZ2V0KCd0ZXN0LmEnLCAnYicpOwogICAgICAgICAgICAgICAgZWFjaChbWydhJywnYiddXSwgbnMpOwogICAgICAgICAgICAgICAgZWFjaChbWydmb28nLHRydWVdLFsndGVzdC5hJywnYiddXSk7CiAgICAgICAgICAgICAgICBlYWNoKFtdLCBzcGFjZSgnZW1wdHknKSk7CiAgICAgICAgICAgICAgICBzYXZlKCd0ZXN0LicsICd0cnVlJywgbnMpOwogICAgICAgICAgICAgICAgcmVtb3ZlKCd0ZXN0LnRlc3QuJywgJ3RydWUnKTsKICAgICAgICAgICAgICAgIGdldCgnZm9vJywgbnVsbCwgbnMpOwogICAgICAgICAgICAgICAgZ2V0QWxsKHthOidiJ30sIG5zKTsKICAgICAgICAgICAgICAgIHVwZGF0ZSgnYScsIDI2LjIsIG5zKTsKICAgICAgICAgICAgICAgIGNsZWFyKG5zKTsKICAgICAgICAgICAgICAgIGdldEFsbCh7Zm9vOnRydWV9KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0ZXN0KCJhcmVhcyIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGxvY2FsID0gYXJlYSgnbG9jYWwnKTsKICAgICAgICAgICAgICAgIGVxdWFsKGxvY2FsLCBzdG9yZSwgJ3N0b3JlIHNob3VsZCBlcXVhbCBzdG9yZS5sb2NhbCcpOwogICAgICAgICAgICAgICAgdmFyIHNlc3Npb24gPSBhcmVhKCdzZXNzaW9uJyk7CiAgICAgICAgICAgICAgICBvayhzZXNzaW9uICE9PSBzdG9yZSwgJ3N0b3JlIHNob3VsZCBub3QgZXF1YWwgc3RvcmUuc2Vzc2lvbicpOwogICAgICAgICAgICAgICAgYXJlYSgnZmFrZScsIHRydWUpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHRlc3QoInRyaWNreSBmb3IgdXMiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHNhdmUobnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICBzYXZlKHVuZGVmaW5lZCwgJ3VuZGVmaW5lZCcpOwogICAgICAgICAgICAgICAgc2F2ZSgwLCAnMCcpOwogICAgICAgICAgICAgICAgc2F2ZShbXSwgJ1tdJyk7CiAgICAgICAgICAgICAgICBzYXZlKHt9LCAwKTsKICAgICAgICAgICAgICAgIHNhdmUoe2E6e2I6dHJ1ZX19LCBmYWxzZSk7CiAgICAgICAgICAgICAgICBzYXZlKGZ1bmN0aW9uIGEoKXt9LCAnd2hhdGV2ZXInKTsKICAgICAgICAgICAgICAgIGNsZWFyKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8yMDExLjA2LjA5IHRoZXNlIHdyZWNrIG1vc3QgYnJvd3NlcnMgbG9jYWxTdG9yYWdlIGludGVyZmFjZQogICAgICAgICAgICB2YXIgaXNfZmlyZWZveCA9IChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZignZmlyZWZveCcpID4gLTEpOwogICAgICAgICAgICBpZiAoaXNfZmlyZWZveCkgewogICAgICAgICAgICB0ZXN0KCJ0cmlja3kgZm9yIGJyb3dzZXJzIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzYXZlKCdnZXRJdGVtJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBzYXZlKCdzZXRJdGVtJywgMTIuMik7CiAgICAgICAgICAgICAgICBzYXZlKCdjbGVhcicsICdib28nKTsKICAgICAgICAgICAgICAgIHNhdmUoJ3JlbW92ZUl0ZW0nLCAnaGknKTsKICAgICAgICAgICAgICAgIHNhdmUoJ2tleScsIHt9KTsKICAgICAgICAgICAgICAgIHNhdmUoJ2xlbmd0aCcsIDEpOwogICAgICAgICAgICAgICAgdXBkYXRlKCdsZW5ndGgnLCAyKTsKICAgICAgICAgICAgICAgIGNsZWFyKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjbGVhbiBzbGF0ZSBiZWZvcmUgZXZlbnQgdGVzdHMKICAgICAgICBzdG9yZS5jbGVhckFsbCgpOwoKICAgICAgICB2YXIgaXNfaHR0cCA9ICh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCdmaWxlJykgIT09IDApLAogICAgICAgICAgICBpc19tb2Rlcm4gPSAhIXdpbmRvdy5hZGRFdmVudExpc3RlbmVyOwogICAgICAgIGlmIChpc19odHRwICYmIGlzX21vZGVybikgewogICAgICAgICAgICB2YXIgZXZlbnRzID0gc3RvcmUubmFtZXNwYWNlKCdldmVudHMnKTsKICAgICAgICAgICAgaWYgKGlzX2V2ZW50cykgewogICAgICAgICAgICAgICAgZXZlbnRzKCdmb28nLCB7YToxLGI6Mn0pOwogICAgICAgICAgICAgICAgZXZlbnRzKCdmb28nLCB0cnVlKTsKICAgICAgICAgICAgICAgIGV2ZW50cygnYmFyJywgZmFsc2UpOwogICAgICAgICAgICAgICAgZXZlbnRzKDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGZvb3MgPSAxOwogICAgICAgICAgICAgICAgZXZlbnRzLm9uKCdmb28nLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgICAgdGVzdCgiZXZlbnQgIitlLmtleStmb29zLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICBlcXVhbCgnZXZlbnRzJywgZS5uYW1lc3BhY2UsICJlLm5hbWVzcGFjZSBzaG91bGQgYmUgJ2V2ZW50cyciKTsKICAgICAgICAgICAgICAgICAgICAgICBlcXVhbCgnZm9vJywgZS5rZXksICJlLmtleSBzaG91bGQgYmUgJ2ZvbyciKTsKICAgICAgICAgICAgICAgICAgICAgICBvayhlLnN0b3JhZ2VBcmVhLCAic2hvdWxkIGhhdmUgYSBzdG9yYWdlQXJlYSIpOwogICAgICAgICAgICAgICAgICAgICAgIGlmIChmb29zID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rKCFlLm9sZFZhbHVlLCAic2hvdWxkbid0IGJlIGFueSBvbGRWYWx1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9vcyA9PT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICBlcXVhbCgyLCBlLm9sZFZhbHVlLmIsICJvbGRWYWx1ZSBzaG91bGQgYmUgb2JqZWN0LCBub3Qgc3RyaW5nIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGVxdWFsKHRydWUsIGUubmV3VmFsdWUsICJuZXdWYWx1ZSBzaG91bGQgYmUgdHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9vcyA9PT0gMykgewogICAgICAgICAgICAgICAgICAgICAgICAgICBvayghZS5uZXdWYWx1ZSwgInNob3VsZG4ndCBiZSBhbnkgbmV3VmFsdWUiKTsKICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgZm9vcysrOwogICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwogICAgICAgICAgICAgICAgZWwuc3JjID0gd2luZG93LmxvY2F0aW9uLmhyZWYrJz9ldmVudHM9dHJ1ZSc7CiAgICAgICAgICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7ICAKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF0uYXBwZW5kQ2hpbGQoZWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH07Ly8gZW5kIHdpbmRvdy5vbmxvYWQKCn0od2luZG93LnN0b3JlKSk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 14:52:12 GMT",
                    "Content-Length": "8710",
                    "Date": "Sat, 08 Nov 2014 14:52:12 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}