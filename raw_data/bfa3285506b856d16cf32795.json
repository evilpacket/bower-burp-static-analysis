{
    "url": "http://localhost:9999/snrbrnjna/galleryjs/app/scripts/gallery/views/slider.view.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>document.location.href</b> and written to <b>history.replaceState()</b> via the following statements:<ul><li>var newLoc = document.location.href;</li><li>newLoc = newLoc.replace(/\\#.*/, '') + (bangboombang ? '#!' + bangboombang : '');</li><li>history.replaceState(null, title, newLoc);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/snrbrnjna/galleryjs/app/scripts/gallery/views/slider.view.js",
                "path": "/snrbrnjna/galleryjs/app/scripts/gallery/views/slider.view.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9zbnJicm5qbmEvZ2FsbGVyeWpzL2FwcC9zY3JpcHRzL2dhbGxlcnkvdmlld3Mvc2xpZGVyLnZpZXcuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTEyMDINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDI6MDM6NDggR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDAyOjAzOjQ4IEdNVA0KDQpkZWZpbmUoWwogICdqcXVlcnknLAogICdqcXVlcnktdG91Y2hzd2lwZScsCiAgJ3ZlbmRvci9qcXVlcnkudGhyb3R0bGUtZGVib3VuY2UnLAogICd1bmRlcnNjb3JlJywKICAnYmFja2JvbmUnLAogICdnYWxsZXJ5L3ZpZXdzL2xhcmdlLnZpZXcnLAogICdnYWxsZXJ5L3ZpZXdzL2NvY2twaXQudmlldycKXSwgZnVuY3Rpb24oJCwgbm9wZSwgbm9wZTIsIF8sIEJhY2tib25lLCBMYXJnZVZpZXcsIENvY2twaXRWaWV3KSB7CiAgCiAgLyoKICAgKiBNb2RlbDogR2FsbGVyeU1vZGVsCiAgICogRWxlbWVudDogaXMgc2V0IGJ5IHRoZSBjb25zdHJ1Y3RvciAoc2VlIGFwcC5qcykKICAgKgogICAqIGxpc3RlbnMgdG8gJ3RodW1iOmNsaWNrZWQnIG9uIEdhbGxlcnlNb2RlbAogICAqIGxpc3RlbnMgdG8gJ3Jlc2l6ZS5zbGlkZXInIG9uIHdpbmRvdwogICAqIGxpc3RlbnMgdG8gJ2NsaWNrLnNsaWRlcicgb24gdGhpcy4kZWwKICAgKiBsaXN0ZW5zIHRvICdtb3VzZW1vdmUuc2xpZGVyJyBvbiB0aGlzLiRlbAogICAqIGxpc3RlbnMgdG8gJ2tleXVwLnNsaWRlcicgKEVTQ1syN10sIGN1cnNvci1sZWZ0WzM3XSwgY3Vyc29yLXJpZ2h0WzM5XSkKICAgKiBsaXN0ZW5zIG9uY2UgdG8gJ3N5bmMnIG9uIEdhbGxlcnlNb2RlbAogICAqIHRyaWdnZXJzICdzbGlkZXI6bmV3SW1hZ2UnIHdpdGggY3VycmVudCBMYXJnZVZpZXcgb2JqZWN0IG9uIEdhbGxlcnlNb2RlbAogICAqLwogIHZhciBTbGlkZXJWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgICAgIAogICAgZXZlbnRzOiB7CiAgICAgICdjbGljayAubmF2LnByZXYnOiAnc2hvd1ByZXYnLAogICAgICAnY2xpY2sgLm5hdi5uZXh0JzogJ3Nob3dOZXh0JwogICAgfSwKICAgIAogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7CiAgICAgIC8vIE1hcmsgd2l0aCBzbGlkZXJfY2xvc2VkIGNsYXNzCiAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnc2xpZGVyX2Nsb3NlZCcpOwogICAgICAKICAgICAgLy8gSW5pdCBFbGVtZW50cwogICAgICB0aGlzLnRyYXkgPSB0aGlzLiQoJy50cmF5Jyk7CiAgICAgIHRoaXMuY3VycmVudEJveCA9IHRoaXMuJCgnLnBob3RvLmN1cnJlbnQnKTsgLy9UT0RPOiBPcHRpb25zCiAgICAgIHRoaXMucHJldkJveCA9IHRoaXMuJCgnLnBob3RvLnByZXYnKTsKICAgICAgdGhpcy5uZXh0Qm94ID0gdGhpcy4kKCcucGhvdG8ubmV4dCcpOwogICAgICB0aGlzLm5hdlByZXYgPSB0aGlzLiQoJy5uYXYucHJldicpOyAvLyBUT0RPOiBPcHRpb25zCiAgICAgIHRoaXMubmF2TmV4dCA9IHRoaXMuJCgnLm5hdi5uZXh0Jyk7IC8vIFRPRE86IE9wdGlvbnMKICAgICAgdGhpcy5jdXJyZW50ID0gdW5kZWZpbmVkOwogICAgICAKICAgICAgLy8gUmVnaXN0ZXIgSGFuZGxlcnMKICAgICAgLy8gQ2hlY2ssIHdoZW4gVGh1bWIgd2FzIGNsaWNrZWQKICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCAndGh1bWI6Y2xpY2tlZCcsIHRoaXMub3BlblNsaWRlcik7CiAgICAgIC8vIExpc3RlbiBvbiB3aW5kb3cgcmVzaXplIHRvIHJlc2l6ZSB0aGUgY3VycmVudCwgdGhlIHByZXYgYW5kIHRoZSBuZXh0IGxhcmdlCiAgICAgICQod2luZG93KS5vbigncmVzaXplLnNsaWRlcicsIF8uYmluZCgkLmRlYm91bmNlKDIwMCwgdGhpcy5yZXNpemUpLCB0aGlzKSk7CiAgICAgIC8vIExpc3RlbiB0byBrZXlib2FyZAogICAgICAkKHdpbmRvdykub24oJ2tleXVwLnNsaWRlcicsIF8uYmluZCh0aGlzLmtleXMsIHRoaXMpKTsKICAgICAgLy8gTGlzdGVuIHRvIG1vdXNlbW92ZSBmb3IgaG92ZXJpbmcgdGhlIHByZXYvbmV4dCBidXR0b25zIC0gb25seSBvbiAKICAgICAgLy8gbm9uLXRvdWNoIGRldmljZXMgKG1peGVkIGRldmljZXMgKHN1cmZhY2UgZXQgYWwpIGRvbid0IGdldCBob3ZlciBoZWxwKQogICAgICB0aGlzLnRvdWNoYWJsZSA9ICgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cpOwogICAgICBpZiAoIXRoaXMudG91Y2hhYmxlKSB7CiAgICAgICAgdGhpcy50cmF5Lm9uKCdtb3VzZW1vdmUuc2xpZGVyJywgXy5iaW5kKCQudGhyb3R0bGUoMTUwLCB0aGlzLm1vdXNlbW92ZSksIHRoaXMpKTsKICAgICAgfQogICAgICAgICAgICAKICAgICAgLy8gSW5pdCBDb2NrcGl0CiAgICAgIHRoaXMuY29ja3BpdCA9IG5ldyBDb2NrcGl0Vmlldyh7CiAgICAgICAgbW9kZWw6IHRoaXMubW9kZWwsCiAgICAgICAgc2xpZGVyOiB0aGlzCiAgICAgIH0pOwogICAgICAKICAgICAgLy8gSW5pdCBTd2lwZS1IYW5kbGVyIGFuZCBkZWFjdGl2YXRlIGl0IAogICAgICAvLyA9PiBvcGVuU2xpZGVyL2Nsb3NlU2xpZGVyIGVuYWJsZXMvZGlzYWJsZXMgaXQgYWdhaW4KICAgICAgdGhpcy5pbml0U3dpcGVIYW5kbGVyKCk7CiAgICAgIHRoaXMuJGVsLnN3aXBlKCdkaXNhYmxlJyk7CiAgICAgIAogICAgICAvLyBDaGVjayBpZiBhIEltYWdlTW9kZWwgaWQgaXMgaW4gdGhlIHdpbmRvdy5sb2NhdGlvbi5oYXNoIAogICAgICAvLyA9PiBvcGVuIHNsaWRlciB3aXRoIHRoaXMgaW1hZ2UKICAgICAgdGhpcy5saXN0ZW5Ub09uY2UodGhpcy5tb2RlbCwgJ3N5bmMnLCBmdW5jdGlvbigpIHsKICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2gubGVuZ3RoID4gMikgewogICAgICAgICAgdmFyIGltYWdlTW9kZWwgPSB0aGlzLm1vZGVsLmdldCgnaW1hZ2VzJykuZ2V0KHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cigyKSk7CiAgICAgICAgICBpZiAoaW1hZ2VNb2RlbCkgewogICAgICAgICAgICB0aGlzLm9wZW5TbGlkZXIoaW1hZ2VNb2RlbCk7CiAgICAgICAgICAgIC8vIHdhaXQgYSBtaWxsaXNlY29uZCB0aWxsIHRoZSB0aHVtYnMgYXJlIGxvYWRlZCBhbmQgcGVyaGFwcyBhIHNjcm9sbGJhciBpcwogICAgICAgICAgICAvLyByZW5kZXJlZCA9PiBjaGFuZ2VzIHRoZSBkaW1lbnNpb25zIG9mIHRoZSBzbGlkZXIKICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoXy5iaW5kKHRoaXMucmVzaXplLCB0aGlzKSwgMjUwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIAogICAgaW5pdFN3aXBlSGFuZGxlcjogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7CiAgICAgIHRoaXMuJGVsLnN3aXBlKHsKICAgICAgICBzd2lwZUxlZnQ6IGZ1bmN0aW9uKGV2dCwgZGlyZWN0aW9uLCBkaXN0YW5jZSwgZHVyYXRpb24sIGZpbmdlckNvdW50KSB7CiAgICAgICAgICBpbnN0YW5jZS5zaG93TmV4dCgpOwogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfSwKICAgICAgICBzd2lwZVJpZ2h0OiBmdW5jdGlvbihldnQsIGRpcmVjdGlvbiwgZGlzdGFuY2UsIGR1cmF0aW9uLCBmaW5nZXJDb3VudCkgewogICAgICAgICAgaW5zdGFuY2Uuc2hvd1ByZXYoKTsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0sCiAgICAgICAgdGFwOiBmdW5jdGlvbihldnQsIHRhcmdldCkgewogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBpbnN0YW5jZS5jbGljayhldnQpOwogICAgICAgIH0sCiAgICAgICAgYWxsb3dQYWdlU2Nyb2xsOiAnbm9uZScKICAgICAgfSk7CiAgICB9LAogICAgICAgIAogICAgLy8gb3ZlcnJpZGUgQmFja2JvbmUuVmlldyNyZW1vdmUgdG8gcmVtb3ZlIHRoZSBldmVudCBsaXN0ZW5lciBmb3IgJ3Jlc2l6ZS5zbGlkZXInCiAgICByZW1vdmU6IGZ1bmN0aW9uKCkgewogICAgICAkKHdpbmRvdykub2ZmKCdyZXNpemUuc2xpZGVyJyk7CiAgICAgICQod2luZG93KS5vZmYoJ2tleXVwLnNsaWRlcicpOwogICAgICBpZiAodGhpcy50b3VjaGFibGUpIHsgdGhpcy50cmF5Lm9mZignbW91c2Vtb3ZlLnNsaWRlcicpOyB9CiAgICAgIHRoaXMuJGVsLnN3aXBlKCdkZXN0cm95Jyk7CiAgICAgIEJhY2tib25lLlZpZXcucHJvdG90eXBlLnJlbW92ZS5jYWxsKHRoaXMpOyAvLyBjYWxsIHN1cGVyKCkKICAgICAgLy8gY291bGQgYWxzbyBiZSB3cml0dGVuIGFzOgogICAgICAvLyB0aGlzLmNvbnN0cnVjdG9yLl9fc3VwZXJfXy5yZW1vdmUuY2FsbCh0aGlzKTsKICAgIH0sCiAgICAKICAgIGtleXM6IGZ1bmN0aW9uKGV2dCkgewogICAgICBpZiAodGhpcy5pc09wZW4oKSkgewogICAgICAgIHN3aXRjaChldnQua2V5Q29kZSkgewogICAgICAgICAgY2FzZSAyNzogLy8gRVNDCiAgICAgICAgICAgIHRoaXMuY2xvc2VTbGlkZXIoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM5OiAvLyBSaWdodCBDdXJzb3IKICAgICAgICAgICAgdGhpcy5zaG93TmV4dCgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMzc6IC8vIExlZnQgQ3Vyc29yCiAgICAgICAgICAgIHRoaXMuc2hvd1ByZXYoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgCiAgICAvLyBleGVjdXRlIHByZXYvbmV4dCBvciBjbG9zZSwgZGVwZW5kaW5nIG9uIHRoZSBhcmVhIGNsaWNrZWQuCiAgICBjbGljazogZnVuY3Rpb24oZXZ0KSB7CiAgICAgIHZhciBtb3VzZUNtZCA9IHRoaXMuX21hcE1vdXNlRXZlbnQoZXZ0KTsKICAgICAgc3dpdGNoKG1vdXNlQ21kKSB7CiAgICAgICAgY2FzZSAnbmF2LnByZXYnOgogICAgICAgICAgdGhpcy5zaG93UHJldigpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnbmF2Lm5leHQnOgogICAgICAgICAgdGhpcy5zaG93TmV4dCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnRVNDJzoKICAgICAgICAgIHRoaXMuY2xvc2VTbGlkZXIoKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgCiAgICAvLyAiaG92ZXIiIGVmZmVjdCBmb3IgcHJldi9uZXh0IGJ1dHRvbnMgd2hpbGUgbW91c2UgaXMgb3ZlciBpbWFnZQogICAgbW91c2Vtb3ZlOiBmdW5jdGlvbihldnQpIHsKICAgICAgdmFyIG1vdXNlQ21kID0gdGhpcy5fbWFwTW91c2VFdmVudChldnQpOwogICAgICBpZiAobW91c2VDbWQgPT09ICduYXYucHJldicpIHsKICAgICAgICB0aGlzLm5hdk5leHQucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwogICAgICAgIHRoaXMubmF2UHJldi5hZGRDbGFzcygnYWN0aXZlJyk7CiAgICAgIH0gZWxzZSBpZiAobW91c2VDbWQgPT09ICduYXYubmV4dCcpIHsKICAgICAgICB0aGlzLm5hdlByZXYucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwogICAgICAgIHRoaXMubmF2TmV4dC5hZGRDbGFzcygnYWN0aXZlJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5uYXZQcmV2LnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICB0aGlzLm5hdk5leHQucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB9CiAgICB9LAogICAgCiAgICAvLyBDaGVjayB3aGljaCBjb21hbmQgd291bGQgYmUgZXhlY3V0ZWQgZnJvbSB0aGUgY3VycmVudCBtb3VzZSBwb3NpdGlvbgogICAgX21hcE1vdXNlRXZlbnQ6IGZ1bmN0aW9uKGV2dCkgewogICAgICB2YXIgJHRhcmdldCA9ICQoZXZ0LnRhcmdldCk7CiAgICAgIGlmICgkdGFyZ2V0LmlzKCcucGhvdG8gaW1nJykpIHsKICAgICAgICAvLyB0b3VjaCBldmVudHMgZ2V0IHRoZSBjdXJyZW50IHBhZ2UgY29vcmRpbmF0ZXMgaW4gYW5vdGhlciBmYXNoaW9uIHRoYW4KICAgICAgICAvLyBwdXJlIG9sZCBjbGljayBldmVudHMKICAgICAgICB2YXIgcGFnZVggPSAoCiAgICAgICAgICBldnQuY2hhbmdlZFRvdWNoZXMgJiYgZXZ0LmNoYW5nZWRUb3VjaGVzLmxlbmd0aCA/CiAgICAgICAgICAgIGV2dC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCA6CiAgICAgICAgICAgIGV2dC5wYWdlWAogICAgICAgICk7CiAgICAgICAgdmFyIG9mZnNldFggPSBwYWdlWCAtICQoZXZ0LnRhcmdldCkub2Zmc2V0KCkubGVmdDsKICAgICAgICB2YXIgb2Zmc2V0UmVsWCA9IG9mZnNldFggLyB0aGlzLmN1cnJlbnQuZ2V0V2lkdGgoKTsKICAgICAgICByZXR1cm4gKG9mZnNldFJlbFggPCAwLjQ1ID8gJ25hdi5wcmV2JyA6ICduYXYubmV4dCcpOwogICAgICB9IGVsc2UgaWYgKCR0YXJnZXQuY2xvc2VzdCgnLmNvY2twaXQnKS5sZW5ndGggPT09IDApIHsKICAgICAgICAvLyAkLmNsb3Nlc3QgPT4gYWxsIHRhcmdldHMgd2l0aGluIHRoZSBzcGVjaWZpZWQgLmNvY2twaXQgY29udGFpbmVyCiAgICAgICAgcmV0dXJuICdFU0MnOwogICAgICB9CiAgICB9LAogICAgCiAgICBpc09wZW46IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy4kZWwuaGFzQ2xhc3MoJ29wZW4nKTsKICAgIH0sCiAgICAKICAgIG9wZW5TbGlkZXI6IGZ1bmN0aW9uKGltYWdlTW9kZWwpIHsKICAgICAgdGhpcy5fc2V0RGltZW5zaW9ucygpOwogICAgICB0aGlzLl9zZXRDdXJyZW50KGltYWdlTW9kZWwpOwogICAgICB0aGlzLiRlbC5hZGRDbGFzcygnb3BlbicpOwogICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3NsaWRlcl9jbG9zZWQnKTsKICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ3Zpc2libGUnKTsKICAgICAgdGhpcy4kZWwuc3dpcGUoJ2VuYWJsZScpOwogICAgICB0aGlzLm1vZGVsLnRvZ2dsZVNsaWRlclN0YXRlKCk7CiAgICB9LAogICAgCiAgICBzaG93TmV4dDogZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLm5leHQpIHsKICAgICAgICB2YXIgbmV3TmV4dEJveCA9IHRoaXMuJGVsLmZpbmQoJyNwcmV2Jyk7CiAgICAgICAgCiAgICAgICAgdGhpcy5wcmV2ID0gdGhpcy5jdXJyZW50OwogICAgICAgIHRoaXMucHJldkJveCA9IHRoaXMuY3VycmVudEJveC5hdHRyKCdpZCcsJ3ByZXYnKTsKICAgICAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLm5leHQ7CiAgICAgICAgdGhpcy5tb2RlbC5zZXRDdXJyZW50KHRoaXMubmV4dC5tb2RlbCk7CiAgICAgICAgdGhpcy5jdXJyZW50Qm94ID0gdGhpcy5uZXh0Qm94LmF0dHIoJ2lkJywnY3VycmVudCcpOwogICAgICAgIHRoaXMubmV4dEJveCA9IG5ld05leHRCb3guYXR0cignaWQnLCduZXh0Jyk7CiAgICAgICAgCiAgICAgICAgdGhpcy5wcmV2Qm94LnRvZ2dsZUNsYXNzKCdjdXJyZW50IHByZXYnKTsKICAgICAgICB0aGlzLmN1cnJlbnRCb3gudG9nZ2xlQ2xhc3MoJ25leHQgY3VycmVudCcpOwogICAgICAgIHRoaXMubmV4dEJveC50b2dnbGVDbGFzcygncHJldiBuZXh0Jyk7CiAgICAgICAgCiAgICAgICAgdGhpcy5fc2V0TmV4dCgpOwogICAgICAgIHRoaXMuX2N1cnJlbnRDaGFuZ2VkKCk7CiAgICAgIH0KICAgIH0sCiAgICAKICAgIHNob3dQcmV2OiBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMucHJldikgewogICAgICAgIHZhciBuZXdQcmV2Qm94ID0gdGhpcy4kZWwuZmluZCgnI25leHQnKTsKICAgICAgICAKICAgICAgICB0aGlzLm5leHQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgdGhpcy5uZXh0Qm94ID0gdGhpcy5jdXJyZW50Qm94LmF0dHIoJ2lkJywnbmV4dCcpOwogICAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMucHJldjsKICAgICAgICB0aGlzLm1vZGVsLnNldEN1cnJlbnQodGhpcy5wcmV2Lm1vZGVsKTsKICAgICAgICB0aGlzLmN1cnJlbnRCb3ggPSB0aGlzLnByZXZCb3guYXR0cignaWQnLCdjdXJyZW50Jyk7CiAgICAgICAgdGhpcy5wcmV2Qm94ID0gbmV3UHJldkJveC5hdHRyKCdpZCcsICdwcmV2Jyk7CiAgICAgICAgCiAgICAgICAgdGhpcy5uZXh0Qm94LnRvZ2dsZUNsYXNzKCdjdXJyZW50IG5leHQnKTsKICAgICAgICB0aGlzLmN1cnJlbnRCb3gudG9nZ2xlQ2xhc3MoJ3ByZXYgY3VycmVudCcpOwogICAgICAgIHRoaXMucHJldkJveC50b2dnbGVDbGFzcygnbmV4dCBwcmV2Jyk7CiAgICAgICAgCiAgICAgICAgdGhpcy5fc2V0UHJldigpOwogICAgICAgIHRoaXMuX2N1cnJlbnRDaGFuZ2VkKCk7CiAgICAgIH0KICAgIH0sCiAgICAKICAgIGNsb3NlU2xpZGVyOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKCdzbGlkZXI6Y2xvc2luZycsIHRoaXMuY3VycmVudCk7CiAgICAKICAgICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ29wZW4gdmlzaWJsZScpOwogICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ3NsaWRlcl9jbG9zZWQnKTsKCiAgICAgIHRoaXMuX3NldEN1cnJlbnQodW5kZWZpbmVkKTsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5uZXh0ID0gdGhpcy5wZXJ2ID0gdW5kZWZpbmVkOwogICAgICAKICAgICAgdGhpcy4kKCcucGhvdG8nKS5lbXB0eSgpOwogICAgCiAgICAgIC8vIHVwZGF0ZSBicm93c2VyIHVybAogICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ2ltYWdlUGFnZXMnKSAmJiB0aGlzLm1vZGVsLmdldCgncG9zdFBhdGgnKSkgewogICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsICcnLCB0aGlzLm1vZGVsLmdldCgncG9zdFBhdGgnKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fc2V0SGFzaGJhbmcobnVsbCwgJ8OETVBUSScpOwogICAgICB9CiAgICAKICAgICAgdGhpcy4kZWwuc3dpcGUoJ2Rpc2FibGUnKTsKICAgICAgdGhpcy5tb2RlbC50b2dnbGVTbGlkZXJTdGF0ZSgpOwogICAgfSwKICAgIAogICAgX3NldEhhc2hiYW5nOiBmdW5jdGlvbihiYW5nYm9vbWJhbmcsIHRpdGxlKSB7CiAgICAgIGlmIChNb2Rlcm5penIuaGlzdG9yeSkgewogICAgICAgIHZhciBuZXdMb2MgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOwogICAgICAgIG5ld0xvYyA9IG5ld0xvYy5yZXBsYWNlKC9cIy4qLywgJycpICsgKGJhbmdib29tYmFuZyA/ICcjIScgKyBiYW5nYm9vbWJhbmcgOiAnJyk7CiAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUobnVsbCwgdGl0bGUsIG5ld0xvYyk7CiAgICAgIH0KICAgIH0sCiAgICAKICAgIF9jdXJyZW50Q2hhbmdlZDogZnVuY3Rpb24oKSB7CiAgICAgIC8vIHVwZGF0ZSBicm93c2VyIHVybAogICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ2ltYWdlUGFnZXMnKSkgewogICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsICcnLCB0aGlzLmN1cnJlbnQubW9kZWwuZ2V0KCdpbWFnZVBhZ2VQYXRoJykpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX3NldEhhc2hiYW5nKHRoaXMuY3VycmVudC5tb2RlbC5pZCwgJ0ltYWdlICcgKyB0aGlzLmN1cnJlbnQubW9kZWwuaWQpOwogICAgICB9CiAgICAgIAogICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoJ3NsaWRlcjpuZXdJbWFnZScsIHRoaXMuY3VycmVudCk7CiAgICAgIAogICAgICBpZiAodGhpcy5uZXh0KSB7IHRoaXMubmF2TmV4dC5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTsgfQogICAgICBlbHNlIHsgdGhpcy5uYXZOZXh0LmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpOyB9CiAgICAgIGlmICh0aGlzLnByZXYpIHsgdGhpcy5uYXZQcmV2LnJlbW92ZUNsYXNzKCd2aXN1YWxseWhpZGRlbicpOyB9CiAgICAgIGVsc2UgeyB0aGlzLm5hdlByZXYuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7IH0KICAgICAgCiAgICB9LAogICAgCiAgICBfc2V0Q3VycmVudDogZnVuY3Rpb24oaW1hZ2VNb2RlbCkgewogICAgICB0aGlzLm1vZGVsLnNldEN1cnJlbnQoaW1hZ2VNb2RlbCk7CiAgICAgIHZhciBsYXJnZVZpZXcgPSB0aGlzLl9sb2FkT3JHZXRMYXJnZShpbWFnZU1vZGVsKTsKICAgICAgaWYgKGxhcmdlVmlldykgewogICAgICAgIHRoaXMuY3VycmVudCA9IGxhcmdlVmlldzsKICAgICAgICB0aGlzLmN1cnJlbnRCb3guaHRtbCh0aGlzLmN1cnJlbnQuJGVsKTsKICAgICAgICB0aGlzLl9jdXJyZW50Q2hhbmdlZCgpOwogICAgICAgIHRoaXMuX3NldE5leHQoKTsKICAgICAgICB0aGlzLl9zZXRQcmV2KCk7CiAgICAgIH0KICAgIH0gLAogICAgCiAgICBfc2V0TmV4dDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubmV4dCA9IHRoaXMuX2xvYWRPckdldExhcmdlKHRoaXMubW9kZWwuZ2V0TmV4dCgpKTsKICAgICAgaWYgKHRoaXMubmV4dCkgewogICAgICAgIHRoaXMubmV4dEJveC5odG1sKHRoaXMubmV4dC4kZWwpOwogICAgICAgIHRoaXMubmF2TmV4dC5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm5hdk5leHQuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMubmV4dDsKICAgIH0sCiAgICAKICAgIF9zZXRQcmV2OiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5wcmV2ID0gdGhpcy5fbG9hZE9yR2V0TGFyZ2UodGhpcy5tb2RlbC5nZXRQcmV2KCkpOwogICAgICBpZiAodGhpcy5wcmV2KSB7CiAgICAgICAgdGhpcy5wcmV2Qm94Lmh0bWwodGhpcy5wcmV2LiRlbCk7CiAgICAgICAgdGhpcy5uYXZQcmV2LnJlbW92ZUNsYXNzKCd2aXN1YWxseWhpZGRlbicpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubmF2UHJldi5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5wcmV2OwogICAgfSwKICAgIAogICAgLy8gc2F2ZSBjdXJyZW50IHRyYXkgcmVzb2x1dGlvbiBvbiB0aGUgSW1hZ2VNb2RlbCBvciBMYXJnZVZpZXcKICAgIF9sb2FkT3JHZXRMYXJnZTogZnVuY3Rpb24oaW1hZ2VNb2RlbCkgewogICAgICBpZiAoaW1hZ2VNb2RlbCkgewogICAgICAgIHZhciBsYXJnZVZpZXcgPSAoCiAgICAgICAgICBpbWFnZU1vZGVsLmdldExhcmdlVmlldygpIHx8CiAgICAgICAgICBuZXcgTGFyZ2VWaWV3KHsKICAgICAgICAgICAgbW9kZWw6IGltYWdlTW9kZWwsCiAgICAgICAgICAgIHNsaWRlcjogdGhpcwogICAgICAgICAgfSkKICAgICAgICApOwogICAgICAgIGxhcmdlVmlldy5yZXNpemUoKTsKICAgICAgICByZXR1cm4gbGFyZ2VWaWV3OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0sCgogICAgcmVzaXplOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5fc2V0RGltZW5zaW9ucygpOwogICAgICAKICAgICAgaWYgKHRoaXMuY3VycmVudCkgeyB0aGlzLmN1cnJlbnQucmVzaXplKCk7IH0KICAgICAgaWYgKHRoaXMubmV4dCkgeyB0aGlzLm5leHQucmVzaXplKCk7IH0KICAgICAgaWYgKHRoaXMucHJldikgeyB0aGlzLnByZXYucmVzaXplKCk7IH0KICAgIH0sCiAgICAKICAgIF9zZXREaW1lbnNpb25zOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy53aWR0aCA9IHRoaXMudHJheS53aWR0aCgpOwogICAgICB0aGlzLmhlaWdodCA9IHRoaXMudHJheS5oZWlnaHQoKTsKICAgICAgdGhpcy5yYXRpbyA9IHRoaXMud2lkdGggLyB0aGlzLmhlaWdodDsKICAgICAgdGhpcy5vcmllbnRhdGlvbiA9IHRoaXMucmF0aW8gPiAxID8gJ2xhbmRzY2FwZScgOiAncG9ydHJhaXQnOwogICAgfQogICAgCiAgfSk7CiAgCiAgcmV0dXJuIFNsaWRlclZpZXc7Cn0pOwo=",
                "body": "ZGVmaW5lKFsKICAnanF1ZXJ5JywKICAnanF1ZXJ5LXRvdWNoc3dpcGUnLAogICd2ZW5kb3IvanF1ZXJ5LnRocm90dGxlLWRlYm91bmNlJywKICAndW5kZXJzY29yZScsCiAgJ2JhY2tib25lJywKICAnZ2FsbGVyeS92aWV3cy9sYXJnZS52aWV3JywKICAnZ2FsbGVyeS92aWV3cy9jb2NrcGl0LnZpZXcnCl0sIGZ1bmN0aW9uKCQsIG5vcGUsIG5vcGUyLCBfLCBCYWNrYm9uZSwgTGFyZ2VWaWV3LCBDb2NrcGl0VmlldykgewogIAogIC8qCiAgICogTW9kZWw6IEdhbGxlcnlNb2RlbAogICAqIEVsZW1lbnQ6IGlzIHNldCBieSB0aGUgY29uc3RydWN0b3IgKHNlZSBhcHAuanMpCiAgICoKICAgKiBsaXN0ZW5zIHRvICd0aHVtYjpjbGlja2VkJyBvbiBHYWxsZXJ5TW9kZWwKICAgKiBsaXN0ZW5zIHRvICdyZXNpemUuc2xpZGVyJyBvbiB3aW5kb3cKICAgKiBsaXN0ZW5zIHRvICdjbGljay5zbGlkZXInIG9uIHRoaXMuJGVsCiAgICogbGlzdGVucyB0byAnbW91c2Vtb3ZlLnNsaWRlcicgb24gdGhpcy4kZWwKICAgKiBsaXN0ZW5zIHRvICdrZXl1cC5zbGlkZXInIChFU0NbMjddLCBjdXJzb3ItbGVmdFszN10sIGN1cnNvci1yaWdodFszOV0pCiAgICogbGlzdGVucyBvbmNlIHRvICdzeW5jJyBvbiBHYWxsZXJ5TW9kZWwKICAgKiB0cmlnZ2VycyAnc2xpZGVyOm5ld0ltYWdlJyB3aXRoIGN1cnJlbnQgTGFyZ2VWaWV3IG9iamVjdCBvbiBHYWxsZXJ5TW9kZWwKICAgKi8KICB2YXIgU2xpZGVyVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICAKICAgIGV2ZW50czogewogICAgICAnY2xpY2sgLm5hdi5wcmV2JzogJ3Nob3dQcmV2JywKICAgICAgJ2NsaWNrIC5uYXYubmV4dCc6ICdzaG93TmV4dCcKICAgIH0sCiAgICAKICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkgewogICAgICAvLyBNYXJrIHdpdGggc2xpZGVyX2Nsb3NlZCBjbGFzcwogICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ3NsaWRlcl9jbG9zZWQnKTsKICAgICAgCiAgICAgIC8vIEluaXQgRWxlbWVudHMKICAgICAgdGhpcy50cmF5ID0gdGhpcy4kKCcudHJheScpOwogICAgICB0aGlzLmN1cnJlbnRCb3ggPSB0aGlzLiQoJy5waG90by5jdXJyZW50Jyk7IC8vVE9ETzogT3B0aW9ucwogICAgICB0aGlzLnByZXZCb3ggPSB0aGlzLiQoJy5waG90by5wcmV2Jyk7CiAgICAgIHRoaXMubmV4dEJveCA9IHRoaXMuJCgnLnBob3RvLm5leHQnKTsKICAgICAgdGhpcy5uYXZQcmV2ID0gdGhpcy4kKCcubmF2LnByZXYnKTsgLy8gVE9ETzogT3B0aW9ucwogICAgICB0aGlzLm5hdk5leHQgPSB0aGlzLiQoJy5uYXYubmV4dCcpOyAvLyBUT0RPOiBPcHRpb25zCiAgICAgIHRoaXMuY3VycmVudCA9IHVuZGVmaW5lZDsKICAgICAgCiAgICAgIC8vIFJlZ2lzdGVyIEhhbmRsZXJzCiAgICAgIC8vIENoZWNrLCB3aGVuIFRodW1iIHdhcyBjbGlja2VkCiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgJ3RodW1iOmNsaWNrZWQnLCB0aGlzLm9wZW5TbGlkZXIpOwogICAgICAvLyBMaXN0ZW4gb24gd2luZG93IHJlc2l6ZSB0byByZXNpemUgdGhlIGN1cnJlbnQsIHRoZSBwcmV2IGFuZCB0aGUgbmV4dCBsYXJnZQogICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZS5zbGlkZXInLCBfLmJpbmQoJC5kZWJvdW5jZSgyMDAsIHRoaXMucmVzaXplKSwgdGhpcykpOwogICAgICAvLyBMaXN0ZW4gdG8ga2V5Ym9hcmQKICAgICAgJCh3aW5kb3cpLm9uKCdrZXl1cC5zbGlkZXInLCBfLmJpbmQodGhpcy5rZXlzLCB0aGlzKSk7CiAgICAgIC8vIExpc3RlbiB0byBtb3VzZW1vdmUgZm9yIGhvdmVyaW5nIHRoZSBwcmV2L25leHQgYnV0dG9ucyAtIG9ubHkgb24gCiAgICAgIC8vIG5vbi10b3VjaCBkZXZpY2VzIChtaXhlZCBkZXZpY2VzIChzdXJmYWNlIGV0IGFsKSBkb24ndCBnZXQgaG92ZXIgaGVscCkKICAgICAgdGhpcy50b3VjaGFibGUgPSAoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KTsKICAgICAgaWYgKCF0aGlzLnRvdWNoYWJsZSkgewogICAgICAgIHRoaXMudHJheS5vbignbW91c2Vtb3ZlLnNsaWRlcicsIF8uYmluZCgkLnRocm90dGxlKDE1MCwgdGhpcy5tb3VzZW1vdmUpLCB0aGlzKSk7CiAgICAgIH0KICAgICAgICAgICAgCiAgICAgIC8vIEluaXQgQ29ja3BpdAogICAgICB0aGlzLmNvY2twaXQgPSBuZXcgQ29ja3BpdFZpZXcoewogICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLAogICAgICAgIHNsaWRlcjogdGhpcwogICAgICB9KTsKICAgICAgCiAgICAgIC8vIEluaXQgU3dpcGUtSGFuZGxlciBhbmQgZGVhY3RpdmF0ZSBpdCAKICAgICAgLy8gPT4gb3BlblNsaWRlci9jbG9zZVNsaWRlciBlbmFibGVzL2Rpc2FibGVzIGl0IGFnYWluCiAgICAgIHRoaXMuaW5pdFN3aXBlSGFuZGxlcigpOwogICAgICB0aGlzLiRlbC5zd2lwZSgnZGlzYWJsZScpOwogICAgICAKICAgICAgLy8gQ2hlY2sgaWYgYSBJbWFnZU1vZGVsIGlkIGlzIGluIHRoZSB3aW5kb3cubG9jYXRpb24uaGFzaCAKICAgICAgLy8gPT4gb3BlbiBzbGlkZXIgd2l0aCB0aGlzIGltYWdlCiAgICAgIHRoaXMubGlzdGVuVG9PbmNlKHRoaXMubW9kZWwsICdzeW5jJywgZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5oYXNoLmxlbmd0aCA+IDIpIHsKICAgICAgICAgIHZhciBpbWFnZU1vZGVsID0gdGhpcy5tb2RlbC5nZXQoJ2ltYWdlcycpLmdldCh3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMikpOwogICAgICAgICAgaWYgKGltYWdlTW9kZWwpIHsKICAgICAgICAgICAgdGhpcy5vcGVuU2xpZGVyKGltYWdlTW9kZWwpOwogICAgICAgICAgICAvLyB3YWl0IGEgbWlsbGlzZWNvbmQgdGlsbCB0aGUgdGh1bWJzIGFyZSBsb2FkZWQgYW5kIHBlcmhhcHMgYSBzY3JvbGxiYXIgaXMKICAgICAgICAgICAgLy8gcmVuZGVyZWQgPT4gY2hhbmdlcyB0aGUgZGltZW5zaW9ucyBvZiB0aGUgc2xpZGVyCiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KF8uYmluZCh0aGlzLnJlc2l6ZSwgdGhpcyksIDI1MCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAKICAgIGluaXRTd2lwZUhhbmRsZXI6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzOwogICAgICB0aGlzLiRlbC5zd2lwZSh7CiAgICAgICAgc3dpcGVMZWZ0OiBmdW5jdGlvbihldnQsIGRpcmVjdGlvbiwgZGlzdGFuY2UsIGR1cmF0aW9uLCBmaW5nZXJDb3VudCkgewogICAgICAgICAgaW5zdGFuY2Uuc2hvd05leHQoKTsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0sCiAgICAgICAgc3dpcGVSaWdodDogZnVuY3Rpb24oZXZ0LCBkaXJlY3Rpb24sIGRpc3RhbmNlLCBkdXJhdGlvbiwgZmluZ2VyQ291bnQpIHsKICAgICAgICAgIGluc3RhbmNlLnNob3dQcmV2KCk7CiAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9LAogICAgICAgIHRhcDogZnVuY3Rpb24oZXZ0LCB0YXJnZXQpIHsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgaW5zdGFuY2UuY2xpY2soZXZ0KTsKICAgICAgICB9LAogICAgICAgIGFsbG93UGFnZVNjcm9sbDogJ25vbmUnCiAgICAgIH0pOwogICAgfSwKICAgICAgICAKICAgIC8vIG92ZXJyaWRlIEJhY2tib25lLlZpZXcjcmVtb3ZlIHRvIHJlbW92ZSB0aGUgZXZlbnQgbGlzdGVuZXIgZm9yICdyZXNpemUuc2xpZGVyJwogICAgcmVtb3ZlOiBmdW5jdGlvbigpIHsKICAgICAgJCh3aW5kb3cpLm9mZigncmVzaXplLnNsaWRlcicpOwogICAgICAkKHdpbmRvdykub2ZmKCdrZXl1cC5zbGlkZXInKTsKICAgICAgaWYgKHRoaXMudG91Y2hhYmxlKSB7IHRoaXMudHJheS5vZmYoJ21vdXNlbW92ZS5zbGlkZXInKTsgfQogICAgICB0aGlzLiRlbC5zd2lwZSgnZGVzdHJveScpOwogICAgICBCYWNrYm9uZS5WaWV3LnByb3RvdHlwZS5yZW1vdmUuY2FsbCh0aGlzKTsgLy8gY2FsbCBzdXBlcigpCiAgICAgIC8vIGNvdWxkIGFsc28gYmUgd3JpdHRlbiBhczoKICAgICAgLy8gdGhpcy5jb25zdHJ1Y3Rvci5fX3N1cGVyX18ucmVtb3ZlLmNhbGwodGhpcyk7CiAgICB9LAogICAgCiAgICBrZXlzOiBmdW5jdGlvbihldnQpIHsKICAgICAgaWYgKHRoaXMuaXNPcGVuKCkpIHsKICAgICAgICBzd2l0Y2goZXZ0LmtleUNvZGUpIHsKICAgICAgICAgIGNhc2UgMjc6IC8vIEVTQwogICAgICAgICAgICB0aGlzLmNsb3NlU2xpZGVyKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOTogLy8gUmlnaHQgQ3Vyc29yCiAgICAgICAgICAgIHRoaXMuc2hvd05leHQoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM3OiAvLyBMZWZ0IEN1cnNvcgogICAgICAgICAgICB0aGlzLnNob3dQcmV2KCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIAogICAgLy8gZXhlY3V0ZSBwcmV2L25leHQgb3IgY2xvc2UsIGRlcGVuZGluZyBvbiB0aGUgYXJlYSBjbGlja2VkLgogICAgY2xpY2s6IGZ1bmN0aW9uKGV2dCkgewogICAgICB2YXIgbW91c2VDbWQgPSB0aGlzLl9tYXBNb3VzZUV2ZW50KGV2dCk7CiAgICAgIHN3aXRjaChtb3VzZUNtZCkgewogICAgICAgIGNhc2UgJ25hdi5wcmV2JzoKICAgICAgICAgIHRoaXMuc2hvd1ByZXYoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ25hdi5uZXh0JzoKICAgICAgICAgIHRoaXMuc2hvd05leHQoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ0VTQyc6CiAgICAgICAgICB0aGlzLmNsb3NlU2xpZGVyKCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKICAgIAogICAgLy8gImhvdmVyIiBlZmZlY3QgZm9yIHByZXYvbmV4dCBidXR0b25zIHdoaWxlIG1vdXNlIGlzIG92ZXIgaW1hZ2UKICAgIG1vdXNlbW92ZTogZnVuY3Rpb24oZXZ0KSB7CiAgICAgIHZhciBtb3VzZUNtZCA9IHRoaXMuX21hcE1vdXNlRXZlbnQoZXZ0KTsKICAgICAgaWYgKG1vdXNlQ21kID09PSAnbmF2LnByZXYnKSB7CiAgICAgICAgdGhpcy5uYXZOZXh0LnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICB0aGlzLm5hdlByZXYuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB9IGVsc2UgaWYgKG1vdXNlQ21kID09PSAnbmF2Lm5leHQnKSB7CiAgICAgICAgdGhpcy5uYXZQcmV2LnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICB0aGlzLm5hdk5leHQuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubmF2UHJldi5yZW1vdmVDbGFzcygnYWN0aXZlJyk7CiAgICAgICAgdGhpcy5uYXZOZXh0LnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgfQogICAgfSwKICAgIAogICAgLy8gQ2hlY2sgd2hpY2ggY29tYW5kIHdvdWxkIGJlIGV4ZWN1dGVkIGZyb20gdGhlIGN1cnJlbnQgbW91c2UgcG9zaXRpb24KICAgIF9tYXBNb3VzZUV2ZW50OiBmdW5jdGlvbihldnQpIHsKICAgICAgdmFyICR0YXJnZXQgPSAkKGV2dC50YXJnZXQpOwogICAgICBpZiAoJHRhcmdldC5pcygnLnBob3RvIGltZycpKSB7CiAgICAgICAgLy8gdG91Y2ggZXZlbnRzIGdldCB0aGUgY3VycmVudCBwYWdlIGNvb3JkaW5hdGVzIGluIGFub3RoZXIgZmFzaGlvbiB0aGFuCiAgICAgICAgLy8gcHVyZSBvbGQgY2xpY2sgZXZlbnRzCiAgICAgICAgdmFyIHBhZ2VYID0gKAogICAgICAgICAgZXZ0LmNoYW5nZWRUb3VjaGVzICYmIGV2dC5jaGFuZ2VkVG91Y2hlcy5sZW5ndGggPwogICAgICAgICAgICBldnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggOgogICAgICAgICAgICBldnQucGFnZVgKICAgICAgICApOwogICAgICAgIHZhciBvZmZzZXRYID0gcGFnZVggLSAkKGV2dC50YXJnZXQpLm9mZnNldCgpLmxlZnQ7CiAgICAgICAgdmFyIG9mZnNldFJlbFggPSBvZmZzZXRYIC8gdGhpcy5jdXJyZW50LmdldFdpZHRoKCk7CiAgICAgICAgcmV0dXJuIChvZmZzZXRSZWxYIDwgMC40NSA/ICduYXYucHJldicgOiAnbmF2Lm5leHQnKTsKICAgICAgfSBlbHNlIGlmICgkdGFyZ2V0LmNsb3Nlc3QoJy5jb2NrcGl0JykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgLy8gJC5jbG9zZXN0ID0+IGFsbCB0YXJnZXRzIHdpdGhpbiB0aGUgc3BlY2lmaWVkIC5jb2NrcGl0IGNvbnRhaW5lcgogICAgICAgIHJldHVybiAnRVNDJzsKICAgICAgfQogICAgfSwKICAgIAogICAgaXNPcGVuOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuJGVsLmhhc0NsYXNzKCdvcGVuJyk7CiAgICB9LAogICAgCiAgICBvcGVuU2xpZGVyOiBmdW5jdGlvbihpbWFnZU1vZGVsKSB7CiAgICAgIHRoaXMuX3NldERpbWVuc2lvbnMoKTsKICAgICAgdGhpcy5fc2V0Q3VycmVudChpbWFnZU1vZGVsKTsKICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ29wZW4nKTsKICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdzbGlkZXJfY2xvc2VkJyk7CiAgICAgIHRoaXMuJGVsLmFkZENsYXNzKCd2aXNpYmxlJyk7CiAgICAgIHRoaXMuJGVsLnN3aXBlKCdlbmFibGUnKTsKICAgICAgdGhpcy5tb2RlbC50b2dnbGVTbGlkZXJTdGF0ZSgpOwogICAgfSwKICAgIAogICAgc2hvd05leHQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy5uZXh0KSB7CiAgICAgICAgdmFyIG5ld05leHRCb3ggPSB0aGlzLiRlbC5maW5kKCcjcHJldicpOwogICAgICAgIAogICAgICAgIHRoaXMucHJldiA9IHRoaXMuY3VycmVudDsKICAgICAgICB0aGlzLnByZXZCb3ggPSB0aGlzLmN1cnJlbnRCb3guYXR0cignaWQnLCdwcmV2Jyk7CiAgICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5uZXh0OwogICAgICAgIHRoaXMubW9kZWwuc2V0Q3VycmVudCh0aGlzLm5leHQubW9kZWwpOwogICAgICAgIHRoaXMuY3VycmVudEJveCA9IHRoaXMubmV4dEJveC5hdHRyKCdpZCcsJ2N1cnJlbnQnKTsKICAgICAgICB0aGlzLm5leHRCb3ggPSBuZXdOZXh0Qm94LmF0dHIoJ2lkJywnbmV4dCcpOwogICAgICAgIAogICAgICAgIHRoaXMucHJldkJveC50b2dnbGVDbGFzcygnY3VycmVudCBwcmV2Jyk7CiAgICAgICAgdGhpcy5jdXJyZW50Qm94LnRvZ2dsZUNsYXNzKCduZXh0IGN1cnJlbnQnKTsKICAgICAgICB0aGlzLm5leHRCb3gudG9nZ2xlQ2xhc3MoJ3ByZXYgbmV4dCcpOwogICAgICAgIAogICAgICAgIHRoaXMuX3NldE5leHQoKTsKICAgICAgICB0aGlzLl9jdXJyZW50Q2hhbmdlZCgpOwogICAgICB9CiAgICB9LAogICAgCiAgICBzaG93UHJldjogZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLnByZXYpIHsKICAgICAgICB2YXIgbmV3UHJldkJveCA9IHRoaXMuJGVsLmZpbmQoJyNuZXh0Jyk7CiAgICAgICAgCiAgICAgICAgdGhpcy5uZXh0ID0gdGhpcy5jdXJyZW50OwogICAgICAgIHRoaXMubmV4dEJveCA9IHRoaXMuY3VycmVudEJveC5hdHRyKCdpZCcsJ25leHQnKTsKICAgICAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLnByZXY7CiAgICAgICAgdGhpcy5tb2RlbC5zZXRDdXJyZW50KHRoaXMucHJldi5tb2RlbCk7CiAgICAgICAgdGhpcy5jdXJyZW50Qm94ID0gdGhpcy5wcmV2Qm94LmF0dHIoJ2lkJywnY3VycmVudCcpOwogICAgICAgIHRoaXMucHJldkJveCA9IG5ld1ByZXZCb3guYXR0cignaWQnLCAncHJldicpOwogICAgICAgIAogICAgICAgIHRoaXMubmV4dEJveC50b2dnbGVDbGFzcygnY3VycmVudCBuZXh0Jyk7CiAgICAgICAgdGhpcy5jdXJyZW50Qm94LnRvZ2dsZUNsYXNzKCdwcmV2IGN1cnJlbnQnKTsKICAgICAgICB0aGlzLnByZXZCb3gudG9nZ2xlQ2xhc3MoJ25leHQgcHJldicpOwogICAgICAgIAogICAgICAgIHRoaXMuX3NldFByZXYoKTsKICAgICAgICB0aGlzLl9jdXJyZW50Q2hhbmdlZCgpOwogICAgICB9CiAgICB9LAogICAgCiAgICBjbG9zZVNsaWRlcjogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcignc2xpZGVyOmNsb3NpbmcnLCB0aGlzLmN1cnJlbnQpOwogICAgCiAgICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKCdvcGVuIHZpc2libGUnKTsKICAgICAgJCgnYm9keScpLmFkZENsYXNzKCdzbGlkZXJfY2xvc2VkJyk7CgogICAgICB0aGlzLl9zZXRDdXJyZW50KHVuZGVmaW5lZCk7CiAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMubmV4dCA9IHRoaXMucGVydiA9IHVuZGVmaW5lZDsKICAgICAgCiAgICAgIHRoaXMuJCgnLnBob3RvJykuZW1wdHkoKTsKICAgIAogICAgICAvLyB1cGRhdGUgYnJvd3NlciB1cmwKICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdpbWFnZVBhZ2VzJykgJiYgdGhpcy5tb2RlbC5nZXQoJ3Bvc3RQYXRoJykpIHsKICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCAnJywgdGhpcy5tb2RlbC5nZXQoJ3Bvc3RQYXRoJykpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX3NldEhhc2hiYW5nKG51bGwsICfDhE1QVEknKTsKICAgICAgfQogICAgCiAgICAgIHRoaXMuJGVsLnN3aXBlKCdkaXNhYmxlJyk7CiAgICAgIHRoaXMubW9kZWwudG9nZ2xlU2xpZGVyU3RhdGUoKTsKICAgIH0sCiAgICAKICAgIF9zZXRIYXNoYmFuZzogZnVuY3Rpb24oYmFuZ2Jvb21iYW5nLCB0aXRsZSkgewogICAgICBpZiAoTW9kZXJuaXpyLmhpc3RvcnkpIHsKICAgICAgICB2YXIgbmV3TG9jID0gZG9jdW1lbnQubG9jYXRpb24uaHJlZjsKICAgICAgICBuZXdMb2MgPSBuZXdMb2MucmVwbGFjZSgvXCMuKi8sICcnKSArIChiYW5nYm9vbWJhbmcgPyAnIyEnICsgYmFuZ2Jvb21iYW5nIDogJycpOwogICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsIHRpdGxlLCBuZXdMb2MpOwogICAgICB9CiAgICB9LAogICAgCiAgICBfY3VycmVudENoYW5nZWQ6IGZ1bmN0aW9uKCkgewogICAgICAvLyB1cGRhdGUgYnJvd3NlciB1cmwKICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdpbWFnZVBhZ2VzJykpIHsKICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCAnJywgdGhpcy5jdXJyZW50Lm1vZGVsLmdldCgnaW1hZ2VQYWdlUGF0aCcpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9zZXRIYXNoYmFuZyh0aGlzLmN1cnJlbnQubW9kZWwuaWQsICdJbWFnZSAnICsgdGhpcy5jdXJyZW50Lm1vZGVsLmlkKTsKICAgICAgfQogICAgICAKICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKCdzbGlkZXI6bmV3SW1hZ2UnLCB0aGlzLmN1cnJlbnQpOwogICAgICAKICAgICAgaWYgKHRoaXMubmV4dCkgeyB0aGlzLm5hdk5leHQucmVtb3ZlQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7IH0KICAgICAgZWxzZSB7IHRoaXMubmF2TmV4dC5hZGRDbGFzcygndmlzdWFsbHloaWRkZW4nKTsgfQogICAgICBpZiAodGhpcy5wcmV2KSB7IHRoaXMubmF2UHJldi5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTsgfQogICAgICBlbHNlIHsgdGhpcy5uYXZQcmV2LmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpOyB9CiAgICAgIAogICAgfSwKICAgIAogICAgX3NldEN1cnJlbnQ6IGZ1bmN0aW9uKGltYWdlTW9kZWwpIHsKICAgICAgdGhpcy5tb2RlbC5zZXRDdXJyZW50KGltYWdlTW9kZWwpOwogICAgICB2YXIgbGFyZ2VWaWV3ID0gdGhpcy5fbG9hZE9yR2V0TGFyZ2UoaW1hZ2VNb2RlbCk7CiAgICAgIGlmIChsYXJnZVZpZXcpIHsKICAgICAgICB0aGlzLmN1cnJlbnQgPSBsYXJnZVZpZXc7CiAgICAgICAgdGhpcy5jdXJyZW50Qm94Lmh0bWwodGhpcy5jdXJyZW50LiRlbCk7CiAgICAgICAgdGhpcy5fY3VycmVudENoYW5nZWQoKTsKICAgICAgICB0aGlzLl9zZXROZXh0KCk7CiAgICAgICAgdGhpcy5fc2V0UHJldigpOwogICAgICB9CiAgICB9ICwKICAgIAogICAgX3NldE5leHQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLm5leHQgPSB0aGlzLl9sb2FkT3JHZXRMYXJnZSh0aGlzLm1vZGVsLmdldE5leHQoKSk7CiAgICAgIGlmICh0aGlzLm5leHQpIHsKICAgICAgICB0aGlzLm5leHRCb3guaHRtbCh0aGlzLm5leHQuJGVsKTsKICAgICAgICB0aGlzLm5hdk5leHQucmVtb3ZlQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5uYXZOZXh0LmFkZENsYXNzKCd2aXN1YWxseWhpZGRlbicpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLm5leHQ7CiAgICB9LAogICAgCiAgICBfc2V0UHJldjogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucHJldiA9IHRoaXMuX2xvYWRPckdldExhcmdlKHRoaXMubW9kZWwuZ2V0UHJldigpKTsKICAgICAgaWYgKHRoaXMucHJldikgewogICAgICAgIHRoaXMucHJldkJveC5odG1sKHRoaXMucHJldi4kZWwpOwogICAgICAgIHRoaXMubmF2UHJldi5yZW1vdmVDbGFzcygndmlzdWFsbHloaWRkZW4nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm5hdlByZXYuYWRkQ2xhc3MoJ3Zpc3VhbGx5aGlkZGVuJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMucHJldjsKICAgIH0sCiAgICAKICAgIC8vIHNhdmUgY3VycmVudCB0cmF5IHJlc29sdXRpb24gb24gdGhlIEltYWdlTW9kZWwgb3IgTGFyZ2VWaWV3CiAgICBfbG9hZE9yR2V0TGFyZ2U6IGZ1bmN0aW9uKGltYWdlTW9kZWwpIHsKICAgICAgaWYgKGltYWdlTW9kZWwpIHsKICAgICAgICB2YXIgbGFyZ2VWaWV3ID0gKAogICAgICAgICAgaW1hZ2VNb2RlbC5nZXRMYXJnZVZpZXcoKSB8fAogICAgICAgICAgbmV3IExhcmdlVmlldyh7CiAgICAgICAgICAgIG1vZGVsOiBpbWFnZU1vZGVsLAogICAgICAgICAgICBzbGlkZXI6IHRoaXMKICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgICAgICBsYXJnZVZpZXcucmVzaXplKCk7CiAgICAgICAgcmV0dXJuIGxhcmdlVmlldzsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CiAgICB9LAoKICAgIHJlc2l6ZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuX3NldERpbWVuc2lvbnMoKTsKICAgICAgCiAgICAgIGlmICh0aGlzLmN1cnJlbnQpIHsgdGhpcy5jdXJyZW50LnJlc2l6ZSgpOyB9CiAgICAgIGlmICh0aGlzLm5leHQpIHsgdGhpcy5uZXh0LnJlc2l6ZSgpOyB9CiAgICAgIGlmICh0aGlzLnByZXYpIHsgdGhpcy5wcmV2LnJlc2l6ZSgpOyB9CiAgICB9LAogICAgCiAgICBfc2V0RGltZW5zaW9uczogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMud2lkdGggPSB0aGlzLnRyYXkud2lkdGgoKTsKICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnRyYXkuaGVpZ2h0KCk7CiAgICAgIHRoaXMucmF0aW8gPSB0aGlzLndpZHRoIC8gdGhpcy5oZWlnaHQ7CiAgICAgIHRoaXMub3JpZW50YXRpb24gPSB0aGlzLnJhdGlvID4gMSA/ICdsYW5kc2NhcGUnIDogJ3BvcnRyYWl0JzsKICAgIH0KICAgIAogIH0pOwogIAogIHJldHVybiBTbGlkZXJWaWV3Owp9KTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 02:03:48 GMT",
                    "Content-Length": "11202",
                    "Date": "Fri, 07 Nov 2014 02:03:48 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}