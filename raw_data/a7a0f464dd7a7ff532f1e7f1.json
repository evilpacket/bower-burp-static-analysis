{
    "url": "http://localhost:9999/lhorie/mithril/archive/v0.1.22/mithril-tests.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>window.location.pathname</b> and written to <b>the 'href' property of a DOM element</b> via the following statement:<ul><li>element.href = window.location.pathname + modes[m.route.mode] + context.href</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/lhorie/mithril/archive/v0.1.22/mithril-tests.js",
                "path": "/lhorie/mithril/archive/v0.1.22/mithril-tests.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9saG9yaWUvbWl0aHJpbC9hcmNoaXZlL3YwLjEuMjIvbWl0aHJpbC10ZXN0cy5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTA4Mjk3DQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBGcmksIDA3IE5vdiAyMDE0IDE2OjEyOjA3IEdNVA0KTGFzdC1Nb2RpZmllZDogRnJpLCAwNyBOb3YgMjAxNCAxNjoxMjowNSBHTVQNCg0KTWl0aHJpbCA9IG0gPSBuZXcgZnVuY3Rpb24gYXBwKHdpbmRvdywgdW5kZWZpbmVkKSB7Cgl2YXIgc09iaiA9ICJbb2JqZWN0IE9iamVjdF0iLCBzQXJyID0gIltvYmplY3QgQXJyYXldIiwgc1N0ciA9ICJbb2JqZWN0IFN0cmluZ10iCglmdW5jdGlvbiB0eXBlKG9iaikge3JldHVybiB7fS50b1N0cmluZy5jYWxsKG9iail9CglmdW5jdGlvbiBpc09iaihvYmopIHtyZXR1cm4gdHlwZShvYmopID09IHNPYmp9CglmdW5jdGlvbiBpc0FycihvYmopIHtyZXR1cm4gdHlwZShvYmopID09IHNBcnJ9CglmdW5jdGlvbiBpc0ZuKG9iaikge3JldHVybiB0eXBlb2Ygb2JqID09ICJmdW5jdGlvbiJ9CglmdW5jdGlvbiBpc1N0cihvYmopeyByZXR1cm4gdHlwZShvYmopID09IHNTdHJ9Cgl2YXIgcGFyc2VyID0gLyg/OihefCN8XC4pKFteI1wuXFtcXV0rKSl8KFxbLis/XF0pL2csIGF0dHJQYXJzZXIgPSAvXFsoLis/KSg/Oj0oInwnfCkoLio/KVwyKT9cXS8KCXZhciB2b2lkRWxlbWVudHMgPSAvQVJFQXxCQVNFfEJSfENPTHxDT01NQU5EfEVNQkVEfEhSfElNR3xJTlBVVHxLRVlHRU58TElOS3xNRVRBfFBBUkFNfFNPVVJDRXxUUuKAjOKAi0FDS3xXQlIvCgoJLyoKCSAqIEB0eXBlZGVmIHtTdHJpbmd9IFRhZwoJICogQSBzdHJpbmcgdGhhdCBsb29rcyBsaWtlIC0+IGRpdi5jbGFzc25hbWUjaWRbcGFyYW09b25lXVtwYXJhbTI9dHdvXQoJICogV2hpY2ggZGVzY3JpYmVzIGEgRE9NIG5vZGUKCSAqLwoKCS8qCgkgKgoJICogQHBhcmFtIHtUYWd9IFRoZSBET00gbm9kZSB0YWcKCSAqIEBwYXJhbSB7T2JqZWN0PVtdfSBvcHRpb25hbCBrZXktdmFsdWUgcGFpcnMgdG8gYmUgbWFwcGVkIHRvIERPTSBhdHRycwoJICogQHBhcmFtIHsuLi5tTm9kZT1bXX0gWmVybyBvciBtb3JlIE1pdGhyaWwgY2hpbGQgbm9kZXMuIENhbiBiZSBhbiBhcnJheSwgb3Igc3BsYXQgKG9wdGlvbmFsKQoJICoKCSAqLwoJZnVuY3Rpb24gbSgpIHsKCQl2YXIgYXJyU2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CgkJdmFyIGFyZ3MgPSBhcnJTbGljZS5jYWxsKGFyZ3VtZW50cywgMCkKCQl2YXIgaGFzQXR0cnMgPSBhcmdzWzFdICE9IG51bGwgJiYgaXNPYmooYXJnc1sxXSkgJiYgISgidGFnIiBpbiBhcmdzWzFdKSAmJiAhKCJzdWJ0cmVlIiBpbiBhcmdzWzFdKQoJCXZhciBhdHRycyA9IGhhc0F0dHJzID8gYXJnc1sxXSA6IHt9CgkJdmFyIGNsYXNzQXR0ck5hbWUgPSAiY2xhc3MiIGluIGF0dHJzID8gImNsYXNzIiA6ICJjbGFzc05hbWUiCgkJdmFyIGNlbGwgPSB7dGFnOiAiZGl2IiwgYXR0cnM6IHt9fQoJCXZhciBtYXRjaCwgY2xhc3NlcyA9IFtdCgkJd2hpbGUgKG1hdGNoID0gcGFyc2VyLmV4ZWMoYXJnc1swXSkpIHsKCQkJaWYgKG1hdGNoWzFdID09ICIiKSBjZWxsLnRhZyA9IG1hdGNoWzJdCgkJCWVsc2UgaWYgKG1hdGNoWzFdID09ICIjIikgY2VsbC5hdHRycy5pZCA9IG1hdGNoWzJdCgkJCWVsc2UgaWYgKG1hdGNoWzFdID09ICIuIikgY2xhc3Nlcy5wdXNoKG1hdGNoWzJdKQoJCQllbHNlIGlmIChtYXRjaFszXVswXSA9PSAiWyIpIHsKCQkJCXZhciBwYWlyID0gYXR0clBhcnNlci5leGVjKG1hdGNoWzNdKQoJCQkJY2VsbC5hdHRyc1twYWlyWzFdXSA9IHBhaXJbM10gfHwgKHBhaXJbMl0gPyAiIiA6dHJ1ZSkKCQkJfQoJCX0KCQlpZiAoY2xhc3Nlcy5sZW5ndGggPiAwKSBjZWxsLmF0dHJzW2NsYXNzQXR0ck5hbWVdID0gY2xhc3Nlcy5qb2luKCIgIikKCgoJCXZhciBjaGlsZHJlbiA9IGhhc0F0dHJzID8gYXJnc1syXSA6IGFyZ3NbMV0KCQlpZiAoaXNBcnIoY2hpbGRyZW4pIHx8IHR5cGUoY2hpbGRyZW4pID09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSB7CgkJCWNlbGwuY2hpbGRyZW4gPSBhcnJTbGljZS5jYWxsKGNoaWxkcmVuLCAwKQoJCX0KCQllbHNlIHsKCQkJY2VsbC5jaGlsZHJlbiA9IGhhc0F0dHJzID8gYXJncy5zbGljZSgyKSA6IGFyZ3Muc2xpY2UoMSkKCQl9CgoJCWZvciAodmFyIGF0dHJOYW1lIGluIGF0dHJzKSB7CgkJCWlmIChhdHRyTmFtZSA9PSBjbGFzc0F0dHJOYW1lKSBjZWxsLmF0dHJzW2F0dHJOYW1lXSA9IChjZWxsLmF0dHJzW2F0dHJOYW1lXSB8fCAiIikgKyAiICIgKyBhdHRyc1thdHRyTmFtZV0KCQkJZWxzZSBjZWxsLmF0dHJzW2F0dHJOYW1lXSA9IGF0dHJzW2F0dHJOYW1lXQoJCX0KCQlyZXR1cm4gY2VsbAoJfQoJZnVuY3Rpb24gYnVpbGQocGFyZW50RWxlbWVudCwgcGFyZW50VGFnLCBwYXJlbnRDYWNoZSwgcGFyZW50SW5kZXgsIGRhdGEsIGNhY2hlZCwgc2hvdWxkUmVhdHRhY2gsIGluZGV4LCBlZGl0YWJsZSwgbmFtZXNwYWNlLCBjb25maWdzKSB7CgkJLy9gYnVpbGRgIGlzIGEgcmVjdXJzaXZlIGZ1bmN0aW9uIHRoYXQgbWFuYWdlcyBjcmVhdGlvbi9kaWZmaW5nL3JlbW92YWwgb2YgRE9NIGVsZW1lbnRzIGJhc2VkIG9uIGNvbXBhcmlzb24gYmV0d2VlbiBgZGF0YWAgYW5kIGBjYWNoZWRgCgkJLy90aGUgZGlmZiBhbGdvcml0aG0gY2FuIGJlIHN1bW1hcml6ZWQgYXMgdGhpczoKCQkvLzEgLSBjb21wYXJlIGBkYXRhYCBhbmQgYGNhY2hlZGAKCQkvLzIgLSBpZiB0aGV5IGFyZSBkaWZmZXJlbnQsIGNvcHkgYGRhdGFgIHRvIGBjYWNoZWRgIGFuZCB1cGRhdGUgdGhlIERPTSBiYXNlZCBvbiB3aGF0IHRoZSBkaWZmZXJlbmNlIGlzCgkJLy8zIC0gcmVjdXJzaXZlbHkgYXBwbHkgdGhpcyBhbGdvcml0aG0gZm9yIGV2ZXJ5IGFycmF5IGFuZCBmb3IgdGhlIGNoaWxkcmVuIG9mIGV2ZXJ5IHZpcnR1YWwgZWxlbWVudAoKCQkvL3RoZSBgY2FjaGVkYCBkYXRhIHN0cnVjdHVyZSBpcyBlc3NlbnRpYWxseSB0aGUgc2FtZSBhcyB0aGUgcHJldmlvdXMgcmVkcmF3J3MgYGRhdGFgIGRhdGEgc3RydWN0dXJlLCB3aXRoIGEgZmV3IGFkZGl0aW9uczoKCQkvLy0gYGNhY2hlZGAgYWx3YXlzIGhhcyBhIHByb3BlcnR5IGNhbGxlZCBgbm9kZXNgLCB3aGljaCBpcyBhIGxpc3Qgb2YgRE9NIGVsZW1lbnRzIHRoYXQgY29ycmVzcG9uZCB0byB0aGUgZGF0YSByZXByZXNlbnRlZCBieSB0aGUgcmVzcGVjdGl2ZSB2aXJ0dWFsIGVsZW1lbnQKCQkvLy0gaW4gb3JkZXIgdG8gc3VwcG9ydCBhdHRhY2hpbmcgYG5vZGVzYCBhcyBhIHByb3BlcnR5IG9mIGBjYWNoZWRgLCBgY2FjaGVkYCBpcyAqYWx3YXlzKiBhIG5vbi1wcmltaXRpdmUgb2JqZWN0LCBpLmUuIGlmIHRoZSBkYXRhIHdhcyBhIHN0cmluZywgdGhlbiBjYWNoZWQgaXMgYSBTdHJpbmcgaW5zdGFuY2UuIElmIGRhdGEgd2FzIGBudWxsYCBvciBgdW5kZWZpbmVkYCwgY2FjaGVkIGlzIGBuZXcgU3RyaW5nKCIiKWAKCQkvLy0gYGNhY2hlZCBhbHNvIGhhcyBhIGBjb25maWdDb250ZXh0YCBwcm9wZXJ0eSwgd2hpY2ggaXMgdGhlIHN0YXRlIHN0b3JhZ2Ugb2JqZWN0IGV4cG9zZWQgYnkgY29uZmlnKGVsZW1lbnQsIGlzSW5pdGlhbGl6ZWQsIGNvbnRleHQpCgkJLy8tIHdoZW4gYGNhY2hlZGAgaXMgYW4gT2JqZWN0LCBpdCByZXByZXNlbnRzIGEgdmlydHVhbCBlbGVtZW50OyB3aGVuIGl0J3MgYW4gQXJyYXksIGl0IHJlcHJlc2VudHMgYSBsaXN0IG9mIGVsZW1lbnRzOyB3aGVuIGl0J3MgYSBTdHJpbmcsIE51bWJlciBvciBCb29sZWFuLCBpdCByZXByZXNlbnRzIGEgdGV4dCBub2RlCgoJCS8vYHBhcmVudEVsZW1lbnRgIGlzIGEgRE9NIGVsZW1lbnQgdXNlZCBmb3IgVzNDIERPTSBBUEkgY2FsbHMKCQkvL2BwYXJlbnRUYWdgIGlzIG9ubHkgdXNlZCBmb3IgaGFuZGxpbmcgYSBjb3JuZXIgY2FzZSBmb3IgdGV4dGFyZWEgdmFsdWVzCgkJLy9gcGFyZW50Q2FjaGVgIGlzIHVzZWQgdG8gcmVtb3ZlIG5vZGVzIGluIHNvbWUgbXVsdGktbm9kZSBjYXNlcwoJCS8vYHBhcmVudEluZGV4YCBhbmQgYGluZGV4YCBhcmUgdXNlZCB0byBmaWd1cmUgb3V0IHRoZSBvZmZzZXQgb2Ygbm9kZXMuIFRoZXkncmUgYXJ0aWZhY3RzIGZyb20gYmVmb3JlIGFycmF5cyBzdGFydGVkIGJlaW5nIGZsYXR0ZW5lZCBhbmQgYXJlIGxpa2VseSByZWZhY3RvcmFibGUKCQkvL2BkYXRhYCBhbmQgYGNhY2hlZGAgYXJlLCByZXNwZWN0aXZlbHksIHRoZSBuZXcgYW5kIG9sZCBub2RlcyBiZWluZyBkaWZmZWQKCQkvL2BzaG91bGRSZWF0dGFjaGAgaXMgYSBmbGFnIGluZGljYXRpbmcgd2hldGhlciBhIHBhcmVudCBub2RlIHdhcyByZWNyZWF0ZWQgKGlmIHNvLCBhbmQgaWYgdGhpcyBub2RlIGlzIHJldXNlZCwgdGhlbiB0aGlzIG5vZGUgbXVzdCByZWF0dGFjaCBpdHNlbGYgdG8gdGhlIG5ldyBwYXJlbnQpCgkJLy9gZWRpdGFibGVgIGlzIGEgZmxhZyB0aGF0IGluZGljYXRlcyB3aGV0aGVyIGFuIGFuY2VzdG9yIGlzIGNvbnRlbnRlZGl0YWJsZQoJCS8vYG5hbWVzcGFjZWAgaW5kaWNhdGVzIHRoZSBjbG9zZXN0IEhUTUwgbmFtZXNwYWNlIGFzIGl0IGNhc2NhZGVzIGRvd24gZnJvbSBhbiBhbmNlc3RvcgoJCS8vYGNvbmZpZ3NgIGlzIGEgbGlzdCBvZiBjb25maWcgZnVuY3Rpb25zIHRvIHJ1biBhZnRlciB0aGUgdG9wbW9zdCBgYnVpbGRgIGNhbGwgZmluaXNoZXMgcnVubmluZwoKCQkvL3RoZXJlJ3MgbG9naWMgdGhhdCByZWxpZXMgb24gdGhlIGFzc3VtcHRpb24gdGhhdCBudWxsIGFuZCB1bmRlZmluZWQgZGF0YSBhcmUgZXF1aXZhbGVudCB0byBlbXB0eSBzdHJpbmdzCgkJLy8tIHRoaXMgcHJldmVudHMgbGlmZWN5Y2xlIHN1cnByaXNlcyBmcm9tIHByb2NlZHVyYWwgaGVscGVycyB0aGF0IG1peCBpbXBsaWNpdCBhbmQgZXhwbGljaXQgcmV0dXJuIHN0YXRlbWVudHMKCQkvLy0gaXQgc2ltcGxpZmllcyBkaWZmaW5nIGNvZGUKCQlpZiAoZGF0YSA9PSBudWxsKSBkYXRhID0gIiIKCQlpZiAoZGF0YS5zdWJ0cmVlID09PSAicmV0YWluIikgcmV0dXJuIGNhY2hlZAoJCXZhciBjYWNoZWRUeXBlID0gdHlwZShjYWNoZWQpLCBkYXRhVHlwZSA9IHR5cGUoZGF0YSkKCQlpZiAoY2FjaGVkID09IG51bGwgfHwgY2FjaGVkVHlwZSAhPSBkYXRhVHlwZSkgewoJCQlpZiAoY2FjaGVkICE9IG51bGwpIHsKCQkJCWlmIChwYXJlbnRDYWNoZSAmJiBwYXJlbnRDYWNoZS5ub2RlcykgewoJCQkJCXZhciBvZmZzZXQgPSBpbmRleCAtIHBhcmVudEluZGV4CgkJCQkJdmFyIGVuZCA9IG9mZnNldCArIChkYXRhVHlwZSA9PSBzQXJyID8gZGF0YSA6IGNhY2hlZC5ub2RlcykubGVuZ3RoCgkJCQkJY2xlYXIocGFyZW50Q2FjaGUubm9kZXMuc2xpY2Uob2Zmc2V0LCBlbmQpLCBwYXJlbnRDYWNoZS5zbGljZShvZmZzZXQsIGVuZCkpCgkJCQl9CgkJCQllbHNlIGlmIChjYWNoZWQubm9kZXMpIGNsZWFyKGNhY2hlZC5ub2RlcywgY2FjaGVkKQoJCQl9CgkJCWNhY2hlZCA9IG5ldyBkYXRhLmNvbnN0cnVjdG9yCgkJCWlmIChjYWNoZWQudGFnKSBjYWNoZWQgPSB7fSAvL2lmIGNvbnN0cnVjdG9yIGNyZWF0ZXMgYSB2aXJ0dWFsIGRvbSBlbGVtZW50LCB1c2UgYSBibGFuayBvYmplY3QgYXMgdGhlIGJhc2UgY2FjaGVkIG5vZGUgaW5zdGVhZCBvZiBjb3B5aW5nIHRoZSB2aXJ0dWFsIGVsICgjMjc3KQoJCQljYWNoZWQubm9kZXMgPSBbXQoJCX0KCgkJaWYgKGRhdGFUeXBlID09IHNBcnIpIHsKCQkJZGF0YSA9IGZsYXR0ZW4oZGF0YSkKCQkJdmFyIG5vZGVzID0gW10sIGludGFjdCA9IGNhY2hlZC5sZW5ndGggPT09IGRhdGEubGVuZ3RoLCBzdWJBcnJheUNvdW50ID0gMAoKCQkJLy9rZXlzIGFsZ29yaXRobTogc29ydCBlbGVtZW50cyB3aXRob3V0IHJlY3JlYXRpbmcgdGhlbSBpZiBrZXlzIGFyZSBwcmVzZW50CgkJCS8vMSkgY3JlYXRlIGEgbWFwIG9mIGFsbCBleGlzdGluZyBrZXlzLCBhbmQgbWFyayBhbGwgZm9yIGRlbGV0aW9uCgkJCS8vMikgYWRkIG5ldyBrZXlzIHRvIG1hcCBhbmQgbWFyayB0aGVtIGZvciBhZGRpdGlvbgoJCQkvLzMpIGlmIGtleSBleGlzdHMgaW4gbmV3IGxpc3QsIGNoYW5nZSBhY3Rpb24gZnJvbSBkZWxldGlvbiB0byBhIG1vdmUKCQkJLy80KSBmb3IgZWFjaCBrZXksIGhhbmRsZSBpdHMgY29ycmVzcG9uZGluZyBhY3Rpb24gYXMgbWFya2VkIGluIHByZXZpb3VzIHN0ZXBzCgkJCS8vNSkgY29weSB1bmtleWVkIGl0ZW1zIGludG8gdGhlaXIgcmVzcGVjdGl2ZSBnYXBzCgkJCXZhciBERUxFVElPTiA9IDEsIElOU0VSVElPTiA9IDIgLCBNT1ZFID0gMwoJCQl2YXIgZXhpc3RpbmcgPSB7fSwgdW5rZXllZCA9IFtdLCBzaG91bGRNYWludGFpbklkZW50aXRpZXMgPSBmYWxzZQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGNhY2hlZC5sZW5ndGg7IGkrKykgewoJCQkJaWYgKGNhY2hlZFtpXSAmJiBjYWNoZWRbaV0uYXR0cnMgJiYgY2FjaGVkW2ldLmF0dHJzLmtleSAhPSBudWxsKSB7CgkJCQkJc2hvdWxkTWFpbnRhaW5JZGVudGl0aWVzID0gdHJ1ZQoJCQkJCWV4aXN0aW5nW2NhY2hlZFtpXS5hdHRycy5rZXldID0ge2FjdGlvbjogREVMRVRJT04sIGluZGV4OiBpfQoJCQkJfQoJCQl9CgkJCWlmIChzaG91bGRNYWludGFpbklkZW50aXRpZXMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChkYXRhW2ldICYmIGRhdGFbaV0uYXR0cnMpIHsKCQkJCQkJaWYgKGRhdGFbaV0uYXR0cnMua2V5ICE9IG51bGwpIHsKCQkJCQkJCXZhciBrZXkgPSBkYXRhW2ldLmF0dHJzLmtleQoJCQkJCQkJaWYgKCFleGlzdGluZ1trZXldKSBleGlzdGluZ1trZXldID0ge2FjdGlvbjogSU5TRVJUSU9OLCBpbmRleDogaX0KCQkJCQkJCWVsc2UgZXhpc3Rpbmdba2V5XSA9IHsKCQkJCQkJCQlhY3Rpb246IE1PVkUsCgkJCQkJCQkJaW5kZXg6IGksCgkJCQkJCQkJZnJvbTogZXhpc3Rpbmdba2V5XS5pbmRleCwKCQkJCQkJCQllbGVtZW50OiBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbZXhpc3Rpbmdba2V5XS5pbmRleF0gfHwgd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZSB1bmtleWVkLnB1c2goe2luZGV4OiBpLCBlbGVtZW50OiBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaV0gfHwgd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpfSkKCQkJCQl9CgkJCQl9CgkJCQl2YXIgYWN0aW9ucyA9IE9iamVjdC5rZXlzKGV4aXN0aW5nKS5tYXAoZnVuY3Rpb24oa2V5KSB7cmV0dXJuIGV4aXN0aW5nW2tleV19KQoJCQkJdmFyIGNoYW5nZXMgPSBhY3Rpb25zLnNvcnQoZnVuY3Rpb24oYSwgYikge3JldHVybiBhLmFjdGlvbiAtIGIuYWN0aW9uIHx8IGEuaW5kZXggLSBiLmluZGV4fSkKCQkJCXZhciBuZXdDYWNoZWQgPSBjYWNoZWQuc2xpY2UoKQoKCQkJCWZvciAodmFyIGkgPSAwLCBjaGFuZ2U7IGNoYW5nZSA9IGNoYW5nZXNbaV07IGkrKykgewoJCQkJCWlmIChjaGFuZ2UuYWN0aW9uID09IERFTEVUSU9OKSB7CgkJCQkJCWNsZWFyKGNhY2hlZFtjaGFuZ2UuaW5kZXhdLm5vZGVzLCBjYWNoZWRbY2hhbmdlLmluZGV4XSkKCQkJCQkJbmV3Q2FjaGVkLnNwbGljZShjaGFuZ2UuaW5kZXgsIDEpCgkJCQkJfQoJCQkJCWlmIChjaGFuZ2UuYWN0aW9uID09IElOU0VSVElPTikgewoJCQkJCQl2YXIgZHVtbXkgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQkJCQkJZHVtbXkua2V5ID0gZGF0YVtjaGFuZ2UuaW5kZXhdLmF0dHJzLmtleQoJCQkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShkdW1teSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2NoYW5nZS5pbmRleF0pCgkJCQkJCW5ld0NhY2hlZC5zcGxpY2UoY2hhbmdlLmluZGV4LCAwLCB7YXR0cnM6IHtrZXk6IGRhdGFbY2hhbmdlLmluZGV4XS5hdHRycy5rZXl9LCBub2RlczogW2R1bW15XX0pCgkJCQkJfQoKCQkJCQlpZiAoY2hhbmdlLmFjdGlvbiA9PSBNT1ZFKSB7CgkJCQkJCWlmIChwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSAhPT0gY2hhbmdlLmVsZW1lbnQgJiYgY2hhbmdlLmVsZW1lbnQgIT09IG51bGwpIHsKCQkJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGNoYW5nZS5lbGVtZW50LCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSkKCQkJCQkJfQoJCQkJCQluZXdDYWNoZWRbY2hhbmdlLmluZGV4XSA9IGNhY2hlZFtjaGFuZ2UuZnJvbV0KCQkJCQl9CgkJCQl9CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHVua2V5ZWQubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgY2hhbmdlID0gdW5rZXllZFtpXQoJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGNoYW5nZS5lbGVtZW50LCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSkKCQkJCQluZXdDYWNoZWRbY2hhbmdlLmluZGV4XSA9IGNhY2hlZFtjaGFuZ2UuaW5kZXhdCgkJCQl9CgkJCQljYWNoZWQgPSBuZXdDYWNoZWQKCQkJCWNhY2hlZC5ub2RlcyA9IFtdCgkJCQlmb3IgKHZhciBpID0gMCwgY2hpbGQ7IGNoaWxkID0gcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2ldOyBpKyspIGNhY2hlZC5ub2Rlcy5wdXNoKGNoaWxkKQoJCQl9CgkJCS8vZW5kIGtleSBhbGdvcml0aG0KCgkJCWZvciAodmFyIGkgPSAwLCBjYWNoZUNvdW50ID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJCS8vZGlmZiBlYWNoIGl0ZW0gaW4gdGhlIGFycmF5CgkJCQl2YXIgaXRlbSA9IGJ1aWxkKHBhcmVudEVsZW1lbnQsIHBhcmVudFRhZywgY2FjaGVkLCBpbmRleCwgZGF0YVtpXSwgY2FjaGVkW2NhY2hlQ291bnRdLCBzaG91bGRSZWF0dGFjaCwgaW5kZXggKyBzdWJBcnJheUNvdW50IHx8IHN1YkFycmF5Q291bnQsIGVkaXRhYmxlLCBuYW1lc3BhY2UsIGNvbmZpZ3MpCgkJCQlpZiAoaXRlbSA9PT0gdW5kZWZpbmVkKSBjb250aW51ZQoJCQkJaWYgKCFpdGVtLm5vZGVzLmludGFjdCkgaW50YWN0ID0gZmFsc2UKCQkJCXN1YkFycmF5Q291bnQgKz0gaXNBcnIoaXRlbSkgPyBpdGVtLmxlbmd0aCA6IDEKCQkJCWNhY2hlZFtjYWNoZUNvdW50KytdID0gaXRlbQoJCQl9CgkJCWlmICghaW50YWN0KSB7CgkJCQkvL2RpZmYgdGhlIGFycmF5IGl0c2VsZgoKCQkJCS8vdXBkYXRlIHRoZSBsaXN0IG9mIERPTSBub2RlcyBieSBjb2xsZWN0aW5nIHRoZSBub2RlcyBmcm9tIGVhY2ggaXRlbQoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKGNhY2hlZFtpXSAhPSBudWxsKSBub2RlcyA9IG5vZGVzLmNvbmNhdChjYWNoZWRbaV0ubm9kZXMpCgkJCQl9CgkJCQkvL3JlbW92ZSBpdGVtcyBmcm9tIHRoZSBlbmQgb2YgdGhlIGFycmF5IGlmIHRoZSBuZXcgYXJyYXkgaXMgc2hvcnRlciB0aGFuIHRoZSBvbGQgb25lCgkJCQkvL2lmIGVycm9ycyBldmVyIGhhcHBlbiBoZXJlLCB0aGUgaXNzdWUgaXMgbW9zdCBsaWtlbHkgYSBidWcgaW4gdGhlIGNvbnN0cnVjdGlvbiBvZiB0aGUgYGNhY2hlZGAgZGF0YSBzdHJ1Y3R1cmUgc29tZXdoZXJlIGVhcmxpZXIgaW4gdGhlIHByb2dyYW0KCQkJCWZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gY2FjaGVkLm5vZGVzW2ldOyBpKyspIHsKCQkJCQlpZiAobm9kZS5wYXJlbnROb2RlICE9IG51bGwgJiYgbm9kZXMuaW5kZXhPZihub2RlKSA8IDApIGNsZWFyKFtub2RlXSwgW2NhY2hlZFtpXV0pCgkJCQl9CgkJCQkvL2FkZCBpdGVtcyB0byB0aGUgZW5kIGlmIHRoZSBuZXcgYXJyYXkgaXMgbG9uZ2VyIHRoYW4gdGhlIG9sZCBvbmUKCQkJCWZvciAodmFyIGkgPSBjYWNoZWQubm9kZXMubGVuZ3RoLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykgewoJCQkJCWlmIChub2RlLnBhcmVudE5vZGUgPT0gbnVsbCkgcGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChub2RlKQoJCQkJfQoJCQkJaWYgKGRhdGEubGVuZ3RoIDwgY2FjaGVkLmxlbmd0aCkgY2FjaGVkLmxlbmd0aCA9IGRhdGEubGVuZ3RoCgkJCQljYWNoZWQubm9kZXMgPSBub2RlcwoJCQl9CgkJfQoJCWVsc2UgaWYgKGRhdGEgIT0gbnVsbCAmJiBkYXRhVHlwZSA9PSBzT2JqKSB7CgkJCS8vaWYgYW4gZWxlbWVudCBpcyBkaWZmZXJlbnQgZW5vdWdoIGZyb20gdGhlIG9uZSBpbiBjYWNoZSwgcmVjcmVhdGUgaXQKCQkJaWYgKGRhdGEudGFnICE9IGNhY2hlZC50YWcgfHwgT2JqZWN0LmtleXMoZGF0YS5hdHRycykuam9pbigpICE9IE9iamVjdC5rZXlzKGNhY2hlZC5hdHRycykuam9pbigpIHx8IGRhdGEuYXR0cnMuaWQgIT0gY2FjaGVkLmF0dHJzLmlkKSB7CgkJCQljbGVhcihjYWNoZWQubm9kZXMpCgkJCQlpZiAoY2FjaGVkLmNvbmZpZ0NvbnRleHQgJiYgaXNGbihjYWNoZWQuY29uZmlnQ29udGV4dC5vbnVubG9hZCkpIGNhY2hlZC5jb25maWdDb250ZXh0Lm9udW5sb2FkKCkKCQkJfQoJCQlpZiAoIWlzU3RyKGRhdGEudGFnKSkgcmV0dXJuCgoJCQl2YXIgbm9kZSwgaXNOZXcgPSBjYWNoZWQubm9kZXMubGVuZ3RoID09PSAwCgkJCWlmIChkYXRhLmF0dHJzLnhtbG5zKSBuYW1lc3BhY2UgPSBkYXRhLmF0dHJzLnhtbG5zCgkJCWVsc2UgaWYgKGRhdGEudGFnID09PSAic3ZnIikgbmFtZXNwYWNlID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgoJCQllbHNlIGlmIChkYXRhLnRhZyA9PT0gIm1hdGgiKSBuYW1lc3BhY2UgPSAiaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCIKCQkJaWYgKGlzTmV3KSB7CgkJCQlub2RlID0gbmFtZXNwYWNlID09PSB1bmRlZmluZWQgPyB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudChkYXRhLnRhZykgOiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZSwgZGF0YS50YWcpCgkJCQljYWNoZWQgPSB7CgkJCQkJdGFnOiBkYXRhLnRhZywKCQkJCQkvL3Byb2Nlc3MgY2hpbGRyZW4gYmVmb3JlIGF0dHJzIHNvIHRoYXQgc2VsZWN0LnZhbHVlIHdvcmtzIGNvcnJlY3RseQoJCQkJCWNoaWxkcmVuOiBidWlsZChub2RlLCBkYXRhLnRhZywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGRhdGEuY2hpbGRyZW4sIGNhY2hlZC5jaGlsZHJlbiwgdHJ1ZSwgMCwgZGF0YS5hdHRycy5jb250ZW50ZWRpdGFibGUgPyBub2RlIDogZWRpdGFibGUsIG5hbWVzcGFjZSwgY29uZmlncyksCgkJCQkJYXR0cnM6IHNldEF0dHJpYnV0ZXMobm9kZSwgZGF0YS50YWcsIGRhdGEuYXR0cnMsIHt9LCBuYW1lc3BhY2UpLAoJCQkJCW5vZGVzOiBbbm9kZV0KCQkJCX0KCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gfHwgbnVsbCkKCQkJfQoJCQllbHNlIHsKCQkJCW5vZGUgPSBjYWNoZWQubm9kZXNbMF0KCQkJCXNldEF0dHJpYnV0ZXMobm9kZSwgZGF0YS50YWcsIGRhdGEuYXR0cnMsIGNhY2hlZC5hdHRycywgbmFtZXNwYWNlKQoJCQkJY2FjaGVkLmNoaWxkcmVuID0gYnVpbGQobm9kZSwgZGF0YS50YWcsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBkYXRhLmNoaWxkcmVuLCBjYWNoZWQuY2hpbGRyZW4sIGZhbHNlLCAwLCBkYXRhLmF0dHJzLmNvbnRlbnRlZGl0YWJsZSA/IG5vZGUgOiBlZGl0YWJsZSwgbmFtZXNwYWNlLCBjb25maWdzKQoJCQkJY2FjaGVkLm5vZGVzLmludGFjdCA9IHRydWUKCQkJCWlmIChzaG91bGRSZWF0dGFjaCA9PT0gdHJ1ZSAmJiBub2RlICE9IG51bGwpIHBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gfHwgbnVsbCkKCQkJfQoJCQkvL3NjaGVkdWxlIGNvbmZpZ3MgdG8gYmUgY2FsbGVkLiBUaGV5IGFyZSBjYWxsZWQgYWZ0ZXIgYGJ1aWxkYCBmaW5pc2hlcyBydW5uaW5nCgkJCWlmIChpc0ZuKGRhdGEuYXR0cnNbImNvbmZpZyJdKSkgewoJCQkJdmFyIGNvbnRleHQgPSBjYWNoZWQuY29uZmlnQ29udGV4dCA9IGNhY2hlZC5jb25maWdDb250ZXh0IHx8IHt9CgoJCQkJLy8gYmluZAoJCQkJdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24oZGF0YSwgYXJncykgewoJCQkJCXJldHVybiBmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIGRhdGEuYXR0cnNbImNvbmZpZyJdLmFwcGx5KGRhdGEsIGFyZ3MpCgkJCQkJfQoJCQkJfQoJCQkJY29uZmlncy5wdXNoKGNhbGxiYWNrKGRhdGEsIFtub2RlLCAhaXNOZXcsIGNvbnRleHQsIGNhY2hlZF0pKQoJCQl9CgkJfQoJCWVsc2UgaWYgKCFpc0ZuKGRhdGFUeXBlKSkgewoJCQkvL2hhbmRsZSB0ZXh0IG5vZGVzCgkJCXZhciBub2RlcwoJCQlpZiAoY2FjaGVkLm5vZGVzLmxlbmd0aCA9PT0gMCkgewoJCQkJaWYgKGRhdGEuJHRydXN0ZWQpIHsKCQkJCQlub2RlcyA9IGluamVjdEhUTUwocGFyZW50RWxlbWVudCwgaW5kZXgsIGRhdGEpCgkJCQl9CgkJCQllbHNlIHsKCQkJCQlub2RlcyA9IFt3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF0YSldCgkJCQkJaWYgKCFwYXJlbnRFbGVtZW50Lm5vZGVOYW1lLm1hdGNoKHZvaWRFbGVtZW50cykpIHBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGVzWzBdLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCQl9CgkJCQljYWNoZWQgPSAic3RyaW5nIG51bWJlciBib29sZWFuIi5pbmRleE9mKHR5cGVvZiBkYXRhKSA+IC0xID8gbmV3IGRhdGEuY29uc3RydWN0b3IoZGF0YSkgOiBkYXRhCgkJCQljYWNoZWQubm9kZXMgPSBub2RlcwoJCQl9CgkJCWVsc2UgaWYgKGNhY2hlZC52YWx1ZU9mKCkgIT09IGRhdGEudmFsdWVPZigpIHx8IHNob3VsZFJlYXR0YWNoID09PSB0cnVlKSB7CgkJCQlub2RlcyA9IGNhY2hlZC5ub2RlcwoJCQkJaWYgKCFlZGl0YWJsZSB8fCBlZGl0YWJsZSAhPT0gd2luZG93LmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHsKCQkJCQlpZiAoZGF0YS4kdHJ1c3RlZCkgewoJCQkJCQljbGVhcihub2RlcywgY2FjaGVkKQoJCQkJCQlub2RlcyA9IGluamVjdEhUTUwocGFyZW50RWxlbWVudCwgaW5kZXgsIGRhdGEpCgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQkvL2Nvcm5lciBjYXNlOiByZXBsYWNpbmcgdGhlIG5vZGVWYWx1ZSBvZiBhIHRleHQgbm9kZSB0aGF0IGlzIGEgY2hpbGQgb2YgYSB0ZXh0YXJlYS9jb250ZW50ZWRpdGFibGUgZG9lc24ndCB3b3JrCgkJCQkJCS8vd2UgbmVlZCB0byB1cGRhdGUgdGhlIHZhbHVlIHByb3BlcnR5IG9mIHRoZSBwYXJlbnQgdGV4dGFyZWEgb3IgdGhlIGlubmVySFRNTCBvZiB0aGUgY29udGVudGVkaXRhYmxlIGVsZW1lbnQgaW5zdGVhZAoJCQkJCQlpZiAocGFyZW50VGFnID09PSAidGV4dGFyZWEiKSBwYXJlbnRFbGVtZW50LnZhbHVlID0gZGF0YQoJCQkJCQllbHNlIGlmIChlZGl0YWJsZSkgZWRpdGFibGUuaW5uZXJIVE1MID0gZGF0YQoJCQkJCQllbHNlIHsKCQkJCQkJCWlmIChub2Rlc1swXS5ub2RlVHlwZSA9PSAxIHx8IG5vZGVzLmxlbmd0aCA+IDEpIHsgLy93YXMgYSB0cnVzdGVkIHN0cmluZwoJCQkJCQkJCWNsZWFyKGNhY2hlZC5ub2RlcywgY2FjaGVkKQoJCQkJCQkJCW5vZGVzID0gW3dpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhKV0KCQkJCQkJCX0KCQkJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGVzWzBdLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCQkJCQlub2Rlc1swXS5ub2RlVmFsdWUgPSBkYXRhCgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQljYWNoZWQgPSBuZXcgZGF0YS5jb25zdHJ1Y3RvcihkYXRhKQoJCQkJY2FjaGVkLm5vZGVzID0gbm9kZXMKCQkJfQoJCQllbHNlIGNhY2hlZC5ub2Rlcy5pbnRhY3QgPSB0cnVlCgkJfQoKCQlyZXR1cm4gY2FjaGVkCgl9CglmdW5jdGlvbiBzZXRBdHRyaWJ1dGVzKG5vZGUsIHRhZywgZGF0YUF0dHJzLCBjYWNoZWRBdHRycywgbmFtZXNwYWNlKSB7CgkJZm9yICh2YXIgYXR0ck5hbWUgaW4gZGF0YUF0dHJzKSB7CgkJCXZhciBkYXRhQXR0ciA9IGRhdGFBdHRyc1thdHRyTmFtZV0KCQkJdmFyIGNhY2hlZEF0dHIgPSBjYWNoZWRBdHRyc1thdHRyTmFtZV0KCQkJaWYgKCEoYXR0ck5hbWUgaW4gY2FjaGVkQXR0cnMpIHx8IChjYWNoZWRBdHRyICE9PSBkYXRhQXR0cikpIHsKCQkJCWNhY2hlZEF0dHJzW2F0dHJOYW1lXSA9IGRhdGFBdHRyCgkJCQl0cnkgewoJCQkJCS8vYGNvbmZpZ2AgaXNuJ3QgYSByZWFsIGF0dHJpYnV0ZXMsIHNvIGlnbm9yZSBpdAoJCQkJCS8vd2UgZG9uJ3QgaWdub3JlIGBrZXlgIGJlY2F1c2UgaXQgbXVzdCBiZSB1bmlxdWUgYW5kIGhhdmluZyBpdCBvbiB0aGUgRE9NIGhlbHBzIGRlYnVnZ2luZwoJCQkJCWlmIChhdHRyTmFtZSA9PT0gImNvbmZpZyIpIGNvbnRpbnVlCgkJCQkJLy9ob29rIGV2ZW50IGhhbmRsZXJzIHRvIHRoZSBhdXRvLXJlZHJhd2luZyBzeXN0ZW0KCQkJCQllbHNlIGlmIChpc0ZuKGRhdGFBdHRyKSAmJiBhdHRyTmFtZS5pbmRleE9mKCJvbiIpID09IDApIHsKCQkJCQkJbm9kZVthdHRyTmFtZV0gPSBhdXRvcmVkcmF3KGRhdGFBdHRyLCBub2RlKQoJCQkJCX0KCQkJCQkvL2hhbmRsZSBgc3R5bGU6IHsuLi59YAoJCQkJCWVsc2UgaWYgKGF0dHJOYW1lID09PSAic3R5bGUiICYmIGlzT2JqKGRhdGFBdHRyKSkgewoJCQkJCQlmb3IgKHZhciBydWxlIGluIGRhdGFBdHRyKSB7CgkJCQkJCQlpZiAoY2FjaGVkQXR0ciA9PSBudWxsIHx8IGNhY2hlZEF0dHJbcnVsZV0gIT09IGRhdGFBdHRyW3J1bGVdKSBub2RlLnN0eWxlW3J1bGVdID0gZGF0YUF0dHJbcnVsZV0KCQkJCQkJfQoJCQkJCQlmb3IgKHZhciBydWxlIGluIGNhY2hlZEF0dHIpIHsKCQkJCQkJCWlmICghKHJ1bGUgaW4gZGF0YUF0dHIpKSBub2RlLnN0eWxlW3J1bGVdID0gIiIKCQkJCQkJfQoJCQkJCX0KCQkJCQkvL2hhbmRsZSBTVkcKCQkJCQllbHNlIGlmIChuYW1lc3BhY2UgIT0gbnVsbCkgewoJCQkJCQlpZiAoYXR0ck5hbWUgPT09ICJocmVmIikgbm9kZS5zZXRBdHRyaWJ1dGVOUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsICJocmVmIiwgZGF0YUF0dHIpCgkJCQkJCWVsc2UgaWYgKGF0dHJOYW1lID09PSAiY2xhc3NOYW1lIikgbm9kZS5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgZGF0YUF0dHIpCgkJCQkJCWVsc2Ugbm9kZS5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIGRhdGFBdHRyKQoJCQkJCX0KCQkJCQkvL2hhbmRsZSBjYXNlcyB0aGF0IGFyZSBwcm9wZXJ0aWVzIChidXQgaWdub3JlIGNhc2VzIHdoZXJlIHdlIHNob3VsZCB1c2Ugc2V0QXR0cmlidXRlIGluc3RlYWQpCgkJCQkJLy8tIGxpc3QgYW5kIGZvcm0gYXJlIHR5cGljYWxseSB1c2VkIGFzIHN0cmluZ3MsIGJ1dCBhcmUgRE9NIGVsZW1lbnQgcmVmZXJlbmNlcyBpbiBqcwoJCQkJCS8vLSB3aGVuIHVzaW5nIENTUyBzZWxlY3RvcnMgKGUuZy4gYG0oIltzdHlsZT0nJ10iKWApLCBzdHlsZSBpcyB1c2VkIGFzIGEgc3RyaW5nLCBidXQgaXQncyBhbiBvYmplY3QgaW4ganMKCQkJCQllbHNlIGlmIChhdHRyTmFtZSBpbiBub2RlICYmICEoYXR0ck5hbWUgPT0gImxpc3QiIHx8IGF0dHJOYW1lID09ICJzdHlsZSIgfHwgYXR0ck5hbWUgPT0gImZvcm0iKSkgewoJCQkJCQkvL0ZJWE1FOiBkb24ndCBjbG9iYmVyIHZhbHVlIGlmIHN0aWxsIHR5cGluZyAoc2VlICMxNTEgYW5kICMyMTQpCgkJCQkJCS8vaXQgYXBwZWFycyBicm93c2VycyB3b3JrIGxpa2UgdGhpczoKCQkJCQkJLy8tIHVzZXIgdHlwZXMsIHVwZGF0ZXMgVUkgaW1tZWRpYXRlbHkKCQkJCQkJLy8tIGV2ZW50IGhhbmRsZXIsIGhvd2V2ZXIsIGRvZXMgTk9UIGZpcmUgaW1tZWRpYXRlbHkgaWYgdGhlcmUncyBqYXZhc2NyaXB0IHJ1bm5pbmcgKGJlY2F1c2UganMgaXMgc2luZ2xlIHRocmVhZGVkKQoJCQkJCQkvLy0gb25jZSBqcyBmaW5pc2hlcywgdGhlbiBpdCBydW5zIHJBRiBjYWxsYmFjaywgd2hpY2ggY2xvYmJlcnMgdGhlIGlucHV0IGlmIHdlJ3JlIHVzaW5nIG5haXZlIGJpZGlyZWN0aW9uYWwgYmluZGluZ3MKCQkJCQkJLy8tIFRIRU4gaXQgZmlyZXMgdGhlIGV2ZW50IGhhbmRsZXIgd2l0aCB0aGUgbmV3IGlucHV0IHZhbHVlCgkJCQkJCS8vc28gaWYgdGhlIGlucHV0IHZhbHVlIGlzIHVwZGF0ZWQgZHVyaW5nIHRoZSBzbWFsbCB3aW5kb3cgYmV0d2VlbiByZWdpc3RlcmluZyBhIFVJIGNoYW5nZSBuYXRpdmVseSBhbmQgdGhlIGVuZCBvZiBub24taWRsZSBqcyB0aW1lLCB0aGUgaW5wdXQgbG9zZXMgdGhlIHZhbHVlIHVwZGF0ZSBmcm9tIHRoYXQgZXZlbnQKCQkJCQkJaWYgKCEobm9kZSA9PT0gd2luZG93LmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgYXR0ck5hbWUgPT0gInZhbHVlIikpIG5vZGVbYXR0ck5hbWVdID0gZGF0YUF0dHIKCQkJCQl9CgkJCQkJZWxzZSBub2RlLnNldEF0dHJpYnV0ZShhdHRyTmFtZSwgZGF0YUF0dHIpCgkJCQl9CgkJCQljYXRjaCAoZSkgewoJCQkJCS8vc3dhbGxvdyBJRSdzIGludmFsaWQgYXJndW1lbnQgZXJyb3JzIHRvIG1pbWljIEhUTUwncyBmYWxsYmFjay10by1kb2luZy1ub3RoaW5nLW9uLWludmFsaWQtYXR0cmlidXRlcyBiZWhhdmlvcgoJCQkJCWlmIChlLm1lc3NhZ2UuaW5kZXhPZigiSW52YWxpZCBhcmd1bWVudCIpIDwgMCkgdGhyb3cgZQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBjYWNoZWRBdHRycwoJfQoJZnVuY3Rpb24gY2xlYXIobm9kZXMsIGNhY2hlZCkgewoJCWZvciAodmFyIGkgPSBub2Rlcy5sZW5ndGggLSAxOyBpID4gLTE7IGktLSkgewoJCQlpZiAobm9kZXNbaV0gJiYgbm9kZXNbaV0ucGFyZW50Tm9kZSkgewoJCQkJbm9kZXNbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2Rlc1tpXSkKCQkJCWNhY2hlZCA9IFtdLmNvbmNhdChjYWNoZWQpCgkJCQlpZiAoY2FjaGVkW2ldKSB1bmxvYWQoY2FjaGVkW2ldKQoJCQl9CgkJfQoJCWlmIChub2Rlcy5sZW5ndGggIT0gMCkgbm9kZXMubGVuZ3RoID0gMAoJfQoJZnVuY3Rpb24gdW5sb2FkKGNhY2hlZCkgewoJCWlmIChjYWNoZWQuY29uZmlnQ29udGV4dCAmJiBpc0ZuKGNhY2hlZC5jb25maWdDb250ZXh0Lm9udW5sb2FkKSkgY2FjaGVkLmNvbmZpZ0NvbnRleHQub251bmxvYWQoKQoJCWlmIChjYWNoZWQuY2hpbGRyZW4pIHsKCQkJaWYgKGlzQXJyKGNhY2hlZC5jaGlsZHJlbikpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgY2FjaGVkLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB1bmxvYWQoY2FjaGVkLmNoaWxkcmVuW2ldKQoJCQl9CgkJCWVsc2UgaWYgKGNhY2hlZC5jaGlsZHJlbi50YWcpIHVubG9hZChjYWNoZWQuY2hpbGRyZW4pCgkJfQoJfQoJZnVuY3Rpb24gaW5qZWN0SFRNTChwYXJlbnRFbGVtZW50LCBpbmRleCwgZGF0YSkgewoJCXZhciBuZXh0U2libGluZyA9IHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0KCQlpZiAobmV4dFNpYmxpbmcpIHsKCQkJdmFyIGlzRWxlbWVudCA9IG5leHRTaWJsaW5nLm5vZGVUeXBlICE9IDEKCQkJdmFyIHBsYWNlaG9sZGVyID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKQoJCQlpZiAoaXNFbGVtZW50KSB7CgkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShwbGFjZWhvbGRlciwgbmV4dFNpYmxpbmcpCgkJCQlwbGFjZWhvbGRlci5pbnNlcnRBZGphY2VudEhUTUwoImJlZm9yZWJlZ2luIiwgZGF0YSkKCQkJCXBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQocGxhY2Vob2xkZXIpCgkJCX0KCQkJZWxzZSBuZXh0U2libGluZy5pbnNlcnRBZGphY2VudEhUTUwoImJlZm9yZWJlZ2luIiwgZGF0YSkKCQl9CgkJZWxzZSBwYXJlbnRFbGVtZW50Lmluc2VydEFkamFjZW50SFRNTCgiYmVmb3JlZW5kIiwgZGF0YSkKCQl2YXIgbm9kZXMgPSBbXQoJCXdoaWxlIChwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdICE9PSBuZXh0U2libGluZykgewoJCQlub2Rlcy5wdXNoKHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0pCgkJCWluZGV4KysKCQl9CgkJcmV0dXJuIG5vZGVzCgl9CglmdW5jdGlvbiBmbGF0dGVuKGRhdGEpIHsKCQl2YXIgZmxhdHRlbmVkID0gW10KCQlmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGl0ZW0gPSBkYXRhW2ldCgkJCWlmIChpc0FycihpdGVtKSkgZmxhdHRlbmVkLnB1c2guYXBwbHkoZmxhdHRlbmVkLCBmbGF0dGVuKGl0ZW0pKQoJCQllbHNlIGZsYXR0ZW5lZC5wdXNoKGl0ZW0pCgkJfQoJCXJldHVybiBmbGF0dGVuZWQKCX0KCWZ1bmN0aW9uIGF1dG9yZWRyYXcoY2FsbGJhY2ssIG9iamVjdCkgewoJCXJldHVybiBmdW5jdGlvbihlKSB7CgkJCWUgPSBlIHx8IGV2ZW50CgkJCW0ucmVkcmF3LnN0cmF0ZWd5KCJkaWZmIikKCQkJbS5zdGFydENvbXB1dGF0aW9uKCkKCQkJdHJ5IHtyZXR1cm4gY2FsbGJhY2suY2FsbChvYmplY3QsIGUpfQoJCQlmaW5hbGx5IHsKCQkJCS8vRklYTUU6IGZvcmNlIGFzeW5jaHJvbm91cyByZWRyYXcgZm9yIGV2ZW50IGhhbmRsZXJzLCB0byBwcmV2ZW50IGRvdWJsZSByZWRyYXcgaW4gY2FzZXMgbGlrZSBvbmtleXByZXNzK29uaW5wdXQgKCMxNTEpCgkJCQkvL3RoaXMgc29sdXRpb24gaXNuJ3QgaWRlYWwgYmVjYXVzZSBpdCBjcmVhdGVzIGEgc21hbGwgd2luZG93IG9mIG9wcG9ydHVuaXR5IGZvciBldmVudHMgdG8gZ2V0IGxvc3QgKHNlZSAjMjE0KS4KCQkJCWlmICghbGFzdFJlZHJhd0lkKSBsYXN0UmVkcmF3SWQgPSAtMQoJCQkJbS5lbmRDb21wdXRhdGlvbigpCgkJCX0KCQl9Cgl9CgoJdmFyIGh0bWwKCXZhciBkb2N1bWVudE5vZGUgPSB7CgkJYXBwZW5kQ2hpbGQ6IGZ1bmN0aW9uKG5vZGUpIHsKCQkJaWYgKGh0bWwgPT09IHVuZGVmaW5lZCkgaHRtbCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJodG1sIikKCQkJaWYgKHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAhPT0gbm9kZSkgewoJCQkJd2luZG93LmRvY3VtZW50LnJlcGxhY2VDaGlsZChub2RlLCB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KQoJCQl9CgkJCWVsc2Ugd2luZG93LmRvY3VtZW50LmFwcGVuZENoaWxkKG5vZGUpCgkJCXRoaXMuY2hpbGROb2RlcyA9IHdpbmRvdy5kb2N1bWVudC5jaGlsZE5vZGVzCgkJfSwKCQlpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uKG5vZGUpIHsKCQkJdGhpcy5hcHBlbmRDaGlsZChub2RlKQoJCX0sCgkJY2hpbGROb2RlczogW10KCX0KCXZhciBub2RlQ2FjaGUgPSBbXSwgY2VsbENhY2hlID0ge30KCW0ucmVuZGVyID0gZnVuY3Rpb24ocm9vdCwgY2VsbCwgZm9yY2VSZWNyZWF0aW9uKSB7CgkJdmFyIGNvbmZpZ3MgPSBbXQoJCWlmICghcm9vdCkgdGhyb3cgbmV3IEVycm9yKCJQbGVhc2UgZW5zdXJlIHRoZSBET00gZWxlbWVudCBleGlzdHMgYmVmb3JlIHJlbmRlcmluZyBhIHRlbXBsYXRlIGludG8gaXQuIikKCQl2YXIgaWQgPSBnZXRDZWxsQ2FjaGVLZXkocm9vdCkKCQl2YXIgaXNEb2N1bWVudFJvb3QgPSByb290ID09IHdpbmRvdy5kb2N1bWVudAoJCXZhciBub2RlID0gaXNEb2N1bWVudFJvb3QgfHwgcm9vdCA9PSB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ID8gZG9jdW1lbnROb2RlIDogcm9vdAoJCWlmIChpc0RvY3VtZW50Um9vdCAmJiBjZWxsLnRhZyAhPSAiaHRtbCIpIGNlbGwgPSB7dGFnOiAiaHRtbCIsIGF0dHJzOiB7fSwgY2hpbGRyZW46IGNlbGx9CgkJaWYgKGNlbGxDYWNoZVtpZF0gPT09IHVuZGVmaW5lZCkgY2xlYXIobm9kZS5jaGlsZE5vZGVzKQoJCWlmIChmb3JjZVJlY3JlYXRpb24gPT09IHRydWUpIHJlc2V0KHJvb3QpCgkJY2VsbENhY2hlW2lkXSA9IGJ1aWxkKG5vZGUsIG51bGwsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjZWxsLCBjZWxsQ2FjaGVbaWRdLCBmYWxzZSwgMCwgbnVsbCwgdW5kZWZpbmVkLCBjb25maWdzKQoJCWZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlncy5sZW5ndGg7IGkrKykgY29uZmlnc1tpXSgpCgl9CglmdW5jdGlvbiBnZXRDZWxsQ2FjaGVLZXkoZWxlbWVudCkgewoJCXZhciBpbmRleCA9IG5vZGVDYWNoZS5pbmRleE9mKGVsZW1lbnQpCgkJcmV0dXJuIGluZGV4IDwgMCA/IG5vZGVDYWNoZS5wdXNoKGVsZW1lbnQpIC0gMSA6IGluZGV4Cgl9CgoJbS50cnVzdCA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJdmFsdWUgPSBuZXcgU3RyaW5nKHZhbHVlKQoJCXZhbHVlLiR0cnVzdGVkID0gdHJ1ZQoJCXJldHVybiB2YWx1ZQoJfQoKCWZ1bmN0aW9uIGdldHRlcnNldHRlcihzdG9yZSkgewoJCXZhciBwcm9wID0gZnVuY3Rpb24oKSB7CgkJCWlmIChhcmd1bWVudHMubGVuZ3RoKSBzdG9yZSA9IGFyZ3VtZW50c1swXQoJCQlyZXR1cm4gc3RvcmUKCQl9CgoJCXByb3AudG9KU09OID0gZnVuY3Rpb24oKSB7CgkJCXJldHVybiBzdG9yZQoJCX0KCgkJcmV0dXJuIHByb3AKCX0KCgltLnByb3AgPSBmdW5jdGlvbiAoc3RvcmUpIHsKCQlpZiAoKGlzT2JqKHN0b3JlKSB8fCBpc0ZuKHN0b3JlKSkgJiYgc3RvcmUgIT09IG51bGwgJiYgaXNGbihzdG9yZS50aGVuKSkgewoJCQlyZXR1cm4gcHJvcGlmeShzdG9yZSkKCQl9CgoJCXJldHVybiBnZXR0ZXJzZXR0ZXIoc3RvcmUpCgl9CgoJdmFyIHJvb3RzID0gW10sIG1vZHVsZXMgPSBbXSwgY29udHJvbGxlcnMgPSBbXSwgbGFzdFJlZHJhd0lkID0gbnVsbCwgbGFzdFJlZHJhd0NhbGxUaW1lID0gMCwgY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gbnVsbCwgcHJldmVudGVkID0gZmFsc2UKCXZhciBGUkFNRV9CVURHRVQgPSAxNiAvLzYwIGZyYW1lcyBwZXIgc2Vjb25kID0gMSBjYWxsIHBlciAxNiBtcwoJbS5tb2R1bGUgPSBmdW5jdGlvbihyb290LCBtb2R1bGUpIHsKCQl2YXIgaW5kZXggPSByb290cy5pbmRleE9mKHJvb3QpCgkJaWYgKGluZGV4IDwgMCkgaW5kZXggPSByb290cy5sZW5ndGgKCQl2YXIgaXNQcmV2ZW50ZWQgPSBmYWxzZQoJCWlmIChjb250cm9sbGVyc1tpbmRleF0gJiYgaXNGbihjb250cm9sbGVyc1tpbmRleF0ub251bmxvYWQpKSB7CgkJCXZhciBldmVudCA9IHsKCQkJCXByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHtpc1ByZXZlbnRlZCA9IHRydWV9CgkJCX0KCQkJY29udHJvbGxlcnNbaW5kZXhdLm9udW5sb2FkKGV2ZW50KQoJCX0KCQlpZiAoIWlzUHJldmVudGVkKSB7CgkJCW0ucmVkcmF3LnN0cmF0ZWd5KCJhbGwiKQoJCQltLnN0YXJ0Q29tcHV0YXRpb24oKQoJCQlyb290c1tpbmRleF0gPSByb290CgkJCW1vZHVsZXNbaW5kZXhdID0gbW9kdWxlCgkJCWNvbnRyb2xsZXJzW2luZGV4XSA9IG5ldyBtb2R1bGUuY29udHJvbGxlcgoJCQltLmVuZENvbXB1dGF0aW9uKCkKCQkJcmV0dXJuIGNvbnRyb2xsZXJzW2luZGV4XQoJCX0KCX0KCW0ucmVkcmF3ID0gZnVuY3Rpb24oZm9yY2UpIHsKCQl2YXIgY2FuY2VsID0gd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5jbGVhclRpbWVvdXQKCQl2YXIgZGVmZXIgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5zZXRUaW1lb3V0CgkJLy9sYXN0UmVkcmF3SWQgaXMgYSBwb3NpdGl2ZSBudW1iZXIgaWYgYSBzZWNvbmQgcmVkcmF3IGlzIHJlcXVlc3RlZCBiZWZvcmUgdGhlIG5leHQgYW5pbWF0aW9uIGZyYW1lCgkJLy9sYXN0UmVkcmF3SWQgaXMgLTEgaWYgdGhlIHJlZHJhdyBpcyB0aGUgZmlyc3Qgb25lIGluIGEgZXZlbnQgaGFuZGxlciAoc2VlICMxNTEpCgkJLy9sYXN0UmVkcmF3SUQgaXMgbnVsbCBpZiBpdCdzIHRoZSBmaXJzdCByZWRyYXcgYW5kIG5vdCBhbiBldmVudCBoYW5kbGVyCgkJaWYgKGxhc3RSZWRyYXdJZCAmJiBmb3JjZSAhPT0gdHJ1ZSkgewoJCQkvL3doZW4gc2V0VGltZW91dDogb25seSByZXNjaGVkdWxlIHJlZHJhdyBpZiB0aW1lIGJldHdlZW4gbm93IGFuZCBwcmV2aW91cyByZWRyYXcgaXMgYmlnZ2VyIHRoYW4gYSBmcmFtZSwgb3RoZXJ3aXNlIGtlZXAgY3VycmVudGx5IHNjaGVkdWxlZCB0aW1lb3V0CgkJCS8vd2hlbiByQUY6IGFsd2F5cyByZXNjaGVkdWxlIHJlZHJhdwoJCQlpZiAobmV3IERhdGUgLSBsYXN0UmVkcmF3Q2FsbFRpbWUgPiBGUkFNRV9CVURHRVQgfHwgZGVmZXIgPT0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSkgewoJCQkJaWYgKGxhc3RSZWRyYXdJZCA+IDApIGNhbmNlbChsYXN0UmVkcmF3SWQpCgkJCQlsYXN0UmVkcmF3SWQgPSBkZWZlcihyZWRyYXcsIEZSQU1FX0JVREdFVCkKCQkJfQoJCX0KCQllbHNlIHsKCQkJcmVkcmF3KCkKCQkJbGFzdFJlZHJhd0lkID0gZGVmZXIoZnVuY3Rpb24oKSB7bGFzdFJlZHJhd0lkID0gbnVsbH0sIEZSQU1FX0JVREdFVCkKCQl9Cgl9CgltLnJlZHJhdy5zdHJhdGVneSA9IG0ucHJvcCgpCglmdW5jdGlvbiByZWRyYXcoKSB7CgkJdmFyIG1vZGUgPSBtLnJlZHJhdy5zdHJhdGVneSgpCgkJZm9yICh2YXIgaSA9IDA7IGkgPCByb290cy5sZW5ndGg7IGkrKykgewoJCQlpZiAoY29udHJvbGxlcnNbaV0gJiYgbW9kZSAhPSAibm9uZSIpIG0ucmVuZGVyKHJvb3RzW2ldLCBtb2R1bGVzW2ldLnZpZXcoY29udHJvbGxlcnNbaV0pLCBtb2RlID09ICJhbGwiKQoJCX0KCQkvL2FmdGVyIHJlbmRlcmluZyB3aXRoaW4gYSByb3V0ZWQgY29udGV4dCwgd2UgbmVlZCB0byBzY3JvbGwgYmFjayB0byB0aGUgdG9wLCBhbmQgZmV0Y2ggdGhlIGRvY3VtZW50IHRpdGxlIGZvciBoaXN0b3J5LnB1c2hTdGF0ZQoJCWlmIChjb21wdXRlUG9zdFJlZHJhd0hvb2spIHsKCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rKCkKCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gbnVsbAoJCX0KCQlsYXN0UmVkcmF3SWQgPSBudWxsCgkJbGFzdFJlZHJhd0NhbGxUaW1lID0gbmV3IERhdGUKCQltLnJlZHJhdy5zdHJhdGVneSgiZGlmZiIpCgl9CgoJdmFyIHBlbmRpbmdSZXF1ZXN0cyA9IDAKCW0uc3RhcnRDb21wdXRhdGlvbiA9IGZ1bmN0aW9uKCkge3BlbmRpbmdSZXF1ZXN0cysrfQoJbS5lbmRDb21wdXRhdGlvbiA9IGZ1bmN0aW9uKCkgewoJCXBlbmRpbmdSZXF1ZXN0cyA9IE1hdGgubWF4KHBlbmRpbmdSZXF1ZXN0cyAtIDEsIDApCgkJaWYgKHBlbmRpbmdSZXF1ZXN0cyA9PSAwKSBtLnJlZHJhdygpCgl9CgoJbS53aXRoQXR0ciA9IGZ1bmN0aW9uKHByb3AsIHdpdGhBdHRyQ2FsbGJhY2spIHsKCQlyZXR1cm4gZnVuY3Rpb24oZSkgewoJCQllID0gZSB8fCBldmVudAoJCQl2YXIgY3VycmVudFRhcmdldCA9IGUuY3VycmVudFRhcmdldCB8fCB0aGlzCgkJCXdpdGhBdHRyQ2FsbGJhY2socHJvcCBpbiBjdXJyZW50VGFyZ2V0ID8gY3VycmVudFRhcmdldFtwcm9wXSA6IGN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKHByb3ApKQoJCX0KCX0KCgkvL3JvdXRpbmcKCXZhciBtb2RlcyA9IHtwYXRobmFtZTogIiIsIGhhc2g6ICIjIiwgc2VhcmNoOiAiPyJ9Cgl2YXIgcmVkaXJlY3QgPSBmdW5jdGlvbigpIHt9LCByb3V0ZVBhcmFtcyA9IHt9LCBjdXJyZW50Um91dGUKCW0ucm91dGUgPSBmdW5jdGlvbigpIHsKCQlpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGN1cnJlbnRSb3V0ZQoJCWVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDMgJiYgaXNTdHIoYXJndW1lbnRzWzFdKSkgewoJCQl2YXIgcm9vdCA9IGFyZ3VtZW50c1swXSwgZGVmYXVsdFJvdXRlID0gYXJndW1lbnRzWzFdLCByb3V0ZXIgPSBhcmd1bWVudHNbMl0KCQkJcmVkaXJlY3QgPSBmdW5jdGlvbihzb3VyY2UpIHsKCQkJCXZhciBwYXRoID0gY3VycmVudFJvdXRlID0gbm9ybWFsaXplUm91dGUoc291cmNlKQoJCQkJaWYgKCFyb3V0ZUJ5VmFsdWUocm9vdCwgcm91dGVyLCBwYXRoKSkgewoJCQkJCW0ucm91dGUoZGVmYXVsdFJvdXRlLCB0cnVlKQoJCQkJfQoJCQl9CgkJCXZhciBsaXN0ZW5lciA9IG0ucm91dGUubW9kZSA9PSAiaGFzaCIgPyAib25oYXNoY2hhbmdlIiA6ICJvbnBvcHN0YXRlIgoJCQl3aW5kb3dbbGlzdGVuZXJdID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoY3VycmVudFJvdXRlICE9IG5vcm1hbGl6ZVJvdXRlKHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdKSkgewoJCQkJCXJlZGlyZWN0KHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdKQoJCQkJfQoJCQl9CgkJCWNvbXB1dGVQb3N0UmVkcmF3SG9vayA9IHNldFNjcm9sbAoJCQl3aW5kb3dbbGlzdGVuZXJdKCkKCQl9CgkJZWxzZSBpZiAoYXJndW1lbnRzWzBdLmFkZEV2ZW50TGlzdGVuZXIpIHsKCQkJdmFyIGVsZW1lbnQgPSBhcmd1bWVudHNbMF0KCQkJdmFyIGlzSW5pdGlhbGl6ZWQgPSBhcmd1bWVudHNbMV0KCQkJdmFyIGNvbnRleHQgPSBhcmd1bWVudHNbMl0KCQkJaWYgKCFpc0luaXRpYWxpemVkKSB7CgkJCQljb250ZXh0LmhyZWYgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiaHJlZiIpCgkJCQllbGVtZW50LmhyZWYgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgKyBtb2Rlc1ttLnJvdXRlLm1vZGVdICsgY29udGV4dC5ocmVmCgkJCQllbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgcm91dGVVbm9idHJ1c2l2ZSkKCQkJCWVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCByb3V0ZVVub2J0cnVzaXZlKQoJCQl9CgkJfQoJCWVsc2UgaWYgKGlzU3RyKGFyZ3VtZW50c1swXSkpIHsKCQkJY3VycmVudFJvdXRlID0gYXJndW1lbnRzWzBdCgkJCXZhciBxdWVyeXN0cmluZyA9IGlzT2JqKGFyZ3VtZW50c1sxXSkgPyBidWlsZFF1ZXJ5U3RyaW5nKGFyZ3VtZW50c1sxXSkgOiBudWxsCgkJCWlmIChxdWVyeXN0cmluZykgY3VycmVudFJvdXRlICs9IChjdXJyZW50Um91dGUuaW5kZXhPZigiPyIpID09PSAtMSA/ICI/IiA6ICImIikgKyBxdWVyeXN0cmluZwoKCQkJdmFyIHNob3VsZFJlcGxhY2VIaXN0b3J5RW50cnkgPSAoYXJndW1lbnRzLmxlbmd0aCA9PSAzID8gYXJndW1lbnRzWzJdIDogYXJndW1lbnRzWzFdKSA9PT0gdHJ1ZQoKCQkJaWYgKHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSkgewoJCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gZnVuY3Rpb24oKSB7CgkJCQkJd2luZG93Lmhpc3Rvcnlbc2hvdWxkUmVwbGFjZUhpc3RvcnlFbnRyeSA/ICJyZXBsYWNlU3RhdGUiIDogInB1c2hTdGF0ZSJdKG51bGwsIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgbW9kZXNbbS5yb3V0ZS5tb2RlXSArIGN1cnJlbnRSb3V0ZSkKCQkJCQlzZXRTY3JvbGwoKQoJCQkJfQoJCQkJcmVkaXJlY3QobW9kZXNbbS5yb3V0ZS5tb2RlXSArIGN1cnJlbnRSb3V0ZSkKCQkJfQoJCQllbHNlIHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdID0gY3VycmVudFJvdXRlCgkJfQoJfQoJbS5yb3V0ZS5wYXJhbSA9IGZ1bmN0aW9uKGtleSkge3JldHVybiByb3V0ZVBhcmFtc1trZXldfQoJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCWZ1bmN0aW9uIG5vcm1hbGl6ZVJvdXRlKHJvdXRlKSB7cmV0dXJuIHJvdXRlLnNsaWNlKG1vZGVzW20ucm91dGUubW9kZV0ubGVuZ3RoKX0KCWZ1bmN0aW9uIHJvdXRlQnlWYWx1ZShyb290LCByb3V0ZXIsIHBhdGgpIHsKCQlyb3V0ZVBhcmFtcyA9IHt9CgoJCXZhciBxdWVyeVN0YXJ0ID0gcGF0aC5pbmRleE9mKCI/IikKCQlpZiAocXVlcnlTdGFydCAhPT0gLTEpIHsKCQkJcm91dGVQYXJhbXMgPSBwYXJzZVF1ZXJ5U3RyaW5nKHBhdGguc3Vic3RyKHF1ZXJ5U3RhcnQgKyAxLCBwYXRoLmxlbmd0aCkpCgkJCXBhdGggPSBwYXRoLnN1YnN0cigwLCBxdWVyeVN0YXJ0KQoJCX0KCgkJZm9yICh2YXIgcm91dGUgaW4gcm91dGVyKSB7CgkJCWlmIChyb3V0ZSA9PSBwYXRoKSB7CgkJCQltLm1vZHVsZShyb290LCByb3V0ZXJbcm91dGVdKQoJCQkJcmV0dXJuIHRydWUKCQkJfQoKCQkJdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKCJeIiArIHJvdXRlLnJlcGxhY2UoLzpbXlwvXSs/XC57M30vZywgIiguKj8pIikucmVwbGFjZSgvOlteXC9dKy9nLCAiKFteXFwvXSspIikgKyAiXC8/JCIpCgoJCQlpZiAobWF0Y2hlci50ZXN0KHBhdGgpKSB7CgkJCQlwYXRoLnJlcGxhY2UobWF0Y2hlciwgZnVuY3Rpb24oKSB7CgkJCQkJdmFyIGtleXMgPSByb3V0ZS5tYXRjaCgvOlteXC9dKy9nKSB8fCBbXQoJCQkJCXZhciB2YWx1ZXMgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSwgLTIpCgkJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSByb3V0ZVBhcmFtc1trZXlzW2ldLnJlcGxhY2UoLzp8XC4vZywgIiIpXSA9IGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZXNbaV0pCgkJCQkJbS5tb2R1bGUocm9vdCwgcm91dGVyW3JvdXRlXSkKCQkJCX0pCgkJCQlyZXR1cm4gdHJ1ZQoJCQl9CgkJfQoJfQoJZnVuY3Rpb24gcm91dGVVbm9idHJ1c2l2ZShlKSB7CgkJZSA9IGUgfHwgZXZlbnQKCQlpZiAoZS5jdHJsS2V5IHx8IGUubWV0YUtleSB8fCBlLndoaWNoID09IDIpIHJldHVybgoJCWlmIChlLnByZXZlbnREZWZhdWx0KSBlLnByZXZlbnREZWZhdWx0KCkKCQllbHNlIGUucmV0dXJuVmFsdWUgPSBmYWxzZQoJCXZhciBjdXJyZW50VGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0IHx8IHRoaXMKCQltLnJvdXRlKGN1cnJlbnRUYXJnZXRbbS5yb3V0ZS5tb2RlXS5zbGljZShtb2Rlc1ttLnJvdXRlLm1vZGVdLmxlbmd0aCkpCgl9CglmdW5jdGlvbiBzZXRTY3JvbGwoKSB7CgkJaWYgKG0ucm91dGUubW9kZSAhPSAiaGFzaCIgJiYgd2luZG93LmxvY2F0aW9uLmhhc2gpIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2gKCQllbHNlIHdpbmRvdy5zY3JvbGxUbygwLCAwKQoJfQoJZnVuY3Rpb24gYnVpbGRRdWVyeVN0cmluZyhvYmplY3QsIHByZWZpeCkgewoJCXZhciBzdHIgPSBbXQoJCWZvcih2YXIgcHJvcCBpbiBvYmplY3QpIHsKCQkJdmFyIGtleSA9IHByZWZpeCA/IHByZWZpeCArICJbIiArIHByb3AgKyAiXSIgOiBwcm9wLCB2YWx1ZSA9IG9iamVjdFtwcm9wXQoJCQlzdHIucHVzaChpc09iaih2YWx1ZSkgPyBidWlsZFF1ZXJ5U3RyaW5nKHZhbHVlLCBrZXkpIDogZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKQoJCX0KCQlyZXR1cm4gc3RyLmpvaW4oIiYiKQoJfQoJZnVuY3Rpb24gcGFyc2VRdWVyeVN0cmluZyhzdHIpIHsKCQl2YXIgcGFpcnMgPSBzdHIuc3BsaXQoIiYiKSwgcGFyYW1zID0ge30KCQlmb3IgKHZhciBpID0gMDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBwYWlyID0gcGFpcnNbaV0uc3BsaXQoIj0iKQoJCQlwYXJhbXNbZGVjb2RlU3BhY2UocGFpclswXSldID0gcGFpclsxXSA/IGRlY29kZVNwYWNlKHBhaXJbMV0pIDogKHBhaXIubGVuZ3RoID09PSAxID8gdHJ1ZSA6ICIiKQoJCX0KCQlyZXR1cm4gcGFyYW1zCgl9CglmdW5jdGlvbiBkZWNvZGVTcGFjZShzdHJpbmcpIHsKCQlyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHN0cmluZy5yZXBsYWNlKC9cKy9nLCAiICIpKQoJfQoJZnVuY3Rpb24gcmVzZXQocm9vdCkgewoJCXZhciBjYWNoZUtleSA9IGdldENlbGxDYWNoZUtleShyb290KQoJCWNsZWFyKHJvb3QuY2hpbGROb2RlcywgY2VsbENhY2hlW2NhY2hlS2V5XSkKCQljZWxsQ2FjaGVbY2FjaGVLZXldID0gdW5kZWZpbmVkCgl9CgoJbS5kZWZlcnJlZCA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UgPSBwcm9waWZ5KGRlZmVycmVkLnByb21pc2UpCgkJcmV0dXJuIGRlZmVycmVkCgl9CglmdW5jdGlvbiBwcm9waWZ5KHByb21pc2UpIHsKCQlwcm9wID0gbS5wcm9wKCkKCQlwcm9taXNlLnRoZW4ocHJvcCkKCQlwcm9wLnRoZW4gPSBmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKCQkJcmV0dXJuIHByb3BpZnkocHJvbWlzZS50aGVuKHJlc29sdmUsIHJlamVjdCkpCgkJfQoJCXJldHVybiBwcm9wCgl9CgkvL1Byb21pei5taXRocmlsLmpzIHwgWm9sbWVpc3RlciB8IE1JVAoJLy9hIG1vZGlmaWVkIHZlcnNpb24gb2YgUHJvbWl6LmpzLCB3aGljaCBkb2VzIG5vdCBjb25mb3JtIHRvIFByb21pc2VzL0ErIGZvciB0d28gcmVhc29uczoKCS8vMSkgYHRoZW5gIGNhbGxiYWNrcyBhcmUgY2FsbGVkIHN5bmNocm9ub3VzbHkgKGJlY2F1c2Ugc2V0VGltZW91dCBpcyB0b28gc2xvdywgYW5kIHRoZSBzZXRJbW1lZGlhdGUgcG9seWZpbGwgaXMgdG9vIGJpZwoJLy8yKSB0aHJvd2luZyBzdWJjbGFzc2VzIG9mIEVycm9yIGNhdXNlIHRoZSBlcnJvciB0byBiZSBidWJibGVkIHVwIGluc3RlYWQgb2YgdHJpZ2dlcmluZyByZWplY3Rpb24gKGJlY2F1c2UgdGhlIHNwZWMgZG9lcyBub3QgYWNjb3VudCBmb3IgdGhlIGltcG9ydGFudCB1c2UgY2FzZSBvZiBkZWZhdWx0IGJyb3dzZXIgZXJyb3IgaGFuZGxpbmcsIGkuZS4gbWVzc2FnZSB3LyBsaW5lIG51bWJlcikKCWZ1bmN0aW9uIERlZmVycmVkKHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKSB7CgkJdmFyIFJFU09MVklORyA9IDEsIFJFSkVDVElORyA9IDIsIFJFU09MVkVEID0gMywgUkVKRUNURUQgPSA0CgkJdmFyIHNlbGYgPSB0aGlzLCBzdGF0ZSA9IDAsIHByb21pc2VWYWx1ZSA9IDAsIG5leHQgPSBbXQoKCQlzZWxmWyJwcm9taXNlIl0gPSB7fQoKCQlzZWxmWyJyZXNvbHZlIl0gPSBmdW5jdGlvbih2YWx1ZSkgewoJCQlpZiAoIXN0YXRlKSB7CgkJCQlwcm9taXNlVmFsdWUgPSB2YWx1ZQoJCQkJc3RhdGUgPSBSRVNPTFZJTkcKCgkJCQlmaXJlKCkKCQkJfQoJCQlyZXR1cm4gdGhpcwoJCX0KCgkJc2VsZlsicmVqZWN0Il0gPSBmdW5jdGlvbih2YWx1ZSkgewoJCQlpZiAoIXN0YXRlKSB7CgkJCQlwcm9taXNlVmFsdWUgPSB2YWx1ZQoJCQkJc3RhdGUgPSBSRUpFQ1RJTkcKCQkJCQoJCQkJZmlyZSgpCgkJCX0KCQkJcmV0dXJuIHRoaXMKCQl9CgoJCXNlbGYucHJvbWlzZVsidGhlbiJdID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2spIHsKCQkJdmFyIGRlZmVycmVkID0gbmV3IERlZmVycmVkKHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKQoJCQlpZiAoc3RhdGUgPT0gUkVTT0xWRUQpIHsKCQkJCWRlZmVycmVkLnJlc29sdmUocHJvbWlzZVZhbHVlKQoJCQl9CgkJCWVsc2UgaWYgKHN0YXRlID09IFJFSkVDVEVEKSB7CgkJCQlkZWZlcnJlZC5yZWplY3QocHJvbWlzZVZhbHVlKQoJCQl9CgkJCWVsc2UgewoJCQkJbmV4dC5wdXNoKGRlZmVycmVkKQoJCQl9CgkJCXJldHVybiBkZWZlcnJlZC5wcm9taXNlCgkJfQoJCQoJCWZ1bmN0aW9uIGZpbmlzaCh0eXBlKSB7CgkJCXN0YXRlID0gdHlwZSB8fCBSRUpFQ1RFRAoJCQluZXh0Lm1hcChmdW5jdGlvbihkZWZlcnJlZCkgewoJCQkJc3RhdGUgPT0gUkVTT0xWRUQgJiYgZGVmZXJyZWQucmVzb2x2ZShwcm9taXNlVmFsdWUpIHx8IGRlZmVycmVkLnJlamVjdChwcm9taXNlVmFsdWUpCgkJCX0pCgkJfQoKCQlmdW5jdGlvbiB0aGVubmFibGUodGhlbiwgc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2ssIG5vdFRoZW5uYWJsZUNhbGxiYWNrKSB7CgkJCWlmICgoaXNPYmoocHJvbWlzZVZhbHVlKSB8fCBpc0ZuKHByb21pc2VWYWx1ZSkpICYmIGlzRm4odGhlbikpIHsKCQkJCXRyeSB7CgkJCQkJLy8gY291bnQgcHJvdGVjdHMgYWdhaW5zdCBhYnVzZSBjYWxscyBmcm9tIHNwZWMgY2hlY2tlcgoJCQkJCXZhciBjb3VudCA9IDAKCQkJCQl0aGVuLmNhbGwocHJvbWlzZVZhbHVlLCBmdW5jdGlvbih2YWx1ZSkgewoJCQkJCQlpZiAoY291bnQrKykgcmV0dXJuCgkJCQkJCXByb21pc2VWYWx1ZSA9IHZhbHVlCgkJCQkJCXN1Y2Nlc3NDYWxsYmFjaygpCgkJCQkJfSwgZnVuY3Rpb24gKHZhbHVlKSB7CgkJCQkJCWlmIChjb3VudCsrKSByZXR1cm4KCQkJCQkJcHJvbWlzZVZhbHVlID0gdmFsdWUKCQkJCQkJZmFpbHVyZUNhbGxiYWNrKCkKCQkJCQl9KQoJCQkJfQoJCQkJY2F0Y2ggKGUpIHsKCQkJCQltLmRlZmVycmVkLm9uZXJyb3IoZSkKCQkJCQlwcm9taXNlVmFsdWUgPSBlCgkJCQkJZmFpbHVyZUNhbGxiYWNrKCkKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCW5vdFRoZW5uYWJsZUNhbGxiYWNrKCkKCQkJfQoJCX0KCgkJZnVuY3Rpb24gZmlyZSgpIHsKCQkJLy8gY2hlY2sgaWYgaXQncyBhIHRoZW5hYmxlCgkJCXZhciB0aGVuCgkJCXRyeSB7CgkJCQl0aGVuID0gcHJvbWlzZVZhbHVlICYmIHByb21pc2VWYWx1ZS50aGVuCgkJCX0KCQkJY2F0Y2ggKGUpIHsKCQkJCW0uZGVmZXJyZWQub25lcnJvcihlKQoJCQkJcHJvbWlzZVZhbHVlID0gZQoJCQkJc3RhdGUgPSBSRUpFQ1RJTkcKCQkJCXJldHVybiBmaXJlKCkKCQkJfQoJCQl0aGVubmFibGUodGhlbiwgZnVuY3Rpb24oKSB7CgkJCQlzdGF0ZSA9IFJFU09MVklORwoJCQkJZmlyZSgpCgkJCX0sIGZ1bmN0aW9uKCkgewoJCQkJc3RhdGUgPSBSRUpFQ1RJTkcKCQkJCWZpcmUoKQoJCQl9LCBmdW5jdGlvbigpIHsKCQkJCXRyeSB7CgkJCQkJaWYgKHN0YXRlID09IFJFU09MVklORyAmJiBpc0ZuKHN1Y2Nlc3NDYWxsYmFjaykpIHsKCQkJCQkJcHJvbWlzZVZhbHVlID0gc3VjY2Vzc0NhbGxiYWNrKHByb21pc2VWYWx1ZSkKCQkJCQl9CgkJCQkJZWxzZSBpZiAoc3RhdGUgPT0gUkVKRUNUSU5HICYmIGlzRm4oZmFpbHVyZUNhbGxiYWNrKSkgewoJCQkJCQlwcm9taXNlVmFsdWUgPSBmYWlsdXJlQ2FsbGJhY2socHJvbWlzZVZhbHVlKQoJCQkJCQlzdGF0ZSA9IFJFU09MVklORwoJCQkJCX0KCQkJCX0KCQkJCWNhdGNoIChlKSB7CgkJCQkJbS5kZWZlcnJlZC5vbmVycm9yKGUpCgkJCQkJcHJvbWlzZVZhbHVlID0gZQoJCQkJCXJldHVybiBmaW5pc2goKQoJCQkJfQoKCQkJCWlmIChwcm9taXNlVmFsdWUgPT0gc2VsZikgewoJCQkJCXByb21pc2VWYWx1ZSA9IFR5cGVFcnJvcigpCgkJCQkJZmluaXNoKCkKCQkJCX0KCQkJCWVsc2UgewoJCQkJCXRoZW5uYWJsZSh0aGVuLCBmdW5jdGlvbiAoKSB7CgkJCQkJCWZpbmlzaChSRVNPTFZFRCkKCQkJCQl9LCBmaW5pc2gsIGZ1bmN0aW9uICgpIHsKCQkJCQkJZmluaXNoKHN0YXRlID09IFJFU09MVklORyAmJiBSRVNPTFZFRCkKCQkJCQl9KQoJCQkJfQoJCQl9KQoJCX0KCX0KCW0uZGVmZXJyZWQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHsKCQlpZiAodHlwZShlKSA9PSAiW29iamVjdCBFcnJvcl0iICYmICFlLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkubWF0Y2goLyBFcnJvci8pKSB0aHJvdyBlCgl9CgoJbS5zeW5jID0gZnVuY3Rpb24oYXJncykgewoJCXZhciBtZXRob2QgPSAicmVzb2x2ZSIKCQlmdW5jdGlvbiBzeW5jaHJvbml6ZXIocG9zLCByZXNvbHZlZCkgewoJCQlyZXR1cm4gZnVuY3Rpb24odmFsdWUpIHsKCQkJCXJlc3VsdHNbcG9zXSA9IHZhbHVlCgkJCQlpZiAoIXJlc29sdmVkKSBtZXRob2QgPSAicmVqZWN0IgoJCQkJaWYgKC0tb3V0c3RhbmRpbmcgPT0gMCkgewoJCQkJCWRlZmVycmVkLnByb21pc2UocmVzdWx0cykKCQkJCQlkZWZlcnJlZFttZXRob2RdKHJlc3VsdHMpCgkJCQl9CgkJCQlyZXR1cm4gdmFsdWUKCQkJfQoJCX0KCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJdmFyIG91dHN0YW5kaW5nID0gYXJncy5sZW5ndGgKCQl2YXIgcmVzdWx0cyA9IG5ldyBBcnJheShvdXRzdGFuZGluZykKCQlpZiAoYXJncy5sZW5ndGggPiAwKSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewoJCQkJYXJnc1tpXS50aGVuKHN5bmNocm9uaXplcihpLCB0cnVlKSwgc3luY2hyb25pemVyKGksIGZhbHNlKSkKCQkJfQoJCX0KCQllbHNlIGRlZmVycmVkLnJlc29sdmUoKQoKCQlyZXR1cm4gZGVmZXJyZWQucHJvbWlzZQoJfQoJZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHtyZXR1cm4gdmFsdWV9CgoJZnVuY3Rpb24gYWpheChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMuZGF0YVR5cGUgJiYgb3B0aW9ucy5kYXRhVHlwZS50b0xvd2VyQ2FzZSgpID09PSAianNvbnAiKSB7CgkJCXZhciBjYWxsYmFja0tleSA9ICJtaXRocmlsX2NhbGxiYWNrXyIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArICJfIiArIChNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxZTE2KSkudG9TdHJpbmcoMzYpCgkJCXZhciBzY3JpcHQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0IikKCgkJCXdpbmRvd1tjYWxsYmFja0tleV0gPSBmdW5jdGlvbihyZXNwKXsKCQkJCWRlbGV0ZSB3aW5kb3dbY2FsbGJhY2tLZXldCgkJCQl3aW5kb3cuZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JpcHQpCgkJCQlvcHRpb25zLm9ubG9hZCh7CgkJCQkJdHlwZTogImxvYWQiLAoJCQkJCXRhcmdldDogewoJCQkJCQlyZXNwb25zZVRleHQ6IHJlc3AKCQkJCQl9CgkJCQl9KQoJCQl9CgoJCQlzY3JpcHQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHsKCQkJCWRlbGV0ZSB3aW5kb3dbY2FsbGJhY2tLZXldCgkJCQl3aW5kb3cuZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JpcHQpCgoJCQkJb3B0aW9ucy5vbmVycm9yKHsKCQkJCQl0eXBlOiAiZXJyb3IiLAoJCQkJCXRhcmdldDogewoJCQkJCQlzdGF0dXM6IDUwMCwKCQkJCQkJcmVzcG9uc2VUZXh0OiBKU09OLnN0cmluZ2lmeSh7ZXJyb3I6ICJFcnJvciBtYWtpbmcganNvbnAgcmVxdWVzdCJ9KQoJCQkJCX0KCQkJCX0pCgoJCQkJcmV0dXJuIGZhbHNlCgkJCX0KCgkJCXNjcmlwdC5vbmxvYWQgPSBmdW5jdGlvbihlKSB7CgkJCQlyZXR1cm4gZmFsc2UKCQkJfQoKCgkJCXNjcmlwdC5zcmMgPSBvcHRpb25zLnVybAoJCQkJKyAob3B0aW9ucy51cmwuaW5kZXhPZigiPyIpID4gMCA/ICImIiA6ICI/IikKCQkJCSsgKG9wdGlvbnMuY2FsbGJhY2tLZXkgPyBvcHRpb25zLmNhbGxiYWNrS2V5IDogImNhbGxiYWNrIikKCQkJCSsgIj0iICsgY2FsbGJhY2tLZXkKCQkJCSsgIiYiICsgYnVpbGRRdWVyeVN0cmluZyhvcHRpb25zLmRhdGEgfHwge30pCgkJCXdpbmRvdy5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCkKCQl9CgkJZWxzZSB7CgkJCXZhciB4aHIgPSBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0CgkJCXhoci5vcGVuKG9wdGlvbnMubWV0aG9kLCBvcHRpb25zLnVybCwgdHJ1ZSwgb3B0aW9ucy51c2VyLCBvcHRpb25zLnBhc3N3b3JkKQoJCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHsKCQkJCQlpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgb3B0aW9ucy5vbmxvYWQoe3R5cGU6ICJsb2FkIiwgdGFyZ2V0OiB4aHJ9KQoJCQkJCWVsc2Ugb3B0aW9ucy5vbmVycm9yKHt0eXBlOiAiZXJyb3IiLCB0YXJnZXQ6IHhocn0pCgkJCQl9CgkJCX0KCQkJaWYgKG9wdGlvbnMuc2VyaWFsaXplID09IEpTT04uc3RyaW5naWZ5ICYmIG9wdGlvbnMuZGF0YSAmJiBvcHRpb25zLm1ldGhvZCAhPSAiR0VUIikgewoJCQkJeGhyLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04IikKCQkJfQoJCQlpZiAob3B0aW9ucy5kZXNlcmlhbGl6ZSA9PSBKU09OLnBhcnNlKSB7CgkJCQl4aHIuc2V0UmVxdWVzdEhlYWRlcigiQWNjZXB0IiwgImFwcGxpY2F0aW9uL2pzb24sIHRleHQvKiIpOwoJCQl9CgkJCWlmIChpc0ZuKG9wdGlvbnMuY29uZmlnKSkgewoJCQkJdmFyIG1heWJlWGhyID0gb3B0aW9ucy5jb25maWcoeGhyLCBvcHRpb25zKQoJCQkJaWYgKG1heWJlWGhyICE9IG51bGwpIHhociA9IG1heWJlWGhyCgkJCX0KCgkJCXhoci5zZW5kKG9wdGlvbnMubWV0aG9kID09ICJHRVQiIHx8ICFvcHRpb25zLmRhdGEgPyAiIiA6IG9wdGlvbnMuZGF0YSkKCQkJcmV0dXJuIHhocgoJCX0KCX0KCWZ1bmN0aW9uIGJpbmREYXRhKHhock9wdGlvbnMsIGRhdGEsIHNlcmlhbGl6ZSkgewoJCWlmIChkYXRhICYmIE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA+IDApIHsKCQkJaWYgKHhock9wdGlvbnMubWV0aG9kID09ICJHRVQiKSB7CgkJCQl4aHJPcHRpb25zLnVybCA9IHhock9wdGlvbnMudXJsICsgKHhock9wdGlvbnMudXJsLmluZGV4T2YoIj8iKSA8IDAgPyAiPyIgOiAiJiIpICsgYnVpbGRRdWVyeVN0cmluZyhkYXRhKQoJCQl9CgkJCWVsc2UgeGhyT3B0aW9ucy5kYXRhID0gc2VyaWFsaXplKGRhdGEpCgkJfQoJCXJldHVybiB4aHJPcHRpb25zCgl9CglmdW5jdGlvbiBwYXJhbWV0ZXJpemVVcmwodXJsLCBkYXRhKSB7CgkJdmFyIHRva2VucyA9IHVybC5tYXRjaCgvOlthLXpdXHcrL2dpKQoJCWlmICh0b2tlbnMgJiYgZGF0YSkgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewoJCQkJdmFyIGtleSA9IHRva2Vuc1tpXS5zbGljZSgxKQoJCQkJdXJsID0gdXJsLnJlcGxhY2UodG9rZW5zW2ldLCBkYXRhW2tleV0pCgkJCQlkZWxldGUgZGF0YVtrZXldCgkJCX0KCQl9CgkJcmV0dXJuIHVybAoJfQoKCW0ucmVxdWVzdCA9IGZ1bmN0aW9uKHhock9wdGlvbnMpIHsKCQlpZiAoeGhyT3B0aW9ucy5iYWNrZ3JvdW5kICE9PSB0cnVlKSBtLnN0YXJ0Q29tcHV0YXRpb24oKQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCXZhciBpc0pTT05QID0geGhyT3B0aW9ucy5kYXRhVHlwZSAmJiB4aHJPcHRpb25zLmRhdGFUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICJqc29ucCIKCQl2YXIgc2VyaWFsaXplID0geGhyT3B0aW9ucy5zZXJpYWxpemUgPSBpc0pTT05QID8gaWRlbnRpdHkgOiB4aHJPcHRpb25zLnNlcmlhbGl6ZSB8fCBKU09OLnN0cmluZ2lmeQoJCXZhciBkZXNlcmlhbGl6ZSA9IHhock9wdGlvbnMuZGVzZXJpYWxpemUgPSBpc0pTT05QID8gaWRlbnRpdHkgOiB4aHJPcHRpb25zLmRlc2VyaWFsaXplIHx8IEpTT04ucGFyc2UKCQl2YXIgZXh0cmFjdCA9IHhock9wdGlvbnMuZXh0cmFjdCB8fCBmdW5jdGlvbih4aHIpIHsKCQkJcmV0dXJuIHhoci5yZXNwb25zZVRleHQubGVuZ3RoID09PSAwICYmIGRlc2VyaWFsaXplID09PSBKU09OLnBhcnNlID8gbnVsbCA6IHhoci5yZXNwb25zZVRleHQKCQl9CgkJeGhyT3B0aW9ucy51cmwgPSBwYXJhbWV0ZXJpemVVcmwoeGhyT3B0aW9ucy51cmwsIHhock9wdGlvbnMuZGF0YSkKCQl4aHJPcHRpb25zID0gYmluZERhdGEoeGhyT3B0aW9ucywgeGhyT3B0aW9ucy5kYXRhLCBzZXJpYWxpemUpCgkJeGhyT3B0aW9ucy5vbmxvYWQgPSB4aHJPcHRpb25zLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7CgkJCXRyeSB7CgkJCQllID0gZSB8fCBldmVudAoJCQkJdmFyIHVud3JhcCA9IChlLnR5cGUgPT0gImxvYWQiID8geGhyT3B0aW9ucy51bndyYXBTdWNjZXNzIDogeGhyT3B0aW9ucy51bndyYXBFcnJvcikgfHwgaWRlbnRpdHkKCQkJCXZhciByZXNwb25zZSA9IHVud3JhcChkZXNlcmlhbGl6ZShleHRyYWN0KGUudGFyZ2V0LCB4aHJPcHRpb25zKSkpCgkJCQlpZiAoZS50eXBlID09ICJsb2FkIikgewoJCQkJCWlmIChpc0FycihyZXNwb25zZSkgJiYgeGhyT3B0aW9ucy50eXBlKSB7CgkJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UubGVuZ3RoOyBpKyspIHJlc3BvbnNlW2ldID0gbmV3IHhock9wdGlvbnMudHlwZShyZXNwb25zZVtpXSkKCQkJCQl9CgkJCQkJZWxzZSBpZiAoeGhyT3B0aW9ucy50eXBlKSByZXNwb25zZSA9IG5ldyB4aHJPcHRpb25zLnR5cGUocmVzcG9uc2UpCgkJCQl9CgkJCQlkZWZlcnJlZFtlLnR5cGUgPT0gImxvYWQiID8gInJlc29sdmUiIDogInJlamVjdCJdKHJlc3BvbnNlKQoJCQl9CgkJCWNhdGNoIChlKSB7CgkJCQltLmRlZmVycmVkLm9uZXJyb3IoZSkKCQkJCWRlZmVycmVkLnJlamVjdChlKQoJCQl9CgkJCWlmICh4aHJPcHRpb25zLmJhY2tncm91bmQgIT09IHRydWUpIG0uZW5kQ29tcHV0YXRpb24oKQoJCX0KCQlhamF4KHhock9wdGlvbnMpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UKCX0KCgkvL3Rlc3RpbmcgQVBJCgltLmRlcHMgPSBmdW5jdGlvbihtb2NrKSB7cmV0dXJuIHdpbmRvdyA9IG1vY2t9CgkvL2ZvciBpbnRlcm5hbCB0ZXN0aW5nIG9ubHksIGRvIG5vdCB1c2UgYG0uZGVwcy5mYWN0b3J5YAoJbS5kZXBzLmZhY3RvcnkgPSBhcHAKCglyZXR1cm4gbQp9KHR5cGVvZiB3aW5kb3cgIT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fSkKCmlmICh0eXBlb2YgbW9kdWxlICE9ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgbW9kdWxlLmV4cG9ydHMgPSBtCmlmICh0eXBlb2YgZGVmaW5lID09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKGZ1bmN0aW9uKCkge3JldHVybiBtfSkKCjs7OwoKZnVuY3Rpb24gdGVzdChjb25kaXRpb24pIHsKCXZhciBkdXJhdGlvbiA9IDAKCXZhciBzdGFydCA9IDAKCXZhciByZXN1bHQgPSB0cnVlCgl0ZXN0LnRvdGFsKysKCglpZiAodHlwZW9mIHBlcmZvcm1hbmNlICE9ICJ1bmRlZmluZWQiKSB7CgkJc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKQoJfQoJdHJ5IHsKCQlpZiAoIWNvbmRpdGlvbigpKSB0aHJvdyBuZXcgRXJyb3IoKQoJfQoJY2F0Y2ggKGUpIHsKCQlyZXN1bHQgPSBmYWxzZQoJCWNvbnNvbGUuZXJyb3IoZSkKCQl0ZXN0LmZhaWx1cmVzLnB1c2goY29uZGl0aW9uKQoJfQoJaWYgKHR5cGVvZiBwZXJmb3JtYW5jZSAhPSAidW5kZWZpbmVkIikgewoJCWR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydAoJfQoKCXRlc3Rfb2JqID0gewoJCW5hbWU6ICIiICsgdGVzdC50b3RhbCwKCQlyZXN1bHQ6IHJlc3VsdCwKCQlkdXJhdGlvbjogZHVyYXRpb24KCX0KCglpZiAodHlwZW9mIHdpbmRvdyAhPSAidW5kZWZpbmVkIikgewoJCWlmICghcmVzdWx0KSB7CgkJCXdpbmRvdy5nbG9iYWxfdGVzdF9yZXN1bHRzLnRlc3RzLnB1c2godGVzdF9vYmopCgkJfQoKCQl3aW5kb3cuZ2xvYmFsX3Rlc3RfcmVzdWx0cy5kdXJhdGlvbiArPSBkdXJhdGlvbgoJCWlmIChyZXN1bHQpIHsKCQkJd2luZG93Lmdsb2JhbF90ZXN0X3Jlc3VsdHMucGFzc2VkKysKCQl9IGVsc2UgewoJCQl3aW5kb3cuZ2xvYmFsX3Rlc3RfcmVzdWx0cy5mYWlsZWQrKwoJCX0KCX0KfQp0ZXN0LnRvdGFsID0gMAp0ZXN0LmZhaWx1cmVzID0gW10KdGVzdC5wcmludCA9IGZ1bmN0aW9uKHByaW50KSB7Cglmb3IgKHZhciBpID0gMDsgaSA8IHRlc3QuZmFpbHVyZXMubGVuZ3RoOyBpKyspIHsKCQlwcmludCh0ZXN0LmZhaWx1cmVzW2ldLnRvU3RyaW5nKCkpCgl9CglwcmludCgidGVzdHM6ICIgKyB0ZXN0LnRvdGFsICsgIlxuZmFpbHVyZXM6ICIgKyB0ZXN0LmZhaWx1cmVzLmxlbmd0aCkKCglpZiAodGVzdC5mYWlsdXJlcy5sZW5ndGggPiAwKSB7CgkJdGhyb3cgbmV3IEVycm9yKHRlc3QuZmFpbHVyZXMubGVuZ3RoICsgIiB0ZXN0cyBkaWQgbm90IHBhc3MiKQoJfQp9Cgp2YXIgbW9jayA9IHt9Cm1vY2sud2luZG93ID0gbmV3IGZ1bmN0aW9uKCkgewoJdmFyIHdpbmRvdyA9IHt9Cgl3aW5kb3cuZG9jdW1lbnQgPSB7fQoJd2luZG93LmRvY3VtZW50LmNoaWxkTm9kZXMgPSBbXQoJd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbih0YWcpIHsKCQlyZXR1cm4gewoJCQlzdHlsZToge30sCgkJCWNoaWxkTm9kZXM6IFtdLAoJCQlub2RlVHlwZTogMSwKCQkJbm9kZU5hbWU6IHRhZy50b1VwcGVyQ2FzZSgpLAoJCQlhcHBlbmRDaGlsZDogd2luZG93LmRvY3VtZW50LmFwcGVuZENoaWxkLAoJCQlyZW1vdmVDaGlsZDogd2luZG93LmRvY3VtZW50LnJlbW92ZUNoaWxkLAoJCQlyZXBsYWNlQ2hpbGQ6IHdpbmRvdy5kb2N1bWVudC5yZXBsYWNlQ2hpbGQsCgkJCWluc2VydEJlZm9yZTogZnVuY3Rpb24obm9kZSwgcmVmZXJlbmNlKSB7CgkJCQlub2RlLnBhcmVudE5vZGUgPSB0aGlzCgkJCQl2YXIgcmVmZXJlbmNlSW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihyZWZlcmVuY2UpCgkJCQl2YXIgaW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihub2RlKQoJCQkJaWYgKGluZGV4ID4gLTEpIHRoaXMuY2hpbGROb2Rlcy5zcGxpY2UoaW5kZXgsIDEpCgkJCQlpZiAocmVmZXJlbmNlSW5kZXggPCAwKSB0aGlzLmNoaWxkTm9kZXMucHVzaChub2RlKQoJCQkJZWxzZSB0aGlzLmNoaWxkTm9kZXMuc3BsaWNlKHJlZmVyZW5jZUluZGV4LCAwLCBub2RlKQoJCQl9LAoJCQlpbnNlcnRBZGphY2VudEhUTUw6IGZ1bmN0aW9uKHBvc2l0aW9uLCBodG1sKSB7CgkJCQkvL3RvZG86IGFjY2VwdCBtYXJrdXAKCQkJCWlmIChwb3NpdGlvbiA9PSAiYmVmb3JlYmVnaW4iKSB7CgkJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaHRtbCksIHRoaXMpCgkJCQl9CgkJCQllbHNlIGlmIChwb3NpdGlvbiA9PSAiYmVmb3JlZW5kIikgewoJCQkJCXRoaXMuYXBwZW5kQ2hpbGQod2luZG93LmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGh0bWwpKQoJCQkJfQoJCQl9LAoJCQlzZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CgkJCQl0aGlzW25hbWVdID0gdmFsdWUudG9TdHJpbmcoKQoJCQl9LAoJCQlzZXRBdHRyaWJ1dGVOUzogZnVuY3Rpb24obmFtZXNwYWNlLCBuYW1lLCB2YWx1ZSkgewoJCQkJdGhpcy5uYW1lc3BhY2VVUkkgPSBuYW1lc3BhY2UKCQkJCXRoaXNbbmFtZV0gPSB2YWx1ZS50b1N0cmluZygpCgkJCX0sCgkJCWdldEF0dHJpYnV0ZTogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKCQkJCXJldHVybiB0aGlzW25hbWVdCgkJCX0KCQl9Cgl9Cgl3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TID0gZnVuY3Rpb24obmFtZXNwYWNlLCB0YWcpIHsKCQl2YXIgZWxlbWVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZykKCQllbGVtZW50Lm5hbWVzcGFjZVVSSSA9IG5hbWVzcGFjZQoJCXJldHVybiBlbGVtZW50Cgl9Cgl3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUgPSBmdW5jdGlvbih0ZXh0KSB7CgkJcmV0dXJuIHtub2RlVmFsdWU6IHRleHQudG9TdHJpbmcoKX0KCX0KCXdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaHRtbCIpCgl3aW5kb3cuZG9jdW1lbnQucmVwbGFjZUNoaWxkID0gZnVuY3Rpb24obmV3Q2hpbGQsIG9sZENoaWxkKSB7CgkJdmFyIGluZGV4ID0gdGhpcy5jaGlsZE5vZGVzLmluZGV4T2Yob2xkQ2hpbGQpCgkJaWYgKGluZGV4ID4gLTEpIHRoaXMuY2hpbGROb2Rlcy5zcGxpY2UoaW5kZXgsIDEsIG5ld0NoaWxkKQoJCWVsc2UgdGhpcy5jaGlsZE5vZGVzLnB1c2gobmV3Q2hpbGQpCgkJbmV3Q2hpbGQucGFyZW50Tm9kZSA9IHRoaXMKCQlvbGRDaGlsZC5wYXJlbnROb2RlID0gbnVsbAoJfQoJd2luZG93LmRvY3VtZW50LmFwcGVuZENoaWxkID0gZnVuY3Rpb24oY2hpbGQpIHsKCQl2YXIgaW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihjaGlsZCkKCQlpZiAoaW5kZXggPiAtMSkgdGhpcy5jaGlsZE5vZGVzLnNwbGljZShpbmRleCwgMSkKCQl0aGlzLmNoaWxkTm9kZXMucHVzaChjaGlsZCkKCQljaGlsZC5wYXJlbnROb2RlID0gdGhpcwoJfQoJd2luZG93LmRvY3VtZW50LnJlbW92ZUNoaWxkID0gZnVuY3Rpb24oY2hpbGQpIHsKCQl2YXIgaW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihjaGlsZCkKCQl0aGlzLmNoaWxkTm9kZXMuc3BsaWNlKGluZGV4LCAxKQoJCWNoaWxkLnBhcmVudE5vZGUgPSBudWxsCgl9CgkvL2dldEVsZW1lbnRzQnlUYWdOYW1lIGlzIG9ubHkgdXNlZCBieSBKU09OUCB0ZXN0cywgaXQncyBub3QgcmVxdWlyZWQgYnkgTWl0aHJpbAoJd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lID0gZnVuY3Rpb24obmFtZSl7CgkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCQl2YXIgb3V0ID0gW107CgoJCXZhciB0cmF2ZXJzZSA9IGZ1bmN0aW9uKG5vZGUpewoJCQlpZihub2RlLmNoaWxkTm9kZXMgJiYgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA+IDApewoJCQkJbm9kZS5jaGlsZE5vZGVzLmZvckVhY2goZnVuY3Rpb24oY3Vycil7CgkJCQkJaWYoY3Vyci5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lKQoJCQkJCQlvdXQucHVzaChjdXJyKTsKCQkJCQl0cmF2ZXJzZShjdXJyKTsKCQkJCX0pOwoJCQl9CgkJfTsKCgkJdHJhdmVyc2Uod2luZG93LmRvY3VtZW50KTsKCQlyZXR1cm4gb3V0OwoJfQoJd2luZG93LnNjcm9sbFRvID0gZnVuY3Rpb24oKSB7fQoJd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oKSB7fQoJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2sgPSBjYWxsYmFjawoJCXJldHVybiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRpZCsrCgl9Cgl3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRpZCA9IDEKCXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUgPSBmdW5jdGlvbigpIHsKCQlpZiAod2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2spIHsKCQkJdmFyIGNhbGxiYWNrID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2sKCQkJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2sgPSBudWxsCgkJCWNhbGxiYWNrKCkKCQl9Cgl9Cgl3aW5kb3cuWE1MSHR0cFJlcXVlc3QgPSBuZXcgZnVuY3Rpb24oKSB7CgkJdmFyIHJlcXVlc3QgPSBmdW5jdGlvbigpIHsKCQkJdGhpcy4kaGVhZGVycyA9IHt9CgkJCXRoaXMuc2V0UmVxdWVzdEhlYWRlciA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKCQkJCXRoaXMuJGhlYWRlcnNba2V5XSA9IHZhbHVlCgkJCX0KCQkJdGhpcy5vcGVuID0gZnVuY3Rpb24obWV0aG9kLCB1cmwpIHsKCQkJCXRoaXMubWV0aG9kID0gbWV0aG9kCgkJCQl0aGlzLnVybCA9IHVybAoJCQl9CgkJCXRoaXMuc2VuZCA9IGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5yZXNwb25zZVRleHQgPSBKU09OLnN0cmluZ2lmeSh0aGlzKQoJCQkJdGhpcy5yZWFkeVN0YXRlID0gNAoJCQkJdGhpcy5zdGF0dXMgPSAyMDAKCQkJCXJlcXVlc3QuJGluc3RhbmNlcy5wdXNoKHRoaXMpCgkJCX0KCQl9CgkJcmVxdWVzdC4kaW5zdGFuY2VzID0gW10KCQlyZXR1cm4gcmVxdWVzdAoJfQoJd2luZG93LmxvY2F0aW9uID0ge3NlYXJjaDogIiIsIHBhdGhuYW1lOiAiIiwgaGFzaDogIiJ9LAoJd2luZG93Lmhpc3RvcnkgPSB7fQoJd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlID0gZnVuY3Rpb24oZGF0YSwgdGl0bGUsIHVybCkgewoJCXdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHVybAoJfSwKCXdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSA9IGZ1bmN0aW9uKGRhdGEsIHRpdGxlLCB1cmwpIHsKCQl3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoID0gd2luZG93LmxvY2F0aW9uLmhhc2ggPSB1cmwKCX0KCXJldHVybiB3aW5kb3cKfQpmdW5jdGlvbiB0ZXN0TWl0aHJpbChtb2NrKSB7CgltLmRlcHMobW9jaykKCgkvL20KCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIpLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIpLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIpLmF0dHJzLmNsYXNzTmFtZSA9PT0gImZvbyJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiW3RpdGxlPWJhcl0iKS50YWcgPT09ICJkaXYifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oIlt0aXRsZT1iYXJdIikuYXR0cnMudGl0bGUgPT09ICJiYXIifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oIlt0aXRsZT1cJ2JhclwnXSIpLmF0dHJzLnRpdGxlID09PSAiYmFyIn0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJbdGl0bGU9XCJiYXJcIl0iKS5hdHRycy50aXRsZSA9PT0gImJhciJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgInRlc3QiKS5jaGlsZHJlblswXSA9PT0gInRlc3QifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsICJ0ZXN0IiwgInRlc3QyIikuY2hpbGRyZW5bMV0gPT09ICJ0ZXN0MiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgWyJ0ZXN0Il0pLmNoaWxkcmVuWzBdID09PSAidGVzdCJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2Iiwge3RpdGxlOiAiYmFyIn0sICJ0ZXN0IikuYXR0cnMudGl0bGUgPT09ICJiYXIifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIHt0aXRsZTogImJhciJ9LCAidGVzdCIpLmNoaWxkcmVuWzBdID09PSAidGVzdCJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2Iiwge3RpdGxlOiAiYmFyIn0sIFsidGVzdCJdKS5jaGlsZHJlblswXSA9PT0gInRlc3QifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIHt0aXRsZTogImJhciJ9LCBtKCJkaXYiKSkuY2hpbGRyZW5bMF0udGFnID09PSAiZGl2In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCB7dGl0bGU6ICJiYXIifSwgW20oImRpdiIpXSkuY2hpbGRyZW5bMF0udGFnID09PSAiZGl2In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCB7dGl0bGU6ICJiYXIifSwgInRlc3QwIiwgInRlc3QxIiwgInRlc3QyIiwgInRlc3QzIikuY2hpbGRyZW5bM10gPT09ICJ0ZXN0MyJ9KSAvLyBzcGxhdAoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2Iiwge3RpdGxlOiAiYmFyIn0sIG0oImRpdiIpLCBtKCJpIiksIG0oInNwYW4iKSkuY2hpbGRyZW5bMl0udGFnID09PSAic3BhbiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgWyJhIiwgImIiXSkuY2hpbGRyZW4ubGVuZ3RoID09PSAyfSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFttKCJkaXYiKV0pLmNoaWxkcmVuWzBdLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgbSgiZGl2IikpLmNoaWxkcmVuWzBdLnRhZyA9PT0gImRpdiJ9KSAvL3llcywgdGhpcyBpcyBleHBlY3RlZCBiZWhhdmlvcjogc2VlIG1ldGhvZCBzaWduYXR1cmUKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFt1bmRlZmluZWRdKS50YWcgPT09ICJkaXYifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFt7Zm9vOiAiYmFyIn1dKX0pIC8vYXMgbG9uZyBhcyBpdCBkb2Vzbid0IHRocm93IGVycm9ycywgaXQncyBmaW5lCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJzdmciLCBbbSgiZyIpXSl9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgic3ZnIiwgW20oImFbaHJlZj0naHR0cDovL2dvb2dsZS5jb20nXSIpXSl9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIsIHtjbGFzczogImJhciJ9KS5hdHRycy5jbGFzcyA9PSAiZm9vIGJhciJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIsIHtjbGFzc05hbWU6ICJiYXIifSkuYXR0cnMuY2xhc3NOYW1lID09ICJmb28gYmFyIn0pCgoJLy9tLm1vZHVsZQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgoJCXZhciByb290MSA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgbW9kMSA9IG0ubW9kdWxlKHJvb3QxLCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3RoaXMudmFsdWUgPSAidGVzdDEifSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkge3JldHVybiBjdHJsLnZhbHVlfQoJCX0pCgoJCXZhciByb290MiA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgbW9kMiA9IG0ubW9kdWxlKHJvb3QyLCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3RoaXMudmFsdWUgPSAidGVzdDIifSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkge3JldHVybiBjdHJsLnZhbHVlfQoJCX0pCgoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCgkJcmV0dXJuIChyb290MS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QxIiAmJiByb290Mi5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QyIikKCQkJJiYgKG1vZDEudmFsdWUgJiYgbW9kMS52YWx1ZSA9PT0gInRlc3QxIikgJiYgKG1vZDIudmFsdWUgJiYgbW9kMi52YWx1ZSA9PT0gInRlc3QyIikKCX0pCgoJLy9tLndpdGhBdHRyCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBoYW5kbGVyID0gbS53aXRoQXR0cigidGVzdCIsIGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWhhbmRsZXIoe2N1cnJlbnRUYXJnZXQ6IHt0ZXN0OiAiZm9vIn19KQoJCXJldHVybiB2YWx1ZSA9PT0gImZvbyIKCX0pCgoJLy9tLnRydXN0Cgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtLnRydXN0KCJ0ZXN0IikudmFsdWVPZigpID09PSAidGVzdCJ9KQoKCS8vbS5yZW5kZXIKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgInRlc3QiKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjbGFzczogImEifSkpCgkJdmFyIGVsZW1lbnRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y2xhc3M6ICJiIn0pKQoJCXZhciBlbGVtZW50QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQlyZXR1cm4gZWxlbWVudEJlZm9yZSA9PT0gZWxlbWVudEFmdGVyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIuYSIpKQoJCXZhciBlbGVtZW50QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgbSgiLmIiKSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgPT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2lkOiAiYSJ9KSkKCQl2YXIgZWxlbWVudEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHt0aXRsZTogImIifSkpCgkJdmFyIGVsZW1lbnRBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBlbGVtZW50QmVmb3JlICE9PSBlbGVtZW50QWZ0ZXIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNhIikpCgkJdmFyIGVsZW1lbnRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBtKCJbdGl0bGU9Yl0iKSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2EiKSkKCQl2YXIgZWxlbWVudEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsICJ0ZXN0IikKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW3VuZGVmaW5lZF0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJzdmciLCBbbSgiZyIpXSkpCgkJdmFyIGcgPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXQoJCXJldHVybiBnLm5vZGVOYW1lID09PSAiRyIgJiYgZy5uYW1lc3BhY2VVUkkgPT0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgic3ZnIiwgW20oImFbaHJlZj0naHR0cDovL2dvb2dsZS5jb20nXSIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiQSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdi5jbGFzc25hbWUiLCBbbSgiYSIsIHtocmVmOiAiL2ZpcnN0In0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImEiLCB7aHJlZjogIi9zZWNvbmQifSldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubGVuZ3RoID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIildKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIpLCB1bmRlZmluZWRdKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZVZhbHVlID09PSAiIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiKSwgbSgibGkiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiksIHVuZGVmaW5lZF0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlVmFsdWUgPT09ICIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbdW5kZWZpbmVkXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIildKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFt7fV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT09IDAKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIildKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFt7dGFnOiAiYiIsIGF0dHJzOiB7fX1dKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT0gIkIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbe3RhZzogbmV3IFN0cmluZygiYiIpLCBhdHRyczoge319XSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09ICJCIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCBbbSgiYSIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFt7c3VidHJlZTogInJldGFpbiJ9XSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT09ICJBIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQzCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsIHtjb25maWc6IG0ucm91dGV9LCAidGVzdCIpKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCB7Y29uZmlnOiBtLnJvdXRlfSwgInRlc3QiKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoMSkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW251bGwsIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbInRlc3QiLCBtKCIjYmFyIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoMikKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW251bGwsIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiZGl2IiksIG0oIiNiYXIiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZSA9PT0gIkRJViIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoMykKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgWyJ0ZXN0IiwgbSgiI2JhciIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFttKCJkaXYiKSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiRElWIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQ0ICg0KQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiZGl2IiksIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbInRlc3QiLCBtKCIjYmFyIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoNSkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW20oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiI2JhciIpLCBbbSgiI2JheiIpXV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5pZCA9PT0gImJheiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80OAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudAoJCW0ucmVuZGVyKHJvb3QsIG0oImh0bWwiLCBbbSgiI2ZvbyIpXSkpCgkJdmFyIHJlc3VsdCA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmlkID09PSAiZm9vIgoJCXJvb3QuY2hpbGROb2RlcyA9IFttb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImh0bWwiKV0KCQlyZXR1cm4gcmVzdWx0Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJhIiwgInRlc3QiKSkKCQltLnJlbmRlcihyb290LCBtKCJhLmZvbyIsICJ0ZXN0IikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJhLmZvbyIsICJ0ZXN0IikpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsICJ0ZXN0IikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJhLmZvbyIsICJ0ZXN0IikpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsICJ0ZXN0MSIpKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0MSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80OQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCAidGVzdCIpKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCAidGVzdDEiKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdDEiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1ttKCJkaXYiLCAiYSIpLCBtKCJkaXYiLCAiYiIpXSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbW20oImRpdiIsICJhIiksIG0oImRpdiIsICJiIildLCBtKCIjYmFyIildKSkKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1ttKCJkaXYiLCAiYSIpLCBtKCJkaXYiLCAiYiIpLCBtKCJkaXYiLCAiYyIpXSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzJdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbW20oImRpdiIsICJhIiksIG0oImRpdiIsICJiIildLCBbbSgiZGl2IiwgImMiKSwgbSgiZGl2IiwgImQiKV0sIG0oIiNiYXIiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1szXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImQiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzRdLmlkID09PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFtbbSgiZGl2IiwgImEiKSwgbSgiZGl2IiwgImIiKV0sICJ0ZXN0Il0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImIiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzJdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1siYSIsICJiIl0sICJ0ZXN0Il0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlVmFsdWUgPT09ICJiIiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1syXS5ub2RlVmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUxCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFttKCJzZWN0aW9uIiksIG0oIm5hdiIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwgW20oImJ1dHRvbiIpLCBtKCJhcnRpY2xlIiwgW20oInNwYW4iKSwgbSgibmF2IildKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiU1BBTiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIm1haW4iLCBbbSgiYnV0dG9uIiksIG0oImFydGljbGUiLCBbbSgic2VjdGlvbiIpLCBtKCJuYXYiKV0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFsidGVzdCIsIG0oIm5hdiIpXSldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUxCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFttKCJzZWN0aW9uIiksIG0oIm5hdiIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwgW20oImJ1dHRvbiIpLCBtKCJhcnRpY2xlIiwgW20udHJ1c3QoInRlc3QiKSwgbSgibmF2IildKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTUKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjYSIpKQoJCXZhciBlbGVtZW50QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgbSgiI2IiKSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzU2CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW251bGwsICJmb28iXSkKCQltLnJlbmRlcihyb290LCBbImJhciJdKQoJCXJldHVybiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81NgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsICJmb28iKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbbSgiYnV0dG9uIiksIG0oInVsIildKSkKCQl2YXIgdmFsdWVCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFt1bmRlZmluZWQsIG0oInVsIildKSkKCQl2YXIgdmFsdWVBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZQoJCXJldHVybiB2YWx1ZUJlZm9yZSA9PT0gIkJVVFRPTiIgJiYgdmFsdWVBZnRlciA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFttKCJ1bCIpLCB1bmRlZmluZWRdKSkKCQl2YXIgdmFsdWVCZWZvcmUxID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUKCQl2YXIgdmFsdWVCZWZvcmUyID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZVZhbHVlCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW3VuZGVmaW5lZCwgbSgidWwiKV0pKQoJCXZhciB2YWx1ZUFmdGVyMSA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZQoJCXZhciB2YWx1ZUFmdGVyMiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLm5vZGVOYW1lCgkJcmV0dXJuIHZhbHVlQmVmb3JlMSA9PT0gIlVMIiAmJiB2YWx1ZUFmdGVyMSA9PT0gIiIgJiYgdmFsdWVCZWZvcmUyID09PSAiIiAmJiB2YWx1ZUFmdGVyMiA9PT0gIlVMIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzc5CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge3N0eWxlOiB7YmFja2dyb3VuZDogInJlZCJ9fSkpCgkJdmFyIHZhbHVlQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmQKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7c3R5bGU6IHt9fSkpCgkJdmFyIHZhbHVlQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZAoJCXJldHVybiB2YWx1ZUJlZm9yZSA9PT0gInJlZCIgJiYgdmFsdWVBZnRlciA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdltzdHlsZT0nYmFja2dyb3VuZDpyZWQnXSIpKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uc3R5bGUgPT09ICJiYWNrZ3JvdW5kOnJlZCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtzdHlsZToge2JhY2tncm91bmQ6ICJyZWQifX0pKQoJCXZhciB2YWx1ZUJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge30pKQoJCXZhciB2YWx1ZUFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmQKCQlyZXR1cm4gdmFsdWVCZWZvcmUgPT09ICJyZWQiICYmIHZhbHVlQWZ0ZXIgPT09IHVuZGVmaW5lZAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIG1vZHVsZSA9IHt9LCB1bmxvYWRlZCA9IGZhbHNlCgkJbW9kdWxlLmNvbnRyb2xsZXIgPSBmdW5jdGlvbigpIHsKCQkJdGhpcy5vbnVubG9hZCA9IGZ1bmN0aW9uKCkge3VubG9hZGVkID0gdHJ1ZX0KCQl9CgkJbW9kdWxlLnZpZXcgPSBmdW5jdGlvbigpIHt9CgkJbS5tb2R1bGUocm9vdCwgbW9kdWxlKQoJCW0ubW9kdWxlKHJvb3QsIHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHt9fSkKCQlyZXR1cm4gdW5sb2FkZWQgPT09IHRydWUKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84NwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbbSgiYSIpLCBtKCJhIildLCBtKCJidXR0b24iKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbbSgiYSIpXSwgbSgiYnV0dG9uIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubGVuZ3RoID09IDIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZU5hbWUgPT0gIkJVVFRPTiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84NwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFttKCJhIiksIG0oImIiKSwgbSgiYnV0dG9uIildKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbbSgiYSIpLCBtKCJidXR0b24iKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlTmFtZSA9PSAiQlVUVE9OIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk5CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImltZyIpLCBtKCJoMSIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImEiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMSAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZSA9PSAiQSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImEiLCAiYiIsICJjIiwgImQiXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW1siZCIsICJlIl1dKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMiAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbWyJhIiwgImIiLCAiYyIsICJkIl1dKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImQiLCAiZSJdKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMiAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbIngiLCBbWyJhIl0sICJiIiwgImMiLCAiZCJdXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJkIiwgWyJlIl1dKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMiAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImIiXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW1siZSJdXSkpCgkJdmFyIGNoaWxkcmVuID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMKCQlyZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID09IDEgJiYgY2hpbGRyZW5bMF0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsIFsiYiJdXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJkIiwgW1siZSJdXV0pKQoJCXZhciBjaGlsZHJlbiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzCgkJcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA9PSAyICYmIGNoaWxkcmVuWzBdLm5vZGVWYWx1ZSA9PSAiZCIgJiYgY2hpbGRyZW5bMV0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsIFtbImIiXV1dKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImQiLCBbImUiXV0pKQoJCXZhciBjaGlsZHJlbiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzCgkJcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA9PSAyICYmIGNoaWxkcmVuWzBdLm5vZGVWYWx1ZSA9PSAiZCIgJiYgY2hpbGRyZW5bMV0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsIFtbImIiXSwgImMiXV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiZCIsIFtbWyJlIl1dLCAieCJdXSkpCgkJdmFyIGNoaWxkcmVuID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMKCQlyZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID09IDMgJiYgY2hpbGRyZW5bMF0ubm9kZVZhbHVlID09ICJkIiAmJiBjaGlsZHJlblsxXS5ub2RlVmFsdWUgPT0gImUiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCgkJdmFyIHN1Y2Nlc3MgPSBmYWxzZQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb25maWc6IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkge2N0eC5kYXRhID0gMX19KSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29uZmlnOiBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHtzdWNjZXNzID0gY3R4LmRhdGEgPT09IDF9fSkpCgkJcmV0dXJuIHN1Y2Nlc3MKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoKCQl2YXIgaW5kZXggPSAwOwoJCXZhciBzdWNjZXNzID0gdHJ1ZTsKCQl2YXIgc3RhdGVmdWxDb25maWcgPSBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHtjdHguZGF0YSA9IGluZGV4Kyt9CgkJdmFyIG5vZGUgPSBtKCJkaXYiLCB7Y29uZmlnOiBzdGF0ZWZ1bENvbmZpZ30pOwoJCW0ucmVuZGVyKHJvb3QsIFtub2RlLCBub2RlXSk7CgoJCWluZGV4ID0gMDsKCQl2YXIgY2hlY2tDb25maWcgPSBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHsKCQkJc3VjY2VzcyA9IHN1Y2Nlc3MgJiYgKGN0eC5kYXRhID09PSBpbmRleCsrKQoJCX0KCQlub2RlID0gbSgiZGl2Iiwge2NvbmZpZzogY2hlY2tDb25maWd9KTsKCQltLnJlbmRlcihyb290LCBbbm9kZSwgbm9kZV0pOwoJCXJldHVybiBzdWNjZXNzOwoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHBhcmVudAoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIG0oImEiLCB7CgkJCWNvbmZpZzogZnVuY3Rpb24oZWwpIHtwYXJlbnQgPSBlbC5wYXJlbnROb2RlLnBhcmVudE5vZGV9CgkJfSkpKTsKCQlyZXR1cm4gcGFyZW50ID09PSByb290Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgY291bnQgPSAwCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgbSgiYSIsIHsKCQkJY29uZmlnOiBmdW5jdGlvbihlbCkgewoJCQkJdmFyIGlzbGFuZCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQkJCWNvdW50KysKCQkJCWlmIChjb3VudCA+IDIpIHRocm93ICJ0b28gbXVjaCByZWN1cnNpb24uLi4iCgkJCQltLnJlbmRlcihpc2xhbmQsIG0oImRpdiIpKQoJCQl9CgkJfSkpKTsKCQlyZXR1cm4gY291bnQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyOQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbImZvbyIsICJiYXIiXSwgWyJmb28iLCAiYmFyIl0sIFsiZm9vIiwgImJhciJdXSkpOwoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYXNkZiIsICJhc2RmMiIsICJhc2RmMyJdKSk7CgkJcmV0dXJuIHRydWUKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy85OAoJCS8vaW5zZXJ0IGF0IGJlZ2lubmluZwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogM30pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KV0pCgkJdmFyIGZpcnN0QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMV0KCQlyZXR1cm4gZmlyc3RCZWZvcmUgPT0gZmlyc3RBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMF0ua2V5ID09IDQgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSA0Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvOTgKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KV0pCgkJdmFyIGZpcnN0QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzFdCgkJcmV0dXJuIGZpcnN0QmVmb3JlID09IGZpcnN0QWZ0ZXIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmtleSA9PSA0ICYmIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT0gMwoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk4CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSksIG0oImEiLCB7a2V5OiAzfSldKQoJCXZhciBmaXJzdEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogM30pLCBtKCJhIiwge2tleTogNH0pXSkKCQl2YXIgZmlyc3RBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PSBmaXJzdEFmdGVyICYmIHJvb3QuY2hpbGROb2Rlc1swXS5rZXkgPT09ICIyIiAmJiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09PSAzCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvOTgKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KSwgbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDV9KV0pCgkJdmFyIGZpcnN0QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJdmFyIHNlY29uZEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCXZhciBmb3VydGhCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbM10KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDEwfSksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzJdCgkJdmFyIHNlY29uZEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJdmFyIGZvdXJ0aEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGZpcnN0QmVmb3JlID09PSBmaXJzdEFmdGVyICYmIHNlY29uZEJlZm9yZSA9PT0gc2Vjb25kQWZ0ZXIgJiYgZm91cnRoQmVmb3JlID09PSBmb3VydGhBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMV0ua2V5ID09ICIxMCIgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gNAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk4CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSksIG0oImEiLCB7a2V5OiAzfSksIG0oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiA1fSldKQoJCXZhciBmaXJzdEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXZhciBzZWNvbmRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMV0KCQl2YXIgZm91cnRoQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiAxMH0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogNn0pLCBtKCJhIiwge2tleTogN30pXSkKCQl2YXIgZmlyc3RBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1szXQoJCXZhciBzZWNvbmRBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1syXQoJCXZhciBmb3VydGhBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PT0gZmlyc3RBZnRlciAmJiBzZWNvbmRCZWZvcmUgPT09IHNlY29uZEFmdGVyICYmIGZvdXJ0aEJlZm9yZSA9PT0gZm91cnRoQWZ0ZXIgJiYgcm9vdC5jaGlsZE5vZGVzWzFdLmtleSA9PSAiMTAiICYmIHJvb3QuY2hpbGROb2Rlc1s0XS5rZXkgPT0gIjYiICYmIHJvb3QuY2hpbGROb2Rlc1s1XS5rZXkgPT0gIjciICYmIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT09IDYKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIpLCBtKCJhIiwge2tleTogNH0pLCBtKCJhIiwge2tleTogNX0pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQl2YXIgc2Vjb25kQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzFdCgkJdmFyIHRoaXJkQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzJdCgkJdmFyIGZvdXJ0aEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1szXQoJCXZhciBmaWZ0aEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1s0XQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogNH0pLCBtKCJhIiwge2tleTogNX0pLCBtKCJhIiksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJdmFyIHNlY29uZEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzRdCgkJdmFyIHRoaXJkQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMl0KCQl2YXIgZm91cnRoQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQl2YXIgZmlmdGhBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PT0gZmlyc3RBZnRlciAmJiBzZWNvbmRCZWZvcmUgPT09IHNlY29uZEFmdGVyICYmIHRoaXJkQmVmb3JlID09PSB0aGlyZEFmdGVyICYmIGZvdXJ0aEJlZm9yZSA9PT0gZm91cnRoQWZ0ZXIgJiYgZmlmdGhCZWZvcmUgPT09IGZpZnRoQWZ0ZXIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8yNDYKCQkvL2luc2VydCBhdCBiZWdpbm5pbmcgd2l0aCBub24ta2V5ZWQgaW4gdGhlIG1pZGRsZQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMX0pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYnIiKSwgbSgiYSIsIHtrZXk6IDF9KV0pCgkJdmFyIGZpcnN0QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMl0KCQlyZXR1cm4gZmlyc3RCZWZvcmUgPT0gZmlyc3RBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMF0ua2V5ID09IDIgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSAzCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTM0CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbnRlbnRlZGl0YWJsZTogdHJ1ZX0sICJ0ZXN0IikpCgkJbW9jay5kb2N1bWVudC5hY3RpdmVFbGVtZW50ID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbnRlbnRlZGl0YWJsZTogdHJ1ZX0sICJ0ZXN0MSIpKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb250ZW50ZWRpdGFibGU6IGZhbHNlfSwgInRlc3QyIikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEzNgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInRleHRhcmVhIiwgWyJ0ZXN0Il0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInRleHRhcmVhIiwgWyJ0ZXN0MSJdKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLnZhbHVlID09PSAidGVzdDEiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yZW5kZXIocm9vdCwgWwoJCQltKCJkaXYiLCB7CgkJCQlrZXk6IDEsCgkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJdW5sb2FkZWQrKwoJCQkJCX0KCQkJCX0KCQkJfSkKCQldKQoJCW0ucmVuZGVyKHJvb3QsIFsKCQkJbSgiZGl2Iiwge2tleTogMn0pLAoJCQltKCJkaXYiLCB7CgkJCQlrZXk6IDEsCgkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJdW5sb2FkZWQrKwoJCQkJCX0KCQkJCX0KCQkJfSkKCQldKQoJCXJldHVybiB1bmxvYWRlZCA9PSAwCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWRQYXJlbnQgPSAwCgkJdmFyIHVubG9hZGVkQ2hpbGQgPSAwCgkJdmFyIGNvbmZpZ1BhcmVudCA9IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQl1bmxvYWRlZFBhcmVudCsrCgkJCX0KCQl9CgkJdmFyIGNvbmZpZ0NoaWxkID0gZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCXVubG9hZGVkQ2hpbGQrKwoJCQl9CgkJfQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29uZmlnOiBjb25maWdQYXJlbnR9LCBtKCJhIiwge2NvbmZpZzogY29uZmlnQ2hpbGR9KSkpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIHtjb25maWc6IGNvbmZpZ1BhcmVudH0sIG0oImEiLCB7Y29uZmlnOiBjb25maWdDaGlsZH0pKSkKCQlyZXR1cm4gdW5sb2FkZWRQYXJlbnQgPT09IDEgJiYgdW5sb2FkZWRDaGlsZCA9PT0gMAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkUGFyZW50ID0gMAoJCXZhciB1bmxvYWRlZENoaWxkID0gMAoJCXZhciBjb25maWdQYXJlbnQgPSBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJdW5sb2FkZWRQYXJlbnQrKwoJCQl9CgkJfQoJCXZhciBjb25maWdDaGlsZCA9IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQl1bmxvYWRlZENoaWxkKysKCQkJfQoJCX0KCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogY29uZmlnUGFyZW50fSwgbSgiYSIsIHtjb25maWc6IGNvbmZpZ0NoaWxkfSkpKQoJCW0ucmVuZGVyKHJvb3QsIG0oIm1haW4iLCB7Y29uZmlnOiBjb25maWdQYXJlbnR9LCBtKCJiIiwge2NvbmZpZzogY29uZmlnQ2hpbGR9KSkpCgkJcmV0dXJuIHVubG9hZGVkUGFyZW50ID09PSAxICYmIHVubG9hZGVkQ2hpbGQgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xNTAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIpLCBtKCJkaXYiKV0pCgkJbS5yZW5kZXIocm9vdCwgW1tdLCBtKCJkaXYiKV0pCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT0gMSAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT0gIkRJViIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xNTYKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbCgkJCVsiYSIsICJiIiwgImMiLCAiZCJdLm1hcChmdW5jdGlvbigpIHsKCQkJCXJldHVybiBbbSgiZGl2IiksICIgIl0KCQkJfSksCgkJCW0oInNwYW4iKQoJCV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1s4XS5ub2RlTmFtZSA9PSAiU1BBTiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xNTcKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIsIHtrZXk6IDB9KSwgbSgibGkiLCB7a2V5OiAyfSksIG0oImxpIiwge2tleTogNH0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCB7a2V5OiAwfSksIG0oImxpIiwge2tleTogMX0pLCBtKCJsaSIsIHtrZXk6IDJ9KSwgbSgibGkiLCB7a2V5OiAzfSksIG0oImxpIiwge2tleTogNH0pLCBtKCJsaSIsIHtrZXk6IDV9KV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5tYXAoZnVuY3Rpb24obikge3JldHVybiBuLmtleX0pLmpvaW4oIiIpID09ICIwMTIzNDUiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTU3CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiaW5wdXQiLCB7dmFsdWU6ICJhIn0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImlucHV0Iiwge3ZhbHVlOiAiYWEifSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAwCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTU3CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiYnIiLCB7Y2xhc3M6ICJhIn0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImJyIiwge2NsYXNzOiAiYWEifSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAwCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTk0CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCB7a2V5OiAwfSksIG0oImxpIiwge2tleTogMX0pLCBtKCJsaSIsIHtrZXk6IDJ9KSwgbSgibGkiLCB7a2V5OiAzfSksIG0oImxpIiwge2tleTogNH0pLCBtKCJsaSIsIHtrZXk6IDV9KV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiwge2tleTogMH0pLCBtKCJsaSIsIHtrZXk6IDF9KSwgbSgibGkiLCB7a2V5OiAyfSksIG0oImxpIiwge2tleTogNH0pLCBtKCJsaSIsIHtrZXk6IDV9KV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5tYXAoZnVuY3Rpb24obikge3JldHVybiBuLmtleX0pLmpvaW4oIiIpID09ICIwMTI0NSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xOTQKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIsIHtrZXk6IDB9KSwgbSgibGkiLCB7a2V5OiAxfSksIG0oImxpIiwge2tleTogMn0pLCBtKCJsaSIsIHtrZXk6IDN9KSwgbSgibGkiLCB7a2V5OiA0fSksIG0oImxpIiwge2tleTogNX0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCB7a2V5OiAxfSksIG0oImxpIiwge2tleTogMn0pLCBtKCJsaSIsIHtrZXk6IDN9KSwgbSgibGkiLCB7a2V5OiA0fSksIG0oImxpIiwge2tleTogNX0pLCBtKCJsaSIsIHtrZXk6IDZ9KV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiwge2tleTogMTJ9KSwgbSgibGkiLCB7a2V5OiAxM30pLCBtKCJsaSIsIHtrZXk6IDE0fSksIG0oImxpIiwge2tleTogMTV9KSwgbSgibGkiLCB7a2V5OiAxNn0pLCBtKCJsaSIsIHtrZXk6IDE3fSldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubWFwKGZ1bmN0aW9uKG4pIHtyZXR1cm4gbi5rZXl9KS5qb2luKCIsIikgPT0gIjEyLDEzLDE0LDE1LDE2LDE3IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzIwNgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHVuZGVmaW5lZCkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImRpdiIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMjA2CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgbnVsbCkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImRpdiIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMjAwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgoJCXZhciB1bmxvYWRlZDEgPSBmYWxzZQoJCWZ1bmN0aW9uIHVubG9hZGFibGUxKGVsZW1lbnQsIGlzSW5pdCwgY29udGV4dCkgewoJCQljb250ZXh0Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQl1bmxvYWRlZDEgPSB0cnVlCgkJCX0KCQl9CgkJbS5yZW5kZXIocm9vdCwgWyBtKCJkaXYiLCB7Y29uZmlnOiB1bmxvYWRhYmxlMX0pIF0pCgkJbS5yZW5kZXIocm9vdCwgWyBdKQoKCQl2YXIgdW5sb2FkZWQyID0gZmFsc2UKCQlmdW5jdGlvbiB1bmxvYWRhYmxlMihlbGVtZW50LCBpc0luaXQsIGNvbnRleHQpIHsKCQkJY29udGV4dC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJdW5sb2FkZWQyID0gdHJ1ZQoJCQl9CgkJfQoJCW0ucmVuZGVyKHJvb3QsIFsgbSgiZGl2Iiwge2NvbmZpZzogdW5sb2FkYWJsZTJ9KSBdKQoJCW0ucmVuZGVyKHJvb3QsIFsgXSkKCgkJcmV0dXJuIHVubG9hZGVkMSA9PT0gdHJ1ZSAmJiB1bmxvYWRlZDIgPT09IHRydWUKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJkaXYuYmx1ZSIpXSkKCQltLnJlbmRlcihyb290LCBbbSgiZGl2LmdyZWVuIiwgW20oImRpdiIpXSksIG0oImRpdi5ibHVlIildKQoJCXJldHVybiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8yNzcKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQlmdW5jdGlvbiBGaWVsZCgpIHsKCQkJdGhpcy50YWcgPSAiZGl2IjsKCQkJdGhpcy5hdHRycyA9IHt9OwoJCQl0aGlzLmNoaWxkcmVuID0gImhlbGxvIjsKCQl9CgkJbS5yZW5kZXIocm9vdCwgbmV3IEZpZWxkKCkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiKV0pKQoJCXZhciBjaGFuZ2UgPSBmdW5jdGlvbigpIHsKCQkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBhcmd1bWVudHMpKQoJCX0KCQljaGFuZ2UobSgiYiIpKTsKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT0gIkIiCgl9KQoJLy9lbmQgbS5yZW5kZXIKCgkvL20ucmVkcmF3Cgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCXZhciBjb250cm9sbGVyCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5tb2R1bGUocm9vdCwgewoJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHtjb250cm9sbGVyID0gdGhpc30sCgkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHtyZXR1cm4gY3RybC52YWx1ZX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQl2YXIgdmFsdWVCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlCgkJY29udHJvbGxlci52YWx1ZSA9ICJmb28iCgkJbS5yZWRyYXcoKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQlyZXR1cm4gdmFsdWVCZWZvcmUgPT09ICIiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQl2YXIgY291bnQgPSAwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5tb2R1bGUocm9vdCwgewoJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQl2aWV3OiBmdW5jdGlvbihjdHJsKSB7CgkJCQljb3VudCsrCgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCW0ucmVkcmF3KCkgLy9zaG91bGQgcnVuIHN5bmNocm9ub3VzbHkKCgkJbS5yZWRyYXcoKSAvL3Jlc3Qgc2hvdWxkIHJ1biBhc3luY2hyb25vdXNseSBzaW5jZSB0aGV5J3JlIHNwYW1taW5nCgkJbS5yZWRyYXcoKQoJCW0ucmVkcmF3KCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gY291bnQgPT09IDMKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCXZhciBjb3VudCA9IDAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLm1vZHVsZShyb290LCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHsKCQkJCWNvdW50KysKCQkJfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJbS5yZWRyYXcodHJ1ZSkgLy9zaG91bGQgcnVuIHN5bmNocm9ub3VzbHkKCgkJbS5yZWRyYXcodHJ1ZSkgLy9mb3JjZWQgdG8gcnVuIHN5bmNocm9ub3VzbHkKCQltLnJlZHJhdyh0cnVlKQoJCW0ucmVkcmF3KHRydWUpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIGNvdW50ID09PSA1Cgl9KQoKCS8vbS5yb3V0ZQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0MSIsIHsKCQkJIi90ZXN0MSI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImZvbyJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QxIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5wYXRobmFtZSA9ICIvIgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAicGF0aG5hbWUiCgkJbS5yb3V0ZShyb290LCAiL3Rlc3QyIiwgewoJCQkiL3Rlc3QyIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5wYXRobmFtZSA9PSAiL3Rlc3QyIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5oYXNoID0gIiMiCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJoYXNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0MyIsIHsKCQkJIi90ZXN0MyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImZvbyJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uaGFzaCA9PSAiIy90ZXN0MyIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q0L2ZvbyIsIHsKCQkJIi90ZXN0NC86dGVzdCI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gbS5yb3V0ZS5wYXJhbSgidGVzdCIpfX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0NC9mb28iICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgbW9kdWxlID0ge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiBtLnJvdXRlLnBhcmFtKCJ0ZXN0Iil9fQoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0NS9mb28iLCB7CgkJCSIvIjogbW9kdWxlLAoJCQkiL3Rlc3Q1Lzp0ZXN0IjogbW9kdWxlCgkJfSkKCQl2YXIgcGFyYW1WYWx1ZUJlZm9yZSA9IG0ucm91dGUucGFyYW0oInRlc3QiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvIikKCQl2YXIgcGFyYW1WYWx1ZUFmdGVyID0gbS5yb3V0ZS5wYXJhbSgidGVzdCIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/LyIgJiYgcGFyYW1WYWx1ZUJlZm9yZSA9PT0gImZvbyIgJiYgcGFyYW1WYWx1ZUFmdGVyID09PSB1bmRlZmluZWQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciBtb2R1bGUgPSB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oImExIil9fQoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0Ni9mb28iLCB7CgkJCSIvIjogbW9kdWxlLAoJCQkiL3Rlc3Q2LzphMSI6IG1vZHVsZQoJCX0pCgkJdmFyIHBhcmFtVmFsdWVCZWZvcmUgPSBtLnJvdXRlLnBhcmFtKCJhMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi8iKQoJCXZhciBwYXJhbVZhbHVlQWZ0ZXIgPSBtLnJvdXRlLnBhcmFtKCJhMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/LyIgJiYgcGFyYW1WYWx1ZUJlZm9yZSA9PT0gImZvbyIgJiYgcGFyYW1WYWx1ZUFmdGVyID09PSB1bmRlZmluZWQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy82MQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciBtb2R1bGUgPSB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oImExIil9fQoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0Ny9mb28iLCB7CgkJCSIvIjogbW9kdWxlLAoJCQkiL3Rlc3Q3LzphMSI6IG1vZHVsZQoJCX0pCgkJdmFyIHJvdXRlVmFsdWVCZWZvcmUgPSBtLnJvdXRlKCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiLyIpCgkJdmFyIHJvdXRlVmFsdWVBZnRlciA9IG0ucm91dGUoKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiByb3V0ZVZhbHVlQmVmb3JlID09PSAiL3Rlc3Q3L2ZvbyIgJiYgcm91dGVWYWx1ZUFmdGVyID09PSAiLyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q4L2Zvby9TRVAvYmFyL2JheiIsIHsKCQkJIi90ZXN0OC86dGVzdC9TRVAvOnBhdGguLi4iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKSArICJfIiArIG0ucm91dGUucGFyYW0oInBhdGgiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDgvZm9vL1NFUC9iYXIvYmF6IiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vX2Jhci9iYXoiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0OS9mb28vYmFyL1NFUC9iYXoiLCB7CgkJCSIvdGVzdDkvOnRlc3QuLi4vU0VQLzpwYXRoIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtLnJvdXRlLnBhcmFtKCJ0ZXN0IikgKyAiXyIgKyBtLnJvdXRlLnBhcmFtKCJwYXRoIikKCQkJCX0KCQkJfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3Q5L2Zvby9iYXIvU0VQL2JheiIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvby9iYXJfYmF6IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvdGVzdDEwL2ZvbyUyMGJhciIsIHsKCQkJIi90ZXN0MTAvOnRlc3QiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvbyBiYXIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19LAoJCQkiL3Rlc3QxMSI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MTEvIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDExLyIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImJhciIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7fX0sCgkJCSIvdGVzdDEyIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMj9hPWZvbyZiPWJhciIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QxMj9hPWZvbyZiPWJhciIgJiYgbS5yb3V0ZS5wYXJhbSgiYSIpID09ICJmb28iICYmIG0ucm91dGUucGFyYW0oImIiKSA9PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fSwKCQkJIi90ZXN0MTMvOnRlc3QiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKX19CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMy9mb28/dGVzdD1iYXIiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MTMvZm9vP3Rlc3Q9YmFyIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fSwKCQkJIi90ZXN0MTQiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuICJmb28ifX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDE0P3Rlc3QmdGVzdDI9IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDE0P3Rlc3QmdGVzdDI9IiAmJiBtLnJvdXRlLnBhcmFtKCJ0ZXN0IikgPT09IHRydWUgJiYgbS5yb3V0ZS5wYXJhbSgidGVzdDIiKSA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7fX0sCgkJCSIvdGVzdDEyIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMiIsIHthOiAiZm9vIiwgYjogImJhciJ9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MTI/YT1mb28mYj1iYXIiICYmIG0ucm91dGUucGFyYW0oImEiKSA9PSAiZm9vIiAmJiBtLnJvdXRlLnBhcmFtKCJiIikgPT0gImJhciIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciByb3V0ZTEsIHJvdXRlMgoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7cm91dGUxID0gbS5yb3V0ZSgpfSwgdmlldzogZnVuY3Rpb24oKSB7fX0sCgkJCSIvdGVzdDEzIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3JvdXRlMiA9IG0ucm91dGUoKX0sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMyIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHJvdXRlMSA9PSAiLyIgJiYgcm91dGUyID09ICIvdGVzdDEzIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIHsKCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QxNCI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHt9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MTQiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiB1bmxvYWRlZCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiKSwKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QxNSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gW20oImRpdiIpXQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCB7CgkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSkKCQkJCX0KCQkJfSwKCQkJIi90ZXN0MTYiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImEiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNiIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBbCgkJCQkJCW0oImRpdiIsIHsKCQkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9KQoJCQkJCV0KCQkJCX0KCQkJfSwKCQkJIi90ZXN0MTciOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImEiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNyIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCB7CgkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSkKCQkJCX0KCQkJfSwKCQkJIi90ZXN0MTgiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFttKCJhIildCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDE4IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFsKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJa2V5OiAxLAoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QyMCI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiLCB7CgkJCQkJCQlrZXk6IDIsCgkJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkKCQkJCQldCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDIwIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFsKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJa2V5OiAxLAoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QyMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiLCB7CgkJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkKCQkJCQldCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDIxIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvZm9vIiwgewoJCQkiL2ZvbyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2IiwgImZvbyIpOwoJCQkJfQoJCQl9LAoJCQkiL2JhciI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2IiwgImJhciIpOwoJCQkJfQoJCQl9LAoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCXZhciBmb28gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWU7CgkJbS5yb3V0ZSgiL2JhciIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJdmFyIGJhciA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZTsKCQlyZXR1cm4gKGZvbyA9PT0gImZvbyIgJiYgYmFyID09PSAiYmFyIikKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQl2YXIgY29uZmlnID0gZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCXVubG9hZGVkKysKCQkJfQoJCX0KCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi9mb28xIiwgewoJCQkiL2ZvbzEiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIG0oImEiLCB7Y29uZmlnOiBjb25maWd9LCAiZm9vIikpOwoJCQkJfQoJCQl9LAoJCQkiL2JhcjEiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oIm1haW4iLCBtKCJhIiwge2NvbmZpZzogY29uZmlnfSwgImZvbyIpKTsKCQkJCX0KCQkJfSwKCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvYmFyMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciBzdHJhdGVneQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL2ZvbzEiLCB7CgkJCSIvZm9vMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkgewoJCQkJCXN0cmF0ZWd5ID0gbS5yZWRyYXcuc3RyYXRlZ3koKQoJCQkJCW0ucmVkcmF3LnN0cmF0ZWd5KCJub25lIikKCQkJCX0sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2Iik7CgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBzdHJhdGVneSA9PSAiYWxsIiAmJiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDAKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciBzdHJhdGVneSwgY291bnQgPSAwCgkJdmFyIGNvbmZpZyA9IGZ1bmN0aW9uKGVsLCBpbml0KSB7aWYgKCFpbml0KSBjb3VudCsrfQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL2ZvbzEiLCB7CgkJCSIvZm9vMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2Iiwge2NvbmZpZzogY29uZmlnfSk7CgkJCQl9CgkJCX0sCgkJCSIvYmFyMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkgewoJCQkJCXN0cmF0ZWd5ID0gbS5yZWRyYXcuc3RyYXRlZ3koKQoJCQkJCW0ucmVkcmF3LnN0cmF0ZWd5KCJyZWRyYXciKQoJCQkJfSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCB7Y29uZmlnOiBjb25maWd9KTsKCQkJCX0KCQkJfSwKCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvYmFyMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHN0cmF0ZWd5ID09ICJhbGwiICYmIGNvdW50ID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciBzdHJhdGVneQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL2ZvbzEiLCB7CgkJCSIvZm9vMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3RoaXMubnVtYmVyID0gMX0sCgkJCQl2aWV3OiBmdW5jdGlvbihjdHJsKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIHtvbmNsaWNrOiBmdW5jdGlvbigpIHsKCQkJCQkJc3RyYXRlZ3kgPSBtLnJlZHJhdy5zdHJhdGVneSgpCgkJCQkJCWN0cmwubnVtYmVyKysKCQkJCQkJbS5yZWRyYXcuc3RyYXRlZ3koIm5vbmUiKQoJCQkJCX19LCBjdHJsLm51bWJlcik7CgkJCQl9CgkJCX0KCQl9KQoJCXJvb3QuY2hpbGROb2Rlc1swXS5vbmNsaWNrKHt9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBzdHJhdGVneSA9PSAiZGlmZiIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09ICIxIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIGNvdW50ID0gMAoJCXZhciBjb25maWcgPSBmdW5jdGlvbihlbCwgaW5pdCApIHtpZiAoIWluaXQpIGNvdW50Kyt9CgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvZm9vMSIsIHsKCQkJIi9mb28xIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHsKCQkJCQlyZXR1cm4gbSgiZGl2Iiwge2NvbmZpZzogY29uZmlnLCBvbmNsaWNrOiBmdW5jdGlvbigpIHsKCQkJCQkJbS5yZWRyYXcuc3RyYXRlZ3koImFsbCIpCgkJCQkJfX0pOwoJCQkJfQoJCQl9CgkJfSkKCQlyb290LmNoaWxkTm9kZXNbMF0ub25jbGljayh7fSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gY291bnQgPT0gMgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHZhbHVlCgkJbS5yb3V0ZShyb290LCAiL2ZvbytiYXIiLCB7CgkJCSIvOmFyZyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3ZhbHVlID0gbS5yb3V0ZS5wYXJhbSgiYXJnIil9LAoJCQkJdmlldzogZnVuY3Rpb24oY3RybCkgewoJCQkJCXJldHVybiAiIgoJCQkJfQoJCQl9CgkJfSkKCQlyZXR1cm4gdmFsdWUgPT0gImZvbytiYXIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19LAoJCQkiL3Rlc3QyMiI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoU3RyaW5nKCIvdGVzdDIyLyIpKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MjIvIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImZvbyJ9fSwKCQkJIi90ZXN0MjMiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuICJiYXIifX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKG5ldyBTdHJpbmcoIi90ZXN0MjMvIikpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QyMy8iICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJiYXIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdmFsdWUKCQltLnJvdXRlKHJvb3QsIFN0cmluZygiL2ZvbytiYXIiKSwgewoJCQkiLzphcmciOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt2YWx1ZSA9IG0ucm91dGUucGFyYW0oImFyZyIpfSwKCQkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHsKCQkJCQlyZXR1cm4gIiIKCQkJCX0KCQkJfQoJCX0pCgkJcmV0dXJuIHZhbHVlID09ICJmb28rYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHZhbHVlCgkJbS5yb3V0ZShyb290LCBuZXcgU3RyaW5nKCIvZm9vK2JhciIpLCB7CgkJCSIvOmFyZyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3ZhbHVlID0gbS5yb3V0ZS5wYXJhbSgiYXJnIil9LAoJCQkJdmlldzogZnVuY3Rpb24oY3RybCkgewoJCQkJCXJldHVybiAiIgoJCQkJfQoJCQl9CgkJfSkKCQlyZXR1cm4gdmFsdWUgPT0gImZvbytiYXIiCgl9KQoJLy9lbmQgbS5yb3V0ZQoKCS8vbS5wcm9wCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5wcm9wKCJ0ZXN0IikKCQlyZXR1cm4gcHJvcCgpID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5wcm9wKCJ0ZXN0IikKCQlwcm9wKCJmb28iKQoJCXJldHVybiBwcm9wKCkgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcHJvcCA9IG0ucHJvcCgidGVzdCIpCgkJcmV0dXJuIEpTT04uc3RyaW5naWZ5KHByb3ApID09PSAnInRlc3QiJwoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIG9iaiA9IHtwcm9wOiBtLnByb3AoInRlc3QiKX0KCQlyZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqKSA9PT0gJ3sicHJvcCI6InRlc3QifScKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBkZWZlciA9IG0uZGVmZXJyZWQoKQoJCXZhciBwcm9wID0gbS5wcm9wKGRlZmVyLnByb21pc2UpCgkJZGVmZXIucmVzb2x2ZSgidGVzdCIpCgoJCXJldHVybiBwcm9wKCkgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGRlZmVyID0gbS5kZWZlcnJlZCgpCgkJdmFyIHByb3AgPSBtLnByb3AoZGVmZXIucHJvbWlzZSkudGhlbihmdW5jdGlvbiAoKSB7CgkJCXJldHVybiAidGVzdDIiCgkJfSkKCQlkZWZlci5yZXNvbHZlKCJ0ZXN0IikKCgkJcmV0dXJuIHByb3AoKSA9PT0gInRlc3QyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHByb3AgPSBtLnByb3AobnVsbCkKCQlyZXR1cm4gcHJvcCgpID09PSBudWxsCgl9KQoKCS8vbS5yZXF1ZXN0Cgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJHRVQiLCB1cmw6ICJ0ZXN0In0pCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKS5tZXRob2QgPT09ICJHRVQiICYmIHByb3AoKS51cmwgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHByb3AgPSBtLnJlcXVlc3Qoe21ldGhvZDogIkdFVCIsIHVybDogInRlc3QifSkudGhlbihmdW5jdGlvbih2YWx1ZSkge3JldHVybiAiZm9vIn0pCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJQT1NUIiwgdXJsOiAiaHR0cDovL2RvbWFpbi5jb206ODAiLCBkYXRhOiB7fX0pLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtyZXR1cm4gdmFsdWV9KQoJCW1vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKS5vbnJlYWR5c3RhdGVjaGFuZ2UoKQoJCXJldHVybiBwcm9wKCkudXJsID09PSAiaHR0cDovL2RvbWFpbi5jb206ODAiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcHJvcCA9IG0ucmVxdWVzdCh7bWV0aG9kOiAiUE9TVCIsIHVybDogImh0dHA6Ly9kb21haW4uY29tOjgwLzp0ZXN0MSIsIGRhdGE6IHt0ZXN0MTogImZvbyJ9fSkudGhlbihmdW5jdGlvbih2YWx1ZSkge3JldHVybiB2YWx1ZX0pCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKS51cmwgPT09ICJodHRwOi8vZG9tYWluLmNvbTo4MC9mb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZXJyb3IgPSBtLnByb3AoIm5vIGVycm9yIikKCQl2YXIgcHJvcCA9IG0ucmVxdWVzdCh7bWV0aG9kOiAiR0VUIiwgdXJsOiAidGVzdCIsIGRlc2VyaWFsaXplOiBmdW5jdGlvbigpIHt0aHJvdyBuZXcgRXJyb3IoImVycm9yIG9jY3VycmVkIil9fSkudGhlbihudWxsLCBlcnJvcikKCQltb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkub25yZWFkeXN0YXRlY2hhbmdlKCkKCQlyZXR1cm4gcHJvcCgpLm1lc3NhZ2UgPT09ICJlcnJvciBvY2N1cnJlZCIgJiYgZXJyb3IoKS5tZXNzYWdlID09PSAiZXJyb3Igb2NjdXJyZWQiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZXJyb3IgPSBtLnByb3AoIm5vIGVycm9yIiksIGV4Y2VwdGlvbgoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJHRVQiLCB1cmw6ICJ0ZXN0IiwgZGVzZXJpYWxpemU6IGZ1bmN0aW9uKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoImVycm9yIG9jY3VycmVkIil9fSkudGhlbihudWxsLCBlcnJvcikKCQl0cnkge21vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKS5vbnJlYWR5c3RhdGVjaGFuZ2UoKX0KCQljYXRjaCAoZSkge2V4Y2VwdGlvbiA9IGV9CgkJbS5lbmRDb21wdXRhdGlvbigpCgkJcmV0dXJuIHByb3AoKSA9PT0gdW5kZWZpbmVkICYmIGVycm9yKCkgPT09ICJubyBlcnJvciIgJiYgZXhjZXB0aW9uLm1lc3NhZ2UgPT0gImVycm9yIG9jY3VycmVkIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGVycm9yID0gbS5wcm9wKCJubyBlcnJvciIpCgkJdmFyIHByb3AgPSBtLnJlcXVlc3Qoe21ldGhvZDogIlBPU1QiLCB1cmw6ICJ0ZXN0IiwgZGF0YToge2ZvbzogMX19KS50aGVuKG51bGwsIGVycm9yKQoJCXZhciB4aHIgPSBtb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkKCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlKCkKCQlyZXR1cm4geGhyLiRoZWFkZXJzWyJDb250ZW50LVR5cGUiXSA9PSAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBlcnJvciA9IG0ucHJvcCgibm8gZXJyb3IiKQoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJQT1NUIiwgdXJsOiAidGVzdCJ9KS50aGVuKG51bGwsIGVycm9yKQoJCXZhciB4aHIgPSBtb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkKCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlKCkKCQlyZXR1cm4geGhyLiRoZWFkZXJzWyJDb250ZW50LVR5cGUiXSA9PT0gdW5kZWZpbmVkCgl9KQoKCS8vIG0ucmVxdWVzdCBvdmVyIGpzb25wCgl0ZXN0KGZ1bmN0aW9uKCl7CgkJLy8gc2NyaXB0IHRhZ3MgY2Fubm90IGJlIGFwcGVuZGVkIGRpcmVjdGx5IG9uIHRoZSBkb2N1bWVudAoJCXZhciBib2R5ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJib2R5Iik7CgkJbW9jay5kb2N1bWVudC5ib2R5ID0gYm9keTsKCQltb2NrLmRvY3VtZW50LmFwcGVuZENoaWxkKGJvZHkpOwoKCQl2YXIJZXJyb3IgPSBtLnByb3AoIm5vIGVycm9yIik7CgkJdmFyIGRhdGEKCQl2YXIgcmVxID0gbS5yZXF1ZXN0KHt1cmw6ICIvdGVzdCIsIGRhdGFUeXBlOiAianNvbnAifSkudGhlbihmdW5jdGlvbihyZWNlaXZlZCkge2RhdGEgPSByZWNlaXZlZH0sIGVycm9yKTsKCQl2YXIgY2FsbGJhY2tLZXkgPSBPYmplY3Qua2V5cyhtb2NrKS5maWx0ZXIoZnVuY3Rpb24oZ2xvYmFsS2V5KXsKCQkJcmV0dXJuIGdsb2JhbEtleS5pbmRleE9mKCJtaXRocmlsX2NhbGxiYWNrIikgPiAtMQoJCX0pLnBvcCgpOwoJCXZhciBzY3JpcHRUYWcgPSBbXS5zbGljZS5jYWxsKG1vY2suZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpKS5maWx0ZXIoZnVuY3Rpb24oc2NyaXB0KXsKCQkJcmV0dXJuIHNjcmlwdC5zcmMuaW5kZXhPZihjYWxsYmFja0tleSkgPiAtMQoJCX0pLnBvcCgpOwoJCW1vY2tbY2FsbGJhY2tLZXldKHtmb286ICJiYXIifSkKCQltb2NrLmRvY3VtZW50LnJlbW92ZUNoaWxkKGJvZHkpOwoJCXJldHVybiBzY3JpcHRUYWcuc3JjLmluZGV4T2YoIi90ZXN0P2NhbGxiYWNrPW1pdGhyaWxfY2FsbGJhY2siKSA+IC0xICYmIGRhdGEuZm9vID09ICJiYXIiOwoJfSkKCXRlc3QoZnVuY3Rpb24oKXsKCQkvLyBzY3JpcHQgdGFncyBjYW5ub3QgYmUgYXBwZW5kZWQgZGlyZWN0bHkgb24gdGhlIGRvY3VtZW50CgkJdmFyIGJvZHkgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJvZHkiKTsKCQltb2NrLmRvY3VtZW50LmJvZHkgPSBib2R5OwoJCW1vY2suZG9jdW1lbnQuYXBwZW5kQ2hpbGQoYm9keSk7CgoJCXZhcgllcnJvciA9IG0ucHJvcCgibm8gZXJyb3IiKTsKCQl2YXIgZGF0YQoJCXZhciByZXEgPSBtLnJlcXVlc3Qoe3VybDogIi90ZXN0IiwgZGF0YVR5cGU6ICJqc29ucCIsIGNhbGxiYWNrS2V5OiAianNvbnBDYWxsYmFjayJ9KS50aGVuKGZ1bmN0aW9uKHJlY2VpdmVkKSB7ZGF0YSA9IHJlY2VpdmVkfSwgZXJyb3IpOwoJCXZhciBjYWxsYmFja0tleSA9IE9iamVjdC5rZXlzKG1vY2spLmZpbHRlcihmdW5jdGlvbihnbG9iYWxLZXkpewoJCQlyZXR1cm4gZ2xvYmFsS2V5LmluZGV4T2YoIm1pdGhyaWxfY2FsbGJhY2siKSA+IC0xCgkJfSkucG9wKCk7CgkJdmFyIHNjcmlwdFRhZyA9IFtdLnNsaWNlLmNhbGwobW9jay5kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IikpLmZpbHRlcihmdW5jdGlvbihzY3JpcHQpewoJCQlyZXR1cm4gc2NyaXB0LnNyYy5pbmRleE9mKGNhbGxiYWNrS2V5KSA+IC0xCgkJfSkucG9wKCk7CgkJbW9ja1tjYWxsYmFja0tleV0oe2ZvbzogImJhcjEifSkKCQltb2NrLmRvY3VtZW50LnJlbW92ZUNoaWxkKGJvZHkpOwoJCXJldHVybiBzY3JpcHRUYWcuc3JjLmluZGV4T2YoIi90ZXN0P2pzb25wQ2FsbGJhY2s9bWl0aHJpbF9jYWxsYmFjayIpID4gLTEgJiYgZGF0YS5mb28gPT0gImJhcjEiOwoJfSkKCXRlc3QoZnVuY3Rpb24oKXsKCQl2YXIgYm9keSA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYm9keSIpOwoJCW1vY2suZG9jdW1lbnQuYm9keSA9IGJvZHk7CgkJbW9jay5kb2N1bWVudC5hcHBlbmRDaGlsZChib2R5KTsKCgkJdmFyIF93aW5kb3cgPSBtb2NrOwoJCXZhciByZXEgPSBtLnJlcXVlc3QoewoJCQl1cmw6ICIvdGVzdCIsCgkJCWRhdGFUeXBlOiAianNvbnAiLAoJCQliYWNrZ3JvdW5kOiB0cnVlCgkJfSk7CgkJdmFyIGNhbGxiYWNrS2V5cyA9IFtdOwoJCU9iamVjdC5rZXlzKF93aW5kb3cpLmZvckVhY2goZnVuY3Rpb24oZ2xvYmFsS2V5KXsKCQkJaWYoZ2xvYmFsS2V5LmluZGV4T2YoIm1pdGhyaWxfY2FsbGJhY2siKSA+IC0xKQoJCQkJY2FsbGJhY2tLZXlzLnB1c2goZ2xvYmFsS2V5KTsKCQl9KTsKCQl2YXIgc2NyaXB0VGFnID0gbnVsbDsKCQltb2NrLmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKS5mb3JFYWNoKGZ1bmN0aW9uKHNjcmlwdCl7CgkJCWlmKCFzY3JpcHRUYWcgJiYgc2NyaXB0LnNyYy5pbmRleE9mKGNhbGxiYWNrS2V5c1swXSkgPiAtMSkKCQkJCXNjcmlwdFRhZyA9IHNjcmlwdDsKCQl9KTsKCQl2YXIgb3V0ID0geyBmb286ICJiYXIiIH07CgkJaWYoc2NyaXB0VGFnICYmIGNhbGxiYWNrS2V5cy5sZW5ndGggPiAwKXsKCQkJX3dpbmRvd1tjYWxsYmFja0tleXNbMF1dKG91dCk7CgkJCW1vY2suZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JpcHRUYWcpOwoJCQlkZWxldGUgX3dpbmRvd1tjYWxsYmFja0tleXNbMF1dOwoJCX0KCQltb2NrLmRvY3VtZW50LnJlbW92ZUNoaWxkKGJvZHkpOwoJCXJldHVybiBKU09OLnN0cmluZ2lmeShvdXQpID09PSBKU09OLnN0cmluZ2lmeShyZXEoKSk7Cgl9KQoJdGVzdChmdW5jdGlvbigpewoJCXZhciBib2R5ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJib2R5Iik7CgkJbW9jay5kb2N1bWVudC5ib2R5ID0gYm9keTsKCQltb2NrLmRvY3VtZW50LmFwcGVuZENoaWxkKGJvZHkpOwoKCQl2YXIgX3dpbmRvdyA9IG1vY2s7CgkJdmFyIGVycm9yID0gbS5wcm9wKGZhbHNlKTsKCQl2YXIgcmVxID0gbS5yZXF1ZXN0KHsKCQkJdXJsOiAiL3Rlc3QiLAoJCQlkYXRhVHlwZTogImpzb25wIiwKCQkJZGF0YTogeyBmb286ICJiYXIiIH0sCgkJCWJhY2tncm91bmQ6IHRydWUKCQl9KTsKCQl2YXIgY2FsbGJhY2tLZXlzID0gW107CgkJT2JqZWN0LmtleXMoX3dpbmRvdykuZm9yRWFjaChmdW5jdGlvbihnbG9iYWxLZXkpewoJCQlpZihnbG9iYWxLZXkuaW5kZXhPZigibWl0aHJpbF9jYWxsYmFjayIpID4gLTEpCgkJCQljYWxsYmFja0tleXMucHVzaChnbG9iYWxLZXkpOwoJCX0pOwoJCXZhciBzY3JpcHRUYWcgPSBudWxsOwoJCW1vY2suZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpLmZvckVhY2goZnVuY3Rpb24oc2NyaXB0KXsKCQkJaWYoIXNjcmlwdFRhZyAmJiBzY3JpcHQuc3JjLmluZGV4T2YoY2FsbGJhY2tLZXlzWzBdKSA+IC0xKQoJCQkJc2NyaXB0VGFnID0gc2NyaXB0OwoJCX0pOwoJCXZhciBjb3JyZWN0RGF0YSA9IGZhbHNlOwoJCWlmKHNjcmlwdFRhZyl7CgkJCWNvcnJlY3REYXRhID0gc2NyaXB0VGFnLnNyYy5pbmRleE9mKCJmb289YmFyIikgPiAtMTsKCQkJbW9jay5kb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHNjcmlwdFRhZyk7CgkJCWRlbGV0ZSBfd2luZG93W2NhbGxiYWNrS2V5c1swXV07CgkJfQoJCW1vY2suZG9jdW1lbnQucmVtb3ZlQ2hpbGQoYm9keSk7CgkJcmV0dXJuIGNvcnJlY3REYXRhOwoJfSkKCgkvL20uZGVmZXJyZWQKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkLnJlc29sdmUoInRlc3QiKQoJCXJldHVybiB2YWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgdmFsdWUKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkge3JldHVybiAiZm9vIn0pLnRoZW4oZnVuY3Rpb24oZGF0YSkge3ZhbHVlID0gZGF0YX0pCgkJZGVmZXJyZWQucmVzb2x2ZSgidGVzdCIpCgkJcmV0dXJuIHZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkLnJlamVjdCgidGVzdCIpCgkJcmV0dXJuIHZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihudWxsLCBmdW5jdGlvbihkYXRhKSB7cmV0dXJuICJmb28ifSkudGhlbihmdW5jdGlvbihkYXRhKSB7dmFsdWUgPSBkYXRhfSkKCQlkZWZlcnJlZC5yZWplY3QoInRlc3QiKQoJCXJldHVybiB2YWx1ZSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZTEsIHZhbHVlMgoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7dGhyb3cgbmV3IEVycm9yfSkudGhlbihmdW5jdGlvbihkYXRhKSB7dmFsdWUxID0gMX0sIGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZTIgPSBkYXRhfSkKCQlkZWZlcnJlZC5yZXNvbHZlKCJ0ZXN0IikKCQlyZXR1cm4gdmFsdWUxID09PSB1bmRlZmluZWQgJiYgdmFsdWUyIGluc3RhbmNlb2YgRXJyb3IKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vTGV0IHVuY2hlY2tlZCBleGNlcHRpb25zIGJ1YmJsZSB1cCBpbiBvcmRlciB0byBhbGxvdyBtZWFuaW5nZnVsIGVycm9yIG1lc3NhZ2VzIGluIGNvbW1vbiBjYXNlcyBsaWtlIG51bGwgcmVmZXJlbmNlIGV4Y2VwdGlvbnMgZHVlIHRvIHR5cG9zCgkJLy9BbiB1bmNoZWNrZWQgZXhjZXB0aW9uIGlzIGRlZmluZWQgYXMgYW4gb2JqZWN0IHRoYXQgaXMgYSBzdWJjbGFzcyBvZiBFcnJvciAoYnV0IG5vdCBhIGRpcmVjdCBpbnN0YW5jZSBvZiBFcnJvciBpdHNlbGYpIC0gYmFzaWNhbGx5IGFueXRoaW5nIHRoYXQgY2FuIGJlIHRocm93biB3aXRob3V0IGFuIGV4cGxpY2l0IGB0aHJvd2Aga2V5d29yZCBhbmQgdGhhdCB3ZSdkIG5ldmVyIHdhbnQgdG8gcHJvZ3JhbW1hdGljYWxseSBtYW5pcHVsYXRlLiBJbiBvdGhlciB3b3JkcywgYW4gdW5jaGVja2VkIGVycm9yIGlzIG9uZSB3aGVyZSB3ZSBvbmx5IGNhcmUgYWJvdXQgaXRzIGxpbmUgbnVtYmVyIGFuZCB3aGVyZSB0aGUgb25seSByZWFzb25hYmxlIHdheSB0byBkZWFsIHdpdGggaXQgaXMgdG8gY2hhbmdlIHRoZSBidWdneSBzb3VyY2UgY29kZSB0aGF0IGNhdXNlZCB0aGUgZXJyb3IgdG8gYmUgdGhyb3duIGluIHRoZSBmaXJzdCBwbGFjZS4KCQkvL0J5IGNvbnRyYXN0LCBhIGNoZWNrZWQgZXhjZXB0aW9uIGlzIGRlZmluZWQgYXMgYW55dGhpbmcgdGhhdCBpcyBleHBsaWNpdGx5IHRocm93biB2aWEgdGhlIGB0aHJvd2Aga2V5d29yZCBhbmQgdGhhdCBjYW4gYmUgcHJvZ3JhbW1hdGljYWxseSBoYW5kbGVkLCBmb3IgZXhhbXBsZSB0byBkaXNwbGF5IGEgdmFsaWRhdGlvbiBlcnJvciBtZXNzYWdlIG9uIHRoZSBVSS4gSWYgYW4gZXhjZXB0aW9uIGlzIGEgc3ViY2xhc3Mgb2YgRXJyb3IgZm9yIHdoYXRldmVyIHJlYXNvbiwgYnV0IGl0IGlzIG1lYW50IHRvIGJlIGhhbmRsZWQgYXMgYSBjaGVja2VkIGV4Y2VwdGlvbiAoaS5lLiBmb2xsb3cgdGhlIHJlamVjdGlvbiBydWxlcyBmb3IgQSspLCBpdCBjYW4gYmUgcmV0aHJvd24gYXMgYW4gaW5zdGFuY2Ugb2YgRXJyb3IKCQkvL1RoaXMgdGVzdCB0ZXN0cyB0d28gaW1wbGVtZW50YXRpb24gZGV0YWlscyB0aGF0IGRpZmZlciBmcm9tIHRoZSBQcm9taXNlcy9BKyBzcGVjOgoJCS8vMSkgQSsgcmVxdWlyZXMgdGhlIGB0aGVuYCBjYWxsYmFjayB0byBiZSBjYWxsZWQgaW4gYSBkaWZmZXJlbnQgZXZlbnQgbG9vcCBmcm9tIHRoZSByZXNvbHZlIGNhbGwsIGkuZS4gaXQgbXVzdCBiZSBhc3luY2hyb25vdXMgKHRoaXMgcmVxdWlyZXMgYSBzZXRJbW1lZGlhdGUgcG9seWZpbGwsIHdoaWNoIGNhbm5vdCBiZSBpbXBsZW1lbnRlZCBpbiBhIHJlYXNvbmFibGUgd2F5IGZvciBNaXRocmlsJ3MgcHVycG9zZSAtIHRoZSBwb3NzaWJsZSBwb2x5ZmlsbHMgYXJlIGVpdGhlciB0b28gYmlnIG9yIHRvbyBzbG93KQoJCS8vMikgQSsgc3dhbGxvd3MgZXhjZXB0aW9ucyBpbiBhIHVucmV0aHJvd2FibGUgd2F5LCBpLmUuIGl0J3Mgbm90IHBvc3NpYmxlIHRvIHNlZSBkZWZhdWx0IGVycm9yIG1lc3NhZ2VzIG9uIHRoZSBjb25zb2xlIGZvciBydW50aW1lIGVycm9ycyB0aHJvd24gZnJvbSB3aXRoaW4gYSBwcm9taXNlIGNoYWluCgkJdmFyIHZhbHVlMSwgdmFsdWUyLCB2YWx1ZTMKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQl0cnkgewoJCQlkZWZlcnJlZC5wcm9taXNlCgkJCQkudGhlbihmdW5jdGlvbihkYXRhKSB7Zm9vLmJhci5iYXp9KSAvL3Rocm93cyBSZWZlcmVuY2VFcnJvcgoJCQkJLnRoZW4oZnVuY3Rpb24oZGF0YSkge3ZhbHVlMSA9IDF9LCBmdW5jdGlvbihkYXRhKSB7dmFsdWUyID0gZGF0YX0pCgkJCWRlZmVycmVkLnJlc29sdmUoInRlc3QiKQoJCX0KCQljYXRjaCAoZSkge3ZhbHVlMyA9IGV9CgkJcmV0dXJuIHZhbHVlMSA9PT0gdW5kZWZpbmVkICYmIHZhbHVlMiA9PT0gdW5kZWZpbmVkICYmIHZhbHVlMyBpbnN0YW5jZW9mIFJlZmVyZW5jZUVycm9yCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZGVmZXJyZWQxID0gbS5kZWZlcnJlZCgpCgkJdmFyIGRlZmVycmVkMiA9IG0uZGVmZXJyZWQoKQoJCXZhciB2YWx1ZTEsIHZhbHVlMgoJCWRlZmVycmVkMS5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZTEgPSBkYXRhCgkJCXJldHVybiBkZWZlcnJlZDIucHJvbWlzZQoJCX0pLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZTIgPSBkYXRhCgkJfSkKCQlkZWZlcnJlZDEucmVzb2x2ZSgxKQoJCWRlZmVycmVkMi5yZXNvbHZlKDIpCgkJcmV0dXJuIHZhbHVlMSA9PT0gMSAmJiB2YWx1ZTIgPT09IDIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZXNvbHZlKDEpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSBkYXRhCgkJfSkKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZWplY3QoMSkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4obnVsbCwgZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IGRhdGEKCQl9KQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzgwCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlkZWZlcnJlZC5yZXNvbHZlKDIpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSBkYXRhCgkJfSkKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IGRhdGEKCQl9KQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlkZWZlcnJlZC5yZXNvbHZlKDIpCgkJcmV0dXJuIHZhbHVlID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvODAKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlMSwgdmFsdWUyCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUxID0gZGF0YQoJCX0sIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUyID0gZGF0YQoJCX0pCgkJZGVmZXJyZWQucmVzb2x2ZSgxKQoJCWRlZmVycmVkLnJlamVjdCgyKQoJCXJldHVybiB2YWx1ZTEgPT09IDEgJiYgdmFsdWUyID09PSB1bmRlZmluZWQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUxLCB2YWx1ZTIKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oKSB7CgkJCXZhbHVlMSA9IGRhdGEKCQl9LCBmdW5jdGlvbihkYXRhKSB7CgkJCXZhbHVlMiA9IGRhdGEKCQl9KQoJCWRlZmVycmVkLnJlamVjdCgxKQoJCWRlZmVycmVkLnJlc29sdmUoMikKCQlyZXR1cm4gdmFsdWUxID09PSB1bmRlZmluZWQgJiYgdmFsdWUyID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvODAKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSBkYXRhCgkJfSkKCQlkZWZlcnJlZC5yZWplY3QoMSkKCQlkZWZlcnJlZC5yZWplY3QoMikKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84NQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZXNvbHZlKCkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IDEKCQl9KQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzg1CgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlamVjdCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSAxCgkJfSkKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZXNvbHZlKDEpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCXZhciBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtyZXR1cm4gZGF0YSArIDF9KQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlyZXR1cm4gcHJvbWlzZSgpID09PSAyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlCgkJZGVmZXJyZWQucmVqZWN0KDEpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKSA9PT0gdW5kZWZpbmVkCgl9KQoKCS8vbS5zeW5jCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZDEgPSBtLmRlZmVycmVkKCkKCQl2YXIgZGVmZXJyZWQyID0gbS5kZWZlcnJlZCgpCgkJbS5zeW5jKFtkZWZlcnJlZDEucHJvbWlzZSwgZGVmZXJyZWQyLnByb21pc2VdKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkMS5yZXNvbHZlKCJ0ZXN0IikKCQlkZWZlcnJlZDIucmVzb2x2ZSgiZm9vIikKCQlyZXR1cm4gdmFsdWVbMF0gPT09ICJ0ZXN0IiAmJiB2YWx1ZVsxXSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZDEgPSBtLmRlZmVycmVkKCkKCQl2YXIgZGVmZXJyZWQyID0gbS5kZWZlcnJlZCgpCgkJbS5zeW5jKFtkZWZlcnJlZDEucHJvbWlzZSwgZGVmZXJyZWQyLnByb21pc2VdKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkMi5yZXNvbHZlKCJmb28iKQoJCWRlZmVycmVkMS5yZXNvbHZlKCJ0ZXN0IikKCQlyZXR1cm4gdmFsdWVbMF0gPT09ICJ0ZXN0IiAmJiB2YWx1ZVsxXSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZSA9IDEKCQltLnN5bmMoW10pLnRoZW4oZnVuY3Rpb24oKSB7dmFsdWUgPSAyfSkKCQlyZXR1cm4gdmFsdWUgPT0gMgoJfSkKCgkvL20uc3RhcnRDb21wdXRhdGlvbi9tLmVuZENvbXB1dGF0aW9uCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCgkJdmFyIGNvbnRyb2xsZXIKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLm1vZHVsZShyb290LCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge2NvbnRyb2xsZXIgPSB0aGlzfSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkge3JldHVybiBjdHJsLnZhbHVlfQoJCX0pCgoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCgkJbS5zdGFydENvbXB1dGF0aW9uKCkKCQljb250cm9sbGVyLnZhbHVlID0gImZvbyIKCQltLmVuZENvbXB1dGF0aW9uKCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCgkvL2NvbnNvbGUubG9nIHByZXNlbmNlCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXJldHVybiBtLmRlcHMuZmFjdG9yeS50b1N0cmluZygpLmluZGV4T2YoImNvbnNvbGUiKSA8IDAKCX0pCgoJLy8gY29uZmlnIGNvbnRleHQKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgoJCXZhciBzdWNjZXNzID0gZmFsc2U7CgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogZnVuY3Rpb24oZWxlbSwgaXNJbml0aWFsaXplZCwgY3R4KSB7Y3R4LmRhdGE9MX19KSk7CgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogZnVuY3Rpb24oZWxlbSwgaXNJbml0aWFsaXplZCwgY3R4KSB7c3VjY2VzcyA9IGN0eC5kYXRhPT09MX19KSk7CgkJcmV0dXJuIHN1Y2Nlc3M7Cgl9KQoKCS8vIG1vcmUgY29tcGxleCBjb25maWcgY29udGV4dAoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCgkJdmFyIGlkeCA9IDA7CgkJdmFyIHN1Y2Nlc3MgPSB0cnVlOwoJCXZhciBzdGF0ZWZ1bENvbmZpZyA9IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkge2N0eC5kYXRhPWlkeCsrfQoJCXZhciBub2RlID0gbSgiZGl2Iiwge2NvbmZpZzogc3RhdGVmdWxDb25maWd9KTsKCQltLnJlbmRlcihyb290LCBbbm9kZSwgbm9kZV0pOwoKCQlpZHggPSAwOwoJCXZhciBjaGVja0NvbmZpZyA9IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkgewoJCQlzdWNjZXNzID0gc3VjY2VzcyAmJiAoY3R4LmRhdGEgPT09IGlkeCsrKQoJCX0KCQlub2RlID0gbSgiZGl2Iiwge2NvbmZpZzogY2hlY2tDb25maWd9KTsKCQltLnJlbmRlcihyb290LCBbbm9kZSwgbm9kZV0pOwoJCXJldHVybiBzdWNjZXNzOwoJfSkKCn0KCi8vdGVzdCByZXBvcnRpbmcgZm9yIHNhdWNlbGFicwppZiAodHlwZW9mIHdpbmRvdyAhPSAidW5kZWZpbmVkIikgewoJd2luZG93Lmdsb2JhbF90ZXN0X3Jlc3VsdHMgPSB7CgkJdGVzdHM6IFtdLAoJCWR1cmF0aW9uOiAwLAoJCXBhc3NlZDogMCwKCQlmYWlsZWQ6IDAKCX07Cn0KCi8vbW9jawp0ZXN0TWl0aHJpbChtb2NrLndpbmRvdyk7Cgp0ZXN0LnByaW50KGZ1bmN0aW9uKHZhbHVlKSB7Y29uc29sZS5sb2codmFsdWUpfSkK",
                "body": "TWl0aHJpbCA9IG0gPSBuZXcgZnVuY3Rpb24gYXBwKHdpbmRvdywgdW5kZWZpbmVkKSB7Cgl2YXIgc09iaiA9ICJbb2JqZWN0IE9iamVjdF0iLCBzQXJyID0gIltvYmplY3QgQXJyYXldIiwgc1N0ciA9ICJbb2JqZWN0IFN0cmluZ10iCglmdW5jdGlvbiB0eXBlKG9iaikge3JldHVybiB7fS50b1N0cmluZy5jYWxsKG9iail9CglmdW5jdGlvbiBpc09iaihvYmopIHtyZXR1cm4gdHlwZShvYmopID09IHNPYmp9CglmdW5jdGlvbiBpc0FycihvYmopIHtyZXR1cm4gdHlwZShvYmopID09IHNBcnJ9CglmdW5jdGlvbiBpc0ZuKG9iaikge3JldHVybiB0eXBlb2Ygb2JqID09ICJmdW5jdGlvbiJ9CglmdW5jdGlvbiBpc1N0cihvYmopeyByZXR1cm4gdHlwZShvYmopID09IHNTdHJ9Cgl2YXIgcGFyc2VyID0gLyg/OihefCN8XC4pKFteI1wuXFtcXV0rKSl8KFxbLis/XF0pL2csIGF0dHJQYXJzZXIgPSAvXFsoLis/KSg/Oj0oInwnfCkoLio/KVwyKT9cXS8KCXZhciB2b2lkRWxlbWVudHMgPSAvQVJFQXxCQVNFfEJSfENPTHxDT01NQU5EfEVNQkVEfEhSfElNR3xJTlBVVHxLRVlHRU58TElOS3xNRVRBfFBBUkFNfFNPVVJDRXxUUuKAjOKAi0FDS3xXQlIvCgoJLyoKCSAqIEB0eXBlZGVmIHtTdHJpbmd9IFRhZwoJICogQSBzdHJpbmcgdGhhdCBsb29rcyBsaWtlIC0+IGRpdi5jbGFzc25hbWUjaWRbcGFyYW09b25lXVtwYXJhbTI9dHdvXQoJICogV2hpY2ggZGVzY3JpYmVzIGEgRE9NIG5vZGUKCSAqLwoKCS8qCgkgKgoJICogQHBhcmFtIHtUYWd9IFRoZSBET00gbm9kZSB0YWcKCSAqIEBwYXJhbSB7T2JqZWN0PVtdfSBvcHRpb25hbCBrZXktdmFsdWUgcGFpcnMgdG8gYmUgbWFwcGVkIHRvIERPTSBhdHRycwoJICogQHBhcmFtIHsuLi5tTm9kZT1bXX0gWmVybyBvciBtb3JlIE1pdGhyaWwgY2hpbGQgbm9kZXMuIENhbiBiZSBhbiBhcnJheSwgb3Igc3BsYXQgKG9wdGlvbmFsKQoJICoKCSAqLwoJZnVuY3Rpb24gbSgpIHsKCQl2YXIgYXJyU2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CgkJdmFyIGFyZ3MgPSBhcnJTbGljZS5jYWxsKGFyZ3VtZW50cywgMCkKCQl2YXIgaGFzQXR0cnMgPSBhcmdzWzFdICE9IG51bGwgJiYgaXNPYmooYXJnc1sxXSkgJiYgISgidGFnIiBpbiBhcmdzWzFdKSAmJiAhKCJzdWJ0cmVlIiBpbiBhcmdzWzFdKQoJCXZhciBhdHRycyA9IGhhc0F0dHJzID8gYXJnc1sxXSA6IHt9CgkJdmFyIGNsYXNzQXR0ck5hbWUgPSAiY2xhc3MiIGluIGF0dHJzID8gImNsYXNzIiA6ICJjbGFzc05hbWUiCgkJdmFyIGNlbGwgPSB7dGFnOiAiZGl2IiwgYXR0cnM6IHt9fQoJCXZhciBtYXRjaCwgY2xhc3NlcyA9IFtdCgkJd2hpbGUgKG1hdGNoID0gcGFyc2VyLmV4ZWMoYXJnc1swXSkpIHsKCQkJaWYgKG1hdGNoWzFdID09ICIiKSBjZWxsLnRhZyA9IG1hdGNoWzJdCgkJCWVsc2UgaWYgKG1hdGNoWzFdID09ICIjIikgY2VsbC5hdHRycy5pZCA9IG1hdGNoWzJdCgkJCWVsc2UgaWYgKG1hdGNoWzFdID09ICIuIikgY2xhc3Nlcy5wdXNoKG1hdGNoWzJdKQoJCQllbHNlIGlmIChtYXRjaFszXVswXSA9PSAiWyIpIHsKCQkJCXZhciBwYWlyID0gYXR0clBhcnNlci5leGVjKG1hdGNoWzNdKQoJCQkJY2VsbC5hdHRyc1twYWlyWzFdXSA9IHBhaXJbM10gfHwgKHBhaXJbMl0gPyAiIiA6dHJ1ZSkKCQkJfQoJCX0KCQlpZiAoY2xhc3Nlcy5sZW5ndGggPiAwKSBjZWxsLmF0dHJzW2NsYXNzQXR0ck5hbWVdID0gY2xhc3Nlcy5qb2luKCIgIikKCgoJCXZhciBjaGlsZHJlbiA9IGhhc0F0dHJzID8gYXJnc1syXSA6IGFyZ3NbMV0KCQlpZiAoaXNBcnIoY2hpbGRyZW4pIHx8IHR5cGUoY2hpbGRyZW4pID09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSB7CgkJCWNlbGwuY2hpbGRyZW4gPSBhcnJTbGljZS5jYWxsKGNoaWxkcmVuLCAwKQoJCX0KCQllbHNlIHsKCQkJY2VsbC5jaGlsZHJlbiA9IGhhc0F0dHJzID8gYXJncy5zbGljZSgyKSA6IGFyZ3Muc2xpY2UoMSkKCQl9CgoJCWZvciAodmFyIGF0dHJOYW1lIGluIGF0dHJzKSB7CgkJCWlmIChhdHRyTmFtZSA9PSBjbGFzc0F0dHJOYW1lKSBjZWxsLmF0dHJzW2F0dHJOYW1lXSA9IChjZWxsLmF0dHJzW2F0dHJOYW1lXSB8fCAiIikgKyAiICIgKyBhdHRyc1thdHRyTmFtZV0KCQkJZWxzZSBjZWxsLmF0dHJzW2F0dHJOYW1lXSA9IGF0dHJzW2F0dHJOYW1lXQoJCX0KCQlyZXR1cm4gY2VsbAoJfQoJZnVuY3Rpb24gYnVpbGQocGFyZW50RWxlbWVudCwgcGFyZW50VGFnLCBwYXJlbnRDYWNoZSwgcGFyZW50SW5kZXgsIGRhdGEsIGNhY2hlZCwgc2hvdWxkUmVhdHRhY2gsIGluZGV4LCBlZGl0YWJsZSwgbmFtZXNwYWNlLCBjb25maWdzKSB7CgkJLy9gYnVpbGRgIGlzIGEgcmVjdXJzaXZlIGZ1bmN0aW9uIHRoYXQgbWFuYWdlcyBjcmVhdGlvbi9kaWZmaW5nL3JlbW92YWwgb2YgRE9NIGVsZW1lbnRzIGJhc2VkIG9uIGNvbXBhcmlzb24gYmV0d2VlbiBgZGF0YWAgYW5kIGBjYWNoZWRgCgkJLy90aGUgZGlmZiBhbGdvcml0aG0gY2FuIGJlIHN1bW1hcml6ZWQgYXMgdGhpczoKCQkvLzEgLSBjb21wYXJlIGBkYXRhYCBhbmQgYGNhY2hlZGAKCQkvLzIgLSBpZiB0aGV5IGFyZSBkaWZmZXJlbnQsIGNvcHkgYGRhdGFgIHRvIGBjYWNoZWRgIGFuZCB1cGRhdGUgdGhlIERPTSBiYXNlZCBvbiB3aGF0IHRoZSBkaWZmZXJlbmNlIGlzCgkJLy8zIC0gcmVjdXJzaXZlbHkgYXBwbHkgdGhpcyBhbGdvcml0aG0gZm9yIGV2ZXJ5IGFycmF5IGFuZCBmb3IgdGhlIGNoaWxkcmVuIG9mIGV2ZXJ5IHZpcnR1YWwgZWxlbWVudAoKCQkvL3RoZSBgY2FjaGVkYCBkYXRhIHN0cnVjdHVyZSBpcyBlc3NlbnRpYWxseSB0aGUgc2FtZSBhcyB0aGUgcHJldmlvdXMgcmVkcmF3J3MgYGRhdGFgIGRhdGEgc3RydWN0dXJlLCB3aXRoIGEgZmV3IGFkZGl0aW9uczoKCQkvLy0gYGNhY2hlZGAgYWx3YXlzIGhhcyBhIHByb3BlcnR5IGNhbGxlZCBgbm9kZXNgLCB3aGljaCBpcyBhIGxpc3Qgb2YgRE9NIGVsZW1lbnRzIHRoYXQgY29ycmVzcG9uZCB0byB0aGUgZGF0YSByZXByZXNlbnRlZCBieSB0aGUgcmVzcGVjdGl2ZSB2aXJ0dWFsIGVsZW1lbnQKCQkvLy0gaW4gb3JkZXIgdG8gc3VwcG9ydCBhdHRhY2hpbmcgYG5vZGVzYCBhcyBhIHByb3BlcnR5IG9mIGBjYWNoZWRgLCBgY2FjaGVkYCBpcyAqYWx3YXlzKiBhIG5vbi1wcmltaXRpdmUgb2JqZWN0LCBpLmUuIGlmIHRoZSBkYXRhIHdhcyBhIHN0cmluZywgdGhlbiBjYWNoZWQgaXMgYSBTdHJpbmcgaW5zdGFuY2UuIElmIGRhdGEgd2FzIGBudWxsYCBvciBgdW5kZWZpbmVkYCwgY2FjaGVkIGlzIGBuZXcgU3RyaW5nKCIiKWAKCQkvLy0gYGNhY2hlZCBhbHNvIGhhcyBhIGBjb25maWdDb250ZXh0YCBwcm9wZXJ0eSwgd2hpY2ggaXMgdGhlIHN0YXRlIHN0b3JhZ2Ugb2JqZWN0IGV4cG9zZWQgYnkgY29uZmlnKGVsZW1lbnQsIGlzSW5pdGlhbGl6ZWQsIGNvbnRleHQpCgkJLy8tIHdoZW4gYGNhY2hlZGAgaXMgYW4gT2JqZWN0LCBpdCByZXByZXNlbnRzIGEgdmlydHVhbCBlbGVtZW50OyB3aGVuIGl0J3MgYW4gQXJyYXksIGl0IHJlcHJlc2VudHMgYSBsaXN0IG9mIGVsZW1lbnRzOyB3aGVuIGl0J3MgYSBTdHJpbmcsIE51bWJlciBvciBCb29sZWFuLCBpdCByZXByZXNlbnRzIGEgdGV4dCBub2RlCgoJCS8vYHBhcmVudEVsZW1lbnRgIGlzIGEgRE9NIGVsZW1lbnQgdXNlZCBmb3IgVzNDIERPTSBBUEkgY2FsbHMKCQkvL2BwYXJlbnRUYWdgIGlzIG9ubHkgdXNlZCBmb3IgaGFuZGxpbmcgYSBjb3JuZXIgY2FzZSBmb3IgdGV4dGFyZWEgdmFsdWVzCgkJLy9gcGFyZW50Q2FjaGVgIGlzIHVzZWQgdG8gcmVtb3ZlIG5vZGVzIGluIHNvbWUgbXVsdGktbm9kZSBjYXNlcwoJCS8vYHBhcmVudEluZGV4YCBhbmQgYGluZGV4YCBhcmUgdXNlZCB0byBmaWd1cmUgb3V0IHRoZSBvZmZzZXQgb2Ygbm9kZXMuIFRoZXkncmUgYXJ0aWZhY3RzIGZyb20gYmVmb3JlIGFycmF5cyBzdGFydGVkIGJlaW5nIGZsYXR0ZW5lZCBhbmQgYXJlIGxpa2VseSByZWZhY3RvcmFibGUKCQkvL2BkYXRhYCBhbmQgYGNhY2hlZGAgYXJlLCByZXNwZWN0aXZlbHksIHRoZSBuZXcgYW5kIG9sZCBub2RlcyBiZWluZyBkaWZmZWQKCQkvL2BzaG91bGRSZWF0dGFjaGAgaXMgYSBmbGFnIGluZGljYXRpbmcgd2hldGhlciBhIHBhcmVudCBub2RlIHdhcyByZWNyZWF0ZWQgKGlmIHNvLCBhbmQgaWYgdGhpcyBub2RlIGlzIHJldXNlZCwgdGhlbiB0aGlzIG5vZGUgbXVzdCByZWF0dGFjaCBpdHNlbGYgdG8gdGhlIG5ldyBwYXJlbnQpCgkJLy9gZWRpdGFibGVgIGlzIGEgZmxhZyB0aGF0IGluZGljYXRlcyB3aGV0aGVyIGFuIGFuY2VzdG9yIGlzIGNvbnRlbnRlZGl0YWJsZQoJCS8vYG5hbWVzcGFjZWAgaW5kaWNhdGVzIHRoZSBjbG9zZXN0IEhUTUwgbmFtZXNwYWNlIGFzIGl0IGNhc2NhZGVzIGRvd24gZnJvbSBhbiBhbmNlc3RvcgoJCS8vYGNvbmZpZ3NgIGlzIGEgbGlzdCBvZiBjb25maWcgZnVuY3Rpb25zIHRvIHJ1biBhZnRlciB0aGUgdG9wbW9zdCBgYnVpbGRgIGNhbGwgZmluaXNoZXMgcnVubmluZwoKCQkvL3RoZXJlJ3MgbG9naWMgdGhhdCByZWxpZXMgb24gdGhlIGFzc3VtcHRpb24gdGhhdCBudWxsIGFuZCB1bmRlZmluZWQgZGF0YSBhcmUgZXF1aXZhbGVudCB0byBlbXB0eSBzdHJpbmdzCgkJLy8tIHRoaXMgcHJldmVudHMgbGlmZWN5Y2xlIHN1cnByaXNlcyBmcm9tIHByb2NlZHVyYWwgaGVscGVycyB0aGF0IG1peCBpbXBsaWNpdCBhbmQgZXhwbGljaXQgcmV0dXJuIHN0YXRlbWVudHMKCQkvLy0gaXQgc2ltcGxpZmllcyBkaWZmaW5nIGNvZGUKCQlpZiAoZGF0YSA9PSBudWxsKSBkYXRhID0gIiIKCQlpZiAoZGF0YS5zdWJ0cmVlID09PSAicmV0YWluIikgcmV0dXJuIGNhY2hlZAoJCXZhciBjYWNoZWRUeXBlID0gdHlwZShjYWNoZWQpLCBkYXRhVHlwZSA9IHR5cGUoZGF0YSkKCQlpZiAoY2FjaGVkID09IG51bGwgfHwgY2FjaGVkVHlwZSAhPSBkYXRhVHlwZSkgewoJCQlpZiAoY2FjaGVkICE9IG51bGwpIHsKCQkJCWlmIChwYXJlbnRDYWNoZSAmJiBwYXJlbnRDYWNoZS5ub2RlcykgewoJCQkJCXZhciBvZmZzZXQgPSBpbmRleCAtIHBhcmVudEluZGV4CgkJCQkJdmFyIGVuZCA9IG9mZnNldCArIChkYXRhVHlwZSA9PSBzQXJyID8gZGF0YSA6IGNhY2hlZC5ub2RlcykubGVuZ3RoCgkJCQkJY2xlYXIocGFyZW50Q2FjaGUubm9kZXMuc2xpY2Uob2Zmc2V0LCBlbmQpLCBwYXJlbnRDYWNoZS5zbGljZShvZmZzZXQsIGVuZCkpCgkJCQl9CgkJCQllbHNlIGlmIChjYWNoZWQubm9kZXMpIGNsZWFyKGNhY2hlZC5ub2RlcywgY2FjaGVkKQoJCQl9CgkJCWNhY2hlZCA9IG5ldyBkYXRhLmNvbnN0cnVjdG9yCgkJCWlmIChjYWNoZWQudGFnKSBjYWNoZWQgPSB7fSAvL2lmIGNvbnN0cnVjdG9yIGNyZWF0ZXMgYSB2aXJ0dWFsIGRvbSBlbGVtZW50LCB1c2UgYSBibGFuayBvYmplY3QgYXMgdGhlIGJhc2UgY2FjaGVkIG5vZGUgaW5zdGVhZCBvZiBjb3B5aW5nIHRoZSB2aXJ0dWFsIGVsICgjMjc3KQoJCQljYWNoZWQubm9kZXMgPSBbXQoJCX0KCgkJaWYgKGRhdGFUeXBlID09IHNBcnIpIHsKCQkJZGF0YSA9IGZsYXR0ZW4oZGF0YSkKCQkJdmFyIG5vZGVzID0gW10sIGludGFjdCA9IGNhY2hlZC5sZW5ndGggPT09IGRhdGEubGVuZ3RoLCBzdWJBcnJheUNvdW50ID0gMAoKCQkJLy9rZXlzIGFsZ29yaXRobTogc29ydCBlbGVtZW50cyB3aXRob3V0IHJlY3JlYXRpbmcgdGhlbSBpZiBrZXlzIGFyZSBwcmVzZW50CgkJCS8vMSkgY3JlYXRlIGEgbWFwIG9mIGFsbCBleGlzdGluZyBrZXlzLCBhbmQgbWFyayBhbGwgZm9yIGRlbGV0aW9uCgkJCS8vMikgYWRkIG5ldyBrZXlzIHRvIG1hcCBhbmQgbWFyayB0aGVtIGZvciBhZGRpdGlvbgoJCQkvLzMpIGlmIGtleSBleGlzdHMgaW4gbmV3IGxpc3QsIGNoYW5nZSBhY3Rpb24gZnJvbSBkZWxldGlvbiB0byBhIG1vdmUKCQkJLy80KSBmb3IgZWFjaCBrZXksIGhhbmRsZSBpdHMgY29ycmVzcG9uZGluZyBhY3Rpb24gYXMgbWFya2VkIGluIHByZXZpb3VzIHN0ZXBzCgkJCS8vNSkgY29weSB1bmtleWVkIGl0ZW1zIGludG8gdGhlaXIgcmVzcGVjdGl2ZSBnYXBzCgkJCXZhciBERUxFVElPTiA9IDEsIElOU0VSVElPTiA9IDIgLCBNT1ZFID0gMwoJCQl2YXIgZXhpc3RpbmcgPSB7fSwgdW5rZXllZCA9IFtdLCBzaG91bGRNYWludGFpbklkZW50aXRpZXMgPSBmYWxzZQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGNhY2hlZC5sZW5ndGg7IGkrKykgewoJCQkJaWYgKGNhY2hlZFtpXSAmJiBjYWNoZWRbaV0uYXR0cnMgJiYgY2FjaGVkW2ldLmF0dHJzLmtleSAhPSBudWxsKSB7CgkJCQkJc2hvdWxkTWFpbnRhaW5JZGVudGl0aWVzID0gdHJ1ZQoJCQkJCWV4aXN0aW5nW2NhY2hlZFtpXS5hdHRycy5rZXldID0ge2FjdGlvbjogREVMRVRJT04sIGluZGV4OiBpfQoJCQkJfQoJCQl9CgkJCWlmIChzaG91bGRNYWludGFpbklkZW50aXRpZXMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChkYXRhW2ldICYmIGRhdGFbaV0uYXR0cnMpIHsKCQkJCQkJaWYgKGRhdGFbaV0uYXR0cnMua2V5ICE9IG51bGwpIHsKCQkJCQkJCXZhciBrZXkgPSBkYXRhW2ldLmF0dHJzLmtleQoJCQkJCQkJaWYgKCFleGlzdGluZ1trZXldKSBleGlzdGluZ1trZXldID0ge2FjdGlvbjogSU5TRVJUSU9OLCBpbmRleDogaX0KCQkJCQkJCWVsc2UgZXhpc3Rpbmdba2V5XSA9IHsKCQkJCQkJCQlhY3Rpb246IE1PVkUsCgkJCQkJCQkJaW5kZXg6IGksCgkJCQkJCQkJZnJvbTogZXhpc3Rpbmdba2V5XS5pbmRleCwKCQkJCQkJCQllbGVtZW50OiBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbZXhpc3Rpbmdba2V5XS5pbmRleF0gfHwgd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZSB1bmtleWVkLnB1c2goe2luZGV4OiBpLCBlbGVtZW50OiBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaV0gfHwgd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpfSkKCQkJCQl9CgkJCQl9CgkJCQl2YXIgYWN0aW9ucyA9IE9iamVjdC5rZXlzKGV4aXN0aW5nKS5tYXAoZnVuY3Rpb24oa2V5KSB7cmV0dXJuIGV4aXN0aW5nW2tleV19KQoJCQkJdmFyIGNoYW5nZXMgPSBhY3Rpb25zLnNvcnQoZnVuY3Rpb24oYSwgYikge3JldHVybiBhLmFjdGlvbiAtIGIuYWN0aW9uIHx8IGEuaW5kZXggLSBiLmluZGV4fSkKCQkJCXZhciBuZXdDYWNoZWQgPSBjYWNoZWQuc2xpY2UoKQoKCQkJCWZvciAodmFyIGkgPSAwLCBjaGFuZ2U7IGNoYW5nZSA9IGNoYW5nZXNbaV07IGkrKykgewoJCQkJCWlmIChjaGFuZ2UuYWN0aW9uID09IERFTEVUSU9OKSB7CgkJCQkJCWNsZWFyKGNhY2hlZFtjaGFuZ2UuaW5kZXhdLm5vZGVzLCBjYWNoZWRbY2hhbmdlLmluZGV4XSkKCQkJCQkJbmV3Q2FjaGVkLnNwbGljZShjaGFuZ2UuaW5kZXgsIDEpCgkJCQkJfQoJCQkJCWlmIChjaGFuZ2UuYWN0aW9uID09IElOU0VSVElPTikgewoJCQkJCQl2YXIgZHVtbXkgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQkJCQkJZHVtbXkua2V5ID0gZGF0YVtjaGFuZ2UuaW5kZXhdLmF0dHJzLmtleQoJCQkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShkdW1teSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2NoYW5nZS5pbmRleF0pCgkJCQkJCW5ld0NhY2hlZC5zcGxpY2UoY2hhbmdlLmluZGV4LCAwLCB7YXR0cnM6IHtrZXk6IGRhdGFbY2hhbmdlLmluZGV4XS5hdHRycy5rZXl9LCBub2RlczogW2R1bW15XX0pCgkJCQkJfQoKCQkJCQlpZiAoY2hhbmdlLmFjdGlvbiA9PSBNT1ZFKSB7CgkJCQkJCWlmIChwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSAhPT0gY2hhbmdlLmVsZW1lbnQgJiYgY2hhbmdlLmVsZW1lbnQgIT09IG51bGwpIHsKCQkJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGNoYW5nZS5lbGVtZW50LCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSkKCQkJCQkJfQoJCQkJCQluZXdDYWNoZWRbY2hhbmdlLmluZGV4XSA9IGNhY2hlZFtjaGFuZ2UuZnJvbV0KCQkJCQl9CgkJCQl9CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHVua2V5ZWQubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgY2hhbmdlID0gdW5rZXllZFtpXQoJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGNoYW5nZS5lbGVtZW50LCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSkKCQkJCQluZXdDYWNoZWRbY2hhbmdlLmluZGV4XSA9IGNhY2hlZFtjaGFuZ2UuaW5kZXhdCgkJCQl9CgkJCQljYWNoZWQgPSBuZXdDYWNoZWQKCQkJCWNhY2hlZC5ub2RlcyA9IFtdCgkJCQlmb3IgKHZhciBpID0gMCwgY2hpbGQ7IGNoaWxkID0gcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2ldOyBpKyspIGNhY2hlZC5ub2Rlcy5wdXNoKGNoaWxkKQoJCQl9CgkJCS8vZW5kIGtleSBhbGdvcml0aG0KCgkJCWZvciAodmFyIGkgPSAwLCBjYWNoZUNvdW50ID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJCS8vZGlmZiBlYWNoIGl0ZW0gaW4gdGhlIGFycmF5CgkJCQl2YXIgaXRlbSA9IGJ1aWxkKHBhcmVudEVsZW1lbnQsIHBhcmVudFRhZywgY2FjaGVkLCBpbmRleCwgZGF0YVtpXSwgY2FjaGVkW2NhY2hlQ291bnRdLCBzaG91bGRSZWF0dGFjaCwgaW5kZXggKyBzdWJBcnJheUNvdW50IHx8IHN1YkFycmF5Q291bnQsIGVkaXRhYmxlLCBuYW1lc3BhY2UsIGNvbmZpZ3MpCgkJCQlpZiAoaXRlbSA9PT0gdW5kZWZpbmVkKSBjb250aW51ZQoJCQkJaWYgKCFpdGVtLm5vZGVzLmludGFjdCkgaW50YWN0ID0gZmFsc2UKCQkJCXN1YkFycmF5Q291bnQgKz0gaXNBcnIoaXRlbSkgPyBpdGVtLmxlbmd0aCA6IDEKCQkJCWNhY2hlZFtjYWNoZUNvdW50KytdID0gaXRlbQoJCQl9CgkJCWlmICghaW50YWN0KSB7CgkJCQkvL2RpZmYgdGhlIGFycmF5IGl0c2VsZgoKCQkJCS8vdXBkYXRlIHRoZSBsaXN0IG9mIERPTSBub2RlcyBieSBjb2xsZWN0aW5nIHRoZSBub2RlcyBmcm9tIGVhY2ggaXRlbQoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKGNhY2hlZFtpXSAhPSBudWxsKSBub2RlcyA9IG5vZGVzLmNvbmNhdChjYWNoZWRbaV0ubm9kZXMpCgkJCQl9CgkJCQkvL3JlbW92ZSBpdGVtcyBmcm9tIHRoZSBlbmQgb2YgdGhlIGFycmF5IGlmIHRoZSBuZXcgYXJyYXkgaXMgc2hvcnRlciB0aGFuIHRoZSBvbGQgb25lCgkJCQkvL2lmIGVycm9ycyBldmVyIGhhcHBlbiBoZXJlLCB0aGUgaXNzdWUgaXMgbW9zdCBsaWtlbHkgYSBidWcgaW4gdGhlIGNvbnN0cnVjdGlvbiBvZiB0aGUgYGNhY2hlZGAgZGF0YSBzdHJ1Y3R1cmUgc29tZXdoZXJlIGVhcmxpZXIgaW4gdGhlIHByb2dyYW0KCQkJCWZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gY2FjaGVkLm5vZGVzW2ldOyBpKyspIHsKCQkJCQlpZiAobm9kZS5wYXJlbnROb2RlICE9IG51bGwgJiYgbm9kZXMuaW5kZXhPZihub2RlKSA8IDApIGNsZWFyKFtub2RlXSwgW2NhY2hlZFtpXV0pCgkJCQl9CgkJCQkvL2FkZCBpdGVtcyB0byB0aGUgZW5kIGlmIHRoZSBuZXcgYXJyYXkgaXMgbG9uZ2VyIHRoYW4gdGhlIG9sZCBvbmUKCQkJCWZvciAodmFyIGkgPSBjYWNoZWQubm9kZXMubGVuZ3RoLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykgewoJCQkJCWlmIChub2RlLnBhcmVudE5vZGUgPT0gbnVsbCkgcGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChub2RlKQoJCQkJfQoJCQkJaWYgKGRhdGEubGVuZ3RoIDwgY2FjaGVkLmxlbmd0aCkgY2FjaGVkLmxlbmd0aCA9IGRhdGEubGVuZ3RoCgkJCQljYWNoZWQubm9kZXMgPSBub2RlcwoJCQl9CgkJfQoJCWVsc2UgaWYgKGRhdGEgIT0gbnVsbCAmJiBkYXRhVHlwZSA9PSBzT2JqKSB7CgkJCS8vaWYgYW4gZWxlbWVudCBpcyBkaWZmZXJlbnQgZW5vdWdoIGZyb20gdGhlIG9uZSBpbiBjYWNoZSwgcmVjcmVhdGUgaXQKCQkJaWYgKGRhdGEudGFnICE9IGNhY2hlZC50YWcgfHwgT2JqZWN0LmtleXMoZGF0YS5hdHRycykuam9pbigpICE9IE9iamVjdC5rZXlzKGNhY2hlZC5hdHRycykuam9pbigpIHx8IGRhdGEuYXR0cnMuaWQgIT0gY2FjaGVkLmF0dHJzLmlkKSB7CgkJCQljbGVhcihjYWNoZWQubm9kZXMpCgkJCQlpZiAoY2FjaGVkLmNvbmZpZ0NvbnRleHQgJiYgaXNGbihjYWNoZWQuY29uZmlnQ29udGV4dC5vbnVubG9hZCkpIGNhY2hlZC5jb25maWdDb250ZXh0Lm9udW5sb2FkKCkKCQkJfQoJCQlpZiAoIWlzU3RyKGRhdGEudGFnKSkgcmV0dXJuCgoJCQl2YXIgbm9kZSwgaXNOZXcgPSBjYWNoZWQubm9kZXMubGVuZ3RoID09PSAwCgkJCWlmIChkYXRhLmF0dHJzLnhtbG5zKSBuYW1lc3BhY2UgPSBkYXRhLmF0dHJzLnhtbG5zCgkJCWVsc2UgaWYgKGRhdGEudGFnID09PSAic3ZnIikgbmFtZXNwYWNlID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgoJCQllbHNlIGlmIChkYXRhLnRhZyA9PT0gIm1hdGgiKSBuYW1lc3BhY2UgPSAiaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCIKCQkJaWYgKGlzTmV3KSB7CgkJCQlub2RlID0gbmFtZXNwYWNlID09PSB1bmRlZmluZWQgPyB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudChkYXRhLnRhZykgOiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZSwgZGF0YS50YWcpCgkJCQljYWNoZWQgPSB7CgkJCQkJdGFnOiBkYXRhLnRhZywKCQkJCQkvL3Byb2Nlc3MgY2hpbGRyZW4gYmVmb3JlIGF0dHJzIHNvIHRoYXQgc2VsZWN0LnZhbHVlIHdvcmtzIGNvcnJlY3RseQoJCQkJCWNoaWxkcmVuOiBidWlsZChub2RlLCBkYXRhLnRhZywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGRhdGEuY2hpbGRyZW4sIGNhY2hlZC5jaGlsZHJlbiwgdHJ1ZSwgMCwgZGF0YS5hdHRycy5jb250ZW50ZWRpdGFibGUgPyBub2RlIDogZWRpdGFibGUsIG5hbWVzcGFjZSwgY29uZmlncyksCgkJCQkJYXR0cnM6IHNldEF0dHJpYnV0ZXMobm9kZSwgZGF0YS50YWcsIGRhdGEuYXR0cnMsIHt9LCBuYW1lc3BhY2UpLAoJCQkJCW5vZGVzOiBbbm9kZV0KCQkJCX0KCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gfHwgbnVsbCkKCQkJfQoJCQllbHNlIHsKCQkJCW5vZGUgPSBjYWNoZWQubm9kZXNbMF0KCQkJCXNldEF0dHJpYnV0ZXMobm9kZSwgZGF0YS50YWcsIGRhdGEuYXR0cnMsIGNhY2hlZC5hdHRycywgbmFtZXNwYWNlKQoJCQkJY2FjaGVkLmNoaWxkcmVuID0gYnVpbGQobm9kZSwgZGF0YS50YWcsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBkYXRhLmNoaWxkcmVuLCBjYWNoZWQuY2hpbGRyZW4sIGZhbHNlLCAwLCBkYXRhLmF0dHJzLmNvbnRlbnRlZGl0YWJsZSA/IG5vZGUgOiBlZGl0YWJsZSwgbmFtZXNwYWNlLCBjb25maWdzKQoJCQkJY2FjaGVkLm5vZGVzLmludGFjdCA9IHRydWUKCQkJCWlmIChzaG91bGRSZWF0dGFjaCA9PT0gdHJ1ZSAmJiBub2RlICE9IG51bGwpIHBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gfHwgbnVsbCkKCQkJfQoJCQkvL3NjaGVkdWxlIGNvbmZpZ3MgdG8gYmUgY2FsbGVkLiBUaGV5IGFyZSBjYWxsZWQgYWZ0ZXIgYGJ1aWxkYCBmaW5pc2hlcyBydW5uaW5nCgkJCWlmIChpc0ZuKGRhdGEuYXR0cnNbImNvbmZpZyJdKSkgewoJCQkJdmFyIGNvbnRleHQgPSBjYWNoZWQuY29uZmlnQ29udGV4dCA9IGNhY2hlZC5jb25maWdDb250ZXh0IHx8IHt9CgoJCQkJLy8gYmluZAoJCQkJdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24oZGF0YSwgYXJncykgewoJCQkJCXJldHVybiBmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIGRhdGEuYXR0cnNbImNvbmZpZyJdLmFwcGx5KGRhdGEsIGFyZ3MpCgkJCQkJfQoJCQkJfQoJCQkJY29uZmlncy5wdXNoKGNhbGxiYWNrKGRhdGEsIFtub2RlLCAhaXNOZXcsIGNvbnRleHQsIGNhY2hlZF0pKQoJCQl9CgkJfQoJCWVsc2UgaWYgKCFpc0ZuKGRhdGFUeXBlKSkgewoJCQkvL2hhbmRsZSB0ZXh0IG5vZGVzCgkJCXZhciBub2RlcwoJCQlpZiAoY2FjaGVkLm5vZGVzLmxlbmd0aCA9PT0gMCkgewoJCQkJaWYgKGRhdGEuJHRydXN0ZWQpIHsKCQkJCQlub2RlcyA9IGluamVjdEhUTUwocGFyZW50RWxlbWVudCwgaW5kZXgsIGRhdGEpCgkJCQl9CgkJCQllbHNlIHsKCQkJCQlub2RlcyA9IFt3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF0YSldCgkJCQkJaWYgKCFwYXJlbnRFbGVtZW50Lm5vZGVOYW1lLm1hdGNoKHZvaWRFbGVtZW50cykpIHBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGVzWzBdLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCQl9CgkJCQljYWNoZWQgPSAic3RyaW5nIG51bWJlciBib29sZWFuIi5pbmRleE9mKHR5cGVvZiBkYXRhKSA+IC0xID8gbmV3IGRhdGEuY29uc3RydWN0b3IoZGF0YSkgOiBkYXRhCgkJCQljYWNoZWQubm9kZXMgPSBub2RlcwoJCQl9CgkJCWVsc2UgaWYgKGNhY2hlZC52YWx1ZU9mKCkgIT09IGRhdGEudmFsdWVPZigpIHx8IHNob3VsZFJlYXR0YWNoID09PSB0cnVlKSB7CgkJCQlub2RlcyA9IGNhY2hlZC5ub2RlcwoJCQkJaWYgKCFlZGl0YWJsZSB8fCBlZGl0YWJsZSAhPT0gd2luZG93LmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHsKCQkJCQlpZiAoZGF0YS4kdHJ1c3RlZCkgewoJCQkJCQljbGVhcihub2RlcywgY2FjaGVkKQoJCQkJCQlub2RlcyA9IGluamVjdEhUTUwocGFyZW50RWxlbWVudCwgaW5kZXgsIGRhdGEpCgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQkvL2Nvcm5lciBjYXNlOiByZXBsYWNpbmcgdGhlIG5vZGVWYWx1ZSBvZiBhIHRleHQgbm9kZSB0aGF0IGlzIGEgY2hpbGQgb2YgYSB0ZXh0YXJlYS9jb250ZW50ZWRpdGFibGUgZG9lc24ndCB3b3JrCgkJCQkJCS8vd2UgbmVlZCB0byB1cGRhdGUgdGhlIHZhbHVlIHByb3BlcnR5IG9mIHRoZSBwYXJlbnQgdGV4dGFyZWEgb3IgdGhlIGlubmVySFRNTCBvZiB0aGUgY29udGVudGVkaXRhYmxlIGVsZW1lbnQgaW5zdGVhZAoJCQkJCQlpZiAocGFyZW50VGFnID09PSAidGV4dGFyZWEiKSBwYXJlbnRFbGVtZW50LnZhbHVlID0gZGF0YQoJCQkJCQllbHNlIGlmIChlZGl0YWJsZSkgZWRpdGFibGUuaW5uZXJIVE1MID0gZGF0YQoJCQkJCQllbHNlIHsKCQkJCQkJCWlmIChub2Rlc1swXS5ub2RlVHlwZSA9PSAxIHx8IG5vZGVzLmxlbmd0aCA+IDEpIHsgLy93YXMgYSB0cnVzdGVkIHN0cmluZwoJCQkJCQkJCWNsZWFyKGNhY2hlZC5ub2RlcywgY2FjaGVkKQoJCQkJCQkJCW5vZGVzID0gW3dpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhKV0KCQkJCQkJCX0KCQkJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGVzWzBdLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCQkJCQlub2Rlc1swXS5ub2RlVmFsdWUgPSBkYXRhCgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQljYWNoZWQgPSBuZXcgZGF0YS5jb25zdHJ1Y3RvcihkYXRhKQoJCQkJY2FjaGVkLm5vZGVzID0gbm9kZXMKCQkJfQoJCQllbHNlIGNhY2hlZC5ub2Rlcy5pbnRhY3QgPSB0cnVlCgkJfQoKCQlyZXR1cm4gY2FjaGVkCgl9CglmdW5jdGlvbiBzZXRBdHRyaWJ1dGVzKG5vZGUsIHRhZywgZGF0YUF0dHJzLCBjYWNoZWRBdHRycywgbmFtZXNwYWNlKSB7CgkJZm9yICh2YXIgYXR0ck5hbWUgaW4gZGF0YUF0dHJzKSB7CgkJCXZhciBkYXRhQXR0ciA9IGRhdGFBdHRyc1thdHRyTmFtZV0KCQkJdmFyIGNhY2hlZEF0dHIgPSBjYWNoZWRBdHRyc1thdHRyTmFtZV0KCQkJaWYgKCEoYXR0ck5hbWUgaW4gY2FjaGVkQXR0cnMpIHx8IChjYWNoZWRBdHRyICE9PSBkYXRhQXR0cikpIHsKCQkJCWNhY2hlZEF0dHJzW2F0dHJOYW1lXSA9IGRhdGFBdHRyCgkJCQl0cnkgewoJCQkJCS8vYGNvbmZpZ2AgaXNuJ3QgYSByZWFsIGF0dHJpYnV0ZXMsIHNvIGlnbm9yZSBpdAoJCQkJCS8vd2UgZG9uJ3QgaWdub3JlIGBrZXlgIGJlY2F1c2UgaXQgbXVzdCBiZSB1bmlxdWUgYW5kIGhhdmluZyBpdCBvbiB0aGUgRE9NIGhlbHBzIGRlYnVnZ2luZwoJCQkJCWlmIChhdHRyTmFtZSA9PT0gImNvbmZpZyIpIGNvbnRpbnVlCgkJCQkJLy9ob29rIGV2ZW50IGhhbmRsZXJzIHRvIHRoZSBhdXRvLXJlZHJhd2luZyBzeXN0ZW0KCQkJCQllbHNlIGlmIChpc0ZuKGRhdGFBdHRyKSAmJiBhdHRyTmFtZS5pbmRleE9mKCJvbiIpID09IDApIHsKCQkJCQkJbm9kZVthdHRyTmFtZV0gPSBhdXRvcmVkcmF3KGRhdGFBdHRyLCBub2RlKQoJCQkJCX0KCQkJCQkvL2hhbmRsZSBgc3R5bGU6IHsuLi59YAoJCQkJCWVsc2UgaWYgKGF0dHJOYW1lID09PSAic3R5bGUiICYmIGlzT2JqKGRhdGFBdHRyKSkgewoJCQkJCQlmb3IgKHZhciBydWxlIGluIGRhdGFBdHRyKSB7CgkJCQkJCQlpZiAoY2FjaGVkQXR0ciA9PSBudWxsIHx8IGNhY2hlZEF0dHJbcnVsZV0gIT09IGRhdGFBdHRyW3J1bGVdKSBub2RlLnN0eWxlW3J1bGVdID0gZGF0YUF0dHJbcnVsZV0KCQkJCQkJfQoJCQkJCQlmb3IgKHZhciBydWxlIGluIGNhY2hlZEF0dHIpIHsKCQkJCQkJCWlmICghKHJ1bGUgaW4gZGF0YUF0dHIpKSBub2RlLnN0eWxlW3J1bGVdID0gIiIKCQkJCQkJfQoJCQkJCX0KCQkJCQkvL2hhbmRsZSBTVkcKCQkJCQllbHNlIGlmIChuYW1lc3BhY2UgIT0gbnVsbCkgewoJCQkJCQlpZiAoYXR0ck5hbWUgPT09ICJocmVmIikgbm9kZS5zZXRBdHRyaWJ1dGVOUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsICJocmVmIiwgZGF0YUF0dHIpCgkJCQkJCWVsc2UgaWYgKGF0dHJOYW1lID09PSAiY2xhc3NOYW1lIikgbm9kZS5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgZGF0YUF0dHIpCgkJCQkJCWVsc2Ugbm9kZS5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIGRhdGFBdHRyKQoJCQkJCX0KCQkJCQkvL2hhbmRsZSBjYXNlcyB0aGF0IGFyZSBwcm9wZXJ0aWVzIChidXQgaWdub3JlIGNhc2VzIHdoZXJlIHdlIHNob3VsZCB1c2Ugc2V0QXR0cmlidXRlIGluc3RlYWQpCgkJCQkJLy8tIGxpc3QgYW5kIGZvcm0gYXJlIHR5cGljYWxseSB1c2VkIGFzIHN0cmluZ3MsIGJ1dCBhcmUgRE9NIGVsZW1lbnQgcmVmZXJlbmNlcyBpbiBqcwoJCQkJCS8vLSB3aGVuIHVzaW5nIENTUyBzZWxlY3RvcnMgKGUuZy4gYG0oIltzdHlsZT0nJ10iKWApLCBzdHlsZSBpcyB1c2VkIGFzIGEgc3RyaW5nLCBidXQgaXQncyBhbiBvYmplY3QgaW4ganMKCQkJCQllbHNlIGlmIChhdHRyTmFtZSBpbiBub2RlICYmICEoYXR0ck5hbWUgPT0gImxpc3QiIHx8IGF0dHJOYW1lID09ICJzdHlsZSIgfHwgYXR0ck5hbWUgPT0gImZvcm0iKSkgewoJCQkJCQkvL0ZJWE1FOiBkb24ndCBjbG9iYmVyIHZhbHVlIGlmIHN0aWxsIHR5cGluZyAoc2VlICMxNTEgYW5kICMyMTQpCgkJCQkJCS8vaXQgYXBwZWFycyBicm93c2VycyB3b3JrIGxpa2UgdGhpczoKCQkJCQkJLy8tIHVzZXIgdHlwZXMsIHVwZGF0ZXMgVUkgaW1tZWRpYXRlbHkKCQkJCQkJLy8tIGV2ZW50IGhhbmRsZXIsIGhvd2V2ZXIsIGRvZXMgTk9UIGZpcmUgaW1tZWRpYXRlbHkgaWYgdGhlcmUncyBqYXZhc2NyaXB0IHJ1bm5pbmcgKGJlY2F1c2UganMgaXMgc2luZ2xlIHRocmVhZGVkKQoJCQkJCQkvLy0gb25jZSBqcyBmaW5pc2hlcywgdGhlbiBpdCBydW5zIHJBRiBjYWxsYmFjaywgd2hpY2ggY2xvYmJlcnMgdGhlIGlucHV0IGlmIHdlJ3JlIHVzaW5nIG5haXZlIGJpZGlyZWN0aW9uYWwgYmluZGluZ3MKCQkJCQkJLy8tIFRIRU4gaXQgZmlyZXMgdGhlIGV2ZW50IGhhbmRsZXIgd2l0aCB0aGUgbmV3IGlucHV0IHZhbHVlCgkJCQkJCS8vc28gaWYgdGhlIGlucHV0IHZhbHVlIGlzIHVwZGF0ZWQgZHVyaW5nIHRoZSBzbWFsbCB3aW5kb3cgYmV0d2VlbiByZWdpc3RlcmluZyBhIFVJIGNoYW5nZSBuYXRpdmVseSBhbmQgdGhlIGVuZCBvZiBub24taWRsZSBqcyB0aW1lLCB0aGUgaW5wdXQgbG9zZXMgdGhlIHZhbHVlIHVwZGF0ZSBmcm9tIHRoYXQgZXZlbnQKCQkJCQkJaWYgKCEobm9kZSA9PT0gd2luZG93LmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgYXR0ck5hbWUgPT0gInZhbHVlIikpIG5vZGVbYXR0ck5hbWVdID0gZGF0YUF0dHIKCQkJCQl9CgkJCQkJZWxzZSBub2RlLnNldEF0dHJpYnV0ZShhdHRyTmFtZSwgZGF0YUF0dHIpCgkJCQl9CgkJCQljYXRjaCAoZSkgewoJCQkJCS8vc3dhbGxvdyBJRSdzIGludmFsaWQgYXJndW1lbnQgZXJyb3JzIHRvIG1pbWljIEhUTUwncyBmYWxsYmFjay10by1kb2luZy1ub3RoaW5nLW9uLWludmFsaWQtYXR0cmlidXRlcyBiZWhhdmlvcgoJCQkJCWlmIChlLm1lc3NhZ2UuaW5kZXhPZigiSW52YWxpZCBhcmd1bWVudCIpIDwgMCkgdGhyb3cgZQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBjYWNoZWRBdHRycwoJfQoJZnVuY3Rpb24gY2xlYXIobm9kZXMsIGNhY2hlZCkgewoJCWZvciAodmFyIGkgPSBub2Rlcy5sZW5ndGggLSAxOyBpID4gLTE7IGktLSkgewoJCQlpZiAobm9kZXNbaV0gJiYgbm9kZXNbaV0ucGFyZW50Tm9kZSkgewoJCQkJbm9kZXNbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2Rlc1tpXSkKCQkJCWNhY2hlZCA9IFtdLmNvbmNhdChjYWNoZWQpCgkJCQlpZiAoY2FjaGVkW2ldKSB1bmxvYWQoY2FjaGVkW2ldKQoJCQl9CgkJfQoJCWlmIChub2Rlcy5sZW5ndGggIT0gMCkgbm9kZXMubGVuZ3RoID0gMAoJfQoJZnVuY3Rpb24gdW5sb2FkKGNhY2hlZCkgewoJCWlmIChjYWNoZWQuY29uZmlnQ29udGV4dCAmJiBpc0ZuKGNhY2hlZC5jb25maWdDb250ZXh0Lm9udW5sb2FkKSkgY2FjaGVkLmNvbmZpZ0NvbnRleHQub251bmxvYWQoKQoJCWlmIChjYWNoZWQuY2hpbGRyZW4pIHsKCQkJaWYgKGlzQXJyKGNhY2hlZC5jaGlsZHJlbikpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgY2FjaGVkLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB1bmxvYWQoY2FjaGVkLmNoaWxkcmVuW2ldKQoJCQl9CgkJCWVsc2UgaWYgKGNhY2hlZC5jaGlsZHJlbi50YWcpIHVubG9hZChjYWNoZWQuY2hpbGRyZW4pCgkJfQoJfQoJZnVuY3Rpb24gaW5qZWN0SFRNTChwYXJlbnRFbGVtZW50LCBpbmRleCwgZGF0YSkgewoJCXZhciBuZXh0U2libGluZyA9IHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0KCQlpZiAobmV4dFNpYmxpbmcpIHsKCQkJdmFyIGlzRWxlbWVudCA9IG5leHRTaWJsaW5nLm5vZGVUeXBlICE9IDEKCQkJdmFyIHBsYWNlaG9sZGVyID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKQoJCQlpZiAoaXNFbGVtZW50KSB7CgkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShwbGFjZWhvbGRlciwgbmV4dFNpYmxpbmcpCgkJCQlwbGFjZWhvbGRlci5pbnNlcnRBZGphY2VudEhUTUwoImJlZm9yZWJlZ2luIiwgZGF0YSkKCQkJCXBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQocGxhY2Vob2xkZXIpCgkJCX0KCQkJZWxzZSBuZXh0U2libGluZy5pbnNlcnRBZGphY2VudEhUTUwoImJlZm9yZWJlZ2luIiwgZGF0YSkKCQl9CgkJZWxzZSBwYXJlbnRFbGVtZW50Lmluc2VydEFkamFjZW50SFRNTCgiYmVmb3JlZW5kIiwgZGF0YSkKCQl2YXIgbm9kZXMgPSBbXQoJCXdoaWxlIChwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdICE9PSBuZXh0U2libGluZykgewoJCQlub2Rlcy5wdXNoKHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0pCgkJCWluZGV4KysKCQl9CgkJcmV0dXJuIG5vZGVzCgl9CglmdW5jdGlvbiBmbGF0dGVuKGRhdGEpIHsKCQl2YXIgZmxhdHRlbmVkID0gW10KCQlmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGl0ZW0gPSBkYXRhW2ldCgkJCWlmIChpc0FycihpdGVtKSkgZmxhdHRlbmVkLnB1c2guYXBwbHkoZmxhdHRlbmVkLCBmbGF0dGVuKGl0ZW0pKQoJCQllbHNlIGZsYXR0ZW5lZC5wdXNoKGl0ZW0pCgkJfQoJCXJldHVybiBmbGF0dGVuZWQKCX0KCWZ1bmN0aW9uIGF1dG9yZWRyYXcoY2FsbGJhY2ssIG9iamVjdCkgewoJCXJldHVybiBmdW5jdGlvbihlKSB7CgkJCWUgPSBlIHx8IGV2ZW50CgkJCW0ucmVkcmF3LnN0cmF0ZWd5KCJkaWZmIikKCQkJbS5zdGFydENvbXB1dGF0aW9uKCkKCQkJdHJ5IHtyZXR1cm4gY2FsbGJhY2suY2FsbChvYmplY3QsIGUpfQoJCQlmaW5hbGx5IHsKCQkJCS8vRklYTUU6IGZvcmNlIGFzeW5jaHJvbm91cyByZWRyYXcgZm9yIGV2ZW50IGhhbmRsZXJzLCB0byBwcmV2ZW50IGRvdWJsZSByZWRyYXcgaW4gY2FzZXMgbGlrZSBvbmtleXByZXNzK29uaW5wdXQgKCMxNTEpCgkJCQkvL3RoaXMgc29sdXRpb24gaXNuJ3QgaWRlYWwgYmVjYXVzZSBpdCBjcmVhdGVzIGEgc21hbGwgd2luZG93IG9mIG9wcG9ydHVuaXR5IGZvciBldmVudHMgdG8gZ2V0IGxvc3QgKHNlZSAjMjE0KS4KCQkJCWlmICghbGFzdFJlZHJhd0lkKSBsYXN0UmVkcmF3SWQgPSAtMQoJCQkJbS5lbmRDb21wdXRhdGlvbigpCgkJCX0KCQl9Cgl9CgoJdmFyIGh0bWwKCXZhciBkb2N1bWVudE5vZGUgPSB7CgkJYXBwZW5kQ2hpbGQ6IGZ1bmN0aW9uKG5vZGUpIHsKCQkJaWYgKGh0bWwgPT09IHVuZGVmaW5lZCkgaHRtbCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJodG1sIikKCQkJaWYgKHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAhPT0gbm9kZSkgewoJCQkJd2luZG93LmRvY3VtZW50LnJlcGxhY2VDaGlsZChub2RlLCB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KQoJCQl9CgkJCWVsc2Ugd2luZG93LmRvY3VtZW50LmFwcGVuZENoaWxkKG5vZGUpCgkJCXRoaXMuY2hpbGROb2RlcyA9IHdpbmRvdy5kb2N1bWVudC5jaGlsZE5vZGVzCgkJfSwKCQlpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uKG5vZGUpIHsKCQkJdGhpcy5hcHBlbmRDaGlsZChub2RlKQoJCX0sCgkJY2hpbGROb2RlczogW10KCX0KCXZhciBub2RlQ2FjaGUgPSBbXSwgY2VsbENhY2hlID0ge30KCW0ucmVuZGVyID0gZnVuY3Rpb24ocm9vdCwgY2VsbCwgZm9yY2VSZWNyZWF0aW9uKSB7CgkJdmFyIGNvbmZpZ3MgPSBbXQoJCWlmICghcm9vdCkgdGhyb3cgbmV3IEVycm9yKCJQbGVhc2UgZW5zdXJlIHRoZSBET00gZWxlbWVudCBleGlzdHMgYmVmb3JlIHJlbmRlcmluZyBhIHRlbXBsYXRlIGludG8gaXQuIikKCQl2YXIgaWQgPSBnZXRDZWxsQ2FjaGVLZXkocm9vdCkKCQl2YXIgaXNEb2N1bWVudFJvb3QgPSByb290ID09IHdpbmRvdy5kb2N1bWVudAoJCXZhciBub2RlID0gaXNEb2N1bWVudFJvb3QgfHwgcm9vdCA9PSB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ID8gZG9jdW1lbnROb2RlIDogcm9vdAoJCWlmIChpc0RvY3VtZW50Um9vdCAmJiBjZWxsLnRhZyAhPSAiaHRtbCIpIGNlbGwgPSB7dGFnOiAiaHRtbCIsIGF0dHJzOiB7fSwgY2hpbGRyZW46IGNlbGx9CgkJaWYgKGNlbGxDYWNoZVtpZF0gPT09IHVuZGVmaW5lZCkgY2xlYXIobm9kZS5jaGlsZE5vZGVzKQoJCWlmIChmb3JjZVJlY3JlYXRpb24gPT09IHRydWUpIHJlc2V0KHJvb3QpCgkJY2VsbENhY2hlW2lkXSA9IGJ1aWxkKG5vZGUsIG51bGwsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjZWxsLCBjZWxsQ2FjaGVbaWRdLCBmYWxzZSwgMCwgbnVsbCwgdW5kZWZpbmVkLCBjb25maWdzKQoJCWZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlncy5sZW5ndGg7IGkrKykgY29uZmlnc1tpXSgpCgl9CglmdW5jdGlvbiBnZXRDZWxsQ2FjaGVLZXkoZWxlbWVudCkgewoJCXZhciBpbmRleCA9IG5vZGVDYWNoZS5pbmRleE9mKGVsZW1lbnQpCgkJcmV0dXJuIGluZGV4IDwgMCA/IG5vZGVDYWNoZS5wdXNoKGVsZW1lbnQpIC0gMSA6IGluZGV4Cgl9CgoJbS50cnVzdCA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJdmFsdWUgPSBuZXcgU3RyaW5nKHZhbHVlKQoJCXZhbHVlLiR0cnVzdGVkID0gdHJ1ZQoJCXJldHVybiB2YWx1ZQoJfQoKCWZ1bmN0aW9uIGdldHRlcnNldHRlcihzdG9yZSkgewoJCXZhciBwcm9wID0gZnVuY3Rpb24oKSB7CgkJCWlmIChhcmd1bWVudHMubGVuZ3RoKSBzdG9yZSA9IGFyZ3VtZW50c1swXQoJCQlyZXR1cm4gc3RvcmUKCQl9CgoJCXByb3AudG9KU09OID0gZnVuY3Rpb24oKSB7CgkJCXJldHVybiBzdG9yZQoJCX0KCgkJcmV0dXJuIHByb3AKCX0KCgltLnByb3AgPSBmdW5jdGlvbiAoc3RvcmUpIHsKCQlpZiAoKGlzT2JqKHN0b3JlKSB8fCBpc0ZuKHN0b3JlKSkgJiYgc3RvcmUgIT09IG51bGwgJiYgaXNGbihzdG9yZS50aGVuKSkgewoJCQlyZXR1cm4gcHJvcGlmeShzdG9yZSkKCQl9CgoJCXJldHVybiBnZXR0ZXJzZXR0ZXIoc3RvcmUpCgl9CgoJdmFyIHJvb3RzID0gW10sIG1vZHVsZXMgPSBbXSwgY29udHJvbGxlcnMgPSBbXSwgbGFzdFJlZHJhd0lkID0gbnVsbCwgbGFzdFJlZHJhd0NhbGxUaW1lID0gMCwgY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gbnVsbCwgcHJldmVudGVkID0gZmFsc2UKCXZhciBGUkFNRV9CVURHRVQgPSAxNiAvLzYwIGZyYW1lcyBwZXIgc2Vjb25kID0gMSBjYWxsIHBlciAxNiBtcwoJbS5tb2R1bGUgPSBmdW5jdGlvbihyb290LCBtb2R1bGUpIHsKCQl2YXIgaW5kZXggPSByb290cy5pbmRleE9mKHJvb3QpCgkJaWYgKGluZGV4IDwgMCkgaW5kZXggPSByb290cy5sZW5ndGgKCQl2YXIgaXNQcmV2ZW50ZWQgPSBmYWxzZQoJCWlmIChjb250cm9sbGVyc1tpbmRleF0gJiYgaXNGbihjb250cm9sbGVyc1tpbmRleF0ub251bmxvYWQpKSB7CgkJCXZhciBldmVudCA9IHsKCQkJCXByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHtpc1ByZXZlbnRlZCA9IHRydWV9CgkJCX0KCQkJY29udHJvbGxlcnNbaW5kZXhdLm9udW5sb2FkKGV2ZW50KQoJCX0KCQlpZiAoIWlzUHJldmVudGVkKSB7CgkJCW0ucmVkcmF3LnN0cmF0ZWd5KCJhbGwiKQoJCQltLnN0YXJ0Q29tcHV0YXRpb24oKQoJCQlyb290c1tpbmRleF0gPSByb290CgkJCW1vZHVsZXNbaW5kZXhdID0gbW9kdWxlCgkJCWNvbnRyb2xsZXJzW2luZGV4XSA9IG5ldyBtb2R1bGUuY29udHJvbGxlcgoJCQltLmVuZENvbXB1dGF0aW9uKCkKCQkJcmV0dXJuIGNvbnRyb2xsZXJzW2luZGV4XQoJCX0KCX0KCW0ucmVkcmF3ID0gZnVuY3Rpb24oZm9yY2UpIHsKCQl2YXIgY2FuY2VsID0gd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5jbGVhclRpbWVvdXQKCQl2YXIgZGVmZXIgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5zZXRUaW1lb3V0CgkJLy9sYXN0UmVkcmF3SWQgaXMgYSBwb3NpdGl2ZSBudW1iZXIgaWYgYSBzZWNvbmQgcmVkcmF3IGlzIHJlcXVlc3RlZCBiZWZvcmUgdGhlIG5leHQgYW5pbWF0aW9uIGZyYW1lCgkJLy9sYXN0UmVkcmF3SWQgaXMgLTEgaWYgdGhlIHJlZHJhdyBpcyB0aGUgZmlyc3Qgb25lIGluIGEgZXZlbnQgaGFuZGxlciAoc2VlICMxNTEpCgkJLy9sYXN0UmVkcmF3SUQgaXMgbnVsbCBpZiBpdCdzIHRoZSBmaXJzdCByZWRyYXcgYW5kIG5vdCBhbiBldmVudCBoYW5kbGVyCgkJaWYgKGxhc3RSZWRyYXdJZCAmJiBmb3JjZSAhPT0gdHJ1ZSkgewoJCQkvL3doZW4gc2V0VGltZW91dDogb25seSByZXNjaGVkdWxlIHJlZHJhdyBpZiB0aW1lIGJldHdlZW4gbm93IGFuZCBwcmV2aW91cyByZWRyYXcgaXMgYmlnZ2VyIHRoYW4gYSBmcmFtZSwgb3RoZXJ3aXNlIGtlZXAgY3VycmVudGx5IHNjaGVkdWxlZCB0aW1lb3V0CgkJCS8vd2hlbiByQUY6IGFsd2F5cyByZXNjaGVkdWxlIHJlZHJhdwoJCQlpZiAobmV3IERhdGUgLSBsYXN0UmVkcmF3Q2FsbFRpbWUgPiBGUkFNRV9CVURHRVQgfHwgZGVmZXIgPT0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSkgewoJCQkJaWYgKGxhc3RSZWRyYXdJZCA+IDApIGNhbmNlbChsYXN0UmVkcmF3SWQpCgkJCQlsYXN0UmVkcmF3SWQgPSBkZWZlcihyZWRyYXcsIEZSQU1FX0JVREdFVCkKCQkJfQoJCX0KCQllbHNlIHsKCQkJcmVkcmF3KCkKCQkJbGFzdFJlZHJhd0lkID0gZGVmZXIoZnVuY3Rpb24oKSB7bGFzdFJlZHJhd0lkID0gbnVsbH0sIEZSQU1FX0JVREdFVCkKCQl9Cgl9CgltLnJlZHJhdy5zdHJhdGVneSA9IG0ucHJvcCgpCglmdW5jdGlvbiByZWRyYXcoKSB7CgkJdmFyIG1vZGUgPSBtLnJlZHJhdy5zdHJhdGVneSgpCgkJZm9yICh2YXIgaSA9IDA7IGkgPCByb290cy5sZW5ndGg7IGkrKykgewoJCQlpZiAoY29udHJvbGxlcnNbaV0gJiYgbW9kZSAhPSAibm9uZSIpIG0ucmVuZGVyKHJvb3RzW2ldLCBtb2R1bGVzW2ldLnZpZXcoY29udHJvbGxlcnNbaV0pLCBtb2RlID09ICJhbGwiKQoJCX0KCQkvL2FmdGVyIHJlbmRlcmluZyB3aXRoaW4gYSByb3V0ZWQgY29udGV4dCwgd2UgbmVlZCB0byBzY3JvbGwgYmFjayB0byB0aGUgdG9wLCBhbmQgZmV0Y2ggdGhlIGRvY3VtZW50IHRpdGxlIGZvciBoaXN0b3J5LnB1c2hTdGF0ZQoJCWlmIChjb21wdXRlUG9zdFJlZHJhd0hvb2spIHsKCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rKCkKCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gbnVsbAoJCX0KCQlsYXN0UmVkcmF3SWQgPSBudWxsCgkJbGFzdFJlZHJhd0NhbGxUaW1lID0gbmV3IERhdGUKCQltLnJlZHJhdy5zdHJhdGVneSgiZGlmZiIpCgl9CgoJdmFyIHBlbmRpbmdSZXF1ZXN0cyA9IDAKCW0uc3RhcnRDb21wdXRhdGlvbiA9IGZ1bmN0aW9uKCkge3BlbmRpbmdSZXF1ZXN0cysrfQoJbS5lbmRDb21wdXRhdGlvbiA9IGZ1bmN0aW9uKCkgewoJCXBlbmRpbmdSZXF1ZXN0cyA9IE1hdGgubWF4KHBlbmRpbmdSZXF1ZXN0cyAtIDEsIDApCgkJaWYgKHBlbmRpbmdSZXF1ZXN0cyA9PSAwKSBtLnJlZHJhdygpCgl9CgoJbS53aXRoQXR0ciA9IGZ1bmN0aW9uKHByb3AsIHdpdGhBdHRyQ2FsbGJhY2spIHsKCQlyZXR1cm4gZnVuY3Rpb24oZSkgewoJCQllID0gZSB8fCBldmVudAoJCQl2YXIgY3VycmVudFRhcmdldCA9IGUuY3VycmVudFRhcmdldCB8fCB0aGlzCgkJCXdpdGhBdHRyQ2FsbGJhY2socHJvcCBpbiBjdXJyZW50VGFyZ2V0ID8gY3VycmVudFRhcmdldFtwcm9wXSA6IGN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKHByb3ApKQoJCX0KCX0KCgkvL3JvdXRpbmcKCXZhciBtb2RlcyA9IHtwYXRobmFtZTogIiIsIGhhc2g6ICIjIiwgc2VhcmNoOiAiPyJ9Cgl2YXIgcmVkaXJlY3QgPSBmdW5jdGlvbigpIHt9LCByb3V0ZVBhcmFtcyA9IHt9LCBjdXJyZW50Um91dGUKCW0ucm91dGUgPSBmdW5jdGlvbigpIHsKCQlpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGN1cnJlbnRSb3V0ZQoJCWVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDMgJiYgaXNTdHIoYXJndW1lbnRzWzFdKSkgewoJCQl2YXIgcm9vdCA9IGFyZ3VtZW50c1swXSwgZGVmYXVsdFJvdXRlID0gYXJndW1lbnRzWzFdLCByb3V0ZXIgPSBhcmd1bWVudHNbMl0KCQkJcmVkaXJlY3QgPSBmdW5jdGlvbihzb3VyY2UpIHsKCQkJCXZhciBwYXRoID0gY3VycmVudFJvdXRlID0gbm9ybWFsaXplUm91dGUoc291cmNlKQoJCQkJaWYgKCFyb3V0ZUJ5VmFsdWUocm9vdCwgcm91dGVyLCBwYXRoKSkgewoJCQkJCW0ucm91dGUoZGVmYXVsdFJvdXRlLCB0cnVlKQoJCQkJfQoJCQl9CgkJCXZhciBsaXN0ZW5lciA9IG0ucm91dGUubW9kZSA9PSAiaGFzaCIgPyAib25oYXNoY2hhbmdlIiA6ICJvbnBvcHN0YXRlIgoJCQl3aW5kb3dbbGlzdGVuZXJdID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoY3VycmVudFJvdXRlICE9IG5vcm1hbGl6ZVJvdXRlKHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdKSkgewoJCQkJCXJlZGlyZWN0KHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdKQoJCQkJfQoJCQl9CgkJCWNvbXB1dGVQb3N0UmVkcmF3SG9vayA9IHNldFNjcm9sbAoJCQl3aW5kb3dbbGlzdGVuZXJdKCkKCQl9CgkJZWxzZSBpZiAoYXJndW1lbnRzWzBdLmFkZEV2ZW50TGlzdGVuZXIpIHsKCQkJdmFyIGVsZW1lbnQgPSBhcmd1bWVudHNbMF0KCQkJdmFyIGlzSW5pdGlhbGl6ZWQgPSBhcmd1bWVudHNbMV0KCQkJdmFyIGNvbnRleHQgPSBhcmd1bWVudHNbMl0KCQkJaWYgKCFpc0luaXRpYWxpemVkKSB7CgkJCQljb250ZXh0LmhyZWYgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgiaHJlZiIpCgkJCQllbGVtZW50LmhyZWYgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgKyBtb2Rlc1ttLnJvdXRlLm1vZGVdICsgY29udGV4dC5ocmVmCgkJCQllbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgcm91dGVVbm9idHJ1c2l2ZSkKCQkJCWVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCByb3V0ZVVub2J0cnVzaXZlKQoJCQl9CgkJfQoJCWVsc2UgaWYgKGlzU3RyKGFyZ3VtZW50c1swXSkpIHsKCQkJY3VycmVudFJvdXRlID0gYXJndW1lbnRzWzBdCgkJCXZhciBxdWVyeXN0cmluZyA9IGlzT2JqKGFyZ3VtZW50c1sxXSkgPyBidWlsZFF1ZXJ5U3RyaW5nKGFyZ3VtZW50c1sxXSkgOiBudWxsCgkJCWlmIChxdWVyeXN0cmluZykgY3VycmVudFJvdXRlICs9IChjdXJyZW50Um91dGUuaW5kZXhPZigiPyIpID09PSAtMSA/ICI/IiA6ICImIikgKyBxdWVyeXN0cmluZwoKCQkJdmFyIHNob3VsZFJlcGxhY2VIaXN0b3J5RW50cnkgPSAoYXJndW1lbnRzLmxlbmd0aCA9PSAzID8gYXJndW1lbnRzWzJdIDogYXJndW1lbnRzWzFdKSA9PT0gdHJ1ZQoKCQkJaWYgKHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSkgewoJCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gZnVuY3Rpb24oKSB7CgkJCQkJd2luZG93Lmhpc3Rvcnlbc2hvdWxkUmVwbGFjZUhpc3RvcnlFbnRyeSA/ICJyZXBsYWNlU3RhdGUiIDogInB1c2hTdGF0ZSJdKG51bGwsIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgbW9kZXNbbS5yb3V0ZS5tb2RlXSArIGN1cnJlbnRSb3V0ZSkKCQkJCQlzZXRTY3JvbGwoKQoJCQkJfQoJCQkJcmVkaXJlY3QobW9kZXNbbS5yb3V0ZS5tb2RlXSArIGN1cnJlbnRSb3V0ZSkKCQkJfQoJCQllbHNlIHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdID0gY3VycmVudFJvdXRlCgkJfQoJfQoJbS5yb3V0ZS5wYXJhbSA9IGZ1bmN0aW9uKGtleSkge3JldHVybiByb3V0ZVBhcmFtc1trZXldfQoJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCWZ1bmN0aW9uIG5vcm1hbGl6ZVJvdXRlKHJvdXRlKSB7cmV0dXJuIHJvdXRlLnNsaWNlKG1vZGVzW20ucm91dGUubW9kZV0ubGVuZ3RoKX0KCWZ1bmN0aW9uIHJvdXRlQnlWYWx1ZShyb290LCByb3V0ZXIsIHBhdGgpIHsKCQlyb3V0ZVBhcmFtcyA9IHt9CgoJCXZhciBxdWVyeVN0YXJ0ID0gcGF0aC5pbmRleE9mKCI/IikKCQlpZiAocXVlcnlTdGFydCAhPT0gLTEpIHsKCQkJcm91dGVQYXJhbXMgPSBwYXJzZVF1ZXJ5U3RyaW5nKHBhdGguc3Vic3RyKHF1ZXJ5U3RhcnQgKyAxLCBwYXRoLmxlbmd0aCkpCgkJCXBhdGggPSBwYXRoLnN1YnN0cigwLCBxdWVyeVN0YXJ0KQoJCX0KCgkJZm9yICh2YXIgcm91dGUgaW4gcm91dGVyKSB7CgkJCWlmIChyb3V0ZSA9PSBwYXRoKSB7CgkJCQltLm1vZHVsZShyb290LCByb3V0ZXJbcm91dGVdKQoJCQkJcmV0dXJuIHRydWUKCQkJfQoKCQkJdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKCJeIiArIHJvdXRlLnJlcGxhY2UoLzpbXlwvXSs/XC57M30vZywgIiguKj8pIikucmVwbGFjZSgvOlteXC9dKy9nLCAiKFteXFwvXSspIikgKyAiXC8/JCIpCgoJCQlpZiAobWF0Y2hlci50ZXN0KHBhdGgpKSB7CgkJCQlwYXRoLnJlcGxhY2UobWF0Y2hlciwgZnVuY3Rpb24oKSB7CgkJCQkJdmFyIGtleXMgPSByb3V0ZS5tYXRjaCgvOlteXC9dKy9nKSB8fCBbXQoJCQkJCXZhciB2YWx1ZXMgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSwgLTIpCgkJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSByb3V0ZVBhcmFtc1trZXlzW2ldLnJlcGxhY2UoLzp8XC4vZywgIiIpXSA9IGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZXNbaV0pCgkJCQkJbS5tb2R1bGUocm9vdCwgcm91dGVyW3JvdXRlXSkKCQkJCX0pCgkJCQlyZXR1cm4gdHJ1ZQoJCQl9CgkJfQoJfQoJZnVuY3Rpb24gcm91dGVVbm9idHJ1c2l2ZShlKSB7CgkJZSA9IGUgfHwgZXZlbnQKCQlpZiAoZS5jdHJsS2V5IHx8IGUubWV0YUtleSB8fCBlLndoaWNoID09IDIpIHJldHVybgoJCWlmIChlLnByZXZlbnREZWZhdWx0KSBlLnByZXZlbnREZWZhdWx0KCkKCQllbHNlIGUucmV0dXJuVmFsdWUgPSBmYWxzZQoJCXZhciBjdXJyZW50VGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0IHx8IHRoaXMKCQltLnJvdXRlKGN1cnJlbnRUYXJnZXRbbS5yb3V0ZS5tb2RlXS5zbGljZShtb2Rlc1ttLnJvdXRlLm1vZGVdLmxlbmd0aCkpCgl9CglmdW5jdGlvbiBzZXRTY3JvbGwoKSB7CgkJaWYgKG0ucm91dGUubW9kZSAhPSAiaGFzaCIgJiYgd2luZG93LmxvY2F0aW9uLmhhc2gpIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2gKCQllbHNlIHdpbmRvdy5zY3JvbGxUbygwLCAwKQoJfQoJZnVuY3Rpb24gYnVpbGRRdWVyeVN0cmluZyhvYmplY3QsIHByZWZpeCkgewoJCXZhciBzdHIgPSBbXQoJCWZvcih2YXIgcHJvcCBpbiBvYmplY3QpIHsKCQkJdmFyIGtleSA9IHByZWZpeCA/IHByZWZpeCArICJbIiArIHByb3AgKyAiXSIgOiBwcm9wLCB2YWx1ZSA9IG9iamVjdFtwcm9wXQoJCQlzdHIucHVzaChpc09iaih2YWx1ZSkgPyBidWlsZFF1ZXJ5U3RyaW5nKHZhbHVlLCBrZXkpIDogZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKQoJCX0KCQlyZXR1cm4gc3RyLmpvaW4oIiYiKQoJfQoJZnVuY3Rpb24gcGFyc2VRdWVyeVN0cmluZyhzdHIpIHsKCQl2YXIgcGFpcnMgPSBzdHIuc3BsaXQoIiYiKSwgcGFyYW1zID0ge30KCQlmb3IgKHZhciBpID0gMDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBwYWlyID0gcGFpcnNbaV0uc3BsaXQoIj0iKQoJCQlwYXJhbXNbZGVjb2RlU3BhY2UocGFpclswXSldID0gcGFpclsxXSA/IGRlY29kZVNwYWNlKHBhaXJbMV0pIDogKHBhaXIubGVuZ3RoID09PSAxID8gdHJ1ZSA6ICIiKQoJCX0KCQlyZXR1cm4gcGFyYW1zCgl9CglmdW5jdGlvbiBkZWNvZGVTcGFjZShzdHJpbmcpIHsKCQlyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHN0cmluZy5yZXBsYWNlKC9cKy9nLCAiICIpKQoJfQoJZnVuY3Rpb24gcmVzZXQocm9vdCkgewoJCXZhciBjYWNoZUtleSA9IGdldENlbGxDYWNoZUtleShyb290KQoJCWNsZWFyKHJvb3QuY2hpbGROb2RlcywgY2VsbENhY2hlW2NhY2hlS2V5XSkKCQljZWxsQ2FjaGVbY2FjaGVLZXldID0gdW5kZWZpbmVkCgl9CgoJbS5kZWZlcnJlZCA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UgPSBwcm9waWZ5KGRlZmVycmVkLnByb21pc2UpCgkJcmV0dXJuIGRlZmVycmVkCgl9CglmdW5jdGlvbiBwcm9waWZ5KHByb21pc2UpIHsKCQlwcm9wID0gbS5wcm9wKCkKCQlwcm9taXNlLnRoZW4ocHJvcCkKCQlwcm9wLnRoZW4gPSBmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKCQkJcmV0dXJuIHByb3BpZnkocHJvbWlzZS50aGVuKHJlc29sdmUsIHJlamVjdCkpCgkJfQoJCXJldHVybiBwcm9wCgl9CgkvL1Byb21pei5taXRocmlsLmpzIHwgWm9sbWVpc3RlciB8IE1JVAoJLy9hIG1vZGlmaWVkIHZlcnNpb24gb2YgUHJvbWl6LmpzLCB3aGljaCBkb2VzIG5vdCBjb25mb3JtIHRvIFByb21pc2VzL0ErIGZvciB0d28gcmVhc29uczoKCS8vMSkgYHRoZW5gIGNhbGxiYWNrcyBhcmUgY2FsbGVkIHN5bmNocm9ub3VzbHkgKGJlY2F1c2Ugc2V0VGltZW91dCBpcyB0b28gc2xvdywgYW5kIHRoZSBzZXRJbW1lZGlhdGUgcG9seWZpbGwgaXMgdG9vIGJpZwoJLy8yKSB0aHJvd2luZyBzdWJjbGFzc2VzIG9mIEVycm9yIGNhdXNlIHRoZSBlcnJvciB0byBiZSBidWJibGVkIHVwIGluc3RlYWQgb2YgdHJpZ2dlcmluZyByZWplY3Rpb24gKGJlY2F1c2UgdGhlIHNwZWMgZG9lcyBub3QgYWNjb3VudCBmb3IgdGhlIGltcG9ydGFudCB1c2UgY2FzZSBvZiBkZWZhdWx0IGJyb3dzZXIgZXJyb3IgaGFuZGxpbmcsIGkuZS4gbWVzc2FnZSB3LyBsaW5lIG51bWJlcikKCWZ1bmN0aW9uIERlZmVycmVkKHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKSB7CgkJdmFyIFJFU09MVklORyA9IDEsIFJFSkVDVElORyA9IDIsIFJFU09MVkVEID0gMywgUkVKRUNURUQgPSA0CgkJdmFyIHNlbGYgPSB0aGlzLCBzdGF0ZSA9IDAsIHByb21pc2VWYWx1ZSA9IDAsIG5leHQgPSBbXQoKCQlzZWxmWyJwcm9taXNlIl0gPSB7fQoKCQlzZWxmWyJyZXNvbHZlIl0gPSBmdW5jdGlvbih2YWx1ZSkgewoJCQlpZiAoIXN0YXRlKSB7CgkJCQlwcm9taXNlVmFsdWUgPSB2YWx1ZQoJCQkJc3RhdGUgPSBSRVNPTFZJTkcKCgkJCQlmaXJlKCkKCQkJfQoJCQlyZXR1cm4gdGhpcwoJCX0KCgkJc2VsZlsicmVqZWN0Il0gPSBmdW5jdGlvbih2YWx1ZSkgewoJCQlpZiAoIXN0YXRlKSB7CgkJCQlwcm9taXNlVmFsdWUgPSB2YWx1ZQoJCQkJc3RhdGUgPSBSRUpFQ1RJTkcKCQkJCQoJCQkJZmlyZSgpCgkJCX0KCQkJcmV0dXJuIHRoaXMKCQl9CgoJCXNlbGYucHJvbWlzZVsidGhlbiJdID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2spIHsKCQkJdmFyIGRlZmVycmVkID0gbmV3IERlZmVycmVkKHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKQoJCQlpZiAoc3RhdGUgPT0gUkVTT0xWRUQpIHsKCQkJCWRlZmVycmVkLnJlc29sdmUocHJvbWlzZVZhbHVlKQoJCQl9CgkJCWVsc2UgaWYgKHN0YXRlID09IFJFSkVDVEVEKSB7CgkJCQlkZWZlcnJlZC5yZWplY3QocHJvbWlzZVZhbHVlKQoJCQl9CgkJCWVsc2UgewoJCQkJbmV4dC5wdXNoKGRlZmVycmVkKQoJCQl9CgkJCXJldHVybiBkZWZlcnJlZC5wcm9taXNlCgkJfQoJCQoJCWZ1bmN0aW9uIGZpbmlzaCh0eXBlKSB7CgkJCXN0YXRlID0gdHlwZSB8fCBSRUpFQ1RFRAoJCQluZXh0Lm1hcChmdW5jdGlvbihkZWZlcnJlZCkgewoJCQkJc3RhdGUgPT0gUkVTT0xWRUQgJiYgZGVmZXJyZWQucmVzb2x2ZShwcm9taXNlVmFsdWUpIHx8IGRlZmVycmVkLnJlamVjdChwcm9taXNlVmFsdWUpCgkJCX0pCgkJfQoKCQlmdW5jdGlvbiB0aGVubmFibGUodGhlbiwgc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2ssIG5vdFRoZW5uYWJsZUNhbGxiYWNrKSB7CgkJCWlmICgoaXNPYmoocHJvbWlzZVZhbHVlKSB8fCBpc0ZuKHByb21pc2VWYWx1ZSkpICYmIGlzRm4odGhlbikpIHsKCQkJCXRyeSB7CgkJCQkJLy8gY291bnQgcHJvdGVjdHMgYWdhaW5zdCBhYnVzZSBjYWxscyBmcm9tIHNwZWMgY2hlY2tlcgoJCQkJCXZhciBjb3VudCA9IDAKCQkJCQl0aGVuLmNhbGwocHJvbWlzZVZhbHVlLCBmdW5jdGlvbih2YWx1ZSkgewoJCQkJCQlpZiAoY291bnQrKykgcmV0dXJuCgkJCQkJCXByb21pc2VWYWx1ZSA9IHZhbHVlCgkJCQkJCXN1Y2Nlc3NDYWxsYmFjaygpCgkJCQkJfSwgZnVuY3Rpb24gKHZhbHVlKSB7CgkJCQkJCWlmIChjb3VudCsrKSByZXR1cm4KCQkJCQkJcHJvbWlzZVZhbHVlID0gdmFsdWUKCQkJCQkJZmFpbHVyZUNhbGxiYWNrKCkKCQkJCQl9KQoJCQkJfQoJCQkJY2F0Y2ggKGUpIHsKCQkJCQltLmRlZmVycmVkLm9uZXJyb3IoZSkKCQkJCQlwcm9taXNlVmFsdWUgPSBlCgkJCQkJZmFpbHVyZUNhbGxiYWNrKCkKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCW5vdFRoZW5uYWJsZUNhbGxiYWNrKCkKCQkJfQoJCX0KCgkJZnVuY3Rpb24gZmlyZSgpIHsKCQkJLy8gY2hlY2sgaWYgaXQncyBhIHRoZW5hYmxlCgkJCXZhciB0aGVuCgkJCXRyeSB7CgkJCQl0aGVuID0gcHJvbWlzZVZhbHVlICYmIHByb21pc2VWYWx1ZS50aGVuCgkJCX0KCQkJY2F0Y2ggKGUpIHsKCQkJCW0uZGVmZXJyZWQub25lcnJvcihlKQoJCQkJcHJvbWlzZVZhbHVlID0gZQoJCQkJc3RhdGUgPSBSRUpFQ1RJTkcKCQkJCXJldHVybiBmaXJlKCkKCQkJfQoJCQl0aGVubmFibGUodGhlbiwgZnVuY3Rpb24oKSB7CgkJCQlzdGF0ZSA9IFJFU09MVklORwoJCQkJZmlyZSgpCgkJCX0sIGZ1bmN0aW9uKCkgewoJCQkJc3RhdGUgPSBSRUpFQ1RJTkcKCQkJCWZpcmUoKQoJCQl9LCBmdW5jdGlvbigpIHsKCQkJCXRyeSB7CgkJCQkJaWYgKHN0YXRlID09IFJFU09MVklORyAmJiBpc0ZuKHN1Y2Nlc3NDYWxsYmFjaykpIHsKCQkJCQkJcHJvbWlzZVZhbHVlID0gc3VjY2Vzc0NhbGxiYWNrKHByb21pc2VWYWx1ZSkKCQkJCQl9CgkJCQkJZWxzZSBpZiAoc3RhdGUgPT0gUkVKRUNUSU5HICYmIGlzRm4oZmFpbHVyZUNhbGxiYWNrKSkgewoJCQkJCQlwcm9taXNlVmFsdWUgPSBmYWlsdXJlQ2FsbGJhY2socHJvbWlzZVZhbHVlKQoJCQkJCQlzdGF0ZSA9IFJFU09MVklORwoJCQkJCX0KCQkJCX0KCQkJCWNhdGNoIChlKSB7CgkJCQkJbS5kZWZlcnJlZC5vbmVycm9yKGUpCgkJCQkJcHJvbWlzZVZhbHVlID0gZQoJCQkJCXJldHVybiBmaW5pc2goKQoJCQkJfQoKCQkJCWlmIChwcm9taXNlVmFsdWUgPT0gc2VsZikgewoJCQkJCXByb21pc2VWYWx1ZSA9IFR5cGVFcnJvcigpCgkJCQkJZmluaXNoKCkKCQkJCX0KCQkJCWVsc2UgewoJCQkJCXRoZW5uYWJsZSh0aGVuLCBmdW5jdGlvbiAoKSB7CgkJCQkJCWZpbmlzaChSRVNPTFZFRCkKCQkJCQl9LCBmaW5pc2gsIGZ1bmN0aW9uICgpIHsKCQkJCQkJZmluaXNoKHN0YXRlID09IFJFU09MVklORyAmJiBSRVNPTFZFRCkKCQkJCQl9KQoJCQkJfQoJCQl9KQoJCX0KCX0KCW0uZGVmZXJyZWQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHsKCQlpZiAodHlwZShlKSA9PSAiW29iamVjdCBFcnJvcl0iICYmICFlLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCkubWF0Y2goLyBFcnJvci8pKSB0aHJvdyBlCgl9CgoJbS5zeW5jID0gZnVuY3Rpb24oYXJncykgewoJCXZhciBtZXRob2QgPSAicmVzb2x2ZSIKCQlmdW5jdGlvbiBzeW5jaHJvbml6ZXIocG9zLCByZXNvbHZlZCkgewoJCQlyZXR1cm4gZnVuY3Rpb24odmFsdWUpIHsKCQkJCXJlc3VsdHNbcG9zXSA9IHZhbHVlCgkJCQlpZiAoIXJlc29sdmVkKSBtZXRob2QgPSAicmVqZWN0IgoJCQkJaWYgKC0tb3V0c3RhbmRpbmcgPT0gMCkgewoJCQkJCWRlZmVycmVkLnByb21pc2UocmVzdWx0cykKCQkJCQlkZWZlcnJlZFttZXRob2RdKHJlc3VsdHMpCgkJCQl9CgkJCQlyZXR1cm4gdmFsdWUKCQkJfQoJCX0KCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJdmFyIG91dHN0YW5kaW5nID0gYXJncy5sZW5ndGgKCQl2YXIgcmVzdWx0cyA9IG5ldyBBcnJheShvdXRzdGFuZGluZykKCQlpZiAoYXJncy5sZW5ndGggPiAwKSB7CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewoJCQkJYXJnc1tpXS50aGVuKHN5bmNocm9uaXplcihpLCB0cnVlKSwgc3luY2hyb25pemVyKGksIGZhbHNlKSkKCQkJfQoJCX0KCQllbHNlIGRlZmVycmVkLnJlc29sdmUoKQoKCQlyZXR1cm4gZGVmZXJyZWQucHJvbWlzZQoJfQoJZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHtyZXR1cm4gdmFsdWV9CgoJZnVuY3Rpb24gYWpheChvcHRpb25zKSB7CgkJaWYgKG9wdGlvbnMuZGF0YVR5cGUgJiYgb3B0aW9ucy5kYXRhVHlwZS50b0xvd2VyQ2FzZSgpID09PSAianNvbnAiKSB7CgkJCXZhciBjYWxsYmFja0tleSA9ICJtaXRocmlsX2NhbGxiYWNrXyIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArICJfIiArIChNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxZTE2KSkudG9TdHJpbmcoMzYpCgkJCXZhciBzY3JpcHQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0IikKCgkJCXdpbmRvd1tjYWxsYmFja0tleV0gPSBmdW5jdGlvbihyZXNwKXsKCQkJCWRlbGV0ZSB3aW5kb3dbY2FsbGJhY2tLZXldCgkJCQl3aW5kb3cuZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JpcHQpCgkJCQlvcHRpb25zLm9ubG9hZCh7CgkJCQkJdHlwZTogImxvYWQiLAoJCQkJCXRhcmdldDogewoJCQkJCQlyZXNwb25zZVRleHQ6IHJlc3AKCQkJCQl9CgkJCQl9KQoJCQl9CgoJCQlzY3JpcHQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHsKCQkJCWRlbGV0ZSB3aW5kb3dbY2FsbGJhY2tLZXldCgkJCQl3aW5kb3cuZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JpcHQpCgoJCQkJb3B0aW9ucy5vbmVycm9yKHsKCQkJCQl0eXBlOiAiZXJyb3IiLAoJCQkJCXRhcmdldDogewoJCQkJCQlzdGF0dXM6IDUwMCwKCQkJCQkJcmVzcG9uc2VUZXh0OiBKU09OLnN0cmluZ2lmeSh7ZXJyb3I6ICJFcnJvciBtYWtpbmcganNvbnAgcmVxdWVzdCJ9KQoJCQkJCX0KCQkJCX0pCgoJCQkJcmV0dXJuIGZhbHNlCgkJCX0KCgkJCXNjcmlwdC5vbmxvYWQgPSBmdW5jdGlvbihlKSB7CgkJCQlyZXR1cm4gZmFsc2UKCQkJfQoKCgkJCXNjcmlwdC5zcmMgPSBvcHRpb25zLnVybAoJCQkJKyAob3B0aW9ucy51cmwuaW5kZXhPZigiPyIpID4gMCA/ICImIiA6ICI/IikKCQkJCSsgKG9wdGlvbnMuY2FsbGJhY2tLZXkgPyBvcHRpb25zLmNhbGxiYWNrS2V5IDogImNhbGxiYWNrIikKCQkJCSsgIj0iICsgY2FsbGJhY2tLZXkKCQkJCSsgIiYiICsgYnVpbGRRdWVyeVN0cmluZyhvcHRpb25zLmRhdGEgfHwge30pCgkJCXdpbmRvdy5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCkKCQl9CgkJZWxzZSB7CgkJCXZhciB4aHIgPSBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0CgkJCXhoci5vcGVuKG9wdGlvbnMubWV0aG9kLCBvcHRpb25zLnVybCwgdHJ1ZSwgb3B0aW9ucy51c2VyLCBvcHRpb25zLnBhc3N3b3JkKQoJCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHsKCQkJCQlpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgb3B0aW9ucy5vbmxvYWQoe3R5cGU6ICJsb2FkIiwgdGFyZ2V0OiB4aHJ9KQoJCQkJCWVsc2Ugb3B0aW9ucy5vbmVycm9yKHt0eXBlOiAiZXJyb3IiLCB0YXJnZXQ6IHhocn0pCgkJCQl9CgkJCX0KCQkJaWYgKG9wdGlvbnMuc2VyaWFsaXplID09IEpTT04uc3RyaW5naWZ5ICYmIG9wdGlvbnMuZGF0YSAmJiBvcHRpb25zLm1ldGhvZCAhPSAiR0VUIikgewoJCQkJeGhyLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04IikKCQkJfQoJCQlpZiAob3B0aW9ucy5kZXNlcmlhbGl6ZSA9PSBKU09OLnBhcnNlKSB7CgkJCQl4aHIuc2V0UmVxdWVzdEhlYWRlcigiQWNjZXB0IiwgImFwcGxpY2F0aW9uL2pzb24sIHRleHQvKiIpOwoJCQl9CgkJCWlmIChpc0ZuKG9wdGlvbnMuY29uZmlnKSkgewoJCQkJdmFyIG1heWJlWGhyID0gb3B0aW9ucy5jb25maWcoeGhyLCBvcHRpb25zKQoJCQkJaWYgKG1heWJlWGhyICE9IG51bGwpIHhociA9IG1heWJlWGhyCgkJCX0KCgkJCXhoci5zZW5kKG9wdGlvbnMubWV0aG9kID09ICJHRVQiIHx8ICFvcHRpb25zLmRhdGEgPyAiIiA6IG9wdGlvbnMuZGF0YSkKCQkJcmV0dXJuIHhocgoJCX0KCX0KCWZ1bmN0aW9uIGJpbmREYXRhKHhock9wdGlvbnMsIGRhdGEsIHNlcmlhbGl6ZSkgewoJCWlmIChkYXRhICYmIE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA+IDApIHsKCQkJaWYgKHhock9wdGlvbnMubWV0aG9kID09ICJHRVQiKSB7CgkJCQl4aHJPcHRpb25zLnVybCA9IHhock9wdGlvbnMudXJsICsgKHhock9wdGlvbnMudXJsLmluZGV4T2YoIj8iKSA8IDAgPyAiPyIgOiAiJiIpICsgYnVpbGRRdWVyeVN0cmluZyhkYXRhKQoJCQl9CgkJCWVsc2UgeGhyT3B0aW9ucy5kYXRhID0gc2VyaWFsaXplKGRhdGEpCgkJfQoJCXJldHVybiB4aHJPcHRpb25zCgl9CglmdW5jdGlvbiBwYXJhbWV0ZXJpemVVcmwodXJsLCBkYXRhKSB7CgkJdmFyIHRva2VucyA9IHVybC5tYXRjaCgvOlthLXpdXHcrL2dpKQoJCWlmICh0b2tlbnMgJiYgZGF0YSkgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewoJCQkJdmFyIGtleSA9IHRva2Vuc1tpXS5zbGljZSgxKQoJCQkJdXJsID0gdXJsLnJlcGxhY2UodG9rZW5zW2ldLCBkYXRhW2tleV0pCgkJCQlkZWxldGUgZGF0YVtrZXldCgkJCX0KCQl9CgkJcmV0dXJuIHVybAoJfQoKCW0ucmVxdWVzdCA9IGZ1bmN0aW9uKHhock9wdGlvbnMpIHsKCQlpZiAoeGhyT3B0aW9ucy5iYWNrZ3JvdW5kICE9PSB0cnVlKSBtLnN0YXJ0Q29tcHV0YXRpb24oKQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCXZhciBpc0pTT05QID0geGhyT3B0aW9ucy5kYXRhVHlwZSAmJiB4aHJPcHRpb25zLmRhdGFUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICJqc29ucCIKCQl2YXIgc2VyaWFsaXplID0geGhyT3B0aW9ucy5zZXJpYWxpemUgPSBpc0pTT05QID8gaWRlbnRpdHkgOiB4aHJPcHRpb25zLnNlcmlhbGl6ZSB8fCBKU09OLnN0cmluZ2lmeQoJCXZhciBkZXNlcmlhbGl6ZSA9IHhock9wdGlvbnMuZGVzZXJpYWxpemUgPSBpc0pTT05QID8gaWRlbnRpdHkgOiB4aHJPcHRpb25zLmRlc2VyaWFsaXplIHx8IEpTT04ucGFyc2UKCQl2YXIgZXh0cmFjdCA9IHhock9wdGlvbnMuZXh0cmFjdCB8fCBmdW5jdGlvbih4aHIpIHsKCQkJcmV0dXJuIHhoci5yZXNwb25zZVRleHQubGVuZ3RoID09PSAwICYmIGRlc2VyaWFsaXplID09PSBKU09OLnBhcnNlID8gbnVsbCA6IHhoci5yZXNwb25zZVRleHQKCQl9CgkJeGhyT3B0aW9ucy51cmwgPSBwYXJhbWV0ZXJpemVVcmwoeGhyT3B0aW9ucy51cmwsIHhock9wdGlvbnMuZGF0YSkKCQl4aHJPcHRpb25zID0gYmluZERhdGEoeGhyT3B0aW9ucywgeGhyT3B0aW9ucy5kYXRhLCBzZXJpYWxpemUpCgkJeGhyT3B0aW9ucy5vbmxvYWQgPSB4aHJPcHRpb25zLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7CgkJCXRyeSB7CgkJCQllID0gZSB8fCBldmVudAoJCQkJdmFyIHVud3JhcCA9IChlLnR5cGUgPT0gImxvYWQiID8geGhyT3B0aW9ucy51bndyYXBTdWNjZXNzIDogeGhyT3B0aW9ucy51bndyYXBFcnJvcikgfHwgaWRlbnRpdHkKCQkJCXZhciByZXNwb25zZSA9IHVud3JhcChkZXNlcmlhbGl6ZShleHRyYWN0KGUudGFyZ2V0LCB4aHJPcHRpb25zKSkpCgkJCQlpZiAoZS50eXBlID09ICJsb2FkIikgewoJCQkJCWlmIChpc0FycihyZXNwb25zZSkgJiYgeGhyT3B0aW9ucy50eXBlKSB7CgkJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UubGVuZ3RoOyBpKyspIHJlc3BvbnNlW2ldID0gbmV3IHhock9wdGlvbnMudHlwZShyZXNwb25zZVtpXSkKCQkJCQl9CgkJCQkJZWxzZSBpZiAoeGhyT3B0aW9ucy50eXBlKSByZXNwb25zZSA9IG5ldyB4aHJPcHRpb25zLnR5cGUocmVzcG9uc2UpCgkJCQl9CgkJCQlkZWZlcnJlZFtlLnR5cGUgPT0gImxvYWQiID8gInJlc29sdmUiIDogInJlamVjdCJdKHJlc3BvbnNlKQoJCQl9CgkJCWNhdGNoIChlKSB7CgkJCQltLmRlZmVycmVkLm9uZXJyb3IoZSkKCQkJCWRlZmVycmVkLnJlamVjdChlKQoJCQl9CgkJCWlmICh4aHJPcHRpb25zLmJhY2tncm91bmQgIT09IHRydWUpIG0uZW5kQ29tcHV0YXRpb24oKQoJCX0KCQlhamF4KHhock9wdGlvbnMpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UKCX0KCgkvL3Rlc3RpbmcgQVBJCgltLmRlcHMgPSBmdW5jdGlvbihtb2NrKSB7cmV0dXJuIHdpbmRvdyA9IG1vY2t9CgkvL2ZvciBpbnRlcm5hbCB0ZXN0aW5nIG9ubHksIGRvIG5vdCB1c2UgYG0uZGVwcy5mYWN0b3J5YAoJbS5kZXBzLmZhY3RvcnkgPSBhcHAKCglyZXR1cm4gbQp9KHR5cGVvZiB3aW5kb3cgIT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fSkKCmlmICh0eXBlb2YgbW9kdWxlICE9ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgbW9kdWxlLmV4cG9ydHMgPSBtCmlmICh0eXBlb2YgZGVmaW5lID09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKGZ1bmN0aW9uKCkge3JldHVybiBtfSkKCjs7OwoKZnVuY3Rpb24gdGVzdChjb25kaXRpb24pIHsKCXZhciBkdXJhdGlvbiA9IDAKCXZhciBzdGFydCA9IDAKCXZhciByZXN1bHQgPSB0cnVlCgl0ZXN0LnRvdGFsKysKCglpZiAodHlwZW9mIHBlcmZvcm1hbmNlICE9ICJ1bmRlZmluZWQiKSB7CgkJc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKQoJfQoJdHJ5IHsKCQlpZiAoIWNvbmRpdGlvbigpKSB0aHJvdyBuZXcgRXJyb3IoKQoJfQoJY2F0Y2ggKGUpIHsKCQlyZXN1bHQgPSBmYWxzZQoJCWNvbnNvbGUuZXJyb3IoZSkKCQl0ZXN0LmZhaWx1cmVzLnB1c2goY29uZGl0aW9uKQoJfQoJaWYgKHR5cGVvZiBwZXJmb3JtYW5jZSAhPSAidW5kZWZpbmVkIikgewoJCWR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydAoJfQoKCXRlc3Rfb2JqID0gewoJCW5hbWU6ICIiICsgdGVzdC50b3RhbCwKCQlyZXN1bHQ6IHJlc3VsdCwKCQlkdXJhdGlvbjogZHVyYXRpb24KCX0KCglpZiAodHlwZW9mIHdpbmRvdyAhPSAidW5kZWZpbmVkIikgewoJCWlmICghcmVzdWx0KSB7CgkJCXdpbmRvdy5nbG9iYWxfdGVzdF9yZXN1bHRzLnRlc3RzLnB1c2godGVzdF9vYmopCgkJfQoKCQl3aW5kb3cuZ2xvYmFsX3Rlc3RfcmVzdWx0cy5kdXJhdGlvbiArPSBkdXJhdGlvbgoJCWlmIChyZXN1bHQpIHsKCQkJd2luZG93Lmdsb2JhbF90ZXN0X3Jlc3VsdHMucGFzc2VkKysKCQl9IGVsc2UgewoJCQl3aW5kb3cuZ2xvYmFsX3Rlc3RfcmVzdWx0cy5mYWlsZWQrKwoJCX0KCX0KfQp0ZXN0LnRvdGFsID0gMAp0ZXN0LmZhaWx1cmVzID0gW10KdGVzdC5wcmludCA9IGZ1bmN0aW9uKHByaW50KSB7Cglmb3IgKHZhciBpID0gMDsgaSA8IHRlc3QuZmFpbHVyZXMubGVuZ3RoOyBpKyspIHsKCQlwcmludCh0ZXN0LmZhaWx1cmVzW2ldLnRvU3RyaW5nKCkpCgl9CglwcmludCgidGVzdHM6ICIgKyB0ZXN0LnRvdGFsICsgIlxuZmFpbHVyZXM6ICIgKyB0ZXN0LmZhaWx1cmVzLmxlbmd0aCkKCglpZiAodGVzdC5mYWlsdXJlcy5sZW5ndGggPiAwKSB7CgkJdGhyb3cgbmV3IEVycm9yKHRlc3QuZmFpbHVyZXMubGVuZ3RoICsgIiB0ZXN0cyBkaWQgbm90IHBhc3MiKQoJfQp9Cgp2YXIgbW9jayA9IHt9Cm1vY2sud2luZG93ID0gbmV3IGZ1bmN0aW9uKCkgewoJdmFyIHdpbmRvdyA9IHt9Cgl3aW5kb3cuZG9jdW1lbnQgPSB7fQoJd2luZG93LmRvY3VtZW50LmNoaWxkTm9kZXMgPSBbXQoJd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbih0YWcpIHsKCQlyZXR1cm4gewoJCQlzdHlsZToge30sCgkJCWNoaWxkTm9kZXM6IFtdLAoJCQlub2RlVHlwZTogMSwKCQkJbm9kZU5hbWU6IHRhZy50b1VwcGVyQ2FzZSgpLAoJCQlhcHBlbmRDaGlsZDogd2luZG93LmRvY3VtZW50LmFwcGVuZENoaWxkLAoJCQlyZW1vdmVDaGlsZDogd2luZG93LmRvY3VtZW50LnJlbW92ZUNoaWxkLAoJCQlyZXBsYWNlQ2hpbGQ6IHdpbmRvdy5kb2N1bWVudC5yZXBsYWNlQ2hpbGQsCgkJCWluc2VydEJlZm9yZTogZnVuY3Rpb24obm9kZSwgcmVmZXJlbmNlKSB7CgkJCQlub2RlLnBhcmVudE5vZGUgPSB0aGlzCgkJCQl2YXIgcmVmZXJlbmNlSW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihyZWZlcmVuY2UpCgkJCQl2YXIgaW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihub2RlKQoJCQkJaWYgKGluZGV4ID4gLTEpIHRoaXMuY2hpbGROb2Rlcy5zcGxpY2UoaW5kZXgsIDEpCgkJCQlpZiAocmVmZXJlbmNlSW5kZXggPCAwKSB0aGlzLmNoaWxkTm9kZXMucHVzaChub2RlKQoJCQkJZWxzZSB0aGlzLmNoaWxkTm9kZXMuc3BsaWNlKHJlZmVyZW5jZUluZGV4LCAwLCBub2RlKQoJCQl9LAoJCQlpbnNlcnRBZGphY2VudEhUTUw6IGZ1bmN0aW9uKHBvc2l0aW9uLCBodG1sKSB7CgkJCQkvL3RvZG86IGFjY2VwdCBtYXJrdXAKCQkJCWlmIChwb3NpdGlvbiA9PSAiYmVmb3JlYmVnaW4iKSB7CgkJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaHRtbCksIHRoaXMpCgkJCQl9CgkJCQllbHNlIGlmIChwb3NpdGlvbiA9PSAiYmVmb3JlZW5kIikgewoJCQkJCXRoaXMuYXBwZW5kQ2hpbGQod2luZG93LmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGh0bWwpKQoJCQkJfQoJCQl9LAoJCQlzZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CgkJCQl0aGlzW25hbWVdID0gdmFsdWUudG9TdHJpbmcoKQoJCQl9LAoJCQlzZXRBdHRyaWJ1dGVOUzogZnVuY3Rpb24obmFtZXNwYWNlLCBuYW1lLCB2YWx1ZSkgewoJCQkJdGhpcy5uYW1lc3BhY2VVUkkgPSBuYW1lc3BhY2UKCQkJCXRoaXNbbmFtZV0gPSB2YWx1ZS50b1N0cmluZygpCgkJCX0sCgkJCWdldEF0dHJpYnV0ZTogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKCQkJCXJldHVybiB0aGlzW25hbWVdCgkJCX0KCQl9Cgl9Cgl3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TID0gZnVuY3Rpb24obmFtZXNwYWNlLCB0YWcpIHsKCQl2YXIgZWxlbWVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZykKCQllbGVtZW50Lm5hbWVzcGFjZVVSSSA9IG5hbWVzcGFjZQoJCXJldHVybiBlbGVtZW50Cgl9Cgl3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUgPSBmdW5jdGlvbih0ZXh0KSB7CgkJcmV0dXJuIHtub2RlVmFsdWU6IHRleHQudG9TdHJpbmcoKX0KCX0KCXdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaHRtbCIpCgl3aW5kb3cuZG9jdW1lbnQucmVwbGFjZUNoaWxkID0gZnVuY3Rpb24obmV3Q2hpbGQsIG9sZENoaWxkKSB7CgkJdmFyIGluZGV4ID0gdGhpcy5jaGlsZE5vZGVzLmluZGV4T2Yob2xkQ2hpbGQpCgkJaWYgKGluZGV4ID4gLTEpIHRoaXMuY2hpbGROb2Rlcy5zcGxpY2UoaW5kZXgsIDEsIG5ld0NoaWxkKQoJCWVsc2UgdGhpcy5jaGlsZE5vZGVzLnB1c2gobmV3Q2hpbGQpCgkJbmV3Q2hpbGQucGFyZW50Tm9kZSA9IHRoaXMKCQlvbGRDaGlsZC5wYXJlbnROb2RlID0gbnVsbAoJfQoJd2luZG93LmRvY3VtZW50LmFwcGVuZENoaWxkID0gZnVuY3Rpb24oY2hpbGQpIHsKCQl2YXIgaW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihjaGlsZCkKCQlpZiAoaW5kZXggPiAtMSkgdGhpcy5jaGlsZE5vZGVzLnNwbGljZShpbmRleCwgMSkKCQl0aGlzLmNoaWxkTm9kZXMucHVzaChjaGlsZCkKCQljaGlsZC5wYXJlbnROb2RlID0gdGhpcwoJfQoJd2luZG93LmRvY3VtZW50LnJlbW92ZUNoaWxkID0gZnVuY3Rpb24oY2hpbGQpIHsKCQl2YXIgaW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihjaGlsZCkKCQl0aGlzLmNoaWxkTm9kZXMuc3BsaWNlKGluZGV4LCAxKQoJCWNoaWxkLnBhcmVudE5vZGUgPSBudWxsCgl9CgkvL2dldEVsZW1lbnRzQnlUYWdOYW1lIGlzIG9ubHkgdXNlZCBieSBKU09OUCB0ZXN0cywgaXQncyBub3QgcmVxdWlyZWQgYnkgTWl0aHJpbAoJd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lID0gZnVuY3Rpb24obmFtZSl7CgkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCQl2YXIgb3V0ID0gW107CgoJCXZhciB0cmF2ZXJzZSA9IGZ1bmN0aW9uKG5vZGUpewoJCQlpZihub2RlLmNoaWxkTm9kZXMgJiYgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA+IDApewoJCQkJbm9kZS5jaGlsZE5vZGVzLmZvckVhY2goZnVuY3Rpb24oY3Vycil7CgkJCQkJaWYoY3Vyci5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lKQoJCQkJCQlvdXQucHVzaChjdXJyKTsKCQkJCQl0cmF2ZXJzZShjdXJyKTsKCQkJCX0pOwoJCQl9CgkJfTsKCgkJdHJhdmVyc2Uod2luZG93LmRvY3VtZW50KTsKCQlyZXR1cm4gb3V0OwoJfQoJd2luZG93LnNjcm9sbFRvID0gZnVuY3Rpb24oKSB7fQoJd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oKSB7fQoJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2sgPSBjYWxsYmFjawoJCXJldHVybiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRpZCsrCgl9Cgl3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRpZCA9IDEKCXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUgPSBmdW5jdGlvbigpIHsKCQlpZiAod2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2spIHsKCQkJdmFyIGNhbGxiYWNrID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2sKCQkJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2sgPSBudWxsCgkJCWNhbGxiYWNrKCkKCQl9Cgl9Cgl3aW5kb3cuWE1MSHR0cFJlcXVlc3QgPSBuZXcgZnVuY3Rpb24oKSB7CgkJdmFyIHJlcXVlc3QgPSBmdW5jdGlvbigpIHsKCQkJdGhpcy4kaGVhZGVycyA9IHt9CgkJCXRoaXMuc2V0UmVxdWVzdEhlYWRlciA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKCQkJCXRoaXMuJGhlYWRlcnNba2V5XSA9IHZhbHVlCgkJCX0KCQkJdGhpcy5vcGVuID0gZnVuY3Rpb24obWV0aG9kLCB1cmwpIHsKCQkJCXRoaXMubWV0aG9kID0gbWV0aG9kCgkJCQl0aGlzLnVybCA9IHVybAoJCQl9CgkJCXRoaXMuc2VuZCA9IGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5yZXNwb25zZVRleHQgPSBKU09OLnN0cmluZ2lmeSh0aGlzKQoJCQkJdGhpcy5yZWFkeVN0YXRlID0gNAoJCQkJdGhpcy5zdGF0dXMgPSAyMDAKCQkJCXJlcXVlc3QuJGluc3RhbmNlcy5wdXNoKHRoaXMpCgkJCX0KCQl9CgkJcmVxdWVzdC4kaW5zdGFuY2VzID0gW10KCQlyZXR1cm4gcmVxdWVzdAoJfQoJd2luZG93LmxvY2F0aW9uID0ge3NlYXJjaDogIiIsIHBhdGhuYW1lOiAiIiwgaGFzaDogIiJ9LAoJd2luZG93Lmhpc3RvcnkgPSB7fQoJd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlID0gZnVuY3Rpb24oZGF0YSwgdGl0bGUsIHVybCkgewoJCXdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHVybAoJfSwKCXdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSA9IGZ1bmN0aW9uKGRhdGEsIHRpdGxlLCB1cmwpIHsKCQl3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoID0gd2luZG93LmxvY2F0aW9uLmhhc2ggPSB1cmwKCX0KCXJldHVybiB3aW5kb3cKfQpmdW5jdGlvbiB0ZXN0TWl0aHJpbChtb2NrKSB7CgltLmRlcHMobW9jaykKCgkvL20KCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIpLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIpLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIpLmF0dHJzLmNsYXNzTmFtZSA9PT0gImZvbyJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiW3RpdGxlPWJhcl0iKS50YWcgPT09ICJkaXYifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oIlt0aXRsZT1iYXJdIikuYXR0cnMudGl0bGUgPT09ICJiYXIifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oIlt0aXRsZT1cJ2JhclwnXSIpLmF0dHJzLnRpdGxlID09PSAiYmFyIn0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJbdGl0bGU9XCJiYXJcIl0iKS5hdHRycy50aXRsZSA9PT0gImJhciJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgInRlc3QiKS5jaGlsZHJlblswXSA9PT0gInRlc3QifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsICJ0ZXN0IiwgInRlc3QyIikuY2hpbGRyZW5bMV0gPT09ICJ0ZXN0MiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgWyJ0ZXN0Il0pLmNoaWxkcmVuWzBdID09PSAidGVzdCJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2Iiwge3RpdGxlOiAiYmFyIn0sICJ0ZXN0IikuYXR0cnMudGl0bGUgPT09ICJiYXIifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIHt0aXRsZTogImJhciJ9LCAidGVzdCIpLmNoaWxkcmVuWzBdID09PSAidGVzdCJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2Iiwge3RpdGxlOiAiYmFyIn0sIFsidGVzdCJdKS5jaGlsZHJlblswXSA9PT0gInRlc3QifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIHt0aXRsZTogImJhciJ9LCBtKCJkaXYiKSkuY2hpbGRyZW5bMF0udGFnID09PSAiZGl2In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCB7dGl0bGU6ICJiYXIifSwgW20oImRpdiIpXSkuY2hpbGRyZW5bMF0udGFnID09PSAiZGl2In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCB7dGl0bGU6ICJiYXIifSwgInRlc3QwIiwgInRlc3QxIiwgInRlc3QyIiwgInRlc3QzIikuY2hpbGRyZW5bM10gPT09ICJ0ZXN0MyJ9KSAvLyBzcGxhdAoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2Iiwge3RpdGxlOiAiYmFyIn0sIG0oImRpdiIpLCBtKCJpIiksIG0oInNwYW4iKSkuY2hpbGRyZW5bMl0udGFnID09PSAic3BhbiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgWyJhIiwgImIiXSkuY2hpbGRyZW4ubGVuZ3RoID09PSAyfSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFttKCJkaXYiKV0pLmNoaWxkcmVuWzBdLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgbSgiZGl2IikpLmNoaWxkcmVuWzBdLnRhZyA9PT0gImRpdiJ9KSAvL3llcywgdGhpcyBpcyBleHBlY3RlZCBiZWhhdmlvcjogc2VlIG1ldGhvZCBzaWduYXR1cmUKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFt1bmRlZmluZWRdKS50YWcgPT09ICJkaXYifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFt7Zm9vOiAiYmFyIn1dKX0pIC8vYXMgbG9uZyBhcyBpdCBkb2Vzbid0IHRocm93IGVycm9ycywgaXQncyBmaW5lCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJzdmciLCBbbSgiZyIpXSl9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgic3ZnIiwgW20oImFbaHJlZj0naHR0cDovL2dvb2dsZS5jb20nXSIpXSl9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIsIHtjbGFzczogImJhciJ9KS5hdHRycy5jbGFzcyA9PSAiZm9vIGJhciJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIsIHtjbGFzc05hbWU6ICJiYXIifSkuYXR0cnMuY2xhc3NOYW1lID09ICJmb28gYmFyIn0pCgoJLy9tLm1vZHVsZQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgoJCXZhciByb290MSA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgbW9kMSA9IG0ubW9kdWxlKHJvb3QxLCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3RoaXMudmFsdWUgPSAidGVzdDEifSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkge3JldHVybiBjdHJsLnZhbHVlfQoJCX0pCgoJCXZhciByb290MiA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgbW9kMiA9IG0ubW9kdWxlKHJvb3QyLCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3RoaXMudmFsdWUgPSAidGVzdDIifSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkge3JldHVybiBjdHJsLnZhbHVlfQoJCX0pCgoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCgkJcmV0dXJuIChyb290MS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QxIiAmJiByb290Mi5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QyIikKCQkJJiYgKG1vZDEudmFsdWUgJiYgbW9kMS52YWx1ZSA9PT0gInRlc3QxIikgJiYgKG1vZDIudmFsdWUgJiYgbW9kMi52YWx1ZSA9PT0gInRlc3QyIikKCX0pCgoJLy9tLndpdGhBdHRyCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBoYW5kbGVyID0gbS53aXRoQXR0cigidGVzdCIsIGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWhhbmRsZXIoe2N1cnJlbnRUYXJnZXQ6IHt0ZXN0OiAiZm9vIn19KQoJCXJldHVybiB2YWx1ZSA9PT0gImZvbyIKCX0pCgoJLy9tLnRydXN0Cgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtLnRydXN0KCJ0ZXN0IikudmFsdWVPZigpID09PSAidGVzdCJ9KQoKCS8vbS5yZW5kZXIKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgInRlc3QiKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjbGFzczogImEifSkpCgkJdmFyIGVsZW1lbnRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y2xhc3M6ICJiIn0pKQoJCXZhciBlbGVtZW50QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQlyZXR1cm4gZWxlbWVudEJlZm9yZSA9PT0gZWxlbWVudEFmdGVyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIuYSIpKQoJCXZhciBlbGVtZW50QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgbSgiLmIiKSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgPT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2lkOiAiYSJ9KSkKCQl2YXIgZWxlbWVudEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHt0aXRsZTogImIifSkpCgkJdmFyIGVsZW1lbnRBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBlbGVtZW50QmVmb3JlICE9PSBlbGVtZW50QWZ0ZXIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNhIikpCgkJdmFyIGVsZW1lbnRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBtKCJbdGl0bGU9Yl0iKSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2EiKSkKCQl2YXIgZWxlbWVudEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsICJ0ZXN0IikKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW3VuZGVmaW5lZF0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJzdmciLCBbbSgiZyIpXSkpCgkJdmFyIGcgPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXQoJCXJldHVybiBnLm5vZGVOYW1lID09PSAiRyIgJiYgZy5uYW1lc3BhY2VVUkkgPT0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgic3ZnIiwgW20oImFbaHJlZj0naHR0cDovL2dvb2dsZS5jb20nXSIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiQSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdi5jbGFzc25hbWUiLCBbbSgiYSIsIHtocmVmOiAiL2ZpcnN0In0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImEiLCB7aHJlZjogIi9zZWNvbmQifSldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubGVuZ3RoID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIildKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIpLCB1bmRlZmluZWRdKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZVZhbHVlID09PSAiIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiKSwgbSgibGkiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiksIHVuZGVmaW5lZF0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlVmFsdWUgPT09ICIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbdW5kZWZpbmVkXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIildKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFt7fV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT09IDAKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIildKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFt7dGFnOiAiYiIsIGF0dHJzOiB7fX1dKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT0gIkIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbe3RhZzogbmV3IFN0cmluZygiYiIpLCBhdHRyczoge319XSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09ICJCIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCBbbSgiYSIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFt7c3VidHJlZTogInJldGFpbiJ9XSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT09ICJBIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQzCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsIHtjb25maWc6IG0ucm91dGV9LCAidGVzdCIpKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCB7Y29uZmlnOiBtLnJvdXRlfSwgInRlc3QiKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoMSkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW251bGwsIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbInRlc3QiLCBtKCIjYmFyIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoMikKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW251bGwsIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiZGl2IiksIG0oIiNiYXIiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZSA9PT0gIkRJViIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoMykKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgWyJ0ZXN0IiwgbSgiI2JhciIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFttKCJkaXYiKSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiRElWIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQ0ICg0KQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiZGl2IiksIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbInRlc3QiLCBtKCIjYmFyIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoNSkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW20oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiI2JhciIpLCBbbSgiI2JheiIpXV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5pZCA9PT0gImJheiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80OAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudAoJCW0ucmVuZGVyKHJvb3QsIG0oImh0bWwiLCBbbSgiI2ZvbyIpXSkpCgkJdmFyIHJlc3VsdCA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmlkID09PSAiZm9vIgoJCXJvb3QuY2hpbGROb2RlcyA9IFttb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImh0bWwiKV0KCQlyZXR1cm4gcmVzdWx0Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJhIiwgInRlc3QiKSkKCQltLnJlbmRlcihyb290LCBtKCJhLmZvbyIsICJ0ZXN0IikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJhLmZvbyIsICJ0ZXN0IikpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsICJ0ZXN0IikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJhLmZvbyIsICJ0ZXN0IikpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsICJ0ZXN0MSIpKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0MSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80OQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCAidGVzdCIpKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCAidGVzdDEiKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdDEiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1ttKCJkaXYiLCAiYSIpLCBtKCJkaXYiLCAiYiIpXSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbW20oImRpdiIsICJhIiksIG0oImRpdiIsICJiIildLCBtKCIjYmFyIildKSkKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1ttKCJkaXYiLCAiYSIpLCBtKCJkaXYiLCAiYiIpLCBtKCJkaXYiLCAiYyIpXSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzJdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbW20oImRpdiIsICJhIiksIG0oImRpdiIsICJiIildLCBbbSgiZGl2IiwgImMiKSwgbSgiZGl2IiwgImQiKV0sIG0oIiNiYXIiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1szXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImQiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzRdLmlkID09PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFtbbSgiZGl2IiwgImEiKSwgbSgiZGl2IiwgImIiKV0sICJ0ZXN0Il0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImIiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzJdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1siYSIsICJiIl0sICJ0ZXN0Il0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlVmFsdWUgPT09ICJiIiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1syXS5ub2RlVmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUxCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFttKCJzZWN0aW9uIiksIG0oIm5hdiIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwgW20oImJ1dHRvbiIpLCBtKCJhcnRpY2xlIiwgW20oInNwYW4iKSwgbSgibmF2IildKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiU1BBTiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIm1haW4iLCBbbSgiYnV0dG9uIiksIG0oImFydGljbGUiLCBbbSgic2VjdGlvbiIpLCBtKCJuYXYiKV0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFsidGVzdCIsIG0oIm5hdiIpXSldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUxCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFttKCJzZWN0aW9uIiksIG0oIm5hdiIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwgW20oImJ1dHRvbiIpLCBtKCJhcnRpY2xlIiwgW20udHJ1c3QoInRlc3QiKSwgbSgibmF2IildKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTUKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjYSIpKQoJCXZhciBlbGVtZW50QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgbSgiI2IiKSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzU2CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW251bGwsICJmb28iXSkKCQltLnJlbmRlcihyb290LCBbImJhciJdKQoJCXJldHVybiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81NgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsICJmb28iKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbbSgiYnV0dG9uIiksIG0oInVsIildKSkKCQl2YXIgdmFsdWVCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFt1bmRlZmluZWQsIG0oInVsIildKSkKCQl2YXIgdmFsdWVBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZQoJCXJldHVybiB2YWx1ZUJlZm9yZSA9PT0gIkJVVFRPTiIgJiYgdmFsdWVBZnRlciA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFttKCJ1bCIpLCB1bmRlZmluZWRdKSkKCQl2YXIgdmFsdWVCZWZvcmUxID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUKCQl2YXIgdmFsdWVCZWZvcmUyID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZVZhbHVlCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW3VuZGVmaW5lZCwgbSgidWwiKV0pKQoJCXZhciB2YWx1ZUFmdGVyMSA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZQoJCXZhciB2YWx1ZUFmdGVyMiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLm5vZGVOYW1lCgkJcmV0dXJuIHZhbHVlQmVmb3JlMSA9PT0gIlVMIiAmJiB2YWx1ZUFmdGVyMSA9PT0gIiIgJiYgdmFsdWVCZWZvcmUyID09PSAiIiAmJiB2YWx1ZUFmdGVyMiA9PT0gIlVMIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzc5CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge3N0eWxlOiB7YmFja2dyb3VuZDogInJlZCJ9fSkpCgkJdmFyIHZhbHVlQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmQKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7c3R5bGU6IHt9fSkpCgkJdmFyIHZhbHVlQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZAoJCXJldHVybiB2YWx1ZUJlZm9yZSA9PT0gInJlZCIgJiYgdmFsdWVBZnRlciA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdltzdHlsZT0nYmFja2dyb3VuZDpyZWQnXSIpKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uc3R5bGUgPT09ICJiYWNrZ3JvdW5kOnJlZCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtzdHlsZToge2JhY2tncm91bmQ6ICJyZWQifX0pKQoJCXZhciB2YWx1ZUJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge30pKQoJCXZhciB2YWx1ZUFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmQKCQlyZXR1cm4gdmFsdWVCZWZvcmUgPT09ICJyZWQiICYmIHZhbHVlQWZ0ZXIgPT09IHVuZGVmaW5lZAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIG1vZHVsZSA9IHt9LCB1bmxvYWRlZCA9IGZhbHNlCgkJbW9kdWxlLmNvbnRyb2xsZXIgPSBmdW5jdGlvbigpIHsKCQkJdGhpcy5vbnVubG9hZCA9IGZ1bmN0aW9uKCkge3VubG9hZGVkID0gdHJ1ZX0KCQl9CgkJbW9kdWxlLnZpZXcgPSBmdW5jdGlvbigpIHt9CgkJbS5tb2R1bGUocm9vdCwgbW9kdWxlKQoJCW0ubW9kdWxlKHJvb3QsIHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHt9fSkKCQlyZXR1cm4gdW5sb2FkZWQgPT09IHRydWUKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84NwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbbSgiYSIpLCBtKCJhIildLCBtKCJidXR0b24iKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbbSgiYSIpXSwgbSgiYnV0dG9uIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubGVuZ3RoID09IDIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZU5hbWUgPT0gIkJVVFRPTiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84NwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFttKCJhIiksIG0oImIiKSwgbSgiYnV0dG9uIildKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbbSgiYSIpLCBtKCJidXR0b24iKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlTmFtZSA9PSAiQlVUVE9OIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk5CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImltZyIpLCBtKCJoMSIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImEiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMSAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZSA9PSAiQSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImEiLCAiYiIsICJjIiwgImQiXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW1siZCIsICJlIl1dKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMiAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbWyJhIiwgImIiLCAiYyIsICJkIl1dKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImQiLCAiZSJdKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMiAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbIngiLCBbWyJhIl0sICJiIiwgImMiLCAiZCJdXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJkIiwgWyJlIl1dKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMiAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImIiXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW1siZSJdXSkpCgkJdmFyIGNoaWxkcmVuID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMKCQlyZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID09IDEgJiYgY2hpbGRyZW5bMF0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsIFsiYiJdXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJkIiwgW1siZSJdXV0pKQoJCXZhciBjaGlsZHJlbiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzCgkJcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA9PSAyICYmIGNoaWxkcmVuWzBdLm5vZGVWYWx1ZSA9PSAiZCIgJiYgY2hpbGRyZW5bMV0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsIFtbImIiXV1dKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImQiLCBbImUiXV0pKQoJCXZhciBjaGlsZHJlbiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzCgkJcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA9PSAyICYmIGNoaWxkcmVuWzBdLm5vZGVWYWx1ZSA9PSAiZCIgJiYgY2hpbGRyZW5bMV0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsIFtbImIiXSwgImMiXV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiZCIsIFtbWyJlIl1dLCAieCJdXSkpCgkJdmFyIGNoaWxkcmVuID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMKCQlyZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID09IDMgJiYgY2hpbGRyZW5bMF0ubm9kZVZhbHVlID09ICJkIiAmJiBjaGlsZHJlblsxXS5ub2RlVmFsdWUgPT0gImUiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCgkJdmFyIHN1Y2Nlc3MgPSBmYWxzZQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb25maWc6IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkge2N0eC5kYXRhID0gMX19KSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29uZmlnOiBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHtzdWNjZXNzID0gY3R4LmRhdGEgPT09IDF9fSkpCgkJcmV0dXJuIHN1Y2Nlc3MKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoKCQl2YXIgaW5kZXggPSAwOwoJCXZhciBzdWNjZXNzID0gdHJ1ZTsKCQl2YXIgc3RhdGVmdWxDb25maWcgPSBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHtjdHguZGF0YSA9IGluZGV4Kyt9CgkJdmFyIG5vZGUgPSBtKCJkaXYiLCB7Y29uZmlnOiBzdGF0ZWZ1bENvbmZpZ30pOwoJCW0ucmVuZGVyKHJvb3QsIFtub2RlLCBub2RlXSk7CgoJCWluZGV4ID0gMDsKCQl2YXIgY2hlY2tDb25maWcgPSBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHsKCQkJc3VjY2VzcyA9IHN1Y2Nlc3MgJiYgKGN0eC5kYXRhID09PSBpbmRleCsrKQoJCX0KCQlub2RlID0gbSgiZGl2Iiwge2NvbmZpZzogY2hlY2tDb25maWd9KTsKCQltLnJlbmRlcihyb290LCBbbm9kZSwgbm9kZV0pOwoJCXJldHVybiBzdWNjZXNzOwoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHBhcmVudAoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIG0oImEiLCB7CgkJCWNvbmZpZzogZnVuY3Rpb24oZWwpIHtwYXJlbnQgPSBlbC5wYXJlbnROb2RlLnBhcmVudE5vZGV9CgkJfSkpKTsKCQlyZXR1cm4gcGFyZW50ID09PSByb290Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgY291bnQgPSAwCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgbSgiYSIsIHsKCQkJY29uZmlnOiBmdW5jdGlvbihlbCkgewoJCQkJdmFyIGlzbGFuZCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQkJCWNvdW50KysKCQkJCWlmIChjb3VudCA+IDIpIHRocm93ICJ0b28gbXVjaCByZWN1cnNpb24uLi4iCgkJCQltLnJlbmRlcihpc2xhbmQsIG0oImRpdiIpKQoJCQl9CgkJfSkpKTsKCQlyZXR1cm4gY291bnQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyOQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbImZvbyIsICJiYXIiXSwgWyJmb28iLCAiYmFyIl0sIFsiZm9vIiwgImJhciJdXSkpOwoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYXNkZiIsICJhc2RmMiIsICJhc2RmMyJdKSk7CgkJcmV0dXJuIHRydWUKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy85OAoJCS8vaW5zZXJ0IGF0IGJlZ2lubmluZwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogM30pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KV0pCgkJdmFyIGZpcnN0QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMV0KCQlyZXR1cm4gZmlyc3RCZWZvcmUgPT0gZmlyc3RBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMF0ua2V5ID09IDQgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSA0Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvOTgKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KV0pCgkJdmFyIGZpcnN0QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzFdCgkJcmV0dXJuIGZpcnN0QmVmb3JlID09IGZpcnN0QWZ0ZXIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmtleSA9PSA0ICYmIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT0gMwoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk4CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSksIG0oImEiLCB7a2V5OiAzfSldKQoJCXZhciBmaXJzdEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogM30pLCBtKCJhIiwge2tleTogNH0pXSkKCQl2YXIgZmlyc3RBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PSBmaXJzdEFmdGVyICYmIHJvb3QuY2hpbGROb2Rlc1swXS5rZXkgPT09ICIyIiAmJiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09PSAzCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvOTgKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KSwgbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDV9KV0pCgkJdmFyIGZpcnN0QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJdmFyIHNlY29uZEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCXZhciBmb3VydGhCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbM10KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDEwfSksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzJdCgkJdmFyIHNlY29uZEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJdmFyIGZvdXJ0aEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGZpcnN0QmVmb3JlID09PSBmaXJzdEFmdGVyICYmIHNlY29uZEJlZm9yZSA9PT0gc2Vjb25kQWZ0ZXIgJiYgZm91cnRoQmVmb3JlID09PSBmb3VydGhBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMV0ua2V5ID09ICIxMCIgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gNAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk4CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSksIG0oImEiLCB7a2V5OiAzfSksIG0oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiA1fSldKQoJCXZhciBmaXJzdEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXZhciBzZWNvbmRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMV0KCQl2YXIgZm91cnRoQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiAxMH0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogNn0pLCBtKCJhIiwge2tleTogN30pXSkKCQl2YXIgZmlyc3RBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1szXQoJCXZhciBzZWNvbmRBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1syXQoJCXZhciBmb3VydGhBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PT0gZmlyc3RBZnRlciAmJiBzZWNvbmRCZWZvcmUgPT09IHNlY29uZEFmdGVyICYmIGZvdXJ0aEJlZm9yZSA9PT0gZm91cnRoQWZ0ZXIgJiYgcm9vdC5jaGlsZE5vZGVzWzFdLmtleSA9PSAiMTAiICYmIHJvb3QuY2hpbGROb2Rlc1s0XS5rZXkgPT0gIjYiICYmIHJvb3QuY2hpbGROb2Rlc1s1XS5rZXkgPT0gIjciICYmIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT09IDYKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIpLCBtKCJhIiwge2tleTogNH0pLCBtKCJhIiwge2tleTogNX0pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQl2YXIgc2Vjb25kQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzFdCgkJdmFyIHRoaXJkQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzJdCgkJdmFyIGZvdXJ0aEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1szXQoJCXZhciBmaWZ0aEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1s0XQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogNH0pLCBtKCJhIiwge2tleTogNX0pLCBtKCJhIiksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJdmFyIHNlY29uZEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzRdCgkJdmFyIHRoaXJkQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMl0KCQl2YXIgZm91cnRoQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQl2YXIgZmlmdGhBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PT0gZmlyc3RBZnRlciAmJiBzZWNvbmRCZWZvcmUgPT09IHNlY29uZEFmdGVyICYmIHRoaXJkQmVmb3JlID09PSB0aGlyZEFmdGVyICYmIGZvdXJ0aEJlZm9yZSA9PT0gZm91cnRoQWZ0ZXIgJiYgZmlmdGhCZWZvcmUgPT09IGZpZnRoQWZ0ZXIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8yNDYKCQkvL2luc2VydCBhdCBiZWdpbm5pbmcgd2l0aCBub24ta2V5ZWQgaW4gdGhlIG1pZGRsZQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMX0pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYnIiKSwgbSgiYSIsIHtrZXk6IDF9KV0pCgkJdmFyIGZpcnN0QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMl0KCQlyZXR1cm4gZmlyc3RCZWZvcmUgPT0gZmlyc3RBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMF0ua2V5ID09IDIgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSAzCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTM0CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbnRlbnRlZGl0YWJsZTogdHJ1ZX0sICJ0ZXN0IikpCgkJbW9jay5kb2N1bWVudC5hY3RpdmVFbGVtZW50ID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbnRlbnRlZGl0YWJsZTogdHJ1ZX0sICJ0ZXN0MSIpKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb250ZW50ZWRpdGFibGU6IGZhbHNlfSwgInRlc3QyIikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEzNgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInRleHRhcmVhIiwgWyJ0ZXN0Il0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInRleHRhcmVhIiwgWyJ0ZXN0MSJdKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLnZhbHVlID09PSAidGVzdDEiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yZW5kZXIocm9vdCwgWwoJCQltKCJkaXYiLCB7CgkJCQlrZXk6IDEsCgkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJdW5sb2FkZWQrKwoJCQkJCX0KCQkJCX0KCQkJfSkKCQldKQoJCW0ucmVuZGVyKHJvb3QsIFsKCQkJbSgiZGl2Iiwge2tleTogMn0pLAoJCQltKCJkaXYiLCB7CgkJCQlrZXk6IDEsCgkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJdW5sb2FkZWQrKwoJCQkJCX0KCQkJCX0KCQkJfSkKCQldKQoJCXJldHVybiB1bmxvYWRlZCA9PSAwCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWRQYXJlbnQgPSAwCgkJdmFyIHVubG9hZGVkQ2hpbGQgPSAwCgkJdmFyIGNvbmZpZ1BhcmVudCA9IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQl1bmxvYWRlZFBhcmVudCsrCgkJCX0KCQl9CgkJdmFyIGNvbmZpZ0NoaWxkID0gZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCXVubG9hZGVkQ2hpbGQrKwoJCQl9CgkJfQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29uZmlnOiBjb25maWdQYXJlbnR9LCBtKCJhIiwge2NvbmZpZzogY29uZmlnQ2hpbGR9KSkpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIHtjb25maWc6IGNvbmZpZ1BhcmVudH0sIG0oImEiLCB7Y29uZmlnOiBjb25maWdDaGlsZH0pKSkKCQlyZXR1cm4gdW5sb2FkZWRQYXJlbnQgPT09IDEgJiYgdW5sb2FkZWRDaGlsZCA9PT0gMAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkUGFyZW50ID0gMAoJCXZhciB1bmxvYWRlZENoaWxkID0gMAoJCXZhciBjb25maWdQYXJlbnQgPSBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJdW5sb2FkZWRQYXJlbnQrKwoJCQl9CgkJfQoJCXZhciBjb25maWdDaGlsZCA9IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQl1bmxvYWRlZENoaWxkKysKCQkJfQoJCX0KCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogY29uZmlnUGFyZW50fSwgbSgiYSIsIHtjb25maWc6IGNvbmZpZ0NoaWxkfSkpKQoJCW0ucmVuZGVyKHJvb3QsIG0oIm1haW4iLCB7Y29uZmlnOiBjb25maWdQYXJlbnR9LCBtKCJiIiwge2NvbmZpZzogY29uZmlnQ2hpbGR9KSkpCgkJcmV0dXJuIHVubG9hZGVkUGFyZW50ID09PSAxICYmIHVubG9hZGVkQ2hpbGQgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xNTAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIpLCBtKCJkaXYiKV0pCgkJbS5yZW5kZXIocm9vdCwgW1tdLCBtKCJkaXYiKV0pCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT0gMSAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT0gIkRJViIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xNTYKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbCgkJCVsiYSIsICJiIiwgImMiLCAiZCJdLm1hcChmdW5jdGlvbigpIHsKCQkJCXJldHVybiBbbSgiZGl2IiksICIgIl0KCQkJfSksCgkJCW0oInNwYW4iKQoJCV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1s4XS5ub2RlTmFtZSA9PSAiU1BBTiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xNTcKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIsIHtrZXk6IDB9KSwgbSgibGkiLCB7a2V5OiAyfSksIG0oImxpIiwge2tleTogNH0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCB7a2V5OiAwfSksIG0oImxpIiwge2tleTogMX0pLCBtKCJsaSIsIHtrZXk6IDJ9KSwgbSgibGkiLCB7a2V5OiAzfSksIG0oImxpIiwge2tleTogNH0pLCBtKCJsaSIsIHtrZXk6IDV9KV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5tYXAoZnVuY3Rpb24obikge3JldHVybiBuLmtleX0pLmpvaW4oIiIpID09ICIwMTIzNDUiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTU3CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiaW5wdXQiLCB7dmFsdWU6ICJhIn0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImlucHV0Iiwge3ZhbHVlOiAiYWEifSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAwCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTU3CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiYnIiLCB7Y2xhc3M6ICJhIn0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImJyIiwge2NsYXNzOiAiYWEifSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAwCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTk0CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCB7a2V5OiAwfSksIG0oImxpIiwge2tleTogMX0pLCBtKCJsaSIsIHtrZXk6IDJ9KSwgbSgibGkiLCB7a2V5OiAzfSksIG0oImxpIiwge2tleTogNH0pLCBtKCJsaSIsIHtrZXk6IDV9KV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiwge2tleTogMH0pLCBtKCJsaSIsIHtrZXk6IDF9KSwgbSgibGkiLCB7a2V5OiAyfSksIG0oImxpIiwge2tleTogNH0pLCBtKCJsaSIsIHtrZXk6IDV9KV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5tYXAoZnVuY3Rpb24obikge3JldHVybiBuLmtleX0pLmpvaW4oIiIpID09ICIwMTI0NSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xOTQKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIsIHtrZXk6IDB9KSwgbSgibGkiLCB7a2V5OiAxfSksIG0oImxpIiwge2tleTogMn0pLCBtKCJsaSIsIHtrZXk6IDN9KSwgbSgibGkiLCB7a2V5OiA0fSksIG0oImxpIiwge2tleTogNX0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCB7a2V5OiAxfSksIG0oImxpIiwge2tleTogMn0pLCBtKCJsaSIsIHtrZXk6IDN9KSwgbSgibGkiLCB7a2V5OiA0fSksIG0oImxpIiwge2tleTogNX0pLCBtKCJsaSIsIHtrZXk6IDZ9KV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiwge2tleTogMTJ9KSwgbSgibGkiLCB7a2V5OiAxM30pLCBtKCJsaSIsIHtrZXk6IDE0fSksIG0oImxpIiwge2tleTogMTV9KSwgbSgibGkiLCB7a2V5OiAxNn0pLCBtKCJsaSIsIHtrZXk6IDE3fSldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubWFwKGZ1bmN0aW9uKG4pIHtyZXR1cm4gbi5rZXl9KS5qb2luKCIsIikgPT0gIjEyLDEzLDE0LDE1LDE2LDE3IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzIwNgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHVuZGVmaW5lZCkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImRpdiIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMjA2CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgbnVsbCkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImRpdiIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMjAwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgoJCXZhciB1bmxvYWRlZDEgPSBmYWxzZQoJCWZ1bmN0aW9uIHVubG9hZGFibGUxKGVsZW1lbnQsIGlzSW5pdCwgY29udGV4dCkgewoJCQljb250ZXh0Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQl1bmxvYWRlZDEgPSB0cnVlCgkJCX0KCQl9CgkJbS5yZW5kZXIocm9vdCwgWyBtKCJkaXYiLCB7Y29uZmlnOiB1bmxvYWRhYmxlMX0pIF0pCgkJbS5yZW5kZXIocm9vdCwgWyBdKQoKCQl2YXIgdW5sb2FkZWQyID0gZmFsc2UKCQlmdW5jdGlvbiB1bmxvYWRhYmxlMihlbGVtZW50LCBpc0luaXQsIGNvbnRleHQpIHsKCQkJY29udGV4dC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJdW5sb2FkZWQyID0gdHJ1ZQoJCQl9CgkJfQoJCW0ucmVuZGVyKHJvb3QsIFsgbSgiZGl2Iiwge2NvbmZpZzogdW5sb2FkYWJsZTJ9KSBdKQoJCW0ucmVuZGVyKHJvb3QsIFsgXSkKCgkJcmV0dXJuIHVubG9hZGVkMSA9PT0gdHJ1ZSAmJiB1bmxvYWRlZDIgPT09IHRydWUKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJkaXYuYmx1ZSIpXSkKCQltLnJlbmRlcihyb290LCBbbSgiZGl2LmdyZWVuIiwgW20oImRpdiIpXSksIG0oImRpdi5ibHVlIildKQoJCXJldHVybiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8yNzcKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQlmdW5jdGlvbiBGaWVsZCgpIHsKCQkJdGhpcy50YWcgPSAiZGl2IjsKCQkJdGhpcy5hdHRycyA9IHt9OwoJCQl0aGlzLmNoaWxkcmVuID0gImhlbGxvIjsKCQl9CgkJbS5yZW5kZXIocm9vdCwgbmV3IEZpZWxkKCkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiKV0pKQoJCXZhciBjaGFuZ2UgPSBmdW5jdGlvbigpIHsKCQkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBhcmd1bWVudHMpKQoJCX0KCQljaGFuZ2UobSgiYiIpKTsKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT0gIkIiCgl9KQoJLy9lbmQgbS5yZW5kZXIKCgkvL20ucmVkcmF3Cgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCXZhciBjb250cm9sbGVyCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5tb2R1bGUocm9vdCwgewoJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHtjb250cm9sbGVyID0gdGhpc30sCgkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHtyZXR1cm4gY3RybC52YWx1ZX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQl2YXIgdmFsdWVCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlCgkJY29udHJvbGxlci52YWx1ZSA9ICJmb28iCgkJbS5yZWRyYXcoKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQlyZXR1cm4gdmFsdWVCZWZvcmUgPT09ICIiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQl2YXIgY291bnQgPSAwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5tb2R1bGUocm9vdCwgewoJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQl2aWV3OiBmdW5jdGlvbihjdHJsKSB7CgkJCQljb3VudCsrCgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCW0ucmVkcmF3KCkgLy9zaG91bGQgcnVuIHN5bmNocm9ub3VzbHkKCgkJbS5yZWRyYXcoKSAvL3Jlc3Qgc2hvdWxkIHJ1biBhc3luY2hyb25vdXNseSBzaW5jZSB0aGV5J3JlIHNwYW1taW5nCgkJbS5yZWRyYXcoKQoJCW0ucmVkcmF3KCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gY291bnQgPT09IDMKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCXZhciBjb3VudCA9IDAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLm1vZHVsZShyb290LCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHsKCQkJCWNvdW50KysKCQkJfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJbS5yZWRyYXcodHJ1ZSkgLy9zaG91bGQgcnVuIHN5bmNocm9ub3VzbHkKCgkJbS5yZWRyYXcodHJ1ZSkgLy9mb3JjZWQgdG8gcnVuIHN5bmNocm9ub3VzbHkKCQltLnJlZHJhdyh0cnVlKQoJCW0ucmVkcmF3KHRydWUpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIGNvdW50ID09PSA1Cgl9KQoKCS8vbS5yb3V0ZQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0MSIsIHsKCQkJIi90ZXN0MSI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImZvbyJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QxIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5wYXRobmFtZSA9ICIvIgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAicGF0aG5hbWUiCgkJbS5yb3V0ZShyb290LCAiL3Rlc3QyIiwgewoJCQkiL3Rlc3QyIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5wYXRobmFtZSA9PSAiL3Rlc3QyIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5oYXNoID0gIiMiCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJoYXNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0MyIsIHsKCQkJIi90ZXN0MyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImZvbyJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uaGFzaCA9PSAiIy90ZXN0MyIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q0L2ZvbyIsIHsKCQkJIi90ZXN0NC86dGVzdCI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gbS5yb3V0ZS5wYXJhbSgidGVzdCIpfX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0NC9mb28iICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgbW9kdWxlID0ge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiBtLnJvdXRlLnBhcmFtKCJ0ZXN0Iil9fQoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0NS9mb28iLCB7CgkJCSIvIjogbW9kdWxlLAoJCQkiL3Rlc3Q1Lzp0ZXN0IjogbW9kdWxlCgkJfSkKCQl2YXIgcGFyYW1WYWx1ZUJlZm9yZSA9IG0ucm91dGUucGFyYW0oInRlc3QiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvIikKCQl2YXIgcGFyYW1WYWx1ZUFmdGVyID0gbS5yb3V0ZS5wYXJhbSgidGVzdCIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/LyIgJiYgcGFyYW1WYWx1ZUJlZm9yZSA9PT0gImZvbyIgJiYgcGFyYW1WYWx1ZUFmdGVyID09PSB1bmRlZmluZWQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciBtb2R1bGUgPSB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oImExIil9fQoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0Ni9mb28iLCB7CgkJCSIvIjogbW9kdWxlLAoJCQkiL3Rlc3Q2LzphMSI6IG1vZHVsZQoJCX0pCgkJdmFyIHBhcmFtVmFsdWVCZWZvcmUgPSBtLnJvdXRlLnBhcmFtKCJhMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi8iKQoJCXZhciBwYXJhbVZhbHVlQWZ0ZXIgPSBtLnJvdXRlLnBhcmFtKCJhMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/LyIgJiYgcGFyYW1WYWx1ZUJlZm9yZSA9PT0gImZvbyIgJiYgcGFyYW1WYWx1ZUFmdGVyID09PSB1bmRlZmluZWQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy82MQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciBtb2R1bGUgPSB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oImExIil9fQoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0Ny9mb28iLCB7CgkJCSIvIjogbW9kdWxlLAoJCQkiL3Rlc3Q3LzphMSI6IG1vZHVsZQoJCX0pCgkJdmFyIHJvdXRlVmFsdWVCZWZvcmUgPSBtLnJvdXRlKCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiLyIpCgkJdmFyIHJvdXRlVmFsdWVBZnRlciA9IG0ucm91dGUoKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiByb3V0ZVZhbHVlQmVmb3JlID09PSAiL3Rlc3Q3L2ZvbyIgJiYgcm91dGVWYWx1ZUFmdGVyID09PSAiLyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q4L2Zvby9TRVAvYmFyL2JheiIsIHsKCQkJIi90ZXN0OC86dGVzdC9TRVAvOnBhdGguLi4iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKSArICJfIiArIG0ucm91dGUucGFyYW0oInBhdGgiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDgvZm9vL1NFUC9iYXIvYmF6IiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vX2Jhci9iYXoiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0OS9mb28vYmFyL1NFUC9iYXoiLCB7CgkJCSIvdGVzdDkvOnRlc3QuLi4vU0VQLzpwYXRoIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtLnJvdXRlLnBhcmFtKCJ0ZXN0IikgKyAiXyIgKyBtLnJvdXRlLnBhcmFtKCJwYXRoIikKCQkJCX0KCQkJfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3Q5L2Zvby9iYXIvU0VQL2JheiIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvby9iYXJfYmF6IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvdGVzdDEwL2ZvbyUyMGJhciIsIHsKCQkJIi90ZXN0MTAvOnRlc3QiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvbyBiYXIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19LAoJCQkiL3Rlc3QxMSI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MTEvIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDExLyIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImJhciIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7fX0sCgkJCSIvdGVzdDEyIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMj9hPWZvbyZiPWJhciIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QxMj9hPWZvbyZiPWJhciIgJiYgbS5yb3V0ZS5wYXJhbSgiYSIpID09ICJmb28iICYmIG0ucm91dGUucGFyYW0oImIiKSA9PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fSwKCQkJIi90ZXN0MTMvOnRlc3QiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKX19CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMy9mb28/dGVzdD1iYXIiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MTMvZm9vP3Rlc3Q9YmFyIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fSwKCQkJIi90ZXN0MTQiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuICJmb28ifX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDE0P3Rlc3QmdGVzdDI9IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDE0P3Rlc3QmdGVzdDI9IiAmJiBtLnJvdXRlLnBhcmFtKCJ0ZXN0IikgPT09IHRydWUgJiYgbS5yb3V0ZS5wYXJhbSgidGVzdDIiKSA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7fX0sCgkJCSIvdGVzdDEyIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMiIsIHthOiAiZm9vIiwgYjogImJhciJ9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MTI/YT1mb28mYj1iYXIiICYmIG0ucm91dGUucGFyYW0oImEiKSA9PSAiZm9vIiAmJiBtLnJvdXRlLnBhcmFtKCJiIikgPT0gImJhciIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciByb3V0ZTEsIHJvdXRlMgoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7cm91dGUxID0gbS5yb3V0ZSgpfSwgdmlldzogZnVuY3Rpb24oKSB7fX0sCgkJCSIvdGVzdDEzIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3JvdXRlMiA9IG0ucm91dGUoKX0sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMyIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHJvdXRlMSA9PSAiLyIgJiYgcm91dGUyID09ICIvdGVzdDEzIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIHsKCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QxNCI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHt9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MTQiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiB1bmxvYWRlZCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiKSwKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QxNSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gW20oImRpdiIpXQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCB7CgkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSkKCQkJCX0KCQkJfSwKCQkJIi90ZXN0MTYiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImEiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNiIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBbCgkJCQkJCW0oImRpdiIsIHsKCQkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9KQoJCQkJCV0KCQkJCX0KCQkJfSwKCQkJIi90ZXN0MTciOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImEiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNyIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCB7CgkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSkKCQkJCX0KCQkJfSwKCQkJIi90ZXN0MTgiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFttKCJhIildCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDE4IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFsKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJa2V5OiAxLAoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QyMCI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiLCB7CgkJCQkJCQlrZXk6IDIsCgkJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkKCQkJCQldCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDIwIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFsKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJa2V5OiAxLAoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QyMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiLCB7CgkJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkKCQkJCQldCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDIxIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvZm9vIiwgewoJCQkiL2ZvbyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2IiwgImZvbyIpOwoJCQkJfQoJCQl9LAoJCQkiL2JhciI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2IiwgImJhciIpOwoJCQkJfQoJCQl9LAoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCXZhciBmb28gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWU7CgkJbS5yb3V0ZSgiL2JhciIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJdmFyIGJhciA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZTsKCQlyZXR1cm4gKGZvbyA9PT0gImZvbyIgJiYgYmFyID09PSAiYmFyIikKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQl2YXIgY29uZmlnID0gZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCXVubG9hZGVkKysKCQkJfQoJCX0KCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi9mb28xIiwgewoJCQkiL2ZvbzEiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIG0oImEiLCB7Y29uZmlnOiBjb25maWd9LCAiZm9vIikpOwoJCQkJfQoJCQl9LAoJCQkiL2JhcjEiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oIm1haW4iLCBtKCJhIiwge2NvbmZpZzogY29uZmlnfSwgImZvbyIpKTsKCQkJCX0KCQkJfSwKCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvYmFyMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciBzdHJhdGVneQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL2ZvbzEiLCB7CgkJCSIvZm9vMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkgewoJCQkJCXN0cmF0ZWd5ID0gbS5yZWRyYXcuc3RyYXRlZ3koKQoJCQkJCW0ucmVkcmF3LnN0cmF0ZWd5KCJub25lIikKCQkJCX0sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2Iik7CgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBzdHJhdGVneSA9PSAiYWxsIiAmJiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDAKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciBzdHJhdGVneSwgY291bnQgPSAwCgkJdmFyIGNvbmZpZyA9IGZ1bmN0aW9uKGVsLCBpbml0KSB7aWYgKCFpbml0KSBjb3VudCsrfQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL2ZvbzEiLCB7CgkJCSIvZm9vMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2Iiwge2NvbmZpZzogY29uZmlnfSk7CgkJCQl9CgkJCX0sCgkJCSIvYmFyMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkgewoJCQkJCXN0cmF0ZWd5ID0gbS5yZWRyYXcuc3RyYXRlZ3koKQoJCQkJCW0ucmVkcmF3LnN0cmF0ZWd5KCJyZWRyYXciKQoJCQkJfSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCB7Y29uZmlnOiBjb25maWd9KTsKCQkJCX0KCQkJfSwKCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvYmFyMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHN0cmF0ZWd5ID09ICJhbGwiICYmIGNvdW50ID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciBzdHJhdGVneQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL2ZvbzEiLCB7CgkJCSIvZm9vMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3RoaXMubnVtYmVyID0gMX0sCgkJCQl2aWV3OiBmdW5jdGlvbihjdHJsKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIHtvbmNsaWNrOiBmdW5jdGlvbigpIHsKCQkJCQkJc3RyYXRlZ3kgPSBtLnJlZHJhdy5zdHJhdGVneSgpCgkJCQkJCWN0cmwubnVtYmVyKysKCQkJCQkJbS5yZWRyYXcuc3RyYXRlZ3koIm5vbmUiKQoJCQkJCX19LCBjdHJsLm51bWJlcik7CgkJCQl9CgkJCX0KCQl9KQoJCXJvb3QuY2hpbGROb2Rlc1swXS5vbmNsaWNrKHt9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBzdHJhdGVneSA9PSAiZGlmZiIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09ICIxIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIGNvdW50ID0gMAoJCXZhciBjb25maWcgPSBmdW5jdGlvbihlbCwgaW5pdCApIHtpZiAoIWluaXQpIGNvdW50Kyt9CgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvZm9vMSIsIHsKCQkJIi9mb28xIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHsKCQkJCQlyZXR1cm4gbSgiZGl2Iiwge2NvbmZpZzogY29uZmlnLCBvbmNsaWNrOiBmdW5jdGlvbigpIHsKCQkJCQkJbS5yZWRyYXcuc3RyYXRlZ3koImFsbCIpCgkJCQkJfX0pOwoJCQkJfQoJCQl9CgkJfSkKCQlyb290LmNoaWxkTm9kZXNbMF0ub25jbGljayh7fSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gY291bnQgPT0gMgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHZhbHVlCgkJbS5yb3V0ZShyb290LCAiL2ZvbytiYXIiLCB7CgkJCSIvOmFyZyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3ZhbHVlID0gbS5yb3V0ZS5wYXJhbSgiYXJnIil9LAoJCQkJdmlldzogZnVuY3Rpb24oY3RybCkgewoJCQkJCXJldHVybiAiIgoJCQkJfQoJCQl9CgkJfSkKCQlyZXR1cm4gdmFsdWUgPT0gImZvbytiYXIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19LAoJCQkiL3Rlc3QyMiI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoU3RyaW5nKCIvdGVzdDIyLyIpKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MjIvIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImZvbyJ9fSwKCQkJIi90ZXN0MjMiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuICJiYXIifX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKG5ldyBTdHJpbmcoIi90ZXN0MjMvIikpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QyMy8iICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJiYXIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdmFsdWUKCQltLnJvdXRlKHJvb3QsIFN0cmluZygiL2ZvbytiYXIiKSwgewoJCQkiLzphcmciOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt2YWx1ZSA9IG0ucm91dGUucGFyYW0oImFyZyIpfSwKCQkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHsKCQkJCQlyZXR1cm4gIiIKCQkJCX0KCQkJfQoJCX0pCgkJcmV0dXJuIHZhbHVlID09ICJmb28rYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHZhbHVlCgkJbS5yb3V0ZShyb290LCBuZXcgU3RyaW5nKCIvZm9vK2JhciIpLCB7CgkJCSIvOmFyZyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3ZhbHVlID0gbS5yb3V0ZS5wYXJhbSgiYXJnIil9LAoJCQkJdmlldzogZnVuY3Rpb24oY3RybCkgewoJCQkJCXJldHVybiAiIgoJCQkJfQoJCQl9CgkJfSkKCQlyZXR1cm4gdmFsdWUgPT0gImZvbytiYXIiCgl9KQoJLy9lbmQgbS5yb3V0ZQoKCS8vbS5wcm9wCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5wcm9wKCJ0ZXN0IikKCQlyZXR1cm4gcHJvcCgpID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5wcm9wKCJ0ZXN0IikKCQlwcm9wKCJmb28iKQoJCXJldHVybiBwcm9wKCkgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcHJvcCA9IG0ucHJvcCgidGVzdCIpCgkJcmV0dXJuIEpTT04uc3RyaW5naWZ5KHByb3ApID09PSAnInRlc3QiJwoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIG9iaiA9IHtwcm9wOiBtLnByb3AoInRlc3QiKX0KCQlyZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqKSA9PT0gJ3sicHJvcCI6InRlc3QifScKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBkZWZlciA9IG0uZGVmZXJyZWQoKQoJCXZhciBwcm9wID0gbS5wcm9wKGRlZmVyLnByb21pc2UpCgkJZGVmZXIucmVzb2x2ZSgidGVzdCIpCgoJCXJldHVybiBwcm9wKCkgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGRlZmVyID0gbS5kZWZlcnJlZCgpCgkJdmFyIHByb3AgPSBtLnByb3AoZGVmZXIucHJvbWlzZSkudGhlbihmdW5jdGlvbiAoKSB7CgkJCXJldHVybiAidGVzdDIiCgkJfSkKCQlkZWZlci5yZXNvbHZlKCJ0ZXN0IikKCgkJcmV0dXJuIHByb3AoKSA9PT0gInRlc3QyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHByb3AgPSBtLnByb3AobnVsbCkKCQlyZXR1cm4gcHJvcCgpID09PSBudWxsCgl9KQoKCS8vbS5yZXF1ZXN0Cgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJHRVQiLCB1cmw6ICJ0ZXN0In0pCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKS5tZXRob2QgPT09ICJHRVQiICYmIHByb3AoKS51cmwgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHByb3AgPSBtLnJlcXVlc3Qoe21ldGhvZDogIkdFVCIsIHVybDogInRlc3QifSkudGhlbihmdW5jdGlvbih2YWx1ZSkge3JldHVybiAiZm9vIn0pCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJQT1NUIiwgdXJsOiAiaHR0cDovL2RvbWFpbi5jb206ODAiLCBkYXRhOiB7fX0pLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtyZXR1cm4gdmFsdWV9KQoJCW1vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKS5vbnJlYWR5c3RhdGVjaGFuZ2UoKQoJCXJldHVybiBwcm9wKCkudXJsID09PSAiaHR0cDovL2RvbWFpbi5jb206ODAiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcHJvcCA9IG0ucmVxdWVzdCh7bWV0aG9kOiAiUE9TVCIsIHVybDogImh0dHA6Ly9kb21haW4uY29tOjgwLzp0ZXN0MSIsIGRhdGE6IHt0ZXN0MTogImZvbyJ9fSkudGhlbihmdW5jdGlvbih2YWx1ZSkge3JldHVybiB2YWx1ZX0pCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKS51cmwgPT09ICJodHRwOi8vZG9tYWluLmNvbTo4MC9mb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZXJyb3IgPSBtLnByb3AoIm5vIGVycm9yIikKCQl2YXIgcHJvcCA9IG0ucmVxdWVzdCh7bWV0aG9kOiAiR0VUIiwgdXJsOiAidGVzdCIsIGRlc2VyaWFsaXplOiBmdW5jdGlvbigpIHt0aHJvdyBuZXcgRXJyb3IoImVycm9yIG9jY3VycmVkIil9fSkudGhlbihudWxsLCBlcnJvcikKCQltb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkub25yZWFkeXN0YXRlY2hhbmdlKCkKCQlyZXR1cm4gcHJvcCgpLm1lc3NhZ2UgPT09ICJlcnJvciBvY2N1cnJlZCIgJiYgZXJyb3IoKS5tZXNzYWdlID09PSAiZXJyb3Igb2NjdXJyZWQiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZXJyb3IgPSBtLnByb3AoIm5vIGVycm9yIiksIGV4Y2VwdGlvbgoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJHRVQiLCB1cmw6ICJ0ZXN0IiwgZGVzZXJpYWxpemU6IGZ1bmN0aW9uKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoImVycm9yIG9jY3VycmVkIil9fSkudGhlbihudWxsLCBlcnJvcikKCQl0cnkge21vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKS5vbnJlYWR5c3RhdGVjaGFuZ2UoKX0KCQljYXRjaCAoZSkge2V4Y2VwdGlvbiA9IGV9CgkJbS5lbmRDb21wdXRhdGlvbigpCgkJcmV0dXJuIHByb3AoKSA9PT0gdW5kZWZpbmVkICYmIGVycm9yKCkgPT09ICJubyBlcnJvciIgJiYgZXhjZXB0aW9uLm1lc3NhZ2UgPT0gImVycm9yIG9jY3VycmVkIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGVycm9yID0gbS5wcm9wKCJubyBlcnJvciIpCgkJdmFyIHByb3AgPSBtLnJlcXVlc3Qoe21ldGhvZDogIlBPU1QiLCB1cmw6ICJ0ZXN0IiwgZGF0YToge2ZvbzogMX19KS50aGVuKG51bGwsIGVycm9yKQoJCXZhciB4aHIgPSBtb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkKCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlKCkKCQlyZXR1cm4geGhyLiRoZWFkZXJzWyJDb250ZW50LVR5cGUiXSA9PSAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBlcnJvciA9IG0ucHJvcCgibm8gZXJyb3IiKQoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJQT1NUIiwgdXJsOiAidGVzdCJ9KS50aGVuKG51bGwsIGVycm9yKQoJCXZhciB4aHIgPSBtb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkKCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlKCkKCQlyZXR1cm4geGhyLiRoZWFkZXJzWyJDb250ZW50LVR5cGUiXSA9PT0gdW5kZWZpbmVkCgl9KQoKCS8vIG0ucmVxdWVzdCBvdmVyIGpzb25wCgl0ZXN0KGZ1bmN0aW9uKCl7CgkJLy8gc2NyaXB0IHRhZ3MgY2Fubm90IGJlIGFwcGVuZGVkIGRpcmVjdGx5IG9uIHRoZSBkb2N1bWVudAoJCXZhciBib2R5ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJib2R5Iik7CgkJbW9jay5kb2N1bWVudC5ib2R5ID0gYm9keTsKCQltb2NrLmRvY3VtZW50LmFwcGVuZENoaWxkKGJvZHkpOwoKCQl2YXIJZXJyb3IgPSBtLnByb3AoIm5vIGVycm9yIik7CgkJdmFyIGRhdGEKCQl2YXIgcmVxID0gbS5yZXF1ZXN0KHt1cmw6ICIvdGVzdCIsIGRhdGFUeXBlOiAianNvbnAifSkudGhlbihmdW5jdGlvbihyZWNlaXZlZCkge2RhdGEgPSByZWNlaXZlZH0sIGVycm9yKTsKCQl2YXIgY2FsbGJhY2tLZXkgPSBPYmplY3Qua2V5cyhtb2NrKS5maWx0ZXIoZnVuY3Rpb24oZ2xvYmFsS2V5KXsKCQkJcmV0dXJuIGdsb2JhbEtleS5pbmRleE9mKCJtaXRocmlsX2NhbGxiYWNrIikgPiAtMQoJCX0pLnBvcCgpOwoJCXZhciBzY3JpcHRUYWcgPSBbXS5zbGljZS5jYWxsKG1vY2suZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpKS5maWx0ZXIoZnVuY3Rpb24oc2NyaXB0KXsKCQkJcmV0dXJuIHNjcmlwdC5zcmMuaW5kZXhPZihjYWxsYmFja0tleSkgPiAtMQoJCX0pLnBvcCgpOwoJCW1vY2tbY2FsbGJhY2tLZXldKHtmb286ICJiYXIifSkKCQltb2NrLmRvY3VtZW50LnJlbW92ZUNoaWxkKGJvZHkpOwoJCXJldHVybiBzY3JpcHRUYWcuc3JjLmluZGV4T2YoIi90ZXN0P2NhbGxiYWNrPW1pdGhyaWxfY2FsbGJhY2siKSA+IC0xICYmIGRhdGEuZm9vID09ICJiYXIiOwoJfSkKCXRlc3QoZnVuY3Rpb24oKXsKCQkvLyBzY3JpcHQgdGFncyBjYW5ub3QgYmUgYXBwZW5kZWQgZGlyZWN0bHkgb24gdGhlIGRvY3VtZW50CgkJdmFyIGJvZHkgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJvZHkiKTsKCQltb2NrLmRvY3VtZW50LmJvZHkgPSBib2R5OwoJCW1vY2suZG9jdW1lbnQuYXBwZW5kQ2hpbGQoYm9keSk7CgoJCXZhcgllcnJvciA9IG0ucHJvcCgibm8gZXJyb3IiKTsKCQl2YXIgZGF0YQoJCXZhciByZXEgPSBtLnJlcXVlc3Qoe3VybDogIi90ZXN0IiwgZGF0YVR5cGU6ICJqc29ucCIsIGNhbGxiYWNrS2V5OiAianNvbnBDYWxsYmFjayJ9KS50aGVuKGZ1bmN0aW9uKHJlY2VpdmVkKSB7ZGF0YSA9IHJlY2VpdmVkfSwgZXJyb3IpOwoJCXZhciBjYWxsYmFja0tleSA9IE9iamVjdC5rZXlzKG1vY2spLmZpbHRlcihmdW5jdGlvbihnbG9iYWxLZXkpewoJCQlyZXR1cm4gZ2xvYmFsS2V5LmluZGV4T2YoIm1pdGhyaWxfY2FsbGJhY2siKSA+IC0xCgkJfSkucG9wKCk7CgkJdmFyIHNjcmlwdFRhZyA9IFtdLnNsaWNlLmNhbGwobW9jay5kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IikpLmZpbHRlcihmdW5jdGlvbihzY3JpcHQpewoJCQlyZXR1cm4gc2NyaXB0LnNyYy5pbmRleE9mKGNhbGxiYWNrS2V5KSA+IC0xCgkJfSkucG9wKCk7CgkJbW9ja1tjYWxsYmFja0tleV0oe2ZvbzogImJhcjEifSkKCQltb2NrLmRvY3VtZW50LnJlbW92ZUNoaWxkKGJvZHkpOwoJCXJldHVybiBzY3JpcHRUYWcuc3JjLmluZGV4T2YoIi90ZXN0P2pzb25wQ2FsbGJhY2s9bWl0aHJpbF9jYWxsYmFjayIpID4gLTEgJiYgZGF0YS5mb28gPT0gImJhcjEiOwoJfSkKCXRlc3QoZnVuY3Rpb24oKXsKCQl2YXIgYm9keSA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYm9keSIpOwoJCW1vY2suZG9jdW1lbnQuYm9keSA9IGJvZHk7CgkJbW9jay5kb2N1bWVudC5hcHBlbmRDaGlsZChib2R5KTsKCgkJdmFyIF93aW5kb3cgPSBtb2NrOwoJCXZhciByZXEgPSBtLnJlcXVlc3QoewoJCQl1cmw6ICIvdGVzdCIsCgkJCWRhdGFUeXBlOiAianNvbnAiLAoJCQliYWNrZ3JvdW5kOiB0cnVlCgkJfSk7CgkJdmFyIGNhbGxiYWNrS2V5cyA9IFtdOwoJCU9iamVjdC5rZXlzKF93aW5kb3cpLmZvckVhY2goZnVuY3Rpb24oZ2xvYmFsS2V5KXsKCQkJaWYoZ2xvYmFsS2V5LmluZGV4T2YoIm1pdGhyaWxfY2FsbGJhY2siKSA+IC0xKQoJCQkJY2FsbGJhY2tLZXlzLnB1c2goZ2xvYmFsS2V5KTsKCQl9KTsKCQl2YXIgc2NyaXB0VGFnID0gbnVsbDsKCQltb2NrLmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKS5mb3JFYWNoKGZ1bmN0aW9uKHNjcmlwdCl7CgkJCWlmKCFzY3JpcHRUYWcgJiYgc2NyaXB0LnNyYy5pbmRleE9mKGNhbGxiYWNrS2V5c1swXSkgPiAtMSkKCQkJCXNjcmlwdFRhZyA9IHNjcmlwdDsKCQl9KTsKCQl2YXIgb3V0ID0geyBmb286ICJiYXIiIH07CgkJaWYoc2NyaXB0VGFnICYmIGNhbGxiYWNrS2V5cy5sZW5ndGggPiAwKXsKCQkJX3dpbmRvd1tjYWxsYmFja0tleXNbMF1dKG91dCk7CgkJCW1vY2suZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JpcHRUYWcpOwoJCQlkZWxldGUgX3dpbmRvd1tjYWxsYmFja0tleXNbMF1dOwoJCX0KCQltb2NrLmRvY3VtZW50LnJlbW92ZUNoaWxkKGJvZHkpOwoJCXJldHVybiBKU09OLnN0cmluZ2lmeShvdXQpID09PSBKU09OLnN0cmluZ2lmeShyZXEoKSk7Cgl9KQoJdGVzdChmdW5jdGlvbigpewoJCXZhciBib2R5ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJib2R5Iik7CgkJbW9jay5kb2N1bWVudC5ib2R5ID0gYm9keTsKCQltb2NrLmRvY3VtZW50LmFwcGVuZENoaWxkKGJvZHkpOwoKCQl2YXIgX3dpbmRvdyA9IG1vY2s7CgkJdmFyIGVycm9yID0gbS5wcm9wKGZhbHNlKTsKCQl2YXIgcmVxID0gbS5yZXF1ZXN0KHsKCQkJdXJsOiAiL3Rlc3QiLAoJCQlkYXRhVHlwZTogImpzb25wIiwKCQkJZGF0YTogeyBmb286ICJiYXIiIH0sCgkJCWJhY2tncm91bmQ6IHRydWUKCQl9KTsKCQl2YXIgY2FsbGJhY2tLZXlzID0gW107CgkJT2JqZWN0LmtleXMoX3dpbmRvdykuZm9yRWFjaChmdW5jdGlvbihnbG9iYWxLZXkpewoJCQlpZihnbG9iYWxLZXkuaW5kZXhPZigibWl0aHJpbF9jYWxsYmFjayIpID4gLTEpCgkJCQljYWxsYmFja0tleXMucHVzaChnbG9iYWxLZXkpOwoJCX0pOwoJCXZhciBzY3JpcHRUYWcgPSBudWxsOwoJCW1vY2suZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpLmZvckVhY2goZnVuY3Rpb24oc2NyaXB0KXsKCQkJaWYoIXNjcmlwdFRhZyAmJiBzY3JpcHQuc3JjLmluZGV4T2YoY2FsbGJhY2tLZXlzWzBdKSA+IC0xKQoJCQkJc2NyaXB0VGFnID0gc2NyaXB0OwoJCX0pOwoJCXZhciBjb3JyZWN0RGF0YSA9IGZhbHNlOwoJCWlmKHNjcmlwdFRhZyl7CgkJCWNvcnJlY3REYXRhID0gc2NyaXB0VGFnLnNyYy5pbmRleE9mKCJmb289YmFyIikgPiAtMTsKCQkJbW9jay5kb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHNjcmlwdFRhZyk7CgkJCWRlbGV0ZSBfd2luZG93W2NhbGxiYWNrS2V5c1swXV07CgkJfQoJCW1vY2suZG9jdW1lbnQucmVtb3ZlQ2hpbGQoYm9keSk7CgkJcmV0dXJuIGNvcnJlY3REYXRhOwoJfSkKCgkvL20uZGVmZXJyZWQKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkLnJlc29sdmUoInRlc3QiKQoJCXJldHVybiB2YWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgdmFsdWUKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkge3JldHVybiAiZm9vIn0pLnRoZW4oZnVuY3Rpb24oZGF0YSkge3ZhbHVlID0gZGF0YX0pCgkJZGVmZXJyZWQucmVzb2x2ZSgidGVzdCIpCgkJcmV0dXJuIHZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkLnJlamVjdCgidGVzdCIpCgkJcmV0dXJuIHZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihudWxsLCBmdW5jdGlvbihkYXRhKSB7cmV0dXJuICJmb28ifSkudGhlbihmdW5jdGlvbihkYXRhKSB7dmFsdWUgPSBkYXRhfSkKCQlkZWZlcnJlZC5yZWplY3QoInRlc3QiKQoJCXJldHVybiB2YWx1ZSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZTEsIHZhbHVlMgoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7dGhyb3cgbmV3IEVycm9yfSkudGhlbihmdW5jdGlvbihkYXRhKSB7dmFsdWUxID0gMX0sIGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZTIgPSBkYXRhfSkKCQlkZWZlcnJlZC5yZXNvbHZlKCJ0ZXN0IikKCQlyZXR1cm4gdmFsdWUxID09PSB1bmRlZmluZWQgJiYgdmFsdWUyIGluc3RhbmNlb2YgRXJyb3IKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vTGV0IHVuY2hlY2tlZCBleGNlcHRpb25zIGJ1YmJsZSB1cCBpbiBvcmRlciB0byBhbGxvdyBtZWFuaW5nZnVsIGVycm9yIG1lc3NhZ2VzIGluIGNvbW1vbiBjYXNlcyBsaWtlIG51bGwgcmVmZXJlbmNlIGV4Y2VwdGlvbnMgZHVlIHRvIHR5cG9zCgkJLy9BbiB1bmNoZWNrZWQgZXhjZXB0aW9uIGlzIGRlZmluZWQgYXMgYW4gb2JqZWN0IHRoYXQgaXMgYSBzdWJjbGFzcyBvZiBFcnJvciAoYnV0IG5vdCBhIGRpcmVjdCBpbnN0YW5jZSBvZiBFcnJvciBpdHNlbGYpIC0gYmFzaWNhbGx5IGFueXRoaW5nIHRoYXQgY2FuIGJlIHRocm93biB3aXRob3V0IGFuIGV4cGxpY2l0IGB0aHJvd2Aga2V5d29yZCBhbmQgdGhhdCB3ZSdkIG5ldmVyIHdhbnQgdG8gcHJvZ3JhbW1hdGljYWxseSBtYW5pcHVsYXRlLiBJbiBvdGhlciB3b3JkcywgYW4gdW5jaGVja2VkIGVycm9yIGlzIG9uZSB3aGVyZSB3ZSBvbmx5IGNhcmUgYWJvdXQgaXRzIGxpbmUgbnVtYmVyIGFuZCB3aGVyZSB0aGUgb25seSByZWFzb25hYmxlIHdheSB0byBkZWFsIHdpdGggaXQgaXMgdG8gY2hhbmdlIHRoZSBidWdneSBzb3VyY2UgY29kZSB0aGF0IGNhdXNlZCB0aGUgZXJyb3IgdG8gYmUgdGhyb3duIGluIHRoZSBmaXJzdCBwbGFjZS4KCQkvL0J5IGNvbnRyYXN0LCBhIGNoZWNrZWQgZXhjZXB0aW9uIGlzIGRlZmluZWQgYXMgYW55dGhpbmcgdGhhdCBpcyBleHBsaWNpdGx5IHRocm93biB2aWEgdGhlIGB0aHJvd2Aga2V5d29yZCBhbmQgdGhhdCBjYW4gYmUgcHJvZ3JhbW1hdGljYWxseSBoYW5kbGVkLCBmb3IgZXhhbXBsZSB0byBkaXNwbGF5IGEgdmFsaWRhdGlvbiBlcnJvciBtZXNzYWdlIG9uIHRoZSBVSS4gSWYgYW4gZXhjZXB0aW9uIGlzIGEgc3ViY2xhc3Mgb2YgRXJyb3IgZm9yIHdoYXRldmVyIHJlYXNvbiwgYnV0IGl0IGlzIG1lYW50IHRvIGJlIGhhbmRsZWQgYXMgYSBjaGVja2VkIGV4Y2VwdGlvbiAoaS5lLiBmb2xsb3cgdGhlIHJlamVjdGlvbiBydWxlcyBmb3IgQSspLCBpdCBjYW4gYmUgcmV0aHJvd24gYXMgYW4gaW5zdGFuY2Ugb2YgRXJyb3IKCQkvL1RoaXMgdGVzdCB0ZXN0cyB0d28gaW1wbGVtZW50YXRpb24gZGV0YWlscyB0aGF0IGRpZmZlciBmcm9tIHRoZSBQcm9taXNlcy9BKyBzcGVjOgoJCS8vMSkgQSsgcmVxdWlyZXMgdGhlIGB0aGVuYCBjYWxsYmFjayB0byBiZSBjYWxsZWQgaW4gYSBkaWZmZXJlbnQgZXZlbnQgbG9vcCBmcm9tIHRoZSByZXNvbHZlIGNhbGwsIGkuZS4gaXQgbXVzdCBiZSBhc3luY2hyb25vdXMgKHRoaXMgcmVxdWlyZXMgYSBzZXRJbW1lZGlhdGUgcG9seWZpbGwsIHdoaWNoIGNhbm5vdCBiZSBpbXBsZW1lbnRlZCBpbiBhIHJlYXNvbmFibGUgd2F5IGZvciBNaXRocmlsJ3MgcHVycG9zZSAtIHRoZSBwb3NzaWJsZSBwb2x5ZmlsbHMgYXJlIGVpdGhlciB0b28gYmlnIG9yIHRvbyBzbG93KQoJCS8vMikgQSsgc3dhbGxvd3MgZXhjZXB0aW9ucyBpbiBhIHVucmV0aHJvd2FibGUgd2F5LCBpLmUuIGl0J3Mgbm90IHBvc3NpYmxlIHRvIHNlZSBkZWZhdWx0IGVycm9yIG1lc3NhZ2VzIG9uIHRoZSBjb25zb2xlIGZvciBydW50aW1lIGVycm9ycyB0aHJvd24gZnJvbSB3aXRoaW4gYSBwcm9taXNlIGNoYWluCgkJdmFyIHZhbHVlMSwgdmFsdWUyLCB2YWx1ZTMKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQl0cnkgewoJCQlkZWZlcnJlZC5wcm9taXNlCgkJCQkudGhlbihmdW5jdGlvbihkYXRhKSB7Zm9vLmJhci5iYXp9KSAvL3Rocm93cyBSZWZlcmVuY2VFcnJvcgoJCQkJLnRoZW4oZnVuY3Rpb24oZGF0YSkge3ZhbHVlMSA9IDF9LCBmdW5jdGlvbihkYXRhKSB7dmFsdWUyID0gZGF0YX0pCgkJCWRlZmVycmVkLnJlc29sdmUoInRlc3QiKQoJCX0KCQljYXRjaCAoZSkge3ZhbHVlMyA9IGV9CgkJcmV0dXJuIHZhbHVlMSA9PT0gdW5kZWZpbmVkICYmIHZhbHVlMiA9PT0gdW5kZWZpbmVkICYmIHZhbHVlMyBpbnN0YW5jZW9mIFJlZmVyZW5jZUVycm9yCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZGVmZXJyZWQxID0gbS5kZWZlcnJlZCgpCgkJdmFyIGRlZmVycmVkMiA9IG0uZGVmZXJyZWQoKQoJCXZhciB2YWx1ZTEsIHZhbHVlMgoJCWRlZmVycmVkMS5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZTEgPSBkYXRhCgkJCXJldHVybiBkZWZlcnJlZDIucHJvbWlzZQoJCX0pLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZTIgPSBkYXRhCgkJfSkKCQlkZWZlcnJlZDEucmVzb2x2ZSgxKQoJCWRlZmVycmVkMi5yZXNvbHZlKDIpCgkJcmV0dXJuIHZhbHVlMSA9PT0gMSAmJiB2YWx1ZTIgPT09IDIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZXNvbHZlKDEpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSBkYXRhCgkJfSkKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZWplY3QoMSkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4obnVsbCwgZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IGRhdGEKCQl9KQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzgwCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlkZWZlcnJlZC5yZXNvbHZlKDIpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSBkYXRhCgkJfSkKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IGRhdGEKCQl9KQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlkZWZlcnJlZC5yZXNvbHZlKDIpCgkJcmV0dXJuIHZhbHVlID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvODAKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlMSwgdmFsdWUyCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUxID0gZGF0YQoJCX0sIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUyID0gZGF0YQoJCX0pCgkJZGVmZXJyZWQucmVzb2x2ZSgxKQoJCWRlZmVycmVkLnJlamVjdCgyKQoJCXJldHVybiB2YWx1ZTEgPT09IDEgJiYgdmFsdWUyID09PSB1bmRlZmluZWQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUxLCB2YWx1ZTIKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oKSB7CgkJCXZhbHVlMSA9IGRhdGEKCQl9LCBmdW5jdGlvbihkYXRhKSB7CgkJCXZhbHVlMiA9IGRhdGEKCQl9KQoJCWRlZmVycmVkLnJlamVjdCgxKQoJCWRlZmVycmVkLnJlc29sdmUoMikKCQlyZXR1cm4gdmFsdWUxID09PSB1bmRlZmluZWQgJiYgdmFsdWUyID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvODAKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSBkYXRhCgkJfSkKCQlkZWZlcnJlZC5yZWplY3QoMSkKCQlkZWZlcnJlZC5yZWplY3QoMikKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84NQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZXNvbHZlKCkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IDEKCQl9KQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzg1CgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlamVjdCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSAxCgkJfSkKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZXNvbHZlKDEpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCXZhciBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtyZXR1cm4gZGF0YSArIDF9KQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlyZXR1cm4gcHJvbWlzZSgpID09PSAyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlCgkJZGVmZXJyZWQucmVqZWN0KDEpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKSA9PT0gdW5kZWZpbmVkCgl9KQoKCS8vbS5zeW5jCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZDEgPSBtLmRlZmVycmVkKCkKCQl2YXIgZGVmZXJyZWQyID0gbS5kZWZlcnJlZCgpCgkJbS5zeW5jKFtkZWZlcnJlZDEucHJvbWlzZSwgZGVmZXJyZWQyLnByb21pc2VdKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkMS5yZXNvbHZlKCJ0ZXN0IikKCQlkZWZlcnJlZDIucmVzb2x2ZSgiZm9vIikKCQlyZXR1cm4gdmFsdWVbMF0gPT09ICJ0ZXN0IiAmJiB2YWx1ZVsxXSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZDEgPSBtLmRlZmVycmVkKCkKCQl2YXIgZGVmZXJyZWQyID0gbS5kZWZlcnJlZCgpCgkJbS5zeW5jKFtkZWZlcnJlZDEucHJvbWlzZSwgZGVmZXJyZWQyLnByb21pc2VdKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkMi5yZXNvbHZlKCJmb28iKQoJCWRlZmVycmVkMS5yZXNvbHZlKCJ0ZXN0IikKCQlyZXR1cm4gdmFsdWVbMF0gPT09ICJ0ZXN0IiAmJiB2YWx1ZVsxXSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZSA9IDEKCQltLnN5bmMoW10pLnRoZW4oZnVuY3Rpb24oKSB7dmFsdWUgPSAyfSkKCQlyZXR1cm4gdmFsdWUgPT0gMgoJfSkKCgkvL20uc3RhcnRDb21wdXRhdGlvbi9tLmVuZENvbXB1dGF0aW9uCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCgkJdmFyIGNvbnRyb2xsZXIKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLm1vZHVsZShyb290LCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge2NvbnRyb2xsZXIgPSB0aGlzfSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkge3JldHVybiBjdHJsLnZhbHVlfQoJCX0pCgoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCgkJbS5zdGFydENvbXB1dGF0aW9uKCkKCQljb250cm9sbGVyLnZhbHVlID0gImZvbyIKCQltLmVuZENvbXB1dGF0aW9uKCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCgkvL2NvbnNvbGUubG9nIHByZXNlbmNlCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXJldHVybiBtLmRlcHMuZmFjdG9yeS50b1N0cmluZygpLmluZGV4T2YoImNvbnNvbGUiKSA8IDAKCX0pCgoJLy8gY29uZmlnIGNvbnRleHQKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgoJCXZhciBzdWNjZXNzID0gZmFsc2U7CgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogZnVuY3Rpb24oZWxlbSwgaXNJbml0aWFsaXplZCwgY3R4KSB7Y3R4LmRhdGE9MX19KSk7CgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogZnVuY3Rpb24oZWxlbSwgaXNJbml0aWFsaXplZCwgY3R4KSB7c3VjY2VzcyA9IGN0eC5kYXRhPT09MX19KSk7CgkJcmV0dXJuIHN1Y2Nlc3M7Cgl9KQoKCS8vIG1vcmUgY29tcGxleCBjb25maWcgY29udGV4dAoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCgkJdmFyIGlkeCA9IDA7CgkJdmFyIHN1Y2Nlc3MgPSB0cnVlOwoJCXZhciBzdGF0ZWZ1bENvbmZpZyA9IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkge2N0eC5kYXRhPWlkeCsrfQoJCXZhciBub2RlID0gbSgiZGl2Iiwge2NvbmZpZzogc3RhdGVmdWxDb25maWd9KTsKCQltLnJlbmRlcihyb290LCBbbm9kZSwgbm9kZV0pOwoKCQlpZHggPSAwOwoJCXZhciBjaGVja0NvbmZpZyA9IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkgewoJCQlzdWNjZXNzID0gc3VjY2VzcyAmJiAoY3R4LmRhdGEgPT09IGlkeCsrKQoJCX0KCQlub2RlID0gbSgiZGl2Iiwge2NvbmZpZzogY2hlY2tDb25maWd9KTsKCQltLnJlbmRlcihyb290LCBbbm9kZSwgbm9kZV0pOwoJCXJldHVybiBzdWNjZXNzOwoJfSkKCn0KCi8vdGVzdCByZXBvcnRpbmcgZm9yIHNhdWNlbGFicwppZiAodHlwZW9mIHdpbmRvdyAhPSAidW5kZWZpbmVkIikgewoJd2luZG93Lmdsb2JhbF90ZXN0X3Jlc3VsdHMgPSB7CgkJdGVzdHM6IFtdLAoJCWR1cmF0aW9uOiAwLAoJCXBhc3NlZDogMCwKCQlmYWlsZWQ6IDAKCX07Cn0KCi8vbW9jawp0ZXN0TWl0aHJpbChtb2NrLndpbmRvdyk7Cgp0ZXN0LnByaW50KGZ1bmN0aW9uKHZhbHVlKSB7Y29uc29sZS5sb2codmFsdWUpfSkK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 16:12:05 GMT",
                    "Content-Length": "108297",
                    "Date": "Fri, 07 Nov 2014 16:12:07 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}