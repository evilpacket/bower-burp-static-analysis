{
    "url": "http://localhost:9999/zooniverse/Zooniverse/zooniverse.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location.hash</b> and written to <b>$()</b> via the following statement:<ul><li>anchors = $(\"a[href='\" + location.hash + \"']\");</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/zooniverse/Zooniverse/zooniverse.js",
                "path": "/zooniverse/Zooniverse/zooniverse.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC96b29uaXZlcnNlL1pvb25pdmVyc2Uvem9vbml2ZXJzZS5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTY1NzI2DQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBTdW4sIDA5IE5vdiAyMDE0IDA0OjIwOjMzIEdNVA0KTGFzdC1Nb2RpZmllZDogU3VuLCAwOSBOb3YgMjAxNCAwNDoyMDozMyBHTVQNCg0KLyohCiAqIFpvb25pdmVyc2UgTGlicmFyeSAtIHYwLjcuMQogKi8KOyhmdW5jdGlvbih3aW5kb3cpIHsKd2luZG93LmJhc2U2NCA9IHsKICBfa2V5U3RyOiAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0iLAogIAogIGVuY29kZTogZnVuY3Rpb24gKGlucHV0KSB7CiAgICB2YXIgb3V0cHV0ID0gIiI7CiAgICB2YXIgY2hyMSwgY2hyMiwgY2hyMywgZW5jMSwgZW5jMiwgZW5jMywgZW5jNDsKICAgIHZhciBpID0gMDsKICAgIAogICAgaW5wdXQgPSBiYXNlNjQuX3V0ZjhfZW5jb2RlKGlucHV0KTsKICAgIAogICAgd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpIHsKICAgICAgY2hyMSA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTsKICAgICAgY2hyMiA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTsKICAgICAgY2hyMyA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTsKICAgICAgCiAgICAgIGVuYzEgPSBjaHIxID4+IDI7CiAgICAgIGVuYzIgPSAoKGNocjEgJiAzKSA8PCA0KSB8IChjaHIyID4+IDQpOwogICAgICBlbmMzID0gKChjaHIyICYgMTUpIDw8IDIpIHwgKGNocjMgPj4gNik7CiAgICAgIGVuYzQgPSBjaHIzICYgNjM7CiAgICAgIAogICAgICBpZiAoaXNOYU4oY2hyMikpIHsKICAgICAgICBlbmMzID0gZW5jNCA9IDY0OwogICAgICB9IGVsc2UgaWYgKGlzTmFOKGNocjMpKSB7CiAgICAgICAgZW5jNCA9IDY0OwogICAgICB9CiAgICAgIAogICAgICBvdXRwdXQgPSBvdXRwdXQgKwogICAgICAgIGJhc2U2NC5fa2V5U3RyLmNoYXJBdChlbmMxKSArIGJhc2U2NC5fa2V5U3RyLmNoYXJBdChlbmMyKSArCiAgICAgICAgYmFzZTY0Ll9rZXlTdHIuY2hhckF0KGVuYzMpICsgYmFzZTY0Ll9rZXlTdHIuY2hhckF0KGVuYzQpOwogICAgfQogICAgCiAgICByZXR1cm4gb3V0cHV0OwogIH0sCiAgCiAgZGVjb2RlOiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgIHZhciBvdXRwdXQgPSAiIjsKICAgIHZhciBjaHIxLCBjaHIyLCBjaHIzOwogICAgdmFyIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQ7CiAgICB2YXIgaSA9IDA7CiAgICAKICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvW15BLVphLXowLTlcK1wvXD1dL2csICIiKTsKICAgIAogICAgd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpIHsKICAgICAgZW5jMSA9IGJhc2U2NC5fa2V5U3RyLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpOwogICAgICBlbmMyID0gYmFzZTY0Ll9rZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7CiAgICAgIGVuYzMgPSBiYXNlNjQuX2tleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTsKICAgICAgZW5jNCA9IGJhc2U2NC5fa2V5U3RyLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpOwogICAgICAKICAgICAgY2hyMSA9IChlbmMxIDw8IDIpIHwgKGVuYzIgPj4gNCk7CiAgICAgIGNocjIgPSAoKGVuYzIgJiAxNSkgPDwgNCkgfCAoZW5jMyA+PiAyKTsKICAgICAgY2hyMyA9ICgoZW5jMyAmIDMpIDw8IDYpIHwgZW5jNDsKICAgICAgCiAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMSk7CiAgICAgIAogICAgICBpZiAoZW5jMyAhPSA2NCkgewogICAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMik7CiAgICAgIH0KICAgICAgaWYgKGVuYzQgIT0gNjQpIHsKICAgICAgICBvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjMpOwogICAgICB9CiAgICB9CiAgICAKICAgIG91dHB1dCA9IGJhc2U2NC5fdXRmOF9kZWNvZGUob3V0cHV0KTsKICAgIAogICAgcmV0dXJuIG91dHB1dDsKICB9LAogIAogIF91dGY4X2VuY29kZTogZnVuY3Rpb24gKHN0cmluZykgewogICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL1xyXG4vZywgIlxuIik7CiAgICB2YXIgdXRmdGV4dCA9ICIiOwogICAgCiAgICBmb3IgKHZhciBuID0gMDsgbiA8IHN0cmluZy5sZW5ndGg7IG4rKykgewogICAgICB2YXIgYyA9IHN0cmluZy5jaGFyQ29kZUF0KG4pOwogICAgICAKICAgICAgaWYgKGMgPCAxMjgpIHsKICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7CiAgICAgIH0gZWxzZSBpZiAoKGMgPiAxMjcpICYmIChjIDwgMjA0OCkpIHsKICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgPj4gNikgfCAxOTIpOwogICAgICAgIHV0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjID4+IDEyKSB8IDIyNCk7CiAgICAgICAgdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyA+PiA2KSAmIDYzKSB8IDEyOCk7CiAgICAgICAgdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjICYgNjMpIHwgMTI4KTsKICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gdXRmdGV4dDsKICB9LAogIAogIF91dGY4X2RlY29kZTogZnVuY3Rpb24gKHV0ZnRleHQpIHsKICAgIHZhciBzdHJpbmcgPSAiIjsKICAgIHZhciBpID0gMDsKICAgIHZhciBjID0gMCwgYzEgPSAwLCBjMiA9IDA7CiAgICAKICAgIHdoaWxlIChpIDwgdXRmdGV4dC5sZW5ndGgpIHsKICAgICAgYyA9IHV0ZnRleHQuY2hhckNvZGVBdChpKTsKICAgICAgCiAgICAgIGlmIChjIDwgMTI4KSB7CiAgICAgICAgc3RyaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7CiAgICAgICAgaSsrOwogICAgICB9IGVsc2UgaWYgKChjID4gMTkxKSAmJiAoYyA8IDIyNCkpIHsKICAgICAgICBjMSA9IHV0ZnRleHQuY2hhckNvZGVBdChpICsgMSk7CiAgICAgICAgc3RyaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMzEpIDw8IDYpIHwgKGMxICYgNjMpKTsKICAgICAgICBpICs9IDI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYzEgPSB1dGZ0ZXh0LmNoYXJDb2RlQXQoaSArIDEpOwogICAgICAgIGMyID0gdXRmdGV4dC5jaGFyQ29kZUF0KGkgKyAyKTsKICAgICAgICBzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAxNSkgPDwgMTIpIHwgKChjMSAmIDYzKSA8PCA2KSB8IChjMiAmIDYzKSk7CiAgICAgICAgaSArPSAzOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RyaW5nOwogIH0KfTsKCihmdW5jdGlvbigpIHsKICB2YXIgZW4sIF9iYXNlOwoKICBlbiA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdBIFpvb25pdmVyc2UgcHJvamVjdCcsCiAgICBzaWduVXBIZWFkaW5nOiAnU2lnbiB1cCBmb3IgYSBuZXcgWm9vbml2ZXJzZSBhY2NvdW50JywKICAgIHNpZ25JbkhlYWRpbmc6ICdTaWduIGluIHRvIHlvdXIgWm9vbml2ZXJzZSBhY2NvdW50JywKICAgIHNpZ25VcDogJ1NpZ24gdXAnLAogICAgc2lnbkluOiAnU2lnbiBpbicsCiAgICBzaWduT3V0OiAnU2lnbiBvdXQnLAogICAgdXNlcm5hbWU6ICdVc2VybmFtZScsCiAgICBwYXNzd29yZDogJ1Bhc3N3b3JkJywKICAgIGVtYWlsOiAnRW1haWwnLAogICAgcmVhbE5hbWU6ICdSZWFsIG5hbWUnLAogICAgd2h5UmVhbE5hbWU6ICdUaGlzIHdpbGwgYmUgdXNlZCB3aGVuIHdlIHRoYW5rIGNvbnRyaWJ1dG9ycywgZm9yIGV4YW1wbGUsIGluIHRhbGtzIG9yIG9uIHBvc3RlcnMuIElmIHlvdSBkb25cJ3Qgd2FudCB0byBiZSBtZW50aW9uZWQgcHVibGljbHksIGxlYXZlIHRoaXMgYmxhbmsuJywKICAgIG5vQWNjb3VudDogJ0RvblwndCBoYXZlIGFuIGFjY291bnQ/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAnSSBhZ3JlZSB0byB0aGUgPGEgaHJlZj0iaHR0cHM6Ly93d3cuem9vbml2ZXJzZS5vcmcvcHJpdmFjeSIgdGFyZ2V0PSJfYmxhbmsiPnByaXZhY3kgcG9saWN5PC9hPi4nLAogICAgYmV0YVByZWZlcmVuY2U6ICdJIHdvdWxkIGxpa2UgdG8gcmVjZWl2ZSBub3RpY2VzIHdpdGggb3Bwb3J0dW5pdGllcyB0byB0ZXN0IGFuZCBwcm92aWRlIGZlZWRiYWNrIG9uIHVucmVsZWFzZWQgWm9vbml2ZXJzZSBwcm9qZWN0cy4nLAogICAgZm9yZ290UGFzc3dvcmQ6ICdGb3Jnb3QgeW91ciBwYXNzd29yZD8nLAogICAgYmFkTG9naW46ICdJbmNvcnJlY3QgdXNlcm5hbWUgb3IgcGFzc3dvcmQnLAogICAgc2lnbkluRmFpbGVkOiAnU2lnbiBpbiBmYWlsZWQuJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICdTaWduIGluIHRvIHNlZSB5b3VyIHByb2ZpbGUuJywKICAgIGZvb3RlckhlYWRpbmc6ICdUaGUgWm9vbml2ZXJzZSBpcyBhIGNvbGxlY3Rpb24gb2Ygd2ViLWJhc2VkIGNpdGl6ZW4gc2NpZW5jZSBwcm9qZWN0cyB0aGF0IHVzZSB0aGUgZWZmb3J0cyBvZiB2b2x1bnRlZXJzIHRvIGhlbHAgcmVzZWFyY2hlcnMgZGVhbCB3aXRoIHRoZSBmbG9vZCBvZiBkYXRhIHRoYXQgY29uZnJvbnRzIHRoZW0uJywKICAgIHByaXZhY3lQb2xpY3k6ICdQcml2YWN5IHBvbGljeScsCiAgICBmb3JrT25HaXRIdWI6ICdTb3VyY2UgJiBidWdzJywKICAgIHJlY2VudHM6ICdSZWNlbnRzJywKICAgIGZhdm9yaXRlczogJ0Zhdm9yaXRlcycsCiAgICBub25lOiAnbm9uZScKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLmVuID0gZW47CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gZW47CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgZXMsIF9iYXNlOwoKICBlcyA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdVbiBwcm95ZWN0byBkZSBab29uaXZlcnNlJywKICAgIHNpZ25VcEhlYWRpbmc6ICdSZWfDrXN0cmF0ZSBjb24gdW5hIG51ZXZhIGN1ZW50YSBab29uaXZlcnNlJywKICAgIHNpZ25JbkhlYWRpbmc6ICdJbmljaWEgc2VzacOzbiBjb24gdHUgY3VlbnRhIGRlIFpvb25pdmVyc2UnLAogICAgc2lnblVwOiAnU3VzY3JpYmlyc2UnLAogICAgc2lnbkluOiAnSW5pY2lhciBzZXNpw7NuJywKICAgIHNpZ25PdXQ6ICdTYWxpcicsCiAgICB1c2VybmFtZTogJ05vbWJyZSBkZSBVc3VhcmlvJywKICAgIHBhc3N3b3JkOiAnQ29udHJhc2XDsWEnLAogICAgZW1haWw6ICdFbWFpbCcsCiAgICByZWFsTmFtZTogJ05vbWJyZSBSZWFsJywKICAgIHdoeVJlYWxOYW1lOiAnRXN0byBzZXLDoSB1c2FkbyBwYXJhIGFncmFkZWNlciBhIGxvcyBjb2xhYm9yYWRvcmVzLCBwb3IgZWplbXBsICBlbiBsYXMgY29udmVyc2FjaW9uZXMgbyBjYXJ0ZWxlcy4gU2kgbm8gcXVpZXJlcyBzZXIgbWVuY2lvbmFkbyBww7pibGljYW1lbnQgIGTDqWphbG8gZW4gYmxhbmNvLicsCiAgICBub0FjY291bnQ6ICfCv05vIHRpZW5lcyB1bmEgY3VlbnRhPycsCiAgICBhZ3JlZVRvUHJpdmFjeVBvbGljeTogJ0VzdG95IGRlIGFjdWVyZG8gY29uIDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVycyAgb3JnL3ByaXZhY3kiIHRhcmdldD0iX2JsYW5rIj4geSBzdSBwb2zDrXRpY2EgZGUgcHJpdmFjaWRhZCA8L2E+LicsCiAgICBiZXRhUHJlZmVyZW5jZTogJ01lIGd1c3RhcsOtYSByZWNpYmlyIG5vdGljaWFzIGNvbiBvcG9ydHVuaWRhZGVzIHBhcmEgcHJvYmFyICAgcHJvcG9yY2lvbmFyIGZlZWRiYWNrIGVuIGxvcyBwcm95ZWN0b3MgaW7DqWRpdG9zIGRlIFpvb25pdmVyc2UnLAogICAgZm9yZ290UGFzc3dvcmQ6ICfCv09sdmlkYXN0ZSB0dSBjb250cmFzZcOxYT8nLAogICAgYmFkTG9naW46ICdOb21icmUgZGUgdXN1YXJpbyBvIGNvbnRyYXNlw7FhIGluY29ycmVjdGEnLAogICAgc2lnbkluRmFpbGVkOiAnRXJyb3IgYWwgaW5pY2lhciBzZXNpw7NuJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICdJbmljaWEgc2VzacOzbiBwYXJhIHZlciB0dSBwZXJmaWwuJywKICAgIGZvb3RlckhlYWRpbmc6ICdab29uaXZlcnNlIGVzIHVuYSBjb2xlY2Npw7NuIGRlIHByb3llY3RvcyBkZSBjaWVuY2lhIGNpdWRhZGFuICBiYXNhZG9zIGVuIGxhIHdlYiBxdWUgdXRpbGl6YSBlbCBlc2Z1ZXJ6byBkZSB2b2x1bnRhcmlvcyBwYXJhIGF5dWRhciBhIGxvIGludmVzdGlnYWRvcmVzIGNvbiBsYSBhdmFsYW5jaGEgZGUgZGF0b3MgYSBsYSBxdWUgc2UgZW5mcmVudGFuLicsCiAgICBwcml2YWN5UG9saWN5OiAnUG9sw610aWNhIGRlIHByaXZhY2lkYWQnLAogICAgZm9ya09uR2l0SHViOiAnRnVlbnRlIHkgZXJyb3JlcycsCiAgICByZWNlbnRzOiAnUmVjaWVudGVzJywKICAgIGZhdm9yaXRlczogJ0Zhdm9yaXRvcycsCiAgICBub25lOiAnbmluZ3VubycKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLmVzID0gZXM7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gZXM7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgZnIsIF9iYXNlOwoKICBmciA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdVbiBwcm9qZXQgWm9vbml2ZXJzZScsCiAgICBzaWduVXBIZWFkaW5nOiAnQ3LDqWVyIHVuIGNvbXB0ZSBab29uaXZlcnNlJywKICAgIHNpZ25JbkhlYWRpbmc6ICdDb25uZWN0ZXotdm91cyDDoCB2b3RyZSBjb21wdGUgWm9vbml2ZXJzZScsCiAgICBzaWduVXA6ICdTXCdpbnNjcmlyZScsCiAgICBzaWduSW46ICdDb25uZXhpb24nLAogICAgc2lnbk91dDogJ0TDqWNvbm5leGlvbicsCiAgICB1c2VybmFtZTogJ05vbSBkXCd1dGlsaXNhdGV1cicsCiAgICBwYXNzd29yZDogJ01vdCBkZSBwYXNzZScsCiAgICBlbWFpbDogJ0VtYWlsJywKICAgIHJlYWxOYW1lOiAnUHLDqW5vbSBOb20nLAogICAgd2h5UmVhbE5hbWU6ICdWb3RyZSBub20gcG91cnJhIMOqdHJlIHV0aWxpc2VyIGxvcnMgZHUgcmVtZXJjaWVtZW50IGRlcyBjb250cmlidXRldXJzLCBwYXIgZXhlbXBsZSBsb3JzIGRlIHByw6lzZW50YXRpb24gb3JhbGVzIG91IHN1ciBkZXMgcG9zdGVycy48YnIgLz5TaSB2b3VzIG5lIHNvdWhhaXRleiBwYXMgcXVcJ2lsIHNvaXQgbWVudGlvbm5lciBwdWJsaXF1ZW1lbnQsIGxhaXNzZXogY2V0dGUgY2FzZSB2aWRlLicsCiAgICBub0FjY291bnQ6ICdWb3VzIG5cJ2F2ZXogcGFzIGVuY29yZSBkZSBjb21wdGU/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAnSlwnYWNjZXB0ZSBsZXMgPGEgaHJlZj0iaHR0cHM6Ly93d3cuem9vbml2ZXJzZS5vcmcvcHJpdmFjeSIgdGFyZ2V0PSJfYmxhbmsiPmNvbmRpdGlvbnMgZFwndXRpbGlzYXRpb24gPC9hPi4nLAogICAgYmV0YVByZWZlcmVuY2U6ICdKXCdhaW1lcmFpcyDDqnRyZSB0ZW51IGF1IGNvdXJhbnQgZGVzIHByb2pldHMgZW4gY291cnMgZGUgZMOpdmVsb3BwZW1lbnQgcGFyIFpvb25pdmVyc2UsIGFmaW4gZGUgcGFydGljaXBlciBhdXggdGVzdHMgZXQgZG9ubmVyIG1vbiBhdmlzLicsCiAgICBmb3Jnb3RQYXNzd29yZDogJ01vdCBkZSBwYXNzZSBvdWJsacOpPycsCiAgICBiYWRMb2dpbjogJ1V0aWxpc2F0ZXVyIG91IG1vdCBkZSBwYXNzZSBpbmNvcnJlY3QnLAogICAgc2lnbkluRmFpbGVkOiAnw4ljaGVjIGRlIGxhIGNvbm5leGlvbi4nLAogICAgc2lnbkluRm9yUHJvZmlsZTogJ0Nvbm5lY3Rlei12b3VzIHBvdXIgYWNjw6lkZXIgw6Agdm90cmUgcHJvZmlsLicsCiAgICBmb290ZXJIZWFkaW5nOiAnWm9vbml2ZXJzZSBlc3QgdW5lIGNvbGxlY3Rpb24gZGUgcHJvamV0cyBkZSBzY2llbmNlIHBhcnRpY2lwYXRpdmUgZW4gbGlnbmUgcXVpIHBlcm1ldHRlbnQgYXV4IHZvbG9udGFpcmVzIGRcJ2FpZGVyIGxlcyBzY2llbnRpZmlxdWVzIMOgIHRyYWl0ZXIgbGVzIGltbWVuc2VzIHF1YW50aXTDqXMgZGUgZG9ubsOpZXMgZG9udCBpbHMgZGlzcG9zZW50LicsCiAgICBwcml2YWN5UG9saWN5OiAnQ29udGlkaXRvbnMgZFwndXRpbGlzYXRpb24nLAogICAgcmVjZW50czogJ1LDqWNlbnRzJywKICAgIGZhdm9yaXRlczogJ0Zhdm9yaXMnLAogICAgbm9uZTogJ2F1Y3VuJwogIH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS50cmFuc2xhdGlvbnMgPT0gbnVsbCkgewogICAgX2Jhc2UudHJhbnNsYXRpb25zID0ge307CiAgfQoKICB3aW5kb3cuem9vbml2ZXJzZS50cmFuc2xhdGlvbnMuZnIgPSBmcjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBmcjsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBwbCwgX2Jhc2U7CgogIHBsID0gewogICAgdG9wQmFySGVhZGluZzogJ1Byb2pla3QgWm9vbml2ZXJzZScsCiAgICBzaWduVXBIZWFkaW5nOiAnVXR3w7NyeiBub3dlIGtvbnRvIFpvb25pdmVyc2UnLAogICAgc2lnbkluSGVhZGluZzogJ1phbG9ndWogc2nEmSBuYSBzd29qZSBrb250byBab29uaXZlcnNlJywKICAgIHNpZ25VcDogJ1phcmVqZXN0cnVqJywKICAgIHNpZ25JbjogJ1phbG9ndWonLAogICAgc2lnbk91dDogJ1d5bG9ndWonLAogICAgdXNlcm5hbWU6ICdOYXp3YSB1xbx5dGtvd25pa2EnLAogICAgcGFzc3dvcmQ6ICdIYXPFgm8nLAogICAgZW1haWw6ICdBZHJlcyBlLW1haWwnLAogICAgcmVhbE5hbWU6ICdQcmF3ZHppd2UgaW1pxJknLAogICAgd2h5UmVhbE5hbWU6ICdLb3J6eXN0YW15IHogdHljaCBkYW55Y2gsIGtpZWR5IGR6acSZa3VqZW15IG9jaG90bmlrb20gemEgaWNoIHdrxYJhZCwgbmEgcHJ6eWvFgmFkIHBvZGN6YXMgcm96bcOzdyBjenkgbmEgcGxha2F0YWNoLiA8YnIvPiBKZcW8ZWxpIG5pZSBjaGNlc3osIGFiecWbbXkgd3ltaWVuaWFsaSBDacSZIHB1YmxpY3puaWUgeiBpbWllbmlhIGkgbmF6d2lza2EsIHpvc3RhdyB0byBwb2xlIHB1c3RlLicsCiAgICBub0FjY291bnQ6ICdOaWUgbWFzeiBqZXN6Y3plIGtvbnRhPycsCiAgICBhZ3JlZVRvUHJpdmFjeVBvbGljeTogJ1pnYWR6YW0gc2nEmSB6IDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVyc2Uub3JnL3ByaXZhY3kiIHRhcmdldD0iX2JsYW5rIj5wb2xpdHlrxIUgcHJ5d2F0bm/Fm2NpPC9hPi4nLAogICAgZm9yZ290UGFzc3dvcmQ6ICdOaWUgcGFtacSZdGFzeiBoYXPFgmE/JywKICAgIGJhZExvZ2luOiAnTmllcG9wcmF3bmEgbmF6d2EgdcW8eXRrb3duaWthIGx1YiBoYXPFgm8nLAogICAgc2lnbkluRmFpbGVkOiAnTmllIHVkYcWCbyBzacSZIHphbG9nb3dhxIcnLAogICAgc2lnbkluRm9yUHJvZmlsZTogJ1phbG9ndWogc2nEmSwgYWJ5IHpvYmFjennEhyBzd8OzaiBwcm9maWwnLAogICAgZm9vdGVySGVhZGluZzogJ1pvb25pdmVyc2UgdG8gemJpw7NyIHByb2pla3TDs3cgbmF1a2kgb2J5d2F0ZWxza2llaiB3IEludGVybmVjaWUsIGR6acSZa2kga3TDs3J5bSBvY2hvdG5pY3kgcG9tYWdhasSFIGJhZGFjem9tIHByemVkemllcmHEhyBzacSZIHByemV6IHBvd8OzZMW6IG5hcMWCeXdhasSFY3ljaCBkYW55Y2guJywKICAgIHByaXZhY3lQb2xpY3k6ICdQb2xpdHlrYSBwcnl3YXRub8WbY2knLAogICAgcmVjZW50czogJ05ham5vd3N6ZScsCiAgICBmYXZvcml0ZXM6ICdVbHViaW9uZScsCiAgICBub25lOiAnbmljJwogIH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS50cmFuc2xhdGlvbnMgPT0gbnVsbCkgewogICAgX2Jhc2UudHJhbnNsYXRpb25zID0ge307CiAgfQoKICB3aW5kb3cuem9vbml2ZXJzZS50cmFuc2xhdGlvbnMucGwgPSBwbDsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBwbDsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBydSwgX2Jhc2U7CgogIHJ1ID0gewogICAgdG9wQmFySGVhZGluZzogJ9Cf0YDQvtC10LrRgiBab29uaXZlcnNlJywKICAgIHNpZ25VcEhlYWRpbmc6ICfQodC+0LfQtNCw0YLRjCDQvdC+0LLRi9C5INCw0LrQutCw0YPQvdGCIFpvb25pdmVyc2UnLAogICAgc2lnbkluSGVhZGluZzogJ9CS0L7QudGC0Lgg0LIg0LLQsNGIINCw0LrQutCw0YPQvdGCIFpvb25pdmVyc2UnLAogICAgc2lnblVwOiAn0JfQsNGA0LXQs9C40YHRgtGA0LjRgNC+0LLQsNGC0YzRgdGPJywKICAgIHNpZ25JbjogJ9CS0L7QudGC0LgnLAogICAgc2lnbk91dDogJ9CS0YvQudGC0LgnLAogICAgdXNlcm5hbWU6ICfQmNC80Y8g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPJywKICAgIHBhc3N3b3JkOiAn0J/QsNGA0L7Qu9GMJywKICAgIGVtYWlsOiAn0JDQtNGA0LXRgSBFLW1haWwnLAogICAgcmVhbE5hbWU6ICfQndCw0YHRgtC+0Y/RidC10LUg0LjQvNGPJywKICAgIHdoeVJlYWxOYW1lOiAn0JjRgdC/0L7Qu9GM0LfRg9C10YLRgdGPINC/0YDQuCDQstGL0YDQsNC20LXQvdC40Lgg0L3QsNGI0LXQuSDQsdC70LDQs9C+0LTQsNGA0L3QvtGB0YLQuCDRg9GH0LDRgdGC0L3QuNC60LDQvCwg0L3QsNC/0YDQuNC80LXRgCwg0LIg0L7QsdGB0YPQttC00LXQvdC40Y/RhSDQuNC70Lgg0L7QsdGK0Y/QstC70LXQvdC40Y/RhS4g0JXRgdC70Lgg0LLRiyDQvdC1INGF0L7RgtC40YLQtSwg0YfRgtC+0LHRiyDQstCw0YEg0YPQv9C+0LzQuNC90LDQu9C4INC/0YPQsdC70LjRh9C90L4sINC+0YHRgtCw0LLRjNGC0LUg0Y3RgtC+INC/0L7Qu9C1INC/0YPRgdGC0YvQvC4nLAogICAgbm9BY2NvdW50OiAn0J3QtdGCINCw0LrQutCw0YPQvdGC0LA/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAn0K8g0YHQvtCz0LvQsNGB0LXQvSDRgSA8YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy9wcml2YWN5IiB0YXJnZXQ9Il9ibGFuayI+0L/QvtC70LjRgtC40LrQvtC5INC60L7QvdGE0LjQtNC10L3RhtC40LDQu9GM0L3QvtGB0YLQuDwvYT4uJywKICAgIGJldGFQcmVmZXJlbmNlOiAn0K8g0YXQvtGH0YMg0L/QvtC70YPRh9Cw0YLRjCDQv9GA0LjQs9C70LDRiNC10L3QuNGPINC6INGD0YfQsNGB0YLQuNGOINCyINGC0LXRgdGC0LjRgNC+0LLQsNC90LjQuCDQvdC+0LLRi9GFINC/0YDQvtC10LrRgtC+0LIgWm9vbml2ZXJzZS4nLAogICAgZm9yZ290UGFzc3dvcmQ6ICfQl9Cw0LHRi9C70Lgg0L/QsNGA0L7Qu9GMPycsCiAgICBiYWRMb2dpbjogJ9Cd0LXQv9GA0LDQstC40LvRjNC90L7QtSDQuNC80Y8g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINC40LvQuCDQv9Cw0YDQvtC70YwnLAogICAgc2lnbkluRmFpbGVkOiAn0JLRhdC+0LQg0L3QtSDQstGL0L/QvtC70L3QtdC9LicsCiAgICBzaWduSW5Gb3JQcm9maWxlOiAn0JLQvtC50LTQuNGC0LUsINGH0YLQvtCx0Ysg0YPQstC40LTQtdGC0Ywg0YHQstC+0Lkg0L/RgNC+0YTQuNC70YwuJywKICAgIGZvb3RlckhlYWRpbmc6ICdab29uaXZlcnNlIOKAlCDRjdGC0L4g0LPRgNGD0L/Qv9CwINC+0L3Qu9Cw0LnQvS3Qv9GA0L7QtdC60YLQvtCyINCz0YDQsNC20LTQsNC90YHQutC+0Lkg0L3QsNGD0LrQuCwg0LPQtNC1INC00L7QsdGA0L7QstC+0LvRjNGG0Ysg0L/QvtC80L7Qs9Cw0Y7RgiDQvtCx0YDQsNCx0LDRgtGL0LLQsNGC0Ywg0L7Qs9GA0L7QvNC90YvQtSDQvtCx0YrQtdC80Ysg0LTQsNC90L3Ri9GFLCDRgSDQutC+0YLQvtGA0YvQvNC4INC/0YDQuNGF0L7QtNC40YLRgdGPINGB0YLQsNC70LrQuNCy0LDRgtGM0YHRjyDRg9GH0ZHQvdGL0LwuJywKICAgIHByaXZhY3lQb2xpY3k6ICfQn9C+0LvQuNGC0LjQutCwINC60L7QvdGE0LjQtNC10L3RhtC40LDQu9GM0L3QvtGB0YLQuCcsCiAgICBmb3JrT25HaXRIdWI6ICfQmNGB0YXQvtC00L3Ri9C5INC60L7QtCDQuCDQsdCw0LPQuCcsCiAgICByZWNlbnRzOiAn0J3QtdC00LDQstC90LjQtScsCiAgICBmYXZvcml0ZXM6ICfQmNC30LHRgNCw0L3QvdC+0LUnLAogICAgbm9uZTogJ9C/0YPRgdGC0L4nCiAgfTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLnRyYW5zbGF0aW9ucyA9PSBudWxsKSB7CiAgICBfYmFzZS50cmFuc2xhdGlvbnMgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLnRyYW5zbGF0aW9ucy5ydSA9IHJ1OwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJ1OwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIHpoX3R3LCBfYmFzZTsKCiAgemhfdHcgPSB7CiAgICB0b3BCYXJIZWFkaW5nOiAn44CMWm9vbml2ZXJzZeOAjeioiOeVqycsCiAgICBzaWduVXBIZWFkaW5nOiAnICLnlLPoq4vmlrDnmoTjgIxab29uaXZlcnNl44CN5biz6JmfJywKICAgIHNpZ25JbkhlYWRpbmc6ICfku6XjgIxab29uaXZlcnNl44CN5biz6Jmf55m75YWlICcsCiAgICBzaWduVXA6ICfmlrDlop7luLPomZ8nLAogICAgc2lnbkluOiAn55m75YWlJywKICAgIHNpZ25PdXQ6ICfnmbvlh7onLAogICAgdXNlcm5hbWU6ICfnlKjmiLblkI0nLAogICAgcGFzc3dvcmQ6ICflr4bnorwnLAogICAgZW1haWw6ICfpm7vlrZDkv6HnrrHluLPomZ8nLAogICAgcmVhbE5hbWU6ICfnnJ/lr6blp5PlkI0nLAogICAgd2h5UmVhbE5hbWU6ICfpgJnmnIPnlKjkvobmhJ/orJ3miJHlgJHnmoTljZTlipvlpKXkvLTvvIzorazlpoLmlL7lnKjmvJTorJvloLTlkIjmiJbmtbfloLHkuIrjgILlpoLmnpzkvaDkuI3poZjlhazplovnnJ/lr6blp5PlkI3vvIzlj6/ku6Xnqbrnmb3jgIInLAogICAgbm9BY2NvdW50OiAn6YKE5rKS6ZaL56uL6YGO5biz6Jmf5ZeO77yfJywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAn5oiR5ZCM5oSPIDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVyc2Uub3JnL3ByaXZhY3kiIHRhcmdldD0iX2JsYW5rIj4g6Zqx56eB5qyK6Kit5a6a6KaP5a6aPC9hPi4nLAogICAgYmV0YVByZWZlcmVuY2U6ICfmiJHmqILmhI/luavlv5nmuKzoqablsJrmnKrmraPlvI/kuIrnt5rnmoTjgIxab29uaXZlcnNl44CN6KiI55Wr5Lim5Y2U5Yqp6K6T56iL5byP5pu05a6M5ZaE77yM5pyJ5qmf5pyD6KuL6YCa55+l5oiR44CCJywKICAgIGZvcmdvdFBhc3N3b3JkOiAn5b+Y6KiY5a+G56K8PycsCiAgICBiYWRMb2dpbjogJ+eUqOaItuWQjeeosemMr+iqpOaIluWvhueivOmMr+iqpCcsCiAgICBzaWduSW5GYWlsZWQ6ICfnmbvlhaXlpLHmlZfjgIInLAogICAgc2lnbkluRm9yUHJvZmlsZTogJ+eZu+WFpeafpeeci+W3suWIhumhnuiomOmMhOOAgicsCiAgICBmb290ZXJIZWFkaW5nOiAnIOOAjFpvb25pdmVyc2XjgI3ntrLnq5nku6XntrLot6/mlrnlvI/orpPkuIDoiKzlpKfnnL7og73lj4PoiIflpJrnqK7noJTnqbbkuLvpoYznmoTnp5HlrbjoqIjnlavjgILlv5flt6XliIbpoZ7lk6HnmoTljZTlkIzliqrlipvvvIzluavliqnnp5HlrbjlrrbomZXnkIbkuobpvpDlpKfos4fmlpnvvIzpgJnmtbfph4/nmoTos4fmlpnljp/mnKzlsI3np5HlrbjlrrbmmK/lgIvkuI3lsI/nmoTmjJHmiLDvvIEnLAogICAgcHJpdmFjeVBvbGljeTogJ+maseengeasiuioreWumuimj+WumicsCiAgICBmb3JrT25HaXRIdWI6ICfljp/lp4vnorzlj4rpjK/oqqTlm57loLEnLAogICAgcmVjZW50czogJ+acgOaWsOWujOaIkOeahCcsCiAgICBmYXZvcml0ZXM6ICfmiJHnmoTmnIDmhJsnLAogICAgbm9uZTogJ+eEoScKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLnpoX3R3ID0gemhfdHc7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gemhfdHc7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgemhfY24sIF9iYXNlOwoKICB6aF9jbiA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdab29uaXZlcnNl6K6h5YiSJywKICAgIHNpZ25VcEhlYWRpbmc6ICcgIueUs+ivt+aWsOeahFpvb25pdmVyc2XluJDlj7cnLAogICAgc2lnbkluSGVhZGluZzogJ+eZu+WFpVpvb25pdmVyc2UnLAogICAgc2lnblVwOiAn55Sz6K+35biQ5Y+3JywKICAgIHNpZ25JbjogJ+eZu+WFpScsCiAgICBzaWduT3V0OiAn55m75Ye6JywKICAgIHVzZXJuYW1lOiAn55So5oi35ZCNJywKICAgIHBhc3N3b3JkOiAn5a+G56CBJywKICAgIGVtYWlsOiAn55S15a2Q5L+h566x5biQ5Y+3JywKICAgIHJlYWxOYW1lOiAn55yf5a6e5aeT5ZCNJywKICAgIHdoeVJlYWxOYW1lOiAn5bCG5Lya6KKr55So5p2l5oSf6LCi5oiR5Lus55qE5Y2P5Yqb5LyZ5Ly077yM6K2s5aaC5pS+5Zyo5ryU6K6y5Zy65ZCI5oiW5rW35oql5LiK44CC5aaC5p6c5L2g5LiN5oS/5YWs5byA55yf5a6e5aeT5ZCN77yM5Y+v5Lul56m655m944CCICcsCiAgICBub0FjY291bnQ6ICfov5jmsqHlvIDnq4vov4fluJDlj7flkJfvvJ8gJywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAn5oiR5ZCM5oSPPGEgaHJlZj0iaHR0cHM6Ly93d3cuem9vbml2ZXJzZS5vcmcvcHJpdmFjeSIgdGFyZ2V0PSJfYmxhbmsiPumakOengeadg+iuvuWumuinhOWumjwvYT4uJywKICAgIGJldGFQcmVmZXJlbmNlOiAn5oiR5oS/5oSP5biu5b+Z5rWL6K+V5bCa5pyq5q2j5byP5LiK57q/55qEICJab29uaXZlcnNl6K6h5YiSIiDlubbljY/liqnorqnnqIvlvI/mm7TlrozlloTvvIzmnInov5nnsbvmnLrkvJror7fpgJrnn6XmiJHjgIIgJywKICAgIGZvcmdvdFBhc3N3b3JkOiAn5b+Y6K6w5a+G56CBPycsCiAgICBiYWRMb2dpbjogJ+eUqOaIt+WQjeensOmUmeivr+aIluWvhueggemUmeivrycsCiAgICBzaWduSW5GYWlsZWQ6ICfnmbvlhaXlpLHotKXjgIIgJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICfnmbvlhaXmn6XnnIvlt7LliIbnsbvorrDlvZXjgIIgJywKICAgIGZvb3RlckhlYWRpbmc6ICcgWm9vbml2ZXJzZee9keermeS7pee9kei3r+aWueW8j+iuqeS4gOiIrOWkp+S8l+iDveWPguS4juWkmuenjeeglOeptuS4u+mimOeahOenkeWtpuiuoeWIkuOAgua1t+mHj+eahOi1hOaWmeWOn+acrOe1puenkeWtpuWutuW4puadpeS4jeWwj+eahOaMkeaImO+8jOi/mOWlveacieW/l+aEv+iAheWIhuexu+WRmOWNj+WQjOWKquWKm++8jOW3suW4ruWKqeenkeWtpuWutuWkhOeQhuS6huWkp+mHj+i1hOaWmeOAgiAnLAogICAgcHJpdmFjeVBvbGljeTogJ+makOengeadg+iuvuWumuinhOWumicsCiAgICBmb3JrT25HaXRIdWI6ICfljp/lp4vnoIHlj4rplJnor6/lm57miqUnLAogICAgcmVjZW50czogJ+acgOaWsOWujOaIkOeahCcsCiAgICBmYXZvcml0ZXM6ICfmiJHnmoTmnIDniLEnLAogICAgbm9uZTogJ+aXoCcKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLnpoX2NuID0gemhfY247CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gemhfY247CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgZGUsIF9iYXNlOwoKICBkZSA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdFaW4gUHJvamVrdCB2b24gWm9vbml2ZXJzZScsCiAgICBzaWduVXBIZWFkaW5nOiAnRWluIG5ldWVzIFpvb25pdmVyc2UtS29udG8gZXJzdGVsbGVuJywKICAgIHNpZ25JbkhlYWRpbmc6ICdNaXQgWm9vbml2ZXJzZS1Lb250byBhbm1lbGRlbicsCiAgICBzaWduVXA6ICdSZWdpc3RyaWVyZW4nLAogICAgc2lnbkluOiAnQW5tZWxkZW4nLAogICAgc2lnbk91dDogJ0FibWVsZGVuJywKICAgIHVzZXJuYW1lOiAnQmVudXR6ZXJuYW1lJywKICAgIHBhc3N3b3JkOiAnUGFzc3dvcnQnLAogICAgZW1haWw6ICdFLU1haWwnLAogICAgcmVhbE5hbWU6ICdUYXRzw6RjaGxpY2hlciBOYW1lJywKICAgIHdoeVJlYWxOYW1lOiAnV2VubiB3aXIgRnJlaXdpbGxpZ2VuIGRhbmtlbiwgenVtIEJlaXNwaWVsIGF1ZiBQb3N0ZXJuIG9kZXIgaW4gVm9ydHLDpGdlbiwgd2lyZCBkZWluIHRhdHPDpGNobGljaGVyIE5hbWUgdmVyd2VuZGV0LiBGYWxscyBkdSBuaWNodCDDtmZmZW50bGljaCBlcnfDpGhudCB3ZXJkZW4gd2lsbHN0LCBsYXNzZSBkaWVzZSBaZWlsZSBvZmZlbi4nLAogICAgbm9BY2NvdW50OiAnS2VpbiBCZW51dHplcmtvbnRvPycsCiAgICBhZ3JlZVRvUHJpdmFjeVBvbGljeTogJ0ljaCBzdGltbWUgZGVyIDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVyc2Uub3JnL3ByaXZhY3kiIHRhcmdldD0iX2JsYW5rIj5EYXRlbnNjaHV0enJpY2h0bGluaWU8L2E+IHp1LicsCiAgICBiZXRhUHJlZmVyZW5jZTogJ0ljaCB3w7xyZGUgZ2VybmUgZWluZSBOYWNocmljaHQgZXJoYWx0ZW4sIHdlbm4gZGllIEdlbGVnZW5oZWl0IGJlc3RlaHQsIG5ldWUgWm9vbml2ZXJzZS1Qcm9qZWt0ZSB6dSB0ZXN0ZW4gdW5kIG1laW5lIE1laW51bmcgYWJ6dWdlYmVuLicsCiAgICBmb3Jnb3RQYXNzd29yZDogJ1Bhc3N3b3J0IHZlcmdlc3Nlbj8nLAogICAgYmFkTG9naW46ICdGYWxzY2hlciBCZW51dHplcm5hbWUgb2RlciBmYWxzY2hlcyBQYXNzd29ydCcsCiAgICBzaWduSW5GYWlsZWQ6ICdBbm1lbGR1bmcgZmVobGdlc2NobGFnZW4uJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICdNZWxkZSBkaWNoIGFuLCB1bSBkZWluIFByb2ZpbCB6dSBzZWhlbi4nLAogICAgZm9vdGVySGVhZGluZzogJ1pvb25pdmVyc2UgaXN0IGVpbmUgU2FtbWx1bmcgdm9uIENpdGl6ZW4gU2NpZW5jZSBQcm9qZWt0ZW4gaW0gSW50ZXJuZXQsIGRpZSBkaWUgTGVpc3R1bmdlbiBGcmVpd2lsbGlnZXIgbnV0emVuLCB1bSBGb3JzY2hlcm4gbWl0IGRlciBEYXRlbmZsdXQgenUgaGVsZmVuLCBtaXQgZGVyIHNpZSBrb25mcm9udGllcnQgd2VyZGVuLicsCiAgICBwcml2YWN5UG9saWN5OiAnRGF0ZW5zY2h1dHpyaWNodGxpbmllJywKICAgIGZvcmtPbkdpdEh1YjogJ1NvdXJjZSAmIEJ1Z3MnLAogICAgcmVjZW50czogJ05ldWVzdGUnLAogICAgZmF2b3JpdGVzOiAnRmF2b3JpdGVuJywKICAgIG5vbmU6ICdrZWluZScKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLmRlID0gZGU7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gZGU7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgY3MsIF9iYXNlOwoKICBjcyA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdab29uaXZlcnNlIHByb2pla3QnLAogICAgc2lnblVwSGVhZGluZzogJ1Z5dHZvxZllbsOtIFpvb25pdmVyc2Ugw7rEjXR1JywKICAgIHNpZ25JbkhlYWRpbmc6ICdQxZlpaGxhxaFvdsOhbsOtIG5hIFpvb25pdmVyc2Ugw7rEjWV0JywKICAgIHNpZ25VcDogJ1phcmVnaXN0cm92YXQgc2UnLAogICAgc2lnbkluOiAnUMWZaWhsw6FzaXQgc2UnLAogICAgc2lnbk91dDogJ09kaGzDoXNpdCBzZScsCiAgICB1c2VybmFtZTogJ1XFvml2YXRlbHNrw6kgam3DqW5vJywKICAgIHBhc3N3b3JkOiAnSGVzbG8nLAogICAgZW1haWw6ICdFbWFpbCcsCiAgICByZWFsTmFtZTogJ1ByYXbDqSBqbcOpbm8nLAogICAgd2h5UmVhbE5hbWU6ICdUb3RvIGptw6lubyBiw712w6EgcG91xb5pdG8gcMWZaSBkxJtrb3bDoW7DrSBwxZlpc3DEm3ZhdGVsxa9tLCBuYXDFmS4gdiByb3pob3ZvcmVjaCBuZWJvIG5hIHBvc3RlcmVjaC4gUG9rdWQgc2kgbmVwxZllamV0ZSwgYWJ5IGJ5bG8gVmHFoWUgam3DqW5vIHp2ZcWZZWpuxJtubywgbmVjaHRlIHBvbMOtxI1rbyBwcsOhemRuw6kuJywKICAgIG5vQWNjb3VudDogJ05lbcOhdGUgamXFoXTEmyDDusSNZXQ/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAnU291aGxhc8OtbSBzZSA8YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy9wcml2YWN5IiB0YXJnZXQ9Il9ibGFuayI+esOhc2FkYW1pIG9jaHJhbnkgb3NvYm7DrWNoIMO6ZGFqxa88L2E+LicsCiAgICBiZXRhUHJlZmVyZW5jZTogJ0NoY2kgZG9zdMOhdmF0IG96bsOhbWVuw60gbyBtb8W+bm9zdGkgdGVzdG92w6Fuw60gZG9zdWQgbmV6dmXFmWVqbsSbbsO9Y2ggWm9vbml2ZXJzZSBwcm9qZWt0xa8gYSBwb3NreXRvdsOhbsOtIHpwxJt0bsOpIHZhemJ5LicsCiAgICBmb3Jnb3RQYXNzd29yZDogJ1phcG9tbsSbbGkganN0ZSBoZXNsbz8nLAogICAgYmFkTG9naW46ICdaYWRhbGkganN0ZSBjaHlibsOpIHXFvml2YXRlbHNrw6kgam3DqW5vLCBuZWJvIGhlc2xvLicsCiAgICBzaWduSW5GYWlsZWQ6ICdQxZlpaGzDocWhZW7DrSBzZSBuZXpkYcWZaWxvLicsCiAgICBzaWduSW5Gb3JQcm9maWxlOiAnSyB6b2JyYXplbsOtIFZhxaFlaG8gcHJvZmlsdSBqZSBudXRuw6kgc2UgcMWZaWhsw6FzaXQuJywKICAgIGZvb3RlckhlYWRpbmc6ICdab29uaXZlcnNlIGplIHNvdWJvciBvYsSNYW5za28gbmF1xI1uw71jaCB3ZWJvdsO9Y2ggcHJvamVrdMWvLCBrdGVyw6kgdnl1xb7DrXZhasOtIMO6c2lsw60gZG9icm92b2xuw61rxa8gcG9tb2N0IHbEm2Rjxa9tIHpwcmFjb3ZhdCBrdmFudGEgZGF0LCBqaW1pxb4ganNvdSBwxZlpIHN2w6ltIHbDvXprdW11IHphcGxhdmVuaS4nLAogICAgcHJpdmFjeVBvbGljeTogJ1rDoXNhZHkgb2NocmFueSBvc29ibsOtY2ggw7pkYWrFrycsCiAgICBmb3JrT25HaXRIdWI6ICdaZHJvam92w6kgc291Ym9yeSAmIGNoeWJ5JywKICAgIHJlY2VudHM6ICdOZWTDoXZuw6knLAogICAgZmF2b3JpdGVzOiAnT2Jsw61iZW7DqScsCiAgICBub25lOiAnxb3DoWRuw6knCiAgfTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLnRyYW5zbGF0aW9ucyA9PSBudWxsKSB7CiAgICBfYmFzZS50cmFuc2xhdGlvbnMgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLnRyYW5zbGF0aW9ucy5jcyA9IGNzOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGNzOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIHJvLCBfYmFzZTsKCiAgcm8gPSB7CiAgICB0b3BCYXJIZWFkaW5nOiAnVW4gcHJvaWVjdCBab29uaXZlcnNlJywKICAgIHNpZ25VcEhlYWRpbmc6ICdJbnJlZ2lzdHJlYXphIHVuIG5vdSBjb250IFpvb25pdmVyc2UnLAogICAgc2lnbkluSGVhZGluZzogJ0xvZ2hlYXphLXRlIGluIGNvdW50dWwgdGF1IFpvb25pdmVyc2UnLAogICAgc2lnblVwOiAnSW5yZWdpc3RyYXJlJywKICAgIHNpZ25JbjogJ0xvZ2FyZScsCiAgICBzaWduT3V0OiAnRGVsb2dhcmUnLAogICAgdXNlcm5hbWU6ICdOdW1lIHV0aWxpemF0b3InLAogICAgcGFzc3dvcmQ6ICdQYXJvbGEnLAogICAgZW1haWw6ICdFbWFpbCcsCiAgICByZWFsTmFtZTogJ051bWVsZSByZWFsJywKICAgIHdoeVJlYWxOYW1lOiAnQWNlc3RhIHZhIGZpIGZvbG9zaXQgcGVudHJ1IGEgbXVsdHVtaSBjb2xhYm9yYXRvcmlsb3IsIGRlIGV4ZW1wbHUsIGluIGRpc2N1dGlpIHNhdSBwZSBhZmlzZS4gRGFjYSBudSB2cmVpIHNhIGZpaSBtZW50aW9uYXQgaW4gcHVibGljLCBsYXNhIGFjZXN0IGNhbXAgbmVjb21wbGV0YXQuJywKICAgIG5vQWNjb3VudDogJ051IGFpIHVuIGNvbnQ/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAnU3VudCBkZSBhY29yZCBjdSA8YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy9wcml2YWN5IiB0YXJnZXQ9Il9ibGFuayI+cmVndWxpbGUgZGUgY29uZmlkZW50aWFsaXRhdGU8L2E+LicsCiAgICBiZXRhUHJlZmVyZW5jZTogJ0FzIGRvcmkgc2EgcHJpbWVzYyBtZXNhamUgZGVzcHJlIG9wb3J0dW5pdGF0aSBkZSBhIHRlc3RhIHNpIGNvbWVudGEgZGVzcHJlIHByb2llY3RlIFpvb25pdmVyc2UgbmVsYW5zYXRlLicsCiAgICBmb3Jnb3RQYXNzd29yZDogJ0FpIHVpdGF0IHBhcm9sYT8nLAogICAgYmFkTG9naW46ICdOdW1lIHV0aWxpemF0b3Igc2F1IHBhcm9sYSBlc3RlIGluY29yZWN0YScsCiAgICBzaWduSW5GYWlsZWQ6ICdMb2dhcmVhIGEgZXN1YXQuJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICdMb2doZWF6YS10ZSBwZW50cnUgYS10aSB2ZWRlYSBwcm9maWx1bC4nLAogICAgZm9vdGVySGVhZGluZzogJ1pvb25pdmVyc2UgZXN0ZSBvIGNvbGVjdGllIGRlIHByb2llY3RlIHN0aWludGlmaWNlIGNvbmR1c2Ugb25saW5lIGluIGNhcmUgdm9sdW50YXJpaSBpaSBhanV0YSBwZSBjZXJjZXRhdG9yaSBzYSBhZG1pbmlzdHJlemUgYWZsdXh1bCBkZSBkYXRlIGN1IGNhcmUgc2UgY29uZnJ1bnRhLicsCiAgICBwcml2YWN5UG9saWN5OiAnUmVndWxpIGRlIGNvbmZpZGVudGlhbGl0YXRlJywKICAgIGZvcmtPbkdpdEh1YjogJ0NvZCBzdXJzYSBzaSBlcm9yaScsCiAgICByZWNlbnRzOiAnUmVjZW50ZScsCiAgICBmYXZvcml0ZXM6ICdGYXZvcml0ZScsCiAgICBub25lOiAnbmljaSB1bmEnCiAgfTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLnRyYW5zbGF0aW9ucyA9PSBudWxsKSB7CiAgICBfYmFzZS50cmFuc2xhdGlvbnMgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLnRyYW5zbGF0aW9ucy5ybyA9IHJvOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJvOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyICQsIEV2ZW50RW1pdHRlciwgbG9nVHJpZ2dlcnMsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgbG9nVHJpZ2dlcnMgPSAhIX5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJ2xvZz0xJyk7CgogIEV2ZW50RW1pdHRlciA9IChmdW5jdGlvbigpIHsKICAgIHZhciBtZXRob2QsIG1ldGhvZE5hbWU7CgogICAgZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkge30KCiAgICBFdmVudEVtaXR0ZXIub24gPSBmdW5jdGlvbihldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgICAgaWYgKHRoaXMualF1ZXJ5RXZlbnRQcm94eSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5qUXVlcnlFdmVudFByb3h5ID0gJCh7fSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMualF1ZXJ5RXZlbnRQcm94eS5vbihldmVudE5hbWUsIGhhbmRsZXIpOwogICAgfTsKCiAgICBFdmVudEVtaXR0ZXIub25lID0gZnVuY3Rpb24oZXZlbnROYW1lLCBoYW5kbGVyKSB7CiAgICAgIGlmICh0aGlzLmpRdWVyeUV2ZW50UHJveHkgPT0gbnVsbCkgewogICAgICAgIHRoaXMualF1ZXJ5RXZlbnRQcm94eSA9ICQoe30pOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmpRdWVyeUV2ZW50UHJveHkub25lKGV2ZW50TmFtZSwgaGFuZGxlcik7CiAgICB9OwoKICAgIEV2ZW50RW1pdHRlci5vZmYgPSBmdW5jdGlvbihldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgICAgaWYgKHRoaXMualF1ZXJ5RXZlbnRQcm94eSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5qUXVlcnlFdmVudFByb3h5ID0gJCh7fSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMualF1ZXJ5RXZlbnRQcm94eS5vZmYoZXZlbnROYW1lLCBoYW5kbGVyKTsKICAgIH07CgogICAgRXZlbnRFbWl0dGVyLnRyaWdnZXIgPSBmdW5jdGlvbihldmVudE5hbWUsIGFyZ3MpIHsKICAgICAgdmFyIF9iYXNlLCBfcmVmOwogICAgICBpZiAoYXJncyA9PSBudWxsKSB7CiAgICAgICAgYXJncyA9IFtdOwogICAgICB9CiAgICAgIGlmIChsb2dUcmlnZ2VycykgewogICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIgJiYgY29uc29sZSAhPT0gbnVsbCkgewogICAgICAgICAgY29uc29sZS5pbmZvKHRoaXMubmFtZSB8fCB0aGlzLnRvU3RyaW5nKCksIGV2ZW50TmFtZS50b1VwcGVyQ2FzZSgpLCBhcmdzKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHRoaXMualF1ZXJ5RXZlbnRQcm94eSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5qUXVlcnlFdmVudFByb3h5ID0gJCh7fSk7CiAgICAgIH0KICAgICAgKF9yZWYgPSB0aGlzLmpRdWVyeUV2ZW50UHJveHkpLnRyaWdnZXIuYXBwbHkoX3JlZiwgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHR5cGVvZiAoX2Jhc2UgPSB0aGlzLmNvbnN0cnVjdG9yKS50cmlnZ2VyID09PSAiZnVuY3Rpb24iID8gX2Jhc2UudHJpZ2dlcihldmVudE5hbWUsIFt0aGlzXS5jb25jYXQoYXJncykpIDogdm9pZCAwOwogICAgfTsKCiAgICBmb3IgKG1ldGhvZE5hbWUgaW4gRXZlbnRFbWl0dGVyKSB7CiAgICAgIGlmICghX19oYXNQcm9wLmNhbGwoRXZlbnRFbWl0dGVyLCBtZXRob2ROYW1lKSkgY29udGludWU7CiAgICAgIG1ldGhvZCA9IEV2ZW50RW1pdHRlclttZXRob2ROYW1lXTsKICAgICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IG1ldGhvZDsKICAgIH0KCiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy50cmlnZ2VyKCdkZXN0cm95aW5nJyk7CiAgICAgIHJldHVybiB0aGlzLm9mZigpOwogICAgfTsKCiAgICBpZiAobG9nVHJpZ2dlcnMpIHsKICAgICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAiIiArIHRoaXMuY29uc3RydWN0b3IubmFtZSArICIgaW5zdGFuY2UiOwogICAgICB9OwogICAgfQoKICAgIHJldHVybiBFdmVudEVtaXR0ZXI7CgogIH0pKCk7CgogIHdpbmRvdy56b29uaXZlcnNlLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBFdmVudEVtaXR0ZXI7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgRXZlbnRFbWl0dGVyLCBQcm94eUZyYW1lLCBiZXRhLCBkZW1vLCBmbGFnZ2VkSG9zdCwgaGlnaFBvcnQsIGh0bWwsIG1lc3NhZ2VJZCwgX3JlZiwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIEV2ZW50RW1pdHRlciA9IHdpbmRvdy56b29uaXZlcnNlLkV2ZW50RW1pdHRlciB8fCByZXF1aXJlKCcuL2V2ZW50LWVtaXR0ZXInKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIGh0bWwgPSAkKGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZSk7CgogIG1lc3NhZ2VJZCA9IC0xOwoKICBkZW1vID0gISF+bG9jYXRpb24uaG9zdG5hbWUuaW5kZXhPZignZGVtbycpOwoKICBiZXRhID0gISF+bG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZignYmV0YScpOwoKICBoaWdoUG9ydCA9ICtsb2NhdGlvbi5wb3J0ID49IDEwMjQ7CgogIGZsYWdnZWRIb3N0ID0gKF9yZWYgPSBsb2NhdGlvbi5zZWFyY2gubWF0Y2goL2FwaT0oW14mXSspLykpICE9IG51bGwgPyBfcmVmWzFdIDogdm9pZCAwOwoKICBpZiAoKGZsYWdnZWRIb3N0ICE9IG51bGwpICYmICEhIX5mbGFnZ2VkSG9zdC5pbmRleE9mKCcvLycpKSB7CiAgICBmbGFnZ2VkSG9zdCA9ICIvLyIgKyBmbGFnZ2VkSG9zdDsKICB9CgogIFByb3h5RnJhbWUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoUHJveHlGcmFtZSwgX3N1cGVyKTsKCiAgICBQcm94eUZyYW1lLlJFSkVDVElPTiA9ICdQcm94eUZyYW1lIG5vdCBjb25uZWN0ZWQnOwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLmhvc3QgPSBmbGFnZ2VkSG9zdCB8fCAoImh0dHBzOi8vIiArIChkZW1vIHx8IGJldGEgfHwgaGlnaFBvcnQgPyAnZGV2JyA6ICdhcGknKSArICIuem9vbml2ZXJzZS5vcmciKTsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5wYXRoID0gJy9wcm94eSc7CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUubG9hZFRpbWVvdXQgPSA1ICogMTAwMDsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5yZXRyeVRpbWVvdXQgPSAyICogNjAgKiAxMDAwOwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLmVsID0gbnVsbDsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5jbGFzc05hbWUgPSAncHJveHktZnJhbWUnOwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLmF0dGVtcHQgPSAwOwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLnJlYWR5ID0gZmFsc2U7CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUuZmFpbGVkID0gZmFsc2U7CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUuZGVmZXJyZWRzID0gbnVsbDsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5xdWV1ZSA9IG51bGw7CgogICAgZnVuY3Rpb24gUHJveHlGcmFtZShwYXJhbXMpIHsKICAgICAgdmFyIHByb3BlcnR5LCB2YWx1ZSwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCkgewogICAgICAgIHBhcmFtcyA9IHt9OwogICAgICB9CiAgICAgIHRoaXMudGltZW91dCA9IF9fYmluZCh0aGlzLnRpbWVvdXQsIHRoaXMpOwogICAgICBQcm94eUZyYW1lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBmb3IgKHByb3BlcnR5IGluIHBhcmFtcykgewogICAgICAgIGlmICghX19oYXNQcm9wLmNhbGwocGFyYW1zLCBwcm9wZXJ0eSkpIGNvbnRpbnVlOwogICAgICAgIHZhbHVlID0gcGFyYW1zW3Byb3BlcnR5XTsKICAgICAgICBpZiAocHJvcGVydHkgaW4gdGhpcyAmJiAodmFsdWUgIT0gbnVsbCkpIHsKICAgICAgICAgIHRoaXNbcHJvcGVydHldID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLmRlZmVycmVkcyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5kZWZlcnJlZHMgPSB7fTsKICAgICAgfQogICAgICBpZiAodGhpcy5xdWV1ZSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5xdWV1ZSA9IFtdOwogICAgICB9CiAgICAgICQod2luZG93KS5vbignbWVzc2FnZScsIGZ1bmN0aW9uKF9hcmcpIHsKICAgICAgICB2YXIgZTsKICAgICAgICBlID0gX2FyZy5vcmlnaW5hbEV2ZW50OwogICAgICAgIGlmIChlLnNvdXJjZSA9PT0gX3RoaXMuZWwuZ2V0KDApLmNvbnRlbnRXaW5kb3cpIHsKICAgICAgICAgIHJldHVybiBfdGhpcy5vbk1lc3NhZ2UuYXBwbHkoX3RoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5jb25uZWN0KCk7CiAgICB9CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGVzdEJhZCwgX3JlZjEsCiAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICB0ZXN0QmFkID0gdGhpcy5hdHRlbXB0IDwgMCA/ICdfQkFEJyA6ICcnOwogICAgICB0aGlzLmF0dGVtcHQgKz0gMTsKICAgICAgaWYgKChfcmVmMSA9IHRoaXMuZWwpICE9IG51bGwpIHsKICAgICAgICBfcmVmMS5yZW1vdmUoKTsKICAgICAgfQogICAgICB0aGlzLmVsID0gJCgiPGlmcmFtZSBzcmM9JyIgKyB0aGlzLmhvc3QgKyB0aGlzLnBhdGggKyB0ZXN0QmFkICsgIicgY2xhc3M9JyIgKyB0aGlzLmNsYXNzTmFtZSArICInIGRhdGEtYXR0ZW1wdD0nIiArIHRoaXMuYXR0ZW1wdCArICInIHN0eWxlPSdkaXNwbGF5OiBub25lOyc+PC9pZnJhbWU+Iik7CiAgICAgIHRoaXMuZWwuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSk7CiAgICAgIHJldHVybiBzZXRUaW1lb3V0KChmdW5jdGlvbigpIHsKICAgICAgICBpZiAoIV90aGlzLnJlYWR5KSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMudGltZW91dCgpOwogICAgICAgIH0KICAgICAgfSksIHRoaXMubG9hZFRpbWVvdXQpOwogICAgfTsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5vblJlYWR5ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMuYXR0ZW1wdCA9IDA7CiAgICAgIHRoaXMucmVhZHkgPSB0cnVlOwogICAgICB0aGlzLmZhaWxlZCA9IGZhbHNlOwogICAgICBzZXRUaW1lb3V0KChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgcGF5bG9hZCwgX2ksIF9sZW4sIF9yZWYxLCBfcmVzdWx0czsKICAgICAgICBfcmVmMSA9IF90aGlzLnF1ZXVlOwogICAgICAgIF9yZXN1bHRzID0gW107CiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgcGF5bG9hZCA9IF9yZWYxW19pXTsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goX3RoaXMucHJvY2VzcyhwYXlsb2FkKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfSksIDEwMCk7CiAgICAgIGh0bWwucmVtb3ZlQ2xhc3MoJ29mZmxpbmUnKTsKICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcigncmVhZHknKTsKICAgIH07CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUudGltZW91dCA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnRyaWdnZXIoJ3RpbWVvdXQnLCB0aGlzLmxvYWRUaW1lb3V0KTsKICAgICAgcmV0dXJuIHRoaXMub25GYWlsZWQoKTsKICAgIH07CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUub25GYWlsZWQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHBheWxvYWQsIF9pLCBfbGVuLCBfcmVmMSwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIGlmICh0aGlzLnJlYWR5KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuZmFpbGVkID0gdHJ1ZTsKICAgICAgX3JlZjEgPSB0aGlzLnF1ZXVlOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYxLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgcGF5bG9hZCA9IF9yZWYxW19pXTsKICAgICAgICB0aGlzLmRlZmVycmVkc1twYXlsb2FkLmlkXS5yZWplY3QodGhpcy5jb25zdHJ1Y3Rvci5SRUpFQ1RJT04pOwogICAgICB9CiAgICAgIHRoaXMucXVldWUuc3BsaWNlKDApOwogICAgICBodG1sLmFkZENsYXNzKCdvZmZsaW5lJyk7CiAgICAgIHRoaXMudHJpZ2dlcignZmFpbCcpOwogICAgICByZXR1cm4gc2V0VGltZW91dCgoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLmNvbm5lY3QoKTsKICAgICAgfSksIHRoaXMucmV0cnlUaW1lb3V0KTsKICAgIH07CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKHBheWxvYWQsIGRvbmUsIGZhaWwpIHsKICAgICAgdmFyIGRlZmVycmVkLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgbWVzc2FnZUlkICs9IDE7CiAgICAgIHBheWxvYWQuaWQgPSBtZXNzYWdlSWQ7CiAgICAgIGRlZmVycmVkID0gbmV3ICQuRGVmZXJyZWQ7CiAgICAgIGRlZmVycmVkLnRoZW4oZG9uZSwgZmFpbCk7CiAgICAgIChmdW5jdGlvbihtZXNzYWdlSWQsIGRlZmVycmVkKSB7CiAgICAgICAgcmV0dXJuIGRlZmVycmVkLmFsd2F5cyhmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBkZWxldGUgX3RoaXMuZGVmZXJyZWRzW21lc3NhZ2VJZF07CiAgICAgICAgfSk7CiAgICAgIH0pKG1lc3NhZ2VJZCwgZGVmZXJyZWQpOwogICAgICB0aGlzLmRlZmVycmVkc1ttZXNzYWdlSWRdID0gZGVmZXJyZWQ7CiAgICAgIGlmICh0aGlzLmZhaWxlZCkgewogICAgICAgIGRlZmVycmVkLnJlamVjdCh0aGlzLmNvbnN0cnVjdG9yLlJFSkVDVElPTik7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5yZWFkeSkgewogICAgICAgIHRoaXMucHJvY2VzcyhwYXlsb2FkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnF1ZXVlLnB1c2gocGF5bG9hZCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKICAgIH07CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUucHJvY2VzcyA9IGZ1bmN0aW9uKHBheWxvYWQpIHsKICAgICAgcmV0dXJuIHRoaXMuZWwuZ2V0KDApLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksIHRoaXMuaG9zdCk7CiAgICB9OwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uKF9hcmcpIHsKICAgICAgdmFyIGUsIG1lc3NhZ2U7CiAgICAgIGUgPSBfYXJnLm9yaWdpbmFsRXZlbnQ7CiAgICAgIG1lc3NhZ2UgPSBKU09OLnBhcnNlKGUuZGF0YSk7CiAgICAgIGlmIChtZXNzYWdlLmlkID09PSAnUkVBRFknKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub25SZWFkeSgpOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmZhaWx1cmUpIHsKICAgICAgICB0aGlzLmRlZmVycmVkc1ttZXNzYWdlLmlkXS5yZWplY3QobWVzc2FnZS5yZXNwb25zZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kZWZlcnJlZHNbbWVzc2FnZS5pZF0ucmVzb2x2ZShtZXNzYWdlLnJlc3BvbnNlKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCdyZXNwb25zZScsIFttZXNzYWdlXSk7CiAgICB9OwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5lbC5yZW1vdmUoKTsKICAgICAgcmV0dXJuIFByb3h5RnJhbWUuX19zdXBlcl9fLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CgogICAgcmV0dXJuIFByb3h5RnJhbWU7CgogIH0pKEV2ZW50RW1pdHRlcik7CgogIHdpbmRvdy56b29uaXZlcnNlLlByb3h5RnJhbWUgPSBQcm94eUZyYW1lOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFByb3h5RnJhbWU7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgQXBpLCBFdmVudEVtaXR0ZXIsIFByb3h5RnJhbWUsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LAogICAgX19zbGljZSA9IFtdLnNsaWNlOwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIEV2ZW50RW1pdHRlciA9IHdpbmRvdy56b29uaXZlcnNlLkV2ZW50RW1pdHRlciB8fCByZXF1aXJlKCcuL2V2ZW50LWVtaXR0ZXInKTsKCiAgUHJveHlGcmFtZSA9IHdpbmRvdy56b29uaXZlcnNlLlByb3h5RnJhbWUgfHwgcmVxdWlyZSgnLi9wcm94eS1mcmFtZScpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgQXBpID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKEFwaSwgX3N1cGVyKTsKCiAgICBBcGkuY3VycmVudCA9IG51bGw7CgogICAgQXBpLnByb3RvdHlwZS5wcm9qZWN0ID0gJy4nOwoKICAgIEFwaS5wcm90b3R5cGUuaGVhZGVycyA9IHt9OwoKICAgIEFwaS5wcm90b3R5cGUucHJveHlGcmFtZSA9IG51bGw7CgogICAgZnVuY3Rpb24gQXBpKF9hcmcpIHsKICAgICAgdmFyIGhvc3QsIGxvYWRUaW1lb3V0LCBwYXRoLCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgX3JlZiA9IF9hcmcgIT0gbnVsbCA/IF9hcmcgOiB7fSwgdGhpcy5wcm9qZWN0ID0gX3JlZi5wcm9qZWN0LCBob3N0ID0gX3JlZi5ob3N0LCBwYXRoID0gX3JlZi5wYXRoLCBsb2FkVGltZW91dCA9IF9yZWYubG9hZFRpbWVvdXQ7CiAgICAgIEFwaS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgdGhpcy5wcm94eUZyYW1lID0gbmV3IFByb3h5RnJhbWUoewogICAgICAgIGhvc3Q6IGhvc3QsCiAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICBsb2FkVGltZW91dDogbG9hZFRpbWVvdXQKICAgICAgfSk7CiAgICAgIHRoaXMucHJveHlGcmFtZS5vbigncmVhZHknLCBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gX3RoaXMudHJpZ2dlcigncmVhZHknKTsKICAgICAgfSk7CiAgICAgIHRoaXMucHJveHlGcmFtZS5vbignZmFpbCcsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy50cmlnZ2VyKCdmYWlsJyk7CiAgICAgIH0pOwogICAgICB0aGlzLnNlbGVjdCgpOwogICAgfQoKICAgIEFwaS5wcm90b3R5cGUucmVxdWVzdCA9IGZ1bmN0aW9uKHR5cGUsIHVybCwgZGF0YSwgZG9uZSwgZmFpbCkgewogICAgICB2YXIgX3JlZjsKICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgX3JlZiA9IFtkb25lLCBkYXRhLCBudWxsXSwgZmFpbCA9IF9yZWZbMF0sIGRvbmUgPSBfcmVmWzFdLCBkYXRhID0gX3JlZlsyXTsKICAgICAgICB0aGlzLnRyaWdnZXIoJ3JlcXVlc3QnLCBbdHlwZSwgdXJsLCBkYXRhXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMucHJveHlGcmFtZS5zZW5kKHsKICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgIHVybDogdXJsLAogICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzCiAgICAgIH0sIGRvbmUsIGZhaWwpOwogICAgfTsKCiAgICBBcGkucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gd2luZG93LnJlcSA9IHRoaXMucmVxdWVzdC5hcHBseSh0aGlzLCBbJ2dldCddLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgfTsKCiAgICBBcGkucHJvdG90eXBlLmdldEpTT04gPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdC5hcHBseSh0aGlzLCBbJ2dldEpTT04nXS5jb25jYXQoX19zbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgIH07CgogICAgQXBpLnByb3RvdHlwZS5wb3N0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QuYXBwbHkodGhpcywgWydwb3N0J10uY29uY2F0KF9fc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICB9OwoKICAgIEFwaS5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QuYXBwbHkodGhpcywgWydwdXQnXS5jb25jYXQoX19zbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgIH07CgogICAgQXBpLnByb3RvdHlwZVsiZGVsZXRlIl0gPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdC5hcHBseSh0aGlzLCBbJ2RlbGV0ZSddLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgfTsKCiAgICBBcGkucHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnRyaWdnZXIoJ3NlbGVjdCcpOwogICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci5jdXJyZW50ID0gdGhpczsKICAgIH07CgogICAgQXBpLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucHJveHlGcmFtZS5kZXN0cm95KCk7CiAgICAgIHJldHVybiBBcGkuX19zdXBlcl9fLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CgogICAgcmV0dXJuIEFwaTsKCiAgfSkoRXZlbnRFbWl0dGVyKTsKCiAgd2luZG93Lnpvb25pdmVyc2UuQXBpID0gQXBpOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEFwaTsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciB0b2dnbGVDbGFzcywgX2Jhc2UsCiAgICBfX2luZGV4T2YgPSBbXS5pbmRleE9mIHx8IGZ1bmN0aW9uKGl0ZW0pIHsgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKykgeyBpZiAoaSBpbiB0aGlzICYmIHRoaXNbaV0gPT09IGl0ZW0pIHJldHVybiBpOyB9IHJldHVybiAtMTsgfTsKCiAgdG9nZ2xlQ2xhc3MgPSBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUsIGNvbmRpdGlvbikgewogICAgdmFyIGNsYXNzTGlzdCwgY29udGFpbmVkOwogICAgY2xhc3NMaXN0ID0gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoL1xzKy8pOwogICAgY29udGFpbmVkID0gX19pbmRleE9mLmNhbGwoY2xhc3NMaXN0LCBjbGFzc05hbWUpID49IDA7CiAgICBpZiAoY29uZGl0aW9uID09IG51bGwpIHsKICAgICAgY29uZGl0aW9uID0gIWNvbnRhaW5lZDsKICAgIH0KICAgIGNvbmRpdGlvbiA9ICEhY29uZGl0aW9uOwogICAgaWYgKCFjb250YWluZWQgJiYgY29uZGl0aW9uID09PSB0cnVlKSB7CiAgICAgIGNsYXNzTGlzdC5wdXNoKGNsYXNzTmFtZSk7CiAgICB9CiAgICBpZiAoY29udGFpbmVkICYmIGNvbmRpdGlvbiA9PT0gZmFsc2UpIHsKICAgICAgY2xhc3NMaXN0LnNwbGljZShjbGFzc0xpc3QuaW5kZXhPZihjbGFzc05hbWUpLCAxKTsKICAgIH0KICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3NMaXN0LmpvaW4oJyAnKTsKICAgIHJldHVybiBudWxsOwogIH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS51dGlsID09IG51bGwpIHsKICAgIF9iYXNlLnV0aWwgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLnV0aWwudG9nZ2xlQ2xhc3MgPSB0b2dnbGVDbGFzczsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSB0b2dnbGVDbGFzczsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBFdmVudEVtaXR0ZXIsIExhbmd1YWdlTWFuYWdlciwgX3JlZiwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LAogICAgX19pbmRleE9mID0gW10uaW5kZXhPZiB8fCBmdW5jdGlvbihpdGVtKSB7IGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsgaWYgKGkgaW4gdGhpcyAmJiB0aGlzW2ldID09PSBpdGVtKSByZXR1cm4gaTsgfSByZXR1cm4gLTE7IH07CgogIEV2ZW50RW1pdHRlciA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZi5FdmVudEVtaXR0ZXIgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4vZXZlbnQtZW1pdHRlcicpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgTGFuZ3VhZ2VNYW5hZ2VyID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKExhbmd1YWdlTWFuYWdlciwgX3N1cGVyKTsKCiAgICBMYW5ndWFnZU1hbmFnZXIuY3VycmVudCA9IG51bGw7CgogICAgTGFuZ3VhZ2VNYW5hZ2VyLmRlZmF1bHRMb2NhbGUgPSAnZW4nOwoKICAgIExhbmd1YWdlTWFuYWdlci5wcm90b3R5cGUudHJhbnNsYXRpb25zID0gbnVsbDsKCiAgICBMYW5ndWFnZU1hbmFnZXIucHJvdG90eXBlLmNvZGUgPSBudWxsOwoKICAgIGZ1bmN0aW9uIExhbmd1YWdlTWFuYWdlcihwYXJhbXMpIHsKICAgICAgdGhpcy5kZWZhdWx0U3RyaW5nc0Zvcm1hdCA9IF9fYmluZCh0aGlzLmRlZmF1bHRTdHJpbmdzRm9ybWF0LCB0aGlzKTsKICAgICAgdGhpcy5sYWJlbCA9IF9fYmluZCh0aGlzLmxhYmVsLCB0aGlzKTsKICAgICAgdmFyIHByb3BlcnR5LCB2YWx1ZSwgX2Jhc2UsIF9uYW1lLCBfcmVmMSwgX3JlZjIsIF9yZWYzLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgZm9yIChwcm9wZXJ0eSBpbiBwYXJhbXMpIHsKICAgICAgICBpZiAoIV9faGFzUHJvcC5jYWxsKHBhcmFtcywgcHJvcGVydHkpKSBjb250aW51ZTsKICAgICAgICB2YWx1ZSA9IHBhcmFtc1twcm9wZXJ0eV07CiAgICAgICAgaWYgKHByb3BlcnR5IGluIHRoaXMpIHsKICAgICAgICAgIHRoaXNbcHJvcGVydHldID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLnRyYW5zbGF0aW9ucyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy50cmFuc2xhdGlvbnMgPSB7fTsKICAgICAgfQogICAgICBpZiAodGhpcy5jb2RlID09IG51bGwpIHsKICAgICAgICB0aGlzLmNvZGUgPSAoX3JlZjEgPSBsb2NhdGlvbi5zZWFyY2gubWF0Y2goL2xhbmc9KFteJl0rKS8pKSAhPSBudWxsID8gX3JlZjFbMV0gOiB2b2lkIDA7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29kZSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5jb2RlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3pvb25pdmVyc2UtbGFuZ3VhZ2UtY29kZScpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmNvZGUgPT0gbnVsbCkgewogICAgICAgIHRoaXMuY29kZSA9IChfcmVmMiA9IG5hdmlnYXRvci5sYW5ndWFnZSkgIT0gbnVsbCA/IF9yZWYyLnNwbGl0KCctJylbMF0gOiB2b2lkIDA7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29kZSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5jb2RlID0gKF9yZWYzID0gbmF2aWdhdG9yLnVzZXJMYW5ndWFnZSkgIT0gbnVsbCA/IF9yZWYzLnNwbGl0KCctJylbMF0gOiB2b2lkIDA7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29kZSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5jb2RlID0gdGhpcy5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuY29kZTsKICAgICAgfQogICAgICBpZiAoX19pbmRleE9mLmNhbGwodGhpcy5jb2RlLCAnLycpID49IDAgfHwgX19pbmRleE9mLmNhbGwodGhpcy5jb2RlLCAnLmpzb24nKSA+PSAwKSB7CiAgICAgICAgaWYgKChfYmFzZSA9IHRoaXMudHJhbnNsYXRpb25zKVtfbmFtZSA9IHRoaXMuY29kZV0gPT0gbnVsbCkgewogICAgICAgICAgX2Jhc2VbX25hbWVdID0gewogICAgICAgICAgICBsYWJlbDogdGhpcy5jb2RlLAogICAgICAgICAgICBzdHJpbmdzOiB0aGlzLmNvZGUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuY29uc3RydWN0b3IuY3VycmVudCA9IHRoaXM7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLnNldExhbmd1YWdlKF90aGlzLmNvZGUpOwogICAgICB9KTsKICAgIH0KCiAgICBMYW5ndWFnZU1hbmFnZXIucHJvdG90eXBlLnNldExhbmd1YWdlID0gZnVuY3Rpb24oY29kZSwgZG9uZSwgZmFpbCkgewogICAgICB2YXIgbG9jYWxTdHJpbmdzLCBwYXRoVG9TdHJpbmdzLCByZXF1ZXN0LCBfcmVmMSwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMuY29kZSA9IGNvZGU7CiAgICAgIGlmICh0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvZGVdID09IG51bGwpIHsKICAgICAgICB0aGlzLmNvZGUgPSB0aGlzLmNvbnN0cnVjdG9yLmRlZmF1bHRMb2NhbGU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMudHJhbnNsYXRpb25zW3RoaXMuY29kZV0uc3RyaW5ncyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy50cmFuc2xhdGlvbnNbdGhpcy5jb2RlXS5zdHJpbmdzID0gdGhpcy5kZWZhdWx0U3RyaW5nc0Zvcm1hdCgpOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgdGhpcy50cmFuc2xhdGlvbnNbdGhpcy5jb2RlXS5zdHJpbmdzID09PSAnc3RyaW5nJykgewogICAgICAgIHBhdGhUb1N0cmluZ3MgPSAoX3JlZjEgPSB0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvZGVdKSAhPSBudWxsID8gX3JlZjEuc3RyaW5ncyA6IHZvaWQgMDsKICAgICAgICBsb2NhbFN0cmluZ3MgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ6b29uaXZlcnNlLWxhbmd1YWdlLXN0cmluZ3MtIiArIHRoaXMuY29kZSkpOwogICAgICAgIGlmIChsb2NhbFN0cmluZ3MgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy50cmFuc2xhdGlvbnNbdGhpcy5jb2RlXS5zdHJpbmdzID0gbG9jYWxTdHJpbmdzOwogICAgICAgICAgdGhpcy5zZXRMYW5ndWFnZSh0aGlzLmNvZGUsIGRvbmUsIGZhaWwpOwogICAgICAgIH0KICAgICAgICByZXF1ZXN0ID0gJC5nZXRKU09OKHBhdGhUb1N0cmluZ3MpOwogICAgICAgIHJlcXVlc3QuZG9uZShmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiem9vbml2ZXJzZS1sYW5ndWFnZS1zdHJpbmdzLSIgKyBfdGhpcy5jb2RlLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICBfdGhpcy50cmFuc2xhdGlvbnNbX3RoaXMuY29kZV0uc3RyaW5ncyA9IGRhdGE7CiAgICAgICAgICByZXR1cm4gX3RoaXMuc2V0TGFuZ3VhZ2UoX3RoaXMuY29kZSwgZG9uZSwgZmFpbCk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlcXVlc3QuZmFpbChmdW5jdGlvbigpIHsKICAgICAgICAgIF90aGlzLnRyaWdnZXIoJ2xhbmd1YWdlLWZldGNoLWZhaWwnKTsKICAgICAgICAgIHJldHVybiB0eXBlb2YgZmFpbCA9PT0gImZ1bmN0aW9uIiA/IGZhaWwuYXBwbHkobnVsbCwgYXJndW1lbnRzKSA6IHZvaWQgMDsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnem9vbml2ZXJzZS1sYW5ndWFnZS1jb2RlJywgdGhpcy5jb2RlKTsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJykubGFuZyA9IHRoaXMuY29kZTsKICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZS1sYW5ndWFnZScsIFt0aGlzLmNvZGUsIHRoaXMudHJhbnNsYXRpb25zW3RoaXMuY29kZV0uc3RyaW5nc10pOwogICAgICAgIHJldHVybiB0eXBlb2YgZG9uZSA9PT0gImZ1bmN0aW9uIiA/IGRvbmUodGhpcy5jb2RlLCB0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvZGVdLnN0cmluZ3MpIDogdm9pZCAwOwogICAgICB9CiAgICB9OwoKICAgIExhbmd1YWdlTWFuYWdlci5wcm90b3R5cGUubGFiZWwgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9yZWYxLCBfcmVmMjsKICAgICAgcmV0dXJuICgoX3JlZjEgPSB0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvZGVdKSAhPSBudWxsID8gX3JlZjEubGFiZWwgOiB2b2lkIDApIHx8ICgoX3JlZjIgPSB0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5jb2RlXSkgIT0gbnVsbCA/IF9yZWYyLmxhYmVsIDogdm9pZCAwKTsKICAgIH07CgogICAgTGFuZ3VhZ2VNYW5hZ2VyLnByb3RvdHlwZS5kZWZhdWx0U3RyaW5nc0Zvcm1hdCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gIi4vdHJhbnNsYXRpb25zLyIgKyB0aGlzLmNvZGUgKyAiLmpzb24iOwogICAgfTsKCiAgICByZXR1cm4gTGFuZ3VhZ2VNYW5hZ2VyOwoKICB9KShFdmVudEVtaXR0ZXIpOwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLkxhbmd1YWdlTWFuYWdlciA9IExhbmd1YWdlTWFuYWdlcjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBMYW5ndWFnZU1hbmFnZXI7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgTGFuZ3VhZ2VNYW5hZ2VyLCB0cmFuc2xhdGUsIF9yZWYsIF9yZWYxLCBfcmVmMTAsIF9yZWYxMSwgX3JlZjEyLCBfcmVmMTMsIF9yZWYxNCwgX3JlZjE1LCBfcmVmMTYsIF9yZWYxNywgX3JlZjE4LCBfcmVmMTksIF9yZWYyLCBfcmVmMjAsIF9yZWYzLCBfcmVmNCwgX3JlZjUsIF9yZWY2LCBfcmVmNywgX3JlZjgsIF9yZWY5LAogICAgX19zbGljZSA9IFtdLnNsaWNlOwoKICBMYW5ndWFnZU1hbmFnZXIgPSAoKF9yZWYgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IF9yZWYuTGFuZ3VhZ2VNYW5hZ2VyIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL2xhbmd1YWdlLW1hbmFnZXInKTsKCiAgdHJhbnNsYXRlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZWxlbWVudCwga2V5LCB0YWcsIF9hcmcsIF9pOwogICAgX2FyZyA9IDIgPD0gYXJndW1lbnRzLmxlbmd0aCA/IF9fc2xpY2UuY2FsbChhcmd1bWVudHMsIDAsIF9pID0gYXJndW1lbnRzLmxlbmd0aCAtIDEpIDogKF9pID0gMCwgW10pLCBrZXkgPSBhcmd1bWVudHNbX2krK107CiAgICB0YWcgPSBfYXJnWzBdOwogICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgIHRhZyA9ICdzcGFuJzsKICAgIH0KICAgIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7CiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSh0cmFuc2xhdGUuYXR0ciwga2V5KTsKICAgIHRyYW5zbGF0ZS5yZWZyZXNoKGVsZW1lbnQpOwogICAgcmV0dXJuIGVsZW1lbnQub3V0ZXJIVE1MOwogIH07CgogIHRyYW5zbGF0ZS5hdHRyID0gJ2RhdGEtem9vbml2ZXJzZS10cmFuc2xhdGUnOwoKICB0cmFuc2xhdGUuc3RyaW5ncyA9IHsKICAgIGVuOiAoKF9yZWYxID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjIgPSBfcmVmMS50cmFuc2xhdGlvbnMpICE9IG51bGwgPyBfcmVmMi5lbiA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdHJhbnNsYXRpb25zL2VuJyksCiAgICBlczogKChfcmVmMyA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWY0ID0gX3JlZjMudHJhbnNsYXRpb25zKSAhPSBudWxsID8gX3JlZjQuZXMgOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL3RyYW5zbGF0aW9ucy9lcycpLAogICAgZnI6ICgoX3JlZjUgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmNiA9IF9yZWY1LnRyYW5zbGF0aW9ucykgIT0gbnVsbCA/IF9yZWY2LmZyIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi90cmFuc2xhdGlvbnMvZnInKSwKICAgIHBsOiAoKF9yZWY3ID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjggPSBfcmVmNy50cmFuc2xhdGlvbnMpICE9IG51bGwgPyBfcmVmOC5wbCA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdHJhbnNsYXRpb25zL3BsJyksCiAgICBydTogKChfcmVmOSA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYxMCA9IF9yZWY5LnRyYW5zbGF0aW9ucykgIT0gbnVsbCA/IF9yZWYxMC5ydSA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdHJhbnNsYXRpb25zL3J1JyksCiAgICB6aF90dzogKChfcmVmMTEgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMTIgPSBfcmVmMTEudHJhbnNsYXRpb25zKSAhPSBudWxsID8gX3JlZjEyLnpoX3R3IDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi90cmFuc2xhdGlvbnMvemgtdHcnKSwKICAgIHpoX2NuOiAoKF9yZWYxMyA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYxNCA9IF9yZWYxMy50cmFuc2xhdGlvbnMpICE9IG51bGwgPyBfcmVmMTQuemhfY24gOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL3RyYW5zbGF0aW9ucy96aC1jbicpLAogICAgZGU6ICgoX3JlZjE1ID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjE2ID0gX3JlZjE1LnRyYW5zbGF0aW9ucykgIT0gbnVsbCA/IF9yZWYxNi5kZSA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdHJhbnNsYXRpb25zL2RlJyksCiAgICBjczogKChfcmVmMTcgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMTggPSBfcmVmMTcudHJhbnNsYXRpb25zKSAhPSBudWxsID8gX3JlZjE4LmNzIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi90cmFuc2xhdGlvbnMvY3MnKSwKICAgIHJvOiAoKF9yZWYxOSA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYyMCA9IF9yZWYxOS50cmFuc2xhdGlvbnMpICE9IG51bGwgPyBfcmVmMjAucm8gOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL3RyYW5zbGF0aW9ucy9ybycpCiAgfTsKCiAgdHJhbnNsYXRlLnJlZnJlc2ggPSBmdW5jdGlvbihlbGVtZW50LCBrZXkpIHsKICAgIHZhciBuYW1lLCBwcm9wZXJ0eSwgc3RyaW5nLCB2YWx1ZSwgX2ksIF9sZW4sIF9yZWYyMSwgX3JlZjIyLCBfcmVmMjMsIF9yZWYyNCwgX3JlZjI1LCBfcmVzdWx0czsKICAgIF9yZWYyMSA9IGVsZW1lbnQuYXR0cmlidXRlczsKICAgIF9yZXN1bHRzID0gW107CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYyMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICBfcmVmMjIgPSBfcmVmMjFbX2ldLCBuYW1lID0gX3JlZjIyLm5hbWUsIHZhbHVlID0gX3JlZjIyLnZhbHVlOwogICAgICBpZiAobmFtZS5zbGljZSgwLCB0cmFuc2xhdGUuYXR0ci5sZW5ndGgpICE9PSB0cmFuc2xhdGUuYXR0cikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwcm9wZXJ0eSA9IG5hbWUuc2xpY2UodHJhbnNsYXRlLmF0dHIubGVuZ3RoICsgMSkgfHwgJ2lubmVySFRNTCc7CiAgICAgIHN0cmluZyA9IChfcmVmMjMgPSB0cmFuc2xhdGUuc3RyaW5nc1soX3JlZjI0ID0gTGFuZ3VhZ2VNYW5hZ2VyLmN1cnJlbnQpICE9IG51bGwgPyBfcmVmMjQuY29kZSA6IHZvaWQgMF0pICE9IG51bGwgPyBfcmVmMjNbdmFsdWVdIDogdm9pZCAwOwogICAgICBzdHJpbmcgfHwgKHN0cmluZyA9IChfcmVmMjUgPSB0cmFuc2xhdGUuc3RyaW5nc1tMYW5ndWFnZU1hbmFnZXIuZGVmYXVsdExvY2FsZV0pICE9IG51bGwgPyBfcmVmMjVbdmFsdWVdIDogdm9pZCAwKTsKICAgICAgc3RyaW5nIHx8IChzdHJpbmcgPSB2YWx1ZSk7CiAgICAgIGlmIChlbGVtZW50Lmhhc0F0dHJpYnV0ZShwcm9wZXJ0eSkpIHsKICAgICAgICBfcmVzdWx0cy5wdXNoKGVsZW1lbnQuc2V0QXR0cmlidXRlKHByb3BlcnR5LCBzdHJpbmcpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfcmVzdWx0cy5wdXNoKGVsZW1lbnRbcHJvcGVydHldID0gc3RyaW5nKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIF9yZXN1bHRzOwogIH07CgogIExhbmd1YWdlTWFuYWdlci5vbignY2hhbmdlLWxhbmd1YWdlJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgZWxlbWVudCwgX2ksIF9sZW4sIF9yZWYyMSwgX3Jlc3VsdHM7CiAgICBfcmVmMjEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbIiArIHRyYW5zbGF0ZS5hdHRyICsgIl0iKTsKICAgIF9yZXN1bHRzID0gW107CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYyMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICBlbGVtZW50ID0gX3JlZjIxW19pXTsKICAgICAgX3Jlc3VsdHMucHVzaCh0cmFuc2xhdGUucmVmcmVzaChlbGVtZW50KSk7CiAgICB9CiAgICByZXR1cm4gX3Jlc3VsdHM7CiAgfSk7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRlID0gdHJhbnNsYXRlOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHRyYW5zbGF0ZTsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBFdmVudEVtaXR0ZXIsIEdBX1NDT1BFUywgR29vZ2xlQW5hbHl0aWNzLCBnYVNyYywgX3JlZiwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH0sCiAgICBfX3NsaWNlID0gW10uc2xpY2U7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgRXZlbnRFbWl0dGVyID0gd2luZG93Lnpvb25pdmVyc2UuRXZlbnRFbWl0dGVyIHx8IHJlcXVpcmUoJy4vZXZlbnQtZW1pdHRlcicpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgR0FfU0NPUEVTID0gewogICAgdmlzaXRvcjogMSwKICAgIHNlc3Npb246IDIsCiAgICBwYWdlOiAzCiAgfTsKCiAgZ2FTcmMgPSAnaHR0cDovL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7CgogIGlmICh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonKSB7CiAgICBnYVNyYyA9IGdhU3JjLnJlcGxhY2UoJ2h0dHA6Ly93d3cnLCAnaHR0cHM6Ly9zc2wnKTsKICB9CgogIEdvb2dsZUFuYWx5dGljcyA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhHb29nbGVBbmFseXRpY3MsIF9zdXBlcik7CgogICAgR29vZ2xlQW5hbHl0aWNzLmN1cnJlbnQgPSBudWxsOwoKICAgIEdvb2dsZUFuYWx5dGljcy5wcm90b3R5cGUuYWNjb3VudCA9ICcnOwoKICAgIEdvb2dsZUFuYWx5dGljcy5wcm90b3R5cGUuZG9tYWluID0gJyc7CgogICAgR29vZ2xlQW5hbHl0aWNzLnByb3RvdHlwZS50cmFja0hhc2hlcyA9IHRydWU7CgogICAgR29vZ2xlQW5hbHl0aWNzLnByb3RvdHlwZS5pZ25vcmVkU3ViZG9tYWluUmVmcyA9IFsnd3d3J107CgogICAgZnVuY3Rpb24gR29vZ2xlQW5hbHl0aWNzKHBhcmFtcykgewogICAgICB2YXIgcHJvcGVydHksIHN1YmRvbWFpbiwgdmFsdWUsIF9pLCBfbGVuLCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAgcGFyYW1zID0ge307CiAgICAgIH0KICAgICAgZm9yIChwcm9wZXJ0eSBpbiBwYXJhbXMpIHsKICAgICAgICB2YWx1ZSA9IHBhcmFtc1twcm9wZXJ0eV07CiAgICAgICAgdGhpc1twcm9wZXJ0eV0gPSB2YWx1ZTsKICAgICAgfQogICAgICB0aGlzLnNlbGVjdCgpOwogICAgICBpZiAoIXdpbmRvdy5fZ2FxKSB7CiAgICAgICAgJC5nZXRTY3JpcHQoZ2FTcmMpOwogICAgICB9CiAgICAgIGlmICh3aW5kb3cuX2dhcSA9PSBudWxsKSB7CiAgICAgICAgd2luZG93Ll9nYXEgPSBbXTsKICAgICAgfQogICAgICB3aW5kb3cuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCB0aGlzLmFjY291bnRdKTsKICAgICAgd2luZG93Ll9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pOwogICAgICBpZiAodGhpcy5kb21haW4pIHsKICAgICAgICB3aW5kb3cuX2dhcS5wdXNoKFsnX3NldERvbWFpbk5hbWUnLCB0aGlzLmRvbWFpbl0pOwogICAgICAgIF9yZWYgPSB0aGlzLmlnbm9yZWRTdWJkb21haW5SZWZzOwogICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgc3ViZG9tYWluID0gX3JlZltfaV07CiAgICAgICAgICB3aW5kb3cuX2dhcS5wdXNoKFsnX2FkZElnbm9yZWRSZWYnLCAiIiArIHN1YmRvbWFpbiArICIuIiArIHRoaXMuZG9tYWluXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLnRyYWNrSGFzaGVzKSB7CiAgICAgICAgJCh3aW5kb3cpLm9uKCdoYXNoY2hhbmdlJywgKGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzLnRyYWNrKCk7CiAgICAgICAgfSkpOwogICAgICB9CiAgICB9CgogICAgR29vZ2xlQW5hbHl0aWNzLnByb3RvdHlwZS5zZWxlY3QgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5jdXJyZW50ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcignc2VsZWN0Jyk7CiAgICB9OwoKICAgIEdvb2dsZUFuYWx5dGljcy5wcm90b3R5cGUudHJhY2sgPSBmdW5jdGlvbihwYXRobmFtZSkgewogICAgICBpZiAodHlwZW9mIHBhdGhuYW1lICE9PSAnc3RyaW5nJykgewogICAgICAgIHBhdGhuYW1lID0gIi8iICsgbG9jYXRpb24uaGFzaDsKICAgICAgfQogICAgICB3aW5kb3cuX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnLCBwYXRobmFtZV0pOwogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCd0cmFjaycsIFtwYXRobmFtZV0pOwogICAgfTsKCiAgICBHb29nbGVBbmFseXRpY3MucHJvdG90eXBlLmV2ZW50ID0gZnVuY3Rpb24oY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlLCBpZ25vcmVGb3JCb3VuY2VSYXRlKSB7CiAgICAgIHdpbmRvdy5fZ2FxLnB1c2goWydfdHJhY2tFdmVudCddLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCdldmVudCcsIF9fc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKICAgIH07CgogICAgR29vZ2xlQW5hbHl0aWNzLnByb3RvdHlwZS5jdXN0b20gPSBmdW5jdGlvbihpbmRleCwga2V5LCB2YWx1ZSwgc2NvcGUpIHsKICAgICAgdmFyIGNvbW1hbmQ7CiAgICAgIGlmICh0eXBlb2YgaW5kZXggPT09ICdzdHJpbmcnKSB7CiAgICAgICAgaW5kZXggPSB0aGlzLmNvbnN0cnVjdG9yLmluZGljZXNbaW5kZXhdOwogICAgICB9CiAgICAgIGlmICh0eXBlb2Ygc2NvcGUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgc2NvcGUgPSBHQV9TQ09QRVNbc2NvcGVdOwogICAgICB9CiAgICAgIGNvbW1hbmQgPSBbJ19zZXRDdXN0b21WYXInLCBpbmRleCwga2V5LCB2YWx1ZV07CiAgICAgIGlmIChzY29wZSAhPSBudWxsKSB7CiAgICAgICAgY29tbWFuZC5wdXNoKHNjb3BlKTsKICAgICAgfQogICAgICB3aW5kb3cuX2dhcS5wdXNoKGNvbW1hbmQpOwogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCdjdXN0b20nLCBfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSk7CiAgICB9OwoKICAgIHJldHVybiBHb29nbGVBbmFseXRpY3M7CgogIH0pKEV2ZW50RW1pdHRlcik7CgogIGlmICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsKSB7CiAgICBfcmVmLkdvb2dsZUFuYWx5dGljcyA9IEdvb2dsZUFuYWx5dGljczsKICB9CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gR29vZ2xlQW5hbHl0aWNzOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIEJhc2VNb2RlbCwgRXZlbnRFbWl0dGVyLCBfYmFzZSwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5tb2RlbHMgPT0gbnVsbCkgewogICAgX2Jhc2UubW9kZWxzID0ge307CiAgfQoKICBFdmVudEVtaXR0ZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5FdmVudEVtaXR0ZXIgfHwgcmVxdWlyZSgnLi4vbGliL2V2ZW50LWVtaXR0ZXInKTsKCiAgQmFzZU1vZGVsID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKEJhc2VNb2RlbCwgX3N1cGVyKTsKCiAgICBCYXNlTW9kZWwuaWRDb3VudGVyID0gLTE7CgogICAgQmFzZU1vZGVsLmluc3RhbmNlcyA9IG51bGw7CgogICAgQmFzZU1vZGVsLmNvdW50ID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLmluc3RhbmNlcyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5pbnN0YW5jZXMgPSBbXTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZXMubGVuZ3RoOwogICAgfTsKCiAgICBCYXNlTW9kZWwuZmlyc3QgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuaW5zdGFuY2VzID09IG51bGwpIHsKICAgICAgICB0aGlzLmluc3RhbmNlcyA9IFtdOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlc1swXTsKICAgIH07CgogICAgQmFzZU1vZGVsLmZpbmQgPSBmdW5jdGlvbihpZCkgewogICAgICB2YXIgaW5zdGFuY2UsIF9pLCBfbGVuLCBfcmVmOwogICAgICBpZiAodGhpcy5pbnN0YW5jZXMgPT0gbnVsbCkgewogICAgICAgIHRoaXMuaW5zdGFuY2VzID0gW107CiAgICAgIH0KICAgICAgX3JlZiA9IHRoaXMuaW5zdGFuY2VzOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBpbnN0YW5jZSA9IF9yZWZbX2ldOwogICAgICAgIGlmIChpbnN0YW5jZS5pZCA9PT0gaWQpIHsKICAgICAgICAgIHJldHVybiBpbnN0YW5jZTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgQmFzZU1vZGVsLnNlYXJjaCA9IGZ1bmN0aW9uKHF1ZXJ5KSB7CiAgICAgIHZhciBpbnN0YW5jZSwgbWlzcywgcHJvcGVydHksIHZhbHVlLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIGlmICh0aGlzLmluc3RhbmNlcyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5pbnN0YW5jZXMgPSBbXTsKICAgICAgfQogICAgICBfcmVmID0gdGhpcy5pbnN0YW5jZXM7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIGluc3RhbmNlID0gX3JlZltfaV07CiAgICAgICAgbWlzcyA9IGZhbHNlOwogICAgICAgIGZvciAocHJvcGVydHkgaW4gcXVlcnkpIHsKICAgICAgICAgIGlmICghX19oYXNQcm9wLmNhbGwocXVlcnksIHByb3BlcnR5KSkgY29udGludWU7CiAgICAgICAgICB2YWx1ZSA9IHF1ZXJ5W3Byb3BlcnR5XTsKICAgICAgICAgIGlmIChpbnN0YW5jZVtwcm9wZXJ0eV0gIT09IHZhbHVlKSB7CiAgICAgICAgICAgIG1pc3MgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG1pc3MpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBfcmVzdWx0cy5wdXNoKGluc3RhbmNlKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIEJhc2VNb2RlbC5kZXN0cm95QWxsID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfcmVzdWx0czsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgd2hpbGUgKHRoaXMuY291bnQoKSAhPT0gMCkgewogICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5maXJzdCgpLmRlc3Ryb3koKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICBCYXNlTW9kZWwucHJvdG90eXBlLmlkID0gbnVsbDsKCiAgICBmdW5jdGlvbiBCYXNlTW9kZWwocGFyYW1zKSB7CiAgICAgIHZhciBwcm9wZXJ0eSwgdmFsdWUsIF9iYXNlMTsKICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAgcGFyYW1zID0ge307CiAgICAgIH0KICAgICAgQmFzZU1vZGVsLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBmb3IgKHByb3BlcnR5IGluIHBhcmFtcykgewogICAgICAgIGlmICghX19oYXNQcm9wLmNhbGwocGFyYW1zLCBwcm9wZXJ0eSkpIGNvbnRpbnVlOwogICAgICAgIHZhbHVlID0gcGFyYW1zW3Byb3BlcnR5XTsKICAgICAgICB0aGlzW3Byb3BlcnR5XSA9IHZhbHVlOwogICAgICB9CiAgICAgIHRoaXMuY29uc3RydWN0b3IuaWRDb3VudGVyICs9IDE7CiAgICAgIGlmICh0aGlzLmlkID09IG51bGwpIHsKICAgICAgICB0aGlzLmlkID0gIkNfIiArIHRoaXMuY29uc3RydWN0b3IuaWRDb3VudGVyOwogICAgICB9CiAgICAgIGlmICgoX2Jhc2UxID0gdGhpcy5jb25zdHJ1Y3RvcikuaW5zdGFuY2VzID09IG51bGwpIHsKICAgICAgICBfYmFzZTEuaW5zdGFuY2VzID0gW107CiAgICAgIH0KICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5pbnN0YW5jZXMucHVzaCh0aGlzKTsKICAgIH0KCiAgICBCYXNlTW9kZWwucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGksIGluc3RhbmNlLCBfaSwgX2xlbiwgX3JlZiwgX3JlZjEsIF9yZXN1bHRzOwogICAgICBCYXNlTW9kZWwuX19zdXBlcl9fLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgX3JlZiA9IHRoaXMuY29uc3RydWN0b3IuaW5zdGFuY2VzOwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKGkgPSBfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBpID0gKytfaSkgewogICAgICAgIGluc3RhbmNlID0gX3JlZltpXTsKICAgICAgICBpZiAoIShpbnN0YW5jZSA9PT0gdGhpcykpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoKF9yZWYxID0gdGhpcy5jb25zdHJ1Y3Rvci5pbnN0YW5jZXMpICE9IG51bGwpIHsKICAgICAgICAgIF9yZWYxLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICByZXR1cm4gQmFzZU1vZGVsOwoKICB9KShFdmVudEVtaXR0ZXIpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuQmFzZU1vZGVsID0gQmFzZU1vZGVsOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEJhc2VNb2RlbDsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBBcGksIEV2ZW50RW1pdHRlciwgVXNlciwgYmFzZTY0LCBfYmFzZSwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH0sCiAgICBfX3NsaWNlID0gW10uc2xpY2U7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5tb2RlbHMgPT0gbnVsbCkgewogICAgX2Jhc2UubW9kZWxzID0ge307CiAgfQoKICBFdmVudEVtaXR0ZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5FdmVudEVtaXR0ZXIgfHwgcmVxdWlyZSgnLi4vbGliL2V2ZW50LWVtaXR0ZXInKTsKCiAgQXBpID0gd2luZG93Lnpvb25pdmVyc2UuQXBpIHx8IHJlcXVpcmUoJy4uL2xpYi9hcGknKTsKCiAgYmFzZTY0ID0gd2luZG93LmJhc2U2NCB8fCAocmVxdWlyZSgnLi4vdmVuZG9yL2Jhc2U2NCcpLCB3aW5kb3cuYmFzZTY0KTsKCiAgVXNlciA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhVc2VyLCBfc3VwZXIpOwoKICAgIFVzZXIuY3VycmVudCA9IGZhbHNlOwoKICAgIFVzZXIucGF0aCA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoQXBpLmN1cnJlbnQucHJvamVjdCkgewogICAgICAgIHJldHVybiAiL3Byb2plY3RzLyIgKyBBcGkuY3VycmVudC5wcm9qZWN0OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgfTsKCiAgICBVc2VyLmZldGNoID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBmZXRjaGVyLCBfcmVmOwogICAgICBVc2VyLnRyaWdnZXIoJ2ZldGNoaW5nJywgYXJndW1lbnRzKTsKICAgICAgZmV0Y2hlciA9IChfcmVmID0gQXBpLmN1cnJlbnQpLmdldEpTT04uYXBwbHkoX3JlZiwgWyIiICsgKFVzZXIucGF0aCgpKSArICIvY3VycmVudF91c2VyIl0uY29uY2F0KF9fc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGZldGNoZXIuYWx3YXlzKFVzZXIub25GZXRjaCk7CiAgICAgIHJldHVybiBmZXRjaGVyOwogICAgfTsKCiAgICBVc2VyLmxvZ2luID0gZnVuY3Rpb24oX2FyZykgewogICAgICB2YXIgbG9naW4sIHBhc3N3b3JkLCB1c2VybmFtZSwgX3JlZjsKICAgICAgdXNlcm5hbWUgPSBfYXJnLnVzZXJuYW1lLCBwYXNzd29yZCA9IF9hcmcucGFzc3dvcmQ7CiAgICAgIHRoaXMudHJpZ2dlcignbG9nZ2luZy1pbicsIGFyZ3VtZW50cyk7CiAgICAgIGxvZ2luID0gKF9yZWYgPSBBcGkuY3VycmVudCkuZ2V0SlNPTi5hcHBseShfcmVmLCBbIiIgKyAodGhpcy5wYXRoKCkpICsgIi9sb2dpbiJdLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICBsb2dpbi5kb25lKHRoaXMub25GZXRjaCk7CiAgICAgIGxvZ2luLmZhaWwodGhpcy5vbkZhaWwpOwogICAgICByZXR1cm4gbG9naW47CiAgICB9OwoKICAgIFVzZXIubG9nb3V0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsb2dvdXQsIF9yZWY7CiAgICAgIHRoaXMudHJpZ2dlcignbG9nZ2luZy1vdXQnLCBhcmd1bWVudHMpOwogICAgICBsb2dvdXQgPSAoX3JlZiA9IEFwaS5jdXJyZW50KS5nZXRKU09OLmFwcGx5KF9yZWYsIFsiIiArICh0aGlzLnBhdGgoKSkgKyAiL2xvZ291dCJdLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICBsb2dvdXQuYWx3YXlzKHRoaXMub25GZXRjaCk7CiAgICAgIHJldHVybiBsb2dvdXQ7CiAgICB9OwoKICAgIFVzZXIuc2lnbnVwID0gZnVuY3Rpb24oX2FyZykgewogICAgICB2YXIgZW1haWwsIHBhc3N3b3JkLCBzaWdudXAsIHVzZXJuYW1lLCBfcmVmOwogICAgICB1c2VybmFtZSA9IF9hcmcudXNlcm5hbWUsIHBhc3N3b3JkID0gX2FyZy5wYXNzd29yZCwgZW1haWwgPSBfYXJnLmVtYWlsOwogICAgICB0aGlzLnRyaWdnZXIoJ3NpZ25pbmctdXAnKTsKICAgICAgc2lnbnVwID0gKF9yZWYgPSBBcGkuY3VycmVudCkuZ2V0SlNPTi5hcHBseShfcmVmLCBbIiIgKyAodGhpcy5wYXRoKCkpICsgIi9zaWdudXAiXS5jb25jYXQoX19zbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgICAgc2lnbnVwLmFsd2F5cyh0aGlzLm9uRmV0Y2gpOwogICAgICByZXR1cm4gc2lnbnVwOwogICAgfTsKCiAgICBVc2VyLm9uRmV0Y2ggPSBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgdmFyIGF1dGgsIG9yaWdpbmFsOwogICAgICBvcmlnaW5hbCA9IFVzZXIuY3VycmVudDsKICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzICYmICduYW1lJyBpbiByZXN1bHQgJiYgJ2FwaV9rZXknIGluIHJlc3VsdCkgewogICAgICAgIFVzZXIuY3VycmVudCA9IG5ldyBVc2VyKHJlc3VsdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgVXNlci5jdXJyZW50ID0gbnVsbDsKICAgICAgfQogICAgICBpZiAoVXNlci5jdXJyZW50KSB7CiAgICAgICAgYXV0aCA9IGJhc2U2NC5lbmNvZGUoIiIgKyBVc2VyLmN1cnJlbnQubmFtZSArICI6IiArIFVzZXIuY3VycmVudC5hcGlfa2V5KTsKICAgICAgICBBcGkuY3VycmVudC5oZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSAiQmFzaWMgIiArIGF1dGg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIEFwaS5jdXJyZW50LmhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXTsKICAgICAgfQogICAgICBpZiAoVXNlci5jdXJyZW50ICE9PSBvcmlnaW5hbCkgewogICAgICAgIGlmIChvcmlnaW5hbCkgewogICAgICAgICAgb3JpZ2luYWwuZGVzdHJveSgpOwogICAgICAgIH0KICAgICAgICBVc2VyLnRyaWdnZXIoJ2NoYW5nZScsIFtVc2VyLmN1cnJlbnRdKTsKICAgICAgfQogICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIFVzZXIudHJpZ2dlcignc2lnbi1pbi1lcnJvcicsIHJlc3VsdC5tZXNzYWdlKTsKICAgICAgfQogICAgfTsKCiAgICBVc2VyLm9uRmFpbCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gVXNlci50cmlnZ2VyKCdzaWduLWluLWZhaWx1cmUnKTsKICAgIH07CgogICAgVXNlci5wcm90b3R5cGUuaWQgPSAnJzsKCiAgICBVc2VyLnByb3RvdHlwZS56b29uaXZlcnNlX2lkID0gJyc7CgogICAgVXNlci5wcm90b3R5cGUuYXBpX2tleSA9ICcnOwoKICAgIFVzZXIucHJvdG90eXBlLm5hbWUgPSAnJzsKCiAgICBVc2VyLnByb3RvdHlwZS5hdmF0YXIgPSAnJzsKCiAgICBVc2VyLnByb3RvdHlwZS5wcm9qZWN0ID0gbnVsbDsKCiAgICBmdW5jdGlvbiBVc2VyKHBhcmFtcykgewogICAgICB2YXIgcHJvcGVydHksIHZhbHVlOwogICAgICBpZiAocGFyYW1zID09IG51bGwpIHsKICAgICAgICBwYXJhbXMgPSB7fTsKICAgICAgfQogICAgICBmb3IgKHByb3BlcnR5IGluIHBhcmFtcykgewogICAgICAgIGlmICghX19oYXNQcm9wLmNhbGwocGFyYW1zLCBwcm9wZXJ0eSkpIGNvbnRpbnVlOwogICAgICAgIHZhbHVlID0gcGFyYW1zW3Byb3BlcnR5XTsKICAgICAgICB0aGlzW3Byb3BlcnR5XSA9IHZhbHVlOwogICAgICB9CiAgICB9CgogICAgVXNlci5wcm90b3R5cGUuc2V0R3JvdXAgPSBmdW5jdGlvbihncm91cElkLCBjYWxsYmFjaykgewogICAgICB2YXIgZ2V0LCBwYXRoLCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgaWYgKFVzZXIuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHBhdGggPSBncm91cElkICE9IG51bGwgPyAiL3VzZXJfZ3JvdXBzLyIgKyBncm91cElkICsgIi9wYXJ0aWNpcGF0ZSIgOiAiL3VzZXJfZ3JvdXBzL1RPRE9fSE9XX0RPX0lfTEVBVkVfQV9HUk9VUC9wYXJ0aWNpcGF0ZSI7CiAgICAgIGdldCA9IChfcmVmID0gQXBpLmN1cnJlbnQpICE9IG51bGwgPyBfcmVmLmdldEpTT04ocGF0aCwgZnVuY3Rpb24oZ3JvdXApIHsKICAgICAgICBfdGhpcy50cmlnZ2VyKCdjaGFuZ2UtZ3JvdXAnLCBncm91cCk7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIiA/IGNhbGxiYWNrLmFwcGx5KG51bGwsIGFyZ3VtZW50cykgOiB2b2lkIDA7CiAgICAgIH0pIDogdm9pZCAwOwogICAgICByZXR1cm4gZ2V0OwogICAgfTsKCiAgICBVc2VyLnByb3RvdHlwZS5zZXRQcmVmZXJlbmNlID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSwgZ2xvYmFsLCBjYWxsYmFjaykgewogICAgICB2YXIgX2Jhc2UxLCBfYmFzZTIsIF9uYW1lLCBfcmVmOwogICAgICBpZiAoZ2xvYmFsID09IG51bGwpIHsKICAgICAgICBnbG9iYWwgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoVXNlci5jdXJyZW50ID09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBnbG9iYWwgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBfcmVmID0gW2ZhbHNlLCBnbG9iYWxdLCBnbG9iYWwgPSBfcmVmWzBdLCBjYWxsYmFjayA9IF9yZWZbMV07CiAgICAgIH0KICAgICAgaWYgKChfYmFzZTEgPSBVc2VyLmN1cnJlbnQpLnByZWZlcmVuY2VzID09IG51bGwpIHsKICAgICAgICBfYmFzZTEucHJlZmVyZW5jZXMgPSB7fTsKICAgICAgfQogICAgICBpZiAoZ2xvYmFsKSB7CiAgICAgICAgVXNlci5jdXJyZW50LnByZWZlcmVuY2VzW2tleV0gPSB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoKF9iYXNlMiA9IFVzZXIuY3VycmVudC5wcmVmZXJlbmNlcylbX25hbWUgPSBBcGkuY3VycmVudC5wcm9qZWN0XSA9PSBudWxsKSB7CiAgICAgICAgICBfYmFzZTJbX25hbWVdID0ge307CiAgICAgICAgfQogICAgICAgIFVzZXIuY3VycmVudC5wcmVmZXJlbmNlc1tBcGkuY3VycmVudC5wcm9qZWN0XVtrZXldID0gdmFsdWU7CiAgICAgIH0KICAgICAgaWYgKCFnbG9iYWwpIHsKICAgICAgICBrZXkgPSAiIiArIEFwaS5jdXJyZW50LnByb2plY3QgKyAiLiIgKyBrZXk7CiAgICAgIH0KICAgICAgcmV0dXJuIEFwaS5jdXJyZW50LnB1dCgiL3VzZXJzL3ByZWZlcmVuY2VzIiwgewogICAgICAgIGtleToga2V5LAogICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICB9LCBjYWxsYmFjayk7CiAgICB9OwoKICAgIFVzZXIucHJvdG90eXBlLmRlbGV0ZVByZWZlcmVuY2UgPSBmdW5jdGlvbihrZXksIGdsb2JhbCwgY2FsbGJhY2spIHsKICAgICAgdmFyIF9iYXNlMSwgX2Jhc2UyLCBfbmFtZSwgX3JlZjsKICAgICAgaWYgKGdsb2JhbCA9PSBudWxsKSB7CiAgICAgICAgZ2xvYmFsID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKFVzZXIuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgZ2xvYmFsID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgX3JlZiA9IFtmYWxzZSwgZ2xvYmFsXSwgZ2xvYmFsID0gX3JlZlswXSwgY2FsbGJhY2sgPSBfcmVmWzFdOwogICAgICB9CiAgICAgIGlmICgoX2Jhc2UxID0gVXNlci5jdXJyZW50KS5wcmVmZXJlbmNlcyA9PSBudWxsKSB7CiAgICAgICAgX2Jhc2UxLnByZWZlcmVuY2VzID0ge307CiAgICAgIH0KICAgICAgaWYgKGdsb2JhbCkgewogICAgICAgIGRlbGV0ZSBVc2VyLmN1cnJlbnQucHJlZmVyZW5jZXNba2V5XTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoKF9iYXNlMiA9IFVzZXIuY3VycmVudC5wcmVmZXJlbmNlcylbX25hbWUgPSBBcGkuY3VycmVudC5wcm9qZWN0XSA9PSBudWxsKSB7CiAgICAgICAgICBfYmFzZTJbX25hbWVdID0ge307CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBVc2VyLmN1cnJlbnQucHJlZmVyZW5jZXNbQXBpLmN1cnJlbnQucHJvamVjdF1ba2V5XTsKICAgICAgfQogICAgICBpZiAoIWdsb2JhbCkgewogICAgICAgIGtleSA9ICIiICsgQXBpLmN1cnJlbnQucHJvamVjdCArICIuIiArIGtleTsKICAgICAgfQogICAgICByZXR1cm4gQXBpLmN1cnJlbnRbImRlbGV0ZSJdKCIvdXNlcnMvcHJlZmVyZW5jZXMiLCB7CiAgICAgICAga2V5OiBrZXkKICAgICAgfSwgY2FsbGJhY2spOwogICAgfTsKCiAgICByZXR1cm4gVXNlcjsKCiAgfSkuY2FsbCh0aGlzLCBFdmVudEVtaXR0ZXIpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuVXNlciA9IFVzZXI7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gVXNlcjsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBBcGksIEJhc2VNb2RlbCwgU3ViamVjdCwgX2Jhc2UsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LAogICAgX19pbmRleE9mID0gW10uaW5kZXhPZiB8fCBmdW5jdGlvbihpdGVtKSB7IGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsgaWYgKGkgaW4gdGhpcyAmJiB0aGlzW2ldID09PSBpdGVtKSByZXR1cm4gaTsgfSByZXR1cm4gLTE7IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5tb2RlbHMgPT0gbnVsbCkgewogICAgX2Jhc2UubW9kZWxzID0ge307CiAgfQoKICBCYXNlTW9kZWwgPSB6b29uaXZlcnNlLm1vZGVscy5CYXNlTW9kZWwgfHwgcmVxdWlyZSgnLi9iYXNlLW1vZGVsJyk7CgogIEFwaSA9IHpvb25pdmVyc2UuQXBpIHx8IHJlcXVpcmUoJy4uL2xpYi9hcGknKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIFN1YmplY3QgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoU3ViamVjdCwgX3N1cGVyKTsKCiAgICBTdWJqZWN0LmN1cnJlbnQgPSBudWxsOwoKICAgIFN1YmplY3Quc2VlblRoaXNTZXNzaW9uID0gW107CgogICAgU3ViamVjdC5xdWV1ZU1pbiA9IDI7CgogICAgU3ViamVjdC5xdWV1ZU1heCA9IDEwOwoKICAgIFN1YmplY3QuZ3JvdXAgPSBmYWxzZTsKCiAgICBTdWJqZWN0LmZhbGxiYWNrID0gIi4vb2ZmbGluZS9zdWJqZWN0cy5qc29uIjsKCiAgICBTdWJqZWN0LnBhdGggPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGdyb3VwU3RyaW5nOwogICAgICBncm91cFN0cmluZyA9ICF0aGlzLmdyb3VwID8gJycgOiB0aGlzLmdyb3VwID09PSB0cnVlID8gJ2dyb3Vwcy8nIDogImdyb3Vwcy8iICsgdGhpcy5ncm91cCArICIvIjsKICAgICAgcmV0dXJuICIvcHJvamVjdHMvIiArIEFwaS5jdXJyZW50LnByb2plY3QgKyAiLyIgKyBncm91cFN0cmluZyArICJzdWJqZWN0cyI7CiAgICB9OwoKICAgIFN1YmplY3QubmV4dCA9IGZ1bmN0aW9uKGRvbmUsIGZhaWwpIHsKICAgICAgdmFyIGZldGNoZXIsIG5leHRlciwgX3JlZiwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMudHJpZ2dlcignZ2V0LW5leHQnKTsKICAgICAgaWYgKChfcmVmID0gdGhpcy5jdXJyZW50KSAhPSBudWxsKSB7CiAgICAgICAgX3JlZi5kZXN0cm95KCk7CiAgICAgIH0KICAgICAgdGhpcy5jdXJyZW50ID0gbnVsbDsKICAgICAgbmV4dGVyID0gbmV3ICQuRGVmZXJyZWQ7CiAgICAgIG5leHRlci50aGVuKGRvbmUsIGZhaWwpOwogICAgICBpZiAodGhpcy5jb3VudCgpID09PSAwKSB7CiAgICAgICAgZmV0Y2hlciA9IHRoaXMuZmV0Y2goKTsKICAgICAgICBmZXRjaGVyLmRvbmUoZnVuY3Rpb24obmV3U3ViamVjdHMpIHsKICAgICAgICAgIHZhciBfcmVmMTsKICAgICAgICAgIGlmICgoX3JlZjEgPSBfdGhpcy5maXJzdCgpKSAhPSBudWxsKSB7CiAgICAgICAgICAgIF9yZWYxLnNlbGVjdCgpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKF90aGlzLmN1cnJlbnQpIHsKICAgICAgICAgICAgcmV0dXJuIG5leHRlci5yZXNvbHZlKF90aGlzLmN1cnJlbnQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMudHJpZ2dlcignbm8tbW9yZScpOwogICAgICAgICAgICByZXR1cm4gbmV4dGVyLnJlamVjdC5hcHBseShuZXh0ZXIsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgZmV0Y2hlci5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIG5leHRlci5yZWplY3QuYXBwbHkobmV4dGVyLCBhcmd1bWVudHMpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlyc3QoKS5zZWxlY3QoKTsKICAgICAgICBuZXh0ZXIucmVzb2x2ZSh0aGlzLmN1cnJlbnQpOwogICAgICAgIGlmICh0aGlzLmNvdW50KCkgPCB0aGlzLnF1ZXVlTWluKSB7CiAgICAgICAgICB0aGlzLmZldGNoKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXh0ZXIucHJvbWlzZSgpOwogICAgfTsKCiAgICBTdWJqZWN0LnRyYWNrU2VlblN1YmplY3QgPSBmdW5jdGlvbihzdWJqZWN0KSB7CiAgICAgIHJldHVybiB0aGlzLnNlZW5UaGlzU2Vzc2lvbi5wdXNoKHN1YmplY3Quem9vbml2ZXJzZV9pZCk7CiAgICB9OwoKICAgIFN1YmplY3QuaGFzU2VlblN1YmplY3QgPSBmdW5jdGlvbihzdWJqZWN0KSB7CiAgICAgIHZhciBfcmVmOwogICAgICByZXR1cm4gX3JlZiA9IHN1YmplY3Quem9vbml2ZXJzZV9pZCwgX19pbmRleE9mLmNhbGwodGhpcy5zZWVuVGhpc1Nlc3Npb24sIF9yZWYpID49IDA7CiAgICB9OwoKICAgIFN1YmplY3QuZmV0Y2ggPSBmdW5jdGlvbihwYXJhbXMsIGRvbmUsIGZhaWwpIHsKICAgICAgdmFyIGZldGNoZXIsIGxpbWl0LCByZXF1ZXN0LCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgaWYgKHR5cGVvZiBwYXJhbXMgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBfcmVmID0gW3BhcmFtcywgZG9uZSwge31dLCBkb25lID0gX3JlZlswXSwgZmFpbCA9IF9yZWZbMV0sIHBhcmFtcyA9IF9yZWZbMl07CiAgICAgIH0KICAgICAgbGltaXQgPSAocGFyYW1zIHx8IHt9KS5saW1pdDsKICAgICAgaWYgKGxpbWl0ID09IG51bGwpIHsKICAgICAgICBsaW1pdCA9IHRoaXMucXVldWVNYXggLSB0aGlzLmNvdW50KCk7CiAgICAgIH0KICAgICAgZmV0Y2hlciA9IG5ldyAkLkRlZmVycmVkOwogICAgICBmZXRjaGVyLnRoZW4oZG9uZSwgZmFpbCk7CiAgICAgIGlmIChsaW1pdCA+IDApIHsKICAgICAgICByZXF1ZXN0ID0gQXBpLmN1cnJlbnQuZ2V0KHRoaXMucGF0aCgpLCB7CiAgICAgICAgICBsaW1pdDogbGltaXQKICAgICAgICB9KTsKICAgICAgICByZXF1ZXN0LmRvbmUoZnVuY3Rpb24ocmF3U3ViamVjdHMpIHsKICAgICAgICAgIHZhciBuZXdTdWJqZWN0cywgcmF3U3ViamVjdDsKICAgICAgICAgIG5ld1N1YmplY3RzID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2ksIF9sZW4sIF9yZXN1bHRzOwogICAgICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IHJhd1N1YmplY3RzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICAgICAgcmF3U3ViamVjdCA9IHJhd1N1YmplY3RzW19pXTsKICAgICAgICAgICAgICBpZiAoISghdGhpcy5oYXNTZWVuU3ViamVjdChyYXdTdWJqZWN0KSkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLnRyYWNrU2VlblN1YmplY3QocmF3U3ViamVjdCk7CiAgICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChuZXcgdGhpcyhyYXdTdWJqZWN0KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgICAgICAgfSkuY2FsbChfdGhpcyk7CiAgICAgICAgICB3aGlsZSAoIShfdGhpcy5zZWVuVGhpc1Nlc3Npb24ubGVuZ3RoIDwgMTAwMCkpIHsKICAgICAgICAgICAgX3RoaXMuc2VlblRoaXNTZXNzaW9uLnNoaWZ0KCk7CiAgICAgICAgICB9CiAgICAgICAgICBfdGhpcy50cmlnZ2VyKCdmZXRjaCcsIFtuZXdTdWJqZWN0c10pOwogICAgICAgICAgcmV0dXJuIGZldGNoZXIucmVzb2x2ZShuZXdTdWJqZWN0cyk7CiAgICAgICAgfSk7CiAgICAgICAgcmVxdWVzdC5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGdldEZhbGxiYWNrOwogICAgICAgICAgX3RoaXMudHJpZ2dlcignZmV0Y2hpbmctZmFsbGJhY2snKTsKICAgICAgICAgIGdldEZhbGxiYWNrID0gJC5nZXQoX3RoaXMuZmFsbGJhY2spOwogICAgICAgICAgZ2V0RmFsbGJhY2suZG9uZShmdW5jdGlvbihyYXdTdWJqZWN0cykgewogICAgICAgICAgICB2YXIgbmV3U3ViamVjdHMsIHJhd0dyb3VwU3ViamVjdHMsIHJhd1N1YmplY3QsIF9pLCBfbGVuOwogICAgICAgICAgICBpZiAoX3RoaXMuZ3JvdXApIHsKICAgICAgICAgICAgICByYXdHcm91cFN1YmplY3RzID0gW107CiAgICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSByYXdTdWJqZWN0cy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgICAgICAgcmF3U3ViamVjdCA9IHJhd1N1YmplY3RzW19pXTsKICAgICAgICAgICAgICAgIGlmIChyYXdTdWJqZWN0Lmdyb3VwX2lkID09PSBfdGhpcy5ncm91cCkgewogICAgICAgICAgICAgICAgICByYXdHcm91cFN1YmplY3RzLnB1c2gocmF3U3ViamVjdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJhd1N1YmplY3RzID0gcmF3R3JvdXBTdWJqZWN0czsKICAgICAgICAgICAgfQogICAgICAgICAgICByYXdTdWJqZWN0cy5zb3J0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpIC0gMC41OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbmV3U3ViamVjdHMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIF9qLCBfbGVuMSwgX3Jlc3VsdHM7CiAgICAgICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSByYXdTdWJqZWN0cy5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHsKICAgICAgICAgICAgICAgIHJhd1N1YmplY3QgPSByYXdTdWJqZWN0c1tfal07CiAgICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKG5ldyB0aGlzKHJhd1N1YmplY3QpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgICAgICAgICB9KS5jYWxsKF90aGlzKTsKICAgICAgICAgICAgX3RoaXMudHJpZ2dlcignZmV0Y2gnLCBbbmV3U3ViamVjdHNdKTsKICAgICAgICAgICAgcmV0dXJuIGZldGNoZXIucmVzb2x2ZShuZXdTdWJqZWN0cyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBnZXRGYWxsYmFjay5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBfdGhpcy50cmlnZ2VyKCdmZXRjaC1mYWlsJyk7CiAgICAgICAgICAgIHJldHVybiBmZXRjaGVyLmZhaWwuYXBwbHkoZmV0Y2hlciwgYXJndW1lbnRzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGZldGNoZXIucmVzb2x2ZSh0aGlzLmluc3RhbmNlcy5zbGljZSgwLCBudW1iZXIpKTsKICAgICAgfQogICAgICByZXR1cm4gZmV0Y2hlci5wcm9taXNlKCk7CiAgICB9OwoKICAgIFN1YmplY3QucHJvdG90eXBlLmlkID0gJyc7CgogICAgU3ViamVjdC5wcm90b3R5cGUuem9vbml2ZXJzZV9pZCA9ICcnOwoKICAgIFN1YmplY3QucHJvdG90eXBlLmNsYXNzaWZpY2F0aW9uX2NvdW50ID0gbnVsbDsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS5jb29yZHMgPSBudWxsOwoKICAgIFN1YmplY3QucHJvdG90eXBlLmxvY2F0aW9uID0gbnVsbDsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS5tZXRhZGF0YSA9IG51bGw7CgogICAgU3ViamVjdC5wcm90b3R5cGUucHJvamVjdF9pZCA9ICcnOwoKICAgIFN1YmplY3QucHJvdG90eXBlLmdyb3VwX2lkID0gJyc7CgogICAgU3ViamVjdC5wcm90b3R5cGUud29ya2Zsb3dfaWRzID0gbnVsbDsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS50dXRvcmlhbCA9IG51bGw7CgogICAgU3ViamVjdC5wcm90b3R5cGUucHJlbG9hZCA9IHRydWU7CgogICAgZnVuY3Rpb24gU3ViamVjdCgpIHsKICAgICAgU3ViamVjdC5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKHRoaXMubG9jYXRpb24gPT0gbnVsbCkgewogICAgICAgIHRoaXMubG9jYXRpb24gPSB7fTsKICAgICAgfQogICAgICBpZiAodGhpcy5jb29yZHMgPT0gbnVsbCkgewogICAgICAgIHRoaXMuY29vcmRzID0gW107CiAgICAgIH0KICAgICAgaWYgKHRoaXMubWV0YWRhdGEgPT0gbnVsbCkgewogICAgICAgIHRoaXMubWV0YWRhdGEgPSB7fTsKICAgICAgfQogICAgICBpZiAodGhpcy53b3JrZmxvd19pZHMgPT0gbnVsbCkgewogICAgICAgIHRoaXMud29ya2Zsb3dfaWRzID0gW107CiAgICAgIH0KICAgIH0KCiAgICBTdWJqZWN0LnByb3RvdHlwZS5wcmVsb2FkSW1hZ2VzID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpbWFnZVNvdXJjZXMsIHNyYywgdHlwZSwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIGlmICghdGhpcy5wcmVsb2FkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIF9yZWYgPSB0aGlzLmxvY2F0aW9uOwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKHR5cGUgaW4gX3JlZikgewogICAgICAgIGltYWdlU291cmNlcyA9IF9yZWZbdHlwZV07CiAgICAgICAgaWYgKCEoaW1hZ2VTb3VyY2VzIGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgICBpbWFnZVNvdXJjZXMgPSBbaW1hZ2VTb3VyY2VzXTsKICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLmlzSW1hZ2UoaW1hZ2VTb3VyY2VzKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIF9yZXN1bHRzLnB1c2goKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVzdWx0czE7CiAgICAgICAgICBfcmVzdWx0czEgPSBbXTsKICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gaW1hZ2VTb3VyY2VzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICAgIHNyYyA9IGltYWdlU291cmNlc1tfaV07CiAgICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKChuZXcgSW1hZ2UpLnNyYyA9IHNyYyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX3Jlc3VsdHMxOwogICAgICAgIH0pKCkpOwogICAgICB9CiAgICAgIHJldHVybiBfcmVzdWx0czsKICAgIH07CgogICAgU3ViamVjdC5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuY29uc3RydWN0b3IuY3VycmVudCA9IHRoaXM7CiAgICAgIHJldHVybiB0aGlzLnRyaWdnZXIoJ3NlbGVjdCcpOwogICAgfTsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yLmN1cnJlbnQgPT09IHRoaXMpIHsKICAgICAgICB0aGlzLmNvbnN0cnVjdG9yLmN1cnJlbnQgPSBudWxsOwogICAgICB9CiAgICAgIHJldHVybiBTdWJqZWN0Ll9fc3VwZXJfXy5kZXN0cm95LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwoKICAgIFN1YmplY3QucHJvdG90eXBlLmlzSW1hZ2UgPSBmdW5jdGlvbihzdWJqZWN0TG9jYXRpb24pIHsKICAgICAgdmFyIHNyYywgX2ksIF9sZW4sIF9yZWY7CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gc3ViamVjdExvY2F0aW9uLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgc3JjID0gc3ViamVjdExvY2F0aW9uW19pXTsKICAgICAgICBpZiAoISgoX3JlZiA9IHNyYy5zcGxpdCgnLicpLnBvcCgpKSA9PT0gJ2dpZicgfHwgX3JlZiA9PT0gJ2pwZycgfHwgX3JlZiA9PT0gJ3BuZycpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfTsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS50YWxrSHJlZiA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgZG9tYWluOwogICAgICBkb21haW4gPSB0aGlzLmRvbWFpbiB8fCBsb2NhdGlvbi5ob3N0bmFtZS5yZXBsYWNlKC9ed3d3XC4vLCAnJyk7CiAgICAgIHJldHVybiAiaHR0cDovL3RhbGsuIiArIGRvbWFpbiArICIvIy9zdWJqZWN0cy8iICsgdGhpcy56b29uaXZlcnNlX2lkOwogICAgfTsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS5zb2NpYWxJbWFnZSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgaW1hZ2U7CiAgICAgIGltYWdlID0gdGhpcy5sb2NhdGlvbi5zdGFuZGFyZCBpbnN0YW5jZW9mIEFycmF5ID8gdGhpcy5sb2NhdGlvbi5zdGFuZGFyZFtNYXRoLmZsb29yKHRoaXMubG9jYXRpb24uc3RhbmRhcmQubGVuZ3RoIC8gMildIDogdGhpcy5sb2NhdGlvbi5zdGFuZGFyZDsKICAgICAgcmV0dXJuICQoIjxhIGhyZWY9JyIgKyBpbWFnZSArICInPjwvYT4iKS5nZXQoMCkuaHJlZjsKICAgIH07CgogICAgU3ViamVjdC5wcm90b3R5cGUuc29jaWFsVGl0bGUgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICdab29uaXZlcnNlIGNsYXNzaWZpY2F0aW9uJzsKICAgIH07CgogICAgU3ViamVjdC5wcm90b3R5cGUuc29jaWFsTWVzc2FnZSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gJ0NsYXNzaWZ5aW5nIG9uIHRoZSBab29uaXZlcnNlISc7CiAgICB9OwoKICAgIFN1YmplY3QucHJvdG90eXBlLmZhY2Vib29rSHJlZiA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gKCJodHRwczovL3d3dy5mYWNlYm9vay5jb20vc2hhcmVyL3NoYXJlci5waHBcbj9zPTEwMFxuJnBbdXJsXT0iICsgKGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLnRhbGtIcmVmKCkpKSArICJcbiZwW3RpdGxlXT0iICsgKGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLnNvY2lhbFRpdGxlKCkpKSArICJcbiZwW3N1bW1hcnldPSIgKyAoZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuc29jaWFsTWVzc2FnZSgpKSkgKyAiXG4mcFtpbWFnZXNdWzBdPSIgKyAodGhpcy5zb2NpYWxNZXNzYWdlKCkpKS5yZXBsYWNlKCdcbicsICcnLCAnZycpOwogICAgfTsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS50d2l0dGVySHJlZiA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc3RhdHVzOwogICAgICBzdGF0dXMgPSAiIiArICh0aGlzLnNvY2lhbE1lc3NhZ2UoKSkgKyAiICIgKyAodGhpcy50YWxrSHJlZigpKTsKICAgICAgcmV0dXJuICJodHRwOi8vdHdpdHRlci5jb20vaG9tZT9zdGF0dXM9IiArIChlbmNvZGVVUklDb21wb25lbnQoc3RhdHVzKSk7CiAgICB9OwoKICAgIFN1YmplY3QucHJvdG90eXBlLnBpbnRlcmVzdEhyZWYgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICgiaHR0cDovL3BpbnRlcmVzdC5jb20vcGluL2NyZWF0ZS9idXR0b24vXG4/dXJsPSIgKyAoZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMudGFsa0hyZWYoKSkpICsgIlxuJm1lZGlhPSIgKyAoZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuc29jaWFsSW1hZ2UoKSkpICsgIlxuJmRlc2NyaXB0aW9uPSIgKyAoZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuc29jaWFsTWVzc2FnZSgpKSkpLnJlcGxhY2UoJ1xuJywgJycsICdnJyk7CiAgICB9OwoKICAgIHJldHVybiBTdWJqZWN0OwoKICB9KShCYXNlTW9kZWwpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuU3ViamVjdCA9IFN1YmplY3Q7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gU3ViamVjdDsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBBcGksIEJhc2VNb2RlbCwgUmVjZW50LCBTdWJqZWN0LCBTdWJqZWN0Rm9yUmVjZW50LCBVc2VyLCBfYmFzZSwgX3JlZiwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5tb2RlbHMgPT0gbnVsbCkgewogICAgX2Jhc2UubW9kZWxzID0ge307CiAgfQoKICBCYXNlTW9kZWwgPSB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuQmFzZU1vZGVsIHx8IHJlcXVpcmUoJy4vYmFzZS1tb2RlbCcpOwoKICBBcGkgPSB3aW5kb3cuem9vbml2ZXJzZS5BcGkgfHwgcmVxdWlyZSgnLi4vbGliL2FwaScpOwoKICBVc2VyID0gd2luZG93Lnpvb25pdmVyc2UubW9kZWxzLlVzZXIgfHwgcmVxdWlyZSgnLi91c2VyJyk7CgogIFN1YmplY3QgPSB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuU3ViamVjdCB8fCByZXF1aXJlKCcuL3N1YmplY3QnKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIFN1YmplY3RGb3JSZWNlbnQgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoU3ViamVjdEZvclJlY2VudCwgX3N1cGVyKTsKCiAgICBmdW5jdGlvbiBTdWJqZWN0Rm9yUmVjZW50KCkgewogICAgICBfcmVmID0gU3ViamVjdEZvclJlY2VudC5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIF9yZWY7CiAgICB9CgogICAgcmV0dXJuIFN1YmplY3RGb3JSZWNlbnQ7CgogIH0pKFN1YmplY3QpOwoKICBSZWNlbnQgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoUmVjZW50LCBfc3VwZXIpOwoKICAgIFJlY2VudC50eXBlID0gJ3JlY2VudCc7CgogICAgUmVjZW50LnBhdGggPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9yZWYxOwogICAgICByZXR1cm4gIi9wcm9qZWN0cy8iICsgQXBpLmN1cnJlbnQucHJvamVjdCArICIvdXNlcnMvIiArICgoX3JlZjEgPSBVc2VyLmN1cnJlbnQpICE9IG51bGwgPyBfcmVmMS5pZCA6IHZvaWQgMCkgKyAiLyIgKyB0aGlzLnR5cGUgKyAicyI7CiAgICB9OwoKICAgIFJlY2VudC5mZXRjaCA9IGZ1bmN0aW9uKHBhcmFtcywgZG9uZSwgZmFpbCkgewogICAgICB2YXIgZmV0Y2hlciwgcmVxdWVzdCwgX3JlZjEsCiAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICB0aGlzLnRyaWdnZXIoJ2ZldGNoaW5nJyk7CiAgICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgX3JlZjEgPSBbcGFyYW1zLCBkb25lLCB7fV0sIGRvbmUgPSBfcmVmMVswXSwgZmFpbCA9IF9yZWYxWzFdLCBwYXJhbXMgPSBfcmVmMVsyXTsKICAgICAgfQogICAgICBwYXJhbXMgPSAkLmV4dGVuZCh7CiAgICAgICAgcGFnZTogMSwKICAgICAgICBwZXJfcGFnZTogMTAKICAgICAgfSwgcGFyYW1zKTsKICAgICAgZmV0Y2hlciA9IG5ldyAkLkRlZmVycmVkOwogICAgICBmZXRjaGVyLnRoZW4oZG9uZSwgZmFpbCk7CiAgICAgIHJlcXVlc3QgPSBBcGkuY3VycmVudC5nZXQodGhpcy5wYXRoKCksIHBhcmFtcyk7CiAgICAgIHJlcXVlc3QuZG9uZShmdW5jdGlvbihyYXdSZWNlbnRzKSB7CiAgICAgICAgdmFyIG5ld1JlY2VudHMsIHJhd1JlY2VudDsKICAgICAgICBuZXdSZWNlbnRzID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVmMiwgX3Jlc3VsdHM7CiAgICAgICAgICBfcmVmMiA9IHJhd1JlY2VudHMucmV2ZXJzZSgpOwogICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZjIubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICAgICAgcmF3UmVjZW50ID0gX3JlZjJbX2ldOwogICAgICAgICAgICBfcmVzdWx0cy5wdXNoKG5ldyB0aGlzKHJhd1JlY2VudCkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgICAgIH0pLmNhbGwoX3RoaXMpOwogICAgICAgIF90aGlzLnRyaWdnZXIoJ2ZldGNoJywgW25ld1JlY2VudHNdKTsKICAgICAgICByZXR1cm4gZmV0Y2hlci5yZXNvbHZlKG5ld1JlY2VudHMpOwogICAgICB9KTsKICAgICAgcmVxdWVzdC5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgIF90aGlzLnRyaWdnZXIoJ2ZldGNoLWZhaWwnKTsKICAgICAgICByZXR1cm4gZmV0Y2hlci5yZWplY3QuYXBwbHkoZmV0Y2hlciwgYXJndW1lbnRzKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBmZXRjaGVyLnByb21pc2UoKTsKICAgIH07CgogICAgUmVjZW50LmNsZWFyT25Vc2VyQ2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmOwogICAgICBzZWxmID0gdGhpczsKICAgICAgcmV0dXJuIFVzZXIub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfcmVzdWx0czsKICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgIHdoaWxlIChzZWxmLmNvdW50KCkgIT09IDApIHsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goc2VsZi5maXJzdCgpLmRlc3Ryb3koKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfSk7CiAgICB9OwoKICAgIFJlY2VudC5jbGVhck9uVXNlckNoYW5nZSgpOwoKICAgIFJlY2VudC5wcm90b3R5cGUuc3ViamVjdHMgPSBudWxsOwoKICAgIFJlY2VudC5wcm90b3R5cGUucHJvamVjdF9pZCA9ICcnOwoKICAgIFJlY2VudC5wcm90b3R5cGUud29ya2Zsb3dfaWQgPSAnJzsKCiAgICBSZWNlbnQucHJvdG90eXBlLmNyZWF0ZWRfYXQgPSAnJzsKCiAgICBmdW5jdGlvbiBSZWNlbnQoKSB7CiAgICAgIHZhciBpLCBzdWJqZWN0LCBfaSwgX2xlbiwgX3JlZjEsIF9yZWYyLCBfcmVmMywgX3JlZjQ7CiAgICAgIFJlY2VudC5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKHRoaXMuc3ViamVjdHMgPT0gbnVsbCkgewogICAgICAgIHRoaXMuc3ViamVjdHMgPSBbXTsKICAgICAgfQogICAgICB0aGlzLnByb2plY3RfaWQgfHwgKHRoaXMucHJvamVjdF9pZCA9IChfcmVmMSA9IHRoaXMuc3ViamVjdHNbMF0pICE9IG51bGwgPyBfcmVmMS5wcm9qZWN0X2lkIDogdm9pZCAwKTsKICAgICAgdGhpcy53b3JrZmxvd19pZCB8fCAodGhpcy53b3JrZmxvd19pZCA9IChfcmVmMiA9IHRoaXMuc3ViamVjdHNbMF0pICE9IG51bGwgPyAoX3JlZjMgPSBfcmVmMi53b3JrZmxvd19pZHMpICE9IG51bGwgPyBfcmVmM1swXSA6IHZvaWQgMCA6IHZvaWQgMCk7CiAgICAgIHRoaXMuY3JlYXRlZF9hdCB8fCAodGhpcy5jcmVhdGVkX2F0ID0gKG5ldyBEYXRlKS50b1VUQ1N0cmluZygpKTsKICAgICAgX3JlZjQgPSB0aGlzLnN1YmplY3RzOwogICAgICBmb3IgKGkgPSBfaSA9IDAsIF9sZW4gPSBfcmVmNC5sZW5ndGg7IF9pIDwgX2xlbjsgaSA9ICsrX2kpIHsKICAgICAgICBzdWJqZWN0ID0gX3JlZjRbaV07CiAgICAgICAgdGhpcy5zdWJqZWN0c1tpXSA9IG5ldyBTdWJqZWN0Rm9yUmVjZW50KHN1YmplY3QpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIFJlY2VudDsKCiAgfSkoQmFzZU1vZGVsKTsKCiAgd2luZG93Lnpvb25pdmVyc2UubW9kZWxzLlJlY2VudCA9IFJlY2VudDsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBSZWNlbnQ7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgQXBpLCBGYXZvcml0ZSwgUmVjZW50LCBVc2VyLCBfYmFzZSwgX3JlZiwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkubW9kZWxzID09IG51bGwpIHsKICAgIF9iYXNlLm1vZGVscyA9IHt9OwogIH0KCiAgUmVjZW50ID0gd2luZG93Lnpvb25pdmVyc2UubW9kZWxzLlJlY2VudCB8fCByZXF1aXJlKCcuL3JlY2VudCcpOwoKICBBcGkgPSB3aW5kb3cuem9vbml2ZXJzZS5BcGkgfHwgcmVxdWlyZSgnLi4vbGliL2FwaScpOwoKICBVc2VyID0gd2luZG93Lnpvb25pdmVyc2UubW9kZWxzLlVzZXIgfHwgcmVxdWlyZSgnLi91c2VyJyk7CgogICQgPSB3aW5kb3cualF1ZXJ5OwoKICBGYXZvcml0ZSA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhGYXZvcml0ZSwgX3N1cGVyKTsKCiAgICBmdW5jdGlvbiBGYXZvcml0ZSgpIHsKICAgICAgdGhpcy50b0pTT04gPSBfX2JpbmQodGhpcy50b0pTT04sIHRoaXMpOwogICAgICBfcmVmID0gRmF2b3JpdGUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfcmVmOwogICAgfQoKICAgIEZhdm9yaXRlLnR5cGUgPSAnZmF2b3JpdGUnOwoKICAgIEZhdm9yaXRlLmNsZWFyT25Vc2VyQ2hhbmdlKCk7CgogICAgRmF2b3JpdGUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc3ViamVjdDsKICAgICAgcmV0dXJuIHsKICAgICAgICBmYXZvcml0ZTogewogICAgICAgICAgc3ViamVjdF9pZHM6IChmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVmMSwgX3Jlc3VsdHM7CiAgICAgICAgICAgIF9yZWYxID0gdGhpcy5zdWJqZWN0czsKICAgICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgICAgIHN1YmplY3QgPSBfcmVmMVtfaV07CiAgICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChzdWJqZWN0LmlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICAgICAgICB9KS5jYWxsKHRoaXMpCiAgICAgICAgfQogICAgICB9OwogICAgfTsKCiAgICBGYXZvcml0ZS5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB0aGlzLnRyaWdnZXIoJ3NlbmRpbmcnKTsKICAgICAgcmV0dXJuIEFwaS5jdXJyZW50LnBvc3QoIi9wcm9qZWN0cy8iICsgQXBpLmN1cnJlbnQucHJvamVjdCArICIvZmF2b3JpdGVzIiwgdGhpcy50b0pTT04oKSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICBfdGhpcy5pZCA9IHJlc3BvbnNlLmlkOwogICAgICAgIHJldHVybiBfdGhpcy50cmlnZ2VyKCdzZW5kJyk7CiAgICAgIH0pOwogICAgfTsKCiAgICBGYXZvcml0ZS5wcm90b3R5cGVbImRlbGV0ZSJdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMudHJpZ2dlcignZGVsZXRpbmcnKTsKICAgICAgcmV0dXJuIEFwaS5jdXJyZW50WyJkZWxldGUiXSgiL3Byb2plY3RzLyIgKyBBcGkuY3VycmVudC5wcm9qZWN0ICsgIi9mYXZvcml0ZXMvIiArIHRoaXMuaWQsIGZ1bmN0aW9uKCkgewogICAgICAgIF90aGlzLnRyaWdnZXIoJ2RlbGV0ZScpOwogICAgICAgIHJldHVybiBfdGhpcy5kZXN0cm95KCk7CiAgICAgIH0pOwogICAgfTsKCiAgICByZXR1cm4gRmF2b3JpdGU7CgogIH0pKFJlY2VudCk7CgogIHdpbmRvdy56b29uaXZlcnNlLm1vZGVscy5GYXZvcml0ZSA9IEZhdm9yaXRlOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEZhdm9yaXRlOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyICQsIEFwaSwgQmFzZU1vZGVsLCBDbGFzc2lmaWNhdGlvbiwgRmF2b3JpdGUsIExhbmd1YWdlTWFuYWdlciwgUkVTT0xWRURfU1RBVEUsIFJlY2VudCwgX2Jhc2UsIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjMsIF9yZWY0LCBfcmVmNSwgX3JlZjYsIF9yZWY3LAogICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksCiAgICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSwKICAgIF9faW5kZXhPZiA9IFtdLmluZGV4T2YgfHwgZnVuY3Rpb24oaXRlbSkgeyBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7IGlmIChpIGluIHRoaXMgJiYgdGhpc1tpXSA9PT0gaXRlbSkgcmV0dXJuIGk7IH0gcmV0dXJuIC0xOyB9LAogICAgX19zbGljZSA9IFtdLnNsaWNlOwoKICBCYXNlTW9kZWwgPSAoKF9yZWYgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMSA9IF9yZWYubW9kZWxzKSAhPSBudWxsID8gX3JlZjEuQmFzZU1vZGVsIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL2Jhc2UtbW9kZWwnKTsKCiAgQXBpID0gKChfcmVmMiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZjIuQXBpIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9saWIvYXBpJyk7CgogIFJlY2VudCA9ICgoX3JlZjMgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmNCA9IF9yZWYzLm1vZGVscykgIT0gbnVsbCA/IF9yZWY0LlJlY2VudCA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vbW9kZWxzL3JlY2VudCcpOwoKICBGYXZvcml0ZSA9ICgoX3JlZjUgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmNiA9IF9yZWY1Lm1vZGVscykgIT0gbnVsbCA/IF9yZWY2LkZhdm9yaXRlIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9tb2RlbHMvZmF2b3JpdGUnKTsKCiAgTGFuZ3VhZ2VNYW5hZ2VyID0gKChfcmVmNyA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZjcuTGFuZ3VhZ2VNYW5hZ2VyIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9saWIvbGFuZ3VhZ2UtbWFuYWdlcicpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgUkVTT0xWRURfU1RBVEUgPSAobmV3ICQuRGVmZXJyZWQpLnJlc29sdmUoKS5zdGF0ZSgpOwoKICBDbGFzc2lmaWNhdGlvbiA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhDbGFzc2lmaWNhdGlvbiwgX3N1cGVyKTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wZW5kaW5nID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGVuZGluZy1jbGFzc2lmaWNhdGlvbnMnKSkgfHwgW107CgogICAgQ2xhc3NpZmljYXRpb24uc2VudFRoaXNTZXNzaW9uID0gMDsKCiAgICBDbGFzc2lmaWNhdGlvbi5zZW5kUGVuZGluZyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2xhc3NpZmljYXRpb24sIHBlbmRpbmdQb3N0cywgX2ksIF9sZW4sIF9yZWY4LCBfcmVzdWx0cywKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIGlmICh0aGlzLnBlbmRpbmcubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMudHJpZ2dlcignc2VuZGluZy1wZW5kaW5nJywgW2NsYXNzaWZpY2F0aW9uXSk7CiAgICAgIHBlbmRpbmdQb3N0cyA9IFtdOwogICAgICBfcmVmOCA9IHRoaXMucGVuZGluZzsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmOC5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIGNsYXNzaWZpY2F0aW9uID0gX3JlZjhbX2ldOwogICAgICAgIF9yZXN1bHRzLnB1c2goKGZ1bmN0aW9uKGNsYXNzaWZpY2F0aW9uKSB7CiAgICAgICAgICB2YXIgbGF0ZVBvc3Q7CiAgICAgICAgICBsYXRlUG9zdCA9IEFwaS5jdXJyZW50LnBvc3QoY2xhc3NpZmljYXRpb24udXJsLCBjbGFzc2lmaWNhdGlvbik7CiAgICAgICAgICBwZW5kaW5nUG9zdHMucHVzaChsYXRlUG9zdCk7CiAgICAgICAgICBsYXRlUG9zdC5kb25lKGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHZhciBmYXZvcml0ZSwgaWQ7CiAgICAgICAgICAgIF90aGlzLnRyaWdnZXIoJ3NlbmQtcGVuZGluZycsIFtjbGFzc2lmaWNhdGlvbl0pOwogICAgICAgICAgICBpZiAoY2xhc3NpZmljYXRpb24uZmF2b3JpdGUpIHsKICAgICAgICAgICAgICBmYXZvcml0ZSA9IG5ldyBGYXZvcml0ZSh7CiAgICAgICAgICAgICAgICBzdWJqZWN0czogKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB2YXIgX2osIF9sZW4xLCBfcmVmOSwgX3Jlc3VsdHMxOwogICAgICAgICAgICAgICAgICBfcmVmOSA9IGNsYXNzaWZpY2F0aW9uLnN1YmplY3RfaWRzOwogICAgICAgICAgICAgICAgICBfcmVzdWx0czEgPSBbXTsKICAgICAgICAgICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gX3JlZjkubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWQgPSBfcmVmOVtfal07CiAgICAgICAgICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzMTsKICAgICAgICAgICAgICAgIH0pKCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gZmF2b3JpdGUuc2VuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGxhdGVQb3N0LmZhaWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy50cmlnZ2VyKCdzZW5kLXBlbmRpbmctZmFpbCcsIFtjbGFzc2lmaWNhdGlvbl0pOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gJC53aGVuLmFwcGx5KCQsIHBlbmRpbmdQb3N0cykuYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgaSwgX2osIF9yZWY5OwogICAgICAgICAgICBmb3IgKGkgPSBfaiA9IF9yZWY5ID0gcGVuZGluZ1Bvc3RzLmxlbmd0aCAtIDE7IF9yZWY5IDw9IDAgPyBfaiA8PSAwIDogX2ogPj0gMDsgaSA9IF9yZWY5IDw9IDAgPyArK19qIDogLS1faikgewogICAgICAgICAgICAgIGlmIChwZW5kaW5nUG9zdHNbaV0uc3RhdGUoKSA9PT0gUkVTT0xWRURfU1RBVEUpIHsKICAgICAgICAgICAgICAgIF90aGlzLnBlbmRpbmcuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BlbmRpbmctY2xhc3NpZmljYXRpb25zJywgSlNPTi5zdHJpbmdpZnkoX3RoaXMucGVuZGluZykpOwogICAgICAgICAgfSk7CiAgICAgICAgfSkoY2xhc3NpZmljYXRpb24pKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5zdWJqZWN0cyA9IFtdOwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5zdWJqZWN0ID0gbnVsbDsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUuYW5ub3RhdGlvbnMgPSBudWxsOwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5mYXZvcml0ZSA9IGZhbHNlOwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5nZW5lcmljID0gbnVsbDsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUuc3RhcnRlZF9hdCA9IG51bGw7CgogICAgQ2xhc3NpZmljYXRpb24ucHJvdG90eXBlLmZpbmlzaGVkX2F0ID0gbnVsbDsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUudXNlcl9hZ2VudCA9IG51bGw7CgogICAgZnVuY3Rpb24gQ2xhc3NpZmljYXRpb24oKSB7CiAgICAgIENsYXNzaWZpY2F0aW9uLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBpZiAodGhpcy5hbm5vdGF0aW9ucyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5hbm5vdGF0aW9ucyA9IFtdOwogICAgICB9CiAgICAgIHRoaXMuZ2VuZXJpYyA9IHt9OwogICAgICB0aGlzLnN0YXJ0ZWRfYXQgPSAobmV3IERhdGUpLnRvVVRDU3RyaW5nKCk7CiAgICAgIHRoaXMudXNlcl9hZ2VudCA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50OwogICAgfQoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5ub3JtYWxpemVTdWJqZWN0cyA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy5zdWJqZWN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3ViamVjdCB8fCAodGhpcy5zdWJqZWN0ID0gdGhpcy5zdWJqZWN0c1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3ViamVjdHMgPSBbdGhpcy5zdWJqZWN0XTsKICAgICAgfQogICAgfTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUuYW5ub3RhdGUgPSBmdW5jdGlvbihhbm5vdGF0aW9uKSB7CiAgICAgIHRoaXMuYW5ub3RhdGlvbnMucHVzaChhbm5vdGF0aW9uKTsKICAgICAgcmV0dXJuIGFubm90YXRpb247CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5yZW1vdmVBbm5vdGF0aW9uID0gZnVuY3Rpb24oYW5ub3RhdGlvbikgewogICAgICB2YXIgYSwgaSwgX2ksIF9sZW4sIF9yZWY4OwogICAgICBfcmVmOCA9IHRoaXMuYW5ub3RhdGlvbnM7CiAgICAgIGZvciAoaSA9IF9pID0gMCwgX2xlbiA9IF9yZWY4Lmxlbmd0aDsgX2kgPCBfbGVuOyBpID0gKytfaSkgewogICAgICAgIGEgPSBfcmVmOFtpXTsKICAgICAgICBpZiAoYSA9PT0gYW5ub3RhdGlvbikgewogICAgICAgICAgcmV0dXJuIHRoaXMuYW5ub3RhdGlvbnMuc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUuaXNUdXRvcmlhbCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc3ViamVjdDsKICAgICAgdGhpcy5ub3JtYWxpemVTdWJqZWN0cygpOwogICAgICByZXR1cm4gX19pbmRleE9mLmNhbGwoKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZjgsIF9yZWY5LCBfcmVzdWx0czsKICAgICAgICBfcmVmOCA9IHRoaXMuc3ViamVjdHM7CiAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWY4Lmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICBzdWJqZWN0ID0gX3JlZjhbX2ldOwogICAgICAgICAgX3Jlc3VsdHMucHVzaCgoX3JlZjkgPSBzdWJqZWN0Lm1ldGFkYXRhKSAhPSBudWxsID8gX3JlZjkudHV0b3JpYWwgOiB2b2lkIDApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICAgIH0pLmNhbGwodGhpcyksIHRydWUpID49IDA7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgIHRoaXMuZ2VuZXJpY1trZXldID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIFtrZXksIHZhbHVlXSk7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJpY1trZXldOwogICAgfTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhbm5vdGF0aW9uLCBrZXksIG91dHB1dCwgc3ViamVjdCwgc3ViamVjdF9pZHMsIHZhbHVlLCBfcmVmODsKICAgICAgaWYgKExhbmd1YWdlTWFuYWdlci5jdXJyZW50ICE9IG51bGwpIHsKICAgICAgICB0aGlzLnNldCgnbGFuZycsIExhbmd1YWdlTWFuYWdlci5jdXJyZW50LmNvZGUpOwogICAgICB9CiAgICAgIHRoaXMubm9ybWFsaXplU3ViamVjdHMoKTsKICAgICAgc3ViamVjdF9pZHMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVmOCwgX3Jlc3VsdHM7CiAgICAgICAgX3JlZjggPSB0aGlzLnN1YmplY3RzOwogICAgICAgIF9yZXN1bHRzID0gW107CiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmOC5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgc3ViamVjdCA9IF9yZWY4W19pXTsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goc3ViamVjdC5pZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfSkuY2FsbCh0aGlzKTsKICAgICAgb3V0cHV0ID0gewogICAgICAgIGNsYXNzaWZpY2F0aW9uOiB7CiAgICAgICAgICBzdWJqZWN0X2lkczogc3ViamVjdF9pZHMsCiAgICAgICAgICBhbm5vdGF0aW9uczogdGhpcy5hbm5vdGF0aW9ucy5jb25jYXQoWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc3RhcnRlZF9hdDogdGhpcy5zdGFydGVkX2F0LAogICAgICAgICAgICAgIGZpbmlzaGVkX2F0OiB0aGlzLmZpbmlzaGVkX2F0CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICB1c2VyX2FnZW50OiB0aGlzLnVzZXJfYWdlbnQKICAgICAgICAgICAgfQogICAgICAgICAgXSkKICAgICAgICB9CiAgICAgIH07CiAgICAgIF9yZWY4ID0gdGhpcy5nZW5lcmljOwogICAgICBmb3IgKGtleSBpbiBfcmVmOCkgewogICAgICAgIHZhbHVlID0gX3JlZjhba2V5XTsKICAgICAgICBhbm5vdGF0aW9uID0ge307CiAgICAgICAgYW5ub3RhdGlvbltrZXldID0gdmFsdWU7CiAgICAgICAgb3V0cHV0LmNsYXNzaWZpY2F0aW9uLmFubm90YXRpb25zLnB1c2goYW5ub3RhdGlvbik7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZmF2b3JpdGUpIHsKICAgICAgICBvdXRwdXQuY2xhc3NpZmljYXRpb24uZmF2b3JpdGUgPSB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBvdXRwdXQ7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS51cmwgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5ub3JtYWxpemVTdWJqZWN0cygpOwogICAgICByZXR1cm4gIi9wcm9qZWN0cy8iICsgQXBpLmN1cnJlbnQucHJvamVjdCArICIvd29ya2Zsb3dzLyIgKyB0aGlzLnN1YmplY3RzWzBdLndvcmtmbG93X2lkc1swXSArICIvY2xhc3NpZmljYXRpb25zIjsKICAgIH07CgogICAgQ2xhc3NpZmljYXRpb24ucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbihkb25lLCBmYWlsKSB7CiAgICAgIHZhciBwb3N0LCBfcmVmOCwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIGlmICghdGhpcy5pc1R1dG9yaWFsKCkpIHsKICAgICAgICB0aGlzLmNvbnN0cnVjdG9yLnNlbnRUaGlzU2Vzc2lvbiArPSAxOwogICAgICB9CiAgICAgIHRoaXMuZmluaXNoZWRfYXQgPSAobmV3IERhdGUpLnRvVVRDU3RyaW5nKCk7CiAgICAgIHBvc3QgPSAoX3JlZjggPSBBcGkuY3VycmVudCkucG9zdC5hcHBseShfcmVmOCwgW3RoaXMudXJsKCksIHRoaXMudG9KU09OKCldLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICBwb3N0LmRvbmUoZnVuY3Rpb24oKSB7CiAgICAgICAgX3RoaXMubWFrZVJlY2VudCgpOwogICAgICAgIHJldHVybiBfdGhpcy5jb25zdHJ1Y3Rvci5zZW5kUGVuZGluZygpOwogICAgICB9KTsKICAgICAgcG9zdC5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5tYWtlUGVuZGluZygpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcignc2VuZCcpOwogICAgfTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUubWFrZVBlbmRpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFzSlNPTjsKICAgICAgYXNKU09OID0gdGhpcy50b0pTT04oKTsKICAgICAgYXNKU09OLnVybCA9IHRoaXMudXJsKCk7CiAgICAgIHRoaXMuY29uc3RydWN0b3IucGVuZGluZy5wdXNoKGFzSlNPTik7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwZW5kaW5nLWNsYXNzaWZpY2F0aW9ucycsIEpTT04uc3RyaW5naWZ5KHRoaXMuY29uc3RydWN0b3IucGVuZGluZykpOwogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCdwZW5kaW5nJyk7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5tYWtlUmVjZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBmYXZvcml0ZSwgcmVjZW50LCBzdWJqZWN0LCBfaSwgX2xlbiwgX3JlZjgsIF9yZXN1bHRzOwogICAgICB0aGlzLm5vcm1hbGl6ZVN1YmplY3RzKCk7CiAgICAgIF9yZWY4ID0gdGhpcy5zdWJqZWN0czsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmOC5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIHN1YmplY3QgPSBfcmVmOFtfaV07CiAgICAgICAgcmVjZW50ID0gbmV3IFJlY2VudCh7CiAgICAgICAgICBzdWJqZWN0czogW3N1YmplY3RdCiAgICAgICAgfSk7CiAgICAgICAgcmVjZW50LnRyaWdnZXIoJ2Zyb20tY2xhc3NpZmljYXRpb24nKTsKICAgICAgICBpZiAodGhpcy5mYXZvcml0ZSkgewogICAgICAgICAgZmF2b3JpdGUgPSBuZXcgRmF2b3JpdGUoewogICAgICAgICAgICBzdWJqZWN0czogW3N1YmplY3RdCiAgICAgICAgICB9KTsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goZmF2b3JpdGUudHJpZ2dlcignZnJvbS1jbGFzc2lmaWNhdGlvbicpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3Jlc3VsdHMucHVzaCh2b2lkIDApOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIHJldHVybiBDbGFzc2lmaWNhdGlvbjsKCiAgfSkoQmFzZU1vZGVsKTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLm1vZGVscyA9PSBudWxsKSB7CiAgICBfYmFzZS5tb2RlbHMgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLm1vZGVscy5DbGFzc2lmaWNhdGlvbiA9IENsYXNzaWZpY2F0aW9uOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IENsYXNzaWZpY2F0aW9uOwogIH0KCn0pLmNhbGwodGhpcyk7Cgp3aW5kb3cuem9vbml2ZXJzZSA9IHdpbmRvdy56b29uaXZlcnNlIHx8IHt9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3cyA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzIHx8IHt9Owp0ZW1wbGF0ZSA9IGZ1bmN0aW9uKF9fb2JqKSB7CiAgaWYgKCFfX29iaikgX19vYmogPSB7fTsKICB2YXIgX19vdXQgPSBbXSwgX19jYXB0dXJlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBvdXQgPSBfX291dCwgcmVzdWx0OwogICAgX19vdXQgPSBbXTsKICAgIGNhbGxiYWNrLmNhbGwodGhpcyk7CiAgICByZXN1bHQgPSBfX291dC5qb2luKCcnKTsKICAgIF9fb3V0ID0gb3V0OwogICAgcmV0dXJuIF9fc2FmZShyZXN1bHQpOwogIH0sIF9fc2FuaXRpemUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpIHsKICAgICAgcmV0dXJuIF9fZXNjYXBlKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9LCBfX3NhZmUsIF9fb2JqU2FmZSA9IF9fb2JqLnNhZmUsIF9fZXNjYXBlID0gX19vYmouZXNjYXBlOwogIF9fc2FmZSA9IF9fb2JqLnNhZmUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSkgdmFsdWUgPSAnJzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmcodmFsdWUpOwogICAgICByZXN1bHQuZWNvU2FmZSA9IHRydWU7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKICBpZiAoIV9fZXNjYXBlKSB7CiAgICBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAoJycgKyB2YWx1ZSkKICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgfTsKICB9CiAgKGZ1bmN0aW9uKCkgewogICAgKGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2xhc3NOYW1lOwogICAgCiAgICAgIGNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8ICd6b29uaXZlcnNlLWxvZ28nOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuXG48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGNsYXNzPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoY2xhc3NOYW1lKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSI+XG4gIDxnIGNsYXNzPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoY2xhc3NOYW1lKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnIiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0cm9rZT0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNTAsIDUwKSI+XG4gICAgPHBhdGggZD0iTSAwIC00NSBBIDQ1IDQ1IDAgMCAxIDAgNDUgQSA0NSA0NSAwIDAgMSAwIC00NSBaIE0gMCAtMzAgQSAzMCAzMCAwIDAgMCAwIDMwIEEgMzAgMzAgMCAwIDAgMCAtMzAgWiIgLz5cbiAgICA8cGF0aCBkPSJNIDAgLTEyLjUgQSAxMi41IDEyLjUgMCAwIDEgMCAxMi41IEEgMTIuNSAxMi41IDAgMCAxIDAgLTEyLjUgWiIgLz5cbiAgICA8cGF0aCBkPSJNIDAgLTc1IEwgNSAwIEwgMCA3NSBMIC01IDAgWiIgdHJhbnNmb3JtPSJyb3RhdGUoNTApIiAvPlxuICA8L2c+XG48L3N2Zz5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1snem9vbml2ZXJzZUxvZ29TdmcnXSA9IHRlbXBsYXRlOwppZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIG1vZHVsZS5leHBvcnRzID0gdGVtcGxhdGU7Cgp3aW5kb3cuem9vbml2ZXJzZSA9IHdpbmRvdy56b29uaXZlcnNlIHx8IHt9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3cyA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzIHx8IHt9Owp0ZW1wbGF0ZSA9IGZ1bmN0aW9uKF9fb2JqKSB7CiAgaWYgKCFfX29iaikgX19vYmogPSB7fTsKICB2YXIgX19vdXQgPSBbXSwgX19jYXB0dXJlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBvdXQgPSBfX291dCwgcmVzdWx0OwogICAgX19vdXQgPSBbXTsKICAgIGNhbGxiYWNrLmNhbGwodGhpcyk7CiAgICByZXN1bHQgPSBfX291dC5qb2luKCcnKTsKICAgIF9fb3V0ID0gb3V0OwogICAgcmV0dXJuIF9fc2FmZShyZXN1bHQpOwogIH0sIF9fc2FuaXRpemUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpIHsKICAgICAgcmV0dXJuIF9fZXNjYXBlKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9LCBfX3NhZmUsIF9fb2JqU2FmZSA9IF9fb2JqLnNhZmUsIF9fZXNjYXBlID0gX19vYmouZXNjYXBlOwogIF9fc2FmZSA9IF9fb2JqLnNhZmUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSkgdmFsdWUgPSAnJzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmcodmFsdWUpOwogICAgICByZXN1bHQuZWNvU2FmZSA9IHRydWU7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKICBpZiAoIV9fZXNjYXBlKSB7CiAgICBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAoJycgKyB2YWx1ZSkKICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgfTsKICB9CiAgKGZ1bmN0aW9uKCkgewogICAgKGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2xhc3NOYW1lOwogICAgCiAgICAgIGNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8ICd6b29uaXZlcnNlLWdyb3VwLWljb24nOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuXG48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZpZXdCb3g9IjAgMCAyMDAgMTAwIiBjbGFzcz0iJyk7CiAgICAKICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKGNsYXNzTmFtZSkpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJyIgd2lkdGg9IjJlbSIgaGVpZ2h0PSIxZW0iPlxuICAnKTsKICAgIAogICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3pvb25pdmVyc2UtZ3JvdXBzLWljb24tcGVyc29uJykgPT0gbnVsbCkgewogICAgICAgIF9fb3V0LnB1c2goJ1xuICAgIDxkZWZzPlxuICAgICAgPHBhdGggaWQ9Inpvb25pdmVyc2UtZ3JvdXBzLWljb24tcGVyc29uIiBkPSJNIDAgLTUwIEEgMjUgMzUgMCAwIDEgMjAgMTAgQSA2NyA2NyAwIDAgMSA1MCA0NSBMIDAgNTAgTCAtNTAgNDUgQSA2NyA2NyAwIDAgMSAtMjAgMTAgQSAyNSAzNSAwIDAgMSAwIC01MCBaIiAvPlxuICAgIDwvZGVmcz5cbiAgJyk7CiAgICAgIH0KICAgIAogICAgICBfX291dC5wdXNoKCdcblxuICA8ZyBjbGFzcz0iJyk7CiAgICAKICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKGNsYXNzTmFtZSkpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJyIgZmlsbD0iY3VycmVudENvbG9yIiBzdHJva2U9InRyYW5zcGFyZW50IiBzdHJva2Utd2lkdGg9IjAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwMCwgNTApIj5cbiAgICA8dXNlIHhsaW5rOmhyZWY9IiN6b29uaXZlcnNlLWdyb3Vwcy1pY29uLXBlcnNvbiIgdHJhbnNmb3JtPSJzY2FsZSgwLjY3KSB0cmFuc2xhdGUoLTgwLCAwKSIgb3BhY2l0eT0iMC43NSIgLz5cbiAgICA8dXNlIHhsaW5rOmhyZWY9IiN6b29uaXZlcnNlLWdyb3Vwcy1pY29uLXBlcnNvbiIgdHJhbnNmb3JtPSJzY2FsZSgwLjY3KSB0cmFuc2xhdGUoODAsIDApIiBvcGFjaXR5PSIwLjc1IiAvPlxuICAgIDx1c2UgeGxpbms6aHJlZj0iI3pvb25pdmVyc2UtZ3JvdXBzLWljb24tcGVyc29uIiAvPlxuICA8L2c+XG48L3N2Zz5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1snZ3JvdXBJY29uU3ZnJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIGNsYXNzTmFtZTsKICAgIAogICAgICBjbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZSB8fCAnem9vbml2ZXJzZS1tYWlsLWljb24nOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuXG48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDE1MCAxMDAiIGNsYXNzPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoY2xhc3NOYW1lKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnIiB3aWR0aD0iMS41ZW0iIGhlaWdodD0iMWVtIj5cbiAgPGcgY2xhc3M9IicpOwogICAgCiAgICAgIF9fb3V0LnB1c2goX19zYW5pdGl6ZShjbGFzc05hbWUpKTsKICAgIAogICAgICBfX291dC5wdXNoKCciIGZpbGw9ImN1cnJlbnRDb2xvciIgc3Ryb2tlPSJ0cmFuc3BhcmVudCIgc3Ryb2tlLXdpZHRoPSIwIj5cbiAgICA8cGF0aCBkPSJNIDAgMCBMIDc1IDY1IEwgMTUwIDAgWiIgLz5cbiAgICA8cGF0aCBkPSJNIDAgMCBMIDc1IDc1IEwgMTUwIDAgTCAxNTAgMTAwIEwgMCAxMDAgWiIgb3BhY2l0eT0iMC44NSIgLz5cbiAgPC9nPlxuPC9zdmc+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ21haWxJY29uU3ZnJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgX19vdXQucHVzaCgnPGRpdiBjbGFzcz0idW5kZXJsYXkiPlxuICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPlxuICAgIDxkaXYgY2xhc3M9ImRpYWxvZyI+PC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ2RpYWxvZyddID0gdGVtcGxhdGU7CmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgbW9kdWxlLmV4cG9ydHMgPSB0ZW1wbGF0ZTsKCndpbmRvdy56b29uaXZlcnNlID0gd2luZG93Lnpvb25pdmVyc2UgfHwge307CndpbmRvdy56b29uaXZlcnNlLnZpZXdzID0gd2luZG93Lnpvb25pdmVyc2Uudmlld3MgfHwge307CnRlbXBsYXRlID0gZnVuY3Rpb24oX19vYmopIHsKICBpZiAoIV9fb2JqKSBfX29iaiA9IHt9OwogIHZhciBfX291dCA9IFtdLCBfX2NhcHR1cmUgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgdmFyIG91dCA9IF9fb3V0LCByZXN1bHQ7CiAgICBfX291dCA9IFtdOwogICAgY2FsbGJhY2suY2FsbCh0aGlzKTsKICAgIHJlc3VsdCA9IF9fb3V0LmpvaW4oJycpOwogICAgX19vdXQgPSBvdXQ7CiAgICByZXR1cm4gX19zYWZlKHJlc3VsdCk7CiAgfSwgX19zYW5pdGl6ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkgewogICAgICByZXR1cm4gX19lc2NhcGUodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICcnOwogICAgfQogIH0sIF9fc2FmZSwgX19vYmpTYWZlID0gX19vYmouc2FmZSwgX19lc2NhcGUgPSBfX29iai5lc2NhcGU7CiAgX19zYWZlID0gX19vYmouc2FmZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBpZiAoISh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpKSB2YWx1ZSA9ICcnOwogICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZyh2YWx1ZSk7CiAgICAgIHJlc3VsdC5lY29TYWZlID0gdHJ1ZTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9OwogIGlmICghX19lc2NhcGUpIHsKICAgIF9fZXNjYXBlID0gX19vYmouZXNjYXBlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuICgnJyArIHZhbHVlKQogICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpCiAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JykKICAgICAgICAucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICB9OwogIH0KICAoZnVuY3Rpb24oKSB7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBncm91cEljb25TdmcsIG1haWxJY29uU3ZnLCB0cmFuc2xhdGUsIHpvb25pdmVyc2VMb2dvU3ZnLCBfcmVmLCBfcmVmMSwgX3JlZjIsIF9yZWYzLCBfcmVmNCwgX3JlZjUsIF9yZWY2OwogICAgCiAgICAgIHRyYW5zbGF0ZSA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZi50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbicpOwogICAgCiAgICAgIHpvb25pdmVyc2VMb2dvU3ZnID0gKChfcmVmMSA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYyID0gX3JlZjEudmlld3MpICE9IG51bGwgPyBfcmVmMi56b29uaXZlcnNlTG9nb1N2ZyA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi96b29uaXZlcnNlLWxvZ28tc3ZnJyk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG4nKTsKICAgIAogICAgICBncm91cEljb25TdmcgPSAoKF9yZWYzID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjQgPSBfcmVmMy52aWV3cykgIT0gbnVsbCA/IF9yZWY0Lmdyb3VwSWNvblN2ZyA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi9ncm91cC1pY29uLXN2ZycpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuJyk7CiAgICAKICAgICAgbWFpbEljb25TdmcgPSAoKF9yZWY1ID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjYgPSBfcmVmNS52aWV3cykgIT0gbnVsbCA/IF9yZWY2Lm1haWxJY29uU3ZnIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL21haWwtaWNvbi1zdmcnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcblxuPGRpdiBjbGFzcz0iY29ybmVyIj5cbiAgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIj5cbiAgICA8cGF0aCBkPSJNIDAgMCBMIDEwMCAwIEwgMTAwIDEwMCBaIiAvPlxuICA8L3N2Zz5cbjwvZGl2PlxuXG48ZGl2IGNsYXNzPSJuby11c2VyIj5cbiAgPGRpdiBjbGFzcz0iem9vbml2ZXJzZS1pbmZvIHBpZWNlIj5cbiAgICAnKTsKICAgIAogICAgICBfX291dC5wdXNoKHpvb25pdmVyc2VMb2dvU3ZnKCkpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuICAgICcpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCd0b3BCYXJIZWFkaW5nJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuICA8L2Rpdj5cblxuICA8ZGl2IGNsYXNzPSJzaWduLWluIHBpZWNlIj5cbiAgICA8YnV0dG9uIG5hbWU9InNpZ24tdXAiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduVXAnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+XG4gICAgPHNwYW4gY2xhc3M9InNlcGFyYXRvciI+fDwvc3Bhbj5cbiAgICA8YnV0dG9uIG5hbWU9InNpZ24taW4iPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduSW4nKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+XG4gIDwvZGl2PlxuPC9kaXY+XG5cbjxkaXYgY2xhc3M9ImN1cnJlbnQtdXNlciI+XG4gIDxkaXYgY2xhc3M9InVzZXItaW5mbyBwaWVjZSI+XG4gICAgPGRpdiBjbGFzcz0iY3VycmVudC11c2VyLW5hbWUiPiZtZGFzaDs8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9InNpZ24tb3V0Ij5cbiAgICAgIDxidXR0b24gbmFtZT0ic2lnbi1vdXQiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduT3V0JykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cblxuICA8ZGl2IGNsYXNzPSJncm91cHMgcGllY2UiPlxuICAgIDxkaXYgY2xhc3M9Imdyb3Vwcy1tZW51LXRvZ2dsZSI+XG4gICAgICA8YnV0dG9uIG5hbWU9Imdyb3VwcyI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaChncm91cEljb25TdmcoKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuXG4gIDxkaXYgY2xhc3M9Im1lc3NhZ2VzIHBpZWNlIj5cbiAgICA8YSBocmVmPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKHRoaXMudGFsa1Byb2ZpbGVIcmVmKTsKICAgIAogICAgICBfX291dC5wdXNoKCciIGNsYXNzPSJtZXNzYWdlLWxpbmsiPlxuICAgICAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaChtYWlsSWNvblN2ZygpKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbiAgICAgIDxzcGFuIGNsYXNzPSJtZXNzYWdlLWNvdW50Ij4mbWRhc2g7PC9zcGFuPlxuICAgIDwvYT5cbiAgPC9kaXY+XG5cbiAgPGRpdiBjbGFzcz0iYXZhdGFyIHBpZWNlIj5cbiAgICA8YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy9wcm9qZWN0cy9jdXJyZW50Ij48aW1nIHNyYz0iIiAvPjwvYT5cbiAgPC9kaXY+XG48L2Rpdj5cblxuPGRpdiBjbGFzcz0ibGFuZ3VhZ2VzIHBpZWNlIj5cbiAgPGJ1dHRvbiBuYW1lPSJsYW5ndWFnZXMtbWVudS10b2dnbGUiPjwvYnV0dG9uPiAgXG48L2Rpdj5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1sndG9wQmFyJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRyYW5zbGF0ZSwgX3JlZjsKICAgIAogICAgICB0cmFuc2xhdGUgPSAoKF9yZWYgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IF9yZWYudHJhbnNsYXRlIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9saWIvdHJhbnNsYXRlJyk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG48aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0idXNlcm5hbWUiIHJlcXVpcmVkPSJyZXF1aXJlZCIgZGF0YS16b29uaXZlcnNlLXRyYW5zbGF0ZT0iIiBkYXRhLXpvb25pdmVyc2UtdHJhbnNsYXRlLXBsYWNlaG9sZGVyPSJ1c2VybmFtZSIgLz5cbjxpbnB1dCB0eXBlPSJwYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiIHJlcXVpcmVkPSJyZXF1aXJlZCIgZGF0YS16b29uaXZlcnNlLXRyYW5zbGF0ZT0iIiBkYXRhLXpvb25pdmVyc2UtdHJhbnNsYXRlLXBsYWNlaG9sZGVyPSJwYXNzd29yZCIgLz5cbjxidXR0b24gdHlwZT0ic3VibWl0Ij4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnc2lnbkluJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuPGJ1dHRvbiBuYW1lPSJzaWduLW91dCI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3NpZ25PdXQnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+XG48ZGl2IGNsYXNzPSJlcnJvci1tZXNzYWdlIj48L2Rpdj5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1snbG9naW5Gb3JtJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRyYW5zbGF0ZSwgem9vbml2ZXJzZUxvZ29TdmcsIF9yZWY7CiAgICAKICAgICAgdHJhbnNsYXRlID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gem9vbml2ZXJzZS50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbicpOwogICAgCiAgICAgIHpvb25pdmVyc2VMb2dvU3ZnID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gKF9yZWYgPSB6b29uaXZlcnNlLnZpZXdzKSAhPSBudWxsID8gX3JlZi56b29uaXZlcnNlTG9nb1N2ZyA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi96b29uaXZlcnNlLWxvZ28tc3ZnJyk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG5cbjxkaXYgY2xhc3M9ImxvYWRlciI+PC9kaXY+XG5cbjxidXR0b24gdHlwZT0iYnV0dG9uIiBuYW1lPSJjbG9zZS1kaWFsb2ciPiZ0aW1lczs8L2J1dHRvbj5cblxuPGhlYWRlcj5cbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh6b29uaXZlcnNlTG9nb1N2ZygpKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3NpZ25JbkhlYWRpbmcnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG48L2hlYWRlcj5cblxuPGxhYmVsPlxuICA8c3BhbiBjbGFzcz0idGV4dC1sYWJlbCI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3VzZXJuYW1lJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvc3Bhbj48YnIgLz5cbiAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InVzZXJuYW1lIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48bGFiZWw+XG4gIDxzcGFuIGNsYXNzPSJ0ZXh0LWxhYmVsIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgncGFzc3dvcmQnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9zcGFuPjxiciAvPlxuICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIG5hbWU9InBhc3N3b3JkIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48ZGl2IGNsYXNzPSJlcnJvci1tZXNzYWdlIj48L2Rpdj5cblxuPGRpdiBjbGFzcz0iYWN0aW9uIj5cbiAgPGEgaHJlZj0iaHR0cHM6Ly93d3cuem9vbml2ZXJzZS5vcmcvcGFzc3dvcmQvcmVzZXQiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdmb3Jnb3RQYXNzd29yZCcpKTsKICAgIAogICAgICBfX291dC5wdXNoKCc8L2E+XG4gIDxidXR0b24gdHlwZT0ic3VibWl0Ij4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnc2lnbkluJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuPC9kaXY+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ2xvZ2luRGlhbG9nJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRyYW5zbGF0ZSwgem9vbml2ZXJzZUxvZ29TdmcsIF9yZWY7CiAgICAKICAgICAgdHJhbnNsYXRlID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gem9vbml2ZXJzZS50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbicpOwogICAgCiAgICAgIHpvb25pdmVyc2VMb2dvU3ZnID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gKF9yZWYgPSB6b29uaXZlcnNlLnZpZXdzKSAhPSBudWxsID8gX3JlZi56b29uaXZlcnNlTG9nb1N2ZyA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi96b29uaXZlcnNlLWxvZ28tc3ZnJyk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG5cbjxkaXYgY2xhc3M9ImxvYWRlciI+PC9kaXY+XG5cbjxidXR0b24gdHlwZT0iYnV0dG9uIiBuYW1lPSJjbG9zZS1kaWFsb2ciPiZ0aW1lczs8L2J1dHRvbj5cblxuPGhlYWRlcj5cbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh6b29uaXZlcnNlTG9nb1N2ZygpKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3NpZ25VcEhlYWRpbmcnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG48L2hlYWRlcj5cblxuPGxhYmVsPlxuICA8c3BhbiBjbGFzcz0idGV4dC1sYWJlbCI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3VzZXJuYW1lJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvc3Bhbj48YnIgLz5cbiAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InVzZXJuYW1lIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48bGFiZWw+XG4gIDxzcGFuIGNsYXNzPSJ0ZXh0LWxhYmVsIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgncGFzc3dvcmQnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9zcGFuPjxiciAvPlxuICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIG5hbWU9InBhc3N3b3JkIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48bGFiZWw+XG4gIDxzcGFuIGNsYXNzPSJ0ZXh0LWxhYmVsIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnZW1haWwnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9zcGFuPjxiciAvPlxuICA8aW5wdXQgdHlwZT0iZW1haWwiIG5hbWU9ImVtYWlsIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48bGFiZWw+XG4gIDxzcGFuIGNsYXNzPSJ0ZXh0LWxhYmVsIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgncmVhbE5hbWUnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9zcGFuPjxiciAvPlxuICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0icmVhbC1uYW1lIiAvPlxuICA8ZGl2IGNsYXNzPSJleHBsYW5hdGlvbiI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3doeVJlYWxOYW1lJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvZGl2PlxuPC9sYWJlbD5cblxuPGxhYmVsIGNsYXNzPSJjaGVja2JveCI+XG4gIDxzcGFuPjwvc3Bhbj5cbiAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiByZXF1aXJlZD0icmVxdWlyZWQiIC8+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ2FncmVlVG9Qcml2YWN5UG9saWN5JykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuPC9sYWJlbD5cblxuPGxhYmVsIGNsYXNzPSJjaGVja2JveCI+XG4gIDxzcGFuPjwvc3Bhbj5cbiAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJiZXRhLXByZWZlcmVuY2UiIC8+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ2JldGFQcmVmZXJlbmNlJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuPC9sYWJlbD5cblxuPGRpdiBjbGFzcz0iZXJyb3ItbWVzc2FnZSI+PC9kaXY+XG5cbjxkaXYgY2xhc3M9ImFjdGlvbiI+XG4gIDxidXR0b24gdHlwZT0ic3VibWl0Ij4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnc2lnblVwJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuPC9kaXY+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ3NpZ251cERpYWxvZyddID0gdGVtcGxhdGU7CmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgbW9kdWxlLmV4cG9ydHMgPSB0ZW1wbGF0ZTsKCndpbmRvdy56b29uaXZlcnNlID0gd2luZG93Lnpvb25pdmVyc2UgfHwge307CndpbmRvdy56b29uaXZlcnNlLnZpZXdzID0gd2luZG93Lnpvb25pdmVyc2Uudmlld3MgfHwge307CnRlbXBsYXRlID0gZnVuY3Rpb24oX19vYmopIHsKICBpZiAoIV9fb2JqKSBfX29iaiA9IHt9OwogIHZhciBfX291dCA9IFtdLCBfX2NhcHR1cmUgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgdmFyIG91dCA9IF9fb3V0LCByZXN1bHQ7CiAgICBfX291dCA9IFtdOwogICAgY2FsbGJhY2suY2FsbCh0aGlzKTsKICAgIHJlc3VsdCA9IF9fb3V0LmpvaW4oJycpOwogICAgX19vdXQgPSBvdXQ7CiAgICByZXR1cm4gX19zYWZlKHJlc3VsdCk7CiAgfSwgX19zYW5pdGl6ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkgewogICAgICByZXR1cm4gX19lc2NhcGUodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICcnOwogICAgfQogIH0sIF9fc2FmZSwgX19vYmpTYWZlID0gX19vYmouc2FmZSwgX19lc2NhcGUgPSBfX29iai5lc2NhcGU7CiAgX19zYWZlID0gX19vYmouc2FmZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBpZiAoISh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpKSB2YWx1ZSA9ICcnOwogICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZyh2YWx1ZSk7CiAgICAgIHJlc3VsdC5lY29TYWZlID0gdHJ1ZTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9OwogIGlmICghX19lc2NhcGUpIHsKICAgIF9fZXNjYXBlID0gX19vYmouZXNjYXBlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuICgnJyArIHZhbHVlKQogICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpCiAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JykKICAgICAgICAucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICB9OwogIH0KICAoZnVuY3Rpb24oKSB7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgIF9fb3V0LnB1c2goJzxkaXYgY2xhc3M9ImxvYWRlciI+PC9kaXY+XG5cbjxkaXYgY2xhc3M9Iml0ZW1zIj48L2Rpdj5cblxuPG5hdiBjbGFzcz0iY29udHJvbHMiPlxuICA8c3BhbiBjbGFzcz0ibnVtYmVyZWQiPjwvc3Bhbj5cbjwvbmF2PlxuJyk7CiAgICAKICAgIH0pLmNhbGwodGhpcyk7CiAgICAKICB9KS5jYWxsKF9fb2JqKTsKICBfX29iai5zYWZlID0gX19vYmpTYWZlLCBfX29iai5lc2NhcGUgPSBfX2VzY2FwZTsKICByZXR1cm4gX19vdXQuam9pbignJyk7Cn07CndpbmRvdy56b29uaXZlcnNlLnZpZXdzWydwYWdpbmF0b3InXSA9IHRlbXBsYXRlOwppZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIG1vZHVsZS5leHBvcnRzID0gdGVtcGxhdGU7Cgp3aW5kb3cuem9vbml2ZXJzZSA9IHdpbmRvdy56b29uaXZlcnNlIHx8IHt9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3cyA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzIHx8IHt9Owp0ZW1wbGF0ZSA9IGZ1bmN0aW9uKF9fb2JqKSB7CiAgaWYgKCFfX29iaikgX19vYmogPSB7fTsKICB2YXIgX19vdXQgPSBbXSwgX19jYXB0dXJlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBvdXQgPSBfX291dCwgcmVzdWx0OwogICAgX19vdXQgPSBbXTsKICAgIGNhbGxiYWNrLmNhbGwodGhpcyk7CiAgICByZXN1bHQgPSBfX291dC5qb2luKCcnKTsKICAgIF9fb3V0ID0gb3V0OwogICAgcmV0dXJuIF9fc2FmZShyZXN1bHQpOwogIH0sIF9fc2FuaXRpemUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpIHsKICAgICAgcmV0dXJuIF9fZXNjYXBlKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9LCBfX3NhZmUsIF9fb2JqU2FmZSA9IF9fb2JqLnNhZmUsIF9fZXNjYXBlID0gX19vYmouZXNjYXBlOwogIF9fc2FmZSA9IF9fb2JqLnNhZmUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSkgdmFsdWUgPSAnJzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmcodmFsdWUpOwogICAgICByZXN1bHQuZWNvU2FmZSA9IHRydWU7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKICBpZiAoIV9fZXNjYXBlKSB7CiAgICBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAoJycgKyB2YWx1ZSkKICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgfTsKICB9CiAgKGZ1bmN0aW9uKCkgewogICAgKGZ1bmN0aW9uKCkgewogICAgICB2YXIgdHJhbnNsYXRlLCBfcmVmOwogICAgCiAgICAgIHRyYW5zbGF0ZSA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZi50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcblxuPGZvcm0gY2xhc3M9InNpZ24taW4tZm9ybSI+XG4gIDxkaXYgY2xhc3M9ImxvYWRlciI+PC9kaXY+XG5cbiAgPGhlYWRlcj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnc2lnbkluRm9yUHJvZmlsZScpKTsKICAgIAogICAgICBfX291dC5wdXNoKCc8L2hlYWRlcj5cbiAgPGxhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJ1c2VybmFtZSIgcmVxdWlyZWQ9InJlcXVpcmVkIiBkYXRhLXpvb25pdmVyc2UtdHJhbnNsYXRlPSIiIGRhdGEtem9vbml2ZXJzZS10cmFuc2xhdGUtcGxhY2Vob2xkZXI9InVzZXJuYW1lIiAvPjwvbGFiZWw+XG4gIDxsYWJlbD48aW5wdXQgdHlwZT0icGFzc3dvcmQiIG5hbWU9InBhc3N3b3JkIiByZXF1aXJlZD0icmVxdWlyZWQiIGRhdGEtem9vbml2ZXJzZS10cmFuc2xhdGU9IiIgZGF0YS16b29uaXZlcnNlLXRyYW5zbGF0ZS1wbGFjZWhvbGRlcj0icGFzc3dvcmQiIC8+PC9sYWJlbD5cbiAgPGRpdiBjbGFzcz0iZXJyb3ItbWVzc2FnZSI+PC9kaXY+XG4gIDxkaXYgY2xhc3M9ImFjdGlvbiI+PGJ1dHRvbiB0eXBlPSJzdWJtaXQiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduSW4nKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+PC9kaXY+XG4gIDxwIGNsYXNzPSJuby1hY2NvdW50Ij4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnbm9BY2NvdW50JykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJyA8YnV0dG9uIG5hbWU9InNpZ24tdXAiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduVXAnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+PC9wPlxuPC9mb3JtPlxuXG48bmF2PlxuICA8YnV0dG9uIG5hbWU9InR1cm4tcGFnZSIgdmFsdWU9InJlY2VudHMiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdyZWNlbnRzJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuICA8YnV0dG9uIG5hbWU9InR1cm4tcGFnZSIgdmFsdWU9ImZhdm9yaXRlcyI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ2Zhdm9yaXRlcycpKTsKICAgIAogICAgICBfX291dC5wdXNoKCc8L2J1dHRvbj5cbjwvbmF2PlxuXG48ZGl2IGNsYXNzPSJyZWNlbnRzIHBhZ2UiPjwvZGl2PlxuPGRpdiBjbGFzcz0icmVjZW50cy1lbXB0eSBlbXB0eS1tZXNzYWdlIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgncmVjZW50cycpKTsKICAgIAogICAgICBfX291dC5wdXNoKCcgKCcpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdub25lJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJyk8L2Rpdj5cblxuPGRpdiBjbGFzcz0iZmF2b3JpdGVzIHBhZ2UiPjwvZGl2PlxuPGRpdiBjbGFzcz0iZmF2b3JpdGVzLWVtcHR5IGVtcHR5LW1lc3NhZ2UiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdmYXZvcml0ZXMnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnICgnKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnbm9uZScpKTsKICAgIAogICAgICBfX291dC5wdXNoKCcpPC9kaXY+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ3Byb2ZpbGUnXSA9IHRlbXBsYXRlOwppZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIG1vZHVsZS5leHBvcnRzID0gdGVtcGxhdGU7Cgp3aW5kb3cuem9vbml2ZXJzZSA9IHdpbmRvdy56b29uaXZlcnNlIHx8IHt9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3cyA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzIHx8IHt9Owp0ZW1wbGF0ZSA9IGZ1bmN0aW9uKF9fb2JqKSB7CiAgaWYgKCFfX29iaikgX19vYmogPSB7fTsKICB2YXIgX19vdXQgPSBbXSwgX19jYXB0dXJlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBvdXQgPSBfX291dCwgcmVzdWx0OwogICAgX19vdXQgPSBbXTsKICAgIGNhbGxiYWNrLmNhbGwodGhpcyk7CiAgICByZXN1bHQgPSBfX291dC5qb2luKCcnKTsKICAgIF9fb3V0ID0gb3V0OwogICAgcmV0dXJuIF9fc2FmZShyZXN1bHQpOwogIH0sIF9fc2FuaXRpemUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpIHsKICAgICAgcmV0dXJuIF9fZXNjYXBlKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9LCBfX3NhZmUsIF9fb2JqU2FmZSA9IF9fb2JqLnNhZmUsIF9fZXNjYXBlID0gX19vYmouZXNjYXBlOwogIF9fc2FmZSA9IF9fb2JqLnNhZmUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSkgdmFsdWUgPSAnJzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmcodmFsdWUpOwogICAgICByZXN1bHQuZWNvU2FmZSA9IHRydWU7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKICBpZiAoIV9fZXNjYXBlKSB7CiAgICBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAoJycgKyB2YWx1ZSkKICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgfTsKICB9CiAgKGZ1bmN0aW9uKCkgewogICAgKGZ1bmN0aW9uKCkgewogICAgICB2YXIgRmF2b3JpdGUsIGxvY2F0aW9uLCB0aHVtYlNyYywgX3JlZiwgX3JlZjEsIF9yZWYyLCBfcmVmMzsKICAgIAogICAgICBGYXZvcml0ZSA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYxID0gX3JlZi5tb2RlbHMpICE9IG51bGwgPyBfcmVmMS5GYXZvcml0ZSA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnem9vbml2ZXJzZS9tb2RlbHMvZmF2b3JpdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcblxuPGRpdiBjbGFzcz1cJ2l0ZW1cJz5cbiAgPGEgaHJlZj0iJyk7CiAgICAKICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKCgoX3JlZjIgPSB0aGlzLnN1YmplY3RzWzBdKSAhPSBudWxsID8gX3JlZjIudGFsa0hyZWYoKSA6IHZvaWQgMCkgfHwgJyMvU1VCSkVDVF9FUlJPUicpKTsKICAgIAogICAgICBfX291dC5wdXNoKCciPlxuICAgICcpOwogICAgCiAgICAgIGxvY2F0aW9uID0gKF9yZWYzID0gdGhpcy5zdWJqZWN0c1swXSkgIT0gbnVsbCA/IF9yZWYzLmxvY2F0aW9uIDogdm9pZCAwOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuICAgICcpOwogICAgCiAgICAgIHRodW1iU3JjID0gbnVsbDsKICAgIAogICAgICBfX291dC5wdXNoKCdcbiAgICAnKTsKICAgIAogICAgICBpZiAodGh1bWJTcmMgPT0gbnVsbCkgewogICAgICAgIHRodW1iU3JjID0gbG9jYXRpb24gIT0gbnVsbCA/IGxvY2F0aW9uLnRodW1iIDogdm9pZCAwOwogICAgICB9CiAgICAKICAgICAgX19vdXQucHVzaCgnXG4gICAgJyk7CiAgICAKICAgICAgaWYgKChsb2NhdGlvbiAhPSBudWxsID8gbG9jYXRpb24uc3RhbmRhcmQgOiB2b2lkIDApIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICBpZiAodGh1bWJTcmMgPT0gbnVsbCkgewogICAgICAgICAgdGh1bWJTcmMgPSBsb2NhdGlvbiAhPSBudWxsID8gbG9jYXRpb24uc3RhbmRhcmRbMF0gOiB2b2lkIDA7CiAgICAgICAgfQogICAgICB9CiAgICAKICAgICAgX19vdXQucHVzaCgnXG4gICAgJyk7CiAgICAKICAgICAgaWYgKHRodW1iU3JjID09IG51bGwpIHsKICAgICAgICB0aHVtYlNyYyA9IGxvY2F0aW9uICE9IG51bGwgPyBsb2NhdGlvbi5zdGFuZGFyZCA6IHZvaWQgMDsKICAgICAgfQogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuICAgIDxpbWcgc3JjPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUodGh1bWJTcmMgfHwgJycpKTsKICAgIAogICAgICBfX291dC5wdXNoKCciIC8+XG4gIDwvYT5cbjwvZGl2PlxuJyk7CiAgICAKICAgIH0pLmNhbGwodGhpcyk7CiAgICAKICB9KS5jYWxsKF9fb2JqKTsKICBfX29iai5zYWZlID0gX19vYmpTYWZlLCBfX29iai5lc2NhcGUgPSBfX2VzY2FwZTsKICByZXR1cm4gX19vdXQuam9pbignJyk7Cn07CndpbmRvdy56b29uaXZlcnNlLnZpZXdzWydwcm9maWxlSXRlbSddID0gdGVtcGxhdGU7CmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgbW9kdWxlLmV4cG9ydHMgPSB0ZW1wbGF0ZTsKCndpbmRvdy56b29uaXZlcnNlID0gd2luZG93Lnpvb25pdmVyc2UgfHwge307CndpbmRvdy56b29uaXZlcnNlLnZpZXdzID0gd2luZG93Lnpvb25pdmVyc2Uudmlld3MgfHwge307CnRlbXBsYXRlID0gZnVuY3Rpb24oX19vYmopIHsKICBpZiAoIV9fb2JqKSBfX29iaiA9IHt9OwogIHZhciBfX291dCA9IFtdLCBfX2NhcHR1cmUgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgdmFyIG91dCA9IF9fb3V0LCByZXN1bHQ7CiAgICBfX291dCA9IFtdOwogICAgY2FsbGJhY2suY2FsbCh0aGlzKTsKICAgIHJlc3VsdCA9IF9fb3V0LmpvaW4oJycpOwogICAgX19vdXQgPSBvdXQ7CiAgICByZXR1cm4gX19zYWZlKHJlc3VsdCk7CiAgfSwgX19zYW5pdGl6ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkgewogICAgICByZXR1cm4gX19lc2NhcGUodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICcnOwogICAgfQogIH0sIF9fc2FmZSwgX19vYmpTYWZlID0gX19vYmouc2FmZSwgX19lc2NhcGUgPSBfX29iai5lc2NhcGU7CiAgX19zYWZlID0gX19vYmouc2FmZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBpZiAoISh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpKSB2YWx1ZSA9ICcnOwogICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZyh2YWx1ZSk7CiAgICAgIHJlc3VsdC5lY29TYWZlID0gdHJ1ZTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9OwogIGlmICghX19lc2NhcGUpIHsKICAgIF9fZXNjYXBlID0gX19vYmouZXNjYXBlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuICgnJyArIHZhbHVlKQogICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpCiAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JykKICAgICAgICAucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICB9OwogIH0KICAoZnVuY3Rpb24oKSB7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjYXRlZ29yeSwgcHJvamVjdCwgcHJvamVjdHMsIHRyYW5zbGF0ZSwgem9vbml2ZXJzZUxvZ29TdmcsIF9pLCBfaiwgX2xlbiwgX2xlbjEsIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjM7CiAgICAKICAgICAgdHJhbnNsYXRlID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gem9vbml2ZXJzZS50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbicpOwogICAgCiAgICAgIHpvb25pdmVyc2VMb2dvU3ZnID0gKChfcmVmID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjEgPSBfcmVmLnZpZXdzKSAhPSBudWxsID8gX3JlZjEuem9vbml2ZXJzZUxvZ29TdmcgOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4vem9vbml2ZXJzZS1sb2dvLXN2ZycpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuXG48YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy8iIGNsYXNzPSJ6b29uaXZlcnNlLWxvZ28tY29udGFpbmVyIj5cbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh6b29uaXZlcnNlTG9nb1N2ZygpKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbjwvYT5cblxuPGRpdiBjbGFzcz0iem9vbml2ZXJzZS1mb290ZXItY29udGVudCI+XG4gIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLWhlYWRpbmciPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdmb290ZXJIZWFkaW5nJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvZGl2PlxuXG4gICcpOwogICAgCiAgICAgIGlmICh0aGlzLmNhdGVnb3JpZXMgIT0gbnVsbCkgewogICAgICAgIF9fb3V0LnB1c2goJ1xuICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLXByb2plY3RzIj5cbiAgICAgICcpOwogICAgICAgIF9yZWYyID0gdGhpcy5jYXRlZ29yaWVzOwogICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZjIubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICAgIF9yZWYzID0gX3JlZjJbX2ldLCBjYXRlZ29yeSA9IF9yZWYzLmNhdGVnb3J5LCBwcm9qZWN0cyA9IF9yZWYzLnByb2plY3RzOwogICAgICAgICAgX19vdXQucHVzaCgnXG4gICAgICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLWNhdGVnb3J5Ij5cbiAgICAgICAgICA8ZGl2IGNsYXNzPSJ6b29uaXZlcnNlLWZvb3Rlci1jYXRlZ29yeS10aXRsZSI+Jyk7CiAgICAgICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoY2F0ZWdvcnkpKTsKICAgICAgICAgIF9fb3V0LnB1c2goJzwvZGl2PlxuICAgICAgICAgICcpOwogICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gcHJvamVjdHMubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7CiAgICAgICAgICAgIHByb2plY3QgPSBwcm9qZWN0c1tfal07CiAgICAgICAgICAgIF9fb3V0LnB1c2goJ1xuICAgICAgICAgICAgPGRpdiBjbGFzcz0iem9vbml2ZXJzZS1mb290ZXItcHJvamVjdCI+XG4gICAgICAgICAgICAgIDxhIGhyZWY9IicpOwogICAgICAgICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUocHJvamVjdC51cmwpKTsKICAgICAgICAgICAgX19vdXQucHVzaCgnIj4nKTsKICAgICAgICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKHByb2plY3QubmFtZSkpOwogICAgICAgICAgICBfX291dC5wdXNoKCc8L2E+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAnKTsKICAgICAgICAgIH0KICAgICAgICAgIF9fb3V0LnB1c2goJ1xuICAgICAgICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLXByb2plY3QiPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICcpOwogICAgICAgIH0KICAgICAgICBfX291dC5wdXNoKCdcbiAgICA8L2Rpdj5cbiAgJyk7CiAgICAgIH0KICAgIAogICAgICBfX291dC5wdXNoKCdcblxuICA8ZGl2IGNsYXNzPSJ6b29uaXZlcnNlLWZvb3Rlci1nZW5lcmFsIj5cbiAgICA8IS0tZGl2IGNsYXNzPSJ6b29uaXZlcnNlLWZvb3Rlci1jYXRlZ29yeSI+PGEgaHJlZj0iIyI+Wm9vbml2ZXJzZSBEYWlseTwvYT48L2Rpdi0tPlxuICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLWNhdGVnb3J5Ij5cbiAgICAgIDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVyc2Uub3JnL3ByaXZhY3kiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdwcml2YWN5UG9saWN5JykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYT5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLWNhdGVnb3J5Ij5cbiAgICAgIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS96b29uaXZlcnNlIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnZm9ya09uR2l0SHViJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYT5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1snZm9vdGVyJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIGlkLCBuYW1lLCBfaSwgX2xlbiwgX3JlZiwgX3JlZjE7CiAgICAKICAgICAgX19vdXQucHVzaCgnPGRpdiBjbGFzcz0idXNlci1ncm91cHMiPlxuICAnKTsKICAgIAogICAgICBfcmVmID0gdGhpcy51c2VyX2dyb3VwcyB8fCBbXTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgX3JlZjEgPSBfcmVmW19pXSwgaWQgPSBfcmVmMS5pZCwgbmFtZSA9IF9yZWYxLm5hbWU7CiAgICAgICAgX19vdXQucHVzaCgnXG4gICAgPGRpdiBjbGFzcz0idXNlci1ncm91cCI+XG4gICAgICA8YnV0dG9uIG5hbWU9InVzZXItZ3JvdXAiIHZhbHVlPSInKTsKICAgICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoaWQpKTsKICAgICAgICBfX291dC5wdXNoKCciICcpOwogICAgICAgIGlmIChpZCA9PT0gdGhpcy51c2VyX2dyb3VwX2lkKSB7CiAgICAgICAgICBfX291dC5wdXNoKCdjbGFzcz0iYWN0aXZlIicpOwogICAgICAgIH0KICAgICAgICBfX291dC5wdXNoKCc+Jyk7CiAgICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKG5hbWUpKTsKICAgICAgICBfX291dC5wdXNoKCc8L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgJyk7CiAgICAgIH0KICAgIAogICAgICBfX291dC5wdXNoKCdcbjwvZGl2PlxuJyk7CiAgICAKICAgIH0pLmNhbGwodGhpcyk7CiAgICAKICB9KS5jYWxsKF9fb2JqKTsKICBfX29iai5zYWZlID0gX19vYmpTYWZlLCBfX29iai5lc2NhcGUgPSBfX2VzY2FwZTsKICByZXR1cm4gX19vdXQuam9pbignJyk7Cn07CndpbmRvdy56b29uaXZlcnNlLnZpZXdzWydncm91cHNNZW51J10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIExhbmd1YWdlTWFuYWdlciwgY29kZSwgbGFiZWwsIF9yZWYsIF9yZWYxLCBfcmVmMjsKICAgIAogICAgICBMYW5ndWFnZU1hbmFnZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5MYW5ndWFnZU1hbmFnZXIgfHwgcmVxdWlyZSgnLi4vbGliL2xhbmd1YWdlLW1hbmFnZXInKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcblxuPGRpdiBjbGFzcz0ibGFuZ3VhZ2VzIj5cbiAgJyk7CiAgICAKICAgICAgX3JlZjEgPSAoX3JlZiA9IExhbmd1YWdlTWFuYWdlci5jdXJyZW50KSAhPSBudWxsID8gX3JlZi50cmFuc2xhdGlvbnMgOiB2b2lkIDA7CiAgICAgIGZvciAoY29kZSBpbiBfcmVmMSkgewogICAgICAgIGxhYmVsID0gX3JlZjFbY29kZV0ubGFiZWw7CiAgICAgICAgX19vdXQucHVzaCgnXG4gICAgPGRpdiBjbGFzcz0ibGFuZ3VhZ2UiPlxuICAgICAgPGJ1dHRvbiBuYW1lPSJsYW5ndWFnZSIgdmFsdWU9IicpOwogICAgICAgIF9fb3V0LnB1c2goX19zYW5pdGl6ZShjb2RlKSk7CiAgICAgICAgX19vdXQucHVzaCgnIiAnKTsKICAgICAgICBpZiAoY29kZSA9PT0gKChfcmVmMiA9IExhbmd1YWdlTWFuYWdlci5jdXJyZW50KSAhPSBudWxsID8gX3JlZjIuY29kZSA6IHZvaWQgMCkpIHsKICAgICAgICAgIF9fb3V0LnB1c2goJ2NsYXNzPSJhY3RpdmUiJyk7CiAgICAgICAgfQogICAgICAgIF9fb3V0LnB1c2goJz4nKTsKICAgICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUobGFiZWwpKTsKICAgICAgICBfX291dC5wdXNoKCc8L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgJyk7CiAgICAgIH0KICAgIAogICAgICBfX291dC5wdXNoKCdcbjwvZGl2PlxuJyk7CiAgICAKICAgIH0pLmNhbGwodGhpcyk7CiAgICAKICB9KS5jYWxsKF9fb2JqKTsKICBfX29iai5zYWZlID0gX19vYmpTYWZlLCBfX29iai5lc2NhcGUgPSBfX2VzY2FwZTsKICByZXR1cm4gX19vdXQuam9pbignJyk7Cn07CndpbmRvdy56b29uaXZlcnNlLnZpZXdzWydsYW5ndWFnZXNNZW51J10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBCYXNlQ29udHJvbGxlciwgRXZlbnRFbWl0dGVyLCBuZXh0SWQsIF9iYXNlLAogICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksCiAgICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSwKICAgIF9fc2xpY2UgPSBbXS5zbGljZTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLmNvbnRyb2xsZXJzID09IG51bGwpIHsKICAgIF9iYXNlLmNvbnRyb2xsZXJzID0ge307CiAgfQoKICBFdmVudEVtaXR0ZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5FdmVudEVtaXR0ZXIgfHwgcmVxdWlyZSgnLi4vbGliL2V2ZW50LWVtaXR0ZXInKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIG5leHRJZCA9IDA7CgogIEJhc2VDb250cm9sbGVyID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKEJhc2VDb250cm9sbGVyLCBfc3VwZXIpOwoKICAgIEJhc2VDb250cm9sbGVyLnByb3RvdHlwZS5lbCA9IG51bGw7CgogICAgQmFzZUNvbnRyb2xsZXIucHJvdG90eXBlLnRhZ05hbWUgPSAnZGl2JzsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuY2xhc3NOYW1lID0gJyc7CgogICAgQmFzZUNvbnRyb2xsZXIucHJvdG90eXBlLnRlbXBsYXRlID0gbnVsbDsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuaWQgPSAnJzsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuZXZlbnRzID0gbnVsbDsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuZWxlbWVudHMgPSBudWxsOwoKICAgIGZ1bmN0aW9uIEJhc2VDb250cm9sbGVyKHBhcmFtcykgewogICAgICB2YXIgcHJvcGVydHksIHZhbHVlOwogICAgICBpZiAocGFyYW1zID09IG51bGwpIHsKICAgICAgICBwYXJhbXMgPSB7fTsKICAgICAgfQogICAgICBCYXNlQ29udHJvbGxlci5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgZm9yIChwcm9wZXJ0eSBpbiBwYXJhbXMpIHsKICAgICAgICBpZiAoIV9faGFzUHJvcC5jYWxsKHBhcmFtcywgcHJvcGVydHkpKSBjb250aW51ZTsKICAgICAgICB2YWx1ZSA9IHBhcmFtc1twcm9wZXJ0eV07CiAgICAgICAgaWYgKHByb3BlcnR5IGluIHRoaXMpIHsKICAgICAgICAgIHRoaXNbcHJvcGVydHldID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuaWQgfHwgKHRoaXMuaWQgPSAiY29udHJvbGxlcl8iICsgbmV4dElkKTsKICAgICAgbmV4dElkICs9IDE7CiAgICAgIGlmICh0aGlzLmVsID09IG51bGwpIHsKICAgICAgICB0aGlzLmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0aGlzLnRhZ05hbWUpOwogICAgICB9CiAgICAgIHRoaXMuZWwgPSAkKHRoaXMuZWwpOwogICAgICB0aGlzLnJlbmRlclRlbXBsYXRlKCk7CiAgICAgIHRoaXMuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgdGhpcy5uYW1lRWxlbWVudHMoKTsKICAgIH0KCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUucmVuZGVyVGVtcGxhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKSB7CiAgICAgICAgdGhpcy5lbC5hZGRDbGFzcyh0aGlzLmNsYXNzTmFtZSk7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmVsLmh0bWwoKSkgewogICAgICAgIGlmICh0eXBlb2YgdGhpcy50ZW1wbGF0ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHRoaXMuZWwuaHRtbCh0aGlzLnRlbXBsYXRlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnRlbXBsYXRlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5lbC5odG1sKHRoaXMudGVtcGxhdGUodGhpcykpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUubmFtZUVsZW1lbnRzID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBuYW1lLCBzZWxlY3RvciwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIGlmICh0aGlzLmVsZW1lbnRzICE9IG51bGwpIHsKICAgICAgICBfcmVmID0gdGhpcy5lbGVtZW50czsKICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgIGZvciAoc2VsZWN0b3IgaW4gX3JlZikgewogICAgICAgICAgbmFtZSA9IF9yZWZbc2VsZWN0b3JdOwogICAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzW25hbWVdID0gdGhpcy5lbC5maW5kKHNlbGVjdG9yKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfQogICAgfTsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuZGVsZWdhdGVFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGV2ZW50U3RyaW5nLCBtZXRob2QsIF9yZWYsIF9yZXN1bHRzLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgdGhpcy5lbC5vZmYoIi4iICsgdGhpcy5pZCk7CiAgICAgIGlmICh0aGlzLmV2ZW50cyAhPSBudWxsKSB7CiAgICAgICAgX3JlZiA9IHRoaXMuZXZlbnRzOwogICAgICAgIF9yZXN1bHRzID0gW107CiAgICAgICAgZm9yIChldmVudFN0cmluZyBpbiBfcmVmKSB7CiAgICAgICAgICBtZXRob2QgPSBfcmVmW2V2ZW50U3RyaW5nXTsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goKGZ1bmN0aW9uKGV2ZW50U3RyaW5nLCBtZXRob2QpIHsKICAgICAgICAgICAgdmFyIGF1dG9QcmV2ZW50RGVmYXVsdCwgZXZlbnROYW1lLCBzZWxlY3RvciwgX3JlZjE7CiAgICAgICAgICAgIF9yZWYxID0gZXZlbnRTdHJpbmcuc3BsaXQoL1xzKy8pLCBldmVudE5hbWUgPSBfcmVmMVswXSwgc2VsZWN0b3IgPSAyIDw9IF9yZWYxLmxlbmd0aCA/IF9fc2xpY2UuY2FsbChfcmVmMSwgMSkgOiBbXTsKICAgICAgICAgICAgc2VsZWN0b3IgPSBzZWxlY3Rvci5qb2luKCcgJyk7CiAgICAgICAgICAgIGlmIChldmVudE5hbWUuc2xpY2UoLTEpID09PSAnKicpIHsKICAgICAgICAgICAgICBldmVudE5hbWUgPSBldmVudE5hbWUuc2xpY2UoMCwgLTEpOwogICAgICAgICAgICAgIGF1dG9QcmV2ZW50RGVmYXVsdCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXRob2QgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgbWV0aG9kID0gX3RoaXNbbWV0aG9kXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX3RoaXMuZWwub24oIiIgKyBldmVudE5hbWUgKyAiLiIgKyBfdGhpcy5pZCwgc2VsZWN0b3IsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBpZiAoYXV0b1ByZXZlbnREZWZhdWx0KSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBtZXRob2QuY2FsbC5hcHBseShtZXRob2QsIFtfdGhpc10uY29uY2F0KF9fc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkoZXZlbnRTdHJpbmcsIG1ldGhvZCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICAgIH0KICAgIH07CgogICAgQmFzZUNvbnRyb2xsZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHByb3BlcnR5TmFtZSwgc2VsZWN0b3IsIF9yZWY7CiAgICAgIGlmICh0aGlzLmVsZW1lbnRzICE9IG51bGwpIHsKICAgICAgICBfcmVmID0gdGhpcy5lbGVtZW50czsKICAgICAgICBmb3IgKHNlbGVjdG9yIGluIF9yZWYpIHsKICAgICAgICAgIHByb3BlcnR5TmFtZSA9IF9yZWZbc2VsZWN0b3JdOwogICAgICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5lbC5vZmYoKTsKICAgICAgdGhpcy5lbC5lbXB0eSgpOwogICAgICB0aGlzLmVsLnJlbW92ZSgpOwogICAgICByZXR1cm4gQmFzZUNvbnRyb2xsZXIuX19zdXBlcl9fLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CgogICAgcmV0dXJuIEJhc2VDb250cm9sbGVyOwoKICB9KShFdmVudEVtaXR0ZXIpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciA9IEJhc2VDb250cm9sbGVyOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEJhc2VDb250cm9sbGVyOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIEJhc2VDb250cm9sbGVyLCBEaWFsb2csIHRlbXBsYXRlLCB0cmFuc2xhdGUsIF9iYXNlLCBfYmFzZTEsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgQmFzZUNvbnRyb2xsZXIgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkJhc2VDb250cm9sbGVyIHx8IHJlcXVpcmUoJy4vYmFzZS1jb250cm9sbGVyJyk7CgogIHRlbXBsYXRlID0gem9vbml2ZXJzZS52aWV3cy5kaWFsb2cgfHwgcmVxdWlyZSgnLi4vdmlld3MvZGlhbG9nJyk7CgogIHRyYW5zbGF0ZSA9IHpvb25pdmVyc2UudHJhbnNsYXRlIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKCiAgRGlhbG9nID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKERpYWxvZywgX3N1cGVyKTsKCiAgICBEaWFsb2cucHJvdG90eXBlLndhcm5pbmcgPSBmYWxzZTsKCiAgICBEaWFsb2cucHJvdG90eXBlLmVycm9yID0gZmFsc2U7CgogICAgRGlhbG9nLnByb3RvdHlwZS5jb250ZW50ID0gJyc7CgogICAgRGlhbG9nLnByb3RvdHlwZS5jbGFzc05hbWUgPSAnem9vbml2ZXJzZS1kaWFsb2cnOwoKICAgIERpYWxvZy5wcm90b3R5cGUudGVtcGxhdGUgPSB0ZW1wbGF0ZTsKCiAgICBEaWFsb2cucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ2NsaWNrIGJ1dHRvbltuYW1lPSJjbG9zZS1kaWFsb2ciXSc6ICdoaWRlJywKICAgICAgJ2tleWRvd24nOiAnb25LZXlEb3duJwogICAgfTsKCiAgICBEaWFsb2cucHJvdG90eXBlLmVsZW1lbnRzID0gewogICAgICAnLmRpYWxvZyc6ICdjb250ZW50Q29udGFpbmVyJwogICAgfTsKCiAgICBmdW5jdGlvbiBEaWFsb2coKSB7CiAgICAgIERpYWxvZy5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgdGhpcy5lbC5jc3MoewogICAgICAgIGRpc3BsYXk6ICdub25lJwogICAgICB9KTsKICAgICAgaWYgKHRoaXMud2FybmluZykgewogICAgICAgIHRoaXMuZWwuYWRkQ2xhc3MoJ3dhcm5pbmcnKTsKICAgICAgfQogICAgICBpZiAodGhpcy5lcnJvcikgewogICAgICAgIHRoaXMuZWwuYWRkQ2xhc3MoJ2Vycm9yJyk7CiAgICAgIH0KICAgICAgdGhpcy5jb250ZW50Q29udGFpbmVyLmFwcGVuZCh0aGlzLmNvbnRlbnQpOwogICAgICB0aGlzLmVsLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwogICAgfQoKICAgIERpYWxvZy5wcm90b3R5cGUub25LZXlEb3duID0gZnVuY3Rpb24oX2FyZykgewogICAgICB2YXIgd2hpY2g7CiAgICAgIHdoaWNoID0gX2FyZy53aGljaDsKICAgICAgaWYgKHdoaWNoID09PSAyNykgewogICAgICAgIHJldHVybiB0aGlzLmhpZGUoKTsKICAgICAgfQogICAgfTsKCiAgICBEaWFsb2cucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGVsZW1lbnQsIF9pLCBfbGVuLCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgX3JlZiA9IHRoaXMuZWwuZ2V0KDApLnF1ZXJ5U2VsZWN0b3JBbGwoIlsiICsgdHJhbnNsYXRlLmF0dHIgKyAiXSIpOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBlbGVtZW50ID0gX3JlZltfaV07CiAgICAgICAgdHJhbnNsYXRlLnJlZnJlc2goZWxlbWVudCk7CiAgICAgIH0KICAgICAgdGhpcy5lbC5jc3MoewogICAgICAgIGRpc3BsYXk6ICcnCiAgICAgIH0pOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5lbC5hZGRDbGFzcygnc2hvd2luZycpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMuY29udGVudENvbnRhaW5lci5maW5kKCdpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCcpLmZpcnN0KCkuZm9jdXMoKTsKICAgIH07CgogICAgRGlhbG9nLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMuZWwucmVtb3ZlQ2xhc3MoJ3Nob3dpbmcnKTsKICAgICAgcmV0dXJuIHNldFRpbWVvdXQoKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5lbC5jc3MoewogICAgICAgICAgZGlzcGxheTogJ25vbmUnCiAgICAgICAgfSk7CiAgICAgIH0pLCA1MDApOwogICAgfTsKCiAgICByZXR1cm4gRGlhbG9nOwoKICB9KShCYXNlQ29udHJvbGxlcik7CgogIHdpbmRvdy56b29uaXZlcnNlLmNvbnRyb2xsZXJzLkRpYWxvZyA9IERpYWxvZzsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBEaWFsb2c7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgQkVUQV9QUkVGRVJFTkNFX0tFWSwgQmFzZUNvbnRyb2xsZXIsIFNpZ251cEZvcm0sIFVzZXIsIHRyYW5zbGF0ZSwgX2Jhc2UsIF9iYXNlMSwgX3JlZiwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5jb250cm9sbGVycyA9PSBudWxsKSB7CiAgICBfYmFzZS5jb250cm9sbGVycyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTEgPSB3aW5kb3cuem9vbml2ZXJzZSkubW9kZWxzID09IG51bGwpIHsKICAgIF9iYXNlMS5tb2RlbHMgPSB7fTsKICB9CgogIEJhc2VDb250cm9sbGVyID0gem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICBVc2VyID0gem9vbml2ZXJzZS5tb2RlbHMuVXNlciB8fCByZXF1aXJlKCcuLi9tb2RlbHMvdXNlcicpOwoKICB0cmFuc2xhdGUgPSB6b29uaXZlcnNlLnRyYW5zbGF0ZSB8fCByZXF1aXJlKCcuLi9saWIvdHJhbnNsYXRlJyk7CgogIEJFVEFfUFJFRkVSRU5DRV9LRVkgPSAnYmV0YV9vcHRfaW4nOwoKICBTaWdudXBGb3JtID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKFNpZ251cEZvcm0sIF9zdXBlcik7CgogICAgZnVuY3Rpb24gU2lnbnVwRm9ybSgpIHsKICAgICAgX3JlZiA9IFNpZ251cEZvcm0uX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfcmVmOwogICAgfQoKICAgIFNpZ251cEZvcm0ucHJvdG90eXBlLnRhZ05hbWUgPSAnZm9ybSc7CgogICAgU2lnbnVwRm9ybS5wcm90b3R5cGUuY2xhc3NOYW1lID0gJ3pvb25pdmVyc2Utc2lnbnVwLWZvcm0nOwoKICAgIFNpZ251cEZvcm0ucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ3N1Ym1pdConOiAnb25TdWJtaXQnCiAgICB9OwoKICAgIFNpZ251cEZvcm0ucHJvdG90eXBlLmVsZW1lbnRzID0gewogICAgICAnaW5wdXRbbmFtZT0idXNlcm5hbWUiXSc6ICd1c2VybmFtZUlucHV0JywKICAgICAgJ2lucHV0W25hbWU9InBhc3N3b3JkIl0nOiAncGFzc3dvcmRJbnB1dCcsCiAgICAgICdpbnB1dFtuYW1lPSJlbWFpbCJdJzogJ2VtYWlsSW5wdXQnLAogICAgICAnaW5wdXRbbmFtZT0icmVhbC1uYW1lIl0nOiAncmVhbE5hbWVJbnB1dCcsCiAgICAgICdpbnB1dFtuYW1lPSJiZXRhLXByZWZlcmVuY2UiXSc6ICdiZXRhUHJlZmVyZW5jZUlucHV0JywKICAgICAgJ2J1dHRvblt0eXBlPSJzdWJtaXQiXSc6ICdzaWduVXBCdXR0b24nLAogICAgICAnLmVycm9yLW1lc3NhZ2UnOiAnZXJyb3JDb250YWluZXInCiAgICB9OwoKICAgIFNpZ251cEZvcm0ucHJvdG90eXBlLm9uU3VibWl0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzaWdudXAsCiAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICB0aGlzLmVsLmFkZENsYXNzKCdsb2FkaW5nJyk7CiAgICAgIHRoaXMuc2lnblVwQnV0dG9uLmF0dHIoewogICAgICAgIGRpc2FibGVkOiB0cnVlCiAgICAgIH0pOwogICAgICBzaWdudXAgPSBVc2VyLnNpZ251cCh7CiAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWVJbnB1dC52YWwoKSwKICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZElucHV0LnZhbCgpLAogICAgICAgIGVtYWlsOiB0aGlzLmVtYWlsSW5wdXQudmFsKCksCiAgICAgICAgcmVhbF9uYW1lOiB0aGlzLnJlYWxOYW1lSW5wdXQudmFsKCkKICAgICAgfSk7CiAgICAgIHNpZ251cC5kb25lKGZ1bmN0aW9uKF9hcmcpIHsKICAgICAgICB2YXIgbWVzc2FnZSwgc3VjY2VzcywgX3JlZjE7CiAgICAgICAgc3VjY2VzcyA9IF9hcmcuc3VjY2VzcywgbWVzc2FnZSA9IF9hcmcubWVzc2FnZTsKICAgICAgICBpZiAoIXN1Y2Nlc3MpIHsKICAgICAgICAgIF90aGlzLnNob3dFcnJvcihtZXNzYWdlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChfcmVmMSA9IFVzZXIuY3VycmVudCkgIT0gbnVsbCA/IF9yZWYxLnNldFByZWZlcmVuY2UoQkVUQV9QUkVGRVJFTkNFX0tFWSwgX3RoaXMuYmV0YVByZWZlcmVuY2VJbnB1dC5wcm9wKCdjaGVja2VkJyksIHRydWUpIDogdm9pZCAwOwogICAgICB9KTsKICAgICAgc2lnbnVwLmZhaWwoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLnNob3dFcnJvcih0cmFuc2xhdGUoJ3NpZ25JbkZhaWxlZCcpKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBzaWdudXAuYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgIF90aGlzLmVsLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7CiAgICAgICAgcmV0dXJuIF90aGlzLnNpZ25VcEJ1dHRvbi5hdHRyKHsKICAgICAgICAgIGRpc2FibGVkOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH07CgogICAgU2lnbnVwRm9ybS5wcm90b3R5cGUuc2hvd0Vycm9yID0gZnVuY3Rpb24obWVzc2FnZSkgewogICAgICByZXR1cm4gdGhpcy5lcnJvckNvbnRhaW5lci5odG1sKG1lc3NhZ2UpOwogICAgfTsKCiAgICByZXR1cm4gU2lnbnVwRm9ybTsKCiAgfSkoQmFzZUNvbnRyb2xsZXIpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5TaWdudXBGb3JtID0gU2lnbnVwRm9ybTsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBTaWdudXBGb3JtOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIERpYWxvZywgU2lnbnVwRm9ybSwgVXNlciwgc2lnbnVwRGlhbG9nLCB0ZW1wbGF0ZSwgX2Jhc2UsIF9iYXNlMSwgX2Jhc2UyOwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTIgPSB3aW5kb3cuem9vbml2ZXJzZSkubW9kZWxzID09IG51bGwpIHsKICAgIF9iYXNlMi5tb2RlbHMgPSB7fTsKICB9CgogIERpYWxvZyA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuRGlhbG9nIHx8IHJlcXVpcmUoJy4vZGlhbG9nJyk7CgogIFNpZ251cEZvcm0gPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLlNpZ251cEZvcm0gfHwgcmVxdWlyZSgnLi9zaWdudXAtZm9ybScpOwoKICB0ZW1wbGF0ZSA9IHpvb25pdmVyc2Uudmlld3Muc2lnbnVwRGlhbG9nIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL3NpZ251cC1kaWFsb2cnKTsKCiAgVXNlciA9IHpvb25pdmVyc2UubW9kZWxzLlVzZXIgfHwgcmVxdWlyZSgnLi4vbW9kZWxzL3VzZXInKTsKCiAgc2lnbnVwRGlhbG9nID0gbmV3IERpYWxvZyh7CiAgICBjb250ZW50OiAobmV3IFNpZ251cEZvcm0oewogICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUKICAgIH0pKS5lbAogIH0pOwoKICBVc2VyLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlLCB1c2VyKSB7CiAgICBpZiAodXNlciAhPSBudWxsKSB7CiAgICAgIHJldHVybiBzaWdudXBEaWFsb2cuaGlkZSgpOwogICAgfQogIH0pOwoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5zaWdudXBEaWFsb2cgPSBzaWdudXBEaWFsb2c7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gc2lnbnVwRGlhbG9nOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIEFwaSwgQmFzZUNvbnRyb2xsZXIsIExvZ2luRm9ybSwgVXNlciwgc2lnbnVwRGlhbG9nLCB0ZW1wbGF0ZSwgdHJhbnNsYXRlLCBfYmFzZSwgX2Jhc2UxLCBfYmFzZTIsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTIgPSB3aW5kb3cuem9vbml2ZXJzZSkubW9kZWxzID09IG51bGwpIHsKICAgIF9iYXNlMi5tb2RlbHMgPSB7fTsKICB9CgogIEJhc2VDb250cm9sbGVyID0gem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICB0ZW1wbGF0ZSA9IHpvb25pdmVyc2Uudmlld3MubG9naW5Gb3JtIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL2xvZ2luLWZvcm0nKTsKCiAgQXBpID0gem9vbml2ZXJzZS5BcGkgfHwgcmVxdWlyZSgnLi4vbGliL2FwaScpOwoKICBVc2VyID0gem9vbml2ZXJzZS5tb2RlbHMuVXNlciB8fCByZXF1aXJlKCcuLi9tb2RlbHMvdXNlcicpOwoKICB0cmFuc2xhdGUgPSB6b29uaXZlcnNlLnRyYW5zbGF0ZSB8fCByZXF1aXJlKCcuLi9saWIvdHJhbnNsYXRlJyk7CgogIHNpZ251cERpYWxvZyA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuc2lnbnVwRGlhbG9nIHx8IHJlcXVpcmUoJy4vc2lnbnVwLWRpYWxvZycpOwoKICBMb2dpbkZvcm0gPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoTG9naW5Gb3JtLCBfc3VwZXIpOwoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUudGFnTmFtZSA9ICdmb3JtJzsKCiAgICBMb2dpbkZvcm0ucHJvdG90eXBlLmNsYXNzTmFtZSA9ICd6b29uaXZlcnNlLWxvZ2luLWZvcm0nOwoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUudGVtcGxhdGUgPSB0ZW1wbGF0ZTsKCiAgICBMb2dpbkZvcm0ucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ3N1Ym1pdConOiAnb25TdWJtaXQnLAogICAgICAnY2xpY2sqIGJ1dHRvbltuYW1lPSJzaWduLXVwIl0nOiAnb25DbGlja1NpZ25VcCcsCiAgICAgICdjbGljayogYnV0dG9uW25hbWU9InNpZ24tb3V0Il0nOiAnb25DbGlja1NpZ25PdXQnCiAgICB9OwoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUuZWxlbWVudHMgPSB7CiAgICAgICdpbnB1dFtuYW1lPSJ1c2VybmFtZSJdJzogJ3VzZXJuYW1lSW5wdXQnLAogICAgICAnaW5wdXRbbmFtZT0icGFzc3dvcmQiXSc6ICdwYXNzd29yZElucHV0JywKICAgICAgJ2J1dHRvblt0eXBlPSJzdWJtaXQiXSc6ICdzaWduSW5CdXR0b24nLAogICAgICAnYnV0dG9uW25hbWU9InNpZ24tb3V0Il0nOiAnc2lnbk91dEJ1dHRvbicsCiAgICAgICcuZXJyb3ItbWVzc2FnZSc6ICdlcnJvckNvbnRhaW5lcicKICAgIH07CgogICAgZnVuY3Rpb24gTG9naW5Gb3JtKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBMb2dpbkZvcm0uX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIFVzZXIub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5vblVzZXJDaGFuZ2UuYXBwbHkoX3RoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0pOwogICAgfQoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUub25TdWJtaXQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGxvZ2luLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgdGhpcy5lbC5hZGRDbGFzcygnbG9hZGluZycpOwogICAgICB0aGlzLnNpZ25JbkJ1dHRvbi5hdHRyKHsKICAgICAgICBkaXNhYmxlZDogdHJ1ZQogICAgICB9KTsKICAgICAgbG9naW4gPSBVc2VyLmxvZ2luKHsKICAgICAgICB1c2VybmFtZTogdGhpcy51c2VybmFtZUlucHV0LnZhbCgpLAogICAgICAgIHBhc3N3b3JkOiB0aGlzLnBhc3N3b3JkSW5wdXQudmFsKCkKICAgICAgfSk7CiAgICAgIGxvZ2luLmRvbmUoZnVuY3Rpb24oX2FyZykgewogICAgICAgIHZhciBtZXNzYWdlLCBzdWNjZXNzOwogICAgICAgIHN1Y2Nlc3MgPSBfYXJnLnN1Y2Nlc3MsIG1lc3NhZ2UgPSBfYXJnLm1lc3NhZ2U7CiAgICAgICAgaWYgKCFzdWNjZXNzKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMuc2hvd0Vycm9yKG1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGxvZ2luLmZhaWwoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLnNob3dFcnJvcih0cmFuc2xhdGUoJ3NpZ25JbkZhaWxlZCcpKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBsb2dpbi5hbHdheXMoZnVuY3Rpb24oKSB7CiAgICAgICAgX3RoaXMuZWwucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTsKICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBfdGhpcy5zaWduSW5CdXR0b24uYXR0cih7CiAgICAgICAgICAgIGRpc2FibGVkOiBVc2VyLmN1cnJlbnQgIT0gbnVsbAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfTsKCiAgICBMb2dpbkZvcm0ucHJvdG90eXBlLm9uQ2xpY2tTaWduVXAgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHNpZ251cERpYWxvZy5zaG93KCk7CiAgICB9OwoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUub25DbGlja1NpZ25PdXQgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5zaWduT3V0QnV0dG9uLmF0dHIoewogICAgICAgIGRpc2FibGVkOiB0cnVlCiAgICAgIH0pOwogICAgICByZXR1cm4gVXNlci5sb2dvdXQoKTsKICAgIH07CgogICAgTG9naW5Gb3JtLnByb3RvdHlwZS5vblVzZXJDaGFuZ2UgPSBmdW5jdGlvbihlLCB1c2VyKSB7CiAgICAgIHRoaXMudXNlcm5hbWVJbnB1dC52YWwoKHVzZXIgIT0gbnVsbCA/IHVzZXIubmFtZSA6IHZvaWQgMCkgfHwgJycpOwogICAgICB0aGlzLnBhc3N3b3JkSW5wdXQudmFsKCh1c2VyICE9IG51bGwgPyB1c2VyLmFwaV9rZXkgOiB2b2lkIDApIHx8ICcnKTsKICAgICAgdGhpcy5lcnJvckNvbnRhaW5lci5odG1sKCcnKTsKICAgICAgdGhpcy51c2VybmFtZUlucHV0LmF0dHIoewogICAgICAgIGRpc2FibGVkOiBVc2VyLmN1cnJlbnQgIT0gbnVsbAogICAgICB9KTsKICAgICAgdGhpcy5wYXNzd29yZElucHV0LmF0dHIoewogICAgICAgIGRpc2FibGVkOiBVc2VyLmN1cnJlbnQgIT0gbnVsbAogICAgICB9KTsKICAgICAgdGhpcy5zaWduSW5CdXR0b24uYXR0cih7CiAgICAgICAgZGlzYWJsZWQ6IFVzZXIuY3VycmVudCAhPSBudWxsCiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5zaWduT3V0QnV0dG9uLmF0dHIoewogICAgICAgIGRpc2FibGVkOiBVc2VyLmN1cnJlbnQgPT0gbnVsbAogICAgICB9KTsKICAgIH07CgogICAgTG9naW5Gb3JtLnByb3RvdHlwZS5zaG93RXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgIHJldHVybiB0aGlzLmVycm9yQ29udGFpbmVyLmh0bWwobWVzc2FnZSk7CiAgICB9OwoKICAgIHJldHVybiBMb2dpbkZvcm07CgogIH0pKEJhc2VDb250cm9sbGVyKTsKCiAgd2luZG93Lnpvb25pdmVyc2UuY29udHJvbGxlcnMuTG9naW5Gb3JtID0gTG9naW5Gb3JtOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IExvZ2luRm9ybTsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBEaWFsb2csIExvZ2luRm9ybSwgVXNlciwgbG9naW5EaWFsb2csIHRlbXBsYXRlLCBfYmFzZTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLmNvbnRyb2xsZXJzID09IG51bGwpIHsKICAgIF9iYXNlLmNvbnRyb2xsZXJzID0ge307CiAgfQoKICBEaWFsb2cgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkRpYWxvZyB8fCByZXF1aXJlKCcuL2RpYWxvZycpOwoKICBMb2dpbkZvcm0gPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkxvZ2luRm9ybSB8fCByZXF1aXJlKCcuL2xvZ2luLWZvcm0nKTsKCiAgdGVtcGxhdGUgPSB6b29uaXZlcnNlLnZpZXdzLmxvZ2luRGlhbG9nIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL2xvZ2luLWRpYWxvZycpOwoKICBVc2VyID0gem9vbml2ZXJzZS5tb2RlbHMuVXNlciB8fCByZXF1aXJlKCcuLi9tb2RlbHMvdXNlcicpOwoKICBsb2dpbkRpYWxvZyA9IG5ldyBEaWFsb2coewogICAgY29udGVudDogKG5ldyBMb2dpbkZvcm0oewogICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUKICAgIH0pKS5lbAogIH0pOwoKICBVc2VyLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlLCB1c2VyKSB7CiAgICBpZiAodXNlciAhPSBudWxsKSB7CiAgICAgIHJldHVybiBsb2dpbkRpYWxvZy5oaWRlKCk7CiAgICB9CiAgfSk7CgogIHdpbmRvdy56b29uaXZlcnNlLmNvbnRyb2xsZXJzLmxvZ2luRGlhbG9nID0gbG9naW5EaWFsb2c7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gbG9naW5EaWFsb2c7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgRHJvcGRvd24sIHRvZ2dsZUNsYXNzLCBfYmFzZSwgX3JlZiwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2luZGV4T2YgPSBbXS5pbmRleE9mIHx8IGZ1bmN0aW9uKGl0ZW0pIHsgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKykgeyBpZiAoaSBpbiB0aGlzICYmIHRoaXNbaV0gPT09IGl0ZW0pIHJldHVybiBpOyB9IHJldHVybiAtMTsgfTsKCiAgdG9nZ2xlQ2xhc3MgPSAoKF9yZWYgPSB6b29uaXZlcnNlLnV0aWwpICE9IG51bGwgPyBfcmVmLnRvZ2dsZUNsYXNzIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi91dGlsL3RvZ2dsZS1jbGFzcycpOwoKICBEcm9wZG93biA9IChmdW5jdGlvbigpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgRHJvcGRvd24uYnV0dG9uQ2xhc3MgPSAnem9vbml2ZXJzZS1kcm9wZG93bi1idXR0b24nOwoKICAgIERyb3Bkb3duLm1lbnVDbGFzcyA9ICd6b29uaXZlcnNlLWRyb3Bkb3duLW1lbnUnOwoKICAgIERyb3Bkb3duLmluc3RhbmNlcyA9IFtdOwoKICAgIERyb3Bkb3duLmVsZW1lbnRzID0gW107CgogICAgRHJvcGRvd24uY2xvc2VBbGwgPSBmdW5jdGlvbihfYXJnKSB7CiAgICAgIHZhciBleGNlcHQsIGluc3RhbmNlLCBfaSwgX2xlbiwgX3JlZjEsIF9yZXN1bHRzOwogICAgICBleGNlcHQgPSAoX2FyZyAhPSBudWxsID8gX2FyZyA6IHt9KS5leGNlcHQ7CiAgICAgIF9yZWYxID0gdGhpcy5pbnN0YW5jZXM7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZjEubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBpbnN0YW5jZSA9IF9yZWYxW19pXTsKICAgICAgICBpZiAoaW5zdGFuY2UgIT09IGV4Y2VwdCkgewogICAgICAgICAgX3Jlc3VsdHMucHVzaChpbnN0YW5jZS5jbG9zZSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3Jlc3VsdHMucHVzaCh2b2lkIDApOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIGFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIG5vZGUsIHNob3VsZENsb3NlOwogICAgICBzaG91bGRDbG9zZSA9IHRydWU7CiAgICAgIG5vZGUgPSBlLnRhcmdldC5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCB8fCBlLnRhcmdldDsKICAgICAgd2hpbGUgKG5vZGUgIT0gbnVsbCkgewogICAgICAgIGlmIChfX2luZGV4T2YuY2FsbChEcm9wZG93bi5lbGVtZW50cywgbm9kZSkgPj0gMCkgewogICAgICAgICAgc2hvdWxkQ2xvc2UgPSBmYWxzZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlOwogICAgICB9CiAgICAgIGlmIChzaG91bGRDbG9zZSkgewogICAgICAgIHJldHVybiBEcm9wZG93bi5jbG9zZUFsbCgpOwogICAgICB9CiAgICB9KTsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuYnV0dG9uID0gbnVsbDsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuYnV0dG9uQ2xhc3MgPSAnJzsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuYnV0dG9uVGFnID0gJ2J1dHRvbic7CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm1lbnUgPSBudWxsOwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5tZW51Q2xhc3MgPSAnJzsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUubWVudVRhZyA9ICdkaXYnOwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5idXR0b25QaW5uaW5nID0gWzAuNSwgMV07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm1lbnVQaW5uaW5nID0gWzAuNSwgMF07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLl9vcGVuID0gbnVsbDsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUub3BlbkNsYXNzID0gJ29wZW4nOwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5hbmltYXRpb25EZWxheSA9IDI1MDsKCiAgICBmdW5jdGlvbiBEcm9wZG93bihwYXJhbXMpIHsKICAgICAgdmFyIHByb3BlcnR5LCB2YWx1ZTsKICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAgcGFyYW1zID0ge307CiAgICAgIH0KICAgICAgdGhpcy5vblJlc2l6ZSA9IF9fYmluZCh0aGlzLm9uUmVzaXplLCB0aGlzKTsKICAgICAgdGhpcy5vbkJ1dHRvbkNsaWNrID0gX19iaW5kKHRoaXMub25CdXR0b25DbGljaywgdGhpcyk7CiAgICAgIHdpbmRvdy5kcm9wZG93biA9IHRoaXM7CiAgICAgIGZvciAocHJvcGVydHkgaW4gcGFyYW1zKSB7CiAgICAgICAgdmFsdWUgPSBwYXJhbXNbcHJvcGVydHldOwogICAgICAgIHRoaXNbcHJvcGVydHldID0gdmFsdWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYnV0dG9uID09IG51bGwpIHsKICAgICAgICB0aGlzLmJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy5idXR0b25UYWcpOwogICAgICB9CiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMuYnV0dG9uLCB0aGlzLmNvbnN0cnVjdG9yLmJ1dHRvbkNsYXNzLCB0cnVlKTsKICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKSB7CiAgICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5idXR0b24sIHRoaXMuY2xhc3NOYW1lLCB0cnVlKTsKICAgICAgfQogICAgICB0aGlzLmJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25CdXR0b25DbGljaywgZmFsc2UpOwogICAgICBpZiAodGhpcy5tZW51ID09IG51bGwpIHsKICAgICAgICB0aGlzLm1lbnUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMubWVudVRhZyk7CiAgICAgIH0KICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5tZW51LCB0aGlzLmNvbnN0cnVjdG9yLm1lbnVDbGFzcywgdHJ1ZSk7CiAgICAgIGlmICh0aGlzLm1lbnVDbGFzcykgewogICAgICAgIHRvZ2dsZUNsYXNzKHRoaXMubWVudSwgdGhpcy5tZW51Q2xhc3MsIHRydWUpOwogICAgICB9CiAgICAgIHRoaXMubWVudS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICAgIHRoaXMubWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubWVudSk7CiAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5pbnN0YW5jZXMucHVzaCh0aGlzKTsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5lbGVtZW50cy5wdXNoKHRoaXMuYnV0dG9uKTsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5lbGVtZW50cy5wdXNoKHRoaXMubWVudSk7CiAgICB9CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm9uQnV0dG9uQ2xpY2sgPSBmdW5jdGlvbihlKSB7CiAgICAgIHJldHVybiB0aGlzLnRvZ2dsZSgpOwogICAgfTsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLl9vcGVuKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2UoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vcGVuKCk7CiAgICAgIH0KICAgIH07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5jbG9zZUFsbCh7CiAgICAgICAgZXhjZXB0OiB0aGlzCiAgICAgIH0pOwogICAgICB0b2dnbGVDbGFzcyh0aGlzLmJ1dHRvbiwgdGhpcy5vcGVuQ2xhc3MsIHRydWUpOwogICAgICB0aGlzLm1lbnUuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgICB0aGlzLnBvc2l0aW9uTWVudSgpOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHRvZ2dsZUNsYXNzKF90aGlzLm1lbnUsIF90aGlzLm9wZW5DbGFzcywgdHJ1ZSk7CiAgICAgICAgcmV0dXJuIF90aGlzLl9vcGVuID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHJldHVybiBhZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplLCBmYWxzZSk7CiAgICB9OwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5wb3NpdGlvbk1lbnUgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGJ1dHRvbk9mZnNldDsKICAgICAgYnV0dG9uT2Zmc2V0ID0gdGhpcy5idXR0b24uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIHRoaXMubWVudS5zdHlsZS5sZWZ0ID0gKChidXR0b25PZmZzZXQubGVmdCArIHBhZ2VYT2Zmc2V0KSArICh0aGlzLmJ1dHRvbi5vZmZzZXRXaWR0aCAqIHRoaXMuYnV0dG9uUGlubmluZ1swXSkpIC0gKHRoaXMubWVudS5vZmZzZXRXaWR0aCAqIHRoaXMubWVudVBpbm5pbmdbMF0pICsgJ3B4JzsKICAgICAgcmV0dXJuIHRoaXMubWVudS5zdHlsZS50b3AgPSAoKGJ1dHRvbk9mZnNldC50b3AgKyBwYWdlWU9mZnNldCkgKyAodGhpcy5idXR0b24ub2Zmc2V0SGVpZ2h0ICogdGhpcy5idXR0b25QaW5uaW5nWzFdKSkgLSAodGhpcy5tZW51Lm9mZnNldEhlaWdodCAqIHRoaXMubWVudVBpbm5pbmdbMV0pICsgJ3B4JzsKICAgIH07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uTWVudSgpOwogICAgfTsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5idXR0b24sIHRoaXMub3BlbkNsYXNzLCBmYWxzZSk7CiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMubWVudSwgdGhpcy5vcGVuQ2xhc3MsIGZhbHNlKTsKICAgICAgc2V0VGltZW91dCgoZnVuY3Rpb24oKSB7CiAgICAgICAgX3RoaXMubWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHJldHVybiBfdGhpcy5fb3BlbiA9IGZhbHNlOwogICAgICB9KSwgdGhpcy5hbmltYXRpb25EZWxheSk7CiAgICAgIHJldHVybiByZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplLCBmYWxzZSk7CiAgICB9OwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfcmVmMSwgX3JlZjI7CiAgICAgIHRoaXMuY29uc3RydWN0b3IuaW5zdGFuY2VzLnNwbGljZSh0aGlzLmNvbnN0cnVjdG9yLmluc3RhbmNlcy5pbmRleE9mKHRoaXMpLCAxKTsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5lbGVtZW50cy5zcGxpY2UodGhpcy5jb25zdHJ1Y3Rvci5pbnN0YW5jZXMuaW5kZXhPZih0aGlzLmJ1dHRvbiksIDEpOwogICAgICB0aGlzLmNvbnN0cnVjdG9yLmVsZW1lbnRzLnNwbGljZSh0aGlzLmNvbnN0cnVjdG9yLmluc3RhbmNlcy5pbmRleE9mKHRoaXMubWVudSksIDEpOwogICAgICB0aGlzLmJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25CdXR0b25DbGljaywgZmFsc2UpOwogICAgICBpZiAoKF9yZWYxID0gdGhpcy5idXR0b24ucGFyZW50Tm9kZSkgIT0gbnVsbCkgewogICAgICAgIF9yZWYxLnJlbW92ZUNoaWxkKHRoaXMuYnV0dG9uKTsKICAgICAgfQogICAgICByZXR1cm4gKF9yZWYyID0gdGhpcy5tZW51LnBhcmVudE5vZGUpICE9IG51bGwgPyBfcmVmMi5yZW1vdmVDaGlsZCh0aGlzLm1lbnUpIDogdm9pZCAwOwogICAgfTsKCiAgICByZXR1cm4gRHJvcGRvd247CgogIH0pLmNhbGwodGhpcyk7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5jb250cm9sbGVycyA9PSBudWxsKSB7CiAgICBfYmFzZS5jb250cm9sbGVycyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UuY29udHJvbGxlcnMuRHJvcGRvd24gPSBEcm9wZG93bjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBEcm9wZG93bjsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBDb250cm9sbGVyLCBEcm9wZG93biwgTGFuZ3VhZ2VNYW5hZ2VyLCBMYW5ndWFnZXNNZW51LCB0ZW1wbGF0ZSwgX2Jhc2UsIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjMsIF9yZWY0LCBfcmVmNSwgX3JlZjYsCiAgICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LAogICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksCiAgICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTsKCiAgQ29udHJvbGxlciA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYxID0gX3JlZi5jb250cm9sbGVycykgIT0gbnVsbCA/IF9yZWYxLkJhc2VDb250cm9sbGVyIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICBEcm9wZG93biA9ICgoX3JlZjIgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMyA9IF9yZWYyLmNvbnRyb2xsZXJzKSAhPSBudWxsID8gX3JlZjMuRHJvcGRvd24gOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4vZHJvcGRvd24nKTsKCiAgTGFuZ3VhZ2VNYW5hZ2VyID0gKChfcmVmNCA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZjQuTGFuZ3VhZ2VNYW5hZ2VyIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9saWIvbGFuZ3VhZ2UtbWFuYWdlcicpOwoKICB0ZW1wbGF0ZSA9ICgoX3JlZjUgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmNiA9IF9yZWY1LnZpZXdzKSAhPSBudWxsID8gX3JlZjYubGFuZ3VhZ2VzTWVudSA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdmlld3MvbGFuZ3VhZ2VzLW1lbnUnKTsKCiAgTGFuZ3VhZ2VzTWVudSA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhMYW5ndWFnZXNNZW51LCBfc3VwZXIpOwoKICAgIExhbmd1YWdlc01lbnUucHJvdG90eXBlLmNsYXNzTmFtZSA9ICd6b29uaXZlcnNlLWxhbmd1YWdlcy1tZW51JzsKCiAgICBMYW5ndWFnZXNNZW51LnByb3RvdHlwZS50ZW1wbGF0ZSA9IHRlbXBsYXRlOwoKICAgIExhbmd1YWdlc01lbnUucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ2NsaWNrIGJ1dHRvbltuYW1lPSJsYW5ndWFnZSJdJzogJ29uQ2xpY2tMYW5ndWFnZUJ1dHRvbicKICAgIH07CgogICAgZnVuY3Rpb24gTGFuZ3VhZ2VzTWVudSgpIHsKICAgICAgdGhpcy5vbkNsaWNrTGFuZ3VhZ2VCdXR0b24gPSBfX2JpbmQodGhpcy5vbkNsaWNrTGFuZ3VhZ2VCdXR0b24sIHRoaXMpOwogICAgICB2YXIgX3JlZjcsCiAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICBMYW5ndWFnZXNNZW51Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBpZiAoKF9yZWY3ID0gTGFuZ3VhZ2VNYW5hZ2VyLmN1cnJlbnQpICE9IG51bGwpIHsKICAgICAgICBfcmVmNy5vbignY2hhbmdlLWxhbmd1YWdlJywgZnVuY3Rpb24oZSwgY29kZSkgewogICAgICAgICAgcmV0dXJuIF90aGlzLnNldExhbmd1YWdlQnV0dG9uKGNvZGUpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgTGFuZ3VhZ2VzTWVudS5wcm90b3R5cGUub25DbGlja0xhbmd1YWdlQnV0dG9uID0gZnVuY3Rpb24oZSkgewogICAgICB2YXIgX3JlZjc7CiAgICAgIGlmICgoX3JlZjcgPSBMYW5ndWFnZU1hbmFnZXIuY3VycmVudCkgIT0gbnVsbCkgewogICAgICAgIF9yZWY3LnNldExhbmd1YWdlKGUuY3VycmVudFRhcmdldC52YWx1ZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIERyb3Bkb3duLmNsb3NlQWxsKCk7CiAgICB9OwoKICAgIExhbmd1YWdlc01lbnUucHJvdG90eXBlLnNldExhbmd1YWdlQnV0dG9uID0gZnVuY3Rpb24oY29kZSkgewogICAgICB2YXIgYnV0dG9ucywgdGFyZ2V0OwogICAgICB0YXJnZXQgPSB0aGlzLmVsLmZpbmQoJ2J1dHRvblt2YWx1ZT0iJyArIGNvZGUgKyAnIl0nKTsKICAgICAgaWYgKHRhcmdldC5sZW5ndGggIT09IDApIHsKICAgICAgICBidXR0b25zID0gdGhpcy5lbC5maW5kKCdidXR0b25bbmFtZT0ibGFuZ3VhZ2UiXScpOwogICAgICAgIGJ1dHRvbnMucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwogICAgICAgIHJldHVybiB0YXJnZXQuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBMYW5ndWFnZXNNZW51OwoKICB9KShDb250cm9sbGVyKTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLmNvbnRyb2xsZXJzID09IG51bGwpIHsKICAgIF9iYXNlLmNvbnRyb2xsZXJzID0ge307CiAgfQoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5MYW5ndWFnZXNNZW51ID0gTGFuZ3VhZ2VzTWVudTsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBMYW5ndWFnZXNNZW51OwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyICQsIENvbnRyb2xsZXIsIERyb3Bkb3duLCBHcm91cHNNZW51LCBVc2VyLCB0ZW1wbGF0ZSwgX2Jhc2UsIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjMsIF9yZWY0LCBfcmVmNSwgX3JlZjYsIF9yZWY3LAogICAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07CgogIENvbnRyb2xsZXIgPSAoKF9yZWYgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMSA9IF9yZWYuY29udHJvbGxlcnMpICE9IG51bGwgPyBfcmVmMS5CYXNlQ29udHJvbGxlciA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi9iYXNlLWNvbnRyb2xsZXInKTsKCiAgVXNlciA9ICgoX3JlZjIgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMyA9IF9yZWYyLm1vZGVscykgIT0gbnVsbCA/IF9yZWYzLlVzZXIgOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL21vZGVscy91c2VyJyk7CgogIHRlbXBsYXRlID0gKChfcmVmNCA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWY1ID0gX3JlZjQudmlld3MpICE9IG51bGwgPyBfcmVmNS5ncm91cHNNZW51IDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi92aWV3cy9ncm91cHMtbWVudScpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgRHJvcGRvd24gPSAoKF9yZWY2ID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjcgPSBfcmVmNi5jb250cm9sbGVycykgIT0gbnVsbCA/IF9yZWY3LkRyb3Bkb3duIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL2Ryb3Bkb3duJyk7CgogIEdyb3Vwc01lbnUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoR3JvdXBzTWVudSwgX3N1cGVyKTsKCiAgICBHcm91cHNNZW51LnByb3RvdHlwZS5jbGFzc05hbWUgPSAnem9vbml2ZXJzZS1ncm91cHMtbWVudSc7CgogICAgR3JvdXBzTWVudS5wcm90b3R5cGUuZXZlbnRzID0gewogICAgICAnY2xpY2sgYnV0dG9uW25hbWU9InVzZXItZ3JvdXAiXSc6ICdvbkNsaWNrR3JvdXBCdXR0b24nCiAgICB9OwoKICAgIGZ1bmN0aW9uIEdyb3Vwc01lbnUoKSB7CiAgICAgIHRoaXMub25Vc2VyQ2hhbmdlR3JvdXAgPSBfX2JpbmQodGhpcy5vblVzZXJDaGFuZ2VHcm91cCwgdGhpcyk7CiAgICAgIHRoaXMub25Vc2VyQ2hhbmdlID0gX19iaW5kKHRoaXMub25Vc2VyQ2hhbmdlLCB0aGlzKTsKICAgICAgR3JvdXBzTWVudS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgVXNlci5vbignY2hhbmdlJywgdGhpcy5vblVzZXJDaGFuZ2UpOwogICAgICBVc2VyLm9uKCdjaGFuZ2UtZ3JvdXAnLCB0aGlzLm9uVXNlckNoYW5nZUdyb3VwKTsKICAgIH0KCiAgICBHcm91cHNNZW51LnByb3RvdHlwZS5vblVzZXJDaGFuZ2UgPSBmdW5jdGlvbihlLCB1c2VyKSB7CiAgICAgIGlmICh1c2VyICE9IG51bGwpIHsKICAgICAgICB0aGlzLmVsLmh0bWwodGVtcGxhdGUodXNlcikpOwogICAgICAgIGlmICh1c2VyLnVzZXJfZ3JvdXBfaWQpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmVsLmZpbmQoImJ1dHRvbltuYW1lPSciICsgdXNlci51c2VyX2dyb3VwX2lkICsgIiddIikuY2xpY2soKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgR3JvdXBzTWVudS5wcm90b3R5cGUub25Vc2VyQ2hhbmdlR3JvdXAgPSBmdW5jdGlvbihlLCB1c2VyLCBncm91cCkgewogICAgICB2YXIgYnV0dG9uczsKICAgICAgYnV0dG9ucyA9IHRoaXMuZWwuZmluZCgnYnV0dG9uW25hbWU9InVzZXItZ3JvdXAiXScpOwogICAgICBidXR0b25zLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHsKICAgICAgICByZXR1cm4gYnV0dG9ucy5maWx0ZXIoIlt2YWx1ZT0nIiArIGdyb3VwLmlkICsgIiddIikuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB9CiAgICB9OwoKICAgIEdyb3Vwc01lbnUucHJvdG90eXBlLm9uQ2xpY2tHcm91cEJ1dHRvbiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIHRhcmdldCwgX3JlZjg7CiAgICAgIHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTsKICAgICAgaWYgKChfcmVmOCA9IFVzZXIuY3VycmVudCkgIT0gbnVsbCkgewogICAgICAgIF9yZWY4LnNldEdyb3VwKHRhcmdldC52YWwoKSB8fCAnVE9ET19IT1dfRE9fSV9TVE9QX0NMQVNTSUZZSU5HX0FTX1BBUlRfT0ZfQV9HUk9VUCcpOwogICAgICB9CiAgICAgIHJldHVybiBEcm9wZG93bi5jbG9zZUFsbCgpOwogICAgfTsKCiAgICByZXR1cm4gR3JvdXBzTWVudTsKCiAgfSkoQ29udHJvbGxlcik7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5jb250cm9sbGVycyA9PSBudWxsKSB7CiAgICBfYmFzZS5jb250cm9sbGVycyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UuY29udHJvbGxlcnMuR3JvdXBzTWVudSA9IEdyb3Vwc01lbnU7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gR3JvdXBzTWVudTsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBBcGksIEJhc2VDb250cm9sbGVyLCBEcm9wZG93biwgR3JvdXBzTWVudSwgTGFuZ3VhZ2VNYW5hZ2VyLCBMYW5ndWFnZXNNZW51LCBUb3BCYXIsIFVzZXIsIGRlZmF1bHRUYWxrUHJvZmlsZUhyZWYsIGxvZ2luRGlhbG9nLCBzaWdudXBEaWFsb2csIHRlbXBsYXRlLCBfYmFzZSwgX2Jhc2UxLCBfYmFzZTIsIF9iYXNlMywKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTIgPSB3aW5kb3cuem9vbml2ZXJzZSkubGliID09IG51bGwpIHsKICAgIF9iYXNlMi5saWIgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UzID0gd2luZG93Lnpvb25pdmVyc2UpLm1vZGVscyA9PSBudWxsKSB7CiAgICBfYmFzZTMubW9kZWxzID0ge307CiAgfQoKICBCYXNlQ29udHJvbGxlciA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuQmFzZUNvbnRyb2xsZXIgfHwgcmVxdWlyZSgnLi9iYXNlLWNvbnRyb2xsZXInKTsKCiAgbG9naW5EaWFsb2cgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLmxvZ2luRGlhbG9nIHx8IHJlcXVpcmUoJy4vbG9naW4tZGlhbG9nJyk7CgogIHNpZ251cERpYWxvZyA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuc2lnbnVwRGlhbG9nIHx8IHJlcXVpcmUoJy4vc2lnbnVwLWRpYWxvZycpOwoKICB0ZW1wbGF0ZSA9IHpvb25pdmVyc2Uudmlld3MudG9wQmFyIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL3RvcC1iYXInKTsKCiAgRHJvcGRvd24gPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkRyb3Bkb3duIHx8IHJlcXVpcmUoJy4vZHJvcGRvd24nKTsKCiAgR3JvdXBzTWVudSA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuR3JvdXBzTWVudSB8fCByZXF1aXJlKCcuL2dyb3Vwcy1tZW51Jyk7CgogIExhbmd1YWdlTWFuYWdlciA9IHpvb25pdmVyc2UuTGFuZ3VhZ2VNYW5hZ2VyIHx8IHJlcXVpcmUoJy4uL2xpYi9sYW5ndWFnZS1tYW5hZ2VyJyk7CgogIExhbmd1YWdlc01lbnUgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkxhbmd1YWdlc01lbnUgfHwgcmVxdWlyZSgnLi9sYW5ndWFnZXMtbWVudScpOwoKICBBcGkgPSB6b29uaXZlcnNlLkFwaSB8fCByZXF1aXJlKCcuLi9saWIvYXBpJyk7CgogIFVzZXIgPSB6b29uaXZlcnNlLm1vZGVscy5Vc2VyIHx8IHJlcXVpcmUoJy4uL21vZGVscy91c2VyJyk7CgogIGRlZmF1bHRUYWxrUHJvZmlsZUhyZWYgPSAiaHR0cDovL3RhbGsuIiArIChsb2NhdGlvbi5ob3N0bmFtZS5yZXBsYWNlKC9ed3d3XC4vLCAnJykpICsgIi8jL3Byb2ZpbGUiOwoKICBUb3BCYXIgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoVG9wQmFyLCBfc3VwZXIpOwoKICAgIFRvcEJhci5wcm90b3R5cGUuY2xhc3NOYW1lID0gJ3pvb25pdmVyc2UtdG9wLWJhcic7CgogICAgVG9wQmFyLnByb3RvdHlwZS50ZW1wbGF0ZSA9IHRlbXBsYXRlOwoKICAgIFRvcEJhci5wcm90b3R5cGUubWVzc2FnZUNoZWNrVGltZW91dCA9IDIgKiA2MCAqIDEwMDA7CgogICAgVG9wQmFyLnByb3RvdHlwZS50YWxrUHJvZmlsZUhyZWYgPSBkZWZhdWx0VGFsa1Byb2ZpbGVIcmVmOwoKICAgIFRvcEJhci5wcm90b3R5cGUuZXZlbnRzID0gewogICAgICAnY2xpY2sgYnV0dG9uW25hbWU9InNpZ24taW4iXSc6ICdvbkNsaWNrU2lnbkluJywKICAgICAgJ2NsaWNrIGJ1dHRvbltuYW1lPSJzaWduLXVwIl0nOiAnb25DbGlja1NpZ25VcCcsCiAgICAgICdjbGljayBidXR0b25bbmFtZT0ic2lnbi1vdXQiXSc6ICdvbkNsaWNrU2lnbk91dCcKICAgIH07CgogICAgVG9wQmFyLnByb3RvdHlwZS5lbGVtZW50cyA9IHsKICAgICAgJy5jdXJyZW50LXVzZXItbmFtZSc6ICdjdXJyZW50VXNlck5hbWUnLAogICAgICAnYnV0dG9uW25hbWU9Imdyb3VwcyJdJzogJ2dyb3Vwc01lbnVCdXR0b24nLAogICAgICAnYnV0dG9uW25hbWU9Imxhbmd1YWdlcy1tZW51LXRvZ2dsZSJdJzogJ2xhbmd1YWdlc01lbnVCdXR0b24nLAogICAgICAnLm1lc3NhZ2UtY291bnQnOiAnbWVzc2FnZUNvdW50JywKICAgICAgJy5hdmF0YXIgaW1nJzogJ2F2YXRhckltYWdlJywKICAgICAgJy5ncm91cCc6ICdjdXJyZW50R3JvdXAnCiAgICB9OwoKICAgIGZ1bmN0aW9uIFRvcEJhcigpIHsKICAgICAgdGhpcy5vbkxhbmd1YWdlQ2hhbmdlID0gX19iaW5kKHRoaXMub25MYW5ndWFnZUNoYW5nZSwgdGhpcyk7CiAgICAgIHRoaXMub25Vc2VyQ2hhbmdlR3JvdXAgPSBfX2JpbmQodGhpcy5vblVzZXJDaGFuZ2VHcm91cCwgdGhpcyk7CiAgICAgIHRoaXMuZ2V0TWVzc2FnZXMgPSBfX2JpbmQodGhpcy5nZXRNZXNzYWdlcywgdGhpcyk7CiAgICAgIHRoaXMub25Vc2VyQ2hhbmdlID0gX19iaW5kKHRoaXMub25Vc2VyQ2hhbmdlLCB0aGlzKTsKICAgICAgVG9wQmFyLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB0aGlzLmdyb3Vwc01lbnUgPSBuZXcgR3JvdXBzTWVudTsKICAgICAgdGhpcy5ncm91cHNEcm9wZG93biA9IG5ldyBEcm9wZG93bih7CiAgICAgICAgYnV0dG9uOiB0aGlzLmdyb3Vwc01lbnVCdXR0b24uZ2V0KDApLAogICAgICAgIGJ1dHRvblBpbm5pbmc6IFsxLCAxXSwKICAgICAgICBtZW51OiB0aGlzLmdyb3Vwc01lbnUuZWwuZ2V0KDApLAogICAgICAgIG1lbnVDbGFzczogJ2Zyb20tdG9wLWJhcicsCiAgICAgICAgbWVudVBpbm5pbmc6IFsxLCAwXQogICAgICB9KTsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnaGFzLWxhbmd1YWdlcycsIExhbmd1YWdlTWFuYWdlci5jdXJyZW50ICE9IG51bGwpOwogICAgICBpZiAoTGFuZ3VhZ2VNYW5hZ2VyLmN1cnJlbnQgIT0gbnVsbCkgewogICAgICAgIHRoaXMub25MYW5ndWFnZUNoYW5nZSgpOwogICAgICAgIExhbmd1YWdlTWFuYWdlci5vbignY2hhbmdlLWxhbmd1YWdlJywgdGhpcy5vbkxhbmd1YWdlQ2hhbmdlKTsKICAgICAgICB0aGlzLmxhbmd1YWdlc01lbnUgPSBuZXcgTGFuZ3VhZ2VzTWVudSgpOwogICAgICAgIHRoaXMubGFuZ3VhZ2VzRHJvcGRvd24gPSBuZXcgRHJvcGRvd24oewogICAgICAgICAgYnV0dG9uOiB0aGlzLmxhbmd1YWdlc01lbnVCdXR0b24uZ2V0KDApLAogICAgICAgICAgYnV0dG9uUGlubmluZzogWzEsIDFdLAogICAgICAgICAgbWVudTogdGhpcy5sYW5ndWFnZXNNZW51LmVsLmdldCgwKSwKICAgICAgICAgIG1lbnVDbGFzczogJ2Zyb20tdG9wLWJhcicsCiAgICAgICAgICBtZW51UGlubmluZzogWzEsIDBdCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgVXNlci5vbignY2hhbmdlJywgdGhpcy5vblVzZXJDaGFuZ2UpOwogICAgICBVc2VyLm9uKCdjaGFuZ2UtZ3JvdXAnLCB0aGlzLm9uVXNlckNoYW5nZUdyb3VwKTsKICAgIH0KCiAgICBUb3BCYXIucHJvdG90eXBlLm9uQ2xpY2tTaWduSW4gPSBmdW5jdGlvbigpIHsKICAgICAgc2lnbnVwRGlhbG9nLmhpZGUoKTsKICAgICAgcmV0dXJuIGxvZ2luRGlhbG9nLnNob3coKTsKICAgIH07CgogICAgVG9wQmFyLnByb3RvdHlwZS5vbkNsaWNrU2lnblVwID0gZnVuY3Rpb24oKSB7CiAgICAgIGxvZ2luRGlhbG9nLmhpZGUoKTsKICAgICAgcmV0dXJuIHNpZ251cERpYWxvZy5zaG93KCk7CiAgICB9OwoKICAgIFRvcEJhci5wcm90b3R5cGUub25DbGlja1NpZ25PdXQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIFVzZXIubG9nb3V0KCk7CiAgICB9OwoKICAgIFRvcEJhci5wcm90b3R5cGUub25Vc2VyQ2hhbmdlID0gZnVuY3Rpb24oZSwgdXNlcikgewogICAgICB2YXIgX3JlZjsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnc2lnbmVkLWluJywgdXNlciAhPSBudWxsKTsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnaGFzLWdyb3VwcycsICh1c2VyICE9IG51bGwgPyAoX3JlZiA9IHVzZXIudXNlcl9ncm91cHMpICE9IG51bGwgPyBfcmVmLmxlbmd0aCA6IHZvaWQgMCA6IHZvaWQgMCkgPiAwKTsKICAgICAgdGhpcy5vblVzZXJDaGFuZ2VHcm91cChlLCB1c2VyICE9IG51bGwsIHVzZXIgIT0gbnVsbCA/IHVzZXIudXNlcl9ncm91cF9pZCA6IHZvaWQgMCk7CiAgICAgIHRoaXMuZ2V0TWVzc2FnZXMoKTsKICAgICAgdGhpcy5jdXJyZW50VXNlck5hbWUuaHRtbCgodXNlciAhPSBudWxsID8gdXNlci5uYW1lIDogdm9pZCAwKSB8fCAnJyk7CiAgICAgIHJldHVybiB0aGlzLmF2YXRhckltYWdlLmF0dHIoewogICAgICAgIHNyYzogdXNlciAhPSBudWxsID8gdXNlci5hdmF0YXIgOiB2b2lkIDAKICAgICAgfSk7CiAgICB9OwoKICAgIFRvcEJhci5wcm90b3R5cGUuZ2V0TWVzc2FnZXMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgaWYgKFVzZXIuY3VycmVudCAhPSBudWxsKSB7CiAgICAgICAgcmV0dXJuIEFwaS5jdXJyZW50LmdldCgnL3RhbGsvbWVzc2FnZXMvY291bnQnLCBmdW5jdGlvbihtZXNzYWdlcykgewogICAgICAgICAgX3RoaXMuZWwudG9nZ2xlQ2xhc3MoJ2hhcy1tZXNzYWdlcycsIG1lc3NhZ2VzICE9PSAwKTsKICAgICAgICAgIF90aGlzLm1lc3NhZ2VDb3VudC5odG1sKG1lc3NhZ2VzKTsKICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KF90aGlzLmdldE1lc3NhZ2VzLCBfdGhpcy5tZXNzYWdlQ2hlY2tUaW1lb3V0KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVsLnJlbW92ZUNsYXNzKCdoYXMtbWVzc2FnZXMnKTsKICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlQ291bnQuaHRtbCgnMCcpOwogICAgICB9CiAgICB9OwoKICAgIFRvcEJhci5wcm90b3R5cGUub25Vc2VyQ2hhbmdlR3JvdXAgPSBmdW5jdGlvbihlLCB1c2VyLCBncm91cCkgewogICAgICByZXR1cm4gdGhpcy5lbC50b2dnbGVDbGFzcygnZ3JvdXAtcGFydGljaXBhbnQnLCBncm91cCAhPSBudWxsKTsKICAgIH07CgogICAgVG9wQmFyLnByb3RvdHlwZS5vbkxhbmd1YWdlQ2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfcmVmOwogICAgICByZXR1cm4gdGhpcy5sYW5ndWFnZXNNZW51QnV0dG9uLmh0bWwoKF9yZWYgPSBMYW5ndWFnZU1hbmFnZXIuY3VycmVudCkgIT0gbnVsbCA/IF9yZWYubGFiZWwoKSA6IHZvaWQgMCk7CiAgICB9OwoKICAgIHJldHVybiBUb3BCYXI7CgogIH0pKEJhc2VDb250cm9sbGVyKTsKCiAgd2luZG93Lnpvb25pdmVyc2UuY29udHJvbGxlcnMuVG9wQmFyID0gVG9wQmFyOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFRvcEJhcjsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBCYXNlQ29udHJvbGxlciwgUGFnaW5hdG9yLCBVc2VyLCB0ZW1wbGF0ZSwgX2Jhc2UsIF9iYXNlMSwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgQmFzZUNvbnRyb2xsZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICB0ZW1wbGF0ZSA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzLnBhZ2luYXRvciB8fCByZXF1aXJlKCcuLi92aWV3cy9wYWdpbmF0b3InKTsKCiAgVXNlciA9IHdpbmRvdy56b29uaXZlcnNlLm1vZGVscy5Vc2VyIHx8IHJlcXVpcmUoJy4uL21vZGVscy91c2VyJyk7CgogICQgPSB3aW5kb3cualF1ZXJ5OwoKICBQYWdpbmF0b3IgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoUGFnaW5hdG9yLCBfc3VwZXIpOwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUudHlwZSA9IG51bGw7CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5pdGVtVGVtcGxhdGUgPSBudWxsOwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUuY2xhc3NOYW1lID0gJ3pvb25pdmVyc2UtcGFnaW5hdG9yJzsKCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLnRlbXBsYXRlID0gdGVtcGxhdGU7CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5wYWdlcyA9IDA7CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5wZXJQYWdlID0gMTA7CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5ldmVudHMgPSB7CiAgICAgICdjbGljayBidXR0b25bbmFtZT0icGFnZSJdJzogJ29uQ2xpY2tQYWdlJwogICAgfTsKCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLmVsZW1lbnRzID0gewogICAgICAnLml0ZW1zJzogJ2l0ZW1zQ29udGFpbmVyJywKICAgICAgJy5udW1iZXJlZCc6ICdudW1iZXJzQ29udGFpbmVyJwogICAgfTsKCiAgICBmdW5jdGlvbiBQYWdpbmF0b3IoKSB7CiAgICAgIHRoaXMub25JdGVtRGVzdHJveWVkID0gX19iaW5kKHRoaXMub25JdGVtRGVzdHJveWVkLCB0aGlzKTsKICAgICAgdGhpcy5vbkl0ZW1Gcm9tQ2xhc3NpZmljYXRpb24gPSBfX2JpbmQodGhpcy5vbkl0ZW1Gcm9tQ2xhc3NpZmljYXRpb24sIHRoaXMpOwogICAgICB0aGlzLm9uRmV0Y2hGYWlsID0gX19iaW5kKHRoaXMub25GZXRjaEZhaWwsIHRoaXMpOwogICAgICB0aGlzLmFkZEl0ZW1Ub0NvbnRhaW5lciA9IF9fYmluZCh0aGlzLmFkZEl0ZW1Ub0NvbnRhaW5lciwgdGhpcyk7CiAgICAgIHRoaXMub25GZXRjaCA9IF9fYmluZCh0aGlzLm9uRmV0Y2gsIHRoaXMpOwogICAgICB0aGlzLm9uVXNlckNoYW5nZSA9IF9fYmluZCh0aGlzLm9uVXNlckNoYW5nZSwgdGhpcyk7CiAgICAgIFBhZ2luYXRvci5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgVXNlci5vbignY2hhbmdlJywgdGhpcy5vblVzZXJDaGFuZ2UpOwogICAgICB0aGlzLnR5cGUub24oJ2Zyb20tY2xhc3NpZmljYXRpb24nLCB0aGlzLm9uSXRlbUZyb21DbGFzc2lmaWNhdGlvbik7CiAgICAgIHRoaXMudHlwZS5vbignZGVzdHJveScsIHRoaXMub25JdGVtRGVzdHJveWVkKTsKICAgIH0KCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLm9uVXNlckNoYW5nZSA9IGZ1bmN0aW9uKGUsIHVzZXIpIHsKICAgICAgdGhpcy5yZXNldCh0aGlzLnR5cGVDb3VudCgpKTsKICAgICAgdGhpcy5vbkZldGNoKFtdKTsKICAgICAgaWYgKHVzZXIgIT0gbnVsbCkgewogICAgICAgIHJldHVybiB0aGlzLmdvVG8oMSk7CiAgICAgIH0KICAgIH07CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKGl0ZW1Db3VudCkgewogICAgICB2YXIgYnV0dG9uLCBpLCBfaSwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIHRoaXMucGFnZXMgPSBNYXRoLmNlaWwoaXRlbUNvdW50IC8gdGhpcy5wZXJQYWdlKTsKICAgICAgdGhpcy5udW1iZXJzQ29udGFpbmVyLmVtcHR5KCk7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoaSA9IF9pID0gMCwgX3JlZiA9IHRoaXMucGFnZXM7IDAgPD0gX3JlZiA/IF9pIDwgX3JlZiA6IF9pID4gX3JlZjsgaSA9IDAgPD0gX3JlZiA/ICsrX2kgOiAtLV9pKSB7CiAgICAgICAgYnV0dG9uID0gJCgiPGJ1dHRvbiBuYW1lPSdwYWdlJyB2YWx1ZT0nIiArIChpICsgMSkgKyAiJz4iICsgKGkgKyAxKSArICI8L2J1dHRvbj4iKTsKICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMubnVtYmVyc0NvbnRhaW5lci5hcHBlbmQoYnV0dG9uKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLm9uQ2xpY2tQYWdlID0gZnVuY3Rpb24oX2FyZykgewogICAgICB2YXIgcGFnZSwgdGFyZ2V0OwogICAgICB0YXJnZXQgPSBfYXJnLnRhcmdldDsKICAgICAgcGFnZSA9ICskKHRhcmdldCkudmFsKCk7CiAgICAgIHJldHVybiB0aGlzLmdvVG8ocGFnZSk7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUuZ29UbyA9IGZ1bmN0aW9uKHBhZ2UpIHsKICAgICAgdmFyIGZldGNoLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgcGFnZSA9IE1hdGgubWF4KHBhZ2UsIDEpOwogICAgICB0aGlzLmVsLnJlbW92ZUNsYXNzKCdmYWlsZWQnKTsKICAgICAgdGhpcy5udW1iZXJzQ29udGFpbmVyLmNoaWxkcmVuKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB0aGlzLm51bWJlcnNDb250YWluZXIuY2hpbGRyZW4oIlt2YWx1ZT0nIiArIHBhZ2UgKyAiJ10iKS5hZGRDbGFzcygnYWN0aXZlJyk7CiAgICAgIHRoaXMuZWwuYWRkQ2xhc3MoJ2xvYWRpbmcnKTsKICAgICAgZmV0Y2ggPSB0aGlzLnR5cGUuZmV0Y2goewogICAgICAgIHBhZ2U6IHBhZ2UsCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyUGFnZQogICAgICB9KTsKICAgICAgZmV0Y2gudGhlbih0aGlzLm9uRmV0Y2gsIHRoaXMub25GZXRjaEZhaWwpOwogICAgICByZXR1cm4gZmV0Y2guYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5lbC5yZW1vdmVDbGFzcygnbG9hZGluZycpOwogICAgICB9KTsKICAgIH07CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS50eXBlQ291bnQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9yZWYsIF9yZWYxOwogICAgICByZXR1cm4gKChfcmVmID0gVXNlci5jdXJyZW50KSAhPSBudWxsID8gKF9yZWYxID0gX3JlZi5wcm9qZWN0KSAhPSBudWxsID8gX3JlZjEuY2xhc3NpZmljYXRpb25fY291bnQgOiB2b2lkIDAgOiB2b2lkIDApIHx8IDA7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUub25GZXRjaCA9IGZ1bmN0aW9uKGl0ZW1zKSB7CiAgICAgIHZhciBpdGVtLCBfaSwgX2xlbiwgX3Jlc3VsdHM7CiAgICAgIHRoaXMuaXRlbXNDb250YWluZXIuZW1wdHkoKTsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnZW1wdHknLCBpdGVtcy5sZW5ndGggPT09IDApOwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGl0ZW1zLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgaXRlbSA9IGl0ZW1zW19pXTsKICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMuYWRkSXRlbVRvQ29udGFpbmVyKGl0ZW0pKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUuZ2V0SXRlbUVsID0gZnVuY3Rpb24oaXRlbSkgewogICAgICB2YXIgaW5uZXIsIGl0ZW1FbCwgX3JlZiwgX3JlZjE7CiAgICAgIGl0ZW1FbCA9IHRoaXMuaXRlbXNDb250YWluZXIuZmluZCgiW2RhdGEtaXRlbS1pZD0nIiArIGl0ZW0uaWQgKyAiJ10iKTsKICAgICAgaWYgKGl0ZW1FbC5sZW5ndGggPT09IDApIHsKICAgICAgICBpbm5lciA9IHRoaXMuaXRlbVRlbXBsYXRlICE9IG51bGwgPyB0aGlzLml0ZW1UZW1wbGF0ZShpdGVtKSA6ICI8ZGl2IGNsYXNzPSdpdGVtJz48YSBocmVmPVwiIiArICgoKF9yZWYgPSBpdGVtLnN1YmplY3RzWzBdKSAhPSBudWxsID8gX3JlZi50YWxrSHJlZigpIDogdm9pZCAwKSB8fCAnIy9TVUJKRUNULUVSUk9SJykgKyAiXCI+IiArICgoKF9yZWYxID0gaXRlbS5zdWJqZWN0c1swXSkgIT0gbnVsbCA/IF9yZWYxLnpvb25pdmVyc2VfaWQgOiB2b2lkIDApIHx8ICdFcnJvciBpbiBzdWJqZWN0JykgKyAiPC9hPjwvZGl2PiI7CiAgICAgICAgaXRlbUVsID0gJCgkLnRyaW0oaW5uZXIpKTsKICAgICAgICBpdGVtRWwuYXR0cih7CiAgICAgICAgICAnZGF0YS1pdGVtLWlkJzogaXRlbS5pZAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBpdGVtRWw7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUuYWRkSXRlbVRvQ29udGFpbmVyID0gZnVuY3Rpb24oaXRlbSkgewogICAgICB2YXIgaXRlbUVsOwogICAgICBpdGVtRWwgPSB0aGlzLmdldEl0ZW1FbChpdGVtKTsKICAgICAgaXRlbUVsLnByZXBlbmRUbyh0aGlzLml0ZW1zQ29udGFpbmVyKTsKICAgICAgcmV0dXJuIGl0ZW1FbDsKICAgIH07CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5vbkZldGNoRmFpbCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5lbC5hZGRDbGFzcygnZmFpbGVkJyk7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUub25JdGVtRnJvbUNsYXNzaWZpY2F0aW9uID0gZnVuY3Rpb24oZSwgaXRlbSkgewogICAgICB2YXIgX3Jlc3VsdHM7CiAgICAgIHRoaXMuYWRkSXRlbVRvQ29udGFpbmVyKGl0ZW0pLmFkZENsYXNzKCduZXcnKTsKICAgICAgaWYgKHRoaXMuaXRlbXNDb250YWluZXIuY2hpbGRyZW4oKS5sZW5ndGggPiB0aGlzLnBlclBhZ2UpIHsKICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgIHdoaWxlICh0aGlzLml0ZW1zQ29udGFpbmVyLmNoaWxkcmVuKCkubGVuZ3RoICE9PSB0aGlzLnBlclBhZ2UpIHsKICAgICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5pdGVtc0NvbnRhaW5lci5jaGlsZHJlbigpLmxhc3QoKS5yZW1vdmUoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfQogICAgfTsKCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLm9uSXRlbURlc3Ryb3llZCA9IGZ1bmN0aW9uKGUsIGl0ZW0pIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0SXRlbUVsKGl0ZW0pLnJlbW92ZSgpOwogICAgfTsKCiAgICByZXR1cm4gUGFnaW5hdG9yOwoKICB9KShCYXNlQ29udHJvbGxlcik7CgogIHdpbmRvdy56b29uaXZlcnNlLmNvbnRyb2xsZXJzLlBhZ2luYXRvciA9IFBhZ2luYXRvcjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBQYWdpbmF0b3I7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgQmFzZUNvbnRyb2xsZXIsIEZhdm9yaXRlLCBMb2dpbkZvcm0sIFBhZ2luYXRvciwgUHJvZmlsZSwgUHJvZmlsZVBhZ2luYXRvciwgUmVjZW50LCBVc2VyLCBpdGVtVGVtcGxhdGUsIHRlbXBsYXRlLCBfYmFzZSwgX2Jhc2UxLCBfcmVmLAogICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksCiAgICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLmNvbnRyb2xsZXJzID09IG51bGwpIHsKICAgIF9iYXNlLmNvbnRyb2xsZXJzID0ge307CiAgfQoKICBpZiAoKF9iYXNlMSA9IHdpbmRvdy56b29uaXZlcnNlKS52aWV3cyA9PSBudWxsKSB7CiAgICBfYmFzZTEudmlld3MgPSB7fTsKICB9CgogIEJhc2VDb250cm9sbGVyID0gem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICB0ZW1wbGF0ZSA9IHpvb25pdmVyc2Uudmlld3MucHJvZmlsZSB8fCByZXF1aXJlKCcuLi92aWV3cy9wcm9maWxlJyk7CgogIExvZ2luRm9ybSA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuTG9naW5Gb3JtIHx8IHJlcXVpcmUoJ3pvb25pdmVyc2UvY29udHJvbGxlcnMvbG9naW4tZm9ybScpOwoKICBQYWdpbmF0b3IgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLlBhZ2luYXRvciB8fCByZXF1aXJlKCcuL3BhZ2luYXRvcicpOwoKICBSZWNlbnQgPSB6b29uaXZlcnNlLm1vZGVscy5SZWNlbnQgfHwgcmVxdWlyZSgnLi4vbW9kZWxzL3JlY2VudCcpOwoKICBGYXZvcml0ZSA9IHpvb25pdmVyc2UubW9kZWxzLkZhdm9yaXRlIHx8IHJlcXVpcmUoJy4uL21vZGVscy9mYXZvcml0ZScpOwoKICBpdGVtVGVtcGxhdGUgPSB6b29uaXZlcnNlLnZpZXdzLnByb2ZpbGVJdGVtIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL3Byb2ZpbGUtaXRlbScpOwoKICBVc2VyID0gem9vbml2ZXJzZS5tb2RlbHMuVXNlciB8fCByZXF1aXJlKCcuLi9tb2RlbHMvdXNlcicpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgUHJvZmlsZVBhZ2luYXRvciA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhQcm9maWxlUGFnaW5hdG9yLCBfc3VwZXIpOwoKICAgIGZ1bmN0aW9uIFByb2ZpbGVQYWdpbmF0b3IoKSB7CiAgICAgIF9yZWYgPSBQcm9maWxlUGFnaW5hdG9yLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gX3JlZjsKICAgIH0KCiAgICBQcm9maWxlUGFnaW5hdG9yLnByb3RvdHlwZS50eXBlQ291bnQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGNvdW50LCBfcmVmMSwgX3JlZjIsIF9yZWYzLCBfcmVmNDsKICAgICAgY291bnQgPSB0aGlzLnR5cGUgPT09IFJlY2VudCA/IChfcmVmMSA9IFVzZXIuY3VycmVudCkgIT0gbnVsbCA/IChfcmVmMiA9IF9yZWYxLnByb2plY3QpICE9IG51bGwgPyBfcmVmMi5jbGFzc2lmaWNhdGlvbl9jb3VudCA6IHZvaWQgMCA6IHZvaWQgMCA6IHRoaXMudHlwZSA9PT0gRmF2b3JpdGUgPyAoX3JlZjMgPSBVc2VyLmN1cnJlbnQpICE9IG51bGwgPyAoX3JlZjQgPSBfcmVmMy5wcm9qZWN0KSAhPSBudWxsID8gX3JlZjQuZmF2b3JpdGVfY291bnQgOiB2b2lkIDAgOiB2b2lkIDAgOiBQcm9maWxlUGFnaW5hdG9yLl9fc3VwZXJfXy50eXBlQ291bnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIGNvdW50IHx8IDA7CiAgICB9OwoKICAgIHJldHVybiBQcm9maWxlUGFnaW5hdG9yOwoKICB9KShQYWdpbmF0b3IpOwoKICBQcm9maWxlID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKFByb2ZpbGUsIF9zdXBlcik7CgogICAgUHJvZmlsZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gJ3pvb25pdmVyc2UtcHJvZmlsZSc7CgogICAgUHJvZmlsZS5wcm90b3R5cGUudGVtcGxhdGUgPSB0ZW1wbGF0ZTsKCiAgICBQcm9maWxlLnByb3RvdHlwZS5yZWNlbnRUZW1wbGF0ZSA9IGl0ZW1UZW1wbGF0ZTsKCiAgICBQcm9maWxlLnByb3RvdHlwZS5mYXZvcml0ZVRlbXBsYXRlID0gaXRlbVRlbXBsYXRlOwoKICAgIFByb2ZpbGUucHJvdG90eXBlLmxvZ2luRm9ybSA9IG51bGw7CgogICAgUHJvZmlsZS5wcm90b3R5cGUucmVjZW50c0xpc3QgPSBudWxsOwoKICAgIFByb2ZpbGUucHJvdG90eXBlLmZhdm9yaXRlc0xpc3QgPSBudWxsOwoKICAgIFByb2ZpbGUucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ2NsaWNrIGJ1dHRvbltuYW1lPSJ1bmZhdm9yaXRlIl0nOiAnb25DbGlja1VuZmF2b3JpdGUnLAogICAgICAnY2xpY2sgYnV0dG9uW25hbWU9InR1cm4tcGFnZSJdJzogJ29uVHVyblBhZ2UnCiAgICB9OwoKICAgIFByb2ZpbGUucHJvdG90eXBlLmVsZW1lbnRzID0gewogICAgICAnbmF2JzogJ25hdmlnYXRpb24nLAogICAgICAnYnV0dG9uW25hbWU9InR1cm4tcGFnZSJdJzogJ3BhZ2VUdXJuZXJzJwogICAgfTsKCiAgICBmdW5jdGlvbiBQcm9maWxlKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBQcm9maWxlLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB0aGlzLmxvZ2luRm9ybSA9IG5ldyBMb2dpbkZvcm0oewogICAgICAgIGVsOiB0aGlzLmVsLmZpbmQoJy5zaWduLWluLWZvcm0nKQogICAgICB9KTsKICAgICAgdGhpcy5yZWNlbnRzTGlzdCA9IG5ldyBQcm9maWxlUGFnaW5hdG9yKHsKICAgICAgICB0eXBlOiBSZWNlbnQsCiAgICAgICAgcGVyUGFnZTogMTIsCiAgICAgICAgY2xhc3NOYW1lOiAiIiArIFBhZ2luYXRvci5wcm90b3R5cGUuY2xhc3NOYW1lICsgIiByZWNlbnRzIiwKICAgICAgICBlbDogdGhpcy5lbC5maW5kKCcucmVjZW50cycpLAogICAgICAgIGl0ZW1UZW1wbGF0ZTogdGhpcy5yZWNlbnRUZW1wbGF0ZQogICAgICB9KTsKICAgICAgdGhpcy5mYXZvcml0ZXNMaXN0ID0gbmV3IFByb2ZpbGVQYWdpbmF0b3IoewogICAgICAgIHR5cGU6IEZhdm9yaXRlLAogICAgICAgIHBlclBhZ2U6IDEyLAogICAgICAgIGNsYXNzTmFtZTogIiIgKyBQYWdpbmF0b3IucHJvdG90eXBlLmNsYXNzTmFtZSArICIgZmF2b3JpdGVzIiwKICAgICAgICBlbDogdGhpcy5lbC5maW5kKCcuZmF2b3JpdGVzJyksCiAgICAgICAgaXRlbVRlbXBsYXRlOiB0aGlzLmZhdm9yaXRlVGVtcGxhdGUKICAgICAgfSk7CiAgICAgIFVzZXIub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5vblVzZXJDaGFuZ2UuYXBwbHkoX3RoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0pOwogICAgfQoKICAgIFByb2ZpbGUucHJvdG90eXBlLm9uVXNlckNoYW5nZSA9IGZ1bmN0aW9uKGUsIHVzZXIpIHsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnc2lnbmVkLWluJywgdXNlciAhPSBudWxsKTsKICAgICAgcmV0dXJuIHRoaXMucGFnZVR1cm5lcnMuZmlyc3QoKS5jbGljaygpOwogICAgfTsKCiAgICBQcm9maWxlLnByb3RvdHlwZS5vbkNsaWNrVW5mYXZvcml0ZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIGZhdm9yaXRlLCBpZCwgdGFyZ2V0OwogICAgICB0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7CiAgICAgIGlkID0gdGFyZ2V0LnZhbCgpOwogICAgICBmYXZvcml0ZSA9IEZhdm9yaXRlLmZpbmQoaWQpOwogICAgICBmYXZvcml0ZVsiZGVsZXRlIl0oKTsKICAgICAgcmV0dXJuIHRhcmdldC5wYXJlbnRzKCdbZGF0YS1pdGVtLWlkXScpLmZpcnN0KCkucmVtb3ZlKCk7CiAgICB9OwoKICAgIFByb2ZpbGUucHJvdG90eXBlLm9uVHVyblBhZ2UgPSBmdW5jdGlvbihlKSB7CiAgICAgIHJldHVybiB0aGlzLnR1cm5QYWdlKCQoZS5jdXJyZW50VGFyZ2V0KS52YWwoKSk7CiAgICB9OwoKICAgIFByb2ZpbGUucHJvdG90eXBlLnR1cm5QYWdlID0gZnVuY3Rpb24odGFyZ2V0VHlwZSkgewogICAgICB0aGlzLnBhZ2VUdXJuZXJzLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgdGhpcy5wYWdlVHVybmVycy5maWx0ZXIoIlt2YWx1ZT1cIiIgKyB0YXJnZXRUeXBlICsgIlwiXSIpLmZpcnN0KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB0aGlzLnJlY2VudHNMaXN0LmVsLmFkZCh0aGlzLmZhdm9yaXRlc0xpc3QuZWwpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgcmV0dXJuIHRoaXNbIiIgKyB0YXJnZXRUeXBlICsgIkxpc3QiXS5lbC5hZGRDbGFzcygnYWN0aXZlJyk7CiAgICB9OwoKICAgIHJldHVybiBQcm9maWxlOwoKICB9KShCYXNlQ29udHJvbGxlcik7CgogIHdpbmRvdy56b29uaXZlcnNlLmNvbnRyb2xsZXJzLlByb2ZpbGUgPSBQcm9maWxlOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFByb2ZpbGU7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgJHdpbmRvdywgRm9vdGVyLCB0ZW1wbGF0ZSwgX2Jhc2UsIF9iYXNlMSwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5jb250cm9sbGVycyA9PSBudWxsKSB7CiAgICBfYmFzZS5jb250cm9sbGVycyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTEgPSB3aW5kb3cuem9vbml2ZXJzZSkudmlld3MgPT0gbnVsbCkgewogICAgX2Jhc2UxLnZpZXdzID0ge307CiAgfQoKICB0ZW1wbGF0ZSA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzLmZvb3RlciB8fCByZXF1aXJlKCcuLi92aWV3cy9mb290ZXInKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogICR3aW5kb3cgPSAkKHdpbmRvdyk7CgogIHdpbmRvdy5ERUZJTkVfWk9PTklWRVJTRV9QUk9KRUNUX0xJU1QgPSBmdW5jdGlvbihjYXRlZ29yaWVzKSB7CiAgICByZXR1cm4gJHdpbmRvdy50cmlnZ2VyKCdnZXQtem9vbml2ZXJzZS1wcm9qZWN0LWxpc3QnLCBbY2F0ZWdvcmllc10pOwogIH07CgogIEZvb3RlciA9IChmdW5jdGlvbigpIHsKICAgIEZvb3Rlci5wcm90b3R5cGUuZWwgPSBudWxsOwoKICAgIEZvb3Rlci5wcm90b3R5cGUucHJvamVjdFNjcmlwdCA9ICdodHRwOi8vem9vbml2ZXJzZS1kZW1vLnMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vcHJvamVjdHMuanMnOwoKICAgIGZ1bmN0aW9uIEZvb3RlcigpIHsKICAgICAgdGhpcy5vbkZldGNoID0gX19iaW5kKHRoaXMub25GZXRjaCwgdGhpcyk7CiAgICAgIHRoaXMuZWwgPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTsKICAgICAgdGhpcy5lbC5hZGRDbGFzcygnem9vbml2ZXJzZS1mb290ZXInKTsKICAgICAgdGhpcy5lbC5odG1sKHRlbXBsYXRlKTsKICAgICAgJHdpbmRvdy5vbignZ2V0LXpvb25pdmVyc2UtcHJvamVjdC1saXN0JywgdGhpcy5vbkZldGNoKTsKICAgICAgdGhpcy5mZXRjaFByb2plY3RzKCk7CiAgICB9CgogICAgRm9vdGVyLnByb3RvdHlwZS5mZXRjaFByb2plY3RzID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAkLmdldFNjcmlwdCh0aGlzLnByb2plY3RTY3JpcHQpOwogICAgfTsKCiAgICBGb290ZXIucHJvdG90eXBlLm9uRmV0Y2ggPSBmdW5jdGlvbihlLCBjYXRlZ29yaWVzKSB7CiAgICAgIHJldHVybiB0aGlzLmVsLmh0bWwodGVtcGxhdGUoewogICAgICAgIGNhdGVnb3JpZXM6IGNhdGVnb3JpZXMKICAgICAgfSkpOwogICAgfTsKCiAgICByZXR1cm4gRm9vdGVyOwoKICB9KSgpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5Gb290ZXIgPSBGb290ZXI7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gRm9vdGVyOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyICQsIGFjdGl2ZUhhc2hMaW5rcywgYW5jaG9ycywgY2xhc3NOYW1lLCBpbml0LCByb290LCB1cGRhdGVDbGFzc2VzLCBfYmFzZTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLnV0aWwgPT0gbnVsbCkgewogICAgX2Jhc2UudXRpbCA9IHt9OwogIH0KCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIGNsYXNzTmFtZSA9ICdhY3RpdmUnOwoKICByb290ID0gZG9jdW1lbnQ7CgogIGFuY2hvcnMgPSAkKCk7CgogIHVwZGF0ZUNsYXNzZXMgPSBmdW5jdGlvbigpIHsKICAgIGFuY2hvcnMucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lKTsKICAgIGFuY2hvcnMgPSAkKCJhW2hyZWY9JyIgKyBsb2NhdGlvbi5oYXNoICsgIiddIik7CiAgICByZXR1cm4gYW5jaG9ycy5hZGRDbGFzcyhjbGFzc05hbWUpOwogIH07CgogIGluaXQgPSBmdW5jdGlvbihuZXdDbGFzc05hbWUsIG5ld1Jvb3QpIHsKICAgIHZhciBfcmVmOwogICAgaWYgKG5ld0NsYXNzTmFtZSA9PSBudWxsKSB7CiAgICAgIG5ld0NsYXNzTmFtZSA9IGNsYXNzTmFtZTsKICAgIH0KICAgIGlmIChuZXdSb290ID09IG51bGwpIHsKICAgICAgbmV3Um9vdCA9IHJvb3Q7CiAgICB9CiAgICBfcmVmID0gW25ld0NsYXNzTmFtZSwgbmV3Um9vdF0sIGNsYXNzTmFtZSA9IF9yZWZbMF0sIHJvb3QgPSBfcmVmWzFdOwogICAgdXBkYXRlQ2xhc3NlcygpOwogICAgcmV0dXJuICQod2luZG93KS5vbignaGFzaGNoYW5nZScsIHVwZGF0ZUNsYXNzZXMpOwogIH07CgogIGFjdGl2ZUhhc2hMaW5rcyA9IHsKICAgIHVwZGF0ZUNsYXNzZXM6IHVwZGF0ZUNsYXNzZXMsCiAgICBpbml0OiBpbml0CiAgfTsKCiAgd2luZG93Lnpvb25pdmVyc2UudXRpbC5hY3RpdmVIYXNoTGlua3MgPSBhY3RpdmVIYXNoTGlua3M7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gYWN0aXZlSGFzaExpbmtzOwogIH0KCn0pLmNhbGwodGhpcyk7CgppZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIG1vZHVsZS5leHBvcnRzID0gd2luZG93Lnpvb25pdmVyc2UKfSh3aW5kb3cpKTsK",
                "body": "LyohCiAqIFpvb25pdmVyc2UgTGlicmFyeSAtIHYwLjcuMQogKi8KOyhmdW5jdGlvbih3aW5kb3cpIHsKd2luZG93LmJhc2U2NCA9IHsKICBfa2V5U3RyOiAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0iLAogIAogIGVuY29kZTogZnVuY3Rpb24gKGlucHV0KSB7CiAgICB2YXIgb3V0cHV0ID0gIiI7CiAgICB2YXIgY2hyMSwgY2hyMiwgY2hyMywgZW5jMSwgZW5jMiwgZW5jMywgZW5jNDsKICAgIHZhciBpID0gMDsKICAgIAogICAgaW5wdXQgPSBiYXNlNjQuX3V0ZjhfZW5jb2RlKGlucHV0KTsKICAgIAogICAgd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpIHsKICAgICAgY2hyMSA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTsKICAgICAgY2hyMiA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTsKICAgICAgY2hyMyA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTsKICAgICAgCiAgICAgIGVuYzEgPSBjaHIxID4+IDI7CiAgICAgIGVuYzIgPSAoKGNocjEgJiAzKSA8PCA0KSB8IChjaHIyID4+IDQpOwogICAgICBlbmMzID0gKChjaHIyICYgMTUpIDw8IDIpIHwgKGNocjMgPj4gNik7CiAgICAgIGVuYzQgPSBjaHIzICYgNjM7CiAgICAgIAogICAgICBpZiAoaXNOYU4oY2hyMikpIHsKICAgICAgICBlbmMzID0gZW5jNCA9IDY0OwogICAgICB9IGVsc2UgaWYgKGlzTmFOKGNocjMpKSB7CiAgICAgICAgZW5jNCA9IDY0OwogICAgICB9CiAgICAgIAogICAgICBvdXRwdXQgPSBvdXRwdXQgKwogICAgICAgIGJhc2U2NC5fa2V5U3RyLmNoYXJBdChlbmMxKSArIGJhc2U2NC5fa2V5U3RyLmNoYXJBdChlbmMyKSArCiAgICAgICAgYmFzZTY0Ll9rZXlTdHIuY2hhckF0KGVuYzMpICsgYmFzZTY0Ll9rZXlTdHIuY2hhckF0KGVuYzQpOwogICAgfQogICAgCiAgICByZXR1cm4gb3V0cHV0OwogIH0sCiAgCiAgZGVjb2RlOiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgIHZhciBvdXRwdXQgPSAiIjsKICAgIHZhciBjaHIxLCBjaHIyLCBjaHIzOwogICAgdmFyIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQ7CiAgICB2YXIgaSA9IDA7CiAgICAKICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvW15BLVphLXowLTlcK1wvXD1dL2csICIiKTsKICAgIAogICAgd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpIHsKICAgICAgZW5jMSA9IGJhc2U2NC5fa2V5U3RyLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpOwogICAgICBlbmMyID0gYmFzZTY0Ll9rZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7CiAgICAgIGVuYzMgPSBiYXNlNjQuX2tleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTsKICAgICAgZW5jNCA9IGJhc2U2NC5fa2V5U3RyLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpOwogICAgICAKICAgICAgY2hyMSA9IChlbmMxIDw8IDIpIHwgKGVuYzIgPj4gNCk7CiAgICAgIGNocjIgPSAoKGVuYzIgJiAxNSkgPDwgNCkgfCAoZW5jMyA+PiAyKTsKICAgICAgY2hyMyA9ICgoZW5jMyAmIDMpIDw8IDYpIHwgZW5jNDsKICAgICAgCiAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMSk7CiAgICAgIAogICAgICBpZiAoZW5jMyAhPSA2NCkgewogICAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMik7CiAgICAgIH0KICAgICAgaWYgKGVuYzQgIT0gNjQpIHsKICAgICAgICBvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjMpOwogICAgICB9CiAgICB9CiAgICAKICAgIG91dHB1dCA9IGJhc2U2NC5fdXRmOF9kZWNvZGUob3V0cHV0KTsKICAgIAogICAgcmV0dXJuIG91dHB1dDsKICB9LAogIAogIF91dGY4X2VuY29kZTogZnVuY3Rpb24gKHN0cmluZykgewogICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL1xyXG4vZywgIlxuIik7CiAgICB2YXIgdXRmdGV4dCA9ICIiOwogICAgCiAgICBmb3IgKHZhciBuID0gMDsgbiA8IHN0cmluZy5sZW5ndGg7IG4rKykgewogICAgICB2YXIgYyA9IHN0cmluZy5jaGFyQ29kZUF0KG4pOwogICAgICAKICAgICAgaWYgKGMgPCAxMjgpIHsKICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7CiAgICAgIH0gZWxzZSBpZiAoKGMgPiAxMjcpICYmIChjIDwgMjA0OCkpIHsKICAgICAgICB1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgPj4gNikgfCAxOTIpOwogICAgICAgIHV0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjID4+IDEyKSB8IDIyNCk7CiAgICAgICAgdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyA+PiA2KSAmIDYzKSB8IDEyOCk7CiAgICAgICAgdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjICYgNjMpIHwgMTI4KTsKICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gdXRmdGV4dDsKICB9LAogIAogIF91dGY4X2RlY29kZTogZnVuY3Rpb24gKHV0ZnRleHQpIHsKICAgIHZhciBzdHJpbmcgPSAiIjsKICAgIHZhciBpID0gMDsKICAgIHZhciBjID0gMCwgYzEgPSAwLCBjMiA9IDA7CiAgICAKICAgIHdoaWxlIChpIDwgdXRmdGV4dC5sZW5ndGgpIHsKICAgICAgYyA9IHV0ZnRleHQuY2hhckNvZGVBdChpKTsKICAgICAgCiAgICAgIGlmIChjIDwgMTI4KSB7CiAgICAgICAgc3RyaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7CiAgICAgICAgaSsrOwogICAgICB9IGVsc2UgaWYgKChjID4gMTkxKSAmJiAoYyA8IDIyNCkpIHsKICAgICAgICBjMSA9IHV0ZnRleHQuY2hhckNvZGVBdChpICsgMSk7CiAgICAgICAgc3RyaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMzEpIDw8IDYpIHwgKGMxICYgNjMpKTsKICAgICAgICBpICs9IDI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYzEgPSB1dGZ0ZXh0LmNoYXJDb2RlQXQoaSArIDEpOwogICAgICAgIGMyID0gdXRmdGV4dC5jaGFyQ29kZUF0KGkgKyAyKTsKICAgICAgICBzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAxNSkgPDwgMTIpIHwgKChjMSAmIDYzKSA8PCA2KSB8IChjMiAmIDYzKSk7CiAgICAgICAgaSArPSAzOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RyaW5nOwogIH0KfTsKCihmdW5jdGlvbigpIHsKICB2YXIgZW4sIF9iYXNlOwoKICBlbiA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdBIFpvb25pdmVyc2UgcHJvamVjdCcsCiAgICBzaWduVXBIZWFkaW5nOiAnU2lnbiB1cCBmb3IgYSBuZXcgWm9vbml2ZXJzZSBhY2NvdW50JywKICAgIHNpZ25JbkhlYWRpbmc6ICdTaWduIGluIHRvIHlvdXIgWm9vbml2ZXJzZSBhY2NvdW50JywKICAgIHNpZ25VcDogJ1NpZ24gdXAnLAogICAgc2lnbkluOiAnU2lnbiBpbicsCiAgICBzaWduT3V0OiAnU2lnbiBvdXQnLAogICAgdXNlcm5hbWU6ICdVc2VybmFtZScsCiAgICBwYXNzd29yZDogJ1Bhc3N3b3JkJywKICAgIGVtYWlsOiAnRW1haWwnLAogICAgcmVhbE5hbWU6ICdSZWFsIG5hbWUnLAogICAgd2h5UmVhbE5hbWU6ICdUaGlzIHdpbGwgYmUgdXNlZCB3aGVuIHdlIHRoYW5rIGNvbnRyaWJ1dG9ycywgZm9yIGV4YW1wbGUsIGluIHRhbGtzIG9yIG9uIHBvc3RlcnMuIElmIHlvdSBkb25cJ3Qgd2FudCB0byBiZSBtZW50aW9uZWQgcHVibGljbHksIGxlYXZlIHRoaXMgYmxhbmsuJywKICAgIG5vQWNjb3VudDogJ0RvblwndCBoYXZlIGFuIGFjY291bnQ/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAnSSBhZ3JlZSB0byB0aGUgPGEgaHJlZj0iaHR0cHM6Ly93d3cuem9vbml2ZXJzZS5vcmcvcHJpdmFjeSIgdGFyZ2V0PSJfYmxhbmsiPnByaXZhY3kgcG9saWN5PC9hPi4nLAogICAgYmV0YVByZWZlcmVuY2U6ICdJIHdvdWxkIGxpa2UgdG8gcmVjZWl2ZSBub3RpY2VzIHdpdGggb3Bwb3J0dW5pdGllcyB0byB0ZXN0IGFuZCBwcm92aWRlIGZlZWRiYWNrIG9uIHVucmVsZWFzZWQgWm9vbml2ZXJzZSBwcm9qZWN0cy4nLAogICAgZm9yZ290UGFzc3dvcmQ6ICdGb3Jnb3QgeW91ciBwYXNzd29yZD8nLAogICAgYmFkTG9naW46ICdJbmNvcnJlY3QgdXNlcm5hbWUgb3IgcGFzc3dvcmQnLAogICAgc2lnbkluRmFpbGVkOiAnU2lnbiBpbiBmYWlsZWQuJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICdTaWduIGluIHRvIHNlZSB5b3VyIHByb2ZpbGUuJywKICAgIGZvb3RlckhlYWRpbmc6ICdUaGUgWm9vbml2ZXJzZSBpcyBhIGNvbGxlY3Rpb24gb2Ygd2ViLWJhc2VkIGNpdGl6ZW4gc2NpZW5jZSBwcm9qZWN0cyB0aGF0IHVzZSB0aGUgZWZmb3J0cyBvZiB2b2x1bnRlZXJzIHRvIGhlbHAgcmVzZWFyY2hlcnMgZGVhbCB3aXRoIHRoZSBmbG9vZCBvZiBkYXRhIHRoYXQgY29uZnJvbnRzIHRoZW0uJywKICAgIHByaXZhY3lQb2xpY3k6ICdQcml2YWN5IHBvbGljeScsCiAgICBmb3JrT25HaXRIdWI6ICdTb3VyY2UgJiBidWdzJywKICAgIHJlY2VudHM6ICdSZWNlbnRzJywKICAgIGZhdm9yaXRlczogJ0Zhdm9yaXRlcycsCiAgICBub25lOiAnbm9uZScKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLmVuID0gZW47CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gZW47CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgZXMsIF9iYXNlOwoKICBlcyA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdVbiBwcm95ZWN0byBkZSBab29uaXZlcnNlJywKICAgIHNpZ25VcEhlYWRpbmc6ICdSZWfDrXN0cmF0ZSBjb24gdW5hIG51ZXZhIGN1ZW50YSBab29uaXZlcnNlJywKICAgIHNpZ25JbkhlYWRpbmc6ICdJbmljaWEgc2VzacOzbiBjb24gdHUgY3VlbnRhIGRlIFpvb25pdmVyc2UnLAogICAgc2lnblVwOiAnU3VzY3JpYmlyc2UnLAogICAgc2lnbkluOiAnSW5pY2lhciBzZXNpw7NuJywKICAgIHNpZ25PdXQ6ICdTYWxpcicsCiAgICB1c2VybmFtZTogJ05vbWJyZSBkZSBVc3VhcmlvJywKICAgIHBhc3N3b3JkOiAnQ29udHJhc2XDsWEnLAogICAgZW1haWw6ICdFbWFpbCcsCiAgICByZWFsTmFtZTogJ05vbWJyZSBSZWFsJywKICAgIHdoeVJlYWxOYW1lOiAnRXN0byBzZXLDoSB1c2FkbyBwYXJhIGFncmFkZWNlciBhIGxvcyBjb2xhYm9yYWRvcmVzLCBwb3IgZWplbXBsICBlbiBsYXMgY29udmVyc2FjaW9uZXMgbyBjYXJ0ZWxlcy4gU2kgbm8gcXVpZXJlcyBzZXIgbWVuY2lvbmFkbyBww7pibGljYW1lbnQgIGTDqWphbG8gZW4gYmxhbmNvLicsCiAgICBub0FjY291bnQ6ICfCv05vIHRpZW5lcyB1bmEgY3VlbnRhPycsCiAgICBhZ3JlZVRvUHJpdmFjeVBvbGljeTogJ0VzdG95IGRlIGFjdWVyZG8gY29uIDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVycyAgb3JnL3ByaXZhY3kiIHRhcmdldD0iX2JsYW5rIj4geSBzdSBwb2zDrXRpY2EgZGUgcHJpdmFjaWRhZCA8L2E+LicsCiAgICBiZXRhUHJlZmVyZW5jZTogJ01lIGd1c3RhcsOtYSByZWNpYmlyIG5vdGljaWFzIGNvbiBvcG9ydHVuaWRhZGVzIHBhcmEgcHJvYmFyICAgcHJvcG9yY2lvbmFyIGZlZWRiYWNrIGVuIGxvcyBwcm95ZWN0b3MgaW7DqWRpdG9zIGRlIFpvb25pdmVyc2UnLAogICAgZm9yZ290UGFzc3dvcmQ6ICfCv09sdmlkYXN0ZSB0dSBjb250cmFzZcOxYT8nLAogICAgYmFkTG9naW46ICdOb21icmUgZGUgdXN1YXJpbyBvIGNvbnRyYXNlw7FhIGluY29ycmVjdGEnLAogICAgc2lnbkluRmFpbGVkOiAnRXJyb3IgYWwgaW5pY2lhciBzZXNpw7NuJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICdJbmljaWEgc2VzacOzbiBwYXJhIHZlciB0dSBwZXJmaWwuJywKICAgIGZvb3RlckhlYWRpbmc6ICdab29uaXZlcnNlIGVzIHVuYSBjb2xlY2Npw7NuIGRlIHByb3llY3RvcyBkZSBjaWVuY2lhIGNpdWRhZGFuICBiYXNhZG9zIGVuIGxhIHdlYiBxdWUgdXRpbGl6YSBlbCBlc2Z1ZXJ6byBkZSB2b2x1bnRhcmlvcyBwYXJhIGF5dWRhciBhIGxvIGludmVzdGlnYWRvcmVzIGNvbiBsYSBhdmFsYW5jaGEgZGUgZGF0b3MgYSBsYSBxdWUgc2UgZW5mcmVudGFuLicsCiAgICBwcml2YWN5UG9saWN5OiAnUG9sw610aWNhIGRlIHByaXZhY2lkYWQnLAogICAgZm9ya09uR2l0SHViOiAnRnVlbnRlIHkgZXJyb3JlcycsCiAgICByZWNlbnRzOiAnUmVjaWVudGVzJywKICAgIGZhdm9yaXRlczogJ0Zhdm9yaXRvcycsCiAgICBub25lOiAnbmluZ3VubycKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLmVzID0gZXM7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gZXM7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgZnIsIF9iYXNlOwoKICBmciA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdVbiBwcm9qZXQgWm9vbml2ZXJzZScsCiAgICBzaWduVXBIZWFkaW5nOiAnQ3LDqWVyIHVuIGNvbXB0ZSBab29uaXZlcnNlJywKICAgIHNpZ25JbkhlYWRpbmc6ICdDb25uZWN0ZXotdm91cyDDoCB2b3RyZSBjb21wdGUgWm9vbml2ZXJzZScsCiAgICBzaWduVXA6ICdTXCdpbnNjcmlyZScsCiAgICBzaWduSW46ICdDb25uZXhpb24nLAogICAgc2lnbk91dDogJ0TDqWNvbm5leGlvbicsCiAgICB1c2VybmFtZTogJ05vbSBkXCd1dGlsaXNhdGV1cicsCiAgICBwYXNzd29yZDogJ01vdCBkZSBwYXNzZScsCiAgICBlbWFpbDogJ0VtYWlsJywKICAgIHJlYWxOYW1lOiAnUHLDqW5vbSBOb20nLAogICAgd2h5UmVhbE5hbWU6ICdWb3RyZSBub20gcG91cnJhIMOqdHJlIHV0aWxpc2VyIGxvcnMgZHUgcmVtZXJjaWVtZW50IGRlcyBjb250cmlidXRldXJzLCBwYXIgZXhlbXBsZSBsb3JzIGRlIHByw6lzZW50YXRpb24gb3JhbGVzIG91IHN1ciBkZXMgcG9zdGVycy48YnIgLz5TaSB2b3VzIG5lIHNvdWhhaXRleiBwYXMgcXVcJ2lsIHNvaXQgbWVudGlvbm5lciBwdWJsaXF1ZW1lbnQsIGxhaXNzZXogY2V0dGUgY2FzZSB2aWRlLicsCiAgICBub0FjY291bnQ6ICdWb3VzIG5cJ2F2ZXogcGFzIGVuY29yZSBkZSBjb21wdGU/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAnSlwnYWNjZXB0ZSBsZXMgPGEgaHJlZj0iaHR0cHM6Ly93d3cuem9vbml2ZXJzZS5vcmcvcHJpdmFjeSIgdGFyZ2V0PSJfYmxhbmsiPmNvbmRpdGlvbnMgZFwndXRpbGlzYXRpb24gPC9hPi4nLAogICAgYmV0YVByZWZlcmVuY2U6ICdKXCdhaW1lcmFpcyDDqnRyZSB0ZW51IGF1IGNvdXJhbnQgZGVzIHByb2pldHMgZW4gY291cnMgZGUgZMOpdmVsb3BwZW1lbnQgcGFyIFpvb25pdmVyc2UsIGFmaW4gZGUgcGFydGljaXBlciBhdXggdGVzdHMgZXQgZG9ubmVyIG1vbiBhdmlzLicsCiAgICBmb3Jnb3RQYXNzd29yZDogJ01vdCBkZSBwYXNzZSBvdWJsacOpPycsCiAgICBiYWRMb2dpbjogJ1V0aWxpc2F0ZXVyIG91IG1vdCBkZSBwYXNzZSBpbmNvcnJlY3QnLAogICAgc2lnbkluRmFpbGVkOiAnw4ljaGVjIGRlIGxhIGNvbm5leGlvbi4nLAogICAgc2lnbkluRm9yUHJvZmlsZTogJ0Nvbm5lY3Rlei12b3VzIHBvdXIgYWNjw6lkZXIgw6Agdm90cmUgcHJvZmlsLicsCiAgICBmb290ZXJIZWFkaW5nOiAnWm9vbml2ZXJzZSBlc3QgdW5lIGNvbGxlY3Rpb24gZGUgcHJvamV0cyBkZSBzY2llbmNlIHBhcnRpY2lwYXRpdmUgZW4gbGlnbmUgcXVpIHBlcm1ldHRlbnQgYXV4IHZvbG9udGFpcmVzIGRcJ2FpZGVyIGxlcyBzY2llbnRpZmlxdWVzIMOgIHRyYWl0ZXIgbGVzIGltbWVuc2VzIHF1YW50aXTDqXMgZGUgZG9ubsOpZXMgZG9udCBpbHMgZGlzcG9zZW50LicsCiAgICBwcml2YWN5UG9saWN5OiAnQ29udGlkaXRvbnMgZFwndXRpbGlzYXRpb24nLAogICAgcmVjZW50czogJ1LDqWNlbnRzJywKICAgIGZhdm9yaXRlczogJ0Zhdm9yaXMnLAogICAgbm9uZTogJ2F1Y3VuJwogIH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS50cmFuc2xhdGlvbnMgPT0gbnVsbCkgewogICAgX2Jhc2UudHJhbnNsYXRpb25zID0ge307CiAgfQoKICB3aW5kb3cuem9vbml2ZXJzZS50cmFuc2xhdGlvbnMuZnIgPSBmcjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBmcjsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBwbCwgX2Jhc2U7CgogIHBsID0gewogICAgdG9wQmFySGVhZGluZzogJ1Byb2pla3QgWm9vbml2ZXJzZScsCiAgICBzaWduVXBIZWFkaW5nOiAnVXR3w7NyeiBub3dlIGtvbnRvIFpvb25pdmVyc2UnLAogICAgc2lnbkluSGVhZGluZzogJ1phbG9ndWogc2nEmSBuYSBzd29qZSBrb250byBab29uaXZlcnNlJywKICAgIHNpZ25VcDogJ1phcmVqZXN0cnVqJywKICAgIHNpZ25JbjogJ1phbG9ndWonLAogICAgc2lnbk91dDogJ1d5bG9ndWonLAogICAgdXNlcm5hbWU6ICdOYXp3YSB1xbx5dGtvd25pa2EnLAogICAgcGFzc3dvcmQ6ICdIYXPFgm8nLAogICAgZW1haWw6ICdBZHJlcyBlLW1haWwnLAogICAgcmVhbE5hbWU6ICdQcmF3ZHppd2UgaW1pxJknLAogICAgd2h5UmVhbE5hbWU6ICdLb3J6eXN0YW15IHogdHljaCBkYW55Y2gsIGtpZWR5IGR6acSZa3VqZW15IG9jaG90bmlrb20gemEgaWNoIHdrxYJhZCwgbmEgcHJ6eWvFgmFkIHBvZGN6YXMgcm96bcOzdyBjenkgbmEgcGxha2F0YWNoLiA8YnIvPiBKZcW8ZWxpIG5pZSBjaGNlc3osIGFiecWbbXkgd3ltaWVuaWFsaSBDacSZIHB1YmxpY3puaWUgeiBpbWllbmlhIGkgbmF6d2lza2EsIHpvc3RhdyB0byBwb2xlIHB1c3RlLicsCiAgICBub0FjY291bnQ6ICdOaWUgbWFzeiBqZXN6Y3plIGtvbnRhPycsCiAgICBhZ3JlZVRvUHJpdmFjeVBvbGljeTogJ1pnYWR6YW0gc2nEmSB6IDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVyc2Uub3JnL3ByaXZhY3kiIHRhcmdldD0iX2JsYW5rIj5wb2xpdHlrxIUgcHJ5d2F0bm/Fm2NpPC9hPi4nLAogICAgZm9yZ290UGFzc3dvcmQ6ICdOaWUgcGFtacSZdGFzeiBoYXPFgmE/JywKICAgIGJhZExvZ2luOiAnTmllcG9wcmF3bmEgbmF6d2EgdcW8eXRrb3duaWthIGx1YiBoYXPFgm8nLAogICAgc2lnbkluRmFpbGVkOiAnTmllIHVkYcWCbyBzacSZIHphbG9nb3dhxIcnLAogICAgc2lnbkluRm9yUHJvZmlsZTogJ1phbG9ndWogc2nEmSwgYWJ5IHpvYmFjennEhyBzd8OzaiBwcm9maWwnLAogICAgZm9vdGVySGVhZGluZzogJ1pvb25pdmVyc2UgdG8gemJpw7NyIHByb2pla3TDs3cgbmF1a2kgb2J5d2F0ZWxza2llaiB3IEludGVybmVjaWUsIGR6acSZa2kga3TDs3J5bSBvY2hvdG5pY3kgcG9tYWdhasSFIGJhZGFjem9tIHByemVkemllcmHEhyBzacSZIHByemV6IHBvd8OzZMW6IG5hcMWCeXdhasSFY3ljaCBkYW55Y2guJywKICAgIHByaXZhY3lQb2xpY3k6ICdQb2xpdHlrYSBwcnl3YXRub8WbY2knLAogICAgcmVjZW50czogJ05ham5vd3N6ZScsCiAgICBmYXZvcml0ZXM6ICdVbHViaW9uZScsCiAgICBub25lOiAnbmljJwogIH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS50cmFuc2xhdGlvbnMgPT0gbnVsbCkgewogICAgX2Jhc2UudHJhbnNsYXRpb25zID0ge307CiAgfQoKICB3aW5kb3cuem9vbml2ZXJzZS50cmFuc2xhdGlvbnMucGwgPSBwbDsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBwbDsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBydSwgX2Jhc2U7CgogIHJ1ID0gewogICAgdG9wQmFySGVhZGluZzogJ9Cf0YDQvtC10LrRgiBab29uaXZlcnNlJywKICAgIHNpZ25VcEhlYWRpbmc6ICfQodC+0LfQtNCw0YLRjCDQvdC+0LLRi9C5INCw0LrQutCw0YPQvdGCIFpvb25pdmVyc2UnLAogICAgc2lnbkluSGVhZGluZzogJ9CS0L7QudGC0Lgg0LIg0LLQsNGIINCw0LrQutCw0YPQvdGCIFpvb25pdmVyc2UnLAogICAgc2lnblVwOiAn0JfQsNGA0LXQs9C40YHRgtGA0LjRgNC+0LLQsNGC0YzRgdGPJywKICAgIHNpZ25JbjogJ9CS0L7QudGC0LgnLAogICAgc2lnbk91dDogJ9CS0YvQudGC0LgnLAogICAgdXNlcm5hbWU6ICfQmNC80Y8g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPJywKICAgIHBhc3N3b3JkOiAn0J/QsNGA0L7Qu9GMJywKICAgIGVtYWlsOiAn0JDQtNGA0LXRgSBFLW1haWwnLAogICAgcmVhbE5hbWU6ICfQndCw0YHRgtC+0Y/RidC10LUg0LjQvNGPJywKICAgIHdoeVJlYWxOYW1lOiAn0JjRgdC/0L7Qu9GM0LfRg9C10YLRgdGPINC/0YDQuCDQstGL0YDQsNC20LXQvdC40Lgg0L3QsNGI0LXQuSDQsdC70LDQs9C+0LTQsNGA0L3QvtGB0YLQuCDRg9GH0LDRgdGC0L3QuNC60LDQvCwg0L3QsNC/0YDQuNC80LXRgCwg0LIg0L7QsdGB0YPQttC00LXQvdC40Y/RhSDQuNC70Lgg0L7QsdGK0Y/QstC70LXQvdC40Y/RhS4g0JXRgdC70Lgg0LLRiyDQvdC1INGF0L7RgtC40YLQtSwg0YfRgtC+0LHRiyDQstCw0YEg0YPQv9C+0LzQuNC90LDQu9C4INC/0YPQsdC70LjRh9C90L4sINC+0YHRgtCw0LLRjNGC0LUg0Y3RgtC+INC/0L7Qu9C1INC/0YPRgdGC0YvQvC4nLAogICAgbm9BY2NvdW50OiAn0J3QtdGCINCw0LrQutCw0YPQvdGC0LA/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAn0K8g0YHQvtCz0LvQsNGB0LXQvSDRgSA8YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy9wcml2YWN5IiB0YXJnZXQ9Il9ibGFuayI+0L/QvtC70LjRgtC40LrQvtC5INC60L7QvdGE0LjQtNC10L3RhtC40LDQu9GM0L3QvtGB0YLQuDwvYT4uJywKICAgIGJldGFQcmVmZXJlbmNlOiAn0K8g0YXQvtGH0YMg0L/QvtC70YPRh9Cw0YLRjCDQv9GA0LjQs9C70LDRiNC10L3QuNGPINC6INGD0YfQsNGB0YLQuNGOINCyINGC0LXRgdGC0LjRgNC+0LLQsNC90LjQuCDQvdC+0LLRi9GFINC/0YDQvtC10LrRgtC+0LIgWm9vbml2ZXJzZS4nLAogICAgZm9yZ290UGFzc3dvcmQ6ICfQl9Cw0LHRi9C70Lgg0L/QsNGA0L7Qu9GMPycsCiAgICBiYWRMb2dpbjogJ9Cd0LXQv9GA0LDQstC40LvRjNC90L7QtSDQuNC80Y8g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINC40LvQuCDQv9Cw0YDQvtC70YwnLAogICAgc2lnbkluRmFpbGVkOiAn0JLRhdC+0LQg0L3QtSDQstGL0L/QvtC70L3QtdC9LicsCiAgICBzaWduSW5Gb3JQcm9maWxlOiAn0JLQvtC50LTQuNGC0LUsINGH0YLQvtCx0Ysg0YPQstC40LTQtdGC0Ywg0YHQstC+0Lkg0L/RgNC+0YTQuNC70YwuJywKICAgIGZvb3RlckhlYWRpbmc6ICdab29uaXZlcnNlIOKAlCDRjdGC0L4g0LPRgNGD0L/Qv9CwINC+0L3Qu9Cw0LnQvS3Qv9GA0L7QtdC60YLQvtCyINCz0YDQsNC20LTQsNC90YHQutC+0Lkg0L3QsNGD0LrQuCwg0LPQtNC1INC00L7QsdGA0L7QstC+0LvRjNGG0Ysg0L/QvtC80L7Qs9Cw0Y7RgiDQvtCx0YDQsNCx0LDRgtGL0LLQsNGC0Ywg0L7Qs9GA0L7QvNC90YvQtSDQvtCx0YrQtdC80Ysg0LTQsNC90L3Ri9GFLCDRgSDQutC+0YLQvtGA0YvQvNC4INC/0YDQuNGF0L7QtNC40YLRgdGPINGB0YLQsNC70LrQuNCy0LDRgtGM0YHRjyDRg9GH0ZHQvdGL0LwuJywKICAgIHByaXZhY3lQb2xpY3k6ICfQn9C+0LvQuNGC0LjQutCwINC60L7QvdGE0LjQtNC10L3RhtC40LDQu9GM0L3QvtGB0YLQuCcsCiAgICBmb3JrT25HaXRIdWI6ICfQmNGB0YXQvtC00L3Ri9C5INC60L7QtCDQuCDQsdCw0LPQuCcsCiAgICByZWNlbnRzOiAn0J3QtdC00LDQstC90LjQtScsCiAgICBmYXZvcml0ZXM6ICfQmNC30LHRgNCw0L3QvdC+0LUnLAogICAgbm9uZTogJ9C/0YPRgdGC0L4nCiAgfTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLnRyYW5zbGF0aW9ucyA9PSBudWxsKSB7CiAgICBfYmFzZS50cmFuc2xhdGlvbnMgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLnRyYW5zbGF0aW9ucy5ydSA9IHJ1OwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJ1OwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIHpoX3R3LCBfYmFzZTsKCiAgemhfdHcgPSB7CiAgICB0b3BCYXJIZWFkaW5nOiAn44CMWm9vbml2ZXJzZeOAjeioiOeVqycsCiAgICBzaWduVXBIZWFkaW5nOiAnICLnlLPoq4vmlrDnmoTjgIxab29uaXZlcnNl44CN5biz6JmfJywKICAgIHNpZ25JbkhlYWRpbmc6ICfku6XjgIxab29uaXZlcnNl44CN5biz6Jmf55m75YWlICcsCiAgICBzaWduVXA6ICfmlrDlop7luLPomZ8nLAogICAgc2lnbkluOiAn55m75YWlJywKICAgIHNpZ25PdXQ6ICfnmbvlh7onLAogICAgdXNlcm5hbWU6ICfnlKjmiLblkI0nLAogICAgcGFzc3dvcmQ6ICflr4bnorwnLAogICAgZW1haWw6ICfpm7vlrZDkv6HnrrHluLPomZ8nLAogICAgcmVhbE5hbWU6ICfnnJ/lr6blp5PlkI0nLAogICAgd2h5UmVhbE5hbWU6ICfpgJnmnIPnlKjkvobmhJ/orJ3miJHlgJHnmoTljZTlipvlpKXkvLTvvIzorazlpoLmlL7lnKjmvJTorJvloLTlkIjmiJbmtbfloLHkuIrjgILlpoLmnpzkvaDkuI3poZjlhazplovnnJ/lr6blp5PlkI3vvIzlj6/ku6Xnqbrnmb3jgIInLAogICAgbm9BY2NvdW50OiAn6YKE5rKS6ZaL56uL6YGO5biz6Jmf5ZeO77yfJywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAn5oiR5ZCM5oSPIDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVyc2Uub3JnL3ByaXZhY3kiIHRhcmdldD0iX2JsYW5rIj4g6Zqx56eB5qyK6Kit5a6a6KaP5a6aPC9hPi4nLAogICAgYmV0YVByZWZlcmVuY2U6ICfmiJHmqILmhI/luavlv5nmuKzoqablsJrmnKrmraPlvI/kuIrnt5rnmoTjgIxab29uaXZlcnNl44CN6KiI55Wr5Lim5Y2U5Yqp6K6T56iL5byP5pu05a6M5ZaE77yM5pyJ5qmf5pyD6KuL6YCa55+l5oiR44CCJywKICAgIGZvcmdvdFBhc3N3b3JkOiAn5b+Y6KiY5a+G56K8PycsCiAgICBiYWRMb2dpbjogJ+eUqOaItuWQjeeosemMr+iqpOaIluWvhueivOmMr+iqpCcsCiAgICBzaWduSW5GYWlsZWQ6ICfnmbvlhaXlpLHmlZfjgIInLAogICAgc2lnbkluRm9yUHJvZmlsZTogJ+eZu+WFpeafpeeci+W3suWIhumhnuiomOmMhOOAgicsCiAgICBmb290ZXJIZWFkaW5nOiAnIOOAjFpvb25pdmVyc2XjgI3ntrLnq5nku6XntrLot6/mlrnlvI/orpPkuIDoiKzlpKfnnL7og73lj4PoiIflpJrnqK7noJTnqbbkuLvpoYznmoTnp5HlrbjoqIjnlavjgILlv5flt6XliIbpoZ7lk6HnmoTljZTlkIzliqrlipvvvIzluavliqnnp5HlrbjlrrbomZXnkIbkuobpvpDlpKfos4fmlpnvvIzpgJnmtbfph4/nmoTos4fmlpnljp/mnKzlsI3np5HlrbjlrrbmmK/lgIvkuI3lsI/nmoTmjJHmiLDvvIEnLAogICAgcHJpdmFjeVBvbGljeTogJ+maseengeasiuioreWumuimj+WumicsCiAgICBmb3JrT25HaXRIdWI6ICfljp/lp4vnorzlj4rpjK/oqqTlm57loLEnLAogICAgcmVjZW50czogJ+acgOaWsOWujOaIkOeahCcsCiAgICBmYXZvcml0ZXM6ICfmiJHnmoTmnIDmhJsnLAogICAgbm9uZTogJ+eEoScKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLnpoX3R3ID0gemhfdHc7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gemhfdHc7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgemhfY24sIF9iYXNlOwoKICB6aF9jbiA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdab29uaXZlcnNl6K6h5YiSJywKICAgIHNpZ25VcEhlYWRpbmc6ICcgIueUs+ivt+aWsOeahFpvb25pdmVyc2XluJDlj7cnLAogICAgc2lnbkluSGVhZGluZzogJ+eZu+WFpVpvb25pdmVyc2UnLAogICAgc2lnblVwOiAn55Sz6K+35biQ5Y+3JywKICAgIHNpZ25JbjogJ+eZu+WFpScsCiAgICBzaWduT3V0OiAn55m75Ye6JywKICAgIHVzZXJuYW1lOiAn55So5oi35ZCNJywKICAgIHBhc3N3b3JkOiAn5a+G56CBJywKICAgIGVtYWlsOiAn55S15a2Q5L+h566x5biQ5Y+3JywKICAgIHJlYWxOYW1lOiAn55yf5a6e5aeT5ZCNJywKICAgIHdoeVJlYWxOYW1lOiAn5bCG5Lya6KKr55So5p2l5oSf6LCi5oiR5Lus55qE5Y2P5Yqb5LyZ5Ly077yM6K2s5aaC5pS+5Zyo5ryU6K6y5Zy65ZCI5oiW5rW35oql5LiK44CC5aaC5p6c5L2g5LiN5oS/5YWs5byA55yf5a6e5aeT5ZCN77yM5Y+v5Lul56m655m944CCICcsCiAgICBub0FjY291bnQ6ICfov5jmsqHlvIDnq4vov4fluJDlj7flkJfvvJ8gJywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAn5oiR5ZCM5oSPPGEgaHJlZj0iaHR0cHM6Ly93d3cuem9vbml2ZXJzZS5vcmcvcHJpdmFjeSIgdGFyZ2V0PSJfYmxhbmsiPumakOengeadg+iuvuWumuinhOWumjwvYT4uJywKICAgIGJldGFQcmVmZXJlbmNlOiAn5oiR5oS/5oSP5biu5b+Z5rWL6K+V5bCa5pyq5q2j5byP5LiK57q/55qEICJab29uaXZlcnNl6K6h5YiSIiDlubbljY/liqnorqnnqIvlvI/mm7TlrozlloTvvIzmnInov5nnsbvmnLrkvJror7fpgJrnn6XmiJHjgIIgJywKICAgIGZvcmdvdFBhc3N3b3JkOiAn5b+Y6K6w5a+G56CBPycsCiAgICBiYWRMb2dpbjogJ+eUqOaIt+WQjeensOmUmeivr+aIluWvhueggemUmeivrycsCiAgICBzaWduSW5GYWlsZWQ6ICfnmbvlhaXlpLHotKXjgIIgJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICfnmbvlhaXmn6XnnIvlt7LliIbnsbvorrDlvZXjgIIgJywKICAgIGZvb3RlckhlYWRpbmc6ICcgWm9vbml2ZXJzZee9keermeS7pee9kei3r+aWueW8j+iuqeS4gOiIrOWkp+S8l+iDveWPguS4juWkmuenjeeglOeptuS4u+mimOeahOenkeWtpuiuoeWIkuOAgua1t+mHj+eahOi1hOaWmeWOn+acrOe1puenkeWtpuWutuW4puadpeS4jeWwj+eahOaMkeaImO+8jOi/mOWlveacieW/l+aEv+iAheWIhuexu+WRmOWNj+WQjOWKquWKm++8jOW3suW4ruWKqeenkeWtpuWutuWkhOeQhuS6huWkp+mHj+i1hOaWmeOAgiAnLAogICAgcHJpdmFjeVBvbGljeTogJ+makOengeadg+iuvuWumuinhOWumicsCiAgICBmb3JrT25HaXRIdWI6ICfljp/lp4vnoIHlj4rplJnor6/lm57miqUnLAogICAgcmVjZW50czogJ+acgOaWsOWujOaIkOeahCcsCiAgICBmYXZvcml0ZXM6ICfmiJHnmoTmnIDniLEnLAogICAgbm9uZTogJ+aXoCcKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLnpoX2NuID0gemhfY247CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gemhfY247CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgZGUsIF9iYXNlOwoKICBkZSA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdFaW4gUHJvamVrdCB2b24gWm9vbml2ZXJzZScsCiAgICBzaWduVXBIZWFkaW5nOiAnRWluIG5ldWVzIFpvb25pdmVyc2UtS29udG8gZXJzdGVsbGVuJywKICAgIHNpZ25JbkhlYWRpbmc6ICdNaXQgWm9vbml2ZXJzZS1Lb250byBhbm1lbGRlbicsCiAgICBzaWduVXA6ICdSZWdpc3RyaWVyZW4nLAogICAgc2lnbkluOiAnQW5tZWxkZW4nLAogICAgc2lnbk91dDogJ0FibWVsZGVuJywKICAgIHVzZXJuYW1lOiAnQmVudXR6ZXJuYW1lJywKICAgIHBhc3N3b3JkOiAnUGFzc3dvcnQnLAogICAgZW1haWw6ICdFLU1haWwnLAogICAgcmVhbE5hbWU6ICdUYXRzw6RjaGxpY2hlciBOYW1lJywKICAgIHdoeVJlYWxOYW1lOiAnV2VubiB3aXIgRnJlaXdpbGxpZ2VuIGRhbmtlbiwgenVtIEJlaXNwaWVsIGF1ZiBQb3N0ZXJuIG9kZXIgaW4gVm9ydHLDpGdlbiwgd2lyZCBkZWluIHRhdHPDpGNobGljaGVyIE5hbWUgdmVyd2VuZGV0LiBGYWxscyBkdSBuaWNodCDDtmZmZW50bGljaCBlcnfDpGhudCB3ZXJkZW4gd2lsbHN0LCBsYXNzZSBkaWVzZSBaZWlsZSBvZmZlbi4nLAogICAgbm9BY2NvdW50OiAnS2VpbiBCZW51dHplcmtvbnRvPycsCiAgICBhZ3JlZVRvUHJpdmFjeVBvbGljeTogJ0ljaCBzdGltbWUgZGVyIDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVyc2Uub3JnL3ByaXZhY3kiIHRhcmdldD0iX2JsYW5rIj5EYXRlbnNjaHV0enJpY2h0bGluaWU8L2E+IHp1LicsCiAgICBiZXRhUHJlZmVyZW5jZTogJ0ljaCB3w7xyZGUgZ2VybmUgZWluZSBOYWNocmljaHQgZXJoYWx0ZW4sIHdlbm4gZGllIEdlbGVnZW5oZWl0IGJlc3RlaHQsIG5ldWUgWm9vbml2ZXJzZS1Qcm9qZWt0ZSB6dSB0ZXN0ZW4gdW5kIG1laW5lIE1laW51bmcgYWJ6dWdlYmVuLicsCiAgICBmb3Jnb3RQYXNzd29yZDogJ1Bhc3N3b3J0IHZlcmdlc3Nlbj8nLAogICAgYmFkTG9naW46ICdGYWxzY2hlciBCZW51dHplcm5hbWUgb2RlciBmYWxzY2hlcyBQYXNzd29ydCcsCiAgICBzaWduSW5GYWlsZWQ6ICdBbm1lbGR1bmcgZmVobGdlc2NobGFnZW4uJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICdNZWxkZSBkaWNoIGFuLCB1bSBkZWluIFByb2ZpbCB6dSBzZWhlbi4nLAogICAgZm9vdGVySGVhZGluZzogJ1pvb25pdmVyc2UgaXN0IGVpbmUgU2FtbWx1bmcgdm9uIENpdGl6ZW4gU2NpZW5jZSBQcm9qZWt0ZW4gaW0gSW50ZXJuZXQsIGRpZSBkaWUgTGVpc3R1bmdlbiBGcmVpd2lsbGlnZXIgbnV0emVuLCB1bSBGb3JzY2hlcm4gbWl0IGRlciBEYXRlbmZsdXQgenUgaGVsZmVuLCBtaXQgZGVyIHNpZSBrb25mcm9udGllcnQgd2VyZGVuLicsCiAgICBwcml2YWN5UG9saWN5OiAnRGF0ZW5zY2h1dHpyaWNodGxpbmllJywKICAgIGZvcmtPbkdpdEh1YjogJ1NvdXJjZSAmIEJ1Z3MnLAogICAgcmVjZW50czogJ05ldWVzdGUnLAogICAgZmF2b3JpdGVzOiAnRmF2b3JpdGVuJywKICAgIG5vbmU6ICdrZWluZScKICB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkudHJhbnNsYXRpb25zID09IG51bGwpIHsKICAgIF9iYXNlLnRyYW5zbGF0aW9ucyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRpb25zLmRlID0gZGU7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gZGU7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgY3MsIF9iYXNlOwoKICBjcyA9IHsKICAgIHRvcEJhckhlYWRpbmc6ICdab29uaXZlcnNlIHByb2pla3QnLAogICAgc2lnblVwSGVhZGluZzogJ1Z5dHZvxZllbsOtIFpvb25pdmVyc2Ugw7rEjXR1JywKICAgIHNpZ25JbkhlYWRpbmc6ICdQxZlpaGxhxaFvdsOhbsOtIG5hIFpvb25pdmVyc2Ugw7rEjWV0JywKICAgIHNpZ25VcDogJ1phcmVnaXN0cm92YXQgc2UnLAogICAgc2lnbkluOiAnUMWZaWhsw6FzaXQgc2UnLAogICAgc2lnbk91dDogJ09kaGzDoXNpdCBzZScsCiAgICB1c2VybmFtZTogJ1XFvml2YXRlbHNrw6kgam3DqW5vJywKICAgIHBhc3N3b3JkOiAnSGVzbG8nLAogICAgZW1haWw6ICdFbWFpbCcsCiAgICByZWFsTmFtZTogJ1ByYXbDqSBqbcOpbm8nLAogICAgd2h5UmVhbE5hbWU6ICdUb3RvIGptw6lubyBiw712w6EgcG91xb5pdG8gcMWZaSBkxJtrb3bDoW7DrSBwxZlpc3DEm3ZhdGVsxa9tLCBuYXDFmS4gdiByb3pob3ZvcmVjaCBuZWJvIG5hIHBvc3RlcmVjaC4gUG9rdWQgc2kgbmVwxZllamV0ZSwgYWJ5IGJ5bG8gVmHFoWUgam3DqW5vIHp2ZcWZZWpuxJtubywgbmVjaHRlIHBvbMOtxI1rbyBwcsOhemRuw6kuJywKICAgIG5vQWNjb3VudDogJ05lbcOhdGUgamXFoXTEmyDDusSNZXQ/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAnU291aGxhc8OtbSBzZSA8YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy9wcml2YWN5IiB0YXJnZXQ9Il9ibGFuayI+esOhc2FkYW1pIG9jaHJhbnkgb3NvYm7DrWNoIMO6ZGFqxa88L2E+LicsCiAgICBiZXRhUHJlZmVyZW5jZTogJ0NoY2kgZG9zdMOhdmF0IG96bsOhbWVuw60gbyBtb8W+bm9zdGkgdGVzdG92w6Fuw60gZG9zdWQgbmV6dmXFmWVqbsSbbsO9Y2ggWm9vbml2ZXJzZSBwcm9qZWt0xa8gYSBwb3NreXRvdsOhbsOtIHpwxJt0bsOpIHZhemJ5LicsCiAgICBmb3Jnb3RQYXNzd29yZDogJ1phcG9tbsSbbGkganN0ZSBoZXNsbz8nLAogICAgYmFkTG9naW46ICdaYWRhbGkganN0ZSBjaHlibsOpIHXFvml2YXRlbHNrw6kgam3DqW5vLCBuZWJvIGhlc2xvLicsCiAgICBzaWduSW5GYWlsZWQ6ICdQxZlpaGzDocWhZW7DrSBzZSBuZXpkYcWZaWxvLicsCiAgICBzaWduSW5Gb3JQcm9maWxlOiAnSyB6b2JyYXplbsOtIFZhxaFlaG8gcHJvZmlsdSBqZSBudXRuw6kgc2UgcMWZaWhsw6FzaXQuJywKICAgIGZvb3RlckhlYWRpbmc6ICdab29uaXZlcnNlIGplIHNvdWJvciBvYsSNYW5za28gbmF1xI1uw71jaCB3ZWJvdsO9Y2ggcHJvamVrdMWvLCBrdGVyw6kgdnl1xb7DrXZhasOtIMO6c2lsw60gZG9icm92b2xuw61rxa8gcG9tb2N0IHbEm2Rjxa9tIHpwcmFjb3ZhdCBrdmFudGEgZGF0LCBqaW1pxb4ganNvdSBwxZlpIHN2w6ltIHbDvXprdW11IHphcGxhdmVuaS4nLAogICAgcHJpdmFjeVBvbGljeTogJ1rDoXNhZHkgb2NocmFueSBvc29ibsOtY2ggw7pkYWrFrycsCiAgICBmb3JrT25HaXRIdWI6ICdaZHJvam92w6kgc291Ym9yeSAmIGNoeWJ5JywKICAgIHJlY2VudHM6ICdOZWTDoXZuw6knLAogICAgZmF2b3JpdGVzOiAnT2Jsw61iZW7DqScsCiAgICBub25lOiAnxb3DoWRuw6knCiAgfTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLnRyYW5zbGF0aW9ucyA9PSBudWxsKSB7CiAgICBfYmFzZS50cmFuc2xhdGlvbnMgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLnRyYW5zbGF0aW9ucy5jcyA9IGNzOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGNzOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIHJvLCBfYmFzZTsKCiAgcm8gPSB7CiAgICB0b3BCYXJIZWFkaW5nOiAnVW4gcHJvaWVjdCBab29uaXZlcnNlJywKICAgIHNpZ25VcEhlYWRpbmc6ICdJbnJlZ2lzdHJlYXphIHVuIG5vdSBjb250IFpvb25pdmVyc2UnLAogICAgc2lnbkluSGVhZGluZzogJ0xvZ2hlYXphLXRlIGluIGNvdW50dWwgdGF1IFpvb25pdmVyc2UnLAogICAgc2lnblVwOiAnSW5yZWdpc3RyYXJlJywKICAgIHNpZ25JbjogJ0xvZ2FyZScsCiAgICBzaWduT3V0OiAnRGVsb2dhcmUnLAogICAgdXNlcm5hbWU6ICdOdW1lIHV0aWxpemF0b3InLAogICAgcGFzc3dvcmQ6ICdQYXJvbGEnLAogICAgZW1haWw6ICdFbWFpbCcsCiAgICByZWFsTmFtZTogJ051bWVsZSByZWFsJywKICAgIHdoeVJlYWxOYW1lOiAnQWNlc3RhIHZhIGZpIGZvbG9zaXQgcGVudHJ1IGEgbXVsdHVtaSBjb2xhYm9yYXRvcmlsb3IsIGRlIGV4ZW1wbHUsIGluIGRpc2N1dGlpIHNhdSBwZSBhZmlzZS4gRGFjYSBudSB2cmVpIHNhIGZpaSBtZW50aW9uYXQgaW4gcHVibGljLCBsYXNhIGFjZXN0IGNhbXAgbmVjb21wbGV0YXQuJywKICAgIG5vQWNjb3VudDogJ051IGFpIHVuIGNvbnQ/JywKICAgIGFncmVlVG9Qcml2YWN5UG9saWN5OiAnU3VudCBkZSBhY29yZCBjdSA8YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy9wcml2YWN5IiB0YXJnZXQ9Il9ibGFuayI+cmVndWxpbGUgZGUgY29uZmlkZW50aWFsaXRhdGU8L2E+LicsCiAgICBiZXRhUHJlZmVyZW5jZTogJ0FzIGRvcmkgc2EgcHJpbWVzYyBtZXNhamUgZGVzcHJlIG9wb3J0dW5pdGF0aSBkZSBhIHRlc3RhIHNpIGNvbWVudGEgZGVzcHJlIHByb2llY3RlIFpvb25pdmVyc2UgbmVsYW5zYXRlLicsCiAgICBmb3Jnb3RQYXNzd29yZDogJ0FpIHVpdGF0IHBhcm9sYT8nLAogICAgYmFkTG9naW46ICdOdW1lIHV0aWxpemF0b3Igc2F1IHBhcm9sYSBlc3RlIGluY29yZWN0YScsCiAgICBzaWduSW5GYWlsZWQ6ICdMb2dhcmVhIGEgZXN1YXQuJywKICAgIHNpZ25JbkZvclByb2ZpbGU6ICdMb2doZWF6YS10ZSBwZW50cnUgYS10aSB2ZWRlYSBwcm9maWx1bC4nLAogICAgZm9vdGVySGVhZGluZzogJ1pvb25pdmVyc2UgZXN0ZSBvIGNvbGVjdGllIGRlIHByb2llY3RlIHN0aWludGlmaWNlIGNvbmR1c2Ugb25saW5lIGluIGNhcmUgdm9sdW50YXJpaSBpaSBhanV0YSBwZSBjZXJjZXRhdG9yaSBzYSBhZG1pbmlzdHJlemUgYWZsdXh1bCBkZSBkYXRlIGN1IGNhcmUgc2UgY29uZnJ1bnRhLicsCiAgICBwcml2YWN5UG9saWN5OiAnUmVndWxpIGRlIGNvbmZpZGVudGlhbGl0YXRlJywKICAgIGZvcmtPbkdpdEh1YjogJ0NvZCBzdXJzYSBzaSBlcm9yaScsCiAgICByZWNlbnRzOiAnUmVjZW50ZScsCiAgICBmYXZvcml0ZXM6ICdGYXZvcml0ZScsCiAgICBub25lOiAnbmljaSB1bmEnCiAgfTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLnRyYW5zbGF0aW9ucyA9PSBudWxsKSB7CiAgICBfYmFzZS50cmFuc2xhdGlvbnMgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLnRyYW5zbGF0aW9ucy5ybyA9IHJvOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJvOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyICQsIEV2ZW50RW1pdHRlciwgbG9nVHJpZ2dlcnMsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgbG9nVHJpZ2dlcnMgPSAhIX5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJ2xvZz0xJyk7CgogIEV2ZW50RW1pdHRlciA9IChmdW5jdGlvbigpIHsKICAgIHZhciBtZXRob2QsIG1ldGhvZE5hbWU7CgogICAgZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkge30KCiAgICBFdmVudEVtaXR0ZXIub24gPSBmdW5jdGlvbihldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgICAgaWYgKHRoaXMualF1ZXJ5RXZlbnRQcm94eSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5qUXVlcnlFdmVudFByb3h5ID0gJCh7fSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMualF1ZXJ5RXZlbnRQcm94eS5vbihldmVudE5hbWUsIGhhbmRsZXIpOwogICAgfTsKCiAgICBFdmVudEVtaXR0ZXIub25lID0gZnVuY3Rpb24oZXZlbnROYW1lLCBoYW5kbGVyKSB7CiAgICAgIGlmICh0aGlzLmpRdWVyeUV2ZW50UHJveHkgPT0gbnVsbCkgewogICAgICAgIHRoaXMualF1ZXJ5RXZlbnRQcm94eSA9ICQoe30pOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmpRdWVyeUV2ZW50UHJveHkub25lKGV2ZW50TmFtZSwgaGFuZGxlcik7CiAgICB9OwoKICAgIEV2ZW50RW1pdHRlci5vZmYgPSBmdW5jdGlvbihldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgICAgaWYgKHRoaXMualF1ZXJ5RXZlbnRQcm94eSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5qUXVlcnlFdmVudFByb3h5ID0gJCh7fSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMualF1ZXJ5RXZlbnRQcm94eS5vZmYoZXZlbnROYW1lLCBoYW5kbGVyKTsKICAgIH07CgogICAgRXZlbnRFbWl0dGVyLnRyaWdnZXIgPSBmdW5jdGlvbihldmVudE5hbWUsIGFyZ3MpIHsKICAgICAgdmFyIF9iYXNlLCBfcmVmOwogICAgICBpZiAoYXJncyA9PSBudWxsKSB7CiAgICAgICAgYXJncyA9IFtdOwogICAgICB9CiAgICAgIGlmIChsb2dUcmlnZ2VycykgewogICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIgJiYgY29uc29sZSAhPT0gbnVsbCkgewogICAgICAgICAgY29uc29sZS5pbmZvKHRoaXMubmFtZSB8fCB0aGlzLnRvU3RyaW5nKCksIGV2ZW50TmFtZS50b1VwcGVyQ2FzZSgpLCBhcmdzKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHRoaXMualF1ZXJ5RXZlbnRQcm94eSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5qUXVlcnlFdmVudFByb3h5ID0gJCh7fSk7CiAgICAgIH0KICAgICAgKF9yZWYgPSB0aGlzLmpRdWVyeUV2ZW50UHJveHkpLnRyaWdnZXIuYXBwbHkoX3JlZiwgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHR5cGVvZiAoX2Jhc2UgPSB0aGlzLmNvbnN0cnVjdG9yKS50cmlnZ2VyID09PSAiZnVuY3Rpb24iID8gX2Jhc2UudHJpZ2dlcihldmVudE5hbWUsIFt0aGlzXS5jb25jYXQoYXJncykpIDogdm9pZCAwOwogICAgfTsKCiAgICBmb3IgKG1ldGhvZE5hbWUgaW4gRXZlbnRFbWl0dGVyKSB7CiAgICAgIGlmICghX19oYXNQcm9wLmNhbGwoRXZlbnRFbWl0dGVyLCBtZXRob2ROYW1lKSkgY29udGludWU7CiAgICAgIG1ldGhvZCA9IEV2ZW50RW1pdHRlclttZXRob2ROYW1lXTsKICAgICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IG1ldGhvZDsKICAgIH0KCiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy50cmlnZ2VyKCdkZXN0cm95aW5nJyk7CiAgICAgIHJldHVybiB0aGlzLm9mZigpOwogICAgfTsKCiAgICBpZiAobG9nVHJpZ2dlcnMpIHsKICAgICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAiIiArIHRoaXMuY29uc3RydWN0b3IubmFtZSArICIgaW5zdGFuY2UiOwogICAgICB9OwogICAgfQoKICAgIHJldHVybiBFdmVudEVtaXR0ZXI7CgogIH0pKCk7CgogIHdpbmRvdy56b29uaXZlcnNlLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBFdmVudEVtaXR0ZXI7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgRXZlbnRFbWl0dGVyLCBQcm94eUZyYW1lLCBiZXRhLCBkZW1vLCBmbGFnZ2VkSG9zdCwgaGlnaFBvcnQsIGh0bWwsIG1lc3NhZ2VJZCwgX3JlZiwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIEV2ZW50RW1pdHRlciA9IHdpbmRvdy56b29uaXZlcnNlLkV2ZW50RW1pdHRlciB8fCByZXF1aXJlKCcuL2V2ZW50LWVtaXR0ZXInKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIGh0bWwgPSAkKGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZSk7CgogIG1lc3NhZ2VJZCA9IC0xOwoKICBkZW1vID0gISF+bG9jYXRpb24uaG9zdG5hbWUuaW5kZXhPZignZGVtbycpOwoKICBiZXRhID0gISF+bG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZignYmV0YScpOwoKICBoaWdoUG9ydCA9ICtsb2NhdGlvbi5wb3J0ID49IDEwMjQ7CgogIGZsYWdnZWRIb3N0ID0gKF9yZWYgPSBsb2NhdGlvbi5zZWFyY2gubWF0Y2goL2FwaT0oW14mXSspLykpICE9IG51bGwgPyBfcmVmWzFdIDogdm9pZCAwOwoKICBpZiAoKGZsYWdnZWRIb3N0ICE9IG51bGwpICYmICEhIX5mbGFnZ2VkSG9zdC5pbmRleE9mKCcvLycpKSB7CiAgICBmbGFnZ2VkSG9zdCA9ICIvLyIgKyBmbGFnZ2VkSG9zdDsKICB9CgogIFByb3h5RnJhbWUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoUHJveHlGcmFtZSwgX3N1cGVyKTsKCiAgICBQcm94eUZyYW1lLlJFSkVDVElPTiA9ICdQcm94eUZyYW1lIG5vdCBjb25uZWN0ZWQnOwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLmhvc3QgPSBmbGFnZ2VkSG9zdCB8fCAoImh0dHBzOi8vIiArIChkZW1vIHx8IGJldGEgfHwgaGlnaFBvcnQgPyAnZGV2JyA6ICdhcGknKSArICIuem9vbml2ZXJzZS5vcmciKTsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5wYXRoID0gJy9wcm94eSc7CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUubG9hZFRpbWVvdXQgPSA1ICogMTAwMDsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5yZXRyeVRpbWVvdXQgPSAyICogNjAgKiAxMDAwOwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLmVsID0gbnVsbDsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5jbGFzc05hbWUgPSAncHJveHktZnJhbWUnOwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLmF0dGVtcHQgPSAwOwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLnJlYWR5ID0gZmFsc2U7CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUuZmFpbGVkID0gZmFsc2U7CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUuZGVmZXJyZWRzID0gbnVsbDsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5xdWV1ZSA9IG51bGw7CgogICAgZnVuY3Rpb24gUHJveHlGcmFtZShwYXJhbXMpIHsKICAgICAgdmFyIHByb3BlcnR5LCB2YWx1ZSwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIGlmIChwYXJhbXMgPT0gbnVsbCkgewogICAgICAgIHBhcmFtcyA9IHt9OwogICAgICB9CiAgICAgIHRoaXMudGltZW91dCA9IF9fYmluZCh0aGlzLnRpbWVvdXQsIHRoaXMpOwogICAgICBQcm94eUZyYW1lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBmb3IgKHByb3BlcnR5IGluIHBhcmFtcykgewogICAgICAgIGlmICghX19oYXNQcm9wLmNhbGwocGFyYW1zLCBwcm9wZXJ0eSkpIGNvbnRpbnVlOwogICAgICAgIHZhbHVlID0gcGFyYW1zW3Byb3BlcnR5XTsKICAgICAgICBpZiAocHJvcGVydHkgaW4gdGhpcyAmJiAodmFsdWUgIT0gbnVsbCkpIHsKICAgICAgICAgIHRoaXNbcHJvcGVydHldID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLmRlZmVycmVkcyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5kZWZlcnJlZHMgPSB7fTsKICAgICAgfQogICAgICBpZiAodGhpcy5xdWV1ZSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5xdWV1ZSA9IFtdOwogICAgICB9CiAgICAgICQod2luZG93KS5vbignbWVzc2FnZScsIGZ1bmN0aW9uKF9hcmcpIHsKICAgICAgICB2YXIgZTsKICAgICAgICBlID0gX2FyZy5vcmlnaW5hbEV2ZW50OwogICAgICAgIGlmIChlLnNvdXJjZSA9PT0gX3RoaXMuZWwuZ2V0KDApLmNvbnRlbnRXaW5kb3cpIHsKICAgICAgICAgIHJldHVybiBfdGhpcy5vbk1lc3NhZ2UuYXBwbHkoX3RoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5jb25uZWN0KCk7CiAgICB9CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGVzdEJhZCwgX3JlZjEsCiAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICB0ZXN0QmFkID0gdGhpcy5hdHRlbXB0IDwgMCA/ICdfQkFEJyA6ICcnOwogICAgICB0aGlzLmF0dGVtcHQgKz0gMTsKICAgICAgaWYgKChfcmVmMSA9IHRoaXMuZWwpICE9IG51bGwpIHsKICAgICAgICBfcmVmMS5yZW1vdmUoKTsKICAgICAgfQogICAgICB0aGlzLmVsID0gJCgiPGlmcmFtZSBzcmM9JyIgKyB0aGlzLmhvc3QgKyB0aGlzLnBhdGggKyB0ZXN0QmFkICsgIicgY2xhc3M9JyIgKyB0aGlzLmNsYXNzTmFtZSArICInIGRhdGEtYXR0ZW1wdD0nIiArIHRoaXMuYXR0ZW1wdCArICInIHN0eWxlPSdkaXNwbGF5OiBub25lOyc+PC9pZnJhbWU+Iik7CiAgICAgIHRoaXMuZWwuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSk7CiAgICAgIHJldHVybiBzZXRUaW1lb3V0KChmdW5jdGlvbigpIHsKICAgICAgICBpZiAoIV90aGlzLnJlYWR5KSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMudGltZW91dCgpOwogICAgICAgIH0KICAgICAgfSksIHRoaXMubG9hZFRpbWVvdXQpOwogICAgfTsKCiAgICBQcm94eUZyYW1lLnByb3RvdHlwZS5vblJlYWR5ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMuYXR0ZW1wdCA9IDA7CiAgICAgIHRoaXMucmVhZHkgPSB0cnVlOwogICAgICB0aGlzLmZhaWxlZCA9IGZhbHNlOwogICAgICBzZXRUaW1lb3V0KChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgcGF5bG9hZCwgX2ksIF9sZW4sIF9yZWYxLCBfcmVzdWx0czsKICAgICAgICBfcmVmMSA9IF90aGlzLnF1ZXVlOwogICAgICAgIF9yZXN1bHRzID0gW107CiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgcGF5bG9hZCA9IF9yZWYxW19pXTsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goX3RoaXMucHJvY2VzcyhwYXlsb2FkKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfSksIDEwMCk7CiAgICAgIGh0bWwucmVtb3ZlQ2xhc3MoJ29mZmxpbmUnKTsKICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcigncmVhZHknKTsKICAgIH07CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUudGltZW91dCA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnRyaWdnZXIoJ3RpbWVvdXQnLCB0aGlzLmxvYWRUaW1lb3V0KTsKICAgICAgcmV0dXJuIHRoaXMub25GYWlsZWQoKTsKICAgIH07CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUub25GYWlsZWQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHBheWxvYWQsIF9pLCBfbGVuLCBfcmVmMSwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIGlmICh0aGlzLnJlYWR5KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuZmFpbGVkID0gdHJ1ZTsKICAgICAgX3JlZjEgPSB0aGlzLnF1ZXVlOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYxLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgcGF5bG9hZCA9IF9yZWYxW19pXTsKICAgICAgICB0aGlzLmRlZmVycmVkc1twYXlsb2FkLmlkXS5yZWplY3QodGhpcy5jb25zdHJ1Y3Rvci5SRUpFQ1RJT04pOwogICAgICB9CiAgICAgIHRoaXMucXVldWUuc3BsaWNlKDApOwogICAgICBodG1sLmFkZENsYXNzKCdvZmZsaW5lJyk7CiAgICAgIHRoaXMudHJpZ2dlcignZmFpbCcpOwogICAgICByZXR1cm4gc2V0VGltZW91dCgoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLmNvbm5lY3QoKTsKICAgICAgfSksIHRoaXMucmV0cnlUaW1lb3V0KTsKICAgIH07CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKHBheWxvYWQsIGRvbmUsIGZhaWwpIHsKICAgICAgdmFyIGRlZmVycmVkLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgbWVzc2FnZUlkICs9IDE7CiAgICAgIHBheWxvYWQuaWQgPSBtZXNzYWdlSWQ7CiAgICAgIGRlZmVycmVkID0gbmV3ICQuRGVmZXJyZWQ7CiAgICAgIGRlZmVycmVkLnRoZW4oZG9uZSwgZmFpbCk7CiAgICAgIChmdW5jdGlvbihtZXNzYWdlSWQsIGRlZmVycmVkKSB7CiAgICAgICAgcmV0dXJuIGRlZmVycmVkLmFsd2F5cyhmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBkZWxldGUgX3RoaXMuZGVmZXJyZWRzW21lc3NhZ2VJZF07CiAgICAgICAgfSk7CiAgICAgIH0pKG1lc3NhZ2VJZCwgZGVmZXJyZWQpOwogICAgICB0aGlzLmRlZmVycmVkc1ttZXNzYWdlSWRdID0gZGVmZXJyZWQ7CiAgICAgIGlmICh0aGlzLmZhaWxlZCkgewogICAgICAgIGRlZmVycmVkLnJlamVjdCh0aGlzLmNvbnN0cnVjdG9yLlJFSkVDVElPTik7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5yZWFkeSkgewogICAgICAgIHRoaXMucHJvY2VzcyhwYXlsb2FkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnF1ZXVlLnB1c2gocGF5bG9hZCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKICAgIH07CgogICAgUHJveHlGcmFtZS5wcm90b3R5cGUucHJvY2VzcyA9IGZ1bmN0aW9uKHBheWxvYWQpIHsKICAgICAgcmV0dXJuIHRoaXMuZWwuZ2V0KDApLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksIHRoaXMuaG9zdCk7CiAgICB9OwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uKF9hcmcpIHsKICAgICAgdmFyIGUsIG1lc3NhZ2U7CiAgICAgIGUgPSBfYXJnLm9yaWdpbmFsRXZlbnQ7CiAgICAgIG1lc3NhZ2UgPSBKU09OLnBhcnNlKGUuZGF0YSk7CiAgICAgIGlmIChtZXNzYWdlLmlkID09PSAnUkVBRFknKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub25SZWFkeSgpOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmZhaWx1cmUpIHsKICAgICAgICB0aGlzLmRlZmVycmVkc1ttZXNzYWdlLmlkXS5yZWplY3QobWVzc2FnZS5yZXNwb25zZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kZWZlcnJlZHNbbWVzc2FnZS5pZF0ucmVzb2x2ZShtZXNzYWdlLnJlc3BvbnNlKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCdyZXNwb25zZScsIFttZXNzYWdlXSk7CiAgICB9OwoKICAgIFByb3h5RnJhbWUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5lbC5yZW1vdmUoKTsKICAgICAgcmV0dXJuIFByb3h5RnJhbWUuX19zdXBlcl9fLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CgogICAgcmV0dXJuIFByb3h5RnJhbWU7CgogIH0pKEV2ZW50RW1pdHRlcik7CgogIHdpbmRvdy56b29uaXZlcnNlLlByb3h5RnJhbWUgPSBQcm94eUZyYW1lOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFByb3h5RnJhbWU7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgQXBpLCBFdmVudEVtaXR0ZXIsIFByb3h5RnJhbWUsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LAogICAgX19zbGljZSA9IFtdLnNsaWNlOwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIEV2ZW50RW1pdHRlciA9IHdpbmRvdy56b29uaXZlcnNlLkV2ZW50RW1pdHRlciB8fCByZXF1aXJlKCcuL2V2ZW50LWVtaXR0ZXInKTsKCiAgUHJveHlGcmFtZSA9IHdpbmRvdy56b29uaXZlcnNlLlByb3h5RnJhbWUgfHwgcmVxdWlyZSgnLi9wcm94eS1mcmFtZScpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgQXBpID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKEFwaSwgX3N1cGVyKTsKCiAgICBBcGkuY3VycmVudCA9IG51bGw7CgogICAgQXBpLnByb3RvdHlwZS5wcm9qZWN0ID0gJy4nOwoKICAgIEFwaS5wcm90b3R5cGUuaGVhZGVycyA9IHt9OwoKICAgIEFwaS5wcm90b3R5cGUucHJveHlGcmFtZSA9IG51bGw7CgogICAgZnVuY3Rpb24gQXBpKF9hcmcpIHsKICAgICAgdmFyIGhvc3QsIGxvYWRUaW1lb3V0LCBwYXRoLCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgX3JlZiA9IF9hcmcgIT0gbnVsbCA/IF9hcmcgOiB7fSwgdGhpcy5wcm9qZWN0ID0gX3JlZi5wcm9qZWN0LCBob3N0ID0gX3JlZi5ob3N0LCBwYXRoID0gX3JlZi5wYXRoLCBsb2FkVGltZW91dCA9IF9yZWYubG9hZFRpbWVvdXQ7CiAgICAgIEFwaS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgdGhpcy5wcm94eUZyYW1lID0gbmV3IFByb3h5RnJhbWUoewogICAgICAgIGhvc3Q6IGhvc3QsCiAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICBsb2FkVGltZW91dDogbG9hZFRpbWVvdXQKICAgICAgfSk7CiAgICAgIHRoaXMucHJveHlGcmFtZS5vbigncmVhZHknLCBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gX3RoaXMudHJpZ2dlcigncmVhZHknKTsKICAgICAgfSk7CiAgICAgIHRoaXMucHJveHlGcmFtZS5vbignZmFpbCcsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy50cmlnZ2VyKCdmYWlsJyk7CiAgICAgIH0pOwogICAgICB0aGlzLnNlbGVjdCgpOwogICAgfQoKICAgIEFwaS5wcm90b3R5cGUucmVxdWVzdCA9IGZ1bmN0aW9uKHR5cGUsIHVybCwgZGF0YSwgZG9uZSwgZmFpbCkgewogICAgICB2YXIgX3JlZjsKICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgX3JlZiA9IFtkb25lLCBkYXRhLCBudWxsXSwgZmFpbCA9IF9yZWZbMF0sIGRvbmUgPSBfcmVmWzFdLCBkYXRhID0gX3JlZlsyXTsKICAgICAgICB0aGlzLnRyaWdnZXIoJ3JlcXVlc3QnLCBbdHlwZSwgdXJsLCBkYXRhXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMucHJveHlGcmFtZS5zZW5kKHsKICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgIHVybDogdXJsLAogICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzCiAgICAgIH0sIGRvbmUsIGZhaWwpOwogICAgfTsKCiAgICBBcGkucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gd2luZG93LnJlcSA9IHRoaXMucmVxdWVzdC5hcHBseSh0aGlzLCBbJ2dldCddLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgfTsKCiAgICBBcGkucHJvdG90eXBlLmdldEpTT04gPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdC5hcHBseSh0aGlzLCBbJ2dldEpTT04nXS5jb25jYXQoX19zbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgIH07CgogICAgQXBpLnByb3RvdHlwZS5wb3N0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QuYXBwbHkodGhpcywgWydwb3N0J10uY29uY2F0KF9fc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICB9OwoKICAgIEFwaS5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QuYXBwbHkodGhpcywgWydwdXQnXS5jb25jYXQoX19zbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgIH07CgogICAgQXBpLnByb3RvdHlwZVsiZGVsZXRlIl0gPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdC5hcHBseSh0aGlzLCBbJ2RlbGV0ZSddLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgfTsKCiAgICBBcGkucHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnRyaWdnZXIoJ3NlbGVjdCcpOwogICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci5jdXJyZW50ID0gdGhpczsKICAgIH07CgogICAgQXBpLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucHJveHlGcmFtZS5kZXN0cm95KCk7CiAgICAgIHJldHVybiBBcGkuX19zdXBlcl9fLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CgogICAgcmV0dXJuIEFwaTsKCiAgfSkoRXZlbnRFbWl0dGVyKTsKCiAgd2luZG93Lnpvb25pdmVyc2UuQXBpID0gQXBpOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEFwaTsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciB0b2dnbGVDbGFzcywgX2Jhc2UsCiAgICBfX2luZGV4T2YgPSBbXS5pbmRleE9mIHx8IGZ1bmN0aW9uKGl0ZW0pIHsgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKykgeyBpZiAoaSBpbiB0aGlzICYmIHRoaXNbaV0gPT09IGl0ZW0pIHJldHVybiBpOyB9IHJldHVybiAtMTsgfTsKCiAgdG9nZ2xlQ2xhc3MgPSBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUsIGNvbmRpdGlvbikgewogICAgdmFyIGNsYXNzTGlzdCwgY29udGFpbmVkOwogICAgY2xhc3NMaXN0ID0gZWxlbWVudC5jbGFzc05hbWUuc3BsaXQoL1xzKy8pOwogICAgY29udGFpbmVkID0gX19pbmRleE9mLmNhbGwoY2xhc3NMaXN0LCBjbGFzc05hbWUpID49IDA7CiAgICBpZiAoY29uZGl0aW9uID09IG51bGwpIHsKICAgICAgY29uZGl0aW9uID0gIWNvbnRhaW5lZDsKICAgIH0KICAgIGNvbmRpdGlvbiA9ICEhY29uZGl0aW9uOwogICAgaWYgKCFjb250YWluZWQgJiYgY29uZGl0aW9uID09PSB0cnVlKSB7CiAgICAgIGNsYXNzTGlzdC5wdXNoKGNsYXNzTmFtZSk7CiAgICB9CiAgICBpZiAoY29udGFpbmVkICYmIGNvbmRpdGlvbiA9PT0gZmFsc2UpIHsKICAgICAgY2xhc3NMaXN0LnNwbGljZShjbGFzc0xpc3QuaW5kZXhPZihjbGFzc05hbWUpLCAxKTsKICAgIH0KICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3NMaXN0LmpvaW4oJyAnKTsKICAgIHJldHVybiBudWxsOwogIH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS51dGlsID09IG51bGwpIHsKICAgIF9iYXNlLnV0aWwgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLnV0aWwudG9nZ2xlQ2xhc3MgPSB0b2dnbGVDbGFzczsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSB0b2dnbGVDbGFzczsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBFdmVudEVtaXR0ZXIsIExhbmd1YWdlTWFuYWdlciwgX3JlZiwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LAogICAgX19pbmRleE9mID0gW10uaW5kZXhPZiB8fCBmdW5jdGlvbihpdGVtKSB7IGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsgaWYgKGkgaW4gdGhpcyAmJiB0aGlzW2ldID09PSBpdGVtKSByZXR1cm4gaTsgfSByZXR1cm4gLTE7IH07CgogIEV2ZW50RW1pdHRlciA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZi5FdmVudEVtaXR0ZXIgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4vZXZlbnQtZW1pdHRlcicpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgTGFuZ3VhZ2VNYW5hZ2VyID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKExhbmd1YWdlTWFuYWdlciwgX3N1cGVyKTsKCiAgICBMYW5ndWFnZU1hbmFnZXIuY3VycmVudCA9IG51bGw7CgogICAgTGFuZ3VhZ2VNYW5hZ2VyLmRlZmF1bHRMb2NhbGUgPSAnZW4nOwoKICAgIExhbmd1YWdlTWFuYWdlci5wcm90b3R5cGUudHJhbnNsYXRpb25zID0gbnVsbDsKCiAgICBMYW5ndWFnZU1hbmFnZXIucHJvdG90eXBlLmNvZGUgPSBudWxsOwoKICAgIGZ1bmN0aW9uIExhbmd1YWdlTWFuYWdlcihwYXJhbXMpIHsKICAgICAgdGhpcy5kZWZhdWx0U3RyaW5nc0Zvcm1hdCA9IF9fYmluZCh0aGlzLmRlZmF1bHRTdHJpbmdzRm9ybWF0LCB0aGlzKTsKICAgICAgdGhpcy5sYWJlbCA9IF9fYmluZCh0aGlzLmxhYmVsLCB0aGlzKTsKICAgICAgdmFyIHByb3BlcnR5LCB2YWx1ZSwgX2Jhc2UsIF9uYW1lLCBfcmVmMSwgX3JlZjIsIF9yZWYzLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgZm9yIChwcm9wZXJ0eSBpbiBwYXJhbXMpIHsKICAgICAgICBpZiAoIV9faGFzUHJvcC5jYWxsKHBhcmFtcywgcHJvcGVydHkpKSBjb250aW51ZTsKICAgICAgICB2YWx1ZSA9IHBhcmFtc1twcm9wZXJ0eV07CiAgICAgICAgaWYgKHByb3BlcnR5IGluIHRoaXMpIHsKICAgICAgICAgIHRoaXNbcHJvcGVydHldID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLnRyYW5zbGF0aW9ucyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy50cmFuc2xhdGlvbnMgPSB7fTsKICAgICAgfQogICAgICBpZiAodGhpcy5jb2RlID09IG51bGwpIHsKICAgICAgICB0aGlzLmNvZGUgPSAoX3JlZjEgPSBsb2NhdGlvbi5zZWFyY2gubWF0Y2goL2xhbmc9KFteJl0rKS8pKSAhPSBudWxsID8gX3JlZjFbMV0gOiB2b2lkIDA7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29kZSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5jb2RlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3pvb25pdmVyc2UtbGFuZ3VhZ2UtY29kZScpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmNvZGUgPT0gbnVsbCkgewogICAgICAgIHRoaXMuY29kZSA9IChfcmVmMiA9IG5hdmlnYXRvci5sYW5ndWFnZSkgIT0gbnVsbCA/IF9yZWYyLnNwbGl0KCctJylbMF0gOiB2b2lkIDA7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29kZSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5jb2RlID0gKF9yZWYzID0gbmF2aWdhdG9yLnVzZXJMYW5ndWFnZSkgIT0gbnVsbCA/IF9yZWYzLnNwbGl0KCctJylbMF0gOiB2b2lkIDA7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29kZSA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5jb2RlID0gdGhpcy5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuY29kZTsKICAgICAgfQogICAgICBpZiAoX19pbmRleE9mLmNhbGwodGhpcy5jb2RlLCAnLycpID49IDAgfHwgX19pbmRleE9mLmNhbGwodGhpcy5jb2RlLCAnLmpzb24nKSA+PSAwKSB7CiAgICAgICAgaWYgKChfYmFzZSA9IHRoaXMudHJhbnNsYXRpb25zKVtfbmFtZSA9IHRoaXMuY29kZV0gPT0gbnVsbCkgewogICAgICAgICAgX2Jhc2VbX25hbWVdID0gewogICAgICAgICAgICBsYWJlbDogdGhpcy5jb2RlLAogICAgICAgICAgICBzdHJpbmdzOiB0aGlzLmNvZGUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuY29uc3RydWN0b3IuY3VycmVudCA9IHRoaXM7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLnNldExhbmd1YWdlKF90aGlzLmNvZGUpOwogICAgICB9KTsKICAgIH0KCiAgICBMYW5ndWFnZU1hbmFnZXIucHJvdG90eXBlLnNldExhbmd1YWdlID0gZnVuY3Rpb24oY29kZSwgZG9uZSwgZmFpbCkgewogICAgICB2YXIgbG9jYWxTdHJpbmdzLCBwYXRoVG9TdHJpbmdzLCByZXF1ZXN0LCBfcmVmMSwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMuY29kZSA9IGNvZGU7CiAgICAgIGlmICh0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvZGVdID09IG51bGwpIHsKICAgICAgICB0aGlzLmNvZGUgPSB0aGlzLmNvbnN0cnVjdG9yLmRlZmF1bHRMb2NhbGU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMudHJhbnNsYXRpb25zW3RoaXMuY29kZV0uc3RyaW5ncyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy50cmFuc2xhdGlvbnNbdGhpcy5jb2RlXS5zdHJpbmdzID0gdGhpcy5kZWZhdWx0U3RyaW5nc0Zvcm1hdCgpOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgdGhpcy50cmFuc2xhdGlvbnNbdGhpcy5jb2RlXS5zdHJpbmdzID09PSAnc3RyaW5nJykgewogICAgICAgIHBhdGhUb1N0cmluZ3MgPSAoX3JlZjEgPSB0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvZGVdKSAhPSBudWxsID8gX3JlZjEuc3RyaW5ncyA6IHZvaWQgMDsKICAgICAgICBsb2NhbFN0cmluZ3MgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ6b29uaXZlcnNlLWxhbmd1YWdlLXN0cmluZ3MtIiArIHRoaXMuY29kZSkpOwogICAgICAgIGlmIChsb2NhbFN0cmluZ3MgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy50cmFuc2xhdGlvbnNbdGhpcy5jb2RlXS5zdHJpbmdzID0gbG9jYWxTdHJpbmdzOwogICAgICAgICAgdGhpcy5zZXRMYW5ndWFnZSh0aGlzLmNvZGUsIGRvbmUsIGZhaWwpOwogICAgICAgIH0KICAgICAgICByZXF1ZXN0ID0gJC5nZXRKU09OKHBhdGhUb1N0cmluZ3MpOwogICAgICAgIHJlcXVlc3QuZG9uZShmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiem9vbml2ZXJzZS1sYW5ndWFnZS1zdHJpbmdzLSIgKyBfdGhpcy5jb2RlLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgICAgICAgICBfdGhpcy50cmFuc2xhdGlvbnNbX3RoaXMuY29kZV0uc3RyaW5ncyA9IGRhdGE7CiAgICAgICAgICByZXR1cm4gX3RoaXMuc2V0TGFuZ3VhZ2UoX3RoaXMuY29kZSwgZG9uZSwgZmFpbCk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlcXVlc3QuZmFpbChmdW5jdGlvbigpIHsKICAgICAgICAgIF90aGlzLnRyaWdnZXIoJ2xhbmd1YWdlLWZldGNoLWZhaWwnKTsKICAgICAgICAgIHJldHVybiB0eXBlb2YgZmFpbCA9PT0gImZ1bmN0aW9uIiA/IGZhaWwuYXBwbHkobnVsbCwgYXJndW1lbnRzKSA6IHZvaWQgMDsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnem9vbml2ZXJzZS1sYW5ndWFnZS1jb2RlJywgdGhpcy5jb2RlKTsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJykubGFuZyA9IHRoaXMuY29kZTsKICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZS1sYW5ndWFnZScsIFt0aGlzLmNvZGUsIHRoaXMudHJhbnNsYXRpb25zW3RoaXMuY29kZV0uc3RyaW5nc10pOwogICAgICAgIHJldHVybiB0eXBlb2YgZG9uZSA9PT0gImZ1bmN0aW9uIiA/IGRvbmUodGhpcy5jb2RlLCB0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvZGVdLnN0cmluZ3MpIDogdm9pZCAwOwogICAgICB9CiAgICB9OwoKICAgIExhbmd1YWdlTWFuYWdlci5wcm90b3R5cGUubGFiZWwgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9yZWYxLCBfcmVmMjsKICAgICAgcmV0dXJuICgoX3JlZjEgPSB0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvZGVdKSAhPSBudWxsID8gX3JlZjEubGFiZWwgOiB2b2lkIDApIHx8ICgoX3JlZjIgPSB0aGlzLnRyYW5zbGF0aW9uc1t0aGlzLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5jb2RlXSkgIT0gbnVsbCA/IF9yZWYyLmxhYmVsIDogdm9pZCAwKTsKICAgIH07CgogICAgTGFuZ3VhZ2VNYW5hZ2VyLnByb3RvdHlwZS5kZWZhdWx0U3RyaW5nc0Zvcm1hdCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gIi4vdHJhbnNsYXRpb25zLyIgKyB0aGlzLmNvZGUgKyAiLmpzb24iOwogICAgfTsKCiAgICByZXR1cm4gTGFuZ3VhZ2VNYW5hZ2VyOwoKICB9KShFdmVudEVtaXR0ZXIpOwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLkxhbmd1YWdlTWFuYWdlciA9IExhbmd1YWdlTWFuYWdlcjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBMYW5ndWFnZU1hbmFnZXI7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgTGFuZ3VhZ2VNYW5hZ2VyLCB0cmFuc2xhdGUsIF9yZWYsIF9yZWYxLCBfcmVmMTAsIF9yZWYxMSwgX3JlZjEyLCBfcmVmMTMsIF9yZWYxNCwgX3JlZjE1LCBfcmVmMTYsIF9yZWYxNywgX3JlZjE4LCBfcmVmMTksIF9yZWYyLCBfcmVmMjAsIF9yZWYzLCBfcmVmNCwgX3JlZjUsIF9yZWY2LCBfcmVmNywgX3JlZjgsIF9yZWY5LAogICAgX19zbGljZSA9IFtdLnNsaWNlOwoKICBMYW5ndWFnZU1hbmFnZXIgPSAoKF9yZWYgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IF9yZWYuTGFuZ3VhZ2VNYW5hZ2VyIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL2xhbmd1YWdlLW1hbmFnZXInKTsKCiAgdHJhbnNsYXRlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZWxlbWVudCwga2V5LCB0YWcsIF9hcmcsIF9pOwogICAgX2FyZyA9IDIgPD0gYXJndW1lbnRzLmxlbmd0aCA/IF9fc2xpY2UuY2FsbChhcmd1bWVudHMsIDAsIF9pID0gYXJndW1lbnRzLmxlbmd0aCAtIDEpIDogKF9pID0gMCwgW10pLCBrZXkgPSBhcmd1bWVudHNbX2krK107CiAgICB0YWcgPSBfYXJnWzBdOwogICAgaWYgKHRhZyA9PSBudWxsKSB7CiAgICAgIHRhZyA9ICdzcGFuJzsKICAgIH0KICAgIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7CiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSh0cmFuc2xhdGUuYXR0ciwga2V5KTsKICAgIHRyYW5zbGF0ZS5yZWZyZXNoKGVsZW1lbnQpOwogICAgcmV0dXJuIGVsZW1lbnQub3V0ZXJIVE1MOwogIH07CgogIHRyYW5zbGF0ZS5hdHRyID0gJ2RhdGEtem9vbml2ZXJzZS10cmFuc2xhdGUnOwoKICB0cmFuc2xhdGUuc3RyaW5ncyA9IHsKICAgIGVuOiAoKF9yZWYxID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjIgPSBfcmVmMS50cmFuc2xhdGlvbnMpICE9IG51bGwgPyBfcmVmMi5lbiA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdHJhbnNsYXRpb25zL2VuJyksCiAgICBlczogKChfcmVmMyA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWY0ID0gX3JlZjMudHJhbnNsYXRpb25zKSAhPSBudWxsID8gX3JlZjQuZXMgOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL3RyYW5zbGF0aW9ucy9lcycpLAogICAgZnI6ICgoX3JlZjUgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmNiA9IF9yZWY1LnRyYW5zbGF0aW9ucykgIT0gbnVsbCA/IF9yZWY2LmZyIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi90cmFuc2xhdGlvbnMvZnInKSwKICAgIHBsOiAoKF9yZWY3ID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjggPSBfcmVmNy50cmFuc2xhdGlvbnMpICE9IG51bGwgPyBfcmVmOC5wbCA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdHJhbnNsYXRpb25zL3BsJyksCiAgICBydTogKChfcmVmOSA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYxMCA9IF9yZWY5LnRyYW5zbGF0aW9ucykgIT0gbnVsbCA/IF9yZWYxMC5ydSA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdHJhbnNsYXRpb25zL3J1JyksCiAgICB6aF90dzogKChfcmVmMTEgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMTIgPSBfcmVmMTEudHJhbnNsYXRpb25zKSAhPSBudWxsID8gX3JlZjEyLnpoX3R3IDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi90cmFuc2xhdGlvbnMvemgtdHcnKSwKICAgIHpoX2NuOiAoKF9yZWYxMyA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYxNCA9IF9yZWYxMy50cmFuc2xhdGlvbnMpICE9IG51bGwgPyBfcmVmMTQuemhfY24gOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL3RyYW5zbGF0aW9ucy96aC1jbicpLAogICAgZGU6ICgoX3JlZjE1ID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjE2ID0gX3JlZjE1LnRyYW5zbGF0aW9ucykgIT0gbnVsbCA/IF9yZWYxNi5kZSA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdHJhbnNsYXRpb25zL2RlJyksCiAgICBjczogKChfcmVmMTcgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMTggPSBfcmVmMTcudHJhbnNsYXRpb25zKSAhPSBudWxsID8gX3JlZjE4LmNzIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi90cmFuc2xhdGlvbnMvY3MnKSwKICAgIHJvOiAoKF9yZWYxOSA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYyMCA9IF9yZWYxOS50cmFuc2xhdGlvbnMpICE9IG51bGwgPyBfcmVmMjAucm8gOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL3RyYW5zbGF0aW9ucy9ybycpCiAgfTsKCiAgdHJhbnNsYXRlLnJlZnJlc2ggPSBmdW5jdGlvbihlbGVtZW50LCBrZXkpIHsKICAgIHZhciBuYW1lLCBwcm9wZXJ0eSwgc3RyaW5nLCB2YWx1ZSwgX2ksIF9sZW4sIF9yZWYyMSwgX3JlZjIyLCBfcmVmMjMsIF9yZWYyNCwgX3JlZjI1LCBfcmVzdWx0czsKICAgIF9yZWYyMSA9IGVsZW1lbnQuYXR0cmlidXRlczsKICAgIF9yZXN1bHRzID0gW107CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYyMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICBfcmVmMjIgPSBfcmVmMjFbX2ldLCBuYW1lID0gX3JlZjIyLm5hbWUsIHZhbHVlID0gX3JlZjIyLnZhbHVlOwogICAgICBpZiAobmFtZS5zbGljZSgwLCB0cmFuc2xhdGUuYXR0ci5sZW5ndGgpICE9PSB0cmFuc2xhdGUuYXR0cikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwcm9wZXJ0eSA9IG5hbWUuc2xpY2UodHJhbnNsYXRlLmF0dHIubGVuZ3RoICsgMSkgfHwgJ2lubmVySFRNTCc7CiAgICAgIHN0cmluZyA9IChfcmVmMjMgPSB0cmFuc2xhdGUuc3RyaW5nc1soX3JlZjI0ID0gTGFuZ3VhZ2VNYW5hZ2VyLmN1cnJlbnQpICE9IG51bGwgPyBfcmVmMjQuY29kZSA6IHZvaWQgMF0pICE9IG51bGwgPyBfcmVmMjNbdmFsdWVdIDogdm9pZCAwOwogICAgICBzdHJpbmcgfHwgKHN0cmluZyA9IChfcmVmMjUgPSB0cmFuc2xhdGUuc3RyaW5nc1tMYW5ndWFnZU1hbmFnZXIuZGVmYXVsdExvY2FsZV0pICE9IG51bGwgPyBfcmVmMjVbdmFsdWVdIDogdm9pZCAwKTsKICAgICAgc3RyaW5nIHx8IChzdHJpbmcgPSB2YWx1ZSk7CiAgICAgIGlmIChlbGVtZW50Lmhhc0F0dHJpYnV0ZShwcm9wZXJ0eSkpIHsKICAgICAgICBfcmVzdWx0cy5wdXNoKGVsZW1lbnQuc2V0QXR0cmlidXRlKHByb3BlcnR5LCBzdHJpbmcpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfcmVzdWx0cy5wdXNoKGVsZW1lbnRbcHJvcGVydHldID0gc3RyaW5nKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIF9yZXN1bHRzOwogIH07CgogIExhbmd1YWdlTWFuYWdlci5vbignY2hhbmdlLWxhbmd1YWdlJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgZWxlbWVudCwgX2ksIF9sZW4sIF9yZWYyMSwgX3Jlc3VsdHM7CiAgICBfcmVmMjEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbIiArIHRyYW5zbGF0ZS5hdHRyICsgIl0iKTsKICAgIF9yZXN1bHRzID0gW107CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYyMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICBlbGVtZW50ID0gX3JlZjIxW19pXTsKICAgICAgX3Jlc3VsdHMucHVzaCh0cmFuc2xhdGUucmVmcmVzaChlbGVtZW50KSk7CiAgICB9CiAgICByZXR1cm4gX3Jlc3VsdHM7CiAgfSk7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UudHJhbnNsYXRlID0gdHJhbnNsYXRlOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHRyYW5zbGF0ZTsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBFdmVudEVtaXR0ZXIsIEdBX1NDT1BFUywgR29vZ2xlQW5hbHl0aWNzLCBnYVNyYywgX3JlZiwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH0sCiAgICBfX3NsaWNlID0gW10uc2xpY2U7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgRXZlbnRFbWl0dGVyID0gd2luZG93Lnpvb25pdmVyc2UuRXZlbnRFbWl0dGVyIHx8IHJlcXVpcmUoJy4vZXZlbnQtZW1pdHRlcicpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgR0FfU0NPUEVTID0gewogICAgdmlzaXRvcjogMSwKICAgIHNlc3Npb246IDIsCiAgICBwYWdlOiAzCiAgfTsKCiAgZ2FTcmMgPSAnaHR0cDovL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9nYS5qcyc7CgogIGlmICh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonKSB7CiAgICBnYVNyYyA9IGdhU3JjLnJlcGxhY2UoJ2h0dHA6Ly93d3cnLCAnaHR0cHM6Ly9zc2wnKTsKICB9CgogIEdvb2dsZUFuYWx5dGljcyA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhHb29nbGVBbmFseXRpY3MsIF9zdXBlcik7CgogICAgR29vZ2xlQW5hbHl0aWNzLmN1cnJlbnQgPSBudWxsOwoKICAgIEdvb2dsZUFuYWx5dGljcy5wcm90b3R5cGUuYWNjb3VudCA9ICcnOwoKICAgIEdvb2dsZUFuYWx5dGljcy5wcm90b3R5cGUuZG9tYWluID0gJyc7CgogICAgR29vZ2xlQW5hbHl0aWNzLnByb3RvdHlwZS50cmFja0hhc2hlcyA9IHRydWU7CgogICAgR29vZ2xlQW5hbHl0aWNzLnByb3RvdHlwZS5pZ25vcmVkU3ViZG9tYWluUmVmcyA9IFsnd3d3J107CgogICAgZnVuY3Rpb24gR29vZ2xlQW5hbHl0aWNzKHBhcmFtcykgewogICAgICB2YXIgcHJvcGVydHksIHN1YmRvbWFpbiwgdmFsdWUsIF9pLCBfbGVuLCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAgcGFyYW1zID0ge307CiAgICAgIH0KICAgICAgZm9yIChwcm9wZXJ0eSBpbiBwYXJhbXMpIHsKICAgICAgICB2YWx1ZSA9IHBhcmFtc1twcm9wZXJ0eV07CiAgICAgICAgdGhpc1twcm9wZXJ0eV0gPSB2YWx1ZTsKICAgICAgfQogICAgICB0aGlzLnNlbGVjdCgpOwogICAgICBpZiAoIXdpbmRvdy5fZ2FxKSB7CiAgICAgICAgJC5nZXRTY3JpcHQoZ2FTcmMpOwogICAgICB9CiAgICAgIGlmICh3aW5kb3cuX2dhcSA9PSBudWxsKSB7CiAgICAgICAgd2luZG93Ll9nYXEgPSBbXTsKICAgICAgfQogICAgICB3aW5kb3cuX2dhcS5wdXNoKFsnX3NldEFjY291bnQnLCB0aGlzLmFjY291bnRdKTsKICAgICAgd2luZG93Ll9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3J10pOwogICAgICBpZiAodGhpcy5kb21haW4pIHsKICAgICAgICB3aW5kb3cuX2dhcS5wdXNoKFsnX3NldERvbWFpbk5hbWUnLCB0aGlzLmRvbWFpbl0pOwogICAgICAgIF9yZWYgPSB0aGlzLmlnbm9yZWRTdWJkb21haW5SZWZzOwogICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgc3ViZG9tYWluID0gX3JlZltfaV07CiAgICAgICAgICB3aW5kb3cuX2dhcS5wdXNoKFsnX2FkZElnbm9yZWRSZWYnLCAiIiArIHN1YmRvbWFpbiArICIuIiArIHRoaXMuZG9tYWluXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLnRyYWNrSGFzaGVzKSB7CiAgICAgICAgJCh3aW5kb3cpLm9uKCdoYXNoY2hhbmdlJywgKGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzLnRyYWNrKCk7CiAgICAgICAgfSkpOwogICAgICB9CiAgICB9CgogICAgR29vZ2xlQW5hbHl0aWNzLnByb3RvdHlwZS5zZWxlY3QgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5jdXJyZW50ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcignc2VsZWN0Jyk7CiAgICB9OwoKICAgIEdvb2dsZUFuYWx5dGljcy5wcm90b3R5cGUudHJhY2sgPSBmdW5jdGlvbihwYXRobmFtZSkgewogICAgICBpZiAodHlwZW9mIHBhdGhuYW1lICE9PSAnc3RyaW5nJykgewogICAgICAgIHBhdGhuYW1lID0gIi8iICsgbG9jYXRpb24uaGFzaDsKICAgICAgfQogICAgICB3aW5kb3cuX2dhcS5wdXNoKFsnX3RyYWNrUGFnZXZpZXcnLCBwYXRobmFtZV0pOwogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCd0cmFjaycsIFtwYXRobmFtZV0pOwogICAgfTsKCiAgICBHb29nbGVBbmFseXRpY3MucHJvdG90eXBlLmV2ZW50ID0gZnVuY3Rpb24oY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlLCBpZ25vcmVGb3JCb3VuY2VSYXRlKSB7CiAgICAgIHdpbmRvdy5fZ2FxLnB1c2goWydfdHJhY2tFdmVudCddLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCdldmVudCcsIF9fc2xpY2UuY2FsbChhcmd1bWVudHMpKTsKICAgIH07CgogICAgR29vZ2xlQW5hbHl0aWNzLnByb3RvdHlwZS5jdXN0b20gPSBmdW5jdGlvbihpbmRleCwga2V5LCB2YWx1ZSwgc2NvcGUpIHsKICAgICAgdmFyIGNvbW1hbmQ7CiAgICAgIGlmICh0eXBlb2YgaW5kZXggPT09ICdzdHJpbmcnKSB7CiAgICAgICAgaW5kZXggPSB0aGlzLmNvbnN0cnVjdG9yLmluZGljZXNbaW5kZXhdOwogICAgICB9CiAgICAgIGlmICh0eXBlb2Ygc2NvcGUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgc2NvcGUgPSBHQV9TQ09QRVNbc2NvcGVdOwogICAgICB9CiAgICAgIGNvbW1hbmQgPSBbJ19zZXRDdXN0b21WYXInLCBpbmRleCwga2V5LCB2YWx1ZV07CiAgICAgIGlmIChzY29wZSAhPSBudWxsKSB7CiAgICAgICAgY29tbWFuZC5wdXNoKHNjb3BlKTsKICAgICAgfQogICAgICB3aW5kb3cuX2dhcS5wdXNoKGNvbW1hbmQpOwogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCdjdXN0b20nLCBfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSk7CiAgICB9OwoKICAgIHJldHVybiBHb29nbGVBbmFseXRpY3M7CgogIH0pKEV2ZW50RW1pdHRlcik7CgogIGlmICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsKSB7CiAgICBfcmVmLkdvb2dsZUFuYWx5dGljcyA9IEdvb2dsZUFuYWx5dGljczsKICB9CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gR29vZ2xlQW5hbHl0aWNzOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIEJhc2VNb2RlbCwgRXZlbnRFbWl0dGVyLCBfYmFzZSwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5tb2RlbHMgPT0gbnVsbCkgewogICAgX2Jhc2UubW9kZWxzID0ge307CiAgfQoKICBFdmVudEVtaXR0ZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5FdmVudEVtaXR0ZXIgfHwgcmVxdWlyZSgnLi4vbGliL2V2ZW50LWVtaXR0ZXInKTsKCiAgQmFzZU1vZGVsID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKEJhc2VNb2RlbCwgX3N1cGVyKTsKCiAgICBCYXNlTW9kZWwuaWRDb3VudGVyID0gLTE7CgogICAgQmFzZU1vZGVsLmluc3RhbmNlcyA9IG51bGw7CgogICAgQmFzZU1vZGVsLmNvdW50ID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLmluc3RhbmNlcyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5pbnN0YW5jZXMgPSBbXTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZXMubGVuZ3RoOwogICAgfTsKCiAgICBCYXNlTW9kZWwuZmlyc3QgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuaW5zdGFuY2VzID09IG51bGwpIHsKICAgICAgICB0aGlzLmluc3RhbmNlcyA9IFtdOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlc1swXTsKICAgIH07CgogICAgQmFzZU1vZGVsLmZpbmQgPSBmdW5jdGlvbihpZCkgewogICAgICB2YXIgaW5zdGFuY2UsIF9pLCBfbGVuLCBfcmVmOwogICAgICBpZiAodGhpcy5pbnN0YW5jZXMgPT0gbnVsbCkgewogICAgICAgIHRoaXMuaW5zdGFuY2VzID0gW107CiAgICAgIH0KICAgICAgX3JlZiA9IHRoaXMuaW5zdGFuY2VzOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBpbnN0YW5jZSA9IF9yZWZbX2ldOwogICAgICAgIGlmIChpbnN0YW5jZS5pZCA9PT0gaWQpIHsKICAgICAgICAgIHJldHVybiBpbnN0YW5jZTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgQmFzZU1vZGVsLnNlYXJjaCA9IGZ1bmN0aW9uKHF1ZXJ5KSB7CiAgICAgIHZhciBpbnN0YW5jZSwgbWlzcywgcHJvcGVydHksIHZhbHVlLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIGlmICh0aGlzLmluc3RhbmNlcyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5pbnN0YW5jZXMgPSBbXTsKICAgICAgfQogICAgICBfcmVmID0gdGhpcy5pbnN0YW5jZXM7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIGluc3RhbmNlID0gX3JlZltfaV07CiAgICAgICAgbWlzcyA9IGZhbHNlOwogICAgICAgIGZvciAocHJvcGVydHkgaW4gcXVlcnkpIHsKICAgICAgICAgIGlmICghX19oYXNQcm9wLmNhbGwocXVlcnksIHByb3BlcnR5KSkgY29udGludWU7CiAgICAgICAgICB2YWx1ZSA9IHF1ZXJ5W3Byb3BlcnR5XTsKICAgICAgICAgIGlmIChpbnN0YW5jZVtwcm9wZXJ0eV0gIT09IHZhbHVlKSB7CiAgICAgICAgICAgIG1pc3MgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG1pc3MpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBfcmVzdWx0cy5wdXNoKGluc3RhbmNlKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIEJhc2VNb2RlbC5kZXN0cm95QWxsID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfcmVzdWx0czsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgd2hpbGUgKHRoaXMuY291bnQoKSAhPT0gMCkgewogICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5maXJzdCgpLmRlc3Ryb3koKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICBCYXNlTW9kZWwucHJvdG90eXBlLmlkID0gbnVsbDsKCiAgICBmdW5jdGlvbiBCYXNlTW9kZWwocGFyYW1zKSB7CiAgICAgIHZhciBwcm9wZXJ0eSwgdmFsdWUsIF9iYXNlMTsKICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAgcGFyYW1zID0ge307CiAgICAgIH0KICAgICAgQmFzZU1vZGVsLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBmb3IgKHByb3BlcnR5IGluIHBhcmFtcykgewogICAgICAgIGlmICghX19oYXNQcm9wLmNhbGwocGFyYW1zLCBwcm9wZXJ0eSkpIGNvbnRpbnVlOwogICAgICAgIHZhbHVlID0gcGFyYW1zW3Byb3BlcnR5XTsKICAgICAgICB0aGlzW3Byb3BlcnR5XSA9IHZhbHVlOwogICAgICB9CiAgICAgIHRoaXMuY29uc3RydWN0b3IuaWRDb3VudGVyICs9IDE7CiAgICAgIGlmICh0aGlzLmlkID09IG51bGwpIHsKICAgICAgICB0aGlzLmlkID0gIkNfIiArIHRoaXMuY29uc3RydWN0b3IuaWRDb3VudGVyOwogICAgICB9CiAgICAgIGlmICgoX2Jhc2UxID0gdGhpcy5jb25zdHJ1Y3RvcikuaW5zdGFuY2VzID09IG51bGwpIHsKICAgICAgICBfYmFzZTEuaW5zdGFuY2VzID0gW107CiAgICAgIH0KICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5pbnN0YW5jZXMucHVzaCh0aGlzKTsKICAgIH0KCiAgICBCYXNlTW9kZWwucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGksIGluc3RhbmNlLCBfaSwgX2xlbiwgX3JlZiwgX3JlZjEsIF9yZXN1bHRzOwogICAgICBCYXNlTW9kZWwuX19zdXBlcl9fLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgX3JlZiA9IHRoaXMuY29uc3RydWN0b3IuaW5zdGFuY2VzOwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKGkgPSBfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBpID0gKytfaSkgewogICAgICAgIGluc3RhbmNlID0gX3JlZltpXTsKICAgICAgICBpZiAoIShpbnN0YW5jZSA9PT0gdGhpcykpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoKF9yZWYxID0gdGhpcy5jb25zdHJ1Y3Rvci5pbnN0YW5jZXMpICE9IG51bGwpIHsKICAgICAgICAgIF9yZWYxLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICByZXR1cm4gQmFzZU1vZGVsOwoKICB9KShFdmVudEVtaXR0ZXIpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuQmFzZU1vZGVsID0gQmFzZU1vZGVsOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEJhc2VNb2RlbDsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBBcGksIEV2ZW50RW1pdHRlciwgVXNlciwgYmFzZTY0LCBfYmFzZSwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH0sCiAgICBfX3NsaWNlID0gW10uc2xpY2U7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5tb2RlbHMgPT0gbnVsbCkgewogICAgX2Jhc2UubW9kZWxzID0ge307CiAgfQoKICBFdmVudEVtaXR0ZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5FdmVudEVtaXR0ZXIgfHwgcmVxdWlyZSgnLi4vbGliL2V2ZW50LWVtaXR0ZXInKTsKCiAgQXBpID0gd2luZG93Lnpvb25pdmVyc2UuQXBpIHx8IHJlcXVpcmUoJy4uL2xpYi9hcGknKTsKCiAgYmFzZTY0ID0gd2luZG93LmJhc2U2NCB8fCAocmVxdWlyZSgnLi4vdmVuZG9yL2Jhc2U2NCcpLCB3aW5kb3cuYmFzZTY0KTsKCiAgVXNlciA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhVc2VyLCBfc3VwZXIpOwoKICAgIFVzZXIuY3VycmVudCA9IGZhbHNlOwoKICAgIFVzZXIucGF0aCA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoQXBpLmN1cnJlbnQucHJvamVjdCkgewogICAgICAgIHJldHVybiAiL3Byb2plY3RzLyIgKyBBcGkuY3VycmVudC5wcm9qZWN0OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgfTsKCiAgICBVc2VyLmZldGNoID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBmZXRjaGVyLCBfcmVmOwogICAgICBVc2VyLnRyaWdnZXIoJ2ZldGNoaW5nJywgYXJndW1lbnRzKTsKICAgICAgZmV0Y2hlciA9IChfcmVmID0gQXBpLmN1cnJlbnQpLmdldEpTT04uYXBwbHkoX3JlZiwgWyIiICsgKFVzZXIucGF0aCgpKSArICIvY3VycmVudF91c2VyIl0uY29uY2F0KF9fc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGZldGNoZXIuYWx3YXlzKFVzZXIub25GZXRjaCk7CiAgICAgIHJldHVybiBmZXRjaGVyOwogICAgfTsKCiAgICBVc2VyLmxvZ2luID0gZnVuY3Rpb24oX2FyZykgewogICAgICB2YXIgbG9naW4sIHBhc3N3b3JkLCB1c2VybmFtZSwgX3JlZjsKICAgICAgdXNlcm5hbWUgPSBfYXJnLnVzZXJuYW1lLCBwYXNzd29yZCA9IF9hcmcucGFzc3dvcmQ7CiAgICAgIHRoaXMudHJpZ2dlcignbG9nZ2luZy1pbicsIGFyZ3VtZW50cyk7CiAgICAgIGxvZ2luID0gKF9yZWYgPSBBcGkuY3VycmVudCkuZ2V0SlNPTi5hcHBseShfcmVmLCBbIiIgKyAodGhpcy5wYXRoKCkpICsgIi9sb2dpbiJdLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICBsb2dpbi5kb25lKHRoaXMub25GZXRjaCk7CiAgICAgIGxvZ2luLmZhaWwodGhpcy5vbkZhaWwpOwogICAgICByZXR1cm4gbG9naW47CiAgICB9OwoKICAgIFVzZXIubG9nb3V0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsb2dvdXQsIF9yZWY7CiAgICAgIHRoaXMudHJpZ2dlcignbG9nZ2luZy1vdXQnLCBhcmd1bWVudHMpOwogICAgICBsb2dvdXQgPSAoX3JlZiA9IEFwaS5jdXJyZW50KS5nZXRKU09OLmFwcGx5KF9yZWYsIFsiIiArICh0aGlzLnBhdGgoKSkgKyAiL2xvZ291dCJdLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICBsb2dvdXQuYWx3YXlzKHRoaXMub25GZXRjaCk7CiAgICAgIHJldHVybiBsb2dvdXQ7CiAgICB9OwoKICAgIFVzZXIuc2lnbnVwID0gZnVuY3Rpb24oX2FyZykgewogICAgICB2YXIgZW1haWwsIHBhc3N3b3JkLCBzaWdudXAsIHVzZXJuYW1lLCBfcmVmOwogICAgICB1c2VybmFtZSA9IF9hcmcudXNlcm5hbWUsIHBhc3N3b3JkID0gX2FyZy5wYXNzd29yZCwgZW1haWwgPSBfYXJnLmVtYWlsOwogICAgICB0aGlzLnRyaWdnZXIoJ3NpZ25pbmctdXAnKTsKICAgICAgc2lnbnVwID0gKF9yZWYgPSBBcGkuY3VycmVudCkuZ2V0SlNPTi5hcHBseShfcmVmLCBbIiIgKyAodGhpcy5wYXRoKCkpICsgIi9zaWdudXAiXS5jb25jYXQoX19zbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgICAgc2lnbnVwLmFsd2F5cyh0aGlzLm9uRmV0Y2gpOwogICAgICByZXR1cm4gc2lnbnVwOwogICAgfTsKCiAgICBVc2VyLm9uRmV0Y2ggPSBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgdmFyIGF1dGgsIG9yaWdpbmFsOwogICAgICBvcmlnaW5hbCA9IFVzZXIuY3VycmVudDsKICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzICYmICduYW1lJyBpbiByZXN1bHQgJiYgJ2FwaV9rZXknIGluIHJlc3VsdCkgewogICAgICAgIFVzZXIuY3VycmVudCA9IG5ldyBVc2VyKHJlc3VsdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgVXNlci5jdXJyZW50ID0gbnVsbDsKICAgICAgfQogICAgICBpZiAoVXNlci5jdXJyZW50KSB7CiAgICAgICAgYXV0aCA9IGJhc2U2NC5lbmNvZGUoIiIgKyBVc2VyLmN1cnJlbnQubmFtZSArICI6IiArIFVzZXIuY3VycmVudC5hcGlfa2V5KTsKICAgICAgICBBcGkuY3VycmVudC5oZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSAiQmFzaWMgIiArIGF1dGg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIEFwaS5jdXJyZW50LmhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXTsKICAgICAgfQogICAgICBpZiAoVXNlci5jdXJyZW50ICE9PSBvcmlnaW5hbCkgewogICAgICAgIGlmIChvcmlnaW5hbCkgewogICAgICAgICAgb3JpZ2luYWwuZGVzdHJveSgpOwogICAgICAgIH0KICAgICAgICBVc2VyLnRyaWdnZXIoJ2NoYW5nZScsIFtVc2VyLmN1cnJlbnRdKTsKICAgICAgfQogICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIFVzZXIudHJpZ2dlcignc2lnbi1pbi1lcnJvcicsIHJlc3VsdC5tZXNzYWdlKTsKICAgICAgfQogICAgfTsKCiAgICBVc2VyLm9uRmFpbCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gVXNlci50cmlnZ2VyKCdzaWduLWluLWZhaWx1cmUnKTsKICAgIH07CgogICAgVXNlci5wcm90b3R5cGUuaWQgPSAnJzsKCiAgICBVc2VyLnByb3RvdHlwZS56b29uaXZlcnNlX2lkID0gJyc7CgogICAgVXNlci5wcm90b3R5cGUuYXBpX2tleSA9ICcnOwoKICAgIFVzZXIucHJvdG90eXBlLm5hbWUgPSAnJzsKCiAgICBVc2VyLnByb3RvdHlwZS5hdmF0YXIgPSAnJzsKCiAgICBVc2VyLnByb3RvdHlwZS5wcm9qZWN0ID0gbnVsbDsKCiAgICBmdW5jdGlvbiBVc2VyKHBhcmFtcykgewogICAgICB2YXIgcHJvcGVydHksIHZhbHVlOwogICAgICBpZiAocGFyYW1zID09IG51bGwpIHsKICAgICAgICBwYXJhbXMgPSB7fTsKICAgICAgfQogICAgICBmb3IgKHByb3BlcnR5IGluIHBhcmFtcykgewogICAgICAgIGlmICghX19oYXNQcm9wLmNhbGwocGFyYW1zLCBwcm9wZXJ0eSkpIGNvbnRpbnVlOwogICAgICAgIHZhbHVlID0gcGFyYW1zW3Byb3BlcnR5XTsKICAgICAgICB0aGlzW3Byb3BlcnR5XSA9IHZhbHVlOwogICAgICB9CiAgICB9CgogICAgVXNlci5wcm90b3R5cGUuc2V0R3JvdXAgPSBmdW5jdGlvbihncm91cElkLCBjYWxsYmFjaykgewogICAgICB2YXIgZ2V0LCBwYXRoLCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgaWYgKFVzZXIuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHBhdGggPSBncm91cElkICE9IG51bGwgPyAiL3VzZXJfZ3JvdXBzLyIgKyBncm91cElkICsgIi9wYXJ0aWNpcGF0ZSIgOiAiL3VzZXJfZ3JvdXBzL1RPRE9fSE9XX0RPX0lfTEVBVkVfQV9HUk9VUC9wYXJ0aWNpcGF0ZSI7CiAgICAgIGdldCA9IChfcmVmID0gQXBpLmN1cnJlbnQpICE9IG51bGwgPyBfcmVmLmdldEpTT04ocGF0aCwgZnVuY3Rpb24oZ3JvdXApIHsKICAgICAgICBfdGhpcy50cmlnZ2VyKCdjaGFuZ2UtZ3JvdXAnLCBncm91cCk7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIiA/IGNhbGxiYWNrLmFwcGx5KG51bGwsIGFyZ3VtZW50cykgOiB2b2lkIDA7CiAgICAgIH0pIDogdm9pZCAwOwogICAgICByZXR1cm4gZ2V0OwogICAgfTsKCiAgICBVc2VyLnByb3RvdHlwZS5zZXRQcmVmZXJlbmNlID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSwgZ2xvYmFsLCBjYWxsYmFjaykgewogICAgICB2YXIgX2Jhc2UxLCBfYmFzZTIsIF9uYW1lLCBfcmVmOwogICAgICBpZiAoZ2xvYmFsID09IG51bGwpIHsKICAgICAgICBnbG9iYWwgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoVXNlci5jdXJyZW50ID09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBnbG9iYWwgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBfcmVmID0gW2ZhbHNlLCBnbG9iYWxdLCBnbG9iYWwgPSBfcmVmWzBdLCBjYWxsYmFjayA9IF9yZWZbMV07CiAgICAgIH0KICAgICAgaWYgKChfYmFzZTEgPSBVc2VyLmN1cnJlbnQpLnByZWZlcmVuY2VzID09IG51bGwpIHsKICAgICAgICBfYmFzZTEucHJlZmVyZW5jZXMgPSB7fTsKICAgICAgfQogICAgICBpZiAoZ2xvYmFsKSB7CiAgICAgICAgVXNlci5jdXJyZW50LnByZWZlcmVuY2VzW2tleV0gPSB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoKF9iYXNlMiA9IFVzZXIuY3VycmVudC5wcmVmZXJlbmNlcylbX25hbWUgPSBBcGkuY3VycmVudC5wcm9qZWN0XSA9PSBudWxsKSB7CiAgICAgICAgICBfYmFzZTJbX25hbWVdID0ge307CiAgICAgICAgfQogICAgICAgIFVzZXIuY3VycmVudC5wcmVmZXJlbmNlc1tBcGkuY3VycmVudC5wcm9qZWN0XVtrZXldID0gdmFsdWU7CiAgICAgIH0KICAgICAgaWYgKCFnbG9iYWwpIHsKICAgICAgICBrZXkgPSAiIiArIEFwaS5jdXJyZW50LnByb2plY3QgKyAiLiIgKyBrZXk7CiAgICAgIH0KICAgICAgcmV0dXJuIEFwaS5jdXJyZW50LnB1dCgiL3VzZXJzL3ByZWZlcmVuY2VzIiwgewogICAgICAgIGtleToga2V5LAogICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICB9LCBjYWxsYmFjayk7CiAgICB9OwoKICAgIFVzZXIucHJvdG90eXBlLmRlbGV0ZVByZWZlcmVuY2UgPSBmdW5jdGlvbihrZXksIGdsb2JhbCwgY2FsbGJhY2spIHsKICAgICAgdmFyIF9iYXNlMSwgX2Jhc2UyLCBfbmFtZSwgX3JlZjsKICAgICAgaWYgKGdsb2JhbCA9PSBudWxsKSB7CiAgICAgICAgZ2xvYmFsID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKFVzZXIuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgZ2xvYmFsID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgX3JlZiA9IFtmYWxzZSwgZ2xvYmFsXSwgZ2xvYmFsID0gX3JlZlswXSwgY2FsbGJhY2sgPSBfcmVmWzFdOwogICAgICB9CiAgICAgIGlmICgoX2Jhc2UxID0gVXNlci5jdXJyZW50KS5wcmVmZXJlbmNlcyA9PSBudWxsKSB7CiAgICAgICAgX2Jhc2UxLnByZWZlcmVuY2VzID0ge307CiAgICAgIH0KICAgICAgaWYgKGdsb2JhbCkgewogICAgICAgIGRlbGV0ZSBVc2VyLmN1cnJlbnQucHJlZmVyZW5jZXNba2V5XTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoKF9iYXNlMiA9IFVzZXIuY3VycmVudC5wcmVmZXJlbmNlcylbX25hbWUgPSBBcGkuY3VycmVudC5wcm9qZWN0XSA9PSBudWxsKSB7CiAgICAgICAgICBfYmFzZTJbX25hbWVdID0ge307CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBVc2VyLmN1cnJlbnQucHJlZmVyZW5jZXNbQXBpLmN1cnJlbnQucHJvamVjdF1ba2V5XTsKICAgICAgfQogICAgICBpZiAoIWdsb2JhbCkgewogICAgICAgIGtleSA9ICIiICsgQXBpLmN1cnJlbnQucHJvamVjdCArICIuIiArIGtleTsKICAgICAgfQogICAgICByZXR1cm4gQXBpLmN1cnJlbnRbImRlbGV0ZSJdKCIvdXNlcnMvcHJlZmVyZW5jZXMiLCB7CiAgICAgICAga2V5OiBrZXkKICAgICAgfSwgY2FsbGJhY2spOwogICAgfTsKCiAgICByZXR1cm4gVXNlcjsKCiAgfSkuY2FsbCh0aGlzLCBFdmVudEVtaXR0ZXIpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuVXNlciA9IFVzZXI7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gVXNlcjsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBBcGksIEJhc2VNb2RlbCwgU3ViamVjdCwgX2Jhc2UsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LAogICAgX19pbmRleE9mID0gW10uaW5kZXhPZiB8fCBmdW5jdGlvbihpdGVtKSB7IGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsgaWYgKGkgaW4gdGhpcyAmJiB0aGlzW2ldID09PSBpdGVtKSByZXR1cm4gaTsgfSByZXR1cm4gLTE7IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5tb2RlbHMgPT0gbnVsbCkgewogICAgX2Jhc2UubW9kZWxzID0ge307CiAgfQoKICBCYXNlTW9kZWwgPSB6b29uaXZlcnNlLm1vZGVscy5CYXNlTW9kZWwgfHwgcmVxdWlyZSgnLi9iYXNlLW1vZGVsJyk7CgogIEFwaSA9IHpvb25pdmVyc2UuQXBpIHx8IHJlcXVpcmUoJy4uL2xpYi9hcGknKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIFN1YmplY3QgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoU3ViamVjdCwgX3N1cGVyKTsKCiAgICBTdWJqZWN0LmN1cnJlbnQgPSBudWxsOwoKICAgIFN1YmplY3Quc2VlblRoaXNTZXNzaW9uID0gW107CgogICAgU3ViamVjdC5xdWV1ZU1pbiA9IDI7CgogICAgU3ViamVjdC5xdWV1ZU1heCA9IDEwOwoKICAgIFN1YmplY3QuZ3JvdXAgPSBmYWxzZTsKCiAgICBTdWJqZWN0LmZhbGxiYWNrID0gIi4vb2ZmbGluZS9zdWJqZWN0cy5qc29uIjsKCiAgICBTdWJqZWN0LnBhdGggPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGdyb3VwU3RyaW5nOwogICAgICBncm91cFN0cmluZyA9ICF0aGlzLmdyb3VwID8gJycgOiB0aGlzLmdyb3VwID09PSB0cnVlID8gJ2dyb3Vwcy8nIDogImdyb3Vwcy8iICsgdGhpcy5ncm91cCArICIvIjsKICAgICAgcmV0dXJuICIvcHJvamVjdHMvIiArIEFwaS5jdXJyZW50LnByb2plY3QgKyAiLyIgKyBncm91cFN0cmluZyArICJzdWJqZWN0cyI7CiAgICB9OwoKICAgIFN1YmplY3QubmV4dCA9IGZ1bmN0aW9uKGRvbmUsIGZhaWwpIHsKICAgICAgdmFyIGZldGNoZXIsIG5leHRlciwgX3JlZiwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMudHJpZ2dlcignZ2V0LW5leHQnKTsKICAgICAgaWYgKChfcmVmID0gdGhpcy5jdXJyZW50KSAhPSBudWxsKSB7CiAgICAgICAgX3JlZi5kZXN0cm95KCk7CiAgICAgIH0KICAgICAgdGhpcy5jdXJyZW50ID0gbnVsbDsKICAgICAgbmV4dGVyID0gbmV3ICQuRGVmZXJyZWQ7CiAgICAgIG5leHRlci50aGVuKGRvbmUsIGZhaWwpOwogICAgICBpZiAodGhpcy5jb3VudCgpID09PSAwKSB7CiAgICAgICAgZmV0Y2hlciA9IHRoaXMuZmV0Y2goKTsKICAgICAgICBmZXRjaGVyLmRvbmUoZnVuY3Rpb24obmV3U3ViamVjdHMpIHsKICAgICAgICAgIHZhciBfcmVmMTsKICAgICAgICAgIGlmICgoX3JlZjEgPSBfdGhpcy5maXJzdCgpKSAhPSBudWxsKSB7CiAgICAgICAgICAgIF9yZWYxLnNlbGVjdCgpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKF90aGlzLmN1cnJlbnQpIHsKICAgICAgICAgICAgcmV0dXJuIG5leHRlci5yZXNvbHZlKF90aGlzLmN1cnJlbnQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMudHJpZ2dlcignbm8tbW9yZScpOwogICAgICAgICAgICByZXR1cm4gbmV4dGVyLnJlamVjdC5hcHBseShuZXh0ZXIsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgZmV0Y2hlci5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIG5leHRlci5yZWplY3QuYXBwbHkobmV4dGVyLCBhcmd1bWVudHMpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlyc3QoKS5zZWxlY3QoKTsKICAgICAgICBuZXh0ZXIucmVzb2x2ZSh0aGlzLmN1cnJlbnQpOwogICAgICAgIGlmICh0aGlzLmNvdW50KCkgPCB0aGlzLnF1ZXVlTWluKSB7CiAgICAgICAgICB0aGlzLmZldGNoKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXh0ZXIucHJvbWlzZSgpOwogICAgfTsKCiAgICBTdWJqZWN0LnRyYWNrU2VlblN1YmplY3QgPSBmdW5jdGlvbihzdWJqZWN0KSB7CiAgICAgIHJldHVybiB0aGlzLnNlZW5UaGlzU2Vzc2lvbi5wdXNoKHN1YmplY3Quem9vbml2ZXJzZV9pZCk7CiAgICB9OwoKICAgIFN1YmplY3QuaGFzU2VlblN1YmplY3QgPSBmdW5jdGlvbihzdWJqZWN0KSB7CiAgICAgIHZhciBfcmVmOwogICAgICByZXR1cm4gX3JlZiA9IHN1YmplY3Quem9vbml2ZXJzZV9pZCwgX19pbmRleE9mLmNhbGwodGhpcy5zZWVuVGhpc1Nlc3Npb24sIF9yZWYpID49IDA7CiAgICB9OwoKICAgIFN1YmplY3QuZmV0Y2ggPSBmdW5jdGlvbihwYXJhbXMsIGRvbmUsIGZhaWwpIHsKICAgICAgdmFyIGZldGNoZXIsIGxpbWl0LCByZXF1ZXN0LCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgaWYgKHR5cGVvZiBwYXJhbXMgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBfcmVmID0gW3BhcmFtcywgZG9uZSwge31dLCBkb25lID0gX3JlZlswXSwgZmFpbCA9IF9yZWZbMV0sIHBhcmFtcyA9IF9yZWZbMl07CiAgICAgIH0KICAgICAgbGltaXQgPSAocGFyYW1zIHx8IHt9KS5saW1pdDsKICAgICAgaWYgKGxpbWl0ID09IG51bGwpIHsKICAgICAgICBsaW1pdCA9IHRoaXMucXVldWVNYXggLSB0aGlzLmNvdW50KCk7CiAgICAgIH0KICAgICAgZmV0Y2hlciA9IG5ldyAkLkRlZmVycmVkOwogICAgICBmZXRjaGVyLnRoZW4oZG9uZSwgZmFpbCk7CiAgICAgIGlmIChsaW1pdCA+IDApIHsKICAgICAgICByZXF1ZXN0ID0gQXBpLmN1cnJlbnQuZ2V0KHRoaXMucGF0aCgpLCB7CiAgICAgICAgICBsaW1pdDogbGltaXQKICAgICAgICB9KTsKICAgICAgICByZXF1ZXN0LmRvbmUoZnVuY3Rpb24ocmF3U3ViamVjdHMpIHsKICAgICAgICAgIHZhciBuZXdTdWJqZWN0cywgcmF3U3ViamVjdDsKICAgICAgICAgIG5ld1N1YmplY3RzID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2ksIF9sZW4sIF9yZXN1bHRzOwogICAgICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IHJhd1N1YmplY3RzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICAgICAgcmF3U3ViamVjdCA9IHJhd1N1YmplY3RzW19pXTsKICAgICAgICAgICAgICBpZiAoISghdGhpcy5oYXNTZWVuU3ViamVjdChyYXdTdWJqZWN0KSkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLnRyYWNrU2VlblN1YmplY3QocmF3U3ViamVjdCk7CiAgICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChuZXcgdGhpcyhyYXdTdWJqZWN0KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgICAgICAgfSkuY2FsbChfdGhpcyk7CiAgICAgICAgICB3aGlsZSAoIShfdGhpcy5zZWVuVGhpc1Nlc3Npb24ubGVuZ3RoIDwgMTAwMCkpIHsKICAgICAgICAgICAgX3RoaXMuc2VlblRoaXNTZXNzaW9uLnNoaWZ0KCk7CiAgICAgICAgICB9CiAgICAgICAgICBfdGhpcy50cmlnZ2VyKCdmZXRjaCcsIFtuZXdTdWJqZWN0c10pOwogICAgICAgICAgcmV0dXJuIGZldGNoZXIucmVzb2x2ZShuZXdTdWJqZWN0cyk7CiAgICAgICAgfSk7CiAgICAgICAgcmVxdWVzdC5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGdldEZhbGxiYWNrOwogICAgICAgICAgX3RoaXMudHJpZ2dlcignZmV0Y2hpbmctZmFsbGJhY2snKTsKICAgICAgICAgIGdldEZhbGxiYWNrID0gJC5nZXQoX3RoaXMuZmFsbGJhY2spOwogICAgICAgICAgZ2V0RmFsbGJhY2suZG9uZShmdW5jdGlvbihyYXdTdWJqZWN0cykgewogICAgICAgICAgICB2YXIgbmV3U3ViamVjdHMsIHJhd0dyb3VwU3ViamVjdHMsIHJhd1N1YmplY3QsIF9pLCBfbGVuOwogICAgICAgICAgICBpZiAoX3RoaXMuZ3JvdXApIHsKICAgICAgICAgICAgICByYXdHcm91cFN1YmplY3RzID0gW107CiAgICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSByYXdTdWJqZWN0cy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgICAgICAgcmF3U3ViamVjdCA9IHJhd1N1YmplY3RzW19pXTsKICAgICAgICAgICAgICAgIGlmIChyYXdTdWJqZWN0Lmdyb3VwX2lkID09PSBfdGhpcy5ncm91cCkgewogICAgICAgICAgICAgICAgICByYXdHcm91cFN1YmplY3RzLnB1c2gocmF3U3ViamVjdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJhd1N1YmplY3RzID0gcmF3R3JvdXBTdWJqZWN0czsKICAgICAgICAgICAgfQogICAgICAgICAgICByYXdTdWJqZWN0cy5zb3J0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpIC0gMC41OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbmV3U3ViamVjdHMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIF9qLCBfbGVuMSwgX3Jlc3VsdHM7CiAgICAgICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSByYXdTdWJqZWN0cy5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHsKICAgICAgICAgICAgICAgIHJhd1N1YmplY3QgPSByYXdTdWJqZWN0c1tfal07CiAgICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKG5ldyB0aGlzKHJhd1N1YmplY3QpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgICAgICAgICB9KS5jYWxsKF90aGlzKTsKICAgICAgICAgICAgX3RoaXMudHJpZ2dlcignZmV0Y2gnLCBbbmV3U3ViamVjdHNdKTsKICAgICAgICAgICAgcmV0dXJuIGZldGNoZXIucmVzb2x2ZShuZXdTdWJqZWN0cyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBnZXRGYWxsYmFjay5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBfdGhpcy50cmlnZ2VyKCdmZXRjaC1mYWlsJyk7CiAgICAgICAgICAgIHJldHVybiBmZXRjaGVyLmZhaWwuYXBwbHkoZmV0Y2hlciwgYXJndW1lbnRzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGZldGNoZXIucmVzb2x2ZSh0aGlzLmluc3RhbmNlcy5zbGljZSgwLCBudW1iZXIpKTsKICAgICAgfQogICAgICByZXR1cm4gZmV0Y2hlci5wcm9taXNlKCk7CiAgICB9OwoKICAgIFN1YmplY3QucHJvdG90eXBlLmlkID0gJyc7CgogICAgU3ViamVjdC5wcm90b3R5cGUuem9vbml2ZXJzZV9pZCA9ICcnOwoKICAgIFN1YmplY3QucHJvdG90eXBlLmNsYXNzaWZpY2F0aW9uX2NvdW50ID0gbnVsbDsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS5jb29yZHMgPSBudWxsOwoKICAgIFN1YmplY3QucHJvdG90eXBlLmxvY2F0aW9uID0gbnVsbDsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS5tZXRhZGF0YSA9IG51bGw7CgogICAgU3ViamVjdC5wcm90b3R5cGUucHJvamVjdF9pZCA9ICcnOwoKICAgIFN1YmplY3QucHJvdG90eXBlLmdyb3VwX2lkID0gJyc7CgogICAgU3ViamVjdC5wcm90b3R5cGUud29ya2Zsb3dfaWRzID0gbnVsbDsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS50dXRvcmlhbCA9IG51bGw7CgogICAgU3ViamVjdC5wcm90b3R5cGUucHJlbG9hZCA9IHRydWU7CgogICAgZnVuY3Rpb24gU3ViamVjdCgpIHsKICAgICAgU3ViamVjdC5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKHRoaXMubG9jYXRpb24gPT0gbnVsbCkgewogICAgICAgIHRoaXMubG9jYXRpb24gPSB7fTsKICAgICAgfQogICAgICBpZiAodGhpcy5jb29yZHMgPT0gbnVsbCkgewogICAgICAgIHRoaXMuY29vcmRzID0gW107CiAgICAgIH0KICAgICAgaWYgKHRoaXMubWV0YWRhdGEgPT0gbnVsbCkgewogICAgICAgIHRoaXMubWV0YWRhdGEgPSB7fTsKICAgICAgfQogICAgICBpZiAodGhpcy53b3JrZmxvd19pZHMgPT0gbnVsbCkgewogICAgICAgIHRoaXMud29ya2Zsb3dfaWRzID0gW107CiAgICAgIH0KICAgIH0KCiAgICBTdWJqZWN0LnByb3RvdHlwZS5wcmVsb2FkSW1hZ2VzID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpbWFnZVNvdXJjZXMsIHNyYywgdHlwZSwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIGlmICghdGhpcy5wcmVsb2FkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIF9yZWYgPSB0aGlzLmxvY2F0aW9uOwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKHR5cGUgaW4gX3JlZikgewogICAgICAgIGltYWdlU291cmNlcyA9IF9yZWZbdHlwZV07CiAgICAgICAgaWYgKCEoaW1hZ2VTb3VyY2VzIGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgICBpbWFnZVNvdXJjZXMgPSBbaW1hZ2VTb3VyY2VzXTsKICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLmlzSW1hZ2UoaW1hZ2VTb3VyY2VzKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIF9yZXN1bHRzLnB1c2goKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVzdWx0czE7CiAgICAgICAgICBfcmVzdWx0czEgPSBbXTsKICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gaW1hZ2VTb3VyY2VzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICAgIHNyYyA9IGltYWdlU291cmNlc1tfaV07CiAgICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKChuZXcgSW1hZ2UpLnNyYyA9IHNyYyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX3Jlc3VsdHMxOwogICAgICAgIH0pKCkpOwogICAgICB9CiAgICAgIHJldHVybiBfcmVzdWx0czsKICAgIH07CgogICAgU3ViamVjdC5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuY29uc3RydWN0b3IuY3VycmVudCA9IHRoaXM7CiAgICAgIHJldHVybiB0aGlzLnRyaWdnZXIoJ3NlbGVjdCcpOwogICAgfTsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yLmN1cnJlbnQgPT09IHRoaXMpIHsKICAgICAgICB0aGlzLmNvbnN0cnVjdG9yLmN1cnJlbnQgPSBudWxsOwogICAgICB9CiAgICAgIHJldHVybiBTdWJqZWN0Ll9fc3VwZXJfXy5kZXN0cm95LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwoKICAgIFN1YmplY3QucHJvdG90eXBlLmlzSW1hZ2UgPSBmdW5jdGlvbihzdWJqZWN0TG9jYXRpb24pIHsKICAgICAgdmFyIHNyYywgX2ksIF9sZW4sIF9yZWY7CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gc3ViamVjdExvY2F0aW9uLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgc3JjID0gc3ViamVjdExvY2F0aW9uW19pXTsKICAgICAgICBpZiAoISgoX3JlZiA9IHNyYy5zcGxpdCgnLicpLnBvcCgpKSA9PT0gJ2dpZicgfHwgX3JlZiA9PT0gJ2pwZycgfHwgX3JlZiA9PT0gJ3BuZycpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfTsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS50YWxrSHJlZiA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgZG9tYWluOwogICAgICBkb21haW4gPSB0aGlzLmRvbWFpbiB8fCBsb2NhdGlvbi5ob3N0bmFtZS5yZXBsYWNlKC9ed3d3XC4vLCAnJyk7CiAgICAgIHJldHVybiAiaHR0cDovL3RhbGsuIiArIGRvbWFpbiArICIvIy9zdWJqZWN0cy8iICsgdGhpcy56b29uaXZlcnNlX2lkOwogICAgfTsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS5zb2NpYWxJbWFnZSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgaW1hZ2U7CiAgICAgIGltYWdlID0gdGhpcy5sb2NhdGlvbi5zdGFuZGFyZCBpbnN0YW5jZW9mIEFycmF5ID8gdGhpcy5sb2NhdGlvbi5zdGFuZGFyZFtNYXRoLmZsb29yKHRoaXMubG9jYXRpb24uc3RhbmRhcmQubGVuZ3RoIC8gMildIDogdGhpcy5sb2NhdGlvbi5zdGFuZGFyZDsKICAgICAgcmV0dXJuICQoIjxhIGhyZWY9JyIgKyBpbWFnZSArICInPjwvYT4iKS5nZXQoMCkuaHJlZjsKICAgIH07CgogICAgU3ViamVjdC5wcm90b3R5cGUuc29jaWFsVGl0bGUgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICdab29uaXZlcnNlIGNsYXNzaWZpY2F0aW9uJzsKICAgIH07CgogICAgU3ViamVjdC5wcm90b3R5cGUuc29jaWFsTWVzc2FnZSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gJ0NsYXNzaWZ5aW5nIG9uIHRoZSBab29uaXZlcnNlISc7CiAgICB9OwoKICAgIFN1YmplY3QucHJvdG90eXBlLmZhY2Vib29rSHJlZiA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gKCJodHRwczovL3d3dy5mYWNlYm9vay5jb20vc2hhcmVyL3NoYXJlci5waHBcbj9zPTEwMFxuJnBbdXJsXT0iICsgKGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLnRhbGtIcmVmKCkpKSArICJcbiZwW3RpdGxlXT0iICsgKGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLnNvY2lhbFRpdGxlKCkpKSArICJcbiZwW3N1bW1hcnldPSIgKyAoZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuc29jaWFsTWVzc2FnZSgpKSkgKyAiXG4mcFtpbWFnZXNdWzBdPSIgKyAodGhpcy5zb2NpYWxNZXNzYWdlKCkpKS5yZXBsYWNlKCdcbicsICcnLCAnZycpOwogICAgfTsKCiAgICBTdWJqZWN0LnByb3RvdHlwZS50d2l0dGVySHJlZiA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc3RhdHVzOwogICAgICBzdGF0dXMgPSAiIiArICh0aGlzLnNvY2lhbE1lc3NhZ2UoKSkgKyAiICIgKyAodGhpcy50YWxrSHJlZigpKTsKICAgICAgcmV0dXJuICJodHRwOi8vdHdpdHRlci5jb20vaG9tZT9zdGF0dXM9IiArIChlbmNvZGVVUklDb21wb25lbnQoc3RhdHVzKSk7CiAgICB9OwoKICAgIFN1YmplY3QucHJvdG90eXBlLnBpbnRlcmVzdEhyZWYgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICgiaHR0cDovL3BpbnRlcmVzdC5jb20vcGluL2NyZWF0ZS9idXR0b24vXG4/dXJsPSIgKyAoZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMudGFsa0hyZWYoKSkpICsgIlxuJm1lZGlhPSIgKyAoZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuc29jaWFsSW1hZ2UoKSkpICsgIlxuJmRlc2NyaXB0aW9uPSIgKyAoZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuc29jaWFsTWVzc2FnZSgpKSkpLnJlcGxhY2UoJ1xuJywgJycsICdnJyk7CiAgICB9OwoKICAgIHJldHVybiBTdWJqZWN0OwoKICB9KShCYXNlTW9kZWwpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuU3ViamVjdCA9IFN1YmplY3Q7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gU3ViamVjdDsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBBcGksIEJhc2VNb2RlbCwgUmVjZW50LCBTdWJqZWN0LCBTdWJqZWN0Rm9yUmVjZW50LCBVc2VyLCBfYmFzZSwgX3JlZiwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5tb2RlbHMgPT0gbnVsbCkgewogICAgX2Jhc2UubW9kZWxzID0ge307CiAgfQoKICBCYXNlTW9kZWwgPSB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuQmFzZU1vZGVsIHx8IHJlcXVpcmUoJy4vYmFzZS1tb2RlbCcpOwoKICBBcGkgPSB3aW5kb3cuem9vbml2ZXJzZS5BcGkgfHwgcmVxdWlyZSgnLi4vbGliL2FwaScpOwoKICBVc2VyID0gd2luZG93Lnpvb25pdmVyc2UubW9kZWxzLlVzZXIgfHwgcmVxdWlyZSgnLi91c2VyJyk7CgogIFN1YmplY3QgPSB3aW5kb3cuem9vbml2ZXJzZS5tb2RlbHMuU3ViamVjdCB8fCByZXF1aXJlKCcuL3N1YmplY3QnKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIFN1YmplY3RGb3JSZWNlbnQgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoU3ViamVjdEZvclJlY2VudCwgX3N1cGVyKTsKCiAgICBmdW5jdGlvbiBTdWJqZWN0Rm9yUmVjZW50KCkgewogICAgICBfcmVmID0gU3ViamVjdEZvclJlY2VudC5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIF9yZWY7CiAgICB9CgogICAgcmV0dXJuIFN1YmplY3RGb3JSZWNlbnQ7CgogIH0pKFN1YmplY3QpOwoKICBSZWNlbnQgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoUmVjZW50LCBfc3VwZXIpOwoKICAgIFJlY2VudC50eXBlID0gJ3JlY2VudCc7CgogICAgUmVjZW50LnBhdGggPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9yZWYxOwogICAgICByZXR1cm4gIi9wcm9qZWN0cy8iICsgQXBpLmN1cnJlbnQucHJvamVjdCArICIvdXNlcnMvIiArICgoX3JlZjEgPSBVc2VyLmN1cnJlbnQpICE9IG51bGwgPyBfcmVmMS5pZCA6IHZvaWQgMCkgKyAiLyIgKyB0aGlzLnR5cGUgKyAicyI7CiAgICB9OwoKICAgIFJlY2VudC5mZXRjaCA9IGZ1bmN0aW9uKHBhcmFtcywgZG9uZSwgZmFpbCkgewogICAgICB2YXIgZmV0Y2hlciwgcmVxdWVzdCwgX3JlZjEsCiAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICB0aGlzLnRyaWdnZXIoJ2ZldGNoaW5nJyk7CiAgICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgX3JlZjEgPSBbcGFyYW1zLCBkb25lLCB7fV0sIGRvbmUgPSBfcmVmMVswXSwgZmFpbCA9IF9yZWYxWzFdLCBwYXJhbXMgPSBfcmVmMVsyXTsKICAgICAgfQogICAgICBwYXJhbXMgPSAkLmV4dGVuZCh7CiAgICAgICAgcGFnZTogMSwKICAgICAgICBwZXJfcGFnZTogMTAKICAgICAgfSwgcGFyYW1zKTsKICAgICAgZmV0Y2hlciA9IG5ldyAkLkRlZmVycmVkOwogICAgICBmZXRjaGVyLnRoZW4oZG9uZSwgZmFpbCk7CiAgICAgIHJlcXVlc3QgPSBBcGkuY3VycmVudC5nZXQodGhpcy5wYXRoKCksIHBhcmFtcyk7CiAgICAgIHJlcXVlc3QuZG9uZShmdW5jdGlvbihyYXdSZWNlbnRzKSB7CiAgICAgICAgdmFyIG5ld1JlY2VudHMsIHJhd1JlY2VudDsKICAgICAgICBuZXdSZWNlbnRzID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVmMiwgX3Jlc3VsdHM7CiAgICAgICAgICBfcmVmMiA9IHJhd1JlY2VudHMucmV2ZXJzZSgpOwogICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZjIubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICAgICAgcmF3UmVjZW50ID0gX3JlZjJbX2ldOwogICAgICAgICAgICBfcmVzdWx0cy5wdXNoKG5ldyB0aGlzKHJhd1JlY2VudCkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgICAgIH0pLmNhbGwoX3RoaXMpOwogICAgICAgIF90aGlzLnRyaWdnZXIoJ2ZldGNoJywgW25ld1JlY2VudHNdKTsKICAgICAgICByZXR1cm4gZmV0Y2hlci5yZXNvbHZlKG5ld1JlY2VudHMpOwogICAgICB9KTsKICAgICAgcmVxdWVzdC5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgIF90aGlzLnRyaWdnZXIoJ2ZldGNoLWZhaWwnKTsKICAgICAgICByZXR1cm4gZmV0Y2hlci5yZWplY3QuYXBwbHkoZmV0Y2hlciwgYXJndW1lbnRzKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBmZXRjaGVyLnByb21pc2UoKTsKICAgIH07CgogICAgUmVjZW50LmNsZWFyT25Vc2VyQ2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmOwogICAgICBzZWxmID0gdGhpczsKICAgICAgcmV0dXJuIFVzZXIub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfcmVzdWx0czsKICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgIHdoaWxlIChzZWxmLmNvdW50KCkgIT09IDApIHsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goc2VsZi5maXJzdCgpLmRlc3Ryb3koKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfSk7CiAgICB9OwoKICAgIFJlY2VudC5jbGVhck9uVXNlckNoYW5nZSgpOwoKICAgIFJlY2VudC5wcm90b3R5cGUuc3ViamVjdHMgPSBudWxsOwoKICAgIFJlY2VudC5wcm90b3R5cGUucHJvamVjdF9pZCA9ICcnOwoKICAgIFJlY2VudC5wcm90b3R5cGUud29ya2Zsb3dfaWQgPSAnJzsKCiAgICBSZWNlbnQucHJvdG90eXBlLmNyZWF0ZWRfYXQgPSAnJzsKCiAgICBmdW5jdGlvbiBSZWNlbnQoKSB7CiAgICAgIHZhciBpLCBzdWJqZWN0LCBfaSwgX2xlbiwgX3JlZjEsIF9yZWYyLCBfcmVmMywgX3JlZjQ7CiAgICAgIFJlY2VudC5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKHRoaXMuc3ViamVjdHMgPT0gbnVsbCkgewogICAgICAgIHRoaXMuc3ViamVjdHMgPSBbXTsKICAgICAgfQogICAgICB0aGlzLnByb2plY3RfaWQgfHwgKHRoaXMucHJvamVjdF9pZCA9IChfcmVmMSA9IHRoaXMuc3ViamVjdHNbMF0pICE9IG51bGwgPyBfcmVmMS5wcm9qZWN0X2lkIDogdm9pZCAwKTsKICAgICAgdGhpcy53b3JrZmxvd19pZCB8fCAodGhpcy53b3JrZmxvd19pZCA9IChfcmVmMiA9IHRoaXMuc3ViamVjdHNbMF0pICE9IG51bGwgPyAoX3JlZjMgPSBfcmVmMi53b3JrZmxvd19pZHMpICE9IG51bGwgPyBfcmVmM1swXSA6IHZvaWQgMCA6IHZvaWQgMCk7CiAgICAgIHRoaXMuY3JlYXRlZF9hdCB8fCAodGhpcy5jcmVhdGVkX2F0ID0gKG5ldyBEYXRlKS50b1VUQ1N0cmluZygpKTsKICAgICAgX3JlZjQgPSB0aGlzLnN1YmplY3RzOwogICAgICBmb3IgKGkgPSBfaSA9IDAsIF9sZW4gPSBfcmVmNC5sZW5ndGg7IF9pIDwgX2xlbjsgaSA9ICsrX2kpIHsKICAgICAgICBzdWJqZWN0ID0gX3JlZjRbaV07CiAgICAgICAgdGhpcy5zdWJqZWN0c1tpXSA9IG5ldyBTdWJqZWN0Rm9yUmVjZW50KHN1YmplY3QpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIFJlY2VudDsKCiAgfSkoQmFzZU1vZGVsKTsKCiAgd2luZG93Lnpvb25pdmVyc2UubW9kZWxzLlJlY2VudCA9IFJlY2VudDsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBSZWNlbnQ7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgQXBpLCBGYXZvcml0ZSwgUmVjZW50LCBVc2VyLCBfYmFzZSwgX3JlZiwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkubW9kZWxzID09IG51bGwpIHsKICAgIF9iYXNlLm1vZGVscyA9IHt9OwogIH0KCiAgUmVjZW50ID0gd2luZG93Lnpvb25pdmVyc2UubW9kZWxzLlJlY2VudCB8fCByZXF1aXJlKCcuL3JlY2VudCcpOwoKICBBcGkgPSB3aW5kb3cuem9vbml2ZXJzZS5BcGkgfHwgcmVxdWlyZSgnLi4vbGliL2FwaScpOwoKICBVc2VyID0gd2luZG93Lnpvb25pdmVyc2UubW9kZWxzLlVzZXIgfHwgcmVxdWlyZSgnLi91c2VyJyk7CgogICQgPSB3aW5kb3cualF1ZXJ5OwoKICBGYXZvcml0ZSA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhGYXZvcml0ZSwgX3N1cGVyKTsKCiAgICBmdW5jdGlvbiBGYXZvcml0ZSgpIHsKICAgICAgdGhpcy50b0pTT04gPSBfX2JpbmQodGhpcy50b0pTT04sIHRoaXMpOwogICAgICBfcmVmID0gRmF2b3JpdGUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfcmVmOwogICAgfQoKICAgIEZhdm9yaXRlLnR5cGUgPSAnZmF2b3JpdGUnOwoKICAgIEZhdm9yaXRlLmNsZWFyT25Vc2VyQ2hhbmdlKCk7CgogICAgRmF2b3JpdGUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc3ViamVjdDsKICAgICAgcmV0dXJuIHsKICAgICAgICBmYXZvcml0ZTogewogICAgICAgICAgc3ViamVjdF9pZHM6IChmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVmMSwgX3Jlc3VsdHM7CiAgICAgICAgICAgIF9yZWYxID0gdGhpcy5zdWJqZWN0czsKICAgICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgICAgIHN1YmplY3QgPSBfcmVmMVtfaV07CiAgICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChzdWJqZWN0LmlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICAgICAgICB9KS5jYWxsKHRoaXMpCiAgICAgICAgfQogICAgICB9OwogICAgfTsKCiAgICBGYXZvcml0ZS5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB0aGlzLnRyaWdnZXIoJ3NlbmRpbmcnKTsKICAgICAgcmV0dXJuIEFwaS5jdXJyZW50LnBvc3QoIi9wcm9qZWN0cy8iICsgQXBpLmN1cnJlbnQucHJvamVjdCArICIvZmF2b3JpdGVzIiwgdGhpcy50b0pTT04oKSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICBfdGhpcy5pZCA9IHJlc3BvbnNlLmlkOwogICAgICAgIHJldHVybiBfdGhpcy50cmlnZ2VyKCdzZW5kJyk7CiAgICAgIH0pOwogICAgfTsKCiAgICBGYXZvcml0ZS5wcm90b3R5cGVbImRlbGV0ZSJdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMudHJpZ2dlcignZGVsZXRpbmcnKTsKICAgICAgcmV0dXJuIEFwaS5jdXJyZW50WyJkZWxldGUiXSgiL3Byb2plY3RzLyIgKyBBcGkuY3VycmVudC5wcm9qZWN0ICsgIi9mYXZvcml0ZXMvIiArIHRoaXMuaWQsIGZ1bmN0aW9uKCkgewogICAgICAgIF90aGlzLnRyaWdnZXIoJ2RlbGV0ZScpOwogICAgICAgIHJldHVybiBfdGhpcy5kZXN0cm95KCk7CiAgICAgIH0pOwogICAgfTsKCiAgICByZXR1cm4gRmF2b3JpdGU7CgogIH0pKFJlY2VudCk7CgogIHdpbmRvdy56b29uaXZlcnNlLm1vZGVscy5GYXZvcml0ZSA9IEZhdm9yaXRlOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEZhdm9yaXRlOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyICQsIEFwaSwgQmFzZU1vZGVsLCBDbGFzc2lmaWNhdGlvbiwgRmF2b3JpdGUsIExhbmd1YWdlTWFuYWdlciwgUkVTT0xWRURfU1RBVEUsIFJlY2VudCwgX2Jhc2UsIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjMsIF9yZWY0LCBfcmVmNSwgX3JlZjYsIF9yZWY3LAogICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksCiAgICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSwKICAgIF9faW5kZXhPZiA9IFtdLmluZGV4T2YgfHwgZnVuY3Rpb24oaXRlbSkgeyBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7IGlmIChpIGluIHRoaXMgJiYgdGhpc1tpXSA9PT0gaXRlbSkgcmV0dXJuIGk7IH0gcmV0dXJuIC0xOyB9LAogICAgX19zbGljZSA9IFtdLnNsaWNlOwoKICBCYXNlTW9kZWwgPSAoKF9yZWYgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMSA9IF9yZWYubW9kZWxzKSAhPSBudWxsID8gX3JlZjEuQmFzZU1vZGVsIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL2Jhc2UtbW9kZWwnKTsKCiAgQXBpID0gKChfcmVmMiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZjIuQXBpIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9saWIvYXBpJyk7CgogIFJlY2VudCA9ICgoX3JlZjMgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmNCA9IF9yZWYzLm1vZGVscykgIT0gbnVsbCA/IF9yZWY0LlJlY2VudCA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vbW9kZWxzL3JlY2VudCcpOwoKICBGYXZvcml0ZSA9ICgoX3JlZjUgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmNiA9IF9yZWY1Lm1vZGVscykgIT0gbnVsbCA/IF9yZWY2LkZhdm9yaXRlIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9tb2RlbHMvZmF2b3JpdGUnKTsKCiAgTGFuZ3VhZ2VNYW5hZ2VyID0gKChfcmVmNyA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZjcuTGFuZ3VhZ2VNYW5hZ2VyIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9saWIvbGFuZ3VhZ2UtbWFuYWdlcicpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgUkVTT0xWRURfU1RBVEUgPSAobmV3ICQuRGVmZXJyZWQpLnJlc29sdmUoKS5zdGF0ZSgpOwoKICBDbGFzc2lmaWNhdGlvbiA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhDbGFzc2lmaWNhdGlvbiwgX3N1cGVyKTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wZW5kaW5nID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGVuZGluZy1jbGFzc2lmaWNhdGlvbnMnKSkgfHwgW107CgogICAgQ2xhc3NpZmljYXRpb24uc2VudFRoaXNTZXNzaW9uID0gMDsKCiAgICBDbGFzc2lmaWNhdGlvbi5zZW5kUGVuZGluZyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2xhc3NpZmljYXRpb24sIHBlbmRpbmdQb3N0cywgX2ksIF9sZW4sIF9yZWY4LCBfcmVzdWx0cywKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIGlmICh0aGlzLnBlbmRpbmcubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMudHJpZ2dlcignc2VuZGluZy1wZW5kaW5nJywgW2NsYXNzaWZpY2F0aW9uXSk7CiAgICAgIHBlbmRpbmdQb3N0cyA9IFtdOwogICAgICBfcmVmOCA9IHRoaXMucGVuZGluZzsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmOC5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIGNsYXNzaWZpY2F0aW9uID0gX3JlZjhbX2ldOwogICAgICAgIF9yZXN1bHRzLnB1c2goKGZ1bmN0aW9uKGNsYXNzaWZpY2F0aW9uKSB7CiAgICAgICAgICB2YXIgbGF0ZVBvc3Q7CiAgICAgICAgICBsYXRlUG9zdCA9IEFwaS5jdXJyZW50LnBvc3QoY2xhc3NpZmljYXRpb24udXJsLCBjbGFzc2lmaWNhdGlvbik7CiAgICAgICAgICBwZW5kaW5nUG9zdHMucHVzaChsYXRlUG9zdCk7CiAgICAgICAgICBsYXRlUG9zdC5kb25lKGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHZhciBmYXZvcml0ZSwgaWQ7CiAgICAgICAgICAgIF90aGlzLnRyaWdnZXIoJ3NlbmQtcGVuZGluZycsIFtjbGFzc2lmaWNhdGlvbl0pOwogICAgICAgICAgICBpZiAoY2xhc3NpZmljYXRpb24uZmF2b3JpdGUpIHsKICAgICAgICAgICAgICBmYXZvcml0ZSA9IG5ldyBGYXZvcml0ZSh7CiAgICAgICAgICAgICAgICBzdWJqZWN0czogKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB2YXIgX2osIF9sZW4xLCBfcmVmOSwgX3Jlc3VsdHMxOwogICAgICAgICAgICAgICAgICBfcmVmOSA9IGNsYXNzaWZpY2F0aW9uLnN1YmplY3RfaWRzOwogICAgICAgICAgICAgICAgICBfcmVzdWx0czEgPSBbXTsKICAgICAgICAgICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gX3JlZjkubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWQgPSBfcmVmOVtfal07CiAgICAgICAgICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZXN1bHRzMTsKICAgICAgICAgICAgICAgIH0pKCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gZmF2b3JpdGUuc2VuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGxhdGVQb3N0LmZhaWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy50cmlnZ2VyKCdzZW5kLXBlbmRpbmctZmFpbCcsIFtjbGFzc2lmaWNhdGlvbl0pOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gJC53aGVuLmFwcGx5KCQsIHBlbmRpbmdQb3N0cykuYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgaSwgX2osIF9yZWY5OwogICAgICAgICAgICBmb3IgKGkgPSBfaiA9IF9yZWY5ID0gcGVuZGluZ1Bvc3RzLmxlbmd0aCAtIDE7IF9yZWY5IDw9IDAgPyBfaiA8PSAwIDogX2ogPj0gMDsgaSA9IF9yZWY5IDw9IDAgPyArK19qIDogLS1faikgewogICAgICAgICAgICAgIGlmIChwZW5kaW5nUG9zdHNbaV0uc3RhdGUoKSA9PT0gUkVTT0xWRURfU1RBVEUpIHsKICAgICAgICAgICAgICAgIF90aGlzLnBlbmRpbmcuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BlbmRpbmctY2xhc3NpZmljYXRpb25zJywgSlNPTi5zdHJpbmdpZnkoX3RoaXMucGVuZGluZykpOwogICAgICAgICAgfSk7CiAgICAgICAgfSkoY2xhc3NpZmljYXRpb24pKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5zdWJqZWN0cyA9IFtdOwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5zdWJqZWN0ID0gbnVsbDsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUuYW5ub3RhdGlvbnMgPSBudWxsOwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5mYXZvcml0ZSA9IGZhbHNlOwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5nZW5lcmljID0gbnVsbDsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUuc3RhcnRlZF9hdCA9IG51bGw7CgogICAgQ2xhc3NpZmljYXRpb24ucHJvdG90eXBlLmZpbmlzaGVkX2F0ID0gbnVsbDsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUudXNlcl9hZ2VudCA9IG51bGw7CgogICAgZnVuY3Rpb24gQ2xhc3NpZmljYXRpb24oKSB7CiAgICAgIENsYXNzaWZpY2F0aW9uLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBpZiAodGhpcy5hbm5vdGF0aW9ucyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5hbm5vdGF0aW9ucyA9IFtdOwogICAgICB9CiAgICAgIHRoaXMuZ2VuZXJpYyA9IHt9OwogICAgICB0aGlzLnN0YXJ0ZWRfYXQgPSAobmV3IERhdGUpLnRvVVRDU3RyaW5nKCk7CiAgICAgIHRoaXMudXNlcl9hZ2VudCA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50OwogICAgfQoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5ub3JtYWxpemVTdWJqZWN0cyA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy5zdWJqZWN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3ViamVjdCB8fCAodGhpcy5zdWJqZWN0ID0gdGhpcy5zdWJqZWN0c1swXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3ViamVjdHMgPSBbdGhpcy5zdWJqZWN0XTsKICAgICAgfQogICAgfTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUuYW5ub3RhdGUgPSBmdW5jdGlvbihhbm5vdGF0aW9uKSB7CiAgICAgIHRoaXMuYW5ub3RhdGlvbnMucHVzaChhbm5vdGF0aW9uKTsKICAgICAgcmV0dXJuIGFubm90YXRpb247CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5yZW1vdmVBbm5vdGF0aW9uID0gZnVuY3Rpb24oYW5ub3RhdGlvbikgewogICAgICB2YXIgYSwgaSwgX2ksIF9sZW4sIF9yZWY4OwogICAgICBfcmVmOCA9IHRoaXMuYW5ub3RhdGlvbnM7CiAgICAgIGZvciAoaSA9IF9pID0gMCwgX2xlbiA9IF9yZWY4Lmxlbmd0aDsgX2kgPCBfbGVuOyBpID0gKytfaSkgewogICAgICAgIGEgPSBfcmVmOFtpXTsKICAgICAgICBpZiAoYSA9PT0gYW5ub3RhdGlvbikgewogICAgICAgICAgcmV0dXJuIHRoaXMuYW5ub3RhdGlvbnMuc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUuaXNUdXRvcmlhbCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc3ViamVjdDsKICAgICAgdGhpcy5ub3JtYWxpemVTdWJqZWN0cygpOwogICAgICByZXR1cm4gX19pbmRleE9mLmNhbGwoKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZjgsIF9yZWY5LCBfcmVzdWx0czsKICAgICAgICBfcmVmOCA9IHRoaXMuc3ViamVjdHM7CiAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWY4Lmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICBzdWJqZWN0ID0gX3JlZjhbX2ldOwogICAgICAgICAgX3Jlc3VsdHMucHVzaCgoX3JlZjkgPSBzdWJqZWN0Lm1ldGFkYXRhKSAhPSBudWxsID8gX3JlZjkudHV0b3JpYWwgOiB2b2lkIDApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICAgIH0pLmNhbGwodGhpcyksIHRydWUpID49IDA7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgIHRoaXMuZ2VuZXJpY1trZXldID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIFtrZXksIHZhbHVlXSk7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJpY1trZXldOwogICAgfTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhbm5vdGF0aW9uLCBrZXksIG91dHB1dCwgc3ViamVjdCwgc3ViamVjdF9pZHMsIHZhbHVlLCBfcmVmODsKICAgICAgaWYgKExhbmd1YWdlTWFuYWdlci5jdXJyZW50ICE9IG51bGwpIHsKICAgICAgICB0aGlzLnNldCgnbGFuZycsIExhbmd1YWdlTWFuYWdlci5jdXJyZW50LmNvZGUpOwogICAgICB9CiAgICAgIHRoaXMubm9ybWFsaXplU3ViamVjdHMoKTsKICAgICAgc3ViamVjdF9pZHMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVmOCwgX3Jlc3VsdHM7CiAgICAgICAgX3JlZjggPSB0aGlzLnN1YmplY3RzOwogICAgICAgIF9yZXN1bHRzID0gW107CiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmOC5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgc3ViamVjdCA9IF9yZWY4W19pXTsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goc3ViamVjdC5pZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfSkuY2FsbCh0aGlzKTsKICAgICAgb3V0cHV0ID0gewogICAgICAgIGNsYXNzaWZpY2F0aW9uOiB7CiAgICAgICAgICBzdWJqZWN0X2lkczogc3ViamVjdF9pZHMsCiAgICAgICAgICBhbm5vdGF0aW9uczogdGhpcy5hbm5vdGF0aW9ucy5jb25jYXQoWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc3RhcnRlZF9hdDogdGhpcy5zdGFydGVkX2F0LAogICAgICAgICAgICAgIGZpbmlzaGVkX2F0OiB0aGlzLmZpbmlzaGVkX2F0CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICB1c2VyX2FnZW50OiB0aGlzLnVzZXJfYWdlbnQKICAgICAgICAgICAgfQogICAgICAgICAgXSkKICAgICAgICB9CiAgICAgIH07CiAgICAgIF9yZWY4ID0gdGhpcy5nZW5lcmljOwogICAgICBmb3IgKGtleSBpbiBfcmVmOCkgewogICAgICAgIHZhbHVlID0gX3JlZjhba2V5XTsKICAgICAgICBhbm5vdGF0aW9uID0ge307CiAgICAgICAgYW5ub3RhdGlvbltrZXldID0gdmFsdWU7CiAgICAgICAgb3V0cHV0LmNsYXNzaWZpY2F0aW9uLmFubm90YXRpb25zLnB1c2goYW5ub3RhdGlvbik7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZmF2b3JpdGUpIHsKICAgICAgICBvdXRwdXQuY2xhc3NpZmljYXRpb24uZmF2b3JpdGUgPSB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBvdXRwdXQ7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS51cmwgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5ub3JtYWxpemVTdWJqZWN0cygpOwogICAgICByZXR1cm4gIi9wcm9qZWN0cy8iICsgQXBpLmN1cnJlbnQucHJvamVjdCArICIvd29ya2Zsb3dzLyIgKyB0aGlzLnN1YmplY3RzWzBdLndvcmtmbG93X2lkc1swXSArICIvY2xhc3NpZmljYXRpb25zIjsKICAgIH07CgogICAgQ2xhc3NpZmljYXRpb24ucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbihkb25lLCBmYWlsKSB7CiAgICAgIHZhciBwb3N0LCBfcmVmOCwKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIGlmICghdGhpcy5pc1R1dG9yaWFsKCkpIHsKICAgICAgICB0aGlzLmNvbnN0cnVjdG9yLnNlbnRUaGlzU2Vzc2lvbiArPSAxOwogICAgICB9CiAgICAgIHRoaXMuZmluaXNoZWRfYXQgPSAobmV3IERhdGUpLnRvVVRDU3RyaW5nKCk7CiAgICAgIHBvc3QgPSAoX3JlZjggPSBBcGkuY3VycmVudCkucG9zdC5hcHBseShfcmVmOCwgW3RoaXMudXJsKCksIHRoaXMudG9KU09OKCldLmNvbmNhdChfX3NsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICBwb3N0LmRvbmUoZnVuY3Rpb24oKSB7CiAgICAgICAgX3RoaXMubWFrZVJlY2VudCgpOwogICAgICAgIHJldHVybiBfdGhpcy5jb25zdHJ1Y3Rvci5zZW5kUGVuZGluZygpOwogICAgICB9KTsKICAgICAgcG9zdC5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5tYWtlUGVuZGluZygpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcignc2VuZCcpOwogICAgfTsKCiAgICBDbGFzc2lmaWNhdGlvbi5wcm90b3R5cGUubWFrZVBlbmRpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFzSlNPTjsKICAgICAgYXNKU09OID0gdGhpcy50b0pTT04oKTsKICAgICAgYXNKU09OLnVybCA9IHRoaXMudXJsKCk7CiAgICAgIHRoaXMuY29uc3RydWN0b3IucGVuZGluZy5wdXNoKGFzSlNPTik7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwZW5kaW5nLWNsYXNzaWZpY2F0aW9ucycsIEpTT04uc3RyaW5naWZ5KHRoaXMuY29uc3RydWN0b3IucGVuZGluZykpOwogICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCdwZW5kaW5nJyk7CiAgICB9OwoKICAgIENsYXNzaWZpY2F0aW9uLnByb3RvdHlwZS5tYWtlUmVjZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBmYXZvcml0ZSwgcmVjZW50LCBzdWJqZWN0LCBfaSwgX2xlbiwgX3JlZjgsIF9yZXN1bHRzOwogICAgICB0aGlzLm5vcm1hbGl6ZVN1YmplY3RzKCk7CiAgICAgIF9yZWY4ID0gdGhpcy5zdWJqZWN0czsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmOC5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIHN1YmplY3QgPSBfcmVmOFtfaV07CiAgICAgICAgcmVjZW50ID0gbmV3IFJlY2VudCh7CiAgICAgICAgICBzdWJqZWN0czogW3N1YmplY3RdCiAgICAgICAgfSk7CiAgICAgICAgcmVjZW50LnRyaWdnZXIoJ2Zyb20tY2xhc3NpZmljYXRpb24nKTsKICAgICAgICBpZiAodGhpcy5mYXZvcml0ZSkgewogICAgICAgICAgZmF2b3JpdGUgPSBuZXcgRmF2b3JpdGUoewogICAgICAgICAgICBzdWJqZWN0czogW3N1YmplY3RdCiAgICAgICAgICB9KTsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goZmF2b3JpdGUudHJpZ2dlcignZnJvbS1jbGFzc2lmaWNhdGlvbicpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3Jlc3VsdHMucHVzaCh2b2lkIDApOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIHJldHVybiBDbGFzc2lmaWNhdGlvbjsKCiAgfSkoQmFzZU1vZGVsKTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLm1vZGVscyA9PSBudWxsKSB7CiAgICBfYmFzZS5tb2RlbHMgPSB7fTsKICB9CgogIHdpbmRvdy56b29uaXZlcnNlLm1vZGVscy5DbGFzc2lmaWNhdGlvbiA9IENsYXNzaWZpY2F0aW9uOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IENsYXNzaWZpY2F0aW9uOwogIH0KCn0pLmNhbGwodGhpcyk7Cgp3aW5kb3cuem9vbml2ZXJzZSA9IHdpbmRvdy56b29uaXZlcnNlIHx8IHt9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3cyA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzIHx8IHt9Owp0ZW1wbGF0ZSA9IGZ1bmN0aW9uKF9fb2JqKSB7CiAgaWYgKCFfX29iaikgX19vYmogPSB7fTsKICB2YXIgX19vdXQgPSBbXSwgX19jYXB0dXJlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBvdXQgPSBfX291dCwgcmVzdWx0OwogICAgX19vdXQgPSBbXTsKICAgIGNhbGxiYWNrLmNhbGwodGhpcyk7CiAgICByZXN1bHQgPSBfX291dC5qb2luKCcnKTsKICAgIF9fb3V0ID0gb3V0OwogICAgcmV0dXJuIF9fc2FmZShyZXN1bHQpOwogIH0sIF9fc2FuaXRpemUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpIHsKICAgICAgcmV0dXJuIF9fZXNjYXBlKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9LCBfX3NhZmUsIF9fb2JqU2FmZSA9IF9fb2JqLnNhZmUsIF9fZXNjYXBlID0gX19vYmouZXNjYXBlOwogIF9fc2FmZSA9IF9fb2JqLnNhZmUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSkgdmFsdWUgPSAnJzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmcodmFsdWUpOwogICAgICByZXN1bHQuZWNvU2FmZSA9IHRydWU7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKICBpZiAoIV9fZXNjYXBlKSB7CiAgICBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAoJycgKyB2YWx1ZSkKICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgfTsKICB9CiAgKGZ1bmN0aW9uKCkgewogICAgKGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2xhc3NOYW1lOwogICAgCiAgICAgIGNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8ICd6b29uaXZlcnNlLWxvZ28nOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuXG48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGNsYXNzPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoY2xhc3NOYW1lKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSI+XG4gIDxnIGNsYXNzPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoY2xhc3NOYW1lKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnIiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0cm9rZT0idHJhbnNwYXJlbnQiIHN0cm9rZS13aWR0aD0iMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNTAsIDUwKSI+XG4gICAgPHBhdGggZD0iTSAwIC00NSBBIDQ1IDQ1IDAgMCAxIDAgNDUgQSA0NSA0NSAwIDAgMSAwIC00NSBaIE0gMCAtMzAgQSAzMCAzMCAwIDAgMCAwIDMwIEEgMzAgMzAgMCAwIDAgMCAtMzAgWiIgLz5cbiAgICA8cGF0aCBkPSJNIDAgLTEyLjUgQSAxMi41IDEyLjUgMCAwIDEgMCAxMi41IEEgMTIuNSAxMi41IDAgMCAxIDAgLTEyLjUgWiIgLz5cbiAgICA8cGF0aCBkPSJNIDAgLTc1IEwgNSAwIEwgMCA3NSBMIC01IDAgWiIgdHJhbnNmb3JtPSJyb3RhdGUoNTApIiAvPlxuICA8L2c+XG48L3N2Zz5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1snem9vbml2ZXJzZUxvZ29TdmcnXSA9IHRlbXBsYXRlOwppZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIG1vZHVsZS5leHBvcnRzID0gdGVtcGxhdGU7Cgp3aW5kb3cuem9vbml2ZXJzZSA9IHdpbmRvdy56b29uaXZlcnNlIHx8IHt9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3cyA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzIHx8IHt9Owp0ZW1wbGF0ZSA9IGZ1bmN0aW9uKF9fb2JqKSB7CiAgaWYgKCFfX29iaikgX19vYmogPSB7fTsKICB2YXIgX19vdXQgPSBbXSwgX19jYXB0dXJlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBvdXQgPSBfX291dCwgcmVzdWx0OwogICAgX19vdXQgPSBbXTsKICAgIGNhbGxiYWNrLmNhbGwodGhpcyk7CiAgICByZXN1bHQgPSBfX291dC5qb2luKCcnKTsKICAgIF9fb3V0ID0gb3V0OwogICAgcmV0dXJuIF9fc2FmZShyZXN1bHQpOwogIH0sIF9fc2FuaXRpemUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpIHsKICAgICAgcmV0dXJuIF9fZXNjYXBlKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9LCBfX3NhZmUsIF9fb2JqU2FmZSA9IF9fb2JqLnNhZmUsIF9fZXNjYXBlID0gX19vYmouZXNjYXBlOwogIF9fc2FmZSA9IF9fb2JqLnNhZmUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSkgdmFsdWUgPSAnJzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmcodmFsdWUpOwogICAgICByZXN1bHQuZWNvU2FmZSA9IHRydWU7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKICBpZiAoIV9fZXNjYXBlKSB7CiAgICBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAoJycgKyB2YWx1ZSkKICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgfTsKICB9CiAgKGZ1bmN0aW9uKCkgewogICAgKGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2xhc3NOYW1lOwogICAgCiAgICAgIGNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8ICd6b29uaXZlcnNlLWdyb3VwLWljb24nOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuXG48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZpZXdCb3g9IjAgMCAyMDAgMTAwIiBjbGFzcz0iJyk7CiAgICAKICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKGNsYXNzTmFtZSkpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJyIgd2lkdGg9IjJlbSIgaGVpZ2h0PSIxZW0iPlxuICAnKTsKICAgIAogICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3pvb25pdmVyc2UtZ3JvdXBzLWljb24tcGVyc29uJykgPT0gbnVsbCkgewogICAgICAgIF9fb3V0LnB1c2goJ1xuICAgIDxkZWZzPlxuICAgICAgPHBhdGggaWQ9Inpvb25pdmVyc2UtZ3JvdXBzLWljb24tcGVyc29uIiBkPSJNIDAgLTUwIEEgMjUgMzUgMCAwIDEgMjAgMTAgQSA2NyA2NyAwIDAgMSA1MCA0NSBMIDAgNTAgTCAtNTAgNDUgQSA2NyA2NyAwIDAgMSAtMjAgMTAgQSAyNSAzNSAwIDAgMSAwIC01MCBaIiAvPlxuICAgIDwvZGVmcz5cbiAgJyk7CiAgICAgIH0KICAgIAogICAgICBfX291dC5wdXNoKCdcblxuICA8ZyBjbGFzcz0iJyk7CiAgICAKICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKGNsYXNzTmFtZSkpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJyIgZmlsbD0iY3VycmVudENvbG9yIiBzdHJva2U9InRyYW5zcGFyZW50IiBzdHJva2Utd2lkdGg9IjAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwMCwgNTApIj5cbiAgICA8dXNlIHhsaW5rOmhyZWY9IiN6b29uaXZlcnNlLWdyb3Vwcy1pY29uLXBlcnNvbiIgdHJhbnNmb3JtPSJzY2FsZSgwLjY3KSB0cmFuc2xhdGUoLTgwLCAwKSIgb3BhY2l0eT0iMC43NSIgLz5cbiAgICA8dXNlIHhsaW5rOmhyZWY9IiN6b29uaXZlcnNlLWdyb3Vwcy1pY29uLXBlcnNvbiIgdHJhbnNmb3JtPSJzY2FsZSgwLjY3KSB0cmFuc2xhdGUoODAsIDApIiBvcGFjaXR5PSIwLjc1IiAvPlxuICAgIDx1c2UgeGxpbms6aHJlZj0iI3pvb25pdmVyc2UtZ3JvdXBzLWljb24tcGVyc29uIiAvPlxuICA8L2c+XG48L3N2Zz5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1snZ3JvdXBJY29uU3ZnJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIGNsYXNzTmFtZTsKICAgIAogICAgICBjbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZSB8fCAnem9vbml2ZXJzZS1tYWlsLWljb24nOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuXG48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDE1MCAxMDAiIGNsYXNzPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoY2xhc3NOYW1lKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnIiB3aWR0aD0iMS41ZW0iIGhlaWdodD0iMWVtIj5cbiAgPGcgY2xhc3M9IicpOwogICAgCiAgICAgIF9fb3V0LnB1c2goX19zYW5pdGl6ZShjbGFzc05hbWUpKTsKICAgIAogICAgICBfX291dC5wdXNoKCciIGZpbGw9ImN1cnJlbnRDb2xvciIgc3Ryb2tlPSJ0cmFuc3BhcmVudCIgc3Ryb2tlLXdpZHRoPSIwIj5cbiAgICA8cGF0aCBkPSJNIDAgMCBMIDc1IDY1IEwgMTUwIDAgWiIgLz5cbiAgICA8cGF0aCBkPSJNIDAgMCBMIDc1IDc1IEwgMTUwIDAgTCAxNTAgMTAwIEwgMCAxMDAgWiIgb3BhY2l0eT0iMC44NSIgLz5cbiAgPC9nPlxuPC9zdmc+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ21haWxJY29uU3ZnJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgX19vdXQucHVzaCgnPGRpdiBjbGFzcz0idW5kZXJsYXkiPlxuICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPlxuICAgIDxkaXYgY2xhc3M9ImRpYWxvZyI+PC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ2RpYWxvZyddID0gdGVtcGxhdGU7CmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgbW9kdWxlLmV4cG9ydHMgPSB0ZW1wbGF0ZTsKCndpbmRvdy56b29uaXZlcnNlID0gd2luZG93Lnpvb25pdmVyc2UgfHwge307CndpbmRvdy56b29uaXZlcnNlLnZpZXdzID0gd2luZG93Lnpvb25pdmVyc2Uudmlld3MgfHwge307CnRlbXBsYXRlID0gZnVuY3Rpb24oX19vYmopIHsKICBpZiAoIV9fb2JqKSBfX29iaiA9IHt9OwogIHZhciBfX291dCA9IFtdLCBfX2NhcHR1cmUgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgdmFyIG91dCA9IF9fb3V0LCByZXN1bHQ7CiAgICBfX291dCA9IFtdOwogICAgY2FsbGJhY2suY2FsbCh0aGlzKTsKICAgIHJlc3VsdCA9IF9fb3V0LmpvaW4oJycpOwogICAgX19vdXQgPSBvdXQ7CiAgICByZXR1cm4gX19zYWZlKHJlc3VsdCk7CiAgfSwgX19zYW5pdGl6ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkgewogICAgICByZXR1cm4gX19lc2NhcGUodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICcnOwogICAgfQogIH0sIF9fc2FmZSwgX19vYmpTYWZlID0gX19vYmouc2FmZSwgX19lc2NhcGUgPSBfX29iai5lc2NhcGU7CiAgX19zYWZlID0gX19vYmouc2FmZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBpZiAoISh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpKSB2YWx1ZSA9ICcnOwogICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZyh2YWx1ZSk7CiAgICAgIHJlc3VsdC5lY29TYWZlID0gdHJ1ZTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9OwogIGlmICghX19lc2NhcGUpIHsKICAgIF9fZXNjYXBlID0gX19vYmouZXNjYXBlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuICgnJyArIHZhbHVlKQogICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpCiAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JykKICAgICAgICAucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICB9OwogIH0KICAoZnVuY3Rpb24oKSB7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBncm91cEljb25TdmcsIG1haWxJY29uU3ZnLCB0cmFuc2xhdGUsIHpvb25pdmVyc2VMb2dvU3ZnLCBfcmVmLCBfcmVmMSwgX3JlZjIsIF9yZWYzLCBfcmVmNCwgX3JlZjUsIF9yZWY2OwogICAgCiAgICAgIHRyYW5zbGF0ZSA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZi50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbicpOwogICAgCiAgICAgIHpvb25pdmVyc2VMb2dvU3ZnID0gKChfcmVmMSA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYyID0gX3JlZjEudmlld3MpICE9IG51bGwgPyBfcmVmMi56b29uaXZlcnNlTG9nb1N2ZyA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi96b29uaXZlcnNlLWxvZ28tc3ZnJyk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG4nKTsKICAgIAogICAgICBncm91cEljb25TdmcgPSAoKF9yZWYzID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjQgPSBfcmVmMy52aWV3cykgIT0gbnVsbCA/IF9yZWY0Lmdyb3VwSWNvblN2ZyA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi9ncm91cC1pY29uLXN2ZycpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuJyk7CiAgICAKICAgICAgbWFpbEljb25TdmcgPSAoKF9yZWY1ID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjYgPSBfcmVmNS52aWV3cykgIT0gbnVsbCA/IF9yZWY2Lm1haWxJY29uU3ZnIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL21haWwtaWNvbi1zdmcnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcblxuPGRpdiBjbGFzcz0iY29ybmVyIj5cbiAgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIj5cbiAgICA8cGF0aCBkPSJNIDAgMCBMIDEwMCAwIEwgMTAwIDEwMCBaIiAvPlxuICA8L3N2Zz5cbjwvZGl2PlxuXG48ZGl2IGNsYXNzPSJuby11c2VyIj5cbiAgPGRpdiBjbGFzcz0iem9vbml2ZXJzZS1pbmZvIHBpZWNlIj5cbiAgICAnKTsKICAgIAogICAgICBfX291dC5wdXNoKHpvb25pdmVyc2VMb2dvU3ZnKCkpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuICAgICcpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCd0b3BCYXJIZWFkaW5nJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuICA8L2Rpdj5cblxuICA8ZGl2IGNsYXNzPSJzaWduLWluIHBpZWNlIj5cbiAgICA8YnV0dG9uIG5hbWU9InNpZ24tdXAiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduVXAnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+XG4gICAgPHNwYW4gY2xhc3M9InNlcGFyYXRvciI+fDwvc3Bhbj5cbiAgICA8YnV0dG9uIG5hbWU9InNpZ24taW4iPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduSW4nKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+XG4gIDwvZGl2PlxuPC9kaXY+XG5cbjxkaXYgY2xhc3M9ImN1cnJlbnQtdXNlciI+XG4gIDxkaXYgY2xhc3M9InVzZXItaW5mbyBwaWVjZSI+XG4gICAgPGRpdiBjbGFzcz0iY3VycmVudC11c2VyLW5hbWUiPiZtZGFzaDs8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9InNpZ24tb3V0Ij5cbiAgICAgIDxidXR0b24gbmFtZT0ic2lnbi1vdXQiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduT3V0JykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cblxuICA8ZGl2IGNsYXNzPSJncm91cHMgcGllY2UiPlxuICAgIDxkaXYgY2xhc3M9Imdyb3Vwcy1tZW51LXRvZ2dsZSI+XG4gICAgICA8YnV0dG9uIG5hbWU9Imdyb3VwcyI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaChncm91cEljb25TdmcoKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuXG4gIDxkaXYgY2xhc3M9Im1lc3NhZ2VzIHBpZWNlIj5cbiAgICA8YSBocmVmPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKHRoaXMudGFsa1Byb2ZpbGVIcmVmKTsKICAgIAogICAgICBfX291dC5wdXNoKCciIGNsYXNzPSJtZXNzYWdlLWxpbmsiPlxuICAgICAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaChtYWlsSWNvblN2ZygpKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbiAgICAgIDxzcGFuIGNsYXNzPSJtZXNzYWdlLWNvdW50Ij4mbWRhc2g7PC9zcGFuPlxuICAgIDwvYT5cbiAgPC9kaXY+XG5cbiAgPGRpdiBjbGFzcz0iYXZhdGFyIHBpZWNlIj5cbiAgICA8YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy9wcm9qZWN0cy9jdXJyZW50Ij48aW1nIHNyYz0iIiAvPjwvYT5cbiAgPC9kaXY+XG48L2Rpdj5cblxuPGRpdiBjbGFzcz0ibGFuZ3VhZ2VzIHBpZWNlIj5cbiAgPGJ1dHRvbiBuYW1lPSJsYW5ndWFnZXMtbWVudS10b2dnbGUiPjwvYnV0dG9uPiAgXG48L2Rpdj5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1sndG9wQmFyJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRyYW5zbGF0ZSwgX3JlZjsKICAgIAogICAgICB0cmFuc2xhdGUgPSAoKF9yZWYgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IF9yZWYudHJhbnNsYXRlIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9saWIvdHJhbnNsYXRlJyk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG48aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0idXNlcm5hbWUiIHJlcXVpcmVkPSJyZXF1aXJlZCIgZGF0YS16b29uaXZlcnNlLXRyYW5zbGF0ZT0iIiBkYXRhLXpvb25pdmVyc2UtdHJhbnNsYXRlLXBsYWNlaG9sZGVyPSJ1c2VybmFtZSIgLz5cbjxpbnB1dCB0eXBlPSJwYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiIHJlcXVpcmVkPSJyZXF1aXJlZCIgZGF0YS16b29uaXZlcnNlLXRyYW5zbGF0ZT0iIiBkYXRhLXpvb25pdmVyc2UtdHJhbnNsYXRlLXBsYWNlaG9sZGVyPSJwYXNzd29yZCIgLz5cbjxidXR0b24gdHlwZT0ic3VibWl0Ij4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnc2lnbkluJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuPGJ1dHRvbiBuYW1lPSJzaWduLW91dCI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3NpZ25PdXQnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+XG48ZGl2IGNsYXNzPSJlcnJvci1tZXNzYWdlIj48L2Rpdj5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1snbG9naW5Gb3JtJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRyYW5zbGF0ZSwgem9vbml2ZXJzZUxvZ29TdmcsIF9yZWY7CiAgICAKICAgICAgdHJhbnNsYXRlID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gem9vbml2ZXJzZS50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbicpOwogICAgCiAgICAgIHpvb25pdmVyc2VMb2dvU3ZnID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gKF9yZWYgPSB6b29uaXZlcnNlLnZpZXdzKSAhPSBudWxsID8gX3JlZi56b29uaXZlcnNlTG9nb1N2ZyA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi96b29uaXZlcnNlLWxvZ28tc3ZnJyk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG5cbjxkaXYgY2xhc3M9ImxvYWRlciI+PC9kaXY+XG5cbjxidXR0b24gdHlwZT0iYnV0dG9uIiBuYW1lPSJjbG9zZS1kaWFsb2ciPiZ0aW1lczs8L2J1dHRvbj5cblxuPGhlYWRlcj5cbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh6b29uaXZlcnNlTG9nb1N2ZygpKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3NpZ25JbkhlYWRpbmcnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG48L2hlYWRlcj5cblxuPGxhYmVsPlxuICA8c3BhbiBjbGFzcz0idGV4dC1sYWJlbCI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3VzZXJuYW1lJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvc3Bhbj48YnIgLz5cbiAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InVzZXJuYW1lIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48bGFiZWw+XG4gIDxzcGFuIGNsYXNzPSJ0ZXh0LWxhYmVsIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgncGFzc3dvcmQnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9zcGFuPjxiciAvPlxuICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIG5hbWU9InBhc3N3b3JkIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48ZGl2IGNsYXNzPSJlcnJvci1tZXNzYWdlIj48L2Rpdj5cblxuPGRpdiBjbGFzcz0iYWN0aW9uIj5cbiAgPGEgaHJlZj0iaHR0cHM6Ly93d3cuem9vbml2ZXJzZS5vcmcvcGFzc3dvcmQvcmVzZXQiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdmb3Jnb3RQYXNzd29yZCcpKTsKICAgIAogICAgICBfX291dC5wdXNoKCc8L2E+XG4gIDxidXR0b24gdHlwZT0ic3VibWl0Ij4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnc2lnbkluJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuPC9kaXY+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ2xvZ2luRGlhbG9nJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRyYW5zbGF0ZSwgem9vbml2ZXJzZUxvZ29TdmcsIF9yZWY7CiAgICAKICAgICAgdHJhbnNsYXRlID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gem9vbml2ZXJzZS50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbicpOwogICAgCiAgICAgIHpvb25pdmVyc2VMb2dvU3ZnID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gKF9yZWYgPSB6b29uaXZlcnNlLnZpZXdzKSAhPSBudWxsID8gX3JlZi56b29uaXZlcnNlTG9nb1N2ZyA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi96b29uaXZlcnNlLWxvZ28tc3ZnJyk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG5cbjxkaXYgY2xhc3M9ImxvYWRlciI+PC9kaXY+XG5cbjxidXR0b24gdHlwZT0iYnV0dG9uIiBuYW1lPSJjbG9zZS1kaWFsb2ciPiZ0aW1lczs8L2J1dHRvbj5cblxuPGhlYWRlcj5cbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh6b29uaXZlcnNlTG9nb1N2ZygpKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3NpZ25VcEhlYWRpbmcnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnXG48L2hlYWRlcj5cblxuPGxhYmVsPlxuICA8c3BhbiBjbGFzcz0idGV4dC1sYWJlbCI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3VzZXJuYW1lJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvc3Bhbj48YnIgLz5cbiAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9InVzZXJuYW1lIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48bGFiZWw+XG4gIDxzcGFuIGNsYXNzPSJ0ZXh0LWxhYmVsIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgncGFzc3dvcmQnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9zcGFuPjxiciAvPlxuICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIG5hbWU9InBhc3N3b3JkIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48bGFiZWw+XG4gIDxzcGFuIGNsYXNzPSJ0ZXh0LWxhYmVsIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnZW1haWwnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9zcGFuPjxiciAvPlxuICA8aW5wdXQgdHlwZT0iZW1haWwiIG5hbWU9ImVtYWlsIiByZXF1aXJlZD0icmVxdWlyZWQiIC8+XG48L2xhYmVsPlxuXG48bGFiZWw+XG4gIDxzcGFuIGNsYXNzPSJ0ZXh0LWxhYmVsIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgncmVhbE5hbWUnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9zcGFuPjxiciAvPlxuICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0icmVhbC1uYW1lIiAvPlxuICA8ZGl2IGNsYXNzPSJleHBsYW5hdGlvbiI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ3doeVJlYWxOYW1lJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvZGl2PlxuPC9sYWJlbD5cblxuPGxhYmVsIGNsYXNzPSJjaGVja2JveCI+XG4gIDxzcGFuPjwvc3Bhbj5cbiAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiByZXF1aXJlZD0icmVxdWlyZWQiIC8+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ2FncmVlVG9Qcml2YWN5UG9saWN5JykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuPC9sYWJlbD5cblxuPGxhYmVsIGNsYXNzPSJjaGVja2JveCI+XG4gIDxzcGFuPjwvc3Bhbj5cbiAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJiZXRhLXByZWZlcmVuY2UiIC8+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ2JldGFQcmVmZXJlbmNlJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuPC9sYWJlbD5cblxuPGRpdiBjbGFzcz0iZXJyb3ItbWVzc2FnZSI+PC9kaXY+XG5cbjxkaXYgY2xhc3M9ImFjdGlvbiI+XG4gIDxidXR0b24gdHlwZT0ic3VibWl0Ij4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnc2lnblVwJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuPC9kaXY+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ3NpZ251cERpYWxvZyddID0gdGVtcGxhdGU7CmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgbW9kdWxlLmV4cG9ydHMgPSB0ZW1wbGF0ZTsKCndpbmRvdy56b29uaXZlcnNlID0gd2luZG93Lnpvb25pdmVyc2UgfHwge307CndpbmRvdy56b29uaXZlcnNlLnZpZXdzID0gd2luZG93Lnpvb25pdmVyc2Uudmlld3MgfHwge307CnRlbXBsYXRlID0gZnVuY3Rpb24oX19vYmopIHsKICBpZiAoIV9fb2JqKSBfX29iaiA9IHt9OwogIHZhciBfX291dCA9IFtdLCBfX2NhcHR1cmUgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgdmFyIG91dCA9IF9fb3V0LCByZXN1bHQ7CiAgICBfX291dCA9IFtdOwogICAgY2FsbGJhY2suY2FsbCh0aGlzKTsKICAgIHJlc3VsdCA9IF9fb3V0LmpvaW4oJycpOwogICAgX19vdXQgPSBvdXQ7CiAgICByZXR1cm4gX19zYWZlKHJlc3VsdCk7CiAgfSwgX19zYW5pdGl6ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkgewogICAgICByZXR1cm4gX19lc2NhcGUodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICcnOwogICAgfQogIH0sIF9fc2FmZSwgX19vYmpTYWZlID0gX19vYmouc2FmZSwgX19lc2NhcGUgPSBfX29iai5lc2NhcGU7CiAgX19zYWZlID0gX19vYmouc2FmZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBpZiAoISh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpKSB2YWx1ZSA9ICcnOwogICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZyh2YWx1ZSk7CiAgICAgIHJlc3VsdC5lY29TYWZlID0gdHJ1ZTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9OwogIGlmICghX19lc2NhcGUpIHsKICAgIF9fZXNjYXBlID0gX19vYmouZXNjYXBlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuICgnJyArIHZhbHVlKQogICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpCiAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JykKICAgICAgICAucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICB9OwogIH0KICAoZnVuY3Rpb24oKSB7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgIF9fb3V0LnB1c2goJzxkaXYgY2xhc3M9ImxvYWRlciI+PC9kaXY+XG5cbjxkaXYgY2xhc3M9Iml0ZW1zIj48L2Rpdj5cblxuPG5hdiBjbGFzcz0iY29udHJvbHMiPlxuICA8c3BhbiBjbGFzcz0ibnVtYmVyZWQiPjwvc3Bhbj5cbjwvbmF2PlxuJyk7CiAgICAKICAgIH0pLmNhbGwodGhpcyk7CiAgICAKICB9KS5jYWxsKF9fb2JqKTsKICBfX29iai5zYWZlID0gX19vYmpTYWZlLCBfX29iai5lc2NhcGUgPSBfX2VzY2FwZTsKICByZXR1cm4gX19vdXQuam9pbignJyk7Cn07CndpbmRvdy56b29uaXZlcnNlLnZpZXdzWydwYWdpbmF0b3InXSA9IHRlbXBsYXRlOwppZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIG1vZHVsZS5leHBvcnRzID0gdGVtcGxhdGU7Cgp3aW5kb3cuem9vbml2ZXJzZSA9IHdpbmRvdy56b29uaXZlcnNlIHx8IHt9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3cyA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzIHx8IHt9Owp0ZW1wbGF0ZSA9IGZ1bmN0aW9uKF9fb2JqKSB7CiAgaWYgKCFfX29iaikgX19vYmogPSB7fTsKICB2YXIgX19vdXQgPSBbXSwgX19jYXB0dXJlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBvdXQgPSBfX291dCwgcmVzdWx0OwogICAgX19vdXQgPSBbXTsKICAgIGNhbGxiYWNrLmNhbGwodGhpcyk7CiAgICByZXN1bHQgPSBfX291dC5qb2luKCcnKTsKICAgIF9fb3V0ID0gb3V0OwogICAgcmV0dXJuIF9fc2FmZShyZXN1bHQpOwogIH0sIF9fc2FuaXRpemUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpIHsKICAgICAgcmV0dXJuIF9fZXNjYXBlKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9LCBfX3NhZmUsIF9fb2JqU2FmZSA9IF9fb2JqLnNhZmUsIF9fZXNjYXBlID0gX19vYmouZXNjYXBlOwogIF9fc2FmZSA9IF9fb2JqLnNhZmUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSkgdmFsdWUgPSAnJzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmcodmFsdWUpOwogICAgICByZXN1bHQuZWNvU2FmZSA9IHRydWU7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKICBpZiAoIV9fZXNjYXBlKSB7CiAgICBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAoJycgKyB2YWx1ZSkKICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgfTsKICB9CiAgKGZ1bmN0aW9uKCkgewogICAgKGZ1bmN0aW9uKCkgewogICAgICB2YXIgdHJhbnNsYXRlLCBfcmVmOwogICAgCiAgICAgIHRyYW5zbGF0ZSA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZi50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcblxuPGZvcm0gY2xhc3M9InNpZ24taW4tZm9ybSI+XG4gIDxkaXYgY2xhc3M9ImxvYWRlciI+PC9kaXY+XG5cbiAgPGhlYWRlcj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnc2lnbkluRm9yUHJvZmlsZScpKTsKICAgIAogICAgICBfX291dC5wdXNoKCc8L2hlYWRlcj5cbiAgPGxhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJ1c2VybmFtZSIgcmVxdWlyZWQ9InJlcXVpcmVkIiBkYXRhLXpvb25pdmVyc2UtdHJhbnNsYXRlPSIiIGRhdGEtem9vbml2ZXJzZS10cmFuc2xhdGUtcGxhY2Vob2xkZXI9InVzZXJuYW1lIiAvPjwvbGFiZWw+XG4gIDxsYWJlbD48aW5wdXQgdHlwZT0icGFzc3dvcmQiIG5hbWU9InBhc3N3b3JkIiByZXF1aXJlZD0icmVxdWlyZWQiIGRhdGEtem9vbml2ZXJzZS10cmFuc2xhdGU9IiIgZGF0YS16b29uaXZlcnNlLXRyYW5zbGF0ZS1wbGFjZWhvbGRlcj0icGFzc3dvcmQiIC8+PC9sYWJlbD5cbiAgPGRpdiBjbGFzcz0iZXJyb3ItbWVzc2FnZSI+PC9kaXY+XG4gIDxkaXYgY2xhc3M9ImFjdGlvbiI+PGJ1dHRvbiB0eXBlPSJzdWJtaXQiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduSW4nKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+PC9kaXY+XG4gIDxwIGNsYXNzPSJuby1hY2NvdW50Ij4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnbm9BY2NvdW50JykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJyA8YnV0dG9uIG5hbWU9InNpZ24tdXAiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdzaWduVXAnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnPC9idXR0b24+PC9wPlxuPC9mb3JtPlxuXG48bmF2PlxuICA8YnV0dG9uIG5hbWU9InR1cm4tcGFnZSIgdmFsdWU9InJlY2VudHMiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdyZWNlbnRzJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYnV0dG9uPlxuICA8YnV0dG9uIG5hbWU9InR1cm4tcGFnZSIgdmFsdWU9ImZhdm9yaXRlcyI+Jyk7CiAgICAKICAgICAgX19vdXQucHVzaCh0cmFuc2xhdGUoJ2Zhdm9yaXRlcycpKTsKICAgIAogICAgICBfX291dC5wdXNoKCc8L2J1dHRvbj5cbjwvbmF2PlxuXG48ZGl2IGNsYXNzPSJyZWNlbnRzIHBhZ2UiPjwvZGl2PlxuPGRpdiBjbGFzcz0icmVjZW50cy1lbXB0eSBlbXB0eS1tZXNzYWdlIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgncmVjZW50cycpKTsKICAgIAogICAgICBfX291dC5wdXNoKCcgKCcpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdub25lJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJyk8L2Rpdj5cblxuPGRpdiBjbGFzcz0iZmF2b3JpdGVzIHBhZ2UiPjwvZGl2PlxuPGRpdiBjbGFzcz0iZmF2b3JpdGVzLWVtcHR5IGVtcHR5LW1lc3NhZ2UiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdmYXZvcml0ZXMnKSk7CiAgICAKICAgICAgX19vdXQucHVzaCgnICgnKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnbm9uZScpKTsKICAgIAogICAgICBfX291dC5wdXNoKCcpPC9kaXY+XG4nKTsKICAgIAogICAgfSkuY2FsbCh0aGlzKTsKICAgIAogIH0pLmNhbGwoX19vYmopOwogIF9fb2JqLnNhZmUgPSBfX29ialNhZmUsIF9fb2JqLmVzY2FwZSA9IF9fZXNjYXBlOwogIHJldHVybiBfX291dC5qb2luKCcnKTsKfTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3NbJ3Byb2ZpbGUnXSA9IHRlbXBsYXRlOwppZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIG1vZHVsZS5leHBvcnRzID0gdGVtcGxhdGU7Cgp3aW5kb3cuem9vbml2ZXJzZSA9IHdpbmRvdy56b29uaXZlcnNlIHx8IHt9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3cyA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzIHx8IHt9Owp0ZW1wbGF0ZSA9IGZ1bmN0aW9uKF9fb2JqKSB7CiAgaWYgKCFfX29iaikgX19vYmogPSB7fTsKICB2YXIgX19vdXQgPSBbXSwgX19jYXB0dXJlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHZhciBvdXQgPSBfX291dCwgcmVzdWx0OwogICAgX19vdXQgPSBbXTsKICAgIGNhbGxiYWNrLmNhbGwodGhpcyk7CiAgICByZXN1bHQgPSBfX291dC5qb2luKCcnKTsKICAgIF9fb3V0ID0gb3V0OwogICAgcmV0dXJuIF9fc2FmZShyZXN1bHQpOwogIH0sIF9fc2FuaXRpemUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpIHsKICAgICAgcmV0dXJuIF9fZXNjYXBlKHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9LCBfX3NhZmUsIF9fb2JqU2FmZSA9IF9fb2JqLnNhZmUsIF9fZXNjYXBlID0gX19vYmouZXNjYXBlOwogIF9fc2FmZSA9IF9fb2JqLnNhZmUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlICYmIHZhbHVlLmVjb1NhZmUpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCEodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSkgdmFsdWUgPSAnJzsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmcodmFsdWUpOwogICAgICByZXN1bHQuZWNvU2FmZSA9IHRydWU7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfTsKICBpZiAoIV9fZXNjYXBlKSB7CiAgICBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAoJycgKyB2YWx1ZSkKICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpCiAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgfTsKICB9CiAgKGZ1bmN0aW9uKCkgewogICAgKGZ1bmN0aW9uKCkgewogICAgICB2YXIgRmF2b3JpdGUsIGxvY2F0aW9uLCB0aHVtYlNyYywgX3JlZiwgX3JlZjEsIF9yZWYyLCBfcmVmMzsKICAgIAogICAgICBGYXZvcml0ZSA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYxID0gX3JlZi5tb2RlbHMpICE9IG51bGwgPyBfcmVmMS5GYXZvcml0ZSA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnem9vbml2ZXJzZS9tb2RlbHMvZmF2b3JpdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcblxuPGRpdiBjbGFzcz1cJ2l0ZW1cJz5cbiAgPGEgaHJlZj0iJyk7CiAgICAKICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKCgoX3JlZjIgPSB0aGlzLnN1YmplY3RzWzBdKSAhPSBudWxsID8gX3JlZjIudGFsa0hyZWYoKSA6IHZvaWQgMCkgfHwgJyMvU1VCSkVDVF9FUlJPUicpKTsKICAgIAogICAgICBfX291dC5wdXNoKCciPlxuICAgICcpOwogICAgCiAgICAgIGxvY2F0aW9uID0gKF9yZWYzID0gdGhpcy5zdWJqZWN0c1swXSkgIT0gbnVsbCA/IF9yZWYzLmxvY2F0aW9uIDogdm9pZCAwOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuICAgICcpOwogICAgCiAgICAgIHRodW1iU3JjID0gbnVsbDsKICAgIAogICAgICBfX291dC5wdXNoKCdcbiAgICAnKTsKICAgIAogICAgICBpZiAodGh1bWJTcmMgPT0gbnVsbCkgewogICAgICAgIHRodW1iU3JjID0gbG9jYXRpb24gIT0gbnVsbCA/IGxvY2F0aW9uLnRodW1iIDogdm9pZCAwOwogICAgICB9CiAgICAKICAgICAgX19vdXQucHVzaCgnXG4gICAgJyk7CiAgICAKICAgICAgaWYgKChsb2NhdGlvbiAhPSBudWxsID8gbG9jYXRpb24uc3RhbmRhcmQgOiB2b2lkIDApIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICBpZiAodGh1bWJTcmMgPT0gbnVsbCkgewogICAgICAgICAgdGh1bWJTcmMgPSBsb2NhdGlvbiAhPSBudWxsID8gbG9jYXRpb24uc3RhbmRhcmRbMF0gOiB2b2lkIDA7CiAgICAgICAgfQogICAgICB9CiAgICAKICAgICAgX19vdXQucHVzaCgnXG4gICAgJyk7CiAgICAKICAgICAgaWYgKHRodW1iU3JjID09IG51bGwpIHsKICAgICAgICB0aHVtYlNyYyA9IGxvY2F0aW9uICE9IG51bGwgPyBsb2NhdGlvbi5zdGFuZGFyZCA6IHZvaWQgMDsKICAgICAgfQogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuICAgIDxpbWcgc3JjPSInKTsKICAgIAogICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUodGh1bWJTcmMgfHwgJycpKTsKICAgIAogICAgICBfX291dC5wdXNoKCciIC8+XG4gIDwvYT5cbjwvZGl2PlxuJyk7CiAgICAKICAgIH0pLmNhbGwodGhpcyk7CiAgICAKICB9KS5jYWxsKF9fb2JqKTsKICBfX29iai5zYWZlID0gX19vYmpTYWZlLCBfX29iai5lc2NhcGUgPSBfX2VzY2FwZTsKICByZXR1cm4gX19vdXQuam9pbignJyk7Cn07CndpbmRvdy56b29uaXZlcnNlLnZpZXdzWydwcm9maWxlSXRlbSddID0gdGVtcGxhdGU7CmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgbW9kdWxlLmV4cG9ydHMgPSB0ZW1wbGF0ZTsKCndpbmRvdy56b29uaXZlcnNlID0gd2luZG93Lnpvb25pdmVyc2UgfHwge307CndpbmRvdy56b29uaXZlcnNlLnZpZXdzID0gd2luZG93Lnpvb25pdmVyc2Uudmlld3MgfHwge307CnRlbXBsYXRlID0gZnVuY3Rpb24oX19vYmopIHsKICBpZiAoIV9fb2JqKSBfX29iaiA9IHt9OwogIHZhciBfX291dCA9IFtdLCBfX2NhcHR1cmUgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgdmFyIG91dCA9IF9fb3V0LCByZXN1bHQ7CiAgICBfX291dCA9IFtdOwogICAgY2FsbGJhY2suY2FsbCh0aGlzKTsKICAgIHJlc3VsdCA9IF9fb3V0LmpvaW4oJycpOwogICAgX19vdXQgPSBvdXQ7CiAgICByZXR1cm4gX19zYWZlKHJlc3VsdCk7CiAgfSwgX19zYW5pdGl6ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkgewogICAgICByZXR1cm4gX19lc2NhcGUodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICcnOwogICAgfQogIH0sIF9fc2FmZSwgX19vYmpTYWZlID0gX19vYmouc2FmZSwgX19lc2NhcGUgPSBfX29iai5lc2NhcGU7CiAgX19zYWZlID0gX19vYmouc2FmZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgJiYgdmFsdWUuZWNvU2FmZSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGVsc2UgewogICAgICBpZiAoISh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9IG51bGwpKSB2YWx1ZSA9ICcnOwogICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZyh2YWx1ZSk7CiAgICAgIHJlc3VsdC5lY29TYWZlID0gdHJ1ZTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9OwogIGlmICghX19lc2NhcGUpIHsKICAgIF9fZXNjYXBlID0gX19vYmouZXNjYXBlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuICgnJyArIHZhbHVlKQogICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpCiAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JykKICAgICAgICAucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICB9OwogIH0KICAoZnVuY3Rpb24oKSB7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjYXRlZ29yeSwgcHJvamVjdCwgcHJvamVjdHMsIHRyYW5zbGF0ZSwgem9vbml2ZXJzZUxvZ29TdmcsIF9pLCBfaiwgX2xlbiwgX2xlbjEsIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjM7CiAgICAKICAgICAgdHJhbnNsYXRlID0gKHR5cGVvZiB6b29uaXZlcnNlICE9PSAidW5kZWZpbmVkIiAmJiB6b29uaXZlcnNlICE9PSBudWxsID8gem9vbml2ZXJzZS50cmFuc2xhdGUgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbicpOwogICAgCiAgICAgIHpvb25pdmVyc2VMb2dvU3ZnID0gKChfcmVmID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjEgPSBfcmVmLnZpZXdzKSAhPSBudWxsID8gX3JlZjEuem9vbml2ZXJzZUxvZ29TdmcgOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4vem9vbml2ZXJzZS1sb2dvLXN2ZycpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJ1xuXG48YSBocmVmPSJodHRwczovL3d3dy56b29uaXZlcnNlLm9yZy8iIGNsYXNzPSJ6b29uaXZlcnNlLWxvZ28tY29udGFpbmVyIj5cbiAgJyk7CiAgICAKICAgICAgX19vdXQucHVzaCh6b29uaXZlcnNlTG9nb1N2ZygpKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcbjwvYT5cblxuPGRpdiBjbGFzcz0iem9vbml2ZXJzZS1mb290ZXItY29udGVudCI+XG4gIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLWhlYWRpbmciPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdmb290ZXJIZWFkaW5nJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvZGl2PlxuXG4gICcpOwogICAgCiAgICAgIGlmICh0aGlzLmNhdGVnb3JpZXMgIT0gbnVsbCkgewogICAgICAgIF9fb3V0LnB1c2goJ1xuICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLXByb2plY3RzIj5cbiAgICAgICcpOwogICAgICAgIF9yZWYyID0gdGhpcy5jYXRlZ29yaWVzOwogICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZjIubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICAgIF9yZWYzID0gX3JlZjJbX2ldLCBjYXRlZ29yeSA9IF9yZWYzLmNhdGVnb3J5LCBwcm9qZWN0cyA9IF9yZWYzLnByb2plY3RzOwogICAgICAgICAgX19vdXQucHVzaCgnXG4gICAgICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLWNhdGVnb3J5Ij5cbiAgICAgICAgICA8ZGl2IGNsYXNzPSJ6b29uaXZlcnNlLWZvb3Rlci1jYXRlZ29yeS10aXRsZSI+Jyk7CiAgICAgICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoY2F0ZWdvcnkpKTsKICAgICAgICAgIF9fb3V0LnB1c2goJzwvZGl2PlxuICAgICAgICAgICcpOwogICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gcHJvamVjdHMubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7CiAgICAgICAgICAgIHByb2plY3QgPSBwcm9qZWN0c1tfal07CiAgICAgICAgICAgIF9fb3V0LnB1c2goJ1xuICAgICAgICAgICAgPGRpdiBjbGFzcz0iem9vbml2ZXJzZS1mb290ZXItcHJvamVjdCI+XG4gICAgICAgICAgICAgIDxhIGhyZWY9IicpOwogICAgICAgICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUocHJvamVjdC51cmwpKTsKICAgICAgICAgICAgX19vdXQucHVzaCgnIj4nKTsKICAgICAgICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKHByb2plY3QubmFtZSkpOwogICAgICAgICAgICBfX291dC5wdXNoKCc8L2E+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAnKTsKICAgICAgICAgIH0KICAgICAgICAgIF9fb3V0LnB1c2goJ1xuICAgICAgICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLXByb2plY3QiPjwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICcpOwogICAgICAgIH0KICAgICAgICBfX291dC5wdXNoKCdcbiAgICA8L2Rpdj5cbiAgJyk7CiAgICAgIH0KICAgIAogICAgICBfX291dC5wdXNoKCdcblxuICA8ZGl2IGNsYXNzPSJ6b29uaXZlcnNlLWZvb3Rlci1nZW5lcmFsIj5cbiAgICA8IS0tZGl2IGNsYXNzPSJ6b29uaXZlcnNlLWZvb3Rlci1jYXRlZ29yeSI+PGEgaHJlZj0iIyI+Wm9vbml2ZXJzZSBEYWlseTwvYT48L2Rpdi0tPlxuICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLWNhdGVnb3J5Ij5cbiAgICAgIDxhIGhyZWY9Imh0dHBzOi8vd3d3Lnpvb25pdmVyc2Uub3JnL3ByaXZhY3kiPicpOwogICAgCiAgICAgIF9fb3V0LnB1c2godHJhbnNsYXRlKCdwcml2YWN5UG9saWN5JykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYT5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9Inpvb25pdmVyc2UtZm9vdGVyLWNhdGVnb3J5Ij5cbiAgICAgIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS96b29uaXZlcnNlIj4nKTsKICAgIAogICAgICBfX291dC5wdXNoKHRyYW5zbGF0ZSgnZm9ya09uR2l0SHViJykpOwogICAgCiAgICAgIF9fb3V0LnB1c2goJzwvYT5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbicpOwogICAgCiAgICB9KS5jYWxsKHRoaXMpOwogICAgCiAgfSkuY2FsbChfX29iaik7CiAgX19vYmouc2FmZSA9IF9fb2JqU2FmZSwgX19vYmouZXNjYXBlID0gX19lc2NhcGU7CiAgcmV0dXJuIF9fb3V0LmpvaW4oJycpOwp9Owp3aW5kb3cuem9vbml2ZXJzZS52aWV3c1snZm9vdGVyJ10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIGlkLCBuYW1lLCBfaSwgX2xlbiwgX3JlZiwgX3JlZjE7CiAgICAKICAgICAgX19vdXQucHVzaCgnPGRpdiBjbGFzcz0idXNlci1ncm91cHMiPlxuICAnKTsKICAgIAogICAgICBfcmVmID0gdGhpcy51c2VyX2dyb3VwcyB8fCBbXTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgX3JlZjEgPSBfcmVmW19pXSwgaWQgPSBfcmVmMS5pZCwgbmFtZSA9IF9yZWYxLm5hbWU7CiAgICAgICAgX19vdXQucHVzaCgnXG4gICAgPGRpdiBjbGFzcz0idXNlci1ncm91cCI+XG4gICAgICA8YnV0dG9uIG5hbWU9InVzZXItZ3JvdXAiIHZhbHVlPSInKTsKICAgICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUoaWQpKTsKICAgICAgICBfX291dC5wdXNoKCciICcpOwogICAgICAgIGlmIChpZCA9PT0gdGhpcy51c2VyX2dyb3VwX2lkKSB7CiAgICAgICAgICBfX291dC5wdXNoKCdjbGFzcz0iYWN0aXZlIicpOwogICAgICAgIH0KICAgICAgICBfX291dC5wdXNoKCc+Jyk7CiAgICAgICAgX19vdXQucHVzaChfX3Nhbml0aXplKG5hbWUpKTsKICAgICAgICBfX291dC5wdXNoKCc8L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgJyk7CiAgICAgIH0KICAgIAogICAgICBfX291dC5wdXNoKCdcbjwvZGl2PlxuJyk7CiAgICAKICAgIH0pLmNhbGwodGhpcyk7CiAgICAKICB9KS5jYWxsKF9fb2JqKTsKICBfX29iai5zYWZlID0gX19vYmpTYWZlLCBfX29iai5lc2NhcGUgPSBfX2VzY2FwZTsKICByZXR1cm4gX19vdXQuam9pbignJyk7Cn07CndpbmRvdy56b29uaXZlcnNlLnZpZXdzWydncm91cHNNZW51J10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKd2luZG93Lnpvb25pdmVyc2UgPSB3aW5kb3cuem9vbml2ZXJzZSB8fCB7fTsKd2luZG93Lnpvb25pdmVyc2Uudmlld3MgPSB3aW5kb3cuem9vbml2ZXJzZS52aWV3cyB8fCB7fTsKdGVtcGxhdGUgPSBmdW5jdGlvbihfX29iaikgewogIGlmICghX19vYmopIF9fb2JqID0ge307CiAgdmFyIF9fb3V0ID0gW10sIF9fY2FwdHVyZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgb3V0ID0gX19vdXQsIHJlc3VsdDsKICAgIF9fb3V0ID0gW107CiAgICBjYWxsYmFjay5jYWxsKHRoaXMpOwogICAgcmVzdWx0ID0gX19vdXQuam9pbignJyk7CiAgICBfX291dCA9IG91dDsKICAgIHJldHVybiBfX3NhZmUocmVzdWx0KTsKICB9LCBfX3Nhbml0aXplID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBfX2VzY2FwZSh2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwgX19zYWZlLCBfX29ialNhZmUgPSBfX29iai5zYWZlLCBfX2VzY2FwZSA9IF9fb2JqLmVzY2FwZTsKICBfX3NhZmUgPSBfX29iai5zYWZlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5lY29TYWZlKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT0gbnVsbCkpIHZhbHVlID0gJyc7CiAgICAgIHZhciByZXN1bHQgPSBuZXcgU3RyaW5nKHZhbHVlKTsKICAgICAgcmVzdWx0LmVjb1NhZmUgPSB0cnVlOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH07CiAgaWYgKCFfX2VzY2FwZSkgewogICAgX19lc2NhcGUgPSBfX29iai5lc2NhcGUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKCcnICsgdmFsdWUpCiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgIH07CiAgfQogIChmdW5jdGlvbigpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgdmFyIExhbmd1YWdlTWFuYWdlciwgY29kZSwgbGFiZWwsIF9yZWYsIF9yZWYxLCBfcmVmMjsKICAgIAogICAgICBMYW5ndWFnZU1hbmFnZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5MYW5ndWFnZU1hbmFnZXIgfHwgcmVxdWlyZSgnLi4vbGliL2xhbmd1YWdlLW1hbmFnZXInKTsKICAgIAogICAgICBfX291dC5wdXNoKCdcblxuPGRpdiBjbGFzcz0ibGFuZ3VhZ2VzIj5cbiAgJyk7CiAgICAKICAgICAgX3JlZjEgPSAoX3JlZiA9IExhbmd1YWdlTWFuYWdlci5jdXJyZW50KSAhPSBudWxsID8gX3JlZi50cmFuc2xhdGlvbnMgOiB2b2lkIDA7CiAgICAgIGZvciAoY29kZSBpbiBfcmVmMSkgewogICAgICAgIGxhYmVsID0gX3JlZjFbY29kZV0ubGFiZWw7CiAgICAgICAgX19vdXQucHVzaCgnXG4gICAgPGRpdiBjbGFzcz0ibGFuZ3VhZ2UiPlxuICAgICAgPGJ1dHRvbiBuYW1lPSJsYW5ndWFnZSIgdmFsdWU9IicpOwogICAgICAgIF9fb3V0LnB1c2goX19zYW5pdGl6ZShjb2RlKSk7CiAgICAgICAgX19vdXQucHVzaCgnIiAnKTsKICAgICAgICBpZiAoY29kZSA9PT0gKChfcmVmMiA9IExhbmd1YWdlTWFuYWdlci5jdXJyZW50KSAhPSBudWxsID8gX3JlZjIuY29kZSA6IHZvaWQgMCkpIHsKICAgICAgICAgIF9fb3V0LnB1c2goJ2NsYXNzPSJhY3RpdmUiJyk7CiAgICAgICAgfQogICAgICAgIF9fb3V0LnB1c2goJz4nKTsKICAgICAgICBfX291dC5wdXNoKF9fc2FuaXRpemUobGFiZWwpKTsKICAgICAgICBfX291dC5wdXNoKCc8L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgJyk7CiAgICAgIH0KICAgIAogICAgICBfX291dC5wdXNoKCdcbjwvZGl2PlxuJyk7CiAgICAKICAgIH0pLmNhbGwodGhpcyk7CiAgICAKICB9KS5jYWxsKF9fb2JqKTsKICBfX29iai5zYWZlID0gX19vYmpTYWZlLCBfX29iai5lc2NhcGUgPSBfX2VzY2FwZTsKICByZXR1cm4gX19vdXQuam9pbignJyk7Cn07CndpbmRvdy56b29uaXZlcnNlLnZpZXdzWydsYW5ndWFnZXNNZW51J10gPSB0ZW1wbGF0ZTsKaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSBtb2R1bGUuZXhwb3J0cyA9IHRlbXBsYXRlOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBCYXNlQ29udHJvbGxlciwgRXZlbnRFbWl0dGVyLCBuZXh0SWQsIF9iYXNlLAogICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksCiAgICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSwKICAgIF9fc2xpY2UgPSBbXS5zbGljZTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLmNvbnRyb2xsZXJzID09IG51bGwpIHsKICAgIF9iYXNlLmNvbnRyb2xsZXJzID0ge307CiAgfQoKICBFdmVudEVtaXR0ZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5FdmVudEVtaXR0ZXIgfHwgcmVxdWlyZSgnLi4vbGliL2V2ZW50LWVtaXR0ZXInKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIG5leHRJZCA9IDA7CgogIEJhc2VDb250cm9sbGVyID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKEJhc2VDb250cm9sbGVyLCBfc3VwZXIpOwoKICAgIEJhc2VDb250cm9sbGVyLnByb3RvdHlwZS5lbCA9IG51bGw7CgogICAgQmFzZUNvbnRyb2xsZXIucHJvdG90eXBlLnRhZ05hbWUgPSAnZGl2JzsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuY2xhc3NOYW1lID0gJyc7CgogICAgQmFzZUNvbnRyb2xsZXIucHJvdG90eXBlLnRlbXBsYXRlID0gbnVsbDsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuaWQgPSAnJzsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuZXZlbnRzID0gbnVsbDsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuZWxlbWVudHMgPSBudWxsOwoKICAgIGZ1bmN0aW9uIEJhc2VDb250cm9sbGVyKHBhcmFtcykgewogICAgICB2YXIgcHJvcGVydHksIHZhbHVlOwogICAgICBpZiAocGFyYW1zID09IG51bGwpIHsKICAgICAgICBwYXJhbXMgPSB7fTsKICAgICAgfQogICAgICBCYXNlQ29udHJvbGxlci5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgZm9yIChwcm9wZXJ0eSBpbiBwYXJhbXMpIHsKICAgICAgICBpZiAoIV9faGFzUHJvcC5jYWxsKHBhcmFtcywgcHJvcGVydHkpKSBjb250aW51ZTsKICAgICAgICB2YWx1ZSA9IHBhcmFtc1twcm9wZXJ0eV07CiAgICAgICAgaWYgKHByb3BlcnR5IGluIHRoaXMpIHsKICAgICAgICAgIHRoaXNbcHJvcGVydHldID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuaWQgfHwgKHRoaXMuaWQgPSAiY29udHJvbGxlcl8iICsgbmV4dElkKTsKICAgICAgbmV4dElkICs9IDE7CiAgICAgIGlmICh0aGlzLmVsID09IG51bGwpIHsKICAgICAgICB0aGlzLmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0aGlzLnRhZ05hbWUpOwogICAgICB9CiAgICAgIHRoaXMuZWwgPSAkKHRoaXMuZWwpOwogICAgICB0aGlzLnJlbmRlclRlbXBsYXRlKCk7CiAgICAgIHRoaXMuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgdGhpcy5uYW1lRWxlbWVudHMoKTsKICAgIH0KCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUucmVuZGVyVGVtcGxhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKSB7CiAgICAgICAgdGhpcy5lbC5hZGRDbGFzcyh0aGlzLmNsYXNzTmFtZSk7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmVsLmh0bWwoKSkgewogICAgICAgIGlmICh0eXBlb2YgdGhpcy50ZW1wbGF0ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHRoaXMuZWwuaHRtbCh0aGlzLnRlbXBsYXRlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnRlbXBsYXRlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5lbC5odG1sKHRoaXMudGVtcGxhdGUodGhpcykpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUubmFtZUVsZW1lbnRzID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBuYW1lLCBzZWxlY3RvciwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIGlmICh0aGlzLmVsZW1lbnRzICE9IG51bGwpIHsKICAgICAgICBfcmVmID0gdGhpcy5lbGVtZW50czsKICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgIGZvciAoc2VsZWN0b3IgaW4gX3JlZikgewogICAgICAgICAgbmFtZSA9IF9yZWZbc2VsZWN0b3JdOwogICAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzW25hbWVdID0gdGhpcy5lbC5maW5kKHNlbGVjdG9yKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfQogICAgfTsKCiAgICBCYXNlQ29udHJvbGxlci5wcm90b3R5cGUuZGVsZWdhdGVFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGV2ZW50U3RyaW5nLCBtZXRob2QsIF9yZWYsIF9yZXN1bHRzLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgdGhpcy5lbC5vZmYoIi4iICsgdGhpcy5pZCk7CiAgICAgIGlmICh0aGlzLmV2ZW50cyAhPSBudWxsKSB7CiAgICAgICAgX3JlZiA9IHRoaXMuZXZlbnRzOwogICAgICAgIF9yZXN1bHRzID0gW107CiAgICAgICAgZm9yIChldmVudFN0cmluZyBpbiBfcmVmKSB7CiAgICAgICAgICBtZXRob2QgPSBfcmVmW2V2ZW50U3RyaW5nXTsKICAgICAgICAgIF9yZXN1bHRzLnB1c2goKGZ1bmN0aW9uKGV2ZW50U3RyaW5nLCBtZXRob2QpIHsKICAgICAgICAgICAgdmFyIGF1dG9QcmV2ZW50RGVmYXVsdCwgZXZlbnROYW1lLCBzZWxlY3RvciwgX3JlZjE7CiAgICAgICAgICAgIF9yZWYxID0gZXZlbnRTdHJpbmcuc3BsaXQoL1xzKy8pLCBldmVudE5hbWUgPSBfcmVmMVswXSwgc2VsZWN0b3IgPSAyIDw9IF9yZWYxLmxlbmd0aCA/IF9fc2xpY2UuY2FsbChfcmVmMSwgMSkgOiBbXTsKICAgICAgICAgICAgc2VsZWN0b3IgPSBzZWxlY3Rvci5qb2luKCcgJyk7CiAgICAgICAgICAgIGlmIChldmVudE5hbWUuc2xpY2UoLTEpID09PSAnKicpIHsKICAgICAgICAgICAgICBldmVudE5hbWUgPSBldmVudE5hbWUuc2xpY2UoMCwgLTEpOwogICAgICAgICAgICAgIGF1dG9QcmV2ZW50RGVmYXVsdCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXRob2QgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgbWV0aG9kID0gX3RoaXNbbWV0aG9kXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gX3RoaXMuZWwub24oIiIgKyBldmVudE5hbWUgKyAiLiIgKyBfdGhpcy5pZCwgc2VsZWN0b3IsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBpZiAoYXV0b1ByZXZlbnREZWZhdWx0KSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBtZXRob2QuY2FsbC5hcHBseShtZXRob2QsIFtfdGhpc10uY29uY2F0KF9fc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkoZXZlbnRTdHJpbmcsIG1ldGhvZCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICAgIH0KICAgIH07CgogICAgQmFzZUNvbnRyb2xsZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHByb3BlcnR5TmFtZSwgc2VsZWN0b3IsIF9yZWY7CiAgICAgIGlmICh0aGlzLmVsZW1lbnRzICE9IG51bGwpIHsKICAgICAgICBfcmVmID0gdGhpcy5lbGVtZW50czsKICAgICAgICBmb3IgKHNlbGVjdG9yIGluIF9yZWYpIHsKICAgICAgICAgIHByb3BlcnR5TmFtZSA9IF9yZWZbc2VsZWN0b3JdOwogICAgICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5lbC5vZmYoKTsKICAgICAgdGhpcy5lbC5lbXB0eSgpOwogICAgICB0aGlzLmVsLnJlbW92ZSgpOwogICAgICByZXR1cm4gQmFzZUNvbnRyb2xsZXIuX19zdXBlcl9fLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CgogICAgcmV0dXJuIEJhc2VDb250cm9sbGVyOwoKICB9KShFdmVudEVtaXR0ZXIpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciA9IEJhc2VDb250cm9sbGVyOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEJhc2VDb250cm9sbGVyOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIEJhc2VDb250cm9sbGVyLCBEaWFsb2csIHRlbXBsYXRlLCB0cmFuc2xhdGUsIF9iYXNlLCBfYmFzZTEsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgQmFzZUNvbnRyb2xsZXIgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkJhc2VDb250cm9sbGVyIHx8IHJlcXVpcmUoJy4vYmFzZS1jb250cm9sbGVyJyk7CgogIHRlbXBsYXRlID0gem9vbml2ZXJzZS52aWV3cy5kaWFsb2cgfHwgcmVxdWlyZSgnLi4vdmlld3MvZGlhbG9nJyk7CgogIHRyYW5zbGF0ZSA9IHpvb25pdmVyc2UudHJhbnNsYXRlIHx8IHJlcXVpcmUoJy4uL2xpYi90cmFuc2xhdGUnKTsKCiAgRGlhbG9nID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKERpYWxvZywgX3N1cGVyKTsKCiAgICBEaWFsb2cucHJvdG90eXBlLndhcm5pbmcgPSBmYWxzZTsKCiAgICBEaWFsb2cucHJvdG90eXBlLmVycm9yID0gZmFsc2U7CgogICAgRGlhbG9nLnByb3RvdHlwZS5jb250ZW50ID0gJyc7CgogICAgRGlhbG9nLnByb3RvdHlwZS5jbGFzc05hbWUgPSAnem9vbml2ZXJzZS1kaWFsb2cnOwoKICAgIERpYWxvZy5wcm90b3R5cGUudGVtcGxhdGUgPSB0ZW1wbGF0ZTsKCiAgICBEaWFsb2cucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ2NsaWNrIGJ1dHRvbltuYW1lPSJjbG9zZS1kaWFsb2ciXSc6ICdoaWRlJywKICAgICAgJ2tleWRvd24nOiAnb25LZXlEb3duJwogICAgfTsKCiAgICBEaWFsb2cucHJvdG90eXBlLmVsZW1lbnRzID0gewogICAgICAnLmRpYWxvZyc6ICdjb250ZW50Q29udGFpbmVyJwogICAgfTsKCiAgICBmdW5jdGlvbiBEaWFsb2coKSB7CiAgICAgIERpYWxvZy5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgdGhpcy5lbC5jc3MoewogICAgICAgIGRpc3BsYXk6ICdub25lJwogICAgICB9KTsKICAgICAgaWYgKHRoaXMud2FybmluZykgewogICAgICAgIHRoaXMuZWwuYWRkQ2xhc3MoJ3dhcm5pbmcnKTsKICAgICAgfQogICAgICBpZiAodGhpcy5lcnJvcikgewogICAgICAgIHRoaXMuZWwuYWRkQ2xhc3MoJ2Vycm9yJyk7CiAgICAgIH0KICAgICAgdGhpcy5jb250ZW50Q29udGFpbmVyLmFwcGVuZCh0aGlzLmNvbnRlbnQpOwogICAgICB0aGlzLmVsLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwogICAgfQoKICAgIERpYWxvZy5wcm90b3R5cGUub25LZXlEb3duID0gZnVuY3Rpb24oX2FyZykgewogICAgICB2YXIgd2hpY2g7CiAgICAgIHdoaWNoID0gX2FyZy53aGljaDsKICAgICAgaWYgKHdoaWNoID09PSAyNykgewogICAgICAgIHJldHVybiB0aGlzLmhpZGUoKTsKICAgICAgfQogICAgfTsKCiAgICBEaWFsb2cucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGVsZW1lbnQsIF9pLCBfbGVuLCBfcmVmLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgX3JlZiA9IHRoaXMuZWwuZ2V0KDApLnF1ZXJ5U2VsZWN0b3JBbGwoIlsiICsgdHJhbnNsYXRlLmF0dHIgKyAiXSIpOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBlbGVtZW50ID0gX3JlZltfaV07CiAgICAgICAgdHJhbnNsYXRlLnJlZnJlc2goZWxlbWVudCk7CiAgICAgIH0KICAgICAgdGhpcy5lbC5jc3MoewogICAgICAgIGRpc3BsYXk6ICcnCiAgICAgIH0pOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5lbC5hZGRDbGFzcygnc2hvd2luZycpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMuY29udGVudENvbnRhaW5lci5maW5kKCdpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCcpLmZpcnN0KCkuZm9jdXMoKTsKICAgIH07CgogICAgRGlhbG9nLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMuZWwucmVtb3ZlQ2xhc3MoJ3Nob3dpbmcnKTsKICAgICAgcmV0dXJuIHNldFRpbWVvdXQoKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5lbC5jc3MoewogICAgICAgICAgZGlzcGxheTogJ25vbmUnCiAgICAgICAgfSk7CiAgICAgIH0pLCA1MDApOwogICAgfTsKCiAgICByZXR1cm4gRGlhbG9nOwoKICB9KShCYXNlQ29udHJvbGxlcik7CgogIHdpbmRvdy56b29uaXZlcnNlLmNvbnRyb2xsZXJzLkRpYWxvZyA9IERpYWxvZzsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBEaWFsb2c7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgQkVUQV9QUkVGRVJFTkNFX0tFWSwgQmFzZUNvbnRyb2xsZXIsIFNpZ251cEZvcm0sIFVzZXIsIHRyYW5zbGF0ZSwgX2Jhc2UsIF9iYXNlMSwgX3JlZiwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5jb250cm9sbGVycyA9PSBudWxsKSB7CiAgICBfYmFzZS5jb250cm9sbGVycyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTEgPSB3aW5kb3cuem9vbml2ZXJzZSkubW9kZWxzID09IG51bGwpIHsKICAgIF9iYXNlMS5tb2RlbHMgPSB7fTsKICB9CgogIEJhc2VDb250cm9sbGVyID0gem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICBVc2VyID0gem9vbml2ZXJzZS5tb2RlbHMuVXNlciB8fCByZXF1aXJlKCcuLi9tb2RlbHMvdXNlcicpOwoKICB0cmFuc2xhdGUgPSB6b29uaXZlcnNlLnRyYW5zbGF0ZSB8fCByZXF1aXJlKCcuLi9saWIvdHJhbnNsYXRlJyk7CgogIEJFVEFfUFJFRkVSRU5DRV9LRVkgPSAnYmV0YV9vcHRfaW4nOwoKICBTaWdudXBGb3JtID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKFNpZ251cEZvcm0sIF9zdXBlcik7CgogICAgZnVuY3Rpb24gU2lnbnVwRm9ybSgpIHsKICAgICAgX3JlZiA9IFNpZ251cEZvcm0uX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfcmVmOwogICAgfQoKICAgIFNpZ251cEZvcm0ucHJvdG90eXBlLnRhZ05hbWUgPSAnZm9ybSc7CgogICAgU2lnbnVwRm9ybS5wcm90b3R5cGUuY2xhc3NOYW1lID0gJ3pvb25pdmVyc2Utc2lnbnVwLWZvcm0nOwoKICAgIFNpZ251cEZvcm0ucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ3N1Ym1pdConOiAnb25TdWJtaXQnCiAgICB9OwoKICAgIFNpZ251cEZvcm0ucHJvdG90eXBlLmVsZW1lbnRzID0gewogICAgICAnaW5wdXRbbmFtZT0idXNlcm5hbWUiXSc6ICd1c2VybmFtZUlucHV0JywKICAgICAgJ2lucHV0W25hbWU9InBhc3N3b3JkIl0nOiAncGFzc3dvcmRJbnB1dCcsCiAgICAgICdpbnB1dFtuYW1lPSJlbWFpbCJdJzogJ2VtYWlsSW5wdXQnLAogICAgICAnaW5wdXRbbmFtZT0icmVhbC1uYW1lIl0nOiAncmVhbE5hbWVJbnB1dCcsCiAgICAgICdpbnB1dFtuYW1lPSJiZXRhLXByZWZlcmVuY2UiXSc6ICdiZXRhUHJlZmVyZW5jZUlucHV0JywKICAgICAgJ2J1dHRvblt0eXBlPSJzdWJtaXQiXSc6ICdzaWduVXBCdXR0b24nLAogICAgICAnLmVycm9yLW1lc3NhZ2UnOiAnZXJyb3JDb250YWluZXInCiAgICB9OwoKICAgIFNpZ251cEZvcm0ucHJvdG90eXBlLm9uU3VibWl0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzaWdudXAsCiAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICB0aGlzLmVsLmFkZENsYXNzKCdsb2FkaW5nJyk7CiAgICAgIHRoaXMuc2lnblVwQnV0dG9uLmF0dHIoewogICAgICAgIGRpc2FibGVkOiB0cnVlCiAgICAgIH0pOwogICAgICBzaWdudXAgPSBVc2VyLnNpZ251cCh7CiAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWVJbnB1dC52YWwoKSwKICAgICAgICBwYXNzd29yZDogdGhpcy5wYXNzd29yZElucHV0LnZhbCgpLAogICAgICAgIGVtYWlsOiB0aGlzLmVtYWlsSW5wdXQudmFsKCksCiAgICAgICAgcmVhbF9uYW1lOiB0aGlzLnJlYWxOYW1lSW5wdXQudmFsKCkKICAgICAgfSk7CiAgICAgIHNpZ251cC5kb25lKGZ1bmN0aW9uKF9hcmcpIHsKICAgICAgICB2YXIgbWVzc2FnZSwgc3VjY2VzcywgX3JlZjE7CiAgICAgICAgc3VjY2VzcyA9IF9hcmcuc3VjY2VzcywgbWVzc2FnZSA9IF9hcmcubWVzc2FnZTsKICAgICAgICBpZiAoIXN1Y2Nlc3MpIHsKICAgICAgICAgIF90aGlzLnNob3dFcnJvcihtZXNzYWdlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChfcmVmMSA9IFVzZXIuY3VycmVudCkgIT0gbnVsbCA/IF9yZWYxLnNldFByZWZlcmVuY2UoQkVUQV9QUkVGRVJFTkNFX0tFWSwgX3RoaXMuYmV0YVByZWZlcmVuY2VJbnB1dC5wcm9wKCdjaGVja2VkJyksIHRydWUpIDogdm9pZCAwOwogICAgICB9KTsKICAgICAgc2lnbnVwLmZhaWwoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLnNob3dFcnJvcih0cmFuc2xhdGUoJ3NpZ25JbkZhaWxlZCcpKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBzaWdudXAuYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgIF90aGlzLmVsLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7CiAgICAgICAgcmV0dXJuIF90aGlzLnNpZ25VcEJ1dHRvbi5hdHRyKHsKICAgICAgICAgIGRpc2FibGVkOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH07CgogICAgU2lnbnVwRm9ybS5wcm90b3R5cGUuc2hvd0Vycm9yID0gZnVuY3Rpb24obWVzc2FnZSkgewogICAgICByZXR1cm4gdGhpcy5lcnJvckNvbnRhaW5lci5odG1sKG1lc3NhZ2UpOwogICAgfTsKCiAgICByZXR1cm4gU2lnbnVwRm9ybTsKCiAgfSkoQmFzZUNvbnRyb2xsZXIpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5TaWdudXBGb3JtID0gU2lnbnVwRm9ybTsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBTaWdudXBGb3JtOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIERpYWxvZywgU2lnbnVwRm9ybSwgVXNlciwgc2lnbnVwRGlhbG9nLCB0ZW1wbGF0ZSwgX2Jhc2UsIF9iYXNlMSwgX2Jhc2UyOwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTIgPSB3aW5kb3cuem9vbml2ZXJzZSkubW9kZWxzID09IG51bGwpIHsKICAgIF9iYXNlMi5tb2RlbHMgPSB7fTsKICB9CgogIERpYWxvZyA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuRGlhbG9nIHx8IHJlcXVpcmUoJy4vZGlhbG9nJyk7CgogIFNpZ251cEZvcm0gPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLlNpZ251cEZvcm0gfHwgcmVxdWlyZSgnLi9zaWdudXAtZm9ybScpOwoKICB0ZW1wbGF0ZSA9IHpvb25pdmVyc2Uudmlld3Muc2lnbnVwRGlhbG9nIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL3NpZ251cC1kaWFsb2cnKTsKCiAgVXNlciA9IHpvb25pdmVyc2UubW9kZWxzLlVzZXIgfHwgcmVxdWlyZSgnLi4vbW9kZWxzL3VzZXInKTsKCiAgc2lnbnVwRGlhbG9nID0gbmV3IERpYWxvZyh7CiAgICBjb250ZW50OiAobmV3IFNpZ251cEZvcm0oewogICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUKICAgIH0pKS5lbAogIH0pOwoKICBVc2VyLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlLCB1c2VyKSB7CiAgICBpZiAodXNlciAhPSBudWxsKSB7CiAgICAgIHJldHVybiBzaWdudXBEaWFsb2cuaGlkZSgpOwogICAgfQogIH0pOwoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5zaWdudXBEaWFsb2cgPSBzaWdudXBEaWFsb2c7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gc2lnbnVwRGlhbG9nOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyIEFwaSwgQmFzZUNvbnRyb2xsZXIsIExvZ2luRm9ybSwgVXNlciwgc2lnbnVwRGlhbG9nLCB0ZW1wbGF0ZSwgdHJhbnNsYXRlLCBfYmFzZSwgX2Jhc2UxLCBfYmFzZTIsCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTIgPSB3aW5kb3cuem9vbml2ZXJzZSkubW9kZWxzID09IG51bGwpIHsKICAgIF9iYXNlMi5tb2RlbHMgPSB7fTsKICB9CgogIEJhc2VDb250cm9sbGVyID0gem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICB0ZW1wbGF0ZSA9IHpvb25pdmVyc2Uudmlld3MubG9naW5Gb3JtIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL2xvZ2luLWZvcm0nKTsKCiAgQXBpID0gem9vbml2ZXJzZS5BcGkgfHwgcmVxdWlyZSgnLi4vbGliL2FwaScpOwoKICBVc2VyID0gem9vbml2ZXJzZS5tb2RlbHMuVXNlciB8fCByZXF1aXJlKCcuLi9tb2RlbHMvdXNlcicpOwoKICB0cmFuc2xhdGUgPSB6b29uaXZlcnNlLnRyYW5zbGF0ZSB8fCByZXF1aXJlKCcuLi9saWIvdHJhbnNsYXRlJyk7CgogIHNpZ251cERpYWxvZyA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuc2lnbnVwRGlhbG9nIHx8IHJlcXVpcmUoJy4vc2lnbnVwLWRpYWxvZycpOwoKICBMb2dpbkZvcm0gPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoTG9naW5Gb3JtLCBfc3VwZXIpOwoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUudGFnTmFtZSA9ICdmb3JtJzsKCiAgICBMb2dpbkZvcm0ucHJvdG90eXBlLmNsYXNzTmFtZSA9ICd6b29uaXZlcnNlLWxvZ2luLWZvcm0nOwoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUudGVtcGxhdGUgPSB0ZW1wbGF0ZTsKCiAgICBMb2dpbkZvcm0ucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ3N1Ym1pdConOiAnb25TdWJtaXQnLAogICAgICAnY2xpY2sqIGJ1dHRvbltuYW1lPSJzaWduLXVwIl0nOiAnb25DbGlja1NpZ25VcCcsCiAgICAgICdjbGljayogYnV0dG9uW25hbWU9InNpZ24tb3V0Il0nOiAnb25DbGlja1NpZ25PdXQnCiAgICB9OwoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUuZWxlbWVudHMgPSB7CiAgICAgICdpbnB1dFtuYW1lPSJ1c2VybmFtZSJdJzogJ3VzZXJuYW1lSW5wdXQnLAogICAgICAnaW5wdXRbbmFtZT0icGFzc3dvcmQiXSc6ICdwYXNzd29yZElucHV0JywKICAgICAgJ2J1dHRvblt0eXBlPSJzdWJtaXQiXSc6ICdzaWduSW5CdXR0b24nLAogICAgICAnYnV0dG9uW25hbWU9InNpZ24tb3V0Il0nOiAnc2lnbk91dEJ1dHRvbicsCiAgICAgICcuZXJyb3ItbWVzc2FnZSc6ICdlcnJvckNvbnRhaW5lcicKICAgIH07CgogICAgZnVuY3Rpb24gTG9naW5Gb3JtKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBMb2dpbkZvcm0uX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIFVzZXIub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5vblVzZXJDaGFuZ2UuYXBwbHkoX3RoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0pOwogICAgfQoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUub25TdWJtaXQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGxvZ2luLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgdGhpcy5lbC5hZGRDbGFzcygnbG9hZGluZycpOwogICAgICB0aGlzLnNpZ25JbkJ1dHRvbi5hdHRyKHsKICAgICAgICBkaXNhYmxlZDogdHJ1ZQogICAgICB9KTsKICAgICAgbG9naW4gPSBVc2VyLmxvZ2luKHsKICAgICAgICB1c2VybmFtZTogdGhpcy51c2VybmFtZUlucHV0LnZhbCgpLAogICAgICAgIHBhc3N3b3JkOiB0aGlzLnBhc3N3b3JkSW5wdXQudmFsKCkKICAgICAgfSk7CiAgICAgIGxvZ2luLmRvbmUoZnVuY3Rpb24oX2FyZykgewogICAgICAgIHZhciBtZXNzYWdlLCBzdWNjZXNzOwogICAgICAgIHN1Y2Nlc3MgPSBfYXJnLnN1Y2Nlc3MsIG1lc3NhZ2UgPSBfYXJnLm1lc3NhZ2U7CiAgICAgICAgaWYgKCFzdWNjZXNzKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMuc2hvd0Vycm9yKG1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGxvZ2luLmZhaWwoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLnNob3dFcnJvcih0cmFuc2xhdGUoJ3NpZ25JbkZhaWxlZCcpKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBsb2dpbi5hbHdheXMoZnVuY3Rpb24oKSB7CiAgICAgICAgX3RoaXMuZWwucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTsKICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBfdGhpcy5zaWduSW5CdXR0b24uYXR0cih7CiAgICAgICAgICAgIGRpc2FibGVkOiBVc2VyLmN1cnJlbnQgIT0gbnVsbAogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfTsKCiAgICBMb2dpbkZvcm0ucHJvdG90eXBlLm9uQ2xpY2tTaWduVXAgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHNpZ251cERpYWxvZy5zaG93KCk7CiAgICB9OwoKICAgIExvZ2luRm9ybS5wcm90b3R5cGUub25DbGlja1NpZ25PdXQgPSBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5zaWduT3V0QnV0dG9uLmF0dHIoewogICAgICAgIGRpc2FibGVkOiB0cnVlCiAgICAgIH0pOwogICAgICByZXR1cm4gVXNlci5sb2dvdXQoKTsKICAgIH07CgogICAgTG9naW5Gb3JtLnByb3RvdHlwZS5vblVzZXJDaGFuZ2UgPSBmdW5jdGlvbihlLCB1c2VyKSB7CiAgICAgIHRoaXMudXNlcm5hbWVJbnB1dC52YWwoKHVzZXIgIT0gbnVsbCA/IHVzZXIubmFtZSA6IHZvaWQgMCkgfHwgJycpOwogICAgICB0aGlzLnBhc3N3b3JkSW5wdXQudmFsKCh1c2VyICE9IG51bGwgPyB1c2VyLmFwaV9rZXkgOiB2b2lkIDApIHx8ICcnKTsKICAgICAgdGhpcy5lcnJvckNvbnRhaW5lci5odG1sKCcnKTsKICAgICAgdGhpcy51c2VybmFtZUlucHV0LmF0dHIoewogICAgICAgIGRpc2FibGVkOiBVc2VyLmN1cnJlbnQgIT0gbnVsbAogICAgICB9KTsKICAgICAgdGhpcy5wYXNzd29yZElucHV0LmF0dHIoewogICAgICAgIGRpc2FibGVkOiBVc2VyLmN1cnJlbnQgIT0gbnVsbAogICAgICB9KTsKICAgICAgdGhpcy5zaWduSW5CdXR0b24uYXR0cih7CiAgICAgICAgZGlzYWJsZWQ6IFVzZXIuY3VycmVudCAhPSBudWxsCiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5zaWduT3V0QnV0dG9uLmF0dHIoewogICAgICAgIGRpc2FibGVkOiBVc2VyLmN1cnJlbnQgPT0gbnVsbAogICAgICB9KTsKICAgIH07CgogICAgTG9naW5Gb3JtLnByb3RvdHlwZS5zaG93RXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgIHJldHVybiB0aGlzLmVycm9yQ29udGFpbmVyLmh0bWwobWVzc2FnZSk7CiAgICB9OwoKICAgIHJldHVybiBMb2dpbkZvcm07CgogIH0pKEJhc2VDb250cm9sbGVyKTsKCiAgd2luZG93Lnpvb25pdmVyc2UuY29udHJvbGxlcnMuTG9naW5Gb3JtID0gTG9naW5Gb3JtOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IExvZ2luRm9ybTsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBEaWFsb2csIExvZ2luRm9ybSwgVXNlciwgbG9naW5EaWFsb2csIHRlbXBsYXRlLCBfYmFzZTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLmNvbnRyb2xsZXJzID09IG51bGwpIHsKICAgIF9iYXNlLmNvbnRyb2xsZXJzID0ge307CiAgfQoKICBEaWFsb2cgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkRpYWxvZyB8fCByZXF1aXJlKCcuL2RpYWxvZycpOwoKICBMb2dpbkZvcm0gPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkxvZ2luRm9ybSB8fCByZXF1aXJlKCcuL2xvZ2luLWZvcm0nKTsKCiAgdGVtcGxhdGUgPSB6b29uaXZlcnNlLnZpZXdzLmxvZ2luRGlhbG9nIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL2xvZ2luLWRpYWxvZycpOwoKICBVc2VyID0gem9vbml2ZXJzZS5tb2RlbHMuVXNlciB8fCByZXF1aXJlKCcuLi9tb2RlbHMvdXNlcicpOwoKICBsb2dpbkRpYWxvZyA9IG5ldyBEaWFsb2coewogICAgY29udGVudDogKG5ldyBMb2dpbkZvcm0oewogICAgICB0ZW1wbGF0ZTogdGVtcGxhdGUKICAgIH0pKS5lbAogIH0pOwoKICBVc2VyLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihlLCB1c2VyKSB7CiAgICBpZiAodXNlciAhPSBudWxsKSB7CiAgICAgIHJldHVybiBsb2dpbkRpYWxvZy5oaWRlKCk7CiAgICB9CiAgfSk7CgogIHdpbmRvdy56b29uaXZlcnNlLmNvbnRyb2xsZXJzLmxvZ2luRGlhbG9nID0gbG9naW5EaWFsb2c7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gbG9naW5EaWFsb2c7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgRHJvcGRvd24sIHRvZ2dsZUNsYXNzLCBfYmFzZSwgX3JlZiwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2luZGV4T2YgPSBbXS5pbmRleE9mIHx8IGZ1bmN0aW9uKGl0ZW0pIHsgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKykgeyBpZiAoaSBpbiB0aGlzICYmIHRoaXNbaV0gPT09IGl0ZW0pIHJldHVybiBpOyB9IHJldHVybiAtMTsgfTsKCiAgdG9nZ2xlQ2xhc3MgPSAoKF9yZWYgPSB6b29uaXZlcnNlLnV0aWwpICE9IG51bGwgPyBfcmVmLnRvZ2dsZUNsYXNzIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi91dGlsL3RvZ2dsZS1jbGFzcycpOwoKICBEcm9wZG93biA9IChmdW5jdGlvbigpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgRHJvcGRvd24uYnV0dG9uQ2xhc3MgPSAnem9vbml2ZXJzZS1kcm9wZG93bi1idXR0b24nOwoKICAgIERyb3Bkb3duLm1lbnVDbGFzcyA9ICd6b29uaXZlcnNlLWRyb3Bkb3duLW1lbnUnOwoKICAgIERyb3Bkb3duLmluc3RhbmNlcyA9IFtdOwoKICAgIERyb3Bkb3duLmVsZW1lbnRzID0gW107CgogICAgRHJvcGRvd24uY2xvc2VBbGwgPSBmdW5jdGlvbihfYXJnKSB7CiAgICAgIHZhciBleGNlcHQsIGluc3RhbmNlLCBfaSwgX2xlbiwgX3JlZjEsIF9yZXN1bHRzOwogICAgICBleGNlcHQgPSAoX2FyZyAhPSBudWxsID8gX2FyZyA6IHt9KS5leGNlcHQ7CiAgICAgIF9yZWYxID0gdGhpcy5pbnN0YW5jZXM7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZjEubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBpbnN0YW5jZSA9IF9yZWYxW19pXTsKICAgICAgICBpZiAoaW5zdGFuY2UgIT09IGV4Y2VwdCkgewogICAgICAgICAgX3Jlc3VsdHMucHVzaChpbnN0YW5jZS5jbG9zZSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3Jlc3VsdHMucHVzaCh2b2lkIDApOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIGFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIG5vZGUsIHNob3VsZENsb3NlOwogICAgICBzaG91bGRDbG9zZSA9IHRydWU7CiAgICAgIG5vZGUgPSBlLnRhcmdldC5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCB8fCBlLnRhcmdldDsKICAgICAgd2hpbGUgKG5vZGUgIT0gbnVsbCkgewogICAgICAgIGlmIChfX2luZGV4T2YuY2FsbChEcm9wZG93bi5lbGVtZW50cywgbm9kZSkgPj0gMCkgewogICAgICAgICAgc2hvdWxkQ2xvc2UgPSBmYWxzZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlOwogICAgICB9CiAgICAgIGlmIChzaG91bGRDbG9zZSkgewogICAgICAgIHJldHVybiBEcm9wZG93bi5jbG9zZUFsbCgpOwogICAgICB9CiAgICB9KTsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuYnV0dG9uID0gbnVsbDsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuYnV0dG9uQ2xhc3MgPSAnJzsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuYnV0dG9uVGFnID0gJ2J1dHRvbic7CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm1lbnUgPSBudWxsOwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5tZW51Q2xhc3MgPSAnJzsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUubWVudVRhZyA9ICdkaXYnOwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5idXR0b25QaW5uaW5nID0gWzAuNSwgMV07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm1lbnVQaW5uaW5nID0gWzAuNSwgMF07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLl9vcGVuID0gbnVsbDsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUub3BlbkNsYXNzID0gJ29wZW4nOwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5hbmltYXRpb25EZWxheSA9IDI1MDsKCiAgICBmdW5jdGlvbiBEcm9wZG93bihwYXJhbXMpIHsKICAgICAgdmFyIHByb3BlcnR5LCB2YWx1ZTsKICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKSB7CiAgICAgICAgcGFyYW1zID0ge307CiAgICAgIH0KICAgICAgdGhpcy5vblJlc2l6ZSA9IF9fYmluZCh0aGlzLm9uUmVzaXplLCB0aGlzKTsKICAgICAgdGhpcy5vbkJ1dHRvbkNsaWNrID0gX19iaW5kKHRoaXMub25CdXR0b25DbGljaywgdGhpcyk7CiAgICAgIHdpbmRvdy5kcm9wZG93biA9IHRoaXM7CiAgICAgIGZvciAocHJvcGVydHkgaW4gcGFyYW1zKSB7CiAgICAgICAgdmFsdWUgPSBwYXJhbXNbcHJvcGVydHldOwogICAgICAgIHRoaXNbcHJvcGVydHldID0gdmFsdWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYnV0dG9uID09IG51bGwpIHsKICAgICAgICB0aGlzLmJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy5idXR0b25UYWcpOwogICAgICB9CiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMuYnV0dG9uLCB0aGlzLmNvbnN0cnVjdG9yLmJ1dHRvbkNsYXNzLCB0cnVlKTsKICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKSB7CiAgICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5idXR0b24sIHRoaXMuY2xhc3NOYW1lLCB0cnVlKTsKICAgICAgfQogICAgICB0aGlzLmJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25CdXR0b25DbGljaywgZmFsc2UpOwogICAgICBpZiAodGhpcy5tZW51ID09IG51bGwpIHsKICAgICAgICB0aGlzLm1lbnUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMubWVudVRhZyk7CiAgICAgIH0KICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5tZW51LCB0aGlzLmNvbnN0cnVjdG9yLm1lbnVDbGFzcywgdHJ1ZSk7CiAgICAgIGlmICh0aGlzLm1lbnVDbGFzcykgewogICAgICAgIHRvZ2dsZUNsYXNzKHRoaXMubWVudSwgdGhpcy5tZW51Q2xhc3MsIHRydWUpOwogICAgICB9CiAgICAgIHRoaXMubWVudS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICAgIHRoaXMubWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubWVudSk7CiAgICAgIHRoaXMuY2xvc2UoKTsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5pbnN0YW5jZXMucHVzaCh0aGlzKTsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5lbGVtZW50cy5wdXNoKHRoaXMuYnV0dG9uKTsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5lbGVtZW50cy5wdXNoKHRoaXMubWVudSk7CiAgICB9CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm9uQnV0dG9uQ2xpY2sgPSBmdW5jdGlvbihlKSB7CiAgICAgIHJldHVybiB0aGlzLnRvZ2dsZSgpOwogICAgfTsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLl9vcGVuKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2UoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vcGVuKCk7CiAgICAgIH0KICAgIH07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5jbG9zZUFsbCh7CiAgICAgICAgZXhjZXB0OiB0aGlzCiAgICAgIH0pOwogICAgICB0b2dnbGVDbGFzcyh0aGlzLmJ1dHRvbiwgdGhpcy5vcGVuQ2xhc3MsIHRydWUpOwogICAgICB0aGlzLm1lbnUuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgICB0aGlzLnBvc2l0aW9uTWVudSgpOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHRvZ2dsZUNsYXNzKF90aGlzLm1lbnUsIF90aGlzLm9wZW5DbGFzcywgdHJ1ZSk7CiAgICAgICAgcmV0dXJuIF90aGlzLl9vcGVuID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHJldHVybiBhZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplLCBmYWxzZSk7CiAgICB9OwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5wb3NpdGlvbk1lbnUgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGJ1dHRvbk9mZnNldDsKICAgICAgYnV0dG9uT2Zmc2V0ID0gdGhpcy5idXR0b24uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIHRoaXMubWVudS5zdHlsZS5sZWZ0ID0gKChidXR0b25PZmZzZXQubGVmdCArIHBhZ2VYT2Zmc2V0KSArICh0aGlzLmJ1dHRvbi5vZmZzZXRXaWR0aCAqIHRoaXMuYnV0dG9uUGlubmluZ1swXSkpIC0gKHRoaXMubWVudS5vZmZzZXRXaWR0aCAqIHRoaXMubWVudVBpbm5pbmdbMF0pICsgJ3B4JzsKICAgICAgcmV0dXJuIHRoaXMubWVudS5zdHlsZS50b3AgPSAoKGJ1dHRvbk9mZnNldC50b3AgKyBwYWdlWU9mZnNldCkgKyAodGhpcy5idXR0b24ub2Zmc2V0SGVpZ2h0ICogdGhpcy5idXR0b25QaW5uaW5nWzFdKSkgLSAodGhpcy5tZW51Lm9mZnNldEhlaWdodCAqIHRoaXMubWVudVBpbm5pbmdbMV0pICsgJ3B4JzsKICAgIH07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uTWVudSgpOwogICAgfTsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdG9nZ2xlQ2xhc3ModGhpcy5idXR0b24sIHRoaXMub3BlbkNsYXNzLCBmYWxzZSk7CiAgICAgIHRvZ2dsZUNsYXNzKHRoaXMubWVudSwgdGhpcy5vcGVuQ2xhc3MsIGZhbHNlKTsKICAgICAgc2V0VGltZW91dCgoZnVuY3Rpb24oKSB7CiAgICAgICAgX3RoaXMubWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHJldHVybiBfdGhpcy5fb3BlbiA9IGZhbHNlOwogICAgICB9KSwgdGhpcy5hbmltYXRpb25EZWxheSk7CiAgICAgIHJldHVybiByZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplLCBmYWxzZSk7CiAgICB9OwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfcmVmMSwgX3JlZjI7CiAgICAgIHRoaXMuY29uc3RydWN0b3IuaW5zdGFuY2VzLnNwbGljZSh0aGlzLmNvbnN0cnVjdG9yLmluc3RhbmNlcy5pbmRleE9mKHRoaXMpLCAxKTsKICAgICAgdGhpcy5jb25zdHJ1Y3Rvci5lbGVtZW50cy5zcGxpY2UodGhpcy5jb25zdHJ1Y3Rvci5pbnN0YW5jZXMuaW5kZXhPZih0aGlzLmJ1dHRvbiksIDEpOwogICAgICB0aGlzLmNvbnN0cnVjdG9yLmVsZW1lbnRzLnNwbGljZSh0aGlzLmNvbnN0cnVjdG9yLmluc3RhbmNlcy5pbmRleE9mKHRoaXMubWVudSksIDEpOwogICAgICB0aGlzLmJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25CdXR0b25DbGljaywgZmFsc2UpOwogICAgICBpZiAoKF9yZWYxID0gdGhpcy5idXR0b24ucGFyZW50Tm9kZSkgIT0gbnVsbCkgewogICAgICAgIF9yZWYxLnJlbW92ZUNoaWxkKHRoaXMuYnV0dG9uKTsKICAgICAgfQogICAgICByZXR1cm4gKF9yZWYyID0gdGhpcy5tZW51LnBhcmVudE5vZGUpICE9IG51bGwgPyBfcmVmMi5yZW1vdmVDaGlsZCh0aGlzLm1lbnUpIDogdm9pZCAwOwogICAgfTsKCiAgICByZXR1cm4gRHJvcGRvd247CgogIH0pLmNhbGwodGhpcyk7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5jb250cm9sbGVycyA9PSBudWxsKSB7CiAgICBfYmFzZS5jb250cm9sbGVycyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UuY29udHJvbGxlcnMuRHJvcGRvd24gPSBEcm9wZG93bjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBEcm9wZG93bjsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBDb250cm9sbGVyLCBEcm9wZG93biwgTGFuZ3VhZ2VNYW5hZ2VyLCBMYW5ndWFnZXNNZW51LCB0ZW1wbGF0ZSwgX2Jhc2UsIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjMsIF9yZWY0LCBfcmVmNSwgX3JlZjYsCiAgICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LAogICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksCiAgICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTsKCiAgQ29udHJvbGxlciA9ICgoX3JlZiA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWYxID0gX3JlZi5jb250cm9sbGVycykgIT0gbnVsbCA/IF9yZWYxLkJhc2VDb250cm9sbGVyIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICBEcm9wZG93biA9ICgoX3JlZjIgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMyA9IF9yZWYyLmNvbnRyb2xsZXJzKSAhPSBudWxsID8gX3JlZjMuRHJvcGRvd24gOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4vZHJvcGRvd24nKTsKCiAgTGFuZ3VhZ2VNYW5hZ2VyID0gKChfcmVmNCA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gX3JlZjQuTGFuZ3VhZ2VNYW5hZ2VyIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi9saWIvbGFuZ3VhZ2UtbWFuYWdlcicpOwoKICB0ZW1wbGF0ZSA9ICgoX3JlZjUgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmNiA9IF9yZWY1LnZpZXdzKSAhPSBudWxsID8gX3JlZjYubGFuZ3VhZ2VzTWVudSA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi4vdmlld3MvbGFuZ3VhZ2VzLW1lbnUnKTsKCiAgTGFuZ3VhZ2VzTWVudSA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhMYW5ndWFnZXNNZW51LCBfc3VwZXIpOwoKICAgIExhbmd1YWdlc01lbnUucHJvdG90eXBlLmNsYXNzTmFtZSA9ICd6b29uaXZlcnNlLWxhbmd1YWdlcy1tZW51JzsKCiAgICBMYW5ndWFnZXNNZW51LnByb3RvdHlwZS50ZW1wbGF0ZSA9IHRlbXBsYXRlOwoKICAgIExhbmd1YWdlc01lbnUucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ2NsaWNrIGJ1dHRvbltuYW1lPSJsYW5ndWFnZSJdJzogJ29uQ2xpY2tMYW5ndWFnZUJ1dHRvbicKICAgIH07CgogICAgZnVuY3Rpb24gTGFuZ3VhZ2VzTWVudSgpIHsKICAgICAgdGhpcy5vbkNsaWNrTGFuZ3VhZ2VCdXR0b24gPSBfX2JpbmQodGhpcy5vbkNsaWNrTGFuZ3VhZ2VCdXR0b24sIHRoaXMpOwogICAgICB2YXIgX3JlZjcsCiAgICAgICAgX3RoaXMgPSB0aGlzOwogICAgICBMYW5ndWFnZXNNZW51Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBpZiAoKF9yZWY3ID0gTGFuZ3VhZ2VNYW5hZ2VyLmN1cnJlbnQpICE9IG51bGwpIHsKICAgICAgICBfcmVmNy5vbignY2hhbmdlLWxhbmd1YWdlJywgZnVuY3Rpb24oZSwgY29kZSkgewogICAgICAgICAgcmV0dXJuIF90aGlzLnNldExhbmd1YWdlQnV0dG9uKGNvZGUpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgTGFuZ3VhZ2VzTWVudS5wcm90b3R5cGUub25DbGlja0xhbmd1YWdlQnV0dG9uID0gZnVuY3Rpb24oZSkgewogICAgICB2YXIgX3JlZjc7CiAgICAgIGlmICgoX3JlZjcgPSBMYW5ndWFnZU1hbmFnZXIuY3VycmVudCkgIT0gbnVsbCkgewogICAgICAgIF9yZWY3LnNldExhbmd1YWdlKGUuY3VycmVudFRhcmdldC52YWx1ZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIERyb3Bkb3duLmNsb3NlQWxsKCk7CiAgICB9OwoKICAgIExhbmd1YWdlc01lbnUucHJvdG90eXBlLnNldExhbmd1YWdlQnV0dG9uID0gZnVuY3Rpb24oY29kZSkgewogICAgICB2YXIgYnV0dG9ucywgdGFyZ2V0OwogICAgICB0YXJnZXQgPSB0aGlzLmVsLmZpbmQoJ2J1dHRvblt2YWx1ZT0iJyArIGNvZGUgKyAnIl0nKTsKICAgICAgaWYgKHRhcmdldC5sZW5ndGggIT09IDApIHsKICAgICAgICBidXR0b25zID0gdGhpcy5lbC5maW5kKCdidXR0b25bbmFtZT0ibGFuZ3VhZ2UiXScpOwogICAgICAgIGJ1dHRvbnMucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwogICAgICAgIHJldHVybiB0YXJnZXQuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBMYW5ndWFnZXNNZW51OwoKICB9KShDb250cm9sbGVyKTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLmNvbnRyb2xsZXJzID09IG51bGwpIHsKICAgIF9iYXNlLmNvbnRyb2xsZXJzID0ge307CiAgfQoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5MYW5ndWFnZXNNZW51ID0gTGFuZ3VhZ2VzTWVudTsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBMYW5ndWFnZXNNZW51OwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyICQsIENvbnRyb2xsZXIsIERyb3Bkb3duLCBHcm91cHNNZW51LCBVc2VyLCB0ZW1wbGF0ZSwgX2Jhc2UsIF9yZWYsIF9yZWYxLCBfcmVmMiwgX3JlZjMsIF9yZWY0LCBfcmVmNSwgX3JlZjYsIF9yZWY3LAogICAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07CgogIENvbnRyb2xsZXIgPSAoKF9yZWYgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMSA9IF9yZWYuY29udHJvbGxlcnMpICE9IG51bGwgPyBfcmVmMS5CYXNlQ29udHJvbGxlciA6IHZvaWQgMCA6IHZvaWQgMCkgfHwgcmVxdWlyZSgnLi9iYXNlLWNvbnRyb2xsZXInKTsKCiAgVXNlciA9ICgoX3JlZjIgPSB3aW5kb3cuem9vbml2ZXJzZSkgIT0gbnVsbCA/IChfcmVmMyA9IF9yZWYyLm1vZGVscykgIT0gbnVsbCA/IF9yZWYzLlVzZXIgOiB2b2lkIDAgOiB2b2lkIDApIHx8IHJlcXVpcmUoJy4uL21vZGVscy91c2VyJyk7CgogIHRlbXBsYXRlID0gKChfcmVmNCA9IHdpbmRvdy56b29uaXZlcnNlKSAhPSBudWxsID8gKF9yZWY1ID0gX3JlZjQudmlld3MpICE9IG51bGwgPyBfcmVmNS5ncm91cHNNZW51IDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuLi92aWV3cy9ncm91cHMtbWVudScpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgRHJvcGRvd24gPSAoKF9yZWY2ID0gd2luZG93Lnpvb25pdmVyc2UpICE9IG51bGwgPyAoX3JlZjcgPSBfcmVmNi5jb250cm9sbGVycykgIT0gbnVsbCA/IF9yZWY3LkRyb3Bkb3duIDogdm9pZCAwIDogdm9pZCAwKSB8fCByZXF1aXJlKCcuL2Ryb3Bkb3duJyk7CgogIEdyb3Vwc01lbnUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoR3JvdXBzTWVudSwgX3N1cGVyKTsKCiAgICBHcm91cHNNZW51LnByb3RvdHlwZS5jbGFzc05hbWUgPSAnem9vbml2ZXJzZS1ncm91cHMtbWVudSc7CgogICAgR3JvdXBzTWVudS5wcm90b3R5cGUuZXZlbnRzID0gewogICAgICAnY2xpY2sgYnV0dG9uW25hbWU9InVzZXItZ3JvdXAiXSc6ICdvbkNsaWNrR3JvdXBCdXR0b24nCiAgICB9OwoKICAgIGZ1bmN0aW9uIEdyb3Vwc01lbnUoKSB7CiAgICAgIHRoaXMub25Vc2VyQ2hhbmdlR3JvdXAgPSBfX2JpbmQodGhpcy5vblVzZXJDaGFuZ2VHcm91cCwgdGhpcyk7CiAgICAgIHRoaXMub25Vc2VyQ2hhbmdlID0gX19iaW5kKHRoaXMub25Vc2VyQ2hhbmdlLCB0aGlzKTsKICAgICAgR3JvdXBzTWVudS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgVXNlci5vbignY2hhbmdlJywgdGhpcy5vblVzZXJDaGFuZ2UpOwogICAgICBVc2VyLm9uKCdjaGFuZ2UtZ3JvdXAnLCB0aGlzLm9uVXNlckNoYW5nZUdyb3VwKTsKICAgIH0KCiAgICBHcm91cHNNZW51LnByb3RvdHlwZS5vblVzZXJDaGFuZ2UgPSBmdW5jdGlvbihlLCB1c2VyKSB7CiAgICAgIGlmICh1c2VyICE9IG51bGwpIHsKICAgICAgICB0aGlzLmVsLmh0bWwodGVtcGxhdGUodXNlcikpOwogICAgICAgIGlmICh1c2VyLnVzZXJfZ3JvdXBfaWQpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmVsLmZpbmQoImJ1dHRvbltuYW1lPSciICsgdXNlci51c2VyX2dyb3VwX2lkICsgIiddIikuY2xpY2soKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgR3JvdXBzTWVudS5wcm90b3R5cGUub25Vc2VyQ2hhbmdlR3JvdXAgPSBmdW5jdGlvbihlLCB1c2VyLCBncm91cCkgewogICAgICB2YXIgYnV0dG9uczsKICAgICAgYnV0dG9ucyA9IHRoaXMuZWwuZmluZCgnYnV0dG9uW25hbWU9InVzZXItZ3JvdXAiXScpOwogICAgICBidXR0b25zLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHsKICAgICAgICByZXR1cm4gYnV0dG9ucy5maWx0ZXIoIlt2YWx1ZT0nIiArIGdyb3VwLmlkICsgIiddIikuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB9CiAgICB9OwoKICAgIEdyb3Vwc01lbnUucHJvdG90eXBlLm9uQ2xpY2tHcm91cEJ1dHRvbiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIHRhcmdldCwgX3JlZjg7CiAgICAgIHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTsKICAgICAgaWYgKChfcmVmOCA9IFVzZXIuY3VycmVudCkgIT0gbnVsbCkgewogICAgICAgIF9yZWY4LnNldEdyb3VwKHRhcmdldC52YWwoKSB8fCAnVE9ET19IT1dfRE9fSV9TVE9QX0NMQVNTSUZZSU5HX0FTX1BBUlRfT0ZfQV9HUk9VUCcpOwogICAgICB9CiAgICAgIHJldHVybiBEcm9wZG93bi5jbG9zZUFsbCgpOwogICAgfTsKCiAgICByZXR1cm4gR3JvdXBzTWVudTsKCiAgfSkoQ29udHJvbGxlcik7CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5jb250cm9sbGVycyA9PSBudWxsKSB7CiAgICBfYmFzZS5jb250cm9sbGVycyA9IHt9OwogIH0KCiAgd2luZG93Lnpvb25pdmVyc2UuY29udHJvbGxlcnMuR3JvdXBzTWVudSA9IEdyb3Vwc01lbnU7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gR3JvdXBzTWVudTsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciBBcGksIEJhc2VDb250cm9sbGVyLCBEcm9wZG93biwgR3JvdXBzTWVudSwgTGFuZ3VhZ2VNYW5hZ2VyLCBMYW5ndWFnZXNNZW51LCBUb3BCYXIsIFVzZXIsIGRlZmF1bHRUYWxrUHJvZmlsZUhyZWYsIGxvZ2luRGlhbG9nLCBzaWdudXBEaWFsb2csIHRlbXBsYXRlLCBfYmFzZSwgX2Jhc2UxLCBfYmFzZTIsIF9iYXNlMywKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTIgPSB3aW5kb3cuem9vbml2ZXJzZSkubGliID09IG51bGwpIHsKICAgIF9iYXNlMi5saWIgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UzID0gd2luZG93Lnpvb25pdmVyc2UpLm1vZGVscyA9PSBudWxsKSB7CiAgICBfYmFzZTMubW9kZWxzID0ge307CiAgfQoKICBCYXNlQ29udHJvbGxlciA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuQmFzZUNvbnRyb2xsZXIgfHwgcmVxdWlyZSgnLi9iYXNlLWNvbnRyb2xsZXInKTsKCiAgbG9naW5EaWFsb2cgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLmxvZ2luRGlhbG9nIHx8IHJlcXVpcmUoJy4vbG9naW4tZGlhbG9nJyk7CgogIHNpZ251cERpYWxvZyA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuc2lnbnVwRGlhbG9nIHx8IHJlcXVpcmUoJy4vc2lnbnVwLWRpYWxvZycpOwoKICB0ZW1wbGF0ZSA9IHpvb25pdmVyc2Uudmlld3MudG9wQmFyIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL3RvcC1iYXInKTsKCiAgRHJvcGRvd24gPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkRyb3Bkb3duIHx8IHJlcXVpcmUoJy4vZHJvcGRvd24nKTsKCiAgR3JvdXBzTWVudSA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuR3JvdXBzTWVudSB8fCByZXF1aXJlKCcuL2dyb3Vwcy1tZW51Jyk7CgogIExhbmd1YWdlTWFuYWdlciA9IHpvb25pdmVyc2UuTGFuZ3VhZ2VNYW5hZ2VyIHx8IHJlcXVpcmUoJy4uL2xpYi9sYW5ndWFnZS1tYW5hZ2VyJyk7CgogIExhbmd1YWdlc01lbnUgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLkxhbmd1YWdlc01lbnUgfHwgcmVxdWlyZSgnLi9sYW5ndWFnZXMtbWVudScpOwoKICBBcGkgPSB6b29uaXZlcnNlLkFwaSB8fCByZXF1aXJlKCcuLi9saWIvYXBpJyk7CgogIFVzZXIgPSB6b29uaXZlcnNlLm1vZGVscy5Vc2VyIHx8IHJlcXVpcmUoJy4uL21vZGVscy91c2VyJyk7CgogIGRlZmF1bHRUYWxrUHJvZmlsZUhyZWYgPSAiaHR0cDovL3RhbGsuIiArIChsb2NhdGlvbi5ob3N0bmFtZS5yZXBsYWNlKC9ed3d3XC4vLCAnJykpICsgIi8jL3Byb2ZpbGUiOwoKICBUb3BCYXIgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoVG9wQmFyLCBfc3VwZXIpOwoKICAgIFRvcEJhci5wcm90b3R5cGUuY2xhc3NOYW1lID0gJ3pvb25pdmVyc2UtdG9wLWJhcic7CgogICAgVG9wQmFyLnByb3RvdHlwZS50ZW1wbGF0ZSA9IHRlbXBsYXRlOwoKICAgIFRvcEJhci5wcm90b3R5cGUubWVzc2FnZUNoZWNrVGltZW91dCA9IDIgKiA2MCAqIDEwMDA7CgogICAgVG9wQmFyLnByb3RvdHlwZS50YWxrUHJvZmlsZUhyZWYgPSBkZWZhdWx0VGFsa1Byb2ZpbGVIcmVmOwoKICAgIFRvcEJhci5wcm90b3R5cGUuZXZlbnRzID0gewogICAgICAnY2xpY2sgYnV0dG9uW25hbWU9InNpZ24taW4iXSc6ICdvbkNsaWNrU2lnbkluJywKICAgICAgJ2NsaWNrIGJ1dHRvbltuYW1lPSJzaWduLXVwIl0nOiAnb25DbGlja1NpZ25VcCcsCiAgICAgICdjbGljayBidXR0b25bbmFtZT0ic2lnbi1vdXQiXSc6ICdvbkNsaWNrU2lnbk91dCcKICAgIH07CgogICAgVG9wQmFyLnByb3RvdHlwZS5lbGVtZW50cyA9IHsKICAgICAgJy5jdXJyZW50LXVzZXItbmFtZSc6ICdjdXJyZW50VXNlck5hbWUnLAogICAgICAnYnV0dG9uW25hbWU9Imdyb3VwcyJdJzogJ2dyb3Vwc01lbnVCdXR0b24nLAogICAgICAnYnV0dG9uW25hbWU9Imxhbmd1YWdlcy1tZW51LXRvZ2dsZSJdJzogJ2xhbmd1YWdlc01lbnVCdXR0b24nLAogICAgICAnLm1lc3NhZ2UtY291bnQnOiAnbWVzc2FnZUNvdW50JywKICAgICAgJy5hdmF0YXIgaW1nJzogJ2F2YXRhckltYWdlJywKICAgICAgJy5ncm91cCc6ICdjdXJyZW50R3JvdXAnCiAgICB9OwoKICAgIGZ1bmN0aW9uIFRvcEJhcigpIHsKICAgICAgdGhpcy5vbkxhbmd1YWdlQ2hhbmdlID0gX19iaW5kKHRoaXMub25MYW5ndWFnZUNoYW5nZSwgdGhpcyk7CiAgICAgIHRoaXMub25Vc2VyQ2hhbmdlR3JvdXAgPSBfX2JpbmQodGhpcy5vblVzZXJDaGFuZ2VHcm91cCwgdGhpcyk7CiAgICAgIHRoaXMuZ2V0TWVzc2FnZXMgPSBfX2JpbmQodGhpcy5nZXRNZXNzYWdlcywgdGhpcyk7CiAgICAgIHRoaXMub25Vc2VyQ2hhbmdlID0gX19iaW5kKHRoaXMub25Vc2VyQ2hhbmdlLCB0aGlzKTsKICAgICAgVG9wQmFyLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB0aGlzLmdyb3Vwc01lbnUgPSBuZXcgR3JvdXBzTWVudTsKICAgICAgdGhpcy5ncm91cHNEcm9wZG93biA9IG5ldyBEcm9wZG93bih7CiAgICAgICAgYnV0dG9uOiB0aGlzLmdyb3Vwc01lbnVCdXR0b24uZ2V0KDApLAogICAgICAgIGJ1dHRvblBpbm5pbmc6IFsxLCAxXSwKICAgICAgICBtZW51OiB0aGlzLmdyb3Vwc01lbnUuZWwuZ2V0KDApLAogICAgICAgIG1lbnVDbGFzczogJ2Zyb20tdG9wLWJhcicsCiAgICAgICAgbWVudVBpbm5pbmc6IFsxLCAwXQogICAgICB9KTsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnaGFzLWxhbmd1YWdlcycsIExhbmd1YWdlTWFuYWdlci5jdXJyZW50ICE9IG51bGwpOwogICAgICBpZiAoTGFuZ3VhZ2VNYW5hZ2VyLmN1cnJlbnQgIT0gbnVsbCkgewogICAgICAgIHRoaXMub25MYW5ndWFnZUNoYW5nZSgpOwogICAgICAgIExhbmd1YWdlTWFuYWdlci5vbignY2hhbmdlLWxhbmd1YWdlJywgdGhpcy5vbkxhbmd1YWdlQ2hhbmdlKTsKICAgICAgICB0aGlzLmxhbmd1YWdlc01lbnUgPSBuZXcgTGFuZ3VhZ2VzTWVudSgpOwogICAgICAgIHRoaXMubGFuZ3VhZ2VzRHJvcGRvd24gPSBuZXcgRHJvcGRvd24oewogICAgICAgICAgYnV0dG9uOiB0aGlzLmxhbmd1YWdlc01lbnVCdXR0b24uZ2V0KDApLAogICAgICAgICAgYnV0dG9uUGlubmluZzogWzEsIDFdLAogICAgICAgICAgbWVudTogdGhpcy5sYW5ndWFnZXNNZW51LmVsLmdldCgwKSwKICAgICAgICAgIG1lbnVDbGFzczogJ2Zyb20tdG9wLWJhcicsCiAgICAgICAgICBtZW51UGlubmluZzogWzEsIDBdCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgVXNlci5vbignY2hhbmdlJywgdGhpcy5vblVzZXJDaGFuZ2UpOwogICAgICBVc2VyLm9uKCdjaGFuZ2UtZ3JvdXAnLCB0aGlzLm9uVXNlckNoYW5nZUdyb3VwKTsKICAgIH0KCiAgICBUb3BCYXIucHJvdG90eXBlLm9uQ2xpY2tTaWduSW4gPSBmdW5jdGlvbigpIHsKICAgICAgc2lnbnVwRGlhbG9nLmhpZGUoKTsKICAgICAgcmV0dXJuIGxvZ2luRGlhbG9nLnNob3coKTsKICAgIH07CgogICAgVG9wQmFyLnByb3RvdHlwZS5vbkNsaWNrU2lnblVwID0gZnVuY3Rpb24oKSB7CiAgICAgIGxvZ2luRGlhbG9nLmhpZGUoKTsKICAgICAgcmV0dXJuIHNpZ251cERpYWxvZy5zaG93KCk7CiAgICB9OwoKICAgIFRvcEJhci5wcm90b3R5cGUub25DbGlja1NpZ25PdXQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIFVzZXIubG9nb3V0KCk7CiAgICB9OwoKICAgIFRvcEJhci5wcm90b3R5cGUub25Vc2VyQ2hhbmdlID0gZnVuY3Rpb24oZSwgdXNlcikgewogICAgICB2YXIgX3JlZjsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnc2lnbmVkLWluJywgdXNlciAhPSBudWxsKTsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnaGFzLWdyb3VwcycsICh1c2VyICE9IG51bGwgPyAoX3JlZiA9IHVzZXIudXNlcl9ncm91cHMpICE9IG51bGwgPyBfcmVmLmxlbmd0aCA6IHZvaWQgMCA6IHZvaWQgMCkgPiAwKTsKICAgICAgdGhpcy5vblVzZXJDaGFuZ2VHcm91cChlLCB1c2VyICE9IG51bGwsIHVzZXIgIT0gbnVsbCA/IHVzZXIudXNlcl9ncm91cF9pZCA6IHZvaWQgMCk7CiAgICAgIHRoaXMuZ2V0TWVzc2FnZXMoKTsKICAgICAgdGhpcy5jdXJyZW50VXNlck5hbWUuaHRtbCgodXNlciAhPSBudWxsID8gdXNlci5uYW1lIDogdm9pZCAwKSB8fCAnJyk7CiAgICAgIHJldHVybiB0aGlzLmF2YXRhckltYWdlLmF0dHIoewogICAgICAgIHNyYzogdXNlciAhPSBudWxsID8gdXNlci5hdmF0YXIgOiB2b2lkIDAKICAgICAgfSk7CiAgICB9OwoKICAgIFRvcEJhci5wcm90b3R5cGUuZ2V0TWVzc2FnZXMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgaWYgKFVzZXIuY3VycmVudCAhPSBudWxsKSB7CiAgICAgICAgcmV0dXJuIEFwaS5jdXJyZW50LmdldCgnL3RhbGsvbWVzc2FnZXMvY291bnQnLCBmdW5jdGlvbihtZXNzYWdlcykgewogICAgICAgICAgX3RoaXMuZWwudG9nZ2xlQ2xhc3MoJ2hhcy1tZXNzYWdlcycsIG1lc3NhZ2VzICE9PSAwKTsKICAgICAgICAgIF90aGlzLm1lc3NhZ2VDb3VudC5odG1sKG1lc3NhZ2VzKTsKICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KF90aGlzLmdldE1lc3NhZ2VzLCBfdGhpcy5tZXNzYWdlQ2hlY2tUaW1lb3V0KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVsLnJlbW92ZUNsYXNzKCdoYXMtbWVzc2FnZXMnKTsKICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlQ291bnQuaHRtbCgnMCcpOwogICAgICB9CiAgICB9OwoKICAgIFRvcEJhci5wcm90b3R5cGUub25Vc2VyQ2hhbmdlR3JvdXAgPSBmdW5jdGlvbihlLCB1c2VyLCBncm91cCkgewogICAgICByZXR1cm4gdGhpcy5lbC50b2dnbGVDbGFzcygnZ3JvdXAtcGFydGljaXBhbnQnLCBncm91cCAhPSBudWxsKTsKICAgIH07CgogICAgVG9wQmFyLnByb3RvdHlwZS5vbkxhbmd1YWdlQ2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfcmVmOwogICAgICByZXR1cm4gdGhpcy5sYW5ndWFnZXNNZW51QnV0dG9uLmh0bWwoKF9yZWYgPSBMYW5ndWFnZU1hbmFnZXIuY3VycmVudCkgIT0gbnVsbCA/IF9yZWYubGFiZWwoKSA6IHZvaWQgMCk7CiAgICB9OwoKICAgIHJldHVybiBUb3BCYXI7CgogIH0pKEJhc2VDb250cm9sbGVyKTsKCiAgd2luZG93Lnpvb25pdmVyc2UuY29udHJvbGxlcnMuVG9wQmFyID0gVG9wQmFyOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFRvcEJhcjsKICB9Cgp9KS5jYWxsKHRoaXMpOwoKKGZ1bmN0aW9uKCkgewogIHZhciAkLCBCYXNlQ29udHJvbGxlciwgUGFnaW5hdG9yLCBVc2VyLCB0ZW1wbGF0ZSwgX2Jhc2UsIF9iYXNlMSwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKICBpZiAod2luZG93Lnpvb25pdmVyc2UgPT0gbnVsbCkgewogICAgd2luZG93Lnpvb25pdmVyc2UgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UgPSB3aW5kb3cuem9vbml2ZXJzZSkuY29udHJvbGxlcnMgPT0gbnVsbCkgewogICAgX2Jhc2UuY29udHJvbGxlcnMgPSB7fTsKICB9CgogIGlmICgoX2Jhc2UxID0gd2luZG93Lnpvb25pdmVyc2UpLnZpZXdzID09IG51bGwpIHsKICAgIF9iYXNlMS52aWV3cyA9IHt9OwogIH0KCiAgQmFzZUNvbnRyb2xsZXIgPSB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICB0ZW1wbGF0ZSA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzLnBhZ2luYXRvciB8fCByZXF1aXJlKCcuLi92aWV3cy9wYWdpbmF0b3InKTsKCiAgVXNlciA9IHdpbmRvdy56b29uaXZlcnNlLm1vZGVscy5Vc2VyIHx8IHJlcXVpcmUoJy4uL21vZGVscy91c2VyJyk7CgogICQgPSB3aW5kb3cualF1ZXJ5OwoKICBQYWdpbmF0b3IgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoUGFnaW5hdG9yLCBfc3VwZXIpOwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUudHlwZSA9IG51bGw7CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5pdGVtVGVtcGxhdGUgPSBudWxsOwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUuY2xhc3NOYW1lID0gJ3pvb25pdmVyc2UtcGFnaW5hdG9yJzsKCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLnRlbXBsYXRlID0gdGVtcGxhdGU7CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5wYWdlcyA9IDA7CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5wZXJQYWdlID0gMTA7CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5ldmVudHMgPSB7CiAgICAgICdjbGljayBidXR0b25bbmFtZT0icGFnZSJdJzogJ29uQ2xpY2tQYWdlJwogICAgfTsKCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLmVsZW1lbnRzID0gewogICAgICAnLml0ZW1zJzogJ2l0ZW1zQ29udGFpbmVyJywKICAgICAgJy5udW1iZXJlZCc6ICdudW1iZXJzQ29udGFpbmVyJwogICAgfTsKCiAgICBmdW5jdGlvbiBQYWdpbmF0b3IoKSB7CiAgICAgIHRoaXMub25JdGVtRGVzdHJveWVkID0gX19iaW5kKHRoaXMub25JdGVtRGVzdHJveWVkLCB0aGlzKTsKICAgICAgdGhpcy5vbkl0ZW1Gcm9tQ2xhc3NpZmljYXRpb24gPSBfX2JpbmQodGhpcy5vbkl0ZW1Gcm9tQ2xhc3NpZmljYXRpb24sIHRoaXMpOwogICAgICB0aGlzLm9uRmV0Y2hGYWlsID0gX19iaW5kKHRoaXMub25GZXRjaEZhaWwsIHRoaXMpOwogICAgICB0aGlzLmFkZEl0ZW1Ub0NvbnRhaW5lciA9IF9fYmluZCh0aGlzLmFkZEl0ZW1Ub0NvbnRhaW5lciwgdGhpcyk7CiAgICAgIHRoaXMub25GZXRjaCA9IF9fYmluZCh0aGlzLm9uRmV0Y2gsIHRoaXMpOwogICAgICB0aGlzLm9uVXNlckNoYW5nZSA9IF9fYmluZCh0aGlzLm9uVXNlckNoYW5nZSwgdGhpcyk7CiAgICAgIFBhZ2luYXRvci5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgVXNlci5vbignY2hhbmdlJywgdGhpcy5vblVzZXJDaGFuZ2UpOwogICAgICB0aGlzLnR5cGUub24oJ2Zyb20tY2xhc3NpZmljYXRpb24nLCB0aGlzLm9uSXRlbUZyb21DbGFzc2lmaWNhdGlvbik7CiAgICAgIHRoaXMudHlwZS5vbignZGVzdHJveScsIHRoaXMub25JdGVtRGVzdHJveWVkKTsKICAgIH0KCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLm9uVXNlckNoYW5nZSA9IGZ1bmN0aW9uKGUsIHVzZXIpIHsKICAgICAgdGhpcy5yZXNldCh0aGlzLnR5cGVDb3VudCgpKTsKICAgICAgdGhpcy5vbkZldGNoKFtdKTsKICAgICAgaWYgKHVzZXIgIT0gbnVsbCkgewogICAgICAgIHJldHVybiB0aGlzLmdvVG8oMSk7CiAgICAgIH0KICAgIH07CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKGl0ZW1Db3VudCkgewogICAgICB2YXIgYnV0dG9uLCBpLCBfaSwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIHRoaXMucGFnZXMgPSBNYXRoLmNlaWwoaXRlbUNvdW50IC8gdGhpcy5wZXJQYWdlKTsKICAgICAgdGhpcy5udW1iZXJzQ29udGFpbmVyLmVtcHR5KCk7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoaSA9IF9pID0gMCwgX3JlZiA9IHRoaXMucGFnZXM7IDAgPD0gX3JlZiA/IF9pIDwgX3JlZiA6IF9pID4gX3JlZjsgaSA9IDAgPD0gX3JlZiA/ICsrX2kgOiAtLV9pKSB7CiAgICAgICAgYnV0dG9uID0gJCgiPGJ1dHRvbiBuYW1lPSdwYWdlJyB2YWx1ZT0nIiArIChpICsgMSkgKyAiJz4iICsgKGkgKyAxKSArICI8L2J1dHRvbj4iKTsKICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMubnVtYmVyc0NvbnRhaW5lci5hcHBlbmQoYnV0dG9uKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLm9uQ2xpY2tQYWdlID0gZnVuY3Rpb24oX2FyZykgewogICAgICB2YXIgcGFnZSwgdGFyZ2V0OwogICAgICB0YXJnZXQgPSBfYXJnLnRhcmdldDsKICAgICAgcGFnZSA9ICskKHRhcmdldCkudmFsKCk7CiAgICAgIHJldHVybiB0aGlzLmdvVG8ocGFnZSk7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUuZ29UbyA9IGZ1bmN0aW9uKHBhZ2UpIHsKICAgICAgdmFyIGZldGNoLAogICAgICAgIF90aGlzID0gdGhpczsKICAgICAgcGFnZSA9IE1hdGgubWF4KHBhZ2UsIDEpOwogICAgICB0aGlzLmVsLnJlbW92ZUNsYXNzKCdmYWlsZWQnKTsKICAgICAgdGhpcy5udW1iZXJzQ29udGFpbmVyLmNoaWxkcmVuKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB0aGlzLm51bWJlcnNDb250YWluZXIuY2hpbGRyZW4oIlt2YWx1ZT0nIiArIHBhZ2UgKyAiJ10iKS5hZGRDbGFzcygnYWN0aXZlJyk7CiAgICAgIHRoaXMuZWwuYWRkQ2xhc3MoJ2xvYWRpbmcnKTsKICAgICAgZmV0Y2ggPSB0aGlzLnR5cGUuZmV0Y2goewogICAgICAgIHBhZ2U6IHBhZ2UsCiAgICAgICAgcGVyX3BhZ2U6IHRoaXMucGVyUGFnZQogICAgICB9KTsKICAgICAgZmV0Y2gudGhlbih0aGlzLm9uRmV0Y2gsIHRoaXMub25GZXRjaEZhaWwpOwogICAgICByZXR1cm4gZmV0Y2guYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5lbC5yZW1vdmVDbGFzcygnbG9hZGluZycpOwogICAgICB9KTsKICAgIH07CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS50eXBlQ291bnQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9yZWYsIF9yZWYxOwogICAgICByZXR1cm4gKChfcmVmID0gVXNlci5jdXJyZW50KSAhPSBudWxsID8gKF9yZWYxID0gX3JlZi5wcm9qZWN0KSAhPSBudWxsID8gX3JlZjEuY2xhc3NpZmljYXRpb25fY291bnQgOiB2b2lkIDAgOiB2b2lkIDApIHx8IDA7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUub25GZXRjaCA9IGZ1bmN0aW9uKGl0ZW1zKSB7CiAgICAgIHZhciBpdGVtLCBfaSwgX2xlbiwgX3Jlc3VsdHM7CiAgICAgIHRoaXMuaXRlbXNDb250YWluZXIuZW1wdHkoKTsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnZW1wdHknLCBpdGVtcy5sZW5ndGggPT09IDApOwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGl0ZW1zLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgaXRlbSA9IGl0ZW1zW19pXTsKICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMuYWRkSXRlbVRvQ29udGFpbmVyKGl0ZW0pKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUuZ2V0SXRlbUVsID0gZnVuY3Rpb24oaXRlbSkgewogICAgICB2YXIgaW5uZXIsIGl0ZW1FbCwgX3JlZiwgX3JlZjE7CiAgICAgIGl0ZW1FbCA9IHRoaXMuaXRlbXNDb250YWluZXIuZmluZCgiW2RhdGEtaXRlbS1pZD0nIiArIGl0ZW0uaWQgKyAiJ10iKTsKICAgICAgaWYgKGl0ZW1FbC5sZW5ndGggPT09IDApIHsKICAgICAgICBpbm5lciA9IHRoaXMuaXRlbVRlbXBsYXRlICE9IG51bGwgPyB0aGlzLml0ZW1UZW1wbGF0ZShpdGVtKSA6ICI8ZGl2IGNsYXNzPSdpdGVtJz48YSBocmVmPVwiIiArICgoKF9yZWYgPSBpdGVtLnN1YmplY3RzWzBdKSAhPSBudWxsID8gX3JlZi50YWxrSHJlZigpIDogdm9pZCAwKSB8fCAnIy9TVUJKRUNULUVSUk9SJykgKyAiXCI+IiArICgoKF9yZWYxID0gaXRlbS5zdWJqZWN0c1swXSkgIT0gbnVsbCA/IF9yZWYxLnpvb25pdmVyc2VfaWQgOiB2b2lkIDApIHx8ICdFcnJvciBpbiBzdWJqZWN0JykgKyAiPC9hPjwvZGl2PiI7CiAgICAgICAgaXRlbUVsID0gJCgkLnRyaW0oaW5uZXIpKTsKICAgICAgICBpdGVtRWwuYXR0cih7CiAgICAgICAgICAnZGF0YS1pdGVtLWlkJzogaXRlbS5pZAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBpdGVtRWw7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUuYWRkSXRlbVRvQ29udGFpbmVyID0gZnVuY3Rpb24oaXRlbSkgewogICAgICB2YXIgaXRlbUVsOwogICAgICBpdGVtRWwgPSB0aGlzLmdldEl0ZW1FbChpdGVtKTsKICAgICAgaXRlbUVsLnByZXBlbmRUbyh0aGlzLml0ZW1zQ29udGFpbmVyKTsKICAgICAgcmV0dXJuIGl0ZW1FbDsKICAgIH07CgogICAgUGFnaW5hdG9yLnByb3RvdHlwZS5vbkZldGNoRmFpbCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5lbC5hZGRDbGFzcygnZmFpbGVkJyk7CiAgICB9OwoKICAgIFBhZ2luYXRvci5wcm90b3R5cGUub25JdGVtRnJvbUNsYXNzaWZpY2F0aW9uID0gZnVuY3Rpb24oZSwgaXRlbSkgewogICAgICB2YXIgX3Jlc3VsdHM7CiAgICAgIHRoaXMuYWRkSXRlbVRvQ29udGFpbmVyKGl0ZW0pLmFkZENsYXNzKCduZXcnKTsKICAgICAgaWYgKHRoaXMuaXRlbXNDb250YWluZXIuY2hpbGRyZW4oKS5sZW5ndGggPiB0aGlzLnBlclBhZ2UpIHsKICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgIHdoaWxlICh0aGlzLml0ZW1zQ29udGFpbmVyLmNoaWxkcmVuKCkubGVuZ3RoICE9PSB0aGlzLnBlclBhZ2UpIHsKICAgICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5pdGVtc0NvbnRhaW5lci5jaGlsZHJlbigpLmxhc3QoKS5yZW1vdmUoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfQogICAgfTsKCiAgICBQYWdpbmF0b3IucHJvdG90eXBlLm9uSXRlbURlc3Ryb3llZCA9IGZ1bmN0aW9uKGUsIGl0ZW0pIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0SXRlbUVsKGl0ZW0pLnJlbW92ZSgpOwogICAgfTsKCiAgICByZXR1cm4gUGFnaW5hdG9yOwoKICB9KShCYXNlQ29udHJvbGxlcik7CgogIHdpbmRvdy56b29uaXZlcnNlLmNvbnRyb2xsZXJzLlBhZ2luYXRvciA9IFBhZ2luYXRvcjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgewogICAgbW9kdWxlLmV4cG9ydHMgPSBQYWdpbmF0b3I7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgQmFzZUNvbnRyb2xsZXIsIEZhdm9yaXRlLCBMb2dpbkZvcm0sIFBhZ2luYXRvciwgUHJvZmlsZSwgUHJvZmlsZVBhZ2luYXRvciwgUmVjZW50LCBVc2VyLCBpdGVtVGVtcGxhdGUsIHRlbXBsYXRlLCBfYmFzZSwgX2Jhc2UxLCBfcmVmLAogICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksCiAgICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLmNvbnRyb2xsZXJzID09IG51bGwpIHsKICAgIF9iYXNlLmNvbnRyb2xsZXJzID0ge307CiAgfQoKICBpZiAoKF9iYXNlMSA9IHdpbmRvdy56b29uaXZlcnNlKS52aWV3cyA9PSBudWxsKSB7CiAgICBfYmFzZTEudmlld3MgPSB7fTsKICB9CgogIEJhc2VDb250cm9sbGVyID0gem9vbml2ZXJzZS5jb250cm9sbGVycy5CYXNlQ29udHJvbGxlciB8fCByZXF1aXJlKCcuL2Jhc2UtY29udHJvbGxlcicpOwoKICB0ZW1wbGF0ZSA9IHpvb25pdmVyc2Uudmlld3MucHJvZmlsZSB8fCByZXF1aXJlKCcuLi92aWV3cy9wcm9maWxlJyk7CgogIExvZ2luRm9ybSA9IHpvb25pdmVyc2UuY29udHJvbGxlcnMuTG9naW5Gb3JtIHx8IHJlcXVpcmUoJ3pvb25pdmVyc2UvY29udHJvbGxlcnMvbG9naW4tZm9ybScpOwoKICBQYWdpbmF0b3IgPSB6b29uaXZlcnNlLmNvbnRyb2xsZXJzLlBhZ2luYXRvciB8fCByZXF1aXJlKCcuL3BhZ2luYXRvcicpOwoKICBSZWNlbnQgPSB6b29uaXZlcnNlLm1vZGVscy5SZWNlbnQgfHwgcmVxdWlyZSgnLi4vbW9kZWxzL3JlY2VudCcpOwoKICBGYXZvcml0ZSA9IHpvb25pdmVyc2UubW9kZWxzLkZhdm9yaXRlIHx8IHJlcXVpcmUoJy4uL21vZGVscy9mYXZvcml0ZScpOwoKICBpdGVtVGVtcGxhdGUgPSB6b29uaXZlcnNlLnZpZXdzLnByb2ZpbGVJdGVtIHx8IHJlcXVpcmUoJy4uL3ZpZXdzL3Byb2ZpbGUtaXRlbScpOwoKICBVc2VyID0gem9vbml2ZXJzZS5tb2RlbHMuVXNlciB8fCByZXF1aXJlKCcuLi9tb2RlbHMvdXNlcicpOwoKICAkID0gd2luZG93LmpRdWVyeTsKCiAgUHJvZmlsZVBhZ2luYXRvciA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhQcm9maWxlUGFnaW5hdG9yLCBfc3VwZXIpOwoKICAgIGZ1bmN0aW9uIFByb2ZpbGVQYWdpbmF0b3IoKSB7CiAgICAgIF9yZWYgPSBQcm9maWxlUGFnaW5hdG9yLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gX3JlZjsKICAgIH0KCiAgICBQcm9maWxlUGFnaW5hdG9yLnByb3RvdHlwZS50eXBlQ291bnQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGNvdW50LCBfcmVmMSwgX3JlZjIsIF9yZWYzLCBfcmVmNDsKICAgICAgY291bnQgPSB0aGlzLnR5cGUgPT09IFJlY2VudCA/IChfcmVmMSA9IFVzZXIuY3VycmVudCkgIT0gbnVsbCA/IChfcmVmMiA9IF9yZWYxLnByb2plY3QpICE9IG51bGwgPyBfcmVmMi5jbGFzc2lmaWNhdGlvbl9jb3VudCA6IHZvaWQgMCA6IHZvaWQgMCA6IHRoaXMudHlwZSA9PT0gRmF2b3JpdGUgPyAoX3JlZjMgPSBVc2VyLmN1cnJlbnQpICE9IG51bGwgPyAoX3JlZjQgPSBfcmVmMy5wcm9qZWN0KSAhPSBudWxsID8gX3JlZjQuZmF2b3JpdGVfY291bnQgOiB2b2lkIDAgOiB2b2lkIDAgOiBQcm9maWxlUGFnaW5hdG9yLl9fc3VwZXJfXy50eXBlQ291bnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIGNvdW50IHx8IDA7CiAgICB9OwoKICAgIHJldHVybiBQcm9maWxlUGFnaW5hdG9yOwoKICB9KShQYWdpbmF0b3IpOwoKICBQcm9maWxlID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKFByb2ZpbGUsIF9zdXBlcik7CgogICAgUHJvZmlsZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gJ3pvb25pdmVyc2UtcHJvZmlsZSc7CgogICAgUHJvZmlsZS5wcm90b3R5cGUudGVtcGxhdGUgPSB0ZW1wbGF0ZTsKCiAgICBQcm9maWxlLnByb3RvdHlwZS5yZWNlbnRUZW1wbGF0ZSA9IGl0ZW1UZW1wbGF0ZTsKCiAgICBQcm9maWxlLnByb3RvdHlwZS5mYXZvcml0ZVRlbXBsYXRlID0gaXRlbVRlbXBsYXRlOwoKICAgIFByb2ZpbGUucHJvdG90eXBlLmxvZ2luRm9ybSA9IG51bGw7CgogICAgUHJvZmlsZS5wcm90b3R5cGUucmVjZW50c0xpc3QgPSBudWxsOwoKICAgIFByb2ZpbGUucHJvdG90eXBlLmZhdm9yaXRlc0xpc3QgPSBudWxsOwoKICAgIFByb2ZpbGUucHJvdG90eXBlLmV2ZW50cyA9IHsKICAgICAgJ2NsaWNrIGJ1dHRvbltuYW1lPSJ1bmZhdm9yaXRlIl0nOiAnb25DbGlja1VuZmF2b3JpdGUnLAogICAgICAnY2xpY2sgYnV0dG9uW25hbWU9InR1cm4tcGFnZSJdJzogJ29uVHVyblBhZ2UnCiAgICB9OwoKICAgIFByb2ZpbGUucHJvdG90eXBlLmVsZW1lbnRzID0gewogICAgICAnbmF2JzogJ25hdmlnYXRpb24nLAogICAgICAnYnV0dG9uW25hbWU9InR1cm4tcGFnZSJdJzogJ3BhZ2VUdXJuZXJzJwogICAgfTsKCiAgICBmdW5jdGlvbiBQcm9maWxlKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBQcm9maWxlLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB0aGlzLmxvZ2luRm9ybSA9IG5ldyBMb2dpbkZvcm0oewogICAgICAgIGVsOiB0aGlzLmVsLmZpbmQoJy5zaWduLWluLWZvcm0nKQogICAgICB9KTsKICAgICAgdGhpcy5yZWNlbnRzTGlzdCA9IG5ldyBQcm9maWxlUGFnaW5hdG9yKHsKICAgICAgICB0eXBlOiBSZWNlbnQsCiAgICAgICAgcGVyUGFnZTogMTIsCiAgICAgICAgY2xhc3NOYW1lOiAiIiArIFBhZ2luYXRvci5wcm90b3R5cGUuY2xhc3NOYW1lICsgIiByZWNlbnRzIiwKICAgICAgICBlbDogdGhpcy5lbC5maW5kKCcucmVjZW50cycpLAogICAgICAgIGl0ZW1UZW1wbGF0ZTogdGhpcy5yZWNlbnRUZW1wbGF0ZQogICAgICB9KTsKICAgICAgdGhpcy5mYXZvcml0ZXNMaXN0ID0gbmV3IFByb2ZpbGVQYWdpbmF0b3IoewogICAgICAgIHR5cGU6IEZhdm9yaXRlLAogICAgICAgIHBlclBhZ2U6IDEyLAogICAgICAgIGNsYXNzTmFtZTogIiIgKyBQYWdpbmF0b3IucHJvdG90eXBlLmNsYXNzTmFtZSArICIgZmF2b3JpdGVzIiwKICAgICAgICBlbDogdGhpcy5lbC5maW5kKCcuZmF2b3JpdGVzJyksCiAgICAgICAgaXRlbVRlbXBsYXRlOiB0aGlzLmZhdm9yaXRlVGVtcGxhdGUKICAgICAgfSk7CiAgICAgIFVzZXIub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5vblVzZXJDaGFuZ2UuYXBwbHkoX3RoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0pOwogICAgfQoKICAgIFByb2ZpbGUucHJvdG90eXBlLm9uVXNlckNoYW5nZSA9IGZ1bmN0aW9uKGUsIHVzZXIpIHsKICAgICAgdGhpcy5lbC50b2dnbGVDbGFzcygnc2lnbmVkLWluJywgdXNlciAhPSBudWxsKTsKICAgICAgcmV0dXJuIHRoaXMucGFnZVR1cm5lcnMuZmlyc3QoKS5jbGljaygpOwogICAgfTsKCiAgICBQcm9maWxlLnByb3RvdHlwZS5vbkNsaWNrVW5mYXZvcml0ZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIGZhdm9yaXRlLCBpZCwgdGFyZ2V0OwogICAgICB0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7CiAgICAgIGlkID0gdGFyZ2V0LnZhbCgpOwogICAgICBmYXZvcml0ZSA9IEZhdm9yaXRlLmZpbmQoaWQpOwogICAgICBmYXZvcml0ZVsiZGVsZXRlIl0oKTsKICAgICAgcmV0dXJuIHRhcmdldC5wYXJlbnRzKCdbZGF0YS1pdGVtLWlkXScpLmZpcnN0KCkucmVtb3ZlKCk7CiAgICB9OwoKICAgIFByb2ZpbGUucHJvdG90eXBlLm9uVHVyblBhZ2UgPSBmdW5jdGlvbihlKSB7CiAgICAgIHJldHVybiB0aGlzLnR1cm5QYWdlKCQoZS5jdXJyZW50VGFyZ2V0KS52YWwoKSk7CiAgICB9OwoKICAgIFByb2ZpbGUucHJvdG90eXBlLnR1cm5QYWdlID0gZnVuY3Rpb24odGFyZ2V0VHlwZSkgewogICAgICB0aGlzLnBhZ2VUdXJuZXJzLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgdGhpcy5wYWdlVHVybmVycy5maWx0ZXIoIlt2YWx1ZT1cIiIgKyB0YXJnZXRUeXBlICsgIlwiXSIpLmZpcnN0KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOwogICAgICB0aGlzLnJlY2VudHNMaXN0LmVsLmFkZCh0aGlzLmZhdm9yaXRlc0xpc3QuZWwpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgcmV0dXJuIHRoaXNbIiIgKyB0YXJnZXRUeXBlICsgIkxpc3QiXS5lbC5hZGRDbGFzcygnYWN0aXZlJyk7CiAgICB9OwoKICAgIHJldHVybiBQcm9maWxlOwoKICB9KShCYXNlQ29udHJvbGxlcik7CgogIHdpbmRvdy56b29uaXZlcnNlLmNvbnRyb2xsZXJzLlByb2ZpbGUgPSBQcm9maWxlOwoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFByb2ZpbGU7CiAgfQoKfSkuY2FsbCh0aGlzKTsKCihmdW5jdGlvbigpIHsKICB2YXIgJCwgJHdpbmRvdywgRm9vdGVyLCB0ZW1wbGF0ZSwgX2Jhc2UsIF9iYXNlMSwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH07CgogIGlmICh3aW5kb3cuem9vbml2ZXJzZSA9PSBudWxsKSB7CiAgICB3aW5kb3cuem9vbml2ZXJzZSA9IHt9OwogIH0KCiAgaWYgKChfYmFzZSA9IHdpbmRvdy56b29uaXZlcnNlKS5jb250cm9sbGVycyA9PSBudWxsKSB7CiAgICBfYmFzZS5jb250cm9sbGVycyA9IHt9OwogIH0KCiAgaWYgKChfYmFzZTEgPSB3aW5kb3cuem9vbml2ZXJzZSkudmlld3MgPT0gbnVsbCkgewogICAgX2Jhc2UxLnZpZXdzID0ge307CiAgfQoKICB0ZW1wbGF0ZSA9IHdpbmRvdy56b29uaXZlcnNlLnZpZXdzLmZvb3RlciB8fCByZXF1aXJlKCcuLi92aWV3cy9mb290ZXInKTsKCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogICR3aW5kb3cgPSAkKHdpbmRvdyk7CgogIHdpbmRvdy5ERUZJTkVfWk9PTklWRVJTRV9QUk9KRUNUX0xJU1QgPSBmdW5jdGlvbihjYXRlZ29yaWVzKSB7CiAgICByZXR1cm4gJHdpbmRvdy50cmlnZ2VyKCdnZXQtem9vbml2ZXJzZS1wcm9qZWN0LWxpc3QnLCBbY2F0ZWdvcmllc10pOwogIH07CgogIEZvb3RlciA9IChmdW5jdGlvbigpIHsKICAgIEZvb3Rlci5wcm90b3R5cGUuZWwgPSBudWxsOwoKICAgIEZvb3Rlci5wcm90b3R5cGUucHJvamVjdFNjcmlwdCA9ICdodHRwOi8vem9vbml2ZXJzZS1kZW1vLnMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vcHJvamVjdHMuanMnOwoKICAgIGZ1bmN0aW9uIEZvb3RlcigpIHsKICAgICAgdGhpcy5vbkZldGNoID0gX19iaW5kKHRoaXMub25GZXRjaCwgdGhpcyk7CiAgICAgIHRoaXMuZWwgPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTsKICAgICAgdGhpcy5lbC5hZGRDbGFzcygnem9vbml2ZXJzZS1mb290ZXInKTsKICAgICAgdGhpcy5lbC5odG1sKHRlbXBsYXRlKTsKICAgICAgJHdpbmRvdy5vbignZ2V0LXpvb25pdmVyc2UtcHJvamVjdC1saXN0JywgdGhpcy5vbkZldGNoKTsKICAgICAgdGhpcy5mZXRjaFByb2plY3RzKCk7CiAgICB9CgogICAgRm9vdGVyLnByb3RvdHlwZS5mZXRjaFByb2plY3RzID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAkLmdldFNjcmlwdCh0aGlzLnByb2plY3RTY3JpcHQpOwogICAgfTsKCiAgICBGb290ZXIucHJvdG90eXBlLm9uRmV0Y2ggPSBmdW5jdGlvbihlLCBjYXRlZ29yaWVzKSB7CiAgICAgIHJldHVybiB0aGlzLmVsLmh0bWwodGVtcGxhdGUoewogICAgICAgIGNhdGVnb3JpZXM6IGNhdGVnb3JpZXMKICAgICAgfSkpOwogICAgfTsKCiAgICByZXR1cm4gRm9vdGVyOwoKICB9KSgpOwoKICB3aW5kb3cuem9vbml2ZXJzZS5jb250cm9sbGVycy5Gb290ZXIgPSBGb290ZXI7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gRm9vdGVyOwogIH0KCn0pLmNhbGwodGhpcyk7CgooZnVuY3Rpb24oKSB7CiAgdmFyICQsIGFjdGl2ZUhhc2hMaW5rcywgYW5jaG9ycywgY2xhc3NOYW1lLCBpbml0LCByb290LCB1cGRhdGVDbGFzc2VzLCBfYmFzZTsKCiAgaWYgKHdpbmRvdy56b29uaXZlcnNlID09IG51bGwpIHsKICAgIHdpbmRvdy56b29uaXZlcnNlID0ge307CiAgfQoKICBpZiAoKF9iYXNlID0gd2luZG93Lnpvb25pdmVyc2UpLnV0aWwgPT0gbnVsbCkgewogICAgX2Jhc2UudXRpbCA9IHt9OwogIH0KCiAgJCA9IHdpbmRvdy5qUXVlcnk7CgogIGNsYXNzTmFtZSA9ICdhY3RpdmUnOwoKICByb290ID0gZG9jdW1lbnQ7CgogIGFuY2hvcnMgPSAkKCk7CgogIHVwZGF0ZUNsYXNzZXMgPSBmdW5jdGlvbigpIHsKICAgIGFuY2hvcnMucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lKTsKICAgIGFuY2hvcnMgPSAkKCJhW2hyZWY9JyIgKyBsb2NhdGlvbi5oYXNoICsgIiddIik7CiAgICByZXR1cm4gYW5jaG9ycy5hZGRDbGFzcyhjbGFzc05hbWUpOwogIH07CgogIGluaXQgPSBmdW5jdGlvbihuZXdDbGFzc05hbWUsIG5ld1Jvb3QpIHsKICAgIHZhciBfcmVmOwogICAgaWYgKG5ld0NsYXNzTmFtZSA9PSBudWxsKSB7CiAgICAgIG5ld0NsYXNzTmFtZSA9IGNsYXNzTmFtZTsKICAgIH0KICAgIGlmIChuZXdSb290ID09IG51bGwpIHsKICAgICAgbmV3Um9vdCA9IHJvb3Q7CiAgICB9CiAgICBfcmVmID0gW25ld0NsYXNzTmFtZSwgbmV3Um9vdF0sIGNsYXNzTmFtZSA9IF9yZWZbMF0sIHJvb3QgPSBfcmVmWzFdOwogICAgdXBkYXRlQ2xhc3NlcygpOwogICAgcmV0dXJuICQod2luZG93KS5vbignaGFzaGNoYW5nZScsIHVwZGF0ZUNsYXNzZXMpOwogIH07CgogIGFjdGl2ZUhhc2hMaW5rcyA9IHsKICAgIHVwZGF0ZUNsYXNzZXM6IHVwZGF0ZUNsYXNzZXMsCiAgICBpbml0OiBpbml0CiAgfTsKCiAgd2luZG93Lnpvb25pdmVyc2UudXRpbC5hY3RpdmVIYXNoTGlua3MgPSBhY3RpdmVIYXNoTGlua3M7CgogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gYWN0aXZlSGFzaExpbmtzOwogIH0KCn0pLmNhbGwodGhpcyk7CgppZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIG1vZHVsZS5leHBvcnRzID0gd2luZG93Lnpvb25pdmVyc2UKfSh3aW5kb3cpKTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 04:20:33 GMT",
                    "Content-Length": "165726",
                    "Date": "Sun, 09 Nov 2014 04:20:33 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}