{
    "url": "http://localhost:9999/amazingSurge/amazing-shortcodes/shortcodes/js/jquery-asTabs.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>window.location.hash</b> and written to <b>window.history.pushState()</b> via the following statements:<ul><li>var url = window.location.hash;</li><li>url = url.replace(reg, '');</li><li>url = url.replace(/^#&amp;/, '#');</li><li>window.history.pushState(states, \"\", url);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/amazingSurge/amazing-shortcodes/shortcodes/js/jquery-asTabs.js",
                "path": "/amazingSurge/amazing-shortcodes/shortcodes/js/jquery-asTabs.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hbWF6aW5nU3VyZ2UvYW1hemluZy1zaG9ydGNvZGVzL3Nob3J0Y29kZXMvanMvanF1ZXJ5LWFzVGFicy5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjEyMTANCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMDY6NTU6MTYgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDA2OjU1OjE1IEdNVA0KDQovKiEgalF1ZXJ5IGFzVGFicyAtIHYwLjMuMSAtIDIwMTQtMDgtMDIKKiBodHRwczovL2dpdGh1Yi5jb20vYW1hemluZ1N1cmdlL2pxdWVyeS1hc1RhYnMKKiBDb3B5cmlnaHQgKGMpIDIwMTQgYW1hemluZ1N1cmdlOyBMaWNlbnNlZCBHUEwgKi8KKGZ1bmN0aW9uKCQsIGRvY3VtZW50LCB3aW5kb3csIHVuZGVmaW5lZCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBwbHVnaW5OYW1lID0gJ2FzVGFicyc7CiAgICAvLyBtYWluIGNvbnN0cnVjdG9yCiAgICB2YXIgUGx1Z2luID0gJFtwbHVnaW5OYW1lXSA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHsKCiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgICAgIHRoaXMuJGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBQbHVnaW4uZGVmYXVsdHMsIG9wdGlvbnMsIHRoaXMuJGVsZW1lbnQuZGF0YSgnb3B0aW9ucycpKTsKICAgICAgICB0aGlzLm5hbWVzcGFjZSA9IHRoaXMub3B0aW9ucy5uYW1lc3BhY2U7CiAgICAgICAgdGhpcy5pbml0aWFsSW5kZXggPSB0aGlzLm9wdGlvbnMuaW5pdGlhbEluZGV4OwogICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5hY3RpdmVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5jdXJyZW50ID0gbnVsbDsKCiAgICAgICAgLy8gQ2xhc3MKICAgICAgICB0aGlzLmNsYXNzZXMgPSB7CiAgICAgICAgICAgIHdpdGhKczogJ3dpdGgtanMnLAogICAgICAgICAgICBhY3RpdmVUYWI6ICdpcy1hY3RpdmUnLAogICAgICAgICAgICBhY3RpdmVQYW5lOiAnaXMtYWN0aXZlJywKICAgICAgICAgICAgbmF2OiB0aGlzLm5hbWVzcGFjZSArICctbmF2JywKICAgICAgICAgICAgY29udGVudDogdGhpcy5uYW1lc3BhY2UgKyAnLWNvbnRlbnQnLAogICAgICAgICAgICBkaXNhYmxlZDogdGhpcy5uYW1lc3BhY2UgKyAnLWRpc2FibGVkJywKICAgICAgICAgICAgc2tpbjogdGhpcy5uYW1lc3BhY2UgKyAnXycgKyB0aGlzLm9wdGlvbnMuc2tpbgogICAgICAgIH07CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMubmF2U2VsZWN0b3IpIHsKICAgICAgICAgICAgdGhpcy4kbmF2ID0gdGhpcy4kZWxlbWVudC5maW5kKHRoaXMub3B0aW9ucy5uYXZTZWxlY3Rvcik7CiAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQgPSB0aGlzLiRlbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLmNvbnRlbnRTZWxlY3RvcikKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLiRuYXYgPSB0aGlzLiRlbGVtZW50OwogICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNvbnRlbnRTZWxlY3RvciA9PT0gJysnKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRjb250ZW50ID0gdGhpcy4kbmF2Lm5leHQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQgPSAkKHRoaXMub3B0aW9ucy5jb250ZW50U2VsZWN0b3IpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRuYXYuYWRkQ2xhc3ModGhpcy5jbGFzc2VzLm5hdikuYWRkQ2xhc3ModGhpcy5jbGFzc2VzLndpdGhKcyk7CiAgICAgICAgdGhpcy4kY29udGVudC5hZGRDbGFzcyh0aGlzLmNsYXNzZXMuY29udGVudCkuYWRkQ2xhc3ModGhpcy5jbGFzc2VzLndpdGhKcyk7CgogICAgICAgIHRoaXMuJHRhYnMgPSB0aGlzLiRuYXYuY2hpbGRyZW4oKTsKICAgICAgICB0aGlzLiRwYW5lcyA9IHRoaXMuJGNvbnRlbnQuY2hpbGRyZW4oKTsKICAgICAgICB0aGlzLiRsb2FkaW5nID0gJCgnPHNwYW4gY2xhc3M9IicgKyB0aGlzLm5hbWVzcGFjZSArICctbG9hZGluZyI+PC9zcGFuPicpOwoKICAgICAgICB0aGlzLnNpemUgPSB0aGlzLiR0YWJzLmxlbmd0aDsKCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5za2luKSB7CiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQuYWRkQ2xhc3ModGhpcy5jbGFzc2VzLnNraW4pOwogICAgICAgICAgICB0aGlzLiRjb250ZW50LmFkZENsYXNzKHRoaXMuY2xhc3Nlcy5za2luKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWpheCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aGlzLmFqYXggPSBbXTsKICAgICAgICAgICAgJC5lYWNoKHRoaXMuJHRhYnMsIGZ1bmN0aW9uKGksIHYpIHsKICAgICAgICAgICAgICAgIHZhciBvYmogPSB7fTsKICAgICAgICAgICAgICAgIG9iai5ocmVmID0gJCh2KS5kYXRhKCdocmVmJyk7CiAgICAgICAgICAgICAgICBzZWxmLmFqYXgucHVzaChvYmopOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuaW5pdCgpOwogICAgfTsKCiAgICAvLyBEZWZhdWx0IG9wdGlvbnMgZm9yIHRoZSBwbHVnaW4gYXMgYSBzaW1wbGUgb2JqZWN0CiAgICBQbHVnaW4uZGVmYXVsdHMgPSB7CiAgICAgICAgbmFtZXNwYWNlOiAnYXNUYWJzJywKICAgICAgICBuYXZTZWxlY3RvcjogbnVsbCwKICAgICAgICBjb250ZW50U2VsZWN0b3I6ICcrJywKICAgICAgICBza2luOiBudWxsLAogICAgICAgIGluaXRpYWxJbmRleDogMCwKICAgICAgICBhamF4OiBmYWxzZSwKICAgICAgICBjYWNoZWQ6IGZhbHNlLAogICAgICAgIGhpc3Rvcnk6IGZhbHNlLAogICAgICAgIGhpc3RvcnlBdHRyOiAnaWQnLAogICAgICAgIGtleWJvYXJkOiBmYWxzZSwKICAgICAgICBlZmZlY3Q6IGZhbHNlLAogICAgICAgIGR1cmF0aW9uOiAzMDAsCiAgICAgICAgZXZlbnQ6ICdjbGljaycKICAgIH07CiAgICBQbHVnaW4ucHJvdG90eXBlID0gewogICAgICAgIGNvbnN0cnVjdG9yOiBQbHVnaW4sCiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIC8vIEJpbmQgbG9naWMKICAgICAgICAgICAgdGhpcy4kbmF2Lm9uKHRoaXMub3B0aW9ucy5ldmVudCwgJz4gKicsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmRpc2FibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gJChlLnRhcmdldCkuaW5kZXgoKTsKICAgICAgICAgICAgICAgIHNlbGYuYWN0aXZlKGluZGV4KTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCdpbml0Jyk7CgogICAgICAgICAgICB0aGlzLmFjdGl2ZSh0aGlzLmluaXRpYWxJbmRleCk7CiAgICAgICAgICAgIHRoaXMuYWN0aXZlZCA9IHRydWU7CgogICAgICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTsKCiAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoJ3JlYWR5Jyk7CiAgICAgICAgfSwKICAgICAgICBfdHJpZ2dlcjogZnVuY3Rpb24oZXZlbnRUeXBlKSB7CiAgICAgICAgICAgIHZhciBtZXRob2RfYXJndW1lbnRzLAogICAgICAgICAgICAgICAgdHJpZ2dlcl9hcmd1bWVudHMgPSBbdGhpc107CiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgbWV0aG9kX2FyZ3VtZW50cyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgICAgICB0cmlnZ2VyX2FyZ3VtZW50cyA9IHRyaWdnZXJfYXJndW1lbnRzLmNvbmNhdChtZXRob2RfYXJndW1lbnRzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZXZlbnQKICAgICAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKHBsdWdpbk5hbWUgKyAnOjonICsgZXZlbnRUeXBlLCB0cmlnZ2VyX2FyZ3VtZW50cyk7CiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihldmVudFR5cGUgKyAnLicgKyBwbHVnaW5OYW1lLCB0cmlnZ2VyX2FyZ3VtZW50cyk7CgogICAgICAgICAgICAvLyBjYWxsYmFjawogICAgICAgICAgICBldmVudFR5cGUgPSBldmVudFR5cGUucmVwbGFjZSgvXGJcdytcYi9nLCBmdW5jdGlvbih3b3JkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gd29yZC5zdWJzdHJpbmcoMCwgMSkudG9VcHBlckNhc2UoKSArIHdvcmQuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIG9uRnVuY3Rpb24gPSAnb24nICsgZXZlbnRUeXBlOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnNbb25GdW5jdGlvbl0gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc1tvbkZ1bmN0aW9uXS5hcHBseSh0aGlzLCBtZXRob2RfYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYWN0aXZlOiBmdW5jdGlvbihpbmRleCwgdXBkYXRlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQgPT09IGluZGV4IHx8IGluZGV4ID49IHRoaXMuc2l6ZSB8fCBpbmRleCA8IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gdGhpcy5zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLnNpemUgLSAxOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRleCA8IDApIHsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuJHRhYnMuZXEoaW5kZXgpLmFkZENsYXNzKHRoaXMuY2xhc3Nlcy5hY3RpdmVUYWIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLmFjdGl2ZVRhYik7CgogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRwYW5lcy5lcShpbmRleCkuYWRkQ2xhc3ModGhpcy5jbGFzc2VzLmFjdGl2ZVBhbmUpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLmFjdGl2ZVBhbmUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZi5fdHJpZ2dlcignYW5pbWF0aW9uJywgc2VsZi5jdXJyZW50LCBpbmRleCk7CgogICAgICAgICAgICAgICAgaWYgKCFzZWxmLmVmZmVjdHMpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLiRwYW5lcy5lcShzZWxmLmN1cnJlbnQpLmZhZGVPdXQoc2VsZi5vcHRpb25zLmR1cmF0aW9uLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaXMtYWN0aXZlJyk7CgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLiRwYW5lcy5lcShpbmRleCkuZmFkZUluKHNlbGYub3B0aW9ucy5kdXJhdGlvbiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdpcy1hY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlbGYucHJldmlvdXMgPSBzZWxmLmN1cnJlbnQ7CiAgICAgICAgICAgIHNlbGYuY3VycmVudCA9IGluZGV4OwoKICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5hamF4ID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBzZWxmLmFqYXhMb2FkKGluZGV4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2VsZi5fdHJpZ2dlcignYWN0aXZlJywgaW5kZXgpOwoKICAgICAgICAgICAgaWYgKHVwZGF0ZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHNlbGYuX3RyaWdnZXIoJ3VwZGF0ZScsIGluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYWpheExvYWQ6IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICAgICAgICAgIGR0ZDsKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jYWNoZWQgPT09IHRydWUgJiYgdGhpcy5hamF4W2luZGV4XS5jYWNoZWQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcoKTsKICAgICAgICAgICAgICAgIGR0ZCA9ICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiB0aGlzLmFqYXhbaW5kZXhdLmhyZWYKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZHRkLmRvbmUoZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuYWpheFtpbmRleF0uY2FjaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzZWxmLmhpZGVMb2FkaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgc2VsZi4kcGFuZXMuZXEoaW5kZXgpLmh0bWwoZGF0YSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGR0ZC5mYWlsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuaGlkZUxvYWRpbmcoKTsKICAgICAgICAgICAgICAgICAgICBzZWxmLiRwYW5lcy5lcShpbmRleCkuaHRtbCgnZmFpbGVkJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGR0ZC5hbHdheXMoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fdHJpZ2dlcignbG9hZGVkJywgaW5kZXgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNob3dMb2FkaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy4kbG9hZGluZy5hcHBlbmRUbyh0aGlzLiRjb250ZW50KTsKICAgICAgICB9LAogICAgICAgIGhpZGVMb2FkaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy4kbG9hZGluZy5yZW1vdmUoKTsKICAgICAgICB9LAogICAgICAgIGdldFRhYnM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kdGFiczsKICAgICAgICB9LAogICAgICAgIGdldFBhbmVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHBhbmVzOwogICAgICAgIH0sCiAgICAgICAgZ2V0Q3VycmVudFBhbmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kcGFuZXMuZXEodGhpcy5jdXJyZW50KTsKICAgICAgICB9LAogICAgICAgIGdldEN1cnJlbnRUYWI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kdGFicy5lcSh0aGlzLmN1cnJlbnQpOwogICAgICAgIH0sCiAgICAgICAgZ2V0SW5kZXg6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50OwogICAgICAgIH0sCiAgICAgICAgZ2V0U2l6ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNpemU7CiAgICAgICAgfSwKICAgICAgICBhcHBlbmQ6IGZ1bmN0aW9uKHRpdGxlLCBjb250ZW50KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZCh0aXRsZSwgY29udGVudCwgdGhpcy5zaXplKTsKICAgICAgICB9LAogICAgICAgIGFkZDogZnVuY3Rpb24odGl0bGUsIGNvbnRlbnQsIGluZGV4KSB7CiAgICAgICAgICAgIHRoaXMuJHRhYnMuZXEoaW5kZXggLSAxKS5hZnRlcih0aGlzLiR0YWJzLmVxKDApLmNsb25lKCkucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLmFjdGl2ZVRhYikuaHRtbCh0aXRsZSkpOwogICAgICAgICAgICB0aGlzLiRwYW5lcy5lcShpbmRleCAtIDEpLmFmdGVyKHRoaXMuJHBhbmVzLmVxKDApLmNsb25lKCkucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLmFjdGl2ZVBhbmUpLmh0bWwoY29udGVudCkpOwoKICAgICAgICAgICAgdGhpcy4kdGFicyA9IHRoaXMuJG5hdi5jaGlsZHJlbigpOwogICAgICAgICAgICB0aGlzLiRwYW5lcyA9IHRoaXMuJGNvbnRlbnQuY2hpbGRyZW4oKTsKICAgICAgICAgICAgdGhpcy5zaXplKys7CgogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAogICAgICAgIHJlbW92ZTogZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgICAgICAgaWYgKGluZGV4ID4gdGhpcy5zaXplIHx8IGluZGV4IDwgMCB8fCB0aGlzLnNpemUgPT09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJHRhYnMuZXEoaW5kZXgpLnJlbW92ZSgpOwogICAgICAgICAgICB0aGlzLiRwYW5lcy5lcShpbmRleCkucmVtb3ZlKCk7CgogICAgICAgICAgICB0aGlzLiR0YWJzID0gdGhpcy4kbmF2LmNoaWxkcmVuKCk7CiAgICAgICAgICAgIHRoaXMuJHBhbmVzID0gdGhpcy4kY29udGVudC5jaGlsZHJlbigpOwogICAgICAgICAgICB0aGlzLnNpemUtLTsKCiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQgPT09IGluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiB0aGlzLnNpemUpIHsKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZShpbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICBuZXh0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgICAgIGlmIChjdXJyZW50IDwgdGhpcy5zaXplIC0gMSkgewogICAgICAgICAgICAgICAgY3VycmVudCsrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3VycmVudCA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuYWN0aXZlKGN1cnJlbnQpOwoKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICBwcmV2OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgICAgICAgIGlmIChjdXJyZW50ID09PSAwKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50ID0gTWF0aC5hYnMoMSAtIHRoaXMuc2l6ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudCAtIDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuYWN0aXZlKGN1cnJlbnQpOwoKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICByZXZlcnQ6IGZ1bmN0aW9uKHVwZGF0ZSkgewogICAgICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmluaXRpYWxJbmRleCkgewogICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLm9wdGlvbnMuaW5pdGlhbEluZGV4OwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmFjdGl2ZShpbmRleCwgdXBkYXRlKTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuJG5hdi5yZW1vdmVDbGFzcyh0aGlzLmNsYXNzZXMuZGlzYWJsZWQpOwogICAgICAgICAgICAgICAgdGhpcy4kY29udGVudC5yZW1vdmVDbGFzcyh0aGlzLmNsYXNzZXMuZGlzYWJsZWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRpc2FibGVkID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLiRuYXYuYWRkQ2xhc3ModGhpcy5jbGFzc2VzLmRpc2FibGVkKTsKICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQuYWRkQ2xhc3ModGhpcy5jbGFzc2VzLmRpc2FibGVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAogICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0aGlzLiRuYXYucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLm5hdikucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLndpdGhKcyk7CiAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLmNvbnRlbnQpLnJlbW92ZUNsYXNzKHRoaXMuY2xhc3Nlcy53aXRoSnMpOwoKICAgICAgICAgICAgdGhpcy4kdGFicy5yZW1vdmVDbGFzcyh0aGlzLmNsYXNzZXMuYWN0aXZlVGFiKTsKICAgICAgICAgICAgdGhpcy4kcGFuZXMucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLmFjdGl2ZVBhbmUpOwogICAgICAgICAgICB0aGlzLiRuYXYub2ZmKHRoaXMub3B0aW9ucy5ldmVudCk7CiAgICAgICAgICAgICQuZGF0YSh0aGlzLiRlbGVtZW50LCBwbHVnaW5OYW1lLCBudWxsKTsKICAgICAgICB9CiAgICB9OwogICAgLy8gQ29sbGVjdGlvbiBtZXRob2QuCiAgICAkLmZuW3BsdWdpbk5hbWVdID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgdmFyIG1ldGhvZCA9IG9wdGlvbnM7CiAgICAgICAgICAgIHZhciBtZXRob2RfYXJndW1lbnRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgaWYgKC9eXF8vLnRlc3QobWV0aG9kKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKC9eKGdldFRhYnN8Z2V0UGFuZXN8Z2V0Q3VycmVudFBhbmV8Z2V0Q3VycmVudFRhYnxnZXRJbmRleHxnZXRTaXplKSQvLnRlc3QobWV0aG9kKSkgewoKICAgICAgICAgICAgICAgIHZhciBhcGkgPSB0aGlzLmZpcnN0KCkuZGF0YShwbHVnaW5OYW1lKTsKICAgICAgICAgICAgICAgIGlmIChhcGkgJiYgdHlwZW9mIGFwaVttZXRob2RdID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaVttZXRob2RdLmFwcGx5KGFwaSwgbWV0aG9kX2FyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhcGkgPSAkLmRhdGEodGhpcywgcGx1Z2luTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFwaSAmJiB0eXBlb2YgYXBpW21ldGhvZF0gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBpW21ldGhvZF0uYXBwbHkoYXBpLCBtZXRob2RfYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoISQuZGF0YSh0aGlzLCBwbHVnaW5OYW1lKSkgewogICAgICAgICAgICAgICAgICAgICQuZGF0YSh0aGlzLCBwbHVnaW5OYW1lLCBuZXcgUGx1Z2luKHRoaXMsIG9wdGlvbnMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKfSkoalF1ZXJ5LCBkb2N1bWVudCwgd2luZG93KTsKCi8vIGpxdWVyeSBhc1RhYnMgaGlzdG9yeQooZnVuY3Rpb24od2luZG93LCBkb2N1bWVudCwgJCwgdW5kZWZpbmVkKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgaWYgKCF3aW5kb3cuaGlzdG9yeSB8fCAhd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlIHx8ICF3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUpIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgdmFyICRkb2MgPSAkKGRvY3VtZW50KTsKICAgIHZhciBpZF9jb3VudCA9IDE7CgogICAgJGRvYy5vbignYXNUYWJzOjppbml0JywgZnVuY3Rpb24oZXZlbnQsIGluc3RhbmNlKSB7CiAgICAgICAgaWYgKGluc3RhbmNlLm9wdGlvbnMuaGlzdG9yeSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoaW5zdGFuY2Uub3B0aW9ucy5oaXN0b3J5ICE9PSB0cnVlKSB7CiAgICAgICAgICAgIGluc3RhbmNlLmhpc3RvcnlJZCA9IGluc3RhbmNlLm9wdGlvbnMuaGlzdG9yeTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgaWQgPSBpbnN0YW5jZS4kZWxlbWVudC5hdHRyKCdpZCcpOwoKICAgICAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5oaXN0b3J5SWQgPSBpZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGluc3RhbmNlLmhpc3RvcnlJZCA9ICd0YWJzXycgKyBpZF9jb3VudDsKICAgICAgICAgICAgICAgIGlkX2NvdW50Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGFjdGl2ZSB0aGUgbWF0Y2hlZCB0YWIKICAgICAgICB2YXIgbWF0Y2ggPSBuZXcgUmVnRXhwKCdbIyZdKicgKyBpbnN0YW5jZS5oaXN0b3J5SWQgKyAnPShbXiZdKiknLCAnaScpCiAgICAgICAgICAgIC5leGVjKHdpbmRvdy5sb2NhdGlvbi5oYXNoKTsKCiAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgIHZhciBzbHVnID0gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoWzFdLnJlcGxhY2UoL1wrL2csICcgJykpOwogICAgICAgICAgICB2YXIgJHRhYiA9IGluc3RhbmNlLiRuYXYuZmluZCgnWycgKyBpbnN0YW5jZS5vcHRpb25zLmhpc3RvcnlBdHRyICsgJz0iJyArIHNsdWcgKyAnIl0nKTsKCiAgICAgICAgICAgIGlmICgkdGFiLmxlbmd0aCA+PSAxKSB7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5pbml0aWFsSW5kZXggPSBpbnN0YW5jZS4kdGFicy5pbmRleCgkdGFiKTsKICAgICAgICAgICAgfSBlbHNlIGlmICghaXNOYU4ocGFyc2VGbG9hdChzbHVnKSkgJiYgaXNGaW5pdGUoc2x1ZykpIHsKICAgICAgICAgICAgICAgIGluc3RhbmNlLmluaXRpYWxJbmRleCA9IHNsdWc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICQod2luZG93KS5vbigncG9wc3RhdGUnLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBldmVudC5vcmlnaW5hbEV2ZW50LnN0YXRlOwogICAgICAgICAgICBpZiAoc3RhdGUgJiYgdHlwZW9mIHN0YXRlW2luc3RhbmNlLmhpc3RvcnlJZF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGVbaW5zdGFuY2UuaGlzdG9yeUlkXS5pbmRleCkgewogICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLmFjdGl2ZShzdGF0ZVtpbnN0YW5jZS5oaXN0b3J5SWRdLmluZGV4LCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaW5zdGFuY2UucmV2ZXJ0KGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSk7CgogICAgJGRvYy5vbignYXNUYWJzOjp1cGRhdGUnLCBmdW5jdGlvbihldmVudCwgaW5zdGFuY2UpIHsKICAgICAgICBpZiAoaW5zdGFuY2Uub3B0aW9ucy5oaXN0b3J5ID09PSBmYWxzZSB8fCB0eXBlb2YgaW5zdGFuY2UuaGlzdG9yeUlkID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChpbnN0YW5jZS5hY3RpdmVkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBpbmRleCA9IGluc3RhbmNlLmN1cnJlbnQsCiAgICAgICAgICAgIHN0YXRlID0gewogICAgICAgICAgICAgICAgaW5kZXg6IGluZGV4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbnRlbnQgPSBpbnN0YW5jZS4kdGFicy5lcShpbmRleCkuYXR0cihpbnN0YW5jZS5vcHRpb25zLmhpc3RvcnlBdHRyKTsKCiAgICAgICAgaWYgKGNvbnRlbnQpIHsKICAgICAgICAgICAgc3RhdGUuc2x1ZyA9IGNvbnRlbnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdGUuc2x1ZyA9IGluZGV4OwogICAgICAgIH0KICAgICAgICBpZiAoaW5kZXggPT09IGluc3RhbmNlLm9wdGlvbnMuaW5pdGlhbEluZGV4KSB7CiAgICAgICAgICAgIHN0YXRlLmluaXRpYWwgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoOwoKICAgICAgICBpZiAodXJsID09PSAnJykgewogICAgICAgICAgICB1cmwgPSAnIyc7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVnID0gbmV3IFJlZ0V4cCgnJionICsgaW5zdGFuY2UuaGlzdG9yeUlkICsgJz1bXiZdKycsICJpIik7CiAgICAgICAgaWYgKHN0YXRlLmluaXRpYWwpIHsKICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UocmVnLCAnJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHVybC5tYXRjaChyZWcpKSB7CiAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZShyZWcsICcmJyArIGluc3RhbmNlLmhpc3RvcnlJZCArICc9JyArIHN0YXRlLnNsdWcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdXJsID0gdXJsICsgJyYnICsgaW5zdGFuY2UuaGlzdG9yeUlkICsgJz0nICsgc3RhdGUuc2x1ZzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgc3RhdGVzID0gaGlzdG9yeS5zdGF0ZTsKICAgICAgICBpZiAoIXN0YXRlcykgewogICAgICAgICAgICBzdGF0ZXMgPSB7fTsKICAgICAgICB9CiAgICAgICAgc3RhdGVzW2luc3RhbmNlLmhpc3RvcnlJZF0gPSBzdGF0ZTsKCiAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoL14jJi8sICcjJyk7CiAgICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHN0YXRlcywgIiIsIHVybCk7CiAgICB9KTsKfSkod2luZG93LCBkb2N1bWVudCwgalF1ZXJ5KTsKCi8vIGpxdWVyeSBhc1RhYnMga2V5Ym9hcmQKKGZ1bmN0aW9uKHdpbmRvdywgZG9jdW1lbnQsICQsIHVuZGVmaW5lZCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkZG9jID0gJChkb2N1bWVudCk7CiAgICB2YXIga2V5Ym9hcmQgPSB7CiAgICAgICAga2V5czogewogICAgICAgICAgICAnVVAnOiAzOCwKICAgICAgICAgICAgJ0RPV04nOiA0MCwKICAgICAgICAgICAgJ0xFRlQnOiAzNywKICAgICAgICAgICAgJ1JJR0hUJzogMzksCiAgICAgICAgICAgICdSRVRVUk4nOiAxMywKICAgICAgICAgICAgJ0VTQ0FQRSc6IDI3LAogICAgICAgICAgICAnQkFDS1NQQUNFJzogOCwKICAgICAgICAgICAgJ1NQQUNFJzogMzIKICAgICAgICB9LAogICAgICAgIG1hcDoge30sCiAgICAgICAgYm91bmQ6IGZhbHNlLAogICAgICAgIHByZXNzOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBlLmtleUNvZGUgfHwgZS53aGljaDsKICAgICAgICAgICAgaWYgKGtleSBpbiBrZXlib2FyZC5tYXAgJiYgdHlwZW9mIGtleWJvYXJkLm1hcFtrZXldID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4ga2V5Ym9hcmQubWFwW2tleV0uY2FsbCh0aGlzLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYXR0YWNoOiBmdW5jdGlvbihtYXApIHsKICAgICAgICAgICAgdmFyIGtleSwgdXA7CiAgICAgICAgICAgIGZvciAoa2V5IGluIG1hcCkgewogICAgICAgICAgICAgICAgaWYgKG1hcC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgdXAgPSBrZXkudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodXAgaW4ga2V5Ym9hcmQua2V5cykgewogICAgICAgICAgICAgICAgICAgICAgICBrZXlib2FyZC5tYXBba2V5Ym9hcmQua2V5c1t1cF1dID0gbWFwW2tleV07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmQubWFwW3VwXSA9IG1hcFtrZXldOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWtleWJvYXJkLmJvdW5kKSB7CiAgICAgICAgICAgICAgICBrZXlib2FyZC5ib3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAkZG9jLmJpbmQoJ2tleWRvd24nLCBrZXlib2FyZC5wcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGRldGFjaDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGtleWJvYXJkLmJvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIGtleWJvYXJkLm1hcCA9IHt9OwogICAgICAgICAgICAkZG9jLnVuYmluZCgna2V5ZG93bicsIGtleWJvYXJkLnByZXNzKTsKICAgICAgICB9CiAgICB9OwoKICAgICRkb2Mub24oJ2FzVGFiczo6aW5pdCcsIGZ1bmN0aW9uKGV2ZW50LCBpbnN0YW5jZSkgewogICAgICAgIGlmIChpbnN0YW5jZS5vcHRpb25zLmtleWJvYXJkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBtYWtlIHVsIGRpdiBldGMuIGdldCBmb2N1cwogICAgICAgIGluc3RhbmNlLiRlbGVtZW50LmFkZChpbnN0YW5jZS4kcGFuZXNfd3JhcCkuYXR0cigndGFiaW5kZXgnLCAnMCcpLm9uKCdmb2N1cycsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBrZXlib2FyZC5hdHRhY2goewogICAgICAgICAgICAgICAgbGVmdDogJC5wcm94eShpbnN0YW5jZS5wcmV2LCBpbnN0YW5jZSksCiAgICAgICAgICAgICAgICByaWdodDogJC5wcm94eShpbnN0YW5jZS5uZXh0LCBpbnN0YW5jZSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KS5vbignYmx1cicsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBrZXlib2FyZC5kZXRhY2goKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0pOwoKICAgICAgICBpbnN0YW5jZS4kcGFuZXMuYXR0cigndGFiaW5kZXgnLCAnMCcpLm9uKCdmb2N1cycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAga2V5Ym9hcmQuYXR0YWNoKHsKICAgICAgICAgICAgICAgIGxlZnQ6ICQucHJveHkoaW5zdGFuY2UucHJldiwgaW5zdGFuY2UpLAogICAgICAgICAgICAgICAgcmlnaHQ6ICQucHJveHkoaW5zdGFuY2UubmV4dCwgaW5zdGFuY2UpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KS5vbignYmx1cicsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAga2V5Ym9hcmQuZGV0YWNoKCk7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0pOwogICAgfSk7Cn0pKHdpbmRvdywgZG9jdW1lbnQsIGpRdWVyeSk7CgovLyBlbGVtZW50VHJhbnNpdGlvbnMKKGZ1bmN0aW9uKHdpbmRvdywgZG9jdW1lbnQsICQsIHVuZGVmaW5lZCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciAkZG9jID0gJChkb2N1bWVudCk7CgogICAgdmFyIHJldmVydENsYXNzID0gZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgdmFyIGNsYXNzZXMgPSBzdHIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgbGVuID0gY2xhc3Nlcy5sZW5ndGgsCiAgICAgICAgICAgIGlucmUgPSBbJ1VwJywgJ0Rvd24nLCAnSW4nLCAnT3V0JywgJ0xlZnQnLCAnUmlnaHQnLCAnVG9wJywgJ0JvdHRvbSddLAogICAgICAgICAgICBvdXRyZSA9IFsnRG93bicsICdVcCcsICdPdXQnLCAnSW4nLCAnUmlnaHQnLCAnTGVmdCcsICdCb3R0b20nLCAnVG9wJ10sCiAgICAgICAgICAgIG91dHB1dCA9ICIiLAogICAgICAgICAgICByZSA9ICIiLAogICAgICAgICAgICByZV9hcnJheSA9IFtdLAogICAgICAgICAgICByZV9udW0gPSAiIjsKCiAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCBsZW47IG4rKykgewogICAgICAgICAgICBmb3IgKHZhciBtID0gMDsgbSA8IGlucmUubGVuZ3RoOyBtKyspIHsKICAgICAgICAgICAgICAgIHJlID0gbmV3IFJlZ0V4cChpbnJlW21dKTsKICAgICAgICAgICAgICAgIGlmIChyZS50ZXN0KGNsYXNzZXNbbl0pKSB7CiAgICAgICAgICAgICAgICAgICAgcmVfYXJyYXkucHVzaChtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKHZhciBsID0gMDsgbCA8IHJlX2FycmF5Lmxlbmd0aDsgbCsrKSB7CiAgICAgICAgICAgICAgICByZV9udW0gPSByZV9hcnJheVtsXTsKICAgICAgICAgICAgICAgIGNsYXNzZXNbbl0gPSBjbGFzc2VzW25dLnJlcGxhY2UoaW5yZVtyZV9udW1dLCByZV9udW0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgcmVfYXJyYXkubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlX251bSA9IHJlX2FycmF5W2tdOwogICAgICAgICAgICAgICAgY2xhc3Nlc1tuXSA9IGNsYXNzZXNbbl0ucmVwbGFjZShyZV9udW0sIG91dHJlW3JlX251bV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dHB1dCArPSAiICIgKyBjbGFzc2VzW25dOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJC50cmltKG91dHB1dCk7CiAgICB9OwoKICAgIHZhciBhbmltYXRpb25lbmQgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQ7CiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmFrZWVsZW1lbnQnKTsKICAgICAgICB2YXIgYW5pbWF0aW9ucyA9IHsKICAgICAgICAgICAgJ2FuaW1hdGlvbic6ICdhbmltYXRpb25lbmQnLAogICAgICAgICAgICAnLW8tYW5pbWF0aW9uJzogJ29BbmltYXRpb25FbmQnLAogICAgICAgICAgICAnLW1vei1hbmltYXRpb24nOiAnYW5pbWF0aW9uZW5kJywKICAgICAgICAgICAgJy13ZWJraXQtYW5pbWF0aW9uJzogJ3dlYmtpdEFuaW1hdGlvbkVuZCcKICAgICAgICB9OwoKICAgICAgICBmb3IgKHQgaW4gYW5pbWF0aW9ucykgewogICAgICAgICAgICBpZiAoZWwuc3R5bGVbdF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFuaW1hdGlvbnNbdF07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pKCk7CgogICAgaWYgKGFuaW1hdGlvbmVuZCA9PT0gZmFsc2UpIHJldHVybjsKCiAgICAkZG9jLm9uKCdhc1RhYnM6OmluaXQnLCBmdW5jdGlvbihldmVudCwgaW5zdGFuY2UpIHsKICAgICAgICBpZiAoaW5zdGFuY2Uub3B0aW9ucy5lZmZlY3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGluc3RhbmNlLmVmZmVjdHMgPSB7CiAgICAgICAgICAgIGluQ2xhc3M6IGluc3RhbmNlLm9wdGlvbnMuZWZmZWN0LAogICAgICAgICAgICBvdXRDbGFzczogcmV2ZXJ0Q2xhc3MoaW5zdGFuY2Uub3B0aW9ucy5lZmZlY3QpCiAgICAgICAgfTsKCiAgICAgICAgaW5zdGFuY2UuJGNvbnRlbnQuY2hpbGRyZW4oKS5jc3MoewogICAgICAgICAgICAnLXdlYmtpdC1hbmltYXRpb24tZHVyYXRpb24nOiBpbnN0YW5jZS5vcHRpb25zLmR1cmF0aW9uICsgJ21zJywKICAgICAgICAgICAgJ2FuaW1hdGlvbi1kdXJhdGlvbic6IGluc3RhbmNlLm9wdGlvbnMuZHVyYXRpb24gKyAnbXMnCiAgICAgICAgfSkKICAgICAgICBpbnN0YW5jZS4kY29udGVudC5hZGRDbGFzcygnd2l0aC1lZmZlY3RzJyk7CiAgICB9KTsKCiAgICAkZG9jLm9uKCdhc1RhYnM6OnJlYWR5JywgZnVuY3Rpb24oZXZlbnQsIGluc3RhbmNlKSB7CiAgICAgICAgaWYgKGluc3RhbmNlLm9wdGlvbnMuZWZmZWN0ID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUgb3JpZW50YXRpb25jaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGluc3RhbmNlLnJlc2l6aW5nVGltZW91dCk7CiAgICAgICAgICAgIGluc3RhbmNlLnJlc2l6aW5nVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gaW5zdGFuY2UuZ2V0Q3VycmVudFBhbmUoKS5vdXRlckhlaWdodCh0cnVlKTsKCiAgICAgICAgICAgICAgICBpbnN0YW5jZS4kY29udGVudC5oZWlnaHQoaGVpZ2h0KTsKICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9KTsKICAgIH0pOwoKICAgICRkb2Mub24oJ2FzVGFiczo6YWN0aXZlIGFzVGFiczo6bG9hZGVkJywgZnVuY3Rpb24oZXZlbnQsIGluc3RhbmNlKSB7CiAgICAgICAgaWYgKGluc3RhbmNlLm9wdGlvbnMuZWZmZWN0ID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgaGVpZ2h0ID0gaW5zdGFuY2UuZ2V0Q3VycmVudFBhbmUoKS5vdXRlckhlaWdodCh0cnVlKTsKICAgICAgICBpbnN0YW5jZS4kY29udGVudC5oZWlnaHQoaGVpZ2h0KTsKICAgIH0pOwoKICAgICRkb2Mub24oJ2FzVGFiczo6YW5pbWF0aW9uJywgZnVuY3Rpb24oZXZlbnQsIGluc3RhbmNlLCBmcm9tLCB0bykgewogICAgICAgIGlmIChpbnN0YW5jZS5vcHRpb25zLmVmZmVjdCA9PT0gZmFsc2UgfHwgaW5zdGFuY2UuaW5pdGlhbGl6ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHZhciAkdG8gPSBpbnN0YW5jZS4kcGFuZXMuZXEodG8pLAogICAgICAgICAgICAkZnJvbSA9IGluc3RhbmNlLiRwYW5lcy5lcShmcm9tKTsKCiAgICAgICAgaW5zdGFuY2UuaXNBbmltYXRpbmcgPSB0cnVlOwoKICAgICAgICAkZnJvbS5yZW1vdmVDbGFzcyhpbnN0YW5jZS5lZmZlY3RzLmluQ2xhc3MpLmFkZENsYXNzKGluc3RhbmNlLmVmZmVjdHMub3V0Q2xhc3MgKyAnIGFuaW1hdGVkJykub25lKGFuaW1hdGlvbmVuZCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICRmcm9tLnJlbW92ZUNsYXNzKGluc3RhbmNlLmVmZmVjdHMub3V0Q2xhc3MgKyAnIGFuaW1hdGVkJykucmVtb3ZlQ2xhc3MoJ2lzLWFjdGl2ZScpOwoKICAgICAgICAgICAgJHRvLnJlbW92ZUNsYXNzKGluc3RhbmNlLmVmZmVjdHMub3V0Q2xhc3MpLmFkZENsYXNzKCdpcy1hY3RpdmUnKS5hZGRDbGFzcyhpbnN0YW5jZS5lZmZlY3RzLmluQ2xhc3MgKyAnIGFuaW1hdGVkJykub25lKGFuaW1hdGlvbmVuZCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAkdG8ucmVtb3ZlQ2xhc3MoaW5zdGFuY2UuZWZmZWN0cy5pbkNsYXNzKTsKCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5pc0FuaW1hdGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0pOwp9KSh3aW5kb3csIGRvY3VtZW50LCBqUXVlcnkpOwo=",
                "body": "LyohIGpRdWVyeSBhc1RhYnMgLSB2MC4zLjEgLSAyMDE0LTA4LTAyCiogaHR0cHM6Ly9naXRodWIuY29tL2FtYXppbmdTdXJnZS9qcXVlcnktYXNUYWJzCiogQ29weXJpZ2h0IChjKSAyMDE0IGFtYXppbmdTdXJnZTsgTGljZW5zZWQgR1BMICovCihmdW5jdGlvbigkLCBkb2N1bWVudCwgd2luZG93LCB1bmRlZmluZWQpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgcGx1Z2luTmFtZSA9ICdhc1RhYnMnOwogICAgLy8gbWFpbiBjb25zdHJ1Y3RvcgogICAgdmFyIFBsdWdpbiA9ICRbcGx1Z2luTmFtZV0gPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7CgogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgICAgICB0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KTsKICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgUGx1Z2luLmRlZmF1bHRzLCBvcHRpb25zLCB0aGlzLiRlbGVtZW50LmRhdGEoJ29wdGlvbnMnKSk7CiAgICAgICAgdGhpcy5uYW1lc3BhY2UgPSB0aGlzLm9wdGlvbnMubmFtZXNwYWNlOwogICAgICAgIHRoaXMuaW5pdGlhbEluZGV4ID0gdGhpcy5vcHRpb25zLmluaXRpYWxJbmRleDsKICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuYWN0aXZlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuY3VycmVudCA9IG51bGw7CgogICAgICAgIC8vIENsYXNzCiAgICAgICAgdGhpcy5jbGFzc2VzID0gewogICAgICAgICAgICB3aXRoSnM6ICd3aXRoLWpzJywKICAgICAgICAgICAgYWN0aXZlVGFiOiAnaXMtYWN0aXZlJywKICAgICAgICAgICAgYWN0aXZlUGFuZTogJ2lzLWFjdGl2ZScsCiAgICAgICAgICAgIG5hdjogdGhpcy5uYW1lc3BhY2UgKyAnLW5hdicsCiAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMubmFtZXNwYWNlICsgJy1jb250ZW50JywKICAgICAgICAgICAgZGlzYWJsZWQ6IHRoaXMubmFtZXNwYWNlICsgJy1kaXNhYmxlZCcsCiAgICAgICAgICAgIHNraW46IHRoaXMubmFtZXNwYWNlICsgJ18nICsgdGhpcy5vcHRpb25zLnNraW4KICAgICAgICB9OwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLm5hdlNlbGVjdG9yKSB7CiAgICAgICAgICAgIHRoaXMuJG5hdiA9IHRoaXMuJGVsZW1lbnQuZmluZCh0aGlzLm9wdGlvbnMubmF2U2VsZWN0b3IpOwogICAgICAgICAgICB0aGlzLiRjb250ZW50ID0gdGhpcy4kZWxlbWVudC5maW5kKHRoaXMub3B0aW9ucy5jb250ZW50U2VsZWN0b3IpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy4kbmF2ID0gdGhpcy4kZWxlbWVudDsKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb250ZW50U2VsZWN0b3IgPT09ICcrJykgewogICAgICAgICAgICAgICAgdGhpcy4kY29udGVudCA9IHRoaXMuJG5hdi5uZXh0KCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLiRjb250ZW50ID0gJCh0aGlzLm9wdGlvbnMuY29udGVudFNlbGVjdG9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy4kbmF2LmFkZENsYXNzKHRoaXMuY2xhc3Nlcy5uYXYpLmFkZENsYXNzKHRoaXMuY2xhc3Nlcy53aXRoSnMpOwogICAgICAgIHRoaXMuJGNvbnRlbnQuYWRkQ2xhc3ModGhpcy5jbGFzc2VzLmNvbnRlbnQpLmFkZENsYXNzKHRoaXMuY2xhc3Nlcy53aXRoSnMpOwoKICAgICAgICB0aGlzLiR0YWJzID0gdGhpcy4kbmF2LmNoaWxkcmVuKCk7CiAgICAgICAgdGhpcy4kcGFuZXMgPSB0aGlzLiRjb250ZW50LmNoaWxkcmVuKCk7CiAgICAgICAgdGhpcy4kbG9hZGluZyA9ICQoJzxzcGFuIGNsYXNzPSInICsgdGhpcy5uYW1lc3BhY2UgKyAnLWxvYWRpbmciPjwvc3Bhbj4nKTsKCiAgICAgICAgdGhpcy5zaXplID0gdGhpcy4kdGFicy5sZW5ndGg7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2tpbikgewogICAgICAgICAgICB0aGlzLiRlbGVtZW50LmFkZENsYXNzKHRoaXMuY2xhc3Nlcy5za2luKTsKICAgICAgICAgICAgdGhpcy4kY29udGVudC5hZGRDbGFzcyh0aGlzLmNsYXNzZXMuc2tpbik7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmFqYXggPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5hamF4ID0gW107CiAgICAgICAgICAgICQuZWFjaCh0aGlzLiR0YWJzLCBmdW5jdGlvbihpLCB2KSB7CiAgICAgICAgICAgICAgICB2YXIgb2JqID0ge307CiAgICAgICAgICAgICAgICBvYmouaHJlZiA9ICQodikuZGF0YSgnaHJlZicpOwogICAgICAgICAgICAgICAgc2VsZi5hamF4LnB1c2gob2JqKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmluaXQoKTsKICAgIH07CgogICAgLy8gRGVmYXVsdCBvcHRpb25zIGZvciB0aGUgcGx1Z2luIGFzIGEgc2ltcGxlIG9iamVjdAogICAgUGx1Z2luLmRlZmF1bHRzID0gewogICAgICAgIG5hbWVzcGFjZTogJ2FzVGFicycsCiAgICAgICAgbmF2U2VsZWN0b3I6IG51bGwsCiAgICAgICAgY29udGVudFNlbGVjdG9yOiAnKycsCiAgICAgICAgc2tpbjogbnVsbCwKICAgICAgICBpbml0aWFsSW5kZXg6IDAsCiAgICAgICAgYWpheDogZmFsc2UsCiAgICAgICAgY2FjaGVkOiBmYWxzZSwKICAgICAgICBoaXN0b3J5OiBmYWxzZSwKICAgICAgICBoaXN0b3J5QXR0cjogJ2lkJywKICAgICAgICBrZXlib2FyZDogZmFsc2UsCiAgICAgICAgZWZmZWN0OiBmYWxzZSwKICAgICAgICBkdXJhdGlvbjogMzAwLAogICAgICAgIGV2ZW50OiAnY2xpY2snCiAgICB9OwogICAgUGx1Z2luLnByb3RvdHlwZSA9IHsKICAgICAgICBjb25zdHJ1Y3RvcjogUGx1Z2luLAogICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAvLyBCaW5kIGxvZ2ljCiAgICAgICAgICAgIHRoaXMuJG5hdi5vbih0aGlzLm9wdGlvbnMuZXZlbnQsICc+IConLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5kaXNhYmxlZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBpbmRleCA9ICQoZS50YXJnZXQpLmluZGV4KCk7CiAgICAgICAgICAgICAgICBzZWxmLmFjdGl2ZShpbmRleCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcignaW5pdCcpOwoKICAgICAgICAgICAgdGhpcy5hY3RpdmUodGhpcy5pbml0aWFsSW5kZXgpOwogICAgICAgICAgICB0aGlzLmFjdGl2ZWQgPSB0cnVlOwoKICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7CgogICAgICAgICAgICB0aGlzLl90cmlnZ2VyKCdyZWFkeScpOwogICAgICAgIH0sCiAgICAgICAgX3RyaWdnZXI6IGZ1bmN0aW9uKGV2ZW50VHlwZSkgewogICAgICAgICAgICB2YXIgbWV0aG9kX2FyZ3VtZW50cywKICAgICAgICAgICAgICAgIHRyaWdnZXJfYXJndW1lbnRzID0gW3RoaXNdOwogICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIG1ldGhvZF9hcmd1bWVudHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICAgICAgICAgICAgdHJpZ2dlcl9hcmd1bWVudHMgPSB0cmlnZ2VyX2FyZ3VtZW50cy5jb25jYXQobWV0aG9kX2FyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGV2ZW50CiAgICAgICAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihwbHVnaW5OYW1lICsgJzo6JyArIGV2ZW50VHlwZSwgdHJpZ2dlcl9hcmd1bWVudHMpOwogICAgICAgICAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXIoZXZlbnRUeXBlICsgJy4nICsgcGx1Z2luTmFtZSwgdHJpZ2dlcl9hcmd1bWVudHMpOwoKICAgICAgICAgICAgLy8gY2FsbGJhY2sKICAgICAgICAgICAgZXZlbnRUeXBlID0gZXZlbnRUeXBlLnJlcGxhY2UoL1xiXHcrXGIvZywgZnVuY3Rpb24od29yZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHdvcmQuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBvbkZ1bmN0aW9uID0gJ29uJyArIGV2ZW50VHlwZTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zW29uRnVuY3Rpb25dID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNbb25GdW5jdGlvbl0uYXBwbHkodGhpcywgbWV0aG9kX2FyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oaW5kZXgsIHVwZGF0ZSkgewogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50KSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50ID09PSBpbmRleCB8fCBpbmRleCA+PSB0aGlzLnNpemUgfHwgaW5kZXggPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IHRoaXMuc2l6ZSkgewogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gdGhpcy5zaXplIC0gMTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLiR0YWJzLmVxKGluZGV4KS5hZGRDbGFzcyh0aGlzLmNsYXNzZXMuYWN0aXZlVGFiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKHRoaXMuY2xhc3Nlcy5hY3RpdmVUYWIpOwoKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGhpcy4kcGFuZXMuZXEoaW5kZXgpLmFkZENsYXNzKHRoaXMuY2xhc3Nlcy5hY3RpdmVQYW5lKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKHRoaXMuY2xhc3Nlcy5hY3RpdmVQYW5lKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNlbGYuX3RyaWdnZXIoJ2FuaW1hdGlvbicsIHNlbGYuY3VycmVudCwgaW5kZXgpOwoKICAgICAgICAgICAgICAgIGlmICghc2VsZi5lZmZlY3RzKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi4kcGFuZXMuZXEoc2VsZi5jdXJyZW50KS5mYWRlT3V0KHNlbGYub3B0aW9ucy5kdXJhdGlvbiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2lzLWFjdGl2ZScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi4kcGFuZXMuZXEoaW5kZXgpLmZhZGVJbihzZWxmLm9wdGlvbnMuZHVyYXRpb24sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnaXMtYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBzZWxmLnByZXZpb3VzID0gc2VsZi5jdXJyZW50OwogICAgICAgICAgICBzZWxmLmN1cnJlbnQgPSBpbmRleDsKCiAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuYWpheCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgc2VsZi5hamF4TG9hZChpbmRleCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlbGYuX3RyaWdnZXIoJ2FjdGl2ZScsIGluZGV4KTsKCiAgICAgICAgICAgIGlmICh1cGRhdGUgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBzZWxmLl90cmlnZ2VyKCd1cGRhdGUnLCBpbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFqYXhMb2FkOiBmdW5jdGlvbihpbmRleCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgICAgICAgICBkdGQ7CiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2FjaGVkID09PSB0cnVlICYmIHRoaXMuYWpheFtpbmRleF0uY2FjaGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dMb2FkaW5nKCk7CiAgICAgICAgICAgICAgICBkdGQgPSAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDogdGhpcy5hamF4W2luZGV4XS5ocmVmCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGR0ZC5kb25lKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmFqYXhbaW5kZXhdLmNhY2hlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oaWRlTG9hZGluZygpOwogICAgICAgICAgICAgICAgICAgIHNlbGYuJHBhbmVzLmVxKGluZGV4KS5odG1sKGRhdGEpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBkdGQuZmFpbChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmhpZGVMb2FkaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgc2VsZi4kcGFuZXMuZXEoaW5kZXgpLmh0bWwoJ2ZhaWxlZCcpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBkdGQuYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuX3RyaWdnZXIoJ2xvYWRlZCcsIGluZGV4KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzaG93TG9hZGluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMuJGxvYWRpbmcuYXBwZW5kVG8odGhpcy4kY29udGVudCk7CiAgICAgICAgfSwKICAgICAgICBoaWRlTG9hZGluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMuJGxvYWRpbmcucmVtb3ZlKCk7CiAgICAgICAgfSwKICAgICAgICBnZXRUYWJzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHRhYnM7CiAgICAgICAgfSwKICAgICAgICBnZXRQYW5lczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiRwYW5lczsKICAgICAgICB9LAogICAgICAgIGdldEN1cnJlbnRQYW5lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHBhbmVzLmVxKHRoaXMuY3VycmVudCk7CiAgICAgICAgfSwKICAgICAgICBnZXRDdXJyZW50VGFiOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHRhYnMuZXEodGhpcy5jdXJyZW50KTsKICAgICAgICB9LAogICAgICAgIGdldEluZGV4OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudDsKICAgICAgICB9LAogICAgICAgIGdldFNpemU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zaXplOwogICAgICAgIH0sCiAgICAgICAgYXBwZW5kOiBmdW5jdGlvbih0aXRsZSwgY29udGVudCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5hZGQodGl0bGUsIGNvbnRlbnQsIHRoaXMuc2l6ZSk7CiAgICAgICAgfSwKICAgICAgICBhZGQ6IGZ1bmN0aW9uKHRpdGxlLCBjb250ZW50LCBpbmRleCkgewogICAgICAgICAgICB0aGlzLiR0YWJzLmVxKGluZGV4IC0gMSkuYWZ0ZXIodGhpcy4kdGFicy5lcSgwKS5jbG9uZSgpLnJlbW92ZUNsYXNzKHRoaXMuY2xhc3Nlcy5hY3RpdmVUYWIpLmh0bWwodGl0bGUpKTsKICAgICAgICAgICAgdGhpcy4kcGFuZXMuZXEoaW5kZXggLSAxKS5hZnRlcih0aGlzLiRwYW5lcy5lcSgwKS5jbG9uZSgpLnJlbW92ZUNsYXNzKHRoaXMuY2xhc3Nlcy5hY3RpdmVQYW5lKS5odG1sKGNvbnRlbnQpKTsKCiAgICAgICAgICAgIHRoaXMuJHRhYnMgPSB0aGlzLiRuYXYuY2hpbGRyZW4oKTsKICAgICAgICAgICAgdGhpcy4kcGFuZXMgPSB0aGlzLiRjb250ZW50LmNoaWxkcmVuKCk7CiAgICAgICAgICAgIHRoaXMuc2l6ZSsrOwoKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICByZW1vdmU6IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgICAgIGlmIChpbmRleCA+IHRoaXMuc2l6ZSB8fCBpbmRleCA8IDAgfHwgdGhpcy5zaXplID09PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiR0YWJzLmVxKGluZGV4KS5yZW1vdmUoKTsKICAgICAgICAgICAgdGhpcy4kcGFuZXMuZXEoaW5kZXgpLnJlbW92ZSgpOwoKICAgICAgICAgICAgdGhpcy4kdGFicyA9IHRoaXMuJG5hdi5jaGlsZHJlbigpOwogICAgICAgICAgICB0aGlzLiRwYW5lcyA9IHRoaXMuJGNvbnRlbnQuY2hpbGRyZW4oKTsKICAgICAgICAgICAgdGhpcy5zaXplLS07CgogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50ID09PSBpbmRleCkgewogICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gdGhpcy5zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUoaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgbmV4dDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICAgICAgICBpZiAoY3VycmVudCA8IHRoaXMuc2l6ZSAtIDEpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnQrKzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN1cnJlbnQgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmFjdGl2ZShjdXJyZW50KTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgcHJldjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICAgICAgICBpZiAoY3VycmVudCA9PT0gMCkgewogICAgICAgICAgICAgICAgY3VycmVudCA9IE1hdGguYWJzKDEgLSB0aGlzLnNpemUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQgLSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmFjdGl2ZShjdXJyZW50KTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgcmV2ZXJ0OiBmdW5jdGlvbih1cGRhdGUpIHsKICAgICAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbml0aWFsSW5kZXgpIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gdGhpcy5vcHRpb25zLmluaXRpYWxJbmRleDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5hY3RpdmUoaW5kZXgsIHVwZGF0ZSk7CgogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAogICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRpc2FibGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLiRuYXYucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLmRpc2FibGVkKTsKICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLmRpc2FibGVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAogICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy4kbmF2LmFkZENsYXNzKHRoaXMuY2xhc3Nlcy5kaXNhYmxlZCk7CiAgICAgICAgICAgICAgICB0aGlzLiRjb250ZW50LmFkZENsYXNzKHRoaXMuY2xhc3Nlcy5kaXNhYmxlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy4kbmF2LnJlbW92ZUNsYXNzKHRoaXMuY2xhc3Nlcy5uYXYpLnJlbW92ZUNsYXNzKHRoaXMuY2xhc3Nlcy53aXRoSnMpOwogICAgICAgICAgICB0aGlzLiRjb250ZW50LnJlbW92ZUNsYXNzKHRoaXMuY2xhc3Nlcy5jb250ZW50KS5yZW1vdmVDbGFzcyh0aGlzLmNsYXNzZXMud2l0aEpzKTsKCiAgICAgICAgICAgIHRoaXMuJHRhYnMucmVtb3ZlQ2xhc3ModGhpcy5jbGFzc2VzLmFjdGl2ZVRhYik7CiAgICAgICAgICAgIHRoaXMuJHBhbmVzLnJlbW92ZUNsYXNzKHRoaXMuY2xhc3Nlcy5hY3RpdmVQYW5lKTsKICAgICAgICAgICAgdGhpcy4kbmF2Lm9mZih0aGlzLm9wdGlvbnMuZXZlbnQpOwogICAgICAgICAgICAkLmRhdGEodGhpcy4kZWxlbWVudCwgcGx1Z2luTmFtZSwgbnVsbCk7CiAgICAgICAgfQogICAgfTsKICAgIC8vIENvbGxlY3Rpb24gbWV0aG9kLgogICAgJC5mbltwbHVnaW5OYW1lXSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIHZhciBtZXRob2QgPSBvcHRpb25zOwogICAgICAgICAgICB2YXIgbWV0aG9kX2FyZ3VtZW50cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSA6IHVuZGVmaW5lZDsKCiAgICAgICAgICAgIGlmICgvXlxfLy50ZXN0KG1ldGhvZCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmICgvXihnZXRUYWJzfGdldFBhbmVzfGdldEN1cnJlbnRQYW5lfGdldEN1cnJlbnRUYWJ8Z2V0SW5kZXh8Z2V0U2l6ZSkkLy50ZXN0KG1ldGhvZCkpIHsKCiAgICAgICAgICAgICAgICB2YXIgYXBpID0gdGhpcy5maXJzdCgpLmRhdGEocGx1Z2luTmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoYXBpICYmIHR5cGVvZiBhcGlbbWV0aG9kXSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlbbWV0aG9kXS5hcHBseShhcGksIG1ldGhvZF9hcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXBpID0gJC5kYXRhKHRoaXMsIHBsdWdpbk5hbWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChhcGkgJiYgdHlwZW9mIGFwaVttZXRob2RdID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFwaVttZXRob2RdLmFwcGx5KGFwaSwgbWV0aG9kX2FyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKCEkLmRhdGEodGhpcywgcGx1Z2luTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAkLmRhdGEodGhpcywgcGx1Z2luTmFtZSwgbmV3IFBsdWdpbih0aGlzLCBvcHRpb25zKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07Cn0pKGpRdWVyeSwgZG9jdW1lbnQsIHdpbmRvdyk7CgovLyBqcXVlcnkgYXNUYWJzIGhpc3RvcnkKKGZ1bmN0aW9uKHdpbmRvdywgZG9jdW1lbnQsICQsIHVuZGVmaW5lZCkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIGlmICghd2luZG93Lmhpc3RvcnkgfHwgIXdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSB8fCAhd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciAkZG9jID0gJChkb2N1bWVudCk7CiAgICB2YXIgaWRfY291bnQgPSAxOwoKICAgICRkb2Mub24oJ2FzVGFiczo6aW5pdCcsIGZ1bmN0aW9uKGV2ZW50LCBpbnN0YW5jZSkgewogICAgICAgIGlmIChpbnN0YW5jZS5vcHRpb25zLmhpc3RvcnkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGluc3RhbmNlLm9wdGlvbnMuaGlzdG9yeSAhPT0gdHJ1ZSkgewogICAgICAgICAgICBpbnN0YW5jZS5oaXN0b3J5SWQgPSBpbnN0YW5jZS5vcHRpb25zLmhpc3Rvcnk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGlkID0gaW5zdGFuY2UuJGVsZW1lbnQuYXR0cignaWQnKTsKCiAgICAgICAgICAgIGlmIChpZCkgewogICAgICAgICAgICAgICAgaW5zdGFuY2UuaGlzdG9yeUlkID0gaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5oaXN0b3J5SWQgPSAndGFic18nICsgaWRfY291bnQ7CiAgICAgICAgICAgICAgICBpZF9jb3VudCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBhY3RpdmUgdGhlIG1hdGNoZWQgdGFiCiAgICAgICAgdmFyIG1hdGNoID0gbmV3IFJlZ0V4cCgnWyMmXSonICsgaW5zdGFuY2UuaGlzdG9yeUlkICsgJz0oW14mXSopJywgJ2knKQogICAgICAgICAgICAuZXhlYyh3aW5kb3cubG9jYXRpb24uaGFzaCk7CgogICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICB2YXIgc2x1ZyA9IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaFsxXS5yZXBsYWNlKC9cKy9nLCAnICcpKTsKICAgICAgICAgICAgdmFyICR0YWIgPSBpbnN0YW5jZS4kbmF2LmZpbmQoJ1snICsgaW5zdGFuY2Uub3B0aW9ucy5oaXN0b3J5QXR0ciArICc9IicgKyBzbHVnICsgJyJdJyk7CgogICAgICAgICAgICBpZiAoJHRhYi5sZW5ndGggPj0gMSkgewogICAgICAgICAgICAgICAgaW5zdGFuY2UuaW5pdGlhbEluZGV4ID0gaW5zdGFuY2UuJHRhYnMuaW5kZXgoJHRhYik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzTmFOKHBhcnNlRmxvYXQoc2x1ZykpICYmIGlzRmluaXRlKHNsdWcpKSB7CiAgICAgICAgICAgICAgICBpbnN0YW5jZS5pbml0aWFsSW5kZXggPSBzbHVnOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkKHdpbmRvdykub24oJ3BvcHN0YXRlJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gZXZlbnQub3JpZ2luYWxFdmVudC5zdGF0ZTsKICAgICAgICAgICAgaWYgKHN0YXRlICYmIHR5cGVvZiBzdGF0ZVtpbnN0YW5jZS5oaXN0b3J5SWRdICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgaWYgKHN0YXRlW2luc3RhbmNlLmhpc3RvcnlJZF0uaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5hY3RpdmUoc3RhdGVbaW5zdGFuY2UuaGlzdG9yeUlkXS5pbmRleCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGluc3RhbmNlLnJldmVydChmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0pOwoKICAgICRkb2Mub24oJ2FzVGFiczo6dXBkYXRlJywgZnVuY3Rpb24oZXZlbnQsIGluc3RhbmNlKSB7CiAgICAgICAgaWYgKGluc3RhbmNlLm9wdGlvbnMuaGlzdG9yeSA9PT0gZmFsc2UgfHwgdHlwZW9mIGluc3RhbmNlLmhpc3RvcnlJZCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoaW5zdGFuY2UuYWN0aXZlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgaW5kZXggPSBpbnN0YW5jZS5jdXJyZW50LAogICAgICAgICAgICBzdGF0ZSA9IHsKICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleAogICAgICAgICAgICB9LAogICAgICAgICAgICBjb250ZW50ID0gaW5zdGFuY2UuJHRhYnMuZXEoaW5kZXgpLmF0dHIoaW5zdGFuY2Uub3B0aW9ucy5oaXN0b3J5QXR0cik7CgogICAgICAgIGlmIChjb250ZW50KSB7CiAgICAgICAgICAgIHN0YXRlLnNsdWcgPSBjb250ZW50OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRlLnNsdWcgPSBpbmRleDsKICAgICAgICB9CiAgICAgICAgaWYgKGluZGV4ID09PSBpbnN0YW5jZS5vcHRpb25zLmluaXRpYWxJbmRleCkgewogICAgICAgICAgICBzdGF0ZS5pbml0aWFsID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaGFzaDsKCiAgICAgICAgaWYgKHVybCA9PT0gJycpIHsKICAgICAgICAgICAgdXJsID0gJyMnOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoJyYqJyArIGluc3RhbmNlLmhpc3RvcnlJZCArICc9W14mXSsnLCAiaSIpOwogICAgICAgIGlmIChzdGF0ZS5pbml0aWFsKSB7CiAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKHJlZywgJycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh1cmwubWF0Y2gocmVnKSkgewogICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UocmVnLCAnJicgKyBpbnN0YW5jZS5oaXN0b3J5SWQgKyAnPScgKyBzdGF0ZS5zbHVnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVybCA9IHVybCArICcmJyArIGluc3RhbmNlLmhpc3RvcnlJZCArICc9JyArIHN0YXRlLnNsdWc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIHN0YXRlcyA9IGhpc3Rvcnkuc3RhdGU7CiAgICAgICAgaWYgKCFzdGF0ZXMpIHsKICAgICAgICAgICAgc3RhdGVzID0ge307CiAgICAgICAgfQogICAgICAgIHN0YXRlc1tpbnN0YW5jZS5oaXN0b3J5SWRdID0gc3RhdGU7CgogICAgICAgIHVybCA9IHVybC5yZXBsYWNlKC9eIyYvLCAnIycpOwogICAgICAgIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZShzdGF0ZXMsICIiLCB1cmwpOwogICAgfSk7Cn0pKHdpbmRvdywgZG9jdW1lbnQsIGpRdWVyeSk7CgovLyBqcXVlcnkgYXNUYWJzIGtleWJvYXJkCihmdW5jdGlvbih3aW5kb3csIGRvY3VtZW50LCAkLCB1bmRlZmluZWQpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJGRvYyA9ICQoZG9jdW1lbnQpOwogICAgdmFyIGtleWJvYXJkID0gewogICAgICAgIGtleXM6IHsKICAgICAgICAgICAgJ1VQJzogMzgsCiAgICAgICAgICAgICdET1dOJzogNDAsCiAgICAgICAgICAgICdMRUZUJzogMzcsCiAgICAgICAgICAgICdSSUdIVCc6IDM5LAogICAgICAgICAgICAnUkVUVVJOJzogMTMsCiAgICAgICAgICAgICdFU0NBUEUnOiAyNywKICAgICAgICAgICAgJ0JBQ0tTUEFDRSc6IDgsCiAgICAgICAgICAgICdTUEFDRSc6IDMyCiAgICAgICAgfSwKICAgICAgICBtYXA6IHt9LAogICAgICAgIGJvdW5kOiBmYWxzZSwKICAgICAgICBwcmVzczogZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIga2V5ID0gZS5rZXlDb2RlIHx8IGUud2hpY2g7CiAgICAgICAgICAgIGlmIChrZXkgaW4ga2V5Ym9hcmQubWFwICYmIHR5cGVvZiBrZXlib2FyZC5tYXBba2V5XSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGtleWJvYXJkLm1hcFtrZXldLmNhbGwodGhpcywgZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGF0dGFjaDogZnVuY3Rpb24obWFwKSB7CiAgICAgICAgICAgIHZhciBrZXksIHVwOwogICAgICAgICAgICBmb3IgKGtleSBpbiBtYXApIHsKICAgICAgICAgICAgICAgIGlmIChtYXAuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgICAgIHVwID0ga2V5LnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVwIGluIGtleWJvYXJkLmtleXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmQubWFwW2tleWJvYXJkLmtleXNbdXBdXSA9IG1hcFtrZXldOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkLm1hcFt1cF0gPSBtYXBba2V5XTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFrZXlib2FyZC5ib3VuZCkgewogICAgICAgICAgICAgICAga2V5Ym9hcmQuYm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgJGRvYy5iaW5kKCdrZXlkb3duJywga2V5Ym9hcmQucHJlc3MpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkZXRhY2g6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBrZXlib2FyZC5ib3VuZCA9IGZhbHNlOwogICAgICAgICAgICBrZXlib2FyZC5tYXAgPSB7fTsKICAgICAgICAgICAgJGRvYy51bmJpbmQoJ2tleWRvd24nLCBrZXlib2FyZC5wcmVzcyk7CiAgICAgICAgfQogICAgfTsKCiAgICAkZG9jLm9uKCdhc1RhYnM6OmluaXQnLCBmdW5jdGlvbihldmVudCwgaW5zdGFuY2UpIHsKICAgICAgICBpZiAoaW5zdGFuY2Uub3B0aW9ucy5rZXlib2FyZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFrZSB1bCBkaXYgZXRjLiBnZXQgZm9jdXMKICAgICAgICBpbnN0YW5jZS4kZWxlbWVudC5hZGQoaW5zdGFuY2UuJHBhbmVzX3dyYXApLmF0dHIoJ3RhYmluZGV4JywgJzAnKS5vbignZm9jdXMnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAga2V5Ym9hcmQuYXR0YWNoKHsKICAgICAgICAgICAgICAgIGxlZnQ6ICQucHJveHkoaW5zdGFuY2UucHJldiwgaW5zdGFuY2UpLAogICAgICAgICAgICAgICAgcmlnaHQ6ICQucHJveHkoaW5zdGFuY2UubmV4dCwgaW5zdGFuY2UpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSkub24oJ2JsdXInLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAga2V5Ym9hcmQuZGV0YWNoKCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KTsKCiAgICAgICAgaW5zdGFuY2UuJHBhbmVzLmF0dHIoJ3RhYmluZGV4JywgJzAnKS5vbignZm9jdXMnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGtleWJvYXJkLmF0dGFjaCh7CiAgICAgICAgICAgICAgICBsZWZ0OiAkLnByb3h5KGluc3RhbmNlLnByZXYsIGluc3RhbmNlKSwKICAgICAgICAgICAgICAgIHJpZ2h0OiAkLnByb3h5KGluc3RhbmNlLm5leHQsIGluc3RhbmNlKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSkub24oJ2JsdXInLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGtleWJvYXJkLmRldGFjaCgpOwogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KTsKICAgIH0pOwp9KSh3aW5kb3csIGRvY3VtZW50LCBqUXVlcnkpOwoKLy8gZWxlbWVudFRyYW5zaXRpb25zCihmdW5jdGlvbih3aW5kb3csIGRvY3VtZW50LCAkLCB1bmRlZmluZWQpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgJGRvYyA9ICQoZG9jdW1lbnQpOwoKICAgIHZhciByZXZlcnRDbGFzcyA9IGZ1bmN0aW9uKHN0cikgewogICAgICAgIHZhciBjbGFzc2VzID0gc3RyLnNwbGl0KCIgIiksCiAgICAgICAgICAgIGxlbiA9IGNsYXNzZXMubGVuZ3RoLAogICAgICAgICAgICBpbnJlID0gWydVcCcsICdEb3duJywgJ0luJywgJ091dCcsICdMZWZ0JywgJ1JpZ2h0JywgJ1RvcCcsICdCb3R0b20nXSwKICAgICAgICAgICAgb3V0cmUgPSBbJ0Rvd24nLCAnVXAnLCAnT3V0JywgJ0luJywgJ1JpZ2h0JywgJ0xlZnQnLCAnQm90dG9tJywgJ1RvcCddLAogICAgICAgICAgICBvdXRwdXQgPSAiIiwKICAgICAgICAgICAgcmUgPSAiIiwKICAgICAgICAgICAgcmVfYXJyYXkgPSBbXSwKICAgICAgICAgICAgcmVfbnVtID0gIiI7CgogICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgbGVuOyBuKyspIHsKICAgICAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBpbnJlLmxlbmd0aDsgbSsrKSB7CiAgICAgICAgICAgICAgICByZSA9IG5ldyBSZWdFeHAoaW5yZVttXSk7CiAgICAgICAgICAgICAgICBpZiAocmUudGVzdChjbGFzc2VzW25dKSkgewogICAgICAgICAgICAgICAgICAgIHJlX2FycmF5LnB1c2gobSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yICh2YXIgbCA9IDA7IGwgPCByZV9hcnJheS5sZW5ndGg7IGwrKykgewogICAgICAgICAgICAgICAgcmVfbnVtID0gcmVfYXJyYXlbbF07CiAgICAgICAgICAgICAgICBjbGFzc2VzW25dID0gY2xhc3Nlc1tuXS5yZXBsYWNlKGlucmVbcmVfbnVtXSwgcmVfbnVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IHJlX2FycmF5Lmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgICByZV9udW0gPSByZV9hcnJheVtrXTsKICAgICAgICAgICAgICAgIGNsYXNzZXNbbl0gPSBjbGFzc2VzW25dLnJlcGxhY2UocmVfbnVtLCBvdXRyZVtyZV9udW1dKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvdXRwdXQgKz0gIiAiICsgY2xhc3Nlc1tuXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICQudHJpbShvdXRwdXQpOwogICAgfTsKCiAgICB2YXIgYW5pbWF0aW9uZW5kID0gKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0OwogICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zha2VlbGVtZW50Jyk7CiAgICAgICAgdmFyIGFuaW1hdGlvbnMgPSB7CiAgICAgICAgICAgICdhbmltYXRpb24nOiAnYW5pbWF0aW9uZW5kJywKICAgICAgICAgICAgJy1vLWFuaW1hdGlvbic6ICdvQW5pbWF0aW9uRW5kJywKICAgICAgICAgICAgJy1tb3otYW5pbWF0aW9uJzogJ2FuaW1hdGlvbmVuZCcsCiAgICAgICAgICAgICctd2Via2l0LWFuaW1hdGlvbic6ICd3ZWJraXRBbmltYXRpb25FbmQnCiAgICAgICAgfTsKCiAgICAgICAgZm9yICh0IGluIGFuaW1hdGlvbnMpIHsKICAgICAgICAgICAgaWYgKGVsLnN0eWxlW3RdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhbmltYXRpb25zW3RdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9KSgpOwoKICAgIGlmIChhbmltYXRpb25lbmQgPT09IGZhbHNlKSByZXR1cm47CgogICAgJGRvYy5vbignYXNUYWJzOjppbml0JywgZnVuY3Rpb24oZXZlbnQsIGluc3RhbmNlKSB7CiAgICAgICAgaWYgKGluc3RhbmNlLm9wdGlvbnMuZWZmZWN0ID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpbnN0YW5jZS5lZmZlY3RzID0gewogICAgICAgICAgICBpbkNsYXNzOiBpbnN0YW5jZS5vcHRpb25zLmVmZmVjdCwKICAgICAgICAgICAgb3V0Q2xhc3M6IHJldmVydENsYXNzKGluc3RhbmNlLm9wdGlvbnMuZWZmZWN0KQogICAgICAgIH07CgogICAgICAgIGluc3RhbmNlLiRjb250ZW50LmNoaWxkcmVuKCkuY3NzKHsKICAgICAgICAgICAgJy13ZWJraXQtYW5pbWF0aW9uLWR1cmF0aW9uJzogaW5zdGFuY2Uub3B0aW9ucy5kdXJhdGlvbiArICdtcycsCiAgICAgICAgICAgICdhbmltYXRpb24tZHVyYXRpb24nOiBpbnN0YW5jZS5vcHRpb25zLmR1cmF0aW9uICsgJ21zJwogICAgICAgIH0pCiAgICAgICAgaW5zdGFuY2UuJGNvbnRlbnQuYWRkQ2xhc3MoJ3dpdGgtZWZmZWN0cycpOwogICAgfSk7CgogICAgJGRvYy5vbignYXNUYWJzOjpyZWFkeScsIGZ1bmN0aW9uKGV2ZW50LCBpbnN0YW5jZSkgewogICAgICAgIGlmIChpbnN0YW5jZS5vcHRpb25zLmVmZmVjdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkKHdpbmRvdykuYmluZCgncmVzaXplIG9yaWVudGF0aW9uY2hhbmdlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dChpbnN0YW5jZS5yZXNpemluZ1RpbWVvdXQpOwogICAgICAgICAgICBpbnN0YW5jZS5yZXNpemluZ1RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IGluc3RhbmNlLmdldEN1cnJlbnRQYW5lKCkub3V0ZXJIZWlnaHQodHJ1ZSk7CgogICAgICAgICAgICAgICAgaW5zdGFuY2UuJGNvbnRlbnQuaGVpZ2h0KGhlaWdodCk7CiAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICAkZG9jLm9uKCdhc1RhYnM6OmFjdGl2ZSBhc1RhYnM6OmxvYWRlZCcsIGZ1bmN0aW9uKGV2ZW50LCBpbnN0YW5jZSkgewogICAgICAgIGlmIChpbnN0YW5jZS5vcHRpb25zLmVmZmVjdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGhlaWdodCA9IGluc3RhbmNlLmdldEN1cnJlbnRQYW5lKCkub3V0ZXJIZWlnaHQodHJ1ZSk7CiAgICAgICAgaW5zdGFuY2UuJGNvbnRlbnQuaGVpZ2h0KGhlaWdodCk7CiAgICB9KTsKCiAgICAkZG9jLm9uKCdhc1RhYnM6OmFuaW1hdGlvbicsIGZ1bmN0aW9uKGV2ZW50LCBpbnN0YW5jZSwgZnJvbSwgdG8pIHsKICAgICAgICBpZiAoaW5zdGFuY2Uub3B0aW9ucy5lZmZlY3QgPT09IGZhbHNlIHx8IGluc3RhbmNlLmluaXRpYWxpemVkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgJHRvID0gaW5zdGFuY2UuJHBhbmVzLmVxKHRvKSwKICAgICAgICAgICAgJGZyb20gPSBpbnN0YW5jZS4kcGFuZXMuZXEoZnJvbSk7CgogICAgICAgIGluc3RhbmNlLmlzQW5pbWF0aW5nID0gdHJ1ZTsKCiAgICAgICAgJGZyb20ucmVtb3ZlQ2xhc3MoaW5zdGFuY2UuZWZmZWN0cy5pbkNsYXNzKS5hZGRDbGFzcyhpbnN0YW5jZS5lZmZlY3RzLm91dENsYXNzICsgJyBhbmltYXRlZCcpLm9uZShhbmltYXRpb25lbmQsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkZnJvbS5yZW1vdmVDbGFzcyhpbnN0YW5jZS5lZmZlY3RzLm91dENsYXNzICsgJyBhbmltYXRlZCcpLnJlbW92ZUNsYXNzKCdpcy1hY3RpdmUnKTsKCiAgICAgICAgICAgICR0by5yZW1vdmVDbGFzcyhpbnN0YW5jZS5lZmZlY3RzLm91dENsYXNzKS5hZGRDbGFzcygnaXMtYWN0aXZlJykuYWRkQ2xhc3MoaW5zdGFuY2UuZWZmZWN0cy5pbkNsYXNzICsgJyBhbmltYXRlZCcpLm9uZShhbmltYXRpb25lbmQsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgJHRvLnJlbW92ZUNsYXNzKGluc3RhbmNlLmVmZmVjdHMuaW5DbGFzcyk7CgogICAgICAgICAgICAgICAgaW5zdGFuY2UuaXNBbmltYXRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9KTsKfSkod2luZG93LCBkb2N1bWVudCwgalF1ZXJ5KTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 06:55:15 GMT",
                    "Content-Length": "21210",
                    "Date": "Thu, 06 Nov 2014 06:55:16 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}