{
    "url": "http://localhost:9999/balanced/balanced-js/src/balanced.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cookie manipulation (DOM-based)",
    "issueType": 5245696,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based cookie manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the value of a cookie in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will set an arbitrary value in the user's cookie.<br><br>The potential impact of the vulnerability depends on the role that the cookie plays within the application. If the cookie is used to control the behavior that results from certain user actions (for example, a 'production' versus 'demo' mode setting), then the attacker may be able to cause the user to perform unintended actions by manipulating the cookie's value. If the cookie is used to track the user's session, then the attacker may be able to perform a session fixation attack, in which they set the cookie's value to a valid token that they have obtained from the application, and then hijack the session during the victim user's subsequent interaction with the application.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cookie manipulation vulnerabilities is not to dynamically write to cookies using data that originated from any untrusted source. This behavior should never be implemented for cookies that have any role in controlling privileged actions or user sessions within the application.",
    "issueDetail": "The application may be vulnerable to DOM-based cookie manipulation. Data is read from <b>document.cookie</b> and written to <b>document.cookie</b> via the following statements:<ul><li>var cookie = document.cookie.match(/__b=([a-zA-Z0-9\\-!\\.]+)/);</li><li>cookie = cookie[1];</li><li>cookie = cookie.split('!');</li><li>var cookie_parts = cookie[0].split('.');</li><li>cookie = cookie_parts.join('.') + '!' + cookie[1];</li><li>document.cookie='__b=' + cookie + ' ;expires='+cookie_date.toUTCString();</li></ul>Because the data originates from a cookie, the application's behavior is not trivial to exploit in an attack against another user. Typically, you will need to find a means of setting an arbitrary cookie value in the victim's browser in order to exploit the vulnerability. Applications often contain \"cookie-forcing\" conditions which make this possible, and such a condition in any related domain or subdomain can potentially be used for this purpose. Nonetheless, this limitation somewhat mitigates the impact of the vulnerability. ",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/balanced/balanced-js/src/balanced.js",
                "path": "/balanced/balanced-js/src/balanced.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9iYWxhbmNlZC9iYWxhbmNlZC1qcy9zcmMvYmFsYW5jZWQuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTYzNjkNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMTE6NTk6MzkgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDExOjU5OjM2IEdNVA0KDQp2YXIgY2FwYWJpbGl0aWVzID0gewogICAgc3lzdGVtX3RpbWV6b25lOi0obmV3IERhdGUoKSkuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDYwLAogICAgdXNlcl9hZ2VudDpuYXZpZ2F0b3IudXNlckFnZW50LAogICAgbGFuZ3VhZ2U6bmF2aWdhdG9yLnVzZXJMYW5ndWFnZSB8fCBuYXZpZ2F0b3IubGFuZ3VhZ2UsCiAgICBrcDogMCwKICAgIGNsaTogMCwKICAgIGxvYWRlZDogKG5ldyBEYXRlKSAqIDEsCiAgICBzY3JlZW5fd2lkdGg6IHNjcmVlbi53aWR0aCwKICAgIHNjcmVlbl9sZW5ndGg6IHNjcmVlbi5oZWlnaHQsCiAgICBoaXN0OiB3aW5kb3cuaGlzdG9yeS5sZW5ndGgsCiAgICBjb29raWU6IChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNvb2tpZSA9IGRvY3VtZW50LmNvb2tpZS5tYXRjaCgvX19iPShbYS16QS1aMC05XC0hXC5dKykvKTsKICAgICAgICBpZighY29va2llKSB7CiAgICAgICAgICAgIGNvb2tpZSA9IChuZXcgRGF0ZSkgKiAxICsgJy4nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygpLnN1YnN0cigyKSArICcuMCEwJzsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgY29va2llID0gY29va2llWzFdOwogICAgICAgIH0KICAgICAgICBjb29raWUgPSBjb29raWUuc3BsaXQoJyEnKTsKICAgICAgICB2YXIgY29va2llX3BhcnRzID0gY29va2llWzBdLnNwbGl0KCcuJyk7CiAgICAgICAgaWYoY29va2llX3BhcnRzLmxlbmd0aCA8IDMpIHsKICAgICAgICAgICAgY29va2llX3BhcnRzWzFdID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygpLnN1YnN0cigyKTsKICAgICAgICAgICAgY29va2llX3BhcnRzWzJdID0gMDsKICAgICAgICB9CiAgICAgICAgY29va2llX3BhcnRzWzJdKys7CiAgICAgICAgY29va2llID0gY29va2llX3BhcnRzLmpvaW4oJy4nKSArICchJyArIGNvb2tpZVsxXTsKICAgICAgICB2YXIgY29va2llX2RhdGUgPSBuZXcgRGF0ZTsKICAgICAgICBjb29raWVfZGF0ZS5zZXREYXRlKGNvb2tpZV9kYXRlLmdldERhdGUoKSArIDM2NSk7CiAgICAgICAgZG9jdW1lbnQuY29va2llPSdfX2I9JyArIGNvb2tpZSArICcgO2V4cGlyZXM9Jytjb29raWVfZGF0ZS50b1VUQ1N0cmluZygpOwoKICAgICAgICByZXR1cm4gY29va2llOwogICAgfSkoKSwKfTsKCnZhciBtYXJrZXRwbGFjZV9ocmVmID0gbnVsbCwgZGlhbG9nID0gbnVsbCwKcm9vdF91cmwgPSAnaHR0cHM6Ly9hcGkuYmFsYW5jZWRwYXltZW50cy5jb20nOwoKZnVuY3Rpb24gcHJlcGFyZVBheWxvYWQoZGF0YSkgewogICAgaWYoIWRhdGEubWV0YSkgewogICAgICAgIGRhdGEubWV0YSA9IHt9OwogICAgfQogICAgY2FwYWJpbGl0aWVzLnN1Ym1pdHRlZCA9IChuZXcgRGF0ZSkgKiAxOwogICAgY2FwYWJpbGl0aWVzLnNjcm9sbFggPSB3aW5kb3cuc2Nyb2xsWDsKICAgIGNhcGFiaWxpdGllcy5zY3JvbGxZID0gd2luZG93LnNjcm9sbFk7CiAgICBmb3IodmFyIGsgaW4gY2FwYWJpbGl0aWVzKSB7CiAgICAgICAgaWYoISgnY2FwYWJpbGl0aWVzXycrayBpbiBkYXRhLm1ldGEpKSB7CiAgICAgICAgICAgIGRhdGEubWV0YVsnY2FwYWJpbGl0aWVzXycra10gPSBjYXBhYmlsaXRpZXNba107CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7Cn0KCmZ1bmN0aW9uIGFkZEV2ZW50KG9iaiwgdHlwZSwgZm4pIHsKICAgIGlmIChvYmouYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGZuLCBmYWxzZSk7CiAgICB9IGVsc2UgaWYgKG9iai5hdHRhY2hFdmVudCkgewogICAgICAgIG9ialsiZSIgKyB0eXBlICsgZm5dID0gZm47CiAgICAgICAgb2JqW3R5cGUgKyBmbl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG9ialsiZSIgKyB0eXBlICsgZm5dKHdpbmRvdy5ldmVudCk7CiAgICAgICAgfTsKICAgICAgICBvYmouYXR0YWNoRXZlbnQoIm9uIiArIHR5cGUsIG9ialt0eXBlICsgZm5dKTsKICAgIH0KfQoKdmFyIHNoaWZ0ZWQgPSBmYWxzZTsKCmZ1bmN0aW9uIGljbChlKSB7CiAgICBlID0gKGUpID8gZSA6IHdpbmRvdy5ldmVudDsKICAgIHZhciBzaGlmdG9uID0gZmFsc2U7CiAgICBpZiAoZS5zaGlmdEtleSkgewogICAgICAgIHNoaWZ0b24gPSBlLnNoaWZ0S2V5OwogICAgfSBlbHNlIGlmIChlLm1vZGlmaWVycykgewogICAgICAgIHNoaWZ0b24gPSAhIShlLm1vZGlmaWVycyAmIDQpOwogICAgfQogICAgaWYgKHNoaWZ0b24pIHsKICAgICAgICBzaGlmdGVkID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBzaGlmdGVkOwp9CgpmdW5jdGlvbiBpc0VtcHR5KG9iaikgewogICAgLy8gbnVsbCBhbmQgdW5kZWZpbmVkIGFyZSBlbXB0eQogICAgaWYgKG9iaiA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7Cn0KCmFkZEV2ZW50KHdpbmRvdywgJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkgewogICAgaWYgKCFjYXBhYmlsaXRpZXMuY2wpIHsKICAgICAgICBjYXBhYmlsaXRpZXMuY2wgPSBpY2woZSk7CiAgICB9CiAgICBjYXBhYmlsaXRpZXMua3ArKzsKfSk7CmFkZEV2ZW50KHdpbmRvdywgJ3Bhc3RlJywgZnVuY3Rpb24gKCkgewogICAgY2FwYWJpbGl0aWVzLnBzID0gdHJ1ZTsKfSk7CmFkZEV2ZW50KHdpbmRvdywgJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgY2FwYWJpbGl0aWVzLmNsaSsrOwp9KTsKCi8vLy8KLy8gUmVxdWlyZWQgZm9yIGllIDwgOSBzdXBwb3J0Ci8vLy8KaWYgKCFTdHJpbmcucHJvdG90eXBlLnRyaW0pIHsKICAgIFN0cmluZy5wcm90b3R5cGUudHJpbT1mdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOwogICAgfTsKfQoKLy8vLwovLyBZaWtlcwovLy8vCmZ1bmN0aW9uIGJ1aWxkRXJyb3JPYmplY3Qoa2V5LCBtZXNzYWdlKSB7CiAgICB2YXIgZXJyb3IgPSB7fTsKICAgIHZhciBleHRyYXMgPSB7fTsKCiAgICBpZih0eXBlb2Yga2V5ID09PSAib2JqZWN0IikgewogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBrZXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZXh0cmFzW2tleVtpXV0gPSBtZXNzYWdlOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgZXh0cmFzW2tleV0gPSBtZXNzYWdlOwogICAgfQoKICAgIGVycm9yLmRlc2NyaXB0aW9uID0gbWVzc2FnZTsKICAgIGVycm9yLmV4dHJhcyA9IGV4dHJhczsKICAgIHJldHVybiBlcnJvcjsKfQoKZnVuY3Rpb24gdmFsaWRhdGVEYXRhIChyZXF1aXJlZEtleXMsIGRhdGEsIGVycm9ycykgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXF1aXJlZEtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIga2V5ID0gcmVxdWlyZWRLZXlzW2ldOwogICAgICAgIGlmICghZGF0YSB8fCAhKGtleSBpbiBkYXRhKSB8fCAhZGF0YVtrZXldKSB7CiAgICAgICAgICAgIGVycm9ycy5wdXNoKGJ1aWxkRXJyb3JPYmplY3Qoa2V5LCAnSW52YWxpZCBmaWVsZCBbJyArIGtleSArICddIC0gTWlzc2luZyBmaWVsZCBcIicgKyBrZXkgKyAnXCInKSk7CiAgICAgICAgfQogICAgfQp9CgovLyB2YWxpZGF0aW9uIHN0dWZmIGNvcGllZCBvdXQgb2YgdGhlIG9sZCBiYWxhbmNlZC5qcwpmdW5jdGlvbiB2YWxpZGF0ZShkZXRhaWxzLCByZXF1aXJlZEtleXMsIHZhbGlkYXRpb25NZXRob2QpIHsKICAgIHZhciBlcnJvcnMgPSBbXTsKICAgIHZhbGlkYXRlRGF0YShyZXF1aXJlZEtleXMsIGRldGFpbHMsIGVycm9ycyk7CiAgICB2YXIgYWRkaXRpb25hbEVycm9ycyA9IHZhbGlkYXRpb25NZXRob2QoZGV0YWlscyk7CiAgICBlcnJvcnMgPSBlcnJvcnMuY29uY2F0KGFkZGl0aW9uYWxFcnJvcnMpOwoKICAgIC8vLy8KICAgIC8vIEluamVjdCBhZGRpdGlvbmFsIHByb3BlcnRpZXMKICAgIC8vLy8KICAgIGZvcih2YXIgaSA9IDA7IGkgPCBlcnJvcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcnJvcnNbaV0uc3RhdHVzID0gIkJhZCBSZXF1ZXN0IjsKICAgICAgICBlcnJvcnNbaV0uY2F0ZWdvcnlfY29kZSA9ICJyZXF1ZXN0IjsKICAgICAgICBlcnJvcnNbaV0uYWRkaXRpb25hbCA9IG51bGw7CiAgICAgICAgZXJyb3JzW2ldLnN0YXR1c19jb2RlID0gNDAwOwogICAgICAgIGVycm9yc1tpXS5jYXRlZ29yeV90eXBlID0gInJlcXVlc3QiOwogICAgfQoKICAgIHJldHVybiBlcnJvcnM7Cn0KCmZ1bmN0aW9uIG5vRGF0YUVycm9yKGNhbGxiYWNrLCBtZXNzYWdlKSB7CiAgICB2YXIgbSA9IChtZXNzYWdlKSA/IG1lc3NhZ2UgOiAnTm8gZGF0YSBzdXBwbGllZCc7CgogICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgIHRocm93IG07CiAgICB9IGVsc2UgewogICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgICAgZXJyb3JzOiBbewogICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG0sCiAgICAgICAgICAgICAgICBzdGF0dXM6ICJCYWQgUmVxdWVzdCIsCiAgICAgICAgICAgICAgICBjYXRlZ29yeV9jb2RlOiAicmVxdWVzdCIsCiAgICAgICAgICAgICAgICBhZGRpdGlvbmFsOiBudWxsLAogICAgICAgICAgICAgICAgc3RhdHVzX2NvZGU6IDQwMCwKICAgICAgICAgICAgICAgIGNhdGVnb3J5X3R5cGU6ICJyZXF1ZXN0IiwKICAgICAgICAgICAgICAgIGV4dHJhczoge30KICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIHN0YXR1c19jb2RlOiA0MDAKICAgICAgICB9KTsKICAgIH0KfQoKdmFyIGNjID0gewoKICAgIGlzQ2FyZE51bWJlclZhbGlkOmZ1bmN0aW9uIChjYXJkTnVtYmVyKSB7CiAgICAgICAgaWYgKCFjYXJkTnVtYmVyKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgY2FyZE51bWJlciA9IChjYXJkTnVtYmVyICsgJycpLnJlcGxhY2UoL1xEKy9nLCAnJykuc3BsaXQoJycpLnJldmVyc2UoKTsKICAgICAgICBpZiAoIWNhcmROdW1iZXIubGVuZ3RoIHx8IGNhcmROdW1iZXIubGVuZ3RoIDwgMTIpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgdG90YWwgPSAwLCBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjYXJkTnVtYmVyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNhcmROdW1iZXJbaV0gPSBwYXJzZUludChjYXJkTnVtYmVyW2ldLCAxMCk7CiAgICAgICAgICAgIHRvdGFsICs9IGkgJSAyID8gMiAqIGNhcmROdW1iZXJbaV0gLSAoY2FyZE51bWJlcltpXSA+IDQgPyA5IDogMCkgOiBjYXJkTnVtYmVyW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKHRvdGFsICUgMTApID09PSAwOwogICAgfSwKICAgIGNhcmRUeXBlOmZ1bmN0aW9uIChjYXJkTnVtYmVyKSB7CiAgICAgICAgdmFyIHAgPSB7fTsKICAgICAgICBwWyc1MSddID0gcFsnNTInXSA9IHBbJzUzJ10gPSBwWyc1NCddID0gcFsnNTUnXSA9ICdNYXN0ZXJjYXJkJzsKICAgICAgICBwWyczNCddID0gcFsnMzcnXSA9ICdBbWVyaWNhbiBFeHByZXNzJzsKICAgICAgICBwWyc0J10gPSAnVklTQSc7CiAgICAgICAgcFsnNiddID0gJ0Rpc2NvdmVyIENhcmQnOwogICAgICAgIHBbJzM1J10gPSAnSkNCJzsKICAgICAgICBwWyczMCddID0gcFsnMzYnXSA9IHBbJzM4J10gPSAnRGluZXJzIENsdWInOwoKICAgICAgICBpZiAoY2FyZE51bWJlcikgewogICAgICAgICAgICBjYXJkTnVtYmVyID0gY2FyZE51bWJlci50b1N0cmluZygpLnRyaW0oKTsKCiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gcCkgewogICAgICAgICAgICAgICAgaWYgKGNhcmROdW1iZXIuaW5kZXhPZihrKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwW2tdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfSwKICAgIGlzQ1ZWVmFsaWQ6ZnVuY3Rpb24gKGNhcmROdW1iZXIsIGN2dikgewogICAgICAgIHZhciBjYXJkVHlwZSA9IGNjLmNhcmRUeXBlKGNhcmROdW1iZXIpOwogICAgICAgIGlmICghY2FyZFR5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgcmVxdWlyZWRMZW5ndGggPSAoY2FyZFR5cGUgPT09ICdBbWVyaWNhbiBFeHByZXNzJyA/IDQgOiAzKTsKCiAgICAgICAgaWYodHlwZW9mIGN2diA9PT0gInN0cmluZyIgfHwgdHlwZW9mIGN2diA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgaWYoY3Z2LnRvU3RyaW5nKCkucmVwbGFjZSgvXEQrL2csICcnKS5sZW5ndGggPT09IHJlcXVpcmVkTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIC8vIERlcHJlY2F0ZWQuIEFsaWFzZWQgdG8gaXNDVlZWYWxpZAogICAgaXNTZWN1cml0eUNvZGVWYWxpZDpmdW5jdGlvbiAoY2FyZE51bWJlciwgc2VjdXJpdHlDb2RlKSB7CiAgICAgIHJldHVybiBjYy5pc0NWVlZhbGlkKGNhcmROdW1iZXIsIHNlY3VyaXR5Q29kZSk7CiAgICB9LAogICAgaXNFeHBpcnlWYWxpZDpmdW5jdGlvbiAoZXhwaXJ5TW9udGgsIGV4cGlyeVllYXIpIHsKICAgICAgICBpZiAoIWV4cGlyeU1vbnRoIHx8ICFleHBpcnlZZWFyKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZXhwaXJ5TW9udGggPSBwYXJzZUludChleHBpcnlNb250aCwgMTApOwogICAgICAgIGV4cGlyeVllYXIgPSBwYXJzZUludChleHBpcnlZZWFyLCAxMCk7CiAgICAgICAgaWYgKGlzTmFOKGV4cGlyeU1vbnRoKSB8fCBpc05hTihleHBpcnlZZWFyKSB8fCBleHBpcnlNb250aCA+IDEyIHx8IGV4cGlyeU1vbnRoIDwgMSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7CiAgICAgICAgcmV0dXJuICEodG9kYXkuZ2V0RnVsbFllYXIoKSA+IGV4cGlyeVllYXIgfHwKICAgICAgICAgICAgICAgICAodG9kYXkuZ2V0RnVsbFllYXIoKSA9PT0gZXhwaXJ5WWVhciAmJiB0b2RheS5nZXRNb250aCgpID49IGV4cGlyeU1vbnRoKSk7CiAgICB9LAogICAgdmFsaWRhdGU6ZnVuY3Rpb24gKGNhcmREYXRhKSB7CiAgICAgICAgaWYgKGNhcmREYXRhLm51bWJlcikgewogICAgICAgICAgICBjYXJkRGF0YS5udW1iZXIgPSBjYXJkRGF0YS5udW1iZXIudG9TdHJpbmcoKS50cmltKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbnVtYmVyID0gY2FyZERhdGEubnVtYmVyLAogICAgICAgIGN2diA9IGNhcmREYXRhLmN2diwKICAgICAgICBleHBpcnlNb250aCA9IGNhcmREYXRhLmV4cGlyYXRpb25fbW9udGgsCiAgICAgICAgZXhwaXJ5WWVhciA9IGNhcmREYXRhLmV4cGlyYXRpb25feWVhcjsKCiAgICAgICAgdmFyIGVycm9ycyA9IFtdOwogICAgICAgIGlmICghY2MuaXNDYXJkTnVtYmVyVmFsaWQobnVtYmVyKSkgewogICAgICAgICAgICBlcnJvcnMucHVzaChidWlsZEVycm9yT2JqZWN0KCdudW1iZXInLCAnSW52YWxpZCBmaWVsZCBbbnVtYmVyXSAtICInICsgbnVtYmVyICsgJyIgaXMgbm90IGEgdmFsaWQgY3JlZGl0IGNhcmQgbnVtYmVyJykpOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIGN2diAhPT0gJ3VuZGVmaW5lZCcgJiYgY3Z2ICE9PSBudWxsICYmICFjYy5pc0NWVlZhbGlkKG51bWJlciwgY3Z2KSkgewogICAgICAgICAgICBlcnJvcnMucHVzaChidWlsZEVycm9yT2JqZWN0KCdjdnYnLCAnSW52YWxpZCBmaWVsZCBbY3Z2XSAtICInICsgY3Z2ICsgJyIgaXMgbm90IGEgdmFsaWQgY3JlZGl0IGNhcmQgc2VjdXJpdHkgY29kZScpKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYy5pc0V4cGlyeVZhbGlkKGV4cGlyeU1vbnRoLCBleHBpcnlZZWFyKSkgewogICAgICAgICAgICBlcnJvcnMucHVzaChidWlsZEVycm9yT2JqZWN0KFsnZXhwaXJhdGlvbl9tb250aCcsICdleHBpcmF0aW9uX3llYXInXSwgJ0ludmFsaWQgZmllbGQgW2V4cGlyYXRpb25fbW9udGgsZXhwaXJhdGlvbl95ZWFyXSAtICInICsgZXhwaXJ5TW9udGggKyAnLScgKyBleHBpcnlZZWFyICsgJyIgaXMgbm90IGEgdmFsaWQgY3JlZGl0IGNhcmQgZXhwaXJhdGlvbiBkYXRlJykpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGVycm9yczsKICAgIH0sCiAgICBjcmVhdGU6ZnVuY3Rpb24gKGRhdGEsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICAgIG5vRGF0YUVycm9yKGNhbGxiYWNrKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgcmVxdWlyZWRLZXlzID0gWydudW1iZXInLCAnZXhwaXJhdGlvbl9tb250aCcsICdleHBpcmF0aW9uX3llYXInXTsKICAgICAgICB2YXIgZXJyb3JzID0gdmFsaWRhdGUoZGF0YSwgcmVxdWlyZWRLZXlzLCBjYy52YWxpZGF0ZSk7CgogICAgICAgIGlmICghaXNFbXB0eShlcnJvcnMpKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgICAgICAgIGVycm9yczogZXJyb3JzLAogICAgICAgICAgICAgICAgc3RhdHVzX2NvZGU6IDQwMAogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBqc29ucChtYWtlX3VybCgnL2pzb25wL2NhcmRzJywgcHJlcGFyZVBheWxvYWQoZGF0YSkpLCBtYWtlX2NhbGxiYWNrKGNhbGxiYWNrKSk7CiAgICAgICAgfQogICAgfQp9OwoKdmFyIGVtID0gewogICAgdmFsaWRhdGU6ZnVuY3Rpb24gKGVtYWlsQWRkcmVzcykgewogICAgICAgIGlmKGVtYWlsQWRkcmVzcyAmJiBlbWFpbEFkZHJlc3MubWF0Y2goL1thLXowLTkhIyQlJicqK1wvPT9cXl9ge3x9flwtXSsoPzpcLlthLXowLTkhIyQlJicqK1wvPT9cXl9ge3x9flwtXSspKkAoPzpbYS16MC05XSg/OlthLXowLTlcLV0qW2EtejAtOV0pP1wuKStbYS16MC05XSg/OlthLXowLTlcLV0qW2EtejAtOV0pPy9pKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfTsKCnZhciBiYSA9IHsKICAgIHR5cGVzOiBbJ3NhdmluZ3MnLCAnY2hlY2tpbmcnXSwKICAgIHZhbGlkYXRlOmZ1bmN0aW9uIChhY2NvdW50RGF0YSkgewogICAgICAgIHZhciBub3VuID0gKCdyb3V0aW5nX251bWJlcicgaW4gYWNjb3VudERhdGEpID8gJ3JvdXRpbmdfbnVtYmVyJyA6ICdiYW5rX2NvZGUnOwogICAgICAgIHZhciBiYW5rQ29kZSA9IGFjY291bnREYXRhW25vdW5dOwogICAgICAgIHZhciBlcnJvcnMgPSBbXTsKICAgICAgICBpZiAoIWJhLmlzUm91dGluZ051bWJlclZhbGlkKGJhbmtDb2RlKSkgewogICAgICAgICAgICBlcnJvcnMucHVzaChidWlsZEVycm9yT2JqZWN0KG5vdW4sICdJbnZhbGlkIGZpZWxkIFsnICsgbm91biArICddIC0gIicgKyBiYW5rQ29kZSArICciIGlzIG5vdCBhIHZhbGlkICcgKyBub3VuLnJlcGxhY2UoJ18nLCAnICcpKSk7CiAgICAgICAgfQogICAgICAgIHZhciBhY2NvdW50X3R5cGUgPSBhY2NvdW50RGF0YS50eXBlIHx8IGFjY291bnREYXRhLmFjY291bnRfdHlwZTsKICAgICAgICB2YXIgdHlwZV9uYW1lID0gJ3R5cGUnIGluIGFjY291bnREYXRhID8gJ3R5cGUnIDogJ2FjY291bnRfdHlwZSc7CiAgICAgICAgaWYgKGFjY291bnREYXRhW3R5cGVfbmFtZV0gJiYgIWJhLnZhbGlkYXRlVHlwZShhY2NvdW50X3R5cGUpKSB7CiAgICAgICAgICAgIGVycm9ycy5wdXNoKGJ1aWxkRXJyb3JPYmplY3QodHlwZV9uYW1lLCAnSW52YWxpZCBmaWVsZCBbJyArIHR5cGVfbmFtZSArICddIC0gIicgKyBhY2NvdW50X3R5cGUgKyAnIiBtdXN0IGJlIG9uZSBvZjogIicgKyBiYS50eXBlcy5qb2luKCciLCAiJykgKyAnIicpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVycm9yczsKICAgIH0sCiAgICBpc1JvdXRpbmdOdW1iZXJWYWxpZDpmdW5jdGlvbiAocm91dGluZ051bWJlcikgewogICAgICAgIGlmICghcm91dGluZ051bWJlcikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJvdXRpbmdOdW1iZXIgPSByb3V0aW5nTnVtYmVyLnRvU3RyaW5nKCkubWF0Y2goL1xkKy9nKTsKCiAgICAgICAgaWYgKCFyb3V0aW5nTnVtYmVyKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJvdXRpbmdOdW1iZXIgPSByb3V0aW5nTnVtYmVyLmpvaW4oJycpOwoKICAgICAgICBpZiAoIXJvdXRpbmdOdW1iZXIgfHwgcm91dGluZ051bWJlci5sZW5ndGggIT09IDkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGEgPSByb3V0aW5nTnVtYmVyLnRvU3RyaW5nKCkuc3BsaXQoJycpOwogICAgICAgIHZhciBkID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGQucHVzaChwYXJzZUludChhW2ldLCAxMCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZFs4XSA9PT0gKAogICAgICAgICAgICA3ICogKGRbMF0gKyBkWzNdICsgZFs2XSkgKwogICAgICAgICAgICAgICAgMyAqIChkWzFdICsgZFs0XSArIGRbN10pICsKICAgICAgICAgICAgICAgIDkgKiAoZFsyXSArIGRbNV0pCiAgICAgICAgKSAlIDEwOwogICAgfSwKICAgIC8vIERlcHJlY2F0ZWQuIEFsaWFzZWQgdG8gaXNSb3V0aW5nTnVtYmVyVmFsaWQKICAgIHZhbGlkYXRlUm91dGluZ051bWJlcjpmdW5jdGlvbiAocm91dGluZ051bWJlcikgewogICAgICAgIHJldHVybiBiYS5pc1JvdXRpbmdOdW1iZXJWYWxpZChyb3V0aW5nTnVtYmVyKTsKICAgIH0sCiAgICBsb29rdXBSb3V0aW5nTnVtYmVyOmZ1bmN0aW9uIChyb3V0aW5nTnVtYmVyLCBjYWxsYmFjaykgewogICAgICAgIGlmICghcm91dGluZ051bWJlcikgewogICAgICAgICAgICBub0RhdGFFcnJvcihjYWxsYmFjayk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHVyaSA9ICcvYmFua19hY2NvdW50cy9yb3V0aW5nX251bWJlcnMvJyArIHJvdXRpbmdOdW1iZXI7CiAgICAgICAganNvbnAobWFrZV91cmwodXJpLCBudWxsLCBtYWtlX2NhbGxiYWNrKGNhbGxiYWNrKSkpOwogICAgfSwKICAgIHZhbGlkYXRlVHlwZTogZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICBpZiAoIXR5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiAhIS9zYXZpbmdzfGNoZWNraW5nLy5leGVjKHR5cGUpOwogICAgfSwKICAgIGNyZWF0ZTpmdW5jdGlvbiAoZGF0YSwgY2FsbGJhY2spIHsKICAgICAgICBpZiAoIWRhdGEpIHsKICAgICAgICAgICAgbm9EYXRhRXJyb3IoY2FsbGJhY2spOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciByZXF1aXJlZEtleXMgPSBbJ25hbWUnLCAnYWNjb3VudF9udW1iZXInLCAncm91dGluZ19udW1iZXInXTsKICAgICAgICB2YXIgZXJyb3JzID0gdmFsaWRhdGUoZGF0YSwgcmVxdWlyZWRLZXlzLCBiYS52YWxpZGF0ZSk7CgogICAgICAgIGlmICghaXNFbXB0eShlcnJvcnMpKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgICAgICAgIGVycm9yczogZXJyb3JzLAogICAgICAgICAgICAgICAgc3RhdHVzX2NvZGU6IDQwMAogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoJ3R5cGUnIGluIGRhdGEgJiYgISdhY2NvdW50X3R5cGUnIGluIGRhdGEpIHsKICAgICAgICAgICAgICAgIGRhdGEuYWNjb3VudF90eXBlID0gZGF0YS50eXBlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGpzb25wKG1ha2VfdXJsKCcvanNvbnAvYmFua19hY2NvdW50cycsIHByZXBhcmVQYXlsb2FkKGRhdGEpKSwgbWFrZV9jYWxsYmFjayhjYWxsYmFjaykpOwogICAgICAgIH0KICAgIH0KfTsKCnZhciBlYSA9IHsKICAgIHByb3ZpZGVyczogewogIC8vIFRPRE86IHRoaXMgaXMgY3VycmVudGx5IGhhcmQgY29kZWQKICAvLyB1c2luZyBiYWxhbmNlZC5jb25maWd1cmUoJy9tYXJrZXRwbGFjZS9NUGFzZGZhc2RmJykgd2lsbAogIC8vIGdldCB0aGUgcmlnaHQgY29uZmlncyBpbiB0aGUgZnV0dXJlCiAgICAgICAgJ2NvaW5iYXNlJzogewogICAgICAgICAgICB1cmw6ICdodHRwczovL2NvaW5iYXNlLmNvbS9vYXV0aC9hdXRob3JpemUnLAogICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlX3R5cGU6ICdjb2RlJywKICAgICAgICAgICAgICAgIGNsaWVudF9pZDogJzA1MGY0Yzg1MjMxYTUxYzE0N2EzZmIwMTFlMDEyNzU1ZDgxY2RiNDk5Y2M1MGI1MzU0YjdiY2RmOWJmODA1YWQnLAogICAgICAgICAgICAgICAgcmVkaXJlY3RfdXJpOiAnaHR0cHM6Ly9qcy5iYWxhbmNlZHBheW1lbnRzLmNvbS9jYWxsYmFjay5odG1sJywKICAgICAgICAgICAgICAgIHNjb3BlOiAnc2VuZCcKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBwcm92aWRlcl9uYW1lOiBudWxsLAogICAgY2FsbGJhY2s6IG51bGwsCiAgICBjcmVhdGU6IGZ1bmN0aW9uKHByb3ZpZGVyX25hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIHByb3ZpZGVyID0gZWEucHJvdmlkZXJzW3Byb3ZpZGVyX25hbWVdOwogICAgICAgIHZhciB1cmwgPSBwcm92aWRlci51cmw7CiAgICAgICAgdmFyIHBhcmFtcyA9IHByb3ZpZGVyLnBhcmFtczsKICAgICAgICB2YXIgcGFyYW1zX2FycmF5ID0gW107CgogICAgICAgIGVhLnByb3ZpZGVyX25hbWUgPSBwcm92aWRlcl9uYW1lOwogICAgICAgIGVhLmNhbGxiYWNrID0gY2FsbGJhY2s7CgogICAgICAgIGlmIChwYXJhbXMpIHsKICAgICAgICAgICAgZm9yICh2YXIgcGFyYW0gaW4gcGFyYW1zKSB7CiAgICAgICAgICAgICAgICBwYXJhbXNfYXJyYXkucHVzaChwYXJhbSArICI9IiArIHBhcmFtc1twYXJhbV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVybCA9IHVybCArICc/JyArIHBhcmFtc19hcnJheS5qb2luKCcmJyk7CiAgICAgICAgfQoKICAgICAgICBkaWFsb2cgPSB3aW5kb3cub3Blbih1cmwsICIiLCAidG9wPSIgKyAod2luZG93Lm91dGVySGVpZ2h0LzIgLSAyNzUpICsgIiwgbGVmdD0iICsgKHdpbmRvdy5vdXRlcldpZHRoLzIgLSAyNTApICsgIiwgd2lkdGg9NTAwLCBoZWlnaHQ9NTUwIik7CiAgICB9LAogICAgY29uZmlndXJlOiBmdW5jdGlvbiAoKSB7CiAgLypqc29ucChtYWtlX3VybCgnL2pzb25wLycrbWFya2V0cGxhY2VfaHJlZisnL2NvbmZpZ3MnLCB7fSksIGZ1bmN0aW9uIChqc29uKSB7CiAgICAgIGVhLm5ldHdvcmsgPSBqc29uOwogIH0pOyovCiAgICB9Cn07CgphZGRFdmVudCh3aW5kb3csICdtZXNzYWdlJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZihldmVudC5vcmlnaW4gIT09ICJodHRwczovL2pzLmJhbGFuY2VkcGF5bWVudHMuY29tIikgewogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIWV2ZW50LmRhdGEpIHsKICAgICAgICBub0RhdGFFcnJvcihlYS5jYWxsYmFjayk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBkYXRhID0gZXZlbnQuZGF0YTsKICAgIGRhdGEudG9rZW4gPSBldmVudC5kYXRhLnRva2VuIHx8IGV2ZW50LmRhdGEuY29kZTsKICAgIGRhdGEucHJvdmlkZXIgPSBlYS5wcm92aWRlcl9uYW1lOwoKICAgIGpzb25wKG1ha2VfdXJsKCcvanNvbnAvZXh0ZXJuYWxfYWNjb3VudHMnLCBkYXRhKSwgbWFrZV9jYWxsYmFjayhlYS5jYWxsYmFjaykpOwoKICAgIGlmKGRpYWxvZykKICAgICAgICBkaWFsb2cuY2xvc2UoKTsKfSk7CgpmdW5jdGlvbiBqc29ucChwYXRoLCBjYWxsYmFjaykgewogICAgdmFyIGZ1bmN0ID0gImJhbGFuY2VkX2pzb25wXyIrTWF0aC5yYW5kb20oKS50b1N0cmluZygpLnN1YnN0cigyKTsKICAgIHZhciB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgIHRhZy50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7CiAgICB0YWcuYXN5bmMgPSB0cnVlOwogICAgdGFnLnNyYyA9IHBhdGgucmVwbGFjZSgne2NhbGxiYWNrfScsIGZ1bmN0KTsKICAgIHZhciB3aGVyZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTsKICAgIHdoZXJlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRhZywgd2hlcmUpOwogICAgd2luZG93W2Z1bmN0XSA9IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgIGlmKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiBjb25zb2xlLmVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRhZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRhZyk7CiAgICB9Owp9CgpmdW5jdGlvbiBtYWtlX3VybChwYXRoLCBkYXRhKSB7CiAgICByZXR1cm4gcm9vdF91cmwgKyBwYXRoICsgIj9jYWxsYmFjaz17Y2FsbGJhY2t9JmRhdGE9IiArIGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShkYXRhKSk7Cn0KCmZ1bmN0aW9uIG1ha2VfY2FsbGJhY2soY2FsbGJhY2spIHsKICAgIHZhciBjYWxsZWRfYmFjayA9IGZhbHNlOwoKICAgIGZ1bmN0aW9uIHJldChkYXRhKSB7CiAgICAgICAgaWYoY2FsbGVkX2JhY2spIHsgcmV0dXJuOyB9CgogICAgICAgIGNhbGxlZF9iYWNrID0gdHJ1ZTsKCiAgICAgICAgaWYoIWRhdGEgfHwgIWRhdGEuc3RhdHVzKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgICAgICAgIGVycm9yczogW3sKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogIlVuYWJsZSB0byBjb25uZWN0IHRvIHRoZSBiYWxhbmNlZCBzZXJ2ZXJzIiwKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3IiLAogICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5X2NvZGU6ICJzZXJ2ZXItZXJyb3IiLAogICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzX2NvZGU6IDUwMCwKICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeV90eXBlOiAic2VydmVyLWVycm9yIiwKICAgICAgICAgICAgICAgICAgICBleHRyYXM6IHt9CiAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgIHN0YXR1c19jb2RlOiA1MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBib2R5ID0gSlNPTi5wYXJzZShkYXRhLmJvZHkpOwoKICAgICAgICAvLy8vCiAgICAgICAgLy8gQXBwZW5kIHRoZSBzdGF0dXMKICAgICAgICAvLy8vCiAgICAgICAgaWYodHlwZW9mIGRhdGEuc3RhdHVzICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICBib2R5LnN0YXR1c19jb2RlID0gZGF0YS5zdGF0dXM7CiAgICAgICAgfQoKICAgICAgICBjYWxsYmFjayhib2R5KTsKICAgIH0KCiAgICBzZXRUaW1lb3V0KHJldCwgNjAwMDApOwogICAgcmV0dXJuIHJldDsKfQoKLy8vLwovLyBMb2FkIEpTT04gcGFyc2VyIGZvciBvbGQgYnJvd3NlcnMKLy8vLwppZih0eXBlb2YgSlNPTiAhPT0gJ29iamVjdCcpIHsKICAgIGpzb25wKCdodHRwczovL2pzLmJhbGFuY2VkcGF5bWVudHMuY29tL2pzb24yLmpzJyk7Cn0KCnZhciBiYWxhbmNlZCA9IGdsb2JhbC5iYWxhbmNlZCA9IHsKICAgIGNhcmQ6IGNjLAogICAgYmFua0FjY291bnQ6IGJhLAogICAgZXh0ZXJuYWxBY2NvdW50OiBlYSwKICAgIGVtYWlsQWRkcmVzczogZW0sCiAgICBpbml0OiBmdW5jdGlvbiAoYXJncykgewogICAgICAgIGlmKHR5cGVvZiBhcmdzID09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIC8vIGdvaW5nIHRvIGJlIHRoZSBtYXJrZXRwbGFjZSBocmVmIHRvIGNvbmZpZ3VyZSB0aGUgdG9rZW5zCiAgICAgICAgICAgIC8vIG5vdCByZXF1aXJlZCBpZiBvbmx5IHRva2VuaXppbmcgY2FyZHMgYW5kIGJhbmsgYWNjb3VudHMKICAgICAgICAgICAgbWFya2V0cGxhY2VfaHJlZiA9IGFyZ3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYoYXJncyAmJiAnc2VydmVyJyBpbiBhcmdzKSB7CiAgICAgICAgICAgICAgICByb290X3VybCA9IGFyZ3Muc2VydmVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGFyZ3MgJiYgJ21hcmtldHBsYWNlX2hyZWYnIGluIGFyZ3MpIHsKICAgICAgICAgICAgICAgIG1hcmtldHBsYWNlX2hyZWYgPSBhcmdzLm1hcmtldHBsYWNlX2hyZWY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoYXJncyAmJiAncHJvdmlkZXJzJyBpbiBhcmdzKSB7CiAgICAgICAgICAgICAgICBlYS5wcm92aWRlcnMgPSBhcmdzLnByb3ZpZGVyczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBUT0RPOiBtYWtlIGl0IGdyYWIgdGhlIGNvbmZpZ3VyYXRpb24gZm9yIHRoaXMgbWFya2V0cGxhY2UKICAgIH0KfTsK",
                "body": "dmFyIGNhcGFiaWxpdGllcyA9IHsKICAgIHN5c3RlbV90aW1lem9uZTotKG5ldyBEYXRlKCkpLmdldFRpbWV6b25lT2Zmc2V0KCkgLyA2MCwKICAgIHVzZXJfYWdlbnQ6bmF2aWdhdG9yLnVzZXJBZ2VudCwKICAgIGxhbmd1YWdlOm5hdmlnYXRvci51c2VyTGFuZ3VhZ2UgfHwgbmF2aWdhdG9yLmxhbmd1YWdlLAogICAga3A6IDAsCiAgICBjbGk6IDAsCiAgICBsb2FkZWQ6IChuZXcgRGF0ZSkgKiAxLAogICAgc2NyZWVuX3dpZHRoOiBzY3JlZW4ud2lkdGgsCiAgICBzY3JlZW5fbGVuZ3RoOiBzY3JlZW4uaGVpZ2h0LAogICAgaGlzdDogd2luZG93Lmhpc3RvcnkubGVuZ3RoLAogICAgY29va2llOiAoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjb29raWUgPSBkb2N1bWVudC5jb29raWUubWF0Y2goL19fYj0oW2EtekEtWjAtOVwtIVwuXSspLyk7CiAgICAgICAgaWYoIWNvb2tpZSkgewogICAgICAgICAgICBjb29raWUgPSAobmV3IERhdGUpICogMSArICcuJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKS5zdWJzdHIoMikgKyAnLjAhMCc7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGNvb2tpZSA9IGNvb2tpZVsxXTsKICAgICAgICB9CiAgICAgICAgY29va2llID0gY29va2llLnNwbGl0KCchJyk7CiAgICAgICAgdmFyIGNvb2tpZV9wYXJ0cyA9IGNvb2tpZVswXS5zcGxpdCgnLicpOwogICAgICAgIGlmKGNvb2tpZV9wYXJ0cy5sZW5ndGggPCAzKSB7CiAgICAgICAgICAgIGNvb2tpZV9wYXJ0c1sxXSA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKS5zdWJzdHIoMik7CiAgICAgICAgICAgIGNvb2tpZV9wYXJ0c1syXSA9IDA7CiAgICAgICAgfQogICAgICAgIGNvb2tpZV9wYXJ0c1syXSsrOwogICAgICAgIGNvb2tpZSA9IGNvb2tpZV9wYXJ0cy5qb2luKCcuJykgKyAnIScgKyBjb29raWVbMV07CiAgICAgICAgdmFyIGNvb2tpZV9kYXRlID0gbmV3IERhdGU7CiAgICAgICAgY29va2llX2RhdGUuc2V0RGF0ZShjb29raWVfZGF0ZS5nZXREYXRlKCkgKyAzNjUpOwogICAgICAgIGRvY3VtZW50LmNvb2tpZT0nX19iPScgKyBjb29raWUgKyAnIDtleHBpcmVzPScrY29va2llX2RhdGUudG9VVENTdHJpbmcoKTsKCiAgICAgICAgcmV0dXJuIGNvb2tpZTsKICAgIH0pKCksCn07Cgp2YXIgbWFya2V0cGxhY2VfaHJlZiA9IG51bGwsIGRpYWxvZyA9IG51bGwsCnJvb3RfdXJsID0gJ2h0dHBzOi8vYXBpLmJhbGFuY2VkcGF5bWVudHMuY29tJzsKCmZ1bmN0aW9uIHByZXBhcmVQYXlsb2FkKGRhdGEpIHsKICAgIGlmKCFkYXRhLm1ldGEpIHsKICAgICAgICBkYXRhLm1ldGEgPSB7fTsKICAgIH0KICAgIGNhcGFiaWxpdGllcy5zdWJtaXR0ZWQgPSAobmV3IERhdGUpICogMTsKICAgIGNhcGFiaWxpdGllcy5zY3JvbGxYID0gd2luZG93LnNjcm9sbFg7CiAgICBjYXBhYmlsaXRpZXMuc2Nyb2xsWSA9IHdpbmRvdy5zY3JvbGxZOwogICAgZm9yKHZhciBrIGluIGNhcGFiaWxpdGllcykgewogICAgICAgIGlmKCEoJ2NhcGFiaWxpdGllc18nK2sgaW4gZGF0YS5tZXRhKSkgewogICAgICAgICAgICBkYXRhLm1ldGFbJ2NhcGFiaWxpdGllc18nK2tdID0gY2FwYWJpbGl0aWVzW2tdOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhOwp9CgpmdW5jdGlvbiBhZGRFdmVudChvYmosIHR5cGUsIGZuKSB7CiAgICBpZiAob2JqLmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICBvYmouYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmbiwgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgICBvYmpbImUiICsgdHlwZSArIGZuXSA9IGZuOwogICAgICAgIG9ialt0eXBlICsgZm5dID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBvYmpbImUiICsgdHlwZSArIGZuXSh3aW5kb3cuZXZlbnQpOwogICAgICAgIH07CiAgICAgICAgb2JqLmF0dGFjaEV2ZW50KCJvbiIgKyB0eXBlLCBvYmpbdHlwZSArIGZuXSk7CiAgICB9Cn0KCnZhciBzaGlmdGVkID0gZmFsc2U7CgpmdW5jdGlvbiBpY2woZSkgewogICAgZSA9IChlKSA/IGUgOiB3aW5kb3cuZXZlbnQ7CiAgICB2YXIgc2hpZnRvbiA9IGZhbHNlOwogICAgaWYgKGUuc2hpZnRLZXkpIHsKICAgICAgICBzaGlmdG9uID0gZS5zaGlmdEtleTsKICAgIH0gZWxzZSBpZiAoZS5tb2RpZmllcnMpIHsKICAgICAgICBzaGlmdG9uID0gISEoZS5tb2RpZmllcnMgJiA0KTsKICAgIH0KICAgIGlmIChzaGlmdG9uKSB7CiAgICAgICAgc2hpZnRlZCA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gc2hpZnRlZDsKfQoKZnVuY3Rpb24gaXNFbXB0eShvYmopIHsKICAgIC8vIG51bGwgYW5kIHVuZGVmaW5lZCBhcmUgZW1wdHkKICAgIGlmIChvYmogPT0gbnVsbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwp9CgphZGRFdmVudCh3aW5kb3csICdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHsKICAgIGlmICghY2FwYWJpbGl0aWVzLmNsKSB7CiAgICAgICAgY2FwYWJpbGl0aWVzLmNsID0gaWNsKGUpOwogICAgfQogICAgY2FwYWJpbGl0aWVzLmtwKys7Cn0pOwphZGRFdmVudCh3aW5kb3csICdwYXN0ZScsIGZ1bmN0aW9uICgpIHsKICAgIGNhcGFiaWxpdGllcy5wcyA9IHRydWU7Cn0pOwphZGRFdmVudCh3aW5kb3csICdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgIGNhcGFiaWxpdGllcy5jbGkrKzsKfSk7CgovLy8vCi8vIFJlcXVpcmVkIGZvciBpZSA8IDkgc3VwcG9ydAovLy8vCmlmICghU3RyaW5nLnByb3RvdHlwZS50cmltKSB7CiAgICBTdHJpbmcucHJvdG90eXBlLnRyaW09ZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzK3xccyskL2csICcnKTsKICAgIH07Cn0KCi8vLy8KLy8gWWlrZXMKLy8vLwpmdW5jdGlvbiBidWlsZEVycm9yT2JqZWN0KGtleSwgbWVzc2FnZSkgewogICAgdmFyIGVycm9yID0ge307CiAgICB2YXIgZXh0cmFzID0ge307CgogICAgaWYodHlwZW9mIGtleSA9PT0gIm9iamVjdCIpIHsKICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwga2V5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGV4dHJhc1trZXlbaV1dID0gbWVzc2FnZTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGV4dHJhc1trZXldID0gbWVzc2FnZTsKICAgIH0KCiAgICBlcnJvci5kZXNjcmlwdGlvbiA9IG1lc3NhZ2U7CiAgICBlcnJvci5leHRyYXMgPSBleHRyYXM7CiAgICByZXR1cm4gZXJyb3I7Cn0KCmZ1bmN0aW9uIHZhbGlkYXRlRGF0YSAocmVxdWlyZWRLZXlzLCBkYXRhLCBlcnJvcnMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVxdWlyZWRLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGtleSA9IHJlcXVpcmVkS2V5c1tpXTsKICAgICAgICBpZiAoIWRhdGEgfHwgIShrZXkgaW4gZGF0YSkgfHwgIWRhdGFba2V5XSkgewogICAgICAgICAgICBlcnJvcnMucHVzaChidWlsZEVycm9yT2JqZWN0KGtleSwgJ0ludmFsaWQgZmllbGQgWycgKyBrZXkgKyAnXSAtIE1pc3NpbmcgZmllbGQgXCInICsga2V5ICsgJ1wiJykpOwogICAgICAgIH0KICAgIH0KfQoKLy8gdmFsaWRhdGlvbiBzdHVmZiBjb3BpZWQgb3V0IG9mIHRoZSBvbGQgYmFsYW5jZWQuanMKZnVuY3Rpb24gdmFsaWRhdGUoZGV0YWlscywgcmVxdWlyZWRLZXlzLCB2YWxpZGF0aW9uTWV0aG9kKSB7CiAgICB2YXIgZXJyb3JzID0gW107CiAgICB2YWxpZGF0ZURhdGEocmVxdWlyZWRLZXlzLCBkZXRhaWxzLCBlcnJvcnMpOwogICAgdmFyIGFkZGl0aW9uYWxFcnJvcnMgPSB2YWxpZGF0aW9uTWV0aG9kKGRldGFpbHMpOwogICAgZXJyb3JzID0gZXJyb3JzLmNvbmNhdChhZGRpdGlvbmFsRXJyb3JzKTsKCiAgICAvLy8vCiAgICAvLyBJbmplY3QgYWRkaXRpb25hbCBwcm9wZXJ0aWVzCiAgICAvLy8vCiAgICBmb3IodmFyIGkgPSAwOyBpIDwgZXJyb3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZXJyb3JzW2ldLnN0YXR1cyA9ICJCYWQgUmVxdWVzdCI7CiAgICAgICAgZXJyb3JzW2ldLmNhdGVnb3J5X2NvZGUgPSAicmVxdWVzdCI7CiAgICAgICAgZXJyb3JzW2ldLmFkZGl0aW9uYWwgPSBudWxsOwogICAgICAgIGVycm9yc1tpXS5zdGF0dXNfY29kZSA9IDQwMDsKICAgICAgICBlcnJvcnNbaV0uY2F0ZWdvcnlfdHlwZSA9ICJyZXF1ZXN0IjsKICAgIH0KCiAgICByZXR1cm4gZXJyb3JzOwp9CgpmdW5jdGlvbiBub0RhdGFFcnJvcihjYWxsYmFjaywgbWVzc2FnZSkgewogICAgdmFyIG0gPSAobWVzc2FnZSkgPyBtZXNzYWdlIDogJ05vIGRhdGEgc3VwcGxpZWQnOwoKICAgIGlmICghY2FsbGJhY2spIHsKICAgICAgICB0aHJvdyBtOwogICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICAgIGVycm9yczogW3sKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBtLAogICAgICAgICAgICAgICAgc3RhdHVzOiAiQmFkIFJlcXVlc3QiLAogICAgICAgICAgICAgICAgY2F0ZWdvcnlfY29kZTogInJlcXVlc3QiLAogICAgICAgICAgICAgICAgYWRkaXRpb25hbDogbnVsbCwKICAgICAgICAgICAgICAgIHN0YXR1c19jb2RlOiA0MDAsCiAgICAgICAgICAgICAgICBjYXRlZ29yeV90eXBlOiAicmVxdWVzdCIsCiAgICAgICAgICAgICAgICBleHRyYXM6IHt9CiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBzdGF0dXNfY29kZTogNDAwCiAgICAgICAgfSk7CiAgICB9Cn0KCnZhciBjYyA9IHsKCiAgICBpc0NhcmROdW1iZXJWYWxpZDpmdW5jdGlvbiAoY2FyZE51bWJlcikgewogICAgICAgIGlmICghY2FyZE51bWJlcikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGNhcmROdW1iZXIgPSAoY2FyZE51bWJlciArICcnKS5yZXBsYWNlKC9cRCsvZywgJycpLnNwbGl0KCcnKS5yZXZlcnNlKCk7CiAgICAgICAgaWYgKCFjYXJkTnVtYmVyLmxlbmd0aCB8fCBjYXJkTnVtYmVyLmxlbmd0aCA8IDEyKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRvdGFsID0gMCwgaTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2FyZE51bWJlci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjYXJkTnVtYmVyW2ldID0gcGFyc2VJbnQoY2FyZE51bWJlcltpXSwgMTApOwogICAgICAgICAgICB0b3RhbCArPSBpICUgMiA/IDIgKiBjYXJkTnVtYmVyW2ldIC0gKGNhcmROdW1iZXJbaV0gPiA0ID8gOSA6IDApIDogY2FyZE51bWJlcltpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICh0b3RhbCAlIDEwKSA9PT0gMDsKICAgIH0sCiAgICBjYXJkVHlwZTpmdW5jdGlvbiAoY2FyZE51bWJlcikgewogICAgICAgIHZhciBwID0ge307CiAgICAgICAgcFsnNTEnXSA9IHBbJzUyJ10gPSBwWyc1MyddID0gcFsnNTQnXSA9IHBbJzU1J10gPSAnTWFzdGVyY2FyZCc7CiAgICAgICAgcFsnMzQnXSA9IHBbJzM3J10gPSAnQW1lcmljYW4gRXhwcmVzcyc7CiAgICAgICAgcFsnNCddID0gJ1ZJU0EnOwogICAgICAgIHBbJzYnXSA9ICdEaXNjb3ZlciBDYXJkJzsKICAgICAgICBwWyczNSddID0gJ0pDQic7CiAgICAgICAgcFsnMzAnXSA9IHBbJzM2J10gPSBwWyczOCddID0gJ0RpbmVycyBDbHViJzsKCiAgICAgICAgaWYgKGNhcmROdW1iZXIpIHsKICAgICAgICAgICAgY2FyZE51bWJlciA9IGNhcmROdW1iZXIudG9TdHJpbmcoKS50cmltKCk7CgogICAgICAgICAgICBmb3IgKHZhciBrIGluIHApIHsKICAgICAgICAgICAgICAgIGlmIChjYXJkTnVtYmVyLmluZGV4T2YoaykgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcFtrXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0sCiAgICBpc0NWVlZhbGlkOmZ1bmN0aW9uIChjYXJkTnVtYmVyLCBjdnYpIHsKICAgICAgICB2YXIgY2FyZFR5cGUgPSBjYy5jYXJkVHlwZShjYXJkTnVtYmVyKTsKICAgICAgICBpZiAoIWNhcmRUeXBlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIHJlcXVpcmVkTGVuZ3RoID0gKGNhcmRUeXBlID09PSAnQW1lcmljYW4gRXhwcmVzcycgPyA0IDogMyk7CgogICAgICAgIGlmKHR5cGVvZiBjdnYgPT09ICJzdHJpbmciIHx8IHR5cGVvZiBjdnYgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIGlmKGN2di50b1N0cmluZygpLnJlcGxhY2UoL1xEKy9nLCAnJykubGVuZ3RoID09PSByZXF1aXJlZExlbmd0aCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICAvLyBEZXByZWNhdGVkLiBBbGlhc2VkIHRvIGlzQ1ZWVmFsaWQKICAgIGlzU2VjdXJpdHlDb2RlVmFsaWQ6ZnVuY3Rpb24gKGNhcmROdW1iZXIsIHNlY3VyaXR5Q29kZSkgewogICAgICByZXR1cm4gY2MuaXNDVlZWYWxpZChjYXJkTnVtYmVyLCBzZWN1cml0eUNvZGUpOwogICAgfSwKICAgIGlzRXhwaXJ5VmFsaWQ6ZnVuY3Rpb24gKGV4cGlyeU1vbnRoLCBleHBpcnlZZWFyKSB7CiAgICAgICAgaWYgKCFleHBpcnlNb250aCB8fCAhZXhwaXJ5WWVhcikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGV4cGlyeU1vbnRoID0gcGFyc2VJbnQoZXhwaXJ5TW9udGgsIDEwKTsKICAgICAgICBleHBpcnlZZWFyID0gcGFyc2VJbnQoZXhwaXJ5WWVhciwgMTApOwogICAgICAgIGlmIChpc05hTihleHBpcnlNb250aCkgfHwgaXNOYU4oZXhwaXJ5WWVhcikgfHwgZXhwaXJ5TW9udGggPiAxMiB8fCBleHBpcnlNb250aCA8IDEpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpOwogICAgICAgIHJldHVybiAhKHRvZGF5LmdldEZ1bGxZZWFyKCkgPiBleHBpcnlZZWFyIHx8CiAgICAgICAgICAgICAgICAgKHRvZGF5LmdldEZ1bGxZZWFyKCkgPT09IGV4cGlyeVllYXIgJiYgdG9kYXkuZ2V0TW9udGgoKSA+PSBleHBpcnlNb250aCkpOwogICAgfSwKICAgIHZhbGlkYXRlOmZ1bmN0aW9uIChjYXJkRGF0YSkgewogICAgICAgIGlmIChjYXJkRGF0YS5udW1iZXIpIHsKICAgICAgICAgICAgY2FyZERhdGEubnVtYmVyID0gY2FyZERhdGEubnVtYmVyLnRvU3RyaW5nKCkudHJpbSgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG51bWJlciA9IGNhcmREYXRhLm51bWJlciwKICAgICAgICBjdnYgPSBjYXJkRGF0YS5jdnYsCiAgICAgICAgZXhwaXJ5TW9udGggPSBjYXJkRGF0YS5leHBpcmF0aW9uX21vbnRoLAogICAgICAgIGV4cGlyeVllYXIgPSBjYXJkRGF0YS5leHBpcmF0aW9uX3llYXI7CgogICAgICAgIHZhciBlcnJvcnMgPSBbXTsKICAgICAgICBpZiAoIWNjLmlzQ2FyZE51bWJlclZhbGlkKG51bWJlcikpIHsKICAgICAgICAgICAgZXJyb3JzLnB1c2goYnVpbGRFcnJvck9iamVjdCgnbnVtYmVyJywgJ0ludmFsaWQgZmllbGQgW251bWJlcl0gLSAiJyArIG51bWJlciArICciIGlzIG5vdCBhIHZhbGlkIGNyZWRpdCBjYXJkIG51bWJlcicpKTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBjdnYgIT09ICd1bmRlZmluZWQnICYmIGN2diAhPT0gbnVsbCAmJiAhY2MuaXNDVlZWYWxpZChudW1iZXIsIGN2dikpIHsKICAgICAgICAgICAgZXJyb3JzLnB1c2goYnVpbGRFcnJvck9iamVjdCgnY3Z2JywgJ0ludmFsaWQgZmllbGQgW2N2dl0gLSAiJyArIGN2diArICciIGlzIG5vdCBhIHZhbGlkIGNyZWRpdCBjYXJkIHNlY3VyaXR5IGNvZGUnKSk7CiAgICAgICAgfQogICAgICAgIGlmICghY2MuaXNFeHBpcnlWYWxpZChleHBpcnlNb250aCwgZXhwaXJ5WWVhcikpIHsKICAgICAgICAgICAgZXJyb3JzLnB1c2goYnVpbGRFcnJvck9iamVjdChbJ2V4cGlyYXRpb25fbW9udGgnLCAnZXhwaXJhdGlvbl95ZWFyJ10sICdJbnZhbGlkIGZpZWxkIFtleHBpcmF0aW9uX21vbnRoLGV4cGlyYXRpb25feWVhcl0gLSAiJyArIGV4cGlyeU1vbnRoICsgJy0nICsgZXhwaXJ5WWVhciArICciIGlzIG5vdCBhIHZhbGlkIGNyZWRpdCBjYXJkIGV4cGlyYXRpb24gZGF0ZScpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBlcnJvcnM7CiAgICB9LAogICAgY3JlYXRlOmZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykgewogICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgICBub0RhdGFFcnJvcihjYWxsYmFjayk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHJlcXVpcmVkS2V5cyA9IFsnbnVtYmVyJywgJ2V4cGlyYXRpb25fbW9udGgnLCAnZXhwaXJhdGlvbl95ZWFyJ107CiAgICAgICAgdmFyIGVycm9ycyA9IHZhbGlkYXRlKGRhdGEsIHJlcXVpcmVkS2V5cywgY2MudmFsaWRhdGUpOwoKICAgICAgICBpZiAoIWlzRW1wdHkoZXJyb3JzKSkgewogICAgICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycywKICAgICAgICAgICAgICAgIHN0YXR1c19jb2RlOiA0MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAganNvbnAobWFrZV91cmwoJy9qc29ucC9jYXJkcycsIHByZXBhcmVQYXlsb2FkKGRhdGEpKSwgbWFrZV9jYWxsYmFjayhjYWxsYmFjaykpOwogICAgICAgIH0KICAgIH0KfTsKCnZhciBlbSA9IHsKICAgIHZhbGlkYXRlOmZ1bmN0aW9uIChlbWFpbEFkZHJlc3MpIHsKICAgICAgICBpZihlbWFpbEFkZHJlc3MgJiYgZW1haWxBZGRyZXNzLm1hdGNoKC9bYS16MC05ISMkJSYnKitcLz0/XF5fYHt8fX5cLV0rKD86XC5bYS16MC05ISMkJSYnKitcLz0/XF5fYHt8fX5cLV0rKSpAKD86W2EtejAtOV0oPzpbYS16MC05XC1dKlthLXowLTldKT9cLikrW2EtejAtOV0oPzpbYS16MC05XC1dKlthLXowLTldKT8vaSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn07Cgp2YXIgYmEgPSB7CiAgICB0eXBlczogWydzYXZpbmdzJywgJ2NoZWNraW5nJ10sCiAgICB2YWxpZGF0ZTpmdW5jdGlvbiAoYWNjb3VudERhdGEpIHsKICAgICAgICB2YXIgbm91biA9ICgncm91dGluZ19udW1iZXInIGluIGFjY291bnREYXRhKSA/ICdyb3V0aW5nX251bWJlcicgOiAnYmFua19jb2RlJzsKICAgICAgICB2YXIgYmFua0NvZGUgPSBhY2NvdW50RGF0YVtub3VuXTsKICAgICAgICB2YXIgZXJyb3JzID0gW107CiAgICAgICAgaWYgKCFiYS5pc1JvdXRpbmdOdW1iZXJWYWxpZChiYW5rQ29kZSkpIHsKICAgICAgICAgICAgZXJyb3JzLnB1c2goYnVpbGRFcnJvck9iamVjdChub3VuLCAnSW52YWxpZCBmaWVsZCBbJyArIG5vdW4gKyAnXSAtICInICsgYmFua0NvZGUgKyAnIiBpcyBub3QgYSB2YWxpZCAnICsgbm91bi5yZXBsYWNlKCdfJywgJyAnKSkpOwogICAgICAgIH0KICAgICAgICB2YXIgYWNjb3VudF90eXBlID0gYWNjb3VudERhdGEudHlwZSB8fCBhY2NvdW50RGF0YS5hY2NvdW50X3R5cGU7CiAgICAgICAgdmFyIHR5cGVfbmFtZSA9ICd0eXBlJyBpbiBhY2NvdW50RGF0YSA/ICd0eXBlJyA6ICdhY2NvdW50X3R5cGUnOwogICAgICAgIGlmIChhY2NvdW50RGF0YVt0eXBlX25hbWVdICYmICFiYS52YWxpZGF0ZVR5cGUoYWNjb3VudF90eXBlKSkgewogICAgICAgICAgICBlcnJvcnMucHVzaChidWlsZEVycm9yT2JqZWN0KHR5cGVfbmFtZSwgJ0ludmFsaWQgZmllbGQgWycgKyB0eXBlX25hbWUgKyAnXSAtICInICsgYWNjb3VudF90eXBlICsgJyIgbXVzdCBiZSBvbmUgb2Y6ICInICsgYmEudHlwZXMuam9pbignIiwgIicpICsgJyInKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlcnJvcnM7CiAgICB9LAogICAgaXNSb3V0aW5nTnVtYmVyVmFsaWQ6ZnVuY3Rpb24gKHJvdXRpbmdOdW1iZXIpIHsKICAgICAgICBpZiAoIXJvdXRpbmdOdW1iZXIpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByb3V0aW5nTnVtYmVyID0gcm91dGluZ051bWJlci50b1N0cmluZygpLm1hdGNoKC9cZCsvZyk7CgogICAgICAgIGlmICghcm91dGluZ051bWJlcikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByb3V0aW5nTnVtYmVyID0gcm91dGluZ051bWJlci5qb2luKCcnKTsKCiAgICAgICAgaWYgKCFyb3V0aW5nTnVtYmVyIHx8IHJvdXRpbmdOdW1iZXIubGVuZ3RoICE9PSA5KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHZhciBhID0gcm91dGluZ051bWJlci50b1N0cmluZygpLnNwbGl0KCcnKTsKICAgICAgICB2YXIgZCA9IFtdOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBkLnB1c2gocGFyc2VJbnQoYVtpXSwgMTApKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRbOF0gPT09ICgKICAgICAgICAgICAgNyAqIChkWzBdICsgZFszXSArIGRbNl0pICsKICAgICAgICAgICAgICAgIDMgKiAoZFsxXSArIGRbNF0gKyBkWzddKSArCiAgICAgICAgICAgICAgICA5ICogKGRbMl0gKyBkWzVdKQogICAgICAgICkgJSAxMDsKICAgIH0sCiAgICAvLyBEZXByZWNhdGVkLiBBbGlhc2VkIHRvIGlzUm91dGluZ051bWJlclZhbGlkCiAgICB2YWxpZGF0ZVJvdXRpbmdOdW1iZXI6ZnVuY3Rpb24gKHJvdXRpbmdOdW1iZXIpIHsKICAgICAgICByZXR1cm4gYmEuaXNSb3V0aW5nTnVtYmVyVmFsaWQocm91dGluZ051bWJlcik7CiAgICB9LAogICAgbG9va3VwUm91dGluZ051bWJlcjpmdW5jdGlvbiAocm91dGluZ051bWJlciwgY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXJvdXRpbmdOdW1iZXIpIHsKICAgICAgICAgICAgbm9EYXRhRXJyb3IoY2FsbGJhY2spOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciB1cmkgPSAnL2JhbmtfYWNjb3VudHMvcm91dGluZ19udW1iZXJzLycgKyByb3V0aW5nTnVtYmVyOwogICAgICAgIGpzb25wKG1ha2VfdXJsKHVyaSwgbnVsbCwgbWFrZV9jYWxsYmFjayhjYWxsYmFjaykpKTsKICAgIH0sCiAgICB2YWxpZGF0ZVR5cGU6IGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gISEvc2F2aW5nc3xjaGVja2luZy8uZXhlYyh0eXBlKTsKICAgIH0sCiAgICBjcmVhdGU6ZnVuY3Rpb24gKGRhdGEsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICAgIG5vRGF0YUVycm9yKGNhbGxiYWNrKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgcmVxdWlyZWRLZXlzID0gWyduYW1lJywgJ2FjY291bnRfbnVtYmVyJywgJ3JvdXRpbmdfbnVtYmVyJ107CiAgICAgICAgdmFyIGVycm9ycyA9IHZhbGlkYXRlKGRhdGEsIHJlcXVpcmVkS2V5cywgYmEudmFsaWRhdGUpOwoKICAgICAgICBpZiAoIWlzRW1wdHkoZXJyb3JzKSkgewogICAgICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycywKICAgICAgICAgICAgICAgIHN0YXR1c19jb2RlOiA0MDAKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCd0eXBlJyBpbiBkYXRhICYmICEnYWNjb3VudF90eXBlJyBpbiBkYXRhKSB7CiAgICAgICAgICAgICAgICBkYXRhLmFjY291bnRfdHlwZSA9IGRhdGEudHlwZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBqc29ucChtYWtlX3VybCgnL2pzb25wL2JhbmtfYWNjb3VudHMnLCBwcmVwYXJlUGF5bG9hZChkYXRhKSksIG1ha2VfY2FsbGJhY2soY2FsbGJhY2spKTsKICAgICAgICB9CiAgICB9Cn07Cgp2YXIgZWEgPSB7CiAgICBwcm92aWRlcnM6IHsKICAvLyBUT0RPOiB0aGlzIGlzIGN1cnJlbnRseSBoYXJkIGNvZGVkCiAgLy8gdXNpbmcgYmFsYW5jZWQuY29uZmlndXJlKCcvbWFya2V0cGxhY2UvTVBhc2RmYXNkZicpIHdpbGwKICAvLyBnZXQgdGhlIHJpZ2h0IGNvbmZpZ3MgaW4gdGhlIGZ1dHVyZQogICAgICAgICdjb2luYmFzZSc6IHsKICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9jb2luYmFzZS5jb20vb2F1dGgvYXV0aG9yaXplJywKICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICByZXNwb25zZV90eXBlOiAnY29kZScsCiAgICAgICAgICAgICAgICBjbGllbnRfaWQ6ICcwNTBmNGM4NTIzMWE1MWMxNDdhM2ZiMDExZTAxMjc1NWQ4MWNkYjQ5OWNjNTBiNTM1NGI3YmNkZjliZjgwNWFkJywKICAgICAgICAgICAgICAgIHJlZGlyZWN0X3VyaTogJ2h0dHBzOi8vanMuYmFsYW5jZWRwYXltZW50cy5jb20vY2FsbGJhY2suaHRtbCcsCiAgICAgICAgICAgICAgICBzY29wZTogJ3NlbmQnCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgcHJvdmlkZXJfbmFtZTogbnVsbCwKICAgIGNhbGxiYWNrOiBudWxsLAogICAgY3JlYXRlOiBmdW5jdGlvbihwcm92aWRlcl9uYW1lLCBjYWxsYmFjaykgewogICAgICAgIHZhciBwcm92aWRlciA9IGVhLnByb3ZpZGVyc1twcm92aWRlcl9uYW1lXTsKICAgICAgICB2YXIgdXJsID0gcHJvdmlkZXIudXJsOwogICAgICAgIHZhciBwYXJhbXMgPSBwcm92aWRlci5wYXJhbXM7CiAgICAgICAgdmFyIHBhcmFtc19hcnJheSA9IFtdOwoKICAgICAgICBlYS5wcm92aWRlcl9uYW1lID0gcHJvdmlkZXJfbmFtZTsKICAgICAgICBlYS5jYWxsYmFjayA9IGNhbGxiYWNrOwoKICAgICAgICBpZiAocGFyYW1zKSB7CiAgICAgICAgICAgIGZvciAodmFyIHBhcmFtIGluIHBhcmFtcykgewogICAgICAgICAgICAgICAgcGFyYW1zX2FycmF5LnB1c2gocGFyYW0gKyAiPSIgKyBwYXJhbXNbcGFyYW1dKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cmwgPSB1cmwgKyAnPycgKyBwYXJhbXNfYXJyYXkuam9pbignJicpOwogICAgICAgIH0KCiAgICAgICAgZGlhbG9nID0gd2luZG93Lm9wZW4odXJsLCAiIiwgInRvcD0iICsgKHdpbmRvdy5vdXRlckhlaWdodC8yIC0gMjc1KSArICIsIGxlZnQ9IiArICh3aW5kb3cub3V0ZXJXaWR0aC8yIC0gMjUwKSArICIsIHdpZHRoPTUwMCwgaGVpZ2h0PTU1MCIpOwogICAgfSwKICAgIGNvbmZpZ3VyZTogZnVuY3Rpb24gKCkgewogIC8qanNvbnAobWFrZV91cmwoJy9qc29ucC8nK21hcmtldHBsYWNlX2hyZWYrJy9jb25maWdzJywge30pLCBmdW5jdGlvbiAoanNvbikgewogICAgICBlYS5uZXR3b3JrID0ganNvbjsKICB9KTsqLwogICAgfQp9OwoKYWRkRXZlbnQod2luZG93LCAnbWVzc2FnZScsIGZ1bmN0aW9uIChldmVudCkgewogICAgaWYoZXZlbnQub3JpZ2luICE9PSAiaHR0cHM6Ly9qcy5iYWxhbmNlZHBheW1lbnRzLmNvbSIpIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCFldmVudC5kYXRhKSB7CiAgICAgICAgbm9EYXRhRXJyb3IoZWEuY2FsbGJhY2spOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgZGF0YSA9IGV2ZW50LmRhdGE7CiAgICBkYXRhLnRva2VuID0gZXZlbnQuZGF0YS50b2tlbiB8fCBldmVudC5kYXRhLmNvZGU7CiAgICBkYXRhLnByb3ZpZGVyID0gZWEucHJvdmlkZXJfbmFtZTsKCiAgICBqc29ucChtYWtlX3VybCgnL2pzb25wL2V4dGVybmFsX2FjY291bnRzJywgZGF0YSksIG1ha2VfY2FsbGJhY2soZWEuY2FsbGJhY2spKTsKCiAgICBpZihkaWFsb2cpCiAgICAgICAgZGlhbG9nLmNsb3NlKCk7Cn0pOwoKZnVuY3Rpb24ganNvbnAocGF0aCwgY2FsbGJhY2spIHsKICAgIHZhciBmdW5jdCA9ICJiYWxhbmNlZF9qc29ucF8iK01hdGgucmFuZG9tKCkudG9TdHJpbmcoKS5zdWJzdHIoMik7CiAgICB2YXIgdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICB0YWcudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOwogICAgdGFnLmFzeW5jID0gdHJ1ZTsKICAgIHRhZy5zcmMgPSBwYXRoLnJlcGxhY2UoJ3tjYWxsYmFja30nLCBmdW5jdCk7CiAgICB2YXIgd2hlcmUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07CiAgICB3aGVyZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0YWcsIHdoZXJlKTsKICAgIHdpbmRvd1tmdW5jdF0gPSBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjYWxsYmFjayhyZXN1bHQpOwogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICBpZih0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZS5lcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0YWcucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0YWcpOwogICAgfTsKfQoKZnVuY3Rpb24gbWFrZV91cmwocGF0aCwgZGF0YSkgewogICAgcmV0dXJuIHJvb3RfdXJsICsgcGF0aCArICI/Y2FsbGJhY2s9e2NhbGxiYWNrfSZkYXRhPSIgKyBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwp9CgpmdW5jdGlvbiBtYWtlX2NhbGxiYWNrKGNhbGxiYWNrKSB7CiAgICB2YXIgY2FsbGVkX2JhY2sgPSBmYWxzZTsKCiAgICBmdW5jdGlvbiByZXQoZGF0YSkgewogICAgICAgIGlmKGNhbGxlZF9iYWNrKSB7IHJldHVybjsgfQoKICAgICAgICBjYWxsZWRfYmFjayA9IHRydWU7CgogICAgICAgIGlmKCFkYXRhIHx8ICFkYXRhLnN0YXR1cykgewogICAgICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICAgICAgICBlcnJvcnM6IFt7CiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICJVbmFibGUgdG8gY29ubmVjdCB0byB0aGUgYmFsYW5jZWQgc2VydmVycyIsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAiSW50ZXJuYWwgU2VydmVyIEVycm9yIiwKICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeV9jb2RlOiAic2VydmVyLWVycm9yIiwKICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHN0YXR1c19jb2RlOiA1MDAsCiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlfdHlwZTogInNlcnZlci1lcnJvciIsCiAgICAgICAgICAgICAgICAgICAgZXh0cmFzOiB7fQogICAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgICBzdGF0dXNfY29kZTogNTAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgYm9keSA9IEpTT04ucGFyc2UoZGF0YS5ib2R5KTsKCiAgICAgICAgLy8vLwogICAgICAgIC8vIEFwcGVuZCB0aGUgc3RhdHVzCiAgICAgICAgLy8vLwogICAgICAgIGlmKHR5cGVvZiBkYXRhLnN0YXR1cyAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgYm9keS5zdGF0dXNfY29kZSA9IGRhdGEuc3RhdHVzOwogICAgICAgIH0KCiAgICAgICAgY2FsbGJhY2soYm9keSk7CiAgICB9CgogICAgc2V0VGltZW91dChyZXQsIDYwMDAwKTsKICAgIHJldHVybiByZXQ7Cn0KCi8vLy8KLy8gTG9hZCBKU09OIHBhcnNlciBmb3Igb2xkIGJyb3dzZXJzCi8vLy8KaWYodHlwZW9mIEpTT04gIT09ICdvYmplY3QnKSB7CiAgICBqc29ucCgnaHR0cHM6Ly9qcy5iYWxhbmNlZHBheW1lbnRzLmNvbS9qc29uMi5qcycpOwp9Cgp2YXIgYmFsYW5jZWQgPSBnbG9iYWwuYmFsYW5jZWQgPSB7CiAgICBjYXJkOiBjYywKICAgIGJhbmtBY2NvdW50OiBiYSwKICAgIGV4dGVybmFsQWNjb3VudDogZWEsCiAgICBlbWFpbEFkZHJlc3M6IGVtLAogICAgaW5pdDogZnVuY3Rpb24gKGFyZ3MpIHsKICAgICAgICBpZih0eXBlb2YgYXJncyA9PSAnc3RyaW5nJykgewogICAgICAgICAgICAvLyBnb2luZyB0byBiZSB0aGUgbWFya2V0cGxhY2UgaHJlZiB0byBjb25maWd1cmUgdGhlIHRva2VucwogICAgICAgICAgICAvLyBub3QgcmVxdWlyZWQgaWYgb25seSB0b2tlbml6aW5nIGNhcmRzIGFuZCBiYW5rIGFjY291bnRzCiAgICAgICAgICAgIG1hcmtldHBsYWNlX2hyZWYgPSBhcmdzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmKGFyZ3MgJiYgJ3NlcnZlcicgaW4gYXJncykgewogICAgICAgICAgICAgICAgcm9vdF91cmwgPSBhcmdzLnNlcnZlcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZihhcmdzICYmICdtYXJrZXRwbGFjZV9ocmVmJyBpbiBhcmdzKSB7CiAgICAgICAgICAgICAgICBtYXJrZXRwbGFjZV9ocmVmID0gYXJncy5tYXJrZXRwbGFjZV9ocmVmOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGFyZ3MgJiYgJ3Byb3ZpZGVycycgaW4gYXJncykgewogICAgICAgICAgICAgICAgZWEucHJvdmlkZXJzID0gYXJncy5wcm92aWRlcnM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gVE9ETzogbWFrZSBpdCBncmFiIHRoZSBjb25maWd1cmF0aW9uIGZvciB0aGlzIG1hcmtldHBsYWNlCiAgICB9Cn07Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 11:59:36 GMT",
                    "Content-Length": "16369",
                    "Date": "Thu, 06 Nov 2014 11:59:39 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}