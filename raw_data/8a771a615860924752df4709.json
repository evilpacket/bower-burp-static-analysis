{
    "url": "http://localhost:9999/stritti/log4js/log4js/src/main/js/log4js.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Ajax request header manipulation (DOM-based)",
    "issueType": 5245952,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based Ajax request header manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into a header of an Ajax request that is issued using XmlHttpRequest. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will set an arbitrary header in the subsequent Ajax request.<br><br>The potential impact of the vulnerability depends on the role of specific HTTP headers in the server-side application's processing of the Ajax request. If the header is used to control the behavior that results from the Ajax request, then the attacker may be able to cause the user to perform unintended actions by manipulating the header.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based Ajax request header manipulation vulnerabilities is not to dynamically set Ajax request headers using data that originated from any untrusted source. This behavior should never be implemented for headers that have any role in controlling the effects of privileged actions within the application.",
    "issueDetail": "The application may be vulnerable to DOM-based Ajax request header manipulation. Data is read from <b>location.href</b> and written to <b>the 'setRequestHeader()' function of an XMLHttpRequest object</b> via the following statement:<ul><li>this.httpRequest.setRequestHeader(\"REFERER\", location.href);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/stritti/log4js/log4js/src/main/js/log4js.js",
                "path": "/stritti/log4js/log4js/src/main/js/log4js.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9zdHJpdHRpL2xvZzRqcy9sb2c0anMvc3JjL21haW4vanMvbG9nNGpzLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNjg5NjkNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDk6MDM6NTQgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA5OjAzOjU0IEdNVA0KDQovKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQoNCi8qanNsOm9wdGlvbiBleHBsaWNpdCovDQoNCi8qKg0KICogQGZpbGVvdmVydmlldyBsb2c0anMgaXMgYSBsaWJyYXJ5IHRvIGxvZyBpbiBKYXZhU2NyaXB0IGluIHNpbWlsYXIgbWFubmVyIA0KICogdGhhbiBpbiBsb2c0aiBmb3IgSmF2YS4gVGhlIEFQSSBzaG91bGQgYmUgbmVhcmx5IHRoZSBzYW1lLg0KICogDQogKiBUaGlzIGZpbGUgY29udGFpbnMgYWxsIGxvZzRqcyBjb2RlIGFuZCBpcyB0aGUgb25seSBmaWxlIHJlcXVpcmVkIGZvciBsb2dnaW5nLg0KICogDQogKiA8aDM+RXhhbXBsZTo8L2gzPg0KICogPHByZT4NCiAqICB2YXIgbG9nID0gbmV3IExvZzRqcy5nZXRMb2dnZXIoInNvbWUtY2F0ZWdvcnktbmFtZSIpOyAvL2NyZWF0ZSBsb2dnZXIgaW5zdGFuY2UNCiAqICBsb2cuc2V0TGV2ZWwoTG9nNGpzLkxldmVsLlRSQUNFKTsgLy9zZXQgdGhlIExldmVsDQogKiAgbG9nLmFkZEFwcGVuZGVyKG5ldyBDb25zb2xlQXBwZW5kZXIobG9nLCBmYWxzZSkpOyAvLyBjb25zb2xlIHRoYXQgbGF1bmNoZXMgaW4gbmV3IHdpbmRvdw0KIA0KICogIC8vIGlmIG11bHRpcGxlIGFwcGVuZGVycyBhcmUgc2V0IGFsbCB3aWxsIGxvZw0KICogIGxvZy5hZGRBcHBlbmRlcihuZXcgQ29uc29sZUFwcGVuZGVyKGxvZywgdHJ1ZSkpOyAvLyBjb25zb2xlIHRoYXQgaXMgaW4tbGluZSBpbiB0aGUgcGFnZQ0KICogIGxvZy5hZGRBcHBlbmRlcihuZXcgRmlsZUFwcGVuZGVyKCJDOlxcc29tZWZpbGUubG9nIikpOyAvLyBmaWxlIGFwcGVuZGVyIGxvZ3MgdG8gQzpcXHNvbWVmaWxlLmxvZw0KICogDQogKiAgLi4uDQogKiANCiAqICAvL2NhbGwgdGhlIGxvZw0KICogIGxvZy50cmFjZSgidHJhY2UgbWUiICk7DQogKiA8L3ByZT4NCiAqDQogKiBAdmVyc2lvbiAxLjAuMA0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlciAtIGh0dHA6Ly9qcm9sbGVyLmNvbS9wYWdlL3N0cml0dGkNCiAqIEBhdXRob3IgU2V0aCBDaGlzYW1vcmUgLSBodHRwOi8vd3d3LmNoaXNhbW9yZS5jb20NCiAqIEBzaW5jZSAyMDA1LTA1LTIwDQogKiBAc3RhdGljDQogKiBXZWJzaXRlOiBodHRwOi8vc3RyaXR0aS5naXRodWIuaW8vbG9nNGpzLw0KICovDQp2YXIgTG9nNGpzID0gew0KCQ0KCS8qKiANCgkgKiBDdXJyZW50IHZlcnNpb24gb2YgbG9nNGpzLiANCgkgKiBAc3RhdGljDQoJICogQGZpbmFsDQoJICovDQogIAl2ZXJzaW9uOiAiMS4wLjAiLA0KDQoJLyoqICANCgkgKiBEYXRlIG9mIGxvZ2dlciBpbml0aWFsaXplZC4NCgkgKiBAc3RhdGljDQoJICogQGZpbmFsDQoJICovDQoJYXBwbGljYXRpb25TdGFydERhdGU6IG5ldyBEYXRlKCksDQoJCQ0KCS8qKiAgDQoJICogSGFzaHRhYmxlIG9mIGxvZ2dlcnMuDQoJICogQHN0YXRpYw0KCSAqIEBmaW5hbA0KCSAqIEBwcml2YXRlICANCgkgKi8NCglsb2dnZXJzOiB7fSwNCgkNCgkvKioNCgkgKiBHZXQgYSBsb2dnZXIgaW5zdGFuY2UuIEluc3RhbmNlIGlzIGNhY2hlZCBvbiBjYXRlZ29yeU5hbWUgbGV2ZWwuDQoJICogQHBhcmFtICB7U3RyaW5nfSBjYXRlZ29yeU5hbWUgbmFtZSBvZiBjYXRlZ29yeSB0byBsb2cgdG8uDQoJICogQHJldHVybiB7TG9nZ2VyfSBpbnN0YW5jZSBvZiBsb2dnZXIgZm9yIHRoZSBjYXRlZ29yeQ0KCSAqIEBzdGF0aWMNCgkgKi8NCglnZXRMb2dnZXI6IGZ1bmN0aW9uKGNhdGVnb3J5TmFtZSkgew0KCQkNCgkJLy8gVXNlIGRlZmF1bHQgbG9nZ2VyIGlmIGNhdGVnb3J5TmFtZSBpcyBub3Qgc3BlY2lmaWVkIG9yIGludmFsaWQNCgkJaWYgKCEodHlwZW9mIGNhdGVnb3J5TmFtZSA9PSAic3RyaW5nIikpIHsNCgkJCWNhdGVnb3J5TmFtZSA9ICJbZGVmYXVsdF0iOw0KCQl9DQoNCgkJaWYgKCFMb2c0anMubG9nZ2Vyc1tjYXRlZ29yeU5hbWVdKSB7DQoJCQkvLyBDcmVhdGUgdGhlIGxvZ2dlciBmb3IgdGhpcyBuYW1lIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeSBleGlzdA0KCQkJTG9nNGpzLmxvZ2dlcnNbY2F0ZWdvcnlOYW1lXSA9IG5ldyBMb2c0anMuTG9nZ2VyKGNhdGVnb3J5TmFtZSk7DQoJCX0NCgkJDQoJCXJldHVybiBMb2c0anMubG9nZ2Vyc1tjYXRlZ29yeU5hbWVdOw0KCX0sDQoJDQoJLyoqDQoJICogR2V0IHRoZSBkZWZhdWx0IGxvZ2dlciBpbnN0YW5jZS4NCgkgKiBAcmV0dXJuIHtMb2dnZXJ9IGluc3RhbmNlIG9mIGRlZmF1bHQgbG9nZ2VyDQoJICogQHN0YXRpYw0KCSAqLw0KCWdldERlZmF1bHRMb2dnZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gTG9nNGpzLmdldExvZ2dlcigiW2RlZmF1bHRdIik7IA0KCX0sDQoJDQogIAkvKioNCiAgCSAqIEF0YXRjaCBhbiBvYnNlcnZlciBmdW5jdGlvbiB0byBhbiBlbGVtZW50cyBldmVudCBicm93c2VyIGluZGVwZW5kZW50Lg0KICAJICogDQogIAkgKiBAcGFyYW0gZWxlbWVudCBlbGVtZW50IHRvIGF0dGFjaCBldmVudA0KICAJICogQHBhcmFtIG5hbWUgbmFtZSBvZiBldmVudA0KICAJICogQHBhcmFtIG9ic2VydmVyIG9ic2VydmVyIG1ldGhvZCB0byBiZSBjYWxsZWQNCiAgCSAqIEBwcml2YXRlDQogIAkgKi8NCiAgCWF0dGFjaEV2ZW50OiBmdW5jdGlvbiAoZWxlbWVudCwgbmFtZSwgb2JzZXJ2ZXIpIHsNCgkJaWYgKGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgeyAvL0RPTSBldmVudCBtb2RlbA0KCQkJZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKG5hbWUsIG9ic2VydmVyLCBmYWxzZSk7DQogICAgCX0gZWxzZSBpZiAoZWxlbWVudC5hdHRhY2hFdmVudCkgeyAvL00kIGV2ZW50IG1vZGVsDQoJCQllbGVtZW50LmF0dGFjaEV2ZW50KCdvbicgKyBuYW1lLCBvYnNlcnZlcik7DQogICAgCX0NCgl9DQoJDQoJLyoqDQoJICogTG9hZCBhIEpTLXNjcmlwdCBkeW5hbWljYWxseS4NCgkgKiBAcGFyYW0ge1N0cmluZ30gc3JjDQoJICovDQovKgkkaW1wb3J0OiBmdW5jdGlvbiAoc3JjKSB7DQoJCXZhciBkb2N1bWVudFNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0Iik7DQoJDQoJCWZvciAoaW5kZXggPSAwOyBpbmRleCA8IGRvY3VtZW50U2NyaXB0cy5sZW5ndGg7ICsraW5kZXgpDQoJCXsNCgkJCXZhciBkb2N1bWVudFNjcmlwdCA9IGRvY3VtZW50U2NyaXB0c1tpbmRleF07DQoJCQlpZiAoZG9jdW1lbnRTY3JpcHQuc3JjID09IHNyYykgew0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJfQ0KCQkNCgkJdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOw0KCQlzY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOw0KCQlzY3JpcHQuc3JjID0gc3JjOw0KCQlkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKHNjcmlwdCk7IA0KCQkNCgkJcmV0dXJuIHRydWU7DQoJfQ0KCSovDQp9Ow0KDQovKiogDQogKiBAbmFtZXNwYWNlIA0KICogQGNvbnN0cnVjdG9yDQogKi8NCkxvZzRqcyA9IGZ1bmN0aW9uKCl7fTsNCg0KLyoqDQogKiBJbnRlcm5hbCBvYmplY3QgZXh0ZW5zaW9uIChPTykgbWV0aG9kcy4NCiAqIA0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLmV4dGVuZCA9IGZ1bmN0aW9uKGRlc3RpbmF0aW9uLCBzb3VyY2UpIHsNCiAgZm9yIChwcm9wZXJ0eSBpbiBzb3VyY2UpIHsNCiAgICBkZXN0aW5hdGlvbltwcm9wZXJ0eV0gPSBzb3VyY2VbcHJvcGVydHldOw0KICB9DQogIHJldHVybiBkZXN0aW5hdGlvbjsNCn07DQogICAgDQovKioNCiAqIEZ1bmN0aW9ucyB0YWtlbiBmcm9tIFByb3RvdHlwZSBsaWJyYXJ5LCAgDQogKiBkaWRuJ3Qgd2FudCB0byByZXF1aXJlIGZvciBqdXN0IGZldyBmdW5jdGlvbnMuDQogKiBNb3JlIGluZm8gYXQge0BsaW5rIGh0dHA6Ly9wcm90b3R5cGUuY29uaW8ubmV0L30NCiAqIEBwcml2YXRlDQogKi8JDQpMb2c0anMuYmluZCA9IGZ1bmN0aW9uKGZuLCBvYmplY3QpIHsNCiAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gZm4uYXBwbHkob2JqZWN0LCBhcmd1bWVudHMpOw0KICB9Ow0KfTsNCg0KLyoqDQogKiBMb2c0anMuTGV2ZWwgRW51bWVyYXRpb24uIERvIG5vdCB1c2UgZGlyZWN0bHkuIFVzZSBzdGF0aWMgb2JqZWN0cyBpbnN0ZWFkLg0KICogQGNvbnN0cnVjdG9yDQogKiBAcGFyYW0ge051bWJlcn0gbGV2ZWwgbnVtYmVyIG9mIGxldmVsDQogKiBAcGFyYW0ge1N0cmluZ30gbGV2ZWxTdHJpbmcgU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGxldmVsDQogKiBAcHJpdmF0ZQ0KICovDQpMb2c0anMuTGV2ZWwgPSBmdW5jdGlvbihsZXZlbCwgbGV2ZWxTdHIpIHsNCgl0aGlzLmxldmVsID0gbGV2ZWw7DQoJdGhpcy5sZXZlbFN0ciA9IGxldmVsU3RyOw0KfTsNCg0KTG9nNGpzLkxldmVsLnByb3RvdHlwZSA9ICB7DQoJLyoqIA0KCSAqIGNvbnZlcnRzIGdpdmVuIFN0cmluZyB0byBjb3JyZXNwb25kaW5nIExldmVsDQoJICogQHBhcmFtIHtTdHJpbmd9IHNBcmcgU3RyaW5nIHZhbHVlIG9mIExldmVsDQoJICogQHBhcmFtIHtMb2c0anMuTGV2ZWx9IGRlZmF1bHRMZXZlbCBkZWZhdWx0IExldmVsLCBpZiBubyBTdHJpbmcgcmVwcmVzZW50YXRpb24NCgkgKiBAcmV0dXJuIExldmVsIG9iamVjdA0KCSAqIEB0eXBlIExvZzRqcy5MZXZlbA0KCSAqLw0KCXRvTGV2ZWw6IGZ1bmN0aW9uKHNBcmcsIGRlZmF1bHRMZXZlbCkgeyAgICAgICAgICAgICAgICAgIA0KCQkJCQ0KCQlpZihzQXJnID09PSBudWxsKSB7DQoJCQlyZXR1cm4gZGVmYXVsdExldmVsOw0KCQl9DQoJCQ0KCQlpZih0eXBlb2Ygc0FyZyA9PSAic3RyaW5nIikgeyANCgkJCXZhciBzID0gc0FyZy50b1VwcGVyQ2FzZSgpOw0KCQkJDQoJCQlzd2l0Y2gocykgew0KCQkJCWNhc2UgIkFMTCI6IHJldHVybiBMb2c0anMuTGV2ZWwuQUxMOw0KCQkJCWNhc2UgIkRFQlVHIjogcmV0dXJuIExvZzRqcy5MZXZlbC5ERUJVRzsNCgkJCQljYXNlICJJTkZPIjogcmV0dXJuIExvZzRqcy5MZXZlbC5JTkZPOw0KCQkJCWNhc2UgIldBUk4iOiByZXR1cm4gTG9nNGpzLkxldmVsLldBUk47DQoJCQkJY2FzZSAiRVJST1IiOiByZXR1cm4gTG9nNGpzLkxldmVsLkVSUk9SOw0KCQkJCWNhc2UgIkZBVEFMIjogcmV0dXJuIExvZzRqcy5MZXZlbC5GQVRBTDsNCgkJCQljYXNlICJPRkYiOiByZXR1cm4gTG9nNGpzLkxldmVsLk9GRjsNCgkJCQljYXNlICJUUkFDRSI6IHJldHVybiBMb2c0anMuTGV2ZWwuVFJBQ0U7DQoJCQkJZGVmYXVsdDogcmV0dXJuIGRlZmF1bHRMZXZlbDsNCgkJCX0NCgkJfSBlbHNlIGlmKHR5cGVvZiBzQXJnID09ICJudW1iZXIiKSB7DQoJCQlzd2l0Y2goc0FyZykgew0KCQkJCWNhc2UgQUxMX0lOVDogcmV0dXJuIExvZzRqcy5MZXZlbC5BTEw7DQoJCQkJY2FzZSBERUJVR19JTlQ6IHJldHVybiBMb2c0anMuTGV2ZWwuREVCVUc7DQoJCQkJY2FzZSBJTkZPX0lOVDogcmV0dXJuIExvZzRqcy5MZXZlbC5JTkZPOw0KCQkJCWNhc2UgV0FSTl9JTlQ6IHJldHVybiBMb2c0anMuTGV2ZWwuV0FSTjsNCgkJCQljYXNlIEVSUk9SX0lOVDogcmV0dXJuIExvZzRqcy5MZXZlbC5FUlJPUjsNCgkJCQljYXNlIEZBVEFMX0lOVDogcmV0dXJuIExvZzRqcy5MZXZlbC5GQVRBTDsNCgkJCQljYXNlIE9GRl9JTlQ6IHJldHVybiBMb2c0anMuTGV2ZWwuT0ZGOw0KCQkJCWNhc2UgVFJBQ0VfSU5UOiByZXR1cm4gTG9nNGpzLkxldmVsLlRSQUNFOw0KCQkJCWRlZmF1bHQ6IHJldHVybiBkZWZhdWx0TGV2ZWw7DQoJCQl9DQoJCX0gZWxzZSB7DQoJCQlyZXR1cm4gZGVmYXVsdExldmVsOwkNCgkJfQ0KCX0sCQ0KCS8qKiANCgkgKiBAcmV0dXJuICBjb252ZXJ0ZWQgTGV2ZWwgdG8gU3RyaW5nDQoJICogQHR5cGUgU3RyaW5nDQoJICovCQkNCgl0b1N0cmluZzogZnVuY3Rpb24oKSB7DQoJCXJldHVybiB0aGlzLmxldmVsU3RyOwkNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIGludGVybmFsIE51bWJlciB2YWx1ZSBvZiBMZXZlbA0KCSAqIEB0eXBlIE51bWJlcg0KCSAqLwkJCQ0KCXZhbHVlT2Y6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gdGhpcy5sZXZlbDsNCgl9DQp9Ow0KDQovLyBTdGF0aWMgdmFyaWFibGVzDQovKiogDQogKiBAcHJpdmF0ZQ0KICovDQpMb2c0anMuTGV2ZWwuT0ZGX0lOVCA9IE51bWJlci5NQVhfVkFMVUU7DQovKiogDQogKiBAcHJpdmF0ZQ0KICovDQpMb2c0anMuTGV2ZWwuRkFUQUxfSU5UID0gNTAwMDA7DQovKiogDQogKiBAcHJpdmF0ZQ0KICovDQpMb2c0anMuTGV2ZWwuRVJST1JfSU5UID0gNDAwMDA7DQovKiogDQogKiBAcHJpdmF0ZQ0KICovDQpMb2c0anMuTGV2ZWwuV0FSTl9JTlQgPSAzMDAwMDsNCi8qKiANCiAqIEBwcml2YXRlDQogKi8NCkxvZzRqcy5MZXZlbC5JTkZPX0lOVCA9IDIwMDAwOw0KLyoqIA0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLkxldmVsLkRFQlVHX0lOVCA9IDEwMDAwOw0KLyoqIA0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLkxldmVsLlRSQUNFX0lOVCA9IDUwMDA7DQovKiogDQogKiBAcHJpdmF0ZQ0KICovDQpMb2c0anMuTGV2ZWwuQUxMX0lOVCA9IE51bWJlci5NSU5fVkFMVUU7DQoNCi8qKiANCiAqIExvZ2dpbmcgTGV2ZWwgT0ZGIC0gYWxsIGRpc2FibGVkDQogKiBAdHlwZSBMb2c0anMuTGV2ZWwNCiAqIEBzdGF0aWMNCiAqLw0KTG9nNGpzLkxldmVsLk9GRiA9IG5ldyBMb2c0anMuTGV2ZWwoTG9nNGpzLkxldmVsLk9GRl9JTlQsICJPRkYiKTsNCi8qKiANCiAqIExvZ2dpbmcgTGV2ZWwgRmF0YWwNCiAqIEB0eXBlIExvZzRqcy5MZXZlbA0KICogQHN0YXRpYw0KICovDQpMb2c0anMuTGV2ZWwuRkFUQUwgPSBuZXcgTG9nNGpzLkxldmVsKExvZzRqcy5MZXZlbC5GQVRBTF9JTlQsICJGQVRBTCIpOw0KLyoqIA0KICogTG9nZ2luZyBMZXZlbCBFcnJvcg0KICogQHR5cGUgTG9nNGpzLkxldmVsDQogKiBAc3RhdGljDQogKi8NCkxvZzRqcy5MZXZlbC5FUlJPUiA9IG5ldyBMb2c0anMuTGV2ZWwoTG9nNGpzLkxldmVsLkVSUk9SX0lOVCwgIkVSUk9SIik7IA0KLyoqIA0KICogTG9nZ2luZyBMZXZlbCBXYXJuDQogKiBAdHlwZSBMb2c0anMuTGV2ZWwNCiAqIEBzdGF0aWMNCiAqLw0KTG9nNGpzLkxldmVsLldBUk4gPSBuZXcgTG9nNGpzLkxldmVsKExvZzRqcy5MZXZlbC5XQVJOX0lOVCwgIldBUk4iKTsgDQovKiogDQogKiBMb2dnaW5nIExldmVsIEluZm8NCiAqIEB0eXBlIExvZzRqcy5MZXZlbA0KICogQHN0YXRpYw0KICovDQpMb2c0anMuTGV2ZWwuSU5GTyA9IG5ldyBMb2c0anMuTGV2ZWwoTG9nNGpzLkxldmVsLklORk9fSU5ULCAiSU5GTyIpOyAgICAgDQovKiogDQogKiBMb2dnaW5nIExldmVsIERlYnVnDQogKiBAdHlwZSBMb2c0anMuTGV2ZWwNCiAqIEBzdGF0aWMNCiAqLw0KTG9nNGpzLkxldmVsLkRFQlVHID0gbmV3IExvZzRqcy5MZXZlbChMb2c0anMuTGV2ZWwuREVCVUdfSU5ULCAiREVCVUciKTsgIA0KLyoqIA0KICogTG9nZ2luZyBMZXZlbCBUcmFjZQ0KICogQHR5cGUgTG9nNGpzLkxldmVsDQogKiBAc3RhdGljDQogKi8NCkxvZzRqcy5MZXZlbC5UUkFDRSA9IG5ldyBMb2c0anMuTGV2ZWwoTG9nNGpzLkxldmVsLlRSQUNFX0lOVCwgIlRSQUNFIik7ICANCi8qKiANCiAqIExvZ2dpbmcgTGV2ZWwgQWxsIC0gQWxsIHRyYWNlcyBhcmUgZW5hYmxlZA0KICogQHR5cGUgTG9nNGpzLkxldmVsDQogKiBAc3RhdGljDQogKi8NCkxvZzRqcy5MZXZlbC5BTEwgPSBuZXcgTG9nNGpzLkxldmVsKExvZzRqcy5MZXZlbC5BTExfSU5ULCAiQUxMIik7IA0KDQovKioNCiAqIExvZzRqcyBDdXN0b21FdmVudA0KICogQGNvbnN0cnVjdG9yDQogKiBAYXV0aG9yIENvcmV5IEpvaG5zb24gLSBvcmlnaW5hbCBjb2RlIGluIEx1bWJlcmphY2sgKGh0dHA6Ly9nbGVlcGdsb3AuY29tL2phdmFzY3JpcHRzL2xvZ2dlci8pDQogKiBAYXV0aG9yIFNldGggQ2hpc2Ftb3JlIC0gYWRhcHRlZCBmb3IgTG9nNGpzDQogKiBAcHJpdmF0ZQ0KICovDQpMb2c0anMuQ3VzdG9tRXZlbnQgPSBmdW5jdGlvbigpIHsNCgl0aGlzLmxpc3RlbmVycyA9IFtdOw0KfTsNCg0KTG9nNGpzLkN1c3RvbUV2ZW50LnByb3RvdHlwZSA9IHsNCiANCiAJLyoqDQogCSAqIEBwYXJhbSBtZXRob2QgbWV0aG9kIHRvIGJlIGFkZGVkDQogCSAqLyANCglhZGRMaXN0ZW5lciA6IGZ1bmN0aW9uKG1ldGhvZCkgew0KCQl0aGlzLmxpc3RlbmVycy5wdXNoKG1ldGhvZCk7DQoJfSwNCg0KIAkvKioNCiAJICogQHBhcmFtIG1ldGhvZCBtZXRob2QgdG8gYmUgcmVtb3ZlZA0KIAkgKi8gDQoJcmVtb3ZlTGlzdGVuZXIgOiBmdW5jdGlvbihtZXRob2QpIHsNCgkJdmFyIGZvdW5kSW5kZXhlcyA9IHRoaXMuZmluZExpc3RlbmVySW5kZXhlcyhtZXRob2QpOw0KDQoJCWZvcih2YXIgaSA9IDA7IGkgPCBmb3VuZEluZGV4ZXMubGVuZ3RoOyBpKyspIHsNCgkJCXRoaXMubGlzdGVuZXJzLnNwbGljZShmb3VuZEluZGV4ZXNbaV0sIDEpOw0KCQl9DQoJfSwNCg0KIAkvKioNCiAJICogQHBhcmFtIGhhbmRsZXINCiAJICovIA0KCWRpc3BhdGNoIDogZnVuY3Rpb24oaGFuZGxlcikgew0KCQlmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5saXN0ZW5lcnMubGVuZ3RoOyBpKyspIHsNCgkJCXRyeSB7DQoJCQkJdGhpcy5saXN0ZW5lcnNbaV0oaGFuZGxlcik7DQoJCQl9DQoJCQljYXRjaCAoZSkgew0KCQkJCWxvZzRqc0xvZ2dlci53YXJuKCJDb3VsZCBub3QgcnVuIHRoZSBsaXN0ZW5lciAiICsgdGhpcy5saXN0ZW5lcnNbaV0gKyAiLiBcbiIgKyBlKTsNCgkJCX0NCgkJfQ0KCX0sDQoNCgkvKioNCgkgKiBAcHJpdmF0ZQ0KCSAqIEBwYXJhbSBtZXRob2QNCgkgKi8NCglmaW5kTGlzdGVuZXJJbmRleGVzIDogZnVuY3Rpb24obWV0aG9kKSB7DQoJCXZhciBpbmRleGVzID0gW107DQoJCWZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmxpc3RlbmVycy5sZW5ndGg7IGkrKykgewkJCQ0KCQkJaWYgKHRoaXMubGlzdGVuZXJzW2ldID09IG1ldGhvZCkgew0KCQkJCWluZGV4ZXMucHVzaChpKTsNCgkJCX0NCgkJfQ0KDQoJCXJldHVybiBpbmRleGVzOw0KCX0NCn07DQoNCi8qKg0KICogTW9kZWxzIGEgbG9nZ2luZyBldmVudC4NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIHtTdHJpbmd9IGNhdGVnb3J5TmFtZSBuYW1lIG9mIGNhdGVnb3J5DQogKiBAcGFyYW0ge0xvZzRqcy5MZXZlbH0gbGV2ZWwgbGV2ZWwgb2YgbWVzc2FnZQ0KICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgbWVzc2FnZSB0byBsb2cNCiAqIEBwYXJhbSB7TG9nNGpzLkxvZ2dlcn0gbG9nZ2VyIHRoZSBhc3NvY2lhdGVkIGxvZ2dlcg0KICogQGF1dGhvciBTZXRoIENoaXNhbW9yZQ0KICovDQpMb2c0anMuTG9nZ2luZ0V2ZW50ID0gZnVuY3Rpb24oY2F0ZWdvcnlOYW1lLCBsZXZlbCwgbWVzc2FnZSwgZXhjZXB0aW9uLCBsb2dnZXIpIHsNCgkvKioNCgkgKiB0aGUgdGltZXN0YW1wIG9mIHRoZSBMb2dnaW5nIEV2ZW50DQoJICogQHR5cGUgRGF0ZQ0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5zdGFydFRpbWUgPSBuZXcgRGF0ZSgpOw0KCS8qKg0KCSAqIGNhdGVnb3J5IG9mIGV2ZW50DQoJICogQHR5cGUgU3RyaW5nDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmNhdGVnb3J5TmFtZSA9IGNhdGVnb3J5TmFtZTsNCgkvKioNCgkgKiB0aGUgbG9nZ2luZyBtZXNzYWdlDQoJICogQHR5cGUgU3RyaW5nDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOw0KCS8qKg0KCSAqIHRoZSBsb2dnaW5nIGV4Y2VwdGlvbg0KCSAqIEB0eXBlIEV4Y2VwdGlvbg0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5leGNlcHRpb24gPSBleGNlcHRpb247DQoJLyoqDQoJICogbGV2ZWwgb2YgbG9nDQoJICogQHR5cGUgTG9nNGpzLkxldmVsDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmxldmVsID0gbGV2ZWw7DQoJLyoqDQoJICogcmVmZXJlbmNlIHRvIGxvZ2dlcg0KCSAqIEB0eXBlIExvZzRqcy5Mb2dnZXINCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXRoaXMubG9nZ2VyID0gbG9nZ2VyOw0KfTsNCg0KTG9nNGpzLkxvZ2dpbmdFdmVudC5wcm90b3R5cGUgPSB7CQ0KCS8qKg0KCSAqIGdldCB0aGUgdGltZXN0YW1wIGZvcm1hdHRlZCBhcyBTdHJpbmcuDQoJICogQHJldHVybiB7U3RyaW5nfSBmb3JtYXR0ZWQgdGltZXN0YW1wDQoJICogQHNlZSBMb2c0anMjc2V0RGF0ZUZvcm1hdCgpDQoJICovDQoJZ2V0Rm9ybWF0dGVkVGltZXN0YW1wOiBmdW5jdGlvbigpIHsNCgkJaWYodGhpcy5sb2dnZXIpIHsNCgkJCXJldHVybiB0aGlzLmxvZ2dlci5nZXRGb3JtYXR0ZWRUaW1lc3RhbXAodGhpcy5zdGFydFRpbWUpOw0KCQl9IGVsc2Ugew0KCQkJcmV0dXJuIHRoaXMuc3RhcnRUaW1lLnRvR01UU3RyaW5nKCk7DQoJCX0NCgl9DQp9Ow0KDQovKioNCiAqIExvZ2dlciB0byBsb2cgbWVzc2FnZXMgdG8gdGhlIGRlZmluZWQgYXBwZW5kZXIuPC9wPg0KICogRGVmYXVsdCBhcHBlbmRlciBpcyBBcHBlbmRlciwgd2hpY2ggaXMgaWdub3JpbmcgYWxsIG1lc3NhZ2VzLiBQbGVhc2UNCiAqIHVzZSBzZXRBcHBlbmRlcigpIHRvIHNldCBhIHNwZWNpZmljIGFwcGVuZGVyIChlLmcuIFdpbmRvd0FwcGVuZGVyKS4NCiAqIHVzZSB7QHNlZSBMb2c0anMjZ2V0TG9nZ2VyKFN0cmluZyl9IHRvIGdldCBhbiBpbnN0YW5jZS4NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIG5hbWUgbmFtZSBvZiBjYXRlZ29yeSB0byBsb2cgdG8NCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqLw0KTG9nNGpzLkxvZ2dlciA9IGZ1bmN0aW9uKG5hbWUpIHsNCgl0aGlzLmxvZ2dpbmdFdmVudHMgPSBbXTsNCgl0aGlzLmFwcGVuZGVycyA9IFtdOw0KCS8qKiBjYXRlZ29yeSBvZiBsb2dnZXIgKi8NCgl0aGlzLmNhdGVnb3J5ID0gbmFtZSB8fCAiIjsNCgkvKiogbGV2ZWwgdG8gYmUgbG9nZ2VkICovDQoJdGhpcy5sZXZlbCA9IExvZzRqcy5MZXZlbC5GQVRBTDsNCgkNCgl0aGlzLmRhdGVmb3JtYXQgPSBMb2c0anMuRGF0ZUZvcm1hdHRlci5ERUZBVUxUX0RBVEVfRk9STUFUOw0KCXRoaXMuZGF0ZWZvcm1hdHRlciA9IG5ldyBMb2c0anMuRGF0ZUZvcm1hdHRlcigpOw0KCQ0KCXRoaXMub25sb2cgPSBuZXcgTG9nNGpzLkN1c3RvbUV2ZW50KCk7DQoJdGhpcy5vbmNsZWFyID0gbmV3IExvZzRqcy5DdXN0b21FdmVudCgpOw0KCQ0KCS8qKiBhcHBlbmRlciB0byB3cml0ZSBpbiAqLw0KCXRoaXMuYXBwZW5kZXJzLnB1c2gobmV3IExvZzRqcy5BcHBlbmRlcih0aGlzKSk7DQoJDQoJLy8gaWYgbXVsdGlwbGUgbG9nIG9iamVjdHMgYXJlIGluc3RhbnRpYXRlZCB0aGlzIHdpbGwgb25seSBsb2cgdG8gdGhlIGxvZyANCgkvLyBvYmplY3QgdGhhdCBpcyBkZWNsYXJlZCBsYXN0IGNhbid0IHNlZW0gdG8gZ2V0IHRoZSBhdHRhY2hFdmVudCBtZXRob2QgdG8gDQoJLy8gd29yayBjb3JyZWN0bHkNCgl0cnkgew0KCQl3aW5kb3cub25lcnJvciA9IHRoaXMud2luZG93RXJyb3IuYmluZCh0aGlzKTsNCgl9IGNhdGNoIChlKSB7DQoJCS8vbG9nNGpzTG9nZ2VyLmZhdGFsKGUpOw0KCX0NCn07DQoNCkxvZzRqcy5Mb2dnZXIucHJvdG90eXBlID0gew0KDQoJLyoqDQoJICogYWRkIGFkZGl0aW9uYWwgYXBwZW5kZXIuIERlZmF1bHRBcHBlbmRlciBhbHdheXMgaXMgdGhlcmUuDQoJICogQHBhcmFtIGFwcGVuZGVyIGFkZGl0aW9uYWwgd2FudGVkIGFwcGVuZGVyDQoJICovDQoJYWRkQXBwZW5kZXI6IGZ1bmN0aW9uKGFwcGVuZGVyKSB7DQoJCWlmIChhcHBlbmRlciBpbnN0YW5jZW9mIExvZzRqcy5BcHBlbmRlcikgew0KCQkJYXBwZW5kZXIuc2V0TG9nZ2VyKHRoaXMpOw0KCQkJdGhpcy5hcHBlbmRlcnMucHVzaChhcHBlbmRlcik7CQkJDQoJCX0gZWxzZSB7DQoJCQl0aHJvdyAiTm90IGluc3RhbmNlIG9mIGFuIEFwcGVuZGVyOiAiICsgYXBwZW5kZXI7DQoJCX0NCgl9LA0KDQoJLyoqDQoJICogc2V0IEFycmF5IG9mIGFwcGVuZGVycy4gUHJldmlvdXMgQXBwZW5kZXJzIGFyZSBjbGVhcmVkIGFuZCByZW1vdmVkLg0KCSAqIEBwYXJhbSB7QXJyYXl9IGFwcGVuZGVycyBBcnJheSBvZiBBcHBlbmRlcnMNCgkgKi8NCglzZXRBcHBlbmRlcnM6IGZ1bmN0aW9uKGFwcGVuZGVycykgew0KCQkvL2NsZWFyIGZpcnN0IGFsbCBleGlzdGluZyBhcHBlbmRlcnMNCgkJZm9yKHZhciBpID0gMDsgaSA8IHRoaXMuYXBwZW5kZXJzLmxlbmd0aDsgaSsrKSB7DQoJCQl0aGlzLmFwcGVuZGVyc1tpXS5kb0NsZWFyKCk7DQoJCX0NCgkJDQoJCXRoaXMuYXBwZW5kZXJzID0gYXBwZW5kZXJzOw0KCQkNCgkJZm9yKHZhciBqID0gMDsgaiA8IHRoaXMuYXBwZW5kZXJzLmxlbmd0aDsgaisrKSB7DQoJCQl0aGlzLmFwcGVuZGVyc1tqXS5zZXRMb2dnZXIodGhpcyk7DQoJCX0NCgl9LA0KCQ0KCS8qKg0KCSAqIFNldCB0aGUgTG9nbGV2ZWwgZGVmYXVsdCBpcyBMb2dMRXZlbC5UUkFDRQ0KCSAqIEBwYXJhbSBsZXZlbCB3YW50ZWQgbG9nZ2luZyBsZXZlbA0KCSAqLw0KCXNldExldmVsOiBmdW5jdGlvbihsZXZlbCkgew0KCQl0aGlzLmxldmVsID0gbGV2ZWw7DQoJfSwNCgkNCgkvKiogDQoJICogbWFpbiBsb2cgbWV0aG9kIGxvZ2dpbmcgdG8gYWxsIGF2YWlsYWJsZSBhcHBlbmRlcnMgDQoJICogQHByaXZhdGUNCgkgKi8NCglsb2c6IGZ1bmN0aW9uKGxvZ0xldmVsLCBtZXNzYWdlLCBleGNlcHRpb24pIHsNCgkJdmFyIGxvZ2dpbmdFdmVudCA9IG5ldyBMb2c0anMuTG9nZ2luZ0V2ZW50KHRoaXMuY2F0ZWdvcnksIGxvZ0xldmVsLCANCgkJCW1lc3NhZ2UsIGV4Y2VwdGlvbiwgdGhpcyk7DQoJCXRoaXMubG9nZ2luZ0V2ZW50cy5wdXNoKGxvZ2dpbmdFdmVudCk7DQoJCXRoaXMub25sb2cuZGlzcGF0Y2gobG9nZ2luZ0V2ZW50KTsNCgl9LA0KCQ0KCS8qKiBjbGVhciBsb2dnaW5nICovDQoJY2xlYXIgOiBmdW5jdGlvbiAoKSB7DQoJCXRyeXsNCgkJCXRoaXMubG9nZ2luZ0V2ZW50cyA9IFtdOw0KCQkJdGhpcy5vbmNsZWFyLmRpc3BhdGNoKCk7DQoJCX0gY2F0Y2goZSl7fQ0KCX0sDQoJLyoqIGNoZWNrcyBpZiBMZXZlbCBUcmFjZSBpcyBlbmFibGVkICovDQoJaXNUcmFjZUVuYWJsZWQ6IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5sZXZlbC52YWx1ZU9mKCkgPD0gTG9nNGpzLkxldmVsLlRSQUNFLnZhbHVlT2YoKSkgew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgkJcmV0dXJuIGZhbHNlOw0KCX0sDQoJLyoqIA0KCSAqIFRyYWNlIG1lc3NhZ2VzIA0KCSAqIEBwYXJhbSBtZXNzYWdlIHtPYmplY3R9IG1lc3NhZ2UgdG8gYmUgbG9nZ2VkDQoJICovDQoJdHJhY2U6IGZ1bmN0aW9uKG1lc3NhZ2UpIHsNCgkJaWYgKHRoaXMuaXNUcmFjZUVuYWJsZWQoKSkgew0KCQkJdGhpcy5sb2coTG9nNGpzLkxldmVsLlRSQUNFLCBtZXNzYWdlLCBudWxsKTsNCgkJfQ0KCX0sDQoJLyoqIGNoZWNrcyBpZiBMZXZlbCBEZWJ1ZyBpcyBlbmFibGVkICovDQoJaXNEZWJ1Z0VuYWJsZWQ6IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5sZXZlbC52YWx1ZU9mKCkgPD0gTG9nNGpzLkxldmVsLkRFQlVHLnZhbHVlT2YoKSkgew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgkJcmV0dXJuIGZhbHNlOw0KCX0sDQoJLyoqIA0KCSAqIERlYnVnIG1lc3NhZ2VzIA0KCSAqIEBwYXJhbSBtZXNzYWdlIHtPYmplY3R9IG1lc3NhZ2UgdG8gYmUgbG9nZ2VkDQoJICovDQoJZGVidWc6IGZ1bmN0aW9uKG1lc3NhZ2UpIHsNCgkJaWYgKHRoaXMuaXNEZWJ1Z0VuYWJsZWQoKSkgew0KCQkJdGhpcy5sb2coTG9nNGpzLkxldmVsLkRFQlVHLCBtZXNzYWdlLCBudWxsKTsNCgkJfQ0KCX0sDQoJLyoqDQoJICogRGVidWcgbWVzc2FnZXMgDQoJICogQHBhcmFtIHtPYmplY3R9IG1lc3NhZ2UgIG1lc3NhZ2UgdG8gYmUgbG9nZ2VkDQoJICogQHBhcmFtIHtUaHJvd2FibGV9IHRocm93YWJsZSANCgkgKi8NCglkZWJ1ZzogZnVuY3Rpb24obWVzc2FnZSwgdGhyb3dhYmxlKSB7DQoJCWlmICh0aGlzLmlzRGVidWdFbmFibGVkKCkpIHsNCgkJCXRoaXMubG9nKExvZzRqcy5MZXZlbC5ERUJVRywgbWVzc2FnZSwgdGhyb3dhYmxlKTsNCgkJfQ0KCX0sCQ0KCS8qKiBjaGVja3MgaWYgTGV2ZWwgSW5mbyBpcyBlbmFibGVkICovDQoJaXNJbmZvRW5hYmxlZDogZnVuY3Rpb24oKSB7DQoJCWlmICh0aGlzLmxldmVsLnZhbHVlT2YoKSA8PSBMb2c0anMuTGV2ZWwuSU5GTy52YWx1ZU9mKCkpIHsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9LA0KCS8qKiANCgkgKiBsb2dnaW5nIGluZm8gbWVzc2FnZXMgDQoJICogQHBhcmFtIHtPYmplY3R9IG1lc3NhZ2UgIG1lc3NhZ2UgdG8gYmUgbG9nZ2VkDQoJICovDQoJaW5mbzogZnVuY3Rpb24obWVzc2FnZSkgew0KCQlpZiAodGhpcy5pc0luZm9FbmFibGVkKCkpIHsNCgkJCXRoaXMubG9nKExvZzRqcy5MZXZlbC5JTkZPLCBtZXNzYWdlLCBudWxsKTsNCgkJfQ0KCX0sDQoJLyoqIA0KCSAqIGxvZ2dpbmcgaW5mbyBtZXNzYWdlcyANCgkgKiBAcGFyYW0ge09iamVjdH0gbWVzc2FnZSAgbWVzc2FnZSB0byBiZSBsb2dnZWQNCgkgKiBAcGFyYW0ge1Rocm93YWJsZX0gdGhyb3dhYmxlICANCgkgKi8NCglpbmZvOiBmdW5jdGlvbihtZXNzYWdlLCB0aHJvd2FibGUpIHsNCgkJaWYgKHRoaXMuaXNJbmZvRW5hYmxlZCgpKSB7DQoJCQl0aGlzLmxvZyhMb2c0anMuTGV2ZWwuSU5GTywgbWVzc2FnZSwgdGhyb3dhYmxlKTsNCgkJfQ0KCX0sDQoJLyoqIGNoZWNrcyBpZiBMZXZlbCBXYXJuIGlzIGVuYWJsZWQgKi8NCglpc1dhcm5FbmFibGVkOiBmdW5jdGlvbigpIHsNCgkJaWYgKHRoaXMubGV2ZWwudmFsdWVPZigpIDw9IExvZzRqcy5MZXZlbC5XQVJOLnZhbHVlT2YoKSkgew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgkJcmV0dXJuIGZhbHNlOw0KCX0sDQoNCgkvKiogbG9nZ2luZyB3YXJuIG1lc3NhZ2VzICovDQoJd2FybjogZnVuY3Rpb24obWVzc2FnZSkgew0KCQlpZiAodGhpcy5pc1dhcm5FbmFibGVkKCkpIHsNCgkJCXRoaXMubG9nKExvZzRqcy5MZXZlbC5XQVJOLCBtZXNzYWdlLCBudWxsKTsNCgkJfQ0KCX0sDQoJLyoqIGxvZ2dpbmcgd2FybiBtZXNzYWdlcyAqLw0KCXdhcm46IGZ1bmN0aW9uKG1lc3NhZ2UsIHRocm93YWJsZSkgew0KCQlpZiAodGhpcy5pc1dhcm5FbmFibGVkKCkpIHsNCgkJCXRoaXMubG9nKExvZzRqcy5MZXZlbC5XQVJOLCBtZXNzYWdlLCB0aHJvd2FibGUpOw0KCQl9DQoJfSwNCgkvKiogY2hlY2tzIGlmIExldmVsIEVycm9yIGlzIGVuYWJsZWQgKi8NCglpc0Vycm9yRW5hYmxlZDogZnVuY3Rpb24oKSB7DQoJCWlmICh0aGlzLmxldmVsLnZhbHVlT2YoKSA8PSBMb2c0anMuTGV2ZWwuRVJST1IudmFsdWVPZigpKSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KCQlyZXR1cm4gZmFsc2U7DQoJfSwNCgkvKiogbG9nZ2luZyBlcnJvciBtZXNzYWdlcyAqLw0KCWVycm9yOiBmdW5jdGlvbihtZXNzYWdlKSB7DQoJCWlmICh0aGlzLmlzRXJyb3JFbmFibGVkKCkpIHsNCgkJCXRoaXMubG9nKExvZzRqcy5MZXZlbC5FUlJPUiwgbWVzc2FnZSwgbnVsbCk7DQoJCX0NCgl9LA0KCS8qKiBsb2dnaW5nIGVycm9yIG1lc3NhZ2VzICovDQoJZXJyb3I6IGZ1bmN0aW9uKG1lc3NhZ2UsIHRocm93YWJsZSkgew0KCQlpZiAodGhpcy5pc0Vycm9yRW5hYmxlZCgpKSB7DQoJCQl0aGlzLmxvZyhMb2c0anMuTGV2ZWwuRVJST1IsIG1lc3NhZ2UsIHRocm93YWJsZSk7DQoJCX0NCgl9LA0KCS8qKiBjaGVja3MgaWYgTGV2ZWwgRmF0YWwgaXMgZW5hYmxlZCAqLw0KCWlzRmF0YWxFbmFibGVkOiBmdW5jdGlvbigpIHsNCgkJaWYgKHRoaXMubGV2ZWwudmFsdWVPZigpIDw9IExvZzRqcy5MZXZlbC5GQVRBTC52YWx1ZU9mKCkpIHsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9LA0KCS8qKiBsb2dnaW5nIGZhdGFsIG1lc3NhZ2VzICovDQoJZmF0YWw6IGZ1bmN0aW9uKG1lc3NhZ2UpIHsNCgkJaWYgKHRoaXMuaXNGYXRhbEVuYWJsZWQoKSkgew0KCQkJdGhpcy5sb2coTG9nNGpzLkxldmVsLkZBVEFMLCBtZXNzYWdlLCBudWxsKTsNCgkJfQ0KCX0sDQoJLyoqIGxvZ2dpbmcgZmF0YWwgbWVzc2FnZXMgKi8NCglmYXRhbDogZnVuY3Rpb24obWVzc2FnZSwgdGhyb3dhYmxlKSB7DQoJCWlmICh0aGlzLmlzRmF0YWxFbmFibGVkKCkpIHsNCgkJCXRoaXMubG9nKExvZzRqcy5MZXZlbC5GQVRBTCwgbWVzc2FnZSwgdGhyb3dhYmxlKTsNCgkJfQ0KCX0sCQ0KCS8qKiANCgkgKiBDYXB0dXJlIG1haW4gd2luZG93IGVycm9ycyBhbmQgbG9nIGFzIGZhdGFsLg0KCSAqIEBwcml2YXRlDQoJICovDQoJd2luZG93RXJyb3I6IGZ1bmN0aW9uKG1zZywgdXJsLCBsaW5lKXsNCgkJdmFyIG1lc3NhZ2UgPSAiRXJyb3IgaW4gKCIgKyAodXJsIHx8IHdpbmRvdy5sb2NhdGlvbikgKyAiKSBvbiBsaW5lICIrIGxpbmUgKyIgd2l0aCBtZXNzYWdlICgiICsgbXNnICsgIikiOw0KCQl0aGlzLmxvZyhMb2c0anMuTGV2ZWwuRkFUQUwsIG1lc3NhZ2UsIG51bGwpOwkNCgl9LA0KCQ0KCS8qKg0KCSAqIFNldCB0aGUgZGF0ZSBmb3JtYXQgb2YgbG9nZ2VyLiBGb2xsb3dpbmcgc3dpdGNoZXMgYXJlIHN1cHBvcnRlZDoNCgkgKiA8dWw+DQoJICogPGxpPnl5eXkgLSBUaGUgeWVhcjwvbGk+DQoJICogPGxpPk1NIC0gdGhlIG1vbnRoPC9saT4NCgkgKiA8bGk+ZGQgLSB0aGUgZGF5IG9mIG1vbnRoPGxpPg0KCSAqIDxsaT5oaCAtIHRoZSBob3VyPGxpPg0KCSAqIDxsaT5tbSAtIG1pbnV0ZXM8L2xpPg0KCSAqIDxsaT5PIC0gdGltZXpvbmUgb2Zmc2V0PC9saT4NCgkgKiA8L3VsPg0KCSAqIEBwYXJhbSB7U3RyaW5nfSBmb3JtYXQgZm9ybWF0IFN0cmluZyBmb3IgdGhlIGRhdGUNCgkgKiBAc2VlICNnZXRUaW1lc3RhbXANCgkgKi8NCglzZXREYXRlRm9ybWF0OiBmdW5jdGlvbihmb3JtYXQpIHsNCgkgCXRoaXMuZGF0ZWZvcm1hdCA9IGZvcm1hdDsNCgl9LA0KCSANCgkvKioNCgkgKiBHZW5lcmF0ZXMgYSB0aW1lc3RhbXAgdXNpbmcgdGhlIGZvcm1hdCBzZXQgaW4ge0xvZzRqcy5zZXREYXRlRm9ybWF0fS4NCgkgKiBAcGFyYW0ge0RhdGV9IGRhdGUgdGhlIGRhdGUgdG8gZm9ybWF0DQoJICogQHNlZSAjc2V0RGF0ZUZvcm1hdA0KCSAqIEByZXR1cm4gQSBmb3JtYXR0ZWQgdGltZXN0YW1wIHdpdGggdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZS4NCgkgKi8NCglnZXRGb3JtYXR0ZWRUaW1lc3RhbXA6IGZ1bmN0aW9uKGRhdGUpIHsNCgkgIHJldHVybiB0aGlzLmRhdGVmb3JtYXR0ZXIuZm9ybWF0RGF0ZShkYXRlLCB0aGlzLmRhdGVmb3JtYXQpOw0KCX0NCn07DQoNCi8qKg0KICogQWJzdHJhY3QgYmFzZSBjbGFzcyBmb3Igb3RoZXIgYXBwZW5kZXJzLiANCiAqIEl0IGlzIGRvaW5nIG5vdGhpbmcuDQogKg0KICogQGNvbnN0cnVjdG9yDQogKiBAcGFyYW0ge0xvZzRqcy5Mb2dnZXJ9IGxvZ2dlciBsb2c0anMgaW5zdGFuY2UgdGhpcyBhcHBlbmRlciBpcyBhdHRhY2hlZCB0bw0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuQXBwZW5kZXIgPSBmdW5jdGlvbiAoKSB7DQoJLyoqDQoJICogUmVmZXJlbmNlIHRvIGNhbGxpbmcgbG9nZ2VyDQoJICogQHR5cGUgTG9nNGpzLkxvZ2dlcg0KCSAqIEBwcml2YXRlDQoJICovDQoJIHRoaXMubG9nZ2VyID0gbnVsbDsNCn07DQoNCkxvZzRqcy5BcHBlbmRlci5wcm90b3R5cGUgPSB7DQoJLyoqIA0KCSAqIGFwcGVuZHMgdGhlIGdpdmVuIGxvZ2dpbmdFdmVudCBhcHBlbmRlciBzcGVjaWZpYw0KCSAqIEBwYXJhbSB7TG9nNGpzLkxvZ2dpbmdFdmVudH0gbG9nZ2luZ0V2ZW50IGxvZ2dpbmdFdmVudCB0byBhcHBlbmQNCgkgKi8NCglkb0FwcGVuZDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCXJldHVybjsNCgl9LA0KCS8qKiANCgkgKiBjbGVhcnMgdGhlIEFwcGVuZGVyDQoJICovDQoJZG9DbGVhcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybjsNCgl9LA0KCQ0KCS8qKg0KCSAqIFNldCB0aGUgTGF5b3V0IGZvciB0aGlzIGFwcGVuZGVyLg0KCSAqIEBwYXJhbSB7TG9nNGpzLkxheW91dH0gbGF5b3V0IExheW91dCBmb3IgZm9ybWF0dGluZyBsb2dnaW5nRXZlbnQNCgkgKi8NCglzZXRMYXlvdXQ6IGZ1bmN0aW9uKGxheW91dCl7DQoJCXRoaXMubGF5b3V0ID0gbGF5b3V0Ow0KCX0sDQoJLyoqDQoJICogU2V0IHJlZmVyZW5jZSB0byB0aGUgbG9nZ2VyLg0KCSAqIEBwYXJhbSB7TG9nNGpzLkxvZ2dlcn0gdGhlIGludm9raW5nIGxvZ2dlcg0KCSAqLw0KCXNldExvZ2dlcjogZnVuY3Rpb24obG9nZ2VyKXsNCgkJLy8gYWRkIGxpc3RlbmVyIHRvIHRoZSBsb2dnZXIgbWV0aG9kcw0KCQlsb2dnZXIub25sb2cuYWRkTGlzdGVuZXIoTG9nNGpzLmJpbmQodGhpcy5kb0FwcGVuZCwgdGhpcykpOw0KCQlsb2dnZXIub25jbGVhci5hZGRMaXN0ZW5lcihMb2c0anMuYmluZCh0aGlzLmRvQ2xlYXIsIHRoaXMpKTsNCgkNCgkJdGhpcy5sb2dnZXIgPSBsb2dnZXI7DQoJfQ0KfTsNCg0KLyoqDQogKiBJbnRlcmZhY2UgZm9yIExheW91dHMuDQogKiBVc2UgdGhpcyBMYXlvdXQgYXMgImludGVyZmFjZSIgZm9yIG90aGVyIExheW91dHMuIEl0IGlzIGRvaW5nIG5vdGhpbmcuDQogKg0KICogQGNvbnN0cnVjdG9yDQogKiBAYXV0aG9yIFN0ZXBoYW4gU3RyaXR0bWF0dGVyDQogKi8NCkxvZzRqcy5MYXlvdXQgPSBmdW5jdGlvbigpe307DQpMb2c0anMuTGF5b3V0LnByb3RvdHlwZSA9IHsNCgkvKiogDQoJICogSW1wbGVtZW50IHRoaXMgbWV0aG9kIHRvIGNyZWF0ZSB5b3VyIG93biBsYXlvdXQgZm9ybWF0Lg0KCSAqIEBwYXJhbSB7TG9nNGpzLkxvZ2dpbmdFdmVudH0gbG9nZ2luZ0V2ZW50IGxvZ2dpbmdFdmVudCB0byBmb3JtYXQNCgkgKiBAcmV0dXJuIGZvcm1hdHRlZCBTdHJpbmcNCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglmb3JtYXQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQlyZXR1cm4gIiI7DQoJfSwNCgkvKiogDQoJICogUmV0dXJucyB0aGUgY29udGVudCB0eXBlIG91dHB1dCBieSB0aGlzIGxheW91dC4gDQoJICogQHJldHVybiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zICJ0ZXh0L3BsYWluIi4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRDb250ZW50VHlwZTogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAidGV4dC9wbGFpbiI7DQoJfSwNCgkvKiogDQoJICogQHJldHVybiBSZXR1cm5zIHRoZSBoZWFkZXIgZm9yIHRoZSBsYXlvdXQgZm9ybWF0LiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zIG51bGwuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0SGVhZGVyOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIG51bGw7DQoJfSwNCgkvKiogDQoJICogQHJldHVybiBSZXR1cm5zIHRoZSBmb290ZXIgZm9yIHRoZSBsYXlvdXQgZm9ybWF0LiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zIG51bGwuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0Rm9vdGVyOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIG51bGw7DQoJfSwNCgkNCgkvKioNCgkgKiBAcmV0dXJuIFNlcGFyYXRvciBiZXR3ZWVuIGV2ZW50cw0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldFNlcGFyYXRvcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiIjsNCgl9DQp9Ow0KDQovKioNCiAqIENvbnNvbGUgQXBwZW5kZXIgd3JpdGVzIHRoZSBsb2dzIHRvIGEgY29uc29sZS4gIElmICJpbmxpbmUiIGlzDQogKiBzZXQgdG8gImZhbHNlIiB0aGUgY29uc29sZSBsYXVuY2hlcyBpbiBhbm90aGVyIHdpbmRvdyBvdGhlcndpc2UNCiAqIHRoZSB3aW5kb3cgaXMgaW5saW5lIG9uIHRoZSBwYWdlIGFuZCB0b2dnbGVkIG9uIGFuZCBvZmYgd2l0aCAiQWx0LUQiLg0KICogTm90ZTogQXQgRmlyZUZveCAmZ2I7IDIuMCB0aGUga2V5c3Ryb2tlIGlzIGxpdHRsZSBkaWZmZXJlbnQgbm93OiAiU0hJRlQrQUxUK0QiLg0KICoNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkFwcGVuZGVyDQogKiBAcGFyYW0ge2Jvb2xlYW59IGlzSW5saW5lIGJvb2xlYW4gdmFsdWUgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciB0aGUgY29uc29sZSBiZSBwbGFjZWQgaW5saW5lLCBkZWZhdWx0IGlzIHRvIGxhdW5jaCBpbiBuZXcgd2luZG93DQogKg0KICogQGF1dGhvciBDb3JleSBKb2huc29uIC0gb3JpZ2luYWwgY29uc29sZSBjb2RlIGluIEx1bWJlcmphY2sgKGh0dHA6Ly9nbGVlcGdsb3AuY29tL2phdmFzY3JpcHRzL2xvZ2dlci8pDQogKiBAYXV0aG9yIFNldGggQ2hpc2Ftb3JlIC0gYWRhcHRlZCBmb3IgdXNlIGFzIGEgbG9nNGpzIGFwcGVuZGVyDQogKi8NCkxvZzRqcy5Db25zb2xlQXBwZW5kZXIgPSBmdW5jdGlvbihpc0lubGluZSkgew0KCQ0KCS8qKg0KCSAqIEB0eXBlIExvZzRqcy5MYXlvdXQNCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXRoaXMubGF5b3V0ID0gbmV3IExvZzRqcy5QYXR0ZXJuTGF5b3V0KExvZzRqcy5QYXR0ZXJuTGF5b3V0LlRUQ0NfQ09OVkVSU0lPTl9QQVRURVJOKTsNCgkvKioNCgkgKiBAdHlwZSBib29sZWFuDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmlubGluZSA9IGlzSW5saW5lOw0KDQoJLyoqDQoJICogQHR5cGUgU3RyaW5nDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmFjY2Vzc2tleSA9ICJkIjsNCgkNCgkvKioNCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXRoaXMudGFnUGF0dGVybiA9IG51bGw7DQoJDQoJdGhpcy5jb21tYW5kSGlzdG9yeSA9IFtdOw0KICAJdGhpcy5jb21tYW5kSW5kZXggPSAwOw0KICAJDQogIAkvKioNCiAgCSAqIHRydWUgaWYgcG9wdXAgaXMgYmxvY2tlZC4NCiAgCSAqLw0KICAJdGhpcy5wb3B1cEJsb2NrZXIgPSBmYWxzZTsNCiAgCQ0KICAJLyoqDQogIAkgKiBjdXJyZW50IG91dHB1dCBkaXYtZWxlbWVudC4NCiAgCSAqLw0KICAJdGhpcy5vdXRwdXRFbGVtZW50ID0gbnVsbDsNCiAgCQ0KICAJdGhpcy5kb2NSZWZlcmVuY2UgPSBudWxsOw0KCXRoaXMud2luUmVmZXJlbmNlID0gbnVsbDsJCQ0KCQkNCglpZih0aGlzLmlubGluZSkgew0KCQlMb2c0anMuYXR0YWNoRXZlbnQod2luZG93LCAnbG9hZCcsIExvZzRqcy5iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcykpOw0KCX0NCn07DQoNCkxvZzRqcy5Db25zb2xlQXBwZW5kZXIucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkFwcGVuZGVyKCksIHsgIA0KDQoJLyoqDQoJICogU2V0IHRoZSBhY2Nlc3Mga2V5IHRvIHNob3cvaGlkZSB0aGUgaW5saW5lIGNvbnNvbGUgKGRlZmF1bHQgJnF1b3RlO2QmcXVvdGU7KQ0KCSAqIEBwYXJhbSBrZXkgYWNjZXNzIGtleSB0byBzaG93L2hpZGUgdGhlIGlubGluZSBjb25zb2xlDQoJICovCQ0KCXNldEFjY2Vzc0tleSA6IGZ1bmN0aW9uKGtleSkgew0KCQl0aGlzLmFjY2Vzc2tleSA9IGtleTsNCgl9LA0KDQoJLyoqDQoJICogQHByaXZhdGUNCgkgKi8NCiAgCWluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsNCgkJDQoJCWlmKCF0aGlzLmlubGluZSkgew0KDQoJCQl2YXIgd2luTmFtZSA9IHRoaXMubWFrZVdpbk5hbWUodGhpcy5sb2dnZXIuY2F0ZWdvcnkpOw0KDQoJCQl3aW5kb3cudG9wLmNvbnNvbGVXaW5kb3cgPSB3aW5kb3cub3BlbigiIiwgd2luTmFtZSwgDQoJCQkJImxlZnQ9MCx0b3A9MCx3aWR0aD03MDAsaGVpZ2h0PTcwMCxzY3JvbGxiYXJzPW5vLHN0YXR1cz1ubyxyZXNpemFibGU9eWVzO3Rvb2xiYXI9bm8iKTsgICAgICAgICAgICANCgkJCXdpbmRvdy50b3AuY29uc29sZVdpbmRvdy5vcGVuZXIgPSBzZWxmOw0KCQkJdmFyIHdpbiA9IHdpbmRvdy50b3AuY29uc29sZVdpbmRvdzsNCgkJCQkJCQkJDQoJCQlpZiAoIXdpbikgeyANCgkJCQl0aGlzLnBvcHVwQmxvY2tlcj10cnVlOyANCgkJCQlhbGVydCgiUG9wdXAgd2luZG93IG1hbmFnZXIgYmxvY2tpbmcgdGhlIExvZzRqcyBwb3B1cCB3aW5kb3cgdG8gYmVkaXNwbGF5ZWQuXG5cbiIgDQoJCQkJCSsgIlBsZWFzZSBkaXNhYmxlZCB0aGlzIHRvIHByb3Blcmx5IHNlZSBsb2dnZWQgZXZlbnRzLiIpOyAgDQoJCQl9IGVsc2UgewkNCgkJCQl2YXIgZG9jID0gd2luLmRvY3VtZW50Ow0KCQkJCWRvYy5vcGVuKCk7DQoJCQkJZG9jLndyaXRlKCI8IURPQ1RZUEUgaHRtbCBQVUJMSUMgLS8vVzNDLy9EVEQgWEhUTUwgMS4wIFRyYW5zaXRpb25hbC8vRU4gIik7DQoJCQkJZG9jLndyaXRlKCIgIGh0dHA6Ly93d3cudzMub3JnL1RSL3hodG1sMS9EVEQveGh0bWwxLXRyYW5zaXRpb25hbC5kdGQ+XG5cbiIpOw0KCQkJCWRvYy53cml0ZSgiPGh0bWw+PGhlYWQ+PHRpdGxlPkxvZzRqcyAtICIgKyB0aGlzLmxvZ2dlci5jYXRlZ29yeSArICI8L3RpdGxlPlxuIik7DQoJCQkJZG9jLndyaXRlKCI8L2hlYWQ+PGJvZHkgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOmRhcmtncmF5XCI+PC9ib2R5PlxuIik7DQoJCQkJd2luLmJsdXIoKTsNCgkJCQl3aW4uZm9jdXMoKTsNCgkJCX0NCgkJCQ0KCQkJdGhpcy5kb2NSZWZlcmVuY2UgPSBkb2M7DQoJCQl0aGlzLndpblJlZmVyZW5jZSA9IHdpbjsNCgkJfSBlbHNlIHsNCgkJCXRoaXMuZG9jUmVmZXJlbmNlID0gZG9jdW1lbnQ7DQoJCQl0aGlzLndpblJlZmVyZW5jZSA9IHdpbmRvdzsJCQkNCgkJfQ0KCQkJCQ0KCQl0aGlzLm91dHB1dENvdW50ID0gMDsNCgkJdGhpcy50YWdQYXR0ZXJuID0gIi4qIjsNCgkgIA0KCQkvLyBJIGhhdGUgd3JpdGluZyBqYXZhc2NyaXB0IGluIEhUTUwuLi4gYnV0IHdoYXQncyBhIGJldHRlciBhbHRlcm5hdGl2ZQ0KCQl0aGlzLmxvZ0VsZW1lbnQgPSB0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCgkJdGhpcy5kb2NSZWZlcmVuY2UuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmxvZ0VsZW1lbnQpOw0KCQl0aGlzLmxvZ0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCgkJDQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7DQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS5sZWZ0ID0gJzBweCc7DQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS53aWR0aCA9ICcxMDAlJzsNCgkNCgkJdGhpcy5sb2dFbGVtZW50LnN0eWxlLnRleHRBbGlnbiA9ICJsZWZ0IjsNCgkJdGhpcy5sb2dFbGVtZW50LnN0eWxlLmZvbnRGYW1pbHkgPSAibHVjaWRhIGNvbnNvbGUiOw0KCQl0aGlzLmxvZ0VsZW1lbnQuc3R5bGUuZm9udFNpemUgPSAiMTAwJSI7DQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnZGFya2dyYXknOyAgICAgIA0KCQl0aGlzLmxvZ0VsZW1lbnQuc3R5bGUub3BhY2l0eSA9IDAuOTsNCgkJdGhpcy5sb2dFbGVtZW50LnN0eWxlLnpJbmRleCA9IDIwMDA7IA0KCQ0KCQkvLyBBZGQgdG9vbGJhckVsZW1lbnQNCgkJdGhpcy50b29sYmFyRWxlbWVudCA9IHRoaXMuZG9jUmVmZXJlbmNlLmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KCQl0aGlzLmxvZ0VsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy50b29sYmFyRWxlbWVudCk7ICAgICANCgkJdGhpcy50b29sYmFyRWxlbWVudC5zdHlsZS5wYWRkaW5nID0gIjAgMCAwIDJweCI7DQoJDQoJCS8vIEFkZCBidXR0b25zICAgICAgICANCgkJdGhpcy5idXR0b25zQ29udGFpbmVyRWxlbWVudCA9IHRoaXMuZG9jUmVmZXJlbmNlLmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsNCgkJdGhpcy50b29sYmFyRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmJ1dHRvbnNDb250YWluZXJFbGVtZW50KTsgDQoJDQoJCWlmKHRoaXMuaW5saW5lKSB7DQoJCQl2YXIgY2xvc2VCdXR0b24gPSB0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsNCgkJCWNsb3NlQnV0dG9uLnN0eWxlLmNzc0Zsb2F0ID0gInJpZ2h0IjsNCgkJCWNsb3NlQnV0dG9uLnN0eWxlLnN0eWxlRmxvYXQgPSAicmlnaHQiOyAvLyBJRSBkb20gYnVnLi4uZG9lc24ndCB1bmRlcnN0YW5kIGNzc0Zsb2F0DQoJCQljbG9zZUJ1dHRvbi5zdHlsZS5jb2xvciA9ICJibGFjayI7DQoJCQljbG9zZUJ1dHRvbi5pbm5lckhUTUwgPSAiY2xvc2UiOw0KCQkJY2xvc2VCdXR0b24ub25jbGljayA9IExvZzRqcy5iaW5kKHRoaXMudG9nZ2xlLCB0aGlzKTsNCgkJCXRoaXMuYnV0dG9uc0NvbnRhaW5lckVsZW1lbnQuYXBwZW5kQ2hpbGQoY2xvc2VCdXR0b24pOw0KCQl9DQoJCQ0KCQl2YXIgY2xlYXJCdXR0b24gPSB0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsNCgkJY2xlYXJCdXR0b24uc3R5bGUuY3NzRmxvYXQgPSAicmlnaHQiOw0KCQljbGVhckJ1dHRvbi5zdHlsZS5zdHlsZUZsb2F0ID0gInJpZ2h0IjsgLy8gSUUgZG9tIGJ1Zy4uLmRvZXNuJ3QgdW5kZXJzdGFuZCBjc3NGbG9hdA0KCQljbGVhckJ1dHRvbi5zdHlsZS5jb2xvciA9ICJibGFjayI7DQoJCWNsZWFyQnV0dG9uLmlubmVySFRNTCA9ICJjbGVhciI7DQoJCWNsZWFyQnV0dG9uLm9uY2xpY2sgPSBMb2c0anMuYmluZCh0aGlzLmxvZ2dlci5jbGVhciwgdGhpcy5sb2dnZXIpOw0KCQl0aGlzLmJ1dHRvbnNDb250YWluZXJFbGVtZW50LmFwcGVuZENoaWxkKGNsZWFyQnV0dG9uKTsNCgkNCg0KCQkvL0FkZCBDYXRlZ29yeU5hbWUgYW5kICBMZXZlbCBGaWx0ZXINCgkJdGhpcy50YWdGaWx0ZXJDb250YWluZXJFbGVtZW50ID0gdGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlRWxlbWVudCgnc3BhbicpOw0KCQl0aGlzLnRvb2xiYXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudGFnRmlsdGVyQ29udGFpbmVyRWxlbWVudCk7DQoJCXRoaXMudGFnRmlsdGVyQ29udGFpbmVyRWxlbWVudC5zdHlsZS5jc3NGbG9hdCA9ICdsZWZ0JzsNCgkJDQoJCXRoaXMudGFnRmlsdGVyQ29udGFpbmVyRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVUZXh0Tm9kZSgiTG9nNGpzIC0gIiArIHRoaXMubG9nZ2VyLmNhdGVnb3J5KSk7DQoJCXRoaXMudGFnRmlsdGVyQ29udGFpbmVyRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVUZXh0Tm9kZSgiIHwgTGV2ZWwgRmlsdGVyOiAiKSk7DQoJCQ0KCQl0aGlzLnRhZ0ZpbHRlckVsZW1lbnQgPSB0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOw0KCQl0aGlzLnRhZ0ZpbHRlckNvbnRhaW5lckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy50YWdGaWx0ZXJFbGVtZW50KTsNCgkJdGhpcy50YWdGaWx0ZXJFbGVtZW50LnN0eWxlLndpZHRoID0gJzIwMHB4JzsgICAgICAgICAgICAgICAgICAgIA0KCQl0aGlzLnRhZ0ZpbHRlckVsZW1lbnQudmFsdWUgPSB0aGlzLnRhZ1BhdHRlcm47ICAgIA0KCQl0aGlzLnRhZ0ZpbHRlckVsZW1lbnQuc2V0QXR0cmlidXRlKCdhdXRvY29tcGxldGUnLCAnb2ZmJyk7IC8vIFNvIEZpcmVmb3ggZG9lc24ndCBmbGlwIG91dA0KCQkNCgkJTG9nNGpzLmF0dGFjaEV2ZW50KHRoaXMudGFnRmlsdGVyRWxlbWVudCwgJ2tleXVwJywgTG9nNGpzLmJpbmQodGhpcy51cGRhdGVUYWdzLCB0aGlzKSk7DQoJCUxvZzRqcy5hdHRhY2hFdmVudCh0aGlzLnRhZ0ZpbHRlckVsZW1lbnQsICdjbGljaycsIExvZzRqcy5iaW5kKCBmdW5jdGlvbigpIHt0aGlzLnRhZ0ZpbHRlckVsZW1lbnQuc2VsZWN0KCk7fSwgdGhpcykpOw0KCQkNCgkJLy8gQWRkIG91dHB1dEVsZW1lbnQNCgkJdGhpcy5vdXRwdXRFbGVtZW50ID0gdGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQoJCXRoaXMubG9nRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLm91dHB1dEVsZW1lbnQpOyAgDQoJCXRoaXMub3V0cHV0RWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9ICJhdXRvIjsgICAgICAgICAgICAgIA0KCQl0aGlzLm91dHB1dEVsZW1lbnQuc3R5bGUuY2xlYXIgPSAiYm90aCI7DQoJCXRoaXMub3V0cHV0RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAodGhpcy5pbmxpbmUpID8gKCIyMDBweCIpOigiNjUwcHgiKTsNCgkJdGhpcy5vdXRwdXRFbGVtZW50LnN0eWxlLndpZHRoID0gIjEwMCUiOw0KCQl0aGlzLm91dHB1dEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2JsYWNrJzsgDQoJCQkgIA0KCQl0aGlzLmlucHV0Q29udGFpbmVyRWxlbWVudCA9IHRoaXMuZG9jUmVmZXJlbmNlLmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KCQl0aGlzLmlucHV0Q29udGFpbmVyRWxlbWVudC5zdHlsZS53aWR0aCA9ICIxMDAlIjsNCgkJdGhpcy5sb2dFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuaW5wdXRDb250YWluZXJFbGVtZW50KTsgICAgICANCgkJDQoJCXRoaXMuaW5wdXRFbGVtZW50ID0gdGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsNCgkJdGhpcy5pbnB1dENvbnRhaW5lckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5pbnB1dEVsZW1lbnQpOyAgDQoJCXRoaXMuaW5wdXRFbGVtZW50LnN0eWxlLndpZHRoID0gJzEwMCUnOw0KCQl0aGlzLmlucHV0RWxlbWVudC5zdHlsZS5ib3JkZXJXaWR0aCA9ICcwcHgnOyAvLyBJbnB1dHMgd2l0aCAxMDAlIHdpZHRoIGFsd2F5cyBzZWVtIHRvIGJlIHRvbyBsYXJnZSAoSSBIQVRFIFRIRU0pIHRoZXkgb25seSB3b3JrIGlmIHRoZSBib3JkZXIsIG1hcmdpbiBhbmQgcGFkZGluZyBhcmUgMA0KCQl0aGlzLmlucHV0RWxlbWVudC5zdHlsZS5tYXJnaW4gPSAnMHB4JzsNCgkJdGhpcy5pbnB1dEVsZW1lbnQuc3R5bGUucGFkZGluZyA9ICcwcHgnOw0KCQl0aGlzLmlucHV0RWxlbWVudC52YWx1ZSA9ICdUeXBlIGNvbW1hbmQgaGVyZSc7IA0KCQl0aGlzLmlucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2F1dG9jb21wbGV0ZScsICdvZmYnKTsgLy8gU28gRmlyZWZveCBkb2Vzbid0IGZsaXAgb3V0DQoJDQoJCUxvZzRqcy5hdHRhY2hFdmVudCh0aGlzLmlucHV0RWxlbWVudCwgJ2tleXVwJywgTG9nNGpzLmJpbmQodGhpcy5oYW5kbGVJbnB1dCwgdGhpcykpOw0KCQlMb2c0anMuYXR0YWNoRXZlbnQodGhpcy5pbnB1dEVsZW1lbnQsICdjbGljaycsIExvZzRqcy5iaW5kKCBmdW5jdGlvbigpIHt0aGlzLmlucHV0RWxlbWVudC5zZWxlY3QoKTt9LCB0aGlzKSk7DQoJCQ0KCQlpZih0aGlzLmlubGluZSl7DQoJCQl3aW5kb3cuc2V0SW50ZXJ2YWwoTG9nNGpzLmJpbmQodGhpcy5yZXBvc2l0aW9uV2luZG93LCB0aGlzKSwgNTAwKTsNCgkJCXRoaXMucmVwb3NpdGlvbldpbmRvdygpOwkNCgkJCS8vIEFsbG93IGFjZXNzIGtleSBsaW5rICAgICAgICAgIA0KCQkJdmFyIGFjY2Vzc0VsZW1lbnQgPSB0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsNCgkJCWFjY2Vzc0VsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOw0KCQkJYWNjZXNzRWxlbWVudC5zdHlsZS50b3AgPSAiLTEwMHB4IjsNCgkJCWFjY2Vzc0VsZW1lbnQuYWNjZXNzS2V5ID0gdGhpcy5hY2Nlc3NrZXk7DQoJCQlhY2Nlc3NFbGVtZW50Lm9uY2xpY2sgPSBMb2c0anMuYmluZCh0aGlzLnRvZ2dsZSwgdGhpcyk7DQoJCQl0aGlzLmRvY1JlZmVyZW5jZS5ib2R5LmFwcGVuZENoaWxkKGFjY2Vzc0VsZW1lbnQpOw0KCQl9IGVsc2Ugew0KCQkJdGhpcy5zaG93KCk7DQoJCX0NCgl9LA0KCS8qKg0KCSAqIHNob3dzL2hpZGUgYW4gZWxlbWVudA0KCSAqIEBwcml2YXRlDQoJICogQHJldHVybiB0cnVlIGlmIHNob3duDQoJICovDQoJdG9nZ2xlIDogZnVuY3Rpb24oKSB7DQoJCWlmICh0aGlzLmxvZ0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9PSAnbm9uZScpIHsNCgkJIAl0aGlzLnNob3coKTsNCgkJIAlyZXR1cm4gdHJ1ZTsNCgkJfSBlbHNlIHsNCgkJCXRoaXMuaGlkZSgpOw0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJfSwgDQoJLyoqDQoJICogQHByaXZhdGUNCgkgKi8NCglzaG93IDogZnVuY3Rpb24oKSB7DQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7DQoJICAJdGhpcy5vdXRwdXRFbGVtZW50LnNjcm9sbFRvcCA9IHRoaXMub3V0cHV0RWxlbWVudC5zY3JvbGxIZWlnaHQ7IC8vIFNjcm9sbCB0byBib3R0b20gd2hlbiB0b2dnbGVkDQogCSAgCXRoaXMuaW5wdXRFbGVtZW50LnNlbGVjdCgpOw0KCX0sIA0KCS8qKg0KCSAqIEBwcml2YXRlDQoJICovCQ0KCWhpZGUgOiBmdW5jdGlvbigpIHsNCgkJdGhpcy5sb2dFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQoJfSwgIA0KCS8qKg0KCSAqIEBwcml2YXRlDQoJICogQHBhcmFtIG1lc3NhZ2UNCgkgKiBAc3R5bGUNCgkgKi8JDQoJb3V0cHV0IDogZnVuY3Rpb24obWVzc2FnZSwgc3R5bGUpIHsNCg0KCQkvLyBJZiB3ZSBhcmUgYXQgdGhlIGJvdHRvbSBvZiB0aGUgd2luZG93LCB0aGVuIGtlZXAgc2Nyb2xsaW5nIHdpdGggdGhlIG91dHB1dAkJCQ0KCQl2YXIgc2hvdWxkU2Nyb2xsID0gKHRoaXMub3V0cHV0RWxlbWVudC5zY3JvbGxUb3AgKyAoMiAqIHRoaXMub3V0cHV0RWxlbWVudC5jbGllbnRIZWlnaHQpKSA+PSB0aGlzLm91dHB1dEVsZW1lbnQuc2Nyb2xsSGVpZ2h0Ow0KICAgICAgICAgICAgICAgIA0KCQl0aGlzLm91dHB1dENvdW50Kys7DQoJICAJc3R5bGUgPSAoc3R5bGUgPyBzdHlsZSArPSAnOycgOiAnJyk7CSAgCQ0KCSAgCXN0eWxlICs9ICdwYWRkaW5nOjFweDttYXJnaW46MCAwIDVweCAwJzsJICAgICANCgkJICANCgkJaWYgKHRoaXMub3V0cHV0Q291bnQgJSAyID09PSAwKSB7DQoJCQlzdHlsZSArPSAiO2JhY2tncm91bmQtY29sb3I6IzEwMTAxMCI7DQoJCX0NCgkgIAkNCgkgIAltZXNzYWdlID0gbWVzc2FnZSB8fCAidW5kZWZpbmVkIjsNCgkgIAltZXNzYWdlID0gbWVzc2FnZS50b1N0cmluZygpOw0KICAgICAgICAgICAgICAgIA0KCSAgCXRoaXMub3V0cHV0RWxlbWVudC5pbm5lckhUTUwgKz0gIjxwcmUgc3R5bGU9JyIgKyBzdHlsZSArICInPiIgKyBtZXNzYWdlICsgIjwvcHJlPiI7DQogICAgICAgICAgICAgICAgDQoJICAJaWYgKHNob3VsZFNjcm9sbCkgewkJCQkNCgkJCXRoaXMub3V0cHV0RWxlbWVudC5zY3JvbGxUb3AgPSB0aGlzLm91dHB1dEVsZW1lbnQuc2Nyb2xsSGVpZ2h0Ow0KCQl9DQoJfSwNCgkNCgkvKioNCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXVwZGF0ZVRhZ3MgOiBmdW5jdGlvbigpIHsNCgkJDQoJCXZhciBwYXR0ZXJuID0gdGhpcy50YWdGaWx0ZXJFbGVtZW50LnZhbHVlOw0KCQ0KCQlpZiAodGhpcy50YWdQYXR0ZXJuID09IHBhdHRlcm4pIHsNCgkJCXJldHVybjsNCgkJfQ0KCQkNCgkJdHJ5IHsNCgkJCW5ldyBSZWdFeHAocGF0dGVybik7DQoJCX0gY2F0Y2ggKGUpIHsNCgkJCXJldHVybjsNCgkJfQ0KCQkNCgkJdGhpcy50YWdQYXR0ZXJuID0gcGF0dGVybjsNCg0KCQl0aGlzLm91dHB1dEVsZW1lbnQuaW5uZXJIVE1MID0gIiI7DQoJCQ0KCQkvLyBHbyB0aHJvdWdoIGVhY2ggbG9nIGVudHJ5IGFnYWluDQoJCXRoaXMub3V0cHV0Q291bnQgPSAwOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubG9nZ2VyLmxvZ2dpbmdFdmVudHMubGVuZ3RoOyBpKyspIHsNCiAgCQkJdGhpcy5kb0FwcGVuZCh0aGlzLmxvZ2dlci5sb2dnaW5nRXZlbnRzW2ldKTsNCgkJfSAgDQoJfSwNCg0KCS8qKg0KCSAqIEBwcml2YXRlDQoJICovCQ0KCXJlcG9zaXRpb25XaW5kb3cgOiBmdW5jdGlvbigpIHsNCgkJdmFyIG9mZnNldCA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCB0aGlzLmRvY1JlZmVyZW5jZS5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IHRoaXMuZG9jUmVmZXJlbmNlLmJvZHkuc2Nyb2xsVG9wOw0KCQl2YXIgcGFnZUhlaWdodCA9IHNlbGYuaW5uZXJIZWlnaHQgfHwgdGhpcy5kb2NSZWZlcmVuY2UuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCB0aGlzLmRvY1JlZmVyZW5jZS5ib2R5LmNsaWVudEhlaWdodDsNCgkJdGhpcy5sb2dFbGVtZW50LnN0eWxlLnRvcCA9IChvZmZzZXQgKyBwYWdlSGVpZ2h0IC0gdGhpcy5sb2dFbGVtZW50Lm9mZnNldEhlaWdodCkgKyAicHgiOw0KCX0sDQoNCgkvKioNCgkgKiBAcGFyYW0gbG9nZ2luZ0V2ZW50IGV2ZW50IHRvIGJlIGxvZ2dlZA0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQXBwZW5kDQoJICovDQoJZG9BcHBlbmQgOiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJDQoJCWlmKHRoaXMucG9wdXBCbG9ja2VyKSB7DQoJCQkvL3BvcHVwIGJsb2NrZWQsIHdlIHJldHVybiBpbiB0aGlzIGNhc2UNCgkJCXJldHVybjsNCgkJfQ0KCQkNCgkJaWYgKCghdGhpcy5pbmxpbmUpICYmICghdGhpcy53aW5SZWZlcmVuY2UgfHwgdGhpcy53aW5SZWZlcmVuY2UuY2xvc2VkKSkgew0KCQkJdGhpcy5pbml0aWFsaXplKCk7DQoJCX0NCgkJDQoJCWlmICh0aGlzLnRhZ1BhdHRlcm4gIT09IG51bGwgJiYgDQoJCQlsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKS5zZWFyY2gobmV3IFJlZ0V4cCh0aGlzLnRhZ1BhdHRlcm4sICdpZ20nKSkgPT0gLTEpIHsNCgkJCXJldHVybjsNCgkJfQ0KCQkNCgkJdmFyIHN0eWxlID0gJyc7DQoJICAJDQoJCWlmIChsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKS5zZWFyY2goL0VSUk9SLykgIT0gLTEpIHsgDQoJCQlzdHlsZSArPSAnY29sb3I6cmVkJzsNCgkJfSBlbHNlIGlmIChsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKS5zZWFyY2goL0ZBVEFMLykgIT0gLTEpIHsgDQoJCQlzdHlsZSArPSAnY29sb3I6cmVkJzsNCgkJfSBlbHNlIGlmIChsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKS5zZWFyY2goL1dBUk4vKSAhPSAtMSkgeyANCgkJCXN0eWxlICs9ICdjb2xvcjpvcmFuZ2UnOw0KCQl9IGVsc2UgaWYgKGxvZ2dpbmdFdmVudC5sZXZlbC50b1N0cmluZygpLnNlYXJjaCgvREVCVUcvKSAhPSAtMSkgew0KCQkJc3R5bGUgKz0gJ2NvbG9yOmdyZWVuJzsNCgkJfSBlbHNlIGlmIChsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKS5zZWFyY2goL0lORk8vKSAhPSAtMSkgew0KCQkJc3R5bGUgKz0gJ2NvbG9yOndoaXRlJzsNCgkJfSBlbHNlIHsNCgkJCXN0eWxlICs9ICdjb2xvcjp5ZWxsb3cnOw0KCQl9DQoJDQoJCXRoaXMub3V0cHV0KHRoaXMubGF5b3V0LmZvcm1hdChsb2dnaW5nRXZlbnQpLCBzdHlsZSk7CQ0KCX0sDQoNCgkvKioNCgkgKiBAc2VlIExvZzRqcy5BcHBlbmRlciNkb0NsZWFyDQoJICovDQoJZG9DbGVhciA6IGZ1bmN0aW9uKCkgew0KCQl0aGlzLm91dHB1dEVsZW1lbnQuaW5uZXJIVE1MID0gIiI7DQoJfSwNCgkvKioNCgkgKiBAcHJpdmF0ZQ0KCSAqIEBwYXJhbSBlDQoJICovDQoJaGFuZGxlSW5wdXQgOiBmdW5jdGlvbihlKSB7DQoJCWlmIChlLmtleUNvZGUgPT0gMTMgKSB7ICAgICAgDQoJCQl2YXIgY29tbWFuZCA9IHRoaXMuaW5wdXRFbGVtZW50LnZhbHVlOw0KCQkJDQoJCQlzd2l0Y2goY29tbWFuZCkgew0KCQkJCWNhc2UgImNsZWFyIjoNCgkJCQkJdGhpcy5sb2dnZXIuY2xlYXIoKTsgIA0KCQkJCQlicmVhazsNCgkJCQkJDQoJCQkJZGVmYXVsdDogICAgICAgIA0KCQkJCQl2YXIgY29uc29sZU91dHB1dCA9ICIiOw0KCQkJCQ0KCQkJCQl0cnkgew0KCQkJCQkJY29uc29sZU91dHB1dCA9IGV2YWwodGhpcy5pbnB1dEVsZW1lbnQudmFsdWUpOw0KCQkJCQl9IGNhdGNoIChlKSB7ICANCgkJCQkJCXRoaXMubG9nZ2VyLmVycm9yKCJQcm9ibGVtIHBhcnNpbmcgaW5wdXQgPCIgKyBjb21tYW5kICsgIj4iICsgZS5tZXNzYWdlKTsNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJCQkNCgkJCQkJdGhpcy5sb2dnZXIudHJhY2UoY29uc29sZU91dHB1dCk7DQoJCQkJCWJyZWFrOw0KCQkJfSAgICAgICAgDQoJCQ0KCQkJaWYgKHRoaXMuaW5wdXRFbGVtZW50LnZhbHVlICE9PSAiIiAmJiB0aGlzLmlucHV0RWxlbWVudC52YWx1ZSAhPT0gdGhpcy5jb21tYW5kSGlzdG9yeVswXSkgew0KCQkJCXRoaXMuY29tbWFuZEhpc3RvcnkudW5zaGlmdCh0aGlzLmlucHV0RWxlbWVudC52YWx1ZSk7DQoJCQl9DQoJCSAgDQoJCQl0aGlzLmNvbW1hbmRJbmRleCA9IDA7DQoJCQl0aGlzLmlucHV0RWxlbWVudC52YWx1ZSA9ICIiOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQoJCX0gZWxzZSBpZiAoZS5rZXlDb2RlID09IDM4ICYmIHRoaXMuY29tbWFuZEhpc3RvcnkubGVuZ3RoID4gMCkgew0KICAgIAkJdGhpcy5pbnB1dEVsZW1lbnQudmFsdWUgPSB0aGlzLmNvbW1hbmRIaXN0b3J5W3RoaXMuY29tbWFuZEluZGV4XTsNCg0KCQkJaWYgKHRoaXMuY29tbWFuZEluZGV4IDwgdGhpcy5jb21tYW5kSGlzdG9yeS5sZW5ndGggLSAxKSB7DQogICAgICAJCQl0aGlzLmNvbW1hbmRJbmRleCArPSAxOw0KICAgICAgCQl9DQogICAgCX0gZWxzZSBpZiAoZS5rZXlDb2RlID09IDQwICYmIHRoaXMuY29tbWFuZEhpc3RvcnkubGVuZ3RoID4gMCkgew0KICAgIAkJaWYgKHRoaXMuY29tbWFuZEluZGV4ID4gMCkgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAJCQl0aGlzLmNvbW1hbmRJbmRleCAtPSAxOw0KCSAgICAJfSAgICAgICAgICAgICAgICAgICAgICAgDQoNCgkJCXRoaXMuaW5wdXRFbGVtZW50LnZhbHVlID0gdGhpcy5jb21tYW5kSGlzdG9yeVt0aGlzLmNvbW1hbmRJbmRleF07DQoJICAJfSBlbHNlIHsNCiAgICAJCXRoaXMuY29tbWFuZEluZGV4ID0gMDsNCiAgICAJfQ0KCX0sDQoNCgkvKioNCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCW1ha2VXaW5OYW1lOiBmdW5jdGlvbihjYXRlZ29yeSkgew0KCQlyZXR1cm4gY2F0ZWdvcnkucmVwbGFjZSgvW15cZFx3XS9nLCAiXyIpOw0KCX0sDQogICAgICAgICAgICAgICAgDQoJLyoqIA0KCSAqIHRvU3RyaW5nDQoJICovDQoJIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsNCgkgCXJldHVybiAiTG9nNGpzLkNvbnNvbGVBcHBlbmRlcltpbmxpbmU9IiArIHRoaXMuaW5saW5lICsgIl0iOyANCgkgfQ0KfSk7IA0KDQovKioNCiAqIE1ldGF0YWcgQXBwZW5kZXIgd3JpdGluZyB0aGUgbG9ncyB0byBtZXRhIHRhZ3MNCiAqDQogKiBAZXh0ZW5kcyBMb2c0anMuQXBwZW5kZXINCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIGxvZ2dlciBsb2c0anMgaW5zdGFuY2UgdGhpcyBhcHBlbmRlciBpcyBhdHRhY2hlZCB0bw0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuTWV0YXRhZ0FwcGVuZGVyID0gZnVuY3Rpb24oKSB7DQoJdGhpcy5jdXJyZW50TGluZSA9IDA7DQp9Ow0KTG9nNGpzLk1ldGF0YWdBcHBlbmRlci5wcm90b3R5cGUgPSBMb2c0anMuZXh0ZW5kKG5ldyBMb2c0anMuQXBwZW5kZXIoKSwgeyAgDQoJLyoqDQoJICogQHBhcmFtIGxvZ2dpbmdFdmVudCBldmVudCB0byBiZSBsb2dnZWQNCgkgKiBAc2VlIExvZzRqcy5BcHBlbmRlciNkb0FwcGVuZA0KCSAqLw0KCWRvQXBwZW5kOiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJdmFyIG5vdyA9IG5ldyBEYXRlKCk7DQoJCXZhciBsaW5lcyA9IGxvZ2dpbmdFdmVudC5tZXNzYWdlLnNwbGl0KCJcbiIpOw0KCQl2YXIgaGVhZFRhZyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF07DQoNCgkJZm9yICh2YXIgaSA9IDE7IGkgPD0gbGluZXMubGVuZ3RoOyBpKyspIHsNCgkJCXZhciB2YWx1ZSA9IGxpbmVzW2kgLSAxXTsNCgkJCWlmIChpID09IDEpIHsNCgkJCQl2YWx1ZSA9IGxvZ2dpbmdFdmVudC5sZXZlbC50b1N0cmluZygpICsgIjogIiArIHZhbHVlOw0KCQkJfSBlbHNlIHsNCgkJCQl2YWx1ZSA9ICI+ICIgKyB2YWx1ZTsNCgkJCX0NCg0KCQkJdmFyIG1ldGFUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJtZXRhIik7DQoJCQltZXRhVGFnLnNldEF0dHJpYnV0ZSgibmFtZSIsICJYLWxvZzRqczoiICsgdGhpcy5jdXJyZW50TGluZSk7DQoJCQltZXRhVGFnLnNldEF0dHJpYnV0ZSgiY29udGVudCIsIHZhbHVlKTsNCgkJCWhlYWRUYWcuYXBwZW5kQ2hpbGQobWV0YVRhZyk7DQoJCQl0aGlzLmN1cnJlbnRMaW5lICs9IDE7DQoJCX0NCgl9LA0KDQoJLyoqIA0KCSAqIHRvU3RyaW5nDQoJICovDQoJIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsNCgkgCXJldHVybiAiTG9nNGpzLk1ldGF0YWdBcHBlbmRlciI7IA0KCSB9DQp9KTsNCg0KLyoqDQogKiBBSkFYIEFwcGVuZGVyIHNlbmRpbmcge0BsaW5rIExvZzRqcy5Mb2dnaW5nRXZlbnR9cyBhc3luY2hyb24gdmlhIA0KICogPGNvZGU+WE1MSHR0cFJlcXVlc3Q8L2NvZGU+IHRvIHNlcnZlci48YnIgLz4NCiAqIFRoZSB7QGxpbmsgTG9nNGpzLkxvZ2dpbmdFdmVudH0gaXMgUE9TVGVkIGFzIHJlc3BvbnNlIGNvbnRlbnQgYW5kIGlzIA0KICogZm9ybWF0dGVkIGJ5IHRoZSBhY2NvY2lhdGVkIGxheW91dC4gRGVmYXVsdCBsYXlvdXQgaXMge0BsaW5rIExvZzRqcy5YTUxMYXlvdXR9LiANCiAqIFRoZSA8Y29kZT50aHJlc2hvbGQ8L2NvZGU+IGRlZmluZXMgd2hlbiB0aGUgbG9ncyANCiAqIHNob3VsZCBiZSBzZW5kIHRvIHRoZSBzZXJ2ZXIuIEJ5IGRlZmF1bHQgZXZlcnkgZXZlbnQgaXMgc2VudCBvbiBpdHMNCiAqIG93biAodGhyZXNob2xkPTEpLiBJZiBpdCBpcyBzZXQgdG8gMTAsIHRoZW4gdGhlIGV2ZW50cyBhcmUgc2VuZCBpbiBncm91cHMgb2YNCiAqIDEwIGV2ZW50cy4NCiAqDQogKiBAZXh0ZW5kcyBMb2c0anMuQXBwZW5kZXIgDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7TG9nNGpzLkxvZ2dlcn0gbG9nZ2VyIGxvZzRqcyBpbnN0YW5jZSB0aGlzIGFwcGVuZGVyIGlzIGF0dGFjaGVkIHRvDQogKiBAcGFyYW0ge1N0cmluZ30gbG9nZ2luZ1VybCB1cmwgd2hlcmUgYXBwZW5kZXIgd2lsbCBwb3N0IGxvZyBtZXNzYWdlcyB0bw0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuQWpheEFwcGVuZGVyID0gZnVuY3Rpb24obG9nZ2luZ1VybCkgew0KDQoJLyoqDQoJICogaXMgc3RpbGwgZXNuZGluZyBkYXRhIHRvIHNlcnZlcg0KCSAqIEB0eXBlIGJvb2xlYW4NCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXRoaXMuaXNJblByb2dyZXNzID0gZmFsc2U7DQoJDQoJLyoqDQoJICogQHR5cGUgU3RyaW5nDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmxvZ2dpbmdVcmwgPSBsb2dnaW5nVXJsIHx8ICJsb2dnaW5nLmxvZzRqcyI7DQoJDQoJLyoqDQoJICogQHR5cGUgSW50ZWdlcg0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy50aHJlc2hvbGQgPSAxOw0KCQ0KCS8qKg0KCSAqIHRpbWVvdXQgd2hlbiByZXF1ZXN0IGlzIGFib3J0ZWQuDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLnRpbWVvdXQgPSAyMDAwOw0KCQ0KCS8qKg0KCSAqIExpc3Qgb2YgTG9nZ2luZ0V2ZW50cyB3aGljaCBzaG91bGQgYmUgc2VuZCBhZnRlciB0aHJlc2hvbGQgaXMgcmVhY2hlZC4NCgkgKiBAdHlwZSBNYXANCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXRoaXMubG9nZ2luZ0V2ZW50TWFwID0gbmV3IExvZzRqcy5GaWZvQnVmZmVyKCk7DQoNCgkvKioNCgkgKiBAdHlwZSBMb2c0anMuTGF5b3V0DQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmxheW91dCA9IG5ldyBMb2c0anMuWE1MTGF5b3V0KCk7DQoJLyoqDQoJICogQHR5cGUgWE1MSHR0cFJlcXVlc3QNCgkgKiBAcHJpdmF0ZQ0KCSAqLwkNCgl0aGlzLmh0dHBSZXF1ZXN0ID0gbnVsbDsNCn07DQoNCkxvZzRqcy5BamF4QXBwZW5kZXIucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkFwcGVuZGVyKCksIHsgIA0KCS8qKg0KCSAqIHNlbmRzIHRoZSBsb2dzIHRvIHRoZSBzZXJ2ZXINCgkgKiBAcGFyYW0gbG9nZ2luZ0V2ZW50IGV2ZW50IHRvIGJlIGxvZ2dlZA0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQXBwZW5kDQoJICovDQoJZG9BcHBlbmQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQlsb2c0anNMb2dnZXIudHJhY2UoIj4gQWpheEFwcGVuZGVyLmFwcGVuZCIpOw0KCQ0KCQlpZiAodGhpcy5sb2dnaW5nRXZlbnRNYXAubGVuZ3RoKCkgPD0gdGhpcy50aHJlc2hvbGQgfHwgdGhpcy5pc0luUHJvZ3Jlc3MgPT09IHRydWUpIHsNCgkJCXRoaXMubG9nZ2luZ0V2ZW50TWFwLnB1c2gobG9nZ2luZ0V2ZW50KTsNCgkJfQ0KCQkNCgkJaWYodGhpcy5sb2dnaW5nRXZlbnRNYXAubGVuZ3RoKCkgPj0gdGhpcy50aHJlc2hvbGQgJiYgdGhpcy5pc0luUHJvZ3Jlc3MgPT09IGZhbHNlKSB7DQoJCQkvL2lmIHRocmVzaG9sZCBpcyByZWFjaGVkIHNlbmQgdGhlIGV2ZW50cyBhbmQgcmVzZXQgY3VycmVudCB0aHJlc2hvbGQNCgkJCXRoaXMuc2VuZCgpOw0KCQl9DQoJCQ0KCQlsb2c0anNMb2dnZXIudHJhY2UoIjwgQWpheEFwcGVuZGVyLmFwcGVuZCIpOw0KCX0sDQoJDQoJLyoqIEBzZWUgQXBwZW5kZXIjZG9DbGVhciAqLw0KCWRvQ2xlYXI6IGZ1bmN0aW9uKCkgew0KCQlsb2c0anNMb2dnZXIudHJhY2UoIj4gQWpheEFwcGVuZGVyLmRvQ2xlYXIiICk7DQoJCWlmKHRoaXMubG9nZ2luZ0V2ZW50TWFwLmxlbmd0aCgpID4gMCkgew0KCQkJdGhpcy5zZW5kKCk7DQoJCX0NCgkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI8IEFqYXhBcHBlbmRlci5kb0NsZWFyIiApOw0KCX0sDQoJDQoJLyoqDQoJICogU2V0IHRoZSB0aHJlc2hvbGQgd2hlbiBsb2dzIGhhdmUgdG8gYmUgc2VuZC4gRGVmYXVsdCB0aHJlc2hvbGQgaXMgMS4NCgkgKiBAcHJhcmFtIHtpbnR9IHRocmVzaG9sZCBuZXcgdGhyZXNob2xkDQoJICovDQoJc2V0VGhyZXNob2xkOiBmdW5jdGlvbih0aHJlc2hvbGQpIHsNCgkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI+IEFqYXhBcHBlbmRlci5zZXRUaHJlc2hvbGQ6ICIgKyB0aHJlc2hvbGQgKTsNCgkJdGhpcy50aHJlc2hvbGQgPSB0aHJlc2hvbGQ7DQoJCWxvZzRqc0xvZ2dlci50cmFjZSgiPCBBamF4QXBwZW5kZXIuc2V0VGhyZXNob2xkIiApOw0KCX0sDQoJDQoJLyoqDQoJICogU2V0IHRoZSB0aW1lb3V0IGluIG1pbGxpIHNlY29uZHMgdW50aWwgc2VuZGluZyByZXF1ZXN0IGlzIGFib3J0ZWQuDQoJICogRGVmYXVsdCBpcyAyMDAwIG1zLg0KCSAqIEBwYXJhbSB7aW50fSBtaWxsaXNlY29uZHMgdGhlIG5ldyB0aW1lb3V0DQoJICovDQoJc2V0VGltZW91dDogZnVuY3Rpb24obWlsbGlzZWNvbmRzKSB7DQoJCXRoaXMudGltZW91dCA9IG1pbGxpc2Vjb25kczsNCgl9LA0KCQ0KCS8qKg0KCSAqIHNlbmQgdGhlIHJlcXVlc3QuDQoJICovDQoJc2VuZDogZnVuY3Rpb24oKSB7DQoJCWlmKHRoaXMubG9nZ2luZ0V2ZW50TWFwLmxlbmd0aCgpID4wKSB7DQoJCQkNCgkJCWxvZzRqc0xvZ2dlci50cmFjZSgiPiBBamF4QXBwZW5kZXIuc2VuZCIpOw0KCQkJDQoJCQkNCgkJCXRoaXMuaXNJblByb2dyZXNzID0gdHJ1ZTsNCgkJCXZhciBhID0gW107DQoJDQoJCQlmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5sb2dnaW5nRXZlbnRNYXAubGVuZ3RoKCkgJiYgaSA8IHRoaXMudGhyZXNob2xkOyBpKyspIHsNCgkJCQlhLnB1c2godGhpcy5sYXlvdXQuZm9ybWF0KHRoaXMubG9nZ2luZ0V2ZW50TWFwLnB1bGwoKSkpOw0KCQkJfSANCgkJCQkJDQoJCQl2YXIgY29udGVudCA9IHRoaXMubGF5b3V0LmdldEhlYWRlcigpOwkNCgkJCWNvbnRlbnQgKz0gYS5qb2luKHRoaXMubGF5b3V0LmdldFNlcGFyYXRvcigpKTsNCgkJCWNvbnRlbnQgKz0gdGhpcy5sYXlvdXQuZ2V0Rm9vdGVyKCk7DQoJCQkNCgkJCXZhciBhcHBlbmRlciA9IHRoaXM7DQoJCQlpZih0aGlzLmh0dHBSZXF1ZXN0ID09PSBudWxsKXsNCgkJCQl0aGlzLmh0dHBSZXF1ZXN0ID0gdGhpcy5nZXRYbWxIdHRwUmVxdWVzdCgpOw0KCQkJfQ0KCQkJdGhpcy5odHRwUmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsNCgkJCQlhcHBlbmRlci5vblJlYWR5U3RhdGVDaGFuZ2VkLmNhbGwoYXBwZW5kZXIpOw0KCQkJfTsNCgkJCQ0KCQkJdGhpcy5odHRwUmVxdWVzdC5vcGVuKCJQT1NUIiwgdGhpcy5sb2dnaW5nVXJsLCB0cnVlKTsNCgkJCS8vIHNldCB0aGUgcmVxdWVzdCBoZWFkZXJzLg0KCQkJLy90aGlzLmh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtdHlwZSIsICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsNCgkJCXRoaXMuaHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC10eXBlIiwgdGhpcy5sYXlvdXQuZ2V0Q29udGVudFR5cGUoKSk7DQoJCQkvL1JFRkVSRVIgd2lsbCBiZSB0aGUgdG9wLWxldmVsDQoJCQkvLyBVUkkgd2hpY2ggbWF5IGRpZmZlciBmcm9tIHRoZSBsb2NhdGlvbiBvZiB0aGUgZXJyb3IgaWYNCgkJCS8vIGl0IG9jY3VycyBpbiBhbiBpbmNsdWRlZCAuanMgZmlsZQ0KCQkJdGhpcy5odHRwUmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCJSRUZFUkVSIiwgbG9jYXRpb24uaHJlZik7DQoJIAkJdGhpcy5odHRwUmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LWxlbmd0aCIsIGNvbnRlbnQubGVuZ3RoKTsNCgkJCXRoaXMuaHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcigiQ29ubmVjdGlvbiIsICJjbG9zZSIpOw0KCQkJdGhpcy5odHRwUmVxdWVzdC5zZW5kKCBjb250ZW50ICk7DQoJCQkNCgkJCWFwcGVuZGVyID0gdGhpczsNCgkJCQ0KCQkJdHJ5IHsNCgkJCQl3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpew0KCQkJCQlsb2c0anNMb2dnZXIudHJhY2UoIj4gQWpheEFwcGVuZGVyLnRpbWVvdXQiKTsNCgkJCQkJYXBwZW5kZXIuaHR0cFJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKXtyZXR1cm47fTsNCgkJCQkJYXBwZW5kZXIuaHR0cFJlcXVlc3QuYWJvcnQoKTsNCgkJCQkJLy90aGlzLmh0dHBSZXF1ZXN0ID0gbnVsbDsNCgkJCQkJYXBwZW5kZXIuaXNJblByb2dyZXNzID0gZmFsc2U7DQoJCQ0KCQkJCQlpZihhcHBlbmRlci5sb2dnaW5nRXZlbnRNYXAubGVuZ3RoKCkgPiAwKSB7DQoJCQkJCQlhcHBlbmRlci5zZW5kKCk7DQoJCQkJCX0NCgkJCQkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI8IEFqYXhBcHBlbmRlci50aW1lb3V0Iik7DQoJCQkJfSwgdGhpcy50aW1lb3V0KTsNCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQlsb2c0anNMb2dnZXIuZmF0YWwoZSk7DQoJCQl9DQoJCQlsb2c0anNMb2dnZXIudHJhY2UoIj4gQWpheEFwcGVuZGVyLnNlbmQiKTsNCgkJfQ0KCX0sDQoJDQoJLyoqDQoJICogQHByaXZhdGUNCgkgKi8NCglvblJlYWR5U3RhdGVDaGFuZ2VkOiBmdW5jdGlvbigpIHsNCgkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI+IEFqYXhBcHBlbmRlci5vblJlYWR5U3RhdGVDaGFuZ2VkIik7DQoJCXZhciByZXEgPSB0aGlzLmh0dHBSZXF1ZXN0Ow0KCQlpZiAodGhpcy5odHRwUmVxdWVzdC5yZWFkeVN0YXRlICE9IDQpIHsgDQoJCQlsb2c0anNMb2dnZXIudHJhY2UoIjwgQWpheEFwcGVuZGVyLm9uUmVhZHlTdGF0ZUNoYW5nZWQ6IHJlYWR5U3RhdGUgIiArIHJlcS5yZWFkeVN0YXRlICsgIiAhPSA0Iik7DQoJCQlyZXR1cm47IA0KCQl9DQoJCQ0KCQl2YXIgc3VjY2VzcyA9ICgodHlwZW9mIHJlcS5zdGF0dXMgPT09ICJ1bmRlZmluZWQiKSB8fCByZXEuc3RhdHVzID09PSAwIHx8IChyZXEuc3RhdHVzID49IDIwMCAmJiByZXEuc3RhdHVzIDwgMzAwKSk7DQoJCQ0KCQlpZiAoc3VjY2Vzcykgew0KCQkJbG9nNGpzTG9nZ2VyLnRyYWNlKCIgIEFqYXhBcHBlbmRlci5vblJlYWR5U3RhdGVDaGFuZ2VkOiBzdWNjZXNzIik7DQoNCgkJCS8vcmVhZHkgc2VuZGluZyBkYXRhDQoJCQl0aGlzLmlzSW5Qcm9ncmVzcyA9IGZhbHNlOw0KDQoJCX0gZWxzZSB7DQoJCQl2YXIgbXNnID0gIiAgQWpheEFwcGVuZGVyLm9uUmVhZHlTdGF0ZUNoYW5nZWQ6IFhNTEh0dHBSZXF1ZXN0IHJlcXVlc3QgdG8gVVJMICIgKyB0aGlzLmxvZ2dpbmdVcmwgKyAiIHJldHVybmVkIHN0YXR1cyBjb2RlICIgKyB0aGlzLmh0dHBSZXF1ZXN0LnN0YXR1czsNCgkJCWxvZzRqc0xvZ2dlci5lcnJvcihtc2cpOw0KCQl9DQoJCQ0KCQlsb2c0anNMb2dnZXIudHJhY2UoIjwgQWpheEFwcGVuZGVyLm9uUmVhZHlTdGF0ZUNoYW5nZWQ6IHJlYWR5U3RhdGUgPT0gNCIpOwkJDQoJfSwNCgkvKioNCgkgKiBHZXQgdGhlIFhNTEh0dHBSZXF1ZXN0IG9iamVjdCBpbmRlcGVuZGVudCBvZiBicm93c2VyLg0KCSAqIEBwcml2YXRlDQoJICovDQoJZ2V0WG1sSHR0cFJlcXVlc3Q6IGZ1bmN0aW9uKCkgew0KCQlsb2c0anNMb2dnZXIudHJhY2UoIj4gQWpheEFwcGVuZGVyLmdldFhtbEh0dHBSZXF1ZXN0Iik7DQoJCQ0KCQl2YXIgaHR0cFJlcXVlc3QgPSBmYWxzZTsNCg0KCQl0cnkgewkJDQoJCQlpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7IC8vIE1vemlsbGEsIFNhZmFyaSwgSUU3Li4uDQoJCQkJCWh0dHBSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQoJCQkJaWYgKGh0dHBSZXF1ZXN0Lm92ZXJyaWRlTWltZVR5cGUpIHsNCgkJCQkJaHR0cFJlcXVlc3Qub3ZlcnJpZGVNaW1lVHlwZSh0aGlzLmxheW91dC5nZXRDb250ZW50VHlwZSgpKTsNCgkJCQl9DQoJCQl9IGVsc2UgaWYgKHdpbmRvdy5BY3RpdmVYT2JqZWN0KSB7IC8vIElFDQoJCQkJdHJ5IHsNCgkJCQkJaHR0cFJlcXVlc3QgPSBuZXcgQWN0aXZlWE9iamVjdCgiTXN4bWwyLlhNTEhUVFAiKTsNCgkJCQl9IGNhdGNoIChlKSB7DQoJCQkJCWh0dHBSZXF1ZXN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIik7DQoJCQkJfQ0KCQkJfQ0KCQl9IGNhdGNoIChlKSB7DQoJCQlodHRwUmVxdWVzdCA9IGZhbHNlOw0KCQl9DQoJCQ0KCQlpZiAoIWh0dHBSZXF1ZXN0KSB7DQoJCQlsb2c0anNMb2dnZXIuZmF0YWwoIlVuZm9ydHVuYXRlbHksIHlvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IEFqYXhBcHBlbmRlciBmb3IgbG9nNGpzISIpOw0KCQl9DQoJCQ0KCQlsb2c0anNMb2dnZXIudHJhY2UoIjwgQWpheEFwcGVuZGVyLmdldFhtbEh0dHBSZXF1ZXN0Iik7DQoJCXJldHVybiBodHRwUmVxdWVzdDsNCgl9LA0KCQ0KCS8qKiANCgkgKiB0b1N0cmluZw0KCSAqLw0KCSB0b1N0cmluZzogZnVuY3Rpb24oKSB7DQoJIAlyZXR1cm4gIkxvZzRqcy5BamF4QXBwZW5kZXJbbG9nZ2luZ1VybD0iICsgdGhpcy5sb2dnaW5nVXJsICsgIiwgdGhyZXNob2xkPSIgKyB0aGlzLnRocmVzaG9sZCArICJdIjsgDQoJIH0NCn0pOw0KDQovKioNCiAqIEZpbGUgQXBwZW5kZXIgd3JpdGluZyB0aGUgbG9ncyB0byBhIHRleHQgZmlsZS4NCiAqIFBMRUFTRSBOT1RFIC0gT25seSB3b3JrcyBpbiBJRSBhbmQgTW96aWxsYSANCiAqIHVzZSBBY3RpdmVYIHRvIHdyaXRlIGZpbGUgb24gSUUNCiAqIHVzZSBYUENvbSBjb21wb25lbnRzICB0byB3cml0ZSBmaWxlIG9uIE1vemlsbGENCiAqIA0KICogQGV4dGVuZHMgTG9nNGpzLkFwcGVuZGVyIA0KICogQGNvbnN0cnVjdG9yDQogKiBAcGFyYW0gbG9nZ2VyIGxvZzRqcyBpbnN0YW5jZSB0aGlzIGFwcGVuZGVyIGlzIGF0dGFjaGVkIHRvDQogKiBAcGFyYW0gZmlsZSBmaWxlIGxvZyBtZXNzYWdlcyB3aWxsIGJlIHdyaXR0ZW4gdG8NCiAqIEBhdXRob3IgU2V0aCBDaGlzYW1vcmUNCiAqIEBhdXRob3IgTmljb2xhcyBKdXN0aW4gbmp1c3RpbkBpZGVhbHguY29tDQogKiBAYXV0aG9yIEdyZWdvcnkgS29rYW5vc2t5IGdrb2thbm9za3lAaWRlYWx4LmNvbQ0KICovDQpMb2c0anMuRmlsZUFwcGVuZGVyID0gZnVuY3Rpb24oZmlsZSkgew0KDQoJdGhpcy5sYXlvdXQgPSBuZXcgTG9nNGpzLlNpbXBsZUxheW91dCgpOw0KCXRoaXMuaXNJRSA9ICd1bmRlZmluZWQnOw0KCQ0KCXRoaXMuZmlsZSA9IGZpbGUgfHwgImxvZzRqcy5sb2ciOwkNCgkNCgl0cnl7DQoJCXRoaXMuZnNvID0gbmV3IEFjdGl2ZVhPYmplY3QoIlNjcmlwdGluZy5GaWxlU3lzdGVtT2JqZWN0Iik7DQoJCXRoaXMuaXNJRSA9IHRydWU7DQoJfSBjYXRjaChlKXsNCgkJdHJ5IHsNCgkJCW5ldHNjYXBlLnNlY3VyaXR5LlByaXZpbGVnZU1hbmFnZXIuZW5hYmxlUHJpdmlsZWdlKCJVbml2ZXJzYWxYUENvbm5lY3QiKTsNCgkJCXRoaXMuZnNvID0gIENvbXBvbmVudHMuY2xhc3Nlc1siQG1vemlsbGEub3JnL2ZpbGUvbG9jYWw7MSJdLmNyZWF0ZUluc3RhbmNlKENvbXBvbmVudHMuaW50ZXJmYWNlcy5uc0lMb2NhbEZpbGUpOw0KCQkJdGhpcy5pc0lFID0gZmFsc2U7IC8vbW96aWxsYSAmIGNvDQoJCX0gY2F0Y2ggKGUpIHsNCgkJCWxvZzRqc0xvZ2dlci5lcnJvcihlKTsNCgkJfQ0KCX0NCn07DQoNCkxvZzRqcy5GaWxlQXBwZW5kZXIucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkFwcGVuZGVyKCksIHsgIA0KCS8qKg0KCSAqIEBwYXJhbSBsb2dnaW5nRXZlbnQgZXZlbnQgdG8gYmUgbG9nZ2VkDQoJICogQHNlZSBMb2c0anMuQXBwZW5kZXIjZG9BcHBlbmQNCgkgKi8NCglkb0FwcGVuZDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCXRyeSB7DQoJCQl2YXIgZmlsZUhhbmRsZSA9IG51bGw7DQoJCQkNCgkJCWlmKCB0aGlzLmlzSUUgPT09ICd1bmRlZmluZWQnKSB7DQoJCQkJbG9nNGpzTG9nZ2VyLmVycm9yKCJVbnN1cHBvcnRlZCIpOw0KCQkJfQ0KCQkJZWxzZSBpZiggdGhpcy5pc0lFICl7DQoJCQkJLy8gdHJ5IG9wZW5pbmcgZXhpc3RpbmcgZmlsZSwgY3JlYXRlIGlmIG5lZWRlZA0KCQkJCWZpbGVIYW5kbGUgPSB0aGlzLmZzby5PcGVuVGV4dEZpbGUodGhpcy5maWxlLCA4LCB0cnVlKTsgICAgICAgIA0KCQkJCS8vIHdyaXRlIG91dCBvdXIgZGF0YQ0KCQkJCWZpbGVIYW5kbGUuV3JpdGVMaW5lKHRoaXMubGF5b3V0LmZvcm1hdChsb2dnaW5nRXZlbnQpKTsNCgkJCQlmaWxlSGFuZGxlLmNsb3NlKCk7ICAgDQoJCQl9IGVsc2Ugew0KCQkJCW5ldHNjYXBlLnNlY3VyaXR5LlByaXZpbGVnZU1hbmFnZXIuZW5hYmxlUHJpdmlsZWdlKCJVbml2ZXJzYWxYUENvbm5lY3QiKTsNCgkJCQl0aGlzLmZzby5pbml0V2l0aFBhdGgodGhpcy5maWxlKTsNCiAgICAJCQlpZighdGhpcy5mc28uZXhpc3RzKCkpIHsNCiAgICAJCQkJLy9jcmVhdGUgZmlsZSBpZiBuZWVkZWQNCiAgICAgICAgICAgIAkJdGhpcy5mc28uY3JlYXRlKDB4MDAsIDA2MDApOw0KICAgIAkJCX0NCgkJCQkNCiAJCQkJZmlsZUhhbmRsZSA9IENvbXBvbmVudHMuY2xhc3Nlc1siQG1vemlsbGEub3JnL25ldHdvcmsvZmlsZS1vdXRwdXQtc3RyZWFtOzEiXS5jcmVhdGVJbnN0YW5jZShDb21wb25lbnRzLmludGVyZmFjZXMubnNJRmlsZU91dHB1dFN0cmVhbSk7DQogICAgICAgIAkJZmlsZUhhbmRsZS5pbml0KCB0aGlzLmZzbywgMHgwNCB8IDB4MDggfCAweDEwLCAwNjQsIDApOw0KCQkJCXZhciBsaW5lID0gdGhpcy5sYXlvdXQuZm9ybWF0KGxvZ2dpbmdFdmVudCk7DQogICAgICAgIAkJZmlsZUhhbmRsZS53cml0ZShsaW5lLCBsaW5lLmxlbmd0aCk7IC8vd3JpdGUgZGF0YQ0KICAgICAgICAJCWZpbGVIYW5kbGUuY2xvc2UoKTsNCgkJCX0NCgkJfSBjYXRjaCAoZSkgew0KCQkJbG9nNGpzTG9nZ2VyLmVycm9yKGUpOw0KCQl9DQoJfSwNCgkvKg0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQ2xlYXINCgkgKi8NCglkb0NsZWFyOiBmdW5jdGlvbigpIHsNCgkJdHJ5IHsNCgkJCWlmKCB0aGlzLmlzSUUgKXsNCgkJCQl2YXIgZmlsZUhhbmRsZSA9IHRoaXMuZnNvLkdldEZpbGUodGhpcy5maWxlKTsNCgkJCQlmaWxlSGFuZGxlLkRlbGV0ZSgpOw0KCQkJfSBlbHNlIHsNCgkJCQluZXRzY2FwZS5zZWN1cml0eS5Qcml2aWxlZ2VNYW5hZ2VyLmVuYWJsZVByaXZpbGVnZSgiVW5pdmVyc2FsWFBDb25uZWN0Iik7DQoJCQkJdGhpcy5mc28uaW5pdFdpdGhQYXRoKHRoaXMuZmlsZSk7DQoJCQkJaWYodGhpcy5mc28uZXhpc3RzKCkpIHsNCgkJCQkJdGhpcy5mc28ucmVtb3ZlKGZhbHNlKTsNCgkJCQl9DQoJCQl9DQoJCX0gY2F0Y2ggKGUpIHsNCgkJCWxvZzRqc0xvZ2dlci5lcnJvcihlKTsNCgkJfQ0KCX0sDQoJDQoJLyoqIA0KCSAqIHRvU3RyaW5nDQoJICovDQoJIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsNCgkgCXJldHVybiAiTG9nNGpzLkZpbGVBcHBlbmRlcltmaWxlPSIgKyB0aGlzLmZpbGUgKyAiXSI7IA0KCSB9DQp9KTsNCg0KLyoqDQogKiBXaW5kb3dzIEV2ZW50IEFwcGVuZGVyIHdyaXRlcyB0aGUgbG9ncyB0byB0aGUgV2luZG93cyBFdmVudCBsb2cuDQogKiBQTEVBU0UgTk9URSAtIE9ubHkgd29ya3MgaW4gSUUuLnVzZXMgQWN0aXZlWCB0byB3cml0ZSB0byBXaW5kb3dzIEV2ZW50IGxvZw0KICoNCiAqIEBleHRlbmRzIExvZzRqcy5BcHBlbmRlciANCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIGxvZ2dlciBsb2c0anMgaW5zdGFuY2UgdGhpcyBhcHBlbmRlciBpcyBhdHRhY2hlZCB0bw0KICogQGF1dGhvciBTZXRoIENoaXNhbW9yZQ0KICovDQpMb2c0anMuV2luZG93c0V2ZW50QXBwZW5kZXIgPSBmdW5jdGlvbigpIHsNCgkNCgl0aGlzLmxheW91dCA9IG5ldyBMb2c0anMuU2ltcGxlTGF5b3V0KCk7DQoJDQoJdHJ5IHsNCgkJdGhpcy5zaGVsbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCJXU2NyaXB0LlNoZWxsIik7DQoJfSBjYXRjaChlKSB7DQoJCWxvZzRqc0xvZ2dlci5lcnJvcihlKTsNCgl9DQp9Ow0KDQpMb2c0anMuV2luZG93c0V2ZW50QXBwZW5kZXIucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkFwcGVuZGVyKCksIHsgIA0KCS8qKg0KCSAqIEBwYXJhbSBsb2dnaW5nRXZlbnQgZXZlbnQgdG8gYmUgbG9nZ2VkDQoJICogQHNlZSBMb2c0anMuQXBwZW5kZXIjZG9BcHBlbmQNCgkgKi8NCglkb0FwcGVuZDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCXZhciB3aW5MZXZlbCA9IDQ7DQoJCQ0KCQkvLyBNYXAgbG9nIGxldmVsIHRvIHdpbmRvd3MgZXZlbnQgbG9nIGxldmVsLg0KCQkvLyBXaW5kb3dzIGV2ZW50czogLSBTVUNDRVNTOiAwLCBFUlJPUjogMSwgV0FSTklORzogMiwgSU5GT1JNQVRJT046IDQsIEFVRElUX1NVQ0NFU1M6IDgsIEFVRElUX0ZBSUxVUkU6IDE2DQoJCXN3aXRjaCAobG9nZ2luZ0V2ZW50LmxldmVsKSB7CQ0KCQkJY2FzZSBMb2c0anMuTGV2ZWwuRkFUQUw6DQoJCQkJd2luTGV2ZWwgPSAxOw0KCQkJCWJyZWFrOw0KCQkJY2FzZSBMb2c0anMuTGV2ZWwuRVJST1I6DQoJCQkJd2luTGV2ZWwgPSAxOw0KCQkJCWJyZWFrOw0KCQkJY2FzZSBMb2c0anMuTGV2ZWwuV0FSTjoNCgkJCQl3aW5MZXZlbCA9IDI7DQoJCQkJYnJlYWs7DQoJCQlkZWZhdWx0Og0KCQkJCXdpbkxldmVsID0gNDsNCgkJCQlicmVhazsNCgkJfQ0KCQkNCgkJdHJ5IHsNCgkJCXRoaXMuc2hlbGwuTG9nRXZlbnQod2luTGV2ZWwsIHRoaXMubGV2ZWwuZm9ybWF0KGxvZ2dpbmdFdmVudCkpOw0KCQl9IGNhdGNoKGUpIHsNCgkJCWxvZzRqc0xvZ2dlci5lcnJvcihlKTsNCgkJfQ0KCX0sDQoJDQoJLyoqIA0KCSAqIHRvU3RyaW5nDQoJICovDQoJIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsNCgkgCXJldHVybiAiTG9nNGpzLldpbmRvd3NFdmVudEFwcGVuZGVyIjsgDQoJIH0gDQp9KTsNCg0KLyoqDQogKiBKUyBBbGVydCBBcHBlbmRlciB3cml0ZXMgdGhlIGxvZ3MgdG8gdGhlIEphdmFTY3JpcHQgYWxlcnQgZGlhbG9nIGJveA0KICogQGNvbnN0cnVjdG9yDQogKiBAZXh0ZW5kcyBMb2c0anMuQXBwZW5kZXIgIA0KICogQHBhcmFtIGxvZ2dlciBsb2c0anMgaW5zdGFuY2UgdGhpcyBhcHBlbmRlciBpcyBhdHRhY2hlZCB0bw0KICogQGF1dGhvciBTJmVhY3V0ZTtiYXN0aWVuIExFQ0FDSEVVUg0KICovDQpMb2c0anMuSlNBbGVydEFwcGVuZGVyID0gZnVuY3Rpb24oKSB7DQoNCgl0aGlzLmxheW91dCA9IG5ldyBMb2c0anMuU2ltcGxlTGF5b3V0KCk7DQp9Ow0KDQpMb2c0anMuSlNBbGVydEFwcGVuZGVyLnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5BcHBlbmRlcigpLCB7ICANCgkvKiogDQoJICogQHNlZSBMb2c0anMuQXBwZW5kZXIjZG9BcHBlbmQNCgkgKi8NCglkb0FwcGVuZDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCWFsZXJ0KHRoaXMubGF5b3V0LmdldEhlYWRlcigpICsgdGhpcy5sYXlvdXQuZm9ybWF0KGxvZ2dpbmdFdmVudCkgKyB0aGlzLmxheW91dC5nZXRGb290ZXIoKSk7DQoJfSwNCgkNCgkvKiogDQoJICogdG9TdHJpbmcNCgkgKi8NCgkgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgew0KCSAJcmV0dXJuICJMb2c0anMuSlNBbGVydEFwcGVuZGVyIjsgDQoJIH0JDQp9KTsNCg0KLyoqDQogKiBBcHBlbmRlciB3cml0ZXMgdGhlIGxvZ3MgdG8gdGhlIEphdmFTY3JpcHQgY29uc29sZSBvZiBNb3ppbGxhIGJyb3dzZXINCiAqIE1vcmUgaW5mb3M6IGh0dHA6Ly9rYi5tb3ppbGxhemluZS5vcmcvaW5kZXgucGhwP3RpdGxlPUphdmFTY3JpcHRfQ29uc29sZSZyZWRpcmVjdD1ubw0KICogUExFQVNFIE5PVEUgLSBPbmx5IHdvcmtzIGluIE1vemlsbGEgYnJvd3Nlcg0KICogQGNvbnN0cnVjdG9yDQogKiBAZXh0ZW5kcyBMb2c0anMuQXBwZW5kZXIgIA0KICogQHBhcmFtIGxvZ2dlciBsb2c0anMgaW5zdGFuY2UgdGhpcyBhcHBlbmRlciBpcyBhdHRhY2hlZCB0bw0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuTW96aWxsYUpTQ29uc29sZUFwcGVuZGVyID0gZnVuY3Rpb24oKSB7DQoJdGhpcy5sYXlvdXQgPSBuZXcgTG9nNGpzLlNpbXBsZUxheW91dCgpOw0KCXRyeSB7DQoJCW5ldHNjYXBlLnNlY3VyaXR5LlByaXZpbGVnZU1hbmFnZXIuZW5hYmxlUHJpdmlsZWdlKCJVbml2ZXJzYWxYUENvbm5lY3QiKTsNCgkJdGhpcy5qc0NvbnNvbGUgPSBDb21wb25lbnRzLmNsYXNzZXNbIkBtb3ppbGxhLm9yZy9jb25zb2xlc2VydmljZTsxIl0uZ2V0U2VydmljZShDb21wb25lbnRzLmludGVyZmFjZXMubnNJQ29uc29sZVNlcnZpY2UpOw0KCQl0aGlzLnNjcmlwdEVycm9yID0gQ29tcG9uZW50cy5jbGFzc2VzWyJAbW96aWxsYS5vcmcvc2NyaXB0ZXJyb3I7MSJdLmNyZWF0ZUluc3RhbmNlKENvbXBvbmVudHMuaW50ZXJmYWNlcy5uc0lTY3JpcHRFcnJvcik7DQoJfSBjYXRjaCAoZSkgew0KCQlsb2c0anNMb2dnZXIuZXJyb3IoZSk7DQoJfQ0KfTsNCg0KTG9nNGpzLk1vemlsbGFKU0NvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUgPSBMb2c0anMuZXh0ZW5kKG5ldyBMb2c0anMuQXBwZW5kZXIoKSwgeyAgDQoJLyoqIA0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQXBwZW5kDQoJICovDQoJZG9BcHBlbmQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQl0cnkgew0KCQkJbmV0c2NhcGUuc2VjdXJpdHkuUHJpdmlsZWdlTWFuYWdlci5lbmFibGVQcml2aWxlZ2UoIlVuaXZlcnNhbFhQQ29ubmVjdCIpOw0KCQkJdGhpcy5zY3JpcHRFcnJvci5pbml0KHRoaXMubGF5b3V0LmZvcm1hdChsb2dnaW5nRXZlbnQpLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCB0aGlzLmdldEZsYWcobG9nZ2luZ0V2ZW50KSwgbG9nZ2luZ0V2ZW50LmNhdGVnb3J5TmFtZSk7DQoJCQl0aGlzLmpzQ29uc29sZS5sb2dNZXNzYWdlKHRoaXMuc2NyaXB0RXJyb3IpOw0KCQl9IGNhdGNoIChlKSB7DQoJCQlsb2c0anNMb2dnZXIuZXJyb3IoZSk7DQoJCX0NCgl9LA0KCQ0KCS8qKiANCgkgKiB0b1N0cmluZw0KCSAqLw0KCSB0b1N0cmluZzogZnVuY3Rpb24oKSB7DQoJIAlyZXR1cm4gIkxvZzRqcy5Nb3ppbGxhSlNDb25zb2xlQXBwZW5kZXIiOyANCgkgfSwNCgkgDQoJLyoqDQoJICogTWFwIExvZzRqcy5MZXZlbCB0byBqc0NvbnNvbGUgRmxhZ3M6DQoJICogPHVsPg0KCSAqIDxsaT5uc0lTY3JpcHRFcnJvci5lcnJvckZsYWcgKDApID0gTGV2ZWwuRXJyb3I8L2xpPg0KCSAqIDxsaT5uc0lTY3JpcHRFcnJvci53YXJuaW5nRmxhZyAoMSk9IExvZzRqcy5MZXZlbC5XQVJOPC9saT4NCgkgKiA8bGk+bnNJU2NyaXB0RXJyb3IuZXhjZXB0aW9uRmxhZyAoMikgPSBMb2c0anMuTGV2ZWwuRkFUQUw8L2xpPg0KCSAqIDxsaT5uc0lTY3JpcHRFcnJvci5zdHJpY3RGbGFnICg0KSA9IHVudXNlZDwvbGk+DQoJICogPC91bD4NCgkgKiBAcHJpdmF0ZQ0KCSAqLwkNCglnZXRGbGFnOiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpDQoJew0KCQl2YXIgcmV0dmFsOw0KCQlzd2l0Y2ggKGxvZ2dpbmdFdmVudC5sZXZlbCkgewkNCgkJCWNhc2UgTG9nNGpzLkxldmVsLkZBVEFMOg0KCQkJCXJldHZhbCA9IDI7Ly9uc0lTY3JpcHRFcnJvci5leGNlcHRpb25GbGFnID0gMg0KCQkJCWJyZWFrOw0KCQkJY2FzZSBMb2c0anMuTGV2ZWwuRVJST1I6DQoJCQkJcmV0dmFsID0gMDsvL25zSVNjcmlwdEVycm9yLmVycm9yRmxhZw0KCQkJCWJyZWFrOw0KCQkJY2FzZSBMb2c0anMuTGV2ZWwuV0FSTjoNCgkJCQlyZXR2YWwgPSAxOy8vbnNJU2NyaXB0RXJyb3Iud2FybmluZ0ZsYWcgPSAxDQoJCQkJYnJlYWs7DQoJCQlkZWZhdWx0Og0KCQkJCXJldHZhbCA9IDE7Ly9uc0lTY3JpcHRFcnJvci53YXJuaW5nRmxhZyA9IDENCgkJCQlicmVhazsNCgkJfQ0KCQkNCgkJcmV0dXJuIHJldHZhbDsJCQ0KCX0NCn0pOw0KDQovKioNCiAqIEFwcGVuZGVyIHdyaXRlcyB0aGUgbG9ncyB0byB0aGUgSmF2YVNjcmlwdCBjb25zb2xlIG9mIE9wZXJhIGJyb3dzZXINCiAqIFBMRUFTRSBOT1RFIC0gT25seSB3b3JrcyBpbiBPcGVyYSBicm93c2VyDQogKiBAY29uc3RydWN0b3INCiAqIEBleHRlbmRzIExvZzRqcy5BcHBlbmRlciAgDQogKiBAcGFyYW0gbG9nZ2VyIGxvZzRqcyBpbnN0YW5jZSB0aGlzIGFwcGVuZGVyIGlzIGF0dGFjaGVkIHRvDQogKiBAYXV0aG9yIFN0ZXBoYW4gU3RyaXR0bWF0dGVyDQogKi8NCkxvZzRqcy5PcGVyYUpTQ29uc29sZUFwcGVuZGVyID0gZnVuY3Rpb24oKSB7DQoJdGhpcy5sYXlvdXQgPSBuZXcgTG9nNGpzLlNpbXBsZUxheW91dCgpOw0KfTsNCg0KTG9nNGpzLk9wZXJhSlNDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkFwcGVuZGVyKCksIHsgIA0KCS8qKiANCgkgKiBAc2VlIExvZzRqcy5BcHBlbmRlciNkb0FwcGVuZA0KCSAqLw0KCWRvQXBwZW5kOiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJb3BlcmEucG9zdEVycm9yKHRoaXMubGF5b3V0LmZvcm1hdChsb2dnaW5nRXZlbnQpKTsNCgl9LA0KCQ0KCS8qKiANCgkgKiB0b1N0cmluZw0KCSAqLw0KCSB0b1N0cmluZzogZnVuY3Rpb24oKSB7DQoJIAlyZXR1cm4gIkxvZzRqcy5PcGVyYUpTQ29uc29sZUFwcGVuZGVyIjsgDQoJIH0NCn0pOw0KDQovKioNCiAqIEFwcGVuZGVyIHdyaXRlcyB0aGUgbG9ncyB0byB0aGUgSmF2YVNjcmlwdCBjb25zb2xlIG9mIFNhZmFyaSBicm93c2VyDQogKiBQTEVBU0UgTk9URSAtIE9ubHkgd29ya3MgaW4gU2FmYXJpIGJyb3dzZXINCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkFwcGVuZGVyICANCiAqIEBwYXJhbSBsb2dnZXIgbG9nNGpzIGluc3RhbmNlIHRoaXMgYXBwZW5kZXIgaXMgYXR0YWNoZWQgdG8NCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqLw0KTG9nNGpzLlNhZmFyaUpTQ29uc29sZUFwcGVuZGVyID0gZnVuY3Rpb24oKSB7DQoJdGhpcy5sYXlvdXQgPSBuZXcgTG9nNGpzLlNpbXBsZUxheW91dCgpOw0KfTsNCg0KTG9nNGpzLlNhZmFyaUpTQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5BcHBlbmRlcigpLCB7ICANCgkvKiogDQoJICogQHNlZSBMb2c0anMuQXBwZW5kZXIjZG9BcHBlbmQNCgkgKi8NCglkb0FwcGVuZDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCXdpbmRvdy5jb25zb2xlLmxvZyh0aGlzLmxheW91dC5mb3JtYXQobG9nZ2luZ0V2ZW50KSk7DQoJfSwNCgkNCgkvKiogDQoJICogdG9TdHJpbmcNCgkgKi8NCgkgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgew0KCSAJcmV0dXJuICJMb2c0anMuU2FmYXJpSlNDb25zb2xlQXBwZW5kZXIiOyANCgkgfQ0KfSk7DQoNCi8qKg0KICogSmF2YVNjcmlwdCBDb25zb2xlIEFwcGVuZGVyIHdoaWNoIGlzIGJyb3dzZXIgaW5kZXBlbmRlbnQuDQogKiBJdCBjaGVja3MgaW50ZXJuYWxseSBmb3IgdGhlIGN1cnJlbnQgYnJvd3NlciBhbmQgYWRkcyBkZWxlZ2F0ZSB0bw0KICogc3BlY2lmaWMgSmF2YVNjcmlwdCBDb25zb2xlIEFwcGVuZGVyIG9mIHRoZSBicm93c2VyLg0KICoNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkFwcGVuZGVyIA0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICogQHNpbmNlIDEuMA0KICovDQpMb2c0anMuQnJvd3NlckNvbnNvbGVBcHBlbmRlciA9IGZ1bmN0aW9uKCkgew0KCS8qKg0KCSAqIERlbGVnYXRlIGZvciBicm93c2VyIHNwZWNpZmljIGltcGxlbWVudGF0aW9uDQoJICogQHR5cGUgTG9nNGpzLkFwcGVuZGVyDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmNvbnNvbGVEZWxlZ2F0ZSA9IG51bGw7DQoJDQoJaWYgKHdpbmRvdy5jb25zb2xlKSB7DQoJCXRoaXMuY29uc29sZURlbGVnYXRlID0gbmV3IExvZzRqcy5TYWZhcmlKU0NvbnNvbGVBcHBlbmRlcigpOyANCgl9DQogICAgZWxzZSBpZiAod2luZG93Lm9wZXJhKSB7DQoJCXRoaXMuY29uc29sZURlbGVnYXRlID0gbmV3IExvZzRqcy5PcGVyYUpTQ29uc29sZUFwcGVuZGVyKCk7IA0KCX0NCgllbHNlIGlmKG5ldHNjYXBlKSB7DQoJCXRoaXMuY29uc29sZURlbGVnYXRlID0gbmV3IExvZzRqcy5Nb3ppbGxhSlNDb25zb2xlQXBwZW5kZXIoKTsgDQoJfQ0KICAgIGVsc2Ugew0KICAgICAgIC8vQHRvZG8NCiAgICAgICBsb2c0anNMb2dnZXIuZXJyb3IoIlVuc3VwcG9ydGVkIEJyb3dzZXIiKTsNCiAgICB9DQp9Ow0KDQpMb2c0anMuQnJvd3NlckNvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUgPSBMb2c0anMuZXh0ZW5kKG5ldyBMb2c0anMuQXBwZW5kZXIoKSwgeyAgDQoJLyoqIA0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQXBwZW5kDQoJICovDQoJZG9BcHBlbmQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQl0aGlzLmNvbnNvbGVEZWxlZ2F0ZS5kb0FwcGVuZChsb2dnaW5nRXZlbnQpOw0KCX0sDQoJLyoqIA0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQ2xlYXINCgkgKi8NCglkb0NsZWFyOiBmdW5jdGlvbigpIHsNCgkJdGhpcy5jb25zb2xlRGVsZWdhdGUuZG9DbGVhcigpOw0KCX0sDQoJLyoqDQoJICogQHNlZSBMb2c0anMuQXBwZW5kZXIjc2V0TGF5b3V0DQoJICovDQoJc2V0TGF5b3V0OiBmdW5jdGlvbihsYXlvdXQpew0KCQl0aGlzLmNvbnNvbGVEZWxlZ2F0ZS5zZXRMYXlvdXQobGF5b3V0KTsNCgl9LA0KCQ0KCS8qKiANCgkgKiB0b1N0cmluZw0KCSAqLw0KCSB0b1N0cmluZzogZnVuY3Rpb24oKSB7DQoJIAlyZXR1cm4gIkxvZzRqcy5Ccm93c2VyQ29uc29sZUFwcGVuZGVyOiAiICsgdGhpcy5jb25zb2xlRGVsZWdhdGUudG9TdHJpbmcoKTsgDQoJIH0NCn0pOw0KDQovKioNCiAqIFNpbXBsZUxheW91dCBjb25zaXN0cyBvZiB0aGUgbGV2ZWwgb2YgdGhlIGxvZyBzdGF0ZW1lbnQsIGZvbGxvd2VkIGJ5ICIgLSAiIA0KICogYW5kIHRoZW4gdGhlIGxvZyBtZXNzYWdlIGl0c2VsZi4gRm9yIGV4YW1wbGUsDQogKiA8Y29kZT5ERUJVRyAtIEhlbGxvIHdvcmxkPC9jb2RlPg0KICoNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkxheW91dA0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuU2ltcGxlTGF5b3V0ID0gZnVuY3Rpb24oKSB7DQoJdGhpcy5MSU5FX1NFUCAgPSAiXG4iOw0KCXRoaXMuTElORV9TRVBfTEVOID0gMTsNCn07DQoNCkxvZzRqcy5TaW1wbGVMYXlvdXQucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkxheW91dCgpLCB7DQoJLyoqIA0KCSAqIEltcGxlbWVudCB0aGlzIG1ldGhvZCB0byBjcmVhdGUgeW91ciBvd24gbGF5b3V0IGZvcm1hdC4NCgkgKiBAcGFyYW0ge0xvZzRqcy5Mb2dnaW5nRXZlbnR9IGxvZ2dpbmdFdmVudCBsb2dnaW5nRXZlbnQgdG8gZm9ybWF0DQoJICogQHJldHVybiBmb3JtYXR0ZWQgU3RyaW5nDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZm9ybWF0OiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJcmV0dXJuIGxvZ2dpbmdFdmVudC5sZXZlbC50b1N0cmluZygpICsgIiAtICIgKyBsb2dnaW5nRXZlbnQubWVzc2FnZSArIHRoaXMuTElORV9TRVA7DQoJfSwNCgkvKiogDQoJICogUmV0dXJucyB0aGUgY29udGVudCB0eXBlIG91dHB1dCBieSB0aGlzIGxheW91dC4gDQoJICogQHJldHVybiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zICJ0ZXh0L3BsYWluIi4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRDb250ZW50VHlwZTogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAidGV4dC9wbGFpbiI7DQoJfSwNCgkvKiogDQoJICogQHJldHVybiBSZXR1cm5zIHRoZSBoZWFkZXIgZm9yIHRoZSBsYXlvdXQgZm9ybWF0LiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zIG51bGwuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0SGVhZGVyOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuICIiOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgZm9vdGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEZvb3RlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiIjsNCgl9DQp9KTsNCgkNCi8qKg0KICogQmFzaWNMYXlvdXQgaXMgYSBzaW1wbGUgbGF5b3V0IGZvciBzdG9yaW5nIHRoZSBsb2dncy4gVGhlIGxvZ2dzIGFyZSBzdG9yZWQNCiAqIGluIGZvbGxvd2luZyBmb3JtYXQ6DQogKiA8cHJlPg0KICogY2F0ZWdvcnlOYW1lfnN0YXJ0VGltZSBbbG9nTGV2ZWxdIG1lc3NhZ2Vcbg0KICogPC9wcmU+DQogKg0KICogQGNvbnN0cnVjdG9yDQogKiBAZXh0ZW5kcyBMb2c0anMuTGF5b3V0DQogKiBAYXV0aG9yIFN0ZXBoYW4gU3RyaXR0bWF0dGVyDQogKi8NCkxvZzRqcy5CYXNpY0xheW91dCA9IGZ1bmN0aW9uKCkgew0KCXRoaXMuTElORV9TRVAgID0gIlxuIjsNCn07DQoNCkxvZzRqcy5CYXNpY0xheW91dC5wcm90b3R5cGUgPSBMb2c0anMuZXh0ZW5kKG5ldyBMb2c0anMuTGF5b3V0KCksIHsNCgkvKiogDQoJICogSW1wbGVtZW50IHRoaXMgbWV0aG9kIHRvIGNyZWF0ZSB5b3VyIG93biBsYXlvdXQgZm9ybWF0Lg0KCSAqIEBwYXJhbSB7TG9nNGpzLkxvZ2dpbmdFdmVudH0gbG9nZ2luZ0V2ZW50IGxvZ2dpbmdFdmVudCB0byBmb3JtYXQNCgkgKiBAcmV0dXJuIGZvcm1hdHRlZCBTdHJpbmcNCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglmb3JtYXQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQlyZXR1cm4gbG9nZ2luZ0V2ZW50LmNhdGVnb3J5TmFtZSArICJ+IiArIGxvZ2dpbmdFdmVudC5zdGFydFRpbWUudG9Mb2NhbGVTdHJpbmcoKSArICIgWyIgKyBsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKSArICJdICIgKyBsb2dnaW5nRXZlbnQubWVzc2FnZSArIHRoaXMuTElORV9TRVA7DQoJfSwNCgkvKiogDQoJICogUmV0dXJucyB0aGUgY29udGVudCB0eXBlIG91dHB1dCBieSB0aGlzIGxheW91dC4gDQoJICogQHJldHVybiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zICJ0ZXh0L3BsYWluIi4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRDb250ZW50VHlwZTogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAidGV4dC9wbGFpbiI7DQoJfSwNCgkvKiogDQoJICogQHJldHVybiBSZXR1cm5zIHRoZSBoZWFkZXIgZm9yIHRoZSBsYXlvdXQgZm9ybWF0LiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zIG51bGwuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0SGVhZGVyOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuICIiOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgZm9vdGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEZvb3RlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiIjsNCgl9DQp9KTsNCg0KLyoqDQogKiBIdG1sTGF5b3V0IHdyaXRlIHRoZSBsb2dzIGluIEh0bWwgZm9ybWF0Lg0KICoNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkxheW91dA0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuSHRtbExheW91dCA9IGZ1bmN0aW9uKCkge3JldHVybjt9Ow0KDQpMb2c0anMuSHRtbExheW91dC5wcm90b3R5cGUgPSBMb2c0anMuZXh0ZW5kKG5ldyBMb2c0anMuTGF5b3V0KCksIHsNCgkvKiogDQoJICogSW1wbGVtZW50IHRoaXMgbWV0aG9kIHRvIGNyZWF0ZSB5b3VyIG93biBsYXlvdXQgZm9ybWF0Lg0KCSAqIEBwYXJhbSB7TG9nNGpzLkxvZ2dpbmdFdmVudH0gbG9nZ2luZ0V2ZW50IGxvZ2dpbmdFdmVudCB0byBmb3JtYXQNCgkgKiBAcmV0dXJuIGZvcm1hdHRlZCBTdHJpbmcNCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglmb3JtYXQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQlyZXR1cm4gIjxkaXYgc3R5bGU9XCIiICsgdGhpcy5nZXRTdHlsZShsb2dnaW5nRXZlbnQpICsgIlwiPiIgKyBsb2dnaW5nRXZlbnQuZ2V0Rm9ybWF0dGVkVGltZXN0YW1wKCkgKyAiIC0gIiArIGxvZ2dpbmdFdmVudC5sZXZlbC50b1N0cmluZygpICsgIiAtICIgKyBsb2dnaW5nRXZlbnQubWVzc2FnZSArICI8L2Rpdj5cbiI7DQoJfSwNCgkvKiogDQoJICogUmV0dXJucyB0aGUgY29udGVudCB0eXBlIG91dHB1dCBieSB0aGlzIGxheW91dC4gDQoJICogQHJldHVybiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zICJ0ZXh0L2h0bWwiLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldENvbnRlbnRUeXBlOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuICJ0ZXh0L2h0bWwiOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgaGVhZGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEhlYWRlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiPGh0bWw+PGhlYWQ+PHRpdGxlPmxvZzRqczwvaGVhZD48Ym9keT4iOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgZm9vdGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEZvb3RlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiPC9ib2R5PjwvaHRtbD4iOw0KCX0sDQoJDQoJZ2V0U3R5bGU6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkNCgl7DQoJCXZhciBzdHlsZTsNCgkJaWYgKGxvZ2dpbmdFdmVudC5sZXZlbC50b1N0cmluZygpLnNlYXJjaCgvRVJST1IvKSAhPSAtMSkgeyANCgkJCXN0eWxlID0gJ2NvbG9yOnJlZCc7DQoJCX0gZWxzZSBpZiAobG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkuc2VhcmNoKC9GQVRBTC8pICE9IC0xKSB7IA0KCQkJc3R5bGUgPSAnY29sb3I6cmVkJzsNCgkJfSBlbHNlIGlmIChsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKS5zZWFyY2goL1dBUk4vKSAhPSAtMSkgeyANCgkJCXN0eWxlID0gJ2NvbG9yOm9yYW5nZSc7DQoJCX0gZWxzZSBpZiAobG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkuc2VhcmNoKC9ERUJVRy8pICE9IC0xKSB7DQoJCQlzdHlsZSA9ICdjb2xvcjpncmVlbic7DQoJCX0gZWxzZSBpZiAobG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkuc2VhcmNoKC9JTkZPLykgIT0gLTEpIHsNCgkJCXN0eWxlID0gJ2NvbG9yOndoaXRlJzsNCgkJfSBlbHNlIHsNCgkJCXN0eWxlID0gJ2NvbG9yOnllbGxvdyc7DQoJCX0JDQoJCXJldHVybiBzdHlsZTsNCgl9DQp9KTsNCg0KLyoqDQogKiBYTUxMYXlvdXQgd3JpdGUgdGhlIGxvZ3MgaW4gWE1MIGZvcm1hdC4NCiAqIExheW91dCBpcyBzaW1taWxhciB0byBsb2c0aidzIFhNTExheW91dDoNCiAqIDxwcmU+DQogKiA8bG9nNGpzOmV2ZW50IGNhdGVnb3J5PSJjYXRlZ29yeSIgbGV2ZWw9IkxldmVsIiBjbGllbnQ9IkNsaWVudCIgcmVmZXJlcj0icmVmIiB0aW1lc3RhbT0iRGF0ZSI+DQogKiA8bG9nNGpzOm1lc3NhZ2U+TG9nZ2VkIG1lc3NhZ2U8L2xvZzRqczptZXNzYWdlPg0KICogPC9sb2c0anM6ZXZlbnQ+DQogKiA8L3ByZT4NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkxheW91dA0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuWE1MTGF5b3V0ID0gZnVuY3Rpb24oKXtyZXR1cm47fTsNCkxvZzRqcy5YTUxMYXlvdXQucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkxheW91dCgpLCB7DQoJLyoqIA0KCSAqIEltcGxlbWVudCB0aGlzIG1ldGhvZCB0byBjcmVhdGUgeW91ciBvd24gbGF5b3V0IGZvcm1hdC4NCgkgKiBAcGFyYW0ge0xvZzRqcy5Mb2dnaW5nRXZlbnR9IGxvZ2dpbmdFdmVudCBsb2dnaW5nRXZlbnQgdG8gZm9ybWF0DQoJICogQHJldHVybiBmb3JtYXR0ZWQgU3RyaW5nDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZm9ybWF0OiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJdmFyIHVzZXJhZ2VudCA9ICJ1bmtub3duIjsNCgkJdHJ5IHsNCgkJCXVzZXJhZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7DQoJCX0gY2F0Y2goZSl7DQoJCQl1c2VyYWdlbnQgPSAidW5rbm93biI7DQoJCX0NCgkJDQoJCXZhciByZWZlcmVyID0gInVua25vd24iOw0KCQl0cnkgew0KCQkJcmVmZXJlciA9IGxvY2F0aW9uLmhyZWY7DQoJCX0gY2F0Y2goZSl7DQoJCQlyZWZlcmVyID0gInVua25vd24iOw0KCQl9DQoJCQkJDQoJCXZhciBjb250ZW50ID0gIjxsb2c0anM6ZXZlbnQgbG9nZ2VyPVwiIjsNCgkJY29udGVudCArPSBsb2dnaW5nRXZlbnQuY2F0ZWdvcnlOYW1lICsgIlwiIGxldmVsPVwiIjsNCgkJY29udGVudCArPSBsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKSArICJcIiB1c2VyYWdlbnQ9XCIiOw0KCQljb250ZW50ICs9IHVzZXJhZ2VudCArICJcIiByZWZlcmVyPVwiIjsNCgkJY29udGVudCArPSByZWZlcmVyLnJlcGxhY2UoLyYvZywgIiZhbXA7IikgKyAiXCIgdGltZXN0YW1wPVwiIjsNCgkJY29udGVudCArPSBsb2dnaW5nRXZlbnQuZ2V0Rm9ybWF0dGVkVGltZXN0YW1wKCkgKyAiXCI+XG4iOw0KCQljb250ZW50ICs9ICJcdDxsb2c0anM6bWVzc2FnZT48IVtDREFUQVsiICsgdGhpcy5lc2NhcGVDZGF0YShsb2dnaW5nRXZlbnQubWVzc2FnZSkgKyAiXV0+PC9sb2c0anM6bWVzc2FnZT5cbiI7CQ0KIAkJDQogCQlpZiAobG9nZ2luZ0V2ZW50LmV4Y2VwdGlvbikgew0KCQkJY29udGVudCArPSB0aGlzLmZvcm1hdEV4Y2VwdGlvbihsb2dnaW5nRXZlbnQuZXhjZXB0aW9uKSA7DQoJCX0NCiAJCWNvbnRlbnQgKz0gIjwvbG9nNGpzOmV2ZW50PlxuIjsNCiAgICAgICAgDQogICAgICByZXR1cm4gY29udGVudDsNCgl9LA0KCS8qKiANCgkgKiBSZXR1cm5zIHRoZSBjb250ZW50IHR5cGUgb3V0cHV0IGJ5IHRoaXMgbGF5b3V0LiANCgkgKiBAcmV0dXJuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgInRleHQveG1sIi4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRDb250ZW50VHlwZTogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAidGV4dC94bWwiOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgaGVhZGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEhlYWRlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiPGxvZzRqczpldmVudFNldCB2ZXJzaW9uPVwiIiArIExvZzRqcy52ZXJzaW9uICsgDQoJCQkiXCIgeG1sbnM6bG9nNGpzPVwiaHR0cDovL3N0cml0dGkuZ2l0aHViLmlvL2xvZzRqcy8vMjAwNy9sb2c0anMvXCI+XG4iOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgZm9vdGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEZvb3RlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiPC9sb2c0anM6ZXZlbnRTZXQ+XG4iOw0KCX0sDQoJDQoJZ2V0U2VwYXJhdG9yOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuICJcbiI7DQoJfSwNCgkNCgkvKioNCgkgKiBiZXR0ZXIgcmVhZGFibGUgZm9ybWF0dGVkIEV4Y2VwdGlvbnMuDQoJICogQHBhcmFtIGV4IHtFeGNlcHRpb259IHRoZSBleGNlcHRpb24gdG8gYmUgZm9ybWF0dGVkLg0KCSAqIEByZXR1cm4ge1N0cmluZ30gdGhlIGZvcm1hdHRlZCBTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGV4Y2VwdGlvbi4NCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCWZvcm1hdEV4Y2VwdGlvbjogZnVuY3Rpb24oZXgpIHsNCgkJaWYgKGV4KSB7DQoJCQl2YXIgZXhTdHIgPSAiXHQ8bG9nNGpzOnRocm93YWJsZT4iOyANCgkJCWlmIChleC5tZXNzYWdlKSB7DQoJCQkJZXhTdHIgKz0gICJcdFx0PGxvZzRqczptZXNzYWdlPjwhW0NEQVRBWyIgKyB0aGlzLmVzY2FwZUNkYXRhKGV4Lm1lc3NhZ2UpICsgIl1dPjwvbG9nNGpzOm1lc3NhZ2U+XG4iOwkNCgkJCX0gDQoJCQlpZiAoZXguZGVzY3JpcHRpb24pIHsNCgkJCQlleFN0ciArPSAgIlx0XHQ8bG9nNGpzOmRlc2NyaXB0aW9uPjwhW0NEQVRBWyIgKyB0aGlzLmVzY2FwZUNkYXRhKGV4LmRlc2NyaXB0aW9uKSArICJdXT48L2xvZzRqczpkZXNjcmlwdGlvbj5cbiI7CQ0KCQkJfQ0KCQkJDQoJCQlleFN0ciArPSAgIlx0XHQ8bG9nNGpzOnN0YWNrdHJhY2U+IjsNCgkJCWV4U3RyICs9ICAiXHRcdFx0PGxvZzRqczpsb2NhdGlvbiBmaWxlTmFtZT1cIiIrZXguZmlsZU5hbWUrIlwiIGxpbmVOdW1iZXI9XCIiK2V4LmxpbmVOdW1iZXIrIlwiIC8+IjsNCgkJCWV4U3RyICs9ICAiXHRcdDwvbG9nNGpzOnN0YWNrdHJhY2U+IjsNCgkJCWV4U3RyID0gIlx0PC9sb2c0anM6dGhyb3dhYmxlPiI7DQoJCQlyZXR1cm4gZXhTdHI7DQoJCX0NCgkJcmV0dXJuIG51bGw7DQoJfSwNCgkvKioNCgkgKiBFc2NhcGUgQ2RhdGEgbWVzc2FnZXMNCgkgKiBAcGFyYW0gc3RyIHtTdHJpbmd9IG1lc3NhZ2UgdG8gZXNjYXBlDQoJICogQHJldHVybiB7U3RyaW5nfSB0aGUgZXNjYXBlZCBtZXNzYWdlDQoJICogQHByaXZhdGUNCgkgKi8NCgllc2NhcGVDZGF0YTogZnVuY3Rpb24oc3RyKSB7DQoJCXJldHVybiBzdHIucmVwbGFjZSgvXF1cXT4vLCAiXV0+XV0mZ3Q7PCFbQ0RBVEFbIik7DQoJfQ0KfSk7DQoNCi8qKg0KICogSlNPTkxheW91dCB3cml0ZSB0aGUgbG9ncyBpbiBKU09OIGZvcm1hdC4NCiAqIEpTT04gbGlicmFyeSBpcyByZXF1aXJlZCB0byB1c2UgdGhpcyBMYXlvdXQuIFNlZSBhbHNvIHtAbGluayBodHRwOi8vd3d3Lmpzb24ub3JnfQ0KICogQGNvbnN0cnVjdG9yDQogKiBAZXh0ZW5kcyBMb2c0anMuTGF5b3V0DQogKiBAYXV0aG9yIFN0ZXBoYW4gU3RyaXR0bWF0dGVyDQogKi8NCkxvZzRqcy5KU09OTGF5b3V0ID0gZnVuY3Rpb24oKSB7DQoJdGhpcy5kZiA9IG5ldyBMb2c0anMuRGF0ZUZvcm1hdHRlcigpOw0KfTsNCkxvZzRqcy5KU09OTGF5b3V0LnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5MYXlvdXQoKSwgew0KCS8qKiANCgkgKiBJbXBsZW1lbnQgdGhpcyBtZXRob2QgdG8gY3JlYXRlIHlvdXIgb3duIGxheW91dCBmb3JtYXQuDQoJICogQHBhcmFtIHtMb2c0anMuTG9nZ2luZ0V2ZW50fSBsb2dnaW5nRXZlbnQgbG9nZ2luZ0V2ZW50IHRvIGZvcm1hdA0KCSAqIEByZXR1cm4gZm9ybWF0dGVkIFN0cmluZw0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWZvcm1hdDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCQ0KCQkJCXZhciB1c2VyYWdlbnQgPSAidW5rbm93biI7DQoJCXRyeSB7DQoJCQl1c2VyYWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KCQl9IGNhdGNoKGUpew0KCQkJdXNlcmFnZW50ID0gInVua25vd24iOw0KCQl9DQoJCQ0KCQl2YXIgcmVmZXJlciA9ICJ1bmtub3duIjsNCgkJdHJ5IHsNCgkJCXJlZmVyZXIgPSBsb2NhdGlvbi5ocmVmOw0KCQl9IGNhdGNoKGUpew0KCQkJcmVmZXJlciA9ICJ1bmtub3duIjsNCgkJfQ0KCQkNCgkJdmFyIGpzb25TdHJpbmcgPSAie1xuIFwiTG9nZ2luZ0V2ZW50XCI6IHtcbiI7DQoJCQ0KCQlqc29uU3RyaW5nICs9ICJcdFwibG9nZ2VyXCI6IFwiIiArICBsb2dnaW5nRXZlbnQuY2F0ZWdvcnlOYW1lICsgIlwiLFxuIjsNCgkJanNvblN0cmluZyArPSAiXHRcImxldmVsXCI6IFwiIiArICBsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKSArICJcIixcbiI7DQoJCWpzb25TdHJpbmcgKz0gIlx0XCJtZXNzYWdlXCI6IFwiIiArICBsb2dnaW5nRXZlbnQubWVzc2FnZSArICJcIixcbiI7IA0KCQlqc29uU3RyaW5nICs9ICJcdFwicmVmZXJlclwiOiBcIiIgKyByZWZlcmVyICsgIlwiLFxuIjsgDQoJCWpzb25TdHJpbmcgKz0gIlx0XCJ1c2VyYWdlbnRcIjogXCIiICsgdXNlcmFnZW50ICsgIlwiLFxuIjsgDQoJCWpzb25TdHJpbmcgKz0gIlx0XCJ0aW1lc3RhbXBcIjogXCIiICsgIHRoaXMuZGYuZm9ybWF0RGF0ZShsb2dnaW5nRXZlbnQuc3RhcnRUaW1lLCAieXl5eS1NTS1kZFRoaDptbTpzc1oiKSArICJcIixcbiI7DQoJCWpzb25TdHJpbmcgKz0gIlx0XCJleGNlcHRpb25cIjogXCIiICsgIGxvZ2dpbmdFdmVudC5leGNlcHRpb24gKyAiXCJcbiI7IA0KCQlqc29uU3RyaW5nICs9ICJ9fSI7ICAgICAgDQogICAgICAgIA0KICAgICAgICByZXR1cm4ganNvblN0cmluZzsNCgl9LA0KCS8qKiANCgkgKiBSZXR1cm5zIHRoZSBjb250ZW50IHR5cGUgb3V0cHV0IGJ5IHRoaXMgbGF5b3V0LiANCgkgKiBAcmV0dXJuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgInRleHQveG1sIi4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRDb250ZW50VHlwZTogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAidGV4dC9qc29uIjsNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIFJldHVybnMgdGhlIGhlYWRlciBmb3IgdGhlIGxheW91dCBmb3JtYXQuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgbnVsbC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRIZWFkZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIntcIkxvZzRqc1wiOiBbXG4iOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgZm9vdGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEZvb3RlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiXG5dfSI7DQoJfSwNCgkNCglnZXRTZXBhcmF0b3I6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIixcbiI7DQoJfQ0KfSk7DQoNCi8qKiANCiAqIFBhdHRlcm5MYXlvdXQgDQogKg0KICogQGNvbnN0cnVjdG9yDQogKiBAZXh0ZW5kcyBMb2c0anMuTGF5b3V0DQogKiBAYXV0aG9yIFN0ZXBoYW4gU3RyaXR0bWF0dGVyDQogKi8NCkxvZzRqcy5QYXR0ZXJuTGF5b3V0ID0gZnVuY3Rpb24ocGF0dGVybikgew0KCWlmIChwYXR0ZXJuKSB7DQoJCXRoaXMucGF0dGVybiA9IHBhdHRlcm47DQoJfSBlbHNlIHsNCgkJdGhpcy5wYXR0ZXJuID0gTG9nNGpzLlBhdHRlcm5MYXlvdXQuREVGQVVMVF9DT05WRVJTSU9OX1BBVFRFUk47DQoJfQ0KfTsNCg0KTG9nNGpzLlBhdHRlcm5MYXlvdXQuVFRDQ19DT05WRVJTSU9OX1BBVFRFUk4gPSAiJXIgJXAgJWMgLSAlbSVuIjsNCkxvZzRqcy5QYXR0ZXJuTGF5b3V0LkRFRkFVTFRfQ09OVkVSU0lPTl9QQVRURVJOID0gIiVtJW4iOw0KTG9nNGpzLlBhdHRlcm5MYXlvdXQuSVNPODYwMV9EQVRFRk9STUFUID0gInl5eXktTU0tZGQgSEg6bW06c3MsU1NTIjsNCkxvZzRqcy5QYXR0ZXJuTGF5b3V0LkRBVEVUSU1FX0RBVEVGT1JNQVQgPSAiZGQgTU1NIFlZWVkgSEg6bW06c3MsU1NTIjsNCkxvZzRqcy5QYXR0ZXJuTGF5b3V0LkFCU09MVVRFVElNRV9EQVRFRk9STUFUID0gIkhIOm1tOnNzLFNTUyI7DQoNCkxvZzRqcy5QYXR0ZXJuTGF5b3V0LnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5MYXlvdXQoKSwgew0KCS8qKiANCgkgKiBSZXR1cm5zIHRoZSBjb250ZW50IHR5cGUgb3V0cHV0IGJ5IHRoaXMgbGF5b3V0LiANCgkgKiBAcmV0dXJuICJ0ZXh0L3BsYWluIi4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRDb250ZW50VHlwZTogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAidGV4dC9wbGFpbiI7DQoJfSwNCgkvKiogDQoJICogQHJldHVybiBSZXR1cm5zIHRoZSBoZWFkZXIgZm9yIHRoZSBsYXlvdXQgZm9ybWF0Lg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEhlYWRlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiBudWxsOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgZm9vdGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRGb290ZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gbnVsbDsNCgl9LA0KCQ0KCWZvcm1hdDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCXZhciByZWdleCA9IC8lKC0/WzAtOV0rKT8oXC4/WzAtOV0rKT8oW2NkbW5wciVdKShceyhbXlx9XSspXH0pP3woW14lXSspLzsNCgkJdmFyIGZvcm1hdHRlZFN0cmluZyA9ICIiOw0KCQl2YXIgcmVzdWx0Ow0KCQl2YXIgc2VhcmNoU3RyaW5nID0gdGhpcy5wYXR0ZXJuOw0KDQoJCS8vIENhbm5vdCB1c2UgcmVnZXggZ2xvYmFsIGZsYWcgc2luY2UgaXQgZG9lc24ndCB3b3JrIGluIElFNQ0KCQl3aGlsZSAoKHJlc3VsdCA9IHJlZ2V4LmV4ZWMoc2VhcmNoU3RyaW5nKSkpIHsNCgkJCXZhciBtYXRjaGVkU3RyaW5nID0gcmVzdWx0WzBdOw0KCQkJdmFyIHBhZGRpbmcgPSByZXN1bHRbMV07DQoJCQl2YXIgdHJ1bmNhdGlvbiA9IHJlc3VsdFsyXTsNCgkJCXZhciBjb252ZXJzaW9uQ2hhcmFjdGVyID0gcmVzdWx0WzNdOw0KCQkJdmFyIHNwZWNpZmllciA9IHJlc3VsdFs1XTsNCgkJCXZhciB0ZXh0ID0gcmVzdWx0WzZdOw0KDQoJCQkvLyBDaGVjayBpZiB0aGUgcGF0dGVybiBtYXRjaGVkIHdhcyBqdXN0IG5vcm1hbCB0ZXh0DQoJCQlpZiAodGV4dCkgew0KCQkJCWZvcm1hdHRlZFN0cmluZyArPSAiIiArIHRleHQ7DQoJCQl9IGVsc2Ugew0KCQkJCS8vIENyZWF0ZSBhIHJhdyByZXBsYWNlbWVudCBzdHJpbmcgYmFzZWQgb24gdGhlIGNvbnZlcnNpb24NCgkJCQkvLyBjaGFyYWN0ZXIgYW5kIHNwZWNpZmllcg0KCQkJCXZhciByZXBsYWNlbWVudCA9ICIiOw0KCQkJCXN3aXRjaChjb252ZXJzaW9uQ2hhcmFjdGVyKSB7DQoJCQkJCWNhc2UgImMiOg0KCQkJCQkJdmFyIGxvZ2dlck5hbWUgPSBsb2dnaW5nRXZlbnQuY2F0ZWdvcnlOYW1lOw0KCQkJCQkJaWYgKHNwZWNpZmllcikgew0KCQkJCQkJCXZhciBwcmVjaXNpb24gPSBwYXJzZUludChzcGVjaWZpZXIsIDEwKTsNCgkJCQkJCQl2YXIgbG9nZ2VyTmFtZUJpdHMgPSBsb2dnaW5nRXZlbnQuY2F0ZWdvcnlOYW1lLnNwbGl0KCIuIik7DQoJCQkJCQkJaWYgKHByZWNpc2lvbiA+PSBsb2dnZXJOYW1lQml0cy5sZW5ndGgpIHsNCgkJCQkJCQkJcmVwbGFjZW1lbnQgPSBsb2dnZXJOYW1lOw0KCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCXJlcGxhY2VtZW50ID0gbG9nZ2VyTmFtZUJpdHMuc2xpY2UobG9nZ2VyTmFtZUJpdHMubGVuZ3RoIC0gcHJlY2lzaW9uKS5qb2luKCIuIik7DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQlyZXBsYWNlbWVudCA9IGxvZ2dlck5hbWU7DQoJCQkJCQl9DQoJCQkJCQlicmVhazsNCgkJCQkJY2FzZSAiZCI6DQoJCQkJCQl2YXIgZGF0ZUZvcm1hdCA9IExvZzRqcy5QYXR0ZXJuTGF5b3V0LklTTzg2MDFfREFURUZPUk1BVDsNCgkJCQkJCWlmIChzcGVjaWZpZXIpIHsNCgkJCQkJCQlkYXRlRm9ybWF0ID0gc3BlY2lmaWVyOw0KCQkJCQkJCS8vIFBpY2sgdXAgc3BlY2lhbCBjYXNlcw0KCQkJCQkJCWlmIChkYXRlRm9ybWF0ID09ICJJU084NjAxIikgew0KCQkJCQkJCQlkYXRlRm9ybWF0ID0gTG9nNGpzLlBhdHRlcm5MYXlvdXQuSVNPODYwMV9EQVRFRk9STUFUOw0KCQkJCQkJCX0gZWxzZSBpZiAoZGF0ZUZvcm1hdCA9PSAiQUJTT0xVVEUiKSB7DQoJCQkJCQkJCWRhdGVGb3JtYXQgPSBMb2c0anMuUGF0dGVybkxheW91dC5BQlNPTFVURVRJTUVfREFURUZPUk1BVDsNCgkJCQkJCQl9IGVsc2UgaWYgKGRhdGVGb3JtYXQgPT0gIkRBVEUiKSB7DQoJCQkJCQkJCWRhdGVGb3JtYXQgPSBMb2c0anMuUGF0dGVybkxheW91dC5EQVRFVElNRV9EQVRFRk9STUFUOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJCS8vIEZvcm1hdCB0aGUgZGF0ZQ0KCQkJCQkJcmVwbGFjZW1lbnQgPSAobmV3IExvZzRqcy5TaW1wbGVEYXRlRm9ybWF0KGRhdGVGb3JtYXQpKS5mb3JtYXQobG9nZ2luZ0V2ZW50LnN0YXJ0VGltZSk7DQoJCQkJCQlicmVhazsNCgkJCQkJY2FzZSAibSI6DQoJCQkJCQlyZXBsYWNlbWVudCA9IGxvZ2dpbmdFdmVudC5tZXNzYWdlOw0KCQkJCQkJYnJlYWs7DQoJCQkJCWNhc2UgIm4iOg0KCQkJCQkJcmVwbGFjZW1lbnQgPSAiXG4iOw0KCQkJCQkJYnJlYWs7DQoJCQkJCWNhc2UgInAiOg0KCQkJCQkJcmVwbGFjZW1lbnQgPSBsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKTsNCgkJCQkJCWJyZWFrOw0KCQkJCQljYXNlICJyIjoNCgkJCQkJCXJlcGxhY2VtZW50ID0gIiIgKyBsb2dnaW5nRXZlbnQuc3RhcnRUaW1lLnRvTG9jYWxlVGltZVN0cmluZygpOyAvL1RPRE86IC5nZXREaWZmZXJlbmNlKExvZzRqcy5hcHBsaWNhdGlvblN0YXJ0RGF0ZSk7DQoJCQkJCQlicmVhazsNCgkJCQkJY2FzZSAiJSI6DQoJCQkJCQlyZXBsYWNlbWVudCA9ICIlIjsNCgkJCQkJCWJyZWFrOw0KCQkJCQlkZWZhdWx0Og0KCQkJCQkJcmVwbGFjZW1lbnQgPSBtYXRjaGVkU3RyaW5nOw0KCQkJCQkJYnJlYWs7DQoJCQkJfQ0KCQkJCS8vIEZvcm1hdCB0aGUgcmVwbGFjZW1lbnQgYWNjb3JkaW5nIHRvIGFueSBwYWRkaW5nIG9yDQoJCQkJLy8gdHJ1bmNhdGlvbiBzcGVjaWZpZWQNCg0KCQkJCXZhciBsZW47DQoNCgkJCQkvLyBGaXJzdCwgdHJ1bmNhdGlvbg0KCQkJCWlmICh0cnVuY2F0aW9uKSB7DQoJCQkJCWxlbiA9IHBhcnNlSW50KHRydW5jYXRpb24uc3Vic3RyKDEpLCAxMCk7DQoJCQkJCXJlcGxhY2VtZW50ID0gcmVwbGFjZW1lbnQuc3Vic3RyaW5nKDAsIGxlbik7DQoJCQkJfQ0KCQkJCS8vIE5leHQsIHBhZGRpbmcNCgkJCQlpZiAocGFkZGluZykgew0KCQkJCQlpZiAocGFkZGluZy5jaGFyQXQoMCkgPT0gIi0iKSB7DQoJCQkJCQlsZW4gPSBwYXJzZUludChwYWRkaW5nLnN1YnN0cigxKSwgMTApOw0KCQkJCQkJLy8gUmlnaHQgcGFkIHdpdGggc3BhY2VzDQoJCQkJCQl3aGlsZSAocmVwbGFjZW1lbnQubGVuZ3RoIDwgbGVuKSB7DQoJCQkJCQkJcmVwbGFjZW1lbnQgKz0gIiAiOw0KCQkJCQkJfQ0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJbGVuID0gcGFyc2VJbnQocGFkZGluZywgMTApOw0KCQkJCQkJLy8gTGVmdCBwYWQgd2l0aCBzcGFjZXMNCgkJCQkJCXdoaWxlIChyZXBsYWNlbWVudC5sZW5ndGggPCBsZW4pIHsNCgkJCQkJCQlyZXBsYWNlbWVudCA9ICIgIiArIHJlcGxhY2VtZW50Ow0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJCWZvcm1hdHRlZFN0cmluZyArPSByZXBsYWNlbWVudDsNCgkJCX0NCgkJCXNlYXJjaFN0cmluZyA9IHNlYXJjaFN0cmluZy5zdWJzdHIocmVzdWx0LmluZGV4ICsgcmVzdWx0WzBdLmxlbmd0aCk7DQoJCX0NCgkJcmV0dXJuIGZvcm1hdHRlZFN0cmluZzsNCgl9DQp9KTsNCg0KLyoqDQogKiBAcHJpdmF0ZQ0KICogQGlnbm9yZQ0KICovDQppZiAoIUFycmF5LnByb3RvdHlwZS5wdXNoKSB7DQoJLyoqDQoJICogRnVuY3Rpb25zIHRha2VuIGZyb20gUHJvdG90eXBlIGxpYnJhcnksIGRpZG4ndCB3YW50IHRvIHJlcXVpcmUgZm9yIGp1c3QgZmV3IA0KCSAqIGZ1bmN0aW9ucy4NCgkgKiBNb3JlIGluZm8gYXQge0BsaW5rIGh0dHA6Ly9wcm90b3R5cGUuY29uaW8ubmV0L30NCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCUFycmF5LnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oKSB7DQoJCXZhciBzdGFydExlbmd0aCA9IHRoaXMubGVuZ3RoOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgew0KCQkJdGhpc1tzdGFydExlbmd0aCArIGldID0gYXJndW1lbnRzW2ldOw0KCQl9DQoJCXJldHVybiB0aGlzLmxlbmd0aDsNCgl9Ow0KfQ0KDQovKioNCiAqIEZJRk8gYnVmZmVyDQogKiBAY29uc3RydWN0b3INCiAqIEBwcml2YXRlDQogKi8NCkxvZzRqcy5GaWZvQnVmZmVyID0gZnVuY3Rpb24oKQ0Kew0KICB0aGlzLmFycmF5ID0gbmV3IEFycmF5KCk7DQp9Ow0KDQpMb2c0anMuRmlmb0J1ZmZlci5wcm90b3R5cGUgPSB7DQoNCgkvKioNCgkgKiBAcGFyYW0ge09iamVjdH0gb2JqIGFueSBvYmplY3QgYWRkZWQgdG8gYnVmZmVyDQoJICovDQoJcHVzaCA6IGZ1bmN0aW9uKG9iaikgew0KICAgICAgICB0aGlzLmFycmF5W3RoaXMuYXJyYXkubGVuZ3RoXSA9IG9iajsNCiAgICAgICAgcmV0dXJuIHRoaXMuYXJyYXkubGVuZ3RoOw0KCX0sDQoJDQoJLyoqDQoJICogQHJldHVybiBmaXJzdCBwdXR0ZWQgaW4gT2JqZWN0DQoJICovDQoJcHVsbCA6IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5hcnJheS5sZW5ndGggPiAwKSB7DQoJCQl2YXIgZmlyc3RJdGVtID0gdGhpcy5hcnJheVswXTsNCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5hcnJheS5sZW5ndGggLSAxOyBpKyspIHsNCgkJCQl0aGlzLmFycmF5W2ldID0gdGhpcy5hcnJheVtpICsgMV07DQoJCQl9DQoJCQl0aGlzLmFycmF5Lmxlbmd0aCA9IHRoaXMuYXJyYXkubGVuZ3RoIC0gMTsNCgkJCXJldHVybiBmaXJzdEl0ZW07DQoJCX0NCgkJcmV0dXJuIG51bGw7DQoJfSwNCgkNCglsZW5ndGggOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHRoaXMuYXJyYXkubGVuZ3RoOw0KCX0NCn07DQoNCg0KDQovKioNCiAqIERhdGUgRm9ybWF0dGVyDQogKiBhZGRaZXJvKCkgYW5kIGZvcm1hdERhdGUoKSBhcmUgY291cnRlc3kgb2YgTWlrZSBHb2xkaW5nOg0KICogaHR0cDovL3d3dy5taWtlemlsbGEuY29tL2V4cDAwMTUuaHRtbA0KICogQGNvbnN0cnVjdG9yDQogKi8gDQpMb2c0anMuRGF0ZUZvcm1hdHRlciA9IGZ1bmN0aW9uKCkgew0KCXJldHVybjsNCn07DQovKioNCiAqIGRlZmF1bHQgZm9ybWF0IG9mIGRhdGUgKElTTy04NjAxKQ0KICogQHN0YXRpYw0KICogQGZpbmFsDQogKi8NCkxvZzRqcy5EYXRlRm9ybWF0dGVyLkRFRkFVTFRfREFURV9GT1JNQVQgPSAieXl5eS1NTS1kZFRoaDptbTpzc08iOw0KDQoNCkxvZzRqcy5EYXRlRm9ybWF0dGVyLnByb3RvdHlwZSA9IHsNCgkvKioNCgkgKiBGb3JtYXRzIHRoZSBnaXZlbiBkYXRlIGJ5IHRoZSBnaXZlbiBwYXR0ZXJuLjxiciAvPg0KCSAqIEZvbGxvd2luZyBzd2l0Y2hlcyBhcmUgc3VwcG9ydGVkOg0KCSAqIDx1bD4NCgkgKiA8bGk+eXl5eTogVGhlIHllYXI8L2xpPg0KCSAqIDxsaT5NTTogdGhlIG1vbnRoPC9saT4NCgkgKiA8bGk+ZGQ6IHRoZSBkYXkgb2YgbW9udGg8bGk+DQoJICogPGxpPmhoOiB0aGUgaG91cjxsaT4NCgkgKiA8bGk+bW06IG1pbnV0ZXM8L2xpPg0KCSAqIDxsaT5POiB0aW1lem9uZSBvZmZzZXQ8L2xpPg0KCSAqIDwvdWw+DQoJICogQHBhcmFtIHtEYXRlfSB2RGF0ZSB0aGUgZGF0ZSB0byBmb3JtYXQNCgkgKiBAcGFyYW0ge1N0cmluZ30gdkZvcm1hdCB0aGUgZm9ybWF0IHBhdHRlcm4NCgkgKiBAcmV0dXJuIHtTdHJpbmd9IGZvcm1hdHRlZCBkYXRlIHN0cmluZw0KCSAqIEBzdGF0aWMNCgkgKi8NCglmb3JtYXREYXRlIDogZnVuY3Rpb24odkRhdGUsIHZGb3JtYXQpIHsNCgkgIHZhciB2RGF5ID0gdGhpcy5hZGRaZXJvKHZEYXRlLmdldERhdGUoKSk7DQoJICB2YXIgdk1vbnRoID0gdGhpcy5hZGRaZXJvKHZEYXRlLmdldE1vbnRoKCkrMSk7DQoJICB2YXIgdlllYXJMb25nID0gdGhpcy5hZGRaZXJvKHZEYXRlLmdldEZ1bGxZZWFyKCkpOw0KCSAgdmFyIHZZZWFyU2hvcnQgPSB0aGlzLmFkZFplcm8odkRhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpLnN1YnN0cmluZygzLDQpKTsNCgkgIHZhciB2WWVhciA9ICh2Rm9ybWF0LmluZGV4T2YoInl5eXkiKT4tMT92WWVhckxvbmc6dlllYXJTaG9ydCk7DQoJICB2YXIgdkhvdXIgID0gdGhpcy5hZGRaZXJvKHZEYXRlLmdldEhvdXJzKCkpOw0KCSAgdmFyIHZNaW51dGUgPSB0aGlzLmFkZFplcm8odkRhdGUuZ2V0TWludXRlcygpKTsNCgkgIHZhciB2U2Vjb25kID0gdGhpcy5hZGRaZXJvKHZEYXRlLmdldFNlY29uZHMoKSk7DQoJICB2YXIgdlRpbWVab25lID0gdGhpcy5PKHZEYXRlKTsNCgkgIHZhciB2RGF0ZVN0cmluZyA9IHZGb3JtYXQucmVwbGFjZSgvZGQvZywgdkRheSkucmVwbGFjZSgvTU0vZywgdk1vbnRoKS5yZXBsYWNlKC95ezEsNH0vZywgdlllYXIpOw0KCSAgdkRhdGVTdHJpbmcgPSB2RGF0ZVN0cmluZy5yZXBsYWNlKC9oaC9nLCB2SG91cikucmVwbGFjZSgvbW0vZywgdk1pbnV0ZSkucmVwbGFjZSgvc3MvZywgdlNlY29uZCk7DQoJICB2RGF0ZVN0cmluZyA9IHZEYXRlU3RyaW5nLnJlcGxhY2UoL08vZywgdlRpbWVab25lKTsNCgkgIHJldHVybiB2RGF0ZVN0cmluZzsNCgl9LA0KCQkNCgkvKioNCgkgKiBAcHJpdmF0ZQ0KCSAqIEBzdGF0aWMNCgkgKi8NCglhZGRaZXJvIDogZnVuY3Rpb24odk51bWJlcikgew0KCSAgcmV0dXJuICgodk51bWJlciA8IDEwKSA/ICIwIiA6ICIiKSArIHZOdW1iZXI7DQoJfSwNCgkNCgkvKioNCgkgKiBGb3JtYXRlcyB0aGUgVGltZU9mZmVzdA0KCSAqIFRoYW5rcyB0byBodHRwOi8vd3d3LnN2ZW5kdG9mdGUuY29tL2NvZGUvZGF0ZV9mb3JtYXQvDQoJICogQHByaXZhdGUNCgkgKi8NCglPIDogZnVuY3Rpb24gKGRhdGUpIHsNCgkJLy8gRGlmZmVyZW5jZSB0byBHcmVlbndpY2ggdGltZSAoR01UKSBpbiBob3Vycw0KCQl2YXIgb3MgPSBNYXRoLmFicyhkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkpOw0KCQl2YXIgaCA9IFN0cmluZyhNYXRoLmZsb29yKG9zLzYwKSk7DQoJCXZhciBtID0gU3RyaW5nKG9zJTYwKTsNCgkJaC5sZW5ndGggPT0gMT8gaCA9ICIwIitoOjE7DQoJCW0ubGVuZ3RoID09IDE/IG0gPSAiMCIrbToxOw0KCQlyZXR1cm4gZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpIDwgMCA/ICIrIitoK20gOiAiLSIraCttOw0KCX0NCn07DQoNCg0KLyoqDQogKiBpbnRlcm5hbCBMb2dnZXIgdG8gYmUgdXNlZA0KICogQHByaXZhdGUNCiAqLw0KdmFyIGxvZzRqc0xvZ2dlciA9IExvZzRqcy5nZXRMb2dnZXIoIkxvZzRqcyIpOw0KbG9nNGpzTG9nZ2VyLmFkZEFwcGVuZGVyKG5ldyBMb2c0anMuQ29uc29sZUFwcGVuZGVyKCkpOw0KbG9nNGpzTG9nZ2VyLnNldExldmVsKExvZzRqcy5MZXZlbC5BTEwpOw==",
                "body": "LyoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KDQovKmpzbDpvcHRpb24gZXhwbGljaXQqLw0KDQovKioNCiAqIEBmaWxlb3ZlcnZpZXcgbG9nNGpzIGlzIGEgbGlicmFyeSB0byBsb2cgaW4gSmF2YVNjcmlwdCBpbiBzaW1pbGFyIG1hbm5lciANCiAqIHRoYW4gaW4gbG9nNGogZm9yIEphdmEuIFRoZSBBUEkgc2hvdWxkIGJlIG5lYXJseSB0aGUgc2FtZS4NCiAqIA0KICogVGhpcyBmaWxlIGNvbnRhaW5zIGFsbCBsb2c0anMgY29kZSBhbmQgaXMgdGhlIG9ubHkgZmlsZSByZXF1aXJlZCBmb3IgbG9nZ2luZy4NCiAqIA0KICogPGgzPkV4YW1wbGU6PC9oMz4NCiAqIDxwcmU+DQogKiAgdmFyIGxvZyA9IG5ldyBMb2c0anMuZ2V0TG9nZ2VyKCJzb21lLWNhdGVnb3J5LW5hbWUiKTsgLy9jcmVhdGUgbG9nZ2VyIGluc3RhbmNlDQogKiAgbG9nLnNldExldmVsKExvZzRqcy5MZXZlbC5UUkFDRSk7IC8vc2V0IHRoZSBMZXZlbA0KICogIGxvZy5hZGRBcHBlbmRlcihuZXcgQ29uc29sZUFwcGVuZGVyKGxvZywgZmFsc2UpKTsgLy8gY29uc29sZSB0aGF0IGxhdW5jaGVzIGluIG5ldyB3aW5kb3cNCiANCiAqICAvLyBpZiBtdWx0aXBsZSBhcHBlbmRlcnMgYXJlIHNldCBhbGwgd2lsbCBsb2cNCiAqICBsb2cuYWRkQXBwZW5kZXIobmV3IENvbnNvbGVBcHBlbmRlcihsb2csIHRydWUpKTsgLy8gY29uc29sZSB0aGF0IGlzIGluLWxpbmUgaW4gdGhlIHBhZ2UNCiAqICBsb2cuYWRkQXBwZW5kZXIobmV3IEZpbGVBcHBlbmRlcigiQzpcXHNvbWVmaWxlLmxvZyIpKTsgLy8gZmlsZSBhcHBlbmRlciBsb2dzIHRvIEM6XFxzb21lZmlsZS5sb2cNCiAqIA0KICogIC4uLg0KICogDQogKiAgLy9jYWxsIHRoZSBsb2cNCiAqICBsb2cudHJhY2UoInRyYWNlIG1lIiApOw0KICogPC9wcmU+DQogKg0KICogQHZlcnNpb24gMS4wLjANCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXIgLSBodHRwOi8vanJvbGxlci5jb20vcGFnZS9zdHJpdHRpDQogKiBAYXV0aG9yIFNldGggQ2hpc2Ftb3JlIC0gaHR0cDovL3d3dy5jaGlzYW1vcmUuY29tDQogKiBAc2luY2UgMjAwNS0wNS0yMA0KICogQHN0YXRpYw0KICogV2Vic2l0ZTogaHR0cDovL3N0cml0dGkuZ2l0aHViLmlvL2xvZzRqcy8NCiAqLw0KdmFyIExvZzRqcyA9IHsNCgkNCgkvKiogDQoJICogQ3VycmVudCB2ZXJzaW9uIG9mIGxvZzRqcy4gDQoJICogQHN0YXRpYw0KCSAqIEBmaW5hbA0KCSAqLw0KICAJdmVyc2lvbjogIjEuMC4wIiwNCg0KCS8qKiAgDQoJICogRGF0ZSBvZiBsb2dnZXIgaW5pdGlhbGl6ZWQuDQoJICogQHN0YXRpYw0KCSAqIEBmaW5hbA0KCSAqLw0KCWFwcGxpY2F0aW9uU3RhcnREYXRlOiBuZXcgRGF0ZSgpLA0KCQkNCgkvKiogIA0KCSAqIEhhc2h0YWJsZSBvZiBsb2dnZXJzLg0KCSAqIEBzdGF0aWMNCgkgKiBAZmluYWwNCgkgKiBAcHJpdmF0ZSAgDQoJICovDQoJbG9nZ2Vyczoge30sDQoJDQoJLyoqDQoJICogR2V0IGEgbG9nZ2VyIGluc3RhbmNlLiBJbnN0YW5jZSBpcyBjYWNoZWQgb24gY2F0ZWdvcnlOYW1lIGxldmVsLg0KCSAqIEBwYXJhbSAge1N0cmluZ30gY2F0ZWdvcnlOYW1lIG5hbWUgb2YgY2F0ZWdvcnkgdG8gbG9nIHRvLg0KCSAqIEByZXR1cm4ge0xvZ2dlcn0gaW5zdGFuY2Ugb2YgbG9nZ2VyIGZvciB0aGUgY2F0ZWdvcnkNCgkgKiBAc3RhdGljDQoJICovDQoJZ2V0TG9nZ2VyOiBmdW5jdGlvbihjYXRlZ29yeU5hbWUpIHsNCgkJDQoJCS8vIFVzZSBkZWZhdWx0IGxvZ2dlciBpZiBjYXRlZ29yeU5hbWUgaXMgbm90IHNwZWNpZmllZCBvciBpbnZhbGlkDQoJCWlmICghKHR5cGVvZiBjYXRlZ29yeU5hbWUgPT0gInN0cmluZyIpKSB7DQoJCQljYXRlZ29yeU5hbWUgPSAiW2RlZmF1bHRdIjsNCgkJfQ0KDQoJCWlmICghTG9nNGpzLmxvZ2dlcnNbY2F0ZWdvcnlOYW1lXSkgew0KCQkJLy8gQ3JlYXRlIHRoZSBsb2dnZXIgZm9yIHRoaXMgbmFtZSBpZiBpdCBkb2Vzbid0IGFscmVhZHkgZXhpc3QNCgkJCUxvZzRqcy5sb2dnZXJzW2NhdGVnb3J5TmFtZV0gPSBuZXcgTG9nNGpzLkxvZ2dlcihjYXRlZ29yeU5hbWUpOw0KCQl9DQoJCQ0KCQlyZXR1cm4gTG9nNGpzLmxvZ2dlcnNbY2F0ZWdvcnlOYW1lXTsNCgl9LA0KCQ0KCS8qKg0KCSAqIEdldCB0aGUgZGVmYXVsdCBsb2dnZXIgaW5zdGFuY2UuDQoJICogQHJldHVybiB7TG9nZ2VyfSBpbnN0YW5jZSBvZiBkZWZhdWx0IGxvZ2dlcg0KCSAqIEBzdGF0aWMNCgkgKi8NCglnZXREZWZhdWx0TG9nZ2VyOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIExvZzRqcy5nZXRMb2dnZXIoIltkZWZhdWx0XSIpOyANCgl9LA0KCQ0KICAJLyoqDQogIAkgKiBBdGF0Y2ggYW4gb2JzZXJ2ZXIgZnVuY3Rpb24gdG8gYW4gZWxlbWVudHMgZXZlbnQgYnJvd3NlciBpbmRlcGVuZGVudC4NCiAgCSAqIA0KICAJICogQHBhcmFtIGVsZW1lbnQgZWxlbWVudCB0byBhdHRhY2ggZXZlbnQNCiAgCSAqIEBwYXJhbSBuYW1lIG5hbWUgb2YgZXZlbnQNCiAgCSAqIEBwYXJhbSBvYnNlcnZlciBvYnNlcnZlciBtZXRob2QgdG8gYmUgY2FsbGVkDQogIAkgKiBAcHJpdmF0ZQ0KICAJICovDQogIAlhdHRhY2hFdmVudDogZnVuY3Rpb24gKGVsZW1lbnQsIG5hbWUsIG9ic2VydmVyKSB7DQoJCWlmIChlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsgLy9ET00gZXZlbnQgbW9kZWwNCgkJCWVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBvYnNlcnZlciwgZmFsc2UpOw0KICAgIAl9IGVsc2UgaWYgKGVsZW1lbnQuYXR0YWNoRXZlbnQpIHsgLy9NJCBldmVudCBtb2RlbA0KCQkJZWxlbWVudC5hdHRhY2hFdmVudCgnb24nICsgbmFtZSwgb2JzZXJ2ZXIpOw0KICAgIAl9DQoJfQ0KCQ0KCS8qKg0KCSAqIExvYWQgYSBKUy1zY3JpcHQgZHluYW1pY2FsbHkuDQoJICogQHBhcmFtIHtTdHJpbmd9IHNyYw0KCSAqLw0KLyoJJGltcG9ydDogZnVuY3Rpb24gKHNyYykgew0KCQl2YXIgZG9jdW1lbnRTY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpOw0KCQ0KCQlmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBkb2N1bWVudFNjcmlwdHMubGVuZ3RoOyArK2luZGV4KQ0KCQl7DQoJCQl2YXIgZG9jdW1lbnRTY3JpcHQgPSBkb2N1bWVudFNjcmlwdHNbaW5kZXhdOw0KCQkJaWYgKGRvY3VtZW50U2NyaXB0LnNyYyA9PSBzcmMpIHsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoJCX0NCgkJDQoJCXZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsNCgkJc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsNCgkJc2NyaXB0LnNyYyA9IHNyYzsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChzY3JpcHQpOyANCgkJDQoJCXJldHVybiB0cnVlOw0KCX0NCgkqLw0KfTsNCg0KLyoqIA0KICogQG5hbWVzcGFjZSANCiAqIEBjb25zdHJ1Y3Rvcg0KICovDQpMb2c0anMgPSBmdW5jdGlvbigpe307DQoNCi8qKg0KICogSW50ZXJuYWwgb2JqZWN0IGV4dGVuc2lvbiAoT08pIG1ldGhvZHMuDQogKiANCiAqIEBwcml2YXRlDQogKi8NCkxvZzRqcy5leHRlbmQgPSBmdW5jdGlvbihkZXN0aW5hdGlvbiwgc291cmNlKSB7DQogIGZvciAocHJvcGVydHkgaW4gc291cmNlKSB7DQogICAgZGVzdGluYXRpb25bcHJvcGVydHldID0gc291cmNlW3Byb3BlcnR5XTsNCiAgfQ0KICByZXR1cm4gZGVzdGluYXRpb247DQp9Ow0KICAgIA0KLyoqDQogKiBGdW5jdGlvbnMgdGFrZW4gZnJvbSBQcm90b3R5cGUgbGlicmFyeSwgIA0KICogZGlkbid0IHdhbnQgdG8gcmVxdWlyZSBmb3IganVzdCBmZXcgZnVuY3Rpb25zLg0KICogTW9yZSBpbmZvIGF0IHtAbGluayBodHRwOi8vcHJvdG90eXBlLmNvbmlvLm5ldC99DQogKiBAcHJpdmF0ZQ0KICovCQ0KTG9nNGpzLmJpbmQgPSBmdW5jdGlvbihmbiwgb2JqZWN0KSB7DQogIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KG9iamVjdCwgYXJndW1lbnRzKTsNCiAgfTsNCn07DQoNCi8qKg0KICogTG9nNGpzLkxldmVsIEVudW1lcmF0aW9uLiBEbyBub3QgdXNlIGRpcmVjdGx5LiBVc2Ugc3RhdGljIG9iamVjdHMgaW5zdGVhZC4NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIHtOdW1iZXJ9IGxldmVsIG51bWJlciBvZiBsZXZlbA0KICogQHBhcmFtIHtTdHJpbmd9IGxldmVsU3RyaW5nIFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBsZXZlbA0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLkxldmVsID0gZnVuY3Rpb24obGV2ZWwsIGxldmVsU3RyKSB7DQoJdGhpcy5sZXZlbCA9IGxldmVsOw0KCXRoaXMubGV2ZWxTdHIgPSBsZXZlbFN0cjsNCn07DQoNCkxvZzRqcy5MZXZlbC5wcm90b3R5cGUgPSAgew0KCS8qKiANCgkgKiBjb252ZXJ0cyBnaXZlbiBTdHJpbmcgdG8gY29ycmVzcG9uZGluZyBMZXZlbA0KCSAqIEBwYXJhbSB7U3RyaW5nfSBzQXJnIFN0cmluZyB2YWx1ZSBvZiBMZXZlbA0KCSAqIEBwYXJhbSB7TG9nNGpzLkxldmVsfSBkZWZhdWx0TGV2ZWwgZGVmYXVsdCBMZXZlbCwgaWYgbm8gU3RyaW5nIHJlcHJlc2VudGF0aW9uDQoJICogQHJldHVybiBMZXZlbCBvYmplY3QNCgkgKiBAdHlwZSBMb2c0anMuTGV2ZWwNCgkgKi8NCgl0b0xldmVsOiBmdW5jdGlvbihzQXJnLCBkZWZhdWx0TGV2ZWwpIHsgICAgICAgICAgICAgICAgICANCgkJCQkNCgkJaWYoc0FyZyA9PT0gbnVsbCkgew0KCQkJcmV0dXJuIGRlZmF1bHRMZXZlbDsNCgkJfQ0KCQkNCgkJaWYodHlwZW9mIHNBcmcgPT0gInN0cmluZyIpIHsgDQoJCQl2YXIgcyA9IHNBcmcudG9VcHBlckNhc2UoKTsNCgkJCQ0KCQkJc3dpdGNoKHMpIHsNCgkJCQljYXNlICJBTEwiOiByZXR1cm4gTG9nNGpzLkxldmVsLkFMTDsNCgkJCQljYXNlICJERUJVRyI6IHJldHVybiBMb2c0anMuTGV2ZWwuREVCVUc7DQoJCQkJY2FzZSAiSU5GTyI6IHJldHVybiBMb2c0anMuTGV2ZWwuSU5GTzsNCgkJCQljYXNlICJXQVJOIjogcmV0dXJuIExvZzRqcy5MZXZlbC5XQVJOOw0KCQkJCWNhc2UgIkVSUk9SIjogcmV0dXJuIExvZzRqcy5MZXZlbC5FUlJPUjsNCgkJCQljYXNlICJGQVRBTCI6IHJldHVybiBMb2c0anMuTGV2ZWwuRkFUQUw7DQoJCQkJY2FzZSAiT0ZGIjogcmV0dXJuIExvZzRqcy5MZXZlbC5PRkY7DQoJCQkJY2FzZSAiVFJBQ0UiOiByZXR1cm4gTG9nNGpzLkxldmVsLlRSQUNFOw0KCQkJCWRlZmF1bHQ6IHJldHVybiBkZWZhdWx0TGV2ZWw7DQoJCQl9DQoJCX0gZWxzZSBpZih0eXBlb2Ygc0FyZyA9PSAibnVtYmVyIikgew0KCQkJc3dpdGNoKHNBcmcpIHsNCgkJCQljYXNlIEFMTF9JTlQ6IHJldHVybiBMb2c0anMuTGV2ZWwuQUxMOw0KCQkJCWNhc2UgREVCVUdfSU5UOiByZXR1cm4gTG9nNGpzLkxldmVsLkRFQlVHOw0KCQkJCWNhc2UgSU5GT19JTlQ6IHJldHVybiBMb2c0anMuTGV2ZWwuSU5GTzsNCgkJCQljYXNlIFdBUk5fSU5UOiByZXR1cm4gTG9nNGpzLkxldmVsLldBUk47DQoJCQkJY2FzZSBFUlJPUl9JTlQ6IHJldHVybiBMb2c0anMuTGV2ZWwuRVJST1I7DQoJCQkJY2FzZSBGQVRBTF9JTlQ6IHJldHVybiBMb2c0anMuTGV2ZWwuRkFUQUw7DQoJCQkJY2FzZSBPRkZfSU5UOiByZXR1cm4gTG9nNGpzLkxldmVsLk9GRjsNCgkJCQljYXNlIFRSQUNFX0lOVDogcmV0dXJuIExvZzRqcy5MZXZlbC5UUkFDRTsNCgkJCQlkZWZhdWx0OiByZXR1cm4gZGVmYXVsdExldmVsOw0KCQkJfQ0KCQl9IGVsc2Ugew0KCQkJcmV0dXJuIGRlZmF1bHRMZXZlbDsJDQoJCX0NCgl9LAkNCgkvKiogDQoJICogQHJldHVybiAgY29udmVydGVkIExldmVsIHRvIFN0cmluZw0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLwkJDQoJdG9TdHJpbmc6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gdGhpcy5sZXZlbFN0cjsJDQoJfSwNCgkvKiogDQoJICogQHJldHVybiBpbnRlcm5hbCBOdW1iZXIgdmFsdWUgb2YgTGV2ZWwNCgkgKiBAdHlwZSBOdW1iZXINCgkgKi8JCQkNCgl2YWx1ZU9mOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHRoaXMubGV2ZWw7DQoJfQ0KfTsNCg0KLy8gU3RhdGljIHZhcmlhYmxlcw0KLyoqIA0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLkxldmVsLk9GRl9JTlQgPSBOdW1iZXIuTUFYX1ZBTFVFOw0KLyoqIA0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLkxldmVsLkZBVEFMX0lOVCA9IDUwMDAwOw0KLyoqIA0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLkxldmVsLkVSUk9SX0lOVCA9IDQwMDAwOw0KLyoqIA0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLkxldmVsLldBUk5fSU5UID0gMzAwMDA7DQovKiogDQogKiBAcHJpdmF0ZQ0KICovDQpMb2c0anMuTGV2ZWwuSU5GT19JTlQgPSAyMDAwMDsNCi8qKiANCiAqIEBwcml2YXRlDQogKi8NCkxvZzRqcy5MZXZlbC5ERUJVR19JTlQgPSAxMDAwMDsNCi8qKiANCiAqIEBwcml2YXRlDQogKi8NCkxvZzRqcy5MZXZlbC5UUkFDRV9JTlQgPSA1MDAwOw0KLyoqIA0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLkxldmVsLkFMTF9JTlQgPSBOdW1iZXIuTUlOX1ZBTFVFOw0KDQovKiogDQogKiBMb2dnaW5nIExldmVsIE9GRiAtIGFsbCBkaXNhYmxlZA0KICogQHR5cGUgTG9nNGpzLkxldmVsDQogKiBAc3RhdGljDQogKi8NCkxvZzRqcy5MZXZlbC5PRkYgPSBuZXcgTG9nNGpzLkxldmVsKExvZzRqcy5MZXZlbC5PRkZfSU5ULCAiT0ZGIik7DQovKiogDQogKiBMb2dnaW5nIExldmVsIEZhdGFsDQogKiBAdHlwZSBMb2c0anMuTGV2ZWwNCiAqIEBzdGF0aWMNCiAqLw0KTG9nNGpzLkxldmVsLkZBVEFMID0gbmV3IExvZzRqcy5MZXZlbChMb2c0anMuTGV2ZWwuRkFUQUxfSU5ULCAiRkFUQUwiKTsNCi8qKiANCiAqIExvZ2dpbmcgTGV2ZWwgRXJyb3INCiAqIEB0eXBlIExvZzRqcy5MZXZlbA0KICogQHN0YXRpYw0KICovDQpMb2c0anMuTGV2ZWwuRVJST1IgPSBuZXcgTG9nNGpzLkxldmVsKExvZzRqcy5MZXZlbC5FUlJPUl9JTlQsICJFUlJPUiIpOyANCi8qKiANCiAqIExvZ2dpbmcgTGV2ZWwgV2Fybg0KICogQHR5cGUgTG9nNGpzLkxldmVsDQogKiBAc3RhdGljDQogKi8NCkxvZzRqcy5MZXZlbC5XQVJOID0gbmV3IExvZzRqcy5MZXZlbChMb2c0anMuTGV2ZWwuV0FSTl9JTlQsICJXQVJOIik7IA0KLyoqIA0KICogTG9nZ2luZyBMZXZlbCBJbmZvDQogKiBAdHlwZSBMb2c0anMuTGV2ZWwNCiAqIEBzdGF0aWMNCiAqLw0KTG9nNGpzLkxldmVsLklORk8gPSBuZXcgTG9nNGpzLkxldmVsKExvZzRqcy5MZXZlbC5JTkZPX0lOVCwgIklORk8iKTsgICAgIA0KLyoqIA0KICogTG9nZ2luZyBMZXZlbCBEZWJ1Zw0KICogQHR5cGUgTG9nNGpzLkxldmVsDQogKiBAc3RhdGljDQogKi8NCkxvZzRqcy5MZXZlbC5ERUJVRyA9IG5ldyBMb2c0anMuTGV2ZWwoTG9nNGpzLkxldmVsLkRFQlVHX0lOVCwgIkRFQlVHIik7ICANCi8qKiANCiAqIExvZ2dpbmcgTGV2ZWwgVHJhY2UNCiAqIEB0eXBlIExvZzRqcy5MZXZlbA0KICogQHN0YXRpYw0KICovDQpMb2c0anMuTGV2ZWwuVFJBQ0UgPSBuZXcgTG9nNGpzLkxldmVsKExvZzRqcy5MZXZlbC5UUkFDRV9JTlQsICJUUkFDRSIpOyAgDQovKiogDQogKiBMb2dnaW5nIExldmVsIEFsbCAtIEFsbCB0cmFjZXMgYXJlIGVuYWJsZWQNCiAqIEB0eXBlIExvZzRqcy5MZXZlbA0KICogQHN0YXRpYw0KICovDQpMb2c0anMuTGV2ZWwuQUxMID0gbmV3IExvZzRqcy5MZXZlbChMb2c0anMuTGV2ZWwuQUxMX0lOVCwgIkFMTCIpOyANCg0KLyoqDQogKiBMb2c0anMgQ3VzdG9tRXZlbnQNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGF1dGhvciBDb3JleSBKb2huc29uIC0gb3JpZ2luYWwgY29kZSBpbiBMdW1iZXJqYWNrIChodHRwOi8vZ2xlZXBnbG9wLmNvbS9qYXZhc2NyaXB0cy9sb2dnZXIvKQ0KICogQGF1dGhvciBTZXRoIENoaXNhbW9yZSAtIGFkYXB0ZWQgZm9yIExvZzRqcw0KICogQHByaXZhdGUNCiAqLw0KTG9nNGpzLkN1c3RvbUV2ZW50ID0gZnVuY3Rpb24oKSB7DQoJdGhpcy5saXN0ZW5lcnMgPSBbXTsNCn07DQoNCkxvZzRqcy5DdXN0b21FdmVudC5wcm90b3R5cGUgPSB7DQogDQogCS8qKg0KIAkgKiBAcGFyYW0gbWV0aG9kIG1ldGhvZCB0byBiZSBhZGRlZA0KIAkgKi8gDQoJYWRkTGlzdGVuZXIgOiBmdW5jdGlvbihtZXRob2QpIHsNCgkJdGhpcy5saXN0ZW5lcnMucHVzaChtZXRob2QpOw0KCX0sDQoNCiAJLyoqDQogCSAqIEBwYXJhbSBtZXRob2QgbWV0aG9kIHRvIGJlIHJlbW92ZWQNCiAJICovIA0KCXJlbW92ZUxpc3RlbmVyIDogZnVuY3Rpb24obWV0aG9kKSB7DQoJCXZhciBmb3VuZEluZGV4ZXMgPSB0aGlzLmZpbmRMaXN0ZW5lckluZGV4ZXMobWV0aG9kKTsNCg0KCQlmb3IodmFyIGkgPSAwOyBpIDwgZm91bmRJbmRleGVzLmxlbmd0aDsgaSsrKSB7DQoJCQl0aGlzLmxpc3RlbmVycy5zcGxpY2UoZm91bmRJbmRleGVzW2ldLCAxKTsNCgkJfQ0KCX0sDQoNCiAJLyoqDQogCSAqIEBwYXJhbSBoYW5kbGVyDQogCSAqLyANCglkaXNwYXRjaCA6IGZ1bmN0aW9uKGhhbmRsZXIpIHsNCgkJZm9yKHZhciBpID0gMDsgaSA8IHRoaXMubGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7DQoJCQl0cnkgew0KCQkJCXRoaXMubGlzdGVuZXJzW2ldKGhhbmRsZXIpOw0KCQkJfQ0KCQkJY2F0Y2ggKGUpIHsNCgkJCQlsb2c0anNMb2dnZXIud2FybigiQ291bGQgbm90IHJ1biB0aGUgbGlzdGVuZXIgIiArIHRoaXMubGlzdGVuZXJzW2ldICsgIi4gXG4iICsgZSk7DQoJCQl9DQoJCX0NCgl9LA0KDQoJLyoqDQoJICogQHByaXZhdGUNCgkgKiBAcGFyYW0gbWV0aG9kDQoJICovDQoJZmluZExpc3RlbmVySW5kZXhlcyA6IGZ1bmN0aW9uKG1ldGhvZCkgew0KCQl2YXIgaW5kZXhlcyA9IFtdOw0KCQlmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5saXN0ZW5lcnMubGVuZ3RoOyBpKyspIHsJCQkNCgkJCWlmICh0aGlzLmxpc3RlbmVyc1tpXSA9PSBtZXRob2QpIHsNCgkJCQlpbmRleGVzLnB1c2goaSk7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gaW5kZXhlczsNCgl9DQp9Ow0KDQovKioNCiAqIE1vZGVscyBhIGxvZ2dpbmcgZXZlbnQuDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7U3RyaW5nfSBjYXRlZ29yeU5hbWUgbmFtZSBvZiBjYXRlZ29yeQ0KICogQHBhcmFtIHtMb2c0anMuTGV2ZWx9IGxldmVsIGxldmVsIG9mIG1lc3NhZ2UNCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlIG1lc3NhZ2UgdG8gbG9nDQogKiBAcGFyYW0ge0xvZzRqcy5Mb2dnZXJ9IGxvZ2dlciB0aGUgYXNzb2NpYXRlZCBsb2dnZXINCiAqIEBhdXRob3IgU2V0aCBDaGlzYW1vcmUNCiAqLw0KTG9nNGpzLkxvZ2dpbmdFdmVudCA9IGZ1bmN0aW9uKGNhdGVnb3J5TmFtZSwgbGV2ZWwsIG1lc3NhZ2UsIGV4Y2VwdGlvbiwgbG9nZ2VyKSB7DQoJLyoqDQoJICogdGhlIHRpbWVzdGFtcCBvZiB0aGUgTG9nZ2luZyBFdmVudA0KCSAqIEB0eXBlIERhdGUNCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXRoaXMuc3RhcnRUaW1lID0gbmV3IERhdGUoKTsNCgkvKioNCgkgKiBjYXRlZ29yeSBvZiBldmVudA0KCSAqIEB0eXBlIFN0cmluZw0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5jYXRlZ29yeU5hbWUgPSBjYXRlZ29yeU5hbWU7DQoJLyoqDQoJICogdGhlIGxvZ2dpbmcgbWVzc2FnZQ0KCSAqIEB0eXBlIFN0cmluZw0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsNCgkvKioNCgkgKiB0aGUgbG9nZ2luZyBleGNlcHRpb24NCgkgKiBAdHlwZSBFeGNlcHRpb24NCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXRoaXMuZXhjZXB0aW9uID0gZXhjZXB0aW9uOw0KCS8qKg0KCSAqIGxldmVsIG9mIGxvZw0KCSAqIEB0eXBlIExvZzRqcy5MZXZlbA0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5sZXZlbCA9IGxldmVsOw0KCS8qKg0KCSAqIHJlZmVyZW5jZSB0byBsb2dnZXINCgkgKiBAdHlwZSBMb2c0anMuTG9nZ2VyDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmxvZ2dlciA9IGxvZ2dlcjsNCn07DQoNCkxvZzRqcy5Mb2dnaW5nRXZlbnQucHJvdG90eXBlID0gewkNCgkvKioNCgkgKiBnZXQgdGhlIHRpbWVzdGFtcCBmb3JtYXR0ZWQgYXMgU3RyaW5nLg0KCSAqIEByZXR1cm4ge1N0cmluZ30gZm9ybWF0dGVkIHRpbWVzdGFtcA0KCSAqIEBzZWUgTG9nNGpzI3NldERhdGVGb3JtYXQoKQ0KCSAqLw0KCWdldEZvcm1hdHRlZFRpbWVzdGFtcDogZnVuY3Rpb24oKSB7DQoJCWlmKHRoaXMubG9nZ2VyKSB7DQoJCQlyZXR1cm4gdGhpcy5sb2dnZXIuZ2V0Rm9ybWF0dGVkVGltZXN0YW1wKHRoaXMuc3RhcnRUaW1lKTsNCgkJfSBlbHNlIHsNCgkJCXJldHVybiB0aGlzLnN0YXJ0VGltZS50b0dNVFN0cmluZygpOw0KCQl9DQoJfQ0KfTsNCg0KLyoqDQogKiBMb2dnZXIgdG8gbG9nIG1lc3NhZ2VzIHRvIHRoZSBkZWZpbmVkIGFwcGVuZGVyLjwvcD4NCiAqIERlZmF1bHQgYXBwZW5kZXIgaXMgQXBwZW5kZXIsIHdoaWNoIGlzIGlnbm9yaW5nIGFsbCBtZXNzYWdlcy4gUGxlYXNlDQogKiB1c2Ugc2V0QXBwZW5kZXIoKSB0byBzZXQgYSBzcGVjaWZpYyBhcHBlbmRlciAoZS5nLiBXaW5kb3dBcHBlbmRlcikuDQogKiB1c2Uge0BzZWUgTG9nNGpzI2dldExvZ2dlcihTdHJpbmcpfSB0byBnZXQgYW4gaW5zdGFuY2UuDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSBuYW1lIG5hbWUgb2YgY2F0ZWdvcnkgdG8gbG9nIHRvDQogKiBAYXV0aG9yIFN0ZXBoYW4gU3RyaXR0bWF0dGVyDQogKi8NCkxvZzRqcy5Mb2dnZXIgPSBmdW5jdGlvbihuYW1lKSB7DQoJdGhpcy5sb2dnaW5nRXZlbnRzID0gW107DQoJdGhpcy5hcHBlbmRlcnMgPSBbXTsNCgkvKiogY2F0ZWdvcnkgb2YgbG9nZ2VyICovDQoJdGhpcy5jYXRlZ29yeSA9IG5hbWUgfHwgIiI7DQoJLyoqIGxldmVsIHRvIGJlIGxvZ2dlZCAqLw0KCXRoaXMubGV2ZWwgPSBMb2c0anMuTGV2ZWwuRkFUQUw7DQoJDQoJdGhpcy5kYXRlZm9ybWF0ID0gTG9nNGpzLkRhdGVGb3JtYXR0ZXIuREVGQVVMVF9EQVRFX0ZPUk1BVDsNCgl0aGlzLmRhdGVmb3JtYXR0ZXIgPSBuZXcgTG9nNGpzLkRhdGVGb3JtYXR0ZXIoKTsNCgkNCgl0aGlzLm9ubG9nID0gbmV3IExvZzRqcy5DdXN0b21FdmVudCgpOw0KCXRoaXMub25jbGVhciA9IG5ldyBMb2c0anMuQ3VzdG9tRXZlbnQoKTsNCgkNCgkvKiogYXBwZW5kZXIgdG8gd3JpdGUgaW4gKi8NCgl0aGlzLmFwcGVuZGVycy5wdXNoKG5ldyBMb2c0anMuQXBwZW5kZXIodGhpcykpOw0KCQ0KCS8vIGlmIG11bHRpcGxlIGxvZyBvYmplY3RzIGFyZSBpbnN0YW50aWF0ZWQgdGhpcyB3aWxsIG9ubHkgbG9nIHRvIHRoZSBsb2cgDQoJLy8gb2JqZWN0IHRoYXQgaXMgZGVjbGFyZWQgbGFzdCBjYW4ndCBzZWVtIHRvIGdldCB0aGUgYXR0YWNoRXZlbnQgbWV0aG9kIHRvIA0KCS8vIHdvcmsgY29ycmVjdGx5DQoJdHJ5IHsNCgkJd2luZG93Lm9uZXJyb3IgPSB0aGlzLndpbmRvd0Vycm9yLmJpbmQodGhpcyk7DQoJfSBjYXRjaCAoZSkgew0KCQkvL2xvZzRqc0xvZ2dlci5mYXRhbChlKTsNCgl9DQp9Ow0KDQpMb2c0anMuTG9nZ2VyLnByb3RvdHlwZSA9IHsNCg0KCS8qKg0KCSAqIGFkZCBhZGRpdGlvbmFsIGFwcGVuZGVyLiBEZWZhdWx0QXBwZW5kZXIgYWx3YXlzIGlzIHRoZXJlLg0KCSAqIEBwYXJhbSBhcHBlbmRlciBhZGRpdGlvbmFsIHdhbnRlZCBhcHBlbmRlcg0KCSAqLw0KCWFkZEFwcGVuZGVyOiBmdW5jdGlvbihhcHBlbmRlcikgew0KCQlpZiAoYXBwZW5kZXIgaW5zdGFuY2VvZiBMb2c0anMuQXBwZW5kZXIpIHsNCgkJCWFwcGVuZGVyLnNldExvZ2dlcih0aGlzKTsNCgkJCXRoaXMuYXBwZW5kZXJzLnB1c2goYXBwZW5kZXIpOwkJCQ0KCQl9IGVsc2Ugew0KCQkJdGhyb3cgIk5vdCBpbnN0YW5jZSBvZiBhbiBBcHBlbmRlcjogIiArIGFwcGVuZGVyOw0KCQl9DQoJfSwNCg0KCS8qKg0KCSAqIHNldCBBcnJheSBvZiBhcHBlbmRlcnMuIFByZXZpb3VzIEFwcGVuZGVycyBhcmUgY2xlYXJlZCBhbmQgcmVtb3ZlZC4NCgkgKiBAcGFyYW0ge0FycmF5fSBhcHBlbmRlcnMgQXJyYXkgb2YgQXBwZW5kZXJzDQoJICovDQoJc2V0QXBwZW5kZXJzOiBmdW5jdGlvbihhcHBlbmRlcnMpIHsNCgkJLy9jbGVhciBmaXJzdCBhbGwgZXhpc3RpbmcgYXBwZW5kZXJzDQoJCWZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmFwcGVuZGVycy5sZW5ndGg7IGkrKykgew0KCQkJdGhpcy5hcHBlbmRlcnNbaV0uZG9DbGVhcigpOw0KCQl9DQoJCQ0KCQl0aGlzLmFwcGVuZGVycyA9IGFwcGVuZGVyczsNCgkJDQoJCWZvcih2YXIgaiA9IDA7IGogPCB0aGlzLmFwcGVuZGVycy5sZW5ndGg7IGorKykgew0KCQkJdGhpcy5hcHBlbmRlcnNbal0uc2V0TG9nZ2VyKHRoaXMpOw0KCQl9DQoJfSwNCgkNCgkvKioNCgkgKiBTZXQgdGhlIExvZ2xldmVsIGRlZmF1bHQgaXMgTG9nTEV2ZWwuVFJBQ0UNCgkgKiBAcGFyYW0gbGV2ZWwgd2FudGVkIGxvZ2dpbmcgbGV2ZWwNCgkgKi8NCglzZXRMZXZlbDogZnVuY3Rpb24obGV2ZWwpIHsNCgkJdGhpcy5sZXZlbCA9IGxldmVsOw0KCX0sDQoJDQoJLyoqIA0KCSAqIG1haW4gbG9nIG1ldGhvZCBsb2dnaW5nIHRvIGFsbCBhdmFpbGFibGUgYXBwZW5kZXJzIA0KCSAqIEBwcml2YXRlDQoJICovDQoJbG9nOiBmdW5jdGlvbihsb2dMZXZlbCwgbWVzc2FnZSwgZXhjZXB0aW9uKSB7DQoJCXZhciBsb2dnaW5nRXZlbnQgPSBuZXcgTG9nNGpzLkxvZ2dpbmdFdmVudCh0aGlzLmNhdGVnb3J5LCBsb2dMZXZlbCwgDQoJCQltZXNzYWdlLCBleGNlcHRpb24sIHRoaXMpOw0KCQl0aGlzLmxvZ2dpbmdFdmVudHMucHVzaChsb2dnaW5nRXZlbnQpOw0KCQl0aGlzLm9ubG9nLmRpc3BhdGNoKGxvZ2dpbmdFdmVudCk7DQoJfSwNCgkNCgkvKiogY2xlYXIgbG9nZ2luZyAqLw0KCWNsZWFyIDogZnVuY3Rpb24gKCkgew0KCQl0cnl7DQoJCQl0aGlzLmxvZ2dpbmdFdmVudHMgPSBbXTsNCgkJCXRoaXMub25jbGVhci5kaXNwYXRjaCgpOw0KCQl9IGNhdGNoKGUpe30NCgl9LA0KCS8qKiBjaGVja3MgaWYgTGV2ZWwgVHJhY2UgaXMgZW5hYmxlZCAqLw0KCWlzVHJhY2VFbmFibGVkOiBmdW5jdGlvbigpIHsNCgkJaWYgKHRoaXMubGV2ZWwudmFsdWVPZigpIDw9IExvZzRqcy5MZXZlbC5UUkFDRS52YWx1ZU9mKCkpIHsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9LA0KCS8qKiANCgkgKiBUcmFjZSBtZXNzYWdlcyANCgkgKiBAcGFyYW0gbWVzc2FnZSB7T2JqZWN0fSBtZXNzYWdlIHRvIGJlIGxvZ2dlZA0KCSAqLw0KCXRyYWNlOiBmdW5jdGlvbihtZXNzYWdlKSB7DQoJCWlmICh0aGlzLmlzVHJhY2VFbmFibGVkKCkpIHsNCgkJCXRoaXMubG9nKExvZzRqcy5MZXZlbC5UUkFDRSwgbWVzc2FnZSwgbnVsbCk7DQoJCX0NCgl9LA0KCS8qKiBjaGVja3MgaWYgTGV2ZWwgRGVidWcgaXMgZW5hYmxlZCAqLw0KCWlzRGVidWdFbmFibGVkOiBmdW5jdGlvbigpIHsNCgkJaWYgKHRoaXMubGV2ZWwudmFsdWVPZigpIDw9IExvZzRqcy5MZXZlbC5ERUJVRy52YWx1ZU9mKCkpIHsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9LA0KCS8qKiANCgkgKiBEZWJ1ZyBtZXNzYWdlcyANCgkgKiBAcGFyYW0gbWVzc2FnZSB7T2JqZWN0fSBtZXNzYWdlIHRvIGJlIGxvZ2dlZA0KCSAqLw0KCWRlYnVnOiBmdW5jdGlvbihtZXNzYWdlKSB7DQoJCWlmICh0aGlzLmlzRGVidWdFbmFibGVkKCkpIHsNCgkJCXRoaXMubG9nKExvZzRqcy5MZXZlbC5ERUJVRywgbWVzc2FnZSwgbnVsbCk7DQoJCX0NCgl9LA0KCS8qKg0KCSAqIERlYnVnIG1lc3NhZ2VzIA0KCSAqIEBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlICBtZXNzYWdlIHRvIGJlIGxvZ2dlZA0KCSAqIEBwYXJhbSB7VGhyb3dhYmxlfSB0aHJvd2FibGUgDQoJICovDQoJZGVidWc6IGZ1bmN0aW9uKG1lc3NhZ2UsIHRocm93YWJsZSkgew0KCQlpZiAodGhpcy5pc0RlYnVnRW5hYmxlZCgpKSB7DQoJCQl0aGlzLmxvZyhMb2c0anMuTGV2ZWwuREVCVUcsIG1lc3NhZ2UsIHRocm93YWJsZSk7DQoJCX0NCgl9LAkNCgkvKiogY2hlY2tzIGlmIExldmVsIEluZm8gaXMgZW5hYmxlZCAqLw0KCWlzSW5mb0VuYWJsZWQ6IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5sZXZlbC52YWx1ZU9mKCkgPD0gTG9nNGpzLkxldmVsLklORk8udmFsdWVPZigpKSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KCQlyZXR1cm4gZmFsc2U7DQoJfSwNCgkvKiogDQoJICogbG9nZ2luZyBpbmZvIG1lc3NhZ2VzIA0KCSAqIEBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlICBtZXNzYWdlIHRvIGJlIGxvZ2dlZA0KCSAqLw0KCWluZm86IGZ1bmN0aW9uKG1lc3NhZ2UpIHsNCgkJaWYgKHRoaXMuaXNJbmZvRW5hYmxlZCgpKSB7DQoJCQl0aGlzLmxvZyhMb2c0anMuTGV2ZWwuSU5GTywgbWVzc2FnZSwgbnVsbCk7DQoJCX0NCgl9LA0KCS8qKiANCgkgKiBsb2dnaW5nIGluZm8gbWVzc2FnZXMgDQoJICogQHBhcmFtIHtPYmplY3R9IG1lc3NhZ2UgIG1lc3NhZ2UgdG8gYmUgbG9nZ2VkDQoJICogQHBhcmFtIHtUaHJvd2FibGV9IHRocm93YWJsZSAgDQoJICovDQoJaW5mbzogZnVuY3Rpb24obWVzc2FnZSwgdGhyb3dhYmxlKSB7DQoJCWlmICh0aGlzLmlzSW5mb0VuYWJsZWQoKSkgew0KCQkJdGhpcy5sb2coTG9nNGpzLkxldmVsLklORk8sIG1lc3NhZ2UsIHRocm93YWJsZSk7DQoJCX0NCgl9LA0KCS8qKiBjaGVja3MgaWYgTGV2ZWwgV2FybiBpcyBlbmFibGVkICovDQoJaXNXYXJuRW5hYmxlZDogZnVuY3Rpb24oKSB7DQoJCWlmICh0aGlzLmxldmVsLnZhbHVlT2YoKSA8PSBMb2c0anMuTGV2ZWwuV0FSTi52YWx1ZU9mKCkpIHsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9LA0KDQoJLyoqIGxvZ2dpbmcgd2FybiBtZXNzYWdlcyAqLw0KCXdhcm46IGZ1bmN0aW9uKG1lc3NhZ2UpIHsNCgkJaWYgKHRoaXMuaXNXYXJuRW5hYmxlZCgpKSB7DQoJCQl0aGlzLmxvZyhMb2c0anMuTGV2ZWwuV0FSTiwgbWVzc2FnZSwgbnVsbCk7DQoJCX0NCgl9LA0KCS8qKiBsb2dnaW5nIHdhcm4gbWVzc2FnZXMgKi8NCgl3YXJuOiBmdW5jdGlvbihtZXNzYWdlLCB0aHJvd2FibGUpIHsNCgkJaWYgKHRoaXMuaXNXYXJuRW5hYmxlZCgpKSB7DQoJCQl0aGlzLmxvZyhMb2c0anMuTGV2ZWwuV0FSTiwgbWVzc2FnZSwgdGhyb3dhYmxlKTsNCgkJfQ0KCX0sDQoJLyoqIGNoZWNrcyBpZiBMZXZlbCBFcnJvciBpcyBlbmFibGVkICovDQoJaXNFcnJvckVuYWJsZWQ6IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5sZXZlbC52YWx1ZU9mKCkgPD0gTG9nNGpzLkxldmVsLkVSUk9SLnZhbHVlT2YoKSkgew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgkJcmV0dXJuIGZhbHNlOw0KCX0sDQoJLyoqIGxvZ2dpbmcgZXJyb3IgbWVzc2FnZXMgKi8NCgllcnJvcjogZnVuY3Rpb24obWVzc2FnZSkgew0KCQlpZiAodGhpcy5pc0Vycm9yRW5hYmxlZCgpKSB7DQoJCQl0aGlzLmxvZyhMb2c0anMuTGV2ZWwuRVJST1IsIG1lc3NhZ2UsIG51bGwpOw0KCQl9DQoJfSwNCgkvKiogbG9nZ2luZyBlcnJvciBtZXNzYWdlcyAqLw0KCWVycm9yOiBmdW5jdGlvbihtZXNzYWdlLCB0aHJvd2FibGUpIHsNCgkJaWYgKHRoaXMuaXNFcnJvckVuYWJsZWQoKSkgew0KCQkJdGhpcy5sb2coTG9nNGpzLkxldmVsLkVSUk9SLCBtZXNzYWdlLCB0aHJvd2FibGUpOw0KCQl9DQoJfSwNCgkvKiogY2hlY2tzIGlmIExldmVsIEZhdGFsIGlzIGVuYWJsZWQgKi8NCglpc0ZhdGFsRW5hYmxlZDogZnVuY3Rpb24oKSB7DQoJCWlmICh0aGlzLmxldmVsLnZhbHVlT2YoKSA8PSBMb2c0anMuTGV2ZWwuRkFUQUwudmFsdWVPZigpKSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KCQlyZXR1cm4gZmFsc2U7DQoJfSwNCgkvKiogbG9nZ2luZyBmYXRhbCBtZXNzYWdlcyAqLw0KCWZhdGFsOiBmdW5jdGlvbihtZXNzYWdlKSB7DQoJCWlmICh0aGlzLmlzRmF0YWxFbmFibGVkKCkpIHsNCgkJCXRoaXMubG9nKExvZzRqcy5MZXZlbC5GQVRBTCwgbWVzc2FnZSwgbnVsbCk7DQoJCX0NCgl9LA0KCS8qKiBsb2dnaW5nIGZhdGFsIG1lc3NhZ2VzICovDQoJZmF0YWw6IGZ1bmN0aW9uKG1lc3NhZ2UsIHRocm93YWJsZSkgew0KCQlpZiAodGhpcy5pc0ZhdGFsRW5hYmxlZCgpKSB7DQoJCQl0aGlzLmxvZyhMb2c0anMuTGV2ZWwuRkFUQUwsIG1lc3NhZ2UsIHRocm93YWJsZSk7DQoJCX0NCgl9LAkNCgkvKiogDQoJICogQ2FwdHVyZSBtYWluIHdpbmRvdyBlcnJvcnMgYW5kIGxvZyBhcyBmYXRhbC4NCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXdpbmRvd0Vycm9yOiBmdW5jdGlvbihtc2csIHVybCwgbGluZSl7DQoJCXZhciBtZXNzYWdlID0gIkVycm9yIGluICgiICsgKHVybCB8fCB3aW5kb3cubG9jYXRpb24pICsgIikgb24gbGluZSAiKyBsaW5lICsiIHdpdGggbWVzc2FnZSAoIiArIG1zZyArICIpIjsNCgkJdGhpcy5sb2coTG9nNGpzLkxldmVsLkZBVEFMLCBtZXNzYWdlLCBudWxsKTsJDQoJfSwNCgkNCgkvKioNCgkgKiBTZXQgdGhlIGRhdGUgZm9ybWF0IG9mIGxvZ2dlci4gRm9sbG93aW5nIHN3aXRjaGVzIGFyZSBzdXBwb3J0ZWQ6DQoJICogPHVsPg0KCSAqIDxsaT55eXl5IC0gVGhlIHllYXI8L2xpPg0KCSAqIDxsaT5NTSAtIHRoZSBtb250aDwvbGk+DQoJICogPGxpPmRkIC0gdGhlIGRheSBvZiBtb250aDxsaT4NCgkgKiA8bGk+aGggLSB0aGUgaG91cjxsaT4NCgkgKiA8bGk+bW0gLSBtaW51dGVzPC9saT4NCgkgKiA8bGk+TyAtIHRpbWV6b25lIG9mZnNldDwvbGk+DQoJICogPC91bD4NCgkgKiBAcGFyYW0ge1N0cmluZ30gZm9ybWF0IGZvcm1hdCBTdHJpbmcgZm9yIHRoZSBkYXRlDQoJICogQHNlZSAjZ2V0VGltZXN0YW1wDQoJICovDQoJc2V0RGF0ZUZvcm1hdDogZnVuY3Rpb24oZm9ybWF0KSB7DQoJIAl0aGlzLmRhdGVmb3JtYXQgPSBmb3JtYXQ7DQoJfSwNCgkgDQoJLyoqDQoJICogR2VuZXJhdGVzIGEgdGltZXN0YW1wIHVzaW5nIHRoZSBmb3JtYXQgc2V0IGluIHtMb2c0anMuc2V0RGF0ZUZvcm1hdH0uDQoJICogQHBhcmFtIHtEYXRlfSBkYXRlIHRoZSBkYXRlIHRvIGZvcm1hdA0KCSAqIEBzZWUgI3NldERhdGVGb3JtYXQNCgkgKiBAcmV0dXJuIEEgZm9ybWF0dGVkIHRpbWVzdGFtcCB3aXRoIHRoZSBjdXJyZW50IGRhdGUgYW5kIHRpbWUuDQoJICovDQoJZ2V0Rm9ybWF0dGVkVGltZXN0YW1wOiBmdW5jdGlvbihkYXRlKSB7DQoJICByZXR1cm4gdGhpcy5kYXRlZm9ybWF0dGVyLmZvcm1hdERhdGUoZGF0ZSwgdGhpcy5kYXRlZm9ybWF0KTsNCgl9DQp9Ow0KDQovKioNCiAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIG90aGVyIGFwcGVuZGVycy4gDQogKiBJdCBpcyBkb2luZyBub3RoaW5nLg0KICoNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIHtMb2c0anMuTG9nZ2VyfSBsb2dnZXIgbG9nNGpzIGluc3RhbmNlIHRoaXMgYXBwZW5kZXIgaXMgYXR0YWNoZWQgdG8NCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqLw0KTG9nNGpzLkFwcGVuZGVyID0gZnVuY3Rpb24gKCkgew0KCS8qKg0KCSAqIFJlZmVyZW5jZSB0byBjYWxsaW5nIGxvZ2dlcg0KCSAqIEB0eXBlIExvZzRqcy5Mb2dnZXINCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCSB0aGlzLmxvZ2dlciA9IG51bGw7DQp9Ow0KDQpMb2c0anMuQXBwZW5kZXIucHJvdG90eXBlID0gew0KCS8qKiANCgkgKiBhcHBlbmRzIHRoZSBnaXZlbiBsb2dnaW5nRXZlbnQgYXBwZW5kZXIgc3BlY2lmaWMNCgkgKiBAcGFyYW0ge0xvZzRqcy5Mb2dnaW5nRXZlbnR9IGxvZ2dpbmdFdmVudCBsb2dnaW5nRXZlbnQgdG8gYXBwZW5kDQoJICovDQoJZG9BcHBlbmQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQlyZXR1cm47DQoJfSwNCgkvKiogDQoJICogY2xlYXJzIHRoZSBBcHBlbmRlcg0KCSAqLw0KCWRvQ2xlYXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm47DQoJfSwNCgkNCgkvKioNCgkgKiBTZXQgdGhlIExheW91dCBmb3IgdGhpcyBhcHBlbmRlci4NCgkgKiBAcGFyYW0ge0xvZzRqcy5MYXlvdXR9IGxheW91dCBMYXlvdXQgZm9yIGZvcm1hdHRpbmcgbG9nZ2luZ0V2ZW50DQoJICovDQoJc2V0TGF5b3V0OiBmdW5jdGlvbihsYXlvdXQpew0KCQl0aGlzLmxheW91dCA9IGxheW91dDsNCgl9LA0KCS8qKg0KCSAqIFNldCByZWZlcmVuY2UgdG8gdGhlIGxvZ2dlci4NCgkgKiBAcGFyYW0ge0xvZzRqcy5Mb2dnZXJ9IHRoZSBpbnZva2luZyBsb2dnZXINCgkgKi8NCglzZXRMb2dnZXI6IGZ1bmN0aW9uKGxvZ2dlcil7DQoJCS8vIGFkZCBsaXN0ZW5lciB0byB0aGUgbG9nZ2VyIG1ldGhvZHMNCgkJbG9nZ2VyLm9ubG9nLmFkZExpc3RlbmVyKExvZzRqcy5iaW5kKHRoaXMuZG9BcHBlbmQsIHRoaXMpKTsNCgkJbG9nZ2VyLm9uY2xlYXIuYWRkTGlzdGVuZXIoTG9nNGpzLmJpbmQodGhpcy5kb0NsZWFyLCB0aGlzKSk7DQoJDQoJCXRoaXMubG9nZ2VyID0gbG9nZ2VyOw0KCX0NCn07DQoNCi8qKg0KICogSW50ZXJmYWNlIGZvciBMYXlvdXRzLg0KICogVXNlIHRoaXMgTGF5b3V0IGFzICJpbnRlcmZhY2UiIGZvciBvdGhlciBMYXlvdXRzLiBJdCBpcyBkb2luZyBub3RoaW5nLg0KICoNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuTGF5b3V0ID0gZnVuY3Rpb24oKXt9Ow0KTG9nNGpzLkxheW91dC5wcm90b3R5cGUgPSB7DQoJLyoqIA0KCSAqIEltcGxlbWVudCB0aGlzIG1ldGhvZCB0byBjcmVhdGUgeW91ciBvd24gbGF5b3V0IGZvcm1hdC4NCgkgKiBAcGFyYW0ge0xvZzRqcy5Mb2dnaW5nRXZlbnR9IGxvZ2dpbmdFdmVudCBsb2dnaW5nRXZlbnQgdG8gZm9ybWF0DQoJICogQHJldHVybiBmb3JtYXR0ZWQgU3RyaW5nDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZm9ybWF0OiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJcmV0dXJuICIiOw0KCX0sDQoJLyoqIA0KCSAqIFJldHVybnMgdGhlIGNvbnRlbnQgdHlwZSBvdXRwdXQgYnkgdGhpcyBsYXlvdXQuIA0KCSAqIEByZXR1cm4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyAidGV4dC9wbGFpbiIuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0Q29udGVudFR5cGU6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gInRleHQvcGxhaW4iOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgaGVhZGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEhlYWRlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiBudWxsOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgZm9vdGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEZvb3RlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiBudWxsOw0KCX0sDQoJDQoJLyoqDQoJICogQHJldHVybiBTZXBhcmF0b3IgYmV0d2VlbiBldmVudHMNCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRTZXBhcmF0b3I6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIiI7DQoJfQ0KfTsNCg0KLyoqDQogKiBDb25zb2xlIEFwcGVuZGVyIHdyaXRlcyB0aGUgbG9ncyB0byBhIGNvbnNvbGUuICBJZiAiaW5saW5lIiBpcw0KICogc2V0IHRvICJmYWxzZSIgdGhlIGNvbnNvbGUgbGF1bmNoZXMgaW4gYW5vdGhlciB3aW5kb3cgb3RoZXJ3aXNlDQogKiB0aGUgd2luZG93IGlzIGlubGluZSBvbiB0aGUgcGFnZSBhbmQgdG9nZ2xlZCBvbiBhbmQgb2ZmIHdpdGggIkFsdC1EIi4NCiAqIE5vdGU6IEF0IEZpcmVGb3ggJmdiOyAyLjAgdGhlIGtleXN0cm9rZSBpcyBsaXR0bGUgZGlmZmVyZW50IG5vdzogIlNISUZUK0FMVCtEIi4NCiAqDQogKiBAY29uc3RydWN0b3INCiAqIEBleHRlbmRzIExvZzRqcy5BcHBlbmRlcg0KICogQHBhcmFtIHtib29sZWFufSBpc0lubGluZSBib29sZWFuIHZhbHVlIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgdGhlIGNvbnNvbGUgYmUgcGxhY2VkIGlubGluZSwgZGVmYXVsdCBpcyB0byBsYXVuY2ggaW4gbmV3IHdpbmRvdw0KICoNCiAqIEBhdXRob3IgQ29yZXkgSm9obnNvbiAtIG9yaWdpbmFsIGNvbnNvbGUgY29kZSBpbiBMdW1iZXJqYWNrIChodHRwOi8vZ2xlZXBnbG9wLmNvbS9qYXZhc2NyaXB0cy9sb2dnZXIvKQ0KICogQGF1dGhvciBTZXRoIENoaXNhbW9yZSAtIGFkYXB0ZWQgZm9yIHVzZSBhcyBhIGxvZzRqcyBhcHBlbmRlcg0KICovDQpMb2c0anMuQ29uc29sZUFwcGVuZGVyID0gZnVuY3Rpb24oaXNJbmxpbmUpIHsNCgkNCgkvKioNCgkgKiBAdHlwZSBMb2c0anMuTGF5b3V0DQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmxheW91dCA9IG5ldyBMb2c0anMuUGF0dGVybkxheW91dChMb2c0anMuUGF0dGVybkxheW91dC5UVENDX0NPTlZFUlNJT05fUEFUVEVSTik7DQoJLyoqDQoJICogQHR5cGUgYm9vbGVhbg0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5pbmxpbmUgPSBpc0lubGluZTsNCg0KCS8qKg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5hY2Nlc3NrZXkgPSAiZCI7DQoJDQoJLyoqDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLnRhZ1BhdHRlcm4gPSBudWxsOw0KCQ0KCXRoaXMuY29tbWFuZEhpc3RvcnkgPSBbXTsNCiAgCXRoaXMuY29tbWFuZEluZGV4ID0gMDsNCiAgCQ0KICAJLyoqDQogIAkgKiB0cnVlIGlmIHBvcHVwIGlzIGJsb2NrZWQuDQogIAkgKi8NCiAgCXRoaXMucG9wdXBCbG9ja2VyID0gZmFsc2U7DQogIAkNCiAgCS8qKg0KICAJICogY3VycmVudCBvdXRwdXQgZGl2LWVsZW1lbnQuDQogIAkgKi8NCiAgCXRoaXMub3V0cHV0RWxlbWVudCA9IG51bGw7DQogIAkNCiAgCXRoaXMuZG9jUmVmZXJlbmNlID0gbnVsbDsNCgl0aGlzLndpblJlZmVyZW5jZSA9IG51bGw7CQkNCgkJDQoJaWYodGhpcy5pbmxpbmUpIHsNCgkJTG9nNGpzLmF0dGFjaEV2ZW50KHdpbmRvdywgJ2xvYWQnLCBMb2c0anMuYmluZCh0aGlzLmluaXRpYWxpemUsIHRoaXMpKTsNCgl9DQp9Ow0KDQpMb2c0anMuQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5BcHBlbmRlcigpLCB7ICANCg0KCS8qKg0KCSAqIFNldCB0aGUgYWNjZXNzIGtleSB0byBzaG93L2hpZGUgdGhlIGlubGluZSBjb25zb2xlIChkZWZhdWx0ICZxdW90ZTtkJnF1b3RlOykNCgkgKiBAcGFyYW0ga2V5IGFjY2VzcyBrZXkgdG8gc2hvdy9oaWRlIHRoZSBpbmxpbmUgY29uc29sZQ0KCSAqLwkNCglzZXRBY2Nlc3NLZXkgOiBmdW5jdGlvbihrZXkpIHsNCgkJdGhpcy5hY2Nlc3NrZXkgPSBrZXk7DQoJfSwNCg0KCS8qKg0KCSAqIEBwcml2YXRlDQoJICovDQogIAlpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7DQoJCQ0KCQlpZighdGhpcy5pbmxpbmUpIHsNCg0KCQkJdmFyIHdpbk5hbWUgPSB0aGlzLm1ha2VXaW5OYW1lKHRoaXMubG9nZ2VyLmNhdGVnb3J5KTsNCg0KCQkJd2luZG93LnRvcC5jb25zb2xlV2luZG93ID0gd2luZG93Lm9wZW4oIiIsIHdpbk5hbWUsIA0KCQkJCSJsZWZ0PTAsdG9wPTAsd2lkdGg9NzAwLGhlaWdodD03MDAsc2Nyb2xsYmFycz1ubyxzdGF0dXM9bm8scmVzaXphYmxlPXllczt0b29sYmFyPW5vIik7ICAgICAgICAgICAgDQoJCQl3aW5kb3cudG9wLmNvbnNvbGVXaW5kb3cub3BlbmVyID0gc2VsZjsNCgkJCXZhciB3aW4gPSB3aW5kb3cudG9wLmNvbnNvbGVXaW5kb3c7DQoJCQkJCQkJCQ0KCQkJaWYgKCF3aW4pIHsgDQoJCQkJdGhpcy5wb3B1cEJsb2NrZXI9dHJ1ZTsgDQoJCQkJYWxlcnQoIlBvcHVwIHdpbmRvdyBtYW5hZ2VyIGJsb2NraW5nIHRoZSBMb2c0anMgcG9wdXAgd2luZG93IHRvIGJlZGlzcGxheWVkLlxuXG4iIA0KCQkJCQkrICJQbGVhc2UgZGlzYWJsZWQgdGhpcyB0byBwcm9wZXJseSBzZWUgbG9nZ2VkIGV2ZW50cy4iKTsgIA0KCQkJfSBlbHNlIHsJDQoJCQkJdmFyIGRvYyA9IHdpbi5kb2N1bWVudDsNCgkJCQlkb2Mub3BlbigpOw0KCQkJCWRvYy53cml0ZSgiPCFET0NUWVBFIGh0bWwgUFVCTElDIC0vL1czQy8vRFREIFhIVE1MIDEuMCBUcmFuc2l0aW9uYWwvL0VOICIpOw0KCQkJCWRvYy53cml0ZSgiICBodHRwOi8vd3d3LnczLm9yZy9UUi94aHRtbDEvRFREL3hodG1sMS10cmFuc2l0aW9uYWwuZHRkPlxuXG4iKTsNCgkJCQlkb2Mud3JpdGUoIjxodG1sPjxoZWFkPjx0aXRsZT5Mb2c0anMgLSAiICsgdGhpcy5sb2dnZXIuY2F0ZWdvcnkgKyAiPC90aXRsZT5cbiIpOw0KCQkJCWRvYy53cml0ZSgiPC9oZWFkPjxib2R5IHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjpkYXJrZ3JheVwiPjwvYm9keT5cbiIpOw0KCQkJCXdpbi5ibHVyKCk7DQoJCQkJd2luLmZvY3VzKCk7DQoJCQl9DQoJCQkNCgkJCXRoaXMuZG9jUmVmZXJlbmNlID0gZG9jOw0KCQkJdGhpcy53aW5SZWZlcmVuY2UgPSB3aW47DQoJCX0gZWxzZSB7DQoJCQl0aGlzLmRvY1JlZmVyZW5jZSA9IGRvY3VtZW50Ow0KCQkJdGhpcy53aW5SZWZlcmVuY2UgPSB3aW5kb3c7CQkJDQoJCX0NCgkJCQkNCgkJdGhpcy5vdXRwdXRDb3VudCA9IDA7DQoJCXRoaXMudGFnUGF0dGVybiA9ICIuKiI7DQoJICANCgkJLy8gSSBoYXRlIHdyaXRpbmcgamF2YXNjcmlwdCBpbiBIVE1MLi4uIGJ1dCB3aGF0J3MgYSBiZXR0ZXIgYWx0ZXJuYXRpdmUNCgkJdGhpcy5sb2dFbGVtZW50ID0gdGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQoJCXRoaXMuZG9jUmVmZXJlbmNlLmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5sb2dFbGVtZW50KTsNCgkJdGhpcy5sb2dFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQoJCQ0KCQl0aGlzLmxvZ0VsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOw0KCQl0aGlzLmxvZ0VsZW1lbnQuc3R5bGUubGVmdCA9ICcwcHgnOw0KCQl0aGlzLmxvZ0VsZW1lbnQuc3R5bGUud2lkdGggPSAnMTAwJSc7DQoJDQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS50ZXh0QWxpZ24gPSAibGVmdCI7DQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS5mb250RmFtaWx5ID0gImx1Y2lkYSBjb25zb2xlIjsNCgkJdGhpcy5sb2dFbGVtZW50LnN0eWxlLmZvbnRTaXplID0gIjEwMCUiOw0KCQl0aGlzLmxvZ0VsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2RhcmtncmF5JzsgICAgICANCgkJdGhpcy5sb2dFbGVtZW50LnN0eWxlLm9wYWNpdHkgPSAwLjk7DQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS56SW5kZXggPSAyMDAwOyANCgkNCgkJLy8gQWRkIHRvb2xiYXJFbGVtZW50DQoJCXRoaXMudG9vbGJhckVsZW1lbnQgPSB0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCgkJdGhpcy5sb2dFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudG9vbGJhckVsZW1lbnQpOyAgICAgDQoJCXRoaXMudG9vbGJhckVsZW1lbnQuc3R5bGUucGFkZGluZyA9ICIwIDAgMCAycHgiOw0KCQ0KCQkvLyBBZGQgYnV0dG9ucyAgICAgICAgDQoJCXRoaXMuYnV0dG9uc0NvbnRhaW5lckVsZW1lbnQgPSB0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVFbGVtZW50KCdzcGFuJyk7DQoJCXRoaXMudG9vbGJhckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5idXR0b25zQ29udGFpbmVyRWxlbWVudCk7IA0KCQ0KCQlpZih0aGlzLmlubGluZSkgew0KCQkJdmFyIGNsb3NlQnV0dG9uID0gdGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7DQoJCQljbG9zZUJ1dHRvbi5zdHlsZS5jc3NGbG9hdCA9ICJyaWdodCI7DQoJCQljbG9zZUJ1dHRvbi5zdHlsZS5zdHlsZUZsb2F0ID0gInJpZ2h0IjsgLy8gSUUgZG9tIGJ1Zy4uLmRvZXNuJ3QgdW5kZXJzdGFuZCBjc3NGbG9hdA0KCQkJY2xvc2VCdXR0b24uc3R5bGUuY29sb3IgPSAiYmxhY2siOw0KCQkJY2xvc2VCdXR0b24uaW5uZXJIVE1MID0gImNsb3NlIjsNCgkJCWNsb3NlQnV0dG9uLm9uY2xpY2sgPSBMb2c0anMuYmluZCh0aGlzLnRvZ2dsZSwgdGhpcyk7DQoJCQl0aGlzLmJ1dHRvbnNDb250YWluZXJFbGVtZW50LmFwcGVuZENoaWxkKGNsb3NlQnV0dG9uKTsNCgkJfQ0KCQkNCgkJdmFyIGNsZWFyQnV0dG9uID0gdGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7DQoJCWNsZWFyQnV0dG9uLnN0eWxlLmNzc0Zsb2F0ID0gInJpZ2h0IjsNCgkJY2xlYXJCdXR0b24uc3R5bGUuc3R5bGVGbG9hdCA9ICJyaWdodCI7IC8vIElFIGRvbSBidWcuLi5kb2Vzbid0IHVuZGVyc3RhbmQgY3NzRmxvYXQNCgkJY2xlYXJCdXR0b24uc3R5bGUuY29sb3IgPSAiYmxhY2siOw0KCQljbGVhckJ1dHRvbi5pbm5lckhUTUwgPSAiY2xlYXIiOw0KCQljbGVhckJ1dHRvbi5vbmNsaWNrID0gTG9nNGpzLmJpbmQodGhpcy5sb2dnZXIuY2xlYXIsIHRoaXMubG9nZ2VyKTsNCgkJdGhpcy5idXR0b25zQ29udGFpbmVyRWxlbWVudC5hcHBlbmRDaGlsZChjbGVhckJ1dHRvbik7DQoJDQoNCgkJLy9BZGQgQ2F0ZWdvcnlOYW1lIGFuZCAgTGV2ZWwgRmlsdGVyDQoJCXRoaXMudGFnRmlsdGVyQ29udGFpbmVyRWxlbWVudCA9IHRoaXMuZG9jUmVmZXJlbmNlLmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsNCgkJdGhpcy50b29sYmFyRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnRhZ0ZpbHRlckNvbnRhaW5lckVsZW1lbnQpOw0KCQl0aGlzLnRhZ0ZpbHRlckNvbnRhaW5lckVsZW1lbnQuc3R5bGUuY3NzRmxvYXQgPSAnbGVmdCc7DQoJCQ0KCQl0aGlzLnRhZ0ZpbHRlckNvbnRhaW5lckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlVGV4dE5vZGUoIkxvZzRqcyAtICIgKyB0aGlzLmxvZ2dlci5jYXRlZ29yeSkpOw0KCQl0aGlzLnRhZ0ZpbHRlckNvbnRhaW5lckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlVGV4dE5vZGUoIiB8IExldmVsIEZpbHRlcjogIikpOw0KCQkNCgkJdGhpcy50YWdGaWx0ZXJFbGVtZW50ID0gdGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsNCgkJdGhpcy50YWdGaWx0ZXJDb250YWluZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudGFnRmlsdGVyRWxlbWVudCk7DQoJCXRoaXMudGFnRmlsdGVyRWxlbWVudC5zdHlsZS53aWR0aCA9ICcyMDBweCc7ICAgICAgICAgICAgICAgICAgICANCgkJdGhpcy50YWdGaWx0ZXJFbGVtZW50LnZhbHVlID0gdGhpcy50YWdQYXR0ZXJuOyAgICANCgkJdGhpcy50YWdGaWx0ZXJFbGVtZW50LnNldEF0dHJpYnV0ZSgnYXV0b2NvbXBsZXRlJywgJ29mZicpOyAvLyBTbyBGaXJlZm94IGRvZXNuJ3QgZmxpcCBvdXQNCgkJDQoJCUxvZzRqcy5hdHRhY2hFdmVudCh0aGlzLnRhZ0ZpbHRlckVsZW1lbnQsICdrZXl1cCcsIExvZzRqcy5iaW5kKHRoaXMudXBkYXRlVGFncywgdGhpcykpOw0KCQlMb2c0anMuYXR0YWNoRXZlbnQodGhpcy50YWdGaWx0ZXJFbGVtZW50LCAnY2xpY2snLCBMb2c0anMuYmluZCggZnVuY3Rpb24oKSB7dGhpcy50YWdGaWx0ZXJFbGVtZW50LnNlbGVjdCgpO30sIHRoaXMpKTsNCgkJDQoJCS8vIEFkZCBvdXRwdXRFbGVtZW50DQoJCXRoaXMub3V0cHV0RWxlbWVudCA9IHRoaXMuZG9jUmVmZXJlbmNlLmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KCQl0aGlzLmxvZ0VsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5vdXRwdXRFbGVtZW50KTsgIA0KCQl0aGlzLm91dHB1dEVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byI7ICAgICAgICAgICAgICANCgkJdGhpcy5vdXRwdXRFbGVtZW50LnN0eWxlLmNsZWFyID0gImJvdGgiOw0KCQl0aGlzLm91dHB1dEVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gKHRoaXMuaW5saW5lKSA/ICgiMjAwcHgiKTooIjY1MHB4Iik7DQoJCXRoaXMub3V0cHV0RWxlbWVudC5zdHlsZS53aWR0aCA9ICIxMDAlIjsNCgkJdGhpcy5vdXRwdXRFbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdibGFjayc7IA0KCQkJICANCgkJdGhpcy5pbnB1dENvbnRhaW5lckVsZW1lbnQgPSB0aGlzLmRvY1JlZmVyZW5jZS5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCgkJdGhpcy5pbnB1dENvbnRhaW5lckVsZW1lbnQuc3R5bGUud2lkdGggPSAiMTAwJSI7DQoJCXRoaXMubG9nRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmlucHV0Q29udGFpbmVyRWxlbWVudCk7ICAgICAgDQoJCQ0KCQl0aGlzLmlucHV0RWxlbWVudCA9IHRoaXMuZG9jUmVmZXJlbmNlLmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7DQoJCXRoaXMuaW5wdXRDb250YWluZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuaW5wdXRFbGVtZW50KTsgIA0KCQl0aGlzLmlucHV0RWxlbWVudC5zdHlsZS53aWR0aCA9ICcxMDAlJzsNCgkJdGhpcy5pbnB1dEVsZW1lbnQuc3R5bGUuYm9yZGVyV2lkdGggPSAnMHB4JzsgLy8gSW5wdXRzIHdpdGggMTAwJSB3aWR0aCBhbHdheXMgc2VlbSB0byBiZSB0b28gbGFyZ2UgKEkgSEFURSBUSEVNKSB0aGV5IG9ubHkgd29yayBpZiB0aGUgYm9yZGVyLCBtYXJnaW4gYW5kIHBhZGRpbmcgYXJlIDANCgkJdGhpcy5pbnB1dEVsZW1lbnQuc3R5bGUubWFyZ2luID0gJzBweCc7DQoJCXRoaXMuaW5wdXRFbGVtZW50LnN0eWxlLnBhZGRpbmcgPSAnMHB4JzsNCgkJdGhpcy5pbnB1dEVsZW1lbnQudmFsdWUgPSAnVHlwZSBjb21tYW5kIGhlcmUnOyANCgkJdGhpcy5pbnB1dEVsZW1lbnQuc2V0QXR0cmlidXRlKCdhdXRvY29tcGxldGUnLCAnb2ZmJyk7IC8vIFNvIEZpcmVmb3ggZG9lc24ndCBmbGlwIG91dA0KCQ0KCQlMb2c0anMuYXR0YWNoRXZlbnQodGhpcy5pbnB1dEVsZW1lbnQsICdrZXl1cCcsIExvZzRqcy5iaW5kKHRoaXMuaGFuZGxlSW5wdXQsIHRoaXMpKTsNCgkJTG9nNGpzLmF0dGFjaEV2ZW50KHRoaXMuaW5wdXRFbGVtZW50LCAnY2xpY2snLCBMb2c0anMuYmluZCggZnVuY3Rpb24oKSB7dGhpcy5pbnB1dEVsZW1lbnQuc2VsZWN0KCk7fSwgdGhpcykpOw0KCQkNCgkJaWYodGhpcy5pbmxpbmUpew0KCQkJd2luZG93LnNldEludGVydmFsKExvZzRqcy5iaW5kKHRoaXMucmVwb3NpdGlvbldpbmRvdywgdGhpcyksIDUwMCk7DQoJCQl0aGlzLnJlcG9zaXRpb25XaW5kb3coKTsJDQoJCQkvLyBBbGxvdyBhY2VzcyBrZXkgbGluayAgICAgICAgICANCgkJCXZhciBhY2Nlc3NFbGVtZW50ID0gdGhpcy5kb2NSZWZlcmVuY2UuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7DQoJCQlhY2Nlc3NFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsNCgkJCWFjY2Vzc0VsZW1lbnQuc3R5bGUudG9wID0gIi0xMDBweCI7DQoJCQlhY2Nlc3NFbGVtZW50LmFjY2Vzc0tleSA9IHRoaXMuYWNjZXNza2V5Ow0KCQkJYWNjZXNzRWxlbWVudC5vbmNsaWNrID0gTG9nNGpzLmJpbmQodGhpcy50b2dnbGUsIHRoaXMpOw0KCQkJdGhpcy5kb2NSZWZlcmVuY2UuYm9keS5hcHBlbmRDaGlsZChhY2Nlc3NFbGVtZW50KTsNCgkJfSBlbHNlIHsNCgkJCXRoaXMuc2hvdygpOw0KCQl9DQoJfSwNCgkvKioNCgkgKiBzaG93cy9oaWRlIGFuIGVsZW1lbnQNCgkgKiBAcHJpdmF0ZQ0KCSAqIEByZXR1cm4gdHJ1ZSBpZiBzaG93bg0KCSAqLw0KCXRvZ2dsZSA6IGZ1bmN0aW9uKCkgew0KCQlpZiAodGhpcy5sb2dFbGVtZW50LnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKSB7DQoJCSAJdGhpcy5zaG93KCk7DQoJCSAJcmV0dXJuIHRydWU7DQoJCX0gZWxzZSB7DQoJCQl0aGlzLmhpZGUoKTsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCX0sIA0KCS8qKg0KCSAqIEBwcml2YXRlDQoJICovDQoJc2hvdyA6IGZ1bmN0aW9uKCkgew0KCQl0aGlzLmxvZ0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICcnOw0KCSAgCXRoaXMub3V0cHV0RWxlbWVudC5zY3JvbGxUb3AgPSB0aGlzLm91dHB1dEVsZW1lbnQuc2Nyb2xsSGVpZ2h0OyAvLyBTY3JvbGwgdG8gYm90dG9tIHdoZW4gdG9nZ2xlZA0KIAkgIAl0aGlzLmlucHV0RWxlbWVudC5zZWxlY3QoKTsNCgl9LCANCgkvKioNCgkgKiBAcHJpdmF0ZQ0KCSAqLwkNCgloaWRlIDogZnVuY3Rpb24oKSB7DQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KCX0sICANCgkvKioNCgkgKiBAcHJpdmF0ZQ0KCSAqIEBwYXJhbSBtZXNzYWdlDQoJICogQHN0eWxlDQoJICovCQ0KCW91dHB1dCA6IGZ1bmN0aW9uKG1lc3NhZ2UsIHN0eWxlKSB7DQoNCgkJLy8gSWYgd2UgYXJlIGF0IHRoZSBib3R0b20gb2YgdGhlIHdpbmRvdywgdGhlbiBrZWVwIHNjcm9sbGluZyB3aXRoIHRoZSBvdXRwdXQJCQkNCgkJdmFyIHNob3VsZFNjcm9sbCA9ICh0aGlzLm91dHB1dEVsZW1lbnQuc2Nyb2xsVG9wICsgKDIgKiB0aGlzLm91dHB1dEVsZW1lbnQuY2xpZW50SGVpZ2h0KSkgPj0gdGhpcy5vdXRwdXRFbGVtZW50LnNjcm9sbEhlaWdodDsNCiAgICAgICAgICAgICAgICANCgkJdGhpcy5vdXRwdXRDb3VudCsrOw0KCSAgCXN0eWxlID0gKHN0eWxlID8gc3R5bGUgKz0gJzsnIDogJycpOwkgIAkNCgkgIAlzdHlsZSArPSAncGFkZGluZzoxcHg7bWFyZ2luOjAgMCA1cHggMCc7CSAgICAgDQoJCSAgDQoJCWlmICh0aGlzLm91dHB1dENvdW50ICUgMiA9PT0gMCkgew0KCQkJc3R5bGUgKz0gIjtiYWNrZ3JvdW5kLWNvbG9yOiMxMDEwMTAiOw0KCQl9DQoJICAJDQoJICAJbWVzc2FnZSA9IG1lc3NhZ2UgfHwgInVuZGVmaW5lZCI7DQoJICAJbWVzc2FnZSA9IG1lc3NhZ2UudG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICANCgkgIAl0aGlzLm91dHB1dEVsZW1lbnQuaW5uZXJIVE1MICs9ICI8cHJlIHN0eWxlPSciICsgc3R5bGUgKyAiJz4iICsgbWVzc2FnZSArICI8L3ByZT4iOw0KICAgICAgICAgICAgICAgIA0KCSAgCWlmIChzaG91bGRTY3JvbGwpIHsJCQkJDQoJCQl0aGlzLm91dHB1dEVsZW1lbnQuc2Nyb2xsVG9wID0gdGhpcy5vdXRwdXRFbGVtZW50LnNjcm9sbEhlaWdodDsNCgkJfQ0KCX0sDQoJDQoJLyoqDQoJICogQHByaXZhdGUNCgkgKi8NCgl1cGRhdGVUYWdzIDogZnVuY3Rpb24oKSB7DQoJCQ0KCQl2YXIgcGF0dGVybiA9IHRoaXMudGFnRmlsdGVyRWxlbWVudC52YWx1ZTsNCgkNCgkJaWYgKHRoaXMudGFnUGF0dGVybiA9PSBwYXR0ZXJuKSB7DQoJCQlyZXR1cm47DQoJCX0NCgkJDQoJCXRyeSB7DQoJCQluZXcgUmVnRXhwKHBhdHRlcm4pOw0KCQl9IGNhdGNoIChlKSB7DQoJCQlyZXR1cm47DQoJCX0NCgkJDQoJCXRoaXMudGFnUGF0dGVybiA9IHBhdHRlcm47DQoNCgkJdGhpcy5vdXRwdXRFbGVtZW50LmlubmVySFRNTCA9ICIiOw0KCQkNCgkJLy8gR28gdGhyb3VnaCBlYWNoIGxvZyBlbnRyeSBhZ2Fpbg0KCQl0aGlzLm91dHB1dENvdW50ID0gMDsNCgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxvZ2dlci5sb2dnaW5nRXZlbnRzLmxlbmd0aDsgaSsrKSB7DQogIAkJCXRoaXMuZG9BcHBlbmQodGhpcy5sb2dnZXIubG9nZ2luZ0V2ZW50c1tpXSk7DQoJCX0gIA0KCX0sDQoNCgkvKioNCgkgKiBAcHJpdmF0ZQ0KCSAqLwkNCglyZXBvc2l0aW9uV2luZG93IDogZnVuY3Rpb24oKSB7DQoJCXZhciBvZmZzZXQgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgdGhpcy5kb2NSZWZlcmVuY2UuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCB0aGlzLmRvY1JlZmVyZW5jZS5ib2R5LnNjcm9sbFRvcDsNCgkJdmFyIHBhZ2VIZWlnaHQgPSBzZWxmLmlubmVySGVpZ2h0IHx8IHRoaXMuZG9jUmVmZXJlbmNlLmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwgdGhpcy5kb2NSZWZlcmVuY2UuYm9keS5jbGllbnRIZWlnaHQ7DQoJCXRoaXMubG9nRWxlbWVudC5zdHlsZS50b3AgPSAob2Zmc2V0ICsgcGFnZUhlaWdodCAtIHRoaXMubG9nRWxlbWVudC5vZmZzZXRIZWlnaHQpICsgInB4IjsNCgl9LA0KDQoJLyoqDQoJICogQHBhcmFtIGxvZ2dpbmdFdmVudCBldmVudCB0byBiZSBsb2dnZWQNCgkgKiBAc2VlIExvZzRqcy5BcHBlbmRlciNkb0FwcGVuZA0KCSAqLw0KCWRvQXBwZW5kIDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCQ0KCQlpZih0aGlzLnBvcHVwQmxvY2tlcikgew0KCQkJLy9wb3B1cCBibG9ja2VkLCB3ZSByZXR1cm4gaW4gdGhpcyBjYXNlDQoJCQlyZXR1cm47DQoJCX0NCgkJDQoJCWlmICgoIXRoaXMuaW5saW5lKSAmJiAoIXRoaXMud2luUmVmZXJlbmNlIHx8IHRoaXMud2luUmVmZXJlbmNlLmNsb3NlZCkpIHsNCgkJCXRoaXMuaW5pdGlhbGl6ZSgpOw0KCQl9DQoJCQ0KCQlpZiAodGhpcy50YWdQYXR0ZXJuICE9PSBudWxsICYmIA0KCQkJbG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkuc2VhcmNoKG5ldyBSZWdFeHAodGhpcy50YWdQYXR0ZXJuLCAnaWdtJykpID09IC0xKSB7DQoJCQlyZXR1cm47DQoJCX0NCgkJDQoJCXZhciBzdHlsZSA9ICcnOw0KCSAgCQ0KCQlpZiAobG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkuc2VhcmNoKC9FUlJPUi8pICE9IC0xKSB7IA0KCQkJc3R5bGUgKz0gJ2NvbG9yOnJlZCc7DQoJCX0gZWxzZSBpZiAobG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkuc2VhcmNoKC9GQVRBTC8pICE9IC0xKSB7IA0KCQkJc3R5bGUgKz0gJ2NvbG9yOnJlZCc7DQoJCX0gZWxzZSBpZiAobG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkuc2VhcmNoKC9XQVJOLykgIT0gLTEpIHsgDQoJCQlzdHlsZSArPSAnY29sb3I6b3JhbmdlJzsNCgkJfSBlbHNlIGlmIChsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKS5zZWFyY2goL0RFQlVHLykgIT0gLTEpIHsNCgkJCXN0eWxlICs9ICdjb2xvcjpncmVlbic7DQoJCX0gZWxzZSBpZiAobG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkuc2VhcmNoKC9JTkZPLykgIT0gLTEpIHsNCgkJCXN0eWxlICs9ICdjb2xvcjp3aGl0ZSc7DQoJCX0gZWxzZSB7DQoJCQlzdHlsZSArPSAnY29sb3I6eWVsbG93JzsNCgkJfQ0KCQ0KCQl0aGlzLm91dHB1dCh0aGlzLmxheW91dC5mb3JtYXQobG9nZ2luZ0V2ZW50KSwgc3R5bGUpOwkNCgl9LA0KDQoJLyoqDQoJICogQHNlZSBMb2c0anMuQXBwZW5kZXIjZG9DbGVhcg0KCSAqLw0KCWRvQ2xlYXIgOiBmdW5jdGlvbigpIHsNCgkJdGhpcy5vdXRwdXRFbGVtZW50LmlubmVySFRNTCA9ICIiOw0KCX0sDQoJLyoqDQoJICogQHByaXZhdGUNCgkgKiBAcGFyYW0gZQ0KCSAqLw0KCWhhbmRsZUlucHV0IDogZnVuY3Rpb24oZSkgew0KCQlpZiAoZS5rZXlDb2RlID09IDEzICkgeyAgICAgIA0KCQkJdmFyIGNvbW1hbmQgPSB0aGlzLmlucHV0RWxlbWVudC52YWx1ZTsNCgkJCQ0KCQkJc3dpdGNoKGNvbW1hbmQpIHsNCgkJCQljYXNlICJjbGVhciI6DQoJCQkJCXRoaXMubG9nZ2VyLmNsZWFyKCk7ICANCgkJCQkJYnJlYWs7DQoJCQkJCQ0KCQkJCWRlZmF1bHQ6ICAgICAgICANCgkJCQkJdmFyIGNvbnNvbGVPdXRwdXQgPSAiIjsNCgkJCQkNCgkJCQkJdHJ5IHsNCgkJCQkJCWNvbnNvbGVPdXRwdXQgPSBldmFsKHRoaXMuaW5wdXRFbGVtZW50LnZhbHVlKTsNCgkJCQkJfSBjYXRjaCAoZSkgeyAgDQoJCQkJCQl0aGlzLmxvZ2dlci5lcnJvcigiUHJvYmxlbSBwYXJzaW5nIGlucHV0IDwiICsgY29tbWFuZCArICI+IiArIGUubWVzc2FnZSk7DQoJCQkJCQlicmVhazsNCgkJCQkJfQ0KCQkJCQkJDQoJCQkJCXRoaXMubG9nZ2VyLnRyYWNlKGNvbnNvbGVPdXRwdXQpOw0KCQkJCQlicmVhazsNCgkJCX0gICAgICAgIA0KCQkNCgkJCWlmICh0aGlzLmlucHV0RWxlbWVudC52YWx1ZSAhPT0gIiIgJiYgdGhpcy5pbnB1dEVsZW1lbnQudmFsdWUgIT09IHRoaXMuY29tbWFuZEhpc3RvcnlbMF0pIHsNCgkJCQl0aGlzLmNvbW1hbmRIaXN0b3J5LnVuc2hpZnQodGhpcy5pbnB1dEVsZW1lbnQudmFsdWUpOw0KCQkJfQ0KCQkgIA0KCQkJdGhpcy5jb21tYW5kSW5kZXggPSAwOw0KCQkJdGhpcy5pbnB1dEVsZW1lbnQudmFsdWUgPSAiIjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KCQl9IGVsc2UgaWYgKGUua2V5Q29kZSA9PSAzOCAmJiB0aGlzLmNvbW1hbmRIaXN0b3J5Lmxlbmd0aCA+IDApIHsNCiAgICAJCXRoaXMuaW5wdXRFbGVtZW50LnZhbHVlID0gdGhpcy5jb21tYW5kSGlzdG9yeVt0aGlzLmNvbW1hbmRJbmRleF07DQoNCgkJCWlmICh0aGlzLmNvbW1hbmRJbmRleCA8IHRoaXMuY29tbWFuZEhpc3RvcnkubGVuZ3RoIC0gMSkgew0KICAgICAgCQkJdGhpcy5jb21tYW5kSW5kZXggKz0gMTsNCiAgICAgIAkJfQ0KICAgIAl9IGVsc2UgaWYgKGUua2V5Q29kZSA9PSA0MCAmJiB0aGlzLmNvbW1hbmRIaXN0b3J5Lmxlbmd0aCA+IDApIHsNCiAgICAJCWlmICh0aGlzLmNvbW1hbmRJbmRleCA+IDApIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgCQkJdGhpcy5jb21tYW5kSW5kZXggLT0gMTsNCgkgICAgCX0gICAgICAgICAgICAgICAgICAgICAgIA0KDQoJCQl0aGlzLmlucHV0RWxlbWVudC52YWx1ZSA9IHRoaXMuY29tbWFuZEhpc3RvcnlbdGhpcy5jb21tYW5kSW5kZXhdOw0KCSAgCX0gZWxzZSB7DQogICAgCQl0aGlzLmNvbW1hbmRJbmRleCA9IDA7DQogICAgCX0NCgl9LA0KDQoJLyoqDQoJICogQHByaXZhdGUNCgkgKi8NCgltYWtlV2luTmFtZTogZnVuY3Rpb24oY2F0ZWdvcnkpIHsNCgkJcmV0dXJuIGNhdGVnb3J5LnJlcGxhY2UoL1teXGRcd10vZywgIl8iKTsNCgl9LA0KICAgICAgICAgICAgICAgIA0KCS8qKiANCgkgKiB0b1N0cmluZw0KCSAqLw0KCSB0b1N0cmluZzogZnVuY3Rpb24oKSB7DQoJIAlyZXR1cm4gIkxvZzRqcy5Db25zb2xlQXBwZW5kZXJbaW5saW5lPSIgKyB0aGlzLmlubGluZSArICJdIjsgDQoJIH0NCn0pOyANCg0KLyoqDQogKiBNZXRhdGFnIEFwcGVuZGVyIHdyaXRpbmcgdGhlIGxvZ3MgdG8gbWV0YSB0YWdzDQogKg0KICogQGV4dGVuZHMgTG9nNGpzLkFwcGVuZGVyDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSBsb2dnZXIgbG9nNGpzIGluc3RhbmNlIHRoaXMgYXBwZW5kZXIgaXMgYXR0YWNoZWQgdG8NCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqLw0KTG9nNGpzLk1ldGF0YWdBcHBlbmRlciA9IGZ1bmN0aW9uKCkgew0KCXRoaXMuY3VycmVudExpbmUgPSAwOw0KfTsNCkxvZzRqcy5NZXRhdGFnQXBwZW5kZXIucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkFwcGVuZGVyKCksIHsgIA0KCS8qKg0KCSAqIEBwYXJhbSBsb2dnaW5nRXZlbnQgZXZlbnQgdG8gYmUgbG9nZ2VkDQoJICogQHNlZSBMb2c0anMuQXBwZW5kZXIjZG9BcHBlbmQNCgkgKi8NCglkb0FwcGVuZDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCXZhciBub3cgPSBuZXcgRGF0ZSgpOw0KCQl2YXIgbGluZXMgPSBsb2dnaW5nRXZlbnQubWVzc2FnZS5zcGxpdCgiXG4iKTsNCgkJdmFyIGhlYWRUYWcgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdOw0KDQoJCWZvciAodmFyIGkgPSAxOyBpIDw9IGxpbmVzLmxlbmd0aDsgaSsrKSB7DQoJCQl2YXIgdmFsdWUgPSBsaW5lc1tpIC0gMV07DQoJCQlpZiAoaSA9PSAxKSB7DQoJCQkJdmFsdWUgPSBsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKSArICI6ICIgKyB2YWx1ZTsNCgkJCX0gZWxzZSB7DQoJCQkJdmFsdWUgPSAiPiAiICsgdmFsdWU7DQoJCQl9DQoNCgkJCXZhciBtZXRhVGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibWV0YSIpOw0KCQkJbWV0YVRhZy5zZXRBdHRyaWJ1dGUoIm5hbWUiLCAiWC1sb2c0anM6IiArIHRoaXMuY3VycmVudExpbmUpOw0KCQkJbWV0YVRhZy5zZXRBdHRyaWJ1dGUoImNvbnRlbnQiLCB2YWx1ZSk7DQoJCQloZWFkVGFnLmFwcGVuZENoaWxkKG1ldGFUYWcpOw0KCQkJdGhpcy5jdXJyZW50TGluZSArPSAxOw0KCQl9DQoJfSwNCg0KCS8qKiANCgkgKiB0b1N0cmluZw0KCSAqLw0KCSB0b1N0cmluZzogZnVuY3Rpb24oKSB7DQoJIAlyZXR1cm4gIkxvZzRqcy5NZXRhdGFnQXBwZW5kZXIiOyANCgkgfQ0KfSk7DQoNCi8qKg0KICogQUpBWCBBcHBlbmRlciBzZW5kaW5nIHtAbGluayBMb2c0anMuTG9nZ2luZ0V2ZW50fXMgYXN5bmNocm9uIHZpYSANCiAqIDxjb2RlPlhNTEh0dHBSZXF1ZXN0PC9jb2RlPiB0byBzZXJ2ZXIuPGJyIC8+DQogKiBUaGUge0BsaW5rIExvZzRqcy5Mb2dnaW5nRXZlbnR9IGlzIFBPU1RlZCBhcyByZXNwb25zZSBjb250ZW50IGFuZCBpcyANCiAqIGZvcm1hdHRlZCBieSB0aGUgYWNjb2NpYXRlZCBsYXlvdXQuIERlZmF1bHQgbGF5b3V0IGlzIHtAbGluayBMb2c0anMuWE1MTGF5b3V0fS4gDQogKiBUaGUgPGNvZGU+dGhyZXNob2xkPC9jb2RlPiBkZWZpbmVzIHdoZW4gdGhlIGxvZ3MgDQogKiBzaG91bGQgYmUgc2VuZCB0byB0aGUgc2VydmVyLiBCeSBkZWZhdWx0IGV2ZXJ5IGV2ZW50IGlzIHNlbnQgb24gaXRzDQogKiBvd24gKHRocmVzaG9sZD0xKS4gSWYgaXQgaXMgc2V0IHRvIDEwLCB0aGVuIHRoZSBldmVudHMgYXJlIHNlbmQgaW4gZ3JvdXBzIG9mDQogKiAxMCBldmVudHMuDQogKg0KICogQGV4dGVuZHMgTG9nNGpzLkFwcGVuZGVyIA0KICogQGNvbnN0cnVjdG9yDQogKiBAcGFyYW0ge0xvZzRqcy5Mb2dnZXJ9IGxvZ2dlciBsb2c0anMgaW5zdGFuY2UgdGhpcyBhcHBlbmRlciBpcyBhdHRhY2hlZCB0bw0KICogQHBhcmFtIHtTdHJpbmd9IGxvZ2dpbmdVcmwgdXJsIHdoZXJlIGFwcGVuZGVyIHdpbGwgcG9zdCBsb2cgbWVzc2FnZXMgdG8NCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqLw0KTG9nNGpzLkFqYXhBcHBlbmRlciA9IGZ1bmN0aW9uKGxvZ2dpbmdVcmwpIHsNCg0KCS8qKg0KCSAqIGlzIHN0aWxsIGVzbmRpbmcgZGF0YSB0byBzZXJ2ZXINCgkgKiBAdHlwZSBib29sZWFuDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmlzSW5Qcm9ncmVzcyA9IGZhbHNlOw0KCQ0KCS8qKg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5sb2dnaW5nVXJsID0gbG9nZ2luZ1VybCB8fCAibG9nZ2luZy5sb2c0anMiOw0KCQ0KCS8qKg0KCSAqIEB0eXBlIEludGVnZXINCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCXRoaXMudGhyZXNob2xkID0gMTsNCgkNCgkvKioNCgkgKiB0aW1lb3V0IHdoZW4gcmVxdWVzdCBpcyBhYm9ydGVkLg0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy50aW1lb3V0ID0gMjAwMDsNCgkNCgkvKioNCgkgKiBMaXN0IG9mIExvZ2dpbmdFdmVudHMgd2hpY2ggc2hvdWxkIGJlIHNlbmQgYWZ0ZXIgdGhyZXNob2xkIGlzIHJlYWNoZWQuDQoJICogQHR5cGUgTWFwDQoJICogQHByaXZhdGUNCgkgKi8NCgl0aGlzLmxvZ2dpbmdFdmVudE1hcCA9IG5ldyBMb2c0anMuRmlmb0J1ZmZlcigpOw0KDQoJLyoqDQoJICogQHR5cGUgTG9nNGpzLkxheW91dA0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5sYXlvdXQgPSBuZXcgTG9nNGpzLlhNTExheW91dCgpOw0KCS8qKg0KCSAqIEB0eXBlIFhNTEh0dHBSZXF1ZXN0DQoJICogQHByaXZhdGUNCgkgKi8JDQoJdGhpcy5odHRwUmVxdWVzdCA9IG51bGw7DQp9Ow0KDQpMb2c0anMuQWpheEFwcGVuZGVyLnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5BcHBlbmRlcigpLCB7ICANCgkvKioNCgkgKiBzZW5kcyB0aGUgbG9ncyB0byB0aGUgc2VydmVyDQoJICogQHBhcmFtIGxvZ2dpbmdFdmVudCBldmVudCB0byBiZSBsb2dnZWQNCgkgKiBAc2VlIExvZzRqcy5BcHBlbmRlciNkb0FwcGVuZA0KCSAqLw0KCWRvQXBwZW5kOiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI+IEFqYXhBcHBlbmRlci5hcHBlbmQiKTsNCgkNCgkJaWYgKHRoaXMubG9nZ2luZ0V2ZW50TWFwLmxlbmd0aCgpIDw9IHRoaXMudGhyZXNob2xkIHx8IHRoaXMuaXNJblByb2dyZXNzID09PSB0cnVlKSB7DQoJCQl0aGlzLmxvZ2dpbmdFdmVudE1hcC5wdXNoKGxvZ2dpbmdFdmVudCk7DQoJCX0NCgkJDQoJCWlmKHRoaXMubG9nZ2luZ0V2ZW50TWFwLmxlbmd0aCgpID49IHRoaXMudGhyZXNob2xkICYmIHRoaXMuaXNJblByb2dyZXNzID09PSBmYWxzZSkgew0KCQkJLy9pZiB0aHJlc2hvbGQgaXMgcmVhY2hlZCBzZW5kIHRoZSBldmVudHMgYW5kIHJlc2V0IGN1cnJlbnQgdGhyZXNob2xkDQoJCQl0aGlzLnNlbmQoKTsNCgkJfQ0KCQkNCgkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI8IEFqYXhBcHBlbmRlci5hcHBlbmQiKTsNCgl9LA0KCQ0KCS8qKiBAc2VlIEFwcGVuZGVyI2RvQ2xlYXIgKi8NCglkb0NsZWFyOiBmdW5jdGlvbigpIHsNCgkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI+IEFqYXhBcHBlbmRlci5kb0NsZWFyIiApOw0KCQlpZih0aGlzLmxvZ2dpbmdFdmVudE1hcC5sZW5ndGgoKSA+IDApIHsNCgkJCXRoaXMuc2VuZCgpOw0KCQl9DQoJCWxvZzRqc0xvZ2dlci50cmFjZSgiPCBBamF4QXBwZW5kZXIuZG9DbGVhciIgKTsNCgl9LA0KCQ0KCS8qKg0KCSAqIFNldCB0aGUgdGhyZXNob2xkIHdoZW4gbG9ncyBoYXZlIHRvIGJlIHNlbmQuIERlZmF1bHQgdGhyZXNob2xkIGlzIDEuDQoJICogQHByYXJhbSB7aW50fSB0aHJlc2hvbGQgbmV3IHRocmVzaG9sZA0KCSAqLw0KCXNldFRocmVzaG9sZDogZnVuY3Rpb24odGhyZXNob2xkKSB7DQoJCWxvZzRqc0xvZ2dlci50cmFjZSgiPiBBamF4QXBwZW5kZXIuc2V0VGhyZXNob2xkOiAiICsgdGhyZXNob2xkICk7DQoJCXRoaXMudGhyZXNob2xkID0gdGhyZXNob2xkOw0KCQlsb2c0anNMb2dnZXIudHJhY2UoIjwgQWpheEFwcGVuZGVyLnNldFRocmVzaG9sZCIgKTsNCgl9LA0KCQ0KCS8qKg0KCSAqIFNldCB0aGUgdGltZW91dCBpbiBtaWxsaSBzZWNvbmRzIHVudGlsIHNlbmRpbmcgcmVxdWVzdCBpcyBhYm9ydGVkLg0KCSAqIERlZmF1bHQgaXMgMjAwMCBtcy4NCgkgKiBAcGFyYW0ge2ludH0gbWlsbGlzZWNvbmRzIHRoZSBuZXcgdGltZW91dA0KCSAqLw0KCXNldFRpbWVvdXQ6IGZ1bmN0aW9uKG1pbGxpc2Vjb25kcykgew0KCQl0aGlzLnRpbWVvdXQgPSBtaWxsaXNlY29uZHM7DQoJfSwNCgkNCgkvKioNCgkgKiBzZW5kIHRoZSByZXF1ZXN0Lg0KCSAqLw0KCXNlbmQ6IGZ1bmN0aW9uKCkgew0KCQlpZih0aGlzLmxvZ2dpbmdFdmVudE1hcC5sZW5ndGgoKSA+MCkgew0KCQkJDQoJCQlsb2c0anNMb2dnZXIudHJhY2UoIj4gQWpheEFwcGVuZGVyLnNlbmQiKTsNCgkJCQ0KCQkJDQoJCQl0aGlzLmlzSW5Qcm9ncmVzcyA9IHRydWU7DQoJCQl2YXIgYSA9IFtdOw0KCQ0KCQkJZm9yKHZhciBpID0gMDsgaSA8IHRoaXMubG9nZ2luZ0V2ZW50TWFwLmxlbmd0aCgpICYmIGkgPCB0aGlzLnRocmVzaG9sZDsgaSsrKSB7DQoJCQkJYS5wdXNoKHRoaXMubGF5b3V0LmZvcm1hdCh0aGlzLmxvZ2dpbmdFdmVudE1hcC5wdWxsKCkpKTsNCgkJCX0gDQoJCQkJCQ0KCQkJdmFyIGNvbnRlbnQgPSB0aGlzLmxheW91dC5nZXRIZWFkZXIoKTsJDQoJCQljb250ZW50ICs9IGEuam9pbih0aGlzLmxheW91dC5nZXRTZXBhcmF0b3IoKSk7DQoJCQljb250ZW50ICs9IHRoaXMubGF5b3V0LmdldEZvb3RlcigpOw0KCQkJDQoJCQl2YXIgYXBwZW5kZXIgPSB0aGlzOw0KCQkJaWYodGhpcy5odHRwUmVxdWVzdCA9PT0gbnVsbCl7DQoJCQkJdGhpcy5odHRwUmVxdWVzdCA9IHRoaXMuZ2V0WG1sSHR0cFJlcXVlc3QoKTsNCgkJCX0NCgkJCXRoaXMuaHR0cFJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7DQoJCQkJYXBwZW5kZXIub25SZWFkeVN0YXRlQ2hhbmdlZC5jYWxsKGFwcGVuZGVyKTsNCgkJCX07DQoJCQkNCgkJCXRoaXMuaHR0cFJlcXVlc3Qub3BlbigiUE9TVCIsIHRoaXMubG9nZ2luZ1VybCwgdHJ1ZSk7DQoJCQkvLyBzZXQgdGhlIHJlcXVlc3QgaGVhZGVycy4NCgkJCS8vdGhpcy5odHRwUmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LXR5cGUiLCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIik7DQoJCQl0aGlzLmh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtdHlwZSIsIHRoaXMubGF5b3V0LmdldENvbnRlbnRUeXBlKCkpOw0KCQkJLy9SRUZFUkVSIHdpbGwgYmUgdGhlIHRvcC1sZXZlbA0KCQkJLy8gVVJJIHdoaWNoIG1heSBkaWZmZXIgZnJvbSB0aGUgbG9jYXRpb24gb2YgdGhlIGVycm9yIGlmDQoJCQkvLyBpdCBvY2N1cnMgaW4gYW4gaW5jbHVkZWQgLmpzIGZpbGUNCgkJCXRoaXMuaHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcigiUkVGRVJFUiIsIGxvY2F0aW9uLmhyZWYpOw0KCSAJCXRoaXMuaHR0cFJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1sZW5ndGgiLCBjb250ZW50Lmxlbmd0aCk7DQoJCQl0aGlzLmh0dHBSZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoIkNvbm5lY3Rpb24iLCAiY2xvc2UiKTsNCgkJCXRoaXMuaHR0cFJlcXVlc3Quc2VuZCggY29udGVudCApOw0KCQkJDQoJCQlhcHBlbmRlciA9IHRoaXM7DQoJCQkNCgkJCXRyeSB7DQoJCQkJd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCgkJCQkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI+IEFqYXhBcHBlbmRlci50aW1lb3V0Iik7DQoJCQkJCWFwcGVuZGVyLmh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCl7cmV0dXJuO307DQoJCQkJCWFwcGVuZGVyLmh0dHBSZXF1ZXN0LmFib3J0KCk7DQoJCQkJCS8vdGhpcy5odHRwUmVxdWVzdCA9IG51bGw7DQoJCQkJCWFwcGVuZGVyLmlzSW5Qcm9ncmVzcyA9IGZhbHNlOw0KCQkNCgkJCQkJaWYoYXBwZW5kZXIubG9nZ2luZ0V2ZW50TWFwLmxlbmd0aCgpID4gMCkgew0KCQkJCQkJYXBwZW5kZXIuc2VuZCgpOw0KCQkJCQl9DQoJCQkJCWxvZzRqc0xvZ2dlci50cmFjZSgiPCBBamF4QXBwZW5kZXIudGltZW91dCIpOw0KCQkJCX0sIHRoaXMudGltZW91dCk7DQoJCQl9IGNhdGNoIChlKSB7DQoJCQkJbG9nNGpzTG9nZ2VyLmZhdGFsKGUpOw0KCQkJfQ0KCQkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI+IEFqYXhBcHBlbmRlci5zZW5kIik7DQoJCX0NCgl9LA0KCQ0KCS8qKg0KCSAqIEBwcml2YXRlDQoJICovDQoJb25SZWFkeVN0YXRlQ2hhbmdlZDogZnVuY3Rpb24oKSB7DQoJCWxvZzRqc0xvZ2dlci50cmFjZSgiPiBBamF4QXBwZW5kZXIub25SZWFkeVN0YXRlQ2hhbmdlZCIpOw0KCQl2YXIgcmVxID0gdGhpcy5odHRwUmVxdWVzdDsNCgkJaWYgKHRoaXMuaHR0cFJlcXVlc3QucmVhZHlTdGF0ZSAhPSA0KSB7IA0KCQkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI8IEFqYXhBcHBlbmRlci5vblJlYWR5U3RhdGVDaGFuZ2VkOiByZWFkeVN0YXRlICIgKyByZXEucmVhZHlTdGF0ZSArICIgIT0gNCIpOw0KCQkJcmV0dXJuOyANCgkJfQ0KCQkNCgkJdmFyIHN1Y2Nlc3MgPSAoKHR5cGVvZiByZXEuc3RhdHVzID09PSAidW5kZWZpbmVkIikgfHwgcmVxLnN0YXR1cyA9PT0gMCB8fCAocmVxLnN0YXR1cyA+PSAyMDAgJiYgcmVxLnN0YXR1cyA8IDMwMCkpOw0KCQkNCgkJaWYgKHN1Y2Nlc3MpIHsNCgkJCWxvZzRqc0xvZ2dlci50cmFjZSgiICBBamF4QXBwZW5kZXIub25SZWFkeVN0YXRlQ2hhbmdlZDogc3VjY2VzcyIpOw0KDQoJCQkvL3JlYWR5IHNlbmRpbmcgZGF0YQ0KCQkJdGhpcy5pc0luUHJvZ3Jlc3MgPSBmYWxzZTsNCg0KCQl9IGVsc2Ugew0KCQkJdmFyIG1zZyA9ICIgIEFqYXhBcHBlbmRlci5vblJlYWR5U3RhdGVDaGFuZ2VkOiBYTUxIdHRwUmVxdWVzdCByZXF1ZXN0IHRvIFVSTCAiICsgdGhpcy5sb2dnaW5nVXJsICsgIiByZXR1cm5lZCBzdGF0dXMgY29kZSAiICsgdGhpcy5odHRwUmVxdWVzdC5zdGF0dXM7DQoJCQlsb2c0anNMb2dnZXIuZXJyb3IobXNnKTsNCgkJfQ0KCQkNCgkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI8IEFqYXhBcHBlbmRlci5vblJlYWR5U3RhdGVDaGFuZ2VkOiByZWFkeVN0YXRlID09IDQiKTsJCQ0KCX0sDQoJLyoqDQoJICogR2V0IHRoZSBYTUxIdHRwUmVxdWVzdCBvYmplY3QgaW5kZXBlbmRlbnQgb2YgYnJvd3Nlci4NCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCWdldFhtbEh0dHBSZXF1ZXN0OiBmdW5jdGlvbigpIHsNCgkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI+IEFqYXhBcHBlbmRlci5nZXRYbWxIdHRwUmVxdWVzdCIpOw0KCQkNCgkJdmFyIGh0dHBSZXF1ZXN0ID0gZmFsc2U7DQoNCgkJdHJ5IHsJCQ0KCQkJaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCkgeyAvLyBNb3ppbGxhLCBTYWZhcmksIElFNy4uLg0KCQkJCQlodHRwUmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KCQkJCWlmIChodHRwUmVxdWVzdC5vdmVycmlkZU1pbWVUeXBlKSB7DQoJCQkJCWh0dHBSZXF1ZXN0Lm92ZXJyaWRlTWltZVR5cGUodGhpcy5sYXlvdXQuZ2V0Q29udGVudFR5cGUoKSk7DQoJCQkJfQ0KCQkJfSBlbHNlIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkgeyAvLyBJRQ0KCQkJCXRyeSB7DQoJCQkJCWh0dHBSZXF1ZXN0ID0gbmV3IEFjdGl2ZVhPYmplY3QoIk1zeG1sMi5YTUxIVFRQIik7DQoJCQkJfSBjYXRjaCAoZSkgew0KCQkJCQlodHRwUmVxdWVzdCA9IG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpOw0KCQkJCX0NCgkJCX0NCgkJfSBjYXRjaCAoZSkgew0KCQkJaHR0cFJlcXVlc3QgPSBmYWxzZTsNCgkJfQ0KCQkNCgkJaWYgKCFodHRwUmVxdWVzdCkgew0KCQkJbG9nNGpzTG9nZ2VyLmZhdGFsKCJVbmZvcnR1bmF0ZWx5LCB5b3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBBamF4QXBwZW5kZXIgZm9yIGxvZzRqcyEiKTsNCgkJfQ0KCQkNCgkJbG9nNGpzTG9nZ2VyLnRyYWNlKCI8IEFqYXhBcHBlbmRlci5nZXRYbWxIdHRwUmVxdWVzdCIpOw0KCQlyZXR1cm4gaHR0cFJlcXVlc3Q7DQoJfSwNCgkNCgkvKiogDQoJICogdG9TdHJpbmcNCgkgKi8NCgkgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgew0KCSAJcmV0dXJuICJMb2c0anMuQWpheEFwcGVuZGVyW2xvZ2dpbmdVcmw9IiArIHRoaXMubG9nZ2luZ1VybCArICIsIHRocmVzaG9sZD0iICsgdGhpcy50aHJlc2hvbGQgKyAiXSI7IA0KCSB9DQp9KTsNCg0KLyoqDQogKiBGaWxlIEFwcGVuZGVyIHdyaXRpbmcgdGhlIGxvZ3MgdG8gYSB0ZXh0IGZpbGUuDQogKiBQTEVBU0UgTk9URSAtIE9ubHkgd29ya3MgaW4gSUUgYW5kIE1vemlsbGEgDQogKiB1c2UgQWN0aXZlWCB0byB3cml0ZSBmaWxlIG9uIElFDQogKiB1c2UgWFBDb20gY29tcG9uZW50cyAgdG8gd3JpdGUgZmlsZSBvbiBNb3ppbGxhDQogKiANCiAqIEBleHRlbmRzIExvZzRqcy5BcHBlbmRlciANCiAqIEBjb25zdHJ1Y3Rvcg0KICogQHBhcmFtIGxvZ2dlciBsb2c0anMgaW5zdGFuY2UgdGhpcyBhcHBlbmRlciBpcyBhdHRhY2hlZCB0bw0KICogQHBhcmFtIGZpbGUgZmlsZSBsb2cgbWVzc2FnZXMgd2lsbCBiZSB3cml0dGVuIHRvDQogKiBAYXV0aG9yIFNldGggQ2hpc2Ftb3JlDQogKiBAYXV0aG9yIE5pY29sYXMgSnVzdGluIG5qdXN0aW5AaWRlYWx4LmNvbQ0KICogQGF1dGhvciBHcmVnb3J5IEtva2Fub3NreSBna29rYW5vc2t5QGlkZWFseC5jb20NCiAqLw0KTG9nNGpzLkZpbGVBcHBlbmRlciA9IGZ1bmN0aW9uKGZpbGUpIHsNCg0KCXRoaXMubGF5b3V0ID0gbmV3IExvZzRqcy5TaW1wbGVMYXlvdXQoKTsNCgl0aGlzLmlzSUUgPSAndW5kZWZpbmVkJzsNCgkNCgl0aGlzLmZpbGUgPSBmaWxlIHx8ICJsb2c0anMubG9nIjsJDQoJDQoJdHJ5ew0KCQl0aGlzLmZzbyA9IG5ldyBBY3RpdmVYT2JqZWN0KCJTY3JpcHRpbmcuRmlsZVN5c3RlbU9iamVjdCIpOw0KCQl0aGlzLmlzSUUgPSB0cnVlOw0KCX0gY2F0Y2goZSl7DQoJCXRyeSB7DQoJCQluZXRzY2FwZS5zZWN1cml0eS5Qcml2aWxlZ2VNYW5hZ2VyLmVuYWJsZVByaXZpbGVnZSgiVW5pdmVyc2FsWFBDb25uZWN0Iik7DQoJCQl0aGlzLmZzbyA9ICBDb21wb25lbnRzLmNsYXNzZXNbIkBtb3ppbGxhLm9yZy9maWxlL2xvY2FsOzEiXS5jcmVhdGVJbnN0YW5jZShDb21wb25lbnRzLmludGVyZmFjZXMubnNJTG9jYWxGaWxlKTsNCgkJCXRoaXMuaXNJRSA9IGZhbHNlOyAvL21vemlsbGEgJiBjbw0KCQl9IGNhdGNoIChlKSB7DQoJCQlsb2c0anNMb2dnZXIuZXJyb3IoZSk7DQoJCX0NCgl9DQp9Ow0KDQpMb2c0anMuRmlsZUFwcGVuZGVyLnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5BcHBlbmRlcigpLCB7ICANCgkvKioNCgkgKiBAcGFyYW0gbG9nZ2luZ0V2ZW50IGV2ZW50IHRvIGJlIGxvZ2dlZA0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQXBwZW5kDQoJICovDQoJZG9BcHBlbmQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQl0cnkgew0KCQkJdmFyIGZpbGVIYW5kbGUgPSBudWxsOw0KCQkJDQoJCQlpZiggdGhpcy5pc0lFID09PSAndW5kZWZpbmVkJykgew0KCQkJCWxvZzRqc0xvZ2dlci5lcnJvcigiVW5zdXBwb3J0ZWQiKTsNCgkJCX0NCgkJCWVsc2UgaWYoIHRoaXMuaXNJRSApew0KCQkJCS8vIHRyeSBvcGVuaW5nIGV4aXN0aW5nIGZpbGUsIGNyZWF0ZSBpZiBuZWVkZWQNCgkJCQlmaWxlSGFuZGxlID0gdGhpcy5mc28uT3BlblRleHRGaWxlKHRoaXMuZmlsZSwgOCwgdHJ1ZSk7ICAgICAgICANCgkJCQkvLyB3cml0ZSBvdXQgb3VyIGRhdGENCgkJCQlmaWxlSGFuZGxlLldyaXRlTGluZSh0aGlzLmxheW91dC5mb3JtYXQobG9nZ2luZ0V2ZW50KSk7DQoJCQkJZmlsZUhhbmRsZS5jbG9zZSgpOyAgIA0KCQkJfSBlbHNlIHsNCgkJCQluZXRzY2FwZS5zZWN1cml0eS5Qcml2aWxlZ2VNYW5hZ2VyLmVuYWJsZVByaXZpbGVnZSgiVW5pdmVyc2FsWFBDb25uZWN0Iik7DQoJCQkJdGhpcy5mc28uaW5pdFdpdGhQYXRoKHRoaXMuZmlsZSk7DQogICAgCQkJaWYoIXRoaXMuZnNvLmV4aXN0cygpKSB7DQogICAgCQkJCS8vY3JlYXRlIGZpbGUgaWYgbmVlZGVkDQogICAgICAgICAgICAJCXRoaXMuZnNvLmNyZWF0ZSgweDAwLCAwNjAwKTsNCiAgICAJCQl9DQoJCQkJDQogCQkJCWZpbGVIYW5kbGUgPSBDb21wb25lbnRzLmNsYXNzZXNbIkBtb3ppbGxhLm9yZy9uZXR3b3JrL2ZpbGUtb3V0cHV0LXN0cmVhbTsxIl0uY3JlYXRlSW5zdGFuY2UoQ29tcG9uZW50cy5pbnRlcmZhY2VzLm5zSUZpbGVPdXRwdXRTdHJlYW0pOw0KICAgICAgICAJCWZpbGVIYW5kbGUuaW5pdCggdGhpcy5mc28sIDB4MDQgfCAweDA4IHwgMHgxMCwgMDY0LCAwKTsNCgkJCQl2YXIgbGluZSA9IHRoaXMubGF5b3V0LmZvcm1hdChsb2dnaW5nRXZlbnQpOw0KICAgICAgICAJCWZpbGVIYW5kbGUud3JpdGUobGluZSwgbGluZS5sZW5ndGgpOyAvL3dyaXRlIGRhdGENCiAgICAgICAgCQlmaWxlSGFuZGxlLmNsb3NlKCk7DQoJCQl9DQoJCX0gY2F0Y2ggKGUpIHsNCgkJCWxvZzRqc0xvZ2dlci5lcnJvcihlKTsNCgkJfQ0KCX0sDQoJLyoNCgkgKiBAc2VlIExvZzRqcy5BcHBlbmRlciNkb0NsZWFyDQoJICovDQoJZG9DbGVhcjogZnVuY3Rpb24oKSB7DQoJCXRyeSB7DQoJCQlpZiggdGhpcy5pc0lFICl7DQoJCQkJdmFyIGZpbGVIYW5kbGUgPSB0aGlzLmZzby5HZXRGaWxlKHRoaXMuZmlsZSk7DQoJCQkJZmlsZUhhbmRsZS5EZWxldGUoKTsNCgkJCX0gZWxzZSB7DQoJCQkJbmV0c2NhcGUuc2VjdXJpdHkuUHJpdmlsZWdlTWFuYWdlci5lbmFibGVQcml2aWxlZ2UoIlVuaXZlcnNhbFhQQ29ubmVjdCIpOw0KCQkJCXRoaXMuZnNvLmluaXRXaXRoUGF0aCh0aGlzLmZpbGUpOw0KCQkJCWlmKHRoaXMuZnNvLmV4aXN0cygpKSB7DQoJCQkJCXRoaXMuZnNvLnJlbW92ZShmYWxzZSk7DQoJCQkJfQ0KCQkJfQ0KCQl9IGNhdGNoIChlKSB7DQoJCQlsb2c0anNMb2dnZXIuZXJyb3IoZSk7DQoJCX0NCgl9LA0KCQ0KCS8qKiANCgkgKiB0b1N0cmluZw0KCSAqLw0KCSB0b1N0cmluZzogZnVuY3Rpb24oKSB7DQoJIAlyZXR1cm4gIkxvZzRqcy5GaWxlQXBwZW5kZXJbZmlsZT0iICsgdGhpcy5maWxlICsgIl0iOyANCgkgfQ0KfSk7DQoNCi8qKg0KICogV2luZG93cyBFdmVudCBBcHBlbmRlciB3cml0ZXMgdGhlIGxvZ3MgdG8gdGhlIFdpbmRvd3MgRXZlbnQgbG9nLg0KICogUExFQVNFIE5PVEUgLSBPbmx5IHdvcmtzIGluIElFLi51c2VzIEFjdGl2ZVggdG8gd3JpdGUgdG8gV2luZG93cyBFdmVudCBsb2cNCiAqDQogKiBAZXh0ZW5kcyBMb2c0anMuQXBwZW5kZXIgDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSBsb2dnZXIgbG9nNGpzIGluc3RhbmNlIHRoaXMgYXBwZW5kZXIgaXMgYXR0YWNoZWQgdG8NCiAqIEBhdXRob3IgU2V0aCBDaGlzYW1vcmUNCiAqLw0KTG9nNGpzLldpbmRvd3NFdmVudEFwcGVuZGVyID0gZnVuY3Rpb24oKSB7DQoJDQoJdGhpcy5sYXlvdXQgPSBuZXcgTG9nNGpzLlNpbXBsZUxheW91dCgpOw0KCQ0KCXRyeSB7DQoJCXRoaXMuc2hlbGwgPSBuZXcgQWN0aXZlWE9iamVjdCgiV1NjcmlwdC5TaGVsbCIpOw0KCX0gY2F0Y2goZSkgew0KCQlsb2c0anNMb2dnZXIuZXJyb3IoZSk7DQoJfQ0KfTsNCg0KTG9nNGpzLldpbmRvd3NFdmVudEFwcGVuZGVyLnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5BcHBlbmRlcigpLCB7ICANCgkvKioNCgkgKiBAcGFyYW0gbG9nZ2luZ0V2ZW50IGV2ZW50IHRvIGJlIGxvZ2dlZA0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQXBwZW5kDQoJICovDQoJZG9BcHBlbmQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQl2YXIgd2luTGV2ZWwgPSA0Ow0KCQkNCgkJLy8gTWFwIGxvZyBsZXZlbCB0byB3aW5kb3dzIGV2ZW50IGxvZyBsZXZlbC4NCgkJLy8gV2luZG93cyBldmVudHM6IC0gU1VDQ0VTUzogMCwgRVJST1I6IDEsIFdBUk5JTkc6IDIsIElORk9STUFUSU9OOiA0LCBBVURJVF9TVUNDRVNTOiA4LCBBVURJVF9GQUlMVVJFOiAxNg0KCQlzd2l0Y2ggKGxvZ2dpbmdFdmVudC5sZXZlbCkgewkNCgkJCWNhc2UgTG9nNGpzLkxldmVsLkZBVEFMOg0KCQkJCXdpbkxldmVsID0gMTsNCgkJCQlicmVhazsNCgkJCWNhc2UgTG9nNGpzLkxldmVsLkVSUk9SOg0KCQkJCXdpbkxldmVsID0gMTsNCgkJCQlicmVhazsNCgkJCWNhc2UgTG9nNGpzLkxldmVsLldBUk46DQoJCQkJd2luTGV2ZWwgPSAyOw0KCQkJCWJyZWFrOw0KCQkJZGVmYXVsdDoNCgkJCQl3aW5MZXZlbCA9IDQ7DQoJCQkJYnJlYWs7DQoJCX0NCgkJDQoJCXRyeSB7DQoJCQl0aGlzLnNoZWxsLkxvZ0V2ZW50KHdpbkxldmVsLCB0aGlzLmxldmVsLmZvcm1hdChsb2dnaW5nRXZlbnQpKTsNCgkJfSBjYXRjaChlKSB7DQoJCQlsb2c0anNMb2dnZXIuZXJyb3IoZSk7DQoJCX0NCgl9LA0KCQ0KCS8qKiANCgkgKiB0b1N0cmluZw0KCSAqLw0KCSB0b1N0cmluZzogZnVuY3Rpb24oKSB7DQoJIAlyZXR1cm4gIkxvZzRqcy5XaW5kb3dzRXZlbnRBcHBlbmRlciI7IA0KCSB9IA0KfSk7DQoNCi8qKg0KICogSlMgQWxlcnQgQXBwZW5kZXIgd3JpdGVzIHRoZSBsb2dzIHRvIHRoZSBKYXZhU2NyaXB0IGFsZXJ0IGRpYWxvZyBib3gNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkFwcGVuZGVyICANCiAqIEBwYXJhbSBsb2dnZXIgbG9nNGpzIGluc3RhbmNlIHRoaXMgYXBwZW5kZXIgaXMgYXR0YWNoZWQgdG8NCiAqIEBhdXRob3IgUyZlYWN1dGU7YmFzdGllbiBMRUNBQ0hFVVINCiAqLw0KTG9nNGpzLkpTQWxlcnRBcHBlbmRlciA9IGZ1bmN0aW9uKCkgew0KDQoJdGhpcy5sYXlvdXQgPSBuZXcgTG9nNGpzLlNpbXBsZUxheW91dCgpOw0KfTsNCg0KTG9nNGpzLkpTQWxlcnRBcHBlbmRlci5wcm90b3R5cGUgPSBMb2c0anMuZXh0ZW5kKG5ldyBMb2c0anMuQXBwZW5kZXIoKSwgeyAgDQoJLyoqIA0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQXBwZW5kDQoJICovDQoJZG9BcHBlbmQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQlhbGVydCh0aGlzLmxheW91dC5nZXRIZWFkZXIoKSArIHRoaXMubGF5b3V0LmZvcm1hdChsb2dnaW5nRXZlbnQpICsgdGhpcy5sYXlvdXQuZ2V0Rm9vdGVyKCkpOw0KCX0sDQoJDQoJLyoqIA0KCSAqIHRvU3RyaW5nDQoJICovDQoJIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsNCgkgCXJldHVybiAiTG9nNGpzLkpTQWxlcnRBcHBlbmRlciI7IA0KCSB9CQ0KfSk7DQoNCi8qKg0KICogQXBwZW5kZXIgd3JpdGVzIHRoZSBsb2dzIHRvIHRoZSBKYXZhU2NyaXB0IGNvbnNvbGUgb2YgTW96aWxsYSBicm93c2VyDQogKiBNb3JlIGluZm9zOiBodHRwOi8va2IubW96aWxsYXppbmUub3JnL2luZGV4LnBocD90aXRsZT1KYXZhU2NyaXB0X0NvbnNvbGUmcmVkaXJlY3Q9bm8NCiAqIFBMRUFTRSBOT1RFIC0gT25seSB3b3JrcyBpbiBNb3ppbGxhIGJyb3dzZXINCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkFwcGVuZGVyICANCiAqIEBwYXJhbSBsb2dnZXIgbG9nNGpzIGluc3RhbmNlIHRoaXMgYXBwZW5kZXIgaXMgYXR0YWNoZWQgdG8NCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqLw0KTG9nNGpzLk1vemlsbGFKU0NvbnNvbGVBcHBlbmRlciA9IGZ1bmN0aW9uKCkgew0KCXRoaXMubGF5b3V0ID0gbmV3IExvZzRqcy5TaW1wbGVMYXlvdXQoKTsNCgl0cnkgew0KCQluZXRzY2FwZS5zZWN1cml0eS5Qcml2aWxlZ2VNYW5hZ2VyLmVuYWJsZVByaXZpbGVnZSgiVW5pdmVyc2FsWFBDb25uZWN0Iik7DQoJCXRoaXMuanNDb25zb2xlID0gQ29tcG9uZW50cy5jbGFzc2VzWyJAbW96aWxsYS5vcmcvY29uc29sZXNlcnZpY2U7MSJdLmdldFNlcnZpY2UoQ29tcG9uZW50cy5pbnRlcmZhY2VzLm5zSUNvbnNvbGVTZXJ2aWNlKTsNCgkJdGhpcy5zY3JpcHRFcnJvciA9IENvbXBvbmVudHMuY2xhc3Nlc1siQG1vemlsbGEub3JnL3NjcmlwdGVycm9yOzEiXS5jcmVhdGVJbnN0YW5jZShDb21wb25lbnRzLmludGVyZmFjZXMubnNJU2NyaXB0RXJyb3IpOw0KCX0gY2F0Y2ggKGUpIHsNCgkJbG9nNGpzTG9nZ2VyLmVycm9yKGUpOw0KCX0NCn07DQoNCkxvZzRqcy5Nb3ppbGxhSlNDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkFwcGVuZGVyKCksIHsgIA0KCS8qKiANCgkgKiBAc2VlIExvZzRqcy5BcHBlbmRlciNkb0FwcGVuZA0KCSAqLw0KCWRvQXBwZW5kOiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJdHJ5IHsNCgkJCW5ldHNjYXBlLnNlY3VyaXR5LlByaXZpbGVnZU1hbmFnZXIuZW5hYmxlUHJpdmlsZWdlKCJVbml2ZXJzYWxYUENvbm5lY3QiKTsNCgkJCXRoaXMuc2NyaXB0RXJyb3IuaW5pdCh0aGlzLmxheW91dC5mb3JtYXQobG9nZ2luZ0V2ZW50KSwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgdGhpcy5nZXRGbGFnKGxvZ2dpbmdFdmVudCksIGxvZ2dpbmdFdmVudC5jYXRlZ29yeU5hbWUpOw0KCQkJdGhpcy5qc0NvbnNvbGUubG9nTWVzc2FnZSh0aGlzLnNjcmlwdEVycm9yKTsNCgkJfSBjYXRjaCAoZSkgew0KCQkJbG9nNGpzTG9nZ2VyLmVycm9yKGUpOw0KCQl9DQoJfSwNCgkNCgkvKiogDQoJICogdG9TdHJpbmcNCgkgKi8NCgkgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgew0KCSAJcmV0dXJuICJMb2c0anMuTW96aWxsYUpTQ29uc29sZUFwcGVuZGVyIjsgDQoJIH0sDQoJIA0KCS8qKg0KCSAqIE1hcCBMb2c0anMuTGV2ZWwgdG8ganNDb25zb2xlIEZsYWdzOg0KCSAqIDx1bD4NCgkgKiA8bGk+bnNJU2NyaXB0RXJyb3IuZXJyb3JGbGFnICgwKSA9IExldmVsLkVycm9yPC9saT4NCgkgKiA8bGk+bnNJU2NyaXB0RXJyb3Iud2FybmluZ0ZsYWcgKDEpPSBMb2c0anMuTGV2ZWwuV0FSTjwvbGk+DQoJICogPGxpPm5zSVNjcmlwdEVycm9yLmV4Y2VwdGlvbkZsYWcgKDIpID0gTG9nNGpzLkxldmVsLkZBVEFMPC9saT4NCgkgKiA8bGk+bnNJU2NyaXB0RXJyb3Iuc3RyaWN0RmxhZyAoNCkgPSB1bnVzZWQ8L2xpPg0KCSAqIDwvdWw+DQoJICogQHByaXZhdGUNCgkgKi8JDQoJZ2V0RmxhZzogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KQ0KCXsNCgkJdmFyIHJldHZhbDsNCgkJc3dpdGNoIChsb2dnaW5nRXZlbnQubGV2ZWwpIHsJDQoJCQljYXNlIExvZzRqcy5MZXZlbC5GQVRBTDoNCgkJCQlyZXR2YWwgPSAyOy8vbnNJU2NyaXB0RXJyb3IuZXhjZXB0aW9uRmxhZyA9IDINCgkJCQlicmVhazsNCgkJCWNhc2UgTG9nNGpzLkxldmVsLkVSUk9SOg0KCQkJCXJldHZhbCA9IDA7Ly9uc0lTY3JpcHRFcnJvci5lcnJvckZsYWcNCgkJCQlicmVhazsNCgkJCWNhc2UgTG9nNGpzLkxldmVsLldBUk46DQoJCQkJcmV0dmFsID0gMTsvL25zSVNjcmlwdEVycm9yLndhcm5pbmdGbGFnID0gMQ0KCQkJCWJyZWFrOw0KCQkJZGVmYXVsdDoNCgkJCQlyZXR2YWwgPSAxOy8vbnNJU2NyaXB0RXJyb3Iud2FybmluZ0ZsYWcgPSAxDQoJCQkJYnJlYWs7DQoJCX0NCgkJDQoJCXJldHVybiByZXR2YWw7CQkNCgl9DQp9KTsNCg0KLyoqDQogKiBBcHBlbmRlciB3cml0ZXMgdGhlIGxvZ3MgdG8gdGhlIEphdmFTY3JpcHQgY29uc29sZSBvZiBPcGVyYSBicm93c2VyDQogKiBQTEVBU0UgTk9URSAtIE9ubHkgd29ya3MgaW4gT3BlcmEgYnJvd3Nlcg0KICogQGNvbnN0cnVjdG9yDQogKiBAZXh0ZW5kcyBMb2c0anMuQXBwZW5kZXIgIA0KICogQHBhcmFtIGxvZ2dlciBsb2c0anMgaW5zdGFuY2UgdGhpcyBhcHBlbmRlciBpcyBhdHRhY2hlZCB0bw0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuT3BlcmFKU0NvbnNvbGVBcHBlbmRlciA9IGZ1bmN0aW9uKCkgew0KCXRoaXMubGF5b3V0ID0gbmV3IExvZzRqcy5TaW1wbGVMYXlvdXQoKTsNCn07DQoNCkxvZzRqcy5PcGVyYUpTQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5BcHBlbmRlcigpLCB7ICANCgkvKiogDQoJICogQHNlZSBMb2c0anMuQXBwZW5kZXIjZG9BcHBlbmQNCgkgKi8NCglkb0FwcGVuZDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCW9wZXJhLnBvc3RFcnJvcih0aGlzLmxheW91dC5mb3JtYXQobG9nZ2luZ0V2ZW50KSk7DQoJfSwNCgkNCgkvKiogDQoJICogdG9TdHJpbmcNCgkgKi8NCgkgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgew0KCSAJcmV0dXJuICJMb2c0anMuT3BlcmFKU0NvbnNvbGVBcHBlbmRlciI7IA0KCSB9DQp9KTsNCg0KLyoqDQogKiBBcHBlbmRlciB3cml0ZXMgdGhlIGxvZ3MgdG8gdGhlIEphdmFTY3JpcHQgY29uc29sZSBvZiBTYWZhcmkgYnJvd3Nlcg0KICogUExFQVNFIE5PVEUgLSBPbmx5IHdvcmtzIGluIFNhZmFyaSBicm93c2VyDQogKiBAY29uc3RydWN0b3INCiAqIEBleHRlbmRzIExvZzRqcy5BcHBlbmRlciAgDQogKiBAcGFyYW0gbG9nZ2VyIGxvZzRqcyBpbnN0YW5jZSB0aGlzIGFwcGVuZGVyIGlzIGF0dGFjaGVkIHRvDQogKiBAYXV0aG9yIFN0ZXBoYW4gU3RyaXR0bWF0dGVyDQogKi8NCkxvZzRqcy5TYWZhcmlKU0NvbnNvbGVBcHBlbmRlciA9IGZ1bmN0aW9uKCkgew0KCXRoaXMubGF5b3V0ID0gbmV3IExvZzRqcy5TaW1wbGVMYXlvdXQoKTsNCn07DQoNCkxvZzRqcy5TYWZhcmlKU0NvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUgPSBMb2c0anMuZXh0ZW5kKG5ldyBMb2c0anMuQXBwZW5kZXIoKSwgeyAgDQoJLyoqIA0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI2RvQXBwZW5kDQoJICovDQoJZG9BcHBlbmQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQl3aW5kb3cuY29uc29sZS5sb2codGhpcy5sYXlvdXQuZm9ybWF0KGxvZ2dpbmdFdmVudCkpOw0KCX0sDQoJDQoJLyoqIA0KCSAqIHRvU3RyaW5nDQoJICovDQoJIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsNCgkgCXJldHVybiAiTG9nNGpzLlNhZmFyaUpTQ29uc29sZUFwcGVuZGVyIjsgDQoJIH0NCn0pOw0KDQovKioNCiAqIEphdmFTY3JpcHQgQ29uc29sZSBBcHBlbmRlciB3aGljaCBpcyBicm93c2VyIGluZGVwZW5kZW50Lg0KICogSXQgY2hlY2tzIGludGVybmFsbHkgZm9yIHRoZSBjdXJyZW50IGJyb3dzZXIgYW5kIGFkZHMgZGVsZWdhdGUgdG8NCiAqIHNwZWNpZmljIEphdmFTY3JpcHQgQ29uc29sZSBBcHBlbmRlciBvZiB0aGUgYnJvd3Nlci4NCiAqDQogKiBAY29uc3RydWN0b3INCiAqIEBleHRlbmRzIExvZzRqcy5BcHBlbmRlciANCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqIEBzaW5jZSAxLjANCiAqLw0KTG9nNGpzLkJyb3dzZXJDb25zb2xlQXBwZW5kZXIgPSBmdW5jdGlvbigpIHsNCgkvKioNCgkgKiBEZWxlZ2F0ZSBmb3IgYnJvd3NlciBzcGVjaWZpYyBpbXBsZW1lbnRhdGlvbg0KCSAqIEB0eXBlIExvZzRqcy5BcHBlbmRlcg0KCSAqIEBwcml2YXRlDQoJICovDQoJdGhpcy5jb25zb2xlRGVsZWdhdGUgPSBudWxsOw0KCQ0KCWlmICh3aW5kb3cuY29uc29sZSkgew0KCQl0aGlzLmNvbnNvbGVEZWxlZ2F0ZSA9IG5ldyBMb2c0anMuU2FmYXJpSlNDb25zb2xlQXBwZW5kZXIoKTsgDQoJfQ0KICAgIGVsc2UgaWYgKHdpbmRvdy5vcGVyYSkgew0KCQl0aGlzLmNvbnNvbGVEZWxlZ2F0ZSA9IG5ldyBMb2c0anMuT3BlcmFKU0NvbnNvbGVBcHBlbmRlcigpOyANCgl9DQoJZWxzZSBpZihuZXRzY2FwZSkgew0KCQl0aGlzLmNvbnNvbGVEZWxlZ2F0ZSA9IG5ldyBMb2c0anMuTW96aWxsYUpTQ29uc29sZUFwcGVuZGVyKCk7IA0KCX0NCiAgICBlbHNlIHsNCiAgICAgICAvL0B0b2RvDQogICAgICAgbG9nNGpzTG9nZ2VyLmVycm9yKCJVbnN1cHBvcnRlZCBCcm93c2VyIik7DQogICAgfQ0KfTsNCg0KTG9nNGpzLkJyb3dzZXJDb25zb2xlQXBwZW5kZXIucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkFwcGVuZGVyKCksIHsgIA0KCS8qKiANCgkgKiBAc2VlIExvZzRqcy5BcHBlbmRlciNkb0FwcGVuZA0KCSAqLw0KCWRvQXBwZW5kOiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJdGhpcy5jb25zb2xlRGVsZWdhdGUuZG9BcHBlbmQobG9nZ2luZ0V2ZW50KTsNCgl9LA0KCS8qKiANCgkgKiBAc2VlIExvZzRqcy5BcHBlbmRlciNkb0NsZWFyDQoJICovDQoJZG9DbGVhcjogZnVuY3Rpb24oKSB7DQoJCXRoaXMuY29uc29sZURlbGVnYXRlLmRvQ2xlYXIoKTsNCgl9LA0KCS8qKg0KCSAqIEBzZWUgTG9nNGpzLkFwcGVuZGVyI3NldExheW91dA0KCSAqLw0KCXNldExheW91dDogZnVuY3Rpb24obGF5b3V0KXsNCgkJdGhpcy5jb25zb2xlRGVsZWdhdGUuc2V0TGF5b3V0KGxheW91dCk7DQoJfSwNCgkNCgkvKiogDQoJICogdG9TdHJpbmcNCgkgKi8NCgkgdG9TdHJpbmc6IGZ1bmN0aW9uKCkgew0KCSAJcmV0dXJuICJMb2c0anMuQnJvd3NlckNvbnNvbGVBcHBlbmRlcjogIiArIHRoaXMuY29uc29sZURlbGVnYXRlLnRvU3RyaW5nKCk7IA0KCSB9DQp9KTsNCg0KLyoqDQogKiBTaW1wbGVMYXlvdXQgY29uc2lzdHMgb2YgdGhlIGxldmVsIG9mIHRoZSBsb2cgc3RhdGVtZW50LCBmb2xsb3dlZCBieSAiIC0gIiANCiAqIGFuZCB0aGVuIHRoZSBsb2cgbWVzc2FnZSBpdHNlbGYuIEZvciBleGFtcGxlLA0KICogPGNvZGU+REVCVUcgLSBIZWxsbyB3b3JsZDwvY29kZT4NCiAqDQogKiBAY29uc3RydWN0b3INCiAqIEBleHRlbmRzIExvZzRqcy5MYXlvdXQNCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqLw0KTG9nNGpzLlNpbXBsZUxheW91dCA9IGZ1bmN0aW9uKCkgew0KCXRoaXMuTElORV9TRVAgID0gIlxuIjsNCgl0aGlzLkxJTkVfU0VQX0xFTiA9IDE7DQp9Ow0KDQpMb2c0anMuU2ltcGxlTGF5b3V0LnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5MYXlvdXQoKSwgew0KCS8qKiANCgkgKiBJbXBsZW1lbnQgdGhpcyBtZXRob2QgdG8gY3JlYXRlIHlvdXIgb3duIGxheW91dCBmb3JtYXQuDQoJICogQHBhcmFtIHtMb2c0anMuTG9nZ2luZ0V2ZW50fSBsb2dnaW5nRXZlbnQgbG9nZ2luZ0V2ZW50IHRvIGZvcm1hdA0KCSAqIEByZXR1cm4gZm9ybWF0dGVkIFN0cmluZw0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWZvcm1hdDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCXJldHVybiBsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKSArICIgLSAiICsgbG9nZ2luZ0V2ZW50Lm1lc3NhZ2UgKyB0aGlzLkxJTkVfU0VQOw0KCX0sDQoJLyoqIA0KCSAqIFJldHVybnMgdGhlIGNvbnRlbnQgdHlwZSBvdXRwdXQgYnkgdGhpcyBsYXlvdXQuIA0KCSAqIEByZXR1cm4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyAidGV4dC9wbGFpbiIuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0Q29udGVudFR5cGU6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gInRleHQvcGxhaW4iOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgaGVhZGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEhlYWRlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiIjsNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIFJldHVybnMgdGhlIGZvb3RlciBmb3IgdGhlIGxheW91dCBmb3JtYXQuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgbnVsbC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRGb290ZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIiI7DQoJfQ0KfSk7DQoJDQovKioNCiAqIEJhc2ljTGF5b3V0IGlzIGEgc2ltcGxlIGxheW91dCBmb3Igc3RvcmluZyB0aGUgbG9nZ3MuIFRoZSBsb2dncyBhcmUgc3RvcmVkDQogKiBpbiBmb2xsb3dpbmcgZm9ybWF0Og0KICogPHByZT4NCiAqIGNhdGVnb3J5TmFtZX5zdGFydFRpbWUgW2xvZ0xldmVsXSBtZXNzYWdlXG4NCiAqIDwvcHJlPg0KICoNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkxheW91dA0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuQmFzaWNMYXlvdXQgPSBmdW5jdGlvbigpIHsNCgl0aGlzLkxJTkVfU0VQICA9ICJcbiI7DQp9Ow0KDQpMb2c0anMuQmFzaWNMYXlvdXQucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkxheW91dCgpLCB7DQoJLyoqIA0KCSAqIEltcGxlbWVudCB0aGlzIG1ldGhvZCB0byBjcmVhdGUgeW91ciBvd24gbGF5b3V0IGZvcm1hdC4NCgkgKiBAcGFyYW0ge0xvZzRqcy5Mb2dnaW5nRXZlbnR9IGxvZ2dpbmdFdmVudCBsb2dnaW5nRXZlbnQgdG8gZm9ybWF0DQoJICogQHJldHVybiBmb3JtYXR0ZWQgU3RyaW5nDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZm9ybWF0OiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJcmV0dXJuIGxvZ2dpbmdFdmVudC5jYXRlZ29yeU5hbWUgKyAifiIgKyBsb2dnaW5nRXZlbnQuc3RhcnRUaW1lLnRvTG9jYWxlU3RyaW5nKCkgKyAiIFsiICsgbG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkgKyAiXSAiICsgbG9nZ2luZ0V2ZW50Lm1lc3NhZ2UgKyB0aGlzLkxJTkVfU0VQOw0KCX0sDQoJLyoqIA0KCSAqIFJldHVybnMgdGhlIGNvbnRlbnQgdHlwZSBvdXRwdXQgYnkgdGhpcyBsYXlvdXQuIA0KCSAqIEByZXR1cm4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyAidGV4dC9wbGFpbiIuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0Q29udGVudFR5cGU6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gInRleHQvcGxhaW4iOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgaGVhZGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyBudWxsLg0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWdldEhlYWRlcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiIjsNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIFJldHVybnMgdGhlIGZvb3RlciBmb3IgdGhlIGxheW91dCBmb3JtYXQuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgbnVsbC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRGb290ZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIiI7DQoJfQ0KfSk7DQoNCi8qKg0KICogSHRtbExheW91dCB3cml0ZSB0aGUgbG9ncyBpbiBIdG1sIGZvcm1hdC4NCiAqDQogKiBAY29uc3RydWN0b3INCiAqIEBleHRlbmRzIExvZzRqcy5MYXlvdXQNCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqLw0KTG9nNGpzLkh0bWxMYXlvdXQgPSBmdW5jdGlvbigpIHtyZXR1cm47fTsNCg0KTG9nNGpzLkh0bWxMYXlvdXQucHJvdG90eXBlID0gTG9nNGpzLmV4dGVuZChuZXcgTG9nNGpzLkxheW91dCgpLCB7DQoJLyoqIA0KCSAqIEltcGxlbWVudCB0aGlzIG1ldGhvZCB0byBjcmVhdGUgeW91ciBvd24gbGF5b3V0IGZvcm1hdC4NCgkgKiBAcGFyYW0ge0xvZzRqcy5Mb2dnaW5nRXZlbnR9IGxvZ2dpbmdFdmVudCBsb2dnaW5nRXZlbnQgdG8gZm9ybWF0DQoJICogQHJldHVybiBmb3JtYXR0ZWQgU3RyaW5nDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZm9ybWF0OiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpIHsNCgkJcmV0dXJuICI8ZGl2IHN0eWxlPVwiIiArIHRoaXMuZ2V0U3R5bGUobG9nZ2luZ0V2ZW50KSArICJcIj4iICsgbG9nZ2luZ0V2ZW50LmdldEZvcm1hdHRlZFRpbWVzdGFtcCgpICsgIiAtICIgKyBsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKSArICIgLSAiICsgbG9nZ2luZ0V2ZW50Lm1lc3NhZ2UgKyAiPC9kaXY+XG4iOw0KCX0sDQoJLyoqIA0KCSAqIFJldHVybnMgdGhlIGNvbnRlbnQgdHlwZSBvdXRwdXQgYnkgdGhpcyBsYXlvdXQuIA0KCSAqIEByZXR1cm4gVGhlIGJhc2UgY2xhc3MgcmV0dXJucyAidGV4dC9odG1sIi4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRDb250ZW50VHlwZTogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAidGV4dC9odG1sIjsNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIFJldHVybnMgdGhlIGhlYWRlciBmb3IgdGhlIGxheW91dCBmb3JtYXQuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgbnVsbC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRIZWFkZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIjxodG1sPjxoZWFkPjx0aXRsZT5sb2c0anM8L2hlYWQ+PGJvZHk+IjsNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIFJldHVybnMgdGhlIGZvb3RlciBmb3IgdGhlIGxheW91dCBmb3JtYXQuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgbnVsbC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRGb290ZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIjwvYm9keT48L2h0bWw+IjsNCgl9LA0KCQ0KCWdldFN0eWxlOiBmdW5jdGlvbihsb2dnaW5nRXZlbnQpDQoJew0KCQl2YXIgc3R5bGU7DQoJCWlmIChsb2dnaW5nRXZlbnQubGV2ZWwudG9TdHJpbmcoKS5zZWFyY2goL0VSUk9SLykgIT0gLTEpIHsgDQoJCQlzdHlsZSA9ICdjb2xvcjpyZWQnOw0KCQl9IGVsc2UgaWYgKGxvZ2dpbmdFdmVudC5sZXZlbC50b1N0cmluZygpLnNlYXJjaCgvRkFUQUwvKSAhPSAtMSkgeyANCgkJCXN0eWxlID0gJ2NvbG9yOnJlZCc7DQoJCX0gZWxzZSBpZiAobG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkuc2VhcmNoKC9XQVJOLykgIT0gLTEpIHsgDQoJCQlzdHlsZSA9ICdjb2xvcjpvcmFuZ2UnOw0KCQl9IGVsc2UgaWYgKGxvZ2dpbmdFdmVudC5sZXZlbC50b1N0cmluZygpLnNlYXJjaCgvREVCVUcvKSAhPSAtMSkgew0KCQkJc3R5bGUgPSAnY29sb3I6Z3JlZW4nOw0KCQl9IGVsc2UgaWYgKGxvZ2dpbmdFdmVudC5sZXZlbC50b1N0cmluZygpLnNlYXJjaCgvSU5GTy8pICE9IC0xKSB7DQoJCQlzdHlsZSA9ICdjb2xvcjp3aGl0ZSc7DQoJCX0gZWxzZSB7DQoJCQlzdHlsZSA9ICdjb2xvcjp5ZWxsb3cnOw0KCQl9CQ0KCQlyZXR1cm4gc3R5bGU7DQoJfQ0KfSk7DQoNCi8qKg0KICogWE1MTGF5b3V0IHdyaXRlIHRoZSBsb2dzIGluIFhNTCBmb3JtYXQuDQogKiBMYXlvdXQgaXMgc2ltbWlsYXIgdG8gbG9nNGoncyBYTUxMYXlvdXQ6DQogKiA8cHJlPg0KICogPGxvZzRqczpldmVudCBjYXRlZ29yeT0iY2F0ZWdvcnkiIGxldmVsPSJMZXZlbCIgY2xpZW50PSJDbGllbnQiIHJlZmVyZXI9InJlZiIgdGltZXN0YW09IkRhdGUiPg0KICogPGxvZzRqczptZXNzYWdlPkxvZ2dlZCBtZXNzYWdlPC9sb2c0anM6bWVzc2FnZT4NCiAqIDwvbG9nNGpzOmV2ZW50Pg0KICogPC9wcmU+DQogKiBAY29uc3RydWN0b3INCiAqIEBleHRlbmRzIExvZzRqcy5MYXlvdXQNCiAqIEBhdXRob3IgU3RlcGhhbiBTdHJpdHRtYXR0ZXINCiAqLw0KTG9nNGpzLlhNTExheW91dCA9IGZ1bmN0aW9uKCl7cmV0dXJuO307DQpMb2c0anMuWE1MTGF5b3V0LnByb3RvdHlwZSA9IExvZzRqcy5leHRlbmQobmV3IExvZzRqcy5MYXlvdXQoKSwgew0KCS8qKiANCgkgKiBJbXBsZW1lbnQgdGhpcyBtZXRob2QgdG8gY3JlYXRlIHlvdXIgb3duIGxheW91dCBmb3JtYXQuDQoJICogQHBhcmFtIHtMb2c0anMuTG9nZ2luZ0V2ZW50fSBsb2dnaW5nRXZlbnQgbG9nZ2luZ0V2ZW50IHRvIGZvcm1hdA0KCSAqIEByZXR1cm4gZm9ybWF0dGVkIFN0cmluZw0KCSAqIEB0eXBlIFN0cmluZw0KCSAqLw0KCWZvcm1hdDogZnVuY3Rpb24obG9nZ2luZ0V2ZW50KSB7DQoJCXZhciB1c2VyYWdlbnQgPSAidW5rbm93biI7DQoJCXRyeSB7DQoJCQl1c2VyYWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KCQl9IGNhdGNoKGUpew0KCQkJdXNlcmFnZW50ID0gInVua25vd24iOw0KCQl9DQoJCQ0KCQl2YXIgcmVmZXJlciA9ICJ1bmtub3duIjsNCgkJdHJ5IHsNCgkJCXJlZmVyZXIgPSBsb2NhdGlvbi5ocmVmOw0KCQl9IGNhdGNoKGUpew0KCQkJcmVmZXJlciA9ICJ1bmtub3duIjsNCgkJfQ0KCQkJCQ0KCQl2YXIgY29udGVudCA9ICI8bG9nNGpzOmV2ZW50IGxvZ2dlcj1cIiI7DQoJCWNvbnRlbnQgKz0gbG9nZ2luZ0V2ZW50LmNhdGVnb3J5TmFtZSArICJcIiBsZXZlbD1cIiI7DQoJCWNvbnRlbnQgKz0gbG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkgKyAiXCIgdXNlcmFnZW50PVwiIjsNCgkJY29udGVudCArPSB1c2VyYWdlbnQgKyAiXCIgcmVmZXJlcj1cIiI7DQoJCWNvbnRlbnQgKz0gcmVmZXJlci5yZXBsYWNlKC8mL2csICImYW1wOyIpICsgIlwiIHRpbWVzdGFtcD1cIiI7DQoJCWNvbnRlbnQgKz0gbG9nZ2luZ0V2ZW50LmdldEZvcm1hdHRlZFRpbWVzdGFtcCgpICsgIlwiPlxuIjsNCgkJY29udGVudCArPSAiXHQ8bG9nNGpzOm1lc3NhZ2U+PCFbQ0RBVEFbIiArIHRoaXMuZXNjYXBlQ2RhdGEobG9nZ2luZ0V2ZW50Lm1lc3NhZ2UpICsgIl1dPjwvbG9nNGpzOm1lc3NhZ2U+XG4iOwkNCiAJCQ0KIAkJaWYgKGxvZ2dpbmdFdmVudC5leGNlcHRpb24pIHsNCgkJCWNvbnRlbnQgKz0gdGhpcy5mb3JtYXRFeGNlcHRpb24obG9nZ2luZ0V2ZW50LmV4Y2VwdGlvbikgOw0KCQl9DQogCQljb250ZW50ICs9ICI8L2xvZzRqczpldmVudD5cbiI7DQogICAgICAgIA0KICAgICAgcmV0dXJuIGNvbnRlbnQ7DQoJfSwNCgkvKiogDQoJICogUmV0dXJucyB0aGUgY29udGVudCB0eXBlIG91dHB1dCBieSB0aGlzIGxheW91dC4gDQoJICogQHJldHVybiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zICJ0ZXh0L3htbCIuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0Q29udGVudFR5cGU6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gInRleHQveG1sIjsNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIFJldHVybnMgdGhlIGhlYWRlciBmb3IgdGhlIGxheW91dCBmb3JtYXQuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgbnVsbC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRIZWFkZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIjxsb2c0anM6ZXZlbnRTZXQgdmVyc2lvbj1cIiIgKyBMb2c0anMudmVyc2lvbiArIA0KCQkJIlwiIHhtbG5zOmxvZzRqcz1cImh0dHA6Ly9zdHJpdHRpLmdpdGh1Yi5pby9sb2c0anMvLzIwMDcvbG9nNGpzL1wiPlxuIjsNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIFJldHVybnMgdGhlIGZvb3RlciBmb3IgdGhlIGxheW91dCBmb3JtYXQuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgbnVsbC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRGb290ZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIjwvbG9nNGpzOmV2ZW50U2V0PlxuIjsNCgl9LA0KCQ0KCWdldFNlcGFyYXRvcjogZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiXG4iOw0KCX0sDQoJDQoJLyoqDQoJICogYmV0dGVyIHJlYWRhYmxlIGZvcm1hdHRlZCBFeGNlcHRpb25zLg0KCSAqIEBwYXJhbSBleCB7RXhjZXB0aW9ufSB0aGUgZXhjZXB0aW9uIHRvIGJlIGZvcm1hdHRlZC4NCgkgKiBAcmV0dXJuIHtTdHJpbmd9IHRoZSBmb3JtYXR0ZWQgU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBleGNlcHRpb24uDQoJICogQHByaXZhdGUNCgkgKi8NCglmb3JtYXRFeGNlcHRpb246IGZ1bmN0aW9uKGV4KSB7DQoJCWlmIChleCkgew0KCQkJdmFyIGV4U3RyID0gIlx0PGxvZzRqczp0aHJvd2FibGU+IjsgDQoJCQlpZiAoZXgubWVzc2FnZSkgew0KCQkJCWV4U3RyICs9ICAiXHRcdDxsb2c0anM6bWVzc2FnZT48IVtDREFUQVsiICsgdGhpcy5lc2NhcGVDZGF0YShleC5tZXNzYWdlKSArICJdXT48L2xvZzRqczptZXNzYWdlPlxuIjsJDQoJCQl9IA0KCQkJaWYgKGV4LmRlc2NyaXB0aW9uKSB7DQoJCQkJZXhTdHIgKz0gICJcdFx0PGxvZzRqczpkZXNjcmlwdGlvbj48IVtDREFUQVsiICsgdGhpcy5lc2NhcGVDZGF0YShleC5kZXNjcmlwdGlvbikgKyAiXV0+PC9sb2c0anM6ZGVzY3JpcHRpb24+XG4iOwkNCgkJCX0NCgkJCQ0KCQkJZXhTdHIgKz0gICJcdFx0PGxvZzRqczpzdGFja3RyYWNlPiI7DQoJCQlleFN0ciArPSAgIlx0XHRcdDxsb2c0anM6bG9jYXRpb24gZmlsZU5hbWU9XCIiK2V4LmZpbGVOYW1lKyJcIiBsaW5lTnVtYmVyPVwiIitleC5saW5lTnVtYmVyKyJcIiAvPiI7DQoJCQlleFN0ciArPSAgIlx0XHQ8L2xvZzRqczpzdGFja3RyYWNlPiI7DQoJCQlleFN0ciA9ICJcdDwvbG9nNGpzOnRocm93YWJsZT4iOw0KCQkJcmV0dXJuIGV4U3RyOw0KCQl9DQoJCXJldHVybiBudWxsOw0KCX0sDQoJLyoqDQoJICogRXNjYXBlIENkYXRhIG1lc3NhZ2VzDQoJICogQHBhcmFtIHN0ciB7U3RyaW5nfSBtZXNzYWdlIHRvIGVzY2FwZQ0KCSAqIEByZXR1cm4ge1N0cmluZ30gdGhlIGVzY2FwZWQgbWVzc2FnZQ0KCSAqIEBwcml2YXRlDQoJICovDQoJZXNjYXBlQ2RhdGE6IGZ1bmN0aW9uKHN0cikgew0KCQlyZXR1cm4gc3RyLnJlcGxhY2UoL1xdXF0+LywgIl1dPl1dJmd0OzwhW0NEQVRBWyIpOw0KCX0NCn0pOw0KDQovKioNCiAqIEpTT05MYXlvdXQgd3JpdGUgdGhlIGxvZ3MgaW4gSlNPTiBmb3JtYXQuDQogKiBKU09OIGxpYnJhcnkgaXMgcmVxdWlyZWQgdG8gdXNlIHRoaXMgTGF5b3V0LiBTZWUgYWxzbyB7QGxpbmsgaHR0cDovL3d3dy5qc29uLm9yZ30NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkxheW91dA0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuSlNPTkxheW91dCA9IGZ1bmN0aW9uKCkgew0KCXRoaXMuZGYgPSBuZXcgTG9nNGpzLkRhdGVGb3JtYXR0ZXIoKTsNCn07DQpMb2c0anMuSlNPTkxheW91dC5wcm90b3R5cGUgPSBMb2c0anMuZXh0ZW5kKG5ldyBMb2c0anMuTGF5b3V0KCksIHsNCgkvKiogDQoJICogSW1wbGVtZW50IHRoaXMgbWV0aG9kIHRvIGNyZWF0ZSB5b3VyIG93biBsYXlvdXQgZm9ybWF0Lg0KCSAqIEBwYXJhbSB7TG9nNGpzLkxvZ2dpbmdFdmVudH0gbG9nZ2luZ0V2ZW50IGxvZ2dpbmdFdmVudCB0byBmb3JtYXQNCgkgKiBAcmV0dXJuIGZvcm1hdHRlZCBTdHJpbmcNCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglmb3JtYXQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQkNCgkJCQl2YXIgdXNlcmFnZW50ID0gInVua25vd24iOw0KCQl0cnkgew0KCQkJdXNlcmFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudDsNCgkJfSBjYXRjaChlKXsNCgkJCXVzZXJhZ2VudCA9ICJ1bmtub3duIjsNCgkJfQ0KCQkNCgkJdmFyIHJlZmVyZXIgPSAidW5rbm93biI7DQoJCXRyeSB7DQoJCQlyZWZlcmVyID0gbG9jYXRpb24uaHJlZjsNCgkJfSBjYXRjaChlKXsNCgkJCXJlZmVyZXIgPSAidW5rbm93biI7DQoJCX0NCgkJDQoJCXZhciBqc29uU3RyaW5nID0gIntcbiBcIkxvZ2dpbmdFdmVudFwiOiB7XG4iOw0KCQkNCgkJanNvblN0cmluZyArPSAiXHRcImxvZ2dlclwiOiBcIiIgKyAgbG9nZ2luZ0V2ZW50LmNhdGVnb3J5TmFtZSArICJcIixcbiI7DQoJCWpzb25TdHJpbmcgKz0gIlx0XCJsZXZlbFwiOiBcIiIgKyAgbG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCkgKyAiXCIsXG4iOw0KCQlqc29uU3RyaW5nICs9ICJcdFwibWVzc2FnZVwiOiBcIiIgKyAgbG9nZ2luZ0V2ZW50Lm1lc3NhZ2UgKyAiXCIsXG4iOyANCgkJanNvblN0cmluZyArPSAiXHRcInJlZmVyZXJcIjogXCIiICsgcmVmZXJlciArICJcIixcbiI7IA0KCQlqc29uU3RyaW5nICs9ICJcdFwidXNlcmFnZW50XCI6IFwiIiArIHVzZXJhZ2VudCArICJcIixcbiI7IA0KCQlqc29uU3RyaW5nICs9ICJcdFwidGltZXN0YW1wXCI6IFwiIiArICB0aGlzLmRmLmZvcm1hdERhdGUobG9nZ2luZ0V2ZW50LnN0YXJ0VGltZSwgInl5eXktTU0tZGRUaGg6bW06c3NaIikgKyAiXCIsXG4iOw0KCQlqc29uU3RyaW5nICs9ICJcdFwiZXhjZXB0aW9uXCI6IFwiIiArICBsb2dnaW5nRXZlbnQuZXhjZXB0aW9uICsgIlwiXG4iOyANCgkJanNvblN0cmluZyArPSAifX0iOyAgICAgIA0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGpzb25TdHJpbmc7DQoJfSwNCgkvKiogDQoJICogUmV0dXJucyB0aGUgY29udGVudCB0eXBlIG91dHB1dCBieSB0aGlzIGxheW91dC4gDQoJICogQHJldHVybiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zICJ0ZXh0L3htbCIuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0Q29udGVudFR5cGU6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gInRleHQvanNvbiI7DQoJfSwNCgkvKiogDQoJICogQHJldHVybiBSZXR1cm5zIHRoZSBoZWFkZXIgZm9yIHRoZSBsYXlvdXQgZm9ybWF0LiBUaGUgYmFzZSBjbGFzcyByZXR1cm5zIG51bGwuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0SGVhZGVyOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuICJ7XCJMb2c0anNcIjogW1xuIjsNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIFJldHVybnMgdGhlIGZvb3RlciBmb3IgdGhlIGxheW91dCBmb3JtYXQuIFRoZSBiYXNlIGNsYXNzIHJldHVybnMgbnVsbC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRGb290ZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gIlxuXX0iOw0KCX0sDQoJDQoJZ2V0U2VwYXJhdG9yOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuICIsXG4iOw0KCX0NCn0pOw0KDQovKiogDQogKiBQYXR0ZXJuTGF5b3V0IA0KICoNCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgTG9nNGpzLkxheW91dA0KICogQGF1dGhvciBTdGVwaGFuIFN0cml0dG1hdHRlcg0KICovDQpMb2c0anMuUGF0dGVybkxheW91dCA9IGZ1bmN0aW9uKHBhdHRlcm4pIHsNCglpZiAocGF0dGVybikgew0KCQl0aGlzLnBhdHRlcm4gPSBwYXR0ZXJuOw0KCX0gZWxzZSB7DQoJCXRoaXMucGF0dGVybiA9IExvZzRqcy5QYXR0ZXJuTGF5b3V0LkRFRkFVTFRfQ09OVkVSU0lPTl9QQVRURVJOOw0KCX0NCn07DQoNCkxvZzRqcy5QYXR0ZXJuTGF5b3V0LlRUQ0NfQ09OVkVSU0lPTl9QQVRURVJOID0gIiVyICVwICVjIC0gJW0lbiI7DQpMb2c0anMuUGF0dGVybkxheW91dC5ERUZBVUxUX0NPTlZFUlNJT05fUEFUVEVSTiA9ICIlbSVuIjsNCkxvZzRqcy5QYXR0ZXJuTGF5b3V0LklTTzg2MDFfREFURUZPUk1BVCA9ICJ5eXl5LU1NLWRkIEhIOm1tOnNzLFNTUyI7DQpMb2c0anMuUGF0dGVybkxheW91dC5EQVRFVElNRV9EQVRFRk9STUFUID0gImRkIE1NTSBZWVlZIEhIOm1tOnNzLFNTUyI7DQpMb2c0anMuUGF0dGVybkxheW91dC5BQlNPTFVURVRJTUVfREFURUZPUk1BVCA9ICJISDptbTpzcyxTU1MiOw0KDQpMb2c0anMuUGF0dGVybkxheW91dC5wcm90b3R5cGUgPSBMb2c0anMuZXh0ZW5kKG5ldyBMb2c0anMuTGF5b3V0KCksIHsNCgkvKiogDQoJICogUmV0dXJucyB0aGUgY29udGVudCB0eXBlIG91dHB1dCBieSB0aGlzIGxheW91dC4gDQoJICogQHJldHVybiAidGV4dC9wbGFpbiIuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0Q29udGVudFR5cGU6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gInRleHQvcGxhaW4iOw0KCX0sDQoJLyoqIA0KCSAqIEByZXR1cm4gUmV0dXJucyB0aGUgaGVhZGVyIGZvciB0aGUgbGF5b3V0IGZvcm1hdC4NCgkgKiBAdHlwZSBTdHJpbmcNCgkgKi8NCglnZXRIZWFkZXI6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gbnVsbDsNCgl9LA0KCS8qKiANCgkgKiBAcmV0dXJuIFJldHVybnMgdGhlIGZvb3RlciBmb3IgdGhlIGxheW91dCBmb3JtYXQuDQoJICogQHR5cGUgU3RyaW5nDQoJICovDQoJZ2V0Rm9vdGVyOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIG51bGw7DQoJfSwNCgkNCglmb3JtYXQ6IGZ1bmN0aW9uKGxvZ2dpbmdFdmVudCkgew0KCQl2YXIgcmVnZXggPSAvJSgtP1swLTldKyk/KFwuP1swLTldKyk/KFtjZG1ucHIlXSkoXHsoW15cfV0rKVx9KT98KFteJV0rKS87DQoJCXZhciBmb3JtYXR0ZWRTdHJpbmcgPSAiIjsNCgkJdmFyIHJlc3VsdDsNCgkJdmFyIHNlYXJjaFN0cmluZyA9IHRoaXMucGF0dGVybjsNCg0KCQkvLyBDYW5ub3QgdXNlIHJlZ2V4IGdsb2JhbCBmbGFnIHNpbmNlIGl0IGRvZXNuJ3Qgd29yayBpbiBJRTUNCgkJd2hpbGUgKChyZXN1bHQgPSByZWdleC5leGVjKHNlYXJjaFN0cmluZykpKSB7DQoJCQl2YXIgbWF0Y2hlZFN0cmluZyA9IHJlc3VsdFswXTsNCgkJCXZhciBwYWRkaW5nID0gcmVzdWx0WzFdOw0KCQkJdmFyIHRydW5jYXRpb24gPSByZXN1bHRbMl07DQoJCQl2YXIgY29udmVyc2lvbkNoYXJhY3RlciA9IHJlc3VsdFszXTsNCgkJCXZhciBzcGVjaWZpZXIgPSByZXN1bHRbNV07DQoJCQl2YXIgdGV4dCA9IHJlc3VsdFs2XTsNCg0KCQkJLy8gQ2hlY2sgaWYgdGhlIHBhdHRlcm4gbWF0Y2hlZCB3YXMganVzdCBub3JtYWwgdGV4dA0KCQkJaWYgKHRleHQpIHsNCgkJCQlmb3JtYXR0ZWRTdHJpbmcgKz0gIiIgKyB0ZXh0Ow0KCQkJfSBlbHNlIHsNCgkJCQkvLyBDcmVhdGUgYSByYXcgcmVwbGFjZW1lbnQgc3RyaW5nIGJhc2VkIG9uIHRoZSBjb252ZXJzaW9uDQoJCQkJLy8gY2hhcmFjdGVyIGFuZCBzcGVjaWZpZXINCgkJCQl2YXIgcmVwbGFjZW1lbnQgPSAiIjsNCgkJCQlzd2l0Y2goY29udmVyc2lvbkNoYXJhY3Rlcikgew0KCQkJCQljYXNlICJjIjoNCgkJCQkJCXZhciBsb2dnZXJOYW1lID0gbG9nZ2luZ0V2ZW50LmNhdGVnb3J5TmFtZTsNCgkJCQkJCWlmIChzcGVjaWZpZXIpIHsNCgkJCQkJCQl2YXIgcHJlY2lzaW9uID0gcGFyc2VJbnQoc3BlY2lmaWVyLCAxMCk7DQoJCQkJCQkJdmFyIGxvZ2dlck5hbWVCaXRzID0gbG9nZ2luZ0V2ZW50LmNhdGVnb3J5TmFtZS5zcGxpdCgiLiIpOw0KCQkJCQkJCWlmIChwcmVjaXNpb24gPj0gbG9nZ2VyTmFtZUJpdHMubGVuZ3RoKSB7DQoJCQkJCQkJCXJlcGxhY2VtZW50ID0gbG9nZ2VyTmFtZTsNCgkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQlyZXBsYWNlbWVudCA9IGxvZ2dlck5hbWVCaXRzLnNsaWNlKGxvZ2dlck5hbWVCaXRzLmxlbmd0aCAtIHByZWNpc2lvbikuam9pbigiLiIpOw0KCQkJCQkJCX0NCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJcmVwbGFjZW1lbnQgPSBsb2dnZXJOYW1lOw0KCQkJCQkJfQ0KCQkJCQkJYnJlYWs7DQoJCQkJCWNhc2UgImQiOg0KCQkJCQkJdmFyIGRhdGVGb3JtYXQgPSBMb2c0anMuUGF0dGVybkxheW91dC5JU084NjAxX0RBVEVGT1JNQVQ7DQoJCQkJCQlpZiAoc3BlY2lmaWVyKSB7DQoJCQkJCQkJZGF0ZUZvcm1hdCA9IHNwZWNpZmllcjsNCgkJCQkJCQkvLyBQaWNrIHVwIHNwZWNpYWwgY2FzZXMNCgkJCQkJCQlpZiAoZGF0ZUZvcm1hdCA9PSAiSVNPODYwMSIpIHsNCgkJCQkJCQkJZGF0ZUZvcm1hdCA9IExvZzRqcy5QYXR0ZXJuTGF5b3V0LklTTzg2MDFfREFURUZPUk1BVDsNCgkJCQkJCQl9IGVsc2UgaWYgKGRhdGVGb3JtYXQgPT0gIkFCU09MVVRFIikgew0KCQkJCQkJCQlkYXRlRm9ybWF0ID0gTG9nNGpzLlBhdHRlcm5MYXlvdXQuQUJTT0xVVEVUSU1FX0RBVEVGT1JNQVQ7DQoJCQkJCQkJfSBlbHNlIGlmIChkYXRlRm9ybWF0ID09ICJEQVRFIikgew0KCQkJCQkJCQlkYXRlRm9ybWF0ID0gTG9nNGpzLlBhdHRlcm5MYXlvdXQuREFURVRJTUVfREFURUZPUk1BVDsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCQkvLyBGb3JtYXQgdGhlIGRhdGUNCgkJCQkJCXJlcGxhY2VtZW50ID0gKG5ldyBMb2c0anMuU2ltcGxlRGF0ZUZvcm1hdChkYXRlRm9ybWF0KSkuZm9ybWF0KGxvZ2dpbmdFdmVudC5zdGFydFRpbWUpOw0KCQkJCQkJYnJlYWs7DQoJCQkJCWNhc2UgIm0iOg0KCQkJCQkJcmVwbGFjZW1lbnQgPSBsb2dnaW5nRXZlbnQubWVzc2FnZTsNCgkJCQkJCWJyZWFrOw0KCQkJCQljYXNlICJuIjoNCgkJCQkJCXJlcGxhY2VtZW50ID0gIlxuIjsNCgkJCQkJCWJyZWFrOw0KCQkJCQljYXNlICJwIjoNCgkJCQkJCXJlcGxhY2VtZW50ID0gbG9nZ2luZ0V2ZW50LmxldmVsLnRvU3RyaW5nKCk7DQoJCQkJCQlicmVhazsNCgkJCQkJY2FzZSAiciI6DQoJCQkJCQlyZXBsYWNlbWVudCA9ICIiICsgbG9nZ2luZ0V2ZW50LnN0YXJ0VGltZS50b0xvY2FsZVRpbWVTdHJpbmcoKTsgLy9UT0RPOiAuZ2V0RGlmZmVyZW5jZShMb2c0anMuYXBwbGljYXRpb25TdGFydERhdGUpOw0KCQkJCQkJYnJlYWs7DQoJCQkJCWNhc2UgIiUiOg0KCQkJCQkJcmVwbGFjZW1lbnQgPSAiJSI7DQoJCQkJCQlicmVhazsNCgkJCQkJZGVmYXVsdDoNCgkJCQkJCXJlcGxhY2VtZW50ID0gbWF0Y2hlZFN0cmluZzsNCgkJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCQkvLyBGb3JtYXQgdGhlIHJlcGxhY2VtZW50IGFjY29yZGluZyB0byBhbnkgcGFkZGluZyBvcg0KCQkJCS8vIHRydW5jYXRpb24gc3BlY2lmaWVkDQoNCgkJCQl2YXIgbGVuOw0KDQoJCQkJLy8gRmlyc3QsIHRydW5jYXRpb24NCgkJCQlpZiAodHJ1bmNhdGlvbikgew0KCQkJCQlsZW4gPSBwYXJzZUludCh0cnVuY2F0aW9uLnN1YnN0cigxKSwgMTApOw0KCQkJCQlyZXBsYWNlbWVudCA9IHJlcGxhY2VtZW50LnN1YnN0cmluZygwLCBsZW4pOw0KCQkJCX0NCgkJCQkvLyBOZXh0LCBwYWRkaW5nDQoJCQkJaWYgKHBhZGRpbmcpIHsNCgkJCQkJaWYgKHBhZGRpbmcuY2hhckF0KDApID09ICItIikgew0KCQkJCQkJbGVuID0gcGFyc2VJbnQocGFkZGluZy5zdWJzdHIoMSksIDEwKTsNCgkJCQkJCS8vIFJpZ2h0IHBhZCB3aXRoIHNwYWNlcw0KCQkJCQkJd2hpbGUgKHJlcGxhY2VtZW50Lmxlbmd0aCA8IGxlbikgew0KCQkJCQkJCXJlcGxhY2VtZW50ICs9ICIgIjsNCgkJCQkJCX0NCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWxlbiA9IHBhcnNlSW50KHBhZGRpbmcsIDEwKTsNCgkJCQkJCS8vIExlZnQgcGFkIHdpdGggc3BhY2VzDQoJCQkJCQl3aGlsZSAocmVwbGFjZW1lbnQubGVuZ3RoIDwgbGVuKSB7DQoJCQkJCQkJcmVwbGFjZW1lbnQgPSAiICIgKyByZXBsYWNlbWVudDsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCQlmb3JtYXR0ZWRTdHJpbmcgKz0gcmVwbGFjZW1lbnQ7DQoJCQl9DQoJCQlzZWFyY2hTdHJpbmcgPSBzZWFyY2hTdHJpbmcuc3Vic3RyKHJlc3VsdC5pbmRleCArIHJlc3VsdFswXS5sZW5ndGgpOw0KCQl9DQoJCXJldHVybiBmb3JtYXR0ZWRTdHJpbmc7DQoJfQ0KfSk7DQoNCi8qKg0KICogQHByaXZhdGUNCiAqIEBpZ25vcmUNCiAqLw0KaWYgKCFBcnJheS5wcm90b3R5cGUucHVzaCkgew0KCS8qKg0KCSAqIEZ1bmN0aW9ucyB0YWtlbiBmcm9tIFByb3RvdHlwZSBsaWJyYXJ5LCBkaWRuJ3Qgd2FudCB0byByZXF1aXJlIGZvciBqdXN0IGZldyANCgkgKiBmdW5jdGlvbnMuDQoJICogTW9yZSBpbmZvIGF0IHtAbGluayBodHRwOi8vcHJvdG90eXBlLmNvbmlvLm5ldC99DQoJICogQHByaXZhdGUNCgkgKi8NCglBcnJheS5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgc3RhcnRMZW5ndGggPSB0aGlzLmxlbmd0aDsNCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsNCgkJCXRoaXNbc3RhcnRMZW5ndGggKyBpXSA9IGFyZ3VtZW50c1tpXTsNCgkJfQ0KCQlyZXR1cm4gdGhpcy5sZW5ndGg7DQoJfTsNCn0NCg0KLyoqDQogKiBGSUZPIGJ1ZmZlcg0KICogQGNvbnN0cnVjdG9yDQogKiBAcHJpdmF0ZQ0KICovDQpMb2c0anMuRmlmb0J1ZmZlciA9IGZ1bmN0aW9uKCkNCnsNCiAgdGhpcy5hcnJheSA9IG5ldyBBcnJheSgpOw0KfTsNCg0KTG9nNGpzLkZpZm9CdWZmZXIucHJvdG90eXBlID0gew0KDQoJLyoqDQoJICogQHBhcmFtIHtPYmplY3R9IG9iaiBhbnkgb2JqZWN0IGFkZGVkIHRvIGJ1ZmZlcg0KCSAqLw0KCXB1c2ggOiBmdW5jdGlvbihvYmopIHsNCiAgICAgICAgdGhpcy5hcnJheVt0aGlzLmFycmF5Lmxlbmd0aF0gPSBvYmo7DQogICAgICAgIHJldHVybiB0aGlzLmFycmF5Lmxlbmd0aDsNCgl9LA0KCQ0KCS8qKg0KCSAqIEByZXR1cm4gZmlyc3QgcHV0dGVkIGluIE9iamVjdA0KCSAqLw0KCXB1bGwgOiBmdW5jdGlvbigpIHsNCgkJaWYgKHRoaXMuYXJyYXkubGVuZ3RoID4gMCkgew0KCQkJdmFyIGZpcnN0SXRlbSA9IHRoaXMuYXJyYXlbMF07DQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYXJyYXkubGVuZ3RoIC0gMTsgaSsrKSB7DQoJCQkJdGhpcy5hcnJheVtpXSA9IHRoaXMuYXJyYXlbaSArIDFdOw0KCQkJfQ0KCQkJdGhpcy5hcnJheS5sZW5ndGggPSB0aGlzLmFycmF5Lmxlbmd0aCAtIDE7DQoJCQlyZXR1cm4gZmlyc3RJdGVtOw0KCQl9DQoJCXJldHVybiBudWxsOw0KCX0sDQoJDQoJbGVuZ3RoIDogZnVuY3Rpb24oKSB7DQoJCXJldHVybiB0aGlzLmFycmF5Lmxlbmd0aDsNCgl9DQp9Ow0KDQoNCg0KLyoqDQogKiBEYXRlIEZvcm1hdHRlcg0KICogYWRkWmVybygpIGFuZCBmb3JtYXREYXRlKCkgYXJlIGNvdXJ0ZXN5IG9mIE1pa2UgR29sZGluZzoNCiAqIGh0dHA6Ly93d3cubWlrZXppbGxhLmNvbS9leHAwMDE1Lmh0bWwNCiAqIEBjb25zdHJ1Y3Rvcg0KICovIA0KTG9nNGpzLkRhdGVGb3JtYXR0ZXIgPSBmdW5jdGlvbigpIHsNCglyZXR1cm47DQp9Ow0KLyoqDQogKiBkZWZhdWx0IGZvcm1hdCBvZiBkYXRlIChJU08tODYwMSkNCiAqIEBzdGF0aWMNCiAqIEBmaW5hbA0KICovDQpMb2c0anMuRGF0ZUZvcm1hdHRlci5ERUZBVUxUX0RBVEVfRk9STUFUID0gInl5eXktTU0tZGRUaGg6bW06c3NPIjsNCg0KDQpMb2c0anMuRGF0ZUZvcm1hdHRlci5wcm90b3R5cGUgPSB7DQoJLyoqDQoJICogRm9ybWF0cyB0aGUgZ2l2ZW4gZGF0ZSBieSB0aGUgZ2l2ZW4gcGF0dGVybi48YnIgLz4NCgkgKiBGb2xsb3dpbmcgc3dpdGNoZXMgYXJlIHN1cHBvcnRlZDoNCgkgKiA8dWw+DQoJICogPGxpPnl5eXk6IFRoZSB5ZWFyPC9saT4NCgkgKiA8bGk+TU06IHRoZSBtb250aDwvbGk+DQoJICogPGxpPmRkOiB0aGUgZGF5IG9mIG1vbnRoPGxpPg0KCSAqIDxsaT5oaDogdGhlIGhvdXI8bGk+DQoJICogPGxpPm1tOiBtaW51dGVzPC9saT4NCgkgKiA8bGk+TzogdGltZXpvbmUgb2Zmc2V0PC9saT4NCgkgKiA8L3VsPg0KCSAqIEBwYXJhbSB7RGF0ZX0gdkRhdGUgdGhlIGRhdGUgdG8gZm9ybWF0DQoJICogQHBhcmFtIHtTdHJpbmd9IHZGb3JtYXQgdGhlIGZvcm1hdCBwYXR0ZXJuDQoJICogQHJldHVybiB7U3RyaW5nfSBmb3JtYXR0ZWQgZGF0ZSBzdHJpbmcNCgkgKiBAc3RhdGljDQoJICovDQoJZm9ybWF0RGF0ZSA6IGZ1bmN0aW9uKHZEYXRlLCB2Rm9ybWF0KSB7DQoJICB2YXIgdkRheSA9IHRoaXMuYWRkWmVybyh2RGF0ZS5nZXREYXRlKCkpOw0KCSAgdmFyIHZNb250aCA9IHRoaXMuYWRkWmVybyh2RGF0ZS5nZXRNb250aCgpKzEpOw0KCSAgdmFyIHZZZWFyTG9uZyA9IHRoaXMuYWRkWmVybyh2RGF0ZS5nZXRGdWxsWWVhcigpKTsNCgkgIHZhciB2WWVhclNob3J0ID0gdGhpcy5hZGRaZXJvKHZEYXRlLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKS5zdWJzdHJpbmcoMyw0KSk7DQoJICB2YXIgdlllYXIgPSAodkZvcm1hdC5pbmRleE9mKCJ5eXl5Iik+LTE/dlllYXJMb25nOnZZZWFyU2hvcnQpOw0KCSAgdmFyIHZIb3VyICA9IHRoaXMuYWRkWmVybyh2RGF0ZS5nZXRIb3VycygpKTsNCgkgIHZhciB2TWludXRlID0gdGhpcy5hZGRaZXJvKHZEYXRlLmdldE1pbnV0ZXMoKSk7DQoJICB2YXIgdlNlY29uZCA9IHRoaXMuYWRkWmVybyh2RGF0ZS5nZXRTZWNvbmRzKCkpOw0KCSAgdmFyIHZUaW1lWm9uZSA9IHRoaXMuTyh2RGF0ZSk7DQoJICB2YXIgdkRhdGVTdHJpbmcgPSB2Rm9ybWF0LnJlcGxhY2UoL2RkL2csIHZEYXkpLnJlcGxhY2UoL01NL2csIHZNb250aCkucmVwbGFjZSgveXsxLDR9L2csIHZZZWFyKTsNCgkgIHZEYXRlU3RyaW5nID0gdkRhdGVTdHJpbmcucmVwbGFjZSgvaGgvZywgdkhvdXIpLnJlcGxhY2UoL21tL2csIHZNaW51dGUpLnJlcGxhY2UoL3NzL2csIHZTZWNvbmQpOw0KCSAgdkRhdGVTdHJpbmcgPSB2RGF0ZVN0cmluZy5yZXBsYWNlKC9PL2csIHZUaW1lWm9uZSk7DQoJICByZXR1cm4gdkRhdGVTdHJpbmc7DQoJfSwNCgkJDQoJLyoqDQoJICogQHByaXZhdGUNCgkgKiBAc3RhdGljDQoJICovDQoJYWRkWmVybyA6IGZ1bmN0aW9uKHZOdW1iZXIpIHsNCgkgIHJldHVybiAoKHZOdW1iZXIgPCAxMCkgPyAiMCIgOiAiIikgKyB2TnVtYmVyOw0KCX0sDQoJDQoJLyoqDQoJICogRm9ybWF0ZXMgdGhlIFRpbWVPZmZlc3QNCgkgKiBUaGFua3MgdG8gaHR0cDovL3d3dy5zdmVuZHRvZnRlLmNvbS9jb2RlL2RhdGVfZm9ybWF0Lw0KCSAqIEBwcml2YXRlDQoJICovDQoJTyA6IGZ1bmN0aW9uIChkYXRlKSB7DQoJCS8vIERpZmZlcmVuY2UgdG8gR3JlZW53aWNoIHRpbWUgKEdNVCkgaW4gaG91cnMNCgkJdmFyIG9zID0gTWF0aC5hYnMoZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpKTsNCgkJdmFyIGggPSBTdHJpbmcoTWF0aC5mbG9vcihvcy82MCkpOw0KCQl2YXIgbSA9IFN0cmluZyhvcyU2MCk7DQoJCWgubGVuZ3RoID09IDE/IGggPSAiMCIraDoxOw0KCQltLmxlbmd0aCA9PSAxPyBtID0gIjAiK206MTsNCgkJcmV0dXJuIGRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSA8IDAgPyAiKyIraCttIDogIi0iK2grbTsNCgl9DQp9Ow0KDQoNCi8qKg0KICogaW50ZXJuYWwgTG9nZ2VyIHRvIGJlIHVzZWQNCiAqIEBwcml2YXRlDQogKi8NCnZhciBsb2c0anNMb2dnZXIgPSBMb2c0anMuZ2V0TG9nZ2VyKCJMb2c0anMiKTsNCmxvZzRqc0xvZ2dlci5hZGRBcHBlbmRlcihuZXcgTG9nNGpzLkNvbnNvbGVBcHBlbmRlcigpKTsNCmxvZzRqc0xvZ2dlci5zZXRMZXZlbChMb2c0anMuTGV2ZWwuQUxMKTs=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 09:03:54 GMT",
                    "Content-Length": "68969",
                    "Date": "Fri, 07 Nov 2014 09:03:54 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}