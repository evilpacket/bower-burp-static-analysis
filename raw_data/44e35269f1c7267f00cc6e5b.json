{
    "url": "http://localhost:9999/I-Value/virtualgaia-scripts/scripts/jquery.tabs.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location.hash</b> and written to <b>$()</b> via the following statement:<ul><li>var toShow = $(location.hash);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/I-Value/virtualgaia-scripts/scripts/jquery.tabs.js",
                "path": "/I-Value/virtualgaia-scripts/scripts/jquery.tabs.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9JLVZhbHVlL3ZpcnR1YWxnYWlhLXNjcmlwdHMvc2NyaXB0cy9qcXVlcnkudGFicy5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMzI0NTcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFN1biwgMDkgTm92IDIwMTQgMDE6NTE6NTEgR01UDQpMYXN0LU1vZGlmaWVkOiBTdW4sIDA5IE5vdiAyMDE0IDAxOjUxOjUxIEdNVA0KDQovKioNCiAqIFRhYnMgLSBqUXVlcnkgcGx1Z2luIGZvciBhY2Nlc3NpYmxlLCB1bm9idHJ1c2l2ZSB0YWJzDQogKiBAcmVxdWlyZXMgalF1ZXJ5IHYxLjEuMQ0KICoNCiAqIGh0dHA6Ly9zdGlsYnVlcm8uZGUvdGFicy8NCiAqDQogKiBDb3B5cmlnaHQgKGMpIDIwMDYgS2xhdXMgSGFydGwgKHN0aWxidWVyby5kZSkNCiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBhbmQgR1BMIGxpY2Vuc2VzOg0KICogaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHANCiAqIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwuaHRtbA0KICoNCiAqIFZlcnNpb246IDIuNy40DQogKi8NCg0KKGZ1bmN0aW9uKCQpIHsgLy8gYmxvY2sgc2NvcGUNCg0KJC5leHRlbmQoew0KICAgIHRhYnM6IHsNCiAgICAgICAgcmVtb3RlQ291bnQ6IDAgLy8gVE9ETyBpbiBUYWJzIDMgdGhpcyBpcyBnb2luZyB0byBiZSBtb3JlIGNsZWFubHkgaW4gb25lIHNpbmdsZSBuYW1lc3BhY2UNCiAgICB9DQp9KTsNCg0KLyoqDQogKiBDcmVhdGUgYW4gYWNjZXNzaWJsZSwgdW5vYnRydXNpdmUgdGFiIGludGVyZmFjZSBiYXNlZCBvbiBhIHBhcnRpY3VsYXIgSFRNTCBzdHJ1Y3R1cmUuDQogKg0KICogVGhlIHVuZGVybHlpbmcgSFRNTCBoYXMgdG8gbG9vayBsaWtlIHRoaXM6DQogKg0KICogPGRpdiBpZD0iY29udGFpbmVyIj4NCiAqICAgICA8dWw+DQogKiAgICAgICAgIDxsaT48YSBocmVmPSIjZnJhZ21lbnQtMSI+U2VjdGlvbiAxPC9hPjwvbGk+DQogKiAgICAgICAgIDxsaT48YSBocmVmPSIjZnJhZ21lbnQtMiI+U2VjdGlvbiAyPC9hPjwvbGk+DQogKiAgICAgICAgIDxsaT48YSBocmVmPSIjZnJhZ21lbnQtMyI+U2VjdGlvbiAzPC9hPjwvbGk+DQogKiAgICAgPC91bD4NCiAqICAgICA8ZGl2IGlkPSJmcmFnbWVudC0xIj4NCiAqDQogKiAgICAgPC9kaXY+DQogKiAgICAgPGRpdiBpZD0iZnJhZ21lbnQtMiI+DQogKg0KICogICAgIDwvZGl2Pg0KICogICAgIDxkaXYgaWQ9ImZyYWdtZW50LTMiPg0KICoNCiAqICAgICA8L2Rpdj4NCiAqIDwvZGl2Pg0KICoNCiAqIEVhY2ggYW5jaG9yIGluIHRoZSB1bm9yZGVyZWQgbGlzdCBwb2ludHMgZGlyZWN0bHkgdG8gYSBzZWN0aW9uIGJlbG93IHJlcHJlc2VudGVkIGJ5IG9uZSBvZiB0aGUNCiAqIGRpdnMgKHRoZSBVUkkgaW4gdGhlIGFuY2hvcidzIGhyZWYgYXR0cmlidXRlIHJlZmVycyB0byB0aGUgZnJhZ21lbnQgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBpZCkuDQogKiBCZWNhdXNlIHN1Y2ggSFRNTCBzdHJ1Y3R1cmUgaXMgZnVsbHkgZnVuY3Rpb25hbCBvbiBpdHMgb3duLCBlLmcuIHdpdGhvdXQgSmF2YVNjcmlwdCwgdGhlIHRhYg0KICogaW50ZXJmYWNlIGlzIGFjY2Vzc2libGUgYW5kIHVub2J0cnVzaXZlLg0KICoNCiAqIEEgdGFiIGlzIGFsc28gYm9va21hcmthYmxlIHZpYSBoYXNoIGluIHRoZSBVUkwuIFVzZSB0aGUgSGlzdG9yeS9SZW1vdGUgcGx1Z2luIChUYWJzIHdpbGwNCiAqIGF1dG8tZGV0ZWN0IGl0cyBwcmVzZW5jZSkgdG8gZml4IHRoZSBiYWNrIChhbmQgZm9yd2FyZCkgYnV0dG9uLg0KICoNCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS50YWJzKCk7DQogKiBAZGVzYyBDcmVhdGUgYSBiYXNpYyB0YWIgaW50ZXJmYWNlLg0KICogQGV4YW1wbGUgJCgnI2NvbnRhaW5lcicpLnRhYnMoMik7DQogKiBAZGVzYyBDcmVhdGUgYSBiYXNpYyB0YWIgaW50ZXJmYWNlIHdpdGggdGhlIHNlY29uZCB0YWIgaW5pdGlhbGx5IGFjdGl2YXRlZC4NCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS50YWJzKHtkaXNhYmxlZDogWzMsIDRdfSk7DQogKiBAZGVzYyBDcmVhdGUgYSB0YWIgaW50ZXJmYWNlIHdpdGggdGhlIHRoaXJkIGFuZCBmb3VydGggdGFiIGJlaW5nIGRpc2FibGVkLg0KICogQGV4YW1wbGUgJCgnI2NvbnRhaW5lcicpLnRhYnMoe2Z4U2xpZGU6IHRydWV9KTsNCiAqIEBkZXNjIENyZWF0ZSBhIHRhYiBpbnRlcmZhY2UgdGhhdCB1c2VzIHNsaWRlIGRvd24vdXAgYW5pbWF0aW9ucyBmb3Igc2hvd2luZy9oaWRpbmcgdGFiDQogKiAgICAgICBjb250ZW50IHVwb24gdGFiIHN3aXRjaGluZy4NCiAqDQogKiBAcGFyYW0gTnVtYmVyIGluaXRpYWwgQW4gaW50ZWdlciBzcGVjaWZ5aW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgdGFiIChubyB6ZXJvLWJhc2VkIGluZGV4KSB0aGF0DQogKiAgICAgICAgICAgICAgICAgICAgICAgZ2V0cyBhY3RpdmF0ZWQgYXQgZmlyc3QgKG9uIHBhZ2UgbG9hZCkuIFR3byBhbHRlcm5hdGl2ZSB3YXlzIHRvIHNwZWNpZnkNCiAqICAgICAgICAgICAgICAgICAgICAgICB0aGUgYWN0aXZlIHRhYiB3aWxsIG92ZXJydWxlIHRoaXMgYXJndW1lbnQuIEZpcnN0IGEgbGkgZWxlbWVudA0KICogICAgICAgICAgICAgICAgICAgICAgIChyZXByZXNlbnRpbmcgb25lIHNpbmdsZSB0YWIpIGJlbG9uZ2luZyB0byB0aGUgc2VsZWN0ZWQgdGFiIGNsYXNzLCBlLmcuDQogKiAgICAgICAgICAgICAgICAgICAgICAgc2V0IHRoZSBzZWxlY3RlZCB0YWIgY2xhc3MgKGRlZmF1bHQ6ICJ0YWJzLXNlbGVjdGVkIiwgc2VlIG9wdGlvbg0KICogICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkQ2xhc3MpIGZvciBvbmUgb2YgdGhlIHVub3JkZXJlZCBsaSBlbGVtZW50cyBpbiB0aGUgSFRNTCBzb3VyY2UuDQogKiAgICAgICAgICAgICAgICAgICAgICAgSW4gYWRkaXRpb24gaWYgYSBmcmFnbWVudCBpZGVudGlmaWVyL2hhc2ggaW4gdGhlIFVSTCBvZiB0aGUgcGFnZSByZWZlcnMNCiAqICAgICAgICAgICAgICAgICAgICAgICB0byB0aGUgaWQgb2YgYSB0YWIgY29udGFpbmVyIG9mIGEgdGFiIGludGVyZmFjZSB0aGUgY29ycmVzcG9uZGluZyB0YWIgd2lsbA0KICogICAgICAgICAgICAgICAgICAgICAgIGJlIGFjdGl2YXRlZCBhbmQgYm90aCB0aGUgaW5pdGlhbCBhcmd1bWVudCBhcyB3ZWxsIGFzIGFuIGV2ZW50dWFsbHkNCiAqICAgICAgICAgICAgICAgICAgICAgICBkZWNsYXJlZCBjbGFzcyBhdHRyaWJ1dGUgd2lsbCBiZSBvdmVycnVsZWQuIERlZmF1bHRzIHRvIDEgaWYgb21pdHRlZC4NCiAqIEBwYXJhbSBPYmplY3Qgc2V0dGluZ3MgQW4gb2JqZWN0IGxpdGVyYWwgY29udGFpbmluZyBrZXkvdmFsdWUgcGFpcnMgdG8gcHJvdmlkZSBvcHRpb25hbCBzZXR0aW5ncy4NCiAqIEBvcHRpb24gQXJyYXk8TnVtYmVyPiBkaXNhYmxlZCBBbiBhcnJheSBjb250YWluaW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgdGFicyAobm8gemVyby1iYXNlZCBpbmRleCkNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0IHNob3VsZCBiZSBkaXNhYmxlZCBvbiBpbml0aWFsaXphdGlvbi4gRGVmYXVsdCB2YWx1ZTogbnVsbC4NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIHRhYiBjYW4gYWxzbyBiZSBkaXNhYmxlZCBieSBzaW1wbHkgYWRkaW5nIHRoZSBkaXNhYmxpbmcgY2xhc3MNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGVmYXVsdDogInRhYnMtZGlzYWJsZWQiLCBzZWUgb3B0aW9uIGRpc2FibGVkQ2xhc3MpIHRvIHRoZSBsaQ0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgcmVwcmVzZW50aW5nIHRoYXQgcGFydGljdWxhciB0YWIuDQogKiBAb3B0aW9uIEJvb2xlYW4gYm9va21hcmthYmxlIEJvb2xlYW4gZmxhZyBpbmRpY2F0aW5nIGlmIHN1cHBvcnQgZm9yIGJvb2ttYXJraW5nIGFuZCBoaXN0b3J5ICh2aWENCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdpbmcgaGFzaCBpbiB0aGUgVVJMIG9mIHRoZSBicm93c2VyKSBpcyBlbmFibGVkLiBEZWZhdWx0IHZhbHVlOg0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwgdW5sZXNzIHRoZSBIaXN0b3J5L1JlbW90ZSBwbHVnaW4gaXMgaW5jbHVkZWQuIEluIHRoYXQgY2FzZSB0aGUNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdCB2YWx1ZSBiZWNvbWVzIHRydWUuIEBzZWUgJC5hamF4SGlzdG9yeS5pbml0aWFsaXplDQogKiBAb3B0aW9uIEJvb2xlYW4gcmVtb3RlIEJvb2xlYW4gZmxhZyBpbmRpY2F0aW5nIHRoYXQgdGFiIGNvbnRlbnQgaGFzIHRvIGJlIGxvYWRlZCByZW1vdGVseSBmcm9tDQogKiAgICAgICAgICAgICAgICAgICAgICAgIHRoZSB1cmwgZ2l2ZW4gaW4gdGhlIGhyZWYgYXR0cmlidXRlIG9mIHRoZSB0YWIgbWVudSBhbmNob3IgZWxlbWVudHMuDQogKiBAb3B0aW9uIFN0cmluZyBzcGlubmVyIFRoZSBjb250ZW50IG9mIHRoaXMgc3RyaW5nIGlzIHNob3duIGluIGEgdGFiIHdoaWxlIHJlbW90ZSBjb250ZW50IGlzIGxvYWRpbmcuDQogKiAgICAgICAgICAgICAgICAgICAgICAgIEluc2VydCBwbGFpbiB0ZXh0IGFzIHdlbGwgYXMgYW4gaW1nIGhlcmUuIFRvIHR1cm4gb2ZmIHRoaXMgbm90aWZpY2F0aW9uDQogKiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MgYW4gZW1wdHkgc3RyaW5nIG9yIG51bGwuIERlZmF1bHQ6ICJMb2FkaW5nJiM4MjMwOyIuDQogKiBAb3B0aW9uIFN0cmluZyBoYXNoUHJlZml4IEEgU3RyaW5nIHRoYXQgaXMgdXNlZCBmb3IgY29uc3RydWN0aW5nIHRoZSBoYXNoIHRoZSBsaW5rJ3MgaHJlZiBhdHRyaWJ1dGUNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgb2YgYSByZW1vdGUgdGFiIGdldHMgYWx0ZXJlZCB0bywgc3VjaCBhcyAiI3JlbW90ZS0xIi4NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogInJlbW90ZS10YWItIi4NCiAqIEBvcHRpb24gQm9vbGVhbiBmeEZhZGUgQm9vbGVhbiBmbGFnIGluZGljYXRpbmcgd2hldGhlciBmYWRlIGluL291dCBhbmltYXRpb25zIGFyZSB1c2VkIGZvciB0YWINCiAqICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoaW5nLiBDYW4gYmUgY29tYmluZWQgd2l0aCBmeFNsaWRlLiBXaWxsIG92ZXJydWxlIGZ4U2hvdy9meEhpZGUuDQogKiAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6IGZhbHNlLg0KICogQG9wdGlvbiBCb29sZWFuIGZ4U2xpZGUgQm9vbGVhbiBmbGFnIGluZGljYXRpbmcgd2hldGhlciBzbGlkZSBkb3duL3VwIGFuaW1hdGlvbnMgYXJlIHVzZWQgZm9yIHRhYg0KICogICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoaW5nLiBDYW4gYmUgY29tYmluZWQgd2l0aCBmeEZhZGUuIFdpbGwgb3ZlcnJ1bGUgZnhTaG93L2Z4SGlkZS4NCiAqICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6IGZhbHNlLg0KICogQG9wdGlvbiBTdHJpbmd8TnVtYmVyIGZ4U3BlZWQgQSBzdHJpbmcgcmVwcmVzZW50aW5nIG9uZSBvZiB0aGUgdGhyZWUgcHJlZGVmaW5lZCBzcGVlZHMgKCJzbG93IiwNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJub3JtYWwiLCBvciAiZmFzdCIpIG9yIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIChlLmcuIDEwMDApIHRvDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydW4gYW4gYW5pbWF0aW9uLiBEZWZhdWx0IHZhbHVlOiAibm9ybWFsIi4NCiAqIEBvcHRpb24gT2JqZWN0IGZ4U2hvdyBBbiBvYmplY3QgbGl0ZXJhbCBvZiB0aGUgZm9ybSBqUXVlcnkncyBhbmltYXRlIGZ1bmN0aW9uIGV4cGVjdHMgZm9yIG1ha2luZw0KICogICAgICAgICAgICAgICAgICAgICAgIHlvdXIgb3duLCBjdXN0b20gYW5pbWF0aW9uIHRvIHJldmVhbCBhIHRhYiB1cG9uIHRhYiBzd2l0Y2guIFVubGlrZSBmeEZhZGUNCiAqICAgICAgICAgICAgICAgICAgICAgICBvciBmeFNsaWRlIHRoaXMgYW5pbWF0aW9uIGlzIGluZGVwZW5kZW50IGZyb20gYW4gb3B0aW9uYWwgaGlkZSBhbmltYXRpb24uDQogKiAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogbnVsbC4gQHNlZSBhbmltYXRlDQogKiBAb3B0aW9uIE9iamVjdCBmeEhpZGUgQW4gb2JqZWN0IGxpdGVyYWwgb2YgdGhlIGZvcm0galF1ZXJ5J3MgYW5pbWF0ZSBmdW5jdGlvbiBleHBlY3RzIGZvciBtYWtpbmcNCiAqICAgICAgICAgICAgICAgICAgICAgICB5b3VyIG93biwgY3VzdG9tIGFuaW1hdGlvbiB0byBoaWRlIGEgdGFiIHVwb24gdGFiIHN3aXRjaC4gVW5saWtlIGZ4RmFkZQ0KICogICAgICAgICAgICAgICAgICAgICAgIG9yIGZ4U2xpZGUgdGhpcyBhbmltYXRpb24gaXMgaW5kZXBlbmRlbnQgZnJvbSBhbiBvcHRpb25hbCBzaG93IGFuaW1hdGlvbi4NCiAqICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlOiBudWxsLiBAc2VlIGFuaW1hdGUNCiAqIEBvcHRpb24gU3RyaW5nfE51bWJlciBmeFNob3dTcGVlZCBBIHN0cmluZyByZXByZXNlbnRpbmcgb25lIG9mIHRoZSB0aHJlZSBwcmVkZWZpbmVkIHNwZWVkcw0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgic2xvdyIsICJub3JtYWwiLCBvciAiZmFzdCIpIG9yIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUuZy4gMTAwMCkgdG8gcnVuIHRoZSBhbmltYXRpb24gc3BlY2lmaWVkIGluIGZ4U2hvdy4NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlOiBmeFNwZWVkLg0KICogQG9wdGlvbiBTdHJpbmd8TnVtYmVyIGZ4SGlkZVNwZWVkIEEgc3RyaW5nIHJlcHJlc2VudGluZyBvbmUgb2YgdGhlIHRocmVlIHByZWRlZmluZWQgc3BlZWRzDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJzbG93IiwgIm5vcm1hbCIsIG9yICJmYXN0Iikgb3IgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZS5nLiAxMDAwKSB0byBydW4gdGhlIGFuaW1hdGlvbiBzcGVjaWZpZWQgaW4gZnhIaWRlLg0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6IGZ4U3BlZWQuDQogKiBAb3B0aW9uIEJvb2xlYW4gZnhBdXRvSGVpZ2h0IEJvb2xlYW4gZmxhZyB0aGF0IGlmIHNldCB0byB0cnVlIGNhdXNlcyBhbGwgdGFiIGhlaWdodHMNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gYmUgY29uc3RhbnQgKGJlaW5nIHRoZSBoZWlnaHQgb2YgdGhlIHRhbGxlc3QgdGFiKS4NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogZmFsc2UuDQogKiBAb3B0aW9uIEZ1bmN0aW9uIG9uQ2xpY2sgQSBmdW5jdGlvbiB0byBiZSBpbnZva2VkIHVwb24gdGFiIHN3aXRjaCwgaW1tZWRpYXRseSBhZnRlciBhIHRhYiBoYXMNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBiZWVuIGNsaWNrZWQsIGUuZy4gYmVmb3JlIHRoZSBvdGhlcidzIHRhYiBjb250ZW50IGdldHMgaGlkZGVuLiBUaGUNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRzIHBhc3NlZCB0aHJlZSBhcmd1bWVudHM6IHRoZSBmaXJzdCBvbmUgaXMgdGhlIGNsaWNrZWQNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICB0YWIgKGUuZy4gYW4gYW5jaG9yIGVsZW1lbnQpLCB0aGUgc2Vjb25kIG9uZSBpcyB0aGUgRE9NIGVsZW1lbnQNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluaW5nIHRoZSBjb250ZW50IG9mIHRoZSBjbGlja2VkIHRhYiAoZS5nLiB0aGUgZGl2KSwgdGhlIHRoaXJkDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnQgaXMgdGhlIG9uZSBvZiB0aGUgdGFiIHRoYXQgZ2V0cyBoaWRkZW4uIElmIHRoaXMgY2FsbGJhY2sNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIGZhbHNlLCB0aGUgdGFiIHN3aXRjaCBpcyBjYW5jZWxlZCAodXNlIHRvIGRpc2FsbG93IHRhYg0KICogICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaGluZyBmb3IgdGhlIHJlYXNvbiBvZiBhIGZhaWxlZCBmb3JtIHZhbGlkYXRpb24gZm9yIGV4YW1wbGUpLg0KICogICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6IG51bGwuDQogKiBAb3B0aW9uIEZ1bmN0aW9uIG9uSGlkZSBBIGZ1bmN0aW9uIHRvIGJlIGludm9rZWQgdXBvbiB0YWIgc3dpdGNoLCBpbW1lZGlhdGx5IGFmdGVyIG9uZSB0YWIncw0KICogICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCBnb3QgaGlkZGVuICh3aXRoIG9yIHdpdGhvdXQgYW4gYW5pbWF0aW9uKSBhbmQgcmlnaHQgYmVmb3JlIHRoZQ0KICogICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCB0YWIgaXMgcmV2ZWFsZWQuIFRoZSBmdW5jdGlvbiBnZXRzIHBhc3NlZCB0aHJlZSBhcmd1bWVudHM6IHRoZQ0KICogICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Qgb25lIGlzIHRoZSBjbGlja2VkIHRhYiAoZS5nLiBhbiBhbmNob3IgZWxlbWVudCksIHRoZSBzZWNvbmQgb25lDQogKiAgICAgICAgICAgICAgICAgICAgICAgICBpcyB0aGUgRE9NIGVsZW1lbnQgY29udGFpbmluZyB0aGUgY29udGVudCBvZiB0aGUgY2xpY2tlZCB0YWIsIChlLmcuIHRoZQ0KICogICAgICAgICAgICAgICAgICAgICAgICAgZGl2KSwgdGhlIHRoaXJkIGFyZ3VtZW50IGlzIHRoZSBvbmUgb2YgdGhlIHRhYiB0aGF0IGdldHMgaGlkZGVuLg0KICogICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogbnVsbC4NCiAqIEBvcHRpb24gRnVuY3Rpb24gb25TaG93IEEgZnVuY3Rpb24gdG8gYmUgaW52b2tlZCB1cG9uIHRhYiBzd2l0Y2guIFRoaXMgZnVuY3Rpb24gaXMgaW52b2tlZA0KICogICAgICAgICAgICAgICAgICAgICAgICAgYWZ0ZXIgdGhlIG5ldyB0YWIgaGFzIGJlZW4gcmV2ZWFsZWQsIGUuZy4gYWZ0ZXIgdGhlIHN3aXRjaCBpcyBjb21wbGV0ZWQuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgZnVuY3Rpb24gZ2V0cyBwYXNzZWQgdGhyZWUgYXJndW1lbnRzOiB0aGUgZmlyc3Qgb25lIGlzIHRoZSBjbGlja2VkDQogKiAgICAgICAgICAgICAgICAgICAgICAgICB0YWIgKGUuZy4gYW4gYW5jaG9yIGVsZW1lbnQpLCB0aGUgc2Vjb25kIG9uZSBpcyB0aGUgRE9NIGVsZW1lbnQNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5pbmcgdGhlIGNvbnRlbnQgb2YgdGhlIGNsaWNrZWQgdGFiLCAoZS5nLiB0aGUgZGl2KSwgdGhlIHRoaXJkDQogKiAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudCBpcyB0aGUgb25lIG9mIHRoZSB0YWIgdGhhdCBnZXRzIGhpZGRlbi4gRGVmYXVsdCB2YWx1ZTogbnVsbC4NCiAqIEBvcHRpb24gU3RyaW5nIG5hdkNsYXNzIEEgQ1NTIGNsYXNzIHRoYXQgaXMgdXNlZCB0byBpZGVudGlmeSB0aGUgdGFicyB1bm9yZGVyZWQgbGlzdCBieSBjbGFzcyBpZg0KICogICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHJlcXVpcmVkIEhUTUwgc3RydWN0dXJlIGRpZmZlcnMgZnJvbSB0aGUgZGVmYXVsdCBvbmUuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlOiAidGFicy1uYXYiLg0KICogQG9wdGlvbiBTdHJpbmcgc2VsZWN0ZWRDbGFzcyBUaGUgQ1NTIGNsYXNzIGF0dGFjaGVkIHRvIHRoZSBsaSBlbGVtZW50IHJlcHJlc2VudGluZyB0aGUNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudGx5IHNlbGVjdGVkIChhY3RpdmUpIHRhYi4gRGVmYXVsdCB2YWx1ZTogInRhYnMtc2VsZWN0ZWQiLg0KICogQG9wdGlvbiBTdHJpbmcgZGlzYWJsZWRDbGFzcyBUaGUgQ1NTIGNsYXNzIGF0dGFjaGVkIHRvIHRoZSBsaSBlbGVtZW50IHJlcHJlc2VudGluZyBhIGRpc2FibGVkDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYi4gRGVmYXVsdCB2YWx1ZTogInRhYnMtZGlzYWJsZWQiLg0KICogQG9wdGlvbiBTdHJpbmcgY29udGFpbmVyQ2xhc3MgQSBDU1MgY2xhc3MgdGhhdCBpcyB1c2VkIHRvIGlkZW50aWZ5IHRhYiBjb250YWluZXJzIGJ5IGNsYXNzIGlmDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgcmVxdWlyZWQgSFRNTCBzdHJ1Y3R1cmUgZGlmZmVycyBmcm9tIHRoZSBkZWZhdWx0IG9uZS4NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6ICJ0YWJzLWNvbnRhaW5lciIuDQogKiBAb3B0aW9uIFN0cmluZyBoaWRlQ2xhc3MgVGhlIENTUyBjbGFzcyB1c2VkIGZvciBoaWRpbmcgaW5hY3RpdmUgdGFicy4gQSBjbGFzcyBpcyB1c2VkIGluc3RlYWQNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBvZiAiZGlzcGxheTogbm9uZSIgaW4gdGhlIHN0eWxlIGF0dHJpYnV0ZSB0byBtYWludGFpbiBjb250cm9sIG92ZXINCiAqICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5IGluIG90aGVyIG1lZGlhIHR5cGVzIHRoYW4gc2NyZWVuLCBtb3N0IG5vdGFibHkgcHJpbnQuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogInRhYnMtaGlkZSIuDQogKiBAb3B0aW9uIFN0cmluZyBsb2FkaW5nQ2xhc3MgVGhlIENTUyBjbGFzcyB1c2VkIGZvciBpbmRpY2F0aW5nIHRoYXQgYW4gQWpheCB0YWIgaXMgY3VycmVudGx5DQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZywgZm9yIGV4YW1wbGUgYnkgc2hvd2luZyBhIHNwaW5uZXIuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogInRhYnMtbG9hZGluZyIuDQogKiBAb3B0aW9uIFN0cmluZyB0YWJTdHJ1Y3QgQGRlcHJlY2F0ZWQgQSBDU1Mgc2VsZWN0b3Igb3IgYmFzaWMgWFBhdGggZXhwcmVzc2lvbiByZWZsZWN0aW5nIGENCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBuZXN0ZWQgSFRNTCBzdHJ1Y3R1cmUgdGhhdCBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgZGVmYXVsdCBzaW5nbGUgZGl2DQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlIChvbmUgZGl2IHdpdGggYW4gaWQgaW5zaWRlIHRoZSBvdmVyYWxsIGNvbnRhaW5lciBob2xkcyBvbmUNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICB0YWIncyBjb250ZW50KS4gSWYgZm9yIGluc3RhbmNlIGFuIGFkZGl0aW9uYWwgZGl2IGlzIHJlcXVpcmVkIHRvIHdyYXANCiAqICAgICAgICAgICAgICAgICAgICAgICAgICB1cCB0aGUgc2V2ZXJhbCB0YWIgY29udGFpbmVycyBzdWNoIGEgc3RydWN0dXJlIGlzIGV4cHJlc3NlZCBieSAiZGl2PmRpdiIuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogImRpdiIuDQogKiBAdHlwZSBqUXVlcnkNCiAqDQogKiBAbmFtZSB0YWJzDQogKiBAY2F0IFBsdWdpbnMvVGFicw0KICogQGF1dGhvciBLbGF1cyBIYXJ0bC9rbGF1cy5oYXJ0bEBzdGlsYnVlcm8uZGUNCiAqLw0KJC5mbi50YWJzID0gZnVuY3Rpb24oaW5pdGlhbCwgc2V0dGluZ3MpIHsNCg0KICAgIC8vIHNldHRpbmdzDQogICAgaWYgKHR5cGVvZiBpbml0aWFsID09ICdvYmplY3QnKSBzZXR0aW5ncyA9IGluaXRpYWw7IC8vIG5vIGluaXRpYWwgdGFiIGdpdmVuIGJ1dCBhIHNldHRpbmdzIG9iamVjdA0KICAgIHNldHRpbmdzID0gJC5leHRlbmQoew0KICAgICAgICBpbml0aWFsOiAoaW5pdGlhbCAmJiB0eXBlb2YgaW5pdGlhbCA9PSAnbnVtYmVyJyAmJiBpbml0aWFsID4gMCkgPyAtLWluaXRpYWwgOiAwLA0KICAgICAgICBkaXNhYmxlZDogbnVsbCwNCiAgICAgICAgYm9va21hcmthYmxlOiAkLmFqYXhIaXN0b3J5ID8gdHJ1ZSA6IGZhbHNlLA0KICAgICAgICByZW1vdGU6IGZhbHNlLA0KICAgICAgICBzcGlubmVyOiAnTG9hZGluZyYjODIzMDsnLA0KICAgICAgICBoYXNoUHJlZml4OiAncmVtb3RlLXRhYi0nLA0KICAgICAgICBmeEZhZGU6IG51bGwsDQogICAgICAgIGZ4U2xpZGU6IG51bGwsDQogICAgICAgIGZ4U2hvdzogbnVsbCwNCiAgICAgICAgZnhIaWRlOiBudWxsLA0KICAgICAgICBmeFNwZWVkOiAnbm9ybWFsJywNCiAgICAgICAgZnhTaG93U3BlZWQ6IG51bGwsDQogICAgICAgIGZ4SGlkZVNwZWVkOiBudWxsLA0KICAgICAgICBmeEF1dG9IZWlnaHQ6IGZhbHNlLA0KICAgICAgICBvbkNsaWNrOiBudWxsLA0KICAgICAgICBvbkhpZGU6IG51bGwsDQogICAgICAgIG9uU2hvdzogbnVsbCwNCiAgICAgICAgbmF2Q2xhc3M6ICd0YWJzLW5hdicsDQogICAgICAgIHNlbGVjdGVkQ2xhc3M6ICd0YWJzLXNlbGVjdGVkJywNCiAgICAgICAgZGlzYWJsZWRDbGFzczogJ3RhYnMtZGlzYWJsZWQnLA0KICAgICAgICBjb250YWluZXJDbGFzczogJ3RhYnMtY29udGFpbmVyJywNCiAgICAgICAgaGlkZUNsYXNzOiAndGFicy1oaWRlJywNCiAgICAgICAgbG9hZGluZ0NsYXNzOiAndGFicy1sb2FkaW5nJywNCiAgICAgICAgdGFiU3RydWN0OiAnZGl2Jw0KICAgIH0sIHNldHRpbmdzIHx8IHt9KTsNCg0KICAgICQuYnJvd3Nlci5tc2llNiA9ICQuYnJvd3Nlci5tc2llICYmICgkLmJyb3dzZXIudmVyc2lvbiAmJiAkLmJyb3dzZXIudmVyc2lvbiA8IDcgfHwgL01TSUUgNi4wLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKTsgLy8gZG8gbm90IGNoZWNrIGZvciA2LjAgYWxvbmUsIHVzZXJBZ2VudCBpbiBXaW5kb3dzIFZpc3RhIGhhcyAiV2luZG93cyBOVCA2LjAiDQoNCiAgICAvLyBoZWxwZXIgdG8gcHJldmVudCBzY3JvbGwgdG8gZnJhZ21lbnQNCiAgICBmdW5jdGlvbiB1bkZvY3VzKCkgew0KICAgICAgICBzY3JvbGxUbygwLCAwKTsNCiAgICB9DQoNCiAgICAvLyBpbml0aWFsaXplIHRhYnMNCiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KDQogICAgICAgIC8vIHJlbWVtYmVyIHdyYXBwZXIgZm9yIGxhdGVyDQogICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzOw0KDQogICAgICAgIC8vIHNldHVwIG5hdg0KICAgICAgICB2YXIgbmF2ID0gJCgndWwuJyArIHNldHRpbmdzLm5hdkNsYXNzLCBjb250YWluZXIpOw0KICAgICAgICBuYXYgPSBuYXYuc2l6ZSgpICYmIG5hdiB8fCAkKCc+dWw6ZXEoMCknLCBjb250YWluZXIpOyAvLyBmYWxsYmFjayB0byBkZWZhdWx0IHN0cnVjdHVyZQ0KICAgICAgICB2YXIgdGFicyA9ICQoJ2EnLCBuYXYpOw0KDQogICAgICAgIC8vIHByZXBhcmUgcmVtb3RlIHRhYnMNCiAgICAgICAgaWYgKHNldHRpbmdzLnJlbW90ZSkgew0KICAgICAgICAgICAgdGFicy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHZhciBpZCA9IHNldHRpbmdzLmhhc2hQcmVmaXggKyAoKyskLnRhYnMucmVtb3RlQ291bnQpLCBoYXNoID0gJyMnICsgaWQsIHVybCA9IHRoaXMuaHJlZjsNCiAgICAgICAgICAgICAgICB0aGlzLmhyZWYgPSBoYXNoOw0KICAgICAgICAgICAgICAgICQoJzxkaXYgaWQ9IicgKyBpZCArICciIGNsYXNzPSInICsgc2V0dGluZ3MuY29udGFpbmVyQ2xhc3MgKyAnIj48L2Rpdj4nKS5hcHBlbmRUbyhjb250YWluZXIpOw0KDQogICAgICAgICAgICAgICAgJCh0aGlzKS5iaW5kKCdsb2FkUmVtb3RlVGFiJywgZnVuY3Rpb24oZSwgY2FsbGJhY2spIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyICQkID0gJCh0aGlzKS5hZGRDbGFzcyhzZXR0aW5ncy5sb2FkaW5nQ2xhc3MpLCBzcGFuID0gJCgnc3BhbicsIHRoaXMpWzBdLCB0YWJUaXRsZSA9IHNwYW4uaW5uZXJIVE1MOw0KICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3Muc3Bpbm5lcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBpZiBzcGlubmVyIGlzIGltYWdlDQogICAgICAgICAgICAgICAgICAgICAgICBzcGFuLmlubmVySFRNTCA9ICc8ZW0+JyArIHNldHRpbmdzLnNwaW5uZXIgKyAnPC9lbT4nOyAvLyBXQVJOSU5HOiBodG1sKC4uLikgY3Jhc2hlcyBTYWZhcmkgd2l0aCBqUXVlcnkgMS4xLjINCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyAvLyBUaW1lb3V0IGlzIGFnYWluIHJlcXVpcmVkIGluIElFLCAid2FpdCIgZm9yIGlkIGJlaW5nIHJlc3RvcmVkDQogICAgICAgICAgICAgICAgICAgICAgICAkKGhhc2gpLmxvYWQodXJsLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3Muc3Bpbm5lcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuLmlubmVySFRNTCA9IHRhYlRpdGxlOyAvLyBXQVJOSU5HOiBodG1sKC4uLikgY3Jhc2hlcyBTYWZhcmkgd2l0aCBqUXVlcnkgMS4xLjINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCQucmVtb3ZlQ2xhc3Moc2V0dGluZ3MubG9hZGluZ0NsYXNzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0sIDApOw0KICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHNldCB1cCBjb250YWluZXJzDQogICAgICAgIHZhciBjb250YWluZXJzID0gJCgnZGl2LicgKyBzZXR0aW5ncy5jb250YWluZXJDbGFzcywgY29udGFpbmVyKTsNCiAgICAgICAgY29udGFpbmVycyA9IGNvbnRhaW5lcnMuc2l6ZSgpICYmIGNvbnRhaW5lcnMgfHwgJCgnPicgKyBzZXR0aW5ncy50YWJTdHJ1Y3QsIGNvbnRhaW5lcik7IC8vIGZhbGxiYWNrIHRvIGRlZmF1bHQgc3RydWN0dXJlDQoNCiAgICAgICAgLy8gYXR0YWNoIGNsYXNzZXMgZm9yIHN0eWxpbmcgaWYgbm90IHByZXNlbnQNCiAgICAgICAgbmF2LmlzKCcuJyArIHNldHRpbmdzLm5hdkNsYXNzKSB8fCBuYXYuYWRkQ2xhc3Moc2V0dGluZ3MubmF2Q2xhc3MpOw0KICAgICAgICBjb250YWluZXJzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgJCQgPSAkKHRoaXMpOw0KICAgICAgICAgICAgJCQuaXMoJy4nICsgc2V0dGluZ3MuY29udGFpbmVyQ2xhc3MpIHx8ICQkLmFkZENsYXNzKHNldHRpbmdzLmNvbnRhaW5lckNsYXNzKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gdHJ5IHRvIHJldHJpZXZlIGFjdGl2ZSB0YWIgZnJvbSBjbGFzcyBpbiBIVE1MDQogICAgICAgIHZhciBoYXNTZWxlY3RlZENsYXNzID0gJCgnbGknLCBuYXYpLmluZGV4KCAkKCdsaS4nICsgc2V0dGluZ3Muc2VsZWN0ZWRDbGFzcywgbmF2KVswXSApOw0KICAgICAgICBpZiAoaGFzU2VsZWN0ZWRDbGFzcyA+PSAwKSB7DQogICAgICAgICAgIHNldHRpbmdzLmluaXRpYWwgPSBoYXNTZWxlY3RlZENsYXNzOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gdHJ5IHRvIHJldHJpZXZlIGFjdGl2ZSB0YWIgZnJvbSBoYXNoIGluIHVybCwgd2lsbCBvdmVycmlkZSBjbGFzcyBpbiBIVE1MDQogICAgICAgIGlmIChsb2NhdGlvbi5oYXNoKSB7DQogICAgICAgICAgICB0YWJzLmVhY2goZnVuY3Rpb24oaSkgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc2ggPT0gbG9jYXRpb24uaGFzaCkgew0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5pbml0aWFsID0gaTsNCiAgICAgICAgICAgICAgICAgICAgLy8gcHJldmVudCBwYWdlIHNjcm9sbCB0byBmcmFnbWVudA0KICAgICAgICAgICAgICAgICAgICBpZiAoKCQuYnJvd3Nlci5tc2llIHx8ICQuYnJvd3Nlci5vcGVyYSkgJiYgIXNldHRpbmdzLnJlbW90ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvU2hvdyA9ICQobG9jYXRpb24uaGFzaCk7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9TaG93SWQgPSB0b1Nob3cuYXR0cignaWQnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvU2hvdy5hdHRyKCdpZCcsICcnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9TaG93LmF0dHIoJ2lkJywgdG9TaG93SWQpOyAvLyByZXN0b3JlIGlkDQogICAgICAgICAgICAgICAgICAgICAgICB9LCA1MDApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHVuRm9jdXMoKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBicmVhaw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGlmICgkLmJyb3dzZXIubXNpZSkgew0KICAgICAgICAgICAgdW5Gb2N1cygpOyAvLyBmaXggSUUgZm9jdXNzaW5nIGJvdHRvbSBvZiB0aGUgcGFnZSBmb3Igc29tZSB1bmtub3duIHJlYXNvbg0KICAgICAgICB9DQoNCiAgICAgICAgLy8gaGlnaGxpZ2h0IHRhYiBhY2NvcmRpbmdseQ0KICAgICAgICBjb250YWluZXJzLmZpbHRlcignOmVxKCcgKyBzZXR0aW5ncy5pbml0aWFsICsgJyknKS5zaG93KCkuZW5kKCkubm90KCc6ZXEoJyArIHNldHRpbmdzLmluaXRpYWwgKyAnKScpLmFkZENsYXNzKHNldHRpbmdzLmhpZGVDbGFzcyk7DQogICAgICAgICQoJ2xpJywgbmF2KS5yZW1vdmVDbGFzcyhzZXR0aW5ncy5zZWxlY3RlZENsYXNzKS5lcShzZXR0aW5ncy5pbml0aWFsKS5hZGRDbGFzcyhzZXR0aW5ncy5zZWxlY3RlZENsYXNzKTsgLy8gd2UgbmVlZCB0byByZW1vdmUgY2xhc3NlcyBldmVudHVhbGx5IGlmIGhhc2ggdGFrZXMgcHJlY2VkZW5jZSBvdmVyIGNsYXNzDQogICAgICAgIC8vIHRyaWdnZXIgbG9hZCBvZiBpbml0aWFsIHRhYg0KICAgICAgICB0YWJzLmVxKHNldHRpbmdzLmluaXRpYWwpLnRyaWdnZXIoJ2xvYWRSZW1vdGVUYWInKS5lbmQoKTsNCg0KICAgICAgICAvLyBzZXR1cCBhdXRvIGhlaWdodA0KICAgICAgICBpZiAoc2V0dGluZ3MuZnhBdXRvSGVpZ2h0KSB7DQogICAgICAgICAgICAvLyBoZWxwZXINCiAgICAgICAgICAgIHZhciBfc2V0QXV0b0hlaWdodCA9IGZ1bmN0aW9uKHJlc2V0KSB7DQogICAgICAgICAgICAgICAgLy8gZ2V0IHRhYiBoZWlnaHRzIGluIHRvcCB0byBib3R0b20gb3JkZXJlZCBhcnJheQ0KICAgICAgICAgICAgICAgIHZhciBoZWlnaHRzID0gJC5tYXAoY29udGFpbmVycy5nZXQoKSwgZnVuY3Rpb24oZWwpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGgsIGpxID0gJChlbCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXNldCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQuYnJvd3Nlci5tc2llNikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLnJlbW92ZUV4cHJlc3Npb24oJ2JlaGF2aW91cicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLmhlaWdodCA9ICcnOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLm1pbkhlaWdodCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBoID0ganEuY3NzKHsnbWluLWhlaWdodCc6ICcnfSkuaGVpZ2h0KCk7IC8vIHVzZSBqUXVlcnkncyBoZWlnaHQoKSB0byBnZXQgaGlkZGVuIGVsZW1lbnQgdmFsdWVzDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBoID0ganEuaGVpZ2h0KCk7IC8vIHVzZSBqUXVlcnkncyBoZWlnaHQoKSB0byBnZXQgaGlkZGVuIGVsZW1lbnQgdmFsdWVzDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGg7DQogICAgICAgICAgICAgICAgfSkuc29ydChmdW5jdGlvbihhLCBiKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBiIC0gYTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBpZiAoJC5icm93c2VyLm1zaWU2KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcnMuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWluSGVpZ2h0ID0gaGVpZ2h0c1swXSArICdweCc7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLnNldEV4cHJlc3Npb24oJ2JlaGF2aW91cicsICd0aGlzLnN0eWxlLmhlaWdodCA9IHRoaXMubWluSGVpZ2h0ID8gdGhpcy5taW5IZWlnaHQgOiAiMXB4IicpOyAvLyB1c2luZyBhbiBleHByZXNzaW9uIHRvIG5vdCBtYWtlIHByaW50IHN0eWxlcyB1c2VsZXNzDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcnMuY3NzKHsnbWluLWhlaWdodCc6IGhlaWdodHNbMF0gKyAncHgnfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIC8vIGNhbGwgb25jZSBmb3IgaW5pdGlhbGl6YXRpb24NCiAgICAgICAgICAgIF9zZXRBdXRvSGVpZ2h0KCk7DQogICAgICAgICAgICAvLyB0cmlnZ2VyIGF1dG8gaGVpZ2h0IGFkanVzdG1lbnQgaWYgbmVlZGVkDQogICAgICAgICAgICB2YXIgY2FjaGVkV2lkdGggPSBjb250YWluZXIub2Zmc2V0V2lkdGg7DQogICAgICAgICAgICB2YXIgY2FjaGVkSGVpZ2h0ID0gY29udGFpbmVyLm9mZnNldEhlaWdodDsNCiAgICAgICAgICAgIHZhciB3YXRjaEZvbnRTaXplID0gJCgnI3RhYnMtd2F0Y2gtZm9udC1zaXplJykuZ2V0KDApIHx8ICQoJzxzcGFuIGlkPSJ0YWJzLXdhdGNoLWZvbnQtc2l6ZSI+TTwvc3Bhbj4nKS5jc3Moe2Rpc3BsYXk6ICdibG9jaycsIHBvc2l0aW9uOiAnYWJzb2x1dGUnLCB2aXNpYmlsaXR5OiAnaGlkZGVuJ30pLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLmdldCgwKTsNCiAgICAgICAgICAgIHZhciBjYWNoZWRGb250U2l6ZSA9IHdhdGNoRm9udFNpemUub2Zmc2V0SGVpZ2h0Ow0KICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRXaWR0aCA9IGNvbnRhaW5lci5vZmZzZXRXaWR0aDsNCiAgICAgICAgICAgICAgICB2YXIgY3VycmVudEhlaWdodCA9IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQ7DQogICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRGb250U2l6ZSA9IHdhdGNoRm9udFNpemUub2Zmc2V0SGVpZ2h0Ow0KICAgICAgICAgICAgICAgIGlmIChjdXJyZW50SGVpZ2h0ID4gY2FjaGVkSGVpZ2h0IHx8IGN1cnJlbnRXaWR0aCAhPSBjYWNoZWRXaWR0aCB8fCBjdXJyZW50Rm9udFNpemUgIT0gY2FjaGVkRm9udFNpemUpIHsNCiAgICAgICAgICAgICAgICAgICAgX3NldEF1dG9IZWlnaHQoKGN1cnJlbnRXaWR0aCA+IGNhY2hlZFdpZHRoIHx8IGN1cnJlbnRGb250U2l6ZSA8IGNhY2hlZEZvbnRTaXplKSk7IC8vIGlmIGhlaWdodHMgZ2V0cyBzbWFsbGVyIHJlc2V0IG1pbi1oZWlnaHQNCiAgICAgICAgICAgICAgICAgICAgY2FjaGVkV2lkdGggPSBjdXJyZW50V2lkdGg7DQogICAgICAgICAgICAgICAgICAgIGNhY2hlZEhlaWdodCA9IGN1cnJlbnRIZWlnaHQ7DQogICAgICAgICAgICAgICAgICAgIGNhY2hlZEZvbnRTaXplID0gY3VycmVudEZvbnRTaXplOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIDUwKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHNldHVwIGFuaW1hdGlvbnMNCiAgICAgICAgdmFyIHNob3dBbmltID0ge30sIGhpZGVBbmltID0ge30sIHNob3dTcGVlZCA9IHNldHRpbmdzLmZ4U2hvd1NwZWVkIHx8IHNldHRpbmdzLmZ4U3BlZWQsIGhpZGVTcGVlZCA9IHNldHRpbmdzLmZ4SGlkZVNwZWVkIHx8IHNldHRpbmdzLmZ4U3BlZWQ7DQogICAgICAgIGlmIChzZXR0aW5ncy5meFNsaWRlIHx8IHNldHRpbmdzLmZ4RmFkZSkgew0KICAgICAgICAgICAgaWYgKHNldHRpbmdzLmZ4U2xpZGUpIHsNCiAgICAgICAgICAgICAgICBzaG93QW5pbVsnaGVpZ2h0J10gPSAnc2hvdyc7DQogICAgICAgICAgICAgICAgaGlkZUFuaW1bJ2hlaWdodCddID0gJ2hpZGUnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHNldHRpbmdzLmZ4RmFkZSkgew0KICAgICAgICAgICAgICAgIHNob3dBbmltWydvcGFjaXR5J10gPSAnc2hvdyc7DQogICAgICAgICAgICAgICAgaGlkZUFuaW1bJ29wYWNpdHknXSA9ICdoaWRlJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChzZXR0aW5ncy5meFNob3cpIHsNCiAgICAgICAgICAgICAgICBzaG93QW5pbSA9IHNldHRpbmdzLmZ4U2hvdzsNCiAgICAgICAgICAgIH0gZWxzZSB7IC8vIHVzZSBzb21lIGtpbmQgb2YgYW5pbWF0aW9uIHRvIHByZXZlbnQgYnJvd3NlciBzY3JvbGxpbmcgdG8gdGhlIHRhYg0KICAgICAgICAgICAgICAgIHNob3dBbmltWydtaW4td2lkdGgnXSA9IDA7IC8vIGF2b2lkIG9wYWNpdHksIGNhdXNlcyBmbGlja2VyIGluIEZpcmVmb3gNCiAgICAgICAgICAgICAgICBzaG93U3BlZWQgPSAxOyAvLyBhcyBsaXR0bGUgYXMgMSBpcyBzdWZmaWNpZW50DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc2V0dGluZ3MuZnhIaWRlKSB7DQogICAgICAgICAgICAgICAgaGlkZUFuaW0gPSBzZXR0aW5ncy5meEhpZGU7DQogICAgICAgICAgICB9IGVsc2UgeyAvLyB1c2Ugc29tZSBraW5kIG9mIGFuaW1hdGlvbiB0byBwcmV2ZW50IGJyb3dzZXIgc2Nyb2xsaW5nIHRvIHRoZSB0YWINCiAgICAgICAgICAgICAgICBoaWRlQW5pbVsnbWluLXdpZHRoJ10gPSAwOyAvLyBhdm9pZCBvcGFjaXR5LCBjYXVzZXMgZmxpY2tlciBpbiBGaXJlZm94DQogICAgICAgICAgICAgICAgaGlkZVNwZWVkID0gMTsgLy8gYXMgbGl0dGxlIGFzIDEgaXMgc3VmZmljaWVudA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gY2FsbGJhY2tzDQogICAgICAgIHZhciBvbkNsaWNrID0gc2V0dGluZ3Mub25DbGljaywgb25IaWRlID0gc2V0dGluZ3Mub25IaWRlLCBvblNob3cgPSBzZXR0aW5ncy5vblNob3c7DQoNCiAgICAgICAgLy8gYXR0YWNoIGFjdGl2YXRlVGFiIGV2ZW50LCByZXF1aXJlZCBmb3IgYWN0aXZhdGluZyBhIHRhYiBwcm9ncmFtbWF0aWNhbGx5DQogICAgICAgIHRhYnMuYmluZCgndHJpZ2dlclRhYicsIGZ1bmN0aW9uKCkgew0KDQogICAgICAgICAgICAvLyBpZiB0aGUgdGFiIGlzIGFscmVhZHkgc2VsZWN0ZWQgb3IgZGlzYWJsZWQgb3IgYW5pbWF0aW9uIGlzIHN0aWxsIHJ1bm5pbmcgc3RvcCBoZXJlDQogICAgICAgICAgICB2YXIgbGkgPSAkKHRoaXMpLnBhcmVudHMoJ2xpOmVxKDApJyk7DQogICAgICAgICAgICBpZiAoY29udGFpbmVyLmxvY2tlZCB8fCBsaS5pcygnLicgKyBzZXR0aW5ncy5zZWxlY3RlZENsYXNzKSB8fCBsaS5pcygnLicgKyBzZXR0aW5ncy5kaXNhYmxlZENsYXNzKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIGhhc2ggPSB0aGlzLmhhc2g7DQoNCiAgICAgICAgICAgIGlmICgkLmJyb3dzZXIubXNpZSkgew0KDQogICAgICAgICAgICAgICAgJCh0aGlzKS50cmlnZ2VyKCdjbGljaycpOw0KICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5ib29rbWFya2FibGUpIHsNCiAgICAgICAgICAgICAgICAgICAgJC5hamF4SGlzdG9yeS51cGRhdGUoaGFzaCk7DQogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhhc2ggPSBoYXNoLnJlcGxhY2UoJyMnLCAnJyk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB9IGVsc2UgaWYgKCQuYnJvd3Nlci5zYWZhcmkpIHsNCg0KICAgICAgICAgICAgICAgIC8vIFNpbXBseSBzZXR0aW5nIGxvY2F0aW9uLmhhc2ggcHV0cyBTYWZhcmkgaW50byB0aGUgZXRlcm5hbCBsb2FkIHN0YXRlLi4uIHVnaCEgU3VibWl0IGEgZm9ybSBpbnN0ZWFkLg0KICAgICAgICAgICAgICAgIHZhciB0ZW1wRm9ybSA9ICQoJzxmb3JtIGFjdGlvbj0iJyArIGhhc2ggKyAnIj48ZGl2PjxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJoIiAvPjwvZGl2PjwvZm9ybT4nKS5nZXQoMCk7IC8vIG5vIG5lZWQgdG8gYXBwZW5kIGl0IHRvIHRoZSBib2R5DQogICAgICAgICAgICAgICAgdGVtcEZvcm0uc3VibWl0KCk7IC8vIGRvZXMgbm90IHRyaWdnZXIgdGhlIGZvcm0ncyBzdWJtaXQgZXZlbnQuLi4NCiAgICAgICAgICAgICAgICAkKHRoaXMpLnRyaWdnZXIoJ2NsaWNrJyk7IC8vIC4uLnRodXMgZG8gc3R1ZmYgaGVyZQ0KICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5ib29rbWFya2FibGUpIHsNCiAgICAgICAgICAgICAgICAgICAgJC5hamF4SGlzdG9yeS51cGRhdGUoaGFzaCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLmJvb2ttYXJrYWJsZSkgew0KICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5oYXNoID0gaGFzaC5yZXBsYWNlKCcjJywgJycpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICQodGhpcykudHJpZ2dlcignY2xpY2snKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0NCg0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBhdHRhY2ggZGlzYWJsZSBldmVudCwgcmVxdWlyZWQgZm9yIGRpc2FibGluZyBhIHRhYg0KICAgICAgICB0YWJzLmJpbmQoJ2Rpc2FibGVUYWInLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHZhciBsaSA9ICQodGhpcykucGFyZW50cygnbGk6ZXEoMCknKTsNCiAgICAgICAgICAgIGlmICgkLmJyb3dzZXIuc2FmYXJpKSB7IC8qIGZpeCBvcGFjaXR5IG9mIHRhYiBhZnRlciBkaXNhYmxpbmcgaW4gU2FmYXJpLi4uICovDQogICAgICAgICAgICAgICAgbGkuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMSwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgbGkuY3NzKHtvcGFjaXR5OiAnJ30pOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbGkuYWRkQ2xhc3Moc2V0dGluZ3MuZGlzYWJsZWRDbGFzcyk7DQoNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gZGlzYWJsZWQgZnJvbSBzZXR0aW5ncw0KICAgICAgICBpZiAoc2V0dGluZ3MuZGlzYWJsZWQgJiYgc2V0dGluZ3MuZGlzYWJsZWQubGVuZ3RoKSB7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgayA9IHNldHRpbmdzLmRpc2FibGVkLmxlbmd0aDsgaSA8IGs7IGkrKykgew0KICAgICAgICAgICAgICAgIHRhYnMuZXEoLS1zZXR0aW5ncy5kaXNhYmxlZFtpXSkudHJpZ2dlcignZGlzYWJsZVRhYicpLmVuZCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8vIGF0dGFjaCBlbmFibGUgZXZlbnQsIHJlcXVpcmVkIGZvciByZWVuYWJsaW5nIGEgdGFiDQogICAgICAgIHRhYnMuYmluZCgnZW5hYmxlVGFiJywgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgbGkgPSAkKHRoaXMpLnBhcmVudHMoJ2xpOmVxKDApJyk7DQogICAgICAgICAgICBsaS5yZW1vdmVDbGFzcyhzZXR0aW5ncy5kaXNhYmxlZENsYXNzKTsNCiAgICAgICAgICAgIGlmICgkLmJyb3dzZXIuc2FmYXJpKSB7IC8qIGZpeCBkaXNhcHBlYXJpbmcgdGFiIGFmdGVyIGVuYWJsaW5nIGluIFNhZmFyaS4uLiAqLw0KICAgICAgICAgICAgICAgIGxpLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDEsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBsaS5jc3Moe29wYWNpdHk6ICcnfSk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIGF0dGFjaCBjbGljayBldmVudA0KICAgICAgICB0YWJzLmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24oZSkgew0KDQogICAgICAgICAgICB2YXIgdHJ1ZUNsaWNrID0gZS5jbGllbnRYOyAvLyBhZGQgdG8gaGlzdG9yeSBvbmx5IGlmIHRydWUgY2xpY2sgb2NjdXJlZCwgbm90IGEgdHJpZ2dlcmVkIGNsaWNrDQogICAgICAgICAgICB2YXIgY2xpY2tlZCA9IHRoaXMsIGxpID0gJCh0aGlzKS5wYXJlbnRzKCdsaTplcSgwKScpLCB0b1Nob3cgPSAkKHRoaXMuaGFzaCksIHRvSGlkZSA9IGNvbnRhaW5lcnMuZmlsdGVyKCc6dmlzaWJsZScpOw0KDQogICAgICAgICAgICAvLyBpZiBhbmltYXRpb24gaXMgc3RpbGwgcnVubmluZywgdGFiIGlzIHNlbGVjdGVkIG9yIGRpc2FibGVkIG9yIG9uQ2xpY2sgY2FsbGJhY2sgcmV0dXJucyBmYWxzZSBzdG9wIGhlcmUNCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIG9uQ2xpY2sgcmV0dXJucyBmYWxzZSBsYXN0IHNvIHRoYXQgaXQgaXMgbm90IGV4ZWN1dGVkIGZvciBhIGRpc2FibGVkIHRhYg0KICAgICAgICAgICAgaWYgKGNvbnRhaW5lclsnbG9ja2VkJ10gfHwgbGkuaXMoJy4nICsgc2V0dGluZ3Muc2VsZWN0ZWRDbGFzcykgfHwgbGkuaXMoJy4nICsgc2V0dGluZ3MuZGlzYWJsZWRDbGFzcykgfHwgdHlwZW9mIG9uQ2xpY2sgPT0gJ2Z1bmN0aW9uJyAmJiBvbkNsaWNrKHRoaXMsIHRvU2hvd1swXSwgdG9IaWRlWzBdKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmJsdXIoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnRhaW5lclsnbG9ja2VkJ10gPSB0cnVlOw0KDQogICAgICAgICAgICAvLyBzaG93IG5ldyB0YWINCiAgICAgICAgICAgIGlmICh0b1Nob3cuc2l6ZSgpKSB7DQoNCiAgICAgICAgICAgICAgICAvLyBwcmV2ZW50IHNjcm9sbGJhciBzY3JvbGxpbmcgdG8gMCBhbmQgdGhhbiBiYWNrIGluIElFNywgaGFwcGVucyBvbmx5IGlmIGJvb2ttYXJraW5nL2hpc3RvcnkgaXMgZW5hYmxlZA0KICAgICAgICAgICAgICAgIGlmICgkLmJyb3dzZXIubXNpZSAmJiBzZXR0aW5ncy5ib29rbWFya2FibGUpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHRvU2hvd0lkID0gdGhpcy5oYXNoLnJlcGxhY2UoJyMnLCAnJyk7DQogICAgICAgICAgICAgICAgICAgIHRvU2hvdy5hdHRyKCdpZCcsICcnKTsNCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvU2hvdy5hdHRyKCdpZCcsIHRvU2hvd0lkKTsgLy8gcmVzdG9yZSBpZA0KICAgICAgICAgICAgICAgICAgICB9LCAwKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB2YXIgcmVzZXRDU1MgPSB7IGRpc3BsYXk6ICcnLCBvdmVyZmxvdzogJycsIGhlaWdodDogJycgfTsNCiAgICAgICAgICAgICAgICBpZiAoISQuYnJvd3Nlci5tc2llKSB7IC8vIG5vdCBpbiBJRSB0byBwcmV2ZW50IENsZWFyVHlwZSBmb250IGlzc3VlDQogICAgICAgICAgICAgICAgICAgIHJlc2V0Q1NTWydvcGFjaXR5J10gPSAnJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gc3dpdGNoIHRhYiwgYW5pbWF0aW9uIHByZXZlbnRzIGJyb3dzZXIgc2Nyb2xsaW5nIHRvIHRoZSBmcmFnbWVudA0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHN3aXRjaFRhYigpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLmJvb2ttYXJrYWJsZSAmJiB0cnVlQ2xpY2spIHsgLy8gYWRkIHRvIGhpc3Rvcnkgb25seSBpZiB0cnVlIGNsaWNrIG9jY3VyZWQsIG5vdCBhIHRyaWdnZXJlZCBjbGljaw0KICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4SGlzdG9yeS51cGRhdGUoY2xpY2tlZC5oYXNoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB0b0hpZGUuYW5pbWF0ZShoaWRlQW5pbSwgaGlkZVNwZWVkLCBmdW5jdGlvbigpIHsgLy8NCiAgICAgICAgICAgICAgICAgICAgICAgICQoY2xpY2tlZCkucGFyZW50cygnbGk6ZXEoMCknKS5hZGRDbGFzcyhzZXR0aW5ncy5zZWxlY3RlZENsYXNzKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKHNldHRpbmdzLnNlbGVjdGVkQ2xhc3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdG9IaWRlLmFkZENsYXNzKHNldHRpbmdzLmhpZGVDbGFzcykuY3NzKHJlc2V0Q1NTKTsgLy8gbWFpbnRhaW4gZmxleGlibGUgaGVpZ2h0IGFuZCBhY2Nlc3NpYmlsaXR5IGluIHByaW50IGV0Yy4gICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb25IaWRlID09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkhpZGUoY2xpY2tlZCwgdG9TaG93WzBdLCB0b0hpZGVbMF0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoc2V0dGluZ3MuZnhTbGlkZSB8fCBzZXR0aW5ncy5meEZhZGUgfHwgc2V0dGluZ3MuZnhTaG93KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvU2hvdy5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTsgLy8gcHJldmVudCBvY2Nhc2lvbmFsbHkgb2NjdXJpbmcgZmxpY2tlciBpbiBGaXJlZm94IGNhdXNlIGJ5IGdhcCBiZXR3ZWVuIHNob3dpbmcgYW5kIGhpZGluZyB0aGUgdGFiIGNvbnRhaW5lcnMNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHRvU2hvdy5hbmltYXRlKHNob3dBbmltLCBzaG93U3BlZWQsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvU2hvdy5yZW1vdmVDbGFzcyhzZXR0aW5ncy5oaWRlQ2xhc3MpLmNzcyhyZXNldENTUyk7IC8vIG1haW50YWluIGZsZXhpYmxlIGhlaWdodCBhbmQgYWNjZXNzaWJpbGl0eSBpbiBwcmludCBldGMuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQuYnJvd3Nlci5tc2llKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvSGlkZVswXS5zdHlsZS5maWx0ZXIgPSAnJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9TaG93WzBdLnN0eWxlLmZpbHRlciA9ICcnOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9uU2hvdyA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2hvdyhjbGlja2VkLCB0b1Nob3dbMF0sIHRvSGlkZVswXSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lclsnbG9ja2VkJ10gPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICghc2V0dGluZ3MucmVtb3RlKSB7DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaFRhYigpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICQoY2xpY2tlZCkudHJpZ2dlcignbG9hZFJlbW90ZVRhYicsIFtzd2l0Y2hUYWJdKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYWxlcnQoJ1RoZXJlIGlzIG5vIHN1Y2ggY29udGFpbmVyLicpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBTZXQgc2Nyb2xsYmFyIHRvIHNhdmVkIHBvc2l0aW9uIC0gbmVlZCB0byB1c2UgdGltZW91dCB3aXRoIDAgdG8gcHJldmVudCBicm93c2VyIHNjcm9sbCB0byB0YXJnZXQgb2YgaGFzaA0KICAgICAgICAgICAgdmFyIHNjcm9sbFggPSB3aW5kb3cucGFnZVhPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCB8fCAwOw0KICAgICAgICAgICAgdmFyIHNjcm9sbFkgPSB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgfHwgMDsNCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKHNjcm9sbFgsIHNjcm9sbFkpOw0KICAgICAgICAgICAgfSwgMCk7DQoNCiAgICAgICAgICAgIHRoaXMuYmx1cigpOyAvLyBwcmV2ZW50IElFIGZyb20ga2VlcGluZyBvdGhlciBsaW5rIGZvY3Vzc2VkIHdoZW4gdXNpbmcgdGhlIGJhY2sgYnV0dG9uDQoNCiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5ib29rbWFya2FibGUgJiYgISF0cnVlQ2xpY2s7IC8vIGNvbnZlcnQgdW5kZWZpbmVkIHRvIEJvb2xlYW4gZm9yIElFDQoNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gZW5hYmxlIGhpc3Rvcnkgc3VwcG9ydCBpZiBib29rbWFya2luZyBhbmQgaGlzdG9yeSBpcyB0dXJuZWQgb24NCiAgICAgICAgaWYgKHNldHRpbmdzLmJvb2ttYXJrYWJsZSkgew0KICAgICAgICAgICAgJC5hamF4SGlzdG9yeS5pbml0aWFsaXplKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHRhYnMuZXEoc2V0dGluZ3MuaW5pdGlhbCkudHJpZ2dlcignY2xpY2snKS5lbmQoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICB9KTsNCg0KfTsNCg0KLyoqDQogKiBBY3RpdmF0ZSBhIHRhYiBwcm9ncmFtbWF0aWNhbGx5IHdpdGggdGhlIGdpdmVuIHBvc2l0aW9uIChubyB6ZXJvLWJhc2VkIGluZGV4KQ0KICogb3IgaXRzIGlkLCBlLmcuIHRoZSBVUkwncyBmcmFnbWVudCBpZGVudGlmaWVyL2hhc2ggcmVwcmVzZW50aW5nIGEgdGFiLCBhcyBpZiB0aGUgdGFiDQogKiBpdHNlbGYgd2VyZSBjbGlja2VkLg0KICoNCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS50cmlnZ2VyVGFiKDIpOw0KICogQGRlc2MgQWN0aXZhdGUgdGhlIHNlY29uZCB0YWIgb2YgdGhlIHRhYiBpbnRlcmZhY2UgY29udGFpbmVkIGluIDxkaXYgaWQ9ImNvbnRhaW5lciI+Lg0KICogQGV4YW1wbGUgJCgnI2NvbnRhaW5lcicpLnRyaWdnZXJUYWIoMSk7DQogKiBAZGVzYyBBY3RpdmF0ZSB0aGUgZmlyc3QgdGFiIG9mIHRoZSB0YWIgaW50ZXJmYWNlIGNvbnRhaW5lZCBpbiA8ZGl2IGlkPSJjb250YWluZXIiPi4NCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS50cmlnZ2VyVGFiKCk7DQogKiBAZGVzYyBBY3RpdmF0ZSB0aGUgZmlyc3QgdGFiIG9mIHRoZSB0YWIgaW50ZXJmYWNlIGNvbnRhaW5lZCBpbiA8ZGl2IGlkPSJjb250YWluZXIiPi4NCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS50cmlnZ2VyVGFiKCdmcmFnbWVudC0yJyk7DQogKiBAZGVzYyBBY3RpdmF0ZSBhIHRhYiB2aWEgaXRzIFVSTCBmcmFnbWVudCBpZGVudGlmaWVyIHJlcHJlc2VudGF0aW9uLg0KICoNCiAqIEBwYXJhbSBTdHJpbmd8TnVtYmVyIHRhYiBFaXRoZXIgYSBzdHJpbmcgdGhhdCBtYXRjaGVzIHRoZSBpZCBvZiB0aGUgdGFiICh0aGUgVVJMJ3MNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCBpZGVudGlmaWVyL2hhc2ggcmVwcmVzZW50aW5nIGEgdGFiKSBvciBhbiBpbnRlZ2VyDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lmeWluZyB0aGUgcG9zaXRpb24gb2YgdGhlIHRhYiAobm8gemVyby1iYXNlZCBpbmRleCkgdG8NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBiZSBhY3RpdmF0ZWQuIElmIHRoaXMgcGFyYW1ldGVyIGlzIG9taXR0ZWQsIHRoZSBmaXJzdCB0YWINCiAqICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlIGFjdGl2YXRlZC4NCiAqIEB0eXBlIGpRdWVyeQ0KICoNCiAqIEBuYW1lIHRyaWdnZXJUYWINCiAqIEBjYXQgUGx1Z2lucy9UYWJzDQogKiBAYXV0aG9yIEtsYXVzIEhhcnRsL2tsYXVzLmhhcnRsQHN0aWxidWVyby5kZQ0KICovDQoNCi8qKg0KICogRGlzYWJsZSBhIHRhYiwgc28gdGhhdCBjbGlja2luZyBpdCBoYXMgbm8gZWZmZWN0Lg0KICoNCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS5kaXNhYmxlVGFiKDIpOw0KICogQGRlc2MgRGlzYWJsZSB0aGUgc2Vjb25kIHRhYiBvZiB0aGUgdGFiIGludGVyZmFjZSBjb250YWluZWQgaW4gPGRpdiBpZD0iY29udGFpbmVyIj4uDQogKg0KICogQHBhcmFtIFN0cmluZ3xOdW1iZXIgdGFiIEVpdGhlciBhIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGlkIG9mIHRoZSB0YWIgKHRoZSBVUkwncw0KICogICAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50IGlkZW50aWZpZXIvaGFzaCByZXByZXNlbnRpbmcgYSB0YWIpIG9yIGFuIGludGVnZXINCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZ5aW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgdGFiIChubyB6ZXJvLWJhc2VkIGluZGV4KSB0bw0KICogICAgICAgICAgICAgICAgICAgICAgICAgIGJlIGRpc2FibGVkLiBJZiB0aGlzIHBhcmFtZXRlciBpcyBvbWl0dGVkLCB0aGUgZmlyc3QgdGFiDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSBkaXNhYmxlZC4NCiAqIEB0eXBlIGpRdWVyeQ0KICoNCiAqIEBuYW1lIGRpc2FibGVUYWINCiAqIEBjYXQgUGx1Z2lucy9UYWJzDQogKiBAYXV0aG9yIEtsYXVzIEhhcnRsL2tsYXVzLmhhcnRsQHN0aWxidWVyby5kZQ0KICovDQoNCi8qKg0KICogRW5hYmxlIGEgdGFiIHRoYXQgaGFzIGJlZW4gZGlzYWJsZWQuDQogKg0KICogQGV4YW1wbGUgJCgnI2NvbnRhaW5lcicpLmVuYWJsZVRhYigyKTsNCiAqIEBkZXNjIEVuYWJsZSB0aGUgc2Vjb25kIHRhYiBvZiB0aGUgdGFiIGludGVyZmFjZSBjb250YWluZWQgaW4gPGRpdiBpZD0iY29udGFpbmVyIj4uDQogKg0KICogQHBhcmFtIFN0cmluZ3xOdW1iZXIgdGFiIEVpdGhlciBhIHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIGlkIG9mIHRoZSB0YWIgKHRoZSBVUkwncw0KICogICAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50IGlkZW50aWZpZXIvaGFzaCByZXByZXNlbnRpbmcgYSB0YWIpIG9yIGFuIGludGVnZXINCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZ5aW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgdGFiIChubyB6ZXJvLWJhc2VkIGluZGV4KSB0bw0KICogICAgICAgICAgICAgICAgICAgICAgICAgIGJlIGVuYWJsZWQuIElmIHRoaXMgcGFyYW1ldGVyIGlzIG9taXR0ZWQsIHRoZSBmaXJzdCB0YWINCiAqICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlIGVuYWJsZWQuDQogKiBAdHlwZSBqUXVlcnkNCiAqDQogKiBAbmFtZSBlbmFibGVUYWINCiAqIEBjYXQgUGx1Z2lucy9UYWJzDQogKiBAYXV0aG9yIEtsYXVzIEhhcnRsL2tsYXVzLmhhcnRsQHN0aWxidWVyby5kZQ0KICovDQoNCnZhciB0YWJFdmVudHMgPSBbJ3RyaWdnZXJUYWInLCAnZGlzYWJsZVRhYicsICdlbmFibGVUYWInXTsNCmZvciAodmFyIGkgPSAwOyBpIDwgdGFiRXZlbnRzLmxlbmd0aDsgaSsrKSB7DQogICAgJC5mblt0YWJFdmVudHNbaV1dID0gKGZ1bmN0aW9uKHRhYkV2ZW50KSB7DQogICAgICAgIHJldHVybiBmdW5jdGlvbih0YWIpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgdmFyIG5hdiA9ICQoJ3VsLnRhYnMtbmF2JyAsIHRoaXMpOw0KICAgICAgICAgICAgICAgIG5hdiA9IG5hdi5zaXplKCkgJiYgbmF2IHx8ICQoJz51bDplcSgwKScsIHRoaXMpOyAvLyBmYWxsYmFjayB0byBkZWZhdWx0IHN0cnVjdHVyZQ0KICAgICAgICAgICAgICAgIHZhciBhOw0KICAgICAgICAgICAgICAgIGlmICghdGFiIHx8IHR5cGVvZiB0YWIgPT0gJ251bWJlcicpIHsNCiAgICAgICAgICAgICAgICAgICAgYSA9ICQoJ2xpIGEnLCBuYXYpLmVxKCh0YWIgJiYgdGFiID4gMCAmJiB0YWIgLSAxIHx8IDApKTsgLy8gZmFsbCBiYWNrIHRvIDANCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0YWIgPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgYSA9ICQoJ2xpIGFbQGhyZWYkPSIjJyArIHRhYiArICciXScsIG5hdik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGEudHJpZ2dlcih0YWJFdmVudCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfTsNCiAgICB9KSh0YWJFdmVudHNbaV0pOw0KfQ0KDQovKioNCiAqIEdldCB0aGUgcG9zaXRpb24gb2YgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCB0YWIgKG5vIHplcm8tYmFzZWQgaW5kZXgpLg0KICoNCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS5hY3RpdmVUYWIoKTsNCiAqIEBkZXNjIEdldCB0aGUgcG9zaXRpb24gb2YgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCB0YWIgb2YgYW4gaW50ZXJmYWNlDQogKiBjb250YWluZWQgaW4gPGRpdiBpZD0iY29udGFpbmVyIj4uDQogKg0KICogQHR5cGUgTnVtYmVyDQogKg0KICogQG5hbWUgYWN0aXZlVGFiDQogKiBAY2F0IFBsdWdpbnMvVGFicw0KICogQGF1dGhvciBLbGF1cyBIYXJ0bC9rbGF1cy5oYXJ0bEBzdGlsYnVlcm8uZGUNCiAqLw0KDQokLmZuLmFjdGl2ZVRhYiA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciBzZWxlY3RlZFRhYnMgPSBbXTsNCiAgICB0aGlzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBuYXYgPSAkKCd1bC50YWJzLW5hdicgLCB0aGlzKTsNCiAgICAgICAgbmF2ID0gbmF2LnNpemUoKSAmJiBuYXYgfHwgJCgnPnVsOmVxKDApJywgdGhpcyk7IC8vZmFsbGJhY2sgdG8gZGVmYXVsdCBzdHJ1Y3R1cmUNCiAgICAgICAgdmFyIGxpcyA9ICQoJ2xpJywgbmF2KTsNCiAgICAgICAgc2VsZWN0ZWRUYWJzLnB1c2gobGlzLmluZGV4KCBsaXMuZmlsdGVyKCcudGFicy1zZWxlY3RlZCcpWzBdICkgKyAxKTsNCiAgICB9KTsNCiAgICByZXR1cm4gc2VsZWN0ZWRUYWJzWzBdOw0KfTsNCg0KfSkoalF1ZXJ5KTs=",
                "body": "LyoqDQogKiBUYWJzIC0galF1ZXJ5IHBsdWdpbiBmb3IgYWNjZXNzaWJsZSwgdW5vYnRydXNpdmUgdGFicw0KICogQHJlcXVpcmVzIGpRdWVyeSB2MS4xLjENCiAqDQogKiBodHRwOi8vc3RpbGJ1ZXJvLmRlL3RhYnMvDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDA2IEtsYXVzIEhhcnRsIChzdGlsYnVlcm8uZGUpDQogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlczoNCiAqIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwDQogKiBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLmh0bWwNCiAqDQogKiBWZXJzaW9uOiAyLjcuNA0KICovDQoNCihmdW5jdGlvbigkKSB7IC8vIGJsb2NrIHNjb3BlDQoNCiQuZXh0ZW5kKHsNCiAgICB0YWJzOiB7DQogICAgICAgIHJlbW90ZUNvdW50OiAwIC8vIFRPRE8gaW4gVGFicyAzIHRoaXMgaXMgZ29pbmcgdG8gYmUgbW9yZSBjbGVhbmx5IGluIG9uZSBzaW5nbGUgbmFtZXNwYWNlDQogICAgfQ0KfSk7DQoNCi8qKg0KICogQ3JlYXRlIGFuIGFjY2Vzc2libGUsIHVub2J0cnVzaXZlIHRhYiBpbnRlcmZhY2UgYmFzZWQgb24gYSBwYXJ0aWN1bGFyIEhUTUwgc3RydWN0dXJlLg0KICoNCiAqIFRoZSB1bmRlcmx5aW5nIEhUTUwgaGFzIHRvIGxvb2sgbGlrZSB0aGlzOg0KICoNCiAqIDxkaXYgaWQ9ImNvbnRhaW5lciI+DQogKiAgICAgPHVsPg0KICogICAgICAgICA8bGk+PGEgaHJlZj0iI2ZyYWdtZW50LTEiPlNlY3Rpb24gMTwvYT48L2xpPg0KICogICAgICAgICA8bGk+PGEgaHJlZj0iI2ZyYWdtZW50LTIiPlNlY3Rpb24gMjwvYT48L2xpPg0KICogICAgICAgICA8bGk+PGEgaHJlZj0iI2ZyYWdtZW50LTMiPlNlY3Rpb24gMzwvYT48L2xpPg0KICogICAgIDwvdWw+DQogKiAgICAgPGRpdiBpZD0iZnJhZ21lbnQtMSI+DQogKg0KICogICAgIDwvZGl2Pg0KICogICAgIDxkaXYgaWQ9ImZyYWdtZW50LTIiPg0KICoNCiAqICAgICA8L2Rpdj4NCiAqICAgICA8ZGl2IGlkPSJmcmFnbWVudC0zIj4NCiAqDQogKiAgICAgPC9kaXY+DQogKiA8L2Rpdj4NCiAqDQogKiBFYWNoIGFuY2hvciBpbiB0aGUgdW5vcmRlcmVkIGxpc3QgcG9pbnRzIGRpcmVjdGx5IHRvIGEgc2VjdGlvbiBiZWxvdyByZXByZXNlbnRlZCBieSBvbmUgb2YgdGhlDQogKiBkaXZzICh0aGUgVVJJIGluIHRoZSBhbmNob3IncyBocmVmIGF0dHJpYnV0ZSByZWZlcnMgdG8gdGhlIGZyYWdtZW50IHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgaWQpLg0KICogQmVjYXVzZSBzdWNoIEhUTUwgc3RydWN0dXJlIGlzIGZ1bGx5IGZ1bmN0aW9uYWwgb24gaXRzIG93biwgZS5nLiB3aXRob3V0IEphdmFTY3JpcHQsIHRoZSB0YWINCiAqIGludGVyZmFjZSBpcyBhY2Nlc3NpYmxlIGFuZCB1bm9idHJ1c2l2ZS4NCiAqDQogKiBBIHRhYiBpcyBhbHNvIGJvb2ttYXJrYWJsZSB2aWEgaGFzaCBpbiB0aGUgVVJMLiBVc2UgdGhlIEhpc3RvcnkvUmVtb3RlIHBsdWdpbiAoVGFicyB3aWxsDQogKiBhdXRvLWRldGVjdCBpdHMgcHJlc2VuY2UpIHRvIGZpeCB0aGUgYmFjayAoYW5kIGZvcndhcmQpIGJ1dHRvbi4NCiAqDQogKiBAZXhhbXBsZSAkKCcjY29udGFpbmVyJykudGFicygpOw0KICogQGRlc2MgQ3JlYXRlIGEgYmFzaWMgdGFiIGludGVyZmFjZS4NCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS50YWJzKDIpOw0KICogQGRlc2MgQ3JlYXRlIGEgYmFzaWMgdGFiIGludGVyZmFjZSB3aXRoIHRoZSBzZWNvbmQgdGFiIGluaXRpYWxseSBhY3RpdmF0ZWQuDQogKiBAZXhhbXBsZSAkKCcjY29udGFpbmVyJykudGFicyh7ZGlzYWJsZWQ6IFszLCA0XX0pOw0KICogQGRlc2MgQ3JlYXRlIGEgdGFiIGludGVyZmFjZSB3aXRoIHRoZSB0aGlyZCBhbmQgZm91cnRoIHRhYiBiZWluZyBkaXNhYmxlZC4NCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS50YWJzKHtmeFNsaWRlOiB0cnVlfSk7DQogKiBAZGVzYyBDcmVhdGUgYSB0YWIgaW50ZXJmYWNlIHRoYXQgdXNlcyBzbGlkZSBkb3duL3VwIGFuaW1hdGlvbnMgZm9yIHNob3dpbmcvaGlkaW5nIHRhYg0KICogICAgICAgY29udGVudCB1cG9uIHRhYiBzd2l0Y2hpbmcuDQogKg0KICogQHBhcmFtIE51bWJlciBpbml0aWFsIEFuIGludGVnZXIgc3BlY2lmeWluZyB0aGUgcG9zaXRpb24gb2YgdGhlIHRhYiAobm8gemVyby1iYXNlZCBpbmRleCkgdGhhdA0KICogICAgICAgICAgICAgICAgICAgICAgIGdldHMgYWN0aXZhdGVkIGF0IGZpcnN0IChvbiBwYWdlIGxvYWQpLiBUd28gYWx0ZXJuYXRpdmUgd2F5cyB0byBzcGVjaWZ5DQogKiAgICAgICAgICAgICAgICAgICAgICAgdGhlIGFjdGl2ZSB0YWIgd2lsbCBvdmVycnVsZSB0aGlzIGFyZ3VtZW50LiBGaXJzdCBhIGxpIGVsZW1lbnQNCiAqICAgICAgICAgICAgICAgICAgICAgICAocmVwcmVzZW50aW5nIG9uZSBzaW5nbGUgdGFiKSBiZWxvbmdpbmcgdG8gdGhlIHNlbGVjdGVkIHRhYiBjbGFzcywgZS5nLg0KICogICAgICAgICAgICAgICAgICAgICAgIHNldCB0aGUgc2VsZWN0ZWQgdGFiIGNsYXNzIChkZWZhdWx0OiAidGFicy1zZWxlY3RlZCIsIHNlZSBvcHRpb24NCiAqICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZENsYXNzKSBmb3Igb25lIG9mIHRoZSB1bm9yZGVyZWQgbGkgZWxlbWVudHMgaW4gdGhlIEhUTUwgc291cmNlLg0KICogICAgICAgICAgICAgICAgICAgICAgIEluIGFkZGl0aW9uIGlmIGEgZnJhZ21lbnQgaWRlbnRpZmllci9oYXNoIGluIHRoZSBVUkwgb2YgdGhlIHBhZ2UgcmVmZXJzDQogKiAgICAgICAgICAgICAgICAgICAgICAgdG8gdGhlIGlkIG9mIGEgdGFiIGNvbnRhaW5lciBvZiBhIHRhYiBpbnRlcmZhY2UgdGhlIGNvcnJlc3BvbmRpbmcgdGFiIHdpbGwNCiAqICAgICAgICAgICAgICAgICAgICAgICBiZSBhY3RpdmF0ZWQgYW5kIGJvdGggdGhlIGluaXRpYWwgYXJndW1lbnQgYXMgd2VsbCBhcyBhbiBldmVudHVhbGx5DQogKiAgICAgICAgICAgICAgICAgICAgICAgZGVjbGFyZWQgY2xhc3MgYXR0cmlidXRlIHdpbGwgYmUgb3ZlcnJ1bGVkLiBEZWZhdWx0cyB0byAxIGlmIG9taXR0ZWQuDQogKiBAcGFyYW0gT2JqZWN0IHNldHRpbmdzIEFuIG9iamVjdCBsaXRlcmFsIGNvbnRhaW5pbmcga2V5L3ZhbHVlIHBhaXJzIHRvIHByb3ZpZGUgb3B0aW9uYWwgc2V0dGluZ3MuDQogKiBAb3B0aW9uIEFycmF5PE51bWJlcj4gZGlzYWJsZWQgQW4gYXJyYXkgY29udGFpbmluZyB0aGUgcG9zaXRpb24gb2YgdGhlIHRhYnMgKG5vIHplcm8tYmFzZWQgaW5kZXgpDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdCBzaG91bGQgYmUgZGlzYWJsZWQgb24gaW5pdGlhbGl6YXRpb24uIERlZmF1bHQgdmFsdWU6IG51bGwuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSB0YWIgY2FuIGFsc28gYmUgZGlzYWJsZWQgYnkgc2ltcGx5IGFkZGluZyB0aGUgZGlzYWJsaW5nIGNsYXNzDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRlZmF1bHQ6ICJ0YWJzLWRpc2FibGVkIiwgc2VlIG9wdGlvbiBkaXNhYmxlZENsYXNzKSB0byB0aGUgbGkNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50IHJlcHJlc2VudGluZyB0aGF0IHBhcnRpY3VsYXIgdGFiLg0KICogQG9wdGlvbiBCb29sZWFuIGJvb2ttYXJrYWJsZSBCb29sZWFuIGZsYWcgaW5kaWNhdGluZyBpZiBzdXBwb3J0IGZvciBib29rbWFya2luZyBhbmQgaGlzdG9yeSAodmlhDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5naW5nIGhhc2ggaW4gdGhlIFVSTCBvZiB0aGUgYnJvd3NlcikgaXMgZW5hYmxlZC4gRGVmYXVsdCB2YWx1ZToNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsIHVubGVzcyB0aGUgSGlzdG9yeS9SZW1vdGUgcGx1Z2luIGlzIGluY2x1ZGVkLiBJbiB0aGF0IGNhc2UgdGhlDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQgdmFsdWUgYmVjb21lcyB0cnVlLiBAc2VlICQuYWpheEhpc3RvcnkuaW5pdGlhbGl6ZQ0KICogQG9wdGlvbiBCb29sZWFuIHJlbW90ZSBCb29sZWFuIGZsYWcgaW5kaWNhdGluZyB0aGF0IHRhYiBjb250ZW50IGhhcyB0byBiZSBsb2FkZWQgcmVtb3RlbHkgZnJvbQ0KICogICAgICAgICAgICAgICAgICAgICAgICB0aGUgdXJsIGdpdmVuIGluIHRoZSBocmVmIGF0dHJpYnV0ZSBvZiB0aGUgdGFiIG1lbnUgYW5jaG9yIGVsZW1lbnRzLg0KICogQG9wdGlvbiBTdHJpbmcgc3Bpbm5lciBUaGUgY29udGVudCBvZiB0aGlzIHN0cmluZyBpcyBzaG93biBpbiBhIHRhYiB3aGlsZSByZW1vdGUgY29udGVudCBpcyBsb2FkaW5nLg0KICogICAgICAgICAgICAgICAgICAgICAgICBJbnNlcnQgcGxhaW4gdGV4dCBhcyB3ZWxsIGFzIGFuIGltZyBoZXJlLiBUbyB0dXJuIG9mZiB0aGlzIG5vdGlmaWNhdGlvbg0KICogICAgICAgICAgICAgICAgICAgICAgICBwYXNzIGFuIGVtcHR5IHN0cmluZyBvciBudWxsLiBEZWZhdWx0OiAiTG9hZGluZyYjODIzMDsiLg0KICogQG9wdGlvbiBTdHJpbmcgaGFzaFByZWZpeCBBIFN0cmluZyB0aGF0IGlzIHVzZWQgZm9yIGNvbnN0cnVjdGluZyB0aGUgaGFzaCB0aGUgbGluaydzIGhyZWYgYXR0cmlidXRlDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mIGEgcmVtb3RlIHRhYiBnZXRzIGFsdGVyZWQgdG8sIHN1Y2ggYXMgIiNyZW1vdGUtMSIuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6ICJyZW1vdGUtdGFiLSIuDQogKiBAb3B0aW9uIEJvb2xlYW4gZnhGYWRlIEJvb2xlYW4gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgZmFkZSBpbi9vdXQgYW5pbWF0aW9ucyBhcmUgdXNlZCBmb3IgdGFiDQogKiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaGluZy4gQ2FuIGJlIGNvbWJpbmVkIHdpdGggZnhTbGlkZS4gV2lsbCBvdmVycnVsZSBmeFNob3cvZnhIaWRlLg0KICogICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlOiBmYWxzZS4NCiAqIEBvcHRpb24gQm9vbGVhbiBmeFNsaWRlIEJvb2xlYW4gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgc2xpZGUgZG93bi91cCBhbmltYXRpb25zIGFyZSB1c2VkIGZvciB0YWINCiAqICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaGluZy4gQ2FuIGJlIGNvbWJpbmVkIHdpdGggZnhGYWRlLiBXaWxsIG92ZXJydWxlIGZ4U2hvdy9meEhpZGUuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlOiBmYWxzZS4NCiAqIEBvcHRpb24gU3RyaW5nfE51bWJlciBmeFNwZWVkIEEgc3RyaW5nIHJlcHJlc2VudGluZyBvbmUgb2YgdGhlIHRocmVlIHByZWRlZmluZWQgc3BlZWRzICgic2xvdyIsDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibm9ybWFsIiwgb3IgImZhc3QiKSBvciB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyAoZS5nLiAxMDAwKSB0bw0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVuIGFuIGFuaW1hdGlvbi4gRGVmYXVsdCB2YWx1ZTogIm5vcm1hbCIuDQogKiBAb3B0aW9uIE9iamVjdCBmeFNob3cgQW4gb2JqZWN0IGxpdGVyYWwgb2YgdGhlIGZvcm0galF1ZXJ5J3MgYW5pbWF0ZSBmdW5jdGlvbiBleHBlY3RzIGZvciBtYWtpbmcNCiAqICAgICAgICAgICAgICAgICAgICAgICB5b3VyIG93biwgY3VzdG9tIGFuaW1hdGlvbiB0byByZXZlYWwgYSB0YWIgdXBvbiB0YWIgc3dpdGNoLiBVbmxpa2UgZnhGYWRlDQogKiAgICAgICAgICAgICAgICAgICAgICAgb3IgZnhTbGlkZSB0aGlzIGFuaW1hdGlvbiBpcyBpbmRlcGVuZGVudCBmcm9tIGFuIG9wdGlvbmFsIGhpZGUgYW5pbWF0aW9uLg0KICogICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6IG51bGwuIEBzZWUgYW5pbWF0ZQ0KICogQG9wdGlvbiBPYmplY3QgZnhIaWRlIEFuIG9iamVjdCBsaXRlcmFsIG9mIHRoZSBmb3JtIGpRdWVyeSdzIGFuaW1hdGUgZnVuY3Rpb24gZXhwZWN0cyBmb3IgbWFraW5nDQogKiAgICAgICAgICAgICAgICAgICAgICAgeW91ciBvd24sIGN1c3RvbSBhbmltYXRpb24gdG8gaGlkZSBhIHRhYiB1cG9uIHRhYiBzd2l0Y2guIFVubGlrZSBmeEZhZGUNCiAqICAgICAgICAgICAgICAgICAgICAgICBvciBmeFNsaWRlIHRoaXMgYW5pbWF0aW9uIGlzIGluZGVwZW5kZW50IGZyb20gYW4gb3B0aW9uYWwgc2hvdyBhbmltYXRpb24uDQogKiAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogbnVsbC4gQHNlZSBhbmltYXRlDQogKiBAb3B0aW9uIFN0cmluZ3xOdW1iZXIgZnhTaG93U3BlZWQgQSBzdHJpbmcgcmVwcmVzZW50aW5nIG9uZSBvZiB0aGUgdGhyZWUgcHJlZGVmaW5lZCBzcGVlZHMNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoInNsb3ciLCAibm9ybWFsIiwgb3IgImZhc3QiKSBvciB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcw0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlLmcuIDEwMDApIHRvIHJ1biB0aGUgYW5pbWF0aW9uIHNwZWNpZmllZCBpbiBmeFNob3cuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogZnhTcGVlZC4NCiAqIEBvcHRpb24gU3RyaW5nfE51bWJlciBmeEhpZGVTcGVlZCBBIHN0cmluZyByZXByZXNlbnRpbmcgb25lIG9mIHRoZSB0aHJlZSBwcmVkZWZpbmVkIHNwZWVkcw0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgic2xvdyIsICJub3JtYWwiLCBvciAiZmFzdCIpIG9yIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUuZy4gMTAwMCkgdG8gcnVuIHRoZSBhbmltYXRpb24gc3BlY2lmaWVkIGluIGZ4SGlkZS4NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlOiBmeFNwZWVkLg0KICogQG9wdGlvbiBCb29sZWFuIGZ4QXV0b0hlaWdodCBCb29sZWFuIGZsYWcgdGhhdCBpZiBzZXQgdG8gdHJ1ZSBjYXVzZXMgYWxsIHRhYiBoZWlnaHRzDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIGJlIGNvbnN0YW50IChiZWluZyB0aGUgaGVpZ2h0IG9mIHRoZSB0YWxsZXN0IHRhYikuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6IGZhbHNlLg0KICogQG9wdGlvbiBGdW5jdGlvbiBvbkNsaWNrIEEgZnVuY3Rpb24gdG8gYmUgaW52b2tlZCB1cG9uIHRhYiBzd2l0Y2gsIGltbWVkaWF0bHkgYWZ0ZXIgYSB0YWIgaGFzDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgYmVlbiBjbGlja2VkLCBlLmcuIGJlZm9yZSB0aGUgb3RoZXIncyB0YWIgY29udGVudCBnZXRzIGhpZGRlbi4gVGhlDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0cyBwYXNzZWQgdGhyZWUgYXJndW1lbnRzOiB0aGUgZmlyc3Qgb25lIGlzIHRoZSBjbGlja2VkDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiIChlLmcuIGFuIGFuY2hvciBlbGVtZW50KSwgdGhlIHNlY29uZCBvbmUgaXMgdGhlIERPTSBlbGVtZW50DQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmluZyB0aGUgY29udGVudCBvZiB0aGUgY2xpY2tlZCB0YWIgKGUuZy4gdGhlIGRpdiksIHRoZSB0aGlyZA0KICogICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50IGlzIHRoZSBvbmUgb2YgdGhlIHRhYiB0aGF0IGdldHMgaGlkZGVuLiBJZiB0aGlzIGNhbGxiYWNrDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyBmYWxzZSwgdGhlIHRhYiBzd2l0Y2ggaXMgY2FuY2VsZWQgKHVzZSB0byBkaXNhbGxvdyB0YWINCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hpbmcgZm9yIHRoZSByZWFzb24gb2YgYSBmYWlsZWQgZm9ybSB2YWxpZGF0aW9uIGZvciBleGFtcGxlKS4NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlOiBudWxsLg0KICogQG9wdGlvbiBGdW5jdGlvbiBvbkhpZGUgQSBmdW5jdGlvbiB0byBiZSBpbnZva2VkIHVwb24gdGFiIHN3aXRjaCwgaW1tZWRpYXRseSBhZnRlciBvbmUgdGFiJ3MNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgZ290IGhpZGRlbiAod2l0aCBvciB3aXRob3V0IGFuIGFuaW1hdGlvbikgYW5kIHJpZ2h0IGJlZm9yZSB0aGUNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgdGFiIGlzIHJldmVhbGVkLiBUaGUgZnVuY3Rpb24gZ2V0cyBwYXNzZWQgdGhyZWUgYXJndW1lbnRzOiB0aGUNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0IG9uZSBpcyB0aGUgY2xpY2tlZCB0YWIgKGUuZy4gYW4gYW5jaG9yIGVsZW1lbnQpLCB0aGUgc2Vjb25kIG9uZQ0KICogICAgICAgICAgICAgICAgICAgICAgICAgaXMgdGhlIERPTSBlbGVtZW50IGNvbnRhaW5pbmcgdGhlIGNvbnRlbnQgb2YgdGhlIGNsaWNrZWQgdGFiLCAoZS5nLiB0aGUNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIGRpdiksIHRoZSB0aGlyZCBhcmd1bWVudCBpcyB0aGUgb25lIG9mIHRoZSB0YWIgdGhhdCBnZXRzIGhpZGRlbi4NCiAqICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6IG51bGwuDQogKiBAb3B0aW9uIEZ1bmN0aW9uIG9uU2hvdyBBIGZ1bmN0aW9uIHRvIGJlIGludm9rZWQgdXBvbiB0YWIgc3dpdGNoLiBUaGlzIGZ1bmN0aW9uIGlzIGludm9rZWQNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyIHRoZSBuZXcgdGFiIGhhcyBiZWVuIHJldmVhbGVkLCBlLmcuIGFmdGVyIHRoZSBzd2l0Y2ggaXMgY29tcGxldGVkLg0KICogICAgICAgICAgICAgICAgICAgICAgICAgVGhlIGZ1bmN0aW9uIGdldHMgcGFzc2VkIHRocmVlIGFyZ3VtZW50czogdGhlIGZpcnN0IG9uZSBpcyB0aGUgY2xpY2tlZA0KICogICAgICAgICAgICAgICAgICAgICAgICAgdGFiIChlLmcuIGFuIGFuY2hvciBlbGVtZW50KSwgdGhlIHNlY29uZCBvbmUgaXMgdGhlIERPTSBlbGVtZW50DQogKiAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluaW5nIHRoZSBjb250ZW50IG9mIHRoZSBjbGlja2VkIHRhYiwgKGUuZy4gdGhlIGRpdiksIHRoZSB0aGlyZA0KICogICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnQgaXMgdGhlIG9uZSBvZiB0aGUgdGFiIHRoYXQgZ2V0cyBoaWRkZW4uIERlZmF1bHQgdmFsdWU6IG51bGwuDQogKiBAb3B0aW9uIFN0cmluZyBuYXZDbGFzcyBBIENTUyBjbGFzcyB0aGF0IGlzIHVzZWQgdG8gaWRlbnRpZnkgdGhlIHRhYnMgdW5vcmRlcmVkIGxpc3QgYnkgY2xhc3MgaWYNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSByZXF1aXJlZCBIVE1MIHN0cnVjdHVyZSBkaWZmZXJzIGZyb20gdGhlIGRlZmF1bHQgb25lLg0KICogICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZTogInRhYnMtbmF2Ii4NCiAqIEBvcHRpb24gU3RyaW5nIHNlbGVjdGVkQ2xhc3MgVGhlIENTUyBjbGFzcyBhdHRhY2hlZCB0byB0aGUgbGkgZWxlbWVudCByZXByZXNlbnRpbmcgdGhlDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRseSBzZWxlY3RlZCAoYWN0aXZlKSB0YWIuIERlZmF1bHQgdmFsdWU6ICJ0YWJzLXNlbGVjdGVkIi4NCiAqIEBvcHRpb24gU3RyaW5nIGRpc2FibGVkQ2xhc3MgVGhlIENTUyBjbGFzcyBhdHRhY2hlZCB0byB0aGUgbGkgZWxlbWVudCByZXByZXNlbnRpbmcgYSBkaXNhYmxlZA0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWIuIERlZmF1bHQgdmFsdWU6ICJ0YWJzLWRpc2FibGVkIi4NCiAqIEBvcHRpb24gU3RyaW5nIGNvbnRhaW5lckNsYXNzIEEgQ1NTIGNsYXNzIHRoYXQgaXMgdXNlZCB0byBpZGVudGlmeSB0YWIgY29udGFpbmVycyBieSBjbGFzcyBpZg0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHJlcXVpcmVkIEhUTUwgc3RydWN0dXJlIGRpZmZlcnMgZnJvbSB0aGUgZGVmYXVsdCBvbmUuDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlOiAidGFicy1jb250YWluZXIiLg0KICogQG9wdGlvbiBTdHJpbmcgaGlkZUNsYXNzIFRoZSBDU1MgY2xhc3MgdXNlZCBmb3IgaGlkaW5nIGluYWN0aXZlIHRhYnMuIEEgY2xhc3MgaXMgdXNlZCBpbnN0ZWFkDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgb2YgImRpc3BsYXk6IG5vbmUiIGluIHRoZSBzdHlsZSBhdHRyaWJ1dGUgdG8gbWFpbnRhaW4gY29udHJvbCBvdmVyDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eSBpbiBvdGhlciBtZWRpYSB0eXBlcyB0aGFuIHNjcmVlbiwgbW9zdCBub3RhYmx5IHByaW50Lg0KICogICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6ICJ0YWJzLWhpZGUiLg0KICogQG9wdGlvbiBTdHJpbmcgbG9hZGluZ0NsYXNzIFRoZSBDU1MgY2xhc3MgdXNlZCBmb3IgaW5kaWNhdGluZyB0aGF0IGFuIEFqYXggdGFiIGlzIGN1cnJlbnRseQ0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmcsIGZvciBleGFtcGxlIGJ5IHNob3dpbmcgYSBzcGlubmVyLg0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6ICJ0YWJzLWxvYWRpbmciLg0KICogQG9wdGlvbiBTdHJpbmcgdGFiU3RydWN0IEBkZXByZWNhdGVkIEEgQ1NTIHNlbGVjdG9yIG9yIGJhc2ljIFhQYXRoIGV4cHJlc3Npb24gcmVmbGVjdGluZyBhDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgbmVzdGVkIEhUTUwgc3RydWN0dXJlIHRoYXQgaXMgZGlmZmVyZW50IGZyb20gdGhlIGRlZmF1bHQgc2luZ2xlIGRpdg0KICogICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdHVyZSAob25lIGRpdiB3aXRoIGFuIGlkIGluc2lkZSB0aGUgb3ZlcmFsbCBjb250YWluZXIgaG9sZHMgb25lDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiJ3MgY29udGVudCkuIElmIGZvciBpbnN0YW5jZSBhbiBhZGRpdGlvbmFsIGRpdiBpcyByZXF1aXJlZCB0byB3cmFwDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgdXAgdGhlIHNldmVyYWwgdGFiIGNvbnRhaW5lcnMgc3VjaCBhIHN0cnVjdHVyZSBpcyBleHByZXNzZWQgYnkgImRpdj5kaXYiLg0KICogICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWU6ICJkaXYiLg0KICogQHR5cGUgalF1ZXJ5DQogKg0KICogQG5hbWUgdGFicw0KICogQGNhdCBQbHVnaW5zL1RhYnMNCiAqIEBhdXRob3IgS2xhdXMgSGFydGwva2xhdXMuaGFydGxAc3RpbGJ1ZXJvLmRlDQogKi8NCiQuZm4udGFicyA9IGZ1bmN0aW9uKGluaXRpYWwsIHNldHRpbmdzKSB7DQoNCiAgICAvLyBzZXR0aW5ncw0KICAgIGlmICh0eXBlb2YgaW5pdGlhbCA9PSAnb2JqZWN0Jykgc2V0dGluZ3MgPSBpbml0aWFsOyAvLyBubyBpbml0aWFsIHRhYiBnaXZlbiBidXQgYSBzZXR0aW5ncyBvYmplY3QNCiAgICBzZXR0aW5ncyA9ICQuZXh0ZW5kKHsNCiAgICAgICAgaW5pdGlhbDogKGluaXRpYWwgJiYgdHlwZW9mIGluaXRpYWwgPT0gJ251bWJlcicgJiYgaW5pdGlhbCA+IDApID8gLS1pbml0aWFsIDogMCwNCiAgICAgICAgZGlzYWJsZWQ6IG51bGwsDQogICAgICAgIGJvb2ttYXJrYWJsZTogJC5hamF4SGlzdG9yeSA/IHRydWUgOiBmYWxzZSwNCiAgICAgICAgcmVtb3RlOiBmYWxzZSwNCiAgICAgICAgc3Bpbm5lcjogJ0xvYWRpbmcmIzgyMzA7JywNCiAgICAgICAgaGFzaFByZWZpeDogJ3JlbW90ZS10YWItJywNCiAgICAgICAgZnhGYWRlOiBudWxsLA0KICAgICAgICBmeFNsaWRlOiBudWxsLA0KICAgICAgICBmeFNob3c6IG51bGwsDQogICAgICAgIGZ4SGlkZTogbnVsbCwNCiAgICAgICAgZnhTcGVlZDogJ25vcm1hbCcsDQogICAgICAgIGZ4U2hvd1NwZWVkOiBudWxsLA0KICAgICAgICBmeEhpZGVTcGVlZDogbnVsbCwNCiAgICAgICAgZnhBdXRvSGVpZ2h0OiBmYWxzZSwNCiAgICAgICAgb25DbGljazogbnVsbCwNCiAgICAgICAgb25IaWRlOiBudWxsLA0KICAgICAgICBvblNob3c6IG51bGwsDQogICAgICAgIG5hdkNsYXNzOiAndGFicy1uYXYnLA0KICAgICAgICBzZWxlY3RlZENsYXNzOiAndGFicy1zZWxlY3RlZCcsDQogICAgICAgIGRpc2FibGVkQ2xhc3M6ICd0YWJzLWRpc2FibGVkJywNCiAgICAgICAgY29udGFpbmVyQ2xhc3M6ICd0YWJzLWNvbnRhaW5lcicsDQogICAgICAgIGhpZGVDbGFzczogJ3RhYnMtaGlkZScsDQogICAgICAgIGxvYWRpbmdDbGFzczogJ3RhYnMtbG9hZGluZycsDQogICAgICAgIHRhYlN0cnVjdDogJ2RpdicNCiAgICB9LCBzZXR0aW5ncyB8fCB7fSk7DQoNCiAgICAkLmJyb3dzZXIubXNpZTYgPSAkLmJyb3dzZXIubXNpZSAmJiAoJC5icm93c2VyLnZlcnNpb24gJiYgJC5icm93c2VyLnZlcnNpb24gPCA3IHx8IC9NU0lFIDYuMC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSk7IC8vIGRvIG5vdCBjaGVjayBmb3IgNi4wIGFsb25lLCB1c2VyQWdlbnQgaW4gV2luZG93cyBWaXN0YSBoYXMgIldpbmRvd3MgTlQgNi4wIg0KDQogICAgLy8gaGVscGVyIHRvIHByZXZlbnQgc2Nyb2xsIHRvIGZyYWdtZW50DQogICAgZnVuY3Rpb24gdW5Gb2N1cygpIHsNCiAgICAgICAgc2Nyb2xsVG8oMCwgMCk7DQogICAgfQ0KDQogICAgLy8gaW5pdGlhbGl6ZSB0YWJzDQogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCg0KICAgICAgICAvLyByZW1lbWJlciB3cmFwcGVyIGZvciBsYXRlcg0KICAgICAgICB2YXIgY29udGFpbmVyID0gdGhpczsNCg0KICAgICAgICAvLyBzZXR1cCBuYXYNCiAgICAgICAgdmFyIG5hdiA9ICQoJ3VsLicgKyBzZXR0aW5ncy5uYXZDbGFzcywgY29udGFpbmVyKTsNCiAgICAgICAgbmF2ID0gbmF2LnNpemUoKSAmJiBuYXYgfHwgJCgnPnVsOmVxKDApJywgY29udGFpbmVyKTsgLy8gZmFsbGJhY2sgdG8gZGVmYXVsdCBzdHJ1Y3R1cmUNCiAgICAgICAgdmFyIHRhYnMgPSAkKCdhJywgbmF2KTsNCg0KICAgICAgICAvLyBwcmVwYXJlIHJlbW90ZSB0YWJzDQogICAgICAgIGlmIChzZXR0aW5ncy5yZW1vdGUpIHsNCiAgICAgICAgICAgIHRhYnMuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICB2YXIgaWQgPSBzZXR0aW5ncy5oYXNoUHJlZml4ICsgKCsrJC50YWJzLnJlbW90ZUNvdW50KSwgaGFzaCA9ICcjJyArIGlkLCB1cmwgPSB0aGlzLmhyZWY7DQogICAgICAgICAgICAgICAgdGhpcy5ocmVmID0gaGFzaDsNCiAgICAgICAgICAgICAgICAkKCc8ZGl2IGlkPSInICsgaWQgKyAnIiBjbGFzcz0iJyArIHNldHRpbmdzLmNvbnRhaW5lckNsYXNzICsgJyI+PC9kaXY+JykuYXBwZW5kVG8oY29udGFpbmVyKTsNCg0KICAgICAgICAgICAgICAgICQodGhpcykuYmluZCgnbG9hZFJlbW90ZVRhYicsIGZ1bmN0aW9uKGUsIGNhbGxiYWNrKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciAkJCA9ICQodGhpcykuYWRkQ2xhc3Moc2V0dGluZ3MubG9hZGluZ0NsYXNzKSwgc3BhbiA9ICQoJ3NwYW4nLCB0aGlzKVswXSwgdGFiVGl0bGUgPSBzcGFuLmlubmVySFRNTDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLnNwaW5uZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gaWYgc3Bpbm5lciBpcyBpbWFnZQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi5pbm5lckhUTUwgPSAnPGVtPicgKyBzZXR0aW5ncy5zcGlubmVyICsgJzwvZW0+JzsgLy8gV0FSTklORzogaHRtbCguLi4pIGNyYXNoZXMgU2FmYXJpIHdpdGggalF1ZXJ5IDEuMS4yDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgLy8gVGltZW91dCBpcyBhZ2FpbiByZXF1aXJlZCBpbiBJRSwgIndhaXQiIGZvciBpZCBiZWluZyByZXN0b3JlZA0KICAgICAgICAgICAgICAgICAgICAgICAgJChoYXNoKS5sb2FkKHVybCwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLnNwaW5uZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi5pbm5lckhUTUwgPSB0YWJUaXRsZTsgLy8gV0FSTklORzogaHRtbCguLi4pIGNyYXNoZXMgU2FmYXJpIHdpdGggalF1ZXJ5IDEuMS4yDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICQkLnJlbW92ZUNsYXNzKHNldHRpbmdzLmxvYWRpbmdDbGFzcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9LCAwKTsNCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBzZXQgdXAgY29udGFpbmVycw0KICAgICAgICB2YXIgY29udGFpbmVycyA9ICQoJ2Rpdi4nICsgc2V0dGluZ3MuY29udGFpbmVyQ2xhc3MsIGNvbnRhaW5lcik7DQogICAgICAgIGNvbnRhaW5lcnMgPSBjb250YWluZXJzLnNpemUoKSAmJiBjb250YWluZXJzIHx8ICQoJz4nICsgc2V0dGluZ3MudGFiU3RydWN0LCBjb250YWluZXIpOyAvLyBmYWxsYmFjayB0byBkZWZhdWx0IHN0cnVjdHVyZQ0KDQogICAgICAgIC8vIGF0dGFjaCBjbGFzc2VzIGZvciBzdHlsaW5nIGlmIG5vdCBwcmVzZW50DQogICAgICAgIG5hdi5pcygnLicgKyBzZXR0aW5ncy5uYXZDbGFzcykgfHwgbmF2LmFkZENsYXNzKHNldHRpbmdzLm5hdkNsYXNzKTsNCiAgICAgICAgY29udGFpbmVycy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdmFyICQkID0gJCh0aGlzKTsNCiAgICAgICAgICAgICQkLmlzKCcuJyArIHNldHRpbmdzLmNvbnRhaW5lckNsYXNzKSB8fCAkJC5hZGRDbGFzcyhzZXR0aW5ncy5jb250YWluZXJDbGFzcyk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIHRyeSB0byByZXRyaWV2ZSBhY3RpdmUgdGFiIGZyb20gY2xhc3MgaW4gSFRNTA0KICAgICAgICB2YXIgaGFzU2VsZWN0ZWRDbGFzcyA9ICQoJ2xpJywgbmF2KS5pbmRleCggJCgnbGkuJyArIHNldHRpbmdzLnNlbGVjdGVkQ2xhc3MsIG5hdilbMF0gKTsNCiAgICAgICAgaWYgKGhhc1NlbGVjdGVkQ2xhc3MgPj0gMCkgew0KICAgICAgICAgICBzZXR0aW5ncy5pbml0aWFsID0gaGFzU2VsZWN0ZWRDbGFzczsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIHRyeSB0byByZXRyaWV2ZSBhY3RpdmUgdGFiIGZyb20gaGFzaCBpbiB1cmwsIHdpbGwgb3ZlcnJpZGUgY2xhc3MgaW4gSFRNTA0KICAgICAgICBpZiAobG9jYXRpb24uaGFzaCkgew0KICAgICAgICAgICAgdGFicy5lYWNoKGZ1bmN0aW9uKGkpIHsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5oYXNoID09IGxvY2F0aW9uLmhhc2gpIHsNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuaW5pdGlhbCA9IGk7DQogICAgICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgcGFnZSBzY3JvbGwgdG8gZnJhZ21lbnQNCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkLmJyb3dzZXIubXNpZSB8fCAkLmJyb3dzZXIub3BlcmEpICYmICFzZXR0aW5ncy5yZW1vdGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b1Nob3cgPSAkKGxvY2F0aW9uLmhhc2gpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvU2hvd0lkID0gdG9TaG93LmF0dHIoJ2lkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB0b1Nob3cuYXR0cignaWQnLCAnJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvU2hvdy5hdHRyKCdpZCcsIHRvU2hvd0lkKTsgLy8gcmVzdG9yZSBpZA0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgNTAwKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB1bkZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gYnJlYWsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoJC5icm93c2VyLm1zaWUpIHsNCiAgICAgICAgICAgIHVuRm9jdXMoKTsgLy8gZml4IElFIGZvY3Vzc2luZyBib3R0b20gb2YgdGhlIHBhZ2UgZm9yIHNvbWUgdW5rbm93biByZWFzb24NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGhpZ2hsaWdodCB0YWIgYWNjb3JkaW5nbHkNCiAgICAgICAgY29udGFpbmVycy5maWx0ZXIoJzplcSgnICsgc2V0dGluZ3MuaW5pdGlhbCArICcpJykuc2hvdygpLmVuZCgpLm5vdCgnOmVxKCcgKyBzZXR0aW5ncy5pbml0aWFsICsgJyknKS5hZGRDbGFzcyhzZXR0aW5ncy5oaWRlQ2xhc3MpOw0KICAgICAgICAkKCdsaScsIG5hdikucmVtb3ZlQ2xhc3Moc2V0dGluZ3Muc2VsZWN0ZWRDbGFzcykuZXEoc2V0dGluZ3MuaW5pdGlhbCkuYWRkQ2xhc3Moc2V0dGluZ3Muc2VsZWN0ZWRDbGFzcyk7IC8vIHdlIG5lZWQgdG8gcmVtb3ZlIGNsYXNzZXMgZXZlbnR1YWxseSBpZiBoYXNoIHRha2VzIHByZWNlZGVuY2Ugb3ZlciBjbGFzcw0KICAgICAgICAvLyB0cmlnZ2VyIGxvYWQgb2YgaW5pdGlhbCB0YWINCiAgICAgICAgdGFicy5lcShzZXR0aW5ncy5pbml0aWFsKS50cmlnZ2VyKCdsb2FkUmVtb3RlVGFiJykuZW5kKCk7DQoNCiAgICAgICAgLy8gc2V0dXAgYXV0byBoZWlnaHQNCiAgICAgICAgaWYgKHNldHRpbmdzLmZ4QXV0b0hlaWdodCkgew0KICAgICAgICAgICAgLy8gaGVscGVyDQogICAgICAgICAgICB2YXIgX3NldEF1dG9IZWlnaHQgPSBmdW5jdGlvbihyZXNldCkgew0KICAgICAgICAgICAgICAgIC8vIGdldCB0YWIgaGVpZ2h0cyBpbiB0b3AgdG8gYm90dG9tIG9yZGVyZWQgYXJyYXkNCiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0cyA9ICQubWFwKGNvbnRhaW5lcnMuZ2V0KCksIGZ1bmN0aW9uKGVsKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBoLCBqcSA9ICQoZWwpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzZXQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkLmJyb3dzZXIubXNpZTYpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5yZW1vdmVFeHByZXNzaW9uKCdiZWhhdmlvdXInKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5oZWlnaHQgPSAnJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5taW5IZWlnaHQgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGpxLmNzcyh7J21pbi1oZWlnaHQnOiAnJ30pLmhlaWdodCgpOyAvLyB1c2UgalF1ZXJ5J3MgaGVpZ2h0KCkgdG8gZ2V0IGhpZGRlbiBlbGVtZW50IHZhbHVlcw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGpxLmhlaWdodCgpOyAvLyB1c2UgalF1ZXJ5J3MgaGVpZ2h0KCkgdG8gZ2V0IGhpZGRlbiBlbGVtZW50IHZhbHVlcw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBoOw0KICAgICAgICAgICAgICAgIH0pLnNvcnQoZnVuY3Rpb24oYSwgYikgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYiAtIGE7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgaWYgKCQuYnJvd3Nlci5tc2llNikgew0KICAgICAgICAgICAgICAgICAgICBjb250YWluZXJzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1pbkhlaWdodCA9IGhlaWdodHNbMF0gKyAncHgnOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZS5zZXRFeHByZXNzaW9uKCdiZWhhdmlvdXInLCAndGhpcy5zdHlsZS5oZWlnaHQgPSB0aGlzLm1pbkhlaWdodCA/IHRoaXMubWluSGVpZ2h0IDogIjFweCInKTsgLy8gdXNpbmcgYW4gZXhwcmVzc2lvbiB0byBub3QgbWFrZSBwcmludCBzdHlsZXMgdXNlbGVzcw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb250YWluZXJzLmNzcyh7J21pbi1oZWlnaHQnOiBoZWlnaHRzWzBdICsgJ3B4J30pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICAvLyBjYWxsIG9uY2UgZm9yIGluaXRpYWxpemF0aW9uDQogICAgICAgICAgICBfc2V0QXV0b0hlaWdodCgpOw0KICAgICAgICAgICAgLy8gdHJpZ2dlciBhdXRvIGhlaWdodCBhZGp1c3RtZW50IGlmIG5lZWRlZA0KICAgICAgICAgICAgdmFyIGNhY2hlZFdpZHRoID0gY29udGFpbmVyLm9mZnNldFdpZHRoOw0KICAgICAgICAgICAgdmFyIGNhY2hlZEhlaWdodCA9IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQ7DQogICAgICAgICAgICB2YXIgd2F0Y2hGb250U2l6ZSA9ICQoJyN0YWJzLXdhdGNoLWZvbnQtc2l6ZScpLmdldCgwKSB8fCAkKCc8c3BhbiBpZD0idGFicy13YXRjaC1mb250LXNpemUiPk08L3NwYW4+JykuY3NzKHtkaXNwbGF5OiAnYmxvY2snLCBwb3NpdGlvbjogJ2Fic29sdXRlJywgdmlzaWJpbGl0eTogJ2hpZGRlbid9KS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KS5nZXQoMCk7DQogICAgICAgICAgICB2YXIgY2FjaGVkRm9udFNpemUgPSB3YXRjaEZvbnRTaXplLm9mZnNldEhlaWdodDsNCiAgICAgICAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHZhciBjdXJyZW50V2lkdGggPSBjb250YWluZXIub2Zmc2V0V2lkdGg7DQogICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRIZWlnaHQgPSBjb250YWluZXIub2Zmc2V0SGVpZ2h0Ow0KICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Rm9udFNpemUgPSB3YXRjaEZvbnRTaXplLm9mZnNldEhlaWdodDsNCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEhlaWdodCA+IGNhY2hlZEhlaWdodCB8fCBjdXJyZW50V2lkdGggIT0gY2FjaGVkV2lkdGggfHwgY3VycmVudEZvbnRTaXplICE9IGNhY2hlZEZvbnRTaXplKSB7DQogICAgICAgICAgICAgICAgICAgIF9zZXRBdXRvSGVpZ2h0KChjdXJyZW50V2lkdGggPiBjYWNoZWRXaWR0aCB8fCBjdXJyZW50Rm9udFNpemUgPCBjYWNoZWRGb250U2l6ZSkpOyAvLyBpZiBoZWlnaHRzIGdldHMgc21hbGxlciByZXNldCBtaW4taGVpZ2h0DQogICAgICAgICAgICAgICAgICAgIGNhY2hlZFdpZHRoID0gY3VycmVudFdpZHRoOw0KICAgICAgICAgICAgICAgICAgICBjYWNoZWRIZWlnaHQgPSBjdXJyZW50SGVpZ2h0Ow0KICAgICAgICAgICAgICAgICAgICBjYWNoZWRGb250U2l6ZSA9IGN1cnJlbnRGb250U2l6ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCA1MCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBzZXR1cCBhbmltYXRpb25zDQogICAgICAgIHZhciBzaG93QW5pbSA9IHt9LCBoaWRlQW5pbSA9IHt9LCBzaG93U3BlZWQgPSBzZXR0aW5ncy5meFNob3dTcGVlZCB8fCBzZXR0aW5ncy5meFNwZWVkLCBoaWRlU3BlZWQgPSBzZXR0aW5ncy5meEhpZGVTcGVlZCB8fCBzZXR0aW5ncy5meFNwZWVkOw0KICAgICAgICBpZiAoc2V0dGluZ3MuZnhTbGlkZSB8fCBzZXR0aW5ncy5meEZhZGUpIHsNCiAgICAgICAgICAgIGlmIChzZXR0aW5ncy5meFNsaWRlKSB7DQogICAgICAgICAgICAgICAgc2hvd0FuaW1bJ2hlaWdodCddID0gJ3Nob3cnOw0KICAgICAgICAgICAgICAgIGhpZGVBbmltWydoZWlnaHQnXSA9ICdoaWRlJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzZXR0aW5ncy5meEZhZGUpIHsNCiAgICAgICAgICAgICAgICBzaG93QW5pbVsnb3BhY2l0eSddID0gJ3Nob3cnOw0KICAgICAgICAgICAgICAgIGhpZGVBbmltWydvcGFjaXR5J10gPSAnaGlkZSc7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoc2V0dGluZ3MuZnhTaG93KSB7DQogICAgICAgICAgICAgICAgc2hvd0FuaW0gPSBzZXR0aW5ncy5meFNob3c7DQogICAgICAgICAgICB9IGVsc2UgeyAvLyB1c2Ugc29tZSBraW5kIG9mIGFuaW1hdGlvbiB0byBwcmV2ZW50IGJyb3dzZXIgc2Nyb2xsaW5nIHRvIHRoZSB0YWINCiAgICAgICAgICAgICAgICBzaG93QW5pbVsnbWluLXdpZHRoJ10gPSAwOyAvLyBhdm9pZCBvcGFjaXR5LCBjYXVzZXMgZmxpY2tlciBpbiBGaXJlZm94DQogICAgICAgICAgICAgICAgc2hvd1NwZWVkID0gMTsgLy8gYXMgbGl0dGxlIGFzIDEgaXMgc3VmZmljaWVudA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHNldHRpbmdzLmZ4SGlkZSkgew0KICAgICAgICAgICAgICAgIGhpZGVBbmltID0gc2V0dGluZ3MuZnhIaWRlOw0KICAgICAgICAgICAgfSBlbHNlIHsgLy8gdXNlIHNvbWUga2luZCBvZiBhbmltYXRpb24gdG8gcHJldmVudCBicm93c2VyIHNjcm9sbGluZyB0byB0aGUgdGFiDQogICAgICAgICAgICAgICAgaGlkZUFuaW1bJ21pbi13aWR0aCddID0gMDsgLy8gYXZvaWQgb3BhY2l0eSwgY2F1c2VzIGZsaWNrZXIgaW4gRmlyZWZveA0KICAgICAgICAgICAgICAgIGhpZGVTcGVlZCA9IDE7IC8vIGFzIGxpdHRsZSBhcyAxIGlzIHN1ZmZpY2llbnQNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGNhbGxiYWNrcw0KICAgICAgICB2YXIgb25DbGljayA9IHNldHRpbmdzLm9uQ2xpY2ssIG9uSGlkZSA9IHNldHRpbmdzLm9uSGlkZSwgb25TaG93ID0gc2V0dGluZ3Mub25TaG93Ow0KDQogICAgICAgIC8vIGF0dGFjaCBhY3RpdmF0ZVRhYiBldmVudCwgcmVxdWlyZWQgZm9yIGFjdGl2YXRpbmcgYSB0YWIgcHJvZ3JhbW1hdGljYWxseQ0KICAgICAgICB0YWJzLmJpbmQoJ3RyaWdnZXJUYWInLCBmdW5jdGlvbigpIHsNCg0KICAgICAgICAgICAgLy8gaWYgdGhlIHRhYiBpcyBhbHJlYWR5IHNlbGVjdGVkIG9yIGRpc2FibGVkIG9yIGFuaW1hdGlvbiBpcyBzdGlsbCBydW5uaW5nIHN0b3AgaGVyZQ0KICAgICAgICAgICAgdmFyIGxpID0gJCh0aGlzKS5wYXJlbnRzKCdsaTplcSgwKScpOw0KICAgICAgICAgICAgaWYgKGNvbnRhaW5lci5sb2NrZWQgfHwgbGkuaXMoJy4nICsgc2V0dGluZ3Muc2VsZWN0ZWRDbGFzcykgfHwgbGkuaXMoJy4nICsgc2V0dGluZ3MuZGlzYWJsZWRDbGFzcykpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBoYXNoID0gdGhpcy5oYXNoOw0KDQogICAgICAgICAgICBpZiAoJC5icm93c2VyLm1zaWUpIHsNCg0KICAgICAgICAgICAgICAgICQodGhpcykudHJpZ2dlcignY2xpY2snKTsNCiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuYm9va21hcmthYmxlKSB7DQogICAgICAgICAgICAgICAgICAgICQuYWpheEhpc3RvcnkudXBkYXRlKGhhc2gpOw0KICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5oYXNoID0gaGFzaC5yZXBsYWNlKCcjJywgJycpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfSBlbHNlIGlmICgkLmJyb3dzZXIuc2FmYXJpKSB7DQoNCiAgICAgICAgICAgICAgICAvLyBTaW1wbHkgc2V0dGluZyBsb2NhdGlvbi5oYXNoIHB1dHMgU2FmYXJpIGludG8gdGhlIGV0ZXJuYWwgbG9hZCBzdGF0ZS4uLiB1Z2ghIFN1Ym1pdCBhIGZvcm0gaW5zdGVhZC4NCiAgICAgICAgICAgICAgICB2YXIgdGVtcEZvcm0gPSAkKCc8Zm9ybSBhY3Rpb249IicgKyBoYXNoICsgJyI+PGRpdj48aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iaCIgLz48L2Rpdj48L2Zvcm0+JykuZ2V0KDApOyAvLyBubyBuZWVkIHRvIGFwcGVuZCBpdCB0byB0aGUgYm9keQ0KICAgICAgICAgICAgICAgIHRlbXBGb3JtLnN1Ym1pdCgpOyAvLyBkb2VzIG5vdCB0cmlnZ2VyIHRoZSBmb3JtJ3Mgc3VibWl0IGV2ZW50Li4uDQogICAgICAgICAgICAgICAgJCh0aGlzKS50cmlnZ2VyKCdjbGljaycpOyAvLyAuLi50aHVzIGRvIHN0dWZmIGhlcmUNCiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuYm9va21hcmthYmxlKSB7DQogICAgICAgICAgICAgICAgICAgICQuYWpheEhpc3RvcnkudXBkYXRlKGhhc2gpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5ib29rbWFya2FibGUpIHsNCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24uaGFzaCA9IGhhc2gucmVwbGFjZSgnIycsICcnKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnRyaWdnZXIoJ2NsaWNrJyk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gYXR0YWNoIGRpc2FibGUgZXZlbnQsIHJlcXVpcmVkIGZvciBkaXNhYmxpbmcgYSB0YWINCiAgICAgICAgdGFicy5iaW5kKCdkaXNhYmxlVGFiJywgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgbGkgPSAkKHRoaXMpLnBhcmVudHMoJ2xpOmVxKDApJyk7DQogICAgICAgICAgICBpZiAoJC5icm93c2VyLnNhZmFyaSkgeyAvKiBmaXggb3BhY2l0eSBvZiB0YWIgYWZ0ZXIgZGlzYWJsaW5nIGluIFNhZmFyaS4uLiAqLw0KICAgICAgICAgICAgICAgIGxpLmFuaW1hdGUoeyBvcGFjaXR5OiAwIH0sIDEsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgIGxpLmNzcyh7b3BhY2l0eTogJyd9KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxpLmFkZENsYXNzKHNldHRpbmdzLmRpc2FibGVkQ2xhc3MpOw0KDQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIGRpc2FibGVkIGZyb20gc2V0dGluZ3MNCiAgICAgICAgaWYgKHNldHRpbmdzLmRpc2FibGVkICYmIHNldHRpbmdzLmRpc2FibGVkLmxlbmd0aCkgew0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGsgPSBzZXR0aW5ncy5kaXNhYmxlZC5sZW5ndGg7IGkgPCBrOyBpKyspIHsNCiAgICAgICAgICAgICAgICB0YWJzLmVxKC0tc2V0dGluZ3MuZGlzYWJsZWRbaV0pLnRyaWdnZXIoJ2Rpc2FibGVUYWInKS5lbmQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICAvLyBhdHRhY2ggZW5hYmxlIGV2ZW50LCByZXF1aXJlZCBmb3IgcmVlbmFibGluZyBhIHRhYg0KICAgICAgICB0YWJzLmJpbmQoJ2VuYWJsZVRhYicsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdmFyIGxpID0gJCh0aGlzKS5wYXJlbnRzKCdsaTplcSgwKScpOw0KICAgICAgICAgICAgbGkucmVtb3ZlQ2xhc3Moc2V0dGluZ3MuZGlzYWJsZWRDbGFzcyk7DQogICAgICAgICAgICBpZiAoJC5icm93c2VyLnNhZmFyaSkgeyAvKiBmaXggZGlzYXBwZWFyaW5nIHRhYiBhZnRlciBlbmFibGluZyBpbiBTYWZhcmkuLi4gKi8NCiAgICAgICAgICAgICAgICBsaS5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCAxLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgbGkuY3NzKHtvcGFjaXR5OiAnJ30pOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBhdHRhY2ggY2xpY2sgZXZlbnQNCiAgICAgICAgdGFicy5iaW5kKCdjbGljaycsIGZ1bmN0aW9uKGUpIHsNCg0KICAgICAgICAgICAgdmFyIHRydWVDbGljayA9IGUuY2xpZW50WDsgLy8gYWRkIHRvIGhpc3Rvcnkgb25seSBpZiB0cnVlIGNsaWNrIG9jY3VyZWQsIG5vdCBhIHRyaWdnZXJlZCBjbGljaw0KICAgICAgICAgICAgdmFyIGNsaWNrZWQgPSB0aGlzLCBsaSA9ICQodGhpcykucGFyZW50cygnbGk6ZXEoMCknKSwgdG9TaG93ID0gJCh0aGlzLmhhc2gpLCB0b0hpZGUgPSBjb250YWluZXJzLmZpbHRlcignOnZpc2libGUnKTsNCg0KICAgICAgICAgICAgLy8gaWYgYW5pbWF0aW9uIGlzIHN0aWxsIHJ1bm5pbmcsIHRhYiBpcyBzZWxlY3RlZCBvciBkaXNhYmxlZCBvciBvbkNsaWNrIGNhbGxiYWNrIHJldHVybnMgZmFsc2Ugc3RvcCBoZXJlDQogICAgICAgICAgICAvLyBjaGVjayBpZiBvbkNsaWNrIHJldHVybnMgZmFsc2UgbGFzdCBzbyB0aGF0IGl0IGlzIG5vdCBleGVjdXRlZCBmb3IgYSBkaXNhYmxlZCB0YWINCiAgICAgICAgICAgIGlmIChjb250YWluZXJbJ2xvY2tlZCddIHx8IGxpLmlzKCcuJyArIHNldHRpbmdzLnNlbGVjdGVkQ2xhc3MpIHx8IGxpLmlzKCcuJyArIHNldHRpbmdzLmRpc2FibGVkQ2xhc3MpIHx8IHR5cGVvZiBvbkNsaWNrID09ICdmdW5jdGlvbicgJiYgb25DbGljayh0aGlzLCB0b1Nob3dbMF0sIHRvSGlkZVswXSkgPT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgdGhpcy5ibHVyKCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb250YWluZXJbJ2xvY2tlZCddID0gdHJ1ZTsNCg0KICAgICAgICAgICAgLy8gc2hvdyBuZXcgdGFiDQogICAgICAgICAgICBpZiAodG9TaG93LnNpemUoKSkgew0KDQogICAgICAgICAgICAgICAgLy8gcHJldmVudCBzY3JvbGxiYXIgc2Nyb2xsaW5nIHRvIDAgYW5kIHRoYW4gYmFjayBpbiBJRTcsIGhhcHBlbnMgb25seSBpZiBib29rbWFya2luZy9oaXN0b3J5IGlzIGVuYWJsZWQNCiAgICAgICAgICAgICAgICBpZiAoJC5icm93c2VyLm1zaWUgJiYgc2V0dGluZ3MuYm9va21hcmthYmxlKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciB0b1Nob3dJZCA9IHRoaXMuaGFzaC5yZXBsYWNlKCcjJywgJycpOw0KICAgICAgICAgICAgICAgICAgICB0b1Nob3cuYXR0cignaWQnLCAnJyk7DQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0b1Nob3cuYXR0cignaWQnLCB0b1Nob3dJZCk7IC8vIHJlc3RvcmUgaWQNCiAgICAgICAgICAgICAgICAgICAgfSwgMCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdmFyIHJlc2V0Q1NTID0geyBkaXNwbGF5OiAnJywgb3ZlcmZsb3c6ICcnLCBoZWlnaHQ6ICcnIH07DQogICAgICAgICAgICAgICAgaWYgKCEkLmJyb3dzZXIubXNpZSkgeyAvLyBub3QgaW4gSUUgdG8gcHJldmVudCBDbGVhclR5cGUgZm9udCBpc3N1ZQ0KICAgICAgICAgICAgICAgICAgICByZXNldENTU1snb3BhY2l0eSddID0gJyc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIHN3aXRjaCB0YWIsIGFuaW1hdGlvbiBwcmV2ZW50cyBicm93c2VyIHNjcm9sbGluZyB0byB0aGUgZnJhZ21lbnQNCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzd2l0Y2hUYWIoKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5ib29rbWFya2FibGUgJiYgdHJ1ZUNsaWNrKSB7IC8vIGFkZCB0byBoaXN0b3J5IG9ubHkgaWYgdHJ1ZSBjbGljayBvY2N1cmVkLCBub3QgYSB0cmlnZ2VyZWQgY2xpY2sNCiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheEhpc3RvcnkudXBkYXRlKGNsaWNrZWQuaGFzaCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgdG9IaWRlLmFuaW1hdGUoaGlkZUFuaW0sIGhpZGVTcGVlZCwgZnVuY3Rpb24oKSB7IC8vDQogICAgICAgICAgICAgICAgICAgICAgICAkKGNsaWNrZWQpLnBhcmVudHMoJ2xpOmVxKDApJykuYWRkQ2xhc3Moc2V0dGluZ3Muc2VsZWN0ZWRDbGFzcykuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhzZXR0aW5ncy5zZWxlY3RlZENsYXNzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvSGlkZS5hZGRDbGFzcyhzZXR0aW5ncy5oaWRlQ2xhc3MpLmNzcyhyZXNldENTUyk7IC8vIG1haW50YWluIGZsZXhpYmxlIGhlaWdodCBhbmQgYWNjZXNzaWJpbGl0eSBpbiBwcmludCBldGMuICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9uSGlkZSA9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25IaWRlKGNsaWNrZWQsIHRvU2hvd1swXSwgdG9IaWRlWzBdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKHNldHRpbmdzLmZ4U2xpZGUgfHwgc2V0dGluZ3MuZnhGYWRlIHx8IHNldHRpbmdzLmZ4U2hvdykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Nob3cuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7IC8vIHByZXZlbnQgb2NjYXNpb25hbGx5IG9jY3VyaW5nIGZsaWNrZXIgaW4gRmlyZWZveCBjYXVzZSBieSBnYXAgYmV0d2VlbiBzaG93aW5nIGFuZCBoaWRpbmcgdGhlIHRhYiBjb250YWluZXJzDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB0b1Nob3cuYW5pbWF0ZShzaG93QW5pbSwgc2hvd1NwZWVkLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Nob3cucmVtb3ZlQ2xhc3Moc2V0dGluZ3MuaGlkZUNsYXNzKS5jc3MocmVzZXRDU1MpOyAvLyBtYWludGFpbiBmbGV4aWJsZSBoZWlnaHQgYW5kIGFjY2Vzc2liaWxpdHkgaW4gcHJpbnQgZXRjLg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkLmJyb3dzZXIubXNpZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b0hpZGVbMF0uc3R5bGUuZmlsdGVyID0gJyc7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvU2hvd1swXS5zdHlsZS5maWx0ZXIgPSAnJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvblNob3cgPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNob3coY2xpY2tlZCwgdG9TaG93WzBdLCB0b0hpZGVbMF0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJbJ2xvY2tlZCddID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoIXNldHRpbmdzLnJlbW90ZSkgew0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2hUYWIoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkKGNsaWNrZWQpLnRyaWdnZXIoJ2xvYWRSZW1vdGVUYWInLCBbc3dpdGNoVGFiXSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGFsZXJ0KCdUaGVyZSBpcyBubyBzdWNoIGNvbnRhaW5lci4nKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gU2V0IHNjcm9sbGJhciB0byBzYXZlZCBwb3NpdGlvbiAtIG5lZWQgdG8gdXNlIHRpbWVvdXQgd2l0aCAwIHRvIHByZXZlbnQgYnJvd3NlciBzY3JvbGwgdG8gdGFyZ2V0IG9mIGhhc2gNCiAgICAgICAgICAgIHZhciBzY3JvbGxYID0gd2luZG93LnBhZ2VYT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQgfHwgMDsNCiAgICAgICAgICAgIHZhciBzY3JvbGxZID0gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wIHx8IDA7DQogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyhzY3JvbGxYLCBzY3JvbGxZKTsNCiAgICAgICAgICAgIH0sIDApOw0KDQogICAgICAgICAgICB0aGlzLmJsdXIoKTsgLy8gcHJldmVudCBJRSBmcm9tIGtlZXBpbmcgb3RoZXIgbGluayBmb2N1c3NlZCB3aGVuIHVzaW5nIHRoZSBiYWNrIGJ1dHRvbg0KDQogICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MuYm9va21hcmthYmxlICYmICEhdHJ1ZUNsaWNrOyAvLyBjb252ZXJ0IHVuZGVmaW5lZCB0byBCb29sZWFuIGZvciBJRQ0KDQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIGVuYWJsZSBoaXN0b3J5IHN1cHBvcnQgaWYgYm9va21hcmtpbmcgYW5kIGhpc3RvcnkgaXMgdHVybmVkIG9uDQogICAgICAgIGlmIChzZXR0aW5ncy5ib29rbWFya2FibGUpIHsNCiAgICAgICAgICAgICQuYWpheEhpc3RvcnkuaW5pdGlhbGl6ZShmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICB0YWJzLmVxKHNldHRpbmdzLmluaXRpYWwpLnRyaWdnZXIoJ2NsaWNrJykuZW5kKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgfSk7DQoNCn07DQoNCi8qKg0KICogQWN0aXZhdGUgYSB0YWIgcHJvZ3JhbW1hdGljYWxseSB3aXRoIHRoZSBnaXZlbiBwb3NpdGlvbiAobm8gemVyby1iYXNlZCBpbmRleCkNCiAqIG9yIGl0cyBpZCwgZS5nLiB0aGUgVVJMJ3MgZnJhZ21lbnQgaWRlbnRpZmllci9oYXNoIHJlcHJlc2VudGluZyBhIHRhYiwgYXMgaWYgdGhlIHRhYg0KICogaXRzZWxmIHdlcmUgY2xpY2tlZC4NCiAqDQogKiBAZXhhbXBsZSAkKCcjY29udGFpbmVyJykudHJpZ2dlclRhYigyKTsNCiAqIEBkZXNjIEFjdGl2YXRlIHRoZSBzZWNvbmQgdGFiIG9mIHRoZSB0YWIgaW50ZXJmYWNlIGNvbnRhaW5lZCBpbiA8ZGl2IGlkPSJjb250YWluZXIiPi4NCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS50cmlnZ2VyVGFiKDEpOw0KICogQGRlc2MgQWN0aXZhdGUgdGhlIGZpcnN0IHRhYiBvZiB0aGUgdGFiIGludGVyZmFjZSBjb250YWluZWQgaW4gPGRpdiBpZD0iY29udGFpbmVyIj4uDQogKiBAZXhhbXBsZSAkKCcjY29udGFpbmVyJykudHJpZ2dlclRhYigpOw0KICogQGRlc2MgQWN0aXZhdGUgdGhlIGZpcnN0IHRhYiBvZiB0aGUgdGFiIGludGVyZmFjZSBjb250YWluZWQgaW4gPGRpdiBpZD0iY29udGFpbmVyIj4uDQogKiBAZXhhbXBsZSAkKCcjY29udGFpbmVyJykudHJpZ2dlclRhYignZnJhZ21lbnQtMicpOw0KICogQGRlc2MgQWN0aXZhdGUgYSB0YWIgdmlhIGl0cyBVUkwgZnJhZ21lbnQgaWRlbnRpZmllciByZXByZXNlbnRhdGlvbi4NCiAqDQogKiBAcGFyYW0gU3RyaW5nfE51bWJlciB0YWIgRWl0aGVyIGEgc3RyaW5nIHRoYXQgbWF0Y2hlcyB0aGUgaWQgb2YgdGhlIHRhYiAodGhlIFVSTCdzDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQgaWRlbnRpZmllci9oYXNoIHJlcHJlc2VudGluZyBhIHRhYikgb3IgYW4gaW50ZWdlcg0KICogICAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZnlpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSB0YWIgKG5vIHplcm8tYmFzZWQgaW5kZXgpIHRvDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgYmUgYWN0aXZhdGVkLiBJZiB0aGlzIHBhcmFtZXRlciBpcyBvbWl0dGVkLCB0aGUgZmlyc3QgdGFiDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSBhY3RpdmF0ZWQuDQogKiBAdHlwZSBqUXVlcnkNCiAqDQogKiBAbmFtZSB0cmlnZ2VyVGFiDQogKiBAY2F0IFBsdWdpbnMvVGFicw0KICogQGF1dGhvciBLbGF1cyBIYXJ0bC9rbGF1cy5oYXJ0bEBzdGlsYnVlcm8uZGUNCiAqLw0KDQovKioNCiAqIERpc2FibGUgYSB0YWIsIHNvIHRoYXQgY2xpY2tpbmcgaXQgaGFzIG5vIGVmZmVjdC4NCiAqDQogKiBAZXhhbXBsZSAkKCcjY29udGFpbmVyJykuZGlzYWJsZVRhYigyKTsNCiAqIEBkZXNjIERpc2FibGUgdGhlIHNlY29uZCB0YWIgb2YgdGhlIHRhYiBpbnRlcmZhY2UgY29udGFpbmVkIGluIDxkaXYgaWQ9ImNvbnRhaW5lciI+Lg0KICoNCiAqIEBwYXJhbSBTdHJpbmd8TnVtYmVyIHRhYiBFaXRoZXIgYSBzdHJpbmcgdGhhdCBtYXRjaGVzIHRoZSBpZCBvZiB0aGUgdGFiICh0aGUgVVJMJ3MNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCBpZGVudGlmaWVyL2hhc2ggcmVwcmVzZW50aW5nIGEgdGFiKSBvciBhbiBpbnRlZ2VyDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lmeWluZyB0aGUgcG9zaXRpb24gb2YgdGhlIHRhYiAobm8gemVyby1iYXNlZCBpbmRleCkgdG8NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBiZSBkaXNhYmxlZC4gSWYgdGhpcyBwYXJhbWV0ZXIgaXMgb21pdHRlZCwgdGhlIGZpcnN0IHRhYg0KICogICAgICAgICAgICAgICAgICAgICAgICAgIHdpbGwgYmUgZGlzYWJsZWQuDQogKiBAdHlwZSBqUXVlcnkNCiAqDQogKiBAbmFtZSBkaXNhYmxlVGFiDQogKiBAY2F0IFBsdWdpbnMvVGFicw0KICogQGF1dGhvciBLbGF1cyBIYXJ0bC9rbGF1cy5oYXJ0bEBzdGlsYnVlcm8uZGUNCiAqLw0KDQovKioNCiAqIEVuYWJsZSBhIHRhYiB0aGF0IGhhcyBiZWVuIGRpc2FibGVkLg0KICoNCiAqIEBleGFtcGxlICQoJyNjb250YWluZXInKS5lbmFibGVUYWIoMik7DQogKiBAZGVzYyBFbmFibGUgdGhlIHNlY29uZCB0YWIgb2YgdGhlIHRhYiBpbnRlcmZhY2UgY29udGFpbmVkIGluIDxkaXYgaWQ9ImNvbnRhaW5lciI+Lg0KICoNCiAqIEBwYXJhbSBTdHJpbmd8TnVtYmVyIHRhYiBFaXRoZXIgYSBzdHJpbmcgdGhhdCBtYXRjaGVzIHRoZSBpZCBvZiB0aGUgdGFiICh0aGUgVVJMJ3MNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCBpZGVudGlmaWVyL2hhc2ggcmVwcmVzZW50aW5nIGEgdGFiKSBvciBhbiBpbnRlZ2VyDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lmeWluZyB0aGUgcG9zaXRpb24gb2YgdGhlIHRhYiAobm8gemVyby1iYXNlZCBpbmRleCkgdG8NCiAqICAgICAgICAgICAgICAgICAgICAgICAgICBiZSBlbmFibGVkLiBJZiB0aGlzIHBhcmFtZXRlciBpcyBvbWl0dGVkLCB0aGUgZmlyc3QgdGFiDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSBlbmFibGVkLg0KICogQHR5cGUgalF1ZXJ5DQogKg0KICogQG5hbWUgZW5hYmxlVGFiDQogKiBAY2F0IFBsdWdpbnMvVGFicw0KICogQGF1dGhvciBLbGF1cyBIYXJ0bC9rbGF1cy5oYXJ0bEBzdGlsYnVlcm8uZGUNCiAqLw0KDQp2YXIgdGFiRXZlbnRzID0gWyd0cmlnZ2VyVGFiJywgJ2Rpc2FibGVUYWInLCAnZW5hYmxlVGFiJ107DQpmb3IgKHZhciBpID0gMDsgaSA8IHRhYkV2ZW50cy5sZW5ndGg7IGkrKykgew0KICAgICQuZm5bdGFiRXZlbnRzW2ldXSA9IChmdW5jdGlvbih0YWJFdmVudCkgew0KICAgICAgICByZXR1cm4gZnVuY3Rpb24odGFiKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIHZhciBuYXYgPSAkKCd1bC50YWJzLW5hdicgLCB0aGlzKTsNCiAgICAgICAgICAgICAgICBuYXYgPSBuYXYuc2l6ZSgpICYmIG5hdiB8fCAkKCc+dWw6ZXEoMCknLCB0aGlzKTsgLy8gZmFsbGJhY2sgdG8gZGVmYXVsdCBzdHJ1Y3R1cmUNCiAgICAgICAgICAgICAgICB2YXIgYTsNCiAgICAgICAgICAgICAgICBpZiAoIXRhYiB8fCB0eXBlb2YgdGFiID09ICdudW1iZXInKSB7DQogICAgICAgICAgICAgICAgICAgIGEgPSAkKCdsaSBhJywgbmF2KS5lcSgodGFiICYmIHRhYiA+IDAgJiYgdGFiIC0gMSB8fCAwKSk7IC8vIGZhbGwgYmFjayB0byAwDQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGFiID09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgICAgIGEgPSAkKCdsaSBhW0BocmVmJD0iIycgKyB0YWIgKyAnIl0nLCBuYXYpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBhLnRyaWdnZXIodGFiRXZlbnQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH07DQogICAgfSkodGFiRXZlbnRzW2ldKTsNCn0NCg0KLyoqDQogKiBHZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgdGFiIChubyB6ZXJvLWJhc2VkIGluZGV4KS4NCiAqDQogKiBAZXhhbXBsZSAkKCcjY29udGFpbmVyJykuYWN0aXZlVGFiKCk7DQogKiBAZGVzYyBHZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgdGFiIG9mIGFuIGludGVyZmFjZQ0KICogY29udGFpbmVkIGluIDxkaXYgaWQ9ImNvbnRhaW5lciI+Lg0KICoNCiAqIEB0eXBlIE51bWJlcg0KICoNCiAqIEBuYW1lIGFjdGl2ZVRhYg0KICogQGNhdCBQbHVnaW5zL1RhYnMNCiAqIEBhdXRob3IgS2xhdXMgSGFydGwva2xhdXMuaGFydGxAc3RpbGJ1ZXJvLmRlDQogKi8NCg0KJC5mbi5hY3RpdmVUYWIgPSBmdW5jdGlvbigpIHsNCiAgICB2YXIgc2VsZWN0ZWRUYWJzID0gW107DQogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgbmF2ID0gJCgndWwudGFicy1uYXYnICwgdGhpcyk7DQogICAgICAgIG5hdiA9IG5hdi5zaXplKCkgJiYgbmF2IHx8ICQoJz51bDplcSgwKScsIHRoaXMpOyAvL2ZhbGxiYWNrIHRvIGRlZmF1bHQgc3RydWN0dXJlDQogICAgICAgIHZhciBsaXMgPSAkKCdsaScsIG5hdik7DQogICAgICAgIHNlbGVjdGVkVGFicy5wdXNoKGxpcy5pbmRleCggbGlzLmZpbHRlcignLnRhYnMtc2VsZWN0ZWQnKVswXSApICsgMSk7DQogICAgfSk7DQogICAgcmV0dXJuIHNlbGVjdGVkVGFic1swXTsNCn07DQoNCn0pKGpRdWVyeSk7",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 01:51:51 GMT",
                    "Content-Length": "32457",
                    "Date": "Sun, 09 Nov 2014 01:51:51 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}