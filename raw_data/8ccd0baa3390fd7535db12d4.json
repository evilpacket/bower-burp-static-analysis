{
    "url": "http://localhost:9999/l1f7/trackr/src/trackr.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location</b> and written to <b>jQuery()</b> via the following statement:<ul><li>jQuery(location) </li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/l1f7/trackr/src/trackr.js",
                "path": "/l1f7/trackr/src/trackr.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9sMWY3L3RyYWNrci9zcmMvdHJhY2tyLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTkyMDMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFNhdCwgMDggTm92IDIwMTQgMjM6MTk6MDMgR01UDQpMYXN0LU1vZGlmaWVkOiBTYXQsIDA4IE5vdiAyMDE0IDIzOjE5OjAzIEdNVA0KDQoKLyogQFRPRE86IHZlcmlmeSBub24taW50ZXJhY3RpdmUgZXZlbnRzIGFyZSB3b3JraW5nCiAgICAgICAgICBodHRwOi8vd3d3Lmx1bmFtZXRyaWNzLmNvbS9ibG9nLzIwMTQvMDUvMDYvbm9uaW50ZXJhY3Rpb24tZXZlbnRzLWdvb2dsZS1hbmFseXRpY3MvI3NyPWcmbT1vJmNwPW9yJmN0PS10bWMmc3Q9KG9wdSUyMHFzcHdqZWZlKSZ0cz0xNDA2NzU1NzkxCgoKTmVlZCB0byB1c2UgdGhlIF9ub24taW50ZXJhY3Rpb25hbF8gYXR0cmlidXRlPyBKdXN0IGFkZCBgZGF0YS10cmFja3Itbm9pbnRlcmFjdGAuCgpgYGBodG1sCjxzcGFuIGRhdGEtdHJhY2tyPSJ2aWRlb3MvcGxheSIgZGF0YS10cmFja3Itbm9pbnRlcmFjdD4uLi48L3NwYW4+CmBgYAoKCi8qCiAgRWFzeSBldmVudCB0cmFja2luZyB3aXRoIEdvb2dsZSBBbmFseXRpY3MgdXNpbmcgYGRhdGEtYCBhdHRyaWJ1dGVzCiovCgooZnVuY3Rpb24od2luLCAkKXsKCiAgJ3VzZSBzdHJpY3QnOwoKICB3aW4uVHJhY2tyID0gewogICAgbmFtZSA6ICdUcmFja3InLAogICAgdmVyc2lvbiA6ICcwLjAuMycsCiAgICBocmVmIDogalF1ZXJ5KGxvY2F0aW9uKS5hdHRyKCdocmVmJyksCiAgICBkZWZhdWx0cyA6IHsKICAgICAgeW91dHViZSA6IGZhbHNlLAogICAgICBmYWNlYm9vayA6IGZhbHNlLAogICAgICB0d2l0dGVyIDogewogICAgICAgIGNsaWNrIDogZmFsc2UsCiAgICAgICAgdHdlZXQgOiBmYWxzZSwKICAgICAgICByZXR3ZWV0IDogZmFsc2UsCiAgICAgICAgZmF2b3JpdGUgOiBmYWxzZSwKICAgICAgICBmb2xsb3cgOiBmYWxzZQogICAgICB9LAogICAgICB0cmFja3IgOiB0cnVlCiAgICB9LAoKICAgIGluaXQgOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAvLyBzZXQgb3B0aW9ucwogICAgICB2YXIgb3B0cyA9ICQuZXh0ZW5kKHRydWUsIHt9LCB0aGlzLmRlZmF1bHRzLCBvcHRpb25zKTsKICAgICAgaWYgKG9wdHMudHJhY2tyID09PSB0cnVlKQogICAgICAgIHRoaXMubGlzdGVuKCk7CgogICAgICBpZiAob3B0cy5mYWNlYm9vayA9PT0gdHJ1ZSkKICAgICAgICB0aGlzLmZhY2Vib29rKCk7CgogICAgICBpZiAob3B0cy55b3V0dWJlID09PSB0cnVlKQogICAgICAgIHRoaXMueW91dHViZSgpOwoKICAgICAgaWYgKG9wdHMudHdpdHRlci5jbGljayA9PT0gdHJ1ZSB8fCBvcHRzLnR3aXR0ZXIudHdlZXQgPT09IHRydWUgfHwgb3B0cy50d2l0dGVyLnJldHdlZXQgPT09IHRydWUgfHwgb3B0cy50d2l0dGVyLmZhdm9yaXRlID09PSB0cnVlIHx8IG9wdHMudHdpdHRlci5mb2xsb3cgPT09IHRydWUpCiAgICAgICAgdGhpcy50d2l0dGVyKG9wdHMpOwoKICAgIH0sCgogICAgLyoKICAgICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgQmFzaWMgTGluayBUcmFja2luZyBTdHVmZgogICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICovCgogICAgICAgIC8qCiAgICAgICAgICogQXR0YWNoIGEgZGVsZWdhdGVkIGV2ZW50IGxpc3RlbmVyIGZvciBhbnkgZWxlbWVudCB3aXRoIHRoZSBgZGF0YS10cmFja3JgIGF0dHJpYnV0ZS4KICAgICAgICAgKiBEZWxlZ2F0ZWQgc28gaXQgd29ya3Mgd2l0aCBkeW5hbWljYWxseSBpbmplY3RlZCBjb250ZW50LgogICAgICAgICAqLwogICAgICAgIGxpc3RlbiA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS10cmFja3JdJywgZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgZGF0YSA9IFRyYWNrci5jb2xsZWN0KHRoaXMpOwogICAgICAgICAgICBUcmFja3IucmVwb3J0KGRhdGEpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAgICAgLyoKICAgICAgICAgKiBHYXRoZXIgZGF0YSB0byBiZSByZXBvcnRlZCBmcm9tIGBkYXRhLWAgYXR0cmlidXRlcy4KICAgICAgICAgKi8KICAgICAgICBjb2xsZWN0IDogZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICB2YXIgJGVsICAgPSAkKGVsKQogICAgICAgICAgLCAgIGRhdGEgID0gW10KICAgICAgICAgICwgICB0b3BpYyA9IHRoaXMuZm9ybWF0VG9waWMoJGVsLmRhdGEoJ3RyYWNrcicpKQogICAgICAgICAgLCAgIGxhYmVsRGVmYXVsdDsKCiAgICAgICAgICAvLyBkZWZhdWx0IGxhYmVsIHRvIGhyZWYgYXR0ciB1bmxlc3MgaXQncyBhbiBpbnRlcm5hbCBsaW5rCiAgICAgICAgICBpZiAoIS9eIy8udGVzdCgkZWwuYXR0cignaHJlZicpKSkgewogICAgICAgICAgICBsYWJlbERlZmF1bHQgPSAkZWwuYXR0cignaHJlZicpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIGNvbnN0cnVjdCB0aGUgZGF0YSB0byBwYXNzIHRvIEdvb2dsZSBBbmFseXRpY3MKICAgICAgICAgIGRhdGFbMF0gPSB0b3BpY1swXSB8fCB1bmRlZmluZWQ7CiAgICAgICAgICBkYXRhWzFdID0gdG9waWNbMV0gfHwgdW5kZWZpbmVkOwogICAgICAgICAgZGF0YVsyXSA9ICRlbC5kYXRhKCd0cmFja3ItbGFiZWwnKSB8fCBsYWJlbERlZmF1bHQ7CiAgICAgICAgICBkYXRhWzNdID0gJGVsLmRhdGEoJ3RyYWNrci12YWx1ZScpIHx8IHVuZGVmaW5lZDsKICAgICAgICAgIGRhdGFbNF0gPSAkZWwuZGF0YSgndHJhY2tyLW5vaW50ZXJhY3QnKSB8fCBmYWxzZTsKCiAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9LAoKICAgICAgICAvKgogICAgICAgICAqIFNwbGl0IGEgdG9waWMgc3RyaW5nIGludG8gY29tcG9uZW50cwogICAgICAgICAqIEByZXR1cm5zIEFycmF5IHRvIGJlIHVzZWQgYXMgW2NhdGVnb3J5LCBhY3Rpb25dCiAgICAgICAgICovCiAgICAgICAgZm9ybWF0VG9waWMgOiBmdW5jdGlvbiAoc3RyLCBkZWxpbWl0ZXIpIHsKICAgICAgICAgIGRlbGltaXRlciA9IGRlbGltaXRlciB8fCAnOic7CiAgICAgICAgICB2YXIgdG9waWMgPSBzdHIucmVwbGFjZSgvXC4vZywgJyAtICcpLnNwbGl0KGRlbGltaXRlcikgfHwgW107CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b3BpYy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0b3BpY1tpXSA9IHRoaXMudGl0bGVpemUodG9waWNbaV0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0b3BpYzsKICAgICAgICB9LAoKICAgICAgICAvKgogICAgICAgICAqIFB1c2ggZXZlbnQgdG8gR29vZ2xlIEFuYWx5dGljcwogICAgICAgICAqLwogICAgICAgIHJlcG9ydCA6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICB2YXIgcGFyYW1zOwoKICAgICAgICAgIC8vIGFib3J0IGlmIHJlcXVpcmVkIGRhdGEgaXMgbm90IHBhc3NlZCBpbi4KICAgICAgICAgIGlmICghZGF0YSB8fCBkYXRhWzBdID09PSB1bmRlZmluZWQgfHwgZGF0YVsxXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmKHdpbi5jb25zb2xlKQogICAgICAgICAgICAgIGNvbnNvbGUud2FybignQ2Fubm90IHJlcG9ydCBldmVudCB0byBHb29nbGUgQW5hbHl0aWNzOyByZXF1aXJlZCBkYXRhIG5vdCBwYXNzZWQgaW4uIFlvdSBuZWVkIHRvIHNldCBhdCBtaW5pbXVtIGEgY2F0ZWdvcnkvYWN0aW9uIG9uIHlvdXIgbGluaywgaWU6IDxhIGhyZWY9Imh0dHA6Ly9saW5rLmNvbSIgZGF0YS10cmFja3I9ImNhdGVnb3J5OmFjdGlvbiI+TGluay5jb208L2E+Jyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAod2luLmNvbnNvbGUpCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZW5kaW5nIGRhdGEgdG8gR0EnLCBkYXRhKTsKCiAgICAgICAgICAvLyBzZW5kIGV2ZW50CiAgICAgICAgICAvLyAoQFRPRE86IHRoaXMgYWxzbyBzZWVtcyBpbm9yZGluYXRlbHkgdWdseSwgbmVlZCB0byByZXZpc2l0KQogICAgICAgICAgd2luLmdhKCdzZW5kJywnZXZlbnQnLGRhdGFbMF0sZGF0YVsxXSxkYXRhWzJdLGRhdGFbM10sZGF0YVs0XSk7CiAgICAgICAgfSwKCiAgICAgICAgLy8gYm9ycm93ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZXBlbGkvdW5kZXJzY29yZS5zdHJpbmcKICAgICAgICB0aXRsZWl6ZSA6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgICAgIGlmIChzdHIgPT09IG51bGwpIHsgcmV0dXJuICcnOyB9CiAgICAgICAgICBzdHIgPSBTdHJpbmcoc3RyKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oPzpefFxzfC0pXFMvZywgZnVuY3Rpb24oYyl7IHJldHVybiBjLnRvVXBwZXJDYXNlKCk7IH0pOwogICAgICAgIH0sCgoKICAgIC8qCiAgICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgIEZhY2Vib29rCiAgICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgKi8KICAgICAgICBmYWNlYm9vayA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHdpbmRvdy5mYkFzeW5jSW5pdCA9IHRoaXMuZmJJbml0OwogICAgICAgIH0sCgogICAgICAgIGZiSW5pdCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEZCLkV2ZW50LnN1YnNjcmliZSgnZWRnZS5jcmVhdGUnLCBmdW5jdGlvbiAoaHJlZiwgd2lkZ2V0KSB7CiAgICAgICAgICAgIHZhciBkYXRhID0gVHJhY2tyLmNvbGxlY3Qod2lkZ2V0LnBhcmVudE5vZGUpOwoKICAgICAgICAgICAgLy8gYWJvcnQgaWYgcmVxdWlyZWQgZGF0YSBpcyBub3QgcGFzc2VkIGluLgogICAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YVswXSA9PT0gdW5kZWZpbmVkIHx8IGRhdGFbMV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGlmKHdpbi5jb25zb2xlKQogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDYW5ub3QgcmVwb3J0IGV2ZW50IHRvIEdvb2dsZSBBbmFseXRpY3M7IHJlcXVpcmVkIGRhdGEgbm90IHBhc3NlZCBpbi4gWW91IG5lZWQgdG8gc2V0IGF0IG1pbmltdW0gYSBjYXRlZ29yeS9hY3Rpb24gb24geW91ciBsaW5rLCBpZTogPGEgaHJlZj0iaHR0cDovL2xpbmsuY29tIiBkYXRhLXRyYWNrcj0iY2F0ZWdvcnk6YWN0aW9uIj5MaW5rLmNvbTwvYT4nKTsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh3aW4uY29uc29sZSkKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc2VuZGluZyBGQiBMaWtlOiAnLCBkYXRhKTsKCiAgICAgICAgICAgIGdhKCdzZW5kJywgJ3NvY2lhbCcsICdmYWNlYm9vaycsICdsaWtlJywgZGF0YVsyXSk7CiAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2ZhY2Vib29rJywgJ2xpa2UnLCBkYXRhWzJdKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vVW5saWtlcyB0aGUgcGFnZQogICAgICAgICAgRkIuRXZlbnQuc3Vic2NyaWJlKCdlZGdlLnJlbW92ZScsIGZ1bmN0aW9uIChocmVmLCB3aWRnZXQpIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSBUcmFja3IuY29sbGVjdCh3aWRnZXQucGFyZW50Tm9kZSk7CgogICAgICAgICAgICAvLyBhYm9ydCBpZiByZXF1aXJlZCBkYXRhIGlzIG5vdCBwYXNzZWQgaW4uCiAgICAgICAgICAgIGlmICghZGF0YSB8fCBkYXRhWzBdID09PSB1bmRlZmluZWQgfHwgZGF0YVsxXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgaWYod2luLmNvbnNvbGUpCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Nhbm5vdCByZXBvcnQgZXZlbnQgdG8gR29vZ2xlIEFuYWx5dGljczsgcmVxdWlyZWQgZGF0YSBub3QgcGFzc2VkIGluLiBZb3UgbmVlZCB0byB3cmFwIHlvdXIgRmFjZWJvb2sgZWxlbWVudCBpbiBhIGRpdiB3aXRoIHRoZSBkYXRhLXRyYWNrciBhdHRyaWJ1dGVzLCBpZTogPGRpdiBkYXRhLXRyYWNrcj0iY2F0ZWdvcnk6YWN0aW9uIiBkYXRhLXRyYWNrci1sYWJlbD0ibGFiZWwiPjxkaXYgY2xhc3M9ImZiLWxpa2UiIGRhdGEtaHJlZj0iaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tLyIgZGF0YS1sYXlvdT0ic3RhbmRhcmQiIGRhdGEtYWN0aW9uPSJsaWtlIiBkYXRhLXNob3ctZmFjZXM9InRydWUiIGRhdGEtc2hhcmU9InRydWUiPjwvZGl2PjwvZGl2PicpOwogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHdpbi5jb25zb2xlKQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZW5kaW5nIEZCIFVubGlrZTogJywgZGF0YSk7CgogICAgICAgICAgICBnYSgnc2VuZCcsICdzb2NpYWwnLCAnZmFjZWJvb2snLCAnbGlrZScsIGRhdGFbMl0pOwogICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmYWNlYm9vaycsICdsaWtlJywgZGF0YVsyXSk7CiAgICAgICAgICB9KTsKCgogICAgICAgICAgLy9TZW5kIG9yIFNoYXJlIFRoZSBQYWdlCiAgICAgICAgICAvLwogICAgICAgICAgLy8gVGhpcyBkb2Vzbid0IHdvcmsgZnJvbSB3aGF0IEkndmUgZm91bmQsIGJ1dCBsZWF2aW5nCiAgICAgICAgICAvLyBpbiBjYXNlIEkgZmlndXJlIHNvbWV0aGluZyBvdXQgaW4gdGhlIGZ1dHVyZQogICAgICAgICAgLy8KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBGQi5FdmVudC5zdWJzY3JpYmUoJ21lc3NhZ2Uuc2VuZCcsIGZ1bmN0aW9uIChocmVmLCB3aWRnZXQpIHsKICAgICAgICAgIC8vICAgdmFyIGRhdGEgPSBUcmFja3IuY29sbGVjdCh3aWRnZXQucGFyZW50Tm9kZSk7CgogICAgICAgICAgLy8gICAvLyBhYm9ydCBpZiByZXF1aXJlZCBkYXRhIGlzIG5vdCBwYXNzZWQgaW4uCiAgICAgICAgICAvLyAgIGlmICghZGF0YSB8fCBkYXRhWzBdID09PSB1bmRlZmluZWQgfHwgZGF0YVsxXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvLyAgICAgaWYod2luLmNvbnNvbGUpCiAgICAgICAgICAvLyAgICAgICBjb25zb2xlLndhcm4oJ0Nhbm5vdCByZXBvcnQgZXZlbnQgdG8gR29vZ2xlIEFuYWx5dGljczsgcmVxdWlyZWQgZGF0YSBub3QgcGFzc2VkIGluLiBZb3UgbmVlZCB0byBzZXQgYXQgbWluaW11bSBhIGNhdGVnb3J5L2FjdGlvbiBvbiB5b3VyIGxpbmssIGllOiA8YSBocmVmPSJodHRwOi8vbGluay5jb20iIGRhdGEtdHJhY2tyPSJjYXRlZ29yeTphY3Rpb24iPkxpbmsuY29tPC9hPicpOwogICAgICAgICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIC8vICAgfQoKICAgICAgICAgIC8vICAgaWYgKHdpbi5jb25zb2xlKQogICAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKCdzZW5kaW5nIEZCIFNoYXJlOiAnLCBkYXRhKTsKCiAgICAgICAgICAvLyAgIGdhKCdzZW5kJywgJ3NvY2lhbCcsICdmYWNlYm9vaycsICdzaGFyZScsIGRhdGFbMl0pOwogICAgICAgICAgLy8gICBnYSgnc2VuZCcsICdldmVudCcsICdmYWNlYm9vaycsICdzaGFyZScsIGRhdGFbMl0pOwogICAgICAgICAgLy8gfSk7CiAgICAgICAgfSwKCiAgICAvKgogICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICBUd2l0dGVyCiAgICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgKi8KICAgICAgLy8gVE9ETzogQnVpbGQgb3V0IG1vcmUgZnVuY3Rpb25hbGl0eQogICAgICAvLyAgICAgICBodHRwczovL2Rldi50d2l0dGVyLmNvbS9kb2NzL3Rmdy9ldmVudHMKICAgICAgICB0d2l0dGVyIDogZnVuY3Rpb24gKG9wdHMpIHsKICAgICAgICAgIHdpbi50d3R0ci5yZWFkeShmdW5jdGlvbiAodHd0dHIpIHsKICAgICAgICAgICAgaWYgKG9wdHMudHdpdHRlci5jbGljayA9PT0gdHJ1ZSkKICAgICAgICAgICAgICB0d3R0ci5ldmVudHMuYmluZCgnY2xpY2snLCBUcmFja3IudHdpdHRlckNsaWNrKTsKCiAgICAgICAgICAgIGlmIChvcHRzLnR3aXR0ZXIudHdlZXQgPT09IHRydWUpCiAgICAgICAgICAgICAgdHd0dHIuZXZlbnRzLmJpbmQoJ3R3ZWV0JywgVHJhY2tyLnR3aXR0ZXJUd2VldCk7CgogICAgICAgICAgICBpZiAob3B0cy50d2l0dGVyLnJldHdlZXQgPT09IHRydWUpCiAgICAgICAgICAgICAgdHd0dHIuZXZlbnRzLmJpbmQoJ3JldHdlZXQnLCBUcmFja3IudHdpdHRlclJldHdlZXQpOwoKICAgICAgICAgICAgaWYgKG9wdHMudHdpdHRlci5mYXZvcml0ZSA9PT0gdHJ1ZSkKICAgICAgICAgICAgICB0d3R0ci5ldmVudHMuYmluZCgnZmF2b3JpdGUnLCBUcmFja3IudHdpdHRlckZhdm9yaXRlKTsKCiAgICAgICAgICAgIGlmIChvcHRzLnR3aXR0ZXIuZm9sbG93ID09PSB0cnVlKQogICAgICAgICAgICAgIHR3dHRyLmV2ZW50cy5iaW5kKCdmb2xsb3cnLCBUcmFja3IudHdpdHRlckZvbGxvdyk7CgogICAgICAgICAgfSk7CgogICAgICAgIH0sCgogICAgICAgIHR3aXR0ZXJDbGljayA6IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgaWYgKCFldmVudCkgcmV0dXJuOwoKICAgICAgICAgIHZhciBkYXRhID0gVHJhY2tyLmNvbGxlY3QoZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUpOwoKICAgICAgICAgIC8vIGFib3J0IGlmIHJlcXVpcmVkIGRhdGEgaXMgbm90IHBhc3NlZCBpbi4KICAgICAgICAgIGlmICghZGF0YSB8fCBkYXRhWzBdID09PSB1bmRlZmluZWQgfHwgZGF0YVsxXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmKHdpbi5jb25zb2xlKQogICAgICAgICAgICAgIGNvbnNvbGUud2FybignQ2Fubm90IHJlcG9ydCBldmVudCB0byBHb29nbGUgQW5hbHl0aWNzOyByZXF1aXJlZCBkYXRhIG5vdCBwYXNzZWQgaW4uIFlvdSBuZWVkIHRvIHdyYXAgeW91ciBUd2l0dGVyIGVsZW1lbnQgaW4gYSBkaXYgd2l0aCB0aGUgZGF0YS10cmFja3IgYXR0cmlidXRlcywgaWU6IDxkaXYgZGF0YS10cmFja3I9ImNhdGVnb3J5OmFjdGlvbiIgZGF0YS10cmFja3ItbGFiZWw9ImxhYmVsIj48YSBocmVmPSJodHRwczovL3R3aXR0ZXIuY29tIiBjbGFzcz0idHdpdHRlci1zaGFyZS1idXR0b24iIGRhdGEtdXJsPSJodHRwOi8vd3d3LmxpZnRpbnRlcmFjdGl2ZS5jb20iPlR3ZWV0PC9hPjwvZGl2PicpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHdpbi5jb25zb2xlKQogICAgICAgICAgICBjb25zb2xlLmxvZygndHdpdHRlckNsaWNrIGRhdGE6ICcsIGRhdGEpOwoKICAgICAgICAgIC8vIHNlbmQgZXZlbnRzCiAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsIHsKICAgICAgICAgICAgJ2V2ZW50Q2F0ZWdvcnknOiBkYXRhWzBdLAogICAgICAgICAgICAnZXZlbnRBY3Rpb24nOiBkYXRhWzFdLAogICAgICAgICAgICAnZXZlbnRMYWJlbCcgOiBkYXRhWzJdLAogICAgICAgICAgICAnZXZlbnRWYWx1ZSc6IGRhdGFbM10KICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIHR3aXR0ZXJUd2VldCA6IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgaWYgKCFldmVudCkgcmV0dXJuOwoKICAgICAgICAgIHZhciBkYXRhID0gVHJhY2tyLmNvbGxlY3QoZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUpOwoKICAgICAgICAgIC8vIGFib3J0IGlmIHJlcXVpcmVkIGRhdGEgaXMgbm90IHBhc3NlZCBpbi4KICAgICAgICAgIGlmICghZGF0YSB8fCBkYXRhWzBdID09PSB1bmRlZmluZWQgfHwgZGF0YVsxXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmKHdpbi5jb25zb2xlKQogICAgICAgICAgICAgIGNvbnNvbGUud2FybignQ2Fubm90IHJlcG9ydCBldmVudCB0byBHb29nbGUgQW5hbHl0aWNzOyByZXF1aXJlZCBkYXRhIG5vdCBwYXNzZWQgaW4uIFlvdSBuZWVkIHRvIHdyYXAgeW91ciBUd2l0dGVyIGVsZW1lbnQgaW4gYSBkaXYgd2l0aCB0aGUgZGF0YS10cmFja3IgYXR0cmlidXRlcywgaWU6IDxkaXYgZGF0YS10cmFja3I9ImNhdGVnb3J5OmFjdGlvbiIgZGF0YS10cmFja3ItbGFiZWw9ImxhYmVsIj48YSBocmVmPSJodHRwczovL3R3aXR0ZXIuY29tIiBjbGFzcz0idHdpdHRlci1zaGFyZS1idXR0b24iIGRhdGEtdXJsPSJodHRwOi8vd3d3LmxpZnRpbnRlcmFjdGl2ZS5jb20iPlR3ZWV0PC9hPjwvZGl2PicpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHdpbi5jb25zb2xlKQogICAgICAgICAgICBjb25zb2xlLmxvZygnVHdlZXQgU2VudDogJywgZGF0YSk7CgoKICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgewogICAgICAgICAgICAnZXZlbnRDYXRlZ29yeSc6ICdUd2VldCBTZW50JywKICAgICAgICAgICAgJ2V2ZW50QWN0aW9uJzogZGF0YVsxXSwKICAgICAgICAgICAgJ2V2ZW50TGFiZWwnIDogZGF0YVsyXSwKICAgICAgICAgICAgJ2V2ZW50VmFsdWUnOiBkYXRhWzNdCiAgICAgICAgICB9KTsKICAgICAgICAgIGdhKCdzZW5kJywgewogICAgICAgICAgICAnaGl0VHlwZSc6ICdzb2NpYWwnLAogICAgICAgICAgICAnc29jaWFsTmV0d29yayc6ICdUd2l0dGVyJywKICAgICAgICAgICAgJ3NvY2lhbEFjdGlvbic6ICdUd2VldCcsCiAgICAgICAgICAgICdzb2NpYWxUYXJnZXQnOiBkb2N1bWVudC50aXRsZSwKICAgICAgICAgICAgJ3BhZ2UnOiBUcmFja3IuaHJlZgogICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAgICAgdHdpdHRlclJldHdlZXQgOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIGlmICghZXZlbnQpIHJldHVybjsKCiAgICAgICAgICB2YXIgZGF0YSA9IFRyYWNrci5jb2xsZWN0KGV2ZW50LnRhcmdldC5wYXJlbnROb2RlKTsKCiAgICAgICAgICAvLyBhYm9ydCBpZiByZXF1aXJlZCBkYXRhIGlzIG5vdCBwYXNzZWQgaW4uCiAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YVswXSA9PT0gdW5kZWZpbmVkIHx8IGRhdGFbMV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZih3aW4uY29uc29sZSkKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Nhbm5vdCByZXBvcnQgZXZlbnQgdG8gR29vZ2xlIEFuYWx5dGljczsgcmVxdWlyZWQgZGF0YSBub3QgcGFzc2VkIGluLiBZb3UgbmVlZCB0byB3cmFwIHlvdXIgVHdpdHRlciBlbGVtZW50IGluIGEgZGl2IHdpdGggdGhlIGRhdGEtdHJhY2tyIGF0dHJpYnV0ZXMsIGllOiA8ZGl2IGRhdGEtdHJhY2tyPSJjYXRlZ29yeTphY3Rpb24iIGRhdGEtdHJhY2tyLWxhYmVsPSJsYWJlbCI+PGEgaHJlZj0iaHR0cHM6Ly90d2l0dGVyLmNvbSIgY2xhc3M9InR3aXR0ZXItc2hhcmUtYnV0dG9uIiBkYXRhLXVybD0iaHR0cDovL3d3dy5saWZ0aW50ZXJhY3RpdmUuY29tIj5Ud2VldDwvYT48L2Rpdj4nKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh3aW4uY29uc29sZSkKICAgICAgICAgICAgY29uc29sZS5sb2coJ1JldHdlZXQ6ICcsIGRhdGEpOwoKCiAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsIHsKICAgICAgICAgICAgJ2V2ZW50Q2F0ZWdvcnknOiAnUmV0d2VldGVkJywKICAgICAgICAgICAgJ2V2ZW50QWN0aW9uJzogZGF0YVsxXSwKICAgICAgICAgICAgJ2V2ZW50TGFiZWwnIDogZGF0YVsyXSwKICAgICAgICAgICAgJ2V2ZW50VmFsdWUnOiBkYXRhWzNdCiAgICAgICAgICB9KTsKICAgICAgICAgIGdhKCdzZW5kJywgewogICAgICAgICAgICAnaGl0VHlwZSc6ICdzb2NpYWwnLAogICAgICAgICAgICAnc29jaWFsTmV0d29yayc6ICdUd2l0dGVyJywKICAgICAgICAgICAgJ3NvY2lhbEFjdGlvbic6ICdSZXR3ZWV0JywKICAgICAgICAgICAgJ3NvY2lhbFRhcmdldCc6IGRvY3VtZW50LnRpdGxlLAogICAgICAgICAgICAncGFnZSc6IFRyYWNrci5ocmVmCiAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICB0d2l0dGVyRmF2b3JpdGUgOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIGlmICghZXZlbnQpIHJldHVybjsKCiAgICAgICAgICB2YXIgZGF0YSA9IFRyYWNrci5jb2xsZWN0KGV2ZW50LnRhcmdldC5wYXJlbnROb2RlKTsKCiAgICAgICAgICAvLyBhYm9ydCBpZiByZXF1aXJlZCBkYXRhIGlzIG5vdCBwYXNzZWQgaW4uCiAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YVswXSA9PT0gdW5kZWZpbmVkIHx8IGRhdGFbMV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZih3aW4uY29uc29sZSkKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Nhbm5vdCByZXBvcnQgZXZlbnQgdG8gR29vZ2xlIEFuYWx5dGljczsgcmVxdWlyZWQgZGF0YSBub3QgcGFzc2VkIGluLiBZb3UgbmVlZCB0byB3cmFwIHlvdXIgVHdpdHRlciBlbGVtZW50IGluIGEgZGl2IHdpdGggdGhlIGRhdGEtdHJhY2tyIGF0dHJpYnV0ZXMsIGllOiA8ZGl2IGRhdGEtdHJhY2tyPSJjYXRlZ29yeTphY3Rpb24iIGRhdGEtdHJhY2tyLWxhYmVsPSJsYWJlbCI+PGEgaHJlZj0iaHR0cHM6Ly90d2l0dGVyLmNvbSIgY2xhc3M9InR3aXR0ZXItc2hhcmUtYnV0dG9uIiBkYXRhLXVybD0iaHR0cDovL3d3dy5saWZ0aW50ZXJhY3RpdmUuY29tIj5Ud2VldDwvYT48L2Rpdj4nKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh3aW4uY29uc29sZSkKICAgICAgICAgICAgY29uc29sZS5sb2coJ1R3aXR0ZXIgRmF2b3JpdGVkOiAnLCBkYXRhKTsKCgogICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCB7CiAgICAgICAgICAgICdldmVudENhdGVnb3J5JzogJ1R3aXR0ZXIgRmF2b3JpdGUnLAogICAgICAgICAgICAnZXZlbnRBY3Rpb24nOiBkYXRhWzFdLAogICAgICAgICAgICAnZXZlbnRMYWJlbCcgOiBkYXRhWzJdLAogICAgICAgICAgICAnZXZlbnRWYWx1ZSc6IGRhdGFbM10KICAgICAgICAgIH0pOwogICAgICAgICAgZ2EoJ3NlbmQnLCB7CiAgICAgICAgICAgICdoaXRUeXBlJzogJ3NvY2lhbCcsCiAgICAgICAgICAgICdzb2NpYWxOZXR3b3JrJzogJ1R3aXR0ZXInLAogICAgICAgICAgICAnc29jaWFsQWN0aW9uJzogJ0Zhdm9yaXRlJywKICAgICAgICAgICAgJ3NvY2lhbFRhcmdldCc6IGRvY3VtZW50LnRpdGxlLAogICAgICAgICAgICAncGFnZSc6IFRyYWNrci5ocmVmCiAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICB0d2l0dGVyRm9sbG93IDogZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygndHdpdHRlciBmb2xsb3cnKTsKICAgICAgICAgIGlmICghZXZlbnQpIHJldHVybjsKCiAgICAgICAgICB2YXIgZGF0YSA9IFRyYWNrci5jb2xsZWN0KGV2ZW50LnRhcmdldC5wYXJlbnROb2RlKTsKCiAgICAgICAgICAvLyBhYm9ydCBpZiByZXF1aXJlZCBkYXRhIGlzIG5vdCBwYXNzZWQgaW4uCiAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YVswXSA9PT0gdW5kZWZpbmVkIHx8IGRhdGFbMV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZih3aW4uY29uc29sZSkKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Nhbm5vdCByZXBvcnQgZXZlbnQgdG8gR29vZ2xlIEFuYWx5dGljczsgcmVxdWlyZWQgZGF0YSBub3QgcGFzc2VkIGluLiBZb3UgbmVlZCB0byB3cmFwIHlvdXIgVHdpdHRlciBlbGVtZW50IGluIGEgZGl2IHdpdGggdGhlIGRhdGEtdHJhY2tyIGF0dHJpYnV0ZXMsIGllOiA8ZGl2IGRhdGEtdHJhY2tyPSJjYXRlZ29yeTphY3Rpb24iIGRhdGEtdHJhY2tyLWxhYmVsPSJsYWJlbCI+PGEgaHJlZj0iaHR0cHM6Ly90d2l0dGVyLmNvbSIgY2xhc3M9InR3aXR0ZXItc2hhcmUtYnV0dG9uIiBkYXRhLXVybD0iaHR0cDovL3d3dy5saWZ0aW50ZXJhY3RpdmUuY29tIj5Ud2VldDwvYT48L2Rpdj4nKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh3aW4uY29uc29sZSkKICAgICAgICAgICAgY29uc29sZS5sb2coJ1JldHdlZXQ6ICcsIGRhdGEpOwoKCiAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsIHsKICAgICAgICAgICAgJ2V2ZW50Q2F0ZWdvcnknOiAnVHdpdHRlciBGb2xsb3cnLAogICAgICAgICAgICAnZXZlbnRBY3Rpb24nOiBkYXRhWzFdLAogICAgICAgICAgICAnZXZlbnRMYWJlbCcgOiBkYXRhWzJdLAogICAgICAgICAgICAnZXZlbnRWYWx1ZSc6IGRhdGFbM10KICAgICAgICAgIH0pOwogICAgICAgICAgZ2EoJ3NlbmQnLCB7CiAgICAgICAgICAgICdoaXRUeXBlJzogJ3NvY2lhbCcsCiAgICAgICAgICAgICdzb2NpYWxOZXR3b3JrJzogJ1R3aXR0ZXInLAogICAgICAgICAgICAnc29jaWFsQWN0aW9uJzogJ0ZvbGxvdycsCiAgICAgICAgICAgICdzb2NpYWxUYXJnZXQnOiBkb2N1bWVudC50aXRsZSwKICAgICAgICAgICAgJ3BhZ2UnOiBUcmFja3IuaHJlZgogICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAvKgogICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICBZb3VUdWJlCiAgICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgKi8KCiAgICAgICAgeW91dHViZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmKCF3aW4uWVQpewogICAgICAgICAgICBpZih3aW4uY29uc29sZSkKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnWW91VHViZSBhcGkgaXMgbm9uLWV4aXN0YW50LiBJbmplY3RpbmcgQVBJLicpOwoKICAgICAgICAgICAgLy8gSW5qZWN0IEFQSQogICAgICAgICAgICB2YXIgaiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpLAogICAgICAgICAgICBmID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpWzBdOwogICAgICAgICAgICBqLnNyYyA9ICcvL3d3dy55b3V0dWJlLmNvbS9pZnJhbWVfYXBpJzsKICAgICAgICAgICAgai5hc3luYyA9IHRydWU7CiAgICAgICAgICAgIGYucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoaiwgZik7CgogICAgICAgICAgICAvLyBPbmNlIFlvdVR1YmUgYXBpIGhhcyBsb2FkZWQKICAgICAgICAgICAgai5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgd2luLm9uWW91VHViZUlmcmFtZUFQSVJlYWR5ID0gVHJhY2tyLm9uWW91VHViZUlmcmFtZUFQSVJlYWR5OwogICAgICAgICAgICB9OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2luLm9uWW91VHViZUlmcmFtZUFQSVJlYWR5ID0gdGhpcy5vbllvdVR1YmVJZnJhbWVBUElSZWFkeTsKICAgICAgICAgIH0KICAgICAgICB9LAoKCiAgICAgICAgLyoKICAgICAgICAgKiBBdHRhY2ggb3VyIFlUIGxpc3RlbmVyIG9uY2UgdGhlIEFQSSBpcyBsb2FkZWQKICAgICAgICAgKgogICAgICAgICAqIER1ZSB0byB0aGUgZW5jYXBzdWxhdGVkIG5hdHVyZSBoZXJlLCBJIGhhZCB0byBhZGQgdGhlCiAgICAgICAgICogdmFyaW91cyBldmVudHMgZGlyZWN0bHkgaW5zaWRlIHRoZSBpbml0aWFsaXphdGlvbgogICAgICAgICAqIChvcmlnaW5hbGx5IHdhbnRlZCB0aGVtIHRvIGJlIHBhcnQgb2YgdGhlIG1haW4gVHJhY2tyIG9iamVjdCkKICAgICAgICAgKi8KICAgICAgICBvbllvdVR1YmVJZnJhbWVBUElSZWFkeSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGZvciAodmFyIGUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaWZyYW1lJyksIHggPSBlLmxlbmd0aDsgeC0tOyl7CgogICAgICAgICAgICBpZiAoL3lvdXR1YmUuY29tXC9lbWJlZC8udGVzdChlW3hdLnNyYykpIHsKICAgICAgICAgICAgICBuZXcgWVQuUGxheWVyKGVbeF0sIHsKICAgICAgICAgICAgICAgIGV2ZW50czogewoKICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICogV2hlbiB0aGUgQVBJIGlzIGFsbCBzZXR1cCBhbmQgdGhlIFlvdVR1YmUgcGxheWVyIGlzIHJlYWR5CiAgICAgICAgICAgICAgICAgICAqIExlYXZpbmcgZm9yIGxhdGVyLCBub3Qgc3VyZSB3aGF0IHRvIGRvIHdpdGggdGhpcyBub3cuCiAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAnb25SZWFkeSc6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgKiBMaXN0ZW4gZm9yIGNoYW5nZXMgaW4gdGhlIHZpZGVvIHBsYXllciwgZmlyZSBhcHByb3ByaWF0ZSBldmVudHMgdG8gR0EKICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICdvblN0YXRlQ2hhbmdlJzogZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGVyY2VudElEOwogICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gZVsndGFyZ2V0J10uZ2V0VmlkZW9EYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVbJ2RhdGEnXSA9PT0gWVQuUGxheWVyU3RhdGUuUExBWUlORykgewogICAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudENhdGVnb3J5JzogJ1lvdVR1YmUnLAogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRBY3Rpb24nOiAnUGxheScsCiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudExhYmVsJyA6IGRhdGFbJ3RpdGxlJ10gKyAnIDogJyArIGVbJ3RhcmdldCddLmdldFZpZGVvVXJsKCkKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgLy8gUmVwb3J0ICUgcGxheWVkIGV2ZXJ5IHNlY29uZAogICAgICAgICAgICAgICAgICAgICAgdmFyIG9uUGxheWVyUGVyY2VudCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gZVsnZ2V0RHVyYXRpb24nXSgpIC0gZVsnZ2V0Q3VycmVudFRpbWUnXSgpIDw9IDEuNSA/IDEgOiAoTWF0aC5mbG9vcihlWydnZXRDdXJyZW50VGltZSddKCkgLyBlWydnZXREdXJhdGlvbiddKCkgKiA0KSAvIDQpLnRvRml4ZWQoMik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZVsnbGFzdFAnXSB8fCB0ID4gZVsnbGFzdFAnXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGVbJ2xhc3RQJ10gPSB0OwogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwbGF5ZWQ6ICcrICh0ICogMTAwICsgJyUnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRDYXRlZ29yeSc6ICdZb3VUdWJlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdldmVudEFjdGlvbic6ICdQZXJjZW50YWdlJyArICh0ICogMTAwICsgJyUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdldmVudExhYmVsJyA6IGRhdGFbJ3RpdGxlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRWYWx1ZSc6IHQgKiAxMDAKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAvL2dhKCdzZW5kJywgJ2V2ZW50JywgJ3lvdXR1YmUnLCAncGxheWVkOiAnKyAodCAqIDEwMCArICIlIikpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgZVsnbGFzdFAnXSAhPT0gMSAmJiBzZXRUaW1lb3V0KG9uUGxheWVyUGVyY2VudCwgMTAwMCwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qIGpzaGludCBpZ25vcmU6ZW5kICovCiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChvblBsYXllclBlcmNlbnQsIDEwMDAsIGVbJ3RhcmdldCddKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFNlbmQgZXZlbnQgb24gUGF1c2VkCiAgICAgICAgICAgICAgICAgICAgaWYgKGVbJ2RhdGEnXSA9PT0gWVQuUGxheWVyU3RhdGUuUEFVU0VEKSB7CiAgICAgICAgICAgICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsIHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50Q2F0ZWdvcnknOiAnWW91VHViZScsCiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudEFjdGlvbic6ICdQYXVzZScsCiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudExhYmVsJyA6IGRhdGFbJ3RpdGxlJ10gKyAnIDogJyArIGVbJ3RhcmdldCddLmdldFZpZGVvVXJsKCkKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gU2VuZCBldmVudCBvbiBDb21wbGV0ZWQKICAgICAgICAgICAgICAgICAgICBpZiAoZVsnZGF0YSddID09PSBZVC5QbGF5ZXJTdGF0ZS5FTkRFRCkgewogICAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudENhdGVnb3J5JzogJ1lvdVR1YmUnLAogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRBY3Rpb24nOiAnQ29tcGxldGVkJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50TGFiZWwnIDogZGF0YVsndGl0bGUnXSArICcgOiAnICsgZVsndGFyZ2V0J10uZ2V0VmlkZW9VcmwoKQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LAoKCiAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAqIENhdGNoIGFsbCB0byByZXBvcnQgZXJyb3JzIHRocm91Z2ggdGhlIEdUTSBkYXRhIGxheWVyCiAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAnb25FcnJvcic6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGVbJ3RhcmdldCddLmdldFZpZGVvRGF0YSgpOwogICAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudENhdGVnb3J5JzogJ1lvdVR1YmUnLAogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRBY3Rpb24nOiAnRXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRMYWJlbCcgOiBkYXRhWyd0aXRsZSddICsgJyA6ICcgKyBlWyd0YXJnZXQnXS5nZXRWaWRlb1VybCgpCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICB9OwoKICAvKgogICAqIEF0dGFjaCBvdXIgVHJhY2tyIHNjcmlwdCB0byBqUXVlcnkKICAgKi8KICAkLmZuLnRyYWNrciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAvLyBhYm9ydCBpZiBHb29nbGUgQW5hbHl0aWNzIGRvZXNuJ3QgZXhpc3QKICAgIGlmICghd2luLmdhKSB7CiAgICAgIGlmICh3aW5kb3cuY29uc29sZSkKICAgICAgICBjb25zb2xlLmxvZygnR29vZ2xlIEFuYWx5dGljcyBVbml2ZXJzYWwgZG9lcyBub3QgZXhpc3QnKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIFRyYWNrci5pbml0KG9wdGlvbnMpOwogIH07Cn0pKHdpbmRvdywgd2luZG93LmpRdWVyeSk7Cgo=",
                "body": "Ci8qIEBUT0RPOiB2ZXJpZnkgbm9uLWludGVyYWN0aXZlIGV2ZW50cyBhcmUgd29ya2luZwogICAgICAgICAgaHR0cDovL3d3dy5sdW5hbWV0cmljcy5jb20vYmxvZy8yMDE0LzA1LzA2L25vbmludGVyYWN0aW9uLWV2ZW50cy1nb29nbGUtYW5hbHl0aWNzLyNzcj1nJm09byZjcD1vciZjdD0tdG1jJnN0PShvcHUlMjBxc3B3amVmZSkmdHM9MTQwNjc1NTc5MQoKCk5lZWQgdG8gdXNlIHRoZSBfbm9uLWludGVyYWN0aW9uYWxfIGF0dHJpYnV0ZT8gSnVzdCBhZGQgYGRhdGEtdHJhY2tyLW5vaW50ZXJhY3RgLgoKYGBgaHRtbAo8c3BhbiBkYXRhLXRyYWNrcj0idmlkZW9zL3BsYXkiIGRhdGEtdHJhY2tyLW5vaW50ZXJhY3Q+Li4uPC9zcGFuPgpgYGAKCgovKgogIEVhc3kgZXZlbnQgdHJhY2tpbmcgd2l0aCBHb29nbGUgQW5hbHl0aWNzIHVzaW5nIGBkYXRhLWAgYXR0cmlidXRlcwoqLwoKKGZ1bmN0aW9uKHdpbiwgJCl7CgogICd1c2Ugc3RyaWN0JzsKCiAgd2luLlRyYWNrciA9IHsKICAgIG5hbWUgOiAnVHJhY2tyJywKICAgIHZlcnNpb24gOiAnMC4wLjMnLAogICAgaHJlZiA6IGpRdWVyeShsb2NhdGlvbikuYXR0cignaHJlZicpLAogICAgZGVmYXVsdHMgOiB7CiAgICAgIHlvdXR1YmUgOiBmYWxzZSwKICAgICAgZmFjZWJvb2sgOiBmYWxzZSwKICAgICAgdHdpdHRlciA6IHsKICAgICAgICBjbGljayA6IGZhbHNlLAogICAgICAgIHR3ZWV0IDogZmFsc2UsCiAgICAgICAgcmV0d2VldCA6IGZhbHNlLAogICAgICAgIGZhdm9yaXRlIDogZmFsc2UsCiAgICAgICAgZm9sbG93IDogZmFsc2UKICAgICAgfSwKICAgICAgdHJhY2tyIDogdHJ1ZQogICAgfSwKCiAgICBpbml0IDogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgLy8gc2V0IG9wdGlvbnMKICAgICAgdmFyIG9wdHMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5kZWZhdWx0cywgb3B0aW9ucyk7CiAgICAgIGlmIChvcHRzLnRyYWNrciA9PT0gdHJ1ZSkKICAgICAgICB0aGlzLmxpc3RlbigpOwoKICAgICAgaWYgKG9wdHMuZmFjZWJvb2sgPT09IHRydWUpCiAgICAgICAgdGhpcy5mYWNlYm9vaygpOwoKICAgICAgaWYgKG9wdHMueW91dHViZSA9PT0gdHJ1ZSkKICAgICAgICB0aGlzLnlvdXR1YmUoKTsKCiAgICAgIGlmIChvcHRzLnR3aXR0ZXIuY2xpY2sgPT09IHRydWUgfHwgb3B0cy50d2l0dGVyLnR3ZWV0ID09PSB0cnVlIHx8IG9wdHMudHdpdHRlci5yZXR3ZWV0ID09PSB0cnVlIHx8IG9wdHMudHdpdHRlci5mYXZvcml0ZSA9PT0gdHJ1ZSB8fCBvcHRzLnR3aXR0ZXIuZm9sbG93ID09PSB0cnVlKQogICAgICAgIHRoaXMudHdpdHRlcihvcHRzKTsKCiAgICB9LAoKICAgIC8qCiAgICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgIEJhc2ljIExpbmsgVHJhY2tpbmcgU3R1ZmYKICAgICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAqLwoKICAgICAgICAvKgogICAgICAgICAqIEF0dGFjaCBhIGRlbGVnYXRlZCBldmVudCBsaXN0ZW5lciBmb3IgYW55IGVsZW1lbnQgd2l0aCB0aGUgYGRhdGEtdHJhY2tyYCBhdHRyaWJ1dGUuCiAgICAgICAgICogRGVsZWdhdGVkIHNvIGl0IHdvcmtzIHdpdGggZHluYW1pY2FsbHkgaW5qZWN0ZWQgY29udGVudC4KICAgICAgICAgKi8KICAgICAgICBsaXN0ZW4gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnW2RhdGEtdHJhY2tyXScsIGZ1bmN0aW9uIChldikgewogICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdmFyIGRhdGEgPSBUcmFja3IuY29sbGVjdCh0aGlzKTsKICAgICAgICAgICAgVHJhY2tyLnJlcG9ydChkYXRhKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIC8qCiAgICAgICAgICogR2F0aGVyIGRhdGEgdG8gYmUgcmVwb3J0ZWQgZnJvbSBgZGF0YS1gIGF0dHJpYnV0ZXMuCiAgICAgICAgICovCiAgICAgICAgY29sbGVjdCA6IGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgdmFyICRlbCAgID0gJChlbCkKICAgICAgICAgICwgICBkYXRhICA9IFtdCiAgICAgICAgICAsICAgdG9waWMgPSB0aGlzLmZvcm1hdFRvcGljKCRlbC5kYXRhKCd0cmFja3InKSkKICAgICAgICAgICwgICBsYWJlbERlZmF1bHQ7CgogICAgICAgICAgLy8gZGVmYXVsdCBsYWJlbCB0byBocmVmIGF0dHIgdW5sZXNzIGl0J3MgYW4gaW50ZXJuYWwgbGluawogICAgICAgICAgaWYgKCEvXiMvLnRlc3QoJGVsLmF0dHIoJ2hyZWYnKSkpIHsKICAgICAgICAgICAgbGFiZWxEZWZhdWx0ID0gJGVsLmF0dHIoJ2hyZWYnKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBjb25zdHJ1Y3QgdGhlIGRhdGEgdG8gcGFzcyB0byBHb29nbGUgQW5hbHl0aWNzCiAgICAgICAgICBkYXRhWzBdID0gdG9waWNbMF0gfHwgdW5kZWZpbmVkOwogICAgICAgICAgZGF0YVsxXSA9IHRvcGljWzFdIHx8IHVuZGVmaW5lZDsKICAgICAgICAgIGRhdGFbMl0gPSAkZWwuZGF0YSgndHJhY2tyLWxhYmVsJykgfHwgbGFiZWxEZWZhdWx0OwogICAgICAgICAgZGF0YVszXSA9ICRlbC5kYXRhKCd0cmFja3ItdmFsdWUnKSB8fCB1bmRlZmluZWQ7CiAgICAgICAgICBkYXRhWzRdID0gJGVsLmRhdGEoJ3RyYWNrci1ub2ludGVyYWN0JykgfHwgZmFsc2U7CgogICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgfSwKCiAgICAgICAgLyoKICAgICAgICAgKiBTcGxpdCBhIHRvcGljIHN0cmluZyBpbnRvIGNvbXBvbmVudHMKICAgICAgICAgKiBAcmV0dXJucyBBcnJheSB0byBiZSB1c2VkIGFzIFtjYXRlZ29yeSwgYWN0aW9uXQogICAgICAgICAqLwogICAgICAgIGZvcm1hdFRvcGljIDogZnVuY3Rpb24gKHN0ciwgZGVsaW1pdGVyKSB7CiAgICAgICAgICBkZWxpbWl0ZXIgPSBkZWxpbWl0ZXIgfHwgJzonOwogICAgICAgICAgdmFyIHRvcGljID0gc3RyLnJlcGxhY2UoL1wuL2csICcgLSAnKS5zcGxpdChkZWxpbWl0ZXIpIHx8IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG9waWMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG9waWNbaV0gPSB0aGlzLnRpdGxlaXplKHRvcGljW2ldKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdG9waWM7CiAgICAgICAgfSwKCiAgICAgICAgLyoKICAgICAgICAgKiBQdXNoIGV2ZW50IHRvIEdvb2dsZSBBbmFseXRpY3MKICAgICAgICAgKi8KICAgICAgICByZXBvcnQgOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgdmFyIHBhcmFtczsKCiAgICAgICAgICAvLyBhYm9ydCBpZiByZXF1aXJlZCBkYXRhIGlzIG5vdCBwYXNzZWQgaW4uCiAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YVswXSA9PT0gdW5kZWZpbmVkIHx8IGRhdGFbMV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZih3aW4uY29uc29sZSkKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Nhbm5vdCByZXBvcnQgZXZlbnQgdG8gR29vZ2xlIEFuYWx5dGljczsgcmVxdWlyZWQgZGF0YSBub3QgcGFzc2VkIGluLiBZb3UgbmVlZCB0byBzZXQgYXQgbWluaW11bSBhIGNhdGVnb3J5L2FjdGlvbiBvbiB5b3VyIGxpbmssIGllOiA8YSBocmVmPSJodHRwOi8vbGluay5jb20iIGRhdGEtdHJhY2tyPSJjYXRlZ29yeTphY3Rpb24iPkxpbmsuY29tPC9hPicpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHdpbi5jb25zb2xlKQogICAgICAgICAgICBjb25zb2xlLmxvZygnc2VuZGluZyBkYXRhIHRvIEdBJywgZGF0YSk7CgogICAgICAgICAgLy8gc2VuZCBldmVudAogICAgICAgICAgLy8gKEBUT0RPOiB0aGlzIGFsc28gc2VlbXMgaW5vcmRpbmF0ZWx5IHVnbHksIG5lZWQgdG8gcmV2aXNpdCkKICAgICAgICAgIHdpbi5nYSgnc2VuZCcsJ2V2ZW50JyxkYXRhWzBdLGRhdGFbMV0sZGF0YVsyXSxkYXRhWzNdLGRhdGFbNF0pOwogICAgICAgIH0sCgogICAgICAgIC8vIGJvcnJvd2VkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2VwZWxpL3VuZGVyc2NvcmUuc3RyaW5nCiAgICAgICAgdGl0bGVpemUgOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgICBpZiAoc3RyID09PSBudWxsKSB7IHJldHVybiAnJzsgfQogICAgICAgICAgc3RyID0gU3RyaW5nKHN0cikudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvKD86Xnxcc3wtKVxTL2csIGZ1bmN0aW9uKGMpeyByZXR1cm4gYy50b1VwcGVyQ2FzZSgpOyB9KTsKICAgICAgICB9LAoKCiAgICAvKgogICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICBGYWNlYm9vawogICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICovCiAgICAgICAgZmFjZWJvb2sgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB3aW5kb3cuZmJBc3luY0luaXQgPSB0aGlzLmZiSW5pdDsKICAgICAgICB9LAoKICAgICAgICBmYkluaXQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBGQi5FdmVudC5zdWJzY3JpYmUoJ2VkZ2UuY3JlYXRlJywgZnVuY3Rpb24gKGhyZWYsIHdpZGdldCkgewogICAgICAgICAgICB2YXIgZGF0YSA9IFRyYWNrci5jb2xsZWN0KHdpZGdldC5wYXJlbnROb2RlKTsKCiAgICAgICAgICAgIC8vIGFib3J0IGlmIHJlcXVpcmVkIGRhdGEgaXMgbm90IHBhc3NlZCBpbi4KICAgICAgICAgICAgaWYgKCFkYXRhIHx8IGRhdGFbMF0gPT09IHVuZGVmaW5lZCB8fCBkYXRhWzFdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBpZih3aW4uY29uc29sZSkKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignQ2Fubm90IHJlcG9ydCBldmVudCB0byBHb29nbGUgQW5hbHl0aWNzOyByZXF1aXJlZCBkYXRhIG5vdCBwYXNzZWQgaW4uIFlvdSBuZWVkIHRvIHNldCBhdCBtaW5pbXVtIGEgY2F0ZWdvcnkvYWN0aW9uIG9uIHlvdXIgbGluaywgaWU6IDxhIGhyZWY9Imh0dHA6Ly9saW5rLmNvbSIgZGF0YS10cmFja3I9ImNhdGVnb3J5OmFjdGlvbiI+TGluay5jb208L2E+Jyk7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAod2luLmNvbnNvbGUpCiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlbmRpbmcgRkIgTGlrZTogJywgZGF0YSk7CgogICAgICAgICAgICBnYSgnc2VuZCcsICdzb2NpYWwnLCAnZmFjZWJvb2snLCAnbGlrZScsIGRhdGFbMl0pOwogICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmYWNlYm9vaycsICdsaWtlJywgZGF0YVsyXSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICAvL1VubGlrZXMgdGhlIHBhZ2UKICAgICAgICAgIEZCLkV2ZW50LnN1YnNjcmliZSgnZWRnZS5yZW1vdmUnLCBmdW5jdGlvbiAoaHJlZiwgd2lkZ2V0KSB7CiAgICAgICAgICAgIHZhciBkYXRhID0gVHJhY2tyLmNvbGxlY3Qod2lkZ2V0LnBhcmVudE5vZGUpOwoKICAgICAgICAgICAgLy8gYWJvcnQgaWYgcmVxdWlyZWQgZGF0YSBpcyBub3QgcGFzc2VkIGluLgogICAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YVswXSA9PT0gdW5kZWZpbmVkIHx8IGRhdGFbMV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGlmKHdpbi5jb25zb2xlKQogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDYW5ub3QgcmVwb3J0IGV2ZW50IHRvIEdvb2dsZSBBbmFseXRpY3M7IHJlcXVpcmVkIGRhdGEgbm90IHBhc3NlZCBpbi4gWW91IG5lZWQgdG8gd3JhcCB5b3VyIEZhY2Vib29rIGVsZW1lbnQgaW4gYSBkaXYgd2l0aCB0aGUgZGF0YS10cmFja3IgYXR0cmlidXRlcywgaWU6IDxkaXYgZGF0YS10cmFja3I9ImNhdGVnb3J5OmFjdGlvbiIgZGF0YS10cmFja3ItbGFiZWw9ImxhYmVsIj48ZGl2IGNsYXNzPSJmYi1saWtlIiBkYXRhLWhyZWY9Imh0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS8iIGRhdGEtbGF5b3U9InN0YW5kYXJkIiBkYXRhLWFjdGlvbj0ibGlrZSIgZGF0YS1zaG93LWZhY2VzPSJ0cnVlIiBkYXRhLXNoYXJlPSJ0cnVlIj48L2Rpdj48L2Rpdj4nKTsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh3aW4uY29uc29sZSkKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc2VuZGluZyBGQiBVbmxpa2U6ICcsIGRhdGEpOwoKICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnc29jaWFsJywgJ2ZhY2Vib29rJywgJ2xpa2UnLCBkYXRhWzJdKTsKICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZmFjZWJvb2snLCAnbGlrZScsIGRhdGFbMl0pOwogICAgICAgICAgfSk7CgoKICAgICAgICAgIC8vU2VuZCBvciBTaGFyZSBUaGUgUGFnZQogICAgICAgICAgLy8KICAgICAgICAgIC8vIFRoaXMgZG9lc24ndCB3b3JrIGZyb20gd2hhdCBJJ3ZlIGZvdW5kLCBidXQgbGVhdmluZwogICAgICAgICAgLy8gaW4gY2FzZSBJIGZpZ3VyZSBzb21ldGhpbmcgb3V0IGluIHRoZSBmdXR1cmUKICAgICAgICAgIC8vCiAgICAgICAgICAvLwogICAgICAgICAgLy8gRkIuRXZlbnQuc3Vic2NyaWJlKCdtZXNzYWdlLnNlbmQnLCBmdW5jdGlvbiAoaHJlZiwgd2lkZ2V0KSB7CiAgICAgICAgICAvLyAgIHZhciBkYXRhID0gVHJhY2tyLmNvbGxlY3Qod2lkZ2V0LnBhcmVudE5vZGUpOwoKICAgICAgICAgIC8vICAgLy8gYWJvcnQgaWYgcmVxdWlyZWQgZGF0YSBpcyBub3QgcGFzc2VkIGluLgogICAgICAgICAgLy8gICBpZiAoIWRhdGEgfHwgZGF0YVswXSA9PT0gdW5kZWZpbmVkIHx8IGRhdGFbMV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLy8gICAgIGlmKHdpbi5jb25zb2xlKQogICAgICAgICAgLy8gICAgICAgY29uc29sZS53YXJuKCdDYW5ub3QgcmVwb3J0IGV2ZW50IHRvIEdvb2dsZSBBbmFseXRpY3M7IHJlcXVpcmVkIGRhdGEgbm90IHBhc3NlZCBpbi4gWW91IG5lZWQgdG8gc2V0IGF0IG1pbmltdW0gYSBjYXRlZ29yeS9hY3Rpb24gb24geW91ciBsaW5rLCBpZTogPGEgaHJlZj0iaHR0cDovL2xpbmsuY29tIiBkYXRhLXRyYWNrcj0iY2F0ZWdvcnk6YWN0aW9uIj5MaW5rLmNvbTwvYT4nKTsKICAgICAgICAgIC8vICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAvLyAgIH0KCiAgICAgICAgICAvLyAgIGlmICh3aW4uY29uc29sZSkKICAgICAgICAgIC8vICAgICBjb25zb2xlLmxvZygnc2VuZGluZyBGQiBTaGFyZTogJywgZGF0YSk7CgogICAgICAgICAgLy8gICBnYSgnc2VuZCcsICdzb2NpYWwnLCAnZmFjZWJvb2snLCAnc2hhcmUnLCBkYXRhWzJdKTsKICAgICAgICAgIC8vICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZmFjZWJvb2snLCAnc2hhcmUnLCBkYXRhWzJdKTsKICAgICAgICAgIC8vIH0pOwogICAgICAgIH0sCgogICAgLyoKICAgICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgVHdpdHRlcgogICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICovCiAgICAgIC8vIFRPRE86IEJ1aWxkIG91dCBtb3JlIGZ1bmN0aW9uYWxpdHkKICAgICAgLy8gICAgICAgaHR0cHM6Ly9kZXYudHdpdHRlci5jb20vZG9jcy90ZncvZXZlbnRzCiAgICAgICAgdHdpdHRlciA6IGZ1bmN0aW9uIChvcHRzKSB7CiAgICAgICAgICB3aW4udHd0dHIucmVhZHkoZnVuY3Rpb24gKHR3dHRyKSB7CiAgICAgICAgICAgIGlmIChvcHRzLnR3aXR0ZXIuY2xpY2sgPT09IHRydWUpCiAgICAgICAgICAgICAgdHd0dHIuZXZlbnRzLmJpbmQoJ2NsaWNrJywgVHJhY2tyLnR3aXR0ZXJDbGljayk7CgogICAgICAgICAgICBpZiAob3B0cy50d2l0dGVyLnR3ZWV0ID09PSB0cnVlKQogICAgICAgICAgICAgIHR3dHRyLmV2ZW50cy5iaW5kKCd0d2VldCcsIFRyYWNrci50d2l0dGVyVHdlZXQpOwoKICAgICAgICAgICAgaWYgKG9wdHMudHdpdHRlci5yZXR3ZWV0ID09PSB0cnVlKQogICAgICAgICAgICAgIHR3dHRyLmV2ZW50cy5iaW5kKCdyZXR3ZWV0JywgVHJhY2tyLnR3aXR0ZXJSZXR3ZWV0KTsKCiAgICAgICAgICAgIGlmIChvcHRzLnR3aXR0ZXIuZmF2b3JpdGUgPT09IHRydWUpCiAgICAgICAgICAgICAgdHd0dHIuZXZlbnRzLmJpbmQoJ2Zhdm9yaXRlJywgVHJhY2tyLnR3aXR0ZXJGYXZvcml0ZSk7CgogICAgICAgICAgICBpZiAob3B0cy50d2l0dGVyLmZvbGxvdyA9PT0gdHJ1ZSkKICAgICAgICAgICAgICB0d3R0ci5ldmVudHMuYmluZCgnZm9sbG93JywgVHJhY2tyLnR3aXR0ZXJGb2xsb3cpOwoKICAgICAgICAgIH0pOwoKICAgICAgICB9LAoKICAgICAgICB0d2l0dGVyQ2xpY2sgOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIGlmICghZXZlbnQpIHJldHVybjsKCiAgICAgICAgICB2YXIgZGF0YSA9IFRyYWNrci5jb2xsZWN0KGV2ZW50LnRhcmdldC5wYXJlbnROb2RlKTsKCiAgICAgICAgICAvLyBhYm9ydCBpZiByZXF1aXJlZCBkYXRhIGlzIG5vdCBwYXNzZWQgaW4uCiAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YVswXSA9PT0gdW5kZWZpbmVkIHx8IGRhdGFbMV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZih3aW4uY29uc29sZSkKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Nhbm5vdCByZXBvcnQgZXZlbnQgdG8gR29vZ2xlIEFuYWx5dGljczsgcmVxdWlyZWQgZGF0YSBub3QgcGFzc2VkIGluLiBZb3UgbmVlZCB0byB3cmFwIHlvdXIgVHdpdHRlciBlbGVtZW50IGluIGEgZGl2IHdpdGggdGhlIGRhdGEtdHJhY2tyIGF0dHJpYnV0ZXMsIGllOiA8ZGl2IGRhdGEtdHJhY2tyPSJjYXRlZ29yeTphY3Rpb24iIGRhdGEtdHJhY2tyLWxhYmVsPSJsYWJlbCI+PGEgaHJlZj0iaHR0cHM6Ly90d2l0dGVyLmNvbSIgY2xhc3M9InR3aXR0ZXItc2hhcmUtYnV0dG9uIiBkYXRhLXVybD0iaHR0cDovL3d3dy5saWZ0aW50ZXJhY3RpdmUuY29tIj5Ud2VldDwvYT48L2Rpdj4nKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh3aW4uY29uc29sZSkKICAgICAgICAgICAgY29uc29sZS5sb2coJ3R3aXR0ZXJDbGljayBkYXRhOiAnLCBkYXRhKTsKCiAgICAgICAgICAvLyBzZW5kIGV2ZW50cwogICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCB7CiAgICAgICAgICAgICdldmVudENhdGVnb3J5JzogZGF0YVswXSwKICAgICAgICAgICAgJ2V2ZW50QWN0aW9uJzogZGF0YVsxXSwKICAgICAgICAgICAgJ2V2ZW50TGFiZWwnIDogZGF0YVsyXSwKICAgICAgICAgICAgJ2V2ZW50VmFsdWUnOiBkYXRhWzNdCiAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICB0d2l0dGVyVHdlZXQgOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIGlmICghZXZlbnQpIHJldHVybjsKCiAgICAgICAgICB2YXIgZGF0YSA9IFRyYWNrci5jb2xsZWN0KGV2ZW50LnRhcmdldC5wYXJlbnROb2RlKTsKCiAgICAgICAgICAvLyBhYm9ydCBpZiByZXF1aXJlZCBkYXRhIGlzIG5vdCBwYXNzZWQgaW4uCiAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YVswXSA9PT0gdW5kZWZpbmVkIHx8IGRhdGFbMV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZih3aW4uY29uc29sZSkKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Nhbm5vdCByZXBvcnQgZXZlbnQgdG8gR29vZ2xlIEFuYWx5dGljczsgcmVxdWlyZWQgZGF0YSBub3QgcGFzc2VkIGluLiBZb3UgbmVlZCB0byB3cmFwIHlvdXIgVHdpdHRlciBlbGVtZW50IGluIGEgZGl2IHdpdGggdGhlIGRhdGEtdHJhY2tyIGF0dHJpYnV0ZXMsIGllOiA8ZGl2IGRhdGEtdHJhY2tyPSJjYXRlZ29yeTphY3Rpb24iIGRhdGEtdHJhY2tyLWxhYmVsPSJsYWJlbCI+PGEgaHJlZj0iaHR0cHM6Ly90d2l0dGVyLmNvbSIgY2xhc3M9InR3aXR0ZXItc2hhcmUtYnV0dG9uIiBkYXRhLXVybD0iaHR0cDovL3d3dy5saWZ0aW50ZXJhY3RpdmUuY29tIj5Ud2VldDwvYT48L2Rpdj4nKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh3aW4uY29uc29sZSkKICAgICAgICAgICAgY29uc29sZS5sb2coJ1R3ZWV0IFNlbnQ6ICcsIGRhdGEpOwoKCiAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsIHsKICAgICAgICAgICAgJ2V2ZW50Q2F0ZWdvcnknOiAnVHdlZXQgU2VudCcsCiAgICAgICAgICAgICdldmVudEFjdGlvbic6IGRhdGFbMV0sCiAgICAgICAgICAgICdldmVudExhYmVsJyA6IGRhdGFbMl0sCiAgICAgICAgICAgICdldmVudFZhbHVlJzogZGF0YVszXQogICAgICAgICAgfSk7CiAgICAgICAgICBnYSgnc2VuZCcsIHsKICAgICAgICAgICAgJ2hpdFR5cGUnOiAnc29jaWFsJywKICAgICAgICAgICAgJ3NvY2lhbE5ldHdvcmsnOiAnVHdpdHRlcicsCiAgICAgICAgICAgICdzb2NpYWxBY3Rpb24nOiAnVHdlZXQnLAogICAgICAgICAgICAnc29jaWFsVGFyZ2V0JzogZG9jdW1lbnQudGl0bGUsCiAgICAgICAgICAgICdwYWdlJzogVHJhY2tyLmhyZWYKICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIHR3aXR0ZXJSZXR3ZWV0IDogZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBpZiAoIWV2ZW50KSByZXR1cm47CgogICAgICAgICAgdmFyIGRhdGEgPSBUcmFja3IuY29sbGVjdChldmVudC50YXJnZXQucGFyZW50Tm9kZSk7CgogICAgICAgICAgLy8gYWJvcnQgaWYgcmVxdWlyZWQgZGF0YSBpcyBub3QgcGFzc2VkIGluLgogICAgICAgICAgaWYgKCFkYXRhIHx8IGRhdGFbMF0gPT09IHVuZGVmaW5lZCB8fCBkYXRhWzFdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYod2luLmNvbnNvbGUpCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDYW5ub3QgcmVwb3J0IGV2ZW50IHRvIEdvb2dsZSBBbmFseXRpY3M7IHJlcXVpcmVkIGRhdGEgbm90IHBhc3NlZCBpbi4gWW91IG5lZWQgdG8gd3JhcCB5b3VyIFR3aXR0ZXIgZWxlbWVudCBpbiBhIGRpdiB3aXRoIHRoZSBkYXRhLXRyYWNrciBhdHRyaWJ1dGVzLCBpZTogPGRpdiBkYXRhLXRyYWNrcj0iY2F0ZWdvcnk6YWN0aW9uIiBkYXRhLXRyYWNrci1sYWJlbD0ibGFiZWwiPjxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20iIGNsYXNzPSJ0d2l0dGVyLXNoYXJlLWJ1dHRvbiIgZGF0YS11cmw9Imh0dHA6Ly93d3cubGlmdGludGVyYWN0aXZlLmNvbSI+VHdlZXQ8L2E+PC9kaXY+Jyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAod2luLmNvbnNvbGUpCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXR3ZWV0OiAnLCBkYXRhKTsKCgogICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCB7CiAgICAgICAgICAgICdldmVudENhdGVnb3J5JzogJ1JldHdlZXRlZCcsCiAgICAgICAgICAgICdldmVudEFjdGlvbic6IGRhdGFbMV0sCiAgICAgICAgICAgICdldmVudExhYmVsJyA6IGRhdGFbMl0sCiAgICAgICAgICAgICdldmVudFZhbHVlJzogZGF0YVszXQogICAgICAgICAgfSk7CiAgICAgICAgICBnYSgnc2VuZCcsIHsKICAgICAgICAgICAgJ2hpdFR5cGUnOiAnc29jaWFsJywKICAgICAgICAgICAgJ3NvY2lhbE5ldHdvcmsnOiAnVHdpdHRlcicsCiAgICAgICAgICAgICdzb2NpYWxBY3Rpb24nOiAnUmV0d2VldCcsCiAgICAgICAgICAgICdzb2NpYWxUYXJnZXQnOiBkb2N1bWVudC50aXRsZSwKICAgICAgICAgICAgJ3BhZ2UnOiBUcmFja3IuaHJlZgogICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAgICAgdHdpdHRlckZhdm9yaXRlIDogZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBpZiAoIWV2ZW50KSByZXR1cm47CgogICAgICAgICAgdmFyIGRhdGEgPSBUcmFja3IuY29sbGVjdChldmVudC50YXJnZXQucGFyZW50Tm9kZSk7CgogICAgICAgICAgLy8gYWJvcnQgaWYgcmVxdWlyZWQgZGF0YSBpcyBub3QgcGFzc2VkIGluLgogICAgICAgICAgaWYgKCFkYXRhIHx8IGRhdGFbMF0gPT09IHVuZGVmaW5lZCB8fCBkYXRhWzFdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYod2luLmNvbnNvbGUpCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDYW5ub3QgcmVwb3J0IGV2ZW50IHRvIEdvb2dsZSBBbmFseXRpY3M7IHJlcXVpcmVkIGRhdGEgbm90IHBhc3NlZCBpbi4gWW91IG5lZWQgdG8gd3JhcCB5b3VyIFR3aXR0ZXIgZWxlbWVudCBpbiBhIGRpdiB3aXRoIHRoZSBkYXRhLXRyYWNrciBhdHRyaWJ1dGVzLCBpZTogPGRpdiBkYXRhLXRyYWNrcj0iY2F0ZWdvcnk6YWN0aW9uIiBkYXRhLXRyYWNrci1sYWJlbD0ibGFiZWwiPjxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20iIGNsYXNzPSJ0d2l0dGVyLXNoYXJlLWJ1dHRvbiIgZGF0YS11cmw9Imh0dHA6Ly93d3cubGlmdGludGVyYWN0aXZlLmNvbSI+VHdlZXQ8L2E+PC9kaXY+Jyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAod2luLmNvbnNvbGUpCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUd2l0dGVyIEZhdm9yaXRlZDogJywgZGF0YSk7CgoKICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgewogICAgICAgICAgICAnZXZlbnRDYXRlZ29yeSc6ICdUd2l0dGVyIEZhdm9yaXRlJywKICAgICAgICAgICAgJ2V2ZW50QWN0aW9uJzogZGF0YVsxXSwKICAgICAgICAgICAgJ2V2ZW50TGFiZWwnIDogZGF0YVsyXSwKICAgICAgICAgICAgJ2V2ZW50VmFsdWUnOiBkYXRhWzNdCiAgICAgICAgICB9KTsKICAgICAgICAgIGdhKCdzZW5kJywgewogICAgICAgICAgICAnaGl0VHlwZSc6ICdzb2NpYWwnLAogICAgICAgICAgICAnc29jaWFsTmV0d29yayc6ICdUd2l0dGVyJywKICAgICAgICAgICAgJ3NvY2lhbEFjdGlvbic6ICdGYXZvcml0ZScsCiAgICAgICAgICAgICdzb2NpYWxUYXJnZXQnOiBkb2N1bWVudC50aXRsZSwKICAgICAgICAgICAgJ3BhZ2UnOiBUcmFja3IuaHJlZgogICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAgICAgdHdpdHRlckZvbGxvdyA6IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgY29uc29sZS5sb2coJ3R3aXR0ZXIgZm9sbG93Jyk7CiAgICAgICAgICBpZiAoIWV2ZW50KSByZXR1cm47CgogICAgICAgICAgdmFyIGRhdGEgPSBUcmFja3IuY29sbGVjdChldmVudC50YXJnZXQucGFyZW50Tm9kZSk7CgogICAgICAgICAgLy8gYWJvcnQgaWYgcmVxdWlyZWQgZGF0YSBpcyBub3QgcGFzc2VkIGluLgogICAgICAgICAgaWYgKCFkYXRhIHx8IGRhdGFbMF0gPT09IHVuZGVmaW5lZCB8fCBkYXRhWzFdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYod2luLmNvbnNvbGUpCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDYW5ub3QgcmVwb3J0IGV2ZW50IHRvIEdvb2dsZSBBbmFseXRpY3M7IHJlcXVpcmVkIGRhdGEgbm90IHBhc3NlZCBpbi4gWW91IG5lZWQgdG8gd3JhcCB5b3VyIFR3aXR0ZXIgZWxlbWVudCBpbiBhIGRpdiB3aXRoIHRoZSBkYXRhLXRyYWNrciBhdHRyaWJ1dGVzLCBpZTogPGRpdiBkYXRhLXRyYWNrcj0iY2F0ZWdvcnk6YWN0aW9uIiBkYXRhLXRyYWNrci1sYWJlbD0ibGFiZWwiPjxhIGhyZWY9Imh0dHBzOi8vdHdpdHRlci5jb20iIGNsYXNzPSJ0d2l0dGVyLXNoYXJlLWJ1dHRvbiIgZGF0YS11cmw9Imh0dHA6Ly93d3cubGlmdGludGVyYWN0aXZlLmNvbSI+VHdlZXQ8L2E+PC9kaXY+Jyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAod2luLmNvbnNvbGUpCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXR3ZWV0OiAnLCBkYXRhKTsKCgogICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCB7CiAgICAgICAgICAgICdldmVudENhdGVnb3J5JzogJ1R3aXR0ZXIgRm9sbG93JywKICAgICAgICAgICAgJ2V2ZW50QWN0aW9uJzogZGF0YVsxXSwKICAgICAgICAgICAgJ2V2ZW50TGFiZWwnIDogZGF0YVsyXSwKICAgICAgICAgICAgJ2V2ZW50VmFsdWUnOiBkYXRhWzNdCiAgICAgICAgICB9KTsKICAgICAgICAgIGdhKCdzZW5kJywgewogICAgICAgICAgICAnaGl0VHlwZSc6ICdzb2NpYWwnLAogICAgICAgICAgICAnc29jaWFsTmV0d29yayc6ICdUd2l0dGVyJywKICAgICAgICAgICAgJ3NvY2lhbEFjdGlvbic6ICdGb2xsb3cnLAogICAgICAgICAgICAnc29jaWFsVGFyZ2V0JzogZG9jdW1lbnQudGl0bGUsCiAgICAgICAgICAgICdwYWdlJzogVHJhY2tyLmhyZWYKICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgLyoKICAgICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgWW91VHViZQogICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICovCgogICAgICAgIHlvdXR1YmUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZighd2luLllUKXsKICAgICAgICAgICAgaWYod2luLmNvbnNvbGUpCiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1lvdVR1YmUgYXBpIGlzIG5vbi1leGlzdGFudC4gSW5qZWN0aW5nIEFQSS4nKTsKCiAgICAgICAgICAgIC8vIEluamVjdCBBUEkKICAgICAgICAgICAgdmFyIGogPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKSwKICAgICAgICAgICAgZiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXTsKICAgICAgICAgICAgai5zcmMgPSAnLy93d3cueW91dHViZS5jb20vaWZyYW1lX2FwaSc7CiAgICAgICAgICAgIGouYXN5bmMgPSB0cnVlOwogICAgICAgICAgICBmLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGosIGYpOwoKICAgICAgICAgICAgLy8gT25jZSBZb3VUdWJlIGFwaSBoYXMgbG9hZGVkCiAgICAgICAgICAgIGoub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHdpbi5vbllvdVR1YmVJZnJhbWVBUElSZWFkeSA9IFRyYWNrci5vbllvdVR1YmVJZnJhbWVBUElSZWFkeTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdpbi5vbllvdVR1YmVJZnJhbWVBUElSZWFkeSA9IHRoaXMub25Zb3VUdWJlSWZyYW1lQVBJUmVhZHk7CiAgICAgICAgICB9CiAgICAgICAgfSwKCgogICAgICAgIC8qCiAgICAgICAgICogQXR0YWNoIG91ciBZVCBsaXN0ZW5lciBvbmNlIHRoZSBBUEkgaXMgbG9hZGVkCiAgICAgICAgICoKICAgICAgICAgKiBEdWUgdG8gdGhlIGVuY2Fwc3VsYXRlZCBuYXR1cmUgaGVyZSwgSSBoYWQgdG8gYWRkIHRoZQogICAgICAgICAqIHZhcmlvdXMgZXZlbnRzIGRpcmVjdGx5IGluc2lkZSB0aGUgaW5pdGlhbGl6YXRpb24KICAgICAgICAgKiAob3JpZ2luYWxseSB3YW50ZWQgdGhlbSB0byBiZSBwYXJ0IG9mIHRoZSBtYWluIFRyYWNrciBvYmplY3QpCiAgICAgICAgICovCiAgICAgICAgb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHkgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmb3IgKHZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2lmcmFtZScpLCB4ID0gZS5sZW5ndGg7IHgtLTspewoKICAgICAgICAgICAgaWYgKC95b3V0dWJlLmNvbVwvZW1iZWQvLnRlc3QoZVt4XS5zcmMpKSB7CiAgICAgICAgICAgICAgbmV3IFlULlBsYXllcihlW3hdLCB7CiAgICAgICAgICAgICAgICBldmVudHM6IHsKCiAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAqIFdoZW4gdGhlIEFQSSBpcyBhbGwgc2V0dXAgYW5kIHRoZSBZb3VUdWJlIHBsYXllciBpcyByZWFkeQogICAgICAgICAgICAgICAgICAgKiBMZWF2aW5nIGZvciBsYXRlciwgbm90IHN1cmUgd2hhdCB0byBkbyB3aXRoIHRoaXMgbm93LgogICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgJ29uUmVhZHknOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICogTGlzdGVuIGZvciBjaGFuZ2VzIGluIHRoZSB2aWRlbyBwbGF5ZXIsIGZpcmUgYXBwcm9wcmlhdGUgZXZlbnRzIHRvIEdBCiAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAnb25TdGF0ZUNoYW5nZSc6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBlcmNlbnRJRDsKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGVbJ3RhcmdldCddLmdldFZpZGVvRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChlWydkYXRhJ10gPT09IFlULlBsYXllclN0YXRlLlBMQVlJTkcpIHsKICAgICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgewogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRDYXRlZ29yeSc6ICdZb3VUdWJlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50QWN0aW9uJzogJ1BsYXknLAogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRMYWJlbCcgOiBkYXRhWyd0aXRsZSddICsgJyA6ICcgKyBlWyd0YXJnZXQnXS5nZXRWaWRlb1VybCgpCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcG9ydCAlIHBsYXllZCBldmVyeSBzZWNvbmQKICAgICAgICAgICAgICAgICAgICAgIHZhciBvblBsYXllclBlcmNlbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGVbJ2dldER1cmF0aW9uJ10oKSAtIGVbJ2dldEN1cnJlbnRUaW1lJ10oKSA8PSAxLjUgPyAxIDogKE1hdGguZmxvb3IoZVsnZ2V0Q3VycmVudFRpbWUnXSgpIC8gZVsnZ2V0RHVyYXRpb24nXSgpICogNCkgLyA0KS50b0ZpeGVkKDIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVbJ2xhc3RQJ10gfHwgdCA+IGVbJ2xhc3RQJ10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBlWydsYXN0UCddID0gdDsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncGxheWVkOiAnKyAodCAqIDEwMCArICclJykpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50Q2F0ZWdvcnknOiAnWW91VHViZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRBY3Rpb24nOiAnUGVyY2VudGFnZScgKyAodCAqIDEwMCArICclJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRMYWJlbCcgOiBkYXRhWyd0aXRsZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50VmFsdWUnOiB0ICogMTAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgLy9nYSgnc2VuZCcsICdldmVudCcsICd5b3V0dWJlJywgJ3BsYXllZDogJysgKHQgKiAxMDAgKyAiJSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovCiAgICAgICAgICAgICAgICAgICAgICAgIGVbJ2xhc3RQJ10gIT09IDEgJiYgc2V0VGltZW91dChvblBsYXllclBlcmNlbnQsIDEwMDAsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqLwogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQob25QbGF5ZXJQZXJjZW50LCAxMDAwLCBlWyd0YXJnZXQnXSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIGV2ZW50IG9uIFBhdXNlZAogICAgICAgICAgICAgICAgICAgIGlmIChlWydkYXRhJ10gPT09IFlULlBsYXllclN0YXRlLlBBVVNFRCkgewogICAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudENhdGVnb3J5JzogJ1lvdVR1YmUnLAogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRBY3Rpb24nOiAnUGF1c2UnLAogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRMYWJlbCcgOiBkYXRhWyd0aXRsZSddICsgJyA6ICcgKyBlWyd0YXJnZXQnXS5nZXRWaWRlb1VybCgpCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFNlbmQgZXZlbnQgb24gQ29tcGxldGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKGVbJ2RhdGEnXSA9PT0gWVQuUGxheWVyU3RhdGUuRU5ERUQpIHsKICAgICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgewogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRDYXRlZ29yeSc6ICdZb3VUdWJlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50QWN0aW9uJzogJ0NvbXBsZXRlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdldmVudExhYmVsJyA6IGRhdGFbJ3RpdGxlJ10gKyAnIDogJyArIGVbJ3RhcmdldCddLmdldFZpZGVvVXJsKCkKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwKCgogICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgKiBDYXRjaCBhbGwgdG8gcmVwb3J0IGVycm9ycyB0aHJvdWdoIHRoZSBHVE0gZGF0YSBsYXllcgogICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgJ29uRXJyb3InOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBlWyd0YXJnZXQnXS5nZXRWaWRlb0RhdGEoKTsKICAgICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgewogICAgICAgICAgICAgICAgICAgICAgICAnZXZlbnRDYXRlZ29yeSc6ICdZb3VUdWJlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50QWN0aW9uJzogJ0Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2V2ZW50TGFiZWwnIDogZGF0YVsndGl0bGUnXSArICcgOiAnICsgZVsndGFyZ2V0J10uZ2V0VmlkZW9VcmwoKQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgfTsKCiAgLyoKICAgKiBBdHRhY2ggb3VyIFRyYWNrciBzY3JpcHQgdG8galF1ZXJ5CiAgICovCiAgJC5mbi50cmFja3IgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgLy8gYWJvcnQgaWYgR29vZ2xlIEFuYWx5dGljcyBkb2Vzbid0IGV4aXN0CiAgICBpZiAoIXdpbi5nYSkgewogICAgICBpZiAod2luZG93LmNvbnNvbGUpCiAgICAgICAgY29uc29sZS5sb2coJ0dvb2dsZSBBbmFseXRpY3MgVW5pdmVyc2FsIGRvZXMgbm90IGV4aXN0Jyk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBUcmFja3IuaW5pdChvcHRpb25zKTsKICB9Owp9KSh3aW5kb3csIHdpbmRvdy5qUXVlcnkpOwoK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 23:19:03 GMT",
                    "Content-Length": "19203",
                    "Date": "Sat, 08 Nov 2014 23:19:03 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}