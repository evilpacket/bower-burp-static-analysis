{
    "url": "http://localhost:9999/wet-boew/wet-boew/src/plugins/tabs/tabs.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.hash</b> and written to <b>$()</b> via the following statement:<ul><li>var hash = window.location.hash,     $hashTarget = $( hash );</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/wet-boew/wet-boew/src/plugins/tabs/tabs.js",
                "path": "/wet-boew/wet-boew/src/plugins/tabs/tabs.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC93ZXQtYm9ldy93ZXQtYm9ldy9zcmMvcGx1Z2lucy90YWJzL3RhYnMuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjM4NTQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFN1biwgMDkgTm92IDIwMTQgMDI6NTM6MDEgR01UDQpMYXN0LU1vZGlmaWVkOiBTdW4sIDA5IE5vdiAyMDE0IDAyOjUyOjU5IEdNVA0KDQovKioKICogQHRpdGxlIFdFVC1CT0VXIFRhYmJlZCBpbnRlcmZhY2UKICogQG92ZXJ2aWV3IER5bmFtaWNhbGx5IHN0YWNrcyBtdWx0aXBsZSBzZWN0aW9ucyBvZiBjb250ZW50LCB0cmFuc2Zvcm1pbmcgdGhlbSBpbnRvIGEgdGFiYmVkIGludGVyZmFjZS4KICogQGxpY2Vuc2Ugd2V0LWJvZXcuZ2l0aHViLmlvL3dldC1ib2V3L0xpY2Vuc2UtZW4uaHRtbCAvIHdldC1ib2V3LmdpdGh1Yi5pby93ZXQtYm9ldy9MaWNlbmNlLWZyLmh0bWwKICogQGF1dGhvciBXRVQgQ29tbXVuaXR5CiAqLwooZnVuY3Rpb24oICQsIHdpbmRvdywgd2IgKSB7CiJ1c2Ugc3RyaWN0IjsKCi8qCiAqIFZhcmlhYmxlIGFuZCBmdW5jdGlvbiBkZWZpbml0aW9ucy4KICogVGhlc2UgYXJlIGdsb2JhbCB0byB0aGUgcGx1Z2luIC0gbWVhbmluZyB0aGF0IHRoZXkgd2lsbCBiZSBpbml0aWFsaXplZCBvbmNlIHBlciBwYWdlLAogKiBub3Qgb25jZSBwZXIgaW5zdGFuY2Ugb2YgcGx1Z2luIG9uIHRoZSBwYWdlLiBTbywgdGhpcyBpcyBhIGdvb2QgcGxhY2UgdG8gZGVmaW5lCiAqIHZhcmlhYmxlcyB0aGF0IGFyZSBjb21tb24gdG8gYWxsIGluc3RhbmNlcyBvZiB0aGUgcGx1Z2luIG9uIGEgcGFnZS4KICovCnZhciBjb21wb25lbnROYW1lID0gIndiLXRhYnMiLAoJc2VsZWN0b3IgPSAiLiIgKyBjb21wb25lbnROYW1lLAoJaW5pdEV2ZW50ID0gIndiLWluaXQiICsgc2VsZWN0b3IsCglzaGlmdEV2ZW50ID0gIndiLXNoaWZ0IiArIHNlbGVjdG9yLAoJdXBkYXRlZEV2ZW50ID0gIndiLXVwZGF0ZWQiICsgc2VsZWN0b3IsCglzZXRGb2N1c0V2ZW50ID0gInNldGZvY3VzLndiIiwKCWNvbnRyb2xzID0gc2VsZWN0b3IgKyAiIFtyb2xlPXRhYmxpc3RdIGEsICIgKyBzZWxlY3RvciArICIgW3JvbGU9dGFibGlzdF0gLnRhYi1jb3VudCIsCgl1bmlxdWVDb3VudCA9IDAsCglpbml0aWFsaXplZCA9IGZhbHNlLAoJZXF1YWxIZWlnaHRDbGFzcyA9ICJ3Yi1lcWh0IiwKCWVxdWFsSGVpZ2h0T2ZmQ2xhc3MgPSBlcXVhbEhlaWdodENsYXNzICsgIi1vZmYiLAoJYWN0aXZlUGFuZWwgPSAiLWFjdGl2ZVBhbmVsIiwKCWFjdGl2YXRlRXZlbnQgPSAiY2xpY2sga2V5ZG93biIsCgkkZG9jdW1lbnQgPSB3Yi5kb2MsCgkkd2luZG93ID0gd2Iud2luLAoJaTE4biwgaTE4blRleHQsCgoJLy8gSW5jbHVkZXMgInNtYWxsdmlldyIsICJ4c21hbGx2aWV3IiBhbmQgInh4c21hbGx2aWV3IgoJc21hbGxWaWV3UGF0dGVybiA9ICJzbWFsbHZpZXciLAoJaXNTbWFsbFZpZXcsIG9sZElzU21hbGxWaWV3LAoKCWRlZmF1bHRzID0gewoJCWV4Y2x1ZGVQbGF5OiBmYWxzZSwKCQlpbnRlcnZhbDogNgoJfSwKCgkvKioKCSAqIEBtZXRob2QgaW5pdAoJICogQHBhcmFtIHtqUXVlcnkgRXZlbnR9IGV2ZW50IEV2ZW50IHRoYXQgdHJpZ2dlcmVkIHRoZSBmdW5jdGlvbiBjYWxsCgkgKi8KCWluaXQgPSBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCS8vIFN0YXJ0IGluaXRpYWxpemF0aW9uCgkJLy8gcmV0dXJucyBET00gb2JqZWN0ID0gcHJvY2VlZCB3aXRoIGluaXQKCQkvLyByZXR1cm5zIHVuZGVmaW5lZCA9IGRvIG5vdCBwcm9jZWVkIHdpdGggaW5pdCAoZS5nLiwgYWxyZWFkeSBpbml0aWFsaXplZCkKCQl2YXIgZWxtID0gd2IuaW5pdCggZXZlbnQsIGNvbXBvbmVudE5hbWUsIHNlbGVjdG9yICksCgkJCWhhc2hGb2N1cyA9IGZhbHNlLAoJCQlpc0Nhcm91c2VsID0gdHJ1ZSwKCQkJb3BlbiA9ICJvcGVuIiwKCQkJJHBhbmVscywgJHRhYmxpc3QsIGFjdGl2ZUlkLCAkb3BlblBhbmVsLCAkZWxtLCBlbG1JZCwKCQkJc2V0dGluZ3MsICRwYW5lbCwgaSwgbGVuLCB0YWJsaXN0LCBpc09wZW4sCgkJCW5ld0lkLCBwb3NpdGlvblksIGdyb3VwQ2xhc3M7CgoJCWlmICggZWxtICkgewoJCQkkZWxtID0gJCggZWxtICk7CgoJCQkvLyBGb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuIFNob3VsZCBiZSByZW1vdmVkIGluIFdFVCB2NC4xCgkJCWlmICggJGVsbS5jaGlsZHJlbiggIi50YWJwYW5lbHMiICkubGVuZ3RoID09PSAwICkgewoJCQkJJGVsbS5jaGlsZHJlbiggIltyb2xlPXRhYnBhbmVsXSwgZGV0YWlscyIgKS53cmFwQWxsKCAiPGRpdiBjbGFzcz0ndGFicGFuZWxzJy8+IiApOwoJCQl9CgoJCQkkcGFuZWxzID0gJGVsbS5maW5kKCAiPiAudGFicGFuZWxzID4gW3JvbGU9dGFicGFuZWxdLCA+IC50YWJwYW5lbHMgPiBkZXRhaWxzIiApOwoJCQkkdGFibGlzdCA9ICRlbG0uY2hpbGRyZW4oICJbcm9sZT10YWJsaXN0XSIgKTsKCQkJaXNDYXJvdXNlbCA9ICR0YWJsaXN0Lmxlbmd0aCAhPT0gMDsKCQkJYWN0aXZlSWQgPSB3Yi5wYWdlVXJsUGFydHMuaGFzaC5zdWJzdHJpbmcoIDEgKTsKCQkJJG9wZW5QYW5lbCA9IGFjdGl2ZUlkLmxlbmd0aCAhPT0gMCA/ICRwYW5lbHMuZmlsdGVyKCAiIyIgKyBhY3RpdmVJZCApIDogdW5kZWZpbmVkOwoJCQllbG1JZCA9IGVsbS5pZDsKCQkJc2V0dGluZ3MgPSAkLmV4dGVuZCgKCQkJCXRydWUsCgkJCQl7fSwKCQkJCWRlZmF1bHRzLAoJCQkJewoJCQkJCWludGVydmFsOiAkZWxtLmhhc0NsYXNzKCAic2xvdyIgKSA/CgkJCQkJCQkJOSA6ICRlbG0uaGFzQ2xhc3MoICJmYXN0IiApID8KCQkJCQkJCQkJMyA6IGRlZmF1bHRzLmludGVydmFsLAoJCQkJCWV4Y2x1ZGVQbGF5OiAkZWxtLmhhc0NsYXNzKCAiZXhjbHVkZS1wbGF5IiApLAoJCQkJCXBsYXlpbmc6ICRlbG0uaGFzQ2xhc3MoICJwbGF5aW5nIiApCgkJCQl9LAoJCQkJd2luZG93WyBjb21wb25lbnROYW1lIF0sCgkJCQl3Yi5nZXREYXRhKCAkZWxtLCBjb21wb25lbnROYW1lICkKCQkJKTsKCgkJCS8vIEVuc3VyZSB0aGVyZSBpcyBhbiBpZCBvbiB0aGUgZWxlbWVudAoJCQlpZiAoICFlbG1JZCApIHsKCQkJCWVsbUlkID0gInRhYnMtY250LSIgKyB1bmlxdWVDb3VudDsKCQkJCSRlbG0uYXR0ciggImlkIiwgZWxtSWQgKTsKCQkJCXVuaXF1ZUNvdW50ICs9IDE7CgkJCX0KCgkJCXRyeSB7CgoJCQkJLy8gSWYgdGhlIHBhbmVsIHdhcyBub3Qgc2V0IGJ5IFVSTCBoYXNoLCB0aGVuIGF0dGVtcHQgdG8KCQkJCS8vIHJldHJpZXZlIGZyb20gc2Vzc2lvblN0b3JhZ2UKCQkJCWlmICggISRvcGVuUGFuZWwgfHwgJG9wZW5QYW5lbC5sZW5ndGggPT09IDAgKSB7CgkJCQkJYWN0aXZlSWQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCBlbG1JZCArIGFjdGl2ZVBhbmVsICk7CgkJCQkJaWYgKCBhY3RpdmVJZCApIHsKCQkJCQkJJG9wZW5QYW5lbCA9ICRwYW5lbHMuZmlsdGVyKCAiIyIgKyBhY3RpdmVJZCApOwoJCQkJCX0KCgkJCQkvLyBJZiB0aGUgcGFuZWwgd2FzIHNldCBieSBVUkwgaGFzaCwgdGhlbiBzdG9yZSBpbiBzZXNzaW9uU3RvcmFnZQoJCQkJfSBlbHNlIHsKCQkJCQloYXNoRm9jdXMgPSB0cnVlOwoJCQkJCXRyeSB7CgkJCQkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0oIGVsbUlkICsgYWN0aXZlUGFuZWwsIGFjdGl2ZUlkICk7CgkJCQkJfSBjYXRjaCAoIGVycm9yICkgewoJCQkJCX0KCQkJCX0KCQkJfSBjYXRjaCAoIGVycm9yICkgewoJCQl9CgoJCQkvLyBEZXRlcm1pbmUgdGhlIGN1cnJlbnQgdmlldwoJCQlpc1NtYWxsVmlldyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUuaW5kZXhPZiggc21hbGxWaWV3UGF0dGVybiApICE9PSAtMTsKCgkJCS8vIE9ubHkgaW5pdGlhbGl6ZSB0aGUgaTE4blRleHQgb25jZQoJCQlpZiAoICFpMThuVGV4dCApIHsKCQkJCWkxOG4gPSB3Yi5pMThuOwoJCQkJaTE4blRleHQgPSB7CgkJCQkJcHJldjogaTE4biggInBydiIgKSwKCQkJCQluZXh0OiBpMThuKCAibnh0IiApLAoJCQkJCXBsYXk6IGkxOG4oICJ0YWItcGxheSIgKSwKCQkJCQlyb3RTdGFydDogaTE4biggInRhYi1yb3QiICkub24sCgkJCQkJcm90U3RvcDogaTE4biggInRhYi1yb3QiICkub2ZmLAoJCQkJCXNwYWNlOiBpMThuKCAic3BhY2UiICksCgkJCQkJaHlwaGVuOiBpMThuKCAiaHlwaGVuIiApLAoJCQkJCXBhdXNlOiBpMThuKCAicGF1c2UiICksCgkJCQkJdGFiQ291bnQ6IGkxOG4oICJsYi1jdXJyIikKCQkJCX07CgkJCX0KCgkJCS8vIEJ1aWxkIHRoZSB0YWJsaXN0IGFuZCBlbmhhbmNlIHRoZSBwYW5lbHMgYXMgbmVlZGVkIGZvciBkZXRhaWxzL3N1bW1hcnkKCQkJaWYgKCAhaXNDYXJvdXNlbCApIHsKCQkJCSRlbG0uYWRkQ2xhc3MoICJ0YWJzLWFjYyIgKTsKCQkJCWdyb3VwQ2xhc3MgPSBlbG1JZCArICItZ3JwIjsKCQkJCSRwYW5lbHMgPSAkZWxtLmZpbmQoICI+IC50YWJwYW5lbHMgPiBkZXRhaWxzIiApOwoJCQkJbGVuID0gJHBhbmVscy5sZW5ndGg7CgoJCQkJLy8gRW5zdXJlIHRoZXJlIGlzIG9ubHkgb25lIHBhbmVsIG9wZW4KCQkJCS8vIE9yZGVyIG9mIHByaW9yaXR5IGlzIGhhc2gsIG9wZW4gcHJvcGVydHksIGZpcnN0IGRldGFpbHMKCQkJCWlmICggISRvcGVuUGFuZWwgfHwgJG9wZW5QYW5lbC5sZW5ndGggPT09IDAgKSB7CgkJCQkJJG9wZW5QYW5lbCA9ICRwYW5lbHMuZmlsdGVyKCAiW29wZW5dIiApLmZpcnN0KCk7CgkJCQkJaWYgKCAkb3BlblBhbmVsLmxlbmd0aCA9PT0gMCApIHsKCQkJCQkJJG9wZW5QYW5lbCA9ICRwYW5lbHMuZXEoIDAgKTsKCQkJCQl9CgkJCQl9CgkJCQkkcGFuZWxzLnJlbW92ZUF0dHIoIG9wZW4gKTsKCQkJCSRvcGVuUGFuZWwuYXR0ciggb3Blbiwgb3BlbiApOwoKCQkJCS8vIEhpZGUgdGhlIHRhYmxpc3QgaW4gc21hbGwgdmlldyBhbmQgdGhlIHN1bW1hcnkgZWxlbWVudHMgaW4gbGFyZ2UgdmlldwoJCQkJdGFibGlzdCA9ICI8dWwgcm9sZT0ndGFibGlzdCcgYXJpYS1saXZlPSdvZmYnIGNsYXNzPSdnZW5lcmF0ZWQnPiI7CgoJCQkJZm9yICggaSA9IDA7IGkgIT09IGxlbjsgaSArPSAxICkgewoJCQkJCSRwYW5lbCA9ICRwYW5lbHMuZXEoIGkgKTsKCQkJCQkkcGFuZWwKCQkJCQkJLmFkZENsYXNzKCBncm91cENsYXNzICkKCQkJCQkJLmh0bWwoCgkJCQkJCQkkcGFuZWwuaHRtbCgpCgkJCQkJCQkJLnJlcGxhY2UoIC8oPFwvc3VtbWFyeT4pL2ksICIkMTxkaXYgY2xhc3M9J3RnbC1wYW5lbCc+IiApICsKCQkJCQkJCSI8L2Rpdj4iCgkJCQkJCSk7CgoJCQkJCW5ld0lkID0gJHBhbmVsLmF0dHIoICJpZCIgKTsKCQkJCQlpZiAoICFuZXdJZCApIHsKCQkJCQkJbmV3SWQgPSAidGFicGFuZWwiICsgdW5pcXVlQ291bnQ7CgkJCQkJCXVuaXF1ZUNvdW50ICs9IDE7CgkJCQkJCSRwYW5lbC5hdHRyKCAiaWQiLCBuZXdJZCApOwoJCQkJCX0KCQkJCQlpc09wZW4gPSAhISRwYW5lbC5hdHRyKCBvcGVuICk7CgoJCQkJCWlmICggaXNTbWFsbFZpZXcgKSB7CgkJCQkJCWlmICggIU1vZGVybml6ci5kZXRhaWxzICkgewoJCQkJCQkJJHBhbmVsLnRvZ2dsZUNsYXNzKCAib3BlbiIsIGlzT3BlbiApOwoJCQkJCQl9CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHBhbmVsLmF0dHIoewoJCQkJCQkJcm9sZTogInRhYnBhbmVsIiwKCQkJCQkJCW9wZW46IG9wZW4KCQkJCQkJfSk7CgkJCQkJCSRwYW5lbC5hZGRDbGFzcyggKCBNb2Rlcm5penIuZGV0YWlscyA/ICIiIDogIG9wZW4gKyAiICIgKSArCgkJCQkJCQkiZmFkZSAiICsgKCBpc09wZW4gPyAiaW4iIDogIm91dCIgKSApOwoJCQkJCX0KCgkJCQkJdGFibGlzdCArPSAiPGxpIiArICggaXNPcGVuID8gIiBjbGFzcz0nYWN0aXZlJyIgOiAiIiApICsKCQkJCQkJIj48YSBpZD0nIiArIG5ld0lkICsgIi1sbmsnIGhyZWY9JyMiICsgbmV3SWQgKyAiJz4iICsKCQkJCQkJJHBhbmVsLmNoaWxkcmVuKCAic3VtbWFyeSIgKS5odG1sKCkgKyAiPC9hPjwvbGk+IjsKCQkJCX0KCgkJCQkkdGFibGlzdCA9ICQoIHRhYmxpc3QgKyAiPC91bD4iICk7CgkJCQkkZWxtCgkJCQkJLnByZXBlbmQoICR0YWJsaXN0ICkKCQkJCQkuZmluZCggIj4gLnRhYnBhbmVscyA+IGRldGFpbHMgPiBzdW1tYXJ5IiApCgkJCQkJCS5hZGRDbGFzcyggIndiLXRvZ2dsZSB0Z2wtdGFiIiApCgkJCQkJCS5hdHRyKCAiZGF0YS10b2dnbGUiLCAie1wicGFyZW50XCI6IFwiIyIgKyBlbG1JZCArCgkJCQkJCQkiXCIsIFwiZ3JvdXBcIjogXCIuIiArIGdyb3VwQ2xhc3MgKyAiXCJ9IiApCgkJCQkJCS50cmlnZ2VyKCAid2ItaW5pdC53Yi10b2dnbGUiICk7CgkJCX0gZWxzZSBpZiAoICRvcGVuUGFuZWwgJiYgJG9wZW5QYW5lbC5sZW5ndGggIT09IDAgKSB7CgkJCQkkcGFuZWxzLmZpbHRlciggIi5pbiIgKQoJCQkJCS5hZGRDbGFzcyggIm91dCIgKQoJCQkJCS5yZW1vdmVDbGFzcyggImluIiApOwoJCQkJJG9wZW5QYW5lbAoJCQkJCS5hZGRDbGFzcyggImluIiApCgkJCQkJLnJlbW92ZUNsYXNzKCAib3V0IiApOwoJCQkJJHRhYmxpc3QuZmluZCggIi5hY3RpdmUiICkKCQkJCQkucmVtb3ZlQ2xhc3MoICJhY3RpdmUiICk7CgkJCQkkdGFibGlzdC5maW5kKCAiYSIgKQoJCQkJCS5maWx0ZXIoICJbaHJlZiQ9JyIgKyBhY3RpdmVJZCArICInXSIgKQoJCQkJCS5wYXJlbnQoKQoJCQkJCQkuYWRkQ2xhc3MoICJhY3RpdmUiICk7CgkJCX0KCgkJCWRyaXp6bGVBcmlhKCAkcGFuZWxzLCAkdGFibGlzdCApOwoKCQkJaWYgKCBpc0Nhcm91c2VsICkgewoKCQkJCS8vIFJldHVybnMgdHJ1ZSBpZiB0aGUgdGFicyBzaG91bGQgYmUgcm90YXRpbmcgYXV0b21hdGljYWxseQoJCQkJaWYgKCBjcmVhdGVDb250cm9scyggJHRhYmxpc3QsIHNldHRpbmdzICkgKSB7CgoJCQkJCS8vIFJlZ2lzdGVyIHRoaXMgc3BlY2lmaWMgdGFicyBpbnN0YW5jZSBmb3IgdGltZXJwb2tlLndiIGV2ZW50cwoJCQkJCXdiLmFkZCggIiMiICsgZWxtSWQgKyBzZWxlY3RvciApOwoJCQkJfQoJCQl9CgoJCQkvLyBJZiBmb2N1cyBpcyBiZWluZyBzZXQgYnkgdGhlIFVSTCBoYXNoLCB0aGVuIGVuc3VyZSB0aGUgdGFicyBhcmUKCQkJLy8gbm90IGFib3ZlIHRoZSB0b3Agb2YgdGhlIHZpZXdwb3J0CgkJCWlmICggaGFzaEZvY3VzICkgewoKCQkJCS8vIE5lZWQgYSBzbGlnaHQgZGVsYXkgdG8gYWxsb3cgZm9yIHRoZSByZWZsb3cKCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQkJcG9zaXRpb25ZID0gJHRhYmxpc3Qub2Zmc2V0KCkudG9wOwoJCQkJCWlmICggcG9zaXRpb25ZIDwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgKSB7CgkJCQkJCWRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gcG9zaXRpb25ZOwoJCQkJCX0KCQkJCX0sIDEgKTsKCQkJfQoKCQkJJGVsbS5kYXRhKHsKCQkJCSJ3Yi10YWJzIjogewoJCQkJCXBhbmVsczogJHBhbmVscywKCQkJCQl0YWJsaXN0OiAkdGFibGlzdCwKCQkJCQlzZXR0aW5nczogc2V0dGluZ3MsCgkJCQkJY3RpbWU6IDAKCQkJCX0KCQkJfSk7CgoJCQlpbml0aWFsaXplZCA9IHRydWU7CgkJCW9uUmVzaXplKCk7CgoJCQkvLyBJZGVudGlmeSB0aGF0IGluaXRpYWxpemF0aW9uIGhhcyBjb21wbGV0ZWQKCQkJd2IucmVhZHkoICRlbG0sIGNvbXBvbmVudE5hbWUgKTsKCQl9Cgl9LAoKCS8qKgoJICogQG1ldGhvZCBvblRpbWVyUG9rZQoJICogQHBhcmFtIHtqUXVlcnkgRE9NIGVsZW1lbnR9ICRlbG0gVGhlIHBsdWdpbiBlbGVtZW50CgkgKi8KCW9uVGltZXJQb2tlID0gZnVuY3Rpb24oICRlbG0gKSB7CgkJdmFyIGRhdGEgPSAkZWxtLmRhdGEoIGNvbXBvbmVudE5hbWUgKSwKCQkJZGVsYXlDdXJyZW50ID0gcGFyc2VGbG9hdCggZGF0YS5jdGltZSApICsgMC41OwoKCQkvLyBDaGVjayBpZiB3ZSBuZWVkIHRvIHJvdGF0ZSBwYW5lbHMKCQlpZiAoIHBhcnNlRmxvYXQoIGRhdGEuc2V0dGluZ3MuaW50ZXJ2YWwgKSA8PSBkZWxheUN1cnJlbnQgKSB7CgkJCSRlbG0udHJpZ2dlciggc2hpZnRFdmVudCApOwoJCQlkZWxheUN1cnJlbnQgPSAwOwoJCX0KCgkJZGF0YS5jdGltZSA9IGRlbGF5Q3VycmVudDsKCQkkZWxtLmRhdGEoIGNvbXBvbmVudE5hbWUsIGRhdGEgKTsKCX0sCgoJLyoqCgkgKiBAbWV0aG9kIGNyZWF0ZUNvbnRyb2xzCgkgKiBAcGFyYW0ge2pRdWVyeSBET00gZWxlbWVudH0gJHRhYmxpc3QgVGhlIHBsdWdpbiBlbGVtZW50CgkgKiBAcGFyYW0ge29iamVjdH0gc2V0dGluZ3MgU2V0dGluZ3MgZm9yIHRoZSB0YWJzIGluc3RhbmNlCgkgKiBAcmV0dXJucyB7Ym9vbGVhbn0gV2hldGhlciBvciBub3QgdGhlIHRhYnMgc2hvdWxkIGJlIHJvdGF0aW5nIGluaXRpYWxseQoJICovCgljcmVhdGVDb250cm9scyA9IGZ1bmN0aW9uKCAkdGFibGlzdCwgc2V0dGluZ3MgKSB7CgkJdmFyIHByZXZUZXh0ID0gaTE4blRleHQucHJldiwKCQkJbmV4dFRleHQgPSBpMThuVGV4dC5uZXh0LAoJCQlzcGFjZVRleHQgPSBpMThuVGV4dC5zcGFjZSwKCQkJZXhjbHVkZVBsYXkgPSBzZXR0aW5ncy5leGNsdWRlUGxheSwKCQkJaXNQbGF5aW5nID0gIWV4Y2x1ZGVQbGF5ICYmIHNldHRpbmdzLnBsYXlpbmcsCgkJCXN0YXRlID0gaXNQbGF5aW5nID8gaTE4blRleHQucGF1c2UgOiBpMThuVGV4dC5wbGF5LAoJCQloaWRkZW4gPSBpc1BsYXlpbmcgPyBpMThuVGV4dC5yb3RTdG9wIDogaTE4blRleHQucm90U3RhcnQsCgkJCWdseXBoaWNvblN0YXJ0ID0gIjxzcGFuIGNsYXNzPSdnbHlwaGljb24gZ2x5cGhpY29uLSIsCgkJCXdiSW52U3RhcnQgPSAiPHNwYW4gY2xhc3M9J3diLWludic+IiwKCQkJdGFic1RvZ2dsZVN0YXJ0ID0gIjxsaSBjbGFzcz0nY29udHJvbCAiLAoJCQlidG5NaWRkbGUgPSAiJyBocmVmPSdqYXZhc2NyaXB0OjsnIHJvbGU9J2J1dHRvbicgdGl0bGU9JyIsCgkJCWJ0bkVuZCA9ICI8L3NwYW4+PC9hPjwvbGk+ICIsCgkJCWljb25TdGF0ZSA9IGdseXBoaWNvblN0YXJ0ICsgKCBpc1BsYXlpbmcgPyAicGF1c2UiIDogInBsYXkiICkgKyAiJz48L3NwYW4+IiwKCQkJJHRhYnMgPSAkdGFibGlzdC5maW5kKCAiW3JvbGU9dGFiXSIgKSwKCQkJY3VycmVudEluZGV4ID0gJHRhYnMuaW5kZXgoICR0YWJzLmZpbHRlciggIlthcmlhLXNlbGVjdGVkPXRydWVdIiApICkgKyAxLAoJCQlpMThuVGFiQ291bnQgPSBpMThuVGV4dC50YWJDb3VudCwKCQkJZmlyc3RSZXBsYWNlSW5kZXggPSBpMThuVGFiQ291bnQuaW5kZXhPZiggIiUiICksCgkJCWxhc3RSZXBsYWNlSW5kZXggPSBpMThuVGFiQ291bnQubGFzdEluZGV4T2YoICIlIiApICsgMSwKCQkJcHJldkNvbnRyb2wgPSB0YWJzVG9nZ2xlU3RhcnQgKyAicHJ2Jz48YSBjbGFzcz0ncHJ2IiArIGJ0bk1pZGRsZSArCgkJCQlwcmV2VGV4dCArICInPiIgKyBnbHlwaGljb25TdGFydCArICJjaGV2cm9uLWxlZnQnPjwvc3Bhbj4iICsKCQkJCXdiSW52U3RhcnQgKyBwcmV2VGV4dCArIGJ0bkVuZCwKCQkJdGFiQ291bnQgPSB0YWJzVG9nZ2xlU3RhcnQgKyAiIHRhYi1jb3VudCcgdGFiaW5kZXg9JzAnPjxkaXY+IiArCgkJCQlpMThuVGFiQ291bnQuc3Vic3RyaW5nKCAwLCBmaXJzdFJlcGxhY2VJbmRleCApICsKCQkJCSI8ZGl2IGNsYXNzPSdjdXJyLWNvdW50Jz4iICsKCQkJCWkxOG5UYWJDb3VudC5zdWJzdHJpbmcoIGZpcnN0UmVwbGFjZUluZGV4LCBsYXN0UmVwbGFjZUluZGV4ICkKCQkJCQkucmVwbGFjZSggIiVjdXJyJSIsICI8c3BhbiBjbGFzcz0nY3Vyci1pbmRleCc+IiArIGN1cnJlbnRJbmRleCArICI8L3NwYW4+IiApCgkJCQkJLnJlcGxhY2UoICIldG90YWwlIiwgJHRhYnMubGVuZ3RoICkgKwoJCQkJIjwvZGl2PiIgKyBpMThuVGFiQ291bnQuc3Vic3RyaW5nKCBsYXN0UmVwbGFjZUluZGV4ICkgKwoJCQkJIjwvZGl2PjwvbGk+IiwKCQkJbmV4dENvbnRyb2wgPSB0YWJzVG9nZ2xlU3RhcnQgKyAibnh0Jz48YSBjbGFzcz0nbnh0IiArIGJ0bk1pZGRsZSArCgkJCQluZXh0VGV4dCArICInPiIgKyBnbHlwaGljb25TdGFydCArICJjaGV2cm9uLXJpZ2h0Jz48L3NwYW4+IiArCgkJCQl3YkludlN0YXJ0ICsgbmV4dFRleHQgKyBidG5FbmQsCgkJCXBsYXlDb250cm9sID0gIHRhYnNUb2dnbGVTdGFydCArICJwbHlwYXVzZSc+PGEgY2xhc3M9J3BseXBhdXNlIiArCgkJCQlidG5NaWRkbGUgKyBzdGF0ZSArICInPiIgKyBpY29uU3RhdGUgKyAiIDxzcGFuPiIgKyBzdGF0ZSArCgkJCQkiPC9zcGFuPiIgKyB3YkludlN0YXJ0ICsgc3BhY2VUZXh0ICsgaTE4blRleHQuaHlwaGVuICsgc3BhY2VUZXh0ICsKCQkJCWhpZGRlbiArIGJ0bkVuZDsKCgkJJHRhYmxpc3QucHJlcGVuZCggcHJldkNvbnRyb2wgKyB0YWJDb3VudCArIG5leHRDb250cm9sICk7CgkJaWYgKCAhZXhjbHVkZVBsYXkgKSB7CgkJCSR0YWJsaXN0LmFwcGVuZCggcGxheUNvbnRyb2wgKTsKCQl9CgoJCXJldHVybiBpc1BsYXlpbmc7Cgl9LAoKCS8qKgoJICogQG1ldGhvZCBkcml6emxlQXJpYQoJICogQHBhcmFtIHtqUXVlcnkgRE9NIGVsZW1lbnR9ICRwYW5lbHMgVGFicGFuZWwgZ3JvdXBpbmdzCgkgKiBAcGFyYW0ge2pRdWVyeSBET00gZWxlbWVudH0gJHRhYmxpc3QgUG9pbnRlcnMgdG8gdGhlIGdyb3VwaW5ncwoJICovCglkcml6emxlQXJpYSA9IGZ1bmN0aW9uKCAkcGFuZWxzLCAkdGFiTGlzdCApIHsKCgkJLy8gTGV0J3MgcHJvY2VzcyB0aGUgZWxlbWVudHMgZm9yIGFyaWEKCQl2YXIgcGFuZWxzID0gJHBhbmVscy5nZXQoKSwKCQkJdGFiQ291bnRlciA9IHBhbmVscy5sZW5ndGggLSAxLAoJCQlsaXN0SXRlbXMgPSAkdGFiTGlzdC5jaGlsZHJlbigpLmdldCgpLAoJCQlsaXN0Q291bnRlciA9IGxpc3RJdGVtcy5sZW5ndGggLSAxLAoJCQlpc0RldGFpbHMgPSAkcGFuZWxzWyAwIF0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImRldGFpbHMiLAoJCQlpc0FjdGl2ZSwgaXRlbSwgbGluazsKCgkJJHBhbmVscy5hdHRyKCAidGFiaW5kZXgiLCAiLTEiICk7CgoJCWZvciAoIDsgdGFiQ291bnRlciAhPT0gLTE7IHRhYkNvdW50ZXIgLT0gMSApIHsKCQkJaXRlbSA9IHBhbmVsc1sgdGFiQ291bnRlciBdOwoJCQlpc0FjdGl2ZSA9IGl0ZW0uY2xhc3NOYW1lLmluZGV4T2YoICJpbiIgKSAhPT0gLTE7CgoJCQlpZiAoICFpc0RldGFpbHMgfHwgIWlzU21hbGxWaWV3ICkgewoJCQkJaXRlbS5zZXRBdHRyaWJ1dGUoICJhcmlhLWhpZGRlbiIsIGlzQWN0aXZlID8gImZhbHNlIiA6ICJ0cnVlIiApOwoJCQkJaXRlbS5zZXRBdHRyaWJ1dGUoICJhcmlhLWV4cGFuZGVkIiwgaXNBY3RpdmUgPyAidHJ1ZSIgOiAiZmFsc2UiICk7CgkJCX0KCQkJaXRlbS5zZXRBdHRyaWJ1dGUoICJhcmlhLWxhYmVsbGVkYnkiLCBpdGVtLmlkICsgIi1sbmsiICk7CgkJfQoKCQlmb3IgKCA7IGxpc3RDb3VudGVyICE9PSAtMTsgbGlzdENvdW50ZXIgLT0gMSApIHsKCQkJaXRlbSA9IGxpc3RJdGVtc1sgbGlzdENvdW50ZXIgXTsKCQkJaXRlbS5zZXRBdHRyaWJ1dGUoICJyb2xlIiwgInByZXNlbnRhdGlvbiIgKTsKCQkJaXNBY3RpdmUgPSBpdGVtLmNsYXNzTmFtZS5pbmRleE9mKCAiYWN0aXZlIiApICE9PSAtMTsKCgkJCWxpbmsgPSBpdGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAiYSIgKVsgMCBdOwoJCQlsaW5rLnRhYkluZGV4ID0gaXNBY3RpdmUgPyAiMCIgOiAiLTEiOwoJCQlsaW5rLnNldEF0dHJpYnV0ZSggInJvbGUiLCAidGFiIiApOwoJCQlsaW5rLnNldEF0dHJpYnV0ZSggImFyaWEtc2VsZWN0ZWQiLCBpc0FjdGl2ZSA/ICJ0cnVlIiA6ICJmYWxzZSIgKTsKCQkJbGluay5zZXRBdHRyaWJ1dGUoICJhcmlhLWNvbnRyb2xzIiwgbGluay5nZXRBdHRyaWJ1dGUoICJocmVmIiApLnN1YnN0cmluZyggMSApICk7CgkJfQoJCSR0YWJMaXN0LmF0dHIoICJhcmlhLWxpdmUiLCAib2ZmIiApOwoJfSwKCgl1cGRhdGVOb2RlcyA9IGZ1bmN0aW9uKCAkcGFuZWxzLCAkY29udHJvbHMsICRuZXh0LCAkY29udHJvbCApIHsKCQl2YXIgJHRhYnMgPSAkY29udHJvbHMuZmluZCggIltyb2xlPXRhYl0iICksCgkJCW5ld0luZGV4ID0gJHRhYnMuaW5kZXgoICRjb250cm9sICkgKyAxLAoJCQkkY3VyclBhbmVsID0gJHBhbmVscy5maWx0ZXIoICIuaW4iICksCgkJCSRjb250YWluZXIgPSAkbmV4dC5jbG9zZXN0KCBzZWxlY3RvciApLAoJCQltUGxheWVycyA9ICRjdXJyUGFuZWwuZmluZCggIi53Yi1tbHRtZC1pbml0ZWQiICkuZ2V0KCksCgkJCW1QbGF5ZXJzTGVuID0gbVBsYXllcnMubGVuZ3RoLAoJCQltUGxheWVyLCBpLCBqLCBsYXN0OwoKCQkvLyBIYW5kbGUgdGhlIGRpcmVjdGlvbiBvZiB0aGUgc2xpZGUgdHJhbnNpdGlvbnMKCQlpZiAoICRjdXJyUGFuZWxbIDAgXS5jbGFzc05hbWUuaW5kZXhPZiggInNsaWRlIiApICE9PSAtMSApIHsKCQkJaSA9ICRwYW5lbHMuaW5kZXgoICRjdXJyUGFuZWwgKTsKCQkJaiA9ICRwYW5lbHMuaW5kZXgoICRuZXh0ICk7CgkJCWxhc3QgPSAkcGFuZWxzLmxlbmd0aCAtIDE7CgoJCQkkcGFuZWxzLnRvZ2dsZUNsYXNzKAoJCQkJInJldmVyc2UiLAoJCQkJKCBpID4gaiAmJiAoIGkgIT09IGxhc3QgfHwgaiAhPT0gMCApICkgfHwgKCBpID09PSAwICYmIGogPT09IGxhc3QgKQoJCQkpOwoJCX0KCgkJJGN1cnJQYW5lbAoJCQkucmVtb3ZlQ2xhc3MoICJpbiIgKQoJCQkuYWRkQ2xhc3MoICJvdXQiICkKCQkJLmF0dHIoewoJCQkJImFyaWEtaGlkZGVuIjogInRydWUiLAoJCQkJImFyaWEtZXhwYW5kZWQiOiAiZmFsc2UiCgkJCX0pOwoKCQkvLyBQYXVzZSBhbGwgbXVsdGltZWRpYSBwbGF5ZXJzIGluIHRoZSBjdXJyZW50IHBhbmVsCgkJZm9yICggaSA9IDA7IGkgIT09IG1QbGF5ZXJzTGVuOyBpICs9IDEgKSB7CgkJCW1QbGF5ZXIgPSBtUGxheWVyc1sgaSBdOwoJCQlpZiAoIG1QbGF5ZXIucGxheWVyICkgewoJCQkJbVBsYXllci5wbGF5ZXIoICJwYXVzZSIgKTsKCQkJfQoJCX0KCgkJJG5leHQKCQkJLnJlbW92ZUNsYXNzKCAib3V0IiApCgkJCS5hZGRDbGFzcyggImluIiApCgkJCS5hdHRyKHsKCQkJCSJhcmlhLWhpZGRlbiI6ICJmYWxzZSIsCgkJCQkiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIgoJCQl9KTsKCgkJJGNvbnRyb2xzCgkJCS5maW5kKCAiLmFjdGl2ZSIgKQoJCQkJLnJlbW92ZUNsYXNzKCAiYWN0aXZlIiApCgkJCQkuY2hpbGRyZW4oICJhIiApCgkJCQkJLmF0dHIoewoJCQkJCQkiYXJpYS1zZWxlY3RlZCI6ICJmYWxzZSIsCgkJCQkJCXRhYmluZGV4OiAiLTEiCgkJCQkJfSk7CgoJCS8vIFVwZGF0ZSB0aGUgSXRlbSB4IG9mIG4KCQkkY29udHJvbHMKCQkJLmZpbmQoICIuY3Vyci1pbmRleCIgKQoJCQkJLmh0bWwoIG5ld0luZGV4ICk7CgoJCSRjb250cm9sCgkJCS5hdHRyKHsKCQkJCSJhcmlhLXNlbGVjdGVkIjogInRydWUiLAoJCQkJdGFiaW5kZXg6ICIwIgoJCQl9KQoJCQkucGFyZW50KCkKCQkJCS5hZGRDbGFzcyggImFjdGl2ZSIgKTsKCgkJLy8gVXBkYXRlIHNlc3Npb25TdG9yYWdlIHdpdGggdGhlIGN1cnJlbnQgYWN0aXZlIHBhbmVsCgkJdHJ5IHsKCQkJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgKCQkJCSRjb250YWluZXIuYXR0ciggImlkIiApICsgYWN0aXZlUGFuZWwsCgkJCQkkbmV4dC5hdHRyKCAiaWQiICkKCQkJKTsKCQl9IGNhdGNoICggZXJyb3IgKSB7CgkJfQoKCQkvLyBJZGVudGlmeSB0aGF0IHRoZSB0YWJiZWQgaW50ZXJmYWNlL2Nhcm91c2VsIHdhcyB1cGRhdGVkCgkJJGNvbnRhaW5lci50cmlnZ2VyKCB1cGRhdGVkRXZlbnQsIFsgJG5leHQgXSApOwoJfSwKCgkvKioKCSAqIEBtZXRob2Qgb25QaWNrCgkgKiBAcGFyYW0ge2pRdWVyeSBET00gZWxlbWVudH0gJHNsZHIgVGhlIHBsdWdpbiBlbGVtZW50CgkgKiBAcGFyYW0ge2pRdWVyeSBET00gZWxlbWVudH0gJGVsbSBUaGUgc2VsZWN0ZWQgbGluayBmcm9tIHRoZSB0YWJsaXN0CgkgKi8KCW9uUGljayA9IGZ1bmN0aW9uKCAkc2xkciwgJGVsbSApIHsKCQl2YXIgZGF0YSA9ICRzbGRyLmRhdGEoIGNvbXBvbmVudE5hbWUgKSwKCQkJJHBhbmVscyA9IGRhdGEucGFuZWxzLAoJCQkkY29udHJvbHMgPSBkYXRhLnRhYmxpc3QsCgkJCSRuZXh0ID0gJHBhbmVscy5maWx0ZXIoICIjIiArICRlbG0uYXR0ciggImFyaWEtY29udHJvbHMiICkgKTsKCgkJdXBkYXRlTm9kZXMoICRwYW5lbHMsICRjb250cm9scywgJG5leHQsICRlbG0gKTsKCX0sCgoJLyoqCgkgKiBAbWV0aG9kIG9uU2hpZnQKCSAqIEBwYXJhbSAoalF1ZXJ5IGV2ZW50fSBldmVudCBDdXJyZW50IGV2ZW50CgkgKiBAcGFyYW0ge2pRdWVyeSBET00gZWxlbWVudH0gJGVsbSBUaGUgcGx1Z2luIGVsZW1lbnQKCSAqLwoJb25TaGlmdCA9IGZ1bmN0aW9uKCBldmVudCwgJGVsbSApIHsKCQl2YXIgZGF0YSA9ICRlbG0uZGF0YSggY29tcG9uZW50TmFtZSApLAoJCQkkcGFuZWxzID0gZGF0YS5wYW5lbHMsCgkJCSRjb250cm9scyA9IGRhdGEudGFibGlzdCwKCQkJbGVuID0gJHBhbmVscy5sZW5ndGgsCgkJCWN1cnJlbnQgPSAkZWxtLmZpbmQoICI+IC50YWJwYW5lbHMgPiAuaW4iICkucHJldkFsbCggIltyb2xlPXRhYnBhbmVsXSIgKS5sZW5ndGgsCgkJCXNoaWZ0dG8gPSBldmVudC5zaGlmdHRvID8gZXZlbnQuc2hpZnR0byA6IDEsCgkJCW5leHQgPSBjdXJyZW50ID4gbGVuID8gMCA6IGN1cnJlbnQgKyBzaGlmdHRvLAoJCQkkbmV4dCA9ICRwYW5lbHMuZXEoICggbmV4dCA+IGxlbiAtIDEgKSA/IDAgOiAoIG5leHQgPCAwICkgPyBsZW4gLSAxIDogbmV4dCApOwoKCQl1cGRhdGVOb2RlcygKCQkJJHBhbmVscywgJGNvbnRyb2xzLCAkbmV4dCwKCQkJJGNvbnRyb2xzLmZpbmQoICJbaHJlZj0jIiArICRuZXh0LmF0dHIoICJpZCIgKSArICJdIiApCgkJKTsKCX0sCgoJLyoqCgkgKiBAbWV0aG9kIG9uQ3ljbGUKCSAqIEBwYXJhbSB7alF1ZXJ5IERPTSBlbGVtZW50fSAkZWxtIFRoZSBwbHVnaW4gZWxlbWVudAoJICogQHBhcmFtIHtpbnRlZ2VyfSBzaGlmdG8gVGhlIGl0ZW0gdG8gc2hpZnQgdG8KCSAqLwoJb25DeWNsZSA9IGZ1bmN0aW9uKCAkZWxtLCBzaGlmdG8gKSB7CgkJJGVsbS50cmlnZ2VyKHsKCQkJdHlwZTogc2hpZnRFdmVudCwKCQkJc2hpZnR0bzogc2hpZnRvCgkJfSk7Cgl9LAoKCS8qKgoJICogQG1ldGhvZCBvbkhhc2hDaGFuZ2UKCSAqIEBwYXJhbSB7alF1ZXJ5IEV2ZW50fSBldmVudCBFdmVudCB0aGF0IHRyaWdnZXJlZCB0aGUgZnVuY3Rpb24gY2FsbAoJICovCglvbkhhc2hDaGFuZ2UgPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBpbml0aWFsaXplZCApIHsKCQkJdmFyIGhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaCwKCQkJCSRoYXNoVGFyZ2V0ID0gJCggaGFzaCApOwoKCQkJaWYgKCAkaGFzaFRhcmdldC5sZW5ndGggIT09IDAgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJaWYgKCBpc1NtYWxsVmlldyAmJiAkaGFzaFRhcmdldFsgMCBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJkZXRhaWxzIiApIHsKCQkJCQkkaGFzaFRhcmdldAoJCQkJCQkuY2hpbGRyZW4oICJzdW1tYXJ5IiApCgkJCQkJCQkudHJpZ2dlciggImNsaWNrIiApOwoJCQkJfSBlbHNlIHsKCQkJCQkkaGFzaFRhcmdldAoJCQkJCQkucGFyZW50KCkKCQkJCQkJCS5maW5kKCAiPiB1bCBbaHJlZiQ9JyIgKyBoYXNoICsgIiddIiApCgkJCQkJCQkJLnRyaWdnZXIoICJjbGljayIgKTsKCQkJCX0KCQkJfQoJCX0KCX0sCgoJb25SZXNpemUgPSBmdW5jdGlvbigpIHsKCQl2YXIgJGVsbSwgJGRldGFpbHMsICR0YWJsaXN0LCAkb3BlbkRldGFpbHMsCgkJCSRub25PcGVuRGV0YWlscywgJGFjdGl2ZSwgJHN1bW1hcnk7CgoJCWlmICggaW5pdGlhbGl6ZWQgKSB7CgkJCWlzU21hbGxWaWV3ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mKCBzbWFsbFZpZXdQYXR0ZXJuICkgIT09IC0xOwoJCQkkZWxtID0gJCggc2VsZWN0b3IgKTsKCQkJJGRldGFpbHMgPSAkZWxtLmZpbmQoICI+IC50YWJwYW5lbHMgPiBkZXRhaWxzIiApOwoJCQlpZiAoICRkZXRhaWxzLmxlbmd0aCAhPT0gMCApIHsKCQkJCWlmICggaXNTbWFsbFZpZXcgIT09IG9sZElzU21hbGxWaWV3ICkgewoJCQkJCSRzdW1tYXJ5ID0gJGRldGFpbHMuY2hpbGRyZW4oICJzdW1tYXJ5IiApOwoJCQkJCSR0YWJsaXN0ID0gJGVsbS5jaGlsZHJlbiggInVsIiApOwoKCQkJCQkvLyBEaXNhYmxlIGVxdWFsIGhlaWdodHMgZm9yIHNtYWxsIHZpZXcKCQkJCQlpZiAoICRlbG0uYXR0ciggImNsYXNzIiApLmluZGV4T2YoIGVxdWFsSGVpZ2h0Q2xhc3MgKSAhPT0gLTEgKSB7CgkJCQkJCSRlbG0udG9nZ2xlQ2xhc3MoIGVxdWFsSGVpZ2h0Q2xhc3MgKyAiICIgKyBlcXVhbEhlaWdodE9mZkNsYXNzICk7CgkJCQkJfQoKCQkJCQlpZiAoIGlzU21hbGxWaWV3ICkgewoKCQkJCQkJLy8gU3dpdGNoIHRvIHNtYWxsIHZpZXcKCQkJCQkJJGFjdGl2ZSA9ICR0YWJsaXN0LmZpbmQoICIuYWN0aXZlIGEiICk7CgkJCQkJCSRkZXRhaWxzCgkJCQkJCQkucmVtb3ZlQXR0ciggInJvbGUgYXJpYS1leHBhbmRlZCBhcmlhLWhpZGRlbiIgKQoJCQkJCQkJLnJlbW92ZUNsYXNzKCAiZmFkZSBvdXQgaW4iICk7CgkJCQkJCSRvcGVuRGV0YWlscyA9ICRkZXRhaWxzCgkJCQkJCQkJCQkJLmZpbHRlciggIiMiICsgJGFjdGl2ZS5hdHRyKCAiaHJlZiIgKS5zdWJzdHJpbmcoIDEgKSApCgkJCQkJCQkJCQkJCS5hdHRyKCAib3BlbiIsICJvcGVuIiApCgkJCQkJCQkJCQkJCS5hZGRDbGFzcyggIm9wZW4iICk7CgkJCQkJCSRub25PcGVuRGV0YWlscyA9ICRkZXRhaWxzLm5vdCggJG9wZW5EZXRhaWxzICkKCQkJCQkJCQkJCQkJCS5yZW1vdmVBdHRyKCAib3BlbiIgKQoJCQkJCQkJCQkJCQkJLnJlbW92ZUNsYXNzKCAib3BlbiIgKTsKCQkJCQl9IGVsc2UgaWYgKCBvbGRJc1NtYWxsVmlldyApIHsKCgkJCQkJCS8vIFN3aXRjaCB0byBsYXJnZSB2aWV3CgkJCQkJCSRvcGVuRGV0YWlscyA9ICRkZXRhaWxzLmZpbHRlciggIltvcGVuXSIgKTsKCQkJCQkJJG9wZW5EZXRhaWxzID0gKCAkb3BlbkRldGFpbHMubGVuZ3RoID09PSAwID8gJGRldGFpbHMgOiAkb3BlbkRldGFpbHMgKS5lcSggMCApOwoKCQkJCQkJJGRldGFpbHMKCQkJCQkJCS5hdHRyKHsKCQkJCQkJCQlyb2xlOiAidGFicGFuZWwiLAoJCQkJCQkJCW9wZW46ICJvcGVuIgoJCQkJCQkJfSkKCQkJCQkJCS5ub3QoICRvcGVuRGV0YWlscyApCgkJCQkJCQkJLmFkZENsYXNzKCAiZmFkZSBvdXQiICkKCQkJCQkJCQkuYXR0cih7CgkJCQkJCQkJCSJhcmlhLWhpZGRlbiI6ICJ0cnVlIiwKCQkJCQkJCQkJImFyaWEtZXhwYW5kZWQiOiAiZmFsc2UiCgkJCQkJCQkJfSk7CgoJCQkJCQkkb3BlbkRldGFpbHMKCQkJCQkJCS5hZGRDbGFzcyggImZhZGUgaW4iICkKCQkJCQkJCS5hdHRyKHsKCQkJCQkJCQkJImFyaWEtaGlkZGVuIjogImZhbHNlIiwKCQkJCQkJCQkJImFyaWEtZXhwYW5kZWQiOiAidHJ1ZSIKCQkJCQkJCQl9KQoJCQkJCQkJLnBhcmVudCgpCgkJCQkJCQkJLmZpbmQoICI+IHVsIFtocmVmJD0nIiArICRvcGVuRGV0YWlscy5hdHRyKCAiaWQiICkgKyAiJ10iICkKCQkJCQkJCQkJLnRyaWdnZXIoICJjbGljayIgKTsKCQkJCQl9CgoJCQkJCSRzdW1tYXJ5LmF0dHIoICJhcmlhLWhpZGRlbiIsICFpc1NtYWxsVmlldyApOwoJCQkJCSR0YWJsaXN0LmF0dHIoICJhcmlhLWhpZGRlbiIsIGlzU21hbGxWaWV3ICk7CgkJCQl9IGVsc2UgewoKCQkJCQkvLyBFbmFibGUgZXF1YWwgaGVpZ2h0cyBmb3IgbGFyZ2UgdmlldwoJCQkJCWlmICggJGVsbS5hdHRyKCAiY2xhc3MiICkuaW5kZXhPZiggZXF1YWxIZWlnaHRDbGFzcyApICE9PSAtMSApIHsKCQkJCQkJJGVsbS50b2dnbGVDbGFzcyggZXF1YWxIZWlnaHRDbGFzcyArICIgIiArIGVxdWFsSGVpZ2h0T2ZmQ2xhc3MgKTsKCQkJCQl9CgkJCQl9CgkJCQlvbGRJc1NtYWxsVmlldyA9IGlzU21hbGxWaWV3OwoJCQl9CgkJfQoJfTsKCiAvLyBCaW5kIHRoZSBpbml0IGV2ZW50IG9mIHRoZSBwbHVnaW4KICRkb2N1bWVudC5vbiggInRpbWVycG9rZS53YiAiICsgaW5pdEV2ZW50ICsgIiAiICsgc2hpZnRFdmVudCwgc2VsZWN0b3IsIGZ1bmN0aW9uKCBldmVudCApIHsKCXZhciBldmVudFRhcmdldCA9IGV2ZW50LnRhcmdldCwKCQlldmVudEN1cnJlbnRUYXJnZXQgPSBldmVudC5jdXJyZW50VGFyZ2V0LAoJCSRlbG07CgoJCS8vIEZpbHRlciBvdXQgYW55IGV2ZW50cyB0cmlnZ2VyZWQgYnkgZGVzY2VuZGFudHMKCQlpZiAoIGV2ZW50Q3VycmVudFRhcmdldCA9PT0gZXZlbnRUYXJnZXQgKSB7CgkJCXN3aXRjaCAoIGV2ZW50LnR5cGUgKSB7CgkJCWNhc2UgInRpbWVycG9rZSI6CgkJCQkkZWxtID0gJCggZXZlbnRUYXJnZXQgKTsKCQkJCWlmICggISRlbG0uaGFzQ2xhc3MoIGNvbXBvbmVudE5hbWUgKyAiLWluaXRlZCIgKSApIHsKCQkJCQlpbml0KCBldmVudCApOwoJCQkJfSBlbHNlIGlmICggJGVsbS5oYXNDbGFzcyggInBsYXlpbmciICkgKSB7CgkJCQkJb25UaW1lclBva2UoICRlbG0gKTsKCQkJCX0KCQkJCWJyZWFrOwoKCQkJLyoKCQkJICogSW5pdAoJCQkgKi8KCQkJY2FzZSAid2ItaW5pdCI6CgkJCQlpbml0KCBldmVudCApOwoJCQkJYnJlYWs7CgoJCQkvKgoJCQkgKiBDaGFuZ2UgU2xpZGVzCgkJCSAqLwoJCQljYXNlICJ3Yi1zaGlmdCI6CgkJCQlvblNoaWZ0KCBldmVudCwgJCggZXZlbnRUYXJnZXQgKSApOwoJCQkJYnJlYWs7CgkJCX0KCQl9CgoJLyoKCSAqIFNpbmNlIHdlIGFyZSB3b3JraW5nIHdpdGggZXZlbnRzIHdlIHdhbnQgdG8gZW5zdXJlIHRoYXQgd2UgYXJlIGJlaW5nIHBhc3NpdmUgYWJvdXQgb3VyIGNvbnRyb2wsCgkgKiBzbyByZXR1cm5pbmcgdHJ1ZSBhbGxvd3MgZm9yIGV2ZW50cyB0byBhbHdheXMgY29udGludWUKCSAqLwoJcmV0dXJuIHRydWU7CiB9KTsKCiAvKgogICogVGFicywgbmV4dCwgcHJldmlvdXMgYW5kIHBsYXkvcGF1c2UKICAqLwogJGRvY3VtZW50Lm9uKCBhY3RpdmF0ZUV2ZW50LCBjb250cm9scywgZnVuY3Rpb24oIGV2ZW50ICkgewoJdmFyIHdoaWNoID0gZXZlbnQud2hpY2gsCgkJZWxtID0gZXZlbnQuY3VycmVudFRhcmdldCwKCQljbGFzc05hbWUgPSBlbG0uY2xhc3NOYW1lLAoJCXJvdFN0b3BUZXh0ID0gaTE4blRleHQucm90U3RvcCwKCQlwbGF5VGV4dCA9IGkxOG5UZXh0LnBsYXksCgkJJGVsbSwgdGV4dCwgaW52LCAkc2xkciwgc2xkcklkLCAkcGx5cGF1c2UsIGRhdGEsIGlzUGxheWluZywgaXNQbGF5UGF1c2U7CgoJLy8gSWdub3JlIG1pZGRsZSBhbmQgcmlnaHQgbW91c2UgYnV0dG9ucyBhbmQgbW9kaWZpZWQga2V5cwoJaWYgKCAhKCBldmVudC5jdHJsS2V5IHx8IGV2ZW50LmFsdEtleSB8fCBldmVudC5tZXRhS2V5ICkgJiYKCQkJKCAhd2hpY2ggfHwgd2hpY2ggPT09IDEgfHwgd2hpY2ggPT09IDEzIHx8IHdoaWNoID09PSAzMiB8fAoJCQkoIHdoaWNoID4gMzYgJiYgd2hpY2ggPCA0MSApICkgKSB7CgoJCS8vIFN0b3AgcHJvcGFnYXRpb24gb2YgdGhlIGFjdGl2YXRlIGV2ZW50CgkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQlpZiAoIGV2ZW50LnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CgkJfSBlbHNlIHsKCQkJZXZlbnQuY2FuY2VsQnViYmxlID0gdHJ1ZTsKCQl9CgoJCSRlbG0gPSAkKCBlbG0gKTsKCQkkc2xkciA9ICRlbG0uY2xvc2VzdCggc2VsZWN0b3IgKTsKCQlzbGRySWQgPSAkc2xkclsgMCBdLmlkOwoJCWlzUGxheWluZyA9ICRzbGRyLmhhc0NsYXNzKCAicGxheWluZyIgKSwKCQlpc1BsYXlQYXVzZSA9IGNsYXNzTmFtZS5pbmRleE9mKCAicGx5cGF1c2UiICkgIT09IC0xOwoKCQkvLyBSZXNldCBjdGltZSB0byAwCgkJZGF0YSA9ICRzbGRyLmRhdGEoIGNvbXBvbmVudE5hbWUgKTsKCQlkYXRhLmN0aW1lID0gMDsKCQkkc2xkci5kYXRhKCBjb21wb25lbnROYW1lLCBkYXRhICk7CgoJCS8vIFN0b3AgdGhlIHNsaWRlciBmcm9tIHBsYXlpbmcgdW5sZXNzIGl0IGlzIGFscmVhZHkgc3RvcHBlZAoJCS8vIGFuZCB0aGUgcGxheSBidXR0b24gaXMgYWN0aXZhdGVkCgkJaWYgKCBpc1BsYXlpbmcgfHwgKCB3aGljaCA8IDM3ICYmIGlzUGxheVBhdXNlICkgKSB7CgkJCWlmICggaXNQbGF5aW5nICkgewoJCQkJd2IucmVtb3ZlKCAiIyIgKyBzbGRySWQgKyBzZWxlY3RvciApOwoJCQl9IGVsc2UgewoJCQkJd2IuYWRkKCAiIyIgKyBzbGRySWQgKyBzZWxlY3RvciApOwoJCQl9CgoJCQkkcGx5cGF1c2UgPSAkc2xkci5maW5kKCAiYS5wbHlwYXVzZSIgKTsKCQkJJHBseXBhdXNlCgkJCQkuZmluZCggIi5nbHlwaGljb24iICkKCQkJCQkudG9nZ2xlQ2xhc3MoICJnbHlwaGljb24tcGxheSBnbHlwaGljb24tcGF1c2UiICk7CgoJCQkkc2xkci50b2dnbGVDbGFzcyggInBsYXlpbmciICk7CgkJCWlzUGxheWluZyA9ICFpc1BsYXlpbmc7CgoJCQl0ZXh0ID0gJHBseXBhdXNlWyAwIF0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJzcGFuIiApWyAxIF07CgkJCXRleHQuaW5uZXJIVE1MID0gdGV4dC5pbm5lckhUTUwgPT09IHBsYXlUZXh0ID8KCQkJCWkxOG5UZXh0LnBhdXNlIDoKCQkJCXBsYXlUZXh0OwoKCQkJaW52ID0gJHBseXBhdXNlLmZpbmQoICIud2ItaW52IiApWyAwIF07CgkJCWludi5pbm5lckhUTUwgPSBpbnYuaW5uZXJIVE1MID09PSByb3RTdG9wVGV4dCA/CgkJCQlpMThuVGV4dC5yb3RTdGFydCA6CgkJCQlyb3RTdG9wVGV4dDsKCQl9CgoJCWlmICggd2hpY2ggPiAzNiApIHsKCQkJb25DeWNsZSggJHNsZHIsIHdoaWNoIDwgMzkgPyAtMSA6IDEgKTsKCQkJJHNsZHIuZmluZCggIj4gW3JvbGU9dGFibGlzdF0gLmFjdGl2ZSBhIiApLnRyaWdnZXIoIHNldEZvY3VzRXZlbnQgKTsKCQl9IGVsc2UgewoJCQlpZiAoIGVsbS5nZXRBdHRyaWJ1dGUoICJyb2xlIiApID09PSAidGFiIiApIHsKCQkJCW9uUGljayggJHNsZHIsICRlbG0gKTsKCQkJCWlmICggd2hpY2ggPiAxICkgewoJCQkJCSRzbGRyLmZpbmQoIGVsbS5nZXRBdHRyaWJ1dGUoICJocmVmIiApICkKCQkJCQkJLnRyaWdnZXIoIHNldEZvY3VzRXZlbnQgKTsKCQkJCX0KCQkJfSBlbHNlIGlmICggIWlzUGxheWluZyAmJiAhaXNQbGF5UGF1c2UgKSB7CgkJCQlvbkN5Y2xlKCAkc2xkciwgY2xhc3NOYW1lLmluZGV4T2YoICJwcnYiICkgIT09IC0xID8gLTEgOiAxICk7CgkJCX0KCQl9Cgl9CgoJLyoKCSAqIFNpbmNlIHdlIGFyZSB3b3JraW5nIHdpdGggZXZlbnRzIHdlIHdhbnQgdG8gZW5zdXJlIHRoYXQgd2UgYXJlIGJlaW5nIHBhc3NpdmUgYWJvdXQgb3VyIGNvbnRyb2wsCgkgKiBzbyByZXR1cm5pbmcgdHJ1ZSBhbGxvd3MgZm9yIGV2ZW50cyB0byBhbHdheXMgY29udGludWUKCSAqLwoJcmV0dXJuIHRydWU7Cn0pOwoKLy8gUGF1c2Ugb24gZXNjYXBlCiRkb2N1bWVudC5vbiggImtleWRvd24iLCBzZWxlY3RvciArICIsICIgKyBzZWxlY3RvciArICIgW3JvbGU9dGFicGFuZWxdIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoKCS8vIEVzY2FwZSBrZXkKCWlmICggZXZlbnQud2hpY2ggPT09IDI3ICkgewoJCXZhciAkc2xkciA9ICQoIGV2ZW50LnRhcmdldCApLmNsb3Nlc3QoIHNlbGVjdG9yICk7CgoJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCWlmICggJHNsZHIuaGFzQ2xhc3MoICJwbGF5aW5nIiApICkgewoJCQkkc2xkci5maW5kKCAiLnBseXBhdXNlIiApLnRyaWdnZXIoICJjbGljayIgKTsKCQl9Cgl9Cn0pOwoKJGRvY3VtZW50Lm9uKCAiY2xpY2sga2V5ZG93biIsIHNlbGVjdG9yICsgIiBbcm9sZT10YWJwYW5lbF0iLCBmdW5jdGlvbiggZXZlbnQgKSB7Cgl2YXIgY3VycmVudFRhcmdldCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQsCgkJd2hpY2ggPSBldmVudC53aGljaCwKCQkkY29udGFpbmVyOwoKCS8vIFN0b3AgcHJvcGFnYXRpb24gb2YgdGhlIGNsaWNrL2tleWRvd24gZXZlbnQKCWlmICggZXZlbnQuc3RvcFByb3BhZ2F0aW9uICkgewoJCWV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwoJfSBlbHNlIHsKCQlldmVudC5jYW5jZWxCdWJibGUgPSB0cnVlOwoJfQoKCWlmICggZXZlbnQudGFyZ2V0ID09PSAiY2xpY2siICkgewoKCQkvLyBJZ25vcmUgbWlkZGxlIGFuZCByaWdodCBtb3VzZSBidXR0b25zCgkJaWYgKCAhd2hpY2ggfHwgd2hpY2ggPT09IDEgKSB7CgkJCSRjb250YWluZXIgPSAkKCBldmVudC5jdXJyZW50VGFyZ2V0ICkuY2xvc2VzdCggc2VsZWN0b3IgKTsKCgkJCS8vIFN0b3AgdGhlIGNhcm91c2VsIGlmIHRoZXJlIGlzIGEgY2xpY2sgd2l0aGluIGEgcGFuZWwKCQkJaWYgKCAkY29udGFpbmVyLmhhc0NsYXNzKCAicGxheWluZyIgKSApIHsKCQkJCSRjb250YWluZXIuZmluZCggIi5wbHlwYXVzZSIgKS50cmlnZ2VyKCAiY2xpY2siICk7CgkJCX0KCQl9Cgl9IGVsc2UgewoKCQkvLyBDdHJsICsgVXAgYXJyb3cKCQlpZiAoIGV2ZW50LmN0cmxLZXkgJiYgZXZlbnQud2hpY2ggPT09IDM4ICkgewoKCQkJLy8gTW92ZSBmb2N1cyB0byB0aGUgc3VtbWFyeSBlbGVtZW50CgkJCSQoIGN1cnJlbnRUYXJnZXQgKQoJCQkJLmNsb3Nlc3QoIHNlbGVjdG9yICkKCQkJCQkuZmluZCggIltocmVmJD0nIyIgKyBjdXJyZW50VGFyZ2V0LmlkICsgIiddIiApCgkJCQkJCS50cmlnZ2VyKCAic2V0Zm9jdXMud2IiICk7CgkJfQoJfQp9KTsKCi8vIEhhbmRsaW5nIGZvciBsaW5rcyB0byB0YWJzIGZyb20gd2l0aGluIGEgcGFuZWwKJGRvY3VtZW50Lm9uKCAiY2xpY2siLCBzZWxlY3RvciArICIgW3JvbGU9dGFicGFuZWxdIGEiLCBmdW5jdGlvbiggZXZlbnQgKSB7Cgl2YXIgY3VycmVudFRhcmdldCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQsCgkJaHJlZiA9IGN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCAiaHJlZiIgKSwKCQl3aGljaCA9IGV2ZW50LndoaWNoLAoJCSRjb250YWluZXIsICRwYW5lbCwgJHN1bW1hcnk7CgoJLy8gSWdub3JlIG1pZGRsZSBhbmQgcmlnaHQgbW91c2UgYnV0dG9ucwoJaWYgKCAoICF3aGljaCB8fCB3aGljaCA9PT0gMSApICYmIGhyZWYuY2hhckF0KCAwICkgPT09ICIjIiApIHsKCQkkY29udGFpbmVyID0gJCggY3VycmVudFRhcmdldCApLmNsb3Nlc3QoIHNlbGVjdG9yICk7CgkJJHBhbmVsID0gJGNvbnRhaW5lci5maW5kKCBocmVmICsgIltyb2xlPXRhYnBhbmVsXSIgKTsKCQlpZiAoICRwYW5lbC5sZW5ndGggIT09IDAgKSB7CgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCSRzdW1tYXJ5ID0gJHBhbmVsLmNoaWxkcmVuKCAic3VtbWFyeSIgKTsKCQkJaWYgKCAkc3VtbWFyeS5sZW5ndGggIT09IDAgJiYgJHN1bW1hcnkuYXR0ciggImFyaWEtaGlkZGVuIiApICE9PSAidHJ1ZSIgKSB7CgkJCQkkc3VtbWFyeS50cmlnZ2VyKCAiY2xpY2siICk7CgkJCX0gZWxzZSB7CgkJCQkkY29udGFpbmVyLmZpbmQoIGhyZWYgKyAiLWxuayIgKS50cmlnZ2VyKCAiY2xpY2siICk7CgkJCX0KCQl9Cgl9Cn0pOwoKLy8gVGhlc2UgZXZlbnRzIG9ubHkgZmlyZSBhdCB0aGUgZG9jdW1lbnQgbGV2ZWwKJGRvY3VtZW50Lm9uKCB3Yi5yZXNpemVFdmVudHMsIG9uUmVzaXplICk7CgovLyBUaGlzIGV2ZW50IG9ubHkgZmlyZXMgb24gdGhlIHdpbmRvdwokd2luZG93Lm9uKCAiaGFzaGNoYW5nZSIsIG9uSGFzaENoYW5nZSApOwoKJGRvY3VtZW50Lm9uKCBhY3RpdmF0ZUV2ZW50LCBzZWxlY3RvciArICIgPiAudGFicGFuZWxzID4gZGV0YWlscyA+IHN1bW1hcnkiLCBmdW5jdGlvbiggZXZlbnQgKSB7Cgl2YXIgd2hpY2ggPSBldmVudC53aGljaCwKCQlkZXRhaWxzID0gZXZlbnQuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLAoJCSRkZXRhaWxzOwoKCWlmICggISggZXZlbnQuY3RybEtleSB8fCBldmVudC5hbHRLZXkgfHwgZXZlbnQubWV0YUtleSApICYmCgkJKCAhd2hpY2ggfHwgd2hpY2ggPT09IDEgfHwgd2hpY2ggPT09IDEzIHx8IHdoaWNoID09PSAzMiApICkgewoKCQkkZGV0YWlscyA9ICQoIGRldGFpbHMgKTsKCgkJLy8gVXBkYXRlIHNlc3Npb25TdG9yYWdlIHdpdGggdGhlIGN1cnJlbnQgYWN0aXZlIHBhbmVsCgkJdHJ5IHsKCQkJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgKCQkJCSRkZXRhaWxzLmNsb3Nlc3QoIHNlbGVjdG9yICkuYXR0ciggImlkIiApICsgYWN0aXZlUGFuZWwsCgkJCQlkZXRhaWxzLmlkCgkJCSk7CgkJfSBjYXRjaCAoIGVycm9yICkgewoJCX0KCgkJLy8gSWRlbnRpZnkgdGhhdCB0aGUgdGFiYmVkIGludGVyZmFjZSB3YXMgdXBkYXRlZAoJCSRkZXRhaWxzLmNsb3Nlc3QoIHNlbGVjdG9yICkudHJpZ2dlciggdXBkYXRlZEV2ZW50LCBbICRkZXRhaWxzIF0gKTsKCX0KfSk7CgovLyBBZGQgdGhlIHRpbWVyIHBva2UgdG8gaW5pdGlhbGl6ZSB0aGUgcGx1Z2luCndiLmFkZCggc2VsZWN0b3IgKTsKCn0pKCBqUXVlcnksIHdpbmRvdywgd2IgKTsK",
                "body": "LyoqCiAqIEB0aXRsZSBXRVQtQk9FVyBUYWJiZWQgaW50ZXJmYWNlCiAqIEBvdmVydmlldyBEeW5hbWljYWxseSBzdGFja3MgbXVsdGlwbGUgc2VjdGlvbnMgb2YgY29udGVudCwgdHJhbnNmb3JtaW5nIHRoZW0gaW50byBhIHRhYmJlZCBpbnRlcmZhY2UuCiAqIEBsaWNlbnNlIHdldC1ib2V3LmdpdGh1Yi5pby93ZXQtYm9ldy9MaWNlbnNlLWVuLmh0bWwgLyB3ZXQtYm9ldy5naXRodWIuaW8vd2V0LWJvZXcvTGljZW5jZS1mci5odG1sCiAqIEBhdXRob3IgV0VUIENvbW11bml0eQogKi8KKGZ1bmN0aW9uKCAkLCB3aW5kb3csIHdiICkgewoidXNlIHN0cmljdCI7CgovKgogKiBWYXJpYWJsZSBhbmQgZnVuY3Rpb24gZGVmaW5pdGlvbnMuCiAqIFRoZXNlIGFyZSBnbG9iYWwgdG8gdGhlIHBsdWdpbiAtIG1lYW5pbmcgdGhhdCB0aGV5IHdpbGwgYmUgaW5pdGlhbGl6ZWQgb25jZSBwZXIgcGFnZSwKICogbm90IG9uY2UgcGVyIGluc3RhbmNlIG9mIHBsdWdpbiBvbiB0aGUgcGFnZS4gU28sIHRoaXMgaXMgYSBnb29kIHBsYWNlIHRvIGRlZmluZQogKiB2YXJpYWJsZXMgdGhhdCBhcmUgY29tbW9uIHRvIGFsbCBpbnN0YW5jZXMgb2YgdGhlIHBsdWdpbiBvbiBhIHBhZ2UuCiAqLwp2YXIgY29tcG9uZW50TmFtZSA9ICJ3Yi10YWJzIiwKCXNlbGVjdG9yID0gIi4iICsgY29tcG9uZW50TmFtZSwKCWluaXRFdmVudCA9ICJ3Yi1pbml0IiArIHNlbGVjdG9yLAoJc2hpZnRFdmVudCA9ICJ3Yi1zaGlmdCIgKyBzZWxlY3RvciwKCXVwZGF0ZWRFdmVudCA9ICJ3Yi11cGRhdGVkIiArIHNlbGVjdG9yLAoJc2V0Rm9jdXNFdmVudCA9ICJzZXRmb2N1cy53YiIsCgljb250cm9scyA9IHNlbGVjdG9yICsgIiBbcm9sZT10YWJsaXN0XSBhLCAiICsgc2VsZWN0b3IgKyAiIFtyb2xlPXRhYmxpc3RdIC50YWItY291bnQiLAoJdW5pcXVlQ291bnQgPSAwLAoJaW5pdGlhbGl6ZWQgPSBmYWxzZSwKCWVxdWFsSGVpZ2h0Q2xhc3MgPSAid2ItZXFodCIsCgllcXVhbEhlaWdodE9mZkNsYXNzID0gZXF1YWxIZWlnaHRDbGFzcyArICItb2ZmIiwKCWFjdGl2ZVBhbmVsID0gIi1hY3RpdmVQYW5lbCIsCglhY3RpdmF0ZUV2ZW50ID0gImNsaWNrIGtleWRvd24iLAoJJGRvY3VtZW50ID0gd2IuZG9jLAoJJHdpbmRvdyA9IHdiLndpbiwKCWkxOG4sIGkxOG5UZXh0LAoKCS8vIEluY2x1ZGVzICJzbWFsbHZpZXciLCAieHNtYWxsdmlldyIgYW5kICJ4eHNtYWxsdmlldyIKCXNtYWxsVmlld1BhdHRlcm4gPSAic21hbGx2aWV3IiwKCWlzU21hbGxWaWV3LCBvbGRJc1NtYWxsVmlldywKCglkZWZhdWx0cyA9IHsKCQlleGNsdWRlUGxheTogZmFsc2UsCgkJaW50ZXJ2YWw6IDYKCX0sCgoJLyoqCgkgKiBAbWV0aG9kIGluaXQKCSAqIEBwYXJhbSB7alF1ZXJ5IEV2ZW50fSBldmVudCBFdmVudCB0aGF0IHRyaWdnZXJlZCB0aGUgZnVuY3Rpb24gY2FsbAoJICovCglpbml0ID0gZnVuY3Rpb24oIGV2ZW50ICkgewoKCQkvLyBTdGFydCBpbml0aWFsaXphdGlvbgoJCS8vIHJldHVybnMgRE9NIG9iamVjdCA9IHByb2NlZWQgd2l0aCBpbml0CgkJLy8gcmV0dXJucyB1bmRlZmluZWQgPSBkbyBub3QgcHJvY2VlZCB3aXRoIGluaXQgKGUuZy4sIGFscmVhZHkgaW5pdGlhbGl6ZWQpCgkJdmFyIGVsbSA9IHdiLmluaXQoIGV2ZW50LCBjb21wb25lbnROYW1lLCBzZWxlY3RvciApLAoJCQloYXNoRm9jdXMgPSBmYWxzZSwKCQkJaXNDYXJvdXNlbCA9IHRydWUsCgkJCW9wZW4gPSAib3BlbiIsCgkJCSRwYW5lbHMsICR0YWJsaXN0LCBhY3RpdmVJZCwgJG9wZW5QYW5lbCwgJGVsbSwgZWxtSWQsCgkJCXNldHRpbmdzLCAkcGFuZWwsIGksIGxlbiwgdGFibGlzdCwgaXNPcGVuLAoJCQluZXdJZCwgcG9zaXRpb25ZLCBncm91cENsYXNzOwoKCQlpZiAoIGVsbSApIHsKCQkJJGVsbSA9ICQoIGVsbSApOwoKCQkJLy8gRm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LiBTaG91bGQgYmUgcmVtb3ZlZCBpbiBXRVQgdjQuMQoJCQlpZiAoICRlbG0uY2hpbGRyZW4oICIudGFicGFuZWxzIiApLmxlbmd0aCA9PT0gMCApIHsKCQkJCSRlbG0uY2hpbGRyZW4oICJbcm9sZT10YWJwYW5lbF0sIGRldGFpbHMiICkud3JhcEFsbCggIjxkaXYgY2xhc3M9J3RhYnBhbmVscycvPiIgKTsKCQkJfQoKCQkJJHBhbmVscyA9ICRlbG0uZmluZCggIj4gLnRhYnBhbmVscyA+IFtyb2xlPXRhYnBhbmVsXSwgPiAudGFicGFuZWxzID4gZGV0YWlscyIgKTsKCQkJJHRhYmxpc3QgPSAkZWxtLmNoaWxkcmVuKCAiW3JvbGU9dGFibGlzdF0iICk7CgkJCWlzQ2Fyb3VzZWwgPSAkdGFibGlzdC5sZW5ndGggIT09IDA7CgkJCWFjdGl2ZUlkID0gd2IucGFnZVVybFBhcnRzLmhhc2guc3Vic3RyaW5nKCAxICk7CgkJCSRvcGVuUGFuZWwgPSBhY3RpdmVJZC5sZW5ndGggIT09IDAgPyAkcGFuZWxzLmZpbHRlciggIiMiICsgYWN0aXZlSWQgKSA6IHVuZGVmaW5lZDsKCQkJZWxtSWQgPSBlbG0uaWQ7CgkJCXNldHRpbmdzID0gJC5leHRlbmQoCgkJCQl0cnVlLAoJCQkJe30sCgkJCQlkZWZhdWx0cywKCQkJCXsKCQkJCQlpbnRlcnZhbDogJGVsbS5oYXNDbGFzcyggInNsb3ciICkgPwoJCQkJCQkJCTkgOiAkZWxtLmhhc0NsYXNzKCAiZmFzdCIgKSA/CgkJCQkJCQkJCTMgOiBkZWZhdWx0cy5pbnRlcnZhbCwKCQkJCQlleGNsdWRlUGxheTogJGVsbS5oYXNDbGFzcyggImV4Y2x1ZGUtcGxheSIgKSwKCQkJCQlwbGF5aW5nOiAkZWxtLmhhc0NsYXNzKCAicGxheWluZyIgKQoJCQkJfSwKCQkJCXdpbmRvd1sgY29tcG9uZW50TmFtZSBdLAoJCQkJd2IuZ2V0RGF0YSggJGVsbSwgY29tcG9uZW50TmFtZSApCgkJCSk7CgoJCQkvLyBFbnN1cmUgdGhlcmUgaXMgYW4gaWQgb24gdGhlIGVsZW1lbnQKCQkJaWYgKCAhZWxtSWQgKSB7CgkJCQllbG1JZCA9ICJ0YWJzLWNudC0iICsgdW5pcXVlQ291bnQ7CgkJCQkkZWxtLmF0dHIoICJpZCIsIGVsbUlkICk7CgkJCQl1bmlxdWVDb3VudCArPSAxOwoJCQl9CgoJCQl0cnkgewoKCQkJCS8vIElmIHRoZSBwYW5lbCB3YXMgbm90IHNldCBieSBVUkwgaGFzaCwgdGhlbiBhdHRlbXB0IHRvCgkJCQkvLyByZXRyaWV2ZSBmcm9tIHNlc3Npb25TdG9yYWdlCgkJCQlpZiAoICEkb3BlblBhbmVsIHx8ICRvcGVuUGFuZWwubGVuZ3RoID09PSAwICkgewoJCQkJCWFjdGl2ZUlkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSggZWxtSWQgKyBhY3RpdmVQYW5lbCApOwoJCQkJCWlmICggYWN0aXZlSWQgKSB7CgkJCQkJCSRvcGVuUGFuZWwgPSAkcGFuZWxzLmZpbHRlciggIiMiICsgYWN0aXZlSWQgKTsKCQkJCQl9CgoJCQkJLy8gSWYgdGhlIHBhbmVsIHdhcyBzZXQgYnkgVVJMIGhhc2gsIHRoZW4gc3RvcmUgaW4gc2Vzc2lvblN0b3JhZ2UKCQkJCX0gZWxzZSB7CgkJCQkJaGFzaEZvY3VzID0gdHJ1ZTsKCQkJCQl0cnkgewoJCQkJCQlzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCBlbG1JZCArIGFjdGl2ZVBhbmVsLCBhY3RpdmVJZCApOwoJCQkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCQkJCQl9CgkJCQl9CgkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCQkJfQoKCQkJLy8gRGV0ZXJtaW5lIHRoZSBjdXJyZW50IHZpZXcKCQkJaXNTbWFsbFZpZXcgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NOYW1lLmluZGV4T2YoIHNtYWxsVmlld1BhdHRlcm4gKSAhPT0gLTE7CgoJCQkvLyBPbmx5IGluaXRpYWxpemUgdGhlIGkxOG5UZXh0IG9uY2UKCQkJaWYgKCAhaTE4blRleHQgKSB7CgkJCQlpMThuID0gd2IuaTE4bjsKCQkJCWkxOG5UZXh0ID0gewoJCQkJCXByZXY6IGkxOG4oICJwcnYiICksCgkJCQkJbmV4dDogaTE4biggIm54dCIgKSwKCQkJCQlwbGF5OiBpMThuKCAidGFiLXBsYXkiICksCgkJCQkJcm90U3RhcnQ6IGkxOG4oICJ0YWItcm90IiApLm9uLAoJCQkJCXJvdFN0b3A6IGkxOG4oICJ0YWItcm90IiApLm9mZiwKCQkJCQlzcGFjZTogaTE4biggInNwYWNlIiApLAoJCQkJCWh5cGhlbjogaTE4biggImh5cGhlbiIgKSwKCQkJCQlwYXVzZTogaTE4biggInBhdXNlIiApLAoJCQkJCXRhYkNvdW50OiBpMThuKCAibGItY3VyciIpCgkJCQl9OwoJCQl9CgoJCQkvLyBCdWlsZCB0aGUgdGFibGlzdCBhbmQgZW5oYW5jZSB0aGUgcGFuZWxzIGFzIG5lZWRlZCBmb3IgZGV0YWlscy9zdW1tYXJ5CgkJCWlmICggIWlzQ2Fyb3VzZWwgKSB7CgkJCQkkZWxtLmFkZENsYXNzKCAidGFicy1hY2MiICk7CgkJCQlncm91cENsYXNzID0gZWxtSWQgKyAiLWdycCI7CgkJCQkkcGFuZWxzID0gJGVsbS5maW5kKCAiPiAudGFicGFuZWxzID4gZGV0YWlscyIgKTsKCQkJCWxlbiA9ICRwYW5lbHMubGVuZ3RoOwoKCQkJCS8vIEVuc3VyZSB0aGVyZSBpcyBvbmx5IG9uZSBwYW5lbCBvcGVuCgkJCQkvLyBPcmRlciBvZiBwcmlvcml0eSBpcyBoYXNoLCBvcGVuIHByb3BlcnR5LCBmaXJzdCBkZXRhaWxzCgkJCQlpZiAoICEkb3BlblBhbmVsIHx8ICRvcGVuUGFuZWwubGVuZ3RoID09PSAwICkgewoJCQkJCSRvcGVuUGFuZWwgPSAkcGFuZWxzLmZpbHRlciggIltvcGVuXSIgKS5maXJzdCgpOwoJCQkJCWlmICggJG9wZW5QYW5lbC5sZW5ndGggPT09IDAgKSB7CgkJCQkJCSRvcGVuUGFuZWwgPSAkcGFuZWxzLmVxKCAwICk7CgkJCQkJfQoJCQkJfQoJCQkJJHBhbmVscy5yZW1vdmVBdHRyKCBvcGVuICk7CgkJCQkkb3BlblBhbmVsLmF0dHIoIG9wZW4sIG9wZW4gKTsKCgkJCQkvLyBIaWRlIHRoZSB0YWJsaXN0IGluIHNtYWxsIHZpZXcgYW5kIHRoZSBzdW1tYXJ5IGVsZW1lbnRzIGluIGxhcmdlIHZpZXcKCQkJCXRhYmxpc3QgPSAiPHVsIHJvbGU9J3RhYmxpc3QnIGFyaWEtbGl2ZT0nb2ZmJyBjbGFzcz0nZ2VuZXJhdGVkJz4iOwoKCQkJCWZvciAoIGkgPSAwOyBpICE9PSBsZW47IGkgKz0gMSApIHsKCQkJCQkkcGFuZWwgPSAkcGFuZWxzLmVxKCBpICk7CgkJCQkJJHBhbmVsCgkJCQkJCS5hZGRDbGFzcyggZ3JvdXBDbGFzcyApCgkJCQkJCS5odG1sKAoJCQkJCQkJJHBhbmVsLmh0bWwoKQoJCQkJCQkJCS5yZXBsYWNlKCAvKDxcL3N1bW1hcnk+KS9pLCAiJDE8ZGl2IGNsYXNzPSd0Z2wtcGFuZWwnPiIgKSArCgkJCQkJCQkiPC9kaXY+IgoJCQkJCQkpOwoKCQkJCQluZXdJZCA9ICRwYW5lbC5hdHRyKCAiaWQiICk7CgkJCQkJaWYgKCAhbmV3SWQgKSB7CgkJCQkJCW5ld0lkID0gInRhYnBhbmVsIiArIHVuaXF1ZUNvdW50OwoJCQkJCQl1bmlxdWVDb3VudCArPSAxOwoJCQkJCQkkcGFuZWwuYXR0ciggImlkIiwgbmV3SWQgKTsKCQkJCQl9CgkJCQkJaXNPcGVuID0gISEkcGFuZWwuYXR0ciggb3BlbiApOwoKCQkJCQlpZiAoIGlzU21hbGxWaWV3ICkgewoJCQkJCQlpZiAoICFNb2Rlcm5penIuZGV0YWlscyApIHsKCQkJCQkJCSRwYW5lbC50b2dnbGVDbGFzcyggIm9wZW4iLCBpc09wZW4gKTsKCQkJCQkJfQoJCQkJCX0gZWxzZSB7CgkJCQkJCSRwYW5lbC5hdHRyKHsKCQkJCQkJCXJvbGU6ICJ0YWJwYW5lbCIsCgkJCQkJCQlvcGVuOiBvcGVuCgkJCQkJCX0pOwoJCQkJCQkkcGFuZWwuYWRkQ2xhc3MoICggTW9kZXJuaXpyLmRldGFpbHMgPyAiIiA6ICBvcGVuICsgIiAiICkgKwoJCQkJCQkJImZhZGUgIiArICggaXNPcGVuID8gImluIiA6ICJvdXQiICkgKTsKCQkJCQl9CgoJCQkJCXRhYmxpc3QgKz0gIjxsaSIgKyAoIGlzT3BlbiA/ICIgY2xhc3M9J2FjdGl2ZSciIDogIiIgKSArCgkJCQkJCSI+PGEgaWQ9JyIgKyBuZXdJZCArICItbG5rJyBocmVmPScjIiArIG5ld0lkICsgIic+IiArCgkJCQkJCSRwYW5lbC5jaGlsZHJlbiggInN1bW1hcnkiICkuaHRtbCgpICsgIjwvYT48L2xpPiI7CgkJCQl9CgoJCQkJJHRhYmxpc3QgPSAkKCB0YWJsaXN0ICsgIjwvdWw+IiApOwoJCQkJJGVsbQoJCQkJCS5wcmVwZW5kKCAkdGFibGlzdCApCgkJCQkJLmZpbmQoICI+IC50YWJwYW5lbHMgPiBkZXRhaWxzID4gc3VtbWFyeSIgKQoJCQkJCQkuYWRkQ2xhc3MoICJ3Yi10b2dnbGUgdGdsLXRhYiIgKQoJCQkJCQkuYXR0ciggImRhdGEtdG9nZ2xlIiwgIntcInBhcmVudFwiOiBcIiMiICsgZWxtSWQgKwoJCQkJCQkJIlwiLCBcImdyb3VwXCI6IFwiLiIgKyBncm91cENsYXNzICsgIlwifSIgKQoJCQkJCQkudHJpZ2dlciggIndiLWluaXQud2ItdG9nZ2xlIiApOwoJCQl9IGVsc2UgaWYgKCAkb3BlblBhbmVsICYmICRvcGVuUGFuZWwubGVuZ3RoICE9PSAwICkgewoJCQkJJHBhbmVscy5maWx0ZXIoICIuaW4iICkKCQkJCQkuYWRkQ2xhc3MoICJvdXQiICkKCQkJCQkucmVtb3ZlQ2xhc3MoICJpbiIgKTsKCQkJCSRvcGVuUGFuZWwKCQkJCQkuYWRkQ2xhc3MoICJpbiIgKQoJCQkJCS5yZW1vdmVDbGFzcyggIm91dCIgKTsKCQkJCSR0YWJsaXN0LmZpbmQoICIuYWN0aXZlIiApCgkJCQkJLnJlbW92ZUNsYXNzKCAiYWN0aXZlIiApOwoJCQkJJHRhYmxpc3QuZmluZCggImEiICkKCQkJCQkuZmlsdGVyKCAiW2hyZWYkPSciICsgYWN0aXZlSWQgKyAiJ10iICkKCQkJCQkucGFyZW50KCkKCQkJCQkJLmFkZENsYXNzKCAiYWN0aXZlIiApOwoJCQl9CgoJCQlkcml6emxlQXJpYSggJHBhbmVscywgJHRhYmxpc3QgKTsKCgkJCWlmICggaXNDYXJvdXNlbCApIHsKCgkJCQkvLyBSZXR1cm5zIHRydWUgaWYgdGhlIHRhYnMgc2hvdWxkIGJlIHJvdGF0aW5nIGF1dG9tYXRpY2FsbHkKCQkJCWlmICggY3JlYXRlQ29udHJvbHMoICR0YWJsaXN0LCBzZXR0aW5ncyApICkgewoKCQkJCQkvLyBSZWdpc3RlciB0aGlzIHNwZWNpZmljIHRhYnMgaW5zdGFuY2UgZm9yIHRpbWVycG9rZS53YiBldmVudHMKCQkJCQl3Yi5hZGQoICIjIiArIGVsbUlkICsgc2VsZWN0b3IgKTsKCQkJCX0KCQkJfQoKCQkJLy8gSWYgZm9jdXMgaXMgYmVpbmcgc2V0IGJ5IHRoZSBVUkwgaGFzaCwgdGhlbiBlbnN1cmUgdGhlIHRhYnMgYXJlCgkJCS8vIG5vdCBhYm92ZSB0aGUgdG9wIG9mIHRoZSB2aWV3cG9ydAoJCQlpZiAoIGhhc2hGb2N1cyApIHsKCgkJCQkvLyBOZWVkIGEgc2xpZ2h0IGRlbGF5IHRvIGFsbG93IGZvciB0aGUgcmVmbG93CgkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQkJCXBvc2l0aW9uWSA9ICR0YWJsaXN0Lm9mZnNldCgpLnRvcDsKCQkJCQlpZiAoIHBvc2l0aW9uWSA8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wICkgewoJCQkJCQlkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IHBvc2l0aW9uWTsKCQkJCQl9CgkJCQl9LCAxICk7CgkJCX0KCgkJCSRlbG0uZGF0YSh7CgkJCQkid2ItdGFicyI6IHsKCQkJCQlwYW5lbHM6ICRwYW5lbHMsCgkJCQkJdGFibGlzdDogJHRhYmxpc3QsCgkJCQkJc2V0dGluZ3M6IHNldHRpbmdzLAoJCQkJCWN0aW1lOiAwCgkJCQl9CgkJCX0pOwoKCQkJaW5pdGlhbGl6ZWQgPSB0cnVlOwoJCQlvblJlc2l6ZSgpOwoKCQkJLy8gSWRlbnRpZnkgdGhhdCBpbml0aWFsaXphdGlvbiBoYXMgY29tcGxldGVkCgkJCXdiLnJlYWR5KCAkZWxtLCBjb21wb25lbnROYW1lICk7CgkJfQoJfSwKCgkvKioKCSAqIEBtZXRob2Qgb25UaW1lclBva2UKCSAqIEBwYXJhbSB7alF1ZXJ5IERPTSBlbGVtZW50fSAkZWxtIFRoZSBwbHVnaW4gZWxlbWVudAoJICovCglvblRpbWVyUG9rZSA9IGZ1bmN0aW9uKCAkZWxtICkgewoJCXZhciBkYXRhID0gJGVsbS5kYXRhKCBjb21wb25lbnROYW1lICksCgkJCWRlbGF5Q3VycmVudCA9IHBhcnNlRmxvYXQoIGRhdGEuY3RpbWUgKSArIDAuNTsKCgkJLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byByb3RhdGUgcGFuZWxzCgkJaWYgKCBwYXJzZUZsb2F0KCBkYXRhLnNldHRpbmdzLmludGVydmFsICkgPD0gZGVsYXlDdXJyZW50ICkgewoJCQkkZWxtLnRyaWdnZXIoIHNoaWZ0RXZlbnQgKTsKCQkJZGVsYXlDdXJyZW50ID0gMDsKCQl9CgoJCWRhdGEuY3RpbWUgPSBkZWxheUN1cnJlbnQ7CgkJJGVsbS5kYXRhKCBjb21wb25lbnROYW1lLCBkYXRhICk7Cgl9LAoKCS8qKgoJICogQG1ldGhvZCBjcmVhdGVDb250cm9scwoJICogQHBhcmFtIHtqUXVlcnkgRE9NIGVsZW1lbnR9ICR0YWJsaXN0IFRoZSBwbHVnaW4gZWxlbWVudAoJICogQHBhcmFtIHtvYmplY3R9IHNldHRpbmdzIFNldHRpbmdzIGZvciB0aGUgdGFicyBpbnN0YW5jZQoJICogQHJldHVybnMge2Jvb2xlYW59IFdoZXRoZXIgb3Igbm90IHRoZSB0YWJzIHNob3VsZCBiZSByb3RhdGluZyBpbml0aWFsbHkKCSAqLwoJY3JlYXRlQ29udHJvbHMgPSBmdW5jdGlvbiggJHRhYmxpc3QsIHNldHRpbmdzICkgewoJCXZhciBwcmV2VGV4dCA9IGkxOG5UZXh0LnByZXYsCgkJCW5leHRUZXh0ID0gaTE4blRleHQubmV4dCwKCQkJc3BhY2VUZXh0ID0gaTE4blRleHQuc3BhY2UsCgkJCWV4Y2x1ZGVQbGF5ID0gc2V0dGluZ3MuZXhjbHVkZVBsYXksCgkJCWlzUGxheWluZyA9ICFleGNsdWRlUGxheSAmJiBzZXR0aW5ncy5wbGF5aW5nLAoJCQlzdGF0ZSA9IGlzUGxheWluZyA/IGkxOG5UZXh0LnBhdXNlIDogaTE4blRleHQucGxheSwKCQkJaGlkZGVuID0gaXNQbGF5aW5nID8gaTE4blRleHQucm90U3RvcCA6IGkxOG5UZXh0LnJvdFN0YXJ0LAoJCQlnbHlwaGljb25TdGFydCA9ICI8c3BhbiBjbGFzcz0nZ2x5cGhpY29uIGdseXBoaWNvbi0iLAoJCQl3YkludlN0YXJ0ID0gIjxzcGFuIGNsYXNzPSd3Yi1pbnYnPiIsCgkJCXRhYnNUb2dnbGVTdGFydCA9ICI8bGkgY2xhc3M9J2NvbnRyb2wgIiwKCQkJYnRuTWlkZGxlID0gIicgaHJlZj0namF2YXNjcmlwdDo7JyByb2xlPSdidXR0b24nIHRpdGxlPSciLAoJCQlidG5FbmQgPSAiPC9zcGFuPjwvYT48L2xpPiAiLAoJCQlpY29uU3RhdGUgPSBnbHlwaGljb25TdGFydCArICggaXNQbGF5aW5nID8gInBhdXNlIiA6ICJwbGF5IiApICsgIic+PC9zcGFuPiIsCgkJCSR0YWJzID0gJHRhYmxpc3QuZmluZCggIltyb2xlPXRhYl0iICksCgkJCWN1cnJlbnRJbmRleCA9ICR0YWJzLmluZGV4KCAkdGFicy5maWx0ZXIoICJbYXJpYS1zZWxlY3RlZD10cnVlXSIgKSApICsgMSwKCQkJaTE4blRhYkNvdW50ID0gaTE4blRleHQudGFiQ291bnQsCgkJCWZpcnN0UmVwbGFjZUluZGV4ID0gaTE4blRhYkNvdW50LmluZGV4T2YoICIlIiApLAoJCQlsYXN0UmVwbGFjZUluZGV4ID0gaTE4blRhYkNvdW50Lmxhc3RJbmRleE9mKCAiJSIgKSArIDEsCgkJCXByZXZDb250cm9sID0gdGFic1RvZ2dsZVN0YXJ0ICsgInBydic+PGEgY2xhc3M9J3BydiIgKyBidG5NaWRkbGUgKwoJCQkJcHJldlRleHQgKyAiJz4iICsgZ2x5cGhpY29uU3RhcnQgKyAiY2hldnJvbi1sZWZ0Jz48L3NwYW4+IiArCgkJCQl3YkludlN0YXJ0ICsgcHJldlRleHQgKyBidG5FbmQsCgkJCXRhYkNvdW50ID0gdGFic1RvZ2dsZVN0YXJ0ICsgIiB0YWItY291bnQnIHRhYmluZGV4PScwJz48ZGl2PiIgKwoJCQkJaTE4blRhYkNvdW50LnN1YnN0cmluZyggMCwgZmlyc3RSZXBsYWNlSW5kZXggKSArCgkJCQkiPGRpdiBjbGFzcz0nY3Vyci1jb3VudCc+IiArCgkJCQlpMThuVGFiQ291bnQuc3Vic3RyaW5nKCBmaXJzdFJlcGxhY2VJbmRleCwgbGFzdFJlcGxhY2VJbmRleCApCgkJCQkJLnJlcGxhY2UoICIlY3VyciUiLCAiPHNwYW4gY2xhc3M9J2N1cnItaW5kZXgnPiIgKyBjdXJyZW50SW5kZXggKyAiPC9zcGFuPiIgKQoJCQkJCS5yZXBsYWNlKCAiJXRvdGFsJSIsICR0YWJzLmxlbmd0aCApICsKCQkJCSI8L2Rpdj4iICsgaTE4blRhYkNvdW50LnN1YnN0cmluZyggbGFzdFJlcGxhY2VJbmRleCApICsKCQkJCSI8L2Rpdj48L2xpPiIsCgkJCW5leHRDb250cm9sID0gdGFic1RvZ2dsZVN0YXJ0ICsgIm54dCc+PGEgY2xhc3M9J254dCIgKyBidG5NaWRkbGUgKwoJCQkJbmV4dFRleHQgKyAiJz4iICsgZ2x5cGhpY29uU3RhcnQgKyAiY2hldnJvbi1yaWdodCc+PC9zcGFuPiIgKwoJCQkJd2JJbnZTdGFydCArIG5leHRUZXh0ICsgYnRuRW5kLAoJCQlwbGF5Q29udHJvbCA9ICB0YWJzVG9nZ2xlU3RhcnQgKyAicGx5cGF1c2UnPjxhIGNsYXNzPSdwbHlwYXVzZSIgKwoJCQkJYnRuTWlkZGxlICsgc3RhdGUgKyAiJz4iICsgaWNvblN0YXRlICsgIiA8c3Bhbj4iICsgc3RhdGUgKwoJCQkJIjwvc3Bhbj4iICsgd2JJbnZTdGFydCArIHNwYWNlVGV4dCArIGkxOG5UZXh0Lmh5cGhlbiArIHNwYWNlVGV4dCArCgkJCQloaWRkZW4gKyBidG5FbmQ7CgoJCSR0YWJsaXN0LnByZXBlbmQoIHByZXZDb250cm9sICsgdGFiQ291bnQgKyBuZXh0Q29udHJvbCApOwoJCWlmICggIWV4Y2x1ZGVQbGF5ICkgewoJCQkkdGFibGlzdC5hcHBlbmQoIHBsYXlDb250cm9sICk7CgkJfQoKCQlyZXR1cm4gaXNQbGF5aW5nOwoJfSwKCgkvKioKCSAqIEBtZXRob2QgZHJpenpsZUFyaWEKCSAqIEBwYXJhbSB7alF1ZXJ5IERPTSBlbGVtZW50fSAkcGFuZWxzIFRhYnBhbmVsIGdyb3VwaW5ncwoJICogQHBhcmFtIHtqUXVlcnkgRE9NIGVsZW1lbnR9ICR0YWJsaXN0IFBvaW50ZXJzIHRvIHRoZSBncm91cGluZ3MKCSAqLwoJZHJpenpsZUFyaWEgPSBmdW5jdGlvbiggJHBhbmVscywgJHRhYkxpc3QgKSB7CgoJCS8vIExldCdzIHByb2Nlc3MgdGhlIGVsZW1lbnRzIGZvciBhcmlhCgkJdmFyIHBhbmVscyA9ICRwYW5lbHMuZ2V0KCksCgkJCXRhYkNvdW50ZXIgPSBwYW5lbHMubGVuZ3RoIC0gMSwKCQkJbGlzdEl0ZW1zID0gJHRhYkxpc3QuY2hpbGRyZW4oKS5nZXQoKSwKCQkJbGlzdENvdW50ZXIgPSBsaXN0SXRlbXMubGVuZ3RoIC0gMSwKCQkJaXNEZXRhaWxzID0gJHBhbmVsc1sgMCBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJkZXRhaWxzIiwKCQkJaXNBY3RpdmUsIGl0ZW0sIGxpbms7CgoJCSRwYW5lbHMuYXR0ciggInRhYmluZGV4IiwgIi0xIiApOwoKCQlmb3IgKCA7IHRhYkNvdW50ZXIgIT09IC0xOyB0YWJDb3VudGVyIC09IDEgKSB7CgkJCWl0ZW0gPSBwYW5lbHNbIHRhYkNvdW50ZXIgXTsKCQkJaXNBY3RpdmUgPSBpdGVtLmNsYXNzTmFtZS5pbmRleE9mKCAiaW4iICkgIT09IC0xOwoKCQkJaWYgKCAhaXNEZXRhaWxzIHx8ICFpc1NtYWxsVmlldyApIHsKCQkJCWl0ZW0uc2V0QXR0cmlidXRlKCAiYXJpYS1oaWRkZW4iLCBpc0FjdGl2ZSA/ICJmYWxzZSIgOiAidHJ1ZSIgKTsKCQkJCWl0ZW0uc2V0QXR0cmlidXRlKCAiYXJpYS1leHBhbmRlZCIsIGlzQWN0aXZlID8gInRydWUiIDogImZhbHNlIiApOwoJCQl9CgkJCWl0ZW0uc2V0QXR0cmlidXRlKCAiYXJpYS1sYWJlbGxlZGJ5IiwgaXRlbS5pZCArICItbG5rIiApOwoJCX0KCgkJZm9yICggOyBsaXN0Q291bnRlciAhPT0gLTE7IGxpc3RDb3VudGVyIC09IDEgKSB7CgkJCWl0ZW0gPSBsaXN0SXRlbXNbIGxpc3RDb3VudGVyIF07CgkJCWl0ZW0uc2V0QXR0cmlidXRlKCAicm9sZSIsICJwcmVzZW50YXRpb24iICk7CgkJCWlzQWN0aXZlID0gaXRlbS5jbGFzc05hbWUuaW5kZXhPZiggImFjdGl2ZSIgKSAhPT0gLTE7CgoJCQlsaW5rID0gaXRlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSggImEiIClbIDAgXTsKCQkJbGluay50YWJJbmRleCA9IGlzQWN0aXZlID8gIjAiIDogIi0xIjsKCQkJbGluay5zZXRBdHRyaWJ1dGUoICJyb2xlIiwgInRhYiIgKTsKCQkJbGluay5zZXRBdHRyaWJ1dGUoICJhcmlhLXNlbGVjdGVkIiwgaXNBY3RpdmUgPyAidHJ1ZSIgOiAiZmFsc2UiICk7CgkJCWxpbmsuc2V0QXR0cmlidXRlKCAiYXJpYS1jb250cm9scyIsIGxpbmsuZ2V0QXR0cmlidXRlKCAiaHJlZiIgKS5zdWJzdHJpbmcoIDEgKSApOwoJCX0KCQkkdGFiTGlzdC5hdHRyKCAiYXJpYS1saXZlIiwgIm9mZiIgKTsKCX0sCgoJdXBkYXRlTm9kZXMgPSBmdW5jdGlvbiggJHBhbmVscywgJGNvbnRyb2xzLCAkbmV4dCwgJGNvbnRyb2wgKSB7CgkJdmFyICR0YWJzID0gJGNvbnRyb2xzLmZpbmQoICJbcm9sZT10YWJdIiApLAoJCQluZXdJbmRleCA9ICR0YWJzLmluZGV4KCAkY29udHJvbCApICsgMSwKCQkJJGN1cnJQYW5lbCA9ICRwYW5lbHMuZmlsdGVyKCAiLmluIiApLAoJCQkkY29udGFpbmVyID0gJG5leHQuY2xvc2VzdCggc2VsZWN0b3IgKSwKCQkJbVBsYXllcnMgPSAkY3VyclBhbmVsLmZpbmQoICIud2ItbWx0bWQtaW5pdGVkIiApLmdldCgpLAoJCQltUGxheWVyc0xlbiA9IG1QbGF5ZXJzLmxlbmd0aCwKCQkJbVBsYXllciwgaSwgaiwgbGFzdDsKCgkJLy8gSGFuZGxlIHRoZSBkaXJlY3Rpb24gb2YgdGhlIHNsaWRlIHRyYW5zaXRpb25zCgkJaWYgKCAkY3VyclBhbmVsWyAwIF0uY2xhc3NOYW1lLmluZGV4T2YoICJzbGlkZSIgKSAhPT0gLTEgKSB7CgkJCWkgPSAkcGFuZWxzLmluZGV4KCAkY3VyclBhbmVsICk7CgkJCWogPSAkcGFuZWxzLmluZGV4KCAkbmV4dCApOwoJCQlsYXN0ID0gJHBhbmVscy5sZW5ndGggLSAxOwoKCQkJJHBhbmVscy50b2dnbGVDbGFzcygKCQkJCSJyZXZlcnNlIiwKCQkJCSggaSA+IGogJiYgKCBpICE9PSBsYXN0IHx8IGogIT09IDAgKSApIHx8ICggaSA9PT0gMCAmJiBqID09PSBsYXN0ICkKCQkJKTsKCQl9CgoJCSRjdXJyUGFuZWwKCQkJLnJlbW92ZUNsYXNzKCAiaW4iICkKCQkJLmFkZENsYXNzKCAib3V0IiApCgkJCS5hdHRyKHsKCQkJCSJhcmlhLWhpZGRlbiI6ICJ0cnVlIiwKCQkJCSJhcmlhLWV4cGFuZGVkIjogImZhbHNlIgoJCQl9KTsKCgkJLy8gUGF1c2UgYWxsIG11bHRpbWVkaWEgcGxheWVycyBpbiB0aGUgY3VycmVudCBwYW5lbAoJCWZvciAoIGkgPSAwOyBpICE9PSBtUGxheWVyc0xlbjsgaSArPSAxICkgewoJCQltUGxheWVyID0gbVBsYXllcnNbIGkgXTsKCQkJaWYgKCBtUGxheWVyLnBsYXllciApIHsKCQkJCW1QbGF5ZXIucGxheWVyKCAicGF1c2UiICk7CgkJCX0KCQl9CgoJCSRuZXh0CgkJCS5yZW1vdmVDbGFzcyggIm91dCIgKQoJCQkuYWRkQ2xhc3MoICJpbiIgKQoJCQkuYXR0cih7CgkJCQkiYXJpYS1oaWRkZW4iOiAiZmFsc2UiLAoJCQkJImFyaWEtZXhwYW5kZWQiOiAidHJ1ZSIKCQkJfSk7CgoJCSRjb250cm9scwoJCQkuZmluZCggIi5hY3RpdmUiICkKCQkJCS5yZW1vdmVDbGFzcyggImFjdGl2ZSIgKQoJCQkJLmNoaWxkcmVuKCAiYSIgKQoJCQkJCS5hdHRyKHsKCQkJCQkJImFyaWEtc2VsZWN0ZWQiOiAiZmFsc2UiLAoJCQkJCQl0YWJpbmRleDogIi0xIgoJCQkJCX0pOwoKCQkvLyBVcGRhdGUgdGhlIEl0ZW0geCBvZiBuCgkJJGNvbnRyb2xzCgkJCS5maW5kKCAiLmN1cnItaW5kZXgiICkKCQkJCS5odG1sKCBuZXdJbmRleCApOwoKCQkkY29udHJvbAoJCQkuYXR0cih7CgkJCQkiYXJpYS1zZWxlY3RlZCI6ICJ0cnVlIiwKCQkJCXRhYmluZGV4OiAiMCIKCQkJfSkKCQkJLnBhcmVudCgpCgkJCQkuYWRkQ2xhc3MoICJhY3RpdmUiICk7CgoJCS8vIFVwZGF0ZSBzZXNzaW9uU3RvcmFnZSB3aXRoIHRoZSBjdXJyZW50IGFjdGl2ZSBwYW5lbAoJCXRyeSB7CgkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0oCgkJCQkkY29udGFpbmVyLmF0dHIoICJpZCIgKSArIGFjdGl2ZVBhbmVsLAoJCQkJJG5leHQuYXR0ciggImlkIiApCgkJCSk7CgkJfSBjYXRjaCAoIGVycm9yICkgewoJCX0KCgkJLy8gSWRlbnRpZnkgdGhhdCB0aGUgdGFiYmVkIGludGVyZmFjZS9jYXJvdXNlbCB3YXMgdXBkYXRlZAoJCSRjb250YWluZXIudHJpZ2dlciggdXBkYXRlZEV2ZW50LCBbICRuZXh0IF0gKTsKCX0sCgoJLyoqCgkgKiBAbWV0aG9kIG9uUGljawoJICogQHBhcmFtIHtqUXVlcnkgRE9NIGVsZW1lbnR9ICRzbGRyIFRoZSBwbHVnaW4gZWxlbWVudAoJICogQHBhcmFtIHtqUXVlcnkgRE9NIGVsZW1lbnR9ICRlbG0gVGhlIHNlbGVjdGVkIGxpbmsgZnJvbSB0aGUgdGFibGlzdAoJICovCglvblBpY2sgPSBmdW5jdGlvbiggJHNsZHIsICRlbG0gKSB7CgkJdmFyIGRhdGEgPSAkc2xkci5kYXRhKCBjb21wb25lbnROYW1lICksCgkJCSRwYW5lbHMgPSBkYXRhLnBhbmVscywKCQkJJGNvbnRyb2xzID0gZGF0YS50YWJsaXN0LAoJCQkkbmV4dCA9ICRwYW5lbHMuZmlsdGVyKCAiIyIgKyAkZWxtLmF0dHIoICJhcmlhLWNvbnRyb2xzIiApICk7CgoJCXVwZGF0ZU5vZGVzKCAkcGFuZWxzLCAkY29udHJvbHMsICRuZXh0LCAkZWxtICk7Cgl9LAoKCS8qKgoJICogQG1ldGhvZCBvblNoaWZ0CgkgKiBAcGFyYW0gKGpRdWVyeSBldmVudH0gZXZlbnQgQ3VycmVudCBldmVudAoJICogQHBhcmFtIHtqUXVlcnkgRE9NIGVsZW1lbnR9ICRlbG0gVGhlIHBsdWdpbiBlbGVtZW50CgkgKi8KCW9uU2hpZnQgPSBmdW5jdGlvbiggZXZlbnQsICRlbG0gKSB7CgkJdmFyIGRhdGEgPSAkZWxtLmRhdGEoIGNvbXBvbmVudE5hbWUgKSwKCQkJJHBhbmVscyA9IGRhdGEucGFuZWxzLAoJCQkkY29udHJvbHMgPSBkYXRhLnRhYmxpc3QsCgkJCWxlbiA9ICRwYW5lbHMubGVuZ3RoLAoJCQljdXJyZW50ID0gJGVsbS5maW5kKCAiPiAudGFicGFuZWxzID4gLmluIiApLnByZXZBbGwoICJbcm9sZT10YWJwYW5lbF0iICkubGVuZ3RoLAoJCQlzaGlmdHRvID0gZXZlbnQuc2hpZnR0byA/IGV2ZW50LnNoaWZ0dG8gOiAxLAoJCQluZXh0ID0gY3VycmVudCA+IGxlbiA/IDAgOiBjdXJyZW50ICsgc2hpZnR0bywKCQkJJG5leHQgPSAkcGFuZWxzLmVxKCAoIG5leHQgPiBsZW4gLSAxICkgPyAwIDogKCBuZXh0IDwgMCApID8gbGVuIC0gMSA6IG5leHQgKTsKCgkJdXBkYXRlTm9kZXMoCgkJCSRwYW5lbHMsICRjb250cm9scywgJG5leHQsCgkJCSRjb250cm9scy5maW5kKCAiW2hyZWY9IyIgKyAkbmV4dC5hdHRyKCAiaWQiICkgKyAiXSIgKQoJCSk7Cgl9LAoKCS8qKgoJICogQG1ldGhvZCBvbkN5Y2xlCgkgKiBAcGFyYW0ge2pRdWVyeSBET00gZWxlbWVudH0gJGVsbSBUaGUgcGx1Z2luIGVsZW1lbnQKCSAqIEBwYXJhbSB7aW50ZWdlcn0gc2hpZnRvIFRoZSBpdGVtIHRvIHNoaWZ0IHRvCgkgKi8KCW9uQ3ljbGUgPSBmdW5jdGlvbiggJGVsbSwgc2hpZnRvICkgewoJCSRlbG0udHJpZ2dlcih7CgkJCXR5cGU6IHNoaWZ0RXZlbnQsCgkJCXNoaWZ0dG86IHNoaWZ0bwoJCX0pOwoJfSwKCgkvKioKCSAqIEBtZXRob2Qgb25IYXNoQ2hhbmdlCgkgKiBAcGFyYW0ge2pRdWVyeSBFdmVudH0gZXZlbnQgRXZlbnQgdGhhdCB0cmlnZ2VyZWQgdGhlIGZ1bmN0aW9uIGNhbGwKCSAqLwoJb25IYXNoQ2hhbmdlID0gZnVuY3Rpb24oIGV2ZW50ICkgewoJCWlmICggaW5pdGlhbGl6ZWQgKSB7CgkJCXZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2gsCgkJCQkkaGFzaFRhcmdldCA9ICQoIGhhc2ggKTsKCgkJCWlmICggJGhhc2hUYXJnZXQubGVuZ3RoICE9PSAwICkgewoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCWlmICggaXNTbWFsbFZpZXcgJiYgJGhhc2hUYXJnZXRbIDAgXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiZGV0YWlscyIgKSB7CgkJCQkJJGhhc2hUYXJnZXQKCQkJCQkJLmNoaWxkcmVuKCAic3VtbWFyeSIgKQoJCQkJCQkJLnRyaWdnZXIoICJjbGljayIgKTsKCQkJCX0gZWxzZSB7CgkJCQkJJGhhc2hUYXJnZXQKCQkJCQkJLnBhcmVudCgpCgkJCQkJCQkuZmluZCggIj4gdWwgW2hyZWYkPSciICsgaGFzaCArICInXSIgKQoJCQkJCQkJCS50cmlnZ2VyKCAiY2xpY2siICk7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCW9uUmVzaXplID0gZnVuY3Rpb24oKSB7CgkJdmFyICRlbG0sICRkZXRhaWxzLCAkdGFibGlzdCwgJG9wZW5EZXRhaWxzLAoJCQkkbm9uT3BlbkRldGFpbHMsICRhY3RpdmUsICRzdW1tYXJ5OwoKCQlpZiAoIGluaXRpYWxpemVkICkgewoJCQlpc1NtYWxsVmlldyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc05hbWUuaW5kZXhPZiggc21hbGxWaWV3UGF0dGVybiApICE9PSAtMTsKCQkJJGVsbSA9ICQoIHNlbGVjdG9yICk7CgkJCSRkZXRhaWxzID0gJGVsbS5maW5kKCAiPiAudGFicGFuZWxzID4gZGV0YWlscyIgKTsKCQkJaWYgKCAkZGV0YWlscy5sZW5ndGggIT09IDAgKSB7CgkJCQlpZiAoIGlzU21hbGxWaWV3ICE9PSBvbGRJc1NtYWxsVmlldyApIHsKCQkJCQkkc3VtbWFyeSA9ICRkZXRhaWxzLmNoaWxkcmVuKCAic3VtbWFyeSIgKTsKCQkJCQkkdGFibGlzdCA9ICRlbG0uY2hpbGRyZW4oICJ1bCIgKTsKCgkJCQkJLy8gRGlzYWJsZSBlcXVhbCBoZWlnaHRzIGZvciBzbWFsbCB2aWV3CgkJCQkJaWYgKCAkZWxtLmF0dHIoICJjbGFzcyIgKS5pbmRleE9mKCBlcXVhbEhlaWdodENsYXNzICkgIT09IC0xICkgewoJCQkJCQkkZWxtLnRvZ2dsZUNsYXNzKCBlcXVhbEhlaWdodENsYXNzICsgIiAiICsgZXF1YWxIZWlnaHRPZmZDbGFzcyApOwoJCQkJCX0KCgkJCQkJaWYgKCBpc1NtYWxsVmlldyApIHsKCgkJCQkJCS8vIFN3aXRjaCB0byBzbWFsbCB2aWV3CgkJCQkJCSRhY3RpdmUgPSAkdGFibGlzdC5maW5kKCAiLmFjdGl2ZSBhIiApOwoJCQkJCQkkZGV0YWlscwoJCQkJCQkJLnJlbW92ZUF0dHIoICJyb2xlIGFyaWEtZXhwYW5kZWQgYXJpYS1oaWRkZW4iICkKCQkJCQkJCS5yZW1vdmVDbGFzcyggImZhZGUgb3V0IGluIiApOwoJCQkJCQkkb3BlbkRldGFpbHMgPSAkZGV0YWlscwoJCQkJCQkJCQkJCS5maWx0ZXIoICIjIiArICRhY3RpdmUuYXR0ciggImhyZWYiICkuc3Vic3RyaW5nKCAxICkgKQoJCQkJCQkJCQkJCQkuYXR0ciggIm9wZW4iLCAib3BlbiIgKQoJCQkJCQkJCQkJCQkuYWRkQ2xhc3MoICJvcGVuIiApOwoJCQkJCQkkbm9uT3BlbkRldGFpbHMgPSAkZGV0YWlscy5ub3QoICRvcGVuRGV0YWlscyApCgkJCQkJCQkJCQkJCQkucmVtb3ZlQXR0ciggIm9wZW4iICkKCQkJCQkJCQkJCQkJCS5yZW1vdmVDbGFzcyggIm9wZW4iICk7CgkJCQkJfSBlbHNlIGlmICggb2xkSXNTbWFsbFZpZXcgKSB7CgoJCQkJCQkvLyBTd2l0Y2ggdG8gbGFyZ2UgdmlldwoJCQkJCQkkb3BlbkRldGFpbHMgPSAkZGV0YWlscy5maWx0ZXIoICJbb3Blbl0iICk7CgkJCQkJCSRvcGVuRGV0YWlscyA9ICggJG9wZW5EZXRhaWxzLmxlbmd0aCA9PT0gMCA/ICRkZXRhaWxzIDogJG9wZW5EZXRhaWxzICkuZXEoIDAgKTsKCgkJCQkJCSRkZXRhaWxzCgkJCQkJCQkuYXR0cih7CgkJCQkJCQkJcm9sZTogInRhYnBhbmVsIiwKCQkJCQkJCQlvcGVuOiAib3BlbiIKCQkJCQkJCX0pCgkJCQkJCQkubm90KCAkb3BlbkRldGFpbHMgKQoJCQkJCQkJCS5hZGRDbGFzcyggImZhZGUgb3V0IiApCgkJCQkJCQkJLmF0dHIoewoJCQkJCQkJCQkiYXJpYS1oaWRkZW4iOiAidHJ1ZSIsCgkJCQkJCQkJCSJhcmlhLWV4cGFuZGVkIjogImZhbHNlIgoJCQkJCQkJCX0pOwoKCQkJCQkJJG9wZW5EZXRhaWxzCgkJCQkJCQkuYWRkQ2xhc3MoICJmYWRlIGluIiApCgkJCQkJCQkuYXR0cih7CgkJCQkJCQkJCSJhcmlhLWhpZGRlbiI6ICJmYWxzZSIsCgkJCQkJCQkJCSJhcmlhLWV4cGFuZGVkIjogInRydWUiCgkJCQkJCQkJfSkKCQkJCQkJCS5wYXJlbnQoKQoJCQkJCQkJCS5maW5kKCAiPiB1bCBbaHJlZiQ9JyIgKyAkb3BlbkRldGFpbHMuYXR0ciggImlkIiApICsgIiddIiApCgkJCQkJCQkJCS50cmlnZ2VyKCAiY2xpY2siICk7CgkJCQkJfQoKCQkJCQkkc3VtbWFyeS5hdHRyKCAiYXJpYS1oaWRkZW4iLCAhaXNTbWFsbFZpZXcgKTsKCQkJCQkkdGFibGlzdC5hdHRyKCAiYXJpYS1oaWRkZW4iLCBpc1NtYWxsVmlldyApOwoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gRW5hYmxlIGVxdWFsIGhlaWdodHMgZm9yIGxhcmdlIHZpZXcKCQkJCQlpZiAoICRlbG0uYXR0ciggImNsYXNzIiApLmluZGV4T2YoIGVxdWFsSGVpZ2h0Q2xhc3MgKSAhPT0gLTEgKSB7CgkJCQkJCSRlbG0udG9nZ2xlQ2xhc3MoIGVxdWFsSGVpZ2h0Q2xhc3MgKyAiICIgKyBlcXVhbEhlaWdodE9mZkNsYXNzICk7CgkJCQkJfQoJCQkJfQoJCQkJb2xkSXNTbWFsbFZpZXcgPSBpc1NtYWxsVmlldzsKCQkJfQoJCX0KCX07CgogLy8gQmluZCB0aGUgaW5pdCBldmVudCBvZiB0aGUgcGx1Z2luCiAkZG9jdW1lbnQub24oICJ0aW1lcnBva2Uud2IgIiArIGluaXRFdmVudCArICIgIiArIHNoaWZ0RXZlbnQsIHNlbGVjdG9yLCBmdW5jdGlvbiggZXZlbnQgKSB7Cgl2YXIgZXZlbnRUYXJnZXQgPSBldmVudC50YXJnZXQsCgkJZXZlbnRDdXJyZW50VGFyZ2V0ID0gZXZlbnQuY3VycmVudFRhcmdldCwKCQkkZWxtOwoKCQkvLyBGaWx0ZXIgb3V0IGFueSBldmVudHMgdHJpZ2dlcmVkIGJ5IGRlc2NlbmRhbnRzCgkJaWYgKCBldmVudEN1cnJlbnRUYXJnZXQgPT09IGV2ZW50VGFyZ2V0ICkgewoJCQlzd2l0Y2ggKCBldmVudC50eXBlICkgewoJCQljYXNlICJ0aW1lcnBva2UiOgoJCQkJJGVsbSA9ICQoIGV2ZW50VGFyZ2V0ICk7CgkJCQlpZiAoICEkZWxtLmhhc0NsYXNzKCBjb21wb25lbnROYW1lICsgIi1pbml0ZWQiICkgKSB7CgkJCQkJaW5pdCggZXZlbnQgKTsKCQkJCX0gZWxzZSBpZiAoICRlbG0uaGFzQ2xhc3MoICJwbGF5aW5nIiApICkgewoJCQkJCW9uVGltZXJQb2tlKCAkZWxtICk7CgkJCQl9CgkJCQlicmVhazsKCgkJCS8qCgkJCSAqIEluaXQKCQkJICovCgkJCWNhc2UgIndiLWluaXQiOgoJCQkJaW5pdCggZXZlbnQgKTsKCQkJCWJyZWFrOwoKCQkJLyoKCQkJICogQ2hhbmdlIFNsaWRlcwoJCQkgKi8KCQkJY2FzZSAid2Itc2hpZnQiOgoJCQkJb25TaGlmdCggZXZlbnQsICQoIGV2ZW50VGFyZ2V0ICkgKTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoKCS8qCgkgKiBTaW5jZSB3ZSBhcmUgd29ya2luZyB3aXRoIGV2ZW50cyB3ZSB3YW50IHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBiZWluZyBwYXNzaXZlIGFib3V0IG91ciBjb250cm9sLAoJICogc28gcmV0dXJuaW5nIHRydWUgYWxsb3dzIGZvciBldmVudHMgdG8gYWx3YXlzIGNvbnRpbnVlCgkgKi8KCXJldHVybiB0cnVlOwogfSk7CgogLyoKICAqIFRhYnMsIG5leHQsIHByZXZpb3VzIGFuZCBwbGF5L3BhdXNlCiAgKi8KICRkb2N1bWVudC5vbiggYWN0aXZhdGVFdmVudCwgY29udHJvbHMsIGZ1bmN0aW9uKCBldmVudCApIHsKCXZhciB3aGljaCA9IGV2ZW50LndoaWNoLAoJCWVsbSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQsCgkJY2xhc3NOYW1lID0gZWxtLmNsYXNzTmFtZSwKCQlyb3RTdG9wVGV4dCA9IGkxOG5UZXh0LnJvdFN0b3AsCgkJcGxheVRleHQgPSBpMThuVGV4dC5wbGF5LAoJCSRlbG0sIHRleHQsIGludiwgJHNsZHIsIHNsZHJJZCwgJHBseXBhdXNlLCBkYXRhLCBpc1BsYXlpbmcsIGlzUGxheVBhdXNlOwoKCS8vIElnbm9yZSBtaWRkbGUgYW5kIHJpZ2h0IG1vdXNlIGJ1dHRvbnMgYW5kIG1vZGlmaWVkIGtleXMKCWlmICggISggZXZlbnQuY3RybEtleSB8fCBldmVudC5hbHRLZXkgfHwgZXZlbnQubWV0YUtleSApICYmCgkJCSggIXdoaWNoIHx8IHdoaWNoID09PSAxIHx8IHdoaWNoID09PSAxMyB8fCB3aGljaCA9PT0gMzIgfHwKCQkJKCB3aGljaCA+IDM2ICYmIHdoaWNoIDwgNDEgKSApICkgewoKCQkvLyBTdG9wIHByb3BhZ2F0aW9uIG9mIHRoZSBhY3RpdmF0ZSBldmVudAoJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJaWYgKCBldmVudC5zdG9wUHJvcGFnYXRpb24gKSB7CgkJCWV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwoJCX0gZWxzZSB7CgkJCWV2ZW50LmNhbmNlbEJ1YmJsZSA9IHRydWU7CgkJfQoKCQkkZWxtID0gJCggZWxtICk7CgkJJHNsZHIgPSAkZWxtLmNsb3Nlc3QoIHNlbGVjdG9yICk7CgkJc2xkcklkID0gJHNsZHJbIDAgXS5pZDsKCQlpc1BsYXlpbmcgPSAkc2xkci5oYXNDbGFzcyggInBsYXlpbmciICksCgkJaXNQbGF5UGF1c2UgPSBjbGFzc05hbWUuaW5kZXhPZiggInBseXBhdXNlIiApICE9PSAtMTsKCgkJLy8gUmVzZXQgY3RpbWUgdG8gMAoJCWRhdGEgPSAkc2xkci5kYXRhKCBjb21wb25lbnROYW1lICk7CgkJZGF0YS5jdGltZSA9IDA7CgkJJHNsZHIuZGF0YSggY29tcG9uZW50TmFtZSwgZGF0YSApOwoKCQkvLyBTdG9wIHRoZSBzbGlkZXIgZnJvbSBwbGF5aW5nIHVubGVzcyBpdCBpcyBhbHJlYWR5IHN0b3BwZWQKCQkvLyBhbmQgdGhlIHBsYXkgYnV0dG9uIGlzIGFjdGl2YXRlZAoJCWlmICggaXNQbGF5aW5nIHx8ICggd2hpY2ggPCAzNyAmJiBpc1BsYXlQYXVzZSApICkgewoJCQlpZiAoIGlzUGxheWluZyApIHsKCQkJCXdiLnJlbW92ZSggIiMiICsgc2xkcklkICsgc2VsZWN0b3IgKTsKCQkJfSBlbHNlIHsKCQkJCXdiLmFkZCggIiMiICsgc2xkcklkICsgc2VsZWN0b3IgKTsKCQkJfQoKCQkJJHBseXBhdXNlID0gJHNsZHIuZmluZCggImEucGx5cGF1c2UiICk7CgkJCSRwbHlwYXVzZQoJCQkJLmZpbmQoICIuZ2x5cGhpY29uIiApCgkJCQkJLnRvZ2dsZUNsYXNzKCAiZ2x5cGhpY29uLXBsYXkgZ2x5cGhpY29uLXBhdXNlIiApOwoKCQkJJHNsZHIudG9nZ2xlQ2xhc3MoICJwbGF5aW5nIiApOwoJCQlpc1BsYXlpbmcgPSAhaXNQbGF5aW5nOwoKCQkJdGV4dCA9ICRwbHlwYXVzZVsgMCBdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAic3BhbiIgKVsgMSBdOwoJCQl0ZXh0LmlubmVySFRNTCA9IHRleHQuaW5uZXJIVE1MID09PSBwbGF5VGV4dCA/CgkJCQlpMThuVGV4dC5wYXVzZSA6CgkJCQlwbGF5VGV4dDsKCgkJCWludiA9ICRwbHlwYXVzZS5maW5kKCAiLndiLWludiIgKVsgMCBdOwoJCQlpbnYuaW5uZXJIVE1MID0gaW52LmlubmVySFRNTCA9PT0gcm90U3RvcFRleHQgPwoJCQkJaTE4blRleHQucm90U3RhcnQgOgoJCQkJcm90U3RvcFRleHQ7CgkJfQoKCQlpZiAoIHdoaWNoID4gMzYgKSB7CgkJCW9uQ3ljbGUoICRzbGRyLCB3aGljaCA8IDM5ID8gLTEgOiAxICk7CgkJCSRzbGRyLmZpbmQoICI+IFtyb2xlPXRhYmxpc3RdIC5hY3RpdmUgYSIgKS50cmlnZ2VyKCBzZXRGb2N1c0V2ZW50ICk7CgkJfSBlbHNlIHsKCQkJaWYgKCBlbG0uZ2V0QXR0cmlidXRlKCAicm9sZSIgKSA9PT0gInRhYiIgKSB7CgkJCQlvblBpY2soICRzbGRyLCAkZWxtICk7CgkJCQlpZiAoIHdoaWNoID4gMSApIHsKCQkJCQkkc2xkci5maW5kKCBlbG0uZ2V0QXR0cmlidXRlKCAiaHJlZiIgKSApCgkJCQkJCS50cmlnZ2VyKCBzZXRGb2N1c0V2ZW50ICk7CgkJCQl9CgkJCX0gZWxzZSBpZiAoICFpc1BsYXlpbmcgJiYgIWlzUGxheVBhdXNlICkgewoJCQkJb25DeWNsZSggJHNsZHIsIGNsYXNzTmFtZS5pbmRleE9mKCAicHJ2IiApICE9PSAtMSA/IC0xIDogMSApOwoJCQl9CgkJfQoJfQoKCS8qCgkgKiBTaW5jZSB3ZSBhcmUgd29ya2luZyB3aXRoIGV2ZW50cyB3ZSB3YW50IHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBiZWluZyBwYXNzaXZlIGFib3V0IG91ciBjb250cm9sLAoJICogc28gcmV0dXJuaW5nIHRydWUgYWxsb3dzIGZvciBldmVudHMgdG8gYWx3YXlzIGNvbnRpbnVlCgkgKi8KCXJldHVybiB0cnVlOwp9KTsKCi8vIFBhdXNlIG9uIGVzY2FwZQokZG9jdW1lbnQub24oICJrZXlkb3duIiwgc2VsZWN0b3IgKyAiLCAiICsgc2VsZWN0b3IgKyAiIFtyb2xlPXRhYnBhbmVsXSIsIGZ1bmN0aW9uKCBldmVudCApIHsKCgkvLyBFc2NhcGUga2V5CglpZiAoIGV2ZW50LndoaWNoID09PSAyNyApIHsKCQl2YXIgJHNsZHIgPSAkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCBzZWxlY3RvciApOwoKCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQlpZiAoICRzbGRyLmhhc0NsYXNzKCAicGxheWluZyIgKSApIHsKCQkJJHNsZHIuZmluZCggIi5wbHlwYXVzZSIgKS50cmlnZ2VyKCAiY2xpY2siICk7CgkJfQoJfQp9KTsKCiRkb2N1bWVudC5vbiggImNsaWNrIGtleWRvd24iLCBzZWxlY3RvciArICIgW3JvbGU9dGFicGFuZWxdIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJdmFyIGN1cnJlbnRUYXJnZXQgPSBldmVudC5jdXJyZW50VGFyZ2V0LAoJCXdoaWNoID0gZXZlbnQud2hpY2gsCgkJJGNvbnRhaW5lcjsKCgkvLyBTdG9wIHByb3BhZ2F0aW9uIG9mIHRoZSBjbGljay9rZXlkb3duIGV2ZW50CglpZiAoIGV2ZW50LnN0b3BQcm9wYWdhdGlvbiApIHsKCQlldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCX0gZWxzZSB7CgkJZXZlbnQuY2FuY2VsQnViYmxlID0gdHJ1ZTsKCX0KCglpZiAoIGV2ZW50LnRhcmdldCA9PT0gImNsaWNrIiApIHsKCgkJLy8gSWdub3JlIG1pZGRsZSBhbmQgcmlnaHQgbW91c2UgYnV0dG9ucwoJCWlmICggIXdoaWNoIHx8IHdoaWNoID09PSAxICkgewoJCQkkY29udGFpbmVyID0gJCggZXZlbnQuY3VycmVudFRhcmdldCApLmNsb3Nlc3QoIHNlbGVjdG9yICk7CgoJCQkvLyBTdG9wIHRoZSBjYXJvdXNlbCBpZiB0aGVyZSBpcyBhIGNsaWNrIHdpdGhpbiBhIHBhbmVsCgkJCWlmICggJGNvbnRhaW5lci5oYXNDbGFzcyggInBsYXlpbmciICkgKSB7CgkJCQkkY29udGFpbmVyLmZpbmQoICIucGx5cGF1c2UiICkudHJpZ2dlciggImNsaWNrIiApOwoJCQl9CgkJfQoJfSBlbHNlIHsKCgkJLy8gQ3RybCArIFVwIGFycm93CgkJaWYgKCBldmVudC5jdHJsS2V5ICYmIGV2ZW50LndoaWNoID09PSAzOCApIHsKCgkJCS8vIE1vdmUgZm9jdXMgdG8gdGhlIHN1bW1hcnkgZWxlbWVudAoJCQkkKCBjdXJyZW50VGFyZ2V0ICkKCQkJCS5jbG9zZXN0KCBzZWxlY3RvciApCgkJCQkJLmZpbmQoICJbaHJlZiQ9JyMiICsgY3VycmVudFRhcmdldC5pZCArICInXSIgKQoJCQkJCQkudHJpZ2dlciggInNldGZvY3VzLndiIiApOwoJCX0KCX0KfSk7CgovLyBIYW5kbGluZyBmb3IgbGlua3MgdG8gdGFicyBmcm9tIHdpdGhpbiBhIHBhbmVsCiRkb2N1bWVudC5vbiggImNsaWNrIiwgc2VsZWN0b3IgKyAiIFtyb2xlPXRhYnBhbmVsXSBhIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJdmFyIGN1cnJlbnRUYXJnZXQgPSBldmVudC5jdXJyZW50VGFyZ2V0LAoJCWhyZWYgPSBjdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSggImhyZWYiICksCgkJd2hpY2ggPSBldmVudC53aGljaCwKCQkkY29udGFpbmVyLCAkcGFuZWwsICRzdW1tYXJ5OwoKCS8vIElnbm9yZSBtaWRkbGUgYW5kIHJpZ2h0IG1vdXNlIGJ1dHRvbnMKCWlmICggKCAhd2hpY2ggfHwgd2hpY2ggPT09IDEgKSAmJiBocmVmLmNoYXJBdCggMCApID09PSAiIyIgKSB7CgkJJGNvbnRhaW5lciA9ICQoIGN1cnJlbnRUYXJnZXQgKS5jbG9zZXN0KCBzZWxlY3RvciApOwoJCSRwYW5lbCA9ICRjb250YWluZXIuZmluZCggaHJlZiArICJbcm9sZT10YWJwYW5lbF0iICk7CgkJaWYgKCAkcGFuZWwubGVuZ3RoICE9PSAwICkgewoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkkc3VtbWFyeSA9ICRwYW5lbC5jaGlsZHJlbiggInN1bW1hcnkiICk7CgkJCWlmICggJHN1bW1hcnkubGVuZ3RoICE9PSAwICYmICRzdW1tYXJ5LmF0dHIoICJhcmlhLWhpZGRlbiIgKSAhPT0gInRydWUiICkgewoJCQkJJHN1bW1hcnkudHJpZ2dlciggImNsaWNrIiApOwoJCQl9IGVsc2UgewoJCQkJJGNvbnRhaW5lci5maW5kKCBocmVmICsgIi1sbmsiICkudHJpZ2dlciggImNsaWNrIiApOwoJCQl9CgkJfQoJfQp9KTsKCi8vIFRoZXNlIGV2ZW50cyBvbmx5IGZpcmUgYXQgdGhlIGRvY3VtZW50IGxldmVsCiRkb2N1bWVudC5vbiggd2IucmVzaXplRXZlbnRzLCBvblJlc2l6ZSApOwoKLy8gVGhpcyBldmVudCBvbmx5IGZpcmVzIG9uIHRoZSB3aW5kb3cKJHdpbmRvdy5vbiggImhhc2hjaGFuZ2UiLCBvbkhhc2hDaGFuZ2UgKTsKCiRkb2N1bWVudC5vbiggYWN0aXZhdGVFdmVudCwgc2VsZWN0b3IgKyAiID4gLnRhYnBhbmVscyA+IGRldGFpbHMgPiBzdW1tYXJ5IiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJdmFyIHdoaWNoID0gZXZlbnQud2hpY2gsCgkJZGV0YWlscyA9IGV2ZW50LmN1cnJlbnRUYXJnZXQucGFyZW50Tm9kZSwKCQkkZGV0YWlsczsKCglpZiAoICEoIGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQuYWx0S2V5IHx8IGV2ZW50Lm1ldGFLZXkgKSAmJgoJCSggIXdoaWNoIHx8IHdoaWNoID09PSAxIHx8IHdoaWNoID09PSAxMyB8fCB3aGljaCA9PT0gMzIgKSApIHsKCgkJJGRldGFpbHMgPSAkKCBkZXRhaWxzICk7CgoJCS8vIFVwZGF0ZSBzZXNzaW9uU3RvcmFnZSB3aXRoIHRoZSBjdXJyZW50IGFjdGl2ZSBwYW5lbAoJCXRyeSB7CgkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0oCgkJCQkkZGV0YWlscy5jbG9zZXN0KCBzZWxlY3RvciApLmF0dHIoICJpZCIgKSArIGFjdGl2ZVBhbmVsLAoJCQkJZGV0YWlscy5pZAoJCQkpOwoJCX0gY2F0Y2ggKCBlcnJvciApIHsKCQl9CgoJCS8vIElkZW50aWZ5IHRoYXQgdGhlIHRhYmJlZCBpbnRlcmZhY2Ugd2FzIHVwZGF0ZWQKCQkkZGV0YWlscy5jbG9zZXN0KCBzZWxlY3RvciApLnRyaWdnZXIoIHVwZGF0ZWRFdmVudCwgWyAkZGV0YWlscyBdICk7Cgl9Cn0pOwoKLy8gQWRkIHRoZSB0aW1lciBwb2tlIHRvIGluaXRpYWxpemUgdGhlIHBsdWdpbgp3Yi5hZGQoIHNlbGVjdG9yICk7Cgp9KSggalF1ZXJ5LCB3aW5kb3csIHdiICk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 02:52:59 GMT",
                    "Content-Length": "23854",
                    "Date": "Sun, 09 Nov 2014 02:53:01 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}