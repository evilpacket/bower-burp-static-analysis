{
    "url": "http://localhost:9999/cowboy/jquery-bbq/jquery.ba-bbq.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.href</b> via the following statement:<ul><li>location.href = location.href.replace( /#.*/, '' ) + history_hash;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/cowboy/jquery-bbq/jquery.ba-bbq.js",
                "path": "/cowboy/jquery-bbq/jquery.ba-bbq.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9jb3dib3kvanF1ZXJ5LWJicS9qcXVlcnkuYmEtYmJxLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNTI2NTENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDU6NTI6MzIgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA1OjUyOjMxIEdNVA0KDQovKiEKICogalF1ZXJ5IEJCUTogQmFjayBCdXR0b24gJiBRdWVyeSBMaWJyYXJ5IC0gdjEuM3ByZSAtIDgvMjYvMjAxMAogKiBodHRwOi8vYmVuYWxtYW4uY29tL3Byb2plY3RzL2pxdWVyeS1iYnEtcGx1Z2luLwogKiAKICogQ29weXJpZ2h0IChjKSAyMDEwICJDb3dib3kiIEJlbiBBbG1hbgogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlcy4KICogaHR0cDovL2JlbmFsbWFuLmNvbS9hYm91dC9saWNlbnNlLwogKi8KCi8vIFNjcmlwdDogalF1ZXJ5IEJCUTogQmFjayBCdXR0b24gJiBRdWVyeSBMaWJyYXJ5Ci8vCi8vICpWZXJzaW9uOiAxLjNwcmUsIExhc3QgdXBkYXRlZDogOC8yNi8yMDEwKgovLyAKLy8gUHJvamVjdCBIb21lIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9wcm9qZWN0cy9qcXVlcnktYmJxLXBsdWdpbi8KLy8gR2l0SHViICAgICAgIC0gaHR0cDovL2dpdGh1Yi5jb20vY293Ym95L2pxdWVyeS1iYnEvCi8vIFNvdXJjZSAgICAgICAtIGh0dHA6Ly9naXRodWIuY29tL2Nvd2JveS9qcXVlcnktYmJxL3Jhdy9tYXN0ZXIvanF1ZXJ5LmJhLWJicS5qcwovLyAoTWluaWZpZWQpICAgLSBodHRwOi8vZ2l0aHViLmNvbS9jb3dib3kvanF1ZXJ5LWJicS9yYXcvbWFzdGVyL2pxdWVyeS5iYS1iYnEubWluLmpzICgyLjJrYiBnemlwcGVkKQovLyAKLy8gQWJvdXQ6IExpY2Vuc2UKLy8gCi8vIENvcHlyaWdodCAoYykgMjAxMCAiQ293Ym95IiBCZW4gQWxtYW4sCi8vIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBhbmQgR1BMIGxpY2Vuc2VzLgovLyBodHRwOi8vYmVuYWxtYW4uY29tL2Fib3V0L2xpY2Vuc2UvCi8vIAovLyBBYm91dDogRXhhbXBsZXMKLy8gCi8vIFRoZXNlIHdvcmtpbmcgZXhhbXBsZXMsIGNvbXBsZXRlIHdpdGggZnVsbHkgY29tbWVudGVkIGNvZGUsIGlsbHVzdHJhdGUgYSBmZXcKLy8gd2F5cyBpbiB3aGljaCB0aGlzIHBsdWdpbiBjYW4gYmUgdXNlZC4KLy8gCi8vIEJhc2ljIEFKQVggICAgIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1iYnEvZXhhbXBsZXMvZnJhZ21lbnQtYmFzaWMvCi8vIEFkdmFuY2VkIEFKQVggIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1iYnEvZXhhbXBsZXMvZnJhZ21lbnQtYWR2YW5jZWQvCi8vIGpRdWVyeSBVSSBUYWJzIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1iYnEvZXhhbXBsZXMvZnJhZ21lbnQtanF1ZXJ5LXVpLXRhYnMvCi8vIERlcGFyYW0gICAgICAgIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1iYnEvZXhhbXBsZXMvZGVwYXJhbS8KLy8gCi8vIEFib3V0OiBTdXBwb3J0IGFuZCBUZXN0aW5nCi8vIAovLyBJbmZvcm1hdGlvbiBhYm91dCB3aGF0IHZlcnNpb24gb3IgdmVyc2lvbnMgb2YgalF1ZXJ5IHRoaXMgcGx1Z2luIGhhcyBiZWVuCi8vIHRlc3RlZCB3aXRoLCB3aGF0IGJyb3dzZXJzIGl0IGhhcyBiZWVuIHRlc3RlZCBpbiwgYW5kIHdoZXJlIHRoZSB1bml0IHRlc3RzCi8vIHJlc2lkZSAoc28geW91IGNhbiB0ZXN0IGl0IHlvdXJzZWxmKS4KLy8gCi8vIGpRdWVyeSBWZXJzaW9ucyAtIDEuMi42LCAxLjMuMiwgMS40LjEsIDEuNC4yCi8vIEJyb3dzZXJzIFRlc3RlZCAtIEludGVybmV0IEV4cGxvcmVyIDYtOCwgRmlyZWZveCAyLTQsIENocm9tZSA1LTYsIFNhZmFyaSAzLjItNSwKLy8gICAgICAgICAgICAgICAgICAgT3BlcmEgOS42LTEwLjYwLCBpUGhvbmUgMy4xLCBBbmRyb2lkIDEuNi0yLjIsIEJsYWNrQmVycnkgNC42LTUuCi8vIFVuaXQgVGVzdHMgICAgICAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktYmJxL3VuaXQvCi8vIAovLyBBYm91dDogUmVsZWFzZSBIaXN0b3J5Ci8vIAovLyAxLjNwcmUgLSAoOC8yNi8yMDEwKSBJbnRlZ3JhdGVkIDxqUXVlcnkgaGFzaGNoYW5nZSBldmVudD4gdjEuMywgd2hpY2ggYWRkcwovLyAgICAgICAgIGRvY3VtZW50LnRpdGxlIGFuZCBkb2N1bWVudC5kb21haW4gc3VwcG9ydCBpbiBJRTYvNywgQmxhY2tCZXJyeQovLyAgICAgICAgIHN1cHBvcnQsIGJldHRlciBJZnJhbWUgaGlkaW5nIGZvciBhY2Nlc3NpYmlsaXR5IHJlYXNvbnMsIGFuZCB0aGUgbmV3Ci8vICAgICAgICAgPGpRdWVyeS5mbi5oYXNoY2hhbmdlPiAic2hvcnRjdXQiIG1ldGhvZC4gQWRkZWQgdGhlCi8vICAgICAgICAgPGpRdWVyeS5wYXJhbS5zb3J0ZWQ+IG1ldGhvZCB3aGljaCByZWR1Y2VzIHRoZSBwb3NzaWJpbGl0eSBvZgovLyAgICAgICAgIGV4dHJhbmVvdXMgaGFzaGNoYW5nZSBldmVudCB0cmlnZ2VyaW5nLiBBZGRlZCB0aGUKLy8gICAgICAgICA8alF1ZXJ5LnBhcmFtLmZyYWdtZW50LmFqYXhDcmF3bGFibGU+IG1ldGhvZCB3aGljaCBjYW4gYmUgdXNlZCB0bwovLyAgICAgICAgIGVuYWJsZSBHb29nbGUgIkFKQVggQ3Jhd2xhYmxlIG1vZGUuIgovLyAxLjIuMSAtICgyLzE3LzIwMTApIEFjdHVhbGx5IGZpeGVkIHRoZSBzdGFsZSB3aW5kb3cubG9jYXRpb24gU2FmYXJpIGJ1ZyBmcm9tCi8vICAgICAgICAgPGpRdWVyeSBoYXNoY2hhbmdlIGV2ZW50PiBpbiBCQlEsIHdoaWNoIHdhcyB0aGUgbWFpbiByZWFzb24gZm9yIHRoZQovLyAgICAgICAgIHByZXZpb3VzIHJlbGVhc2UhCi8vIDEuMiAgIC0gKDIvMTYvMjAxMCkgSW50ZWdyYXRlZCA8alF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQ+IHYxLjIsIHdoaWNoIGZpeGVzIGEKLy8gICAgICAgICBTYWZhcmkgYnVnLCB0aGUgZXZlbnQgY2FuIG5vdyBiZSBib3VuZCBiZWZvcmUgRE9NIHJlYWR5LCBhbmQgSUU2LzcKLy8gICAgICAgICBwYWdlIHNob3VsZCBubyBsb25nZXIgc2Nyb2xsIHdoZW4gdGhlIGV2ZW50IGlzIGZpcnN0IGJvdW5kLiBBbHNvCi8vICAgICAgICAgYWRkZWQgdGhlIDxqUXVlcnkucGFyYW0uZnJhZ21lbnQubm9Fc2NhcGU+IG1ldGhvZCwgYW5kIHJld29ya2VkIHRoZQovLyAgICAgICAgIDxoYXNoY2hhbmdlIGV2ZW50IChCQlEpPiBpbnRlcm5hbCAiYWRkIiBtZXRob2QgdG8gYmUgY29tcGF0aWJsZSB3aXRoCi8vICAgICAgICAgY2hhbmdlcyBtYWRlIHRvIHRoZSBqUXVlcnkgMS40LjIgc3BlY2lhbCBldmVudHMgQVBJLgovLyAxLjEuMSAtICgxLzIyLzIwMTApIEludGVncmF0ZWQgPGpRdWVyeSBoYXNoY2hhbmdlIGV2ZW50PiB2MS4xLCB3aGljaCBmaXhlcyBhbgovLyAgICAgICAgIG9ic2N1cmUgSUU4IEVtdWxhdGVJRTcgbWV0YSB0YWcgY29tcGF0aWJpbGl0eSBtb2RlIGJ1Zy4KLy8gMS4xICAgLSAoMS85LzIwMTApIEJyb2tlIG91dCB0aGUgalF1ZXJ5IEJCUSBldmVudC5zcGVjaWFsIDxoYXNoY2hhbmdlIGV2ZW50PgovLyAgICAgICAgIGZ1bmN0aW9uYWxpdHkgaW50byBhIHNlcGFyYXRlIHBsdWdpbiBmb3IgdXNlcnMgd2hvIHdhbnQganVzdCB0aGUKLy8gICAgICAgICBiYXNpYyBldmVudCAmIGJhY2sgYnV0dG9uIHN1cHBvcnQsIHdpdGhvdXQgYWxsIHRoZSBleHRyYSBhd2Vzb21lbmVzcwovLyAgICAgICAgIHRoYXQgQkJRIHByb3ZpZGVzLiBUaGlzIHBsdWdpbiB3aWxsIGJlIGluY2x1ZGVkIGFzIHBhcnQgb2YgalF1ZXJ5IEJCUSwKLy8gICAgICAgICBidXQgYWxzbyBiZSBhdmFpbGFibGUgc2VwYXJhdGVseS4gU2VlIDxqUXVlcnkgaGFzaGNoYW5nZSBldmVudD4KLy8gICAgICAgICBwbHVnaW4gZm9yIG1vcmUgaW5mb3JtYXRpb24uIEFsc28gYWRkZWQgdGhlIDxqUXVlcnkuYmJxLnJlbW92ZVN0YXRlPgovLyAgICAgICAgIG1ldGhvZCBhbmQgYWRkZWQgYWRkaXRpb25hbCA8alF1ZXJ5LmRlcGFyYW0+IGV4YW1wbGVzLgovLyAxLjAuMyAtICgxMi8yLzIwMDkpIEZpeGVkIGFuIGlzc3VlIGluIElFIDYgd2hlcmUgbG9jYXRpb24uc2VhcmNoIGFuZAovLyAgICAgICAgIGxvY2F0aW9uLmhhc2ggd291bGQgcmVwb3J0IGluY29ycmVjdGx5IGlmIHRoZSBoYXNoIGNvbnRhaW5lZCB0aGUgPwovLyAgICAgICAgIGNoYXJhY3Rlci4gQWxzbyA8alF1ZXJ5LnBhcmFtLnF1ZXJ5c3RyaW5nPiBhbmQgPGpRdWVyeS5wYXJhbS5mcmFnbWVudD4KLy8gICAgICAgICB3aWxsIG5vIGxvbmdlciBwYXJzZSBwYXJhbXMgb3V0IG9mIGEgVVJMIHRoYXQgZG9lc24ndCBjb250YWluID8gb3IgIywKLy8gICAgICAgICByZXNwZWN0aXZlbHkuCi8vIDEuMC4yIC0gKDEwLzEwLzIwMDkpIEZpeGVkIGFuIGlzc3VlIGluIElFIDYvNyB3aGVyZSB0aGUgaGlkZGVuIElGUkFNRSBjYXVzZWQKLy8gICAgICAgICBhICJUaGlzIHBhZ2UgY29udGFpbnMgYm90aCBzZWN1cmUgYW5kIG5vbnNlY3VyZSBpdGVtcy4iIHdhcm5pbmcgd2hlbgovLyAgICAgICAgIHVzZWQgb24gYW4gaHR0cHM6Ly8gcGFnZS4KLy8gMS4wLjEgLSAoMTAvNy8yMDA5KSBGaXhlZCBhbiBpc3N1ZSBpbiBJRSA4LiBTaW5jZSBib3RoICJJRTciIGFuZCAiSUU4Ci8vICAgICAgICAgQ29tcGF0aWJpbGl0eSBWaWV3IiBtb2RlcyBlcnJvbmVvdXNseSByZXBvcnQgdGhhdCB0aGUgYnJvd3NlcgovLyAgICAgICAgIHN1cHBvcnRzIHRoZSBuYXRpdmUgd2luZG93Lm9uaGFzaGNoYW5nZSBldmVudCwgYSBzbGlnaHRseSBtb3JlCi8vICAgICAgICAgcm9idXN0IHRlc3QgbmVlZGVkIHRvIGJlIGFkZGVkLgovLyAxLjAgICAtICgxMC8yLzIwMDkpIEluaXRpYWwgcmVsZWFzZQoKKGZ1bmN0aW9uKCQsd2luZG93KXsKICAnJDpub211bmdlJzsgLy8gVXNlZCBieSBZVUkgY29tcHJlc3Nvci4KICAKICAvLyBTb21lIGNvbnZlbmllbnQgc2hvcnRjdXRzLgogIHZhciB1bmRlZmluZWQsCiAgICBhcHMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsCiAgICBkZWNvZGUgPSBkZWNvZGVVUklDb21wb25lbnQsCiAgICAKICAgIC8vIE1ldGhvZCAvIG9iamVjdCByZWZlcmVuY2VzLgogICAganFfcGFyYW0gPSAkLnBhcmFtLAogICAganFfcGFyYW1fc29ydGVkLAogICAganFfcGFyYW1fZnJhZ21lbnQsCiAgICBqcV9kZXBhcmFtLAogICAganFfZGVwYXJhbV9mcmFnbWVudCwKICAgIGpxX2JicSA9ICQuYmJxID0gJC5iYnEgfHwge30sCiAgICBqcV9iYnFfcHVzaFN0YXRlLAogICAganFfYmJxX2dldFN0YXRlLAogICAganFfZWxlbVVybEF0dHIsCiAgICBzcGVjaWFsID0gJC5ldmVudC5zcGVjaWFsLAogICAgCiAgICAvLyBSZXVzZWQgc3RyaW5ncy4KICAgIHN0cl9oYXNoY2hhbmdlID0gJ2hhc2hjaGFuZ2UnLAogICAgc3RyX3F1ZXJ5c3RyaW5nID0gJ3F1ZXJ5c3RyaW5nJywKICAgIHN0cl9mcmFnbWVudCA9ICdmcmFnbWVudCcsCiAgICBzdHJfZWxlbVVybEF0dHIgPSAnZWxlbVVybEF0dHInLAogICAgc3RyX2hyZWYgPSAnaHJlZicsCiAgICBzdHJfc3JjID0gJ3NyYycsCiAgICAKICAgIC8vIFJldXNlZCBSZWdFeHAuCiAgICByZV9wYXJhbXNfcXVlcnlzdHJpbmcgPSAvXi4qXD98Iy4qJC9nLAogICAgcmVfcGFyYW1zX2ZyYWdtZW50LAogICAgcmVfZnJhZ21lbnQsCiAgICByZV9ub19lc2NhcGUsCiAgICAKICAgIGFqYXhfY3Jhd2xhYmxlLAogICAgZnJhZ21lbnRfcHJlZml4LAogICAgCiAgICAvLyBVc2VkIGJ5IGpRdWVyeS5lbGVtVXJsQXR0ci4KICAgIGVsZW1VcmxBdHRyX2NhY2hlID0ge307CiAgCiAgLy8gQSBmZXcgY29tbW9ubHkgdXNlZCBiaXRzLCBicm9rZW4gb3V0IHRvIGhlbHAgcmVkdWNlIG1pbmlmaWVkIGZpbGUgc2l6ZS4KICAKICBmdW5jdGlvbiBpc19zdHJpbmcoIGFyZyApIHsKICAgIHJldHVybiB0eXBlb2YgYXJnID09PSAnc3RyaW5nJzsKICB9OwogIAogIC8vIFdoeSB3cml0ZSB0aGUgc2FtZSBmdW5jdGlvbiB0d2ljZT8gTGV0J3MgY3VycnkhIE1tbW0sIGN1cnJ5Li4KICAKICBmdW5jdGlvbiBjdXJyeSggZnVuYyApIHsKICAgIHZhciBhcmdzID0gYXBzLmNhbGwoIGFyZ3VtZW50cywgMSApOwogICAgCiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBmdW5jLmFwcGx5KCB0aGlzLCBhcmdzLmNvbmNhdCggYXBzLmNhbGwoIGFyZ3VtZW50cyApICkgKTsKICAgIH07CiAgfTsKICAKICAvLyBHZXQgbG9jYXRpb24uaGFzaCAob3Igd2hhdCB5b3UnZCBleHBlY3QgbG9jYXRpb24uaGFzaCB0byBiZSkgc2FucyBhbnkKICAvLyBsZWFkaW5nICMuIFRoYW5rcyBmb3IgbWFraW5nIHRoaXMgbmVjZXNzYXJ5LCBGaXJlZm94IQogIGZ1bmN0aW9uIGdldF9mcmFnbWVudCggdXJsICkgewogICAgcmV0dXJuIHVybC5yZXBsYWNlKCByZV9mcmFnbWVudCwgJyQyJyApOwogIH07CiAgCiAgLy8gR2V0IGxvY2F0aW9uLnNlYXJjaCAob3Igd2hhdCB5b3UnZCBleHBlY3QgbG9jYXRpb24uc2VhcmNoIHRvIGJlKSBzYW5zIGFueQogIC8vIGxlYWRpbmcgIy4gVGhhbmtzIGZvciBtYWtpbmcgdGhpcyBuZWNlc3NhcnksIElFNiEKICBmdW5jdGlvbiBnZXRfcXVlcnlzdHJpbmcoIHVybCApIHsKICAgIHJldHVybiB1cmwucmVwbGFjZSggLyg/Ol5bXj8jXSpcPyhbXiNdKikuKiQpPy4qLywgJyQxJyApOwogIH07CiAgCiAgLy8gU2VjdGlvbjogUGFyYW0gKHRvIHN0cmluZykKICAvLyAKICAvLyBNZXRob2Q6IGpRdWVyeS5wYXJhbS5xdWVyeXN0cmluZwogIC8vIAogIC8vIFJldHJpZXZlIHRoZSBxdWVyeSBzdHJpbmcgZnJvbSBhIFVSTCBvciBpZiBubyBhcmd1bWVudHMgYXJlIHBhc3NlZCwgdGhlCiAgLy8gY3VycmVudCB3aW5kb3cubG9jYXRpb24uaHJlZi4KICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyA+IGpRdWVyeS5wYXJhbS5xdWVyeXN0cmluZyggWyB1cmwgXSApOwogIC8vIAogIC8vIEFyZ3VtZW50czoKICAvLyAKICAvLyAgdXJsIC0gKFN0cmluZykgQSBVUkwgY29udGFpbmluZyBxdWVyeSBzdHJpbmcgcGFyYW1zIHRvIGJlIHBhcnNlZC4gSWYgdXJsCiAgLy8gICAgaXMgbm90IHBhc3NlZCwgdGhlIGN1cnJlbnQgd2luZG93LmxvY2F0aW9uLmhyZWYgaXMgdXNlZC4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICAoU3RyaW5nKSBUaGUgcGFyc2VkIHF1ZXJ5IHN0cmluZywgd2l0aCBhbnkgbGVhZGluZyAiPyIgcmVtb3ZlZC4KICAvLwogIAogIC8vIE1ldGhvZDogalF1ZXJ5LnBhcmFtLnF1ZXJ5c3RyaW5nIChidWlsZCB1cmwpCiAgLy8gCiAgLy8gTWVyZ2UgYSBVUkwsIHdpdGggb3Igd2l0aG91dCBwcmUtZXhpc3RpbmcgcXVlcnkgc3RyaW5nIHBhcmFtcywgcGx1cyBhbnkKICAvLyBvYmplY3QsIHBhcmFtcyBzdHJpbmcgb3IgVVJMIGNvbnRhaW5pbmcgcXVlcnkgc3RyaW5nIHBhcmFtcyBpbnRvIGEgbmV3IFVSTC4KICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyA+IGpRdWVyeS5wYXJhbS5xdWVyeXN0cmluZyggdXJsLCBwYXJhbXMgWywgbWVyZ2VfbW9kZSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICB1cmwgLSAoU3RyaW5nKSBBIHZhbGlkIFVSTCBmb3IgcGFyYW1zIHRvIGJlIG1lcmdlZCBpbnRvLiBUaGlzIFVSTCBtYXkKICAvLyAgICBjb250YWluIGEgcXVlcnkgc3RyaW5nIGFuZC9vciBmcmFnbWVudCAoaGFzaCkuCiAgLy8gIHBhcmFtcyAtIChTdHJpbmcpIEEgcGFyYW1zIHN0cmluZyBvciBVUkwgY29udGFpbmluZyBxdWVyeSBzdHJpbmcgcGFyYW1zIHRvCiAgLy8gICAgYmUgbWVyZ2VkIGludG8gdXJsLgogIC8vICBwYXJhbXMgLSAoT2JqZWN0KSBBIHBhcmFtcyBvYmplY3QgdG8gYmUgbWVyZ2VkIGludG8gdXJsLgogIC8vICBtZXJnZV9tb2RlIC0gKE51bWJlcikgTWVyZ2UgYmVoYXZpb3IgZGVmYXVsdHMgdG8gMCBpZiBtZXJnZV9tb2RlIGlzIG5vdAogIC8vICAgIHNwZWNpZmllZCwgYW5kIGlzIGFzLWZvbGxvd3M6CiAgLy8gCiAgLy8gICAgKiAwOiBwYXJhbXMgaW4gdGhlIHBhcmFtcyBhcmd1bWVudCB3aWxsIG92ZXJyaWRlIGFueSBxdWVyeSBzdHJpbmcKICAvLyAgICAgICAgIHBhcmFtcyBpbiB1cmwuCiAgLy8gICAgKiAxOiBhbnkgcXVlcnkgc3RyaW5nIHBhcmFtcyBpbiB1cmwgd2lsbCBvdmVycmlkZSBwYXJhbXMgaW4gdGhlIHBhcmFtcwogIC8vICAgICAgICAgYXJndW1lbnQuCiAgLy8gICAgKiAyOiBwYXJhbXMgYXJndW1lbnQgd2lsbCBjb21wbGV0ZWx5IHJlcGxhY2UgYW55IHF1ZXJ5IHN0cmluZyBpbiB1cmwuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKFN0cmluZykgQSBVUkwgd2l0aCBhIHVybGVuY29kZWQgcXVlcnkgc3RyaW5nIGluIHRoZSBmb3JtYXQgJz9hPWImYz1kJmU9ZicuCiAgCiAgLy8gTWV0aG9kOiBqUXVlcnkucGFyYW0uZnJhZ21lbnQKICAvLyAKICAvLyBSZXRyaWV2ZSB0aGUgZnJhZ21lbnQgKGhhc2gpIGZyb20gYSBVUkwgb3IgaWYgbm8gYXJndW1lbnRzIGFyZSBwYXNzZWQsIHRoZQogIC8vIGN1cnJlbnQgd2luZG93LmxvY2F0aW9uLmhyZWYuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkucGFyYW0uZnJhZ21lbnQoIFsgdXJsIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIHVybCAtIChTdHJpbmcpIEEgVVJMIGNvbnRhaW5pbmcgZnJhZ21lbnQgKGhhc2gpIHBhcmFtcyB0byBiZSBwYXJzZWQuIElmCiAgLy8gICAgdXJsIGlzIG5vdCBwYXNzZWQsIHRoZSBjdXJyZW50IHdpbmRvdy5sb2NhdGlvbi5ocmVmIGlzIHVzZWQuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKFN0cmluZykgVGhlIHBhcnNlZCBmcmFnbWVudCAoaGFzaCkgc3RyaW5nLCB3aXRoIGFueSBsZWFkaW5nICIjIiByZW1vdmVkLgogIAogIC8vIE1ldGhvZDogalF1ZXJ5LnBhcmFtLmZyYWdtZW50IChidWlsZCB1cmwpCiAgLy8gCiAgLy8gTWVyZ2UgYSBVUkwsIHdpdGggb3Igd2l0aG91dCBwcmUtZXhpc3RpbmcgZnJhZ21lbnQgKGhhc2gpIHBhcmFtcywgcGx1cyBhbnkKICAvLyBvYmplY3QsIHBhcmFtcyBzdHJpbmcgb3IgVVJMIGNvbnRhaW5pbmcgZnJhZ21lbnQgKGhhc2gpIHBhcmFtcyBpbnRvIGEgbmV3CiAgLy8gVVJMLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5LnBhcmFtLmZyYWdtZW50KCB1cmwsIHBhcmFtcyBbLCBtZXJnZV9tb2RlIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIHVybCAtIChTdHJpbmcpIEEgdmFsaWQgVVJMIGZvciBwYXJhbXMgdG8gYmUgbWVyZ2VkIGludG8uIFRoaXMgVVJMIG1heQogIC8vICAgIGNvbnRhaW4gYSBxdWVyeSBzdHJpbmcgYW5kL29yIGZyYWdtZW50IChoYXNoKS4KICAvLyAgcGFyYW1zIC0gKFN0cmluZykgQSBwYXJhbXMgc3RyaW5nIG9yIFVSTCBjb250YWluaW5nIGZyYWdtZW50IChoYXNoKSBwYXJhbXMKICAvLyAgICB0byBiZSBtZXJnZWQgaW50byB1cmwuCiAgLy8gIHBhcmFtcyAtIChPYmplY3QpIEEgcGFyYW1zIG9iamVjdCB0byBiZSBtZXJnZWQgaW50byB1cmwuCiAgLy8gIG1lcmdlX21vZGUgLSAoTnVtYmVyKSBNZXJnZSBiZWhhdmlvciBkZWZhdWx0cyB0byAwIGlmIG1lcmdlX21vZGUgaXMgbm90CiAgLy8gICAgc3BlY2lmaWVkLCBhbmQgaXMgYXMtZm9sbG93czoKICAvLyAKICAvLyAgICAqIDA6IHBhcmFtcyBpbiB0aGUgcGFyYW1zIGFyZ3VtZW50IHdpbGwgb3ZlcnJpZGUgYW55IGZyYWdtZW50IChoYXNoKQogIC8vICAgICAgICAgcGFyYW1zIGluIHVybC4KICAvLyAgICAqIDE6IGFueSBmcmFnbWVudCAoaGFzaCkgcGFyYW1zIGluIHVybCB3aWxsIG92ZXJyaWRlIHBhcmFtcyBpbiB0aGUKICAvLyAgICAgICAgIHBhcmFtcyBhcmd1bWVudC4KICAvLyAgICAqIDI6IHBhcmFtcyBhcmd1bWVudCB3aWxsIGNvbXBsZXRlbHkgcmVwbGFjZSBhbnkgcXVlcnkgc3RyaW5nIGluIHVybC4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICAoU3RyaW5nKSBBIFVSTCB3aXRoIGEgdXJsZW5jb2RlZCBmcmFnbWVudCAoaGFzaCkgaW4gdGhlIGZvcm1hdCAnI2E9YiZjPWQmZT1mJy4KICAKICBmdW5jdGlvbiBqcV9wYXJhbV9zdWIoIGlzX2ZyYWdtZW50LCBnZXRfZnVuYywgdXJsLCBwYXJhbXMsIG1lcmdlX21vZGUgKSB7CiAgICB2YXIgcmVzdWx0LAogICAgICBxcywKICAgICAgbWF0Y2hlcywKICAgICAgdXJsX3BhcmFtcywKICAgICAgaGFzaDsKICAgIAogICAgaWYgKCBwYXJhbXMgIT09IHVuZGVmaW5lZCApIHsKICAgICAgLy8gQnVpbGQgVVJMIGJ5IG1lcmdpbmcgcGFyYW1zIGludG8gdXJsIHN0cmluZy4KICAgICAgCiAgICAgIC8vIG1hdGNoZXNbMV0gPSB1cmwgcGFydCB0aGF0IHByZWNlZGVzIHBhcmFtcywgbm90IGluY2x1ZGluZyB0cmFpbGluZyA/LyMKICAgICAgLy8gbWF0Y2hlc1syXSA9IHBhcmFtcywgbm90IGluY2x1ZGluZyBsZWFkaW5nID8vIwogICAgICAvLyBtYXRjaGVzWzNdID0gaWYgaW4gJ3F1ZXJ5c3RyaW5nJyBtb2RlLCBoYXNoIGluY2x1ZGluZyBsZWFkaW5nICMsIG90aGVyd2lzZSAnJwogICAgICBtYXRjaGVzID0gdXJsLm1hdGNoKCBpc19mcmFnbWVudCA/IHJlX2ZyYWdtZW50IDogL14oW14jP10qKVw/PyhbXiNdKikoIz8uKikvICk7CiAgICAgIAogICAgICAvLyBHZXQgdGhlIGhhc2ggaWYgaW4gJ3F1ZXJ5c3RyaW5nJyBtb2RlLCBhbmQgaXQgZXhpc3RzLgogICAgICBoYXNoID0gbWF0Y2hlc1szXSB8fCAnJzsKICAgICAgCiAgICAgIGlmICggbWVyZ2VfbW9kZSA9PT0gMiAmJiBpc19zdHJpbmcoIHBhcmFtcyApICkgewogICAgICAgIC8vIElmIG1lcmdlX21vZGUgaXMgMiBhbmQgcGFyYW1zIGlzIGEgc3RyaW5nLCBtZXJnZSB0aGUgZnJhZ21lbnQgLyBxdWVyeQogICAgICAgIC8vIHN0cmluZyBpbnRvIHRoZSBVUkwgd2hvbGVzYWxlLCB3aXRob3V0IGNvbnZlcnRpbmcgaXQgaW50byBhbiBvYmplY3QuCiAgICAgICAgcXMgPSBwYXJhbXMucmVwbGFjZSggaXNfZnJhZ21lbnQgPyByZV9wYXJhbXNfZnJhZ21lbnQgOiByZV9wYXJhbXNfcXVlcnlzdHJpbmcsICcnICk7CiAgICAgICAgCiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQ29udmVydCByZWxldmFudCBwYXJhbXMgaW4gdXJsIHRvIG9iamVjdC4KICAgICAgICB1cmxfcGFyYW1zID0ganFfZGVwYXJhbSggbWF0Y2hlc1syXSApOwogICAgICAgIAogICAgICAgIHBhcmFtcyA9IGlzX3N0cmluZyggcGFyYW1zICkKICAgICAgICAgIAogICAgICAgICAgLy8gQ29udmVydCBwYXNzZWQgcGFyYW1zIHN0cmluZyBpbnRvIG9iamVjdC4KICAgICAgICAgID8ganFfZGVwYXJhbVsgaXNfZnJhZ21lbnQgPyBzdHJfZnJhZ21lbnQgOiBzdHJfcXVlcnlzdHJpbmcgXSggcGFyYW1zICkKICAgICAgICAgIAogICAgICAgICAgLy8gUGFzc2VkIHBhcmFtcyBvYmplY3QuCiAgICAgICAgICA6IHBhcmFtczsKICAgICAgICAKICAgICAgICBxcyA9IG1lcmdlX21vZGUgPT09IDIgPyBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwYXNzZWQgcGFyYW1zIHJlcGxhY2UgdXJsIHBhcmFtcwogICAgICAgICAgOiBtZXJnZV9tb2RlID09PSAxICA/ICQuZXh0ZW5kKCB7fSwgcGFyYW1zLCB1cmxfcGFyYW1zICkgIC8vIHVybCBwYXJhbXMgb3ZlcnJpZGUgcGFzc2VkIHBhcmFtcwogICAgICAgICAgOiAkLmV4dGVuZCgge30sIHVybF9wYXJhbXMsIHBhcmFtcyApOyAgICAgICAgICAgICAgICAgICAgIC8vIHBhc3NlZCBwYXJhbXMgb3ZlcnJpZGUgdXJsIHBhcmFtcwogICAgICAgIAogICAgICAgIC8vIENvbnZlcnQgcGFyYW1zIG9iamVjdCBpbnRvIGEgc29ydGVkIHBhcmFtcyBzdHJpbmcuCiAgICAgICAgcXMgPSBqcV9wYXJhbV9zb3J0ZWQoIHFzICk7CiAgICAgICAgCiAgICAgICAgLy8gVW5lc2NhcGUgY2hhcmFjdGVycyBzcGVjaWZpZWQgdmlhICQucGFyYW0ubm9Fc2NhcGUuIFNpbmNlIG9ubHkgaGFzaC0KICAgICAgICAvLyBoaXN0b3J5IHVzZXJzIGhhdmUgcmVxdWVzdGVkIHRoaXMgZmVhdHVyZSwgaXQncyBvbmx5IGVuYWJsZWQgZm9yCiAgICAgICAgLy8gZnJhZ21lbnQtcmVsYXRlZCBwYXJhbXMgc3RyaW5ncy4KICAgICAgICBpZiAoIGlzX2ZyYWdtZW50ICkgewogICAgICAgICAgcXMgPSBxcy5yZXBsYWNlKCByZV9ub19lc2NhcGUsIGRlY29kZSApOwogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgLy8gQnVpbGQgVVJMIGZyb20gdGhlIGJhc2UgdXJsLCBxdWVyeXN0cmluZyBhbmQgaGFzaC4gSW4gJ3F1ZXJ5c3RyaW5nJwogICAgICAvLyBtb2RlLCA/IGlzIG9ubHkgYWRkZWQgaWYgYSBxdWVyeSBzdHJpbmcgZXhpc3RzLiBJbiAnZnJhZ21lbnQnIG1vZGUsICMKICAgICAgLy8gaXMgYWx3YXlzIGFkZGVkLgogICAgICByZXN1bHQgPSBtYXRjaGVzWzFdICsgKCBpc19mcmFnbWVudCA/IGZyYWdtZW50X3ByZWZpeCA6IHFzIHx8ICFtYXRjaGVzWzFdID8gJz8nIDogJycgKSArIHFzICsgaGFzaDsKICAgICAgCiAgICB9IGVsc2UgewogICAgICAvLyBJZiBVUkwgd2FzIHBhc3NlZCBpbiwgcGFyc2UgcGFyYW1zIGZyb20gVVJMIHN0cmluZywgb3RoZXJ3aXNlIHBhcnNlCiAgICAgIC8vIHBhcmFtcyBmcm9tIHdpbmRvdy5sb2NhdGlvbi5ocmVmLgogICAgICByZXN1bHQgPSBnZXRfZnVuYyggdXJsICE9PSB1bmRlZmluZWQgPyB1cmwgOiBsb2NhdGlvbi5ocmVmICk7CiAgICB9CiAgICAKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKICAKICBqcV9wYXJhbVsgc3RyX3F1ZXJ5c3RyaW5nIF0gICAgICAgICAgICAgICAgICA9IGN1cnJ5KCBqcV9wYXJhbV9zdWIsIDAsIGdldF9xdWVyeXN0cmluZyApOwogIGpxX3BhcmFtWyBzdHJfZnJhZ21lbnQgXSA9IGpxX3BhcmFtX2ZyYWdtZW50ID0gY3VycnkoIGpxX3BhcmFtX3N1YiwgMSwgZ2V0X2ZyYWdtZW50ICk7CiAgCiAgLy8gTWV0aG9kOiBqUXVlcnkucGFyYW0uc29ydGVkCiAgLy8gCiAgLy8gUmV0dXJucyBhIHBhcmFtcyBzdHJpbmcgZXF1aXZhbGVudCB0byB0aGF0IHJldHVybmVkIGJ5IHRoZSBpbnRlcm5hbAogIC8vIGpRdWVyeS5wYXJhbSBtZXRob2QsIGJ1dCBzb3J0ZWQsIHdoaWNoIG1ha2VzIGl0IHN1aXRhYmxlIGZvciB1c2UgYXMgYQogIC8vIGNhY2hlIGtleS4KICAvLyAKICAvLyBGb3IgZXhhbXBsZSwgaW4gbW9zdCBicm93c2VycyBqUXVlcnkucGFyYW0oe3o6MSxhOjJ9KSByZXR1cm5zICJ6PTEmYT0yIgogIC8vIGFuZCBqUXVlcnkucGFyYW0oe2E6Mix6OjF9KSByZXR1cm5zICJhPTImej0xIi4gRXZlbiB0aG91Z2ggYm90aCB0aGUKICAvLyBvYmplY3RzIGJlaW5nIHNlcmlhbGl6ZWQgYW5kIHRoZSByZXN1bHRpbmcgcGFyYW1zIHN0cmluZ3MgYXJlIGVxdWl2YWxlbnQsCiAgLy8gaWYgdGhlc2UgcGFyYW1zIHN0cmluZ3Mgd2VyZSBzZXQgaW50byB0aGUgbG9jYXRpb24uaGFzaCBmcmFnbWVudAogIC8vIHNlcXVlbnRpYWxseSwgdGhlIGhhc2hjaGFuZ2UgZXZlbnQgd291bGQgYmUgdHJpZ2dlcmVkIHVubmVjZXNzYXJpbHksIHNpbmNlCiAgLy8gdGhlIHN0cmluZ3MgYXJlIGRpZmZlcmVudCAoZXZlbiB0aG91Z2ggdGhlIGRhdGEgZGVzY3JpYmVkIGJ5IHRoZW0gaXMgdGhlCiAgLy8gc2FtZSkuIEJ5IHNvcnRpbmcgdGhlIHBhcmFtcyBzdHJpbmcsIHVuZWNlc3NhcnkgaGFzaGNoYW5nZSBldmVudCB0cmlnZ2VyaW5nCiAgLy8gY2FuIGJlIGF2b2lkZWQuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkucGFyYW0uc29ydGVkKCBvYmogWywgdHJhZGl0aW9uYWwgXSApOwogIC8vIAogIC8vIEFyZ3VtZW50czoKICAvLyAKICAvLyAgb2JqIC0gKE9iamVjdCkgQW4gb2JqZWN0IHRvIGJlIHNlcmlhbGl6ZWQuCiAgLy8gIHRyYWRpdGlvbmFsIC0gKEJvb2xlYW4pIFBhcmFtcyBkZWVwL3NoYWxsb3cgc2VyaWFsaXphdGlvbiBtb2RlLiBTZWUgdGhlCiAgLy8gICAgZG9jdW1lbnRhdGlvbiBhdCBodHRwOi8vYXBpLmpxdWVyeS5jb20valF1ZXJ5LnBhcmFtLyBmb3IgbW9yZSBkZXRhaWwuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKFN0cmluZykgQSBzb3J0ZWQgcGFyYW1zIHN0cmluZy4KICAKICBqcV9wYXJhbS5zb3J0ZWQgPSBqcV9wYXJhbV9zb3J0ZWQgPSBmdW5jdGlvbiggYSwgdHJhZGl0aW9uYWwgKSB7CiAgICB2YXIgYXJyID0gW10sCiAgICAgIG9iaiA9IHt9OwogICAgCiAgICAkLmVhY2goIGpxX3BhcmFtKCBhLCB0cmFkaXRpb25hbCApLnNwbGl0KCAnJicgKSwgZnVuY3Rpb24oaSx2KXsKICAgICAgdmFyIGtleSA9IHYucmVwbGFjZSggLyg/OiU1Qnw9KS4qJC8sICcnICksCiAgICAgICAga2V5X29iaiA9IG9ialsga2V5IF07CiAgICAgIAogICAgICBpZiAoICFrZXlfb2JqICkgewogICAgICAgIGtleV9vYmogPSBvYmpbIGtleSBdID0gW107CiAgICAgICAgYXJyLnB1c2goIGtleSApOwogICAgICB9CiAgICAgIAogICAgICBrZXlfb2JqLnB1c2goIHYgKTsKICAgIH0pOwogICAgCiAgICByZXR1cm4gJC5tYXAoIGFyci5zb3J0KCksIGZ1bmN0aW9uKHYpewogICAgICByZXR1cm4gb2JqWyB2IF07CiAgICB9KS5qb2luKCAnJicgKTsKICB9OwogIAogIC8vIE1ldGhvZDogalF1ZXJ5LnBhcmFtLmZyYWdtZW50Lm5vRXNjYXBlCiAgLy8gCiAgLy8gU3BlY2lmeSBjaGFyYWN0ZXJzIHRoYXQgd2lsbCBiZSBsZWZ0IHVuZXNjYXBlZCB3aGVuIGZyYWdtZW50cyBhcmUgY3JlYXRlZAogIC8vIG9yIG1lcmdlZCB1c2luZyA8alF1ZXJ5LnBhcmFtLmZyYWdtZW50Piwgb3Igd2hlbiB0aGUgZnJhZ21lbnQgaXMgbW9kaWZpZWQKICAvLyB1c2luZyA8alF1ZXJ5LmJicS5wdXNoU3RhdGU+LiBUaGlzIG9wdGlvbiBvbmx5IGFwcGxpZXMgdG8gc2VyaWFsaXplZCBkYXRhCiAgLy8gb2JqZWN0IGZyYWdtZW50cywgYW5kIG5vdCBzZXQtYXMtc3RyaW5nIGZyYWdtZW50cy4gRG9lcyBub3QgYWZmZWN0IHRoZQogIC8vIHF1ZXJ5IHN0cmluZy4gRGVmYXVsdHMgdG8gIiwvIiAoY29tbWEsIGZvcndhcmQgc2xhc2gpLgogIC8vIAogIC8vIE5vdGUgdGhhdCB0aGlzIGlzIGNvbnNpZGVyZWQgYSBwdXJlbHkgYWVzdGhldGljIG9wdGlvbiwgYW5kIHdpbGwgaGVscCB0bwogIC8vIGNyZWF0ZSBVUkxzIHRoYXQgImxvb2sgcHJldHR5IiBpbiB0aGUgYWRkcmVzcyBiYXIgb3IgYm9va21hcmtzLCB3aXRob3V0CiAgLy8gYWZmZWN0aW5nIGZ1bmN0aW9uYWxpdHkgaW4gYW55IHdheS4gVGhhdCBiZWluZyBzYWlkLCBiZSBjYXJlZnVsIHRvIG5vdAogIC8vIHVuZXNjYXBlIGNoYXJhY3RlcnMgdGhhdCBhcmUgdXNlZCBhcyBkZWxpbWl0ZXJzIG9yIHNlcnZlIGEgc3BlY2lhbAogIC8vIHB1cnBvc2UsIHN1Y2ggYXMgdGhlICIjPyY9KyIgKG9jdG90aG9ycGUsIHF1ZXN0aW9uIG1hcmssIGFtcGVyc2FuZCwKICAvLyBlcXVhbHMsIHBsdXMpIGNoYXJhY3RlcnMuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkucGFyYW0uZnJhZ21lbnQubm9Fc2NhcGUoIFsgY2hhcnMgXSApOwogIC8vIAogIC8vIEFyZ3VtZW50czoKICAvLyAKICAvLyAgY2hhcnMgLSAoU3RyaW5nKSBUaGUgY2hhcmFjdGVycyB0byBub3QgZXNjYXBlIGluIHRoZSBmcmFnbWVudC4gSWYKICAvLyAgICB1bnNwZWNpZmllZCwgZGVmYXVsdHMgdG8gZW1wdHkgc3RyaW5nIChlc2NhcGUgYWxsIGNoYXJhY3RlcnMpLgogIC8vIAogIC8vIFJldHVybnM6CiAgLy8gCiAgLy8gIE5vdGhpbmcuCiAgCiAganFfcGFyYW1fZnJhZ21lbnQubm9Fc2NhcGUgPSBmdW5jdGlvbiggY2hhcnMgKSB7CiAgICBjaGFycyA9IGNoYXJzIHx8ICcnOwogICAgdmFyIGFyciA9ICQubWFwKCBjaGFycy5zcGxpdCgnJyksIGVuY29kZVVSSUNvbXBvbmVudCApOwogICAgcmVfbm9fZXNjYXBlID0gbmV3IFJlZ0V4cCggYXJyLmpvaW4oJ3wnKSwgJ2cnICk7CiAgfTsKICAKICAvLyBBIHNlbnNpYmxlIGRlZmF1bHQuIFRoZXNlIGFyZSB0aGUgY2hhcmFjdGVycyBwZW9wbGUgc2VlbSB0byBjb21wbGFpbiBhYm91dAogIC8vICJ1Z2xpZnlpbmcgdXAgdGhlIFVSTCIgdGhlIG1vc3QuCiAganFfcGFyYW1fZnJhZ21lbnQubm9Fc2NhcGUoICcsLycgKTsKICAKICAvLyBNZXRob2Q6IGpRdWVyeS5wYXJhbS5mcmFnbWVudC5hamF4Q3Jhd2xhYmxlCiAgLy8gCiAgLy8gVE9ETzogREVTQ1JJQkUKICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyA+IGpRdWVyeS5wYXJhbS5mcmFnbWVudC5hamF4Q3Jhd2xhYmxlKCBbIHN0YXRlIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIHN0YXRlIC0gKEJvb2xlYW4pIFRPRE86IERFU0NSSUJFCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKEJvb2xlYW4pIFRoZSBjdXJyZW50IGFqYXhDcmF3bGFibGUgc3RhdGUuCiAgCiAganFfcGFyYW1fZnJhZ21lbnQuYWpheENyYXdsYWJsZSA9IGZ1bmN0aW9uKCBzdGF0ZSApIHsKICAgIGlmICggc3RhdGUgIT09IHVuZGVmaW5lZCApIHsKICAgICAgaWYgKCBzdGF0ZSApIHsKICAgICAgICByZV9wYXJhbXNfZnJhZ21lbnQgPSAvXi4qKD86IyF8IykvOwogICAgICAgIHJlX2ZyYWdtZW50ID0gL14oW14jXSopKD86IyF8Iyk/KC4qKSQvOwogICAgICAgIGZyYWdtZW50X3ByZWZpeCA9ICcjISc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVfcGFyYW1zX2ZyYWdtZW50ID0gL14uKiMvOwogICAgICAgIHJlX2ZyYWdtZW50ID0gL14oW14jXSopIz8oLiopJC87CiAgICAgICAgZnJhZ21lbnRfcHJlZml4ID0gJyMnOwogICAgICB9CiAgICAgIGFqYXhfY3Jhd2xhYmxlID0gISFzdGF0ZTsKICAgIH0KICAgIAogICAgcmV0dXJuIGFqYXhfY3Jhd2xhYmxlOwogIH07CiAgCiAganFfcGFyYW1fZnJhZ21lbnQuYWpheENyYXdsYWJsZSggMCApOwogIAogIC8vIFNlY3Rpb246IERlcGFyYW0gKGZyb20gc3RyaW5nKQogIC8vIAogIC8vIE1ldGhvZDogalF1ZXJ5LmRlcGFyYW0KICAvLyAKICAvLyBEZXNlcmlhbGl6ZSBhIHBhcmFtcyBzdHJpbmcgaW50byBhbiBvYmplY3QsIG9wdGlvbmFsbHkgY29lcmNpbmcgbnVtYmVycywKICAvLyBib29sZWFucywgbnVsbCBhbmQgdW5kZWZpbmVkIHZhbHVlczsgdGhpcyBtZXRob2QgaXMgdGhlIGNvdW50ZXJwYXJ0IHRvIHRoZQogIC8vIGludGVybmFsIGpRdWVyeS5wYXJhbSBtZXRob2QuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkuZGVwYXJhbSggcGFyYW1zIFssIGNvZXJjZSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICBwYXJhbXMgLSAoU3RyaW5nKSBBIHBhcmFtcyBzdHJpbmcgdG8gYmUgcGFyc2VkLgogIC8vICBjb2VyY2UgLSAoQm9vbGVhbikgSWYgdHJ1ZSwgY29lcmNlcyBhbnkgbnVtYmVycyBvciB0cnVlLCBmYWxzZSwgbnVsbCwgYW5kCiAgLy8gICAgdW5kZWZpbmVkIHRvIHRoZWlyIGFjdHVhbCB2YWx1ZS4gRGVmYXVsdHMgdG8gZmFsc2UgaWYgb21pdHRlZC4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICAoT2JqZWN0KSBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBkZXNlcmlhbGl6ZWQgcGFyYW1zIHN0cmluZy4KICAKICAkLmRlcGFyYW0gPSBqcV9kZXBhcmFtID0gZnVuY3Rpb24oIHBhcmFtcywgY29lcmNlICkgewogICAgdmFyIG9iaiA9IHt9LAogICAgICBjb2VyY2VfdHlwZXMgPSB7ICd0cnVlJzogITAsICdmYWxzZSc6ICExLCAnbnVsbCc6IG51bGwgfTsKICAgIAogICAgLy8gSXRlcmF0ZSBvdmVyIGFsbCBuYW1lPXZhbHVlIHBhaXJzLgogICAgJC5lYWNoKCBwYXJhbXMucmVwbGFjZSggL1wrL2csICcgJyApLnNwbGl0KCAnJicgKSwgZnVuY3Rpb24oaix2KXsKICAgICAgdmFyIHBhcmFtID0gdi5zcGxpdCggJz0nICksCiAgICAgICAga2V5ID0gZGVjb2RlKCBwYXJhbVswXSApLAogICAgICAgIHZhbCwKICAgICAgICBjdXIgPSBvYmosCiAgICAgICAgaSA9IDAsCiAgICAgICAgCiAgICAgICAgLy8gSWYga2V5IGlzIG1vcmUgY29tcGxleCB0aGFuICdmb28nLCBsaWtlICdhW10nIG9yICdhW2JdW2NdJywgc3BsaXQgaXQKICAgICAgICAvLyBpbnRvIGl0cyBjb21wb25lbnQgcGFydHMuCiAgICAgICAga2V5cyA9IGtleS5zcGxpdCggJ11bJyApLAogICAgICAgIGtleXNfbGFzdCA9IGtleXMubGVuZ3RoIC0gMTsKICAgICAgCiAgICAgIC8vIElmIHRoZSBmaXJzdCBrZXlzIHBhcnQgY29udGFpbnMgWyBhbmQgdGhlIGxhc3QgZW5kcyB3aXRoIF0sIHRoZW4gW10KICAgICAgLy8gYXJlIGNvcnJlY3RseSBiYWxhbmNlZC4KICAgICAgaWYgKCAvXFsvLnRlc3QoIGtleXNbMF0gKSAmJiAvXF0kLy50ZXN0KCBrZXlzWyBrZXlzX2xhc3QgXSApICkgewogICAgICAgIC8vIFJlbW92ZSB0aGUgdHJhaWxpbmcgXSBmcm9tIHRoZSBsYXN0IGtleXMgcGFydC4KICAgICAgICBrZXlzWyBrZXlzX2xhc3QgXSA9IGtleXNbIGtleXNfbGFzdCBdLnJlcGxhY2UoIC9cXSQvLCAnJyApOwogICAgICAgIAogICAgICAgIC8vIFNwbGl0IGZpcnN0IGtleXMgcGFydCBpbnRvIHR3byBwYXJ0cyBvbiB0aGUgWyBhbmQgYWRkIHRoZW0gYmFjayBvbnRvCiAgICAgICAgLy8gdGhlIGJlZ2lubmluZyBvZiB0aGUga2V5cyBhcnJheS4KICAgICAgICBrZXlzID0ga2V5cy5zaGlmdCgpLnNwbGl0KCdbJykuY29uY2F0KCBrZXlzICk7CiAgICAgICAgCiAgICAgICAga2V5c19sYXN0ID0ga2V5cy5sZW5ndGggLSAxOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIEJhc2ljICdmb28nIHN0eWxlIGtleS4KICAgICAgICBrZXlzX2xhc3QgPSAwOwogICAgICB9CiAgICAgIAogICAgICAvLyBBcmUgd2UgZGVhbGluZyB3aXRoIGEgbmFtZT12YWx1ZSBwYWlyLCBvciBqdXN0IGEgbmFtZT8KICAgICAgaWYgKCBwYXJhbS5sZW5ndGggPT09IDIgKSB7CiAgICAgICAgdmFsID0gZGVjb2RlKCBwYXJhbVsxXSApOwogICAgICAgIAogICAgICAgIC8vIENvZXJjZSB2YWx1ZXMuCiAgICAgICAgaWYgKCBjb2VyY2UgKSB7CiAgICAgICAgICB2YWwgPSB2YWwgJiYgIWlzTmFOKHZhbCkgICAgICAgICAgICA/ICt2YWwgICAgICAgICAgICAgIC8vIG51bWJlcgogICAgICAgICAgICA6IHZhbCA9PT0gJ3VuZGVmaW5lZCcgICAgICAgICAgICAgPyB1bmRlZmluZWQgICAgICAgICAvLyB1bmRlZmluZWQKICAgICAgICAgICAgOiBjb2VyY2VfdHlwZXNbdmFsXSAhPT0gdW5kZWZpbmVkID8gY29lcmNlX3R5cGVzW3ZhbF0gLy8gdHJ1ZSwgZmFsc2UsIG51bGwKICAgICAgICAgICAgOiB2YWw7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RyaW5nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICgga2V5c19sYXN0ICkgewogICAgICAgICAgLy8gQ29tcGxleCBrZXksIGJ1aWxkIGRlZXAgb2JqZWN0IHN0cnVjdHVyZSBiYXNlZCBvbiBhIGZldyBydWxlczoKICAgICAgICAgIC8vICogVGhlICdjdXInIHBvaW50ZXIgc3RhcnRzIGF0IHRoZSBvYmplY3QgdG9wLWxldmVsLgogICAgICAgICAgLy8gKiBbXSA9IGFycmF5IHB1c2ggKG4gaXMgc2V0IHRvIGFycmF5IGxlbmd0aCksIFtuXSA9IGFycmF5IGlmIG4gaXMgCiAgICAgICAgICAvLyAgIG51bWVyaWMsIG90aGVyd2lzZSBvYmplY3QuCiAgICAgICAgICAvLyAqIElmIGF0IHRoZSBsYXN0IGtleXMgcGFydCwgc2V0IHRoZSB2YWx1ZS4KICAgICAgICAgIC8vICogRm9yIGVhY2gga2V5cyBwYXJ0LCBpZiB0aGUgY3VycmVudCBsZXZlbCBpcyB1bmRlZmluZWQgY3JlYXRlIGFuCiAgICAgICAgICAvLyAgIG9iamVjdCBvciBhcnJheSBiYXNlZCBvbiB0aGUgdHlwZSBvZiB0aGUgbmV4dCBrZXlzIHBhcnQuCiAgICAgICAgICAvLyAqIE1vdmUgdGhlICdjdXInIHBvaW50ZXIgdG8gdGhlIG5leHQgbGV2ZWwuCiAgICAgICAgICAvLyAqIFJpbnNlICYgcmVwZWF0LgogICAgICAgICAgZm9yICggOyBpIDw9IGtleXNfbGFzdDsgaSsrICkgewogICAgICAgICAgICBrZXkgPSBrZXlzW2ldID09PSAnJyA/IGN1ci5sZW5ndGggOiBrZXlzW2ldOwogICAgICAgICAgICBjdXIgPSBjdXJba2V5XSA9IGkgPCBrZXlzX2xhc3QKICAgICAgICAgICAgICA/IGN1cltrZXldIHx8ICgga2V5c1tpKzFdICYmIGlzTmFOKCBrZXlzW2krMV0gKSA/IHt9IDogW10gKQogICAgICAgICAgICAgIDogdmFsOwogICAgICAgICAgfQogICAgICAgICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIFNpbXBsZSBrZXksIGV2ZW4gc2ltcGxlciBydWxlcywgc2luY2Ugb25seSBzY2FsYXJzIGFuZCBzaGFsbG93CiAgICAgICAgICAvLyBhcnJheXMgYXJlIGFsbG93ZWQuCiAgICAgICAgICAKICAgICAgICAgIGlmICggJC5pc0FycmF5KCBvYmpba2V5XSApICkgewogICAgICAgICAgICAvLyB2YWwgaXMgYWxyZWFkeSBhbiBhcnJheSwgc28gcHVzaCBvbiB0aGUgbmV4dCB2YWx1ZS4KICAgICAgICAgICAgb2JqW2tleV0ucHVzaCggdmFsICk7CiAgICAgICAgICAgIAogICAgICAgICAgfSBlbHNlIGlmICggb2JqW2tleV0gIT09IHVuZGVmaW5lZCApIHsKICAgICAgICAgICAgLy8gdmFsIGlzbid0IGFuIGFycmF5LCBidXQgc2luY2UgYSBzZWNvbmQgdmFsdWUgaGFzIGJlZW4gc3BlY2lmaWVkLAogICAgICAgICAgICAvLyBjb252ZXJ0IHZhbCBpbnRvIGFuIGFycmF5LgogICAgICAgICAgICBvYmpba2V5XSA9IFsgb2JqW2tleV0sIHZhbCBdOwogICAgICAgICAgICAKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHZhbCBpcyBhIHNjYWxhci4KICAgICAgICAgICAgb2JqW2tleV0gPSB2YWw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICB9IGVsc2UgaWYgKCBrZXkgKSB7CiAgICAgICAgLy8gTm8gdmFsdWUgd2FzIGRlZmluZWQsIHNvIHNldCBzb21ldGhpbmcgbWVhbmluZ2Z1bC4KICAgICAgICBvYmpba2V5XSA9IGNvZXJjZQogICAgICAgICAgPyB1bmRlZmluZWQKICAgICAgICAgIDogJyc7CiAgICAgIH0KICAgIH0pOwogICAgCiAgICByZXR1cm4gb2JqOwogIH07CiAgCiAgLy8gTWV0aG9kOiBqUXVlcnkuZGVwYXJhbS5xdWVyeXN0cmluZwogIC8vIAogIC8vIFBhcnNlIHRoZSBxdWVyeSBzdHJpbmcgZnJvbSBhIFVSTCBvciB0aGUgY3VycmVudCB3aW5kb3cubG9jYXRpb24uaHJlZiwKICAvLyBkZXNlcmlhbGl6aW5nIGl0IGludG8gYW4gb2JqZWN0LCBvcHRpb25hbGx5IGNvZXJjaW5nIG51bWJlcnMsIGJvb2xlYW5zLAogIC8vIG51bGwgYW5kIHVuZGVmaW5lZCB2YWx1ZXMuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkuZGVwYXJhbS5xdWVyeXN0cmluZyggWyB1cmwgXSBbLCBjb2VyY2UgXSApOwogIC8vIAogIC8vIEFyZ3VtZW50czoKICAvLyAKICAvLyAgdXJsIC0gKFN0cmluZykgQW4gb3B0aW9uYWwgcGFyYW1zIHN0cmluZyBvciBVUkwgY29udGFpbmluZyBxdWVyeSBzdHJpbmcKICAvLyAgICBwYXJhbXMgdG8gYmUgcGFyc2VkLiBJZiB1cmwgaXMgb21pdHRlZCwgdGhlIGN1cnJlbnQKICAvLyAgICB3aW5kb3cubG9jYXRpb24uaHJlZiBpcyB1c2VkLgogIC8vICBjb2VyY2UgLSAoQm9vbGVhbikgSWYgdHJ1ZSwgY29lcmNlcyBhbnkgbnVtYmVycyBvciB0cnVlLCBmYWxzZSwgbnVsbCwgYW5kCiAgLy8gICAgdW5kZWZpbmVkIHRvIHRoZWlyIGFjdHVhbCB2YWx1ZS4gRGVmYXVsdHMgdG8gZmFsc2UgaWYgb21pdHRlZC4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICAoT2JqZWN0KSBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBkZXNlcmlhbGl6ZWQgcGFyYW1zIHN0cmluZy4KICAKICAvLyBNZXRob2Q6IGpRdWVyeS5kZXBhcmFtLmZyYWdtZW50CiAgLy8gCiAgLy8gUGFyc2UgdGhlIGZyYWdtZW50IChoYXNoKSBmcm9tIGEgVVJMIG9yIHRoZSBjdXJyZW50IHdpbmRvdy5sb2NhdGlvbi5ocmVmLAogIC8vIGRlc2VyaWFsaXppbmcgaXQgaW50byBhbiBvYmplY3QsIG9wdGlvbmFsbHkgY29lcmNpbmcgbnVtYmVycywgYm9vbGVhbnMsCiAgLy8gbnVsbCBhbmQgdW5kZWZpbmVkIHZhbHVlcy4KICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyA+IGpRdWVyeS5kZXBhcmFtLmZyYWdtZW50KCBbIHVybCBdIFssIGNvZXJjZSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICB1cmwgLSAoU3RyaW5nKSBBbiBvcHRpb25hbCBwYXJhbXMgc3RyaW5nIG9yIFVSTCBjb250YWluaW5nIGZyYWdtZW50IChoYXNoKQogIC8vICAgIHBhcmFtcyB0byBiZSBwYXJzZWQuIElmIHVybCBpcyBvbWl0dGVkLCB0aGUgY3VycmVudCB3aW5kb3cubG9jYXRpb24uaHJlZgogIC8vICAgIGlzIHVzZWQuCiAgLy8gIGNvZXJjZSAtIChCb29sZWFuKSBJZiB0cnVlLCBjb2VyY2VzIGFueSBudW1iZXJzIG9yIHRydWUsIGZhbHNlLCBudWxsLCBhbmQKICAvLyAgICB1bmRlZmluZWQgdG8gdGhlaXIgYWN0dWFsIHZhbHVlLiBEZWZhdWx0cyB0byBmYWxzZSBpZiBvbWl0dGVkLgogIC8vIAogIC8vIFJldHVybnM6CiAgLy8gCiAgLy8gIChPYmplY3QpIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGRlc2VyaWFsaXplZCBwYXJhbXMgc3RyaW5nLgogIAogIGZ1bmN0aW9uIGpxX2RlcGFyYW1fc3ViKCBpc19mcmFnbWVudCwgdXJsX29yX3BhcmFtcywgY29lcmNlICkgewogICAgaWYgKCB1cmxfb3JfcGFyYW1zID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIHVybF9vcl9wYXJhbXMgPT09ICdib29sZWFuJyApIHsKICAgICAgLy8gdXJsX29yX3BhcmFtcyBub3Qgc3BlY2lmaWVkLgogICAgICBjb2VyY2UgPSB1cmxfb3JfcGFyYW1zOwogICAgICB1cmxfb3JfcGFyYW1zID0ganFfcGFyYW1bIGlzX2ZyYWdtZW50ID8gc3RyX2ZyYWdtZW50IDogc3RyX3F1ZXJ5c3RyaW5nIF0oKTsKICAgIH0gZWxzZSB7CiAgICAgIHVybF9vcl9wYXJhbXMgPSBpc19zdHJpbmcoIHVybF9vcl9wYXJhbXMgKQogICAgICAgID8gdXJsX29yX3BhcmFtcy5yZXBsYWNlKCBpc19mcmFnbWVudCA/IHJlX3BhcmFtc19mcmFnbWVudCA6IHJlX3BhcmFtc19xdWVyeXN0cmluZywgJycgKQogICAgICAgIDogdXJsX29yX3BhcmFtczsKICAgIH0KICAgIAogICAgcmV0dXJuIGpxX2RlcGFyYW0oIHVybF9vcl9wYXJhbXMsIGNvZXJjZSApOwogIH07CiAgCiAganFfZGVwYXJhbVsgc3RyX3F1ZXJ5c3RyaW5nIF0gICAgICAgICAgICAgICAgICAgID0gY3VycnkoIGpxX2RlcGFyYW1fc3ViLCAwICk7CiAganFfZGVwYXJhbVsgc3RyX2ZyYWdtZW50IF0gPSBqcV9kZXBhcmFtX2ZyYWdtZW50ID0gY3VycnkoIGpxX2RlcGFyYW1fc3ViLCAxICk7CiAgCiAgLy8gU2VjdGlvbjogRWxlbWVudCBtYW5pcHVsYXRpb24KICAvLyAKICAvLyBNZXRob2Q6IGpRdWVyeS5lbGVtVXJsQXR0cgogIC8vIAogIC8vIEdldCB0aGUgaW50ZXJuYWwgIkRlZmF1bHQgVVJMIGF0dHJpYnV0ZSBwZXIgdGFnIiBsaXN0LCBvciBhdWdtZW50IHRoZSBsaXN0CiAgLy8gd2l0aCBhZGRpdGlvbmFsIHRhZy1hdHRyaWJ1dGUgcGFpcnMsIGluIGNhc2UgdGhlIGRlZmF1bHRzIGFyZSBpbnN1ZmZpY2llbnQuCiAgLy8gCiAgLy8gSW4gdGhlIDxqUXVlcnkuZm4ucXVlcnlzdHJpbmc+IGFuZCA8alF1ZXJ5LmZuLmZyYWdtZW50PiBtZXRob2RzLCB0aGlzIGxpc3QKICAvLyBpcyB1c2VkIHRvIGRldGVybWluZSB3aGljaCBhdHRyaWJ1dGUgY29udGFpbnMgdGhlIFVSTCB0byBiZSBtb2RpZmllZCwgaWYKICAvLyBhbiAiYXR0ciIgcGFyYW0gaXMgbm90IHNwZWNpZmllZC4KICAvLyAKICAvLyBEZWZhdWx0IFRhZy1BdHRyaWJ1dGUgTGlzdDoKICAvLyAKICAvLyAgYSAgICAgIC0gaHJlZgogIC8vICBiYXNlICAgLSBocmVmCiAgLy8gIGlmcmFtZSAtIHNyYwogIC8vICBpbWcgICAgLSBzcmMKICAvLyAgaW5wdXQgIC0gc3JjCiAgLy8gIGZvcm0gICAtIGFjdGlvbgogIC8vICBsaW5rICAgLSBocmVmCiAgLy8gIHNjcmlwdCAtIHNyYwogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5LmVsZW1VcmxBdHRyKCBbIHRhZ19hdHRyIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIHRhZ19hdHRyIC0gKE9iamVjdCkgQW4gb2JqZWN0IGNvbnRhaW5pbmcgYSBsaXN0IG9mIHRhZyBuYW1lcyBhbmQgdGhlaXIKICAvLyAgICBhc3NvY2lhdGVkIGRlZmF1bHQgYXR0cmlidXRlIG5hbWVzIGluIHRoZSBmb3JtYXQgeyB0YWc6ICdhdHRyJywgLi4uIH0gdG8KICAvLyAgICBiZSBtZXJnZWQgaW50byB0aGUgaW50ZXJuYWwgdGFnLWF0dHJpYnV0ZSBsaXN0LgogIC8vIAogIC8vIFJldHVybnM6CiAgLy8gCiAgLy8gIChPYmplY3QpIEFuIG9iamVjdCBjb250YWluaW5nIGFsbCBzdG9yZWQgdGFnLWF0dHJpYnV0ZSB2YWx1ZXMuCiAgCiAgLy8gT25seSBkZWZpbmUgZnVuY3Rpb24gYW5kIHNldCBkZWZhdWx0cyBpZiBmdW5jdGlvbiBkb2Vzbid0IGFscmVhZHkgZXhpc3QsIGFzCiAgLy8gdGhlIHVybEludGVybmFsIHBsdWdpbiB3aWxsIHByb3ZpZGUgdGhpcyBtZXRob2QgYXMgd2VsbC4KICAkWyBzdHJfZWxlbVVybEF0dHIgXSB8fCAoJFsgc3RyX2VsZW1VcmxBdHRyIF0gPSBmdW5jdGlvbiggb2JqICkgewogICAgcmV0dXJuICQuZXh0ZW5kKCBlbGVtVXJsQXR0cl9jYWNoZSwgb2JqICk7CiAgfSkoewogICAgYTogc3RyX2hyZWYsCiAgICBiYXNlOiBzdHJfaHJlZiwKICAgIGlmcmFtZTogc3RyX3NyYywKICAgIGltZzogc3RyX3NyYywKICAgIGlucHV0OiBzdHJfc3JjLAogICAgZm9ybTogJ2FjdGlvbicsCiAgICBsaW5rOiBzdHJfaHJlZiwKICAgIHNjcmlwdDogc3RyX3NyYwogIH0pOwogIAogIGpxX2VsZW1VcmxBdHRyID0gJFsgc3RyX2VsZW1VcmxBdHRyIF07CiAgCiAgLy8gTWV0aG9kOiBqUXVlcnkuZm4ucXVlcnlzdHJpbmcKICAvLyAKICAvLyBVcGRhdGUgVVJMIGF0dHJpYnV0ZSBpbiBvbmUgb3IgbW9yZSBlbGVtZW50cywgbWVyZ2luZyB0aGUgY3VycmVudCBVUkwgKHdpdGgKICAvLyBvciB3aXRob3V0IHByZS1leGlzdGluZyBxdWVyeSBzdHJpbmcgcGFyYW1zKSBwbHVzIGFueSBwYXJhbXMgb2JqZWN0IG9yCiAgLy8gc3RyaW5nIGludG8gYSBuZXcgVVJMLCB3aGljaCBpcyB0aGVuIHNldCBpbnRvIHRoYXQgYXR0cmlidXRlLiBMaWtlCiAgLy8gPGpRdWVyeS5wYXJhbS5xdWVyeXN0cmluZyAoYnVpbGQgdXJsKT4sIGJ1dCBmb3IgYWxsIGVsZW1lbnRzIGluIGEgalF1ZXJ5CiAgLy8gY29sbGVjdGlvbi4KICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyA+IGpRdWVyeSgnc2VsZWN0b3InKS5xdWVyeXN0cmluZyggWyBhdHRyLCBdIHBhcmFtcyBbLCBtZXJnZV9tb2RlIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIGF0dHIgLSAoU3RyaW5nKSBPcHRpb25hbCBuYW1lIG9mIGFuIGF0dHJpYnV0ZSB0aGF0IHdpbGwgY29udGFpbiBhIFVSTCB0bwogIC8vICAgIG1lcmdlIHBhcmFtcyBvciB1cmwgaW50by4gU2VlIDxqUXVlcnkuZWxlbVVybEF0dHI+IGZvciBhIGxpc3Qgb2YgZGVmYXVsdAogIC8vICAgIGF0dHJpYnV0ZXMuCiAgLy8gIHBhcmFtcyAtIChPYmplY3QpIEEgcGFyYW1zIG9iamVjdCB0byBiZSBtZXJnZWQgaW50byB0aGUgVVJMIGF0dHJpYnV0ZS4KICAvLyAgcGFyYW1zIC0gKFN0cmluZykgQSBVUkwgY29udGFpbmluZyBxdWVyeSBzdHJpbmcgcGFyYW1zLCBvciBwYXJhbXMgc3RyaW5nCiAgLy8gICAgdG8gYmUgbWVyZ2VkIGludG8gdGhlIFVSTCBhdHRyaWJ1dGUuCiAgLy8gIG1lcmdlX21vZGUgLSAoTnVtYmVyKSBNZXJnZSBiZWhhdmlvciBkZWZhdWx0cyB0byAwIGlmIG1lcmdlX21vZGUgaXMgbm90CiAgLy8gICAgc3BlY2lmaWVkLCBhbmQgaXMgYXMtZm9sbG93czoKICAvLyAgICAKICAvLyAgICAqIDA6IHBhcmFtcyBpbiB0aGUgcGFyYW1zIGFyZ3VtZW50IHdpbGwgb3ZlcnJpZGUgYW55IHBhcmFtcyBpbiBhdHRyIFVSTC4KICAvLyAgICAqIDE6IGFueSBwYXJhbXMgaW4gYXR0ciBVUkwgd2lsbCBvdmVycmlkZSBwYXJhbXMgaW4gdGhlIHBhcmFtcyBhcmd1bWVudC4KICAvLyAgICAqIDI6IHBhcmFtcyBhcmd1bWVudCB3aWxsIGNvbXBsZXRlbHkgcmVwbGFjZSBhbnkgcXVlcnkgc3RyaW5nIGluIGF0dHIKICAvLyAgICAgICAgIFVSTC4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICAoalF1ZXJ5KSBUaGUgaW5pdGlhbCBqUXVlcnkgY29sbGVjdGlvbiBvZiBlbGVtZW50cywgYnV0IHdpdGggbW9kaWZpZWQgVVJMCiAgLy8gIGF0dHJpYnV0ZSB2YWx1ZXMuCiAgCiAgLy8gTWV0aG9kOiBqUXVlcnkuZm4uZnJhZ21lbnQKICAvLyAKICAvLyBVcGRhdGUgVVJMIGF0dHJpYnV0ZSBpbiBvbmUgb3IgbW9yZSBlbGVtZW50cywgbWVyZ2luZyB0aGUgY3VycmVudCBVUkwgKHdpdGgKICAvLyBvciB3aXRob3V0IHByZS1leGlzdGluZyBmcmFnbWVudC9oYXNoIHBhcmFtcykgcGx1cyBhbnkgcGFyYW1zIG9iamVjdCBvcgogIC8vIHN0cmluZyBpbnRvIGEgbmV3IFVSTCwgd2hpY2ggaXMgdGhlbiBzZXQgaW50byB0aGF0IGF0dHJpYnV0ZS4gTGlrZQogIC8vIDxqUXVlcnkucGFyYW0uZnJhZ21lbnQgKGJ1aWxkIHVybCk+LCBidXQgZm9yIGFsbCBlbGVtZW50cyBpbiBhIGpRdWVyeQogIC8vIGNvbGxlY3Rpb24uCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkoJ3NlbGVjdG9yJykuZnJhZ21lbnQoIFsgYXR0ciwgXSBwYXJhbXMgWywgbWVyZ2VfbW9kZSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICBhdHRyIC0gKFN0cmluZykgT3B0aW9uYWwgbmFtZSBvZiBhbiBhdHRyaWJ1dGUgdGhhdCB3aWxsIGNvbnRhaW4gYSBVUkwgdG8KICAvLyAgICBtZXJnZSBwYXJhbXMgaW50by4gU2VlIDxqUXVlcnkuZWxlbVVybEF0dHI+IGZvciBhIGxpc3Qgb2YgZGVmYXVsdAogIC8vICAgIGF0dHJpYnV0ZXMuCiAgLy8gIHBhcmFtcyAtIChPYmplY3QpIEEgcGFyYW1zIG9iamVjdCB0byBiZSBtZXJnZWQgaW50byB0aGUgVVJMIGF0dHJpYnV0ZS4KICAvLyAgcGFyYW1zIC0gKFN0cmluZykgQSBVUkwgY29udGFpbmluZyBmcmFnbWVudCAoaGFzaCkgcGFyYW1zLCBvciBwYXJhbXMKICAvLyAgICBzdHJpbmcgdG8gYmUgbWVyZ2VkIGludG8gdGhlIFVSTCBhdHRyaWJ1dGUuCiAgLy8gIG1lcmdlX21vZGUgLSAoTnVtYmVyKSBNZXJnZSBiZWhhdmlvciBkZWZhdWx0cyB0byAwIGlmIG1lcmdlX21vZGUgaXMgbm90CiAgLy8gICAgc3BlY2lmaWVkLCBhbmQgaXMgYXMtZm9sbG93czoKICAvLyAgICAKICAvLyAgICAqIDA6IHBhcmFtcyBpbiB0aGUgcGFyYW1zIGFyZ3VtZW50IHdpbGwgb3ZlcnJpZGUgYW55IHBhcmFtcyBpbiBhdHRyIFVSTC4KICAvLyAgICAqIDE6IGFueSBwYXJhbXMgaW4gYXR0ciBVUkwgd2lsbCBvdmVycmlkZSBwYXJhbXMgaW4gdGhlIHBhcmFtcyBhcmd1bWVudC4KICAvLyAgICAqIDI6IHBhcmFtcyBhcmd1bWVudCB3aWxsIGNvbXBsZXRlbHkgcmVwbGFjZSBhbnkgZnJhZ21lbnQgKGhhc2gpIGluIGF0dHIKICAvLyAgICAgICAgIFVSTC4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICAoalF1ZXJ5KSBUaGUgaW5pdGlhbCBqUXVlcnkgY29sbGVjdGlvbiBvZiBlbGVtZW50cywgYnV0IHdpdGggbW9kaWZpZWQgVVJMCiAgLy8gIGF0dHJpYnV0ZSB2YWx1ZXMuCiAgCiAgZnVuY3Rpb24ganFfZm5fc3ViKCBtb2RlLCBmb3JjZV9hdHRyLCBwYXJhbXMsIG1lcmdlX21vZGUgKSB7CiAgICBpZiAoICFpc19zdHJpbmcoIHBhcmFtcyApICYmIHR5cGVvZiBwYXJhbXMgIT09ICdvYmplY3QnICkgewogICAgICAvLyBmb3JjZV9hdHRyIG5vdCBzcGVjaWZpZWQuCiAgICAgIG1lcmdlX21vZGUgPSBwYXJhbXM7CiAgICAgIHBhcmFtcyA9IGZvcmNlX2F0dHI7CiAgICAgIGZvcmNlX2F0dHIgPSB1bmRlZmluZWQ7CiAgICB9CiAgICAKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsKICAgICAgdmFyIHRoYXQgPSAkKHRoaXMpLAogICAgICAgIAogICAgICAgIC8vIEdldCBhdHRyaWJ1dGUgc3BlY2lmaWVkLCBvciBkZWZhdWx0IHNwZWNpZmllZCB2aWEgJC5lbGVtVXJsQXR0ci4KICAgICAgICBhdHRyID0gZm9yY2VfYXR0ciB8fCBqcV9lbGVtVXJsQXR0cigpWyAoIHRoaXMubm9kZU5hbWUgfHwgJycgKS50b0xvd2VyQ2FzZSgpIF0gfHwgJycsCiAgICAgICAgCiAgICAgICAgLy8gR2V0IFVSTCB2YWx1ZS4KICAgICAgICB1cmwgPSBhdHRyICYmIHRoYXQuYXR0ciggYXR0ciApIHx8ICcnOwogICAgICAKICAgICAgLy8gVXBkYXRlIGF0dHJpYnV0ZSB3aXRoIG5ldyBVUkwuCiAgICAgIHRoYXQuYXR0ciggYXR0ciwganFfcGFyYW1bIG1vZGUgXSggdXJsLCBwYXJhbXMsIG1lcmdlX21vZGUgKSApOwogICAgfSk7CiAgICAKICB9OwogIAogICQuZm5bIHN0cl9xdWVyeXN0cmluZyBdID0gY3VycnkoIGpxX2ZuX3N1Yiwgc3RyX3F1ZXJ5c3RyaW5nICk7CiAgJC5mblsgc3RyX2ZyYWdtZW50IF0gICAgPSBjdXJyeSgganFfZm5fc3ViLCBzdHJfZnJhZ21lbnQgKTsKICAKICAvLyBTZWN0aW9uOiBIaXN0b3J5LCBoYXNoY2hhbmdlIGV2ZW50CiAgLy8gCiAgLy8gTWV0aG9kOiBqUXVlcnkuYmJxLnB1c2hTdGF0ZQogIC8vIAogIC8vIEFkZHMgYSAnc3RhdGUnIGludG8gdGhlIGJyb3dzZXIgaGlzdG9yeSBhdCB0aGUgY3VycmVudCBwb3NpdGlvbiwgc2V0dGluZwogIC8vIGxvY2F0aW9uLmhhc2ggYW5kIHRyaWdnZXJpbmcgYW55IGJvdW5kIDxoYXNoY2hhbmdlIGV2ZW50PiBjYWxsYmFja3MKICAvLyAocHJvdmlkZWQgdGhlIG5ldyBzdGF0ZSBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgcHJldmlvdXMgc3RhdGUpLgogIC8vIAogIC8vIElmIG5vIGFyZ3VtZW50cyBhcmUgcGFzc2VkLCBhbiBlbXB0eSBzdGF0ZSBpcyBjcmVhdGVkLCB3aGljaCBpcyBqdXN0IGEKICAvLyBzaG9ydGN1dCBmb3IgalF1ZXJ5LmJicS5wdXNoU3RhdGUoIHt9LCAyICkuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkuYmJxLnB1c2hTdGF0ZSggWyBwYXJhbXMgWywgbWVyZ2VfbW9kZSBdIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIHBhcmFtcyAtIChTdHJpbmcpIEEgc2VyaWFsaXplZCBwYXJhbXMgc3RyaW5nIG9yIGEgaGFzaCBzdHJpbmcgYmVnaW5uaW5nCiAgLy8gICAgd2l0aCAjIHRvIG1lcmdlIGludG8gbG9jYXRpb24uaGFzaC4KICAvLyAgcGFyYW1zIC0gKE9iamVjdCkgQSBwYXJhbXMgb2JqZWN0IHRvIG1lcmdlIGludG8gbG9jYXRpb24uaGFzaC4KICAvLyAgbWVyZ2VfbW9kZSAtIChOdW1iZXIpIE1lcmdlIGJlaGF2aW9yIGRlZmF1bHRzIHRvIDAgaWYgbWVyZ2VfbW9kZSBpcyBub3QKICAvLyAgICBzcGVjaWZpZWQgKHVubGVzcyBhIGhhc2ggc3RyaW5nIGJlZ2lubmluZyB3aXRoICMgaXMgc3BlY2lmaWVkLCBpbiB3aGljaAogIC8vICAgIGNhc2UgbWVyZ2UgYmVoYXZpb3IgZGVmYXVsdHMgdG8gMiksIGFuZCBpcyBhcy1mb2xsb3dzOgogIC8vIAogIC8vICAgICogMDogcGFyYW1zIGluIHRoZSBwYXJhbXMgYXJndW1lbnQgd2lsbCBvdmVycmlkZSBhbnkgcGFyYW1zIGluIHRoZQogIC8vICAgICAgICAgY3VycmVudCBzdGF0ZS4KICAvLyAgICAqIDE6IGFueSBwYXJhbXMgaW4gdGhlIGN1cnJlbnQgc3RhdGUgd2lsbCBvdmVycmlkZSBwYXJhbXMgaW4gdGhlIHBhcmFtcwogIC8vICAgICAgICAgYXJndW1lbnQuCiAgLy8gICAgKiAyOiBwYXJhbXMgYXJndW1lbnQgd2lsbCBjb21wbGV0ZWx5IHJlcGxhY2UgY3VycmVudCBzdGF0ZS4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICBOb3RoaW5nLgogIC8vIAogIC8vIEFkZGl0aW9uYWwgTm90ZXM6CiAgLy8gCiAgLy8gICogU2V0dGluZyBhbiBlbXB0eSBzdGF0ZSBtYXkgY2F1c2UgdGhlIGJyb3dzZXIgdG8gc2Nyb2xsLgogIC8vICAqIFVubGlrZSB0aGUgZnJhZ21lbnQgYW5kIHF1ZXJ5c3RyaW5nIG1ldGhvZHMsIGlmIGEgaGFzaCBzdHJpbmcgYmVnaW5uaW5nCiAgLy8gICAgd2l0aCAjIGlzIHNwZWNpZmllZCBhcyB0aGUgcGFyYW1zIGFncnVtZW50LCBtZXJnZV9tb2RlIGRlZmF1bHRzIHRvIDIuCiAgCiAganFfYmJxLnB1c2hTdGF0ZSA9IGpxX2JicV9wdXNoU3RhdGUgPSBmdW5jdGlvbiggcGFyYW1zLCBtZXJnZV9tb2RlICkgewogICAgaWYgKCBpc19zdHJpbmcoIHBhcmFtcyApICYmIC9eIy8udGVzdCggcGFyYW1zICkgJiYgbWVyZ2VfbW9kZSA9PT0gdW5kZWZpbmVkICkgewogICAgICAvLyBQYXJhbXMgc3RyaW5nIGJlZ2lucyB3aXRoICMgYW5kIG1lcmdlX21vZGUgbm90IHNwZWNpZmllZCwgc28gY29tcGxldGVseQogICAgICAvLyBvdmVyd3JpdGUgd2luZG93LmxvY2F0aW9uLmhhc2guCiAgICAgIG1lcmdlX21vZGUgPSAyOwogICAgfQogICAgCiAgICB2YXIgaGFzX2FyZ3MgPSBwYXJhbXMgIT09IHVuZGVmaW5lZCwKICAgICAgLy8gTWVyZ2UgcGFyYW1zIGludG8gd2luZG93LmxvY2F0aW9uIHVzaW5nICQucGFyYW0uZnJhZ21lbnQuCiAgICAgIHVybCA9IGpxX3BhcmFtX2ZyYWdtZW50KCBsb2NhdGlvbi5ocmVmLAogICAgICAgIGhhc19hcmdzID8gcGFyYW1zIDoge30sIGhhc19hcmdzID8gbWVyZ2VfbW9kZSA6IDIgKTsKICAgIAogICAgLy8gU2V0IG5ldyB3aW5kb3cubG9jYXRpb24uaHJlZi4gTm90ZSB0aGF0IFNhZmFyaSAzICYgQ2hyb21lIGJhcmYgb24KICAgIC8vIGxvY2F0aW9uLmhhc2ggPSAnIycgc28gdGhlIGVudGlyZSBVUkwgaXMgc2V0LgogICAgbG9jYXRpb24uaHJlZiA9IHVybDsKICB9OwogIAogIC8vIE1ldGhvZDogalF1ZXJ5LmJicS5nZXRTdGF0ZQogIC8vIAogIC8vIFJldHJpZXZlcyB0aGUgY3VycmVudCAnc3RhdGUnIGZyb20gdGhlIGJyb3dzZXIgaGlzdG9yeSwgcGFyc2luZwogIC8vIGxvY2F0aW9uLmhhc2ggZm9yIGEgc3BlY2lmaWMga2V5IG9yIHJldHVybmluZyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUKICAvLyBlbnRpcmUgc3RhdGUsIG9wdGlvbmFsbHkgY29lcmNpbmcgbnVtYmVycywgYm9vbGVhbnMsIG51bGwgYW5kIHVuZGVmaW5lZAogIC8vIHZhbHVlcy4KICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyA+IGpRdWVyeS5iYnEuZ2V0U3RhdGUoIFsga2V5IF0gWywgY29lcmNlIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIGtleSAtIChTdHJpbmcpIEFuIG9wdGlvbmFsIHN0YXRlIGtleSBmb3Igd2hpY2ggdG8gcmV0dXJuIGEgdmFsdWUuCiAgLy8gIGNvZXJjZSAtIChCb29sZWFuKSBJZiB0cnVlLCBjb2VyY2VzIGFueSBudW1iZXJzIG9yIHRydWUsIGZhbHNlLCBudWxsLCBhbmQKICAvLyAgICB1bmRlZmluZWQgdG8gdGhlaXIgYWN0dWFsIHZhbHVlLiBEZWZhdWx0cyB0byBmYWxzZS4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICAoQW55dGhpbmcpIElmIGtleSBpcyBwYXNzZWQsIHJldHVybnMgdGhlIHZhbHVlIGNvcnJlc3BvbmRpbmcgd2l0aCB0aGF0IGtleQogIC8vICAgIGluIHRoZSBsb2NhdGlvbi5oYXNoICdzdGF0ZScsIG9yIHVuZGVmaW5lZC4gSWYgbm90LCBhbiBvYmplY3QKICAvLyAgICByZXByZXNlbnRpbmcgdGhlIGVudGlyZSAnc3RhdGUnIGlzIHJldHVybmVkLgogIAogIGpxX2JicS5nZXRTdGF0ZSA9IGpxX2JicV9nZXRTdGF0ZSA9IGZ1bmN0aW9uKCBrZXksIGNvZXJjZSApIHsKICAgIHJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2Yga2V5ID09PSAnYm9vbGVhbicKICAgICAgPyBqcV9kZXBhcmFtX2ZyYWdtZW50KCBrZXkgKSAvLyAna2V5JyByZWFsbHkgbWVhbnMgJ2NvZXJjZScgaGVyZQogICAgICA6IGpxX2RlcGFyYW1fZnJhZ21lbnQoIGNvZXJjZSApWyBrZXkgXTsKICB9OwogIAogIC8vIE1ldGhvZDogalF1ZXJ5LmJicS5yZW1vdmVTdGF0ZQogIC8vIAogIC8vIFJlbW92ZSBvbmUgb3IgbW9yZSBrZXlzIGZyb20gdGhlIGN1cnJlbnQgYnJvd3NlciBoaXN0b3J5ICdzdGF0ZScsIGNyZWF0aW5nCiAgLy8gYSBuZXcgc3RhdGUsIHNldHRpbmcgbG9jYXRpb24uaGFzaCBhbmQgdHJpZ2dlcmluZyBhbnkgYm91bmQKICAvLyA8aGFzaGNoYW5nZSBldmVudD4gY2FsbGJhY2tzIChwcm92aWRlZCB0aGUgbmV3IHN0YXRlIGlzIGRpZmZlcmVudCB0aGFuCiAgLy8gdGhlIHByZXZpb3VzIHN0YXRlKS4KICAvLyAKICAvLyBJZiBubyBhcmd1bWVudHMgYXJlIHBhc3NlZCwgYW4gZW1wdHkgc3RhdGUgaXMgY3JlYXRlZCwgd2hpY2ggaXMganVzdCBhCiAgLy8gc2hvcnRjdXQgZm9yIGpRdWVyeS5iYnEucHVzaFN0YXRlKCB7fSwgMiApLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5LmJicS5yZW1vdmVTdGF0ZSggWyBrZXkgWywga2V5IC4uLiBdIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIGtleSAtIChTdHJpbmcpIE9uZSBvciBtb3JlIGtleSB2YWx1ZXMgdG8gcmVtb3ZlIGZyb20gdGhlIGN1cnJlbnQgc3RhdGUsCiAgLy8gICAgcGFzc2VkIGFzIGluZGl2aWR1YWwgYXJndW1lbnRzLgogIC8vICBrZXkgLSAoQXJyYXkpIEEgc2luZ2xlIGFycmF5IGFyZ3VtZW50IHRoYXQgY29udGFpbnMgYSBsaXN0IG9mIGtleSB2YWx1ZXMKICAvLyAgICB0byByZW1vdmUgZnJvbSB0aGUgY3VycmVudCBzdGF0ZS4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICBOb3RoaW5nLgogIC8vIAogIC8vIEFkZGl0aW9uYWwgTm90ZXM6CiAgLy8gCiAgLy8gICogU2V0dGluZyBhbiBlbXB0eSBzdGF0ZSBtYXkgY2F1c2UgdGhlIGJyb3dzZXIgdG8gc2Nyb2xsLgogIAogIGpxX2JicS5yZW1vdmVTdGF0ZSA9IGZ1bmN0aW9uKCBhcnIgKSB7CiAgICB2YXIgc3RhdGUgPSB7fTsKICAgIAogICAgLy8gSWYgb25lIG9yIG1vcmUgYXJndW1lbnRzIGlzIHBhc3NlZC4uCiAgICBpZiAoIGFyciAhPT0gdW5kZWZpbmVkICkgewogICAgICAKICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IHN0YXRlLgogICAgICBzdGF0ZSA9IGpxX2JicV9nZXRTdGF0ZSgpOwogICAgICAKICAgICAgLy8gRm9yIGVhY2ggcGFzc2VkIGtleSwgZGVsZXRlIHRoZSBjb3JyZXNwb25kaW5nIHByb3BlcnR5IGZyb20gdGhlIGN1cnJlbnQKICAgICAgLy8gc3RhdGUuCiAgICAgICQuZWFjaCggJC5pc0FycmF5KCBhcnIgKSA/IGFyciA6IGFyZ3VtZW50cywgZnVuY3Rpb24oaSx2KXsKICAgICAgICBkZWxldGUgc3RhdGVbIHYgXTsKICAgICAgfSk7CiAgICB9CiAgICAKICAgIC8vIFNldCB0aGUgc3RhdGUsIGNvbXBsZXRlbHkgb3ZlcnJpZGluZyBhbnkgZXhpc3Rpbmcgc3RhdGUuCiAgICBqcV9iYnFfcHVzaFN0YXRlKCBzdGF0ZSwgMiApOwogIH07CiAgCiAgLy8gRXZlbnQ6IGhhc2hjaGFuZ2UgZXZlbnQgKEJCUSkKICAvLyAKICAvLyBVc2FnZSBpbiBqUXVlcnkgMS40IGFuZCBuZXdlcjoKICAvLyAKICAvLyBJbiBqUXVlcnkgMS40IGFuZCBuZXdlciwgdGhlIGV2ZW50IG9iamVjdCBwYXNzZWQgaW50byBhbnkgaGFzaGNoYW5nZSBldmVudAogIC8vIGNhbGxiYWNrIGlzIGF1Z21lbnRlZCB3aXRoIGEgY29weSBvZiB0aGUgbG9jYXRpb24uaGFzaCBmcmFnbWVudCBhdCB0aGUgdGltZQogIC8vIHRoZSBldmVudCB3YXMgdHJpZ2dlcmVkIGFzIGl0cyBldmVudC5mcmFnbWVudCBwcm9wZXJ0eS4gSW4gYWRkaXRpb24sIHRoZQogIC8vIGV2ZW50LmdldFN0YXRlIG1ldGhvZCBvcGVyYXRlcyBvbiB0aGlzIHByb3BlcnR5IChpbnN0ZWFkIG9mIGxvY2F0aW9uLmhhc2gpCiAgLy8gd2hpY2ggYWxsb3dzIHRoaXMgZnJhZ21lbnQtYXMtYS1zdGF0ZSB0byBiZSByZWZlcmVuY2VkIGxhdGVyLCBldmVuIGFmdGVyCiAgLy8gd2luZG93LmxvY2F0aW9uIG1heSBoYXZlIGNoYW5nZWQuCiAgLy8gCiAgLy8gTm90ZSB0aGF0IGV2ZW50LmZyYWdtZW50IGFuZCBldmVudC5nZXRTdGF0ZSBhcmUgbm90IGRlZmluZWQgYWNjb3JkaW5nIHRvCiAgLy8gVzNDIChvciBhbnkgb3RoZXIpIHNwZWNpZmljYXRpb24sIGJ1dCB3aWxsIHN0aWxsIGJlIGF2YWlsYWJsZSB3aGV0aGVyIG9yCiAgLy8gbm90IHRoZSBoYXNoY2hhbmdlIGV2ZW50IGV4aXN0cyBuYXRpdmVseSBpbiB0aGUgYnJvd3NlciwgYmVjYXVzZSBvZiB0aGUKICAvLyB1dGlsaXR5IHRoZXkgcHJvdmlkZS4KICAvLyAKICAvLyBUaGUgZXZlbnQuZnJhZ21lbnQgcHJvcGVydHkgY29udGFpbnMgdGhlIG91dHB1dCBvZiA8alF1ZXJ5LnBhcmFtLmZyYWdtZW50PgogIC8vIGFuZCB0aGUgZXZlbnQuZ2V0U3RhdGUgbWV0aG9kIGlzIGVxdWl2YWxlbnQgdG8gdGhlIDxqUXVlcnkuYmJxLmdldFN0YXRlPgogIC8vIG1ldGhvZC4KICAvLyAKICAvLyA+ICQod2luZG93KS5iaW5kKCAnaGFzaGNoYW5nZScsIGZ1bmN0aW9uKCBldmVudCApIHsKICAvLyA+ICAgdmFyIGhhc2hfc3RyID0gZXZlbnQuZnJhZ21lbnQsCiAgLy8gPiAgICAgcGFyYW1fb2JqID0gZXZlbnQuZ2V0U3RhdGUoKSwKICAvLyA+ICAgICBwYXJhbV92YWwgPSBldmVudC5nZXRTdGF0ZSggJ3BhcmFtX25hbWUnICksCiAgLy8gPiAgICAgcGFyYW1fdmFsX2NvZXJjZWQgPSBldmVudC5nZXRTdGF0ZSggJ3BhcmFtX25hbWUnLCB0cnVlICk7CiAgLy8gPiAgIC4uLgogIC8vID4gfSk7CiAgLy8gCiAgLy8gVXNhZ2UgaW4galF1ZXJ5IDEuMy4yOgogIC8vIAogIC8vIEluIGpRdWVyeSAxLjMuMiwgdGhlIGV2ZW50IG9iamVjdCBjYW5ub3QgdG8gYmUgYXVnbWVudGVkIGFzIGluIGpRdWVyeSAxLjQrLAogIC8vIHNvIHRoZSBmcmFnbWVudCBzdGF0ZSBpc24ndCBib3VuZCB0byB0aGUgZXZlbnQgb2JqZWN0IGFuZCBtdXN0IGluc3RlYWQgYmUKICAvLyBwYXJzZWQgdXNpbmcgdGhlIDxqUXVlcnkucGFyYW0uZnJhZ21lbnQ+IGFuZCA8alF1ZXJ5LmJicS5nZXRTdGF0ZT4gbWV0aG9kcy4KICAvLyAKICAvLyA+ICQod2luZG93KS5iaW5kKCAnaGFzaGNoYW5nZScsIGZ1bmN0aW9uKCBldmVudCApIHsKICAvLyA+ICAgdmFyIGhhc2hfc3RyID0gJC5wYXJhbS5mcmFnbWVudCgpLAogIC8vID4gICAgIHBhcmFtX29iaiA9ICQuYmJxLmdldFN0YXRlKCksCiAgLy8gPiAgICAgcGFyYW1fdmFsID0gJC5iYnEuZ2V0U3RhdGUoICdwYXJhbV9uYW1lJyApLAogIC8vID4gICAgIHBhcmFtX3ZhbF9jb2VyY2VkID0gJC5iYnEuZ2V0U3RhdGUoICdwYXJhbV9uYW1lJywgdHJ1ZSApOwogIC8vID4gICAuLi4KICAvLyA+IH0pOwogIC8vIAogIC8vIEFkZGl0aW9uYWwgTm90ZXM6CiAgLy8gCiAgLy8gKiBEdWUgdG8gY2hhbmdlcyBpbiB0aGUgc3BlY2lhbCBldmVudHMgQVBJLCBqUXVlcnkgQkJRIHYxLjIgb3IgbmV3ZXIgaXMKICAvLyAgIHJlcXVpcmVkIHRvIGVuYWJsZSB0aGUgYXVnbWVudGVkIGV2ZW50IG9iamVjdCBpbiBqUXVlcnkgMS40LjIgYW5kIG5ld2VyLgogIC8vICogU2VlIDxqUXVlcnkgaGFzaGNoYW5nZSBldmVudD4gZm9yIG1vcmUgZGV0YWlsZWQgaW5mb3JtYXRpb24uCiAgCiAgc3BlY2lhbFsgc3RyX2hhc2hjaGFuZ2UgXSA9ICQuZXh0ZW5kKCBzcGVjaWFsWyBzdHJfaGFzaGNoYW5nZSBdLCB7CiAgICAKICAgIC8vIEF1Z21lbnRpbmcgdGhlIGV2ZW50IG9iamVjdCB3aXRoIHRoZSAuZnJhZ21lbnQgcHJvcGVydHkgYW5kIC5nZXRTdGF0ZQogICAgLy8gbWV0aG9kIHJlcXVpcmVzIGpRdWVyeSAxLjQgb3IgbmV3ZXIuIE5vdGU6IHdpdGggMS4zLjIsIGV2ZXJ5dGhpbmcgd2lsbAogICAgLy8gd29yaywgYnV0IHRoZSBldmVudCB3b24ndCBiZSBhdWdtZW50ZWQpCiAgICBhZGQ6IGZ1bmN0aW9uKCBoYW5kbGVPYmogKSB7CiAgICAgIHZhciBvbGRfaGFuZGxlcjsKICAgICAgCiAgICAgIGZ1bmN0aW9uIG5ld19oYW5kbGVyKGUpIHsKICAgICAgICAvLyBlLmZyYWdtZW50IGlzIHNldCB0byB0aGUgdmFsdWUgb2YgbG9jYXRpb24uaGFzaCAod2l0aCBhbnkgbGVhZGluZyAjCiAgICAgICAgLy8gcmVtb3ZlZCkgYXQgdGhlIHRpbWUgdGhlIGV2ZW50IGlzIHRyaWdnZXJlZC4KICAgICAgICB2YXIgaGFzaCA9IGVbIHN0cl9mcmFnbWVudCBdID0ganFfcGFyYW1fZnJhZ21lbnQoKTsKICAgICAgICAKICAgICAgICAvLyBlLmdldFN0YXRlKCkgd29ya3MganVzdCBsaWtlICQuYmJxLmdldFN0YXRlKCksIGJ1dCB1c2VzIHRoZQogICAgICAgIC8vIGUuZnJhZ21lbnQgcHJvcGVydHkgc3RvcmVkIG9uIHRoZSBldmVudCBvYmplY3QuCiAgICAgICAgZS5nZXRTdGF0ZSA9IGZ1bmN0aW9uKCBrZXksIGNvZXJjZSApIHsKICAgICAgICAgIHJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2Yga2V5ID09PSAnYm9vbGVhbicKICAgICAgICAgICAgPyBqcV9kZXBhcmFtKCBoYXNoLCBrZXkgKSAvLyAna2V5JyByZWFsbHkgbWVhbnMgJ2NvZXJjZScgaGVyZQogICAgICAgICAgICA6IGpxX2RlcGFyYW0oIGhhc2gsIGNvZXJjZSApWyBrZXkgXTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIG9sZF9oYW5kbGVyLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKICAgICAgfTsKICAgICAgCiAgICAgIC8vIFRoaXMgbWF5IHNlZW0gYSBsaXR0bGUgY29tcGxpY2F0ZWQsIGJ1dCBpdCBub3JtYWxpemVzIHRoZSBzcGVjaWFsIGV2ZW50CiAgICAgIC8vIC5hZGQgbWV0aG9kIGJldHdlZW4galF1ZXJ5IDEuNC8xLjQuMSBhbmQgMS40LjIrCiAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBoYW5kbGVPYmogKSApIHsKICAgICAgICAvLyAxLjQsIDEuNC4xCiAgICAgICAgb2xkX2hhbmRsZXIgPSBoYW5kbGVPYmo7CiAgICAgICAgcmV0dXJuIG5ld19oYW5kbGVyOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIDEuNC4yKwogICAgICAgIG9sZF9oYW5kbGVyID0gaGFuZGxlT2JqLmhhbmRsZXI7CiAgICAgICAgaGFuZGxlT2JqLmhhbmRsZXIgPSBuZXdfaGFuZGxlcjsKICAgICAgfQogICAgfQogICAgCiAgfSk7CiAgCn0pKGpRdWVyeSx0aGlzKTsKCi8qIQogKiBqUXVlcnkgaGFzaGNoYW5nZSBldmVudCAtIHYxLjMgLSA3LzIxLzIwMTAKICogaHR0cDovL2JlbmFsbWFuLmNvbS9wcm9qZWN0cy9qcXVlcnktaGFzaGNoYW5nZS1wbHVnaW4vCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTAgIkNvd2JveSIgQmVuIEFsbWFuCiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBhbmQgR1BMIGxpY2Vuc2VzLgogKiBodHRwOi8vYmVuYWxtYW4uY29tL2Fib3V0L2xpY2Vuc2UvCiAqLwoKLy8gU2NyaXB0OiBqUXVlcnkgaGFzaGNoYW5nZSBldmVudAovLwovLyAqVmVyc2lvbjogMS4zLCBMYXN0IHVwZGF0ZWQ6IDcvMjEvMjAxMCoKLy8gCi8vIFByb2plY3QgSG9tZSAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UtcGx1Z2luLwovLyBHaXRIdWIgICAgICAgLSBodHRwOi8vZ2l0aHViLmNvbS9jb3dib3kvanF1ZXJ5LWhhc2hjaGFuZ2UvCi8vIFNvdXJjZSAgICAgICAtIGh0dHA6Ly9naXRodWIuY29tL2Nvd2JveS9qcXVlcnktaGFzaGNoYW5nZS9yYXcvbWFzdGVyL2pxdWVyeS5iYS1oYXNoY2hhbmdlLmpzCi8vIChNaW5pZmllZCkgICAtIGh0dHA6Ly9naXRodWIuY29tL2Nvd2JveS9qcXVlcnktaGFzaGNoYW5nZS9yYXcvbWFzdGVyL2pxdWVyeS5iYS1oYXNoY2hhbmdlLm1pbi5qcyAoMC44a2IgZ3ppcHBlZCkKLy8gCi8vIEFib3V0OiBMaWNlbnNlCi8vIAovLyBDb3B5cmlnaHQgKGMpIDIwMTAgIkNvd2JveSIgQmVuIEFsbWFuLAovLyBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlcy4KLy8gaHR0cDovL2JlbmFsbWFuLmNvbS9hYm91dC9saWNlbnNlLwovLyAKLy8gQWJvdXQ6IEV4YW1wbGVzCi8vIAovLyBUaGVzZSB3b3JraW5nIGV4YW1wbGVzLCBjb21wbGV0ZSB3aXRoIGZ1bGx5IGNvbW1lbnRlZCBjb2RlLCBpbGx1c3RyYXRlIGEgZmV3Ci8vIHdheXMgaW4gd2hpY2ggdGhpcyBwbHVnaW4gY2FuIGJlIHVzZWQuCi8vIAovLyBoYXNoY2hhbmdlIGV2ZW50IC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlL2V4YW1wbGVzL2hhc2hjaGFuZ2UvCi8vIGRvY3VtZW50LmRvbWFpbiAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktaGFzaGNoYW5nZS9leGFtcGxlcy9kb2N1bWVudF9kb21haW4vCi8vIAovLyBBYm91dDogU3VwcG9ydCBhbmQgVGVzdGluZwovLyAKLy8gSW5mb3JtYXRpb24gYWJvdXQgd2hhdCB2ZXJzaW9uIG9yIHZlcnNpb25zIG9mIGpRdWVyeSB0aGlzIHBsdWdpbiBoYXMgYmVlbgovLyB0ZXN0ZWQgd2l0aCwgd2hhdCBicm93c2VycyBpdCBoYXMgYmVlbiB0ZXN0ZWQgaW4sIGFuZCB3aGVyZSB0aGUgdW5pdCB0ZXN0cwovLyByZXNpZGUgKHNvIHlvdSBjYW4gdGVzdCBpdCB5b3Vyc2VsZikuCi8vIAovLyBqUXVlcnkgVmVyc2lvbnMgLSAxLjIuNiwgMS4zLjIsIDEuNC4xLCAxLjQuMgovLyBCcm93c2VycyBUZXN0ZWQgLSBJbnRlcm5ldCBFeHBsb3JlciA2LTgsIEZpcmVmb3ggMi00LCBDaHJvbWUgNS02LCBTYWZhcmkgMy4yLTUsCi8vICAgICAgICAgICAgICAgICAgIE9wZXJhIDkuNi0xMC42MCwgaVBob25lIDMuMSwgQW5kcm9pZCAxLjYtMi4yLCBCbGFja0JlcnJ5IDQuNi01LgovLyBVbml0IFRlc3RzICAgICAgLSBodHRwOi8vYmVuYWxtYW4uY29tL2NvZGUvcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UvdW5pdC8KLy8gCi8vIEFib3V0OiBLbm93biBpc3N1ZXMKLy8gCi8vIFdoaWxlIHRoaXMgalF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQgaW1wbGVtZW50YXRpb24gaXMgcXVpdGUgc3RhYmxlIGFuZAovLyByb2J1c3QsIHRoZXJlIGFyZSBhIGZldyB1bmZvcnR1bmF0ZSBicm93c2VyIGJ1Z3Mgc3Vycm91bmRpbmcgZXhwZWN0ZWQKLy8gaGFzaGNoYW5nZSBldmVudC1iYXNlZCBiZWhhdmlvcnMsIGluZGVwZW5kZW50IG9mIGFueSBKYXZhU2NyaXB0Ci8vIHdpbmRvdy5vbmhhc2hjaGFuZ2UgYWJzdHJhY3Rpb24uIFNlZSB0aGUgZm9sbG93aW5nIGV4YW1wbGVzIGZvciBtb3JlCi8vIGluZm9ybWF0aW9uOgovLyAKLy8gQ2hyb21lOiBCYWNrIEJ1dHRvbiAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktaGFzaGNoYW5nZS9leGFtcGxlcy9idWctY2hyb21lLWJhY2stYnV0dG9uLwovLyBGaXJlZm94OiBSZW1vdGUgWE1MSHR0cFJlcXVlc3QgLSBodHRwOi8vYmVuYWxtYW4uY29tL2NvZGUvcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UvZXhhbXBsZXMvYnVnLWZpcmVmb3gtcmVtb3RlLXhoci8KLy8gV2ViS2l0OiBCYWNrIEJ1dHRvbiBpbiBhbiBJZnJhbWUgLSBodHRwOi8vYmVuYWxtYW4uY29tL2NvZGUvcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UvZXhhbXBsZXMvYnVnLXdlYmtpdC1oYXNoLWlmcmFtZS8KLy8gU2FmYXJpOiBCYWNrIEJ1dHRvbiBmcm9tIGEgZGlmZmVyZW50IGRvbWFpbiAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktaGFzaGNoYW5nZS9leGFtcGxlcy9idWctc2FmYXJpLWJhY2stZnJvbS1kaWZmLWRvbWFpbi8KLy8gCi8vIEFsc28gbm90ZSB0aGF0IHNob3VsZCBhIGJyb3dzZXIgbmF0aXZlbHkgc3VwcG9ydCB0aGUgd2luZG93Lm9uaGFzaGNoYW5nZSAKLy8gZXZlbnQsIGJ1dCBub3QgcmVwb3J0IHRoYXQgaXQgZG9lcywgdGhlIGZhbGxiYWNrIHBvbGxpbmcgbG9vcCB3aWxsIGJlIHVzZWQuCi8vIAovLyBBYm91dDogUmVsZWFzZSBIaXN0b3J5Ci8vIAovLyAxLjMgICAtICg3LzIxLzIwMTApIFJlb3JnYW5pemVkIElFNi83IElmcmFtZSBjb2RlIHRvIG1ha2UgaXQgbW9yZQovLyAgICAgICAgICJyZW1vdmFibGUiIGZvciBtb2JpbGUtb25seSBkZXZlbG9wbWVudC4gQWRkZWQgSUU2LzcgZG9jdW1lbnQudGl0bGUKLy8gICAgICAgICBzdXBwb3J0LiBBdHRlbXB0ZWQgdG8gbWFrZSBJZnJhbWUgYXMgaGlkZGVuIGFzIHBvc3NpYmxlIGJ5IHVzaW5nCi8vICAgICAgICAgdGVjaG5pcXVlcyBmcm9tIGh0dHA6Ly93d3cucGFjaWVsbG9ncm91cC5jb20vYmxvZy8/cD02MDQuIEFkZGVkIAovLyAgICAgICAgIHN1cHBvcnQgZm9yIHRoZSAic2hvcnRjdXQiIGZvcm1hdCAkKHdpbmRvdykuaGFzaGNoYW5nZSggZm4gKSBhbmQKLy8gICAgICAgICAkKHdpbmRvdykuaGFzaGNoYW5nZSgpIGxpa2UgalF1ZXJ5IHByb3ZpZGVzIGZvciBidWlsdC1pbiBldmVudHMuCi8vICAgICAgICAgUmVuYW1lZCBqUXVlcnkuaGFzaGNoYW5nZURlbGF5IHRvIDxqUXVlcnkuZm4uaGFzaGNoYW5nZS5kZWxheT4gYW5kCi8vICAgICAgICAgbG93ZXJlZCBpdHMgZGVmYXVsdCB2YWx1ZSB0byA1MC4gQWRkZWQgPGpRdWVyeS5mbi5oYXNoY2hhbmdlLmRvbWFpbj4KLy8gICAgICAgICBhbmQgPGpRdWVyeS5mbi5oYXNoY2hhbmdlLnNyYz4gcHJvcGVydGllcyBwbHVzIGRvY3VtZW50LWRvbWFpbi5odG1sCi8vICAgICAgICAgZmlsZSB0byBhZGRyZXNzIGFjY2VzcyBkZW5pZWQgaXNzdWVzIHdoZW4gc2V0dGluZyBkb2N1bWVudC5kb21haW4gaW4KLy8gICAgICAgICBJRTYvNy4KLy8gMS4yICAgLSAoMi8xMS8yMDEwKSBGaXhlZCBhIGJ1ZyB3aGVyZSBjb21pbmcgYmFjayB0byBhIHBhZ2UgdXNpbmcgdGhpcyBwbHVnaW4KLy8gICAgICAgICBmcm9tIGEgcGFnZSBvbiBhbm90aGVyIGRvbWFpbiB3b3VsZCBjYXVzZSBhbiBlcnJvciBpbiBTYWZhcmkgNC4gQWxzbywKLy8gICAgICAgICBJRTYvNyBJZnJhbWUgaXMgbm93IGluc2VydGVkIGFmdGVyIHRoZSBib2R5ICh0aGlzIGFjdHVhbGx5IHdvcmtzKSwKLy8gICAgICAgICB3aGljaCBwcmV2ZW50cyB0aGUgcGFnZSBmcm9tIHNjcm9sbGluZyB3aGVuIHRoZSBldmVudCBpcyBmaXJzdCBib3VuZC4KLy8gICAgICAgICBFdmVudCBjYW4gYWxzbyBub3cgYmUgYm91bmQgYmVmb3JlIERPTSByZWFkeSwgYnV0IGl0IHdvbid0IGJlIHVzYWJsZQovLyAgICAgICAgIGJlZm9yZSB0aGVuIGluIElFNi83LgovLyAxLjEgICAtICgxLzIxLzIwMTApIEluY29ycG9yYXRlZCBkb2N1bWVudC5kb2N1bWVudE1vZGUgdGVzdCB0byBmaXggSUU4IGJ1ZwovLyAgICAgICAgIHdoZXJlIGJyb3dzZXIgdmVyc2lvbiBpcyBpbmNvcnJlY3RseSByZXBvcnRlZCBhcyA4LjAsIGRlc3BpdGUKLy8gICAgICAgICBpbmNsdXNpb24gb2YgdGhlIFgtVUEtQ29tcGF0aWJsZSBJRT1FbXVsYXRlSUU3IG1ldGEgdGFnLgovLyAxLjAgICAtICgxLzkvMjAxMCkgSW5pdGlhbCBSZWxlYXNlLiBCcm9rZSBvdXQgdGhlIGpRdWVyeSBCQlEgZXZlbnQuc3BlY2lhbAovLyAgICAgICAgIHdpbmRvdy5vbmhhc2hjaGFuZ2UgZnVuY3Rpb25hbGl0eSBpbnRvIGEgc2VwYXJhdGUgcGx1Z2luIGZvciB1c2VycwovLyAgICAgICAgIHdobyB3YW50IGp1c3QgdGhlIGJhc2ljIGV2ZW50ICYgYmFjayBidXR0b24gc3VwcG9ydCwgd2l0aG91dCBhbGwgdGhlCi8vICAgICAgICAgZXh0cmEgYXdlc29tZW5lc3MgdGhhdCBCQlEgcHJvdmlkZXMuIFRoaXMgcGx1Z2luIHdpbGwgYmUgaW5jbHVkZWQgYXMKLy8gICAgICAgICBwYXJ0IG9mIGpRdWVyeSBCQlEsIGJ1dCBhbHNvIGJlIGF2YWlsYWJsZSBzZXBhcmF0ZWx5LgoKKGZ1bmN0aW9uKCQsd2luZG93LHVuZGVmaW5lZCl7CiAgJyQ6bm9tdW5nZSc7IC8vIFVzZWQgYnkgWVVJIGNvbXByZXNzb3IuCiAgCiAgLy8gUmV1c2VkIHN0cmluZy4KICB2YXIgc3RyX2hhc2hjaGFuZ2UgPSAnaGFzaGNoYW5nZScsCiAgICAKICAgIC8vIE1ldGhvZCAvIG9iamVjdCByZWZlcmVuY2VzLgogICAgZG9jID0gZG9jdW1lbnQsCiAgICBmYWtlX29uaGFzaGNoYW5nZSwKICAgIHNwZWNpYWwgPSAkLmV2ZW50LnNwZWNpYWwsCiAgICAKICAgIC8vIERvZXMgdGhlIGJyb3dzZXIgc3VwcG9ydCB3aW5kb3cub25oYXNoY2hhbmdlPyBOb3RlIHRoYXQgSUU4IHJ1bm5pbmcgaW4KICAgIC8vIElFNyBjb21wYXRpYmlsaXR5IG1vZGUgcmVwb3J0cyB0cnVlIGZvciAnb25oYXNoY2hhbmdlJyBpbiB3aW5kb3csIGV2ZW4KICAgIC8vIHRob3VnaCB0aGUgZXZlbnQgaXNuJ3Qgc3VwcG9ydGVkLCBzbyBhbHNvIHRlc3QgZG9jdW1lbnQuZG9jdW1lbnRNb2RlLgogICAgZG9jX21vZGUgPSBkb2MuZG9jdW1lbnRNb2RlLAogICAgc3VwcG9ydHNfb25oYXNoY2hhbmdlID0gJ29uJyArIHN0cl9oYXNoY2hhbmdlIGluIHdpbmRvdyAmJiAoIGRvY19tb2RlID09PSB1bmRlZmluZWQgfHwgZG9jX21vZGUgPiA3ICk7CiAgCiAgLy8gR2V0IGxvY2F0aW9uLmhhc2ggKG9yIHdoYXQgeW91J2QgZXhwZWN0IGxvY2F0aW9uLmhhc2ggdG8gYmUpIHNhbnMgYW55CiAgLy8gbGVhZGluZyAjLiBUaGFua3MgZm9yIG1ha2luZyB0aGlzIG5lY2Vzc2FyeSwgRmlyZWZveCEKICBmdW5jdGlvbiBnZXRfZnJhZ21lbnQoIHVybCApIHsKICAgIHVybCA9IHVybCB8fCBsb2NhdGlvbi5ocmVmOwogICAgcmV0dXJuICcjJyArIHVybC5yZXBsYWNlKCAvXlteI10qIz8oLiopJC8sICckMScgKTsKICB9OwogIAogIC8vIE1ldGhvZDogalF1ZXJ5LmZuLmhhc2hjaGFuZ2UKICAvLyAKICAvLyBCaW5kIGEgaGFuZGxlciB0byB0aGUgd2luZG93Lm9uaGFzaGNoYW5nZSBldmVudCBvciB0cmlnZ2VyIGFsbCBib3VuZAogIC8vIHdpbmRvdy5vbmhhc2hjaGFuZ2UgZXZlbnQgaGFuZGxlcnMuIFRoaXMgYmVoYXZpb3IgaXMgY29uc2lzdGVudCB3aXRoCiAgLy8galF1ZXJ5J3MgYnVpbHQtaW4gZXZlbnQgaGFuZGxlcnMuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkod2luZG93KS5oYXNoY2hhbmdlKCBbIGhhbmRsZXIgXSApOwogIC8vIAogIC8vIEFyZ3VtZW50czoKICAvLyAKICAvLyAgaGFuZGxlciAtIChGdW5jdGlvbikgT3B0aW9uYWwgaGFuZGxlciB0byBiZSBib3VuZCB0byB0aGUgaGFzaGNoYW5nZQogIC8vICAgIGV2ZW50LiBUaGlzIGlzIGEgInNob3J0Y3V0IiBmb3IgdGhlIG1vcmUgdmVyYm9zZSBmb3JtOgogIC8vICAgIGpRdWVyeSh3aW5kb3cpLmJpbmQoICdoYXNoY2hhbmdlJywgaGFuZGxlciApLiBJZiBoYW5kbGVyIGlzIG9taXR0ZWQsCiAgLy8gICAgYWxsIGJvdW5kIHdpbmRvdy5vbmhhc2hjaGFuZ2UgZXZlbnQgaGFuZGxlcnMgd2lsbCBiZSB0cmlnZ2VyZWQuIFRoaXMKICAvLyAgICBpcyBhIHNob3J0Y3V0IGZvciB0aGUgbW9yZSB2ZXJib3NlCiAgLy8gICAgalF1ZXJ5KHdpbmRvdykudHJpZ2dlciggJ2hhc2hjaGFuZ2UnICkuIFRoZXNlIGZvcm1zIGFyZSBkZXNjcmliZWQgaW4KICAvLyAgICB0aGUgPGhhc2hjaGFuZ2UgZXZlbnQ+IHNlY3Rpb24uCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKGpRdWVyeSkgVGhlIGluaXRpYWwgalF1ZXJ5IGNvbGxlY3Rpb24gb2YgZWxlbWVudHMuCiAgCiAgLy8gQWxsb3cgdGhlICJzaG9ydGN1dCIgZm9ybWF0ICQoZWxlbSkuaGFzaGNoYW5nZSggZm4gKSBmb3IgYmluZGluZyBhbmQKICAvLyAkKGVsZW0pLmhhc2hjaGFuZ2UoKSBmb3IgdHJpZ2dlcmluZywgbGlrZSBqUXVlcnkgZG9lcyBmb3IgYnVpbHQtaW4gZXZlbnRzLgogICQuZm5bIHN0cl9oYXNoY2hhbmdlIF0gPSBmdW5jdGlvbiggZm4gKSB7CiAgICByZXR1cm4gZm4gPyB0aGlzLmJpbmQoIHN0cl9oYXNoY2hhbmdlLCBmbiApIDogdGhpcy50cmlnZ2VyKCBzdHJfaGFzaGNoYW5nZSApOwogIH07CiAgCiAgLy8gUHJvcGVydHk6IGpRdWVyeS5mbi5oYXNoY2hhbmdlLmRlbGF5CiAgLy8gCiAgLy8gVGhlIG51bWVyaWMgaW50ZXJ2YWwgKGluIG1pbGxpc2Vjb25kcykgYXQgd2hpY2ggdGhlIDxoYXNoY2hhbmdlIGV2ZW50PgogIC8vIHBvbGxpbmcgbG9vcCBleGVjdXRlcy4gRGVmYXVsdHMgdG8gNTAuCiAgCiAgLy8gUHJvcGVydHk6IGpRdWVyeS5mbi5oYXNoY2hhbmdlLmRvbWFpbgogIC8vIAogIC8vIElmIHlvdSdyZSBzZXR0aW5nIGRvY3VtZW50LmRvbWFpbiBpbiB5b3VyIEphdmFTY3JpcHQsIGFuZCB5b3Ugd2FudCBoYXNoCiAgLy8gaGlzdG9yeSB0byB3b3JrIGluIElFNi83LCBub3Qgb25seSBtdXN0IHRoaXMgcHJvcGVydHkgYmUgc2V0LCBidXQgeW91IG11c3QKICAvLyBhbHNvIHNldCBkb2N1bWVudC5kb21haW4gQkVGT1JFIGpRdWVyeSBpcyBsb2FkZWQgaW50byB0aGUgcGFnZS4gVGhpcwogIC8vIHByb3BlcnR5IGlzIG9ubHkgYXBwbGljYWJsZSBpZiB5b3UgYXJlIHN1cHBvcnRpbmcgSUU2LzcgKG9yIElFOCBvcGVyYXRpbmcKICAvLyBpbiAiSUU3IGNvbXBhdGliaWxpdHkiIG1vZGUpLgogIC8vIAogIC8vIEluIGFkZGl0aW9uLCB0aGUgPGpRdWVyeS5mbi5oYXNoY2hhbmdlLnNyYz4gcHJvcGVydHkgbXVzdCBiZSBzZXQgdG8gdGhlCiAgLy8gcGF0aCBvZiB0aGUgaW5jbHVkZWQgImRvY3VtZW50LWRvbWFpbi5odG1sIiBmaWxlLCB3aGljaCBjYW4gYmUgcmVuYW1lZCBvcgogIC8vIG1vZGlmaWVkIGlmIG5lY2Vzc2FyeSAobm90ZSB0aGF0IHRoZSBkb2N1bWVudC5kb21haW4gc3BlY2lmaWVkIG11c3QgYmUgdGhlCiAgLy8gc2FtZSBpbiBib3RoIHlvdXIgbWFpbiBKYXZhU2NyaXB0IGFzIHdlbGwgYXMgaW4gdGhpcyBmaWxlKS4KICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyBqUXVlcnkuZm4uaGFzaGNoYW5nZS5kb21haW4gPSBkb2N1bWVudC5kb21haW47CiAgCiAgLy8gUHJvcGVydHk6IGpRdWVyeS5mbi5oYXNoY2hhbmdlLnNyYwogIC8vIAogIC8vIElmLCBmb3Igc29tZSByZWFzb24sIHlvdSBuZWVkIHRvIHNwZWNpZnkgYW4gSWZyYW1lIHNyYyBmaWxlIChmb3IgZXhhbXBsZSwKICAvLyB3aGVuIHNldHRpbmcgZG9jdW1lbnQuZG9tYWluIGFzIGluIDxqUXVlcnkuZm4uaGFzaGNoYW5nZS5kb21haW4+KSwgeW91IGNhbgogIC8vIGRvIHNvIHVzaW5nIHRoaXMgcHJvcGVydHkuIE5vdGUgdGhhdCB3aGVuIHVzaW5nIHRoaXMgcHJvcGVydHksIGhpc3RvcnkKICAvLyB3b24ndCBiZSByZWNvcmRlZCBpbiBJRTYvNyB1bnRpbCB0aGUgSWZyYW1lIHNyYyBmaWxlIGxvYWRzLiBUaGlzIHByb3BlcnR5CiAgLy8gaXMgb25seSBhcHBsaWNhYmxlIGlmIHlvdSBhcmUgc3VwcG9ydGluZyBJRTYvNyAob3IgSUU4IG9wZXJhdGluZyBpbiAiSUU3CiAgLy8gY29tcGF0aWJpbGl0eSIgbW9kZSkuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8galF1ZXJ5LmZuLmhhc2hjaGFuZ2Uuc3JjID0gJ3BhdGgvdG8vZmlsZS5odG1sJzsKICAKICAkLmZuWyBzdHJfaGFzaGNoYW5nZSBdLmRlbGF5ID0gNTA7CiAgLyoKICAkLmZuWyBzdHJfaGFzaGNoYW5nZSBdLmRvbWFpbiA9IG51bGw7CiAgJC5mblsgc3RyX2hhc2hjaGFuZ2UgXS5zcmMgPSBudWxsOwogICovCiAgCiAgLy8gRXZlbnQ6IGhhc2hjaGFuZ2UgZXZlbnQKICAvLyAKICAvLyBGaXJlZCB3aGVuIGxvY2F0aW9uLmhhc2ggY2hhbmdlcy4gSW4gYnJvd3NlcnMgdGhhdCBzdXBwb3J0IGl0LCB0aGUgbmF0aXZlCiAgLy8gSFRNTDUgd2luZG93Lm9uaGFzaGNoYW5nZSBldmVudCBpcyB1c2VkLCBvdGhlcndpc2UgYSBwb2xsaW5nIGxvb3AgaXMKICAvLyBpbml0aWFsaXplZCwgcnVubmluZyBldmVyeSA8alF1ZXJ5LmZuLmhhc2hjaGFuZ2UuZGVsYXk+IG1pbGxpc2Vjb25kcyB0bwogIC8vIHNlZSBpZiB0aGUgaGFzaCBoYXMgY2hhbmdlZC4gSW4gSUU2LzcgKGFuZCBJRTggb3BlcmF0aW5nIGluICJJRTcKICAvLyBjb21wYXRpYmlsaXR5IiBtb2RlKSwgYSBoaWRkZW4gSWZyYW1lIGlzIGNyZWF0ZWQgdG8gYWxsb3cgdGhlIGJhY2sgYnV0dG9uCiAgLy8gYW5kIGhhc2gtYmFzZWQgaGlzdG9yeSB0byB3b3JrLgogIC8vIAogIC8vIFVzYWdlIGFzIGRlc2NyaWJlZCBpbiA8alF1ZXJ5LmZuLmhhc2hjaGFuZ2U+OgogIC8vIAogIC8vID4gLy8gQmluZCBhbiBldmVudCBoYW5kbGVyLgogIC8vID4galF1ZXJ5KHdpbmRvdykuaGFzaGNoYW5nZSggZnVuY3Rpb24oZSkgewogIC8vID4gICB2YXIgaGFzaCA9IGxvY2F0aW9uLmhhc2g7CiAgLy8gPiAgIC4uLgogIC8vID4gfSk7CiAgLy8gPiAKICAvLyA+IC8vIE1hbnVhbGx5IHRyaWdnZXIgdGhlIGV2ZW50IGhhbmRsZXIuCiAgLy8gPiBqUXVlcnkod2luZG93KS5oYXNoY2hhbmdlKCk7CiAgLy8gCiAgLy8gQSBtb3JlIHZlcmJvc2UgdXNhZ2UgdGhhdCBhbGxvd3MgZm9yIGV2ZW50IG5hbWVzcGFjaW5nOgogIC8vIAogIC8vID4gLy8gQmluZCBhbiBldmVudCBoYW5kbGVyLgogIC8vID4galF1ZXJ5KHdpbmRvdykuYmluZCggJ2hhc2hjaGFuZ2UnLCBmdW5jdGlvbihlKSB7CiAgLy8gPiAgIHZhciBoYXNoID0gbG9jYXRpb24uaGFzaDsKICAvLyA+ICAgLi4uCiAgLy8gPiB9KTsKICAvLyA+IAogIC8vID4gLy8gTWFudWFsbHkgdHJpZ2dlciB0aGUgZXZlbnQgaGFuZGxlci4KICAvLyA+IGpRdWVyeSh3aW5kb3cpLnRyaWdnZXIoICdoYXNoY2hhbmdlJyApOwogIC8vIAogIC8vIEFkZGl0aW9uYWwgTm90ZXM6CiAgLy8gCiAgLy8gKiBUaGUgcG9sbGluZyBsb29wIGFuZCBJZnJhbWUgYXJlIG5vdCBjcmVhdGVkIHVudGlsIGF0IGxlYXN0IG9uZSBoYW5kbGVyCiAgLy8gICBpcyBhY3R1YWxseSBib3VuZCB0byB0aGUgJ2hhc2hjaGFuZ2UnIGV2ZW50LgogIC8vICogSWYgeW91IG5lZWQgdGhlIGJvdW5kIGhhbmRsZXIocykgdG8gZXhlY3V0ZSBpbW1lZGlhdGVseSwgaW4gY2FzZXMgd2hlcmUKICAvLyAgIGEgbG9jYXRpb24uaGFzaCBleGlzdHMgb24gcGFnZSBsb2FkLCB2aWEgYm9va21hcmsgb3IgcGFnZSByZWZyZXNoIGZvcgogIC8vICAgZXhhbXBsZSwgdXNlIGpRdWVyeSh3aW5kb3cpLmhhc2hjaGFuZ2UoKSBvciB0aGUgbW9yZSB2ZXJib3NlIAogIC8vICAgalF1ZXJ5KHdpbmRvdykudHJpZ2dlciggJ2hhc2hjaGFuZ2UnICkuCiAgLy8gKiBUaGUgZXZlbnQgY2FuIGJlIGJvdW5kIGJlZm9yZSBET00gcmVhZHksIGJ1dCBzaW5jZSBpdCB3b24ndCBiZSB1c2FibGUKICAvLyAgIGJlZm9yZSB0aGVuIGluIElFNi83IChkdWUgdG8gdGhlIG5lY2Vzc2FyeSBJZnJhbWUpLCByZWNvbW1lbmRlZCB1c2FnZSBpcwogIC8vICAgdG8gYmluZCBpdCBpbnNpZGUgYSBET00gcmVhZHkgaGFuZGxlci4KICAKICAvLyBPdmVycmlkZSBleGlzdGluZyAkLmV2ZW50LnNwZWNpYWwuaGFzaGNoYW5nZSBtZXRob2RzIChhbGxvd2luZyB0aGlzIHBsdWdpbgogIC8vIHRvIGJlIGRlZmluZWQgYWZ0ZXIgalF1ZXJ5IEJCUSBpbiBCQlEncyBzb3VyY2UgY29kZSkuCiAgc3BlY2lhbFsgc3RyX2hhc2hjaGFuZ2UgXSA9ICQuZXh0ZW5kKCBzcGVjaWFsWyBzdHJfaGFzaGNoYW5nZSBdLCB7CiAgICAKICAgIC8vIENhbGxlZCBvbmx5IHdoZW4gdGhlIGZpcnN0ICdoYXNoY2hhbmdlJyBldmVudCBpcyBib3VuZCB0byB3aW5kb3cuCiAgICBzZXR1cDogZnVuY3Rpb24oKSB7CiAgICAgIC8vIElmIHdpbmRvdy5vbmhhc2hjaGFuZ2UgaXMgc3VwcG9ydGVkIG5hdGl2ZWx5LCB0aGVyZSdzIG5vdGhpbmcgdG8gZG8uLgogICAgICBpZiAoIHN1cHBvcnRzX29uaGFzaGNoYW5nZSApIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgIAogICAgICAvLyBPdGhlcndpc2UsIHdlIG5lZWQgdG8gY3JlYXRlIG91ciBvd24uIEFuZCB3ZSBkb24ndCB3YW50IHRvIGNhbGwgdGhpcwogICAgICAvLyB1bnRpbCB0aGUgdXNlciBiaW5kcyB0byB0aGUgZXZlbnQsIGp1c3QgaW4gY2FzZSB0aGV5IG5ldmVyIGRvLCBzaW5jZSBpdAogICAgICAvLyB3aWxsIGNyZWF0ZSBhIHBvbGxpbmcgbG9vcCBhbmQgcG9zc2libHkgZXZlbiBhIGhpZGRlbiBJZnJhbWUuCiAgICAgICQoIGZha2Vfb25oYXNoY2hhbmdlLnN0YXJ0ICk7CiAgICB9LAogICAgCiAgICAvLyBDYWxsZWQgb25seSB3aGVuIHRoZSBsYXN0ICdoYXNoY2hhbmdlJyBldmVudCBpcyB1bmJvdW5kIGZyb20gd2luZG93LgogICAgdGVhcmRvd246IGZ1bmN0aW9uKCkgewogICAgICAvLyBJZiB3aW5kb3cub25oYXNoY2hhbmdlIGlzIHN1cHBvcnRlZCBuYXRpdmVseSwgdGhlcmUncyBub3RoaW5nIHRvIGRvLi4KICAgICAgaWYgKCBzdXBwb3J0c19vbmhhc2hjaGFuZ2UgKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAKICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSBuZWVkIHRvIHN0b3Agb3VycyAoaWYgcG9zc2libGUpLgogICAgICAkKCBmYWtlX29uaGFzaGNoYW5nZS5zdG9wICk7CiAgICB9CiAgICAKICB9KTsKICAKICAvLyBmYWtlX29uaGFzaGNoYW5nZSBkb2VzIGFsbCB0aGUgd29yayBvZiB0cmlnZ2VyaW5nIHRoZSB3aW5kb3cub25oYXNoY2hhbmdlCiAgLy8gZXZlbnQgZm9yIGJyb3dzZXJzIHRoYXQgZG9uJ3QgbmF0aXZlbHkgc3VwcG9ydCBpdCwgaW5jbHVkaW5nIGNyZWF0aW5nIGEKICAvLyBwb2xsaW5nIGxvb3AgdG8gd2F0Y2ggZm9yIGhhc2ggY2hhbmdlcyBhbmQgaW4gSUUgNi83IGNyZWF0aW5nIGEgaGlkZGVuCiAgLy8gSWZyYW1lIHRvIGVuYWJsZSBiYWNrIGFuZCBmb3J3YXJkLgogIGZha2Vfb25oYXNoY2hhbmdlID0gKGZ1bmN0aW9uKCl7CiAgICB2YXIgc2VsZiA9IHt9LAogICAgICB0aW1lb3V0X2lkLAogICAgICAKICAgICAgLy8gUmVtZW1iZXIgdGhlIGluaXRpYWwgaGFzaCBzbyBpdCBkb2Vzbid0IGdldCB0cmlnZ2VyZWQgaW1tZWRpYXRlbHkuCiAgICAgIGxhc3RfaGFzaCA9IGdldF9mcmFnbWVudCgpLAogICAgICAKICAgICAgZm5fcmV0dmFsID0gZnVuY3Rpb24odmFsKXsgcmV0dXJuIHZhbDsgfSwKICAgICAgaGlzdG9yeV9zZXQgPSBmbl9yZXR2YWwsCiAgICAgIGhpc3RvcnlfZ2V0ID0gZm5fcmV0dmFsOwogICAgCiAgICAvLyBTdGFydCB0aGUgcG9sbGluZyBsb29wLgogICAgc2VsZi5zdGFydCA9IGZ1bmN0aW9uKCkgewogICAgICB0aW1lb3V0X2lkIHx8IHBvbGwoKTsKICAgIH07CiAgICAKICAgIC8vIFN0b3AgdGhlIHBvbGxpbmcgbG9vcC4KICAgIHNlbGYuc3RvcCA9IGZ1bmN0aW9uKCkgewogICAgICB0aW1lb3V0X2lkICYmIGNsZWFyVGltZW91dCggdGltZW91dF9pZCApOwogICAgICB0aW1lb3V0X2lkID0gdW5kZWZpbmVkOwogICAgfTsKICAgIAogICAgLy8gVGhpcyBwb2xsaW5nIGxvb3AgY2hlY2tzIGV2ZXJ5ICQuZm4uaGFzaGNoYW5nZS5kZWxheSBtaWxsaXNlY29uZHMgdG8gc2VlCiAgICAvLyBpZiBsb2NhdGlvbi5oYXNoIGhhcyBjaGFuZ2VkLCBhbmQgdHJpZ2dlcnMgdGhlICdoYXNoY2hhbmdlJyBldmVudCBvbgogICAgLy8gd2luZG93IHdoZW4gbmVjZXNzYXJ5LgogICAgZnVuY3Rpb24gcG9sbCgpIHsKICAgICAgdmFyIGhhc2ggPSBnZXRfZnJhZ21lbnQoKSwKICAgICAgICBoaXN0b3J5X2hhc2ggPSBoaXN0b3J5X2dldCggbGFzdF9oYXNoICk7CiAgICAgIAogICAgICBpZiAoIGhhc2ggIT09IGxhc3RfaGFzaCApIHsKICAgICAgICBoaXN0b3J5X3NldCggbGFzdF9oYXNoID0gaGFzaCwgaGlzdG9yeV9oYXNoICk7CiAgICAgICAgCiAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoIHN0cl9oYXNoY2hhbmdlICk7CiAgICAgICAgCiAgICAgIH0gZWxzZSBpZiAoIGhpc3RvcnlfaGFzaCAhPT0gbGFzdF9oYXNoICkgewogICAgICAgIGxvY2F0aW9uLmhyZWYgPSBsb2NhdGlvbi5ocmVmLnJlcGxhY2UoIC8jLiovLCAnJyApICsgaGlzdG9yeV9oYXNoOwogICAgICB9CiAgICAgIAogICAgICB0aW1lb3V0X2lkID0gc2V0VGltZW91dCggcG9sbCwgJC5mblsgc3RyX2hhc2hjaGFuZ2UgXS5kZWxheSApOwogICAgfTsKICAgIAogICAgLy8gdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2CiAgICAvLyB2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2IFJFTU9WRSBJRiBOT1QgU1VQUE9SVElORyBJRTYvNy84IHZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnYKICAgIC8vIHZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dgogICAgJC5icm93c2VyLm1zaWUgJiYgIXN1cHBvcnRzX29uaGFzaGNoYW5nZSAmJiAoZnVuY3Rpb24oKXsKICAgICAgLy8gTm90IG9ubHkgZG8gSUU2LzcgbmVlZCB0aGUgIm1hZ2ljYWwiIElmcmFtZSB0cmVhdG1lbnQsIGJ1dCBzbyBkb2VzIElFOAogICAgICAvLyB3aGVuIHJ1bm5pbmcgaW4gIklFNyBjb21wYXRpYmlsaXR5IiBtb2RlLgogICAgICAKICAgICAgdmFyIGlmcmFtZSwKICAgICAgICBpZnJhbWVfc3JjOwogICAgICAKICAgICAgLy8gV2hlbiB0aGUgZXZlbnQgaXMgYm91bmQgYW5kIHBvbGxpbmcgc3RhcnRzIGluIElFIDYvNywgY3JlYXRlIGEgaGlkZGVuCiAgICAgIC8vIElmcmFtZSBmb3IgaGlzdG9yeSBoYW5kbGluZy4KICAgICAgc2VsZi5zdGFydCA9IGZ1bmN0aW9uKCl7CiAgICAgICAgaWYgKCAhaWZyYW1lICkgewogICAgICAgICAgaWZyYW1lX3NyYyA9ICQuZm5bIHN0cl9oYXNoY2hhbmdlIF0uc3JjOwogICAgICAgICAgaWZyYW1lX3NyYyA9IGlmcmFtZV9zcmMgJiYgaWZyYW1lX3NyYyArIGdldF9mcmFnbWVudCgpOwogICAgICAgICAgCiAgICAgICAgICAvLyBDcmVhdGUgaGlkZGVuIElmcmFtZS4gQXR0ZW1wdCB0byBtYWtlIElmcmFtZSBhcyBoaWRkZW4gYXMgcG9zc2libGUKICAgICAgICAgIC8vIGJ5IHVzaW5nIHRlY2huaXF1ZXMgZnJvbSBodHRwOi8vd3d3LnBhY2llbGxvZ3JvdXAuY29tL2Jsb2cvP3A9NjA0LgogICAgICAgICAgaWZyYW1lID0gJCgnPGlmcmFtZSB0YWJpbmRleD0iLTEiIHRpdGxlPSJlbXB0eSIvPicpLmhpZGUoKQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gV2hlbiBJZnJhbWUgaGFzIGNvbXBsZXRlbHkgbG9hZGVkLCBpbml0aWFsaXplIHRoZSBoaXN0b3J5IGFuZAogICAgICAgICAgICAvLyBzdGFydCBwb2xsaW5nLgogICAgICAgICAgICAub25lKCAnbG9hZCcsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgaWZyYW1lX3NyYyB8fCBoaXN0b3J5X3NldCggZ2V0X2ZyYWdtZW50KCkgKTsKICAgICAgICAgICAgICBwb2xsKCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBMb2FkIElmcmFtZSBzcmMgaWYgc3BlY2lmaWVkLCBvdGhlcndpc2Ugbm90aGluZy4KICAgICAgICAgICAgLmF0dHIoICdzcmMnLCBpZnJhbWVfc3JjIHx8ICdqYXZhc2NyaXB0OjAnICkKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEFwcGVuZCBJZnJhbWUgYWZ0ZXIgdGhlIGVuZCBvZiB0aGUgYm9keSB0byBwcmV2ZW50IHVubmVjZXNzYXJ5CiAgICAgICAgICAgIC8vIGluaXRpYWwgcGFnZSBzY3JvbGxpbmcgKHllcywgdGhpcyB3b3JrcykuCiAgICAgICAgICAgIC5pbnNlcnRBZnRlciggJ2JvZHknIClbMF0uY29udGVudFdpbmRvdzsKICAgICAgICAgIAogICAgICAgICAgLy8gV2hlbmV2ZXIgYGRvY3VtZW50LnRpdGxlYCBjaGFuZ2VzLCB1cGRhdGUgdGhlIElmcmFtZSdzIHRpdGxlIHRvCiAgICAgICAgICAvLyBwcmV0dGlmeSB0aGUgYmFjay9uZXh0IGhpc3RvcnkgbWVudSBlbnRyaWVzLiBTaW5jZSBJRSBzb21ldGltZXMKICAgICAgICAgIC8vIGVycm9ycyB3aXRoICJVbnNwZWNpZmllZCBlcnJvciIgdGhlIHZlcnkgZmlyc3QgdGltZSB0aGlzIGlzIHNldAogICAgICAgICAgLy8gKHllcywgdmVyeSB1c2VmdWwpIHdyYXAgdGhpcyB3aXRoIGEgdHJ5L2NhdGNoIGJsb2NrLgogICAgICAgICAgZG9jLm9ucHJvcGVydHljaGFuZ2UgPSBmdW5jdGlvbigpewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmICggZXZlbnQucHJvcGVydHlOYW1lID09PSAndGl0bGUnICkgewogICAgICAgICAgICAgICAgaWZyYW1lLmRvY3VtZW50LnRpdGxlID0gZG9jLnRpdGxlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaChlKSB7fQogICAgICAgICAgfTsKICAgICAgICAgIAogICAgICAgIH0KICAgICAgfTsKICAgICAgCiAgICAgIC8vIE92ZXJyaWRlIHRoZSAic3RvcCIgbWV0aG9kIHNpbmNlIGFuIElFNi83IElmcmFtZSB3YXMgY3JlYXRlZC4gRXZlbgogICAgICAvLyBpZiB0aGVyZSBhcmUgbm8gbG9uZ2VyIGFueSBib3VuZCBldmVudCBoYW5kbGVycywgdGhlIHBvbGxpbmcgbG9vcAogICAgICAvLyBpcyBzdGlsbCBuZWNlc3NhcnkgZm9yIGJhY2svbmV4dCB0byB3b3JrIGF0IGFsbCEKICAgICAgc2VsZi5zdG9wID0gZm5fcmV0dmFsOwogICAgICAKICAgICAgLy8gR2V0IGhpc3RvcnkgYnkgbG9va2luZyBhdCB0aGUgaGlkZGVuIElmcmFtZSdzIGxvY2F0aW9uLmhhc2guCiAgICAgIGhpc3RvcnlfZ2V0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGdldF9mcmFnbWVudCggaWZyYW1lLmxvY2F0aW9uLmhyZWYgKTsKICAgICAgfTsKICAgICAgCiAgICAgIC8vIFNldCBhIG5ldyBoaXN0b3J5IGl0ZW0gYnkgb3BlbmluZyBhbmQgdGhlbiBjbG9zaW5nIHRoZSBJZnJhbWUKICAgICAgLy8gZG9jdW1lbnQsICp0aGVuKiBzZXR0aW5nIGl0cyBsb2NhdGlvbi5oYXNoLiBJZiBkb2N1bWVudC5kb21haW4gaGFzCiAgICAgIC8vIGJlZW4gc2V0LCB1cGRhdGUgdGhhdCBhcyB3ZWxsLgogICAgICBoaXN0b3J5X3NldCA9IGZ1bmN0aW9uKCBoYXNoLCBoaXN0b3J5X2hhc2ggKSB7CiAgICAgICAgdmFyIGlmcmFtZV9kb2MgPSBpZnJhbWUuZG9jdW1lbnQsCiAgICAgICAgICBkb21haW4gPSAkLmZuWyBzdHJfaGFzaGNoYW5nZSBdLmRvbWFpbjsKICAgICAgICAKICAgICAgICBpZiAoIGhhc2ggIT09IGhpc3RvcnlfaGFzaCApIHsKICAgICAgICAgIC8vIFVwZGF0ZSBJZnJhbWUgd2l0aCBhbnkgaW5pdGlhbCBgZG9jdW1lbnQudGl0bGVgIHRoYXQgbWlnaHQgYmUgc2V0LgogICAgICAgICAgaWZyYW1lX2RvYy50aXRsZSA9IGRvYy50aXRsZTsKICAgICAgICAgIAogICAgICAgICAgLy8gT3BlbmluZyB0aGUgSWZyYW1lJ3MgZG9jdW1lbnQgYWZ0ZXIgaXQgaGFzIGJlZW4gY2xvc2VkIGlzIHdoYXQKICAgICAgICAgIC8vIGFjdHVhbGx5IGFkZHMgYSBoaXN0b3J5IGVudHJ5LgogICAgICAgICAgaWZyYW1lX2RvYy5vcGVuKCk7CiAgICAgICAgICAKICAgICAgICAgIC8vIFNldCBkb2N1bWVudC5kb21haW4gZm9yIHRoZSBJZnJhbWUgZG9jdW1lbnQgYXMgd2VsbCwgaWYgbmVjZXNzYXJ5LgogICAgICAgICAgZG9tYWluICYmIGlmcmFtZV9kb2Mud3JpdGUoICc8c2NyaXB0PmRvY3VtZW50LmRvbWFpbj0iJyArIGRvbWFpbiArICciPC9zY3JpcHQ+JyApOwogICAgICAgICAgCiAgICAgICAgICBpZnJhbWVfZG9jLmNsb3NlKCk7CiAgICAgICAgICAKICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgSWZyYW1lJ3MgaGFzaCwgZm9yIGdyZWF0IGp1c3RpY2UuCiAgICAgICAgICBpZnJhbWUubG9jYXRpb24uaGFzaCA9IGhhc2g7CiAgICAgICAgfQogICAgICB9OwogICAgICAKICAgIH0pKCk7CiAgICAvLyBeXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl4KICAgIC8vIF5eXl5eXl5eXl5eXl5eXl5eXl4gUkVNT1ZFIElGIE5PVCBTVVBQT1JUSU5HIElFNi83LzggXl5eXl5eXl5eXl5eXl5eXl5eXgogICAgLy8gXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eCiAgICAKICAgIHJldHVybiBzZWxmOwogIH0pKCk7CiAgCn0pKGpRdWVyeSx0aGlzKTsK",
                "body": "LyohCiAqIGpRdWVyeSBCQlE6IEJhY2sgQnV0dG9uICYgUXVlcnkgTGlicmFyeSAtIHYxLjNwcmUgLSA4LzI2LzIwMTAKICogaHR0cDovL2JlbmFsbWFuLmNvbS9wcm9qZWN0cy9qcXVlcnktYmJxLXBsdWdpbi8KICogCiAqIENvcHlyaWdodCAoYykgMjAxMCAiQ293Ym95IiBCZW4gQWxtYW4KICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXMuCiAqIGh0dHA6Ly9iZW5hbG1hbi5jb20vYWJvdXQvbGljZW5zZS8KICovCgovLyBTY3JpcHQ6IGpRdWVyeSBCQlE6IEJhY2sgQnV0dG9uICYgUXVlcnkgTGlicmFyeQovLwovLyAqVmVyc2lvbjogMS4zcHJlLCBMYXN0IHVwZGF0ZWQ6IDgvMjYvMjAxMCoKLy8gCi8vIFByb2plY3QgSG9tZSAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vcHJvamVjdHMvanF1ZXJ5LWJicS1wbHVnaW4vCi8vIEdpdEh1YiAgICAgICAtIGh0dHA6Ly9naXRodWIuY29tL2Nvd2JveS9qcXVlcnktYmJxLwovLyBTb3VyY2UgICAgICAgLSBodHRwOi8vZ2l0aHViLmNvbS9jb3dib3kvanF1ZXJ5LWJicS9yYXcvbWFzdGVyL2pxdWVyeS5iYS1iYnEuanMKLy8gKE1pbmlmaWVkKSAgIC0gaHR0cDovL2dpdGh1Yi5jb20vY293Ym95L2pxdWVyeS1iYnEvcmF3L21hc3Rlci9qcXVlcnkuYmEtYmJxLm1pbi5qcyAoMi4ya2IgZ3ppcHBlZCkKLy8gCi8vIEFib3V0OiBMaWNlbnNlCi8vIAovLyBDb3B5cmlnaHQgKGMpIDIwMTAgIkNvd2JveSIgQmVuIEFsbWFuLAovLyBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlcy4KLy8gaHR0cDovL2JlbmFsbWFuLmNvbS9hYm91dC9saWNlbnNlLwovLyAKLy8gQWJvdXQ6IEV4YW1wbGVzCi8vIAovLyBUaGVzZSB3b3JraW5nIGV4YW1wbGVzLCBjb21wbGV0ZSB3aXRoIGZ1bGx5IGNvbW1lbnRlZCBjb2RlLCBpbGx1c3RyYXRlIGEgZmV3Ci8vIHdheXMgaW4gd2hpY2ggdGhpcyBwbHVnaW4gY2FuIGJlIHVzZWQuCi8vIAovLyBCYXNpYyBBSkFYICAgICAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktYmJxL2V4YW1wbGVzL2ZyYWdtZW50LWJhc2ljLwovLyBBZHZhbmNlZCBBSkFYICAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktYmJxL2V4YW1wbGVzL2ZyYWdtZW50LWFkdmFuY2VkLwovLyBqUXVlcnkgVUkgVGFicyAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktYmJxL2V4YW1wbGVzL2ZyYWdtZW50LWpxdWVyeS11aS10YWJzLwovLyBEZXBhcmFtICAgICAgICAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktYmJxL2V4YW1wbGVzL2RlcGFyYW0vCi8vIAovLyBBYm91dDogU3VwcG9ydCBhbmQgVGVzdGluZwovLyAKLy8gSW5mb3JtYXRpb24gYWJvdXQgd2hhdCB2ZXJzaW9uIG9yIHZlcnNpb25zIG9mIGpRdWVyeSB0aGlzIHBsdWdpbiBoYXMgYmVlbgovLyB0ZXN0ZWQgd2l0aCwgd2hhdCBicm93c2VycyBpdCBoYXMgYmVlbiB0ZXN0ZWQgaW4sIGFuZCB3aGVyZSB0aGUgdW5pdCB0ZXN0cwovLyByZXNpZGUgKHNvIHlvdSBjYW4gdGVzdCBpdCB5b3Vyc2VsZikuCi8vIAovLyBqUXVlcnkgVmVyc2lvbnMgLSAxLjIuNiwgMS4zLjIsIDEuNC4xLCAxLjQuMgovLyBCcm93c2VycyBUZXN0ZWQgLSBJbnRlcm5ldCBFeHBsb3JlciA2LTgsIEZpcmVmb3ggMi00LCBDaHJvbWUgNS02LCBTYWZhcmkgMy4yLTUsCi8vICAgICAgICAgICAgICAgICAgIE9wZXJhIDkuNi0xMC42MCwgaVBob25lIDMuMSwgQW5kcm9pZCAxLjYtMi4yLCBCbGFja0JlcnJ5IDQuNi01LgovLyBVbml0IFRlc3RzICAgICAgLSBodHRwOi8vYmVuYWxtYW4uY29tL2NvZGUvcHJvamVjdHMvanF1ZXJ5LWJicS91bml0LwovLyAKLy8gQWJvdXQ6IFJlbGVhc2UgSGlzdG9yeQovLyAKLy8gMS4zcHJlIC0gKDgvMjYvMjAxMCkgSW50ZWdyYXRlZCA8alF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQ+IHYxLjMsIHdoaWNoIGFkZHMKLy8gICAgICAgICBkb2N1bWVudC50aXRsZSBhbmQgZG9jdW1lbnQuZG9tYWluIHN1cHBvcnQgaW4gSUU2LzcsIEJsYWNrQmVycnkKLy8gICAgICAgICBzdXBwb3J0LCBiZXR0ZXIgSWZyYW1lIGhpZGluZyBmb3IgYWNjZXNzaWJpbGl0eSByZWFzb25zLCBhbmQgdGhlIG5ldwovLyAgICAgICAgIDxqUXVlcnkuZm4uaGFzaGNoYW5nZT4gInNob3J0Y3V0IiBtZXRob2QuIEFkZGVkIHRoZQovLyAgICAgICAgIDxqUXVlcnkucGFyYW0uc29ydGVkPiBtZXRob2Qgd2hpY2ggcmVkdWNlcyB0aGUgcG9zc2liaWxpdHkgb2YKLy8gICAgICAgICBleHRyYW5lb3VzIGhhc2hjaGFuZ2UgZXZlbnQgdHJpZ2dlcmluZy4gQWRkZWQgdGhlCi8vICAgICAgICAgPGpRdWVyeS5wYXJhbS5mcmFnbWVudC5hamF4Q3Jhd2xhYmxlPiBtZXRob2Qgd2hpY2ggY2FuIGJlIHVzZWQgdG8KLy8gICAgICAgICBlbmFibGUgR29vZ2xlICJBSkFYIENyYXdsYWJsZSBtb2RlLiIKLy8gMS4yLjEgLSAoMi8xNy8yMDEwKSBBY3R1YWxseSBmaXhlZCB0aGUgc3RhbGUgd2luZG93LmxvY2F0aW9uIFNhZmFyaSBidWcgZnJvbQovLyAgICAgICAgIDxqUXVlcnkgaGFzaGNoYW5nZSBldmVudD4gaW4gQkJRLCB3aGljaCB3YXMgdGhlIG1haW4gcmVhc29uIGZvciB0aGUKLy8gICAgICAgICBwcmV2aW91cyByZWxlYXNlIQovLyAxLjIgICAtICgyLzE2LzIwMTApIEludGVncmF0ZWQgPGpRdWVyeSBoYXNoY2hhbmdlIGV2ZW50PiB2MS4yLCB3aGljaCBmaXhlcyBhCi8vICAgICAgICAgU2FmYXJpIGJ1ZywgdGhlIGV2ZW50IGNhbiBub3cgYmUgYm91bmQgYmVmb3JlIERPTSByZWFkeSwgYW5kIElFNi83Ci8vICAgICAgICAgcGFnZSBzaG91bGQgbm8gbG9uZ2VyIHNjcm9sbCB3aGVuIHRoZSBldmVudCBpcyBmaXJzdCBib3VuZC4gQWxzbwovLyAgICAgICAgIGFkZGVkIHRoZSA8alF1ZXJ5LnBhcmFtLmZyYWdtZW50Lm5vRXNjYXBlPiBtZXRob2QsIGFuZCByZXdvcmtlZCB0aGUKLy8gICAgICAgICA8aGFzaGNoYW5nZSBldmVudCAoQkJRKT4gaW50ZXJuYWwgImFkZCIgbWV0aG9kIHRvIGJlIGNvbXBhdGlibGUgd2l0aAovLyAgICAgICAgIGNoYW5nZXMgbWFkZSB0byB0aGUgalF1ZXJ5IDEuNC4yIHNwZWNpYWwgZXZlbnRzIEFQSS4KLy8gMS4xLjEgLSAoMS8yMi8yMDEwKSBJbnRlZ3JhdGVkIDxqUXVlcnkgaGFzaGNoYW5nZSBldmVudD4gdjEuMSwgd2hpY2ggZml4ZXMgYW4KLy8gICAgICAgICBvYnNjdXJlIElFOCBFbXVsYXRlSUU3IG1ldGEgdGFnIGNvbXBhdGliaWxpdHkgbW9kZSBidWcuCi8vIDEuMSAgIC0gKDEvOS8yMDEwKSBCcm9rZSBvdXQgdGhlIGpRdWVyeSBCQlEgZXZlbnQuc3BlY2lhbCA8aGFzaGNoYW5nZSBldmVudD4KLy8gICAgICAgICBmdW5jdGlvbmFsaXR5IGludG8gYSBzZXBhcmF0ZSBwbHVnaW4gZm9yIHVzZXJzIHdobyB3YW50IGp1c3QgdGhlCi8vICAgICAgICAgYmFzaWMgZXZlbnQgJiBiYWNrIGJ1dHRvbiBzdXBwb3J0LCB3aXRob3V0IGFsbCB0aGUgZXh0cmEgYXdlc29tZW5lc3MKLy8gICAgICAgICB0aGF0IEJCUSBwcm92aWRlcy4gVGhpcyBwbHVnaW4gd2lsbCBiZSBpbmNsdWRlZCBhcyBwYXJ0IG9mIGpRdWVyeSBCQlEsCi8vICAgICAgICAgYnV0IGFsc28gYmUgYXZhaWxhYmxlIHNlcGFyYXRlbHkuIFNlZSA8alF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQ+Ci8vICAgICAgICAgcGx1Z2luIGZvciBtb3JlIGluZm9ybWF0aW9uLiBBbHNvIGFkZGVkIHRoZSA8alF1ZXJ5LmJicS5yZW1vdmVTdGF0ZT4KLy8gICAgICAgICBtZXRob2QgYW5kIGFkZGVkIGFkZGl0aW9uYWwgPGpRdWVyeS5kZXBhcmFtPiBleGFtcGxlcy4KLy8gMS4wLjMgLSAoMTIvMi8yMDA5KSBGaXhlZCBhbiBpc3N1ZSBpbiBJRSA2IHdoZXJlIGxvY2F0aW9uLnNlYXJjaCBhbmQKLy8gICAgICAgICBsb2NhdGlvbi5oYXNoIHdvdWxkIHJlcG9ydCBpbmNvcnJlY3RseSBpZiB0aGUgaGFzaCBjb250YWluZWQgdGhlID8KLy8gICAgICAgICBjaGFyYWN0ZXIuIEFsc28gPGpRdWVyeS5wYXJhbS5xdWVyeXN0cmluZz4gYW5kIDxqUXVlcnkucGFyYW0uZnJhZ21lbnQ+Ci8vICAgICAgICAgd2lsbCBubyBsb25nZXIgcGFyc2UgcGFyYW1zIG91dCBvZiBhIFVSTCB0aGF0IGRvZXNuJ3QgY29udGFpbiA/IG9yICMsCi8vICAgICAgICAgcmVzcGVjdGl2ZWx5LgovLyAxLjAuMiAtICgxMC8xMC8yMDA5KSBGaXhlZCBhbiBpc3N1ZSBpbiBJRSA2Lzcgd2hlcmUgdGhlIGhpZGRlbiBJRlJBTUUgY2F1c2VkCi8vICAgICAgICAgYSAiVGhpcyBwYWdlIGNvbnRhaW5zIGJvdGggc2VjdXJlIGFuZCBub25zZWN1cmUgaXRlbXMuIiB3YXJuaW5nIHdoZW4KLy8gICAgICAgICB1c2VkIG9uIGFuIGh0dHBzOi8vIHBhZ2UuCi8vIDEuMC4xIC0gKDEwLzcvMjAwOSkgRml4ZWQgYW4gaXNzdWUgaW4gSUUgOC4gU2luY2UgYm90aCAiSUU3IiBhbmQgIklFOAovLyAgICAgICAgIENvbXBhdGliaWxpdHkgVmlldyIgbW9kZXMgZXJyb25lb3VzbHkgcmVwb3J0IHRoYXQgdGhlIGJyb3dzZXIKLy8gICAgICAgICBzdXBwb3J0cyB0aGUgbmF0aXZlIHdpbmRvdy5vbmhhc2hjaGFuZ2UgZXZlbnQsIGEgc2xpZ2h0bHkgbW9yZQovLyAgICAgICAgIHJvYnVzdCB0ZXN0IG5lZWRlZCB0byBiZSBhZGRlZC4KLy8gMS4wICAgLSAoMTAvMi8yMDA5KSBJbml0aWFsIHJlbGVhc2UKCihmdW5jdGlvbigkLHdpbmRvdyl7CiAgJyQ6bm9tdW5nZSc7IC8vIFVzZWQgYnkgWVVJIGNvbXByZXNzb3IuCiAgCiAgLy8gU29tZSBjb252ZW5pZW50IHNob3J0Y3V0cy4KICB2YXIgdW5kZWZpbmVkLAogICAgYXBzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLAogICAgZGVjb2RlID0gZGVjb2RlVVJJQ29tcG9uZW50LAogICAgCiAgICAvLyBNZXRob2QgLyBvYmplY3QgcmVmZXJlbmNlcy4KICAgIGpxX3BhcmFtID0gJC5wYXJhbSwKICAgIGpxX3BhcmFtX3NvcnRlZCwKICAgIGpxX3BhcmFtX2ZyYWdtZW50LAogICAganFfZGVwYXJhbSwKICAgIGpxX2RlcGFyYW1fZnJhZ21lbnQsCiAgICBqcV9iYnEgPSAkLmJicSA9ICQuYmJxIHx8IHt9LAogICAganFfYmJxX3B1c2hTdGF0ZSwKICAgIGpxX2JicV9nZXRTdGF0ZSwKICAgIGpxX2VsZW1VcmxBdHRyLAogICAgc3BlY2lhbCA9ICQuZXZlbnQuc3BlY2lhbCwKICAgIAogICAgLy8gUmV1c2VkIHN0cmluZ3MuCiAgICBzdHJfaGFzaGNoYW5nZSA9ICdoYXNoY2hhbmdlJywKICAgIHN0cl9xdWVyeXN0cmluZyA9ICdxdWVyeXN0cmluZycsCiAgICBzdHJfZnJhZ21lbnQgPSAnZnJhZ21lbnQnLAogICAgc3RyX2VsZW1VcmxBdHRyID0gJ2VsZW1VcmxBdHRyJywKICAgIHN0cl9ocmVmID0gJ2hyZWYnLAogICAgc3RyX3NyYyA9ICdzcmMnLAogICAgCiAgICAvLyBSZXVzZWQgUmVnRXhwLgogICAgcmVfcGFyYW1zX3F1ZXJ5c3RyaW5nID0gL14uKlw/fCMuKiQvZywKICAgIHJlX3BhcmFtc19mcmFnbWVudCwKICAgIHJlX2ZyYWdtZW50LAogICAgcmVfbm9fZXNjYXBlLAogICAgCiAgICBhamF4X2NyYXdsYWJsZSwKICAgIGZyYWdtZW50X3ByZWZpeCwKICAgIAogICAgLy8gVXNlZCBieSBqUXVlcnkuZWxlbVVybEF0dHIuCiAgICBlbGVtVXJsQXR0cl9jYWNoZSA9IHt9OwogIAogIC8vIEEgZmV3IGNvbW1vbmx5IHVzZWQgYml0cywgYnJva2VuIG91dCB0byBoZWxwIHJlZHVjZSBtaW5pZmllZCBmaWxlIHNpemUuCiAgCiAgZnVuY3Rpb24gaXNfc3RyaW5nKCBhcmcgKSB7CiAgICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ3N0cmluZyc7CiAgfTsKICAKICAvLyBXaHkgd3JpdGUgdGhlIHNhbWUgZnVuY3Rpb24gdHdpY2U/IExldCdzIGN1cnJ5ISBNbW1tLCBjdXJyeS4uCiAgCiAgZnVuY3Rpb24gY3VycnkoIGZ1bmMgKSB7CiAgICB2YXIgYXJncyA9IGFwcy5jYWxsKCBhcmd1bWVudHMsIDEgKTsKICAgIAogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZnVuYy5hcHBseSggdGhpcywgYXJncy5jb25jYXQoIGFwcy5jYWxsKCBhcmd1bWVudHMgKSApICk7CiAgICB9OwogIH07CiAgCiAgLy8gR2V0IGxvY2F0aW9uLmhhc2ggKG9yIHdoYXQgeW91J2QgZXhwZWN0IGxvY2F0aW9uLmhhc2ggdG8gYmUpIHNhbnMgYW55CiAgLy8gbGVhZGluZyAjLiBUaGFua3MgZm9yIG1ha2luZyB0aGlzIG5lY2Vzc2FyeSwgRmlyZWZveCEKICBmdW5jdGlvbiBnZXRfZnJhZ21lbnQoIHVybCApIHsKICAgIHJldHVybiB1cmwucmVwbGFjZSggcmVfZnJhZ21lbnQsICckMicgKTsKICB9OwogIAogIC8vIEdldCBsb2NhdGlvbi5zZWFyY2ggKG9yIHdoYXQgeW91J2QgZXhwZWN0IGxvY2F0aW9uLnNlYXJjaCB0byBiZSkgc2FucyBhbnkKICAvLyBsZWFkaW5nICMuIFRoYW5rcyBmb3IgbWFraW5nIHRoaXMgbmVjZXNzYXJ5LCBJRTYhCiAgZnVuY3Rpb24gZ2V0X3F1ZXJ5c3RyaW5nKCB1cmwgKSB7CiAgICByZXR1cm4gdXJsLnJlcGxhY2UoIC8oPzpeW14/I10qXD8oW14jXSopLiokKT8uKi8sICckMScgKTsKICB9OwogIAogIC8vIFNlY3Rpb246IFBhcmFtICh0byBzdHJpbmcpCiAgLy8gCiAgLy8gTWV0aG9kOiBqUXVlcnkucGFyYW0ucXVlcnlzdHJpbmcKICAvLyAKICAvLyBSZXRyaWV2ZSB0aGUgcXVlcnkgc3RyaW5nIGZyb20gYSBVUkwgb3IgaWYgbm8gYXJndW1lbnRzIGFyZSBwYXNzZWQsIHRoZQogIC8vIGN1cnJlbnQgd2luZG93LmxvY2F0aW9uLmhyZWYuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkucGFyYW0ucXVlcnlzdHJpbmcoIFsgdXJsIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIHVybCAtIChTdHJpbmcpIEEgVVJMIGNvbnRhaW5pbmcgcXVlcnkgc3RyaW5nIHBhcmFtcyB0byBiZSBwYXJzZWQuIElmIHVybAogIC8vICAgIGlzIG5vdCBwYXNzZWQsIHRoZSBjdXJyZW50IHdpbmRvdy5sb2NhdGlvbi5ocmVmIGlzIHVzZWQuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKFN0cmluZykgVGhlIHBhcnNlZCBxdWVyeSBzdHJpbmcsIHdpdGggYW55IGxlYWRpbmcgIj8iIHJlbW92ZWQuCiAgLy8KICAKICAvLyBNZXRob2Q6IGpRdWVyeS5wYXJhbS5xdWVyeXN0cmluZyAoYnVpbGQgdXJsKQogIC8vIAogIC8vIE1lcmdlIGEgVVJMLCB3aXRoIG9yIHdpdGhvdXQgcHJlLWV4aXN0aW5nIHF1ZXJ5IHN0cmluZyBwYXJhbXMsIHBsdXMgYW55CiAgLy8gb2JqZWN0LCBwYXJhbXMgc3RyaW5nIG9yIFVSTCBjb250YWluaW5nIHF1ZXJ5IHN0cmluZyBwYXJhbXMgaW50byBhIG5ldyBVUkwuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkucGFyYW0ucXVlcnlzdHJpbmcoIHVybCwgcGFyYW1zIFssIG1lcmdlX21vZGUgXSApOwogIC8vIAogIC8vIEFyZ3VtZW50czoKICAvLyAKICAvLyAgdXJsIC0gKFN0cmluZykgQSB2YWxpZCBVUkwgZm9yIHBhcmFtcyB0byBiZSBtZXJnZWQgaW50by4gVGhpcyBVUkwgbWF5CiAgLy8gICAgY29udGFpbiBhIHF1ZXJ5IHN0cmluZyBhbmQvb3IgZnJhZ21lbnQgKGhhc2gpLgogIC8vICBwYXJhbXMgLSAoU3RyaW5nKSBBIHBhcmFtcyBzdHJpbmcgb3IgVVJMIGNvbnRhaW5pbmcgcXVlcnkgc3RyaW5nIHBhcmFtcyB0bwogIC8vICAgIGJlIG1lcmdlZCBpbnRvIHVybC4KICAvLyAgcGFyYW1zIC0gKE9iamVjdCkgQSBwYXJhbXMgb2JqZWN0IHRvIGJlIG1lcmdlZCBpbnRvIHVybC4KICAvLyAgbWVyZ2VfbW9kZSAtIChOdW1iZXIpIE1lcmdlIGJlaGF2aW9yIGRlZmF1bHRzIHRvIDAgaWYgbWVyZ2VfbW9kZSBpcyBub3QKICAvLyAgICBzcGVjaWZpZWQsIGFuZCBpcyBhcy1mb2xsb3dzOgogIC8vIAogIC8vICAgICogMDogcGFyYW1zIGluIHRoZSBwYXJhbXMgYXJndW1lbnQgd2lsbCBvdmVycmlkZSBhbnkgcXVlcnkgc3RyaW5nCiAgLy8gICAgICAgICBwYXJhbXMgaW4gdXJsLgogIC8vICAgICogMTogYW55IHF1ZXJ5IHN0cmluZyBwYXJhbXMgaW4gdXJsIHdpbGwgb3ZlcnJpZGUgcGFyYW1zIGluIHRoZSBwYXJhbXMKICAvLyAgICAgICAgIGFyZ3VtZW50LgogIC8vICAgICogMjogcGFyYW1zIGFyZ3VtZW50IHdpbGwgY29tcGxldGVseSByZXBsYWNlIGFueSBxdWVyeSBzdHJpbmcgaW4gdXJsLgogIC8vIAogIC8vIFJldHVybnM6CiAgLy8gCiAgLy8gIChTdHJpbmcpIEEgVVJMIHdpdGggYSB1cmxlbmNvZGVkIHF1ZXJ5IHN0cmluZyBpbiB0aGUgZm9ybWF0ICc/YT1iJmM9ZCZlPWYnLgogIAogIC8vIE1ldGhvZDogalF1ZXJ5LnBhcmFtLmZyYWdtZW50CiAgLy8gCiAgLy8gUmV0cmlldmUgdGhlIGZyYWdtZW50IChoYXNoKSBmcm9tIGEgVVJMIG9yIGlmIG5vIGFyZ3VtZW50cyBhcmUgcGFzc2VkLCB0aGUKICAvLyBjdXJyZW50IHdpbmRvdy5sb2NhdGlvbi5ocmVmLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5LnBhcmFtLmZyYWdtZW50KCBbIHVybCBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICB1cmwgLSAoU3RyaW5nKSBBIFVSTCBjb250YWluaW5nIGZyYWdtZW50IChoYXNoKSBwYXJhbXMgdG8gYmUgcGFyc2VkLiBJZgogIC8vICAgIHVybCBpcyBub3QgcGFzc2VkLCB0aGUgY3VycmVudCB3aW5kb3cubG9jYXRpb24uaHJlZiBpcyB1c2VkLgogIC8vIAogIC8vIFJldHVybnM6CiAgLy8gCiAgLy8gIChTdHJpbmcpIFRoZSBwYXJzZWQgZnJhZ21lbnQgKGhhc2gpIHN0cmluZywgd2l0aCBhbnkgbGVhZGluZyAiIyIgcmVtb3ZlZC4KICAKICAvLyBNZXRob2Q6IGpRdWVyeS5wYXJhbS5mcmFnbWVudCAoYnVpbGQgdXJsKQogIC8vIAogIC8vIE1lcmdlIGEgVVJMLCB3aXRoIG9yIHdpdGhvdXQgcHJlLWV4aXN0aW5nIGZyYWdtZW50IChoYXNoKSBwYXJhbXMsIHBsdXMgYW55CiAgLy8gb2JqZWN0LCBwYXJhbXMgc3RyaW5nIG9yIFVSTCBjb250YWluaW5nIGZyYWdtZW50IChoYXNoKSBwYXJhbXMgaW50byBhIG5ldwogIC8vIFVSTC4KICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyA+IGpRdWVyeS5wYXJhbS5mcmFnbWVudCggdXJsLCBwYXJhbXMgWywgbWVyZ2VfbW9kZSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICB1cmwgLSAoU3RyaW5nKSBBIHZhbGlkIFVSTCBmb3IgcGFyYW1zIHRvIGJlIG1lcmdlZCBpbnRvLiBUaGlzIFVSTCBtYXkKICAvLyAgICBjb250YWluIGEgcXVlcnkgc3RyaW5nIGFuZC9vciBmcmFnbWVudCAoaGFzaCkuCiAgLy8gIHBhcmFtcyAtIChTdHJpbmcpIEEgcGFyYW1zIHN0cmluZyBvciBVUkwgY29udGFpbmluZyBmcmFnbWVudCAoaGFzaCkgcGFyYW1zCiAgLy8gICAgdG8gYmUgbWVyZ2VkIGludG8gdXJsLgogIC8vICBwYXJhbXMgLSAoT2JqZWN0KSBBIHBhcmFtcyBvYmplY3QgdG8gYmUgbWVyZ2VkIGludG8gdXJsLgogIC8vICBtZXJnZV9tb2RlIC0gKE51bWJlcikgTWVyZ2UgYmVoYXZpb3IgZGVmYXVsdHMgdG8gMCBpZiBtZXJnZV9tb2RlIGlzIG5vdAogIC8vICAgIHNwZWNpZmllZCwgYW5kIGlzIGFzLWZvbGxvd3M6CiAgLy8gCiAgLy8gICAgKiAwOiBwYXJhbXMgaW4gdGhlIHBhcmFtcyBhcmd1bWVudCB3aWxsIG92ZXJyaWRlIGFueSBmcmFnbWVudCAoaGFzaCkKICAvLyAgICAgICAgIHBhcmFtcyBpbiB1cmwuCiAgLy8gICAgKiAxOiBhbnkgZnJhZ21lbnQgKGhhc2gpIHBhcmFtcyBpbiB1cmwgd2lsbCBvdmVycmlkZSBwYXJhbXMgaW4gdGhlCiAgLy8gICAgICAgICBwYXJhbXMgYXJndW1lbnQuCiAgLy8gICAgKiAyOiBwYXJhbXMgYXJndW1lbnQgd2lsbCBjb21wbGV0ZWx5IHJlcGxhY2UgYW55IHF1ZXJ5IHN0cmluZyBpbiB1cmwuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKFN0cmluZykgQSBVUkwgd2l0aCBhIHVybGVuY29kZWQgZnJhZ21lbnQgKGhhc2gpIGluIHRoZSBmb3JtYXQgJyNhPWImYz1kJmU9ZicuCiAgCiAgZnVuY3Rpb24ganFfcGFyYW1fc3ViKCBpc19mcmFnbWVudCwgZ2V0X2Z1bmMsIHVybCwgcGFyYW1zLCBtZXJnZV9tb2RlICkgewogICAgdmFyIHJlc3VsdCwKICAgICAgcXMsCiAgICAgIG1hdGNoZXMsCiAgICAgIHVybF9wYXJhbXMsCiAgICAgIGhhc2g7CiAgICAKICAgIGlmICggcGFyYW1zICE9PSB1bmRlZmluZWQgKSB7CiAgICAgIC8vIEJ1aWxkIFVSTCBieSBtZXJnaW5nIHBhcmFtcyBpbnRvIHVybCBzdHJpbmcuCiAgICAgIAogICAgICAvLyBtYXRjaGVzWzFdID0gdXJsIHBhcnQgdGhhdCBwcmVjZWRlcyBwYXJhbXMsIG5vdCBpbmNsdWRpbmcgdHJhaWxpbmcgPy8jCiAgICAgIC8vIG1hdGNoZXNbMl0gPSBwYXJhbXMsIG5vdCBpbmNsdWRpbmcgbGVhZGluZyA/LyMKICAgICAgLy8gbWF0Y2hlc1szXSA9IGlmIGluICdxdWVyeXN0cmluZycgbW9kZSwgaGFzaCBpbmNsdWRpbmcgbGVhZGluZyAjLCBvdGhlcndpc2UgJycKICAgICAgbWF0Y2hlcyA9IHVybC5tYXRjaCggaXNfZnJhZ21lbnQgPyByZV9mcmFnbWVudCA6IC9eKFteIz9dKilcPz8oW14jXSopKCM/LiopLyApOwogICAgICAKICAgICAgLy8gR2V0IHRoZSBoYXNoIGlmIGluICdxdWVyeXN0cmluZycgbW9kZSwgYW5kIGl0IGV4aXN0cy4KICAgICAgaGFzaCA9IG1hdGNoZXNbM10gfHwgJyc7CiAgICAgIAogICAgICBpZiAoIG1lcmdlX21vZGUgPT09IDIgJiYgaXNfc3RyaW5nKCBwYXJhbXMgKSApIHsKICAgICAgICAvLyBJZiBtZXJnZV9tb2RlIGlzIDIgYW5kIHBhcmFtcyBpcyBhIHN0cmluZywgbWVyZ2UgdGhlIGZyYWdtZW50IC8gcXVlcnkKICAgICAgICAvLyBzdHJpbmcgaW50byB0aGUgVVJMIHdob2xlc2FsZSwgd2l0aG91dCBjb252ZXJ0aW5nIGl0IGludG8gYW4gb2JqZWN0LgogICAgICAgIHFzID0gcGFyYW1zLnJlcGxhY2UoIGlzX2ZyYWdtZW50ID8gcmVfcGFyYW1zX2ZyYWdtZW50IDogcmVfcGFyYW1zX3F1ZXJ5c3RyaW5nLCAnJyApOwogICAgICAgIAogICAgICB9IGVsc2UgewogICAgICAgIC8vIENvbnZlcnQgcmVsZXZhbnQgcGFyYW1zIGluIHVybCB0byBvYmplY3QuCiAgICAgICAgdXJsX3BhcmFtcyA9IGpxX2RlcGFyYW0oIG1hdGNoZXNbMl0gKTsKICAgICAgICAKICAgICAgICBwYXJhbXMgPSBpc19zdHJpbmcoIHBhcmFtcyApCiAgICAgICAgICAKICAgICAgICAgIC8vIENvbnZlcnQgcGFzc2VkIHBhcmFtcyBzdHJpbmcgaW50byBvYmplY3QuCiAgICAgICAgICA/IGpxX2RlcGFyYW1bIGlzX2ZyYWdtZW50ID8gc3RyX2ZyYWdtZW50IDogc3RyX3F1ZXJ5c3RyaW5nIF0oIHBhcmFtcyApCiAgICAgICAgICAKICAgICAgICAgIC8vIFBhc3NlZCBwYXJhbXMgb2JqZWN0LgogICAgICAgICAgOiBwYXJhbXM7CiAgICAgICAgCiAgICAgICAgcXMgPSBtZXJnZV9tb2RlID09PSAyID8gcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGFzc2VkIHBhcmFtcyByZXBsYWNlIHVybCBwYXJhbXMKICAgICAgICAgIDogbWVyZ2VfbW9kZSA9PT0gMSAgPyAkLmV4dGVuZCgge30sIHBhcmFtcywgdXJsX3BhcmFtcyApICAvLyB1cmwgcGFyYW1zIG92ZXJyaWRlIHBhc3NlZCBwYXJhbXMKICAgICAgICAgIDogJC5leHRlbmQoIHt9LCB1cmxfcGFyYW1zLCBwYXJhbXMgKTsgICAgICAgICAgICAgICAgICAgICAvLyBwYXNzZWQgcGFyYW1zIG92ZXJyaWRlIHVybCBwYXJhbXMKICAgICAgICAKICAgICAgICAvLyBDb252ZXJ0IHBhcmFtcyBvYmplY3QgaW50byBhIHNvcnRlZCBwYXJhbXMgc3RyaW5nLgogICAgICAgIHFzID0ganFfcGFyYW1fc29ydGVkKCBxcyApOwogICAgICAgIAogICAgICAgIC8vIFVuZXNjYXBlIGNoYXJhY3RlcnMgc3BlY2lmaWVkIHZpYSAkLnBhcmFtLm5vRXNjYXBlLiBTaW5jZSBvbmx5IGhhc2gtCiAgICAgICAgLy8gaGlzdG9yeSB1c2VycyBoYXZlIHJlcXVlc3RlZCB0aGlzIGZlYXR1cmUsIGl0J3Mgb25seSBlbmFibGVkIGZvcgogICAgICAgIC8vIGZyYWdtZW50LXJlbGF0ZWQgcGFyYW1zIHN0cmluZ3MuCiAgICAgICAgaWYgKCBpc19mcmFnbWVudCApIHsKICAgICAgICAgIHFzID0gcXMucmVwbGFjZSggcmVfbm9fZXNjYXBlLCBkZWNvZGUgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIC8vIEJ1aWxkIFVSTCBmcm9tIHRoZSBiYXNlIHVybCwgcXVlcnlzdHJpbmcgYW5kIGhhc2guIEluICdxdWVyeXN0cmluZycKICAgICAgLy8gbW9kZSwgPyBpcyBvbmx5IGFkZGVkIGlmIGEgcXVlcnkgc3RyaW5nIGV4aXN0cy4gSW4gJ2ZyYWdtZW50JyBtb2RlLCAjCiAgICAgIC8vIGlzIGFsd2F5cyBhZGRlZC4KICAgICAgcmVzdWx0ID0gbWF0Y2hlc1sxXSArICggaXNfZnJhZ21lbnQgPyBmcmFnbWVudF9wcmVmaXggOiBxcyB8fCAhbWF0Y2hlc1sxXSA/ICc/JyA6ICcnICkgKyBxcyArIGhhc2g7CiAgICAgIAogICAgfSBlbHNlIHsKICAgICAgLy8gSWYgVVJMIHdhcyBwYXNzZWQgaW4sIHBhcnNlIHBhcmFtcyBmcm9tIFVSTCBzdHJpbmcsIG90aGVyd2lzZSBwYXJzZQogICAgICAvLyBwYXJhbXMgZnJvbSB3aW5kb3cubG9jYXRpb24uaHJlZi4KICAgICAgcmVzdWx0ID0gZ2V0X2Z1bmMoIHVybCAhPT0gdW5kZWZpbmVkID8gdXJsIDogbG9jYXRpb24uaHJlZiApOwogICAgfQogICAgCiAgICByZXR1cm4gcmVzdWx0OwogIH07CiAgCiAganFfcGFyYW1bIHN0cl9xdWVyeXN0cmluZyBdICAgICAgICAgICAgICAgICAgPSBjdXJyeSgganFfcGFyYW1fc3ViLCAwLCBnZXRfcXVlcnlzdHJpbmcgKTsKICBqcV9wYXJhbVsgc3RyX2ZyYWdtZW50IF0gPSBqcV9wYXJhbV9mcmFnbWVudCA9IGN1cnJ5KCBqcV9wYXJhbV9zdWIsIDEsIGdldF9mcmFnbWVudCApOwogIAogIC8vIE1ldGhvZDogalF1ZXJ5LnBhcmFtLnNvcnRlZAogIC8vIAogIC8vIFJldHVybnMgYSBwYXJhbXMgc3RyaW5nIGVxdWl2YWxlbnQgdG8gdGhhdCByZXR1cm5lZCBieSB0aGUgaW50ZXJuYWwKICAvLyBqUXVlcnkucGFyYW0gbWV0aG9kLCBidXQgc29ydGVkLCB3aGljaCBtYWtlcyBpdCBzdWl0YWJsZSBmb3IgdXNlIGFzIGEKICAvLyBjYWNoZSBrZXkuCiAgLy8gCiAgLy8gRm9yIGV4YW1wbGUsIGluIG1vc3QgYnJvd3NlcnMgalF1ZXJ5LnBhcmFtKHt6OjEsYToyfSkgcmV0dXJucyAiej0xJmE9MiIKICAvLyBhbmQgalF1ZXJ5LnBhcmFtKHthOjIsejoxfSkgcmV0dXJucyAiYT0yJno9MSIuIEV2ZW4gdGhvdWdoIGJvdGggdGhlCiAgLy8gb2JqZWN0cyBiZWluZyBzZXJpYWxpemVkIGFuZCB0aGUgcmVzdWx0aW5nIHBhcmFtcyBzdHJpbmdzIGFyZSBlcXVpdmFsZW50LAogIC8vIGlmIHRoZXNlIHBhcmFtcyBzdHJpbmdzIHdlcmUgc2V0IGludG8gdGhlIGxvY2F0aW9uLmhhc2ggZnJhZ21lbnQKICAvLyBzZXF1ZW50aWFsbHksIHRoZSBoYXNoY2hhbmdlIGV2ZW50IHdvdWxkIGJlIHRyaWdnZXJlZCB1bm5lY2Vzc2FyaWx5LCBzaW5jZQogIC8vIHRoZSBzdHJpbmdzIGFyZSBkaWZmZXJlbnQgKGV2ZW4gdGhvdWdoIHRoZSBkYXRhIGRlc2NyaWJlZCBieSB0aGVtIGlzIHRoZQogIC8vIHNhbWUpLiBCeSBzb3J0aW5nIHRoZSBwYXJhbXMgc3RyaW5nLCB1bmVjZXNzYXJ5IGhhc2hjaGFuZ2UgZXZlbnQgdHJpZ2dlcmluZwogIC8vIGNhbiBiZSBhdm9pZGVkLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5LnBhcmFtLnNvcnRlZCggb2JqIFssIHRyYWRpdGlvbmFsIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIG9iaiAtIChPYmplY3QpIEFuIG9iamVjdCB0byBiZSBzZXJpYWxpemVkLgogIC8vICB0cmFkaXRpb25hbCAtIChCb29sZWFuKSBQYXJhbXMgZGVlcC9zaGFsbG93IHNlcmlhbGl6YXRpb24gbW9kZS4gU2VlIHRoZQogIC8vICAgIGRvY3VtZW50YXRpb24gYXQgaHR0cDovL2FwaS5qcXVlcnkuY29tL2pRdWVyeS5wYXJhbS8gZm9yIG1vcmUgZGV0YWlsLgogIC8vIAogIC8vIFJldHVybnM6CiAgLy8gCiAgLy8gIChTdHJpbmcpIEEgc29ydGVkIHBhcmFtcyBzdHJpbmcuCiAgCiAganFfcGFyYW0uc29ydGVkID0ganFfcGFyYW1fc29ydGVkID0gZnVuY3Rpb24oIGEsIHRyYWRpdGlvbmFsICkgewogICAgdmFyIGFyciA9IFtdLAogICAgICBvYmogPSB7fTsKICAgIAogICAgJC5lYWNoKCBqcV9wYXJhbSggYSwgdHJhZGl0aW9uYWwgKS5zcGxpdCggJyYnICksIGZ1bmN0aW9uKGksdil7CiAgICAgIHZhciBrZXkgPSB2LnJlcGxhY2UoIC8oPzolNUJ8PSkuKiQvLCAnJyApLAogICAgICAgIGtleV9vYmogPSBvYmpbIGtleSBdOwogICAgICAKICAgICAgaWYgKCAha2V5X29iaiApIHsKICAgICAgICBrZXlfb2JqID0gb2JqWyBrZXkgXSA9IFtdOwogICAgICAgIGFyci5wdXNoKCBrZXkgKTsKICAgICAgfQogICAgICAKICAgICAga2V5X29iai5wdXNoKCB2ICk7CiAgICB9KTsKICAgIAogICAgcmV0dXJuICQubWFwKCBhcnIuc29ydCgpLCBmdW5jdGlvbih2KXsKICAgICAgcmV0dXJuIG9ialsgdiBdOwogICAgfSkuam9pbiggJyYnICk7CiAgfTsKICAKICAvLyBNZXRob2Q6IGpRdWVyeS5wYXJhbS5mcmFnbWVudC5ub0VzY2FwZQogIC8vIAogIC8vIFNwZWNpZnkgY2hhcmFjdGVycyB0aGF0IHdpbGwgYmUgbGVmdCB1bmVzY2FwZWQgd2hlbiBmcmFnbWVudHMgYXJlIGNyZWF0ZWQKICAvLyBvciBtZXJnZWQgdXNpbmcgPGpRdWVyeS5wYXJhbS5mcmFnbWVudD4sIG9yIHdoZW4gdGhlIGZyYWdtZW50IGlzIG1vZGlmaWVkCiAgLy8gdXNpbmcgPGpRdWVyeS5iYnEucHVzaFN0YXRlPi4gVGhpcyBvcHRpb24gb25seSBhcHBsaWVzIHRvIHNlcmlhbGl6ZWQgZGF0YQogIC8vIG9iamVjdCBmcmFnbWVudHMsIGFuZCBub3Qgc2V0LWFzLXN0cmluZyBmcmFnbWVudHMuIERvZXMgbm90IGFmZmVjdCB0aGUKICAvLyBxdWVyeSBzdHJpbmcuIERlZmF1bHRzIHRvICIsLyIgKGNvbW1hLCBmb3J3YXJkIHNsYXNoKS4KICAvLyAKICAvLyBOb3RlIHRoYXQgdGhpcyBpcyBjb25zaWRlcmVkIGEgcHVyZWx5IGFlc3RoZXRpYyBvcHRpb24sIGFuZCB3aWxsIGhlbHAgdG8KICAvLyBjcmVhdGUgVVJMcyB0aGF0ICJsb29rIHByZXR0eSIgaW4gdGhlIGFkZHJlc3MgYmFyIG9yIGJvb2ttYXJrcywgd2l0aG91dAogIC8vIGFmZmVjdGluZyBmdW5jdGlvbmFsaXR5IGluIGFueSB3YXkuIFRoYXQgYmVpbmcgc2FpZCwgYmUgY2FyZWZ1bCB0byBub3QKICAvLyB1bmVzY2FwZSBjaGFyYWN0ZXJzIHRoYXQgYXJlIHVzZWQgYXMgZGVsaW1pdGVycyBvciBzZXJ2ZSBhIHNwZWNpYWwKICAvLyBwdXJwb3NlLCBzdWNoIGFzIHRoZSAiIz8mPSsiIChvY3RvdGhvcnBlLCBxdWVzdGlvbiBtYXJrLCBhbXBlcnNhbmQsCiAgLy8gZXF1YWxzLCBwbHVzKSBjaGFyYWN0ZXJzLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5LnBhcmFtLmZyYWdtZW50Lm5vRXNjYXBlKCBbIGNoYXJzIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIGNoYXJzIC0gKFN0cmluZykgVGhlIGNoYXJhY3RlcnMgdG8gbm90IGVzY2FwZSBpbiB0aGUgZnJhZ21lbnQuIElmCiAgLy8gICAgdW5zcGVjaWZpZWQsIGRlZmF1bHRzIHRvIGVtcHR5IHN0cmluZyAoZXNjYXBlIGFsbCBjaGFyYWN0ZXJzKS4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICBOb3RoaW5nLgogIAogIGpxX3BhcmFtX2ZyYWdtZW50Lm5vRXNjYXBlID0gZnVuY3Rpb24oIGNoYXJzICkgewogICAgY2hhcnMgPSBjaGFycyB8fCAnJzsKICAgIHZhciBhcnIgPSAkLm1hcCggY2hhcnMuc3BsaXQoJycpLCBlbmNvZGVVUklDb21wb25lbnQgKTsKICAgIHJlX25vX2VzY2FwZSA9IG5ldyBSZWdFeHAoIGFyci5qb2luKCd8JyksICdnJyApOwogIH07CiAgCiAgLy8gQSBzZW5zaWJsZSBkZWZhdWx0LiBUaGVzZSBhcmUgdGhlIGNoYXJhY3RlcnMgcGVvcGxlIHNlZW0gdG8gY29tcGxhaW4gYWJvdXQKICAvLyAidWdsaWZ5aW5nIHVwIHRoZSBVUkwiIHRoZSBtb3N0LgogIGpxX3BhcmFtX2ZyYWdtZW50Lm5vRXNjYXBlKCAnLC8nICk7CiAgCiAgLy8gTWV0aG9kOiBqUXVlcnkucGFyYW0uZnJhZ21lbnQuYWpheENyYXdsYWJsZQogIC8vIAogIC8vIFRPRE86IERFU0NSSUJFCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkucGFyYW0uZnJhZ21lbnQuYWpheENyYXdsYWJsZSggWyBzdGF0ZSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICBzdGF0ZSAtIChCb29sZWFuKSBUT0RPOiBERVNDUklCRQogIC8vIAogIC8vIFJldHVybnM6CiAgLy8gCiAgLy8gIChCb29sZWFuKSBUaGUgY3VycmVudCBhamF4Q3Jhd2xhYmxlIHN0YXRlLgogIAogIGpxX3BhcmFtX2ZyYWdtZW50LmFqYXhDcmF3bGFibGUgPSBmdW5jdGlvbiggc3RhdGUgKSB7CiAgICBpZiAoIHN0YXRlICE9PSB1bmRlZmluZWQgKSB7CiAgICAgIGlmICggc3RhdGUgKSB7CiAgICAgICAgcmVfcGFyYW1zX2ZyYWdtZW50ID0gL14uKig/OiMhfCMpLzsKICAgICAgICByZV9mcmFnbWVudCA9IC9eKFteI10qKSg/OiMhfCMpPyguKikkLzsKICAgICAgICBmcmFnbWVudF9wcmVmaXggPSAnIyEnOwogICAgICB9IGVsc2UgewogICAgICAgIHJlX3BhcmFtc19mcmFnbWVudCA9IC9eLiojLzsKICAgICAgICByZV9mcmFnbWVudCA9IC9eKFteI10qKSM/KC4qKSQvOwogICAgICAgIGZyYWdtZW50X3ByZWZpeCA9ICcjJzsKICAgICAgfQogICAgICBhamF4X2NyYXdsYWJsZSA9ICEhc3RhdGU7CiAgICB9CiAgICAKICAgIHJldHVybiBhamF4X2NyYXdsYWJsZTsKICB9OwogIAogIGpxX3BhcmFtX2ZyYWdtZW50LmFqYXhDcmF3bGFibGUoIDAgKTsKICAKICAvLyBTZWN0aW9uOiBEZXBhcmFtIChmcm9tIHN0cmluZykKICAvLyAKICAvLyBNZXRob2Q6IGpRdWVyeS5kZXBhcmFtCiAgLy8gCiAgLy8gRGVzZXJpYWxpemUgYSBwYXJhbXMgc3RyaW5nIGludG8gYW4gb2JqZWN0LCBvcHRpb25hbGx5IGNvZXJjaW5nIG51bWJlcnMsCiAgLy8gYm9vbGVhbnMsIG51bGwgYW5kIHVuZGVmaW5lZCB2YWx1ZXM7IHRoaXMgbWV0aG9kIGlzIHRoZSBjb3VudGVycGFydCB0byB0aGUKICAvLyBpbnRlcm5hbCBqUXVlcnkucGFyYW0gbWV0aG9kLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5LmRlcGFyYW0oIHBhcmFtcyBbLCBjb2VyY2UgXSApOwogIC8vIAogIC8vIEFyZ3VtZW50czoKICAvLyAKICAvLyAgcGFyYW1zIC0gKFN0cmluZykgQSBwYXJhbXMgc3RyaW5nIHRvIGJlIHBhcnNlZC4KICAvLyAgY29lcmNlIC0gKEJvb2xlYW4pIElmIHRydWUsIGNvZXJjZXMgYW55IG51bWJlcnMgb3IgdHJ1ZSwgZmFsc2UsIG51bGwsIGFuZAogIC8vICAgIHVuZGVmaW5lZCB0byB0aGVpciBhY3R1YWwgdmFsdWUuIERlZmF1bHRzIHRvIGZhbHNlIGlmIG9taXR0ZWQuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKE9iamVjdCkgQW4gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZGVzZXJpYWxpemVkIHBhcmFtcyBzdHJpbmcuCiAgCiAgJC5kZXBhcmFtID0ganFfZGVwYXJhbSA9IGZ1bmN0aW9uKCBwYXJhbXMsIGNvZXJjZSApIHsKICAgIHZhciBvYmogPSB7fSwKICAgICAgY29lcmNlX3R5cGVzID0geyAndHJ1ZSc6ICEwLCAnZmFsc2UnOiAhMSwgJ251bGwnOiBudWxsIH07CiAgICAKICAgIC8vIEl0ZXJhdGUgb3ZlciBhbGwgbmFtZT12YWx1ZSBwYWlycy4KICAgICQuZWFjaCggcGFyYW1zLnJlcGxhY2UoIC9cKy9nLCAnICcgKS5zcGxpdCggJyYnICksIGZ1bmN0aW9uKGosdil7CiAgICAgIHZhciBwYXJhbSA9IHYuc3BsaXQoICc9JyApLAogICAgICAgIGtleSA9IGRlY29kZSggcGFyYW1bMF0gKSwKICAgICAgICB2YWwsCiAgICAgICAgY3VyID0gb2JqLAogICAgICAgIGkgPSAwLAogICAgICAgIAogICAgICAgIC8vIElmIGtleSBpcyBtb3JlIGNvbXBsZXggdGhhbiAnZm9vJywgbGlrZSAnYVtdJyBvciAnYVtiXVtjXScsIHNwbGl0IGl0CiAgICAgICAgLy8gaW50byBpdHMgY29tcG9uZW50IHBhcnRzLgogICAgICAgIGtleXMgPSBrZXkuc3BsaXQoICddWycgKSwKICAgICAgICBrZXlzX2xhc3QgPSBrZXlzLmxlbmd0aCAtIDE7CiAgICAgIAogICAgICAvLyBJZiB0aGUgZmlyc3Qga2V5cyBwYXJ0IGNvbnRhaW5zIFsgYW5kIHRoZSBsYXN0IGVuZHMgd2l0aCBdLCB0aGVuIFtdCiAgICAgIC8vIGFyZSBjb3JyZWN0bHkgYmFsYW5jZWQuCiAgICAgIGlmICggL1xbLy50ZXN0KCBrZXlzWzBdICkgJiYgL1xdJC8udGVzdCgga2V5c1sga2V5c19sYXN0IF0gKSApIHsKICAgICAgICAvLyBSZW1vdmUgdGhlIHRyYWlsaW5nIF0gZnJvbSB0aGUgbGFzdCBrZXlzIHBhcnQuCiAgICAgICAga2V5c1sga2V5c19sYXN0IF0gPSBrZXlzWyBrZXlzX2xhc3QgXS5yZXBsYWNlKCAvXF0kLywgJycgKTsKICAgICAgICAKICAgICAgICAvLyBTcGxpdCBmaXJzdCBrZXlzIHBhcnQgaW50byB0d28gcGFydHMgb24gdGhlIFsgYW5kIGFkZCB0aGVtIGJhY2sgb250bwogICAgICAgIC8vIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGtleXMgYXJyYXkuCiAgICAgICAga2V5cyA9IGtleXMuc2hpZnQoKS5zcGxpdCgnWycpLmNvbmNhdCgga2V5cyApOwogICAgICAgIAogICAgICAgIGtleXNfbGFzdCA9IGtleXMubGVuZ3RoIC0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBCYXNpYyAnZm9vJyBzdHlsZSBrZXkuCiAgICAgICAga2V5c19sYXN0ID0gMDsKICAgICAgfQogICAgICAKICAgICAgLy8gQXJlIHdlIGRlYWxpbmcgd2l0aCBhIG5hbWU9dmFsdWUgcGFpciwgb3IganVzdCBhIG5hbWU/CiAgICAgIGlmICggcGFyYW0ubGVuZ3RoID09PSAyICkgewogICAgICAgIHZhbCA9IGRlY29kZSggcGFyYW1bMV0gKTsKICAgICAgICAKICAgICAgICAvLyBDb2VyY2UgdmFsdWVzLgogICAgICAgIGlmICggY29lcmNlICkgewogICAgICAgICAgdmFsID0gdmFsICYmICFpc05hTih2YWwpICAgICAgICAgICAgPyArdmFsICAgICAgICAgICAgICAvLyBudW1iZXIKICAgICAgICAgICAgOiB2YWwgPT09ICd1bmRlZmluZWQnICAgICAgICAgICAgID8gdW5kZWZpbmVkICAgICAgICAgLy8gdW5kZWZpbmVkCiAgICAgICAgICAgIDogY29lcmNlX3R5cGVzW3ZhbF0gIT09IHVuZGVmaW5lZCA/IGNvZXJjZV90eXBlc1t2YWxdIC8vIHRydWUsIGZhbHNlLCBudWxsCiAgICAgICAgICAgIDogdmFsOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0cmluZwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoIGtleXNfbGFzdCApIHsKICAgICAgICAgIC8vIENvbXBsZXgga2V5LCBidWlsZCBkZWVwIG9iamVjdCBzdHJ1Y3R1cmUgYmFzZWQgb24gYSBmZXcgcnVsZXM6CiAgICAgICAgICAvLyAqIFRoZSAnY3VyJyBwb2ludGVyIHN0YXJ0cyBhdCB0aGUgb2JqZWN0IHRvcC1sZXZlbC4KICAgICAgICAgIC8vICogW10gPSBhcnJheSBwdXNoIChuIGlzIHNldCB0byBhcnJheSBsZW5ndGgpLCBbbl0gPSBhcnJheSBpZiBuIGlzIAogICAgICAgICAgLy8gICBudW1lcmljLCBvdGhlcndpc2Ugb2JqZWN0LgogICAgICAgICAgLy8gKiBJZiBhdCB0aGUgbGFzdCBrZXlzIHBhcnQsIHNldCB0aGUgdmFsdWUuCiAgICAgICAgICAvLyAqIEZvciBlYWNoIGtleXMgcGFydCwgaWYgdGhlIGN1cnJlbnQgbGV2ZWwgaXMgdW5kZWZpbmVkIGNyZWF0ZSBhbgogICAgICAgICAgLy8gICBvYmplY3Qgb3IgYXJyYXkgYmFzZWQgb24gdGhlIHR5cGUgb2YgdGhlIG5leHQga2V5cyBwYXJ0LgogICAgICAgICAgLy8gKiBNb3ZlIHRoZSAnY3VyJyBwb2ludGVyIHRvIHRoZSBuZXh0IGxldmVsLgogICAgICAgICAgLy8gKiBSaW5zZSAmIHJlcGVhdC4KICAgICAgICAgIGZvciAoIDsgaSA8PSBrZXlzX2xhc3Q7IGkrKyApIHsKICAgICAgICAgICAga2V5ID0ga2V5c1tpXSA9PT0gJycgPyBjdXIubGVuZ3RoIDoga2V5c1tpXTsKICAgICAgICAgICAgY3VyID0gY3VyW2tleV0gPSBpIDwga2V5c19sYXN0CiAgICAgICAgICAgICAgPyBjdXJba2V5XSB8fCAoIGtleXNbaSsxXSAmJiBpc05hTigga2V5c1tpKzFdICkgPyB7fSA6IFtdICkKICAgICAgICAgICAgICA6IHZhbDsKICAgICAgICAgIH0KICAgICAgICAgIAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBTaW1wbGUga2V5LCBldmVuIHNpbXBsZXIgcnVsZXMsIHNpbmNlIG9ubHkgc2NhbGFycyBhbmQgc2hhbGxvdwogICAgICAgICAgLy8gYXJyYXlzIGFyZSBhbGxvd2VkLgogICAgICAgICAgCiAgICAgICAgICBpZiAoICQuaXNBcnJheSggb2JqW2tleV0gKSApIHsKICAgICAgICAgICAgLy8gdmFsIGlzIGFscmVhZHkgYW4gYXJyYXksIHNvIHB1c2ggb24gdGhlIG5leHQgdmFsdWUuCiAgICAgICAgICAgIG9ialtrZXldLnB1c2goIHZhbCApOwogICAgICAgICAgICAKICAgICAgICAgIH0gZWxzZSBpZiAoIG9ialtrZXldICE9PSB1bmRlZmluZWQgKSB7CiAgICAgICAgICAgIC8vIHZhbCBpc24ndCBhbiBhcnJheSwgYnV0IHNpbmNlIGEgc2Vjb25kIHZhbHVlIGhhcyBiZWVuIHNwZWNpZmllZCwKICAgICAgICAgICAgLy8gY29udmVydCB2YWwgaW50byBhbiBhcnJheS4KICAgICAgICAgICAgb2JqW2tleV0gPSBbIG9ialtrZXldLCB2YWwgXTsKICAgICAgICAgICAgCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB2YWwgaXMgYSBzY2FsYXIuCiAgICAgICAgICAgIG9ialtrZXldID0gdmFsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgfSBlbHNlIGlmICgga2V5ICkgewogICAgICAgIC8vIE5vIHZhbHVlIHdhcyBkZWZpbmVkLCBzbyBzZXQgc29tZXRoaW5nIG1lYW5pbmdmdWwuCiAgICAgICAgb2JqW2tleV0gPSBjb2VyY2UKICAgICAgICAgID8gdW5kZWZpbmVkCiAgICAgICAgICA6ICcnOwogICAgICB9CiAgICB9KTsKICAgIAogICAgcmV0dXJuIG9iajsKICB9OwogIAogIC8vIE1ldGhvZDogalF1ZXJ5LmRlcGFyYW0ucXVlcnlzdHJpbmcKICAvLyAKICAvLyBQYXJzZSB0aGUgcXVlcnkgc3RyaW5nIGZyb20gYSBVUkwgb3IgdGhlIGN1cnJlbnQgd2luZG93LmxvY2F0aW9uLmhyZWYsCiAgLy8gZGVzZXJpYWxpemluZyBpdCBpbnRvIGFuIG9iamVjdCwgb3B0aW9uYWxseSBjb2VyY2luZyBudW1iZXJzLCBib29sZWFucywKICAvLyBudWxsIGFuZCB1bmRlZmluZWQgdmFsdWVzLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5LmRlcGFyYW0ucXVlcnlzdHJpbmcoIFsgdXJsIF0gWywgY29lcmNlIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIHVybCAtIChTdHJpbmcpIEFuIG9wdGlvbmFsIHBhcmFtcyBzdHJpbmcgb3IgVVJMIGNvbnRhaW5pbmcgcXVlcnkgc3RyaW5nCiAgLy8gICAgcGFyYW1zIHRvIGJlIHBhcnNlZC4gSWYgdXJsIGlzIG9taXR0ZWQsIHRoZSBjdXJyZW50CiAgLy8gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgaXMgdXNlZC4KICAvLyAgY29lcmNlIC0gKEJvb2xlYW4pIElmIHRydWUsIGNvZXJjZXMgYW55IG51bWJlcnMgb3IgdHJ1ZSwgZmFsc2UsIG51bGwsIGFuZAogIC8vICAgIHVuZGVmaW5lZCB0byB0aGVpciBhY3R1YWwgdmFsdWUuIERlZmF1bHRzIHRvIGZhbHNlIGlmIG9taXR0ZWQuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKE9iamVjdCkgQW4gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgZGVzZXJpYWxpemVkIHBhcmFtcyBzdHJpbmcuCiAgCiAgLy8gTWV0aG9kOiBqUXVlcnkuZGVwYXJhbS5mcmFnbWVudAogIC8vIAogIC8vIFBhcnNlIHRoZSBmcmFnbWVudCAoaGFzaCkgZnJvbSBhIFVSTCBvciB0aGUgY3VycmVudCB3aW5kb3cubG9jYXRpb24uaHJlZiwKICAvLyBkZXNlcmlhbGl6aW5nIGl0IGludG8gYW4gb2JqZWN0LCBvcHRpb25hbGx5IGNvZXJjaW5nIG51bWJlcnMsIGJvb2xlYW5zLAogIC8vIG51bGwgYW5kIHVuZGVmaW5lZCB2YWx1ZXMuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkuZGVwYXJhbS5mcmFnbWVudCggWyB1cmwgXSBbLCBjb2VyY2UgXSApOwogIC8vIAogIC8vIEFyZ3VtZW50czoKICAvLyAKICAvLyAgdXJsIC0gKFN0cmluZykgQW4gb3B0aW9uYWwgcGFyYW1zIHN0cmluZyBvciBVUkwgY29udGFpbmluZyBmcmFnbWVudCAoaGFzaCkKICAvLyAgICBwYXJhbXMgdG8gYmUgcGFyc2VkLiBJZiB1cmwgaXMgb21pdHRlZCwgdGhlIGN1cnJlbnQgd2luZG93LmxvY2F0aW9uLmhyZWYKICAvLyAgICBpcyB1c2VkLgogIC8vICBjb2VyY2UgLSAoQm9vbGVhbikgSWYgdHJ1ZSwgY29lcmNlcyBhbnkgbnVtYmVycyBvciB0cnVlLCBmYWxzZSwgbnVsbCwgYW5kCiAgLy8gICAgdW5kZWZpbmVkIHRvIHRoZWlyIGFjdHVhbCB2YWx1ZS4gRGVmYXVsdHMgdG8gZmFsc2UgaWYgb21pdHRlZC4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICAoT2JqZWN0KSBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBkZXNlcmlhbGl6ZWQgcGFyYW1zIHN0cmluZy4KICAKICBmdW5jdGlvbiBqcV9kZXBhcmFtX3N1YiggaXNfZnJhZ21lbnQsIHVybF9vcl9wYXJhbXMsIGNvZXJjZSApIHsKICAgIGlmICggdXJsX29yX3BhcmFtcyA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiB1cmxfb3JfcGFyYW1zID09PSAnYm9vbGVhbicgKSB7CiAgICAgIC8vIHVybF9vcl9wYXJhbXMgbm90IHNwZWNpZmllZC4KICAgICAgY29lcmNlID0gdXJsX29yX3BhcmFtczsKICAgICAgdXJsX29yX3BhcmFtcyA9IGpxX3BhcmFtWyBpc19mcmFnbWVudCA/IHN0cl9mcmFnbWVudCA6IHN0cl9xdWVyeXN0cmluZyBdKCk7CiAgICB9IGVsc2UgewogICAgICB1cmxfb3JfcGFyYW1zID0gaXNfc3RyaW5nKCB1cmxfb3JfcGFyYW1zICkKICAgICAgICA/IHVybF9vcl9wYXJhbXMucmVwbGFjZSggaXNfZnJhZ21lbnQgPyByZV9wYXJhbXNfZnJhZ21lbnQgOiByZV9wYXJhbXNfcXVlcnlzdHJpbmcsICcnICkKICAgICAgICA6IHVybF9vcl9wYXJhbXM7CiAgICB9CiAgICAKICAgIHJldHVybiBqcV9kZXBhcmFtKCB1cmxfb3JfcGFyYW1zLCBjb2VyY2UgKTsKICB9OwogIAogIGpxX2RlcGFyYW1bIHN0cl9xdWVyeXN0cmluZyBdICAgICAgICAgICAgICAgICAgICA9IGN1cnJ5KCBqcV9kZXBhcmFtX3N1YiwgMCApOwogIGpxX2RlcGFyYW1bIHN0cl9mcmFnbWVudCBdID0ganFfZGVwYXJhbV9mcmFnbWVudCA9IGN1cnJ5KCBqcV9kZXBhcmFtX3N1YiwgMSApOwogIAogIC8vIFNlY3Rpb246IEVsZW1lbnQgbWFuaXB1bGF0aW9uCiAgLy8gCiAgLy8gTWV0aG9kOiBqUXVlcnkuZWxlbVVybEF0dHIKICAvLyAKICAvLyBHZXQgdGhlIGludGVybmFsICJEZWZhdWx0IFVSTCBhdHRyaWJ1dGUgcGVyIHRhZyIgbGlzdCwgb3IgYXVnbWVudCB0aGUgbGlzdAogIC8vIHdpdGggYWRkaXRpb25hbCB0YWctYXR0cmlidXRlIHBhaXJzLCBpbiBjYXNlIHRoZSBkZWZhdWx0cyBhcmUgaW5zdWZmaWNpZW50LgogIC8vIAogIC8vIEluIHRoZSA8alF1ZXJ5LmZuLnF1ZXJ5c3RyaW5nPiBhbmQgPGpRdWVyeS5mbi5mcmFnbWVudD4gbWV0aG9kcywgdGhpcyBsaXN0CiAgLy8gaXMgdXNlZCB0byBkZXRlcm1pbmUgd2hpY2ggYXR0cmlidXRlIGNvbnRhaW5zIHRoZSBVUkwgdG8gYmUgbW9kaWZpZWQsIGlmCiAgLy8gYW4gImF0dHIiIHBhcmFtIGlzIG5vdCBzcGVjaWZpZWQuCiAgLy8gCiAgLy8gRGVmYXVsdCBUYWctQXR0cmlidXRlIExpc3Q6CiAgLy8gCiAgLy8gIGEgICAgICAtIGhyZWYKICAvLyAgYmFzZSAgIC0gaHJlZgogIC8vICBpZnJhbWUgLSBzcmMKICAvLyAgaW1nICAgIC0gc3JjCiAgLy8gIGlucHV0ICAtIHNyYwogIC8vICBmb3JtICAgLSBhY3Rpb24KICAvLyAgbGluayAgIC0gaHJlZgogIC8vICBzY3JpcHQgLSBzcmMKICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyA+IGpRdWVyeS5lbGVtVXJsQXR0ciggWyB0YWdfYXR0ciBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICB0YWdfYXR0ciAtIChPYmplY3QpIEFuIG9iamVjdCBjb250YWluaW5nIGEgbGlzdCBvZiB0YWcgbmFtZXMgYW5kIHRoZWlyCiAgLy8gICAgYXNzb2NpYXRlZCBkZWZhdWx0IGF0dHJpYnV0ZSBuYW1lcyBpbiB0aGUgZm9ybWF0IHsgdGFnOiAnYXR0cicsIC4uLiB9IHRvCiAgLy8gICAgYmUgbWVyZ2VkIGludG8gdGhlIGludGVybmFsIHRhZy1hdHRyaWJ1dGUgbGlzdC4KICAvLyAKICAvLyBSZXR1cm5zOgogIC8vIAogIC8vICAoT2JqZWN0KSBBbiBvYmplY3QgY29udGFpbmluZyBhbGwgc3RvcmVkIHRhZy1hdHRyaWJ1dGUgdmFsdWVzLgogIAogIC8vIE9ubHkgZGVmaW5lIGZ1bmN0aW9uIGFuZCBzZXQgZGVmYXVsdHMgaWYgZnVuY3Rpb24gZG9lc24ndCBhbHJlYWR5IGV4aXN0LCBhcwogIC8vIHRoZSB1cmxJbnRlcm5hbCBwbHVnaW4gd2lsbCBwcm92aWRlIHRoaXMgbWV0aG9kIGFzIHdlbGwuCiAgJFsgc3RyX2VsZW1VcmxBdHRyIF0gfHwgKCRbIHN0cl9lbGVtVXJsQXR0ciBdID0gZnVuY3Rpb24oIG9iaiApIHsKICAgIHJldHVybiAkLmV4dGVuZCggZWxlbVVybEF0dHJfY2FjaGUsIG9iaiApOwogIH0pKHsKICAgIGE6IHN0cl9ocmVmLAogICAgYmFzZTogc3RyX2hyZWYsCiAgICBpZnJhbWU6IHN0cl9zcmMsCiAgICBpbWc6IHN0cl9zcmMsCiAgICBpbnB1dDogc3RyX3NyYywKICAgIGZvcm06ICdhY3Rpb24nLAogICAgbGluazogc3RyX2hyZWYsCiAgICBzY3JpcHQ6IHN0cl9zcmMKICB9KTsKICAKICBqcV9lbGVtVXJsQXR0ciA9ICRbIHN0cl9lbGVtVXJsQXR0ciBdOwogIAogIC8vIE1ldGhvZDogalF1ZXJ5LmZuLnF1ZXJ5c3RyaW5nCiAgLy8gCiAgLy8gVXBkYXRlIFVSTCBhdHRyaWJ1dGUgaW4gb25lIG9yIG1vcmUgZWxlbWVudHMsIG1lcmdpbmcgdGhlIGN1cnJlbnQgVVJMICh3aXRoCiAgLy8gb3Igd2l0aG91dCBwcmUtZXhpc3RpbmcgcXVlcnkgc3RyaW5nIHBhcmFtcykgcGx1cyBhbnkgcGFyYW1zIG9iamVjdCBvcgogIC8vIHN0cmluZyBpbnRvIGEgbmV3IFVSTCwgd2hpY2ggaXMgdGhlbiBzZXQgaW50byB0aGF0IGF0dHJpYnV0ZS4gTGlrZQogIC8vIDxqUXVlcnkucGFyYW0ucXVlcnlzdHJpbmcgKGJ1aWxkIHVybCk+LCBidXQgZm9yIGFsbCBlbGVtZW50cyBpbiBhIGpRdWVyeQogIC8vIGNvbGxlY3Rpb24uCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkoJ3NlbGVjdG9yJykucXVlcnlzdHJpbmcoIFsgYXR0ciwgXSBwYXJhbXMgWywgbWVyZ2VfbW9kZSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICBhdHRyIC0gKFN0cmluZykgT3B0aW9uYWwgbmFtZSBvZiBhbiBhdHRyaWJ1dGUgdGhhdCB3aWxsIGNvbnRhaW4gYSBVUkwgdG8KICAvLyAgICBtZXJnZSBwYXJhbXMgb3IgdXJsIGludG8uIFNlZSA8alF1ZXJ5LmVsZW1VcmxBdHRyPiBmb3IgYSBsaXN0IG9mIGRlZmF1bHQKICAvLyAgICBhdHRyaWJ1dGVzLgogIC8vICBwYXJhbXMgLSAoT2JqZWN0KSBBIHBhcmFtcyBvYmplY3QgdG8gYmUgbWVyZ2VkIGludG8gdGhlIFVSTCBhdHRyaWJ1dGUuCiAgLy8gIHBhcmFtcyAtIChTdHJpbmcpIEEgVVJMIGNvbnRhaW5pbmcgcXVlcnkgc3RyaW5nIHBhcmFtcywgb3IgcGFyYW1zIHN0cmluZwogIC8vICAgIHRvIGJlIG1lcmdlZCBpbnRvIHRoZSBVUkwgYXR0cmlidXRlLgogIC8vICBtZXJnZV9tb2RlIC0gKE51bWJlcikgTWVyZ2UgYmVoYXZpb3IgZGVmYXVsdHMgdG8gMCBpZiBtZXJnZV9tb2RlIGlzIG5vdAogIC8vICAgIHNwZWNpZmllZCwgYW5kIGlzIGFzLWZvbGxvd3M6CiAgLy8gICAgCiAgLy8gICAgKiAwOiBwYXJhbXMgaW4gdGhlIHBhcmFtcyBhcmd1bWVudCB3aWxsIG92ZXJyaWRlIGFueSBwYXJhbXMgaW4gYXR0ciBVUkwuCiAgLy8gICAgKiAxOiBhbnkgcGFyYW1zIGluIGF0dHIgVVJMIHdpbGwgb3ZlcnJpZGUgcGFyYW1zIGluIHRoZSBwYXJhbXMgYXJndW1lbnQuCiAgLy8gICAgKiAyOiBwYXJhbXMgYXJndW1lbnQgd2lsbCBjb21wbGV0ZWx5IHJlcGxhY2UgYW55IHF1ZXJ5IHN0cmluZyBpbiBhdHRyCiAgLy8gICAgICAgICBVUkwuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKGpRdWVyeSkgVGhlIGluaXRpYWwgalF1ZXJ5IGNvbGxlY3Rpb24gb2YgZWxlbWVudHMsIGJ1dCB3aXRoIG1vZGlmaWVkIFVSTAogIC8vICBhdHRyaWJ1dGUgdmFsdWVzLgogIAogIC8vIE1ldGhvZDogalF1ZXJ5LmZuLmZyYWdtZW50CiAgLy8gCiAgLy8gVXBkYXRlIFVSTCBhdHRyaWJ1dGUgaW4gb25lIG9yIG1vcmUgZWxlbWVudHMsIG1lcmdpbmcgdGhlIGN1cnJlbnQgVVJMICh3aXRoCiAgLy8gb3Igd2l0aG91dCBwcmUtZXhpc3RpbmcgZnJhZ21lbnQvaGFzaCBwYXJhbXMpIHBsdXMgYW55IHBhcmFtcyBvYmplY3Qgb3IKICAvLyBzdHJpbmcgaW50byBhIG5ldyBVUkwsIHdoaWNoIGlzIHRoZW4gc2V0IGludG8gdGhhdCBhdHRyaWJ1dGUuIExpa2UKICAvLyA8alF1ZXJ5LnBhcmFtLmZyYWdtZW50IChidWlsZCB1cmwpPiwgYnV0IGZvciBhbGwgZWxlbWVudHMgaW4gYSBqUXVlcnkKICAvLyBjb2xsZWN0aW9uLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5KCdzZWxlY3RvcicpLmZyYWdtZW50KCBbIGF0dHIsIF0gcGFyYW1zIFssIG1lcmdlX21vZGUgXSApOwogIC8vIAogIC8vIEFyZ3VtZW50czoKICAvLyAKICAvLyAgYXR0ciAtIChTdHJpbmcpIE9wdGlvbmFsIG5hbWUgb2YgYW4gYXR0cmlidXRlIHRoYXQgd2lsbCBjb250YWluIGEgVVJMIHRvCiAgLy8gICAgbWVyZ2UgcGFyYW1zIGludG8uIFNlZSA8alF1ZXJ5LmVsZW1VcmxBdHRyPiBmb3IgYSBsaXN0IG9mIGRlZmF1bHQKICAvLyAgICBhdHRyaWJ1dGVzLgogIC8vICBwYXJhbXMgLSAoT2JqZWN0KSBBIHBhcmFtcyBvYmplY3QgdG8gYmUgbWVyZ2VkIGludG8gdGhlIFVSTCBhdHRyaWJ1dGUuCiAgLy8gIHBhcmFtcyAtIChTdHJpbmcpIEEgVVJMIGNvbnRhaW5pbmcgZnJhZ21lbnQgKGhhc2gpIHBhcmFtcywgb3IgcGFyYW1zCiAgLy8gICAgc3RyaW5nIHRvIGJlIG1lcmdlZCBpbnRvIHRoZSBVUkwgYXR0cmlidXRlLgogIC8vICBtZXJnZV9tb2RlIC0gKE51bWJlcikgTWVyZ2UgYmVoYXZpb3IgZGVmYXVsdHMgdG8gMCBpZiBtZXJnZV9tb2RlIGlzIG5vdAogIC8vICAgIHNwZWNpZmllZCwgYW5kIGlzIGFzLWZvbGxvd3M6CiAgLy8gICAgCiAgLy8gICAgKiAwOiBwYXJhbXMgaW4gdGhlIHBhcmFtcyBhcmd1bWVudCB3aWxsIG92ZXJyaWRlIGFueSBwYXJhbXMgaW4gYXR0ciBVUkwuCiAgLy8gICAgKiAxOiBhbnkgcGFyYW1zIGluIGF0dHIgVVJMIHdpbGwgb3ZlcnJpZGUgcGFyYW1zIGluIHRoZSBwYXJhbXMgYXJndW1lbnQuCiAgLy8gICAgKiAyOiBwYXJhbXMgYXJndW1lbnQgd2lsbCBjb21wbGV0ZWx5IHJlcGxhY2UgYW55IGZyYWdtZW50IChoYXNoKSBpbiBhdHRyCiAgLy8gICAgICAgICBVUkwuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKGpRdWVyeSkgVGhlIGluaXRpYWwgalF1ZXJ5IGNvbGxlY3Rpb24gb2YgZWxlbWVudHMsIGJ1dCB3aXRoIG1vZGlmaWVkIFVSTAogIC8vICBhdHRyaWJ1dGUgdmFsdWVzLgogIAogIGZ1bmN0aW9uIGpxX2ZuX3N1YiggbW9kZSwgZm9yY2VfYXR0ciwgcGFyYW1zLCBtZXJnZV9tb2RlICkgewogICAgaWYgKCAhaXNfc3RyaW5nKCBwYXJhbXMgKSAmJiB0eXBlb2YgcGFyYW1zICE9PSAnb2JqZWN0JyApIHsKICAgICAgLy8gZm9yY2VfYXR0ciBub3Qgc3BlY2lmaWVkLgogICAgICBtZXJnZV9tb2RlID0gcGFyYW1zOwogICAgICBwYXJhbXMgPSBmb3JjZV9hdHRyOwogICAgICBmb3JjZV9hdHRyID0gdW5kZWZpbmVkOwogICAgfQogICAgCiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgIHZhciB0aGF0ID0gJCh0aGlzKSwKICAgICAgICAKICAgICAgICAvLyBHZXQgYXR0cmlidXRlIHNwZWNpZmllZCwgb3IgZGVmYXVsdCBzcGVjaWZpZWQgdmlhICQuZWxlbVVybEF0dHIuCiAgICAgICAgYXR0ciA9IGZvcmNlX2F0dHIgfHwganFfZWxlbVVybEF0dHIoKVsgKCB0aGlzLm5vZGVOYW1lIHx8ICcnICkudG9Mb3dlckNhc2UoKSBdIHx8ICcnLAogICAgICAgIAogICAgICAgIC8vIEdldCBVUkwgdmFsdWUuCiAgICAgICAgdXJsID0gYXR0ciAmJiB0aGF0LmF0dHIoIGF0dHIgKSB8fCAnJzsKICAgICAgCiAgICAgIC8vIFVwZGF0ZSBhdHRyaWJ1dGUgd2l0aCBuZXcgVVJMLgogICAgICB0aGF0LmF0dHIoIGF0dHIsIGpxX3BhcmFtWyBtb2RlIF0oIHVybCwgcGFyYW1zLCBtZXJnZV9tb2RlICkgKTsKICAgIH0pOwogICAgCiAgfTsKICAKICAkLmZuWyBzdHJfcXVlcnlzdHJpbmcgXSA9IGN1cnJ5KCBqcV9mbl9zdWIsIHN0cl9xdWVyeXN0cmluZyApOwogICQuZm5bIHN0cl9mcmFnbWVudCBdICAgID0gY3VycnkoIGpxX2ZuX3N1Yiwgc3RyX2ZyYWdtZW50ICk7CiAgCiAgLy8gU2VjdGlvbjogSGlzdG9yeSwgaGFzaGNoYW5nZSBldmVudAogIC8vIAogIC8vIE1ldGhvZDogalF1ZXJ5LmJicS5wdXNoU3RhdGUKICAvLyAKICAvLyBBZGRzIGEgJ3N0YXRlJyBpbnRvIHRoZSBicm93c2VyIGhpc3RvcnkgYXQgdGhlIGN1cnJlbnQgcG9zaXRpb24sIHNldHRpbmcKICAvLyBsb2NhdGlvbi5oYXNoIGFuZCB0cmlnZ2VyaW5nIGFueSBib3VuZCA8aGFzaGNoYW5nZSBldmVudD4gY2FsbGJhY2tzCiAgLy8gKHByb3ZpZGVkIHRoZSBuZXcgc3RhdGUgaXMgZGlmZmVyZW50IHRoYW4gdGhlIHByZXZpb3VzIHN0YXRlKS4KICAvLyAKICAvLyBJZiBubyBhcmd1bWVudHMgYXJlIHBhc3NlZCwgYW4gZW1wdHkgc3RhdGUgaXMgY3JlYXRlZCwgd2hpY2ggaXMganVzdCBhCiAgLy8gc2hvcnRjdXQgZm9yIGpRdWVyeS5iYnEucHVzaFN0YXRlKCB7fSwgMiApLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5LmJicS5wdXNoU3RhdGUoIFsgcGFyYW1zIFssIG1lcmdlX21vZGUgXSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICBwYXJhbXMgLSAoU3RyaW5nKSBBIHNlcmlhbGl6ZWQgcGFyYW1zIHN0cmluZyBvciBhIGhhc2ggc3RyaW5nIGJlZ2lubmluZwogIC8vICAgIHdpdGggIyB0byBtZXJnZSBpbnRvIGxvY2F0aW9uLmhhc2guCiAgLy8gIHBhcmFtcyAtIChPYmplY3QpIEEgcGFyYW1zIG9iamVjdCB0byBtZXJnZSBpbnRvIGxvY2F0aW9uLmhhc2guCiAgLy8gIG1lcmdlX21vZGUgLSAoTnVtYmVyKSBNZXJnZSBiZWhhdmlvciBkZWZhdWx0cyB0byAwIGlmIG1lcmdlX21vZGUgaXMgbm90CiAgLy8gICAgc3BlY2lmaWVkICh1bmxlc3MgYSBoYXNoIHN0cmluZyBiZWdpbm5pbmcgd2l0aCAjIGlzIHNwZWNpZmllZCwgaW4gd2hpY2gKICAvLyAgICBjYXNlIG1lcmdlIGJlaGF2aW9yIGRlZmF1bHRzIHRvIDIpLCBhbmQgaXMgYXMtZm9sbG93czoKICAvLyAKICAvLyAgICAqIDA6IHBhcmFtcyBpbiB0aGUgcGFyYW1zIGFyZ3VtZW50IHdpbGwgb3ZlcnJpZGUgYW55IHBhcmFtcyBpbiB0aGUKICAvLyAgICAgICAgIGN1cnJlbnQgc3RhdGUuCiAgLy8gICAgKiAxOiBhbnkgcGFyYW1zIGluIHRoZSBjdXJyZW50IHN0YXRlIHdpbGwgb3ZlcnJpZGUgcGFyYW1zIGluIHRoZSBwYXJhbXMKICAvLyAgICAgICAgIGFyZ3VtZW50LgogIC8vICAgICogMjogcGFyYW1zIGFyZ3VtZW50IHdpbGwgY29tcGxldGVseSByZXBsYWNlIGN1cnJlbnQgc3RhdGUuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgTm90aGluZy4KICAvLyAKICAvLyBBZGRpdGlvbmFsIE5vdGVzOgogIC8vIAogIC8vICAqIFNldHRpbmcgYW4gZW1wdHkgc3RhdGUgbWF5IGNhdXNlIHRoZSBicm93c2VyIHRvIHNjcm9sbC4KICAvLyAgKiBVbmxpa2UgdGhlIGZyYWdtZW50IGFuZCBxdWVyeXN0cmluZyBtZXRob2RzLCBpZiBhIGhhc2ggc3RyaW5nIGJlZ2lubmluZwogIC8vICAgIHdpdGggIyBpcyBzcGVjaWZpZWQgYXMgdGhlIHBhcmFtcyBhZ3J1bWVudCwgbWVyZ2VfbW9kZSBkZWZhdWx0cyB0byAyLgogIAogIGpxX2JicS5wdXNoU3RhdGUgPSBqcV9iYnFfcHVzaFN0YXRlID0gZnVuY3Rpb24oIHBhcmFtcywgbWVyZ2VfbW9kZSApIHsKICAgIGlmICggaXNfc3RyaW5nKCBwYXJhbXMgKSAmJiAvXiMvLnRlc3QoIHBhcmFtcyApICYmIG1lcmdlX21vZGUgPT09IHVuZGVmaW5lZCApIHsKICAgICAgLy8gUGFyYW1zIHN0cmluZyBiZWdpbnMgd2l0aCAjIGFuZCBtZXJnZV9tb2RlIG5vdCBzcGVjaWZpZWQsIHNvIGNvbXBsZXRlbHkKICAgICAgLy8gb3ZlcndyaXRlIHdpbmRvdy5sb2NhdGlvbi5oYXNoLgogICAgICBtZXJnZV9tb2RlID0gMjsKICAgIH0KICAgIAogICAgdmFyIGhhc19hcmdzID0gcGFyYW1zICE9PSB1bmRlZmluZWQsCiAgICAgIC8vIE1lcmdlIHBhcmFtcyBpbnRvIHdpbmRvdy5sb2NhdGlvbiB1c2luZyAkLnBhcmFtLmZyYWdtZW50LgogICAgICB1cmwgPSBqcV9wYXJhbV9mcmFnbWVudCggbG9jYXRpb24uaHJlZiwKICAgICAgICBoYXNfYXJncyA/IHBhcmFtcyA6IHt9LCBoYXNfYXJncyA/IG1lcmdlX21vZGUgOiAyICk7CiAgICAKICAgIC8vIFNldCBuZXcgd2luZG93LmxvY2F0aW9uLmhyZWYuIE5vdGUgdGhhdCBTYWZhcmkgMyAmIENocm9tZSBiYXJmIG9uCiAgICAvLyBsb2NhdGlvbi5oYXNoID0gJyMnIHNvIHRoZSBlbnRpcmUgVVJMIGlzIHNldC4KICAgIGxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgfTsKICAKICAvLyBNZXRob2Q6IGpRdWVyeS5iYnEuZ2V0U3RhdGUKICAvLyAKICAvLyBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgJ3N0YXRlJyBmcm9tIHRoZSBicm93c2VyIGhpc3RvcnksIHBhcnNpbmcKICAvLyBsb2NhdGlvbi5oYXNoIGZvciBhIHNwZWNpZmljIGtleSBvciByZXR1cm5pbmcgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlCiAgLy8gZW50aXJlIHN0YXRlLCBvcHRpb25hbGx5IGNvZXJjaW5nIG51bWJlcnMsIGJvb2xlYW5zLCBudWxsIGFuZCB1bmRlZmluZWQKICAvLyB2YWx1ZXMuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8gPiBqUXVlcnkuYmJxLmdldFN0YXRlKCBbIGtleSBdIFssIGNvZXJjZSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICBrZXkgLSAoU3RyaW5nKSBBbiBvcHRpb25hbCBzdGF0ZSBrZXkgZm9yIHdoaWNoIHRvIHJldHVybiBhIHZhbHVlLgogIC8vICBjb2VyY2UgLSAoQm9vbGVhbikgSWYgdHJ1ZSwgY29lcmNlcyBhbnkgbnVtYmVycyBvciB0cnVlLCBmYWxzZSwgbnVsbCwgYW5kCiAgLy8gICAgdW5kZWZpbmVkIHRvIHRoZWlyIGFjdHVhbCB2YWx1ZS4gRGVmYXVsdHMgdG8gZmFsc2UuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgKEFueXRoaW5nKSBJZiBrZXkgaXMgcGFzc2VkLCByZXR1cm5zIHRoZSB2YWx1ZSBjb3JyZXNwb25kaW5nIHdpdGggdGhhdCBrZXkKICAvLyAgICBpbiB0aGUgbG9jYXRpb24uaGFzaCAnc3RhdGUnLCBvciB1bmRlZmluZWQuIElmIG5vdCwgYW4gb2JqZWN0CiAgLy8gICAgcmVwcmVzZW50aW5nIHRoZSBlbnRpcmUgJ3N0YXRlJyBpcyByZXR1cm5lZC4KICAKICBqcV9iYnEuZ2V0U3RhdGUgPSBqcV9iYnFfZ2V0U3RhdGUgPSBmdW5jdGlvbigga2V5LCBjb2VyY2UgKSB7CiAgICByZXR1cm4ga2V5ID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIGtleSA9PT0gJ2Jvb2xlYW4nCiAgICAgID8ganFfZGVwYXJhbV9mcmFnbWVudCgga2V5ICkgLy8gJ2tleScgcmVhbGx5IG1lYW5zICdjb2VyY2UnIGhlcmUKICAgICAgOiBqcV9kZXBhcmFtX2ZyYWdtZW50KCBjb2VyY2UgKVsga2V5IF07CiAgfTsKICAKICAvLyBNZXRob2Q6IGpRdWVyeS5iYnEucmVtb3ZlU3RhdGUKICAvLyAKICAvLyBSZW1vdmUgb25lIG9yIG1vcmUga2V5cyBmcm9tIHRoZSBjdXJyZW50IGJyb3dzZXIgaGlzdG9yeSAnc3RhdGUnLCBjcmVhdGluZwogIC8vIGEgbmV3IHN0YXRlLCBzZXR0aW5nIGxvY2F0aW9uLmhhc2ggYW5kIHRyaWdnZXJpbmcgYW55IGJvdW5kCiAgLy8gPGhhc2hjaGFuZ2UgZXZlbnQ+IGNhbGxiYWNrcyAocHJvdmlkZWQgdGhlIG5ldyBzdGF0ZSBpcyBkaWZmZXJlbnQgdGhhbgogIC8vIHRoZSBwcmV2aW91cyBzdGF0ZSkuCiAgLy8gCiAgLy8gSWYgbm8gYXJndW1lbnRzIGFyZSBwYXNzZWQsIGFuIGVtcHR5IHN0YXRlIGlzIGNyZWF0ZWQsIHdoaWNoIGlzIGp1c3QgYQogIC8vIHNob3J0Y3V0IGZvciBqUXVlcnkuYmJxLnB1c2hTdGF0ZSgge30sIDIgKS4KICAvLyAKICAvLyBVc2FnZToKICAvLyAKICAvLyA+IGpRdWVyeS5iYnEucmVtb3ZlU3RhdGUoIFsga2V5IFssIGtleSAuLi4gXSBdICk7CiAgLy8gCiAgLy8gQXJndW1lbnRzOgogIC8vIAogIC8vICBrZXkgLSAoU3RyaW5nKSBPbmUgb3IgbW9yZSBrZXkgdmFsdWVzIHRvIHJlbW92ZSBmcm9tIHRoZSBjdXJyZW50IHN0YXRlLAogIC8vICAgIHBhc3NlZCBhcyBpbmRpdmlkdWFsIGFyZ3VtZW50cy4KICAvLyAga2V5IC0gKEFycmF5KSBBIHNpbmdsZSBhcnJheSBhcmd1bWVudCB0aGF0IGNvbnRhaW5zIGEgbGlzdCBvZiBrZXkgdmFsdWVzCiAgLy8gICAgdG8gcmVtb3ZlIGZyb20gdGhlIGN1cnJlbnQgc3RhdGUuCiAgLy8gCiAgLy8gUmV0dXJuczoKICAvLyAKICAvLyAgTm90aGluZy4KICAvLyAKICAvLyBBZGRpdGlvbmFsIE5vdGVzOgogIC8vIAogIC8vICAqIFNldHRpbmcgYW4gZW1wdHkgc3RhdGUgbWF5IGNhdXNlIHRoZSBicm93c2VyIHRvIHNjcm9sbC4KICAKICBqcV9iYnEucmVtb3ZlU3RhdGUgPSBmdW5jdGlvbiggYXJyICkgewogICAgdmFyIHN0YXRlID0ge307CiAgICAKICAgIC8vIElmIG9uZSBvciBtb3JlIGFyZ3VtZW50cyBpcyBwYXNzZWQuLgogICAgaWYgKCBhcnIgIT09IHVuZGVmaW5lZCApIHsKICAgICAgCiAgICAgIC8vIEdldCB0aGUgY3VycmVudCBzdGF0ZS4KICAgICAgc3RhdGUgPSBqcV9iYnFfZ2V0U3RhdGUoKTsKICAgICAgCiAgICAgIC8vIEZvciBlYWNoIHBhc3NlZCBrZXksIGRlbGV0ZSB0aGUgY29ycmVzcG9uZGluZyBwcm9wZXJ0eSBmcm9tIHRoZSBjdXJyZW50CiAgICAgIC8vIHN0YXRlLgogICAgICAkLmVhY2goICQuaXNBcnJheSggYXJyICkgPyBhcnIgOiBhcmd1bWVudHMsIGZ1bmN0aW9uKGksdil7CiAgICAgICAgZGVsZXRlIHN0YXRlWyB2IF07CiAgICAgIH0pOwogICAgfQogICAgCiAgICAvLyBTZXQgdGhlIHN0YXRlLCBjb21wbGV0ZWx5IG92ZXJyaWRpbmcgYW55IGV4aXN0aW5nIHN0YXRlLgogICAganFfYmJxX3B1c2hTdGF0ZSggc3RhdGUsIDIgKTsKICB9OwogIAogIC8vIEV2ZW50OiBoYXNoY2hhbmdlIGV2ZW50IChCQlEpCiAgLy8gCiAgLy8gVXNhZ2UgaW4galF1ZXJ5IDEuNCBhbmQgbmV3ZXI6CiAgLy8gCiAgLy8gSW4galF1ZXJ5IDEuNCBhbmQgbmV3ZXIsIHRoZSBldmVudCBvYmplY3QgcGFzc2VkIGludG8gYW55IGhhc2hjaGFuZ2UgZXZlbnQKICAvLyBjYWxsYmFjayBpcyBhdWdtZW50ZWQgd2l0aCBhIGNvcHkgb2YgdGhlIGxvY2F0aW9uLmhhc2ggZnJhZ21lbnQgYXQgdGhlIHRpbWUKICAvLyB0aGUgZXZlbnQgd2FzIHRyaWdnZXJlZCBhcyBpdHMgZXZlbnQuZnJhZ21lbnQgcHJvcGVydHkuIEluIGFkZGl0aW9uLCB0aGUKICAvLyBldmVudC5nZXRTdGF0ZSBtZXRob2Qgb3BlcmF0ZXMgb24gdGhpcyBwcm9wZXJ0eSAoaW5zdGVhZCBvZiBsb2NhdGlvbi5oYXNoKQogIC8vIHdoaWNoIGFsbG93cyB0aGlzIGZyYWdtZW50LWFzLWEtc3RhdGUgdG8gYmUgcmVmZXJlbmNlZCBsYXRlciwgZXZlbiBhZnRlcgogIC8vIHdpbmRvdy5sb2NhdGlvbiBtYXkgaGF2ZSBjaGFuZ2VkLgogIC8vIAogIC8vIE5vdGUgdGhhdCBldmVudC5mcmFnbWVudCBhbmQgZXZlbnQuZ2V0U3RhdGUgYXJlIG5vdCBkZWZpbmVkIGFjY29yZGluZyB0bwogIC8vIFczQyAob3IgYW55IG90aGVyKSBzcGVjaWZpY2F0aW9uLCBidXQgd2lsbCBzdGlsbCBiZSBhdmFpbGFibGUgd2hldGhlciBvcgogIC8vIG5vdCB0aGUgaGFzaGNoYW5nZSBldmVudCBleGlzdHMgbmF0aXZlbHkgaW4gdGhlIGJyb3dzZXIsIGJlY2F1c2Ugb2YgdGhlCiAgLy8gdXRpbGl0eSB0aGV5IHByb3ZpZGUuCiAgLy8gCiAgLy8gVGhlIGV2ZW50LmZyYWdtZW50IHByb3BlcnR5IGNvbnRhaW5zIHRoZSBvdXRwdXQgb2YgPGpRdWVyeS5wYXJhbS5mcmFnbWVudD4KICAvLyBhbmQgdGhlIGV2ZW50LmdldFN0YXRlIG1ldGhvZCBpcyBlcXVpdmFsZW50IHRvIHRoZSA8alF1ZXJ5LmJicS5nZXRTdGF0ZT4KICAvLyBtZXRob2QuCiAgLy8gCiAgLy8gPiAkKHdpbmRvdykuYmluZCggJ2hhc2hjaGFuZ2UnLCBmdW5jdGlvbiggZXZlbnQgKSB7CiAgLy8gPiAgIHZhciBoYXNoX3N0ciA9IGV2ZW50LmZyYWdtZW50LAogIC8vID4gICAgIHBhcmFtX29iaiA9IGV2ZW50LmdldFN0YXRlKCksCiAgLy8gPiAgICAgcGFyYW1fdmFsID0gZXZlbnQuZ2V0U3RhdGUoICdwYXJhbV9uYW1lJyApLAogIC8vID4gICAgIHBhcmFtX3ZhbF9jb2VyY2VkID0gZXZlbnQuZ2V0U3RhdGUoICdwYXJhbV9uYW1lJywgdHJ1ZSApOwogIC8vID4gICAuLi4KICAvLyA+IH0pOwogIC8vIAogIC8vIFVzYWdlIGluIGpRdWVyeSAxLjMuMjoKICAvLyAKICAvLyBJbiBqUXVlcnkgMS4zLjIsIHRoZSBldmVudCBvYmplY3QgY2Fubm90IHRvIGJlIGF1Z21lbnRlZCBhcyBpbiBqUXVlcnkgMS40KywKICAvLyBzbyB0aGUgZnJhZ21lbnQgc3RhdGUgaXNuJ3QgYm91bmQgdG8gdGhlIGV2ZW50IG9iamVjdCBhbmQgbXVzdCBpbnN0ZWFkIGJlCiAgLy8gcGFyc2VkIHVzaW5nIHRoZSA8alF1ZXJ5LnBhcmFtLmZyYWdtZW50PiBhbmQgPGpRdWVyeS5iYnEuZ2V0U3RhdGU+IG1ldGhvZHMuCiAgLy8gCiAgLy8gPiAkKHdpbmRvdykuYmluZCggJ2hhc2hjaGFuZ2UnLCBmdW5jdGlvbiggZXZlbnQgKSB7CiAgLy8gPiAgIHZhciBoYXNoX3N0ciA9ICQucGFyYW0uZnJhZ21lbnQoKSwKICAvLyA+ICAgICBwYXJhbV9vYmogPSAkLmJicS5nZXRTdGF0ZSgpLAogIC8vID4gICAgIHBhcmFtX3ZhbCA9ICQuYmJxLmdldFN0YXRlKCAncGFyYW1fbmFtZScgKSwKICAvLyA+ICAgICBwYXJhbV92YWxfY29lcmNlZCA9ICQuYmJxLmdldFN0YXRlKCAncGFyYW1fbmFtZScsIHRydWUgKTsKICAvLyA+ICAgLi4uCiAgLy8gPiB9KTsKICAvLyAKICAvLyBBZGRpdGlvbmFsIE5vdGVzOgogIC8vIAogIC8vICogRHVlIHRvIGNoYW5nZXMgaW4gdGhlIHNwZWNpYWwgZXZlbnRzIEFQSSwgalF1ZXJ5IEJCUSB2MS4yIG9yIG5ld2VyIGlzCiAgLy8gICByZXF1aXJlZCB0byBlbmFibGUgdGhlIGF1Z21lbnRlZCBldmVudCBvYmplY3QgaW4galF1ZXJ5IDEuNC4yIGFuZCBuZXdlci4KICAvLyAqIFNlZSA8alF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQ+IGZvciBtb3JlIGRldGFpbGVkIGluZm9ybWF0aW9uLgogIAogIHNwZWNpYWxbIHN0cl9oYXNoY2hhbmdlIF0gPSAkLmV4dGVuZCggc3BlY2lhbFsgc3RyX2hhc2hjaGFuZ2UgXSwgewogICAgCiAgICAvLyBBdWdtZW50aW5nIHRoZSBldmVudCBvYmplY3Qgd2l0aCB0aGUgLmZyYWdtZW50IHByb3BlcnR5IGFuZCAuZ2V0U3RhdGUKICAgIC8vIG1ldGhvZCByZXF1aXJlcyBqUXVlcnkgMS40IG9yIG5ld2VyLiBOb3RlOiB3aXRoIDEuMy4yLCBldmVyeXRoaW5nIHdpbGwKICAgIC8vIHdvcmssIGJ1dCB0aGUgZXZlbnQgd29uJ3QgYmUgYXVnbWVudGVkKQogICAgYWRkOiBmdW5jdGlvbiggaGFuZGxlT2JqICkgewogICAgICB2YXIgb2xkX2hhbmRsZXI7CiAgICAgIAogICAgICBmdW5jdGlvbiBuZXdfaGFuZGxlcihlKSB7CiAgICAgICAgLy8gZS5mcmFnbWVudCBpcyBzZXQgdG8gdGhlIHZhbHVlIG9mIGxvY2F0aW9uLmhhc2ggKHdpdGggYW55IGxlYWRpbmcgIwogICAgICAgIC8vIHJlbW92ZWQpIGF0IHRoZSB0aW1lIHRoZSBldmVudCBpcyB0cmlnZ2VyZWQuCiAgICAgICAgdmFyIGhhc2ggPSBlWyBzdHJfZnJhZ21lbnQgXSA9IGpxX3BhcmFtX2ZyYWdtZW50KCk7CiAgICAgICAgCiAgICAgICAgLy8gZS5nZXRTdGF0ZSgpIHdvcmtzIGp1c3QgbGlrZSAkLmJicS5nZXRTdGF0ZSgpLCBidXQgdXNlcyB0aGUKICAgICAgICAvLyBlLmZyYWdtZW50IHByb3BlcnR5IHN0b3JlZCBvbiB0aGUgZXZlbnQgb2JqZWN0LgogICAgICAgIGUuZ2V0U3RhdGUgPSBmdW5jdGlvbigga2V5LCBjb2VyY2UgKSB7CiAgICAgICAgICByZXR1cm4ga2V5ID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIGtleSA9PT0gJ2Jvb2xlYW4nCiAgICAgICAgICAgID8ganFfZGVwYXJhbSggaGFzaCwga2V5ICkgLy8gJ2tleScgcmVhbGx5IG1lYW5zICdjb2VyY2UnIGhlcmUKICAgICAgICAgICAgOiBqcV9kZXBhcmFtKCBoYXNoLCBjb2VyY2UgKVsga2V5IF07CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBvbGRfaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CiAgICAgIH07CiAgICAgIAogICAgICAvLyBUaGlzIG1heSBzZWVtIGEgbGl0dGxlIGNvbXBsaWNhdGVkLCBidXQgaXQgbm9ybWFsaXplcyB0aGUgc3BlY2lhbCBldmVudAogICAgICAvLyAuYWRkIG1ldGhvZCBiZXR3ZWVuIGpRdWVyeSAxLjQvMS40LjEgYW5kIDEuNC4yKwogICAgICBpZiAoICQuaXNGdW5jdGlvbiggaGFuZGxlT2JqICkgKSB7CiAgICAgICAgLy8gMS40LCAxLjQuMQogICAgICAgIG9sZF9oYW5kbGVyID0gaGFuZGxlT2JqOwogICAgICAgIHJldHVybiBuZXdfaGFuZGxlcjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyAxLjQuMisKICAgICAgICBvbGRfaGFuZGxlciA9IGhhbmRsZU9iai5oYW5kbGVyOwogICAgICAgIGhhbmRsZU9iai5oYW5kbGVyID0gbmV3X2hhbmRsZXI7CiAgICAgIH0KICAgIH0KICAgIAogIH0pOwogIAp9KShqUXVlcnksdGhpcyk7CgovKiEKICogalF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQgLSB2MS4zIC0gNy8yMS8yMDEwCiAqIGh0dHA6Ly9iZW5hbG1hbi5jb20vcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UtcGx1Z2luLwogKiAKICogQ29weXJpZ2h0IChjKSAyMDEwICJDb3dib3kiIEJlbiBBbG1hbgogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlcy4KICogaHR0cDovL2JlbmFsbWFuLmNvbS9hYm91dC9saWNlbnNlLwogKi8KCi8vIFNjcmlwdDogalF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQKLy8KLy8gKlZlcnNpb246IDEuMywgTGFzdCB1cGRhdGVkOiA3LzIxLzIwMTAqCi8vIAovLyBQcm9qZWN0IEhvbWUgLSBodHRwOi8vYmVuYWxtYW4uY29tL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlLXBsdWdpbi8KLy8gR2l0SHViICAgICAgIC0gaHR0cDovL2dpdGh1Yi5jb20vY293Ym95L2pxdWVyeS1oYXNoY2hhbmdlLwovLyBTb3VyY2UgICAgICAgLSBodHRwOi8vZ2l0aHViLmNvbS9jb3dib3kvanF1ZXJ5LWhhc2hjaGFuZ2UvcmF3L21hc3Rlci9qcXVlcnkuYmEtaGFzaGNoYW5nZS5qcwovLyAoTWluaWZpZWQpICAgLSBodHRwOi8vZ2l0aHViLmNvbS9jb3dib3kvanF1ZXJ5LWhhc2hjaGFuZ2UvcmF3L21hc3Rlci9qcXVlcnkuYmEtaGFzaGNoYW5nZS5taW4uanMgKDAuOGtiIGd6aXBwZWQpCi8vIAovLyBBYm91dDogTGljZW5zZQovLyAKLy8gQ29weXJpZ2h0IChjKSAyMDEwICJDb3dib3kiIEJlbiBBbG1hbiwKLy8gRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXMuCi8vIGh0dHA6Ly9iZW5hbG1hbi5jb20vYWJvdXQvbGljZW5zZS8KLy8gCi8vIEFib3V0OiBFeGFtcGxlcwovLyAKLy8gVGhlc2Ugd29ya2luZyBleGFtcGxlcywgY29tcGxldGUgd2l0aCBmdWxseSBjb21tZW50ZWQgY29kZSwgaWxsdXN0cmF0ZSBhIGZldwovLyB3YXlzIGluIHdoaWNoIHRoaXMgcGx1Z2luIGNhbiBiZSB1c2VkLgovLyAKLy8gaGFzaGNoYW5nZSBldmVudCAtIGh0dHA6Ly9iZW5hbG1hbi5jb20vY29kZS9wcm9qZWN0cy9qcXVlcnktaGFzaGNoYW5nZS9leGFtcGxlcy9oYXNoY2hhbmdlLwovLyBkb2N1bWVudC5kb21haW4gLSBodHRwOi8vYmVuYWxtYW4uY29tL2NvZGUvcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UvZXhhbXBsZXMvZG9jdW1lbnRfZG9tYWluLwovLyAKLy8gQWJvdXQ6IFN1cHBvcnQgYW5kIFRlc3RpbmcKLy8gCi8vIEluZm9ybWF0aW9uIGFib3V0IHdoYXQgdmVyc2lvbiBvciB2ZXJzaW9ucyBvZiBqUXVlcnkgdGhpcyBwbHVnaW4gaGFzIGJlZW4KLy8gdGVzdGVkIHdpdGgsIHdoYXQgYnJvd3NlcnMgaXQgaGFzIGJlZW4gdGVzdGVkIGluLCBhbmQgd2hlcmUgdGhlIHVuaXQgdGVzdHMKLy8gcmVzaWRlIChzbyB5b3UgY2FuIHRlc3QgaXQgeW91cnNlbGYpLgovLyAKLy8galF1ZXJ5IFZlcnNpb25zIC0gMS4yLjYsIDEuMy4yLCAxLjQuMSwgMS40LjIKLy8gQnJvd3NlcnMgVGVzdGVkIC0gSW50ZXJuZXQgRXhwbG9yZXIgNi04LCBGaXJlZm94IDItNCwgQ2hyb21lIDUtNiwgU2FmYXJpIDMuMi01LAovLyAgICAgICAgICAgICAgICAgICBPcGVyYSA5LjYtMTAuNjAsIGlQaG9uZSAzLjEsIEFuZHJvaWQgMS42LTIuMiwgQmxhY2tCZXJyeSA0LjYtNS4KLy8gVW5pdCBUZXN0cyAgICAgIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlL3VuaXQvCi8vIAovLyBBYm91dDogS25vd24gaXNzdWVzCi8vIAovLyBXaGlsZSB0aGlzIGpRdWVyeSBoYXNoY2hhbmdlIGV2ZW50IGltcGxlbWVudGF0aW9uIGlzIHF1aXRlIHN0YWJsZSBhbmQKLy8gcm9idXN0LCB0aGVyZSBhcmUgYSBmZXcgdW5mb3J0dW5hdGUgYnJvd3NlciBidWdzIHN1cnJvdW5kaW5nIGV4cGVjdGVkCi8vIGhhc2hjaGFuZ2UgZXZlbnQtYmFzZWQgYmVoYXZpb3JzLCBpbmRlcGVuZGVudCBvZiBhbnkgSmF2YVNjcmlwdAovLyB3aW5kb3cub25oYXNoY2hhbmdlIGFic3RyYWN0aW9uLiBTZWUgdGhlIGZvbGxvd2luZyBleGFtcGxlcyBmb3IgbW9yZQovLyBpbmZvcm1hdGlvbjoKLy8gCi8vIENocm9tZTogQmFjayBCdXR0b24gLSBodHRwOi8vYmVuYWxtYW4uY29tL2NvZGUvcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UvZXhhbXBsZXMvYnVnLWNocm9tZS1iYWNrLWJ1dHRvbi8KLy8gRmlyZWZveDogUmVtb3RlIFhNTEh0dHBSZXF1ZXN0IC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlL2V4YW1wbGVzL2J1Zy1maXJlZm94LXJlbW90ZS14aHIvCi8vIFdlYktpdDogQmFjayBCdXR0b24gaW4gYW4gSWZyYW1lIC0gaHR0cDovL2JlbmFsbWFuLmNvbS9jb2RlL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlL2V4YW1wbGVzL2J1Zy13ZWJraXQtaGFzaC1pZnJhbWUvCi8vIFNhZmFyaTogQmFjayBCdXR0b24gZnJvbSBhIGRpZmZlcmVudCBkb21haW4gLSBodHRwOi8vYmVuYWxtYW4uY29tL2NvZGUvcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UvZXhhbXBsZXMvYnVnLXNhZmFyaS1iYWNrLWZyb20tZGlmZi1kb21haW4vCi8vIAovLyBBbHNvIG5vdGUgdGhhdCBzaG91bGQgYSBicm93c2VyIG5hdGl2ZWx5IHN1cHBvcnQgdGhlIHdpbmRvdy5vbmhhc2hjaGFuZ2UgCi8vIGV2ZW50LCBidXQgbm90IHJlcG9ydCB0aGF0IGl0IGRvZXMsIHRoZSBmYWxsYmFjayBwb2xsaW5nIGxvb3Agd2lsbCBiZSB1c2VkLgovLyAKLy8gQWJvdXQ6IFJlbGVhc2UgSGlzdG9yeQovLyAKLy8gMS4zICAgLSAoNy8yMS8yMDEwKSBSZW9yZ2FuaXplZCBJRTYvNyBJZnJhbWUgY29kZSB0byBtYWtlIGl0IG1vcmUKLy8gICAgICAgICAicmVtb3ZhYmxlIiBmb3IgbW9iaWxlLW9ubHkgZGV2ZWxvcG1lbnQuIEFkZGVkIElFNi83IGRvY3VtZW50LnRpdGxlCi8vICAgICAgICAgc3VwcG9ydC4gQXR0ZW1wdGVkIHRvIG1ha2UgSWZyYW1lIGFzIGhpZGRlbiBhcyBwb3NzaWJsZSBieSB1c2luZwovLyAgICAgICAgIHRlY2huaXF1ZXMgZnJvbSBodHRwOi8vd3d3LnBhY2llbGxvZ3JvdXAuY29tL2Jsb2cvP3A9NjA0LiBBZGRlZCAKLy8gICAgICAgICBzdXBwb3J0IGZvciB0aGUgInNob3J0Y3V0IiBmb3JtYXQgJCh3aW5kb3cpLmhhc2hjaGFuZ2UoIGZuICkgYW5kCi8vICAgICAgICAgJCh3aW5kb3cpLmhhc2hjaGFuZ2UoKSBsaWtlIGpRdWVyeSBwcm92aWRlcyBmb3IgYnVpbHQtaW4gZXZlbnRzLgovLyAgICAgICAgIFJlbmFtZWQgalF1ZXJ5Lmhhc2hjaGFuZ2VEZWxheSB0byA8alF1ZXJ5LmZuLmhhc2hjaGFuZ2UuZGVsYXk+IGFuZAovLyAgICAgICAgIGxvd2VyZWQgaXRzIGRlZmF1bHQgdmFsdWUgdG8gNTAuIEFkZGVkIDxqUXVlcnkuZm4uaGFzaGNoYW5nZS5kb21haW4+Ci8vICAgICAgICAgYW5kIDxqUXVlcnkuZm4uaGFzaGNoYW5nZS5zcmM+IHByb3BlcnRpZXMgcGx1cyBkb2N1bWVudC1kb21haW4uaHRtbAovLyAgICAgICAgIGZpbGUgdG8gYWRkcmVzcyBhY2Nlc3MgZGVuaWVkIGlzc3VlcyB3aGVuIHNldHRpbmcgZG9jdW1lbnQuZG9tYWluIGluCi8vICAgICAgICAgSUU2LzcuCi8vIDEuMiAgIC0gKDIvMTEvMjAxMCkgRml4ZWQgYSBidWcgd2hlcmUgY29taW5nIGJhY2sgdG8gYSBwYWdlIHVzaW5nIHRoaXMgcGx1Z2luCi8vICAgICAgICAgZnJvbSBhIHBhZ2Ugb24gYW5vdGhlciBkb21haW4gd291bGQgY2F1c2UgYW4gZXJyb3IgaW4gU2FmYXJpIDQuIEFsc28sCi8vICAgICAgICAgSUU2LzcgSWZyYW1lIGlzIG5vdyBpbnNlcnRlZCBhZnRlciB0aGUgYm9keSAodGhpcyBhY3R1YWxseSB3b3JrcyksCi8vICAgICAgICAgd2hpY2ggcHJldmVudHMgdGhlIHBhZ2UgZnJvbSBzY3JvbGxpbmcgd2hlbiB0aGUgZXZlbnQgaXMgZmlyc3QgYm91bmQuCi8vICAgICAgICAgRXZlbnQgY2FuIGFsc28gbm93IGJlIGJvdW5kIGJlZm9yZSBET00gcmVhZHksIGJ1dCBpdCB3b24ndCBiZSB1c2FibGUKLy8gICAgICAgICBiZWZvcmUgdGhlbiBpbiBJRTYvNy4KLy8gMS4xICAgLSAoMS8yMS8yMDEwKSBJbmNvcnBvcmF0ZWQgZG9jdW1lbnQuZG9jdW1lbnRNb2RlIHRlc3QgdG8gZml4IElFOCBidWcKLy8gICAgICAgICB3aGVyZSBicm93c2VyIHZlcnNpb24gaXMgaW5jb3JyZWN0bHkgcmVwb3J0ZWQgYXMgOC4wLCBkZXNwaXRlCi8vICAgICAgICAgaW5jbHVzaW9uIG9mIHRoZSBYLVVBLUNvbXBhdGlibGUgSUU9RW11bGF0ZUlFNyBtZXRhIHRhZy4KLy8gMS4wICAgLSAoMS85LzIwMTApIEluaXRpYWwgUmVsZWFzZS4gQnJva2Ugb3V0IHRoZSBqUXVlcnkgQkJRIGV2ZW50LnNwZWNpYWwKLy8gICAgICAgICB3aW5kb3cub25oYXNoY2hhbmdlIGZ1bmN0aW9uYWxpdHkgaW50byBhIHNlcGFyYXRlIHBsdWdpbiBmb3IgdXNlcnMKLy8gICAgICAgICB3aG8gd2FudCBqdXN0IHRoZSBiYXNpYyBldmVudCAmIGJhY2sgYnV0dG9uIHN1cHBvcnQsIHdpdGhvdXQgYWxsIHRoZQovLyAgICAgICAgIGV4dHJhIGF3ZXNvbWVuZXNzIHRoYXQgQkJRIHByb3ZpZGVzLiBUaGlzIHBsdWdpbiB3aWxsIGJlIGluY2x1ZGVkIGFzCi8vICAgICAgICAgcGFydCBvZiBqUXVlcnkgQkJRLCBidXQgYWxzbyBiZSBhdmFpbGFibGUgc2VwYXJhdGVseS4KCihmdW5jdGlvbigkLHdpbmRvdyx1bmRlZmluZWQpewogICckOm5vbXVuZ2UnOyAvLyBVc2VkIGJ5IFlVSSBjb21wcmVzc29yLgogIAogIC8vIFJldXNlZCBzdHJpbmcuCiAgdmFyIHN0cl9oYXNoY2hhbmdlID0gJ2hhc2hjaGFuZ2UnLAogICAgCiAgICAvLyBNZXRob2QgLyBvYmplY3QgcmVmZXJlbmNlcy4KICAgIGRvYyA9IGRvY3VtZW50LAogICAgZmFrZV9vbmhhc2hjaGFuZ2UsCiAgICBzcGVjaWFsID0gJC5ldmVudC5zcGVjaWFsLAogICAgCiAgICAvLyBEb2VzIHRoZSBicm93c2VyIHN1cHBvcnQgd2luZG93Lm9uaGFzaGNoYW5nZT8gTm90ZSB0aGF0IElFOCBydW5uaW5nIGluCiAgICAvLyBJRTcgY29tcGF0aWJpbGl0eSBtb2RlIHJlcG9ydHMgdHJ1ZSBmb3IgJ29uaGFzaGNoYW5nZScgaW4gd2luZG93LCBldmVuCiAgICAvLyB0aG91Z2ggdGhlIGV2ZW50IGlzbid0IHN1cHBvcnRlZCwgc28gYWxzbyB0ZXN0IGRvY3VtZW50LmRvY3VtZW50TW9kZS4KICAgIGRvY19tb2RlID0gZG9jLmRvY3VtZW50TW9kZSwKICAgIHN1cHBvcnRzX29uaGFzaGNoYW5nZSA9ICdvbicgKyBzdHJfaGFzaGNoYW5nZSBpbiB3aW5kb3cgJiYgKCBkb2NfbW9kZSA9PT0gdW5kZWZpbmVkIHx8IGRvY19tb2RlID4gNyApOwogIAogIC8vIEdldCBsb2NhdGlvbi5oYXNoIChvciB3aGF0IHlvdSdkIGV4cGVjdCBsb2NhdGlvbi5oYXNoIHRvIGJlKSBzYW5zIGFueQogIC8vIGxlYWRpbmcgIy4gVGhhbmtzIGZvciBtYWtpbmcgdGhpcyBuZWNlc3NhcnksIEZpcmVmb3ghCiAgZnVuY3Rpb24gZ2V0X2ZyYWdtZW50KCB1cmwgKSB7CiAgICB1cmwgPSB1cmwgfHwgbG9jYXRpb24uaHJlZjsKICAgIHJldHVybiAnIycgKyB1cmwucmVwbGFjZSggL15bXiNdKiM/KC4qKSQvLCAnJDEnICk7CiAgfTsKICAKICAvLyBNZXRob2Q6IGpRdWVyeS5mbi5oYXNoY2hhbmdlCiAgLy8gCiAgLy8gQmluZCBhIGhhbmRsZXIgdG8gdGhlIHdpbmRvdy5vbmhhc2hjaGFuZ2UgZXZlbnQgb3IgdHJpZ2dlciBhbGwgYm91bmQKICAvLyB3aW5kb3cub25oYXNoY2hhbmdlIGV2ZW50IGhhbmRsZXJzLiBUaGlzIGJlaGF2aW9yIGlzIGNvbnNpc3RlbnQgd2l0aAogIC8vIGpRdWVyeSdzIGJ1aWx0LWluIGV2ZW50IGhhbmRsZXJzLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vID4galF1ZXJ5KHdpbmRvdykuaGFzaGNoYW5nZSggWyBoYW5kbGVyIF0gKTsKICAvLyAKICAvLyBBcmd1bWVudHM6CiAgLy8gCiAgLy8gIGhhbmRsZXIgLSAoRnVuY3Rpb24pIE9wdGlvbmFsIGhhbmRsZXIgdG8gYmUgYm91bmQgdG8gdGhlIGhhc2hjaGFuZ2UKICAvLyAgICBldmVudC4gVGhpcyBpcyBhICJzaG9ydGN1dCIgZm9yIHRoZSBtb3JlIHZlcmJvc2UgZm9ybToKICAvLyAgICBqUXVlcnkod2luZG93KS5iaW5kKCAnaGFzaGNoYW5nZScsIGhhbmRsZXIgKS4gSWYgaGFuZGxlciBpcyBvbWl0dGVkLAogIC8vICAgIGFsbCBib3VuZCB3aW5kb3cub25oYXNoY2hhbmdlIGV2ZW50IGhhbmRsZXJzIHdpbGwgYmUgdHJpZ2dlcmVkLiBUaGlzCiAgLy8gICAgaXMgYSBzaG9ydGN1dCBmb3IgdGhlIG1vcmUgdmVyYm9zZQogIC8vICAgIGpRdWVyeSh3aW5kb3cpLnRyaWdnZXIoICdoYXNoY2hhbmdlJyApLiBUaGVzZSBmb3JtcyBhcmUgZGVzY3JpYmVkIGluCiAgLy8gICAgdGhlIDxoYXNoY2hhbmdlIGV2ZW50PiBzZWN0aW9uLgogIC8vIAogIC8vIFJldHVybnM6CiAgLy8gCiAgLy8gIChqUXVlcnkpIFRoZSBpbml0aWFsIGpRdWVyeSBjb2xsZWN0aW9uIG9mIGVsZW1lbnRzLgogIAogIC8vIEFsbG93IHRoZSAic2hvcnRjdXQiIGZvcm1hdCAkKGVsZW0pLmhhc2hjaGFuZ2UoIGZuICkgZm9yIGJpbmRpbmcgYW5kCiAgLy8gJChlbGVtKS5oYXNoY2hhbmdlKCkgZm9yIHRyaWdnZXJpbmcsIGxpa2UgalF1ZXJ5IGRvZXMgZm9yIGJ1aWx0LWluIGV2ZW50cy4KICAkLmZuWyBzdHJfaGFzaGNoYW5nZSBdID0gZnVuY3Rpb24oIGZuICkgewogICAgcmV0dXJuIGZuID8gdGhpcy5iaW5kKCBzdHJfaGFzaGNoYW5nZSwgZm4gKSA6IHRoaXMudHJpZ2dlciggc3RyX2hhc2hjaGFuZ2UgKTsKICB9OwogIAogIC8vIFByb3BlcnR5OiBqUXVlcnkuZm4uaGFzaGNoYW5nZS5kZWxheQogIC8vIAogIC8vIFRoZSBudW1lcmljIGludGVydmFsIChpbiBtaWxsaXNlY29uZHMpIGF0IHdoaWNoIHRoZSA8aGFzaGNoYW5nZSBldmVudD4KICAvLyBwb2xsaW5nIGxvb3AgZXhlY3V0ZXMuIERlZmF1bHRzIHRvIDUwLgogIAogIC8vIFByb3BlcnR5OiBqUXVlcnkuZm4uaGFzaGNoYW5nZS5kb21haW4KICAvLyAKICAvLyBJZiB5b3UncmUgc2V0dGluZyBkb2N1bWVudC5kb21haW4gaW4geW91ciBKYXZhU2NyaXB0LCBhbmQgeW91IHdhbnQgaGFzaAogIC8vIGhpc3RvcnkgdG8gd29yayBpbiBJRTYvNywgbm90IG9ubHkgbXVzdCB0aGlzIHByb3BlcnR5IGJlIHNldCwgYnV0IHlvdSBtdXN0CiAgLy8gYWxzbyBzZXQgZG9jdW1lbnQuZG9tYWluIEJFRk9SRSBqUXVlcnkgaXMgbG9hZGVkIGludG8gdGhlIHBhZ2UuIFRoaXMKICAvLyBwcm9wZXJ0eSBpcyBvbmx5IGFwcGxpY2FibGUgaWYgeW91IGFyZSBzdXBwb3J0aW5nIElFNi83IChvciBJRTggb3BlcmF0aW5nCiAgLy8gaW4gIklFNyBjb21wYXRpYmlsaXR5IiBtb2RlKS4KICAvLyAKICAvLyBJbiBhZGRpdGlvbiwgdGhlIDxqUXVlcnkuZm4uaGFzaGNoYW5nZS5zcmM+IHByb3BlcnR5IG11c3QgYmUgc2V0IHRvIHRoZQogIC8vIHBhdGggb2YgdGhlIGluY2x1ZGVkICJkb2N1bWVudC1kb21haW4uaHRtbCIgZmlsZSwgd2hpY2ggY2FuIGJlIHJlbmFtZWQgb3IKICAvLyBtb2RpZmllZCBpZiBuZWNlc3NhcnkgKG5vdGUgdGhhdCB0aGUgZG9jdW1lbnQuZG9tYWluIHNwZWNpZmllZCBtdXN0IGJlIHRoZQogIC8vIHNhbWUgaW4gYm90aCB5b3VyIG1haW4gSmF2YVNjcmlwdCBhcyB3ZWxsIGFzIGluIHRoaXMgZmlsZSkuCiAgLy8gCiAgLy8gVXNhZ2U6CiAgLy8gCiAgLy8galF1ZXJ5LmZuLmhhc2hjaGFuZ2UuZG9tYWluID0gZG9jdW1lbnQuZG9tYWluOwogIAogIC8vIFByb3BlcnR5OiBqUXVlcnkuZm4uaGFzaGNoYW5nZS5zcmMKICAvLyAKICAvLyBJZiwgZm9yIHNvbWUgcmVhc29uLCB5b3UgbmVlZCB0byBzcGVjaWZ5IGFuIElmcmFtZSBzcmMgZmlsZSAoZm9yIGV4YW1wbGUsCiAgLy8gd2hlbiBzZXR0aW5nIGRvY3VtZW50LmRvbWFpbiBhcyBpbiA8alF1ZXJ5LmZuLmhhc2hjaGFuZ2UuZG9tYWluPiksIHlvdSBjYW4KICAvLyBkbyBzbyB1c2luZyB0aGlzIHByb3BlcnR5LiBOb3RlIHRoYXQgd2hlbiB1c2luZyB0aGlzIHByb3BlcnR5LCBoaXN0b3J5CiAgLy8gd29uJ3QgYmUgcmVjb3JkZWQgaW4gSUU2LzcgdW50aWwgdGhlIElmcmFtZSBzcmMgZmlsZSBsb2Fkcy4gVGhpcyBwcm9wZXJ0eQogIC8vIGlzIG9ubHkgYXBwbGljYWJsZSBpZiB5b3UgYXJlIHN1cHBvcnRpbmcgSUU2LzcgKG9yIElFOCBvcGVyYXRpbmcgaW4gIklFNwogIC8vIGNvbXBhdGliaWxpdHkiIG1vZGUpLgogIC8vIAogIC8vIFVzYWdlOgogIC8vIAogIC8vIGpRdWVyeS5mbi5oYXNoY2hhbmdlLnNyYyA9ICdwYXRoL3RvL2ZpbGUuaHRtbCc7CiAgCiAgJC5mblsgc3RyX2hhc2hjaGFuZ2UgXS5kZWxheSA9IDUwOwogIC8qCiAgJC5mblsgc3RyX2hhc2hjaGFuZ2UgXS5kb21haW4gPSBudWxsOwogICQuZm5bIHN0cl9oYXNoY2hhbmdlIF0uc3JjID0gbnVsbDsKICAqLwogIAogIC8vIEV2ZW50OiBoYXNoY2hhbmdlIGV2ZW50CiAgLy8gCiAgLy8gRmlyZWQgd2hlbiBsb2NhdGlvbi5oYXNoIGNoYW5nZXMuIEluIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCBpdCwgdGhlIG5hdGl2ZQogIC8vIEhUTUw1IHdpbmRvdy5vbmhhc2hjaGFuZ2UgZXZlbnQgaXMgdXNlZCwgb3RoZXJ3aXNlIGEgcG9sbGluZyBsb29wIGlzCiAgLy8gaW5pdGlhbGl6ZWQsIHJ1bm5pbmcgZXZlcnkgPGpRdWVyeS5mbi5oYXNoY2hhbmdlLmRlbGF5PiBtaWxsaXNlY29uZHMgdG8KICAvLyBzZWUgaWYgdGhlIGhhc2ggaGFzIGNoYW5nZWQuIEluIElFNi83IChhbmQgSUU4IG9wZXJhdGluZyBpbiAiSUU3CiAgLy8gY29tcGF0aWJpbGl0eSIgbW9kZSksIGEgaGlkZGVuIElmcmFtZSBpcyBjcmVhdGVkIHRvIGFsbG93IHRoZSBiYWNrIGJ1dHRvbgogIC8vIGFuZCBoYXNoLWJhc2VkIGhpc3RvcnkgdG8gd29yay4KICAvLyAKICAvLyBVc2FnZSBhcyBkZXNjcmliZWQgaW4gPGpRdWVyeS5mbi5oYXNoY2hhbmdlPjoKICAvLyAKICAvLyA+IC8vIEJpbmQgYW4gZXZlbnQgaGFuZGxlci4KICAvLyA+IGpRdWVyeSh3aW5kb3cpLmhhc2hjaGFuZ2UoIGZ1bmN0aW9uKGUpIHsKICAvLyA+ICAgdmFyIGhhc2ggPSBsb2NhdGlvbi5oYXNoOwogIC8vID4gICAuLi4KICAvLyA+IH0pOwogIC8vID4gCiAgLy8gPiAvLyBNYW51YWxseSB0cmlnZ2VyIHRoZSBldmVudCBoYW5kbGVyLgogIC8vID4galF1ZXJ5KHdpbmRvdykuaGFzaGNoYW5nZSgpOwogIC8vIAogIC8vIEEgbW9yZSB2ZXJib3NlIHVzYWdlIHRoYXQgYWxsb3dzIGZvciBldmVudCBuYW1lc3BhY2luZzoKICAvLyAKICAvLyA+IC8vIEJpbmQgYW4gZXZlbnQgaGFuZGxlci4KICAvLyA+IGpRdWVyeSh3aW5kb3cpLmJpbmQoICdoYXNoY2hhbmdlJywgZnVuY3Rpb24oZSkgewogIC8vID4gICB2YXIgaGFzaCA9IGxvY2F0aW9uLmhhc2g7CiAgLy8gPiAgIC4uLgogIC8vID4gfSk7CiAgLy8gPiAKICAvLyA+IC8vIE1hbnVhbGx5IHRyaWdnZXIgdGhlIGV2ZW50IGhhbmRsZXIuCiAgLy8gPiBqUXVlcnkod2luZG93KS50cmlnZ2VyKCAnaGFzaGNoYW5nZScgKTsKICAvLyAKICAvLyBBZGRpdGlvbmFsIE5vdGVzOgogIC8vIAogIC8vICogVGhlIHBvbGxpbmcgbG9vcCBhbmQgSWZyYW1lIGFyZSBub3QgY3JlYXRlZCB1bnRpbCBhdCBsZWFzdCBvbmUgaGFuZGxlcgogIC8vICAgaXMgYWN0dWFsbHkgYm91bmQgdG8gdGhlICdoYXNoY2hhbmdlJyBldmVudC4KICAvLyAqIElmIHlvdSBuZWVkIHRoZSBib3VuZCBoYW5kbGVyKHMpIHRvIGV4ZWN1dGUgaW1tZWRpYXRlbHksIGluIGNhc2VzIHdoZXJlCiAgLy8gICBhIGxvY2F0aW9uLmhhc2ggZXhpc3RzIG9uIHBhZ2UgbG9hZCwgdmlhIGJvb2ttYXJrIG9yIHBhZ2UgcmVmcmVzaCBmb3IKICAvLyAgIGV4YW1wbGUsIHVzZSBqUXVlcnkod2luZG93KS5oYXNoY2hhbmdlKCkgb3IgdGhlIG1vcmUgdmVyYm9zZSAKICAvLyAgIGpRdWVyeSh3aW5kb3cpLnRyaWdnZXIoICdoYXNoY2hhbmdlJyApLgogIC8vICogVGhlIGV2ZW50IGNhbiBiZSBib3VuZCBiZWZvcmUgRE9NIHJlYWR5LCBidXQgc2luY2UgaXQgd29uJ3QgYmUgdXNhYmxlCiAgLy8gICBiZWZvcmUgdGhlbiBpbiBJRTYvNyAoZHVlIHRvIHRoZSBuZWNlc3NhcnkgSWZyYW1lKSwgcmVjb21tZW5kZWQgdXNhZ2UgaXMKICAvLyAgIHRvIGJpbmQgaXQgaW5zaWRlIGEgRE9NIHJlYWR5IGhhbmRsZXIuCiAgCiAgLy8gT3ZlcnJpZGUgZXhpc3RpbmcgJC5ldmVudC5zcGVjaWFsLmhhc2hjaGFuZ2UgbWV0aG9kcyAoYWxsb3dpbmcgdGhpcyBwbHVnaW4KICAvLyB0byBiZSBkZWZpbmVkIGFmdGVyIGpRdWVyeSBCQlEgaW4gQkJRJ3Mgc291cmNlIGNvZGUpLgogIHNwZWNpYWxbIHN0cl9oYXNoY2hhbmdlIF0gPSAkLmV4dGVuZCggc3BlY2lhbFsgc3RyX2hhc2hjaGFuZ2UgXSwgewogICAgCiAgICAvLyBDYWxsZWQgb25seSB3aGVuIHRoZSBmaXJzdCAnaGFzaGNoYW5nZScgZXZlbnQgaXMgYm91bmQgdG8gd2luZG93LgogICAgc2V0dXA6IGZ1bmN0aW9uKCkgewogICAgICAvLyBJZiB3aW5kb3cub25oYXNoY2hhbmdlIGlzIHN1cHBvcnRlZCBuYXRpdmVseSwgdGhlcmUncyBub3RoaW5nIHRvIGRvLi4KICAgICAgaWYgKCBzdXBwb3J0c19vbmhhc2hjaGFuZ2UgKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAKICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSBuZWVkIHRvIGNyZWF0ZSBvdXIgb3duLiBBbmQgd2UgZG9uJ3Qgd2FudCB0byBjYWxsIHRoaXMKICAgICAgLy8gdW50aWwgdGhlIHVzZXIgYmluZHMgdG8gdGhlIGV2ZW50LCBqdXN0IGluIGNhc2UgdGhleSBuZXZlciBkbywgc2luY2UgaXQKICAgICAgLy8gd2lsbCBjcmVhdGUgYSBwb2xsaW5nIGxvb3AgYW5kIHBvc3NpYmx5IGV2ZW4gYSBoaWRkZW4gSWZyYW1lLgogICAgICAkKCBmYWtlX29uaGFzaGNoYW5nZS5zdGFydCApOwogICAgfSwKICAgIAogICAgLy8gQ2FsbGVkIG9ubHkgd2hlbiB0aGUgbGFzdCAnaGFzaGNoYW5nZScgZXZlbnQgaXMgdW5ib3VuZCBmcm9tIHdpbmRvdy4KICAgIHRlYXJkb3duOiBmdW5jdGlvbigpIHsKICAgICAgLy8gSWYgd2luZG93Lm9uaGFzaGNoYW5nZSBpcyBzdXBwb3J0ZWQgbmF0aXZlbHksIHRoZXJlJ3Mgbm90aGluZyB0byBkby4uCiAgICAgIGlmICggc3VwcG9ydHNfb25oYXNoY2hhbmdlICkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgCiAgICAgIC8vIE90aGVyd2lzZSwgd2UgbmVlZCB0byBzdG9wIG91cnMgKGlmIHBvc3NpYmxlKS4KICAgICAgJCggZmFrZV9vbmhhc2hjaGFuZ2Uuc3RvcCApOwogICAgfQogICAgCiAgfSk7CiAgCiAgLy8gZmFrZV9vbmhhc2hjaGFuZ2UgZG9lcyBhbGwgdGhlIHdvcmsgb2YgdHJpZ2dlcmluZyB0aGUgd2luZG93Lm9uaGFzaGNoYW5nZQogIC8vIGV2ZW50IGZvciBicm93c2VycyB0aGF0IGRvbid0IG5hdGl2ZWx5IHN1cHBvcnQgaXQsIGluY2x1ZGluZyBjcmVhdGluZyBhCiAgLy8gcG9sbGluZyBsb29wIHRvIHdhdGNoIGZvciBoYXNoIGNoYW5nZXMgYW5kIGluIElFIDYvNyBjcmVhdGluZyBhIGhpZGRlbgogIC8vIElmcmFtZSB0byBlbmFibGUgYmFjayBhbmQgZm9yd2FyZC4KICBmYWtlX29uaGFzaGNoYW5nZSA9IChmdW5jdGlvbigpewogICAgdmFyIHNlbGYgPSB7fSwKICAgICAgdGltZW91dF9pZCwKICAgICAgCiAgICAgIC8vIFJlbWVtYmVyIHRoZSBpbml0aWFsIGhhc2ggc28gaXQgZG9lc24ndCBnZXQgdHJpZ2dlcmVkIGltbWVkaWF0ZWx5LgogICAgICBsYXN0X2hhc2ggPSBnZXRfZnJhZ21lbnQoKSwKICAgICAgCiAgICAgIGZuX3JldHZhbCA9IGZ1bmN0aW9uKHZhbCl7IHJldHVybiB2YWw7IH0sCiAgICAgIGhpc3Rvcnlfc2V0ID0gZm5fcmV0dmFsLAogICAgICBoaXN0b3J5X2dldCA9IGZuX3JldHZhbDsKICAgIAogICAgLy8gU3RhcnQgdGhlIHBvbGxpbmcgbG9vcC4KICAgIHNlbGYuc3RhcnQgPSBmdW5jdGlvbigpIHsKICAgICAgdGltZW91dF9pZCB8fCBwb2xsKCk7CiAgICB9OwogICAgCiAgICAvLyBTdG9wIHRoZSBwb2xsaW5nIGxvb3AuCiAgICBzZWxmLnN0b3AgPSBmdW5jdGlvbigpIHsKICAgICAgdGltZW91dF9pZCAmJiBjbGVhclRpbWVvdXQoIHRpbWVvdXRfaWQgKTsKICAgICAgdGltZW91dF9pZCA9IHVuZGVmaW5lZDsKICAgIH07CiAgICAKICAgIC8vIFRoaXMgcG9sbGluZyBsb29wIGNoZWNrcyBldmVyeSAkLmZuLmhhc2hjaGFuZ2UuZGVsYXkgbWlsbGlzZWNvbmRzIHRvIHNlZQogICAgLy8gaWYgbG9jYXRpb24uaGFzaCBoYXMgY2hhbmdlZCwgYW5kIHRyaWdnZXJzIHRoZSAnaGFzaGNoYW5nZScgZXZlbnQgb24KICAgIC8vIHdpbmRvdyB3aGVuIG5lY2Vzc2FyeS4KICAgIGZ1bmN0aW9uIHBvbGwoKSB7CiAgICAgIHZhciBoYXNoID0gZ2V0X2ZyYWdtZW50KCksCiAgICAgICAgaGlzdG9yeV9oYXNoID0gaGlzdG9yeV9nZXQoIGxhc3RfaGFzaCApOwogICAgICAKICAgICAgaWYgKCBoYXNoICE9PSBsYXN0X2hhc2ggKSB7CiAgICAgICAgaGlzdG9yeV9zZXQoIGxhc3RfaGFzaCA9IGhhc2gsIGhpc3RvcnlfaGFzaCApOwogICAgICAgIAogICAgICAgICQod2luZG93KS50cmlnZ2VyKCBzdHJfaGFzaGNoYW5nZSApOwogICAgICAgIAogICAgICB9IGVsc2UgaWYgKCBoaXN0b3J5X2hhc2ggIT09IGxhc3RfaGFzaCApIHsKICAgICAgICBsb2NhdGlvbi5ocmVmID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKCAvIy4qLywgJycgKSArIGhpc3RvcnlfaGFzaDsKICAgICAgfQogICAgICAKICAgICAgdGltZW91dF9pZCA9IHNldFRpbWVvdXQoIHBvbGwsICQuZm5bIHN0cl9oYXNoY2hhbmdlIF0uZGVsYXkgKTsKICAgIH07CiAgICAKICAgIC8vIHZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dgogICAgLy8gdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2diBSRU1PVkUgSUYgTk9UIFNVUFBPUlRJTkcgSUU2LzcvOCB2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2CiAgICAvLyB2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnYKICAgICQuYnJvd3Nlci5tc2llICYmICFzdXBwb3J0c19vbmhhc2hjaGFuZ2UgJiYgKGZ1bmN0aW9uKCl7CiAgICAgIC8vIE5vdCBvbmx5IGRvIElFNi83IG5lZWQgdGhlICJtYWdpY2FsIiBJZnJhbWUgdHJlYXRtZW50LCBidXQgc28gZG9lcyBJRTgKICAgICAgLy8gd2hlbiBydW5uaW5nIGluICJJRTcgY29tcGF0aWJpbGl0eSIgbW9kZS4KICAgICAgCiAgICAgIHZhciBpZnJhbWUsCiAgICAgICAgaWZyYW1lX3NyYzsKICAgICAgCiAgICAgIC8vIFdoZW4gdGhlIGV2ZW50IGlzIGJvdW5kIGFuZCBwb2xsaW5nIHN0YXJ0cyBpbiBJRSA2LzcsIGNyZWF0ZSBhIGhpZGRlbgogICAgICAvLyBJZnJhbWUgZm9yIGhpc3RvcnkgaGFuZGxpbmcuCiAgICAgIHNlbGYuc3RhcnQgPSBmdW5jdGlvbigpewogICAgICAgIGlmICggIWlmcmFtZSApIHsKICAgICAgICAgIGlmcmFtZV9zcmMgPSAkLmZuWyBzdHJfaGFzaGNoYW5nZSBdLnNyYzsKICAgICAgICAgIGlmcmFtZV9zcmMgPSBpZnJhbWVfc3JjICYmIGlmcmFtZV9zcmMgKyBnZXRfZnJhZ21lbnQoKTsKICAgICAgICAgIAogICAgICAgICAgLy8gQ3JlYXRlIGhpZGRlbiBJZnJhbWUuIEF0dGVtcHQgdG8gbWFrZSBJZnJhbWUgYXMgaGlkZGVuIGFzIHBvc3NpYmxlCiAgICAgICAgICAvLyBieSB1c2luZyB0ZWNobmlxdWVzIGZyb20gaHR0cDovL3d3dy5wYWNpZWxsb2dyb3VwLmNvbS9ibG9nLz9wPTYwNC4KICAgICAgICAgIGlmcmFtZSA9ICQoJzxpZnJhbWUgdGFiaW5kZXg9Ii0xIiB0aXRsZT0iZW1wdHkiLz4nKS5oaWRlKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFdoZW4gSWZyYW1lIGhhcyBjb21wbGV0ZWx5IGxvYWRlZCwgaW5pdGlhbGl6ZSB0aGUgaGlzdG9yeSBhbmQKICAgICAgICAgICAgLy8gc3RhcnQgcG9sbGluZy4KICAgICAgICAgICAgLm9uZSggJ2xvYWQnLCBmdW5jdGlvbigpewogICAgICAgICAgICAgIGlmcmFtZV9zcmMgfHwgaGlzdG9yeV9zZXQoIGdldF9mcmFnbWVudCgpICk7CiAgICAgICAgICAgICAgcG9sbCgpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTG9hZCBJZnJhbWUgc3JjIGlmIHNwZWNpZmllZCwgb3RoZXJ3aXNlIG5vdGhpbmcuCiAgICAgICAgICAgIC5hdHRyKCAnc3JjJywgaWZyYW1lX3NyYyB8fCAnamF2YXNjcmlwdDowJyApCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBcHBlbmQgSWZyYW1lIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGJvZHkgdG8gcHJldmVudCB1bm5lY2Vzc2FyeQogICAgICAgICAgICAvLyBpbml0aWFsIHBhZ2Ugc2Nyb2xsaW5nICh5ZXMsIHRoaXMgd29ya3MpLgogICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIoICdib2R5JyApWzBdLmNvbnRlbnRXaW5kb3c7CiAgICAgICAgICAKICAgICAgICAgIC8vIFdoZW5ldmVyIGBkb2N1bWVudC50aXRsZWAgY2hhbmdlcywgdXBkYXRlIHRoZSBJZnJhbWUncyB0aXRsZSB0bwogICAgICAgICAgLy8gcHJldHRpZnkgdGhlIGJhY2svbmV4dCBoaXN0b3J5IG1lbnUgZW50cmllcy4gU2luY2UgSUUgc29tZXRpbWVzCiAgICAgICAgICAvLyBlcnJvcnMgd2l0aCAiVW5zcGVjaWZpZWQgZXJyb3IiIHRoZSB2ZXJ5IGZpcnN0IHRpbWUgdGhpcyBpcyBzZXQKICAgICAgICAgIC8vICh5ZXMsIHZlcnkgdXNlZnVsKSB3cmFwIHRoaXMgd2l0aCBhIHRyeS9jYXRjaCBibG9jay4KICAgICAgICAgIGRvYy5vbnByb3BlcnR5Y2hhbmdlID0gZnVuY3Rpb24oKXsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIGV2ZW50LnByb3BlcnR5TmFtZSA9PT0gJ3RpdGxlJyApIHsKICAgICAgICAgICAgICAgIGlmcmFtZS5kb2N1bWVudC50aXRsZSA9IGRvYy50aXRsZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2goZSkge30KICAgICAgICAgIH07CiAgICAgICAgICAKICAgICAgICB9CiAgICAgIH07CiAgICAgIAogICAgICAvLyBPdmVycmlkZSB0aGUgInN0b3AiIG1ldGhvZCBzaW5jZSBhbiBJRTYvNyBJZnJhbWUgd2FzIGNyZWF0ZWQuIEV2ZW4KICAgICAgLy8gaWYgdGhlcmUgYXJlIG5vIGxvbmdlciBhbnkgYm91bmQgZXZlbnQgaGFuZGxlcnMsIHRoZSBwb2xsaW5nIGxvb3AKICAgICAgLy8gaXMgc3RpbGwgbmVjZXNzYXJ5IGZvciBiYWNrL25leHQgdG8gd29yayBhdCBhbGwhCiAgICAgIHNlbGYuc3RvcCA9IGZuX3JldHZhbDsKICAgICAgCiAgICAgIC8vIEdldCBoaXN0b3J5IGJ5IGxvb2tpbmcgYXQgdGhlIGhpZGRlbiBJZnJhbWUncyBsb2NhdGlvbi5oYXNoLgogICAgICBoaXN0b3J5X2dldCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBnZXRfZnJhZ21lbnQoIGlmcmFtZS5sb2NhdGlvbi5ocmVmICk7CiAgICAgIH07CiAgICAgIAogICAgICAvLyBTZXQgYSBuZXcgaGlzdG9yeSBpdGVtIGJ5IG9wZW5pbmcgYW5kIHRoZW4gY2xvc2luZyB0aGUgSWZyYW1lCiAgICAgIC8vIGRvY3VtZW50LCAqdGhlbiogc2V0dGluZyBpdHMgbG9jYXRpb24uaGFzaC4gSWYgZG9jdW1lbnQuZG9tYWluIGhhcwogICAgICAvLyBiZWVuIHNldCwgdXBkYXRlIHRoYXQgYXMgd2VsbC4KICAgICAgaGlzdG9yeV9zZXQgPSBmdW5jdGlvbiggaGFzaCwgaGlzdG9yeV9oYXNoICkgewogICAgICAgIHZhciBpZnJhbWVfZG9jID0gaWZyYW1lLmRvY3VtZW50LAogICAgICAgICAgZG9tYWluID0gJC5mblsgc3RyX2hhc2hjaGFuZ2UgXS5kb21haW47CiAgICAgICAgCiAgICAgICAgaWYgKCBoYXNoICE9PSBoaXN0b3J5X2hhc2ggKSB7CiAgICAgICAgICAvLyBVcGRhdGUgSWZyYW1lIHdpdGggYW55IGluaXRpYWwgYGRvY3VtZW50LnRpdGxlYCB0aGF0IG1pZ2h0IGJlIHNldC4KICAgICAgICAgIGlmcmFtZV9kb2MudGl0bGUgPSBkb2MudGl0bGU7CiAgICAgICAgICAKICAgICAgICAgIC8vIE9wZW5pbmcgdGhlIElmcmFtZSdzIGRvY3VtZW50IGFmdGVyIGl0IGhhcyBiZWVuIGNsb3NlZCBpcyB3aGF0CiAgICAgICAgICAvLyBhY3R1YWxseSBhZGRzIGEgaGlzdG9yeSBlbnRyeS4KICAgICAgICAgIGlmcmFtZV9kb2Mub3BlbigpOwogICAgICAgICAgCiAgICAgICAgICAvLyBTZXQgZG9jdW1lbnQuZG9tYWluIGZvciB0aGUgSWZyYW1lIGRvY3VtZW50IGFzIHdlbGwsIGlmIG5lY2Vzc2FyeS4KICAgICAgICAgIGRvbWFpbiAmJiBpZnJhbWVfZG9jLndyaXRlKCAnPHNjcmlwdD5kb2N1bWVudC5kb21haW49IicgKyBkb21haW4gKyAnIjwvc2NyaXB0PicgKTsKICAgICAgICAgIAogICAgICAgICAgaWZyYW1lX2RvYy5jbG9zZSgpOwogICAgICAgICAgCiAgICAgICAgICAvLyBVcGRhdGUgdGhlIElmcmFtZSdzIGhhc2gsIGZvciBncmVhdCBqdXN0aWNlLgogICAgICAgICAgaWZyYW1lLmxvY2F0aW9uLmhhc2ggPSBoYXNoOwogICAgICAgIH0KICAgICAgfTsKICAgICAgCiAgICB9KSgpOwogICAgLy8gXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eCiAgICAvLyBeXl5eXl5eXl5eXl5eXl5eXl5eIFJFTU9WRSBJRiBOT1QgU1VQUE9SVElORyBJRTYvNy84IF5eXl5eXl5eXl5eXl5eXl5eXl4KICAgIC8vIF5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXgogICAgCiAgICByZXR1cm4gc2VsZjsKICB9KSgpOwogIAp9KShqUXVlcnksdGhpcyk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 05:52:31 GMT",
                    "Content-Length": "52651",
                    "Date": "Fri, 07 Nov 2014 05:52:32 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}