{
    "url": "http://localhost:9999/HubSpot/odometer/docs/welcome/onepage-scroll.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>window.location.href</b> and written to <b>history.pushState()</b> via the following statements:<ul><li>var href = window.location.href.substr(0,window.location.href.indexOf('#')) + \"#\" + (init_index);</li><li>history.pushState( {}, document.title, href );</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/HubSpot/odometer/docs/welcome/onepage-scroll.js",
                "path": "/HubSpot/odometer/docs/welcome/onepage-scroll.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9IdWJTcG90L29kb21ldGVyL2RvY3Mvd2VsY29tZS9vbmVwYWdlLXNjcm9sbC5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogOTU0MQ0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAyMToxNzoxNCBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMjE6MTc6MTMgR01UDQoNCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIGpxdWVyeS1vbmVwYWdlLXNjcm9sbC5qcyB2MQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBDb3B5cmlnaHQgMjAxMyBQZXRlIFJvandvbmdzdXJpeWEuCiAqIGh0dHA6Ly93d3cudGhlcGV0ZWRlc2lnbi5jb20KICoKICogQ3JlYXRlIGFuIEFwcGxlLWxpa2Ugd2Vic2l0ZSB0aGF0IGxldCB1c2VyIHNjcm9sbAogKiBvbmUgcGFnZSBhdCBhIHRpbWUKICoKICogQ3JlZGl0OiBFaWtlIFNlbmQgZm9yIHRoZSBhd2Vzb21lIHN3aXBlIGV2ZW50CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9wZWFjaGFuYW5yL29uZXBhZ2Utc2Nyb2xsCiAqCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCiFmdW5jdGlvbigkKXsKCiAgdmFyIGRlZmF1bHRzID0gewogICAgc2VjdGlvbkNvbnRhaW5lcjogInNlY3Rpb24iLAogICAgZWFzaW5nOiAiZWFzZSIsCiAgICBhbmltYXRpb25UaW1lOiAxMDAwLAogICAgcGFnaW5hdGlvbjogdHJ1ZSwKICAgIHVwZGF0ZVVSTDogZmFsc2UKICAgIH07CgogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwogICAgLyogIENyZWRpdDogRWlrZSBTZW5kIGZvciB0aGUgYXdlc29tZSBzd2lwZSBldmVudCAqLwogICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKICAgICQuZm4uc3dpcGVFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCiAgICAgICAgdmFyIHN0YXJ0WCwKICAgICAgICAgICAgc3RhcnRZLAogICAgICAgICAgICAkdGhpcyA9ICQodGhpcyk7CgogICAgICAgICR0aGlzLmJpbmQoJ3RvdWNoc3RhcnQnLCB0b3VjaHN0YXJ0KTsKCiAgICAgICAgZnVuY3Rpb24gdG91Y2hzdGFydChldmVudCkgewogICAgICAgICAgdmFyIHRvdWNoZXMgPSBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXM7CiAgICAgICAgICBpZiAodG91Y2hlcyAmJiB0b3VjaGVzLmxlbmd0aCkgewogICAgICAgICAgICBzdGFydFggPSB0b3VjaGVzWzBdLnBhZ2VYOwogICAgICAgICAgICBzdGFydFkgPSB0b3VjaGVzWzBdLnBhZ2VZOwogICAgICAgICAgICAkdGhpcy5iaW5kKCd0b3VjaG1vdmUnLCB0b3VjaG1vdmUpOwogICAgICAgICAgfQogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRvdWNobW92ZShldmVudCkgewogICAgICAgICAgdmFyIHRvdWNoZXMgPSBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXM7CiAgICAgICAgICBpZiAodG91Y2hlcyAmJiB0b3VjaGVzLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgZGVsdGFYID0gc3RhcnRYIC0gdG91Y2hlc1swXS5wYWdlWDsKICAgICAgICAgICAgdmFyIGRlbHRhWSA9IHN0YXJ0WSAtIHRvdWNoZXNbMF0ucGFnZVk7CgogICAgICAgICAgICBpZiAoZGVsdGFYID49IDUwKSB7CiAgICAgICAgICAgICAgJHRoaXMudHJpZ2dlcigic3dpcGVMZWZ0Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRlbHRhWCA8PSAtNTApIHsKICAgICAgICAgICAgICAkdGhpcy50cmlnZ2VyKCJzd2lwZVJpZ2h0Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRlbHRhWSA+PSA1MCkgewogICAgICAgICAgICAgICR0aGlzLnRyaWdnZXIoInN3aXBlVXAiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGVsdGFZIDw9IC01MCkgewogICAgICAgICAgICAgICR0aGlzLnRyaWdnZXIoInN3aXBlRG93biIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChNYXRoLmFicyhkZWx0YVgpID49IDUwIHx8IE1hdGguYWJzKGRlbHRhWSkgPj0gNTApIHsKICAgICAgICAgICAgICAkdGhpcy51bmJpbmQoJ3RvdWNobW92ZScsIHRvdWNobW92ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfQoKICAgICAgfSk7CiAgICB9OwoKCiAgJC5mbi5vbmVwYWdlX3Njcm9sbCA9IGZ1bmN0aW9uKG9wdGlvbnMpewogICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zKSwKICAgICAgICBlbCA9ICQodGhpcyksCiAgICAgICAgc2VjdGlvbnMgPSAkKHNldHRpbmdzLnNlY3Rpb25Db250YWluZXIpLAogICAgICAgIHRvdGFsID0gc2VjdGlvbnMubGVuZ3RoLAogICAgICAgIHN0YXR1cyA9ICJvZmYiLAogICAgICAgIHRvcFBvcyA9IDAsCiAgICAgICAgbGFzdEFuaW1hdGlvbiA9IDAsCiAgICAgICAgcXVpZXRQZXJpb2QgPSA1MDAsCiAgICAgICAgcGFnaW5hdGlvbkxpc3QgPSAiIjsKCiAgICAkLmZuLnRyYW5zZm9ybVBhZ2UgPSBmdW5jdGlvbihzZXR0aW5ncywgcG9zKSB7CiAgICAgICQodGhpcykuY3NzKHsKICAgICAgICAiLXdlYmtpdC10cmFuc2Zvcm0iOiAidHJhbnNsYXRlM2QoMCwgIiArIHBvcyArICIlLCAwKSIsCiAgICAgICAgIi13ZWJraXQtdHJhbnNpdGlvbiI6ICJhbGwgIiArIHNldHRpbmdzLmFuaW1hdGlvblRpbWUgKyAibXMgIiArIHNldHRpbmdzLmVhc2luZywKICAgICAgICAiLW1vei10cmFuc2Zvcm0iOiAidHJhbnNsYXRlM2QoMCwgIiArIHBvcyArICIlLCAwKSIsCiAgICAgICAgIi1tb3otdHJhbnNpdGlvbiI6ICJhbGwgIiArIHNldHRpbmdzLmFuaW1hdGlvblRpbWUgKyAibXMgIiArIHNldHRpbmdzLmVhc2luZywKICAgICAgICAiLW1zLXRyYW5zZm9ybSI6ICJ0cmFuc2xhdGUzZCgwLCAiICsgcG9zICsgIiUsIDApIiwKICAgICAgICAiLW1zLXRyYW5zaXRpb24iOiAiYWxsICIgKyBzZXR0aW5ncy5hbmltYXRpb25UaW1lICsgIm1zICIgKyBzZXR0aW5ncy5lYXNpbmcsCiAgICAgICAgInRyYW5zZm9ybSI6ICJ0cmFuc2xhdGUzZCgwLCAiICsgcG9zICsgIiUsIDApIiwKICAgICAgICAidHJhbnNpdGlvbiI6ICJhbGwgIiArIHNldHRpbmdzLmFuaW1hdGlvblRpbWUgKyAibXMgIiArIHNldHRpbmdzLmVhc2luZwogICAgICB9KTsKICAgIH07CgogICAgJC5mbi5tb3ZlRG93biA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgZWwgPSAkKHRoaXMpOwogICAgICBpbmRleCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArIi5hY3RpdmUiKS5kYXRhKCJpbmRleCIpOwogICAgICBpZihpbmRleCA8IHRvdGFsKSB7CiAgICAgICAgY3VycmVudCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArICJbZGF0YS1pbmRleD0nIiArIGluZGV4ICsgIiddIik7CiAgICAgICAgbmV4dCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArICJbZGF0YS1pbmRleD0nIiArIChpbmRleCArIDEpICsgIiddIik7CiAgICAgICAgaWYobmV4dCkgewogICAgICAgICAgY3VycmVudC5yZW1vdmVDbGFzcygiYWN0aXZlIik7CiAgICAgICAgICBuZXh0LmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT09IHRydWUpIHsKICAgICAgICAgICAgJCgiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhIiArICJbZGF0YS1pbmRleD0nIiArIGluZGV4ICsgIiddIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgICAgICAkKCIub25lcGFnZS1wYWdpbmF0aW9uIGxpIGEiICsgIltkYXRhLWluZGV4PSciICsgKGluZGV4ICsgMSkgKyAiJ10iKS5hZGRDbGFzcygiYWN0aXZlIik7CiAgICAgICAgICB9CiAgICAgICAgICAkKCJib2R5IilbMF0uY2xhc3NOYW1lID0gJCgiYm9keSIpWzBdLmNsYXNzTmFtZS5yZXBsYWNlKC9cYnZpZXdpbmctcGFnZS1cZC4qP1xiL2csICcnKTsKICAgICAgICAgICQoImJvZHkiKS5hZGRDbGFzcygidmlld2luZy1wYWdlLSIrbmV4dC5kYXRhKCJpbmRleCIpKTsKCiAgICAgICAgICBpZiAoaGlzdG9yeS5yZXBsYWNlU3RhdGUgJiYgc2V0dGluZ3MudXBkYXRlVVJMID09PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3Vic3RyKDAsd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignIycpKSArICIjIiArIChpbmRleCArIDEpOwogICAgICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZSgge30sIGRvY3VtZW50LnRpdGxlLCBocmVmICk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHBvcyA9IChpbmRleCAqIDEwMCkgKiAtMTsKICAgICAgICBlbC50cmFuc2Zvcm1QYWdlKHNldHRpbmdzLCBwb3MpOwogICAgICB9CiAgICB9OwoKICAgICQuZm4ubW92ZVVwID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBlbCA9ICQodGhpcyk7CiAgICAgIGluZGV4ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsiLmFjdGl2ZSIpLmRhdGEoImluZGV4Iik7CiAgICAgIGlmKGluZGV4IDw9IHRvdGFsICYmIGluZGV4ID4gMSkgewogICAgICAgIGN1cnJlbnQgPSAkKHNldHRpbmdzLnNlY3Rpb25Db250YWluZXIgKyAiW2RhdGEtaW5kZXg9JyIgKyBpbmRleCArICInXSIpOwogICAgICAgIG5leHQgPSAkKHNldHRpbmdzLnNlY3Rpb25Db250YWluZXIgKyAiW2RhdGEtaW5kZXg9JyIgKyAoaW5kZXggLSAxKSArICInXSIpOwoKICAgICAgICBpZihuZXh0KSB7CiAgICAgICAgICBjdXJyZW50LnJlbW92ZUNsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgIG5leHQuYWRkQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgICAgaWYoc2V0dGluZ3MucGFnaW5hdGlvbiA9PT0gdHJ1ZSkgewogICAgICAgICAgICAkKCIub25lcGFnZS1wYWdpbmF0aW9uIGxpIGEiICsgIltkYXRhLWluZGV4PSciICsgaW5kZXggKyAiJ10iKS5yZW1vdmVDbGFzcygiYWN0aXZlIik7CiAgICAgICAgICAgICQoIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYSIgKyAiW2RhdGEtaW5kZXg9JyIgKyAoaW5kZXggLSAxKSArICInXSIpLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgIH0KICAgICAgICAgICQoImJvZHkiKVswXS5jbGFzc05hbWUgPSAkKCJib2R5IilbMF0uY2xhc3NOYW1lLnJlcGxhY2UoL1xidmlld2luZy1wYWdlLVxkLio/XGIvZywgJycpOwogICAgICAgICAgJCgiYm9keSIpLmFkZENsYXNzKCJ2aWV3aW5nLXBhZ2UtIituZXh0LmRhdGEoImluZGV4IikpOwoKICAgICAgICAgIGlmIChoaXN0b3J5LnJlcGxhY2VTdGF0ZSAmJiBzZXR0aW5ncy51cGRhdGVVUkwgPT09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zdWJzdHIoMCx3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCcjJykpICsgIiMiICsgKGluZGV4IC0gMSk7CiAgICAgICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKCB7fSwgZG9jdW1lbnQudGl0bGUsIGhyZWYgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcG9zID0gKChuZXh0LmRhdGEoImluZGV4IikgLSAxKSAqIDEwMCkgKiAtMTsKICAgICAgICBlbC50cmFuc2Zvcm1QYWdlKHNldHRpbmdzLCBwb3MpOwogICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXRfc2Nyb2xsKGV2ZW50LCBkZWx0YSkgewogICAgICAgIGRlbHRhT2ZJbnRlcmVzdCA9IGRlbHRhOwogICAgICAgIHZhciB0aW1lTm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgLy8gQ2FuY2VsIHNjcm9sbCBpZiBjdXJyZW50bHkgYW5pbWF0aW5nIG9yIHdpdGhpbiBxdWlldCBwZXJpb2QKICAgICAgICBpZih0aW1lTm93IC0gbGFzdEFuaW1hdGlvbiA8IHF1aWV0UGVyaW9kICsgc2V0dGluZ3MuYW5pbWF0aW9uVGltZSkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoZGVsdGFPZkludGVyZXN0IDwgMCkgewogICAgICAgICAgZWwubW92ZURvd24oKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWwubW92ZVVwKCk7CiAgICAgICAgfQogICAgICAgIGxhc3RBbmltYXRpb24gPSB0aW1lTm93OwogICAgfQoKICAgIC8vIFByZXBhcmUgZXZlcnl0aGluZyBiZWZvcmUgYmluZGluZyB3aGVlbCBzY3JvbGwKCiAgICBlbC5hZGRDbGFzcygib25lcGFnZS13cmFwcGVyIikuY3NzKCJwb3NpdGlvbiIsInJlbGF0aXZlIik7CiAgICAkLmVhY2goIHNlY3Rpb25zLCBmdW5jdGlvbihpKSB7CiAgICAgICQodGhpcykuY3NzKHsKICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICB0b3A6IHRvcFBvcyArICIlIgogICAgICB9KS5hZGRDbGFzcygic2VjdGlvbiIpLmF0dHIoImRhdGEtaW5kZXgiLCBpKzEpOwogICAgICB0b3BQb3MgPSB0b3BQb3MgKyAxMDA7CiAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT09IHRydWUpIHsKICAgICAgICBwYWdpbmF0aW9uTGlzdCArPSAiPGxpPjxhIGRhdGEtaW5kZXg9JyIrKGkrMSkrIicgaHJlZj0nIyIgKyAoaSsxKSArICInPjwvYT48L2xpPiI7CiAgICAgIH0KICAgIH0pOwoKICAgIGVsLnN3aXBlRXZlbnRzKCkuYmluZCgic3dpcGVEb3duIiwgIGZ1bmN0aW9uKCl7CiAgICAgIGVsLm1vdmVVcCgpOwogICAgfSkuYmluZCgic3dpcGVVcCIsIGZ1bmN0aW9uKCl7CiAgICAgIGVsLm1vdmVEb3duKCk7CiAgICB9KTsKCiAgICAvLyBDcmVhdGUgUGFnaW5hdGlvbiBhbmQgRGlzcGxheSBUaGVtCiAgICBpZihzZXR0aW5ncy5wYWdpbmF0aW9uID09PSB0cnVlKSB7CiAgICAgICQoIjx1bCBjbGFzcz0nb25lcGFnZS1wYWdpbmF0aW9uJz4iICsgcGFnaW5hdGlvbkxpc3QgKyAiPC91bD4iKS5wcmVwZW5kVG8oImJvZHkiKTsKICAgICAgcG9zVG9wID0gKGVsLmZpbmQoIi5vbmVwYWdlLXBhZ2luYXRpb24iKS5oZWlnaHQoKSAvIDIpICogLTE7CiAgICAgIGVsLmZpbmQoIi5vbmVwYWdlLXBhZ2luYXRpb24iKS5jc3MoIm1hcmdpbi10b3AiLCBwb3NUb3ApOwogICAgfQoKICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5oYXNoICE9PSAiIiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaCAhPT0gIiMxIikgewogICAgICBpbml0X2luZGV4ID0gIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoIiMiLCAiIik7CiAgICAgICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArICJbZGF0YS1pbmRleD0nIiArIGluaXRfaW5kZXggKyAiJ10iKS5hZGRDbGFzcygiYWN0aXZlIik7CiAgICAgICQoImJvZHkiKS5hZGRDbGFzcygidmlld2luZy1wYWdlLSIrIGluaXRfaW5kZXgpOwogICAgICBpZihzZXR0aW5ncy5wYWdpbmF0aW9uID09PSB0cnVlKSAkKCIub25lcGFnZS1wYWdpbmF0aW9uIGxpIGEiICsgIltkYXRhLWluZGV4PSciICsgaW5pdF9pbmRleCArICInXSIpLmFkZENsYXNzKCJhY3RpdmUiKTsKCiAgICAgIG5leHQgPSAkKHNldHRpbmdzLnNlY3Rpb25Db250YWluZXIgKyAiW2RhdGEtaW5kZXg9JyIgKyAoaW5pdF9pbmRleCkgKyAiJ10iKTsKICAgICAgaWYobmV4dCkgewogICAgICAgIG5leHQuYWRkQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT09IHRydWUpICQoIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYSIgKyAiW2RhdGEtaW5kZXg9JyIgKyAoaW5pdF9pbmRleCkgKyAiJ10iKS5hZGRDbGFzcygiYWN0aXZlIik7CiAgICAgICAgJCgiYm9keSIpWzBdLmNsYXNzTmFtZSA9ICQoImJvZHkiKVswXS5jbGFzc05hbWUucmVwbGFjZSgvXGJ2aWV3aW5nLXBhZ2UtXGQuKj9cYi9nLCAnJyk7CiAgICAgICAgJCgiYm9keSIpLmFkZENsYXNzKCJ2aWV3aW5nLXBhZ2UtIituZXh0LmRhdGEoImluZGV4IikpOwogICAgICAgIGlmIChoaXN0b3J5LnJlcGxhY2VTdGF0ZSAmJiBzZXR0aW5ncy51cGRhdGVVUkwgPT09IHRydWUpIHsKICAgICAgICAgIHZhciBocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3Vic3RyKDAsd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignIycpKSArICIjIiArIChpbml0X2luZGV4KTsKICAgICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKCB7fSwgZG9jdW1lbnQudGl0bGUsIGhyZWYgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcG9zID0gKChpbml0X2luZGV4IC0gMSkgKiAxMDApICogLTE7CiAgICAgIGVsLnRyYW5zZm9ybVBhZ2Uoc2V0dGluZ3MsIHBvcyk7CgogICAgfWVsc2V7CiAgICAgICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArICJbZGF0YS1pbmRleD0nMSddIikuYWRkQ2xhc3MoImFjdGl2ZSIpOwogICAgICAkKCJib2R5IikuYWRkQ2xhc3MoInZpZXdpbmctcGFnZS0xIik7CiAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT09IHRydWUpICQoIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYSIgKyAiW2RhdGEtaW5kZXg9JzEnXSIpLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgIH0KICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT09IHRydWUpICB7CiAgICAgICQoIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYSIpLmNsaWNrKGZ1bmN0aW9uICgpewogICAgICAgIHZhciBwYWdlX2luZGV4ID0gJCh0aGlzKS5kYXRhKCJpbmRleCIpOwogICAgICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcygiYWN0aXZlIikpIHsKICAgICAgICAgIGN1cnJlbnQgPSAkKHNldHRpbmdzLnNlY3Rpb25Db250YWluZXIgKyAiLmFjdGl2ZSIpOwogICAgICAgICAgbmV4dCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArICJbZGF0YS1pbmRleD0nIiArIChwYWdlX2luZGV4KSArICInXSIpOwogICAgICAgICAgaWYobmV4dCkgewogICAgICAgICAgICBjdXJyZW50LnJlbW92ZUNsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgICAgbmV4dC5hZGRDbGFzcygiYWN0aXZlIik7CiAgICAgICAgICAgICQoIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYSIgKyAiLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgICAgJCgiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhIiArICJbZGF0YS1pbmRleD0nIiArIChwYWdlX2luZGV4KSArICInXSIpLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgICAgJCgiYm9keSIpWzBdLmNsYXNzTmFtZSA9ICQoImJvZHkiKVswXS5jbGFzc05hbWUucmVwbGFjZSgvXGJ2aWV3aW5nLXBhZ2UtXGQuKj9cYi9nLCAnJyk7CiAgICAgICAgICAgICQoImJvZHkiKS5hZGRDbGFzcygidmlld2luZy1wYWdlLSIrbmV4dC5kYXRhKCJpbmRleCIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHBvcyA9ICgocGFnZV9pbmRleCAtIDEpICogMTAwKSAqIC0xOwogICAgICAgICAgZWwudHJhbnNmb3JtUGFnZShzZXR0aW5ncywgcG9zKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNldHRpbmdzLnVwZGF0ZVVSTCA9PT0gZmFsc2UpIHJldHVybiBmYWxzZTsKICAgICAgfSk7CiAgICB9CgoKCiAgICAkKGRvY3VtZW50KS5iaW5kKCdtb3VzZXdoZWVsIERPTU1vdXNlU2Nyb2xsJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIGRlbHRhID0gZXZlbnQub3JpZ2luYWxFdmVudC53aGVlbERlbHRhIHx8IC1ldmVudC5vcmlnaW5hbEV2ZW50LmRldGFpbDsKICAgICAgaW5pdF9zY3JvbGwoZXZlbnQsIGRlbHRhKTsKICAgIH0pOwogICAgcmV0dXJuIGZhbHNlOwoKICB9OwoKfSh3aW5kb3cualF1ZXJ5KTs=",
                "body": "LyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICoganF1ZXJ5LW9uZXBhZ2Utc2Nyb2xsLmpzIHYxCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvcHlyaWdodCAyMDEzIFBldGUgUm9qd29uZ3N1cml5YS4KICogaHR0cDovL3d3dy50aGVwZXRlZGVzaWduLmNvbQogKgogKiBDcmVhdGUgYW4gQXBwbGUtbGlrZSB3ZWJzaXRlIHRoYXQgbGV0IHVzZXIgc2Nyb2xsCiAqIG9uZSBwYWdlIGF0IGEgdGltZQogKgogKiBDcmVkaXQ6IEVpa2UgU2VuZCBmb3IgdGhlIGF3ZXNvbWUgc3dpcGUgZXZlbnQKICogaHR0cHM6Ly9naXRodWIuY29tL3BlYWNoYW5hbnIvb25lcGFnZS1zY3JvbGwKICoKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKIWZ1bmN0aW9uKCQpewoKICB2YXIgZGVmYXVsdHMgPSB7CiAgICBzZWN0aW9uQ29udGFpbmVyOiAic2VjdGlvbiIsCiAgICBlYXNpbmc6ICJlYXNlIiwKICAgIGFuaW1hdGlvblRpbWU6IDEwMDAsCiAgICBwYWdpbmF0aW9uOiB0cnVlLAogICAgdXBkYXRlVVJMOiBmYWxzZQogICAgfTsKCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCiAgICAvKiAgQ3JlZGl0OiBFaWtlIFNlbmQgZm9yIHRoZSBhd2Vzb21lIHN3aXBlIGV2ZW50ICovCiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgogICAgJC5mbi5zd2lwZUV2ZW50cyA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoKICAgICAgICB2YXIgc3RhcnRYLAogICAgICAgICAgICBzdGFydFksCiAgICAgICAgICAgICR0aGlzID0gJCh0aGlzKTsKCiAgICAgICAgJHRoaXMuYmluZCgndG91Y2hzdGFydCcsIHRvdWNoc3RhcnQpOwoKICAgICAgICBmdW5jdGlvbiB0b3VjaHN0YXJ0KGV2ZW50KSB7CiAgICAgICAgICB2YXIgdG91Y2hlcyA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlczsKICAgICAgICAgIGlmICh0b3VjaGVzICYmIHRvdWNoZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHN0YXJ0WCA9IHRvdWNoZXNbMF0ucGFnZVg7CiAgICAgICAgICAgIHN0YXJ0WSA9IHRvdWNoZXNbMF0ucGFnZVk7CiAgICAgICAgICAgICR0aGlzLmJpbmQoJ3RvdWNobW92ZScsIHRvdWNobW92ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdG91Y2htb3ZlKGV2ZW50KSB7CiAgICAgICAgICB2YXIgdG91Y2hlcyA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlczsKICAgICAgICAgIGlmICh0b3VjaGVzICYmIHRvdWNoZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBkZWx0YVggPSBzdGFydFggLSB0b3VjaGVzWzBdLnBhZ2VYOwogICAgICAgICAgICB2YXIgZGVsdGFZID0gc3RhcnRZIC0gdG91Y2hlc1swXS5wYWdlWTsKCiAgICAgICAgICAgIGlmIChkZWx0YVggPj0gNTApIHsKICAgICAgICAgICAgICAkdGhpcy50cmlnZ2VyKCJzd2lwZUxlZnQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGVsdGFYIDw9IC01MCkgewogICAgICAgICAgICAgICR0aGlzLnRyaWdnZXIoInN3aXBlUmlnaHQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGVsdGFZID49IDUwKSB7CiAgICAgICAgICAgICAgJHRoaXMudHJpZ2dlcigic3dpcGVVcCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkZWx0YVkgPD0gLTUwKSB7CiAgICAgICAgICAgICAgJHRoaXMudHJpZ2dlcigic3dpcGVEb3duIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRlbHRhWCkgPj0gNTAgfHwgTWF0aC5hYnMoZGVsdGFZKSA+PSA1MCkgewogICAgICAgICAgICAgICR0aGlzLnVuYmluZCgndG91Y2htb3ZlJywgdG91Y2htb3ZlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9CgogICAgICB9KTsKICAgIH07CgoKICAkLmZuLm9uZXBhZ2Vfc2Nyb2xsID0gZnVuY3Rpb24ob3B0aW9ucyl7CiAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMpLAogICAgICAgIGVsID0gJCh0aGlzKSwKICAgICAgICBzZWN0aW9ucyA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciksCiAgICAgICAgdG90YWwgPSBzZWN0aW9ucy5sZW5ndGgsCiAgICAgICAgc3RhdHVzID0gIm9mZiIsCiAgICAgICAgdG9wUG9zID0gMCwKICAgICAgICBsYXN0QW5pbWF0aW9uID0gMCwKICAgICAgICBxdWlldFBlcmlvZCA9IDUwMCwKICAgICAgICBwYWdpbmF0aW9uTGlzdCA9ICIiOwoKICAgICQuZm4udHJhbnNmb3JtUGFnZSA9IGZ1bmN0aW9uKHNldHRpbmdzLCBwb3MpIHsKICAgICAgJCh0aGlzKS5jc3MoewogICAgICAgICItd2Via2l0LXRyYW5zZm9ybSI6ICJ0cmFuc2xhdGUzZCgwLCAiICsgcG9zICsgIiUsIDApIiwKICAgICAgICAiLXdlYmtpdC10cmFuc2l0aW9uIjogImFsbCAiICsgc2V0dGluZ3MuYW5pbWF0aW9uVGltZSArICJtcyAiICsgc2V0dGluZ3MuZWFzaW5nLAogICAgICAgICItbW96LXRyYW5zZm9ybSI6ICJ0cmFuc2xhdGUzZCgwLCAiICsgcG9zICsgIiUsIDApIiwKICAgICAgICAiLW1vei10cmFuc2l0aW9uIjogImFsbCAiICsgc2V0dGluZ3MuYW5pbWF0aW9uVGltZSArICJtcyAiICsgc2V0dGluZ3MuZWFzaW5nLAogICAgICAgICItbXMtdHJhbnNmb3JtIjogInRyYW5zbGF0ZTNkKDAsICIgKyBwb3MgKyAiJSwgMCkiLAogICAgICAgICItbXMtdHJhbnNpdGlvbiI6ICJhbGwgIiArIHNldHRpbmdzLmFuaW1hdGlvblRpbWUgKyAibXMgIiArIHNldHRpbmdzLmVhc2luZywKICAgICAgICAidHJhbnNmb3JtIjogInRyYW5zbGF0ZTNkKDAsICIgKyBwb3MgKyAiJSwgMCkiLAogICAgICAgICJ0cmFuc2l0aW9uIjogImFsbCAiICsgc2V0dGluZ3MuYW5pbWF0aW9uVGltZSArICJtcyAiICsgc2V0dGluZ3MuZWFzaW5nCiAgICAgIH0pOwogICAgfTsKCiAgICAkLmZuLm1vdmVEb3duID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBlbCA9ICQodGhpcyk7CiAgICAgIGluZGV4ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsiLmFjdGl2ZSIpLmRhdGEoImluZGV4Iik7CiAgICAgIGlmKGluZGV4IDwgdG90YWwpIHsKICAgICAgICBjdXJyZW50ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgIltkYXRhLWluZGV4PSciICsgaW5kZXggKyAiJ10iKTsKICAgICAgICBuZXh0ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgIltkYXRhLWluZGV4PSciICsgKGluZGV4ICsgMSkgKyAiJ10iKTsKICAgICAgICBpZihuZXh0KSB7CiAgICAgICAgICBjdXJyZW50LnJlbW92ZUNsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgIG5leHQuYWRkQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgICAgaWYoc2V0dGluZ3MucGFnaW5hdGlvbiA9PT0gdHJ1ZSkgewogICAgICAgICAgICAkKCIub25lcGFnZS1wYWdpbmF0aW9uIGxpIGEiICsgIltkYXRhLWluZGV4PSciICsgaW5kZXggKyAiJ10iKS5yZW1vdmVDbGFzcygiYWN0aXZlIik7CiAgICAgICAgICAgICQoIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYSIgKyAiW2RhdGEtaW5kZXg9JyIgKyAoaW5kZXggKyAxKSArICInXSIpLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgIH0KICAgICAgICAgICQoImJvZHkiKVswXS5jbGFzc05hbWUgPSAkKCJib2R5IilbMF0uY2xhc3NOYW1lLnJlcGxhY2UoL1xidmlld2luZy1wYWdlLVxkLio/XGIvZywgJycpOwogICAgICAgICAgJCgiYm9keSIpLmFkZENsYXNzKCJ2aWV3aW5nLXBhZ2UtIituZXh0LmRhdGEoImluZGV4IikpOwoKICAgICAgICAgIGlmIChoaXN0b3J5LnJlcGxhY2VTdGF0ZSAmJiBzZXR0aW5ncy51cGRhdGVVUkwgPT09IHRydWUpIHsKICAgICAgICAgICAgdmFyIGhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zdWJzdHIoMCx3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCcjJykpICsgIiMiICsgKGluZGV4ICsgMSk7CiAgICAgICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKCB7fSwgZG9jdW1lbnQudGl0bGUsIGhyZWYgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcG9zID0gKGluZGV4ICogMTAwKSAqIC0xOwogICAgICAgIGVsLnRyYW5zZm9ybVBhZ2Uoc2V0dGluZ3MsIHBvcyk7CiAgICAgIH0KICAgIH07CgogICAgJC5mbi5tb3ZlVXAgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGVsID0gJCh0aGlzKTsKICAgICAgaW5kZXggPSAkKHNldHRpbmdzLnNlY3Rpb25Db250YWluZXIgKyIuYWN0aXZlIikuZGF0YSgiaW5kZXgiKTsKICAgICAgaWYoaW5kZXggPD0gdG90YWwgJiYgaW5kZXggPiAxKSB7CiAgICAgICAgY3VycmVudCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArICJbZGF0YS1pbmRleD0nIiArIGluZGV4ICsgIiddIik7CiAgICAgICAgbmV4dCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArICJbZGF0YS1pbmRleD0nIiArIChpbmRleCAtIDEpICsgIiddIik7CgogICAgICAgIGlmKG5leHQpIHsKICAgICAgICAgIGN1cnJlbnQucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgICAgbmV4dC5hZGRDbGFzcygiYWN0aXZlIik7CiAgICAgICAgICBpZihzZXR0aW5ncy5wYWdpbmF0aW9uID09PSB0cnVlKSB7CiAgICAgICAgICAgICQoIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYSIgKyAiW2RhdGEtaW5kZXg9JyIgKyBpbmRleCArICInXSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgICAgJCgiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhIiArICJbZGF0YS1pbmRleD0nIiArIChpbmRleCAtIDEpICsgIiddIikuYWRkQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgICAgfQogICAgICAgICAgJCgiYm9keSIpWzBdLmNsYXNzTmFtZSA9ICQoImJvZHkiKVswXS5jbGFzc05hbWUucmVwbGFjZSgvXGJ2aWV3aW5nLXBhZ2UtXGQuKj9cYi9nLCAnJyk7CiAgICAgICAgICAkKCJib2R5IikuYWRkQ2xhc3MoInZpZXdpbmctcGFnZS0iK25leHQuZGF0YSgiaW5kZXgiKSk7CgogICAgICAgICAgaWYgKGhpc3RvcnkucmVwbGFjZVN0YXRlICYmIHNldHRpbmdzLnVwZGF0ZVVSTCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN1YnN0cigwLHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoJyMnKSkgKyAiIyIgKyAoaW5kZXggLSAxKTsKICAgICAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoIHt9LCBkb2N1bWVudC50aXRsZSwgaHJlZiApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwb3MgPSAoKG5leHQuZGF0YSgiaW5kZXgiKSAtIDEpICogMTAwKSAqIC0xOwogICAgICAgIGVsLnRyYW5zZm9ybVBhZ2Uoc2V0dGluZ3MsIHBvcyk7CiAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gaW5pdF9zY3JvbGwoZXZlbnQsIGRlbHRhKSB7CiAgICAgICAgZGVsdGFPZkludGVyZXN0ID0gZGVsdGE7CiAgICAgICAgdmFyIHRpbWVOb3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAvLyBDYW5jZWwgc2Nyb2xsIGlmIGN1cnJlbnRseSBhbmltYXRpbmcgb3Igd2l0aGluIHF1aWV0IHBlcmlvZAogICAgICAgIGlmKHRpbWVOb3cgLSBsYXN0QW5pbWF0aW9uIDwgcXVpZXRQZXJpb2QgKyBzZXR0aW5ncy5hbmltYXRpb25UaW1lKSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChkZWx0YU9mSW50ZXJlc3QgPCAwKSB7CiAgICAgICAgICBlbC5tb3ZlRG93bigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbC5tb3ZlVXAoKTsKICAgICAgICB9CiAgICAgICAgbGFzdEFuaW1hdGlvbiA9IHRpbWVOb3c7CiAgICB9CgogICAgLy8gUHJlcGFyZSBldmVyeXRoaW5nIGJlZm9yZSBiaW5kaW5nIHdoZWVsIHNjcm9sbAoKICAgIGVsLmFkZENsYXNzKCJvbmVwYWdlLXdyYXBwZXIiKS5jc3MoInBvc2l0aW9uIiwicmVsYXRpdmUiKTsKICAgICQuZWFjaCggc2VjdGlvbnMsIGZ1bmN0aW9uKGkpIHsKICAgICAgJCh0aGlzKS5jc3MoewogICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgIHRvcDogdG9wUG9zICsgIiUiCiAgICAgIH0pLmFkZENsYXNzKCJzZWN0aW9uIikuYXR0cigiZGF0YS1pbmRleCIsIGkrMSk7CiAgICAgIHRvcFBvcyA9IHRvcFBvcyArIDEwMDsKICAgICAgaWYoc2V0dGluZ3MucGFnaW5hdGlvbiA9PT0gdHJ1ZSkgewogICAgICAgIHBhZ2luYXRpb25MaXN0ICs9ICI8bGk+PGEgZGF0YS1pbmRleD0nIisoaSsxKSsiJyBocmVmPScjIiArIChpKzEpICsgIic+PC9hPjwvbGk+IjsKICAgICAgfQogICAgfSk7CgogICAgZWwuc3dpcGVFdmVudHMoKS5iaW5kKCJzd2lwZURvd24iLCAgZnVuY3Rpb24oKXsKICAgICAgZWwubW92ZVVwKCk7CiAgICB9KS5iaW5kKCJzd2lwZVVwIiwgZnVuY3Rpb24oKXsKICAgICAgZWwubW92ZURvd24oKTsKICAgIH0pOwoKICAgIC8vIENyZWF0ZSBQYWdpbmF0aW9uIGFuZCBEaXNwbGF5IFRoZW0KICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT09IHRydWUpIHsKICAgICAgJCgiPHVsIGNsYXNzPSdvbmVwYWdlLXBhZ2luYXRpb24nPiIgKyBwYWdpbmF0aW9uTGlzdCArICI8L3VsPiIpLnByZXBlbmRUbygiYm9keSIpOwogICAgICBwb3NUb3AgPSAoZWwuZmluZCgiLm9uZXBhZ2UtcGFnaW5hdGlvbiIpLmhlaWdodCgpIC8gMikgKiAtMTsKICAgICAgZWwuZmluZCgiLm9uZXBhZ2UtcGFnaW5hdGlvbiIpLmNzcygibWFyZ2luLXRvcCIsIHBvc1RvcCk7CiAgICB9CgogICAgaWYod2luZG93LmxvY2F0aW9uLmhhc2ggIT09ICIiICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoICE9PSAiIzEiKSB7CiAgICAgIGluaXRfaW5kZXggPSAgd2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgiIyIsICIiKTsKICAgICAgJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgIltkYXRhLWluZGV4PSciICsgaW5pdF9pbmRleCArICInXSIpLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgJCgiYm9keSIpLmFkZENsYXNzKCJ2aWV3aW5nLXBhZ2UtIisgaW5pdF9pbmRleCk7CiAgICAgIGlmKHNldHRpbmdzLnBhZ2luYXRpb24gPT09IHRydWUpICQoIi5vbmVwYWdlLXBhZ2luYXRpb24gbGkgYSIgKyAiW2RhdGEtaW5kZXg9JyIgKyBpbml0X2luZGV4ICsgIiddIikuYWRkQ2xhc3MoImFjdGl2ZSIpOwoKICAgICAgbmV4dCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArICJbZGF0YS1pbmRleD0nIiArIChpbml0X2luZGV4KSArICInXSIpOwogICAgICBpZihuZXh0KSB7CiAgICAgICAgbmV4dC5hZGRDbGFzcygiYWN0aXZlIik7CiAgICAgICAgaWYoc2V0dGluZ3MucGFnaW5hdGlvbiA9PT0gdHJ1ZSkgJCgiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhIiArICJbZGF0YS1pbmRleD0nIiArIChpbml0X2luZGV4KSArICInXSIpLmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgICAkKCJib2R5IilbMF0uY2xhc3NOYW1lID0gJCgiYm9keSIpWzBdLmNsYXNzTmFtZS5yZXBsYWNlKC9cYnZpZXdpbmctcGFnZS1cZC4qP1xiL2csICcnKTsKICAgICAgICAkKCJib2R5IikuYWRkQ2xhc3MoInZpZXdpbmctcGFnZS0iK25leHQuZGF0YSgiaW5kZXgiKSk7CiAgICAgICAgaWYgKGhpc3RvcnkucmVwbGFjZVN0YXRlICYmIHNldHRpbmdzLnVwZGF0ZVVSTCA9PT0gdHJ1ZSkgewogICAgICAgICAgdmFyIGhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zdWJzdHIoMCx3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCcjJykpICsgIiMiICsgKGluaXRfaW5kZXgpOwogICAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoIHt9LCBkb2N1bWVudC50aXRsZSwgaHJlZiApOwogICAgICAgIH0KICAgICAgfQogICAgICBwb3MgPSAoKGluaXRfaW5kZXggLSAxKSAqIDEwMCkgKiAtMTsKICAgICAgZWwudHJhbnNmb3JtUGFnZShzZXR0aW5ncywgcG9zKTsKCiAgICB9ZWxzZXsKICAgICAgJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgIltkYXRhLWluZGV4PScxJ10iKS5hZGRDbGFzcygiYWN0aXZlIik7CiAgICAgICQoImJvZHkiKS5hZGRDbGFzcygidmlld2luZy1wYWdlLTEiKTsKICAgICAgaWYoc2V0dGluZ3MucGFnaW5hdGlvbiA9PT0gdHJ1ZSkgJCgiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhIiArICJbZGF0YS1pbmRleD0nMSddIikuYWRkQ2xhc3MoImFjdGl2ZSIpOwogICAgfQogICAgaWYoc2V0dGluZ3MucGFnaW5hdGlvbiA9PT0gdHJ1ZSkgIHsKICAgICAgJCgiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhIikuY2xpY2soZnVuY3Rpb24gKCl7CiAgICAgICAgdmFyIHBhZ2VfaW5kZXggPSAkKHRoaXMpLmRhdGEoImluZGV4Iik7CiAgICAgICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCJhY3RpdmUiKSkgewogICAgICAgICAgY3VycmVudCA9ICQoc2V0dGluZ3Muc2VjdGlvbkNvbnRhaW5lciArICIuYWN0aXZlIik7CiAgICAgICAgICBuZXh0ID0gJChzZXR0aW5ncy5zZWN0aW9uQ29udGFpbmVyICsgIltkYXRhLWluZGV4PSciICsgKHBhZ2VfaW5kZXgpICsgIiddIik7CiAgICAgICAgICBpZihuZXh0KSB7CiAgICAgICAgICAgIGN1cnJlbnQucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgICAgICBuZXh0LmFkZENsYXNzKCJhY3RpdmUiKTsKICAgICAgICAgICAgJCgiLm9uZXBhZ2UtcGFnaW5hdGlvbiBsaSBhIiArICIuYWN0aXZlIikucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgICAgICAkKCIub25lcGFnZS1wYWdpbmF0aW9uIGxpIGEiICsgIltkYXRhLWluZGV4PSciICsgKHBhZ2VfaW5kZXgpICsgIiddIikuYWRkQ2xhc3MoImFjdGl2ZSIpOwogICAgICAgICAgICAkKCJib2R5IilbMF0uY2xhc3NOYW1lID0gJCgiYm9keSIpWzBdLmNsYXNzTmFtZS5yZXBsYWNlKC9cYnZpZXdpbmctcGFnZS1cZC4qP1xiL2csICcnKTsKICAgICAgICAgICAgJCgiYm9keSIpLmFkZENsYXNzKCJ2aWV3aW5nLXBhZ2UtIituZXh0LmRhdGEoImluZGV4IikpOwogICAgICAgICAgfQogICAgICAgICAgcG9zID0gKChwYWdlX2luZGV4IC0gMSkgKiAxMDApICogLTE7CiAgICAgICAgICBlbC50cmFuc2Zvcm1QYWdlKHNldHRpbmdzLCBwb3MpOwogICAgICAgIH0KICAgICAgICBpZiAoc2V0dGluZ3MudXBkYXRlVVJMID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwogICAgICB9KTsKICAgIH0KCgoKICAgICQoZG9jdW1lbnQpLmJpbmQoJ21vdXNld2hlZWwgRE9NTW91c2VTY3JvbGwnLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB2YXIgZGVsdGEgPSBldmVudC5vcmlnaW5hbEV2ZW50LndoZWVsRGVsdGEgfHwgLWV2ZW50Lm9yaWdpbmFsRXZlbnQuZGV0YWlsOwogICAgICBpbml0X3Njcm9sbChldmVudCwgZGVsdGEpOwogICAgfSk7CiAgICByZXR1cm4gZmFsc2U7CgogIH07Cgp9KHdpbmRvdy5qUXVlcnkpOw==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:17:13 GMT",
                    "Content-Length": "9541",
                    "Date": "Fri, 07 Nov 2014 21:17:14 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}