{
    "url": "http://localhost:9999/icyz/zurbfoundation5-multiselect/zmultiselect/zurb5-multiselect.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.search</b> and written to <b>$()</b> via the following statements:<ul><li>var query = window.location.search.substring(1);</li><li>var vars = query.split(\"&amp;\");</li><li>var pair = vars[i].split(\"=\");</li><li>need = pair[1].replace(new RegExp(',', 'g'), '%2C').split('%2C');</li><li>$(\".zselect#\"+rel+\" ul li input:checkbox[value='\"+need[i]+\"']\").prop('checked',true);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/icyz/zurbfoundation5-multiselect/zmultiselect/zurb5-multiselect.js",
                "path": "/icyz/zurbfoundation5-multiselect/zmultiselect/zurb5-multiselect.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9pY3l6L3p1cmJmb3VuZGF0aW9uNS1tdWx0aXNlbGVjdC96bXVsdGlzZWxlY3QvenVyYjUtbXVsdGlzZWxlY3QuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTU2NzQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDA6NDg6MDcgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDAwOjQ4OjA3IEdNVA0KDQovKioKICogWlVSQiBGT1VOREFUSU9OIDUgTVVMVElTRUxFQ1QgUExVR0lOIAogKiAKICogQGF1dGhvciBBbmRyZWEgTWFyaWFuaQogKiBAbWFpbCBtZUBhbmRyZWFtYXJpYW5pLm5ldAogKiBAdHdpdHRlciBAYW5kcmVhbWFyaWFuaTJrCiAqIEB3ZWIgaHR0cDovL3d3dy5hbmRyZWFtYXJpYW5pLm5ldAogKiAKICogKiogVEhJUyBQTFVHSU4gSVMgSU4gREVWRUxPUE1FTlQgKiogKgogKi8KCihmdW5jdGlvbigkKSB7CiAgICAKICAgICAgIAogICAgLy90b2dnbGUgZm9yIGNsaWNrIG9uIHpzZWxlY3QsIGNsb3NlIGZvciBjbGljayBlbHNld2hlcmUsIG5vdGhpbmcgZm9yIGNsaWNrIG9uIC56c2VsZWN0ICoKICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpeyAgICAKICAgICAgICB2YXIgaWQ9ZmFsc2U7CiAgICAgICAgaWYoZS50YXJnZXQudGFnTmFtZSA9PSAnU1BBTicpeyBpZCA9ICQoZS50YXJnZXQpLnBhcmVudCgpLmF0dHIoJ2lkJyk7IH0KICAgICAgICBpZihlLnRhcmdldC50YWdOYW1lID09ICdESVYnKXsgIGlkID0gJChlLnRhcmdldCkuYXR0cignaWQnKTsgfQoKICAgICAgICB2YXIgY29udGFpbmVyID0gJCgiLnpzZWxlY3QgdWwiKTsKCiAgICAgICAgaWYgKCBjb250YWluZXIucGFyZW50KCkuaXMoZS50YXJnZXQpIHx8IGNvbnRhaW5lci5wcmV2KCkuaXMoZS50YXJnZXQpIHx8ICggY29udGFpbmVyLmlzKCc6dmlzaWJsZScpICYmICFjb250YWluZXIucGFyZW50KCkuaXMoZS50YXJnZXQpICkgJiYgKCBjb250YWluZXIuaGFzKGUudGFyZ2V0KS5sZW5ndGggPT09IDAgKSAgKSB7CiAgICAgICAgICAgIGlmKCFpZCkgY29udGFpbmVyLmhpZGUoKTsgLy93aGVuIHVzZXIgY2xpY2sgb3V0IAogICAgICAgICAgICBlbHNlICAgICQoIi56c2VsZWN0IyIraWQrIiB1bCIpLnRvZ2dsZSgpOwogICAgICAgIH0KCiAgICB9KTsKCiAgICAKCiAgICAvL2VzY2FwZSBrZXkgZm9yIGNsb3NlIGFsbCB6c2VsZWN0CiAgICAkKHdpbmRvdykub24oJ2tleWRvd24nLCBmdW5jdGlvbihlKXsKICAgICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7CiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMjcpIHsKICAgICAgICAgICAgJCgibGkuem1zZmlsdGVyIGlucHV0IikudmFsKCcnKS5rZXl1cCgpOyAvL2NsZWFuIGZpbHRlcgogICAgICAgICAgICAkKCIuenNlbGVjdCB1bCIpLmhpZGUoKTsKICAgICAgICB9CiAgICB9KTsKCgoKICAgIC8vY2xpY2sgb24gbGFiZWwgdG9nZ2xlIGlucHV0CiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnpzZWxlY3QgbGksIC56c2VsZWN0IGxpIGlucHV0OmNoZWNrYm94JywgZnVuY3Rpb24oZSl7IAogICAgICAgIHZhciB6YmVmb3JlX2NoYW5nZV9ldmVudCA9ICQuRXZlbnQoJ3piZWZvcmVfY2hhbmdlJywgeyd0YXJnZXQnOiBlLnRhcmdldH0pOwogICAgICAgICQodGhpcykudHJpZ2dlcih6YmVmb3JlX2NoYW5nZV9ldmVudCk7CiAgICAgICAgaWYoemJlZm9yZV9jaGFuZ2VfZXZlbnQucmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGlmKCQodGhpcykucHJvcCgidGFnTmFtZSIpID09ICdMSScpewogICAgICAgICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbigpLmF0dHIoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCkudHJpZ2dlcignY2hhbmdlJykKICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoImNoZWNrZWQiLCBmYWxzZSk7IC8vIGhhY2sgdG8ga2VlcCBwbGFjZWhvbGRlciB0ZXh0IGNvcnJlY3QKICAgICAgICAgICAgICAgICQodGhpcykudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAkKHRoaXMpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgIGlmKCQoZS50YXJnZXQpLnByb3AoInRhZ05hbWUiKSAhPT0gIklOUFVUIil7CiAgICAgICAgICAgICAgICAkKCJpbnB1dDpjaGVja2JveFtkaXNhYmxlZCE9J2Rpc2FibGVkJ10iLHRoaXMpLnByb3AoJ2NoZWNrZWQnLCBmdW5jdGlvbiggaSwgdmFsICkgeyByZXR1cm4gIXZhbDsgfSkudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgfSAgICAgICAgICAgIAogICAgfSk7CiAgICAKCiAgICAvL3NlbGVjdCBhbGwgYW5kIGRlc2VsZWN0IGFsbAogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywnLnNlbGVjdGFsbCwuZGVzZWxlY3RhbGwnLCBmdW5jdGlvbigpewogICAgICAgdmFyIHN0YXRlID0gKCQodGhpcykuaGFzQ2xhc3MoJ3NlbGVjdGFsbCcpKT90cnVlOmZhbHNlOwogICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCJpbnB1dDpjaGVja2JveFtkaXNhYmxlZCE9J2Rpc2FibGVkJ106dmlzaWJsZSIpLnByb3AoJ2NoZWNrZWQnLCBzdGF0ZSkuY2hhbmdlKCk7CiAgICB9KTsKCiAgICAvL29wdGdyb3VwCiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCcub3B0Z3JvdXAnLCBmdW5jdGlvbigpeyAKICAgICAgICB2YXIgemJlZm9yZV9vcHRncm91cF9ldmVudCA9ICQuRXZlbnQoJ3piZWZvcmVfb3B0Z3JvdXBfZXZlbnQnKTsKICAgICAgICAkKHRoaXMpLnRyaWdnZXIoemJlZm9yZV9vcHRncm91cF9ldmVudCk7CiAgICAgICAgaWYoemJlZm9yZV9vcHRncm91cF9ldmVudC5yZXN1bHQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdmFyIGNoZWNrZWQgPSBmYWxzZTsKICAgICAgICAkLmVhY2goICQodGhpcykucGFyZW50KCkuZmluZCgiLm9wdGdyb3VwXyIrJCh0aGlzKS5hdHRyKCdkYXRhLW9wdGdyb3VwJykrIiBsaSBpbnB1dDpjaGVja2JveFtkaXNhYmxlZCE9J2Rpc2FibGVkJ10iKSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgaWYoJCh0aGlzKS5wcm9wKCdjaGVja2VkJykgPT0gZmFsc2UpewogICAgICAgICAgICAgICAgY2hlY2tlZCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7ICAgIAogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIub3B0Z3JvdXBfIiskKHRoaXMpLmF0dHIoJ2RhdGEtb3B0Z3JvdXAnKSsiIGxpIGlucHV0OmNoZWNrYm94W2Rpc2FibGVkIT0nZGlzYWJsZWQnXSIpLnByb3AoJ2NoZWNrZWQnLCBjaGVja2VkKS5jaGFuZ2UoKTsKICAgICAgICAvL29sZCB2ZXJzaW9uIG1vZGU6IC5wcm9wKCdjaGVja2VkJywgZnVuY3Rpb24oIGksIHZhbCApIHsgcmV0dXJuICF2YWw7IH0pLmNoYW5nZSgpOwogICAgfSk7CgoKICAgIC8vd2hlbiByZXNpemUgd2luZG93ICsgaW5pdAogICAgZnVuY3Rpb24gb25SZXNpemUocmVmbG93KXsgCiAgICAgICAgJC5lYWNoKCAkKCIuenNlbGVjdCIpLCBmdW5jdGlvbihrLHYpewogICAgICAgICAgICAvL2lmKCAkKHYpLmZpbmQoInVsIikuYXR0cignc3R5bGUnKSAhPT0gdW5kZWZpbmVkICYmIHJlZmxvdyAhPT0gdHJ1ZSApIHJldHVybiBmYWxzZTsgLy9icmVhayBpZiBhbHJlYWR5IHNldAoKICAgICAgICAgICAgdmFyIHcgPSAkKHYpLm91dGVyV2lkdGgoKTsgCgogICAgICAgICAgICAkKHYpLmZpbmQoInVsIikuYXR0cignc3R5bGUnLCAnd2lkdGg6Jyt3KydweCFpbXBvcnRhbnQ7JyApOwoKCiAgICAgICAgICAgIC8vdmFyIHNpemUgPSBNYXRoLm1heChNYXRoLm1pbih3IC8gKDEpLCBwYXJzZUZsb2F0KDIwKSksIHBhcnNlRmxvYXQoMTEpKTsKICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhzaXplKTsKICAgICAgICAgICAgLy8kKHYpLmZpbmQoJ3VsIGxpJykuY3NzKCdmb250LXNpemUnLCBzaXplKTsKCiAgICAgICAgICAgIC8vdmFyIHdfbGkgPSAkKHYpLmZpbmQoJ3VsIGxpOmVxKDApJykud2lkdGgoKTsKICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh3X2xpKTsKCiAgICAgICAgfSk7CgogICAgfQoKICAgICQoIHdpbmRvdyApLnJlc2l6ZShmdW5jdGlvbigpIHsKICAgICAgICBvblJlc2l6ZSgpOwogICAgfSk7CgogICAgCiAgICBmdW5jdGlvbiByZWZyZXNoUGxhY2Vob2xkZXIocmVsLCBwbGFjZWhvbGRlciwgc2VsZWN0ZWRUZXh0KXsgCiAgICAgICAgdmFyIGNvdW50ZXIgPSBzZWxlY3RlZFRleHQgfHwgWydTZWxlemlvbmF0aSAnLCAnZGkgJ107CiAgICAgICAgdmFyIGNoZWNrZWQ9JCgiZGl2IyIrcmVsKyIgdWwgbGkgaW5wdXQ6Y2hlY2tlZCIpLmxlbmd0aDsKICAgICAgICB2YXIgdG90PSQoImRpdiMiK3JlbCsiIHVsIGxpIGlucHV0OmNoZWNrYm94IikubGVuZ3RoOwoKICAgICAgICBpZihjaGVja2VkPjApIHsKICAgICAgICAgICAgJCgiLnpzZWxlY3QjIityZWwrIiBzcGFuLnptc2hlYWQiKS50ZXh0KGNvdW50ZXJbMF0rIiAiK2NoZWNrZWQrIiAiK2NvdW50ZXJbMV0rIiAiK3RvdCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkKCIuenNlbGVjdCMiK3JlbCsiIHNwYW4uem1zaGVhZCIpLmh0bWwoIChwbGFjZWhvbGRlcj09PXVuZGVmaW5lZCkgPyAnJm5ic3A7JyA6IHBsYWNlaG9sZGVyICk7CiAgICAgICAgfQogICAgfQoKCgoKdmFyIG1ldGhvZHMgPSB7CiAgICBpbml0IDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgIAogICAgICAgIHZhciBpZCxjaGVja2VkLGRhdGFaLGRpc2FibGVkPSIiLGRpc2FibGVkQ2xhc3M9IiI7CiAgICAgICAgdmFyIG9wdGdyb3VwPVtdOwogICAgICAgIHZhciBvcHRncm91cF9zaXplLG9wdGdyb3VwX2lkID0gMDsKICAgICAgICB2YXIgb3B0Z3JvdXBfbmFtZSA9IGZhbHNlOwogICAgICAgIHZhciBvcHRncm91cF9tZW1iZXJzID0gMDsKICAgICAgICAKICAgICAgICAkLmVhY2goICQodGhpcyksZnVuY3Rpb24oayx2KXsKICAgICAgICAKICAgICAgICAgICAgaWQ9TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpOwogICAgICAgICAgICAkKHYpLmhpZGUoKS5hdHRyKCdyZWwnLGlkKTsgIAogICAgICAgICAgICAkKHYpLnBhcmVudCgpLmFwcGVuZCgiPGRpdiBpZD0nIitpZCsiJyBjbGFzcz0nenNlbGVjdCc+PHNwYW4gY2xhc3M9J3ptc2hlYWQnPjwvc3Bhbj48dWw+PC91bD48L2Rpdj4iKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKG9wdGlvbnMuc2VsZWN0QWxsIT09ZmFsc2UpewogICAgICAgICAgICAgICAgdmFyIHNBbGxUZXh0PSJTZWxlY3QgQWxsIjsKICAgICAgICAgICAgICAgIHZhciBkZXNBbGxUZXh0PSJEZXNlbGVjdCBBbGwiOwogICAgICAgICAgICAgICAgaWYob3B0aW9ucy5zZWxlY3RBbGxUZXh0IT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgICBzQWxsVGV4dD1vcHRpb25zLnNlbGVjdEFsbFRleHRbMF07CiAgICAgICAgICAgICAgICAgICAgZGVzQWxsVGV4dD1vcHRpb25zLnNlbGVjdEFsbFRleHRbMV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICQoJyMnK2lkKycgdWwnKS5hcHBlbmQoIjxsaSBjbGFzcz0nc2VsZWN0YWxsJz4iK3NBbGxUZXh0KyI8L2xpPiIpOwogICAgICAgICAgICAgICAgJCgnIycraWQrJyB1bCcpLmFwcGVuZCgiPGxpIGNsYXNzPSdkZXNlbGVjdGFsbCc+IitkZXNBbGxUZXh0KyI8L2xpPiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAkLmVhY2godiwgZnVuY3Rpb24oaix6KXsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyIGFwcGVuZFRvOwogICAgICAgICAgICAgICAgaWYoICQoeikucGFyZW50KCkuYXR0cigibGFiZWwiKSAhPT0gdW5kZWZpbmVkICYmIG9wdGdyb3VwLmluZGV4T2YoJCh6KS5wYXJlbnQoKS5hdHRyKCJsYWJlbCIpKT09PS0xICl7CiAgICAgICAgICAgICAgICAgICAgb3B0Z3JvdXBfc2l6ZSA9ICQoeikucGFyZW50KCkuZmluZCgnb3B0aW9uJykuc2l6ZSgpOwogICAgICAgICAgICAgICAgICAgIG9wdGdyb3VwX21lbWJlcnMgKz0gb3B0Z3JvdXBfc2l6ZTsKICAgICAgICAgICAgICAgICAgICBvcHRncm91cF9uYW1lID0gJCh6KS5wYXJlbnQoKS5hdHRyKCJsYWJlbCIpOyAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgJCgnIycraWQrJyB1bCcpLmFwcGVuZCgiPGxpIGNsYXNzPSdvcHRncm91cCcgZGF0YS1vcHRncm91cD0nIitvcHRncm91cF9pZCsiJz4iKyQoeikucGFyZW50KCkuYXR0cigibGFiZWwiKSsiPC9saT4iKTsKICAgICAgICAgICAgICAgICAgICAkKCcjJytpZCsnIHVsJykuYXBwZW5kKCQoIjxkaXY+IikuYWRkQ2xhc3MoJ29wdGdyb3VwXycrb3B0Z3JvdXBfaWQpKTsKICAgICAgICAgICAgICAgICAgICBvcHRncm91cC5wdXNoKCQoeikucGFyZW50KCkuYXR0cigibGFiZWwiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCAkKHopLmF0dHIoJ3ZhbHVlJykgKyAiICIgKyAkKHopLnRleHQoKSArICIgIiArICQoeikuaXMoJ1tkYXRhLXNlbGVjdGVkXScpICsgIiAiICsgJCh6KS5pcygnOnNlbGVjdGVkJykpOwogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpZCk7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCAnIycraWQrJyB1bCcgKTsKICAgICAgICAgICAgICAgIGNoZWNrZWQgPSAoICQoeikuaXMoJ1tkYXRhLXNlbGVjdGVkXScpICkgPyAiY2hlY2tlZD0nY2hlY2tlZCciIDogIiI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRhdGFaID0gKCAkKHopLmRhdGEoInoiKSAhPT0gdW5kZWZpbmVkICkgPyAnZGF0YS16PSInICsgJCh6KS5kYXRhKCJ6IikgKyAnIicgOiAiIjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYoICQoeikuaXMoJ1tkYXRhLWRpc2FibGVkXScpICl7CiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQgPSAiZGlzYWJsZWQ9J2Rpc2FibGVkJyI7CiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWRDbGFzcyA9ICJjbGFzcz0nZGlzYWJsZWQnIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQgPSBkaXNhYmxlZENsYXNzID0gIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmKCBvcHRncm91cF9uYW1lID09PSBmYWxzZSApIGFwcGVuZFRvID0gJyMnK2lkKycgdWwnOwogICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kVG8gPSAnIycraWQrJyB1bCBkaXYub3B0Z3JvdXBfJytvcHRncm91cF9pZDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICQoYXBwZW5kVG8pLmFwcGVuZCgiPGxpICIrZGlzYWJsZWRDbGFzcysiPjxpbnB1dCB2YWx1ZT0nIiskKHopLnZhbCgpKyInIHR5cGU9J2NoZWNrYm94JyAiK2NoZWNrZWQrIiAiK2Rpc2FibGVkKyIgIitkYXRhWisiIC8+PHNwYW4gc3R5bGU9XCJ3aWR0aDoxMDAlO2Rpc3BsYXk6dGFibGUtY2VsbDtcIj4iKyQoeikudGV4dCgpKyI8L3NwYW4+PC9saT4iKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYob3B0Z3JvdXBfbWVtYmVycyA9PT0gaisxKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0Z3JvdXBfc2l6ZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgb3B0Z3JvdXBfaWQgKys7CiAgICAgICAgICAgICAgICAgICAgb3B0Z3JvdXBfbmFtZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQoJyMnK2lkKycgc3Bhbi56bXNoZWFkJykuaHRtbCggKG9wdGlvbnMucGxhY2Vob2xkZXI9PT11bmRlZmluZWQpID8gJyZuYnNwOycgOiBvcHRpb25zLnBsYWNlaG9sZGVyICk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgaWYob3B0aW9ucy5maWx0ZXIgPT09IHRydWUpewogICAgICAgICAgICAvL2RlZmF1bHRzCiAgICAgICAgICAgIGlmIChvcHRpb25zLmZpbHRlclJlc3VsdCA9PT0gdW5kZWZpbmVkKSBvcHRpb25zLmZpbHRlclJlc3VsdCA9IHRydWU7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmZpbHRlclJlc3VsdFRleHQgPT09IHVuZGVmaW5lZCkgb3B0aW9ucy5maWx0ZXJSZXN1bHRUZXh0ID0gJ3Nob3dlZCc7CiAgICAgICAgICAgIHZhciBmcGxhaG9sZGVyID0gKG9wdGlvbnMuZmlsdGVyUGxhY2Vob2xkZXIgIT09IHVuZGVmaW5lZCkgPyBvcHRpb25zLmZpbHRlclBsYWNlaG9sZGVyIDogIkZpbHRlci4uLiI7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIHJlbCA9IHRoaXMuYXR0cigncmVsJyk7CiAgICAgICAgICAgICQoImRpdiMiK3JlbCsiIHVsIikucHJlcGVuZCgnPGxpIGNsYXNzPSJ6bXNmaWx0ZXIiPjxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iJytmcGxhaG9sZGVyKyciIC8+PC9saT4nKTsKCiAgICAgICAgICAgIAoKICAgICAgICAgICAgaWYob3B0aW9ucy5maWx0ZXJSZXN1bHQgPT09IHRydWUpCiAgICAgICAgICAgICAgICAkKCJkaXYjIityZWwrIiB1bCIpLmFwcGVuZCgnPGxpIGNsYXNzPSJmaWx0ZXJSZXN1bHQiPjwvbGk+Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkKCJkaXYjIityZWwrIiB1bCBsaS56bXNmaWx0ZXIgaW5wdXQiKS5rZXl1cChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZT0kKHRoaXMpLnZhbCgpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNob3c9MCx0b3Q9JCgiZGl2IyIrcmVsKyIgdWwgbGkgaW5wdXQ6Y2hlY2tib3giKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgJCgiZGl2IyIrcmVsKyIgdWwgbGkgaW5wdXQ6Y2hlY2tib3giKS5maWx0ZXIoIGZ1bmN0aW9uKGksdikgewogICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJCh2KS52YWwoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygkKHYpLnBhcmVudCgpLnRleHQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoICQodikudmFsKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHZhbHVlKSA9PT0gLTEgJiYgJCh2KS5wYXJlbnQoKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHZhbHVlKSA9PT0gLTEgKXsvL2FuZCB0ZXh0KCkgY2hlY2suLi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodikucGFyZW50KCkuaGlkZSgpOwogCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh2KS5wYXJlbnQoKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZihvcHRpb25zLmZpbHRlclJlc3VsdCA9PT0gdHJ1ZSkgCiAgICAgICAgICAgICAgICAgICAgICAgICQoImRpdiMiK3JlbCsiIHVsIGxpLmZpbHRlclJlc3VsdCIpLnRleHQob3B0aW9ucy5maWx0ZXJSZXN1bHRUZXh0ICsgJyAnK3Nob3crJy8nK3RvdCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9Ly9lbmQgZmlsdGVyCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgaWYob3B0aW9ucy5saXZlICE9PSB1bmRlZmluZWQpewogICAgICAgICAgICB2YXIgcmVsID0gdGhpcy5hdHRyKCdyZWwnKTsKICAgICAgICAgICAgJCgiLnpzZWxlY3QjIityZWwpLm9uKCdjaGFuZ2UnLCdpbnB1dDpjaGVja2JveCcsZnVuY3Rpb24oZSl7CiAgICAgICAgICAgICAgICAkKG9wdGlvbnMubGl2ZSkudmFsKCBtZXRob2RzLmdldFZhbHVlKCQoInNlbGVjdFtyZWw9JyIrcmVsKyInXSIpKSApOwogICAgICAgICAgICB9KTsKICAgICAgICB9Ly9lbmQgbGl2ZQogICAgICAgIAogICAgICAgIAogICAgICAgIGlmKG9wdGlvbnMuZ2V0ICE9PSB1bmRlZmluZWQpeyAgLy9jb25zb2xlLmxvZyhvcHRpb25zLmdldCk7CiAgICAgICAgICAgIHZhciBxdWVyeSA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpOwogICAgICAgICAgICB2YXIgdmFycyA9IHF1ZXJ5LnNwbGl0KCImIik7CiAgICAgICAgICAgIHZhciBuZWVkID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPHZhcnMubGVuZ3RoO2krKykgewogICAgICAgICAgICAgICAgdmFyIHBhaXIgPSB2YXJzW2ldLnNwbGl0KCI9Iik7CiAgICAgICAgICAgICAgICBpZiAocGFpclswXSA9PSBvcHRpb25zLmdldCkgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbmVlZCA9IHBhaXJbMV0ucmVwbGFjZShuZXcgUmVnRXhwKCcsJywgJ2cnKSwgJyUyQycpLnNwbGl0KCclMkMnKTsKICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIAogICAgICAgICAgICBpZihuZWVkKXsKICAgICAgICAgICAgICAgIHZhciByZWwgPSB0aGlzLmF0dHIoJ3JlbCcpOwogICAgICAgICAgICAgICAgdmFyIF9saXZlID0gIiI7CiAgICAgICAgICAgICAgICBmb3IodmFyIGk9MDsgaTxuZWVkLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgICAkKCIuenNlbGVjdCMiK3JlbCsiIHVsIGxpIGlucHV0OmNoZWNrYm94W3ZhbHVlPSciK25lZWRbaV0rIiddIikucHJvcCgnY2hlY2tlZCcsdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgX2xpdmUgKz0gbmVlZFtpXSsiLCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL3JlZnJlc2ggbGl2ZSB2YWx1ZQogICAgICAgICAgICAgICAgaWYob3B0aW9ucy5saXZlICE9PSB1bmRlZmluZWQpewogICAgICAgICAgICAgICAgICAgICQob3B0aW9ucy5saXZlKS52YWwoX2xpdmUuc3Vic3RyaW5nKDAsIF9saXZlLmxlbmd0aCAtIDEpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlZnJlc2hQbGFjZWhvbGRlcihyZWwsb3B0aW9ucy5wbGFjZWhvbGRlcixvcHRpb25zLnNlbGVjdGVkVGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFVwZGF0ZXMgb3JpZ2luYWwgc2VsZWN0IGFmdGVyIGNoZWNrYm94IHVwZGF0ZQogICAgICAgICQoIi56c2VsZWN0Iikub24oJ2NoYW5nZScsICdpbnB1dDpjaGVja2JveCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gJCh0aGlzKS5jbG9zZXN0KCcuenNlbGVjdCcpOwogICAgICAgICAgICB2YXIgcmVsID0gY29udGFpbmVyLmF0dHIoJ2lkJyk7CiAgICAgICAgICAgIHJlZnJlc2hQbGFjZWhvbGRlcihyZWwsIG9wdGlvbnMucGxhY2Vob2xkZXIsIG9wdGlvbnMuc2VsZWN0ZWRUZXh0KTsKCiAgICAgICAgICAgIHZhciBzZWxlY3QgPSAkKCdzZWxlY3RbcmVsPScrcmVsKyddJyk7CiAgICAgICAgICAgICQuZWFjaChjb250YWluZXIuZmluZCgnaW5wdXQ6Y2hlY2tib3gnKSwgZnVuY3Rpb24oaywgdikgewogICAgICAgICAgICAgICAgaWYoJCh2KS52YWwoKSAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgICBpZigkKHYpLnByb3AoJ2NoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3QuZmluZCgib3B0aW9uW3ZhbHVlPSciKyQodikudmFsKCkrIiddIikucHJvcCgic2VsZWN0ZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3QuZmluZCgib3B0aW9uW3ZhbHVlPSciKyQodikudmFsKCkrIiddIikucHJvcCgic2VsZWN0ZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2VsZWN0LnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgIH0pOwoKICAgICAgICBvblJlc2l6ZSgpOwoKCiAgICB9LAogICAgCiAgICAKICAgIAogICAgCiAgICBnZXRWYWx1ZSA6IGZ1bmN0aW9uKHNlbGVjdG9yKSB7IAogICAgICAgaWYoc2VsZWN0b3I9PT11bmRlZmluZWQpIHNlbGVjdG9yID0gdGhpczsgCiAgICAgICB2YXIgdmFsdWUgPSBuZXcgQXJyYXkoKTsKICAgICAgIHZhciByZWwgICA9ICQoc2VsZWN0b3IpLmF0dHIoJ3JlbCcpOwogICAgICAgJC5lYWNoKCAkKCJkaXYjIityZWwrIiB1bCBsaSBpbnB1dCIpLCBmdW5jdGlvbihrLHYpewogICAgICAgICAgaWYoICQodikudmFsKCkgIT09IHVuZGVmaW5lZCApewogICAgICAgICAgICAgICBpZiggJCh2KS5wcm9wKCdjaGVja2VkJykgKQogICAgICAgICAgICAgICB2YWx1ZS5wdXNoKCQodikudmFsKCkpOwogICAgICAgICAgfQogICAgICAgfSk7CiAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9LAogICAgCiAgICAgICAgCiAgICBvcGVuIDogZnVuY3Rpb24oICkgewogICAgICAgICQoImRpdiMiKyQodGhpcykuYXR0cigncmVsJykrIiB1bCIpLnNob3coKTsKICAgIH0sCiAgICBjbG9zZSA6IGZ1bmN0aW9uKCApIHsKICAgICAgICAkKCJkaXYjIiskKHRoaXMpLmF0dHIoJ3JlbCcpKyIgdWwiKS5oaWRlKCk7CiAgICB9LAogICAgCiAgICAgICAgICAgIAogICAgZGlzYWJsZSA6IGZ1bmN0aW9uICh2YWwsc3RhdGUpeyAvL2NvbnNvbGUubG9nKHN0YXRlKTsKICAgICAgICBpZih2YWwhPT11bmRlZmluZWQpewogICAgICAgICAgICBpZihzdGF0ZSkgJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIGxpIGlucHV0OmNoZWNrYm94W3ZhbHVlPSciK3ZhbCsiJ10iKS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgIGVsc2UgICAgICAkKCJkaXYjIiskKHRoaXMpLmF0dHIoJ3JlbCcpKyIgdWwgbGkgaW5wdXQ6Y2hlY2tib3hbdmFsdWU9JyIrdmFsKyInXSIpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIGlmKHN0YXRlKSAkKCJkaXYjIiskKHRoaXMpLmF0dHIoJ3JlbCcpKyIgdWwgbGkgaW5wdXQ6Y2hlY2tib3giKS5hdHRyKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgIGVsc2UgICAgICAkKCJkaXYjIiskKHRoaXMpLmF0dHIoJ3JlbCcpKyIgdWwgbGkgaW5wdXQ6Y2hlY2tib3giKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOwogICAgICAgIH0KICAgIH0sCiAgICBzZXQgOiBmdW5jdGlvbiAodmFsLGNoZWNrZWQpewogICAgICAgICQoImRpdiMiKyQodGhpcykuYXR0cigncmVsJykrIiB1bCBsaSBpbnB1dDpjaGVja2JveFt2YWx1ZT0nIit2YWwrIiddIikucHJvcCgnY2hlY2tlZCcsIGNoZWNrZWQpLmNoYW5nZSgpOwogICAgfSwKICAgIHVuY2hlY2thbGxfaW5wYWdlIDogZnVuY3Rpb24oICkgewogICAgICAgICQoIi56c2VsZWN0IHVsIGxpIGlucHV0OmNoZWNrYm94IikucHJvcCgnY2hlY2tlZCcsIGZhbHNlKS5jaGFuZ2UoKTsKICAgIH0sCiAgICBjaGVja2FsbF9pbnBhZ2UgOiBmdW5jdGlvbiggKSB7CiAgICAgICAgJCgiLnpzZWxlY3QgdWwgbGkgaW5wdXQ6Y2hlY2tib3giKS5wcm9wKCdjaGVja2VkJywgdHJ1ZSkuY2hhbmdlKCk7CiAgICB9LAogICAgY2hlY2thbGwgOiBmdW5jdGlvbiggKSB7CiAgICAgICAgJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIGxpIGlucHV0OmNoZWNrYm94IikucHJvcCgnY2hlY2tlZCcsIHRydWUpLmNoYW5nZSgpOwogICAgfSwKICAgIHVuY2hlY2thbGwgOiBmdW5jdGlvbiggKSB7CiAgICAgICAgJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIGxpIGlucHV0OmNoZWNrYm94IikucHJvcCgnY2hlY2tlZCcsIGZhbHNlKS5jaGFuZ2UoKTsKICAgIH0sCiAgICBkZXN0cm95IDogZnVuY3Rpb24gKHZhbCl7CiAgICAgICAgJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIGxpIGlucHV0OmNoZWNrYm94W3ZhbHVlPSciK3ZhbCsiJ10iKS5wYXJlbnQoKS5yZW1vdmUoKTsKICAgIH0sCiAgICByZWZsb3cgOiBmdW5jdGlvbigpewogICAgICAgIG9uUmVzaXplKHRydWUpOwogICAgfSwgICAKICAgIAogICAgYWRkIDogZnVuY3Rpb24ob3B0aW9uLCBwb3MpewogICAgICAgIHZhciBwb3NpdGlvbiA9IHBvcyB8fCAnYXBwZW5kJzsKICAgICAgICB2YXIgY2hlY2tlZD0nJywgZGlzYWJsZWQ9JycsIGRpc2FibGVkQ2xhc3M9Jyc7CiAgICAgICAgCiAgICAgICAgaWYob3B0aW9uLmNoZWNrZWQpICBjaGVja2VkPScgY2hlY2tlZD0iY2hlY2tlZCIgJzsKICAgICAgICBpZihvcHRpb24uZGlzYWJsZWQpIHtkaXNhYmxlZD0nIGRpc2FibGVkPSJkaXNhYmxlZCIgJzsgZGlzYWJsZWRDbGFzcz0nIGNsYXNzPSJkaXNhYmxlZCIgJzt9CiAgICAgICAgCiAgICAgICAgaWYocG9zaXRpb24gPT09ICdhcHBlbmQnKSAkKCJkaXYjIiskKHRoaXMpLmF0dHIoJ3JlbCcpKyIgdWwiKS5hcHBlbmQoIjxsaSAiK2Rpc2FibGVkQ2xhc3MrIj48aW5wdXQgdmFsdWU9JyIrb3B0aW9uLnZhbHVlKyInIHR5cGU9J2NoZWNrYm94JyAiK2NoZWNrZWQrIiAiK2Rpc2FibGVkKyIgLz4mbmJzcDsiK29wdGlvbi50ZXh0KyI8L2xpPiIpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZihwb3NpdGlvbiA9PT0gJ3ByZXBlbmQnKXsKICAgICAgICAgICAgICAgJCgiPGxpICIrZGlzYWJsZWRDbGFzcysiPjxpbnB1dCB2YWx1ZT0nIitvcHRpb24udmFsdWUrIicgdHlwZT0nY2hlY2tib3gnICIrY2hlY2tlZCsiICIrZGlzYWJsZWQrIiAvPiZuYnNwOyIrb3B0aW9uLnRleHQrIjwvbGk+IikuaW5zZXJ0QWZ0ZXIoJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIGxpLmRlc2VsZWN0YWxsIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICQoIjxsaSAiK2Rpc2FibGVkQ2xhc3MrIj48aW5wdXQgdmFsdWU9JyIrb3B0aW9uLnZhbHVlKyInIHR5cGU9J2NoZWNrYm94JyAiK2NoZWNrZWQrIiAiK2Rpc2FibGVkKyIgLz4mbmJzcDsiK29wdGlvbi50ZXh0KyI8L2xpPiIpLmluc2VydEFmdGVyKCQoImRpdiMiKyQodGhpcykuYXR0cigncmVsJykrIiB1bCBsaSBpbnB1dFt2YWx1ZT0nIitwb3NpdGlvbi5zdWJzdHJpbmcoMSkrIiddIikuY2xvc2VzdCgnbGknKSk7IAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgICAgIAogICAgICAgICAgCiAgICB9CiAgICAgICAgICAgIAogICAgLy8sdXBkYXRlIDogZnVuY3Rpb24oIGNvbnRlbnQgKSB7ICB9CiAgICB9OwoKCgoKCgokLmZuLnptdWx0aXNlbGVjdCA9IGZ1bmN0aW9uKG1ldGhvZE9yT3B0aW9ucykgewogICAgaWYgKCBtZXRob2RzW21ldGhvZE9yT3B0aW9uc10gKSB7CiAgICAgICAgcmV0dXJuIG1ldGhvZHNbIG1ldGhvZE9yT3B0aW9ucyBdLmFwcGx5KCB0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggYXJndW1lbnRzLCAxICkpOwogICAgfSBlbHNlIGlmICggdHlwZW9mIG1ldGhvZE9yT3B0aW9ucyA9PT0gJ29iamVjdCcgfHwgISBtZXRob2RPck9wdGlvbnMgKSB7CiAgICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CiAgICB9IGVsc2UgewogICAgICAgICQuZXJyb3IoICdNZXRob2QgJyArICBtZXRob2RPck9wdGlvbnMgKyAnIGRvZXMgbm90IGV4aXN0IG9uIHptdWx0aXNlbGVjdCcgKTsKICAgIH0gICAgCiAgICB9OwoKCgp9KSggalF1ZXJ5ICk7Cg==",
                "body": "LyoqCiAqIFpVUkIgRk9VTkRBVElPTiA1IE1VTFRJU0VMRUNUIFBMVUdJTiAKICogCiAqIEBhdXRob3IgQW5kcmVhIE1hcmlhbmkKICogQG1haWwgbWVAYW5kcmVhbWFyaWFuaS5uZXQKICogQHR3aXR0ZXIgQGFuZHJlYW1hcmlhbmkyawogKiBAd2ViIGh0dHA6Ly93d3cuYW5kcmVhbWFyaWFuaS5uZXQKICogCiAqICoqIFRISVMgUExVR0lOIElTIElOIERFVkVMT1BNRU5UICoqICoKICovCgooZnVuY3Rpb24oJCkgewogICAgCiAgICAgICAKICAgIC8vdG9nZ2xlIGZvciBjbGljayBvbiB6c2VsZWN0LCBjbG9zZSBmb3IgY2xpY2sgZWxzZXdoZXJlLCBub3RoaW5nIGZvciBjbGljayBvbiAuenNlbGVjdCAqCiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbihlKXsgICAgCiAgICAgICAgdmFyIGlkPWZhbHNlOwogICAgICAgIGlmKGUudGFyZ2V0LnRhZ05hbWUgPT0gJ1NQQU4nKXsgaWQgPSAkKGUudGFyZ2V0KS5wYXJlbnQoKS5hdHRyKCdpZCcpOyB9CiAgICAgICAgaWYoZS50YXJnZXQudGFnTmFtZSA9PSAnRElWJyl7ICBpZCA9ICQoZS50YXJnZXQpLmF0dHIoJ2lkJyk7IH0KCiAgICAgICAgdmFyIGNvbnRhaW5lciA9ICQoIi56c2VsZWN0IHVsIik7CgogICAgICAgIGlmICggY29udGFpbmVyLnBhcmVudCgpLmlzKGUudGFyZ2V0KSB8fCBjb250YWluZXIucHJldigpLmlzKGUudGFyZ2V0KSB8fCAoIGNvbnRhaW5lci5pcygnOnZpc2libGUnKSAmJiAhY29udGFpbmVyLnBhcmVudCgpLmlzKGUudGFyZ2V0KSApICYmICggY29udGFpbmVyLmhhcyhlLnRhcmdldCkubGVuZ3RoID09PSAwICkgICkgewogICAgICAgICAgICBpZighaWQpIGNvbnRhaW5lci5oaWRlKCk7IC8vd2hlbiB1c2VyIGNsaWNrIG91dCAKICAgICAgICAgICAgZWxzZSAgICAkKCIuenNlbGVjdCMiK2lkKyIgdWwiKS50b2dnbGUoKTsKICAgICAgICB9CgogICAgfSk7CgogICAgCgogICAgLy9lc2NhcGUga2V5IGZvciBjbG9zZSBhbGwgenNlbGVjdAogICAgJCh3aW5kb3cpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSl7CiAgICAgICAgZSA9IGUgfHwgd2luZG93LmV2ZW50OwogICAgICAgIGlmIChlLmtleUNvZGUgPT09IDI3KSB7CiAgICAgICAgICAgICQoImxpLnptc2ZpbHRlciBpbnB1dCIpLnZhbCgnJykua2V5dXAoKTsgLy9jbGVhbiBmaWx0ZXIKICAgICAgICAgICAgJCgiLnpzZWxlY3QgdWwiKS5oaWRlKCk7CiAgICAgICAgfQogICAgfSk7CgoKCiAgICAvL2NsaWNrIG9uIGxhYmVsIHRvZ2dsZSBpbnB1dAogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy56c2VsZWN0IGxpLCAuenNlbGVjdCBsaSBpbnB1dDpjaGVja2JveCcsIGZ1bmN0aW9uKGUpeyAKICAgICAgICB2YXIgemJlZm9yZV9jaGFuZ2VfZXZlbnQgPSAkLkV2ZW50KCd6YmVmb3JlX2NoYW5nZScsIHsndGFyZ2V0JzogZS50YXJnZXR9KTsKICAgICAgICAkKHRoaXMpLnRyaWdnZXIoemJlZm9yZV9jaGFuZ2VfZXZlbnQpOwogICAgICAgIGlmKHpiZWZvcmVfY2hhbmdlX2V2ZW50LnJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBpZigkKHRoaXMpLnByb3AoInRhZ05hbWUiKSA9PSAnTEknKXsKICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oKS5hdHRyKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbigpLnRyaWdnZXIoJ2NoYW5nZScpCiAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKCJjaGVja2VkIiwgZmFsc2UpOyAvLyBoYWNrIHRvIGtlZXAgcGxhY2Vob2xkZXIgdGV4dCBjb3JyZWN0CiAgICAgICAgICAgICAgICAkKHRoaXMpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgJCh0aGlzKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICBpZigkKGUudGFyZ2V0KS5wcm9wKCJ0YWdOYW1lIikgIT09ICJJTlBVVCIpewogICAgICAgICAgICAgICAgJCgiaW5wdXQ6Y2hlY2tib3hbZGlzYWJsZWQhPSdkaXNhYmxlZCddIix0aGlzKS5wcm9wKCdjaGVja2VkJywgZnVuY3Rpb24oIGksIHZhbCApIHsgcmV0dXJuICF2YWw7IH0pLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgIH0gICAgICAgICAgICAKICAgIH0pOwogICAgCgogICAgLy9zZWxlY3QgYWxsIGFuZCBkZXNlbGVjdCBhbGwKICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsJy5zZWxlY3RhbGwsLmRlc2VsZWN0YWxsJywgZnVuY3Rpb24oKXsKICAgICAgIHZhciBzdGF0ZSA9ICgkKHRoaXMpLmhhc0NsYXNzKCdzZWxlY3RhbGwnKSk/dHJ1ZTpmYWxzZTsKICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiaW5wdXQ6Y2hlY2tib3hbZGlzYWJsZWQhPSdkaXNhYmxlZCddOnZpc2libGUiKS5wcm9wKCdjaGVja2VkJywgc3RhdGUpLmNoYW5nZSgpOwogICAgfSk7CgogICAgLy9vcHRncm91cAogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywnLm9wdGdyb3VwJywgZnVuY3Rpb24oKXsgCiAgICAgICAgdmFyIHpiZWZvcmVfb3B0Z3JvdXBfZXZlbnQgPSAkLkV2ZW50KCd6YmVmb3JlX29wdGdyb3VwX2V2ZW50Jyk7CiAgICAgICAgJCh0aGlzKS50cmlnZ2VyKHpiZWZvcmVfb3B0Z3JvdXBfZXZlbnQpOwogICAgICAgIGlmKHpiZWZvcmVfb3B0Z3JvdXBfZXZlbnQucmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHZhciBjaGVja2VkID0gZmFsc2U7CiAgICAgICAgJC5lYWNoKCAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5vcHRncm91cF8iKyQodGhpcykuYXR0cignZGF0YS1vcHRncm91cCcpKyIgbGkgaW5wdXQ6Y2hlY2tib3hbZGlzYWJsZWQhPSdkaXNhYmxlZCddIiksIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGlmKCQodGhpcykucHJvcCgnY2hlY2tlZCcpID09IGZhbHNlKXsKICAgICAgICAgICAgICAgIGNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAgICAKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiLm9wdGdyb3VwXyIrJCh0aGlzKS5hdHRyKCdkYXRhLW9wdGdyb3VwJykrIiBsaSBpbnB1dDpjaGVja2JveFtkaXNhYmxlZCE9J2Rpc2FibGVkJ10iKS5wcm9wKCdjaGVja2VkJywgY2hlY2tlZCkuY2hhbmdlKCk7CiAgICAgICAgLy9vbGQgdmVyc2lvbiBtb2RlOiAucHJvcCgnY2hlY2tlZCcsIGZ1bmN0aW9uKCBpLCB2YWwgKSB7IHJldHVybiAhdmFsOyB9KS5jaGFuZ2UoKTsKICAgIH0pOwoKCiAgICAvL3doZW4gcmVzaXplIHdpbmRvdyArIGluaXQKICAgIGZ1bmN0aW9uIG9uUmVzaXplKHJlZmxvdyl7IAogICAgICAgICQuZWFjaCggJCgiLnpzZWxlY3QiKSwgZnVuY3Rpb24oayx2KXsKICAgICAgICAgICAgLy9pZiggJCh2KS5maW5kKCJ1bCIpLmF0dHIoJ3N0eWxlJykgIT09IHVuZGVmaW5lZCAmJiByZWZsb3cgIT09IHRydWUgKSByZXR1cm4gZmFsc2U7IC8vYnJlYWsgaWYgYWxyZWFkeSBzZXQKCiAgICAgICAgICAgIHZhciB3ID0gJCh2KS5vdXRlcldpZHRoKCk7IAoKICAgICAgICAgICAgJCh2KS5maW5kKCJ1bCIpLmF0dHIoJ3N0eWxlJywgJ3dpZHRoOicrdysncHghaW1wb3J0YW50OycgKTsKCgogICAgICAgICAgICAvL3ZhciBzaXplID0gTWF0aC5tYXgoTWF0aC5taW4odyAvICgxKSwgcGFyc2VGbG9hdCgyMCkpLCBwYXJzZUZsb2F0KDExKSk7CiAgICAgICAgICAgIC8vY29uc29sZS5sb2coc2l6ZSk7CiAgICAgICAgICAgIC8vJCh2KS5maW5kKCd1bCBsaScpLmNzcygnZm9udC1zaXplJywgc2l6ZSk7CgogICAgICAgICAgICAvL3ZhciB3X2xpID0gJCh2KS5maW5kKCd1bCBsaTplcSgwKScpLndpZHRoKCk7CiAgICAgICAgICAgIC8vY29uc29sZS5sb2cod19saSk7CgogICAgICAgIH0pOwoKICAgIH0KCiAgICAkKCB3aW5kb3cgKS5yZXNpemUoZnVuY3Rpb24oKSB7CiAgICAgICAgb25SZXNpemUoKTsKICAgIH0pOwoKICAgIAogICAgZnVuY3Rpb24gcmVmcmVzaFBsYWNlaG9sZGVyKHJlbCwgcGxhY2Vob2xkZXIsIHNlbGVjdGVkVGV4dCl7IAogICAgICAgIHZhciBjb3VudGVyID0gc2VsZWN0ZWRUZXh0IHx8IFsnU2VsZXppb25hdGkgJywgJ2RpICddOwogICAgICAgIHZhciBjaGVja2VkPSQoImRpdiMiK3JlbCsiIHVsIGxpIGlucHV0OmNoZWNrZWQiKS5sZW5ndGg7CiAgICAgICAgdmFyIHRvdD0kKCJkaXYjIityZWwrIiB1bCBsaSBpbnB1dDpjaGVja2JveCIpLmxlbmd0aDsKCiAgICAgICAgaWYoY2hlY2tlZD4wKSB7CiAgICAgICAgICAgICQoIi56c2VsZWN0IyIrcmVsKyIgc3Bhbi56bXNoZWFkIikudGV4dChjb3VudGVyWzBdKyIgIitjaGVja2VkKyIgIitjb3VudGVyWzFdKyIgIit0b3QpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJCgiLnpzZWxlY3QjIityZWwrIiBzcGFuLnptc2hlYWQiKS5odG1sKCAocGxhY2Vob2xkZXI9PT11bmRlZmluZWQpID8gJyZuYnNwOycgOiBwbGFjZWhvbGRlciApOwogICAgICAgIH0KICAgIH0KCgoKCnZhciBtZXRob2RzID0gewogICAgaW5pdCA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAKICAgICAgICB2YXIgaWQsY2hlY2tlZCxkYXRhWixkaXNhYmxlZD0iIixkaXNhYmxlZENsYXNzPSIiOwogICAgICAgIHZhciBvcHRncm91cD1bXTsKICAgICAgICB2YXIgb3B0Z3JvdXBfc2l6ZSxvcHRncm91cF9pZCA9IDA7CiAgICAgICAgdmFyIG9wdGdyb3VwX25hbWUgPSBmYWxzZTsKICAgICAgICB2YXIgb3B0Z3JvdXBfbWVtYmVycyA9IDA7CiAgICAgICAgCiAgICAgICAgJC5lYWNoKCAkKHRoaXMpLGZ1bmN0aW9uKGssdil7CiAgICAgICAgCiAgICAgICAgICAgIGlkPU1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTsKICAgICAgICAgICAgJCh2KS5oaWRlKCkuYXR0cigncmVsJyxpZCk7ICAKICAgICAgICAgICAgJCh2KS5wYXJlbnQoKS5hcHBlbmQoIjxkaXYgaWQ9JyIraWQrIicgY2xhc3M9J3pzZWxlY3QnPjxzcGFuIGNsYXNzPSd6bXNoZWFkJz48L3NwYW4+PHVsPjwvdWw+PC9kaXY+Iik7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihvcHRpb25zLnNlbGVjdEFsbCE9PWZhbHNlKXsKICAgICAgICAgICAgICAgIHZhciBzQWxsVGV4dD0iU2VsZWN0IEFsbCI7CiAgICAgICAgICAgICAgICB2YXIgZGVzQWxsVGV4dD0iRGVzZWxlY3QgQWxsIjsKICAgICAgICAgICAgICAgIGlmKG9wdGlvbnMuc2VsZWN0QWxsVGV4dCE9PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgICAgc0FsbFRleHQ9b3B0aW9ucy5zZWxlY3RBbGxUZXh0WzBdOwogICAgICAgICAgICAgICAgICAgIGRlc0FsbFRleHQ9b3B0aW9ucy5zZWxlY3RBbGxUZXh0WzFdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkKCcjJytpZCsnIHVsJykuYXBwZW5kKCI8bGkgY2xhc3M9J3NlbGVjdGFsbCc+IitzQWxsVGV4dCsiPC9saT4iKTsKICAgICAgICAgICAgICAgICQoJyMnK2lkKycgdWwnKS5hcHBlbmQoIjxsaSBjbGFzcz0nZGVzZWxlY3RhbGwnPiIrZGVzQWxsVGV4dCsiPC9saT4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgJC5lYWNoKHYsIGZ1bmN0aW9uKGoseil7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZhciBhcHBlbmRUbzsKICAgICAgICAgICAgICAgIGlmKCAkKHopLnBhcmVudCgpLmF0dHIoImxhYmVsIikgIT09IHVuZGVmaW5lZCAmJiBvcHRncm91cC5pbmRleE9mKCQoeikucGFyZW50KCkuYXR0cigibGFiZWwiKSk9PT0tMSApewogICAgICAgICAgICAgICAgICAgIG9wdGdyb3VwX3NpemUgPSAkKHopLnBhcmVudCgpLmZpbmQoJ29wdGlvbicpLnNpemUoKTsKICAgICAgICAgICAgICAgICAgICBvcHRncm91cF9tZW1iZXJzICs9IG9wdGdyb3VwX3NpemU7CiAgICAgICAgICAgICAgICAgICAgb3B0Z3JvdXBfbmFtZSA9ICQoeikucGFyZW50KCkuYXR0cigibGFiZWwiKTsgIAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICQoJyMnK2lkKycgdWwnKS5hcHBlbmQoIjxsaSBjbGFzcz0nb3B0Z3JvdXAnIGRhdGEtb3B0Z3JvdXA9JyIrb3B0Z3JvdXBfaWQrIic+IiskKHopLnBhcmVudCgpLmF0dHIoImxhYmVsIikrIjwvbGk+Iik7CiAgICAgICAgICAgICAgICAgICAgJCgnIycraWQrJyB1bCcpLmFwcGVuZCgkKCI8ZGl2PiIpLmFkZENsYXNzKCdvcHRncm91cF8nK29wdGdyb3VwX2lkKSk7CiAgICAgICAgICAgICAgICAgICAgb3B0Z3JvdXAucHVzaCgkKHopLnBhcmVudCgpLmF0dHIoImxhYmVsIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyggJCh6KS5hdHRyKCd2YWx1ZScpICsgIiAiICsgJCh6KS50ZXh0KCkgKyAiICIgKyAkKHopLmlzKCdbZGF0YS1zZWxlY3RlZF0nKSArICIgIiArICQoeikuaXMoJzpzZWxlY3RlZCcpKTsKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coaWQpOwogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyggJyMnK2lkKycgdWwnICk7CiAgICAgICAgICAgICAgICBjaGVja2VkID0gKCAkKHopLmlzKCdbZGF0YS1zZWxlY3RlZF0nKSApID8gImNoZWNrZWQ9J2NoZWNrZWQnIiA6ICIiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkYXRhWiA9ICggJCh6KS5kYXRhKCJ6IikgIT09IHVuZGVmaW5lZCApID8gJ2RhdGEtej0iJyArICQoeikuZGF0YSgieiIpICsgJyInIDogIiI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmKCAkKHopLmlzKCdbZGF0YS1kaXNhYmxlZF0nKSApewogICAgICAgICAgICAgICAgICAgIGRpc2FibGVkID0gImRpc2FibGVkPSdkaXNhYmxlZCciOwogICAgICAgICAgICAgICAgICAgIGRpc2FibGVkQ2xhc3MgPSAiY2xhc3M9J2Rpc2FibGVkJyI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgIGRpc2FibGVkID0gZGlzYWJsZWRDbGFzcyA9ICIiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiggb3B0Z3JvdXBfbmFtZSA9PT0gZmFsc2UgKSBhcHBlbmRUbyA9ICcjJytpZCsnIHVsJzsKICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZFRvID0gJyMnK2lkKycgdWwgZGl2Lm9wdGdyb3VwXycrb3B0Z3JvdXBfaWQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkKGFwcGVuZFRvKS5hcHBlbmQoIjxsaSAiK2Rpc2FibGVkQ2xhc3MrIj48aW5wdXQgdmFsdWU9JyIrJCh6KS52YWwoKSsiJyB0eXBlPSdjaGVja2JveCcgIitjaGVja2VkKyIgIitkaXNhYmxlZCsiICIrZGF0YVorIiAvPjxzcGFuIHN0eWxlPVwid2lkdGg6MTAwJTtkaXNwbGF5OnRhYmxlLWNlbGw7XCI+IiskKHopLnRleHQoKSsiPC9zcGFuPjwvbGk+Iik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmKG9wdGdyb3VwX21lbWJlcnMgPT09IGorMSkgewogICAgICAgICAgICAgICAgICAgIG9wdGdyb3VwX3NpemUgPSAwOwogICAgICAgICAgICAgICAgICAgIG9wdGdyb3VwX2lkICsrOwogICAgICAgICAgICAgICAgICAgIG9wdGdyb3VwX25hbWUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkKCcjJytpZCsnIHNwYW4uem1zaGVhZCcpLmh0bWwoIChvcHRpb25zLnBsYWNlaG9sZGVyPT09dW5kZWZpbmVkKSA/ICcmbmJzcDsnIDogb3B0aW9ucy5wbGFjZWhvbGRlciApOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGlmKG9wdGlvbnMuZmlsdGVyID09PSB0cnVlKXsKICAgICAgICAgICAgLy9kZWZhdWx0cwogICAgICAgICAgICBpZiAob3B0aW9ucy5maWx0ZXJSZXN1bHQgPT09IHVuZGVmaW5lZCkgb3B0aW9ucy5maWx0ZXJSZXN1bHQgPSB0cnVlOwogICAgICAgICAgICBpZiAob3B0aW9ucy5maWx0ZXJSZXN1bHRUZXh0ID09PSB1bmRlZmluZWQpIG9wdGlvbnMuZmlsdGVyUmVzdWx0VGV4dCA9ICdzaG93ZWQnOwogICAgICAgICAgICB2YXIgZnBsYWhvbGRlciA9IChvcHRpb25zLmZpbHRlclBsYWNlaG9sZGVyICE9PSB1bmRlZmluZWQpID8gb3B0aW9ucy5maWx0ZXJQbGFjZWhvbGRlciA6ICJGaWx0ZXIuLi4iOwogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhciByZWwgPSB0aGlzLmF0dHIoJ3JlbCcpOwogICAgICAgICAgICAkKCJkaXYjIityZWwrIiB1bCIpLnByZXBlbmQoJzxsaSBjbGFzcz0iem1zZmlsdGVyIj48aW5wdXQgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9IicrZnBsYWhvbGRlcisnIiAvPjwvbGk+Jyk7CgogICAgICAgICAgICAKCiAgICAgICAgICAgIGlmKG9wdGlvbnMuZmlsdGVyUmVzdWx0ID09PSB0cnVlKQogICAgICAgICAgICAgICAgJCgiZGl2IyIrcmVsKyIgdWwiKS5hcHBlbmQoJzxsaSBjbGFzcz0iZmlsdGVyUmVzdWx0Ij48L2xpPicpOwogICAgICAgICAgICAKICAgICAgICAgICAgJCgiZGl2IyIrcmVsKyIgdWwgbGkuem1zZmlsdGVyIGlucHV0Iikua2V5dXAoZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWU9JCh0aGlzKS52YWwoKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgIHZhciBzaG93PTAsdG90PSQoImRpdiMiK3JlbCsiIHVsIGxpIGlucHV0OmNoZWNrYm94IikubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICQoImRpdiMiK3JlbCsiIHVsIGxpIGlucHV0OmNoZWNrYm94IikuZmlsdGVyKCBmdW5jdGlvbihpLHYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCQodikudmFsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJCh2KS5wYXJlbnQoKS50ZXh0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkKHYpLnZhbCgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWx1ZSkgPT09IC0xICYmICQodikucGFyZW50KCkudGV4dCgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2YWx1ZSkgPT09IC0xICl7Ly9hbmQgdGV4dCgpIGNoZWNrLi4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHYpLnBhcmVudCgpLmhpZGUoKTsKIAogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodikucGFyZW50KCkuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdysrOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYob3B0aW9ucy5maWx0ZXJSZXN1bHQgPT09IHRydWUpIAogICAgICAgICAgICAgICAgICAgICAgICAkKCJkaXYjIityZWwrIiB1bCBsaS5maWx0ZXJSZXN1bHQiKS50ZXh0KG9wdGlvbnMuZmlsdGVyUmVzdWx0VGV4dCArICcgJytzaG93KycvJyt0b3QpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfS8vZW5kIGZpbHRlcgogICAgICAgIAogICAgICAgIAogICAgICAgIGlmKG9wdGlvbnMubGl2ZSAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgdmFyIHJlbCA9IHRoaXMuYXR0cigncmVsJyk7CiAgICAgICAgICAgICQoIi56c2VsZWN0IyIrcmVsKS5vbignY2hhbmdlJywnaW5wdXQ6Y2hlY2tib3gnLGZ1bmN0aW9uKGUpewogICAgICAgICAgICAgICAgJChvcHRpb25zLmxpdmUpLnZhbCggbWV0aG9kcy5nZXRWYWx1ZSgkKCJzZWxlY3RbcmVsPSciK3JlbCsiJ10iKSkgKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfS8vZW5kIGxpdmUKICAgICAgICAKICAgICAgICAKICAgICAgICBpZihvcHRpb25zLmdldCAhPT0gdW5kZWZpbmVkKXsgIC8vY29uc29sZS5sb2cob3B0aW9ucy5nZXQpOwogICAgICAgICAgICB2YXIgcXVlcnkgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgdmFyIHZhcnMgPSBxdWVyeS5zcGxpdCgiJiIpOwogICAgICAgICAgICB2YXIgbmVlZCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKHZhciBpPTA7aTx2YXJzLmxlbmd0aDtpKyspIHsKICAgICAgICAgICAgICAgIHZhciBwYWlyID0gdmFyc1tpXS5zcGxpdCgiPSIpOwogICAgICAgICAgICAgICAgaWYgKHBhaXJbMF0gPT0gb3B0aW9ucy5nZXQpIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG5lZWQgPSBwYWlyWzFdLnJlcGxhY2UobmV3IFJlZ0V4cCgnLCcsICdnJyksICclMkMnKS5zcGxpdCgnJTJDJyk7CiAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IAogICAgICAgICAgICAKICAgICAgICAgICAgaWYobmVlZCl7CiAgICAgICAgICAgICAgICB2YXIgcmVsID0gdGhpcy5hdHRyKCdyZWwnKTsKICAgICAgICAgICAgICAgIHZhciBfbGl2ZSA9ICIiOwogICAgICAgICAgICAgICAgZm9yKHZhciBpPTA7IGk8bmVlZC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgICAgICAgICAgJCgiLnpzZWxlY3QjIityZWwrIiB1bCBsaSBpbnB1dDpjaGVja2JveFt2YWx1ZT0nIituZWVkW2ldKyInXSIpLnByb3AoJ2NoZWNrZWQnLHRydWUpOwogICAgICAgICAgICAgICAgICAgIF9saXZlICs9IG5lZWRbaV0rIiwiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9yZWZyZXNoIGxpdmUgdmFsdWUKICAgICAgICAgICAgICAgIGlmKG9wdGlvbnMubGl2ZSAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgICAkKG9wdGlvbnMubGl2ZSkudmFsKF9saXZlLnN1YnN0cmluZygwLCBfbGl2ZS5sZW5ndGggLSAxKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZWZyZXNoUGxhY2Vob2xkZXIocmVsLG9wdGlvbnMucGxhY2Vob2xkZXIsb3B0aW9ucy5zZWxlY3RlZFRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGVzIG9yaWdpbmFsIHNlbGVjdCBhZnRlciBjaGVja2JveCB1cGRhdGUKICAgICAgICAkKCIuenNlbGVjdCIpLm9uKCdjaGFuZ2UnLCAnaW5wdXQ6Y2hlY2tib3gnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9ICQodGhpcykuY2xvc2VzdCgnLnpzZWxlY3QnKTsKICAgICAgICAgICAgdmFyIHJlbCA9IGNvbnRhaW5lci5hdHRyKCdpZCcpOwogICAgICAgICAgICByZWZyZXNoUGxhY2Vob2xkZXIocmVsLCBvcHRpb25zLnBsYWNlaG9sZGVyLCBvcHRpb25zLnNlbGVjdGVkVGV4dCk7CgogICAgICAgICAgICB2YXIgc2VsZWN0ID0gJCgnc2VsZWN0W3JlbD0nK3JlbCsnXScpOwogICAgICAgICAgICAkLmVhY2goY29udGFpbmVyLmZpbmQoJ2lucHV0OmNoZWNrYm94JyksIGZ1bmN0aW9uKGssIHYpIHsKICAgICAgICAgICAgICAgIGlmKCQodikudmFsKCkgIT09IHVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgICAgaWYoJCh2KS5wcm9wKCdjaGVja2VkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0LmZpbmQoIm9wdGlvblt2YWx1ZT0nIiskKHYpLnZhbCgpKyInXSIpLnByb3AoInNlbGVjdGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0LmZpbmQoIm9wdGlvblt2YWx1ZT0nIiskKHYpLnZhbCgpKyInXSIpLnByb3AoInNlbGVjdGVkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGVjdC50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICB9KTsKCiAgICAgICAgb25SZXNpemUoKTsKCgogICAgfSwKICAgIAogICAgCiAgICAKICAgIAogICAgZ2V0VmFsdWUgOiBmdW5jdGlvbihzZWxlY3RvcikgeyAKICAgICAgIGlmKHNlbGVjdG9yPT09dW5kZWZpbmVkKSBzZWxlY3RvciA9IHRoaXM7IAogICAgICAgdmFyIHZhbHVlID0gbmV3IEFycmF5KCk7CiAgICAgICB2YXIgcmVsICAgPSAkKHNlbGVjdG9yKS5hdHRyKCdyZWwnKTsKICAgICAgICQuZWFjaCggJCgiZGl2IyIrcmVsKyIgdWwgbGkgaW5wdXQiKSwgZnVuY3Rpb24oayx2KXsKICAgICAgICAgIGlmKCAkKHYpLnZhbCgpICE9PSB1bmRlZmluZWQgKXsKICAgICAgICAgICAgICAgaWYoICQodikucHJvcCgnY2hlY2tlZCcpICkKICAgICAgICAgICAgICAgdmFsdWUucHVzaCgkKHYpLnZhbCgpKTsKICAgICAgICAgIH0KICAgICAgIH0pOwogICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSwKICAgIAogICAgICAgIAogICAgb3BlbiA6IGZ1bmN0aW9uKCApIHsKICAgICAgICAkKCJkaXYjIiskKHRoaXMpLmF0dHIoJ3JlbCcpKyIgdWwiKS5zaG93KCk7CiAgICB9LAogICAgY2xvc2UgOiBmdW5jdGlvbiggKSB7CiAgICAgICAgJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIikuaGlkZSgpOwogICAgfSwKICAgIAogICAgICAgICAgICAKICAgIGRpc2FibGUgOiBmdW5jdGlvbiAodmFsLHN0YXRlKXsgLy9jb25zb2xlLmxvZyhzdGF0ZSk7CiAgICAgICAgaWYodmFsIT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgaWYoc3RhdGUpICQoImRpdiMiKyQodGhpcykuYXR0cigncmVsJykrIiB1bCBsaSBpbnB1dDpjaGVja2JveFt2YWx1ZT0nIit2YWwrIiddIikuYXR0cignZGlzYWJsZWQnLCdkaXNhYmxlZCcpOwogICAgICAgICAgICBlbHNlICAgICAgJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIGxpIGlucHV0OmNoZWNrYm94W3ZhbHVlPSciK3ZhbCsiJ10iKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBpZihzdGF0ZSkgJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIGxpIGlucHV0OmNoZWNrYm94IikuYXR0cignZGlzYWJsZWQnLCdkaXNhYmxlZCcpOwogICAgICAgICAgICBlbHNlICAgICAgJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIGxpIGlucHV0OmNoZWNrYm94IikucmVtb3ZlQXR0cignZGlzYWJsZWQnKTsKICAgICAgICB9CiAgICB9LAogICAgc2V0IDogZnVuY3Rpb24gKHZhbCxjaGVja2VkKXsKICAgICAgICAkKCJkaXYjIiskKHRoaXMpLmF0dHIoJ3JlbCcpKyIgdWwgbGkgaW5wdXQ6Y2hlY2tib3hbdmFsdWU9JyIrdmFsKyInXSIpLnByb3AoJ2NoZWNrZWQnLCBjaGVja2VkKS5jaGFuZ2UoKTsKICAgIH0sCiAgICB1bmNoZWNrYWxsX2lucGFnZSA6IGZ1bmN0aW9uKCApIHsKICAgICAgICAkKCIuenNlbGVjdCB1bCBsaSBpbnB1dDpjaGVja2JveCIpLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSkuY2hhbmdlKCk7CiAgICB9LAogICAgY2hlY2thbGxfaW5wYWdlIDogZnVuY3Rpb24oICkgewogICAgICAgICQoIi56c2VsZWN0IHVsIGxpIGlucHV0OmNoZWNrYm94IikucHJvcCgnY2hlY2tlZCcsIHRydWUpLmNoYW5nZSgpOwogICAgfSwKICAgIGNoZWNrYWxsIDogZnVuY3Rpb24oICkgewogICAgICAgICQoImRpdiMiKyQodGhpcykuYXR0cigncmVsJykrIiB1bCBsaSBpbnB1dDpjaGVja2JveCIpLnByb3AoJ2NoZWNrZWQnLCB0cnVlKS5jaGFuZ2UoKTsKICAgIH0sCiAgICB1bmNoZWNrYWxsIDogZnVuY3Rpb24oICkgewogICAgICAgICQoImRpdiMiKyQodGhpcykuYXR0cigncmVsJykrIiB1bCBsaSBpbnB1dDpjaGVja2JveCIpLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSkuY2hhbmdlKCk7CiAgICB9LAogICAgZGVzdHJveSA6IGZ1bmN0aW9uICh2YWwpewogICAgICAgICQoImRpdiMiKyQodGhpcykuYXR0cigncmVsJykrIiB1bCBsaSBpbnB1dDpjaGVja2JveFt2YWx1ZT0nIit2YWwrIiddIikucGFyZW50KCkucmVtb3ZlKCk7CiAgICB9LAogICAgcmVmbG93IDogZnVuY3Rpb24oKXsKICAgICAgICBvblJlc2l6ZSh0cnVlKTsKICAgIH0sICAgCiAgICAKICAgIGFkZCA6IGZ1bmN0aW9uKG9wdGlvbiwgcG9zKXsKICAgICAgICB2YXIgcG9zaXRpb24gPSBwb3MgfHwgJ2FwcGVuZCc7CiAgICAgICAgdmFyIGNoZWNrZWQ9JycsIGRpc2FibGVkPScnLCBkaXNhYmxlZENsYXNzPScnOwogICAgICAgIAogICAgICAgIGlmKG9wdGlvbi5jaGVja2VkKSAgY2hlY2tlZD0nIGNoZWNrZWQ9ImNoZWNrZWQiICc7CiAgICAgICAgaWYob3B0aW9uLmRpc2FibGVkKSB7ZGlzYWJsZWQ9JyBkaXNhYmxlZD0iZGlzYWJsZWQiICc7IGRpc2FibGVkQ2xhc3M9JyBjbGFzcz0iZGlzYWJsZWQiICc7fQogICAgICAgIAogICAgICAgIGlmKHBvc2l0aW9uID09PSAnYXBwZW5kJykgJCgiZGl2IyIrJCh0aGlzKS5hdHRyKCdyZWwnKSsiIHVsIikuYXBwZW5kKCI8bGkgIitkaXNhYmxlZENsYXNzKyI+PGlucHV0IHZhbHVlPSciK29wdGlvbi52YWx1ZSsiJyB0eXBlPSdjaGVja2JveCcgIitjaGVja2VkKyIgIitkaXNhYmxlZCsiIC8+Jm5ic3A7IitvcHRpb24udGV4dCsiPC9saT4iKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYocG9zaXRpb24gPT09ICdwcmVwZW5kJyl7CiAgICAgICAgICAgICAgICQoIjxsaSAiK2Rpc2FibGVkQ2xhc3MrIj48aW5wdXQgdmFsdWU9JyIrb3B0aW9uLnZhbHVlKyInIHR5cGU9J2NoZWNrYm94JyAiK2NoZWNrZWQrIiAiK2Rpc2FibGVkKyIgLz4mbmJzcDsiK29wdGlvbi50ZXh0KyI8L2xpPiIpLmluc2VydEFmdGVyKCQoImRpdiMiKyQodGhpcykuYXR0cigncmVsJykrIiB1bCBsaS5kZXNlbGVjdGFsbCIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAkKCI8bGkgIitkaXNhYmxlZENsYXNzKyI+PGlucHV0IHZhbHVlPSciK29wdGlvbi52YWx1ZSsiJyB0eXBlPSdjaGVja2JveCcgIitjaGVja2VkKyIgIitkaXNhYmxlZCsiIC8+Jm5ic3A7IitvcHRpb24udGV4dCsiPC9saT4iKS5pbnNlcnRBZnRlcigkKCJkaXYjIiskKHRoaXMpLmF0dHIoJ3JlbCcpKyIgdWwgbGkgaW5wdXRbdmFsdWU9JyIrcG9zaXRpb24uc3Vic3RyaW5nKDEpKyInXSIpLmNsb3Nlc3QoJ2xpJykpOyAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAKICAgICAgICAKICAgICAgICAgIAogICAgfQogICAgICAgICAgICAKICAgIC8vLHVwZGF0ZSA6IGZ1bmN0aW9uKCBjb250ZW50ICkgeyAgfQogICAgfTsKCgoKCgoKJC5mbi56bXVsdGlzZWxlY3QgPSBmdW5jdGlvbihtZXRob2RPck9wdGlvbnMpIHsKICAgIGlmICggbWV0aG9kc1ttZXRob2RPck9wdGlvbnNdICkgewogICAgICAgIHJldHVybiBtZXRob2RzWyBtZXRob2RPck9wdGlvbnMgXS5hcHBseSggdGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApKTsKICAgIH0gZWxzZSBpZiAoIHR5cGVvZiBtZXRob2RPck9wdGlvbnMgPT09ICdvYmplY3QnIHx8ICEgbWV0aG9kT3JPcHRpb25zICkgewogICAgICAgIHJldHVybiBtZXRob2RzLmluaXQuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwogICAgfSBlbHNlIHsKICAgICAgICAkLmVycm9yKCAnTWV0aG9kICcgKyAgbWV0aG9kT3JPcHRpb25zICsgJyBkb2VzIG5vdCBleGlzdCBvbiB6bXVsdGlzZWxlY3QnICk7CiAgICB9ICAgIAogICAgfTsKCgoKfSkoIGpRdWVyeSApOwo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 00:48:07 GMT",
                    "Content-Length": "15674",
                    "Date": "Fri, 07 Nov 2014 00:48:07 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}