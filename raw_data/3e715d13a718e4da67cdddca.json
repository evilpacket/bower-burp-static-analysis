{
    "url": "http://localhost:9999/msurguy/triangles/js/triangles.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "HTML5 storage manipulation (DOM-based)",
    "issueType": 5246720,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based HTML5 storage manipulation occurs when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and stores this data in the HTML5 storage of the web browser (either localStorage or sessionStorage). An attacker may be able to use this behavior to construct a URL which, if visited by another application user, will cause the user's browser to store attacker-controllable data.<br><br>This behavior does not in itself constitute a security vulnerability. However, if the application later reads the data back from storage and processes it in an unsafe way, then an attacker may be able to leverage the storage mechanism to deliver other DOM-based attacks, such as cross-site scripting and JavaScript injection.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>You should also review the ways in which the wider application uses data that is retrieved from HTML5 storage. If the data is never handled in an unsafe manner, then this behavior may not constitute any kind of vulnerability.<br><br>The most effective way to avoid DOM-based HTML5 storage manipulation is not to place in HTML5 storage any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored.",
    "issueDetail": "The application may be vulnerable to DOM-based HTML5 storage manipulation. Data is read from <b>document.location.href</b> and written to <b>localStorage.setItem()</b> via the following statement:<ul><li>localStorage.setItem(document.location.href+\".gui\",JSON.stringify(d.getSaveObject()))</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/msurguy/triangles/js/triangles.js",
                "path": "/msurguy/triangles/js/triangles.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9tc3VyZ3V5L3RyaWFuZ2xlcy9qcy90cmlhbmdsZXMuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTEyMzkwDQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBTYXQsIDA4IE5vdiAyMDE0IDIzOjM1OjQ0IEdNVA0KTGFzdC1Nb2RpZmllZDogU2F0LCAwOCBOb3YgMjAxNCAyMzozNTo0MyBHTVQNCg0KLyoqCgpUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCkNvcHlyaWdodCAoYykgMjAxNCBNYWtzaW0gU3VyZ3V5CgpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Cm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbApjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbApjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFClNPRlRXQVJFLgoKKiovCnZhciBEZWxhdW5heTsKCihmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBFUFNJTE9OID0gMS4wIC8gMTA0ODU3Ni4wOwoKICBmdW5jdGlvbiBzdXBlcnRyaWFuZ2xlKHZlcnRpY2VzKSB7CiAgICB2YXIgeG1pbiA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwKICAgICAgICB5bWluID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLAogICAgICAgIHhtYXggPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksCiAgICAgICAgeW1heCA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwKICAgICAgICBpLCBkeCwgZHksIGRtYXgsIHhtaWQsIHltaWQ7CgogICAgZm9yKGkgPSB2ZXJ0aWNlcy5sZW5ndGg7IGktLTsgKSB7CiAgICAgIGlmKHZlcnRpY2VzW2ldWzBdIDwgeG1pbikgeG1pbiA9IHZlcnRpY2VzW2ldWzBdOwogICAgICBpZih2ZXJ0aWNlc1tpXVswXSA+IHhtYXgpIHhtYXggPSB2ZXJ0aWNlc1tpXVswXTsKICAgICAgaWYodmVydGljZXNbaV1bMV0gPCB5bWluKSB5bWluID0gdmVydGljZXNbaV1bMV07CiAgICAgIGlmKHZlcnRpY2VzW2ldWzFdID4geW1heCkgeW1heCA9IHZlcnRpY2VzW2ldWzFdOwogICAgfQoKICAgIGR4ID0geG1heCAtIHhtaW47CiAgICBkeSA9IHltYXggLSB5bWluOwogICAgZG1heCA9IE1hdGgubWF4KGR4LCBkeSk7CiAgICB4bWlkID0geG1pbiArIGR4ICogMC41OwogICAgeW1pZCA9IHltaW4gKyBkeSAqIDAuNTsKCiAgICByZXR1cm4gWwogICAgICBbeG1pZCAtIDIwICogZG1heCwgeW1pZCAtICAgICAgZG1heF0sCiAgICAgIFt4bWlkICAgICAgICAgICAgLCB5bWlkICsgMjAgKiBkbWF4XSwKICAgICAgW3htaWQgKyAyMCAqIGRtYXgsIHltaWQgLSAgICAgIGRtYXhdCiAgICBdOwogIH0KCiAgZnVuY3Rpb24gY2lyY3VtY2lyY2xlKHZlcnRpY2VzLCBpLCBqLCBrKSB7CiAgICB2YXIgeDEgPSB2ZXJ0aWNlc1tpXVswXSwKICAgICAgICB5MSA9IHZlcnRpY2VzW2ldWzFdLAogICAgICAgIHgyID0gdmVydGljZXNbal1bMF0sCiAgICAgICAgeTIgPSB2ZXJ0aWNlc1tqXVsxXSwKICAgICAgICB4MyA9IHZlcnRpY2VzW2tdWzBdLAogICAgICAgIHkzID0gdmVydGljZXNba11bMV0sCiAgICAgICAgZmFic3kxeTIgPSBNYXRoLmFicyh5MSAtIHkyKSwKICAgICAgICBmYWJzeTJ5MyA9IE1hdGguYWJzKHkyIC0geTMpLAogICAgICAgIHhjLCB5YywgbTEsIG0yLCBteDEsIG14MiwgbXkxLCBteTIsIGR4LCBkeTsKCiAgICAvKiBDaGVjayBmb3IgY29pbmNpZGVudCBwb2ludHMgKi8KICAgIGlmKGZhYnN5MXkyIDwgRVBTSUxPTiAmJiBmYWJzeTJ5MyA8IEVQU0lMT04pCiAgICAgIHRocm93IG5ldyBFcnJvcigiRWVrISBDb2luY2lkZW50IHBvaW50cyEiKTsKCiAgICBpZihmYWJzeTF5MiA8IEVQU0lMT04pIHsKICAgICAgbTIgID0gLSgoeDMgLSB4MikgLyAoeTMgLSB5MikpOwogICAgICBteDIgPSAoeDIgKyB4MykgLyAyLjA7CiAgICAgIG15MiA9ICh5MiArIHkzKSAvIDIuMDsKICAgICAgeGMgID0gKHgyICsgeDEpIC8gMi4wOwogICAgICB5YyAgPSBtMiAqICh4YyAtIG14MikgKyBteTI7CiAgICB9CgogICAgZWxzZSBpZihmYWJzeTJ5MyA8IEVQU0lMT04pIHsKICAgICAgbTEgID0gLSgoeDIgLSB4MSkgLyAoeTIgLSB5MSkpOwogICAgICBteDEgPSAoeDEgKyB4MikgLyAyLjA7CiAgICAgIG15MSA9ICh5MSArIHkyKSAvIDIuMDsKICAgICAgeGMgID0gKHgzICsgeDIpIC8gMi4wOwogICAgICB5YyAgPSBtMSAqICh4YyAtIG14MSkgKyBteTE7CiAgICB9CgogICAgZWxzZSB7CiAgICAgIG0xICA9IC0oKHgyIC0geDEpIC8gKHkyIC0geTEpKTsKICAgICAgbTIgID0gLSgoeDMgLSB4MikgLyAoeTMgLSB5MikpOwogICAgICBteDEgPSAoeDEgKyB4MikgLyAyLjA7CiAgICAgIG14MiA9ICh4MiArIHgzKSAvIDIuMDsKICAgICAgbXkxID0gKHkxICsgeTIpIC8gMi4wOwogICAgICBteTIgPSAoeTIgKyB5MykgLyAyLjA7CiAgICAgIHhjICA9IChtMSAqIG14MSAtIG0yICogbXgyICsgbXkyIC0gbXkxKSAvIChtMSAtIG0yKTsKICAgICAgeWMgID0gKGZhYnN5MXkyID4gZmFic3kyeTMpID8KICAgICAgICBtMSAqICh4YyAtIG14MSkgKyBteTEgOgogICAgICAgIG0yICogKHhjIC0gbXgyKSArIG15MjsKICAgIH0KCiAgICBkeCA9IHgyIC0geGM7CiAgICBkeSA9IHkyIC0geWM7CiAgICByZXR1cm4ge2k6IGksIGo6IGosIGs6IGssIHg6IHhjLCB5OiB5YywgcjogZHggKiBkeCArIGR5ICogZHl9OwogIH0KCiAgZnVuY3Rpb24gZGVkdXAoZWRnZXMpIHsKICAgIHZhciBpLCBqLCBhLCBiLCBtLCBuOwoKICAgIGZvcihqID0gZWRnZXMubGVuZ3RoOyBqOyApIHsKICAgICAgYiA9IGVkZ2VzWy0tal07CiAgICAgIGEgPSBlZGdlc1stLWpdOwoKICAgICAgZm9yKGkgPSBqOyBpOyApIHsKICAgICAgICBuID0gZWRnZXNbLS1pXTsKICAgICAgICBtID0gZWRnZXNbLS1pXTsKCiAgICAgICAgaWYoKGEgPT09IG0gJiYgYiA9PT0gbikgfHwgKGEgPT09IG4gJiYgYiA9PT0gbSkpIHsKICAgICAgICAgIGVkZ2VzLnNwbGljZShqLCAyKTsKICAgICAgICAgIGVkZ2VzLnNwbGljZShpLCAyKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgRGVsYXVuYXkgPSB7CiAgICB0cmlhbmd1bGF0ZTogZnVuY3Rpb24odmVydGljZXMsIGtleSkgewogICAgICB2YXIgbiA9IHZlcnRpY2VzLmxlbmd0aCwKICAgICAgICAgIGksIGosIGluZGljZXMsIHN0LCBvcGVuLCBjbG9zZWQsIGVkZ2VzLCBkeCwgZHksIGEsIGIsIGM7CgogICAgICAvKiBCYWlsIGlmIHRoZXJlIGFyZW4ndCBlbm91Z2ggdmVydGljZXMgdG8gZm9ybSBhbnkgdHJpYW5nbGVzLiAqLwogICAgICBpZihuIDwgMykKICAgICAgICByZXR1cm4gW107CgogICAgICAvKiBTbGljZSBvdXQgdGhlIGFjdHVhbCB2ZXJ0aWNlcyBmcm9tIHRoZSBwYXNzZWQgb2JqZWN0cy4gKER1cGxpY2F0ZSB0aGUKICAgICAgICogYXJyYXkgZXZlbiBpZiB3ZSBkb24ndCwgdGhvdWdoLCBzaW5jZSB3ZSBuZWVkIHRvIG1ha2UgYSBzdXBlcnRyaWFuZ2xlCiAgICAgICAqIGxhdGVyIG9uISkgKi8KICAgICAgdmVydGljZXMgPSB2ZXJ0aWNlcy5zbGljZSgwKTsKCiAgICAgIGlmKGtleSkKICAgICAgICBmb3IoaSA9IG47IGktLTsgKQogICAgICAgICAgdmVydGljZXNbaV0gPSB2ZXJ0aWNlc1tpXVtrZXldOwoKICAgICAgLyogTWFrZSBhbiBhcnJheSBvZiBpbmRpY2VzIGludG8gdGhlIHZlcnRleCBhcnJheSwgc29ydGVkIGJ5IHRoZQogICAgICAgKiB2ZXJ0aWNlcycgeC1wb3NpdGlvbi4gKi8KICAgICAgaW5kaWNlcyA9IG5ldyBBcnJheShuKTsKCiAgICAgIGZvcihpID0gbjsgaS0tOyApCiAgICAgICAgaW5kaWNlc1tpXSA9IGk7CgogICAgICBpbmRpY2VzLnNvcnQoZnVuY3Rpb24oaSwgaikgewogICAgICAgIHJldHVybiB2ZXJ0aWNlc1tqXVswXSAtIHZlcnRpY2VzW2ldWzBdOwogICAgICB9KTsKCiAgICAgIC8qIE5leHQsIGZpbmQgdGhlIHZlcnRpY2VzIG9mIHRoZSBzdXBlcnRyaWFuZ2xlICh3aGljaCBjb250YWlucyBhbGwgb3RoZXIKICAgICAgICogdHJpYW5nbGVzKSwgYW5kIGFwcGVuZCB0aGVtIG9udG8gdGhlIGVuZCBvZiBhIChjb3B5IG9mKSB0aGUgdmVydGV4CiAgICAgICAqIGFycmF5LiAqLwogICAgICBzdCA9IHN1cGVydHJpYW5nbGUodmVydGljZXMpOwogICAgICB2ZXJ0aWNlcy5wdXNoKHN0WzBdLCBzdFsxXSwgc3RbMl0pOwoKICAgICAgLyogSW5pdGlhbGl6ZSB0aGUgb3BlbiBsaXN0IChjb250YWluaW5nIHRoZSBzdXBlcnRyaWFuZ2xlIGFuZCBub3RoaW5nCiAgICAgICAqIGVsc2UpIGFuZCB0aGUgY2xvc2VkIGxpc3QgKHdoaWNoIGlzIGVtcHR5IHNpbmNlIHdlIGhhdm4ndCBwcm9jZXNzZWQKICAgICAgICogYW55IHRyaWFuZ2xlcyB5ZXQpLiAqLwogICAgICBvcGVuICAgPSBbY2lyY3VtY2lyY2xlKHZlcnRpY2VzLCBuICsgMCwgbiArIDEsIG4gKyAyKV07CiAgICAgIGNsb3NlZCA9IFtdOwogICAgICBlZGdlcyAgPSBbXTsKCiAgICAgIC8qIEluY3JlbWVudGFsbHkgYWRkIGVhY2ggdmVydGV4IHRvIHRoZSBtZXNoLiAqLwogICAgICBmb3IoaSA9IGluZGljZXMubGVuZ3RoOyBpLS07IGVkZ2VzLmxlbmd0aCA9IDApIHsKICAgICAgICBjID0gaW5kaWNlc1tpXTsKCiAgICAgICAgLyogRm9yIGVhY2ggb3BlbiB0cmlhbmdsZSwgY2hlY2sgdG8gc2VlIGlmIHRoZSBjdXJyZW50IHBvaW50IGlzCiAgICAgICAgICogaW5zaWRlIGl0J3MgY2lyY3VtY2lyY2xlLiBJZiBpdCBpcywgcmVtb3ZlIHRoZSB0cmlhbmdsZSBhbmQgYWRkCiAgICAgICAgICogaXQncyBlZGdlcyB0byBhbiBlZGdlIGxpc3QuICovCiAgICAgICAgZm9yKGogPSBvcGVuLmxlbmd0aDsgai0tOyApIHsKICAgICAgICAgIC8qIElmIHRoaXMgcG9pbnQgaXMgdG8gdGhlIHJpZ2h0IG9mIHRoaXMgdHJpYW5nbGUncyBjaXJjdW1jaXJjbGUsCiAgICAgICAgICAgKiB0aGVuIHRoaXMgdHJpYW5nbGUgc2hvdWxkIG5ldmVyIGdldCBjaGVja2VkIGFnYWluLiBSZW1vdmUgaXQKICAgICAgICAgICAqIGZyb20gdGhlIG9wZW4gbGlzdCwgYWRkIGl0IHRvIHRoZSBjbG9zZWQgbGlzdCwgYW5kIHNraXAuICovCiAgICAgICAgICBkeCA9IHZlcnRpY2VzW2NdWzBdIC0gb3BlbltqXS54OwogICAgICAgICAgaWYoZHggPiAwLjAgJiYgZHggKiBkeCA+IG9wZW5bal0ucikgewogICAgICAgICAgICBjbG9zZWQucHVzaChvcGVuW2pdKTsKICAgICAgICAgICAgb3Blbi5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIC8qIElmIHdlJ3JlIG91dHNpZGUgdGhlIGNpcmN1bWNpcmNsZSwgc2tpcCB0aGlzIHRyaWFuZ2xlLiAqLwogICAgICAgICAgZHkgPSB2ZXJ0aWNlc1tjXVsxXSAtIG9wZW5bal0ueTsKICAgICAgICAgIGlmKGR4ICogZHggKyBkeSAqIGR5IC0gb3BlbltqXS5yID4gRVBTSUxPTikKICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgLyogUmVtb3ZlIHRoZSB0cmlhbmdsZSBhbmQgYWRkIGl0J3MgZWRnZXMgdG8gdGhlIGVkZ2UgbGlzdC4gKi8KICAgICAgICAgIGVkZ2VzLnB1c2goCiAgICAgICAgICAgIG9wZW5bal0uaSwgb3BlbltqXS5qLAogICAgICAgICAgICBvcGVuW2pdLmosIG9wZW5bal0uaywKICAgICAgICAgICAgb3BlbltqXS5rLCBvcGVuW2pdLmkKICAgICAgICAgICk7CiAgICAgICAgICBvcGVuLnNwbGljZShqLCAxKTsKICAgICAgICB9CgogICAgICAgIC8qIFJlbW92ZSBhbnkgZG91YmxlZCBlZGdlcy4gKi8KICAgICAgICBkZWR1cChlZGdlcyk7CgogICAgICAgIC8qIEFkZCBhIG5ldyB0cmlhbmdsZSBmb3IgZWFjaCBlZGdlLiAqLwogICAgICAgIGZvcihqID0gZWRnZXMubGVuZ3RoOyBqOyApIHsKICAgICAgICAgIGIgPSBlZGdlc1stLWpdOwogICAgICAgICAgYSA9IGVkZ2VzWy0tal07CiAgICAgICAgICBvcGVuLnB1c2goY2lyY3VtY2lyY2xlKHZlcnRpY2VzLCBhLCBiLCBjKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvKiBDb3B5IGFueSByZW1haW5pbmcgb3BlbiB0cmlhbmdsZXMgdG8gdGhlIGNsb3NlZCBsaXN0LCBhbmQgdGhlbgogICAgICAgKiByZW1vdmUgYW55IHRyaWFuZ2xlcyB0aGF0IHNoYXJlIGEgdmVydGV4IHdpdGggdGhlIHN1cGVydHJpYW5nbGUsCiAgICAgICAqIGJ1aWxkaW5nIGEgbGlzdCBvZiB0cmlwbGV0cyB0aGF0IHJlcHJlc2VudCB0cmlhbmdsZXMuICovCiAgICAgIGZvcihpID0gb3Blbi5sZW5ndGg7IGktLTsgKQogICAgICAgIGNsb3NlZC5wdXNoKG9wZW5baV0pOwogICAgICBvcGVuLmxlbmd0aCA9IDA7CgogICAgICBmb3IoaSA9IGNsb3NlZC5sZW5ndGg7IGktLTsgKQogICAgICAgIGlmKGNsb3NlZFtpXS5pIDwgbiAmJiBjbG9zZWRbaV0uaiA8IG4gJiYgY2xvc2VkW2ldLmsgPCBuKQogICAgICAgICAgb3Blbi5wdXNoKGNsb3NlZFtpXS5pLCBjbG9zZWRbaV0uaiwgY2xvc2VkW2ldLmspOwoKICAgICAgLyogWWF5LCB3ZSdyZSBkb25lISAqLwogICAgICByZXR1cm4gb3BlbjsKICAgIH0sCiAgICBjb250YWluczogZnVuY3Rpb24odHJpLCBwKSB7CiAgICAgIC8qIEJvdW5kaW5nIGJveCB0ZXN0IGZpcnN0LCBmb3IgcXVpY2sgcmVqZWN0aW9ucy4gKi8KICAgICAgaWYoKHBbMF0gPCB0cmlbMF1bMF0gJiYgcFswXSA8IHRyaVsxXVswXSAmJiBwWzBdIDwgdHJpWzJdWzBdKSB8fAogICAgICAgICAocFswXSA+IHRyaVswXVswXSAmJiBwWzBdID4gdHJpWzFdWzBdICYmIHBbMF0gPiB0cmlbMl1bMF0pIHx8CiAgICAgICAgIChwWzFdIDwgdHJpWzBdWzFdICYmIHBbMV0gPCB0cmlbMV1bMV0gJiYgcFsxXSA8IHRyaVsyXVsxXSkgfHwKICAgICAgICAgKHBbMV0gPiB0cmlbMF1bMV0gJiYgcFsxXSA+IHRyaVsxXVsxXSAmJiBwWzFdID4gdHJpWzJdWzFdKSkKICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgIHZhciBhID0gdHJpWzFdWzBdIC0gdHJpWzBdWzBdLAogICAgICAgICAgYiA9IHRyaVsyXVswXSAtIHRyaVswXVswXSwKICAgICAgICAgIGMgPSB0cmlbMV1bMV0gLSB0cmlbMF1bMV0sCiAgICAgICAgICBkID0gdHJpWzJdWzFdIC0gdHJpWzBdWzFdLAogICAgICAgICAgaSA9IGEgKiBkIC0gYiAqIGM7CgogICAgICAvKiBEZWdlbmVyYXRlIHRyaS4gKi8KICAgICAgaWYoaSA9PT0gMC4wKQogICAgICAgIHJldHVybiBudWxsOwoKICAgICAgdmFyIHUgPSAoZCAqIChwWzBdIC0gdHJpWzBdWzBdKSAtIGIgKiAocFsxXSAtIHRyaVswXVsxXSkpIC8gaSwKICAgICAgICAgIHYgPSAoYSAqIChwWzFdIC0gdHJpWzBdWzFdKSAtIGMgKiAocFswXSAtIHRyaVswXVswXSkpIC8gaTsKCiAgICAgIC8qIElmIHdlJ3JlIG91dHNpZGUgdGhlIHRyaSwgZmFpbC4gKi8KICAgICAgaWYodSA8IDAuMCB8fCB2IDwgMC4wIHx8ICh1ICsgdikgPiAxLjApCiAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICByZXR1cm4gW3UsIHZdOwogICAgfQogIH07CgogIGlmKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiKQogICAgbW9kdWxlLmV4cG9ydHMgPSBEZWxhdW5heTsKfSkoKTsKCi8qIG1vdXNldHJhcCB2MS40LjYgY3JhaWcuaXMva2lsbGluZy9taWNlICovCihmdW5jdGlvbihKLHIsZil7ZnVuY3Rpb24gcyhhLGIsZCl7YS5hZGRFdmVudExpc3RlbmVyP2EuYWRkRXZlbnRMaXN0ZW5lcihiLGQsITEpOmEuYXR0YWNoRXZlbnQoIm9uIitiLGQpfWZ1bmN0aW9uIEEoYSl7aWYoImtleXByZXNzIj09YS50eXBlKXt2YXIgYj1TdHJpbmcuZnJvbUNoYXJDb2RlKGEud2hpY2gpO2Euc2hpZnRLZXl8fChiPWIudG9Mb3dlckNhc2UoKSk7cmV0dXJuIGJ9cmV0dXJuIGhbYS53aGljaF0/aFthLndoaWNoXTpCW2Eud2hpY2hdP0JbYS53aGljaF06U3RyaW5nLmZyb21DaGFyQ29kZShhLndoaWNoKS50b0xvd2VyQ2FzZSgpfWZ1bmN0aW9uIHQoYSl7YT1hfHx7fTt2YXIgYj0hMSxkO2ZvcihkIGluIG4pYVtkXT9iPSEwOm5bZF09MDtifHwodT0hMSl9ZnVuY3Rpb24gQyhhLGIsZCxjLGUsdil7dmFyIGcsayxmPVtdLGg9ZC50eXBlO2lmKCFsW2FdKXJldHVybltdOyJrZXl1cCI9PWgmJncoYSkmJihiPVthXSk7Zm9yKGc9MDtnPGxbYV0ubGVuZ3RoOysrZylpZihrPQpsW2FdW2ddLCEoIWMmJmsuc2VxJiZuW2suc2VxXSE9ay5sZXZlbHx8aCE9ay5hY3Rpb258fCgia2V5cHJlc3MiIT1ofHxkLm1ldGFLZXl8fGQuY3RybEtleSkmJmIuc29ydCgpLmpvaW4oIiwiKSE9PWsubW9kaWZpZXJzLnNvcnQoKS5qb2luKCIsIikpKXt2YXIgbT1jJiZrLnNlcT09YyYmay5sZXZlbD09djsoIWMmJmsuY29tYm89PWV8fG0pJiZsW2FdLnNwbGljZShnLDEpO2YucHVzaChrKX1yZXR1cm4gZn1mdW5jdGlvbiBLKGEpe3ZhciBiPVtdO2Euc2hpZnRLZXkmJmIucHVzaCgic2hpZnQiKTthLmFsdEtleSYmYi5wdXNoKCJhbHQiKTthLmN0cmxLZXkmJmIucHVzaCgiY3RybCIpO2EubWV0YUtleSYmYi5wdXNoKCJtZXRhIik7cmV0dXJuIGJ9ZnVuY3Rpb24geChhLGIsZCxjKXttLnN0b3BDYWxsYmFjayhiLGIudGFyZ2V0fHxiLnNyY0VsZW1lbnQsZCxjKXx8ITEhPT1hKGIsZCl8fChiLnByZXZlbnREZWZhdWx0P2IucHJldmVudERlZmF1bHQoKTpiLnJldHVyblZhbHVlPSExLGIuc3RvcFByb3BhZ2F0aW9uPwpiLnN0b3BQcm9wYWdhdGlvbigpOmIuY2FuY2VsQnViYmxlPSEwKX1mdW5jdGlvbiB5KGEpeyJudW1iZXIiIT09dHlwZW9mIGEud2hpY2gmJihhLndoaWNoPWEua2V5Q29kZSk7dmFyIGI9QShhKTtiJiYoImtleXVwIj09YS50eXBlJiZ6PT09Yj96PSExOm0uaGFuZGxlS2V5KGIsSyhhKSxhKSl9ZnVuY3Rpb24gdyhhKXtyZXR1cm4ic2hpZnQiPT1hfHwiY3RybCI9PWF8fCJhbHQiPT1hfHwibWV0YSI9PWF9ZnVuY3Rpb24gTChhLGIsZCxjKXtmdW5jdGlvbiBlKGIpe3JldHVybiBmdW5jdGlvbigpe3U9YjsrK25bYV07Y2xlYXJUaW1lb3V0KEQpO0Q9c2V0VGltZW91dCh0LDFFMyl9fWZ1bmN0aW9uIHYoYil7eChkLGIsYSk7ImtleXVwIiE9PWMmJih6PUEoYikpO3NldFRpbWVvdXQodCwxMCl9Zm9yKHZhciBnPW5bYV09MDtnPGIubGVuZ3RoOysrZyl7dmFyIGY9ZysxPT09Yi5sZW5ndGg/djplKGN8fEUoYltnKzFdKS5hY3Rpb24pO0YoYltnXSxmLGMsYSxnKX19ZnVuY3Rpb24gRShhLGIpe3ZhciBkLApjLGUsZj1bXTtkPSIrIj09PWE/WyIrIl06YS5zcGxpdCgiKyIpO2ZvcihlPTA7ZTxkLmxlbmd0aDsrK2UpYz1kW2VdLEdbY10mJihjPUdbY10pLGImJiJrZXlwcmVzcyIhPWImJkhbY10mJihjPUhbY10sZi5wdXNoKCJzaGlmdCIpKSx3KGMpJiZmLnB1c2goYyk7ZD1jO2U9YjtpZighZSl7aWYoIXApe3A9e307Zm9yKHZhciBnIGluIGgpOTU8ZyYmMTEyPmd8fGguaGFzT3duUHJvcGVydHkoZykmJihwW2hbZ11dPWcpfWU9cFtkXT8ia2V5ZG93biI6ImtleXByZXNzIn0ia2V5cHJlc3MiPT1lJiZmLmxlbmd0aCYmKGU9ImtleWRvd24iKTtyZXR1cm57a2V5OmMsbW9kaWZpZXJzOmYsYWN0aW9uOmV9fWZ1bmN0aW9uIEYoYSxiLGQsYyxlKXtxW2ErIjoiK2RdPWI7YT1hLnJlcGxhY2UoL1xzKy9nLCIgIik7dmFyIGY9YS5zcGxpdCgiICIpOzE8Zi5sZW5ndGg/TChhLGYsYixkKTooZD1FKGEsZCksbFtkLmtleV09bFtkLmtleV18fFtdLEMoZC5rZXksZC5tb2RpZmllcnMse3R5cGU6ZC5hY3Rpb259LApjLGEsZSksbFtkLmtleV1bYz8idW5zaGlmdCI6InB1c2giXSh7Y2FsbGJhY2s6Yixtb2RpZmllcnM6ZC5tb2RpZmllcnMsYWN0aW9uOmQuYWN0aW9uLHNlcTpjLGxldmVsOmUsY29tYm86YX0pKX12YXIgaD17ODoiYmFja3NwYWNlIiw5OiJ0YWIiLDEzOiJlbnRlciIsMTY6InNoaWZ0IiwxNzoiY3RybCIsMTg6ImFsdCIsMjA6ImNhcHNsb2NrIiwyNzoiZXNjIiwzMjoic3BhY2UiLDMzOiJwYWdldXAiLDM0OiJwYWdlZG93biIsMzU6ImVuZCIsMzY6ImhvbWUiLDM3OiJsZWZ0IiwzODoidXAiLDM5OiJyaWdodCIsNDA6ImRvd24iLDQ1OiJpbnMiLDQ2OiJkZWwiLDkxOiJtZXRhIiw5MzoibWV0YSIsMjI0OiJtZXRhIn0sQj17MTA2OiIqIiwxMDc6IisiLDEwOToiLSIsMTEwOiIuIiwxMTE6Ii8iLDE4NjoiOyIsMTg3OiI9IiwxODg6IiwiLDE4OToiLSIsMTkwOiIuIiwxOTE6Ii8iLDE5MjoiYCIsMjE5OiJbIiwyMjA6IlxcIiwyMjE6Il0iLDIyMjoiJyJ9LEg9eyJ+IjoiYCIsIiEiOiIxIiwKIkAiOiIyIiwiIyI6IjMiLCQ6IjQiLCIlIjoiNSIsIl4iOiI2IiwiJiI6IjciLCIqIjoiOCIsIigiOiI5IiwiKSI6IjAiLF86Ii0iLCIrIjoiPSIsIjoiOiI7IiwnIic6IiciLCI8IjoiLCIsIj4iOiIuIiwiPyI6Ii8iLCJ8IjoiXFwifSxHPXtvcHRpb246ImFsdCIsY29tbWFuZDoibWV0YSIsInJldHVybiI6ImVudGVyIixlc2NhcGU6ImVzYyIsbW9kOi9NYWN8aVBvZHxpUGhvbmV8aVBhZC8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pPyJtZXRhIjoiY3RybCJ9LHAsbD17fSxxPXt9LG49e30sRCx6PSExLEk9ITEsdT0hMTtmb3IoZj0xOzIwPmY7KytmKWhbMTExK2ZdPSJmIitmO2ZvcihmPTA7OT49ZjsrK2YpaFtmKzk2XT1mO3Mociwia2V5cHJlc3MiLHkpO3Mociwia2V5ZG93biIseSk7cyhyLCJrZXl1cCIseSk7dmFyIG09e2JpbmQ6ZnVuY3Rpb24oYSxiLGQpe2E9YSBpbnN0YW5jZW9mIEFycmF5P2E6W2FdO2Zvcih2YXIgYz0wO2M8YS5sZW5ndGg7KytjKUYoYVtjXSxiLGQpO3JldHVybiB0aGlzfSwKdW5iaW5kOmZ1bmN0aW9uKGEsYil7cmV0dXJuIG0uYmluZChhLGZ1bmN0aW9uKCl7fSxiKX0sdHJpZ2dlcjpmdW5jdGlvbihhLGIpe2lmKHFbYSsiOiIrYl0pcVthKyI6IitiXSh7fSxhKTtyZXR1cm4gdGhpc30scmVzZXQ6ZnVuY3Rpb24oKXtsPXt9O3E9e307cmV0dXJuIHRoaXN9LHN0b3BDYWxsYmFjazpmdW5jdGlvbihhLGIpe3JldHVybi0xPCgiICIrYi5jbGFzc05hbWUrIiAiKS5pbmRleE9mKCIgbW91c2V0cmFwICIpPyExOiJJTlBVVCI9PWIudGFnTmFtZXx8IlNFTEVDVCI9PWIudGFnTmFtZXx8IlRFWFRBUkVBIj09Yi50YWdOYW1lfHxiLmlzQ29udGVudEVkaXRhYmxlfSxoYW5kbGVLZXk6ZnVuY3Rpb24oYSxiLGQpe3ZhciBjPUMoYSxiLGQpLGU7Yj17fTt2YXIgZj0wLGc9ITE7Zm9yKGU9MDtlPGMubGVuZ3RoOysrZSljW2VdLnNlcSYmKGY9TWF0aC5tYXgoZixjW2VdLmxldmVsKSk7Zm9yKGU9MDtlPGMubGVuZ3RoOysrZSljW2VdLnNlcT9jW2VdLmxldmVsPT1mJiYoZz0hMCwKYltjW2VdLnNlcV09MSx4KGNbZV0uY2FsbGJhY2ssZCxjW2VdLmNvbWJvLGNbZV0uc2VxKSk6Z3x8eChjW2VdLmNhbGxiYWNrLGQsY1tlXS5jb21ibyk7Yz0ia2V5cHJlc3MiPT1kLnR5cGUmJkk7ZC50eXBlIT11fHx3KGEpfHxjfHx0KGIpO0k9ZyYmImtleWRvd24iPT1kLnR5cGV9fTtKLk1vdXNldHJhcD1tOyJmdW5jdGlvbiI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kJiZkZWZpbmUobSl9KSh3aW5kb3csZG9jdW1lbnQpOwovKioKICogU3R5bGVGaXggMS4wLjMgJiBQcmVmaXhGcmVlIDEuMC43CiAqIEBhdXRob3IgTGVhIFZlcm91CiAqIE1JVCBsaWNlbnNlCiAqLyhmdW5jdGlvbigpe2Z1bmN0aW9uIHQoZSx0KXtyZXR1cm5bXS5zbGljZS5jYWxsKCh0fHxkb2N1bWVudCkucXVlcnlTZWxlY3RvckFsbChlKSl9aWYoIXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKXJldHVybjt2YXIgZT13aW5kb3cuU3R5bGVGaXg9e2xpbms6ZnVuY3Rpb24odCl7dHJ5e2lmKHQucmVsIT09InN0eWxlc2hlZXQifHx0Lmhhc0F0dHJpYnV0ZSgiZGF0YS1ub3ByZWZpeCIpKXJldHVybn1jYXRjaChuKXtyZXR1cm59dmFyIHI9dC5ocmVmfHx0LmdldEF0dHJpYnV0ZSgiZGF0YS1ocmVmIiksaT1yLnJlcGxhY2UoL1teXC9dKyQvLCIiKSxzPSgvXlthLXpdezMsMTB9Oi8uZXhlYyhpKXx8WyIiXSlbMF0sbz0oL15bYS16XXszLDEwfTpcL1wvW15cL10rLy5leGVjKGkpfHxbIiJdKVswXSx1PS9eKFteP10qKVw/Py8uZXhlYyhyKVsxXSxhPXQucGFyZW50Tm9kZSxmPW5ldyBYTUxIdHRwUmVxdWVzdCxsO2Yub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7Zi5yZWFkeVN0YXRlPT09NCYmbCgpfTtsPWZ1bmN0aW9uKCl7dmFyIG49Zi5yZXNwb25zZVRleHQ7aWYobiYmdC5wYXJlbnROb2RlJiYoIWYuc3RhdHVzfHxmLnN0YXR1czw0MDB8fGYuc3RhdHVzPjYwMCkpe249ZS5maXgobiwhMCx0KTtpZihpKXtuPW4ucmVwbGFjZSgvdXJsXChccyo/KCg/OiJ8Jyk/KSguKz8pXDFccyo/XCkvZ2ksZnVuY3Rpb24oZSx0LG4pe3JldHVybi9eKFthLXpdezMsMTB9OnwjKS9pLnRlc3Qobik/ZTovXlwvXC8vLnRlc3Qobik/J3VybCgiJytzK24rJyIpJzovXlwvLy50ZXN0KG4pPyd1cmwoIicrbytuKyciKSc6L15cPy8udGVzdChuKT8ndXJsKCInK3UrbisnIiknOid1cmwoIicraStuKyciKSd9KTt2YXIgcj1pLnJlcGxhY2UoLyhbXFxcXlwkKitbXF0/e30uPSE6KHwpXSkvZywiXFwkMSIpO249bi5yZXBsYWNlKFJlZ0V4cCgiXFxiKGJlaGF2aW9yOlxccyo/dXJsXFwoJz9cIj8pIityLCJnaSIpLCIkMSIpfXZhciBsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7bC50ZXh0Q29udGVudD1uO2wubWVkaWE9dC5tZWRpYTtsLmRpc2FibGVkPXQuZGlzYWJsZWQ7bC5zZXRBdHRyaWJ1dGUoImRhdGEtaHJlZiIsdC5nZXRBdHRyaWJ1dGUoImhyZWYiKSk7YS5pbnNlcnRCZWZvcmUobCx0KTthLnJlbW92ZUNoaWxkKHQpO2wubWVkaWE9dC5tZWRpYX19O3RyeXtmLm9wZW4oIkdFVCIscik7Zi5zZW5kKG51bGwpfWNhdGNoKG4pe2lmKHR5cGVvZiBYRG9tYWluUmVxdWVzdCE9InVuZGVmaW5lZCIpe2Y9bmV3IFhEb21haW5SZXF1ZXN0O2Yub25lcnJvcj1mLm9ucHJvZ3Jlc3M9ZnVuY3Rpb24oKXt9O2Yub25sb2FkPWw7Zi5vcGVuKCJHRVQiLHIpO2Yuc2VuZChudWxsKX19dC5zZXRBdHRyaWJ1dGUoImRhdGEtaW5wcm9ncmVzcyIsIiIpfSxzdHlsZUVsZW1lbnQ6ZnVuY3Rpb24odCl7aWYodC5oYXNBdHRyaWJ1dGUoImRhdGEtbm9wcmVmaXgiKSlyZXR1cm47dmFyIG49dC5kaXNhYmxlZDt0LnRleHRDb250ZW50PWUuZml4KHQudGV4dENvbnRlbnQsITAsdCk7dC5kaXNhYmxlZD1ufSxzdHlsZUF0dHJpYnV0ZTpmdW5jdGlvbih0KXt2YXIgbj10LmdldEF0dHJpYnV0ZSgic3R5bGUiKTtuPWUuZml4KG4sITEsdCk7dC5zZXRBdHRyaWJ1dGUoInN0eWxlIixuKX0scHJvY2VzczpmdW5jdGlvbigpe3QoJ2xpbmtbcmVsPSJzdHlsZXNoZWV0Il06bm90KFtkYXRhLWlucHJvZ3Jlc3NdKScpLmZvckVhY2goU3R5bGVGaXgubGluayk7dCgic3R5bGUiKS5mb3JFYWNoKFN0eWxlRml4LnN0eWxlRWxlbWVudCk7dCgiW3N0eWxlXSIpLmZvckVhY2goU3R5bGVGaXguc3R5bGVBdHRyaWJ1dGUpfSxyZWdpc3RlcjpmdW5jdGlvbih0LG4peyhlLmZpeGVycz1lLmZpeGVyc3x8W10pLnNwbGljZShuPT09dW5kZWZpbmVkP2UuZml4ZXJzLmxlbmd0aDpuLDAsdCl9LGZpeDpmdW5jdGlvbih0LG4scil7Zm9yKHZhciBpPTA7aTxlLmZpeGVycy5sZW5ndGg7aSsrKXQ9ZS5maXhlcnNbaV0odCxuLHIpfHx0O3JldHVybiB0fSxjYW1lbENhc2U6ZnVuY3Rpb24oZSl7cmV0dXJuIGUucmVwbGFjZSgvLShbYS16XSkvZyxmdW5jdGlvbihlLHQpe3JldHVybiB0LnRvVXBwZXJDYXNlKCl9KS5yZXBsYWNlKCItIiwiIil9LGRlQ2FtZWxDYXNlOmZ1bmN0aW9uKGUpe3JldHVybiBlLnJlcGxhY2UoL1tBLVpdL2csZnVuY3Rpb24oZSl7cmV0dXJuIi0iK2UudG9Mb3dlckNhc2UoKX0pfX07KGZ1bmN0aW9uKCl7c2V0VGltZW91dChmdW5jdGlvbigpe3QoJ2xpbmtbcmVsPSJzdHlsZXNoZWV0Il0nKS5mb3JFYWNoKFN0eWxlRml4LmxpbmspfSwxMCk7ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsU3R5bGVGaXgucHJvY2VzcywhMSl9KSgpfSkoKTsoZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHQscixpLHMpe2U9bltlXTtpZihlLmxlbmd0aCl7dmFyIG89UmVnRXhwKHQrIigiK2Uuam9pbigifCIpKyIpIityLCJnaSIpO3M9cy5yZXBsYWNlKG8saSl9cmV0dXJuIHN9aWYoIXdpbmRvdy5TdHlsZUZpeHx8IXdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKXJldHVybjt2YXIgbj13aW5kb3cuUHJlZml4RnJlZT17cHJlZml4Q1NTOmZ1bmN0aW9uKGUscixpKXt2YXIgcz1uLnByZWZpeDtuLmZ1bmN0aW9ucy5pbmRleE9mKCJsaW5lYXItZ3JhZGllbnQiKT4tMSYmKGU9ZS5yZXBsYWNlKC8oXHN8OnwsKShyZXBlYXRpbmctKT9saW5lYXItZ3JhZGllbnRcKFxzKigtP1xkKlwuP1xkKilkZWcvaWcsZnVuY3Rpb24oZSx0LG4scil7cmV0dXJuIHQrKG58fCIiKSsibGluZWFyLWdyYWRpZW50KCIrKDkwLXIpKyJkZWcifSkpO2U9dCgiZnVuY3Rpb25zIiwiKFxcc3w6fCwpIiwiXFxzKlxcKCIsIiQxIitzKyIkMigiLGUpO2U9dCgia2V5d29yZHMiLCIoXFxzfDopIiwiKFxcc3w7fFxcfXwkKSIsIiQxIitzKyIkMiQzIixlKTtlPXQoInByb3BlcnRpZXMiLCIoXnxcXHt8XFxzfDspIiwiXFxzKjoiLCIkMSIrcysiJDI6IixlKTtpZihuLnByb3BlcnRpZXMubGVuZ3RoKXt2YXIgbz1SZWdFeHAoIlxcYigiK24ucHJvcGVydGllcy5qb2luKCJ8IikrIikoPyE6KSIsImdpIik7ZT10KCJ2YWx1ZVByb3BlcnRpZXMiLCJcXGIiLCI6KC4rPyk7IixmdW5jdGlvbihlKXtyZXR1cm4gZS5yZXBsYWNlKG8scysiJDEiKX0sZSl9aWYocil7ZT10KCJzZWxlY3RvcnMiLCIiLCJcXGIiLG4ucHJlZml4U2VsZWN0b3IsZSk7ZT10KCJhdHJ1bGVzIiwiQCIsIlxcYiIsIkAiK3MrIiQxIixlKX1lPWUucmVwbGFjZShSZWdFeHAoIi0iK3MsImciKSwiLSIpO2U9ZS5yZXBsYWNlKC8tXCotKD89W2Etel0rKS9naSxuLnByZWZpeCk7cmV0dXJuIGV9LHByb3BlcnR5OmZ1bmN0aW9uKGUpe3JldHVybihuLnByb3BlcnRpZXMuaW5kZXhPZihlKT9uLnByZWZpeDoiIikrZX0sdmFsdWU6ZnVuY3Rpb24oZSxyKXtlPXQoImZ1bmN0aW9ucyIsIihefFxcc3wsKSIsIlxccypcXCgiLCIkMSIrbi5wcmVmaXgrIiQyKCIsZSk7ZT10KCJrZXl3b3JkcyIsIihefFxccykiLCIoXFxzfCQpIiwiJDEiK24ucHJlZml4KyIkMiQzIixlKTtyZXR1cm4gZX0scHJlZml4U2VsZWN0b3I6ZnVuY3Rpb24oZSl7cmV0dXJuIGUucmVwbGFjZSgvXjp7MSwyfS8sZnVuY3Rpb24oZSl7cmV0dXJuIGUrbi5wcmVmaXh9KX0scHJlZml4UHJvcGVydHk6ZnVuY3Rpb24oZSx0KXt2YXIgcj1uLnByZWZpeCtlO3JldHVybiB0P1N0eWxlRml4LmNhbWVsQ2FzZShyKTpyfX07KGZ1bmN0aW9uKCl7dmFyIGU9e30sdD1bXSxyPXt9LGk9Z2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsbnVsbCkscz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKS5zdHlsZSxvPWZ1bmN0aW9uKG4pe2lmKG4uY2hhckF0KDApPT09Ii0iKXt0LnB1c2gobik7dmFyIHI9bi5zcGxpdCgiLSIpLGk9clsxXTtlW2ldPSsrZVtpXXx8MTt3aGlsZShyLmxlbmd0aD4zKXtyLnBvcCgpO3ZhciBzPXIuam9pbigiLSIpO3UocykmJnQuaW5kZXhPZihzKT09PS0xJiZ0LnB1c2gocyl9fX0sdT1mdW5jdGlvbihlKXtyZXR1cm4gU3R5bGVGaXguY2FtZWxDYXNlKGUpaW4gc307aWYoaS5sZW5ndGg+MClmb3IodmFyIGE9MDthPGkubGVuZ3RoO2ErKylvKGlbYV0pO2Vsc2UgZm9yKHZhciBmIGluIGkpbyhTdHlsZUZpeC5kZUNhbWVsQ2FzZShmKSk7dmFyIGw9e3VzZXM6MH07Zm9yKHZhciBjIGluIGUpe3ZhciBoPWVbY107bC51c2VzPGgmJihsPXtwcmVmaXg6Yyx1c2VzOmh9KX1uLnByZWZpeD0iLSIrbC5wcmVmaXgrIi0iO24uUHJlZml4PVN0eWxlRml4LmNhbWVsQ2FzZShuLnByZWZpeCk7bi5wcm9wZXJ0aWVzPVtdO2Zvcih2YXIgYT0wO2E8dC5sZW5ndGg7YSsrKXt2YXIgZj10W2FdO2lmKGYuaW5kZXhPZihuLnByZWZpeCk9PT0wKXt2YXIgcD1mLnNsaWNlKG4ucHJlZml4Lmxlbmd0aCk7dShwKXx8bi5wcm9wZXJ0aWVzLnB1c2gocCl9fW4uUHJlZml4PT0iTXMiJiYhKCJ0cmFuc2Zvcm0iaW4gcykmJiEoIk1zVHJhbnNmb3JtImluIHMpJiYibXNUcmFuc2Zvcm0iaW4gcyYmbi5wcm9wZXJ0aWVzLnB1c2goInRyYW5zZm9ybSIsInRyYW5zZm9ybS1vcmlnaW4iKTtuLnByb3BlcnRpZXMuc29ydCgpfSkoKTsoZnVuY3Rpb24oKXtmdW5jdGlvbiBpKGUsdCl7clt0XT0iIjtyW3RdPWU7cmV0dXJuISFyW3RdfXZhciBlPXsibGluZWFyLWdyYWRpZW50Ijp7cHJvcGVydHk6ImJhY2tncm91bmRJbWFnZSIscGFyYW1zOiJyZWQsIHRlYWwifSxjYWxjOntwcm9wZXJ0eToid2lkdGgiLHBhcmFtczoiMXB4ICsgNSUifSxlbGVtZW50Ontwcm9wZXJ0eToiYmFja2dyb3VuZEltYWdlIixwYXJhbXM6IiNmb28ifSwiY3Jvc3MtZmFkZSI6e3Byb3BlcnR5OiJiYWNrZ3JvdW5kSW1hZ2UiLHBhcmFtczoidXJsKGEucG5nKSwgdXJsKGIucG5nKSwgNTAlIn19O2VbInJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQiXT1lWyJyZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50Il09ZVsicmFkaWFsLWdyYWRpZW50Il09ZVsibGluZWFyLWdyYWRpZW50Il07dmFyIHQ9e2luaXRpYWw6ImNvbG9yIiwiem9vbS1pbiI6ImN1cnNvciIsInpvb20tb3V0IjoiY3Vyc29yIixib3g6ImRpc3BsYXkiLGZsZXhib3g6ImRpc3BsYXkiLCJpbmxpbmUtZmxleGJveCI6ImRpc3BsYXkiLGZsZXg6ImRpc3BsYXkiLCJpbmxpbmUtZmxleCI6ImRpc3BsYXkiLGdyaWQ6ImRpc3BsYXkiLCJpbmxpbmUtZ3JpZCI6ImRpc3BsYXkiLCJtaW4tY29udGVudCI6IndpZHRoIn07bi5mdW5jdGlvbnM9W107bi5rZXl3b3Jkcz1bXTt2YXIgcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKS5zdHlsZTtmb3IodmFyIHMgaW4gZSl7dmFyIG89ZVtzXSx1PW8ucHJvcGVydHksYT1zKyIoIitvLnBhcmFtcysiKSI7IWkoYSx1KSYmaShuLnByZWZpeCthLHUpJiZuLmZ1bmN0aW9ucy5wdXNoKHMpfWZvcih2YXIgZiBpbiB0KXt2YXIgdT10W2ZdOyFpKGYsdSkmJmkobi5wcmVmaXgrZix1KSYmbi5rZXl3b3Jkcy5wdXNoKGYpfX0pKCk7KGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcyhlKXtpLnRleHRDb250ZW50PWUrInt9IjtyZXR1cm4hIWkuc2hlZXQuY3NzUnVsZXMubGVuZ3RofXZhciB0PXsiOnJlYWQtb25seSI6bnVsbCwiOnJlYWQtd3JpdGUiOm51bGwsIjphbnktbGluayI6bnVsbCwiOjpzZWxlY3Rpb24iOm51bGx9LHI9e2tleWZyYW1lczoibmFtZSIsdmlld3BvcnQ6bnVsbCxkb2N1bWVudDoncmVnZXhwKCIuIiknfTtuLnNlbGVjdG9ycz1bXTtuLmF0cnVsZXM9W107dmFyIGk9ZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpKTtmb3IodmFyIG8gaW4gdCl7dmFyIHU9bysodFtvXT8iKCIrdFtvXSsiKSI6IiIpOyFzKHUpJiZzKG4ucHJlZml4U2VsZWN0b3IodSkpJiZuLnNlbGVjdG9ycy5wdXNoKG8pfWZvcih2YXIgYSBpbiByKXt2YXIgdT1hKyIgIisoclthXXx8IiIpOyFzKCJAIit1KSYmcygiQCIrbi5wcmVmaXgrdSkmJm4uYXRydWxlcy5wdXNoKGEpfWUucmVtb3ZlQ2hpbGQoaSl9KSgpO24udmFsdWVQcm9wZXJ0aWVzPVsidHJhbnNpdGlvbiIsInRyYW5zaXRpb24tcHJvcGVydHkiXTtlLmNsYXNzTmFtZSs9IiAiK24ucHJlZml4O1N0eWxlRml4LnJlZ2lzdGVyKG4ucHJlZml4Q1NTKX0pKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7Ci8qKgogKiBEZWZpbmVzIHRoZSBGbGF0IFN1cmZhY2UgU2hhZGVyIG5hbWVzcGFjZSBmb3IgYWxsIHRoZSBhd2Vzb21lbmVzcyB0byBleGlzdCB1cG9uLgogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTID0gewogIEZST05UICA6IDAsCiAgQkFDSyAgIDogMSwKICBET1VCTEUgOiAyLAogIFNWR05TICA6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycKfTsKCi8qKgogKiBAY2xhc3MgQXJyYXkKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5BcnJheSA9IHR5cGVvZiBGbG9hdDMyQXJyYXkgPT09ICdmdW5jdGlvbicgPyBGbG9hdDMyQXJyYXkgOiBBcnJheTsKCi8qKgogKiBAY2xhc3MgVXRpbHMKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5VdGlscyA9IHsKICBpc051bWJlcjogZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiAhaXNOYU4ocGFyc2VGbG9hdCh2YWx1ZSkpICYmIGlzRmluaXRlKHZhbHVlKTsKICB9Cn07CgovKioKICogUmVxdWVzdCBBbmltYXRpb24gRnJhbWUgUG9seWZpbGwuCiAqIEBhdXRob3IgUGF1bCBJcmlzaAogKiBAc2VlIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL3BhdWxpcmlzaC8xNTc5NjcxCiAqLwooZnVuY3Rpb24oKSB7CgogIHZhciBsYXN0VGltZSA9IDA7CiAgdmFyIHZlbmRvcnMgPSBbJ21zJywgJ21veicsICd3ZWJraXQnLCAnbyddOwoKICBmb3IodmFyIHggPSAwOyB4IDwgdmVuZG9ycy5sZW5ndGggJiYgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7ICsreCkgewogICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvd1t2ZW5kb3JzW3hdKydSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTsKICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSAgPSB3aW5kb3dbdmVuZG9yc1t4XSsnQ2FuY2VsQW5pbWF0aW9uRnJhbWUnXSB8fCB3aW5kb3dbdmVuZG9yc1t4XSsnQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107CiAgfQoKICBpZiAoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHsKICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihjYWxsYmFjaywgZWxlbWVudCkgewogICAgICB2YXIgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgdmFyIHRpbWVUb0NhbGwgPSBNYXRoLm1heCgwLCAxNiAtIChjdXJyZW50VGltZSAtIGxhc3RUaW1lKSk7CiAgICAgIHZhciBpZCA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGNhbGxiYWNrKGN1cnJlbnRUaW1lICsgdGltZVRvQ2FsbCk7CiAgICAgIH0sIHRpbWVUb0NhbGwpOwogICAgICBsYXN0VGltZSA9IGN1cnJlbnRUaW1lICsgdGltZVRvQ2FsbDsKICAgICAgcmV0dXJuIGlkOwogICAgfTsKICB9CgogIGlmICghd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKSB7CiAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihpZCkgewogICAgICBjbGVhclRpbWVvdXQoaWQpOwogICAgfTsKICB9Cgp9KCkpOwoKLyoqCiAqIEBvYmplY3QgTWF0aCBBdWdtZW50YXRpb24KICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCk1hdGguUElNMiA9IE1hdGguUEkqMjsKTWF0aC5QSUQyID0gTWF0aC5QSS8yOwpNYXRoLnJhbmRvbUluUmFuZ2UgPSBmdW5jdGlvbihtaW4sIG1heCkgewogIHJldHVybiBtaW4gKyAobWF4IC0gbWluKSAqIE1hdGgucmFuZG9tKCk7Cn07Ck1hdGguY2xhbXAgPSBmdW5jdGlvbih2YWx1ZSwgbWluLCBtYXgpIHsKICB2YWx1ZSA9IE1hdGgubWF4KHZhbHVlLCBtaW4pOwogIHZhbHVlID0gTWF0aC5taW4odmFsdWUsIG1heCk7CiAgcmV0dXJuIHZhbHVlOwp9OwoKLyoqCiAqIEBvYmplY3QgVmVjdG9yMwogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTLlZlY3RvcjMgPSB7CiAgY3JlYXRlOiBmdW5jdGlvbih4LCB5LCB6KSB7CiAgICB2YXIgdmVjdG9yID0gbmV3IEZTUy5BcnJheSgzKTsKICAgIHRoaXMuc2V0KHZlY3RvciwgeCwgeSwgeik7CiAgICByZXR1cm4gdmVjdG9yOwogIH0sCiAgY2xvbmU6IGZ1bmN0aW9uKGEpIHsKICAgIHZhciB2ZWN0b3IgPSB0aGlzLmNyZWF0ZSgpOwogICAgdGhpcy5jb3B5KHZlY3RvciwgYSk7CiAgICByZXR1cm4gdmVjdG9yOwogIH0sCiAgc2V0OiBmdW5jdGlvbih0YXJnZXQsIHgsIHksIHopIHsKICAgIHRhcmdldFswXSA9IHggfHwgMDsKICAgIHRhcmdldFsxXSA9IHkgfHwgMDsKICAgIHRhcmdldFsyXSA9IHogfHwgMDsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgc2V0WDogZnVuY3Rpb24odGFyZ2V0LCB4KSB7CiAgICB0YXJnZXRbMF0gPSB4IHx8IDA7CiAgICByZXR1cm4gdGhpczsKICB9LAogIHNldFk6IGZ1bmN0aW9uKHRhcmdldCwgeSkgewogICAgdGFyZ2V0WzFdID0geSB8fCAwOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBzZXRaOiBmdW5jdGlvbih0YXJnZXQsIHopIHsKICAgIHRhcmdldFsyXSA9IHogfHwgMDsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgY29weTogZnVuY3Rpb24odGFyZ2V0LCBhKSB7CiAgICB0YXJnZXRbMF0gPSBhWzBdOwogICAgdGFyZ2V0WzFdID0gYVsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIGFkZDogZnVuY3Rpb24odGFyZ2V0LCBhKSB7CiAgICB0YXJnZXRbMF0gKz0gYVswXTsKICAgIHRhcmdldFsxXSArPSBhWzFdOwogICAgdGFyZ2V0WzJdICs9IGFbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIGFkZFZlY3RvcnM6IGZ1bmN0aW9uKHRhcmdldCwgYSwgYikgewogICAgdGFyZ2V0WzBdID0gYVswXSArIGJbMF07CiAgICB0YXJnZXRbMV0gPSBhWzFdICsgYlsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl0gKyBiWzJdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBhZGRTY2FsYXI6IGZ1bmN0aW9uKHRhcmdldCwgcykgewogICAgdGFyZ2V0WzBdICs9IHM7CiAgICB0YXJnZXRbMV0gKz0gczsKICAgIHRhcmdldFsyXSArPSBzOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBzdWJ0cmFjdDogZnVuY3Rpb24odGFyZ2V0LCBhKSB7CiAgICB0YXJnZXRbMF0gLT0gYVswXTsKICAgIHRhcmdldFsxXSAtPSBhWzFdOwogICAgdGFyZ2V0WzJdIC09IGFbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIHN1YnRyYWN0VmVjdG9yczogZnVuY3Rpb24odGFyZ2V0LCBhLCBiKSB7CiAgICB0YXJnZXRbMF0gPSBhWzBdIC0gYlswXTsKICAgIHRhcmdldFsxXSA9IGFbMV0gLSBiWzFdOwogICAgdGFyZ2V0WzJdID0gYVsyXSAtIGJbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIHN1YnRyYWN0U2NhbGFyOiBmdW5jdGlvbih0YXJnZXQsIHMpIHsKICAgIHRhcmdldFswXSAtPSBzOwogICAgdGFyZ2V0WzFdIC09IHM7CiAgICB0YXJnZXRbMl0gLT0gczsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgbXVsdGlwbHk6IGZ1bmN0aW9uKHRhcmdldCwgYSkgewogICAgdGFyZ2V0WzBdICo9IGFbMF07CiAgICB0YXJnZXRbMV0gKj0gYVsxXTsKICAgIHRhcmdldFsyXSAqPSBhWzJdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtdWx0aXBseVZlY3RvcnM6IGZ1bmN0aW9uKHRhcmdldCwgYSwgYikgewogICAgdGFyZ2V0WzBdID0gYVswXSAqIGJbMF07CiAgICB0YXJnZXRbMV0gPSBhWzFdICogYlsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl0gKiBiWzJdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtdWx0aXBseVNjYWxhcjogZnVuY3Rpb24odGFyZ2V0LCBzKSB7CiAgICB0YXJnZXRbMF0gKj0gczsKICAgIHRhcmdldFsxXSAqPSBzOwogICAgdGFyZ2V0WzJdICo9IHM7CiAgICByZXR1cm4gdGhpczsKICB9LAogIGRpdmlkZTogZnVuY3Rpb24odGFyZ2V0LCBhKSB7CiAgICB0YXJnZXRbMF0gLz0gYVswXTsKICAgIHRhcmdldFsxXSAvPSBhWzFdOwogICAgdGFyZ2V0WzJdIC89IGFbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIGRpdmlkZVZlY3RvcnM6IGZ1bmN0aW9uKHRhcmdldCwgYSwgYikgewogICAgdGFyZ2V0WzBdID0gYVswXSAvIGJbMF07CiAgICB0YXJnZXRbMV0gPSBhWzFdIC8gYlsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl0gLyBiWzJdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBkaXZpZGVTY2FsYXI6IGZ1bmN0aW9uKHRhcmdldCwgcykgewogICAgaWYgKHMgIT09IDApIHsKICAgICAgdGFyZ2V0WzBdIC89IHM7CiAgICAgIHRhcmdldFsxXSAvPSBzOwogICAgICB0YXJnZXRbMl0gLz0gczsKICAgIH0gZWxzZSB7CiAgICAgIHRhcmdldFswXSA9IDA7CiAgICAgIHRhcmdldFsxXSA9IDA7CiAgICAgIHRhcmdldFsyXSA9IDA7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9LAogIGNyb3NzOiBmdW5jdGlvbih0YXJnZXQsIGEpIHsKICAgIHZhciB4ID0gdGFyZ2V0WzBdOwogICAgdmFyIHkgPSB0YXJnZXRbMV07CiAgICB2YXIgeiA9IHRhcmdldFsyXTsKICAgIHRhcmdldFswXSA9IHkqYVsyXSAtIHoqYVsxXTsKICAgIHRhcmdldFsxXSA9IHoqYVswXSAtIHgqYVsyXTsKICAgIHRhcmdldFsyXSA9IHgqYVsxXSAtIHkqYVswXTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgY3Jvc3NWZWN0b3JzOiBmdW5jdGlvbih0YXJnZXQsIGEsIGIpIHsKICAgIHRhcmdldFswXSA9IGFbMV0qYlsyXSAtIGFbMl0qYlsxXTsKICAgIHRhcmdldFsxXSA9IGFbMl0qYlswXSAtIGFbMF0qYlsyXTsKICAgIHRhcmdldFsyXSA9IGFbMF0qYlsxXSAtIGFbMV0qYlswXTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgbWluOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CiAgICBpZiAodGFyZ2V0WzBdIDwgdmFsdWUpIHsgdGFyZ2V0WzBdID0gdmFsdWU7IH0KICAgIGlmICh0YXJnZXRbMV0gPCB2YWx1ZSkgeyB0YXJnZXRbMV0gPSB2YWx1ZTsgfQogICAgaWYgKHRhcmdldFsyXSA8IHZhbHVlKSB7IHRhcmdldFsyXSA9IHZhbHVlOyB9CiAgICByZXR1cm4gdGhpczsKICB9LAogIG1heDogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewogICAgaWYgKHRhcmdldFswXSA+IHZhbHVlKSB7IHRhcmdldFswXSA9IHZhbHVlOyB9CiAgICBpZiAodGFyZ2V0WzFdID4gdmFsdWUpIHsgdGFyZ2V0WzFdID0gdmFsdWU7IH0KICAgIGlmICh0YXJnZXRbMl0gPiB2YWx1ZSkgeyB0YXJnZXRbMl0gPSB2YWx1ZTsgfQogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBjbGFtcDogZnVuY3Rpb24odGFyZ2V0LCBtaW4sIG1heCkgewogICAgdGhpcy5taW4odGFyZ2V0LCBtaW4pOwogICAgdGhpcy5tYXgodGFyZ2V0LCBtYXgpOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBsaW1pdDogZnVuY3Rpb24odGFyZ2V0LCBtaW4sIG1heCkgewogICAgdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoKHRhcmdldCk7CiAgICBpZiAobWluICE9PSBudWxsICYmIGxlbmd0aCA8IG1pbikgewogICAgICB0aGlzLnNldExlbmd0aCh0YXJnZXQsIG1pbik7CiAgICB9IGVsc2UgaWYgKG1heCAhPT0gbnVsbCAmJiBsZW5ndGggPiBtYXgpIHsKICAgICAgdGhpcy5zZXRMZW5ndGgodGFyZ2V0LCBtYXgpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBkb3Q6IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBhWzBdKmJbMF0gKyBhWzFdKmJbMV0gKyBhWzJdKmJbMl07CiAgfSwKICBub3JtYWxpc2U6IGZ1bmN0aW9uKHRhcmdldCkgewogICAgcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRhcmdldCwgdGhpcy5sZW5ndGgodGFyZ2V0KSk7CiAgfSwKICBuZWdhdGU6IGZ1bmN0aW9uKHRhcmdldCkgewogICAgcmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIodGFyZ2V0LCAtMSk7CiAgfSwKICBkaXN0YW5jZVNxdWFyZWQ6IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHZhciBkeCA9IGFbMF0gLSBiWzBdOwogICAgdmFyIGR5ID0gYVsxXSAtIGJbMV07CiAgICB2YXIgZHogPSBhWzJdIC0gYlsyXTsKICAgIHJldHVybiBkeCpkeCArIGR5KmR5ICsgZHoqZHo7CiAgfSwKICBkaXN0YW5jZTogZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIE1hdGguc3FydCh0aGlzLmRpc3RhbmNlU3F1YXJlZChhLCBiKSk7CiAgfSwKICBsZW5ndGhTcXVhcmVkOiBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gYVswXSphWzBdICsgYVsxXSphWzFdICsgYVsyXSphWzJdOwogIH0sCiAgbGVuZ3RoOiBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMubGVuZ3RoU3F1YXJlZChhKSk7CiAgfSwKICBzZXRMZW5ndGg6IGZ1bmN0aW9uKHRhcmdldCwgbCkgewogICAgdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoKHRhcmdldCk7CiAgICBpZiAobGVuZ3RoICE9PSAwICYmIGwgIT09IGxlbmd0aCkgewogICAgICB0aGlzLm11bHRpcGx5U2NhbGFyKHRhcmdldCwgbCAvIGxlbmd0aCk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQG9iamVjdCBWZWN0b3I0CiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuVmVjdG9yNCA9IHsKICBjcmVhdGU6IGZ1bmN0aW9uKHgsIHksIHosIHcpIHsKICAgIHZhciB2ZWN0b3IgPSBuZXcgRlNTLkFycmF5KDQpOwogICAgdGhpcy5zZXQodmVjdG9yLCB4LCB5LCB6KTsKICAgIHJldHVybiB2ZWN0b3I7CiAgfSwKICBzZXQ6IGZ1bmN0aW9uKHRhcmdldCwgeCwgeSwgeiwgdykgewogICAgdGFyZ2V0WzBdID0geCB8fCAwOwogICAgdGFyZ2V0WzFdID0geSB8fCAwOwogICAgdGFyZ2V0WzJdID0geiB8fCAwOwogICAgdGFyZ2V0WzNdID0gdyB8fCAwOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBzZXRYOiBmdW5jdGlvbih0YXJnZXQsIHgpIHsKICAgIHRhcmdldFswXSA9IHggfHwgMDsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgc2V0WTogZnVuY3Rpb24odGFyZ2V0LCB5KSB7CiAgICB0YXJnZXRbMV0gPSB5IHx8IDA7CiAgICByZXR1cm4gdGhpczsKICB9LAogIHNldFo6IGZ1bmN0aW9uKHRhcmdldCwgeikgewogICAgdGFyZ2V0WzJdID0geiB8fCAwOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBzZXRXOiBmdW5jdGlvbih0YXJnZXQsIHcpIHsKICAgIHRhcmdldFszXSA9IHcgfHwgMDsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgYWRkOiBmdW5jdGlvbih0YXJnZXQsIGEpIHsKICAgIHRhcmdldFswXSArPSBhWzBdOwogICAgdGFyZ2V0WzFdICs9IGFbMV07CiAgICB0YXJnZXRbMl0gKz0gYVsyXTsKICAgIHRhcmdldFszXSArPSBhWzNdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtdWx0aXBseVZlY3RvcnM6IGZ1bmN0aW9uKHRhcmdldCwgYSwgYikgewogICAgdGFyZ2V0WzBdID0gYVswXSAqIGJbMF07CiAgICB0YXJnZXRbMV0gPSBhWzFdICogYlsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl0gKiBiWzJdOwogICAgdGFyZ2V0WzNdID0gYVszXSAqIGJbM107CiAgICByZXR1cm4gdGhpczsKICB9LAogIG11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbih0YXJnZXQsIHMpIHsKICAgIHRhcmdldFswXSAqPSBzOwogICAgdGFyZ2V0WzFdICo9IHM7CiAgICB0YXJnZXRbMl0gKj0gczsKICAgIHRhcmdldFszXSAqPSBzOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtaW46IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKICAgIGlmICh0YXJnZXRbMF0gPCB2YWx1ZSkgeyB0YXJnZXRbMF0gPSB2YWx1ZTsgfQogICAgaWYgKHRhcmdldFsxXSA8IHZhbHVlKSB7IHRhcmdldFsxXSA9IHZhbHVlOyB9CiAgICBpZiAodGFyZ2V0WzJdIDwgdmFsdWUpIHsgdGFyZ2V0WzJdID0gdmFsdWU7IH0KICAgIGlmICh0YXJnZXRbM10gPCB2YWx1ZSkgeyB0YXJnZXRbM10gPSB2YWx1ZTsgfQogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtYXg6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKICAgIGlmICh0YXJnZXRbMF0gPiB2YWx1ZSkgeyB0YXJnZXRbMF0gPSB2YWx1ZTsgfQogICAgaWYgKHRhcmdldFsxXSA+IHZhbHVlKSB7IHRhcmdldFsxXSA9IHZhbHVlOyB9CiAgICBpZiAodGFyZ2V0WzJdID4gdmFsdWUpIHsgdGFyZ2V0WzJdID0gdmFsdWU7IH0KICAgIGlmICh0YXJnZXRbM10gPiB2YWx1ZSkgeyB0YXJnZXRbM10gPSB2YWx1ZTsgfQogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBjbGFtcDogZnVuY3Rpb24odGFyZ2V0LCBtaW4sIG1heCkgewogICAgdGhpcy5taW4odGFyZ2V0LCBtaW4pOwogICAgdGhpcy5tYXgodGFyZ2V0LCBtYXgpOwogICAgcmV0dXJuIHRoaXM7CiAgfQp9OwoKLyoqCiAqIEBjbGFzcyBDb2xvcgogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTLkNvbG9yID0gZnVuY3Rpb24oaGV4LCBvcGFjaXR5KSB7CiAgdGhpcy5yZ2JhID0gRlNTLlZlY3RvcjQuY3JlYXRlKCk7CiAgdGhpcy5oZXggPSBoZXggfHwgJyMwMDAwMDAnOwogIHRoaXMub3BhY2l0eSA9IEZTUy5VdGlscy5pc051bWJlcihvcGFjaXR5KSA/IG9wYWNpdHkgOiAxOwogIHRoaXMuc2V0KHRoaXMuaGV4LCB0aGlzLm9wYWNpdHkpOwp9OwoKRlNTLkNvbG9yLnByb3RvdHlwZSA9IHsKICBzZXQ6IGZ1bmN0aW9uKGhleCwgb3BhY2l0eSkgewogICAgaGV4ID0gaGV4LnJlcGxhY2UoJyMnLCAnJyk7CiAgICB2YXIgc2l6ZSA9IGhleC5sZW5ndGggLyAzOwogICAgdGhpcy5yZ2JhWzBdID0gcGFyc2VJbnQoaGV4LnN1YnN0cmluZyhzaXplKjAsIHNpemUqMSksIDE2KSAvIDI1NTsKICAgIHRoaXMucmdiYVsxXSA9IHBhcnNlSW50KGhleC5zdWJzdHJpbmcoc2l6ZSoxLCBzaXplKjIpLCAxNikgLyAyNTU7CiAgICB0aGlzLnJnYmFbMl0gPSBwYXJzZUludChoZXguc3Vic3RyaW5nKHNpemUqMiwgc2l6ZSozKSwgMTYpIC8gMjU1OwogICAgdGhpcy5yZ2JhWzNdID0gRlNTLlV0aWxzLmlzTnVtYmVyKG9wYWNpdHkpID8gb3BhY2l0eSA6IHRoaXMucmdiYVszXTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgaGV4aWZ5OiBmdW5jdGlvbihjaGFubmVsKSB7CiAgICB2YXIgaGV4ID0gTWF0aC5jZWlsKGNoYW5uZWwqMjU1KS50b1N0cmluZygxNik7CiAgICBpZiAoaGV4Lmxlbmd0aCA9PT0gMSkgeyBoZXggPSAnMCcgKyBoZXg7IH0KICAgIHJldHVybiBoZXg7CiAgfSwKICBmb3JtYXQ6IGZ1bmN0aW9uKCkgewogICAgdmFyIHIgPSB0aGlzLmhleGlmeSh0aGlzLnJnYmFbMF0pOwogICAgdmFyIGcgPSB0aGlzLmhleGlmeSh0aGlzLnJnYmFbMV0pOwogICAgdmFyIGIgPSB0aGlzLmhleGlmeSh0aGlzLnJnYmFbMl0pOwogICAgdGhpcy5oZXggPSAnIycgKyByICsgZyArIGI7CiAgICByZXR1cm4gdGhpcy5oZXg7CiAgfQp9OwoKLyoqCiAqIEBjbGFzcyBPYmplY3QKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5PYmplY3QgPSBmdW5jdGlvbigpIHsKICB0aGlzLnBvc2l0aW9uID0gRlNTLlZlY3RvcjMuY3JlYXRlKCk7Cn07CgpGU1MuT2JqZWN0LnByb3RvdHlwZSA9IHsKICBzZXRQb3NpdGlvbjogZnVuY3Rpb24oeCwgeSwgeikgewogICAgRlNTLlZlY3RvcjMuc2V0KHRoaXMucG9zaXRpb24sIHgsIHksIHopOwogICAgcmV0dXJuIHRoaXM7CiAgfQp9OwoKLyoqCiAqIEBjbGFzcyBMaWdodAogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTLkxpZ2h0ID0gZnVuY3Rpb24oYW1iaWVudCwgZGlmZnVzZSkgewogIEZTUy5PYmplY3QuY2FsbCh0aGlzKTsKICB0aGlzLmFtYmllbnQgPSBuZXcgRlNTLkNvbG9yKGFtYmllbnQgfHwgJyNGRkZGRkYnKTsKICB0aGlzLmRpZmZ1c2UgPSBuZXcgRlNTLkNvbG9yKGRpZmZ1c2UgfHwgJyNGRkZGRkYnKTsKICB0aGlzLnJheSA9IEZTUy5WZWN0b3IzLmNyZWF0ZSgpOwp9OwoKRlNTLkxpZ2h0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRlNTLk9iamVjdC5wcm90b3R5cGUpOwoKLyoqCiAqIEBjbGFzcyBWZXJ0ZXgKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5WZXJ0ZXggPSBmdW5jdGlvbih4LCB5LCB6KSB7CiAgdGhpcy5wb3NpdGlvbiA9IEZTUy5WZWN0b3IzLmNyZWF0ZSh4LCB5LCB6KTsKfTsKCkZTUy5WZXJ0ZXgucHJvdG90eXBlID0gewogIHNldFBvc2l0aW9uOiBmdW5jdGlvbih4LCB5LCB6KSB7CiAgICBGU1MuVmVjdG9yMy5zZXQodGhpcy5wb3NpdGlvbiwgeCwgeSwgeik7CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQGNsYXNzIFRyaWFuZ2xlCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuVHJpYW5nbGUgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgdGhpcy5hID0gYSB8fCBuZXcgRlNTLlZlcnRleCgpOwogIHRoaXMuYiA9IGIgfHwgbmV3IEZTUy5WZXJ0ZXgoKTsKICB0aGlzLmMgPSBjIHx8IG5ldyBGU1MuVmVydGV4KCk7CiAgdGhpcy52ZXJ0aWNlcyA9IFt0aGlzLmEsIHRoaXMuYiwgdGhpcy5jXTsKICB0aGlzLnUgPSBGU1MuVmVjdG9yMy5jcmVhdGUoKTsKICB0aGlzLnYgPSBGU1MuVmVjdG9yMy5jcmVhdGUoKTsKICB0aGlzLmNlbnRyb2lkID0gRlNTLlZlY3RvcjMuY3JlYXRlKCk7CiAgdGhpcy5ub3JtYWwgPSBGU1MuVmVjdG9yMy5jcmVhdGUoKTsKICB0aGlzLmNvbG9yID0gbmV3IEZTUy5Db2xvcigpOwogIHRoaXMucG9seWdvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhGU1MuU1ZHTlMsICdwb2x5Z29uJyk7CiAgdGhpcy5wb2x5Z29uLnNldEF0dHJpYnV0ZU5TKG51bGwsICdzdHJva2UtbGluZWpvaW4nLCAncm91bmQnKTsKICB0aGlzLnBvbHlnb24uc2V0QXR0cmlidXRlTlMobnVsbCwgJ3N0cm9rZS1taXRlcmxpbWl0JywgJzEnKTsKICB0aGlzLnBvbHlnb24uc2V0QXR0cmlidXRlTlMobnVsbCwgJ3N0cm9rZS13aWR0aCcsICcxJyk7CiAgdGhpcy5jb21wdXRlQ2VudHJvaWQoKTsKICB0aGlzLmNvbXB1dGVOb3JtYWwoKTsKfTsKCkZTUy5UcmlhbmdsZS5wcm90b3R5cGUgPSB7CiAgY29tcHV0ZUNlbnRyb2lkOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuY2VudHJvaWRbMF0gPSB0aGlzLmEucG9zaXRpb25bMF0gKyB0aGlzLmIucG9zaXRpb25bMF0gKyB0aGlzLmMucG9zaXRpb25bMF07CiAgICB0aGlzLmNlbnRyb2lkWzFdID0gdGhpcy5hLnBvc2l0aW9uWzFdICsgdGhpcy5iLnBvc2l0aW9uWzFdICsgdGhpcy5jLnBvc2l0aW9uWzFdOwogICAgdGhpcy5jZW50cm9pZFsyXSA9IHRoaXMuYS5wb3NpdGlvblsyXSArIHRoaXMuYi5wb3NpdGlvblsyXSArIHRoaXMuYy5wb3NpdGlvblsyXTsKICAgIEZTUy5WZWN0b3IzLmRpdmlkZVNjYWxhcih0aGlzLmNlbnRyb2lkLCAzKTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgY29tcHV0ZU5vcm1hbDogZnVuY3Rpb24oKSB7CiAgICBGU1MuVmVjdG9yMy5zdWJ0cmFjdFZlY3RvcnModGhpcy51LCB0aGlzLmIucG9zaXRpb24sIHRoaXMuYS5wb3NpdGlvbik7CiAgICBGU1MuVmVjdG9yMy5zdWJ0cmFjdFZlY3RvcnModGhpcy52LCB0aGlzLmMucG9zaXRpb24sIHRoaXMuYS5wb3NpdGlvbik7CiAgICBGU1MuVmVjdG9yMy5jcm9zc1ZlY3RvcnModGhpcy5ub3JtYWwsIHRoaXMudSwgdGhpcy52KTsKICAgIEZTUy5WZWN0b3IzLm5vcm1hbGlzZSh0aGlzLm5vcm1hbCk7CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQGNsYXNzIEdlb21ldHJ5CiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuR2VvbWV0cnkgPSBmdW5jdGlvbigpIHsKICB0aGlzLnZlcnRpY2VzID0gW107CiAgdGhpcy50cmlhbmdsZXMgPSBbXTsKICB0aGlzLmRpcnR5ID0gZmFsc2U7Cn07CgpGU1MuR2VvbWV0cnkucHJvdG90eXBlID0gewogIHVwZGF0ZTogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICB2YXIgdCx0cmlhbmdsZTsKICAgICAgZm9yICh0ID0gdGhpcy50cmlhbmdsZXMubGVuZ3RoIC0gMTsgdCA+PSAwOyB0LS0pIHsKICAgICAgICB0cmlhbmdsZSA9IHRoaXMudHJpYW5nbGVzW3RdOwogICAgICAgIHRyaWFuZ2xlLmNvbXB1dGVDZW50cm9pZCgpOwogICAgICAgIHRyaWFuZ2xlLmNvbXB1dGVOb3JtYWwoKTsKICAgICAgfQogICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQGNsYXNzIFBsYW5lCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkLCBtb2RpZmllZCBieSBNYWtzaW0gU3VyZ3V5IHRvIGltcGxlbWVudCBEZWxhdW5heSB0cmlhbmd1bGF0aW9uCiAqLwpGU1MuUGxhbmUgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0LCBob3dtYW55KSB7CiAgRlNTLkdlb21ldHJ5LmNhbGwodGhpcyk7CiAgdGhpcy53aWR0aCA9IHdpZHRoIHx8IDEwMDsKICB0aGlzLmhlaWdodCA9IGhlaWdodCB8fCAxMDA7CgogIC8vIENhY2hlIFZhcmlhYmxlcwogIHZhciB4LCB5LCB2ZXJ0aWNlcyA9IG5ldyBBcnJheShob3dtYW55KTsKICAgIG9mZnNldFggPSB0aGlzLndpZHRoICogLTAuNSwKICAgIG9mZnNldFkgPSB0aGlzLmhlaWdodCAqIDAuNTsKCiAgZm9yKGkgPSB2ZXJ0aWNlcy5sZW5ndGg7IGktLTsgKSB7CiAgICB4ID0gIG9mZnNldFggKyBNYXRoLnJhbmRvbSgpKndpZHRoOwogICAgeSA9ICBvZmZzZXRZIC0gTWF0aC5yYW5kb20oKSpoZWlnaHQ7CgogICAgdmVydGljZXNbaV0gPSBbeCwgeV07CiAgfQoKICAvLyBHZW5lcmF0ZSBhZGRpdGlvbmFsIHBvaW50cyBvbiB0aGUgcGVyaW1ldGVyIHNvIHRoYXQgdGhlcmUgYXJlIG5vIGhvbGVzIGluIHRoZSBwYXR0ZXJuCiAgdmVydGljZXMucHVzaChbb2Zmc2V0WCwgb2Zmc2V0WV0pOwogIHZlcnRpY2VzLnB1c2goW29mZnNldFggKyB3aWR0aC8yLCBvZmZzZXRZXSk7CiAgdmVydGljZXMucHVzaChbb2Zmc2V0WCArIHdpZHRoLCBvZmZzZXRZXSk7CiAgdmVydGljZXMucHVzaChbb2Zmc2V0WCArIHdpZHRoLCBvZmZzZXRZIC0gaGVpZ2h0LzJdKTsKICB2ZXJ0aWNlcy5wdXNoKFtvZmZzZXRYICsgd2lkdGgsIG9mZnNldFkgLSBoZWlnaHRdKTsKICB2ZXJ0aWNlcy5wdXNoKFtvZmZzZXRYICsgd2lkdGgvMiwgb2Zmc2V0WSAtIGhlaWdodF0pOwogIHZlcnRpY2VzLnB1c2goW29mZnNldFgsIG9mZnNldFkgLSBoZWlnaHRdKTsKICB2ZXJ0aWNlcy5wdXNoKFtvZmZzZXRYLCBvZmZzZXRZIC0gaGVpZ2h0LzJdKTsKCiAgLy8gR2VuZXJhdGUgYWRkaXRpb25hbCByYW5kb21seSBwbGFjZWQgcG9pbnRzIG9uIHRoZSBwZXJpbWV0ZXIKICBmb3IgKHZhciBpID0gNjsgaSA+PSAwOyBpLS0pIHsKICAgIHZlcnRpY2VzLnB1c2goWyBvZmZzZXRYICsgTWF0aC5yYW5kb20oKSp3aWR0aCwgb2Zmc2V0WV0pOwogICAgdmVydGljZXMucHVzaChbIG9mZnNldFgsIG9mZnNldFkgLSBNYXRoLnJhbmRvbSgpKmhlaWdodF0pOwogICAgdmVydGljZXMucHVzaChbIG9mZnNldFggKyB3aWR0aCwgb2Zmc2V0WSAtIE1hdGgucmFuZG9tKCkqaGVpZ2h0XSk7CiAgICB2ZXJ0aWNlcy5wdXNoKFsgb2Zmc2V0WCArIE1hdGgucmFuZG9tKCkqd2lkdGgsIG9mZnNldFktaGVpZ2h0XSk7CiAgfQoKICAvLyBDcmVhdGUgYW4gYXJyYXkgb2YgdHJpYW5ndWxhdGVkIGNvb3JkaW5hdGVzIGZyb20gb3VyIHZlcnRpY2VzCiAgdmFyIHRyaWFuZ2xlcyA9IERlbGF1bmF5LnRyaWFuZ3VsYXRlKHZlcnRpY2VzKTsKCiAgZm9yKGkgPSB0cmlhbmdsZXMubGVuZ3RoOyBpOyApIHsKICAgIC0taTsKICAgIHYxID0gbmV3IEZTUy5WZXJ0ZXgoTWF0aC5jZWlsKHZlcnRpY2VzW3RyaWFuZ2xlc1tpXV1bMF0pLCBNYXRoLmNlaWwodmVydGljZXNbdHJpYW5nbGVzW2ldXVsxXSkpOwogICAgLS1pOwogICAgdjIgPSBuZXcgRlNTLlZlcnRleChNYXRoLmNlaWwodmVydGljZXNbdHJpYW5nbGVzW2ldXVswXSksIE1hdGguY2VpbCh2ZXJ0aWNlc1t0cmlhbmdsZXNbaV1dWzFdKSk7CiAgICAtLWk7CiAgICB2MyA9IG5ldyBGU1MuVmVydGV4KE1hdGguY2VpbCh2ZXJ0aWNlc1t0cmlhbmdsZXNbaV1dWzBdKSwgTWF0aC5jZWlsKHZlcnRpY2VzW3RyaWFuZ2xlc1tpXV1bMV0pKTsKICAgIHQxID0gbmV3IEZTUy5UcmlhbmdsZSh2MSx2Mix2Myk7CiAgICB0aGlzLnRyaWFuZ2xlcy5wdXNoKHQxKTsKICAgIHRoaXMudmVydGljZXMucHVzaCh2MSk7CiAgICB0aGlzLnZlcnRpY2VzLnB1c2godjIpOwogICAgdGhpcy52ZXJ0aWNlcy5wdXNoKHYzKTsKICB9Cn07CgpGU1MuUGxhbmUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShGU1MuR2VvbWV0cnkucHJvdG90eXBlKTsKCi8qKgogKiBAY2xhc3MgTWF0ZXJpYWwKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5NYXRlcmlhbCA9IGZ1bmN0aW9uKGFtYmllbnQsIGRpZmZ1c2UpIHsKICB0aGlzLmFtYmllbnQgPSBuZXcgRlNTLkNvbG9yKGFtYmllbnQgfHwgJyM0NDQ0NDQnKTsKICB0aGlzLmRpZmZ1c2UgPSBuZXcgRlNTLkNvbG9yKGRpZmZ1c2UgfHwgJyNGRkZGRkYnKTsKICB0aGlzLnNsYXZlID0gbmV3IEZTUy5Db2xvcigpOwp9OwoKLyoqCiAqIEBjbGFzcyBNZXNoCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuTWVzaCA9IGZ1bmN0aW9uKGdlb21ldHJ5LCBtYXRlcmlhbCkgewogIEZTUy5PYmplY3QuY2FsbCh0aGlzKTsKICB0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnkgfHwgbmV3IEZTUy5HZW9tZXRyeSgpOwogIHRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbCB8fCBuZXcgRlNTLk1hdGVyaWFsKCk7CiAgdGhpcy5zaWRlID0gRlNTLkZST05UOwogIHRoaXMudmlzaWJsZSA9IHRydWU7Cn07CgpGU1MuTWVzaC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEZTUy5PYmplY3QucHJvdG90eXBlKTsKCkZTUy5NZXNoLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihsaWdodHMsIGNhbGN1bGF0ZSkgewogIHZhciB0LHRyaWFuZ2xlLCBsLGxpZ2h0LCBpbGx1bWluYW5jZTsKCiAgLy8gVXBkYXRlIEdlb21ldHJ5CiAgdGhpcy5nZW9tZXRyeS51cGRhdGUoKTsKCiAgLy8gQ2FsY3VsYXRlIHRoZSB0cmlhbmdsZSBjb2xvcnMKICBpZiAoY2FsY3VsYXRlKSB7CgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIFRyaWFuZ2xlcwogICAgZm9yICh0ID0gdGhpcy5nZW9tZXRyeS50cmlhbmdsZXMubGVuZ3RoIC0gMTsgdCA+PSAwOyB0LS0pIHsKICAgICAgdHJpYW5nbGUgPSB0aGlzLmdlb21ldHJ5LnRyaWFuZ2xlc1t0XTsKCiAgICAgIC8vIFJlc2V0IFRyaWFuZ2xlIENvbG9yCiAgICAgIEZTUy5WZWN0b3I0LnNldCh0cmlhbmdsZS5jb2xvci5yZ2JhKTsKCiAgICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBMaWdodHMKICAgICAgZm9yIChsID0gbGlnaHRzLmxlbmd0aCAtIDE7IGwgPj0gMDsgbC0tKSB7CiAgICAgICAgbGlnaHQgPSBsaWdodHNbbF07CgogICAgICAgIC8vIENhbGN1bGF0ZSBJbGx1bWluYW5jZQogICAgICAgIEZTUy5WZWN0b3IzLnN1YnRyYWN0VmVjdG9ycyhsaWdodC5yYXksIGxpZ2h0LnBvc2l0aW9uLCB0cmlhbmdsZS5jZW50cm9pZCk7CiAgICAgICAgRlNTLlZlY3RvcjMubm9ybWFsaXNlKGxpZ2h0LnJheSk7CiAgICAgICAgaWxsdW1pbmFuY2UgPSBGU1MuVmVjdG9yMy5kb3QodHJpYW5nbGUubm9ybWFsLCBsaWdodC5yYXkpOwogICAgICAgIGlmICh0aGlzLnNpZGUgPT09IEZTUy5GUk9OVCkgewogICAgICAgICAgaWxsdW1pbmFuY2UgPSBNYXRoLm1heChpbGx1bWluYW5jZSwgMCk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNpZGUgPT09IEZTUy5CQUNLKSB7CiAgICAgICAgICBpbGx1bWluYW5jZSA9IE1hdGguYWJzKE1hdGgubWluKGlsbHVtaW5hbmNlLCAwKSk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNpZGUgPT09IEZTUy5ET1VCTEUpIHsKICAgICAgICAgIGlsbHVtaW5hbmNlID0gTWF0aC5tYXgoTWF0aC5hYnMoaWxsdW1pbmFuY2UpLCAwKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBBbWJpZW50IExpZ2h0CiAgICAgICAgRlNTLlZlY3RvcjQubXVsdGlwbHlWZWN0b3JzKHRoaXMubWF0ZXJpYWwuc2xhdmUucmdiYSwgdGhpcy5tYXRlcmlhbC5hbWJpZW50LnJnYmEsIGxpZ2h0LmFtYmllbnQucmdiYSk7CiAgICAgICAgRlNTLlZlY3RvcjQuYWRkKHRyaWFuZ2xlLmNvbG9yLnJnYmEsIHRoaXMubWF0ZXJpYWwuc2xhdmUucmdiYSk7CgogICAgICAgIC8vIENhbGN1bGF0ZSBEaWZmdXNlIExpZ2h0CiAgICAgICAgRlNTLlZlY3RvcjQubXVsdGlwbHlWZWN0b3JzKHRoaXMubWF0ZXJpYWwuc2xhdmUucmdiYSwgdGhpcy5tYXRlcmlhbC5kaWZmdXNlLnJnYmEsIGxpZ2h0LmRpZmZ1c2UucmdiYSk7CiAgICAgICAgRlNTLlZlY3RvcjQubXVsdGlwbHlTY2FsYXIodGhpcy5tYXRlcmlhbC5zbGF2ZS5yZ2JhLCBpbGx1bWluYW5jZSk7CiAgICAgICAgRlNTLlZlY3RvcjQuYWRkKHRyaWFuZ2xlLmNvbG9yLnJnYmEsIHRoaXMubWF0ZXJpYWwuc2xhdmUucmdiYSk7CiAgICAgIH0KCiAgICAgIC8vIENsYW1wICYgRm9ybWF0IENvbG9yCiAgICAgIEZTUy5WZWN0b3I0LmNsYW1wKHRyaWFuZ2xlLmNvbG9yLnJnYmEsIDAsIDEpOwogICAgfQogIH0KICByZXR1cm4gdGhpczsKfTsKCi8qKgogKiBAY2xhc3MgU2NlbmUKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5TY2VuZSA9IGZ1bmN0aW9uKCkgewogIHRoaXMubWVzaGVzID0gW107CiAgdGhpcy5saWdodHMgPSBbXTsKfTsKCkZTUy5TY2VuZS5wcm90b3R5cGUgPSB7CiAgYWRkOiBmdW5jdGlvbihvYmplY3QpIHsKICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBGU1MuTWVzaCAmJiAhfnRoaXMubWVzaGVzLmluZGV4T2Yob2JqZWN0KSkgewogICAgICB0aGlzLm1lc2hlcy5wdXNoKG9iamVjdCk7CiAgICB9IGVsc2UgaWYgKG9iamVjdCBpbnN0YW5jZW9mIEZTUy5MaWdodCAmJiAhfnRoaXMubGlnaHRzLmluZGV4T2Yob2JqZWN0KSkgewogICAgICB0aGlzLmxpZ2h0cy5wdXNoKG9iamVjdCk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9LAogIHJlbW92ZTogZnVuY3Rpb24ob2JqZWN0KSB7CiAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRlNTLk1lc2ggJiYgfnRoaXMubWVzaGVzLmluZGV4T2Yob2JqZWN0KSkgewogICAgICB0aGlzLm1lc2hlcy5zcGxpY2UodGhpcy5tZXNoZXMuaW5kZXhPZihvYmplY3QpLCAxKTsKICAgIH0gZWxzZSBpZiAob2JqZWN0IGluc3RhbmNlb2YgRlNTLkxpZ2h0ICYmIH50aGlzLmxpZ2h0cy5pbmRleE9mKG9iamVjdCkpIHsKICAgICAgdGhpcy5saWdodHMuc3BsaWNlKHRoaXMubGlnaHRzLmluZGV4T2Yob2JqZWN0KSwgMSk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQGNsYXNzIFJlbmRlcmVyCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuUmVuZGVyZXIgPSBmdW5jdGlvbigpIHsKICB0aGlzLndpZHRoID0gMDsKICB0aGlzLmhlaWdodCA9IDA7CiAgdGhpcy5oYWxmV2lkdGggPSAwOwogIHRoaXMuaGFsZkhlaWdodCA9IDA7Cn07CgpGU1MuUmVuZGVyZXIucHJvdG90eXBlID0gewogIHNldFNpemU6IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICAgIGlmICh0aGlzLndpZHRoID09PSB3aWR0aCAmJiB0aGlzLmhlaWdodCA9PT0gaGVpZ2h0KSByZXR1cm47CiAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICAgIHRoaXMuaGFsZldpZHRoID0gdGhpcy53aWR0aCAqIDAuNTsKICAgIHRoaXMuaGFsZkhlaWdodCA9IHRoaXMuaGVpZ2h0ICogMC41OwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBjbGVhcjogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpczsKICB9LAogIHJlbmRlcjogZnVuY3Rpb24oc2NlbmUpIHsKICAgIHJldHVybiB0aGlzOwogIH0KfTsKCi8qKgogKiBAY2xhc3MgQ2FudmFzIFJlbmRlcmVyCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuQ2FudmFzUmVuZGVyZXIgPSBmdW5jdGlvbigpIHsKICBGU1MuUmVuZGVyZXIuY2FsbCh0aGlzKTsKICB0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgdGhpcy5jb250ZXh0ID0gdGhpcy5lbGVtZW50LmdldENvbnRleHQoJzJkJyk7CiAgdGhpcy5zZXRTaXplKHRoaXMuZWxlbWVudC53aWR0aCwgdGhpcy5lbGVtZW50LmhlaWdodCk7Cn07CgpGU1MuQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShGU1MuUmVuZGVyZXIucHJvdG90eXBlKTsKCkZTUy5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuc2V0U2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLnNldFNpemUuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KTsKICB0aGlzLmVsZW1lbnQud2lkdGggPSB3aWR0aDsKICB0aGlzLmVsZW1lbnQuaGVpZ2h0ID0gaGVpZ2h0OwogIHRoaXMuY29udGV4dC5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgLTEsIHRoaXMuaGFsZldpZHRoLCB0aGlzLmhhbGZIZWlnaHQpOwogIHJldHVybiB0aGlzOwp9OwoKRlNTLkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkgewogIEZTUy5SZW5kZXJlci5wcm90b3R5cGUuY2xlYXIuY2FsbCh0aGlzKTsKICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KC10aGlzLmhhbGZXaWR0aCwgLXRoaXMuaGFsZkhlaWdodCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpOwogIHJldHVybiB0aGlzOwp9OwoKRlNTLkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbihzY2VuZSkgewogIEZTUy5SZW5kZXJlci5wcm90b3R5cGUucmVuZGVyLmNhbGwodGhpcywgc2NlbmUpOwogIHZhciBtLG1lc2gsIHQsdHJpYW5nbGUsIGNvbG9yOwoKICAvLyBDbGVhciBDb250ZXh0CiAgdGhpcy5jbGVhcigpOwoKICAvLyBDb25maWd1cmUgQ29udGV4dAogIHRoaXMuY29udGV4dC5saW5lSm9pbiA9ICdyb3VuZCc7CiAgdGhpcy5jb250ZXh0LmxpbmVXaWR0aCA9IDE7CgogIC8vIFVwZGF0ZSBNZXNoZXMKICBmb3IgKG0gPSBzY2VuZS5tZXNoZXMubGVuZ3RoIC0gMTsgbSA+PSAwOyBtLS0pIHsKICAgIG1lc2ggPSBzY2VuZS5tZXNoZXNbbV07CiAgICBpZiAobWVzaC52aXNpYmxlKSB7CiAgICAgIG1lc2gudXBkYXRlKHNjZW5lLmxpZ2h0cywgdHJ1ZSk7CgogICAgICAvLyBSZW5kZXIgVHJpYW5nbGVzCiAgICAgIGZvciAodCA9IG1lc2guZ2VvbWV0cnkudHJpYW5nbGVzLmxlbmd0aCAtIDE7IHQgPj0gMDsgdC0tKSB7CiAgICAgICAgdHJpYW5nbGUgPSBtZXNoLmdlb21ldHJ5LnRyaWFuZ2xlc1t0XTsKICAgICAgICBjb2xvciA9IHRyaWFuZ2xlLmNvbG9yLmZvcm1hdCgpOwogICAgICAgIHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTsKICAgICAgICB0aGlzLmNvbnRleHQubW92ZVRvKHRyaWFuZ2xlLmEucG9zaXRpb25bMF0sIHRyaWFuZ2xlLmEucG9zaXRpb25bMV0pOwogICAgICAgIHRoaXMuY29udGV4dC5saW5lVG8odHJpYW5nbGUuYi5wb3NpdGlvblswXSwgdHJpYW5nbGUuYi5wb3NpdGlvblsxXSk7CiAgICAgICAgdGhpcy5jb250ZXh0LmxpbmVUbyh0cmlhbmdsZS5jLnBvc2l0aW9uWzBdLCB0cmlhbmdsZS5jLnBvc2l0aW9uWzFdKTsKICAgICAgICB0aGlzLmNvbnRleHQuY2xvc2VQYXRoKCk7CiAgICAgICAgdGhpcy5jb250ZXh0LnN0cm9rZVN0eWxlID0gY29sb3I7CiAgICAgICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IGNvbG9yOwogICAgICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTsKICAgICAgICB0aGlzLmNvbnRleHQuZmlsbCgpOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiB0aGlzOwp9OwoKLyoqCiAqIEBjbGFzcyBXZWJHTCBSZW5kZXJlcgogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTLldlYkdMUmVuZGVyZXIgPSBmdW5jdGlvbigpIHsKICBGU1MuUmVuZGVyZXIuY2FsbCh0aGlzKTsKICB0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgogIC8vIFNldCBpbml0aWFsIHZlcnRleCBhbmQgbGlnaHQgY291bnQKICB0aGlzLnZlcnRpY2VzID0gbnVsbDsKICB0aGlzLmxpZ2h0cyA9IG51bGw7CgogIC8vIENyZWF0ZSBwYXJhbWV0ZXJzIG9iamVjdAogIHZhciBwYXJhbWV0ZXJzID0gewogICAgcHJlc2VydmVEcmF3aW5nQnVmZmVyOiBmYWxzZSwKICAgIHByZW11bHRpcGxpZWRBbHBoYTogdHJ1ZSwKICAgIGFudGlhbGlhczogdHJ1ZSwKICAgIHN0ZW5jaWw6IHRydWUsCiAgICBhbHBoYTogdHJ1ZQogIH07CgogIC8vIENyZWF0ZSBhbmQgY29uZmlndXJlIHRoZSBnbCBjb250ZXh0CiAgdGhpcy5nbCA9IHRoaXMuZ2V0Q29udGV4dCh0aGlzLmVsZW1lbnQsIHBhcmFtZXRlcnMpOwoKICAvLyBTZXQgdGhlIGludGVybmFsIHN1cHBvcnQgZmxhZwogIHRoaXMudW5zdXBwb3J0ZWQgPSAhdGhpcy5nbDsKCiAgLy8gU2V0dXAgcmVuZGVyZXIKICBpZiAodGhpcy51bnN1cHBvcnRlZCkgewogICAgcmV0dXJuICdXZWJHTCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3Nlci4nOwogIH0gZWxzZSB7CiAgICB0aGlzLmdsLmNsZWFyQ29sb3IoMC4wLCAwLjAsIDAuMCwgMC4wKTsKICAgIHRoaXMuZ2wuZW5hYmxlKHRoaXMuZ2wuREVQVEhfVEVTVCk7CiAgICB0aGlzLnNldFNpemUodGhpcy5lbGVtZW50LndpZHRoLCB0aGlzLmVsZW1lbnQuaGVpZ2h0KTsKICB9Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEZTUy5SZW5kZXJlci5wcm90b3R5cGUpOwoKRlNTLldlYkdMUmVuZGVyZXIucHJvdG90eXBlLmdldENvbnRleHQgPSBmdW5jdGlvbihjYW52YXMsIHBhcmFtZXRlcnMpIHsKICB2YXIgY29udGV4dCA9IGZhbHNlOwogIHRyeSB7CiAgICBpZiAoIShjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJ2V4cGVyaW1lbnRhbC13ZWJnbCcsIHBhcmFtZXRlcnMpKSkgewogICAgICB0aHJvdyAnRXJyb3IgY3JlYXRpbmcgV2ViR0wgY29udGV4dC4nOwogICAgfQogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICB9CiAgcmV0dXJuIGNvbnRleHQ7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc2V0U2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLnNldFNpemUuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KTsKICBpZiAodGhpcy51bnN1cHBvcnRlZCkgcmV0dXJuOwoKICAvLyBTZXQgdGhlIHNpemUgb2YgdGhlIGNhbnZhcyBlbGVtZW50CiAgdGhpcy5lbGVtZW50LndpZHRoID0gd2lkdGg7CiAgdGhpcy5lbGVtZW50LmhlaWdodCA9IGhlaWdodDsKCiAgLy8gU2V0IHRoZSBzaXplIG9mIHRoZSBnbCB2aWV3cG9ydAogIHRoaXMuZ2wudmlld3BvcnQoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgcmV0dXJuIHRoaXM7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLmNsZWFyLmNhbGwodGhpcyk7CiAgaWYgKHRoaXMudW5zdXBwb3J0ZWQpIHJldHVybjsKICB0aGlzLmdsLmNsZWFyKHRoaXMuZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IHRoaXMuZ2wuREVQVEhfQlVGRkVSX0JJVCk7CiAgcmV0dXJuIHRoaXM7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oc2NlbmUpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLnJlbmRlci5jYWxsKHRoaXMsIHNjZW5lKTsKICBpZiAodGhpcy51bnN1cHBvcnRlZCkgcmV0dXJuOwogIHZhciBtLG1lc2gsIHQsdGwsdHJpYW5nbGUsIGwsbGlnaHQsCiAgICAgIGF0dHJpYnV0ZSwgdW5pZm9ybSwgYnVmZmVyLCBkYXRhLCBsb2NhdGlvbiwKICAgICAgdXBkYXRlID0gZmFsc2UsIGxpZ2h0cyA9IHNjZW5lLmxpZ2h0cy5sZW5ndGgsCiAgICAgIGluZGV4LCB2LHZsLHZldGV4LHZlcnRpY2VzID0gMDsKCiAgLy8gQ2xlYXIgY29udGV4dAogIHRoaXMuY2xlYXIoKTsKCiAgLy8gQnVpbGQgdGhlIHNoYWRlciBwcm9ncmFtCiAgaWYgKHRoaXMubGlnaHRzICE9PSBsaWdodHMpIHsKICAgIHRoaXMubGlnaHRzID0gbGlnaHRzOwogICAgaWYgKHRoaXMubGlnaHRzID4gMCkgewogICAgICB0aGlzLmJ1aWxkUHJvZ3JhbShsaWdodHMpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuOwogICAgfQogIH0KCiAgLy8gVXBkYXRlIHByb2dyYW0KICBpZiAoISF0aGlzLnByb2dyYW0pIHsKCiAgICAvLyBJbmNyZW1lbnQgdmVydGV4IGNvdW50ZXIKICAgIGZvciAobSA9IHNjZW5lLm1lc2hlcy5sZW5ndGggLSAxOyBtID49IDA7IG0tLSkgewogICAgICBtZXNoID0gc2NlbmUubWVzaGVzW21dOwogICAgICBpZiAobWVzaC5nZW9tZXRyeS5kaXJ0eSkgdXBkYXRlID0gdHJ1ZTsKICAgICAgbWVzaC51cGRhdGUoc2NlbmUubGlnaHRzLCBmYWxzZSk7CiAgICAgIHZlcnRpY2VzICs9IG1lc2guZ2VvbWV0cnkudHJpYW5nbGVzLmxlbmd0aCozOwogICAgfQoKICAgIC8vIENvbXBhcmUgdmVydGV4IGNvdW50ZXIKICAgIGlmICh1cGRhdGUgfHwgdGhpcy52ZXJ0aWNlcyAhPT0gdmVydGljZXMpIHsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwoKICAgICAgLy8gQnVpbGQgYnVmZmVycwogICAgICBmb3IgKGF0dHJpYnV0ZSBpbiB0aGlzLnByb2dyYW0uYXR0cmlidXRlcykgewogICAgICAgIGJ1ZmZlciA9IHRoaXMucHJvZ3JhbS5hdHRyaWJ1dGVzW2F0dHJpYnV0ZV07CiAgICAgICAgYnVmZmVyLmRhdGEgPSBuZXcgRlNTLkFycmF5KHZlcnRpY2VzKmJ1ZmZlci5zaXplKTsKCiAgICAgICAgLy8gUmVzZXQgdmVydGV4IGluZGV4CiAgICAgICAgaW5kZXggPSAwOwoKICAgICAgICAvLyBVcGRhdGUgYXR0cmlidXRlIGJ1ZmZlciBkYXRhCiAgICAgICAgZm9yIChtID0gc2NlbmUubWVzaGVzLmxlbmd0aCAtIDE7IG0gPj0gMDsgbS0tKSB7CiAgICAgICAgICBtZXNoID0gc2NlbmUubWVzaGVzW21dOwoKICAgICAgICAgIGZvciAodCA9IDAsIHRsID0gbWVzaC5nZW9tZXRyeS50cmlhbmdsZXMubGVuZ3RoOyB0IDwgdGw7IHQrKykgewogICAgICAgICAgICB0cmlhbmdsZSA9IG1lc2guZ2VvbWV0cnkudHJpYW5nbGVzW3RdOwoKICAgICAgICAgICAgZm9yICh2ID0gMCwgdmwgPSB0cmlhbmdsZS52ZXJ0aWNlcy5sZW5ndGg7IHYgPCB2bDsgdisrKSB7CiAgICAgICAgICAgICAgdmVydGV4ID0gdHJpYW5nbGUudmVydGljZXNbdl07CiAgICAgICAgICAgICAgc3dpdGNoIChhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3NpZGUnOgogICAgICAgICAgICAgICAgICB0aGlzLnNldEJ1ZmZlckRhdGEoaW5kZXgsIGJ1ZmZlciwgbWVzaC5zaWRlKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdwb3NpdGlvbic6CiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QnVmZmVyRGF0YShpbmRleCwgYnVmZmVyLCB2ZXJ0ZXgucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2NlbnRyb2lkJzoKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRCdWZmZXJEYXRhKGluZGV4LCBidWZmZXIsIHRyaWFuZ2xlLmNlbnRyb2lkKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdub3JtYWwnOgogICAgICAgICAgICAgICAgICB0aGlzLnNldEJ1ZmZlckRhdGEoaW5kZXgsIGJ1ZmZlciwgdHJpYW5nbGUubm9ybWFsKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdhbWJpZW50JzoKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRCdWZmZXJEYXRhKGluZGV4LCBidWZmZXIsIG1lc2gubWF0ZXJpYWwuYW1iaWVudC5yZ2JhKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdkaWZmdXNlJzoKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRCdWZmZXJEYXRhKGluZGV4LCBidWZmZXIsIG1lc2gubWF0ZXJpYWwuZGlmZnVzZS5yZ2JhKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFVwbG9hZCBhdHRyaWJ1dGUgYnVmZmVyIGRhdGEKICAgICAgICB0aGlzLmdsLmJpbmRCdWZmZXIodGhpcy5nbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlci5idWZmZXIpOwogICAgICAgIHRoaXMuZ2wuYnVmZmVyRGF0YSh0aGlzLmdsLkFSUkFZX0JVRkZFUiwgYnVmZmVyLmRhdGEsIHRoaXMuZ2wuRFlOQU1JQ19EUkFXKTsKICAgICAgICB0aGlzLmdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGJ1ZmZlci5sb2NhdGlvbik7CiAgICAgICAgdGhpcy5nbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGJ1ZmZlci5sb2NhdGlvbiwgYnVmZmVyLnNpemUsIHRoaXMuZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTsKICAgICAgfQogICAgfQoKICAgIC8vIEJ1aWxkIHVuaWZvcm0gYnVmZmVycwogICAgdGhpcy5zZXRCdWZmZXJEYXRhKDAsIHRoaXMucHJvZ3JhbS51bmlmb3Jtcy5yZXNvbHV0aW9uLCBbdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIHRoaXMud2lkdGhdKTsKICAgIGZvciAobCA9IGxpZ2h0cy0xOyBsID49IDA7IGwtLSkgewogICAgICBsaWdodCA9IHNjZW5lLmxpZ2h0c1tsXTsKICAgICAgdGhpcy5zZXRCdWZmZXJEYXRhKGwsIHRoaXMucHJvZ3JhbS51bmlmb3Jtcy5saWdodFBvc2l0aW9uLCBsaWdodC5wb3NpdGlvbik7CiAgICAgIHRoaXMuc2V0QnVmZmVyRGF0YShsLCB0aGlzLnByb2dyYW0udW5pZm9ybXMubGlnaHRBbWJpZW50LCBsaWdodC5hbWJpZW50LnJnYmEpOwogICAgICB0aGlzLnNldEJ1ZmZlckRhdGEobCwgdGhpcy5wcm9ncmFtLnVuaWZvcm1zLmxpZ2h0RGlmZnVzZSwgbGlnaHQuZGlmZnVzZS5yZ2JhKTsKICAgIH0KCiAgICAvLyBVcGRhdGUgdW5pZm9ybXMKICAgIGZvciAodW5pZm9ybSBpbiB0aGlzLnByb2dyYW0udW5pZm9ybXMpIHsKICAgICAgYnVmZmVyID0gdGhpcy5wcm9ncmFtLnVuaWZvcm1zW3VuaWZvcm1dOwogICAgICBsb2NhdGlvbiA9IGJ1ZmZlci5sb2NhdGlvbjsKICAgICAgZGF0YSA9IGJ1ZmZlci5kYXRhOwogICAgICBzd2l0Y2ggKGJ1ZmZlci5zdHJ1Y3R1cmUpIHsKICAgICAgICBjYXNlICczZic6CiAgICAgICAgICB0aGlzLmdsLnVuaWZvcm0zZihsb2NhdGlvbiwgZGF0YVswXSwgZGF0YVsxXSwgZGF0YVsyXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICczZnYnOgogICAgICAgICAgdGhpcy5nbC51bmlmb3JtM2Z2KGxvY2F0aW9uLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJzRmdic6CiAgICAgICAgICB0aGlzLmdsLnVuaWZvcm00ZnYobG9jYXRpb24sIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIERyYXcgdGhvc2UgbG92ZWx5IHRyaWFuZ2xlcwogIHRoaXMuZ2wuZHJhd0FycmF5cyh0aGlzLmdsLlRSSUFOR0xFUywgMCwgdGhpcy52ZXJ0aWNlcyk7CiAgcmV0dXJuIHRoaXM7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc2V0QnVmZmVyRGF0YSA9IGZ1bmN0aW9uKGluZGV4LCBidWZmZXIsIHZhbHVlKSB7CiAgaWYgKEZTUy5VdGlscy5pc051bWJlcih2YWx1ZSkpIHsKICAgIGJ1ZmZlci5kYXRhW2luZGV4KmJ1ZmZlci5zaXplXSA9IHZhbHVlOwogIH0gZWxzZSB7CiAgICBmb3IgKHZhciBpID0gdmFsdWUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgYnVmZmVyLmRhdGFbaW5kZXgqYnVmZmVyLnNpemUraV0gPSB2YWx1ZVtpXTsKICAgIH0KICB9Cn07CgovKioKICogQ29uY2VwdHMgdGFrZW4gZnJvbSB0aHJlZS5qcyBXZWJHTFJlbmRlcmVyCiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi90aHJlZS5qcy9ibG9iL21hc3Rlci9zcmMvcmVuZGVyZXJzL1dlYkdMUmVuZGVyZXIuanMKICovCkZTUy5XZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5idWlsZFByb2dyYW0gPSBmdW5jdGlvbihsaWdodHMpIHsKICBpZiAodGhpcy51bnN1cHBvcnRlZCkgcmV0dXJuOwoKICAvLyBDcmVhdGUgc2hhZGVyIHNvdXJjZQogIHZhciB2cyA9IEZTUy5XZWJHTFJlbmRlcmVyLlZTKGxpZ2h0cyk7CiAgdmFyIGZzID0gRlNTLldlYkdMUmVuZGVyZXIuRlMobGlnaHRzKTsKCiAgLy8gRGVyaXZlIHRoZSBzaGFkZXIgZmluZ2VycHJpbnQKICB2YXIgY29kZSA9IHZzICsgZnM7CgogIC8vIENoZWNrIGlmIHRoZSBwcm9ncmFtIGhhcyBhbHJlYWR5IGJlZW4gY29tcGlsZWQKICBpZiAoISF0aGlzLnByb2dyYW0gJiYgdGhpcy5wcm9ncmFtLmNvZGUgPT09IGNvZGUpIHJldHVybjsKCiAgLy8gQ3JlYXRlIHRoZSBwcm9ncmFtIGFuZCBzaGFkZXJzCiAgdmFyIHByb2dyYW0gPSB0aGlzLmdsLmNyZWF0ZVByb2dyYW0oKTsKICB2YXIgdmVydGV4U2hhZGVyID0gdGhpcy5idWlsZFNoYWRlcih0aGlzLmdsLlZFUlRFWF9TSEFERVIsIHZzKTsKICB2YXIgZnJhZ21lbnRTaGFkZXIgPSB0aGlzLmJ1aWxkU2hhZGVyKHRoaXMuZ2wuRlJBR01FTlRfU0hBREVSLCBmcyk7CgogIC8vIEF0dGFjaCBhbiBsaW5rIHRoZSBzaGFkZXIKICB0aGlzLmdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2ZXJ0ZXhTaGFkZXIpOwogIHRoaXMuZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZyYWdtZW50U2hhZGVyKTsKICB0aGlzLmdsLmxpbmtQcm9ncmFtKHByb2dyYW0pOwoKICAvLyBBZGQgZXJyb3IgaGFuZGxpbmcKICBpZiAoIXRoaXMuZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCB0aGlzLmdsLkxJTktfU1RBVFVTKSkgewogICAgdmFyIGVycm9yID0gdGhpcy5nbC5nZXRFcnJvcigpOwogICAgdmFyIHN0YXR1cyA9IHRoaXMuZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCB0aGlzLmdsLlZBTElEQVRFX1NUQVRVUyk7CiAgICBjb25zb2xlLmVycm9yKCdDb3VsZCBub3QgaW5pdGlhbGlzZSBzaGFkZXIuXG5WQUxJREFURV9TVEFUVVM6ICcrc3RhdHVzKydcbkVSUk9SOiAnK2Vycm9yKTsKICAgIHJldHVybiBudWxsOwogIH0KCiAgLy8gRGVsZXRlIHRoZSBzaGFkZXIKICB0aGlzLmdsLmRlbGV0ZVNoYWRlcihmcmFnbWVudFNoYWRlcik7CiAgdGhpcy5nbC5kZWxldGVTaGFkZXIodmVydGV4U2hhZGVyKTsKCiAgLy8gU2V0IHRoZSBwcm9ncmFtIGNvZGUKICBwcm9ncmFtLmNvZGUgPSBjb2RlOwoKICAvLyBBZGQgdGhlIHByb2dyYW0gYXR0cmlidXRlcwogIHByb2dyYW0uYXR0cmlidXRlcyA9IHsKICAgIHNpZGU6ICAgICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICdhdHRyaWJ1dGUnLCAnYVNpZGUnLCAgICAgMSwgJ2YnICksCiAgICBwb3NpdGlvbjogdGhpcy5idWlsZEJ1ZmZlcihwcm9ncmFtLCAnYXR0cmlidXRlJywgJ2FQb3NpdGlvbicsIDMsICd2MycpLAogICAgY2VudHJvaWQ6IHRoaXMuYnVpbGRCdWZmZXIocHJvZ3JhbSwgJ2F0dHJpYnV0ZScsICdhQ2VudHJvaWQnLCAzLCAndjMnKSwKICAgIG5vcm1hbDogICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICdhdHRyaWJ1dGUnLCAnYU5vcm1hbCcsICAgMywgJ3YzJyksCiAgICBhbWJpZW50OiAgdGhpcy5idWlsZEJ1ZmZlcihwcm9ncmFtLCAnYXR0cmlidXRlJywgJ2FBbWJpZW50JywgIDQsICd2NCcpLAogICAgZGlmZnVzZTogIHRoaXMuYnVpbGRCdWZmZXIocHJvZ3JhbSwgJ2F0dHJpYnV0ZScsICdhRGlmZnVzZScsICA0LCAndjQnKQogIH07CgogIC8vIEFkZCB0aGUgcHJvZ3JhbSB1bmlmb3JtcwogIHByb2dyYW0udW5pZm9ybXMgPSB7CiAgICByZXNvbHV0aW9uOiAgICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICd1bmlmb3JtJywgJ3VSZXNvbHV0aW9uJywgICAgMywgJzNmJywgIDEgICAgICksCiAgICBsaWdodFBvc2l0aW9uOiB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICd1bmlmb3JtJywgJ3VMaWdodFBvc2l0aW9uJywgMywgJzNmdicsIGxpZ2h0cyksCiAgICBsaWdodEFtYmllbnQ6ICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICd1bmlmb3JtJywgJ3VMaWdodEFtYmllbnQnLCAgNCwgJzRmdicsIGxpZ2h0cyksCiAgICBsaWdodERpZmZ1c2U6ICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICd1bmlmb3JtJywgJ3VMaWdodERpZmZ1c2UnLCAgNCwgJzRmdicsIGxpZ2h0cykKICB9OwoKICAvLyBTZXQgdGhlIHJlbmRlcmVyIHByb2dyYW0KICB0aGlzLnByb2dyYW0gPSBwcm9ncmFtOwoKICAvLyBFbmFibGUgcHJvZ3JhbQogIHRoaXMuZ2wudXNlUHJvZ3JhbSh0aGlzLnByb2dyYW0pOwoKICAvLyBSZXR1cm4gdGhlIHByb2dyYW0KICByZXR1cm4gcHJvZ3JhbTsKfTsKCkZTUy5XZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5idWlsZFNoYWRlciA9IGZ1bmN0aW9uKHR5cGUsIHNvdXJjZSkgewogIGlmICh0aGlzLnVuc3VwcG9ydGVkKSByZXR1cm47CgogIC8vIENyZWF0ZSBhbmQgY29tcGlsZSBzaGFkZXIKICB2YXIgc2hhZGVyID0gdGhpcy5nbC5jcmVhdGVTaGFkZXIodHlwZSk7CiAgdGhpcy5nbC5zaGFkZXJTb3VyY2Uoc2hhZGVyLCBzb3VyY2UpOwogIHRoaXMuZ2wuY29tcGlsZVNoYWRlcihzaGFkZXIpOwoKICAvLyBBZGQgZXJyb3IgaGFuZGxpbmcKICBpZiAoIXRoaXMuZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKHNoYWRlciwgdGhpcy5nbC5DT01QSUxFX1NUQVRVUykpIHsKICAgIGNvbnNvbGUuZXJyb3IodGhpcy5nbC5nZXRTaGFkZXJJbmZvTG9nKHNoYWRlcikpOwogICAgcmV0dXJuIG51bGw7CiAgfQoKICAvLyBSZXR1cm4gdGhlIHNoYWRlcgogIHJldHVybiBzaGFkZXI7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuYnVpbGRCdWZmZXIgPSBmdW5jdGlvbihwcm9ncmFtLCB0eXBlLCBpZGVudGlmaWVyLCBzaXplLCBzdHJ1Y3R1cmUsIGNvdW50KSB7CiAgdmFyIGJ1ZmZlciA9IHtidWZmZXI6dGhpcy5nbC5jcmVhdGVCdWZmZXIoKSwgc2l6ZTpzaXplLCBzdHJ1Y3R1cmU6c3RydWN0dXJlLCBkYXRhOm51bGx9OwoKICAvLyBTZXQgdGhlIGxvY2F0aW9uCiAgc3dpdGNoICh0eXBlKSB7CiAgICBjYXNlICdhdHRyaWJ1dGUnOgogICAgICBidWZmZXIubG9jYXRpb24gPSB0aGlzLmdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIGlkZW50aWZpZXIpOwogICAgICBicmVhazsKICAgIGNhc2UgJ3VuaWZvcm0nOgogICAgICBidWZmZXIubG9jYXRpb24gPSB0aGlzLmdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBpZGVudGlmaWVyKTsKICAgICAgYnJlYWs7CiAgfQoKICAvLyBDcmVhdGUgdGhlIGJ1ZmZlciBpZiBjb3VudCBpcyBwcm92aWRlZAogIGlmICghIWNvdW50KSB7CiAgICBidWZmZXIuZGF0YSA9IG5ldyBGU1MuQXJyYXkoY291bnQqc2l6ZSk7CiAgfQoKICAvLyBSZXR1cm4gdGhlIGJ1ZmZlcgogIHJldHVybiBidWZmZXI7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5WUyA9IGZ1bmN0aW9uKGxpZ2h0cykgewogIHZhciBzaGFkZXIgPSBbCgogIC8vIFByZWNpc2lvbgogICdwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLAoKICAvLyBMaWdodHMKICAnI2RlZmluZSBMSUdIVFMgJyArIGxpZ2h0cywKCiAgLy8gQXR0cmlidXRlcwogICdhdHRyaWJ1dGUgZmxvYXQgYVNpZGU7JywKICAnYXR0cmlidXRlIHZlYzMgYVBvc2l0aW9uOycsCiAgJ2F0dHJpYnV0ZSB2ZWMzIGFDZW50cm9pZDsnLAogICdhdHRyaWJ1dGUgdmVjMyBhTm9ybWFsOycsCiAgJ2F0dHJpYnV0ZSB2ZWM0IGFBbWJpZW50OycsCiAgJ2F0dHJpYnV0ZSB2ZWM0IGFEaWZmdXNlOycsCgogIC8vIFVuaWZvcm1zCiAgJ3VuaWZvcm0gdmVjMyB1UmVzb2x1dGlvbjsnLAogICd1bmlmb3JtIHZlYzMgdUxpZ2h0UG9zaXRpb25bTElHSFRTXTsnLAogICd1bmlmb3JtIHZlYzQgdUxpZ2h0QW1iaWVudFtMSUdIVFNdOycsCiAgJ3VuaWZvcm0gdmVjNCB1TGlnaHREaWZmdXNlW0xJR0hUU107JywKCiAgLy8gVmFyeWluZ3MKICAndmFyeWluZyB2ZWM0IHZDb2xvcjsnLAoKICAvLyBNYWluCiAgJ3ZvaWQgbWFpbigpIHsnLAoKICAgIC8vIENyZWF0ZSBjb2xvcgogICAgJ3ZDb2xvciA9IHZlYzQoMC4wKTsnLAoKICAgIC8vIENhbGN1bGF0ZSB0aGUgdmVydGV4IHBvc2l0aW9uCiAgICAndmVjMyBwb3NpdGlvbiA9IGFQb3NpdGlvbiAvIHVSZXNvbHV0aW9uICogMi4wOycsCgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGxpZ2h0cwogICAgJ2ZvciAoaW50IGkgPSAwOyBpIDwgTElHSFRTOyBpKyspIHsnLAogICAgICAndmVjMyBsaWdodFBvc2l0aW9uID0gdUxpZ2h0UG9zaXRpb25baV07JywKICAgICAgJ3ZlYzQgbGlnaHRBbWJpZW50ID0gdUxpZ2h0QW1iaWVudFtpXTsnLAogICAgICAndmVjNCBsaWdodERpZmZ1c2UgPSB1TGlnaHREaWZmdXNlW2ldOycsCgogICAgICAvLyBDYWxjdWxhdGUgaWxsdW1pbmFuY2UKICAgICAgJ3ZlYzMgcmF5ID0gbm9ybWFsaXplKGxpZ2h0UG9zaXRpb24gLSBhQ2VudHJvaWQpOycsCiAgICAgICdmbG9hdCBpbGx1bWluYW5jZSA9IGRvdChhTm9ybWFsLCByYXkpOycsCiAgICAgICdpZiAoYVNpZGUgPT0gMC4wKSB7JywKICAgICAgICAnaWxsdW1pbmFuY2UgPSBtYXgoaWxsdW1pbmFuY2UsIDAuMCk7JywKICAgICAgJ30gZWxzZSBpZiAoYVNpZGUgPT0gMS4wKSB7JywKICAgICAgICAnaWxsdW1pbmFuY2UgPSBhYnMobWluKGlsbHVtaW5hbmNlLCAwLjApKTsnLAogICAgICAnfSBlbHNlIGlmIChhU2lkZSA9PSAyLjApIHsnLAogICAgICAgICdpbGx1bWluYW5jZSA9IG1heChhYnMoaWxsdW1pbmFuY2UpLCAwLjApOycsCiAgICAgICd9JywKCiAgICAgIC8vIENhbGN1bGF0ZSBhbWJpZW50IGxpZ2h0CiAgICAgICd2Q29sb3IgKz0gYUFtYmllbnQgKiBsaWdodEFtYmllbnQ7JywKCiAgICAgIC8vIENhbGN1bGF0ZSBkaWZmdXNlIGxpZ2h0CiAgICAgICd2Q29sb3IgKz0gYURpZmZ1c2UgKiBsaWdodERpZmZ1c2UgKiBpbGx1bWluYW5jZTsnLAogICAgJ30nLAoKICAgIC8vIENsYW1wIGNvbG9yCiAgICAndkNvbG9yID0gY2xhbXAodkNvbG9yLCAwLjAsIDEuMCk7JywKCiAgICAvLyBTZXQgZ2xfUG9zaXRpb24KICAgICdnbF9Qb3NpdGlvbiA9IHZlYzQocG9zaXRpb24sIDEuMCk7JywKCiAgJ30nCgogIC8vIFJldHVybiB0aGUgc2hhZGVyCiAgXS5qb2luKCdcbicpOwogIHJldHVybiBzaGFkZXI7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5GUyA9IGZ1bmN0aW9uKGxpZ2h0cykgewogIHZhciBzaGFkZXIgPSBbCgogIC8vIFByZWNpc2lvbgogICdwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLAoKICAvLyBWYXJ5aW5ncwogICd2YXJ5aW5nIHZlYzQgdkNvbG9yOycsCgogIC8vIE1haW4KICAndm9pZCBtYWluKCkgeycsCgogICAgLy8gU2V0IGdsX0ZyYWdDb2xvcgogICAgJ2dsX0ZyYWdDb2xvciA9IHZDb2xvcjsnLAoKICAnfScKCiAgLy8gUmV0dXJuIHRoZSBzaGFkZXIKICBdLmpvaW4oJ1xuJyk7CiAgcmV0dXJuIHNoYWRlcjsKfTsKCi8qKgogKiBAY2xhc3MgU1ZHIFJlbmRlcmVyCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuU1ZHUmVuZGVyZXIgPSBmdW5jdGlvbigpIHsKICBGU1MuUmVuZGVyZXIuY2FsbCh0aGlzKTsKICB0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoRlNTLlNWR05TLCAnc3ZnJyk7CiAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgneG1sbnMnLCBGU1MuU1ZHTlMpOwogIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3ZlcnNpb24nLCAnMS4xJyk7CiAgdGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIHRoaXMuc2V0U2l6ZSgzMDAsIDE1MCk7Cn07CgpGU1MuU1ZHUmVuZGVyZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShGU1MuUmVuZGVyZXIucHJvdG90eXBlKTsKCkZTUy5TVkdSZW5kZXJlci5wcm90b3R5cGUuc2V0U2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLnNldFNpemUuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KTsKICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCd3aWR0aCcsIHdpZHRoKTsKICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBoZWlnaHQpOwogIHJldHVybiB0aGlzOwp9OwoKRlNTLlNWR1JlbmRlcmVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkgewogIEZTUy5SZW5kZXJlci5wcm90b3R5cGUuY2xlYXIuY2FsbCh0aGlzKTsKICBmb3IgKHZhciBpID0gdGhpcy5lbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQuY2hpbGROb2Rlc1tpXSk7CiAgfQogIHJldHVybiB0aGlzOwp9OwoKRlNTLlNWR1JlbmRlcmVyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbihzY2VuZSkgewogIEZTUy5SZW5kZXJlci5wcm90b3R5cGUucmVuZGVyLmNhbGwodGhpcywgc2NlbmUpOwogIHZhciBtLG1lc2gsIHQsdHJpYW5nbGUsIHBvaW50cywgc3R5bGU7CgogIC8vIFVwZGF0ZSBNZXNoZXMKICBmb3IgKG0gPSBzY2VuZS5tZXNoZXMubGVuZ3RoIC0gMTsgbSA+PSAwOyBtLS0pIHsKICAgIG1lc2ggPSBzY2VuZS5tZXNoZXNbbV07CiAgICBpZiAobWVzaC52aXNpYmxlKSB7CiAgICAgIG1lc2gudXBkYXRlKHNjZW5lLmxpZ2h0cywgdHJ1ZSk7CgogICAgICAvLyBSZW5kZXIgVHJpYW5nbGVzCiAgICAgIGZvciAodCA9IG1lc2guZ2VvbWV0cnkudHJpYW5nbGVzLmxlbmd0aCAtIDE7IHQgPj0gMDsgdC0tKSB7CiAgICAgICAgdHJpYW5nbGUgPSBtZXNoLmdlb21ldHJ5LnRyaWFuZ2xlc1t0XTsKICAgICAgICBpZiAodHJpYW5nbGUucG9seWdvbi5wYXJlbnROb2RlICE9PSB0aGlzLmVsZW1lbnQpIHsKICAgICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0cmlhbmdsZS5wb2x5Z29uKTsKICAgICAgICB9CiAgICAgICAgcG9pbnRzICA9IHRoaXMuZm9ybWF0UG9pbnQodHJpYW5nbGUuYSkrJyAnOwogICAgICAgIHBvaW50cyArPSB0aGlzLmZvcm1hdFBvaW50KHRyaWFuZ2xlLmIpKycgJzsKICAgICAgICBwb2ludHMgKz0gdGhpcy5mb3JtYXRQb2ludCh0cmlhbmdsZS5jKTsKICAgICAgICBzdHlsZSA9IHRoaXMuZm9ybWF0U3R5bGUodHJpYW5nbGUuY29sb3IuZm9ybWF0KCkpOwogICAgICAgIHRyaWFuZ2xlLnBvbHlnb24uc2V0QXR0cmlidXRlTlMobnVsbCwgJ3BvaW50cycsIHBvaW50cyk7CiAgICAgICAgdHJpYW5nbGUucG9seWdvbi5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnc3R5bGUnLCBzdHlsZSk7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIHRoaXM7Cn07CgpGU1MuU1ZHUmVuZGVyZXIucHJvdG90eXBlLmZvcm1hdFBvaW50ID0gZnVuY3Rpb24odmVydGV4KSB7CiAgcmV0dXJuICh0aGlzLmhhbGZXaWR0aCt2ZXJ0ZXgucG9zaXRpb25bMF0pKycsJysodGhpcy5oYWxmSGVpZ2h0LXZlcnRleC5wb3NpdGlvblsxXSk7Cn07CgpGU1MuU1ZHUmVuZGVyZXIucHJvdG90eXBlLmZvcm1hdFN0eWxlID0gZnVuY3Rpb24oY29sb3IpIHsKICB2YXIgc3R5bGUgPSAnZmlsbDonK2NvbG9yKyc7JzsKICBzdHlsZSArPSAnc3Ryb2tlOicrY29sb3IrJzsnOwogIHJldHVybiBzdHlsZTsKfTsKCi8qKgogKiBkYXQtZ3VpIEphdmFTY3JpcHQgQ29udHJvbGxlciBMaWJyYXJ5CiAqIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9kYXQtZ3VpCiAqCiAqIENvcHlyaWdodCAyMDExIERhdGEgQXJ0cyBUZWFtLCBHb29nbGUgQ3JlYXRpdmUgTGFiCiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICovCnZhciBkYXQ9ZGF0fHx7fTtkYXQuZ3VpPWRhdC5ndWl8fHt9O2RhdC51dGlscz1kYXQudXRpbHN8fHt9O2RhdC5jb250cm9sbGVycz1kYXQuY29udHJvbGxlcnN8fHt9O2RhdC5kb209ZGF0LmRvbXx8e307ZGF0LmNvbG9yPWRhdC5jb2xvcnx8e307ZGF0LnV0aWxzLmNzcz1mdW5jdGlvbigpe3JldHVybntsb2FkOmZ1bmN0aW9uKGUsYSl7dmFyIGE9YXx8ZG9jdW1lbnQsYz1hLmNyZWF0ZUVsZW1lbnQoImxpbmsiKTtjLnR5cGU9InRleHQvY3NzIjtjLnJlbD0ic3R5bGVzaGVldCI7Yy5ocmVmPWU7YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdLmFwcGVuZENoaWxkKGMpfSxpbmplY3Q6ZnVuY3Rpb24oZSxhKXt2YXIgYT1hfHxkb2N1bWVudCxjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7Yy50eXBlPSJ0ZXh0L2NzcyI7Yy5pbm5lckhUTUw9ZTthLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0uYXBwZW5kQ2hpbGQoYyl9fX0oKTsKZGF0LnV0aWxzLmNvbW1vbj1mdW5jdGlvbigpe3ZhciBlPUFycmF5LnByb3RvdHlwZS5mb3JFYWNoLGE9QXJyYXkucHJvdG90eXBlLnNsaWNlO3JldHVybntCUkVBSzp7fSxleHRlbmQ6ZnVuY3Rpb24oYyl7dGhpcy5lYWNoKGEuY2FsbChhcmd1bWVudHMsMSksZnVuY3Rpb24oYSl7Zm9yKHZhciBmIGluIGEpdGhpcy5pc1VuZGVmaW5lZChhW2ZdKXx8KGNbZl09YVtmXSl9LHRoaXMpO3JldHVybiBjfSxkZWZhdWx0czpmdW5jdGlvbihjKXt0aGlzLmVhY2goYS5jYWxsKGFyZ3VtZW50cywxKSxmdW5jdGlvbihhKXtmb3IodmFyIGYgaW4gYSl0aGlzLmlzVW5kZWZpbmVkKGNbZl0pJiYoY1tmXT1hW2ZdKX0sdGhpcyk7cmV0dXJuIGN9LGNvbXBvc2U6ZnVuY3Rpb24oKXt2YXIgYz1hLmNhbGwoYXJndW1lbnRzKTtyZXR1cm4gZnVuY3Rpb24oKXtmb3IodmFyIGQ9YS5jYWxsKGFyZ3VtZW50cyksZj1jLmxlbmd0aC0xO2Y+PTA7Zi0tKWQ9W2NbZl0uYXBwbHkodGhpcyxkKV07cmV0dXJuIGRbMF19fSwKZWFjaDpmdW5jdGlvbihhLGQsZil7aWYoZSYmYS5mb3JFYWNoPT09ZSlhLmZvckVhY2goZCxmKTtlbHNlIGlmKGEubGVuZ3RoPT09YS5sZW5ndGgrMClmb3IodmFyIGI9MCxuPWEubGVuZ3RoO2I8bjtiKyspe2lmKGIgaW4gYSYmZC5jYWxsKGYsYVtiXSxiKT09PXRoaXMuQlJFQUspYnJlYWt9ZWxzZSBmb3IoYiBpbiBhKWlmKGQuY2FsbChmLGFbYl0sYik9PT10aGlzLkJSRUFLKWJyZWFrfSxkZWZlcjpmdW5jdGlvbihhKXtzZXRUaW1lb3V0KGEsMCl9LHRvQXJyYXk6ZnVuY3Rpb24oYyl7cmV0dXJuIGMudG9BcnJheT9jLnRvQXJyYXkoKTphLmNhbGwoYyl9LGlzVW5kZWZpbmVkOmZ1bmN0aW9uKGEpe3JldHVybiBhPT09dm9pZCAwfSxpc051bGw6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1udWxsfSxpc05hTjpmdW5jdGlvbihhKXtyZXR1cm4gYSE9PWF9LGlzQXJyYXk6QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuIGEuY29uc3RydWN0b3I9PT1BcnJheX0saXNPYmplY3Q6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT0KT2JqZWN0KGEpfSxpc051bWJlcjpmdW5jdGlvbihhKXtyZXR1cm4gYT09PWErMH0saXNTdHJpbmc6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1hKyIifSxpc0Jvb2xlYW46ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1mYWxzZXx8YT09PXRydWV9LGlzRnVuY3Rpb246ZnVuY3Rpb24oYSl7cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhKT09PSJbb2JqZWN0IEZ1bmN0aW9uXSJ9fX0oKTsKZGF0LmNvbnRyb2xsZXJzLkNvbnRyb2xsZXI9ZnVuY3Rpb24oZSl7dmFyIGE9ZnVuY3Rpb24oYSxkKXt0aGlzLmluaXRpYWxWYWx1ZT1hW2RdO3RoaXMuZG9tRWxlbWVudD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLm9iamVjdD1hO3RoaXMucHJvcGVydHk9ZDt0aGlzLl9fb25GaW5pc2hDaGFuZ2U9dGhpcy5fX29uQ2hhbmdlPXZvaWQgMH07ZS5leHRlbmQoYS5wcm90b3R5cGUse29uQ2hhbmdlOmZ1bmN0aW9uKGEpe3RoaXMuX19vbkNoYW5nZT1hO3JldHVybiB0aGlzfSxvbkZpbmlzaENoYW5nZTpmdW5jdGlvbihhKXt0aGlzLl9fb25GaW5pc2hDaGFuZ2U9YTtyZXR1cm4gdGhpc30sc2V0VmFsdWU6ZnVuY3Rpb24oYSl7dGhpcy5vYmplY3RbdGhpcy5wcm9wZXJ0eV09YTt0aGlzLl9fb25DaGFuZ2UmJnRoaXMuX19vbkNoYW5nZS5jYWxsKHRoaXMsYSk7dGhpcy51cGRhdGVEaXNwbGF5KCk7cmV0dXJuIHRoaXN9LGdldFZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub2JqZWN0W3RoaXMucHJvcGVydHldfSwKdXBkYXRlRGlzcGxheTpmdW5jdGlvbigpe3JldHVybiB0aGlzfSxpc01vZGlmaWVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW5pdGlhbFZhbHVlIT09dGhpcy5nZXRWYWx1ZSgpfX0pO3JldHVybiBhfShkYXQudXRpbHMuY29tbW9uKTsKZGF0LmRvbS5kb209ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gYShiKXtpZihiPT09IjAifHxlLmlzVW5kZWZpbmVkKGIpKXJldHVybiAwO2I9Yi5tYXRjaChkKTtyZXR1cm4hZS5pc051bGwoYik/cGFyc2VGbG9hdChiWzFdKTowfXZhciBjPXt9O2UuZWFjaCh7SFRNTEV2ZW50czpbImNoYW5nZSJdLE1vdXNlRXZlbnRzOlsiY2xpY2siLCJtb3VzZW1vdmUiLCJtb3VzZWRvd24iLCJtb3VzZXVwIiwibW91c2VvdmVyIl0sS2V5Ym9hcmRFdmVudHM6WyJrZXlkb3duIl19LGZ1bmN0aW9uKGIsYSl7ZS5lYWNoKGIsZnVuY3Rpb24oYil7Y1tiXT1hfSl9KTt2YXIgZD0vKFxkKyhcLlxkKyk/KXB4LyxmPXttYWtlU2VsZWN0YWJsZTpmdW5jdGlvbihiLGEpe2lmKCEoYj09PXZvaWQgMHx8Yi5zdHlsZT09PXZvaWQgMCkpYi5vbnNlbGVjdHN0YXJ0PWE/ZnVuY3Rpb24oKXtyZXR1cm4gZmFsc2V9OmZ1bmN0aW9uKCl7fSxiLnN0eWxlLk1velVzZXJTZWxlY3Q9YT8iYXV0byI6Im5vbmUiLGIuc3R5bGUuS2h0bWxVc2VyU2VsZWN0PQphPyJhdXRvIjoibm9uZSIsYi51bnNlbGVjdGFibGU9YT8ib24iOiJvZmYifSxtYWtlRnVsbHNjcmVlbjpmdW5jdGlvbihiLGEsZCl7ZS5pc1VuZGVmaW5lZChhKSYmKGE9dHJ1ZSk7ZS5pc1VuZGVmaW5lZChkKSYmKGQ9dHJ1ZSk7Yi5zdHlsZS5wb3NpdGlvbj0iYWJzb2x1dGUiO2lmKGEpYi5zdHlsZS5sZWZ0PTAsYi5zdHlsZS5yaWdodD0wO2lmKGQpYi5zdHlsZS50b3A9MCxiLnN0eWxlLmJvdHRvbT0wfSxmYWtlRXZlbnQ6ZnVuY3Rpb24oYixhLGQsZil7dmFyIGQ9ZHx8e30sbT1jW2FdO2lmKCFtKXRocm93IEVycm9yKCJFdmVudCB0eXBlICIrYSsiIG5vdCBzdXBwb3J0ZWQuIik7dmFyIGw9ZG9jdW1lbnQuY3JlYXRlRXZlbnQobSk7c3dpdGNoKG0pe2Nhc2UgIk1vdXNlRXZlbnRzIjpsLmluaXRNb3VzZUV2ZW50KGEsZC5idWJibGVzfHxmYWxzZSxkLmNhbmNlbGFibGV8fHRydWUsd2luZG93LGQuY2xpY2tDb3VudHx8MSwwLDAsZC54fHxkLmNsaWVudFh8fDAsZC55fHxkLmNsaWVudFl8fAowLGZhbHNlLGZhbHNlLGZhbHNlLGZhbHNlLDAsbnVsbCk7YnJlYWs7Y2FzZSAiS2V5Ym9hcmRFdmVudHMiOm09bC5pbml0S2V5Ym9hcmRFdmVudHx8bC5pbml0S2V5RXZlbnQ7ZS5kZWZhdWx0cyhkLHtjYW5jZWxhYmxlOnRydWUsY3RybEtleTpmYWxzZSxhbHRLZXk6ZmFsc2Usc2hpZnRLZXk6ZmFsc2UsbWV0YUtleTpmYWxzZSxrZXlDb2RlOnZvaWQgMCxjaGFyQ29kZTp2b2lkIDB9KTttKGEsZC5idWJibGVzfHxmYWxzZSxkLmNhbmNlbGFibGUsd2luZG93LGQuY3RybEtleSxkLmFsdEtleSxkLnNoaWZ0S2V5LGQubWV0YUtleSxkLmtleUNvZGUsZC5jaGFyQ29kZSk7YnJlYWs7ZGVmYXVsdDpsLmluaXRFdmVudChhLGQuYnViYmxlc3x8ZmFsc2UsZC5jYW5jZWxhYmxlfHx0cnVlKX1lLmRlZmF1bHRzKGwsZik7Yi5kaXNwYXRjaEV2ZW50KGwpfSxiaW5kOmZ1bmN0aW9uKGIsYSxkLGMpe2IuYWRkRXZlbnRMaXN0ZW5lcj9iLmFkZEV2ZW50TGlzdGVuZXIoYSxkLGN8fGZhbHNlKTpiLmF0dGFjaEV2ZW50JiYKYi5hdHRhY2hFdmVudCgib24iK2EsZCk7cmV0dXJuIGZ9LHVuYmluZDpmdW5jdGlvbihiLGEsZCxjKXtiLnJlbW92ZUV2ZW50TGlzdGVuZXI/Yi5yZW1vdmVFdmVudExpc3RlbmVyKGEsZCxjfHxmYWxzZSk6Yi5kZXRhY2hFdmVudCYmYi5kZXRhY2hFdmVudCgib24iK2EsZCk7cmV0dXJuIGZ9LGFkZENsYXNzOmZ1bmN0aW9uKGIsYSl7aWYoYi5jbGFzc05hbWU9PT12b2lkIDApYi5jbGFzc05hbWU9YTtlbHNlIGlmKGIuY2xhc3NOYW1lIT09YSl7dmFyIGQ9Yi5jbGFzc05hbWUuc3BsaXQoLyArLyk7aWYoZC5pbmRleE9mKGEpPT0tMSlkLnB1c2goYSksYi5jbGFzc05hbWU9ZC5qb2luKCIgIikucmVwbGFjZSgvXlxzKy8sIiIpLnJlcGxhY2UoL1xzKyQvLCIiKX1yZXR1cm4gZn0scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24oYixhKXtpZihhKXtpZihiLmNsYXNzTmFtZSE9PXZvaWQgMClpZihiLmNsYXNzTmFtZT09PWEpYi5yZW1vdmVBdHRyaWJ1dGUoImNsYXNzIik7ZWxzZXt2YXIgZD1iLmNsYXNzTmFtZS5zcGxpdCgvICsvKSwKYz1kLmluZGV4T2YoYSk7aWYoYyE9LTEpZC5zcGxpY2UoYywxKSxiLmNsYXNzTmFtZT1kLmpvaW4oIiAiKX19ZWxzZSBiLmNsYXNzTmFtZT12b2lkIDA7cmV0dXJuIGZ9LGhhc0NsYXNzOmZ1bmN0aW9uKGEsZCl7cmV0dXJuIFJlZ0V4cCgiKD86XnxcXHMrKSIrZCsiKD86XFxzK3wkKSIpLnRlc3QoYS5jbGFzc05hbWUpfHxmYWxzZX0sZ2V0V2lkdGg6ZnVuY3Rpb24oYil7Yj1nZXRDb21wdXRlZFN0eWxlKGIpO3JldHVybiBhKGJbImJvcmRlci1sZWZ0LXdpZHRoIl0pK2EoYlsiYm9yZGVyLXJpZ2h0LXdpZHRoIl0pK2EoYlsicGFkZGluZy1sZWZ0Il0pK2EoYlsicGFkZGluZy1yaWdodCJdKSthKGIud2lkdGgpfSxnZXRIZWlnaHQ6ZnVuY3Rpb24oYil7Yj1nZXRDb21wdXRlZFN0eWxlKGIpO3JldHVybiBhKGJbImJvcmRlci10b3Atd2lkdGgiXSkrYShiWyJib3JkZXItYm90dG9tLXdpZHRoIl0pK2EoYlsicGFkZGluZy10b3AiXSkrYShiWyJwYWRkaW5nLWJvdHRvbSJdKSthKGIuaGVpZ2h0KX0sCmdldE9mZnNldDpmdW5jdGlvbihhKXt2YXIgZD17bGVmdDowLHRvcDowfTtpZihhLm9mZnNldFBhcmVudCl7ZG8gZC5sZWZ0Kz1hLm9mZnNldExlZnQsZC50b3ArPWEub2Zmc2V0VG9wO3doaWxlKGE9YS5vZmZzZXRQYXJlbnQpfXJldHVybiBkfSxpc0FjdGl2ZTpmdW5jdGlvbihhKXtyZXR1cm4gYT09PWRvY3VtZW50LmFjdGl2ZUVsZW1lbnQmJihhLnR5cGV8fGEuaHJlZil9fTtyZXR1cm4gZn0oZGF0LnV0aWxzLmNvbW1vbik7CmRhdC5jb250cm9sbGVycy5PcHRpb25Db250cm9sbGVyPWZ1bmN0aW9uKGUsYSxjKXt2YXIgZD1mdW5jdGlvbihmLGIsZSl7ZC5zdXBlcmNsYXNzLmNhbGwodGhpcyxmLGIpO3ZhciBoPXRoaXM7dGhpcy5fX3NlbGVjdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTtpZihjLmlzQXJyYXkoZSkpe3ZhciBqPXt9O2MuZWFjaChlLGZ1bmN0aW9uKGEpe2pbYV09YX0pO2U9an1jLmVhY2goZSxmdW5jdGlvbihhLGIpe3ZhciBkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpO2QuaW5uZXJIVE1MPWI7ZC5zZXRBdHRyaWJ1dGUoInZhbHVlIixhKTtoLl9fc2VsZWN0LmFwcGVuZENoaWxkKGQpfSk7dGhpcy51cGRhdGVEaXNwbGF5KCk7YS5iaW5kKHRoaXMuX19zZWxlY3QsImNoYW5nZSIsZnVuY3Rpb24oKXtoLnNldFZhbHVlKHRoaXMub3B0aW9uc1t0aGlzLnNlbGVjdGVkSW5kZXhdLnZhbHVlKX0pO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fc2VsZWN0KX07CmQuc3VwZXJjbGFzcz1lO2MuZXh0ZW5kKGQucHJvdG90eXBlLGUucHJvdG90eXBlLHtzZXRWYWx1ZTpmdW5jdGlvbihhKXthPWQuc3VwZXJjbGFzcy5wcm90b3R5cGUuc2V0VmFsdWUuY2FsbCh0aGlzLGEpO3RoaXMuX19vbkZpbmlzaENoYW5nZSYmdGhpcy5fX29uRmluaXNoQ2hhbmdlLmNhbGwodGhpcyx0aGlzLmdldFZhbHVlKCkpO3JldHVybiBhfSx1cGRhdGVEaXNwbGF5OmZ1bmN0aW9uKCl7dGhpcy5fX3NlbGVjdC52YWx1ZT10aGlzLmdldFZhbHVlKCk7cmV0dXJuIGQuc3VwZXJjbGFzcy5wcm90b3R5cGUudXBkYXRlRGlzcGxheS5jYWxsKHRoaXMpfX0pO3JldHVybiBkfShkYXQuY29udHJvbGxlcnMuQ29udHJvbGxlcixkYXQuZG9tLmRvbSxkYXQudXRpbHMuY29tbW9uKTsKZGF0LmNvbnRyb2xsZXJzLk51bWJlckNvbnRyb2xsZXI9ZnVuY3Rpb24oZSxhKXt2YXIgYz1mdW5jdGlvbihkLGYsYil7Yy5zdXBlcmNsYXNzLmNhbGwodGhpcyxkLGYpO2I9Ynx8e307dGhpcy5fX21pbj1iLm1pbjt0aGlzLl9fbWF4PWIubWF4O3RoaXMuX19zdGVwPWIuc3RlcDtkPXRoaXMuX19pbXBsaWVkU3RlcD1hLmlzVW5kZWZpbmVkKHRoaXMuX19zdGVwKT90aGlzLmluaXRpYWxWYWx1ZT09MD8xOk1hdGgucG93KDEwLE1hdGguZmxvb3IoTWF0aC5sb2codGhpcy5pbml0aWFsVmFsdWUpL01hdGguTE4xMCkpLzEwOnRoaXMuX19zdGVwO2Q9ZC50b1N0cmluZygpO3RoaXMuX19wcmVjaXNpb249ZC5pbmRleE9mKCIuIik+LTE/ZC5sZW5ndGgtZC5pbmRleE9mKCIuIiktMTowfTtjLnN1cGVyY2xhc3M9ZTthLmV4dGVuZChjLnByb3RvdHlwZSxlLnByb3RvdHlwZSx7c2V0VmFsdWU6ZnVuY3Rpb24oYSl7aWYodGhpcy5fX21pbiE9PXZvaWQgMCYmYTx0aGlzLl9fbWluKWE9dGhpcy5fX21pbjsKZWxzZSBpZih0aGlzLl9fbWF4IT09dm9pZCAwJiZhPnRoaXMuX19tYXgpYT10aGlzLl9fbWF4O3RoaXMuX19zdGVwIT09dm9pZCAwJiZhJXRoaXMuX19zdGVwIT0wJiYoYT1NYXRoLnJvdW5kKGEvdGhpcy5fX3N0ZXApKnRoaXMuX19zdGVwKTtyZXR1cm4gYy5zdXBlcmNsYXNzLnByb3RvdHlwZS5zZXRWYWx1ZS5jYWxsKHRoaXMsYSl9LG1pbjpmdW5jdGlvbihhKXt0aGlzLl9fbWluPWE7cmV0dXJuIHRoaXN9LG1heDpmdW5jdGlvbihhKXt0aGlzLl9fbWF4PWE7cmV0dXJuIHRoaXN9LHN0ZXA6ZnVuY3Rpb24oYSl7dGhpcy5fX3N0ZXA9YTtyZXR1cm4gdGhpc319KTtyZXR1cm4gY30oZGF0LmNvbnRyb2xsZXJzLkNvbnRyb2xsZXIsZGF0LnV0aWxzLmNvbW1vbik7CmRhdC5jb250cm9sbGVycy5OdW1iZXJDb250cm9sbGVyQm94PWZ1bmN0aW9uKGUsYSxjKXt2YXIgZD1mdW5jdGlvbihmLGIsZSl7ZnVuY3Rpb24gaCgpe3ZhciBhPXBhcnNlRmxvYXQobC5fX2lucHV0LnZhbHVlKTtjLmlzTmFOKGEpfHxsLnNldFZhbHVlKGEpfWZ1bmN0aW9uIGooYSl7dmFyIGI9by1hLmNsaWVudFk7bC5zZXRWYWx1ZShsLmdldFZhbHVlKCkrYipsLl9faW1wbGllZFN0ZXApO289YS5jbGllbnRZfWZ1bmN0aW9uIG0oKXthLnVuYmluZCh3aW5kb3csIm1vdXNlbW92ZSIsaik7YS51bmJpbmQod2luZG93LCJtb3VzZXVwIixtKX10aGlzLl9fdHJ1bmNhdGlvblN1c3BlbmRlZD1mYWxzZTtkLnN1cGVyY2xhc3MuY2FsbCh0aGlzLGYsYixlKTt2YXIgbD10aGlzLG87dGhpcy5fX2lucHV0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7dGhpcy5fX2lucHV0LnNldEF0dHJpYnV0ZSgidHlwZSIsInRleHQiKTthLmJpbmQodGhpcy5fX2lucHV0LCJjaGFuZ2UiLGgpOwphLmJpbmQodGhpcy5fX2lucHV0LCJibHVyIixmdW5jdGlvbigpe2goKTtsLl9fb25GaW5pc2hDaGFuZ2UmJmwuX19vbkZpbmlzaENoYW5nZS5jYWxsKGwsbC5nZXRWYWx1ZSgpKX0pO2EuYmluZCh0aGlzLl9faW5wdXQsIm1vdXNlZG93biIsZnVuY3Rpb24oYil7YS5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixqKTthLmJpbmQod2luZG93LCJtb3VzZXVwIixtKTtvPWIuY2xpZW50WX0pO2EuYmluZCh0aGlzLl9faW5wdXQsImtleWRvd24iLGZ1bmN0aW9uKGEpe2lmKGEua2V5Q29kZT09PTEzKWwuX190cnVuY2F0aW9uU3VzcGVuZGVkPXRydWUsdGhpcy5ibHVyKCksbC5fX3RydW5jYXRpb25TdXNwZW5kZWQ9ZmFsc2V9KTt0aGlzLnVwZGF0ZURpc3BsYXkoKTt0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fX2lucHV0KX07ZC5zdXBlcmNsYXNzPWU7Yy5leHRlbmQoZC5wcm90b3R5cGUsZS5wcm90b3R5cGUse3VwZGF0ZURpc3BsYXk6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLl9faW5wdXQsCmI7aWYodGhpcy5fX3RydW5jYXRpb25TdXNwZW5kZWQpYj10aGlzLmdldFZhbHVlKCk7ZWxzZXtiPXRoaXMuZ2V0VmFsdWUoKTt2YXIgYz1NYXRoLnBvdygxMCx0aGlzLl9fcHJlY2lzaW9uKTtiPU1hdGgucm91bmQoYipjKS9jfWEudmFsdWU9YjtyZXR1cm4gZC5zdXBlcmNsYXNzLnByb3RvdHlwZS51cGRhdGVEaXNwbGF5LmNhbGwodGhpcyl9fSk7cmV0dXJuIGR9KGRhdC5jb250cm9sbGVycy5OdW1iZXJDb250cm9sbGVyLGRhdC5kb20uZG9tLGRhdC51dGlscy5jb21tb24pOwpkYXQuY29udHJvbGxlcnMuTnVtYmVyQ29udHJvbGxlclNsaWRlcj1mdW5jdGlvbihlLGEsYyxkLGYpe3ZhciBiPWZ1bmN0aW9uKGQsYyxmLGUsbCl7ZnVuY3Rpb24gbyhiKXtiLnByZXZlbnREZWZhdWx0KCk7dmFyIGQ9YS5nZXRPZmZzZXQoZy5fX2JhY2tncm91bmQpLGM9YS5nZXRXaWR0aChnLl9fYmFja2dyb3VuZCk7Zy5zZXRWYWx1ZShnLl9fbWluKyhnLl9fbWF4LWcuX19taW4pKigoYi5jbGllbnRYLWQubGVmdCkvKGQubGVmdCtjLWQubGVmdCkpKTtyZXR1cm4gZmFsc2V9ZnVuY3Rpb24geSgpe2EudW5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixvKTthLnVuYmluZCh3aW5kb3csIm1vdXNldXAiLHkpO2cuX19vbkZpbmlzaENoYW5nZSYmZy5fX29uRmluaXNoQ2hhbmdlLmNhbGwoZyxnLmdldFZhbHVlKCkpfWIuc3VwZXJjbGFzcy5jYWxsKHRoaXMsZCxjLHttaW46ZixtYXg6ZSxzdGVwOmx9KTt2YXIgZz10aGlzO3RoaXMuX19iYWNrZ3JvdW5kPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwp0aGlzLl9fZm9yZWdyb3VuZD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmJpbmQodGhpcy5fX2JhY2tncm91bmQsIm1vdXNlZG93biIsZnVuY3Rpb24oYil7YS5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixvKTthLmJpbmQod2luZG93LCJtb3VzZXVwIix5KTtvKGIpfSk7YS5hZGRDbGFzcyh0aGlzLl9fYmFja2dyb3VuZCwic2xpZGVyIik7YS5hZGRDbGFzcyh0aGlzLl9fZm9yZWdyb3VuZCwic2xpZGVyLWZnIik7dGhpcy51cGRhdGVEaXNwbGF5KCk7dGhpcy5fX2JhY2tncm91bmQuYXBwZW5kQ2hpbGQodGhpcy5fX2ZvcmVncm91bmQpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fYmFja2dyb3VuZCl9O2Iuc3VwZXJjbGFzcz1lO2IudXNlRGVmYXVsdFN0eWxlcz1mdW5jdGlvbigpe2MuaW5qZWN0KGYpfTtkLmV4dGVuZChiLnByb3RvdHlwZSxlLnByb3RvdHlwZSx7dXBkYXRlRGlzcGxheTpmdW5jdGlvbigpe3RoaXMuX19mb3JlZ3JvdW5kLnN0eWxlLndpZHRoPQoodGhpcy5nZXRWYWx1ZSgpLXRoaXMuX19taW4pLyh0aGlzLl9fbWF4LXRoaXMuX19taW4pKjEwMCsiJSI7cmV0dXJuIGIuc3VwZXJjbGFzcy5wcm90b3R5cGUudXBkYXRlRGlzcGxheS5jYWxsKHRoaXMpfX0pO3JldHVybiBifShkYXQuY29udHJvbGxlcnMuTnVtYmVyQ29udHJvbGxlcixkYXQuZG9tLmRvbSxkYXQudXRpbHMuY3NzLGRhdC51dGlscy5jb21tb24sIi5zbGlkZXIge1xuICBib3gtc2hhZG93OiBpbnNldCAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjE1KTtcbiAgaGVpZ2h0OiAxZW07XG4gIGJvcmRlci1yYWRpdXM6IDFlbTtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2VlZTtcbiAgcGFkZGluZzogMCAwLjVlbTtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbn1cblxuLnNsaWRlci1mZyB7XG4gIHBhZGRpbmc6IDFweCAwIDJweCAwO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjYWFhO1xuICBoZWlnaHQ6IDFlbTtcbiAgbWFyZ2luLWxlZnQ6IC0wLjVlbTtcbiAgcGFkZGluZy1yaWdodDogMC41ZW07XG4gIGJvcmRlci1yYWRpdXM6IDFlbSAwIDAgMWVtO1xufVxuXG4uc2xpZGVyLWZnOmFmdGVyIHtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBib3JkZXItcmFkaXVzOiAxZW07XG4gIGJhY2tncm91bmQtY29sb3I6ICNmZmY7XG4gIGJvcmRlcjogIDFweCBzb2xpZCAjYWFhO1xuICBjb250ZW50OiAnJztcbiAgZmxvYXQ6IHJpZ2h0O1xuICBtYXJnaW4tcmlnaHQ6IC0xZW07XG4gIG1hcmdpbi10b3A6IC0xcHg7XG4gIGhlaWdodDogMC45ZW07XG4gIHdpZHRoOiAwLjllbTtcbn0iKTsKZGF0LmNvbnRyb2xsZXJzLkZ1bmN0aW9uQ29udHJvbGxlcj1mdW5jdGlvbihlLGEsYyl7dmFyIGQ9ZnVuY3Rpb24oYyxiLGUpe2Quc3VwZXJjbGFzcy5jYWxsKHRoaXMsYyxiKTt2YXIgaD10aGlzO3RoaXMuX19idXR0b249ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dGhpcy5fX2J1dHRvbi5pbm5lckhUTUw9ZT09PXZvaWQgMD8iRmlyZSI6ZTthLmJpbmQodGhpcy5fX2J1dHRvbiwiY2xpY2siLGZ1bmN0aW9uKGEpe2EucHJldmVudERlZmF1bHQoKTtoLmZpcmUoKTtyZXR1cm4gZmFsc2V9KTthLmFkZENsYXNzKHRoaXMuX19idXR0b24sImJ1dHRvbiIpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fYnV0dG9uKX07ZC5zdXBlcmNsYXNzPWU7Yy5leHRlbmQoZC5wcm90b3R5cGUsZS5wcm90b3R5cGUse2ZpcmU6ZnVuY3Rpb24oKXt0aGlzLl9fb25DaGFuZ2UmJnRoaXMuX19vbkNoYW5nZS5jYWxsKHRoaXMpO3RoaXMuX19vbkZpbmlzaENoYW5nZSYmdGhpcy5fX29uRmluaXNoQ2hhbmdlLmNhbGwodGhpcywKdGhpcy5nZXRWYWx1ZSgpKTt0aGlzLmdldFZhbHVlKCkuY2FsbCh0aGlzLm9iamVjdCl9fSk7cmV0dXJuIGR9KGRhdC5jb250cm9sbGVycy5Db250cm9sbGVyLGRhdC5kb20uZG9tLGRhdC51dGlscy5jb21tb24pOwpkYXQuY29udHJvbGxlcnMuQm9vbGVhbkNvbnRyb2xsZXI9ZnVuY3Rpb24oZSxhLGMpe3ZhciBkPWZ1bmN0aW9uKGMsYil7ZC5zdXBlcmNsYXNzLmNhbGwodGhpcyxjLGIpO3ZhciBlPXRoaXM7dGhpcy5fX3ByZXY9dGhpcy5nZXRWYWx1ZSgpO3RoaXMuX19jaGVja2JveD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpO3RoaXMuX19jaGVja2JveC5zZXRBdHRyaWJ1dGUoInR5cGUiLCJjaGVja2JveCIpO2EuYmluZCh0aGlzLl9fY2hlY2tib3gsImNoYW5nZSIsZnVuY3Rpb24oKXtlLnNldFZhbHVlKCFlLl9fcHJldil9LGZhbHNlKTt0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fX2NoZWNrYm94KTt0aGlzLnVwZGF0ZURpc3BsYXkoKX07ZC5zdXBlcmNsYXNzPWU7Yy5leHRlbmQoZC5wcm90b3R5cGUsZS5wcm90b3R5cGUse3NldFZhbHVlOmZ1bmN0aW9uKGEpe2E9ZC5zdXBlcmNsYXNzLnByb3RvdHlwZS5zZXRWYWx1ZS5jYWxsKHRoaXMsYSk7dGhpcy5fX29uRmluaXNoQ2hhbmdlJiYKdGhpcy5fX29uRmluaXNoQ2hhbmdlLmNhbGwodGhpcyx0aGlzLmdldFZhbHVlKCkpO3RoaXMuX19wcmV2PXRoaXMuZ2V0VmFsdWUoKTtyZXR1cm4gYX0sdXBkYXRlRGlzcGxheTpmdW5jdGlvbigpe3RoaXMuZ2V0VmFsdWUoKT09PXRydWU/KHRoaXMuX19jaGVja2JveC5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCJjaGVja2VkIiksdGhpcy5fX2NoZWNrYm94LmNoZWNrZWQ9dHJ1ZSk6dGhpcy5fX2NoZWNrYm94LmNoZWNrZWQ9ZmFsc2U7cmV0dXJuIGQuc3VwZXJjbGFzcy5wcm90b3R5cGUudXBkYXRlRGlzcGxheS5jYWxsKHRoaXMpfX0pO3JldHVybiBkfShkYXQuY29udHJvbGxlcnMuQ29udHJvbGxlcixkYXQuZG9tLmRvbSxkYXQudXRpbHMuY29tbW9uKTsKZGF0LmNvbG9yLnRvU3RyaW5nPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbihhKXtpZihhLmE9PTF8fGUuaXNVbmRlZmluZWQoYS5hKSl7Zm9yKGE9YS5oZXgudG9TdHJpbmcoMTYpO2EubGVuZ3RoPDY7KWE9IjAiK2E7cmV0dXJuIiMiK2F9ZWxzZSByZXR1cm4icmdiYSgiK01hdGgucm91bmQoYS5yKSsiLCIrTWF0aC5yb3VuZChhLmcpKyIsIitNYXRoLnJvdW5kKGEuYikrIiwiK2EuYSsiKSJ9fShkYXQudXRpbHMuY29tbW9uKTsKZGF0LmNvbG9yLmludGVycHJldD1mdW5jdGlvbihlLGEpe3ZhciBjLGQsZj1be2xpdG11czphLmlzU3RyaW5nLGNvbnZlcnNpb25zOntUSFJFRV9DSEFSX0hFWDp7cmVhZDpmdW5jdGlvbihhKXthPWEubWF0Y2goL14jKFtBLUYwLTldKShbQS1GMC05XSkoW0EtRjAtOV0pJC9pKTtyZXR1cm4gYT09PW51bGw/ZmFsc2U6e3NwYWNlOiJIRVgiLGhleDpwYXJzZUludCgiMHgiK2FbMV0udG9TdHJpbmcoKSthWzFdLnRvU3RyaW5nKCkrYVsyXS50b1N0cmluZygpK2FbMl0udG9TdHJpbmcoKSthWzNdLnRvU3RyaW5nKCkrYVszXS50b1N0cmluZygpKX19LHdyaXRlOmV9LFNJWF9DSEFSX0hFWDp7cmVhZDpmdW5jdGlvbihhKXthPWEubWF0Y2goL14jKFtBLUYwLTldezZ9KSQvaSk7cmV0dXJuIGE9PT1udWxsP2ZhbHNlOntzcGFjZToiSEVYIixoZXg6cGFyc2VJbnQoIjB4IithWzFdLnRvU3RyaW5nKCkpfX0sd3JpdGU6ZX0sQ1NTX1JHQjp7cmVhZDpmdW5jdGlvbihhKXthPWEubWF0Y2goL15yZ2JcKFxzKiguKylccyosXHMqKC4rKVxzKixccyooLispXHMqXCkvKTsKcmV0dXJuIGE9PT1udWxsP2ZhbHNlOntzcGFjZToiUkdCIixyOnBhcnNlRmxvYXQoYVsxXSksZzpwYXJzZUZsb2F0KGFbMl0pLGI6cGFyc2VGbG9hdChhWzNdKX19LHdyaXRlOmV9LENTU19SR0JBOntyZWFkOmZ1bmN0aW9uKGEpe2E9YS5tYXRjaCgvXnJnYmFcKFxzKiguKylccyosXHMqKC4rKVxzKixccyooLispXHMqXCxccyooLispXHMqXCkvKTtyZXR1cm4gYT09PW51bGw/ZmFsc2U6e3NwYWNlOiJSR0IiLHI6cGFyc2VGbG9hdChhWzFdKSxnOnBhcnNlRmxvYXQoYVsyXSksYjpwYXJzZUZsb2F0KGFbM10pLGE6cGFyc2VGbG9hdChhWzRdKX19LHdyaXRlOmV9fX0se2xpdG11czphLmlzTnVtYmVyLGNvbnZlcnNpb25zOntIRVg6e3JlYWQ6ZnVuY3Rpb24oYSl7cmV0dXJue3NwYWNlOiJIRVgiLGhleDphLGNvbnZlcnNpb25OYW1lOiJIRVgifX0sd3JpdGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuaGV4fX19fSx7bGl0bXVzOmEuaXNBcnJheSxjb252ZXJzaW9uczp7UkdCX0FSUkFZOntyZWFkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmxlbmd0aCE9CjM/ZmFsc2U6e3NwYWNlOiJSR0IiLHI6YVswXSxnOmFbMV0sYjphWzJdfX0sd3JpdGU6ZnVuY3Rpb24oYSl7cmV0dXJuW2EucixhLmcsYS5iXX19LFJHQkFfQVJSQVk6e3JlYWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEubGVuZ3RoIT00P2ZhbHNlOntzcGFjZToiUkdCIixyOmFbMF0sZzphWzFdLGI6YVsyXSxhOmFbM119fSx3cml0ZTpmdW5jdGlvbihhKXtyZXR1cm5bYS5yLGEuZyxhLmIsYS5hXX19fX0se2xpdG11czphLmlzT2JqZWN0LGNvbnZlcnNpb25zOntSR0JBX09CSjp7cmVhZDpmdW5jdGlvbihiKXtyZXR1cm4gYS5pc051bWJlcihiLnIpJiZhLmlzTnVtYmVyKGIuZykmJmEuaXNOdW1iZXIoYi5iKSYmYS5pc051bWJlcihiLmEpP3tzcGFjZToiUkdCIixyOmIucixnOmIuZyxiOmIuYixhOmIuYX06ZmFsc2V9LHdyaXRlOmZ1bmN0aW9uKGEpe3JldHVybntyOmEucixnOmEuZyxiOmEuYixhOmEuYX19fSxSR0JfT0JKOntyZWFkOmZ1bmN0aW9uKGIpe3JldHVybiBhLmlzTnVtYmVyKGIucikmJgphLmlzTnVtYmVyKGIuZykmJmEuaXNOdW1iZXIoYi5iKT97c3BhY2U6IlJHQiIscjpiLnIsZzpiLmcsYjpiLmJ9OmZhbHNlfSx3cml0ZTpmdW5jdGlvbihhKXtyZXR1cm57cjphLnIsZzphLmcsYjphLmJ9fX0sSFNWQV9PQko6e3JlYWQ6ZnVuY3Rpb24oYil7cmV0dXJuIGEuaXNOdW1iZXIoYi5oKSYmYS5pc051bWJlcihiLnMpJiZhLmlzTnVtYmVyKGIudikmJmEuaXNOdW1iZXIoYi5hKT97c3BhY2U6IkhTViIsaDpiLmgsczpiLnMsdjpiLnYsYTpiLmF9OmZhbHNlfSx3cml0ZTpmdW5jdGlvbihhKXtyZXR1cm57aDphLmgsczphLnMsdjphLnYsYTphLmF9fX0sSFNWX09CSjp7cmVhZDpmdW5jdGlvbihiKXtyZXR1cm4gYS5pc051bWJlcihiLmgpJiZhLmlzTnVtYmVyKGIucykmJmEuaXNOdW1iZXIoYi52KT97c3BhY2U6IkhTViIsaDpiLmgsczpiLnMsdjpiLnZ9OmZhbHNlfSx3cml0ZTpmdW5jdGlvbihhKXtyZXR1cm57aDphLmgsczphLnMsdjphLnZ9fX19fV07cmV0dXJuIGZ1bmN0aW9uKCl7ZD0KZmFsc2U7dmFyIGI9YXJndW1lbnRzLmxlbmd0aD4xP2EudG9BcnJheShhcmd1bWVudHMpOmFyZ3VtZW50c1swXTthLmVhY2goZixmdW5jdGlvbihlKXtpZihlLmxpdG11cyhiKSlyZXR1cm4gYS5lYWNoKGUuY29udmVyc2lvbnMsZnVuY3Rpb24oZSxmKXtjPWUucmVhZChiKTtpZihkPT09ZmFsc2UmJmMhPT1mYWxzZSlyZXR1cm4gZD1jLGMuY29udmVyc2lvbk5hbWU9ZixjLmNvbnZlcnNpb249ZSxhLkJSRUFLfSksYS5CUkVBS30pO3JldHVybiBkfX0oZGF0LmNvbG9yLnRvU3RyaW5nLGRhdC51dGlscy5jb21tb24pOwpkYXQuR1VJPWRhdC5ndWkuR1VJPWZ1bmN0aW9uKGUsYSxjLGQsZixiLG4saCxqLG0sbCxvLHksZyxpKXtmdW5jdGlvbiBxKGEsYixyLGMpe2lmKGJbcl09PT12b2lkIDApdGhyb3cgRXJyb3IoIk9iamVjdCAiK2IrJyBoYXMgbm8gcHJvcGVydHkgIicrcisnIicpO2MuY29sb3I/Yj1uZXcgbChiLHIpOihiPVtiLHJdLmNvbmNhdChjLmZhY3RvcnlBcmdzKSxiPWQuYXBwbHkoYSxiKSk7aWYoYy5iZWZvcmUgaW5zdGFuY2VvZiBmKWMuYmVmb3JlPWMuYmVmb3JlLl9fbGk7dChhLGIpO2cuYWRkQ2xhc3MoYi5kb21FbGVtZW50LCJjIik7cj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7Zy5hZGRDbGFzcyhyLCJwcm9wZXJ0eS1uYW1lIik7ci5pbm5lckhUTUw9Yi5wcm9wZXJ0eTt2YXIgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtlLmFwcGVuZENoaWxkKHIpO2UuYXBwZW5kQ2hpbGQoYi5kb21FbGVtZW50KTtjPXMoYSxlLGMuYmVmb3JlKTtnLmFkZENsYXNzKGMsay5DTEFTU19DT05UUk9MTEVSX1JPVyk7CmcuYWRkQ2xhc3MoYyx0eXBlb2YgYi5nZXRWYWx1ZSgpKTtwKGEsYyxiKTthLl9fY29udHJvbGxlcnMucHVzaChiKTtyZXR1cm4gYn1mdW5jdGlvbiBzKGEsYixkKXt2YXIgYz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaSIpO2ImJmMuYXBwZW5kQ2hpbGQoYik7ZD9hLl9fdWwuaW5zZXJ0QmVmb3JlKGMscGFyYW1zLmJlZm9yZSk6YS5fX3VsLmFwcGVuZENoaWxkKGMpO2Eub25SZXNpemUoKTtyZXR1cm4gY31mdW5jdGlvbiBwKGEsZCxjKXtjLl9fbGk9ZDtjLl9fZ3VpPWE7aS5leHRlbmQoYyx7b3B0aW9uczpmdW5jdGlvbihiKXtpZihhcmd1bWVudHMubGVuZ3RoPjEpcmV0dXJuIGMucmVtb3ZlKCkscShhLGMub2JqZWN0LGMucHJvcGVydHkse2JlZm9yZTpjLl9fbGkubmV4dEVsZW1lbnRTaWJsaW5nLGZhY3RvcnlBcmdzOltpLnRvQXJyYXkoYXJndW1lbnRzKV19KTtpZihpLmlzQXJyYXkoYil8fGkuaXNPYmplY3QoYikpcmV0dXJuIGMucmVtb3ZlKCkscShhLGMub2JqZWN0LGMucHJvcGVydHksCntiZWZvcmU6Yy5fX2xpLm5leHRFbGVtZW50U2libGluZyxmYWN0b3J5QXJnczpbYl19KX0sbmFtZTpmdW5jdGlvbihhKXtjLl9fbGkuZmlyc3RFbGVtZW50Q2hpbGQuZmlyc3RFbGVtZW50Q2hpbGQuaW5uZXJIVE1MPWE7cmV0dXJuIGN9LGxpc3RlbjpmdW5jdGlvbigpe2MuX19ndWkubGlzdGVuKGMpO3JldHVybiBjfSxyZW1vdmU6ZnVuY3Rpb24oKXtjLl9fZ3VpLnJlbW92ZShjKTtyZXR1cm4gY319KTtpZihjIGluc3RhbmNlb2Ygail7dmFyIGU9bmV3IGgoYy5vYmplY3QsYy5wcm9wZXJ0eSx7bWluOmMuX19taW4sbWF4OmMuX19tYXgsc3RlcDpjLl9fc3RlcH0pO2kuZWFjaChbInVwZGF0ZURpc3BsYXkiLCJvbkNoYW5nZSIsIm9uRmluaXNoQ2hhbmdlIl0sZnVuY3Rpb24oYSl7dmFyIGI9Y1thXSxIPWVbYV07Y1thXT1lW2FdPWZ1bmN0aW9uKCl7dmFyIGE9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtiLmFwcGx5KGMsYSk7cmV0dXJuIEguYXBwbHkoZSxhKX19KTsKZy5hZGRDbGFzcyhkLCJoYXMtc2xpZGVyIik7Yy5kb21FbGVtZW50Lmluc2VydEJlZm9yZShlLmRvbUVsZW1lbnQsYy5kb21FbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKX1lbHNlIGlmKGMgaW5zdGFuY2VvZiBoKXt2YXIgZj1mdW5jdGlvbihiKXtyZXR1cm4gaS5pc051bWJlcihjLl9fbWluKSYmaS5pc051bWJlcihjLl9fbWF4KT8oYy5yZW1vdmUoKSxxKGEsYy5vYmplY3QsYy5wcm9wZXJ0eSx7YmVmb3JlOmMuX19saS5uZXh0RWxlbWVudFNpYmxpbmcsZmFjdG9yeUFyZ3M6W2MuX19taW4sYy5fX21heCxjLl9fc3RlcF19KSk6Yn07Yy5taW49aS5jb21wb3NlKGYsYy5taW4pO2MubWF4PWkuY29tcG9zZShmLGMubWF4KX1lbHNlIGlmKGMgaW5zdGFuY2VvZiBiKWcuYmluZChkLCJjbGljayIsZnVuY3Rpb24oKXtnLmZha2VFdmVudChjLl9fY2hlY2tib3gsImNsaWNrIil9KSxnLmJpbmQoYy5fX2NoZWNrYm94LCJjbGljayIsZnVuY3Rpb24oYSl7YS5zdG9wUHJvcGFnYXRpb24oKX0pOwplbHNlIGlmKGMgaW5zdGFuY2VvZiBuKWcuYmluZChkLCJjbGljayIsZnVuY3Rpb24oKXtnLmZha2VFdmVudChjLl9fYnV0dG9uLCJjbGljayIpfSksZy5iaW5kKGQsIm1vdXNlb3ZlciIsZnVuY3Rpb24oKXtnLmFkZENsYXNzKGMuX19idXR0b24sImhvdmVyIil9KSxnLmJpbmQoZCwibW91c2VvdXQiLGZ1bmN0aW9uKCl7Zy5yZW1vdmVDbGFzcyhjLl9fYnV0dG9uLCJob3ZlciIpfSk7ZWxzZSBpZihjIGluc3RhbmNlb2YgbClnLmFkZENsYXNzKGQsImNvbG9yIiksYy51cGRhdGVEaXNwbGF5PWkuY29tcG9zZShmdW5jdGlvbihhKXtkLnN0eWxlLmJvcmRlckxlZnRDb2xvcj1jLl9fY29sb3IudG9TdHJpbmcoKTtyZXR1cm4gYX0sYy51cGRhdGVEaXNwbGF5KSxjLnVwZGF0ZURpc3BsYXkoKTtjLnNldFZhbHVlPWkuY29tcG9zZShmdW5jdGlvbihiKXthLmdldFJvb3QoKS5fX3ByZXNldF9zZWxlY3QmJmMuaXNNb2RpZmllZCgpJiZCKGEuZ2V0Um9vdCgpLHRydWUpO3JldHVybiBifSxjLnNldFZhbHVlKX0KZnVuY3Rpb24gdChhLGIpe3ZhciBjPWEuZ2V0Um9vdCgpLGQ9Yy5fX3JlbWVtYmVyZWRPYmplY3RzLmluZGV4T2YoYi5vYmplY3QpO2lmKGQhPS0xKXt2YXIgZT1jLl9fcmVtZW1iZXJlZE9iamVjdEluZGVjZXNUb0NvbnRyb2xsZXJzW2RdO2U9PT12b2lkIDAmJihlPXt9LGMuX19yZW1lbWJlcmVkT2JqZWN0SW5kZWNlc1RvQ29udHJvbGxlcnNbZF09ZSk7ZVtiLnByb3BlcnR5XT1iO2lmKGMubG9hZCYmYy5sb2FkLnJlbWVtYmVyZWQpe2M9Yy5sb2FkLnJlbWVtYmVyZWQ7aWYoY1thLnByZXNldF0pYz1jW2EucHJlc2V0XTtlbHNlIGlmKGNbd10pYz1jW3ddO2Vsc2UgcmV0dXJuO2lmKGNbZF0mJmNbZF1bYi5wcm9wZXJ0eV0hPT12b2lkIDApZD1jW2RdW2IucHJvcGVydHldLGIuaW5pdGlhbFZhbHVlPWQsYi5zZXRWYWx1ZShkKX19fWZ1bmN0aW9uIEkoYSl7dmFyIGI9YS5fX3NhdmVfcm93PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpIik7Zy5hZGRDbGFzcyhhLmRvbUVsZW1lbnQsCiJoYXMtc2F2ZSIpO2EuX191bC5pbnNlcnRCZWZvcmUoYixhLl9fdWwuZmlyc3RDaGlsZCk7Zy5hZGRDbGFzcyhiLCJzYXZlLXJvdyIpO3ZhciBjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTtjLmlubmVySFRNTD0iJm5ic3A7IjtnLmFkZENsYXNzKGMsImJ1dHRvbiBnZWFycyIpO3ZhciBkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTtkLmlubmVySFRNTD0iU2F2ZSI7Zy5hZGRDbGFzcyhkLCJidXR0b24iKTtnLmFkZENsYXNzKGQsInNhdmUiKTt2YXIgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7ZS5pbm5lckhUTUw9Ik5ldyI7Zy5hZGRDbGFzcyhlLCJidXR0b24iKTtnLmFkZENsYXNzKGUsInNhdmUtYXMiKTt2YXIgZj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7Zi5pbm5lckhUTUw9IlJldmVydCI7Zy5hZGRDbGFzcyhmLCJidXR0b24iKTtnLmFkZENsYXNzKGYsInJldmVydCIpO3ZhciBtPWEuX19wcmVzZXRfc2VsZWN0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwphLmxvYWQmJmEubG9hZC5yZW1lbWJlcmVkP2kuZWFjaChhLmxvYWQucmVtZW1iZXJlZCxmdW5jdGlvbihiLGMpe0MoYSxjLGM9PWEucHJlc2V0KX0pOkMoYSx3LGZhbHNlKTtnLmJpbmQobSwiY2hhbmdlIixmdW5jdGlvbigpe2Zvcih2YXIgYj0wO2I8YS5fX3ByZXNldF9zZWxlY3QubGVuZ3RoO2IrKylhLl9fcHJlc2V0X3NlbGVjdFtiXS5pbm5lckhUTUw9YS5fX3ByZXNldF9zZWxlY3RbYl0udmFsdWU7YS5wcmVzZXQ9dGhpcy52YWx1ZX0pO2IuYXBwZW5kQ2hpbGQobSk7Yi5hcHBlbmRDaGlsZChjKTtiLmFwcGVuZENoaWxkKGQpO2IuYXBwZW5kQ2hpbGQoZSk7Yi5hcHBlbmRDaGlsZChmKTtpZih1KXt2YXIgYj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGctc2F2ZS1sb2NhbGx5IiksbD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGctbG9jYWwtZXhwbGFpbiIpO2Iuc3R5bGUuZGlzcGxheT0iYmxvY2siO2I9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRnLWxvY2FsLXN0b3JhZ2UiKTsKbG9jYWxTdG9yYWdlLmdldEl0ZW0oZG9jdW1lbnQubG9jYXRpb24uaHJlZisiLmlzTG9jYWwiKT09PSJ0cnVlIiYmYi5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCJjaGVja2VkIik7dmFyIG89ZnVuY3Rpb24oKXtsLnN0eWxlLmRpc3BsYXk9YS51c2VMb2NhbFN0b3JhZ2U/ImJsb2NrIjoibm9uZSJ9O28oKTtnLmJpbmQoYiwiY2hhbmdlIixmdW5jdGlvbigpe2EudXNlTG9jYWxTdG9yYWdlPSFhLnVzZUxvY2FsU3RvcmFnZTtvKCl9KX12YXIgaD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGctbmV3LWNvbnN0cnVjdG9yIik7Zy5iaW5kKGgsImtleWRvd24iLGZ1bmN0aW9uKGEpe2EubWV0YUtleSYmKGEud2hpY2g9PT02N3x8YS5rZXlDb2RlPT02NykmJnguaGlkZSgpfSk7Zy5iaW5kKGMsImNsaWNrIixmdW5jdGlvbigpe2guaW5uZXJIVE1MPUpTT04uc3RyaW5naWZ5KGEuZ2V0U2F2ZU9iamVjdCgpLHZvaWQgMCwyKTt4LnNob3coKTtoLmZvY3VzKCk7aC5zZWxlY3QoKX0pO2cuYmluZChkLAoiY2xpY2siLGZ1bmN0aW9uKCl7YS5zYXZlKCl9KTtnLmJpbmQoZSwiY2xpY2siLGZ1bmN0aW9uKCl7dmFyIGI9cHJvbXB0KCJFbnRlciBhIG5ldyBwcmVzZXQgbmFtZS4iKTtiJiZhLnNhdmVBcyhiKX0pO2cuYmluZChmLCJjbGljayIsZnVuY3Rpb24oKXthLnJldmVydCgpfSl9ZnVuY3Rpb24gSihhKXtmdW5jdGlvbiBiKGYpe2YucHJldmVudERlZmF1bHQoKTtlPWYuY2xpZW50WDtnLmFkZENsYXNzKGEuX19jbG9zZUJ1dHRvbixrLkNMQVNTX0RSQUcpO2cuYmluZCh3aW5kb3csIm1vdXNlbW92ZSIsYyk7Zy5iaW5kKHdpbmRvdywibW91c2V1cCIsZCk7cmV0dXJuIGZhbHNlfWZ1bmN0aW9uIGMoYil7Yi5wcmV2ZW50RGVmYXVsdCgpO2Eud2lkdGgrPWUtYi5jbGllbnRYO2Eub25SZXNpemUoKTtlPWIuY2xpZW50WDtyZXR1cm4gZmFsc2V9ZnVuY3Rpb24gZCgpe2cucmVtb3ZlQ2xhc3MoYS5fX2Nsb3NlQnV0dG9uLGsuQ0xBU1NfRFJBRyk7Zy51bmJpbmQod2luZG93LCJtb3VzZW1vdmUiLApjKTtnLnVuYmluZCh3aW5kb3csIm1vdXNldXAiLGQpfWEuX19yZXNpemVfaGFuZGxlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2kuZXh0ZW5kKGEuX19yZXNpemVfaGFuZGxlLnN0eWxlLHt3aWR0aDoiNnB4IixtYXJnaW5MZWZ0OiItM3B4IixoZWlnaHQ6IjIwMHB4IixjdXJzb3I6ImV3LXJlc2l6ZSIscG9zaXRpb246ImFic29sdXRlIn0pO3ZhciBlO2cuYmluZChhLl9fcmVzaXplX2hhbmRsZSwibW91c2Vkb3duIixiKTtnLmJpbmQoYS5fX2Nsb3NlQnV0dG9uLCJtb3VzZWRvd24iLGIpO2EuZG9tRWxlbWVudC5pbnNlcnRCZWZvcmUoYS5fX3Jlc2l6ZV9oYW5kbGUsYS5kb21FbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKX1mdW5jdGlvbiBEKGEsYil7YS5kb21FbGVtZW50LnN0eWxlLndpZHRoPWIrInB4IjtpZihhLl9fc2F2ZV9yb3cmJmEuYXV0b1BsYWNlKWEuX19zYXZlX3Jvdy5zdHlsZS53aWR0aD1iKyJweCI7aWYoYS5fX2Nsb3NlQnV0dG9uKWEuX19jbG9zZUJ1dHRvbi5zdHlsZS53aWR0aD0KYisicHgifWZ1bmN0aW9uIHooYSxiKXt2YXIgYz17fTtpLmVhY2goYS5fX3JlbWVtYmVyZWRPYmplY3RzLGZ1bmN0aW9uKGQsZSl7dmFyIGY9e307aS5lYWNoKGEuX19yZW1lbWJlcmVkT2JqZWN0SW5kZWNlc1RvQ29udHJvbGxlcnNbZV0sZnVuY3Rpb24oYSxjKXtmW2NdPWI/YS5pbml0aWFsVmFsdWU6YS5nZXRWYWx1ZSgpfSk7Y1tlXT1mfSk7cmV0dXJuIGN9ZnVuY3Rpb24gQyhhLGIsYyl7dmFyIGQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7ZC5pbm5lckhUTUw9YjtkLnZhbHVlPWI7YS5fX3ByZXNldF9zZWxlY3QuYXBwZW5kQ2hpbGQoZCk7aWYoYylhLl9fcHJlc2V0X3NlbGVjdC5zZWxlY3RlZEluZGV4PWEuX19wcmVzZXRfc2VsZWN0Lmxlbmd0aC0xfWZ1bmN0aW9uIEIoYSxiKXt2YXIgYz1hLl9fcHJlc2V0X3NlbGVjdFthLl9fcHJlc2V0X3NlbGVjdC5zZWxlY3RlZEluZGV4XTtjLmlubmVySFRNTD1iP2MudmFsdWUrIioiOmMudmFsdWV9ZnVuY3Rpb24gRShhKXthLmxlbmd0aCE9CjAmJm8oZnVuY3Rpb24oKXtFKGEpfSk7aS5lYWNoKGEsZnVuY3Rpb24oYSl7YS51cGRhdGVEaXNwbGF5KCl9KX1lLmluamVjdChjKTt2YXIgdz0iRGVmYXVsdCIsdTt0cnl7dT0ibG9jYWxTdG9yYWdlImluIHdpbmRvdyYmd2luZG93LmxvY2FsU3RvcmFnZSE9PW51bGx9Y2F0Y2goSyl7dT1mYWxzZX12YXIgeCxGPXRydWUsdixBPWZhbHNlLEc9W10saz1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKCl7bG9jYWxTdG9yYWdlLnNldEl0ZW0oZG9jdW1lbnQubG9jYXRpb24uaHJlZisiLmd1aSIsSlNPTi5zdHJpbmdpZnkoZC5nZXRTYXZlT2JqZWN0KCkpKX1mdW5jdGlvbiBjKCl7dmFyIGE9ZC5nZXRSb290KCk7YS53aWR0aCs9MTtpLmRlZmVyKGZ1bmN0aW9uKCl7YS53aWR0aC09MX0pfXZhciBkPXRoaXM7dGhpcy5kb21FbGVtZW50PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3RoaXMuX191bD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ1bCIpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fdWwpOwpnLmFkZENsYXNzKHRoaXMuZG9tRWxlbWVudCwiZGciKTt0aGlzLl9fZm9sZGVycz17fTt0aGlzLl9fY29udHJvbGxlcnM9W107dGhpcy5fX3JlbWVtYmVyZWRPYmplY3RzPVtdO3RoaXMuX19yZW1lbWJlcmVkT2JqZWN0SW5kZWNlc1RvQ29udHJvbGxlcnM9W107dGhpcy5fX2xpc3RlbmluZz1bXTthPWF8fHt9O2E9aS5kZWZhdWx0cyhhLHthdXRvUGxhY2U6dHJ1ZSx3aWR0aDprLkRFRkFVTFRfV0lEVEh9KTthPWkuZGVmYXVsdHMoYSx7cmVzaXphYmxlOmEuYXV0b1BsYWNlLGhpZGVhYmxlOmEuYXV0b1BsYWNlfSk7aWYoaS5pc1VuZGVmaW5lZChhLmxvYWQpKWEubG9hZD17cHJlc2V0Ond9O2Vsc2UgaWYoYS5wcmVzZXQpYS5sb2FkLnByZXNldD1hLnByZXNldDtpLmlzVW5kZWZpbmVkKGEucGFyZW50KSYmYS5oaWRlYWJsZSYmRy5wdXNoKHRoaXMpO2EucmVzaXphYmxlPWkuaXNVbmRlZmluZWQoYS5wYXJlbnQpJiZhLnJlc2l6YWJsZTtpZihhLmF1dG9QbGFjZSYmaS5pc1VuZGVmaW5lZChhLnNjcm9sbGFibGUpKWEuc2Nyb2xsYWJsZT0KdHJ1ZTt2YXIgZT11JiZsb2NhbFN0b3JhZ2UuZ2V0SXRlbShkb2N1bWVudC5sb2NhdGlvbi5ocmVmKyIuaXNMb2NhbCIpPT09InRydWUiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse3BhcmVudDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEucGFyZW50fX0sc2Nyb2xsYWJsZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEuc2Nyb2xsYWJsZX19LGF1dG9QbGFjZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEuYXV0b1BsYWNlfX0scHJlc2V0OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZC5wYXJlbnQ/ZC5nZXRSb290KCkucHJlc2V0OmEubG9hZC5wcmVzZXR9LHNldDpmdW5jdGlvbihiKXtkLnBhcmVudD9kLmdldFJvb3QoKS5wcmVzZXQ9YjphLmxvYWQucHJlc2V0PWI7Zm9yKGI9MDtiPHRoaXMuX19wcmVzZXRfc2VsZWN0Lmxlbmd0aDtiKyspaWYodGhpcy5fX3ByZXNldF9zZWxlY3RbYl0udmFsdWU9PXRoaXMucHJlc2V0KXRoaXMuX19wcmVzZXRfc2VsZWN0LnNlbGVjdGVkSW5kZXg9CmI7ZC5yZXZlcnQoKX19LHdpZHRoOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYS53aWR0aH0sc2V0OmZ1bmN0aW9uKGIpe2Eud2lkdGg9YjtEKGQsYil9fSxuYW1lOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYS5uYW1lfSxzZXQ6ZnVuY3Rpb24oYil7YS5uYW1lPWI7aWYobSltLmlubmVySFRNTD1hLm5hbWV9fSxjbG9zZWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiBhLmNsb3NlZH0sc2V0OmZ1bmN0aW9uKGIpe2EuY2xvc2VkPWI7YS5jbG9zZWQ/Zy5hZGRDbGFzcyhkLl9fdWwsay5DTEFTU19DTE9TRUQpOmcucmVtb3ZlQ2xhc3MoZC5fX3VsLGsuQ0xBU1NfQ0xPU0VEKTt0aGlzLm9uUmVzaXplKCk7aWYoZC5fX2Nsb3NlQnV0dG9uKWQuX19jbG9zZUJ1dHRvbi5pbm5lckhUTUw9Yj9rLlRFWFRfT1BFTjprLlRFWFRfQ0xPU0VEfX0sbG9hZDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEubG9hZH19LHVzZUxvY2FsU3RvcmFnZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGV9LHNldDpmdW5jdGlvbihhKXt1JiYKKChlPWEpP2cuYmluZCh3aW5kb3csInVubG9hZCIsYik6Zy51bmJpbmQod2luZG93LCJ1bmxvYWQiLGIpLGxvY2FsU3RvcmFnZS5zZXRJdGVtKGRvY3VtZW50LmxvY2F0aW9uLmhyZWYrIi5pc0xvY2FsIixhKSl9fX0pO2lmKGkuaXNVbmRlZmluZWQoYS5wYXJlbnQpKXthLmNsb3NlZD1mYWxzZTtnLmFkZENsYXNzKHRoaXMuZG9tRWxlbWVudCxrLkNMQVNTX01BSU4pO2cubWFrZVNlbGVjdGFibGUodGhpcy5kb21FbGVtZW50LGZhbHNlKTtpZih1JiZlKXtkLnVzZUxvY2FsU3RvcmFnZT10cnVlO3ZhciBmPWxvY2FsU3RvcmFnZS5nZXRJdGVtKGRvY3VtZW50LmxvY2F0aW9uLmhyZWYrIi5ndWkiKTtpZihmKWEubG9hZD1KU09OLnBhcnNlKGYpfXRoaXMuX19jbG9zZUJ1dHRvbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLl9fY2xvc2VCdXR0b24uaW5uZXJIVE1MPWsuVEVYVF9DTE9TRUQ7Zy5hZGRDbGFzcyh0aGlzLl9fY2xvc2VCdXR0b24say5DTEFTU19DTE9TRV9CVVRUT04pOwp0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fX2Nsb3NlQnV0dG9uKTtnLmJpbmQodGhpcy5fX2Nsb3NlQnV0dG9uLCJjbGljayIsZnVuY3Rpb24oKXtkLmNsb3NlZD0hZC5jbG9zZWR9KX1lbHNle2lmKGEuY2xvc2VkPT09dm9pZCAwKWEuY2xvc2VkPXRydWU7dmFyIG09ZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoYS5uYW1lKTtnLmFkZENsYXNzKG0sImNvbnRyb2xsZXItbmFtZSIpO2Y9cyhkLG0pO2cuYWRkQ2xhc3ModGhpcy5fX3VsLGsuQ0xBU1NfQ0xPU0VEKTtnLmFkZENsYXNzKGYsInRpdGxlIik7Zy5iaW5kKGYsImNsaWNrIixmdW5jdGlvbihhKXthLnByZXZlbnREZWZhdWx0KCk7ZC5jbG9zZWQ9IWQuY2xvc2VkO3JldHVybiBmYWxzZX0pO2lmKCFhLmNsb3NlZCl0aGlzLmNsb3NlZD1mYWxzZX1hLmF1dG9QbGFjZSYmKGkuaXNVbmRlZmluZWQoYS5wYXJlbnQpJiYoRiYmKHY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksZy5hZGRDbGFzcyh2LCJkZyIpLGcuYWRkQ2xhc3ModiwKay5DTEFTU19BVVRPX1BMQUNFX0NPTlRBSU5FUiksZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh2KSxGPWZhbHNlKSx2LmFwcGVuZENoaWxkKHRoaXMuZG9tRWxlbWVudCksZy5hZGRDbGFzcyh0aGlzLmRvbUVsZW1lbnQsay5DTEFTU19BVVRPX1BMQUNFKSksdGhpcy5wYXJlbnR8fEQoZCxhLndpZHRoKSk7Zy5iaW5kKHdpbmRvdywicmVzaXplIixmdW5jdGlvbigpe2Qub25SZXNpemUoKX0pO2cuYmluZCh0aGlzLl9fdWwsIndlYmtpdFRyYW5zaXRpb25FbmQiLGZ1bmN0aW9uKCl7ZC5vblJlc2l6ZSgpfSk7Zy5iaW5kKHRoaXMuX191bCwidHJhbnNpdGlvbmVuZCIsZnVuY3Rpb24oKXtkLm9uUmVzaXplKCl9KTtnLmJpbmQodGhpcy5fX3VsLCJvVHJhbnNpdGlvbkVuZCIsZnVuY3Rpb24oKXtkLm9uUmVzaXplKCl9KTt0aGlzLm9uUmVzaXplKCk7YS5yZXNpemFibGUmJkoodGhpcyk7ZC5nZXRSb290KCk7YS5wYXJlbnR8fGMoKX07ay50b2dnbGVIaWRlPWZ1bmN0aW9uKCl7QT0hQTtpLmVhY2goRywKZnVuY3Rpb24oYSl7YS5kb21FbGVtZW50LnN0eWxlLnpJbmRleD1BPy05OTk6OTk5O2EuZG9tRWxlbWVudC5zdHlsZS5vcGFjaXR5PUE/MDoxfSl9O2suQ0xBU1NfQVVUT19QTEFDRT0iYSI7ay5DTEFTU19BVVRPX1BMQUNFX0NPTlRBSU5FUj0iYWMiO2suQ0xBU1NfTUFJTj0ibWFpbiI7ay5DTEFTU19DT05UUk9MTEVSX1JPVz0iY3IiO2suQ0xBU1NfVE9PX1RBTEw9InRhbGxlci10aGFuLXdpbmRvdyI7ay5DTEFTU19DTE9TRUQ9ImNsb3NlZCI7ay5DTEFTU19DTE9TRV9CVVRUT049ImNsb3NlLWJ1dHRvbiI7ay5DTEFTU19EUkFHPSJkcmFnIjtrLkRFRkFVTFRfV0lEVEg9MjQ1O2suVEVYVF9DTE9TRUQ9IkNsb3NlIENvbnRyb2xzIjtrLlRFWFRfT1BFTj0iT3BlbiBDb250cm9scyI7Zy5iaW5kKHdpbmRvdywia2V5ZG93biIsZnVuY3Rpb24oYSl7ZG9jdW1lbnQuYWN0aXZlRWxlbWVudC50eXBlIT09InRleHQiJiYoYS53aGljaD09PTcyfHxhLmtleUNvZGU9PTcyKSYmay50b2dnbGVIaWRlKCl9LApmYWxzZSk7aS5leHRlbmQoay5wcm90b3R5cGUse2FkZDpmdW5jdGlvbihhLGIpe3JldHVybiBxKHRoaXMsYSxiLHtmYWN0b3J5QXJnczpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMil9KX0sYWRkQ29sb3I6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gcSh0aGlzLGEsYix7Y29sb3I6dHJ1ZX0pfSxyZW1vdmU6ZnVuY3Rpb24oYSl7dGhpcy5fX3VsLnJlbW92ZUNoaWxkKGEuX19saSk7dGhpcy5fX2NvbnRyb2xsZXJzLnNsaWNlKHRoaXMuX19jb250cm9sbGVycy5pbmRleE9mKGEpLDEpO3ZhciBiPXRoaXM7aS5kZWZlcihmdW5jdGlvbigpe2Iub25SZXNpemUoKX0pfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5hdXRvUGxhY2UmJnYucmVtb3ZlQ2hpbGQodGhpcy5kb21FbGVtZW50KX0sYWRkRm9sZGVyOmZ1bmN0aW9uKGEpe2lmKHRoaXMuX19mb2xkZXJzW2FdIT09dm9pZCAwKXRocm93IEVycm9yKCdZb3UgYWxyZWFkeSBoYXZlIGEgZm9sZGVyIGluIHRoaXMgR1VJIGJ5IHRoZSBuYW1lICInKwphKyciJyk7dmFyIGI9e25hbWU6YSxwYXJlbnQ6dGhpc307Yi5hdXRvUGxhY2U9dGhpcy5hdXRvUGxhY2U7aWYodGhpcy5sb2FkJiZ0aGlzLmxvYWQuZm9sZGVycyYmdGhpcy5sb2FkLmZvbGRlcnNbYV0pYi5jbG9zZWQ9dGhpcy5sb2FkLmZvbGRlcnNbYV0uY2xvc2VkLGIubG9hZD10aGlzLmxvYWQuZm9sZGVyc1thXTtiPW5ldyBrKGIpO3RoaXMuX19mb2xkZXJzW2FdPWI7YT1zKHRoaXMsYi5kb21FbGVtZW50KTtnLmFkZENsYXNzKGEsImZvbGRlciIpO3JldHVybiBifSxvcGVuOmZ1bmN0aW9uKCl7dGhpcy5jbG9zZWQ9ZmFsc2V9LGNsb3NlOmZ1bmN0aW9uKCl7dGhpcy5jbG9zZWQ9dHJ1ZX0sb25SZXNpemU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmdldFJvb3QoKTtpZihhLnNjcm9sbGFibGUpe3ZhciBiPWcuZ2V0T2Zmc2V0KGEuX191bCkudG9wLGM9MDtpLmVhY2goYS5fX3VsLmNoaWxkTm9kZXMsZnVuY3Rpb24oYil7YS5hdXRvUGxhY2UmJmI9PT1hLl9fc2F2ZV9yb3d8fChjKz0KZy5nZXRIZWlnaHQoYikpfSk7d2luZG93LmlubmVySGVpZ2h0LWItMjA8Yz8oZy5hZGRDbGFzcyhhLmRvbUVsZW1lbnQsay5DTEFTU19UT09fVEFMTCksYS5fX3VsLnN0eWxlLmhlaWdodD13aW5kb3cuaW5uZXJIZWlnaHQtYi0yMCsicHgiKTooZy5yZW1vdmVDbGFzcyhhLmRvbUVsZW1lbnQsay5DTEFTU19UT09fVEFMTCksYS5fX3VsLnN0eWxlLmhlaWdodD0iYXV0byIpfWEuX19yZXNpemVfaGFuZGxlJiZpLmRlZmVyKGZ1bmN0aW9uKCl7YS5fX3Jlc2l6ZV9oYW5kbGUuc3R5bGUuaGVpZ2h0PWEuX191bC5vZmZzZXRIZWlnaHQrInB4In0pO2lmKGEuX19jbG9zZUJ1dHRvbilhLl9fY2xvc2VCdXR0b24uc3R5bGUud2lkdGg9YS53aWR0aCsicHgifSxyZW1lbWJlcjpmdW5jdGlvbigpe2lmKGkuaXNVbmRlZmluZWQoeCkpeD1uZXcgeSx4LmRvbUVsZW1lbnQuaW5uZXJIVE1MPWE7aWYodGhpcy5wYXJlbnQpdGhyb3cgRXJyb3IoIllvdSBjYW4gb25seSBjYWxsIHJlbWVtYmVyIG9uIGEgdG9wIGxldmVsIEdVSS4iKTsKdmFyIGI9dGhpcztpLmVhY2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSxmdW5jdGlvbihhKXtiLl9fcmVtZW1iZXJlZE9iamVjdHMubGVuZ3RoPT0wJiZJKGIpO2IuX19yZW1lbWJlcmVkT2JqZWN0cy5pbmRleE9mKGEpPT0tMSYmYi5fX3JlbWVtYmVyZWRPYmplY3RzLnB1c2goYSl9KTt0aGlzLmF1dG9QbGFjZSYmRCh0aGlzLHRoaXMud2lkdGgpfSxnZXRSb290OmZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXM7YS5wYXJlbnQ7KWE9YS5wYXJlbnQ7cmV0dXJuIGF9LGdldFNhdmVPYmplY3Q6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmxvYWQ7YS5jbG9zZWQ9dGhpcy5jbG9zZWQ7aWYodGhpcy5fX3JlbWVtYmVyZWRPYmplY3RzLmxlbmd0aD4wKXthLnByZXNldD10aGlzLnByZXNldDtpZighYS5yZW1lbWJlcmVkKWEucmVtZW1iZXJlZD17fTthLnJlbWVtYmVyZWRbdGhpcy5wcmVzZXRdPXoodGhpcyl9YS5mb2xkZXJzPXt9O2kuZWFjaCh0aGlzLl9fZm9sZGVycyxmdW5jdGlvbihiLApjKXthLmZvbGRlcnNbY109Yi5nZXRTYXZlT2JqZWN0KCl9KTtyZXR1cm4gYX0sc2F2ZTpmdW5jdGlvbigpe2lmKCF0aGlzLmxvYWQucmVtZW1iZXJlZCl0aGlzLmxvYWQucmVtZW1iZXJlZD17fTt0aGlzLmxvYWQucmVtZW1iZXJlZFt0aGlzLnByZXNldF09eih0aGlzKTtCKHRoaXMsZmFsc2UpfSxzYXZlQXM6ZnVuY3Rpb24oYSl7aWYoIXRoaXMubG9hZC5yZW1lbWJlcmVkKXRoaXMubG9hZC5yZW1lbWJlcmVkPXt9LHRoaXMubG9hZC5yZW1lbWJlcmVkW3ddPXoodGhpcyx0cnVlKTt0aGlzLmxvYWQucmVtZW1iZXJlZFthXT16KHRoaXMpO3RoaXMucHJlc2V0PWE7Qyh0aGlzLGEsdHJ1ZSl9LHJldmVydDpmdW5jdGlvbihhKXtpLmVhY2godGhpcy5fX2NvbnRyb2xsZXJzLGZ1bmN0aW9uKGIpe3RoaXMuZ2V0Um9vdCgpLmxvYWQucmVtZW1iZXJlZD90KGF8fHRoaXMuZ2V0Um9vdCgpLGIpOmIuc2V0VmFsdWUoYi5pbml0aWFsVmFsdWUpfSx0aGlzKTtpLmVhY2godGhpcy5fX2ZvbGRlcnMsCmZ1bmN0aW9uKGEpe2EucmV2ZXJ0KGEpfSk7YXx8Qih0aGlzLmdldFJvb3QoKSxmYWxzZSl9LGxpc3RlbjpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9fbGlzdGVuaW5nLmxlbmd0aD09MDt0aGlzLl9fbGlzdGVuaW5nLnB1c2goYSk7YiYmRSh0aGlzLl9fbGlzdGVuaW5nKX19KTtyZXR1cm4ga30oZGF0LnV0aWxzLmNzcywnPGRpdiBpZD0iZGctc2F2ZSIgY2xhc3M9ImRnIGRpYWxvZ3VlIj5cblxuICBIZXJlXCdzIHRoZSBuZXcgbG9hZCBwYXJhbWV0ZXIgZm9yIHlvdXIgPGNvZGU+R1VJPC9jb2RlPlwncyBjb25zdHJ1Y3RvcjpcblxuICA8dGV4dGFyZWEgaWQ9ImRnLW5ldy1jb25zdHJ1Y3RvciI+PC90ZXh0YXJlYT5cblxuICA8ZGl2IGlkPSJkZy1zYXZlLWxvY2FsbHkiPlxuXG4gICAgPGlucHV0IGlkPSJkZy1sb2NhbC1zdG9yYWdlIiB0eXBlPSJjaGVja2JveCIvPiBBdXRvbWF0aWNhbGx5IHNhdmVcbiAgICB2YWx1ZXMgdG8gPGNvZGU+bG9jYWxTdG9yYWdlPC9jb2RlPiBvbiBleGl0LlxuXG4gICAgPGRpdiBpZD0iZGctbG9jYWwtZXhwbGFpbiI+VGhlIHZhbHVlcyBzYXZlZCB0byA8Y29kZT5sb2NhbFN0b3JhZ2U8L2NvZGU+IHdpbGxcbiAgICAgIG92ZXJyaWRlIHRob3NlIHBhc3NlZCB0byA8Y29kZT5kYXQuR1VJPC9jb2RlPlwncyBjb25zdHJ1Y3Rvci4gVGhpcyBtYWtlcyBpdFxuICAgICAgZWFzaWVyIHRvIHdvcmsgaW5jcmVtZW50YWxseSwgYnV0IDxjb2RlPmxvY2FsU3RvcmFnZTwvY29kZT4gaXMgZnJhZ2lsZSxcbiAgICAgIGFuZCB5b3VyIGZyaWVuZHMgbWF5IG5vdCBzZWUgdGhlIHNhbWUgdmFsdWVzIHlvdSBkby5cbiAgICAgIFxuICAgIDwvZGl2PlxuICAgIFxuICA8L2Rpdj5cblxuPC9kaXY+JywKIi5kZyB1bHtsaXN0LXN0eWxlOm5vbmU7bWFyZ2luOjA7cGFkZGluZzowO3dpZHRoOjEwMCU7Y2xlYXI6Ym90aH0uZGcuYWN7cG9zaXRpb246Zml4ZWQ7dG9wOjA7bGVmdDowO3JpZ2h0OjA7aGVpZ2h0OjA7ei1pbmRleDowfS5kZzpub3QoLmFjKSAubWFpbntvdmVyZmxvdzpoaWRkZW59LmRnLm1haW57LXdlYmtpdC10cmFuc2l0aW9uOm9wYWNpdHkgMC4xcyBsaW5lYXI7LW8tdHJhbnNpdGlvbjpvcGFjaXR5IDAuMXMgbGluZWFyOy1tb3otdHJhbnNpdGlvbjpvcGFjaXR5IDAuMXMgbGluZWFyO3RyYW5zaXRpb246b3BhY2l0eSAwLjFzIGxpbmVhcn0uZGcubWFpbi50YWxsZXItdGhhbi13aW5kb3d7b3ZlcmZsb3cteTphdXRvfS5kZy5tYWluLnRhbGxlci10aGFuLXdpbmRvdyAuY2xvc2UtYnV0dG9ue29wYWNpdHk6MTttYXJnaW4tdG9wOi0xcHg7Ym9yZGVyLXRvcDoxcHggc29saWQgIzJjMmMyY30uZGcubWFpbiB1bC5jbG9zZWQgLmNsb3NlLWJ1dHRvbntvcGFjaXR5OjEgIWltcG9ydGFudH0uZGcubWFpbjpob3ZlciAuY2xvc2UtYnV0dG9uLC5kZy5tYWluIC5jbG9zZS1idXR0b24uZHJhZ3tvcGFjaXR5OjF9LmRnLm1haW4gLmNsb3NlLWJ1dHRvbnstd2Via2l0LXRyYW5zaXRpb246b3BhY2l0eSAwLjFzIGxpbmVhcjstby10cmFuc2l0aW9uOm9wYWNpdHkgMC4xcyBsaW5lYXI7LW1vei10cmFuc2l0aW9uOm9wYWNpdHkgMC4xcyBsaW5lYXI7dHJhbnNpdGlvbjpvcGFjaXR5IDAuMXMgbGluZWFyO2JvcmRlcjowO3Bvc2l0aW9uOmFic29sdXRlO2xpbmUtaGVpZ2h0OjE5cHg7aGVpZ2h0OjIwcHg7Y3Vyc29yOnBvaW50ZXI7dGV4dC1hbGlnbjpjZW50ZXI7YmFja2dyb3VuZC1jb2xvcjojMDAwfS5kZy5tYWluIC5jbG9zZS1idXR0b246aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojMTExfS5kZy5he2Zsb2F0OnJpZ2h0O21hcmdpbi1yaWdodDoxNXB4O292ZXJmbG93LXg6aGlkZGVufS5kZy5hLmhhcy1zYXZlIHVse21hcmdpbi10b3A6MjdweH0uZGcuYS5oYXMtc2F2ZSB1bC5jbG9zZWR7bWFyZ2luLXRvcDowfS5kZy5hIC5zYXZlLXJvd3twb3NpdGlvbjpmaXhlZDt0b3A6MDt6LWluZGV4OjEwMDJ9LmRnIGxpey13ZWJraXQtdHJhbnNpdGlvbjpoZWlnaHQgMC4xcyBlYXNlLW91dDstby10cmFuc2l0aW9uOmhlaWdodCAwLjFzIGVhc2Utb3V0Oy1tb3otdHJhbnNpdGlvbjpoZWlnaHQgMC4xcyBlYXNlLW91dDt0cmFuc2l0aW9uOmhlaWdodCAwLjFzIGVhc2Utb3V0fS5kZyBsaTpub3QoLmZvbGRlcil7Y3Vyc29yOmF1dG87aGVpZ2h0OjI3cHg7bGluZS1oZWlnaHQ6MjdweDtvdmVyZmxvdzpoaWRkZW47cGFkZGluZzowIDRweCAwIDVweH0uZGcgbGkuZm9sZGVye3BhZGRpbmc6MDtib3JkZXItbGVmdDo0cHggc29saWQgcmdiYSgwLDAsMCwwKX0uZGcgbGkudGl0bGV7Y3Vyc29yOnBvaW50ZXI7bWFyZ2luLWxlZnQ6LTRweH0uZGcgLmNsb3NlZCBsaTpub3QoLnRpdGxlKSwuZGcgLmNsb3NlZCB1bCBsaSwuZGcgLmNsb3NlZCB1bCBsaSA+ICp7aGVpZ2h0OjA7b3ZlcmZsb3c6aGlkZGVuO2JvcmRlcjowfS5kZyAuY3J7Y2xlYXI6Ym90aDtwYWRkaW5nLWxlZnQ6M3B4O2hlaWdodDoyN3B4fS5kZyAucHJvcGVydHktbmFtZXtjdXJzb3I6ZGVmYXVsdDtmbG9hdDpsZWZ0O2NsZWFyOmxlZnQ7d2lkdGg6NDAlO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzfS5kZyAuY3tmbG9hdDpsZWZ0O3dpZHRoOjYwJX0uZGcgLmMgaW5wdXRbdHlwZT10ZXh0XXtib3JkZXI6MDttYXJnaW4tdG9wOjRweDtwYWRkaW5nOjNweDt3aWR0aDoxMDAlO2Zsb2F0OnJpZ2h0fS5kZyAuaGFzLXNsaWRlciBpbnB1dFt0eXBlPXRleHRde3dpZHRoOjMwJTttYXJnaW4tbGVmdDowfS5kZyAuc2xpZGVye2Zsb2F0OmxlZnQ7d2lkdGg6NjYlO21hcmdpbi1sZWZ0Oi01cHg7bWFyZ2luLXJpZ2h0OjA7aGVpZ2h0OjE5cHg7bWFyZ2luLXRvcDo0cHh9LmRnIC5zbGlkZXItZmd7aGVpZ2h0OjEwMCV9LmRnIC5jIGlucHV0W3R5cGU9Y2hlY2tib3hde21hcmdpbi10b3A6OXB4fS5kZyAuYyBzZWxlY3R7bWFyZ2luLXRvcDo1cHh9LmRnIC5jci5mdW5jdGlvbiwuZGcgLmNyLmZ1bmN0aW9uIC5wcm9wZXJ0eS1uYW1lLC5kZyAuY3IuZnVuY3Rpb24gKiwuZGcgLmNyLmJvb2xlYW4sLmRnIC5jci5ib29sZWFuICp7Y3Vyc29yOnBvaW50ZXJ9LmRnIC5zZWxlY3RvcntkaXNwbGF5Om5vbmU7cG9zaXRpb246YWJzb2x1dGU7bWFyZ2luLWxlZnQ6LTlweDttYXJnaW4tdG9wOjIzcHg7ei1pbmRleDoxMH0uZGcgLmM6aG92ZXIgLnNlbGVjdG9yLC5kZyAuc2VsZWN0b3IuZHJhZ3tkaXNwbGF5OmJsb2NrfS5kZyBsaS5zYXZlLXJvd3twYWRkaW5nOjB9LmRnIGxpLnNhdmUtcm93IC5idXR0b257ZGlzcGxheTppbmxpbmUtYmxvY2s7cGFkZGluZzowcHggNnB4fS5kZy5kaWFsb2d1ZXtiYWNrZ3JvdW5kLWNvbG9yOiMyMjI7d2lkdGg6NDYwcHg7cGFkZGluZzoxNXB4O2ZvbnQtc2l6ZToxM3B4O2xpbmUtaGVpZ2h0OjE1cHh9I2RnLW5ldy1jb25zdHJ1Y3RvcntwYWRkaW5nOjEwcHg7Y29sb3I6IzIyMjtmb250LWZhbWlseTpNb25hY28sIG1vbm9zcGFjZTtmb250LXNpemU6MTBweDtib3JkZXI6MDtyZXNpemU6bm9uZTtib3gtc2hhZG93Omluc2V0IDFweCAxcHggMXB4ICM4ODg7d29yZC13cmFwOmJyZWFrLXdvcmQ7bWFyZ2luOjEycHggMDtkaXNwbGF5OmJsb2NrO3dpZHRoOjQ0MHB4O292ZXJmbG93LXk6c2Nyb2xsO2hlaWdodDoxMDBweDtwb3NpdGlvbjpyZWxhdGl2ZX0jZGctbG9jYWwtZXhwbGFpbntkaXNwbGF5Om5vbmU7Zm9udC1zaXplOjExcHg7bGluZS1oZWlnaHQ6MTdweDtib3JkZXItcmFkaXVzOjNweDtiYWNrZ3JvdW5kLWNvbG9yOiMzMzM7cGFkZGluZzo4cHg7bWFyZ2luLXRvcDoxMHB4fSNkZy1sb2NhbC1leHBsYWluIGNvZGV7Zm9udC1zaXplOjEwcHh9I2RhdC1ndWktc2F2ZS1sb2NhbGx5e2Rpc3BsYXk6bm9uZX0uZGd7Y29sb3I6I2VlZTtmb250OjExcHggJ0x1Y2lkYSBHcmFuZGUnLCBzYW5zLXNlcmlmO3RleHQtc2hhZG93OjAgLTFweCAwICMxMTF9LmRnLm1haW46Oi13ZWJraXQtc2Nyb2xsYmFye3dpZHRoOjVweDtiYWNrZ3JvdW5kOiMxYTFhMWF9LmRnLm1haW46Oi13ZWJraXQtc2Nyb2xsYmFyLWNvcm5lcntoZWlnaHQ6MDtkaXNwbGF5Om5vbmV9LmRnLm1haW46Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1ie2JvcmRlci1yYWRpdXM6NXB4O2JhY2tncm91bmQ6IzY3Njc2N30uZGcgbGk6bm90KC5mb2xkZXIpe2JhY2tncm91bmQ6IzFhMWExYTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjMmMyYzJjfS5kZyBsaS5zYXZlLXJvd3tsaW5lLWhlaWdodDoyNXB4O2JhY2tncm91bmQ6I2RhZDVjYjtib3JkZXI6MH0uZGcgbGkuc2F2ZS1yb3cgc2VsZWN0e21hcmdpbi1sZWZ0OjVweDt3aWR0aDoxMDhweH0uZGcgbGkuc2F2ZS1yb3cgLmJ1dHRvbnttYXJnaW4tbGVmdDo1cHg7bWFyZ2luLXRvcDoxcHg7Ym9yZGVyLXJhZGl1czoycHg7Zm9udC1zaXplOjlweDtsaW5lLWhlaWdodDo3cHg7cGFkZGluZzo0cHggNHB4IDVweCA0cHg7YmFja2dyb3VuZDojYzViZGFkO2NvbG9yOiNmZmY7dGV4dC1zaGFkb3c6MCAxcHggMCAjYjBhNThmO2JveC1zaGFkb3c6MCAtMXB4IDAgI2IwYTU4ZjtjdXJzb3I6cG9pbnRlcn0uZGcgbGkuc2F2ZS1yb3cgLmJ1dHRvbi5nZWFyc3tiYWNrZ3JvdW5kOiNjNWJkYWQgdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQXNBQUFBTkNBWUFBQUIvOVpRN0FBQUFHWFJGV0hSVGIyWjBkMkZ5WlFCQlpHOWlaU0JKYldGblpWSmxZV1I1Y2NsbFBBQUFBUUpKUkVGVWVOcGlZS0FVL1AvL1B3R0lDL0FwQ0FCaUJTQVcrSThBQ2xBY2dLeFE0VDlob01BRVVyeHgyUVNHTjYrZWdEWCsvdldUNGU3TjgyQU1Zb1BBeC9ldndXb1lvU1liQUNYMnM3S3hDeHpjc2V6RGgzZXZGb0RFQllURUVxeWNnZ1dBekE5QXVVU1FRZ2VZUGE5ZlB2Ni9ZV20vQWN4NUlQYjd0eS9mdytRWmJsdzY3dkRzOFIwWUh5UWhnT2J4K3lBSmtCcW1HNWRQUERoMWFQT0dSL2V1Z1cwRzR2bElvVElmeUZjQStRZWtoaEhKaFBkUXhiaUFJZ3VNQlRRWnJQRDcxMDhNNnJvV1lERlFpSUFBdjZBb3cvMWJGd1hnaXMrZjJMVUF5bndvSWFOY3o4WE54M0RsN01FSlVER1FweDlndFE4WUN1ZUIrRDI2T0VDQUFRRGFkdDdlNDZENDJRQUFBQUJKUlU1RXJrSmdnZz09KSAycHggMXB4IG5vLXJlcGVhdDtoZWlnaHQ6N3B4O3dpZHRoOjhweH0uZGcgbGkuc2F2ZS1yb3cgLmJ1dHRvbjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiNiYWIxOWU7Ym94LXNoYWRvdzowIC0xcHggMCAjYjBhNThmfS5kZyBsaS5mb2xkZXJ7Ym9yZGVyLWJvdHRvbTowfS5kZyBsaS50aXRsZXtwYWRkaW5nLWxlZnQ6MTZweDtiYWNrZ3JvdW5kOiMwMDAgdXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEJRQUZBSkVBQVAvLy8vUHo4Ly8vLy8vLy95SDVCQUVBQUFJQUxBQUFBQUFGQUFVQUFBSUlsSStoS2dGeG9DZ0FPdz09KSA2cHggMTBweCBuby1yZXBlYXQ7Y3Vyc29yOnBvaW50ZXI7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjIpfS5kZyAuY2xvc2VkIGxpLnRpdGxle2JhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEJRQUZBSkVBQVAvLy8vUHo4Ly8vLy8vLy95SDVCQUVBQUFJQUxBQUFBQUFGQUFVQUFBSUlsR0lXcU1DYldBRUFPdz09KX0uZGcgLmNyLmJvb2xlYW57Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICM4MDY3ODd9LmRnIC5jci5mdW5jdGlvbntib3JkZXItbGVmdDozcHggc29saWQgI2U2MWQ1Zn0uZGcgLmNyLm51bWJlcntib3JkZXItbGVmdDozcHggc29saWQgIzJmYTFkNn0uZGcgLmNyLm51bWJlciBpbnB1dFt0eXBlPXRleHRde2NvbG9yOiMyZmExZDZ9LmRnIC5jci5zdHJpbmd7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICMxZWQzNmZ9LmRnIC5jci5zdHJpbmcgaW5wdXRbdHlwZT10ZXh0XXtjb2xvcjojMWVkMzZmfS5kZyAuY3IuZnVuY3Rpb246aG92ZXIsLmRnIC5jci5ib29sZWFuOmhvdmVye2JhY2tncm91bmQ6IzExMX0uZGcgLmMgaW5wdXRbdHlwZT10ZXh0XXtiYWNrZ3JvdW5kOiMzMDMwMzA7b3V0bGluZTpub25lfS5kZyAuYyBpbnB1dFt0eXBlPXRleHRdOmhvdmVye2JhY2tncm91bmQ6IzNjM2MzY30uZGcgLmMgaW5wdXRbdHlwZT10ZXh0XTpmb2N1c3tiYWNrZ3JvdW5kOiM0OTQ5NDk7Y29sb3I6I2ZmZn0uZGcgLmMgLnNsaWRlcntiYWNrZ3JvdW5kOiMzMDMwMzA7Y3Vyc29yOmV3LXJlc2l6ZX0uZGcgLmMgLnNsaWRlci1mZ3tiYWNrZ3JvdW5kOiMyZmExZDZ9LmRnIC5jIC5zbGlkZXI6aG92ZXJ7YmFja2dyb3VuZDojM2MzYzNjfS5kZyAuYyAuc2xpZGVyOmhvdmVyIC5zbGlkZXItZmd7YmFja2dyb3VuZDojNDRhYmRhfVxuIiwKZGF0LmNvbnRyb2xsZXJzLmZhY3Rvcnk9ZnVuY3Rpb24oZSxhLGMsZCxmLGIsbil7cmV0dXJuIGZ1bmN0aW9uKGgsaixtLGwpe3ZhciBvPWhbal07aWYobi5pc0FycmF5KG0pfHxuLmlzT2JqZWN0KG0pKXJldHVybiBuZXcgZShoLGosbSk7aWYobi5pc051bWJlcihvKSlyZXR1cm4gbi5pc051bWJlcihtKSYmbi5pc051bWJlcihsKT9uZXcgYyhoLGosbSxsKTpuZXcgYShoLGose21pbjptLG1heDpsfSk7aWYobi5pc1N0cmluZyhvKSlyZXR1cm4gbmV3IGQoaCxqKTtpZihuLmlzRnVuY3Rpb24obykpcmV0dXJuIG5ldyBmKGgsaiwiIik7aWYobi5pc0Jvb2xlYW4obykpcmV0dXJuIG5ldyBiKGgsail9fShkYXQuY29udHJvbGxlcnMuT3B0aW9uQ29udHJvbGxlcixkYXQuY29udHJvbGxlcnMuTnVtYmVyQ29udHJvbGxlckJveCxkYXQuY29udHJvbGxlcnMuTnVtYmVyQ29udHJvbGxlclNsaWRlcixkYXQuY29udHJvbGxlcnMuU3RyaW5nQ29udHJvbGxlcj1mdW5jdGlvbihlLGEsYyl7dmFyIGQ9CmZ1bmN0aW9uKGMsYil7ZnVuY3Rpb24gZSgpe2guc2V0VmFsdWUoaC5fX2lucHV0LnZhbHVlKX1kLnN1cGVyY2xhc3MuY2FsbCh0aGlzLGMsYik7dmFyIGg9dGhpczt0aGlzLl9faW5wdXQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTt0aGlzLl9faW5wdXQuc2V0QXR0cmlidXRlKCJ0eXBlIiwidGV4dCIpO2EuYmluZCh0aGlzLl9faW5wdXQsImtleXVwIixlKTthLmJpbmQodGhpcy5fX2lucHV0LCJjaGFuZ2UiLGUpO2EuYmluZCh0aGlzLl9faW5wdXQsImJsdXIiLGZ1bmN0aW9uKCl7aC5fX29uRmluaXNoQ2hhbmdlJiZoLl9fb25GaW5pc2hDaGFuZ2UuY2FsbChoLGguZ2V0VmFsdWUoKSl9KTthLmJpbmQodGhpcy5fX2lucHV0LCJrZXlkb3duIixmdW5jdGlvbihhKXthLmtleUNvZGU9PT0xMyYmdGhpcy5ibHVyKCl9KTt0aGlzLnVwZGF0ZURpc3BsYXkoKTt0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fX2lucHV0KX07ZC5zdXBlcmNsYXNzPWU7Yy5leHRlbmQoZC5wcm90b3R5cGUsCmUucHJvdG90eXBlLHt1cGRhdGVEaXNwbGF5OmZ1bmN0aW9uKCl7aWYoIWEuaXNBY3RpdmUodGhpcy5fX2lucHV0KSl0aGlzLl9faW5wdXQudmFsdWU9dGhpcy5nZXRWYWx1ZSgpO3JldHVybiBkLnN1cGVyY2xhc3MucHJvdG90eXBlLnVwZGF0ZURpc3BsYXkuY2FsbCh0aGlzKX19KTtyZXR1cm4gZH0oZGF0LmNvbnRyb2xsZXJzLkNvbnRyb2xsZXIsZGF0LmRvbS5kb20sZGF0LnV0aWxzLmNvbW1vbiksZGF0LmNvbnRyb2xsZXJzLkZ1bmN0aW9uQ29udHJvbGxlcixkYXQuY29udHJvbGxlcnMuQm9vbGVhbkNvbnRyb2xsZXIsZGF0LnV0aWxzLmNvbW1vbiksZGF0LmNvbnRyb2xsZXJzLkNvbnRyb2xsZXIsZGF0LmNvbnRyb2xsZXJzLkJvb2xlYW5Db250cm9sbGVyLGRhdC5jb250cm9sbGVycy5GdW5jdGlvbkNvbnRyb2xsZXIsZGF0LmNvbnRyb2xsZXJzLk51bWJlckNvbnRyb2xsZXJCb3gsZGF0LmNvbnRyb2xsZXJzLk51bWJlckNvbnRyb2xsZXJTbGlkZXIsZGF0LmNvbnRyb2xsZXJzLk9wdGlvbkNvbnRyb2xsZXIsCmRhdC5jb250cm9sbGVycy5Db2xvckNvbnRyb2xsZXI9ZnVuY3Rpb24oZSxhLGMsZCxmKXtmdW5jdGlvbiBiKGEsYixjLGQpe2Euc3R5bGUuYmFja2dyb3VuZD0iIjtmLmVhY2goaixmdW5jdGlvbihlKXthLnN0eWxlLmNzc1RleHQrPSJiYWNrZ3JvdW5kOiAiK2UrImxpbmVhci1ncmFkaWVudCgiK2IrIiwgIitjKyIgMCUsICIrZCsiIDEwMCUpOyAifSl9ZnVuY3Rpb24gbihhKXthLnN0eWxlLmJhY2tncm91bmQ9IiI7YS5zdHlsZS5jc3NUZXh0Kz0iYmFja2dyb3VuZDogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAgI2ZmMDAwMCAwJSwgI2ZmMDBmZiAxNyUsICMwMDAwZmYgMzQlLCAjMDBmZmZmIDUwJSwgIzAwZmYwMCA2NyUsICNmZmZmMDAgODQlLCAjZmYwMDAwIDEwMCUpOyI7YS5zdHlsZS5jc3NUZXh0Kz0iYmFja2dyb3VuZDogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQodG9wLCAgI2ZmMDAwMCAwJSwjZmYwMGZmIDE3JSwjMDAwMGZmIDM0JSwjMDBmZmZmIDUwJSwjMDBmZjAwIDY3JSwjZmZmZjAwIDg0JSwjZmYwMDAwIDEwMCUpOyI7CmEuc3R5bGUuY3NzVGV4dCs9ImJhY2tncm91bmQ6IC1vLWxpbmVhci1ncmFkaWVudCh0b3AsICAjZmYwMDAwIDAlLCNmZjAwZmYgMTclLCMwMDAwZmYgMzQlLCMwMGZmZmYgNTAlLCMwMGZmMDAgNjclLCNmZmZmMDAgODQlLCNmZjAwMDAgMTAwJSk7IjthLnN0eWxlLmNzc1RleHQrPSJiYWNrZ3JvdW5kOiAtbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgICNmZjAwMDAgMCUsI2ZmMDBmZiAxNyUsIzAwMDBmZiAzNCUsIzAwZmZmZiA1MCUsIzAwZmYwMCA2NyUsI2ZmZmYwMCA4NCUsI2ZmMDAwMCAxMDAlKTsiO2Euc3R5bGUuY3NzVGV4dCs9ImJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0b3AsICAjZmYwMDAwIDAlLCNmZjAwZmYgMTclLCMwMDAwZmYgMzQlLCMwMGZmZmYgNTAlLCMwMGZmMDAgNjclLCNmZmZmMDAgODQlLCNmZjAwMDAgMTAwJSk7In12YXIgaD1mdW5jdGlvbihlLGwpe2Z1bmN0aW9uIG8oYil7cShiKTthLmJpbmQod2luZG93LCJtb3VzZW1vdmUiLHEpO2EuYmluZCh3aW5kb3csCiJtb3VzZXVwIixqKX1mdW5jdGlvbiBqKCl7YS51bmJpbmQod2luZG93LCJtb3VzZW1vdmUiLHEpO2EudW5iaW5kKHdpbmRvdywibW91c2V1cCIsail9ZnVuY3Rpb24gZygpe3ZhciBhPWQodGhpcy52YWx1ZSk7YSE9PWZhbHNlPyhwLl9fY29sb3IuX19zdGF0ZT1hLHAuc2V0VmFsdWUocC5fX2NvbG9yLnRvT3JpZ2luYWwoKSkpOnRoaXMudmFsdWU9cC5fX2NvbG9yLnRvU3RyaW5nKCl9ZnVuY3Rpb24gaSgpe2EudW5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixzKTthLnVuYmluZCh3aW5kb3csIm1vdXNldXAiLGkpfWZ1bmN0aW9uIHEoYil7Yi5wcmV2ZW50RGVmYXVsdCgpO3ZhciBjPWEuZ2V0V2lkdGgocC5fX3NhdHVyYXRpb25fZmllbGQpLGQ9YS5nZXRPZmZzZXQocC5fX3NhdHVyYXRpb25fZmllbGQpLGU9KGIuY2xpZW50WC1kLmxlZnQrZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0KS9jLGI9MS0oYi5jbGllbnRZLWQudG9wK2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKS9jO2I+MT9iPQoxOmI8MCYmKGI9MCk7ZT4xP2U9MTplPDAmJihlPTApO3AuX19jb2xvci52PWI7cC5fX2NvbG9yLnM9ZTtwLnNldFZhbHVlKHAuX19jb2xvci50b09yaWdpbmFsKCkpO3JldHVybiBmYWxzZX1mdW5jdGlvbiBzKGIpe2IucHJldmVudERlZmF1bHQoKTt2YXIgYz1hLmdldEhlaWdodChwLl9faHVlX2ZpZWxkKSxkPWEuZ2V0T2Zmc2V0KHAuX19odWVfZmllbGQpLGI9MS0oYi5jbGllbnRZLWQudG9wK2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKS9jO2I+MT9iPTE6YjwwJiYoYj0wKTtwLl9fY29sb3IuaD1iKjM2MDtwLnNldFZhbHVlKHAuX19jb2xvci50b09yaWdpbmFsKCkpO3JldHVybiBmYWxzZX1oLnN1cGVyY2xhc3MuY2FsbCh0aGlzLGUsbCk7dGhpcy5fX2NvbG9yPW5ldyBjKHRoaXMuZ2V0VmFsdWUoKSk7dGhpcy5fX3RlbXA9bmV3IGMoMCk7dmFyIHA9dGhpczt0aGlzLmRvbUVsZW1lbnQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7YS5tYWtlU2VsZWN0YWJsZSh0aGlzLmRvbUVsZW1lbnQsCmZhbHNlKTt0aGlzLl9fc2VsZWN0b3I9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dGhpcy5fX3NlbGVjdG9yLmNsYXNzTmFtZT0ic2VsZWN0b3IiO3RoaXMuX19zYXR1cmF0aW9uX2ZpZWxkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3RoaXMuX19zYXR1cmF0aW9uX2ZpZWxkLmNsYXNzTmFtZT0ic2F0dXJhdGlvbi1maWVsZCI7dGhpcy5fX2ZpZWxkX2tub2I9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dGhpcy5fX2ZpZWxkX2tub2IuY2xhc3NOYW1lPSJmaWVsZC1rbm9iIjt0aGlzLl9fZmllbGRfa25vYl9ib3JkZXI9IjJweCBzb2xpZCAiO3RoaXMuX19odWVfa25vYj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLl9faHVlX2tub2IuY2xhc3NOYW1lPSJodWUta25vYiI7dGhpcy5fX2h1ZV9maWVsZD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLl9faHVlX2ZpZWxkLmNsYXNzTmFtZT0iaHVlLWZpZWxkIjt0aGlzLl9faW5wdXQ9CmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7dGhpcy5fX2lucHV0LnR5cGU9InRleHQiO3RoaXMuX19pbnB1dF90ZXh0U2hhZG93PSIwIDFweCAxcHggIjthLmJpbmQodGhpcy5fX2lucHV0LCJrZXlkb3duIixmdW5jdGlvbihhKXthLmtleUNvZGU9PT0xMyYmZy5jYWxsKHRoaXMpfSk7YS5iaW5kKHRoaXMuX19pbnB1dCwiYmx1ciIsZyk7YS5iaW5kKHRoaXMuX19zZWxlY3RvciwibW91c2Vkb3duIixmdW5jdGlvbigpe2EuYWRkQ2xhc3ModGhpcywiZHJhZyIpLmJpbmQod2luZG93LCJtb3VzZXVwIixmdW5jdGlvbigpe2EucmVtb3ZlQ2xhc3MocC5fX3NlbGVjdG9yLCJkcmFnIil9KX0pO3ZhciB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2YuZXh0ZW5kKHRoaXMuX19zZWxlY3Rvci5zdHlsZSx7d2lkdGg6IjEyMnB4IixoZWlnaHQ6IjEwMnB4IixwYWRkaW5nOiIzcHgiLGJhY2tncm91bmRDb2xvcjoiIzIyMiIsYm94U2hhZG93OiIwcHggMXB4IDNweCByZ2JhKDAsMCwwLDAuMykifSk7CmYuZXh0ZW5kKHRoaXMuX19maWVsZF9rbm9iLnN0eWxlLHtwb3NpdGlvbjoiYWJzb2x1dGUiLHdpZHRoOiIxMnB4IixoZWlnaHQ6IjEycHgiLGJvcmRlcjp0aGlzLl9fZmllbGRfa25vYl9ib3JkZXIrKHRoaXMuX19jb2xvci52PDAuNT8iI2ZmZiI6IiMwMDAiKSxib3hTaGFkb3c6IjBweCAxcHggM3B4IHJnYmEoMCwwLDAsMC41KSIsYm9yZGVyUmFkaXVzOiIxMnB4Iix6SW5kZXg6MX0pO2YuZXh0ZW5kKHRoaXMuX19odWVfa25vYi5zdHlsZSx7cG9zaXRpb246ImFic29sdXRlIix3aWR0aDoiMTVweCIsaGVpZ2h0OiIycHgiLGJvcmRlclJpZ2h0OiI0cHggc29saWQgI2ZmZiIsekluZGV4OjF9KTtmLmV4dGVuZCh0aGlzLl9fc2F0dXJhdGlvbl9maWVsZC5zdHlsZSx7d2lkdGg6IjEwMHB4IixoZWlnaHQ6IjEwMHB4Iixib3JkZXI6IjFweCBzb2xpZCAjNTU1IixtYXJnaW5SaWdodDoiM3B4IixkaXNwbGF5OiJpbmxpbmUtYmxvY2siLGN1cnNvcjoicG9pbnRlciJ9KTtmLmV4dGVuZCh0LnN0eWxlLAp7d2lkdGg6IjEwMCUiLGhlaWdodDoiMTAwJSIsYmFja2dyb3VuZDoibm9uZSJ9KTtiKHQsInRvcCIsInJnYmEoMCwwLDAsMCkiLCIjMDAwIik7Zi5leHRlbmQodGhpcy5fX2h1ZV9maWVsZC5zdHlsZSx7d2lkdGg6IjE1cHgiLGhlaWdodDoiMTAwcHgiLGRpc3BsYXk6ImlubGluZS1ibG9jayIsYm9yZGVyOiIxcHggc29saWQgIzU1NSIsY3Vyc29yOiJucy1yZXNpemUifSk7bih0aGlzLl9faHVlX2ZpZWxkKTtmLmV4dGVuZCh0aGlzLl9faW5wdXQuc3R5bGUse291dGxpbmU6Im5vbmUiLHRleHRBbGlnbjoiY2VudGVyIixjb2xvcjoiI2ZmZiIsYm9yZGVyOjAsZm9udFdlaWdodDoiYm9sZCIsdGV4dFNoYWRvdzp0aGlzLl9faW5wdXRfdGV4dFNoYWRvdysicmdiYSgwLDAsMCwwLjcpIn0pO2EuYmluZCh0aGlzLl9fc2F0dXJhdGlvbl9maWVsZCwibW91c2Vkb3duIixvKTthLmJpbmQodGhpcy5fX2ZpZWxkX2tub2IsIm1vdXNlZG93biIsbyk7YS5iaW5kKHRoaXMuX19odWVfZmllbGQsIm1vdXNlZG93biIsCmZ1bmN0aW9uKGIpe3MoYik7YS5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixzKTthLmJpbmQod2luZG93LCJtb3VzZXVwIixpKX0pO3RoaXMuX19zYXR1cmF0aW9uX2ZpZWxkLmFwcGVuZENoaWxkKHQpO3RoaXMuX19zZWxlY3Rvci5hcHBlbmRDaGlsZCh0aGlzLl9fZmllbGRfa25vYik7dGhpcy5fX3NlbGVjdG9yLmFwcGVuZENoaWxkKHRoaXMuX19zYXR1cmF0aW9uX2ZpZWxkKTt0aGlzLl9fc2VsZWN0b3IuYXBwZW5kQ2hpbGQodGhpcy5fX2h1ZV9maWVsZCk7dGhpcy5fX2h1ZV9maWVsZC5hcHBlbmRDaGlsZCh0aGlzLl9faHVlX2tub2IpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9faW5wdXQpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fc2VsZWN0b3IpO3RoaXMudXBkYXRlRGlzcGxheSgpfTtoLnN1cGVyY2xhc3M9ZTtmLmV4dGVuZChoLnByb3RvdHlwZSxlLnByb3RvdHlwZSx7dXBkYXRlRGlzcGxheTpmdW5jdGlvbigpe3ZhciBhPWQodGhpcy5nZXRWYWx1ZSgpKTsKaWYoYSE9PWZhbHNlKXt2YXIgZT1mYWxzZTtmLmVhY2goYy5DT01QT05FTlRTLGZ1bmN0aW9uKGIpe2lmKCFmLmlzVW5kZWZpbmVkKGFbYl0pJiYhZi5pc1VuZGVmaW5lZCh0aGlzLl9fY29sb3IuX19zdGF0ZVtiXSkmJmFbYl0hPT10aGlzLl9fY29sb3IuX19zdGF0ZVtiXSlyZXR1cm4gZT10cnVlLHt9fSx0aGlzKTtlJiZmLmV4dGVuZCh0aGlzLl9fY29sb3IuX19zdGF0ZSxhKX1mLmV4dGVuZCh0aGlzLl9fdGVtcC5fX3N0YXRlLHRoaXMuX19jb2xvci5fX3N0YXRlKTt0aGlzLl9fdGVtcC5hPTE7dmFyIGg9dGhpcy5fX2NvbG9yLnY8MC41fHx0aGlzLl9fY29sb3Iucz4wLjU/MjU1OjAsaj0yNTUtaDtmLmV4dGVuZCh0aGlzLl9fZmllbGRfa25vYi5zdHlsZSx7bWFyZ2luTGVmdDoxMDAqdGhpcy5fX2NvbG9yLnMtNysicHgiLG1hcmdpblRvcDoxMDAqKDEtdGhpcy5fX2NvbG9yLnYpLTcrInB4IixiYWNrZ3JvdW5kQ29sb3I6dGhpcy5fX3RlbXAudG9TdHJpbmcoKSxib3JkZXI6dGhpcy5fX2ZpZWxkX2tub2JfYm9yZGVyKwoicmdiKCIraCsiLCIraCsiLCIraCsiKSJ9KTt0aGlzLl9faHVlX2tub2Iuc3R5bGUubWFyZ2luVG9wPSgxLXRoaXMuX19jb2xvci5oLzM2MCkqMTAwKyJweCI7dGhpcy5fX3RlbXAucz0xO3RoaXMuX190ZW1wLnY9MTtiKHRoaXMuX19zYXR1cmF0aW9uX2ZpZWxkLCJsZWZ0IiwiI2ZmZiIsdGhpcy5fX3RlbXAudG9TdHJpbmcoKSk7Zi5leHRlbmQodGhpcy5fX2lucHV0LnN0eWxlLHtiYWNrZ3JvdW5kQ29sb3I6dGhpcy5fX2lucHV0LnZhbHVlPXRoaXMuX19jb2xvci50b1N0cmluZygpLGNvbG9yOiJyZ2IoIitoKyIsIitoKyIsIitoKyIpIix0ZXh0U2hhZG93OnRoaXMuX19pbnB1dF90ZXh0U2hhZG93KyJyZ2JhKCIraisiLCIraisiLCIraisiLC43KSJ9KX19KTt2YXIgaj1bIi1tb3otIiwiLW8tIiwiLXdlYmtpdC0iLCItbXMtIiwiIl07cmV0dXJuIGh9KGRhdC5jb250cm9sbGVycy5Db250cm9sbGVyLGRhdC5kb20uZG9tLGRhdC5jb2xvci5Db2xvcj1mdW5jdGlvbihlLGEsYyxkKXtmdW5jdGlvbiBmKGEsCmIsYyl7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsYix7Z2V0OmZ1bmN0aW9uKCl7aWYodGhpcy5fX3N0YXRlLnNwYWNlPT09IlJHQiIpcmV0dXJuIHRoaXMuX19zdGF0ZVtiXTtuKHRoaXMsYixjKTtyZXR1cm4gdGhpcy5fX3N0YXRlW2JdfSxzZXQ6ZnVuY3Rpb24oYSl7aWYodGhpcy5fX3N0YXRlLnNwYWNlIT09IlJHQiIpbih0aGlzLGIsYyksdGhpcy5fX3N0YXRlLnNwYWNlPSJSR0IiO3RoaXMuX19zdGF0ZVtiXT1hfX0pfWZ1bmN0aW9uIGIoYSxiKXtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxiLHtnZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLl9fc3RhdGUuc3BhY2U9PT0iSFNWIilyZXR1cm4gdGhpcy5fX3N0YXRlW2JdO2godGhpcyk7cmV0dXJuIHRoaXMuX19zdGF0ZVtiXX0sc2V0OmZ1bmN0aW9uKGEpe2lmKHRoaXMuX19zdGF0ZS5zcGFjZSE9PSJIU1YiKWgodGhpcyksdGhpcy5fX3N0YXRlLnNwYWNlPSJIU1YiO3RoaXMuX19zdGF0ZVtiXT1hfX0pfWZ1bmN0aW9uIG4oYixjLGUpe2lmKGIuX19zdGF0ZS5zcGFjZT09PQoiSEVYIiliLl9fc3RhdGVbY109YS5jb21wb25lbnRfZnJvbV9oZXgoYi5fX3N0YXRlLmhleCxlKTtlbHNlIGlmKGIuX19zdGF0ZS5zcGFjZT09PSJIU1YiKWQuZXh0ZW5kKGIuX19zdGF0ZSxhLmhzdl90b19yZ2IoYi5fX3N0YXRlLmgsYi5fX3N0YXRlLnMsYi5fX3N0YXRlLnYpKTtlbHNlIHRocm93IkNvcnJ1cHRlZCBjb2xvciBzdGF0ZSI7fWZ1bmN0aW9uIGgoYil7dmFyIGM9YS5yZ2JfdG9faHN2KGIucixiLmcsYi5iKTtkLmV4dGVuZChiLl9fc3RhdGUse3M6Yy5zLHY6Yy52fSk7aWYoZC5pc05hTihjLmgpKXtpZihkLmlzVW5kZWZpbmVkKGIuX19zdGF0ZS5oKSliLl9fc3RhdGUuaD0wfWVsc2UgYi5fX3N0YXRlLmg9Yy5ofXZhciBqPWZ1bmN0aW9uKCl7dGhpcy5fX3N0YXRlPWUuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKHRoaXMuX19zdGF0ZT09PWZhbHNlKXRocm93IkZhaWxlZCB0byBpbnRlcnByZXQgY29sb3IgYXJndW1lbnRzIjt0aGlzLl9fc3RhdGUuYT10aGlzLl9fc3RhdGUuYXx8CjF9O2ouQ09NUE9ORU5UUz0icixnLGIsaCxzLHYsaGV4LGEiLnNwbGl0KCIsIik7ZC5leHRlbmQoai5wcm90b3R5cGUse3RvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIGModGhpcyl9LHRvT3JpZ2luYWw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fX3N0YXRlLmNvbnZlcnNpb24ud3JpdGUodGhpcyl9fSk7ZihqLnByb3RvdHlwZSwiciIsMik7ZihqLnByb3RvdHlwZSwiZyIsMSk7ZihqLnByb3RvdHlwZSwiYiIsMCk7YihqLnByb3RvdHlwZSwiaCIpO2Ioai5wcm90b3R5cGUsInMiKTtiKGoucHJvdG90eXBlLCJ2Iik7T2JqZWN0LmRlZmluZVByb3BlcnR5KGoucHJvdG90eXBlLCJhIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX19zdGF0ZS5hfSxzZXQ6ZnVuY3Rpb24oYSl7dGhpcy5fX3N0YXRlLmE9YX19KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoai5wcm90b3R5cGUsImhleCIse2dldDpmdW5jdGlvbigpe2lmKCF0aGlzLl9fc3RhdGUuc3BhY2UhPT0iSEVYIil0aGlzLl9fc3RhdGUuaGV4PQphLnJnYl90b19oZXgodGhpcy5yLHRoaXMuZyx0aGlzLmIpO3JldHVybiB0aGlzLl9fc3RhdGUuaGV4fSxzZXQ6ZnVuY3Rpb24oYSl7dGhpcy5fX3N0YXRlLnNwYWNlPSJIRVgiO3RoaXMuX19zdGF0ZS5oZXg9YX19KTtyZXR1cm4gan0oZGF0LmNvbG9yLmludGVycHJldCxkYXQuY29sb3IubWF0aD1mdW5jdGlvbigpe3ZhciBlO3JldHVybntoc3ZfdG9fcmdiOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1hLzYwLU1hdGguZmxvb3IoYS82MCksYj1kKigxLWMpLG49ZCooMS1lKmMpLGM9ZCooMS0oMS1lKSpjKSxhPVtbZCxjLGJdLFtuLGQsYl0sW2IsZCxjXSxbYixuLGRdLFtjLGIsZF0sW2QsYixuXV1bTWF0aC5mbG9vcihhLzYwKSU2XTtyZXR1cm57cjphWzBdKjI1NSxnOmFbMV0qMjU1LGI6YVsyXSoyNTV9fSxyZ2JfdG9faHN2OmZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1NYXRoLm1pbihhLGMsZCksYj1NYXRoLm1heChhLGMsZCksZT1iLWU7aWYoYj09MClyZXR1cm57aDpOYU4sczowLHY6MH07CmE9YT09Yj8oYy1kKS9lOmM9PWI/MisoZC1hKS9lOjQrKGEtYykvZTthLz02O2E8MCYmKGErPTEpO3JldHVybntoOmEqMzYwLHM6ZS9iLHY6Yi8yNTV9fSxyZ2JfdG9faGV4OmZ1bmN0aW9uKGEsYyxkKXthPXRoaXMuaGV4X3dpdGhfY29tcG9uZW50KDAsMixhKTthPXRoaXMuaGV4X3dpdGhfY29tcG9uZW50KGEsMSxjKTtyZXR1cm4gYT10aGlzLmhleF93aXRoX2NvbXBvbmVudChhLDAsZCl9LGNvbXBvbmVudF9mcm9tX2hleDpmdW5jdGlvbihhLGMpe3JldHVybiBhPj5jKjgmMjU1fSxoZXhfd2l0aF9jb21wb25lbnQ6ZnVuY3Rpb24oYSxjLGQpe3JldHVybiBkPDwoZT1jKjgpfGEmfigyNTU8PGUpfX19KCksZGF0LmNvbG9yLnRvU3RyaW5nLGRhdC51dGlscy5jb21tb24pLGRhdC5jb2xvci5pbnRlcnByZXQsZGF0LnV0aWxzLmNvbW1vbiksZGF0LnV0aWxzLnJlcXVlc3RBbmltYXRpb25GcmFtZT1mdW5jdGlvbigpe3JldHVybiB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHwKd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZXx8d2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZXx8ZnVuY3Rpb24oZSl7d2luZG93LnNldFRpbWVvdXQoZSwxRTMvNjApfX0oKSxkYXQuZG9tLkNlbnRlcmVkRGl2PWZ1bmN0aW9uKGUsYSl7dmFyIGM9ZnVuY3Rpb24oKXt0aGlzLmJhY2tncm91bmRFbGVtZW50PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2EuZXh0ZW5kKHRoaXMuYmFja2dyb3VuZEVsZW1lbnQuc3R5bGUse2JhY2tncm91bmRDb2xvcjoicmdiYSgwLDAsMCwwLjgpIix0b3A6MCxsZWZ0OjAsZGlzcGxheToibm9uZSIsekluZGV4OiIxMDAwIixvcGFjaXR5OjAsV2Via2l0VHJhbnNpdGlvbjoib3BhY2l0eSAwLjJzIGxpbmVhciJ9KTtlLm1ha2VGdWxsc2NyZWVuKHRoaXMuYmFja2dyb3VuZEVsZW1lbnQpO3RoaXMuYmFja2dyb3VuZEVsZW1lbnQuc3R5bGUucG9zaXRpb249ImZpeGVkIjt0aGlzLmRvbUVsZW1lbnQ9CmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2EuZXh0ZW5kKHRoaXMuZG9tRWxlbWVudC5zdHlsZSx7cG9zaXRpb246ImZpeGVkIixkaXNwbGF5OiJub25lIix6SW5kZXg6IjEwMDEiLG9wYWNpdHk6MCxXZWJraXRUcmFuc2l0aW9uOiItd2Via2l0LXRyYW5zZm9ybSAwLjJzIGVhc2Utb3V0LCBvcGFjaXR5IDAuMnMgbGluZWFyIn0pO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5iYWNrZ3JvdW5kRWxlbWVudCk7ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmRvbUVsZW1lbnQpO3ZhciBjPXRoaXM7ZS5iaW5kKHRoaXMuYmFja2dyb3VuZEVsZW1lbnQsImNsaWNrIixmdW5jdGlvbigpe2MuaGlkZSgpfSl9O2MucHJvdG90eXBlLnNob3c9ZnVuY3Rpb24oKXt2YXIgYz10aGlzO3RoaXMuYmFja2dyb3VuZEVsZW1lbnQuc3R5bGUuZGlzcGxheT0iYmxvY2siO3RoaXMuZG9tRWxlbWVudC5zdHlsZS5kaXNwbGF5PSJibG9jayI7dGhpcy5kb21FbGVtZW50LnN0eWxlLm9wYWNpdHk9CjA7dGhpcy5kb21FbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybT0ic2NhbGUoMS4xKSI7dGhpcy5sYXlvdXQoKTthLmRlZmVyKGZ1bmN0aW9uKCl7Yy5iYWNrZ3JvdW5kRWxlbWVudC5zdHlsZS5vcGFjaXR5PTE7Yy5kb21FbGVtZW50LnN0eWxlLm9wYWNpdHk9MTtjLmRvbUVsZW1lbnQuc3R5bGUud2Via2l0VHJhbnNmb3JtPSJzY2FsZSgxKSJ9KX07Yy5wcm90b3R5cGUuaGlkZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMsYz1mdW5jdGlvbigpe2EuZG9tRWxlbWVudC5zdHlsZS5kaXNwbGF5PSJub25lIjthLmJhY2tncm91bmRFbGVtZW50LnN0eWxlLmRpc3BsYXk9Im5vbmUiO2UudW5iaW5kKGEuZG9tRWxlbWVudCwid2Via2l0VHJhbnNpdGlvbkVuZCIsYyk7ZS51bmJpbmQoYS5kb21FbGVtZW50LCJ0cmFuc2l0aW9uZW5kIixjKTtlLnVuYmluZChhLmRvbUVsZW1lbnQsIm9UcmFuc2l0aW9uRW5kIixjKX07ZS5iaW5kKHRoaXMuZG9tRWxlbWVudCwid2Via2l0VHJhbnNpdGlvbkVuZCIsCmMpO2UuYmluZCh0aGlzLmRvbUVsZW1lbnQsInRyYW5zaXRpb25lbmQiLGMpO2UuYmluZCh0aGlzLmRvbUVsZW1lbnQsIm9UcmFuc2l0aW9uRW5kIixjKTt0aGlzLmJhY2tncm91bmRFbGVtZW50LnN0eWxlLm9wYWNpdHk9MDt0aGlzLmRvbUVsZW1lbnQuc3R5bGUub3BhY2l0eT0wO3RoaXMuZG9tRWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2Zvcm09InNjYWxlKDEuMSkifTtjLnByb3RvdHlwZS5sYXlvdXQ9ZnVuY3Rpb24oKXt0aGlzLmRvbUVsZW1lbnQuc3R5bGUubGVmdD13aW5kb3cuaW5uZXJXaWR0aC8yLWUuZ2V0V2lkdGgodGhpcy5kb21FbGVtZW50KS8yKyJweCI7dGhpcy5kb21FbGVtZW50LnN0eWxlLnRvcD13aW5kb3cuaW5uZXJIZWlnaHQvMi1lLmdldEhlaWdodCh0aGlzLmRvbUVsZW1lbnQpLzIrInB4In07cmV0dXJuIGN9KGRhdC5kb20uZG9tLGRhdC51dGlscy5jb21tb24pLGRhdC5kb20uZG9tLGRhdC51dGlscy5jb21tb24pOwooZnVuY3Rpb24oKXsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyBNZXNoIFByb3BlcnRpZXMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHZhciBNRVNIID0gewogICAgd2lkdGg6IDEuMiwKICAgIGhlaWdodDogMS4yLAogICAgc2xpY2VzOiAyNTAsCiAgICBkZXB0aDogMCwKICAgIG1heGRlcHRoOiAyMDAsCiAgICBhbWJpZW50OiAnIzU1NTU1NScsCiAgICBkaWZmdXNlOiAnI0ZGRkZGRicKICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIExpZ2h0IFByb3BlcnRpZXMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHZhciBMSUdIVCA9IHsKICAgIGNvdW50OiAwLAogICAgeFBvcyA6IDAsCiAgICB5UG9zIDogMjAwLAogICAgek9mZnNldDogMTAwLAogICAgYW1iaWVudDogJyM4ODAwNjYnLAogICAgZGlmZnVzZTogJyNGRjg4MDAnLAogICAgcGlja2VkdXAgOnRydWUsCiAgICBwcm94eSA6IGZhbHNlLAogICAgY3VyckluZGV4IDogMCwKICAgIHJhbmRvbWl6ZSA6IGZ1bmN0aW9uKCl7CiAgICAgIHZhciB4LHksejsKICAgICAgdmFyIGRlY2lkZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzKSArIDE7CgogICAgICBpZiAoZGVjaWRlciA9PSAxKSBNRVNILmRlcHRoID0gMDsKICAgICAgaWYgKGRlY2lkZXIgPT0gMikgTUVTSC5kZXB0aCA9IE1hdGgucmFuZG9tSW5SYW5nZSgwLCAxNTApOwogICAgICBpZiAoZGVjaWRlciA9PSAzKSBNRVNILmRlcHRoID0gTWF0aC5yYW5kb21JblJhbmdlKDE1MCwgMjAwKTsKCiAgICAgIGZvciAobCA9IHNjZW5lLmxpZ2h0cy5sZW5ndGggLSAxOyBsID49IDA7IGwtLSkgewogICAgICAgIHggPSBNYXRoLnJhbmRvbUluUmFuZ2UoLW1lc2guZ2VvbWV0cnkud2lkdGgvMiwgbWVzaC5nZW9tZXRyeS53aWR0aC8yKTsKICAgICAgICB5ID0gTWF0aC5yYW5kb21JblJhbmdlKC1tZXNoLmdlb21ldHJ5LmhlaWdodC8yLCBtZXNoLmdlb21ldHJ5LmhlaWdodC8yKTsKICAgICAgICBpZihzY2VuZS5saWdodHMubGVuZ3RoID4gMikgeiA9IE1hdGgucmFuZG9tSW5SYW5nZSgxMCwgODApOwogICAgICAgIGVsc2UgeiA9IE1hdGgucmFuZG9tSW5SYW5nZSgxMCwgMTAwKTsKCiAgICAgICAgbGlnaHQgPSBzY2VuZS5saWdodHNbbF07CiAgICAgICAgRlNTLlZlY3RvcjMuc2V0KGxpZ2h0LnBvc2l0aW9uLCB4LCB5LCB6KTsKCiAgICAgICAgdmFyIGRpZmZ1c2UgPSBnZXRSYW5kb21Db2xvcigpOwogICAgICAgIHZhciBhbWJpZW50ID0gZ2V0UmFuZG9tQ29sb3IoKTsKCiAgICAgICAgbGlnaHQuZGlmZnVzZS5zZXQoZGlmZnVzZSk7CiAgICAgICAgbGlnaHQuZGlmZnVzZUhleCA9IGxpZ2h0LmRpZmZ1c2UuZm9ybWF0KCk7CgogICAgICAgIGxpZ2h0LmFtYmllbnQuc2V0KGFtYmllbnQpOwogICAgICAgIGxpZ2h0LmFtYmllbnRIZXggPSBsaWdodC5hbWJpZW50LmZvcm1hdCgpOwoKICAgICAgICBMSUdIVC54UG9zICAgID0geDsKICAgICAgICBMSUdIVC55UG9zICAgID0geTsKICAgICAgICBMSUdIVC56T2Zmc2V0ID0gejsKICAgICAgICBMSUdIVC5kaWZmdXNlID0gZGlmZnVzZTsKICAgICAgICBMSUdIVC5hbWJpZW50ID0gYW1iaWVudDsKCiAgICAgICAgLy8gSGFja3kgd2F5IHRvIGFsbG93IG1hbnVhbCB1cGRhdGUgb2YgdGhlIEhFWCBjb2xvcnMgZm9yIGxpZ2h0J3MgZGlmZnVzZQogICAgICAgIGd1aS5fX2ZvbGRlcnMuTGlnaHQuX19jb250cm9sbGVyc1sxXS51cGRhdGVEaXNwbGF5KCk7CiAgICAgICAgZ3VpLl9fZm9sZGVycy5MaWdodC5fX2NvbnRyb2xsZXJzWzJdLnVwZGF0ZURpc3BsYXkoKTsKICAgICAgfQogICAgfQogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gUmVuZGVyIFByb3BlcnRpZXMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHZhciBXRUJHTCA9ICd3ZWJnbCc7CiAgdmFyIENBTlZBUyA9ICdjYW52YXMnOwogIHZhciBTVkcgPSAnc3ZnJzsKICB2YXIgUkVOREVSID0gewogICAgcmVuZGVyZXI6IENBTlZBUwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gRXhwb3J0IFByb3BlcnRpZXMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHZhciBFWFBPUlQgPSB7CiAgICB3aWR0aDogMjAwMCwKICAgIGhlaWdodDogMTAwMCwKCiAgICBleHBvcnRDdXJyZW50OiBmdW5jdGlvbigpewogICAgICBzd2l0Y2goUkVOREVSLnJlbmRlcmVyKSB7CiAgICAgICAgY2FzZSBXRUJHTDoKICAgICAgICAgIHdpbmRvdy5vcGVuKHdlYmdsUmVuZGVyZXIuZWxlbWVudC50b0RhdGFVUkwoKSwgJ19ibGFuaycpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBDQU5WQVM6CiAgICAgICAgICB3aW5kb3cub3BlbihjYW52YXNSZW5kZXJlci5lbGVtZW50LnRvRGF0YVVSTCgpLCAnX2JsYW5rJyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFNWRzoKICAgICAgICAgIHZhciBkYXRhID0gZW5jb2RlVVJJQ29tcG9uZW50KG91dHB1dC5pbm5lckhUTUwpOwogICAgICAgICAgdmFyIHVybCA9ICJkYXRhOmltYWdlL3N2Zyt4bWwsIiArIGRhdGE7CiAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgZXhwb3J0OiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGwsIHgsIHksIGxpZ2h0LAogICAgICAgIHNjYWxhclggPSB0aGlzLndpZHRoIC8gcmVuZGVyZXIud2lkdGgsCiAgICAgICAgc2NhbGFyWSA9IHRoaXMuaGVpZ2h0IC8gcmVuZGVyZXIuaGVpZ2h0OwoKICAgICAgLy8gc3RvcmUgYSB0ZW1wIHZhbHVlIG9mIHRoZSBzbGljZXMKICAgICAgdmFyIHNsaWNlcyA9IE1FU0guc2xpY2VzOwogICAgICAvLyBJbmNyZWFzZSBvciBkZWNyZWFzZSBudW1iZXIgb2Ygc2xpY2VzIGRlcGVuZGluZyBvbiB0aGUgc2l6ZSBvZiB0aGUgY2FudmFzCiAgICAgIE1FU0guc2xpY2VzID0gTWF0aC5jZWlsKHNsaWNlcypzY2FsYXJYKjEuNCk7CgogICAgICAvLyBSZWdlbmVyYXRlIHRoZSB3aG9sZSBjYW52YXMKICAgICAgcmVzaXplKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsKCiAgICAgIC8vIHJlc3RvcmUgdGhlIG51bWJlciBvZiBzbGljZXMKICAgICAgTUVTSC5zbGljZXMgPSBzbGljZXM7CgogICAgICAvLyBNb3ZlIHRoZSBsaWdodHMgb24gdGhlIHBsYW5lIHRvIGFjY29tb2RhdGUgdGhlIHNpemUgb2YgdGhlIGNhbnZhcwogICAgICBmb3IgKGwgPSBzY2VuZS5saWdodHMubGVuZ3RoIC0gMTsgbCA+PSAwOyBsLS0pIHsKICAgICAgICBsaWdodCA9IHNjZW5lLmxpZ2h0c1tsXTsKICAgICAgICB4ID0gbGlnaHQucG9zaXRpb25bMF07CiAgICAgICAgeSA9IGxpZ2h0LnBvc2l0aW9uWzFdOwogICAgICAgIHogPSBsaWdodC5wb3NpdGlvblsyXTsKICAgICAgICBGU1MuVmVjdG9yMy5zZXQobGlnaHQucG9zaXRpb24sIHgqc2NhbGFyWCwgeSpzY2FsYXJZLCB6KnNjYWxhclgpOwogICAgICB9CgogICAgICAvLyBVcGRhdGUgZGVwdGggb2YgdGhlIHRyaWFuZ2xlcwogICAgICB1cGRhdGUoKTsKICAgICAgLy8gUmVuZGVyIHRoZSBjYW52YXMKICAgICAgcmVuZGVyKCk7CgogICAgICBzd2l0Y2goUkVOREVSLnJlbmRlcmVyKSB7CiAgICAgICAgY2FzZSBXRUJHTDoKICAgICAgICAgIHdpbmRvdy5vcGVuKHdlYmdsUmVuZGVyZXIuZWxlbWVudC50b0RhdGFVUkwoKSwgJ19ibGFuaycpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBDQU5WQVM6CiAgICAgICAgICB3aW5kb3cub3BlbihjYW52YXNSZW5kZXJlci5lbGVtZW50LnRvRGF0YVVSTCgpLCAnX2JsYW5rJyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFNWRzoKICAgICAgICAgIHZhciBkYXRhID0gZW5jb2RlVVJJQ29tcG9uZW50KG91dHB1dC5pbm5lckhUTUwpOwogICAgICAgICAgdmFyIHVybCA9ICJkYXRhOmltYWdlL3N2Zyt4bWwsIiArIGRhdGE7CiAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICByZXNpemUoY29udGFpbmVyLm9mZnNldFdpZHRoLCBjb250YWluZXIub2Zmc2V0SGVpZ2h0KTsKCiAgICAgIGZvciAobCA9IHNjZW5lLmxpZ2h0cy5sZW5ndGggLSAxOyBsID49IDA7IGwtLSkgewogICAgICAgIGxpZ2h0ID0gc2NlbmUubGlnaHRzW2xdOwogICAgICAgIHggPSBsaWdodC5wb3NpdGlvblswXTsKICAgICAgICB5ID0gbGlnaHQucG9zaXRpb25bMV07CiAgICAgICAgeiA9IGxpZ2h0LnBvc2l0aW9uWzJdOwogICAgICAgIEZTUy5WZWN0b3IzLnNldChsaWdodC5wb3NpdGlvbiwgeC9zY2FsYXJYLCB5L3NjYWxhclksIHovc2NhbGFyWCk7CiAgICAgIH0KICAgIH0KICB9OwoKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyBHbG9iYWwgUHJvcGVydGllcwogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdmFyIGNlbnRlciA9IEZTUy5WZWN0b3IzLmNyZWF0ZSgpOwogIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyk7CiAgdmFyIGNvbnRyb2xzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRyb2xzJyk7CiAgdmFyIG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdXRwdXQnKTsKICB2YXIgcmVuZGVyZXIsIHNjZW5lLCBtZXNoLCBnZW9tZXRyeSwgbWF0ZXJpYWw7CiAgdmFyIHdlYmdsUmVuZGVyZXIsIGNhbnZhc1JlbmRlcmVyLCBzdmdSZW5kZXJlcjsKICB2YXIgZ3VpOwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIE1ldGhvZHMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIGZ1bmN0aW9uIGluaXRpYWxpc2UoKSB7CiAgICBjcmVhdGVSZW5kZXJlcigpOwogICAgY3JlYXRlU2NlbmUoKTsKICAgIGNyZWF0ZU1lc2goKTsKICAgIGFkZExpZ2h0cygpOwogICAgYWRkRXZlbnRMaXN0ZW5lcnMoKTsKICAgIGFkZENvbnRyb2xzKCk7CiAgICBMSUdIVC5yYW5kb21pemUoKTsKICAgIHJlc2l6ZShjb250YWluZXIub2Zmc2V0V2lkdGgsIGNvbnRhaW5lci5vZmZzZXRIZWlnaHQpOwogICAgYW5pbWF0ZSgpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlUmVuZGVyZXIoKSB7CiAgICB3ZWJnbFJlbmRlcmVyID0gbmV3IEZTUy5XZWJHTFJlbmRlcmVyKCk7CiAgICBjYW52YXNSZW5kZXJlciA9IG5ldyBGU1MuQ2FudmFzUmVuZGVyZXIoKTsKICAgIHN2Z1JlbmRlcmVyID0gbmV3IEZTUy5TVkdSZW5kZXJlcigpOwogICAgc2V0UmVuZGVyZXIoUkVOREVSLnJlbmRlcmVyKTsKICB9CgogIGZ1bmN0aW9uIHNldFJlbmRlcmVyKGluZGV4KSB7CiAgICBpZiAocmVuZGVyZXIpIHsKICAgICAgb3V0cHV0LnJlbW92ZUNoaWxkKHJlbmRlcmVyLmVsZW1lbnQpOwogICAgfQogICAgc3dpdGNoKGluZGV4KSB7CiAgICAgIGNhc2UgV0VCR0w6CiAgICAgICAgcmVuZGVyZXIgPSB3ZWJnbFJlbmRlcmVyOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIENBTlZBUzoKICAgICAgICByZW5kZXJlciA9IGNhbnZhc1JlbmRlcmVyOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFNWRzoKICAgICAgICByZW5kZXJlciA9IHN2Z1JlbmRlcmVyOwogICAgICAgIGJyZWFrOwogICAgfQogICAgcmVuZGVyZXIuc2V0U2l6ZShjb250YWluZXIub2Zmc2V0V2lkdGgsIGNvbnRhaW5lci5vZmZzZXRIZWlnaHQpOwogICAgb3V0cHV0LmFwcGVuZENoaWxkKHJlbmRlcmVyLmVsZW1lbnQpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlU2NlbmUoKSB7CiAgICBzY2VuZSA9IG5ldyBGU1MuU2NlbmUoKTsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZU1lc2goKSB7CiAgICBzY2VuZS5yZW1vdmUobWVzaCk7CiAgICByZW5kZXJlci5jbGVhcigpOwogICAgZ2VvbWV0cnkgPSBuZXcgRlNTLlBsYW5lKE1FU0gud2lkdGggKiByZW5kZXJlci53aWR0aCwgTUVTSC5oZWlnaHQgKiByZW5kZXJlci5oZWlnaHQsIE1FU0guc2xpY2VzKTsKICAgIG1hdGVyaWFsID0gbmV3IEZTUy5NYXRlcmlhbChNRVNILmFtYmllbnQsIE1FU0guZGlmZnVzZSk7CiAgICBtZXNoID0gbmV3IEZTUy5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICBzY2VuZS5hZGQobWVzaCk7CgogICAgLy8gQXVnbWVudCB2ZXJ0aWNlcyBmb3IgZGVwdGggbW9kaWZpY2F0aW9uCiAgICB2YXIgdiwgdmVydGV4OwogICAgZm9yICh2ID0gZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoIC0gMTsgdiA+PSAwOyB2LS0pIHsKICAgICAgdmVydGV4ID0gZ2VvbWV0cnkudmVydGljZXNbdl07CiAgICAgIHZlcnRleC5kZXB0aCA9IE1hdGgucmFuZG9tSW5SYW5nZSgwLCBNRVNILm1heGRlcHRoLzEwKTsKICAgICAgdmVydGV4LmFuY2hvciA9IEZTUy5WZWN0b3IzLmNsb25lKHZlcnRleC5wb3NpdGlvbik7CiAgICB9CiAgfQoKICAvLyBBZGQgYSBzaW5nbGUgbGlnaHQKICBmdW5jdGlvbiBhZGRMaWdodChhbWJpZW50LCBkaWZmdXNlLCB4LCB5LCB6KSB7CiAgICBhbWJpZW50ID0gdHlwZW9mIGFtYmllbnQgIT09ICd1bmRlZmluZWQnID8gYW1iaWVudCA6IExJR0hULmFtYmllbnQ7CiAgICBkaWZmdXNlID0gdHlwZW9mIGRpZmZ1c2UgIT09ICd1bmRlZmluZWQnID8gZGlmZnVzZSA6IGdldFJhbmRvbUNvbG9yKCk7CiAgICB4ID0gdHlwZW9mIHggIT09ICd1bmRlZmluZWQnID8geCA6IExJR0hULnhQb3M7CiAgICB5ID0gdHlwZW9mIHkgIT09ICd1bmRlZmluZWQnID8geSA6IExJR0hULnlQb3M7CiAgICB6ID0gdHlwZW9mIHogIT09ICd1bmRlZmluZWQnID8geiA6IExJR0hULnpPZmZzZXQ7CgogICAgcmVuZGVyZXIuY2xlYXIoKTsKICAgIGxpZ2h0ID0gbmV3IEZTUy5MaWdodChhbWJpZW50LCBkaWZmdXNlKTsKICAgIGxpZ2h0LmFtYmllbnRIZXggPSBsaWdodC5hbWJpZW50LmZvcm1hdCgpOwogICAgbGlnaHQuZGlmZnVzZUhleCA9IGxpZ2h0LmRpZmZ1c2UuZm9ybWF0KCk7CiAgICBsaWdodC5zZXRQb3NpdGlvbih4LCB5LCB6KTsKICAgIHNjZW5lLmFkZChsaWdodCk7CiAgICBMSUdIVC5kaWZmdXNlID0gZGlmZnVzZTsKICAgIExJR0hULnByb3h5ID0gbGlnaHQ7CiAgICBMSUdIVC5waWNrZWR1cCA9IHRydWU7CiAgICBMSUdIVC5jdXJySW5kZXgrKzsKICB9CgogIGZ1bmN0aW9uIGFkZExpZ2h0cygpIHsKICAgIHZhciBudW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KSArIDE7CgogICAgZm9yICh2YXIgaSA9IG51bSAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgIGFkZExpZ2h0KCk7CiAgICAgIExJR0hULmNvdW50Kys7CiAgICB9OwogIH0KCiAgLy8gUmVtb3ZlIGxpZ2h0cwogIGZ1bmN0aW9uIHRyaW1MaWdodHModmFsdWUpIHsKICAgIGZvciAobCA9IHZhbHVlOyBsIDw9IHNjZW5lLmxpZ2h0cy5sZW5ndGg7IGwrKykgewogICAgICBsaWdodCA9IHNjZW5lLmxpZ2h0c1tsXTsKICAgICAgc2NlbmUucmVtb3ZlKGxpZ2h0KTsKICAgICAgTElHSFQuY3VyckluZGV4LS07CiAgICB9CiAgICBMSUdIVC5wcm94eSA9IHNjZW5lLmxpZ2h0c1tMSUdIVC5jdXJySW5kZXgtMV07CiAgICBMSUdIVC5waWNrZWR1cCA9IGZhbHNlOwoKICAgIHJlbmRlcmVyLmNsZWFyKCk7CiAgfQoKICAvLyBSZXNpemUgY2FudmFzCiAgZnVuY3Rpb24gcmVzaXplKHdpZHRoLCBoZWlnaHQpIHsKICAgIHJlbmRlcmVyLnNldFNpemUod2lkdGgsIGhlaWdodCk7CiAgICBGU1MuVmVjdG9yMy5zZXQoY2VudGVyLCByZW5kZXJlci5oYWxmV2lkdGgsIHJlbmRlcmVyLmhhbGZIZWlnaHQpOwogICAgY3JlYXRlTWVzaCgpOwogIH0KCiAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgIHVwZGF0ZSgpOwogICAgcmVuZGVyKCk7CiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGUoKSB7CiAgICB2YXIgdiwgdmVydGV4LCBvZmZzZXQgPSBNRVNILmRlcHRoLzEwMDsKCiAgICAvLyBBZGQgZGVwdGggdG8gVmVydGljZXMKICAgIGZvciAodiA9IGdlb21ldHJ5LnZlcnRpY2VzLmxlbmd0aCAtIDE7IHYgPj0gMDsgdi0tKSB7CiAgICAgIHZlcnRleCA9IGdlb21ldHJ5LnZlcnRpY2VzW3ZdOwogICAgICBGU1MuVmVjdG9yMy5zZXQodmVydGV4LnBvc2l0aW9uLCAxLCAxLCB2ZXJ0ZXguZGVwdGgqb2Zmc2V0KTsKICAgICAgRlNTLlZlY3RvcjMuYWRkKHZlcnRleC5wb3NpdGlvbiwgdmVydGV4LmFuY2hvcik7CiAgICB9CgogICAgLy8gU2V0IHRoZSBHZW9tZXRyeSB0byBkaXJ0eQogICAgZ2VvbWV0cnkuZGlydHkgPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gcmVuZGVyKCkgewogICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lKTsKICB9CgogIGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXJzKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uV2luZG93UmVzaXplKTsKICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSk7CiAgfQoKICBmdW5jdGlvbiBhZGRDb250cm9scygpIHsKICAgIHZhciBpLCBsLCBsaWdodCwgZm9sZGVyLCBjb250cm9sbGVyOwoKICAgIC8vIENyZWF0ZSBHVUkKICAgIGd1aSA9IG5ldyBkYXQuR1VJKHthdXRvUGxhY2U6ZmFsc2V9KTsKCiAgICBjb250cm9scy5hcHBlbmRDaGlsZChndWkuZG9tRWxlbWVudCk7CgogICAgLy8gQ3JlYXRlIGZvbGRlcnMKICAgIHJlbmRlckZvbGRlciA9IGd1aS5hZGRGb2xkZXIoJ1JlbmRlcicpOwogICAgbWVzaEZvbGRlciA9IGd1aS5hZGRGb2xkZXIoJ01lc2gnKTsKICAgIGxpZ2h0Rm9sZGVyID0gZ3VpLmFkZEZvbGRlcignTGlnaHQnKTsKICAgIGV4cG9ydEZvbGRlciA9IGd1aS5hZGRGb2xkZXIoJ0V4cG9ydCcpOwoKICAgIC8vIE9wZW4gZm9sZGVycwogICAgbGlnaHRGb2xkZXIub3BlbigpOwoKICAgIC8vIEFkZCBSZW5kZXIgQ29udHJvbHMKICAgIGNvbnRyb2xsZXIgPSByZW5kZXJGb2xkZXIuYWRkKFJFTkRFUiwgJ3JlbmRlcmVyJywge3dlYmdsOldFQkdMLCBjYW52YXM6Q0FOVkFTLCBzdmc6U1ZHfSk7CiAgICBjb250cm9sbGVyLm9uQ2hhbmdlKGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHNldFJlbmRlcmVyKHZhbHVlKTsKICAgIH0pOwoKICAgIC8vIEFkZCBNZXNoIENvbnRyb2xzCiAgICBjb250cm9sbGVyID0gbWVzaEZvbGRlci5hZGRDb2xvcihNRVNILCAnYW1iaWVudCcpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBmb3IgKGkgPSAwLCBsID0gc2NlbmUubWVzaGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHNjZW5lLm1lc2hlc1tpXS5tYXRlcmlhbC5hbWJpZW50LnNldCh2YWx1ZSk7CiAgICAgIH0KICAgIH0pOwogICAgY29udHJvbGxlciA9IG1lc2hGb2xkZXIuYWRkQ29sb3IoTUVTSCwgJ2RpZmZ1c2UnKTsKICAgIGNvbnRyb2xsZXIub25DaGFuZ2UoZnVuY3Rpb24odmFsdWUpIHsKICAgICAgZm9yIChpID0gMCwgbCA9IHNjZW5lLm1lc2hlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBzY2VuZS5tZXNoZXNbaV0ubWF0ZXJpYWwuZGlmZnVzZS5zZXQodmFsdWUpOwogICAgICB9CiAgICB9KTsKICAgIGNvbnRyb2xsZXIgPSBtZXNoRm9sZGVyLmFkZChNRVNILCAnd2lkdGgnLCAwLjA1LCAyKTsKICAgIGNvbnRyb2xsZXIub25DaGFuZ2UoZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKGdlb21ldHJ5LndpZHRoICE9PSB2YWx1ZSAqIHJlbmRlcmVyLndpZHRoKSB7IGNyZWF0ZU1lc2goKTsgfQogICAgfSk7CiAgICBjb250cm9sbGVyID0gbWVzaEZvbGRlci5hZGQoTUVTSCwgJ2hlaWdodCcsIDAuMDUsIDIpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBpZiAoZ2VvbWV0cnkuaGVpZ2h0ICE9PSB2YWx1ZSAqIHJlbmRlcmVyLmhlaWdodCkgeyBjcmVhdGVNZXNoKCk7IH0KICAgIH0pOwoKICAgIGNvbnRyb2xsZXIgPSBtZXNoRm9sZGVyLmFkZChNRVNILCAnZGVwdGgnLCAwLCBNRVNILm1heGRlcHRoKS5saXN0ZW4oKTsKCiAgICBjb250cm9sbGVyID0gbWVzaEZvbGRlci5hZGQoTUVTSCwgJ3NsaWNlcycsIDEsIDgwMCk7CiAgICBjb250cm9sbGVyLnN0ZXAoMSk7CiAgICBjb250cm9sbGVyLm9uQ2hhbmdlKGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIGlmIChnZW9tZXRyeS5zbGljZXMgIT09IHZhbHVlKSB7IGNyZWF0ZU1lc2goKTsgfQogICAgfSk7CgogICAgLy8gQWRkIExpZ2h0IENvbnRyb2xzCiAgICAvLyBUT0RPOiBhZGQgdGhlIG51bWJlciBvZiBsaWdodHMgZHluYW1pY2FsbHkKICAgIGNvbnRyb2xsZXIgPSBsaWdodEZvbGRlci5hZGQoTElHSFQsICdjdXJySW5kZXgnLCB7MToxLCAyOjIsIDM6MywgNDo0LCA1OjUsIDY6NiwgNzo3fSkubmFtZSgnQ3VycmVudCBsaWdodCcpLmxpc3RlbigpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBMSUdIVC5wcm94eSA9IHNjZW5lLmxpZ2h0c1t2YWx1ZS0xXTsKCiAgICAgIExJR0hULmFtYmllbnQgPSBMSUdIVC5wcm94eS5hbWJpZW50LmhleDsKICAgICAgTElHSFQuZGlmZnVzZSA9IExJR0hULnByb3h5LmRpZmZ1c2UuaGV4OwogICAgICBMSUdIVC54UG9zICAgID0gTElHSFQucHJveHkucG9zaXRpb25bMF07CiAgICAgIExJR0hULnlQb3MgICAgPSBMSUdIVC5wcm94eS5wb3NpdGlvblsxXTsKICAgICAgTElHSFQuek9mZnNldCA9IExJR0hULnByb3h5LnBvc2l0aW9uWzJdOwoKICAgICAgLy8gSGFja3kgd2F5IHRvIGFsbG93IG1hbnVhbCB1cGRhdGUgb2YgdGhlIEhFWCBjb2xvcnMgZm9yIGxpZ2h0J3MgYW1iaWVudCBhbmQgZGlmZnVzZQogICAgICBndWkuX19mb2xkZXJzLkxpZ2h0Ll9fY29udHJvbGxlcnNbMV0udXBkYXRlRGlzcGxheSgpOwogICAgICBndWkuX19mb2xkZXJzLkxpZ2h0Ll9fY29udHJvbGxlcnNbMl0udXBkYXRlRGlzcGxheSgpOwogICAgfSk7CgogICAgY29udHJvbGxlciA9IGxpZ2h0Rm9sZGVyLmFkZENvbG9yKExJR0hULCAnYW1iaWVudCcpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBMSUdIVC5wcm94eS5hbWJpZW50LnNldCh2YWx1ZSk7CiAgICAgIExJR0hULnByb3h5LmFtYmllbnRIZXggPSAgTElHSFQucHJveHkuYW1iaWVudC5mb3JtYXQoKTsKICAgIH0pOwoKICAgIGNvbnRyb2xsZXIgPSBsaWdodEZvbGRlci5hZGRDb2xvcihMSUdIVCwgJ2RpZmZ1c2UnKTsKICAgIGNvbnRyb2xsZXIub25DaGFuZ2UoZnVuY3Rpb24odmFsdWUpIHsKICAgICAgTElHSFQucHJveHkuZGlmZnVzZS5zZXQodmFsdWUpOwogICAgICBMSUdIVC5wcm94eS5kaWZmdXNlSGV4ID0gTElHSFQucHJveHkuZGlmZnVzZS5mb3JtYXQoKTsKICAgIH0pOwoKICAgIGNvbnRyb2xsZXIgPSBsaWdodEZvbGRlci5hZGQoTElHSFQsICdjb3VudCcsIDEsIDcpLmxpc3RlbigpOwogICAgY29udHJvbGxlci5zdGVwKDEpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBpZiAoc2NlbmUubGlnaHRzLmxlbmd0aCAhPT0gdmFsdWUpIHsKICAgICAgICAvLyBJZiB0aGUgdmFsdWUgaXMgbW9yZSB0aGVuIHRoZSBudW1iZXIgb2YgbGlnaHRzLCBhZGQgbGlnaHRzLCBvdGhlcndpc2UgZGVsZXRlIGxpZ2h0cyBmcm9tIHRoZSBzY2VuZQogICAgICAgIGlmICh2YWx1ZSA+IHNjZW5lLmxpZ2h0cy5sZW5ndGgpIHsKICAgICAgICAgIGFkZExpZ2h0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRyaW1MaWdodHModmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgY29udHJvbGxlciA9IGxpZ2h0Rm9sZGVyLmFkZChMSUdIVCwgJ3hQb3MnLCAtbWVzaC5nZW9tZXRyeS53aWR0aC8yLCBtZXNoLmdlb21ldHJ5LndpZHRoLzIpLmxpc3RlbigpOwogICAgY29udHJvbGxlci5zdGVwKDEpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBMSUdIVC5wcm94eS5zZXRQb3NpdGlvbih2YWx1ZSwgTElHSFQucHJveHkucG9zaXRpb25bMV0sIExJR0hULnByb3h5LnBvc2l0aW9uWzJdKTsKICAgIH0pOwoKICAgIGNvbnRyb2xsZXIgPSBsaWdodEZvbGRlci5hZGQoTElHSFQsICd5UG9zJywgLW1lc2guZ2VvbWV0cnkuaGVpZ2h0LzIsIG1lc2guZ2VvbWV0cnkuaGVpZ2h0LzIpLmxpc3RlbigpOwogICAgY29udHJvbGxlci5zdGVwKDEpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBMSUdIVC5wcm94eS5zZXRQb3NpdGlvbihMSUdIVC5wcm94eS5wb3NpdGlvblswXSwgdmFsdWUsIExJR0hULnByb3h5LnBvc2l0aW9uWzJdKTsKICAgIH0pOwoKCgogICAgLyogSlF1ZXJ5IEJsb2NrICoqKioKCSoqIFR3byBkaWZmZXJlbnQgYmluZHMgY2FsbGVkIHRvIGFsbG93IGZvciBtb3VzZS1zY3JvbGwgbW9kaWZpY2F0aW9uIG9mCgkqKiB6LW9mZnNldC4gT25lIG9mIHRoZSBiaW5kcyBoYW5kbGUgc3BlY2lmaWNhbGx5IGZvciBGaXJlZm94LAoJKiogYW5kIHRoZSBvdGhlciBoYW5kbGVzIGZvciBJRSwgT3BlcmEgYW5kIFNhZmFyaQoJKiogV29ya3MgaW46IE9wZXJhLCBTYWZhcmksIElFOSsuIGFuZCBDaHJvbWUuCgkqKiBOYU4gRXJyb3IgaW4gRmlyZWZveC4KICAgICovCgogICAgY29udHJvbGxlciA9IGxpZ2h0Rm9sZGVyLmFkZChMSUdIVCwgJ3pPZmZzZXQnLCAwLCAxMDAwKS5uYW1lKCdEaXN0YW5jZScpLmxpc3RlbigpOwoJc2Nyb2xsQnV0dG9uRGlzdGFuY2UgPSBOdW1iZXIoTElHSFQucHJveHkucG9zaXRpb25bMl0pOwoJLy9GaXJlZm94CgkkKCcjY29udGFpbmVyJykuYmluZCgnRE9NTW91c2VTY3JvbGwnLCBmdW5jdGlvbihlKSB7CgkJaWYoZS5vcmlnaW5hbEV2ZW50LmRldGFpbCA+IDApIHsKCQkgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgPSBOdW1iZXIoTWF0aC5tYXgoMCwgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgLSBlLmRldGFpbC80KSk7CgkJfSBlbHNlIHsKCQkgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgPSAgTnVtYmVyKE1hdGgubWluKDEwMDAsIHNjcm9sbEJ1dHRvbkRpc3RhbmNlIC0gZS5kZXRhaWwvNCkpOwoJCX0KCgkJTElHSFQucHJveHkuc2V0UG9zaXRpb24oTElHSFQucHJveHkucG9zaXRpb25bMF0sIExJR0hULnByb3h5LnBvc2l0aW9uWzFdLCBzY3JvbGxCdXR0b25EaXN0YW5jZSk7CgkJIExJR0hULnpPZmZzZXQgPSBzY3JvbGxCdXR0b25EaXN0YW5jZTsKCQlMSUdIVC56ID0gc2Nyb2xsQnV0dG9uRGlzdGFuY2U7CgkJZ3VpLl9fZm9sZGVycy5MaWdodC5fX2NvbnRyb2xsZXJzWzFdLnVwZGF0ZURpc3BsYXkoKTsKCQlndWkuX19mb2xkZXJzLkxpZ2h0Ll9fY29udHJvbGxlcnNbMl0udXBkYXRlRGlzcGxheSgpOwoJCXJldHVybiBmYWxzZTsKCX0pOwoKCS8vSUUsIE9wZXJhLCBTYWZhcmkKCSQoJyNjb250YWluZXInKS5iaW5kKCdtb3VzZXdoZWVsJywgZnVuY3Rpb24oZSkgewoJCWlmKGUub3JpZ2luYWxFdmVudC53aGVlbERlbHRhIDwgMCkgewoJCSBzY3JvbGxCdXR0b25EaXN0YW5jZSA9ICBOdW1iZXIoTWF0aC5tYXgoMCwgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgKyBlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YS80KSk7CgkJfSBlbHNlIHsKCQkgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgPSBOdW1iZXIoTWF0aC5taW4oMTAwMCwgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgKyBlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YS80KSk7CgkJfQoKCQlMSUdIVC5wcm94eS5zZXRQb3NpdGlvbihOdW1iZXIoTElHSFQucHJveHkucG9zaXRpb25bMF0pLCBOdW1iZXIoTElHSFQucHJveHkucG9zaXRpb25bMV0pLCBzY3JvbGxCdXR0b25EaXN0YW5jZSk7CgkJTElHSFQuek9mZnNldCA9IHNjcm9sbEJ1dHRvbkRpc3RhbmNlOwoJCUxJR0hULnogPSBzY3JvbGxCdXR0b25EaXN0YW5jZTsKCQlndWkuX19mb2xkZXJzLkxpZ2h0Ll9fY29udHJvbGxlcnNbMV0udXBkYXRlRGlzcGxheSgpOwoJCWd1aS5fX2ZvbGRlcnMuTGlnaHQuX19jb250cm9sbGVyc1syXS51cGRhdGVEaXNwbGF5KCk7CgoJCXJldHVybiBmYWxzZTsKCX0pOwoKCS8qIEVuZCBKUXVlcnkgQmxvY2sgKi8KCiAgICBjb250cm9sbGVyLnN0ZXAoMSk7CiAgICBjb250cm9sbGVyLm9uQ2hhbmdlKGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIExJR0hULnByb3h5LnNldFBvc2l0aW9uKExJR0hULnByb3h5LnBvc2l0aW9uWzBdLCBMSUdIVC5wcm94eS5wb3NpdGlvblsxXSwgdmFsdWUpOwogICAgfSk7CgogICAgY29udHJvbGxlciA9IGxpZ2h0Rm9sZGVyLmFkZChMSUdIVCwgJ3JhbmRvbWl6ZScpOwoKICAgIC8vIEFkZCBFeHBvcnQgQ29udHJvbHMKICAgIGNvbnRyb2xsZXIgPSBleHBvcnRGb2xkZXIuYWRkKEVYUE9SVCwgJ3dpZHRoJywgMTAwLCAzMDAwKTsKICAgIGNvbnRyb2xsZXIuc3RlcCgxMDApOwogICAgY29udHJvbGxlciA9IGV4cG9ydEZvbGRlci5hZGQoRVhQT1JULCAnaGVpZ2h0JywgMTAwLCAzMDAwKTsKICAgIGNvbnRyb2xsZXIuc3RlcCgxMDApOwogICAgY29udHJvbGxlciA9IGV4cG9ydEZvbGRlci5hZGQoRVhQT1JULCAnZXhwb3J0JykubmFtZSgnZXhwb3J0IGJpZycpOwogICAgY29udHJvbGxlciA9IGV4cG9ydEZvbGRlci5hZGQoRVhQT1JULCAnZXhwb3J0Q3VycmVudCcpLm5hbWUoJ2V4cG9ydCB0aGlzJyk7CgogIH0KCiAgZnVuY3Rpb24gdG9nZ2xlRWwoaWQpIHsKICAgIHZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgaWYoZS5zdHlsZS5kaXNwbGF5ID09ICdibG9jaycpCiAgICAgICBlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBlbHNlCiAgICAgICBlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIH0KCiAgZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKXsKICAgIHJldHVybiAnIycrKE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpICsgJzAwMDAwMCcpLnNsaWNlKDIsIDgpOwogIH0KCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyBDYWxsYmFja3MKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICBmdW5jdGlvbiBvbldpbmRvd1Jlc2l6ZShldmVudCkgewogICAgcmVzaXplKGNvbnRhaW5lci5vZmZzZXRXaWR0aCwgY29udGFpbmVyLm9mZnNldEhlaWdodCk7CiAgICByZW5kZXIoKTsKICB9CgogIGZ1bmN0aW9uIG9uTW91c2VNb3ZlKGV2ZW50KSB7CiAgICBpZihMSUdIVC5waWNrZWR1cCl7CiAgICAgIExJR0hULnhQb3MgPSAoZXZlbnQueCB8fCBldmVudC5jbGllbnRYKSAtIHJlbmRlcmVyLndpZHRoLzI7CiAgICAgIExJR0hULnlQb3MgPSByZW5kZXJlci5oZWlnaHQvMiAtIChldmVudC55IHx8IGV2ZW50LmNsaWVudFkpOwogICAgICBMSUdIVC5wcm94eS5zZXRQb3NpdGlvbihMSUdIVC54UG9zLCBMSUdIVC55UG9zLCBMSUdIVC5wcm94eS5wb3NpdGlvblsyXSk7CiAgICB9CiAgfQoKICAvLyBIaWRlIHRoZSBjb250cm9scyBjb21wbGV0ZWx5IG9uIHByZXNzaW5nIEgKICBNb3VzZXRyYXAuYmluZCgnSCcsIGZ1bmN0aW9uKCkgewogICAgdG9nZ2xlRWwoJ2NvbnRyb2xzJyk7CiAgICB0b2dnbGVFbCgnbGlua3MnKTsKCiAgfSk7CgogIC8vIEFkZCBhIGxpZ2h0IG9uIEVOVEVSIGtleQogIE1vdXNldHJhcC5iaW5kKCdlbnRlcicsIGZ1bmN0aW9uKCkgewogICAgTElHSFQuY291bnQrKzsKICAgIGFkZExpZ2h0KCk7CiAgfSk7CgogIC8vIFBpY2sgdXAgdGhlIGxpZ2h0IHdoZW4gYSBzcGFjZSBpcyBwcmVzc2VkCiAgTW91c2V0cmFwLmJpbmQoJ3NwYWNlJywgZnVuY3Rpb24oKSB7CiAgICBMSUdIVC5waWNrZWR1cCA9ICFMSUdIVC5waWNrZWR1cDsKICB9KTsKCiAgLy8gTGV0IHRoZXJlIGJlIGxpZ2h0IQogIGluaXRpYWxpc2UoKTsKCn0pKCk7Cg==",
                "body": "LyoqCgpUaGUgTUlUIExpY2Vuc2UgKE1JVCkKCkNvcHlyaWdodCAoYykgMjAxNCBNYWtzaW0gU3VyZ3V5CgpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Cm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbApjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbApjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFClNPRlRXQVJFLgoKKiovCnZhciBEZWxhdW5heTsKCihmdW5jdGlvbigpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBFUFNJTE9OID0gMS4wIC8gMTA0ODU3Ni4wOwoKICBmdW5jdGlvbiBzdXBlcnRyaWFuZ2xlKHZlcnRpY2VzKSB7CiAgICB2YXIgeG1pbiA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwKICAgICAgICB5bWluID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLAogICAgICAgIHhtYXggPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksCiAgICAgICAgeW1heCA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwKICAgICAgICBpLCBkeCwgZHksIGRtYXgsIHhtaWQsIHltaWQ7CgogICAgZm9yKGkgPSB2ZXJ0aWNlcy5sZW5ndGg7IGktLTsgKSB7CiAgICAgIGlmKHZlcnRpY2VzW2ldWzBdIDwgeG1pbikgeG1pbiA9IHZlcnRpY2VzW2ldWzBdOwogICAgICBpZih2ZXJ0aWNlc1tpXVswXSA+IHhtYXgpIHhtYXggPSB2ZXJ0aWNlc1tpXVswXTsKICAgICAgaWYodmVydGljZXNbaV1bMV0gPCB5bWluKSB5bWluID0gdmVydGljZXNbaV1bMV07CiAgICAgIGlmKHZlcnRpY2VzW2ldWzFdID4geW1heCkgeW1heCA9IHZlcnRpY2VzW2ldWzFdOwogICAgfQoKICAgIGR4ID0geG1heCAtIHhtaW47CiAgICBkeSA9IHltYXggLSB5bWluOwogICAgZG1heCA9IE1hdGgubWF4KGR4LCBkeSk7CiAgICB4bWlkID0geG1pbiArIGR4ICogMC41OwogICAgeW1pZCA9IHltaW4gKyBkeSAqIDAuNTsKCiAgICByZXR1cm4gWwogICAgICBbeG1pZCAtIDIwICogZG1heCwgeW1pZCAtICAgICAgZG1heF0sCiAgICAgIFt4bWlkICAgICAgICAgICAgLCB5bWlkICsgMjAgKiBkbWF4XSwKICAgICAgW3htaWQgKyAyMCAqIGRtYXgsIHltaWQgLSAgICAgIGRtYXhdCiAgICBdOwogIH0KCiAgZnVuY3Rpb24gY2lyY3VtY2lyY2xlKHZlcnRpY2VzLCBpLCBqLCBrKSB7CiAgICB2YXIgeDEgPSB2ZXJ0aWNlc1tpXVswXSwKICAgICAgICB5MSA9IHZlcnRpY2VzW2ldWzFdLAogICAgICAgIHgyID0gdmVydGljZXNbal1bMF0sCiAgICAgICAgeTIgPSB2ZXJ0aWNlc1tqXVsxXSwKICAgICAgICB4MyA9IHZlcnRpY2VzW2tdWzBdLAogICAgICAgIHkzID0gdmVydGljZXNba11bMV0sCiAgICAgICAgZmFic3kxeTIgPSBNYXRoLmFicyh5MSAtIHkyKSwKICAgICAgICBmYWJzeTJ5MyA9IE1hdGguYWJzKHkyIC0geTMpLAogICAgICAgIHhjLCB5YywgbTEsIG0yLCBteDEsIG14MiwgbXkxLCBteTIsIGR4LCBkeTsKCiAgICAvKiBDaGVjayBmb3IgY29pbmNpZGVudCBwb2ludHMgKi8KICAgIGlmKGZhYnN5MXkyIDwgRVBTSUxPTiAmJiBmYWJzeTJ5MyA8IEVQU0lMT04pCiAgICAgIHRocm93IG5ldyBFcnJvcigiRWVrISBDb2luY2lkZW50IHBvaW50cyEiKTsKCiAgICBpZihmYWJzeTF5MiA8IEVQU0lMT04pIHsKICAgICAgbTIgID0gLSgoeDMgLSB4MikgLyAoeTMgLSB5MikpOwogICAgICBteDIgPSAoeDIgKyB4MykgLyAyLjA7CiAgICAgIG15MiA9ICh5MiArIHkzKSAvIDIuMDsKICAgICAgeGMgID0gKHgyICsgeDEpIC8gMi4wOwogICAgICB5YyAgPSBtMiAqICh4YyAtIG14MikgKyBteTI7CiAgICB9CgogICAgZWxzZSBpZihmYWJzeTJ5MyA8IEVQU0lMT04pIHsKICAgICAgbTEgID0gLSgoeDIgLSB4MSkgLyAoeTIgLSB5MSkpOwogICAgICBteDEgPSAoeDEgKyB4MikgLyAyLjA7CiAgICAgIG15MSA9ICh5MSArIHkyKSAvIDIuMDsKICAgICAgeGMgID0gKHgzICsgeDIpIC8gMi4wOwogICAgICB5YyAgPSBtMSAqICh4YyAtIG14MSkgKyBteTE7CiAgICB9CgogICAgZWxzZSB7CiAgICAgIG0xICA9IC0oKHgyIC0geDEpIC8gKHkyIC0geTEpKTsKICAgICAgbTIgID0gLSgoeDMgLSB4MikgLyAoeTMgLSB5MikpOwogICAgICBteDEgPSAoeDEgKyB4MikgLyAyLjA7CiAgICAgIG14MiA9ICh4MiArIHgzKSAvIDIuMDsKICAgICAgbXkxID0gKHkxICsgeTIpIC8gMi4wOwogICAgICBteTIgPSAoeTIgKyB5MykgLyAyLjA7CiAgICAgIHhjICA9IChtMSAqIG14MSAtIG0yICogbXgyICsgbXkyIC0gbXkxKSAvIChtMSAtIG0yKTsKICAgICAgeWMgID0gKGZhYnN5MXkyID4gZmFic3kyeTMpID8KICAgICAgICBtMSAqICh4YyAtIG14MSkgKyBteTEgOgogICAgICAgIG0yICogKHhjIC0gbXgyKSArIG15MjsKICAgIH0KCiAgICBkeCA9IHgyIC0geGM7CiAgICBkeSA9IHkyIC0geWM7CiAgICByZXR1cm4ge2k6IGksIGo6IGosIGs6IGssIHg6IHhjLCB5OiB5YywgcjogZHggKiBkeCArIGR5ICogZHl9OwogIH0KCiAgZnVuY3Rpb24gZGVkdXAoZWRnZXMpIHsKICAgIHZhciBpLCBqLCBhLCBiLCBtLCBuOwoKICAgIGZvcihqID0gZWRnZXMubGVuZ3RoOyBqOyApIHsKICAgICAgYiA9IGVkZ2VzWy0tal07CiAgICAgIGEgPSBlZGdlc1stLWpdOwoKICAgICAgZm9yKGkgPSBqOyBpOyApIHsKICAgICAgICBuID0gZWRnZXNbLS1pXTsKICAgICAgICBtID0gZWRnZXNbLS1pXTsKCiAgICAgICAgaWYoKGEgPT09IG0gJiYgYiA9PT0gbikgfHwgKGEgPT09IG4gJiYgYiA9PT0gbSkpIHsKICAgICAgICAgIGVkZ2VzLnNwbGljZShqLCAyKTsKICAgICAgICAgIGVkZ2VzLnNwbGljZShpLCAyKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgRGVsYXVuYXkgPSB7CiAgICB0cmlhbmd1bGF0ZTogZnVuY3Rpb24odmVydGljZXMsIGtleSkgewogICAgICB2YXIgbiA9IHZlcnRpY2VzLmxlbmd0aCwKICAgICAgICAgIGksIGosIGluZGljZXMsIHN0LCBvcGVuLCBjbG9zZWQsIGVkZ2VzLCBkeCwgZHksIGEsIGIsIGM7CgogICAgICAvKiBCYWlsIGlmIHRoZXJlIGFyZW4ndCBlbm91Z2ggdmVydGljZXMgdG8gZm9ybSBhbnkgdHJpYW5nbGVzLiAqLwogICAgICBpZihuIDwgMykKICAgICAgICByZXR1cm4gW107CgogICAgICAvKiBTbGljZSBvdXQgdGhlIGFjdHVhbCB2ZXJ0aWNlcyBmcm9tIHRoZSBwYXNzZWQgb2JqZWN0cy4gKER1cGxpY2F0ZSB0aGUKICAgICAgICogYXJyYXkgZXZlbiBpZiB3ZSBkb24ndCwgdGhvdWdoLCBzaW5jZSB3ZSBuZWVkIHRvIG1ha2UgYSBzdXBlcnRyaWFuZ2xlCiAgICAgICAqIGxhdGVyIG9uISkgKi8KICAgICAgdmVydGljZXMgPSB2ZXJ0aWNlcy5zbGljZSgwKTsKCiAgICAgIGlmKGtleSkKICAgICAgICBmb3IoaSA9IG47IGktLTsgKQogICAgICAgICAgdmVydGljZXNbaV0gPSB2ZXJ0aWNlc1tpXVtrZXldOwoKICAgICAgLyogTWFrZSBhbiBhcnJheSBvZiBpbmRpY2VzIGludG8gdGhlIHZlcnRleCBhcnJheSwgc29ydGVkIGJ5IHRoZQogICAgICAgKiB2ZXJ0aWNlcycgeC1wb3NpdGlvbi4gKi8KICAgICAgaW5kaWNlcyA9IG5ldyBBcnJheShuKTsKCiAgICAgIGZvcihpID0gbjsgaS0tOyApCiAgICAgICAgaW5kaWNlc1tpXSA9IGk7CgogICAgICBpbmRpY2VzLnNvcnQoZnVuY3Rpb24oaSwgaikgewogICAgICAgIHJldHVybiB2ZXJ0aWNlc1tqXVswXSAtIHZlcnRpY2VzW2ldWzBdOwogICAgICB9KTsKCiAgICAgIC8qIE5leHQsIGZpbmQgdGhlIHZlcnRpY2VzIG9mIHRoZSBzdXBlcnRyaWFuZ2xlICh3aGljaCBjb250YWlucyBhbGwgb3RoZXIKICAgICAgICogdHJpYW5nbGVzKSwgYW5kIGFwcGVuZCB0aGVtIG9udG8gdGhlIGVuZCBvZiBhIChjb3B5IG9mKSB0aGUgdmVydGV4CiAgICAgICAqIGFycmF5LiAqLwogICAgICBzdCA9IHN1cGVydHJpYW5nbGUodmVydGljZXMpOwogICAgICB2ZXJ0aWNlcy5wdXNoKHN0WzBdLCBzdFsxXSwgc3RbMl0pOwoKICAgICAgLyogSW5pdGlhbGl6ZSB0aGUgb3BlbiBsaXN0IChjb250YWluaW5nIHRoZSBzdXBlcnRyaWFuZ2xlIGFuZCBub3RoaW5nCiAgICAgICAqIGVsc2UpIGFuZCB0aGUgY2xvc2VkIGxpc3QgKHdoaWNoIGlzIGVtcHR5IHNpbmNlIHdlIGhhdm4ndCBwcm9jZXNzZWQKICAgICAgICogYW55IHRyaWFuZ2xlcyB5ZXQpLiAqLwogICAgICBvcGVuICAgPSBbY2lyY3VtY2lyY2xlKHZlcnRpY2VzLCBuICsgMCwgbiArIDEsIG4gKyAyKV07CiAgICAgIGNsb3NlZCA9IFtdOwogICAgICBlZGdlcyAgPSBbXTsKCiAgICAgIC8qIEluY3JlbWVudGFsbHkgYWRkIGVhY2ggdmVydGV4IHRvIHRoZSBtZXNoLiAqLwogICAgICBmb3IoaSA9IGluZGljZXMubGVuZ3RoOyBpLS07IGVkZ2VzLmxlbmd0aCA9IDApIHsKICAgICAgICBjID0gaW5kaWNlc1tpXTsKCiAgICAgICAgLyogRm9yIGVhY2ggb3BlbiB0cmlhbmdsZSwgY2hlY2sgdG8gc2VlIGlmIHRoZSBjdXJyZW50IHBvaW50IGlzCiAgICAgICAgICogaW5zaWRlIGl0J3MgY2lyY3VtY2lyY2xlLiBJZiBpdCBpcywgcmVtb3ZlIHRoZSB0cmlhbmdsZSBhbmQgYWRkCiAgICAgICAgICogaXQncyBlZGdlcyB0byBhbiBlZGdlIGxpc3QuICovCiAgICAgICAgZm9yKGogPSBvcGVuLmxlbmd0aDsgai0tOyApIHsKICAgICAgICAgIC8qIElmIHRoaXMgcG9pbnQgaXMgdG8gdGhlIHJpZ2h0IG9mIHRoaXMgdHJpYW5nbGUncyBjaXJjdW1jaXJjbGUsCiAgICAgICAgICAgKiB0aGVuIHRoaXMgdHJpYW5nbGUgc2hvdWxkIG5ldmVyIGdldCBjaGVja2VkIGFnYWluLiBSZW1vdmUgaXQKICAgICAgICAgICAqIGZyb20gdGhlIG9wZW4gbGlzdCwgYWRkIGl0IHRvIHRoZSBjbG9zZWQgbGlzdCwgYW5kIHNraXAuICovCiAgICAgICAgICBkeCA9IHZlcnRpY2VzW2NdWzBdIC0gb3BlbltqXS54OwogICAgICAgICAgaWYoZHggPiAwLjAgJiYgZHggKiBkeCA+IG9wZW5bal0ucikgewogICAgICAgICAgICBjbG9zZWQucHVzaChvcGVuW2pdKTsKICAgICAgICAgICAgb3Blbi5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIC8qIElmIHdlJ3JlIG91dHNpZGUgdGhlIGNpcmN1bWNpcmNsZSwgc2tpcCB0aGlzIHRyaWFuZ2xlLiAqLwogICAgICAgICAgZHkgPSB2ZXJ0aWNlc1tjXVsxXSAtIG9wZW5bal0ueTsKICAgICAgICAgIGlmKGR4ICogZHggKyBkeSAqIGR5IC0gb3BlbltqXS5yID4gRVBTSUxPTikKICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgLyogUmVtb3ZlIHRoZSB0cmlhbmdsZSBhbmQgYWRkIGl0J3MgZWRnZXMgdG8gdGhlIGVkZ2UgbGlzdC4gKi8KICAgICAgICAgIGVkZ2VzLnB1c2goCiAgICAgICAgICAgIG9wZW5bal0uaSwgb3BlbltqXS5qLAogICAgICAgICAgICBvcGVuW2pdLmosIG9wZW5bal0uaywKICAgICAgICAgICAgb3BlbltqXS5rLCBvcGVuW2pdLmkKICAgICAgICAgICk7CiAgICAgICAgICBvcGVuLnNwbGljZShqLCAxKTsKICAgICAgICB9CgogICAgICAgIC8qIFJlbW92ZSBhbnkgZG91YmxlZCBlZGdlcy4gKi8KICAgICAgICBkZWR1cChlZGdlcyk7CgogICAgICAgIC8qIEFkZCBhIG5ldyB0cmlhbmdsZSBmb3IgZWFjaCBlZGdlLiAqLwogICAgICAgIGZvcihqID0gZWRnZXMubGVuZ3RoOyBqOyApIHsKICAgICAgICAgIGIgPSBlZGdlc1stLWpdOwogICAgICAgICAgYSA9IGVkZ2VzWy0tal07CiAgICAgICAgICBvcGVuLnB1c2goY2lyY3VtY2lyY2xlKHZlcnRpY2VzLCBhLCBiLCBjKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvKiBDb3B5IGFueSByZW1haW5pbmcgb3BlbiB0cmlhbmdsZXMgdG8gdGhlIGNsb3NlZCBsaXN0LCBhbmQgdGhlbgogICAgICAgKiByZW1vdmUgYW55IHRyaWFuZ2xlcyB0aGF0IHNoYXJlIGEgdmVydGV4IHdpdGggdGhlIHN1cGVydHJpYW5nbGUsCiAgICAgICAqIGJ1aWxkaW5nIGEgbGlzdCBvZiB0cmlwbGV0cyB0aGF0IHJlcHJlc2VudCB0cmlhbmdsZXMuICovCiAgICAgIGZvcihpID0gb3Blbi5sZW5ndGg7IGktLTsgKQogICAgICAgIGNsb3NlZC5wdXNoKG9wZW5baV0pOwogICAgICBvcGVuLmxlbmd0aCA9IDA7CgogICAgICBmb3IoaSA9IGNsb3NlZC5sZW5ndGg7IGktLTsgKQogICAgICAgIGlmKGNsb3NlZFtpXS5pIDwgbiAmJiBjbG9zZWRbaV0uaiA8IG4gJiYgY2xvc2VkW2ldLmsgPCBuKQogICAgICAgICAgb3Blbi5wdXNoKGNsb3NlZFtpXS5pLCBjbG9zZWRbaV0uaiwgY2xvc2VkW2ldLmspOwoKICAgICAgLyogWWF5LCB3ZSdyZSBkb25lISAqLwogICAgICByZXR1cm4gb3BlbjsKICAgIH0sCiAgICBjb250YWluczogZnVuY3Rpb24odHJpLCBwKSB7CiAgICAgIC8qIEJvdW5kaW5nIGJveCB0ZXN0IGZpcnN0LCBmb3IgcXVpY2sgcmVqZWN0aW9ucy4gKi8KICAgICAgaWYoKHBbMF0gPCB0cmlbMF1bMF0gJiYgcFswXSA8IHRyaVsxXVswXSAmJiBwWzBdIDwgdHJpWzJdWzBdKSB8fAogICAgICAgICAocFswXSA+IHRyaVswXVswXSAmJiBwWzBdID4gdHJpWzFdWzBdICYmIHBbMF0gPiB0cmlbMl1bMF0pIHx8CiAgICAgICAgIChwWzFdIDwgdHJpWzBdWzFdICYmIHBbMV0gPCB0cmlbMV1bMV0gJiYgcFsxXSA8IHRyaVsyXVsxXSkgfHwKICAgICAgICAgKHBbMV0gPiB0cmlbMF1bMV0gJiYgcFsxXSA+IHRyaVsxXVsxXSAmJiBwWzFdID4gdHJpWzJdWzFdKSkKICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgIHZhciBhID0gdHJpWzFdWzBdIC0gdHJpWzBdWzBdLAogICAgICAgICAgYiA9IHRyaVsyXVswXSAtIHRyaVswXVswXSwKICAgICAgICAgIGMgPSB0cmlbMV1bMV0gLSB0cmlbMF1bMV0sCiAgICAgICAgICBkID0gdHJpWzJdWzFdIC0gdHJpWzBdWzFdLAogICAgICAgICAgaSA9IGEgKiBkIC0gYiAqIGM7CgogICAgICAvKiBEZWdlbmVyYXRlIHRyaS4gKi8KICAgICAgaWYoaSA9PT0gMC4wKQogICAgICAgIHJldHVybiBudWxsOwoKICAgICAgdmFyIHUgPSAoZCAqIChwWzBdIC0gdHJpWzBdWzBdKSAtIGIgKiAocFsxXSAtIHRyaVswXVsxXSkpIC8gaSwKICAgICAgICAgIHYgPSAoYSAqIChwWzFdIC0gdHJpWzBdWzFdKSAtIGMgKiAocFswXSAtIHRyaVswXVswXSkpIC8gaTsKCiAgICAgIC8qIElmIHdlJ3JlIG91dHNpZGUgdGhlIHRyaSwgZmFpbC4gKi8KICAgICAgaWYodSA8IDAuMCB8fCB2IDwgMC4wIHx8ICh1ICsgdikgPiAxLjApCiAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICByZXR1cm4gW3UsIHZdOwogICAgfQogIH07CgogIGlmKHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiKQogICAgbW9kdWxlLmV4cG9ydHMgPSBEZWxhdW5heTsKfSkoKTsKCi8qIG1vdXNldHJhcCB2MS40LjYgY3JhaWcuaXMva2lsbGluZy9taWNlICovCihmdW5jdGlvbihKLHIsZil7ZnVuY3Rpb24gcyhhLGIsZCl7YS5hZGRFdmVudExpc3RlbmVyP2EuYWRkRXZlbnRMaXN0ZW5lcihiLGQsITEpOmEuYXR0YWNoRXZlbnQoIm9uIitiLGQpfWZ1bmN0aW9uIEEoYSl7aWYoImtleXByZXNzIj09YS50eXBlKXt2YXIgYj1TdHJpbmcuZnJvbUNoYXJDb2RlKGEud2hpY2gpO2Euc2hpZnRLZXl8fChiPWIudG9Mb3dlckNhc2UoKSk7cmV0dXJuIGJ9cmV0dXJuIGhbYS53aGljaF0/aFthLndoaWNoXTpCW2Eud2hpY2hdP0JbYS53aGljaF06U3RyaW5nLmZyb21DaGFyQ29kZShhLndoaWNoKS50b0xvd2VyQ2FzZSgpfWZ1bmN0aW9uIHQoYSl7YT1hfHx7fTt2YXIgYj0hMSxkO2ZvcihkIGluIG4pYVtkXT9iPSEwOm5bZF09MDtifHwodT0hMSl9ZnVuY3Rpb24gQyhhLGIsZCxjLGUsdil7dmFyIGcsayxmPVtdLGg9ZC50eXBlO2lmKCFsW2FdKXJldHVybltdOyJrZXl1cCI9PWgmJncoYSkmJihiPVthXSk7Zm9yKGc9MDtnPGxbYV0ubGVuZ3RoOysrZylpZihrPQpsW2FdW2ddLCEoIWMmJmsuc2VxJiZuW2suc2VxXSE9ay5sZXZlbHx8aCE9ay5hY3Rpb258fCgia2V5cHJlc3MiIT1ofHxkLm1ldGFLZXl8fGQuY3RybEtleSkmJmIuc29ydCgpLmpvaW4oIiwiKSE9PWsubW9kaWZpZXJzLnNvcnQoKS5qb2luKCIsIikpKXt2YXIgbT1jJiZrLnNlcT09YyYmay5sZXZlbD09djsoIWMmJmsuY29tYm89PWV8fG0pJiZsW2FdLnNwbGljZShnLDEpO2YucHVzaChrKX1yZXR1cm4gZn1mdW5jdGlvbiBLKGEpe3ZhciBiPVtdO2Euc2hpZnRLZXkmJmIucHVzaCgic2hpZnQiKTthLmFsdEtleSYmYi5wdXNoKCJhbHQiKTthLmN0cmxLZXkmJmIucHVzaCgiY3RybCIpO2EubWV0YUtleSYmYi5wdXNoKCJtZXRhIik7cmV0dXJuIGJ9ZnVuY3Rpb24geChhLGIsZCxjKXttLnN0b3BDYWxsYmFjayhiLGIudGFyZ2V0fHxiLnNyY0VsZW1lbnQsZCxjKXx8ITEhPT1hKGIsZCl8fChiLnByZXZlbnREZWZhdWx0P2IucHJldmVudERlZmF1bHQoKTpiLnJldHVyblZhbHVlPSExLGIuc3RvcFByb3BhZ2F0aW9uPwpiLnN0b3BQcm9wYWdhdGlvbigpOmIuY2FuY2VsQnViYmxlPSEwKX1mdW5jdGlvbiB5KGEpeyJudW1iZXIiIT09dHlwZW9mIGEud2hpY2gmJihhLndoaWNoPWEua2V5Q29kZSk7dmFyIGI9QShhKTtiJiYoImtleXVwIj09YS50eXBlJiZ6PT09Yj96PSExOm0uaGFuZGxlS2V5KGIsSyhhKSxhKSl9ZnVuY3Rpb24gdyhhKXtyZXR1cm4ic2hpZnQiPT1hfHwiY3RybCI9PWF8fCJhbHQiPT1hfHwibWV0YSI9PWF9ZnVuY3Rpb24gTChhLGIsZCxjKXtmdW5jdGlvbiBlKGIpe3JldHVybiBmdW5jdGlvbigpe3U9YjsrK25bYV07Y2xlYXJUaW1lb3V0KEQpO0Q9c2V0VGltZW91dCh0LDFFMyl9fWZ1bmN0aW9uIHYoYil7eChkLGIsYSk7ImtleXVwIiE9PWMmJih6PUEoYikpO3NldFRpbWVvdXQodCwxMCl9Zm9yKHZhciBnPW5bYV09MDtnPGIubGVuZ3RoOysrZyl7dmFyIGY9ZysxPT09Yi5sZW5ndGg/djplKGN8fEUoYltnKzFdKS5hY3Rpb24pO0YoYltnXSxmLGMsYSxnKX19ZnVuY3Rpb24gRShhLGIpe3ZhciBkLApjLGUsZj1bXTtkPSIrIj09PWE/WyIrIl06YS5zcGxpdCgiKyIpO2ZvcihlPTA7ZTxkLmxlbmd0aDsrK2UpYz1kW2VdLEdbY10mJihjPUdbY10pLGImJiJrZXlwcmVzcyIhPWImJkhbY10mJihjPUhbY10sZi5wdXNoKCJzaGlmdCIpKSx3KGMpJiZmLnB1c2goYyk7ZD1jO2U9YjtpZighZSl7aWYoIXApe3A9e307Zm9yKHZhciBnIGluIGgpOTU8ZyYmMTEyPmd8fGguaGFzT3duUHJvcGVydHkoZykmJihwW2hbZ11dPWcpfWU9cFtkXT8ia2V5ZG93biI6ImtleXByZXNzIn0ia2V5cHJlc3MiPT1lJiZmLmxlbmd0aCYmKGU9ImtleWRvd24iKTtyZXR1cm57a2V5OmMsbW9kaWZpZXJzOmYsYWN0aW9uOmV9fWZ1bmN0aW9uIEYoYSxiLGQsYyxlKXtxW2ErIjoiK2RdPWI7YT1hLnJlcGxhY2UoL1xzKy9nLCIgIik7dmFyIGY9YS5zcGxpdCgiICIpOzE8Zi5sZW5ndGg/TChhLGYsYixkKTooZD1FKGEsZCksbFtkLmtleV09bFtkLmtleV18fFtdLEMoZC5rZXksZC5tb2RpZmllcnMse3R5cGU6ZC5hY3Rpb259LApjLGEsZSksbFtkLmtleV1bYz8idW5zaGlmdCI6InB1c2giXSh7Y2FsbGJhY2s6Yixtb2RpZmllcnM6ZC5tb2RpZmllcnMsYWN0aW9uOmQuYWN0aW9uLHNlcTpjLGxldmVsOmUsY29tYm86YX0pKX12YXIgaD17ODoiYmFja3NwYWNlIiw5OiJ0YWIiLDEzOiJlbnRlciIsMTY6InNoaWZ0IiwxNzoiY3RybCIsMTg6ImFsdCIsMjA6ImNhcHNsb2NrIiwyNzoiZXNjIiwzMjoic3BhY2UiLDMzOiJwYWdldXAiLDM0OiJwYWdlZG93biIsMzU6ImVuZCIsMzY6ImhvbWUiLDM3OiJsZWZ0IiwzODoidXAiLDM5OiJyaWdodCIsNDA6ImRvd24iLDQ1OiJpbnMiLDQ2OiJkZWwiLDkxOiJtZXRhIiw5MzoibWV0YSIsMjI0OiJtZXRhIn0sQj17MTA2OiIqIiwxMDc6IisiLDEwOToiLSIsMTEwOiIuIiwxMTE6Ii8iLDE4NjoiOyIsMTg3OiI9IiwxODg6IiwiLDE4OToiLSIsMTkwOiIuIiwxOTE6Ii8iLDE5MjoiYCIsMjE5OiJbIiwyMjA6IlxcIiwyMjE6Il0iLDIyMjoiJyJ9LEg9eyJ+IjoiYCIsIiEiOiIxIiwKIkAiOiIyIiwiIyI6IjMiLCQ6IjQiLCIlIjoiNSIsIl4iOiI2IiwiJiI6IjciLCIqIjoiOCIsIigiOiI5IiwiKSI6IjAiLF86Ii0iLCIrIjoiPSIsIjoiOiI7IiwnIic6IiciLCI8IjoiLCIsIj4iOiIuIiwiPyI6Ii8iLCJ8IjoiXFwifSxHPXtvcHRpb246ImFsdCIsY29tbWFuZDoibWV0YSIsInJldHVybiI6ImVudGVyIixlc2NhcGU6ImVzYyIsbW9kOi9NYWN8aVBvZHxpUGhvbmV8aVBhZC8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pPyJtZXRhIjoiY3RybCJ9LHAsbD17fSxxPXt9LG49e30sRCx6PSExLEk9ITEsdT0hMTtmb3IoZj0xOzIwPmY7KytmKWhbMTExK2ZdPSJmIitmO2ZvcihmPTA7OT49ZjsrK2YpaFtmKzk2XT1mO3Mociwia2V5cHJlc3MiLHkpO3Mociwia2V5ZG93biIseSk7cyhyLCJrZXl1cCIseSk7dmFyIG09e2JpbmQ6ZnVuY3Rpb24oYSxiLGQpe2E9YSBpbnN0YW5jZW9mIEFycmF5P2E6W2FdO2Zvcih2YXIgYz0wO2M8YS5sZW5ndGg7KytjKUYoYVtjXSxiLGQpO3JldHVybiB0aGlzfSwKdW5iaW5kOmZ1bmN0aW9uKGEsYil7cmV0dXJuIG0uYmluZChhLGZ1bmN0aW9uKCl7fSxiKX0sdHJpZ2dlcjpmdW5jdGlvbihhLGIpe2lmKHFbYSsiOiIrYl0pcVthKyI6IitiXSh7fSxhKTtyZXR1cm4gdGhpc30scmVzZXQ6ZnVuY3Rpb24oKXtsPXt9O3E9e307cmV0dXJuIHRoaXN9LHN0b3BDYWxsYmFjazpmdW5jdGlvbihhLGIpe3JldHVybi0xPCgiICIrYi5jbGFzc05hbWUrIiAiKS5pbmRleE9mKCIgbW91c2V0cmFwICIpPyExOiJJTlBVVCI9PWIudGFnTmFtZXx8IlNFTEVDVCI9PWIudGFnTmFtZXx8IlRFWFRBUkVBIj09Yi50YWdOYW1lfHxiLmlzQ29udGVudEVkaXRhYmxlfSxoYW5kbGVLZXk6ZnVuY3Rpb24oYSxiLGQpe3ZhciBjPUMoYSxiLGQpLGU7Yj17fTt2YXIgZj0wLGc9ITE7Zm9yKGU9MDtlPGMubGVuZ3RoOysrZSljW2VdLnNlcSYmKGY9TWF0aC5tYXgoZixjW2VdLmxldmVsKSk7Zm9yKGU9MDtlPGMubGVuZ3RoOysrZSljW2VdLnNlcT9jW2VdLmxldmVsPT1mJiYoZz0hMCwKYltjW2VdLnNlcV09MSx4KGNbZV0uY2FsbGJhY2ssZCxjW2VdLmNvbWJvLGNbZV0uc2VxKSk6Z3x8eChjW2VdLmNhbGxiYWNrLGQsY1tlXS5jb21ibyk7Yz0ia2V5cHJlc3MiPT1kLnR5cGUmJkk7ZC50eXBlIT11fHx3KGEpfHxjfHx0KGIpO0k9ZyYmImtleWRvd24iPT1kLnR5cGV9fTtKLk1vdXNldHJhcD1tOyJmdW5jdGlvbiI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kJiZkZWZpbmUobSl9KSh3aW5kb3csZG9jdW1lbnQpOwovKioKICogU3R5bGVGaXggMS4wLjMgJiBQcmVmaXhGcmVlIDEuMC43CiAqIEBhdXRob3IgTGVhIFZlcm91CiAqIE1JVCBsaWNlbnNlCiAqLyhmdW5jdGlvbigpe2Z1bmN0aW9uIHQoZSx0KXtyZXR1cm5bXS5zbGljZS5jYWxsKCh0fHxkb2N1bWVudCkucXVlcnlTZWxlY3RvckFsbChlKSl9aWYoIXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKXJldHVybjt2YXIgZT13aW5kb3cuU3R5bGVGaXg9e2xpbms6ZnVuY3Rpb24odCl7dHJ5e2lmKHQucmVsIT09InN0eWxlc2hlZXQifHx0Lmhhc0F0dHJpYnV0ZSgiZGF0YS1ub3ByZWZpeCIpKXJldHVybn1jYXRjaChuKXtyZXR1cm59dmFyIHI9dC5ocmVmfHx0LmdldEF0dHJpYnV0ZSgiZGF0YS1ocmVmIiksaT1yLnJlcGxhY2UoL1teXC9dKyQvLCIiKSxzPSgvXlthLXpdezMsMTB9Oi8uZXhlYyhpKXx8WyIiXSlbMF0sbz0oL15bYS16XXszLDEwfTpcL1wvW15cL10rLy5leGVjKGkpfHxbIiJdKVswXSx1PS9eKFteP10qKVw/Py8uZXhlYyhyKVsxXSxhPXQucGFyZW50Tm9kZSxmPW5ldyBYTUxIdHRwUmVxdWVzdCxsO2Yub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7Zi5yZWFkeVN0YXRlPT09NCYmbCgpfTtsPWZ1bmN0aW9uKCl7dmFyIG49Zi5yZXNwb25zZVRleHQ7aWYobiYmdC5wYXJlbnROb2RlJiYoIWYuc3RhdHVzfHxmLnN0YXR1czw0MDB8fGYuc3RhdHVzPjYwMCkpe249ZS5maXgobiwhMCx0KTtpZihpKXtuPW4ucmVwbGFjZSgvdXJsXChccyo/KCg/OiJ8Jyk/KSguKz8pXDFccyo/XCkvZ2ksZnVuY3Rpb24oZSx0LG4pe3JldHVybi9eKFthLXpdezMsMTB9OnwjKS9pLnRlc3Qobik/ZTovXlwvXC8vLnRlc3Qobik/J3VybCgiJytzK24rJyIpJzovXlwvLy50ZXN0KG4pPyd1cmwoIicrbytuKyciKSc6L15cPy8udGVzdChuKT8ndXJsKCInK3UrbisnIiknOid1cmwoIicraStuKyciKSd9KTt2YXIgcj1pLnJlcGxhY2UoLyhbXFxcXlwkKitbXF0/e30uPSE6KHwpXSkvZywiXFwkMSIpO249bi5yZXBsYWNlKFJlZ0V4cCgiXFxiKGJlaGF2aW9yOlxccyo/dXJsXFwoJz9cIj8pIityLCJnaSIpLCIkMSIpfXZhciBsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7bC50ZXh0Q29udGVudD1uO2wubWVkaWE9dC5tZWRpYTtsLmRpc2FibGVkPXQuZGlzYWJsZWQ7bC5zZXRBdHRyaWJ1dGUoImRhdGEtaHJlZiIsdC5nZXRBdHRyaWJ1dGUoImhyZWYiKSk7YS5pbnNlcnRCZWZvcmUobCx0KTthLnJlbW92ZUNoaWxkKHQpO2wubWVkaWE9dC5tZWRpYX19O3RyeXtmLm9wZW4oIkdFVCIscik7Zi5zZW5kKG51bGwpfWNhdGNoKG4pe2lmKHR5cGVvZiBYRG9tYWluUmVxdWVzdCE9InVuZGVmaW5lZCIpe2Y9bmV3IFhEb21haW5SZXF1ZXN0O2Yub25lcnJvcj1mLm9ucHJvZ3Jlc3M9ZnVuY3Rpb24oKXt9O2Yub25sb2FkPWw7Zi5vcGVuKCJHRVQiLHIpO2Yuc2VuZChudWxsKX19dC5zZXRBdHRyaWJ1dGUoImRhdGEtaW5wcm9ncmVzcyIsIiIpfSxzdHlsZUVsZW1lbnQ6ZnVuY3Rpb24odCl7aWYodC5oYXNBdHRyaWJ1dGUoImRhdGEtbm9wcmVmaXgiKSlyZXR1cm47dmFyIG49dC5kaXNhYmxlZDt0LnRleHRDb250ZW50PWUuZml4KHQudGV4dENvbnRlbnQsITAsdCk7dC5kaXNhYmxlZD1ufSxzdHlsZUF0dHJpYnV0ZTpmdW5jdGlvbih0KXt2YXIgbj10LmdldEF0dHJpYnV0ZSgic3R5bGUiKTtuPWUuZml4KG4sITEsdCk7dC5zZXRBdHRyaWJ1dGUoInN0eWxlIixuKX0scHJvY2VzczpmdW5jdGlvbigpe3QoJ2xpbmtbcmVsPSJzdHlsZXNoZWV0Il06bm90KFtkYXRhLWlucHJvZ3Jlc3NdKScpLmZvckVhY2goU3R5bGVGaXgubGluayk7dCgic3R5bGUiKS5mb3JFYWNoKFN0eWxlRml4LnN0eWxlRWxlbWVudCk7dCgiW3N0eWxlXSIpLmZvckVhY2goU3R5bGVGaXguc3R5bGVBdHRyaWJ1dGUpfSxyZWdpc3RlcjpmdW5jdGlvbih0LG4peyhlLmZpeGVycz1lLmZpeGVyc3x8W10pLnNwbGljZShuPT09dW5kZWZpbmVkP2UuZml4ZXJzLmxlbmd0aDpuLDAsdCl9LGZpeDpmdW5jdGlvbih0LG4scil7Zm9yKHZhciBpPTA7aTxlLmZpeGVycy5sZW5ndGg7aSsrKXQ9ZS5maXhlcnNbaV0odCxuLHIpfHx0O3JldHVybiB0fSxjYW1lbENhc2U6ZnVuY3Rpb24oZSl7cmV0dXJuIGUucmVwbGFjZSgvLShbYS16XSkvZyxmdW5jdGlvbihlLHQpe3JldHVybiB0LnRvVXBwZXJDYXNlKCl9KS5yZXBsYWNlKCItIiwiIil9LGRlQ2FtZWxDYXNlOmZ1bmN0aW9uKGUpe3JldHVybiBlLnJlcGxhY2UoL1tBLVpdL2csZnVuY3Rpb24oZSl7cmV0dXJuIi0iK2UudG9Mb3dlckNhc2UoKX0pfX07KGZ1bmN0aW9uKCl7c2V0VGltZW91dChmdW5jdGlvbigpe3QoJ2xpbmtbcmVsPSJzdHlsZXNoZWV0Il0nKS5mb3JFYWNoKFN0eWxlRml4LmxpbmspfSwxMCk7ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsU3R5bGVGaXgucHJvY2VzcywhMSl9KSgpfSkoKTsoZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHQscixpLHMpe2U9bltlXTtpZihlLmxlbmd0aCl7dmFyIG89UmVnRXhwKHQrIigiK2Uuam9pbigifCIpKyIpIityLCJnaSIpO3M9cy5yZXBsYWNlKG8saSl9cmV0dXJuIHN9aWYoIXdpbmRvdy5TdHlsZUZpeHx8IXdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKXJldHVybjt2YXIgbj13aW5kb3cuUHJlZml4RnJlZT17cHJlZml4Q1NTOmZ1bmN0aW9uKGUscixpKXt2YXIgcz1uLnByZWZpeDtuLmZ1bmN0aW9ucy5pbmRleE9mKCJsaW5lYXItZ3JhZGllbnQiKT4tMSYmKGU9ZS5yZXBsYWNlKC8oXHN8OnwsKShyZXBlYXRpbmctKT9saW5lYXItZ3JhZGllbnRcKFxzKigtP1xkKlwuP1xkKilkZWcvaWcsZnVuY3Rpb24oZSx0LG4scil7cmV0dXJuIHQrKG58fCIiKSsibGluZWFyLWdyYWRpZW50KCIrKDkwLXIpKyJkZWcifSkpO2U9dCgiZnVuY3Rpb25zIiwiKFxcc3w6fCwpIiwiXFxzKlxcKCIsIiQxIitzKyIkMigiLGUpO2U9dCgia2V5d29yZHMiLCIoXFxzfDopIiwiKFxcc3w7fFxcfXwkKSIsIiQxIitzKyIkMiQzIixlKTtlPXQoInByb3BlcnRpZXMiLCIoXnxcXHt8XFxzfDspIiwiXFxzKjoiLCIkMSIrcysiJDI6IixlKTtpZihuLnByb3BlcnRpZXMubGVuZ3RoKXt2YXIgbz1SZWdFeHAoIlxcYigiK24ucHJvcGVydGllcy5qb2luKCJ8IikrIikoPyE6KSIsImdpIik7ZT10KCJ2YWx1ZVByb3BlcnRpZXMiLCJcXGIiLCI6KC4rPyk7IixmdW5jdGlvbihlKXtyZXR1cm4gZS5yZXBsYWNlKG8scysiJDEiKX0sZSl9aWYocil7ZT10KCJzZWxlY3RvcnMiLCIiLCJcXGIiLG4ucHJlZml4U2VsZWN0b3IsZSk7ZT10KCJhdHJ1bGVzIiwiQCIsIlxcYiIsIkAiK3MrIiQxIixlKX1lPWUucmVwbGFjZShSZWdFeHAoIi0iK3MsImciKSwiLSIpO2U9ZS5yZXBsYWNlKC8tXCotKD89W2Etel0rKS9naSxuLnByZWZpeCk7cmV0dXJuIGV9LHByb3BlcnR5OmZ1bmN0aW9uKGUpe3JldHVybihuLnByb3BlcnRpZXMuaW5kZXhPZihlKT9uLnByZWZpeDoiIikrZX0sdmFsdWU6ZnVuY3Rpb24oZSxyKXtlPXQoImZ1bmN0aW9ucyIsIihefFxcc3wsKSIsIlxccypcXCgiLCIkMSIrbi5wcmVmaXgrIiQyKCIsZSk7ZT10KCJrZXl3b3JkcyIsIihefFxccykiLCIoXFxzfCQpIiwiJDEiK24ucHJlZml4KyIkMiQzIixlKTtyZXR1cm4gZX0scHJlZml4U2VsZWN0b3I6ZnVuY3Rpb24oZSl7cmV0dXJuIGUucmVwbGFjZSgvXjp7MSwyfS8sZnVuY3Rpb24oZSl7cmV0dXJuIGUrbi5wcmVmaXh9KX0scHJlZml4UHJvcGVydHk6ZnVuY3Rpb24oZSx0KXt2YXIgcj1uLnByZWZpeCtlO3JldHVybiB0P1N0eWxlRml4LmNhbWVsQ2FzZShyKTpyfX07KGZ1bmN0aW9uKCl7dmFyIGU9e30sdD1bXSxyPXt9LGk9Z2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsbnVsbCkscz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKS5zdHlsZSxvPWZ1bmN0aW9uKG4pe2lmKG4uY2hhckF0KDApPT09Ii0iKXt0LnB1c2gobik7dmFyIHI9bi5zcGxpdCgiLSIpLGk9clsxXTtlW2ldPSsrZVtpXXx8MTt3aGlsZShyLmxlbmd0aD4zKXtyLnBvcCgpO3ZhciBzPXIuam9pbigiLSIpO3UocykmJnQuaW5kZXhPZihzKT09PS0xJiZ0LnB1c2gocyl9fX0sdT1mdW5jdGlvbihlKXtyZXR1cm4gU3R5bGVGaXguY2FtZWxDYXNlKGUpaW4gc307aWYoaS5sZW5ndGg+MClmb3IodmFyIGE9MDthPGkubGVuZ3RoO2ErKylvKGlbYV0pO2Vsc2UgZm9yKHZhciBmIGluIGkpbyhTdHlsZUZpeC5kZUNhbWVsQ2FzZShmKSk7dmFyIGw9e3VzZXM6MH07Zm9yKHZhciBjIGluIGUpe3ZhciBoPWVbY107bC51c2VzPGgmJihsPXtwcmVmaXg6Yyx1c2VzOmh9KX1uLnByZWZpeD0iLSIrbC5wcmVmaXgrIi0iO24uUHJlZml4PVN0eWxlRml4LmNhbWVsQ2FzZShuLnByZWZpeCk7bi5wcm9wZXJ0aWVzPVtdO2Zvcih2YXIgYT0wO2E8dC5sZW5ndGg7YSsrKXt2YXIgZj10W2FdO2lmKGYuaW5kZXhPZihuLnByZWZpeCk9PT0wKXt2YXIgcD1mLnNsaWNlKG4ucHJlZml4Lmxlbmd0aCk7dShwKXx8bi5wcm9wZXJ0aWVzLnB1c2gocCl9fW4uUHJlZml4PT0iTXMiJiYhKCJ0cmFuc2Zvcm0iaW4gcykmJiEoIk1zVHJhbnNmb3JtImluIHMpJiYibXNUcmFuc2Zvcm0iaW4gcyYmbi5wcm9wZXJ0aWVzLnB1c2goInRyYW5zZm9ybSIsInRyYW5zZm9ybS1vcmlnaW4iKTtuLnByb3BlcnRpZXMuc29ydCgpfSkoKTsoZnVuY3Rpb24oKXtmdW5jdGlvbiBpKGUsdCl7clt0XT0iIjtyW3RdPWU7cmV0dXJuISFyW3RdfXZhciBlPXsibGluZWFyLWdyYWRpZW50Ijp7cHJvcGVydHk6ImJhY2tncm91bmRJbWFnZSIscGFyYW1zOiJyZWQsIHRlYWwifSxjYWxjOntwcm9wZXJ0eToid2lkdGgiLHBhcmFtczoiMXB4ICsgNSUifSxlbGVtZW50Ontwcm9wZXJ0eToiYmFja2dyb3VuZEltYWdlIixwYXJhbXM6IiNmb28ifSwiY3Jvc3MtZmFkZSI6e3Byb3BlcnR5OiJiYWNrZ3JvdW5kSW1hZ2UiLHBhcmFtczoidXJsKGEucG5nKSwgdXJsKGIucG5nKSwgNTAlIn19O2VbInJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQiXT1lWyJyZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50Il09ZVsicmFkaWFsLWdyYWRpZW50Il09ZVsibGluZWFyLWdyYWRpZW50Il07dmFyIHQ9e2luaXRpYWw6ImNvbG9yIiwiem9vbS1pbiI6ImN1cnNvciIsInpvb20tb3V0IjoiY3Vyc29yIixib3g6ImRpc3BsYXkiLGZsZXhib3g6ImRpc3BsYXkiLCJpbmxpbmUtZmxleGJveCI6ImRpc3BsYXkiLGZsZXg6ImRpc3BsYXkiLCJpbmxpbmUtZmxleCI6ImRpc3BsYXkiLGdyaWQ6ImRpc3BsYXkiLCJpbmxpbmUtZ3JpZCI6ImRpc3BsYXkiLCJtaW4tY29udGVudCI6IndpZHRoIn07bi5mdW5jdGlvbnM9W107bi5rZXl3b3Jkcz1bXTt2YXIgcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKS5zdHlsZTtmb3IodmFyIHMgaW4gZSl7dmFyIG89ZVtzXSx1PW8ucHJvcGVydHksYT1zKyIoIitvLnBhcmFtcysiKSI7IWkoYSx1KSYmaShuLnByZWZpeCthLHUpJiZuLmZ1bmN0aW9ucy5wdXNoKHMpfWZvcih2YXIgZiBpbiB0KXt2YXIgdT10W2ZdOyFpKGYsdSkmJmkobi5wcmVmaXgrZix1KSYmbi5rZXl3b3Jkcy5wdXNoKGYpfX0pKCk7KGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcyhlKXtpLnRleHRDb250ZW50PWUrInt9IjtyZXR1cm4hIWkuc2hlZXQuY3NzUnVsZXMubGVuZ3RofXZhciB0PXsiOnJlYWQtb25seSI6bnVsbCwiOnJlYWQtd3JpdGUiOm51bGwsIjphbnktbGluayI6bnVsbCwiOjpzZWxlY3Rpb24iOm51bGx9LHI9e2tleWZyYW1lczoibmFtZSIsdmlld3BvcnQ6bnVsbCxkb2N1bWVudDoncmVnZXhwKCIuIiknfTtuLnNlbGVjdG9ycz1bXTtuLmF0cnVsZXM9W107dmFyIGk9ZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpKTtmb3IodmFyIG8gaW4gdCl7dmFyIHU9bysodFtvXT8iKCIrdFtvXSsiKSI6IiIpOyFzKHUpJiZzKG4ucHJlZml4U2VsZWN0b3IodSkpJiZuLnNlbGVjdG9ycy5wdXNoKG8pfWZvcih2YXIgYSBpbiByKXt2YXIgdT1hKyIgIisoclthXXx8IiIpOyFzKCJAIit1KSYmcygiQCIrbi5wcmVmaXgrdSkmJm4uYXRydWxlcy5wdXNoKGEpfWUucmVtb3ZlQ2hpbGQoaSl9KSgpO24udmFsdWVQcm9wZXJ0aWVzPVsidHJhbnNpdGlvbiIsInRyYW5zaXRpb24tcHJvcGVydHkiXTtlLmNsYXNzTmFtZSs9IiAiK24ucHJlZml4O1N0eWxlRml4LnJlZ2lzdGVyKG4ucHJlZml4Q1NTKX0pKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7Ci8qKgogKiBEZWZpbmVzIHRoZSBGbGF0IFN1cmZhY2UgU2hhZGVyIG5hbWVzcGFjZSBmb3IgYWxsIHRoZSBhd2Vzb21lbmVzcyB0byBleGlzdCB1cG9uLgogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTID0gewogIEZST05UICA6IDAsCiAgQkFDSyAgIDogMSwKICBET1VCTEUgOiAyLAogIFNWR05TICA6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycKfTsKCi8qKgogKiBAY2xhc3MgQXJyYXkKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5BcnJheSA9IHR5cGVvZiBGbG9hdDMyQXJyYXkgPT09ICdmdW5jdGlvbicgPyBGbG9hdDMyQXJyYXkgOiBBcnJheTsKCi8qKgogKiBAY2xhc3MgVXRpbHMKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5VdGlscyA9IHsKICBpc051bWJlcjogZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiAhaXNOYU4ocGFyc2VGbG9hdCh2YWx1ZSkpICYmIGlzRmluaXRlKHZhbHVlKTsKICB9Cn07CgovKioKICogUmVxdWVzdCBBbmltYXRpb24gRnJhbWUgUG9seWZpbGwuCiAqIEBhdXRob3IgUGF1bCBJcmlzaAogKiBAc2VlIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL3BhdWxpcmlzaC8xNTc5NjcxCiAqLwooZnVuY3Rpb24oKSB7CgogIHZhciBsYXN0VGltZSA9IDA7CiAgdmFyIHZlbmRvcnMgPSBbJ21zJywgJ21veicsICd3ZWJraXQnLCAnbyddOwoKICBmb3IodmFyIHggPSAwOyB4IDwgdmVuZG9ycy5sZW5ndGggJiYgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7ICsreCkgewogICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvd1t2ZW5kb3JzW3hdKydSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTsKICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSAgPSB3aW5kb3dbdmVuZG9yc1t4XSsnQ2FuY2VsQW5pbWF0aW9uRnJhbWUnXSB8fCB3aW5kb3dbdmVuZG9yc1t4XSsnQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107CiAgfQoKICBpZiAoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHsKICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihjYWxsYmFjaywgZWxlbWVudCkgewogICAgICB2YXIgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgdmFyIHRpbWVUb0NhbGwgPSBNYXRoLm1heCgwLCAxNiAtIChjdXJyZW50VGltZSAtIGxhc3RUaW1lKSk7CiAgICAgIHZhciBpZCA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGNhbGxiYWNrKGN1cnJlbnRUaW1lICsgdGltZVRvQ2FsbCk7CiAgICAgIH0sIHRpbWVUb0NhbGwpOwogICAgICBsYXN0VGltZSA9IGN1cnJlbnRUaW1lICsgdGltZVRvQ2FsbDsKICAgICAgcmV0dXJuIGlkOwogICAgfTsKICB9CgogIGlmICghd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKSB7CiAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihpZCkgewogICAgICBjbGVhclRpbWVvdXQoaWQpOwogICAgfTsKICB9Cgp9KCkpOwoKLyoqCiAqIEBvYmplY3QgTWF0aCBBdWdtZW50YXRpb24KICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCk1hdGguUElNMiA9IE1hdGguUEkqMjsKTWF0aC5QSUQyID0gTWF0aC5QSS8yOwpNYXRoLnJhbmRvbUluUmFuZ2UgPSBmdW5jdGlvbihtaW4sIG1heCkgewogIHJldHVybiBtaW4gKyAobWF4IC0gbWluKSAqIE1hdGgucmFuZG9tKCk7Cn07Ck1hdGguY2xhbXAgPSBmdW5jdGlvbih2YWx1ZSwgbWluLCBtYXgpIHsKICB2YWx1ZSA9IE1hdGgubWF4KHZhbHVlLCBtaW4pOwogIHZhbHVlID0gTWF0aC5taW4odmFsdWUsIG1heCk7CiAgcmV0dXJuIHZhbHVlOwp9OwoKLyoqCiAqIEBvYmplY3QgVmVjdG9yMwogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTLlZlY3RvcjMgPSB7CiAgY3JlYXRlOiBmdW5jdGlvbih4LCB5LCB6KSB7CiAgICB2YXIgdmVjdG9yID0gbmV3IEZTUy5BcnJheSgzKTsKICAgIHRoaXMuc2V0KHZlY3RvciwgeCwgeSwgeik7CiAgICByZXR1cm4gdmVjdG9yOwogIH0sCiAgY2xvbmU6IGZ1bmN0aW9uKGEpIHsKICAgIHZhciB2ZWN0b3IgPSB0aGlzLmNyZWF0ZSgpOwogICAgdGhpcy5jb3B5KHZlY3RvciwgYSk7CiAgICByZXR1cm4gdmVjdG9yOwogIH0sCiAgc2V0OiBmdW5jdGlvbih0YXJnZXQsIHgsIHksIHopIHsKICAgIHRhcmdldFswXSA9IHggfHwgMDsKICAgIHRhcmdldFsxXSA9IHkgfHwgMDsKICAgIHRhcmdldFsyXSA9IHogfHwgMDsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgc2V0WDogZnVuY3Rpb24odGFyZ2V0LCB4KSB7CiAgICB0YXJnZXRbMF0gPSB4IHx8IDA7CiAgICByZXR1cm4gdGhpczsKICB9LAogIHNldFk6IGZ1bmN0aW9uKHRhcmdldCwgeSkgewogICAgdGFyZ2V0WzFdID0geSB8fCAwOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBzZXRaOiBmdW5jdGlvbih0YXJnZXQsIHopIHsKICAgIHRhcmdldFsyXSA9IHogfHwgMDsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgY29weTogZnVuY3Rpb24odGFyZ2V0LCBhKSB7CiAgICB0YXJnZXRbMF0gPSBhWzBdOwogICAgdGFyZ2V0WzFdID0gYVsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIGFkZDogZnVuY3Rpb24odGFyZ2V0LCBhKSB7CiAgICB0YXJnZXRbMF0gKz0gYVswXTsKICAgIHRhcmdldFsxXSArPSBhWzFdOwogICAgdGFyZ2V0WzJdICs9IGFbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIGFkZFZlY3RvcnM6IGZ1bmN0aW9uKHRhcmdldCwgYSwgYikgewogICAgdGFyZ2V0WzBdID0gYVswXSArIGJbMF07CiAgICB0YXJnZXRbMV0gPSBhWzFdICsgYlsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl0gKyBiWzJdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBhZGRTY2FsYXI6IGZ1bmN0aW9uKHRhcmdldCwgcykgewogICAgdGFyZ2V0WzBdICs9IHM7CiAgICB0YXJnZXRbMV0gKz0gczsKICAgIHRhcmdldFsyXSArPSBzOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBzdWJ0cmFjdDogZnVuY3Rpb24odGFyZ2V0LCBhKSB7CiAgICB0YXJnZXRbMF0gLT0gYVswXTsKICAgIHRhcmdldFsxXSAtPSBhWzFdOwogICAgdGFyZ2V0WzJdIC09IGFbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIHN1YnRyYWN0VmVjdG9yczogZnVuY3Rpb24odGFyZ2V0LCBhLCBiKSB7CiAgICB0YXJnZXRbMF0gPSBhWzBdIC0gYlswXTsKICAgIHRhcmdldFsxXSA9IGFbMV0gLSBiWzFdOwogICAgdGFyZ2V0WzJdID0gYVsyXSAtIGJbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIHN1YnRyYWN0U2NhbGFyOiBmdW5jdGlvbih0YXJnZXQsIHMpIHsKICAgIHRhcmdldFswXSAtPSBzOwogICAgdGFyZ2V0WzFdIC09IHM7CiAgICB0YXJnZXRbMl0gLT0gczsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgbXVsdGlwbHk6IGZ1bmN0aW9uKHRhcmdldCwgYSkgewogICAgdGFyZ2V0WzBdICo9IGFbMF07CiAgICB0YXJnZXRbMV0gKj0gYVsxXTsKICAgIHRhcmdldFsyXSAqPSBhWzJdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtdWx0aXBseVZlY3RvcnM6IGZ1bmN0aW9uKHRhcmdldCwgYSwgYikgewogICAgdGFyZ2V0WzBdID0gYVswXSAqIGJbMF07CiAgICB0YXJnZXRbMV0gPSBhWzFdICogYlsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl0gKiBiWzJdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtdWx0aXBseVNjYWxhcjogZnVuY3Rpb24odGFyZ2V0LCBzKSB7CiAgICB0YXJnZXRbMF0gKj0gczsKICAgIHRhcmdldFsxXSAqPSBzOwogICAgdGFyZ2V0WzJdICo9IHM7CiAgICByZXR1cm4gdGhpczsKICB9LAogIGRpdmlkZTogZnVuY3Rpb24odGFyZ2V0LCBhKSB7CiAgICB0YXJnZXRbMF0gLz0gYVswXTsKICAgIHRhcmdldFsxXSAvPSBhWzFdOwogICAgdGFyZ2V0WzJdIC89IGFbMl07CiAgICByZXR1cm4gdGhpczsKICB9LAogIGRpdmlkZVZlY3RvcnM6IGZ1bmN0aW9uKHRhcmdldCwgYSwgYikgewogICAgdGFyZ2V0WzBdID0gYVswXSAvIGJbMF07CiAgICB0YXJnZXRbMV0gPSBhWzFdIC8gYlsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl0gLyBiWzJdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBkaXZpZGVTY2FsYXI6IGZ1bmN0aW9uKHRhcmdldCwgcykgewogICAgaWYgKHMgIT09IDApIHsKICAgICAgdGFyZ2V0WzBdIC89IHM7CiAgICAgIHRhcmdldFsxXSAvPSBzOwogICAgICB0YXJnZXRbMl0gLz0gczsKICAgIH0gZWxzZSB7CiAgICAgIHRhcmdldFswXSA9IDA7CiAgICAgIHRhcmdldFsxXSA9IDA7CiAgICAgIHRhcmdldFsyXSA9IDA7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9LAogIGNyb3NzOiBmdW5jdGlvbih0YXJnZXQsIGEpIHsKICAgIHZhciB4ID0gdGFyZ2V0WzBdOwogICAgdmFyIHkgPSB0YXJnZXRbMV07CiAgICB2YXIgeiA9IHRhcmdldFsyXTsKICAgIHRhcmdldFswXSA9IHkqYVsyXSAtIHoqYVsxXTsKICAgIHRhcmdldFsxXSA9IHoqYVswXSAtIHgqYVsyXTsKICAgIHRhcmdldFsyXSA9IHgqYVsxXSAtIHkqYVswXTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgY3Jvc3NWZWN0b3JzOiBmdW5jdGlvbih0YXJnZXQsIGEsIGIpIHsKICAgIHRhcmdldFswXSA9IGFbMV0qYlsyXSAtIGFbMl0qYlsxXTsKICAgIHRhcmdldFsxXSA9IGFbMl0qYlswXSAtIGFbMF0qYlsyXTsKICAgIHRhcmdldFsyXSA9IGFbMF0qYlsxXSAtIGFbMV0qYlswXTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgbWluOiBmdW5jdGlvbih0YXJnZXQsIHZhbHVlKSB7CiAgICBpZiAodGFyZ2V0WzBdIDwgdmFsdWUpIHsgdGFyZ2V0WzBdID0gdmFsdWU7IH0KICAgIGlmICh0YXJnZXRbMV0gPCB2YWx1ZSkgeyB0YXJnZXRbMV0gPSB2YWx1ZTsgfQogICAgaWYgKHRhcmdldFsyXSA8IHZhbHVlKSB7IHRhcmdldFsyXSA9IHZhbHVlOyB9CiAgICByZXR1cm4gdGhpczsKICB9LAogIG1heDogZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewogICAgaWYgKHRhcmdldFswXSA+IHZhbHVlKSB7IHRhcmdldFswXSA9IHZhbHVlOyB9CiAgICBpZiAodGFyZ2V0WzFdID4gdmFsdWUpIHsgdGFyZ2V0WzFdID0gdmFsdWU7IH0KICAgIGlmICh0YXJnZXRbMl0gPiB2YWx1ZSkgeyB0YXJnZXRbMl0gPSB2YWx1ZTsgfQogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBjbGFtcDogZnVuY3Rpb24odGFyZ2V0LCBtaW4sIG1heCkgewogICAgdGhpcy5taW4odGFyZ2V0LCBtaW4pOwogICAgdGhpcy5tYXgodGFyZ2V0LCBtYXgpOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBsaW1pdDogZnVuY3Rpb24odGFyZ2V0LCBtaW4sIG1heCkgewogICAgdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoKHRhcmdldCk7CiAgICBpZiAobWluICE9PSBudWxsICYmIGxlbmd0aCA8IG1pbikgewogICAgICB0aGlzLnNldExlbmd0aCh0YXJnZXQsIG1pbik7CiAgICB9IGVsc2UgaWYgKG1heCAhPT0gbnVsbCAmJiBsZW5ndGggPiBtYXgpIHsKICAgICAgdGhpcy5zZXRMZW5ndGgodGFyZ2V0LCBtYXgpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBkb3Q6IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBhWzBdKmJbMF0gKyBhWzFdKmJbMV0gKyBhWzJdKmJbMl07CiAgfSwKICBub3JtYWxpc2U6IGZ1bmN0aW9uKHRhcmdldCkgewogICAgcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKHRhcmdldCwgdGhpcy5sZW5ndGgodGFyZ2V0KSk7CiAgfSwKICBuZWdhdGU6IGZ1bmN0aW9uKHRhcmdldCkgewogICAgcmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIodGFyZ2V0LCAtMSk7CiAgfSwKICBkaXN0YW5jZVNxdWFyZWQ6IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHZhciBkeCA9IGFbMF0gLSBiWzBdOwogICAgdmFyIGR5ID0gYVsxXSAtIGJbMV07CiAgICB2YXIgZHogPSBhWzJdIC0gYlsyXTsKICAgIHJldHVybiBkeCpkeCArIGR5KmR5ICsgZHoqZHo7CiAgfSwKICBkaXN0YW5jZTogZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIE1hdGguc3FydCh0aGlzLmRpc3RhbmNlU3F1YXJlZChhLCBiKSk7CiAgfSwKICBsZW5ndGhTcXVhcmVkOiBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gYVswXSphWzBdICsgYVsxXSphWzFdICsgYVsyXSphWzJdOwogIH0sCiAgbGVuZ3RoOiBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMubGVuZ3RoU3F1YXJlZChhKSk7CiAgfSwKICBzZXRMZW5ndGg6IGZ1bmN0aW9uKHRhcmdldCwgbCkgewogICAgdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoKHRhcmdldCk7CiAgICBpZiAobGVuZ3RoICE9PSAwICYmIGwgIT09IGxlbmd0aCkgewogICAgICB0aGlzLm11bHRpcGx5U2NhbGFyKHRhcmdldCwgbCAvIGxlbmd0aCk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQG9iamVjdCBWZWN0b3I0CiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuVmVjdG9yNCA9IHsKICBjcmVhdGU6IGZ1bmN0aW9uKHgsIHksIHosIHcpIHsKICAgIHZhciB2ZWN0b3IgPSBuZXcgRlNTLkFycmF5KDQpOwogICAgdGhpcy5zZXQodmVjdG9yLCB4LCB5LCB6KTsKICAgIHJldHVybiB2ZWN0b3I7CiAgfSwKICBzZXQ6IGZ1bmN0aW9uKHRhcmdldCwgeCwgeSwgeiwgdykgewogICAgdGFyZ2V0WzBdID0geCB8fCAwOwogICAgdGFyZ2V0WzFdID0geSB8fCAwOwogICAgdGFyZ2V0WzJdID0geiB8fCAwOwogICAgdGFyZ2V0WzNdID0gdyB8fCAwOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBzZXRYOiBmdW5jdGlvbih0YXJnZXQsIHgpIHsKICAgIHRhcmdldFswXSA9IHggfHwgMDsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgc2V0WTogZnVuY3Rpb24odGFyZ2V0LCB5KSB7CiAgICB0YXJnZXRbMV0gPSB5IHx8IDA7CiAgICByZXR1cm4gdGhpczsKICB9LAogIHNldFo6IGZ1bmN0aW9uKHRhcmdldCwgeikgewogICAgdGFyZ2V0WzJdID0geiB8fCAwOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBzZXRXOiBmdW5jdGlvbih0YXJnZXQsIHcpIHsKICAgIHRhcmdldFszXSA9IHcgfHwgMDsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgYWRkOiBmdW5jdGlvbih0YXJnZXQsIGEpIHsKICAgIHRhcmdldFswXSArPSBhWzBdOwogICAgdGFyZ2V0WzFdICs9IGFbMV07CiAgICB0YXJnZXRbMl0gKz0gYVsyXTsKICAgIHRhcmdldFszXSArPSBhWzNdOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtdWx0aXBseVZlY3RvcnM6IGZ1bmN0aW9uKHRhcmdldCwgYSwgYikgewogICAgdGFyZ2V0WzBdID0gYVswXSAqIGJbMF07CiAgICB0YXJnZXRbMV0gPSBhWzFdICogYlsxXTsKICAgIHRhcmdldFsyXSA9IGFbMl0gKiBiWzJdOwogICAgdGFyZ2V0WzNdID0gYVszXSAqIGJbM107CiAgICByZXR1cm4gdGhpczsKICB9LAogIG11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbih0YXJnZXQsIHMpIHsKICAgIHRhcmdldFswXSAqPSBzOwogICAgdGFyZ2V0WzFdICo9IHM7CiAgICB0YXJnZXRbMl0gKj0gczsKICAgIHRhcmdldFszXSAqPSBzOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtaW46IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKICAgIGlmICh0YXJnZXRbMF0gPCB2YWx1ZSkgeyB0YXJnZXRbMF0gPSB2YWx1ZTsgfQogICAgaWYgKHRhcmdldFsxXSA8IHZhbHVlKSB7IHRhcmdldFsxXSA9IHZhbHVlOyB9CiAgICBpZiAodGFyZ2V0WzJdIDwgdmFsdWUpIHsgdGFyZ2V0WzJdID0gdmFsdWU7IH0KICAgIGlmICh0YXJnZXRbM10gPCB2YWx1ZSkgeyB0YXJnZXRbM10gPSB2YWx1ZTsgfQogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBtYXg6IGZ1bmN0aW9uKHRhcmdldCwgdmFsdWUpIHsKICAgIGlmICh0YXJnZXRbMF0gPiB2YWx1ZSkgeyB0YXJnZXRbMF0gPSB2YWx1ZTsgfQogICAgaWYgKHRhcmdldFsxXSA+IHZhbHVlKSB7IHRhcmdldFsxXSA9IHZhbHVlOyB9CiAgICBpZiAodGFyZ2V0WzJdID4gdmFsdWUpIHsgdGFyZ2V0WzJdID0gdmFsdWU7IH0KICAgIGlmICh0YXJnZXRbM10gPiB2YWx1ZSkgeyB0YXJnZXRbM10gPSB2YWx1ZTsgfQogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBjbGFtcDogZnVuY3Rpb24odGFyZ2V0LCBtaW4sIG1heCkgewogICAgdGhpcy5taW4odGFyZ2V0LCBtaW4pOwogICAgdGhpcy5tYXgodGFyZ2V0LCBtYXgpOwogICAgcmV0dXJuIHRoaXM7CiAgfQp9OwoKLyoqCiAqIEBjbGFzcyBDb2xvcgogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTLkNvbG9yID0gZnVuY3Rpb24oaGV4LCBvcGFjaXR5KSB7CiAgdGhpcy5yZ2JhID0gRlNTLlZlY3RvcjQuY3JlYXRlKCk7CiAgdGhpcy5oZXggPSBoZXggfHwgJyMwMDAwMDAnOwogIHRoaXMub3BhY2l0eSA9IEZTUy5VdGlscy5pc051bWJlcihvcGFjaXR5KSA/IG9wYWNpdHkgOiAxOwogIHRoaXMuc2V0KHRoaXMuaGV4LCB0aGlzLm9wYWNpdHkpOwp9OwoKRlNTLkNvbG9yLnByb3RvdHlwZSA9IHsKICBzZXQ6IGZ1bmN0aW9uKGhleCwgb3BhY2l0eSkgewogICAgaGV4ID0gaGV4LnJlcGxhY2UoJyMnLCAnJyk7CiAgICB2YXIgc2l6ZSA9IGhleC5sZW5ndGggLyAzOwogICAgdGhpcy5yZ2JhWzBdID0gcGFyc2VJbnQoaGV4LnN1YnN0cmluZyhzaXplKjAsIHNpemUqMSksIDE2KSAvIDI1NTsKICAgIHRoaXMucmdiYVsxXSA9IHBhcnNlSW50KGhleC5zdWJzdHJpbmcoc2l6ZSoxLCBzaXplKjIpLCAxNikgLyAyNTU7CiAgICB0aGlzLnJnYmFbMl0gPSBwYXJzZUludChoZXguc3Vic3RyaW5nKHNpemUqMiwgc2l6ZSozKSwgMTYpIC8gMjU1OwogICAgdGhpcy5yZ2JhWzNdID0gRlNTLlV0aWxzLmlzTnVtYmVyKG9wYWNpdHkpID8gb3BhY2l0eSA6IHRoaXMucmdiYVszXTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgaGV4aWZ5OiBmdW5jdGlvbihjaGFubmVsKSB7CiAgICB2YXIgaGV4ID0gTWF0aC5jZWlsKGNoYW5uZWwqMjU1KS50b1N0cmluZygxNik7CiAgICBpZiAoaGV4Lmxlbmd0aCA9PT0gMSkgeyBoZXggPSAnMCcgKyBoZXg7IH0KICAgIHJldHVybiBoZXg7CiAgfSwKICBmb3JtYXQ6IGZ1bmN0aW9uKCkgewogICAgdmFyIHIgPSB0aGlzLmhleGlmeSh0aGlzLnJnYmFbMF0pOwogICAgdmFyIGcgPSB0aGlzLmhleGlmeSh0aGlzLnJnYmFbMV0pOwogICAgdmFyIGIgPSB0aGlzLmhleGlmeSh0aGlzLnJnYmFbMl0pOwogICAgdGhpcy5oZXggPSAnIycgKyByICsgZyArIGI7CiAgICByZXR1cm4gdGhpcy5oZXg7CiAgfQp9OwoKLyoqCiAqIEBjbGFzcyBPYmplY3QKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5PYmplY3QgPSBmdW5jdGlvbigpIHsKICB0aGlzLnBvc2l0aW9uID0gRlNTLlZlY3RvcjMuY3JlYXRlKCk7Cn07CgpGU1MuT2JqZWN0LnByb3RvdHlwZSA9IHsKICBzZXRQb3NpdGlvbjogZnVuY3Rpb24oeCwgeSwgeikgewogICAgRlNTLlZlY3RvcjMuc2V0KHRoaXMucG9zaXRpb24sIHgsIHksIHopOwogICAgcmV0dXJuIHRoaXM7CiAgfQp9OwoKLyoqCiAqIEBjbGFzcyBMaWdodAogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTLkxpZ2h0ID0gZnVuY3Rpb24oYW1iaWVudCwgZGlmZnVzZSkgewogIEZTUy5PYmplY3QuY2FsbCh0aGlzKTsKICB0aGlzLmFtYmllbnQgPSBuZXcgRlNTLkNvbG9yKGFtYmllbnQgfHwgJyNGRkZGRkYnKTsKICB0aGlzLmRpZmZ1c2UgPSBuZXcgRlNTLkNvbG9yKGRpZmZ1c2UgfHwgJyNGRkZGRkYnKTsKICB0aGlzLnJheSA9IEZTUy5WZWN0b3IzLmNyZWF0ZSgpOwp9OwoKRlNTLkxpZ2h0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRlNTLk9iamVjdC5wcm90b3R5cGUpOwoKLyoqCiAqIEBjbGFzcyBWZXJ0ZXgKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5WZXJ0ZXggPSBmdW5jdGlvbih4LCB5LCB6KSB7CiAgdGhpcy5wb3NpdGlvbiA9IEZTUy5WZWN0b3IzLmNyZWF0ZSh4LCB5LCB6KTsKfTsKCkZTUy5WZXJ0ZXgucHJvdG90eXBlID0gewogIHNldFBvc2l0aW9uOiBmdW5jdGlvbih4LCB5LCB6KSB7CiAgICBGU1MuVmVjdG9yMy5zZXQodGhpcy5wb3NpdGlvbiwgeCwgeSwgeik7CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQGNsYXNzIFRyaWFuZ2xlCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuVHJpYW5nbGUgPSBmdW5jdGlvbihhLCBiLCBjKSB7CiAgdGhpcy5hID0gYSB8fCBuZXcgRlNTLlZlcnRleCgpOwogIHRoaXMuYiA9IGIgfHwgbmV3IEZTUy5WZXJ0ZXgoKTsKICB0aGlzLmMgPSBjIHx8IG5ldyBGU1MuVmVydGV4KCk7CiAgdGhpcy52ZXJ0aWNlcyA9IFt0aGlzLmEsIHRoaXMuYiwgdGhpcy5jXTsKICB0aGlzLnUgPSBGU1MuVmVjdG9yMy5jcmVhdGUoKTsKICB0aGlzLnYgPSBGU1MuVmVjdG9yMy5jcmVhdGUoKTsKICB0aGlzLmNlbnRyb2lkID0gRlNTLlZlY3RvcjMuY3JlYXRlKCk7CiAgdGhpcy5ub3JtYWwgPSBGU1MuVmVjdG9yMy5jcmVhdGUoKTsKICB0aGlzLmNvbG9yID0gbmV3IEZTUy5Db2xvcigpOwogIHRoaXMucG9seWdvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhGU1MuU1ZHTlMsICdwb2x5Z29uJyk7CiAgdGhpcy5wb2x5Z29uLnNldEF0dHJpYnV0ZU5TKG51bGwsICdzdHJva2UtbGluZWpvaW4nLCAncm91bmQnKTsKICB0aGlzLnBvbHlnb24uc2V0QXR0cmlidXRlTlMobnVsbCwgJ3N0cm9rZS1taXRlcmxpbWl0JywgJzEnKTsKICB0aGlzLnBvbHlnb24uc2V0QXR0cmlidXRlTlMobnVsbCwgJ3N0cm9rZS13aWR0aCcsICcxJyk7CiAgdGhpcy5jb21wdXRlQ2VudHJvaWQoKTsKICB0aGlzLmNvbXB1dGVOb3JtYWwoKTsKfTsKCkZTUy5UcmlhbmdsZS5wcm90b3R5cGUgPSB7CiAgY29tcHV0ZUNlbnRyb2lkOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuY2VudHJvaWRbMF0gPSB0aGlzLmEucG9zaXRpb25bMF0gKyB0aGlzLmIucG9zaXRpb25bMF0gKyB0aGlzLmMucG9zaXRpb25bMF07CiAgICB0aGlzLmNlbnRyb2lkWzFdID0gdGhpcy5hLnBvc2l0aW9uWzFdICsgdGhpcy5iLnBvc2l0aW9uWzFdICsgdGhpcy5jLnBvc2l0aW9uWzFdOwogICAgdGhpcy5jZW50cm9pZFsyXSA9IHRoaXMuYS5wb3NpdGlvblsyXSArIHRoaXMuYi5wb3NpdGlvblsyXSArIHRoaXMuYy5wb3NpdGlvblsyXTsKICAgIEZTUy5WZWN0b3IzLmRpdmlkZVNjYWxhcih0aGlzLmNlbnRyb2lkLCAzKTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgY29tcHV0ZU5vcm1hbDogZnVuY3Rpb24oKSB7CiAgICBGU1MuVmVjdG9yMy5zdWJ0cmFjdFZlY3RvcnModGhpcy51LCB0aGlzLmIucG9zaXRpb24sIHRoaXMuYS5wb3NpdGlvbik7CiAgICBGU1MuVmVjdG9yMy5zdWJ0cmFjdFZlY3RvcnModGhpcy52LCB0aGlzLmMucG9zaXRpb24sIHRoaXMuYS5wb3NpdGlvbik7CiAgICBGU1MuVmVjdG9yMy5jcm9zc1ZlY3RvcnModGhpcy5ub3JtYWwsIHRoaXMudSwgdGhpcy52KTsKICAgIEZTUy5WZWN0b3IzLm5vcm1hbGlzZSh0aGlzLm5vcm1hbCk7CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQGNsYXNzIEdlb21ldHJ5CiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuR2VvbWV0cnkgPSBmdW5jdGlvbigpIHsKICB0aGlzLnZlcnRpY2VzID0gW107CiAgdGhpcy50cmlhbmdsZXMgPSBbXTsKICB0aGlzLmRpcnR5ID0gZmFsc2U7Cn07CgpGU1MuR2VvbWV0cnkucHJvdG90eXBlID0gewogIHVwZGF0ZTogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICB2YXIgdCx0cmlhbmdsZTsKICAgICAgZm9yICh0ID0gdGhpcy50cmlhbmdsZXMubGVuZ3RoIC0gMTsgdCA+PSAwOyB0LS0pIHsKICAgICAgICB0cmlhbmdsZSA9IHRoaXMudHJpYW5nbGVzW3RdOwogICAgICAgIHRyaWFuZ2xlLmNvbXB1dGVDZW50cm9pZCgpOwogICAgICAgIHRyaWFuZ2xlLmNvbXB1dGVOb3JtYWwoKTsKICAgICAgfQogICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQGNsYXNzIFBsYW5lCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkLCBtb2RpZmllZCBieSBNYWtzaW0gU3VyZ3V5IHRvIGltcGxlbWVudCBEZWxhdW5heSB0cmlhbmd1bGF0aW9uCiAqLwpGU1MuUGxhbmUgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0LCBob3dtYW55KSB7CiAgRlNTLkdlb21ldHJ5LmNhbGwodGhpcyk7CiAgdGhpcy53aWR0aCA9IHdpZHRoIHx8IDEwMDsKICB0aGlzLmhlaWdodCA9IGhlaWdodCB8fCAxMDA7CgogIC8vIENhY2hlIFZhcmlhYmxlcwogIHZhciB4LCB5LCB2ZXJ0aWNlcyA9IG5ldyBBcnJheShob3dtYW55KTsKICAgIG9mZnNldFggPSB0aGlzLndpZHRoICogLTAuNSwKICAgIG9mZnNldFkgPSB0aGlzLmhlaWdodCAqIDAuNTsKCiAgZm9yKGkgPSB2ZXJ0aWNlcy5sZW5ndGg7IGktLTsgKSB7CiAgICB4ID0gIG9mZnNldFggKyBNYXRoLnJhbmRvbSgpKndpZHRoOwogICAgeSA9ICBvZmZzZXRZIC0gTWF0aC5yYW5kb20oKSpoZWlnaHQ7CgogICAgdmVydGljZXNbaV0gPSBbeCwgeV07CiAgfQoKICAvLyBHZW5lcmF0ZSBhZGRpdGlvbmFsIHBvaW50cyBvbiB0aGUgcGVyaW1ldGVyIHNvIHRoYXQgdGhlcmUgYXJlIG5vIGhvbGVzIGluIHRoZSBwYXR0ZXJuCiAgdmVydGljZXMucHVzaChbb2Zmc2V0WCwgb2Zmc2V0WV0pOwogIHZlcnRpY2VzLnB1c2goW29mZnNldFggKyB3aWR0aC8yLCBvZmZzZXRZXSk7CiAgdmVydGljZXMucHVzaChbb2Zmc2V0WCArIHdpZHRoLCBvZmZzZXRZXSk7CiAgdmVydGljZXMucHVzaChbb2Zmc2V0WCArIHdpZHRoLCBvZmZzZXRZIC0gaGVpZ2h0LzJdKTsKICB2ZXJ0aWNlcy5wdXNoKFtvZmZzZXRYICsgd2lkdGgsIG9mZnNldFkgLSBoZWlnaHRdKTsKICB2ZXJ0aWNlcy5wdXNoKFtvZmZzZXRYICsgd2lkdGgvMiwgb2Zmc2V0WSAtIGhlaWdodF0pOwogIHZlcnRpY2VzLnB1c2goW29mZnNldFgsIG9mZnNldFkgLSBoZWlnaHRdKTsKICB2ZXJ0aWNlcy5wdXNoKFtvZmZzZXRYLCBvZmZzZXRZIC0gaGVpZ2h0LzJdKTsKCiAgLy8gR2VuZXJhdGUgYWRkaXRpb25hbCByYW5kb21seSBwbGFjZWQgcG9pbnRzIG9uIHRoZSBwZXJpbWV0ZXIKICBmb3IgKHZhciBpID0gNjsgaSA+PSAwOyBpLS0pIHsKICAgIHZlcnRpY2VzLnB1c2goWyBvZmZzZXRYICsgTWF0aC5yYW5kb20oKSp3aWR0aCwgb2Zmc2V0WV0pOwogICAgdmVydGljZXMucHVzaChbIG9mZnNldFgsIG9mZnNldFkgLSBNYXRoLnJhbmRvbSgpKmhlaWdodF0pOwogICAgdmVydGljZXMucHVzaChbIG9mZnNldFggKyB3aWR0aCwgb2Zmc2V0WSAtIE1hdGgucmFuZG9tKCkqaGVpZ2h0XSk7CiAgICB2ZXJ0aWNlcy5wdXNoKFsgb2Zmc2V0WCArIE1hdGgucmFuZG9tKCkqd2lkdGgsIG9mZnNldFktaGVpZ2h0XSk7CiAgfQoKICAvLyBDcmVhdGUgYW4gYXJyYXkgb2YgdHJpYW5ndWxhdGVkIGNvb3JkaW5hdGVzIGZyb20gb3VyIHZlcnRpY2VzCiAgdmFyIHRyaWFuZ2xlcyA9IERlbGF1bmF5LnRyaWFuZ3VsYXRlKHZlcnRpY2VzKTsKCiAgZm9yKGkgPSB0cmlhbmdsZXMubGVuZ3RoOyBpOyApIHsKICAgIC0taTsKICAgIHYxID0gbmV3IEZTUy5WZXJ0ZXgoTWF0aC5jZWlsKHZlcnRpY2VzW3RyaWFuZ2xlc1tpXV1bMF0pLCBNYXRoLmNlaWwodmVydGljZXNbdHJpYW5nbGVzW2ldXVsxXSkpOwogICAgLS1pOwogICAgdjIgPSBuZXcgRlNTLlZlcnRleChNYXRoLmNlaWwodmVydGljZXNbdHJpYW5nbGVzW2ldXVswXSksIE1hdGguY2VpbCh2ZXJ0aWNlc1t0cmlhbmdsZXNbaV1dWzFdKSk7CiAgICAtLWk7CiAgICB2MyA9IG5ldyBGU1MuVmVydGV4KE1hdGguY2VpbCh2ZXJ0aWNlc1t0cmlhbmdsZXNbaV1dWzBdKSwgTWF0aC5jZWlsKHZlcnRpY2VzW3RyaWFuZ2xlc1tpXV1bMV0pKTsKICAgIHQxID0gbmV3IEZTUy5UcmlhbmdsZSh2MSx2Mix2Myk7CiAgICB0aGlzLnRyaWFuZ2xlcy5wdXNoKHQxKTsKICAgIHRoaXMudmVydGljZXMucHVzaCh2MSk7CiAgICB0aGlzLnZlcnRpY2VzLnB1c2godjIpOwogICAgdGhpcy52ZXJ0aWNlcy5wdXNoKHYzKTsKICB9Cn07CgpGU1MuUGxhbmUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShGU1MuR2VvbWV0cnkucHJvdG90eXBlKTsKCi8qKgogKiBAY2xhc3MgTWF0ZXJpYWwKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5NYXRlcmlhbCA9IGZ1bmN0aW9uKGFtYmllbnQsIGRpZmZ1c2UpIHsKICB0aGlzLmFtYmllbnQgPSBuZXcgRlNTLkNvbG9yKGFtYmllbnQgfHwgJyM0NDQ0NDQnKTsKICB0aGlzLmRpZmZ1c2UgPSBuZXcgRlNTLkNvbG9yKGRpZmZ1c2UgfHwgJyNGRkZGRkYnKTsKICB0aGlzLnNsYXZlID0gbmV3IEZTUy5Db2xvcigpOwp9OwoKLyoqCiAqIEBjbGFzcyBNZXNoCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuTWVzaCA9IGZ1bmN0aW9uKGdlb21ldHJ5LCBtYXRlcmlhbCkgewogIEZTUy5PYmplY3QuY2FsbCh0aGlzKTsKICB0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnkgfHwgbmV3IEZTUy5HZW9tZXRyeSgpOwogIHRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbCB8fCBuZXcgRlNTLk1hdGVyaWFsKCk7CiAgdGhpcy5zaWRlID0gRlNTLkZST05UOwogIHRoaXMudmlzaWJsZSA9IHRydWU7Cn07CgpGU1MuTWVzaC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEZTUy5PYmplY3QucHJvdG90eXBlKTsKCkZTUy5NZXNoLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihsaWdodHMsIGNhbGN1bGF0ZSkgewogIHZhciB0LHRyaWFuZ2xlLCBsLGxpZ2h0LCBpbGx1bWluYW5jZTsKCiAgLy8gVXBkYXRlIEdlb21ldHJ5CiAgdGhpcy5nZW9tZXRyeS51cGRhdGUoKTsKCiAgLy8gQ2FsY3VsYXRlIHRoZSB0cmlhbmdsZSBjb2xvcnMKICBpZiAoY2FsY3VsYXRlKSB7CgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIFRyaWFuZ2xlcwogICAgZm9yICh0ID0gdGhpcy5nZW9tZXRyeS50cmlhbmdsZXMubGVuZ3RoIC0gMTsgdCA+PSAwOyB0LS0pIHsKICAgICAgdHJpYW5nbGUgPSB0aGlzLmdlb21ldHJ5LnRyaWFuZ2xlc1t0XTsKCiAgICAgIC8vIFJlc2V0IFRyaWFuZ2xlIENvbG9yCiAgICAgIEZTUy5WZWN0b3I0LnNldCh0cmlhbmdsZS5jb2xvci5yZ2JhKTsKCiAgICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBMaWdodHMKICAgICAgZm9yIChsID0gbGlnaHRzLmxlbmd0aCAtIDE7IGwgPj0gMDsgbC0tKSB7CiAgICAgICAgbGlnaHQgPSBsaWdodHNbbF07CgogICAgICAgIC8vIENhbGN1bGF0ZSBJbGx1bWluYW5jZQogICAgICAgIEZTUy5WZWN0b3IzLnN1YnRyYWN0VmVjdG9ycyhsaWdodC5yYXksIGxpZ2h0LnBvc2l0aW9uLCB0cmlhbmdsZS5jZW50cm9pZCk7CiAgICAgICAgRlNTLlZlY3RvcjMubm9ybWFsaXNlKGxpZ2h0LnJheSk7CiAgICAgICAgaWxsdW1pbmFuY2UgPSBGU1MuVmVjdG9yMy5kb3QodHJpYW5nbGUubm9ybWFsLCBsaWdodC5yYXkpOwogICAgICAgIGlmICh0aGlzLnNpZGUgPT09IEZTUy5GUk9OVCkgewogICAgICAgICAgaWxsdW1pbmFuY2UgPSBNYXRoLm1heChpbGx1bWluYW5jZSwgMCk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNpZGUgPT09IEZTUy5CQUNLKSB7CiAgICAgICAgICBpbGx1bWluYW5jZSA9IE1hdGguYWJzKE1hdGgubWluKGlsbHVtaW5hbmNlLCAwKSk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNpZGUgPT09IEZTUy5ET1VCTEUpIHsKICAgICAgICAgIGlsbHVtaW5hbmNlID0gTWF0aC5tYXgoTWF0aC5hYnMoaWxsdW1pbmFuY2UpLCAwKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBBbWJpZW50IExpZ2h0CiAgICAgICAgRlNTLlZlY3RvcjQubXVsdGlwbHlWZWN0b3JzKHRoaXMubWF0ZXJpYWwuc2xhdmUucmdiYSwgdGhpcy5tYXRlcmlhbC5hbWJpZW50LnJnYmEsIGxpZ2h0LmFtYmllbnQucmdiYSk7CiAgICAgICAgRlNTLlZlY3RvcjQuYWRkKHRyaWFuZ2xlLmNvbG9yLnJnYmEsIHRoaXMubWF0ZXJpYWwuc2xhdmUucmdiYSk7CgogICAgICAgIC8vIENhbGN1bGF0ZSBEaWZmdXNlIExpZ2h0CiAgICAgICAgRlNTLlZlY3RvcjQubXVsdGlwbHlWZWN0b3JzKHRoaXMubWF0ZXJpYWwuc2xhdmUucmdiYSwgdGhpcy5tYXRlcmlhbC5kaWZmdXNlLnJnYmEsIGxpZ2h0LmRpZmZ1c2UucmdiYSk7CiAgICAgICAgRlNTLlZlY3RvcjQubXVsdGlwbHlTY2FsYXIodGhpcy5tYXRlcmlhbC5zbGF2ZS5yZ2JhLCBpbGx1bWluYW5jZSk7CiAgICAgICAgRlNTLlZlY3RvcjQuYWRkKHRyaWFuZ2xlLmNvbG9yLnJnYmEsIHRoaXMubWF0ZXJpYWwuc2xhdmUucmdiYSk7CiAgICAgIH0KCiAgICAgIC8vIENsYW1wICYgRm9ybWF0IENvbG9yCiAgICAgIEZTUy5WZWN0b3I0LmNsYW1wKHRyaWFuZ2xlLmNvbG9yLnJnYmEsIDAsIDEpOwogICAgfQogIH0KICByZXR1cm4gdGhpczsKfTsKCi8qKgogKiBAY2xhc3MgU2NlbmUKICogQGF1dGhvciBNYXR0aGV3IFdhZ2VyZmllbGQKICovCkZTUy5TY2VuZSA9IGZ1bmN0aW9uKCkgewogIHRoaXMubWVzaGVzID0gW107CiAgdGhpcy5saWdodHMgPSBbXTsKfTsKCkZTUy5TY2VuZS5wcm90b3R5cGUgPSB7CiAgYWRkOiBmdW5jdGlvbihvYmplY3QpIHsKICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBGU1MuTWVzaCAmJiAhfnRoaXMubWVzaGVzLmluZGV4T2Yob2JqZWN0KSkgewogICAgICB0aGlzLm1lc2hlcy5wdXNoKG9iamVjdCk7CiAgICB9IGVsc2UgaWYgKG9iamVjdCBpbnN0YW5jZW9mIEZTUy5MaWdodCAmJiAhfnRoaXMubGlnaHRzLmluZGV4T2Yob2JqZWN0KSkgewogICAgICB0aGlzLmxpZ2h0cy5wdXNoKG9iamVjdCk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9LAogIHJlbW92ZTogZnVuY3Rpb24ob2JqZWN0KSB7CiAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRlNTLk1lc2ggJiYgfnRoaXMubWVzaGVzLmluZGV4T2Yob2JqZWN0KSkgewogICAgICB0aGlzLm1lc2hlcy5zcGxpY2UodGhpcy5tZXNoZXMuaW5kZXhPZihvYmplY3QpLCAxKTsKICAgIH0gZWxzZSBpZiAob2JqZWN0IGluc3RhbmNlb2YgRlNTLkxpZ2h0ICYmIH50aGlzLmxpZ2h0cy5pbmRleE9mKG9iamVjdCkpIHsKICAgICAgdGhpcy5saWdodHMuc3BsaWNlKHRoaXMubGlnaHRzLmluZGV4T2Yob2JqZWN0KSwgMSk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9Cn07CgovKioKICogQGNsYXNzIFJlbmRlcmVyCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuUmVuZGVyZXIgPSBmdW5jdGlvbigpIHsKICB0aGlzLndpZHRoID0gMDsKICB0aGlzLmhlaWdodCA9IDA7CiAgdGhpcy5oYWxmV2lkdGggPSAwOwogIHRoaXMuaGFsZkhlaWdodCA9IDA7Cn07CgpGU1MuUmVuZGVyZXIucHJvdG90eXBlID0gewogIHNldFNpemU6IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICAgIGlmICh0aGlzLndpZHRoID09PSB3aWR0aCAmJiB0aGlzLmhlaWdodCA9PT0gaGVpZ2h0KSByZXR1cm47CiAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICAgIHRoaXMuaGFsZldpZHRoID0gdGhpcy53aWR0aCAqIDAuNTsKICAgIHRoaXMuaGFsZkhlaWdodCA9IHRoaXMuaGVpZ2h0ICogMC41OwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBjbGVhcjogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpczsKICB9LAogIHJlbmRlcjogZnVuY3Rpb24oc2NlbmUpIHsKICAgIHJldHVybiB0aGlzOwogIH0KfTsKCi8qKgogKiBAY2xhc3MgQ2FudmFzIFJlbmRlcmVyCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuQ2FudmFzUmVuZGVyZXIgPSBmdW5jdGlvbigpIHsKICBGU1MuUmVuZGVyZXIuY2FsbCh0aGlzKTsKICB0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgdGhpcy5jb250ZXh0ID0gdGhpcy5lbGVtZW50LmdldENvbnRleHQoJzJkJyk7CiAgdGhpcy5zZXRTaXplKHRoaXMuZWxlbWVudC53aWR0aCwgdGhpcy5lbGVtZW50LmhlaWdodCk7Cn07CgpGU1MuQ2FudmFzUmVuZGVyZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShGU1MuUmVuZGVyZXIucHJvdG90eXBlKTsKCkZTUy5DYW52YXNSZW5kZXJlci5wcm90b3R5cGUuc2V0U2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLnNldFNpemUuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KTsKICB0aGlzLmVsZW1lbnQud2lkdGggPSB3aWR0aDsKICB0aGlzLmVsZW1lbnQuaGVpZ2h0ID0gaGVpZ2h0OwogIHRoaXMuY29udGV4dC5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgLTEsIHRoaXMuaGFsZldpZHRoLCB0aGlzLmhhbGZIZWlnaHQpOwogIHJldHVybiB0aGlzOwp9OwoKRlNTLkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkgewogIEZTUy5SZW5kZXJlci5wcm90b3R5cGUuY2xlYXIuY2FsbCh0aGlzKTsKICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KC10aGlzLmhhbGZXaWR0aCwgLXRoaXMuaGFsZkhlaWdodCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpOwogIHJldHVybiB0aGlzOwp9OwoKRlNTLkNhbnZhc1JlbmRlcmVyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbihzY2VuZSkgewogIEZTUy5SZW5kZXJlci5wcm90b3R5cGUucmVuZGVyLmNhbGwodGhpcywgc2NlbmUpOwogIHZhciBtLG1lc2gsIHQsdHJpYW5nbGUsIGNvbG9yOwoKICAvLyBDbGVhciBDb250ZXh0CiAgdGhpcy5jbGVhcigpOwoKICAvLyBDb25maWd1cmUgQ29udGV4dAogIHRoaXMuY29udGV4dC5saW5lSm9pbiA9ICdyb3VuZCc7CiAgdGhpcy5jb250ZXh0LmxpbmVXaWR0aCA9IDE7CgogIC8vIFVwZGF0ZSBNZXNoZXMKICBmb3IgKG0gPSBzY2VuZS5tZXNoZXMubGVuZ3RoIC0gMTsgbSA+PSAwOyBtLS0pIHsKICAgIG1lc2ggPSBzY2VuZS5tZXNoZXNbbV07CiAgICBpZiAobWVzaC52aXNpYmxlKSB7CiAgICAgIG1lc2gudXBkYXRlKHNjZW5lLmxpZ2h0cywgdHJ1ZSk7CgogICAgICAvLyBSZW5kZXIgVHJpYW5nbGVzCiAgICAgIGZvciAodCA9IG1lc2guZ2VvbWV0cnkudHJpYW5nbGVzLmxlbmd0aCAtIDE7IHQgPj0gMDsgdC0tKSB7CiAgICAgICAgdHJpYW5nbGUgPSBtZXNoLmdlb21ldHJ5LnRyaWFuZ2xlc1t0XTsKICAgICAgICBjb2xvciA9IHRyaWFuZ2xlLmNvbG9yLmZvcm1hdCgpOwogICAgICAgIHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTsKICAgICAgICB0aGlzLmNvbnRleHQubW92ZVRvKHRyaWFuZ2xlLmEucG9zaXRpb25bMF0sIHRyaWFuZ2xlLmEucG9zaXRpb25bMV0pOwogICAgICAgIHRoaXMuY29udGV4dC5saW5lVG8odHJpYW5nbGUuYi5wb3NpdGlvblswXSwgdHJpYW5nbGUuYi5wb3NpdGlvblsxXSk7CiAgICAgICAgdGhpcy5jb250ZXh0LmxpbmVUbyh0cmlhbmdsZS5jLnBvc2l0aW9uWzBdLCB0cmlhbmdsZS5jLnBvc2l0aW9uWzFdKTsKICAgICAgICB0aGlzLmNvbnRleHQuY2xvc2VQYXRoKCk7CiAgICAgICAgdGhpcy5jb250ZXh0LnN0cm9rZVN0eWxlID0gY29sb3I7CiAgICAgICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IGNvbG9yOwogICAgICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTsKICAgICAgICB0aGlzLmNvbnRleHQuZmlsbCgpOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiB0aGlzOwp9OwoKLyoqCiAqIEBjbGFzcyBXZWJHTCBSZW5kZXJlcgogKiBAYXV0aG9yIE1hdHRoZXcgV2FnZXJmaWVsZAogKi8KRlNTLldlYkdMUmVuZGVyZXIgPSBmdW5jdGlvbigpIHsKICBGU1MuUmVuZGVyZXIuY2FsbCh0aGlzKTsKICB0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgogIC8vIFNldCBpbml0aWFsIHZlcnRleCBhbmQgbGlnaHQgY291bnQKICB0aGlzLnZlcnRpY2VzID0gbnVsbDsKICB0aGlzLmxpZ2h0cyA9IG51bGw7CgogIC8vIENyZWF0ZSBwYXJhbWV0ZXJzIG9iamVjdAogIHZhciBwYXJhbWV0ZXJzID0gewogICAgcHJlc2VydmVEcmF3aW5nQnVmZmVyOiBmYWxzZSwKICAgIHByZW11bHRpcGxpZWRBbHBoYTogdHJ1ZSwKICAgIGFudGlhbGlhczogdHJ1ZSwKICAgIHN0ZW5jaWw6IHRydWUsCiAgICBhbHBoYTogdHJ1ZQogIH07CgogIC8vIENyZWF0ZSBhbmQgY29uZmlndXJlIHRoZSBnbCBjb250ZXh0CiAgdGhpcy5nbCA9IHRoaXMuZ2V0Q29udGV4dCh0aGlzLmVsZW1lbnQsIHBhcmFtZXRlcnMpOwoKICAvLyBTZXQgdGhlIGludGVybmFsIHN1cHBvcnQgZmxhZwogIHRoaXMudW5zdXBwb3J0ZWQgPSAhdGhpcy5nbDsKCiAgLy8gU2V0dXAgcmVuZGVyZXIKICBpZiAodGhpcy51bnN1cHBvcnRlZCkgewogICAgcmV0dXJuICdXZWJHTCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3Nlci4nOwogIH0gZWxzZSB7CiAgICB0aGlzLmdsLmNsZWFyQ29sb3IoMC4wLCAwLjAsIDAuMCwgMC4wKTsKICAgIHRoaXMuZ2wuZW5hYmxlKHRoaXMuZ2wuREVQVEhfVEVTVCk7CiAgICB0aGlzLnNldFNpemUodGhpcy5lbGVtZW50LndpZHRoLCB0aGlzLmVsZW1lbnQuaGVpZ2h0KTsKICB9Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEZTUy5SZW5kZXJlci5wcm90b3R5cGUpOwoKRlNTLldlYkdMUmVuZGVyZXIucHJvdG90eXBlLmdldENvbnRleHQgPSBmdW5jdGlvbihjYW52YXMsIHBhcmFtZXRlcnMpIHsKICB2YXIgY29udGV4dCA9IGZhbHNlOwogIHRyeSB7CiAgICBpZiAoIShjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJ2V4cGVyaW1lbnRhbC13ZWJnbCcsIHBhcmFtZXRlcnMpKSkgewogICAgICB0aHJvdyAnRXJyb3IgY3JlYXRpbmcgV2ViR0wgY29udGV4dC4nOwogICAgfQogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICB9CiAgcmV0dXJuIGNvbnRleHQ7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc2V0U2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLnNldFNpemUuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KTsKICBpZiAodGhpcy51bnN1cHBvcnRlZCkgcmV0dXJuOwoKICAvLyBTZXQgdGhlIHNpemUgb2YgdGhlIGNhbnZhcyBlbGVtZW50CiAgdGhpcy5lbGVtZW50LndpZHRoID0gd2lkdGg7CiAgdGhpcy5lbGVtZW50LmhlaWdodCA9IGhlaWdodDsKCiAgLy8gU2V0IHRoZSBzaXplIG9mIHRoZSBnbCB2aWV3cG9ydAogIHRoaXMuZ2wudmlld3BvcnQoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgcmV0dXJuIHRoaXM7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLmNsZWFyLmNhbGwodGhpcyk7CiAgaWYgKHRoaXMudW5zdXBwb3J0ZWQpIHJldHVybjsKICB0aGlzLmdsLmNsZWFyKHRoaXMuZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IHRoaXMuZ2wuREVQVEhfQlVGRkVSX0JJVCk7CiAgcmV0dXJuIHRoaXM7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oc2NlbmUpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLnJlbmRlci5jYWxsKHRoaXMsIHNjZW5lKTsKICBpZiAodGhpcy51bnN1cHBvcnRlZCkgcmV0dXJuOwogIHZhciBtLG1lc2gsIHQsdGwsdHJpYW5nbGUsIGwsbGlnaHQsCiAgICAgIGF0dHJpYnV0ZSwgdW5pZm9ybSwgYnVmZmVyLCBkYXRhLCBsb2NhdGlvbiwKICAgICAgdXBkYXRlID0gZmFsc2UsIGxpZ2h0cyA9IHNjZW5lLmxpZ2h0cy5sZW5ndGgsCiAgICAgIGluZGV4LCB2LHZsLHZldGV4LHZlcnRpY2VzID0gMDsKCiAgLy8gQ2xlYXIgY29udGV4dAogIHRoaXMuY2xlYXIoKTsKCiAgLy8gQnVpbGQgdGhlIHNoYWRlciBwcm9ncmFtCiAgaWYgKHRoaXMubGlnaHRzICE9PSBsaWdodHMpIHsKICAgIHRoaXMubGlnaHRzID0gbGlnaHRzOwogICAgaWYgKHRoaXMubGlnaHRzID4gMCkgewogICAgICB0aGlzLmJ1aWxkUHJvZ3JhbShsaWdodHMpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuOwogICAgfQogIH0KCiAgLy8gVXBkYXRlIHByb2dyYW0KICBpZiAoISF0aGlzLnByb2dyYW0pIHsKCiAgICAvLyBJbmNyZW1lbnQgdmVydGV4IGNvdW50ZXIKICAgIGZvciAobSA9IHNjZW5lLm1lc2hlcy5sZW5ndGggLSAxOyBtID49IDA7IG0tLSkgewogICAgICBtZXNoID0gc2NlbmUubWVzaGVzW21dOwogICAgICBpZiAobWVzaC5nZW9tZXRyeS5kaXJ0eSkgdXBkYXRlID0gdHJ1ZTsKICAgICAgbWVzaC51cGRhdGUoc2NlbmUubGlnaHRzLCBmYWxzZSk7CiAgICAgIHZlcnRpY2VzICs9IG1lc2guZ2VvbWV0cnkudHJpYW5nbGVzLmxlbmd0aCozOwogICAgfQoKICAgIC8vIENvbXBhcmUgdmVydGV4IGNvdW50ZXIKICAgIGlmICh1cGRhdGUgfHwgdGhpcy52ZXJ0aWNlcyAhPT0gdmVydGljZXMpIHsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwoKICAgICAgLy8gQnVpbGQgYnVmZmVycwogICAgICBmb3IgKGF0dHJpYnV0ZSBpbiB0aGlzLnByb2dyYW0uYXR0cmlidXRlcykgewogICAgICAgIGJ1ZmZlciA9IHRoaXMucHJvZ3JhbS5hdHRyaWJ1dGVzW2F0dHJpYnV0ZV07CiAgICAgICAgYnVmZmVyLmRhdGEgPSBuZXcgRlNTLkFycmF5KHZlcnRpY2VzKmJ1ZmZlci5zaXplKTsKCiAgICAgICAgLy8gUmVzZXQgdmVydGV4IGluZGV4CiAgICAgICAgaW5kZXggPSAwOwoKICAgICAgICAvLyBVcGRhdGUgYXR0cmlidXRlIGJ1ZmZlciBkYXRhCiAgICAgICAgZm9yIChtID0gc2NlbmUubWVzaGVzLmxlbmd0aCAtIDE7IG0gPj0gMDsgbS0tKSB7CiAgICAgICAgICBtZXNoID0gc2NlbmUubWVzaGVzW21dOwoKICAgICAgICAgIGZvciAodCA9IDAsIHRsID0gbWVzaC5nZW9tZXRyeS50cmlhbmdsZXMubGVuZ3RoOyB0IDwgdGw7IHQrKykgewogICAgICAgICAgICB0cmlhbmdsZSA9IG1lc2guZ2VvbWV0cnkudHJpYW5nbGVzW3RdOwoKICAgICAgICAgICAgZm9yICh2ID0gMCwgdmwgPSB0cmlhbmdsZS52ZXJ0aWNlcy5sZW5ndGg7IHYgPCB2bDsgdisrKSB7CiAgICAgICAgICAgICAgdmVydGV4ID0gdHJpYW5nbGUudmVydGljZXNbdl07CiAgICAgICAgICAgICAgc3dpdGNoIChhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3NpZGUnOgogICAgICAgICAgICAgICAgICB0aGlzLnNldEJ1ZmZlckRhdGEoaW5kZXgsIGJ1ZmZlciwgbWVzaC5zaWRlKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdwb3NpdGlvbic6CiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QnVmZmVyRGF0YShpbmRleCwgYnVmZmVyLCB2ZXJ0ZXgucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2NlbnRyb2lkJzoKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRCdWZmZXJEYXRhKGluZGV4LCBidWZmZXIsIHRyaWFuZ2xlLmNlbnRyb2lkKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdub3JtYWwnOgogICAgICAgICAgICAgICAgICB0aGlzLnNldEJ1ZmZlckRhdGEoaW5kZXgsIGJ1ZmZlciwgdHJpYW5nbGUubm9ybWFsKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdhbWJpZW50JzoKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRCdWZmZXJEYXRhKGluZGV4LCBidWZmZXIsIG1lc2gubWF0ZXJpYWwuYW1iaWVudC5yZ2JhKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdkaWZmdXNlJzoKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRCdWZmZXJEYXRhKGluZGV4LCBidWZmZXIsIG1lc2gubWF0ZXJpYWwuZGlmZnVzZS5yZ2JhKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFVwbG9hZCBhdHRyaWJ1dGUgYnVmZmVyIGRhdGEKICAgICAgICB0aGlzLmdsLmJpbmRCdWZmZXIodGhpcy5nbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlci5idWZmZXIpOwogICAgICAgIHRoaXMuZ2wuYnVmZmVyRGF0YSh0aGlzLmdsLkFSUkFZX0JVRkZFUiwgYnVmZmVyLmRhdGEsIHRoaXMuZ2wuRFlOQU1JQ19EUkFXKTsKICAgICAgICB0aGlzLmdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGJ1ZmZlci5sb2NhdGlvbik7CiAgICAgICAgdGhpcy5nbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGJ1ZmZlci5sb2NhdGlvbiwgYnVmZmVyLnNpemUsIHRoaXMuZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTsKICAgICAgfQogICAgfQoKICAgIC8vIEJ1aWxkIHVuaWZvcm0gYnVmZmVycwogICAgdGhpcy5zZXRCdWZmZXJEYXRhKDAsIHRoaXMucHJvZ3JhbS51bmlmb3Jtcy5yZXNvbHV0aW9uLCBbdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIHRoaXMud2lkdGhdKTsKICAgIGZvciAobCA9IGxpZ2h0cy0xOyBsID49IDA7IGwtLSkgewogICAgICBsaWdodCA9IHNjZW5lLmxpZ2h0c1tsXTsKICAgICAgdGhpcy5zZXRCdWZmZXJEYXRhKGwsIHRoaXMucHJvZ3JhbS51bmlmb3Jtcy5saWdodFBvc2l0aW9uLCBsaWdodC5wb3NpdGlvbik7CiAgICAgIHRoaXMuc2V0QnVmZmVyRGF0YShsLCB0aGlzLnByb2dyYW0udW5pZm9ybXMubGlnaHRBbWJpZW50LCBsaWdodC5hbWJpZW50LnJnYmEpOwogICAgICB0aGlzLnNldEJ1ZmZlckRhdGEobCwgdGhpcy5wcm9ncmFtLnVuaWZvcm1zLmxpZ2h0RGlmZnVzZSwgbGlnaHQuZGlmZnVzZS5yZ2JhKTsKICAgIH0KCiAgICAvLyBVcGRhdGUgdW5pZm9ybXMKICAgIGZvciAodW5pZm9ybSBpbiB0aGlzLnByb2dyYW0udW5pZm9ybXMpIHsKICAgICAgYnVmZmVyID0gdGhpcy5wcm9ncmFtLnVuaWZvcm1zW3VuaWZvcm1dOwogICAgICBsb2NhdGlvbiA9IGJ1ZmZlci5sb2NhdGlvbjsKICAgICAgZGF0YSA9IGJ1ZmZlci5kYXRhOwogICAgICBzd2l0Y2ggKGJ1ZmZlci5zdHJ1Y3R1cmUpIHsKICAgICAgICBjYXNlICczZic6CiAgICAgICAgICB0aGlzLmdsLnVuaWZvcm0zZihsb2NhdGlvbiwgZGF0YVswXSwgZGF0YVsxXSwgZGF0YVsyXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICczZnYnOgogICAgICAgICAgdGhpcy5nbC51bmlmb3JtM2Z2KGxvY2F0aW9uLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJzRmdic6CiAgICAgICAgICB0aGlzLmdsLnVuaWZvcm00ZnYobG9jYXRpb24sIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIERyYXcgdGhvc2UgbG92ZWx5IHRyaWFuZ2xlcwogIHRoaXMuZ2wuZHJhd0FycmF5cyh0aGlzLmdsLlRSSUFOR0xFUywgMCwgdGhpcy52ZXJ0aWNlcyk7CiAgcmV0dXJuIHRoaXM7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuc2V0QnVmZmVyRGF0YSA9IGZ1bmN0aW9uKGluZGV4LCBidWZmZXIsIHZhbHVlKSB7CiAgaWYgKEZTUy5VdGlscy5pc051bWJlcih2YWx1ZSkpIHsKICAgIGJ1ZmZlci5kYXRhW2luZGV4KmJ1ZmZlci5zaXplXSA9IHZhbHVlOwogIH0gZWxzZSB7CiAgICBmb3IgKHZhciBpID0gdmFsdWUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgYnVmZmVyLmRhdGFbaW5kZXgqYnVmZmVyLnNpemUraV0gPSB2YWx1ZVtpXTsKICAgIH0KICB9Cn07CgovKioKICogQ29uY2VwdHMgdGFrZW4gZnJvbSB0aHJlZS5qcyBXZWJHTFJlbmRlcmVyCiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi90aHJlZS5qcy9ibG9iL21hc3Rlci9zcmMvcmVuZGVyZXJzL1dlYkdMUmVuZGVyZXIuanMKICovCkZTUy5XZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5idWlsZFByb2dyYW0gPSBmdW5jdGlvbihsaWdodHMpIHsKICBpZiAodGhpcy51bnN1cHBvcnRlZCkgcmV0dXJuOwoKICAvLyBDcmVhdGUgc2hhZGVyIHNvdXJjZQogIHZhciB2cyA9IEZTUy5XZWJHTFJlbmRlcmVyLlZTKGxpZ2h0cyk7CiAgdmFyIGZzID0gRlNTLldlYkdMUmVuZGVyZXIuRlMobGlnaHRzKTsKCiAgLy8gRGVyaXZlIHRoZSBzaGFkZXIgZmluZ2VycHJpbnQKICB2YXIgY29kZSA9IHZzICsgZnM7CgogIC8vIENoZWNrIGlmIHRoZSBwcm9ncmFtIGhhcyBhbHJlYWR5IGJlZW4gY29tcGlsZWQKICBpZiAoISF0aGlzLnByb2dyYW0gJiYgdGhpcy5wcm9ncmFtLmNvZGUgPT09IGNvZGUpIHJldHVybjsKCiAgLy8gQ3JlYXRlIHRoZSBwcm9ncmFtIGFuZCBzaGFkZXJzCiAgdmFyIHByb2dyYW0gPSB0aGlzLmdsLmNyZWF0ZVByb2dyYW0oKTsKICB2YXIgdmVydGV4U2hhZGVyID0gdGhpcy5idWlsZFNoYWRlcih0aGlzLmdsLlZFUlRFWF9TSEFERVIsIHZzKTsKICB2YXIgZnJhZ21lbnRTaGFkZXIgPSB0aGlzLmJ1aWxkU2hhZGVyKHRoaXMuZ2wuRlJBR01FTlRfU0hBREVSLCBmcyk7CgogIC8vIEF0dGFjaCBhbiBsaW5rIHRoZSBzaGFkZXIKICB0aGlzLmdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2ZXJ0ZXhTaGFkZXIpOwogIHRoaXMuZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZyYWdtZW50U2hhZGVyKTsKICB0aGlzLmdsLmxpbmtQcm9ncmFtKHByb2dyYW0pOwoKICAvLyBBZGQgZXJyb3IgaGFuZGxpbmcKICBpZiAoIXRoaXMuZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCB0aGlzLmdsLkxJTktfU1RBVFVTKSkgewogICAgdmFyIGVycm9yID0gdGhpcy5nbC5nZXRFcnJvcigpOwogICAgdmFyIHN0YXR1cyA9IHRoaXMuZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCB0aGlzLmdsLlZBTElEQVRFX1NUQVRVUyk7CiAgICBjb25zb2xlLmVycm9yKCdDb3VsZCBub3QgaW5pdGlhbGlzZSBzaGFkZXIuXG5WQUxJREFURV9TVEFUVVM6ICcrc3RhdHVzKydcbkVSUk9SOiAnK2Vycm9yKTsKICAgIHJldHVybiBudWxsOwogIH0KCiAgLy8gRGVsZXRlIHRoZSBzaGFkZXIKICB0aGlzLmdsLmRlbGV0ZVNoYWRlcihmcmFnbWVudFNoYWRlcik7CiAgdGhpcy5nbC5kZWxldGVTaGFkZXIodmVydGV4U2hhZGVyKTsKCiAgLy8gU2V0IHRoZSBwcm9ncmFtIGNvZGUKICBwcm9ncmFtLmNvZGUgPSBjb2RlOwoKICAvLyBBZGQgdGhlIHByb2dyYW0gYXR0cmlidXRlcwogIHByb2dyYW0uYXR0cmlidXRlcyA9IHsKICAgIHNpZGU6ICAgICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICdhdHRyaWJ1dGUnLCAnYVNpZGUnLCAgICAgMSwgJ2YnICksCiAgICBwb3NpdGlvbjogdGhpcy5idWlsZEJ1ZmZlcihwcm9ncmFtLCAnYXR0cmlidXRlJywgJ2FQb3NpdGlvbicsIDMsICd2MycpLAogICAgY2VudHJvaWQ6IHRoaXMuYnVpbGRCdWZmZXIocHJvZ3JhbSwgJ2F0dHJpYnV0ZScsICdhQ2VudHJvaWQnLCAzLCAndjMnKSwKICAgIG5vcm1hbDogICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICdhdHRyaWJ1dGUnLCAnYU5vcm1hbCcsICAgMywgJ3YzJyksCiAgICBhbWJpZW50OiAgdGhpcy5idWlsZEJ1ZmZlcihwcm9ncmFtLCAnYXR0cmlidXRlJywgJ2FBbWJpZW50JywgIDQsICd2NCcpLAogICAgZGlmZnVzZTogIHRoaXMuYnVpbGRCdWZmZXIocHJvZ3JhbSwgJ2F0dHJpYnV0ZScsICdhRGlmZnVzZScsICA0LCAndjQnKQogIH07CgogIC8vIEFkZCB0aGUgcHJvZ3JhbSB1bmlmb3JtcwogIHByb2dyYW0udW5pZm9ybXMgPSB7CiAgICByZXNvbHV0aW9uOiAgICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICd1bmlmb3JtJywgJ3VSZXNvbHV0aW9uJywgICAgMywgJzNmJywgIDEgICAgICksCiAgICBsaWdodFBvc2l0aW9uOiB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICd1bmlmb3JtJywgJ3VMaWdodFBvc2l0aW9uJywgMywgJzNmdicsIGxpZ2h0cyksCiAgICBsaWdodEFtYmllbnQ6ICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICd1bmlmb3JtJywgJ3VMaWdodEFtYmllbnQnLCAgNCwgJzRmdicsIGxpZ2h0cyksCiAgICBsaWdodERpZmZ1c2U6ICB0aGlzLmJ1aWxkQnVmZmVyKHByb2dyYW0sICd1bmlmb3JtJywgJ3VMaWdodERpZmZ1c2UnLCAgNCwgJzRmdicsIGxpZ2h0cykKICB9OwoKICAvLyBTZXQgdGhlIHJlbmRlcmVyIHByb2dyYW0KICB0aGlzLnByb2dyYW0gPSBwcm9ncmFtOwoKICAvLyBFbmFibGUgcHJvZ3JhbQogIHRoaXMuZ2wudXNlUHJvZ3JhbSh0aGlzLnByb2dyYW0pOwoKICAvLyBSZXR1cm4gdGhlIHByb2dyYW0KICByZXR1cm4gcHJvZ3JhbTsKfTsKCkZTUy5XZWJHTFJlbmRlcmVyLnByb3RvdHlwZS5idWlsZFNoYWRlciA9IGZ1bmN0aW9uKHR5cGUsIHNvdXJjZSkgewogIGlmICh0aGlzLnVuc3VwcG9ydGVkKSByZXR1cm47CgogIC8vIENyZWF0ZSBhbmQgY29tcGlsZSBzaGFkZXIKICB2YXIgc2hhZGVyID0gdGhpcy5nbC5jcmVhdGVTaGFkZXIodHlwZSk7CiAgdGhpcy5nbC5zaGFkZXJTb3VyY2Uoc2hhZGVyLCBzb3VyY2UpOwogIHRoaXMuZ2wuY29tcGlsZVNoYWRlcihzaGFkZXIpOwoKICAvLyBBZGQgZXJyb3IgaGFuZGxpbmcKICBpZiAoIXRoaXMuZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKHNoYWRlciwgdGhpcy5nbC5DT01QSUxFX1NUQVRVUykpIHsKICAgIGNvbnNvbGUuZXJyb3IodGhpcy5nbC5nZXRTaGFkZXJJbmZvTG9nKHNoYWRlcikpOwogICAgcmV0dXJuIG51bGw7CiAgfQoKICAvLyBSZXR1cm4gdGhlIHNoYWRlcgogIHJldHVybiBzaGFkZXI7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5wcm90b3R5cGUuYnVpbGRCdWZmZXIgPSBmdW5jdGlvbihwcm9ncmFtLCB0eXBlLCBpZGVudGlmaWVyLCBzaXplLCBzdHJ1Y3R1cmUsIGNvdW50KSB7CiAgdmFyIGJ1ZmZlciA9IHtidWZmZXI6dGhpcy5nbC5jcmVhdGVCdWZmZXIoKSwgc2l6ZTpzaXplLCBzdHJ1Y3R1cmU6c3RydWN0dXJlLCBkYXRhOm51bGx9OwoKICAvLyBTZXQgdGhlIGxvY2F0aW9uCiAgc3dpdGNoICh0eXBlKSB7CiAgICBjYXNlICdhdHRyaWJ1dGUnOgogICAgICBidWZmZXIubG9jYXRpb24gPSB0aGlzLmdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIGlkZW50aWZpZXIpOwogICAgICBicmVhazsKICAgIGNhc2UgJ3VuaWZvcm0nOgogICAgICBidWZmZXIubG9jYXRpb24gPSB0aGlzLmdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBpZGVudGlmaWVyKTsKICAgICAgYnJlYWs7CiAgfQoKICAvLyBDcmVhdGUgdGhlIGJ1ZmZlciBpZiBjb3VudCBpcyBwcm92aWRlZAogIGlmICghIWNvdW50KSB7CiAgICBidWZmZXIuZGF0YSA9IG5ldyBGU1MuQXJyYXkoY291bnQqc2l6ZSk7CiAgfQoKICAvLyBSZXR1cm4gdGhlIGJ1ZmZlcgogIHJldHVybiBidWZmZXI7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5WUyA9IGZ1bmN0aW9uKGxpZ2h0cykgewogIHZhciBzaGFkZXIgPSBbCgogIC8vIFByZWNpc2lvbgogICdwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLAoKICAvLyBMaWdodHMKICAnI2RlZmluZSBMSUdIVFMgJyArIGxpZ2h0cywKCiAgLy8gQXR0cmlidXRlcwogICdhdHRyaWJ1dGUgZmxvYXQgYVNpZGU7JywKICAnYXR0cmlidXRlIHZlYzMgYVBvc2l0aW9uOycsCiAgJ2F0dHJpYnV0ZSB2ZWMzIGFDZW50cm9pZDsnLAogICdhdHRyaWJ1dGUgdmVjMyBhTm9ybWFsOycsCiAgJ2F0dHJpYnV0ZSB2ZWM0IGFBbWJpZW50OycsCiAgJ2F0dHJpYnV0ZSB2ZWM0IGFEaWZmdXNlOycsCgogIC8vIFVuaWZvcm1zCiAgJ3VuaWZvcm0gdmVjMyB1UmVzb2x1dGlvbjsnLAogICd1bmlmb3JtIHZlYzMgdUxpZ2h0UG9zaXRpb25bTElHSFRTXTsnLAogICd1bmlmb3JtIHZlYzQgdUxpZ2h0QW1iaWVudFtMSUdIVFNdOycsCiAgJ3VuaWZvcm0gdmVjNCB1TGlnaHREaWZmdXNlW0xJR0hUU107JywKCiAgLy8gVmFyeWluZ3MKICAndmFyeWluZyB2ZWM0IHZDb2xvcjsnLAoKICAvLyBNYWluCiAgJ3ZvaWQgbWFpbigpIHsnLAoKICAgIC8vIENyZWF0ZSBjb2xvcgogICAgJ3ZDb2xvciA9IHZlYzQoMC4wKTsnLAoKICAgIC8vIENhbGN1bGF0ZSB0aGUgdmVydGV4IHBvc2l0aW9uCiAgICAndmVjMyBwb3NpdGlvbiA9IGFQb3NpdGlvbiAvIHVSZXNvbHV0aW9uICogMi4wOycsCgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGxpZ2h0cwogICAgJ2ZvciAoaW50IGkgPSAwOyBpIDwgTElHSFRTOyBpKyspIHsnLAogICAgICAndmVjMyBsaWdodFBvc2l0aW9uID0gdUxpZ2h0UG9zaXRpb25baV07JywKICAgICAgJ3ZlYzQgbGlnaHRBbWJpZW50ID0gdUxpZ2h0QW1iaWVudFtpXTsnLAogICAgICAndmVjNCBsaWdodERpZmZ1c2UgPSB1TGlnaHREaWZmdXNlW2ldOycsCgogICAgICAvLyBDYWxjdWxhdGUgaWxsdW1pbmFuY2UKICAgICAgJ3ZlYzMgcmF5ID0gbm9ybWFsaXplKGxpZ2h0UG9zaXRpb24gLSBhQ2VudHJvaWQpOycsCiAgICAgICdmbG9hdCBpbGx1bWluYW5jZSA9IGRvdChhTm9ybWFsLCByYXkpOycsCiAgICAgICdpZiAoYVNpZGUgPT0gMC4wKSB7JywKICAgICAgICAnaWxsdW1pbmFuY2UgPSBtYXgoaWxsdW1pbmFuY2UsIDAuMCk7JywKICAgICAgJ30gZWxzZSBpZiAoYVNpZGUgPT0gMS4wKSB7JywKICAgICAgICAnaWxsdW1pbmFuY2UgPSBhYnMobWluKGlsbHVtaW5hbmNlLCAwLjApKTsnLAogICAgICAnfSBlbHNlIGlmIChhU2lkZSA9PSAyLjApIHsnLAogICAgICAgICdpbGx1bWluYW5jZSA9IG1heChhYnMoaWxsdW1pbmFuY2UpLCAwLjApOycsCiAgICAgICd9JywKCiAgICAgIC8vIENhbGN1bGF0ZSBhbWJpZW50IGxpZ2h0CiAgICAgICd2Q29sb3IgKz0gYUFtYmllbnQgKiBsaWdodEFtYmllbnQ7JywKCiAgICAgIC8vIENhbGN1bGF0ZSBkaWZmdXNlIGxpZ2h0CiAgICAgICd2Q29sb3IgKz0gYURpZmZ1c2UgKiBsaWdodERpZmZ1c2UgKiBpbGx1bWluYW5jZTsnLAogICAgJ30nLAoKICAgIC8vIENsYW1wIGNvbG9yCiAgICAndkNvbG9yID0gY2xhbXAodkNvbG9yLCAwLjAsIDEuMCk7JywKCiAgICAvLyBTZXQgZ2xfUG9zaXRpb24KICAgICdnbF9Qb3NpdGlvbiA9IHZlYzQocG9zaXRpb24sIDEuMCk7JywKCiAgJ30nCgogIC8vIFJldHVybiB0aGUgc2hhZGVyCiAgXS5qb2luKCdcbicpOwogIHJldHVybiBzaGFkZXI7Cn07CgpGU1MuV2ViR0xSZW5kZXJlci5GUyA9IGZ1bmN0aW9uKGxpZ2h0cykgewogIHZhciBzaGFkZXIgPSBbCgogIC8vIFByZWNpc2lvbgogICdwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLAoKICAvLyBWYXJ5aW5ncwogICd2YXJ5aW5nIHZlYzQgdkNvbG9yOycsCgogIC8vIE1haW4KICAndm9pZCBtYWluKCkgeycsCgogICAgLy8gU2V0IGdsX0ZyYWdDb2xvcgogICAgJ2dsX0ZyYWdDb2xvciA9IHZDb2xvcjsnLAoKICAnfScKCiAgLy8gUmV0dXJuIHRoZSBzaGFkZXIKICBdLmpvaW4oJ1xuJyk7CiAgcmV0dXJuIHNoYWRlcjsKfTsKCi8qKgogKiBAY2xhc3MgU1ZHIFJlbmRlcmVyCiAqIEBhdXRob3IgTWF0dGhldyBXYWdlcmZpZWxkCiAqLwpGU1MuU1ZHUmVuZGVyZXIgPSBmdW5jdGlvbigpIHsKICBGU1MuUmVuZGVyZXIuY2FsbCh0aGlzKTsKICB0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoRlNTLlNWR05TLCAnc3ZnJyk7CiAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgneG1sbnMnLCBGU1MuU1ZHTlMpOwogIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3ZlcnNpb24nLCAnMS4xJyk7CiAgdGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIHRoaXMuc2V0U2l6ZSgzMDAsIDE1MCk7Cn07CgpGU1MuU1ZHUmVuZGVyZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShGU1MuUmVuZGVyZXIucHJvdG90eXBlKTsKCkZTUy5TVkdSZW5kZXJlci5wcm90b3R5cGUuc2V0U2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICBGU1MuUmVuZGVyZXIucHJvdG90eXBlLnNldFNpemUuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KTsKICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCd3aWR0aCcsIHdpZHRoKTsKICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBoZWlnaHQpOwogIHJldHVybiB0aGlzOwp9OwoKRlNTLlNWR1JlbmRlcmVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkgewogIEZTUy5SZW5kZXJlci5wcm90b3R5cGUuY2xlYXIuY2FsbCh0aGlzKTsKICBmb3IgKHZhciBpID0gdGhpcy5lbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQuY2hpbGROb2Rlc1tpXSk7CiAgfQogIHJldHVybiB0aGlzOwp9OwoKRlNTLlNWR1JlbmRlcmVyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbihzY2VuZSkgewogIEZTUy5SZW5kZXJlci5wcm90b3R5cGUucmVuZGVyLmNhbGwodGhpcywgc2NlbmUpOwogIHZhciBtLG1lc2gsIHQsdHJpYW5nbGUsIHBvaW50cywgc3R5bGU7CgogIC8vIFVwZGF0ZSBNZXNoZXMKICBmb3IgKG0gPSBzY2VuZS5tZXNoZXMubGVuZ3RoIC0gMTsgbSA+PSAwOyBtLS0pIHsKICAgIG1lc2ggPSBzY2VuZS5tZXNoZXNbbV07CiAgICBpZiAobWVzaC52aXNpYmxlKSB7CiAgICAgIG1lc2gudXBkYXRlKHNjZW5lLmxpZ2h0cywgdHJ1ZSk7CgogICAgICAvLyBSZW5kZXIgVHJpYW5nbGVzCiAgICAgIGZvciAodCA9IG1lc2guZ2VvbWV0cnkudHJpYW5nbGVzLmxlbmd0aCAtIDE7IHQgPj0gMDsgdC0tKSB7CiAgICAgICAgdHJpYW5nbGUgPSBtZXNoLmdlb21ldHJ5LnRyaWFuZ2xlc1t0XTsKICAgICAgICBpZiAodHJpYW5nbGUucG9seWdvbi5wYXJlbnROb2RlICE9PSB0aGlzLmVsZW1lbnQpIHsKICAgICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0cmlhbmdsZS5wb2x5Z29uKTsKICAgICAgICB9CiAgICAgICAgcG9pbnRzICA9IHRoaXMuZm9ybWF0UG9pbnQodHJpYW5nbGUuYSkrJyAnOwogICAgICAgIHBvaW50cyArPSB0aGlzLmZvcm1hdFBvaW50KHRyaWFuZ2xlLmIpKycgJzsKICAgICAgICBwb2ludHMgKz0gdGhpcy5mb3JtYXRQb2ludCh0cmlhbmdsZS5jKTsKICAgICAgICBzdHlsZSA9IHRoaXMuZm9ybWF0U3R5bGUodHJpYW5nbGUuY29sb3IuZm9ybWF0KCkpOwogICAgICAgIHRyaWFuZ2xlLnBvbHlnb24uc2V0QXR0cmlidXRlTlMobnVsbCwgJ3BvaW50cycsIHBvaW50cyk7CiAgICAgICAgdHJpYW5nbGUucG9seWdvbi5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnc3R5bGUnLCBzdHlsZSk7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIHRoaXM7Cn07CgpGU1MuU1ZHUmVuZGVyZXIucHJvdG90eXBlLmZvcm1hdFBvaW50ID0gZnVuY3Rpb24odmVydGV4KSB7CiAgcmV0dXJuICh0aGlzLmhhbGZXaWR0aCt2ZXJ0ZXgucG9zaXRpb25bMF0pKycsJysodGhpcy5oYWxmSGVpZ2h0LXZlcnRleC5wb3NpdGlvblsxXSk7Cn07CgpGU1MuU1ZHUmVuZGVyZXIucHJvdG90eXBlLmZvcm1hdFN0eWxlID0gZnVuY3Rpb24oY29sb3IpIHsKICB2YXIgc3R5bGUgPSAnZmlsbDonK2NvbG9yKyc7JzsKICBzdHlsZSArPSAnc3Ryb2tlOicrY29sb3IrJzsnOwogIHJldHVybiBzdHlsZTsKfTsKCi8qKgogKiBkYXQtZ3VpIEphdmFTY3JpcHQgQ29udHJvbGxlciBMaWJyYXJ5CiAqIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9kYXQtZ3VpCiAqCiAqIENvcHlyaWdodCAyMDExIERhdGEgQXJ0cyBUZWFtLCBHb29nbGUgQ3JlYXRpdmUgTGFiCiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICovCnZhciBkYXQ9ZGF0fHx7fTtkYXQuZ3VpPWRhdC5ndWl8fHt9O2RhdC51dGlscz1kYXQudXRpbHN8fHt9O2RhdC5jb250cm9sbGVycz1kYXQuY29udHJvbGxlcnN8fHt9O2RhdC5kb209ZGF0LmRvbXx8e307ZGF0LmNvbG9yPWRhdC5jb2xvcnx8e307ZGF0LnV0aWxzLmNzcz1mdW5jdGlvbigpe3JldHVybntsb2FkOmZ1bmN0aW9uKGUsYSl7dmFyIGE9YXx8ZG9jdW1lbnQsYz1hLmNyZWF0ZUVsZW1lbnQoImxpbmsiKTtjLnR5cGU9InRleHQvY3NzIjtjLnJlbD0ic3R5bGVzaGVldCI7Yy5ocmVmPWU7YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdLmFwcGVuZENoaWxkKGMpfSxpbmplY3Q6ZnVuY3Rpb24oZSxhKXt2YXIgYT1hfHxkb2N1bWVudCxjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7Yy50eXBlPSJ0ZXh0L2NzcyI7Yy5pbm5lckhUTUw9ZTthLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0uYXBwZW5kQ2hpbGQoYyl9fX0oKTsKZGF0LnV0aWxzLmNvbW1vbj1mdW5jdGlvbigpe3ZhciBlPUFycmF5LnByb3RvdHlwZS5mb3JFYWNoLGE9QXJyYXkucHJvdG90eXBlLnNsaWNlO3JldHVybntCUkVBSzp7fSxleHRlbmQ6ZnVuY3Rpb24oYyl7dGhpcy5lYWNoKGEuY2FsbChhcmd1bWVudHMsMSksZnVuY3Rpb24oYSl7Zm9yKHZhciBmIGluIGEpdGhpcy5pc1VuZGVmaW5lZChhW2ZdKXx8KGNbZl09YVtmXSl9LHRoaXMpO3JldHVybiBjfSxkZWZhdWx0czpmdW5jdGlvbihjKXt0aGlzLmVhY2goYS5jYWxsKGFyZ3VtZW50cywxKSxmdW5jdGlvbihhKXtmb3IodmFyIGYgaW4gYSl0aGlzLmlzVW5kZWZpbmVkKGNbZl0pJiYoY1tmXT1hW2ZdKX0sdGhpcyk7cmV0dXJuIGN9LGNvbXBvc2U6ZnVuY3Rpb24oKXt2YXIgYz1hLmNhbGwoYXJndW1lbnRzKTtyZXR1cm4gZnVuY3Rpb24oKXtmb3IodmFyIGQ9YS5jYWxsKGFyZ3VtZW50cyksZj1jLmxlbmd0aC0xO2Y+PTA7Zi0tKWQ9W2NbZl0uYXBwbHkodGhpcyxkKV07cmV0dXJuIGRbMF19fSwKZWFjaDpmdW5jdGlvbihhLGQsZil7aWYoZSYmYS5mb3JFYWNoPT09ZSlhLmZvckVhY2goZCxmKTtlbHNlIGlmKGEubGVuZ3RoPT09YS5sZW5ndGgrMClmb3IodmFyIGI9MCxuPWEubGVuZ3RoO2I8bjtiKyspe2lmKGIgaW4gYSYmZC5jYWxsKGYsYVtiXSxiKT09PXRoaXMuQlJFQUspYnJlYWt9ZWxzZSBmb3IoYiBpbiBhKWlmKGQuY2FsbChmLGFbYl0sYik9PT10aGlzLkJSRUFLKWJyZWFrfSxkZWZlcjpmdW5jdGlvbihhKXtzZXRUaW1lb3V0KGEsMCl9LHRvQXJyYXk6ZnVuY3Rpb24oYyl7cmV0dXJuIGMudG9BcnJheT9jLnRvQXJyYXkoKTphLmNhbGwoYyl9LGlzVW5kZWZpbmVkOmZ1bmN0aW9uKGEpe3JldHVybiBhPT09dm9pZCAwfSxpc051bGw6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1udWxsfSxpc05hTjpmdW5jdGlvbihhKXtyZXR1cm4gYSE9PWF9LGlzQXJyYXk6QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oYSl7cmV0dXJuIGEuY29uc3RydWN0b3I9PT1BcnJheX0saXNPYmplY3Q6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT0KT2JqZWN0KGEpfSxpc051bWJlcjpmdW5jdGlvbihhKXtyZXR1cm4gYT09PWErMH0saXNTdHJpbmc6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1hKyIifSxpc0Jvb2xlYW46ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1mYWxzZXx8YT09PXRydWV9LGlzRnVuY3Rpb246ZnVuY3Rpb24oYSl7cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhKT09PSJbb2JqZWN0IEZ1bmN0aW9uXSJ9fX0oKTsKZGF0LmNvbnRyb2xsZXJzLkNvbnRyb2xsZXI9ZnVuY3Rpb24oZSl7dmFyIGE9ZnVuY3Rpb24oYSxkKXt0aGlzLmluaXRpYWxWYWx1ZT1hW2RdO3RoaXMuZG9tRWxlbWVudD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLm9iamVjdD1hO3RoaXMucHJvcGVydHk9ZDt0aGlzLl9fb25GaW5pc2hDaGFuZ2U9dGhpcy5fX29uQ2hhbmdlPXZvaWQgMH07ZS5leHRlbmQoYS5wcm90b3R5cGUse29uQ2hhbmdlOmZ1bmN0aW9uKGEpe3RoaXMuX19vbkNoYW5nZT1hO3JldHVybiB0aGlzfSxvbkZpbmlzaENoYW5nZTpmdW5jdGlvbihhKXt0aGlzLl9fb25GaW5pc2hDaGFuZ2U9YTtyZXR1cm4gdGhpc30sc2V0VmFsdWU6ZnVuY3Rpb24oYSl7dGhpcy5vYmplY3RbdGhpcy5wcm9wZXJ0eV09YTt0aGlzLl9fb25DaGFuZ2UmJnRoaXMuX19vbkNoYW5nZS5jYWxsKHRoaXMsYSk7dGhpcy51cGRhdGVEaXNwbGF5KCk7cmV0dXJuIHRoaXN9LGdldFZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub2JqZWN0W3RoaXMucHJvcGVydHldfSwKdXBkYXRlRGlzcGxheTpmdW5jdGlvbigpe3JldHVybiB0aGlzfSxpc01vZGlmaWVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW5pdGlhbFZhbHVlIT09dGhpcy5nZXRWYWx1ZSgpfX0pO3JldHVybiBhfShkYXQudXRpbHMuY29tbW9uKTsKZGF0LmRvbS5kb209ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gYShiKXtpZihiPT09IjAifHxlLmlzVW5kZWZpbmVkKGIpKXJldHVybiAwO2I9Yi5tYXRjaChkKTtyZXR1cm4hZS5pc051bGwoYik/cGFyc2VGbG9hdChiWzFdKTowfXZhciBjPXt9O2UuZWFjaCh7SFRNTEV2ZW50czpbImNoYW5nZSJdLE1vdXNlRXZlbnRzOlsiY2xpY2siLCJtb3VzZW1vdmUiLCJtb3VzZWRvd24iLCJtb3VzZXVwIiwibW91c2VvdmVyIl0sS2V5Ym9hcmRFdmVudHM6WyJrZXlkb3duIl19LGZ1bmN0aW9uKGIsYSl7ZS5lYWNoKGIsZnVuY3Rpb24oYil7Y1tiXT1hfSl9KTt2YXIgZD0vKFxkKyhcLlxkKyk/KXB4LyxmPXttYWtlU2VsZWN0YWJsZTpmdW5jdGlvbihiLGEpe2lmKCEoYj09PXZvaWQgMHx8Yi5zdHlsZT09PXZvaWQgMCkpYi5vbnNlbGVjdHN0YXJ0PWE/ZnVuY3Rpb24oKXtyZXR1cm4gZmFsc2V9OmZ1bmN0aW9uKCl7fSxiLnN0eWxlLk1velVzZXJTZWxlY3Q9YT8iYXV0byI6Im5vbmUiLGIuc3R5bGUuS2h0bWxVc2VyU2VsZWN0PQphPyJhdXRvIjoibm9uZSIsYi51bnNlbGVjdGFibGU9YT8ib24iOiJvZmYifSxtYWtlRnVsbHNjcmVlbjpmdW5jdGlvbihiLGEsZCl7ZS5pc1VuZGVmaW5lZChhKSYmKGE9dHJ1ZSk7ZS5pc1VuZGVmaW5lZChkKSYmKGQ9dHJ1ZSk7Yi5zdHlsZS5wb3NpdGlvbj0iYWJzb2x1dGUiO2lmKGEpYi5zdHlsZS5sZWZ0PTAsYi5zdHlsZS5yaWdodD0wO2lmKGQpYi5zdHlsZS50b3A9MCxiLnN0eWxlLmJvdHRvbT0wfSxmYWtlRXZlbnQ6ZnVuY3Rpb24oYixhLGQsZil7dmFyIGQ9ZHx8e30sbT1jW2FdO2lmKCFtKXRocm93IEVycm9yKCJFdmVudCB0eXBlICIrYSsiIG5vdCBzdXBwb3J0ZWQuIik7dmFyIGw9ZG9jdW1lbnQuY3JlYXRlRXZlbnQobSk7c3dpdGNoKG0pe2Nhc2UgIk1vdXNlRXZlbnRzIjpsLmluaXRNb3VzZUV2ZW50KGEsZC5idWJibGVzfHxmYWxzZSxkLmNhbmNlbGFibGV8fHRydWUsd2luZG93LGQuY2xpY2tDb3VudHx8MSwwLDAsZC54fHxkLmNsaWVudFh8fDAsZC55fHxkLmNsaWVudFl8fAowLGZhbHNlLGZhbHNlLGZhbHNlLGZhbHNlLDAsbnVsbCk7YnJlYWs7Y2FzZSAiS2V5Ym9hcmRFdmVudHMiOm09bC5pbml0S2V5Ym9hcmRFdmVudHx8bC5pbml0S2V5RXZlbnQ7ZS5kZWZhdWx0cyhkLHtjYW5jZWxhYmxlOnRydWUsY3RybEtleTpmYWxzZSxhbHRLZXk6ZmFsc2Usc2hpZnRLZXk6ZmFsc2UsbWV0YUtleTpmYWxzZSxrZXlDb2RlOnZvaWQgMCxjaGFyQ29kZTp2b2lkIDB9KTttKGEsZC5idWJibGVzfHxmYWxzZSxkLmNhbmNlbGFibGUsd2luZG93LGQuY3RybEtleSxkLmFsdEtleSxkLnNoaWZ0S2V5LGQubWV0YUtleSxkLmtleUNvZGUsZC5jaGFyQ29kZSk7YnJlYWs7ZGVmYXVsdDpsLmluaXRFdmVudChhLGQuYnViYmxlc3x8ZmFsc2UsZC5jYW5jZWxhYmxlfHx0cnVlKX1lLmRlZmF1bHRzKGwsZik7Yi5kaXNwYXRjaEV2ZW50KGwpfSxiaW5kOmZ1bmN0aW9uKGIsYSxkLGMpe2IuYWRkRXZlbnRMaXN0ZW5lcj9iLmFkZEV2ZW50TGlzdGVuZXIoYSxkLGN8fGZhbHNlKTpiLmF0dGFjaEV2ZW50JiYKYi5hdHRhY2hFdmVudCgib24iK2EsZCk7cmV0dXJuIGZ9LHVuYmluZDpmdW5jdGlvbihiLGEsZCxjKXtiLnJlbW92ZUV2ZW50TGlzdGVuZXI/Yi5yZW1vdmVFdmVudExpc3RlbmVyKGEsZCxjfHxmYWxzZSk6Yi5kZXRhY2hFdmVudCYmYi5kZXRhY2hFdmVudCgib24iK2EsZCk7cmV0dXJuIGZ9LGFkZENsYXNzOmZ1bmN0aW9uKGIsYSl7aWYoYi5jbGFzc05hbWU9PT12b2lkIDApYi5jbGFzc05hbWU9YTtlbHNlIGlmKGIuY2xhc3NOYW1lIT09YSl7dmFyIGQ9Yi5jbGFzc05hbWUuc3BsaXQoLyArLyk7aWYoZC5pbmRleE9mKGEpPT0tMSlkLnB1c2goYSksYi5jbGFzc05hbWU9ZC5qb2luKCIgIikucmVwbGFjZSgvXlxzKy8sIiIpLnJlcGxhY2UoL1xzKyQvLCIiKX1yZXR1cm4gZn0scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24oYixhKXtpZihhKXtpZihiLmNsYXNzTmFtZSE9PXZvaWQgMClpZihiLmNsYXNzTmFtZT09PWEpYi5yZW1vdmVBdHRyaWJ1dGUoImNsYXNzIik7ZWxzZXt2YXIgZD1iLmNsYXNzTmFtZS5zcGxpdCgvICsvKSwKYz1kLmluZGV4T2YoYSk7aWYoYyE9LTEpZC5zcGxpY2UoYywxKSxiLmNsYXNzTmFtZT1kLmpvaW4oIiAiKX19ZWxzZSBiLmNsYXNzTmFtZT12b2lkIDA7cmV0dXJuIGZ9LGhhc0NsYXNzOmZ1bmN0aW9uKGEsZCl7cmV0dXJuIFJlZ0V4cCgiKD86XnxcXHMrKSIrZCsiKD86XFxzK3wkKSIpLnRlc3QoYS5jbGFzc05hbWUpfHxmYWxzZX0sZ2V0V2lkdGg6ZnVuY3Rpb24oYil7Yj1nZXRDb21wdXRlZFN0eWxlKGIpO3JldHVybiBhKGJbImJvcmRlci1sZWZ0LXdpZHRoIl0pK2EoYlsiYm9yZGVyLXJpZ2h0LXdpZHRoIl0pK2EoYlsicGFkZGluZy1sZWZ0Il0pK2EoYlsicGFkZGluZy1yaWdodCJdKSthKGIud2lkdGgpfSxnZXRIZWlnaHQ6ZnVuY3Rpb24oYil7Yj1nZXRDb21wdXRlZFN0eWxlKGIpO3JldHVybiBhKGJbImJvcmRlci10b3Atd2lkdGgiXSkrYShiWyJib3JkZXItYm90dG9tLXdpZHRoIl0pK2EoYlsicGFkZGluZy10b3AiXSkrYShiWyJwYWRkaW5nLWJvdHRvbSJdKSthKGIuaGVpZ2h0KX0sCmdldE9mZnNldDpmdW5jdGlvbihhKXt2YXIgZD17bGVmdDowLHRvcDowfTtpZihhLm9mZnNldFBhcmVudCl7ZG8gZC5sZWZ0Kz1hLm9mZnNldExlZnQsZC50b3ArPWEub2Zmc2V0VG9wO3doaWxlKGE9YS5vZmZzZXRQYXJlbnQpfXJldHVybiBkfSxpc0FjdGl2ZTpmdW5jdGlvbihhKXtyZXR1cm4gYT09PWRvY3VtZW50LmFjdGl2ZUVsZW1lbnQmJihhLnR5cGV8fGEuaHJlZil9fTtyZXR1cm4gZn0oZGF0LnV0aWxzLmNvbW1vbik7CmRhdC5jb250cm9sbGVycy5PcHRpb25Db250cm9sbGVyPWZ1bmN0aW9uKGUsYSxjKXt2YXIgZD1mdW5jdGlvbihmLGIsZSl7ZC5zdXBlcmNsYXNzLmNhbGwodGhpcyxmLGIpO3ZhciBoPXRoaXM7dGhpcy5fX3NlbGVjdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTtpZihjLmlzQXJyYXkoZSkpe3ZhciBqPXt9O2MuZWFjaChlLGZ1bmN0aW9uKGEpe2pbYV09YX0pO2U9an1jLmVhY2goZSxmdW5jdGlvbihhLGIpe3ZhciBkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpO2QuaW5uZXJIVE1MPWI7ZC5zZXRBdHRyaWJ1dGUoInZhbHVlIixhKTtoLl9fc2VsZWN0LmFwcGVuZENoaWxkKGQpfSk7dGhpcy51cGRhdGVEaXNwbGF5KCk7YS5iaW5kKHRoaXMuX19zZWxlY3QsImNoYW5nZSIsZnVuY3Rpb24oKXtoLnNldFZhbHVlKHRoaXMub3B0aW9uc1t0aGlzLnNlbGVjdGVkSW5kZXhdLnZhbHVlKX0pO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fc2VsZWN0KX07CmQuc3VwZXJjbGFzcz1lO2MuZXh0ZW5kKGQucHJvdG90eXBlLGUucHJvdG90eXBlLHtzZXRWYWx1ZTpmdW5jdGlvbihhKXthPWQuc3VwZXJjbGFzcy5wcm90b3R5cGUuc2V0VmFsdWUuY2FsbCh0aGlzLGEpO3RoaXMuX19vbkZpbmlzaENoYW5nZSYmdGhpcy5fX29uRmluaXNoQ2hhbmdlLmNhbGwodGhpcyx0aGlzLmdldFZhbHVlKCkpO3JldHVybiBhfSx1cGRhdGVEaXNwbGF5OmZ1bmN0aW9uKCl7dGhpcy5fX3NlbGVjdC52YWx1ZT10aGlzLmdldFZhbHVlKCk7cmV0dXJuIGQuc3VwZXJjbGFzcy5wcm90b3R5cGUudXBkYXRlRGlzcGxheS5jYWxsKHRoaXMpfX0pO3JldHVybiBkfShkYXQuY29udHJvbGxlcnMuQ29udHJvbGxlcixkYXQuZG9tLmRvbSxkYXQudXRpbHMuY29tbW9uKTsKZGF0LmNvbnRyb2xsZXJzLk51bWJlckNvbnRyb2xsZXI9ZnVuY3Rpb24oZSxhKXt2YXIgYz1mdW5jdGlvbihkLGYsYil7Yy5zdXBlcmNsYXNzLmNhbGwodGhpcyxkLGYpO2I9Ynx8e307dGhpcy5fX21pbj1iLm1pbjt0aGlzLl9fbWF4PWIubWF4O3RoaXMuX19zdGVwPWIuc3RlcDtkPXRoaXMuX19pbXBsaWVkU3RlcD1hLmlzVW5kZWZpbmVkKHRoaXMuX19zdGVwKT90aGlzLmluaXRpYWxWYWx1ZT09MD8xOk1hdGgucG93KDEwLE1hdGguZmxvb3IoTWF0aC5sb2codGhpcy5pbml0aWFsVmFsdWUpL01hdGguTE4xMCkpLzEwOnRoaXMuX19zdGVwO2Q9ZC50b1N0cmluZygpO3RoaXMuX19wcmVjaXNpb249ZC5pbmRleE9mKCIuIik+LTE/ZC5sZW5ndGgtZC5pbmRleE9mKCIuIiktMTowfTtjLnN1cGVyY2xhc3M9ZTthLmV4dGVuZChjLnByb3RvdHlwZSxlLnByb3RvdHlwZSx7c2V0VmFsdWU6ZnVuY3Rpb24oYSl7aWYodGhpcy5fX21pbiE9PXZvaWQgMCYmYTx0aGlzLl9fbWluKWE9dGhpcy5fX21pbjsKZWxzZSBpZih0aGlzLl9fbWF4IT09dm9pZCAwJiZhPnRoaXMuX19tYXgpYT10aGlzLl9fbWF4O3RoaXMuX19zdGVwIT09dm9pZCAwJiZhJXRoaXMuX19zdGVwIT0wJiYoYT1NYXRoLnJvdW5kKGEvdGhpcy5fX3N0ZXApKnRoaXMuX19zdGVwKTtyZXR1cm4gYy5zdXBlcmNsYXNzLnByb3RvdHlwZS5zZXRWYWx1ZS5jYWxsKHRoaXMsYSl9LG1pbjpmdW5jdGlvbihhKXt0aGlzLl9fbWluPWE7cmV0dXJuIHRoaXN9LG1heDpmdW5jdGlvbihhKXt0aGlzLl9fbWF4PWE7cmV0dXJuIHRoaXN9LHN0ZXA6ZnVuY3Rpb24oYSl7dGhpcy5fX3N0ZXA9YTtyZXR1cm4gdGhpc319KTtyZXR1cm4gY30oZGF0LmNvbnRyb2xsZXJzLkNvbnRyb2xsZXIsZGF0LnV0aWxzLmNvbW1vbik7CmRhdC5jb250cm9sbGVycy5OdW1iZXJDb250cm9sbGVyQm94PWZ1bmN0aW9uKGUsYSxjKXt2YXIgZD1mdW5jdGlvbihmLGIsZSl7ZnVuY3Rpb24gaCgpe3ZhciBhPXBhcnNlRmxvYXQobC5fX2lucHV0LnZhbHVlKTtjLmlzTmFOKGEpfHxsLnNldFZhbHVlKGEpfWZ1bmN0aW9uIGooYSl7dmFyIGI9by1hLmNsaWVudFk7bC5zZXRWYWx1ZShsLmdldFZhbHVlKCkrYipsLl9faW1wbGllZFN0ZXApO289YS5jbGllbnRZfWZ1bmN0aW9uIG0oKXthLnVuYmluZCh3aW5kb3csIm1vdXNlbW92ZSIsaik7YS51bmJpbmQod2luZG93LCJtb3VzZXVwIixtKX10aGlzLl9fdHJ1bmNhdGlvblN1c3BlbmRlZD1mYWxzZTtkLnN1cGVyY2xhc3MuY2FsbCh0aGlzLGYsYixlKTt2YXIgbD10aGlzLG87dGhpcy5fX2lucHV0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7dGhpcy5fX2lucHV0LnNldEF0dHJpYnV0ZSgidHlwZSIsInRleHQiKTthLmJpbmQodGhpcy5fX2lucHV0LCJjaGFuZ2UiLGgpOwphLmJpbmQodGhpcy5fX2lucHV0LCJibHVyIixmdW5jdGlvbigpe2goKTtsLl9fb25GaW5pc2hDaGFuZ2UmJmwuX19vbkZpbmlzaENoYW5nZS5jYWxsKGwsbC5nZXRWYWx1ZSgpKX0pO2EuYmluZCh0aGlzLl9faW5wdXQsIm1vdXNlZG93biIsZnVuY3Rpb24oYil7YS5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixqKTthLmJpbmQod2luZG93LCJtb3VzZXVwIixtKTtvPWIuY2xpZW50WX0pO2EuYmluZCh0aGlzLl9faW5wdXQsImtleWRvd24iLGZ1bmN0aW9uKGEpe2lmKGEua2V5Q29kZT09PTEzKWwuX190cnVuY2F0aW9uU3VzcGVuZGVkPXRydWUsdGhpcy5ibHVyKCksbC5fX3RydW5jYXRpb25TdXNwZW5kZWQ9ZmFsc2V9KTt0aGlzLnVwZGF0ZURpc3BsYXkoKTt0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fX2lucHV0KX07ZC5zdXBlcmNsYXNzPWU7Yy5leHRlbmQoZC5wcm90b3R5cGUsZS5wcm90b3R5cGUse3VwZGF0ZURpc3BsYXk6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLl9faW5wdXQsCmI7aWYodGhpcy5fX3RydW5jYXRpb25TdXNwZW5kZWQpYj10aGlzLmdldFZhbHVlKCk7ZWxzZXtiPXRoaXMuZ2V0VmFsdWUoKTt2YXIgYz1NYXRoLnBvdygxMCx0aGlzLl9fcHJlY2lzaW9uKTtiPU1hdGgucm91bmQoYipjKS9jfWEudmFsdWU9YjtyZXR1cm4gZC5zdXBlcmNsYXNzLnByb3RvdHlwZS51cGRhdGVEaXNwbGF5LmNhbGwodGhpcyl9fSk7cmV0dXJuIGR9KGRhdC5jb250cm9sbGVycy5OdW1iZXJDb250cm9sbGVyLGRhdC5kb20uZG9tLGRhdC51dGlscy5jb21tb24pOwpkYXQuY29udHJvbGxlcnMuTnVtYmVyQ29udHJvbGxlclNsaWRlcj1mdW5jdGlvbihlLGEsYyxkLGYpe3ZhciBiPWZ1bmN0aW9uKGQsYyxmLGUsbCl7ZnVuY3Rpb24gbyhiKXtiLnByZXZlbnREZWZhdWx0KCk7dmFyIGQ9YS5nZXRPZmZzZXQoZy5fX2JhY2tncm91bmQpLGM9YS5nZXRXaWR0aChnLl9fYmFja2dyb3VuZCk7Zy5zZXRWYWx1ZShnLl9fbWluKyhnLl9fbWF4LWcuX19taW4pKigoYi5jbGllbnRYLWQubGVmdCkvKGQubGVmdCtjLWQubGVmdCkpKTtyZXR1cm4gZmFsc2V9ZnVuY3Rpb24geSgpe2EudW5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixvKTthLnVuYmluZCh3aW5kb3csIm1vdXNldXAiLHkpO2cuX19vbkZpbmlzaENoYW5nZSYmZy5fX29uRmluaXNoQ2hhbmdlLmNhbGwoZyxnLmdldFZhbHVlKCkpfWIuc3VwZXJjbGFzcy5jYWxsKHRoaXMsZCxjLHttaW46ZixtYXg6ZSxzdGVwOmx9KTt2YXIgZz10aGlzO3RoaXMuX19iYWNrZ3JvdW5kPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwp0aGlzLl9fZm9yZWdyb3VuZD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmJpbmQodGhpcy5fX2JhY2tncm91bmQsIm1vdXNlZG93biIsZnVuY3Rpb24oYil7YS5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixvKTthLmJpbmQod2luZG93LCJtb3VzZXVwIix5KTtvKGIpfSk7YS5hZGRDbGFzcyh0aGlzLl9fYmFja2dyb3VuZCwic2xpZGVyIik7YS5hZGRDbGFzcyh0aGlzLl9fZm9yZWdyb3VuZCwic2xpZGVyLWZnIik7dGhpcy51cGRhdGVEaXNwbGF5KCk7dGhpcy5fX2JhY2tncm91bmQuYXBwZW5kQ2hpbGQodGhpcy5fX2ZvcmVncm91bmQpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fYmFja2dyb3VuZCl9O2Iuc3VwZXJjbGFzcz1lO2IudXNlRGVmYXVsdFN0eWxlcz1mdW5jdGlvbigpe2MuaW5qZWN0KGYpfTtkLmV4dGVuZChiLnByb3RvdHlwZSxlLnByb3RvdHlwZSx7dXBkYXRlRGlzcGxheTpmdW5jdGlvbigpe3RoaXMuX19mb3JlZ3JvdW5kLnN0eWxlLndpZHRoPQoodGhpcy5nZXRWYWx1ZSgpLXRoaXMuX19taW4pLyh0aGlzLl9fbWF4LXRoaXMuX19taW4pKjEwMCsiJSI7cmV0dXJuIGIuc3VwZXJjbGFzcy5wcm90b3R5cGUudXBkYXRlRGlzcGxheS5jYWxsKHRoaXMpfX0pO3JldHVybiBifShkYXQuY29udHJvbGxlcnMuTnVtYmVyQ29udHJvbGxlcixkYXQuZG9tLmRvbSxkYXQudXRpbHMuY3NzLGRhdC51dGlscy5jb21tb24sIi5zbGlkZXIge1xuICBib3gtc2hhZG93OiBpbnNldCAwIDJweCA0cHggcmdiYSgwLDAsMCwwLjE1KTtcbiAgaGVpZ2h0OiAxZW07XG4gIGJvcmRlci1yYWRpdXM6IDFlbTtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2VlZTtcbiAgcGFkZGluZzogMCAwLjVlbTtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbn1cblxuLnNsaWRlci1mZyB7XG4gIHBhZGRpbmc6IDFweCAwIDJweCAwO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjYWFhO1xuICBoZWlnaHQ6IDFlbTtcbiAgbWFyZ2luLWxlZnQ6IC0wLjVlbTtcbiAgcGFkZGluZy1yaWdodDogMC41ZW07XG4gIGJvcmRlci1yYWRpdXM6IDFlbSAwIDAgMWVtO1xufVxuXG4uc2xpZGVyLWZnOmFmdGVyIHtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBib3JkZXItcmFkaXVzOiAxZW07XG4gIGJhY2tncm91bmQtY29sb3I6ICNmZmY7XG4gIGJvcmRlcjogIDFweCBzb2xpZCAjYWFhO1xuICBjb250ZW50OiAnJztcbiAgZmxvYXQ6IHJpZ2h0O1xuICBtYXJnaW4tcmlnaHQ6IC0xZW07XG4gIG1hcmdpbi10b3A6IC0xcHg7XG4gIGhlaWdodDogMC45ZW07XG4gIHdpZHRoOiAwLjllbTtcbn0iKTsKZGF0LmNvbnRyb2xsZXJzLkZ1bmN0aW9uQ29udHJvbGxlcj1mdW5jdGlvbihlLGEsYyl7dmFyIGQ9ZnVuY3Rpb24oYyxiLGUpe2Quc3VwZXJjbGFzcy5jYWxsKHRoaXMsYyxiKTt2YXIgaD10aGlzO3RoaXMuX19idXR0b249ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dGhpcy5fX2J1dHRvbi5pbm5lckhUTUw9ZT09PXZvaWQgMD8iRmlyZSI6ZTthLmJpbmQodGhpcy5fX2J1dHRvbiwiY2xpY2siLGZ1bmN0aW9uKGEpe2EucHJldmVudERlZmF1bHQoKTtoLmZpcmUoKTtyZXR1cm4gZmFsc2V9KTthLmFkZENsYXNzKHRoaXMuX19idXR0b24sImJ1dHRvbiIpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fYnV0dG9uKX07ZC5zdXBlcmNsYXNzPWU7Yy5leHRlbmQoZC5wcm90b3R5cGUsZS5wcm90b3R5cGUse2ZpcmU6ZnVuY3Rpb24oKXt0aGlzLl9fb25DaGFuZ2UmJnRoaXMuX19vbkNoYW5nZS5jYWxsKHRoaXMpO3RoaXMuX19vbkZpbmlzaENoYW5nZSYmdGhpcy5fX29uRmluaXNoQ2hhbmdlLmNhbGwodGhpcywKdGhpcy5nZXRWYWx1ZSgpKTt0aGlzLmdldFZhbHVlKCkuY2FsbCh0aGlzLm9iamVjdCl9fSk7cmV0dXJuIGR9KGRhdC5jb250cm9sbGVycy5Db250cm9sbGVyLGRhdC5kb20uZG9tLGRhdC51dGlscy5jb21tb24pOwpkYXQuY29udHJvbGxlcnMuQm9vbGVhbkNvbnRyb2xsZXI9ZnVuY3Rpb24oZSxhLGMpe3ZhciBkPWZ1bmN0aW9uKGMsYil7ZC5zdXBlcmNsYXNzLmNhbGwodGhpcyxjLGIpO3ZhciBlPXRoaXM7dGhpcy5fX3ByZXY9dGhpcy5nZXRWYWx1ZSgpO3RoaXMuX19jaGVja2JveD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpO3RoaXMuX19jaGVja2JveC5zZXRBdHRyaWJ1dGUoInR5cGUiLCJjaGVja2JveCIpO2EuYmluZCh0aGlzLl9fY2hlY2tib3gsImNoYW5nZSIsZnVuY3Rpb24oKXtlLnNldFZhbHVlKCFlLl9fcHJldil9LGZhbHNlKTt0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fX2NoZWNrYm94KTt0aGlzLnVwZGF0ZURpc3BsYXkoKX07ZC5zdXBlcmNsYXNzPWU7Yy5leHRlbmQoZC5wcm90b3R5cGUsZS5wcm90b3R5cGUse3NldFZhbHVlOmZ1bmN0aW9uKGEpe2E9ZC5zdXBlcmNsYXNzLnByb3RvdHlwZS5zZXRWYWx1ZS5jYWxsKHRoaXMsYSk7dGhpcy5fX29uRmluaXNoQ2hhbmdlJiYKdGhpcy5fX29uRmluaXNoQ2hhbmdlLmNhbGwodGhpcyx0aGlzLmdldFZhbHVlKCkpO3RoaXMuX19wcmV2PXRoaXMuZ2V0VmFsdWUoKTtyZXR1cm4gYX0sdXBkYXRlRGlzcGxheTpmdW5jdGlvbigpe3RoaXMuZ2V0VmFsdWUoKT09PXRydWU/KHRoaXMuX19jaGVja2JveC5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCJjaGVja2VkIiksdGhpcy5fX2NoZWNrYm94LmNoZWNrZWQ9dHJ1ZSk6dGhpcy5fX2NoZWNrYm94LmNoZWNrZWQ9ZmFsc2U7cmV0dXJuIGQuc3VwZXJjbGFzcy5wcm90b3R5cGUudXBkYXRlRGlzcGxheS5jYWxsKHRoaXMpfX0pO3JldHVybiBkfShkYXQuY29udHJvbGxlcnMuQ29udHJvbGxlcixkYXQuZG9tLmRvbSxkYXQudXRpbHMuY29tbW9uKTsKZGF0LmNvbG9yLnRvU3RyaW5nPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbihhKXtpZihhLmE9PTF8fGUuaXNVbmRlZmluZWQoYS5hKSl7Zm9yKGE9YS5oZXgudG9TdHJpbmcoMTYpO2EubGVuZ3RoPDY7KWE9IjAiK2E7cmV0dXJuIiMiK2F9ZWxzZSByZXR1cm4icmdiYSgiK01hdGgucm91bmQoYS5yKSsiLCIrTWF0aC5yb3VuZChhLmcpKyIsIitNYXRoLnJvdW5kKGEuYikrIiwiK2EuYSsiKSJ9fShkYXQudXRpbHMuY29tbW9uKTsKZGF0LmNvbG9yLmludGVycHJldD1mdW5jdGlvbihlLGEpe3ZhciBjLGQsZj1be2xpdG11czphLmlzU3RyaW5nLGNvbnZlcnNpb25zOntUSFJFRV9DSEFSX0hFWDp7cmVhZDpmdW5jdGlvbihhKXthPWEubWF0Y2goL14jKFtBLUYwLTldKShbQS1GMC05XSkoW0EtRjAtOV0pJC9pKTtyZXR1cm4gYT09PW51bGw/ZmFsc2U6e3NwYWNlOiJIRVgiLGhleDpwYXJzZUludCgiMHgiK2FbMV0udG9TdHJpbmcoKSthWzFdLnRvU3RyaW5nKCkrYVsyXS50b1N0cmluZygpK2FbMl0udG9TdHJpbmcoKSthWzNdLnRvU3RyaW5nKCkrYVszXS50b1N0cmluZygpKX19LHdyaXRlOmV9LFNJWF9DSEFSX0hFWDp7cmVhZDpmdW5jdGlvbihhKXthPWEubWF0Y2goL14jKFtBLUYwLTldezZ9KSQvaSk7cmV0dXJuIGE9PT1udWxsP2ZhbHNlOntzcGFjZToiSEVYIixoZXg6cGFyc2VJbnQoIjB4IithWzFdLnRvU3RyaW5nKCkpfX0sd3JpdGU6ZX0sQ1NTX1JHQjp7cmVhZDpmdW5jdGlvbihhKXthPWEubWF0Y2goL15yZ2JcKFxzKiguKylccyosXHMqKC4rKVxzKixccyooLispXHMqXCkvKTsKcmV0dXJuIGE9PT1udWxsP2ZhbHNlOntzcGFjZToiUkdCIixyOnBhcnNlRmxvYXQoYVsxXSksZzpwYXJzZUZsb2F0KGFbMl0pLGI6cGFyc2VGbG9hdChhWzNdKX19LHdyaXRlOmV9LENTU19SR0JBOntyZWFkOmZ1bmN0aW9uKGEpe2E9YS5tYXRjaCgvXnJnYmFcKFxzKiguKylccyosXHMqKC4rKVxzKixccyooLispXHMqXCxccyooLispXHMqXCkvKTtyZXR1cm4gYT09PW51bGw/ZmFsc2U6e3NwYWNlOiJSR0IiLHI6cGFyc2VGbG9hdChhWzFdKSxnOnBhcnNlRmxvYXQoYVsyXSksYjpwYXJzZUZsb2F0KGFbM10pLGE6cGFyc2VGbG9hdChhWzRdKX19LHdyaXRlOmV9fX0se2xpdG11czphLmlzTnVtYmVyLGNvbnZlcnNpb25zOntIRVg6e3JlYWQ6ZnVuY3Rpb24oYSl7cmV0dXJue3NwYWNlOiJIRVgiLGhleDphLGNvbnZlcnNpb25OYW1lOiJIRVgifX0sd3JpdGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuaGV4fX19fSx7bGl0bXVzOmEuaXNBcnJheSxjb252ZXJzaW9uczp7UkdCX0FSUkFZOntyZWFkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmxlbmd0aCE9CjM/ZmFsc2U6e3NwYWNlOiJSR0IiLHI6YVswXSxnOmFbMV0sYjphWzJdfX0sd3JpdGU6ZnVuY3Rpb24oYSl7cmV0dXJuW2EucixhLmcsYS5iXX19LFJHQkFfQVJSQVk6e3JlYWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEubGVuZ3RoIT00P2ZhbHNlOntzcGFjZToiUkdCIixyOmFbMF0sZzphWzFdLGI6YVsyXSxhOmFbM119fSx3cml0ZTpmdW5jdGlvbihhKXtyZXR1cm5bYS5yLGEuZyxhLmIsYS5hXX19fX0se2xpdG11czphLmlzT2JqZWN0LGNvbnZlcnNpb25zOntSR0JBX09CSjp7cmVhZDpmdW5jdGlvbihiKXtyZXR1cm4gYS5pc051bWJlcihiLnIpJiZhLmlzTnVtYmVyKGIuZykmJmEuaXNOdW1iZXIoYi5iKSYmYS5pc051bWJlcihiLmEpP3tzcGFjZToiUkdCIixyOmIucixnOmIuZyxiOmIuYixhOmIuYX06ZmFsc2V9LHdyaXRlOmZ1bmN0aW9uKGEpe3JldHVybntyOmEucixnOmEuZyxiOmEuYixhOmEuYX19fSxSR0JfT0JKOntyZWFkOmZ1bmN0aW9uKGIpe3JldHVybiBhLmlzTnVtYmVyKGIucikmJgphLmlzTnVtYmVyKGIuZykmJmEuaXNOdW1iZXIoYi5iKT97c3BhY2U6IlJHQiIscjpiLnIsZzpiLmcsYjpiLmJ9OmZhbHNlfSx3cml0ZTpmdW5jdGlvbihhKXtyZXR1cm57cjphLnIsZzphLmcsYjphLmJ9fX0sSFNWQV9PQko6e3JlYWQ6ZnVuY3Rpb24oYil7cmV0dXJuIGEuaXNOdW1iZXIoYi5oKSYmYS5pc051bWJlcihiLnMpJiZhLmlzTnVtYmVyKGIudikmJmEuaXNOdW1iZXIoYi5hKT97c3BhY2U6IkhTViIsaDpiLmgsczpiLnMsdjpiLnYsYTpiLmF9OmZhbHNlfSx3cml0ZTpmdW5jdGlvbihhKXtyZXR1cm57aDphLmgsczphLnMsdjphLnYsYTphLmF9fX0sSFNWX09CSjp7cmVhZDpmdW5jdGlvbihiKXtyZXR1cm4gYS5pc051bWJlcihiLmgpJiZhLmlzTnVtYmVyKGIucykmJmEuaXNOdW1iZXIoYi52KT97c3BhY2U6IkhTViIsaDpiLmgsczpiLnMsdjpiLnZ9OmZhbHNlfSx3cml0ZTpmdW5jdGlvbihhKXtyZXR1cm57aDphLmgsczphLnMsdjphLnZ9fX19fV07cmV0dXJuIGZ1bmN0aW9uKCl7ZD0KZmFsc2U7dmFyIGI9YXJndW1lbnRzLmxlbmd0aD4xP2EudG9BcnJheShhcmd1bWVudHMpOmFyZ3VtZW50c1swXTthLmVhY2goZixmdW5jdGlvbihlKXtpZihlLmxpdG11cyhiKSlyZXR1cm4gYS5lYWNoKGUuY29udmVyc2lvbnMsZnVuY3Rpb24oZSxmKXtjPWUucmVhZChiKTtpZihkPT09ZmFsc2UmJmMhPT1mYWxzZSlyZXR1cm4gZD1jLGMuY29udmVyc2lvbk5hbWU9ZixjLmNvbnZlcnNpb249ZSxhLkJSRUFLfSksYS5CUkVBS30pO3JldHVybiBkfX0oZGF0LmNvbG9yLnRvU3RyaW5nLGRhdC51dGlscy5jb21tb24pOwpkYXQuR1VJPWRhdC5ndWkuR1VJPWZ1bmN0aW9uKGUsYSxjLGQsZixiLG4saCxqLG0sbCxvLHksZyxpKXtmdW5jdGlvbiBxKGEsYixyLGMpe2lmKGJbcl09PT12b2lkIDApdGhyb3cgRXJyb3IoIk9iamVjdCAiK2IrJyBoYXMgbm8gcHJvcGVydHkgIicrcisnIicpO2MuY29sb3I/Yj1uZXcgbChiLHIpOihiPVtiLHJdLmNvbmNhdChjLmZhY3RvcnlBcmdzKSxiPWQuYXBwbHkoYSxiKSk7aWYoYy5iZWZvcmUgaW5zdGFuY2VvZiBmKWMuYmVmb3JlPWMuYmVmb3JlLl9fbGk7dChhLGIpO2cuYWRkQ2xhc3MoYi5kb21FbGVtZW50LCJjIik7cj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7Zy5hZGRDbGFzcyhyLCJwcm9wZXJ0eS1uYW1lIik7ci5pbm5lckhUTUw9Yi5wcm9wZXJ0eTt2YXIgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtlLmFwcGVuZENoaWxkKHIpO2UuYXBwZW5kQ2hpbGQoYi5kb21FbGVtZW50KTtjPXMoYSxlLGMuYmVmb3JlKTtnLmFkZENsYXNzKGMsay5DTEFTU19DT05UUk9MTEVSX1JPVyk7CmcuYWRkQ2xhc3MoYyx0eXBlb2YgYi5nZXRWYWx1ZSgpKTtwKGEsYyxiKTthLl9fY29udHJvbGxlcnMucHVzaChiKTtyZXR1cm4gYn1mdW5jdGlvbiBzKGEsYixkKXt2YXIgYz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaSIpO2ImJmMuYXBwZW5kQ2hpbGQoYik7ZD9hLl9fdWwuaW5zZXJ0QmVmb3JlKGMscGFyYW1zLmJlZm9yZSk6YS5fX3VsLmFwcGVuZENoaWxkKGMpO2Eub25SZXNpemUoKTtyZXR1cm4gY31mdW5jdGlvbiBwKGEsZCxjKXtjLl9fbGk9ZDtjLl9fZ3VpPWE7aS5leHRlbmQoYyx7b3B0aW9uczpmdW5jdGlvbihiKXtpZihhcmd1bWVudHMubGVuZ3RoPjEpcmV0dXJuIGMucmVtb3ZlKCkscShhLGMub2JqZWN0LGMucHJvcGVydHkse2JlZm9yZTpjLl9fbGkubmV4dEVsZW1lbnRTaWJsaW5nLGZhY3RvcnlBcmdzOltpLnRvQXJyYXkoYXJndW1lbnRzKV19KTtpZihpLmlzQXJyYXkoYil8fGkuaXNPYmplY3QoYikpcmV0dXJuIGMucmVtb3ZlKCkscShhLGMub2JqZWN0LGMucHJvcGVydHksCntiZWZvcmU6Yy5fX2xpLm5leHRFbGVtZW50U2libGluZyxmYWN0b3J5QXJnczpbYl19KX0sbmFtZTpmdW5jdGlvbihhKXtjLl9fbGkuZmlyc3RFbGVtZW50Q2hpbGQuZmlyc3RFbGVtZW50Q2hpbGQuaW5uZXJIVE1MPWE7cmV0dXJuIGN9LGxpc3RlbjpmdW5jdGlvbigpe2MuX19ndWkubGlzdGVuKGMpO3JldHVybiBjfSxyZW1vdmU6ZnVuY3Rpb24oKXtjLl9fZ3VpLnJlbW92ZShjKTtyZXR1cm4gY319KTtpZihjIGluc3RhbmNlb2Ygail7dmFyIGU9bmV3IGgoYy5vYmplY3QsYy5wcm9wZXJ0eSx7bWluOmMuX19taW4sbWF4OmMuX19tYXgsc3RlcDpjLl9fc3RlcH0pO2kuZWFjaChbInVwZGF0ZURpc3BsYXkiLCJvbkNoYW5nZSIsIm9uRmluaXNoQ2hhbmdlIl0sZnVuY3Rpb24oYSl7dmFyIGI9Y1thXSxIPWVbYV07Y1thXT1lW2FdPWZ1bmN0aW9uKCl7dmFyIGE9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtiLmFwcGx5KGMsYSk7cmV0dXJuIEguYXBwbHkoZSxhKX19KTsKZy5hZGRDbGFzcyhkLCJoYXMtc2xpZGVyIik7Yy5kb21FbGVtZW50Lmluc2VydEJlZm9yZShlLmRvbUVsZW1lbnQsYy5kb21FbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKX1lbHNlIGlmKGMgaW5zdGFuY2VvZiBoKXt2YXIgZj1mdW5jdGlvbihiKXtyZXR1cm4gaS5pc051bWJlcihjLl9fbWluKSYmaS5pc051bWJlcihjLl9fbWF4KT8oYy5yZW1vdmUoKSxxKGEsYy5vYmplY3QsYy5wcm9wZXJ0eSx7YmVmb3JlOmMuX19saS5uZXh0RWxlbWVudFNpYmxpbmcsZmFjdG9yeUFyZ3M6W2MuX19taW4sYy5fX21heCxjLl9fc3RlcF19KSk6Yn07Yy5taW49aS5jb21wb3NlKGYsYy5taW4pO2MubWF4PWkuY29tcG9zZShmLGMubWF4KX1lbHNlIGlmKGMgaW5zdGFuY2VvZiBiKWcuYmluZChkLCJjbGljayIsZnVuY3Rpb24oKXtnLmZha2VFdmVudChjLl9fY2hlY2tib3gsImNsaWNrIil9KSxnLmJpbmQoYy5fX2NoZWNrYm94LCJjbGljayIsZnVuY3Rpb24oYSl7YS5zdG9wUHJvcGFnYXRpb24oKX0pOwplbHNlIGlmKGMgaW5zdGFuY2VvZiBuKWcuYmluZChkLCJjbGljayIsZnVuY3Rpb24oKXtnLmZha2VFdmVudChjLl9fYnV0dG9uLCJjbGljayIpfSksZy5iaW5kKGQsIm1vdXNlb3ZlciIsZnVuY3Rpb24oKXtnLmFkZENsYXNzKGMuX19idXR0b24sImhvdmVyIil9KSxnLmJpbmQoZCwibW91c2VvdXQiLGZ1bmN0aW9uKCl7Zy5yZW1vdmVDbGFzcyhjLl9fYnV0dG9uLCJob3ZlciIpfSk7ZWxzZSBpZihjIGluc3RhbmNlb2YgbClnLmFkZENsYXNzKGQsImNvbG9yIiksYy51cGRhdGVEaXNwbGF5PWkuY29tcG9zZShmdW5jdGlvbihhKXtkLnN0eWxlLmJvcmRlckxlZnRDb2xvcj1jLl9fY29sb3IudG9TdHJpbmcoKTtyZXR1cm4gYX0sYy51cGRhdGVEaXNwbGF5KSxjLnVwZGF0ZURpc3BsYXkoKTtjLnNldFZhbHVlPWkuY29tcG9zZShmdW5jdGlvbihiKXthLmdldFJvb3QoKS5fX3ByZXNldF9zZWxlY3QmJmMuaXNNb2RpZmllZCgpJiZCKGEuZ2V0Um9vdCgpLHRydWUpO3JldHVybiBifSxjLnNldFZhbHVlKX0KZnVuY3Rpb24gdChhLGIpe3ZhciBjPWEuZ2V0Um9vdCgpLGQ9Yy5fX3JlbWVtYmVyZWRPYmplY3RzLmluZGV4T2YoYi5vYmplY3QpO2lmKGQhPS0xKXt2YXIgZT1jLl9fcmVtZW1iZXJlZE9iamVjdEluZGVjZXNUb0NvbnRyb2xsZXJzW2RdO2U9PT12b2lkIDAmJihlPXt9LGMuX19yZW1lbWJlcmVkT2JqZWN0SW5kZWNlc1RvQ29udHJvbGxlcnNbZF09ZSk7ZVtiLnByb3BlcnR5XT1iO2lmKGMubG9hZCYmYy5sb2FkLnJlbWVtYmVyZWQpe2M9Yy5sb2FkLnJlbWVtYmVyZWQ7aWYoY1thLnByZXNldF0pYz1jW2EucHJlc2V0XTtlbHNlIGlmKGNbd10pYz1jW3ddO2Vsc2UgcmV0dXJuO2lmKGNbZF0mJmNbZF1bYi5wcm9wZXJ0eV0hPT12b2lkIDApZD1jW2RdW2IucHJvcGVydHldLGIuaW5pdGlhbFZhbHVlPWQsYi5zZXRWYWx1ZShkKX19fWZ1bmN0aW9uIEkoYSl7dmFyIGI9YS5fX3NhdmVfcm93PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpIik7Zy5hZGRDbGFzcyhhLmRvbUVsZW1lbnQsCiJoYXMtc2F2ZSIpO2EuX191bC5pbnNlcnRCZWZvcmUoYixhLl9fdWwuZmlyc3RDaGlsZCk7Zy5hZGRDbGFzcyhiLCJzYXZlLXJvdyIpO3ZhciBjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTtjLmlubmVySFRNTD0iJm5ic3A7IjtnLmFkZENsYXNzKGMsImJ1dHRvbiBnZWFycyIpO3ZhciBkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTtkLmlubmVySFRNTD0iU2F2ZSI7Zy5hZGRDbGFzcyhkLCJidXR0b24iKTtnLmFkZENsYXNzKGQsInNhdmUiKTt2YXIgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7ZS5pbm5lckhUTUw9Ik5ldyI7Zy5hZGRDbGFzcyhlLCJidXR0b24iKTtnLmFkZENsYXNzKGUsInNhdmUtYXMiKTt2YXIgZj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7Zi5pbm5lckhUTUw9IlJldmVydCI7Zy5hZGRDbGFzcyhmLCJidXR0b24iKTtnLmFkZENsYXNzKGYsInJldmVydCIpO3ZhciBtPWEuX19wcmVzZXRfc2VsZWN0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwphLmxvYWQmJmEubG9hZC5yZW1lbWJlcmVkP2kuZWFjaChhLmxvYWQucmVtZW1iZXJlZCxmdW5jdGlvbihiLGMpe0MoYSxjLGM9PWEucHJlc2V0KX0pOkMoYSx3LGZhbHNlKTtnLmJpbmQobSwiY2hhbmdlIixmdW5jdGlvbigpe2Zvcih2YXIgYj0wO2I8YS5fX3ByZXNldF9zZWxlY3QubGVuZ3RoO2IrKylhLl9fcHJlc2V0X3NlbGVjdFtiXS5pbm5lckhUTUw9YS5fX3ByZXNldF9zZWxlY3RbYl0udmFsdWU7YS5wcmVzZXQ9dGhpcy52YWx1ZX0pO2IuYXBwZW5kQ2hpbGQobSk7Yi5hcHBlbmRDaGlsZChjKTtiLmFwcGVuZENoaWxkKGQpO2IuYXBwZW5kQ2hpbGQoZSk7Yi5hcHBlbmRDaGlsZChmKTtpZih1KXt2YXIgYj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGctc2F2ZS1sb2NhbGx5IiksbD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGctbG9jYWwtZXhwbGFpbiIpO2Iuc3R5bGUuZGlzcGxheT0iYmxvY2siO2I9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRnLWxvY2FsLXN0b3JhZ2UiKTsKbG9jYWxTdG9yYWdlLmdldEl0ZW0oZG9jdW1lbnQubG9jYXRpb24uaHJlZisiLmlzTG9jYWwiKT09PSJ0cnVlIiYmYi5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCJjaGVja2VkIik7dmFyIG89ZnVuY3Rpb24oKXtsLnN0eWxlLmRpc3BsYXk9YS51c2VMb2NhbFN0b3JhZ2U/ImJsb2NrIjoibm9uZSJ9O28oKTtnLmJpbmQoYiwiY2hhbmdlIixmdW5jdGlvbigpe2EudXNlTG9jYWxTdG9yYWdlPSFhLnVzZUxvY2FsU3RvcmFnZTtvKCl9KX12YXIgaD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGctbmV3LWNvbnN0cnVjdG9yIik7Zy5iaW5kKGgsImtleWRvd24iLGZ1bmN0aW9uKGEpe2EubWV0YUtleSYmKGEud2hpY2g9PT02N3x8YS5rZXlDb2RlPT02NykmJnguaGlkZSgpfSk7Zy5iaW5kKGMsImNsaWNrIixmdW5jdGlvbigpe2guaW5uZXJIVE1MPUpTT04uc3RyaW5naWZ5KGEuZ2V0U2F2ZU9iamVjdCgpLHZvaWQgMCwyKTt4LnNob3coKTtoLmZvY3VzKCk7aC5zZWxlY3QoKX0pO2cuYmluZChkLAoiY2xpY2siLGZ1bmN0aW9uKCl7YS5zYXZlKCl9KTtnLmJpbmQoZSwiY2xpY2siLGZ1bmN0aW9uKCl7dmFyIGI9cHJvbXB0KCJFbnRlciBhIG5ldyBwcmVzZXQgbmFtZS4iKTtiJiZhLnNhdmVBcyhiKX0pO2cuYmluZChmLCJjbGljayIsZnVuY3Rpb24oKXthLnJldmVydCgpfSl9ZnVuY3Rpb24gSihhKXtmdW5jdGlvbiBiKGYpe2YucHJldmVudERlZmF1bHQoKTtlPWYuY2xpZW50WDtnLmFkZENsYXNzKGEuX19jbG9zZUJ1dHRvbixrLkNMQVNTX0RSQUcpO2cuYmluZCh3aW5kb3csIm1vdXNlbW92ZSIsYyk7Zy5iaW5kKHdpbmRvdywibW91c2V1cCIsZCk7cmV0dXJuIGZhbHNlfWZ1bmN0aW9uIGMoYil7Yi5wcmV2ZW50RGVmYXVsdCgpO2Eud2lkdGgrPWUtYi5jbGllbnRYO2Eub25SZXNpemUoKTtlPWIuY2xpZW50WDtyZXR1cm4gZmFsc2V9ZnVuY3Rpb24gZCgpe2cucmVtb3ZlQ2xhc3MoYS5fX2Nsb3NlQnV0dG9uLGsuQ0xBU1NfRFJBRyk7Zy51bmJpbmQod2luZG93LCJtb3VzZW1vdmUiLApjKTtnLnVuYmluZCh3aW5kb3csIm1vdXNldXAiLGQpfWEuX19yZXNpemVfaGFuZGxlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2kuZXh0ZW5kKGEuX19yZXNpemVfaGFuZGxlLnN0eWxlLHt3aWR0aDoiNnB4IixtYXJnaW5MZWZ0OiItM3B4IixoZWlnaHQ6IjIwMHB4IixjdXJzb3I6ImV3LXJlc2l6ZSIscG9zaXRpb246ImFic29sdXRlIn0pO3ZhciBlO2cuYmluZChhLl9fcmVzaXplX2hhbmRsZSwibW91c2Vkb3duIixiKTtnLmJpbmQoYS5fX2Nsb3NlQnV0dG9uLCJtb3VzZWRvd24iLGIpO2EuZG9tRWxlbWVudC5pbnNlcnRCZWZvcmUoYS5fX3Jlc2l6ZV9oYW5kbGUsYS5kb21FbGVtZW50LmZpcnN0RWxlbWVudENoaWxkKX1mdW5jdGlvbiBEKGEsYil7YS5kb21FbGVtZW50LnN0eWxlLndpZHRoPWIrInB4IjtpZihhLl9fc2F2ZV9yb3cmJmEuYXV0b1BsYWNlKWEuX19zYXZlX3Jvdy5zdHlsZS53aWR0aD1iKyJweCI7aWYoYS5fX2Nsb3NlQnV0dG9uKWEuX19jbG9zZUJ1dHRvbi5zdHlsZS53aWR0aD0KYisicHgifWZ1bmN0aW9uIHooYSxiKXt2YXIgYz17fTtpLmVhY2goYS5fX3JlbWVtYmVyZWRPYmplY3RzLGZ1bmN0aW9uKGQsZSl7dmFyIGY9e307aS5lYWNoKGEuX19yZW1lbWJlcmVkT2JqZWN0SW5kZWNlc1RvQ29udHJvbGxlcnNbZV0sZnVuY3Rpb24oYSxjKXtmW2NdPWI/YS5pbml0aWFsVmFsdWU6YS5nZXRWYWx1ZSgpfSk7Y1tlXT1mfSk7cmV0dXJuIGN9ZnVuY3Rpb24gQyhhLGIsYyl7dmFyIGQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7ZC5pbm5lckhUTUw9YjtkLnZhbHVlPWI7YS5fX3ByZXNldF9zZWxlY3QuYXBwZW5kQ2hpbGQoZCk7aWYoYylhLl9fcHJlc2V0X3NlbGVjdC5zZWxlY3RlZEluZGV4PWEuX19wcmVzZXRfc2VsZWN0Lmxlbmd0aC0xfWZ1bmN0aW9uIEIoYSxiKXt2YXIgYz1hLl9fcHJlc2V0X3NlbGVjdFthLl9fcHJlc2V0X3NlbGVjdC5zZWxlY3RlZEluZGV4XTtjLmlubmVySFRNTD1iP2MudmFsdWUrIioiOmMudmFsdWV9ZnVuY3Rpb24gRShhKXthLmxlbmd0aCE9CjAmJm8oZnVuY3Rpb24oKXtFKGEpfSk7aS5lYWNoKGEsZnVuY3Rpb24oYSl7YS51cGRhdGVEaXNwbGF5KCl9KX1lLmluamVjdChjKTt2YXIgdz0iRGVmYXVsdCIsdTt0cnl7dT0ibG9jYWxTdG9yYWdlImluIHdpbmRvdyYmd2luZG93LmxvY2FsU3RvcmFnZSE9PW51bGx9Y2F0Y2goSyl7dT1mYWxzZX12YXIgeCxGPXRydWUsdixBPWZhbHNlLEc9W10saz1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKCl7bG9jYWxTdG9yYWdlLnNldEl0ZW0oZG9jdW1lbnQubG9jYXRpb24uaHJlZisiLmd1aSIsSlNPTi5zdHJpbmdpZnkoZC5nZXRTYXZlT2JqZWN0KCkpKX1mdW5jdGlvbiBjKCl7dmFyIGE9ZC5nZXRSb290KCk7YS53aWR0aCs9MTtpLmRlZmVyKGZ1bmN0aW9uKCl7YS53aWR0aC09MX0pfXZhciBkPXRoaXM7dGhpcy5kb21FbGVtZW50PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3RoaXMuX191bD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ1bCIpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fdWwpOwpnLmFkZENsYXNzKHRoaXMuZG9tRWxlbWVudCwiZGciKTt0aGlzLl9fZm9sZGVycz17fTt0aGlzLl9fY29udHJvbGxlcnM9W107dGhpcy5fX3JlbWVtYmVyZWRPYmplY3RzPVtdO3RoaXMuX19yZW1lbWJlcmVkT2JqZWN0SW5kZWNlc1RvQ29udHJvbGxlcnM9W107dGhpcy5fX2xpc3RlbmluZz1bXTthPWF8fHt9O2E9aS5kZWZhdWx0cyhhLHthdXRvUGxhY2U6dHJ1ZSx3aWR0aDprLkRFRkFVTFRfV0lEVEh9KTthPWkuZGVmYXVsdHMoYSx7cmVzaXphYmxlOmEuYXV0b1BsYWNlLGhpZGVhYmxlOmEuYXV0b1BsYWNlfSk7aWYoaS5pc1VuZGVmaW5lZChhLmxvYWQpKWEubG9hZD17cHJlc2V0Ond9O2Vsc2UgaWYoYS5wcmVzZXQpYS5sb2FkLnByZXNldD1hLnByZXNldDtpLmlzVW5kZWZpbmVkKGEucGFyZW50KSYmYS5oaWRlYWJsZSYmRy5wdXNoKHRoaXMpO2EucmVzaXphYmxlPWkuaXNVbmRlZmluZWQoYS5wYXJlbnQpJiZhLnJlc2l6YWJsZTtpZihhLmF1dG9QbGFjZSYmaS5pc1VuZGVmaW5lZChhLnNjcm9sbGFibGUpKWEuc2Nyb2xsYWJsZT0KdHJ1ZTt2YXIgZT11JiZsb2NhbFN0b3JhZ2UuZ2V0SXRlbShkb2N1bWVudC5sb2NhdGlvbi5ocmVmKyIuaXNMb2NhbCIpPT09InRydWUiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse3BhcmVudDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEucGFyZW50fX0sc2Nyb2xsYWJsZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEuc2Nyb2xsYWJsZX19LGF1dG9QbGFjZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEuYXV0b1BsYWNlfX0scHJlc2V0OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZC5wYXJlbnQ/ZC5nZXRSb290KCkucHJlc2V0OmEubG9hZC5wcmVzZXR9LHNldDpmdW5jdGlvbihiKXtkLnBhcmVudD9kLmdldFJvb3QoKS5wcmVzZXQ9YjphLmxvYWQucHJlc2V0PWI7Zm9yKGI9MDtiPHRoaXMuX19wcmVzZXRfc2VsZWN0Lmxlbmd0aDtiKyspaWYodGhpcy5fX3ByZXNldF9zZWxlY3RbYl0udmFsdWU9PXRoaXMucHJlc2V0KXRoaXMuX19wcmVzZXRfc2VsZWN0LnNlbGVjdGVkSW5kZXg9CmI7ZC5yZXZlcnQoKX19LHdpZHRoOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYS53aWR0aH0sc2V0OmZ1bmN0aW9uKGIpe2Eud2lkdGg9YjtEKGQsYil9fSxuYW1lOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYS5uYW1lfSxzZXQ6ZnVuY3Rpb24oYil7YS5uYW1lPWI7aWYobSltLmlubmVySFRNTD1hLm5hbWV9fSxjbG9zZWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiBhLmNsb3NlZH0sc2V0OmZ1bmN0aW9uKGIpe2EuY2xvc2VkPWI7YS5jbG9zZWQ/Zy5hZGRDbGFzcyhkLl9fdWwsay5DTEFTU19DTE9TRUQpOmcucmVtb3ZlQ2xhc3MoZC5fX3VsLGsuQ0xBU1NfQ0xPU0VEKTt0aGlzLm9uUmVzaXplKCk7aWYoZC5fX2Nsb3NlQnV0dG9uKWQuX19jbG9zZUJ1dHRvbi5pbm5lckhUTUw9Yj9rLlRFWFRfT1BFTjprLlRFWFRfQ0xPU0VEfX0sbG9hZDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEubG9hZH19LHVzZUxvY2FsU3RvcmFnZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGV9LHNldDpmdW5jdGlvbihhKXt1JiYKKChlPWEpP2cuYmluZCh3aW5kb3csInVubG9hZCIsYik6Zy51bmJpbmQod2luZG93LCJ1bmxvYWQiLGIpLGxvY2FsU3RvcmFnZS5zZXRJdGVtKGRvY3VtZW50LmxvY2F0aW9uLmhyZWYrIi5pc0xvY2FsIixhKSl9fX0pO2lmKGkuaXNVbmRlZmluZWQoYS5wYXJlbnQpKXthLmNsb3NlZD1mYWxzZTtnLmFkZENsYXNzKHRoaXMuZG9tRWxlbWVudCxrLkNMQVNTX01BSU4pO2cubWFrZVNlbGVjdGFibGUodGhpcy5kb21FbGVtZW50LGZhbHNlKTtpZih1JiZlKXtkLnVzZUxvY2FsU3RvcmFnZT10cnVlO3ZhciBmPWxvY2FsU3RvcmFnZS5nZXRJdGVtKGRvY3VtZW50LmxvY2F0aW9uLmhyZWYrIi5ndWkiKTtpZihmKWEubG9hZD1KU09OLnBhcnNlKGYpfXRoaXMuX19jbG9zZUJ1dHRvbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLl9fY2xvc2VCdXR0b24uaW5uZXJIVE1MPWsuVEVYVF9DTE9TRUQ7Zy5hZGRDbGFzcyh0aGlzLl9fY2xvc2VCdXR0b24say5DTEFTU19DTE9TRV9CVVRUT04pOwp0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fX2Nsb3NlQnV0dG9uKTtnLmJpbmQodGhpcy5fX2Nsb3NlQnV0dG9uLCJjbGljayIsZnVuY3Rpb24oKXtkLmNsb3NlZD0hZC5jbG9zZWR9KX1lbHNle2lmKGEuY2xvc2VkPT09dm9pZCAwKWEuY2xvc2VkPXRydWU7dmFyIG09ZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoYS5uYW1lKTtnLmFkZENsYXNzKG0sImNvbnRyb2xsZXItbmFtZSIpO2Y9cyhkLG0pO2cuYWRkQ2xhc3ModGhpcy5fX3VsLGsuQ0xBU1NfQ0xPU0VEKTtnLmFkZENsYXNzKGYsInRpdGxlIik7Zy5iaW5kKGYsImNsaWNrIixmdW5jdGlvbihhKXthLnByZXZlbnREZWZhdWx0KCk7ZC5jbG9zZWQ9IWQuY2xvc2VkO3JldHVybiBmYWxzZX0pO2lmKCFhLmNsb3NlZCl0aGlzLmNsb3NlZD1mYWxzZX1hLmF1dG9QbGFjZSYmKGkuaXNVbmRlZmluZWQoYS5wYXJlbnQpJiYoRiYmKHY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksZy5hZGRDbGFzcyh2LCJkZyIpLGcuYWRkQ2xhc3ModiwKay5DTEFTU19BVVRPX1BMQUNFX0NPTlRBSU5FUiksZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh2KSxGPWZhbHNlKSx2LmFwcGVuZENoaWxkKHRoaXMuZG9tRWxlbWVudCksZy5hZGRDbGFzcyh0aGlzLmRvbUVsZW1lbnQsay5DTEFTU19BVVRPX1BMQUNFKSksdGhpcy5wYXJlbnR8fEQoZCxhLndpZHRoKSk7Zy5iaW5kKHdpbmRvdywicmVzaXplIixmdW5jdGlvbigpe2Qub25SZXNpemUoKX0pO2cuYmluZCh0aGlzLl9fdWwsIndlYmtpdFRyYW5zaXRpb25FbmQiLGZ1bmN0aW9uKCl7ZC5vblJlc2l6ZSgpfSk7Zy5iaW5kKHRoaXMuX191bCwidHJhbnNpdGlvbmVuZCIsZnVuY3Rpb24oKXtkLm9uUmVzaXplKCl9KTtnLmJpbmQodGhpcy5fX3VsLCJvVHJhbnNpdGlvbkVuZCIsZnVuY3Rpb24oKXtkLm9uUmVzaXplKCl9KTt0aGlzLm9uUmVzaXplKCk7YS5yZXNpemFibGUmJkoodGhpcyk7ZC5nZXRSb290KCk7YS5wYXJlbnR8fGMoKX07ay50b2dnbGVIaWRlPWZ1bmN0aW9uKCl7QT0hQTtpLmVhY2goRywKZnVuY3Rpb24oYSl7YS5kb21FbGVtZW50LnN0eWxlLnpJbmRleD1BPy05OTk6OTk5O2EuZG9tRWxlbWVudC5zdHlsZS5vcGFjaXR5PUE/MDoxfSl9O2suQ0xBU1NfQVVUT19QTEFDRT0iYSI7ay5DTEFTU19BVVRPX1BMQUNFX0NPTlRBSU5FUj0iYWMiO2suQ0xBU1NfTUFJTj0ibWFpbiI7ay5DTEFTU19DT05UUk9MTEVSX1JPVz0iY3IiO2suQ0xBU1NfVE9PX1RBTEw9InRhbGxlci10aGFuLXdpbmRvdyI7ay5DTEFTU19DTE9TRUQ9ImNsb3NlZCI7ay5DTEFTU19DTE9TRV9CVVRUT049ImNsb3NlLWJ1dHRvbiI7ay5DTEFTU19EUkFHPSJkcmFnIjtrLkRFRkFVTFRfV0lEVEg9MjQ1O2suVEVYVF9DTE9TRUQ9IkNsb3NlIENvbnRyb2xzIjtrLlRFWFRfT1BFTj0iT3BlbiBDb250cm9scyI7Zy5iaW5kKHdpbmRvdywia2V5ZG93biIsZnVuY3Rpb24oYSl7ZG9jdW1lbnQuYWN0aXZlRWxlbWVudC50eXBlIT09InRleHQiJiYoYS53aGljaD09PTcyfHxhLmtleUNvZGU9PTcyKSYmay50b2dnbGVIaWRlKCl9LApmYWxzZSk7aS5leHRlbmQoay5wcm90b3R5cGUse2FkZDpmdW5jdGlvbihhLGIpe3JldHVybiBxKHRoaXMsYSxiLHtmYWN0b3J5QXJnczpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMil9KX0sYWRkQ29sb3I6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gcSh0aGlzLGEsYix7Y29sb3I6dHJ1ZX0pfSxyZW1vdmU6ZnVuY3Rpb24oYSl7dGhpcy5fX3VsLnJlbW92ZUNoaWxkKGEuX19saSk7dGhpcy5fX2NvbnRyb2xsZXJzLnNsaWNlKHRoaXMuX19jb250cm9sbGVycy5pbmRleE9mKGEpLDEpO3ZhciBiPXRoaXM7aS5kZWZlcihmdW5jdGlvbigpe2Iub25SZXNpemUoKX0pfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5hdXRvUGxhY2UmJnYucmVtb3ZlQ2hpbGQodGhpcy5kb21FbGVtZW50KX0sYWRkRm9sZGVyOmZ1bmN0aW9uKGEpe2lmKHRoaXMuX19mb2xkZXJzW2FdIT09dm9pZCAwKXRocm93IEVycm9yKCdZb3UgYWxyZWFkeSBoYXZlIGEgZm9sZGVyIGluIHRoaXMgR1VJIGJ5IHRoZSBuYW1lICInKwphKyciJyk7dmFyIGI9e25hbWU6YSxwYXJlbnQ6dGhpc307Yi5hdXRvUGxhY2U9dGhpcy5hdXRvUGxhY2U7aWYodGhpcy5sb2FkJiZ0aGlzLmxvYWQuZm9sZGVycyYmdGhpcy5sb2FkLmZvbGRlcnNbYV0pYi5jbG9zZWQ9dGhpcy5sb2FkLmZvbGRlcnNbYV0uY2xvc2VkLGIubG9hZD10aGlzLmxvYWQuZm9sZGVyc1thXTtiPW5ldyBrKGIpO3RoaXMuX19mb2xkZXJzW2FdPWI7YT1zKHRoaXMsYi5kb21FbGVtZW50KTtnLmFkZENsYXNzKGEsImZvbGRlciIpO3JldHVybiBifSxvcGVuOmZ1bmN0aW9uKCl7dGhpcy5jbG9zZWQ9ZmFsc2V9LGNsb3NlOmZ1bmN0aW9uKCl7dGhpcy5jbG9zZWQ9dHJ1ZX0sb25SZXNpemU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmdldFJvb3QoKTtpZihhLnNjcm9sbGFibGUpe3ZhciBiPWcuZ2V0T2Zmc2V0KGEuX191bCkudG9wLGM9MDtpLmVhY2goYS5fX3VsLmNoaWxkTm9kZXMsZnVuY3Rpb24oYil7YS5hdXRvUGxhY2UmJmI9PT1hLl9fc2F2ZV9yb3d8fChjKz0KZy5nZXRIZWlnaHQoYikpfSk7d2luZG93LmlubmVySGVpZ2h0LWItMjA8Yz8oZy5hZGRDbGFzcyhhLmRvbUVsZW1lbnQsay5DTEFTU19UT09fVEFMTCksYS5fX3VsLnN0eWxlLmhlaWdodD13aW5kb3cuaW5uZXJIZWlnaHQtYi0yMCsicHgiKTooZy5yZW1vdmVDbGFzcyhhLmRvbUVsZW1lbnQsay5DTEFTU19UT09fVEFMTCksYS5fX3VsLnN0eWxlLmhlaWdodD0iYXV0byIpfWEuX19yZXNpemVfaGFuZGxlJiZpLmRlZmVyKGZ1bmN0aW9uKCl7YS5fX3Jlc2l6ZV9oYW5kbGUuc3R5bGUuaGVpZ2h0PWEuX191bC5vZmZzZXRIZWlnaHQrInB4In0pO2lmKGEuX19jbG9zZUJ1dHRvbilhLl9fY2xvc2VCdXR0b24uc3R5bGUud2lkdGg9YS53aWR0aCsicHgifSxyZW1lbWJlcjpmdW5jdGlvbigpe2lmKGkuaXNVbmRlZmluZWQoeCkpeD1uZXcgeSx4LmRvbUVsZW1lbnQuaW5uZXJIVE1MPWE7aWYodGhpcy5wYXJlbnQpdGhyb3cgRXJyb3IoIllvdSBjYW4gb25seSBjYWxsIHJlbWVtYmVyIG9uIGEgdG9wIGxldmVsIEdVSS4iKTsKdmFyIGI9dGhpcztpLmVhY2goQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSxmdW5jdGlvbihhKXtiLl9fcmVtZW1iZXJlZE9iamVjdHMubGVuZ3RoPT0wJiZJKGIpO2IuX19yZW1lbWJlcmVkT2JqZWN0cy5pbmRleE9mKGEpPT0tMSYmYi5fX3JlbWVtYmVyZWRPYmplY3RzLnB1c2goYSl9KTt0aGlzLmF1dG9QbGFjZSYmRCh0aGlzLHRoaXMud2lkdGgpfSxnZXRSb290OmZ1bmN0aW9uKCl7Zm9yKHZhciBhPXRoaXM7YS5wYXJlbnQ7KWE9YS5wYXJlbnQ7cmV0dXJuIGF9LGdldFNhdmVPYmplY3Q6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmxvYWQ7YS5jbG9zZWQ9dGhpcy5jbG9zZWQ7aWYodGhpcy5fX3JlbWVtYmVyZWRPYmplY3RzLmxlbmd0aD4wKXthLnByZXNldD10aGlzLnByZXNldDtpZighYS5yZW1lbWJlcmVkKWEucmVtZW1iZXJlZD17fTthLnJlbWVtYmVyZWRbdGhpcy5wcmVzZXRdPXoodGhpcyl9YS5mb2xkZXJzPXt9O2kuZWFjaCh0aGlzLl9fZm9sZGVycyxmdW5jdGlvbihiLApjKXthLmZvbGRlcnNbY109Yi5nZXRTYXZlT2JqZWN0KCl9KTtyZXR1cm4gYX0sc2F2ZTpmdW5jdGlvbigpe2lmKCF0aGlzLmxvYWQucmVtZW1iZXJlZCl0aGlzLmxvYWQucmVtZW1iZXJlZD17fTt0aGlzLmxvYWQucmVtZW1iZXJlZFt0aGlzLnByZXNldF09eih0aGlzKTtCKHRoaXMsZmFsc2UpfSxzYXZlQXM6ZnVuY3Rpb24oYSl7aWYoIXRoaXMubG9hZC5yZW1lbWJlcmVkKXRoaXMubG9hZC5yZW1lbWJlcmVkPXt9LHRoaXMubG9hZC5yZW1lbWJlcmVkW3ddPXoodGhpcyx0cnVlKTt0aGlzLmxvYWQucmVtZW1iZXJlZFthXT16KHRoaXMpO3RoaXMucHJlc2V0PWE7Qyh0aGlzLGEsdHJ1ZSl9LHJldmVydDpmdW5jdGlvbihhKXtpLmVhY2godGhpcy5fX2NvbnRyb2xsZXJzLGZ1bmN0aW9uKGIpe3RoaXMuZ2V0Um9vdCgpLmxvYWQucmVtZW1iZXJlZD90KGF8fHRoaXMuZ2V0Um9vdCgpLGIpOmIuc2V0VmFsdWUoYi5pbml0aWFsVmFsdWUpfSx0aGlzKTtpLmVhY2godGhpcy5fX2ZvbGRlcnMsCmZ1bmN0aW9uKGEpe2EucmV2ZXJ0KGEpfSk7YXx8Qih0aGlzLmdldFJvb3QoKSxmYWxzZSl9LGxpc3RlbjpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9fbGlzdGVuaW5nLmxlbmd0aD09MDt0aGlzLl9fbGlzdGVuaW5nLnB1c2goYSk7YiYmRSh0aGlzLl9fbGlzdGVuaW5nKX19KTtyZXR1cm4ga30oZGF0LnV0aWxzLmNzcywnPGRpdiBpZD0iZGctc2F2ZSIgY2xhc3M9ImRnIGRpYWxvZ3VlIj5cblxuICBIZXJlXCdzIHRoZSBuZXcgbG9hZCBwYXJhbWV0ZXIgZm9yIHlvdXIgPGNvZGU+R1VJPC9jb2RlPlwncyBjb25zdHJ1Y3RvcjpcblxuICA8dGV4dGFyZWEgaWQ9ImRnLW5ldy1jb25zdHJ1Y3RvciI+PC90ZXh0YXJlYT5cblxuICA8ZGl2IGlkPSJkZy1zYXZlLWxvY2FsbHkiPlxuXG4gICAgPGlucHV0IGlkPSJkZy1sb2NhbC1zdG9yYWdlIiB0eXBlPSJjaGVja2JveCIvPiBBdXRvbWF0aWNhbGx5IHNhdmVcbiAgICB2YWx1ZXMgdG8gPGNvZGU+bG9jYWxTdG9yYWdlPC9jb2RlPiBvbiBleGl0LlxuXG4gICAgPGRpdiBpZD0iZGctbG9jYWwtZXhwbGFpbiI+VGhlIHZhbHVlcyBzYXZlZCB0byA8Y29kZT5sb2NhbFN0b3JhZ2U8L2NvZGU+IHdpbGxcbiAgICAgIG92ZXJyaWRlIHRob3NlIHBhc3NlZCB0byA8Y29kZT5kYXQuR1VJPC9jb2RlPlwncyBjb25zdHJ1Y3Rvci4gVGhpcyBtYWtlcyBpdFxuICAgICAgZWFzaWVyIHRvIHdvcmsgaW5jcmVtZW50YWxseSwgYnV0IDxjb2RlPmxvY2FsU3RvcmFnZTwvY29kZT4gaXMgZnJhZ2lsZSxcbiAgICAgIGFuZCB5b3VyIGZyaWVuZHMgbWF5IG5vdCBzZWUgdGhlIHNhbWUgdmFsdWVzIHlvdSBkby5cbiAgICAgIFxuICAgIDwvZGl2PlxuICAgIFxuICA8L2Rpdj5cblxuPC9kaXY+JywKIi5kZyB1bHtsaXN0LXN0eWxlOm5vbmU7bWFyZ2luOjA7cGFkZGluZzowO3dpZHRoOjEwMCU7Y2xlYXI6Ym90aH0uZGcuYWN7cG9zaXRpb246Zml4ZWQ7dG9wOjA7bGVmdDowO3JpZ2h0OjA7aGVpZ2h0OjA7ei1pbmRleDowfS5kZzpub3QoLmFjKSAubWFpbntvdmVyZmxvdzpoaWRkZW59LmRnLm1haW57LXdlYmtpdC10cmFuc2l0aW9uOm9wYWNpdHkgMC4xcyBsaW5lYXI7LW8tdHJhbnNpdGlvbjpvcGFjaXR5IDAuMXMgbGluZWFyOy1tb3otdHJhbnNpdGlvbjpvcGFjaXR5IDAuMXMgbGluZWFyO3RyYW5zaXRpb246b3BhY2l0eSAwLjFzIGxpbmVhcn0uZGcubWFpbi50YWxsZXItdGhhbi13aW5kb3d7b3ZlcmZsb3cteTphdXRvfS5kZy5tYWluLnRhbGxlci10aGFuLXdpbmRvdyAuY2xvc2UtYnV0dG9ue29wYWNpdHk6MTttYXJnaW4tdG9wOi0xcHg7Ym9yZGVyLXRvcDoxcHggc29saWQgIzJjMmMyY30uZGcubWFpbiB1bC5jbG9zZWQgLmNsb3NlLWJ1dHRvbntvcGFjaXR5OjEgIWltcG9ydGFudH0uZGcubWFpbjpob3ZlciAuY2xvc2UtYnV0dG9uLC5kZy5tYWluIC5jbG9zZS1idXR0b24uZHJhZ3tvcGFjaXR5OjF9LmRnLm1haW4gLmNsb3NlLWJ1dHRvbnstd2Via2l0LXRyYW5zaXRpb246b3BhY2l0eSAwLjFzIGxpbmVhcjstby10cmFuc2l0aW9uOm9wYWNpdHkgMC4xcyBsaW5lYXI7LW1vei10cmFuc2l0aW9uOm9wYWNpdHkgMC4xcyBsaW5lYXI7dHJhbnNpdGlvbjpvcGFjaXR5IDAuMXMgbGluZWFyO2JvcmRlcjowO3Bvc2l0aW9uOmFic29sdXRlO2xpbmUtaGVpZ2h0OjE5cHg7aGVpZ2h0OjIwcHg7Y3Vyc29yOnBvaW50ZXI7dGV4dC1hbGlnbjpjZW50ZXI7YmFja2dyb3VuZC1jb2xvcjojMDAwfS5kZy5tYWluIC5jbG9zZS1idXR0b246aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojMTExfS5kZy5he2Zsb2F0OnJpZ2h0O21hcmdpbi1yaWdodDoxNXB4O292ZXJmbG93LXg6aGlkZGVufS5kZy5hLmhhcy1zYXZlIHVse21hcmdpbi10b3A6MjdweH0uZGcuYS5oYXMtc2F2ZSB1bC5jbG9zZWR7bWFyZ2luLXRvcDowfS5kZy5hIC5zYXZlLXJvd3twb3NpdGlvbjpmaXhlZDt0b3A6MDt6LWluZGV4OjEwMDJ9LmRnIGxpey13ZWJraXQtdHJhbnNpdGlvbjpoZWlnaHQgMC4xcyBlYXNlLW91dDstby10cmFuc2l0aW9uOmhlaWdodCAwLjFzIGVhc2Utb3V0Oy1tb3otdHJhbnNpdGlvbjpoZWlnaHQgMC4xcyBlYXNlLW91dDt0cmFuc2l0aW9uOmhlaWdodCAwLjFzIGVhc2Utb3V0fS5kZyBsaTpub3QoLmZvbGRlcil7Y3Vyc29yOmF1dG87aGVpZ2h0OjI3cHg7bGluZS1oZWlnaHQ6MjdweDtvdmVyZmxvdzpoaWRkZW47cGFkZGluZzowIDRweCAwIDVweH0uZGcgbGkuZm9sZGVye3BhZGRpbmc6MDtib3JkZXItbGVmdDo0cHggc29saWQgcmdiYSgwLDAsMCwwKX0uZGcgbGkudGl0bGV7Y3Vyc29yOnBvaW50ZXI7bWFyZ2luLWxlZnQ6LTRweH0uZGcgLmNsb3NlZCBsaTpub3QoLnRpdGxlKSwuZGcgLmNsb3NlZCB1bCBsaSwuZGcgLmNsb3NlZCB1bCBsaSA+ICp7aGVpZ2h0OjA7b3ZlcmZsb3c6aGlkZGVuO2JvcmRlcjowfS5kZyAuY3J7Y2xlYXI6Ym90aDtwYWRkaW5nLWxlZnQ6M3B4O2hlaWdodDoyN3B4fS5kZyAucHJvcGVydHktbmFtZXtjdXJzb3I6ZGVmYXVsdDtmbG9hdDpsZWZ0O2NsZWFyOmxlZnQ7d2lkdGg6NDAlO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzfS5kZyAuY3tmbG9hdDpsZWZ0O3dpZHRoOjYwJX0uZGcgLmMgaW5wdXRbdHlwZT10ZXh0XXtib3JkZXI6MDttYXJnaW4tdG9wOjRweDtwYWRkaW5nOjNweDt3aWR0aDoxMDAlO2Zsb2F0OnJpZ2h0fS5kZyAuaGFzLXNsaWRlciBpbnB1dFt0eXBlPXRleHRde3dpZHRoOjMwJTttYXJnaW4tbGVmdDowfS5kZyAuc2xpZGVye2Zsb2F0OmxlZnQ7d2lkdGg6NjYlO21hcmdpbi1sZWZ0Oi01cHg7bWFyZ2luLXJpZ2h0OjA7aGVpZ2h0OjE5cHg7bWFyZ2luLXRvcDo0cHh9LmRnIC5zbGlkZXItZmd7aGVpZ2h0OjEwMCV9LmRnIC5jIGlucHV0W3R5cGU9Y2hlY2tib3hde21hcmdpbi10b3A6OXB4fS5kZyAuYyBzZWxlY3R7bWFyZ2luLXRvcDo1cHh9LmRnIC5jci5mdW5jdGlvbiwuZGcgLmNyLmZ1bmN0aW9uIC5wcm9wZXJ0eS1uYW1lLC5kZyAuY3IuZnVuY3Rpb24gKiwuZGcgLmNyLmJvb2xlYW4sLmRnIC5jci5ib29sZWFuICp7Y3Vyc29yOnBvaW50ZXJ9LmRnIC5zZWxlY3RvcntkaXNwbGF5Om5vbmU7cG9zaXRpb246YWJzb2x1dGU7bWFyZ2luLWxlZnQ6LTlweDttYXJnaW4tdG9wOjIzcHg7ei1pbmRleDoxMH0uZGcgLmM6aG92ZXIgLnNlbGVjdG9yLC5kZyAuc2VsZWN0b3IuZHJhZ3tkaXNwbGF5OmJsb2NrfS5kZyBsaS5zYXZlLXJvd3twYWRkaW5nOjB9LmRnIGxpLnNhdmUtcm93IC5idXR0b257ZGlzcGxheTppbmxpbmUtYmxvY2s7cGFkZGluZzowcHggNnB4fS5kZy5kaWFsb2d1ZXtiYWNrZ3JvdW5kLWNvbG9yOiMyMjI7d2lkdGg6NDYwcHg7cGFkZGluZzoxNXB4O2ZvbnQtc2l6ZToxM3B4O2xpbmUtaGVpZ2h0OjE1cHh9I2RnLW5ldy1jb25zdHJ1Y3RvcntwYWRkaW5nOjEwcHg7Y29sb3I6IzIyMjtmb250LWZhbWlseTpNb25hY28sIG1vbm9zcGFjZTtmb250LXNpemU6MTBweDtib3JkZXI6MDtyZXNpemU6bm9uZTtib3gtc2hhZG93Omluc2V0IDFweCAxcHggMXB4ICM4ODg7d29yZC13cmFwOmJyZWFrLXdvcmQ7bWFyZ2luOjEycHggMDtkaXNwbGF5OmJsb2NrO3dpZHRoOjQ0MHB4O292ZXJmbG93LXk6c2Nyb2xsO2hlaWdodDoxMDBweDtwb3NpdGlvbjpyZWxhdGl2ZX0jZGctbG9jYWwtZXhwbGFpbntkaXNwbGF5Om5vbmU7Zm9udC1zaXplOjExcHg7bGluZS1oZWlnaHQ6MTdweDtib3JkZXItcmFkaXVzOjNweDtiYWNrZ3JvdW5kLWNvbG9yOiMzMzM7cGFkZGluZzo4cHg7bWFyZ2luLXRvcDoxMHB4fSNkZy1sb2NhbC1leHBsYWluIGNvZGV7Zm9udC1zaXplOjEwcHh9I2RhdC1ndWktc2F2ZS1sb2NhbGx5e2Rpc3BsYXk6bm9uZX0uZGd7Y29sb3I6I2VlZTtmb250OjExcHggJ0x1Y2lkYSBHcmFuZGUnLCBzYW5zLXNlcmlmO3RleHQtc2hhZG93OjAgLTFweCAwICMxMTF9LmRnLm1haW46Oi13ZWJraXQtc2Nyb2xsYmFye3dpZHRoOjVweDtiYWNrZ3JvdW5kOiMxYTFhMWF9LmRnLm1haW46Oi13ZWJraXQtc2Nyb2xsYmFyLWNvcm5lcntoZWlnaHQ6MDtkaXNwbGF5Om5vbmV9LmRnLm1haW46Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1ie2JvcmRlci1yYWRpdXM6NXB4O2JhY2tncm91bmQ6IzY3Njc2N30uZGcgbGk6bm90KC5mb2xkZXIpe2JhY2tncm91bmQ6IzFhMWExYTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjMmMyYzJjfS5kZyBsaS5zYXZlLXJvd3tsaW5lLWhlaWdodDoyNXB4O2JhY2tncm91bmQ6I2RhZDVjYjtib3JkZXI6MH0uZGcgbGkuc2F2ZS1yb3cgc2VsZWN0e21hcmdpbi1sZWZ0OjVweDt3aWR0aDoxMDhweH0uZGcgbGkuc2F2ZS1yb3cgLmJ1dHRvbnttYXJnaW4tbGVmdDo1cHg7bWFyZ2luLXRvcDoxcHg7Ym9yZGVyLXJhZGl1czoycHg7Zm9udC1zaXplOjlweDtsaW5lLWhlaWdodDo3cHg7cGFkZGluZzo0cHggNHB4IDVweCA0cHg7YmFja2dyb3VuZDojYzViZGFkO2NvbG9yOiNmZmY7dGV4dC1zaGFkb3c6MCAxcHggMCAjYjBhNThmO2JveC1zaGFkb3c6MCAtMXB4IDAgI2IwYTU4ZjtjdXJzb3I6cG9pbnRlcn0uZGcgbGkuc2F2ZS1yb3cgLmJ1dHRvbi5nZWFyc3tiYWNrZ3JvdW5kOiNjNWJkYWQgdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQXNBQUFBTkNBWUFBQUIvOVpRN0FBQUFHWFJGV0hSVGIyWjBkMkZ5WlFCQlpHOWlaU0JKYldGblpWSmxZV1I1Y2NsbFBBQUFBUUpKUkVGVWVOcGlZS0FVL1AvL1B3R0lDL0FwQ0FCaUJTQVcrSThBQ2xBY2dLeFE0VDlob01BRVVyeHgyUVNHTjYrZWdEWCsvdldUNGU3TjgyQU1Zb1BBeC9ldndXb1lvU1liQUNYMnM3S3hDeHpjc2V6RGgzZXZGb0RFQllURUVxeWNnZ1dBekE5QXVVU1FRZ2VZUGE5ZlB2Ni9ZV20vQWN4NUlQYjd0eS9mdytRWmJsdzY3dkRzOFIwWUh5UWhnT2J4K3lBSmtCcW1HNWRQUERoMWFQT0dSL2V1Z1cwRzR2bElvVElmeUZjQStRZWtoaEhKaFBkUXhiaUFJZ3VNQlRRWnJQRDcxMDhNNnJvV1lERlFpSUFBdjZBb3cvMWJGd1hnaXMrZjJMVUF5bndvSWFOY3o4WE54M0RsN01FSlVER1FweDlndFE4WUN1ZUIrRDI2T0VDQUFRRGFkdDdlNDZENDJRQUFBQUJKUlU1RXJrSmdnZz09KSAycHggMXB4IG5vLXJlcGVhdDtoZWlnaHQ6N3B4O3dpZHRoOjhweH0uZGcgbGkuc2F2ZS1yb3cgLmJ1dHRvbjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiNiYWIxOWU7Ym94LXNoYWRvdzowIC0xcHggMCAjYjBhNThmfS5kZyBsaS5mb2xkZXJ7Ym9yZGVyLWJvdHRvbTowfS5kZyBsaS50aXRsZXtwYWRkaW5nLWxlZnQ6MTZweDtiYWNrZ3JvdW5kOiMwMDAgdXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEJRQUZBSkVBQVAvLy8vUHo4Ly8vLy8vLy95SDVCQUVBQUFJQUxBQUFBQUFGQUFVQUFBSUlsSStoS2dGeG9DZ0FPdz09KSA2cHggMTBweCBuby1yZXBlYXQ7Y3Vyc29yOnBvaW50ZXI7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjIpfS5kZyAuY2xvc2VkIGxpLnRpdGxle2JhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEJRQUZBSkVBQVAvLy8vUHo4Ly8vLy8vLy95SDVCQUVBQUFJQUxBQUFBQUFGQUFVQUFBSUlsR0lXcU1DYldBRUFPdz09KX0uZGcgLmNyLmJvb2xlYW57Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICM4MDY3ODd9LmRnIC5jci5mdW5jdGlvbntib3JkZXItbGVmdDozcHggc29saWQgI2U2MWQ1Zn0uZGcgLmNyLm51bWJlcntib3JkZXItbGVmdDozcHggc29saWQgIzJmYTFkNn0uZGcgLmNyLm51bWJlciBpbnB1dFt0eXBlPXRleHRde2NvbG9yOiMyZmExZDZ9LmRnIC5jci5zdHJpbmd7Ym9yZGVyLWxlZnQ6M3B4IHNvbGlkICMxZWQzNmZ9LmRnIC5jci5zdHJpbmcgaW5wdXRbdHlwZT10ZXh0XXtjb2xvcjojMWVkMzZmfS5kZyAuY3IuZnVuY3Rpb246aG92ZXIsLmRnIC5jci5ib29sZWFuOmhvdmVye2JhY2tncm91bmQ6IzExMX0uZGcgLmMgaW5wdXRbdHlwZT10ZXh0XXtiYWNrZ3JvdW5kOiMzMDMwMzA7b3V0bGluZTpub25lfS5kZyAuYyBpbnB1dFt0eXBlPXRleHRdOmhvdmVye2JhY2tncm91bmQ6IzNjM2MzY30uZGcgLmMgaW5wdXRbdHlwZT10ZXh0XTpmb2N1c3tiYWNrZ3JvdW5kOiM0OTQ5NDk7Y29sb3I6I2ZmZn0uZGcgLmMgLnNsaWRlcntiYWNrZ3JvdW5kOiMzMDMwMzA7Y3Vyc29yOmV3LXJlc2l6ZX0uZGcgLmMgLnNsaWRlci1mZ3tiYWNrZ3JvdW5kOiMyZmExZDZ9LmRnIC5jIC5zbGlkZXI6aG92ZXJ7YmFja2dyb3VuZDojM2MzYzNjfS5kZyAuYyAuc2xpZGVyOmhvdmVyIC5zbGlkZXItZmd7YmFja2dyb3VuZDojNDRhYmRhfVxuIiwKZGF0LmNvbnRyb2xsZXJzLmZhY3Rvcnk9ZnVuY3Rpb24oZSxhLGMsZCxmLGIsbil7cmV0dXJuIGZ1bmN0aW9uKGgsaixtLGwpe3ZhciBvPWhbal07aWYobi5pc0FycmF5KG0pfHxuLmlzT2JqZWN0KG0pKXJldHVybiBuZXcgZShoLGosbSk7aWYobi5pc051bWJlcihvKSlyZXR1cm4gbi5pc051bWJlcihtKSYmbi5pc051bWJlcihsKT9uZXcgYyhoLGosbSxsKTpuZXcgYShoLGose21pbjptLG1heDpsfSk7aWYobi5pc1N0cmluZyhvKSlyZXR1cm4gbmV3IGQoaCxqKTtpZihuLmlzRnVuY3Rpb24obykpcmV0dXJuIG5ldyBmKGgsaiwiIik7aWYobi5pc0Jvb2xlYW4obykpcmV0dXJuIG5ldyBiKGgsail9fShkYXQuY29udHJvbGxlcnMuT3B0aW9uQ29udHJvbGxlcixkYXQuY29udHJvbGxlcnMuTnVtYmVyQ29udHJvbGxlckJveCxkYXQuY29udHJvbGxlcnMuTnVtYmVyQ29udHJvbGxlclNsaWRlcixkYXQuY29udHJvbGxlcnMuU3RyaW5nQ29udHJvbGxlcj1mdW5jdGlvbihlLGEsYyl7dmFyIGQ9CmZ1bmN0aW9uKGMsYil7ZnVuY3Rpb24gZSgpe2guc2V0VmFsdWUoaC5fX2lucHV0LnZhbHVlKX1kLnN1cGVyY2xhc3MuY2FsbCh0aGlzLGMsYik7dmFyIGg9dGhpczt0aGlzLl9faW5wdXQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTt0aGlzLl9faW5wdXQuc2V0QXR0cmlidXRlKCJ0eXBlIiwidGV4dCIpO2EuYmluZCh0aGlzLl9faW5wdXQsImtleXVwIixlKTthLmJpbmQodGhpcy5fX2lucHV0LCJjaGFuZ2UiLGUpO2EuYmluZCh0aGlzLl9faW5wdXQsImJsdXIiLGZ1bmN0aW9uKCl7aC5fX29uRmluaXNoQ2hhbmdlJiZoLl9fb25GaW5pc2hDaGFuZ2UuY2FsbChoLGguZ2V0VmFsdWUoKSl9KTthLmJpbmQodGhpcy5fX2lucHV0LCJrZXlkb3duIixmdW5jdGlvbihhKXthLmtleUNvZGU9PT0xMyYmdGhpcy5ibHVyKCl9KTt0aGlzLnVwZGF0ZURpc3BsYXkoKTt0aGlzLmRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fX2lucHV0KX07ZC5zdXBlcmNsYXNzPWU7Yy5leHRlbmQoZC5wcm90b3R5cGUsCmUucHJvdG90eXBlLHt1cGRhdGVEaXNwbGF5OmZ1bmN0aW9uKCl7aWYoIWEuaXNBY3RpdmUodGhpcy5fX2lucHV0KSl0aGlzLl9faW5wdXQudmFsdWU9dGhpcy5nZXRWYWx1ZSgpO3JldHVybiBkLnN1cGVyY2xhc3MucHJvdG90eXBlLnVwZGF0ZURpc3BsYXkuY2FsbCh0aGlzKX19KTtyZXR1cm4gZH0oZGF0LmNvbnRyb2xsZXJzLkNvbnRyb2xsZXIsZGF0LmRvbS5kb20sZGF0LnV0aWxzLmNvbW1vbiksZGF0LmNvbnRyb2xsZXJzLkZ1bmN0aW9uQ29udHJvbGxlcixkYXQuY29udHJvbGxlcnMuQm9vbGVhbkNvbnRyb2xsZXIsZGF0LnV0aWxzLmNvbW1vbiksZGF0LmNvbnRyb2xsZXJzLkNvbnRyb2xsZXIsZGF0LmNvbnRyb2xsZXJzLkJvb2xlYW5Db250cm9sbGVyLGRhdC5jb250cm9sbGVycy5GdW5jdGlvbkNvbnRyb2xsZXIsZGF0LmNvbnRyb2xsZXJzLk51bWJlckNvbnRyb2xsZXJCb3gsZGF0LmNvbnRyb2xsZXJzLk51bWJlckNvbnRyb2xsZXJTbGlkZXIsZGF0LmNvbnRyb2xsZXJzLk9wdGlvbkNvbnRyb2xsZXIsCmRhdC5jb250cm9sbGVycy5Db2xvckNvbnRyb2xsZXI9ZnVuY3Rpb24oZSxhLGMsZCxmKXtmdW5jdGlvbiBiKGEsYixjLGQpe2Euc3R5bGUuYmFja2dyb3VuZD0iIjtmLmVhY2goaixmdW5jdGlvbihlKXthLnN0eWxlLmNzc1RleHQrPSJiYWNrZ3JvdW5kOiAiK2UrImxpbmVhci1ncmFkaWVudCgiK2IrIiwgIitjKyIgMCUsICIrZCsiIDEwMCUpOyAifSl9ZnVuY3Rpb24gbihhKXthLnN0eWxlLmJhY2tncm91bmQ9IiI7YS5zdHlsZS5jc3NUZXh0Kz0iYmFja2dyb3VuZDogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAgI2ZmMDAwMCAwJSwgI2ZmMDBmZiAxNyUsICMwMDAwZmYgMzQlLCAjMDBmZmZmIDUwJSwgIzAwZmYwMCA2NyUsICNmZmZmMDAgODQlLCAjZmYwMDAwIDEwMCUpOyI7YS5zdHlsZS5jc3NUZXh0Kz0iYmFja2dyb3VuZDogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQodG9wLCAgI2ZmMDAwMCAwJSwjZmYwMGZmIDE3JSwjMDAwMGZmIDM0JSwjMDBmZmZmIDUwJSwjMDBmZjAwIDY3JSwjZmZmZjAwIDg0JSwjZmYwMDAwIDEwMCUpOyI7CmEuc3R5bGUuY3NzVGV4dCs9ImJhY2tncm91bmQ6IC1vLWxpbmVhci1ncmFkaWVudCh0b3AsICAjZmYwMDAwIDAlLCNmZjAwZmYgMTclLCMwMDAwZmYgMzQlLCMwMGZmZmYgNTAlLCMwMGZmMDAgNjclLCNmZmZmMDAgODQlLCNmZjAwMDAgMTAwJSk7IjthLnN0eWxlLmNzc1RleHQrPSJiYWNrZ3JvdW5kOiAtbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgICNmZjAwMDAgMCUsI2ZmMDBmZiAxNyUsIzAwMDBmZiAzNCUsIzAwZmZmZiA1MCUsIzAwZmYwMCA2NyUsI2ZmZmYwMCA4NCUsI2ZmMDAwMCAxMDAlKTsiO2Euc3R5bGUuY3NzVGV4dCs9ImJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0b3AsICAjZmYwMDAwIDAlLCNmZjAwZmYgMTclLCMwMDAwZmYgMzQlLCMwMGZmZmYgNTAlLCMwMGZmMDAgNjclLCNmZmZmMDAgODQlLCNmZjAwMDAgMTAwJSk7In12YXIgaD1mdW5jdGlvbihlLGwpe2Z1bmN0aW9uIG8oYil7cShiKTthLmJpbmQod2luZG93LCJtb3VzZW1vdmUiLHEpO2EuYmluZCh3aW5kb3csCiJtb3VzZXVwIixqKX1mdW5jdGlvbiBqKCl7YS51bmJpbmQod2luZG93LCJtb3VzZW1vdmUiLHEpO2EudW5iaW5kKHdpbmRvdywibW91c2V1cCIsail9ZnVuY3Rpb24gZygpe3ZhciBhPWQodGhpcy52YWx1ZSk7YSE9PWZhbHNlPyhwLl9fY29sb3IuX19zdGF0ZT1hLHAuc2V0VmFsdWUocC5fX2NvbG9yLnRvT3JpZ2luYWwoKSkpOnRoaXMudmFsdWU9cC5fX2NvbG9yLnRvU3RyaW5nKCl9ZnVuY3Rpb24gaSgpe2EudW5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixzKTthLnVuYmluZCh3aW5kb3csIm1vdXNldXAiLGkpfWZ1bmN0aW9uIHEoYil7Yi5wcmV2ZW50RGVmYXVsdCgpO3ZhciBjPWEuZ2V0V2lkdGgocC5fX3NhdHVyYXRpb25fZmllbGQpLGQ9YS5nZXRPZmZzZXQocC5fX3NhdHVyYXRpb25fZmllbGQpLGU9KGIuY2xpZW50WC1kLmxlZnQrZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0KS9jLGI9MS0oYi5jbGllbnRZLWQudG9wK2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKS9jO2I+MT9iPQoxOmI8MCYmKGI9MCk7ZT4xP2U9MTplPDAmJihlPTApO3AuX19jb2xvci52PWI7cC5fX2NvbG9yLnM9ZTtwLnNldFZhbHVlKHAuX19jb2xvci50b09yaWdpbmFsKCkpO3JldHVybiBmYWxzZX1mdW5jdGlvbiBzKGIpe2IucHJldmVudERlZmF1bHQoKTt2YXIgYz1hLmdldEhlaWdodChwLl9faHVlX2ZpZWxkKSxkPWEuZ2V0T2Zmc2V0KHAuX19odWVfZmllbGQpLGI9MS0oYi5jbGllbnRZLWQudG9wK2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKS9jO2I+MT9iPTE6YjwwJiYoYj0wKTtwLl9fY29sb3IuaD1iKjM2MDtwLnNldFZhbHVlKHAuX19jb2xvci50b09yaWdpbmFsKCkpO3JldHVybiBmYWxzZX1oLnN1cGVyY2xhc3MuY2FsbCh0aGlzLGUsbCk7dGhpcy5fX2NvbG9yPW5ldyBjKHRoaXMuZ2V0VmFsdWUoKSk7dGhpcy5fX3RlbXA9bmV3IGMoMCk7dmFyIHA9dGhpczt0aGlzLmRvbUVsZW1lbnQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7YS5tYWtlU2VsZWN0YWJsZSh0aGlzLmRvbUVsZW1lbnQsCmZhbHNlKTt0aGlzLl9fc2VsZWN0b3I9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dGhpcy5fX3NlbGVjdG9yLmNsYXNzTmFtZT0ic2VsZWN0b3IiO3RoaXMuX19zYXR1cmF0aW9uX2ZpZWxkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3RoaXMuX19zYXR1cmF0aW9uX2ZpZWxkLmNsYXNzTmFtZT0ic2F0dXJhdGlvbi1maWVsZCI7dGhpcy5fX2ZpZWxkX2tub2I9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dGhpcy5fX2ZpZWxkX2tub2IuY2xhc3NOYW1lPSJmaWVsZC1rbm9iIjt0aGlzLl9fZmllbGRfa25vYl9ib3JkZXI9IjJweCBzb2xpZCAiO3RoaXMuX19odWVfa25vYj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLl9faHVlX2tub2IuY2xhc3NOYW1lPSJodWUta25vYiI7dGhpcy5fX2h1ZV9maWVsZD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt0aGlzLl9faHVlX2ZpZWxkLmNsYXNzTmFtZT0iaHVlLWZpZWxkIjt0aGlzLl9faW5wdXQ9CmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7dGhpcy5fX2lucHV0LnR5cGU9InRleHQiO3RoaXMuX19pbnB1dF90ZXh0U2hhZG93PSIwIDFweCAxcHggIjthLmJpbmQodGhpcy5fX2lucHV0LCJrZXlkb3duIixmdW5jdGlvbihhKXthLmtleUNvZGU9PT0xMyYmZy5jYWxsKHRoaXMpfSk7YS5iaW5kKHRoaXMuX19pbnB1dCwiYmx1ciIsZyk7YS5iaW5kKHRoaXMuX19zZWxlY3RvciwibW91c2Vkb3duIixmdW5jdGlvbigpe2EuYWRkQ2xhc3ModGhpcywiZHJhZyIpLmJpbmQod2luZG93LCJtb3VzZXVwIixmdW5jdGlvbigpe2EucmVtb3ZlQ2xhc3MocC5fX3NlbGVjdG9yLCJkcmFnIil9KX0pO3ZhciB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2YuZXh0ZW5kKHRoaXMuX19zZWxlY3Rvci5zdHlsZSx7d2lkdGg6IjEyMnB4IixoZWlnaHQ6IjEwMnB4IixwYWRkaW5nOiIzcHgiLGJhY2tncm91bmRDb2xvcjoiIzIyMiIsYm94U2hhZG93OiIwcHggMXB4IDNweCByZ2JhKDAsMCwwLDAuMykifSk7CmYuZXh0ZW5kKHRoaXMuX19maWVsZF9rbm9iLnN0eWxlLHtwb3NpdGlvbjoiYWJzb2x1dGUiLHdpZHRoOiIxMnB4IixoZWlnaHQ6IjEycHgiLGJvcmRlcjp0aGlzLl9fZmllbGRfa25vYl9ib3JkZXIrKHRoaXMuX19jb2xvci52PDAuNT8iI2ZmZiI6IiMwMDAiKSxib3hTaGFkb3c6IjBweCAxcHggM3B4IHJnYmEoMCwwLDAsMC41KSIsYm9yZGVyUmFkaXVzOiIxMnB4Iix6SW5kZXg6MX0pO2YuZXh0ZW5kKHRoaXMuX19odWVfa25vYi5zdHlsZSx7cG9zaXRpb246ImFic29sdXRlIix3aWR0aDoiMTVweCIsaGVpZ2h0OiIycHgiLGJvcmRlclJpZ2h0OiI0cHggc29saWQgI2ZmZiIsekluZGV4OjF9KTtmLmV4dGVuZCh0aGlzLl9fc2F0dXJhdGlvbl9maWVsZC5zdHlsZSx7d2lkdGg6IjEwMHB4IixoZWlnaHQ6IjEwMHB4Iixib3JkZXI6IjFweCBzb2xpZCAjNTU1IixtYXJnaW5SaWdodDoiM3B4IixkaXNwbGF5OiJpbmxpbmUtYmxvY2siLGN1cnNvcjoicG9pbnRlciJ9KTtmLmV4dGVuZCh0LnN0eWxlLAp7d2lkdGg6IjEwMCUiLGhlaWdodDoiMTAwJSIsYmFja2dyb3VuZDoibm9uZSJ9KTtiKHQsInRvcCIsInJnYmEoMCwwLDAsMCkiLCIjMDAwIik7Zi5leHRlbmQodGhpcy5fX2h1ZV9maWVsZC5zdHlsZSx7d2lkdGg6IjE1cHgiLGhlaWdodDoiMTAwcHgiLGRpc3BsYXk6ImlubGluZS1ibG9jayIsYm9yZGVyOiIxcHggc29saWQgIzU1NSIsY3Vyc29yOiJucy1yZXNpemUifSk7bih0aGlzLl9faHVlX2ZpZWxkKTtmLmV4dGVuZCh0aGlzLl9faW5wdXQuc3R5bGUse291dGxpbmU6Im5vbmUiLHRleHRBbGlnbjoiY2VudGVyIixjb2xvcjoiI2ZmZiIsYm9yZGVyOjAsZm9udFdlaWdodDoiYm9sZCIsdGV4dFNoYWRvdzp0aGlzLl9faW5wdXRfdGV4dFNoYWRvdysicmdiYSgwLDAsMCwwLjcpIn0pO2EuYmluZCh0aGlzLl9fc2F0dXJhdGlvbl9maWVsZCwibW91c2Vkb3duIixvKTthLmJpbmQodGhpcy5fX2ZpZWxkX2tub2IsIm1vdXNlZG93biIsbyk7YS5iaW5kKHRoaXMuX19odWVfZmllbGQsIm1vdXNlZG93biIsCmZ1bmN0aW9uKGIpe3MoYik7YS5iaW5kKHdpbmRvdywibW91c2Vtb3ZlIixzKTthLmJpbmQod2luZG93LCJtb3VzZXVwIixpKX0pO3RoaXMuX19zYXR1cmF0aW9uX2ZpZWxkLmFwcGVuZENoaWxkKHQpO3RoaXMuX19zZWxlY3Rvci5hcHBlbmRDaGlsZCh0aGlzLl9fZmllbGRfa25vYik7dGhpcy5fX3NlbGVjdG9yLmFwcGVuZENoaWxkKHRoaXMuX19zYXR1cmF0aW9uX2ZpZWxkKTt0aGlzLl9fc2VsZWN0b3IuYXBwZW5kQ2hpbGQodGhpcy5fX2h1ZV9maWVsZCk7dGhpcy5fX2h1ZV9maWVsZC5hcHBlbmRDaGlsZCh0aGlzLl9faHVlX2tub2IpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9faW5wdXQpO3RoaXMuZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9fc2VsZWN0b3IpO3RoaXMudXBkYXRlRGlzcGxheSgpfTtoLnN1cGVyY2xhc3M9ZTtmLmV4dGVuZChoLnByb3RvdHlwZSxlLnByb3RvdHlwZSx7dXBkYXRlRGlzcGxheTpmdW5jdGlvbigpe3ZhciBhPWQodGhpcy5nZXRWYWx1ZSgpKTsKaWYoYSE9PWZhbHNlKXt2YXIgZT1mYWxzZTtmLmVhY2goYy5DT01QT05FTlRTLGZ1bmN0aW9uKGIpe2lmKCFmLmlzVW5kZWZpbmVkKGFbYl0pJiYhZi5pc1VuZGVmaW5lZCh0aGlzLl9fY29sb3IuX19zdGF0ZVtiXSkmJmFbYl0hPT10aGlzLl9fY29sb3IuX19zdGF0ZVtiXSlyZXR1cm4gZT10cnVlLHt9fSx0aGlzKTtlJiZmLmV4dGVuZCh0aGlzLl9fY29sb3IuX19zdGF0ZSxhKX1mLmV4dGVuZCh0aGlzLl9fdGVtcC5fX3N0YXRlLHRoaXMuX19jb2xvci5fX3N0YXRlKTt0aGlzLl9fdGVtcC5hPTE7dmFyIGg9dGhpcy5fX2NvbG9yLnY8MC41fHx0aGlzLl9fY29sb3Iucz4wLjU/MjU1OjAsaj0yNTUtaDtmLmV4dGVuZCh0aGlzLl9fZmllbGRfa25vYi5zdHlsZSx7bWFyZ2luTGVmdDoxMDAqdGhpcy5fX2NvbG9yLnMtNysicHgiLG1hcmdpblRvcDoxMDAqKDEtdGhpcy5fX2NvbG9yLnYpLTcrInB4IixiYWNrZ3JvdW5kQ29sb3I6dGhpcy5fX3RlbXAudG9TdHJpbmcoKSxib3JkZXI6dGhpcy5fX2ZpZWxkX2tub2JfYm9yZGVyKwoicmdiKCIraCsiLCIraCsiLCIraCsiKSJ9KTt0aGlzLl9faHVlX2tub2Iuc3R5bGUubWFyZ2luVG9wPSgxLXRoaXMuX19jb2xvci5oLzM2MCkqMTAwKyJweCI7dGhpcy5fX3RlbXAucz0xO3RoaXMuX190ZW1wLnY9MTtiKHRoaXMuX19zYXR1cmF0aW9uX2ZpZWxkLCJsZWZ0IiwiI2ZmZiIsdGhpcy5fX3RlbXAudG9TdHJpbmcoKSk7Zi5leHRlbmQodGhpcy5fX2lucHV0LnN0eWxlLHtiYWNrZ3JvdW5kQ29sb3I6dGhpcy5fX2lucHV0LnZhbHVlPXRoaXMuX19jb2xvci50b1N0cmluZygpLGNvbG9yOiJyZ2IoIitoKyIsIitoKyIsIitoKyIpIix0ZXh0U2hhZG93OnRoaXMuX19pbnB1dF90ZXh0U2hhZG93KyJyZ2JhKCIraisiLCIraisiLCIraisiLC43KSJ9KX19KTt2YXIgaj1bIi1tb3otIiwiLW8tIiwiLXdlYmtpdC0iLCItbXMtIiwiIl07cmV0dXJuIGh9KGRhdC5jb250cm9sbGVycy5Db250cm9sbGVyLGRhdC5kb20uZG9tLGRhdC5jb2xvci5Db2xvcj1mdW5jdGlvbihlLGEsYyxkKXtmdW5jdGlvbiBmKGEsCmIsYyl7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsYix7Z2V0OmZ1bmN0aW9uKCl7aWYodGhpcy5fX3N0YXRlLnNwYWNlPT09IlJHQiIpcmV0dXJuIHRoaXMuX19zdGF0ZVtiXTtuKHRoaXMsYixjKTtyZXR1cm4gdGhpcy5fX3N0YXRlW2JdfSxzZXQ6ZnVuY3Rpb24oYSl7aWYodGhpcy5fX3N0YXRlLnNwYWNlIT09IlJHQiIpbih0aGlzLGIsYyksdGhpcy5fX3N0YXRlLnNwYWNlPSJSR0IiO3RoaXMuX19zdGF0ZVtiXT1hfX0pfWZ1bmN0aW9uIGIoYSxiKXtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxiLHtnZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLl9fc3RhdGUuc3BhY2U9PT0iSFNWIilyZXR1cm4gdGhpcy5fX3N0YXRlW2JdO2godGhpcyk7cmV0dXJuIHRoaXMuX19zdGF0ZVtiXX0sc2V0OmZ1bmN0aW9uKGEpe2lmKHRoaXMuX19zdGF0ZS5zcGFjZSE9PSJIU1YiKWgodGhpcyksdGhpcy5fX3N0YXRlLnNwYWNlPSJIU1YiO3RoaXMuX19zdGF0ZVtiXT1hfX0pfWZ1bmN0aW9uIG4oYixjLGUpe2lmKGIuX19zdGF0ZS5zcGFjZT09PQoiSEVYIiliLl9fc3RhdGVbY109YS5jb21wb25lbnRfZnJvbV9oZXgoYi5fX3N0YXRlLmhleCxlKTtlbHNlIGlmKGIuX19zdGF0ZS5zcGFjZT09PSJIU1YiKWQuZXh0ZW5kKGIuX19zdGF0ZSxhLmhzdl90b19yZ2IoYi5fX3N0YXRlLmgsYi5fX3N0YXRlLnMsYi5fX3N0YXRlLnYpKTtlbHNlIHRocm93IkNvcnJ1cHRlZCBjb2xvciBzdGF0ZSI7fWZ1bmN0aW9uIGgoYil7dmFyIGM9YS5yZ2JfdG9faHN2KGIucixiLmcsYi5iKTtkLmV4dGVuZChiLl9fc3RhdGUse3M6Yy5zLHY6Yy52fSk7aWYoZC5pc05hTihjLmgpKXtpZihkLmlzVW5kZWZpbmVkKGIuX19zdGF0ZS5oKSliLl9fc3RhdGUuaD0wfWVsc2UgYi5fX3N0YXRlLmg9Yy5ofXZhciBqPWZ1bmN0aW9uKCl7dGhpcy5fX3N0YXRlPWUuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKHRoaXMuX19zdGF0ZT09PWZhbHNlKXRocm93IkZhaWxlZCB0byBpbnRlcnByZXQgY29sb3IgYXJndW1lbnRzIjt0aGlzLl9fc3RhdGUuYT10aGlzLl9fc3RhdGUuYXx8CjF9O2ouQ09NUE9ORU5UUz0icixnLGIsaCxzLHYsaGV4LGEiLnNwbGl0KCIsIik7ZC5leHRlbmQoai5wcm90b3R5cGUse3RvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIGModGhpcyl9LHRvT3JpZ2luYWw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fX3N0YXRlLmNvbnZlcnNpb24ud3JpdGUodGhpcyl9fSk7ZihqLnByb3RvdHlwZSwiciIsMik7ZihqLnByb3RvdHlwZSwiZyIsMSk7ZihqLnByb3RvdHlwZSwiYiIsMCk7YihqLnByb3RvdHlwZSwiaCIpO2Ioai5wcm90b3R5cGUsInMiKTtiKGoucHJvdG90eXBlLCJ2Iik7T2JqZWN0LmRlZmluZVByb3BlcnR5KGoucHJvdG90eXBlLCJhIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX19zdGF0ZS5hfSxzZXQ6ZnVuY3Rpb24oYSl7dGhpcy5fX3N0YXRlLmE9YX19KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoai5wcm90b3R5cGUsImhleCIse2dldDpmdW5jdGlvbigpe2lmKCF0aGlzLl9fc3RhdGUuc3BhY2UhPT0iSEVYIil0aGlzLl9fc3RhdGUuaGV4PQphLnJnYl90b19oZXgodGhpcy5yLHRoaXMuZyx0aGlzLmIpO3JldHVybiB0aGlzLl9fc3RhdGUuaGV4fSxzZXQ6ZnVuY3Rpb24oYSl7dGhpcy5fX3N0YXRlLnNwYWNlPSJIRVgiO3RoaXMuX19zdGF0ZS5oZXg9YX19KTtyZXR1cm4gan0oZGF0LmNvbG9yLmludGVycHJldCxkYXQuY29sb3IubWF0aD1mdW5jdGlvbigpe3ZhciBlO3JldHVybntoc3ZfdG9fcmdiOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1hLzYwLU1hdGguZmxvb3IoYS82MCksYj1kKigxLWMpLG49ZCooMS1lKmMpLGM9ZCooMS0oMS1lKSpjKSxhPVtbZCxjLGJdLFtuLGQsYl0sW2IsZCxjXSxbYixuLGRdLFtjLGIsZF0sW2QsYixuXV1bTWF0aC5mbG9vcihhLzYwKSU2XTtyZXR1cm57cjphWzBdKjI1NSxnOmFbMV0qMjU1LGI6YVsyXSoyNTV9fSxyZ2JfdG9faHN2OmZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1NYXRoLm1pbihhLGMsZCksYj1NYXRoLm1heChhLGMsZCksZT1iLWU7aWYoYj09MClyZXR1cm57aDpOYU4sczowLHY6MH07CmE9YT09Yj8oYy1kKS9lOmM9PWI/MisoZC1hKS9lOjQrKGEtYykvZTthLz02O2E8MCYmKGErPTEpO3JldHVybntoOmEqMzYwLHM6ZS9iLHY6Yi8yNTV9fSxyZ2JfdG9faGV4OmZ1bmN0aW9uKGEsYyxkKXthPXRoaXMuaGV4X3dpdGhfY29tcG9uZW50KDAsMixhKTthPXRoaXMuaGV4X3dpdGhfY29tcG9uZW50KGEsMSxjKTtyZXR1cm4gYT10aGlzLmhleF93aXRoX2NvbXBvbmVudChhLDAsZCl9LGNvbXBvbmVudF9mcm9tX2hleDpmdW5jdGlvbihhLGMpe3JldHVybiBhPj5jKjgmMjU1fSxoZXhfd2l0aF9jb21wb25lbnQ6ZnVuY3Rpb24oYSxjLGQpe3JldHVybiBkPDwoZT1jKjgpfGEmfigyNTU8PGUpfX19KCksZGF0LmNvbG9yLnRvU3RyaW5nLGRhdC51dGlscy5jb21tb24pLGRhdC5jb2xvci5pbnRlcnByZXQsZGF0LnV0aWxzLmNvbW1vbiksZGF0LnV0aWxzLnJlcXVlc3RBbmltYXRpb25GcmFtZT1mdW5jdGlvbigpe3JldHVybiB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHwKd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZXx8d2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZXx8ZnVuY3Rpb24oZSl7d2luZG93LnNldFRpbWVvdXQoZSwxRTMvNjApfX0oKSxkYXQuZG9tLkNlbnRlcmVkRGl2PWZ1bmN0aW9uKGUsYSl7dmFyIGM9ZnVuY3Rpb24oKXt0aGlzLmJhY2tncm91bmRFbGVtZW50PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2EuZXh0ZW5kKHRoaXMuYmFja2dyb3VuZEVsZW1lbnQuc3R5bGUse2JhY2tncm91bmRDb2xvcjoicmdiYSgwLDAsMCwwLjgpIix0b3A6MCxsZWZ0OjAsZGlzcGxheToibm9uZSIsekluZGV4OiIxMDAwIixvcGFjaXR5OjAsV2Via2l0VHJhbnNpdGlvbjoib3BhY2l0eSAwLjJzIGxpbmVhciJ9KTtlLm1ha2VGdWxsc2NyZWVuKHRoaXMuYmFja2dyb3VuZEVsZW1lbnQpO3RoaXMuYmFja2dyb3VuZEVsZW1lbnQuc3R5bGUucG9zaXRpb249ImZpeGVkIjt0aGlzLmRvbUVsZW1lbnQ9CmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2EuZXh0ZW5kKHRoaXMuZG9tRWxlbWVudC5zdHlsZSx7cG9zaXRpb246ImZpeGVkIixkaXNwbGF5OiJub25lIix6SW5kZXg6IjEwMDEiLG9wYWNpdHk6MCxXZWJraXRUcmFuc2l0aW9uOiItd2Via2l0LXRyYW5zZm9ybSAwLjJzIGVhc2Utb3V0LCBvcGFjaXR5IDAuMnMgbGluZWFyIn0pO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5iYWNrZ3JvdW5kRWxlbWVudCk7ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmRvbUVsZW1lbnQpO3ZhciBjPXRoaXM7ZS5iaW5kKHRoaXMuYmFja2dyb3VuZEVsZW1lbnQsImNsaWNrIixmdW5jdGlvbigpe2MuaGlkZSgpfSl9O2MucHJvdG90eXBlLnNob3c9ZnVuY3Rpb24oKXt2YXIgYz10aGlzO3RoaXMuYmFja2dyb3VuZEVsZW1lbnQuc3R5bGUuZGlzcGxheT0iYmxvY2siO3RoaXMuZG9tRWxlbWVudC5zdHlsZS5kaXNwbGF5PSJibG9jayI7dGhpcy5kb21FbGVtZW50LnN0eWxlLm9wYWNpdHk9CjA7dGhpcy5kb21FbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybT0ic2NhbGUoMS4xKSI7dGhpcy5sYXlvdXQoKTthLmRlZmVyKGZ1bmN0aW9uKCl7Yy5iYWNrZ3JvdW5kRWxlbWVudC5zdHlsZS5vcGFjaXR5PTE7Yy5kb21FbGVtZW50LnN0eWxlLm9wYWNpdHk9MTtjLmRvbUVsZW1lbnQuc3R5bGUud2Via2l0VHJhbnNmb3JtPSJzY2FsZSgxKSJ9KX07Yy5wcm90b3R5cGUuaGlkZT1mdW5jdGlvbigpe3ZhciBhPXRoaXMsYz1mdW5jdGlvbigpe2EuZG9tRWxlbWVudC5zdHlsZS5kaXNwbGF5PSJub25lIjthLmJhY2tncm91bmRFbGVtZW50LnN0eWxlLmRpc3BsYXk9Im5vbmUiO2UudW5iaW5kKGEuZG9tRWxlbWVudCwid2Via2l0VHJhbnNpdGlvbkVuZCIsYyk7ZS51bmJpbmQoYS5kb21FbGVtZW50LCJ0cmFuc2l0aW9uZW5kIixjKTtlLnVuYmluZChhLmRvbUVsZW1lbnQsIm9UcmFuc2l0aW9uRW5kIixjKX07ZS5iaW5kKHRoaXMuZG9tRWxlbWVudCwid2Via2l0VHJhbnNpdGlvbkVuZCIsCmMpO2UuYmluZCh0aGlzLmRvbUVsZW1lbnQsInRyYW5zaXRpb25lbmQiLGMpO2UuYmluZCh0aGlzLmRvbUVsZW1lbnQsIm9UcmFuc2l0aW9uRW5kIixjKTt0aGlzLmJhY2tncm91bmRFbGVtZW50LnN0eWxlLm9wYWNpdHk9MDt0aGlzLmRvbUVsZW1lbnQuc3R5bGUub3BhY2l0eT0wO3RoaXMuZG9tRWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2Zvcm09InNjYWxlKDEuMSkifTtjLnByb3RvdHlwZS5sYXlvdXQ9ZnVuY3Rpb24oKXt0aGlzLmRvbUVsZW1lbnQuc3R5bGUubGVmdD13aW5kb3cuaW5uZXJXaWR0aC8yLWUuZ2V0V2lkdGgodGhpcy5kb21FbGVtZW50KS8yKyJweCI7dGhpcy5kb21FbGVtZW50LnN0eWxlLnRvcD13aW5kb3cuaW5uZXJIZWlnaHQvMi1lLmdldEhlaWdodCh0aGlzLmRvbUVsZW1lbnQpLzIrInB4In07cmV0dXJuIGN9KGRhdC5kb20uZG9tLGRhdC51dGlscy5jb21tb24pLGRhdC5kb20uZG9tLGRhdC51dGlscy5jb21tb24pOwooZnVuY3Rpb24oKXsKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyBNZXNoIFByb3BlcnRpZXMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHZhciBNRVNIID0gewogICAgd2lkdGg6IDEuMiwKICAgIGhlaWdodDogMS4yLAogICAgc2xpY2VzOiAyNTAsCiAgICBkZXB0aDogMCwKICAgIG1heGRlcHRoOiAyMDAsCiAgICBhbWJpZW50OiAnIzU1NTU1NScsCiAgICBkaWZmdXNlOiAnI0ZGRkZGRicKICB9OwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIExpZ2h0IFByb3BlcnRpZXMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHZhciBMSUdIVCA9IHsKICAgIGNvdW50OiAwLAogICAgeFBvcyA6IDAsCiAgICB5UG9zIDogMjAwLAogICAgek9mZnNldDogMTAwLAogICAgYW1iaWVudDogJyM4ODAwNjYnLAogICAgZGlmZnVzZTogJyNGRjg4MDAnLAogICAgcGlja2VkdXAgOnRydWUsCiAgICBwcm94eSA6IGZhbHNlLAogICAgY3VyckluZGV4IDogMCwKICAgIHJhbmRvbWl6ZSA6IGZ1bmN0aW9uKCl7CiAgICAgIHZhciB4LHksejsKICAgICAgdmFyIGRlY2lkZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzKSArIDE7CgogICAgICBpZiAoZGVjaWRlciA9PSAxKSBNRVNILmRlcHRoID0gMDsKICAgICAgaWYgKGRlY2lkZXIgPT0gMikgTUVTSC5kZXB0aCA9IE1hdGgucmFuZG9tSW5SYW5nZSgwLCAxNTApOwogICAgICBpZiAoZGVjaWRlciA9PSAzKSBNRVNILmRlcHRoID0gTWF0aC5yYW5kb21JblJhbmdlKDE1MCwgMjAwKTsKCiAgICAgIGZvciAobCA9IHNjZW5lLmxpZ2h0cy5sZW5ndGggLSAxOyBsID49IDA7IGwtLSkgewogICAgICAgIHggPSBNYXRoLnJhbmRvbUluUmFuZ2UoLW1lc2guZ2VvbWV0cnkud2lkdGgvMiwgbWVzaC5nZW9tZXRyeS53aWR0aC8yKTsKICAgICAgICB5ID0gTWF0aC5yYW5kb21JblJhbmdlKC1tZXNoLmdlb21ldHJ5LmhlaWdodC8yLCBtZXNoLmdlb21ldHJ5LmhlaWdodC8yKTsKICAgICAgICBpZihzY2VuZS5saWdodHMubGVuZ3RoID4gMikgeiA9IE1hdGgucmFuZG9tSW5SYW5nZSgxMCwgODApOwogICAgICAgIGVsc2UgeiA9IE1hdGgucmFuZG9tSW5SYW5nZSgxMCwgMTAwKTsKCiAgICAgICAgbGlnaHQgPSBzY2VuZS5saWdodHNbbF07CiAgICAgICAgRlNTLlZlY3RvcjMuc2V0KGxpZ2h0LnBvc2l0aW9uLCB4LCB5LCB6KTsKCiAgICAgICAgdmFyIGRpZmZ1c2UgPSBnZXRSYW5kb21Db2xvcigpOwogICAgICAgIHZhciBhbWJpZW50ID0gZ2V0UmFuZG9tQ29sb3IoKTsKCiAgICAgICAgbGlnaHQuZGlmZnVzZS5zZXQoZGlmZnVzZSk7CiAgICAgICAgbGlnaHQuZGlmZnVzZUhleCA9IGxpZ2h0LmRpZmZ1c2UuZm9ybWF0KCk7CgogICAgICAgIGxpZ2h0LmFtYmllbnQuc2V0KGFtYmllbnQpOwogICAgICAgIGxpZ2h0LmFtYmllbnRIZXggPSBsaWdodC5hbWJpZW50LmZvcm1hdCgpOwoKICAgICAgICBMSUdIVC54UG9zICAgID0geDsKICAgICAgICBMSUdIVC55UG9zICAgID0geTsKICAgICAgICBMSUdIVC56T2Zmc2V0ID0gejsKICAgICAgICBMSUdIVC5kaWZmdXNlID0gZGlmZnVzZTsKICAgICAgICBMSUdIVC5hbWJpZW50ID0gYW1iaWVudDsKCiAgICAgICAgLy8gSGFja3kgd2F5IHRvIGFsbG93IG1hbnVhbCB1cGRhdGUgb2YgdGhlIEhFWCBjb2xvcnMgZm9yIGxpZ2h0J3MgZGlmZnVzZQogICAgICAgIGd1aS5fX2ZvbGRlcnMuTGlnaHQuX19jb250cm9sbGVyc1sxXS51cGRhdGVEaXNwbGF5KCk7CiAgICAgICAgZ3VpLl9fZm9sZGVycy5MaWdodC5fX2NvbnRyb2xsZXJzWzJdLnVwZGF0ZURpc3BsYXkoKTsKICAgICAgfQogICAgfQogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gUmVuZGVyIFByb3BlcnRpZXMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHZhciBXRUJHTCA9ICd3ZWJnbCc7CiAgdmFyIENBTlZBUyA9ICdjYW52YXMnOwogIHZhciBTVkcgPSAnc3ZnJzsKICB2YXIgUkVOREVSID0gewogICAgcmVuZGVyZXI6IENBTlZBUwogIH07CgogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLy8gRXhwb3J0IFByb3BlcnRpZXMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIHZhciBFWFBPUlQgPSB7CiAgICB3aWR0aDogMjAwMCwKICAgIGhlaWdodDogMTAwMCwKCiAgICBleHBvcnRDdXJyZW50OiBmdW5jdGlvbigpewogICAgICBzd2l0Y2goUkVOREVSLnJlbmRlcmVyKSB7CiAgICAgICAgY2FzZSBXRUJHTDoKICAgICAgICAgIHdpbmRvdy5vcGVuKHdlYmdsUmVuZGVyZXIuZWxlbWVudC50b0RhdGFVUkwoKSwgJ19ibGFuaycpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBDQU5WQVM6CiAgICAgICAgICB3aW5kb3cub3BlbihjYW52YXNSZW5kZXJlci5lbGVtZW50LnRvRGF0YVVSTCgpLCAnX2JsYW5rJyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFNWRzoKICAgICAgICAgIHZhciBkYXRhID0gZW5jb2RlVVJJQ29tcG9uZW50KG91dHB1dC5pbm5lckhUTUwpOwogICAgICAgICAgdmFyIHVybCA9ICJkYXRhOmltYWdlL3N2Zyt4bWwsIiArIGRhdGE7CiAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgZXhwb3J0OiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGwsIHgsIHksIGxpZ2h0LAogICAgICAgIHNjYWxhclggPSB0aGlzLndpZHRoIC8gcmVuZGVyZXIud2lkdGgsCiAgICAgICAgc2NhbGFyWSA9IHRoaXMuaGVpZ2h0IC8gcmVuZGVyZXIuaGVpZ2h0OwoKICAgICAgLy8gc3RvcmUgYSB0ZW1wIHZhbHVlIG9mIHRoZSBzbGljZXMKICAgICAgdmFyIHNsaWNlcyA9IE1FU0guc2xpY2VzOwogICAgICAvLyBJbmNyZWFzZSBvciBkZWNyZWFzZSBudW1iZXIgb2Ygc2xpY2VzIGRlcGVuZGluZyBvbiB0aGUgc2l6ZSBvZiB0aGUgY2FudmFzCiAgICAgIE1FU0guc2xpY2VzID0gTWF0aC5jZWlsKHNsaWNlcypzY2FsYXJYKjEuNCk7CgogICAgICAvLyBSZWdlbmVyYXRlIHRoZSB3aG9sZSBjYW52YXMKICAgICAgcmVzaXplKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsKCiAgICAgIC8vIHJlc3RvcmUgdGhlIG51bWJlciBvZiBzbGljZXMKICAgICAgTUVTSC5zbGljZXMgPSBzbGljZXM7CgogICAgICAvLyBNb3ZlIHRoZSBsaWdodHMgb24gdGhlIHBsYW5lIHRvIGFjY29tb2RhdGUgdGhlIHNpemUgb2YgdGhlIGNhbnZhcwogICAgICBmb3IgKGwgPSBzY2VuZS5saWdodHMubGVuZ3RoIC0gMTsgbCA+PSAwOyBsLS0pIHsKICAgICAgICBsaWdodCA9IHNjZW5lLmxpZ2h0c1tsXTsKICAgICAgICB4ID0gbGlnaHQucG9zaXRpb25bMF07CiAgICAgICAgeSA9IGxpZ2h0LnBvc2l0aW9uWzFdOwogICAgICAgIHogPSBsaWdodC5wb3NpdGlvblsyXTsKICAgICAgICBGU1MuVmVjdG9yMy5zZXQobGlnaHQucG9zaXRpb24sIHgqc2NhbGFyWCwgeSpzY2FsYXJZLCB6KnNjYWxhclgpOwogICAgICB9CgogICAgICAvLyBVcGRhdGUgZGVwdGggb2YgdGhlIHRyaWFuZ2xlcwogICAgICB1cGRhdGUoKTsKICAgICAgLy8gUmVuZGVyIHRoZSBjYW52YXMKICAgICAgcmVuZGVyKCk7CgogICAgICBzd2l0Y2goUkVOREVSLnJlbmRlcmVyKSB7CiAgICAgICAgY2FzZSBXRUJHTDoKICAgICAgICAgIHdpbmRvdy5vcGVuKHdlYmdsUmVuZGVyZXIuZWxlbWVudC50b0RhdGFVUkwoKSwgJ19ibGFuaycpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBDQU5WQVM6CiAgICAgICAgICB3aW5kb3cub3BlbihjYW52YXNSZW5kZXJlci5lbGVtZW50LnRvRGF0YVVSTCgpLCAnX2JsYW5rJyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFNWRzoKICAgICAgICAgIHZhciBkYXRhID0gZW5jb2RlVVJJQ29tcG9uZW50KG91dHB1dC5pbm5lckhUTUwpOwogICAgICAgICAgdmFyIHVybCA9ICJkYXRhOmltYWdlL3N2Zyt4bWwsIiArIGRhdGE7CiAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICByZXNpemUoY29udGFpbmVyLm9mZnNldFdpZHRoLCBjb250YWluZXIub2Zmc2V0SGVpZ2h0KTsKCiAgICAgIGZvciAobCA9IHNjZW5lLmxpZ2h0cy5sZW5ndGggLSAxOyBsID49IDA7IGwtLSkgewogICAgICAgIGxpZ2h0ID0gc2NlbmUubGlnaHRzW2xdOwogICAgICAgIHggPSBsaWdodC5wb3NpdGlvblswXTsKICAgICAgICB5ID0gbGlnaHQucG9zaXRpb25bMV07CiAgICAgICAgeiA9IGxpZ2h0LnBvc2l0aW9uWzJdOwogICAgICAgIEZTUy5WZWN0b3IzLnNldChsaWdodC5wb3NpdGlvbiwgeC9zY2FsYXJYLCB5L3NjYWxhclksIHovc2NhbGFyWCk7CiAgICAgIH0KICAgIH0KICB9OwoKCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyBHbG9iYWwgUHJvcGVydGllcwogIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgdmFyIGNlbnRlciA9IEZTUy5WZWN0b3IzLmNyZWF0ZSgpOwogIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyk7CiAgdmFyIGNvbnRyb2xzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRyb2xzJyk7CiAgdmFyIG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdXRwdXQnKTsKICB2YXIgcmVuZGVyZXIsIHNjZW5lLCBtZXNoLCBnZW9tZXRyeSwgbWF0ZXJpYWw7CiAgdmFyIHdlYmdsUmVuZGVyZXIsIGNhbnZhc1JlbmRlcmVyLCBzdmdSZW5kZXJlcjsKICB2YXIgZ3VpOwoKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIC8vIE1ldGhvZHMKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogIGZ1bmN0aW9uIGluaXRpYWxpc2UoKSB7CiAgICBjcmVhdGVSZW5kZXJlcigpOwogICAgY3JlYXRlU2NlbmUoKTsKICAgIGNyZWF0ZU1lc2goKTsKICAgIGFkZExpZ2h0cygpOwogICAgYWRkRXZlbnRMaXN0ZW5lcnMoKTsKICAgIGFkZENvbnRyb2xzKCk7CiAgICBMSUdIVC5yYW5kb21pemUoKTsKICAgIHJlc2l6ZShjb250YWluZXIub2Zmc2V0V2lkdGgsIGNvbnRhaW5lci5vZmZzZXRIZWlnaHQpOwogICAgYW5pbWF0ZSgpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlUmVuZGVyZXIoKSB7CiAgICB3ZWJnbFJlbmRlcmVyID0gbmV3IEZTUy5XZWJHTFJlbmRlcmVyKCk7CiAgICBjYW52YXNSZW5kZXJlciA9IG5ldyBGU1MuQ2FudmFzUmVuZGVyZXIoKTsKICAgIHN2Z1JlbmRlcmVyID0gbmV3IEZTUy5TVkdSZW5kZXJlcigpOwogICAgc2V0UmVuZGVyZXIoUkVOREVSLnJlbmRlcmVyKTsKICB9CgogIGZ1bmN0aW9uIHNldFJlbmRlcmVyKGluZGV4KSB7CiAgICBpZiAocmVuZGVyZXIpIHsKICAgICAgb3V0cHV0LnJlbW92ZUNoaWxkKHJlbmRlcmVyLmVsZW1lbnQpOwogICAgfQogICAgc3dpdGNoKGluZGV4KSB7CiAgICAgIGNhc2UgV0VCR0w6CiAgICAgICAgcmVuZGVyZXIgPSB3ZWJnbFJlbmRlcmVyOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIENBTlZBUzoKICAgICAgICByZW5kZXJlciA9IGNhbnZhc1JlbmRlcmVyOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFNWRzoKICAgICAgICByZW5kZXJlciA9IHN2Z1JlbmRlcmVyOwogICAgICAgIGJyZWFrOwogICAgfQogICAgcmVuZGVyZXIuc2V0U2l6ZShjb250YWluZXIub2Zmc2V0V2lkdGgsIGNvbnRhaW5lci5vZmZzZXRIZWlnaHQpOwogICAgb3V0cHV0LmFwcGVuZENoaWxkKHJlbmRlcmVyLmVsZW1lbnQpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlU2NlbmUoKSB7CiAgICBzY2VuZSA9IG5ldyBGU1MuU2NlbmUoKTsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZU1lc2goKSB7CiAgICBzY2VuZS5yZW1vdmUobWVzaCk7CiAgICByZW5kZXJlci5jbGVhcigpOwogICAgZ2VvbWV0cnkgPSBuZXcgRlNTLlBsYW5lKE1FU0gud2lkdGggKiByZW5kZXJlci53aWR0aCwgTUVTSC5oZWlnaHQgKiByZW5kZXJlci5oZWlnaHQsIE1FU0guc2xpY2VzKTsKICAgIG1hdGVyaWFsID0gbmV3IEZTUy5NYXRlcmlhbChNRVNILmFtYmllbnQsIE1FU0guZGlmZnVzZSk7CiAgICBtZXNoID0gbmV3IEZTUy5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICBzY2VuZS5hZGQobWVzaCk7CgogICAgLy8gQXVnbWVudCB2ZXJ0aWNlcyBmb3IgZGVwdGggbW9kaWZpY2F0aW9uCiAgICB2YXIgdiwgdmVydGV4OwogICAgZm9yICh2ID0gZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoIC0gMTsgdiA+PSAwOyB2LS0pIHsKICAgICAgdmVydGV4ID0gZ2VvbWV0cnkudmVydGljZXNbdl07CiAgICAgIHZlcnRleC5kZXB0aCA9IE1hdGgucmFuZG9tSW5SYW5nZSgwLCBNRVNILm1heGRlcHRoLzEwKTsKICAgICAgdmVydGV4LmFuY2hvciA9IEZTUy5WZWN0b3IzLmNsb25lKHZlcnRleC5wb3NpdGlvbik7CiAgICB9CiAgfQoKICAvLyBBZGQgYSBzaW5nbGUgbGlnaHQKICBmdW5jdGlvbiBhZGRMaWdodChhbWJpZW50LCBkaWZmdXNlLCB4LCB5LCB6KSB7CiAgICBhbWJpZW50ID0gdHlwZW9mIGFtYmllbnQgIT09ICd1bmRlZmluZWQnID8gYW1iaWVudCA6IExJR0hULmFtYmllbnQ7CiAgICBkaWZmdXNlID0gdHlwZW9mIGRpZmZ1c2UgIT09ICd1bmRlZmluZWQnID8gZGlmZnVzZSA6IGdldFJhbmRvbUNvbG9yKCk7CiAgICB4ID0gdHlwZW9mIHggIT09ICd1bmRlZmluZWQnID8geCA6IExJR0hULnhQb3M7CiAgICB5ID0gdHlwZW9mIHkgIT09ICd1bmRlZmluZWQnID8geSA6IExJR0hULnlQb3M7CiAgICB6ID0gdHlwZW9mIHogIT09ICd1bmRlZmluZWQnID8geiA6IExJR0hULnpPZmZzZXQ7CgogICAgcmVuZGVyZXIuY2xlYXIoKTsKICAgIGxpZ2h0ID0gbmV3IEZTUy5MaWdodChhbWJpZW50LCBkaWZmdXNlKTsKICAgIGxpZ2h0LmFtYmllbnRIZXggPSBsaWdodC5hbWJpZW50LmZvcm1hdCgpOwogICAgbGlnaHQuZGlmZnVzZUhleCA9IGxpZ2h0LmRpZmZ1c2UuZm9ybWF0KCk7CiAgICBsaWdodC5zZXRQb3NpdGlvbih4LCB5LCB6KTsKICAgIHNjZW5lLmFkZChsaWdodCk7CiAgICBMSUdIVC5kaWZmdXNlID0gZGlmZnVzZTsKICAgIExJR0hULnByb3h5ID0gbGlnaHQ7CiAgICBMSUdIVC5waWNrZWR1cCA9IHRydWU7CiAgICBMSUdIVC5jdXJySW5kZXgrKzsKICB9CgogIGZ1bmN0aW9uIGFkZExpZ2h0cygpIHsKICAgIHZhciBudW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KSArIDE7CgogICAgZm9yICh2YXIgaSA9IG51bSAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgIGFkZExpZ2h0KCk7CiAgICAgIExJR0hULmNvdW50Kys7CiAgICB9OwogIH0KCiAgLy8gUmVtb3ZlIGxpZ2h0cwogIGZ1bmN0aW9uIHRyaW1MaWdodHModmFsdWUpIHsKICAgIGZvciAobCA9IHZhbHVlOyBsIDw9IHNjZW5lLmxpZ2h0cy5sZW5ndGg7IGwrKykgewogICAgICBsaWdodCA9IHNjZW5lLmxpZ2h0c1tsXTsKICAgICAgc2NlbmUucmVtb3ZlKGxpZ2h0KTsKICAgICAgTElHSFQuY3VyckluZGV4LS07CiAgICB9CiAgICBMSUdIVC5wcm94eSA9IHNjZW5lLmxpZ2h0c1tMSUdIVC5jdXJySW5kZXgtMV07CiAgICBMSUdIVC5waWNrZWR1cCA9IGZhbHNlOwoKICAgIHJlbmRlcmVyLmNsZWFyKCk7CiAgfQoKICAvLyBSZXNpemUgY2FudmFzCiAgZnVuY3Rpb24gcmVzaXplKHdpZHRoLCBoZWlnaHQpIHsKICAgIHJlbmRlcmVyLnNldFNpemUod2lkdGgsIGhlaWdodCk7CiAgICBGU1MuVmVjdG9yMy5zZXQoY2VudGVyLCByZW5kZXJlci5oYWxmV2lkdGgsIHJlbmRlcmVyLmhhbGZIZWlnaHQpOwogICAgY3JlYXRlTWVzaCgpOwogIH0KCiAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgIHVwZGF0ZSgpOwogICAgcmVuZGVyKCk7CiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGUoKSB7CiAgICB2YXIgdiwgdmVydGV4LCBvZmZzZXQgPSBNRVNILmRlcHRoLzEwMDsKCiAgICAvLyBBZGQgZGVwdGggdG8gVmVydGljZXMKICAgIGZvciAodiA9IGdlb21ldHJ5LnZlcnRpY2VzLmxlbmd0aCAtIDE7IHYgPj0gMDsgdi0tKSB7CiAgICAgIHZlcnRleCA9IGdlb21ldHJ5LnZlcnRpY2VzW3ZdOwogICAgICBGU1MuVmVjdG9yMy5zZXQodmVydGV4LnBvc2l0aW9uLCAxLCAxLCB2ZXJ0ZXguZGVwdGgqb2Zmc2V0KTsKICAgICAgRlNTLlZlY3RvcjMuYWRkKHZlcnRleC5wb3NpdGlvbiwgdmVydGV4LmFuY2hvcik7CiAgICB9CgogICAgLy8gU2V0IHRoZSBHZW9tZXRyeSB0byBkaXJ0eQogICAgZ2VvbWV0cnkuZGlydHkgPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gcmVuZGVyKCkgewogICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lKTsKICB9CgogIGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXJzKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uV2luZG93UmVzaXplKTsKICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSk7CiAgfQoKICBmdW5jdGlvbiBhZGRDb250cm9scygpIHsKICAgIHZhciBpLCBsLCBsaWdodCwgZm9sZGVyLCBjb250cm9sbGVyOwoKICAgIC8vIENyZWF0ZSBHVUkKICAgIGd1aSA9IG5ldyBkYXQuR1VJKHthdXRvUGxhY2U6ZmFsc2V9KTsKCiAgICBjb250cm9scy5hcHBlbmRDaGlsZChndWkuZG9tRWxlbWVudCk7CgogICAgLy8gQ3JlYXRlIGZvbGRlcnMKICAgIHJlbmRlckZvbGRlciA9IGd1aS5hZGRGb2xkZXIoJ1JlbmRlcicpOwogICAgbWVzaEZvbGRlciA9IGd1aS5hZGRGb2xkZXIoJ01lc2gnKTsKICAgIGxpZ2h0Rm9sZGVyID0gZ3VpLmFkZEZvbGRlcignTGlnaHQnKTsKICAgIGV4cG9ydEZvbGRlciA9IGd1aS5hZGRGb2xkZXIoJ0V4cG9ydCcpOwoKICAgIC8vIE9wZW4gZm9sZGVycwogICAgbGlnaHRGb2xkZXIub3BlbigpOwoKICAgIC8vIEFkZCBSZW5kZXIgQ29udHJvbHMKICAgIGNvbnRyb2xsZXIgPSByZW5kZXJGb2xkZXIuYWRkKFJFTkRFUiwgJ3JlbmRlcmVyJywge3dlYmdsOldFQkdMLCBjYW52YXM6Q0FOVkFTLCBzdmc6U1ZHfSk7CiAgICBjb250cm9sbGVyLm9uQ2hhbmdlKGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHNldFJlbmRlcmVyKHZhbHVlKTsKICAgIH0pOwoKICAgIC8vIEFkZCBNZXNoIENvbnRyb2xzCiAgICBjb250cm9sbGVyID0gbWVzaEZvbGRlci5hZGRDb2xvcihNRVNILCAnYW1iaWVudCcpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBmb3IgKGkgPSAwLCBsID0gc2NlbmUubWVzaGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHNjZW5lLm1lc2hlc1tpXS5tYXRlcmlhbC5hbWJpZW50LnNldCh2YWx1ZSk7CiAgICAgIH0KICAgIH0pOwogICAgY29udHJvbGxlciA9IG1lc2hGb2xkZXIuYWRkQ29sb3IoTUVTSCwgJ2RpZmZ1c2UnKTsKICAgIGNvbnRyb2xsZXIub25DaGFuZ2UoZnVuY3Rpb24odmFsdWUpIHsKICAgICAgZm9yIChpID0gMCwgbCA9IHNjZW5lLm1lc2hlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBzY2VuZS5tZXNoZXNbaV0ubWF0ZXJpYWwuZGlmZnVzZS5zZXQodmFsdWUpOwogICAgICB9CiAgICB9KTsKICAgIGNvbnRyb2xsZXIgPSBtZXNoRm9sZGVyLmFkZChNRVNILCAnd2lkdGgnLCAwLjA1LCAyKTsKICAgIGNvbnRyb2xsZXIub25DaGFuZ2UoZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKGdlb21ldHJ5LndpZHRoICE9PSB2YWx1ZSAqIHJlbmRlcmVyLndpZHRoKSB7IGNyZWF0ZU1lc2goKTsgfQogICAgfSk7CiAgICBjb250cm9sbGVyID0gbWVzaEZvbGRlci5hZGQoTUVTSCwgJ2hlaWdodCcsIDAuMDUsIDIpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBpZiAoZ2VvbWV0cnkuaGVpZ2h0ICE9PSB2YWx1ZSAqIHJlbmRlcmVyLmhlaWdodCkgeyBjcmVhdGVNZXNoKCk7IH0KICAgIH0pOwoKICAgIGNvbnRyb2xsZXIgPSBtZXNoRm9sZGVyLmFkZChNRVNILCAnZGVwdGgnLCAwLCBNRVNILm1heGRlcHRoKS5saXN0ZW4oKTsKCiAgICBjb250cm9sbGVyID0gbWVzaEZvbGRlci5hZGQoTUVTSCwgJ3NsaWNlcycsIDEsIDgwMCk7CiAgICBjb250cm9sbGVyLnN0ZXAoMSk7CiAgICBjb250cm9sbGVyLm9uQ2hhbmdlKGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIGlmIChnZW9tZXRyeS5zbGljZXMgIT09IHZhbHVlKSB7IGNyZWF0ZU1lc2goKTsgfQogICAgfSk7CgogICAgLy8gQWRkIExpZ2h0IENvbnRyb2xzCiAgICAvLyBUT0RPOiBhZGQgdGhlIG51bWJlciBvZiBsaWdodHMgZHluYW1pY2FsbHkKICAgIGNvbnRyb2xsZXIgPSBsaWdodEZvbGRlci5hZGQoTElHSFQsICdjdXJySW5kZXgnLCB7MToxLCAyOjIsIDM6MywgNDo0LCA1OjUsIDY6NiwgNzo3fSkubmFtZSgnQ3VycmVudCBsaWdodCcpLmxpc3RlbigpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBMSUdIVC5wcm94eSA9IHNjZW5lLmxpZ2h0c1t2YWx1ZS0xXTsKCiAgICAgIExJR0hULmFtYmllbnQgPSBMSUdIVC5wcm94eS5hbWJpZW50LmhleDsKICAgICAgTElHSFQuZGlmZnVzZSA9IExJR0hULnByb3h5LmRpZmZ1c2UuaGV4OwogICAgICBMSUdIVC54UG9zICAgID0gTElHSFQucHJveHkucG9zaXRpb25bMF07CiAgICAgIExJR0hULnlQb3MgICAgPSBMSUdIVC5wcm94eS5wb3NpdGlvblsxXTsKICAgICAgTElHSFQuek9mZnNldCA9IExJR0hULnByb3h5LnBvc2l0aW9uWzJdOwoKICAgICAgLy8gSGFja3kgd2F5IHRvIGFsbG93IG1hbnVhbCB1cGRhdGUgb2YgdGhlIEhFWCBjb2xvcnMgZm9yIGxpZ2h0J3MgYW1iaWVudCBhbmQgZGlmZnVzZQogICAgICBndWkuX19mb2xkZXJzLkxpZ2h0Ll9fY29udHJvbGxlcnNbMV0udXBkYXRlRGlzcGxheSgpOwogICAgICBndWkuX19mb2xkZXJzLkxpZ2h0Ll9fY29udHJvbGxlcnNbMl0udXBkYXRlRGlzcGxheSgpOwogICAgfSk7CgogICAgY29udHJvbGxlciA9IGxpZ2h0Rm9sZGVyLmFkZENvbG9yKExJR0hULCAnYW1iaWVudCcpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBMSUdIVC5wcm94eS5hbWJpZW50LnNldCh2YWx1ZSk7CiAgICAgIExJR0hULnByb3h5LmFtYmllbnRIZXggPSAgTElHSFQucHJveHkuYW1iaWVudC5mb3JtYXQoKTsKICAgIH0pOwoKICAgIGNvbnRyb2xsZXIgPSBsaWdodEZvbGRlci5hZGRDb2xvcihMSUdIVCwgJ2RpZmZ1c2UnKTsKICAgIGNvbnRyb2xsZXIub25DaGFuZ2UoZnVuY3Rpb24odmFsdWUpIHsKICAgICAgTElHSFQucHJveHkuZGlmZnVzZS5zZXQodmFsdWUpOwogICAgICBMSUdIVC5wcm94eS5kaWZmdXNlSGV4ID0gTElHSFQucHJveHkuZGlmZnVzZS5mb3JtYXQoKTsKICAgIH0pOwoKICAgIGNvbnRyb2xsZXIgPSBsaWdodEZvbGRlci5hZGQoTElHSFQsICdjb3VudCcsIDEsIDcpLmxpc3RlbigpOwogICAgY29udHJvbGxlci5zdGVwKDEpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBpZiAoc2NlbmUubGlnaHRzLmxlbmd0aCAhPT0gdmFsdWUpIHsKICAgICAgICAvLyBJZiB0aGUgdmFsdWUgaXMgbW9yZSB0aGVuIHRoZSBudW1iZXIgb2YgbGlnaHRzLCBhZGQgbGlnaHRzLCBvdGhlcndpc2UgZGVsZXRlIGxpZ2h0cyBmcm9tIHRoZSBzY2VuZQogICAgICAgIGlmICh2YWx1ZSA+IHNjZW5lLmxpZ2h0cy5sZW5ndGgpIHsKICAgICAgICAgIGFkZExpZ2h0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRyaW1MaWdodHModmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgY29udHJvbGxlciA9IGxpZ2h0Rm9sZGVyLmFkZChMSUdIVCwgJ3hQb3MnLCAtbWVzaC5nZW9tZXRyeS53aWR0aC8yLCBtZXNoLmdlb21ldHJ5LndpZHRoLzIpLmxpc3RlbigpOwogICAgY29udHJvbGxlci5zdGVwKDEpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBMSUdIVC5wcm94eS5zZXRQb3NpdGlvbih2YWx1ZSwgTElHSFQucHJveHkucG9zaXRpb25bMV0sIExJR0hULnByb3h5LnBvc2l0aW9uWzJdKTsKICAgIH0pOwoKICAgIGNvbnRyb2xsZXIgPSBsaWdodEZvbGRlci5hZGQoTElHSFQsICd5UG9zJywgLW1lc2guZ2VvbWV0cnkuaGVpZ2h0LzIsIG1lc2guZ2VvbWV0cnkuaGVpZ2h0LzIpLmxpc3RlbigpOwogICAgY29udHJvbGxlci5zdGVwKDEpOwogICAgY29udHJvbGxlci5vbkNoYW5nZShmdW5jdGlvbih2YWx1ZSkgewogICAgICBMSUdIVC5wcm94eS5zZXRQb3NpdGlvbihMSUdIVC5wcm94eS5wb3NpdGlvblswXSwgdmFsdWUsIExJR0hULnByb3h5LnBvc2l0aW9uWzJdKTsKICAgIH0pOwoKCgogICAgLyogSlF1ZXJ5IEJsb2NrICoqKioKCSoqIFR3byBkaWZmZXJlbnQgYmluZHMgY2FsbGVkIHRvIGFsbG93IGZvciBtb3VzZS1zY3JvbGwgbW9kaWZpY2F0aW9uIG9mCgkqKiB6LW9mZnNldC4gT25lIG9mIHRoZSBiaW5kcyBoYW5kbGUgc3BlY2lmaWNhbGx5IGZvciBGaXJlZm94LAoJKiogYW5kIHRoZSBvdGhlciBoYW5kbGVzIGZvciBJRSwgT3BlcmEgYW5kIFNhZmFyaQoJKiogV29ya3MgaW46IE9wZXJhLCBTYWZhcmksIElFOSsuIGFuZCBDaHJvbWUuCgkqKiBOYU4gRXJyb3IgaW4gRmlyZWZveC4KICAgICovCgogICAgY29udHJvbGxlciA9IGxpZ2h0Rm9sZGVyLmFkZChMSUdIVCwgJ3pPZmZzZXQnLCAwLCAxMDAwKS5uYW1lKCdEaXN0YW5jZScpLmxpc3RlbigpOwoJc2Nyb2xsQnV0dG9uRGlzdGFuY2UgPSBOdW1iZXIoTElHSFQucHJveHkucG9zaXRpb25bMl0pOwoJLy9GaXJlZm94CgkkKCcjY29udGFpbmVyJykuYmluZCgnRE9NTW91c2VTY3JvbGwnLCBmdW5jdGlvbihlKSB7CgkJaWYoZS5vcmlnaW5hbEV2ZW50LmRldGFpbCA+IDApIHsKCQkgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgPSBOdW1iZXIoTWF0aC5tYXgoMCwgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgLSBlLmRldGFpbC80KSk7CgkJfSBlbHNlIHsKCQkgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgPSAgTnVtYmVyKE1hdGgubWluKDEwMDAsIHNjcm9sbEJ1dHRvbkRpc3RhbmNlIC0gZS5kZXRhaWwvNCkpOwoJCX0KCgkJTElHSFQucHJveHkuc2V0UG9zaXRpb24oTElHSFQucHJveHkucG9zaXRpb25bMF0sIExJR0hULnByb3h5LnBvc2l0aW9uWzFdLCBzY3JvbGxCdXR0b25EaXN0YW5jZSk7CgkJIExJR0hULnpPZmZzZXQgPSBzY3JvbGxCdXR0b25EaXN0YW5jZTsKCQlMSUdIVC56ID0gc2Nyb2xsQnV0dG9uRGlzdGFuY2U7CgkJZ3VpLl9fZm9sZGVycy5MaWdodC5fX2NvbnRyb2xsZXJzWzFdLnVwZGF0ZURpc3BsYXkoKTsKCQlndWkuX19mb2xkZXJzLkxpZ2h0Ll9fY29udHJvbGxlcnNbMl0udXBkYXRlRGlzcGxheSgpOwoJCXJldHVybiBmYWxzZTsKCX0pOwoKCS8vSUUsIE9wZXJhLCBTYWZhcmkKCSQoJyNjb250YWluZXInKS5iaW5kKCdtb3VzZXdoZWVsJywgZnVuY3Rpb24oZSkgewoJCWlmKGUub3JpZ2luYWxFdmVudC53aGVlbERlbHRhIDwgMCkgewoJCSBzY3JvbGxCdXR0b25EaXN0YW5jZSA9ICBOdW1iZXIoTWF0aC5tYXgoMCwgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgKyBlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YS80KSk7CgkJfSBlbHNlIHsKCQkgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgPSBOdW1iZXIoTWF0aC5taW4oMTAwMCwgc2Nyb2xsQnV0dG9uRGlzdGFuY2UgKyBlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YS80KSk7CgkJfQoKCQlMSUdIVC5wcm94eS5zZXRQb3NpdGlvbihOdW1iZXIoTElHSFQucHJveHkucG9zaXRpb25bMF0pLCBOdW1iZXIoTElHSFQucHJveHkucG9zaXRpb25bMV0pLCBzY3JvbGxCdXR0b25EaXN0YW5jZSk7CgkJTElHSFQuek9mZnNldCA9IHNjcm9sbEJ1dHRvbkRpc3RhbmNlOwoJCUxJR0hULnogPSBzY3JvbGxCdXR0b25EaXN0YW5jZTsKCQlndWkuX19mb2xkZXJzLkxpZ2h0Ll9fY29udHJvbGxlcnNbMV0udXBkYXRlRGlzcGxheSgpOwoJCWd1aS5fX2ZvbGRlcnMuTGlnaHQuX19jb250cm9sbGVyc1syXS51cGRhdGVEaXNwbGF5KCk7CgoJCXJldHVybiBmYWxzZTsKCX0pOwoKCS8qIEVuZCBKUXVlcnkgQmxvY2sgKi8KCiAgICBjb250cm9sbGVyLnN0ZXAoMSk7CiAgICBjb250cm9sbGVyLm9uQ2hhbmdlKGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIExJR0hULnByb3h5LnNldFBvc2l0aW9uKExJR0hULnByb3h5LnBvc2l0aW9uWzBdLCBMSUdIVC5wcm94eS5wb3NpdGlvblsxXSwgdmFsdWUpOwogICAgfSk7CgogICAgY29udHJvbGxlciA9IGxpZ2h0Rm9sZGVyLmFkZChMSUdIVCwgJ3JhbmRvbWl6ZScpOwoKICAgIC8vIEFkZCBFeHBvcnQgQ29udHJvbHMKICAgIGNvbnRyb2xsZXIgPSBleHBvcnRGb2xkZXIuYWRkKEVYUE9SVCwgJ3dpZHRoJywgMTAwLCAzMDAwKTsKICAgIGNvbnRyb2xsZXIuc3RlcCgxMDApOwogICAgY29udHJvbGxlciA9IGV4cG9ydEZvbGRlci5hZGQoRVhQT1JULCAnaGVpZ2h0JywgMTAwLCAzMDAwKTsKICAgIGNvbnRyb2xsZXIuc3RlcCgxMDApOwogICAgY29udHJvbGxlciA9IGV4cG9ydEZvbGRlci5hZGQoRVhQT1JULCAnZXhwb3J0JykubmFtZSgnZXhwb3J0IGJpZycpOwogICAgY29udHJvbGxlciA9IGV4cG9ydEZvbGRlci5hZGQoRVhQT1JULCAnZXhwb3J0Q3VycmVudCcpLm5hbWUoJ2V4cG9ydCB0aGlzJyk7CgogIH0KCiAgZnVuY3Rpb24gdG9nZ2xlRWwoaWQpIHsKICAgIHZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogICAgaWYoZS5zdHlsZS5kaXNwbGF5ID09ICdibG9jaycpCiAgICAgICBlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBlbHNlCiAgICAgICBlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIH0KCiAgZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKXsKICAgIHJldHVybiAnIycrKE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpICsgJzAwMDAwMCcpLnNsaWNlKDIsIDgpOwogIH0KCiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAvLyBDYWxsYmFja3MKICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICBmdW5jdGlvbiBvbldpbmRvd1Jlc2l6ZShldmVudCkgewogICAgcmVzaXplKGNvbnRhaW5lci5vZmZzZXRXaWR0aCwgY29udGFpbmVyLm9mZnNldEhlaWdodCk7CiAgICByZW5kZXIoKTsKICB9CgogIGZ1bmN0aW9uIG9uTW91c2VNb3ZlKGV2ZW50KSB7CiAgICBpZihMSUdIVC5waWNrZWR1cCl7CiAgICAgIExJR0hULnhQb3MgPSAoZXZlbnQueCB8fCBldmVudC5jbGllbnRYKSAtIHJlbmRlcmVyLndpZHRoLzI7CiAgICAgIExJR0hULnlQb3MgPSByZW5kZXJlci5oZWlnaHQvMiAtIChldmVudC55IHx8IGV2ZW50LmNsaWVudFkpOwogICAgICBMSUdIVC5wcm94eS5zZXRQb3NpdGlvbihMSUdIVC54UG9zLCBMSUdIVC55UG9zLCBMSUdIVC5wcm94eS5wb3NpdGlvblsyXSk7CiAgICB9CiAgfQoKICAvLyBIaWRlIHRoZSBjb250cm9scyBjb21wbGV0ZWx5IG9uIHByZXNzaW5nIEgKICBNb3VzZXRyYXAuYmluZCgnSCcsIGZ1bmN0aW9uKCkgewogICAgdG9nZ2xlRWwoJ2NvbnRyb2xzJyk7CiAgICB0b2dnbGVFbCgnbGlua3MnKTsKCiAgfSk7CgogIC8vIEFkZCBhIGxpZ2h0IG9uIEVOVEVSIGtleQogIE1vdXNldHJhcC5iaW5kKCdlbnRlcicsIGZ1bmN0aW9uKCkgewogICAgTElHSFQuY291bnQrKzsKICAgIGFkZExpZ2h0KCk7CiAgfSk7CgogIC8vIFBpY2sgdXAgdGhlIGxpZ2h0IHdoZW4gYSBzcGFjZSBpcyBwcmVzc2VkCiAgTW91c2V0cmFwLmJpbmQoJ3NwYWNlJywgZnVuY3Rpb24oKSB7CiAgICBMSUdIVC5waWNrZWR1cCA9ICFMSUdIVC5waWNrZWR1cDsKICB9KTsKCiAgLy8gTGV0IHRoZXJlIGJlIGxpZ2h0IQogIGluaXRpYWxpc2UoKTsKCn0pKCk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 23:35:43 GMT",
                    "Content-Length": "112390",
                    "Date": "Sat, 08 Nov 2014 23:35:44 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}