{
    "url": "http://localhost:9999/kvz/phpjs/functions/filesystem/file_get_contents.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.href</b> and written to <b>the 'open()' function of an XMLHttpRequest object</b> via the following statements:<ul><li>href = this.window.location.href;</li><li>url = href.slice(0, pathPos + 1) + url;</li><li>req.open(method, url, async);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/kvz/phpjs/functions/filesystem/file_get_contents.js",
                "path": "/kvz/phpjs/functions/filesystem/file_get_contents.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9rdnovcGhwanMvZnVuY3Rpb25zL2ZpbGVzeXN0ZW0vZmlsZV9nZXRfY29udGVudHMuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTMzMzENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMjI6MDA6MTQgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDIyOjAwOjExIEdNVA0KDQpmdW5jdGlvbiBmaWxlX2dldF9jb250ZW50cyh1cmwsIGZsYWdzLCBjb250ZXh0LCBvZmZzZXQsIG1heExlbikgewogIC8vICBkaXNjdXNzIGF0OiBodHRwOi8vcGhwanMub3JnL2Z1bmN0aW9ucy9maWxlX2dldF9jb250ZW50cy8KICAvLyBvcmlnaW5hbCBieTogTGVnYWV2IEFuZHJleQogIC8vICAgIGlucHV0IGJ5OiBKYW5pIEhhcnRpa2FpbmVuCiAgLy8gICAgaW5wdXQgYnk6IFJhcGhhZWwgKEFvKSBSVURMRVIKICAvLyBpbXByb3ZlZCBieTogS2V2aW4gdmFuIFpvbm5ldmVsZCAoaHR0cDovL2tldmluLnZhbnpvbm5ldmVsZC5uZXQpCiAgLy8gaW1wcm92ZWQgYnk6IEJyZXR0IFphbWlyIChodHRwOi8vYnJldHQtemFtaXIubWUpCiAgLy8gYnVnZml4ZWQgYnk6IEJyZXR0IFphbWlyIChodHRwOi8vYnJldHQtemFtaXIubWUpCiAgLy8gICAgICAgIG5vdGU6IFRoaXMgZnVuY3Rpb24gdXNlcyBYbWxIdHRwUmVxdWVzdCBhbmQgY2Fubm90IHJldHJpZXZlIHJlc291cmNlIGZyb20gZGlmZmVyZW50IGRvbWFpbiB3aXRob3V0IG1vZGlmaWNhdGlvbnMuCiAgLy8gICAgICAgIG5vdGU6IFN5bmNocm9ub3VzIGJ5IGRlZmF1bHQgKGFzIGluIFBIUCkgc28gbWF5IGxvY2sgdXAgYnJvd3Nlci4gQ2FuCiAgLy8gICAgICAgIG5vdGU6IGdldCBhc3luYyBieSBzZXR0aW5nIGEgY3VzdG9tICJwaHBqcy5hc3luYyIgcHJvcGVydHkgdG8gdHJ1ZSBhbmQgIm5vdGlmaWNhdGlvbiIgZm9yIGFuCiAgLy8gICAgICAgIG5vdGU6IG9wdGlvbmFsIGNhbGxiYWNrIChib3RoIGFzIGNvbnRleHQgcGFyYW1zLCB3aXRoIHJlc3BvbnNlVGV4dCwgYW5kIG90aGVyIEpTLXNwZWNpZmljCiAgLy8gICAgICAgIG5vdGU6IHJlcXVlc3QgcHJvcGVydGllcyBhdmFpbGFibGUgdmlhICd0aGlzJykuIE5vdGUgdGhhdCBmaWxlX2dldF9jb250ZW50cygpIHdpbGwgbm90IHJldHVybiB0aGUgdGV4dAogIC8vICAgICAgICBub3RlOiBpbiBzdWNoIGEgY2FzZSAodXNlIHRoaXMucmVzcG9uc2VUZXh0IHdpdGhpbiB0aGUgY2FsbGJhY2spLiBPciwgY29uc2lkZXIgdXNpbmcKICAvLyAgICAgICAgbm90ZTogalF1ZXJ5J3M6ICQoJyNkaXZJZCcpLmxvYWQoJ2h0dHA6Ly91cmwnKSBpbnN0ZWFkLgogIC8vICAgICAgICBub3RlOiBUaGUgY29udGV4dCBhcmd1bWVudCBpcyBvbmx5IGltcGxlbWVudGVkIGZvciBodHRwLCBhbmQgb25seSBwYXJ0aWFsbHkgKHNlZSBiZWxvdyBmb3IKICAvLyAgICAgICAgbm90ZTogIlByZXNlbnRseSB1bmltcGxlbWVudGVkIEhUVFAgY29udGV4dCBvcHRpb25zIik7IGFsc28gdGhlIGFyZ3VtZW50cyBwYXNzZWQgdG8KICAvLyAgICAgICAgbm90ZTogbm90aWZpY2F0aW9uIGFyZSBpbmNvbXBsZXRlCiAgLy8gICAgICAgIHRlc3Q6IHNraXAKICAvLyAgIGV4YW1wbGUgMTogdmFyIGJ1ZiBmaWxlX2dldF9jb250ZW50cygnaHR0cDovL2dvb2dsZS5jb20nKTsKICAvLyAgIGV4YW1wbGUgMTogYnVmLmluZGV4T2YoJ0dvb2dsZScpICE9PSAtMQogIC8vICAgcmV0dXJucyAxOiB0cnVlCgogIHZhciB0bXAsIGhlYWRlcnMgPSBbXSwKICAgIG5ld1RtcCA9IFtdLAogICAgayA9IDAsCiAgICBpID0gMCwKICAgIGhyZWYgPSAnJywKICAgIHBhdGhQb3MgPSAtMSwKICAgIGZsYWdOYW1lcyA9IDAsCiAgICBjb250ZW50ID0gbnVsbCwKICAgIGh0dHBfc3RyZWFtID0gZmFsc2U7CiAgdmFyIGZ1bmMgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZS5zdWJzdHJpbmcoMSkgIT09ICcnOwogIH07CgogIC8vIEJFR0lOIFJFRFVOREFOVAogIHRoaXMucGhwX2pzID0gdGhpcy5waHBfanMgfHwge307CiAgdGhpcy5waHBfanMuaW5pID0gdGhpcy5waHBfanMuaW5pIHx8IHt9OwogIC8vIEVORCBSRURVTkRBTlQKICB2YXIgaW5pID0gdGhpcy5waHBfanMuaW5pOwogIGNvbnRleHQgPSBjb250ZXh0IHx8IHRoaXMucGhwX2pzLmRlZmF1bHRfc3RyZWFtc19jb250ZXh0IHx8IG51bGw7CgogIGlmICghZmxhZ3MpIHsKICAgIGZsYWdzID0gMDsKICB9CiAgdmFyIE9QVFMgPSB7CiAgICBGSUxFX1VTRV9JTkNMVURFX1BBVEg6IDEsCiAgICBGSUxFX1RFWFQ6IDMyLAogICAgRklMRV9CSU5BUlk6IDY0CiAgfTsKICBpZiAodHlwZW9mIGZsYWdzID09PSAnbnVtYmVyJykgewogICAgLy8gQWxsb3cgZm9yIGEgc2luZ2xlIHN0cmluZyBvciBhbiBhcnJheSBvZiBzdHJpbmcgZmxhZ3MKICAgIGZsYWdOYW1lcyA9IGZsYWdzOwogIH0gZWxzZSB7CiAgICBmbGFncyA9IFtdLmNvbmNhdChmbGFncyk7CiAgICBmb3IgKGkgPSAwOyBpIDwgZmxhZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKE9QVFNbZmxhZ3NbaV1dKSB7CiAgICAgICAgZmxhZ05hbWVzID0gZmxhZ05hbWVzIHwgT1BUU1tmbGFnc1tpXV07CiAgICAgIH0KICAgIH0KICB9CgogIGlmIChmbGFnTmFtZXMgJiBPUFRTLkZJTEVfQklOQVJZICYmIChmbGFnTmFtZXMgJiBPUFRTLkZJTEVfVEVYVCkpIHsKICAgIC8vIFRoZXNlIGZsYWdzIHNob3VsZG4ndCBiZSB0b2dldGhlcgogICAgdGhyb3cgJ1lvdSBjYW5ub3QgcGFzcyBib3RoIEZJTEVfQklOQVJZIGFuZCBGSUxFX1RFWFQgdG8gZmlsZV9nZXRfY29udGVudHMoKSc7CiAgfQoKICBpZiAoKGZsYWdOYW1lcyAmIE9QVFMuRklMRV9VU0VfSU5DTFVERV9QQVRIKSAmJiBpbmkuaW5jbHVkZV9wYXRoICYmIGluaS5pbmNsdWRlX3BhdGgubG9jYWxfdmFsdWUpIHsKICAgIHZhciBzbGFzaCA9IGluaS5pbmNsdWRlX3BhdGgubG9jYWxfdmFsdWUuaW5kZXhPZignLycpICE9PSAtMSA/ICcvJyA6ICdcXCc7CiAgICB1cmwgPSBpbmkuaW5jbHVkZV9wYXRoLmxvY2FsX3ZhbHVlICsgc2xhc2ggKyB1cmw7CiAgfSBlbHNlIGlmICghL14oaHR0cHM/fGZpbGUpOi8udGVzdCh1cmwpKSB7CiAgICAvLyBBbGxvdyByZWZlcmVuY2VzIHdpdGhpbiBvciBiZWxvdyB0aGUgc2FtZSBkaXJlY3RvcnkgKHNob3VsZCBmaXggdG8gYWxsb3cgb3RoZXIgcmVsYXRpdmUgcmVmZXJlbmNlcyBvciByb290IHJlZmVyZW5jZTsgY291bGQgbWFrZSBkZXBlbmRlbnQgb24gcGFyc2VfdXJsKCkpCiAgICBocmVmID0gdGhpcy53aW5kb3cubG9jYXRpb24uaHJlZjsKICAgIHBhdGhQb3MgPSB1cmwuaW5kZXhPZignLycpID09PSAwID8gaHJlZi5pbmRleE9mKCcvJywgOCkgLSAxIDogaHJlZi5sYXN0SW5kZXhPZignLycpOwogICAgdXJsID0gaHJlZi5zbGljZSgwLCBwYXRoUG9zICsgMSkgKyB1cmw7CiAgfQoKICB2YXIgaHR0cF9vcHRpb25zOwogIGlmIChjb250ZXh0KSB7CiAgICBodHRwX29wdGlvbnMgPSBjb250ZXh0LnN0cmVhbV9vcHRpb25zICYmIGNvbnRleHQuc3RyZWFtX29wdGlvbnMuaHR0cDsKICAgIGh0dHBfc3RyZWFtID0gISFodHRwX29wdGlvbnM7CiAgfQoKICBpZiAoIWNvbnRleHQgfHwgIWNvbnRleHQuc3RyZWFtX29wdGlvbnMgfHwgaHR0cF9zdHJlYW0pIHsKICAgIHZhciByZXEgPSB0aGlzLndpbmRvdy5BY3RpdmVYT2JqZWN0ID8gbmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxIVFRQJykgOiBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIGlmICghcmVxKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignWE1MSHR0cFJlcXVlc3Qgbm90IHN1cHBvcnRlZCcpOwogICAgfQoKICAgIHZhciBtZXRob2QgPSBodHRwX3N0cmVhbSA/IGh0dHBfb3B0aW9ucy5tZXRob2QgOiAnR0VUJzsKICAgIHZhciBhc3luYyA9ICEhIChjb250ZXh0ICYmIGNvbnRleHQuc3RyZWFtX3BhcmFtcyAmJiBjb250ZXh0LnN0cmVhbV9wYXJhbXNbJ3BocGpzLmFzeW5jJ10pOwoKICAgIGlmIChpbmlbJ3BocGpzLmFqYXhCeXBhc3NDYWNoZSddICYmIGluaVsncGhwanMuYWpheEJ5cGFzc0NhY2hlJ10ubG9jYWxfdmFsdWUpIHsKICAgICAgdXJsICs9ICh1cmwubWF0Y2goL1w/LykgPT0gbnVsbCA/ICc/JyA6ICcmJykgKyAobmV3IERhdGUoKSkKICAgICAgICAuZ2V0VGltZSgpOyAvLyBHaXZlIG9wdGlvbmFsIG1lYW5zIG9mIGZvcmNpbmcgYnlwYXNzIG9mIGNhY2hlCiAgICB9CgogICAgcmVxLm9wZW4obWV0aG9kLCB1cmwsIGFzeW5jKTsKICAgIGlmIChhc3luYykgewogICAgICB2YXIgbm90aWZpY2F0aW9uID0gY29udGV4dC5zdHJlYW1fcGFyYW1zLm5vdGlmaWNhdGlvbjsKICAgICAgaWYgKHR5cGVvZiBub3RpZmljYXRpb24gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAvLyBGaXg6IG1ha2Ugd29yayB3aXRoIHJlcS5hZGRFdmVudExpc3RlbmVyIGlmIGF2YWlsYWJsZTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvRW4vVXNpbmdfWE1MSHR0cFJlcXVlc3QKICAgICAgICBpZiAoMCAmJiByZXEuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgICAgLy8gVW5pbXBsZW1lbnRlZCBzbyBkb24ndCBhbGxvdyB0byBnZXQgaGVyZQogICAgICAgICAgLyoKICAgICAgICAgIHJlcS5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIHVwZGF0ZVByb2dyZXNzLCBmYWxzZSk7CiAgICAgICAgICByZXEuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIHRyYW5zZmVyQ29tcGxldGUsIGZhbHNlKTsKICAgICAgICAgIHJlcS5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIHRyYW5zZmVyRmFpbGVkLCBmYWxzZSk7CiAgICAgICAgICByZXEuYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCB0cmFuc2ZlckNhbmNlbGVkLCBmYWxzZSk7CiAgICAgICAgICAqLwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXEub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKGFFdnQpIHsKICAgICAgICAgICAgLy8gYUV2dCBoYXMgc3RvcFByb3BhZ2F0aW9uKCksIHByZXZlbnREZWZhdWx0KCk7IHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9Oc0lET01FdmVudAogICAgICAgICAgICAvLyBPdGhlciBYTUxIdHRwUmVxdWVzdCBwcm9wZXJ0aWVzOiBtdWx0aXBhcnQsIHJlc3BvbnNlWE1MLCBzdGF0dXMsIHN0YXR1c1RleHQsIHVwbG9hZCwgd2l0aENyZWRlbnRpYWxzCiAgICAgICAgICAgIC8qCiAgUEhQIENvbnN0YW50czoKICBTVFJFQU1fTk9USUZZX1JFU09MVkUgICAxICAgICAgIEEgcmVtb3RlIGFkZHJlc3MgcmVxdWlyZWQgZm9yIHRoaXMgc3RyZWFtIGhhcyBiZWVuIHJlc29sdmVkLCBvciB0aGUgcmVzb2x1dGlvbiBmYWlsZWQuIFNlZSBzZXZlcml0eSAgZm9yIGFuIGluZGljYXRpb24gb2Ygd2hpY2ggaGFwcGVuZWQuCiAgU1RSRUFNX05PVElGWV9DT05ORUNUICAgMiAgICAgQSBjb25uZWN0aW9uIHdpdGggYW4gZXh0ZXJuYWwgcmVzb3VyY2UgaGFzIGJlZW4gZXN0YWJsaXNoZWQuCiAgU1RSRUFNX05PVElGWV9BVVRIX1JFUVVJUkVEIDMgICAgIEFkZGl0aW9uYWwgYXV0aG9yaXphdGlvbiBpcyByZXF1aXJlZCB0byBhY2Nlc3MgdGhlIHNwZWNpZmllZCByZXNvdXJjZS4gVHlwaWNhbCBpc3N1ZWQgd2l0aCBzZXZlcml0eSBsZXZlbCBvZiBTVFJFQU1fTk9USUZZX1NFVkVSSVRZX0VSUi4KICBTVFJFQU1fTk9USUZZX01JTUVfVFlQRV9JUyAgNCAgICAgVGhlIG1pbWUtdHlwZSBvZiByZXNvdXJjZSBoYXMgYmVlbiBpZGVudGlmaWVkLCByZWZlciB0byBtZXNzYWdlIGZvciBhIGRlc2NyaXB0aW9uIG9mIHRoZSBkaXNjb3ZlcmVkIHR5cGUuCiAgU1RSRUFNX05PVElGWV9GSUxFX1NJWkVfSVMgIDUgICAgIFRoZSBzaXplIG9mIHRoZSByZXNvdXJjZSBoYXMgYmVlbiBkaXNjb3ZlcmVkLgogIFNUUkVBTV9OT1RJRllfUkVESVJFQ1RFRCAgICA2ICAgICBUaGUgZXh0ZXJuYWwgcmVzb3VyY2UgaGFzIHJlZGlyZWN0ZWQgdGhlIHN0cmVhbSB0byBhbiBhbHRlcm5hdGUgbG9jYXRpb24uIFJlZmVyIHRvIG1lc3NhZ2UgLgogIFNUUkVBTV9OT1RJRllfUFJPR1JFU1MgIDcgICAgIEluZGljYXRlcyBjdXJyZW50IHByb2dyZXNzIG9mIHRoZSBzdHJlYW0gdHJhbnNmZXIgaW4gYnl0ZXNfdHJhbnNmZXJyZWQgYW5kIHBvc3NpYmx5IGJ5dGVzX21heCBhcyB3ZWxsLgogIFNUUkVBTV9OT1RJRllfQ09NUExFVEVEIDggICAgIFRoZXJlIGlzIG5vIG1vcmUgZGF0YSBhdmFpbGFibGUgb24gdGhlIHN0cmVhbS4KICBTVFJFQU1fTk9USUZZX0ZBSUxVUkUgICA5ICAgICBBIGdlbmVyaWMgZXJyb3Igb2NjdXJyZWQgb24gdGhlIHN0cmVhbSwgY29uc3VsdCBtZXNzYWdlIGFuZCBtZXNzYWdlX2NvZGUgZm9yIGRldGFpbHMuCiAgU1RSRUFNX05PVElGWV9BVVRIX1JFU1VMVCAgIDEwICAgICBBdXRob3JpemF0aW9uIGhhcyBiZWVuIGNvbXBsZXRlZCAod2l0aCBvciB3aXRob3V0IHN1Y2Nlc3MpLgoKICBTVFJFQU1fTk9USUZZX1NFVkVSSVRZX0lORk8gMCAgICAgTm9ybWFsLCBub24tZXJyb3IgcmVsYXRlZCwgbm90aWZpY2F0aW9uLgogIFNUUkVBTV9OT1RJRllfU0VWRVJJVFlfV0FSTiAxICAgICBOb24gY3JpdGljYWwgZXJyb3IgY29uZGl0aW9uLiBQcm9jZXNzaW5nIG1heSBjb250aW51ZS4KICBTVFJFQU1fTk9USUZZX1NFVkVSSVRZX0VSUiAgMiAgICAgQSBjcml0aWNhbCBlcnJvciBvY2N1cnJlZC4gUHJvY2Vzc2luZyBjYW5ub3QgY29udGludWUuCiAgKi8KICAgICAgICAgICAgdmFyIG9iakNvbnRleHQgPSB7CiAgICAgICAgICAgICAgcmVzcG9uc2VUZXh0OiByZXEucmVzcG9uc2VUZXh0LAogICAgICAgICAgICAgIHJlc3BvbnNlWE1MOiByZXEucmVzcG9uc2VYTUwsCiAgICAgICAgICAgICAgc3RhdHVzOiByZXEuc3RhdHVzLAogICAgICAgICAgICAgIHN0YXR1c1RleHQ6IHJlcS5zdGF0dXNUZXh0LAogICAgICAgICAgICAgIHJlYWR5U3RhdGU6IHJlcS5yZWFkeVN0YXRlLAogICAgICAgICAgICAgIGV2dDogYUV2dAogICAgICAgICAgICB9OyAvLyBwcm9wZXJ0aWVzIGFyZSBub3QgYXZhaWxhYmxlIGluIFBIUCwgYnV0IG9mZmVyZWQgb24gbm90aWZpY2F0aW9uIHZpYSAndGhpcycgZm9yIGNvbnZlbmllbmNlCiAgICAgICAgICAgIC8vIG5vdGlmaWNhdGlvbiBhcmdzOiBub3RpZmljYXRpb25fY29kZSwgc2V2ZXJpdHksIG1lc3NhZ2UsIG1lc3NhZ2VfY29kZSwgYnl0ZXNfdHJhbnNmZXJyZWQsIGJ5dGVzX21heCAoYWxsIGludCdzIGV4Y2VwdCBzdHJpbmcgJ21lc3NhZ2UnKQogICAgICAgICAgICAvLyBOZWVkIHRvIGFkZCBtZXNzYWdlLCBldGMuCiAgICAgICAgICAgIHZhciBieXRlc190cmFuc2ZlcnJlZDsKICAgICAgICAgICAgc3dpdGNoIChyZXEucmVhZHlTdGF0ZSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgLy8gICAgIFVOSU5JVElBTElaRUQgICAgIG9wZW4oKSBoYXMgbm90IGJlZW4gY2FsbGVkIHlldC4KICAgICAgICAgICAgICBub3RpZmljYXRpb24uY2FsbChvYmpDb250ZXh0LCAwLCAwLCAnJywgMCwgMCwgMCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAvLyAgICAgTE9BRElORyAgICAgc2VuZCgpIGhhcyBub3QgYmVlbiBjYWxsZWQgeWV0LgogICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5jYWxsKG9iakNvbnRleHQsIDAsIDAsICcnLCAwLCAwLCAwKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIC8vICAgICBMT0FERUQgICAgIHNlbmQoKSBoYXMgYmVlbiBjYWxsZWQsIGFuZCBoZWFkZXJzIGFuZCBzdGF0dXMgYXJlIGF2YWlsYWJsZS4KICAgICAgICAgICAgICBub3RpZmljYXRpb24uY2FsbChvYmpDb250ZXh0LCAwLCAwLCAnJywgMCwgMCwgMCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAvLyAgICAgSU5URVJBQ1RJVkUgICAgIERvd25sb2FkaW5nOyByZXNwb25zZVRleHQgaG9sZHMgcGFydGlhbCBkYXRhLgogICAgICAgICAgICAgIC8vIE9uZSBjaGFyYWN0ZXIgaXMgdHdvIGJ5dGVzCiAgICAgICAgICAgICAgYnl0ZXNfdHJhbnNmZXJyZWQgPSByZXEucmVzcG9uc2VUZXh0Lmxlbmd0aCAqIDI7CiAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLmNhbGwob2JqQ29udGV4dCwgNywgMCwgJycsIDAsIGJ5dGVzX3RyYW5zZmVycmVkLCAwKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIC8vICAgICBDT01QTEVURUQgICAgIFRoZSBvcGVyYXRpb24gaXMgY29tcGxldGUuCiAgICAgICAgICAgICAgaWYgKHJlcS5zdGF0dXMgPj0gMjAwICYmIHJlcS5zdGF0dXMgPCA0MDApIHsKICAgICAgICAgICAgICAgIC8vIE9uZSBjaGFyYWN0ZXIgaXMgdHdvIGJ5dGVzCiAgICAgICAgICAgICAgICBieXRlc190cmFuc2ZlcnJlZCA9IHJlcS5yZXNwb25zZVRleHQubGVuZ3RoICogMjsKICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5jYWxsKG9iakNvbnRleHQsIDgsIDAsICcnLCByZXEuc3RhdHVzLCBieXRlc190cmFuc2ZlcnJlZCwgMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXEuc3RhdHVzID09PSA0MDMpIHsKICAgICAgICAgICAgICAgIC8vIEZpeDogVGhlc2UgdHdvIGFyZSBmaW5pc2hlZCBleGNlcHQgZm9yIG1lc3NhZ2UKICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5jYWxsKG9iakNvbnRleHQsIDEwLCAyLCAnJywgcmVxLnN0YXR1cywgMCwgMCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEVycm9ycwogICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLmNhbGwob2JqQ29udGV4dCwgOSwgMiwgJycsIHJlcS5zdGF0dXMsIDAsIDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyAnVW5yZWNvZ25pemVkIHJlYWR5IHN0YXRlIGZvciBmaWxlX2dldF9jb250ZW50cygpJzsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAoaHR0cF9zdHJlYW0pIHsKICAgICAgdmFyIHNlbmRIZWFkZXJzID0gKGh0dHBfb3B0aW9ucy5oZWFkZXIgJiYgaHR0cF9vcHRpb25zLmhlYWRlci5zcGxpdCgvXHI/XG4vKSkgfHwgW107CiAgICAgIHZhciB1c2VyQWdlbnRTZW50ID0gZmFsc2U7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBzZW5kSGVhZGVycy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBzZW5kSGVhZGVyID0gc2VuZEhlYWRlcnNbaV07CiAgICAgICAgdmFyIGJyZWFrUG9zID0gc2VuZEhlYWRlci5zZWFyY2goLzpccyovKTsKICAgICAgICB2YXIgc2VuZEhlYWRlck5hbWUgPSBzZW5kSGVhZGVyLnN1YnN0cmluZygwLCBicmVha1Bvcyk7CiAgICAgICAgcmVxLnNldFJlcXVlc3RIZWFkZXIoc2VuZEhlYWRlck5hbWUsIHNlbmRIZWFkZXIuc3Vic3RyaW5nKGJyZWFrUG9zICsgMSkpOwogICAgICAgIGlmIChzZW5kSGVhZGVyTmFtZSA9PT0gJ1VzZXItQWdlbnQnKSB7CiAgICAgICAgICB1c2VyQWdlbnRTZW50ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCF1c2VyQWdlbnRTZW50KSB7CiAgICAgICAgdmFyIHVzZXJfYWdlbnQgPSBodHRwX29wdGlvbnMudXNlcl9hZ2VudCB8fCAoaW5pLnVzZXJfYWdlbnQgJiYgaW5pLnVzZXJfYWdlbnQubG9jYWxfdmFsdWUpOwogICAgICAgIGlmICh1c2VyX2FnZW50KSB7CiAgICAgICAgICByZXEuc2V0UmVxdWVzdEhlYWRlcignVXNlci1BZ2VudCcsIHVzZXJfYWdlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgICBjb250ZW50ID0gaHR0cF9vcHRpb25zLmNvbnRlbnQgfHwgbnVsbDsKICAgICAgLyoKICAgICAgLy8gUHJlc2VudGx5IHVuaW1wbGVtZW50ZWQgSFRUUCBjb250ZXh0IG9wdGlvbnMKICAgICAgLy8gV2hlbiBzZXQgdG8gVFJVRSwgdGhlIGVudGlyZSBVUkkgd2lsbCBiZSB1c2VkIHdoZW4gY29uc3RydWN0aW5nIHRoZSByZXF1ZXN0LiAoaS5lLiBHRVQgaHR0cDovL3d3dy5leGFtcGxlLmNvbS9wYXRoL3RvL2ZpbGUuaHRtbCBIVFRQLzEuMCkuIFdoaWxlIHRoaXMgaXMgYSBub24tc3RhbmRhcmQgcmVxdWVzdCBmb3JtYXQsIHNvbWUgcHJveHkgc2VydmVycyByZXF1aXJlIGl0LgogICAgICB2YXIgcmVxdWVzdF9mdWxsdXJpID0gaHR0cF9vcHRpb25zLnJlcXVlc3RfZnVsbHVyaSB8fCBmYWxzZTsKICAgICAgLy8gVGhlIG1heCBudW1iZXIgb2YgcmVkaXJlY3RzIHRvIGZvbGxvdy4gVmFsdWUgMSBvciBsZXNzIG1lYW5zIHRoYXQgbm8gcmVkaXJlY3RzIGFyZSBmb2xsb3dlZC4KICAgICAgdmFyIG1heF9yZWRpcmVjdHMgPSBodHRwX29wdGlvbnMubWF4X3JlZGlyZWN0cyB8fCAyMDsKICAgICAgLy8gSFRUUCBwcm90b2NvbCB2ZXJzaW9uCiAgICAgIHZhciBwcm90b2NvbF92ZXJzaW9uID0gaHR0cF9vcHRpb25zLnByb3RvY29sX3ZlcnNpb24gfHwgMS4wOwogICAgICAvLyBSZWFkIHRpbWVvdXQgaW4gc2Vjb25kcywgc3BlY2lmaWVkIGJ5IGEgZmxvYXQKICAgICAgdmFyIHRpbWVvdXQgPSBodHRwX29wdGlvbnMudGltZW91dCB8fCAoaW5pLmRlZmF1bHRfc29ja2V0X3RpbWVvdXQgJiYgaW5pLmRlZmF1bHRfc29ja2V0X3RpbWVvdXQubG9jYWxfdmFsdWUpOwogICAgICAvLyBGZXRjaCB0aGUgY29udGVudCBldmVuIG9uIGZhaWx1cmUgc3RhdHVzIGNvZGVzLgogICAgICB2YXIgaWdub3JlX2Vycm9ycyA9IGh0dHBfb3B0aW9ucy5pZ25vcmVfZXJyb3JzIHx8IGZhbHNlOwogICAgICAqLwogICAgfQoKICAgIGlmIChmbGFnTmFtZXMgJiBPUFRTLkZJTEVfVEVYVCkgewogICAgICAvLyBPdmVycmlkZXMgaG93IGVuY29kaW5nIGlzIHRyZWF0ZWQgKHJlZ2FyZGxlc3Mgb2Ygd2hhdCBpcyByZXR1cm5lZCBmcm9tIHRoZSBzZXJ2ZXIpCiAgICAgIHZhciBjb250ZW50X3R5cGUgPSAndGV4dC9odG1sJzsKICAgICAgaWYgKGh0dHBfb3B0aW9ucyAmJiBodHRwX29wdGlvbnNbJ3BocGpzLm92ZXJyaWRlJ10pIHsKICAgICAgICAvLyBGaXg6IENvdWxkIGFsbG93IGZvciBub24tSFRUUCBhcyB3ZWxsCiAgICAgICAgLy8gV2UgdXNlIHRoaXMsIGUuZy4sIGluIGdldHRleHQtcmVsYXRlZCBmdW5jdGlvbnMgaWYgY2hhcmFjdGVyIHNldAogICAgICAgIGNvbnRlbnRfdHlwZSA9IGh0dHBfb3B0aW9uc1sncGhwanMub3ZlcnJpZGUnXTsKICAgICAgICAvLyAgIG92ZXJyaWRkZW4gZWFybGllciBieSBiaW5kX3RleHRkb21haW5fY29kZXNldCgpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGVuY29kaW5nID0gKGluaVsndW5pY29kZS5zdHJlYW1fZW5jb2RpbmcnXSAmJiBpbmlbJ3VuaWNvZGUuc3RyZWFtX2VuY29kaW5nJ10ubG9jYWxfdmFsdWUpIHx8CiAgICAgICAgICAnVVRGLTgnOwogICAgICAgIGlmIChodHRwX29wdGlvbnMgJiYgaHR0cF9vcHRpb25zLmhlYWRlciAmJiAoL15jb250ZW50LXR5cGU6L2ltKQogICAgICAgICAgLnRlc3QoaHR0cF9vcHRpb25zLmhlYWRlcikpIHsKICAgICAgICAgIC8vIFdlJ2xsIGFzc3VtZSBhIGNvbnRlbnQtdHlwZSBleHBlY3RzIGl0cyBvd24gc3BlY2lmaWVkIGVuY29kaW5nIGlmIHByZXNlbnQKICAgICAgICAgIC8vIFdlIGxldCBhbnkgaGVhZGVyIGVuY29kaW5nIHN0YW5kCiAgICAgICAgICBjb250ZW50X3R5cGUgPSBodHRwX29wdGlvbnMuaGVhZGVyLm1hdGNoKC9eY29udGVudC10eXBlOlxzKiguKikkL2ltKVsxXTsKICAgICAgICB9CiAgICAgICAgaWYgKCEoLztccypjaGFyc2V0PS8pCiAgICAgICAgICAudGVzdChjb250ZW50X3R5cGUpKSB7CiAgICAgICAgICAvLyBJZiBubyBlbmNvZGluZwogICAgICAgICAgY29udGVudF90eXBlICs9ICc7IGNoYXJzZXQ9JyArIGVuY29kaW5nOwogICAgICAgIH0KICAgICAgfQogICAgICByZXEub3ZlcnJpZGVNaW1lVHlwZShjb250ZW50X3R5cGUpOwogICAgfQogICAgLy8gRGVmYXVsdCBpcyBGSUxFX0JJTkFSWSwgYnV0IGZvciBiaW5hcnksIHdlIGFwcGFyZW50bHkgZGV2aWF0ZSBmcm9tIFBIUCBpbiByZXF1aXJpbmcgdGhlIGZsYWcsIHNpbmNlIG1hbnkgaWYgbm90CiAgICAvLyAgICAgbW9zdCBwZW9wbGUgd2lsbCBhbHNvIHdhbnQgYSB3YXkgdG8gaGF2ZSBpdCBiZSBhdXRvLWNvbnZlcnRlZCBpbnRvIG5hdGl2ZSBKYXZhU2NyaXB0IHRleHQgaW5zdGVhZAogICAgZWxzZSBpZiAoZmxhZ05hbWVzICYgT1BUUy5GSUxFX0JJTkFSWSkgewogICAgICAvLyBUcmljayBhdCBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9Fbi9Vc2luZ19YTUxIdHRwUmVxdWVzdCB0byBnZXQgYmluYXJ5CiAgICAgIHJlcS5vdmVycmlkZU1pbWVUeXBlKCd0ZXh0L3BsYWluOyBjaGFyc2V0PXgtdXNlci1kZWZpbmVkJyk7CiAgICAgIC8vIEdldHRpbmcgYW4gaW5kaXZpZHVhbCBieXRlIHRoZW4gcmVxdWlyZXM6CiAgICAgIC8vIHRocm93IGF3YXkgaGlnaC1vcmRlciBieXRlIChmNykgd2hlcmUgeCBpcyAwIHRvIHJlc3BvbnNlVGV4dC5sZW5ndGgtMSAoc2VlIG5vdGVzIGluIG91ciBzdWJzdHIoKSkKICAgICAgLy8gcmVzcG9uc2VUZXh0LmNoYXJDb2RlQXQoeCkgJiAweEZGOwogICAgfQoKICAgIHRyeSB7CiAgICAgIGlmIChodHRwX29wdGlvbnMgJiYgaHR0cF9vcHRpb25zWydwaHBqcy5zZW5kQXNCaW5hcnknXSkgewogICAgICAgIC8vIEZvciBjb250ZW50IHNlbnQgaW4gYSBQT1NUIG9yIFBVVCByZXF1ZXN0ICh1c2Ugd2l0aCBmaWxlX3B1dF9jb250ZW50cygpPykKICAgICAgICAvLyBJbiBGaXJlZm94LCBvbmx5IGF2YWlsYWJsZSBGRjMrCiAgICAgICAgcmVxLnNlbmRBc0JpbmFyeShjb250ZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXEuc2VuZChjb250ZW50KTsKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAvLyBjYXRjaGVzIGV4Y2VwdGlvbiByZXBvcnRlZCBpbiBpc3N1ZSAjNjYKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHRtcCA9IHJlcS5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTsKICAgIGlmICh0bXApIHsKICAgICAgdG1wID0gdG1wLnNwbGl0KCdcbicpOwogICAgICBmb3IgKGsgPSAwOyBrIDwgdG1wLmxlbmd0aDsgaysrKSB7CiAgICAgICAgaWYgKGZ1bmModG1wW2tdKSkgewogICAgICAgICAgbmV3VG1wLnB1c2godG1wW2tdKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdG1wID0gbmV3VG1wOwogICAgICBmb3IgKGkgPSAwOyBpIDwgdG1wLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaGVhZGVyc1tpXSA9IHRtcFtpXTsKICAgICAgfQogICAgICAvLyBzZWUgaHR0cDovL3BocC5uZXQvbWFudWFsL2VuL3Jlc2VydmVkLnZhcmlhYmxlcy5odHRwcmVzcG9uc2VoZWFkZXIucGhwCiAgICAgIHRoaXMuJGh0dHBfcmVzcG9uc2VfaGVhZGVyID0gaGVhZGVyczsKICAgIH0KCiAgICBpZiAob2Zmc2V0IHx8IG1heExlbikgewogICAgICBpZiAobWF4TGVuKSB7CiAgICAgICAgcmV0dXJuIHJlcS5yZXNwb25zZVRleHQuc3Vic3RyKG9mZnNldCB8fCAwLCBtYXhMZW4pOwogICAgICB9CiAgICAgIHJldHVybiByZXEucmVzcG9uc2VUZXh0LnN1YnN0cihvZmZzZXQpOwogICAgfQogICAgcmV0dXJuIHJlcS5yZXNwb25zZVRleHQ7CiAgfQogIHJldHVybiBmYWxzZTsKfQ==",
                "body": "ZnVuY3Rpb24gZmlsZV9nZXRfY29udGVudHModXJsLCBmbGFncywgY29udGV4dCwgb2Zmc2V0LCBtYXhMZW4pIHsKICAvLyAgZGlzY3VzcyBhdDogaHR0cDovL3BocGpzLm9yZy9mdW5jdGlvbnMvZmlsZV9nZXRfY29udGVudHMvCiAgLy8gb3JpZ2luYWwgYnk6IExlZ2FldiBBbmRyZXkKICAvLyAgICBpbnB1dCBieTogSmFuaSBIYXJ0aWthaW5lbgogIC8vICAgIGlucHV0IGJ5OiBSYXBoYWVsIChBbykgUlVETEVSCiAgLy8gaW1wcm92ZWQgYnk6IEtldmluIHZhbiBab25uZXZlbGQgKGh0dHA6Ly9rZXZpbi52YW56b25uZXZlbGQubmV0KQogIC8vIGltcHJvdmVkIGJ5OiBCcmV0dCBaYW1pciAoaHR0cDovL2JyZXR0LXphbWlyLm1lKQogIC8vIGJ1Z2ZpeGVkIGJ5OiBCcmV0dCBaYW1pciAoaHR0cDovL2JyZXR0LXphbWlyLm1lKQogIC8vICAgICAgICBub3RlOiBUaGlzIGZ1bmN0aW9uIHVzZXMgWG1sSHR0cFJlcXVlc3QgYW5kIGNhbm5vdCByZXRyaWV2ZSByZXNvdXJjZSBmcm9tIGRpZmZlcmVudCBkb21haW4gd2l0aG91dCBtb2RpZmljYXRpb25zLgogIC8vICAgICAgICBub3RlOiBTeW5jaHJvbm91cyBieSBkZWZhdWx0IChhcyBpbiBQSFApIHNvIG1heSBsb2NrIHVwIGJyb3dzZXIuIENhbgogIC8vICAgICAgICBub3RlOiBnZXQgYXN5bmMgYnkgc2V0dGluZyBhIGN1c3RvbSAicGhwanMuYXN5bmMiIHByb3BlcnR5IHRvIHRydWUgYW5kICJub3RpZmljYXRpb24iIGZvciBhbgogIC8vICAgICAgICBub3RlOiBvcHRpb25hbCBjYWxsYmFjayAoYm90aCBhcyBjb250ZXh0IHBhcmFtcywgd2l0aCByZXNwb25zZVRleHQsIGFuZCBvdGhlciBKUy1zcGVjaWZpYwogIC8vICAgICAgICBub3RlOiByZXF1ZXN0IHByb3BlcnRpZXMgYXZhaWxhYmxlIHZpYSAndGhpcycpLiBOb3RlIHRoYXQgZmlsZV9nZXRfY29udGVudHMoKSB3aWxsIG5vdCByZXR1cm4gdGhlIHRleHQKICAvLyAgICAgICAgbm90ZTogaW4gc3VjaCBhIGNhc2UgKHVzZSB0aGlzLnJlc3BvbnNlVGV4dCB3aXRoaW4gdGhlIGNhbGxiYWNrKS4gT3IsIGNvbnNpZGVyIHVzaW5nCiAgLy8gICAgICAgIG5vdGU6IGpRdWVyeSdzOiAkKCcjZGl2SWQnKS5sb2FkKCdodHRwOi8vdXJsJykgaW5zdGVhZC4KICAvLyAgICAgICAgbm90ZTogVGhlIGNvbnRleHQgYXJndW1lbnQgaXMgb25seSBpbXBsZW1lbnRlZCBmb3IgaHR0cCwgYW5kIG9ubHkgcGFydGlhbGx5IChzZWUgYmVsb3cgZm9yCiAgLy8gICAgICAgIG5vdGU6ICJQcmVzZW50bHkgdW5pbXBsZW1lbnRlZCBIVFRQIGNvbnRleHQgb3B0aW9ucyIpOyBhbHNvIHRoZSBhcmd1bWVudHMgcGFzc2VkIHRvCiAgLy8gICAgICAgIG5vdGU6IG5vdGlmaWNhdGlvbiBhcmUgaW5jb21wbGV0ZQogIC8vICAgICAgICB0ZXN0OiBza2lwCiAgLy8gICBleGFtcGxlIDE6IHZhciBidWYgZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly9nb29nbGUuY29tJyk7CiAgLy8gICBleGFtcGxlIDE6IGJ1Zi5pbmRleE9mKCdHb29nbGUnKSAhPT0gLTEKICAvLyAgIHJldHVybnMgMTogdHJ1ZQoKICB2YXIgdG1wLCBoZWFkZXJzID0gW10sCiAgICBuZXdUbXAgPSBbXSwKICAgIGsgPSAwLAogICAgaSA9IDAsCiAgICBocmVmID0gJycsCiAgICBwYXRoUG9zID0gLTEsCiAgICBmbGFnTmFtZXMgPSAwLAogICAgY29udGVudCA9IG51bGwsCiAgICBodHRwX3N0cmVhbSA9IGZhbHNlOwogIHZhciBmdW5jID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUuc3Vic3RyaW5nKDEpICE9PSAnJzsKICB9OwoKICAvLyBCRUdJTiBSRURVTkRBTlQKICB0aGlzLnBocF9qcyA9IHRoaXMucGhwX2pzIHx8IHt9OwogIHRoaXMucGhwX2pzLmluaSA9IHRoaXMucGhwX2pzLmluaSB8fCB7fTsKICAvLyBFTkQgUkVEVU5EQU5UCiAgdmFyIGluaSA9IHRoaXMucGhwX2pzLmluaTsKICBjb250ZXh0ID0gY29udGV4dCB8fCB0aGlzLnBocF9qcy5kZWZhdWx0X3N0cmVhbXNfY29udGV4dCB8fCBudWxsOwoKICBpZiAoIWZsYWdzKSB7CiAgICBmbGFncyA9IDA7CiAgfQogIHZhciBPUFRTID0gewogICAgRklMRV9VU0VfSU5DTFVERV9QQVRIOiAxLAogICAgRklMRV9URVhUOiAzMiwKICAgIEZJTEVfQklOQVJZOiA2NAogIH07CiAgaWYgKHR5cGVvZiBmbGFncyA9PT0gJ251bWJlcicpIHsKICAgIC8vIEFsbG93IGZvciBhIHNpbmdsZSBzdHJpbmcgb3IgYW4gYXJyYXkgb2Ygc3RyaW5nIGZsYWdzCiAgICBmbGFnTmFtZXMgPSBmbGFnczsKICB9IGVsc2UgewogICAgZmxhZ3MgPSBbXS5jb25jYXQoZmxhZ3MpOwogICAgZm9yIChpID0gMDsgaSA8IGZsYWdzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChPUFRTW2ZsYWdzW2ldXSkgewogICAgICAgIGZsYWdOYW1lcyA9IGZsYWdOYW1lcyB8IE9QVFNbZmxhZ3NbaV1dOwogICAgICB9CiAgICB9CiAgfQoKICBpZiAoZmxhZ05hbWVzICYgT1BUUy5GSUxFX0JJTkFSWSAmJiAoZmxhZ05hbWVzICYgT1BUUy5GSUxFX1RFWFQpKSB7CiAgICAvLyBUaGVzZSBmbGFncyBzaG91bGRuJ3QgYmUgdG9nZXRoZXIKICAgIHRocm93ICdZb3UgY2Fubm90IHBhc3MgYm90aCBGSUxFX0JJTkFSWSBhbmQgRklMRV9URVhUIHRvIGZpbGVfZ2V0X2NvbnRlbnRzKCknOwogIH0KCiAgaWYgKChmbGFnTmFtZXMgJiBPUFRTLkZJTEVfVVNFX0lOQ0xVREVfUEFUSCkgJiYgaW5pLmluY2x1ZGVfcGF0aCAmJiBpbmkuaW5jbHVkZV9wYXRoLmxvY2FsX3ZhbHVlKSB7CiAgICB2YXIgc2xhc2ggPSBpbmkuaW5jbHVkZV9wYXRoLmxvY2FsX3ZhbHVlLmluZGV4T2YoJy8nKSAhPT0gLTEgPyAnLycgOiAnXFwnOwogICAgdXJsID0gaW5pLmluY2x1ZGVfcGF0aC5sb2NhbF92YWx1ZSArIHNsYXNoICsgdXJsOwogIH0gZWxzZSBpZiAoIS9eKGh0dHBzP3xmaWxlKTovLnRlc3QodXJsKSkgewogICAgLy8gQWxsb3cgcmVmZXJlbmNlcyB3aXRoaW4gb3IgYmVsb3cgdGhlIHNhbWUgZGlyZWN0b3J5IChzaG91bGQgZml4IHRvIGFsbG93IG90aGVyIHJlbGF0aXZlIHJlZmVyZW5jZXMgb3Igcm9vdCByZWZlcmVuY2U7IGNvdWxkIG1ha2UgZGVwZW5kZW50IG9uIHBhcnNlX3VybCgpKQogICAgaHJlZiA9IHRoaXMud2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICBwYXRoUG9zID0gdXJsLmluZGV4T2YoJy8nKSA9PT0gMCA/IGhyZWYuaW5kZXhPZignLycsIDgpIC0gMSA6IGhyZWYubGFzdEluZGV4T2YoJy8nKTsKICAgIHVybCA9IGhyZWYuc2xpY2UoMCwgcGF0aFBvcyArIDEpICsgdXJsOwogIH0KCiAgdmFyIGh0dHBfb3B0aW9uczsKICBpZiAoY29udGV4dCkgewogICAgaHR0cF9vcHRpb25zID0gY29udGV4dC5zdHJlYW1fb3B0aW9ucyAmJiBjb250ZXh0LnN0cmVhbV9vcHRpb25zLmh0dHA7CiAgICBodHRwX3N0cmVhbSA9ICEhaHR0cF9vcHRpb25zOwogIH0KCiAgaWYgKCFjb250ZXh0IHx8ICFjb250ZXh0LnN0cmVhbV9vcHRpb25zIHx8IGh0dHBfc3RyZWFtKSB7CiAgICB2YXIgcmVxID0gdGhpcy53aW5kb3cuQWN0aXZlWE9iamVjdCA/IG5ldyBBY3RpdmVYT2JqZWN0KCdNaWNyb3NvZnQuWE1MSFRUUCcpIDogbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICBpZiAoIXJlcSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1hNTEh0dHBSZXF1ZXN0IG5vdCBzdXBwb3J0ZWQnKTsKICAgIH0KCiAgICB2YXIgbWV0aG9kID0gaHR0cF9zdHJlYW0gPyBodHRwX29wdGlvbnMubWV0aG9kIDogJ0dFVCc7CiAgICB2YXIgYXN5bmMgPSAhISAoY29udGV4dCAmJiBjb250ZXh0LnN0cmVhbV9wYXJhbXMgJiYgY29udGV4dC5zdHJlYW1fcGFyYW1zWydwaHBqcy5hc3luYyddKTsKCiAgICBpZiAoaW5pWydwaHBqcy5hamF4QnlwYXNzQ2FjaGUnXSAmJiBpbmlbJ3BocGpzLmFqYXhCeXBhc3NDYWNoZSddLmxvY2FsX3ZhbHVlKSB7CiAgICAgIHVybCArPSAodXJsLm1hdGNoKC9cPy8pID09IG51bGwgPyAnPycgOiAnJicpICsgKG5ldyBEYXRlKCkpCiAgICAgICAgLmdldFRpbWUoKTsgLy8gR2l2ZSBvcHRpb25hbCBtZWFucyBvZiBmb3JjaW5nIGJ5cGFzcyBvZiBjYWNoZQogICAgfQoKICAgIHJlcS5vcGVuKG1ldGhvZCwgdXJsLCBhc3luYyk7CiAgICBpZiAoYXN5bmMpIHsKICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IGNvbnRleHQuc3RyZWFtX3BhcmFtcy5ub3RpZmljYXRpb247CiAgICAgIGlmICh0eXBlb2Ygbm90aWZpY2F0aW9uID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgLy8gRml4OiBtYWtlIHdvcmsgd2l0aCByZXEuYWRkRXZlbnRMaXN0ZW5lciBpZiBhdmFpbGFibGU6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL0VuL1VzaW5nX1hNTEh0dHBSZXF1ZXN0CiAgICAgICAgaWYgKDAgJiYgcmVxLmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgIC8vIFVuaW1wbGVtZW50ZWQgc28gZG9uJ3QgYWxsb3cgdG8gZ2V0IGhlcmUKICAgICAgICAgIC8qCiAgICAgICAgICByZXEuYWRkRXZlbnRMaXN0ZW5lcigncHJvZ3Jlc3MnLCB1cGRhdGVQcm9ncmVzcywgZmFsc2UpOwogICAgICAgICAgcmVxLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCB0cmFuc2ZlckNvbXBsZXRlLCBmYWxzZSk7CiAgICAgICAgICByZXEuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0cmFuc2ZlckZhaWxlZCwgZmFsc2UpOwogICAgICAgICAgcmVxLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgdHJhbnNmZXJDYW5jZWxlZCwgZmFsc2UpOwogICAgICAgICAgKi8KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVxLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uIChhRXZ0KSB7CiAgICAgICAgICAgIC8vIGFFdnQgaGFzIHN0b3BQcm9wYWdhdGlvbigpLCBwcmV2ZW50RGVmYXVsdCgpOyBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vTnNJRE9NRXZlbnQKICAgICAgICAgICAgLy8gT3RoZXIgWE1MSHR0cFJlcXVlc3QgcHJvcGVydGllczogbXVsdGlwYXJ0LCByZXNwb25zZVhNTCwgc3RhdHVzLCBzdGF0dXNUZXh0LCB1cGxvYWQsIHdpdGhDcmVkZW50aWFscwogICAgICAgICAgICAvKgogIFBIUCBDb25zdGFudHM6CiAgU1RSRUFNX05PVElGWV9SRVNPTFZFICAgMSAgICAgICBBIHJlbW90ZSBhZGRyZXNzIHJlcXVpcmVkIGZvciB0aGlzIHN0cmVhbSBoYXMgYmVlbiByZXNvbHZlZCwgb3IgdGhlIHJlc29sdXRpb24gZmFpbGVkLiBTZWUgc2V2ZXJpdHkgIGZvciBhbiBpbmRpY2F0aW9uIG9mIHdoaWNoIGhhcHBlbmVkLgogIFNUUkVBTV9OT1RJRllfQ09OTkVDVCAgIDIgICAgIEEgY29ubmVjdGlvbiB3aXRoIGFuIGV4dGVybmFsIHJlc291cmNlIGhhcyBiZWVuIGVzdGFibGlzaGVkLgogIFNUUkVBTV9OT1RJRllfQVVUSF9SRVFVSVJFRCAzICAgICBBZGRpdGlvbmFsIGF1dGhvcml6YXRpb24gaXMgcmVxdWlyZWQgdG8gYWNjZXNzIHRoZSBzcGVjaWZpZWQgcmVzb3VyY2UuIFR5cGljYWwgaXNzdWVkIHdpdGggc2V2ZXJpdHkgbGV2ZWwgb2YgU1RSRUFNX05PVElGWV9TRVZFUklUWV9FUlIuCiAgU1RSRUFNX05PVElGWV9NSU1FX1RZUEVfSVMgIDQgICAgIFRoZSBtaW1lLXR5cGUgb2YgcmVzb3VyY2UgaGFzIGJlZW4gaWRlbnRpZmllZCwgcmVmZXIgdG8gbWVzc2FnZSBmb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGUgZGlzY292ZXJlZCB0eXBlLgogIFNUUkVBTV9OT1RJRllfRklMRV9TSVpFX0lTICA1ICAgICBUaGUgc2l6ZSBvZiB0aGUgcmVzb3VyY2UgaGFzIGJlZW4gZGlzY292ZXJlZC4KICBTVFJFQU1fTk9USUZZX1JFRElSRUNURUQgICAgNiAgICAgVGhlIGV4dGVybmFsIHJlc291cmNlIGhhcyByZWRpcmVjdGVkIHRoZSBzdHJlYW0gdG8gYW4gYWx0ZXJuYXRlIGxvY2F0aW9uLiBSZWZlciB0byBtZXNzYWdlIC4KICBTVFJFQU1fTk9USUZZX1BST0dSRVNTICA3ICAgICBJbmRpY2F0ZXMgY3VycmVudCBwcm9ncmVzcyBvZiB0aGUgc3RyZWFtIHRyYW5zZmVyIGluIGJ5dGVzX3RyYW5zZmVycmVkIGFuZCBwb3NzaWJseSBieXRlc19tYXggYXMgd2VsbC4KICBTVFJFQU1fTk9USUZZX0NPTVBMRVRFRCA4ICAgICBUaGVyZSBpcyBubyBtb3JlIGRhdGEgYXZhaWxhYmxlIG9uIHRoZSBzdHJlYW0uCiAgU1RSRUFNX05PVElGWV9GQUlMVVJFICAgOSAgICAgQSBnZW5lcmljIGVycm9yIG9jY3VycmVkIG9uIHRoZSBzdHJlYW0sIGNvbnN1bHQgbWVzc2FnZSBhbmQgbWVzc2FnZV9jb2RlIGZvciBkZXRhaWxzLgogIFNUUkVBTV9OT1RJRllfQVVUSF9SRVNVTFQgICAxMCAgICAgQXV0aG9yaXphdGlvbiBoYXMgYmVlbiBjb21wbGV0ZWQgKHdpdGggb3Igd2l0aG91dCBzdWNjZXNzKS4KCiAgU1RSRUFNX05PVElGWV9TRVZFUklUWV9JTkZPIDAgICAgIE5vcm1hbCwgbm9uLWVycm9yIHJlbGF0ZWQsIG5vdGlmaWNhdGlvbi4KICBTVFJFQU1fTk9USUZZX1NFVkVSSVRZX1dBUk4gMSAgICAgTm9uIGNyaXRpY2FsIGVycm9yIGNvbmRpdGlvbi4gUHJvY2Vzc2luZyBtYXkgY29udGludWUuCiAgU1RSRUFNX05PVElGWV9TRVZFUklUWV9FUlIgIDIgICAgIEEgY3JpdGljYWwgZXJyb3Igb2NjdXJyZWQuIFByb2Nlc3NpbmcgY2Fubm90IGNvbnRpbnVlLgogICovCiAgICAgICAgICAgIHZhciBvYmpDb250ZXh0ID0gewogICAgICAgICAgICAgIHJlc3BvbnNlVGV4dDogcmVxLnJlc3BvbnNlVGV4dCwKICAgICAgICAgICAgICByZXNwb25zZVhNTDogcmVxLnJlc3BvbnNlWE1MLAogICAgICAgICAgICAgIHN0YXR1czogcmVxLnN0YXR1cywKICAgICAgICAgICAgICBzdGF0dXNUZXh0OiByZXEuc3RhdHVzVGV4dCwKICAgICAgICAgICAgICByZWFkeVN0YXRlOiByZXEucmVhZHlTdGF0ZSwKICAgICAgICAgICAgICBldnQ6IGFFdnQKICAgICAgICAgICAgfTsgLy8gcHJvcGVydGllcyBhcmUgbm90IGF2YWlsYWJsZSBpbiBQSFAsIGJ1dCBvZmZlcmVkIG9uIG5vdGlmaWNhdGlvbiB2aWEgJ3RoaXMnIGZvciBjb252ZW5pZW5jZQogICAgICAgICAgICAvLyBub3RpZmljYXRpb24gYXJnczogbm90aWZpY2F0aW9uX2NvZGUsIHNldmVyaXR5LCBtZXNzYWdlLCBtZXNzYWdlX2NvZGUsIGJ5dGVzX3RyYW5zZmVycmVkLCBieXRlc19tYXggKGFsbCBpbnQncyBleGNlcHQgc3RyaW5nICdtZXNzYWdlJykKICAgICAgICAgICAgLy8gTmVlZCB0byBhZGQgbWVzc2FnZSwgZXRjLgogICAgICAgICAgICB2YXIgYnl0ZXNfdHJhbnNmZXJyZWQ7CiAgICAgICAgICAgIHN3aXRjaCAocmVxLnJlYWR5U3RhdGUpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIC8vICAgICBVTklOSVRJQUxJWkVEICAgICBvcGVuKCkgaGFzIG5vdCBiZWVuIGNhbGxlZCB5ZXQuCiAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLmNhbGwob2JqQ29udGV4dCwgMCwgMCwgJycsIDAsIDAsIDApOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgLy8gICAgIExPQURJTkcgICAgIHNlbmQoKSBoYXMgbm90IGJlZW4gY2FsbGVkIHlldC4KICAgICAgICAgICAgICBub3RpZmljYXRpb24uY2FsbChvYmpDb250ZXh0LCAwLCAwLCAnJywgMCwgMCwgMCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAvLyAgICAgTE9BREVEICAgICBzZW5kKCkgaGFzIGJlZW4gY2FsbGVkLCBhbmQgaGVhZGVycyBhbmQgc3RhdHVzIGFyZSBhdmFpbGFibGUuCiAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLmNhbGwob2JqQ29udGV4dCwgMCwgMCwgJycsIDAsIDAsIDApOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgLy8gICAgIElOVEVSQUNUSVZFICAgICBEb3dubG9hZGluZzsgcmVzcG9uc2VUZXh0IGhvbGRzIHBhcnRpYWwgZGF0YS4KICAgICAgICAgICAgICAvLyBPbmUgY2hhcmFjdGVyIGlzIHR3byBieXRlcwogICAgICAgICAgICAgIGJ5dGVzX3RyYW5zZmVycmVkID0gcmVxLnJlc3BvbnNlVGV4dC5sZW5ndGggKiAyOwogICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5jYWxsKG9iakNvbnRleHQsIDcsIDAsICcnLCAwLCBieXRlc190cmFuc2ZlcnJlZCwgMCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAvLyAgICAgQ09NUExFVEVEICAgICBUaGUgb3BlcmF0aW9uIGlzIGNvbXBsZXRlLgogICAgICAgICAgICAgIGlmIChyZXEuc3RhdHVzID49IDIwMCAmJiByZXEuc3RhdHVzIDwgNDAwKSB7CiAgICAgICAgICAgICAgICAvLyBPbmUgY2hhcmFjdGVyIGlzIHR3byBieXRlcwogICAgICAgICAgICAgICAgYnl0ZXNfdHJhbnNmZXJyZWQgPSByZXEucmVzcG9uc2VUZXh0Lmxlbmd0aCAqIDI7CiAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uY2FsbChvYmpDb250ZXh0LCA4LCAwLCAnJywgcmVxLnN0YXR1cywgYnl0ZXNfdHJhbnNmZXJyZWQsIDApOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLnN0YXR1cyA9PT0gNDAzKSB7CiAgICAgICAgICAgICAgICAvLyBGaXg6IFRoZXNlIHR3byBhcmUgZmluaXNoZWQgZXhjZXB0IGZvciBtZXNzYWdlCiAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uY2FsbChvYmpDb250ZXh0LCAxMCwgMiwgJycsIHJlcS5zdGF0dXMsIDAsIDApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBFcnJvcnMKICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5jYWxsKG9iakNvbnRleHQsIDksIDIsICcnLCByZXEuc3RhdHVzLCAwLCAwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgJ1VucmVjb2duaXplZCByZWFkeSBzdGF0ZSBmb3IgZmlsZV9nZXRfY29udGVudHMoKSc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGh0dHBfc3RyZWFtKSB7CiAgICAgIHZhciBzZW5kSGVhZGVycyA9IChodHRwX29wdGlvbnMuaGVhZGVyICYmIGh0dHBfb3B0aW9ucy5oZWFkZXIuc3BsaXQoL1xyP1xuLykpIHx8IFtdOwogICAgICB2YXIgdXNlckFnZW50U2VudCA9IGZhbHNlOwogICAgICBmb3IgKGkgPSAwOyBpIDwgc2VuZEhlYWRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgc2VuZEhlYWRlciA9IHNlbmRIZWFkZXJzW2ldOwogICAgICAgIHZhciBicmVha1BvcyA9IHNlbmRIZWFkZXIuc2VhcmNoKC86XHMqLyk7CiAgICAgICAgdmFyIHNlbmRIZWFkZXJOYW1lID0gc2VuZEhlYWRlci5zdWJzdHJpbmcoMCwgYnJlYWtQb3MpOwogICAgICAgIHJlcS5zZXRSZXF1ZXN0SGVhZGVyKHNlbmRIZWFkZXJOYW1lLCBzZW5kSGVhZGVyLnN1YnN0cmluZyhicmVha1BvcyArIDEpKTsKICAgICAgICBpZiAoc2VuZEhlYWRlck5hbWUgPT09ICdVc2VyLUFnZW50JykgewogICAgICAgICAgdXNlckFnZW50U2VudCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghdXNlckFnZW50U2VudCkgewogICAgICAgIHZhciB1c2VyX2FnZW50ID0gaHR0cF9vcHRpb25zLnVzZXJfYWdlbnQgfHwgKGluaS51c2VyX2FnZW50ICYmIGluaS51c2VyX2FnZW50LmxvY2FsX3ZhbHVlKTsKICAgICAgICBpZiAodXNlcl9hZ2VudCkgewogICAgICAgICAgcmVxLnNldFJlcXVlc3RIZWFkZXIoJ1VzZXItQWdlbnQnLCB1c2VyX2FnZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29udGVudCA9IGh0dHBfb3B0aW9ucy5jb250ZW50IHx8IG51bGw7CiAgICAgIC8qCiAgICAgIC8vIFByZXNlbnRseSB1bmltcGxlbWVudGVkIEhUVFAgY29udGV4dCBvcHRpb25zCiAgICAgIC8vIFdoZW4gc2V0IHRvIFRSVUUsIHRoZSBlbnRpcmUgVVJJIHdpbGwgYmUgdXNlZCB3aGVuIGNvbnN0cnVjdGluZyB0aGUgcmVxdWVzdC4gKGkuZS4gR0VUIGh0dHA6Ly93d3cuZXhhbXBsZS5jb20vcGF0aC90by9maWxlLmh0bWwgSFRUUC8xLjApLiBXaGlsZSB0aGlzIGlzIGEgbm9uLXN0YW5kYXJkIHJlcXVlc3QgZm9ybWF0LCBzb21lIHByb3h5IHNlcnZlcnMgcmVxdWlyZSBpdC4KICAgICAgdmFyIHJlcXVlc3RfZnVsbHVyaSA9IGh0dHBfb3B0aW9ucy5yZXF1ZXN0X2Z1bGx1cmkgfHwgZmFsc2U7CiAgICAgIC8vIFRoZSBtYXggbnVtYmVyIG9mIHJlZGlyZWN0cyB0byBmb2xsb3cuIFZhbHVlIDEgb3IgbGVzcyBtZWFucyB0aGF0IG5vIHJlZGlyZWN0cyBhcmUgZm9sbG93ZWQuCiAgICAgIHZhciBtYXhfcmVkaXJlY3RzID0gaHR0cF9vcHRpb25zLm1heF9yZWRpcmVjdHMgfHwgMjA7CiAgICAgIC8vIEhUVFAgcHJvdG9jb2wgdmVyc2lvbgogICAgICB2YXIgcHJvdG9jb2xfdmVyc2lvbiA9IGh0dHBfb3B0aW9ucy5wcm90b2NvbF92ZXJzaW9uIHx8IDEuMDsKICAgICAgLy8gUmVhZCB0aW1lb3V0IGluIHNlY29uZHMsIHNwZWNpZmllZCBieSBhIGZsb2F0CiAgICAgIHZhciB0aW1lb3V0ID0gaHR0cF9vcHRpb25zLnRpbWVvdXQgfHwgKGluaS5kZWZhdWx0X3NvY2tldF90aW1lb3V0ICYmIGluaS5kZWZhdWx0X3NvY2tldF90aW1lb3V0LmxvY2FsX3ZhbHVlKTsKICAgICAgLy8gRmV0Y2ggdGhlIGNvbnRlbnQgZXZlbiBvbiBmYWlsdXJlIHN0YXR1cyBjb2Rlcy4KICAgICAgdmFyIGlnbm9yZV9lcnJvcnMgPSBodHRwX29wdGlvbnMuaWdub3JlX2Vycm9ycyB8fCBmYWxzZTsKICAgICAgKi8KICAgIH0KCiAgICBpZiAoZmxhZ05hbWVzICYgT1BUUy5GSUxFX1RFWFQpIHsKICAgICAgLy8gT3ZlcnJpZGVzIGhvdyBlbmNvZGluZyBpcyB0cmVhdGVkIChyZWdhcmRsZXNzIG9mIHdoYXQgaXMgcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyKQogICAgICB2YXIgY29udGVudF90eXBlID0gJ3RleHQvaHRtbCc7CiAgICAgIGlmIChodHRwX29wdGlvbnMgJiYgaHR0cF9vcHRpb25zWydwaHBqcy5vdmVycmlkZSddKSB7CiAgICAgICAgLy8gRml4OiBDb3VsZCBhbGxvdyBmb3Igbm9uLUhUVFAgYXMgd2VsbAogICAgICAgIC8vIFdlIHVzZSB0aGlzLCBlLmcuLCBpbiBnZXR0ZXh0LXJlbGF0ZWQgZnVuY3Rpb25zIGlmIGNoYXJhY3RlciBzZXQKICAgICAgICBjb250ZW50X3R5cGUgPSBodHRwX29wdGlvbnNbJ3BocGpzLm92ZXJyaWRlJ107CiAgICAgICAgLy8gICBvdmVycmlkZGVuIGVhcmxpZXIgYnkgYmluZF90ZXh0ZG9tYWluX2NvZGVzZXQoKQogICAgICB9IGVsc2UgewogICAgICAgIHZhciBlbmNvZGluZyA9IChpbmlbJ3VuaWNvZGUuc3RyZWFtX2VuY29kaW5nJ10gJiYgaW5pWyd1bmljb2RlLnN0cmVhbV9lbmNvZGluZyddLmxvY2FsX3ZhbHVlKSB8fAogICAgICAgICAgJ1VURi04JzsKICAgICAgICBpZiAoaHR0cF9vcHRpb25zICYmIGh0dHBfb3B0aW9ucy5oZWFkZXIgJiYgKC9eY29udGVudC10eXBlOi9pbSkKICAgICAgICAgIC50ZXN0KGh0dHBfb3B0aW9ucy5oZWFkZXIpKSB7CiAgICAgICAgICAvLyBXZSdsbCBhc3N1bWUgYSBjb250ZW50LXR5cGUgZXhwZWN0cyBpdHMgb3duIHNwZWNpZmllZCBlbmNvZGluZyBpZiBwcmVzZW50CiAgICAgICAgICAvLyBXZSBsZXQgYW55IGhlYWRlciBlbmNvZGluZyBzdGFuZAogICAgICAgICAgY29udGVudF90eXBlID0gaHR0cF9vcHRpb25zLmhlYWRlci5tYXRjaCgvXmNvbnRlbnQtdHlwZTpccyooLiopJC9pbSlbMV07CiAgICAgICAgfQogICAgICAgIGlmICghKC87XHMqY2hhcnNldD0vKQogICAgICAgICAgLnRlc3QoY29udGVudF90eXBlKSkgewogICAgICAgICAgLy8gSWYgbm8gZW5jb2RpbmcKICAgICAgICAgIGNvbnRlbnRfdHlwZSArPSAnOyBjaGFyc2V0PScgKyBlbmNvZGluZzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmVxLm92ZXJyaWRlTWltZVR5cGUoY29udGVudF90eXBlKTsKICAgIH0KICAgIC8vIERlZmF1bHQgaXMgRklMRV9CSU5BUlksIGJ1dCBmb3IgYmluYXJ5LCB3ZSBhcHBhcmVudGx5IGRldmlhdGUgZnJvbSBQSFAgaW4gcmVxdWlyaW5nIHRoZSBmbGFnLCBzaW5jZSBtYW55IGlmIG5vdAogICAgLy8gICAgIG1vc3QgcGVvcGxlIHdpbGwgYWxzbyB3YW50IGEgd2F5IHRvIGhhdmUgaXQgYmUgYXV0by1jb252ZXJ0ZWQgaW50byBuYXRpdmUgSmF2YVNjcmlwdCB0ZXh0IGluc3RlYWQKICAgIGVsc2UgaWYgKGZsYWdOYW1lcyAmIE9QVFMuRklMRV9CSU5BUlkpIHsKICAgICAgLy8gVHJpY2sgYXQgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvRW4vVXNpbmdfWE1MSHR0cFJlcXVlc3QgdG8gZ2V0IGJpbmFyeQogICAgICByZXEub3ZlcnJpZGVNaW1lVHlwZSgndGV4dC9wbGFpbjsgY2hhcnNldD14LXVzZXItZGVmaW5lZCcpOwogICAgICAvLyBHZXR0aW5nIGFuIGluZGl2aWR1YWwgYnl0ZSB0aGVuIHJlcXVpcmVzOgogICAgICAvLyB0aHJvdyBhd2F5IGhpZ2gtb3JkZXIgYnl0ZSAoZjcpIHdoZXJlIHggaXMgMCB0byByZXNwb25zZVRleHQubGVuZ3RoLTEgKHNlZSBub3RlcyBpbiBvdXIgc3Vic3RyKCkpCiAgICAgIC8vIHJlc3BvbnNlVGV4dC5jaGFyQ29kZUF0KHgpICYgMHhGRjsKICAgIH0KCiAgICB0cnkgewogICAgICBpZiAoaHR0cF9vcHRpb25zICYmIGh0dHBfb3B0aW9uc1sncGhwanMuc2VuZEFzQmluYXJ5J10pIHsKICAgICAgICAvLyBGb3IgY29udGVudCBzZW50IGluIGEgUE9TVCBvciBQVVQgcmVxdWVzdCAodXNlIHdpdGggZmlsZV9wdXRfY29udGVudHMoKT8pCiAgICAgICAgLy8gSW4gRmlyZWZveCwgb25seSBhdmFpbGFibGUgRkYzKwogICAgICAgIHJlcS5zZW5kQXNCaW5hcnkoY29udGVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVxLnNlbmQoY29udGVudCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgLy8gY2F0Y2hlcyBleGNlcHRpb24gcmVwb3J0ZWQgaW4gaXNzdWUgIzY2CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB0bXAgPSByZXEuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCk7CiAgICBpZiAodG1wKSB7CiAgICAgIHRtcCA9IHRtcC5zcGxpdCgnXG4nKTsKICAgICAgZm9yIChrID0gMDsgayA8IHRtcC5sZW5ndGg7IGsrKykgewogICAgICAgIGlmIChmdW5jKHRtcFtrXSkpIHsKICAgICAgICAgIG5ld1RtcC5wdXNoKHRtcFtrXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRtcCA9IG5ld1RtcDsKICAgICAgZm9yIChpID0gMDsgaSA8IHRtcC5sZW5ndGg7IGkrKykgewogICAgICAgIGhlYWRlcnNbaV0gPSB0bXBbaV07CiAgICAgIH0KICAgICAgLy8gc2VlIGh0dHA6Ly9waHAubmV0L21hbnVhbC9lbi9yZXNlcnZlZC52YXJpYWJsZXMuaHR0cHJlc3BvbnNlaGVhZGVyLnBocAogICAgICB0aGlzLiRodHRwX3Jlc3BvbnNlX2hlYWRlciA9IGhlYWRlcnM7CiAgICB9CgogICAgaWYgKG9mZnNldCB8fCBtYXhMZW4pIHsKICAgICAgaWYgKG1heExlbikgewogICAgICAgIHJldHVybiByZXEucmVzcG9uc2VUZXh0LnN1YnN0cihvZmZzZXQgfHwgMCwgbWF4TGVuKTsKICAgICAgfQogICAgICByZXR1cm4gcmVxLnJlc3BvbnNlVGV4dC5zdWJzdHIob2Zmc2V0KTsKICAgIH0KICAgIHJldHVybiByZXEucmVzcG9uc2VUZXh0OwogIH0KICByZXR1cm4gZmFsc2U7Cn0=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 22:00:11 GMT",
                    "Content-Length": "13331",
                    "Date": "Fri, 07 Nov 2014 22:00:14 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}