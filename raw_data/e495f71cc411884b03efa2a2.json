{
    "url": "http://localhost:9999/mrdoob/three.js/docs/",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.hash</b> and written to <b>the 'source' property of a DOM element</b> via the following statements:<ul><li>var hash = window.location.hash.substring( 1 ).split(DELIMITER);</li><li>goTo( decodeUrl(hash[0]), decodeUrl(hash[1]), decodeUrl(member[0]), decodeUrl(member.length &gt; 1 ? member[1] : '') );</li><li>return path.replace(/_/g, ' ').replace(/\\./g, ' / ');</li><li>goTo( decodeUrl(hash[0]), decodeUrl(hash[1]), decodeUrl(member[0]), decodeUrl(member.length &gt; 1 ? member[1] : '') );</li><li>parts = section.split(MEMBER_DELIMITER)</li><li>member = parts[1];</li><li>viewer.src = pages[ section ][ category ][ name ] + '.html' + (!!member ? '#'+member : '');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/mrdoob/three.js/docs/",
                "path": "/mrdoob/three.js/docs/",
                "httpVersion": "HTTP/0.0",
                "method": "GET",
                "headers": {
                    "Referer": "http://localhost:9999/mrdoob/three.js/docs",
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9tcmRvb2IvdGhyZWUuanMvZG9jcy8gSFRUUC8wLjANCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQpSZWZlcmVyOiBodHRwOi8vbG9jYWxob3N0Ojk5OTkvbXJkb29iL3RocmVlLmpzL2RvY3MNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogODc4NA0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogdGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04DQpEYXRlOiBTYXQsIDA4IE5vdiAyMDE0IDE1OjM3OjU2IEdNVA0KTGFzdC1Nb2RpZmllZDogU2F0LCAwOCBOb3YgMjAxNCAxNTozNzo1NCBHTVQNCg0KPCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCTxoZWFkPgoJCTxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4KCQk8dGl0bGU+dGhyZWUuanMgLSBkb2N1bWVudGF0aW9uPC90aXRsZT4KCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCB1c2VyLXNjYWxhYmxlPW5vLCBtaW5pbXVtLXNjYWxlPTEuMCwgbWF4aW11bS1zY2FsZT0xLjAiPgoJCTxzdHlsZT4KCQkJQGZvbnQtZmFjZSB7CgkJCQlmb250LWZhbWlseTogJ2luY29uc29sYXRhJzsKCQkJCXNyYzogdXJsKCdmaWxlcy9pbmNvbnNvbGF0YS53b2ZmJykgZm9ybWF0KCd3b2ZmJyk7CgkJCQlmb250LXdlaWdodDogbm9ybWFsOwoJCQkJZm9udC1zdHlsZTogbm9ybWFsOwoJCQl9CgoJCQkqeyBib3gtc2l6aW5nOiBib3JkZXItYm94O30KCgkJCWh0bWwgewoJCQkJaGVpZ2h0OiAxMDAlOwoJCQl9CgoJCQlib2R5IHsKCQkJCWJhY2tncm91bmQtY29sb3I6ICNmZmZmZmY7CgkJCQltYXJnaW46IDA7CgkJCQlwYWRkaW5nOiAwIDAgMCAyNjBweDsKCQkJCWhlaWdodDogMTAwJTsKCQkJCWNvbG9yOiAjNTU1OwoJCQkJZm9udC1mYW1pbHk6ICdpbmNvbnNvbGF0YSc7CgkJCQlmb250LXNpemU6IDE1cHg7CgkJCQlsaW5lLWhlaWdodDogMThweDsKCQkJCW92ZXJmbG93OiBoaWRkZW47CgkJCX0KCgkJCWEgewoJCQkJY29sb3I6ICMyMTk0Q0U7CgkJCQl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgkJCX0KCgkJCSNwYW5lbAl7CgkJCQlwb3NpdGlvbjogZml4ZWQ7CgkJCQlsZWZ0OiAwcHg7CgkJCQl3aWR0aDogMjYwcHg7CgkJCQloZWlnaHQ6IDEwMCU7CgkJCQlvdmVyZmxvdzogYXV0bzsKCQkJCWJhY2tncm91bmQ6ICNmYWZhZmE7CgkJCX0KCgkJCQkjcGFuZWwgaDEgewoJCQkJCW1hcmdpbi10b3A6IDMwcHg7CgkJCQkJbWFyZ2luLWJvdHRvbTogNDBweDsKCQkJCQltYXJnaW4tbGVmdDogMjBweDsKCQkJCQlmb250LXNpemU6IDI1cHg7CgkJCQkJZm9udC13ZWlnaHQ6IG5vcm1hbDsKCQkJCX0KCgkJCQkjcGFuZWwgaDIgewoJCQkJCWNvbG9yOiAjNDU0NTQ1OwoJCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCQlmb250LXdlaWdodDogbm9ybWFsOwoKCQkJCQltYXJnaW4tdG9wOiAyMHB4OwoJCQkJCW1hcmdpbi1sZWZ0OiAyMHB4OwoJCQkJfQoKCQkJCSNwYW5lbCBoMyB7CgkJCQkJY29sb3I6ICM2NjY7CgkJCQkJZm9udC1zaXplOiAxNnB4OwoJCQkJCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgoJCQkJCW1hcmdpbi10b3A6IDIwcHg7CgkJCQkJbWFyZ2luLWxlZnQ6IDIwcHg7CgkJCQl9CgoJCQkJI3BhbmVsIHVsIHsKCQkJCQlsaXN0LXN0eWxlLXR5cGU6IG5vbmU7CgkJCQkJcGFkZGluZzogMHB4OwoJCQkJCW1hcmdpbi1sZWZ0OiAyMHB4OwoJCQkJfQoKCQkJI3ZpZXdlciB7CgkJCQlib3JkZXI6IDBweDsKCQkJCXdpZHRoOiAxMDAlOwoJCQkJaGVpZ2h0OiAxMDAlOwoJCQkJb3ZlcmZsb3c6IGF1dG87CgkJCX0KCgkJCS5maWx0ZXJCbG9ja3sKCQkJCW1hcmdpbjogMjBweDsKCQkJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQkJfQoJCQkuZmlsdGVyQmxvY2sgcCB7CgkJCQltYXJnaW46IDA7CgkJCX0KCQkJI2ZpbHRlcklucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQkJcGFkZGluZzogNXB4OwoJCQkJZm9udC1mYW1pbHk6IGluaGVyaXQ7CgkJCQlmb250LXNpemU6IDE1cHg7CgkJCQlvdXRsaW5lOiBub25lOwoJCQkJYm9yZGVyOiAxcHggc29saWQgI2RlZGVkZTsKCQkJfQoJCQkjZmlsdGVySW5wdXQ6Zm9jdXN7CgkJCQlib3JkZXI6IDFweCBzb2xpZCAjMjE5NENFOwoJCQl9CgkJCSNjbGVhckZpbHRlckJ1dHRvbiB7CgkJCQlwb3NpdGlvbjogYWJzb2x1dGU7IAoJCQkJcmlnaHQ6IDZweDsKCQkJCXRvcDogNTAlOwoJCQkJbWFyZ2luLXRvcDogLThweDsKCQkJCXdpZHRoOiAxNnB4OwoJCQkJaGVpZ2h0OiAxNnB4OwoJCQkJZm9udC1zaXplOiAxNHB4OwoJCQkJY29sb3I6IGdyZXk7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlsaW5lLWhlaWdodDogMDsKCQkJCXBhZGRpbmctdG9wOiA3cHg7CgkJCQlvcGFjaXR5OiAuNTsKCQkJfQoJCQkjY2xlYXJGaWx0ZXJCdXR0b246aG92ZXJ7CgkJCQlvcGFjaXR5OiAxOwoJCQl9CgkJCS5maWx0ZXJlZHsKCQkJCWRpc3BsYXk6IG5vbmU7CgkJCX0KCQkJI3BhbmVsIGxpIGJ7CgkJCQlmb250LXdlaWdodDogYm9sZDsKCQkJfQoJCQkjZXhwYW5kQnV0dG9uewoJCQkJZGlzcGxheTogbm9uZTsKCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCXJpZ2h0OiAyMHB4OwoJCQkJdG9wOiAxMnB4OwoJCQkJd2lkdGg6IDMycHg7CgkJCQloZWlnaHQ6IDMycHg7CgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjMjE5NENFOwoJCQl9CgkJCSNleHBhbmRCdXR0b24gc3BhbnsKCQkJCWhlaWdodDogM3B4OwoJCQkJYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CgkJCQl3aWR0aDogMTZweDsKCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCWxlZnQ6IDhweDsKCQkJCXRvcDogOHB4OwoJCQl9CgkJCSNleHBhbmRCdXR0b24gc3BhbjpudGgtY2hpbGQoMSkgewoJCQkJdG9wOiAxNHB4OwoJCQl9CgkJCSNleHBhbmRCdXR0b24gc3BhbjpudGgtY2hpbGQoMikgewoJCQkJdG9wOiAyMHB4OwoJCQkJd2lkdGg6IDEycHg7CgkJCX0KCQkJQG1lZGlhIGFsbCBhbmQgKCBtYXgtd2lkdGg6IDY0MHB4ICkgewoJCQkJI3BhbmVsewoJCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCQlsZWZ0OiAwOwoJCQkJCXRvcDogMDsKCQkJCQloZWlnaHQ6IDQ4MHB4OwoJCQkJCXdpZHRoOiAxMDAlOwoJCQkJCXJpZ2h0OiAwOwoJCQkJCXotaW5kZXg6IDEwMDsKCQkJCQlvdmVyZmxvdzogaGlkZGVuOwoJCQkJCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGVkZWRlOwoJCQkJfQoJCQkJI2NvbnRlbnR7CgkJCQkJb3ZlcmZsb3c6IGF1dG87CgkJCQkJcG9zaXRpb246IGFic29sdXRlOwoJCQkJCWxlZnQ6IDA7CgkJCQkJdG9wOiAxMjBweDsKCQkJCQlyaWdodDogMDsKCQkJCQlib3R0b206IDA7CgkJCQl9CgkJCQkjdmlld2VyewoJCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCQlsZWZ0OiAwOwoJCQkJCXRvcDogNDhweDsKCQkJCX0KCQkJCSNleHBhbmRCdXR0b257CgkJCQkJZGlzcGxheTogYmxvY2s7CgkJCQl9CgkJCQkjcGFuZWwuY29sbGFwc2VkewoJCQkJCWhlaWdodDogNTZweDsKCQkJCX0KCQkJCSNwYW5lbCBoMXsKCQkJCQltYXJnaW4tdG9wOiAyMHB4OwoJCQkJCW1hcmdpbi1ib3R0b206IDIwcHg7CgkJCQl9CgkJCQkjY29udGVudHsKCQkJCQl0b3A6IDkwcHg7CgkJCQl9CgkJCX0KCQk8L3N0eWxlPgoJPC9oZWFkPgoJPGJvZHk+CgoJCTxkaXYgaWQ9InBhbmVsIiBjbGFzcz0iY29sbGFwc2VkIj4KCQkJPGEgaWQ9ImV4cGFuZEJ1dHRvbiIgaHJlZj0iIyIgPgoJCQkJPHNwYW4+PC9zcGFuPjxzcGFuPjwvc3Bhbj48c3Bhbj48L3NwYW4+CgkJCTwvYT4KCQkJPGgxPjxhIGhyZWY9Imh0dHA6Ly90aHJlZWpzLm9yZyI+dGhyZWUuanM8L2E+IC8gZG9jczwvaDE+CgkJCTxkaXYgY2xhc3M9ImZpbHRlckJsb2NrIiA+CgkJCQk8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImZpbHRlcklucHV0IiBwbGFjZWhvbGRlcj0iVHlwZSB0byBmaWx0ZXIiLz4KCQkJCTxhIGhyZWY9IiMiIGlkPSJjbGVhckZpbHRlckJ1dHRvbiIgPng8L2E+CgkJCTwvZGl2PgoJCQk8ZGl2IGlkPSJjb250ZW50IiA+CgkJCTwvZGl2PgoJCTwvZGl2PgoJCTxpZnJhbWUgaWQ9InZpZXdlciI+PC9pZnJhbWU+CgoJCTxzY3JpcHQgc3JjPSJsaXN0LmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0PgoJCQl2YXIgcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ3BhbmVsJyApOwoJCQl2YXIgdmlld2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICd2aWV3ZXInICk7CgoJCQl2YXIgY2xlYXJGaWx0ZXJCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ2NsZWFyRmlsdGVyQnV0dG9uJyApOwoJCQl2YXIgZmlsdGVySW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ2ZpbHRlcklucHV0JyApOwoJCQkvL2ZpbHRlcklucHV0LmZvY3VzKCk7CgoJCQlwYW5lbC5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHsKCQkJCS8vZmlsdGVySW5wdXQuZm9jdXMoKTsKCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJfSApOwoKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdleHBhbmRCdXR0b24nICkuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7CgkJCQlwYW5lbC5jbGFzc0xpc3QudG9nZ2xlKCAnY29sbGFwc2VkJyApOwoJCQkJaWYoICFwYW5lbC5jbGFzc0xpc3QuY29udGFpbnMoICdjb2xsYXBzZWQnICkgKSB7CgkJCQkJLy9maWx0ZXJJbnB1dC5mb2N1cygpOwoJCQkJfQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9ICk7CgoJCQl2YXIgREVMSU1JVEVSID0gJy8nOwoJCQl2YXIgTUVNQkVSX0RFTElNSVRFUiA9ICcuJzsKCQkJdmFyIG5hbWVDYXRlZ29yeU1hcCA9IHt9OwoJCQl2YXIgc2VjdGlvbnMgPSBbXTsKCgkJCXZhciBjb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdjb250ZW50JyApOwoKCQkJZm9yICggdmFyIHNlY3Rpb24gaW4gbGlzdCApIHsKCgkJCQl2YXIgaDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnaDInICk7CgkJCQloMi50ZXh0Q29udGVudCA9IHNlY3Rpb247CgoJCQkJY29udGVudC5hcHBlbmRDaGlsZCggaDIgKTsKCgkJCQlmb3IgKCB2YXIgY2F0ZWdvcnkgaW4gbGlzdFsgc2VjdGlvbiBdICkgewoKCQkJCQl2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCgkJCQkJdmFyIGgzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2gzJyApOwoJCQkJCWgzLnRleHRDb250ZW50ID0gY2F0ZWdvcnk7CgoJCQkJCWRpdi5hcHBlbmRDaGlsZCggaDMgKTsKCgkJCQkJdmFyIHVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3VsJyApOwoJCQkJCWRpdi5hcHBlbmRDaGlsZCggdWwgKTsKCgkJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgbGlzdFsgc2VjdGlvbiBdWyBjYXRlZ29yeSBdLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCXZhciBwYWdlID0gbGlzdFsgc2VjdGlvbiBdWyBjYXRlZ29yeSBdWyBpIF07CgoJCQkJCQl2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnbGknICk7CgkJCQkJCXZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2EnICk7CgkJCQkJCWEuc2V0QXR0cmlidXRlKCAnaHJlZicsICcjJyApOwoJCQkJCQkoIGZ1bmN0aW9uKCBzLCBjLCBwICkgeyAKCQkJCQkJCWEuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7CgkJCQkJCQkJZ29UbyggcywgYywgcCApOwoJCQkJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCX0gKSAKCQkJCQkJfSApKCBzZWN0aW9uLCBjYXRlZ29yeSwgcGFnZVsgMCBdICkKCQkJCQkJYS50ZXh0Q29udGVudCA9IHBhZ2VbIDAgXTsKCQkJCQkJbGkuYXBwZW5kQ2hpbGQoIGEgKTsKCQkJCQkJdWwuYXBwZW5kQ2hpbGQoIGxpICk7CgoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbcGFnZVswXV0gPSB7CgkJCQkJCQlzZWN0aW9uOiBzZWN0aW9uLAoJCQkJCQkJY2F0ZWdvcnk6IGNhdGVnb3J5LAoJCQkJCQkJbmFtZTogcGFnZVswXSwKCQkJCQkJCWVsZW1lbnQ6IGEKCQkJCQkJfTsKCgkJCQkJfQoKCQkJCQljb250ZW50LmFwcGVuZENoaWxkKCBkaXYgKTsKCQkJCQlzZWN0aW9ucy5wdXNoKCB1bCApOwoKCQkJCX0KCgoJCQl9CgoJCQlwYW5lbC5hcHBlbmRDaGlsZCggY29udGVudCApCgoJCQlmdW5jdGlvbiBsYXlvdXRMaXN0KCkgewoKCQkJCXNlY3Rpb25zLmZvckVhY2goIGZ1bmN0aW9uKCBlbCApIHsKCQkJCQl2YXIgY29sbGFwc2VkID0gdHJ1ZTsKCQkJCQlBcnJheS5wcm90b3R5cGUuc2xpY2UuYXBwbHkoIGVsLmNoaWxkcmVuICkuZm9yRWFjaCggZnVuY3Rpb24oIGl0ZW0gKSB7CgkJCQkJCWlmKCAhaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoICdmaWx0ZXJlZCcgKSApIHsKCQkJCQkJCWNvbGxhcHNlZCA9IGZhbHNlOwoJCQkJCQkJcmV0dXJuOwoJCQkJCQl9CgkJCQkJfSApOwoJCQkJCWlmKCBjb2xsYXBzZWQgKSB7CgkJCQkJCWVsLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCggJ2ZpbHRlcmVkJyApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWVsLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSggJ2ZpbHRlcmVkJyApOwoJCQkJCX0KCQkJCX0gKTsKCQkJfQoKCQkJZmlsdGVySW5wdXQuYWRkRXZlbnRMaXN0ZW5lciggJ2lucHV0JywgZnVuY3Rpb24oIGUgKSB7CgkJCQl1cGRhdGVGaWx0ZXIoKTsKCQkJfSApOwoKCQkJY2xlYXJGaWx0ZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7CgkJCQlmaWx0ZXJJbnB1dC52YWx1ZSA9ICcnOwoJCQkJdXBkYXRlRmlsdGVyKCk7CgkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCX0gKTsKCgkJCWZ1bmN0aW9uIHVwZGF0ZUZpbHRlcigpIHsKCgkJCQl2YXIgZXhwID0gbmV3IFJlZ0V4cCggZmlsdGVySW5wdXQudmFsdWUsICdnaScgKTsKCQkJCWZvciggdmFyIGogaW4gbmFtZUNhdGVnb3J5TWFwICkgewoJCQkJCXZhciByZXMgPSBuYW1lQ2F0ZWdvcnlNYXBbIGogXS5uYW1lLm1hdGNoKCBleHAgKTsKCQkJCQlpZiggcmVzICYmIHJlcy5sZW5ndGggPiAwICkgewoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbIGogXS5lbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSggJ2ZpbHRlcmVkJyApOwoJCQkJCQl2YXIgc3RyID0gbmFtZUNhdGVnb3J5TWFwWyBqIF0ubmFtZTsKCQkJCQkJZm9yKCB2YXIgaSA9IDA7IGkgPCByZXMubGVuZ3RoOyBpKysgKSB7CgkJCQkJCQlzdHIgPSBzdHIucmVwbGFjZSggcmVzWyBpIF0sICc8Yj4nICsgcmVzWyBpIF0gKyAnPC9iPicgKTsKCQkJCQkJfQoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbIGogXS5lbGVtZW50LmlubmVySFRNTCA9IHN0cjsKCQkJCQl9IGVsc2UgewoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbIGogXS5lbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCggJ2ZpbHRlcmVkJyApOwoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbIGogXS5lbGVtZW50LnRleHRDb250ZW50ID0gbmFtZUNhdGVnb3J5TWFwWyBqIF0ubmFtZTsKCQkJCQl9CgkJCQl9CgkJCQlsYXlvdXRMaXN0KCk7CgoJCQl9CgoJCQlmdW5jdGlvbiBlbmNvZGVVcmwoIHBhdGggKSB7CgoJCQkJcmV0dXJuIHBhdGgucmVwbGFjZSgvXCBcL1wgL2csICcuJykucmVwbGFjZSgvXCAvZywgJ18nKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIGRlY29kZVVybCggcGF0aCApIHsKCgkJCQlyZXR1cm4gcGF0aC5yZXBsYWNlKC9fL2csICcgJykucmVwbGFjZSgvXC4vZywgJyAvICcpOwoKCQkJfQoKCQkJLy8gUGFnZSBsb2FkaW5nCgoJCQlmdW5jdGlvbiBnb1RvKCBzZWN0aW9uLCBjYXRlZ29yeSwgbmFtZSwgbWVtYmVyICkgewoJCQkJdmFyIHBhcnRzLCBsb2NhdGlvbjsKCgkJCQkvLyBGdWxseSByZXNvbHZlIGxpbmtzIHRoYXQgb25seSBwcm92aWRlIGEgbmFtZQoJCQkJaWYoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CgoJCQkJCS8vIFJlc29sdmUgbGlua3Mgb2YgdGhlIGZvcm0gJ0NsYXNzLm1lbWJlcicKCQkJCQlpZihzZWN0aW9uLmluZGV4T2YoTUVNQkVSX0RFTElNSVRFUikgIT09IC0xKSB7CgkJCQkJCXBhcnRzID0gc2VjdGlvbi5zcGxpdChNRU1CRVJfREVMSU1JVEVSKQoJCQkJCQlzZWN0aW9uID0gcGFydHNbMF07IAoJCQkJCQltZW1iZXIgPSBwYXJ0c1sxXTsKCQkJCQl9CgoJCQkJCWxvY2F0aW9uID0gbmFtZUNhdGVnb3J5TWFwW3NlY3Rpb25dOwoJCQkJCWlmICghbG9jYXRpb24pIHJldHVybjsKCQkJCQlzZWN0aW9uID0gbG9jYXRpb24uc2VjdGlvbjsKCQkJCQljYXRlZ29yeSA9IGxvY2F0aW9uLmNhdGVnb3J5OwoJCQkJCW5hbWUgPSBsb2NhdGlvbi5uYW1lOwoJCQkJfSAKCgkJCQl2YXIgdGl0bGUgPSAndGhyZWUuanMgLSBkb2N1bWVudGF0aW9uIC0gJyArIHNlY3Rpb24gKyAnIC0gJyArIG5hbWU7CgkJCQl2YXIgdXJsID0gZW5jb2RlVXJsKHNlY3Rpb24pICsgREVMSU1JVEVSICsgZW5jb2RlVXJsKCBjYXRlZ29yeSApICsgREVMSU1JVEVSICsgZW5jb2RlVXJsKG5hbWUpICsgKCEhbWVtYmVyID8gTUVNQkVSX0RFTElNSVRFUiArIGVuY29kZVVybChtZW1iZXIpIDogJycpOwoKCQkJCXdpbmRvdy5sb2NhdGlvbi5oYXNoID0gdXJsOwoJCQkJd2luZG93LmRvY3VtZW50LnRpdGxlID0gdGl0bGU7CgoJCQkJdmlld2VyLnNyYyA9IHBhZ2VzWyBzZWN0aW9uIF1bIGNhdGVnb3J5IF1bIG5hbWUgXSArICcuaHRtbCcgKyAoISFtZW1iZXIgPyAnIycrbWVtYmVyIDogJycpOwoKCQkJCXBhbmVsLmNsYXNzTGlzdC5hZGQoICdjb2xsYXBzZWQnICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBnb1RvSGFzaCgpIHsKCgkJCQl2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cmluZyggMSApLnNwbGl0KERFTElNSVRFUik7CgkJCQl2YXIgbWVtYmVyID0gaGFzaFsyXS5zcGxpdChNRU1CRVJfREVMSU1JVEVSKQoJCQkJZ29UbyggZGVjb2RlVXJsKGhhc2hbMF0pLCBkZWNvZGVVcmwoaGFzaFsxXSksIGRlY29kZVVybChtZW1iZXJbMF0pLCBkZWNvZGVVcmwobWVtYmVyLmxlbmd0aCA+IDEgPyBtZW1iZXJbMV0gOiAnJykgKTsKCgkJCX0KCgkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAnaGFzaGNoYW5nZScsIGdvVG9IYXNoLCBmYWxzZSApOwoKCQkJaWYgKCB3aW5kb3cubG9jYXRpb24uaGFzaC5sZW5ndGggPiAwICkgZ29Ub0hhc2goKTsKCgkJPC9zY3JpcHQ+Cgk8L2JvZHk+CjwvaHRtbD4K",
                "body": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCTxoZWFkPgoJCTxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4KCQk8dGl0bGU+dGhyZWUuanMgLSBkb2N1bWVudGF0aW9uPC90aXRsZT4KCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCB1c2VyLXNjYWxhYmxlPW5vLCBtaW5pbXVtLXNjYWxlPTEuMCwgbWF4aW11bS1zY2FsZT0xLjAiPgoJCTxzdHlsZT4KCQkJQGZvbnQtZmFjZSB7CgkJCQlmb250LWZhbWlseTogJ2luY29uc29sYXRhJzsKCQkJCXNyYzogdXJsKCdmaWxlcy9pbmNvbnNvbGF0YS53b2ZmJykgZm9ybWF0KCd3b2ZmJyk7CgkJCQlmb250LXdlaWdodDogbm9ybWFsOwoJCQkJZm9udC1zdHlsZTogbm9ybWFsOwoJCQl9CgoJCQkqeyBib3gtc2l6aW5nOiBib3JkZXItYm94O30KCgkJCWh0bWwgewoJCQkJaGVpZ2h0OiAxMDAlOwoJCQl9CgoJCQlib2R5IHsKCQkJCWJhY2tncm91bmQtY29sb3I6ICNmZmZmZmY7CgkJCQltYXJnaW46IDA7CgkJCQlwYWRkaW5nOiAwIDAgMCAyNjBweDsKCQkJCWhlaWdodDogMTAwJTsKCQkJCWNvbG9yOiAjNTU1OwoJCQkJZm9udC1mYW1pbHk6ICdpbmNvbnNvbGF0YSc7CgkJCQlmb250LXNpemU6IDE1cHg7CgkJCQlsaW5lLWhlaWdodDogMThweDsKCQkJCW92ZXJmbG93OiBoaWRkZW47CgkJCX0KCgkJCWEgewoJCQkJY29sb3I6ICMyMTk0Q0U7CgkJCQl0ZXh0LWRlY29yYXRpb246IG5vbmU7CgkJCX0KCgkJCSNwYW5lbAl7CgkJCQlwb3NpdGlvbjogZml4ZWQ7CgkJCQlsZWZ0OiAwcHg7CgkJCQl3aWR0aDogMjYwcHg7CgkJCQloZWlnaHQ6IDEwMCU7CgkJCQlvdmVyZmxvdzogYXV0bzsKCQkJCWJhY2tncm91bmQ6ICNmYWZhZmE7CgkJCX0KCgkJCQkjcGFuZWwgaDEgewoJCQkJCW1hcmdpbi10b3A6IDMwcHg7CgkJCQkJbWFyZ2luLWJvdHRvbTogNDBweDsKCQkJCQltYXJnaW4tbGVmdDogMjBweDsKCQkJCQlmb250LXNpemU6IDI1cHg7CgkJCQkJZm9udC13ZWlnaHQ6IG5vcm1hbDsKCQkJCX0KCgkJCQkjcGFuZWwgaDIgewoJCQkJCWNvbG9yOiAjNDU0NTQ1OwoJCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCQlmb250LXdlaWdodDogbm9ybWFsOwoKCQkJCQltYXJnaW4tdG9wOiAyMHB4OwoJCQkJCW1hcmdpbi1sZWZ0OiAyMHB4OwoJCQkJfQoKCQkJCSNwYW5lbCBoMyB7CgkJCQkJY29sb3I6ICM2NjY7CgkJCQkJZm9udC1zaXplOiAxNnB4OwoJCQkJCWZvbnQtd2VpZ2h0OiBub3JtYWw7CgoJCQkJCW1hcmdpbi10b3A6IDIwcHg7CgkJCQkJbWFyZ2luLWxlZnQ6IDIwcHg7CgkJCQl9CgoJCQkJI3BhbmVsIHVsIHsKCQkJCQlsaXN0LXN0eWxlLXR5cGU6IG5vbmU7CgkJCQkJcGFkZGluZzogMHB4OwoJCQkJCW1hcmdpbi1sZWZ0OiAyMHB4OwoJCQkJfQoKCQkJI3ZpZXdlciB7CgkJCQlib3JkZXI6IDBweDsKCQkJCXdpZHRoOiAxMDAlOwoJCQkJaGVpZ2h0OiAxMDAlOwoJCQkJb3ZlcmZsb3c6IGF1dG87CgkJCX0KCgkJCS5maWx0ZXJCbG9ja3sKCQkJCW1hcmdpbjogMjBweDsKCQkJCXBvc2l0aW9uOiByZWxhdGl2ZTsKCQkJfQoJCQkuZmlsdGVyQmxvY2sgcCB7CgkJCQltYXJnaW46IDA7CgkJCX0KCQkJI2ZpbHRlcklucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQkJcGFkZGluZzogNXB4OwoJCQkJZm9udC1mYW1pbHk6IGluaGVyaXQ7CgkJCQlmb250LXNpemU6IDE1cHg7CgkJCQlvdXRsaW5lOiBub25lOwoJCQkJYm9yZGVyOiAxcHggc29saWQgI2RlZGVkZTsKCQkJfQoJCQkjZmlsdGVySW5wdXQ6Zm9jdXN7CgkJCQlib3JkZXI6IDFweCBzb2xpZCAjMjE5NENFOwoJCQl9CgkJCSNjbGVhckZpbHRlckJ1dHRvbiB7CgkJCQlwb3NpdGlvbjogYWJzb2x1dGU7IAoJCQkJcmlnaHQ6IDZweDsKCQkJCXRvcDogNTAlOwoJCQkJbWFyZ2luLXRvcDogLThweDsKCQkJCXdpZHRoOiAxNnB4OwoJCQkJaGVpZ2h0OiAxNnB4OwoJCQkJZm9udC1zaXplOiAxNHB4OwoJCQkJY29sb3I6IGdyZXk7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlsaW5lLWhlaWdodDogMDsKCQkJCXBhZGRpbmctdG9wOiA3cHg7CgkJCQlvcGFjaXR5OiAuNTsKCQkJfQoJCQkjY2xlYXJGaWx0ZXJCdXR0b246aG92ZXJ7CgkJCQlvcGFjaXR5OiAxOwoJCQl9CgkJCS5maWx0ZXJlZHsKCQkJCWRpc3BsYXk6IG5vbmU7CgkJCX0KCQkJI3BhbmVsIGxpIGJ7CgkJCQlmb250LXdlaWdodDogYm9sZDsKCQkJfQoJCQkjZXhwYW5kQnV0dG9uewoJCQkJZGlzcGxheTogbm9uZTsKCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCXJpZ2h0OiAyMHB4OwoJCQkJdG9wOiAxMnB4OwoJCQkJd2lkdGg6IDMycHg7CgkJCQloZWlnaHQ6IDMycHg7CgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjMjE5NENFOwoJCQl9CgkJCSNleHBhbmRCdXR0b24gc3BhbnsKCQkJCWhlaWdodDogM3B4OwoJCQkJYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CgkJCQl3aWR0aDogMTZweDsKCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCWxlZnQ6IDhweDsKCQkJCXRvcDogOHB4OwoJCQl9CgkJCSNleHBhbmRCdXR0b24gc3BhbjpudGgtY2hpbGQoMSkgewoJCQkJdG9wOiAxNHB4OwoJCQl9CgkJCSNleHBhbmRCdXR0b24gc3BhbjpudGgtY2hpbGQoMikgewoJCQkJdG9wOiAyMHB4OwoJCQkJd2lkdGg6IDEycHg7CgkJCX0KCQkJQG1lZGlhIGFsbCBhbmQgKCBtYXgtd2lkdGg6IDY0MHB4ICkgewoJCQkJI3BhbmVsewoJCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCQlsZWZ0OiAwOwoJCQkJCXRvcDogMDsKCQkJCQloZWlnaHQ6IDQ4MHB4OwoJCQkJCXdpZHRoOiAxMDAlOwoJCQkJCXJpZ2h0OiAwOwoJCQkJCXotaW5kZXg6IDEwMDsKCQkJCQlvdmVyZmxvdzogaGlkZGVuOwoJCQkJCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGVkZWRlOwoJCQkJfQoJCQkJI2NvbnRlbnR7CgkJCQkJb3ZlcmZsb3c6IGF1dG87CgkJCQkJcG9zaXRpb246IGFic29sdXRlOwoJCQkJCWxlZnQ6IDA7CgkJCQkJdG9wOiAxMjBweDsKCQkJCQlyaWdodDogMDsKCQkJCQlib3R0b206IDA7CgkJCQl9CgkJCQkjdmlld2VyewoJCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCQlsZWZ0OiAwOwoJCQkJCXRvcDogNDhweDsKCQkJCX0KCQkJCSNleHBhbmRCdXR0b257CgkJCQkJZGlzcGxheTogYmxvY2s7CgkJCQl9CgkJCQkjcGFuZWwuY29sbGFwc2VkewoJCQkJCWhlaWdodDogNTZweDsKCQkJCX0KCQkJCSNwYW5lbCBoMXsKCQkJCQltYXJnaW4tdG9wOiAyMHB4OwoJCQkJCW1hcmdpbi1ib3R0b206IDIwcHg7CgkJCQl9CgkJCQkjY29udGVudHsKCQkJCQl0b3A6IDkwcHg7CgkJCQl9CgkJCX0KCQk8L3N0eWxlPgoJPC9oZWFkPgoJPGJvZHk+CgoJCTxkaXYgaWQ9InBhbmVsIiBjbGFzcz0iY29sbGFwc2VkIj4KCQkJPGEgaWQ9ImV4cGFuZEJ1dHRvbiIgaHJlZj0iIyIgPgoJCQkJPHNwYW4+PC9zcGFuPjxzcGFuPjwvc3Bhbj48c3Bhbj48L3NwYW4+CgkJCTwvYT4KCQkJPGgxPjxhIGhyZWY9Imh0dHA6Ly90aHJlZWpzLm9yZyI+dGhyZWUuanM8L2E+IC8gZG9jczwvaDE+CgkJCTxkaXYgY2xhc3M9ImZpbHRlckJsb2NrIiA+CgkJCQk8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImZpbHRlcklucHV0IiBwbGFjZWhvbGRlcj0iVHlwZSB0byBmaWx0ZXIiLz4KCQkJCTxhIGhyZWY9IiMiIGlkPSJjbGVhckZpbHRlckJ1dHRvbiIgPng8L2E+CgkJCTwvZGl2PgoJCQk8ZGl2IGlkPSJjb250ZW50IiA+CgkJCTwvZGl2PgoJCTwvZGl2PgoJCTxpZnJhbWUgaWQ9InZpZXdlciI+PC9pZnJhbWU+CgoJCTxzY3JpcHQgc3JjPSJsaXN0LmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0PgoJCQl2YXIgcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ3BhbmVsJyApOwoJCQl2YXIgdmlld2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICd2aWV3ZXInICk7CgoJCQl2YXIgY2xlYXJGaWx0ZXJCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ2NsZWFyRmlsdGVyQnV0dG9uJyApOwoJCQl2YXIgZmlsdGVySW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ2ZpbHRlcklucHV0JyApOwoJCQkvL2ZpbHRlcklucHV0LmZvY3VzKCk7CgoJCQlwYW5lbC5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHsKCQkJCS8vZmlsdGVySW5wdXQuZm9jdXMoKTsKCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJfSApOwoKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdleHBhbmRCdXR0b24nICkuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7CgkJCQlwYW5lbC5jbGFzc0xpc3QudG9nZ2xlKCAnY29sbGFwc2VkJyApOwoJCQkJaWYoICFwYW5lbC5jbGFzc0xpc3QuY29udGFpbnMoICdjb2xsYXBzZWQnICkgKSB7CgkJCQkJLy9maWx0ZXJJbnB1dC5mb2N1cygpOwoJCQkJfQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9ICk7CgoJCQl2YXIgREVMSU1JVEVSID0gJy8nOwoJCQl2YXIgTUVNQkVSX0RFTElNSVRFUiA9ICcuJzsKCQkJdmFyIG5hbWVDYXRlZ29yeU1hcCA9IHt9OwoJCQl2YXIgc2VjdGlvbnMgPSBbXTsKCgkJCXZhciBjb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdjb250ZW50JyApOwoKCQkJZm9yICggdmFyIHNlY3Rpb24gaW4gbGlzdCApIHsKCgkJCQl2YXIgaDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnaDInICk7CgkJCQloMi50ZXh0Q29udGVudCA9IHNlY3Rpb247CgoJCQkJY29udGVudC5hcHBlbmRDaGlsZCggaDIgKTsKCgkJCQlmb3IgKCB2YXIgY2F0ZWdvcnkgaW4gbGlzdFsgc2VjdGlvbiBdICkgewoKCQkJCQl2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCgkJCQkJdmFyIGgzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2gzJyApOwoJCQkJCWgzLnRleHRDb250ZW50ID0gY2F0ZWdvcnk7CgoJCQkJCWRpdi5hcHBlbmRDaGlsZCggaDMgKTsKCgkJCQkJdmFyIHVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3VsJyApOwoJCQkJCWRpdi5hcHBlbmRDaGlsZCggdWwgKTsKCgkJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgbGlzdFsgc2VjdGlvbiBdWyBjYXRlZ29yeSBdLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCXZhciBwYWdlID0gbGlzdFsgc2VjdGlvbiBdWyBjYXRlZ29yeSBdWyBpIF07CgoJCQkJCQl2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnbGknICk7CgkJCQkJCXZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2EnICk7CgkJCQkJCWEuc2V0QXR0cmlidXRlKCAnaHJlZicsICcjJyApOwoJCQkJCQkoIGZ1bmN0aW9uKCBzLCBjLCBwICkgeyAKCQkJCQkJCWEuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7CgkJCQkJCQkJZ29UbyggcywgYywgcCApOwoJCQkJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCX0gKSAKCQkJCQkJfSApKCBzZWN0aW9uLCBjYXRlZ29yeSwgcGFnZVsgMCBdICkKCQkJCQkJYS50ZXh0Q29udGVudCA9IHBhZ2VbIDAgXTsKCQkJCQkJbGkuYXBwZW5kQ2hpbGQoIGEgKTsKCQkJCQkJdWwuYXBwZW5kQ2hpbGQoIGxpICk7CgoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbcGFnZVswXV0gPSB7CgkJCQkJCQlzZWN0aW9uOiBzZWN0aW9uLAoJCQkJCQkJY2F0ZWdvcnk6IGNhdGVnb3J5LAoJCQkJCQkJbmFtZTogcGFnZVswXSwKCQkJCQkJCWVsZW1lbnQ6IGEKCQkJCQkJfTsKCgkJCQkJfQoKCQkJCQljb250ZW50LmFwcGVuZENoaWxkKCBkaXYgKTsKCQkJCQlzZWN0aW9ucy5wdXNoKCB1bCApOwoKCQkJCX0KCgoJCQl9CgoJCQlwYW5lbC5hcHBlbmRDaGlsZCggY29udGVudCApCgoJCQlmdW5jdGlvbiBsYXlvdXRMaXN0KCkgewoKCQkJCXNlY3Rpb25zLmZvckVhY2goIGZ1bmN0aW9uKCBlbCApIHsKCQkJCQl2YXIgY29sbGFwc2VkID0gdHJ1ZTsKCQkJCQlBcnJheS5wcm90b3R5cGUuc2xpY2UuYXBwbHkoIGVsLmNoaWxkcmVuICkuZm9yRWFjaCggZnVuY3Rpb24oIGl0ZW0gKSB7CgkJCQkJCWlmKCAhaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoICdmaWx0ZXJlZCcgKSApIHsKCQkJCQkJCWNvbGxhcHNlZCA9IGZhbHNlOwoJCQkJCQkJcmV0dXJuOwoJCQkJCQl9CgkJCQkJfSApOwoJCQkJCWlmKCBjb2xsYXBzZWQgKSB7CgkJCQkJCWVsLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCggJ2ZpbHRlcmVkJyApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWVsLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSggJ2ZpbHRlcmVkJyApOwoJCQkJCX0KCQkJCX0gKTsKCQkJfQoKCQkJZmlsdGVySW5wdXQuYWRkRXZlbnRMaXN0ZW5lciggJ2lucHV0JywgZnVuY3Rpb24oIGUgKSB7CgkJCQl1cGRhdGVGaWx0ZXIoKTsKCQkJfSApOwoKCQkJY2xlYXJGaWx0ZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7CgkJCQlmaWx0ZXJJbnB1dC52YWx1ZSA9ICcnOwoJCQkJdXBkYXRlRmlsdGVyKCk7CgkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCX0gKTsKCgkJCWZ1bmN0aW9uIHVwZGF0ZUZpbHRlcigpIHsKCgkJCQl2YXIgZXhwID0gbmV3IFJlZ0V4cCggZmlsdGVySW5wdXQudmFsdWUsICdnaScgKTsKCQkJCWZvciggdmFyIGogaW4gbmFtZUNhdGVnb3J5TWFwICkgewoJCQkJCXZhciByZXMgPSBuYW1lQ2F0ZWdvcnlNYXBbIGogXS5uYW1lLm1hdGNoKCBleHAgKTsKCQkJCQlpZiggcmVzICYmIHJlcy5sZW5ndGggPiAwICkgewoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbIGogXS5lbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSggJ2ZpbHRlcmVkJyApOwoJCQkJCQl2YXIgc3RyID0gbmFtZUNhdGVnb3J5TWFwWyBqIF0ubmFtZTsKCQkJCQkJZm9yKCB2YXIgaSA9IDA7IGkgPCByZXMubGVuZ3RoOyBpKysgKSB7CgkJCQkJCQlzdHIgPSBzdHIucmVwbGFjZSggcmVzWyBpIF0sICc8Yj4nICsgcmVzWyBpIF0gKyAnPC9iPicgKTsKCQkJCQkJfQoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbIGogXS5lbGVtZW50LmlubmVySFRNTCA9IHN0cjsKCQkJCQl9IGVsc2UgewoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbIGogXS5lbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCggJ2ZpbHRlcmVkJyApOwoJCQkJCQluYW1lQ2F0ZWdvcnlNYXBbIGogXS5lbGVtZW50LnRleHRDb250ZW50ID0gbmFtZUNhdGVnb3J5TWFwWyBqIF0ubmFtZTsKCQkJCQl9CgkJCQl9CgkJCQlsYXlvdXRMaXN0KCk7CgoJCQl9CgoJCQlmdW5jdGlvbiBlbmNvZGVVcmwoIHBhdGggKSB7CgoJCQkJcmV0dXJuIHBhdGgucmVwbGFjZSgvXCBcL1wgL2csICcuJykucmVwbGFjZSgvXCAvZywgJ18nKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIGRlY29kZVVybCggcGF0aCApIHsKCgkJCQlyZXR1cm4gcGF0aC5yZXBsYWNlKC9fL2csICcgJykucmVwbGFjZSgvXC4vZywgJyAvICcpOwoKCQkJfQoKCQkJLy8gUGFnZSBsb2FkaW5nCgoJCQlmdW5jdGlvbiBnb1RvKCBzZWN0aW9uLCBjYXRlZ29yeSwgbmFtZSwgbWVtYmVyICkgewoJCQkJdmFyIHBhcnRzLCBsb2NhdGlvbjsKCgkJCQkvLyBGdWxseSByZXNvbHZlIGxpbmtzIHRoYXQgb25seSBwcm92aWRlIGEgbmFtZQoJCQkJaWYoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CgoJCQkJCS8vIFJlc29sdmUgbGlua3Mgb2YgdGhlIGZvcm0gJ0NsYXNzLm1lbWJlcicKCQkJCQlpZihzZWN0aW9uLmluZGV4T2YoTUVNQkVSX0RFTElNSVRFUikgIT09IC0xKSB7CgkJCQkJCXBhcnRzID0gc2VjdGlvbi5zcGxpdChNRU1CRVJfREVMSU1JVEVSKQoJCQkJCQlzZWN0aW9uID0gcGFydHNbMF07IAoJCQkJCQltZW1iZXIgPSBwYXJ0c1sxXTsKCQkJCQl9CgoJCQkJCWxvY2F0aW9uID0gbmFtZUNhdGVnb3J5TWFwW3NlY3Rpb25dOwoJCQkJCWlmICghbG9jYXRpb24pIHJldHVybjsKCQkJCQlzZWN0aW9uID0gbG9jYXRpb24uc2VjdGlvbjsKCQkJCQljYXRlZ29yeSA9IGxvY2F0aW9uLmNhdGVnb3J5OwoJCQkJCW5hbWUgPSBsb2NhdGlvbi5uYW1lOwoJCQkJfSAKCgkJCQl2YXIgdGl0bGUgPSAndGhyZWUuanMgLSBkb2N1bWVudGF0aW9uIC0gJyArIHNlY3Rpb24gKyAnIC0gJyArIG5hbWU7CgkJCQl2YXIgdXJsID0gZW5jb2RlVXJsKHNlY3Rpb24pICsgREVMSU1JVEVSICsgZW5jb2RlVXJsKCBjYXRlZ29yeSApICsgREVMSU1JVEVSICsgZW5jb2RlVXJsKG5hbWUpICsgKCEhbWVtYmVyID8gTUVNQkVSX0RFTElNSVRFUiArIGVuY29kZVVybChtZW1iZXIpIDogJycpOwoKCQkJCXdpbmRvdy5sb2NhdGlvbi5oYXNoID0gdXJsOwoJCQkJd2luZG93LmRvY3VtZW50LnRpdGxlID0gdGl0bGU7CgoJCQkJdmlld2VyLnNyYyA9IHBhZ2VzWyBzZWN0aW9uIF1bIGNhdGVnb3J5IF1bIG5hbWUgXSArICcuaHRtbCcgKyAoISFtZW1iZXIgPyAnIycrbWVtYmVyIDogJycpOwoKCQkJCXBhbmVsLmNsYXNzTGlzdC5hZGQoICdjb2xsYXBzZWQnICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBnb1RvSGFzaCgpIHsKCgkJCQl2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cmluZyggMSApLnNwbGl0KERFTElNSVRFUik7CgkJCQl2YXIgbWVtYmVyID0gaGFzaFsyXS5zcGxpdChNRU1CRVJfREVMSU1JVEVSKQoJCQkJZ29UbyggZGVjb2RlVXJsKGhhc2hbMF0pLCBkZWNvZGVVcmwoaGFzaFsxXSksIGRlY29kZVVybChtZW1iZXJbMF0pLCBkZWNvZGVVcmwobWVtYmVyLmxlbmd0aCA+IDEgPyBtZW1iZXJbMV0gOiAnJykgKTsKCgkJCX0KCgkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAnaGFzaGNoYW5nZScsIGdvVG9IYXNoLCBmYWxzZSApOwoKCQkJaWYgKCB3aW5kb3cubG9jYXRpb24uaGFzaC5sZW5ndGggPiAwICkgZ29Ub0hhc2goKTsKCgkJPC9zY3JpcHQ+Cgk8L2JvZHk+CjwvaHRtbD4K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 15:37:54 GMT",
                    "Content-Length": "8784",
                    "Date": "Sat, 08 Nov 2014 15:37:56 GMT",
                    "Content-Type": "text/html; charset=utf-8"
                },
                "cookies": [],
                "mimeType": "HTML",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}